define("DS/WebViewer2D/ViewerDoc",["UWA/Core","UWA/Class","UWA/Element","DS/WebSystem/Environment"],function(e,t,i,n){"use strict";var a={init:function(t){var i,n;if(this.errorThumbnail="../3DPlay2DExperience/assets/images/I_3DSHARELoadFailed.png",this.status={failed:!1,loaded:!1},this.realSizeWidth=t.realSizeWidth,this.realSizeHeight=t.realSizeHeight,this.viewer=t.viewer,this.actionbarHeight=t.actionbarHeight,t.asset&&(n=t.asset.currentSrc||t.asset.baseURI||t.asset),"string"==typeof n&&""!==n){var a=n.split("/");i=a[a.length-1]}this.title=t.defaultTitle||i,this.thumbnail=null;var s={sheet:t.sheet};this.container=new e.Element("div",{data:s,class:"viewer"}).inject(this.viewer)},loadAsset:function(e){e.asset!==this.asset&&(this.asset=e.asset)},_setThumbnail:function(e){this.thumbnail=e},getTitle:function(){return this.title},getCurrentScale:function(){return this.scale},getRealSizeHeight:function(){return this.realSizeHeight},getRealSizeWidth:function(){return this.realSizeWidth},getMargin:function(){return this.margin},getContainer:function(){return this.container},show:function(){this.container.style.top="0px"},hide:function(){this.container.style.top=this.viewer.offsetHeight+"px"},onMouseWheel:function(e){e.preventDefault&&e.preventDefault();var t=window.event||e;this.zoom(t,(t.wheelDelta||-t.detail)>0?1.1:10/11,{x:t.clientX,y:t.clientY})},initMouseMoveZoom:function(e){this.currentZoom=100,this.initialY=e.clientY,this.minZoom=!1,this.viewerCenter={x:this.container.offsetWidth/2,y:this.container.offsetHeight/2},this.currentScale=this.scale},onMouseMoveZoom:function(e){if(n.isSet("3DPlay.DisableViewerCanvas")){var t=e.from&&e.from.length?e.from[0].event:null,i=100+(this.initialY-t.clientY)/2;if(i>0&&(!1===this.minZoom||i>this.currentZoom)&&(this.zoom(t,100/this.currentZoom,{x:this.viewerCenter.x,y:this.viewerCenter.y}),this.currentZoom=i,this.zoom(t,this.currentZoom/100,{x:this.viewerCenter.x,y:this.viewerCenter.y}),this.minZoom=this.scale<.1),!(e.from&&e.from[0]&&e.from[0].event&&e.from[0].event.preventDefault))return!1;e.from[0].event.preventDefault()}else if(e.from&&e.from[0]&&e.from[0].event&&e.from[0].event.preventDefault){e.from[0].event.preventDefault();var a=e.from&&e.from.length?e.from[0].event:null,s=this.initialY-a.clientY;if(Math.abs(s)>this.viewer.offsetHeight/100&&Math.abs(s)<this.viewer.offsetHeight){var r=1+s/this.viewer.offsetHeight*10,o=this.currentScale*r/this.scale;this.zoom(a,o,{x:this.viewerCenter.x,y:this.viewerCenter.y})}}return this.scale},panStart:function(e,t){},pan:function(e,t){return!0},panEnd:function(e,t){},onResize:function(){},fit:function(){},realSize:function(){},reframe:function(){},zoom:function(e,t,i){return!0},focusOn:function(e,t){},getScreenShot:function(e){var t=document.createElement("canvas");t.width=this.viewer.offsetWidth,t.height=this.viewer.offsetHeight;var i=t.getContext("2d");i.beginPath(),i.rect(0,0,t.width,t.height),i.fillStyle="white",i.fill();this.generateScreenshotOfDoc({onSuccess:function(a,s){i.drawImage(a,Math.floor(s.clipX),Math.floor(s.clipY),Math.floor(s.clipWidth),Math.floor(s.clipHeight),Math.floor(s.pastingX),Math.floor(s.pastingY),Math.floor(s.pastingWidth),Math.floor(s.pastingHeight)),n.isSet("ODT_3DPlay_Document2D")?require(["DS/CoreEvents/Events"],function(e){e.publish({event:n.get("ODT_3DPlay_Document2D")})}):e.onSuccess(t.toDataURL("image/png"))},onFail:function(t){e.onFail(t)},width:t.width,height:t.height})},generateScreenshotOfDoc:function(e){},rotate:function(e){},getAnnotationDiv:function(){},loadFailed:function(e){this.status.failed=!0,this.failureID=" failed "},getErrorID:function(){return this.failureID},dispose:function(){this.viewer.removeChild(this.container),this.container=this.viewer=null},setRealDimension:function(e){e&&(this.realSizeWidth=e.realSizeWidth,this.realSizeHeight=e.realSizeHeight)}};return t.extend(a)}),define("DS/WebViewer2D/CanvasShapes",["UWA/Class","DS/WebUtils/GeometryUtils","DS/WebUtils/Vector2"],function(e,t,i){"use strict";function n(e){var t=e.settings;return{id:Date.now(),type:e.shapeData.type,property:{color:t.getColor(),thickness:t.getThickness()/e.scale},linkID:new Array,data:{}}}function a(e){var t=e.shape.property,i=e.canvas.getContext("2d");return e.lowLightMode?(i.globalAlpha=.8,i.strokeStyle="#D3D3D3",i.fillStyle="#D3D3D3"):(i.strokeStyle=t.color,i.fillStyle=t.color,i.globalAlpha=1,e.alpha&&(i.globalAlpha=e.alpha)),i.lineCap="round",i.lineJoin="round",i.lineWidth=t.thickness*e.scale,i}function s(e,t,i){var n=t.length;e.beginPath(),e.moveTo(t[0].x,t[0].y);for(var a=1;a<n;++a)e.lineTo(t[a].x,t[a].y);i&&e.closePath(),e.stroke()}var r={createunknownOpen:function(e){var t=n(e),i=e.shapeData;return t.data={path:i},t},drawunknownOpen:function(e){for(var t=e.shape,i=a(e),n=t.data.path,r=[],o=n.length,h=0;h<o;++h)r.push({x:n[h].x*e.scale,y:n[h].y*e.scale});return s(i,r,!1),{lastPosition:r[0].x-r[o-1].x>=0?r[0]:r[o-1]}},isIntersectunknownOpen:function(e){for(var i=e.shape,n=i.data.path,a=0;a<n.length-1;++a)if(t._intersect(n[a],n[a+1],e.startPoint,e.endPoint))return i.id;return!1},createline:function(e){var t=n(e),i=e.shapeData,a=[];return a.push({x:i[0].x,y:i[0].y}),a.push({x:i[i.length-1].x,y:i[i.length-1].y}),t.data={path:a},t},drawline:function(e){return r.drawunknownOpen(e)},isIntersectline:function(e){return r.isIntersectunknownOpen(e)},createarrowhead:function(e){var t=n(e),a=e.shapeData.data.vertices,s=e.shapeData.connectionData;if(s){for(var r=s.shape,o=s.pointID,h=s.pointEndID,l=r.data.path,c=function(e,t){var i=e.x-t.x,n=e.y-t.y;return Math.sqrt(i*i+n*n)},u=0,d=0;d<l.length-1;++d)u+=c(l[d+1],l[d]);u*=.15;var p=c(a[1],a[0]),f=c(a[1],a[2]),g=p>=f?p:f;u=g<=u?g:u;var v=new i(l[h].x-l[o].x,l[h].y-l[o].y);(v=v.normalize()).rotateAround({x:0,y:0},.55),a[0].x=v.x*u+l[o].x,a[0].y=v.y*u+l[o].y,a[1].x=l[o].x,a[1].y=l[o].y,v.rotateAround({x:0,y:0},-1.1),a[2].x=v.x*u+l[o].x,a[2].y=v.y*u+l[o].y,r.linkID.push({id:t.id,pointID:o}),t.linkID.push({id:r.id,pointID:1})}return t.data={path:a},t},drawarrowhead:function(e){var t=e.shape,i=a(e),n=[];return n.push({x:t.data.path[0].x*e.scale,y:t.data.path[0].y*e.scale}),n.push({x:t.data.path[1].x*e.scale,y:t.data.path[1].y*e.scale}),n.push({x:t.data.path[2].x*e.scale,y:t.data.path[2].y*e.scale}),s(i,n,!1),{lastPosition:{x:n[1].x,y:n[1].y}}},isIntersectarrowhead:function(e){return r.isIntersectunknownOpen(e)},createcircle:function(e){var t=n(e),i=e.shapeData;return t.data={radius:i.data.radius,centre:{x:i.data.centre.x,y:i.data.centre.y}},t},drawcircle:function(e){var t=e.shape,i=a(e),n=t.data.centre.x*e.scale,s=t.data.centre.y*e.scale,r=t.data.radius*e.scale;return i.beginPath(),i.arc(n,s,r,0,2*Math.PI),i.stroke(),{lastPosition:{x:n,y:s}}},isIntersectcircle:function(e){for(var i=e.shape,n=i.data.radius,a=i.data.centre.x,s=i.data.centre.y,r=2*Math.PI/10,o=[],h=0;h<2*Math.PI;h+=r)o.push({x:a+n*Math.cos(h),y:s+n*Math.sin(h)});for(var l=0;l<o.length-1;++l)if(t._intersect(o[l],o[l+1],e.startPoint,e.endPoint))return i.id;return!1},createellipse:function(e){var t=e.shapeData,i=n(e);return i.data={radiusX:t.data.radius1,radiusY:t.data.radius2,centre:{x:t.data.centre.x,y:t.data.centre.y},angle:t.data.angle},i},drawellipse:function(e){var t=e.shape,i=a(e),n=t.data.centre.x*e.scale,s=t.data.centre.y*e.scale,r=t.data.radiusX*e.scale,o=t.data.radiusY*e.scale,h=t.data.angle*Math.PI/180;return i.save(),i.beginPath(),i.translate(n,s),i.rotate(h),i.translate(-r,-o),i.scale(r,o),i.arc(1,1,1,0,2*Math.PI),i.restore(),i.stroke(),{lastPosition:{x:n,y:s}}},isIntersectellipse:function(e){var n=e.shape,a=n.data.centre.x,s=n.data.centre.y,r=n.data.radiusX,o=n.data.radiusY,h=n.data.angle*Math.PI/180,l=[];l.push(new i(a+r,s+o).rotateAround({x:a,y:s},h)),l.push(new i(a-r,s+o).rotateAround({x:a,y:s},h)),l.push(new i(a-r,s-o).rotateAround({x:a,y:s},h)),l.push(new i(a+r,s-o).rotateAround({x:a,y:s},h));for(var c=0;c<l.length-1;++c)if(t._intersect(l[c],l[c+1],e.startPoint,e.endPoint))return n.id;return!1},createpolygon:function(e){var t=e.shapeData,i=n(e);i.data={},i.data.path=[];for(var a=0;a<t.data.vertices.length;++a)i.data.path.push({x:t.data.vertices[a].x,y:t.data.vertices[a].y});return i},drawpolygon:function(e){for(var t=e.shape,i=a(e),n=null,r=null,o=t.data.path,h=[],l=o.length,c=0;c<l;++c)h.push({x:o[c].x*e.scale,y:o[c].y*e.scale}),(null==n||n<h[c].x)&&(n=h[c].x),(null==r||r>h[c].y)&&(r=h[c].y);return s(i,h,!0),{lastPosition:{x:n,y:r}}},isIntersectpolygon:function(e){return r.isIntersectunknownOpen(e)},createrectangle:function(e){return r.createpolygon(e)},drawrectangle:function(e){return r.drawpolygon(e)},isIntersectrectangle:function(e){return r.isIntersectpolygon(e)},createsquare:function(e){return r.createpolygon(e)},drawsquare:function(e){return r.drawpolygon(e)},isIntersectsquare:function(e){return r.isIntersectpolygon(e)},createtriangle:function(e){return r.createpolygon(e)},drawtriangle:function(e){return r.drawpolygon(e)},isIntersecttriangle:function(e){return r.isIntersectpolygon(e)},createtext:function(e){var t=n(e);return t.data=e.shapeData,t},drawtext:function(e){var t=e.shape.data,i=1+t.point.x*e.scale,n=t.point.y*e.scale,s=a(e),r=Math.ceil(t.fontSize*e.scale)+'px "3ds"';s.font=t.fontWeight+" "+r;for(var o=0;o<t.text.length;++o){var h=n+(t.offsetHeight-4)*e.scale*t.controlScale+o*t.offsetHeight*e.scale*t.controlScale;s.fillText(t.text[o],i,h)}return{lastPosition:{x:i,y:n}}},isIntersecttext:function(e){var i=e.shape.data.point.x,n=e.shape.data.point.y,a=e.shape.data.width,s=e.shape.data.height,r=[];r.push({x:i,y:n}),r.push({x:i,y:n+s}),r.push({x:i+a,y:n+s}),r.push({x:i+a,y:n});for(var o=0;o<r.length-1;++o)if(t._intersect(r[o],r[o+1],e.startPoint,e.endPoint))return e.shape.id;return!1}};return{createShapeFromJSON:function(e){},createShape:function(e){var t=r["create"+e.shapeData.type];return t||(t=r.createunknownOpen),t(e)},drawShape:function(e){var t=r["draw"+e.shape.type];return t||(t=r.drawunknownOpen),t(e)},isIntersectShape:function(e){var t=r["isIntersect"+e.shape.type];t||(t=r.isIntersectunknownOpen);var i=!1,n=t(e);return n&&(i=new Array,function e(t,i,n){if(n.indexOf(t)<0){n.push(t);var a=i[t];if(a)for(var s=a.linkID,r=0;r<s.length;++r)e(s[r].id,i,n)}return n.length>0}(n,e.shapeList,i)),i}}}),define("DS/WebViewer2D/ViewerError",["UWA/Core","DS/WebViewer2D/ViewerDoc"],function(e,t){"use strict";return t.extend({init:function(t){this.viewer=t.viewer,this.status={failed:!0,loaded:!1};var i=(t.asset.filename||t.asset).split("/"),n=i[i.length-1];this.container=new e.Element("div",{data:t.data,class:"viewer"}).inject(this.viewer),this.getErrorID=function(){return" error LoadFailed"},this.getTitle=function(){return n}}})}),define("DS/WebViewer2D/ViewerCanvas",["UWA/Core","DS/WebViewer2D/ViewerDoc","DS/UIKIT/Spinner","DS/CoreEvents/Events","DS/WebViewer2D/CanvasShapes","WebappsUtils/WebappsUtils"],function(e,t,i,n,a,s){"use strict";return t.extend({init:function(t){this._parent(t),this.thumbnail=t.thumbnail,this.title=t.title||t.defaultTitle,this.margin=t.margin||10,this.documentContainer=new e.Element("div",{styles:{position:"relative",display:"inline-block","vertical-align":"middle","background-color":"#ffffff","box-shadow":"darkgrey 2px 2px 10px 1px",overflow:"hidden",height:"calc(100% - 10px)","margin-top":"5px","margin-bottom":"5px"}}).inject(this.container),this.canvas=new e.Element("canvas",{id:"ViewerCanvas",styles:{"z-index":"2000","vertical-align":"top",display:"none",height:"100%"}});var i=document.createElement("div");i.setAttribute("class","PlayWeb-Splash"),this.splashImage=document.createElement("img"),this.baseUrl=s.getWebappsBaseUrl(),"/"!==this.baseUrl.charAt(this.baseUrl.length-1)&&(this.baseUrl+="/"),this.splashImage.setAttribute("src",this.baseUrl+"3DPlay2DExperience/assets/images/sheet_loading.gif"),this.splashImage.setAttribute("class","PlayWeb-SplashImage loading"),i.appendChild(this.splashImage);var n=this,a=function(e){"thumb"===e&&(n.splashImage.setAttribute("class","PlayWeb-SplashImage thumb"),n.thumbnail?(n.splashImage.src=n.thumbnail,n.thumbnailImg=new Image,n.thumbnailImg.src=n.thumbnail):e="loading"),"thumb"!==e&&("loading"===e?n.splashImage.src=n.baseUrl+"3DPlay2DExperience/assets/images/sheet_loading.gif":"failed"===e&&(n.splashImage.src=n.baseUrl+"3DPlay2DExperience/assets/images/sheet_failed.png"),n.canvas.width=n.realSizeWidth*n.scale,n.canvas.height=n.realSizeHeight*n.scale,n.canvas.setStyle("display",""),n.splashImage.setAttribute("class","PlayWeb-SplashImage ")),i.style.display=""};this.specialViews={hide:function(){i.style.display="none"},show:{loading:function(){a("loading")},failed:function(){a("failed")},thumbnail:function(){a("thumb")}}},this.documentContainer.appendChild(i),this.canvas.inject(this.documentContainer),this.shapeList={},this._isCentered=!1},updateView:function(e){this.asset=e.asset,this.status=e.status,this.title=e.title,this.shapeList=e.annotations||{},this.scale=e.scale,this.useLOD=e.useLOD,!1===this.status.loaded?(this.specialViews.show.loading(),e.doneCB&&e.doneCB(!0)):!0===this.status.failed?(this.specialViews.show.failed(),e.doneCB&&e.doneCB(!0)):this.scaleAndRender(e.doneCB)},_scaleAndRender:function(){return!1},scaleAndRender:function(e){var t=this;this._scaleAndRender({scale:this.scale||1,asset:this.asset,status:this.status,OnComplete:function(i){for(var n in!0!==i&&(t.canvas.setStyle("display",""),t.specialViews.hide()),t.shapeList)a.drawShape({shape:t.shapeList[n],canvas:t.canvas,scale:t.scale});t=void 0,e&&e()}})},setScale:function(e){if(e!==this.scale){this.scale=e;var t=function(){n.publish({event:"3DPlay.2D.Zoom.Completed",data:{scale:this.scale}})}.bind(this);this.scaleAndRender(t)}},getScale:function(){return this.scale},getScreenShot:function(e){var t,i,n,a,s,r,o,h,l=this.useLOD?this.thumbnailImg:this.canvas,c=(this.useLOD?this.splashImage:this.canvas).getBoundingClientRect(),u=c.top-e.viewerFrameBB.top,d=c.left-e.viewerFrameBB.left,p=c.right-e.viewerFrameBB.left,f=c.bottom-e.viewerFrameBB.top,g=e.containerBB.top-e.viewerFrameBB.top,v=e.containerBB.bottom-e.viewerFrameBB.top,m=e.containerBB.left-e.viewerFrameBB.left,w=e.containerBB.right-e.viewerFrameBB.left;f<=g||u>=v||d>=w||p<=m||(this.useLOD?(t=d>0?0:Math.abs(d)*(this.thumbnailImg.width/c.width),i=u>0?0:Math.abs(u)*(this.thumbnailImg.height/c.height),n=this.thumbnailImg.width-t,a=this.thumbnailImg.height-i,s=d>0?d:0,r=u>0?u:0,o=d>0?c.width:c.width+d,h=u>0?c.height:c.height+u):(d>m?(t=0,s=d):(t=Math.abs(d),s=0),u>g?(i=0,r=u):(i=Math.abs(u),r=0),o=n=d<e.containerBB.left?p>w?e.containerBB.width:c.width+d:p<w?c.width:w-d,h=a=u<g?f>v?e.containerBB.height:c.height+u:f<v?c.height:v-u),e.context.shadowColor="darkgrey",e.context.shadowOffsetX=2,e.context.shadowOffsetY=2,e.context.shadowBlur=10,e.context.fillRect(s,r,o,h),e.context.drawImage(l,t,i,n,a,s,r,o,h))},getAnnotationDiv:function(){return this.document},getContainer:function(){return this.container},getViewerPositionFromMouse:function(e){var t=this.documentContainer.getBoundingClientRect(),i=e.x-t.left,n=e.y-t.top;return i>0&&n>0&&i<this.currentWidth&&n<this.currentHeight&&{x:i/=this.scale,y:n/=this.scale}},getMousePositionFromViewer:function(e){var t=e.x*this.scale,i=e.y*this.scale;return t>0&&i>0&&t<this.currentWidth&&i<this.currentHeight&&{x:t+=this.currentPosH,y:i+=this.currentPosV}},getShapeList:function(){return this.shapeList},createShape:function(e){var t=a.createShape({shapeData:e.shapeData,scale:this.scale,settings:e.settings});return this.shapeList[""+t.id]=t,a.drawShape({shape:t,canvas:this.canvas,scale:this.scale})},getIntersectingShapes:function(e){var t=[];for(var i in this.shapeList){var n=a.isIntersectShape({shape:this.shapeList[i],startPoint:e.startPoint,endPoint:e.endPoint,shapeList:this.shapeList});n&&(t=t.concat(n))}return t},drawShape:function(e){for(var t=e.idList,i=0;i<t.length;++i)a.drawShape({shape:this.shapeList[""+t[i]],canvas:this.canvas,scale:this.scale,lowLightMode:e.lowLightMode})},destroyShape:function(e){for(var t=e.idList,i=0;i<t.length;++i)delete this.shapeList[""+t[i]]},dispose:function(){this._parent(),this.baseUrl=null,this.documentContainer=null,this.canvas=null},_setThumbnail:function(e){this._parent(e),this.useLOD&&this.specialViews.show.thumbnail()}})}),define("DS/WebViewer2D/ViewerSvg",["DS/WebViewer2D/ViewerDoc","DS/WebViewer2D/ViewerCanvas","DS/WebSystem/DetectBrowser","DS/CoreEvents/Events","DS/WebSystem/Environment","DS/WebSystem/Nls","WebappsUtils/WebappsUtils"],function(e,t,i,n,a,s,r){"use strict";return t.extend({init:function(e){this._parent(e),this.margin=e.margin||10,this._isLODActive=!1,this._nextRender=null,this._isRenderInProgress=!1},loadAsset:function(e){var t="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(e.asset.asset)));this.asset=e.asset,this.status=e.status,this.useLOD=e.useLOD;var n=new Image;n.width=5*this.asset.width,n.height=5*this.asset.height;var a=this;n.onload=function(){a.asset.image=n,a._scaleAndRender({scale:1,isForThumb:!0,OnComplete:function(){e.doneCB&&("ie"===i().browser.name?e.doneCB(n,t):e.doneCB(n,a.canvas.toDataURL("image/png")))}})},n.onerror=function(){this.specialViews.show.error()}.bind(this),n.src=t},_scaleAndRender:function(e){if(void 0===this.asset||null===this.asset||null==this.asset.image||null==this.asset.image)return this._nextRender=null,this.specialViews.show.failed(),options.OnComplete(!0),!0;var t=this.asset.width*e.scale,i=this.asset.height*e.scale;if(this.useLOD&&!0!==e.isForThumb)this._nextRender=null,this.thumbnail?this.specialViews.show.thumbnail():this.specialViews.show.loading(),e.OnComplete&&e.OnComplete(!0);else if(this.canvas.width=t||this.container.offsetWidth,this.canvas.height=i||this.container.offsetHeight,!1===this._isRenderInProgress){this._isRenderInProgress=!0;var n=this.canvas.getContext("2d");this.asset.image?(!0===e.isForThumb&&(n.fillStyle="#FFFFFF",n.fillRect(0,0,t,i)),n.drawImage(this.asset.image,0,0,t,i)):console.error("No image: render skipped."),this._isRenderInProgress=!1,this._nextRender?(this._scaleAndRender(this._nextRender),this._nextRender=null):e.OnComplete&&e.OnComplete(!1)}else this._nextRender=e;return!0},dispose:function(){}})});