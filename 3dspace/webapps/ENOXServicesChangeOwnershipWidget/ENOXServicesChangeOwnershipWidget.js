define("DS/ENOXServicesChangeOwnershipWidget/ENOXServicesCOModel/ENOXServicesCOSelectedItem",["UWA/Controls/Abstract"],function(e){"use strict";return e.extend({init:function(e){for(var t in this.physicalId="",this.urlIcon="",this.name="",this.type="",this.category="",this.isTOSSelectedItem=!0,e)this[t]=e[t]},getPhysicalId:function(){return this.physicalId},getUrlIcon:function(){return this.owner},getName:function(){return this.name},getType:function(){return this.type},getCategory:function(){return this.category}})}),define("DS/ENOXServicesChangeOwnershipWidget/ENOXServicesChangeOwnershipConstant",[],function(){"use strict";return{TransferPerson:"Person"}}),define("DS/ENOXServicesChangeOwnershipWidget/component/ENOXServicesChangeOwnershipWidget",["UWA/Core","UWA/Controls/Input","UWA/Controls/Abstract","UWA/Json","DS/PlatformAPI/PlatformAPI","DS/WAFData/WAFData","DS/ENOXServicesChangeOwnershipWidget/ENOXServicesChangeOwnershipConstant","DS/SearchWidget/SearchWidget","DS/SearchWidget/SearchWidgetConstant","DS/ErrorWidget/ErrorWidget","DS/WidgetServices/WidgetServices","DS/WidgetServices/securityContextServices/SecurityContextServices","DS/WarningWidget/WarningWidget","DS/MVAInput/searchPeopleInput/MVASearchPeopleInput","DS/ENOXServicesChangeOwnershipWidget/ENOXServicesCOModel/ENOXServicesCOSelectedItem","DS/UIKIT/Input/Button","DS/UIKIT/Input/Select","DS/UIKIT/Spinner","DS/UIKIT/Input/ButtonGroup","DS/UIKIT/Modal","DS/UIKIT/Input/Toggle","DS/UIKIT/Input/Text","DS/UIKIT/Scroller","DS/Controls/Toggle","text!DS/ENOXServicesChangeOwnershipWidget/assets/ENOXServicesChangeOwnershipSettings.json","css!DS/ENOXServicesChangeOwnershipWidget/ENOXServicesChangeOwnershipWidget.css","i18n!DS/ENOXServicesChangeOwnershipWidget/assets/nls/ENOXServicesCONls","DS/ReportingPanel/ReportingPanel"],function(e,t,n,i,s,r,a,o,c,h,l,d,u,p,g,m,f,S,O,v,T,C,w,I,W,y,E,A){"use strict";var _=l.getProdLevel(),D="RDFCO_MasterContain";UWA.i18n("TOS_SelectedItems");return n.extend({itemListHasPriority:!1,defaultOptions:{className:"",context:null,ForbiddenChar:'"#$@%*,?\\<>[]|:',showTopBar:!0,setCloseButton:!1,topClassHeight:D,transferType:a.TransferFull,launchTransfer:!0,genericTransfer:!1,serverName:"",serverUri:"",activeAdminCheckBox:!1,model:!0,wintop:!1,odtMode:!1,searchSource:"3dspace"},init:function(e){this.defaultOptions.activeAdminCheckBox=widget.getBool("admin"),_=l.getProdLevel(),this.SelectedItems=[],this.listOfIds=[],this.listOfIdsWithData=JSON.parse("[]"),this.isHiddenResponsibleSearch=!0,this._parent(e),this.isCSE=!1,this.searchSection=null,this.searchOwnerTitle=null,this.searchWidget=null,this.hideProject=!1,this.hideOrg=!1,this.changeOwnerToggle=null,this.addMsgToggle=null,this.commentBox=null,this.textArea=null,this.listOfInvalidIds=null;E.get("TOS_Panel_Status");var t=E.get("TOS_Panel_Title"),n=(E.get("TOS_Panel_Revision"),E.get("TOS_Panel_Responsible")),i=E.get("TOS_Panel_CompletionStatus");this.options.searchSource||(this.options.searchSource="3dspace"),this.cols=[{text:"ID",dataIndex:"ID",isHidden:!0},{text:E.TOS_STATUS,dataIndex:"Status",typeRepresentation:"icon"},{text:t,dataIndex:t},{text:n,dataIndex:n},{text:i,dataIndex:i},{text:"StatusToolTipColumn",dataIndex:"statusTooltip",isHidden:!0,tooltipColumn:"Status"}],this._initUI()},onRefresh:function(){},_IsDisableApply:function(){return null==this.searchWidget.getNewOwner().person&&""!==this.searchWidget.container.searchInput.elements.content.value},_initUI:function(){var e=this,t=this.container=UWA.createElement("div",{name:D,class:D+" "+e.options.className,id:D});this.globalDiv=UWA.createElement("div",{class:"RDFCO_GlobalContain",id:"RDFCO_GlobalContain"}).inject(t),this.ManageButtonDiv=UWA.createElement("table",{class:"RDFCO_ManageButtonDiv",html:{}}),e.ManageButtonRight=UWA.createElement("td",{class:"RDFCO_ManageButtonRight"}),e.ManageButtonLeft=UWA.createElement("td",{class:"RDFCO_ManageButtonLeft"});var n=null;n=this.options.transferType==a.TransferPerson?E.get("TOS_ChangeOwner"):E.get("TOS_moveTitle");var i=null;e.boutonValid=new m({attributes:{title:UWA.i18n("")},name:"TopButtonValid",value:UWA.i18n(n),className:"default medium TOS_buttonTop primary",disabled:!0}),i=new m({attributes:{title:UWA.i18n("")},name:"TopButtonCancel",value:UWA.i18n("TOS_Cancel"),className:"default medium TOS_buttonTop"}),e.boutonValid.addEvents({onClick:function(){i.setValue(UWA.i18n("Close")),e._prepareTransferOwnership(),this.setDisabled(!0)}}),i.addEvents({onClick:function(){null!=e.table&&e.table.clearAllLine(),e.dispatchEvent("onCancel")}}),e.boutonValid.inject(e.ManageButtonRight),0!=this.options.setCloseButton&&i.inject(e.ManageButtonRight),e.ManageButtonLeft.inject(this.ManageButtonDiv),e.ManageButtonRight.inject(this.ManageButtonDiv),!0===e.options.showTopBar&&this.ManageButtonDiv.inject(e.globalDiv),this.mainDiv=UWA.createElement("div",{class:"RDFCO_MainContain"}).inject(e.globalDiv),e.mainInterface=UWA.createElement("div",{class:"RDFCO_MainInterface"}).inject(this.mainDiv).hide(),e.mainLoading=UWA.createElement("div",{class:"RDFCO_MainLoading"}).inject(this.mainDiv),e.mainError=UWA.createElement("div",{class:"RDFCO_MainError"}).inject(this.mainDiv).hide(),e.loadingArea32=new S({visible:!0,className:"large"}),e.loadingArea32.inject(e.mainLoading),e.itemsArea=new UWA.createElement("span",{class:"TOS_itemsList"}),e.itemsArea.inject(e.mainInterface),e.table=null,e.errorOverlay=new h(widget,e.container,{className:"errorComponent_TransferOwnership"});var s=UWA.i18n("TOS_ownerTitle");e.titleTargetOwnership=UWA.createElement("h5",{class:"TOS_SelectedItemTitle",html:s}),e.titleTargetOwnership.hide(),e.searchWidgetContainer=UWA.createElement("div",{class:"RDFCO_searchWidgetContainer"}).inject(this.mainInterface);var r=e.options.ForbiddenChar;c.TYPE_PERSON;1==this.options.activeFirstLineTable&&c.TYPE_FULL;var l={user:"",org:"",collabSpace:""};switch(this.options.transferType){case a.TransferPerson:c.TYPE_PERSON}var d=UWA.createElement("div",{class:"RDFCO_SearchSectionOwner"});e.searchSection=d;E.get("TOS_ownerTitle");var u=o.FULL;switch(e.titleTargetOwnership.inject(e.searchSection),e.titleTargetOwnership.show(),e.searchWidget=o.getSearchWidget(u,{className:"searchPeople_TransferOwnership",ForbiddenChar:r,MaxNumber:"5",MaxSize:"300",position:"auto",serverName:this.options.serverName,serverUri:this.options.serverUri,showEmptyCategory:!1,hint:UWA.i18n("Search Responsible"),methodType:"PUT",urlService:"/resources/v1/collabServices/base/transferOwnership/canUserChangePOV_ChecksWithUserQuery/"+c.TYPE_PERSON,type:c.TYPE_PERSON,FED:!0,IsMoveSearch:!0,searchSource:this.options.searchSource,webParams:{getQueryParams:function(){return l}},events:{onValid:function(){e.searchWidget.getNewOwner();e._ManageValidButton(!0)},onUnvalid:function(){e._ManageValidButton(!1)},onError:function(t){e.setError(t)}}}),e.searchWidget.inject(d),d.inject(e.searchWidgetContainer),e.marginAfterSearchUser=UWA.createElement("div",{class:"RDFCO_ownerMarginCorrector"}).inject(this.searchWidgetContainer),this.options.transferType){case a.TransferPerson:e.hideProject=!0,e.hideOrg=!0}e.marginAfterOwnerCheckBox=UWA.createElement("div",{class:"RDFCO_ownerMarginCorrector"}).inject(this.searchWidgetContainer);var p=UWA.i18n(E.get("TOS_TitleComment"));e.options.transferType!=a.TransferPerson?(e.addMsgToggle=new I({type:"checkbox",label:p,checkFlag:!1,class:"TOS_SelectedItemTitle"}),e.addMsgToggle.addEventListener("buttonclick",function(t){1==t.dsModel.checkFlag?e.commentBox.show():e.commentBox.hide()}),e.addMsgToggle.inject(e.searchWidgetContainer)):e.commentTitle=UWA.createElement("h5",{class:"TOS_SelectedItemTitle",html:p}).inject(e.searchWidgetContainer),e.commentBox=UWA.createElement("div",{class:"RDFCO_CommentBox"}).inject(this.searchWidgetContainer),e.textArea=new C({multiline:!0,placeholder:UWA.i18n(E.get("TOS_Comment")),rows:2,ForbiddenChar:r}),e.textArea.inject(e.commentBox)},destroy:function(){this.searchWidget&&this.searchWidget.destroy(),this._parent()},_setListOfIds:function(e,t){this.listOfIds.push(e)},_getListOfIds:function(){return this.listOfIds},_getTransferData:function(){var e=null,t={};null!=this.searchWidget&&(t=i.decode(i.encode(this.searchWidget.getNewOwner()))),t.hasOwnProperty("person")&&(t.person.personID=t.person.personID.replace(/_PRJ$/,""));var n=this.textArea.elements.container.value;t.comment=n;var s,r=[];s=this._getListOfIds();for(var a=0;a<s.length;a++)r.push({id:s[a].id});return e={tosBusinessObject:r=this._removeDuplicateItemsToMove(r),owner:t,options:{}},0==r.length&&(this.boutonValid.setDisabled(!0),e=""),e},_isItemInItemsToMoveList:function(e,t){for(var n=t.length,i=0;i<n;i++){var s=t[i];if(s.id==e.id&&s.category==e.category)return!0}return!1},getTenantFromOptions:function(e){var t=e?e.tenant:null;return t=t||l.getTenantID()},getSourceFromOptions:function(e){return e?e.source:"3DSpace"},_removeDuplicateItemsToMove:function(e){for(var t=[],n=e.length,i=0;i<n;i++){var s=e[i];this._isItemInItemsToMoveList(s,t)||t.push(s)}return t},_prepareTransferOwnership:function(){var e=this._getTransferData();""!=e&&this._transferOwnership(e)},_commitTransferOwnership:function(e){this.dispatchEvent("onTransferStart");var t=this,n="",s=(this.options.serverName,this.options.serverUri,this.options.launchTransfer),r="",a="";e[0].hasOwnProperty("owner")&&e[0].owner.hasOwnProperty("person")&&(r=e[0].owner.person.personFullName,a=e[0].owner.person.personID),l.getSourceUrlAsync({platformId:t.getTenantFromOptions(t.options),source:t.getSourceFromOptions(t.options),onComplete:function(o){if(!t.options.transferWebServiceURL)return!1;var c,h={Accept:"application/json"};c=t.options.transferWebServiceURL,h["content-type"]="application/json",t.options.securityContext&&(h.SecurityContext=encodeURIComponent(t.options.securityContext)),h["Accept-Language"]=l.getLanguage(),"3DSpace"!=t.getSourceFromOptions(t.options)&&(h["X-Requested-With"]="XMLHttpRequest"),n=l.getRealPath("assets/transferOwnership.json",widget);var d="",u="GET",p="";null!=t.adminCheckBox&&t.adminCheckBox.isChecked(),2==_&&(n=o+c+"?",p="passport",u="PUT",d=i.encode({requests:e}));var g="";e.length>0&&(g=e[0].owner);var m={requests:e,owner:g};if(t.dispatchEvent("onValidation",m),!0===s){t.displayLoadingArea();var f=l.getTenantID();f&&(n+="&tenant="+f),l.partitionedAuthenticatedRequest(n,{type:"json",method:u,proxy:p,headers:h,maxChunkSize:19,cancelCallback:function(){return!1},partisionedProgressLabel:E.get("TOS_UpdatingOwnership"),progressBarContext:t.ManageButtonLeft,progressBarWaitContext:t.container,data:d,timeout:36e5,onComplete:function(e){t._onSucceedGenericTransfer(e,r,a)},onFailure:function(e,n,i){t._onFailure(e,n,i)},onTimeout:function(e){t._onTimeout()}})}}})},_transferOwnership:function(e){this._goTransferOwnership(e)},_goTransferOwnership:function(e){if(!0!==this.options.genericTransfer);else{for(var t=[],n=0;n<e.tosBusinessObject.length;n++){var i=[];i.push(e.tosBusinessObject[n]),t.push({tosBusinessObject:i,owner:e.owner,comment:this.textArea.elements.container.value,options:{}})}this._commitTransferOwnership(t)}},_onTimeoutTOS:function(e){if(e){this.dispatchEvent("onTransferFail"),this.hideLoadingArea();var t={message:UWA.i18n("ErrorTimeOutTOS"),code:"TO"};this.setError(t)}else this._onTimeout()},_onSucceedGenericTransfer:function(e,t,n){var i=[],s=[];e.results&&e.results.forEach(function(e){if(e.status>=200&&e.status<306){if(null==e.body.sameOwner){var t=null;if(e.body&&e.body.errors){var n=e.body.errors.length;n>0&&(t=e.body.errors[n-1])}if(t)i.push(e.body.physicalid),i.push("Failed"),i.push(e.body.Title),i.push(e.body.Responsible),i.push(t.message),s.push(i);else{i.push(e.body.physicalid),i.push("Success"),i.push(e.body.Title),i.push(e.body.Responsible);var r=E.get("TOS_SuccessStatus");i.push(r),s.push(i)}}}else if(500==e.status&&e.body&&e.body.errors&&e.body.physicalid){e.body.physicalid,t={message:UWA.i18n("cannot move selection"),code:"ERROR"};i.push(e.body.physicalid),i.push("Failed"),i.push(e.body.Title),i.push(e.body.Responsible),i.push(t.message),s.push(i)}return!0}),A.launchReportingPanel(s,this.cols,null),this.dispatchEvent("onCancel"),this._notifyTransferSucceed(e)},_notifyTransferSucceed:function(e){this.hideLoadingArea();var t=[],n={};null!=e&&void 0!==e&&Array.isArray(e)&&e.forEach(function(e){var i=null;e.body&&(i=e.body),t.push(i.physicalid),"PRIVATE"==i.current||"#DENIED!"==i.current?n[i.physicalid]={id:i.physicalid,newOwnerFullName:i.Responsible,newOwnerId:i.ownerId,error:!1,removeFromUI:!0}:i.hasOwnProperty("error")&&null!=i.error&&(0==i.error?n[i.physicalid]={id:i.physicalid,newOwnerFullName:i.Responsible,newOwnerId:i.ownerId,error:!1,removeFromUI:!1}:n[i.physicalid]={id:i.physicalid,newOwnerFullName:i.Responsible,newOwnerId:i.ownerId,error:!0,removeFromUI:!1})});var i=Math.floor(Date.now());s.publish("DS/Object/update",{metadata:{appId:widget.id,appName:widget.name,timestamp:i,options:{force:!0}},data:{paths:t,attributes:n},version:"1.0"}),s.publish("ENOLC_MOVE_CMD_UPDATE",{metadata:{appId:widget.id,appName:widget.name,timestamp:i,options:{force:!0}},data:{paths:t,attributes:n},version:"1.0"}),this.container.setStyle("opacity","1"),this.dispatchEvent("onTransferSucceed"),this.container.setStyle("opacity","1"),this.dispatchEvent("onTransferFail")},getTopBar:function(){return this.ManageButtonDiv},onResize:function(){this.container.getSize(),this.mainInterface.getSize();null!==this.searchSection&&(this.searchWidget&&this.searchWidget.hasOwnProperty("hiddenUser")||(this.searchSection.setStyle("width","100%"),this.searchSection.setStyle("display","block")))},_ManageValidButton:function(e){var t=e;null==e&&(t=!1),t?this.boutonValid.setDisabled(!1):this.boutonValid.setDisabled(!0)},initData:function(e){this.SelectedItems=[],this._addData(e)},_addData:function(e){this.hideMainErrorArea();var t=[],n=this;null!=e&&(t=e.slice()),(t=l.removeDuplicate(t,function(e){return e.physicalid})).forEach(function(e){var t=new g(e),i=l.arrayContains(n.SelectedItems,t,function(e){return e.physicalid});n.listOfIdsWithData[e.physicalid]=e,i<0&&n.SelectedItems.push(t)}),this.displayMainLoadingArea(),this._AddSelectedItem(n.SelectedItems),this.displayMainInterfaceArea();var i=[];n.SelectedItems.forEach(function(e){i.push({objectID:e.getPhysicalId()}),n.listOfIds.push({id:e.getPhysicalId()})}),null!=this.searchWidget&&this.searchWidget.setSelectedItemList(i),this.onResize()},_AddSelectedItem:function(e){this._setTitle()},_setTitle:function(){var e=1,t="";this.SelectedItems&&this.SelectedItems.length>1?e=this.SelectedItems.length:this.SelectedItems&&1==this.SelectedItems.length&&(t=" - "+this.SelectedItems[0].Title);var n="";n+=UWA.i18n("ChangeResp_mainTile"),0==e?this.itemsArea.hide():1==e?(this.itemsArea.hide(),n+=t):(this.itemsArea.hide(),n+=" - "+e+" "+UWA.i18n("TOS_Objects")),this.dispatchEvent("onTitleChange",n)},setError:function(e){this.addError(e)},addError:function(e){if(null!=this.errorOverlay&&e&&e.hasOwnProperty("message")){UWA.i18n(e.message);this.errorOverlay.displayJSONError(i.encode(e))}},displayLoadingArea:function(){null!=this.loadingArea&&this.loadingArea.show()},hideLoadingArea:function(){null!=this.loadingArea&&this.loadingArea.hide()},displayMainInterfaceArea:function(){this.hideAllAreas(),null!=this.mainInterface&&this.mainInterface.show(),null!=this.boutonValid&&this.boutonValid.show()},displayMainLoadingArea:function(){this.hideAllAreas(),null!=this.mainLoading&&this.mainLoading.show()},hideMainComponent:function(){this.hideLoadingArea(),null!=this.mainInterface&&this.mainInterface.hide(),null!=this.boutonValid&&this.boutonValid.hide()},hideMainLoadingArea:function(){null!=this.mainLoading&&this.mainLoading.hide()},hideMainErrorArea:function(){null!=this.mainError&&this.mainError.hide()},hideAllAreas:function(){this.hideMainLoadingArea(),this.hideMainComponent()},_onFailure:function(e,t,n){this.dispatchEvent("onTransferFail"),this.hideLoadingArea();var s={};i.isJson(t)&&(t=i.decode(t)),s=null!=t&&t.hasOwnProperty("error")?t.error:{message:UWA.i18n("UnknownError"),code:"ERROR"},this.setError(s)},_onTimeout:function(){this.dispatchEvent("onTransferFail"),this.hideLoadingArea();var e={message:UWA.i18n("ErrorTimeOut"),code:"TO"};this.setError(e)}})}),define("DS/ENOXServicesChangeOwnershipWidget/ENOXServicesChangeOwnershipWidget",["DS/ENOXServicesChangeOwnershipWidget/component/ENOXServicesChangeOwnershipWidget"],function(e){}),define("DS/ENOXServicesChangeOwnershipWidget/popup/ENOXServicesChangeOwnershipPopup",["UWA/Controls/Abstract","DS/ENOXServicesChangeOwnershipWidget/component/ENOXServicesChangeOwnershipWidget","DS/ENOXServicesChangeOwnershipWidget/ENOXServicesChangeOwnershipConstant","DS/ENOFloatingPanel/ENOFloatingPanel","css!DS/ENOXServicesChangeOwnershipWidget/ENOXServicesChangeOwnershipWidget.css"],function(e,t,n,i){"use strict";return e.extend({defaultOptions:{className:"",context:null,ForbiddenChar:'"#$@%,?\\<>[]|:',transferType:n.TransferFull,serverName:"",serverUri:"",launchTransfer:!0,genericTransfer:!1,activeAdminCheckBox:!1,removeAtClose:!0,odtMode:!1,serviceUrl:""},init:function(e,t){this.defaultOptions.activeAdminCheckBox=widget.getBool("admin"),this._parent(t),this.initUI(e)},onRefresh:function(){null!=this.TOSWidget&&this.TOSWidget.onRefresh()},onResize:function(){null!=this.TOSWidget&&this.TOSWidget.onResize()},actionOnMove:function(){this.TOSWidget},destroy:function(){this.TOSWidget&&this.TOSWidget.destroy(),this._parent()},initUI:function(e){var n=this;n.widgetPere=e,n.TOSWidget=new t({className:"ENOXServicesChangeOwnership_innerComponent",context:n.options.context,ForbiddenChar:n.options.ForbiddenChar,setCloseButton:!0,showTopBar:!1,transferType:n.options.transferType,launchTransfer:n.options.launchTransfer,genericTransfer:n.options.genericTransfer,topClassHeight:"RDFCO_PopupDial",serverName:this.options.serverName,serverUri:this.options.serverUri,activeAdminCheckBox:this.options.activeAdminCheckBox,odtMode:this.options.odtMode,transferWebServiceURL:this.options.transferWebServiceURL,source:this.options.source,searchSource:this.options.searchSource,securityContext:this.options.securityContext,events:{onNewSize:function(e){n.container.setNewBodySize({width:null,height:e.height});var t=n.container.getContainerHeight();t=t>460?460:t,n.container.setNewSize({height:t}),n.container.lockWidth()},onCancel:function(){n._close(),n.dispatchEvent("onCancel")},onValidation:function(e){n.dispatchEvent("onValidation",e)},onTitleChange:function(e){n.container.setTitle(e)}}}),n.container=new i({title:"ENOVIA",className:"RDFCO_PopupDial "+this.options.className,footer:n.TOSWidget.getTopBar(),body:n.TOSWidget,overlay:!0,closable:!0,animate:!0,resizable:!0,events:{onResizeFloating:function(){n.onResize(),n.actionOnMove(),n.container._minHeight=350},onMove:function(){n.actionOnMove()},onClose:function(){n._close()},onHide:function(){n._close()}}}),n.container.inject(e);var s=e.offsetHeight>500?500:e.offsetHeight;n.container.setNewSize({height:s})},centerIt:function(){this.container.centerIt()},show:function(e){this.container.show(),this.TOSWidget.initData(e)},close:function(){this.container.hide(),!0===this.options.removeAtClose&&this.destroy()},_close:function(){this.dispatchEvent("onClose"),this.close()}})});