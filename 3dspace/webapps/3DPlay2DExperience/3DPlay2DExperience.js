var scrollHandleTopPosLimit;define("DS/3DPlay2DExperience/Commands/CmdDownloadPDF",["DS/ApplicationFrame/Command","DS/WebUtils/Tracker","DS/3DPlayConnectors/3DPlayInputPreProcessor"],function(e,t,i){"use strict";return e.extend({init:function(e){this._parent(e,{isAsynchronous:!1})},execute:function(){t.command(this.getId());var e=this.getFrameWindow();if(e){var n=e.experience,s=function(e){e.filename&&(e.filename.startsWith("http")||e.filename.startsWith("https"))?window.open(e.filename,"_blank"):window.open(e.url,"_blank")};if(n&&n.args&&n.args.input&&n.args.input.asset&&"FILE"===n.args.input.asset.provider&&"pdf"===n.args.input.asset.type)if(n.args.input.asset.originalAsset)(new i).run(n.args.input.asset.originalAsset,function(e){s(e.asset)});else n.loadAssetInfo&&n.loadAssetInfo.originalAsset?s(n.loadAssetInfo.originalAsset):s(n.args.input.asset)}}})}),define("DS/3DPlay2DExperience/Commands/CmdScrollingView",["DS/ApplicationFrame/Command","DS/WebUtils/Tracker"],function(e,t){"use strict";return e.extend({init:function(e){this._parent(e,{isAsynchronous:!1})},execute:function(){t.command(this.getId()),this.getFrameWindow().getViewer().launchScrollingView()}})}),define("DS/3DPlay2DExperience/Commands/CmdPresentationView",["DS/ApplicationFrame/Command","DS/WebUtils/Tracker"],function(e,t){"use strict";return e.extend({init:function(e){this._parent(e,{isAsynchronous:!0})},execute:function(){t.command(this.getId()),this.getFrameWindow().getViewer().launchPresentationView()}})}),define("DS/3DPlay2DExperience/Commands/CmdScrollSheet",["DS/ApplicationFrame/Command"],function(e){"use strict";return e.extend({init:function(e){for(var t in this._parent(e,{isAsynchronous:!1}),e.arguments)"Scroll"==e.arguments[t].ID&&(this.scrollDir=e.arguments[t].Value)},execute:function(){"Previous"===this.scrollDir?this.getFrameWindow().getViewer().goToPreviousPage():"Next"===this.scrollDir&&this.getFrameWindow().getViewer().goToNextPage()}})}),define("DS/3DPlay2DExperience/Commands/CmdSearch",["DS/ApplicationFrame/Command","DS/WebUtils/Tracker"],function(e,t){"use strict";return e.extend({init:function(e){this._parent(e,{isAsynchronous:!0}),this.frmWindow=this.getFrameWindow()},beginExecute:function(){this.frmWindow.getViewer().passAnnotDataForSearch(),t.startCommand(this.getId());var e=this.getFrameWindow().getActionBar();e.close();var i=e.onActionBarOpen(function(){e.removeCallback(i),this.end()}.bind(this));this.viewer=this.getFrameWindow().getViewer(),this.getFrameWindow().experience.publish("3DPLAY/2D/TEXT_SEARCH/BEGIN"),this.getFrameWindow().getViewer().showSearchPanel(),this.viewer.disableNavigationKeyboardEvents()},endExecute:function(){t.endCommand(this.getId()),this.getFrameWindow().getActionBar().open(),this.getFrameWindow().getViewer().hideSearchPanel(),this.getFrameWindow().experience.publish("3DPLAY/2D/TEXT_SEARCH/END"),this.viewer.enableNavigationKeyboardEvents(),this.viewer=void 0}})}),define("DS/3DPlay2DExperience/Commands/CmdFullSize",["DS/ApplicationFrame/Command","DS/WebUtils/Tracker"],function(e,t){"use strict";return e.extend({init:function(e){this._parent(e,{isAsynchronous:!1})},execute:function(){t.command(this.getId()),this.getFrameWindow().getViewer().zoomfullSize()}})}),define("DS/3DPlay2DExperience/Commands/CmdRotate",["DS/ApplicationFrame/Command"],function(e){"use strict";return e.extend({init:function(e){for(var t in this._parent(e,{isAsynchronous:!1}),e.arguments)"Rotate"==e.arguments[t].ID&&(this.rotateDir=e.arguments[t].Value)},execute:function(){"Clockwise"===this.rotateDir?this.getFrameWindow().getViewer().rotateViewClockwise():"AntiClockWise"===this.rotateDir&&this.getFrameWindow().getViewer().rotateViewAntiClockwise()}})}),define("DS/3DPlay2DExperience/DocumentViewer/DragGestureCustom3DPlay",["DS/Gestures/DragGesture"],function(e){"use strict";return e=e.extend({init:function(){return this._parent(),this.minDistance=1,this}})}),define("DS/3DPlay2DExperience/Commands/CmdFitDocument",["DS/ApplicationFrame/Command","DS/WebUtils/Tracker"],function(e,t){"use strict";return e.extend({init:function(e){this._parent(e,{isAsynchronous:!1})},execute:function(){t.command(this.getId()),this.getFrameWindow().getViewer().fitDocument()}})}),define("DS/3DPlay2DExperience/Commands/CmdBackground",["DS/ApplicationFrame/Command"],function(e){"use strict";return e.extend({init:function(e){this._parent(e,{isAsynchronous:!1})},execute:function(){this.getFrameWindow().getViewer()&&this.getFrameWindow().getViewer().getDocContainer()&&(this.getFrameWindow().getViewer().getDocContainer().style.backgroundImage="",this.getFrameWindow().getViewer().getDocContainer().style.backgroundColor=this.background,this.getFrameWindow().getViewer().setBackgroundColor(this.background))}})}),define("DS/3DPlay2DExperience/DocumentViewer/LoadingQueue",[],function(){"use strict";return function(){var e=20,t=[],i=!1,n=!1;this.push=function(i){t.length<e&&t.push(i)},this.start=function(){var e=function(){if(n||0===t.length)i=!1;else if(t.length>0){var s=t.shift();s&&s.load(e)}};i||(i=!0,e())},this.isRunning=function(){return i},this.stop=function(){n=!0},this.isFull=function(){return t.length===e},this.setMaxCapacity=function(t){t>0&&(e=t)}}}),define("DS/3DPlay2DExperience/Commands/CmdZoom",["DS/ApplicationFrame/Command"],function(e){"use strict";return e.extend({init:function(e){for(var t in this._parent(e,{isAsynchronous:!1}),e.arguments)"Scale"===e.arguments[t].ID&&(this.scaleMode=e.arguments[t].Value);this.getFrameWindow().experience.subscribe("3DPLAY/2DEXP/ZOOM",function(){this.disable()}.bind(this),!0)},execute:function(e){"+"===this.scaleMode?this.getFrameWindow().getViewer().zoomIn():"-"===this.scaleMode&&this.getFrameWindow().getViewer().zoomOut()}})}),define("DS/3DPlay2DExperience/Commands/CmdToggleView",["DS/ApplicationFrame/CommandCheckHeader","DS/WebUtils/Tracker"],function(e,t){"use strict";return e.extend({init:function(e){this._parent(e,{}),this.onStateChange(function(){t.command(this._id),this.getState()?!0===this.getFrameWindow().getActionBar().MAB.state.visible?this.getFrameWindow().getViewer().showOnlyNavigationPanel():this.getFrameWindow().getViewer().showBothViewerAndNavigationPanel():this.getFrameWindow().getViewer().showOnlyViewer()}.bind(this))}})}),define("DS/3DPlay2DExperience/DocumentLoader/DocumentLoader",["UWA/Class","DS/WebSystem/Settings","DS/WebUtils/Network"],function(e,t,i){"use strict";return e.extend({init:function(e){this.onLoadingStart=e.events.onLoadingStartCB,this.onLoadingProgress=e.events.onLoadingProgressCB,this.onLoadingEnd=e.events.onLoadingEndCB,this.onLoadingFail=e.events.onLoadingFailCB,this.isMobile=e.isMobile,this.frameWindow=e.frameWindow,this.DEBUG_TRACES_LOGGING_ENABLED=t.get("3DPlay.EnableDebugTracesLogging"),this._parent(e)},downloadDocumentInBuffer:function(e){var t=this.frameWindow.experience,n=e.asset.requestsOptions||{proxy:"none"};n.type=e.responseType,n.onComplete=e.onDownloadingEnd,this.onLoadingProgress&&(t.donwlonadProgress||(t.donwlonadProgress=t.getPhaseProgress().registerSubProgress()),n.onProgress=function(e){this.onLoadingProgress({loaded:e.loaded,total:e.total})}.bind(this)),n.onStatistics=function(e){this.statistics.DownloadSize=e.DownloadSize}.bind(this),this.statistics=this.statistics||{},this.statistics.DownloadSize=0,e.onDownloadingStart(),i.handleRequest(e.asset.filename||e.asset.url,n,"Download")},isMobile:function(){return this.isMobile}})}),define("DS/3DPlay2DExperience/Commands/CmdFitWidth",["DS/ApplicationFrame/Command","DS/WebUtils/Tracker"],function(e,t){"use strict";return e.extend({init:function(e){this._parent(e,{isAsynchronous:!1})},execute:function(){t.command(this.getId()),this.getFrameWindow().getViewer().fitWidth()}})}),define("DS/3DPlay2DExperience/DocumentLoader/Document",["UWA/Class","DS/WebUtils/ProbesManager"],function(e,t){"use strict";return e.extend({init:function(e){this.src=e.src,this.pagesCount=e.pagesCount,this.pages=[],this.DOC_WIDTH=0,this.DOC_HEIGHT=0,this.isMobile=e.isMobile},_load:function(e,i){this.load(e,t.createFunctionProbe("Load_Session",i))},getPage:function(e){return e>=0&&e<this.pages.length?this.pages[e]:null},getPages:function(){return this.pages},dispose:function(){for(var e=0;e<this.pages.length;e++){var t=this.pages[e];t&&t.dispose&&t.dispose()}}})}),define("DS/3DPlay2DExperience/DocumentViewer/BaseComponent",["UWA/Class"],function(e){"use strict";return e.extend({init:function(e){if(this._parent(e),this.context=e.context,!e.onUpdate)throw new Error("onUpdate callback not passed in input");this.publishUpdate=e.onUpdate},update:function(){throw new Error("Derived class has not implemented the method")},dispose:function(){throw new Error("Derived class has not implemented the method")},checkContext:function(e){let t;return e.target?t=e.target.getAttribute("context")?e.target.getAttribute("context"):e.target.parentElement?e.target.parentElement.getAttribute("context"):"":e.gesture&&(t=e.gesture.events[0].event.target.getAttribute("context")),!this.context||this.context==t}})}),define("DS/3DPlay2DExperience/Commands/CmdSinglePageView",["DS/ApplicationFrame/Command","DS/WebUtils/Tracker"],function(e,t){"use strict";return e.extend({init:function(e){this._parent(e,{isAsynchronous:!1})},execute:function(){t.command(this.getId()),this.getFrameWindow().getViewer().launchSinglePageView()}})}),define("DS/3DPlay2DExperience/DocumentViewer/TextSearch",[],function(){"use strict";return{onmessage:function(e){var t=function(e,t){for(var n=[],s=0;s<e.length;s++){var o=i(e[s].fullPageText,t);if(o.length>0)for(var a=0;a<o.length;a++){for(var r=0,h=[],l=!1,c=!1,d=0;d<e[s].textElementsArray.length;d++)if((r+=e[s].textElementsArray[d].length)>o[a]){var u=d,g=l?0:e[s].textElementsArray[d].length-(r-o[a]),p=0;if(r>=o[a]+t.length?(p=l?e[s].textElementsArray[d].length-(r-(o[a]+t.length)):Math.min(t.length,r-o[a]),c=!0):(l=!0,p=e[s].textElementsArray[d].length),h.push({textElemIndex:u,offset:g,length:p}),c)break}n.push({pageIndex:s,searchResults:h})}}return n},i=function(e,t){let i=e.toLowerCase(),n=t.toLowerCase();for(var s=[],o=0;-1!==(o=i.indexOf(n));){let e=s.length>0?s[s.length-1]+n.length:0;s.push(o+e),i=i.substring(o+n.length)}return s};if(e.data.srcData){this.sourceMap||(this.sourceMap={}),this.tempList=[];for(let t=0;t<e.data.srcData.length;t++)this.tempList.push({textElementsArray:e.data.srcData[t],fullPageText:e.data.srcData[t].join("")});this.sourceMap[e.data.name]=this.tempList}else if(e.data.textToSearch){let i={};for(let n of Object.keys(this.sourceMap)){let s=[];for(let i=0;i<e.data.textToSearch.length;i++)s=s.concat(t(this.sourceMap[n],e.data.textToSearch[i]));s.length>=1&&(i[n]=s)}postMessage(i)}}}}),define("DS/3DPlay2DExperience/DocumentViewer/PageView",["UWA/Class","DS/WebappsUtils/WebappsUtils","DS/3DPlayAnnotationUtils/CanvasShapes","DS/WebSystem/Environment","DS/WebUtils/GeometryUtils","DS/WebUtils/Vector2"],function(e,t,i,n,s,o){"use strict";var a="url("+t.getWebappsBaseUrl()+"3DPlay2DExperience/assets/images/sheet_loading.gif)";return e.extend({init:function(e){this.frameWindow=e.frameWindow,this.pageInfo=e.pageInfo,this.onSelectCB=e.onSelectCB,this.onAnnotationUpdateCB=e.onAnnotationUpdateCB,this.onHyperlinkClickCB=e.onHyperlinkClickCB,this.context=e.context,this.index=this.pageInfo.getIndex(),this.isRenderRequired=!0,this.originalTop=0,this.originalWidth=0===e.angle||180===e.angle?this.pageInfo.getOriginalWidth():this.pageInfo.getOriginalHeight(),this.originalHeight=0===e.angle||180===e.angle?this.pageInfo.getOriginalHeight():this.pageInfo.getOriginalWidth(),this.aspectRatio=this.originalWidth/this.originalHeight,this.annotationList=e.annotations||{},this.annotListAfterRotation={},this.uiElements={},this.documentContainer=e.docContainer,this.angle=e.angle,this.canvasRendered=!1,this.textLayerRendered=!1,this.hyperlinksRendered=!1,this.zoomScale=1;var t=a;this.pageInfo.nonCanvasPage&&(t=""),this.pageInfo.nonCanvasPage?(this.uiElements.pageContainer=new UWA.Element("div",{id:"Page-"+this.pageInfo.getIndex()+"-Container",context:this.context,class:"_3dp-doc-page-container",styles:{width:"100%",height:"100%"}}),void 0===this.preElement&&(this.preElement=new UWA.Element("textArea",{id:"_3dp-1d-textArea",context:this.context,wrap:"off",styles:{width:"100%",height:"100%","font-family":"consolas","font-size":"13.599px",overflow:"auto",padding:"0px",margin:"0 0 0px","user-select":"text","-webkit-user-select":"text","text-align":"left",resize:"none"}}).inject(this.uiElements.pageContainer),this.preElement.textContent=this.pageInfo.src,this.preElement.readOnly=!0)):(this.uiElements.pageContainer=new UWA.Element("div",{id:"Page-"+this.pageInfo.getIndex()+"-Container",context:this.context,class:"_3dp-doc-page-container",styles:{position:"absolute",width:this.originalWidth+"px",height:this.originalHeight+"px","background-color":"White","background-image":t,"background-repeat":"no-repeat","background-position":"center"}}),this.uiElements.backgroundImageContainer=new UWA.Element("div",{id:"Page-"+this.pageInfo.getIndex()+"-backgroundImageLayer",context:this.context,styles:{position:"absolute",top:"0px",left:"0px",width:this.originalWidth+"px",height:this.originalHeight+"px","z-index":0,"pointer-events":"none","background-repeat":"no-repeat","background-size":"100% 100%"}}).inject(this.uiElements.pageContainer))},rotateAnnotations:function(e,t,i,n,s){var o,a,r,h=this.getOriginalHeight(),l=this.getOriginalWidth();switch(s){case 0:h=0,l=0;break;case-270:case 90:s=90,l=0;break;case-180:case 180:s=180;break;case 270:case-90:s=-90,h=0}return o=Math.PI/180*s,[(a=Math.cos(o))*(i-e)+(r=Math.sin(o))*(n-t)+e+l,a*(n-t)-r*(i-e)+t+h]},fetchShape:function(e){for(var t=JSON.parse(JSON.stringify(e)),i=Object.keys(t),n=0;n<i.length;n++){var s=t[i[n]],o=s.data.path;if(!s||"unknownOpen"!==s.type&&"rectangle"!==s.type&&"square"!==s.type&&"triangle"!==s.type){if(s&&"line"===s.type){for(x=0;x<o.length;x++){v=this.rotateAnnotations(1,1,o[x].x,o[x].y,s.angle-this.angle);o[x].x=v[0],o[x].y=v[1]}var a=s.data.start,r=s.data.end;v=this.rotateAnnotations(1,1,a.x,a.y,s.angle-this.angle);a.x=v[0],a.y=v[1],v=this.rotateAnnotations(1,1,r.x,r.y,s.angle-this.angle),r.x=v[0],r.y=v[1]}else if(s&&s.type&&("circle"===s.type||"ellipse"===s.type)){var h=s.data.centre;if("ellipse"===s.type&&(90===Math.abs(this.angle-s.angle)||Math.abs(this.angle-s.angle==270))){var l=s.data.radiusX;s.data.radiusX=s.data.radiusY,s.data.radiusY=l}var c=this.rotateAnnotations(1,1,h.x,h.y,s.angle-this.angle);h.x=c[0],h.y=c[1];for(var d=0;d<o.length;d++){var u=this.rotateAnnotations(1,1,o[d].x,o[d].y,s.angle-this.angle);o[d].x=u[0],o[d].y=u[1]}}else if(s&&s.type&&"text"===s.type){var g=s.data.point.x-s.data.width/2,p=s.data.point.y,m=this.rotateAnnotations(1,1,g,p,s.angle-this.angle),f=this.rotateAnnotations(1,1,g+s.data.width,p+s.data.height,s.angle-this.angle),D=this.rotateAnnotations(1,1,g,p+s.data.height,s.angle-this.angle),w=this.rotateAnnotations(1,1,g+s.data.width,p,s.angle-this.angle);s.data.path={topLeft:m,topRight:D,bottomLeft:w,bottomRight:f}}}else for(var x=0;x<o.length;x++){var v=this.rotateAnnotations(1,1,o[x].x,o[x].y,s.angle-this.angle);o[x].x=v[0],o[x].y=v[1]}}return t},renderAllAnnotations:function(){if(this.annotCanvas){this.annotCanvas.getContext("2d").clearRect(0,0,this.annotCanvas.width,this.annotCanvas.height);var e=this.getScale();for(var t in this.annotListAfterRotation={},this.annotListAfterRotation=this.fetchShape(this.annotationList),this.annotListAfterRotation)this.annotListAfterRotation.hasOwnProperty(t)&&i.drawShape({shape:this.annotListAfterRotation[t],editMode:this.annotListAfterRotation[t].editMode,canvas:this.annotCanvas,scale:e,angle:this.angle,height:this.getOriginalHeight(),width:this.getOriginalWidth()})}},loadThumbnail:function(e){this.pageInfo.getThumbnail(function(t){var i=this.pageInfo.getOriginalWidth()*this.zoomScale,n=this.pageInfo.getOriginalHeight()*this.zoomScale,s="0% 0%";switch(this.angle){case 0:s="50% 50%";break;case-270:case 90:n<i&&(s=100*n/(2*i)+"% "+100*n/(2*n)+"%"),i<=n&&(s=100*n/(2*i)+"% "+100*n/(2*n)+"%");break;case-180:case 180:s="50% 50%";break;case 270:case-90:n<i&&(s=100*i/(2*i)+"% "+100*i/(2*n)+"%"),i<=n&&(s=100*i/(2*i)+"% "+100*i/(2*n)+"%")}this.uiElements.backgroundImageContainer.setStyles({width:i+"px",height:n+"px","transform-origin":s,"background-image":"url("+t+")",transform:"rotate("+this.angle+"deg)"}),e&&e()}.bind(this))},getOriginalWidth:function(){return this.originalWidth},getOriginalHeight:function(){return this.originalHeight},getCurrentHeight:function(){return this.originalHeight*this.zoomScale},getCurrentWidth:function(){return this.originalWidth*this.zoomScale},isLoaded:function(){return this.pageInfo.isLoaded()},markForRender:function(){this.isRenderRequired=!0,this.canvasRendered=!1,this.textLayer&&(this.textLayer.remove(),this.textLayer=void 0),this.textLayerRendered=!1,this.hyperlinksRendered=!1},getContent:function(){return this.canvas},getTextElementContent:function(){return this.preElement},getPageContainer:function(){return this.uiElements.pageContainer},select:function(){this.onSelectCB&&this.onSelectCB(this.index)},getScale:function(){return Math.min(this.zoomScale,this.pageInfo.MAX_RENDERABLE_SCALE)},getPhysicalScale:function(){return this.zoomScale},setDrawStyle:function(e){var t;(this.annotCanvas||e.canvas)&&((t=e.canvas?e.canvas.getContext("2d"):this.annotCanvas.getContext("2d")).strokeStyle=""+e.color,t.fillStyle=""+e.color,t.globalAlpha=e.transparency,t.lineCap="round",t.lineJoin="round",t.lineWidth=e.thickness)},setDrawStyleForHighlight:function(e){var t;(this.annotCanvas||e.canvas)&&((t=e.canvas?e.canvas.getContext("2d"):this.annotCanvas.getContext("2d")).strokeStyle=""+e.color,t.fillStyle=""+e.color,t.globalAlpha=e.transparency,t.lineCap="round",t.lineJoin="round",t.lineWidth=e.thickness)},drawPreview:function(e){if(e.canvas||this.annotCanvas){var t,i,n=this.getPhysicalScale(),s=window.devicePixelRatio>1?window.devicePixelRatio:1;if(e.canvas?(t=e.canvas.clientWidth*s/e.canvas.width,i=e.canvas.getContext("2d")):this.annotCanvas&&(t=this.annotCanvas.clientWidth*s/this.annotCanvas.width,i=this.annotCanvas.getContext("2d")),e.startPoint&&e.endPoint){i.beginPath();var o=e.startPoint.x*n/t,a=e.startPoint.y*n/t,r=e.endPoint.x*n/t,h=e.endPoint.y*n/t;i.moveTo(o,a),i.lineTo(r,h),i.stroke()}else if(e.viewerPoints){i.beginPath();var l=n/t,c=e.viewerPoints.length;i.moveTo(e.viewerPoints[0].x*l,e.viewerPoints[0].y*l);for(var d=1;d<c;++d)i.lineTo(e.viewerPoints[d].x*l,e.viewerPoints[d].y*l)}i.stroke()}},drawPreviewWithShapeData:function(e){this.annotCanvas&&e.shapeData&&i.drawShape({shape:JSON.parse(JSON.stringify(e.shapeData)),canvas:this.annotCanvas,scale:this.getScale(),angle:this.angle,height:this.getOriginalHeight(),width:this.getOriginalWidth()})},getUnderneathAnnotations:function(e){var t=!1;if(e.getAll&&(t=!0),Object.keys(this.annotationList).length!=Object.keys(this.annotListAfterRotation).length&&(this.annotListAfterRotation={},this.annotListAfterRotation=this.fetchShape(this.annotationList)),this.annotCanvas){var n=[];for(var s in this.annotListAfterRotation)if(this.annotListAfterRotation.hasOwnProperty(s)){var a=i.isOverlapShape({shapeList:this.annotListAfterRotation,shape:this.annotListAfterRotation[s],point:{x:e.positionX,y:e.positionY},scale:this.getPhysicalScale(),thickness:this.annotListAfterRotation[s].graphicalProp.thickness});a&&(n=n.concat(a))}if(!1===t&&1<n.length){for(var r,h=0,l=new o(e.positionX,e.positionY),c=0;c<n.length;c++){var d=this.getAnnotationInformation({annotID:n[c]}),u=0;if(d.dataPoints.length){for(var g=0;g<d.dataPoints.length;g++){var p=new o(d.dataPoints[g].x,d.dataPoints[g].y);u+=l.distanceTo(p)}u/=d.dataPoints.length}0===c?(r=u,h=0):u<r&&(r=u,h=c)}n=[n[h]]}return n}},getAnnotationInformationRaw:function(e){this.getPhysicalScale(),window.devicePixelRatio>1&&window.devicePixelRatio;var t=this.getScale();0===Object.keys(this.annotListAfterRotation).length&&(this.annotListAfterRotation=this.fetchShape(this.annotationList));var n=this.annotListAfterRotation[e.annotID];if(n){var a=n.graphicalProp.thickness/2;a*=t;var r=i.getDrawPath({shape:n}),h=[];if("text"===n.type)h.push(new o(r.bottomLeft[0],r.bottomLeft[1])),h.push(new o(r.bottomRight[0],r.bottomRight[1])),h.push(new o(r.topLeft[0],r.topLeft[1])),h.push(new o(r.topRight[0],r.topRight[1]));else for(var l=0;l<r.length;++l)h.push(new o(r[l].x,r[l].y));if(h){for(var c=s.convexHullCompute(h),d=[],u=[],g=0;g<c.length;++g)d.push(c[g].x),u.push(c[g].y);d.sort(function(e,t){return e-t}),u.sort(function(e,t){return e-t});var p=d.length-1;return{bBoxUnScaled:[{x:d[0]-a,y:u[0]-a},{x:d[p]+a,y:u[0]-a},{x:d[p]+a,y:u[p]+a},{x:d[0]-a,y:u[p]+a}],dataPoints:h,shape:n}}}return!1},getAnnotationInformation:function(e){var t=this.getPhysicalScale();if(this.annotCanvas){var n=window.devicePixelRatio>1?window.devicePixelRatio:1,a=this.annotCanvas.clientWidth*n/this.annotCanvas.width,r=this.annotListAfterRotation[e.annotID];r||console.log("shape not found");var h=r.graphicalProp.thickness/2;h*=a;var l=i.getDrawPath({shape:r}),c=[];if("text"===r.type)c.push(new o(l.bottomLeft[0],l.bottomLeft[1])),c.push(new o(l.bottomRight[0],l.bottomRight[1])),c.push(new o(l.topLeft[0],l.topLeft[1])),c.push(new o(l.topRight[0],l.topRight[1]));else for(var d=0;d<l.length;++d)c.push(new o(l[d].x,l[d].y));if(c){for(var u=s.convexHullCompute(c),g=[],p=[],m=0;m<u.length;++m)g.push(u[m].x),p.push(u[m].y);g.sort(function(e,t){return e-t}),p.sort(function(e,t){return e-t});var f=g.length-1,D=[{x:g[0]-h,y:p[0]-h},{x:g[f]+h,y:p[0]-h},{x:g[f]+h,y:p[f]+h},{x:g[0]-h,y:p[f]+h}];return{bbox:[{x:(g[0]-h)*t,y:(p[0]-h)*t},{x:(g[f]+h)*t,y:(p[0]-h)*t},{x:(g[f]+h)*t,y:(p[f]+h)*t},{x:(g[0]-h)*t,y:(p[f]+h)*t}],bBoxUnScaled:D,dataPoints:c,shape:r}}return!1}return!1},getUnProcessedAnnotationInformation:function(e){return this.annotationList[e.annotID]},getProcessedAnnotationInformation:function(e){return this.annotListAfterRotation[e.annotID]},createAnnotation:function(e){var t=this.getScale();if(e.settings.thickness/=t,e.shapeData.thicknesses)for(var n=0;n<e.shapeData.thicknesses.length;n++)e.shapeData.thicknesses[n]/=t;var s=i.createShape({shapeData:e.shapeData,settings:e.settings});this.annotationList[""+s.id]=s,this.annotationList[""+s.id].angle=this.angle,this.annotationList[""+s.id].scale=e.viewerScale;var o=Object.keys(this.annotationList).length>0;this.onAnnotationUpdateCB(this.index,o),e.render&&this.renderAllAnnotations()},createAnnotationWithShapeData:function(e){this.annotationList[""+e.id]=e.shape,this.annotationList[""+e.id].angle=this.angle,this.annotationList[""+e.id].scale=e.viewerScale,e.editMode&&(this.annotationList[""+e.id].editMode=!0);var t=Object.keys(this.annotationList).length>0;this.onAnnotationUpdateCB(this.index,t),e.render&&this.renderAllAnnotations()},createAnnotationWithTextData:function(e){this.annotationList[""+e.annotationData.id]=e.annotationData,e.render&&this.renderAllAnnotations()},drawAnnotation:function(e){if(this.annotCanvas){var t=this.annotListAfterRotation[e.id];if(t){var n=this.getScale();return i.drawShape({shape:t,lowLightMode:e.lowLightMode,editMode:e.editMode,canvas:this.annotCanvas,scale:n,angle:this.angle,height:this.getOriginalHeight(),width:this.getOriginalWidth()})}}},getAnnotations:function(){return this.annotationList},setAnnotations:function(e,t){this.annotationList=e;var i=!0;!1===t&&(i=!1),!0===i&&this.renderAllAnnotations()},getIntersectingAnnotations:function(e){var t=[];for(var n in this.annotListAfterRotation)if(this.annotListAfterRotation.hasOwnProperty(n)){for(var s=e.thickness/this.getPhysicalScale(),o=e.endPoint.x,a=e.endPoint.y,r=2*Math.PI/10,h=[],l=0;l<2*Math.PI;l+=r)h.push({x:o+s*Math.cos(l),y:a+s*Math.sin(l)});var c=i.isIntersectShape({shapeList:this.annotListAfterRotation,shape:this.annotListAfterRotation[n],referenceShapePath:h,startPoint:e.startPoint,endPoint:e.endPoint});c&&(t=t.concat(c))}return t},destroyAnnotations:function(e){if(e.idList)for(var t=0;t<e.idList.length;++t)delete this.annotationList[""+e.idList[t]];var i=Object.keys(this.annotationList).length>0;this.onAnnotationUpdateCB(this.index,i);var n=!0;!1===e.bToRender&&(n=!1),!0===n&&this.renderAllAnnotations()},getVisibleArea:function(){if(this.canvas){var e=this.documentContainer.getBoundingClientRect(),t=this.canvas.getBoundingClientRect(),i=t.top>e.top?0:Math.abs(t.top-e.top),n=t.left>e.left?0:Math.abs(t.left-e.left),s=t.width>e.width?e.width:t.width,o=0;return t.top>e.top&&e.top+e.height>t.top+t.height?o=t.height:t.top<e.top&&t.top+t.height>e.top+e.height?o=e.height:e.top+e.height>t.top&&e.top+e.height<t.top+t.height?o=e.top+e.height-t.top:t.top+t.height>e.top&&(o=t.top+t.height-e.top),{top:i,left:n,width:s,height:o}}},getThumbnail:function(e){e&&this.pageInfo.getThumbnail(e)},enableInteractiveText:function(){this.interactiveTextEnabled=!0,this.activateTextLayer()},disableInteractiveText:function(){this.interactiveTextEnabled=!1,this.deactivateTextLayer()},enableInteractiveHyperLinkText:function(){this.interactiveHyperLinkTextEnabled=!0,this.activateHyperlinksLayer()},disableInteractiveHyperLinkText:function(){this.interactiveHyperLinkTextEnabled=!1,this.deactivateHyperlinksLayer()},activateTextLayer:function(){this.textLayer&&this.textLayer.setStyles({"pointer-events":"auto","user-select":"text","-webkit-user-select":"text",cursor:"auto"})},deactivateTextLayer:function(){this.textLayer&&this.textLayer.setStyles({"pointer-events":"none","user-select":"none","-webkit-user-select":"none",cursor:"default"})},activateHyperlinksLayer:function(){this.hyperlinksLayer&&(this.hyperlinksLayer.removeClassName("disabled"),this.hyperlinksLayer.addClassName("enabled"))},deactivateHyperlinksLayer:function(){this.hyperlinksLayer&&(this.hyperlinksLayer.removeClassName("enabled"),this.hyperlinksLayer.addClassName("disabled"))},scale:function(e){e>0&&(this.uiElements.pageContainer.setStyles({top:this.originalTop*e+"px",left:this.originalLeft*e+"px",width:this.originalWidth*e+"px",height:this.originalHeight*e+"px"}),this.canvas&&this.canvas.setStyles({width:this.originalWidth*e+"px",height:this.originalHeight*e+"px"}),this.annotCanvas&&this.annotCanvas.setStyles({width:this.originalWidth*e+"px",height:this.originalHeight*e+"px"}),this.textLayer&&this.textLayer.setStyles({width:this.originalWidth*e+"px",height:this.originalHeight*e+"px"}),this.hyperlinksLayer&&this.hyperlinksLayer.setStyles({width:this.originalWidth*e+"px",height:this.originalHeight*e+"px"}),this.uiElements.backgroundImageContainer&&this.uiElements.backgroundImageContainer.setStyles({width:this.pageInfo.getOriginalWidth()*e+"px",height:this.pageInfo.getOriginalHeight()*e+"px"}))},show:function(){this.uiElements.pageContainer.setStyles({display:"block"})},hide:function(){this.uiElements.pageContainer.setStyles({display:"none"})},render:function(e){if(!0===this.pageInfo.nonCanvasPage){var t={textLayerContainer:this.preElement,scale:e.scale,renderCB:function(){e&&e.onRenderCompleteCB&&e.onRenderCompleteCB(this)}.bind(this)};this.pageInfo.render(t)}else{var i=function(){if(this.canvasRendered&&(this.hyperlinksRendered||!this.hyperlinksRendered&&!this.pageInfo.renderHyperlinks)&&(this.textLayerRendered||!this.textLayerRendered&&!this.pageInfo.renderTextLayer)){if(this.isRenderRequired=!1,this.pageInfo.getBackgroundImage&&this.frameWindow&&this.frameWindow.getViewer){var t=this.frameWindow.getViewer();t&&t.getDocContainer()&&(t.getBackgroundColor()?t.getDocContainer().style.backgroundColor=t.getBackgroundColor():t.getDocContainer().style.backgroundColor=this.pageInfo.getBackgroundImage(this.angle))}e&&e.onRenderCompleteCB&&e.onRenderCompleteCB(this)}}.bind(this);if(this.isRenderRequired){e&&e.scale&&(this.zoomScale=e.scale),this.scale(this.zoomScale),this.show();var n=new UWA.Element("canvas",{class:"_3dp-doc-page-canvas",context:this.context,styles:{position:"absolute",top:"0px",left:"0px","z-index":1}}),s=new UWA.Element("canvas",{class:"_3dp-doc-annot-canvas",context:this.context,styles:{position:"absolute",top:"0px",left:"0px","z-index":2,"pointer-events":"none"}}),o={scale:this.getScale(),angle:this.angle,canvas:n,annotCanvas:s,containerWidth:this.uiElements.pageContainer.clientWidth,containerHeight:this.uiElements.pageContainer.clientHeight,renderCB:function(){this.removeCanvas(),this.canvas=n,this.canvas.setStyles({width:this.originalWidth*this.zoomScale+"px",height:this.originalHeight*this.zoomScale+"px"}),this.canvas.inject(this.uiElements.pageContainer),this.canvasRendered=!0,this.annotCanvas=s,this.annotCanvas.setStyles({width:this.originalWidth*this.zoomScale+"px",height:this.originalHeight*this.zoomScale+"px"}),this.annotCanvas.inject(this.uiElements.pageContainer),this.renderAllAnnotations(),void 0===this.pageInfo.thumbnail?this.pageInfo.getThumbnail(function(){this.loadThumbnail(),i()}.bind(this),this.canvas):i()}.bind(this)};this.pageInfo.render(o),this.pageInfo.renderTextLayer?this.pageInfo.renderTextLayer({scale:this.getPhysicalScale(),angle:this.angle,renderCB:function(e){let t=0,n=e.id.split("-").slice(0,2).join("-");for(let i of e.getChildren())i.setAttribute("context",this.context),"span"===i.nodeName.toLowerCase()&&(i.id=n+"-span-"+t,t++);this.removeText(),this.textLayer=e,this.textLayer.setStyles({width:this.originalWidth*this.zoomScale+"px",height:this.originalHeight*this.zoomScale+"px","z-index":3}),this.textLayer.inject(this.uiElements.pageContainer),this.textLayerRendered=!0,this.interactiveTextEnabled?this.activateTextLayer():this.deactivateTextLayer(),i()}.bind(this)}):i(),this.pageInfo.renderHyperlinks?this.pageInfo.renderHyperlinks({scale:this.getPhysicalScale(),onClickCB:this.onHyperlinkClickCB,angle:this.angle,onRenderCompleteCB:function(e){this.removeHyperlinks(),this.hyperlinksLayer=e,this.hyperlinksLayer.setStyles({width:this.originalWidth*this.zoomScale+"px",height:this.originalHeight*this.zoomScale+"px","z-index":4}),this.hyperlinksLayer.inject(this.uiElements.pageContainer),this.hyperlinksRendered=!0,this.interactiveHyperLinkTextEnabled?this.activateHyperlinksLayer():this.deactivateHyperlinksLayer(),i()}.bind(this)}):i()}else i()}},unrender:function(){this.removeCanvas(),this.removeText(),this.removeHyperlinks(),this.isRenderRequired=!0},removeCanvas:function(){this.canvas&&(this.canvas.width=0,this.canvas.height=0,this.canvas.remove(),this.canvas=void 0,this.canvasRendered=!1),this.annotCanvas&&(this.annotCanvas.width=0,this.annotCanvas.height=0,this.annotCanvas.remove(),this.annotCanvas=void 0)},removeText:function(){this.textLayer&&(this.textLayer.remove(),this.textLayer=void 0,this.textLayerRendered=!1)},removeHyperlinks:function(){this.hyperlinksLayer&&(this.hyperlinksLayer.remove(),this.hyperlinksLayer=void 0,this.hyperlinksRendered=!1)},setPosition:function(e){this.uiElements.pageContainer&&(this.originalTop=e.top,this.originalLeft=e.left,this.uiElements.pageContainer.setStyles({top:this.originalTop+"px",left:this.originalLeft+"px"}))},dispose:function(){this.unrender(),this.uiElements&&this.uiElements.pageContainer&&(this.uiElements.pageContainer.remove(),this.uiElements.pageContainer=void 0)},setBackgroundColor:function(e){this.pageInfo.getBackgroundImage&&e&&e.getDocContainer()&&!e.getBackgroundColor()&&(e.getDocContainer().style.backgroundColor=this.pageInfo.getBackgroundImage(this.angle))},enableAntiBackGroundBorder:function(e){e&&this.pageInfo.getBackgroundImage&&(this.pageInfo.enableAntiBackGroundBorder(e),this.markForRender(),this.render())},disableAntiBackGroundBorder:function(){this.pageInfo.getBackgroundImage&&(this.pageInfo.disableAntiBackGroundBorder(),this.markForRender(),this.render())}})}),define("DS/3DPlay2DExperience/Commands/CmdReframe",["DS/ApplicationFrame/Command","DS/WebUtils/Tracker"],function(e,t){"use strict";return e.extend({init:function(e){this._parent(e,{isAsynchronous:!1})},execute:function(){t.command(this.getId()),this.getFrameWindow().getViewer().reframe()}})}),define("DS/3DPlay2DExperience/DocumentLoader/Page",["UWA/Class","DS/WebSystem/DetectBrowser"],function(e,t){"use strict";const i=t().browser.name;return e.extend({init:function(e){this.isMobile=e.isMobile,this.index=e.index,this.originalWidth=e.originalWidth,this.originalHeight=e.originalHeight,this.context=e.context,this.aspectRatio=this.originalWidth/this.originalHeight,this.pageLabel=e.pageLabel,this.src=e.src,this.thumbnail;var t=this.isMobile||"safari"===i||"ie"===i?16777216:67108864,n=(this.isMobile,Math.floor(Math.sqrt(t*this.aspectRatio))),s=this.isMobile||"safari"===i||"ie"===i?8192:32768,o=window.devicePixelRatio>1?window.devicePixelRatio:1;this.MAX_RENDERABLE_SCALE=n/this.originalWidth/o,this.MIN_ZOOM_SCALE=300/this.originalWidth,this.MAX_ZOOM_SCALE=s/this.originalWidth},getIndex:function(){return this.index},getAspectRatio:function(){return this.aspectRatio},getOriginalHeight:function(){return this.originalHeight},getOriginalWidth:function(){return this.originalWidth},isLoaded:function(){if(this.src)return!0},enableAntiBackGroundBorder:function(e){this.enableAntiBackGround=!0,this.antiColor=e},disableAntiBackGroundBorder:function(){this.enableAntiBackGround=!1,this.antiColor=void 0},drawBorder:function(e,t,i){e&&t&&i&&(this.antiColor?e.strokeStyle=this.antiColor:e.strokeStyle="#d1d4d4",e.lineWidth="2",e.moveTo(0,0),e.lineTo(0,i),e.moveTo(0,i),e.lineTo(t,i),e.moveTo(t,i),e.lineTo(t,0),e.moveTo(t,0),e.lineTo(0,0),e.moveTo(0,0),e.stroke())},render:function(e,t){if(e.canvas){var i=e.angle,n=e.canvas,s=e.annotCanvas,o=0===i||180===i?this.originalWidth:this.originalHeight,a=0===i||180===i?this.originalHeight:this.originalWidth,r=e.containerWidth/o,h=Math.min(r,this.MAX_RENDERABLE_SCALE),l=o*h,c=a*h,d=n.getContext("2d",{alpha:!1}),u=s.getContext("2d"),g=window.devicePixelRatio>1?window.devicePixelRatio:1,p=l*g,m=c*g;n.width=p,n.height=m,s.width=p,s.height=m;var f=null;1!==g&&(f=[g,0,0,g,0,0]),t({angle:i,content:this.src,scale:h,canvas:n,canvasContext:d,canvasAnnotContext:u,transform:f,onRenderComplete:e.renderCB,width:l,height:c,textLayerContainer:e.textLayerContainer})}},getThumbnail:function(){}})}),define("DS/3DPlay2DExperience/Commands/Visu2DAutoCmd",["DS/3DPlay2DExperience/Commands/CmdBackground"],function(e){"use strict";return e.extend({init:function(e){this._parent(e)},execute:function(){if(this.getFrameWindow().getViewer()&&this.getFrameWindow().getViewer().getDocContainer()){this.getFrameWindow().getViewer().setBackgroundColor(void 0);var e=this.getFrameWindow().getViewer().getCurrentPage();e&&e.setBackgroundColor(this.getFrameWindow().getViewer())}}})}),define("DS/3DPlay2DExperience/Commands/Visu2DBlackCmd",["DS/3DPlay2DExperience/Commands/CmdBackground"],function(e){"use strict";return e.extend({init:function(e){this._parent(e),this.background="rgb(0,0,0)"}})}),define("DS/3DPlay2DExperience/DocumentLoader/ImageLoader",["DS/3DPlay2DExperience/DocumentLoader/Document","DS/3DPlay2DExperience/DocumentLoader/DocumentLoader","DS/3DPlay2DExperience/DocumentLoader/Page","UWA/Core"],function(e,t,i,n){"use strict";var s=e.extend({init:function(e){this._parent(e)},getDocumentHeight:function(){return this.DOC_HEIGHT},getDocumentWidth:function(){return this.DOC_WIDTH},getDocumentWidthAfterRotation:function(){return this.ROTATED_DOC_WIDTH},getDocumentHeightAfterRotation:function(){return this.ROTATED_DOC_HEIGHT},load:function(e,t){var i=this;e(1);var n=new Image;n.src=this.src,n.onload=function(){var e=new o({index:1,originalWidth:n.width,originalHeight:n.height,src:n});i.pages.push(e),i.DOC_WIDTH=n.width,i.DOC_HEIGHT=n.height,i.ROTATED_DOC_WIDTH=n.height,i.ROTATED_DOC_HEIGHT=n.width,t()}}}),o=i.extend({init:function(e){this._parent(e)},rotation:function(e){var t=e.canvasContext;switch(t.clearRect(0,0,e.width,e.height),t.save(),t.fillStyle="#f4f5f6",t.beginPath(),t.fillRect(0,0,e.width,e.height),t.closePath(),e.angle){case 0:e.canvasContext.drawImage(e.content,0,0,e.content.width,e.content.height,0,0,e.width,e.height);break;case 90:t.translate(e.width,0),t.rotate(e.angle*Math.PI/180),t.drawImage(e.content,0,0,e.content.width,e.content.height,0,0,e.height,e.width);break;case 180:t.translate(e.width,e.height),t.rotate(e.angle*Math.PI/180),t.drawImage(e.content,0,0,e.content.width,e.content.height,0,0,e.width,e.height);break;case 270:t.translate(0,e.height),t.rotate(e.angle*Math.PI/180),t.drawImage(e.content,0,0,e.content.width,e.content.height,0,0,e.height,e.width);break;default:console.log("Wrong Angle calculation")}t.restore()},getBackgroundImage:function(e){if(this.background)return this.background[e]},render:function(e){var t=this;this._parent(e,function(e){var i=window.devicePixelRatio>1?window.devicePixelRatio:1;if(e.canvasContext.scale(i,i),e.canvasAnnotContext.scale(i,i),t.rotation(e),!t.background){for(var n=e.canvasContext.getImageData(0,0,e.canvas.width,e.canvas.height),s=4*(n.width-1),o=4*(n.height*n.width-1),a=(n.height-1)*n.width*4,r=(n.data[0],n.data[1],n.data[2],n.data[s],n.data[s+1],n.data[s+2],"rgba("+n.data[o]+","+n.data[o+1]+","+n.data[o+2]+",0.8)"),h=(n.data[a],n.data[a+1],n.data[a+2],[]),l=[],c=[],d=0;d<=s;d+=4)h.push(n.data[d]),l.push(n.data[d+1]),c.push(n.data[d+2]);for(d=a;d<=o;d+=4)h.push(n.data[d]),l.push(n.data[d+1]),c.push(n.data[d+2]);for(d=0;d<=a;d+=4*n.width)h.push(n.data[d]),l.push(n.data[d+1]),c.push(n.data[d+2]);for(d=s;d<=r;d+=4*n.width)h.push(n.data[d]),l.push(n.data[d+1]),c.push(n.data[d+2]);h.sort(function(e,t){return e-t}),l.sort(function(e,t){return e-t}),c.sort(function(e,t){return e-t});var u="rgb("+h[Math.ceil(h.length/2)]+","+l[Math.ceil(l.length/2)]+","+c[Math.ceil(c.length/2)]+")",g=u,p=u,m=u,f=u;t.background={0:g,90:p,180:m,270:f}}t.enableAntiBackGround&&t.drawBorder(e.canvasContext,e.width,e.height),e.onRenderComplete()})}});return t.extend({load:function(e){var t=this,i=e.asset,n={asset:i,responseType:"arraybuffer",onDownloadingStart:this.onLoadingStart,onDownLoadingProgress:this.onLoadingProgress,onDownloadingEnd:function(e){var n=new Uint8Array(e),o=new Blob([n],{type:"image/"+i.type}),a=(window.URL||window.webkitURL).createObjectURL(o);this.doc=new s({pagesCount:1,src:a}),this.doc._load(this.onLoadingProgress,function(){t.onLoadingEnd(t.doc)})}.bind(this)};this.downloadDocumentInBuffer(n)},dispose:function(){this.doc&&(this.doc.dispose(),this.doc=void 0)}})}),define("DS/3DPlay2DExperience/Commands/Visu2DGreyCmd",["DS/3DPlay2DExperience/Commands/CmdBackground"],function(e){"use strict";return e.extend({init:function(e){this._parent(e),this.background="rgb(192,192,192)"}})}),define("DS/3DPlay2DExperience/Commands/Visu2DDarkGreyCmd",["DS/3DPlay2DExperience/Commands/CmdBackground"],function(e){"use strict";return e.extend({init:function(e){this._parent(e),this.background="rgb(128,128,128)"}})}),define("DS/3DPlay2DExperience/Commands/Visu2DLightGreyCmd",["DS/3DPlay2DExperience/Commands/CmdBackground"],function(e){"use strict";return e.extend({init:function(e){this._parent(e),this.background="rgb(211,211,211)"}})}),define("DS/3DPlay2DExperience/DocumentLoader/TextLoader",["DS/3DPlay2DExperience/DocumentLoader/Document","DS/3DPlay2DExperience/DocumentLoader/DocumentLoader","DS/3DPlay2DExperience/DocumentLoader/Page","UWA/Core"],function(e,t,i,n){"use strict";var s=i.extend({init:function(e){this._parent(e);var t=this.src.split(/\r\n|\r|\n/);this.numLines=t.length,this.nonCanvasPage=!0},getThumbnail:function(e){console.log("Thumbnail generation is an asynchronous operation. Please provide a callback function.")},render:function(e){var t=13.599*e.scale;e.textLayerContainer.style.fontSize=t+"px",e.renderCB&&e.renderCB()},dispose:function(){this.thumbnail&&(URL.revokeObjectURL(this.thumbnail),this.thumbnail=void 0)}}),o=e.extend({init:function(e){this._parent(e)},getDocumentHeight:function(){return this.DOC_HEIGHT},getDocumentWidth:function(){return this.DOC_WIDTH},load:function(e,t){var i=new n.Element("canvas",{styles:{font:"10px 3ds"}}).getContext("2d");i.font.split(" ");i.font="13.599px consolas";for(var o=this.src.split(/\r\n|\r|\n/),a=o.length,r=0,h=0,l=0;l<a;l++)o[l].length>h&&(r=l,h=o[l].length);var c=i.measureText(o[r]).width,d=c+=60,u=function(e){var t,i=e.split(/\r\n|\r|\n/),s=i.length;t=16.667*s;var o=new n.Element("canvas",{styles:{font:"10px 3ds"}}).getContext("2d");o.font.split(" ");o.font="13.599px consolas";for(var a=0,r=0,h=0;h<s;h++)i[h].length>r&&(a=h,r=i[h].length);return{width:o.measureText(i[a]).width,height:t}}(this.src).height;this.DOC_WIDTH=Math.max(this.DOC_WIDTH,d),this.DOC_HEIGHT+=u;var g=new s({index:1,originalWidth:d,originalHeight:u,src:this.src});this.pages.push(g),e({loaded:l,total:this.pagesCount}),t()}});return t.extend({init:function(e){this._parent(e)},load:function(e){var t=e.asset,i=this,n=function(e){i.doc=new o({pagesCount:1,src:e}),i.doc._load(i.onLoadingProgress,function(){i.onLoadingEnd(i.doc)})};if("FILE"===t.provider){var s={asset:t,responseType:"text",onDownloadingStart:this.onLoadingStart,onDownLoadingProgress:this.onLoadingProgress,onDownloadingEnd:n};this.downloadDocumentInBuffer(s)}else this.onLoadingStart(),n(t.data)},dispose:function(){this.doc&&(this.doc.dispose(),this.doc=void 0)}})}),define("DS/3DPlay2DExperience/DocumentLoader/SVGLoader",["DS/3DPlay2DExperience/DocumentLoader/Document","DS/3DPlay2DExperience/DocumentLoader/DocumentLoader","DS/3DPlay2DExperience/DocumentLoader/Page","DS/WebSystem/DetectBrowser","DS/WebSystem/Settings","UWA/Core"],function(e,t,i,n,s,o){"use strict";var a=n().browser.name,r=(s.get("3DPlay.2DExperience.AllowDifferentSizePages"),i.extend({init:function(e){this._parent(e)},getThumbnail:function(e){if(e&&"function"==typeof e)if(this.thumbnail)e(this.thumbnail);else{var t=(new XMLSerializer).serializeToString(this.src),i=new Blob([t],{type:"image/svg+xml"});this.thumbnail=URL.createObjectURL(i),e(this.thumbnail)}else console.log("Thumbnail generation is an asynchronous operation. Please provide a callback function.")},render:function(e){var t=this,i=function(e){var i=window.devicePixelRatio>1?window.devicePixelRatio:1;e.canvasContext.scale(i,i),e.canvasAnnotContext.scale(i,i);var n=new Image,s=(new XMLSerializer).serializeToString(this.src),o=new Blob([s],{type:"image/svg+xml"}),r=URL.createObjectURL(o);n.onload=function(i){URL.revokeObjectURL(r),"ie"===a&&document.body.appendChild(n),t.rotation(e,n),t.drawBorder(e.canvasContext,e.canvas.width,e.canvas.height),e.onRenderComplete(),"ie"===a&&document.body.removeChild(n)},n.src=r}.bind(this);this._parent(e,i)},rotation:function(e,t){var i=e.canvasContext;i.clearRect(0,0,e.width,e.height),i.save();var n=t.width||t.clientWidth,s=t.height||t.clientHeight;switch(e.angle){case 0:e.canvasContext.drawImage(t,0,0,n,s,0,0,e.width,e.height);break;case 90:i.translate(e.width,0),i.rotate(e.angle*Math.PI/180),i.drawImage(t,0,0,n,s,0,0,e.height,e.width);break;case 180:i.translate(e.width,e.height),i.rotate(e.angle*Math.PI/180),i.drawImage(t,0,0,n,s,0,0,e.width,e.height);break;case 270:i.translate(0,e.height),i.rotate(e.angle*Math.PI/180),i.drawImage(t,0,0,n,s,0,0,e.height,e.width);break;default:console.log("Wrong Angle calculation")}i.restore()},dispose:function(){this.thumbnail&&(URL.revokeObjectURL(this.thumbnail),this.thumbnail=void 0)}})),h=e.extend({init:function(e){this._parent(e),this.ROTATED_DOC_WIDTH=0,this.ROTATED_DOC_HEIGHT=0},getDocumentHeight:function(){return this.DOC_HEIGHT},getDocumentWidth:function(){return this.DOC_WIDTH},getDocumentWidthAfterRotation:function(){return this.ROTATED_DOC_WIDTH},getDocumentHeightAfterRotation:function(){return this.ROTATED_DOC_HEIGHT},load:function(e,t){for(var i=function(e){var t,i,n=e.viewBox;return e.width&&e.width.baseVal&&e.height&&e.height.baseVal&&0!=e.width.baseVal.value&&0!=e.height.baseVal.value?(t=e.width.baseVal.value,i=e.height.baseVal.value):!n.baseVal||null===n.baseVal.width&&0===n.baseVal.width||(t=n.baseVal.width,i=n.baseVal.height),{width:t,height:i}},n=0;n<this.pagesCount;n++){var s=i(this.src[n]),o=s.width,a=s.height;this.DOC_WIDTH=Math.max(this.DOC_WIDTH,o),this.DOC_HEIGHT+=a,this.ROTATED_DOC_WIDTH=Math.max(this.ROTATED_DOC_WIDTH,a),this.ROTATED_DOC_HEIGHT+=o;var h=new r({index:n+1,originalWidth:o,originalHeight:a,src:this.src[n]});this.pages.push(h),e({loaded:n,total:this.pagesCount})}t()}});return t.extend({init:function(e){this._parent(e)},load:function(e){var t=e.asset,i=this,n=function(e){var t,n,s=[];if((n=(new DOMParser).parseFromString(e,"application/xml")).children&&n.children[0]&&n.children[0].children[0]){var o;o="parsererror"===n.children[0].children[0].tagName||"svg"===n.children[0].children[0].tagName?n.children[0].children:n.children;for(var a=0;a<o.length;++a)"svg"===(t=o[a]).tagName&&s.push(i._getSVGSheet(t))}else if(n.childNodes)for(a=0;a<n.childNodes.length;++a){var r=n.childNodes[a],l=s.length;if(r.childNodes&&r.childNodes.length>0){for(var c=0;c<r.childNodes.length;++c)"parsererror"===(t=r.childNodes[c]).localName||"parsererror"!==t.tagName&&"svg"!==t.tagName||s.push(i._getSVGSheet(t));l!==s.length||"parsererror"===r.localName||"parsererror"!==r.tagName&&"svg"!==r.tagName||s.push(i._getSVGSheet(r))}}0===s.length?i.onLoadingFail({name:"Empty_SVG",message:"SVG loaded is Empty"}):(i.doc=new h({pagesCount:s.length,src:s}),i.doc._load(i.onLoadingProgress,function(){i.onLoadingEnd(i.doc)}))};if("FILE"===t.provider){t.requestsOptions=void 0;var s={asset:t,responseType:"text",onDownloadingStart:this.onLoadingStart,onDownLoadingProgress:this.onLoadingProgress,onDownloadingEnd:n};this.downloadDocumentInBuffer(s)}else this.onLoadingStart(),n(t.data)},_getSVGSheet:function(e,t){var i=e.outerHTML;"ie"===a&&(i=(new XMLSerializer).serializeToString(e));var n=null,s=null;return e.width.baseVal.unitType>=0&&e.width.baseVal.unitType<11&&e.height.baseVal.unitType>=0&&e.height.baseVal.unitType<11&&(2===e.height.baseVal.unitType&&e.viewBox&&e.viewBox.baseVal.width>0&&e.viewBox.baseVal.height>0?(n=e.viewBox.baseVal.width,s=e.viewBox.baseVal.height,i=i.replace(new RegExp("<svg ",""),'<svg height="'+s+'px" width="'+n+'px" '),e.setAttribute("height",e.viewBox.baseVal.height),e.setAttribute("width",e.viewBox.baseVal.width)):e.width.baseVal.valueInSpecifiedUnits&&e.height.baseVal.valueInSpecifiedUnits&&(n=e.width.baseVal.valueInSpecifiedUnits,s=e.height.baseVal.valueInSpecifiedUnits,i=(i=i.replace(new RegExp('height="'+e.height.baseVal.valueAsString+'"',""),'height="'+s+'px"')).replace(new RegExp('width="'+e.width.baseVal.valueAsString+'"',""),'width="'+n+'px"'))),e.style.background||e.setAttribute("style","background: rgb(255,255,255)"),e},dispose:function(){this.doc&&(this.doc.dispose(),this.doc=void 0)}})}),define("DS/3DPlay2DExperience/DocumentLoader/PDFLoader",["DS/3DPlay2DExperience/DocumentLoader/DocumentLoader","DS/3DPlay2DExperience/DocumentLoader/Document","DS/3DPlay2DExperience/DocumentLoader/Page","DS/WebSystem/Environment","DS/WebInfraUI/3DPlayModal","DS/WebUtils/ProbesManager","DS/WebSystem/Nls","UWA/Core","DS/UIKIT/Tooltip","i18n!DS/3DPlay2DExperience/assets/nls/3DPlay2DExperience"],function(e,t,i,n,s,o,a,r,h,l){"use strict";const c=17,d=3,u=9,g=15,p=2,m=16,f=1;var D=i.extend({init:function(e){this._parent(e),this.pdfjs=e.pdfjs,this.comments=[]},dispose:function(){this.thumbnail&&(this.thumbnail=void 0),this.src&&(this.src.cleanup(),this.src=void 0)},getThumbnail:function(e,t){if(this.thumbnail&&e)e(this.thumbnail);else{let i=function(){this.thumbnail=s.toDataURL("image/png"),s.remove(),e(this.thumbnail)}.bind(this),n=this.src.getViewport({scale:.25}),s=document.createElement("canvas");s.width=n.width,s.height=n.height;let o=s.getContext("2d");if(t)o.drawImage(t,0,0,t.width,t.height,0,0,s.width,s.height),i();else this.src.render({canvasContext:o,viewport:n}).promise.then(i)}},render:function(e){var t=this;this._parent(e,function(e){var i;if(0===e.angle)i=e.content.getViewport({scale:e.scale});else{const t=(e.angle+e.content.rotate)%360;i=e.content.getViewport({scale:e.scale,rotation:t})}const n={canvasContext:e.canvasContext,transform:e.transform,viewport:i};t.renderTask&&(t.renderTask.cancel(),t.renderTask=void 0),t.renderTask=e.content.render(n),t.renderTask.promise.then(function(i){if(e.onRenderComplete){var n=window.devicePixelRatio>1?window.devicePixelRatio:1;e.canvasContext.scale(n,n),e.canvasAnnotContext.scale(n,n),t.drawBorder(e.canvasContext,e.canvas.width,e.canvas.height),t.renderTask=void 0,e.onRenderComplete()}},function(e){})})},renderHyperlinks:function(e){var t=function(e){var t=new r.Element("div",{html:"<h5>"+e.hyperlink.titleObj.str+"</h5><p>"+e.hyperlink.contentsObj.str+"</p>",style:{width:"100%",height:"100%",color:"black","background-color":"yellow"}});new h({target:e.link,body:t}).elements.body.setStyles({"background-color":e.bgcolor,color:e.color})},i=this,n=new r.Element("div",{id:"Page-"+this.index+"-HyperlinksLayer",class:"_3dp-doc-page-hyperlinks-layer",styles:{width:"100%",height:"100%",position:"absolute",top:"0px",left:"0px","z-index":2,"pointer-events":"none"}}),s=this.context;this.src.getAnnotations().then(function(o){o.forEach(function(a){var h,l,D,w,x,v=(e.angle+i.src.rotate)%360,P="yellow",y="black";switch(a.annotationType){case p:h=a.url?new r.Element("a",{id:a.id,href:a.url,target:"_blank",context:s,styles:{position:"absolute",cursor:"pointer",color:"transparent","background-color":"transparent"},events:{mouseenter:function(){h.setStyles({"background-color":"rgba(0, 0, 255, 0.2)"})},mouseleave:function(){h.setStyles({"background-color":"transparent"})}}}).inject(n):new r.Element("div",{id:a.id,context:s,styles:{position:"absolute",cursor:"pointer",color:"transparent","background-color":"transparent"},events:{click:function(){e.onClickCB(a,v)},mouseenter:function(){h.setStyles({"background-color":"rgba(0, 0, 255, 0.2)"})},mouseleave:function(){h.setStyles({"background-color":"transparent"})}}}).inject(n);break;case m:P="yellow",y="black";if(a.color&&(P="rgb("+a.color[0]+", "+a.color[1]+", "+a.color[2]+")"),h=new r.Element("div",{id:a.id,styles:{position:"absolute",cursor:"pointer"}}).inject(n),t({hyperlink:a,link:h,bgcolor:P,color:y}),a.parentId)for(let t of o)t.id===a.parentId&&(l=t.rect[0]*e.scale,D=t.rect[1]*e.scale,w=(t.rect[2]-t.rect[0])*e.scale,x=(t.rect[3]-t.rect[1])*e.scale);break;case f:a.color&&(P="rgb("+a.color[0]+", "+a.color[1]+", "+a.color[2]+")"),"NoIcon"===a.name&&(y="transparent"),h=new r.Element("div",{id:a.id,class:"fonticon fonticon-comment",styles:{position:"absolute",cursor:"pointer",color:y}}).inject(n),t({hyperlink:a,link:h,bgcolor:P,color:y});break;case g:case d:case u:a.color&&(P="rgb("+a.color[0]+", "+a.color[1]+", "+a.color[2]+")"),h=new r.Element("div",{id:a.id,styles:{position:"absolute",cursor:"pointer"}}).inject(n),t({hyperlink:a,link:h,bgcolor:P,color:y});break;case c:a.color&&(P="rgb("+a.color[0]+", "+a.color[1]+", "+a.color[2]+")"),h=new r.Element("div",{id:a.id,styles:{position:"absolute",cursor:"pointer"},events:{click:function(){e.onClickCB(a,v)}}}).inject(n),i.comments.push(a),t({hyperlink:a,link:h,bgcolor:P,color:y})}if(h)switch(l||(l=a.rect[0]*e.scale,D=a.rect[1]*e.scale,w=(a.rect[2]-a.rect[0])*e.scale,x=(a.rect[3]-a.rect[1])*e.scale),v){case 0:h.setStyles({left:l+"px",width:w+"px",height:x+"px",bottom:D+"px"});break;case 90:h.setStyles({top:l+"px",width:x+"px",height:w+"px",left:D+"px"});break;case 180:h.setStyles({top:D+"px",width:w+"px",height:x+"px",right:l+"px"});break;case 270:h.setStyles({bottom:l+"px",width:x+"px",height:w+"px",right:D+"px"})}}),e.onRenderCompleteCB&&e.onRenderCompleteCB(n)})},renderTextLayer:function(e){var t=this,i=this.src.getViewport({scale:e.scale,rotation:e.angle}),n=new r.Element("div",{id:"Page-"+this.index+"-TextLayer",context:this.context,class:"_3dp-doc-page-text-layer",styles:{width:"100%",height:"100%",position:"absolute",top:"0px",left:"0px","z-index":1}});this.src.getTextContent().then(function(e){t.pdfjs.renderTextLayer({textContent:e,container:n,viewport:i,enhanceTextSelection:!0})}).finally(function(){e.renderCB&&e.renderCB(n)})}}),w=t.extend({init:function(e){this.comments=[],this._parent(e),this.pdfjs=e.pdfjs,this.context=e.context,this.DOC_WIDTH=0,this.DOC_HEIGHT=0,this.ROTATED_DOC_WIDTH=0,this.ROTATED_DOC_HEIGHT=0,this.isMobile=e.isMobile},loadPage:function(e,t){this.src&&e<=this.pagesCount&&this.src.getPage(e).then(t)},getDocumentHeight:function(){return this.DOC_HEIGHT},getDocumentWidth:function(){return this.DOC_WIDTH},getDocumentWidthAfterRotation:function(){return this.ROTATED_DOC_WIDTH},getDocumentHeightAfterRotation:function(){return this.ROTATED_DOC_HEIGHT},load:function(e,t){var i=this,n=0;this.src.getPageLabels().then(function(e){e&&(i.pageLabels=e)});var s=function(o){var a=o.getViewport({scale:1});this.DOC_WIDTH=Math.max(this.DOC_WIDTH,a.width),this.DOC_HEIGHT+=a.height,this.ROTATED_DOC_WIDTH=Math.max(this.ROTATED_DOC_WIDTH,a.height),this.ROTATED_DOC_HEIGHT+=a.width;var r=new D({index:o.pageNumber,originalWidth:a.width,originalHeight:a.height,src:o,isMobile:i.isMobile,pageLabel:i.pageLabels?i.pageLabels[o.pageNumber-1]:void 0,pdfjs:i.pdfjs,context:this.context});o.getAnnotations().then(function(e){e.forEach(e=>{"Text"!==e.subtype&&"FreeText"!==e.subtype&&"Highlight"!==e.subtype||i.comments.push({page:o.pageNumber,annot:e})})}),o.getTextContent().then(function(o){if(!r.textContent){r.textContent=[];for(var a=0;a<o.items.length;a++){o.items[a].str&&r.textContent.push(o.items[a].str)}i.pages.push(r),++n<i.pagesCount?(e({loaded:n,total:i.pagesCount}),i.loadPage(n+1,s)):t(i.pages)}})}.bind(this);this.src.getOutline().then(function(e){e&&(i.bookmarks=e)}),this.src.getAttachments().then(function(e){e&&(i.attachments=e)}),this.src.getMetadata().then(function(e){e&&(i.metadata=e)}),this.loadPage(1,s)},dispose:function(){this._parent(),this.src.cleanup(),this.src=void 0}});return e.extend({init:function(e){this._parent(e)},load:function(e){var t=e.asset,i=this;window.PDFJS_VERSION="2.13.216",require(["DS/PDFjs/PDFjs"],function(e){e.disableWebGL=!0;var n={asset:t,responseType:"arraybuffer",onDownloadingStart:function(){i.onLoadingStart()},onDownloadingEnd:function(t){var n=new Uint8Array(t),a=o.createProbe("Load_Infra");a.begin();var r=e.getDocument(n);r.onPassword=function(e,t){1!==t&&2!==t||(i.promptModal=new s({renderTo:i.frameWindow.getViewerFrame()}),i.promptModal.prompt({message:l.PDFPasswordMessage,errormessage:2===t?l.PDFWrongPasswordMessage:null,title:l.PDFPasswordTitle,required:!1,placeholder:l.PlaceHolder,typeOfText:"password",callback:function(t){null===t?r.destroy():!1===t?r.destroy():e(t)}}))},r.promise.then(function(t){i.statistics.nbPages=t.numPages,i.doc=new w({pagesCount:t.numPages,src:t,isMobile:i.isMobile,context:i.frameWindow.options.context,pdfjs:e}),a.end(),a=null,i.doc._load(i.onLoadingProgress,function(){i.onLoadingEnd(i.doc)})}).catch(function(e){i.onLoadingFail(e)})}};i.downloadDocumentInBuffer(n)})},dispose:function(){window.PDFJS_VERSION=void 0,this.promptModal&&(this.promptModal.dispose(),this.promptModal=void 0),this.doc&&(this.doc.dispose(),this.doc=void 0)}})}),define("DS/3DPlay2DExperience/Commands/Visu2DWhiteCmd",["DS/3DPlay2DExperience/Commands/CmdBackground"],function(e){"use strict";return e.extend({init:function(e){this._parent(e),this.background="rgb(255,255,255)"}})}),define("DS/3DPlay2DExperience/DocumentViewer/DocumentViews/DocumentView",["UWA/Core","DS/3DPlay2DExperience/DocumentViewer/BaseComponent","DS/VisuEvents/EventsManager","DS/3DPlay2DExperience/DocumentViewer/PageView","DS/ApplicationFrame/CommandsManager","DS/WebUtils/Vector2"],function(e,t,i,n,s,o){"use strict";return t.extend({init:function(t){this._parent(t),this.pdfDoc=t.doc,this.angle=t.angle,this.isMobile=t.isMobile,this.container=t.container,this.frameWindow=t.frameWindow,this.viewerState=t.viewerState,this.gestures=t.gestures,this.displayZoomPercent=t.displayZoomPercent,this.pagesContainer=new e.Element("div",{id:"_3dp-doc-pages-container"}),this.onPageSelectCB=t.onPageSelectCB,this.onAnnotationUpdateCB=t.onAnnotationUpdateCB,this.onHyperlinkClickCB=t.onHyperlinkClickCB,this.pageViews=[];for(var i=0;i<t.doc.pages.length;i++){var s=new n({frameWindow:this.frameWindow,pageInfo:t.doc.pages[i],onSelectCB:t.onPageSelectCB,onAnnotationUpdateCB:t.onAnnotationUpdateCB,docContainer:this.container,angle:this.angle,onHyperlinkClickCB:this.onHyperlinkClickCB,context:this.frameWindow.options.context});this.pageViews.push(s)}this.renderedPages=[],this.zoomScale=1,this.prevZoomScale=this.zoomScale,this.enableEvents(),this.enableTouchEvents(),this.isMobile||this.enableCATIAEvents(),this.enableKeyboardEvents()},_goToPage:function(e){},goToPage:function(e){},getPagesCount:function(){return this.pageViews.length},getPages:function(){return this.pageViews},getContainer:function(){return this.pagesContainer},getOriginalPageInfoWithMargin:function(e){if(e){for(var t=0,i=0,n=0,s=0,o=0;o<this.pageViews.length;o++){if(this.pageViews[o].index===e){s=this.pageViews[o].getOriginalHeight()+2*this.PAGE_MARGIN,n=this.pageViews[o].getOriginalWidth()+2*this.PAGE_MARGIN,t=.5*(this.pageViews[o].getOriginalWidth()-n);break}i+=this.PAGE_MARGIN,i+=this.pageViews[o].getOriginalHeight(),i+=this.PAGE_MARGIN}return{left:t,top:i,height:s,width:n}}},getPageMargin:function(){return this.PAGE_MARGIN},dispose:function(){for(this.disableEvents(),this.disableCATIAEvents(),this.disableTouchEvents(),this.disableKeyboardEvents();this.pageViews.length>0;)this.pageViews.pop().dispose();this.renderedPages=void 0,this.container.remove(),this.container=void 0},setPageIndex:function(e,t){this.pdfDoc.src.getPageIndex(e[0]).then(function(e){t(e+1)})},getPageIndexOfHyperlink:function(e,t){"object"==typeof e?this.pdfDoc.src.getPageIndex(e[0]).then(function(i){t({pageIndex:i+1,ref:e})}):this.pdfDoc.src.getDestination(e).then(function(e){this.pdfDoc.src.getPageIndex(e[0]).then(function(i){t({pageIndex:i+1,ref:e})})}.bind(this))},enableEvents:function(){this.ondoubleclick=this.onDoubleClick.bind(this),this.ondoubletap=this.onDoubleTap.bind(this),i.addEvent(this.container,"onLeftDoubleClick",this.ondoubleclick),i.addEvent(this.container,"onDoubleTap",this.ondoubletap),this.singleFingerPanEnabled=!0;for(var e=0;e<this.pageViews.length;e++)this.pageViews[e].enableInteractiveText(),this.pageViews[e].enableInteractiveHyperLinkText()},disableEvents:function(){i.removeEvent(this.container,"onLeftDoubleClick",this.ondoubleclick),i.removeEvent(this.container,"onDoubleTap",this.ondoubletap),this.singleFingerPanEnabled=!1,document.getSelection()&&document.getSelection().removeAllRanges();for(var e=0;e<this.pageViews.length;e++)this.pageViews[e].disableInteractiveText(),this.pageViews[e].disableInteractiveHyperLinkText()},enableCATIAEvents:function(){this.onmousedown=this.onMouseDown.bind(this),this.onmousemove=this.onMouseMove.bind(this),this.onmouseup=this.onMouseUp.bind(this),this.onmouseleave=this.onMouseLeave.bind(this),this.onmousewheel=this.onMouseWheel.bind(this),this.container.addEventListener("mousedown",this.onmousedown,!0),this.container.addEventListener("mousemove",this.onmousemove,!0),this.container.addEventListener("mouseup",this.onmouseup,!0),this.container.addEventListener("mouseleave",this.onmouseleave,!0),this.container.addEventListener("wheel",this.onmousewheel,!0)},disableCATIAEvents:function(){this.container.removeEventListener("mousedown",this.onmousedown,!0),this.container.removeEventListener("mousemove",this.onmousemove,!0),this.container.removeEventListener("mouseup",this.onmouseup,!0),this.container.removeEventListener("mouseleave",this.onmouseleave,!0),this.container.removeEventListener("wheel",this.onmousewheel,!0)},enableKeyboardEvents:function(){this.onkeyup=this.onKeyUp.bind(this),this.onkeydown=this.onKeyDown.bind(this),document.addEventListener("keyup",this.onkeyup,!0),document.addEventListener("keydown",this.onkeydown,!0)},disableKeyboardEvents:function(){document.removeEventListener("keyup",this.onkeyup,!0),document.removeEventListener("keydown",this.onkeydown,!0)},enableTouchEvents:function(){this.ontouchstart=this.onTouchStart.bind(this),this.ontouchmove=this.onTouchMove.bind(this),this.ontouchend=this.onTouchEnd.bind(this),this.container.addEventListener("touchstart",this.ontouchstart,!0),this.container.addEventListener("touchmove",this.ontouchmove,!0),this.container.addEventListener("touchend",this.ontouchend,!0)},disableTouchEvents:function(){this.container.removeEventListener("touchstart",this.ontouchstart,!0),this.container.removeEventListener("touchmove",this.ontouchmove,!0),this.container.removeEventListener("touchend",this.ontouchend,!0)},scale:function(e){this.startZoom(e.zoomCenter),this.zoom(e.zoomScale,e.isScaleAbsolute),this.stopZoom(e.doNotRender),this._publishCurrentState()},scrollUp:function(e=0){this.startPan(),this.pan({x:this.initialPanPos.x,y:this.initialPanPos.y+e}),this.stopPan()},scrollDown:function(e=0){this.startPan(),this.pan({x:this.initialPanPos.x,y:this.initialPanPos.y-e}),this.stopPan()},scrollLeft:function(e=0){this.startPan(),this.pan({x:this.initialPanPos.x-e,y:this.initialPanPos.y}),this.stopPan()},scrollRight:function(e=0){this.startPan(),this.pan({x:this.initialPanPos.x+e,y:this.initialPanPos.y}),this.stopPan()},scaleText:function(e,t){this.startZoomtxt(),this.zoomtxt(e,t),this.stopZoomtxt(),this._publishCurrentStateWithoutUpdateLayout()},updateLayout:function(e){var t=this.container.getBoundingClientRect(),i=this.pagesContainer.getBoundingClientRect(),n=e&&void 0!==e.width?e.width:i.width,s=e&&void 0!==e.height?e.height:i.height,o=e&&void 0!==e.top?e.top:i.top-t.top,a=e&&void 0!==e.left?e.left:i.left-t.left;n<=t.width?a=.5*(t.width-n):a>0?a=0:a<t.width-n&&(a=t.width-n),s<=t.height?o=.5*(t.height-s):o>0?o=0:o<t.height-s&&(o=t.height-i.height),this.pagesContainer.setStyles({width:n+"px",height:s+"px",top:o+"px",left:a+"px"})},getMinZoomScale:function(){return this.MIN_ZOOM_SCALE},getMaxZoomScale:function(){return this.MAX_ZOOM_SCALE},getPageUnderMouse:function(e){var t=null;if(e)for(var i=this.container.getBoundingClientRect(),n=this.pagesContainer.getBoundingClientRect().top-i.top-e.y,s=0,o=0;o<this.pageViews.length;o++){var a=this.pageViews[o].getCurrentHeight();if(!(s-a>=n)){t=this.pageViews[o];break}s-=a}return t},getFitDocumentScale:function(){var e=this.container.getBoundingClientRect(),t=this.pagesContainer.getBoundingClientRect();return e.width/t.width},fitDocument:function(e){var t=this.container.getBoundingClientRect(),i=this.pagesContainer.getBoundingClientRect();this.fitDocumentScale=t.width/i.width,this.scale({zoomCenter:e,zoomScale:this.fitDocumentScale}),this.viewerState="fit-document"},getFitWidthScale:function(){return this.container.getBoundingClientRect().width/(this.currentPage.originalWidth*this.zoomScale)},fitWidth:function(e){var t=this.container.getBoundingClientRect(),i=t.width/(this.currentPage.originalWidth*this.zoomScale);this.scale({zoomCenter:e,zoomScale:i,doNotRender:!0});var n=this.pagesContainer.getBoundingClientRect(),s=.5*(t.width-n.width);this.updateLayout({left:s}),this.render(this._publishCurrentState.bind(this)),this.viewerState="fit-width"},fitHeight:function(){var e=this.container.getBoundingClientRect().height/this.currentPage.getCurrentHeight();this.scale({zoomScale:e})},showActualSize:function(){this.scale({zoomScale:1,isScaleAbsolute:!0})},getReframeScale:function(){var e,t=this.container.getBoundingClientRect(),i=this.currentPage.originalWidth/this.currentPage.originalHeight,n=this.getOriginalPageInfoWithMargin(this.currentPage.index);n&&(e=t.width/t.height>i?t.height/(n.height*this.zoomScale):t.width/(n.width*this.zoomScale));return e},reframe:function(e){var t,i=this.container.getBoundingClientRect(),n=this.currentPage.originalWidth/this.currentPage.originalHeight,s=this.getOriginalPageInfoWithMargin(this.currentPage.index);s&&(t=i.width/i.height>n?i.height/(s.height*this.zoomScale):i.width/(s.width*this.zoomScale),this.scale({zoomCenter:e,zoomScale:t,doNotRender:!0}),this.updateLayout({top:s.top*this.zoomScale*-1}),this.render(this._publishCurrentState.bind(this)),this.viewerState="reframe")},getCurrentState:function(){throw new Error("Derived class has not implemented the method.")},onMouseWheel:function(e){if(this.frameWindow.getViewer().checkContext(e)){this.pagesContainer.getBoundingClientRect();var t=this.container.getBoundingClientRect(),i=0,n=0;if(0===e.deltaMode)i=e.deltaX,n=e.deltaY;else if(1===e.deltaMode){var s=parseFloat(window.getComputedStyle(this.container).getPropertyValue("font-size"));i=e.deltaX*s,n=e.deltaY*s}else 2===e.deltaMode?(i=t.width/e.deltaX,n=t.height/e.deltaY):(i=e.wheelDeltaX,n=e.wheelDeltaY);if(!0===e.ctrlKey&&e.preventDefault(),this.loadwithBrowsergestures)if(!0===e.shiftKey||!0===e.ctrlKey)this.isZoomActive?(n<0?this.zoomtxt(1.1):this.zoomtxt(.9),this._zoomEventTimer&&(clearTimeout(this._zoomEventTimer),this._zoomEventTimer=void 0),this._zoomEventTimer=setTimeout(function(){clearTimeout(this._zoomEventTimer),this._zoomEventTimer=void 0,this.stopZoomtxt()}.bind(this),500)):this.startZoomtxt();else{var o=Math.ceil(e.target.scrollLeft);(0===o&&o+i<0||o===e.target.scrollWidth-e.target.clientWidth&&i>0)&&e.preventDefault()}else!0===e.shiftKey||!0===e.ctrlKey?this.isZoomActive?(n<0?this.zoom(1.1):this.zoom(.9),this._zoomEventTimer&&(clearTimeout(this._zoomEventTimer),this._zoomEventTimer=void 0),this._zoomEventTimer=setTimeout(function(){clearTimeout(this._zoomEventTimer),this._zoomEventTimer=void 0,this.stopZoom()}.bind(this),500)):this.startZoom({x:e.clientX,y:e.clientY}):(e.preventDefault(),this.startPan(),this.pan({x:this.initialPanPos.x-i,y:this.initialPanPos.y-n}),this.stopPan())}},disableInteractiveText:function(){for(var e=0;e<this.pageViews.length;e++)this.pageViews[e].disableInteractiveText()},enableInteractiveText:function(){for(var e=0;e<this.pageViews.length;e++)this.pageViews[e].enableInteractiveText()},onMouseDown:function(e){this.frameWindow.getViewer().checkContext(e)&&(this.mouseDownClientX=e.clientX,this.mouseDownClientY=e.clientY,this.timeStamp=e.timeStamp,(1===e.button&&!1===this.loadwithBrowsergestures||0===e.button&&this.singleFingerPanEnabled&&0==this.loadwithBrowsergestures&&this.gestures&&"leftMouseDown_pan"==this.gestures.leftMouseDown)&&(e.preventDefault(),this.startPan({x:e.clientX,y:e.clientY})),this.intervalID&&(clearInterval(this.intervalID),this.intervalID=void 0))},onMouseMove:function(e){if(this.frameWindow.getViewer().checkContext(e)&&!1===this.loadwithBrowsergestures&&0!==e.buttons){this.pan({x:e.clientX,y:e.clientY});this.pagesContainer.getBoundingClientRect()}},onMouseUp:function(e){var t=this._checkIfAnyRunningCmds();if(1===e.button&&!1===this.loadwithBrowsergestures)this.frameWindow.getViewer().checkContext(e)&&(e.preventDefault(),this.stopPan());else if(0===e.button&&!1===this.loadwithBrowsergestures){this.singleFingerPanEnabled&&this.gestures&&"leftMouseDown_pan"==this.gestures.leftMouseDown&&(e.preventDefault(),this.stopPan());for(var i=!1,n=e.target;n;){if(n.className.contains("_3dp-doc-page-hyperlinks-layer")){i=!0;break}n=n.parentElement}if(this.singleFingerPanEnabled&&0==i){var s=!1;if(!0===this.frameWindow.getViewer().reviewMode&&Math.abs(e.clientX-this.mouseDownClientX)<10&&Math.abs(e.clientY-this.mouseDownClientY)<10&&(s=this.launchAnnotationEdition(e)),!s&&!this.frameWindow.getViewer().annotationValidateOnClick){var o=500-(e.timeStamp-this.timeStamp);window.getSelection().rangeCount&&0==window.getSelection().getRangeAt(0).collapsed||t||(this.intervalID=setInterval(()=>{Math.abs(e.clientX-this.mouseDownClientX)<10&&Math.abs(e.clientY-this.mouseDownClientY)<10&&this.frameWindow.getViewer().initiateViewModes();clearInterval(this.intervalID),this.intervalID=void 0},o))}}this.frameWindow.getViewer().annotationValidateOnClick=!1}},onMouseLeave:function(e){this.stopPan()},onDoubleClick:function(e){if(this.frameWindow.getViewer().checkContext(e)&&!1===this.loadwithBrowsergestures){var t={x:e.gesture.events[0].event.pageX||e.gesture.events[0].getCurrentPosition().x,y:e.gesture.events[0].event.pageY||e.gesture.events[0].getCurrentPosition().y},i=!1;if(e.from[0].path)for(let t=0;t<e.from[0].path.length;t++)if(e.from[0]&&e.from[0].path[t]&&e.from[0].path[t].id&&e.from[0].path[t].id.contains("pageFinder")){i=!0;break}i||"_3dp-doc-page-text-layer"==e.from[0].path[0].parentNode.className||(e.gesture.events[0].event.preventDefault(),e.gesture.events[0].event.stopPropagation(),"fit-width"===this.viewerState?this.reframe(t):this.fitWidth(t)),this.stopPan()}},onTouchStart:function(e){if(this.frameWindow.getViewer().checkContext(e)){if(this.touchTimeStamp=e.timeStamp,this.touchClientX=e.touches[0].clientX,this.touchClientY=e.touches[0].clientY,this.stopFastScroll(),this.touchPositions=[],1===e.touches.length&&this.singleFingerPanEnabled&&0==this.loadwithBrowsergestures)if(0==this.launchAnnotationEdition({clientX:e.touches[0].clientX,clientY:e.touches[0].clientY})){var t=new o(e.touches[0].clientX,e.touches[0].clientY);this.touchPositions.push(t),this.startPan(t)}else e.stopPropagation();else if(2===e.touches.length){e.preventDefault();var i=e.touches[0].clientX,n=e.touches[0].clientY,s=e.touches[1].clientX,a=e.touches[1].clientY,r={x:.5*(i+s),y:.5*(n+a)},h=s-i,l=a-n;this.initialFingerDistance=Math.sqrt(h*h+l*l),this.loadwithBrowsergestures?this.startZoomtxt():(this.startZoom(r,!0),this.startPan(r))}this.intervalIDTouch&&(clearInterval(this.intervalIDTouch),this.intervalIDTouch=void 0),this._publishCurrentState()}},onTouchMove:function(e){if(this.frameWindow.getViewer().checkContext(e)){if(1===e.touches.length&&this.singleFingerPanEnabled&&0==this.loadwithBrowsergestures){e.preventDefault();var t=new o(e.touches[0].clientX,e.touches[0].clientY);this.touchPositions.push(t),this.pan(t)}else if(2===e.touches.length){e.preventDefault();var i=e.touches[0].clientX,n=e.touches[0].clientY,s=e.touches[1].clientX,a=e.touches[1].clientY,r={x:.5*(i+s),y:.5*(n+a)},h=s-i,l=a-n,c=Math.sqrt(h*h+l*l),d=c/this.initialFingerDistance;this.initialFingerDistance=c,this.loadwithBrowsergestures?this.zoomtxt(d):(this.zoom(d),this.pan(r))}this._publishCurrentState()}},onTouchEnd:function(e){if(this.frameWindow.getViewer().checkContext(e)){var t=this._checkIfAnyRunningCmds(),i=this.touchPositions;if(!0===this.loadwithBrowsergestures)this.stopZoomtxt();else{if(this.stopPan(),this.stopZoom(void 0,!0),0===e.touches.length&&1===e.changedTouches.length&&this.touchPositions.length>1){for(var n=this.container.getBoundingClientRect(),s=Math.sign(this.touchPositions[this.touchPositions.length-1].y-this.touchPositions[this.touchPositions.length-2].y),o=[this.touchPositions[this.touchPositions.length-1].y],a=this.touchPositions.length-2;a>0&&Math.sign(this.touchPositions[a].y-this.touchPositions[a-1].y)===s;a--)o.unshift(this.touchPositions[a].y);if(this.touchPositions=[],o.length>1&&o.length<=12){var r=o[0]-o[o.length-1],h=Math.abs(r);if(h>24){this.scrollDir=r>0?-1:1;var l=3;for(a=.05;a<.5&&a*n.height<h;a+=.05)l+=1;this.scrollDist=this.scrollDir*l*n.height,this.fastScroll()}}}if((!window.getSelection().rangeCount||0!=window.getSelection().getRangeAt(0).collapsed)&&0===e.touches.length&&1===e.changedTouches.length&&this.singleFingerPanEnabled&&!t){var c=e.timeStamp,d=i.length,u=c-this.touchTimeStamp,g=Math.abs(500-u),p=!1;if(d){var m=i[i.length-1].x,f=i[i.length-1].y;Math.abs(m-this.touchClientX)<10&&Math.abs(f-this.touchClientY)<10&&(p=!0)}(1===d||p)&&(this.intervalIDTouch=setInterval(()=>{this.frameWindow.getViewer().initiateViewModes(),clearInterval(this.intervalIDTouch),this.intervalIDTouch=void 0},g))}}this._publishCurrentState()}},onDoubleTap:function(e){if(this.frameWindow.getViewer().checkContext(e)&&!1===this.loadwithBrowsergestures){var t={x:e.gesture.events[0].event.pageX||e.gesture.events[0].getCurrentPosition().x,y:e.gesture.events[0].event.pageY||e.gesture.events[0].getCurrentPosition().y},i=!1;if(e.from[0].path)for(let t=0;t<e.from[0].path.length;t++)if(e.from[0]&&e.from[0].path[t]&&e.from[0].path[t].id&&e.from[0].path[t].id.contains("pageFinder")){i=!0;break}return{doubleTapPos:t,isPageFinder:i}}},onKeyUp:function(e){},onKeyDown:function(e){if(this.frameWindow.getViewer().checkContext(e)&&"_3dp-doc-container"===e.target.id&&!1===e.ctrlKey&&!1===e.shiftKey){let t=e.key,i=this.pagesContainer.getBoundingClientRect(),n=this.container.getBoundingClientRect();switch(t){case"ArrowUp":e.preventDefault(),i.width>n.width?this.scrollUp(50):this.currentPage.index>1&&this.goToPage(this.currentPage.index-1);break;case"ArrowLeft":e.preventDefault(),i.width>n.width?this.scrollRight(50):this.currentPage.index>1&&this.goToPage(this.currentPage.index-1);break;case"ArrowDown":e.preventDefault(),i.width>n.width?this.scrollDown(50):this.currentPage.index<this.pageViews.length&&this.goToPage(this.currentPage.index+1);break;case"ArrowRight":e.preventDefault(),i.width>n.width?this.scrollLeft(50):this.currentPage.index<this.pageViews.length&&this.goToPage(this.currentPage.index+1);break;case"End":e.preventDefault(),this.currentPage.index!==this.pageViews.length&&this.goToPage(this.pageViews.length);break;case"Home":e.preventDefault(),1!==this.currentPage.index&&this.goToPage(1);break;case"PageUp":e.preventDefault(),i.width>n.width?this.scrollUp(n.height):this.currentPage.index>1&&this.goToPage(this.currentPage.index-1);break;case"PageDown":e.preventDefault(),i.width>n.width?this.scrollDown(n.height):this.currentPage.index<this.pageViews.length&&this.goToPage(this.currentPage.index+1)}this._publishCurrentState()}},startPan:function(e){if(this.isPanActive=!0,e)this.initialPanPos=e;else{var t=this.container.getBoundingClientRect(),i=.5*(t.left+t.width),n=.5*(t.top+t.height);this.initialPanPos={x:i,y:n}}this._publishCurrentState()},pan:function(e){if(this.isPanActive){var t=e.x-this.initialPanPos.x,i=e.y-this.initialPanPos.y,n=this.container.getBoundingClientRect(),s=this.pagesContainer.getBoundingClientRect(),o=s.left-n.left+t,a=s.top-n.top+i;this.updateLayout({left:o,top:a,scrollHandleNoAnimation:!0});for(var r=this.getVisiblePages(),h=0;h<r.length;h++)r[h].scale(this.zoomScale),r[h].show();this.initialPanPos=e,this._publishCurrentState()}},stopPan:function(){this.isPanActive&&(this.isPanActive=!1,this.render(this._publishCurrentState.bind(this)))},fastScroll:function(){var e=this.container.getBoundingClientRect(),t=this.pagesContainer.getBoundingClientRect(),i=t.top+this.scrollDist;i>0?i=0:i<e.height-t.height&&(i=e.height-t.height);var n=function(){for(var t=this.getVisiblePages(),s=0;s<t.length;s++)t[s].scale(this.zoomScale),t[s].show();this.scrollAnimationId=requestAnimationFrame(n);var o=this.pagesContainer.getBoundingClientRect().top-e.top;o>i&&-1===this.scrollDir?Math.abs(o-i)<100?this.stopFastScroll():this.scrollTo({y:Math.abs(o-100)}):o<i&&1===this.scrollDir?Math.abs(o-i)<100?this.stopFastScroll():this.scrollTo({y:Math.abs(o+100)}):this.stopFastScroll(),this._publishCurrentState()}.bind(this);n()},stopFastScroll:function(){this.scrollAnimationId&&(cancelAnimationFrame(this.scrollAnimationId),this.scrollAnimationId=void 0,this.render(this._publishCurrentState.bind(this)))},_checkIfAnyRunningCmds:function(){for(var e=!1,t=s.getCommands(this.frameWindow.experience.ctx),i=Object.keys(t),n=0;n<i.length;n++){var o=i[n];if("myDefaultCmd"!=o){var a=t[o];if(a&&a.isRunning()){e=!0;break}}}return e},launchAnnotationEdition:function(e,t){var i=!1,n=this._checkIfAnyRunningCmds(),o={x:e.clientX,y:e.clientY},a=this.frameWindow.getViewer(),r=a.getViewerPositionFromMouse(o);if(r&&0==n&&this.frameWindow.getViewerFrame().offsetHeight>240&&this.frameWindow.getViewerFrame().offsetWidth>240){var h=a.getUnderneathAnnotations({pageNumber:r.pageNumber,positionX:r.pos.x,positionY:r.pos.y});if(h.length){h.splice(1),i=!0;var l=a.getUnProcessedAnnotationInformation({pageNumber:r.pageNumber,annotID:h[0]}),c=this.frameWindow.experience.ctx;l&&l.data&&"text"==l.data.type?(a.shapeEditionData={point:o,directEdit:t},s.getCommands(c).AnnotationCommands2DText&&s.getCommands(c).AnnotationCommands2DText.begin()):(a.shapeEditionData={point:o},s.getCommands(c).AnnotationCommands2DEditShape&&s.getCommands(c).AnnotationCommands2DEditShape.begin())}}return i},startZoomtxt:function(){this.isZoomActive=!0,this.MAX_ZOOM_SCALE=5,this.MIN_ZOOM_SCALE=.5},zoomtxt:function(e,t){if(this.isZoomActive){var i=this.pageViews[0].getTextElementContent(),n=0,s=0;if(t)n=13.599*e,s=e;else s=(n=e*parseFloat(i.style.fontSize))/13.599;s<=5&&s>=.5&&(i.style.fontSize=n+"px",this.zoomScale=s)}},stopZoomtxt:function(){this.isZoomActive&&(this.viewerState="zoomed",this.isZoomActive=!1)},startZoom:function(e,t){this.isZoomActive=!0;var i=this.container.getBoundingClientRect();this.zoomCenter={x:e?e.x-i.left:i.left+.5*i.width,y:e?e.y-i.top:i.top+.5*i.height},document.getSelection()&&document.getSelection().removeAllRanges(),this._publishCurrentState(),this.displayZoomPercent&&(this.enableZoomPercentContainer(),this.timerforZoom&&(clearTimeout(this.timerforZoom),this.timerforZoom=void 0),t||(this.timerforZoom=setTimeout(function(){this.displayZoomPercent&&this.zoomPercentContainer&&(this.zoomPercentContainer.remove(),this.zoomPercentContainer=void 0,this.zoomPercentContainerText=void 0)}.bind(this),1e3)))},zoom:function(e,t){if(this.isZoomActive){var i=this.container.getBoundingClientRect(),n=this.pagesContainer.getBoundingClientRect(),s=n.width,o=n.height,a=n.left-i.left,r=n.top-i.top,h=t?e:s*e/this.getOriginalWidth(),l=this.getOriginalWidth()*h,c=this.getOriginalHeight()*h,d=0,u=0;if(t){var g=s-l;if(1===this.pageViews.length||n.height<=i.height)d=a+.5*g,u=r+.5*(o-c);else d=a+.5*g,u=(r-.5*i.height)*l/n.width,u+=.5*i.height}else{var p=this.zoomCenter.x-a,m=this.zoomCenter.y-r;if(d=a-(p*e-p),u=r-(m*e-m),h>=this.MAX_ZOOM_SCALE||h<=this.MIN_ZOOM_SCALE){h>=this.MAX_ZOOM_SCALE&&(h=this.MAX_ZOOM_SCALE),h<=this.MIN_ZOOM_SCALE&&(h=this.MIN_ZOOM_SCALE),l=this.getOriginalWidth()*h,c=this.getOriginalHeight()*h;g=s-l;if(1===this.pageViews.length||this.pagesContainer.clientHeight<=this.container.clientHeight)d=a+.5*g,u=r+.5*(o-c);else d=a+.5*g,u=(this.pagesContainer.offsetTop-.5*this.container.clientHeight)*l/this.pagesContainer.clientWidth,u+=.5*this.container.clientHeight}l<=i.width?d=.5*(i.width-l):d>0?d=0:d<i.width-l&&(d=i.width-l),c<=i.height?u=.5*(i.height-c):u>0?u=0:u<i.height-c&&(u=i.height-n.height)}if(h<=this.MAX_ZOOM_SCALE&&h>=this.MIN_ZOOM_SCALE){this.pagesContainer.setStyles({width:l+"px",height:c+"px",top:u+"px",left:d+"px"}),this.zoomScale=h;for(var f=0;f<this.pageViews.length;f++)this.pageViews[f].hide();var D=this.getVisiblePages();for(f=0;f<D.length;f++)D[f].scale(this.zoomScale),D[f].show()}if(this.displayZoomPercent&&this.zoomPercentContainer&&this.zoomPercentContainerText){var w=100*this.zoomScale;w=Math.ceil(w),this.zoomPercentContainerText.setText(" "+w+"%")}this._publishCurrentState()}},stopZoom:function(){for(var e=0;e<this.pageViews.length;e++)this.pageViews[e].markForRender();this.viewerState="zoomed",this.initialFingerDistance=0,this.zoomCenter=void 0,this.isZoomActive=!1},enableZoomPercentContainer:function(){this.zoomPercentContainer||(this.zoomPercentContainer=new e.Element("div",{id:"_3dp-zoomPercent-maincontainer",styles:{position:"absolute",left:"5px",top:"5px","z-index":5,width:"fit-content","background-color":"#f9f9f9","background-color":"rgb(119, 121, 124)",opacity:"80%",color:"#939393","font-family":"3ds","font-size":"24px","padding-left":"5px","padding-right":"5px","padding-top":"3px","padding-bottom":"3px",opacity:.4,"box-shadow":"0px 0px 3px 0px rgba(0, 0, 0, 0.5)","border-radius":"8px"}}).inject(this.container),this.zoomPercentContainerText=new e.Element("div",{id:"_3dp-zoomPercent-Text",styles:{"font-size":"24px",color:"white",margin:"2px",display:"inline-block","font-family":"Arial, Helvetica, sans-serif"}}).inject(this.zoomPercentContainer));var t=100*this.zoomScale;t=Math.ceil(t),this.zoomPercentContainerText.setText(" "+t+"%")},_publishCurrentStateWithoutUpdateLayout:function(e){var t=this.pagesContainer.getBoundingClientRect();this.publishUpdate({pageIndex:this.currentPage.index,top:e?e.top:t.top,left:e?e.left:t.left,scale:this.zoomScale,isZoomActive:this.isZoomActive})},_publishCurrentState:function(e){this.updateLayout({}),this._publishCurrentStateWithoutUpdateLayout(e)},update:function(e){e&&(this._goToPage(e.pageIndex),this.updateLayout({top:e.top,left:e.left}))},getIfAnnotationRunning:function(){return!this.singleFingerPanEnabled}})}),define("DS/3DPlay2DExperience/DocumentViewer/DocumentViews/SinglePageView",["DS/3DPlay2DExperience/DocumentViewer/DocumentViews/DocumentView","DS/3DPlay2DExperience/DocumentViewer/PageView","DS/3DPlayAnnotationUtils/ShapeUtils","DS/WebUtils/Vector2"],function(e,t,i,n){"use strict";return e.extend({init:function(e){this._parent(e),this.pageTopPositions=[],this.useTapEvent=!0,this.loadwithBrowsergestures=e.loadwithBrowsergestures,this.PAGE_MARGIN=0,this.originalWidth=0===this.angle||180===this.angle?e.doc.getDocumentWidth():e.doc.getDocumentWidthAfterRotation(),this.originalHeight=0===this.angle||180===this.angle?e.doc.getDocumentHeight():e.doc.getDocumentHeightAfterRotation(),this.aspectRatio=this.originalWidth/this.originalHeight;for(var t=0;t<this.pageViews.length;t++)this.pageViews[t].setPosition({top:0,left:0});this.pagesContainer.inject(this.container),this._goToPage(e.currentPageIndex||1)},getPage:function(e){for(let t=0;t<this.pageViews.length;t++)if(this.pageViews[t].index===e)return this.pageViews[t]},_goToPage:function(e){if(e>=1&&e<=this.pageViews.length){if(this.currentPage){if(this.currentPage.index===e)return;this.currentPage.unrender(),this.currentPage.getPageContainer().remove()}for(var t=0;t<this.pageViews.length;t++)if(e===this.pageViews[t].index){this.currentPage=this.pageViews[t],this.currentPage.getPageContainer().inject(this.pagesContainer),this.loadwithBrowsergestures?this.pagesContainer.setStyles({width:"100%",height:"100%"}):(this.pagesContainer.setStyles({position:"absolute"}),this.updateLayout({width:this.pageViews[t].originalWidth*this.zoomScale,height:this.pageViews[t].originalHeight*this.zoomScale}));break}this.MIN_ZOOM_SCALE=this.currentPage.pageInfo.MIN_ZOOM_SCALE,this.MAX_ZOOM_SCALE=this.currentPage.pageInfo.MAX_ZOOM_SCALE,this._parent()}},goToPage:function(e){this._goToPage(e),this.publishUpdate({pageIndex:e})},getOriginalWidth:function(){return this.currentPage.originalWidth},getOriginalHeight:function(){return this.currentPage.originalHeight},getCurrentPage:function(){return this.currentPage},getVisiblePages:function(){var e=this.container.getBoundingClientRect();return e.height>0&&e.width>0?[this.currentPage]:[]},getOriginalPageInfoWithMargin:function(e){if(e){for(var t=0,i=0,n=0,s=0;s<this.pageViews.length;s++)if(this.pageViews[s].index===e){n=this.pageViews[s].getOriginalHeight()+2*this.PAGE_MARGIN,i=this.pageViews[s].getOriginalWidth()+2*this.PAGE_MARGIN,t=.5*(this.pageViews[s].getOriginalWidth()-i);break}return{left:t,top:0,height:n,width:i}}},render:function(e){var t=function(t){t&&e&&e()}.bind(this);this.currentPage.render({scale:this.zoomScale,onRenderCompleteCB:t})},getCurrentState:function(){for(var e=this.container.getBoundingClientRect(),t=this.pagesContainer.getBoundingClientRect(),i=t.width,n=e.left-t.left,s=this.originalHeight*this.zoomScale,o=0,a=0;a<this.pageViews.length;a++){var r=this.pageViews[a].getOriginalHeight()*this.zoomScale;if(!(this.pageViews[a].index<this.currentPage.index)){this.pageViews[a].index===this.currentPage.index&&r>e.height&&(o+=Math.abs(t.top-e.top));break}o+=r}var h=this.pageViews.length*e.height,l=a*e.height;return s<h&&(s=h,o=l),{width:i,height:s,top:o,left:n}},scrollTo:function(e){let t,i,n=this.container.getBoundingClientRect(),s=0,o=Math.round(e.y);if(0===this.pageTopPositions.length||this.prevZoomScale!==this.zoomScale){this.prevZoomScale=this.zoomScale,this.pageTopPositions=[0];for(let e=0;e<this.pageViews.length-1;e++)(t=this.pageViews[e].originalHeight*this.zoomScale)<=n.height&&(t=n.height),s+=t,this.pageTopPositions.push(s)}for(let e=0;e<this.pageTopPositions.length-1;e++)if(o>=this.pageTopPositions[e]&&o<this.pageTopPositions[e+1]){i=e;break}o>=this.pageTopPositions[this.pageTopPositions.length-1]&&(i=this.pageTopPositions.length-1),this._goToPage(i+1),this.currentPage.scale(this.zoomScale),this.currentPage.show(),o-=this.pageTopPositions[i],this.updateLayout({top:-1*o})},onMouseWheel:function(e){if(this.frameWindow.getViewer().checkContext(e))if(this.gestures&&this.gestures.mouseWheel)this[this.gestures.mouseWheel](e);else{var t=this.pagesContainer.getBoundingClientRect(),i=this.container.getBoundingClientRect();if(t.height<=i.height&&!1===e.shiftKey&&0==e.ctrlKey){if(e.preventDefault(),!this._scrollEventTimer){this._scrollEventTimer=setTimeout(function(){clearTimeout(this._scrollEventTimer),this._scrollEventTimer=void 0}.bind(this),400);var n=0;if(0===e.deltaMode)n=e.deltaY;else if(1===e.deltaMode){var s=parseFloat(window.getComputedStyle(this.container).getPropertyValue("font-size"));n=e.deltaY*s}else n=2===e.deltaMode?i.height/e.deltaY:e.wheelDeltaY;n<0&&this.currentPage.index>1?(this.frameWindow.experience.publish("3DPLAY/2DEXP/STATECHANGE_PAGE",{}),this.goToPage(this.currentPage.index-1)):n>0&&this.currentPage.index<this.pageViews.length&&(this.frameWindow.experience.publish("3DPLAY/2DEXP/STATECHANGE_PAGE",{}),this.goToPage(this.currentPage.index+1)),this.render()}}else this._parent(e)}},mouseWheel_zoom:function(e){if(this.frameWindow.getViewer().checkContext(e)){this.pagesContainer.getBoundingClientRect();var t=this.container.getBoundingClientRect(),i=0;if(0===e.deltaMode)e.deltaX,i=e.deltaY;else if(1===e.deltaMode){var n=parseFloat(window.getComputedStyle(this.container).getPropertyValue("font-size"));e.deltaX*n,i=e.deltaY*n}else 2===e.deltaMode?(t.width/e.deltaX,i=t.height/e.deltaY):(e.wheelDeltaX,i=e.wheelDeltaY);e.preventDefault(),this.startZoom({x:e.clientX,y:e.clientY});var s=100*this.zoomScale;s=Math.ceil(s);if(i<0){var o=this.calculateNextZoomFactor(s,"forward");this.zoom(o)}else{o=this.calculateNextZoomFactor(s,"backward");this.zoom(o)}this.mouseWheeltoken&&(clearTimeout(this.mouseWheeltoken),this.mouseWheeltoken=void 0),this.mouseWheeltoken=setTimeout(function(){this.isZoomActive&&this.stopZoom()}.bind(this),300)}},calculateNextZoomFactor:function(e,t){var i=1;if("forward"==t)if(e<100)i=e+8>=100?100/e:(e+8)/e;else if(e<200)i=e+16>=200?200/e:(e+16)/e;else if(e<300)i=e+40>=300?300/e:(e+40)/e;else{i=(e+(n=100-(n=e%100)))/e}else if(e<=100)i=(e-8)/e;else if(e<=200)i=e-16<100?100/e:(e-16)/e;else if(e<=300)i=e-40<200?200/e:(e-40)/e;else{var n;0==(n=e%100)&&(n=100),i=(e-n)/e}return i},onDoubleTap:function(e){if(this.frameWindow.getViewer().checkContext(e)){var t=this._parent(e);t.isPageFinder||(this.isMobile&&"zoomed"===this.viewerState?this.reframe(t.doubleTapPos):this.isMobile&&"fit-document"===this.viewerState?(this.startZoom(t.doubleTapPos),this.zoom(2),this.stopZoom()):this.isMobile&&"reframe"===this.viewerState&&(this.startZoom(t.doubleTapPos),this.zoom(2),this.stopZoom()))}},onTouchEnd:function(e){if(this.frameWindow.getViewer().checkContext(e))if(0===e.touches.length&&1===e.changedTouches.length&&this.singleFingerPanEnabled&&0==this.loadwithBrowsergestures&&this.touchPositions.length>1){var t=this.pagesContainer.getBoundingClientRect(),n=this.container.getBoundingClientRect(),s=this.getCurrentPage();if(t.width<=n.width&&t.height<=n.height){e.preventDefault();n=this.container.getBoundingClientRect();var o=!1;if(Math.abs(this.touchPositions[this.touchPositions.length-1].x-this.touchClientX)<10&&Math.abs(this.touchPositions[this.touchPositions.length-1].y-this.touchClientY)<10&&(o=!0),o)this._parent(e);else{if("line"===i.shapeEval(this.touchPositions,{type:"line"}).shape.type){var a,r=this.touchPositions[this.touchPositions.length-1].y-this.touchPositions[0].y,h=this.touchPositions[this.touchPositions.length-1].x-this.touchPositions[0].x,l=180*Math.atan2(r,h)/Math.PI;l<=45&&l>=-45?a=s.index-1:l>=135&&l<=180||l>-180&&l<=-135?a=s.index+1:l<135&&l>45?a=s.index-1:l<-45&&l>-135&&(a=s.index+1),this.goToPage(a),this.render()}else this._parent(e)}}else this._parent(e)}else this._parent(e)},onKeyDown:function(e){if(this.frameWindow.getViewer().checkContext(e)){let i=this.pagesContainer.getBoundingClientRect(),n=this.container.getBoundingClientRect();var t=this.currentPage.index;this._parent(e),this.currentPage.index!==t&&(i.width>n.width?this.reframe():this.render())}},stopZoom:function(e,t){this.isZoomActive&&(this._parent(),e||this.render(this._publishCurrentState.bind(this))),this.displayZoomPercent&&t&&(this.timerforZoom&&(clearTimeout(this.timerforZoom),this.timerforZoom=void 0),this.timerforZoom=setTimeout(function(){this.displayZoomPercent&&this.zoomPercentContainer&&(this.zoomPercentContainer.remove(),this.zoomPercentContainer=void 0,this.zoomPercentContainerText=void 0)}.bind(this),1e3))},dispose:function(){this.mouseWheeltoken&&(clearTimeout(this.mouseWheeltoken),this.mouseWheeltoken=void 0),this._parent()}})}),define("DS/3DPlay2DExperience/DocumentViewer/PageFinderComponent",["DS/3DPlay2DExperience/DocumentViewer/BaseComponent","UWA/Core","DS/Controls/SpinBox","DS/Controls/Button","css!DS/3DPlay2DExperience/DocumentViewer/PageFinderComponent","DS/Controls/CustomizableDecorator","DS/WebSystem/Nls","DS/Controls/DecoratorManager","i18n!DS/3DPlay2DExperience/assets/nls/3DPlay2DExperience"],function(e,t,i,n,s,o,a,r,h){"use strict";return e.extend({init:function(e){if(this._parent(e),this.uiElements={},this.pageFinderViewerContainer=e.viewerContainer,this.pageFinderContainer=e.documentContainer,this.publishUpdate=e.onUpdate,this.pageLength=e.pageLength,this.pageLabelListInput=e.pageLabelList||[],this.pageLabelList={},this.pageLabelListInput)for(let e=0;e<this.pageLabelListInput.length;e++)this.pageLabelList[e+1]=this.pageLabelListInput[e];this.currentPageInfo={index:e.currentPageIndex,label:this.pageLabelList[e.currentPageIndex]},this.isMobile=e.isMobile,this.MAB=e.MAB,this.PageFinderstate=0,this._isEnabled=!0,this._isVisible=!0,this.uiElements.PageFinderMainContainer=new t.Element("div",{id:"_3dp-pageFinder-maincontainer",styles:{position:"absolute",left:"5px",top:"5px","z-index":5,"background-color":"white","border-radius":"8px",width:"fit-content"}}).inject(this.pageFinderViewerContainer),this.isMobile&&(this.uiElements.veil=new t.Element("div",{id:"_3dp-pageFinder-veil",styles:{height:"100%",width:"100%","background-color":"rgb(0,0,0)",opacity:"0.25","z-index":4,position:"absolute"},events:{mousedown:function(e){e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault(),this.showPrimaryView(),this.hideSwitchView(),this.uiElements.veil.hide(),this.uiElements.PageFinderMainContainer.style.top="5px"}.bind(this)}}).inject(this.pageFinderViewerContainer),this.uiElements.veil.hide()),this.buildPrimaryView(),this.buildSwitchView()},disable:function(){this._isEnabled=!1},enable:function(){this._isEnabled=!0},buildPrimaryView:function(){if(this.uiElements.pageNumberIndicator=new t.Element("div",{id:"_3dp-pageFinder-number-indicator",styles:{"background-color":"#f9f9f9","background-color":"rgb(119, 121, 124)",opacity:"80%",color:"#939393","font-family":"3ds","font-size":"16px","padding-left":"5px","padding-right":"5px","padding-top":"3px","padding-bottom":"3px",opacity:.4,"box-shadow":"0px 0px 3px 0px rgba(0, 0, 0, 0.5)","border-radius":"8px"},events:{click:function(e){this._isEnabled&&this.switchToSwitchView()}.bind(this),onTap:function(e){this._isEnabled&&this.switchToSwitchView()}.bind(this)}}).inject(this.uiElements.PageFinderMainContainer),this.uiElements.currentPageNumberDisplayDiv=new t.Element("div",{styles:{"text-align":"center",display:"inline-block",color:"white",margin:"2px","font-family":"Arial, Helvetica, sans-serif"}}).inject(this.uiElements.pageNumberIndicator),this.uiElements.totalPagesCountDisplayDiv=new t.Element("div",{id:"_3dp-pageFinder-Display2",styles:{"font-size":"16px",color:"white",margin:"2px",display:"inline-block","font-family":"Arial, Helvetica, sans-serif"}}).inject(this.uiElements.pageNumberIndicator),this.currentPageInfo.label){let e=this.currentPageInfo.label+"  ("+this.currentPageInfo.index+" / "+this.pageLength+")  ";this.uiElements.totalPagesCountDisplayDiv.setText(e)}else this.uiElements.totalPagesCountDisplayDiv.setText(" / "+this.pageLength)},buildSwitchView:function(){this.uiElements.dialogBoxparentContainer=new t.Element("div",{id:"_3dp-pageFinder-dialogBox-maincontainer",styles:{border:"0px solid black","border-radius":"5px","padding-left":"6px","padding-top":"6px","box-shadow":"rgba(0, 0, 0, 0.24) 0px 3px 8px",height:this.isMobile?"115px":"85px",width:"212px",background:"white",position:"relative",top:"0px",left:"0px"}}).inject(this.uiElements.PageFinderMainContainer),this.uiElements.textDiv=new t.Element("div",{id:"_3dp-pageFinder-dialogBox-textDiv",styles:{"margin-bottom":"2px",width:"200px"}}).inject(this.uiElements.dialogBoxparentContainer);var e=new t.Element("span",{id:"_3dp-pageFinder-dialogBox-span",styles:{color:"black"}}).inject(this.uiElements.textDiv);if(void 0!==h&&void 0!==h.PageFinderTitle&&""!==h.PageFinderTitle){var s=h.PageFinderTitle+"( 1 - "+this.pageLength+")";e.setContent(s)}var a=new o({items:{viewNumbers:["1","2","3","arrowUp","4","5","6","arrowDown","7","8","9","delete","0","validate"]}});var l;if(r.registerDecorator("WUXSpecialDecorator",a),this.uiElements.pageFinderSpinner=new i({value:1,stepValue:1,minValue:1,maxValue:this.pageLength,domId:"_3dp-pageFinder-spinbox",customValidator:function(e,t){let i;if(t){i=Number(this.uiElements.pageFinderSpinner.value)+t}else i=Number(this.getPageNumber(e).pageIndex);return i}.bind(this),displayCustomizer:function(e){let t=this.pageLabelList[e];if(void 0!==t)return t}.bind(this)}).inject(this.uiElements.dialogBoxparentContainer),this.currentPageInfo.label){var c=Number(this.currentPageInfo.label);l=isNaN(c)?this.currentPageInfo.label:c}else l=this.currentPageInfo.index;this.uiElements.pageFinderSpinner.value=l;var d,u=this.uiElements.pageFinderSpinner.elements.container.getChildren();for(let e=0;e<u.length;e++)if(u[e].className&&u[e].className.contains("wux-input-container")){d=u[e];break}d.children[0].style.fontSize="16px",this.uiElements.validateButton=new n({domId:"_3dp-pageFinder-validate",label:"OK",emphasize:"primary"}).inject(this.uiElements.dialogBoxparentContainer),this.uiElements.validateButton.addEventListener("click",function(e){e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault(),this.validateEvent()}.bind(this)),this.uiElements.validateButton.addEventListener("keyup",function(e){e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault(),this.validateEvent()}.bind(this))},hidePrimaryView:function(){this.uiElements.pageNumberIndicator&&(this.uiElements.pageNumberIndicator.style.display="none",this.uiElements.currentPageNumberDisplayDiv.style.display="none",this.uiElements.totalPagesCountDisplayDiv.style.display="none")},showPrimaryView:function(){this._isVisible=!0,this.PageFinderstate=0,this.uiElements.pageNumberIndicator.style.display="initial",this.uiElements.totalPagesCountDisplayDiv.style.display="initial",this.uiElements.currentPageNumberDisplayDiv.style.display="initial",this.uiElements.PageFinderMainContainer.style.left="5px",this.uiElements.PageFinderMainContainer.style.top="5px"},showSwitchView:function(){if(this._isVisible=!0,this.uiElements.pageFinderSpinner){this.PageFinderstate=1,this.uiElements.pageFinderSpinner.show();let e=this.currentPageInfo.index;this.uiElements.pageFinderSpinner.value=e,this.uiElements.dialogBoxparentContainer.style.display="block",this.isMobile&&(this.uiElements.veil.show(),this.MAB.showNone(),this.uiElements.PageFinderMainContainer.style.left=.5*(this.pageFinderContainer.offsetWidth-this.uiElements.dialogBoxparentContainer.offsetWidth)+"px",this.uiElements.PageFinderMainContainer.style.top=.5*(this.pageFinderContainer.offsetHeight-this.uiElements.dialogBoxparentContainer.offsetHeight)+"px")}},hideSwitchView:function(){this.uiElements.pageFinderSpinner&&(this.uiElements.dialogBoxparentContainer.style.display="none",this.uiElements.pageFinderSpinner.hide()),this.isMobile&&(this.uiElements.veil.hide(),this.MAB.show())},switchToPrimaryView:function(){this.hideSwitchView(),this.showPrimaryView()},switchToSwitchView:function(){this.hidePrimaryView(),this.showSwitchView()},setPage:function(e){var t=e.pageIndex,i=e.pageLabel;this.currentPageInfo={index:t,label:i},void 0!==this.currentPageInfo.label?(this.uiElements.totalPagesCountDisplayDiv.setText("  ( "+t+" / "+this.pageLength+" )  "),this.uiElements.currentPageNumberDisplayDiv&&this.uiElements.currentPageNumberDisplayDiv.setText(this.currentPageInfo.label)):this.uiElements.currentPageNumberDisplayDiv&&this.uiElements.currentPageNumberDisplayDiv.setText(t)},update:function(e){this.setPage(e)},hide:function(){this._isVisible=!1,this.hidePrimaryView(),this.hideSwitchView()},isVisible:function(){return this._isVisible},getPageNumber:function(e){let t={};if(this.pageLabelListInput.length>0){let i=this.uiElements.pageFinderSpinner.value;if(e===this.pageLabelList[i])t={pageIndex:i,pageLabel:e};else{let n=Object.keys(this.pageLabelList),s=n.find(t=>this.pageLabelList[t]===e);t=s?{pageIndex:s,pageLabel:e}:void 0!==n[Number(e)-1]?{pageIndex:Number(e),pageLabel:this.pageLabelList[Number(e)]}:{pageIndex:i,pageLabel:this.pageLabelList[i]}}}else{let i=Number(e);t=!isNaN(i)&&i<=this.pageLength&&0!==i?{pageIndex:i}:{pageIndex:this.currentPageInfo.index}}return t},validateEvent:function(e){if(1===this.PageFinderstate){let t,i=this.uiElements.pageFinderSpinner.value,n=this.uiElements.pageFinderSpinner.getInputText();t=e?this.getPageNumber(n):this.pageLabelListInput.length>0?{pageIndex:i,pageLabel:n}:{pageIndex:i},this.setPage(t),this.publishUpdate({pageIndex:Number(t.pageIndex)}),this.hideSwitchView(),this.showPrimaryView()}},dispose:function(){this.uiElements&&(this.uiElements.currentPageNumberDisplayDiv&&(this.uiElements.currentPageNumberDisplayDiv.remove(),this.uiElements.currentPageNumberDisplayDiv=void 0),this.uiElements.totalPagesCountDisplayDiv&&(this.uiElements.totalPagesCountDisplayDiv.remove(),this.uiElements.totalPagesCountDisplayDiv=void 0),this.uiElements.pageNumberIndicator&&(this.uiElements.pageNumberIndicator.remove(),this.uiElements.pageNumberIndicator=void 0),this.uiElements.textDiv&&(this.uiElements.textDiv.remove(),this.uiElements.textDiv=void 0),this.uiElements.pageFinderSpinner&&(this.uiElements.pageFinderSpinner.remove(),this.uiElements.pageFinderSpinner=void 0),this.uiElements.validateButton&&(this.uiElements.validateButton.remove(),this.uiElements.validateButton=void 0),this.uiElements.veil&&(this.uiElements.veil.remove(),this.uiElements.veil=void 0),this.uiElements.dialogBoxparentContainer&&(this.uiElements.dialogBoxparentContainer.remove(),this.uiElements.dialogBoxparentContainer=void 0),this.uiElements.PageFinderMainContainer&&(this.uiElements.PageFinderMainContainer.remove(),this.uiElements.PageFinderMainContainer=void 0))}})}),define("DS/3DPlay2DExperience/DocumentViewer/DocumentBookmarkPanel",["UWA/Core","DS/3DPlay2DExperience/DocumentViewer/BaseComponent","DS/UIKIT/Tooltip","DS/Controls/Accordeon"],function(e,t,i,n){"use strict";return t.extend({init:function(e){this._parent(e),this.buildUI(e.bookmarks)},buildUI:function(t){t&&(this.bookmarksContainer=new e.Element("div",{id:"_3dp-doc-bookmark",styles:{width:"100%",height:"100%",overflow:"auto"}}),this.bookmarkUI(t).forEach(e=>{e.inject(this.bookmarksContainer)}))},update:function(e){},bookmarkUI:function(t){var s=[];return t.forEach(t=>{var o,a=t.dest;if(t.items.length>0){var r=this.bookmarkUI(t.items),h=new e.Element("div",{styles:{width:"100%",height:"100%"}});r.forEach(e=>{e.inject(h)});var l=[{header:t.title,content:h}];o=new n({items:l,style:"simple"})}else o=e.Element("div",{id:t.title,value:t,text:t.title,styles:{cursor:"pointer","border-style":"solid","border-color":"#368ec4","box-shadow":"0px 0px 1px #d1d4d4",padding:"5px","background-color":"#f1f1f1"},events:{mouseenter:function(){this.setStyles({"background-color":"#f1f1f1"})},mouseleave:function(){this.setStyles({"background-color":"#f1f1f100"})},click:function(e){this.publishUpdate({dest:a})}.bind(this)}}),new i({target:o,body:t.title});s.push(o)}),s},getContainer:function(){return this.bookmarksContainer},dispose:function(){this.bookmarksContainer&&(this.bookmarksContainer.remove(),this.bookmarksContainer=void 0)}})}),define("DS/3DPlay2DExperience/DocumentViewer/DocumentViews/PresentationView",["DS/3DPlay2DExperience/DocumentViewer/DocumentViews/SinglePageView","DS/WebSystem/BrowserInfos"],function(e,t){"use strict";return e.extend({init:function(e){this._parent(e),this._isFullscreenActive=!1;let i="safari"==t.browser.browser.name.toLocaleLowerCase()?"webkitfullscreenchange":"fullscreenchange",n=function(t){this._isFullscreenActive?(this.frameWindow.experience.args.container.removeEventListener(i,n),e.onFullscreenEnd(),t.stopPropagation()):(this._isFullscreenActive=!0,this.reframe())}.bind(this);this.frameWindow.experience.args.container.addEventListener(i,n),this.frameWindow.experience.args.container.requestFullscreen(),this.container.addEventListener("contextmenu",function(e){e.preventDefault()}),this.disableKeyboardEvents(),this.container.addEventListener("keydown",this.onKeyDown.bind(this)),this.container.focus()},onMouseDown:function(e){e.preventDefault(),0===e.button?this.goToPage(this.currentPage.index+1):2===e.button&&(e.preventDefault(),this.goToPage(this.currentPage.index-1)),this.reframe()},onTouchStart:function(e){e.gestures?e.gesture.events[0].event.preventDefault():e.preventDefault(),this._parent(e)},onTouchMove:function(e){e.gestures?e.gesture.events[0].event.preventDefault():e.preventDefault(),this._parent(e)},onTouchEnd:function(e){e.gestures?e.gesture.events[0].event.preventDefault():e.preventDefault(),this._parent(e)}})}),define("DS/3DPlay2DExperience/DocumentViewer/ScrollerComponent",["DS/3DPlay2DExperience/DocumentViewer/BaseComponent","UWA/Core"],function(e,t){"use strict";return e.extend({init:function(e){this._parent(e),this.container=e.container,this._android=e.isAndroid,this.timer=void 0,this.initialMousePos=0,this.scrollerFlag=!1,this.dragOn=!1,this.dragPaused=!1,this.CONTAINER_MOUSE_EVENTS={mousemove:function(e){this.dragOn&&this.onScrollHandleDrag(e.clientY)}.bind(this),mouseup:function(e){this.dragOn&&(this.onScrollHandleDragEnd(),this.dragOn=!1,this.dragPaused=!1)}.bind(this),mouseleave:function(e){this.dragOn&&(this.onScrollHandleDragEnd(),this.dragOn=!1,this.dragPaused=!0)}.bind(this),mouseenter:function(e){this.dragPaused&&1===e.buttons&&(this.dragOn=!0,this.onScrollHandleDrag(e.clientY)),this.dragPaused=!1}.bind(this)},this.SCROLLBAR_MOUSE_EVENTS={mousedown:function(e){this.checkContext(e)&&this.onScrollStart(e.clientY)}.bind(this),mousemove:function(e){this.dragOn&&this.onScrollHandleDrag(e.clientY)}.bind(this),mouseup:function(e){this.scrollerFlag=!1,this.onScrollHandleDragEnd(),this.dragOn&&(this.dragOn=!1,this.dragPaused=!1)}.bind(this)},this.CONTAINER_TOUCH_EVENTS={touchmove:function(e){this.dragOn&&this.onScrollHandleDrag(e.touches[0].clientY)}.bind(this),touchend:function(e){this.dragOn&&(this.onScrollHandleDragEnd(),this.dragOn=!1,this.dragPaused=!1)}.bind(this)},this.SCROLLBAR_TOUCH_EVENTS={touchstart:function(e){this.checkContext(e)&&this.onScrollStart(e.touches[0].clientY)}.bind(this),touchmove:function(e){this.dragOn&&this.onScrollHandleDrag(e.touches[0].clientY)}.bind(this),touchend:function(e){this.scrollerFlag=!1,this.onScrollHandleDragEnd(),this.dragOn&&(this.dragOn=!1)}.bind(this)},this.SCROLLHANDLE_MOUSE_EVENTS={mousedown:function(e){this.checkContext(e)&&(this.dragOn=!0)}.bind(this),mouseup:function(e){this.dragOn=!1,this.dragPaused=!1}.bind(this)},this.SCROLLHANDLE_TOUCH_EVENTS={touchstart:function(e){this.dragOn=!0}.bind(this),touchend:function(e){this.dragOn=!1}.bind(this)},this.buildUI()},buildUI:function(){this.uiElements={},this.uiElements.scrollBar=new t.Element("div",{id:"_3dp-doc-scrollBar",context:this.context,styles:{width:"12px","background-color":"#F1F1F1","box-shadow":"inset 1px 0px 1px #d1d4d4"}}).inject(this.container),this._android?(this.uiElements.scrollBarHandleExtraDiv=new t.Element("div",{id:"_3dp-doc-scrollBarHandleExtraDiv",context:this.context,styles:{width:"25px",position:"absolute",right:0,height:"100%","z-index":2}}).inject(this.uiElements.scrollBar),this.uiElements.scrollHandle=new t.Element("div",{id:"_3dp-doc-scrollHandle",context:this.context,styles:{"background-color":"#C1C1C1",position:"absolute","min-height":"25px",width:"12px",right:"0px"}}).inject(this.uiElements.scrollBarHandleExtraDiv)):this.uiElements.scrollHandle=new t.Element("div",{id:"_3dp-doc-scrollHandle",context:this.context,styles:{"background-color":"#C1C1C1",position:"relative","min-height":"25px"}}).inject(this.uiElements.scrollBar),this.enableMouseEvents(),this.enableTouchEvents()},applyScrollHandleHeightAndTop:function(e,t){e.hasOwnProperty("top")&&(e.top>t?e.top=t:e.top<0&&(e.top=0),this.uiElements.scrollHandle.setStyles({top:e.top+"px"})),e.hasOwnProperty("height")&&this.uiElements.scrollHandle.setStyles({height:e.height+"px"})},onScrollStart:function(e){this.initialMousePos=e,this.scrollerFlag=!0,this.initialScrollHandlePos=parseFloat(this.uiElements.scrollHandle.style.top.split("px")[0]);var t=this.initialMousePos-this.uiElements.scrollBar.getBoundingClientRect().top;if(!1===this.dragOn){this.onHoldPress(t);var i=this;setTimeout(function(){!0===i.scrollerFlag&&!1===i.dragOn&&(i.timer=setInterval(function(){null!==i.onHoldPress(t)&&!1!==i.scrollerFlag||(clearInterval(i.timer),i.timer=void 0)},100))},200)}},onScrollHandleDrag:function(e){if(this.dragOn){let i=e-this.initialMousePos;var t={top:this.initialScrollHandlePos+i};this.applyScrollHandleHeightAndTop(t,scrollHandleTopPosLimit),this.publishUpdate({currentValue:t.top*this.contentToScrollRatio})}},onScrollHandleDragEnd:function(){var e=parseFloat(this.uiElements.scrollHandle.style.top.split("px")[0]);clearInterval(this.timer),this.timer=void 0,this.publishUpdate({finalValue:e*this.contentToScrollRatio})},onHoldPress:function(e){var t,i=parseFloat(this.uiElements.scrollHandle.style.top.split("px")[0]),n=Math.abs(i-e),s=Math.min(n,this.container.clientHeight/this.contentToScrollRatio);if(i<e)t=i+s;else{if(!(i>e))return null;t=i-s}var o={top:t};return this.applyScrollHandleHeightAndTop(o,scrollHandleTopPosLimit),this.publishUpdate({currentValue:o.top*this.contentToScrollRatio}),o.top},enableMouseEvents:function(){var e=Object.keys(this.CONTAINER_MOUSE_EVENTS);for(let t=0;t<e.length;t++){let i=e[t];this.container.addEventListener(i,this.CONTAINER_MOUSE_EVENTS[i])}var t=Object.keys(this.SCROLLBAR_MOUSE_EVENTS);for(let e=0;e<t.length;e++){let i=t[e];this.uiElements.scrollBar.addEventListener(i,this.SCROLLBAR_MOUSE_EVENTS[i])}var i=Object.keys(this.SCROLLHANDLE_MOUSE_EVENTS);for(let e=0;e<i.length;e++){let t=i[e];this.uiElements.scrollHandle.addEventListener(t,this.SCROLLHANDLE_MOUSE_EVENTS[t]),this.uiElements.scrollBarHandleExtraDiv&&this.uiElements.scrollBarHandleExtraDiv.addEventListener(t,this.SCROLLHANDLE_MOUSE_EVENTS[t])}},disableMouseEvents:function(){var e=Object.keys(this.CONTAINER_MOUSE_EVENTS);for(let t=0;t<e.length;t++){let i=e[t];this.container.removeEventListener(i,this.CONTAINER_MOUSE_EVENTS[i])}for(var t=Object.keys(this.SCROLLBAR_MOUSE_EVENTS),i=0;i<t.length;i++){var n=t[i];this.uiElements.scrollBar.removeEventListener(n,this.SCROLLBAR_MOUSE_EVENTS[n])}var s=Object.keys(this.SCROLLHANDLE_MOUSE_EVENTS);for(i=0;i<s.length;i++){n=s[i];this.uiElements.scrollHandle.removeEventListener(n,this.SCROLLHANDLE_MOUSE_EVENTS[n]),this.uiElements.scrollBarHandleExtraDiv&&this.uiElements.scrollBarHandleExtraDiv.removeEventListener(n,this.SCROLLHANDLE_MOUSE_EVENTS[n])}},enableTouchEvents:function(){var e=Object.keys(this.CONTAINER_TOUCH_EVENTS);for(let t=0;t<e.length;t++){let i=e[t];this.container.addEventListener(i,this.CONTAINER_TOUCH_EVENTS[i])}var t=Object.keys(this.SCROLLBAR_TOUCH_EVENTS);for(let e=0;e<t.length;e++){let i=t[e];this.uiElements.scrollBar.addEventListener(i,this.SCROLLBAR_TOUCH_EVENTS[i])}var i=Object.keys(this.SCROLLHANDLE_TOUCH_EVENTS);for(let e=0;e<i.length;e++){let t=i[e];this.uiElements.scrollHandle.addEventListener(t,this.SCROLLHANDLE_TOUCH_EVENTS[t]),this.uiElements.scrollBarHandleExtraDiv&&this.uiElements.scrollBarHandleExtraDiv.addEventListener(t,this.SCROLLHANDLE_TOUCH_EVENTS[t])}},disableTouchEvents:function(){var e=Object.keys(this.CONTAINER_TOUCH_EVENTS);for(let t=0;t<e.length;t++){let i=e[t];this.container.removeEventListener(i,this.CONTAINER_TOUCH_EVENTS[i])}var t=Object.keys(this.SCROLLBAR_TOUCH_EVENTS);for(let e=0;e<t.length;e++){let i=t[e];this.uiElements.scrollBar.addEventListener(i,this.SCROLLBAR_TOUCH_EVENTS[i])}var i=Object.keys(this.SCROLLHANDLE_TOUCH_EVENTS);for(let e=0;e<i.length;e++){let t=i[e];this.uiElements.scrollHandle.addEventListener(t,this.SCROLLHANDLE_TOUCH_EVENTS[t]),this.uiElements.scrollBarHandleExtraDiv&&this.uiElements.scrollBarHandleExtraDiv.addEventListener(t,this.SCROLLHANDLE_TOUCH_EVENTS[t])}},update:function(e){if(e.contentHeight<=e.containerHeight)this.uiElements.scrollHandle.style.visibility="hidden",this.uiElements.scrollBar.style.visibility="hidden";else{this.uiElements.scrollHandle.style.visibility="visible",this.uiElements.scrollBar.style.visibility="visible";let n=e.containerHeight*e.containerHeight/e.contentHeight;n<25&&(n=25),this.contentToScrollRatio=(e.contentHeight-e.containerHeight)/(e.containerHeight-n);var t=e.position/this.contentToScrollRatio;scrollHandleTopPosLimit=e.containerHeight-n;var i={top:t,height:n};this.applyScrollHandleHeightAndTop(i,scrollHandleTopPosLimit)}},dispose:function(){this.disableMouseEvents(),this.disableTouchEvents(),this.uiElements&&(this.uiElements.scrollHandle&&(this.uiElements.scrollHandle.remove(),this.uiElements.scrollHandle=void 0),this.uiElements.scrollBar&&(this.uiElements.scrollBar.remove(),this.uiElements.scrollBar=void 0),this.uiElements=void 0)}})}),define("DS/3DPlay2DExperience/DocumentViewer/SearchComponent",["DS/3DPlay2DExperience/DocumentViewer/BaseComponent","UWA/Core","DS/3DPlay2DExperience/DocumentViewer/TextSearch","DS/WebSystem/Nls","i18n!DS/3DPlay2DExperience/assets/nls/3DPlay2DExperience","DS/WebSystem/Environment"],function(e,t,i,n,s,o){"use strict";return e.extend({init:function(e){this._parent(e),this.textToSearch=null,this.searchResultsLength=0,this.uiElements={},this.publishUpdate=e.onUpdate,this.uiContainer=e.container,this.showSearchResult=function(){e.showSearchResult()}.bind(this),this.hideSearchResult=function(){e.hideSearchResult()}.bind(this);var t="onmessage = "+i.onmessage.toString(),n=new Blob([t],{type:"text/javascript"});this.currentSearchIndex=0;var s=URL.createObjectURL(n);this.searchWorker=new Worker(s),this._isVisible=!1,this.buildUI(),this.searchWorker.onmessage=function(e){this._publishUpdate(e.data)}.bind(this)},passSourceDataToWorker:function(e,t){this.searchWorker.postMessage({srcData:e,name:t})},buildUI:function(){this.uiElements.searchPanelContainer=new t.Element("div",{id:"_3dp-search-panel-container",styles:{display:"none","background-color":"white","padding-left":"10px","padding-right":"10px","box-shadow":"0px 0px 5px black","margin-bottom":"5px","align-items":"center","justify-content":"center",height:"50px"}}).inject(this.uiContainer),this.uiElements.searchTextContainer=new t.Element("div",{styles:{flex:1,"font-family":"3ds",display:"flex","flex-direction":"column"}}).inject(this.uiElements.searchPanelContainer),this.uiElements.searchTextNotification=new t.Element("span",{styles:{display:"none",color:"red","font-size":"12px","margin-bottom":"5px","font-style":"italic"}}).inject(this.uiElements.searchTextContainer),this.uiElements.searchText=new t.Element("input",{id:"_3dp-search-text",type:"text",styles:{"font-size":"16px","min-width":"32px","border-style":"none",outline:"none"},events:{keyup:e=>{switch(e.keyCode){case 17:case 13:case 114:case 16:case 37:case 38:case 39:case 40:break;default:this.stringsToSearch=[];let t=this.uiElements.searchText.value;if(o.isSet("3DPlay.Search.AdvancedQueries.Enabled")){if(0===t.length)return void this.uiElements.searchTextNotification.setStyles({display:"none"});let e=!1,i="";for(let n=0;n<t.length;n++)'"'===t.charAt(n)?(e=!e,i.length>0&&(i.length<3?this.uiElements.searchTextNotification.setStyles({display:"flex"}):(this.uiElements.searchTextNotification.setStyles({display:"none"}),this.stringsToSearch.push(i))),i=""):" "!==t.charAt(n)||e?i+=t.charAt(n):(i.length>0&&(i.length<3?this.uiElements.searchTextNotification.setStyles({display:"flex"}):(this.uiElements.searchTextNotification.setStyles({display:"none"}),this.stringsToSearch.push(i))),i="");let n=i.split(" ");e&&(n[0]='"'+n[0],e=!1);for(let e=0;e<n.length;e++)n[e].length>0&&(n[e].length<3?this.uiElements.searchTextNotification.setStyles({display:"flex"}):(this.uiElements.searchTextNotification.setStyles({display:"none"}),this.stringsToSearch.push(n[e])))}else t.length>0&&(this.stringsToSearch=[this.uiElements.searchText.value]);this.currentSearchIndex=0,this.searchText(this.stringsToSearch)}}}}).inject(this.uiElements.searchTextContainer),this.uiElements.searchResultsCount=new t.Element("span",{id:"_3dp-search-result-counter",html:"0/0",styles:{display:"flex","justify-content":"center","align-content":"center","flex-direction":"column",margin:"10px","font-family":"3ds"}}).inject(this.uiElements.searchPanelContainer);new t.Element("span",{id:"_3dp-search-prev-btn",class:"fonticon fonticon-expand-left",title:s.SearchPreviousButtonTooltipText,styles:{cursor:"pointer",width:"32px",height:"32px","border-radius":"4px","font-size":"15px","line-height":"30px","text-align":"center","white-space":"nowrap","user-select":"none",border:"1px solid rgba(0, 0, 0, 0)","background-color":"rgba(0, 0, 0, 0)",color:"#77797c"},events:{click:()=>{this.goToPreviousSearchResult()},mouseenter:function(){this.setStyles({"background-color":"#f9f9f9","border-color":"#d1d4d4",color:"#3d3d3d"})},mouseleave:function(){this.setStyles({"background-color":"rgba(0, 0, 0, 0)","border-color":"rgba(0, 0, 0, 0)",color:"#77797c"})}}}).inject(this.uiElements.searchPanelContainer),new t.Element("span",{id:"_3dp-search-next-btn",class:"fonticon fonticon-expand-right",title:s.SearchNextButtonTooltipText,styles:{cursor:"pointer",width:"32px",height:"32px",color:"#77797c","border-radius":"4px","font-size":"15px","line-height":"30px","text-align":"center","white-space":"nowrap","user-select":"none",border:"1px solid rgba(0, 0, 0, 0)","background-color":"rgba(0, 0, 0, 0)",color:"#77797c"},events:{click:()=>{this.goToNextSearchResult()},mouseenter:function(){this.setStyles({"background-color":"#f9f9f9","border-color":"#d1d4d4",color:"#3d3d3d"})},mouseleave:function(){this.setStyles({"background-color":"rgba(0, 0, 0, 0)","border-color":"rgba(0, 0, 0, 0)",color:"#77797c"})}}}).inject(this.uiElements.searchPanelContainer),new t.Element("span",{id:"_3dp-search-close-btn",class:"fonticon fonticon-wrong",title:s.SearchCloseButtonTooltipText,styles:{cursor:"pointer",width:"32px",height:"32px",color:"#77797c","border-radius":"4px","font-size":"15px","line-height":"30px","text-align":"center","white-space":"nowrap","user-select":"none",border:"1px solid rgba(0, 0, 0, 0)","background-color":"rgba(0, 0, 0, 0)",color:"#77797c"},events:{click:()=>{this.hide()},mouseenter:function(){this.setStyles({"background-color":"#f9f9f9","border-color":"#d1d4d4",color:"#3d3d3d"})},mouseleave:function(){this.setStyles({"background-color":"rgba(0, 0, 0, 0)","border-color":"rgba(0, 0, 0, 0)",color:"#77797c"})}}}).inject(this.uiElements.searchPanelContainer);this.uiElements.searchTextNotification.setText(s.MinimumCharacterNotificationInSearchQuery)},update:function(e){this.hideSearchResult(),this._isVisible&&e&&!e.isZoomActive&&this.showSearchResult()},isVisible:function(){return this._isVisible},initializeWithData:function(e){this.stringsToSearch=[],this.uiElements.searchText.value=e,e.length>0&&(this.stringsToSearch=[this.uiElements.searchText.value]),this.currentSearchIndex=0,this.searchText(this.stringsToSearch)},reset:function(){this.stringsToSearch=[],this.uiElements.searchText.value="",this.currentSearchIndex=0,this.searchText(this.stringsToSearch)},goToNextSearchResult:function(){this.searchResultsLength>0&&(this.currentSearchIndex!==this.searchResultsLength-1&&this.currentSearchIndex++,this._publishUpdate())},goToPreviousSearchResult:function(){this.searchResultsLength>0&&(0!==this.currentSearchIndex&&this.currentSearchIndex--,this._publishUpdate())},searchText:function(e){e?(this.textToSearch=e,this.searchWorker.postMessage({textToSearch:e})):(this.searchResultsLength=0,this.currentSearchIndex=null,this._publishUpdate())},show:function(){this._isVisible=!0,this.uiElements.searchPanelContainer.setStyles({display:"flex"}),this.uiElements.searchText.select(),this.searchText(this.textToSearch)},hide:function(){this.uiElements.searchPanelContainer.setStyles({display:"none"}),this._isVisible=!1,this.publishUpdate({searchResults:null,searchIndex:null,visible:!1})},_publishUpdate:function(e){e&&(this.searchResultsLength=this.publishUpdate({resultsFromSources:e}),this.currentSearchIndex=0),this.searchResultsLength>0?this.uiElements.searchResultsCount.setText(this.currentSearchIndex+1+"/"+this.searchResultsLength):this.uiElements.searchResultsCount.setText("0/0"),this.publishUpdate({currentSearchIndex:this.currentSearchIndex,isVisible:this._isVisible})},dispose:function(){this.searchWorker&&(this.searchWorker.terminate(),this.searchWorker=void 0),this.uiElements.searchText&&(this.uiElements.searchText.remove(),this.uiElements.searchText=void 0),this.uiElements.searchResultsCount&&(this.uiElements.searchResultsCount.remove(),this.uiElements.searchResultsCount=void 0),this.uiElements.searchPanelContainer&&(this.uiElements.searchPanelContainer.remove(),this.uiElements.searchPanelContainer=void 0)}})}),define("DS/3DPlay2DExperience/DocumentViewer/DocumentViews/ScrollingView",["DS/3DPlay2DExperience/DocumentViewer/DocumentViews/DocumentView","DS/3DPlay2DExperience/DocumentViewer/PageView"],function(e,t){"use strict";return e.extend({init:function(e){if(this._parent(e),this.loadwithBrowsergestures=e.loadwithBrowsergestures,this.useTapEvent=!0,this.PAGE_MARGIN=10,this.originalWidth=0===this.angle||180===this.angle?e.doc.getDocumentWidth():e.doc.getDocumentWidthAfterRotation(),this.originalHeight=(0===this.angle||180===this.angle?e.doc.getDocumentHeight():e.doc.getDocumentHeightAfterRotation())+2*this.PAGE_MARGIN*e.doc.pagesCount,this.aspectRatio=this.originalWidth/this.originalHeight,this.loadwithBrowsergestures?this.pagesContainer.setStyles({width:"100%",height:"100%"}):this.pagesContainer.setStyles({width:this.originalWidth+"px",height:this.originalHeight+"px",position:"absolute",top:"0px"}),this.loadwithBrowsergestures)for(var t=0;t<this.pageViews.length;t++)this.pageViews[t].getPageContainer().inject(this.pagesContainer);else{var i=0;this.MIN_ZOOM_SCALE=1/0,this.MAX_ZOOM_SCALE=0;for(t=0;t<this.pageViews.length;t++){var n=this.pageViews[t].getOriginalWidth(),s=this.pageViews[t].getOriginalHeight(),o=.5*(this.originalWidth-n);i+=this.PAGE_MARGIN,this.pageViews[t].setPosition({top:i,left:o}),this.pageViews[t].getPageContainer().inject(this.pagesContainer),i+=s,i+=this.PAGE_MARGIN,this.MIN_ZOOM_SCALE>this.pageViews[t].pageInfo.MIN_ZOOM_SCALE&&(this.MIN_ZOOM_SCALE=this.pageViews[t].pageInfo.MIN_ZOOM_SCALE),this.MAX_ZOOM_SCALE<this.pageViews[t].pageInfo.MAX_ZOOM_SCALE&&(this.MAX_ZOOM_SCALE=this.pageViews[t].pageInfo.MAX_ZOOM_SCALE)}}this.pagesContainer.inject(this.container),this._goToPage(e.currentPageIndex||1)},getPage:function(e){var t;if(e>0&&e<=this.pageViews.length)for(var i=0;i<this.pageViews.length;i++)if(this.pageViews[i].index===e){t=this.pageViews[i];break}return t},_goToPage:function(e){if(this.loadwithBrowsergestures&&this.pageViews[0].index===e)this.currentPage=this.pageViews[0];else for(var t=0;t<this.pageViews.length;t++)if(e===this.pageViews[t].index){this.currentPage=this.pageViews[t],this.updateLayout({top:(this.currentPage.originalTop-this.PAGE_MARGIN)*this.zoomScale*-1,width:this.originalWidth*this.zoomScale,height:this.originalHeight*this.zoomScale});break}this._parent()},goToPage:function(e){this._goToPage(e),this.publishUpdate({pageIndex:e})},getOriginalWidth:function(){return this.originalWidth},getOriginalHeight:function(){return this.originalHeight},getCurrentPage:function(){return this.currentPage},getVisiblePages:function(){for(var e=[],t=this.container.getBoundingClientRect(),i=this.pagesContainer.getBoundingClientRect().top-t.top,n=(Math.max(0,i),0);n<this.pageViews.length;n++){var s=this.pageViews[n].originalTop*this.zoomScale,o=this.pageViews[n].originalHeight*this.zoomScale;if(s>=Math.abs(i)+t.height)break;s+o>=Math.abs(i)?e.push(this.pageViews[n]):i>0&&this.pageViews[n].originalTop*this.zoomScale<t.height&&e.push(this.pageViews[n])}return e},render:function(e){var t=this.getVisiblePages(),i=function(i){i&&this.renderedPages.push(i),this.renderedPages.length===t.length&&e&&e()}.bind(this);for(this.currentPage=t[0];this.renderedPages.length>0;){for(var n=this.renderedPages.shift(),s=!1,o=0;o<t.length;o++)if(n.index===t[o].index){s=!0;break}s||n.unrender()}for(var a=0;a<t.length;a++)t[a].render({scale:this.zoomScale,onRenderCompleteCB:i})},getCurrentState:function(){var e=this.container.getBoundingClientRect(),t=this.pagesContainer.getBoundingClientRect();return{width:t.width,height:t.height,top:e.top-t.top,left:e.left-t.left}},scrollTo:function(e){if(e){this.updateLayout({left:e.x,top:-e.y});var t=this.getVisiblePages();for(let e=0;e<t.length;e++)t[e].scale(this.zoomScale),t[e].show();this.currentPage=t[0]}},onDoubleTap:function(e){if(this.frameWindow.getViewer().checkContext(e)){var t=this._parent(e);t.isPageFinder||(this.isMobile&&"zoomed"===this.viewerState?this.fitDocument(t.doubleTapPos):this.isMobile&&"fit-document"===this.viewerState?(this.startZoom(t.doubleTapPos),this.zoom(2),this.stopZoom()):this.isMobile&&"reframe"===this.viewerState&&(this.startZoom(t.doubleTapPos),this.zoom(2),this.stopZoom()))}},onKeyDown:function(e){this.frameWindow.getViewer().checkContext(e)&&(this._parent(e),this.render())},stopZoom:function(e){if(this.isZoomActive){this._parent();var t=this.pagesContainer.getBoundingClientRect(),i=this.container.getBoundingClientRect();this.isMobile&&t.width<i.width?this.fitDocument(void 0,e):e||this.render(this._publishCurrentState.bind(this))}}})}),define("DS/3DPlay2DExperience/DocumentViewer/DocumentAttachmentPanel",["UWA/Core","DS/3DPlay2DExperience/DocumentViewer/BaseComponent","DS/UIKIT/Tooltip","i18n!DS/3DPlay2DExperience/assets/nls/3DPlay2DExperience"],function(e,t,i,n){"use strict";return t.extend({init:function(e){this._parent(e),this.buildUI(e.attachment)},update:function(e){},buildUI:function(t){t&&(this.attachmentsContainer=new e.Element("div",{id:"_3dp-doc-attachment",styles:{width:"100%",height:"100%",overflow:"auto"}}),Object.keys(t).forEach(s=>{var o=t[s].filename,a=new Blob([t[s].content]),r=URL.createObjectURL(a),h=new e.Element("div",{id:"_3dp-pdf-attachment-"+o,html:"<h5>"+o+"</h5>",styles:{cursor:"pointer","border-style":"solid","border-color":"#368ec4","box-shadow":"0px 0px 1px #d1d4d4",padding:"5px","background-color":"#f1f1f100"},value:r,events:{mouseenter:function(){this.setStyles({"background-color":"#f1f1f1"})},mouseleave:function(){this.setStyles({"background-color":"#f1f1f100"})},click:function(e){this._downloadAttachment()}.bind(this)}}).inject(this.attachmentsContainer);new i({target:h,body:n.AttachmentDownloadTooltip})}))},_downloadAttachment:function(t){if(window.__karma__)console.log("ODT replay active. Skipping download...");else{var i=new e.Element("a",{href:this.value,download:name,styles:{visibility:"hidden"}}).inject(document.body);i.click(),document.body.removeChild(i)}},getContainer:function(){return this.attachmentsContainer},dispose:function(){this.attachmentsContainer&&(this.attachmentsContainer.remove(),this.attachmentsContainer=void 0)}})}),define("DS/3DPlay2DExperience/DocumentViewer/DocumentCommentPanel",["UWA/Core","DS/3DPlay2DExperience/DocumentViewer/BaseComponent","DS/UIKIT/Tooltip"],function(e,t,i){"use strict";return t.extend({init:function(e){this._parent(e),this.buildUI(e.comments)},buildUI:function(t){t&&(this.commentsContainer=new e.Element("div",{id:"_3dp-doc-comment",styles:{width:"100%",height:"100%",overflow:"auto"}}),this.commentUI(t).forEach(e=>{e.inject(this.commentsContainer)}))},update:function(e){},commentUI:function(t){var n=[];return t.forEach(t=>{var s=t.annot,o=(t.page,s.contents.replace(/\n/g,"<br />")),a=e.Element("div",{id:s.titleObj.str,value:t,html:"<h5>"+s.titleObj.str+"</h5><p>"+o+"</p>",styles:{cursor:"pointer","border-style":"solid","border-color":"#368ec4","box-shadow":"0px 0px 1px #d1d4d4",padding:"5px","background-color":"#f1f1f100"},events:{mouseenter:function(){this.setStyles({"background-color":"#f1f1f1"})},mouseleave:function(){this.setStyles({"background-color":"#f1f1f100"})},click:function(e){this.publishUpdate({data:t})}.bind(this)}});new i({target:a,body:s.titleObj.str}),n.push(a)}),n},getContainer:function(){return this.commentsContainer},dispose:function(){this.commentsContainer&&(this.commentsContainer.remove(),this.commentsContainer=void 0)}})}),define("DS/3DPlay2DExperience/DocumentViewer/DocumentNavigationPanel",["UWA/Core","DS/3DPlay2DExperience/DocumentViewer/BaseComponent","DS/WebSystem/Settings","DS/WebappsUtils/WebappsUtils","DS/WebSystem/DetectBrowser","css!DS/UIKIT/UIKIT.css"],function(e,t,n,s,o,a){"use strict";var r=o().browser.name,h=function(t,i,n,o){var a=t,r=t.index,h=!1,l=!1,c=!1,d=t.pageInfo.pageLabel,u=function(){c||(f.setStyles({"border-width":"0px"}),D.setStyles({color:"#717171"}))},g=function(){c||f.setStyles({"border-width":"1px"})},p=new e.Element("li",{styles:{"margin-left":"10px","margin-top":"10px"}}),m=new e.Element("div",{id:"Page-"+r+"-Thumbnail-Container",class:"_3dp-doc-thumbnail-container",styles:{position:"relative",cursor:"pointer",width:n+"px",height:o+32+"px"},events:{mouseenter:g,mouseleave:u,click:function(e){i&&i(r)}}}).inject(p),f=new e.Element("div",{styles:{"border-style":"solid","border-color":"#368ec4",width:n+"px",height:o+"px","background-repeat":"no-repeat","background-position":"center","background-size":"contain","box-shadow":"0px 0px 1px #d1d4d4","background-image":"url("+s.getWebappsBaseUrl()+"3DPlay2DExperience/assets/images/sheet_loading.gif)"}}).inject(m),D=new e.Element("div",{class:"_3dp-thumbnail-title-bar",styles:{color:"#717171",width:"100%",display:"flex","flex-direction":"row","justify-content":"space-between","pointer-events":"none","font-family":"3ds","font-size":"14px",height:"32px",bottom:"0px",position:"absolute"}}).inject(m),w=(new e.Element("span",{class:"_3dp-thumnail-title",html:d||r,styles:{margin:"5px","pointer-events":"none"}}).inject(D),new e.Element("span",{class:"fonticon fonticon-comment",styles:{margin:"5px","pointer-events":"none",visibility:"hidden"}}).inject(D));this.getContainer=function(){return m},this.inject=function(e){p.inject(e)},this.select=function(e){m.setStyles({"border-width":"1px","border-style":"solid","border-color":"#3d3d3d"})},this.normalize=function(){u()},this.highlight=function(){g()},this.select=function(){c=!0,f.setStyles({"border-width":"1px"}),D.setStyles({color:"#368ec4"})},this.unselect=function(){c=!1,f.setStyles({"border-width":"0px"}),D.setStyles({color:"#717171"})},this.load=function(e){l=!0,a.getThumbnail(function(t){h=!0,l=!1,f.style.backgroundImage="url("+t+")",e&&e()})},this.rotate=function(e,t,i,n){f.style.transformOrigin=n,f.style.transform="rotate("+e+"deg)",m.style.height=t+32+"px",m.style.width=i+"px"},this.updateThumbnail=function(e){e?w.setStyles({visibility:"visible"}):w.setStyles({visibility:"hidden"})},this.isLoading=function(){return l},this.isLoaded=function(){return h},this.getThumbnailContainer=function(){return m}};return t.extend({init:function(t){this._parent(t),this.viewerAngle=void 0,this.thumbnailList=[],this.selectedThumbnailIndex=0;var i=t.Document.getPages(),s=i[0].getOriginalWidth()/i[0].getOriginalHeight();s>1?(this.thumbnailWidth=150,this.thumbnailHeight=Math.floor(this.thumbnailWidth/s)):(this.thumbnailHeight=150,this.thumbnailWidth=Math.floor(this.thumbnailHeight*s)),this.effectiveThumbnailWidth=this.thumbnailWidth+20+2,this.effectiveThumbnailHeight=this.thumbnailHeight+20+2,n.set("3DPlay.2DExperience.ThumbnailWidth",this.effectiveThumbnailWidth+20);var o=function(e){this.select(e),this.publishUpdate({pageIndex:e})}.bind(this);this.uiElements={},this.uiElements.panelContainer=new e.Element("div",{styles:{width:"100%",display:"flex","flex-direction":"column",overflow:"auto"}}),this.uiElements.scrollContainer=new e.Element("div",{id:"_3dp-thumbnails-scroll-container",styles:{flex:1,"overflow-x":"hidden","overflow-y":"auto"}}).inject(this.uiElements.panelContainer),this.uiElements.scrollContainer.addEventListener("scroll",function(e){this.scrollTimer&&(clearTimeout(this.scrollTimer),this.scrollTimer=void 0),this.scrollTimer=setTimeout(this.loadThumbnails.bind(this),500)}.bind(this),!0),this.uiElements.panelContentContainer=new e.Element("ul",{id:"_3dp-thumbnails-container"}).inject(this.uiElements.scrollContainer),"ie"===r?this.uiElements.panelContentContainer.setStyles({display:"flex","flex-wrap":"wrap"}):this.uiElements.panelContentContainer.setStyles({display:"grid","grid-template-columns":"repeat(auto-fill, "+this.effectiveThumbnailWidth+"px)","justify-content":"space-evenly"});for(var a=0;a<i.length;a++){var l=new h(i[a],o,this.thumbnailWidth,this.thumbnailHeight);l.inject(this.uiElements.panelContentContainer),this.thumbnailList.push(l)}},update:function(e){e&&(e.height&&this.uiElements.panelContainer.setStyles({height:e.height+"px"}),this.scrollThumbnailIntoView(e.lastpageVisiblePageIndex),this.rotate(e.rotate),this.loadThumbnails())},rotate:function(e){if(this.viewerAngle!==e){this.viewerAngle=e;var t,n=this.thumbnailHeight,s=this.thumbnailWidth,o=function(e,t,i){var n="0% 0%";switch(e){case 0:n="50% 50%";break;case-270:case 90:t<i&&(n=100*t/(2*i)+"% "+100*t/(2*t)+"%"),i<=t&&(n=100*t/(2*i)+"% "+100*t/(2*t)+"%");break;case-180:case 180:n="50% 50%";break;case 270:case-90:t<i&&(n=100*i/(2*i)+"% "+100*i/(2*t)+"%"),i<=t&&(n=100*i/(2*i)+"% "+100*i/(2*t)+"%")}return n}(e,n,s);for(270==e||90==e?(this.effectiveThumbnailWidth=this.thumbnailHeight+20+2,this.uiElements.panelContentContainer.setStyles({"grid-template-columns":"repeat(auto-fill, "+this.effectiveThumbnailWidth+"px)"}),t=n,n=s,s=t):(this.effectiveThumbnailWidth=this.thumbnailWidth+20+2,this.uiElements.panelContentContainer.setStyles({"grid-template-columns":"repeat(auto-fill, "+this.effectiveThumbnailWidth+"px)"})),i=0;i<this.thumbnailList.length;i++)this.thumbnailList[i].rotate(e,n,s,o)}},select:function(e){this.thumbnailList[this.selectedThumbnailIndex].unselect(),this.selectedThumbnailIndex=e-1,this.thumbnailList[this.selectedThumbnailIndex].select()},dispose:function(){this.uiElements.panelContainer.remove(),this.uiElements.panelContainer=void 0,this.uiElements=void 0,this.thumbnailList=[]},getContainer:function(){return this.uiElements.panelContainer},loadThumbnails:function(){let e=this.thumbnailList[0].getContainer().clientHeight+10,t=this.thumbnailList[0].getContainer().clientWidth+10;for(var i=Math.floor(this.uiElements.scrollContainer.scrollTop/e)*Math.floor(this.uiElements.scrollContainer.scrollWidth/t),n=(Math.floor(this.uiElements.scrollContainer.clientHeight/e)+1)*Math.floor(this.uiElements.scrollContainer.clientWidth/t),s=i;s<Math.min(i+n,this.thumbnailList.length);s++)this.thumbnailList[s].isLoading()||this.thumbnailList[s].isLoaded()||this.thumbnailList[s].load()},updateThumbnail:function(e,t){var i=e-1;this.thumbnailList[i].updateThumbnail(t)},scrollThumbnailIntoView:function(e){e>0&&e<=this.thumbnailList.length&&this.thumbnailList[e-1].getThumbnailContainer().scrollIntoView({behavior:"smooth",block:"nearest",inline:"start"})}})}),define("DS/3DPlay2DExperience/DocumentViewer/ViewSplitter",["DS/WebSystem/Settings","css!DS/UIKIT/UIKIT.css","DS/3DPlay2DExperience/DocumentViewer/BaseComponent"],function(e,t,i){"use strict";return i.extend({init:function(e){this._parent(e),this.uiElements={},this.isMABvisible=e.isMABvisible;var t=function(){this.publishUpdate()}.bind(this);this.uiElements.mainView=new UWA.Element("div",{id:"_3dp-2d-view_splitter",context:e.context,styles:{width:"100%",height:"100%",display:"flex","flex-direction":"row","background-color":"#f4f5f6"}}).inject(e.container),this.currentState=3,this.uiElements.leftColumn=new UWA.Element("div",{id:"_3dp-2d-view_splitter-left-col",context:e.context}).inject(this.uiElements.mainView),this.uiElements.leftColumnTopBar=new UWA.Element("div",{styles:{"background-color":"white",display:"none","justify-content":"flex-end","box-shadow":"0px 0px 3px 0px","z-index":1}}).inject(this.uiElements.leftColumn),this.uiElements.leftColumnCloseBtn=new UWA.Element("div",{class:"fonticon fonticon-wrong",styles:{"background-color":"white",color:"#77797c",cursor:"pointer","font-size":"30px"},events:{click:function(e){this.showRightColumnOnly(),t()}.bind(this)}}).inject(this.uiElements.leftColumnTopBar),this.uiElements.splitter=new UWA.Element("div",{styles:{cursor:"ew-resize","background-color":"#e2e4e3",display:"flex","border-right":"ridge #e2e4e3"}}).inject(this.uiElements.mainView),this.uiElements.rightColumn=new UWA.Element("div",{id:"_3dp-2d-view_splitter-right-col",context:e.context,styles:{flex:1,"min-width":"50%"}}).inject(this.uiElements.mainView),this.isResizing=!1,this.onMouseDown=function(e){this.isResizing=!0,this.mouseXPosOnResizeStart=e.clientX}.bind(this),this.onMouseMove=function(e){if(this.isResizing){var t=e.clientX,i=this.mouseXPosOnResizeStart-t,n=this.uiElements.leftColumn.clientWidth-i;this.uiElements.leftColumn.setStyle("width",n+"px"),this.mouseXPosOnResizeStart=t,this.publishUpdate()}}.bind(this),this.onMouseUp=function(e){this.isResizing=!1}.bind(this),window.onresize=function(e){this.publishUpdate()}.bind(this)},update:function(e){this.isMABvisible=e.isMABvisible},showLeftColumnOnly:function(){this.uiElements.rightColumn.setStyle("display","none"),this.uiElements.splitter.setStyle("display","none"),this.uiElements.leftColumn.setStyles({display:"block",width:"100%",height:"100%"}),!0===this.isMABvisible&&this.uiElements.leftColumnTopBar.setStyles({display:"flex"}),this.uiElements.splitter.removeEventListener("mousedown",this.onMouseDown.bind(this),!0),this.uiElements.mainView.removeEventListener("mousemove",this.onMouseMove.bind(this),!0),this.uiElements.mainView.removeEventListener("mouseup",this.onMouseUp.bind(this),!0),this.currentState=1,this.publishUpdate()},showRightColumnOnly:function(){this.uiElements.leftColumn.setStyle("display","none"),this.uiElements.splitter.setStyle("display","none"),this.uiElements.rightColumn.setStyles({display:"block",width:"100%",height:"100%"}),this.uiElements.splitter.removeEventListener("mousedown",this.onMouseDown.bind(this),!0),this.uiElements.mainView.removeEventListener("mousemove",this.onMouseMove.bind(this),!0),this.uiElements.mainView.removeEventListener("mouseup",this.onMouseUp.bind(this),!0),this.currentState=2,this.publishUpdate()},showBothColumns:function(){!1===this.isMABvisible&&this.uiElements.leftColumnTopBar.setStyles({display:"none"}),this.uiElements.rightColumn.setStyle("display","block"),this.uiElements.splitter.setStyle("display","block"),this.uiElements.leftColumn.setStyle("display","block"),this.uiElements.splitter.addEventListener("mousedown",this.onMouseDown.bind(this),!0),this.uiElements.mainView.addEventListener("mousemove",this.onMouseMove.bind(this),!0),this.uiElements.mainView.addEventListener("mouseup",this.onMouseUp.bind(this),!0),""==this.uiElements.leftColumn.style.width?this.uiElements.leftColumn.setStyle("width",this.uiElements.leftColumn.scrollWidth+20+"px"):this.uiElements.leftColumn.setStyle("width",this.uiElements.leftColumn.scrollWidth+"px"),this.currentState=3,this.publishUpdate()},addContentToLeftColumn:function(e){e&&e.inject(this.uiElements.leftColumn)},addContentToRightColumn:function(e){e&&e.inject(this.uiElements.rightColumn)},getCurrentState:function(){return this.currentState},dispose:function(){this.uiElements.mainView.remove(),this.uiElements.mainView=void 0,this.uiElements.leftColumn=void 0,this.uiElements.rightColumn=void 0,this.uiElements.splitter=void 0}})}),define("DS/3DPlay2DExperience/DocumentViewer/DocumentViewer",["UWA/Class","UWA/Core","DS/Core/PointerEvents","DS/WebSystem/Environment","DS/3DPlay2DExperience/DocumentViewer/DocumentNavigationPanel","DS/3DPlay2DExperience/DocumentViewer/DocumentBookmarkPanel","DS/3DPlay2DExperience/DocumentViewer/DocumentAttachmentPanel","DS/3DPlay2DExperience/DocumentViewer/DocumentCommentPanel","DS/CoreEvents/Events","DS/3DPlay2DExperience/DocumentViewer/ViewSplitter","DS/WebSystem/DetectBrowser","css!DS/UIKIT/UIKIT.css","DS/ApplicationFrame/CommandsManager","DS/WebSystem/Nls","DS/Controls/Button","css!DS/3DPlay2DExperience/DocumentViewer/DocumentViewer","DS/WebappsUtils/WebappsUtils","DS/WebUtils/StringUtils","DS/3DPlay2DExperience/DocumentViewer/ScrollerComponent","DS/3DPlay2DExperience/DocumentViewer/PageFinderComponent","DS/Controls/Tab","DS/3DPlay2DExperience/DocumentViewer/DocumentViews/ScrollingView","DS/3DPlay2DExperience/DocumentViewer/DocumentViews/SinglePageView","DS/3DPlay2DExperience/DocumentViewer/DocumentViews/PresentationView","DS/3DPlay2DExperience/DocumentViewer/SearchComponent","i18n!DS/3DPlay2DExperience/assets/nls/3DPlay2DExperience"],function(e,t,i,n,s,o,a,r,h,l,c,d,u,g,p,m,f,D,w,x,v,P,y,b,E,S){"use strict";return e.extend({init:function(e){this.searchResults=[],this.angle=0,this.frmWindow=e.frmWindow,this.isMobile=this.frmWindow.experience.isMobile(),this.initialState=e.initialState,this.resizeEnabled=!0,this.uiElements={},this.annotationMode=!1,this.optionDoc=e.doc,this.showPageNumber=e.showPageNumber,this.loadWith100PercentScale=e.loadWith100PercentScale,this.loadwithBrowsergestures=e.loadwithBrowsergestures,this.useTapEvent=e.useTapEvent,this.showScrollBar=e.showScrollBar,this.context=this.frmWindow.options.context,this.reviewMode=!0,this.gestures=e.gestures,this.displayZoomPercent=e.displayZoomPercent,this.backgroundColor=void 0,e.initialView&&(this.currentView=e.initialView),e.actionBarClosedOnLoad&&this.frmWindow.getActionBar().close(),this.frmWindow.onActionBarReady(function(){e.actionBarClosedOnLoad&&this.frmWindow.getActionBar().close()}.bind(this));(function(e){this.docNavigationPanel.select(e)}).bind(this);this.onAnnotationUpdateCB=function(e,t){this.docNavigationPanel.updateThumbnail(e,t)}.bind(this);var i=this.frmWindow.getViewerFrame();this.viewSplitter=new l({container:i,context:this.context,isMABvisible:this.frmWindow.getActionBar().MAB.state.visible,onUpdate:function(e){this.onViewChange(),this.updateAllComponents(e,this.viewSplitter)}.bind(this)}),this.uiElements.uiContainer=new t.Element("div",{styles:{display:"flex","flex-direction":"column",width:"100%",height:"100%"}}),this.uiElements.viewerContainer=new t.Element("div",{id:"_3dp-doc-viewer-container",context:this.context,tabindex:0,styles:{flex:1,overflow:"hidden",display:"flex","flex-direction":"row","font-family":"3ds",position:"relative",outline:"none"}}),this.buildUI(),this.createSearchUI(),this.uiElements.viewerContainer.inject(this.uiElements.uiContainer),this.viewSplitter.addContentToRightColumn(this.uiElements.uiContainer);var h=[];this.docNavigationPanel=new s({Document:this.doc,context:this.context,onUpdate:function(e){if(this.isMobile||!0===this.frmWindow.getActionBar().MAB.state.visible){this.showOnlyViewer(),this.frmWindow.getActionBar().MAB.show(),u.getCommandCheckHeaders(this.frmWindow.experience.ctx).ToggleView.setState(!1)}this.updateAllComponents(e,this.docNavigationPanel),this.render()}.bind(this),onCloseCB:function(){this.showOnlyViewer(),this.frmWindow.getActionBar().MAB.show()}.bind(this)}),h.push({label:S.ThumbnailPanelTitle,icon:"view-big-thb",content:this.docNavigationPanel.getContainer()}),this.doc&&this.doc.pdfDoc&&this.doc.pdfDoc.comments&&this.doc.pdfDoc.comments.length>0&&(this.docCommentPanel=new r({comments:this.doc.pdfDoc.comments,context:this.context,Document:this.doc,onUpdate:function(e){(this.isMobile||!0===this.frmWindow.getActionBar().MAB.state.visible)&&(this.showOnlyViewer(),this.frmWindow.getActionBar().MAB.show()),setTimeout(function(){var t=e.data.annot.rect,i=e.data.page,n=t[0],s=t[1],o=t[2],a=t[3];switch(this.angle){case 0:case 360:Math.min(n,o),Math.max(n,o),this.getPageFromNumber(i).originalHeight-Math.min(s,a),this.getPageFromNumber(i).originalHeight-Math.max(s,a);break;case 90:Math.min(n,o),Math.max(n,o),Math.max(s,a),Math.min(s,a);break;case 180:Math.min(s,a),Math.max(s,a),this.getPageFromNumber(i).originalWidth-Math.min(n,o),this.getPageFromNumber(i).originalWidth-Math.max(n,o);break;case 270:this.getPageFromNumber(i).originalWidth-Math.max(s,a),this.getPageFromNumber(i).originalWidth-Math.min(s,a),this.getPageFromNumber(i).originalHeight-Math.min(n,o),this.getPageFromNumber(i).originalHeight-Math.max(n,o)}(this.isMobile||!0===this.frmWindow.getActionBar().MAB.state.visible)&&(this.showOnlyViewer(),this.frmWindow.getActionBar().MAB.show()),this.updateAllComponents({pageIndex:i},this.docCommentPanel),this.render()}.bind(this),50)}.bind(this),onCloseCB:function(){this.showOnlyViewer(),this.frmWindow.getActionBar().MAB.show()}.bind(this)}),this.uiElements.bookmarkPanelContainer=this.docNavigationPanel.getContainer(),h.push({label:S.CommentPanelTitle,icon:"fonticon fonticon-chat",content:this.docCommentPanel.getContainer()})),this.doc.pdfDoc.bookmarks&&(this.docBookmarkPanel=new o({bookmarks:this.doc.pdfDoc.bookmarks,context:this.context,Document:this.doc,onUpdate:function(e){var t;(this.isMobile||!0===this.frmWindow.getActionBar().MAB.state.visible)&&(this.showOnlyViewer(),this.frmWindow.getActionBar().MAB.show()),setTimeout(()=>{t=void 0===e.angle?0:e.angle,this.goToPDFDestination(e.dest,t),this.updateAllComponents(e,this.docBookmarkPanel)},50)}.bind(this),onCloseCB:function(){this.showOnlyViewer(),this.frmWindow.getActionBar().MAB.show()}.bind(this)}),this.uiElements.bookmarkPanelContainer=this.docNavigationPanel.getContainer(),h.push({label:S.BookmarkPanelTitle,icon:"bookmark",content:this.docBookmarkPanel.getContainer()})),this.doc.pdfDoc.attachments&&(this.docAttachmentPanel=new a({attachment:this.doc.pdfDoc.attachments,context:this.context,Document:this.doc,onUpdate:function(e){}.bind(this)}),h.push({label:S.AttachmentPanelTitle,icon:"attach",content:this.docAttachmentPanel.getContainer()})),this.leftColumnContentContainer=new t.Element("div",{styles:{width:"100%"}}),this.tab=new v({displayStyle:"strip"}).inject(this.leftColumnContentContainer);var c=!0;h.forEach(function(e){this.tab.add({icon:{iconName:e.icon,fontIconFamily:WUXManagedFontIcons.Font3DS,fontIconSize:"5x"},content:e.content,showTitleFlag:!1,isSelected:c,label:e.label}),c&&(c=!1)}.bind(this)),this.viewSplitter.addContentToLeftColumn(this.leftColumnContentContainer),this.onWidgetResize=function(e){if(this.isMobile&&("INPUT"===document.activeElement.tagName||"TEXTAREA"===document.activeElement.tagName)&&n.isSet("3DPLAY.TST.DETECT_TOUCH_KEYBOARD_POPUP"))return;this.updateAllComponents();let t=u.getCommandCheckHeaders(this.frmWindow.experience.ctx);var i=this.viewSplitter.getCurrentState();this.isMobile||!0===this.frmWindow.getActionBar().MAB.state.visible?1===i?this.showOnlyNavigationPanel():2===i?(t.ToggleView&&t.ToggleView.setState(!1),this.showOnlyViewer()):3===i&&(this.showOnlyViewer(),t.ToggleView&&t.ToggleView.setState(!1)):1===i?(this.showOnlyViewer(),t.ToggleView&&t.ToggleView.setState(!1)):2===i?this.showOnlyViewer():3===i&&this.showBothViewerAndNavigationPanel(),this.onViewChange(),this.reviewMode||this.launchReadMode()}.bind(this),this.frmWindow.getViewerFrame().addEvent("resize",this.onWidgetResize),this.showOnlyViewer(),this.cmds=u.getCommands(this.frmWindow.experience.ctx),this.setCurrentPage(1),this.render(function(){var e=this.doc.getCurrentPage();e&&e.setBackgroundColor(this)}.bind(this)),this.loadwithBrowsergestures||this.launchReadMode()},getViewerState:function(){return this.doc.viewerState},rotateViewClockwise:function(){this.angle=this.angle+90,360===this.angle&&(this.angle=0),this.updateView()},rotateViewAntiClockwise:function(){0===this.angle&&(this.angle=360),this.angle=this.angle-90,this.updateView()},updateView:function(e){var t=this.frmWindow.experience.annotationManager.getAnnotations(),i=this.getCurrentPage().index;this.destroyUI(),this.buildUI(i),e||(this.onViewChange(),this.drawAnnotationsAfterRotation(t))},buildUI:function(e){let i;if(this.loadWith100PercentScale&&(i="zoomed"),this.optionDoc&&this.optionDoc.pages&&this.optionDoc.pages.length){var n=this.optionDoc.pages[0];let e=0==this.angle||180==this.angle?n.originalWidth:n.originalHeight,t=0==this.angle||180==this.angle?n.originalHeight:n.originalWidth;void 0===this.currentView&&(this.currentView=e>t?1:2),1===this.currentView||"reframe"===this.initialState?i="reframe":this.isMobile||2!==this.currentView&&void 0!==this.initialState?this.isMobile&&(i="fit-document"):i=e>this.frmWindow.getViewerFrame().getBoundingClientRect().width?"fit-width":"zoomed"}this.uiElements.documentContainer=new t.Element("div",{id:"_3dp-doc-container",context:this.context,tabindex:0,styles:{position:"relative",flex:1,overflow:"hidden","background-color":"#f4f5f6",outline:"none"}}).inject(this.uiElements.viewerContainer);var s=function(e,t){e.url?window.open(e.url,"_blank"):this.goToPDFDestination(e.dest,t)}.bind(this),o={doc:this.optionDoc,onPageSelectCB:this.onPageSelectCB,onAnnotationUpdateCB:this.onAnnotationUpdateCB,onHyperlinkClickCB:s,container:this.uiElements.documentContainer,angle:this.angle,loadwithBrowsergestures:this.loadwithBrowsergestures,currentPageIndex:e,frameWindow:this.frmWindow,isMobile:this.isMobile,viewerState:i,gestures:this.gestures,displayZoomPercent:this.displayZoomPercent,onUpdate:function(e){this.updateAllComponents(e,this.doc)}.bind(this)};0===this.currentView?(this.uiElements.documentContainer.setStyles({"background-color":"#000000"}),t.extend(o,{onFullscreenEnd:function(e){let t=u.getCommand("PresentationView",this.frmWindow.experience.ctx);t.isRunning()&&t.end(),this.launchSinglePageView(),u.getCommand("SinglePageView",this.frmWindow.experience.ctx).begin()}.bind(this)}),this.doc=new b(o),this.showScrollBar=!1,this.showPageNumber=!1):1===this.currentView?this.doc=new y(o):2===this.currentView&&(this.doc=new P(o)),this.uiElements.pageViewsContainer=this.doc.getContainer();var a={container:this.uiElements.viewerContainer,onUpdate:function(e){void 0!==e.currentValue&&this.doc.scrollTo({y:e.currentValue}),void 0!==e.finalValue&&(this.doc.scrollTo({y:e.finalValue}),this.doc.render()),this.updateAllComponents(e,this.scroller)}.bind(this),isAndroid:this.frmWindow.experience._android,context:this.context};this.showScrollBar&&(this.scroller=new w(a)),this.showPageNumber&&this.createPageFinderUI(),this.enableKeyboardEvents(),this.enableNavigationKeyboardEvents(),this.updateAllComponents({pageIndex:this.getCurrentPage().index},this.doc)},setContextualBarPosition:function(){if(this.scroller&&this.scroller.uiElements&&this.scroller.uiElements.scrollBar)return{position:"right",value:this.scroller.uiElements.scrollBar.style.width}},goToPDFDestination:function(e,t){this.doc.getPageIndexOfHyperlink(e,function(i){this.setCurrentPage(i.pageIndex);let n,s,o,a,r="object"==typeof e?e:i.ref,h=(this.doc.getReframeScale(),0),l=this.uiElements.documentContainer.getBoundingClientRect(),c=this.getCurrentPage().getPageContainer().getBoundingClientRect();switch(r[1].name){case"FitR":var d=r[2],u=r[3],g=r[4],p=r[5];switch(t){case 0:case 360:n=Math.min(d,g),s=Math.max(d,g),a=this.getPageFromNumber(i.pageIndex).originalHeight-Math.min(u,p),o=this.getPageFromNumber(i.pageIndex).originalHeight-Math.max(u,p);break;case 90:o=Math.min(d,g),a=Math.max(d,g),s=Math.max(u,p),n=Math.min(u,p);break;case 180:o=Math.min(u,p),a=Math.max(u,p),s=this.getPageFromNumber(i.pageIndex).originalWidth-Math.min(d,g),n=this.getPageFromNumber(i.pageIndex).originalWidth-Math.max(d,g);break;case 270:n=this.getPageFromNumber(i.pageIndex).originalWidth-Math.max(u,p),s=this.getPageFromNumber(i.pageIndex).originalWidth-Math.min(u,p),a=this.getPageFromNumber(i.pageIndex).originalHeight-Math.min(d,g),o=this.getPageFromNumber(i.pageIndex).originalHeight-Math.max(d,g)}var m=Math.abs(s-n),f=Math.abs(o-a),D=l.height/(f*this.doc.zoomScale),w=l.width/(m*this.doc.zoomScale),x=Math.min(D,w);this.doc.scale({zoomScale:x,zoomCenter:{x:c.left<0?0:c.left,y:c.top<0?0:c.top}}),(v=this.doc.getOriginalPageInfoWithMargin(i.pageIndex))&&(h-=v.top*this.doc.zoomScale),h-=o*this.doc.zoomScale,this.updateLayout({top:h,left:-n*this.doc.zoomScale});break;case"XYZ":switch(this.angle){case 0:case 360:n=null!=r[2]?r[2]:0,o=null!=r[3]?this.getPageFromNumber(i.pageIndex).originalHeight-r[3]:0;break;case 90:n=null!=r[2]?this.getPageFromNumber(i.pageIndex).originalHeight-r[2]:0,o=null!=r[3]?this.getPageFromNumber(i.pageIndex).originalWidth-r[3]:0;break;case 180:n=null!=r[2]?this.getPageFromNumber(i.pageIndex).originalWidth-r[2]:0,o=null!=r[3]?r[3]:this.getPageFromNumber(i.pageIndex).originalHeight;break;case 270:n=null!=r[2]?r[2]:0,o=null!=r[3]?r[3]:0}var v;r[4]&&this.doc.scale({zoomScale:r[4]}),(v=this.doc.getOriginalPageInfoWithMargin(i.pageIndex))&&(h-=v.top*this.doc.zoomScale),h-=o*this.doc.zoomScale,this.updateLayout({top:h,left:-n*this.doc.zoomScale}),this.render();break;case"Fit":case"FitB":this.setCurrentPage(i.pageIndex),this.reframe();break;case"FitH":case"FitBH":o=this.getPageFromNumber(i.pageIndex).originalHeight-r[2],this.setCurrentPage(i.pageIndex),this.fitWidth(),this.updateLayout({top:this.uiElements.pageViewsContainer.offsetTop-o*this.doc.zoomScale});break;case"FitV":case"FitBV":n=r[2];var P=l.height/(this.getCurrentPage().originalHeight*this.doc.zoomScale);this.doc.scale({zoomScale:P}),this.setCurrentPage(i.pageIndex),this.updateLayout({left:-n*this.doc.zoomScale})}}.bind(this))},destroyUI:function(){this.disableEvents(),this.disableKeyboardEvents(),this.disableNavigationKeyboardEvents(),this.disableCATIAEvents(),this.pageFinderComponent&&(this.pageFinderComponent.dispose(),this.pageFinderComponent=void 0),this.doc.dispose(),this.scroller&&(this.scroller.dispose(),this.scroller=void 0),this.doc=void 0,this.uiElements.documentContainer.remove(),this.uiElements.documentContainer=void 0},createPageFinderUI:function(){var e={documentContainer:this.uiElements.documentContainer,viewerContainer:this.uiElements.viewerContainer,pageLength:this.getNumberOfPages(),currentPageIndex:this.getCurrentPage().index,pageLabelList:this.doc.pdfDoc.pageLabels,onUpdate:function(e){this.updateAllComponents(e,this.pageFinderComponent),1===this.currentView?this.reframe():this.render()}.bind(this),isMobile:this.isMobile,MAB:this.frmWindow.getActionBar().MAB};this.pageFinderComponent=new x(e)},createDivAboveAnnotation:function(e,i,n){let s=this.getAnnotationInformation({pageNumber:e,annotID:i}),o=s.shape.data.text.length,a=(s.bbox[2].y-s.bbox[0].y)/o,r=s.bbox[2].x-s.bbox[0].x,h=s.bbox[0].x/s.bBoxUnScaled[0].x,l=s.bbox[0].y+n*a+2,c=s.bbox[0].x+2,d=s.shape.data.fontSize*s.shape.data.controlScale*h,u=s.shape.graphicalProp.color+"",g="layer-above-annot-"+i+"-"+n,p=new t.Element("div",{id:g,styles:{position:"absolute",top:l+"px",left:c+"px",width:r+"px",height:a+"px","z-index":3,"pointer-events":"auto","background-color":"rgba(255,255,255,0)",color:u,"font-size":d+"px",display:"flex","justify-content":"center","flex-wrap":"nowrap"}});return this.divAboveAnnotation.push(p),p},highlightAnnotationSearchResult:function(){if(this.currSearchResultInfo){this.divAboveAnnotation=[];for(let e=0;e<this.currSearchResultInfo.stringID.length;e++){let t=this.getPageFromNumber(this.currSearchResultInfo.pageIndex);if(!t.annotCanvas)return;let i=this.createDivAboveAnnotation(this.currSearchResultInfo.pageIndex,this.currSearchResultInfo.annotID,this.currSearchResultInfo.stringID[e]);t.uiElements.pageContainer.appendChild(i);let n=this.getAnnotationInformation({pageNumber:this.currSearchResultInfo.pageIndex,annotID:this.currSearchResultInfo.annotID}).shape.data.text[this.currSearchResultInfo.stringID[e]];this.createInnerHTML(i,this.currSearchResultInfo.charID[e],n,this.currSearchResultInfo.length[e])}}},removeHighlightFromAnnotationSearchResult:function(){this.removeDivAboveAnnotation()},formCurrentSearchResultInfo:function(e){let t=this.searchResults[e]?parseInt(this.searchResults[e].pageIndex)+1:void 0,i=this.searchResults[e]?this.searchResults[e].searchResults:null;this.searchResults[e]&&this.searchResults[e].hasOwnProperty("annotID")?this.currSearchResultInfo={searchIndex:e,pageIndex:t,annotID:this.searchResults[e].annotID,stringID:this.searchResults[e].stringID,charID:this.searchResults[e].charID,length:this.searchResults[e].length}:this.currSearchResultInfo={searchIndex:e,pageIndex:t,lines:i}},createSearchUI:function(){for(var e=[],t=this.getNumberOfPages(),i=!1,s=1;s<=t;s++)this.doc.getPage(s).pageInfo.textContent&&(i=!0,e.push(this.doc.getPage(s).pageInfo.textContent));if(i&&(!window.__karma__||window.__karma__&&1==n.isSet("ODT_MODE_SEARCHTEXT"))){var o={container:this.uiElements.uiContainer,showSearchResult:this.highlightSearchResult.bind(this),hideSearchResult:this.removeHighlightFromSearchResult.bind(this),onUpdate:function(e){if(e.hasOwnProperty("resultsFromSources"))return this.mergeResults(e.resultsFromSources);if(!1===e.visible)return this.removeHighlightFromSearchResult(this.currSearchResultInfo),void this.stopSearchCommand();null===e.currentSearchIndex&&(this.currSearchResultInfo=null,this.searchResults=[]),this.currSearchResultInfo&&this.removeHighlightFromSearchResult(),null!==e.currentSearchIndex&&this.formCurrentSearchResultInfo(e.currentSearchIndex),this.currSearchResultInfo&&e.isVisible&&e&&!e.isZoomActive&&this.showSearchResult(e.currentSearchIndex);let t=this.getCurrentState();this.updateAllComponents({pageIndex:t.currentPageIndex,top:t.vArea.top,left:t.vArea.left},this.searchComponent)}.bind(this)};this.searchComponent=new E(o),this.searchComponent.passSourceDataToWorker(e,"textData")}},drawAnnotationsAfterRotation:function(e){var t=Object.keys(e),i=this.getAllPages();if(t.length===i.length)for(var n=0;n<t.length;n++){var s=t[n],o=i[n],a=e[s];0<Object.keys(a).length&&o.setAnnotations(a)}},enableEvents:function(){this.doc.enableEvents(),this.pageFinderComponent&&this.pageFinderComponent.enable()},disableEvents:function(){this.doc.disableEvents(),this.pageFinderComponent&&(this.pageFinderComponent.switchToPrimaryView(),this.pageFinderComponent.disable())},enableCATIAEvents:function(){this.doc.enableCATIAEvents()},disableCATIAEvents:function(){this.doc.disableCATIAEvents()},enableKeyboardEvents:function(){this.KEYBOARD_EVENTS={keydown:function(e){if(this.checkContext(e)){var t=u.getCommands(this.frmWindow.experience.ctx);switch(e.key){case"Enter":if(t.Search.isRunning())e.shiftKey?this.searchComponent.goToPreviousSearchResult():this.searchComponent.goToNextSearchResult();else{let e=!0;this.pageFinderComponent.validateEvent(e)}break;case"F3":e.preventDefault(),e.stopPropagation(),t.Search.isRunning()?e.shiftKey?this.searchComponent&&this.searchComponent.goToPreviousSearchResult():this.searchComponent&&this.searchComponent.goToNextSearchResult():this.startSearchCommand();break;case"=":case"+":e.ctrlKey&&t&&t.ScaleP&&(e.preventDefault(),e.stopPropagation(),t.ScaleP.begin());break;case"_":case"-":e.ctrlKey&&t&&t.ScaleM&&(e.preventDefault(),e.stopPropagation(),t.ScaleM.begin())}}}.bind(this)};for(var e=Object.keys(this.KEYBOARD_EVENTS),t=0;t<e.length;t++){var i=e[t];document.addEventListener(i,this.KEYBOARD_EVENTS[i],!0)}},disableKeyboardEvents:function(){for(var e=Object.keys(this.KEYBOARD_EVENTS),t=0;t<e.length;t++){var i=e[t];document.removeEventListener(i,this.KEYBOARD_EVENTS[i],!0)}},enableNavigationKeyboardEvents:function(){this.KEYBOARD_NAVIGATION_EVENTS={keydown:function(e){this.checkContext(e)&&70===e.keyCode&&!0===e.ctrlKey&&(e.preventDefault(),this.startSearchCommand())}.bind(this)};for(var e=Object.keys(this.KEYBOARD_NAVIGATION_EVENTS),t=0;t<e.length;t++){var i=e[t];document.addEventListener(i,this.KEYBOARD_NAVIGATION_EVENTS[i],!0)}},disableNavigationKeyboardEvents:function(){for(var e=Object.keys(this.KEYBOARD_NAVIGATION_EVENTS),t=0;t<e.length;t++){var i=e[t];document.removeEventListener(i,this.KEYBOARD_NAVIGATION_EVENTS[i],!0)}},enableTouchEvents:function(){this.doc.enableTouchEvents()},disableTouchEvents:function(){this.disableTouchEvents()},getCurrentPage:function(){return this.doc.getCurrentPage()},setZoomState:function(){var e=u.getCommands(this.frmWindow.experience.ctx);e&&(this.doc.zoomScale>=this.MAX_ZOOM_SCALE?(e.ScaleP.disable(),e.ScaleM.enable()):this.doc.zoomScale<=this.MIN_ZOOM_SCALE?(e.ScaleP.enable(),e.ScaleM.disable()):(e.ScaleP.enable(),e.ScaleM.enable()))},setPrevNextState:function(){this.cmds=u.getCommands(this.frmWindow.experience.ctx);var e=this.uiElements.documentContainer.getBoundingClientRect(),t=this.uiElements.pageViewsContainer.getBoundingClientRect(),i=t.top-e.top;if(this.cmds&&this.cmds.Previous&&this.cmds.Next){if(2===this.currentView){if(t.height<=e.height)return this.cmds.Previous.disable(),void this.cmds.Next.disable();0===i?this.cmds.Previous.disable():this.cmds.Previous.enable();var n=this.uiElements.documentContainer.offsetHeight-this.uiElements.pageViewsContainer.offsetHeight;this.uiElements.pageViewsContainer.offsetTop===n||this.getCurrentPage().index===this.getNumberOfPages()?this.cmds.Next.disable():this.cmds.Next.enable()}else 0!==this.currentView&&1!==this.currentView||(this.cmds.Next.enable(),this.cmds.Previous.enable(),1===this.doc.getCurrentPage().index?this.cmds.Previous.disable():this.doc.getCurrentPage().index===this.getNumberOfPages()&&this.cmds.Next.disable());this.frmWindow.experience.publish("3DPLAY/2DEXP/MAB/SCROLL/NAVIGATIONSTATEUPDATE",{})}},setCurrentPage:function(e){this.doc.goToPage(e)},setScrollerHandleTop:function(e){var t=this.uiElements.documentContainer.getBoundingClientRect(),i=this.doc.getCurrentState();this.scroller&&this.scroller.update({containerHeight:t.height,contentHeight:i.height,position:i.top,animate:e})},goToPreviousPage:function(){var e=this.getCurrentPage();this.setCurrentPage(e.index-1),1===this.currentView?this.reframe():this.render()},goToNextPage:function(){var e=this.getCurrentPage();this.setCurrentPage(e.index+1),1===this.currentView?this.reframe():this.render()},getNumberOfPages:function(){return this.doc.getPagesCount()},getVisiblePages:function(){return this.doc.getVisiblePages()},getIfAnnotationRunning:function(){return this.doc.getIfAnnotationRunning()},zoomIn:function(){for(var e=[],t=this.doc.getMinZoomScale(),i=this.doc.getMaxZoomScale(),n=t;n<i;n*=2)e.push(n);e.push(i);for(var s=0;s<e.length;s++)if(e[s]>this.doc.zoomScale){this.scale(e[s]);break}this.render()},zoomOut:function(){for(var e=[],t=this.doc.getMinZoomScale(),i=this.doc.getMaxZoomScale(),n=t;n<i;n*=2)e.push(n);e.push(i);for(var s=e.length-1;s>=0;s--)if(e[s]<this.doc.zoomScale){this.scale(e[s]);break}this.render()},zoomfullSize:function(){this.scale(1),this.render()},scale:function(e,t=!0){this.loadwithBrowsergestures?this.doc.scaleText(e,t):this.doc.scale({zoomScale:e,isScaleAbsolute:t})},updateZoomCmdStatus:function(){var e=this.doc.getMinZoomScale(),t=this.doc.getMaxZoomScale(),i=u.getCommands(this.frmWindow.experience.ctx);i&&i.ScaleP&&i.ScaleM&&(this.doc.zoomScale>=t?(i.ScaleP.disable(),i.ScaleM.enable()):this.doc.zoomScale<=e?(i.ScaleP.enable(),i.ScaleM.disable()):(i.ScaleP.enable(),i.ScaleM.enable()))},getCurrentZoomScale:function(){return this.doc.zoomScale},getAllPages:function(){return this.doc.getPages()},useDocumentOptionFromJson:function(e,t){this.angle!==e.vAngle&&(this.angle=e.vAngle);var i,n=this.uiElements.documentContainer.getBoundingClientRect(),s=n.height,o=n.width,a=s/e.vArea.height,r=o/e.vArea.width;i=Math.min(a,r),this.currentView=2,e.viewType&&(this.currentView=e.viewType),this.updateView(!0),1==this.currentView&&e.currentPageIndex&&this.setCurrentPage(e.currentPageIndex),"reframe"===e.viewerState&&this.doc.getReframeScale()>this.doc.getMinZoomScale()?this.doc.reframe():"fit-width"===e.viewerState&&this.doc.getFitWidthScale()>this.doc.getMinZoomScale()?this.doc.fitWidth():"fit-document"===e.viewerState&&this.doc.getFitDocumentScale()>this.doc.getMinZoomScale()?this.doc.fitDocument():this.doc.scale({zoomScale:e.zScale*i,doNotRender:!t}),this.updateLayout({left:e.vArea.left*(this.doc.zoomScale/e.zScale),top:e.vArea.top*(this.doc.zoomScale/e.zScale)});var h=u.getCommands(this.ctx);h&&h.SinglePageView&&1===this.currentView&&(h.SinglePageView.begin(),this.frmWindow.getActionBar().MAB.updateToggle("SinglePageView","3DPlay2DExperience/3DPlay2DExperience",!0)),h&&h.ScrollingView&&2===this.currentView&&(h.ScrollingView.begin(),this.frmWindow.getActionBar().MAB.updateToggle("ScrollingView","3DPlay2DExperience/3DPlay2DExperience",!1)),t&&this.render()},drawAnnotationsFromJSON:function(e){var t=!1,i=Object.keys(e),n=this.getAllPages();if(i.length===n.length){for(var s=0;s<i.length;s++){var o=i[s],a=n[s],r=e[o];0<Object.keys(r).length&&(t=!0,a.setAnnotations(r,!1))}for(var h=0;h<n.length;h++)n[h].markForRender()}t?this.frmWindow.experience.publish("3DPLAY/ANNONATION/INSESSION",{}):this.frmWindow.experience.publish("3DPLAY/ANNONATION/NOTINSESSION",{}),this.render(function(){this.updateAllComponents({pageIndex:this.doc.getCurrentPage().index},this.doc)}.bind(this))},drawAnnotationsFromJSONOld:function(e){var t=Object.keys(e),i=this.getAllPages();if(t.length===i.length){for(var n=1,s=0,o=0;o<t.length;o++){var a=t[o],r=i[o],h=e[a],l=Object.keys(h);0<l.length&&r.setAnnotations(h,!1);for(var c=0;c<l.length;c++){var d=parseInt(l[c]);d>s&&(s=d,n=r.index)}}for(var u=0;u<i.length;u++)i[u].markForRender();this.setCurrentPage(n),this.reframe()}},render:function(e){this.doc.render(function(){e&&e()}.bind(this))},showOnlyViewer:function(){this.viewSplitter.showRightColumnOnly()},updateThumbnailVisibility:function(){var e=this.getVisiblePages(),t=this.viewSplitter.getCurrentState();return e.length>0&&(1===t||3===t)&&e[e.length-1].index},showOnlyNavigationPanel:function(){this.getCurrentPage().select(),this.viewSplitter.showLeftColumnOnly(),this.leftColumnContentContainer.style.height=this.viewSplitter.uiElements.mainView.clientHeight-this.viewSplitter.uiElements.leftColumnTopBar.clientHeight+"px",this.tab.elements.container.children[1].style.height=this.leftColumnContentContainer.clientHeight-this.tab.elements.container.children[0].clientHeight+"px",this.docNavigationPanel.loadThumbnails(),setTimeout(function(){this.frmWindow.getActionBar().MAB.showNone()}.bind(this),100)},showBothViewerAndNavigationPanel:function(){this.getCurrentPage().select(),this.viewSplitter.showBothColumns(),this.leftColumnContentContainer.style.height=this.viewSplitter.uiElements.mainView.clientHeight-this.viewSplitter.uiElements.leftColumnTopBar.clientHeight+"px",this.tab.elements.container.children[1].style.height=this.leftColumnContentContainer.clientHeight-this.tab.elements.container.children[0].clientHeight+"px",this.docNavigationPanel.loadThumbnails()},getPageUnderMouse:function(e){return this.doc.getPageUnderMouse(e)},fitDocument:function(e,t){this.doc.fitDocument(e),t||this.render()},fitWidth:function(e){this.doc.fitWidth(e)},fitHeight:function(){this.doc.fitHeight()},reframe:function(e){this.doc.reframe(e)},updateLayout:function(e){this.doc.updateLayout(e)},getViewerPositionFromMouse:function(e){for(var t=0,i=this.uiElements.viewerContainer.getBoundingClientRect(),n=this.uiElements.documentContainer.getBoundingClientRect(),s=this.uiElements.pageViewsContainer.getBoundingClientRect().top-n.top,o=e.y-i.top,a=Math.abs(s-o),r=this.getVisiblePages(),h=0;h<r.length;h++){var l=r[h].originalTop*this.doc.zoomScale,c=r[h].originalHeight*this.doc.zoomScale;if(l<=a&&l+c>=a){t=r[h];break}}if(t){var d=t.getContent();if(d){var u=d.getBoundingClientRect(),g=e.x-u.left,p=e.y-u.top;if(g>=0&&g<=u.width&&p>=0&&p<=u.height){var m=d.width/t.originalWidth;return g/=m,p/=m,{pageNumber:t.index,pos:{x:g*(d.width/u.width),y:p*(d.height/u.height)}}}}return null}return null},getContainer:function(){return this.uiElements.viewerContainer},getDocContainer:function(){return this.uiElements.documentContainer},enableResize:function(e){this.resizeEnabled=e},onViewChange:function(){this.resizeEnabled&&(this.loadwithBrowsergestures?this.doc.scaleText(this.doc.zoomScale):this.getVisiblePages().length>0&&(this.isMobile&&"fit-document"===this.getViewerState()?this.fitDocument():this.isMobile||"fit-width"!==this.getViewerState()?"reframe"===this.getViewerState()?this.reframe():(this.updateLayout({}),this.render()):this.fitWidth()))},getPagesContainer:function(e){return this.uiElements.pageViewsContainer},getPageFromNumber:function(e){return this.doc.getPage(e)},setDrawStyle:function(e){var t=this.getPageFromNumber(e.pageNumber);return!!t&&t.setDrawStyle(e)},setDrawStyleForHighlight:function(e){var t=this.getPageFromNumber(e.pageNumber);return!!t&&t.setDrawStyleForHighlight(e)},getScale:function(){return this.doc.zoomScale},drawPreview:function(e){var t=this.getPageFromNumber(e.pageNumber);return!!t&&t.drawPreview(e)},drawPreviewWithShapeData:function(e){var t=this.getPageFromNumber(e.pageNumber);return!!t&&t.drawPreviewWithShapeData(e)},renderPage:function(e){var t=this.getPageFromNumber(e.pageNumber);return t&&(t.markForRender(),t.render(e)),!1},renderPageAnnotation:function(e){var t=this.getPageFromNumber(e.pageNumber);return t&&t.renderAllAnnotations(),!1},getUnderneathAnnotations:function(e){var t=this.getPageFromNumber(e.pageNumber);return!!t&&t.getUnderneathAnnotations(e)},getAnnotationInformationRaw:function(e){var t=this.getPageFromNumber(e.pageNumber);return!!t&&t.getAnnotationInformationRaw(e)},getAnnotationInformation:function(e){var t=this.getPageFromNumber(e.pageNumber);return!!t&&t.getAnnotationInformation(e)},getUnProcessedAnnotationInformation:function(e){var t=this.getPageFromNumber(e.pageNumber);return!!t&&t.getUnProcessedAnnotationInformation(e)},getProcessedAnnotationInformation:function(e){var t=this.getPageFromNumber(e.pageNumber);return!!t&&t.getProcessedAnnotationInformation(e)},createAnnotation:function(e){var t=this.getPageFromNumber(e.pageNumber);if(t){if(this.frmWindow.experience.annotationManager)this.frmWindow.experience.annotationManager.getAllAnnotationAvailibility()||this.frmWindow.experience.publish("3DPLAY/ANNONATION/INSESSION",{});return e.viewerScale=this.doc.zoomScale,t.createAnnotation(e)}return!1},createAnnotationWithShapeData:function(e){var t=this.getPageFromNumber(e.pageNumber);if(t){if(this.frmWindow.experience.annotationManager)this.frmWindow.experience.annotationManager.getAllAnnotationAvailibility()||this.frmWindow.experience.publish("3DPLAY/ANNONATION/INSESSION",{});return e.viewerScale=this.doc.zoomScale,t.createAnnotationWithShapeData(e)}return!1},createAnnotationWithTextData:function(e){var t=this.getPageFromNumber(e.pageNumber);if(t){if(this.frmWindow.experience.annotationManager)this.frmWindow.experience.annotationManager.getAllAnnotationAvailibility()||this.frmWindow.experience.publish("3DPLAY/ANNONATION/INSESSION",{});return t.createAnnotationWithTextData(e)}return!1},drawAnnotations:function(e){var t=this.getPageFromNumber(e.pageNumber);if(t&&e.idList){for(var i=0;i<e.idList.length;++i)t.drawAnnotation({id:e.idList[i],lowLightMode:e.lowLightMode,editMode:e.editMode});return!0}return!1},getAnnotations:function(e){var t=this.getPageFromNumber(e.pageNumber);return t?t.getAnnotations():null},getIntersectingAnnotations:function(e){var t=this.getPageFromNumber(e.pageNumber);return t?t.getIntersectingAnnotations(e):null},getScreenShot:function(e){var t=this.uiElements.documentContainer.getBoundingClientRect(),i=this.getVisiblePages(),n=document.createElement("canvas"),s=window.devicePixelRatio>1?window.devicePixelRatio:1;n.width=t.width*s,n.height=t.height*s;var o=n.getContext("2d");o.fillStyle="#f4f5f6",o.beginPath(),o.fillRect(0,0,n.width,n.height),o.closePath();i=this.getVisiblePages();for(var a=t.top,r=i[0].canvas.getBoundingClientRect().top,h=r>a?r-a:0,l=0;l<i.length;l++){var c=i[l].getVisibleArea(),d=i[l].getScale()/i[l].getPhysicalScale(),u=(x=t.width-i[l].originalWidth*i[l].getPhysicalScale())>0?.5*x:0,g=Math.floor(c.left*s*d),p=Math.floor(c.top*s*d),m=Math.floor(c.width*s*d),f=Math.floor(c.height*s*d);m-=1,f-=1;var D=Math.floor(u*s),w=Math.floor(h*s),x=Math.floor(c.width*s),v=Math.floor(c.height*s);o.drawImage(i[l].canvas,g,p,m,f,D,w,x,v),o.drawImage(i[l].annotCanvas,g,p,m,f,D,w,x,v);var P=2*this.doc.getPageMargin()*this.doc.zoomScale;h=h+Math.abs(c.height)+P}var y=e.type?"image/"+e.type:"png";"jpeg"===e.type?n.toBlob(function(t){e.onSuccess(t)},"image/jpeg"):e.onSuccess(n.toDataURL(y))},getScreenShotForText:function(e){var t=this.getVisiblePages()[0],i=t.pageInfo.src.split(/\r\n|\r|\n/),n=i.length,s=t.getTextElementContent(),o=s.scrollHeight,a=(s.clientHeight,s.scrollWidth),r=s.scrollTop,h=-1*s.scrollLeft,l=o/n,c=parseFloat(s.style.fontSize),d=document.createElement("canvas"),u=Math.floor(r/l),g=u+Math.floor(this.uiElements.documentContainer.getBoundingClientRect().height/l)+2;d.width=this.uiElements.documentContainer.getBoundingClientRect().width,d.height=(g-u)*l;var p=d.getContext("2d");p.font.split(" ");if(p.font=c+"px consolas",p.fillStyle="#f4f5f6",p.beginPath(),p.fillRect(0,0,d.width,d.height),p.closePath(),0!=h){for(var m=0,f="",D=0;D<n;D++)i[D].length>m&&(D,m=i[D].length,f=i[D]);if(1<(ee=f.split(/\r\t|\r|\t/)).length){var w="";for(D=0;D<ee.length;D++)w+=ee[D],D!=ee.length-1&&(w+="        ");m=(f=w).length}var x=Math.floor(Math.abs(h)*m/a),v=f.slice(0,x);h=-1*p.measureText(v).width}for(var P={},y=t.getTextElementContent().childNodes,b=-1,E=!1,S=0,C=!1,A=0;A<y.length;A++)if(1==y[A].nodeType){var T=Math.abs(y[A].offsetLeft),I=Math.abs(y[A].offsetTop),V=y[A].getText().split(/\r\n|\r|\n/),M=V.length;""==V[M-1]&&(V.pop(),C=!0,M=V.length);var L=Math.round(I/l);if(-1==b)L=0,V[b=V.length-1]==i[b]?(E=!0,S=i[b].length):(E=!1,S=V[b].length);else if(0==E)L=b,(j=b+V.length-1)==b?(b=j,(S+=V[V.length-1].length)==i[b].length&&(E=!0)):(b=j,(S=V[V.length-1].length)==i[b].length&&(E=!0));else L=b+1,b+=V.length,E=(S=V[V.length-1].length)==i[b].length;for(var k=L,R=0;R<M;R++){(Y=P[""+k])||(Y={linedata:[]},P[""+k]=Y);var W="",_="",B=0,O=1,N=!1;0==R&&(O=T),B=1==M?y[A].offsetWidth:0==R?y[A].offsetWidth-y[A].offsetLeft:M-1==R?p.measureText(V[R]).width:y[A].offsetWidth;i[k].length;if(V[R]==i[k]&&(N=!0),0==N){var H,F=!1,U=!1;if(0==O||1==O)U=!0;else{var z=i[k].slice(0,i[k].length-V[R].length);(z+=V[R])==i[k]?F=!0:(U=!0,F=!0)}if(1==U&&y[A].nextSibling&&3==y[A].nextSibling.nodeType)(H=y[A].nextSibling.textContent.split(/\r\n|\r|\n/))&&(_=H[0]);if(1==F&&y[A].previousSibling&&3==y[A].previousSibling.nodeType)(H=y[A].previousSibling.textContent.split(/\r\n|\r|\n/))&&(W=H[H.length-1])}Y.linedata.push({text:V[R],left:O,fullline:N,width:B,prevInline:W,nextInline:_}),k++}}else{var j,Z=y[A].textContent.split(/\r\n|\r|\n/);if(-1==b)Z[b=Z.length-1]==i[b]?(E=!0,S=i[b].length):(E=!1,S=Z[b].length);else if(0==E)(j=b+Z.length-1)==b?(b=j,(S+=Z[Z.length-1].length)==i[b].length&&(E=!0)):(b=j,(S=Z[Z.length-1].length)==i[b].length&&(E=!0));else 0==C&&Z.shift(),b+=Z.length,C=!1,E=(S=Z[Z.length-1].length)==i[b].length}var G=0;for(D=u;D<g&&!(D>=n);D++){var Y;if(G++,Y=P[""+D]){var X=Y.linedata;if(X.sort(function(e,t){return e.left-t.left}),1==X.length&&1==X[0].fullline)p.fillStyle="#FEE000",p.fillRect(h,l*(G-1)+(l-c)/2,p.measureText(i[D]).width,l),p.fillStyle="#000000",p.fillText(i[D],h,l*G);else{for(var K="",q=[],J=0;J<X.length;J++){var Q=X[J];Q.prevInline.length>0&&(K+=Q.prevInline,q.push({text:Q.prevInline,color:"#000000"})),K+=Q.text,q.push({text:Q.text,color:"#FEE000"}),Q.nextInline.length>0&&(K+=Q.nextInline,q.push({text:Q.nextInline,color:"#000000"}))}if(K==i[D]){var $=h;for(ie=0;ie<q.length;ie++)"#FEE000"==q[ie].color&&(p.fillStyle=q[ie].color,p.fillRect($,l*(G-1)+(l-c)/2,p.measureText(q[ie].text).width,l)),p.fillStyle="#000000",p.fillText(q[ie].text,$,l*G),$+=p.measureText(q[ie].text).width}else p.fillStyle="#000000",p.fillText(i[D],h,l*G)}}else{var ee,te=i[D];if(1<(ee=te.split(/\r\t|\r|\t/)).length){w="";for(var ie=0;ie<ee.length;ie++)w+=ee[ie],ie!=ee.length-1&&(w+="        ");te=w}p.fillStyle="#000000",p.fillText(te,h,l*G)}}var ne=e.type?"image/"+e.type:"png";"jpeg"===e.type?d.toBlob(function(t){e.onSuccess(t)},"image/jpeg"):e.onSuccess(d.toDataURL(ne))},destroyAnnotations:function(e){var t=this.getPageFromNumber(e.pageNumber);if(t&&e.idList){if(t.destroyAnnotations(e),this.frmWindow.experience.annotationManager)this.frmWindow.experience.annotationManager.getAllAnnotationAvailibility()||this.frmWindow.experience.publish("3DPLAY/ANNONATION/NOTINSESSION",{});return!0}return!1},createInnerHTML:function(e,t,i,n){var s=i.substring(0,t),o=i.substring(t,t+n),a=i.substring(t+n);e.innerHTML="";var r,h,l=document.createDocumentFragment();""!==s&&((h=document.createElement("mark")).style.opacity=0,h.appendChild(document.createTextNode(s)),l.appendChild(h)),(r=document.createElement("mark")).className="_3dp-search-result-highlight",r.appendChild(document.createTextNode(o)),l.appendChild(r),""!==a&&((h=document.createElement("mark")).style.opacity=0,h.appendChild(document.createTextNode(a)),l.appendChild(h)),e.appendChild(l)},highlightSearchResult:function(){if(this.currSearchResultInfo)if(this.currSearchResultInfo&&this.currSearchResultInfo.hasOwnProperty("annotID"))this.highlightAnnotationSearchResult();else if(void 0!==this.currSearchResultInfo){var e=this.currSearchResultInfo.pageIndex;let o=this.getPageFromNumber(e);if(!o)return;if(!o.textLayer)return;for(var t=this.currSearchResultInfo.lines,i=0;i<t.length;i++){var n="#Page-"+e+"-TextLayer #Page-"+e+"-span-"+t[i].textElemIndex,s=document.querySelector(n);s&&t[i].offset>=0&&this.createInnerHTML(s,t[i].offset,s.innerText,t[i].length)}}},removeHighlightFromSearchResult:function(){if(this.currSearchResultInfo)if(this.currSearchResultInfo&&this.currSearchResultInfo.hasOwnProperty("annotID"))this.removeHighlightFromAnnotationSearchResult();else if(void 0!==this.currSearchResultInfo){var e=this.currSearchResultInfo.pageIndex;let l=this.getPageFromNumber(e);if(!l)return;var t=l.textLayer;if(t)for(var i=this.currSearchResultInfo.lines,n=0;n<i.length;n++){var s=-1,o=0;for(let e=0;e<t.children.length;e++)if("span"===t.children[e].tagName.toLowerCase()&&s++,s===i[n].textElemIndex){o=e;break}var a=t.children[o];if(a){for(var r="",h=0;h<a.childNodes.length;h++)r+=a.childNodes[h].textContent;a.innerHTML=r}}}},updateTopAndLeft:function(){let e=document.getElementsByClassName("_3dp-search-result-highlight")[0];if(e){var t=e.getBoundingClientRect(),i=this.uiElements.documentContainer.getBoundingClientRect(),n=0;t.top+t.height>i.top+i.height?n=t.top+t.height-(i.top+i.height):t.top<i.top&&(n=t.top-i.top);var s=0;t.left+t.width>i.left+i.width?s=t.left+t.width-(i.left+i.width):t.left<i.left&&(s=t.left-i.left);var o=this.uiElements.pageViewsContainer.offsetTop-n,a=this.uiElements.pageViewsContainer.offsetLeft-s;this.updateLayout({left:a,top:o})}},rearrangeSearchResultsOfPage:function(e){let t=null,i=null;for(let n=0;n<this.searchResults.length;n++)if(null===t&&this.searchResults[n].pageIndex+1===e&&(t=n),null!==t&&null===i&&this.searchResults[n].pageIndex+1!==e&&n>t){i=n;break}let n=this.searchResults.slice(t,i),s=function(t){let i=null;if(t.hasOwnProperty("annotID")){i=this.getAnnotationInformation({pageNumber:e,annotID:t.annotID}).bbox[0].y}else{var n="#Page-"+e+"-TextLayer #Page-"+e+"-span-"+t.searchResults[0].textElemIndex,s=document.querySelector(n);s&&(i=+s.style.top.split("px")[0])}return i}.bind(this),o=!1;for(let e=1;e<n.length;e++){let t=n[e],i=s(t),a=e-1;for(;a>=0&&s(n[a])>i;)n[a+1]=n[a],a--,o=!0;n[a+1]=t}return o&&this.searchResults.splice(t,i-t,...n),o},showSearchResult:function(e){if(!this.currSearchResultInfo)return;var t=function(){this.highlightSearchResult(),this.updateTopAndLeft()}.bind(this);let i=!1,n=this.getVisiblePages();for(let e=0;e<n.length;e++)if(n[e].index===this.currSearchResultInfo.pageIndex){i=!0;break}i?(this.rearrangeSearchResultsOfPage(this.currSearchResultInfo.pageIndex)&&this.formCurrentSearchResultInfo(e),t()):(this.doc._goToPage(this.currSearchResultInfo.pageIndex),this.render(()=>{this.rearrangeSearchResultsOfPage(this.currSearchResultInfo.pageIndex)&&this.formCurrentSearchResultInfo(e),t()}))},showSearchPanel:function(){this.searchComponent&&this.searchComponent.show()},hideSearchPanel:function(){this.searchComponent&&this.searchComponent.hide()},removeDivAboveAnnotation:function(){if(this.divAboveAnnotation){for(let e of this.divAboveAnnotation)e.remove(),e=null;this.divAboveAnnotation=null}},passAnnotDataForSearch:function(){if(!n.isSet("3DPlay.ActivateTextAnnotationSearch"))return;const e=this.getAllPages();let t=[];for(let i=0;i<e.length;i++){const n=e[i].getAnnotations();for(let e in n)"text"===n[e].data.type&&t.push(n[e].data.text)}this.searchComponent.passSourceDataToWorker(t,"textAnnotationData")},mapAnnotationSearchResults:function(e){const t=this.getAllPages();let i=0,n=!1;for(let s=0;s<e.length;s++){for(let o=0;o<t.length;o++){const a=[];for(let e of Object.values(t[o].getAnnotations()))"text"===e.type&&a.push(e);for(let t=0;t<a.length;t++)if(e[s].pageIndex===t+i){let i=[],r=[],h=[];for(let t of e[s].searchResults)i.push(t.textElemIndex),r.push(t.offset),h.push(t.length);let l={annotID:a[t].id,pageIndex:o,stringID:i,charID:r,length:h};e[s]=l,n=!0;break}if(!0===n){i=0;break}i+=a.length}n=!1}},mergeResults:function(e){e.textAnnotationData&&this.mapAnnotationSearchResults(e.textAnnotationData);let t=Object.values(e),i=function(e,t,i){let n=0,s=0,o=e.length-1,a=t.length-1;for(;n<=o&&s<=a;)e[n].pageIndex<=t[s].pageIndex?(i.push(e[n]),n++):(i.push(t[s]),s++);for(;n<=o;)i.push(e[n]),n++;for(;s<=a;)i.push(t[s]),s++;return i};for(this.searchResults=[];t.length>1;){let e=t.shift(),n=t.shift(),s=[];t.push(i(e,n,s))}return 1===t.length&&(this.searchResults=this.searchResults.concat(t[0])),this.searchResults.length},startSearchCommand:function(e){this.passAnnotDataForSearch(),this.cmds=u.getCommands(this.frmWindow.experience.ctx),this.cmds.Search&&!this.cmds.Search.isRunning()&&this.cmds.Search.begin(),this.searchComponent&&(e?this.searchComponent.initializeWithData(e):this.searchComponent.reset())},stopSearchCommand:function(){this.removeDivAboveAnnotation(),this.cmds=u.getCommands(this.frmWindow.experience.ctx),this.cmds.Search&&this.cmds.Search.end()},getCurrentState:function(){var e=this.uiElements.documentContainer.getBoundingClientRect(),t=this.uiElements.pageViewsContainer.getBoundingClientRect(),i=this.getViewerState();return{vAngle:this.angle,zScale:this.doc.zoomScale,viewType:this.currentView,currentPageIndex:this.doc.getCurrentPage().index,vArea:{top:t.top-e.top,left:t.left-e.left,height:e.height,width:e.width},viewerState:i}},initiateViewModes:function(){this.reviewMode?this.launchReadMode():this.launchReviewMode()},launchReadMode:function(){if(this.reviewMode=!1,this.doc.disableInteractiveText(),u&&u.getCommandCheckHeaders){var e=u.getCommandCheckHeaders(this.frmWindow.experience.ctx);if(e){var t=e.ToggleView,i=e.RightSidePanel;void 0!==t&&t.getState()&&(this.thumbnailPanel_open=t.getState(),t.toggleState()),void 0!==i&&i.getState()&&(this.rightPanel_open=i.getState(),i.toggleState())}}this.pageFinderComponent&&this.pageFinderComponent.hide(),this.frmWindow.getViewerFrame().offsetHeight>240&&this.frmWindow.getViewerFrame().offsetWidth>240&&(this.frmWindow.getActionBar().hide(),(this.isMobile||!0===this.frmWindow.getActionBar().MAB.state.visible)&&this.frmWindow.getActionBar().MAB.showNone())},launchReviewMode:function(){if(this.reviewMode=!0,this.doc.enableInteractiveText(),this.pageFinderComponent&&this.pageFinderComponent.switchToPrimaryView(),this.frmWindow.getViewerFrame().offsetHeight>240&&this.frmWindow.getViewerFrame().offsetWidth>240&&(this.frmWindow.getActionBar().show(),(this.isMobile||!0===this.frmWindow.getActionBar().MAB.state.visible)&&this.frmWindow.getActionBar().MAB.show()),u&&u.getCommandCheckHeaders){var e=u.getCommandCheckHeaders(this.frmWindow.experience.ctx);if(e){var t=e.ToggleView,i=e.RightSidePanel;this.thumbnailPanel_open&&void 0!==t&&(t.toggleState(),this.thumbnailPanel_open=!1),this.rightPanel_open&&void 0!==i&&(i.toggleState(),this.rightPanel_open=!1)}}},launchPresentationView:function(){0!==this.currentView&&(this.currentView=0,this.updateView(),this.launchReadMode())},launchSinglePageView:function(){1!==this.currentView&&(this.currentView=1,this.updateView())},launchScrollingView:function(){2!==this.currentView&&(this.currentView=2,this.updateView())},updateAllComponents:function(e,t){if(t!==this.doc&&this.doc.update(e),this.pageFinderComponent&&t!==this.pageFinderComponent&&(this.pageFinderComponent.update({pageIndex:this.getCurrentPage().index,pageLabel:this.doc.currentPage.pageInfo.pageLabel}),this.pageFinderComponent.isVisible()&&this.pageFinderComponent.switchToPrimaryView()),this.scroller&&t!==this.scroller){var i=this.uiElements.documentContainer.getBoundingClientRect(),n=this.doc.getCurrentState();this.scroller&&this.scroller.update({containerHeight:i.height,contentHeight:n.height,position:n.top,animate:!0})}this.setPrevNextState(!0),this.updateZoomCmdStatus(),this.frmWindow.experience.publish("3DPLAY/2DEXP/STATECHANGE",{zoomScale:this.doc.zoomScale});var s=this.updateThumbnailVisibility();this.viewSplitter&&t!==this.viewSplitter&&this.viewSplitter.update({isMABvisible:this.frmWindow.getActionBar().MAB.state.visible}),this.docNavigationPanel&&t!==this.docNavigationPanel&&(this.leftColumnContentContainer.style.height=this.viewSplitter.uiElements.mainView.clientHeight-this.viewSplitter.uiElements.leftColumnTopBar.clientHeight+"px",this.docNavigationPanel.update({lastpageVisiblePageIndex:s,rotate:this.angle,height:this.leftColumnContentContainer.clientHeight-this.tab.elements.container.children[0].clientHeight})),this.docCommentPanel&&t!==this.docCommentPanel&&this.docCommentPanel.update(e),this.docBookmarkPanel&&t!==this.docBookmarkPanel&&this.docBookmarkPanel.update(e),this.docAttachmentPanel&&t!==this.docAttachmentPanel&&this.docAttachmentPanel.update(e),this.searchComponent&&t!==this.searchComponent&&this.searchComponent.update(e)},setBackgroundColor:function(e){this.backgroundColor=e},getBackgroundColor:function(){return this.backgroundColor},enableAntiBackGroundBorder:function(){var e=void 0,t=this.getDocContainer().style.backgroundColor;if(t){var i=t.match(/\d+/g);if(i&&3==i.length){var n=parseInt(i[0]),s=parseInt(i[1]);e=(n+parseInt(i[2])+s)/3>=127?"rgb(0,0,0)":"rgb(255,255,255)"}}if(e){var o=this.doc.getCurrentPage();o&&o.enableAntiBackGroundBorder(e)}},disableAntiBackGroundBorder:function(){var e=this.doc.getCurrentPage();e&&e.disableAntiBackGroundBorder()},dispose:function(){this.destroyUI(),this.searchComponent&&this.searchComponent.dispose(),this.uiElements.viewerContainer&&(this.uiElements.viewerContainer.remove(),this.uiElements.viewerContainer=void 0),this.uiElements.uiContainer&&(this.uiElements.uiContainer.remove(),this.uiElements.uiContainer=void 0),this.uiElements=void 0,this.docNavigationPanel.dispose(),this.docNavigationPanel=void 0,this.frmWindow.getViewerFrame().removeEvent("resize",this.onWidgetResize),this.frmWindow&&(this.frmWindow.getViewer=void 0),this.viewSplitter.dispose(),this.viewSplitter=void 0},checkContext:function(e){let t=this.context,i=function(e){return!(!e||!e.getAttribute||e.getAttribute("context")!==t)||(!e||"_3dp-2d-view_splitter"!==e.id)&&(!(!e||!e.parentElement)&&i(e.parentElement))},n=e.gesture?e.gesture.events[0].event.target:e.target;return i(n)}})}),define("DS/3DPlay2DExperience/3DPlay2DExperience",["UWA/Core","DS/3DPlayExperienceModule/3DPlayExperience","DS/3DPlay2DExperience/DocumentViewer/DocumentViewer","DS/ApplicationFrame/FrameWindow","DS/WebSystem/Nls","DS/3DPlay/3DPlay","DS/3DPlayUtils/PanelManager","DS/WebSystem/Environment","DS/ApplicationFrame/CommandsManager","DS/3DPlay2DAnnotation/AnnotationManager","DS/WebUtils/ContextedSingleton","DS/WebSystem/App","DS/WebSystem/BrowserInfos","DS/WebUtils/Tracker","DS/CoreEvents/Events","i18n!DS/3DPlay2DExperience/assets/nls/3DPlay2DExperience"],function(e,t,i,n,s,o,a,r,h,l,c,d,u,g,p,m){"use strict";var f={text:["txt","aptsource","log","catnccode","gcode","nc","ncc","cnc","hdm","tap","ngc","gc","mpt","mpf","spf","num","mod","dat","src","ls","dtx","pgx","asc","pac","tid","tip","as","prg","jbi","csr","einrichteblatt","ing"],image:["jpg","bmp","jpeg","png","gif"],svg:["svg"],pdf:["pdf"]},D={pdf:"DS/3DPlay2DExperience/DocumentLoader/PDFLoader",image:"DS/3DPlay2DExperience/DocumentLoader/ImageLoader",svg:"DS/3DPlay2DExperience/DocumentLoader/SVGLoader",text:"DS/3DPlay2DExperience/DocumentLoader/TextLoader"},w="DS/3DPlay2DExperience/3DPlay2DExperience",x="DS/3DPlay2DExperience/3DPlayImageExperience",v="DS/3DPlay2DExperience/3DPlayTextExperience",P="DS/3DPlay2DExperience/3DPlaySVGExperience",y="DS/3DPlay2DExperience/3DPlaySVGExperienceForDrawing";return t.extend({init:function(e){this.viewer=void 0,this.actionBarLoaded=!1,this.assetLoaded=!1,this.loader,this._parent(e),this.loadingAsset={size:0},this.share3DCommentHide=!1;var t=this;e.options&&e.options.actionBarOptions&&e.options.actionBarOptions.commandOverrides&&e.input.actionBar.commandOverrides.forEach(function(e){"Share3DComment"===e.commandId&&-1!==e.actions.indexOf("hide")&&(t.share3DCommentHide=!0)}),e.FrameWindow=n,this.showDownloadCommand=!0,e.workbenchs=[],r.isSet("3DPlay.Activate3DComment")&&e.workbenchs.push({name:"3DPlayComment",module:"3DPlay"}),r.isSet("3DPlay.2D.EnablePresentationView")&&e.workbenchs.push({name:"PresentationView",module:"3DPlay2DExperience"}),e.workbenchs.unshift({name:"3DPlay2DExperience",module:"3DPlay2DExperience"}),e.options.actionBarOptions&&!0===e.options.actionBarOptions.hideDownloadCommand?this.showDownloadCommand=!1:e.workbenchs.push({name:"2DDownload",module:"3DPlay2DExperience"}),(d.is3DSwym()||d.is3DDrive()||d.is3DSpace()||d.is3DPlay())&&d.isOnCloud()&&!1===this.share3DCommentHide?this._iOS?e.workbenchs.push({name:"3DPlayShareComment_iOS",module:"3DPlay"}):e.workbenchs.push({name:"3DPlayShareComment",module:"3DPlay"}):this._iOS?e.workbenchs.push({name:"3DPlayShare_iOS",module:"3DPlay"}):e.workbenchs.push({name:"3DPlayShare",module:"3DPlay"}),d.is3DPlay()&&e.workbenchs.push({name:"RightPanel",module:"3DPlay2DExperience"})},computeViewerStats:function(){var e={};this.viewer&&this.viewer.doc&&(e.nbPages=this.viewer.doc.pageViews.length,e.width=Math.floor(this.viewer.doc.originalWidth),e.height=Math.floor(this.viewer.doc.originalHeight));return this.loader&&this.loader.statistics&&(e.DownloadSize=Math.floor(this.loader.statistics.DownloadSize/1e3)),!e.DownloadSize&&this.loadingAsset&&this.loadingAsset.size&&(e.DownloadSize=Math.floor(this.loadingAsset.size/1e3),e.DownloadSize=Math.floor(this.loader.statistics.DownloadSize/1e3)),e},onPreCreate:function(){if(this.onDocumentLoadingStarted=function(){this.onModelLoadingStarted()}.bind(this),this.onDocumentLoadingProgression=function(e){this.onModelLoadingProgression(e)}.bind(this),this.onDocumentLoadingCompleted=function(t){var n={doc:t,frmWindow:this.frmWindow};n=this.getExperienceModule()===v?e.extend(n,{pageGapNeeded:!1,showPageNumber:!1,loadWith100PercentScale:!0,useTapEvent:!1,loadwithBrowsergestures:!0,actionBarClosedOnLoad:!0,showScrollBar:!1}):this.getExperienceModule()===x?e.extend(n,{pageGapNeeded:!1,showPageNumber:!1,loadWith100PercentScale:!1,useTapEvent:!0,loadwithBrowsergestures:!1,showScrollBar:!1,initialState:"reframe",initialView:1,displayZoomPercent:!0,gestures:{mouseWheel:"mouseWheel_zoom",leftMouseDown:"leftMouseDown_pan"}}):this.getExperienceModule()===w?e.extend(n,{pageGapNeeded:!0,showPageNumber:!0,loadWith100PercentScale:!1,useTapEvent:!0,loadwithBrowsergestures:!1,actionBarClosedOnLoad:!1,showScrollBar:!0}):this.getExperienceModule()===P||this.getExperienceModule()===y?e.extend(n,{pageGapNeeded:!0,showPageNumber:!0,loadWith100PercentScale:!1,useTapEvent:!0,loadwithBrowsergestures:!1,actionBarClosedOnLoad:!1,showScrollBar:!0,initialView:2}):e.extend(n,{pageGapNeeded:!0,showPageNumber:!0,loadWith100PercentScale:!1,useTapEvent:!0,loadwithBrowsergestures:!1,actionBarClosedOnLoad:!1,showScrollBar:!0}),this.viewer=new i(n);var s=this.viewer;this.frmWindow.getViewer=function(){return s},this.assetLoaded=!0,this.setupCommands(),this.onModelLoadingCompleted()}.bind(this),this.onDocumentLoadingError=function(e){var t=this.ctx;e&&e.rsc&&e.type?s.nls(e.rsc,e.type,function(i){o.displayFatalError({ctx:t,msg:i,error:"DocumentLoadingFailed"},e)}):o.displayFatalError({ctx:t,msg:m.DocumentLoadingFailed,error:"DocumentLoadingFailed"},e)}.bind(this),!f.text.includes(this.args.input.asset.type)){this.tabletMabModel={speeddial:[{id:"Views",rsc:"3DPlay2DExperience/3DPlay2DExperience",toggle:[{id:"ScrollingView",rsc:"3DPlay2DExperience/3DPlay2DExperience"},{id:"SinglePageView",rsc:"3DPlay2DExperience/3DPlay2DExperience"}]},{id:"Previous",rsc:"3DPlay2DExperience/3DPlay2DExperience"},{id:"Next",rsc:"3DPlay2DExperience/3DPlay2DExperience"},{id:"AnnotationCommands2D",rsc:"3DPlay2DExperience/3DPlay2DExperience"},{id:"AnnotationCommands2DText",rsc:"3DPlay2DExperience/3DPlay2DExperience"},{id:"Share",icon:"3DPlay/assets/icons/32/I_3DSHAREShare.png",flyout:[]}],sections:[{id:"ToggleView",rsc:"3DPlay2DExperience/3DPlay2DExperience",nls:"3DPlay2DExperience/3DPlay2DExperience"},{id:"Search",rsc:"3DPlay2DExperience/3DPlay2DExperience",nls:"3DPlay2DExperience/3DPlay2DExperience"},{id:"AntiClockWise",rsc:"3DPlay2DExperience/3DPlay2DExperience",nls:"3DPlay2DExperience/3DPlay2DExperience"},{id:"AnnotationTour2D",rsc:"3DPlay2DExperience/3DPlay2DExperience",nls:"3DPlay2DExperience/3DPlay2DExperience",hideAB:!0,showBack:!0}]},this.mabModel={speeddial:[{id:"Views",rsc:"3DPlay2DExperience/3DPlay2DExperience",toggle:[{id:"ScrollingView",rsc:"3DPlay2DExperience/3DPlay2DExperience"},{id:"SinglePageView",rsc:"3DPlay2DExperience/3DPlay2DExperience"}]},{id:"AnnotationCommands2D",rsc:"3DPlay2DExperience/3DPlay2DExperience"},{id:"AnnotationCommands2DText",rsc:"3DPlay2DExperience/3DPlay2DExperience"},{id:"Share",icon:"3DPlay/assets/icons/32/I_3DSHAREShare.png",flyout:[]}],sections:[{id:"ToggleView",rsc:"3DPlay2DExperience/3DPlay2DExperience",nls:"3DPlay2DExperience/3DPlay2DExperience"},{id:"Search",rsc:"3DPlay2DExperience/3DPlay2DExperience",nls:"3DPlay2DExperience/3DPlay2DExperience"},{id:"AntiClockWise",rsc:"3DPlay2DExperience/3DPlay2DExperience",nls:"3DPlay2DExperience/3DPlay2DExperience"},{id:"Previous",rsc:"3DPlay2DExperience/3DPlay2DExperience",nls:"3DPlay2DExperience/3DPlay2DExperience"},{id:"Next",rsc:"3DPlay2DExperience/3DPlay2DExperience",nls:"3DPlay2DExperience/3DPlay2DExperience"},{id:"AnnotationTour2D",rsc:"3DPlay2DExperience/3DPlay2DExperience",nls:"3DPlay2DExperience/3DPlay2DExperience",hideAB:!0,showBack:!0}]},this.showDownloadCommand&&(this.mabModel.sections.unshift({id:"DownloadPDF",rsc:"3DPlay2DExperience/3DPlay2DExperience",nls:"3DPlay2DExperience/3DPlay2DExperience"}),this.tabletMabModel.speeddial.splice(3,0,{id:"DownloadPDF",rsc:"3DPlay2DExperience/3DPlay2DExperience"})),r.isSet("3DPlay.2D.EnablePresentationView")&&(this._iOS?u.is_iPhone||u.browser.browser.safariWithChrome||this.tabletMabModel.speeddial.push({id:"PresentationView",rsc:"3DPlay2DExperience/3DPlay2DExperience"}):(this.tabletMabModel.speeddial.push({id:"PresentationView",rsc:"3DPlay2DExperience/3DPlay2DExperience"}),this.mabModel.sections.push({id:"PresentationView",nls:"3DPlay2DExperience/3DPlay2DExperience",rsc:"3DPlay2DExperience/3DPlay2DExperience"}))),this.isMobile()?(this.tabletMabModel.sections.unshift({id:"FitDocument",nls:"3DPlay2DExperience/3DPlay2DExperience",rsc:"3DPlay2DExperience/3DPlay2DExperience"}),this.mabModel.sections.unshift({id:"FitDocument",nls:"3DPlay2DExperience/3DPlay2DExperience",rsc:"3DPlay2DExperience/3DPlay2DExperience"})):this.mabModel.sections.splice(1,0,{id:"Reframe",nls:"3DPlay2DExperience/3DPlay2DExperience",rsc:"3DPlay2DExperience/3DPlay2DExperience"},{id:"FitWidth",rsc:"3DPlay2DExperience/3DPlay2DExperience",nls:"3DPlay2DExperience/3DPlay2DExperience"},{id:"ScaleP",rsc:"3DPlay2DExperience/3DPlay2DExperience",nls:"3DPlay2DExperience/3DPlay2DExperience"},{id:"ScaleM",rsc:"3DPlay2DExperience/3DPlay2DExperience",nls:"3DPlay2DExperience/3DPlay2DExperience"}),d.is3DPlay()&&(this.mabModel.sections.push({id:"RightSidePanel",rsc:"PADUtils/PADUtils",nls:"PADUtils/PADUtils"}),this.tabletMabModel.sections.push({id:"RightSidePanel",rsc:"PADUtils/PADUtils",nls:"PADUtils/PADUtils"}));var t=this.tabletMabModel.speeddial.filter(function(e){return"Share"===e.id});(d.is3DSwym()||d.is3DDrive()||d.is3DSpace()||d.is3DPlay())&&d.isOnCloud()&&!1===this.share3DCommentHide&&(this.mabModel.speeddial[3].flyout.unshift({id:"Share3DComment",rsc:"3DPlay/3DPlay"}),t&&t[0].flyout.unshift({id:"Share3DComment",rsc:"3DPlay/3DPlay"})),this._iOS?(this.mabModel.speeddial[3].flyout.push({id:"ShareTo3DSwYm",rsc:"3DPlay/3DPlay"},{id:"SharePrint",rsc:"3DPlay/3DPlay"}),t&&t[0].flyout.push({id:"ShareTo3DSwYm",rsc:"3DPlay/3DPlay"},{id:"SharePrint",rsc:"3DPlay/3DPlay"})):(this.mabModel.speeddial[3].flyout.push({id:"ShareTo3DSwYm",rsc:"3DPlay/3DPlay"},{id:"ShareDownload",rsc:"3DPlay/3DPlay"},{id:"SharePrint",rsc:"3DPlay/3DPlay"}),t&&t[0].flyout.push({id:"ShareTo3DSwYm",rsc:"3DPlay/3DPlay"},{id:"ShareDownload",rsc:"3DPlay/3DPlay"},{id:"SharePrint",rsc:"3DPlay/3DPlay"}))}},onPostCreate:function(){var e=this.args,t=!1;(this.args.options.showBubbleMenu||r.isSet("3DPlay.ShowBubbleMenu"))&&(t=!0),this.PanelManager.createTopMenu({ctx:e.ctx,container:this.frmWindow.getUIFrame(),experience:this,showBubbleMenu:t}),this.PanelManager.createDefaultHelp(),this.annotationManager=c.get(this.args.ctx,"ANNOTATION_MANAGER"),this.annotationManager||(this.annotationManager=new l({frameWindow:this.frmWindow}),c.add(this.args.ctx,"ANNOTATION_MANAGER",this.annotationManager)),this.frmWindow.getActionBar().onActionBarReady(function(){this.actionBarLoaded=!0,this.setupCommands()}.bind(this)),this.EventDisposer.add(p.subscribe({event:"3DPLAY/FULLSCREEN/ENABLE"},function(e){this.viewer&&this.viewer.getContainer()&&this.viewer.getDocContainer().focus()}.bind(this))),this.EventDisposer.add(p.subscribe({event:"3DPLAY/WIDGETFOCUS/ENABLE"},function(e){this.viewer&&this.viewer.getContainer()&&this.viewer.getDocContainer().focus()}.bind(this)))},_loadAssets:function(e){this.loadAsset(e)},loadAsset:function(e){var t;e.asset&&e.asset.dataFormat&&e.asset.type&&"xcaddrawing"===e.asset.dataFormat&&"xcaddrawing"===e.asset.type&&(e.asset.dataFormat="svg",e.asset.type="svg"),this.assetType=e.asset.type;for(var i=Object.keys(f),n=0;n<i.length;n++)for(var s=i[n],o=f[s],a=0;a<o.length;a++)if(o[a]===this.assetType){t=D[s];break}var r={onLoadingStartCB:this.onDocumentLoadingStarted,onLoadingProgressCB:this.onDocumentLoadingProgression,onLoadingEndCB:this.onDocumentLoadingCompleted,onLoadingFailCB:this.onDocumentLoadingError};this.loader&&(this.loader.dispose(),this.loader=void 0),this.viewer&&(this.viewer.dispose(),this.viewer=void 0),require([t],function(t){this.loader=new t({events:r,isMobile:this.isMobile(),frameWindow:this.frmWindow}),this.loader.load({asset:e.asset})}.bind(this))},getScreenShot:function(e){return this.frmWindow.getViewer().getScreenShot(e)},isMobile:u.isMobile,search:function(e){var t=h.getCommands(this.ctx);t&&t.Search&&"PDF"===this.assetType.toUpperCase()&&this.viewer.startSearchCommand(e)},resetsearch:function(e){var t=h.getCommands(this.ctx);t&&t.Search&&"PDF"===this.assetType.toUpperCase()&&this.viewer.stopSearchCommand()},setupCommands:function(){if(this.actionBarLoaded&&this.assetLoaded&&this.viewer){var e=this.viewer.getNumberOfPages(),t=h.getCommands(this.ctx);t&&t.ZoomIn&&t.ZoomOut&&(t.ZoomIn.enable(),t.ZoomOut.enable()),t&&t.Next&&t.Previous&&(1===e?(t.Next.disable(),t.Previous.disable()):(t.Next.enable(),t.Previous.disable())),t&&t.ToggleView&&("PDF"!==this.assetType.toUpperCase()&&1===e?t.ToggleView.disable():t.ToggleView.enable()),t&&t.DownloadPDF&&("PDF"===this.assetType.toUpperCase()?t.DownloadPDF.enable():t.DownloadPDF.disable()),t&&t.Search&&("PDF"===this.assetType.toUpperCase()?t.Search.enable():t.Search.disable()),t&&t.Share3DComment&&(d.is3DSwym()||d.is3DDrive()||d.is3DSpace()||d.is3DPlay())&&d.isOnCloud()&&("PDF"===this.assetType.toUpperCase()?t.Share3DComment.enable():t.Share3DComment.disable()),g.pause(!0),t&&t.SinglePageView&&this.viewer&&1===this.viewer.currentView&&(t.SinglePageView.begin(),this.frmWindow.getActionBar().MAB.updateToggle("SinglePageView","3DPlay2DExperience/3DPlay2DExperience",!0)),t&&t.ScrollingView&&this.viewer&&2===this.viewer.currentView&&(t.ScrollingView.begin(),this.frmWindow.getActionBar().MAB.updateToggle("ScrollingView","3DPlay2DExperience/3DPlay2DExperience",!1)),g.pause(!1)}},dispose:function(){o.endAllCommands({ctx:this.ctx,resetDefaultCmd:!0}),this.viewer&&(this.viewer.dispose(),this.viewer=void 0),this.loader&&(this.loader.dispose(),this.loader=void 0),this.annotationManager&&(c.remove(this.args.ctx,"ANNOTATION_MANAGER"),this.annotationManager=void 0),this._parent()}})}),define("DS/3DPlay2DExperience/3DPlay2DExperiencePreview",["DS/3DPlay2DExperience/3DPlay2DExperience"],function(e){"use strict";return e.extend({init:function(e){this._parent(e),e.workbenchs=[],e.workbenchs.unshift({name:"3DPlay2DExperiencePreview",module:"3DPlay2DExperience"})},onPreCreate:function(){this._parent();var e=this;this.args.ui={keepActionbarClosed:!0,onActionBarReady:function(){e&&e.frmWindow&&(e.frmWindow.getActionBar().close(),e=void 0)}},this.mabModel={speeddial:[{id:"Reframe",rsc:"3DPlay2DExperience/3DPlay2DExperience"},{id:"Previous",rsc:"3DPlay2DExperience/3DPlay2DExperience"},{id:"Next",rsc:"3DPlay2DExperience/3DPlay2DExperience"}]}}})}),define("DS/3DPlay2DExperience/3DPlaySVGExperience",["DS/3DPlay2DExperience/3DPlay2DExperience","DS/WebSystem/Environment","DS/WebSystem/App"],function(e,t,i){"use strict";return e.extend({init:function(e){this._parent(e),e.workbenchs=[],t.isSet("3DPlay.Activate3DComment")&&e.workbenchs.push({name:"3DPlayComment",module:"3DPlay"}),e.workbenchs.unshift({name:"3DPlaySVGExperience",module:"3DPlay2DExperience"}),this._iOS?e.workbenchs.push({name:"3DPlayShare_iOS",module:"3DPlay"}):e.workbenchs.push({name:"3DPlayShare",module:"3DPlay"}),i.is3DPlay()&&e.workbenchs.push({name:"RightPanel",module:"3DPlay2DExperience"})},onPreCreate:function(){var e;(this._parent(),this.tabletMabModel={speeddial:[{id:"Reframe",rsc:"3DPlay2DExperience/3DPlay2DExperience"},{id:"Previous",rsc:"3DPlay2DExperience/3DPlay2DExperience"},{id:"Next",rsc:"3DPlay2DExperience/3DPlay2DExperience"},{id:"AnnotationCommands2D",rsc:"3DPlay2DExperience/3DPlay2DExperience"},{id:"AnnotationCommands2DText",rsc:"3DPlay2DExperience/3DPlay2DExperience"},{id:"Share",icon:"3DPlay/assets/icons/32/I_3DSHAREShare.png",flyout:[]}],sections:[{id:"FitWidth",rsc:"3DPlay2DExperience/3DPlay2DExperience",nls:"3DPlay2DExperience/3DPlay2DExperience"},{id:"ToggleView",rsc:"3DPlay2DExperience/3DPlay2DExperience",nls:"3DPlay2DExperience/3DPlay2DExperience"}]},this.mabModel={speeddial:[{id:"Reframe",rsc:"3DPlay2DExperience/3DPlay2DExperience"},{id:"AnnotationCommands2D",rsc:"3DPlay2DExperience/3DPlay2DExperience"},{id:"AnnotationCommands2DText",rsc:"3DPlay2DExperience/3DPlay2DExperience"},{id:"Share",icon:"3DPlay/assets/icons/32/I_3DSHAREShare.png",flyout:[]}],sections:[{id:"FitWidth",rsc:"3DPlay2DExperience/3DPlay2DExperience",nls:"3DPlay2DExperience/3DPlay2DExperience"},{id:"Previous",rsc:"3DPlay2DExperience/3DPlay2DExperience",nls:"3DPlay2DExperience/3DPlay2DExperience"},{id:"Next",rsc:"3DPlay2DExperience/3DPlay2DExperience",nls:"3DPlay2DExperience/3DPlay2DExperience"},{id:"ToggleView",rsc:"3DPlay2DExperience/3DPlay2DExperience",nls:"3DPlay2DExperience/3DPlay2DExperience"}]},this.isMobile()||this.mabModel.sections.unshift({id:"ScaleP",rsc:"3DPlay2DExperience/3DPlay2DExperience",nls:"3DPlay2DExperience/3DPlay2DExperience"},{id:"ScaleM",rsc:"3DPlay2DExperience/3DPlay2DExperience",nls:"3DPlay2DExperience/3DPlay2DExperience"}),i.is3DPlay()&&(this.tabletMabModel.sections.push({id:"RightSidePanel",rsc:"PADUtils/PADUtils",nls:"PADUtils/PADUtils"}),this.mabModel.sections.push({id:"RightSidePanel",rsc:"PADUtils/PADUtils",nls:"PADUtils/PADUtils"})),this._iOS)?((e=this.tabletMabModel.speeddial.filter(function(e){return"Share"===e.id}))&&(e[0].flyout=[{id:"ShareTo3DSwYm",rsc:"3DPlay/3DPlay"},{id:"SharePrint",rsc:"3DPlay/3DPlay"}]),this.mabModel.speeddial[3].flyout=[{id:"ShareTo3DSwYm",rsc:"3DPlay/3DPlay"},{id:"SharePrint",rsc:"3DPlay/3DPlay"}]):((e=this.tabletMabModel.speeddial.filter(function(e){return"Share"===e.id}))&&(e[0].flyout=[{id:"ShareTo3DSwYm",rsc:"3DPlay/3DPlay"},{id:"ShareDownload",rsc:"3DPlay/3DPlay"},{id:"SharePrint",rsc:"3DPlay/3DPlay"}]),this.mabModel.speeddial[3].flyout=[{id:"ShareTo3DSwYm",rsc:"3DPlay/3DPlay"},{id:"ShareDownload",rsc:"3DPlay/3DPlay"},{id:"SharePrint",rsc:"3DPlay/3DPlay"}])}})}),define("DS/3DPlay2DExperience/3DPlayTextExperiencePreview",["DS/3DPlay2DExperience/3DPlay2DExperience"],function(e){"use strict";return e.extend({init:function(e){this._parent(e),e.workbenchs=[],e.workbenchs.unshift({name:"3DPlayTextExperience",module:"3DPlay2DExperience"})},onPreCreate:function(){this._parent(),this.mabModel={speeddial:[{id:"ScaleP",rsc:"3DPlay2DExperience/3DPlay2DExperience",nls:"3DPlay2DExperience/3DPlay2DExperience"},{id:"ScaleM",rsc:"3DPlay2DExperience/3DPlay2DExperience",nls:"3DPlay2DExperience/3DPlay2DExperience"}]}},getScreenShot:function(e){return this.frmWindow.getViewer().getScreenShotForText(e)}})}),define("DS/3DPlay2DExperience/3DPlayImageExperience",["DS/3DPlay2DExperience/3DPlay2DExperience","DS/WebSystem/Environment","DS/WebSystem/App","DS/ApplicationFrame/ContextualUIManager"],function(e,t,i,n){"use strict";return e.extend({init:function(e){this._parent(e),e.workbenchs=[],t.isSet("3DPlay.Activate3DComment")&&e.workbenchs.push({name:"3DPlayComment",module:"3DPlay"}),e.workbenchs.unshift({name:"3DPlayImageExperience",module:"3DPlay2DExperience"}),(i.is3DSwym()||i.is3DDrive()||i.is3DSpace()||i.is3DPlay())&&i.isOnCloud()&&t.isSet("3DPlay.ActivateShareAsComment")?this._iOS?e.workbenchs.push({name:"3DPlayShareComment_iOS",module:"3DPlay"}):e.workbenchs.push({name:"3DPlayShareComment",module:"3DPlay"}):this._iOS?e.workbenchs.push({name:"3DPlayShare_iOS",module:"3DPlay"}):e.workbenchs.push({name:"3DPlayShare",module:"3DPlay"}),i.is3DPlay()&&e.workbenchs.push({name:"RightPanel",module:"3DPlay2DExperience"})},onPreCreate:function(){(this._parent(),this.tabletMabModel={speeddial:[{id:"Reframe",rsc:"3DPlay2DExperience/3DPlay2DExperience"},{id:"AnnotationCommands2D",rsc:"3DPlay2DExperience/3DPlay2DExperience"},{id:"AnnotationCommands2DText",rsc:"3DPlay2DExperience/3DPlay2DExperience"},{id:"AntiClockWise",rsc:"3DPlay2DExperience/3DPlay2DExperience"},{id:"Share",icon:"3DPlay/assets/icons/32/I_3DSHAREShare.png",flyout:[]},{id:"Ambiance",rsc:"3DPlay2DExperience/3DPlay2DExperience",flyout:[{id:"Visu2DWhiteCmd",rsc:"3DPlay2DExperience/3DPlay2DExperience"},{id:"Visu2DBlackCmd",rsc:"3DPlay2DExperience/3DPlay2DExperience"},{id:"Visu2DGreyCmd",rsc:"3DPlay2DExperience/3DPlay2DExperience"},{id:"Visu2DAutoCmd",rsc:"3DPlay2DExperience/3DPlay2DExperience"}]}],sections:[{id:"FullSize",rsc:"3DPlay2DExperience/3DPlay2DExperience",nls:"3DPlay2DExperience/3DPlay2DExperience"}]},this.mabModel={speeddial:[{id:"Reframe",rsc:"3DPlay2DExperience/3DPlay2DExperience"},{id:"AnnotationCommands2D",rsc:"3DPlay2DExperience/3DPlay2DExperience"},{id:"AnnotationCommands2DText",rsc:"3DPlay2DExperience/3DPlay2DExperience"},{id:"AntiClockWise",rsc:"3DPlay2DExperience/3DPlay2DExperience"},{id:"Share",icon:"3DPlay/assets/icons/32/I_3DSHAREShare.png",flyout:[]}],sections:[{id:"FullSize",rsc:"3DPlay2DExperience/3DPlay2DExperience",nls:"3DPlay2DExperience/3DPlay2DExperience"},{id:"Ambiance",nls:"3DPlay2DExperience/3DPlay2DExperience",rsc:"3DPlay2DExperience/3DPlay2DExperience",flyout:[{id:"Visu2DWhiteCmd",rsc:"3DPlay2DExperience/3DPlay2DExperience"},{id:"Visu2DBlackCmd",rsc:"3DPlay2DExperience/3DPlay2DExperience"},{id:"Visu2DGreyCmd",rsc:"3DPlay2DExperience/3DPlay2DExperience"},{id:"Visu2DAutoCmd",rsc:"3DPlay2DExperience/3DPlay2DExperience"}]}]},this.isMobile()||this.mabModel.sections.unshift({id:"ScaleP",rsc:"3DPlay2DExperience/3DPlay2DExperience",nls:"3DPlay2DExperience/3DPlay2DExperience"},{id:"ScaleM",rsc:"3DPlay2DExperience/3DPlay2DExperience",nls:"3DPlay2DExperience/3DPlay2DExperience"}),i.is3DPlay()&&(this.tabletMabModel.sections.push({id:"RightSidePanel",rsc:"PADUtils/PADUtils",nls:"PADUtils/PADUtils"}),this.mabModel.sections.push({id:"RightSidePanel",rsc:"PADUtils/PADUtils",nls:"PADUtils/PADUtils"})),this._iOS)?((e=this.tabletMabModel.speeddial.filter(function(e){return"Share"===e.id}))&&(e[0].flyout=[{id:"ShareTo3DSwYm",rsc:"3DPlay/3DPlay"},{id:"SharePrint",rsc:"3DPlay/3DPlay"}]),this.mabModel.speeddial[4].flyout=[{id:"ShareTo3DSwYm",rsc:"3DPlay/3DPlay"},{id:"SharePrint",rsc:"3DPlay/3DPlay"}]):((e=this.tabletMabModel.speeddial.filter(function(e){return"Share"===e.id}))&&(e[0].flyout=[{id:"ShareTo3DSwYm",rsc:"3DPlay/3DPlay"},{id:"ShareDownload",rsc:"3DPlay/3DPlay"},{id:"SharePrint",rsc:"3DPlay/3DPlay"}]),this.mabModel.speeddial[4].flyout=[{id:"ShareTo3DSwYm",rsc:"3DPlay/3DPlay"},{id:"ShareDownload",rsc:"3DPlay/3DPlay"},{id:"SharePrint",rsc:"3DPlay/3DPlay"}]);var e=this.tabletMabModel.speeddial.filter(function(e){return"Share"===e.id});(i.is3DSwym()||i.is3DDrive()||i.is3DSpace()||i.is3DPlay())&&i.isOnCloud()&&t.isSet("3DPlay.ActivateShareAsComment")&&(this.mabModel.speeddial[4].flyout.unshift({id:"Share3DComment",rsc:"3DPlay/3DPlay"}),e&&e[0].flyout.unshift({id:"Share3DComment",rsc:"3DPlay/3DPlay"}))},onPostCreate:function(){this._parent();var e=function(e,t){var i=[];return this.frmWindow.getViewer()&&!this.frmWindow.getViewer().getIfAnnotationRunning()&&i.push({name:"3DPlayAmbiencesSection",line:1,resourceFile:"3DPlay2DExperience/3DPlay2DExperience",hdr_list:["Visu2DWhiteCmd","Visu2DBlackCmd","Visu2DGreyCmd","Visu2DAutoCmd"]}),{cmdList:i}}.bind(this);this._contextualUIManager=new n({frameWindow:this.frmWindow}),this._contextualUIManager.register({workbenchName:"3DPlayImageExperience",module:"3DPlay2DExperience",cmdPrefix:"",merge:!0,subscriberId:"3DPlay2DContextualID",fileName:"3DPlayImageExperience.xml",onContextualMenuReady:e}),this.frmWindow.getContextualUIManager=function(){return this._contextualUIManager}.bind(this)},setupCommands:function(){},dispose:function(){this._contextualUIManager.unregister("3DPlay2DContextualID"),this._contextualUIManager.dispose(),this._parent()}})}),define("DS/3DPlay2DExperience/3DPlaySVGExperienceForDrawing",["DS/3DPlay2DExperience/3DPlay2DExperience","DS/WebSystem/Environment","DS/WebSystem/App"],function(e,t,i){"use strict";return e.extend({init:function(e){this._parent(e),e.workbenchs=[],t.isSet("3DPlay.Activate3DComment")&&e.workbenchs.push({name:"3DPlayComment",module:"3DPlay"}),e.workbenchs.unshift({name:"3DPlayDocumentViewerPrint",module:"3DPlay2DExperience"}),e.workbenchs.unshift({name:"3DPlaySVGExperience",module:"3DPlay2DExperience"}),this._iOS?e.workbenchs.push({name:"3DPlayShare_iOS",module:"3DPlay"}):e.workbenchs.push({name:"3DPlayShare",module:"3DPlay"}),i.is3DPlay()&&e.workbenchs.push({name:"RightPanel",module:"3DPlay2DExperience"})},onPreCreate:function(){var e;(this._parent(),this.tabletMabModel={speeddial:[{id:"Reframe",rsc:"3DPlay2DExperience/3DPlay2DExperience"},{id:"Previous",rsc:"3DPlay2DExperience/3DPlay2DExperience"},{id:"Next",rsc:"3DPlay2DExperience/3DPlay2DExperience"},{id:"AnnotationCommands2D",rsc:"3DPlay2DExperience/3DPlay2DExperience"},{id:"AnnotationCommands2DText",rsc:"3DPlay2DExperience/3DPlay2DExperience"},{id:"Share",icon:"3DPlay/assets/icons/32/I_3DSHAREShare.png",flyout:[]}],sections:[{id:"FitWidth",rsc:"3DPlay2DExperience/3DPlay2DExperience",nls:"3DPlay2DExperience/3DPlay2DExperience"},{id:"ToggleView",rsc:"3DPlay2DExperience/3DPlay2DExperience",nls:"3DPlay2DExperience/3DPlay2DExperience"},{id:"Print2DRealSize",rsc:"3DPlay2DExperience/3DPlay2DExperience",nls:"3DPlay2DExperience/3DPlay2DExperience"}]},this.mabModel={speeddial:[{id:"AnnotationCommands2D",rsc:"3DPlay2DExperience/3DPlay2DExperience"},{id:"AnnotationCommands2DText",rsc:"3DPlay2DExperience/3DPlay2DExperience"},{id:"Reframe",rsc:"3DPlay2DExperience/3DPlay2DExperience"},{id:"Share",icon:"3DPlay/assets/icons/32/I_3DSHAREShare.png",flyout:[]}],sections:[{id:"FitWidth",rsc:"3DPlay2DExperience/3DPlay2DExperience",nls:"3DPlay2DExperience/3DPlay2DExperience"},{id:"Previous",rsc:"3DPlay2DExperience/3DPlay2DExperience",nls:"3DPlay2DExperience/3DPlay2DExperience"},{id:"Next",rsc:"3DPlay2DExperience/3DPlay2DExperience",nls:"3DPlay2DExperience/3DPlay2DExperience"},{id:"ToggleView",rsc:"3DPlay2DExperience/3DPlay2DExperience",nls:"3DPlay2DExperience/3DPlay2DExperience"},{id:"Print2DRealSize",rsc:"3DPlay2DExperience/3DPlay2DExperience",nls:"3DPlay2DExperience/3DPlay2DExperience"}]},this.isMobile()||this.mabModel.sections.unshift({id:"ScaleP",rsc:"3DPlay2DExperience/3DPlay2DExperience",nls:"3DPlay2DExperience/3DPlay2DExperience"},{id:"ScaleM",rsc:"3DPlay2DExperience/3DPlay2DExperience",nls:"3DPlay2DExperience/3DPlay2DExperience"}),i.is3DPlay()&&(this.tabletMabModel.sections.push({id:"RightSidePanel",rsc:"PADUtils/PADUtils",nls:"PADUtils/PADUtils"}),this.mabModel.sections.push({id:"RightSidePanel",rsc:"PADUtils/PADUtils",nls:"PADUtils/PADUtils"})),this._iOS)?((e=this.tabletMabModel.speeddial.filter(function(e){return"Share"===e.id}))&&(e[0].flyout=[{id:"ShareTo3DSwYm",rsc:"3DPlay/3DPlay"},{id:"SharePrint",rsc:"3DPlay/3DPlay"}]),this.mabModel.speeddial[3].flyout=[{id:"ShareTo3DSwYm",rsc:"3DPlay/3DPlay"},{id:"SharePrint",rsc:"3DPlay/3DPlay"}]):((e=this.tabletMabModel.speeddial.filter(function(e){return"Share"===e.id}))&&(e[0].flyout=[{id:"ShareTo3DSwYm",rsc:"3DPlay/3DPlay"},{id:"ShareDownload",rsc:"3DPlay/3DPlay"},{id:"SharePrint",rsc:"3DPlay/3DPlay"}]),this.mabModel.speeddial[3].flyout=[{id:"ShareTo3DSwYm",rsc:"3DPlay/3DPlay"},{id:"ShareDownload",rsc:"3DPlay/3DPlay"},{id:"SharePrint",rsc:"3DPlay/3DPlay"}])},getSource:function(){if(this.frmWindow&&this.frmWindow.experience&&this.frmWindow.experience.loadAssetInfo&&this.frmWindow.experience.loadAssetInfo.data)return this.frmWindow.experience.loadAssetInfo.data},getCurrentSheetIndex:function(){if(this.frmWindow&&this.frmWindow.getViewer&&this.frmWindow.getViewer().getCurrentPage&&null!=this.frmWindow.getViewer().getCurrentPage().index)return this.frmWindow.getViewer().getCurrentPage().index},getNumberOfSheets:function(){if(this.frmWindow&&this.frmWindow.getViewer&&this.frmWindow.getViewer().getAllPages&&null!=this.frmWindow.getViewer().getAllPages().length)return this.frmWindow.getViewer().getAllPages().length}})}),define("DS/3DPlay2DExperience/3DPlayTextExperience",["DS/3DPlay2DExperience/3DPlay2DExperience","DS/WebSystem/Environment","DS/WebSystem/App"],function(e,t,i){"use strict";return e.extend({init:function(e){this._parent(e),e.workbenchs=[],t.isSet("3DPlay.Activate3DComment")&&e.workbenchs.push({name:"3DPlayComment",module:"3DPlay"}),e.workbenchs.unshift({name:"3DPlayTextExperience",module:"3DPlay2DExperience"}),this._iOS?e.workbenchs.push({name:"3DPlayShare_iOS",module:"3DPlay"}):e.workbenchs.push({name:"3DPlayShare",module:"3DPlay"}),t.isSet("3DPlay.Text.Highlight")&&e.workbenchs.push({name:"TextHighlight",module:"3DPlay2DExperience"}),i.is3DPlay()&&e.workbenchs.push({name:"RightPanel",module:"3DPlay2DExperience"})},onPreCreate:function(){this._parent(),this.mabModel={monoCmd:{id:"ShareTo3DSwYm",rsc:"3DPlay/3DPlay"}}},getScreenShot:function(e){return this.frmWindow.getViewer().getScreenShotForText(e)}})});