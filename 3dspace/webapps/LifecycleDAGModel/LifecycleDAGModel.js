define("DS/LifecycleDAGModel/DAGNodeModelBase",["UWA/Core","DS/Tree/TreeNodeModel"],function(e,t){"use strict";var r=function(e){this.options=e||{isEmpty:!0},t.call(this,this.options)};return(r.prototype=Object.create(t.prototype)).constructor=r,r.prototype.isEmpty=function(){return!0===this.options.isEmpty},r.prototype.clone=function(){throw Error("DAGNodeModelBase.clone: Function must be overriden in derived class")},r.prototype.sortFunction=function(e,t){throw Error("DAGNodeModelBase.sortFunction: Function must be overriden in derived class")},r.prototype.getLastLeaf=function(){for(var e=this;e.hasChildren();e=e.getLastChild());return e},r.prototype.remove=function(){this.options.isRemoved=!0,t.prototype.remove.call(this)},r.prototype.hasBeenRemoved=function(){return!0===this.options.isRemoved},r.prototype.getBreadth=function(){for(var e=this._localID,t=this._parentNode;t&&!t._isTrueRoot();)e+=(t=t._parentNode)._localID;return e},r}),define("DS/LifecycleDAGModel/DAGBranch",[],function(){"use strict";var e=function(e){this.data=e||{},this.nodeList=[]};return e.prototype.addNode=function(e,t){1==t&&e.__BRANCH__&&e.__BRANCH__.removeNode(e),this.nodeList.indexOf(e)<0&&this.nodeList.push(e),e.__BRANCH__=this},e.prototype.removeNode=function(e){this.nodeList.splice(this.nodeList.indexOf(e),1),e.__BRANCH__=void 0},e.prototype.getNodes=function(){return this.nodeList},e}),define("DS/LifecycleDAGModel/DAGMergeHiddenNode",["DS/LifecycleDAGModel/DAGNodeModelBase","UWA/Core"],function(e,t){"use strict";var r=function(t,r){this.options={parentBranch:t,mergeLeft:r},e.call(this,this.options)};return(r.prototype=Object.create(e.prototype)).constructor=r,r}),define("DS/LifecycleDAGModel/DAGDocumentModel",["DS/Tree/TreeDocument","DS/Tree/TreeNodeModel","DS/LifecycleDAGModel/DAGBranch","DS/LifecycleDAGUtils/ArrayFunctions","DS/LifecycleDAGModel/DAGNodeModelBase","DS/LifecycleDAGModel/DAGMergeHiddenNode"],function(e,t,r,n,i,o){return e.extend({_ID_COUNTER:-1,init:function(e){e=e||{},this._mergeConnections=[],this._branchArray=[],this._nodeGroups=[],this._nodeList=[],this._nodeHash={},this._isLoaded=!1,this._parent(e),this.persistentColor=!1,this._FILTER_ENABLED=!1,this._SELECTION_MODE=void 0,this.prepareAddDeleteCount=0,this._mapColorArray=new n.MapArray(Array.isArray(e.branchColors)&&e.branchColors.length?e.branchColors:["#FEE000","#009DDB","#FF8A2E","#9B2C98","#00AA86","#F564A3","#8DDEE4","#CC092F","#E2D5CC","#6FBC4B","#70036b","#002596","#C6C68B","#7F7F7F","#4EA8B7","#007A4C","#ADADAD","#127277","#6D2815","#000000","#4D62BA"]),this._circularColorArray=new n.CircularArray(Array.isArray(e.branchColors)&&e.branchColors.length?e.branchColors:["#FEE000","#009DDB","#FF8A2E","#9B2C98","#00AA86","#F564A3","#8DDEE4","#CC092F","#E2D5CC","#6FBC4B","#70036b","#002596","#C6C68B","#7F7F7F","#4EA8B7","#007A4C","#ADADAD","#127277","#6D2815","#000000","#4D62BA"])},getNumberOfNodes:function(){return this._nodeList.length?this._nodeList.length:this._numberOfNodesInDocument},isLoaded:function(){return this._isLoaded},getNodeByID:function(e){var t=this._nodeHash[e];return void 0===t?void 0:t.node},getNodeIndexByID(e){var t=this._nodeHash[e];return void 0===t?-1:t.index},getNodeIndex(e){return void 0===e||e._getID()<0?-1:this.getNodeIndexByID(e._getID())},resetNodeHash(e){var t=0;void 0===e||e<0?this._nodeHash={}:t=e;for(var r=t;r<this._nodeList.length;r++){var n=this._nodeList[r];this._nodeHash[n._getID()]={node:n,index:r}}},searchByID:function(e){var t=[],r=this.getNodeByID(e);return void 0!==r&&t.push(r),t},searchByAttribute:function(e,t,r){var n=[],i=Array.isArray(r)&&r.length?r:this._nodeList;return i.length&&(n=i.filter(function(r){return r.options.grid[e]===t})),n},isNodeInModel:function(){var e;return 1===arguments.length?e=this.searchByID(arguments[0]):2===arguments.length&&(e=this.searchByAttribute(arguments[0],arguments[1])),e&&e.length>0},setAttribute:function(e,r,n,i){if(null==e||"string"!=typeof r||!r.length||null==n)throw Error("DAGDocumentModel.setAttribute: attribute, value and nodes cannot be null");if("string"==typeof e&&e.length){var o=this.searchByID(e);1===o.length&&(o[0].options.grid[r]!==n||!0===i)&&o[0].setAttribute(r,n)}else if(e instanceof t)(e.options.grid[r]!==n||!0===i)&&e.setAttribute(r,n);else if(Array.isArray(e))for(var s=this._nodeList.length,d=0;d<s;d++){var a=this._nodeList[d];e.findIndex(function(e){var r;return"string"==typeof e&&e.length?r=e:e instanceof t&&(r=e._getID()),r===a._getID()})>=0&&(a.options.grid[r]!==n||!0===i)&&a.setAttribute(r,n)}},setAttributeAll:function(e,t,r){if("string"!=typeof e||!e.length||null==t)throw Error("VersionTreeDocumentModel.setAttributeAll attribute and value");for(var n=this._nodeList.length,i=0;i<n;i++)this._nodeList[i].options.grid[e]===t&&!0!==r||this._nodeList[i].setAttribute(e,t)},empty:function(){try{this._parent()}catch(e){}this._nodeList=[],this._nodeHash={},this._mergeConnections=[],this._branchArray=[],this._nodeGroups=[],this._isLoaded=!1,!0!==this.usePersistentColor()&&this._circularColorArray.resetCurrentIndex()},usePersistentColor:function(){return!1},addBranch:function(e,t,r){if("number"==typeof t?n.insert.call(this._branchArray,e,t):this._branchArray.push(e),!r){r=!0===this.usePersistentColor()?this._mapColorArray.mapToValue(e.data.physicalid).value:this._circularColorArray.next().value;for(var i=this.getAllBranches().length>0?this.getBranch(this.getBranchID(e)-1):void 0,o=this.getBranchID(e)<this.getAllBranches().length-1?this.getBranch(this.getBranchID(e)+1):void 0,s=1;i&&r===i.data.color||o&&r===o.data.color;)r=!0===this.usePersistentColor()?this._mapColorArray.mapToValue(e.data.physicalid+s++).value:this._circularColorArray.next().value}e.data.color=r},removeBranch:function(e){if(e instanceof r){var t=this._branchArray.indexOf(e);t>=0&&this._branchArray.splice(t,1),!0!==this.usePersistentColor()&&0===t&&this._circularColorArray.resetCurrentIndex()}},getBranchID:function(e){return this._branchArray.indexOf(e)},getBranch:function(e){return this._branchArray[e]},getAllBranches:function(){return this._branchArray},addChildNode:function(e,s,d,a,h,_){if(!(e instanceof t))throw Error("VersionTreeDocumentModel.addChild: Child cannot be null");if(e._id=++this._ID_COUNTER,!a&&this.getNodeIndex(e)<0)if(_){var c=this._nodeList.push(e)-1;this.resetNodeHash(c)}else n.orderedInsert.call(this._nodeList,e,this.getNodeIndex(d),this.getNodeIndex(e),e.sortFunction),this.resetNodeHash();var l,u=(d=d instanceof t?d:this._getTrueRoot()).getChildren(),p=d.getNumberOfChildren();if(!p&&s>0&&(this.addChildNode(new i,0,d,!0),p=d.getNumberOfChildren()),0===(s="number"==typeof s&&s>=0&&s<=p?s:p)){if(d._isTrueRoot()?(l=h||new r({physicalid:e.options.id?e.options.id:d.options.id}),-1===this.getBranchID(l)&&this.addBranch(l,0)):l=l||d.__BRANCH__,l.getNodes().length&&p){var f=u[0];if(l.nodeList.indexOf(f)>=0&&!f.isEmpty()){var g={physicalid:f.options.id?f.options.id:l.data.physicalid},A=h||new r(g);-1===this.getBranchID(l)&&this.addBranch(A,1),f.__BRANCH__.removeNode(f),A.addNode(f),f.__BRANCH__=A,f.processDescendants({async:!0,onlyVisibleNodes:!0,processNode:function(e){var t=e.nodeModel;t._isTrueRoot()||t.__BRANCH__===l&&(t.__BRANCH__.removeNode(t),A.addNode(t),t.__BRANCH__=A)}})}}}else{var C,N=void 0;if(1===e.options.grid.minororder&&e.options.grid.secondaries||e.options.grid.isFirstMinor?N=d.__BRANCH__.data.color:e.options.grid.minororder>1&&(h=h||d.__BRANCH__),l=h||new r({physicalid:e.options.id?e.options.id:d.options.id}),d._isTrueRoot()){var D=e.getNextBrother();position=D&&D.__BRANCH__?this.getBranchID(D.__BRANCH__):void 0}else if(e instanceof o==!0){C=(B=this._getLastMergeBranchHiddenChildNode(d,e.mergeLeft))?this.getBranchID(B.__BRANCH__):this.getBranchID(d.__BRANCH__),s=this._getNextIntermediateMergeNodePosition(d)}else{var B,v=(B=this._getLastMergeBranchHiddenChildNode(d))?this.getBranchID(B.__BRANCH__):this.getBranchID(d.__BRANCH__);v>(C=this.getBranchID(d.getLastLeaf().__BRANCH__))&&(C=v)}-1===this.getBranchID(l)&&this.addBranch(l,"number"==typeof C?C+1:void 0,N)}p&&0===s&&u[0].isEmpty()&&this.removeChildNode(u[0]),l.addNode(e),d.addChild(e,s),!d._isTrueRoot()&&d.expand();var y=d.hasChildren();d.options.grid.__isLeaf__=!y||y&&d.getNthChild(0).isEmpty()},removeChildNode:function(e){if(!(e instanceof t))throw Error("VersionTreeDocumentModel.removeChildNode: Child cannot be null");var r,n=e.getParent(),i=n.getChildren(),o=this;if(e.isEmpty())e.__BRANCH__.removeNode(e);else{if(i.length>1&&0===i.indexOf(e)&&!n._isTrueRoot()){for(var s=i[1].__BRANCH__,d=s.nodeList.length-1;d>=0;d--){var a=s.nodeList[d];a.__BRANCH__.removeNode(a),n.__BRANCH__.addNode(a)}this.removeBranch(s)}(r=e.__BRANCH__).removeNode(e),0===r.nodeList.length&&o.removeBranch(r),e.processDescendants({async:!0,onlyVisibleNodes:!0,processNode:function(e){var t=e.nodeModel;if(!t._isTrueRoot()){(r=t.__BRANCH__)&&(r.removeNode(t),0===r.nodeList.length&&o.removeBranch(r));var n=o.getNodeIndex(t);n>0&&(o._nodeList.splice(o.getNodeIndex(t),1),o.resetNodeHash(n)),delete o._nodeHash[t._getID()];for(var i=o._mergeConnections.filter(function(e){return e.parent===t||e.child===t}),s=0,d=i.length;s<d;s++)o.removeMerge(i[s].parent,i[s].child,!0)}}});var h=this.getNodeIndex(e);h>=0&&(this._nodeList.splice(this.getNodeIndex(e),1),this.resetNodeHash(h)),delete this._nodeHash[e._getID()]}e.remove();var _=n.hasChildren();n.options.grid.__isLeaf__=!_||_&&n.getNthChild(0).isEmpty()},getNodeDescendantBranches:function(e){var t=[];return e.processDescendants({async:!1,onlyVisibleNodes:!0,processNode:function(e){var r=e.nodeModel;r._isTrueRoot()||t.indexOf(r.__BRANCH__)<0&&t.push(r.__BRANCH__)}}),t},applyFilter:function(e){var t=[];if(Array.isArray(e)&&e.length)t=this._nodeList,e.forEach(function(e){t=this.searchByAttribute(e.key,e.value,t)},this);else{if("function"!=typeof e)throw Error("invalid arguments for filter");for(var r=arguments[0],n=0,i=this._nodeList.length;n<i;n++){var o=this._nodeList[n];r(o,n)&&t.push(o)}}return t.length&&(this.prepareUpdate(),this.setAttributeAll("__filter__",!1),this.setAttribute(t,"__filter__",!0),this.pushUpdate()),t},clearFilter:function(){this.prepareUpdate(),this.setAttributeAll("__filter__",!1),this.pushUpdate()},prepareAddDelete:function(){this.prepareAddDeleteCount||(this.prepareUpdate(),this._trueRoot._modelEvents.publish({event:"prepareAddDelete",data:this._trueRoot._getNodeInfos(),context:this})),this.prepareAddDeleteCount+=1},pushAddDelete:function(){if(null==this.prepareAddDeleteCount)throw Error("VersionTreeDocumentModel:pushAddDelete called without prepareAddDelete");this.prepareAddDeleteCount-=1,this.prepareAddDeleteCount<=0&&(this._updateMerges(),this.pushUpdate(),this._trueRoot._modelEvents.publish({event:"pushAddDelete",data:this._trueRoot._getNodeInfos(),context:this}),prepareAddDeleteCount=0)},cancelAddDelete:function(){null!=this.prepareAddDeleteCount&&(this.prepareAddDeleteCount=this.prepareAddDeleteCount>0?this.prepareAddDeleteCount-1:0),this._trueRoot._modelEvents.publish({event:"cancelAddDelete",data:this._trueRoot._getNodeInfos(),context:this})},addMerge:function(e,r,n){if(!(r instanceof t)&&"string"!=typeof e)throw Error("VersionTreeDocumentModel.addMergeConnection : either child or parent are not in the correct format");if(!this._mergeConnections.length||this._mergeConnections.length&&!this._mergeConnections.find(function(t){return t.child===r&&t.parent===e})){this.getNodeByID[r._getID()];var i=this.getNodeByID[e];void 0===i&&(i=e);var o=UWA.extend({parent:i,child:r},n||{});this._mergeConnections.push(o),o.child instanceof t&&o.parent instanceof t&&("function"==typeof o.child.addMergeParent&&o.child.addMergeParent(o.parent),"function"==typeof o.parent.addMergeChild&&o.parent.addMergeChild(o.child),o.parent.setAttribute("__isLeaf__",!1),this._trueRoot._modelEvents.publish({event:"addMerge",data:o}))}},removeMerge:function(e,r,n){var i,o=this._mergeConnections.findIndex(function(n,i,o){return(e instanceof t?e._getID():e)===(n.parent instanceof t?n.parent._getID():n.parent)&&n.child===r});if(o>=0){if(i=this._mergeConnections.splice(o,1)[0],Array.isArray(r.options.ancestors)){var s=r.options.ancestors.findIndex(function(r){return"I"===r.semantic&&("string"==typeof e&&r.id===e||e instanceof t&&r.id===e._getID())});s>=0&&r.options.ancestors.splice(s,1)}i.mergeHiddenNode&&this.removeChildNode(i.mergeHiddenNode),i.parent.setAttribute("__isLeaf__",!0),this._trueRoot._modelEvents.publish({event:"removeMerge",data:i})}},_updateMerges:function(){for(var e=this._isODT,n=[],i=this,s=0,d=this._mergeConnections.length;s<d;s++){var a=this._mergeConnections[s],h=a.parent;a.child;if("string"==typeof h&&(h=this.searchByID(h),Array.isArray(h)&&1===h.length)&&(a.parent=h[0],a.child instanceof t&&a.parent instanceof t&&("function"==typeof a.child.addMergeParent&&a.child.addMergeParent(a.parent),"function"==typeof a.parent.addMergeChild&&a.parent.addMergeChild(a.child),a.parent.setAttribute("__isLeaf__",!1),this._trueRoot._modelEvents.publish({event:"addMerge",data:a}))),e&&a.parent.hasChildren()&&!a.parent.getChildren()[0].isEmpty()&&this.getNodeIndex(a.child)>this.getNodeIndex(a.parent.getChildren()[0])&&!a.mergeBetweenRoots&&!a.mergeHiddenNode){var _,c,l=new o(a.parent.__BRANCH__,a.mergeLeft),u=a.parent.getChildren().filter(function(e){return e instanceof o});if(!0===a.mergeLeft&&a.referenceBranch){var p=i.getBranchID(a.referenceBranch);(_=(c=u.length?u.find(function(e){return i.getBranchID(e.__BRANCH__)<p}):null)?c.__BRANCH__:null)||(_=new r),this.addBranch(_,p)}else _=(c=u.length?u.find(function(e){return i.getBranchID(e.__BRANCH__)>i.getBranchID(a.parent.__BRANCH__)}):null)?c.__BRANCH__:null;this.addChildNode(l,null,h,!0,_),a.mergeHiddenNode=l,l.__BRANCH__.data.color=a.parent.__BRANCH__.data.color}else a.mergeHiddenNode&&a.parent.getChildren()[0].isEmpty()&&n.push(a)}n.forEach(function(e){this.removeMerge(e.parent,e.child),this.addMerge(e.parent,e.child)},this)},_getLastMergeBranchHiddenChildNode:function(e,t){var r=this,n=this._mergeConnections.filter(function(r){return r.mergeHiddenNode&&r.mergeHiddenNode.options.parentBranch===e.__BRANCH__&&r.mergeLeft===t});return n.length?n.length>1?n.sort(function(e,t){return r.getBranchID(t.mergeHiddenNode.__BRANCH__)-r.getBranchID(e.mergeHiddenNode.__BRANCH__)})[0].mergeHiddenNode:n[0].mergeHiddenNode:void 0},_getNextIntermediateMergeNodePosition:function(e){var t=0;if(e.hasChildren()){var r=e.getChildren(),n=r.length;for(t=0;t<n&&r[t]instanceof o;t++);}return t+1}})});