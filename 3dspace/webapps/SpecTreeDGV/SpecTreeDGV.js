define("DS/SpecTreeDGV/SpecTreeViewTreeNodeCell",["UWA/Core","DS/Core/Core","DS/DataGridView/DataGridViewTreeNodeCell","DS/Core/PointerEvents","DS/Utilities/Dom"],function(e,t,o,i,n){"use strict";return o.inherit({name:"SpecTreeViewTreeNodeCell",publishedProperties:{},buildView:function(){this._parent(),this._manageHoverBarButton()},__buildIcon:function(e,t){var o=this._parent(e,t);return o.classList.add("wux-layouts-spectreeview-icon"),o},_applyNodeModel:function(e){this._parent(e),this._manageHoverBarButton()},_manageHoverBarButton:function(){var t=!1,o=this.nodeModel;if(o){var i=o.getTreeDocument();if(i){var l=o._getNodeCategory(),r=o._getNodeType(),a=i.getVault().getRegisteredNodeType(l,r);if(a&&a.buildHoverBar){var s=[],d=a.buildHoverBar({nodeModel:o,hoverBarModel:e.clone(s)});if(Array.isArray(d)&&d.length||Array.isArray(s)&&s.length){if(this.elements.hoverBarDotMenu)this.elements.hoverBarDotMenu.inject(this.elements.container);else{this.elements.hoverBarDotMenu=new e.Element("div",{class:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-menu-dot wux-spectree-hoverbar-button"}).inject(this.elements.container);var c=this;n.addEventOnElement(this,this.elements.hoverBarDotMenu,"click",function(e){e.stopPropagation(),c.fire("hoverBarDotMenuClick")})}t=!0}}}}!t&&this.elements.hoverBarDotMenu&&this.elements.hoverBarDotMenu.remove()},getInitialClassName:function(){return this._parent()+" wux-spectreeview-tree-node-cell"}})}),define("DS/SpecTreeDGV/SpecTreeViewDGV",["DS/Controls/Abstract","DS/DataGridView/DataGridView","DS/SpecTreeDGV/SpecTreeViewTreeNodeCell","DS/SpecTree/SpecTreeDocument","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/TreeModel/ModelUtils","DS/SpecTree/SpecTreeFilter","DS/Controls/Toolbar","DS/Core/PointerEvents","DS/Controls/Button","DS/Controls/TooltipModel","DS/Utilities/Dom","DS/Utilities/Utils","DS/Utilities/TouchUtils","text!DS/SpecTreeDGV/assets/specTree_TypeRepresentations.json","i18n!DS/SpecTree/assets/nls/view.json"],function(e,t,o,i,n,l,r,a,s,d,c,u,h,g,p,v,_){"use strict";var f={TREE:{dataIndex:"tree",alwaysVisibleFlag:!0,typeRepresentation:"string",sortableFlag:!1,editableFlag:!0,editionPolicy:"DelayedEditionOnClick",getCellAttributes:function(e){var t=e.nodeModel,o={};if(t){var i=t.getTreeDocument();t.isVisibleInSpecTree()||(o["node-is-hidden"]=!0),o["node-category"]=t._getNodeCategory(),o["node-type"]=t._getNodeType(),t.isUIActive()&&(o["node-is-uiactive"]=!0),this.getTreeDocument()._inWorkNode===t&&(o["node-is-inwork"]=!0,o["node-is-inwork-path"]=!0),t._getIsActivePath()&&(o["node-is-inwork-path"]=!0),i&&i._isInSecondaryActiveContainerPath(t)&&(o["node-is-secondary-active-container-path"]=!0),t._isAfterRollbackCursor()&&(o["node-is-after-rollback-cursor"]=!0),t.getInactiveState()&&(o.inactiveState=t.getInactiveState())}return o},setCellValue:function(e,t){var o=e.nodeModel,i=o.options.label;if(void 0===t||""===t)return{updateCellView:!0};o.prepareUpdate(),o.updateOptions({label:t,grid:{tree:t}}),!1===o._getResolvedAndCall("onEditLabel",function(e){})&&o.updateOptions({label:i,grid:{tree:i}}),o.pushUpdate()},getCellIcons:function(e){var t=[];if(e.nodeModel&&e.nodeModel.getIcons&&Array.prototype.push.apply(t,e.nodeModel.getIcons()),!e.cellView.collectionView._hasNotificationIconColumn&&e.nodeModel){const n=e.nodeModel.getTreeDocument();if(n){var o=n.getVault().getNotificationInfos(e.nodeModel.getNotification());if(o.icon){var i=m(e);i&&(o.icon.tooltipInfos=new u(i)),t.push(o.icon)}}}return t},getCellTypeRepresentation:function(e){return e.nodeModel&&e.nodeModel._isLayoutNode("layout-horizontal")?"parentTreeNodeModel":"string"},getCellValue:function(e){if(e.nodeModel)return e.nodeModel._isLayoutNode("layout-horizontal")?e.nodeModel:this.isCellInEdition(e.cellID)?e.nodeModel.getEditableLabel():e.nodeModel.getLabel()}},NOTIFICATION_ICON:{dataIndex:"notification_icon",editableFlag:!1,minWidth:20,width:20,typeRepresentation:"icon",alignment:"center",getCellValue:function(e){if(e.nodeModel)return e.nodeModel.getTreeDocument().getVault().getNotificationInfos(e.nodeModel.getNotification()).icon},getCellTooltip:function(e){return m(e)},getCellValueForCopy:function(){}},HIDE_SHOW:{dataIndex:"visibility",typeRepresentation:p.getTouchMode()?"visibilitySpecTreeTouch":"visibilitySpecTree",editionPolicy:p.getTouchMode()?"EditionInPlace":"EditionOnOver",width:26,minWidth:26,editableFlag:!0,selectableFlag:!1,alignment:"center",getCellValue:function(e){if(e.nodeModel&&b(e.nodeModel))return e.nodeModel.isVisibleInSpecTree()},getCellSelectableState:function(e){return!1},getCellActivableState:function(e){return!1},getCellTooltip:function(){},getCellEditableState:function(e){return!(!e.nodeModel||!b(e.nodeModel))},setCellValue:function(e,t){var o=e.nodeModel;if(!o||!b(o))return{updateCellView:!0};var i=t?"onShow":"onHide";if(o.setVisibilityInSpecTree(t),o._isLayoutNode())for(var n=o.getChildren(),l=0;Array.isArray(n)&&l<n.length;l++)n[l].setVisibilityInSpecTree(t),n[l]._getResolvedAndCall(i);o._getResolvedAndCall(i)},getCellValueForCopy:function(){}}};function w(e,t){var o=(t=t||e.target||e.srcElement).getBoundingClientRect();return{offsetX:e.clientX?e.clientX-o.left:0,offsetY:e.clientY?e.clientY-o.top:0}}var m=function(e){var t=_[e.nodeModel.getNotification()],o=e.nodeModel.getNotificationMsg();if(void 0!==t||void 0!==o)return{title:t,shortHelp:o}},b=function(e){var t=!1;if(e)if(e._getResolved().onShow&&e._getResolved().onHide)t=!0;else if(e._isLayoutNode()){for(var o=0,i=e.getChildren(),n=0;Array.isArray(i)&&n<i.length;n++)i[n]._getResolved("onShow")&&i[n]._getResolved("onHide")&&o++;Array.isArray(i)&&o===i.length&&(t=!0)}return t},C=function(e){if(e.__specTreeNodeDepth)return e.__specTreeNodeDepth;if(e.getParent()){var t=C(e.getParent());return e.hasNoRepresentation()?t:t+1}return e._isTrueRoot()?-1:void 0},D=e.inherit({_dataGridView:void 0,publishedProperties:{columns:{defaultValue:[],type:"array"},findWidget:{defaultValue:void 0,type:"object"},readOnly:{defaultValue:!1,type:"boolean"}},_preBuildView:function(e){this._dataGridView=new t({cellSelection:"none",columns:this._formatColumns(e.columns),cellActivationFeedback:"row",showEditableFeedbackFlag:!1,showAlternateBackgroundFlag:!1,showBackgroundFlag:!1,showColumnBorderFlag:!0,editOnKeyPressFlag:!1,layoutOptions:{rowsHeader:!1,columnsHeader:!1,cellHeight:26},selectionBehavior:{toggle:!1,unselectAllOnEmptyArea:!0,unselectAllOnEscapeKey:!0,selectNodeModelOnCellSelection:!0,selectOnContextualEvent:!1},treeNodeCellOptions:{expanderStyle:"triangle",buildLinks:!1,depthIncrement:20,getNodeDepth:C,cellClass:o},showScrollbarsOnHover:!0,cellDragEnabledFlag:!0,rowDragEnabledFlag:!0,rowReorderEnabledFlag:!0,findNavigationMode:"row",showMatchingCellBackgroundFlag:!0,placeholder:"",shouldNodeBeRepresented:function(e){return!(e.hasNoRepresentation()&&!e.getParent()._isLayoutNode("layout-horizontal")||e.getParent()&&e.getParent()._isLayoutNode("layout-horizontal"))},onContextualEvent:function(e){if(e&&e.cellInfos&&e.collectionView.getTreeDocument()&&e.cellInfos.columnID>-1&&e.cellInfos.rowID>-1){e.data.event.stopPropagation();var t=e.cellInfos.nodeModel._getNodeCategory(),o=e.cellInfos.nodeModel._getNodeType(),i=e.collectionView.getTreeDocument(),n=void 0,l=void 0;return i.getVault()._processNodeType(t,o,e.collectionView.application,function(t){var o=t.options;o&&o.buildContextualMenu&&(n=o.buildContextualMenu({nodeModel:e.cellInfos.nodeModel,contextualMenuModel:n}))},"buildContextualMenu"),n||(n=[]),n.forEach(function(e){e.action?(l||(l=[]),l.push(e)):console.error("Contextual menu item has been ignored because it doesn't contain an action callback")}),l}},getCellTooltip:this.getSpecTreeDGVCellTooltip}),this._dataGridView.onCopy=this.onCopy,this._dataGridView.onCut=this.onCut,this._dataGridView.onPaste=this.onPaste,this._hasNotificationIconColumn&&(this._dataGridView._hasNotificationIconColumn=this._hasNotificationIconColumn),this.elements.container=this._dataGridView.getContent(),this._dataGridView.getContent().addClassName("wux-spectreeview"),this._dataGridView.getTypeRepresentationFactory().registerTypeRepresentations(v),this.setTreeDocument(e.treeDocument?e.treeDocument:new i),this._manageDragAndDrop(),this._manageHoverBar();var n=function(){var t=!!p.getTouchMode();if(this.touchMode!==t&&(this.touchMode=t,e.columns&&e.columns.length>0))for(var o=0;o<e.columns.length;o++)e.columns[o].dataIndex===f.HIDE_SHOW.dataIndex&&(e.columns[o].typeRepresentation=t?"visibilitySpecTreeTouch":"visibilitySpecTree",e.columns[o].editionPolicy=t?"EditionInPlace":"EditionOnOver")}.bind(this);n(),document.addEventListener("touchChange",function(){n()}.bind(this))},_formatColumns:function(e){var t=0;if(e&&e.length>1&&"tree"!==e[e.length-1].dataIndex){for(var o=0;o<e.length;o++)e[o].dataIndex===f.TREE.dataIndex&&(t=o),e[o].dataIndex===f.NOTIFICATION_ICON.dataIndex&&(this._hasNotificationIconColumn=!0);if(t!==e.length-1){var i=e.splice(t,1);e.push(i[0])}}else if(!e||0===e.length)return this._hasNotificationIconColumn=!0,[f.HIDE_SHOW,f.NOTIFICATION_ICON,f.TREE];return e},getTreeDocument:function(){return this._dataGridView.treeDocument},setTreeDocument:function(e){if(this._dataGridView&&this._dataGridView.treeDocument!==e){if(this._dataGridView.treeDocument&&r.cleanBindingOnDocument(this,this._dataGridView.treeDocument),this._dataGridView.treeDocument=e,e){var t=e.getFilterManager();t&&t.registerFilter("SpecTreeFilter",a);var o=this;e.getXSO().onPostRemove(function(e){o._hideHoverBar()})}this._manageUIActiveArea()}},_applyTouchMode:function(){this.touchMode?this._dataGridView.layout.cellHeight=38:this._dataGridView.layout.cellHeight=26},_applyColumns:function(e){},_applyFindWidget:function(){this._dataGridView&&(this._dataGridView.findWidget=this.findWidget)},_applyReadOnly:function(e){this._dataGridView.layout.setColumnOrGroupProperties("tree",{editableFlag:!this.readOnly}),this._dataGridView.cellDragEnabledFlag=!this.readOnly,this._dataGridView.rowDragEnabledFlag=!this.readOnly},_applyProperties(e){this.isDirty("findWidget")&&this._applyFindWidget(e?e.findWidget:void 0),this.isDirty("readOnly")&&this._applyReadOnly(e?e.readOnly:void 0),this._parent()},destroy:function(){var e=this.getTreeDocument();e&&r.cleanBindingOnDocument(this,e),this._dataGridView.destroy()},ensureNodeModelVisible:function(e){this._dataGridView.ensureNodeModelVisible(e)},subscribeOnceToAllCellsRendered:function(e){this._dataGridView.subscribeOnceToAllCellsRendered(e)},setActiveNode:function(e){var t=this._dataGridView.layout.getColumnIdentifiers(f.TREE.dataIndex),o=this._dataGridView.layout.getCellIDFromCoordinates({rowID:this._getNodeModelRowID(e),columnID:t.columnIndex});this._dataGridView.setActiveCell(o,!0)},unsetActiveNode:function(){this._dataGridView.setActiveCell(-1,!1)},getActiveNode:function(){var e=this._dataGridView.getActiveCellID();return this._dataGridView.getNodeModelAt(e)},setToggleSelectionFlag:function(e){this._dataGridView&&(this._dataGridView.selectionBehavior.toggle=e)},getManager:function(){var e=this;return{getScroller:function(){return e._dataGridView?e._dataGridView._getScroller():null},nodePositionInVisibleViewport:function(t){if(!e._dataGridView||!t)return 0;var o=e._getNodeModelRowID(t),i=e._dataGridView.layout.getRowPosition(o),n=e._dataGridView.getScrollerPosition().y;return n>i?-1:i+e._dataGridView.layout.getRowHeight(o)>n+e._dataGridView._getScroller().getContent().getDimensions().height?1:0},scrollToRow:function(t,o){if(e._dataGridView){var i,n=e._dataGridView.layout.getRowPosition(t);switch(o){case"top":i=Math.max(n,0);break;default:case"middle":i=Math.max(n-e._dataGridView.getViewportDimensions().height/2,0);break;case"bottom":i=Math.max(n-e._dataGridView.getViewportDimensions().height+e._dataGridView.layout.cellHeight,0)}e._dataGridView._getScroller().setPosition({y:i},!0)}},scrollToNode:function(t){e.ensureNodeModelVisible(t)},getCellModel:function(t){var o=e._dataGridView.layout.getColumnIdentifiers(f.TREE.dataIndex),i=e._dataGridView.layout.getCellIDFromCoordinates({rowID:t,columnID:o.columnIndex});return e._dataGridView._getViewAt(i).getContent()},_modelEvents:{subscribeOnce:function(e,t){t.call(this)}},setActiveNode:function(t){e.setActiveNode(t)},unsetActiveNode:function(){e.unsetActiveNode()},getActiveNode:function(){return e.getActiveNode()},forceMultiSelection:function(t){e.setToggleSelectionFlag(t)},onPostUpdateView:function(t){if(e._dataGridView)return e._dataGridView.onPostUpdateView(t)},onPostUpdateViewOnce:function(t){if(e._dataGridView)return e._dataGridView.onPostUpdateViewOnce(t)},_multiSelModeHasBeenForced:!!e._dataGridView&&e._dataGridView.selectionBehavior.toggle,_modeIsMultiSel:!!e._dataGridView&&e._dataGridView.selectionBehavior.toggle,enablePerformanceAnalysis:function(){}}},findInterface:function(e){if(e&&e.specTreeShell){e.specTreeShell.closeDrawer();var t=this.getTreeDocument();if(t&&this._dataGridView){this._dataGridView.prepareUpdateView(),t.prepareUpdate(),t.getFilterManager().setPropertyFilterModel("SpecTreeFilter",{filterId:"SpecTreeFilter",filterModel:{}}),this._dataGridView.showMatchingCellBackgroundFlag=!0;this._dataGridView.setFindStr(e.value,!1),t.pushUpdate(),this._dataGridView.pushUpdateView()}}},goToPreviousMatchingCell:function(){this._dataGridView&&this._dataGridView.goToPreviousMatchingCell()},goToNextMatchingCell:function(){this._dataGridView&&this._dataGridView.goToNextMatchingCell()},filterInterface:function(e){if(e&&e.specTreeShell){e.specTreeShell.closeDrawer();var t=this.getTreeDocument();if(t&&this._dataGridView){this._dataGridView.prepareUpdateView(),t.prepareUpdate(),this._dataGridView.showMatchingCellBackgroundFlag=!1;this._dataGridView.setFindStr(e.value,!1),t.getFilterManager().setPropertyFilterModel("SpecTreeFilter",{filterId:"SpecTreeFilter",filterModel:{filterString:e.value}}),t.pushUpdate(),this._dataGridView.pushUpdateView()}}},getSpecTreeDGVCellTooltip:function(e){var t=this.layout.getColumnGetCellTooltip(e.columnID);if(t)return t(e);var o=!(!e.nodeModel||e.nodeModel._isLayoutNode());return this.getCellDefaultTooltip(e,o)},_isDocumentFiltered:function(e){var t=!1;if(e){var o=e.getFilterManager();if(o){var i=o.getFilters();if(i){var n=i.SpecTreeFilter;t=n&&n.filterModel&&n.filterModel.filterString&&""!==n.filterModel.filterString}}}return t},_getDocumentOwner:function(){var e=document;if(this._dataGridView){var t=this._dataGridView.getContent();t&&t.ownerDocument&&(e=t.ownerDocument)}return e},_manageDragAndDrop:function(){var e=this._dataGridView;if(e){e.onDragStartCell=function(e,t){return t&&t.draggedNodes&&t.draggedNodes.forEach(function(e){e._getResolvedAndCall("onDragStart")}),!0},e.onDragEndCell=function(e,t){return t&&t.draggedNodes&&t.draggedNodes.forEach(function(e){e._getResolvedAndCall("onDragEnd")}),!0};var t=function(t,o){var i=e.getDraggedRowData(t);if(i){if("middle"===o.dropPosition&&i.rowID===o.rowID)return;var n="middle"===o.dropPosition?o.nodeModel:o.nodeModel.getParent();n&&o.droppedNodes&&o.droppedNodes.length>0&&(n.applyDropTreeNodeModel({droppedNodes:o.droppedNodes,dropPosition:o.dropPosition,dropNode:o.nodeModel}),t.preventDefault())}return!1};e.onDropCell=t.bind(this),e.onDropRowHeader=t.bind(this)}},_updateTreeCellView:function(e,t){this._dataGridView&&e&&(t=t||{updateCellContent:!1,updateCellLayout:!1,updateCellAttributes:!0},this._dataGridView.updateCellView(this._dataGridView.layout.getCellIDFromCoordinates({rowID:this._getNodeModelRowID(e),columnID:this._dataGridView.layout.getColumnIndex("tree")}),t))},_manageUIActiveArea:function(){var e=this;this._dataGridView&&h.addEventOnElement(this,this._dataGridView,d.POINTERHIT,function(t,o){2===t.multipleHitCount&&o&&o.nodeModel&&o.rowID>=0&&o.columnID===e._dataGridView.layout.getColumnIndex("tree")&&o.nodeModel._getResolvedAndCall("onEdit")});var t=this.getTreeDocument();t&&(r.bindEventOnDocument(this,t,"uiActiveUpdate",function(t){if(e._updateSpecTreeFeaturesView(),t&&t.data){var o=t.data.nodeModel;o&&e._updateTreeCellView(o)}}),r.bindEventOnDocument(this,t,"modelUpdate",function(t){t.options.updateType&&(t.options.updateType&WUXModelUpdateTypes.Addition||t.options.updateType&WUXModelUpdateTypes.Removal||t.options.updateType&WUXModelUpdateTypes.Expand||t.options.updateType&WUXModelUpdateTypes.VisibilityChange||t.options.updateType&WUXModelUpdateTypes.Filtering)&&e._updateSpecTreeFeaturesView()}),t.onNodeModelUpdate(function(t){t&&t.data&&t.data.nodeModel&&e._dataGridView.updateCellView(e._dataGridView.layout.getCellIDFromCoordinates({rowID:e._getNodeModelRowID(t.data.nodeModel),columnID:e._dataGridView.layout.getColumnIndex("tree")}),{updateCellContent:!0,updateCellLayout:!1,updateCellAttributes:!0})}))},_getRollbackInfos:function(){let e,t,o=this.getTreeDocument();if(o&&(t=o.getUIActiveNode()),t){var i=t.getResolvedAndCall("getRollbackInfos");if(i&&(e=i)&&e.rollbackContainer){let t=e.rollbackContainer&&e.rollbackContainer.isRollbackContainer();if("boolean"==typeof t)if(t){let t;e.rollbackContainer.processDescendants({treeTraversalOrder:"preOrder",processNode:function(e){var o=e.nodeModel;if(o&&o.isActive())return t=o,{stopProcessing:!0}}}),e.rollbackNode=t}else e={rollbackNode:null,rollbackContainer:null}}}return e},_updateSpecTreeFeaturesView:function(){this._updateUIActiveArea();var e=this._getRollbackInfos();this._updateInWorkPath(e),this._updateSecondaryActiveContainers(e),this._updateRollbackBar(e),this._dataGridView&&this._dataGridView.updateColumnView(this._dataGridView.layout.getColumnIndex("tree"),{updateCellContent:!1,updateCellLayout:!1,updateCellAttributes:!0})},_getNodeModelRowID:function(e){var t=null;if(e){var o=e.getParent();if(o&&o._isLayoutNode("layout-horizontal"))return this._getNodeModelRowID(o);null===(t=e._getRowID())&&(t=e._getRowID(!0))}return t},_updateUIActiveArea:function(){var e,t=this._dataGridView,o=t.layout,i=this.getTreeDocument();i&&(e=i.getUIActiveNode()),e&&t.getContent().addClassName("wux-ui-state-uiactive-mode");var n=!1;if(e&&e.isVisible()){for(var l=function(e){if("collapsed"===e.getState())return e;var t=e.getChildren();return t&&t.length>0?l(t[t.length-1]):e},r=l(e);r&&r.hasNoRepresentation();){var a=r.getPreviousVisibleNode();if(!a||r===a)break;r=a}if(r.isVisible()){var s=this._getNodeModelRowID(e),d=this._getNodeModelRowID(r),c=o.getRowPosition(s),u=o.getRowPosition(d)-c+o.getRowHeight(d);this.elements._uiActiveAreaBG||(this.elements._uiActiveAreaBG=new UWA.Element("div",{class:"wux-spectree-uiactive-area-bg"}),this.elements._uiActiveAreaBG.inject(t.elements.poolContainer)),this.elements._uiActiveAreaFG||(this.elements._uiActiveAreaFG=new UWA.Element("div",{class:"wux-spectree-uiactive-area-fg"}),this.elements._uiActiveAreaFG.inject(t.elements.poolContainer)),this.elements._uiActiveAreaFG.setStyles({display:"block",top:c,left:0,right:0,height:u}),this.elements._uiActiveAreaBG.setStyles({display:"block",top:c,left:0,right:0,height:u}),!window.__karma__&&navigator.webdriver&&(this.elements._uiActiveAreaBG.setAttribute("firstRowID",s),this.elements._uiActiveAreaBG.setAttribute("lastRowID",d)),n=!0}}n||(e||t.getContent().removeClassName("wux-ui-state-uiactive-mode"),this.elements._uiActiveAreaFG&&this.elements._uiActiveAreaFG.hide(),this.elements._uiActiveAreaBG&&this.elements._uiActiveAreaBG.hide())},_updateInWorkPath:function(e){var t=this.getTreeDocument();if(t&&(t._inWorkNode=null),this._inWorkPath&&this._inWorkPath.forEach(function(e){e._setIsActivePath(!1)}),this._inWorkPath=[],t&&e){t._inWorkNode=e?e.rollbackNode:null;for(var o=e?e.rollbackNode:null,i=t._getTrueRoot();o&&o!=i;)o._setIsActivePath(!0),this._inWorkPath.push(o),o=o.getParent()}},_updateSecondaryActiveContainers:function(e){var t=this.getTreeDocument();if(t&&e){var o=[],i=e?e.secondaryActiveContainers:null;if(i&&i.length>0)for(var n=t._getTrueRoot(),l=0;l<i.length;l++)for(var r=i[l];r&&r!=n;)o.push(r),r=r.getParent();t._setSecondaryActiveContainerPath(o)}},_updateRollbackBar:function(e){var t=this._dataGridView,o=t.layout,i=this.getTreeDocument();if(i&&i.processDescendants({onlyVisibleNodes:!0,treeTraversalOrder:"preOrder",processNode:function(e){var t=e.nodeModel;if(t&&(t._beforeRollbackCursor(),t.isRollbackContainer())){let e=!0;return t.processDescendants({onlyVisibleNodes:!0,treeTraversalOrder:"preOrder",processNode:function(t){let o=t.nodeModel;o&&(o[e?"_beforeRollbackCursor":"_afterRollbackCursor"](),o.isActive()&&(e=!1))}}),{shouldProcessDescendants:!1}}}}),i&&e&&t){var n=this;this._activeSupportRollbackNode=e?e.rollbackContainer:null,this._activeRollbackableNode=e?e.rollbackNode:null,this._lockRollbackbar=!!e&&e.lockRollbackbar;var l=this._isDocumentFiltered(i);if(this._activeSupportRollbackNode&&!l){var r=this._activeSupportRollbackNode.getVisibleChildren();if(Array.isArray(r)&&r.length){this._lockRollbackbar=!this._activeRollbackableNode;for(var a,s=this._activeRollbackableNode;s&&(!s.isVisible()||s.hasNoRepresentation());)s=s.getParent();s&&(a=this._getNodeModelRowID(s)),void 0===this._activeSupportRollbackNode.isRollbackContainer()&&this._updateRollbackNodesStatus(a,!1);var c,u=r[0];if(this._firstRollbackableChild=void 0,this._lastRollbackableChild=void 0,this._activeSupportRollbackNode.processDescendants({onlyVisibleNodes:!0,treeTraversalOrder:"preOrder",processNode:function(e){var t=e.nodeModel;t&&!t.hasNoRepresentation()&&(this._firstRollbackableChild||(this._firstRollbackableChild=t),this._lastRollbackableChild=t,c=t)}.bind(this)}),this._firstRollbackableChild&&(this._minLocalCursorPosition=o.getRowPosition(this._getNodeModelRowID(this._firstRollbackableChild))),this._lastRollbackableChild&&(this._maxLocalCursorPosition=o.getRowPosition(this._getNodeModelRowID(this._lastRollbackableChild))),!this.elements._rollbackSlider){var g;this.elements._rollbackSlider=new UWA.Element("div",{class:"wux-spectree-rollback-slider"}),this.elements._rollbackSliderRail=new UWA.Element("div",{class:"wux-spectree-rollback-slider-rail"}).inject(this.elements._rollbackSlider),this.elements._rollbackSliderBar=new UWA.Element("div",{class:"wux-spectree-rollback-slider-bar"}).inject(this.elements._rollbackSliderRail),this.elements._rollbackSliderCursor=new UWA.Element("div",{class:"wux-spectree-rollback-slider-cursor"}).inject(this.elements._rollbackSliderRail);var p=!1;h.addEventOnElement(this,t.getContent(),d.POINTERMOVE,function(e){g=n._getCoordinatesFromEvent(e),void 0!==window.jasmine&&e.sliderCellInfos&&(g=e.sliderCellInfos);var o=n._getDocumentOwner();if(p&&g){var i=n._getNodeModelRowID(n._firstRollbackableChild),l=n._getNodeModelRowID(n._lastRollbackableChild);g.rowID<i?g.rowID=i:g.rowID>l&&(g.rowID=l);var r=t.model[g.rowID];"function"==typeof r.isRollbackable&&r.isRollbackable()?o.body.style.cursor="default":o.body.style.cursor="not-allowed"}else o.body.style.cursor="default"});var v,_=function(e){if(p&&g){e.preventDefault();var i,l=o.getRowHeight(g.rowID)/2,r=w(e,n.elements._rollbackSlider),a=n._minLocalCursorPosition+(r.offsetY-l+2),s=void 0!==n._rollbackSliderBarPosition?a-n._minLocalCursorPosition-n._rollbackSliderBarPosition:0;if(void 0!==window.jasmine&&(a=t.layout.getPositionForCellAt(t.layout.getCellIDFromCoordinates({rowID:g.rowID,columnID:g.columnID})).top,s=void 0!==v?g.rowID-v:0,v=g.rowID),a>n._maxLocalCursorPosition&&(a=n._maxLocalCursorPosition+2),a<n._minLocalCursorPosition&&(a=n._minLocalCursorPosition+2),n.elements._rollbackSliderBar.setStyles({height:a-n._minLocalCursorPosition}),n.elements._rollbackSliderCursor.setStyles({top:a-n._minLocalCursorPosition}),n._rollbackSliderBarPosition=a-n._minLocalCursorPosition,0!==s&&void 0===window.jasmine&&(g.rowID=t.layout._getRowIDFromPosition(a)),s>0?i=g.rowID<t.model.length-1?g.rowID+1:g.rowID:s<=0&&(i=g.rowID>0?g.rowID-1:g.rowID),i){var d=t.getNodeModelAt(t.layout.getCellIDFromCoordinates({rowID:i,columnID:g.columnID}));d&&t.ensureNodeModelVisible(d)}n._updateRollbackNodesStatus(g.rowID,!0)}},f=function(e){p=!1;var o=n._getDocumentOwner();h.removeEventOnElement(n,o,d.POINTERMOVE,_),h.removeEventOnElement(n,o,d.POINTERUP,f);var i=t.model[g.rowID];void 0===this._activeSupportRollbackNode.isRollbackContainer()?i.defineAsRollbackedNode():i.isRollbackable()?(this._activeSupportRollbackNode&&this._activeSupportRollbackNode.isRollbackContainer()&&(this._activeRollbackableNode&&this._activeRollbackableNode.deactivate(),i.activate()),i.defineAsRollbackedNode()):(this._updateRollbackBar({rollbackContainer:this._activeSupportRollbackNode,rollbackNode:this._activeRollbackableNode}),this._dataGridView&&this._dataGridView.updateColumnView(this._dataGridView.layout.getColumnIndex("tree"),{updateCellContent:!1,updateCellLayout:!1,updateCellAttributes:!0})),t.unlockUI()}.bind(this);h.addEventOnElement(this,this.elements._rollbackSlider,d.POINTERDOWN,function(e){if(e.preventDefault(),!this._lockRollbackbar){p=!0,g=n._getCoordinatesFromEventAndWidget(e,t.getContent()),void 0!==window.jasmine&&e.sliderCellInfos&&(g=e.sliderCellInfos)&&(v=g.rowID);var o=n._getDocumentOwner();h.addEventOnElement(n,o,d.POINTERMOVE,_),h.addEventOnElement(n,o,d.POINTERUP,f),t.lockUI()}}.bind(this)),this.elements._rollbackSlider.inject(t.elements.poolContainer),h.addEventOnElement(this,this.elements._rollbackSlider,"dragstart",function(e){return e.preventDefault(),e.stopPropagation(),!1})}var m,b=0;if(this._lockRollbackbar){m=u;var C=this._getNodeModelRowID(u),D=this._getNodeModelRowID(c);b=o.getRowPosition(D)+o.getRowHeight(D)-o.getRowPosition(C)}else{m=this._firstRollbackableChild;var y=this._getNodeModelRowID(this._firstRollbackableChild),I=this._getNodeModelRowID(this._lastRollbackableChild);b=o.getRowPosition(I)+o.getRowHeight(I)-o.getRowPosition(y)}var V=o.getColumnPosition(o.getColumnIndex("tree")),N=12;if(this._activeSupportRollbackNode.hasNoRepresentation()&&(N+=this._getRelativeIncrementFactorForNode(this._activeSupportRollbackNode)),this.elements._rollbackSlider.setStyles({display:"block",position:"absolute",top:o.getRowPosition(this._getNodeModelRowID(m)),left:V+this._getAbsoluteIncrementFactorForNode(this._activeSupportRollbackNode)+N,height:b-2,zIndex:1e13}),!window.__karma__&&navigator.webdriver&&(this.elements._rollbackSliderBar.setAttribute("firstRowID",void 0!==y?y:C),this.elements._rollbackSliderBar.setAttribute("lastRowID",void 0!==I?I:D),this.elements._rollbackSliderCursor.setAttribute("rollbackedNodeRowID",a)),this._lockRollbackbar)this.elements._rollbackSliderBar.setStyles({display:"none"}),this.elements._rollbackSliderCursor.setStyles({display:"none"});else{var R=o.getRowPosition(this._getNodeModelRowID(s))-this._minLocalCursorPosition;this.elements._rollbackSliderBar.setStyles({display:"block",height:R+o.getRowHeight(this._getNodeModelRowID(this._activeRollbackableNode))/2-2}),this._activeRollbackableNode.isVisible()?this.elements._rollbackSliderCursor.setStyles({display:"block",height:o.getRowHeight(this._getNodeModelRowID(this._activeRollbackableNode))-4,top:R+2}):this.elements._rollbackSliderCursor.setStyles({display:"none"})}}else this.elements._rollbackSlider&&this.elements._rollbackSlider.setStyles({display:"none"})}else this.elements._rollbackSlider&&this.elements._rollbackSlider.setStyles({display:"none"})}else this.elements._rollbackSlider&&this.elements._rollbackSlider.hide()},_updateRollbackNodesStatus:function(e,t){var o=this;this._activeSupportRollbackNode&&void 0!==e&&this._activeSupportRollbackNode.processDescendants({onlyVisibleNodes:!0,treeTraversalOrder:"postOrder",processNode:function(i){var n=i.nodeModel;if(n&&!n.hasNoRepresentation()){var l=!1;o._getNodeModelRowID(n)<=e?n._isAfterRollbackCursor()&&(n._beforeRollbackCursor(),l=!0):n._isAfterRollbackCursor()||(n._afterRollbackCursor(),l=!0),l&&t&&o._updateTreeCellView(n)}}})},_getCoordinatesFromEventAndWidget:function(e,t){var o=this._dataGridView.layout,i=this._dataGridView.getScrollerPosition(),n=o.getLeftContainerWidth(),l=(o.getHeaderContainerHeight(),w(e,t)),r=l.offsetX+(l.offsetX>n?i.x:0),a=l.offsetY+(l.offsetX>n?i.y:0),s=o.getCellIDFromPositionInView({left:r,top:a});return o.getCellCoordinatesAt(s)},_getCoordinatesFromEvent:function(e){return this._getCoordinatesFromEventAndWidget(e,e.currentTarget)},_getAbsoluteIncrementFactorForNode:function(e){for(var t=0,o=e.getParents(),i=0;i<o.length;i++)t+=this._getRelativeIncrementFactorForNode(o[i]);return t},_getRelativeIncrementFactorForNode:function(e){var t=0,o=this.getTreeDocument();if(o)switch(e._getNodeCategory()){case o.getVault().NODE_CATEGORIES.LAYOUT:t=e._isLayoutNode("rollbackable-children")?20:0;break;case o.getVault().NODE_CATEGORIES.FAKE:t=20;break;default:if(e.hasNoRepresentation()){for(var i=e;i&&i.hasNoRepresentation();)i=i.getPreviousBrother();t=i&&i._isLayoutNode()?20:0}else t=20}return t},_manageHoverBar:function(){var e=this,t=this._dataGridView;h.addEventOnElement(this,t.elements.poolContainer,"mouseleave",function(){e._mouseCursorOut=!0,e._hideHoverBar(!0)}),h.addEventOnElement(this,t,d.POINTERMOVE,function(e,t){if(void 0!==window.jasmine&&e.cellInfos&&(t=e.cellInfos),t&&t.cellView&&t.cellView.elements.hoverBarDotMenu&&t.cellView.elements.hoverBarDotMenu.isHidden()){t.cellView.elements.hoverBarDotMenu.addClassName("wux-spectree-hoverbar-button-display");var o=function(){t&&t.cellView&&(t.cellView.elements.hoverBarDotMenu&&t.cellView.elements.hoverBarDotMenu.removeClassName("wux-spectree-hoverbar-button-display"),h.removeEventOnElement(t.cellView,t.cellView.elements.container,"mouseleave",o))};h.addEventOnElement(t.cellView,t.cellView.elements.container,"mouseleave",o)}}),t.addEventListener("hoverBarDotMenuClick",function(t,o){e._showHoverBar(o.nodeModel)}),h.addEventOnElement(this,t.elements.poolContainer,"mouseenter",function(){e._mouseCursorOut=!1})},_hideHoverBar:function(e){this.elements.hoverBarContainer&&(e?setTimeout(function(){this._mouseCursorOut&&this.elements.hoverBarContainer.setAttribute("visibility","false")}.bind(this),800):this.elements.hoverBarContainer.setAttribute("visibility","false"))},_showHoverBar:function(e){var t=this,o=this._dataGridView,i=o.layout;if(void 0===this.elements.hoverBarContainer){var n=function(e){e.stopPropagation()};this.elements.hoverBarContainer=new UWA.Element("div",{class:"wux-spectree-hoverbar",events:{mousedown:n,touchstart:n,mouseup:n,touchend:n}}),this.elements.hoverBarContainerRel=new UWA.Element("div",{class:"wux-spectree-hoverbar-rel"}).inject(this.elements.hoverBarContainer),this.elements.hoverBarToolbar=new s({overflowManagement:"scroll",direction:"horizontal",adaptSizeToParent:!0}).inject(this.elements.hoverBarContainerRel),this.elements.hoverBarContainer.inject(o.elements.poolContainer)}else this.elements.hoverBarToolbar.clear();var l=this.getTreeDocument();if(l&&e){var r=this._getNodeModelRowID(e);this.elements.hoverBarContainer.setStyles({top:i.getRowPosition(r)+1,height:i.getRowHeight(r)-2});var a=this.options?this.options:{},d=[],u=[],h=e._getNodeCategory(),g=e._getNodeType();if(l.getVault()._processNodeType(h,g,a.application,function(t){var o=t.options;o&&o.buildHoverBar&&!e._isSubnode()&&(d=o.buildHoverBar({nodeModel:e,hoverBarModel:UWA.clone(d)}))},"buildHoverBar"),!(d instanceof Array))throw"SpecTree: buildHoverBar does not return an array";if(d.forEach(function(e){u.push(e)}),u.forEach(function(o){var n=new c({label:"",displayStyle:"icon",icon:o.icon}),l=i.getRowHeight(e)-4;n.getContent().setStyle("min-height",l+"px"),n.getContent().setStyle("min-width",l+4+"px"),n.elements.iconPlaceholder.style.lineHeight=l-4+"px",n.addEventListener("buttonclick",function(i){o.callback&&(t.elements.hoverBarContainer.setStyle("PointerEvents","none"),o.callback({nodeModel:e}),setTimeout(function(){t.elements.hoverBarContainer.setStyle("PointerEvents",""),t._showHoverBar(e)},100))}),t.elements.hoverBarToolbar.add("element",{element:n.getContent(),position:"far"})}),u.length>0){var p=o.getActiveCellID();if(p>=0){var v=o.getEditionManager(p);v&&v.onEscape(p)}t.elements.hoverBarContainer.setAttribute("visibility","true")}else t.elements.hoverBarContainer.setAttribute("visibility","false")}},onCopy:function(){return{preventDefault:!0,stopPropagation:!1}},onCut:function(){return{preventDefault:!0,stopPropagation:!1}},onPaste:function(){return{preventDefault:!0,stopPropagation:!1}}});return Object.defineProperty(D,"DEFAULT_COLUMNS",{get:function(){return UWA.clone(f)}}),D});