/*!  Copyright 2016 Dassault Systemes. All rights reserved. */
define("DS/CAT3DAnnotationWidget/CATA3EAppInit",["DS/WAfrContainer/App"],function(e){"use strict";var t,n={wkbFile:"CAT3DAnnotationWidgetWkb.xml",wkbModule:"CAT3DAnnotationWidget",defaultCmdHdr:"CAT3DAnnotationWidgetDefaultHdr",defaultCmdJSModule:"DS/CAT3DAnnotationCommands/CAT3DAnnotationWidgetDefaultCmd"};return e.extend({setUp:function(e){var i=this;if(e.sourceApp)if(e.sourceApp.pad3DViewer){this.pad3DViewer=e.sourceApp.pad3DViewer,this.appMainDiv=e.sourceApp.appMainDiv;var o=function(o){o.sourceApp&&!o.sourceApp.isDisposeCalled()&&o.sourceApp.dispose();var a=o;a.widgetData=n;var r=o.done;e.done=function(t){i.appMainDiv||(i.appMainDiv=t.appMainDiv),e.done=r,e.done()},t.setUp(a)};t?o(e):require(["DS/CAT3DAnnotationWidget/CAT3DAnnotationWidget"],function(i){t=new i({widget:window.widget,data:n,pad3DViewer:e.sourceApp.pad3DViewer,appMainDiv:e.sourceApp.appMainDiv}),o(e)})}else e.done();else require(["DS/CAT3DAnnotationWidget/CAT3DAnnotationWidget"],function(o){t=new o({widget:window.widget,viewerAttachment:e.done,done:function(e){i.pad3DViewer=e.pad3DViewer,i.appMainDiv=e.appMainDiv},data:n})})},dispose:function(e){t&&t.dispose&&t.dispose(e),this._parent(e)},onWillEnter:function(e){return t&&t.onWillEnter&&t.onWillEnter(e),require(["DS/CAT3DAnnotationUtils/CAT3DAnnotationUtils"],function(t){t._sendUsageProbe("appTransitionFrom",e.options.id,"resolved")}),this._parent(e)},onWillLeave:function(e){return t&&t.onWillLeave&&t.onWillLeave(e),require(["DS/CAT3DAnnotationUtils/CAT3DAnnotationUtils"],function(t){t._sendUsageProbe("appTransitionTo",e.options.id,"resolved")}),this._parent(e)}})}),window.top.performance.mark("A3E_jsAppLoad"),window.performance.mark("A3E_jsAppLoad"),define("DS/CAT3DAnnotationWidget/CAT3DAnnotationWidget",["UWA/Core","DS/CAT3DAnnotationUtils/CAT3DAnnotationUtilsOptions","DS/PADServices/views/LandingPage","DS/PADServices/utils/GlobalModelEvents","DS/CATWebUXSlideDrop/CATWebUXSlideDropServices","i18n!DS/CAT3DAnnotationWidget/assets/nls/CAT3DAnnotationWidget"],function(e,t,n,i,o,a){"use strict";var r,s,d,l={},c=function(e,t,n){window.top.performance.measure(window.widget.id+"_"+e,n?t:window.widget.id+"_"+t),window.performance.measure(e,t)},u=function(e){window.top.performance.mark(window.widget.id+"_"+e),window.performance.mark(e)};const p=[{key:"difAnnotSet",type:"DIFAnnotationSet"}],w=["ds6w:label","ds6w:type","ds6wg:revision","ds6w:status","owner","ds6w:responsible","ds6w:modified","ds6w:project","ds6w:identifier"];function m(){var e=this.params.widget.getValue("xsceneStoredObjects");return e&&"string"==typeof e||(e='{"products":{},"filters":{}}'),JSON.parse(e)}function g(e){e&&e.length&&(this.showWelcomePanel(!1),this.pad3DViewer.addRootNodesFromContent({json3DXContent:{protocol:"3DXContent",version:"1.1",source:"X3DSEAR_AP",data:{items:e.map(function(e){return{envId:require("DS/PADUtils/PADUtilsServices").getPlatformId(),objectId:e.id,objectType:e.type,displayName:e.displayName}})}}}))}function f(e){if(e&&e.length){i.publish({event:"ENXViews/LandingPage/addOrRefresh",data:{objects:e.map(function(e){return{resourceid:e,openWithFilter:!1,loading:!0,fromCustom:!0}})}});var t=setInterval(function(){this.isAppReady&&this.welcomePanel&&(clearInterval(t),function(e,t){require("DS/WAFData/WAFData").authenticatedRequest(require("DS/PADUtils/PADUtilsServices").get3DSpaceUrl()+"/cvservlet/fetch/v2?tenant="+require("DS/PADUtils/PADUtilsServices").getPlatformId(),{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json",SecurityContext:require("DS/PADUtils/PADSettingsMgt").getSetting("pad_security_ctx")},data:JSON.stringify({physicalid:e,label:"A3IFetchForWelcomePanel"+Date.now(),select_predicate:w,select_file:["icon","thumbnail_2d"]}),onComplete:t,onFailure:function(){},onTimeout:function(){}})}(e,function(e){if(this.welcomePanel){var t=((e?JSON.parse(e):{}).results||[]).map(function(e){var t={},n=require("DS/ENOPAD3DViewer/utils/PAD3DViewerModelServices"),i=n.getRoots(this.pad3DViewer).map(function(e){return n.getNodeID(e)});e.attributes.forEach(function(e){t[e.name]=e.value});var o=t["ds6w:type"],a={resourceid:t.resourceid,label:t["ds6w:label"],icons:[t.type_icon_url],thumbnail:t.preview_url,grid:t,subLabel:t["ds6w:responsible"]+" | "+new Date(t["ds6w:modified"]).toLocaleString(),description:t["ds6w:identifier"],openWithFilter:!1,fromCustom:!0,loading:void 0,opened:i.indexOf(t.resourceid)>-1,item2Load:{}};return a.item2Load[a.resourceid]={},"DIFAnnotationSet"===o&&(a.addRemoveFromViewCtx=!0),a}.bind(this));i.publish({event:"ENXViews/LandingPage/addOrRefresh",data:{objects:t}})}}.bind(this)))}.bind(this),100)}}function D(e){this.isAppReady=!1,this.params=e,this.welcomePanel=this.pad3DViewer=null,this.tokensWelcomePanel=[],this.tokensWelcomePanel.push(i.subscribe({event:"ENXViews/LandingPage/refreshCustom"},f.bind(this))),this.tokensWelcomePanel.push(i.subscribe({event:"ENXViews/LandingPage/openCustom"},function(e){var t=m.call(this),n=[];e.customitem2open.forEach(function(e){p.some(function(i){if(t[i.key]&&t[i.key][e])return n.push({id:e,type:i.type}),!0})}),g.call(this,n)}.bind(this))),this.tokensWelcomePanel.push(i.subscribe({event:"ENXViews/LandingPage/removeFromView"},function(e){if(e&&e.customitem2remove&&e.customitem2remove.length){var t=require("DS/ENOPAD3DViewer/utils/PAD3DViewerModelServices"),n=t.getRoots(this.pad3DViewer).map(function(e){return t.getNodeID(e)});this.pad3DViewer.getApplicativeData().removeDIFAnnotSetKeepPrd&&e.customitem2remove.forEach(e=>{this.pad3DViewer.getApplicativeData().removeDIFAnnotSetKeepPrd(e)}),n.forEach(function(t){e.customitem2remove.indexOf(t)>-1&&this.pad3DViewer.removeRoots({pids:[t]})},this)}}.bind(this))),this.tokensWelcomePanel.push(i.subscribe({event:"ENXViews/LandingPage/removeFromStore"},function(e){if(e&&e.customitem2remove&&e.customitem2remove.length){var t=m.call(this),n=[];e.customitem2remove.forEach(function(e){p.some(function(i){if(t[i.key]&&t[i.key][e]&&-1===n.indexOf(e))return n.push(e),delete t[i.key][e],!0})}),this.params.widget.setValue("xsceneStoredObjects",JSON.stringify(t)),i.publish({event:"ENXViews/LandingPage/removeFromView",data:{customitem2remove:n}})}}.bind(this))),this.tokensWelcomePanel.push(i.subscribe({event:"ENXViews/WelcomePanel/action/welcomePanelDIFAnnotationSet"},function(){n.launchSearch({title:a.difAnnotSet,precondition:'flattenedtaxonomies:"types/DIFAnnotationSet"',showApplyButton:!1,ok:function(e){g.call(this,e.map(function(e){return{id:e.resourceid,type:e["ds6w:type_value"],displayName:e["ds6w:label"]}}))}.bind(this)})}.bind(this))),this.tokensWelcomePanel.push(i.subscribe({event:"ENXViews/WelcomePanel/action/welcomPanelPrefCmd"},function(){require(["DS/CATWebUXPreferences/CATWebUXPreferencesManager"],function(e){var t=e.givePreferenceManager({context:this.pad3DViewer.getFrameWindow()});if(t){var n=t.subscribe("onPreferencesPanelDestroyed",function(){t.unsubscribe(n),this.showWelcomePanel(!0)}.bind(this));this.showWelcomePanel(!1),t.displayPreferencePanel(this.pad3DViewer.getFrameWindow())}}.bind(this))}.bind(this)));var t=n.getDefaultActivities();t.activities[0].section.actions.splice(4,0,{id:"welcomePanelDIFAnnotationSet",title:a.difAnnotSet,icon:"annotation"}),t.activities.push({section:{id:"customizeAppSection",title:a.customApp,actions:[{id:"welcomPanelPrefCmd",title:a.prefs,icon:"cog"}]}}),this.welcomePanel=new n({widget:e.widget,readOnlyApp:!1,renderDiv:e.renderDiv,externalViewerMgt:!0,externalViewerMgtCB:function(e,t){!0!==t&&this.showWelcomePanel("viewer"!==e)}.bind(this),globalSearchPrecond:'flattenedtaxonomies:"types/DIFAnnotationSet" OR flattenedtaxonomies:"types/VPMReference" OR flattenedtaxonomies:"types/VPMRepReference"',defaultActionId:t.defaultActionId,activities:t.activities,onLandingPageReady:e.onLandingPageReady})}function v(){l.viewer.getContentName({callbacks:{onComplete:function(e){l.widget.setTitle(e.contentName)},onFailure:function(){}}})}D.prototype={constructor:D,initialize:function(){var e=this.welcomePanel.initialize();return e.then(function(){var e=m.call(this),t=Array.prototype.concat.apply([],p.map(function(t){return Object.keys(e[t.key]||[])}));f.call(this,t)}.bind(this)),e},setViewer:function(e){this.pad3DViewer=e,!this.params.initApp&&this.showWelcomePanel(!1);var t=e.render().getContent(),n=t.parentNode;t.style.position="relative",!this.params.renderDiv.parentNode&&n&&n!==this.params.renderDiv&&n.insertBefore(this.params.renderDiv,n.firstChild),this.params.renderDiv.insertBefore(t,this.params.renderDiv.firstChild),this.welcomePanel&&(this.params.renderDiv.insertBefore(this.welcomePanel.elements.mainBody,this.params.renderDiv.firstChild),this.welcomePanel.setViewer(e,!this.params.initApp)),this.params.initApp&&!this.welcomePanel&&require(["DS/ENOPAD3DViewer/utils/PAD3DViewerRestoreSession"],function(t){t.init({widget:this.params.widget,pad3DViewer:e})}.bind(this))},appReady:function(){if(this.isAppReady=!0,!this.welcomePanel&&this.params.initApp)require(["DS/ENOPAD3DViewer/utils/PAD3DViewerRestoreSession"],function(e){e.restoreSession()});else if(this.welcomePanel&&this.params.initApp){var e=this.params.widget.getValue("X3DContentId");this.params.widget.deleteValue("X3DContentId"),e&&setTimeout(function(t){t.addRootNodesFromContent({json3DXContent:JSON.parse(e),dispatch:!1})},0,this.pad3DViewer)}if(this.welcomePanel){var t=this.welcomePanel.appReady();return this.welcomePanel.redraw(),t}},dispose:function(){if(this.showWelcomePanel(!1),this.welcomePanel)return this.pad3DViewer=this.params=null,this.tokensWelcomePanel.forEach(i.unsubscribe,i),this.tokensWelcomePanel.length=0,this.welcomePanel.dispose()},showWelcomePanel:function(e){this.welcomePanel&&(this.welcomePanel.elements.mainBody.style.position="relative",this.welcomePanel.elements.mainBody.style.display=e?"":"none",e&&this.welcomePanel.redraw())}};var A=function(){l.annotControllerReady&&l.defaultCmdReady&&(c("A3E_Global widget creation time","A3E_jsAppLoad",!0),l.widget.dispatchEvent("onWidgetAndAppReady","1"===l.widget.getValue("widgetForODTReplay")?[{pad3DViewer:l.viewer}]:void 0))};function h(e,n){var i={merge:!1,file:n.wkbFile,module:n.wkbModule};t.getOption("testWkb")&&"CAT3DAnnotSemanticWidgetWkb.xml"===i.file?i={merge:!1,file:"CAT3DAnnotSemanticWidgetWkb_TST.xml",module:"CAT3DAnnotSemanticTestWidget"}:t.getOption("testWkb")&&"CAT3DAnnotationWidgetWkb.xml"===i.file&&(i={merge:!1,file:"CAT3DAnnotationWidgetWkb_TST.xml",module:"CAT3DAnnotationTestWidget"}),e.loadActionBar(i)}var C,P,b,S=function(){require(["DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext","DS/PADUtils/PADCommandProxy"],function(e,t){(C=e).renderDiv||C.initialize2(l.viewer.getFrameWindow().getViewerFrame(),t.appId(),l.widget.getValue("changeControlActivation")?"show":"hide","top-right",function(){C.addEvent("onAuthoringCtxVisible",function(e){e.showAuthoringContext&&l.widget.setValue("changeControlActivation",!0)})})})},y=function(e){require(["DS/PADUtils/PADSettingsMgt","DS/PADUtils/PADCommandProxy","DS/PADUtils/PADSharedSettings","i18n!DS/PADUtils/assets/nls/PADUtils"],function(n,i,o,a){var r,s=[],d=[];b=function(){l.widget.setPreferences([]),r.destroy(),s.forEach(function(e){e.cb&&n.removeEvent(e.cb,e.padFct)}),b=function(){}},P=function(){s.forEach(function(e){var t=e.preference.name,i=l.widget.getValue(t),o=n.getSetting(t);(i="boolean"===e.preference.type&&"boolean"!=typeof i?"true"===i:i)!==o&&n.setSetting(t,i),e.fct&&e.fct(i)}),n.updateWidgetPreferences(),!r&&s.length&&(r=i.create({events:{onPreferenceModification:function(e){s.some(function(t){if(e.name===t.preference.name){if("boolean"!=typeof e.value&&"string"!=typeof e.value)throw new Error("Value must be a string or a boolean");if(n.getSetting(e.name)!==e.value){if("boolean"===t.preference.type&&"boolean"!=typeof e.value)throw new Error("Preference is a boolean type so value must be a boolean");t.debounce=!0,l.widget.setValue(e.name,e.value),n.setSetting(e.name,e.value)}return t.fct&&t.fct(e.value),!0}})}}}),s.forEach(function(e){e.cb&&n.addEvent(e.cb,e.padFct=function(t){e.debounce?e.debounce=!1:r.preferenceModification({name:e.preference.name,value:t})})}))},l.widget.setPreferences([]),n.setSetting("syncAutoReload",!0),o.destroy(),o.addSharedSettings(l.widget),s.push({preference:{name:"changeControlActivation",type:"boolean",label:a.changeControlActivation_label,defaultValue:!1},fct:function(e){C&&C[e?"show":"hide"]()},cb:"onChangeControlActivation",debounce:!1}),s.push({preference:{name:"changeControlPosition",type:"list",label:a.changeControlPosition_label,defaultValue:"top-right",options:[{label:a["top-right_label"],value:"top-right"},{label:a["top-left_label"],value:"top-left"},{label:a["bottom-left_label"],value:"bottom-left"},{label:a["bottom-right_label"],value:"bottom-right"}]},fct:function(e){C&&C.setPosition(e)}}),n.setSetting("authorizeChangeControl",!0),e&&S(),t.getOption("debug")?s.push({preference:{name:"webapi_timeout",type:"text",label:"Query timeout",defaultValue:"60000"}}):d=["webapi_timeout"],d.forEach(function(e){l.widget.deleteValue(e)}),d.length=0,s.forEach(function(e){l.widget.mergePreferences([e.preference])}),P(),l.widget.addEvent("endEdit",P)})};function _(e){e.objectId&&require(["DS/CAT3DAnnotControllerForReview/CATDIFAnnotSetLoader"],function(t){if(l.viewer){new t({context:l.viewer}).load({id:e.objectId})}})}var V=function(e){e.unsubscribe(r),r=null,e.setLoadingDelegations({_DIFAnnotationSet:_,...o.getDelegation(l.viewer)}),v(),S(),require("DS/PADUtils/PADUtilsServices").isCloud()&&!window.__preventPrefPanel&&e.getViewer().displayIntroductoryControlPreferencePanel(),e.getController()&&e.getController()._model&&e.getController()._model._modelLoader&&e.getController()._model._modelLoader.setCGRWithSG(!0),c("A3E_PAD3DViewer creation","A3E_PAD3DViewerReady"),u("A3E_ownCommands"),require(["DS/CAT3DAnnotationFavoriteCtx/CAT3DAnnotationFavoriteCtxManager","DS/CAT3DAnnotationModelLoader/CAT3DAnnotationModelLoader"],function(t,n){c("A3E_Annot controller JS Load","A3E_ownCommands"),u("A3E_annotController"),s=n;var i=(d=t).getFavoriteContextManager({context:e});i.setActivationDropState(!0),s.getAnnotationModelLoader({context:e,favoriteCtxManager:i}).setActiveState(1),l.viewerAttachment&&l.viewerAttachment(l._appMainDiv),l.viewerAttachment=null,e.getFrameWindow().getContextualUIManager().activateContextualBarOnLeftClicAfterCSOChange(),c("A3E_Annot controller Init","A3E_annotController"),l.annotControllerReady=!0,A()});var t=e.subscribe({event:"onActionBarReady"},function(){c("A3E_Action Bar merge app commands","A3E_ownCommands"),l.viewer.unsubscribe(t),t=null,l._welcomePanel.appReady(),l.viewer.subscribe({event:"onRootAdded"},v),l.viewer.subscribe({event:"onRootRemoved"},v),l.viewer.subscribe({event:"onRootAttached"},v),l.viewer.subscribe({event:"onRootDetached"},v),l.viewer.subscribe({event:"onContentNameModified"},v),l.viewer.setupWidgetLink(),u("A3E_beforeDefaultCmdLoad"),require(["DS/ApplicationFrame/CommandsManager"],function(e){var t=l.viewer.getCommandContext?l.viewer.getCommandContext():null;e.setDefaultCommand({ID:l.widgetData.defaultCmdHdr,className:l.widgetData.defaultCmdJSModule,context:t}),c("A3E_Default Cmd Init","A3E_beforeDefaultCmdLoad"),l.defaultCmdReady=!0,A()})});h(e,l.widgetData)};function E(t){return l._appMainDiv||(l._appMainDiv=e.createElement("div",{class:"appMain",styles:{width:"auto",height:"100%"}})),l._welcomePanel=new D({widget:l.widget,readOnlyApp:!1,renderDiv:l._appMainDiv,initApp:t&&t.initApp,onLandingPageReady:t&&t.onLandingPageReady}),l._welcomePanel.initialize()}var W=function(){if(!l.viewer){c("A3E_UWA widget loading","A3E_widgetLoad"),u("A3E_LoadJSPAD3DViewer");var e=new Promise(function(e){E({initApp:!0,onLandingPageReady:function(){l.viewerAttachment(l._appMainDiv),l.viewerAttachment=null}}).then(e)}),t=new Promise(function(e){require(["DS/ENOPAD3DViewer/PAD3DViewer","text!DS/CAT3DAnnotationWidget/assets/json/CAT3DAnnotationWidget.json"],function(t,n){e([t,n])})}),n=new Promise(e=>{require(["DS/ENOXInterWdgCom/LinkManager"],t=>{t.initializeWidgetLink(l.widget,{appIds:[],uses:["ENXContent"],implements:["ENXContent"],open:!0}).then(e)})});Promise.all([e,t,n]).then(function(e){c("A3E_PAD3DViewer load JS","A3E_LoadJSPAD3DViewer"),u("A3E_PAD3DViewerReady");var t,n=JSON.parse(e[1][1]),i=require("DS/PADUtils/PADSettingsMgt");n.context="Default",n.mouseProfile=require("DS/PADUtils/PADUtilsServices").isCloud()?window.__mouseProfile:"CATIA";var o={widget:l.widget,windowOptions:n,enableFiltering:!0,binaryPrimitives:!0,enableSidePanel:!0,readyCB:y,visuProgressiveTileModel:!0};t=l.viewer=new e[1][0](o),n.mouseProfile&&t.getViewpoint().setDefaultController(!0,n.mouseProfile),l._welcomePanel.setViewer(t),t.setOption("propertiesFacet",i.getSetting("propertiesFacet")),t.setAuthorizedRootTypes(i.getSetting("ups_authorized_root_types")),r=t.subscribe({event:"onReady"},V),i.setSetting("settypes",!0),"1"===l.widget.getValue("widgetForODTReplay")&&l.widget.dispatchEvent("onPAD3DViewerCreated",[{pad3DViewer:t}]),l.widgetInitDone&&l.widgetInitDone({appMainDiv:l._appMainDiv,pad3DViewer:t})})}},T=function(){l.viewer&&l.viewer.refresh()},M=function(){l._welcomePanel&&l._welcomePanel.dispose(),l._welcomePanel=null,l.viewer&&(s.unreferenceAnnotationModelLoader({context:l.viewer}),d.unreferenceFavoriteContextManager({context:l.viewer}),l.viewer.destroy()),l={},s=d=null};function R(e){l.viewer&&l.viewer.search({searchQuery:e})}var x=function(e){l.widget=e.widget,l.widgetData=e.data,l._appMainDiv=e.appMainDiv,l.widgetInitDone=e.done,e.pad3DViewer?l.viewer=e.pad3DViewer:(c("A3E_JS dependencies loading","A3E_jsAppLoad",!0),u("A3E_widgetLoad"),e.viewerAttachment?(l.viewerAttachment=e.viewerAttachment,W()):(l.viewerAttachment=function(e){l.widget.setBody(e)},l.widget.addEvent("onLoad",W)),l.widget.addEvent("onRefresh",T),l.widget.addEvent("onDestroy",M),l.widget.addEvent("onSearch",R),l.widget.setMetas({helpPath:(l.widgetData.defaultCmdHdr.search("Insight")>=0?"CAT3DAnnotSemanticWidget":"CAT3DAnnotationWidget")+"/assets/help"}))};x.prototype.setUp=function(e){require(["DS/ApplicationFrame/CommandsManager"],function(t){l.widget.addEvent("onRefresh",T),l.widget.addEvent("onSearch",R),l.widget.setMetas({helpPath:(l.widgetData.defaultCmdHdr.search("Insight")>=0?"CAT3DAnnotSemanticWidget":"CAT3DAnnotationWidget")+"/assets/help"});var n={lastCommand:[],currentCommand:null,defaultCommand:null},i=l.viewer.getCommandContext();i?t._commandsState[i]=n:t._commandsState=n,t.resetDefaultCommand(i),t._isCommandEnding=!1,t._ignoreCommandBeginWhileEndingCommand=!1,["_commands","_cmdCheckHeader"].forEach(function(e){var n=i?t[e][i]:t[e];Object.keys(n).forEach(function(e){var t=n[e];t&&t._destroy&&t._destroy(),delete n[e]})}),e.sourceApp&&e.sourceApp.pad3DViewer!==l.viewer&&(l.viewer=e.sourceApp.pad3DViewer),l.viewer.setOption("propertiesFacet",require("DS/PADUtils/PADSettingsMgt").getSetting("propertiesFacet")),l.viewer.getBIController().toggleBetweenStandaloneAndSlaveMode("DUAL"),l.viewer.setLoadingDelegations({_DIFAnnotationSet:_,...o.getDelegation(l.viewer)}),y(l.viewer),l.viewer.getViewer().updateViewPanelUIConfiguration&&l.viewer.getViewer().updateViewPanelUIConfiguration({useShadingIllustration:!1,useOutline:!1}),v(),require(["DS/CAT3DAnnotationFavoriteCtx/CAT3DAnnotationFavoriteCtxManager","DS/CAT3DAnnotationModelLoader/CAT3DAnnotationModelLoader"],function(n,i){var o=l.viewer?l.viewer.getFrameWindow():null;o&&o.removeReviewModel&&o.removeReviewModel("DMUSection"),s=i;var a=(d=n).getFavoriteContextManager({context:l.viewer});a.setActivationDropState(!0),s.getAnnotationModelLoader({context:l.viewer,favoriteCtxManager:a}).setActiveState(1);var r=l.viewer.subscribe({event:"onActionBarReady"},function(){l.viewer.unsubscribe(r),t.setDefaultCommand({ID:e.widgetData.defaultCmdHdr,className:e.widgetData.defaultCmdJSModule,context:l.viewer.getCommandContext()}),l.defaultCmdReady=!0,e.done({appMainDiv:l._appMainDiv,pad3DViewer:l.viewer}),A()});h(l.viewer,e.widgetData),l.annotControllerReady=!0,A()}),E().then(function(){l._welcomePanel.setViewer(l.viewer),l._welcomePanel.appReady()})})};var F=!1;return x.prototype.dispose=function(){if(l.widget.removeEvent("onRefresh",T),l.widget.removeEvent("onSearch",R),l.widget.removeEvent("endEdit",P),b&&b(),l._welcomePanel&&l._welcomePanel.dispose(),l._welcomePanel=null,l.viewer){if(l.viewer.setLoadingDelegations({}),F){var e=require("DS/CAT3DAnnotationController/CAT3DAnnotationController");if(e){var t=e.giveAnnotationController({context:l.viewer});t&&t.saveLastFTAViewOrCaptureDisplayed(!0)}}s&&!F&&s.unreferenceAnnotationModelLoader({context:l.viewer}),d&&d.unreferenceFavoriteContextManager({context:l.viewer})}l.defaultCmdReady=!1,l.annotControllerReady=!1},x.prototype.onWillLeave=function(e){F=!(!e||!e.options||"ENOR3D_AP"!==e.options.id)},x});