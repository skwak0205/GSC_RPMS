/*!  Copyright 2016 Dassault Systemes. All rights reserved. */
define("DS/CAT3DAnnotationModel/CATAttrRepresentationFactory",["DS/Visualization/ThreeJS_DS","DS/Visualization/SceneGraphFactory","DS/SceneGraphNodes/FixedSizeNode3D","DS/Visualization/Node3D","DS/SceneGraphNodes/BillBoardNode3D","DS/SceneGraphNodes/ArrowNode","i18n!DS/CAT3DAnnotationModel/assets/nls/CAT3DAnnotationModel"],function(t,e,n,i,o,s,r){"use strict";function a(n){var i=e.createTextNode({text:n.text,font:"sans-serif",fontSize:n.fontSize,sdf:!0,color:new t.Color(n.color),side:t.DoubleSide});return i.setShadow(!1),i}function h(n){var o=.23*n.length,s=.08*n.length,r=s/2,h=[],l=[],u=0;h[u++]=-n.length/2,h[u++]=0,h[u++]=0,h[u++]=o-n.length/2,h[u++]=-r-.9*s,h[u++]=0,h[u++]=o-n.length/2,h[u++]=-r,h[u++]=0,h[u++]=n.length/2,h[u++]=-r,h[u++]=0,h[u++]=n.length/2,h[u++]=r,h[u++]=0,h[u++]=o-n.length/2,h[u++]=r,h[u++]=0,h[u++]=o-n.length/2,h[u++]=r+.9*s,h[u++]=0;var d=[];u=0,d[u++]=0,d[u++]=0,d[u++]=1;var c=[];u=0,c[u++]=1,c[u++]=1,c[u++]=1,c[u++]=1,c[u++]=1,c[u++]=1,c[u++]=1,l.push(0),l.push(1),l.push(2),l.push(0),l.push(2),l.push(3),l.push(0),l.push(3),l.push(4),l.push(0),l.push(4),l.push(5),l.push(0),l.push(5),l.push(6);var p=[];u=0;for(var g=0;g<h.length/3;g++)p.push(new t.Vector3(h[3*g],h[3*g+1],h[3*g+2]));p.push(new t.Vector3(h[0],h[1],h[2]));var f=new t.MeshBasicMaterial({color:new t.Color(n.color),side:t.DoubleSide,force:!0}),A=e.createSimpleMeshNode({material:f,bufferPosition:h,bufferNormal:d,bufferUV:c,bufferIndex:l,coordinates:p});A.setShadow(!1),A.setMatrix((new t.Matrix4).makeRotationZ(Math.PI).multiply((new t.Matrix4).makeTranslation(-n.length/2,0,0)));var y=a({text:n.text?n.text:String(Math.round(100*n.angle*180/Math.PI)/100),fontSize:o,color:n.color}),b=y.getBoundingBox();y.setMatrix((new t.Matrix4).makeRotationZ(-Math.PI/2));var T=new i;T.addChild(y),T.setMatrix((new t.Matrix4).makeTranslation(n.length,(b.max.x-b.min.x)/2,0));var w=new i;return w.setMatrix((new t.Matrix4).makeRotationZ(n.angle)),w.addChild(A),w.addChild(T),w}function l(t){var e=t.split("&#xA;"),n=[];e.forEach(function(t){n=n.concat(t.split("&#10;"))});var i=[];return n.forEach(function(t){i=i.concat(t.split(/(\r\n|\n|\r)/gm))}),n}function u(t){t.setPickParent&&t.setPickParent(!0);for(var e=t.children,n=0;n<e.length;n++)u(e[n])}return{buildTechnologicalAttributeRepresentation:function(d){if(d&&d.category&&d.attrType&&d.data){var c,p,g=function(t){var e,n,i,o,s;if("4"===t.category){if(4===t.attrType||5===t.attrType)for(e={arrowLabel:"",arrowStartPoint:{x:0,y:0,z:0},arrowEndPoint:{x:0,y:0,z:0},arrowColor:{r:0,g:0,b:0},showState:!1},s=0;s<t.data.length;s++)i=(n=t.data[s]).Name,o=n.Value,"ArrowLabel"===i?e.arrowLabel=o:"ArrowStartX"===i?e.arrowStartPoint.x=parseFloat(o):"ArrowStartY"===i?e.arrowStartPoint.y=parseFloat(o):"ArrowStartZ"===i?e.arrowStartPoint.z=parseFloat(o):"ArrowEndX"===i?e.arrowEndPoint.x=parseFloat(o):"ArrowEndY"===i?e.arrowEndPoint.y=parseFloat(o):"ArrowEndZ"===i?e.arrowEndPoint.z=parseFloat(o):"ArrowColorR"===i?e.arrowColor.r=parseInt(o):"ArrowColorV"===i?e.arrowColor.g=parseInt(o):"ArrowColorB"===i?e.arrowColor.b=parseInt(o):"IsShownStatus"===i&&(e.showState="1"===o);else if(14===t.attrType)for(e={orientations:[],orientationsNls:[],colors:[],length:0,constantSize:!1,xAxis:{x:0,y:0,z:0},yAxis:{x:0,y:0,z:0},zAxis:{x:0,y:0,z:0},origin:{x:0,y:0,z:0}},s=0;s<t.data.length;s++)i=(n=t.data[s]).Name,o=n.Value,"Rosette Size"===i?e.length=o:"IsPixelSize"===i?e.constantSize="1"===o:"IsShownStatus"===i?e.showState="1"===o:"Direction Value"===i?(e.orientations.push(o),n.Nls&&e.orientationsNls.push(n.Nls)):"DirRed"===i?e.colors.push({r:o/255}):"DirGreen"===i?e.colors[e.colors.length-1].g=o/255:"DirBlue"===i?e.colors[e.colors.length-1].b=o/255:-1!==i.indexOf("\\Origin\\")?i.indexOf("\\X`")>=0?e.origin.x=1e3*o:i.indexOf("\\Y`")>=0?e.origin.y=1e3*o:i.indexOf("\\Z`")>=0&&(e.origin.z=1e3*o):-1!==i.indexOf("\\XAxis\\")?i.indexOf("\\X`")>=0?e.xAxis.x=o:i.indexOf("\\Y`")>=0?e.xAxis.y=o:i.indexOf("\\Z`")>=0&&(e.xAxis.z=o):-1!==i.indexOf("\\YAxis\\")?i.indexOf("\\X`")>=0?e.yAxis.x=o:i.indexOf("\\Y`")>=0?e.yAxis.y=o:i.indexOf("\\Z`")>=0&&(e.yAxis.z=o):-1!==i.indexOf("\\ZAxis\\")&&(i.indexOf("\\X`")>=0?e.zAxis.x=o:i.indexOf("\\Y`")>=0?e.zAxis.y=o:i.indexOf("\\Z`")>=0&&(e.zAxis.z=o));else if(32===t.attrType)for(e={name:null,entities:null,thickness:null,thicknessLaw:[],position:{x:0,y:0,z:0}},s=0;s<t.data.length;s++)i=(n=t.data[s]).Name,o=n.Value,"Core Sample"===i?e.name=o:"IsShownStatus"===i?e.showState="1"===o:i.indexOf("XPoint")>=0?e.position.x=o:i.indexOf("YPoint")>=0?e.position.y=o:i.indexOf("ZPoint")>=0?e.position.z=o:"Entities Number"===i?e.entities=o+" "+r.compositePliesLbl:"Thickness"===i?e.thickness=n.Nls?n.Nls:o:i.indexOf("Thickness Law")>=0&&(e.thicknessLaw=l(o))}else if("6"===t.category){var a;if(2===t.attrType||4===t.attrType||5===t.attrType||6===t.attrType)for(e={textWithLeaders:[]},s=0;s<t.data.length;s++)i=(n=t.data[s]).Name,o=n.Value,"MLPTextWLeader"===i?(a={},e.textWithLeaders.push(a),a.text=l(o)):"IsShownStatus"===i?a.showState="1"===o:"X_Start"===i?(a.startPosition={},a.startPosition.x=parseFloat(o)):"Y_Start"===i?a.startPosition.y=parseFloat(o):"Z_Start"===i?a.startPosition.z=parseFloat(o):"X_End"===i?(a.endPosition={},a.endPosition.x=parseFloat(o)):"Y_End"===i?a.endPosition.y=parseFloat(o):"Z_End"===i?a.endPosition.z=parseFloat(o):"R"===i?(a.color={},a.color.r=parseFloat(o)/255):"G"===i?a.color.g=parseFloat(o)/255:"B"===i?a.color.b=parseFloat(o)/255:"A"===i?a.color.a=parseFloat(o)/255:"ArrowHeadVisibility"===i?a.arrowVisibleFlag="1"===o:"Thickness"===i?a.thickness=parseFloat(o):"TotalThickness"===i?a.totalThickness=n.Nls?n.Nls:o:"NbOfLayers"===i?a.nbLayers=o+" "+r.compositePliesLbl:"CSName"===i&&(a.csName=o)}return e}(d),f=!1,A=0,y=function(e){if(e&&e.text&&e.parentNode){var n=a({text:e.text,fontSize:e.fontSize||13,color:new t.Color(e.color||"#000000")});e.parentNode.addChild(n),n.setMatrix((new t.Matrix4).makeTranslation(3,A+3,1));var i=n.getBoundingBox();A+=i.max.y-i.min.y+3}};if(g)if("4"===d.category)if(4!==d.attrType&&5!==d.attrType||!g.arrowLabel){if(14===d.attrType){g.length=g.constantSize?96/25.4*g.length:1e3*g.length;var b=g.constantSize?new n({ratio:1}):new i,T=e.createSphereNode({radius:g.length/10,color:new t.Color({r:.7,g:.7,b:.7})});for(T.setShadow(!1),b.addChild(T),c=0;c<g.orientations.length;c++)b.addChild(h({length:g.length,color:g.colors&&g.colors[c]?g.colors[c]:new t.Color({r:.7,g:.7,b:.7}),angle:g.orientations[c],text:g.orientationsNls&&g.orientationsNls[c]?g.orientationsNls[c]:null}));b.setMatrix((new t.Matrix4).makeBasis(g.xAxis,g.yAxis,g.zAxis).setPosition(g.origin)),b.setNoZ(!0),u(b),f={node:b,visible:g.showState}}else if(32===d.attrType){var w=new o({type:"Spherical"}),m=new n({ratio:1});w.addChild(m);var v;for(c=g.thicknessLaw.length-1;c>=0;c--)y({text:g.thicknessLaw[c],parentNode:m});y({text:g.thickness,parentNode:m}),y({text:g.entities,parentNode:m}),y({text:g.name,parentNode:m});var x=m.getBoundingBox();v=x.max.x-x.min.x;var S=new t.MeshBasicMaterial({color:new t.Color("#FFFFFF"),side:t.DoubleSide,force:!0}),C=e.createRectangleNode({width:v+6,height:A+6,fill:!0,noEdge:!1,material:S});C.setShadow(!1),m.addChild(C),w.setMatrix((new t.Matrix4).setPosition(g.position)),w.setNoZ(!0),u(w),f={node:w,visible:g.showState}}}else{let e=new t.Vector3(g.arrowStartPoint.x,g.arrowStartPoint.y,g.arrowStartPoint.z),i=new t.Vector3(g.arrowEndPoint.x,g.arrowEndPoint.y,g.arrowEndPoint.z),r=(new t.Vector3).subVectors(i,e);r.multiplyScalar(96/25.4);var j=new n({ratio:1});const h=8;j.addChild(new s({arrowWidth:h/4,headLength:h,color:new t.Color(g.arrowColor),initialPoint:new t.Vector3,finalPoint:r,head:s.types.ARROW}));var D=new o({type:"Spherical"}),P=a({text:g.arrowLabel,fontSize:14,color:new t.Color(g.arrowColor)});let l=P.getBoundingBox();P.setMatrix((new t.Matrix4).setPosition(new t.Vector3(h,-(l.max.y-l.min.y)/2,0))),D.addChild(P),D.setMatrix((new t.Matrix4).makeTranslation((l.max.y-l.min.y)/2,0,0)),j.addChild(D),j.setMatrix((new t.Matrix4).setPosition(e)),j.setNoZ(!0),u(j),f={node:j,visible:g.showState}}else if("6"===d.category){var O,N,V,I,R,M,L;if(2===d.attrType&&g&&g.textWithLeaders&&g.textWithLeaders.length){var k=new i;for(c=0;c<g.textWithLeaders.length;c++){for(I=g.textWithLeaders[c].startPosition,R=g.textWithLeaders[c].endPosition,I=new t.Vector3(I.x,I.y,I.z),R=new t.Vector3(R.x,R.y,R.z),O=new n({ratio:1}),k.addChild(O),(N=(new t.Vector3).subVectors(R,I)).multiplyScalar(96/25.4),V=new s({arrowWidth:g.textWithLeaders[c].thickness,headLength:10,arrowScale:2,color:new t.Color(g.textWithLeaders[c].color),initialPoint:new t.Vector3,finalPoint:N,head:g.textWithLeaders[c].arrowVisibleFlag?s.types.ARROW:s.types.NONE}),O.addChild(V),M=new o({type:"Spherical"}),O.addChild(M),A=0,p=g.textWithLeaders[c].text.length-1;p>=0;p--)y({text:g.textWithLeaders[c].text[p],parentNode:M,color:g.textWithLeaders[c].color});L=N.clone().setLength(A/2),M.setMatrix((new t.Matrix4).setPosition((new t.Vector3).subVectors(N,L))),O.setMatrix((new t.Matrix4).setPosition(I))}k.setNoZ(!0),u(k),f={node:k,visible:g.showState}}else if((4===d.attrType||5===d.attrType||6===d.attrType)&&g&&g.textWithLeaders&&1===g.textWithLeaders.length){var F=new i,z=g.textWithLeaders[0];I=z.startPosition,R=z.endPosition,I=new t.Vector3(I.x,I.y,I.z),R=new t.Vector3(R.x,R.y,R.z),(N=(new t.Vector3).subVectors(I,R)).multiplyScalar(96/25.4),O=new n({ratio:1}),F.addChild(O),V=new s({arrowWidth:z.thickness,headLength:10,arrowScale:2,color:new t.Color(z.color),initialPoint:N,finalPoint:new t.Vector3,head:z.arrowVisibleFlag?s.types.ARROW:s.types.NONE}),O.addChild(V),M=new o({type:"Spherical"}),O.addChild(M);var _=[];for(z.csName?(_.push(z.csName),z.totalThickness&&_.push(z.totalThickness),z.nbLayers&&_.push(z.nbLayers)):_=z.text,A=0,p=_.length-1;p>=0;p--)y({text:_[p],parentNode:M,color:z.color});var E=M.getBoundingBox(),W=e.createRectangleNode({width:E.max.x-E.min.x+6,height:A+6,fill:!0,noEdge:!1,material:new t.MeshBasicMaterial({color:new t.Color("#FFFFFF"),opacity:0,side:t.DoubleSide,transparent:!0,force:!0})});W.setShadow(!1),M.addChild(W),L=N.clone().setLength(A/2),M.setMatrix((new t.Matrix4).setPosition((new t.Vector3).subVectors(N,L))),O.setMatrix((new t.Matrix4).setPosition(R)),F.setNoZ(!0),u(F),f={node:F,visible:g.showState}}}return f}}}}),define("DS/CAT3DAnnotationModel/CAT3DAnnotationModel",[],function(){}),define("DS/CAT3DAnnotationModel/CAT3DAnnotationNode",["DS/Visualization/Node3D","DS/CAT3DAnnotationRsc/CAT3DAnnotationRscServices"],function(t,e){"use strict";var n;return t.extend({init:function(t){var i,o,s=t||{};this._parent();var r,a=!1;let h=this;var l;if(this.getAnnotationClassType=function(){return"tps"},this.getAnnotationType=function(){return s.type},this.getAttributeCategory=function(){return s.category?s.category:"3DAnnotations"},this.getAnnotationVersion=function(){return s.version},this.getAnnotationSupertype=function(){if(o)return o;return o={1:1,2:1,3:1,4:1,5:2,6:2,7:3,8:3,9:3,10:3,11:3,12:4,13:4,14:4,15:4,16:4,17:5,18:5,19:6,20:6,21:6,22:7,23:7,24:7,25:7,26:7,27:7,28:7,29:1,30:1,31:1,32:2,33:2,34:1,35:1,36:1,37:4,38:4,40:8,41:8,42:8,43:8,44:8,45:8,46:8,47:9,51:10,54:8,55:1}[s.type]},this.getAnnotationName=function(){return s.name},this.getAnnotationUuid=function(){return s.uuid},this.getAnnotationIcon=function(){if(i)return i;var t=s.category||"3DAnnotations",n="3DAnnotations"===t?h.getAnnotationType():s.attrType;return i=e.getFeatureIconPath(t,n)},this.addLinkedData=function(t){t&&(r||(r={}),-1===t.type?(r.hyperlinksAndComments||(r.hyperlinksAndComments={}),r.hyperlinksAndComments.hiddenText=t.text):0===t.type?(r.hyperlinksAndComments||(r.hyperlinksAndComments={}),r.hyperlinksAndComments.urls||(r.hyperlinksAndComments.urls=[]),r.hyperlinksAndComments.urls.push({title:t.anchorText,url:t.address})):256&t.type?(r.relatedDocs||(r.relatedDocs=[]),r.relatedDocs.push(t)):512&t.type?(r.requirements||(r.requirements=[]),r.requirements.push(t)):"failureModes"===t.type&&(r.failureModes=t.data))},this.getAnnotationHyperlinkData=function(){return r},this.getAnnotationID=function(){return s.tpsID},this.getAnnotationTTRS=function(){return s.ttrs},this.getAnnotationSCSReframeArea=function(){return s.scsReframeArea},this.setDisplayFlag=function(t){t!==a&&(a=t)},this.getDisplayFlag=function(){return a},this.isVisualized=function(){return!0},this.getAnnotationSurfaceNormalRep=function(){return s.surfaceNormalRep},n||(n=s.onAnnotationAttrModifiedCB),s.hyperlinksData&&s.hyperlinksData.length)for(l=0;l<s.hyperlinksData.length;l++)0!==s.hyperlinksData[l].type&&-1!==s.hyperlinksData[l].type||this.addLinkedData(s.hyperlinksData[l]);s.failureModes&&s.failureModes.length&&this.addLinkedData({type:"failureModes",data:s.failureModes}),s.Text&&(this.getText=function(){return s.Text}),s.NOAText&&(this.getNOAText=function(){return s.NOAText}),s.NOAType&&(this.getNOAType=function(){return s.NOAType}),this.visible=!0,this.setVisibilityFree(!1)},setVisibility:function(t){t!==this.visible&&(this._parent(t),this.setVisibilityFree(!1===t),"function"==typeof n&&n(this,"visibility"))},toJSON:function(){if(!this.jsonObject){var t=this.isDefaultAnnotation?this.isDefaultAnnotation():void 0,e=this.getAnnotationToleranceValue?this.getAnnotationToleranceValue():void 0,n=this.getAnnotationToleranceZoneValue?this.getAnnotationToleranceZoneValue():void 0,i=this.getAnnotationDimensionLimits?this.getAnnotationDimensionLimits():void 0,o=this.getGeneralTolerance?this.getGeneralTolerance():void 0,s=this.getTabulatedLimit?this.getTabulatedLimit():void 0;this.jsonObject={},void 0!==this.getAnnotationID()&&(this.jsonObject.id=this.getAnnotationID()),void 0!==this.getAnnotationName()&&(this.jsonObject.name=this.getAnnotationName()),void 0!==this.getAnnotationIcon()&&(this.jsonObject.icon=this.getAnnotationIcon()),void 0!==this.getAnnotationType()&&(this.jsonObject.type=this.getAnnotationType()),void 0!==this.getAnnotationSupertype()&&(this.jsonObject.superType=this.getAnnotationSupertype()),void 0!==this.getAnnotationUuid()&&(this.jsonObject.uuid=this.getAnnotationUuid()),void 0!==this.getAnnotationTTRS()&&(this.jsonObject.ttrs=this.getAnnotationTTRS()),this.getText&&(this.jsonObject.text=this.getText()),this.getNOAText&&(this.jsonObject.noaText=this.getNOAText()),this.getNOAType&&(this.jsonObject.noaType=this.getNOAType()),void 0!==t&&(this.jsonObject.isDefaultAnnot=t),void 0!==e&&(this.jsonObject.toleranceValue=e),void 0!==n&&(this.jsonObject.toleranceZoneValue=n),void 0!==i&&(this.jsonObject.toleranceLimits=i),void 0!==o&&(this.jsonObject.generalTolerance=o),void 0!==s&&(this.jsonObject.tabulatedLimit=s)}if(this.children&&this.children.length){this.jsonObject.children&&this.jsonObject.children.splice(0,this.jsonObject.children.length);for(var r=0;r<this.children.length;r++)this.children[r]&&this.children[r].getAnnotationClassType&&this.children[r].toJSON&&(this.jsonObject.children||(this.jsonObject.children=[]),this.jsonObject.children.push(this.children[r].toJSON()))}return void 0!==this.getDisplayFlag()&&(this.jsonObject.displayFlag=this.getDisplayFlag()),void 0!==this.getAnnotationHyperlinkData()&&(this.jsonObject.hyperlink=this.getAnnotationHyperlinkData()),this.jsonObject.isVisible=this.isVisible(),this.jsonObject}})}),define("DS/CAT3DAnnotationModel/CAT3DAnnotationSetNode",["DS/CAT3DAnnotationModel/CAT3DAnnotationNode","DS/WebappsUtils/WebappsUtils"],function(t,e){"use strict";return t.extend({init:function(t){var n,i=t||{};this._parent(i);var o,s=[];this.getAnnotationIcon=function(){return n||(n=e.getWebappsAssetUrl("CAT3DAnnotationRsc","icons/22/"),n+="I_W3DAnnot_NodeAnnotationSet.png")},this.getAnnotationClassType=function(){return"tpsAnnotationSet"},this.getAnnotationType=function(){return 0},this.getRootAnnotationNode=function(t){for(var e=0;e<this.children.length;e++)if(this.children[e].getAnnotationType()===t)return this.children[e]},this.getContextType=function(){return i.contextType},this.addTTRS=function(t){if(t&&t.GeoP&&t.tpsID){for(var e,n,i=[],o=0;o<t.GeoP.length;o++){n=[],e=!1;for(var r=0;r<t.GeoP[o].length;r++)(0!==t.GeoP[o][r]||e)&&(n.push(t.GeoP[o][r]),e=!0);n.length&&i.push(n)}i.length&&s.push({geoP:i,tpsID:t.tpsID,referencedCGs:t.referencedCGs&&t.referencedCGs.length?t.referencedCGs:void 0})}},this.getTTRSs=function(){return s},this.addReferenceFrame=function(t){o||(o=[]),o.push({datums:t.datums,tpsID:t.tpsID,uuid:t.uuid})},this.getReferenceFrames=function(){return o}},toJSON:function(){return this._parent(),this.getSemanticStandards&&void 0!==this.getSemanticStandards()&&(this.jsonObject.semanticStandards=this.getSemanticStandards()),void 0!==this.getAnnotationIcon()&&(this.jsonObject.icon=this.getAnnotationIcon()),void 0!==this.getContextType()&&(this.jsonObject.contextType=this.getContextType()),void 0!==this.getAnnotationType()&&(this.jsonObject.type=this.getAnnotationType()),this.jsonObject}})}),define("DS/CAT3DAnnotationModel/CAT3DAnnotationAttributeNode",["DS/CAT3DAnnotationModel/CAT3DAnnotationNode","DS/CAT3DAnnotationModel/CATAttrRepresentationFactory","DS/Visualization/Node3D"],function(t,e,n){"use strict";return t.extend({init:function(t){var i,o=t||{},s=this,r=o.params||[];this._parent(o),this.isRootAttribute=function(){return o.isRootAttribute},this.getAnnotationClassType=function(){return"tpsAttribute"},this.addAttributeParam=function(t){if(t){for(var e=!0,n=0;n<r.length;n++)r[n].Name===t.Name&&r[n].Magnitude===t.Magnitude&&(r[n]=t,e=!1);e&&r.push(t)}},this.getAttributeParam=function(){return r},this.getPointedFeatureIds=function(){return o.pointedFeatureUuids},this.isFakeAttribute=function(){return!o.uuid||o.uuid&&!o.uuid.length},this.getAnnotationUuid=function(){return o.uuid?o.uuid:s.parents&&1===s.parents.length&&s.parents[0].getAnnotationUuid&&s.parents[0].getAnnotationUuid()?s.parents[0].getAnnotationUuid()+"_"+s.getAnnotationName():s.getAnnotationName()},this.getAnnotationAttributeNode=function(){return i},this.getAttributeType=function(){return o.attrType},this.buildVisualization=function(t){i&&i.removeChildren();var r=e.buildTechnologicalAttributeRepresentation({category:o.category,attrType:o.attrType,data:t});r&&r.node&&(i=new n(s.getAnnotationName()+"_rep"),s.addChild(i),i.addChild(r.node),i.setPickParent(!0),!1===r.visible&&s.setVisibility(!1))},this.isVisualized=function(){return void 0!==i}},toJSON:function(){return this.jsonObject?this._parent():(this._parent(),void 0!==this.getAttributeCategory()&&(this.jsonObject.category=this.getAttributeCategory()),void 0!==this.getAttributeParam()&&(this.jsonObject.param=this.getAttributeParam()),void 0!==this.getAnnotationTTRS()&&(this.jsonObject.ttrs=this.getAnnotationTTRS()),void 0!==this.isRootAttribute()&&(this.jsonObject.isRootAttr=this.isRootAttribute()),void 0!==this.getAttributeType()&&(this.jsonObject.attrType=this.getAttributeType()),void 0!==this.getPointedFeatureIds()&&(this.jsonObject.pointedAttrs=this.getPointedFeatureIds())),this.jsonObject}})}),define("DS/CAT3DAnnotationModel/CAT3DAnnotationViewNode",["DS/CAT3DAnnotationModel/CAT3DAnnotationNode","DS/WebappsUtils/WebappsUtils"],function(t,e){"use strict";return t.extend({init:function(t){var n=t||{};this._parent(n);var i,o,s,r=n.thumbnail?"data:image/png;base64,"+n.thumbnail:null,a=!1,h=[];this.getAnnotationIcon=function(){if(i)return i;var t=this.getViewType();switch(i=e.getWebappsAssetUrl("CAT3DAnnotationRsc","icons/22/"),t){case"ProjectionView":i+="I_W3DAnnot_ProjectionView";break;case"SectionView":i+="I_W3DAnnot_SectionView";break;case"SectionCutView":i+="I_W3DAnnot_SectionCutView";break;default:i+="I_W3DAnnot_AxoView"}return i+=".png"},this.isSubView=function(){return a},this.setIsSubView=function(t){a=t},this.setPreview=function(t){r=t},this.getPreview=function(){return r},this.getAnnotationClassType=function(){return"tpsView"},this.getViewType=function(){if(o)return o;var t=this.getMultiSectionData(),e=this.getAnnotationType();return o=1!==e||t?3===e?"SectionCutView":2===e||t?"SectionView":"AxonometricView":"ProjectionView"},this.getViewPlane=function(){return n.viewPlane},this.getViewPlaneInformations=function(){return{direction:n.viewDirection,origin:n.viewOrigin,normal:n.viewNormal}},this.getCappingRep=function(){return n.cappingRep},this.getReframeArea=function(){return n.reframeArea},this.getVisibleAnnotations=function(t,e){var i,o,s,r=t.getLastElement?t.getLastElement(!0):t,a=[];if(n.TPSs)for(var h=0;h<n.TPSs.length;h++){var l=!1,u=r.children;for(i=0;i<u.length;i++){var d=u[i];if("RootViews"!==d.getAnnotationType()&&"RootCaptures"!==d.getAnnotationType()){var c=d.children;for(o=0;o<c.length;o++)if(c[o].getAnnotationID()===n.TPSs[h]){t.getLastElement?((s=t.clone()).addElement(d),s.addElement(c[o]),a.push(s)):a.push(c[o]),l=!0;break}}if(l)break}}var p=[];if(a&&a.length&&e){var g=r.getRootAnnotationNode("RootGeometries");if(g)for(i=0;i<a.length;i++){var f=a[i].getLastElement?a[i].getLastElement(!0):a[i];if(f.getAnnotationTTRS){var A=f.getAnnotationTTRS();if(A){var y=g.children;for(o=0;o<y.length;o++)y[o].getAnnotationTTRS()&&y[o].getAnnotationTTRS().equals(A)&&(t.getLastElement?((s=t.clone()).addElement(g),s.addElement(y[o]),p.push(s)):p.push(y[o]))}}}}return a.concat(p)},this.isMultiSectionView=function(){return!!(n.multiClipping&&n.multiClipping.SketchNormal&&n.multiClipping.SketchOrigin&&n.multiClipping.views&&n.multiClipping.views.length&&n.multiClipping.views.length>1&&n.multiClipping.pointsDef&&n.multiClipping.pointsDef.length)},this.get2DClippingInformation=function(){return n.clipping2D},this.get2DClippingRepresentation=function(){return s},this.set2DClippingRepresentation=function(t){s=t},this.getMultiSectionData=function(){return n.multiClipping},this.setAssociatedCapture=function(t){h.push(t)},this.getAssociatedCapture=function(){return h},this.getTPSList=function(){return n.TPSs},this.getAnnotationSupertype=function(){return 11}},toJSON:function(){if(this.jsonObject)this._parent();else{this._parent();for(var t,e=this.parents[0].parents[0],n=this.getVisibleAnnotations(e,!0),i=[],o=0;o<n.length;o++){var s=n[o].parents[0],r=null,a=null;for(t=0;t<e.children.length;t++)if(s.getAnnotationType()===e.children[t].getAnnotationType()){r=t;break}for(t=0;t<e.children[r].children.length;t++)if(n[o].getAnnotationID()===e.children[r].children[t].getAnnotationID()){a=t;break}null!==r&&null!==a&&i.push([r,a])}void 0!==this.getAnnotationIcon()&&(this.jsonObject.icon=this.getAnnotationIcon()),void 0!==this.getAnnotationType()&&(this.jsonObject.type=this.getAnnotationType()),void 0!==this.getAnnotationSupertype()&&(this.jsonObject.superType=this.getAnnotationSupertype()),void 0!==this.isSubView()&&(this.jsonObject.isSubView=this.isSubView()),void 0!==this.getAssociatedCapture()&&(this.jsonObject.associatedCapture=this.getAssociatedCapture()),void 0!==this.isMultiSectionView()&&(this.jsonObject.isMultiSectionView=this.isMultiSectionView()),void 0!==this.getViewPlaneInformations()&&(this.jsonObject.viewPlaneInformations=this.getViewPlaneInformations()),void 0!==this.getMultiSectionData()&&(this.jsonObject.multiSectionData=this.getMultiSectionData()),void 0!==this.getReframeArea()&&(this.jsonObject.reframeArea=this.getReframeArea()),void 0!==i&&(this.jsonObject.tpsList=i)}return void 0!==this.getPreview()&&(this.jsonObject.preview=this.getPreview()),this.jsonObject}})}),define("DS/CAT3DAnnotationModel/CAT3DAnnotationRootNode",["DS/CAT3DAnnotationModel/CAT3DAnnotationNode"],function(t){"use strict";return t.extend({init:function(t){var e=t||{};this._parent(e),this.getAnnotationClassType=function(){return"tpsRoot"},this.getAnnotationType=function(){return 1===e.rootType?"RootViews":2===e.rootType?"RootCaptures":3===e.rootType?"RootNonSemantic":4===e.rootType?"RootDatums":5===e.rootType?"RootPositions":6===e.rootType?"RootDimensions":7===e.rootType?"RootRunOuts":8===e.rootType?"RootOrientations":9===e.rootType?"RootForms":10===e.rootType?"RootGeometries":11===e.rootType?"RootAttributes":12===e.rootType?"RootRestrictedArea":void 0},this.getAnnotationIcon=function(){},this.getAnnotationUuid=function(){return String(e.rootType)},this.getAnnotationCategory=function(){},this.isVisualized=function(){return!1}},toJSON:function(){this._parent(),void 0!==this.getAnnotationType()&&(this.jsonObject.type=this.getAnnotationType()),this.jsonObject.children||(this.jsonObject.children=[]),this.jsonObject.children.splice(0,this.jsonObject.children.length);for(var t=0;t<this.children.length;t++)this.jsonObject.children.push(this.children[t].toJSON());return this.jsonObject}})}),define("DS/CAT3DAnnotationModel/CAT3DAnnotationCaptureNode",["DS/CAT3DAnnotationModel/CAT3DAnnotationNode","DS/WebappsUtils/WebappsUtils"],function(t,e){"use strict";return t.extend({init:function(t){var n=t||{};this._parent(n);var i,o,s,r=n.thumbnail?"data:image/png;base64,"+n.thumbnail:null;this.getAnnotationIcon=function(){return i||(i=e.getWebappsAssetUrl("CAT3DAnnotationRsc","icons/22/"),i+="I_W3DAnnot_CaptureAnnotations.png")},this.getPointedView=function(){return n.view},this.setPreview=function(t){r=t},this.getPreview=function(){return r},this.getAnnotationClassType=function(){return"tpsCapture"},this.getAnnotationType=function(){return 6},this.getCaptureCamera=function(){return n.camera},this.getVisibleAnnotations=function(t){var e,i,o,s,r=[],a=t.getLastElement?t.getLastElement(!0):t;if(n.TPSs)for(var h=0;h<n.TPSs.length;h++){var l=!1,u=a.children;for(o=0;o<u.length;o++){if("RootViews"!==(i=u[o]).getAnnotationType()&&"RootCaptures"!==i.getAnnotationType()){var d=i.children;for(s=0;s<d.length;s++)if(d[s].getAnnotationID()===n.TPSs[h]){t.getLastElement?((e=t.clone()).addElement(i),e.addElement(d[s]),r.push(e)):r.push(d[s]),l=!0;break}}if(l)break}}for(var c=0;c<3;c++){var p=null,g=null;if(0===c?(p=n.CGs,g="RootGeometries"):1===c?(p=n.Views,g="RootViews"):1===c&&(p=n.Caps,g="RootCaptures"),p&&p.length&&(i=a.getRootAnnotationNode(g)))for(o=0;o<p.length;o++){var f=i.children;for(s=0;s<f.length;s++)if(f[s].getAnnotationID()===p[o]){t.getLastElement?((e=t.clone()).addElement(i),e.addElement(f[s]),r.push(e)):r.push(f[s]);break}}}return r},this.isSectionPlaneActivated=function(){return 1===n.ClipPla},this.getHiddenBodiesInst=function(){return n.HiddenBodyInst},this.getVisibleBodiesInst=function(){return n.VisibleBodyInst},this.getVisibleCompRelIds=function(){var t=n.VisibleCompRelId||[];return n.UncutCompRelId&&n.UncutCompRelId.length&&(t=t.concat(n.UncutCompRelId)),t},this.getUncutCompRelIds=function(){return n.UncutCompRelId},this.getUncutCGs=function(){return n.UncutCGs},this.getXMLVisibleCompRelIds=function(){var t=n.VisibleCompXmlId||[];return n.UncutCompXmlId&&n.UncutCompXmlId.length&&(t=t.concat(n.UncutCompXmlId)),t},this.getXMLUncutCompRelIds=function(){return n.UncutCompXmlId},this.getAnnotationSupertype=function(){return 11},this.setListsOfAssyPathComponents=function(t){if(t&&(t.visiblePaths&&t.visiblePaths.length||t.hiddenPaths&&t.hiddenPaths.length||t.visibleIdPaths&&t.visibleIdPaths.length)){var e;if(o||(o={visiblePaths:[],hiddenPaths:[],visibleIdPaths:[]}),t.visiblePaths)for(e=0;e<t.visiblePaths.length;e++)o.visiblePaths.push(t.visiblePaths[e].clone());if(t.hiddenPaths)for(e=0;e<t.hiddenPaths.length;e++)o.hiddenPaths.push(t.hiddenPaths[e].clone());if(t.visibleIdPaths)for(e=0;e<t.visibleIdPaths.length;e++)o.visibleIdPaths.push(t.visibleIdPaths[e])}},this.getListsOfAssyPathComponents=function(){return o},this.setListsOfUncutAssyPathComponents=function(t){if(t&&(t.uncutPaths&&t.uncutPaths.length||t.uncutCGs&&t.uncutCGs.length||t.uncutIdPaths&&t.uncutIdPaths.length)){var e;if(s||(s={uncutPaths:[],uncutCGs:[],uncutIdPaths:[]}),t.uncutPaths)for(e=0;e<t.uncutPaths.length;e++)s.uncutPaths.push(t.uncutPaths[e].clone());if(t.uncutCGs)for(e=0;e<t.uncutCGs.length;e++)s.uncutCGs.push(t.uncutCGs[e].clone());if(t.uncutIdPaths)for(e=0;e<t.uncutIdPaths.length;e++)s.uncutIdPaths.push(t.uncutIdPaths[e])}},this.getListsOfUncutAssyPathComponents=function(){return s},n.representation&&this.addChild(n.representation)},toJSON:function(){if(this.jsonObject)this._parent();else{this._parent();for(var t=[],e=this.parents[0].parents[0],n=this.getVisibleAnnotations(e),i=0;i<n.length;i++){var o,s=n[i].parents[0],r=null,a=null;for(o=0;o<e.children.length;o++)if(s.getAnnotationType()===e.children[o].getAnnotationType()){r=o;break}for(o=0;o<e.children[r].children.length;o++)if(n[i].getAnnotationID()===e.children[r].children[o].getAnnotationID()){a=o;break}null!==r&&null!==a&&t.push([r,a])}void 0!==this.getAnnotationIcon()&&(this.jsonObject.icon=this.getAnnotationIcon()),void 0!==this.getAnnotationType()&&(this.jsonObject.type=this.getAnnotationType()),void 0!==this.getAnnotationSupertype()&&(this.jsonObject.superType=this.getAnnotationSupertype()),void 0!==this.getPointedView()&&(this.jsonObject.pointedView=this.getPointedView()),void 0!==this.getVisibleBodiesInst()&&(this.jsonObject.visibleBodiesInst=this.getVisibleBodiesInst()),void 0!==this.getHiddenBodiesInst()&&(this.jsonObject.hiddenBodiesInst=this.getHiddenBodiesInst()),void 0!==this.getCaptureCamera()&&(this.jsonObject.camera=this.getCaptureCamera()),void 0!==t&&(this.jsonObject.tpsList=t)}return void 0!==this.getPreview()&&(this.jsonObject.preview=this.getPreview()),this.jsonObject}})}),define("DS/CAT3DAnnotationModel/CAT3DAnnotationDIFCaptureNode",["DS/CAT3DAnnotationModel/CAT3DAnnotationCaptureNode"],function(t){"use strict";return t.extend({init:function(t){var e=t||{};this._parent(e),this.getCaptureSupportPlane=function(){return{plane:e.plane,up:e.up}},e.representation&&this.addChild(e.representation)},toJSON:function(){return this.jsonObject?this._parent():(this._parent(),void 0!==this.getCaptureSupportPlane()&&(this.jsonObject.plane=this.getCaptureSupportPlane())),this.jsonObject}})});