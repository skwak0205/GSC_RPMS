define("DS/ENOX3DSpaceAttributesMgt/views/AttributesContants",[],()=>{return{COLUMNS_EXPORT:"export",TOOLBAR_ACTION_MORE_ATTRIBUTES:"moreAttributes",TOOLBAR_ACTION_DIVISER:"diviser",TOOLBAR_ACTION_MOVE_UP:"moveUp",TOOLBAR_ACTION_MOVE_DOWN:"moveDown",TOOLBAR_ACTION_MOVE_TOP:"moveFirst",TOOLBAR_ACTION_MOVE_BOTTOM:"moveLast",TOOLBAR_ACTION_CHANGE_COLOR:"changeColor",TOOLBAR_ACTION_REMOVE:"trash",TOOLBAR_DEFAULT_ACTIONS:["moreAttributes","diviser","trash"]}}),define("DS/ENOX3DSpaceAttributesMgt/views/actions/RemoveAttributesHandler",[],()=>{return class{static async execute(e){if(!e||!e.options)return;const[t,i]=await this.fetchDepencies(["DS/PADServices/utils/GlobalUtils","i18n!DS/PADServices/assets/nls/PADServices.json"]),{attrModel:n}=e.options,o=n?n.getSelectedNodes():[];n.withTransactionUpdate(()=>{o.forEach(e=>{this.isNodeRemovable(e)?n.removeRoot(e):(e.unselect(),t.displayNotif({level:"warning",message:i.replace(i.attributesCustomization.cannotRemove,{attr:e.getReferenceValue("attrTitle")})}))})})}static isNodeRemovable(e){const{layout:t,isAdditionalColumn:i}=e.options.grid;return!(!0===i||t&&!1===t.removable)}static fetchDepencies(e){return e.map(()=>({})),new Promise(t=>{require([...e],(...e)=>{t(e)})})}}}),define("DS/ENOX3DSpaceAttributesMgt/views/actions/ChangeColorHandler",[],function(){"use strict";return{execute:function(e){var t=e,i=e.options.attrModel.getSelectedNodes();require(["DS/PADServices/views/private/ColorPicker"],function(e){t.elements.container.disabled=!0;var n={background_color:"#ffffff",color:"#000000"};if(1===i.length&&i[0].getReferenceValue("columnColor")){var o=i[0].getReferenceValue("columnColor");n={background_color:o["background-color"],color:o.color}}new e({selected_color:n,renderTo:document.body,events:{onColorOK:function(e){t.elements.container.disabled=!1;for(var n=[],o=0;o<i.length;o++){var s=i[o],a={};"#ffffff"===e.background_color?a["background-color"]=void 0:a["background-color"]=e.background_color,"#000000"===e.color?a.color=void 0:a.color=e.color,s.updateOptions({grid:{columnColor:a}}),n.push(s.options.columnIndex)}t.options.modelEvents.publish({event:"ENXViews/AttributesCustomization/columnModification",data:{what:"changeColor",modifiedColumns:n,"background-color":a["background-color"]+";",color:a.color+";"}})},onClose:function(){t.elements.container.disabled=!1}}})})}}}),define("DS/ENOX3DSpaceAttributesMgt/views/AttributesCommons",["i18n!DS/PADServices/assets/nls/PADServices.json","DS/PADServices/utils/GlobalUtils","UWA/Core","DS/Tree/TreeNodeModel"],(e,t,i,n)=>{const o="trash",s="attrRemove",a="moreAttributes",r=["selection","hide_show","find_in_ctx","instanceName","instanceMatrix","thumbnail"],l={properties:[function(){return{property:"label",value:this.options.grid.attrTitle}},function(){const e={property:"text",value:void 0};return(void 0===this.options.grid.hasTitle||this.options.grid.hasTitle)&&(e.value=this.options.grid.attrTitle),e},function(){return{property:"dataIndex",value:this.options.columnIndex}},function(){return{property:"attrParent",value:this.options.grid.attrParent}},function(){return{property:"attrDim",value:this.options.grid.attrDim}},function(){return{property:"provider",value:this.options.grid.provider}},function(){return{property:"attrUnit",value:this.options.grid.attrUnit}},function(){return{property:"ds6w",value:this.options.grid.attrName}},function(){return{property:"hasNLS",value:void 0===this.options.grid.hasTitle||this.options.grid.hasTitle}},function(){return{property:"noTitleColumn",value:void 0!==this.options.grid.hasTitle&&!this.options.grid.hasTitle}},function(){return{property:"kind",value:this.options.kind}},function(){return{property:"ds6wFrom",value:"Instance"===this.options.grid.attrParent?"rel":void 0}},function(){return{property:"isAdditionalColumn",value:this.options.grid.isAdditionalColumn}},function(){return{property:"attrVisible",value:this.options.grid.attrVisible}},function(){return{property:"description",value:this.options.grid.attrDesc}},function(){const e=i.clone(this.options.grid.layout||{});return e.canBeGrouped=!!this.options.grid&&this.options.grid.canBeGrouped,{property:"customisation",value:{layout:e}}},function(){return{property:"attrSelectable",value:this.options.grid.attrSelectable}},function(){return{property:"attrNature",value:this.options.grid.attrNature}},function(){return{property:"attrUserAccess",value:this.options.grid.attrUserAccess}},function(){return{property:"attrRangeValue",value:this.options.grid.attrRangeValue}},function(){return{property:"attrEditable",value:this.options.grid.attrEditable}}]};return class{static get specificColumns(){return r}static get dumpProp(){return l}static get required(){return{columns:[],ActionsColumn:[{icon:{iconName:o,fontIconFamily:1},dataIndex:s,alignmentValue:"center",alwaysVisibleFlag:!0,width:30,sortableFlag:!1,resizableFlag:!1,editableFlag:!1,getCellTypeRepresentation:e=>{let t="actionRemove";return e.nodeModel&&!0===e.nodeModel.options.pinColumn?t="string":e.nodeModel&&(!0===e.nodeModel.options.grid.isAdditionalColumn||e.nodeModel.options.grid.layout&&!1===e.nodeModel.options.grid.layout.removable)&&(t="actionNotRemove"),t},getCellSemantics:e=>{const{options:t}=e?e.nodeModel:{},{isAdditionalColumn:i,layout:n}=t?t.grid:{};let o=null;return(!0===i||n&&!1===n.removable)&&(o={disabled:!0}),o}}]}}static get provided(){return{columns:{groupability:{icon:{iconName:"group",fontIconFamily:1},dataIndex:"canBeGrouped",typeRepresentation:"boolean",alignmentValue:"center",alwaysVisibleFlag:!0,width:30,editableFlag:!0,editionPolicy:"EditionInPlace",sortableFlag:!1,resizableFlag:!1,getCellEditableState:e=>{let t=!0;return e.nodeModel.options.grid.layout&&e.nodeModel.options.grid.layout.groupingLocked&&(t=!1),t},getCellTypeRepresentation:e=>{let t="boolean";return e.nodeModel&&!0===e.nodeModel.options.pinColumn&&(t="string"),t}}}}}static getToolbarActionView(e,t){const i=this.toolbarActionsDefinition[e];return"function"==typeof i?i(t):{}}static invokeActionByColumnID(e){const{columnID:t}=e||{},i=this.columnActionsMapping[t];i?this.invokeActionByID({actionId:i,...e}):console.error(`${t} don't have a mapped action`)}static createAttributeNode(e){const t={columnIndex:e.dataIndex,label:e.label,kind:e.kind?e.kind:"string",icons:e.icons||[],grid:{attrTitle:e.label,attrVisible:void 0===e.attrVisible||e.attrVisible,canBeGrouped:void 0!==e.canBeGrouped&&e.canBeGrouped,attrName:e.attrName,attrDim:e.attrDim,attrUnit:e.attrUnit,provider:e.provider&&e.provider.length>0?e.provider:void 0,layout:e.layout,isAdditionalColumn:void 0!==e.isAdditionalColumn&&e.isAdditionalColumn,attrRemove:!0,attrParent:e.attrInstRef||"Reference",attrInstRef:e.attrInstRef||"Reference",attrAlert:null,attrSelectable:e.attrSelectable,attrNature:e.attrNature,attrUserAccess:e.attrUserAccess,attrRangeValue:e.attrRangeValue,attrEditable:e.attrEditable},children:null};return new n(t)}static getAttributeIcons(e){let t;switch(e){case"Reference":t=[{iconName:"product"}];break;case"Instance":t=[{iconName:"flow-cascade"}];break;case"AdditionalColumn":t=[{iconName:"insert"}];break;default:t=void 0}return t}static invokeActionByID(e){const{actionId:t,context:i}=e||{};if(t&&i)if(this.actionsMeta[t]){const n=this.actionsMeta[t];require([n.executor],t=>{const{input:n}=e;t.execute(i,n)})}else console.error(`${t} action not found`)}static get toolbarActionsDefinition(){return{moreAttributes:t=>({fonticon:"attributes-add",title:e.attributesCustomization.moreAttributes,name:a,handler:()=>this.invokeActionByID({actionId:a,context:t})}),diviser:()=>({className:"divider"}),trash:t=>({fonticon:o,title:e.attributesCustomization.remove,name:"remove",handler:()=>this.invokeActionByID({actionId:o,context:t})})}}static get columnActionsMapping(){return{attrRemove:"trash"}}static get actionsMeta(){return{moreAttributes:{executor:"DS/ENOX3DSpaceAttributesMgt/views/actions/MoreAttributesHandler"},trash:{executor:"DS/ENOX3DSpaceAttributesMgt/views/actions/RemoveAttributesHandler"}}}}}),define("DS/ENOX3DSpaceAttributesMgt/services/predicatesServices",["UWA/Core","DS/FedDictionaryAccess/FedDictionaryAccessAPI","i18n!DS/ENOX3DSpaceAttributesMgt/assets/nls/ENOXAttributesMgtNls.json"],(e,t,i)=>{const n={name:"ClassificationAttributes",nlsName:i.Classification.title,declareIn:["VPMReference"]};class o{static get classificationExtensionProperties(){return"function"!=typeof n.isAvailable&&(n.isAvailable=async function(){if(Reflect.has(this,"ClassificationUtil"))return e.is(this.ClassificationUtil);try{this.ClassificationUtil=await o.loadRuntimeLibrary("DS/ClassificationUtil/ClassificationUtil")}catch(e){this.ClassificationUtil=null}return e.is(this.ClassificationUtil)}),n}static async getPropertiesForClasses(e,t){if(!Array.isArray(e)||!e.length||!t)throw new Error("invalid input");const i=e.indexOf(o.classificationExtensionProperties.name);let n=e;-1!==i&&(n=[...e]).splice(i,1);const s=[...new Set(n)].map(e=>`ds6wg:${e}`);let a=null;try{if(a=await o.fetchPropertiesForClass(s,t),-1!==i)try{const e=await o.fetchPropertiesForClassificationClass(t);a.push(...e)}catch(e){console.error("error with predicatesServices fetching classification class attributes")}}catch(e){console.error("error with predicatesServices fetching class attributes")}return a}static async fetchPropertiesForClass(e,i){if(!Array.isArray(e))throw new Error("invalid inputs");const{settingManager:n}=i||{};if(!n||"function"!=typeof n.getPlatformId||"function"!=typeof n.getLanguage)throw new Error("invalid inputs");const o=e.join(",");let s=null;try{s=await new Promise((e,i)=>{t.getPropertiesForClass(o,{tenantId:n.getPlatformId(),lang:n.getLanguage(),apiVersion:"R2019x",onComplete:t=>{const i="string"==typeof t?JSON.parse(t):t;e(i)},onFailure:e=>{i(e)}})})}catch(e){throw new Error(`fetchClassificationAttributes fails ${e}`)}return s}static async fetchPropertiesForClassificationClass(e){const{settingManager:t}=e||{};if(!t||"function"!=typeof t.getLanguage)throw new Error("predicateServices.fetchPropertiesForClassificationClass invalid inputs");if(!await this.classificationExtensionProperties.isAvailable())throw new Error("ClassificationUtil loading fails");let i=null;try{i=await new Promise((i,n)=>{const{ClassificationUtil:s}=this.classificationExtensionProperties;s.fetchClassificationAttributes({apiVersion:"R2019x",lang:t.getLanguage(),onComplete(t){const n="string"==typeof t?JSON.parse(t):t;o.updateNlsPropertiesForClassificationClass(n,e).catch(()=>{console.error("problems fetching nls properties for classification attributes")}).finally(()=>i(n))},onFailure(e){n(e)}})})}catch(e){throw new Error(`fetchClassificationAttributes fails ${e}`)}return i}static async updateNlsPropertiesForClassificationClass(e,t){if(!Array.isArray(e)||!t)throw new Error("invalid inputs");const[i]=e,{properties:n}=i||{};if(!Array.isArray(n))throw new Error("invalid inputs");const s=n.filter(e=>{const{curi:t}=e;return!o.isAGeneratedPredicate(t)});if(!s.length)return;const a=s.map(e=>e.curi),r=[...new Set(a)];let l=null;try{l=await o.getNLSPropertiesForClass(r,t)}catch(e){return void console.error("updateNlsPropertiesForClassificationClass: problem with getNLSPropertiesForClass")}s.forEach(e=>{const{curi:t}=e,i=l[t],{label:n}=i||{};"string"==typeof n&&(e.label=n)})}static async loadRuntimeLibrary(e){return await new Promise((t,i)=>{require([e],e=>{t(e)},t=>{i(new Error(`${e} loading fails`))})})}static async loadRuntimeLibraries(e){return Array.isArray(e)&&e.length?new Promise((t,i)=>{require(e,function(){t(arguments)},e=>{i(e)})}):Promise.reject(new Error("wrong inputs"))}static async getNLSPropertiesForClass(e,i){if(!Array.isArray(e))throw new Error("invalid inputs");const{settingManager:n}=i||{};if(!n||"function"!=typeof n.getPlatformId||"function"!=typeof n.getLanguage)throw new Error("invalid inputs");if(0===e.length)return[];const o=e.join(",");let s=null;try{s=await new Promise((i,s)=>{t.getResourcesInfo(o,{tenantId:n.getPlatformId(),lang:n.getLanguage(),apiVersion:"R2019x",onComplete:t=>{const n="string"==typeof t?JSON.parse(t):t;Array.isArray(n)&&e.length===n.length||s(new Error("inconsistent nls answer compare to classes input"));const o={};e.forEach((e,t)=>{o[e]=n[t]}),i(o)},onFailure:e=>{s(e)}})})}catch(e){throw new Error(`getNLSPropertiesForClass fails ${e}`)}return s}static getSelectableInfoFromPredicateInfo(e){const{nature:t,selectable:i,userAccess:n,dataType:o,range:s,rangeValues:a,multiValuated:r}=e||{};return{nature:t,selectable:i,userAccess:n,dataType:o,range:s,rangeValues:a,multiValuated:r}}static createANewAttributePredicate(e,t,i){if(!e||!t||!i)throw new Error("wrong input");const{manipulationUnit:n,dimension:s,isAppPredicate:a,isAppPredicateEditable:r}=i||{};return{uri:e,manipulationUnit:n,dimension:s,isAppPredicate:a,isAppPredicateEditable:r,predicates:[{classNames:[t],...this.getSelectableInfoFromPredicateInfo(i)}],get curi(){return this.uri},get isAnAppPredicate(){return"boolean"==typeof this.isAppPredicate&&this.isAppPredicate},get isAnAppPredicateEditable(){return"boolean"==typeof this.isAppPredicateEditable&&this.isAppPredicateEditable},get inTypes(){const e=[];return this.predicates.forEach(t=>e.push(...t.classNames)),[...new Set(e)]},get nature(){const e=this.getPredicateInfo();return e?e.nature:null},get userAccess(){const e=this.getPredicateInfo();return e?e.userAccess:null},get multiValuated(){const e=this.getPredicateInfo();return e?e.multiValuated:null},get dataType(){const e=this.getPredicateInfo();if(!e)return"";const t=e.dataType;return t.substring(t.indexOf("#")+1)},get rangeValues(){const e=this.getPredicateInfo();return e&&e.rangeValues||null},get selectable(){const e=this.getPredicateInfo();return e?e.selectable:null},getSelectables(e=null){return("function"==typeof e?this.predicates.filter(e):this.predicates).map(e=>e.selectable)},get description(){return i.description},get label(){return i.label},get isAMultiPredicate(){return this.predicates.length>1},findPredicateInfo(e){return"function"!=typeof e?null:this.predicates.find(e)},getPredicateInfo(){if(!this.isAMultiPredicate)return this.predicates[0];if(!this.forceEdition)return null;const e=this.predicates.filter(o.isAPredicateForEdition);if(!e.length)return null;const t=e.findIndex(e=>e.selectable===this.forceEdition);return-1===t?null:e[t]},get isEditable(){return this.isAnAppPredicate?this.isAnAppPredicateEditable:!!this.forceEdition||o.isAPredicateEditable(this)},set forceEditionWith(e){if(e){const t=this.findPredicateInfo(t=>t.selectable===e);t&&o.isAPredicateForEdition(t)&&(this.forceEdition=e)}else delete this.forceEdition},get canBeForceForEdition(){return this.getSelectables(o.isAPredicateForEdition).length>0}}}static canBeEdited(e){return"string"==typeof e&&-1!==e.search(/([wW]rite)/g)}static getAttributePredicatesFromClassPredicates(e,t=null,i=null){if(!e)throw new Error("invalid input");if(!Array.isArray(e))throw new Error("invalid format");const n=[];return e.forEach(e=>{const{classInfo:o}=e,s=o.curi,a=e.properties;Array.isArray(a)&&a.forEach(e=>{const o=this.getUriFromPredicateInfo(e);if(this.isPredicateIgnoredByApplication(o,t))return;const a=this.getSelectableInfoFromPredicateInfo({...e,multiValuated:this.isAMultiValuatedPredicate(e,i)}),r=n.find(e=>e.uri===o);if(r){const{predicates:t}=r,i=t.find(t=>this.isPredicateInfoEqual(t,e));i?i.classNames.find(e=>e===s)||i.classNames.push(s):t.push({classNames:[s],...a})}else{let a=!1;const r=this.isPredicateControlledByApplication(o,t);r&&(a=this.isAnEditablePredicateControlledByApplication(o,t)),n.push(this.createANewAttributePredicate(o,s,{...e,multiValuated:this.isAMultiValuatedPredicate(e,i),isAppPredicate:r,isAppPredicateEditable:a}))}})}),n}static isAMultiValuatedPredicate(e,t){if(!e||!Array.isArray(t))return!1;const{selectable:i}=e;return!!i&&-1!==t.map(e=>{const{Name:t,Owner:i}=e;return i?`${i}.${t}`:t}).indexOf(i)}static isPredicateInfoEqual(e,t){if(!e||!t)throw new Error("isPredicateInfoEqual invalid input");const{nature:i,selectable:n,userAccess:o}=e,{nature:s,selectable:a,userAccess:r}=t;return i===s&&n===a&&o===r}static isAPredicateForEdition(e){const{userAccess:t,nature:i,selectable:n,multiValuated:s}=e||{};return!s&&(!!n&&(!!o.isAnAttribute(i)&&!!o.canBeEdited(t)))}static isAPredicateEditable(e){if(!e)return!1;const{curi:t,isAMultiPredicate:i}=e;return!!o.isAGeneratedPredicate(t)&&(!i&&o.isAPredicateForEdition(e))}static isAnAttribute(e){return"string"==typeof e&&e.toUpperCase()==="attribute".toUpperCase()}static isAGeneratedPredicate(e){return"string"==typeof e&&e.startsWith("ds6wg:")}static isAnEditablePredicateControlledByApplication(e,t){if(!this.isPredicateControlledByApplication(e,t))return!1;const{userAccess:i}=t[e]||{};return this.canBeEdited(i)}static isPredicateControlledByApplication(e,t){if("string"!=typeof e||!t)return!1;return-1!==Reflect.ownKeys(t).indexOf(e)}static isPredicateIgnoredByApplication(e,t){if(!this.isPredicateControlledByApplication(e,t))return!1;const{ignored:i}=t[e]||{};return"boolean"==typeof i&&i}static getUriFromPredicateInfo(e){const{curi:t}=e||{};if(!t)throw new Error("predicateInfo without uri");return{"ds6wg:XCADExtension.V_CADOrigin":"ds6w:cadMaster"}[t]||t}}return o}),define("DS/ENOX3DSpaceAttributesMgt/views/actions/MoveColumnsHandler",[],function(){"use strict";return{execute:function(e,t){var i=e.options.attrModel.getSelectedNodes();!0===e.options.withDgv?this.__dgvMoveColumn.apply(e,[t,i]):this.__treeMoveColumn.apply(e,[t,i])},__dgvMoveColumn:function(e,t){var i=this;1===t.length&&this.options.attrModel.withTransactionUpdate(function(){var n,o=t[0],s=o.getReferenceValue("pinContent"),a=o._getLocalID?o._getLocalID():o._localID,r=i.__locateFirstAndLastPin(s),l=r.first._getLocalID?r.first._getLocalID():r.first._localID,d=r.last?r.last._getLocalID?r.last._getLocalID():r.last._localID:i.options.getRoots().length-1;switch(e){case"moveFirst":n=l;break;case"moveUp":n=l<=a-1?a-1:a;break;case"moveDown":n=d>=a+1?a+1:a;break;case"moveLast":n=d}if(a!==n){var c={fromID:a,toID:n};i._isMoving=!0,i.options.attrModel.addChild(o,c.toID),o.select(),i._isMoving=!1,i.options.modelEvents.publish({event:"ENXViews/AttributesCustomization/columnModification",data:{what:"moveColumn",move2perform:c}})}})},__treeMoveColumn:function(e,t){var i=this;1===t.length&&this.options.attrModel.withTransactionUpdate(function(){var n=t[0],o=n._getLocalID?n._getLocalID():n._localID,s={fromID:o,toID:-1};switch(e){case"moveFirst":s.toID=0;break;case"moveUp":s.toID=o-1;break;case"moveDown":s.toID=o+1;break;case"moveLast":s.toID=i.options.attrModel.getRoots().length-1}-1!==s.toID&&o!==s.toID&&s.toID<i.options.attrModel.getRoots().length&&(i._isMoving=!0,i.options.attrModel.addChild(n,s.toID),n.select(),i._isMoving=!1,i.options.modelEvents.publish({event:"ENXViews/AttributesCustomization/columnModification",data:{what:"moveColumn",move2perform:s}}))})}}}),define("DS/ENOX3DSpaceAttributesMgt/views/AttributesCustomization",["i18n!DS/PADServices/assets/nls/PADServices.json","DS/PADServices/views/private/Iconbar","DS/ENOX3DSpaceAttributesMgt/views/AttributesCommons","DS/PADServices/utils/GlobalUtils","css!DS/UIKIT/UIKIT","UWA/Core","UWA/Controls/Abstract","DS/Controls/Button","DS/Tree/TreeDocument","DS/Tree/TreeNodeModel","DS/Controls/Toggle","DS/DataGridView/DataGridView","DS/DataGridView/DataGridViewLayout","DS/PADServices/utils/PlatformURL","i18n!DS/ENOX3DSpaceAttributesMgt/assets/nls/ENOXAttributesMgtNls.json","css!DS/PADServices/PADServices","css!DS/ENOX3DSpaceAttributesMgt/views/AttributesCustomization.css"],function(e,t,i,n,o,s,a,r,l,d,c,u,p,m,h){"use strict";return a.extend({name:"attr-customization",defaultOptions:{renderTo:null,modelEvents:null,subscribeTokens:[],modelSubscribeTokens:[],compactMode:!1,applyOnlyToThisApp:!1,baseTypes:[],selectedTypes:[],selectedExtensions:[],rowHeaderActivated:!0,thumbnailsActivated:!1,pinModel:{},dgvOptions:{defaultColumnDef:{width:"auto",typeRepresentation:"string"},showRowIndexFlag:!1,showRowBorderFlag:!0,showAlternateBackgroundFlag:!1,rowSelection:"multiple",cellSelection:"none",selectionBehavior:{canInteractiveMultiselectWithCheckboxClick:!0,canMultiSelect:!0,enableFeedbackForActiveCell:!0,enableShiftSelection:!0,toggle:!1,unselectAllOnEmptyArea:!0},columns:[{icon:{iconName:"database",fontIconFamily:1},tooltip:e.attributesCustomization.attrVisible,dataIndex:"attrVisible",typeRepresentation:"boolean",alignmentValue:"center",alwaysVisibleFlag:!0,width:30,editableFlag:!0,editionPolicy:"EditionInPlace",sortableFlag:!1,resizableFlag:!1,getCellEditableState:function(e){var t=!0;return e.nodeModel.options.grid.layout&&void 0!==e.nodeModel.options.grid.layout.removableFromView?t=e.nodeModel.options.grid.layout.removableFromView:!0===e.nodeModel.options.pinColumn&&(t=!1),t},getCellTypeRepresentation:function(e){return e.nodeModel&&!0===e.nodeModel.options.pinColumn?"string":"boolean"}},{text:e.attributesCustomization.attrTitle,dataIndex:"tree",typeRepresentation:"string",editableFlag:!1,sortableFlag:!1,resizableFlag:!1}]},dgvLayoutOptions:{cellHeight:28,columnHeaderHeight:38,rowsHeader:!0}},init:function(t){this._parent(t);var o=this,a=n.isWebInWinContext()?"-immersivePanelWebInWin":"-immersivePanel";o.elements.container=s.createElement("div",{class:o.getClassNames(a)}),m.retrievePlatformUrl({addDefaults:!0,initWSAcess:!0}).then(function(){o.instanceMgt=!!(o.options.baseInstanceTypes&&o.options.baseInstanceTypes.length>0);var t=o.options.dgvOptions;t.columns=t.columns.concat(i.required.columns,i.required.ActionsColumn),t.columns.push(i.provided.columns.groupability),o._buildBody(),o._buildFooter(),o.elements.panel2small=s.createElement("div",{class:o.getClassNames("-panel2small"),text:e.attributesCustomization.panel2small}).inject(o.elements.container),o.options.modelEvents.publish({event:"ENXViews/Views/showInWidgetBody",data:{idView:"customize",title:e.attributesCustomization.apptitle,html:o.elements.container}})})},destroy:function(){for(var e=0;e<this.options.subscribeTokens.length;e++)this.options.modelEvents.unsubscribe(this.options.subscribeTokens[e]);this.options.toolbar.destroy(),this.options.grid.destroy(),this.options.grid=null,this._parent()},_buildBody:function(){this._buildIconBar(),this.elements.dgv=s.createElement("div",{class:this.getClassNames("-dgv")}).inject(this.elements.container),this.options.dgvOptions.columns.splice(4,1);var t=s.extend({identifier:"DataGridView-attrCusto-"+n.uid()},this.options.dgvOptions);t.layout=new p(this.options.dgvLayoutOptions);var o=this.options.grid=new u(t);o.onContextualEvent=function(){return[]},o.getCellTooltip=function(t){var i=this.options.grid.getColumnOrGroup(t.columnID).dataIndex;return t.dataIndex=i,-1===t.rowID?{shortHelp:e.attributesCustomization[i],updateModel:!1}:"tree"===i&&t.nodeModel&&!0!==t.nodeModel.getReferenceValue("isAdditionalColumn")?{shortHelp:e.replace(e.attributesCustomization.tooltipColName,{label:t.nodeModel.getLabel(),instRef:e.attributesCustomization[t.nodeModel.getReferenceValue("attrInstRef")]}),updateModel:!1}:void 0}.bind(this);var a={actionRemove:{stdTemplate:"functionIcon",semantics:{icon:{iconName:"trash",fontIconFamily:WUXManagedFontIcons.Font3DS}}},actionNotRemove:{stdTemplate:"functionIcon",semantics:{icon:{iconName:"block",fontIconFamily:WUXManagedFontIcons.Font3DS}}}},r={};r[e.attributesCustomization.pinLeft]="left",r[e.attributesCustomization.pinRight]="right",r[e.attributesCustomization.unpinned]="unpinned";var d={pin:{stdTemplate:"enumCombo",semantics:{possibleValues:r,valueType:"enumCustom"}}};o.getTypeRepresentationFactory().registerTypeRepresentations(JSON.stringify(d)),o.getTypeRepresentationFactory().registerTypeRepresentations(JSON.stringify(a));this.options.attrModel=new l({shouldBeSelected:function(e){return!0!==e.options.pinColumn}}),o.treeDocument=this.options.attrModel,o.getContent().addClassName("enxdatagridview"),o.getContent().inject(this.elements.dgv);var c=this;o.onReady(function(){o.addEventListener("change",c._cellModified.bind(c)),o.addEventListener("click",c._cellClicked.bind(c)),c.options.toolbar.show()}),this._addColumns(),this.options.attrModel.getXSO().onPostAdd(this._manageAttrSelection.bind(this)),this.options.attrModel.getXSO().onPostRemove(this._manageAttrSelection.bind(this)),this.options.attrModel.getXSO().onEmpty(this._manageAttrSelection.bind(this)),this.options.modelSubscribeTokens.push(this.options.attrModel.getModelEvents().subscribe({event:"addChild"},function(e){!0!==c._isMoving&&!0!==c._globalUpdate&&c.options.modelEvents.publish({event:"ENXViews/AttributesCustomization/columnModification",data:{what:"addRemoveColumns",addedColumns:[e.data.nodeModel.dump(i.dumpProp)]}})})),this.options.modelSubscribeTokens.push(this.options.attrModel.getModelEvents().subscribe({event:"removeChild"},function(e){if(!0!==c._isMoving&&!0!==c._globalUpdate){var t=e.data.nodeModel.getReferenceValue("attrName");if(-1!==i.specificColumns.indexOf(t)){if(!1===c.options.withDgv){var n=c.options.toolbar.getItem("specificColumns"),o=n.content.component;if(o)o.isSelected(t)&&o.toggleSelection(o.getItem(t));else{var s=n.content.options.items,a=!1,r=0,l=s.length;do{s[r].id===t?(s[r].selected=!1,a=!0):r++}while(!1===a&&r<l);c.options.toolbar.menu.updateItem(n)}}"thumbnail"===t&&c.elements.comboCompact.disabled(!1)}c.options.modelEvents.publish({event:"ENXViews/AttributesCustomization/columnModification",data:{what:"addRemoveColumns",removedColumns:[e.data.nodeModel.dump(i.dumpProp)]}})}})),this.elements.behavior=s.createElement("div",{class:this.getClassNames("-behavior")}).inject(this.elements.container)},_buildFooter:function(){var t=this,i=s.createElement("div",{class:t.getClassNames("-footer")}).inject(t.elements.container),n=new r({label:e.attributesCustomization.close,emphasize:"primary",touchMode:!0});n.addEventListener("click",function(){t._closePanel(),t.destroy()}),n.inject(i);var o=new r({label:e.attributesCustomization.reset,touchMode:!0});o.addEventListener("click",function(){t.options.modelEvents.publish({event:"ENXViews/AttributesCustomization/columnModification",data:{what:"reset",applyOnlyToThisApp:t.options.applyOnlyToThisApp}}),t.options.modelEvents.publish({event:"ENXViews/Views/showInWidgetBody",data:{restore:!0}}),t.destroy()}),o.inject(i)},_closePanel:function(){var e=[];this.options.attrModel.getRoots().forEach(function(t){e.push(t.dump(i.dumpProp))}),this.options.modelEvents.publish({event:"ENXViews/AttributesCustomization/columnModification",data:{what:"close",selectedTypes:this.options.selectedTypes,selectedExtensions:this.options.selectedExtensions,selectedAttributes:e,applyOnlyToThisApp:this.options.applyOnlyToThisApp}}),this.options.modelEvents.publish({event:"ENXViews/Views/showInWidgetBody",data:{restore:!0}})},_addColumns:function(){var e=this;void 0===this.options.appColumns?console.error("AttributesCustomization## Invalid input. Missing property appColumns"):e.options.attrModel.withTransactionUpdate(function(){e.options.appColumns.forEach(function(t){if("bi_color"!==t.dataIndex){var n=s.is(t.text,"string")&&t.text.length>0?t.text:e._retrieveColumnName(t.dataIndex),o=!(!t.customisation||!t.customisation.layout)&&t.customisation.layout.canBeGrouped,a=t.customisation&&t.customisation.layout?t.customisation.layout:null,r=void 0!==t.visibleFlag?t.visibleFlag:!t.isHidden,l=t.ds6wFrom&&"rel"===t.ds6wFrom?"Instance":"Reference";(t.isAdditionalColumn||"Thumbnail"===t.dataIndex)&&(l="AdditionalColumn"),-1!==["level","occurence","quantity","rollup"].indexOf(t.dataIndex)&&(l="CalculatedColumn"),!0===e.instanceMgt&&i.getAttributeIcons(l),"Instance"===l&&(n=`${n} (${h.instance})`);const d={dataIndex:t.dataIndex,label:n,attrName:t.ds6w||t.dataIndex,kind:t.kind,attrDim:t.attrDim,attrUnit:t.attrUnit,icons:null,attrInstRef:l,attrVisible:r,provider:t.provider,isAdditionalColumn:t.isAdditionalColumn,canBeGrouped:o,layout:a},{nature:c,userAccess:u,rangeValues:p,editable:m}=t;c&&(d.attrNature=c),u&&(d.attrUserAccess=u),p&&(d.attrRangeValue=p),d.attrEditable="boolean"==typeof m?m:null,d.attrSelectable=t.dbName?t.dbName:null;const b=i.createAttributeNode(d);b&&e.options.attrModel.addChild(b)}}),e.options.attrModel.expandAll()})},_cellModified:function(e,t){if(t&&t.nodeModel&&t.nodeModel.options.grid)switch(this.options.grid.layout.getDataIndexFromColumnIndex(t.columnID)){case"attrVisible":this.options.modelEvents.publish({event:"ENXViews/AttributesCustomization/columnModification",data:{what:"visibilityColumn",modifiedColumn:t.nodeModel.options.columnIndex,visibilityFlag:t.nodeModel.getReferenceValue("attrVisible")}});break;case"attrTitle":this.options.modelEvents.publish({event:"ENXViews/AttributesCustomization/columnModification",data:{what:"changeTitle",modifiedColumn:t.nodeModel.options.columnIndex,newTitle:t.nodeModel.getReferenceValue("attrTitle")}});break;case"exportContent":this.options.modelEvents.publish({event:"ENXViews/AttributesCustomization/columnModification",data:{what:"exportColumn",modifiedColumn:t.nodeModel.options.columnIndex,exportFlag:t.nodeModel.getReferenceValue("exportContent")}});break;case"pinContent":var i=this,n=t.nodeModel.getReferenceValue("attrName"),o=t.nodeModel.getReferenceValue("pinContent"),s=i.__locateFirstAndLastPin(o);i.options.attrModel.withTransactionUpdate(function(){i._globalUpdate=!0;var e=s.last?s.last._getLocalID?s.last._getLocalID():s.last._localID:i.options.getRoots().length-1;0===e&&(e=1),i.options.attrModel.addChild(t.nodeModel,e),t.nodeModel.select(),delete i._globalUpdate}),this.options.modelEvents.publish({event:"ENXViews/AttributesCustomization/columnModification",data:{what:"pinChange",modifiedColumn:n,pin:o}})}},_cellClicked:function(e,t){if(t&&t.nodeModel&&t.nodeModel.options.grid){if(!0===t.nodeModel.options.pinColumn)return;i.invokeActionByColumnID({columnID:this.options.grid.layout.getDataIndexFromColumnIndex(t.columnID),context:this,input:[t.nodeModel]})}},_retrieveColumnName:function(t){return e.attributesCustomization[t]?e.attributesCustomization[t]:t},_buildIconBar:function(){this.elements.toolbar=s.createElement("div",{class:this.getClassNames("-toolbar")}).inject(this.elements.container);var e=this,n={renderTo:this.elements.toolbar,multiSelect:!0,items:(e.options.toolbarActions||[]).map(function(t){return i.getToolbarActionView(t,e)||{}})};this.options.toolbar=new t(n),this.options.toolbar.elements.container.setStyle("display",void 0)},_manageAttrSelection:function(){var e=this.options.attrModel.getSelectedNodes(),t=["moveUp","moveDown","moveFirst","moveLast"],i=["remove","changeColor"],n=e.length,o=!1,s=0;for(s=0;s<n;s++)!0===e[s].options.grid.isAdditionalColumn||e[s].options.grid.layout&&!1===e[s].options.grid.layout.removable||(o=!0);if(0===n){for(s=0;s<t.length;s++)this.options.toolbar.disableItem(t[s]);for(s=0;s<i.length;s++)this.options.toolbar.disableItem(i[s])}else if(1===n){for(s=0;s<t.length;s++)this.options.toolbar.enableItem(t[s]);for(s=0;s<i.length;s++)"remove"===i[s]&&!1===o?this.options.toolbar.disableItem(i[s]):this.options.toolbar.enableItem(i[s])}else if(n>=1){for(s=0;s<t.length;s++)this.options.toolbar.disableItem(t[s]);for(s=0;s<i.length;s++)"remove"===i[s]&&!1===o?this.options.toolbar.disableItem(i[s]):this.options.toolbar.enableItem(i[s])}},_manageSpecificColumn:function(t,i){var n=this,o=!1,s=!0;"instanceName"===t&&(o=!0,s=!1);var a=["hide_show","instanceName","instanceMatrix","thumbnail"],r=e.attributesCustomization[t]?e.attributesCustomization[t]:t;if(!0===i){if("thumbnail"===t)this.elements.comboCompact.options.treedocument.getRoots()[0].select(!0),this.elements.comboCompact.disabled(!0);this.options.attrModel.withTransactionUpdate(function(){var e=-1!==a.indexOf(t),i=new d({columnIndex:t,label:r,grid:{attrTitle:r,attrVisible:!0,exportContent:o,exportLock:s,canBeGrouped:!1,attrRemove:!0,columnColor:{background_color:"#ffffff",color:"#000000"},attrName:t,hasTitle:e},modelEvents:n.options.modelEvents});n.options.attrModel.addChild(i)})}else{"thumbnail"===t&&this.elements.comboCompact.disabled(!1);var l=this.options.attrModel.search({match:function(e){return e.nodeModel.options.label===t||e.nodeModel.options.columnIndex===t}});this.options.attrModel.withTransactionUpdate(function(){for(var e=0;e<l.length;e++)n.options.attrModel.removeRoot(l[e])})}},_manageInstanceAttributes:function(t,i){var n=this;if(!0===i)this.options.attrModel.withTransactionUpdate(function(){var i=e.attributesCustomization[t]?e.attributesCustomization[t]:t;switch(t){case"instanceName":var o=new d({columnIndex:t,label:i,grid:{attrTitle:i,attrVisible:!0,exportContent:!0,exportLock:!1,canBeGrouped:!1,attrRemove:!0,columnColor:{background_color:"#ffffff",color:"#000000"},pinContent:"left",attrName:t,hasTitle:!0},modelEvents:n.options.modelEvents});(s=n.__locateFirstAndLastPin("right")).first?n.options.attrModel.insertBefore(o,s.first):n.options.attrModel.addChild(o);break;case"instanceMatrix":var s,a=new d({columnIndex:t,label:i,grid:{attrTitle:i,attrVisible:!0,exportContent:!0,exportLock:!1,canBeGrouped:!1,attrRemove:!0,columnColor:{background_color:"#ffffff",color:"#000000"},pinContent:"unpinned",attrName:t,hasTitle:!0},modelEvents:n.options.modelEvents});(s=n.__locateFirstAndLastPin("right")).first?n.options.attrModel.insertBefore(a,s.first):n.options.attrModel.addChild(a)}});else{var o=this.options.attrModel.search({match:function(e){return e.nodeModel.options.label===t||e.nodeModel.options.columnIndex===t}});this.options.attrModel.withTransactionUpdate(function(){for(var e=0;e<o.length;e++)n.options.attrModel.removeRoot(o[e])})}},_manageThumbnailAttribute:function(t,i){var n=this;if(!0===i)this.elements.comboCompact.disabled(!0),this.options.attrModel.withTransactionUpdate(function(){var i=e.attributesCustomization[t]?e.attributesCustomization[t]:t,o=new d({columnIndex:t,label:i,grid:{attrTitle:i,attrVisible:!0,exportContent:!1,exportLock:!0,canBeGrouped:!1,attrRemove:!0,columnColor:{background_color:"#ffffff",color:"#000000"},pinContent:"unpinned",attrName:t,hasTitle:!1},modelEvents:n.options.modelEvents}),s=n.__locateFirstAndLastPin("right");s.first?n.options.attrModel.insertBefore(o,s.first):n.options.attrModel.addChild(o)});else{this.elements.comboCompact.disabled(!1);var o=this.options.attrModel.search({match:function(e){return e.nodeModel.options.label===t||e.nodeModel.options.columnIndex===t}});this.options.attrModel.withTransactionUpdate(function(){for(var e=0;e<o.length;e++)n.options.attrModel.removeRoot(o[e])})}},__locateFirstAndLastPin:function(e){for(var t,i,n=this.options.attrModel.getRoots(),o=0;o<n.length&&(!t||!i);o++)n[o].getReferenceValue("pinContent")!==e||t?n[o].getReferenceValue("pinContent")!==e&&t&&(i=n[o-1]):t=n[o];return t&&!i&&(i=n[n.length-1]),{first:t,last:i}}})}),define("DS/ENOX3DSpaceAttributesMgt/views/actions/MoreAttributesHandler",["DS/ENOX3DSpaceAttributesMgt/views/AttributesCommons","DS/ENOX3DSpaceAttributesMgt/services/predicatesServices","i18n!DS/ENOX3DSpaceAttributesMgt/assets/nls/ENOXAttributesMgtNls.json"],(e,t,i)=>{return class{static execute(n){const{options:o}=n;require(["DS/ENOX3DSpaceAttributesMgt/views/private/MoreAttributesWizard","DS/PADServices/utils/AttributesMgt","i18n!DS/PADServices/assets/nls/PADServices.json"],(s,a,r)=>{const l=o.attrModel.getRoots().map(e=>{const t={name:e.getReferenceValue("attrName"),instRef:e.getReferenceValue("attrParent")},i=e.getReferenceValue("attrEditable");return"boolean"==typeof i&&(t.attrEditable=i,t.attrSelectable=e.getReferenceValue("attrSelectable")),t});let d=o.modelEvents.subscribe({event:"ENXViews/MoreAttributesWizard/selectedAttributes"},s=>{o.modelEvents.unsubscribe(d);const a=(o.attrModel.getRoots()||[]).map(e=>e.options.columnIndex);o.modelEvents.publish({event:"ENXViews/Views/showInWidgetBody",data:{restore:!0}}),o.modelEvents.publish({event:"ENXViews/Views/showInWidgetBody",data:{idView:"customize",html:n.elements.container,title:r.attributesCustomization.apptitle}}),o.selectedExtensions=s.selectedExtensions,o.selectedTypes=s.selectedTypes,n._globalUpdate=!0;const l=s.selectedAttributes.filter(e=>-1!==a.indexOf(e.dataIndex)||"ds6w:label"===e.dataIndex).map(e=>e.dataIndex),c=a.filter(e=>-1===l.indexOf(e)&&"tree"!==e),u=s.selectedAttributes.filter(e=>-1===a.indexOf(e.dataIndex)&&"ds6w:label"!==e.dataIndex),p=a.map(t=>o.attrModel.getRoots().find(e=>e.options.columnIndex===t).dump(e.dumpProp));s.selectedAttributes.filter(e=>{if(!Reflect.has(e,"attrEditable")||"boolean"!=typeof e.attrEditable)return!1;const{attrName:i}=e;if(t.isPredicateControlledByApplication(i,o.predicatesManagedByApplication))return!1;const{attrEditable:n,attrSelectable:s}=e,a=p.find(e=>e.ds6w===i);if(!a||!Reflect.has(a,"attrEditable")||"boolean"!=typeof a.attrEditable)return!1;const{attrEditable:r,attrSelectable:l}=a||{};return n!==r||s!==l}).forEach(e=>{const t=o.attrModel.getRoots().find(t=>t.options.columnIndex===e.attrName);t&&(Reflect.has(e,"attrEditable")&&"boolean"==typeof e.attrEditable&&(t.options.grid.attrEditable=e.attrEditable),Reflect.has(e,"attrSelectable")&&"string"==typeof e.attrSelectable&&(t.options.grid.attrSelectable=e.attrSelectable))});const m=[];c.forEach(t=>{const i=o.attrModel.search({match:e=>{let i=!1;return e.nodeModel.options.columnIndex===t&&!0!==e.nodeModel.options.grid.isAdditionalColumn&&"ds6w:type"!==t&&"Thumbnail"!==t&&"occurence"!==t&&"level"!==t&&"rollup"!==t&&"quantity"!==t&&(i=!0),i}});o.attrModel.withTransactionUpdate(()=>{i.forEach(t=>{o.attrModel.removeRoot(t),m.push(t.dump(e.dumpProp))})})});const h=[],b=[];u.forEach(t=>{let s=t.label;"Instance"===t.attrParent&&(s=`${s} (${i.instance})`);const a=e.createAttributeNode({dataIndex:t.dataIndex,label:s,attrName:t.attrName&&!t.attrName.endsWith("-Instance")?t.attrName:t.attrName.substring(0,t.attrName.length-"-Instance".length),kind:t.kind,attrDim:t.attrDim,attrUnit:t.attrUnit,icons:null,attrInstRef:t.attrParent,attrVisible:!0,isAdditionalColumn:!1,canBeGrouped:!1,attrSelectable:t.attrSelectable,attrNature:t.attrNature,attrUserAccess:t.attrUserAccess,attrRangeValue:t.attrRangeValue,attrEditable:t.attrEditable}),r=n.__locateFirstAndLastPin("right");r.first?o.attrModel.insertBefore(a,r.first):o.attrModel.addChild(a),a.select(),b.push(a)}),b.forEach(t=>h.push(t.dump(e.dumpProp))),(m.length||h.length)&&o.modelEvents.publish({event:"ENXViews/AttributesCustomization/columnModification",data:{what:"addRemoveColumns",selectedTypes:o.selectedTypes,selectedExtensions:o.selectedExtensions,removedColumns:m,addedColumns:h}}),delete n._globalUpdate});const c=o.modelEvents.subscribe({event:"ENXViews/MoreAttributesWizard/closeWizard"},()=>{o.modelEvents.publish({event:"ENXViews/Views/showInWidgetBody",data:{restore:!0}}),o.modelEvents.unsubscribe(c),o.modelEvents.publish({event:"ENXViews/Views/showInWidgetBody",data:{idView:"customize",html:n.elements.container,title:r.attributesCustomization.apptitle}})}),u=a.getDefaultTypesAndExtensions();new s({settingManager:o.settingManager,modelEvents:o.modelEvents,baseTypes:o.baseTypes,baseInstanceTypes:o.baseInstanceTypes,baseExtensions:o.baseExtensions,selectedTypes:o.selectedTypes,selectedExtensions:o.selectedExtensions,selectedAttributes:l,defaultTypes:u.defaultTypes,defaultExtensions:u.defaultExtensions,predicatesManagedByApplication:o.predicatesManagedByApplication,multiValuatedAttributes:o.multiValuatedAttributes})})}}}),define("DS/ENOX3DSpaceAttributesMgt/views/private/MoreAttributesWizard",["css!DS/PADServices/PADServices","UWA/Core","UWA/Controls/Abstract","DS/PADServices/utils/GlobalUtils","DS/PADServices/views/private/WizardSteps","text!DS/PADServices/assets/init/MoreAttrWizardSteps.json","DS/PADServices/views/private/SearchInput","DS/PADServices/views/private/Iconbar","DS/ENOX3DSpaceAttributesMgt/views/AttributesCommons","DS/PADServices/utils/DictionaryMgt","DS/Controls/Button","DS/Controls/Loader","DS/Tree/TreeDocument","DS/Tree/TreeNodeModel","DS/DataGridView/DataGridView","DS/DataGridView/DataGridViewLayout","DS/Utilities/Utils","DS/ENOX3DSpaceAttributesMgt/services/predicatesServices","DS/Notifications/NotificationsManagerUXMessages","DS/Notifications/NotificationsManagerViewOnScreen","i18n!DS/PADServices/assets/nls/PADServices.json","i18n!DS/ENOX3DSpaceAttributesMgt/assets/nls/ENOXAttributesMgtNls.json"],(e,t,i,n,o,s,a,r,l,d,c,u,p,m,h,b,f,g,v,w,A,y)=>{const C=JSON.parse(s),E={attributesView:"attributesView",typesView:"typesView",extensionsView:"extensionsView"},I=y.isCellEditableColumns.title,M=y.attributeForEditingColumns.title,V={properties:[function(){return{property:"dataIndex",value:this.options.grid.dataIndex}},function(){return{property:"attrName",value:this.options.grid.attrName}},function(){return{property:"attrParent",value:this.options.grid.attrParent}},function(){return{property:"attrDim",value:this.options.grid.attrDim}},function(){return{property:"attrUnit",value:this.options.grid.attrUnit}},function(){return{property:"label",value:this.options.label}},function(){return{property:"kind",value:this.options.grid.attrKind}},function(){return{property:"description",value:this.options.grid.attrDesc}},function(){return{property:"attrSelectable",value:this.options.grid.attrSelectable}},function(){return{property:"attrNature",value:this.options.grid.attrNature}},function(){return{property:"attrUserAccess",value:this.options.grid.attrUserAccess}},function(){return{property:"attrRangeValue",value:this.options.grid.attrRangeValue}},function(){return{property:"attrEditable",value:this.options.grid.attrEditable}}]};return w.setNotificationManager(v),i.extend({name:"more-attr",defaultOptions:{baseTypes:[],baseInstanceTypes:[],selectedTypes:[],automaticExtensions:[],selectedExtensions:[],selectedAttributes:[],defaultTypes:[],defaultExtensions:[],subscribeTokens:[],modelEvents:null,renderTo:null,steps:null,activeView:null,maps:{referenceTypes:[],instanceTypes:[]},views:{typesView:null,extensionsView:null,attributesView:null},toolbar:null,grids:{},models:{},dgvOptions:{defaultColumnDef:{width:"auto",typeRepresentation:"string"},showRowBorderFlag:!0,alternateBackgroundFlag:!1,columns:[{icon:{iconName:"check",fontIconFamily:1},dataIndex:"attrSel",typeRepresentation:"boolean",alwaysVisibleFlag:!0,width:40,resizableFlag:!1,editableFlag:!0,editionPolicy:"EditionInPlace",getCellEditableState:function(e){var t=!0;return e.nodeModel&&e.nodeModel.getReferenceValue("attrRO")&&(t=!1),t}},{dataIndex:"attrParent",editableFlag:!1,width:30,sortableFlag:!0,resizableFlag:!1,getCellTypeRepresentation:function(e){return e.nodeModel&&e.nodeModel.options.grid.attrParent?e.nodeModel.options.grid.attrParent:"Unknown"},getCellSemantics:function(e){if(e.nodeModel)return{disabled:!0}}},{dataIndex:"tree",text:A.moreAttributesWizard.attrTitle}]},dgvLayoutOptions:{cellHeight:26,columnHeaderHeight:38,rowsHeader:!1}},init:function(e){this._parent(e),this._realInit(e)},_realInit:async function(){const e=n.isWebInWinContext()?"-immersivePanelWebInWin":"-immersivePanel";this.elements.container=t.createElement("div",{class:this.getClassNames(e)}),this.instanceMgt=this.options.baseInstanceTypes&&this.options.baseInstanceTypes.length>0,await this._buildBody(),await this._buildFooter(),this.switchView(C.activeStep),this.options.subscribeTokens.push(this.options.modelEvents.subscribe({event:"ENXViews/WizardSteps/stepChanged"},e=>{const t=e.stepId;this.switchView(t)})),this.options.modelEvents.publish({event:"ENXViews/Views/showInWidgetBody",data:{restore:!0}}),this.options.modelEvents.publish({event:"ENXViews/Views/showInWidgetBody",data:{idView:"moreAttr",html:this.elements.container}})},destroy:function(){this.options.subscribeTokens.forEach(e=>this.options.modelEvents.unsubscribe(e)),this.options.toolbar.destroy(),Object.keys(this.options.grids).forEach(e=>{this.options.grids[e].destroy(),this.options.grids[e]=null}),this._parent()},_buildBody:function(){return new Promise(e=>{this.elements.wizard=t.createElement("div",{class:this.getClassNames("-wizard")}).inject(this.elements.container),this.options.wizard=new o({modelEvents:this.options.modelEvents,renderTo:this.elements.wizard,steps:C});const i=t.createElement("div",{class:this.getClassNames("-toolbar-container")}).inject(this.elements.container);this.elements.content=t.createElement("div",{class:this.getClassNames("-content")}).inject(this.elements.container),this._generateToolbar({renderTo:i}),e()})},_buildFooter:function(){return new Promise((e,i)=>{this.elements.footer=t.createElement("div",{class:this.getClassNames("-footer")}).inject(this.elements.container);const n=new c({label:A.moreAttributesWizard.next,value:"next",emphasize:"primary",touchMode:!0});this.elements.nextButton=n,n.addEventListener("click",()=>{if("typesView"===this.options.activeView)this.options.modelEvents.publish({event:"ENXViews/WizardSteps/changeStep",data:{stepId:"extensionsView"}});else if("extensionsView"===this.options.activeView)this.options.modelEvents.publish({event:"ENXViews/WizardSteps/changeStep",data:{stepId:"attributesView"}});else if("attributesView"===this.options.activeView){const e=this.options.models.attributesView.search({match:e=>!0===e.nodeModel.options.grid.attrSel}).map(e=>e.dump(V)),t=[].concat(this.options.selectedExtensions).concat(this.options.automaticExtensions);this.options.modelEvents.publish({event:"ENXViews/MoreAttributesWizard/selectedAttributes",data:{selectedAttributes:e,selectedTypes:this.options.selectedTypes,selectedExtensions:t}}),this.destroy()}}),n.inject(this.elements.footer);const o=new c({label:A.moreAttributesWizard.cancel,emphasize:"secondary",touchMode:!0});this.elements.closeButton=o,o.addEventListener("click",()=>{this.options.modelEvents.publish({event:"ENXViews/MoreAttributesWizard/closeWizard"}),this.destroy()}),o.inject(this.elements.footer),e()})},switchView:function(e){if(this.options.activeView!==e)if(this.elements.toolbarSearch.clear(),this.__setToolbarCmds(e),this.options.previousView=this.options.activeView,this.options.activeView=e,null===this.options.views[e]){const n=this.elements.content.getElement("div.more-attr-chooser-view");n&&this.elements.content.removeChild(n),t.is(this.elements.loader)||(this.elements.loaderDiv=t.createElement("div",{class:this.getClassNames("-loader")}).inject(this.elements.content),this.elements.loader=(new u).inject(this.elements.loaderDiv),this.elements.loader.getContent().addClassName("enx-loader")),this.elements.loaderDiv.removeClassName("hidden"),this.elements.loader.on();const o=[];let s=null,a=0,r=C.steps.length;do{C.steps[a].id===e&&(s=C.steps[a]),a++}while(a<r||null===s);if(s.prerequisiteViews)for(var i=0;i<s.prerequisiteViews.length;i++)null===this.options.views[s.prerequisiteViews[i]]&&o.push(this["_build"+s.prerequisiteViews[i]](!0));Promise.all(o).then(()=>{this["_build"+e]().then(e=>{this.elements.loaderDiv.addClassName("hidden"),this.elements.loader.off(),this.options.modelEvents.publish({event:"ENXViews/MoreAttributesWizard/viewReady",data:{activeView:this.options.activeView}})})})}else{const t=this.elements.content.getElements("div.more-attr-chooser-view");if(t&&Array.isArray(t)&&t.forEach(e=>{this.elements.content.removeChild(e)}),this.options.views[e].inject(this.elements.content),!0===this.typesUpdated&&"extensionsView"===this.options.activeView)this.__updateExtensionsView().then(()=>{delete this.typesUpdated,this.extensionsUpdated=!0,this.options.modelEvents.publish({event:"ENXViews/MoreAttributesWizard/viewReady",data:{activeView:this.options.activeView}})});else if(!0!==this.typesUpdated&&!0!==this.extensionsUpdated||"attributesView"!==this.options.activeView){this.options.grids[this.options.activeView].getContent().removeClassName("loading"),"extensionsView"===this.options.activeView||"typesView"===this.options.activeView?this.elements.nextButton.label=A.moreAttributesWizard.next:this.elements.nextButton.label=A.moreAttributesWizard.done,this.options.modelEvents.publish({event:"ENXViews/MoreAttributesWizard/viewReady",data:{activeView:this.options.activeView}})}else this.__updateAttributesView().then(()=>{delete this.typesUpdated,delete this.extensionsUpdated,this.options.modelEvents.publish({event:"ENXViews/MoreAttributesWizard/viewReady",data:{activeView:this.options.activeView}})})}},_buildtypesView:function(e){return new Promise((i,o)=>{this.elements.nextButton.label=A.moreAttributesWizard.next,this.elements.nextButton.disabled=!0,this.options.wizard.getContent().addClassName("disabled"),this.options.views.typesView=t.createElement("div",{class:this.getClassNames("-typesView more-attr-chooser-view")});const s=t.createElement("div",{class:this.getClassNames("-typesViewDgv more-attr-dgv-container")}).inject(this.options.views.typesView),a=t.extend({identifier:"MoreAttrWizard-"+n.uid()},t.clone(this.options.dgvOptions));a.layout=new b(this.options.dgvLayoutOptions);const r=this.options.grids.typesView=new h(a);this._declareInstRefTypeReps(r),r.onContextualEvent=(()=>[]),r.getCellTooltip=(e=>{const t=this.options.grids.typesView.getColumnOrGroup(e.columnID).dataIndex;if(e.dataIndex=t,-1===e.rowID)return{shortHelp:A.moreAttributesWizard[t],updateModel:!1}}),r.mandatorySelected=this.options.defaultTypes,this.options.models.typesView=new p({}),r.treeDocument=this.options.models.typesView,r.getContent().addClassName("enxdatagridview loading"),r.getContent().inject(s),this.options.views.typesView.inject(this.elements.content),r.onReady(()=>{this.__updateTypesViewModel().finally(()=>{!0!==e&&(r.getContent().removeClassName("loading"),this.elements.nextButton.disabled=!1,this.options.wizard.getContent().removeClassName("disabled")),i()}),r.addEventListener("change",this._changeType.bind(this))})})},_changeType:function(e,t){var i=this.options.grids[this.options.activeView];if(t&&t.nodeModel&&t.nodeModel.options.grid&&"attrSel"===i.layout.getDataIndexFromColumnIndex(t.columnID)){var n=t.nodeModel.getReferenceValue("attrName"),o=this.options.selectedTypes.indexOf(n);!0===t.nodeModel.options.grid.attrSel?-1===o&&this.options.selectedTypes.push(n):-1!==o&&this.options.selectedTypes.splice(o,1),this.typesUpdated=!0}},_buildextensionsView:function(e){var i=this;return new Promise(function(o,s){i.elements.nextButton.label=A.moreAttributesWizard.next,i.elements.nextButton.disabled=!0;i.options.wizard.getContent().addClassName("disabled"),i.options.views.extensionsView=t.createElement("div",{class:i.getClassNames("-extensionsView more-attr-chooser-view")});var a=t.createElement("div",{class:i.getClassNames("-extensionsView-Dgv more-attr-dgv-container")}).inject(i.options.views.extensionsView),r=t.extend({identifier:"MoreAttrWizard-"+n.uid()},t.clone(i.options.dgvOptions));r.layout=new b(i.options.dgvLayoutOptions);var l=i.options.grids.extensionsView=new h(r);i._declareInstRefTypeReps(l),l.onContextualEvent=function(){return[]},l.getCellTooltip=function(e){var t=i.options.grids.extensionsView.getColumnOrGroup(e.columnID).dataIndex;return e.dataIndex=t,-1===e.rowID?{shortHelp:A.moreAttributesWizard[t],updateModel:!1}:e.nodeModel?{shortHelp:A.replace(A.moreAttributesWizard.declaredInWithTypes,{types:e.nodeModel.getReferenceValue("attrInTypeNLS").join("\n")}),updateModel:!1}:void 0}.bind(this),l.mandatorySelected=i.options.defaultExtensions,i.options.models.extensionsView=new p({}),l.treeDocument=i.options.models.extensionsView,l.getContent().addClassName("enxdatagridview loading"),l.getContent().inject(a),i.options.views.extensionsView.inject(i.elements.content),l.onReady(function(){i.__updateExtensionsViewModel(!0).finally(function(){!0!==e&&(l.getContent().removeClassName("loading"),i.elements.nextButton.disabled=!1,i.options.wizard.getContent().removeClassName("disabled")),o({})}),l.addEventListener("change",i._changeExtension.bind(i))})})},_checkExtensionSelectionValidity:async function(e){if("ClassificationAttributes"===e){if(!await g.classificationExtensionProperties.isAvailable())throw v.addNotif({level:"error",title:"Classification",message:"Classification attributes are not available.\nPlease checks that ENOVIAIPClassificationFoundation (LBC) is present."}),new Error("Classification not valid env")}},_changeExtension:async function(e,t){const i=this.options.grids[this.options.activeView];if(t&&t.nodeModel&&t.nodeModel.options.grid&&"attrSel"===i.layout.getDataIndexFromColumnIndex(t.columnID)){const i=t.nodeModel.getReferenceValue("attrName");var n=this.options.selectedExtensions.indexOf(i);if(!0===t.nodeModel.options.grid.attrSel){if(-1===n)try{await this._checkExtensionSelectionValidity(i),this.options.selectedExtensions.push(i)}catch(e){t.nodeModel.prepareUpdate(),t.nodeModel.setAttribute("attrSel",!1),t.nodeModel.pushUpdate()}}else-1!==n&&this.options.selectedExtensions.splice(n,1);this.extensionsUpdated=!0}},buildAdditionalAttributesColumns:function(){const e=[{text:I,dataIndex:"attrEditable",typeRepresentation:"boolean",editableFlag:!1,width:150,sortableFlag:!1,resizableFlag:!0,editionPolicy:"EditionInPlace",getCellEditableState:function(e){if(!e||!e.nodeModel)return!1;if(e.nodeModel.getAttributeValue("attrIsAnAppPredicate"))return!1;const t=e.nodeModel.getAttributeValue("attrPredicate");return!(!t.isEditable&&!t.canBeForceForEdition)&&!(t.isEditable&&!t.forceEdition)},setCellValue:function(e,t){if(!e||!e.nodeModel)return;let i=null;if(t){const t=e.nodeModel.getAttributeValue("attrEditableSelectables");if(Array.isArray(t)&&t.length){const{value:n}=t[0];i=n,e.nodeModel.setAttribute("attrSelectable",i)}}else e.nodeModel.setAttribute("attrSelectable",null);e.nodeModel.getAttributeValue("attrPredicate").forceEditionWith=i,e.nodeModel.prepareUpdate(),e.nodeModel.setAttribute("attrEditable",t),e.nodeModel.pushUpdate()}},{text:M,dataIndex:"attrSelectable",typeRepresentation:"string",editableFlag:!1,width:350,sortableFlag:!1,resizableFlag:!0,editionPolicy:"EditionInPlace",getCellValue:function(e){if(!e||!e.nodeModel)return"";if(e.nodeModel.getAttributeValue("attrIsAnAppPredicate"))return"";if(!e.nodeModel.getAttributeValue("attrEditable"))return"";const t=e.nodeModel.getAttributeValue("attrPredicate");return t.isEditable&&!t.forceEdition?"":e.nodeModel.getAttributeValue("attrSelectable")},setCellValue:function(e,t){if(!e||!e.nodeModel)return"";e.nodeModel.getAttributeValue("attrPredicate").forceEditionWith=t,e.nodeModel.prepareUpdate(),e.nodeModel.options.grid.attrSelectable=t,e.nodeModel.pushUpdate()},getCellEditableState:function(e){if(!e||!e.nodeModel)return!1;return!e.nodeModel.getAttributeValue("attrIsAnAppPredicate")&&(!!e.nodeModel.getAttributeValue("attrEditable")&&!!e.nodeModel.getAttributeValue("attrSelectablesEnum"))},getCellTypeRepresentation:function(e){if(!e||!e.nodeModel)return"string";return e.nodeModel.getAttributeValue("attrIsAnAppPredicate")?"string":e.nodeModel.getAttributeValue("attrEditable")&&e.nodeModel.getAttributeValue("attrSelectablesEnum")||"string"}}];return(()=>!(!t.is(localStorage)||!t.is(localStorage.getItem("XEN_MoreAttr_Debug")))&&"true"===localStorage.getItem("XEN_MoreAttr_Debug"))()&&(e.push({text:"is App Controlled",dataIndex:"isAppCtr",typeRepresentation:"boolean",editableFlag:!1,width:100,sortableFlag:!1,resizableFlag:!0,getCellValue:function(e){if(!e||!e.nodeModel)return"";return e.nodeModel.getAttributeValue("attrIsAnAppPredicate")}}),e.push({text:"is Attribute",dataIndex:"isAttribute",typeRepresentation:"string",editableFlag:!1,width:100,sortableFlag:!1,resizableFlag:!0,getCellValue:function(e){if(!e||!e.nodeModel)return"";if(e.nodeModel.getAttributeValue("attrIsAnAppPredicate"))return"";const t=e.nodeModel.getAttributeValue("attrPredicate");return`${"attribute"===t.nature} [${t.nature}]`}}),e.push({text:"is Mapped",dataIndex:"isMapped",typeRepresentation:"string",editableFlag:!1,width:100,sortableFlag:!1,resizableFlag:!0,getCellValue:function(e){if(!e||!e.nodeModel)return"";if(e.nodeModel.getAttributeValue("attrIsAnAppPredicate"))return"";const t=e.nodeModel.getAttributeValue("attrPredicate"),i=g.isAGeneratedPredicate(t.uri),n=`[${i?"":t.uri}]`;return`${!1===i} ${i?"":n}`}}),e.push({text:"is MultiAttribute (total - editable)",dataIndex:"isMultiAttr",typeRepresentation:"string",editableFlag:!1,width:180,sortableFlag:!1,resizableFlag:!0,getCellValue:function(e){if(!e||!e.nodeModel)return"";if(e.nodeModel.getAttributeValue("attrIsAnAppPredicate"))return"";const t=e.nodeModel.getAttributeValue("attrPredicate"),i=t.getSelectables(g.isAPredicateForEdition).length;return`${t.isAMultiPredicate}(${t.predicates.length} - ${i})`}}),e.push({text:"is UserWritable",dataIndex:"isUserWritable",typeRepresentation:"string",editableFlag:!1,width:100,sortableFlag:!1,resizableFlag:!0,getCellValue:function(e){if(!e||!e.nodeModel)return"";if(e.nodeModel.getAttributeValue("attrIsAnAppPredicate"))return"";const t=e.nodeModel.getAttributeValue("attrPredicate"),i=t.userAccess?`[${t.userAccess}]`:"";return`${g.canBeEdited(t.userAccess)} ${i}`}}),e.push({text:"is MultiValuated",dataIndex:"isMultiValuated",typeRepresentation:"string",editableFlag:!1,width:100,sortableFlag:!1,resizableFlag:!0,getCellValue:function(e){if(!e||!e.nodeModel)return"";return e.nodeModel.getAttributeValue("attrIsAnAppPredicate")?"":e.nodeModel.getAttributeValue("attrPredicate").multiValuated}})),e},_buildattributesView:function(e){const{predicatesManagedByApplication:i}=this.options;var o=this;return new Promise(i=>{o.elements.nextButton.label=A.moreAttributesWizard.done,o.elements.nextButton.disabled=!0;o.options.wizard.getContent().addClassName("disabled"),o.options.views.attributesView=t.createElement("div",{class:o.getClassNames("-attributesView more-attr-chooser-view")});var s=t.createElement("div",{class:o.getClassNames("-attributesView-Dgv more-attr-dgv-container")}).inject(o.options.views.attributesView),a=t.extend({identifier:"MoreAttrWizard-"+n.uid()},t.clone(o.options.dgvOptions));let r=null;a.columns.push(...o.buildAdditionalAttributesColumns()),a.layout=new b(o.options.dgvLayoutOptions),(r=o.options.grids.attributesView=new h(a)).onContextualEvent=function(){return[]},r.getCellTooltip=function(e){var t=o.options.grids.attributesView.getColumnOrGroup(e.columnID).dataIndex;if(e.dataIndex=t,-1===e.rowID)return{shortHelp:A.moreAttributesWizard[t],updateModel:!1};if(e.nodeModel){var i=e.nodeModel.getReferenceValue("attrInTypeNLS");return{shortHelp:A.replace(A.moreAttributesWizard.declaredInWithTypes,{types:i?i.join("\n"):""}),updateModel:!1}}}.bind(this),r.mandatorySelectedWithParent={Reference:["ds6w:label","ds6w:type"]},o.options.models.attributesView=new p({}),r.treeDocument=o.options.models.attributesView,r.getContent().addClassName("enxdatagridview loading"),r.getContent().inject(s),o.options.views.attributesView.inject(o.elements.content),r.onReady(function(){var t=[];void 0===o.options.grids.extensionsView&&t.push(o._buildextensionsView(!0)),Promise.all(t).then(o.__updateAttributesViewModel.bind(o)).finally(function(){!0!==e&&(r.getContent().removeClassName("loading"),o.elements.nextButton.disabled=!1,o.options.wizard.getContent().removeClassName("disabled")),i()}),r.addEventListener("change",o._changeAttributes.bind(o))})})},_changeAttributes:function(e,t){var i=this.options.grids[this.options.activeView];if(t&&t.nodeModel&&t.nodeModel.options.grid)if("attrSel"===i.layout.getDataIndexFromColumnIndex(t.columnID)){var n=this.options.selectedAttributes.indexOf(t.nodeModel.getLabel());if(!0===t.nodeModel.options.grid.attrSel){if(-1===n){const e={name:t.nodeModel.getReferenceValue("attrName"),instRef:t.nodeModel.getReferenceValue("attrParent")},i=t.nodeModel.getReferenceValue("attrEditable");"boolean"==typeof i&&(e.attrEditable=i,e.attrSelectable=t.nodeModel.getReferenceValue("attrSelectable")),this.options.selectedAttributes.push(e)}}else-1!==n&&this.options.selectedAttributes.splice(n,1)}else if("attrEditable"===i.layout.getDataIndexFromColumnIndex(t.columnID)){if(!0===t.nodeModel.options.grid.attrSel){const e=this.options.selectedAttributes.findIndex(e=>e.name===t.nodeModel.getReferenceValue("attrName"));this.options.selectedAttributes[e].attrEditable=t.nodeModel._options.grid.attrEditable}}else if("attrSelectable"===i.layout.getDataIndexFromColumnIndex(t.columnID)&&!0===t.nodeModel.options.grid.attrSel){const e=this.options.selectedAttributes.findIndex(e=>e.name===t.nodeModel.getReferenceValue("attrName"));this.options.selectedAttributes[e].attrSelectable=t.nodeModel._options.grid.attrSelectable}},_generateToolbar:function(e){var i=this,n=f.debounce(function(e){i.options.models[i.options.activeView].withTransactionUpdate(function(){var t=e.searchStr,n=!0;i.options.filterInProgress=!0,i.options.models[i.options.activeView].search({match:function(e){(function(e,t){var i=!1,n=new RegExp(e,"i");return(n.test(t.nodeModel.options.grid.attrTitle)||n.test(t.nodeModel.getLabel()))&&(i=!0),i})(t,e)&&i._isNodeVisible(e.nodeModel)?(e.nodeModel.show(),t.length>0&&n?(e.nodeModel.select(!0),e.nodeModel.matchSearch(),n=!1):(e.nodeModel.unmatchSearch(),e.nodeModel.unselect())):(e.nodeModel.unmatchSearch(),e.nodeModel.unselect(),e.nodeModel.hide())}}),i.options.filterInProgress=!1}),i.options.models[i.options.activeView].getXSO().onPostAdd(function(){}),i.options.models[i.options.activeView].getXSO().onPostRemove(function(){})},500);this.elements.toolbar=t.createElement("div",{class:this.getClassNames("-toolbar")}).inject(e.renderTo);var o=t.createElement("div",{class:this.getClassNames("-toolbar-input")}).inject(this.elements.toolbar);this.elements.toolbarIconbar=t.createElement("div",{class:this.getClassNames("-toolbar-iconbar")}).inject(this.elements.toolbar);o.addEventListener("touchstart",function(e){e.target.style.fontSize="16px"},!1),o.addEventListener("mouseleave",function(e){e.target.style.fontSize="14px"},!1),this.elements.toolbarSearch=new a({events:{onSearch:n}}).inject(o)},_isNodeVisible:function(e){switch(this.currentSelectFilter+"-"+this.currentInstRefFilter){case"none-none":return!0;case"selected-none":return!0===e.getReferenceValue("attrSel");case"unselected-none":return!1===e.getReferenceValue("attrSel");case"none-reference":return"Instance"!==e.getReferenceValue("attrParent");case"none-instance":return"Reference"!==e.getReferenceValue("attrParent");case"selected-reference":return!0===e.getReferenceValue("attrSel")&&"Instance"!==e.getReferenceValue("attrParent");case"selected-instance":return!0===e.getReferenceValue("attrSel")&&"Reference"!==e.getReferenceValue("attrParent");case"unselected-reference":return!1===e.getReferenceValue("attrSel")&&"Instance"!==e.getReferenceValue("attrParent");case"unselected-instance":return!1===e.getReferenceValue("attrSel")&&"Reference"!==e.getReferenceValue("attrParent")}return!0},__setToolbarCmds:function(e){var t=this;this.currentSelectFilter="none",this.currentInstRefFilter="none";var i,n=function(){t.options.models[t.options.activeView].withTransactionUpdate(function(){for(var e=t.options.models[t.options.activeView].getRoots(),i=(t.currentSelectFilter,t.currentInstRefFilter,0);i<e.length;i++){t._isNodeVisible(e[i])?e[i].show():e[i].hide()}}),t.options.models[t.options.activeView].getXSO().onPostAdd(function(){}),t.options.models[t.options.activeView].getXSO().onPostRemove(function(){})},o=(A.replace(A.moreAttributesWizard.reload,{what:A.moreAttributesWizard.availableTypes}),A.replace(A.moreAttributesWizard.reload,{what:A.moreAttributesWizard.availableExtensions}),A.replace(A.moreAttributesWizard.reload,{what:A.moreAttributesWizard.availableAttributes}),{fonticon:"tag-active",text:A.moreAttributesWizard.filterRowsKind,name:"filter-kind",content:{type:"dropdownmenu",options:{items:[{fonticon:"block",text:A.moreAttributesWizard.none,name:"none",selectable:!0,selected:!0},{fonticon:"product",text:A.moreAttributesWizard.filterreference,name:"reference",selectable:!0},{fonticon:"flow-cascade",text:A.moreAttributesWizard.filterinstance,name:"instance",selectable:!0}],events:{onClick:function(e,i){var o;o=i.name,t.currentInstRefFilter=o,n()}}}}}),s={fonticon:"filter",text:A.moreAttributesWizard.filterRows,name:"filter",content:{type:"dropdownmenu",options:{items:[{fonticon:"block",text:A.moreAttributesWizard.none,name:"none",selectable:!0,selected:!0},{fonticon:"checkbox-on",text:A.moreAttributesWizard.selected,name:"selected",selectable:!0},{fonticon:"checkbox-off",text:A.moreAttributesWizard.unselected,name:"unselected",selectable:!0}],events:{onClick:function(e,i){var o;o=i.name,t.currentSelectFilter=o,n()}}}}};if(!this.options.toolbar||this.options.toolbar.currentView!==e){if(!0===this.instanceMgt)switch(e){case"typesView":case"extensionsView":case"attributesView":i=[o,s]}else i=[{className:"divider"},s];var a={renderTo:this.elements.toolbarIconbar,items:i};this.options.toolbar&&(this.options.toolbar.destroy(),this.options.toolbar=null),this.options.toolbar=new r(a),this.options.toolbar.elements.container.setStyle("display",void 0)}},_declareInstRefTypeReps:function(e){var t={Reference:{stdTemplate:"functionIcon",semantics:{icon:{iconName:"product",fontIconFamily:WUXManagedFontIcons.Font3DS}}},Instance:{stdTemplate:"functionIcon",semantics:{icon:{iconName:"flow-cascade",fontIconFamily:WUXManagedFontIcons.Font3DS}}},Both:{stdTemplate:"functionIcon",semantics:{icon:{iconName:"part-replace",fontIconFamily:WUXManagedFontIcons.Font3DS}}},Extension:{stdTemplate:"functionIcon",semantics:{icon:{iconName:"part-add",fontIconFamily:WUXManagedFontIcons.Font3DS}}},Unknown:{stdTemplate:"functionIcon",semantics:{icon:{iconName:"i-question",fontIconFamily:WUXManagedFontIcons.Font3DS}}}};e.getTypeRepresentationFactory().registerTypeRepresentations(JSON.stringify(t))},_checkSelected:function(e,t){const i=this.options.selectedAttributes.filter(i=>i.name===e&&i.instRef===t);return i.length>1&&console.warn("Several attributes found "+JSON.stringify(i)),1===i.length?i[0]:null},__updateTypesViewModel:async function(e){const t=this.options.baseInstanceTypes.length?this.options.baseTypes.concat(this.options.baseInstanceTypes):this.options.baseTypes,i=await d.getTypesInfo({baseTypes:t},e);this.typesInfos=i,Reflect.ownKeys(i).forEach(e=>{const t=i[e],n=-1!==this.options.selectedTypes.indexOf(e),o=t.parent||e,s=-1!==this.options.baseTypes.indexOf(o)?"Reference":-1!==this.options.baseInstanceTypes.indexOf(o)?"Instance":"Unknown",a=new m({label:t.displayName,grid:{attrName:e,attrTitle:t.displayName,attrSel:n,attrParent:s},icons:[t.iconUrl]});this.options.models.typesView.addRoot(a,n?0:void 0);let r=null;switch(s){case"Reference":r=this.options.maps.referenceTypes;break;case"Instance":r=this.options.maps.instanceTypes;break;default:r=null}r&&-1===r.indexOf(e)&&r.push(e)})},__updateExtensionsView:async function(){this.elements.loader.on(),this.elements.loaderDiv.removeClassName("hidden"),this.options.grids.extensionsView.getContent().addClassName("loading"),this.elements.nextButton.disabled=!0,this.options.wizard.getContent().addClassName("disabled"),this.options.models.extensionsView.removeRoots(),await this.__updateExtensionsViewModel(!0),this.elements.loader.off(),this.options.grids.extensionsView.getContent().removeClassName("loading"),this.elements.nextButton.disabled=!1,this.options.wizard.getContent().removeClassName("disabled")},__updateExtensionsViewModel:async function(e){const t=await d.interfaces({onlyCustomer:!1,classes:this.options.selectedTypes},e);Array.isArray(this.options.baseExtensions)&&this.options.baseExtensions.forEach(e=>{t.extensions[e.name]||(t.extensions[e.name]=e)});const i=g.classificationExtensionProperties;t.extensions[i.name]=i,Reflect.ownKeys(t.extensions).forEach(e=>{const i=t.extensions[e],n=-1!==this.options.selectedExtensions.indexOf(e);let o=!1,s=!1,a=[];i.declareIn.forEach(e=>{if(-1!==this.options.baseTypes.indexOf(e))o=!0;else if(-1!==this.options.baseInstanceTypes.indexOf(e))s=!0;else if(this.typesInfos&&Reflect.has(this.typesInfos,e)){const{parent:t}=this.typesInfos[e]||{};"string"==typeof t&&0!=t.trim().length&&(-1!==this.options.baseTypes.indexOf(t)?o=!0:-1!==this.options.baseInstanceTypes.indexOf(t)&&(s=!0))}a.push(d.getNLSForTypes(e))});let r="";r=!0===o&&!0===s?"Both":!0===o?"Reference":!0===s?"Instance":"Unknown";const l=new m({label:i.nlsName,grid:{attrName:e,attrTitle:i.nlsName,attrSel:n,attrInType:i.declareIn,attrInTypeNLS:a,attrParent:r}});this.options.models.extensionsView.addRoot(l,n?0:void 0)});const n=Reflect.ownKeys(t.automaticExtensions);this.options.automaticExtensions.push(...n)},__updateAttributesView:async function(){this.elements.loader.on(),this.elements.loaderDiv.removeClassName("hidden"),this.options.grids.attributesView.getContent().addClassName("loading"),this.elements.nextButton.disabled=!0,this.elements.nextButton.label=A.moreAttributesWizard.done,this.options.wizard.getContent().addClassName("disabled"),this.options.models.attributesView.removeRoots(),await this.__updateAttributesViewModel(!0),this.elements.loader.off(),this.options.grids.attributesView.getContent().removeClassName("loading"),this.elements.nextButton.disabled=!1,this.options.wizard.getContent().removeClassName("disabled")},computeCustomTypeNameFromAttrName:function(e){return`${e.replace(/[^a-zA-Z0-9 ]/g,"")}Enum_${Date.now()}`},__updateAttributesViewModel:async function(e){const{automaticExtensions:t,selectedExtensions:i,selectedTypes:n,predicatesManagedByApplication:o,multiValuatedAttributes:s}=this.options,a=[].concat(t).concat(i).concat(n);let r=[],l=null;try{const e=await g.getPropertiesForClasses(a,this.options);r=g.getAttributePredicatesFromClassPredicates(e,o,s),l=await this.getSelectablesNlsForEditablePredicates(r,this.options)}catch(e){console.log("error with predicatesServices fetching class attributes")}const d=[];r.forEach(e=>{const{uri:t}=e;if(-1!==d.indexOf(t))return;const i=this.computeParentInfos(e),{attrParent:n}=i;try{if("Both"===n){const n=this.buildAnAttributeTreeModelNode(t,e,i,"Instance",l);this.addATreeModelNodeInView(n,E.attributesView),d.push(n.getReferenceValue("dataIndex"));const o=this.buildAnAttributeTreeModelNode(t,e,i,"Reference",l);this.addATreeModelNodeInView(o,E.attributesView),d.push(o.getReferenceValue("dataIndex"))}else{const o=this.buildAnAttributeTreeModelNode(t,e,i,n,l);this.addATreeModelNodeInView(o,E.attributesView),d.push(o.getReferenceValue("dataIndex"))}}catch(e){console.log("error with attribute node attributes")}})},async getSelectablesNlsForEditablePredicates(e,t){if(!Array.isArray(e)||!t)throw new Error("invalid inputs");const i=e.reduce((e,t)=>{const i=t.getSelectables(g.isAPredicateForEdition);return Array.isArray(i)&&i.length&&e.push(...i),e},[]);return await g.getNLSPropertiesForClass(i,t)},buildAnAttributeTreeModelNode(e,t,i,n,o){if(!e||!t||!i)throw new Error("invalid node inputs");if("Reference"!==n&&"Instance"!==n)throw new Error("invalid parent type");const s=this._checkSelected(e,n),a=!!s;let{isEditable:r,selectable:l,isAnAppPredicate:d}=t;s&&"boolean"==typeof s.attrEditable&&null!==s.attrSelectable&&(r=s.attrEditable,l=s.attrSelectable);const c=t.getSelectables(g.isAPredicateForEdition);if(a&&l&&r){if(-1!==c.indexOf(l))r!==t.isEditable&&(t.forceEditionWith=l);else{t.findPredicateInfo(e=>e.selectable===l)?(r=t.isEditable,l=t.selectable):c.splice(0,0,l)}}const u={label:t.label,grid:{attrName:e,dataIndex:"Instance"===n?`${e}-Instance`:e,attrSel:a,attrRO:a,attrParent:n,attrInType:"Instance"===n?i.attrInTypeInst:i.attrInTypeRef,attrInTypeNLS:"Instance"===n?i.attrInTypeInstNLS:i.attrInTypeRefNLS,attrDim:t.dimension,attrUnit:t.manipulationUnit,attrTitle:t.label,attrDesc:t.description,attrKind:t.dataType,attrSelectable:r?l:null,attrNature:t.nature,attrUserAccess:t.userAccess,attrRangeValue:t.rangeValues,attrEditable:r,attrPredicate:t,attrIsAnAppPredicate:d}};if(c.length){let t=null;if(c.length>1){t=c.map(e=>{const{label:t}=o[e]||{};return{value:e,label:t||e}});const i=this.registerSelectablesTypeEnumForAttribute(e,t);i&&(u.grid.attrSelectablesEnum=i)}else{const[e]=c,{label:i}=o[e]||{};t=[{value:e,label:i||e}]}Array.isArray(t)&&(u.grid.attrEditableSelectables=t)}return new m(u)},registerSelectablesTypeEnumForAttribute(e,t){if(!e||!Array.isArray(t))return;const i=this.computeCustomTypeNameFromAttrName(e),n={};return n[i]={stdTemplate:"enumCombo",semantics:{valueType:"enumString",possibleValues:t}},this.options.grids[this.options.activeView].getTypeRepresentationFactory().registerTypeRepresentations(n),i},addATreeModelNodeInView(e,t){if(!e)throw new Error("invalid node");if(!E[t])throw new Error("unknow view type");if(!this.options.models[t])throw new Error("invalid view");const{attrSel:i}=e;this.options.models[t].addRoot(e,i?0:void 0)},computeParentInfos(e){let t="",i=!1,n=!1,o=!1,s=[],a=[],r=[],l=[];const{inTypes:c}=e||{};return Array.isArray(c)?(c.forEach(e=>{const t=e.substring(e.indexOf(":")+1,e.length);let c=null;if(-1!==this.options.baseTypes.indexOf(t))i=!0;else if(-1!==this.options.baseInstanceTypes.indexOf(t))n=!0;else if((-1!==this.options.selectedExtensions.indexOf(t)||-1!==this.options.automaticExtensions.indexOf(t))&&(o=!0,(c=this.options.models.extensionsView.search({match:e=>e.nodeModel.getReferenceValue("attrName")===t})).length)){const e=c[0].getReferenceValue("attrParent");"Reference"===e?i=!0:"Instance"===e?n=!0:"Both"===e&&(i=!0,n=!0)}if("XP_VPMReference_Ext"!==t&&"DELFmiContQuantity_Mass"!==t&&"DELFmiContQuantity_Volume"!==t||(i=!0,s.push("VPMReference"),a.push(d.getNLSForTypes("VPMReference"))),"ClassificationAttributes"===t&&(i=!0,s.push("VPMReference"),a.push(d.getNLSForTypes("VPMReference"))),-1!==this.options.maps.referenceTypes.indexOf(t)&&(i=!0,s.push(t),a.push(d.getNLSForTypes(e))),-1!==this.options.maps.instanceTypes.indexOf(t)&&(n=!0,r.push(t),l.push(d.getNLSForTypes(e))),o&&Array.isArray(c)&&c.length>0){var u=c[0],p=Array.isArray(u.options.grid.attrInType)?u.options.grid.attrInType[0]:"";-1!==this.options.maps.referenceTypes.indexOf(p)&&(i=!0,s.push(p),a.push(d.getNLSForTypes(e))),-1!==this.options.maps.instanceTypes.indexOf(p)&&(n=!0,r.push(p),l.push(d.getNLSForTypes(e)))}}),{attrParent:t=!0===i&&!0===n?"Both":!0===i?"Reference":!0===n?"Instance":!0===o?"Extension":"Both",declaredInRef:i,declaredInInst:n,declaredInExt:o,attrInTypeRef:s,attrInTypeRefNLS:a,attrInTypeInst:r,attrInTypeInstNLS:l}):{attrParent:t,declaredInRef:i,declaredInInst:n,declaredInExt:o,attrInTypeRef:s,attrInTypeRefNLS:a,attrInTypeInst:r,attrInTypeInstNLS:l}}})});