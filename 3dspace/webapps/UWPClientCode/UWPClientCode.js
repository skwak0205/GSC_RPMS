define("DS/UWPClientCode/SEO",function(){"use strict";return{setTitle:function(e){document.title=e},setDescription:function(e){document.querySelector('meta[name="description"]').setAttribute("content",e)}}}),define("DS/UWPClientCode/UWPClientCode",[],function(){}),function(e){"use strict";define("DS/UWPClientCode/DebugMe",function(){var t=!(!e.UWA||!e.UWA.debug);return{setEnabled:function(e){return t!==e&&(t=e),t},isEnabled:function(){return t}}})}(this),define("DS/UWPClientCode/UWA/Element",["UWA/Core","UWA/Element","DS/UIKIT/Mask"],function(e,t,n){"use strict";return e.extend(t,{mask:function(e){n.mask(this,e)},unmask:function(){n.unmask(this)},isMasked:function(){n.isMasked(this)}})}),define("DS/UWPClientCode/I18n",["UWA/Core","UWA/Utils","i18n!DS/UWPClientCode/assets/nls/I18n/i18n"],function(e,t,n){"use strict";var i,r,o,s,a,c,l,u,d,p={},f={},m=(c=t.parseUrl(window.location).domain,l="",u="",/^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])$/g.test(c)||"localhost"===c||(o=c.split("."),l=o[o.length-2]+"."+o[o.length-1],o.length>2&&o.shift(),u=o.join(".")),s=function(t,n,i){e.log("Setting lang cookie (swymlang) to "+t+" on domain "+n),document.cookie="swymlang="+encodeURIComponent(t)+"; domain="+n+"; path=/; expires="+i.toGMTString()},a=function(){return document.cookie.indexOf("swymlang")!==document.cookie.lastIndexOf("swymlang")},function(e){var t=new Date;t.setTime(t.getTime()+2592e6),s(e,u,t),a()&&s("",l,new Date(0))});return i={getCurrentLanguage:function(){return r},setCurrentLanguage:function(t,n){var i=(t||"").trim();e.is(p[i])||(i="en"),r===i||n||(m(i),window.location.reload()),r=i},getSupportedLanguages:function(){return p},getDebugLanguages:function(){return f},replace:function(e,t){return e.replace(/\{([\w-]+)\}/g,function(e,n){return void 0!==t[n]?t[n]:""})}},d=require("i18n"),p=d.getSupportedLanguages(),Object.keys(p).forEach(function(e){var t=p[e];t.localizedName=n[t.shortName]}),e.debug&&(f=d.getDebugLanguages(),Object.keys(f).forEach(function(e){var t=f[e];t.localizedName=t.staticName}),e.merge(p,f)),i.setCurrentLanguage(d.getLocale(),!0),i}),define("DS/UWPClientCode/PublicAPI",["UWA/Core","UWA/Promise","UWA/Utils","DS/PubSub/PubSub",["DS","WAFData","WAFData"].join("/"),"DS/UWPClientCode/Data","DS/UWPClientCode/Data/ApplicationConfiguration","DS/UWPClientCode/Data/User","DS/UWPClientCode/Data/Context","DS/UWPClientCode/Data/Widgets","DS/UWPClientCode/Data/CommentMedia","DS/UWPClientCode/Data/Notification","DS/UWPClientCode/Data/Dashboard"],function(e,t,n,i,r,o,s,a,c,l,u,d,p){"use strict";var f="USER",m="GROUP",g=function(t,n,i,r){e.is(t,"function")&&(r?setTimeout(function(){t.apply(n,i)}):t.apply(n,i))};function h(e,t){var n=[e,t];return n.indexOf("OWNER")>=0?"OWNER":n.indexOf("CONTRIBUTOR")>=0?"CONTRIBUTOR":"READER"}var v=function(t,n){var i={};t&&t.forEach(function(e,t){i[e.id]={index:t,active:e.active,role:e.role,shareAccesses:e.shareAccesses}}),n.forEach(function(r,o){var s,a,c,l=i[r.id];l?(r.active=l.active,r.role=h(r.role,l.role),r.owner="owner"===r.role.toLowerCase(),r.shareAccesses=(s=l.shareAccesses,a=(a=r.shareAccesses)||[],(s=s||[]).length?a.length?(c=e.clone(s),a.forEach(function(t){var n;s.forEach(function(e,i){(e.type===f||e.type===m&&t.contextAccessId===e.contextAccessId)&&(n=i)}),e.is(n,"number")?c[n]=t:c.push(t)}),c):s:a),t[l.index]=r,n[o]=r):t.push(r)})},C=function(e,t){var n=e.success;e.success=function(){var i=x._getContext(e.id,e.type);i.membersCount=i.membersCount+("set"===t?1:-1),n&&n.call(e.scope,i)},c[t+"Acl"](e)};function U(e){var n=this,i=e.modelId,r=e.type,o=null!==e.deletionDate?e.deletionDate||Date.now():null;return new t(function(t,s){c.setDeletionDate({serviceName:e.serviceName,serviceUrl:e.serviceUrl,prefixUrl:e.prefixUrl,modelId:i,type:r,deletionDate:o,success:function(){var n=x._getContext(e.modelId,e.type);n.deletionDate=o,t(n)}.bind(n),failure:s})})}function y(e){var t=n.parseUrl(e).domain.split(".")[0]||"";return[{substr:"-ifweloop-",newSubstr:"-"}].forEach(function(e){t=t.replace(e.substr,e.newSubstr)}),t.split("-")}var x={events:{contextChange:"ContextChange",contextAdd:"ContextAdd",isEditionPossible:"IsEditionPossible",editionModeChanged:"EditionModeChanged",userRefreshed:"UserRefreshed"},callbacks:{addWidget:function(e,t,n){t()},loadExternalWidget:function(e,t){t()},beforeWidgetLaunch:function(e){},consistencyCheckFailure:function(){}},applicationConfigurations:[],widgetConfigurations:[],user:{properties:{}},contexts:null,_sandboxPlatformId:void 0,_initUserContexts:function(e){(e=e||[]).forEach(function(e){e.shareAccesses=[{type:f,role:e.role||"OWNER"}]}),x.contexts=e},_setUser:function(t){t=e.clone(t),x.user=e.extend({properties:{}},t)},_initSandbox:function(){var e=window.location.href,t="development"===x.getApplicationConfiguration("app.profile");function i(e){var i,r,o=x.getApplicationConfiguration("app.dev.urls.myapps");x._sandboxPlatformId=e.toUpperCase(),t&&o?r=o:((i=n.parseUrl(x.getApplicationConfiguration("app.urls.myapps"))).domain=e+"-"+i.domain,r=n.composeUrl(i)),x.applicationConfigurations.forEach(function(e){"app.urls.myapps"===e.propertyKey&&(e.propertyValue=r)})}if(t){var r=n.getQueryString(e,"_gpid");r&&(i(r),document.cookie="_gpid="+r+";path=/")}else window.dsPlatformPrefixUrlEnabled&&x.isPlatformAwareUrl(e)&&i(y(e)[0])},isPlatformAwareUrl:function(e){var t=y(e),n=new RegExp(/\S*\s+-\s+[^-]+-prd/),i=x.getApplicationConfiguration("app.build.number")||"",r=n.test(i)?3:4;return t.length===r},getSandboxPlatformId:function(){return x._sandboxPlatformId},getApplicationConfiguration:function(e){for(var t=0,n=x.applicationConfigurations.length;t<n;t++)if(x.applicationConfigurations[t].propertyKey===e)return x.applicationConfigurations[t].propertyValue},getAllApplicationConfigurations:function(e){return e&&s.getAll({async:!1,success:function(e){x.applicationConfigurations=e}}),x.applicationConfigurations},getAllApplicationConfigurationsAsync:function(e){if(!(e=e||{}).refresh)return e.success&&e.success(x.applicationConfigurations);s.getAllAsync({serviceName:e.serviceName,serviceUrl:e.serviceUrl,prefixUrl:e.prefixUrl,success:function(t){x.applicationConfigurations=t,e.success&&e.success(t)}})},getWidgetConfiguration:function(e){for(var t=0,n=x.widgetConfigurations.length;t<n;t++)if(x.widgetConfigurations[t].id===e)return x.widgetConfigurations[t]},getAllWidgetConfigurations:function(e,t){return t=t||{},e&&l.getConfigurations({serviceName:t.serviceName,serviceUrl:t.serviceUrl,prefixUrl:t.prefixUrl,id:"7zhxiXCAwqKCBb8nn002",success:function(e){x.widgetConfigurations=e,t.success&&t.success(e)}}),x.widgetConfigurations},getUser:function(){return x.user},getCachedCurrentUser:function(){return x.user},getUserAsync:function(t){t=t||{},a.getUser({serviceName:t.serviceName,serviceUrl:t.serviceUrl,prefixUrl:t.prefixUrl,success:function(n){e.extend(x.user,n),e.is(t.success,"function")&&t.success(n),i.dispatch(x.events.userRefreshed)},failure:function(n){t.retryNumber-- >0?setTimeout(x.getUserAsync.bind(x,t),t.retryDelay||1e3):e.is(t.failure,"function")&&t.failure(n)}})},getCurrentUser:function(n){var i=n||{};function o(e){return new t(function(t,n){return r.authenticatedRequest(e,{method:"GET",onComplete:t,onFailure:n,onTimeout:n,onCancel:n})})}var c=function(){return new t(function(e,t){var n=i.passportUrl||x.getApplicationConfiguration("app.urls.passport");if(n)return e({propertyKey:"app.urls.passport",propertyValue:n});s.get("app.urls.passport",i).then(function(t){e(t)},t)})};return new t(function(t,r){x.user.email&&!i.refresh?t(x.user):a.getCurrentUser(n).then(function(t){e.extend(x.user,t)},r).then(c,r).then(function(e){return e.propertyValue+"/api/authenticated/user/me"},r).then(o,r).then(function(t){var n=JSON.parse(t),i={email:n.fields.email,firstName:n.fields.firstName,lastName:n.fields.lastName,telephone:n.fields.telephone,address:n.fields.address,city:n.fields.city};return e.extend(x.user,i),x.user},r).then(t,r).catch(function(e){r(e)})})},getUserProperty:function(e){return x.user.properties[e]},setUserProperty:function(e,t,n){n=n||{},x.user.properties[e]=t,a.setProperty({serviceName:n.serviceName,serviceUrl:n.serviceUrl,prefixUrl:n.prefixUrl,key:e,value:t,success:n.success,failure:n.failure})},removeUserProperty:function(e,t){t=t||{},delete x.user.properties[e],a.removeProperty({serviceName:t.serviceName,serviceUrl:t.serviceUrl,prefixUrl:t.prefixUrl,key:e,success:t.success,failure:t.failure})},getContextRoles:function(e){c.getContextRoles(e)},setContextRoles:function(e){c.setContextRoles(e)},getRestrictedContexts:function(e){var t=e||{},n=t.type,i=t.scope,r=t.success,o=t.failure;c.getAll({serviceName:t.serviceName,serviceUrl:t.serviceUrl,prefixUrl:t.prefixUrl,ownership:!0,success:function(e){v(x.contexts,e),g(r,i,[function(e,t){return t?e.filter(function(e){return e.type===t}):e}(e,n)])},failure:function(){g(o,i,arguments)}})},getContextsBy:function(e){var t=e||{},n=t.type,i=t.scope,r=t.success,o=t.failure;c.getBy({serviceName:t.serviceName,serviceUrl:t.serviceUrl,prefixUrl:t.prefixUrl,roles:t.roles,platforms:t.platforms,projection:t.projection,unMerged:t.unMerged,success:function(e){var o;e=t.unMerged?(o={},e.forEach(function(e){var t=o[e.id];t?(t.role=h(t.role,e.role),t.owner=e.owner||t.owner):(t=e,o[e.id]=e),0!==e.membersCount&&(t.shareAccesses=t.shareAccesses||[],t.shareAccesses.push({type:(e.accessType||"").toUpperCase(),role:e.role,contextAccessId:e.contextAccessId}))}),Object.keys(o).map(function(e){return o[e]})):e,v(x.contexts,e),g(r,i,[function(e,t){return t?e.filter(function(e){return e.type===t}):e}(e,n)])},failure:function(){g(o,i,arguments)}})},getAllContexts:function(e){var t,n,i=e||{},r=i.type,o=i.scope,s=i.success,a=i.failure;x.contexts?g(s,o,[(t=x.contexts,n=r,n?t.filter(function(e){return e.type===n}):t)],!0):g(a,o,[],!0)},_getAllContexts:function(e){var t=x.contexts;return e?t.filter(function(t){return t.type===e}):t},getContext:function(t){var n,i=t||{},r=i.success,o=i.failure,s=i.scope,a=i.id,c=i.type;x.contexts&&(n=function(t){for(var n=0,i=t.length;n<i;n++){if(e.is(c)&&t[n].modelId===a&&t[n].type===c)return t[n];if(t[n].id===a)return t[n]}}(x.contexts)),n?g(r,s,[n],!0):g(o,s,["Context not found "+c+" "+a],!0)},_getContext:function(e,t){return(t?x.contexts.filter(function(n){return n.modelId===e&&n.type===t}):x.contexts.filter(function(t){return t.id===e}))[0]},setContext:function(t){var n=t||{},r=n.id,o=n.type,s=x._getContext(r,o);c.set({id:r,type:o,name:n.name,template:n.template,thumbnailId:n.thumbnailId,platformId:n.platformId,accessType:n.accessType,scope:n.scope,success:function(t){return s?(e.extend(s,t),s.template=!t.template||t.template<0?null:t.template,g(n.success,n.scope,[s]),s):(t.owner=!0,t.membersCount=1,v(x.contexts,[t]),i.dispatch(x.events.contextAdd,e.clone(t),!0),g(n.success,n.scope,[t]),t)},failure:n.failure,serviceName:n.serviceName,serviceUrl:n.serviceUrl,prefixUrl:n.prefixUrl,data:n.data})},trashContext:function(e){return U(e)},unTrashContext:function(e){return e.deletionDate=null,U(e)},removeContexts:function(e){var n=e||{},i=n.ids,r=this;return new t(function(e,t){c.removes({serviceName:n.serviceName,serviceUrl:n.serviceUrl,prefixUrl:n.prefixUrl,ids:i,success:function(){r.contexts=r.contexts.filter(function(e){if(i.indexOf(e.id)<0)return e}),e()}.bind(r),failure:t})})},removeContext:function(e){var t=e||{},n=t.id,i=t.type,r=t.scope,o=x._getContext(n,i);i=i||o.type,c.remove({serviceName:t.serviceName,serviceUrl:t.serviceUrl,prefixUrl:t.prefixUrl,id:n,type:i,success:function(){x.contexts.splice(x.contexts.indexOf(o),1),g(t.success,r,arguments)},failure:t.failure,scope:r})},getActiveContext:function(e){var t=e,n=t.success,i=t.failure,r=t.scope;if(x.contexts){var o=function(e){for(var n=0,i=e.length;n<i;n++)if(e[n].active&&(!t.type||e[n].type===t.type))return e[n]}(x.contexts);o?g(n,r,[o],!0):g(i,r,[],!0)}else g(i,r,[],!0)},_getActiveContext:function(e){var t,n=x.contexts;for(t=0;t<n.length;t++)if(n[t].active&&(!e||n[t].type===e))return n[t]},getAllActiveContexts:function(e){var t=e||{},n=t.success,i=t.failure,r=t.scope;x.contexts?g(n,r,[x.contexts.filter(function(e){if(e.active)return!0})],!0):g(i,r,[],!0)},_getAllActiveContexts:function(){return x.contexts.filter(function(e){return!!e.active})},setActiveContext:function(t){var n=x._getContext(t.id,t.type);n&&!n.active?(x.contexts.some(function(e){if(e.active)return e.active=!1,!0}),n.active=!0,i.dispatch(x.events.contextChange,e.clone(n),!0),g(t.success,t.scope,[n],!0)):g(t.failure,t.scope,[],!0)},_setActiveContext:function(t,n){var r=x._getContext(t,n);r&&!r.active&&(x.contexts.some(function(e){if(e.active)return e.active=!1,!0}),r.active=!0,i.dispatch(x.events.contextChange,e.clone(r),!0))},getAclAsync:c.getAcl,setAclAsync:function(e){C(e,"set")},removeAclAsync:function(e){C(e,"remove")},setAclV2:function(e){var t=(e=e||{}).success;e.success=function(n){x._getContext(e.modelId,e.type).membersCount=n.membersCount,t&&t.call(e.scope,n)},c.setAclV2(e)},setGroupAccesses:function(e){var t=e.success;e.success=function(n){x._getContext(e.modelId,e.type).membersCount+=e.groups.length,t&&t.call(e.scope,n)},c.setGroupAccesses(e)},updateGroupAccess:c.updateGroupAccess,removeGroupAccess:function(e){var t=e.success;e.success=function(n){x._getContext(e.modelId,e.type).membersCount-=1,t&&t.call(e.scope,n)},c.removeGroupAccess(e)},setContextThumbnail:function(e){var t=e.success;e.success=function(n){var i=JSON.parse(n);x.contexts.forEach(function(t){t.modelId===e.modelId&&(t.thumbnail=i)}),t&&t.call(e.scope,i)},e.isUpdate=!!x.contexts.filter(function(t){return t.modelId===e.modelId&&t.thumbnail}).length,c.setThumbnail(e)},removeContextThumbnail:function(e){var t=e.success;e.success=function(){x.contexts.forEach(function(t){t.modelId===e.modelId&&(t.thumbnail=void 0)}),t&&t.call(e.scope,arguments)},c.removeThumbnail(e)},getWidgetById:l.getWidgetById,getWidgetByUrl:l.getWidgetByUrl,getWidgetInstance:l.getWidgetInstance,addWidgetInstance:function(t){var n,r=t||{};n={serviceName:r.serviceName,serviceUrl:r.serviceUrl,prefixUrl:r.prefixUrl,success:function(e){i.dispatch("widget-"+r.parentId,["show",[e]],!0),r.success&&r.success.call(r.scope,arguments)},failure:function(){r.failure&&r.failure.call(r.scope,arguments)}},r.appId?(e.merge(n,r),l.createWidgetInstanceFromApp(n)):(n.widgetIdOrUrl=r.widgetIdOrUrl,e.merge(n,r),l.createWidgetInstance(n))},getWidgetInstanceData:function(t){var n=t||{};function i(t){t&&e.merge(n.data,t),n.success&&n.success.call(n.scope,n.data)}e.is(n.dataUrl,"string")&&n.dataUrl.length?o.request({url:n.dataUrl,method:"GET",success:i,failure:function(){n.failure&&n.failure.call(n.scope,arguments)}}):i()},setWidgetInstance:l.editWidgetInstance,removeWidgetInstance:l.removeWidgetInstance,getWidgetInstanceChildren:function(e){l.getWidgetInstanceChildren(e)},copyWidgetInstance:function(t){var n,r=t||{};n={serviceName:r.serviceName,serviceUrl:r.serviceUrl,prefixUrl:r.prefixUrl,depth:1,success:function(e){i.dispatch("widget-"+e.parentId,["show",[e]],!0),r.success&&r.success.call(r.scope,arguments)},failure:function(){r.failure&&r.failure.call(r.scope,arguments)}},e.merge(n,r),l.copySubTree(n)},copyContextTree:l.copyContextTree,copySubTree:l.copySubTree,enableDragAndInstantiation:function(t){var n={},i=t||{},r=i.element;e.is(r,"element")&&(n["data-url"]=i.url,n["data-title"]=i.title,n["data-isolationLevel"]=i.trusted?1:2,["icon","dataUrl","data","appId","token","apps"].forEach(function(e){i[e]&&(n["data-"+e]=i[e])}),r.setStyle("-ms-touch-action","none"),r.setAttributes(n))},getPageWidget:function(t,n){for(var i=(e.Widgets||{}).instances||[],r=0,o=i.length;r<o;r++)if((e.is(n)&&i[r][t]===n||i[r].id===t)&&i[r].environment)return i[r]},getParentContextOwner:function(e){for(var t=e.environment,n=t&&t.wp&&t.wp.parent;n;){if(n.wp&&n.wp.allowedChildrenContextType||!n.wp)return n.widget;n=n.wp.parent}},getContextOwner:function(t){for(var n,i=e.Widgets&&e.Widgets.instances||[],r=0,o=i.length;r<o;r++)if((n=i[r].environment)&&n.wp&&n.wp.allowedChildrenContextType===t)return i[r]},getWidgetChildren:function(e){var t=e.environment;if(t&&t.wp&&t.wp.children)return t.wp.children},requireAuthentication:function(){return!window.dsUserLogin&&(document.location.replace(x.getApplicationConfiguration("app.urls.passport")+"/login?service="+escape(document.location.href)),!0)},createCommentMedia:u.create,getCommentMediaUrl:u.getUrl,getCommentMediaThumbnailUrl:u.getThumbnailUrl,deleteCommentMedia:u.delete,getAllNotificationsAsync:d.getAll,getNotificationAsync:d.get,setPublicNotificationAsync:d.setPublic,setPrivateNotificationAsync:d.createPrivate,createNotification:d.create,publishNotification:d.publish,publishNotificationByMail:d.mail,addContext:function(t){return p.addContext(t).then(function(t){return t.owner=!0,t.membersCount=1,v(x.contexts,[t]),i.dispatch(x.events.contextAdd,e.clone(t),!0),t}).catch(function(e){throw console.error("Fail to add new context:",e,t),e})}};return x}),define("DS/UWPClientCode/Data/Utils",[["DS","WAFData","WAFData"].join("/")],function(e){"use strict";var t,n,i,r,o={},s=function(){if(!n){var e=window.location,t=e.pathname,i=e.protocol+"//"+e.host,r=t.indexOf("/api/widget/");n=window.dsBaseUrl||i+t.substring(0,-1!==r?r+1:t.length)}return n},a=function(){return i||(i=require("DS/UWPClientCode/Navigation"),r=require("DS/UWPClientCode/Bootstrap")),i.navigationMode||r._getAppNavigationMode()};require([["DS","i3DXCompassPlatformServices","i3DXCompassPlatformServices"].join("/")],function(e){t=e},function(){});var c,l={scope:function(e,t){return function(){e&&e.apply(t,arguments)}},buildPath:function(){var e=[],t=arguments.length-1;return Array.prototype.forEach.call(arguments,function(n,i){n&&(n+="",0!==i&&(n=n.replace(/^\//,"")),i!==t&&(n=n.replace(/\/$/,"")),e.push(n))}),e.join("/")},getDefaultHeaders:function(e){var t={"Content-Type":"application/json",Accept:"application/json"};return(e=e||{}).csrf&&(t[e.csrf.param]=e.csrf.token),e.lang&&(t["Accept-Language"]=e.lang),t},getServiceUrl:function(e){return e.serviceUrl?e.onComplete(e.serviceUrl):e.serviceName&&t?void t.getPlatformServices({serviceName:e.serviceName,onComplete:function(t){var n=t[0][e.serviceName];if("string"!=typeof n)return e.onComplete("");e.onComplete(n)},onFailure:function(){e.onFailure&&e.onFailure.apply(null,arguments)}}):e.onComplete("PATH"===a()?s():"")},getCSRF:function(t){if(!t.serviceUrl||t.serviceUrl===s())return t.onComplete();if(t.serviceUrl===document.location.origin)return t.onComplete();var n=o[l.buildPath(t.serviceUrl,t.prefix)];if(n)return t.onComplete(n);e.authenticatedRequest(l.buildPath(t.serviceUrl,t.prefix,"/api/security/csrf"),{method:"GET",onComplete:function(e){var n=JSON.parse(e);o[l.buildPath(t.serviceUrl,t.prefix)]=n,t.onComplete(n)},onFailure:t.onFailure})},getServiceUrlWithCSRF:function(e){l.getServiceUrl({serviceName:e.serviceName,serviceUrl:e.serviceUrl,onComplete:function(t){l.getCSRF({serviceUrl:t,prefix:e.prefixUrl,onComplete:function(n){e.onComplete(t,n)},onFailure:e.onFailure})},onFailure:e.onFailure})},sequentialize:(c={},function(e){return function(t){var n,i=e.getSequenceGroups(t);if(0===i.length||e.shouldBypass&&e.shouldBypass(t))return e.fireRequest.call(null,t);i.forEach(function(r){c[r]=Promise.all(i.map(function(e){return c[e]||Promise.resolve()})).catch(function(){}).then(function(){return n||(n=new Promise(function(n,i){!function(n){function i(i){return function(){return n[i](),t[i]&&t[i].apply(e.scope,arguments)}}try{e.fireRequest.call(null,Object.assign({},t,{success:i("success"),failure:i("failure")}))}catch(e){n.failure(e)}}({success:n,failure:i})}))})})}})};return l}),define("DS/UWPClientCode/Data",["UWA/Core",["DS","WAFData","WAFData"].join("/"),"DS/UWPClientCode/I18n"],function(e,t,n){"use strict";var i=window.location,r=i.pathname,o=i.protocol+"//"+i.host,s=r.indexOf("/api/widget/"),a=window.dsBaseUrl||o+r.substring(0,-1!==s?s+1:r.length);function c(e,t){return function(){e&&e.apply(t,arguments)}}function l(e){return"POST"===e||"PUT"===e||"PATCH"===e}function u(e,t,n){var i=e.indexOf("#"),r=-1===i?"":e.substr(i),o=-1===i?e:e.substr(0,i),s=-1!==e.indexOf("?")?"&":"?",a=encodeURIComponent(n);return(o=function(e,t){return e.match(new RegExp("([?&])"+t+"=.*?(&|$)","i"))}(o,t)?function(e,t,n){return e.replace(new RegExp("([?&])"+t+"=.*?(&|$)","i"),"$1"+t+"="+n+"$2")}(o,t,a):o+s+t+"="+a)+r}return{prefix:window.dsPrefix||"",request:function(i){var r,o,s=i||{url:""},d=s.url||"",p=s.method||"POST",f=s.type,m=!1!==s.async,g=s.contentType||"application/json",h=s.timeout||s.failure,v=!s.notEmbedParams,C=s.payload,U=s.queryParams;return function(e){return-1===e.indexOf("://")&&0!==e.charAt(0)}(d)&&(d=a+d),U&&(d=function(e,t){var n,i=e;for(n in t)t.hasOwnProperty(n)&&(i=u(i,n,t[n]));return i}(d,U)),C&&l(p)&&(o=f&&"json"!==f?C:JSON.stringify(C)),!o&&s.params&&(o=function(e,t){return l(e)&&(!t||"json"===t)}(p,f)?JSON.stringify(v?{params:s.params}:s.params):s.params),r=e.merge(s.headers||{},{"Content-Type":g,"Accept-Language":n.getCurrentLanguage()}),t.request(d,{data:o,method:p,type:f,async:m,useJsonpRequest:!1,headers:r,onTimeout:c(h,s.scope),onFailure:c(s.failure,s.scope),onComplete:function(t){if("string"==typeof t)try{t=t?JSON.parse(t):{}}catch(e){t={}}t.result||(t.result=e.clone(t)),e.is(s.success,"function")&&s.success.call(s.scope,t.result,t.nb_result,t)}})}}}),define("DS/UWPClientCode/Undo",["UWA/Core","UWA/Class","UWA/String","DS/UIKIT/Alert","i18n!DS/UWPClientCode/assets/nls/Undo/undo"],function(e,t,n,i,r){"use strict";return new(t.extend({stack:null,duration:null,namespace:null,alert:null,init:function(){var t=this;function n(e){t.stack[e]&&delete t.stack[e]}function r(e,i){t.stack[e]&&(t.stack[e].undoAgree(),n(e),t.alert.remove(i))}t.stack={},t.duration=5e3,t.namespace="action-undo",t.alert=new i({closable:!0,visible:!0,autoHide:!0,hideDelay:t.duration,closeOnClick:!1,className:"undo-alert",events:{onShowMessage:function(n){var i,o=n.querySelector("."+t.namespace);if(e.is(o,"element")){if(i=o.dataset.id,!t.stack[i])return;t.stack[i].undoPending(),o.addEventListener("click",r.bind(t,i,n))}},onRemoveMessage:function(i){var o,s=i.querySelector("."+t.namespace);e.is(s,"element")&&(o=s.dataset.id,s.removeEventListener("click",r.bind(t,o)),t.stack[o]&&t.stack[o].undoDecline(),n(o))}}}).inject(document.body,"top"),window.addEventListener("beforeunload",function(){for(var e in t.stack)t.stack[e].undoDecline()})},addAction:function(t){var i,o=t.id,s=t.name||r.elementMessage;o?(i=e.createElement("div",{html:"<b>"+n.escapeHTML(s)+"</b> "+r.deletionMessage+". "}),e.createElement("span",{text:r.ClickToUndoMessage,styles:{fontWeight:"bold",fontSyle:"italic",cursor:"pointer","text-decoration":"underline"},class:this.namespace,"data-id":o}).inject(i),this.stack[o]={undoAgree:t.undoAgree,undoDecline:t.undoDecline,undoPending:t.undoPending},this.alert.add({className:"success",message:i.getHTML()})):e.log("addAction should have an id parameter")},isPending:function(e){return!!this.stack[e]}}))}),define("DS/UWPClientCode/UWA/Widget",["UWA/Core","UWA/Widget","DS/Logger/Logger","DS/UIKIT/Mask"],function(e,t,n,i){"use strict";return t.extend({setStyle:function(e){var t,n=this.environment.wp.widgetId;if(e=(e=(e=(e=Array.isArray(e)?e.join("\n"):String(e)).replace(/\/\*[\s\S]*?\*\//g,"")).replace(/\n/g," ").replace(/\}/g,"}\n").split("\n")).join("\n").trim().replace(/\s{2,}/g," "))return(t=document.getElementById("css-"+n))||((t=document.createElement("style")).setAttribute("id","css-"+n),t.setAttribute("type","text/css"),document.getElementsByTagName("head").item(0).appendChild(t),t.styleSheet?t.styleSheet.cssText=e:t.appendChild(document.createTextNode(e))),e},mask:function(t){i.mask(this.elements.body,t||e.i18n("Loading..."))},unmask:function(){i.unmask(this.elements.body)},show:function(){this.dispatchEvent("showWidget")},hide:function(){this.dispatchEvent("hideWidget")},log:function(){n.log.apply(null,["Widget",this.environment.wp.title,"(#"+this.id+") --"].concat(Array.prototype.slice.call(arguments)))},info:function(){n.info.apply(null,["Widget",this.environment.wp.title,"(#"+this.id+") --"].concat(Array.prototype.slice.call(arguments)))},warn:function(){n.warn.apply(null,["Widget",this.environment.wp.title,"(#"+this.id+") --"].concat(Array.prototype.slice.call(arguments)))},error:function(){n.error.apply(null,["Widget",this.environment.wp.title,"(#"+this.id+") --"].concat(Array.prototype.slice.call(arguments)))},debug:function(){n.debug.apply(null,["Widget",this.environment.wp.title,"(#"+this.id+") --"].concat(Array.prototype.slice.call(arguments)))}})}),define("DS/UWPClientCode/Fingerprint",function(){"use strict";var e={};return{has:function(t){return!(!t||!e[t])},get:function(t){return t&&e[t]||null},set:function(t,n){t&&(e[t]=n)},remove:function(t){t&&delete e[t]},setAll:function(t){if(t)for(var n in t)e[n]=t[n]}}}),define("DS/UWPClientCode/Data/User",["UWA/Core","UWA/Utils","UWA/Promise","DS/UWPClientCode/Data","DS/UWPClientCode/Data/Utils",["DS","WAFData","WAFData"].join("/")],function(e,t,n,i,r,o){"use strict";var s={getUser:function(e){r.getServiceUrl({serviceName:e.serviceName,serviceUrl:e.serviceUrl,onComplete:function(t){var n=r.buildPath(t,e.prefixUrl||(t?"":i.prefix),"api/users/current");o.authenticatedRequest(n,{method:"GET",type:"json",onComplete:r.scope(e.success,e.scope),onFailure:r.scope(e.failure,e.scope)})}})},getCurrentUser:function(e){return new n(function(t,n){(e=e||{}).success=t,e.failure=n,s.getUser(e)})},setProperty:function(e){r.getServiceUrlWithCSRF({serviceName:e.serviceName,serviceUrl:e.serviceUrl,prefix:e.prefixUrl,onComplete:function(t,n){var s;s=r.buildPath(t,e.prefixUrl||(t?"":i.prefix),"api/users/properties/edit"),o.authenticatedRequest(s,{method:"POST",type:"json",data:JSON.stringify({propertyKey:e.key,propertyValue:e.value}),headers:r.getDefaultHeaders({csrf:n}),onComplete:r.scope(e.success,e.scope),onFailure:r.scope(e.failure,e.scope)})}})},removeProperty:function(e){r.getServiceUrlWithCSRF({serviceName:e.serviceName,serviceUrl:e.serviceUrl,prefix:e.prefixUrl,onComplete:function(n,s){var a;a=r.buildPath(n,e.prefixUrl||(n?"":i.prefix),"api/users/properties"),a+="?"+t.toQueryString({key:e.key}),o.authenticatedRequest(a,{method:"DELETE",type:"json",headers:r.getDefaultHeaders({csrf:s}),onComplete:r.scope(e.success,e.scope),onFailure:r.scope(e.failure,e.scope)})}})}};return s}),define("DS/UWPClientCode/Data/Context",["UWA/Utils","DS/UWPClientCode/Data","DS/UWPClientCode/Data/Utils","DS/Logger/Logger",["DS","WAFData","WAFData"].join("/")],function(e,t,n,i,r){"use strict";var o="api/contexts";return{getAPIBaseUrl:function(e){n.getServiceUrl({serviceName:e.serviceName,serviceUrl:e.serviceUrl,onComplete:function(i){var r=n.buildPath(i,e.prefixUrl||(i?"":t.prefix),o);e.success.call(null,r)},onFailure:e.failure})},getUrl:function(e){return e=e||{},n.buildPath(e.serviceUrl,e.prefixUrl||(e.serviceUrl?"":t.prefix),o)},getAll:function(e){e=e||{},n.getServiceUrl({serviceName:e.serviceName,serviceUrl:e.serviceUrl,onComplete:function(i){var s=n.buildPath(i,e.prefixUrl||(i?"":t.prefix),o);r.authenticatedRequest(s,{method:"GET",type:"json",data:{displayOwnership:e.ownership,contextType:e.type},onComplete:n.scope(e.success,e.scope),onFailure:n.scope(e.failure,e.scope)})}})},getBy:function(e){e=e||{},n.getServiceUrl({serviceName:e.serviceName,serviceUrl:e.serviceUrl,onComplete:function(i){var s,a={};e.platforms&&(a.platforms=e.platforms.join(",")),e.roles&&(a.roles=e.roles.join(",")),e.projection&&(a.projection=e.projection),e.unMerged&&(a.filter="false"),s=n.buildPath(i,e.prefixUrl||(i?"":t.prefix),o),r.authenticatedRequest(s,{method:"GET",type:"json",data:a,onComplete:n.scope(e.success,e.scope),onFailure:n.scope(e.failure,e.scope)})}})},getContextRoles:function(e){e=e||{},n.getServiceUrl({serviceName:e.serviceName,serviceUrl:e.serviceUrl,onComplete:function(s){var a;e.modelId||i.warn("get context roles: modelId is mandatory"),e.type||i.warn("get context roles: type is mandatory"),a=n.buildPath(s,e.prefixUrl||(s?"":t.prefix),o,e.type,e.modelId,"roles"),r.authenticatedRequest(a,{method:"GET",type:"json",onComplete:n.scope(e.success,e.scope),onFailure:n.scope(e.failure,e.scope)})}})},setContextRoles:function(e){n.getServiceUrlWithCSRF({serviceName:e.serviceName,serviceUrl:e.serviceUrl,prefix:e.prefixUrl,onComplete:function(s,a){var c,l=e.roles||[];e.modelId||i.warn("set context roles: modelId is mandatory"),e.type||i.warn("set context roles: type is mandatory"),c=n.buildPath(s,e.prefixUrl||(s?"":t.prefix),o,e.type,e.modelId,"roles"),r.authenticatedRequest(c,{method:"POST",type:"json",data:JSON.stringify(l),headers:n.getDefaultHeaders({csrf:a}),onComplete:n.scope(e.success,e.scope),onFailure:n.scope(e.failure,e.scope)})}})},setDeletionDate:function(e){var i={type:e.type,modelId:e.modelId,deletionDate:e.deletionDate};n.getServiceUrlWithCSRF({serviceName:e.serviceName,serviceUrl:e.serviceUrl,prefix:e.prefixUrl,onComplete:function(s,a){var c;c=n.buildPath(s,e.prefixUrl||(s?"":t.prefix),o,e.type,e.modelId),r.authenticatedRequest(c,{method:"PUT",type:"json",data:JSON.stringify(i),headers:n.getDefaultHeaders({csrf:a}),onComplete:n.scope(e.success,e.scope),onFailure:n.scope(e.failure,e.scope)})}})},set:function(e){n.getServiceUrlWithCSRF({serviceName:e.serviceName,serviceUrl:e.serviceUrl,prefix:e.prefixUrl,onComplete:function(i,s){var a,c={type:e.type,name:e.name,modelId:e.id,access:e.accessType};e.template&&(c.template=e.template),e.thumbnailId&&(c.thumbnailId=e.thumbnailId),e.platformId&&(c.platform=e.platformId),e.data&&(c.data=e.data),a=n.buildPath(i,e.prefixUrl||(i?"":t.prefix),o),r.authenticatedRequest(a,{method:"POST",type:"json",data:JSON.stringify(c),headers:n.getDefaultHeaders({csrf:s}),onComplete:n.scope(e.success,e.scope),onFailure:n.scope(e.failure,e.scope)})}})},remove:function(e){n.getServiceUrlWithCSRF({serviceName:e.serviceName,serviceUrl:e.serviceUrl,prefix:e.prefixUrl,onComplete:function(i,s){var a;a=n.buildPath(i,e.prefixUrl||(i?"":t.prefix),o,e.type,e.id),r.authenticatedRequest(a,{method:"DELETE",type:"json",headers:n.getDefaultHeaders({csrf:s}),onComplete:n.scope(e.success,e.scope),onFailure:n.scope(e.failure,e.scope)})}})},removes:function(s){s.ids||i.warn("Removes contexts: ids is mandatory"),n.getServiceUrlWithCSRF({serviceName:s.serviceName,serviceUrl:s.serviceUrl,prefix:s.prefixUrl,onComplete:function(i,a){var c;c=n.buildPath(i,s.prefixUrl||(i?"":t.prefix),o),c+="?"+e.toQueryString({ids:s.ids.join(",")}),r.authenticatedRequest(c,{method:"DELETE",type:"json",headers:n.getDefaultHeaders({csrf:a}),onComplete:n.scope(s.success,s.scope),onFailure:n.scope(s.failure,s.scope)})}})},setAcl:function(e){n.getServiceUrlWithCSRF({serviceName:e.serviceName,serviceUrl:e.serviceUrl,prefix:e.prefixUrl,onComplete:function(i,s){var a;a=n.buildPath(i,e.prefixUrl||(i?"":t.prefix),o,"acl"),r.authenticatedRequest(a,{method:"POST",type:"json",data:JSON.stringify({type:e.type,modelId:e.id,login:e.login,owner:e.isOwner,email:!!e.email}),headers:n.getDefaultHeaders({csrf:s}),onComplete:n.scope(e.success,e.scope),onFailure:n.scope(e.failure,e.scope)})}})},setAclV2:function(e){n.getServiceUrlWithCSRF({serviceName:e.serviceName,serviceUrl:e.serviceUrl,prefix:e.prefixUrl,onComplete:function(i,o){var s;s=n.buildPath(i,e.prefixUrl||(i?"":t.prefix),"api/v2/contexts","acl"),r.authenticatedRequest(s,{method:"POST",type:"json",data:JSON.stringify({recipients:e.recipients,type:e.type,modelId:e.modelId,sendEmail:e.sendEmail||!1}),headers:n.getDefaultHeaders({csrf:o}),onComplete:n.scope(e.success,e.scope),onFailure:n.scope(e.failure,e.scope)})}})},setGroupAccesses:function(e){n.getServiceUrlWithCSRF({serviceName:e.serviceName,serviceUrl:e.serviceUrl,prefix:e.prefixUrl,onComplete:function(i,o){var s;s=n.buildPath(i,e.prefixUrl||(i?"":t.prefix),"api/v2/contexts","group-accesses"),r.authenticatedRequest(s,{method:"POST",type:"json",data:JSON.stringify({groups:e.groups,type:e.type,modelId:e.modelId,sendEmail:e.sendEmail||!1}),headers:n.getDefaultHeaders({csrf:o}),onComplete:n.scope(e.success,e.scope),onFailure:n.scope(e.failure,e.scope)})}})},updateGroupAccess:function(e){n.getServiceUrlWithCSRF({serviceName:e.serviceName,serviceUrl:e.serviceUrl,prefix:e.prefixUrl,onComplete:function(i,o){var s;s=n.buildPath(i,e.prefixUrl||(i?"":t.prefix),"api/v2/contexts",e.type,e.modelId,"group-accesses",e.groupId),r.authenticatedRequest(s,{method:"PUT",type:"json",data:JSON.stringify({role:e.role.toUpperCase(),sendEmail:e.sendEmail||!1}),headers:n.getDefaultHeaders({csrf:o}),onComplete:n.scope(e.success,e.scope),onFailure:n.scope(e.failure,e.scope)})}})},getAcl:function(e){n.getServiceUrl({serviceName:e.serviceName,serviceUrl:e.serviceUrl,onComplete:function(i){var o;o=n.buildPath(i,e.prefixUrl||(i?"":t.prefix),"api/v2/contexts",e.type,e.id,"accesses"),r.authenticatedRequest(o,{method:"GET",type:"json",data:{name:e.name||void 0,roles:e.roles&&e.roles.map(function(e){return e.toUpperCase()}).join(","),usertype:e.userType,displayUserInfo:e.userInfo,offset:e.offset,limit:e.limit},onComplete:n.scope(e.success,e.scope),onFailure:n.scope(e.failure,e.scope)})}})},removeAcl:function(e){n.getServiceUrlWithCSRF({serviceName:e.serviceName,serviceUrl:e.serviceUrl,prefix:e.prefixUrl,onComplete:function(i,s){var a;a=n.buildPath(i,e.prefixUrl||(i?"":t.prefix),o,e.type,e.id,"acl",e.login),r.authenticatedRequest(a,{method:"DELETE",type:"json",headers:n.getDefaultHeaders({csrf:s}),onComplete:n.scope(e.success,e.scope),onFailure:n.scope(e.failure,e.scope)})}})},removeGroupAccess:function(e){n.getServiceUrlWithCSRF({serviceName:e.serviceName,serviceUrl:e.serviceUrl,prefix:e.prefixUrl,onComplete:function(i,o){var s;s=n.buildPath(i,e.prefixUrl||(i?"":t.prefix),"api/v2/contexts",e.type,e.modelId,"group-accesses",e.groupId),r.authenticatedRequest(s,{method:"DELETE",type:"json",headers:n.getDefaultHeaders({csrf:o}),onComplete:n.scope(e.success,e.scope),onFailure:n.scope(e.failure,e.scope)})}})},setThumbnail:function(e){n.getServiceUrlWithCSRF({serviceName:e.serviceName,serviceUrl:e.serviceUrl,prefix:e.prefixUrl,onComplete:function(i,s){var a,c;(c=new FormData).append("file",e.file),a=n.buildPath(i,e.prefixUrl||(i?"":t.prefix),o,e.type,e.modelId,"thumbnail");var l=n.getDefaultHeaders({csrf:s});delete l["Content-Type"],delete l.Accept,r.authenticatedRequest(a,{method:"POST",data:c,headers:l,onComplete:n.scope(e.success,e.scope),onFailure:n.scope(e.failure,e.scope)})}})},removeThumbnail:function(e){n.getServiceUrlWithCSRF({serviceName:e.serviceName,serviceUrl:e.serviceUrl,prefix:e.prefixUrl,onComplete:function(i,s){var a;a=n.buildPath(i,e.prefixUrl||(i?"":t.prefix),o,e.type,e.modelId,"thumbnail"),r.authenticatedRequest(a,{method:"DELETE",type:"json",headers:n.getDefaultHeaders({csrf:s}),onComplete:n.scope(e.success,e.scope),onFailure:n.scope(e.failure,e.scope)})}})}}}),define("DS/UWPClientCode/Data/Dashboard",["UWA/Core","UWA/Utils","DS/UWPClientCode/Data","DS/UWPClientCode/Data/Utils",["DS","WAFData","WAFData"].join("/")],function(e,t,n,i,r){"use strict";return{addContext:function(o){return new Promise(function(s,a){i.getServiceUrlWithCSRF({serviceName:o.serviceName,serviceUrl:o.serviceUrl,prefix:o.prefixUrl,onComplete:function(c,l){var u,d;u=function(e){return i.buildPath(e.baseUrl,e.prefix,window.ds.anonymous&&e.anonymous?"public/api":"api",e.path)}({baseUrl:c,prefix:o.prefixUrl||(c?"":n.prefix),path:"/dashboards"}),(d=o.targetContext||{}).modelId=t.getUUID();var p={method:"POST",type:"json",onComplete:s,onFailure:a,data:JSON.stringify({sourceContext:o.sourceContext,targetContext:d,depth:o.withoutTab?1:null,replacement:o.templateTopic}),headers:i.getDefaultHeaders({csrf:l})};e.merge(p,o),r.authenticatedRequest(u,p)}})})}}}),define("DS/UWPClientCode/Data/ApplicationConfiguration",["UWA/Core","UWA/Promise","DS/UWPClientCode/Data","DS/UWPClientCode/Data/Utils",["DS","WAFData","WAFData"].join("/")],function(e,t,n,i,r){"use strict";return{getAll:function(t){t=t||{},n.request({method:"GET",async:!e.is(t.async)||t.async,url:n.prefix+"api/appProperties",success:t.success,failure:t.failure,scope:t.scope})},getAllAsync:function(e){e=e||{},i.getServiceUrl({serviceName:e.serviceName,serviceUrl:e.serviceUrl,onComplete:function(t){var o=i.buildPath(t,e.prefixUrl||(t?"":n.prefix),"api/appProperties",e.id);r.authenticatedRequest(o,{method:"GET",type:"json",onComplete:i.scope(e.success,e.scope),onFailure:i.scope(e.failure,e.scope)})}})},get:function(e,o){return new t(function(t,s){o=o||{},i.getServiceUrl({serviceName:o.serviceName,serviceUrl:o.serviceUrl,onComplete:function(a){var c=i.buildPath(a,o.prefixUrl||(a?"":n.prefix),"api/appProperties",e||"");r.authenticatedRequest(c,{method:"GET",type:"json",onComplete:t,onFailure:s})}})})}}}),define("DS/UWPClientCode/Data/BusinessExperience",["DS/UWPClientCode/Data","DS/UWPClientCode/Data/Utils",["DS","WAFData","WAFData"].join("/")],function(e,t,n){"use strict";return{publishLayout:function(i){return new Promise(function(r,o){t.getServiceUrlWithCSRF({serviceName:i.serviceName,serviceUrl:i.serviceUrl,prefix:i.prefixUrl,onComplete:function(s,a){var c,l;if(!i.modelId)return o("Missing modelId mandatory options.");c=t.buildPath(s,i.prefixUrl||(s?"":e.prefix),"/api/business-experiences","layouts",i.modelId,"publication"),l={method:"POST",headers:t.getDefaultHeaders({csrf:a}),onComplete:r,onFailure:function(e,t){var n;try{n=JSON.parse(t)}catch(e){n=t}o(n)}},n.authenticatedRequest(c,l)},onFailure:o})})}}}),define("DS/UWPClientCode/Data/CommentMedia",["DS/UWPClientCode/Data","DS/UWPClientCode/Data/Utils",["DS","WAFData","WAFData"].join("/")],function(e,t,n){"use strict";var i="api/comments/media/";function r(e){return e+"s"}function o(e,n){return t.buildPath(e,i,n)}function s(e){t.getServiceUrl({serviceName:e.serviceName,serviceUrl:e.serviceUrl,prefix:e.prefixUrl,onComplete:function(t){var n=o(t,[r(e.type),e.id,e.subjectUri].join("/"));e.success&&e.success.call(e.scope,n)}})}return{create:function(e){t.getServiceUrl({serviceName:e.serviceName,serviceUrl:e.serviceUrl,prefix:e.prefixUrl,onComplete:function(i){var s=o(i,[r(e.type),e.subjectUri].join("/")),a={method:"POST",type:"json",data:new FormData,onComplete:t.scope(e.success,e.scope),onFailure:t.scope(e.failure,e.scope)};a.data.append("file",e.data),n.authenticatedRequest(s,a)}})},getUrl:function(e){return s(e)},getThumbnailUrl:function(e){return s(Object.assign({},e,{type:"thumbnail"}))},delete:function(e){t.getServiceUrl({serviceName:e.serviceName,serviceUrl:e.serviceUrl,prefix:e.prefixUrl,onComplete:function(i){var r=o(i,[e.id,e.subjectUri].join("/")),s={method:"DELETE",type:"json",onComplete:t.scope(e.success,e.scope),onFailure:t.scope(e.failure,e.scope)};n.authenticatedRequest(r,s)}})}}}),define("DS/UWPClientCode/Data/Widgets",["UWA/Core","UWA/Utils","DS/UWPClientCode/Data","DS/UWPClientCode/DebugMe","DS/UWPClientCode/I18n","DS/UWPClientCode/Data/Utils",["DS","WAFData","WAFData"].join("/")],function(e,t,n,i,r,o,s){"use strict";var a,c;function l(t,n){if(t){if(e.is(t,"object")){var i=[];Object.keys(t).forEach(function(e){i.push(t[e])}),t=i}for(var r=0,o=t.length;r<o;r++){var s=t[r];if(s){if(s.id===n||"0"===n)return s;var a=l(s.children,n);if(!a&&s.contexts&&(a=l(s.contexts,n)),a)return a}}}}function u(t,n){var i=[],r=[];if(t){e.is(t,"object")&&(Object.keys(t).forEach(function(e){i.push(t[e]),r.push(e)}),t=i);for(var o=0,s=t.length;o<s;o++){var a=!1;if(t[o].id===n)return!r[o]||r[o];if(!0===(a=t[o].contexts?u(t[o].contexts,n):u(t[o].children,n))&&r[o])return r[o];if(a)return a}}}function d(e,t){e.forEach(function(e){e.contextType=t,e.children&&d(e.children,t)})}function p(e,t,n){try{var i=require("DS/UWPClientCode/PublicAPI")._getContext(n,t);!function e(t,n){t.forEach(function(t){t.isContainer&&(t.isEditable=n,t.children&&e(t.children,n))})}(e,i&&i.owner)}catch(e){}}function f(e){return o.buildPath(e.baseUrl,e.prefix,window.ds.anonymous&&e.anonymous?"public/api":"api",e.path)}function m(e){return e?(new DOMParser).parseFromString(e,"text/html").documentElement.textContent:e}function g(e,t){function n(t){return e.getCoordsGroupIds(t).map(function(e){return e&&l([a],e)||{}})}function i(t){return e.getCoordsGroupIds(t).filter(function(e){return!!e})}return o.sequentialize({getSequenceGroups:i,shouldBypass:function(t){return!!e.shouldBypass&&e.shouldBypass(t)||!n(t).reduce(function(e,t){return e||t&&null!=t.consistencyCheck},!1)},fireRequest:function(r){t.call(c,Object.assign({},r,{consistencyChecks:n(r).map(function(e){return e&&e.consistencyCheck})}),function(t,o){var a=o.onComplete,c=o.onFailure;s.authenticatedRequest(t,Object.assign({},o,{onComplete:function(t){var i=t.result||t,o=n(r),s=e.getResponseMapping?e.getResponseMapping(o):{parentConsistencyCheck:o[0]};Object.keys(s).forEach(function(e){var t=s[e];t&&null!=i[e]&&(t.consistencyCheck=i[e],delete i[e])}),a.apply(null,arguments)},onFailure:function(e,t){t&&"CONSISTENCY_CHECK_FAILURE"===t.errorType&&require("DS/UWPClientCode/PublicAPI").callbacks.consistencyCheckFailure.call(null,{widgetIds:i(r),error:t}),c.apply(null,arguments)}}))})}})}return c={getWidget:function(t){o.getServiceUrl({serviceName:t.serviceName,serviceUrl:t.serviceUrl,onComplete:function(a){var c=f({baseUrl:a,prefix:t.prefixUrl||(a?"":n.prefix),anonymous:!0,path:"/widgets/json"}),l={method:"GET",type:"json",data:{id:t.id,uwaUrl:t.url,cs:t.cs,lang:r.getCurrentLanguage()},onComplete:function(e,n,i){var r=e.nb_result;e=e.result,t.success&&t.success.call(t.scope,e,r,i)},onFailure:o.scope(t.failure,t.scope)};i.isEnabled()&&(l.data.debug_me=!0),e.merge(l,t),s.authenticatedRequest(c,l)}})},getWidgetById:function(e){c.getWidget(e)},getWidgetByUrl:function(e){c.getWidget(e)},getWidgetInstance:function(t){var i=l([a],t.id);!t.refresh&&i&&t.success?setTimeout(t.success.call(t.scope,e.clone(i)),0):o.getServiceUrl({serviceName:t.serviceName,serviceUrl:t.serviceUrl,onComplete:function(r){var a=f({baseUrl:r,prefix:t.prefixUrl||(r?"":n.prefix),anonymous:!0,path:"/widget-instances/"+t.id});t.withAccess&&(a+="?withAccess=true");var c={method:"GET",type:"json",onComplete:function(n,r,o){var s=n.nb_result,a=n.result;e.merge(i||{},a),t.success&&t.success.call(t.scope,e.clone(a),s,o)},onFailure:o.scope(t.failure,t.scope)};e.merge(c,t),s.authenticatedRequest(a,c)}})},getWidgetInstanceChildren:function(t){var n,i=l([a],t.id),r=t.success,o=t.contextId,s=t.contextType,u=require("DS/UWPClientCode/PublicAPI")._getActiveContext()||{};function d(){i=l([a],t.id),o&&s&&i.contexts&&i.contexts[o]&&(i={parent:(i=e.clone(i)).contexts[o],children:i.contexts[o].children},u.deletionDate&&(i.parent.isEditable=!1)),i&&r&&r.call(t.scope,e.clone(i))}o&&!s||s&&!o||(i&&r&&!s?setTimeout(r.call(t.scope,e.clone(i)),0):i&&r&&s&&i.contexts&&i.contexts[o]?(i={parent:i.contexts[o],children:i.contexts[o].children},u.deletionDate&&(i.parent.isEditable=!1),setTimeout(r.call(t.scope,e.clone(i)),0)):s&&o?(n={depth:5,success:d},e.merge(n,t),c.getWidgetInstanceContextTree(n)):(n={success:d},e.merge(n,t),c.getWidgetInstancePublicTree(n)))},editWidgetInstance:g({getCoordsGroupIds:function(e){return[(l([a],e.id)||{}).parentId,e.parentId]},getResponseMapping:function(e){return{parentConsistencyCheck:e[0],newParentConsistencyCheck:e[1]}},shouldBypass:function(e){return null==e.parentId&&null==e.coordinates}},function(t,i){o.getServiceUrlWithCSRF({serviceName:t.serviceName,serviceUrl:t.serviceUrl,prefix:t.prefixUrl,onComplete:function(r,s){var c,u=t.success,d=t.failure;var p=f({baseUrl:r,prefix:t.prefixUrl||(r?"":n.prefix),path:"/widget-instances/edit"});c={method:"POST",type:"json",onComplete:function(e,n,i){var r=e.nb_result;function o(){u&&u.call(t.scope,e,r,i)}if(e=e.result,t.noUpdateCache)o();else{var s,c,p,f,m=l([a],t.id);m?(s=m.parentId&&l([a],m.parentId),c=m.parentId,p=m.contextParentId,Object.keys(t).forEach(function(e){"parentId"===e?(f=l([a],t.parentId))&&(m.parentId=t.parentId,f.children=f.children||[],p?f.children.push(s.contexts.splice(s.contexts.indexOf(m),1)[0]):c&&f.children.push(s.children.splice(s.children.indexOf(m),1)[0])):"data"===e?(t.data=t.data||{},m.data=JSON.stringify(t.data)):-1!==["widgetId","data","title","name","coordinates"].indexOf(e)&&(m[e]=t[e])}),o()):d&&d.call(t.scope,e,r,i)}},onFailure:function(e,n){var i;try{i=JSON.parse(n)}catch(e){i=n}d&&d.call(t.scope,i)},data:JSON.stringify({id:t.id,widgetId:t.widgetId,parentId:t.parentId,data:t.data,title:t.title,name:t.name,coordinates:t.coordinates||t.rank,consistencyCheck:(t.coordinates||t.parentId)&&t.consistencyChecks[0],newConsistencyCheck:t.consistencyChecks[1],currentParentId:(t.coordinates||t.parentId)&&(l([a],t.id)||{}).parentId}),headers:o.getDefaultHeaders({csrf:s})},e.merge(c,t),i(p,c)}})}),patchWidgetInstanceData:function(t){o.getServiceUrlWithCSRF({serviceName:t.serviceName,serviceUrl:t.serviceUrl,prefix:t.prefixUrl,onComplete:function(i,r){var c,u=t.success,d=t.failure;var p=f({baseUrl:i,prefix:t.prefixUrl||(i?"":n.prefix),path:"/widget-instances/patch"});c={method:"POST",type:"json",onComplete:function(e,n,i){if(t.noUpdateCache)u&&u(e,n,i);else{var r,o=l([a],t.id);o?(r=JSON.parse(o.data||"{}"),t.patches.forEach(function(e){var t=e.path.substring(1),n=e.op;"add"===n||"replace"===n?r[t]=e.value:"remove"===n&&delete r[t]}),o.data=JSON.stringify(r),u&&u(e,n,i)):d&&d(e,n,i)}},onFailure:function(e,n){var i;try{i=JSON.parse(n)}catch(e){i=n}d&&d.call(t.scope,i)},data:JSON.stringify({id:t.id,patches:t.patches}),headers:o.getDefaultHeaders({csrf:r})},e.merge(c,t),s.authenticatedRequest(p,c)}})},reorderWidgetInstances:g({getCoordsGroupIds:function(e){return[e.parentId]}},function(t,i){o.getServiceUrlWithCSRF({serviceName:t.serviceName,serviceUrl:t.serviceUrl,prefix:t.prefixUrl,onComplete:function(r,s){var c,u,d=t.success;u=f({baseUrl:r,prefix:t.prefixUrl||(r?"":n.prefix),path:"/widget-instances/reorder"}),c={method:"POST",type:"json",onComplete:function(e,n,i){var r=e.nb_result,o=l([a],t.parentId);o.children=o.children||[],t.children.forEach(function(e){o.children.some(function(t){if(t.id===e.id)return t.coordinates=e.coordinates||e.rank+"",t.rank=e.rank,!0})}),d&&d.call(t.scope,e,r,i)},onFailure:o.scope(t.failure,t.scope),data:JSON.stringify({parentId:t.parentId,children:t.children,consistencyCheck:t.consistencyChecks[0]}),headers:o.getDefaultHeaders({csrf:s})},e.merge(c,t),i(u,c)}})}),createWidgetInstance:g({getCoordsGroupIds:function(e){return[e.parentId]}},function(t,i){o.getServiceUrlWithCSRF({serviceName:t.serviceName,serviceUrl:t.serviceUrl,prefix:t.prefixUrl,onComplete:function(r,s){var c,m,g=t.success,h=t.failure;!function e(t){t&&t.forEach(function(t){t.data||(t.data={}),t.children&&e(t.children)})}(t.children),m=f({baseUrl:r,prefix:t.prefixUrl||(r?"":n.prefix),path:"/widget-instances/add"}),c={method:"POST",type:"json",onComplete:function(n,i,r){var o=n.nb_result;n=n.result;var s,c=l([a],t.parentId);c?t.context&&t.context.modelId&&t.context.type&&n.contextParentId?(c.contexts=c.contexts||{},d([n],t.context.type),c.contexts[t.context.id]=e.clone(n),g&&g.call(t.scope,n,o,r)):(c.children=c.children||[],d([n],c.contextType),(s=u([a],t.parentId))&&p([n],c.contextType,s),c.children.push(e.clone(n)),g&&g.call(t.scope,n,o,r)):h&&h.call(t.scope)},onFailure:o.scope(t.failure,t.scope),data:JSON.stringify({widgetId:t.widgetIdOrUrl,name:t.name,data:t.data||{},parentId:t.parentId,coordinates:t.coordinates||t.rank,title:t.title,children:t.children,context:t.context||void 0,consistencyCheck:t.consistencyChecks[0]}),headers:o.getDefaultHeaders({csrf:s})},e.merge(c,t),i(m,c)}})}),createWidgetInstanceFromApp:g({getCoordsGroupIds:function(e){return[e.parentId]}},function(t,i){o.getServiceUrlWithCSRF({serviceName:t.serviceName,serviceUrl:t.serviceUrl,prefix:t.prefixUrl,onComplete:function(r,s){var c,u=t.success,p=t.failure,g=m(t.name),h=m(t.title);var v=f({baseUrl:r,prefix:t.prefixUrl||(r?"":n.prefix),path:"/widget-instances/addApp"});c={method:"POST",type:"json",onComplete:function(n,i,r){var o=n.nb_result;n=n.result;var s=l([a],t.parentId);s||t.preview?(t.preview||(s.children=s.children||[],d([n],s.contextType),s.children.push(e.clone(n))),u&&u.call(t.scope,n,o,r)):p&&p.call(t.scope)},onFailure:o.scope(t.failure,t.scope),data:JSON.stringify({appId:t.appId,parentId:t.parentId,dataUrl:t.dataUrl,data:t.data||{},name:g,title:h,coordinates:t.coordinates||t.rank,preview:t.preview,consistencyCheck:t.consistencyChecks[0]}),headers:o.getDefaultHeaders({csrf:s})},e.merge(c,t),i(v,c)}})}),copyContextTree:function(t){o.getServiceUrlWithCSRF({serviceName:t.serviceName,serviceUrl:t.serviceUrl,prefix:t.prefixUrl,onComplete:function(i,r){var c,u=t.success;c=f({baseUrl:i,prefix:t.prefixUrl||(i?"":n.prefix),path:"/widget-instances/copy-tree"});var m={method:"POST",type:"json",onComplete:function(n,i,r){var o=l([a],n.contextParentId);o&&(o.contexts=o.contexts||{},d([n],t.targetContext.type),p([n],t.targetContext.type,t.targetContext.modelId),o.contexts[t.sourceContext.modelId]&&(n.sourceModelId=t.sourceContext.modelId,o.contexts[t.sourceContext.modelId].children.forEach(function(e,t){n.children[t].sourceId=e.id})),o.contexts[t.targetContext.modelId]=e.clone(n),u&&u.call(t.scope,n,1,r))},onFailure:o.scope(t.failure,t.scope),data:JSON.stringify({sourceContext:t.sourceContext,targetContext:t.targetContext,name:t.name,coordinates:t.coordinates||t.rank,depth:t.depth,replacement:t.replacement}),headers:o.getDefaultHeaders({csrf:r})};e.merge(m,t),s.authenticatedRequest(c,m)}})},copySubTree:g({getCoordsGroupIds:function(e){return[e.targetContainerId||(l([a],e.sourceId)||{}).parentId]}},function(t,i){o.getServiceUrlWithCSRF({serviceName:t.serviceName,serviceUrl:t.serviceUrl,prefix:t.prefixUrl,onComplete:function(r,s){var c,m=t.success;var g={method:"POST",type:"json",url:c=f({baseUrl:r,prefix:t.prefixUrl||(r?"":n.prefix),path:"/widget-instances/copy-subtree"}),onComplete:function(n,i,r){var o,s;(o=l([a],n.parentId))&&(o.children=o.children||[],d([n],o.contextType),(s=u([a],t.sourceId))&&p([n],o.contextType,s),n.sourceId=t.sourceId,o.children.push(e.clone(n)),m&&m.call(t.scope,n,1,r))},onFailure:o.scope(t.failure,t.scope),data:JSON.stringify({sourceId:t.sourceId,targetContainerId:t.targetContainerId,name:t.name,coordinates:t.coordinates||t.rank,depth:t.depth,replacement:t.replacement,consistencyCheck:t.consistencyChecks[0]}),headers:o.getDefaultHeaders({csrf:s})};e.merge(g,t),i(c,g)}})}),removeWidgetInstance:g({getCoordsGroupIds:function(e){return[(l([a],e.id)||{}).parentId]}},function(t,i){o.getServiceUrlWithCSRF({serviceName:t.serviceName,serviceUrl:t.serviceUrl,prefix:t.prefixUrl,onComplete:function(r,s){var c,u=t.success;var d=f({baseUrl:r,prefix:t.prefixUrl||(r?"":n.prefix),path:"/widget-instances/"+t.id});c={method:"DELETE",type:"json",onComplete:function(e,n,i){var r=e.nb_result;e=e.result;var o=l([a],t.id),s=o&&o.contextParentId,c=o&&o.parentId,d=o&&(s||o.parentId);if(d){var p=l([a],d);p&&(s?p.contexts.splice(p.contexts.indexOf(o),1):c&&p.children.splice(p.children.indexOf(o),1))}u&&u.call(t.scope,e,r,i)},onFailure:o.scope(t.failure,t.scope),data:t.consistencyChecks[0]&&JSON.stringify({parentId:(l([a],t.id)||{}).parentId,consistencyCheck:t.consistencyChecks[0]}),headers:o.getDefaultHeaders({csrf:s})},e.merge(c,t),i(d,c)}})}),getCategories:function(t){t=t||{},o.getServiceUrl({serviceName:t.serviceName,serviceUrl:t.serviceUrl,onComplete:function(i){var r=f({baseUrl:i,prefix:t.prefixUrl||(i?"":n.prefix),path:"/categories/list"}),a={method:"GET",type:"json",onComplete:function(e,n,i){var r=e.nb_result;e=e.result,t.success&&t.success.call(t.scope,e,r,i)},onFailure:o.scope(t.failure,t.scope)};e.merge(a,t),s.authenticatedRequest(r,a)}})},getConfigurations:function(i){o.getServiceUrl({serviceName:i.serviceName,serviceUrl:i.serviceUrl,onComplete:function(r){var a,c=e.is(i.start)?i.start:0,l=e.is(i.limit)?i.limit:100,u=f({baseUrl:r,prefix:i.prefixUrl||(r?"":n.prefix),path:"/widgetConfigurations/list/"+i.id});u+="?"+t.toQueryString({start:c,limit:l}),a={method:"GET",type:"json",onComplete:function(e,t,n){var r=e.nb_result;e=e.result,i.success&&i.success.call(i.scope,e,r,n)},onFailure:o.scope(i.failure,i.scope)},e.merge(a,i),s.authenticatedRequest(u,a)}})},getWidgetInstancePublicTree:function(t){o.getServiceUrl({serviceName:t.serviceName,serviceUrl:t.serviceUrl,onComplete:function(i){var c,l=t.success;var u=f({baseUrl:i,prefix:t.prefixUrl||(i?"":n.prefix),anonymous:!0,path:"/widget-instances/publicTree"});c={method:"GET",type:"json",onComplete:function(e,n,i){a=e,l&&l.call(t.scope,e,1,i)},onFailure:o.scope(t.failure,t.scope),data:{fp:t.cacheId,lang:r.getCurrentLanguage()}},e.merge(c,t),s.authenticatedRequest(u,c)}})},getWidgetInstanceContextTree:function(t){var i=t.contextId,c=t.contextType;i&&c&&o.getServiceUrl({serviceName:t.serviceName,serviceUrl:t.serviceUrl,onComplete:function(u){var m,g,h=t.success;function v(r){var g=f({baseUrl:u,prefix:t.prefixUrl||(u?"":n.prefix),anonymous:!0,path:"/contexts/"+t.contextType+"/"+t.contextId+"/fingerprints"});m={method:"GET",onComplete:function(n){var o,s,u;r.children.forEach(function(e){Object.keys(n).forEach(function(t){e.widgetId===t&&(e.checksum=n[t])}),(e.children||[]).forEach(function(e){Object.keys(n).forEach(function(t){e.widgetId===t&&(e.checksum=n[t])})})}),o=r,(u=l([a],t.id))&&!o.defaultContext&&c&&i&&o.contextParentId?(u.contexts=u.contexts||{},d([o],c),p([o],c,i),u.contexts[i]=e.clone(o),h&&h.call(t.scope,o,1,s)):!u||o.defaultContext||o.contextParentId?h&&h.call(t.scope,o,1,s):(d([o],u.contextType),u.children=e.clone(o.children),h&&h.call(t.scope,o,1,s))},onFailure:o.scope(t.failure,t.scope)},e.merge(m,t),s.authenticatedRequest(g,m)}g=f({baseUrl:u,prefix:t.prefixUrl||(u?"":n.prefix),anonymous:!0,path:"/widget-instances/contextTree"}),m={method:"GET",type:"json",onComplete:v,onFailure:o.scope(t.failure,t.scope),data:{contextParent:t.id,type:c,modelId:i,fp:t.cacheId,depth:t.depth,lang:r.getCurrentLanguage()}},e.merge(m,t),s.authenticatedRequest(g,m)}})}}}),define("DS/UWPClientCode/WidgetFactory",["UWA/Core","DS/UWPClientCode/Data/Widgets","DS/UWPClientCode/UWA/Environment","DS/UWPClientCode/PublicAPI","DS/UIKIT/Alert"],function(e,t,n,i,r){"use strict";var o=new r({closable:!0,visible:!0,autoHide:!1,className:"wp-alert"}).inject(document.body,"top");return{load:function(){function r(t,n,r,o){var l,u={};u.plugins=[],u.preferences=[],u.metas={},u.style="",u.isolationLevel=0,u.appId=null,u.token=null,u.isContainer=!1;try{l=JSON.parse(t.data)||{}}catch(e){l={}}t.parsedData=l,t.appId?i.callbacks.loadExternalWidget(t,function(t,n,i,r,o,l){return function(l){var u;if(e.extend(t,l),t.userNotAllowed)t.isolationLevel=0,u={id:t.widgetId,body:"<p>"+(t.userNotAllowedMessage||e.i18n("userNotAllowed"))+"</p>",userNotAllowed:!0},e.merge(u,i),c(u,t,n,i,r,o,void 0);else if(t.isolationLevel>0){var d=document.createElement("textarea");t.name&&(d.innerHTML=t.name,t.name=d.value),t.title&&(d.innerHTML=t.title,t.title=d.value),d=null,a(t,n,i,r,o,void 0)}else s(t,n,i,r,o,void 0)}}(t,n,u,l,r)):t.isolationLevel>0?a(t,n,u,l,r,o):s(t,n,u,l,r,o)}function s(n,i,r,s,a,l){t.getWidget({url:n.widgetId,cs:n.checksum,success:function(e){c(e,n,i,r,s,a,l)},failure:function(){o.add({className:"error",message:e.String.format(e.i18n('The widget "{0}" cannot be loaded'),n.name)}),l&&l(n)}})}function a(e,t,n,i,r,o){c({},e,t,n,i,r,o)}function c(t,r,o,s,a,c,l){if(t){var u={};u.name=r.name||t.name||"",u.title=r.title||t.title||u.name,u.isolationLevel=e.is(r.isolationLevel)?r.isolationLevel:e.is(t.isolationLevel)?t.isolationLevel:s.isolationLevel,u.appId=t.appId||r.appId||s.appId,c&&c.serviceName&&!u.appId&&!r.children&&(u.widgetId=r.parsedData.moduleUrl),u.widgetId=u.widgetId||r.widgetId||t.id,u.body=t.body,u.metas=t.metas||s.metas,u.plugins=t.plugins||s.plugins,u.preferences=t.preferences||s.preferences,u.script=t.script,u.style=t.style||"",u.isContainer=t.isContainer||s.isContainer,u.token=t.token||r.token||s.token,u.checksum=r.checksum,u.preview=r.preview,u.userNotAllowed=r.userNotAllowed,u.id=u.preview?"preview-"+e.Utils.getUUID().substr(0,6):r.id,u.children=r.children,u.coordinates=r.coordinates,u.el=r.el,u.parentId=r.parentId,u.parent=r.parent,u.data=a,u.allowedChildrenContextType=r.allowedChildrenContextType,u.warnings=r.warnings,u.initialView=r.initialView,u._isNew=r._isNew,(c?new c(u):new n(u)).loadWidget(u.id,{data:a,fetcher:t,onComplete:function(t,n,s){var c=(s=s||{}).data?e.clone(s.data):a;r.widget=t,i.callbacks.beforeWidgetLaunch(t),t.environment.launchWidget(c),o&&o(r)}})}}return function(n,i,o,s){e.is(n.id)&&!n.parent?t.getWidgetInstance({id:n.id,success:function(t){n.id=t.id,e.merge(n,t),r(n,i,o,s)}}):r(n,i,o,s)}}()}}),define("DS/UWPClientCode/WidgetCatalog",["UWA/Core","UWA/Event","UWA/Utils","UWA/Promise","DS/UWPClientCode/PublicAPI","DS/PubSub/PubSub","DS/UWPClientCode/WidgetFactory","DS/UWPClientControls/Modal","DS/UIKIT/Mask"],function(e,t,n,i,r,o,s,a,c){"use strict";var l,u="wp-drag",d="added",p="added-check",f="preview",m="direct-add-disable",g=null,h=null,v=!1,C=null,U=null,y="100%",x=!1,S=!1;function w(o){return l.isBuild()?i.resolve():function(t){return new i(function(n,i){var o=r.getAllWidgetConfigurations(!1,t);o&&0!==o.length?n(o):o=r.getAllWidgetConfigurations(!0,e.merge({success:n},t))})}(o).then(function(i){var r,o,d=e.createElement;h=d("div",{class:"widget-catalog"}),o=d("ul",{class:"widget-list"}),r=d("div",{class:"catalog-close",events:{click:function(e){t.stop(e),l.close()}}}),i.forEach(function(i){var r,l=i.name;r=d("li",{class:"widget "+u,title:l,html:[{tag:"img",class:"icon",src:i.icon},{tag:"div",class:"text-cell",html:{tag:"div",class:l.length>26?"ellipsis":"",html:{tag:"div",class:"text",text:l}}},{tag:"div",class:"direct-add",events:{click:function(e){if(t.stop(e),!S){var n=r.getData("conf");n.configId=n.id,b(n,r)}}}}],events:{click:function(i){t.stop(i);var o=r.getData("conf");o.configId=o.id,function(t,i){var r,o,l,d,p,m=e.createElement,g=!1,h={},v=n.getUUID();U&&U.hide();function C(){var n;e.Widgets.instances.forEach(function(e){var t=e.id||null;t&&t===v&&(n=e.data||{})}),n&&(t.defaultData=n),b(t,i),U.hide()}i.addClassName(f),h.data=t.defaultData,h.title=o=t.name,h.parent=!1,h.widgetId=t.widgetId,h.id=v,l=m("div",{class:"preview-ctn",html:{tag:"div",html:[{tag:"div",class:"widget-icon",html:{tag:"img",class:"icon",src:t.icon||""}},{tag:"div",class:"widget-desc",html:t.description||""}]}}),d=m("div",{class:"error-widget",text:e.i18n("This widget cannot be loaded, please try again later.")}),r=h.el=m("div",{class:"module"}).inject(l),p=setTimeout(function(){c.unmask(r),d.inject(r)},1e4),U=new a({className:"wp-widget-preview-modal",title:e.i18n("Widget preview:")+" "+o,display:!0,overlay:!0,draggable:!1,destroy:!0,content:l,buttons:[{value:e.i18n("Cancel"),className:"primary",key:"esc",handler:function(){U.hide()}}],events:{onShow:function(){g?c.unmask(r):c.mask(r,e.i18n("Loading..."))},onHide:function(){var e,t;i.removeClassName(f),t=h.widget||null,(e=t?t.environment:null)&&e.destroy(),U=null}}}),s.load(h,function(){var t=h.widget,n=t?t.environment:null,i=n?n.wp.menu:null,o=n?n.html.header:null;t&&(clearTimeout(p),d.hide(),g=!0,c.unmask(r),t.elements.actionFullscreen&&t.elements.actionFullscreen.destroy(),U.removeButton(0),U.addButtons([{value:e.i18n("Add"),className:"primary",handler:C},{value:e.i18n("Cancel"),key:"esc",handler:function(){U.hide()}}]),i&&(i.removeItem({name:"share"}),i.removeItem({name:"duplicate"}),i.removeItem({name:"maximize"}),i.removeItem({name:"delete"})),o&&(o.removeEvent("dblclick"),o.removeClassName(u)))},void 0)}(o,r)}}}),i.configId=i.id,r.setAttribute("data-id",i.id),r.setData("conf",i),o.grab(r)}),h.grab(o),h.grab(r),h.inject(g||document.body),g=null})}function b(e,t){e&&(S=!0,h.addClassName(m),C(function(n){o.dispatch("widgetAddFromCatalog-"+n,[e,"101"]),t&&(t.addClassName(p),t.removeClassName(d),setTimeout(function(){h.removeClassName(m),t.removeClassName(p),t.addClassName(d),S=!1},1e3))}))}return l={init:function(e,t){l.setFetchWhereToAddWidget(t),l.isBuild()||(g=e,o.add("WidgetCatalog-hide",l.hide),o.add("WidgetCatalog-show",l.show),o.add("WidgetCatalog-close",l.close),o.add("WidgetCatalog-open",l.open))},setFetchWhereToAddWidget:function(t){"function"===e.typeOf(t)&&(C=t)},isBuild:function(){return!!h},open:function(e){return w(e).then(function(){l.setWidth(y),l.isCollapsed()&&l.collapse(),l.show(!0),h.show(),v=!0})},close:function(){var e;l.isBuild()&&(h.hide(),v=!1,(e=h.getElements(".widget"))&&e.forEach(function(e){e.removeClassName(d),e.removeClassName(p)}),U&&(U.destroy(),U=null))},isOpen:function(){return v},hide:function(e){l.isBuild()&&(l.isOpen()||e)&&h.addClassName("hide-catalog")},show:function(e){l.isBuild()&&(l.isOpen()||e)&&h.removeClassName("hide-catalog")},toggle:function(e){l.isOpen()?l.close(e):l.open(e)},collapse:function(){x=!0,l.isBuild()&&h.addClassName("collapsed")},expand:function(){x=!1,l.isBuild()&&h.removeClassName("collapsed")},isCollapsed:function(){return x},setWidth:function(e){y=e,l.isBuild()&&h.setStyle("width",e)},resetWidth:function(){y="100%",l.isBuild()&&l.isOpen()&&h.setStyle("width","100%")}}}),define("DS/UWPClientCode/Standalone/Bootstrap",["UWA/Core","DS/UWPClientCode/WidgetFactory","DS/UWPClientCode/PublicAPI",["DS","i3DXCompass","i3DXCompass"].join("/")],function(e,t,n,i){"use strict";return{start:function(){var r={};standaloneAppId&&(r.el=e.extendElement(document.body),r.parent=!1,r.isolationLevel=1,r.preview=!0,r.appId=standaloneAppId,standaloneAppData&&(r.data=standaloneAppData),e.createElement("div",{id:"compass-container",styles:{display:"none"}}).inject(document.body),e.createElement("div",{id:"my-apps-container",styles:{display:"none"}}).inject(document.body),i.initialize({compassTarget:"compass-container",appsTarget:"my-apps-container",launchOnSameDomain:!0,myAppsBaseUrl:n.getApplicationConfiguration("app.urls.myapps")||"",userId:dsUserLogin}),i.getAppInfo({appId:standaloneAppId,onComplete:function(n){n?(r=e.extend(r,{widgetId:e.is(n.launchInfos)?n.launchInfos:n.platforms[0].launchInfos,isolationLevel:e.is(n.isolationLevel)?n.isolationLevel:n.platforms[0].isolationLevel,token:e.is(n.checksum)?n.checksum:n.platforms[0].checksum}),t.load(r,function(){document.body.getElement("iframe").height=window.innerHeight})):(r.el.setText(e.i18n("Unable to load this widget, please try again. If the problem persists please try another widget.")),r.el.addClassName("launching-error"))}}))}}}),define("DS/UWPClientCode/Navigation",["require","UWA/Core","UWA/Promise","DS/PubSub/PubSub","DS/UWPClientCode/PublicAPI"],function(e,t,n,i,r){"use strict";var o,s="/",a=":";return o={pagesHierarchy:{},fullPagesHierarchy:{},currentAddress:[],previousAddress:[],navigationMode:"",preNavigationHandler:n.resolve.bind(n),postNavigationHandler:n.resolve.bind(n),setMode:function(e){this.navigationMode=e,"PATH"===this.navigationMode?(this.baseUrl=dsBaseUrl,this.pushPath=function(e){var n,i;e.charAt(0)===s&&(e=e.substr(1)),history.pushState(null,"",t.Utils.parseUrl(this.baseUrl+e).source),window.dispatchEvent((n="popstate","function"==typeof Event?i=new Event(n):(i=document.createEvent("Event")).initEvent(n,!0,!0),i))},o.routeTo=function(e){this.pushPath(e)},this.getCardUrl=function(e,t){return s+t.join(s)},o.getUrlParameter=function(e){var t=this,n=null;return this.currentAddress.every(function(i,r){return i.name!==e||!t.currentAddress[r+1]||(n=t.currentAddress[r+1].name,!1)}),n}):(o.routeTo=function(e){this.goToUrl(e)},this.getCardUrl=function(e,t){var n=e[0]&&e[0].param?t[0]+":"+e[0].param:t[0];if(t.length>1)for(var i=1,r=t.length;i<r;i++)n+=s+t[i],i!==r-1&&e[i].param&&(n+=":"+e[i].param);return n},o.getUrlParameter=function(e){var t=null;return this.currentAddress.every(function(n){return n.name!==e||(t=n.param,!1)}),t})},setHierarchy:function(e){var n={};!function e(n,i){n.urlPart&&(i[n.urlPart]={},t.extend(i[n.urlPart],n),delete(i=i[n.urlPart]).children),n.children&&n.children.forEach(function(t){e(t,i)})}(e,n),this.pagesHierarchy=n,this.fullPagesHierarchy=e},getCurrentAdress:function(){return this.currentAddress},getPreviousAdress:function(){return this.previousAddress},historyChanged:function(o){var c,l=this,u=function(e){var t=[];return(e="#"===(e="string"==typeof e&&null!==e?e:"")[0]?e.substr(1):e).split(s).forEach(function(e){e&&(e=e.split(a),t.push({name:e[0],param:e[1]}))}),t}(o),d=n.deferred(),p=[];return this.previousAddress=this.currentAddress,this.currentAddress=u,this.preNavigationHandler(this.currentAddress).then(function(){c=l.pagesHierarchy,u.forEach(function(e){var t=c[e.name];t&&(t.urlHandler&&p.push(t.urlHandler),c=c[e.name])}),e(p,function(){var o,s=arguments,a=n.deferred(),p=a.promise,f=0;c=l.pagesHierarchy,u.forEach(function(e,n,r){if(c[e.name])if((c=c[e.name]).urlHandler)try{(o=s[f++])&&t.is(o.isAccessible,"function")&&(p=p.then(function(e,t,n,i){return function(){return e(t,n,i)}}(o.isAccessible,e.name,e.param,r)).then(function(e){return function(t){if(t&&t.shouldChangeCard)i.dispatch(i.events.cardNavigation,[e.parentId,e.name],!0);else if(!0!==t)throw"Handler returned wrong value !"}}(c)))}catch(e){}else p=p.then(function(e){return function(){i.dispatch(i.events.cardNavigation,[e.parentId,e.name,!0])}}(c))}),p.then(function(){l.postNavigationHandler(l.currentAddress).then(d.resolve),!r.getApplicationConfiguration("app.usage.disableautopagetracking")&&e(["DS/Usage/TrackerAPI"],function(e){try{e.trackPageView(location.pathname+location.search+location.hash,document.title)}catch(e){}})}),a.resolve()})}),d.promise},setNavigateSuccessHandler:function(e){t.is(e,"function")&&(this.postNavigationHandler=e)},setPreNavigateHandler:function(e){t.is(e,"function")&&(this.preNavigationHandler=e)},goToUrl:function(e){window.location.hash=e},handleCardChange:function(e){var n,i=this.currentAddress,r=!0,o=[];return function e(t,n){var i,r,s=["urlHandler","parentId","name"];for(i in t){if(!t.hasOwnProperty(i)||s.indexOf(i)>=0)break;if("id"===i&&t.id===n)return t;if("id"!==i&&(r=e(t[i],n)))return o.unshift(i),r}}(this.pagesHierarchy,e),(!t.is(i[0])||"east"!==i[0].name)&&o.some(function(e,n){if(!t.is(i[n])||e!==i[n].name)return!0})&&(n=this.getCardUrl(i,o),"PATH"===this.navigationMode&&"social"===o[0]&&(n+=window.location.hash),this.routeTo(n),r=!1),r}}}),define("DS/UWPClientCode/Data/Notification",["module","UWA/Utils","DS/UWPClientCode/Data","DS/UWPClientCode/Data/Utils","DS/Logger/Logger",["DS","WAFData","WAFData"].join("/")],function(e,t,n,i,r,o){"use strict";var s=r.getLogger(e);return{get:function(e){i.getServiceUrl({serviceName:e.serviceName,serviceUrl:e.serviceUrl,onComplete:function(t){var r=i.buildPath(t,e.prefixUrl||(t?"":n.prefix),"api/notification",e.id);o.authenticatedRequest(r,{method:"GET",type:"json",onComplete:i.scope(e.success,e.scope),onFailure:i.scope(e.failure||s.error,e.scope)})}})},getAll:function(e){e=e||{},i.getServiceUrl({serviceName:e.serviceName,serviceUrl:e.serviceUrl,onComplete:function(t){var r=e.limit&&"number"==typeof e.limit?e.limit:7,a=i.buildPath(t,e.prefixUrl||(t?"":n.prefix),"api/notification/unread");o.authenticatedRequest(a,{method:"GET",type:"json",data:{limit:r},onComplete:i.scope(e.success,e.scope),onFailure:i.scope(e.failure||s.error,e.scope)})}})},setPublic:function(e){e=e||{},i.getServiceUrlWithCSRF({serviceName:e.serviceName,serviceUrl:e.serviceUrl,prefix:e.prefixUrl,onComplete:function(t,r){var a=i.buildPath(t,e.prefixUrl||(t?"":n.prefix),"api/share/public",e.id);o.authenticatedRequest(a,{method:"POST",type:"json",data:JSON.stringify({handler:e.handler,contentData:e.data}),headers:i.getDefaultHeaders({csrf:r}),onComplete:function(t,n,i){var r=t.nb_result;t=t.result,e.success&&e.success.call(e.scope,t,r,i)},onFailure:i.scope(e.failure||s.error,e.scope)})}})},createPrivate:function(e){e=e||{},i.getServiceUrlWithCSRF({serviceName:e.serviceName,serviceUrl:e.serviceUrl,prefix:e.prefixUrl,onComplete:function(t,r){var a=i.buildPath(t,e.prefixUrl||(t?"":n.prefix),"api/share",e.id);o.authenticatedRequest(a,{method:"POST",type:"json",data:JSON.stringify({handler:e.handler,contentData:e.data,to:e.to,message:e.message}),headers:i.getDefaultHeaders({csrf:r}),onComplete:i.scope(e.success,e.scope),onFailure:i.scope(e.failure||s.error,e.scope)})}})},create:function(e){e=e||{},i.getServiceUrlWithCSRF({serviceName:e.serviceName,serviceUrl:e.serviceUrl,prefix:e.prefixUrl,onComplete:function(t,a){var c=e.accessType||3,l={widgetInstanceId:e.widgetInstanceId,handler:e.handler,accessType:c};e||r.warn("create share notification: options object is mandatory"),e.widgetInstanceId||r.warn("create share notification: widgetInstanceId is mandatory"),e.handler||r.warn("create share notification: handler is mandatory"),e.recipientsByLogin&&(l.recipientsByLogin=e.recipientsByLogin),e.recipientsByEmail&&(l.recipientsByEmail=e.recipientsByEmail),e.message&&(l.message=e.message),e.data&&(l.contentData=e.data);var u=i.buildPath(t,e.prefixUrl||(t?"":n.prefix),"api/share");o.authenticatedRequest(u,{method:"POST",type:"json",data:JSON.stringify(l),headers:i.getDefaultHeaders({csrf:a}),onComplete:i.scope(e.success,e.scope),onFailure:i.scope(e.failure||s.error,e.scope)})}})},publish:function(e){e=e||{},i.getServiceUrlWithCSRF({serviceName:e.serviceName,serviceUrl:e.serviceUrl,prefix:e.prefixUrl,onComplete:function(a,c){var l;if(l={type:"NOTIF_UI",message:{nls:{msg:e.messageId},actions:[{type:"link",options:{event:{type:"url",options:{service:e.service,uri:e.uri,type:"GET"}}}}],icon:{type:"login",data:e.user}},service:{appID:e.appId,notificationID:e.notificationId}},e.data&&(l.message.nls.data=e.data),e.groupRecipients&&e.groupRecipients.length&&e.platformId)l.users_groups=e.groupRecipients,l.platformID=e.platformId;else{if(!e.userRecipients||!e.userRecipients.length)return r.warn("Send 3DNotification: options.userRecipients or options.groupRecipients is mandatory."),e.failure,void e.scope;l.users_target=e.userRecipients}var u=i.buildPath(a,e.prefixUrl||(a?"":n.prefix),"api/notification/external");u+=e.platformId?"?"+t.toQueryString({platform:e.platformId}):"",o.authenticatedRequest(u,{method:"POST",type:"text",data:JSON.stringify({items:[l]}),headers:i.getDefaultHeaders({csrf:c}),onComplete:i.scope(e.success,e.scope),onFailure:i.scope(e.failure||s.error,e.scope)})}})},mail:function(e){e=e||{},i.getServiceUrlWithCSRF({serviceName:e.serviceName,serviceUrl:e.serviceUrl,prefix:e.prefixUrl,onComplete:function(t,a){e||r.warn("send notification by mail: options object is mandatory"),e.notificationId||r.warn("send notification by mail: notificationId is mandatory");var c=i.buildPath(t,e.prefixUrl||(t?"":n.prefix),"api/notification/mail");o.authenticatedRequest(c,{method:"POST",type:"json",data:JSON.stringify({notificationId:e.notificationId}),headers:i.getDefaultHeaders({csrf:a}),onComplete:i.scope(e.success,e.scope),onFailure:i.scope(e.failure||s.error,e.scope)})}})}}}),define("DS/UWPClientCode/Data/NotificationModel",["UWA/Core","DS/UWPClientCode/Data/Notification"],function(e,t){"use strict";var n,i=!1,r=[],o=function(n){this.notificationStore=n,this.getById=function(t){var n=this.notificationStore.detect(function(e){return t===""+e.id});return n?e.clone(n):null},this.getPublic=function(e){t.get({serviceName:e.serviceName,serviceUrl:e.serviceUrl,prefixUrl:e.prefixUrl,id:e.id,success:e.success})},this.getUnRead=function(){if(this.notificationStore)return e.clone(this.notificationStore)}};return{fetch:function(e){e=e||{},!i||e.force?(r.push(e),1===r.length&&(i=!1,t.getAll({serviceName:e.serviceName,serviceUrl:e.serviceUrl,prefixUrl:e.prefixUrl,success:function(e){var t,s=0,a=r.length;for(n=new o(e);s<a;s++)(t=r[s]).success&&"function"==typeof t.success&&t.success.call(t.scope,n);i=!0,r=[]},failure:function(){for(var e,t=0,n=r.length;t<n;t++)(e=r[t]).failure&&"function"==typeof e.failure&&e.failure.call(e.scope);r=[]}}))):e.success&&"function"==typeof e.success&&setTimeout(function(){e.success.call(e.scope,n)},0)},isFetched:function(){return i}}}),define("DS/UWPClientCode/Bootstrap",["UWA/Core","UWA/Event","UWA/Utils","UWA/Element","UWA/Promise","DS/UWPClientCode/Data/Widgets","DS/UWPClientCode/Navigation","DS/PubSub/PubSub","DS/UWPClientCode/PublicAPI","DS/WebappsUtils/Performance","DS/UWPClientControls/Utils","ds/Csrf","ds/TranslateUWA","ds/Ajax","DS/UWPClientCode/UWA/Element","DS/MessageBus/MessageBus"],function(e,t,n,i,r,o,s,a,c,l,u){"use strict";var d,p,f,m=function(){},g="wp_login_location";function h(){var e=r.deferred();return t.onDomReady(function(){l.mark("wp_bootstrap_ondomready"),document.documentElement.className+=" "+(u.hasTouch()?"touch":"no-touch"),n.Client.Platform.ipad&&(document.documentElement.className+=" ipados"),e.resolve()}),e.promise}function v(){require(["DS/Logger/Logger","DS/Logger/Appenders/Quake"],function(e,t){e.addAppender("Quake",t)},m)}function C(){var t,o=r.resolve(),a="PATH"===p?function(){var e=location.protocol+"//"+location.host+location.pathname;return e=e.substring(dsBaseUrl.length),s.historyChanged(e)}:function(e){var t,i;return t=window.location.hash,(i=n.parseUrl(e.newURL))&&i.anchor&&(t=i.anchor),s.historyChanged(t)};return d&&(e.is(d.onNavigateSuccess,"function")&&s.setNavigateSuccessHandler(d.onNavigateSuccess),e.is(d.preNavigate,"function")&&s.setPreNavigateHandler(d.preNavigate),e.is(d.beforeNavigationStarts,"function")&&((o=d.beforeNavigationStarts())instanceof r||o instanceof window.Promise||(o=r.resolve()))),o.then(function(){return s.setMode(p),"PATH"===p?(window.location.hash&&!1===f&&(t=window.location.pathname,window.location.replace(window.location.origin+(t.endsWith("/")?t:t+"/")+window.location.hash.replace(/#/g,"").replace(/:/g,"/")+window.location.search)),i.addEvent.call(window,"popstate",a)):i.addEvent.call(window,"hashchange",a),a({newURL:window.location.href})})}return{start:function(t,n,i,u){!function(e){var t,n=sessionStorage.getItem(g),i=window.location,r=0===i.hash.indexOf("#app")&&i.search.indexOf("addinmode")>=0;sessionStorage.removeItem(g),"HASH"===e&&n&&!r&&n!==i.toString()&&((t=document.createElement("a")).href=n,t.hash&&(window.location.hash=t.hash))}(n);var U=e.is(t.start,"function")?t.start:m;if(p=n,f=u,"true"===c.getApplicationConfiguration("app.usage.enable")){var y=c.getApplicationConfiguration("app.usage.pathapi")||"/upload",x=c.getApplicationConfiguration("app.usage.service")||c.getApplicationConfiguration("app.build.name"),S=c.getUser();x&&require(["DS/Usage/UsageManager","DS/Usage/TrackerAPI"],function(e,t){e.init({uploadPath:y,service:x,user:S}),t.init()})}d=t,e.extend(e.paths,{css:"/lib/UWA/assets/css/",img:"/lib/UWA/assets/img/"}),a.add(a.events.cardNavigation,function(t,n){e.is(t)&&e.is(n)&&a.dispatch(a.events.cardNavigation+t,n,!0)},null,!0),l.mark("wp_bootstrap_gethierarchy");var w=wap.widgetInstancesCacheId;o.getWidgetInstancePublicTree({serviceName:i,success:function(e){var t;l.mark("wp_bootstrap_gothierarchy"),t=function(e){var t={};return function e(t,n){var i=function(t){var i={};n.children.push(i),e(t,i)};for(var r in t)["id","name","parentId","urlHandler","urlPart"].indexOf(r)>-1?n[r]=t[r]:"children"===r&&(n.children=[],t.children.forEach(i))}(e,t),t}(e),s.setHierarchy(t),r.resolve().then(h).then(v).then(C).then(U)},cacheId:w})},getStartPageMode:function(){var e,t=[],i=window.location.href,r=n.getQueryString(i,"aloneWIId"),o=n.getQueryString(i,"aloneWId"),s=n.getQueryString(i,"rootId");return r?t.push("instance",r):o?(e={id:o,data:n.getQueryString(i,"aloneWData"),name:n.getQueryString(i,"aloneWName")},t.push("widget",e)):s?t.push("root",s):t.push("default","0"),t},_getAppNavigationMode:function(){return p}}}),define("DS/UWPClientCode/Boot/Bootstrap",["UWA/Core","UWA/Promise","DS/UWPClientCode/WidgetFactory","DS/UWPClientCode/Bootstrap"],function(e,t,n,i){"use strict";return{start:function(){var r=t.deferred(),o=i.getStartPageMode(),s={};return s.id=o[1],s.el=e.createElement("div",{class:"module"}).inject(document.body),n.load(s),r.resolve(),r.promise}}}),define("DS/UWPClientCode/UWA/Embedded",["UWA/Core","UWA/Embedded","UWA/Utils","DS/UWPClientCode/Navigation"],function(e,t,n,i){"use strict";var r={getIframeUrl:function(){var e,t,r,o=[],s=this.options,a=this.data,c="path"===i.navigationMode.toLowerCase(),l={id:this.id,uwaUrl:this.url,appId:s.appId,token:s.token,header:s.displayHeader,footer:s.displayFooter,displayEdit:s.displayEdit,autoLaunch:s.autoLaunch,widgetDomain:c?i.baseUrl:window.location.toString().replace(/#.*$/,""),lang:s.lang,cache:s.cache,debug_me:s.debugMe};for(e in a)a.hasOwnProperty(e)&&!l.hasOwnProperty(e)&&(l[e]=a[e]);for(e in l)l.hasOwnProperty(e)&&null!==l[e]&&o.push(e+"="+("boolean"==typeof(r=l[e])?!1===r?"0":"1":n.encodeUrl(r)));if(t=this.getIframeDomain()+"?"+o.join("&"),c&&!n.isAbsoluteUrl(t)&&(t=i.baseUrl+t),t.length>2048)throw new Error("UWA.Embedded iframe url is more than 2048 characters please implement UWA.Embedded using offlineMode=true.");return t},destroy:function(t){this.socket&&this.socket.disconnect(),e.Embedded.Instances[t]&&(Object.keys(e.Embedded.Instances[t].elements).forEach(function(n){e.Embedded.Instances[t].elements[n].destroy&&e.Embedded.Instances[t].elements[n].destroy(),e.Embedded.Instances[t].elements[n]=null,delete e.Embedded.Instances[t].elements[n]},this),e.Embedded.Instances[t]=null,delete e.Embedded.Instances[t])}};return t.prototype.getIframeUrl=r.getIframeUrl,t.prototype.destroy=r.destroy,t.prototype.onViewRequest=function(){},r}),define("DS/UWPClientCode/Boot/Environment",["UWA/Core","UWA/Environment","UWA/Storage","DS/UWPClientCode/Data/Widgets","DS/UWPClientControls/Utils","DS/UWPClientCode/I18n","DS/UWPClientCode/UWA/Embedded"],function(e,t,n,i,r,o){"use strict";return t.extend({name:"boot",init:function(t){this.wp=e.merge({isVisible:!0},t),this.html={},this.Features={},this.view={},this.options={defaultView:{type:"windowed"}},this.html.module=t.el,this.buildSkeleton(),this.dispatchInit()},loadWidget:function(t,n){return n=e.extend({onFailure:function(e){throw e},onTimeout:function(e){throw e},onComplete:function(){}},n),this.wp.isolationLevel?(this.loadEmbeddedWidget(this.wp.widgetId||t,n),this.dispatchEvent("onRegisterWidget")):this.loadInlinedWidget(this.wp.widgetId||t,n),this},loadInlinedWidget:function(e,t){var n=this.getWidget(),i=t.fetcher;return n.id=this.wp.id,i.title=this.wp.title,n.setStyle(i.style),delete t.fetcher.style,this._parent(e,t)},loadEmbeddedWidget:function(t,n){var i;return this.getWidget().id=this.wp.id,n.cache=this.wp.checksum,i={id:this.wp.id,appId:this.wp.appId,token:this.wp.token,lang:o.getCurrentLanguage(),displayEdit:!1,height:"100%",exposition:2===this.wp.isolationLevel?e.hosts.untrustedExposition:e.hosts.exposition,debugMe:e.debug?1:null},n.embedded=e.extend(n.embedded||{},i),this._parent(t,n),this},buildSkeleton:function(){var t=this.wp,n=e.createElement,i=this.html;i.module.hasClassName("module")||(i.module=n("div",{class:"module"}).inject(i.module)),i.module.addClassName("wi-"+this.wp.id),i.wrapper=n("div",{class:"moduleWrapper"}).inject(i.module),t.isContainer?(i.body=i.wrapper,i.module.addClassName("moduleLayout")):i.body=n("div",{class:"moduleContent w-"+t.widgetId}).inject(i.wrapper)},setVisible:function(e,t){var n=this.wp,i=this.getWidget();(n.isVisible!==e||t)&&(n.isVisible=!!e,i.dispatchEvent(e?"onShow":"onHide"))},onRegisterWidget:function(){this.registered||(this.data=new n({adapter:"Object",database:"preference-"+this.wp.id}))},onUpdateValue:function(){var e=this.widget;e.launched&&!e.isEdit&&this.save()},save:function(){var e=this;this._save||(this._save=r.debounce(function(){e.destroyed||i.editWidgetInstance({id:e.wp.id,data:e.getAllData()})},300)),this._save()}})});