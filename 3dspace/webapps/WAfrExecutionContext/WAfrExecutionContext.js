define("DS/WAfrExecutionContext/mod_ExecutionContextInterpreter",["UWA/Class/Promise"],function(t){"use strict";class e{constructor(){this._executionContext=void 0,this._components=[],this._UIModel=void 0}interpret(e,n,o){this._executionContext=n,this._components=e.components,this._UIModel=e.UIModel;var r=this;let i=!1;return this._components&&this._components.forEach(function(t){t&&"mod_WelcomeScreen"===t.key?(i=!0,r._executionContext._WSComponents.push(t.key)):t.options&&t.options.welcomeScreen&&r._executionContext._WSComponents.push(t.key)}),this._components&&i&&!this._executionContext.getSourceApp()?this._executionContext._doIWantToBeInWSContext=!0:i||(this._executionContext._doIWantToBeInWSContext=!1,this._executionContext.WSState=!1),t.resolve()}}var n={generateExecutionContextInterpreter:function(t){return new e}};return n}),define("DS/WAfrExecutionContext/mod_Component",["UWA/Core"],function(t){"use strict";var e=Object.create(null),n=function(){};function o(t,e){if("object"!=typeof e)throw new Error("target obj to update must be an object");var n;n=t.prototype,Object.keys(n).forEach(function(t){e.hasOwnProperty(t)||Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}function r(t,e){if("function"!=typeof e)throw new Error("parameters must be constructors (i.e. functions)");o(t,e.prototype)}e.Component=n,n.implementsBy=function(t){r(n,t)},n.mixinProperties=function(t){o(n,t)},n.prototype.getExecutionContext=function(){return this._private._executionContext},n.prototype.setExecutionContext=function(t){this._private=this._private||Object.create(null),this._private._executionContext=t},n.prototype.getRegisteredIdentifier=function(){return this._private._identifier},n.prototype.setRegisteredIdentifier=function(t){this._private=this._private||Object.create(null),this._private._identifier=t},n.prototype.initialize=function(){return t.Class.Promise.resolve()},n.prototype.clean=function(){return t.Class.Promise.resolve()},n.prototype.destroy=function(){return t.Class.Promise.resolve()},n.prototype.canBeParallelized=function(){return!0};var i=function(){};e.StandardComponent=i,n.implementsBy(i),i.implementsBy=function(t){r(i,t)},i.prototype.configure=function(){return t.Class.Promise.resolve()},i.prototype.getExposedComponentCtor=function(){return null},i.prototype.getExposedComponent=function(){return this._private?this._private._publicComponent:null},i.prototype.setExposedComponent=function(t){this._private=this._private||Object.create(null),this._private._publicComponent=t},i.prototype.generateInterpreter=function(t){return null},i.prototype.getCurrentInterpreter=function(){return this._private._currentInterpreter},i.prototype.setCurrentInterpreter=function(t){this._private=this._private||Object.create(null),this._private._currentInterpreter=t};var s=function(){};return e.Interpreter=s,s.prototype.interpret=function(t,e){throw new Error("Not implemented")},s.prototype.commit=function(t,e){throw new Error("Not implemented")},s.prototype.enrich=function(t,e){},e}),define("DS/WAfrExecutionContext/mod_ExecutionContext",["UWA/Utils","UWA/Core","DS/WAfrExecutionContext/mod_Component","UWA/Class/Promise","DS/WAfrExecutionContext/mod_ExecutionContextInterpreter","DS/WAfrUtils/Logger","DS/WAfrContainer/App","DS/WAfrDebug/mod_Performances","i18n!DS/WAfrContainer/assets/nls/Notification","DS/Controls/ModalContainer","DS/Controls/Loader","i18n!DS/WAfrExecutionContext/assets/nls/Transition","DS/WebUAUtils/WebUAUtils"],function(t,e,n,o,r,i,s,p,a,c,u,d,l){"use strict";var f=p.Performances,h=Object.create(null);function m(t){var e={},n=function(t){var n=t.split("==");if(2!==n.length)throw new Error("Bad syntax, expected expression like A == B, found "+t);var o=n[0].trim(),r=n[1].trim();if(o.indexOf('"')>=0||r.indexOf('"')>=0)throw new Error('Bad syntax, key and value should not contain double quote ", found '+t);if(o.indexOf(" ")>=0||r.indexOf(" ")>=0)throw new Error("Bad syntax, key and value should not contain space, found "+t);e[o]=r};if(t.indexOf("&&")>=0){var o=t.split("&&");if(o.length<2)throw new Error("Bad syntax, expected expression like A == B && C == D, found "+t);o.forEach(n)}else n(t);return e}function C(t,e,n){var o=!0;return Object.keys(e.when).forEach(function(n){o=o&&e.when[n]===t[n]}),o&&!e.fit?(e.fit=!0,!n&&e.onDidFitContext&&e.onDidFitContext(e.element)):o||(e.fit=!1,!n&&e.onDidUnfitContext&&e.onDidUnfitContext(e.element)),e.fit}function g(t){return{current:0,next:function(){return this.current>=t.length?null:t[this.current++]}}}function _(t){for(var e=n.Component.prototype,o=Object.keys(e),r=0;r<o.length;r++){const e=o[r];if(!t.hasOwnProperty(e))return!1}return!0}function x(t,e,n){return t(n)?e(n).then(x.bind(null,t,e)):n}function v(t){var e=t.iterator,n=t.action,r=t.generatedData,i=t.inverse;if(null===n||"function"!=typeof n)throw new Error("The action cannot be null and must be a function returning a promise");for(var s=[],p=[],a=[],c=[],u=e.next(),d=null,l=0;u;)d=r?r[l]:null,u.canBeParallelized()?(s.push(u),a.push(d)):i?(p.unshift(u),c.unshift(d)):(p.push(u),c.push(d)),u=e.next(),l+=1;var f=function(){return!p||p.length<=0?o.resolve():x(function(t){return t<p.length},function(t){return n(p[t],c[t]).then(function(){return++t})},0).then(function(t){return o.resolve(t)}).catch(function(t){return o.reject(t)})},h=function(){var t=s.length,e=null,r=[];for(l=i?t-1:0;i?l>=0:l<t;i?--l:++l)d=a[l],e=n(s[l],d),r.push(e);return o.all(r)};return i?h().then(f):f().then(h)}function y(t,e){return{current:0,next:function(){for(var n;this.current<t.length&&!n;){var o=t[this.current];n=e[o]?e[o].component:void 0,this.current+=1}return n}}}function A(t,e,n){var o,r,i=t._appComponents.length+t._stdComponents.length;if(n)for(r=i-1;r>=0;r--)o=r>=t._appComponents.length?t._stdComponents[r-t._appComponents.length]:t._appComponents[r],e(t._components[o],o);else for(r=0;r<i;r++)o=r>=t._stdComponents.length?t._appComponents[r-t._stdComponents.length]:t._stdComponents[r],e(t._components[o],o)}function w(t,e,o){return o?n.Component.implementsBy(t):n.StandardComponent.implementsBy(t),new t(e)}function S(t,e){return Boolean(t&&e&&t.stdConf&&t.stdConf[e])}function E(t){const e=t.getComponent("mod_WelcomeScreen");e&&t.a2xConfig.isWelcomeScreenLoaded&&(e.hideWelcomeScreen(),t.a2xConfig.isWelcomeScreenLoaded=!1),t._doIWantToBeInWSContext=!1}h.hasConfigurationFor=S,h.getConfigurationFor=function(t,e){let n;return t&&e&&t.stdConf&&t.stdConf[e]&&(n=t.stdConf[e]),n};var I=function(n){var s=this;this._perf=new f,n=e.merge(n||{},{config:{components:[],interpreters:[]}}),this._id=n.id||t.getUUID(),this._config=n.config,this._config.interpreters=this._config.interpreters||[],this._interpreter=r.generateExecutionContextInterpreter(),this._components=Object.create(null),this._stdComponents=[],this._appComponents=[],this._contextualElements=[],this._WSComponents=[],this._handlers={},this.exposedApi=function(t){return{getId:t.getId.bind(t),getComponent:function(e){return t.getComponent(e,!0)},registerComponent:function(e,n){t.registerApplicationComponent(e,n)},createAndRegisterComponent:t.createAndRegisterApplicationComponent.bind(t),unregisterComponent:t.unregisterApplicationComponent.bind(t),isRegisteredComponent:t.isRegisteredComponent.bind(t),recycleComponent:t.recycleComponent.bind(t),getData:function(){},getSourceApp:t.getSourceApp.bind(t),getTargetApp:t.getTargetApp.bind(t),getComponents:function(e){return t.getComponents(e,!0)},getContext:function(){return e.clone(t._contexts)},setContext:t.setContext.bind(t),switchApp:function(e){require(["DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","UWA/Data"],function(n,o){n.getAppInfo({appId:e,onComplete:function(n){var r="";n.brand&&"string"==typeof n.brand&&"3DEXPERIENCE"!==n.brand&&"SOLIDWORKS"!==n.brand&&(r=n.brand),window.widget.setMetas({brand:r});var i=function(i){o.request(i,{type:"json",responseType:"json",onComplete:function(o){for(var i in o)window.widget.data[i]=o[i];return o.appId=e,o.title=n.title,o.brand=r,t.load(o),!0}})};if(n.config)i(n.config);else for(var s=0;s<n.platforms.length;s++)if(n.platforms[s].id===n.platformId&&n.platforms[s].config){i(n.platforms[s].config);break}}})})},gotoWelcomeScreen:function(){return t.gotoWelcomeScreen()},gotoApp:function(){return t.gotoApp()},getWelcomeScreenState:function(){return t.getWelcomeScreenState()}}}(this),this.applicationContext=this.exposedApi,this._version=null,this._container=n.container,this._contexts=Object.create(null),this.onWillLoadApp=null,this.onDidLoadApp=null,this.onDidFailToLoadApp=null,this.onDidContextualComponentsUpdate=null,this._container=n.container,this._loader=null,this._container&&(this._container.subscribe("onReuseContext."+this.getId(),function(t){let e=10*parseFloat(t.afrVersion);e!==s._container._view._version/10?require([e>=2?"DS/WAfrContainerAsWidget/default_config":"DS/WAfrContainerAsWidget/old_config"],function(e){s._container._config=e,s._config=e,s.load(t)}):s.load(t)}),this._container.subscribe("displayAfrLoader",function(t){s.displayLoader(t)}),this._container.subscribe("hideAfrLoader",function(){s.hideLoader()})),this.applicativeMainUIComponentAvailability=!0,this._doIWantToBeInWSContext=!1,this.WSState=!1,this.isA2X=!1,this._isConfigured=!1,this._initExecutionContext=function(t,n,o){return this._interpreter.interpret(t,s).then(function(){return s.registerStandardComponents()}).then(function(){return s.loadApp(t)}).then(function(t){if(s._targetApp=t.app,!s._targetApp)throw new Error("Not found a target app !");return s.prepareTransition(t)}).then(function(o){s._isConfigured=!1,s._components=e.merge(s._components,o.metaDatas),Object.keys(o.metaDatas).forEach(t=>{s._components[t].resetInfo&&!s._components[t].ctor&&(delete s._components[t],s._components[t]=o.metaDatas[t])}),s._appComponents=o.componentsKeys;var r=!1;for(var p in s._handlers){r=!1;for(var a=0;a<t.handlers.check.length;a++)t.handlers.check[a].identifier===p&&(t.handlers.check[a].defaultState=s._handlers[p],r=!0);if(!r)for(var c=0;c<t.radioGroup.items.length;c++)t.radioGroup.items[c].identifier===p&&(t.radioGroup.items[c].default=s._handlers[p])}return s.callAllInterpreters(t,n).then(function(t){return i.log("[Execution context] Initialize standard components"),s.initializeStandardComponents({generatedData:t})}).then(function(){return o})})},this._welcomeScreenPromiseSequence=function(t){return i.log("[Execution context] Initialize WS applicative components"),s.initializeWSApplicativeComponents(t).then(function(){return i.log("[Execution context] Initialize application"),s.initializeWelcomeScreen()}).then(function(){i.log("[Execution context] Set Up the application Home Screen"),s.WSState=!0})},this._appPromiseSequence=function(t){let e=[],n=[],r=[];return t&&0!==Object.keys(t).length&&t.componentsKeys&&t.componentsKeys.forEach(function(t){s._components[t].component&&n.push(s._components[t].component)}),A(s,function(t,o){t.standard||(t.context?t.context.fit&&!t.component&&(t.ctor?(s.registerComponentThruMetaData(o,t),n.push(t.component)):(r.push(t.module),e.push(o))):t.component||(t.ctor?(s.registerComponentThruMetaData(o,t),n.push(t.component)):(r.push(t.module),e.push(o))))}),s.appModules=r,new o(function(t,o){let i,p,a,c;require(r,function(){for(arguments.length!=s.appModules.length&&t(),i=0;i<arguments.length;i++)p=arguments[i],a=e[i],(c=s._components[a]).ctor=p,s.registerComponentThruMetaData(a,c),n.push(c.component);t()},o)}).then(function(){return s.initializeApplicativeComponents({iterator:g(n)})}).then(function(){return i.log("[Execution context] Configure standard components"),s._isConfigured?Promise.resolve():s.configureComponents()}).then(function(){return i.log("[Execution context] Initialize application"),s.initializeApp()}).then(function(t){return i.log("[Execution context] set the target app "+s._targetApp+" as source app"),t&&(i.warn("[WARNING] App should use the UIFrame component to add UI to their App"),t.inject(s.getUiContainer())),s.WSState=!1,o.resolve()})},this._launchA2XNativeApp=function(t){if(!t.appId)throw new Error("Missing parameter appId!");return function(t,e){if(!t||!e)throw new Error("Missing parameters. Please provide modules to require and thier corresponding keys");let n=[].concat(e),o=[].concat(t);return new Promise(function(t,e){require(o,function(){let e=Object.create(null);for(let t=0;t<arguments.length;t++)e[n[t]]=arguments[t];t(e)},function(t){e(new Error(`Unable to load module : ${t.requireModules}. Please check your packaging`))})})}("DS/WAfrA2XLoader/WAfrA2XAppLoader","AppLoader").then(e=>e.AppLoader.loadA2XApp({appId:t.appId,clientNode:this._container.getA2XClient()}))},this._addNativeContent=function(t){return this.enrichStandardComponents(t).then(()=>{const t=this.getComponent("Afr_UIComponent");return t&&t.showMainComponent(),E(this),this._appPromiseSequence()})},this._subscribeToNativeTransitionEvent=function(){let t=Promise.resolve();const e=this._container.getA2XClient();this.a2xConfig.subscriptionToken=e.subscribe("AfrA2XTransitionEvent",e=>{const n=e.readString("wkName"),o=e.readString("appContent");if(n&&o){const e=JSON.parse(o);if(this.getSourceApp().getId()===`${n}_AP`)t=this._addNativeContent(e);else{this.a2xConfig.loadedFromNative=!0;const o=`${n}_AP`;t=this._container.getApplicationJSON({appId:o}).then(t=>(E(this),this.load(t))).then(()=>this._addNativeContent(e))}}else{const e=new Error("Impossible to retrieve the application name or the application content.");console.error(e),t=Promise.reject(e)}return t})}};return h.ExecutionContext=I,I.prototype.setUiContainer=function(t){this._view=t},I.prototype.getUiContainer=function(){return this._view},I.prototype.getTargetApp=function(){return this._targetApp},I.prototype.getSourceApp=function(){return this._sourceApp},I.prototype.getId=function(){return this._id},I.prototype.getComponent=function(t,e){if(null==t)throw new Error("Invalid identifier "+t);var n=void 0;if(this._components&&(n=this._components[t]),n){var o=n.component;if(o){if(e&&o.getExposedComponent&&o.getExposedComponent())return o.getExposedComponent();if(!e||!n.standard)return o}}},I.prototype.cleanComponent=function(t,e){if(!t)throw new Error("Component must be defined ");var n=t.getRegisteredIdentifier();if(null==n||"string"!=typeof n)throw new Error("Invalid identifier "+n);var r=this._components[n];if(!r)throw new Error("The MetaData for this component do not exists");var s=this;if(i.log("[Execution context] clean component "+n),r.new)return r.new=!1,o.resolve();var p=t.clean()||o.resolve();return r.recycled&&r.context&&(r.recycled=C(s._contexts,r.context,!0)),!r.recycled&&!r.standard||r.standard&&r.clear||r.welcomeScreen?p.then(function(){return i.log("[Execution context] destroy component "+n),t.destroy()}).then(function(){return i.log("[Execution context] Remove component "+n+" from execution context"),e=!!r.clear||e&&!r.standard,s.removeComponent(r,e),o.resolve(t)}):(r.recycled=!1,p.then(function(){return o.resolve(t)}))},I.prototype.unregisterComponent=function(t,e){if(null==t||"string"!=typeof t)throw new Error("Invalid identifier "+t);if(void 0!==this._components[t]){var n=this._components[t];if(n.standard&&e)throw new Error("Invalid access, try to unregister a standard component from application side");var r=n.component,s=this;return i.log("[Execution context] clean component "+t),(r.clean()||o.resolve()).then(function(){return i.log("[Execution context] destroy component "+t),r.destroy()}).then(function(){return i.log("[Execution context] Remove component "+t+" from execution context"),s.removeComponent(n,!0),o.resolve(r)})}return o.resolve()},I.prototype.isRegisteredComponent=function(t){if(!t)throw new Error("The component is null or undefined");var e=!1,n=t.getRegisteredIdentifier(),o=this._components[n];return o&&o.component&&(o.component===t||o.component.getExposedApi&&o.component.getExposedApi()===t)&&(e=!0),e},I.prototype.cleanComponents=function(t){var e=this;return v({action:function(n){return e.cleanComponent(n,!!t&&t.removeForGood)},inverse:!0,iterator:t&&t.iterator?t.iterator:y(e._appComponents.concat(e._stdComponents),e._components)})},I.prototype.destroyComponents=function(t){var e=this;return v({action:function(t){i.log("[Execution context] destroy component "+t.getRegisteredIdentifier());var n=e._components[t.getRegisteredIdentifier()];return t.destroy().then(function(){return e.removeComponent(n,n.clear)})},inverse:!0,iterator:t&&t.iterator?t.iterator:y(that._appComponents.concat(that._stdComponents),that._components)})},I.prototype.recycleComponent=function(t,e){if(null==t||"string"!=typeof t)throw new Error("Invalid identifier "+t);var n=this._components[t];if(!n)return!1;if(n.standard)throw new Error("Cannot recycle a standard component");if(n.recycled)return!1;var o=!0;if(e){var r=this._targetApp.options.appConfig.components.find(e=>e.key==t);n.options=r.options,n.component&&(n.component.options=r.options),r.when?(n.context={element:r.key,when:m(r.when),onDidFitContext:this.onDidFitContextForComponent.bind(this),onDidUnfitContext:this.onDidUnFitContextForComponent.bind(this)},o=C(this._contexts,n.context,!0)):delete n.context}return o&&(n.recycled=!0),!0},I.prototype.isComponentRecycled=function(t){if(null==t||"string"!=typeof t)throw new Error("Invalid identifier "+t);var e=this._components[t];return!!e&&e.recycled},I.prototype.getComponents=function(t,e){if(!t)throw new Error("Predicate function is mandatory");var n,o=[],r=this;return A(this,function(i,s){(n=r.getComponent(s,e))&&t(n)&&o.push(n)}),o},I.prototype.registerComponent=function(t,e,n,o){if(null==t||"string"!=typeof t)throw new Error("Invalid identifier "+t);if(null==e)throw new Error("Component cannot be null");if(o&&!_(Object.getPrototypeOf(e))&&!_(e))throw new Error("the given component do not contains some methods of DS/WAfrExecutionContext/mod_Component");if("setExecutionContext"in e==!1||"setRegisteredIdentifier"in e==!1)throw new Error("The component do not implements module:DS/WAfrExecutionContext/mod_Component~Component. Use applyComponentMixin first from the context.");if(this._components[t])throw new Error("An component has already been registered with this identifier "+t);var r=n?this._appComponents:this._stdComponents,i={standard:!n,position:r.length};this._components[t]=i,r.push(t),this.registerComponentThruMetaData(t,i,e)},I.prototype.removeComponent=function(t,e){if(!t)throw new Error("You must provide a metaData");if(!t.component)throw new Error("The component is already removed");var n=t.component.getRegisteredIdentifier();if(t.component.setExecutionContext(null),t.component.setRegisteredIdentifier(null),delete t.component,e){var o=t.standard?this._stdComponents:this._appComponents,r=o.indexOf(n);if(r>=0&&o.splice(r,1),!t.standard){let t=this._WSComponents.findIndex(function(t){return t===n});-1!==t&&this._WSComponents.splice(t,1)}delete this._components[n]}},I.prototype.registerComponentThruMetaData=function(t,e,o){if(!e)throw new Error("The metaData do not exist: the module may not be required");if(e.component)throw new Error("The component: "+e.component._private._identifier+" is already created");if(!o){if(!e.ctor)throw new Error("The Component constructor must be defined.");if("function"!=typeof e.ctor)throw new Error(" Component constructor must be a constructor (i.e. functions)");o=w(e.ctor,e.options,!e.standard)}e.component=o;var r=e.standard?this:this.exposedApi;e.component.setExecutionContext(r),e.component.setRegisteredIdentifier(t);var i=e.component.createExposedComponent&&e.component.createExposedComponent();if(i)n.Component.mixinProperties(i),i.setExecutionContext(this.exposedApi),i.setRegisteredIdentifier(t),e.component.setExposedComponent(i);else{var s=e.component.getExposedComponentCtor&&e.component.getExposedComponentCtor();if(s){var p=w(s,void 0,!0);p.setExecutionContext(this.exposedApi),p.setRegisteredIdentifier(t),e.component.setExposedComponent(p)}}return e.component},I.prototype.createAndRegisterComponent=function(t,e,n,o){if(!this._components[t]){var r=w(e,n,o);if(this.registerComponent(t,r,o),!this._components[t])throw new Error("The metaData for component do not exist !");return this._components[t].ctor=e,r}},I.prototype.requireStandardComponents=function(t,e){var n,r,i,s,p,a=this;if(t.length!==e.length)throw new Error("Modules and keys do not have the same size !");return new o(function(o,c){require(t,function(){var t;for(n=0;n<arguments.length;n+=1)r=arguments[n],i=e[n],t=a._components[i],s=t.ctorImport,p=s?r[s]:r,t.ctor=p,a.registerComponentThruMetaData(i,t);o()},c)})},I.prototype.registerStandardComponents=function(){i.log("[Execution context] Register standard components if need ");var t=this;if(t._stdComponents.length>0){var n,o=[],r=[],s=[],p=[],a=Array.from(t._config.components);if(A(this,function(e,i){if(t._stdComponents.length!=t._config.components.length&&e.standard){0==a.length&&(e.component?(s.push(e.component),e.clear=!0):delete t._components[i]);for(let n=0;n<a.length;n++){if(a[n].key===i){a.splice(n,1);break}n===a.length-1&&(e.component?(s.push(e.component),e.clear=!0):delete t._components[i])}}e.standard&&e.context&&(n=C(t._contexts,e.context,!0),e.component?!n&&e.component&&(s.push(e.component),p.push(e.component)):n&&(o.push(e.module),r.push(i)))}),t._stdComponents.length!=t._config.components.length){var c=t.parseComponents(a,!1,!0);t._components=e.merge(t._components,c.metaDatas),t._stdComponents=t._config.components.map(t=>t.key),o=o.concat(c.readyModules),r=r.concat(c.readyKeys)}return t.cleanComponents({iterator:g(s)}).then(function(){return t.destroyComponents({iterator:g(p)})}).then(function(){return t.requireStandardComponents(o,r)})}var u=t.parseComponents(t._config.components);return t._components=e.merge(t._components,u.metaDatas),t._stdComponents=u.componentsKeys,t.requireStandardComponents(u.readyModules,u.readyKeys)},I.prototype.initializeStandardComponents=function(t){var e=this,n=null;return v({action:function(t,o){(n=t.getCurrentInterpreter&&t.getCurrentInterpreter())&&n.commit&&n.commit(e,{componentId:t.getRegisteredIdentifier()});let r=e._perf.start("WAFR: initialize std :"+t._private._identifier);return t.initialize(o).then(function(){e._perf.stop(r)})},generatedData:t.generatedData,iterator:t&&t.iterator?t.iterator:y(this._stdComponents,this._components)})},I.prototype.enrichStandardComponents=function(t){const e=this._interpreters,n=this;let o=Promise.resolve();return this._interpreters.length>0&&(o=x(function(t){return t<e.length},function(o){const r=e[o];let i=Promise.resolve();return r.enrich&&(i=r.enrich(t,n).then(function(){},function(t){throw t})),i.then(()=>++o)},0)),o},I.prototype.initializeWSApplicativeComponents=function(t){var e=this;return v({action:function(t,n){let o=e._perf.start("WAFR: initialize "+t._private._identifier);var r=t.initialize(n);if(r)return r.then(function(){e._perf.stop(o)});e._perf.stop(o)},iterator:t&&t.iterator?t.iterator:y(this._WSComponents,this._components)})},I.prototype.configureComponents=function(t){var e=this;return v({action:function(t){return t.configure()},iterator:t&&t.iterator?t.iterator:y(this._stdComponents,this._components)}).then(function(){e._isConfigured=!0})},I.prototype.cleanStandardComponents=function(){return v({action:function(t){return t.clean()},iterator:y(this._stdComponents,this._components)})},I.prototype.parseApplicativeComponents=function(t){return this._appConfig={components:t},this.parseComponents(t,!0)},I.prototype.registerApplicationComponent=function(t,e){if(!e)throw new Error("Component is null");return this.registerComponent(t,e,!0,!0)},I.prototype.createAndRegisterApplicationComponent=function(t,e,n){if(!e)throw new Error("Component is null");return this.createAndRegisterComponent(t,e,n,!0)},I.prototype.createAndRegisterApplicationComponentsList=function(t){if(i.log("[Execution Context] Register Application Components :"+t),t)for(var e=0;e<t.length;e++){var n=t[e];this.createAndRegisterApplicationComponent(n.key,n.mod,n.options)}},I.prototype.getApplicationComponent=function(t){return this.getComponent(t,!0)},I.prototype.unregisterApplicationComponent=function(t){return this.unregisterComponent(t,!0)},I.prototype.isRegisteredApplicationComponent=function(t){return this.isRegisteredComponent(t)},I.prototype.recycleApplicationComponent=function(t,e,n){if(e&&!e.metaDatas[t])throw new Error('The App "'+this._targetApp.getId()+'" has requested to recyle the component "'+t+'" but do not declare it in its list of components :\n'+JSON.stringify(e.metaDatas,null,2));return this.recycleComponent(t,n)},I.prototype.isApplicationComponentRecycled=function(t){return this.isComponentRecycled(t)},I.prototype.prepareTransition=function(t){var e,n,r=this,i=0;return this._sourceApp?this._sourceApp.onWillLeave(this._targetApp).then(function(){return r._targetApp.onWillEnter(r._sourceApp)}).then(function(){var o=!0,s=r._targetApp.getTransitionFrom(r._sourceApp.getId());if(s||(s=r._targetApp.getTransitionFromFamily(r._sourceApp.getFamily())),s){var p=s.components||{},a=s.handlers||{};if(null!=s.resetInfo&&(o=s.resetInfo),p.keep)if("@all"===p.keep)for(e in r.applicationContext._components)r.recycleApplicationComponent(e,t,o);else if(Array.isArray(p.keep))for(;i<p.keep.length;i++)n=p.keep[i],r.recycleApplicationComponent(n,t,o);if(a.keep&&Array.isArray(a.keep)){var c=r._sourceApp.options.appConfig.handlers.check,u=t.app.options.appConfig.handlers.check,d=r._sourceApp.options.appConfig.radioGroup.items,l=t.app.options.appConfig.radioGroup.items,f="",h=f,m=f,C=r.getComponent(WAfrStandardComponentKey.HandlerComponent);for(i=0;i<a.keep.length;i++){m=a.keep[i],f=h="";for(var g=0;g<c.length;g++)if(c[g].identifier==m){f=c[g].identifier+"-"+c[g].check.identifier+"-"+c[g].uncheck.identifier;break}for(g=0;g<u.length;g++)if(u[g].identifier===m){h=u[g].identifier+"-"+u[g].check.identifier+"-"+u[g].uncheck.identifier;break}if(h===f&&""!=f){var _=C.getCheckState({id:m});r._handlers[m]=_}else{for(g=0;g<d.length;g++)if(d[g].identifier==m)for(var x=0;x<d[g].items.length;x++)1==C.getRadioItemState({radioId:d[g].identifier,id:d[g].items[x].identifier})&&(f=d[g].identifier+"-"+d[g].items[x].identifier+"-"+d[g].items[x].check.identifier+"-"+d[g].items[x].uncheck.identifier);for(g=0;g<l.length;g++)if(l[g].identifier==m)for(x=0;x<l[g].items.length;x++)if((h=l[g].identifier+"-"+l[g].items[x].identifier+"-"+l[g].items[x].check.identifier+"-"+l[g].items[x].uncheck.identifier)==f){_=l[g].items[x].identifier;r._handlers[m]=_;break}}}}}return r.cleanComponents({removeForGood:!0})}).then(function(){return o.resolve(t)}):o.resolve(t)},I.prototype.initializeApplicativeComponents=function(t){var e=this;return v({action:function(t,n){let o=e._perf.start("WAFR: initialize "+t._private._identifier);var r=t.initialize(n);if(r)return r.then(function(){e._perf.stop(o)});e._perf.stop(o)},iterator:t&&t.iterator?t.iterator:y(this._appComponents,this._components)})},I.prototype.load=function(t,e){var n=this;if(!t.appId&&!t.afrAppId)throw new Error("Not found a valid App id from the current Id Card ");l.setAppid(t.appId||t.afrAppId),this.onWillLoadApp&&this.onWillLoadApp(t.appId||t.afrAppId),n._perf.start("WAFR:  load entire App "),e||(e=t.afrVersion||"0.1"),i.log("[Execution context] load new app "+t.appId),this.isA2X=S(t,"a2x"),this.isA2X&&!this.a2xConfig&&(this.a2xConfig={subscribedToNative:!1,loadedFromNative:!1,subscriptionToken:null,isWelcomeScreenLoaded:!1});let r=this.isA2X?{...t.initialContext,a2x:!0}:t.initialContext;n.setInitialContext(r);var s=void 0;if(n._sourceApp&&t.afrTransitionsFrom&&((s=t.afrTransitionsFrom[n._sourceApp.getId()])||(s=t.afrTransitionsFromFamily?t.afrTransitionsFromFamily[n._sourceApp.getFamily()]:null),s&&"ReuseContext"===s.type)){var p=s.components||{};if(p.keep){if("@all"===p.keep)throw"TODO";if(Array.isArray(p.keep)){for(var a={},c=0;c<p.keep.length;c++){var u=p.keep[c],d=n._components[u];d&&d.context&&!0===d.context.fit&&Object.keys(d.context.when).forEach(function(t){a[t]=d.context.when[t]})}Object.keys(a).forEach(function(t){var e=a[t];null!=e&&(n._contexts[t]=String(e))})}}}return this.isA2X&&!this.a2xConfig.subscribedToNative&&(this.a2xConfig.subscribedToNative=!0,this._subscribeToNativeTransitionEvent()),this._initExecutionContext(t,e,s).then(function(t){if(n._doIWantToBeInWSContext)return n._welcomeScreenPromiseSequence(t);if(!n.isA2X)return n._appPromiseSequence(t);if(!n.a2xConfig.loadedFromNative&&n.getTargetApp()){const t=n.getTargetApp().getId();return n._launchA2XNativeApp({appId:t})}}).then(function(){n.getSourceApp()&&!n.getSourceApp().isDisposeCalled()&&n.getSourceApp().dispose(),n._sourceApp=n._targetApp,n._targetApp=null,n.hideLoader(),n.onDidLoadApp&&n.onDidLoadApp()}).catch(function(t){return n.hideLoader(),n.onDidFailToLoadApp&&n.onDidFailToLoadApp(t),o.reject(t)})},I.prototype.loadApp=function(t){var e=this;return new o(function(n,o){var r=t.afrCode;r||(r="DS/WAfrAppManager/App"),r=r.replace(/\./g,"/");var p,a,c,u,d,l,f=e.parseComponents(t.components||[],!0),h=[r].concat(f.readyModules);i.log("[Execution Context] Require modules "+h),require(h,function(){var r=arguments[0];if(arguments.length!==f.readyKeys.length+1)throw new Error("The count of arguments and components do not fit");for(p=0;p<f.readyKeys.length;p++)a=f.readyKeys[p],c=f.metaDatas[a],u=arguments[p+1],d=c.ctorImport,l=d?u[d]:u,c.ctor=l,e.registerComponentThruMetaData(a,c);var h=new r({appConfig:t});h instanceof s!=!1?h.getId()?(i.log("[App Interpreter] Success require App and components "),n({app:h,metaDatas:f.metaDatas,componentsKeys:f.componentsKeys})):o(new Error("The app loaded do not have an id")):o(new Error("The app loaded is not an instance of DS/WAfrAppManager/App"))},o)})},I.prototype.callAllInterpreters=function(t,e){i.log("[Execution context] Start interpret id card");var n,r=[],s=this._version!==e;if(!this._interpreters||this._config.interpreters.length!=this._interpreters.length){for(this._interpreters=[],n=0;n<this._config.interpreters.length;n++){var p=this._config.interpreters[n].module;this._interpreters.push(p.generateInterpreter(e))}s=!1}for(n=0;n<this._interpreters.length;n++){var a=this._interpreters[n];s&&(a=this._config.interpreters[n].module.generateInterpreter(e),this._interpreters[n]=a);var c=this._config.interpreters[n].target,u=c?this.getComponent(c):void 0;if(u&&u.setCurrentInterpreter(a),a){var d=a.interpret(t,this,{componentId:this._config.interpreters[n].target});r.push(d)}else r.push(o.resolve(null))}return o.all(r)},I.prototype.initializeApp=function(){var t=this.getTargetApp();if(!t&&!(t=this.getSourceApp()))return o.reject(new Error("No app has been loaded by the interpreter !"));var e=this;return t._executionContext=this.exposedApi,t.setContainer(e._container?e._container._view:null),new o(function(n,o){if(t){var r=t.setUp({sourceApp:e._sourceApp,done:function(t){n(t)},failure:function(t){o(t)}});r&&r.then(n,o)}})},I.prototype.initializeWelcomeScreen=function(){var t=this.getTargetApp();if(!t&&!(t=this.getSourceApp()))return o.reject(new Error("No app has been loaded by the interpreter !"));var e=this;t._executionContext=this.exposedApi,t.getContainer()||t.setContainer(e._container?e._container._view:null);var n=new o(function(n,o){if(t){var r=t.setUpWS({sourceApp:e._sourceApp,done:function(t){n(t)},failure:function(t){o(t)}});r&&r.then(n,o)}});return this.isA2X&&(this.a2xConfig.isWelcomeScreenLoaded=!0),n},I.prototype.dispose=function(){this._timerHandle&&clearTimeout(this._timerHandle),this._timerHandleTreatment&&clearTimeout(this._timerHandleTreatment);var t=this;if(this._sourceApp&&this._sourceApp.dispose(),A(this,function(e){e.component&&(e.component.clean(!0),e.component.destroy(!0),e.component.setExecutionContext(null),t.removeComponent(e))},!0),this.isA2X){const t=this._container.getA2XClient();t&&null!=this.a2xConfig.subscriptionToken&&null!=this.a2xConfig.subscriptionToken&&t.unsubscribe(this.a2xConfig.subscriptionToken),delete this.a2xConfig.loadedFromNative,delete this.a2xConfig.subscribedToNative,delete this.a2xConfig.subscriptionToken,delete this.a2xConfig,delete this.isA2X}return delete this._components,delete this._stdComponents,delete this._appComponents,delete this.exposedApi,delete this._contexts,this.onWillLoadApp=null,this.onDidLoadApp=null,this.onDidFailToLoadApp=null,this.onDidContextualComponentsUpdate=null,this._container=null,o.resolve()},I.prototype.registerContextualElement=function(t,e){if(!t||!t.when)throw new Error("The contextual element must be defined and must contain a when expression");e=e||{};var n={element:t,when:m(t.when),onDidFitContext:e.onDidFitContext,onDidUnfitContext:e.onDidUnfitContext};return this._contextualElements.push(n),C(this._contexts,n),n},I.prototype.onDidChangeContext=function(){this._timerHandle=null;var t=this._contexts;A(this,function(e){e.context&&C(t,e.context)}),this._contextualElements.forEach(function(e){C(t,e)})},I.prototype.parseComponents=function(t,e,n){var o,r,i=[],s=[],p={},a=[],c=this;return t.forEach(function(t){o=!0,r={module:t.code,ctorImport:t.ctor,options:t.options,standard:!e,position:a.length,new:1==n,resetInfo:t.resetInfo},"mod_WelcomeScreen"===t.key&&(r.welcomeScreen=!0),p[t.key]=r,a.push(t.key),t.when&&(r.context={element:t.key,when:m(t.when),onDidFitContext:c.onDidFitContextForComponent.bind(c),onDidUnfitContext:c.onDidUnFitContextForComponent.bind(c)},o=C(c._contexts,r.context,!0)),c._doIWantToBeInWSContext&&e&&(c._WSComponents.includes(t.key)||(o=o&&!c._doIWantToBeInWSContext)),o&&(i.push(t.code),s.push(t.key))}),{readyModules:i,readyKeys:s,metaDatas:p,componentsKeys:a}},I.prototype.onDidFitContextForComponent=function(t){var e=this._components[t];if(e&&e.context){if(!e.context.fit)throw new Error("Unexpected state of context");this._timerHandleTreatment&&clearTimeout(this._timerHandleTreatment),this._timerHandleTreatment=setTimeout(this.onDidProcessContextualComponent.bind(this),0)}},I.prototype.onDidUnFitContextForComponent=function(t){var e=this._components[t];if(e&&e.context){if(e.context.fit)throw new Error("Unexpected state of context");this._timerHandleTreatment&&clearTimeout(this._timerHandleTreatment),this._timerHandleTreatment=setTimeout(this.onDidProcessContextualComponent.bind(this),0)}},I.prototype.setInitialContext=function(t){var e,n=Object.create(null);Object.keys(t||n).forEach(function(o){null!=(e=t[o])&&(n[o]=String(e))}),this._contexts=n},I.prototype.setContext=function(t,e){return this._contexts[t]!==e&&(e?this._contexts[t]=String(e):delete this._contexts[t],this._timerHandle&&clearTimeout(this._timer),this._timerHandle=setTimeout(this.onDidChangeContext.bind(this,this._contexts),0)),this},I.prototype.onDidProcessContextualComponent=function(){var t=[],e=[],n=[],r=[],i=[],s=[],p=this;return A(this,function(o,a){if(o.context){var c=!0;o.standard||p._WSComponents.includes(a)||(c=c&&!p.WSState),c&&o.context.fit&&!o.component?o.ctor?(p.registerComponentThruMetaData(a,o),o.standard?i.push(o.component):s.push(o.component)):(t.push(o.module),e.push(a)):o.context.fit||o.component&&(n.push(o.component),o.standard&&r.push(o.component))}}),this._timerHandleTreatment=null,p.modules=t,new o(function(n,o){var r,a,c,u;require(t,function(){if(arguments.length!==p.modules.length)return n();for(r=0;r<arguments.length;r++)a=arguments[r],c=e[r],(u=p._components[c]).ctor=a,u=p._components[c],p.registerComponentThruMetaData(c,u),u.standard?i.push(u.component):s.push(u.component);n()},o)}).then(function(){return p.cleanComponents({iterator:g(n)})}).then(function(){return p.destroyComponents({iterator:g(r)})}).then(function(){return p.initializeStandardComponents({iterator:g(i)})}).then(function(){return p.initializeApplicativeComponents({iterator:g(s)})}).then(function(){return p.getWelcomeScreenState()||p._doIWantToBeInWSContext?Promise.resolve():p.configureComponents({iterator:g(i)})}).then(function(){return p.onDidContextualComponentsUpdate&&p.onDidContextualComponentsUpdate(),o.resolve()})},I.prototype.displayLoader=function(t){if(this._container.id==t.id&&!this._loader){this._loader=new u;var e=d.get("WAfrTransitionLaunched.title");this._loader.on(e+t.appTitle+"..."),c.createModal(this._view,this._loader.elements.container)}},I.prototype.hideLoader=function(){this._loader&&this._view&&(this._loader.off(),c.removeModal(this._view),this._loader=null)},I.prototype.gotoWelcomeScreen=function(){var t=this;return t._doIWantToBeInWSContext=!0,this.initializeWelcomeScreen().then(function(){return t.WSState=!0,Promise.resolve()})},I.prototype.gotoApp=function(){this._doIWantToBeInWSContext=!1;Promise.resolve();if(this.isA2X&&this.getSourceApp()){let t=this.getSourceApp().getId();return this._launchA2XNativeApp({appId:t})}return this._appPromiseSequence()},I.prototype.getWelcomeScreenState=function(){return this.WSState},h});