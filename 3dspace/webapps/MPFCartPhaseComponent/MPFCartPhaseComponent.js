define("DS/MPFCartPhaseComponent/CartPhaseTotalFooter",["UWA/Core","UWA/Class/View","DS/MPFCartModel/CartModelHelper","DS/MPFCartPhaseModel/CartPhaseModel","i18n!DS/MPFCartPhaseComponent/assets/nls/CartPhaseComponent"],function(t,e,a,s,r){"use strict";return e.extend({className:"mpf-cart-phase-total-footer",setup:function(t){this.cart=t.cart,this.cartPhases=t.cartPhases,this.listenTo(this.cartPhases,"onChange:"+s.Fields.PRICE,this.render.bind(this)),this.listenTo(this.cartPhases,"onRemove",this.render.bind(this))},render:function(){return this.container.setContent([{tag:"div",class:"mpf-label",text:r.get("total")},{tag:"div",class:"mpf-message",text:r.get("paymentAreDueAtBeginningOfPhase")},{tag:"div",class:"mpf-total",text:this._calcPrice()}]),this},_calcPrice:function(){var e=this.cartPhases.reduce(function(t,e){var a;return a=parseFloat(e.getPrice()),isNaN(a)?t:t+a},0);return t.is(e,"number")?a.formatPrice(this.cart,e):"-"},destroy:function(){this.stopListening(this.cartPhases),this.cart=null,this.cartPhases=null,this._parent(),this.container=null}})}),define("DS/MPFCartPhaseComponent/CartPhaseHelper",["UWA/Class","UWA/Promise","DS/MPFServices/ObjectService","DS/MPFCartModel/CartPatchArray","DS/MPFCartModel/CartPatchOperation","DS/MPFCartPhaseModel/CartPhaseFactory","DS/MPFCartModel/CartModel","DS/MPFCartPhaseModel/CartPhaseModel","DS/MPFCartPhaseModel/CartPhaseCollection"],function(t,e,a,s,r,i,n,h,c){"use strict";var o=t.extend({init:function(t){a.requiredOfPrototype(t.cartPhaseFactory,i,"option.cartPhaseFactory must be a CartPhaseFactory"),a.requiredOfPrototype(t.cart,n,"option.cart must be a CartModel"),a.requiredOfPrototype(t.cartPhases,c,"options.cartPhases must be a CartPhaseCollection"),this.cartPhaseFactory=t.cartPhaseFactory,this.cart=t.cart,this.cartPhases=t.cartPhases,this.phasesToDelete=[]},addPhase:function(){var t=this.cartPhaseFactory.createModel(i.Types.CART_CART_PHASE,null,{parentResourceId:this.cart.get("id")});return t.setNumber(this.cartPhases.size()+1),t.setState(h.States.SUBMITTED),this.cartPhases.add(t),t},deletePhase:function(t){t.isNew()||this.phasesToDelete.push(t),this.cartPhases.remove(t),this.cartPhases.forEach(function(t,e){t.isEditable()&&t.setNumber(e+1)})},getCartPatchArray:function(t){t=t||{};var e=new s;return this.phasesToDelete.forEach(function(t){e.add(new r(r.Operations.REMOVE,"/phases/"+t.get("id")))}),this.cartPhases.forEach(function(t){if(t.hasPendingChanges()){var a=t.isNew()?r.Operations.ADD:r.Operations.MODIFY,s=t.isNew()?"/phases":"/phases/"+t.get("id");e.add(new r(a,s,t.getPendingChanges()))}}),t.addEmptyMessage&&e.add(new r(r.Operations.add,"/message",{author:"/mdshop/shops/"+this.cart.getShopID(),message:""})),e},save:function(t){var a=this.getCartPatchArray(t);return a.length()>0?this.cart.megaPatch(a).then(this.reset.bind(this)):e.resolve()},reset:function(t){return(t=t||{}).cartPhases&&(this.cartPhases=t.cartPhases),this.phasesToDelete=[],this}});return o.getModifyPhaseOperation=function(t,e){return new r(r.Operations.MODIFY,"/phases/"+t.get("id"),e)},o.getPhaseStateUpdateOperation=function(t,e){var a={};return a[h.Fields.STATE]=e,o.getModifyPhaseOperation(t,a)},o}),define("DS/MPFCartPhaseComponent/TimelineArrow",["UWA/Class/View","css!DS/MPFCartPhaseComponent/MPFCartPhaseComponent"],function(t){"use strict";return t.extend({className:"mpf-arrow",setup:function(t){this.label=t.label,this.isChevron=!0===t.isChevron,this.forceHorizontal=!0===t.forceHorizontal,this.isChevron&&this.container.addClassName("mpf-double-arrow"),this.forceHorizontal&&this.container.addClassName("force-horizontal")},render:function(){return this.container.setContent([{tag:"div",class:"mpf-text",text:this.label}]),this},destroy:function(){this._parent(),this.container=null}})}),define("DS/MPFCartPhaseComponent/CartPhaseItemSummary",["UWA/Core","UWA/Class/View","DS/MPFCartModel/CartModelHelper","DS/MPFCartPhaseComponent/TimelineArrow","i18n!DS/MPFCartPhaseComponent/assets/nls/CartPhaseComponent","css!DS/MPFCartPhaseComponent/MPFCartPhaseComponent"],function(t,e,a,s,r){"use strict";return e.extend({className:"mpf-cart-phase-item-summary",setup:function(t){this.cart=t.cart,this.cartPhase=t.cartPhase},render:function(){return this.container.setContent([this._createLine1(),this._createLine2()]),this},destroy:function(){this.cart=null,this.cartPhase=null,this._parent(),this.container=null},_createLine1:function(){return t.createElement("div",{class:"mpf-line-1",html:[this._createPhaseLabel(),this._createDescription(),this._createPrice()]})},_createPhaseLabel:function(){return t.createElement("div",{class:"mpf-label",html:[{tag:"div",text:r.get("phaseNumber",{number:this.cartPhase.getNumber()})},{tag:"div",class:"mpf-state",text:this.cartPhase.getDisplayedState()}]})},_createDescription:function(){return t.createElement("div",{class:"mpf-description",text:this.cartPhase.getDescription()})},_createPrice:function(){var e;return e=a.formatPrice(this.cart,parseFloat(this.cartPhase.getPrice())),t.createElement("div",{class:"mpf-price",text:e})},_createLine2:function(){return t.createElement("div",{class:"mpf-line-2",html:[this._createTimelineLabel(),{tag:"div",class:"mpf-arrows",html:[this._createStartDate(),this._createDeliveryDate()]}]})},_createTimelineLabel:function(){return t.createElement("div",{class:"mpf-label",text:r.get("timeline")})},_createStartDate:function(){return new s({label:r.get("startDate",{date:this.cartPhase.getStartDate()})}).render()},_createDeliveryDate:function(){return new s({label:r.get("deliveryDate",{date:this.cartPhase.getEndDate()}),isChevron:!0}).render()}})}),define("DS/MPFCartPhaseComponent/CartPhaseItemCreator",["UWA/Core","UWA/Class/View","DS/MPFView/FieldTextInputV2","DS/MPFView/FieldDateInput","DS/MPFView/FieldPriceInput","DS/MPFCartPhaseModel/CartPhaseModel","DS/MPFCartModel/CartModelHelper","DS/MPFCartPhaseComponent/TimelineArrow","i18n!DS/MPFCartPhaseComponent/assets/nls/CartPhaseComponent","css!DS/MPFUI/MPFUI"],function(t,e,a,s,r,i,n,h,c){"use strict";var o,d={};return d.DELETE="delete",(o=e.extend({className:"mpf-cart-phase-item",setup:function(t){this.cart=t.cart,this.cartPhase=t.cartPhase,this.minDate=t.minDate,this.maxDate=t.maxDate,this.line1=this._createLine1(),this.line2=this._createLine2(),this.deleteIcon=this._createDeleteIcon()},getPhase:function(){return this.cartPhase},render:function(){return this.container.setContent([this.line1,this.line2]),this.cartPhase.isEditable()&&this.deleteIcon.inject(this.container),this},showErrors:function(t,e){t.getErrors().forEach(function(t,a){var s;switch(t.field){case i.Fields.DESCRIPTION:s=this.descriptionField,this.descriptionField.validate();break;case i.Fields.UNIT_NET_AMOUNT:s=this.priceField,this.priceField.showError(t.message);break;case i.Fields.START_DATE:s=this.startDateField,this.startDateField.showValidationErrors({isValid:!1,errors:[t]});break;case i.Fields.END_DATE:s=this.endDateField,this.endDateField.showValidationErrors({isValid:!1,errors:[t]})}e&&0===a&&s.focus&&s.focus()},this)},destroy:function(){this.stopListening(),this.descriptionField.destroy(),this.priceField.destroy(),this.startDateField.destroy(),this.endDateField.destroy(),this._parent()},updateMinAndMaxDates:function(t){if(this.minDate=t.minDate,this.maxDate=t.maxDate,this.startDateField&&this.endDateField){var e=this.startDateField.getDate(),a=this.endDateField.getDate(),s=this._calculateMinAndMaxDates(e,a);this.startDateField.setMinDate(s.startDateMin),this.startDateField.setMaxDate(s.startDateMax),this.endDateField.setMinDate(s.endDateMin),this.endDateField.setMaxDate(s.endDateMax)}},_calculateMinAndMaxDates:function(t,e){var a={};return a.startDateMin=this.minDate,a.endDateMax=this.maxDate,a.startDateMax=!e||e>this.maxDate?this.maxDate:e,a.endDateMin=!t||t<this.minDate?this.minDate:t,a},_createLine1:function(){return t.createElement("div",{class:"mpf-line-1",html:[this._createTitle(),this._createDescription(),this._createPrice()]})},_createTitle:function(){return t.createElement("div",{class:"mpf-phase-title",html:[{tag:"div",text:c.get("phaseNumber",{number:this.cartPhase.getNumber()})},{tag:"div",class:"mpf-state",text:this.cartPhase.getDisplayedState()}]})},_createDescription:function(){return this.descriptionField=new a({className:"mpf-description mpf-entry-v2",model:this.cartPhase,fieldName:i.Fields.DESCRIPTION,fieldLabel:c.get("description"),dynamicValidation:!0,readOnly:!this.cartPhase.isEditable()}),this.descriptionField.render()},_createPrice:function(){return this.priceField=new r({model:this.cartPhase,fieldName:i.Fields.PRICE,fieldLabel:c.get("price"),readOnly:!this.cartPhase.isEditable(),min:.5,max:999999.99,numberDecimals:2,currency:this.cart.getCurrency()}),this.priceField.render()},_createLine2:function(){var e=this._calculateMinAndMaxDates(this.cartPhase.getStartDate()&&new Date(this.cartPhase.getStartDate()),this.cartPhase.getEndDate()&&new Date(this.cartPhase.getEndDate()));return t.createElement("div",{class:"mpf-line-2",html:[{tag:"div",class:"mpf-label-placeholder"},this._createStartSection(e),this._createDeliverySection(e),{tag:"div",class:"mpf-timeline-label",text:c.get("timeline")}]})},_createStartSection:function(e){this.startDateField=new s({model:this.cartPhase,fieldName:i.Fields.START_DATE,readOnly:!this.cartPhase.isEditable(),min:e.startDateMin,max:e.startDateMax,renderDatePickerInside:!0,additionalClassName:"mpf-start-date"});var a=new h({label:c.get("start"),forceHorizontal:!0});return t.createElement("div",{class:"mpf-date-section mpf-start-section",html:[a.render(),this.startDateField.render()]})},_createDeliverySection:function(e){this.endDateField=new s({model:this.cartPhase,fieldName:i.Fields.END_DATE,readOnly:!this.cartPhase.isEditable(),min:e.endDateMin,max:e.endDateMax,renderDatePickerInside:!0,additionalClassName:"mpf-end-date"});var a=new h({label:c.get("delivery"),forceHorizontal:!0,isChevron:!0});return t.createElement("div",{class:"mpf-date-section mpf-delivery-section",html:[a.render(),this.endDateField.render()]})},_createDeleteIcon:function(){return t.createElement("div",{class:"fonticon fonticon-trash mpf-delete-phase-icon",events:{click:this.dispatchEvent.bind(this,d.DELETE,this.cartPhase)}})}})).Events=Object.freeze(d),o}),define("DS/MPFCartPhaseComponent/CartPhaseItemCreatorList",["UWA/Core","UWA/Class/View","DS/UIKIT/Mask","DS/MPFCartModel/CartModel","DS/MPFCartPhaseModel/CartPhaseModel","DS/MPFCartPhaseModel/CartPhaseCollection","DS/MPFCartPhaseModel/CartPhaseFactory","DS/MPFCartPhaseComponent/CartPhaseItemCreator","DS/MPFServices/ObjectService","DS/MPFUtils/MPFUtils","i18n!DS/MPFCartPhaseComponent/assets/nls/CartPhaseComponent"],function(t,e,a,s,r,i,n,h,c,o,d){"use strict";return e.extend({className:"mpf-cart-phase-list",setup:function(t){t||(t={}),c.requiredOfPrototype(t.cart,s,"option.cart must be a CartModel"),c.requiredOfPrototype(t.cartPhases,i,"options.cartPhases must be a CartPhaseCollection"),c.requiredOfPrototype(t.cartPhaseFactory,n,"option.cartPhaseFactory must be a CartPhaseFactory"),this.cart=t.cart,this.cartPhases=t.cartPhases,this.cartPhaseFactory=t.cartPhaseFactory,this.cartPhaseHelper=t.cartPhaseHelper,this.listenTo(this.cartPhases,"onChange:"+r.Fields.START_DATE,this._updateMinAndMaxDates.bind(this)),this.listenTo(this.cartPhases,"onChange:"+r.Fields.END_DATE,this._updateMinAndMaxDates.bind(this))},render:function(){var e;return this.cartPhaseItems=this._createCartPhaseItems(),e=this.cartPhaseItems.length>0?this.cartPhaseItems.map(function(t){return t.render()}):t.createElement("span",{text:d.get("noPhaseDefined"),class:"mpf-no-phase-message"}),this.container.setContent(e),this},addPhase:function(){this.cartPhaseHelper.addPhase(),this.render()},showErrors:function(t){this.cartPhasesValidationResults=t,this.render();var e=this,a=this._getPhaseNumberOfFirstError();this.cartPhaseItems.forEach(function(t,s){e._showItemError(t,t.getPhase().getNumber()===a)}),this.cartPhasesValidationResults=null},destroy:function(){if(this.stopListening(),Array.isArray(this.cartPhaseItems))for(var t=0;t<this.cartPhaseItems.length;t++)this.cartPhaseItems[t].destroy();this.cart=null,this.cartPhases=null,this.cartPhaseFactory=null,this.cartPhaseHelper=null,this._parent()},_createCartPhaseItem:function(t,e,a){var s=new h({cart:this.cart,cartPhase:t,minDate:e,maxDate:a});return this.listenTo(s,h.Events.DELETE,this._deletePhase.bind(this)),s},_createCartPhaseItems:function(){var t=this._getMinAndMaxDates();return this.cartPhases.map(function(e,a){return this._createCartPhaseItem(e,t[a].minDate,t[a].maxDate)}.bind(this))},_updateMinAndMaxDates:function(){if(this.cartPhaseItems){var t=this._getMinAndMaxDates();this.cartPhaseItems.forEach(function(e,a){e.updateMinAndMaxDates(t[a])})}},_getMinAndMaxDates:function(){var t=[],e=this.cartPhases.size();if(e>0){for(var a=0;a<this.cartPhases.size();a++)t.push({});var s,r,i,n=Date.now();t[0].minDate=new Date(n);for(var h=1;h<e;h++)r=this.cartPhases.at(h-1),i=this.cartPhases.at(e-h),n=r.getEndDate()||r.getStartDate()||n,s=i.getStartDate()||i.getEndDate()||s,t[h].minDate=new Date(n),t[e-1-h].maxDate=s&&new Date(s)}return t},_showItemError:function(t,e){var a;this.cartPhasesValidationResults&&!this.cartPhasesValidationResults.isValid()&&(a=o.findInArray(this.cartPhasesValidationResults.getPhaseValidationResults(),function(e){var a=t.getPhase(),s=e.getPhase();return a.id&&s.id?a.id===s.id:a.getNumber()===s.getNumber()}))&&t.showErrors(a,e)},_getPhaseNumberOfFirstError:function(){var t,e=this.cartPhasesValidationResults&&!this.cartPhasesValidationResults.isValid();return e&&(t=o.findInArray(this.cartPhasesValidationResults.getPhaseValidationResults(),function(t){return!t.isValid()})),e&&t?t.getPhase().getNumber():-1},_deletePhase:function(t){this.cartPhaseHelper.deletePhase(t),this.render()}})}),define("DS/MPFCartPhaseComponent/CartPhaseItemSummaryList",["UWA/Class/View","DS/MPFCartPhaseComponent/CartPhaseItemSummary"],function(t,e){"use strict";return t.extend({className:"mpf-phase-item-summary-list",setup:function(t){this.cart=t.cart,this.cartPhases=t.cartPhases,this.items=[],this.listenTo(this.cartPhases,"onSync",this.render.bind(this))},render:function(){return this._destroyItems(),this.items=this.cartPhases.filter(function(t){return!t.isNew()}).map(function(t){return new e({cart:this.cart,cartPhase:t}).render()},this),this.container.setContent(this.items),this},destroy:function(){this.stopListening(),this._destroyItems(),this.items=[],this.cart=null,this.cartPhases=null,this._parent(),this.container=null},_destroyItems:function(){this.items.forEach(function(t){t.destroy()})}})}),define("DS/MPFCartPhaseComponent/CartPhaseCreator",["UWA/Core","UWA/Promise","UWA/Class/View","DS/UIKIT/Alert","DS/MPFCartModel/CartModel","DS/MPFCartPhaseModel/CartPhaseModel","DS/MPFCartPhaseModel/CartPhaseCollection","DS/MPFCartPhaseModel/CartPhaseFactory","DS/MPFServices/ObjectService","DS/MPFCartPhaseComponent/CartPhaseHelper","DS/MPFCartPhaseComponent/CartPhaseItemCreatorList","DS/MPFCartPhaseComponent/CartPhaseTotalFooter","DS/MPFCartPhaseModel/CartPhaseValidationResult","i18n!DS/MPFCartPhaseComponent/assets/nls/CartPhaseComponent","css!DS/MPFCartPhaseComponent/MPFCartPhaseComponent"],function(t,e,a,s,r,i,n,h,c,o,d,l,P,m){"use strict";return a.extend({className:"mpf-cart-phase-creator",setup:function(t){t||(t={}),c.requiredOfPrototype(t.cart,r,"option.cart must be a CartModel"),c.requiredOfPrototype(t.cartPhases,n,"options.cartPhases must be a CartPhaseCollection"),c.requiredOfPrototype(t.cartPhaseFactory,h,"option.cartPhaseFactory must be a CartPhaseFactory"),this.cart=t.cart,this.cartPhases=t.cartPhases,this.cartPhaseFactory=t.cartPhaseFactory,this.cartPhaseHelper=this._createCartPhaseHelper(),this.addPhaseCommand=this._createAddPhaseCommand(),this.header=this._createHeader(),this.cartPhaseItemList=this._createCartPhaseItemList(),this.totalFooter=this._createTotalFooter(),this.alert=this._createAlert()},render:function(){return this.container.setContent([this.alert,this.header,this.cartPhaseItemList.render(),this.totalFooter.render()]),this},onAddPhase:function(){this.cartPhaseItemList.addPhase()},getCartPatchOperations:function(){if(this.validate().isValid()){var t=this.cartPhases.at(0);return t&&t.isNew()&&t.unset(i.Fields.STATE),this.cartPhaseHelper.getCartPatchArray()}return null},validate:function(){var t;return 0===this.cartPhases.size()?(this.showAlert(m.get("mustContainOnePhase")),(t=new P).addError(void 0,m.get("mustContainOnePhase"))):(t=this.cartPhases.validate()).isValid()||this.showErrors(t),t},showErrors:function(t){this.cartPhaseItemList.showErrors(t)},showAlert:function(t){this.alert.add({className:"error",message:t}).show()},resetAlert:function(){var t=this;this.alert.getMessages().forEach(function(e){t.alert.remove(e)})},destroy:function(){this.cartPhaseItemList.destroy(),this.totalFooter.destroy(),this.cart=null,this.cartPhases=null,this.cartPhaseFactory=null,this._parent(),this.container=null},_createCartPhaseHelper:function(){return new o({cart:this.cart,cartPhases:this.cartPhases,cartPhaseFactory:this.cartPhaseFactory})},_createAddPhaseCommand:function(){return t.createElement("a",{class:"mpf-link-button",text:"+ "+m.get("addPhase"),events:{click:this.onAddPhase.bind(this)}})},_createHeader:function(){var e;return e=t.createElement("div",{class:"mpf-title",text:m.get("scheduleAndPrices")}),t.createElement("header",{class:"mpf-header",html:[e,this.addPhaseCommand]})},_createCartPhaseItemList:function(){return new d({cart:this.cart,cartPhases:this.cartPhases,cartPhaseFactory:this.cartPhaseFactory,cartPhaseHelper:this.cartPhaseHelper})},_createTotalFooter:function(){return new l({cart:this.cart,cartPhases:this.cartPhases})},_createAlert:function(){return new s({visible:!1,closable:!0,autoHide:!0,hideDelay:4e3})}})}),define("DS/MPFCartPhaseComponent/CartPhaseCreatorFactory",["UWA/Class","UWA/Promise","DS/MPFServices/ObjectService","DS/MPFConnector/Connector","DS/MPFConnector/MarketplaceConnector","DS/MPFModelFactory/MPFFactoriesV2","DS/MPFCartModel/CartFactory","DS/MPFCartPhaseModel/CartPhaseFactory","DS/MPFCartPhaseComponent/CartPhaseCreator"],function(t,e,a,s,r,i,n,h,c){"use strict";var o=t.extend({init:function(t){a.requiredOfPrototype(t.connector,s,"options.connector must be a Connector"),this.connector=t.connector},fromCartId:function(t){var a,s=i.getInstance(this.connector);return e.all([s.getFactory(i.Types.CART),s.getFactory(i.Types.CART_PHASE)]).then(function(s){a=s[1];var r=s[0].createModel(n.Types.CART);r.set("id",t);var i=a.createCollection(h.Types.CART_CART_PHASE);return i.setParentResourceId(t),e.all([r.fetchPromise(),i.fetchPromise()])}).then(function(t){return new c({cart:t[0],cartPhases:t[1],cartPhaseFactory:a})})}});return o.from=function(t){return r.fetchPromise(t).then(function(e){return new o({connector:e}).fromCartId(t.cartId)})},o}),define("DS/MPFCartPhaseComponent/CartPhaseSummary",["UWA/Core","UWA/Class/View","DS/UIKIT/Mask","DS/UIKIT/Alert","DS/MPFCartModel/CartModel","DS/MPFCartPhaseModel/CartPhaseCollection","DS/MPFServices/ObjectService","DS/MPFCartPhaseComponent/CartPhaseItemSummaryList","DS/MPFCartPhaseComponent/CartPhaseItemCreatorList","DS/MPFCartPhaseComponent/CartPhaseTotalFooter","DS/MPFCartPhaseComponent/CartPhaseHelper","DS/MPFFiniteStateMachine/FiniteStateMachine","i18n!DS/MPFCartPhaseComponent/assets/nls/CartPhaseComponent","css!DS/MPFCartPhaseComponent/MPFCartPhaseComponent"],function(t,e,a,s,r,i,n,h,c,o,d,l,P){"use strict";var m,u={},C={};return u.READ="read",u.EDIT="edit",C.CHANGES_SAVED="changesSaved",(m=e.extend({className:"mpf-cart-phase-summary",setup:function(t){t||(t={}),n.requiredOfPrototype(t.cart,r,"option.cart must be a CartModel"),n.requiredOfPrototype(t.cartPhases,i,"options.cartPhases must be a CartPhaseCollection"),this.cart=t.cart,this.cartPhases=t.cartPhases,this.cartPhaseFactory=t.cartPhaseFactory,this.isReadOnly=!0===t.isReadOnly,this.stateMachine=this._createStateMachine(),this.saveCommand=this._createSaveCommand(),this.editCommand=this._createEditCommand(),this.addPhaseCommand=this._createAddPhaseCommand(),this.header=this._createHeader(),this.summaryList=this._createSummaryList(),this.footer=this._createFooter(),this.alert=this._createAlert()},render:function(){var t=this.stateMachine.getState()===u.EDIT?this.editList:this.summaryList;return this.container.setContent([this.alert,this.header,t.render(),this.footer.render()]),this},onSave:function(){var t=this,e=this.cartPhases.validate();if(e.isValid())return a.mask(this.container),this.cartPhaseHelper.save({addEmptyMessage:!0}).then(this.onEdit.bind(this)).then(this.dispatchEvent.bind(this,C.CHANGES_SAVED)).catch(this.showAlert.bind(this,P.get("failedToSaveModifications"))).finally(function(){a.unmask(t.container)});this.editList.showErrors(e)},onEdit:function(){var t=this;return a.mask(this.container),this.cartPhases.fetchPromise().then(function(){t.stateMachine.getState()===u.EDIT?(t.stateMachine.changeState(u.READ),t.container.removeClassName("mpf-cart-phase-creator"),t.editCommand.setText(P.get("edit")),t.saveCommand.addClassName("mpf-hidden"),t.addPhaseCommand.addClassName("mpf-hidden")):(t.cartPhaseHelper&&t.cartPhaseHelper.reset()||(t.cartPhaseHelper=t._createCartPhaseHelper()),t.editList||(t.editList=t._createEditList()),t.stateMachine.changeState(u.EDIT),t.container.addClassName("mpf-cart-phase-creator"),t.editCommand.setText(P.get("cancel")),t.saveCommand.removeClassName("mpf-hidden"),t.addPhaseCommand.removeClassName("mpf-hidden"))}).then(this.render.bind(this)).finally(function(){a.unmask(t.container)})},onAddPhase:function(){this.editList.addPhase()},destroy:function(){this.summaryList.destroy(),this.editList&&this.editList.destroy(),this.footer.destroy(),this.cart=null,this.cartPhases=null,this._parent(),this.container=null},showAlert:function(t){this.alert.add({className:"error",message:t}).show()},_createCartPhaseHelper:function(){return new d({cart:this.cart,cartPhases:this.cartPhases,cartPhaseFactory:this.cartPhaseFactory})},_createStateMachine:function(){return new l({state:u.READ,states:[u.READ,u.EDIT],transitions:[{from:u.READ,to:u.EDIT},{from:u.EDIT,to:u.READ}]})},_createEditCommand:function(){return t.createElement("a",{class:"mpf-link-button",text:P.get("edit"),events:{click:this.onEdit.bind(this)}})},_createSaveCommand:function(){return t.createElement("a",{class:"mpf-link-button mpf-hidden",text:P.get("save"),events:{click:this.onSave.bind(this)}})},_createAddPhaseCommand:function(){return t.createElement("a",{class:"mpf-link-button mpf-hidden",text:P.get("addPhase"),events:{click:this.onAddPhase.bind(this)}})},_createHeader:function(){var e,a;return e=t.createElement("h3",{class:"mpf-title",text:P.get("scheduleAndPrices")}),a=this.isReadOnly?[e]:[e,this.saveCommand,this.addPhaseCommand,this.editCommand],t.createElement("header",{class:"mpf-header",html:a})},_createSummaryList:function(){return new h({cart:this.cart,cartPhases:this.cartPhases})},_createEditList:function(){return new c({cart:this.cart,cartPhases:this.cartPhases,cartPhaseFactory:this.cartPhaseFactory,cartPhaseHelper:this.cartPhaseHelper})},_createFooter:function(){return new o({cart:this.cart,cartPhases:this.cartPhases})},_createAlert:function(){return new s({visible:!1,autoHide:!0})}})).Events=Object.freeze(C),m}),define("DS/MPFCartPhaseComponent/CartPhaseSummaryFactory",["UWA/Core","UWA/Class","UWA/Promise","DS/MPFServices/ObjectService","DS/MPFConnector/Connector","DS/MPFConnector/MarketplaceConnector","DS/MPFModelFactory/MPFFactoriesV2","DS/MPFCartModel/CartFactory","DS/MPFCartPhaseModel/CartPhaseFactory","DS/MPFCartPhaseComponent/CartPhaseSummary"],function(t,e,a,s,r,i,n,h,c,o){"use strict";var d=e.extend({init:function(t){s.requiredOfPrototype(t.connector,r,"options.connector must be a Connector"),this.connector=t.connector},fromCartId:function(e,s){s=s||{};var r,i=n.getInstance(this.connector);return a.all([i.getFactory(n.Types.CART),i.getFactory(n.Types.CART_PHASE)]).then(function(t){r=t[1];var s=t[0].createModel(h.Types.CART);s.set("id",e);var i=r.createCollection(c.Types.CART_CART_PHASE);return i.setParentResourceId(e),a.all([s.fetchPromise(),i.fetchPromise()])}).then(function(e){var a={cart:e[0],cartPhases:e[1],cartPhaseFactory:r};return a=t.merge(s,a),new o(a)})}});return d.from=function(t){return i.fetchPromise(t).then(function(e){return new d({connector:e}).fromCartId(t.cartId)})},d});