define("DS/CATW3DCommands/CATW3DMoveBarUX",["UWA/Class","DS/CATWebUXComponents/CATWebUXNotifBar"],function(e,t){"use strict";var n,o,i,a,s;return require(["i18n!DS/CATW3DCommands/assets/nls/CATW3DMoveBarUX"],function(e){n=e.PositionModifiedLbl,o=e.PositionModifiedOK,i=e.PositionModifiedCancel,a=e.PositionLockedLbl,s=e.PositionLockedLink}),e.extend({init:function(e){var l,r,d,c,h=e.nlsModifLbl||n;this.show=function(){l||(l=new t({className:"c3dMoveCmdDlg"}).inject(e.uiFrame),this.hide(),r=l.add({msgType:"primary",message:h,closable:!1,buttons:[{className:"spinner"},{className:"primary",label:o,onClick:e.onSave},{className:"default",label:i,onClick:e.onCancel}]}),this.hideSpinner(),this.hideSave(),(d=l.add({msgType:"warning",message:a,closable:!1,buttons:[{className:"link",label:s,onClick:e.onCancelLocked}]})).hide()),l.show()},this.showSave=function(){this.hideSpinner(),r&&(r.buttons[1].show(),c=!0)},this.showSpinner=function(){!1===c&&r.buttons[0].show()},this.showLock=function(){d&&d.show()},this.hide=function(){l&&l.hide()},this.hideSave=function(){r&&(c=!1,r.buttons[1].hide())},this.hideSpinner=function(){r&&r.buttons[0].hide()},this.hideLock=function(){d&&d.hide()},this.destroy=function(){l&&l.destroy(),l=r=d=null}}})}),define("DS/CATW3DCommands/CATW3DSetIdentityMatrixCmd",["DS/ApplicationFrame/Command","DS/Selection/CSOManager","DS/Visualization/ThreeJS_DS","DS/CATW3DMoveManager/CATW3DMoveReferent","DS/CATW3DMoveManager/CATW3DMoveManager","DS/PADUtils/PADContext"],function(e,t,n,o,i,a){"use strict";return e.extend({init:function(e){this._parent(e,{mode:"shared",isAsynchronous:!1}),this.setRepeatMode(!1),this.execute=function(){var e=[],s=a.get(),l=i.giveMoveManager({context:s}),r=o.getMoveReferentManager({context:s});t.get().forEach(function(t){var n=r.getMoveReferent(t.pathElement);n&&e.push({path:n})}),e.length&&(l.onMoveBegin({objectsMoved:e,from:this,moveMode:"Persistent"}),l.onMove({objectsMoved:e,from:this,leafMatrix:new n.Matrix4}),l.onMoveEnd({from:this,status:"Moved"}))}}})}),define("DS/CATW3DCommands/CATW3DCmdsUtils",["DS/ENOPAD3DViewer/utils/PAD3DViewerModelServices"],function(e){"use strict";var t={},n=["PPRContext","Drawing"];return t.isPLMNode=function(t){return t&&e.isPLMNode(t)},t.isPLMReferenceNode=function(t){return t&&e.isReference(t)},t.isPLMInstanceNode=function(t){return t&&e.isInstance(t)},t.isPLMLeafNode=function(t){return t&&e.is3DLeaf(t)},t.getLevelSelectorLevels=function(o){if(o){var i,a,s,l=o.pathElement,r=o.pathElementCurrent,d=o.onInfoCompleted,c=o.context,h=c.getController(),u=["ds6w:label","type_icon_url"];if(l&&c){var f,v,m=[],g=[],p=null,D={levels:m},C=l.clone();for(C.internalPath.length=0,v=C.getLastElement(!0);v;){var M={};if(f=e.getNodeType(v),t.isPLMInstanceNode(v)){if(0===m.length&&1===v.children.length){M.pathElement=C.clone();var S=v.children[0];M.pathElement.addElement(S),g.push(M.idRef=e.getNodeID(S)),g.push(M.idInst=e.getNodeID(v)),p=1}}else if(t.isPLMReferenceNode(v))M.pathElement=C.clone(),g.push(M.idRef=e.getNodeID(v)),s=C.externalPath.length>1?C.externalPath[C.externalPath.length-2]:null,t.isPLMInstanceNode(s)&&g.push(M.idInst=e.getNodeID(s));else if(t.isPLMLeafNode(v)&&(!o.fromFirstRef||C.getParentPath()&&C.getParentPath().isEqual(c.getRootBagPath())))M.pathElement=C.clone(),g.push(M.idRef=e.getNodeID(v));else if(v.getDibInfo&&!a)a=!0,M.pathElement=C.clone(),g.push(M.idRef=v.getDibInfo().id),(s=C.externalPath.length>1?C.externalPath[C.externalPath.length-2]:null)&&s.getDibInfo&&g.push(M.idInst=s.getDibInfo().id);else if(n.indexOf(f)>-1&&t.isPLMNode(v)){var E=C.externalPath.length>1?C.externalPath[C.externalPath.length-2]:null;t.isPLMNode(E)||(M.pathElement=C.clone(),g.push(M.idRef=e.getNodeID(v)))}M.pathElement&&(null===p&&r&&r.isEqual(M.pathElement)&&(p=m.length),m.push(M)),v=(C=C.getParentPath())?C.getLastElement(!0):void 0}return null!==p&&(D.currentLevel=p),h.isColorizeActivated()&&h.isStandalone()&&u.push(i=h.getBIColorMap().predicate),c.getController().getAttributes({ids:g,attributes:u,callbacks:{onComplete:function(e){m.forEach(function(t){t.name=e[t.idRef]?e[t.idRef]["ds6w:label"]:"",t.idInst&&e[t.idInst]&&e[t.idInst]["ds6w:label"]&&(t.name+=" ("+e[t.idInst]["ds6w:label"]+")"),t.icon=e[t.idRef]?e[t.idRef].type_icon_url:void 0,i&&(t.canvasColor=h.getColorValueForPredicate(e[t.idRef][i])),delete t.idRef,delete t.idInst}),d&&d()},onFailure:function(){m.forEach(function(e){delete e.idRef,delete e.idInst})}}}),D}}},Object.freeze(t)}),define("DS/CATW3DCommands/CATW3DLevelSelectorCmd",["DS/ApplicationFrame/Command","DS/LevelSelector/LevelSelector","DS/Selection/CSOManager","DS/Selection/HSOManager","DS/VisuEvents/EventsManager","DS/VisuEvents/ScreenEvent","DS/CATW3DMoveManager/CATW3DMoveReferent","DS/CATW3DCommands/CATW3DCmdsUtils","DS/PADUtils/PADContext","DS/ENOPAD3DViewer/utils/PAD3DViewerModelServices"],function(e,t,n,o,i,a,s,l,r,d){"use strict";return e.extend({init:function(e){this._parent(e,{mode:"shared",isAsynchronous:!0}),this.setRepeatMode(!1);var c,h,u,f,v,m,g,p,D=this,C=r.get(),M="DMULevelSelectorHdr"!==e.ID,S=function(e){v=null,e&&e.from&&1===e.from.length&&e.from[0].event&&"touchend"===e.from[0].event.type&&1===e.from[0].event.changedTouches.length&&(v=e.from[0])};i.addEvent(document,"onRelease",S),this.execute=function(){p=!0,f=n.onChange(function(){p=!1,D.end()}),m=[];var e=c;if(!e){var r=n.get();c=r.length>0?r[r.length-1]:void 0,e=c,h=c?c.pathElement:void 0;for(var S=0;S<r.length-1;++S)m.push(r[S])}if(g&&(g=n.get()),e&&e.pathElement){C.getFrameWindow().getContextualUIManager().hideContextualMenus();var E={x:0,y:0};if(v){var P=v.event.changedTouches[0];E.x=P.clientX,E.y=P.clientY}else{var x=i.getMouseEvents(a.MouseButton.NONE);x&&x.length&&(E.x=x[0].event.clientX,E.y=x[0].event.clientY)}v=null;var L=h;if(M){var R=(L=s.getMoveReferentManager({context:C}).getMoveReferent(h))?L.getLastElement(!0):null;R&&d.isInstance(R)&&R.children.length&&L.addElement(R.children[0])}var b={display:{type:"position",x:E.x,y:E.y},uiFrame:C.getFrameWindow().getUIFrame(),getLevels:function(t){var n=l.getLevelSelectorLevels({fromFirstRef:!1,pathElement:e.pathElement,pathElementCurrent:L,onInfoCompleted:t,context:C});if(n&&M){var o=s.getMoveReferentManager({context:C});n.selectColor="#ff821e",n.selectOverColor="#ffb477";for(var i=n.levels.length-1;i>=0;--i){var a=n.levels[i],r=a.pathElement.getLastElement(!0);if(d.isReference(r))if(d.isRepReference(r))a.selection="notCurrent";else o.getMoveReferent(a.pathElement)||(a.selection="notCurrent");else a.selection="notCurrent"}}return n},onHover:function(e){o.empty(),o.add(e)},onLeave:function(e){c&&(o.remove(e),o.add(c))},onSelect:function(e){if(f=n.unsubscribe(f),e&&e.pathElement&&0===e.pathElement.internalPath.length){M&&s.getMoveReferentManager({context:C}).addMoveReferent(e.pathElement),c.pathElement=e.pathElement,o.empty(),g||n.empty();var t=m.concat(g||c),i=u,a=g;setTimeout(function(){o.add(t),a||n.add(t),i&&i(e),C.getFrameWindow().getContextualUIManager().showContextualBar({hideWithDistance:!0})},0)}p=!1,D.end()}};t.createView(b)}else D.end()},this.endExecute=function(){p&&(g||c)&&(o.empty(),o.add(g||c)),f=n.unsubscribe(f),u=void 0,c=void 0,h=void 0,g=void 0,t.destroyView()},this.pauseExecute=function(){D.endExecute()},this.resumeExecute=function(){D.execute()},"CATW3DRobotLevelSelectorHdr"===e.ID&&(M=!1,this.setRobotParams=function(e){u=e.selectCB,g=e.doNotModifyCSO,c={pathElement:e.pathContext.clone()},h=e.pathCurrent.clone()}),"DMULevelSelectorHdr"===e.ID&&(this.showReferentLevel=function(e){M=e});var E=this._destroy;this._destroy=function(){D&&(i.removeEvent(document,"onRelease",S),E.call(D),D=C=null)}}})});