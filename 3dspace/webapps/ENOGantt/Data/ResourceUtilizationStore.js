define("DS/ENOGantt/Data/ResourceUtilizationStore",["DS/ENOGantt/Ven/Bryntum"],function(e){Ext.define("DS.ENOGantt.model.UtilizationResource",{extend:"Gnt.model.UtilizationResource",fields:[{name:"Id",mapping:"Id"},{name:"ContextId",mapping:"ContextId"},{name:"Name",mapping:"Name"},{name:"UserName",mapping:"UserName"},{name:"WorkTime",mapping:"WorkTime"},{name:"icon",mapping:"icon"}],inheritableStatics:{getSurrogateIdFor:function(t){var n=t.getId();return t instanceof e.model.Resource?n="resource-"+n:t instanceof e.model.Assignment?n="assignment-"+n:Ext.Error.raise("Wrong original record type"),n}}}),Ext.define("DS.ENOGantt.data.ResourceUtilizationStore",{extend:"Gnt.data.ResourceUtilizationStore",model:"DS.ENOGantt.model.UtilizationResource",allowExpandCollapseWhileFiltered:!1,sync:{url:"",requestConfig:{timeout:6e4}}}),Ext.define("DS.ENOGantt.DPMGanttAll.model.utilization.DefaultUtilizationNegotiationStrategy",{extend:"Sch.util.Patch",target:"Gnt.model.utilization.DefaultUtilizationNegotiationStrategy",overrides:{onSourceDataTouchBuffered:function(){Ext.ComponentQuery.query("#dpmresourceutilizationpanel")[0].isHidden()||this.callParent(arguments)},syncResourceUtilizationStore:function(){var e=this,t=e.getResourceUtilizationStore(),n=e.getResourceUtilizationEventStore(),a=t.getRoot(),i=e.getResourceStore(),o=e.getAssignmentStore();0===n.getCount()?(console.log("*********--------------------New Added*********--------------------"),e.fillResourceUtilizationStore()):(console.log("*********--------------------Existing*********--------------------"),e.syncingWithOriginal=!0,e.fireEventVia("sync-start",e),t.beginUpdate(),n.beginUpdate(),e.removeOutdatedSurrogateResources(t,n,i),e.removeOutdatedSurrogateModels(t,n,i,o),e.updatePresentSurrogates(t,n),e.addNewSurrogateResources(t,n,i),e.addNewSurrogateAssignments(t,n,o),a.sort(),n.endUpdate(),t.endUpdate(),e.syncingWithOriginal=!1,e.fireEventVia("sync-complete",e));var r=Ext.ComponentQuery.query("#dpmprojectgantt")[0].taskStore.assignmentStore,s=r.getRemovedRecords(),d=r.getModifiedRecords();d&&d.length>0||s&&s.length>0||Ext.ComponentQuery.query("#dpmresourceutilizationpanel")[0].getStore().commitChanges()},makeSurrogateResource:function(e){var t=this.callParent(arguments);t.set("icon",e.get("icon")),t.set("WorkTime",e.get("WorkTime"));var n=e.data.FirstName+" "+e.data.LastName;""==n.trim()&&(n=e.data.Title),t.set("Name",n),t.set("FullName",n);var a=Ext.ComponentQuery.query("#dpmprojectgantt")[0].crudManager.getCalendarManager().data.items;if(1==e.get("hasCalendar"))for(var i=0;i<a.length;i++)if(a[i].id==e.getCalendarId()){e.setCalendar(a[i].calendar);break}return t},makeSurrogateAssignment:function(e){var t=this.callParent(arguments);return t.set("icon",e.get("icon")),t.set("Units",e.get("Units")),t.set("Type",e.get("Type")),t.set("ReadOnly",e.get("isReadOnly")),t.set("TaskId",e.get("TaskId")),"External"==t.get("Type")&&t.set("cls","externalAssignment"),t},removeOutdatedSurrogateResources:function(e,t,n){var a=e.getRoot(),i=[],o=[];a.cascadeBy(function(e){var t;!e.isRoot()&&e.isSurrogateResource()&&(t=e.getOriginalResource(),n.contains(t)||(i.push(e),o=o.concat(e.getEvents())),e.getAssignments().length||(o=o.concat(e.getEvents())))}),t.remove(o),Ext.Array.each(i,function(e){e.remove()})}}}),Ext.define("DS.ENOGantt.DPMGanttAll.model.UtilizationEvent",{extend:"Sch.util.Patch",target:"Gnt.model.UtilizationEvent",overrides:{inheritableStatics:{getSurrogateIdFor:function(t){var n=t.getId();return t instanceof e.model.Resource?n="resource-"+n:t instanceof e.model.Assignment?n="assignment-"+n:Ext.Error.raise("Wrong original record type"),n}}}})});