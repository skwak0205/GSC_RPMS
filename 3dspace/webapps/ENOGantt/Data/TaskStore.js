define("DS/ENOGantt/Data/TaskStore",["UWA/Class","DS/ENOGantt/Ven/Bryntum","DS/ENOGantt/Data/ResponseUtil","DS/Foundation2/FoundationV2Data","DS/ENOGantt/URLStore","DS/ENOGantt/GanttUtil"],function(t,e,a,r,n,i){var l={patternMatches:function(t,e){return new RegExp(Ext.String.escapeRegex(t),"i").test(e)},dateMatchFound:function(t,e,a){var r=new Date(a[0].split("#")[1]),n=new Date(a[1].split("#")[1]),i=new Date(t.get(e));return i.setHours(0),i.setMinutes(0),i.setSeconds(0),isNaN(r)||isNaN(n)?isNaN(r)?i<=n:r<=i:r<=i&&i<=n}};return t.extend({init:function(t){Ext.ClassManager.isCreated("DS.ENOGantt.Data.TaskModel")||Ext.define("DS.ENOGantt.Data.TaskModel",{extend:"Gnt.model.Task",autoCalculateCostForParentTask:!1,autoCalculatePercentDoneForParentTask:!0,useOwnCalendarAsConverter:!0,autoCalculateCost:!1,fields:i.getTaskAndProjectModelFields(),getEarlyStartDateDefaultValue:function(t){var e=t.taskStore||this.getTaskStore(!0),a=this.getProject();if(this.data.TaskProjectId){var r=e.getModelById(this.data.TaskProjectId).data;return r.ConstraintDate?r.ConstraintDate:e.getProjectStartDate()}return a?a.getStartDate():e.getProjectStartDate()},isEditable:function(t){if(0==i.doBasicEditChecks(this))return!1;if(App.Infra.CustomeColumnDataIndex.includes(t))return App.Infra.customeColumnEditableData[t].isEditable;if(this.getReadOnly()&&this.data.State==App.Nls.Complete)return!1;if("root"==this.get("parentId"))return!1;return-1==["State","Status","TaskSequenceId","Type","Assignee","Deviation","FreeFloat","TotalFloat"].indexOf(t)&&("StartDate"==t?this.isStartDateEditable():"EndDate"==t?this.isEndDateEditable():"Duration"==t?this.isDurationEditable():"PercentDone"==t?this.isPercentDoneEditable():"Dependency"==t?this.isDependencyEditable():this.callParent(arguments))},isExpandable:function(){return!!this.get("expandable")&&!this.isLeaf()},isReadOnly:function(){var t=!1;return this.getReadOnly()&&(t=!0),t},isMilestone:function(t){var e=!1,a=this.get("EnglishType");return this.hasChildNodes()?e=!1:"Gate"!=a&&"Milestone"!=a||(e=!0),e},isStartDateEditable:function(){var t=App.Nls.Active,e=App.Nls.Review,a=App.Nls.Complete,r=this.get("State"),n=!this.isLeaf();return r!=t&&r!=e&&r!=a&&!n&&!App.Infra.TypeOf.ProjectTemplate},isEndDateEditable:function(){var t=App.Nls.Review,e=App.Nls.Complete,a=this.get("State"),r=!this.isLeaf();return a!=t&&a!=e&&!r&&!App.Infra.TypeOf.ProjectTemplate},isPercentDoneEditable:function(){return!!this.isLeaf()&&("Project Space Hold Cancel"!=Ext.ComponentQuery.query("#dpmprojectgantt")[0].taskStore.getRoot().childNodes[0].data.Policy&&1!=App.Infra.TypeOf.Experiment)},isDurationEditable:function(){var t=App.Nls.Review,e=App.Nls.Complete,a=this.get("State"),r=!this.isLeaf(),n=this.isMilestone();return 100!=this.get("PercentDone")&&a!=t&&a!=e&&!r&&!n},isDependencyEditable:function(){var t=App.Nls.Complete;return this.get("State")!=t}}),Ext.ClassManager.isCreated("DS.ENOGantt.Data.ProjectModel")||Ext.define("DS.ENOGantt.Data.ProjectModel",{extend:"Gnt.model.Project",autoCalculateCostForParentTask:!1,autoCalculatePercentDoneForParentTask:!1,autoCalculateCost:!1,AllowDependencies:!0,fields:i.getTaskAndProjectModelFields(),isExpandable:function(){return!!this.get("expandable")&&!this.isLeaf()},isEditable:function(t){return 0!=i.doBasicEditChecks(this)&&(App.Infra.CustomeColumnDataIndex.includes(t)?App.Infra.customeColumnEditableData[t].isEditable:!this.getReadOnly()&&("root"!=this.get("parentId")&&void 0))}}),Ext.define("MyDependencyStore",{override:"Gnt.data.DependencyStore",autoLoad:!0,proxy:{type:"memory",reader:{type:"json"}},getDependencyError:function(t,a,r,n,i){var l=this.callParent(arguments);l<=0&&-2==l&&(l=0);var s=Ext.ComponentQuery.query("#dpmprojectgantt")[0];if(l>=0){if(t instanceof e.model.Dependency)r=t.getType(),a=t.getTargetId();else if(null==r){var o=this.model.getField(this.model.prototype.typeField).defaultValue;r=void 0!==o?o:this.model.Type.EndToStart}var d,p=App.Nls.Review,u=App.Nls.Active,c=App.Nls.Complete,f=s.taskStore.getModelById(a);f&&(d=f.data.State),d!==p&&d!==u||0!==r&&2!==r||(l=-101),1!==r&&3!==r||!f.hasChildNodes()||(l=-102),d===c&&(l=-104)}return l}}),Ext.define("DS.ENOGantt.Data.TaskStore",{extend:"Gnt.data.TaskStore",requires:["DS.ENOGantt.Data.ProjectModel"],model:"DS.ENOGantt.Data.TaskModel",sortOnLoad:!1,autoNormalizeNodes:!1,scheduleByConstraints:!0,RefinementUtil:l,listeners:{datachanged:function(t,e){var a=Ext.getCmp("bbarObjectCount");if(a){var r=App.Nls["emxProgramCentral.Common.Objects"];a.setValue(t.getRange().length+" "+r)}}},checkDependencyConstraint:!0,checkPotentialConflictConstraint:!0,keepExpandStateWhileFiltered:!0,allowExpandCollapseWhileFiltered:!0,scheduleBackwards:!0,calendarManager:new e.data.CalendarManager({proxy:{type:"memory",reader:{type:"json"}},listeners:{load:function(){var t=n.getCalendarURL();window.isODTRunning?Ext.Ajax.request({url:t,async:!1,success:function(t){var e=t.data,r=[];e&&(r=a.formatCalendarData(e)),App.Infra.calendarData=r}}):r.ajaxRequest({url:t,type:"GET",dataType:"json",callback:function(t){var e=t.data,r=[];e&&(r=a.formatCalendarData(e)),App.Infra.calendarData=r}})}}}),proxy:{type:"memory",reader:{type:"json"}},getCriticalPaths:function(){var t=this,e=[],l=t.toArray()[1].data.Id;if(l){url=n.getCriticalPaths(l);var s={url:r.calculateFinalUrl(url),type:"GET",async:!1,dataType:"json",callback:function(r){if(r.success){var n=r.data[0];n.relateddata&&n.relateddata.tasks&&n.relateddata.tasks.length>0&&0==(e=a.getCriticalTasksArray(n.relateddata.tasks,t)).length&&alert(App.Nls["emxProgramCentral.Gantt.AlertForCriticalPath"])}}};return i.authenticateReqAndCall(s),Ext.Array.map(e,function(t){return t.getCriticalPaths()})}this.callParent(arguments)},find:function(t,e,r,n){var i=a.getGanttTableColumnArray(!1);if(i&&i.length>0){var l=i.length,s=this.toArray(),o=s.length;if(t){-1==(p=n-1)&&(p=o-1);for(var d=p;d>0;d--){if((c=s[d]).raw.visible&&this.performFind(e,c,l,i))return{model:c,index:d}}}else{d=p=n+1;for(var p,u=s.length;d<u;d++){var c;if((c=s[d]).raw.visible&&this.performFind(e,c,l,i))return{model:c,index:d}}}}},performFind:function(t,e,a,r){for(var n=!1,i=0;i<a;i++){var l=r[i],s=e.get(l.dataIndex);if(null!=s&&""!=s.toString()){if("datefield"==l.columnDataType){var o=l.format;s=Ext.util.Format.date(s,o)}if("Duration"==l.dataIndex&&(s=l.getValueToRender(s,null,e)),t.test(s)){n=!0;break}}}return n},filterTreeBy:function(t){this.callParent([{filter:function(e){if(e.isRoot())return!0;if("root"==e.get("parentId"))return App.Gantt.filter.FilterFieldTaskArray&&App.Gantt.filter.FilterFieldTaskArray.push(e),!0;if(e.get("ExternalTask"))return!1;if(e.parentNode&&!e.parentNode.isExpanded()&&!t)return!1;var a=App.Gantt.filter.filterBy,r=!0,n=App.Gantt.filter.filterField,i=["PercentDone","Duration","BaselineDuration","TotalFloat","FreeFloat","Deviation"];for(var s in a)if((!n||s!=n)&&a.hasOwnProperty(s)){var o=App.Gantt.filter.fields[s]?App.Gantt.filter.fields[s].fieldDataType:void 0,d=s,p=a[s].split("@"),u=e.get(d);if("Name"==s){var c=App.Gantt.filter.filterBy.Name;r=new RegExp(Ext.String.escapeRegex(c),"i").test(e.getName())}else if("datefield"==o){if(!(r=l.dateMatchFound(e,d,p)))break}else{if(!i.includes(s)){if(null!=u){if("numberfield"==o)if(u=Math.round(100*Number(u))/100,"Duration"==s)u=u+" "+App.Nls["emxProgramCentral.DurationUnits.Days"].toLowerCase();if(p.indexOf(u.toString())>=0)continue;r=!1;break}r=!1;break}if(!(r=this.doDeviationFilter(e,d,p,u)))break}}if(App.Gantt.filter.FilterFieldTaskArray){if(r){App.Gantt.filter.FilterFieldTaskArray.push(e);for(var f=e.parentNode;f;)App.Gantt.filter.FilterFieldTaskArray.push(f),f=f.parentNode;App.Gantt.filter.FilterFieldTaskArray.push(e)}return e.get("visible")}return r},checkParents:!0}])},doDeviationFilter:function(t,e,a,r){var n=a[0],i=a[1],l=App.Nls["emxProgramCentral.DurationUnits.Days"];if(null==r||""===r&&"PercentDone"!=e)return!1;"Deviation"==e&&(r=r.substring(0,r.indexOf(l)));var s=r;return s=Number.isInteger(parseFloat(s))?parseInt(s):parseFloat(s),isNaN(n)||isNaN(i)?isNaN(n)?i<=s:n<=s:n<=s&&s<=i}})},getStore:function(){return Ext.create("DS.ENOGantt.Data.TaskStore")}})});