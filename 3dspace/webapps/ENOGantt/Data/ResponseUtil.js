define("DS/ENOGantt/Data/ResponseUtil",["DS/ENOGantt/GanttConstants"],function(e){var t={},a=[],n={},r={},s={};return{To6WFieldMap:{icon:"typeicon","current.access[modify]":"modifyAccess",Policy:"policy",Type:"nlsType",Name:"title",Id:"objectId",State:"state",PercentDone:"percentComplete",StartDate:"estimatedStartDate",EndDate:"dueDate",Duration:"estimatedDurationInputValue",DurationUnit:"estimatedDurationInputUnit",ConstraintType:"constraintType",ConstraintDate:"constraintDate",TaskSequenceId:"sequenceOrder",LagTime:"lagTime",Lag:"lagTimeInputValue",LagUnit:"lagTimeUnitValue",Type:"dependencyType",TaskProjectId:"taskProjectId",CriticalTask:"criticalTask",Status:"status",SourceId:"sourceId",ScheduleFrom:"scheduleFrom",Owner:"owner",FreeFloat:"freeFloat",TotalFloat:"totalFloat",Color:"color",Pattern:"pattern",Note:"notes",Description:"description"},ToGanttFieldMap:{typeicon:"icon",modifyAccess:"current.access[modify]",policy:"Policy",nlsType:"Type",title:"Name",objectId:"Id",state:"State",percentComplete:"PercentDone",estimatedStartDate:"StartDate",dueDate:"EndDate",estimatedDurationInputValue:"Duration",estimatedDurationInputUnit:"DurationUnit",constraintType:"ConstraintType",constraintDate:"ConstraintDate",sequenceOrder:"TaskSequenceId",lagTimeInputValue:"Lag",lagTimeInputUnit:"LagUnit",dependencyType:"Type",taskProjectId:"TaskProjectId",criticalTask:"CriticalTask",status:"Status",sourceId:"SourceId",scheduleFrom:"ScheduleFrom",owner:"Owner",freeFloat:"FreeFloat",totalFloat:"TotalFloat",color:"Color",pattern:"Pattern",notes:"Note",description:"Description"},convertToGanttKeyValues:function(e){for(var t in e)if(App.Infra.CustomeColumnDataIndex.includes(t)&&(e[t]=this.formatDate(e[t])),e.hasOwnProperty(t)){var a=App.Infra.isCustomizedEnvironment;if(!a||"actualStartDate"!==t&&"actualFinishDate"!==t&&"actualDuration"!==t){if(a||"forecastStartDate"!==t&&"forecastFinishDate"!==t&&"forecastDuration"!==t)n=this.ToGanttFieldMap[t];else if("forecastStartDate"===t)n="BaselineStartDate";else if("forecastFinishDate"===t)n="BaselineEndDate";else if("forecastDuration"===t)n="BaselineDuration"}else if("actualStartDate"===t)var n="BaselineStartDate";else if("actualFinishDate"===t)var n="BaselineEndDate";else if("actualDuration"===t)var n="BaselineDuration";n&&(e[n]=e[t],delete e[t])}},convertTo6WKeyValues:function(e){for(var t in e)if(App.Infra.CustomeColumnDataIndex.includes(t)&&(e[t]=this.getFormattedDate(new Date(e[t]))),e.hasOwnProperty(t)){var a=App.Infra.isCustomizedEnvironment;if(!a||"BaselineStartDate"!==t&&"BaselineEndDate"!==t&&"BaselineDuration"!==t){if(a||"BaselineStartDate"!==t&&"BaselineEndDate"!==t&&"BaselineDuration"!==t)n=this.To6WFieldMap[t];else if("BaselineStartDate"===t)n="forecastStartDate";else if("BaselineEndDate"===t)n="forecastFinishDate";else if("BaselineDuration"===t)n="forecastDuration"}else if("BaselineStartDate"===t)var n="actualStartDate";else if("BaselineEndDate"===t)var n="actualFinishDate";else if("BaselineDuration"===t)var n="actualDuration";n&&(e[n]=e[t],delete e[t])}},mergeRelDataToBusData:function(e,t){for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a])},filterTaskForStatusReport:function(e,t){var a=t.taskStore.store.toArray(),n=[],r=e.tasks?e.tasks.rows:e,s=enoviaServer.objectId,d=[];if(enoviaServer.initGantt)for(var i=1;i<a.length;i++){var o=a[i].data.Id;d.push(o)}else null!=s&&(d=s.split(","));for(var l=0;l<r.length;l++){o=r[l].Id;if(-1!=d.indexOf(o)&&n.push(r[l]),r[l].children.length>0){var p=this.filterTaskForStatusReport(r[l].children,t);n=n.concat(p)}}return n},formatAssignees:function(e){for(var t=[],a=0,n=e.length;a<n;a++){var r=e[a].dataelements.fullname,s=e[a].type;this.isEqualObject(s,"Group")&&(r=e[a].dataelements.Title),t.push(r)}return t.join()},setLastSequence:function(e){var a=e.TaskProjectId;if(a){if(a&&(t[a]||(t[a]={}),e.TaskSequenceId))if(null==t[a].LastSequence)t[a].LastSequence=e.TaskSequenceId;else{var n=parseInt(t[a].LastSequence),r=parseInt(e.TaskSequenceId);(null==n||r>n)&&(t[a].LastSequence=e.TaskSequenceId)}}else{if(t[e.Id]){var s=t[e.Id].LastSequence;e.LastSequence=s}t[e.Id]=e}},formatDate:function(e){return e},getEnglishType:function(e){var t=e.Type||e.type,a="Task";null!=t&&(t=t.split(" ").join(""),a=App.Infra.DerivativeTypes[t]);return a},isEqualObject:function(e,t){var a=!0;for(key in e)if(e[key]!=t[key]){a=!1;break}return a},mergeExternalDep:function(e,t){for(var a=t.length-1;a>=0;a--){for(var n=t[a],r=!0,s=e.length-1;s>=0;s--){var d=e[s];if(d.predProjectName==n.predProjectName&&d.From==n.From&&d.To==n.To){if(r=!1,this.isEqualObject(n,d))continue;t[a]=d,e.splice(s,1)}}r&&t.splice(a,1)}if(e.length>0)for(var i=0;i<e.length;i++)t.push(e[i]);return t},setRawExternalDependency:function(e,t,a){var n=e.get("ExternalRawDependencies");(n={}).updated=[],n.added=[],n.removed=[];for(var r=0;r<a.length;r++){for(var s=a[r],d=!0,i=t.length-1;i>=0;i--){var o=t[i];o.predProjectName==s.predProjectName&&o.From==s.From&&o.To==s.To&&o.Type==s.Type&&o.Lag==s.Lag&&o.LagUnit==s.LagUnit&&(d=!1)}d&&n.removed.push(s)}if(t.length>0)for(var l=0;l<t.length;l++)n.added.push(t[l]);e.set("ExternalRawDependencies",n)},formatCalendarData:function(e){for(var t=[],a=0,n=e.length;a<n;a++){var r=e[a];r.Id=r.id,r.name=r.name,r.HoursPerDay=parseFloat(r.workHoursPerDay)/60;for(var s=[],d=r.workweek,i=0,o=0,l=d.length;o<l;o++){var p=d[o],c=p.workdayType;"Non Working"===c&&null==r.WeekendFirstDay?r.WeekendFirstDay=o:"Non Working"===c?r.WeekendSecondDay=o:null==r.WeekendSecondDay?r.WeekendSecondDay=r.WeekendFirstDay:null==r.WeekendFirstDay&&null==r.WeekendSecondDay&&(r.WeekendsAreWorkdays=!0);var u=p.workingHours;u&&""!==u||(u="0000-0000");for(var D=[],h=u.split(","),m=0;m<h.length;m++){var T=h[m].split("-"),f=T[0].substr(0,2)+":"+T[0].substr(2,2)+"-"+(T[1].substr(0,2)+":"+T[1].substr(2,2));D.push(f)}"Working"===c?(i++,s.push({Type:"WEEKDAY",Weekday:o,IsWorkingDay:!0,Availability:D})):s.push({Type:"WEEKDAY",Weekday:o,IsWorkingDay:!1})}r.DaysPerWeek=i,delete r.id,delete r.workHoursPerDay,delete r.workweek,r.Days={rows:s},t.push(r)}return t},formatDependencies:function(e,t){for(var n=new Array,r=t.TaskProjectId,s=(new Array,new Array),d=e.length,i=0;i<d;i++){var o=e[i],l=o.relelements;l.Id=o.relId,this.convertToGanttKeyValues(l);var p=l.predTaskSeqNumber;p&&(l.predTaskSeqNumber=parseInt(p)),l.predecessorTaskName=o.dataelements.title;var c=l.Type,u=t.TaskSequenceId;u&&(l.taskSeqNumber=parseInt(u)),l.successorTaskName=t.Name;var D=l.predTaskSeqNumber,h=l.predProjectName,m=l.predProjectId,T=l.Lag,f=l.LagUnit,v="",g=!0;if(h&&!a.includes(h)?(v=h+":",g=!1):h&&a.includes(h)&&r!=m?v=h+":":delete l.predProjectName,v=v+D+":"+c+"+"+T+" "+f,g||(l.isExtDep=!0,s.push(l)),null!=c){switch(c){case"SS":c="0";break;case"SF":c="1";break;case"FS":c="2";break;case"FF":c="3"}l.Type=c}g&&n.push(l)}return s.sort(),t.ExternalDependencies=s,n},formatDeliverableForStatusReport:function(e,t){for(var a=[],n=0;n<e.length;n++){var r=e[n],s={};s.Id=r.id;var d=r.dataelements;s.Name=d.name,s.leaf=!0,a.push(s)}return a},getsourceIdData:function(e,t){var a=[];if((a=t?e:e.relateddata.tasks).length>0)for(var n=0,r=a.length;n<r;n++){var d=a[n].dataelements;this.convertToGanttKeyValues(d);var i=d.SourceId;if(s[i]=d,a[n].children.length>0){var o=this.getsourceIdData(a[n].children,!0);this.mergeRelDataToBusData(s,o)}}return s},populateProjectNames:function(e){for(var t=e.length,n=0;n<t;n++){var r=e[n],s=r.dataelements,d=this.getEnglishType(r);"ProjectTemplate"!=d&&"ProjectSpace"!=d&&"ProjectConcept"!=d&&"Experiment"!=d&&"ProjectBaseline"!=d||a.push(s.name||s.title),r.children&&r.children.length>0&&this.populateProjectNames(r.children)}},loadFormat:function(t,a){var n=t[0],r=enoviaServer.viewId||App.Infra.ViewId;if(r==App.Infra.Views.VIEW_STATUS_REPORT){if(n.relateddata&&n.relateddata.tasks&&n.relateddata.tasks.length>0&&(t=(t=[]).concat(n.relateddata.tasks)),!window.isODTRunning&&null!=t)for(var d=t.length,i=0;i<d;i++)t[i].dataelements.CalendarId=App.Infra.projectDataElements.CalendarId}else a||(App.Infra.projectDataElements&&(window.isODTRunning||(n.dataelements=App.Infra.projectDataElements),n.dataelements.expanded="true",delete App.Infra.projectDataElements),App.Infra.projectRelElements&&(n.relelements=App.Infra.projectRelElements,delete App.Infra.projectRelElements),this.setProjectModel(n.dataelements),"Project Start Date"===n.dataelements.scheduleFrom?n.dataelements.ScheduleBackwards=!1:n.dataelements.ScheduleBackwards=!0,n.dataelements.FreeFloat="0.0",n.dataelements.TotalFloat="0.0",window.isODTRunning&&(n.dataelements.expanded="true"),n.relateddata&&n.relateddata.tasks&&n.relateddata.tasks.length>0&&(n.children=n.children.concat(n.relateddata.tasks)),n.relelements||(n.relelements={}));var o=t.length;a||this.populateProjectNames(t);var l=new Array,p=new Array,c=(new Array,[]),u=[];for(i=0;i<o;i++){var D=t[i],h=D.id,m=D.dataelements,T=D.relelements;this.mergeRelDataToBusData(m,T),this.convertToGanttKeyValues(m),m.Id=h;var f=D.children;if(f&&f.length>0){var v=this.loadFormat(f,!0);App.Infra.isCustomizedEnvironment&&(v.predActualStartDate.sort(),v.predActualEndDate.sort(),m.BaselineStartDate=v.predActualStartDate[0],m.BaselineEndDate=v.predActualEndDate[v.predActualEndDate.length-1]),m.children=v.tasks.rows,p=p.concat(v.dependencies.rows)}else m.children=[];m.hasEditAccess=m["current.access[modify]"],m.ReadOnly="TRUE"!=m.hasEditAccess;var g=m.isSummaryTask;g&&("true"==g.toLowerCase()&&r!=App.Infra.Views.VIEW_STATUS_REPORT?m.leaf=!1:m.leaf=!0),this.setLastSequence(m);var I=m.isTypeGate,y=m.isTypeMilestone;m.Rollup="TRUE"==I||"TRUE"==y;var S=m.ConstraintType?m.ConstraintType:m.defaultConstraintType;S&&("assoonaspossible"==(S=(S=S.replace(/ /g,"")).toLowerCase())&&(S=""),"TRUE"!=m.kindOfProjectSpace&&"TRUE"!=m.kindOfExperiment&&"TRUE"!=m.kindOfProjectConcept&&null!=m.ConstraintType&&""!=m.ConstraintType&&(m.ConstraintType=S));var k=m.Policy;if(-1!=e.OOTBPolicyList.indexOf(k)&&void 0!==App.Nls[m.State]&&(m.State=App.Nls[m.State]),m.ExternalDependencies=[],App.Infra.expandStatus[h]&&(m.expanded=!0),App.Infra.isCustomizedEnvironment){var E=s[m.SourceId];if(t.length>1&&E){var A=E.StartDate,C=E.EndDate;m.BaselineStartDate=this.formatDate(A),m.BaselineEndDate=this.formatDate(C)}else m.BaselineStartDate=this.formatDate(m.BaselineStartDate),m.BaselineEndDate=this.formatDate(m.BaselineEndDate);r!=App.Infra.Views.VIEW_EXPERIMENT_VERSUS_PROJECT&&r!=App.Infra.Views.VIEW_BASELINE_VERSUS_CURRENT_BASELINE&&r!=App.Infra.Views.VIEW_BASELINE_VERSUS_CURRENT_BASELINE2&&(m.BaselineStartDate&&""!=m.BaselineStartDate||(m.BaselineStartDate=m.StartDate),m.BaselineEndDate&&""!=m.BaselineEndDate||(m.predictiveActualFinishDate?(m.predictiveActualFinishDate=this.formatDate(m.predictiveActualFinishDate),m.BaselineEndDate=m.predictiveActualFinishDate):m.BaselineEndDate=m.EndDate),c.push(m.BaselineStartDate),u.push(m.BaselineEndDate));var F=App.Nls["emxProgramCentral.DurationUnits.Days"];m.BaselineDuration=m.BaselineDuration+" "+F.toLowerCase()}var P=m.TaskSequenceId;if(P&&(m.TaskSequenceId=parseInt(P)),m.EnglishType=this.getEnglishType(D),m.ExternalProjectDepRawData=[],D.relateddata&&D.relateddata.assignees&&r!=App.Infra.Views.VIEW_STATUS_REPORT&&D.relateddata.assignees.length>0){var B=this.formatAssignees(D.relateddata.assignees);m.Assignee=B}if(D.relateddata&&D.relateddata.deliverables&&D.relateddata.deliverables.length>0&&r==App.Infra.Views.VIEW_STATUS_REPORT&&!enoviaServer.initGantt){var w=this.formatDeliverableForStatusReport(D.relateddata.deliverables,m);m.leaf=!1,m.children=w}if(l.push(m),D.relateddata&&D.relateddata.predecessors&&r!=App.Infra.Views.VIEW_STATUS_REPORT){var N=this.formatDependencies(D.relateddata.predecessors,m);p=p.concat(N)}}return{success:!0,tasks:{rows:l},dependencies:{rows:p},calendars:{rows:App.Infra.calendarData},predActualStartDate:c,predActualEndDate:u}},syncFormat:function(t,s,d,i){if(!s){for(var o=i.taskStore.store.toArray(),l=0,p=o.length;l<p;l++){"ProjectTemplate"!=(c=o[l].data.EnglishType)&&"ProjectSpace"!=c&&"ProjectConcept"!=c&&"Experiment"!=c||a.push(o[l].data.Name)}var c,u=t[0];if(u.relateddata&&u.relateddata.tasks&&u.relateddata.tasks.length>0&&(u.children=u.children.concat(u.relateddata.tasks)),u.relateddata&&u.relateddata.performRollup&&u.relateddata.performRollup.length>0){for(var D=u.relateddata.performRollup[0].children,h=i.getTaskStore().collect("Id"),m=D.length-1;m>=0;m--){var T=D[m].id;h.indexOf(T)<0&&D.splice(m,1)}u.children=u.children.concat(D)}"ProjectSpace"!=(c=this.getEnglishType(u))&&"ProjectConcept"!=c&&"Experiment"!=c||(u.dataelements.expanded="true",u.relelements||(u.relelements={}))}var f=new Array,v=[],g=[],I=[],y=[],S=[];if(d&&d.contextTaskId&&S.push(d.contextTaskId),d&&d.deletedTaskArray&&(v=v.concat(d.deletedTaskArray)),t){var k=[],E=(P=t[0]).children;if(E&&E.length>0)for(var A=[],C=[],F=0;F<E.length;F++){var P,B=!0;if("RemovedTasks"==(ae=(P=E[F]).id)){k=P.children;for(p=0;p<k.length;p++){var w=k[p].dataelements;v.push(w)}}else{var N=P.dataelements;if(N){if(P.tempId)N.PhantomId=r.TaskPhantomId,delete r.TaskPhantomId;else{var W=(i=Ext.ComponentQuery.query("#dpmprojectgantt")[0].crudManager).taskStore.store.getModelById(ae);0==App.Infra.Load.Level||W||(B=!1)}var O=P.relelements;this.mergeRelDataToBusData(N,O),this.convertToGanttKeyValues(N),N.Id=ae;var L=P.children;if(L.length>0){var x=this.syncFormat([{children:L}],!0);App.Infra.isCustomizedEnvironment&&(x.predActualStartDate.sort(),x.predActualEndDate.sort(),N.BaselineStartDate=x.predActualStartDate[0],N.BaselineEndDate=x.predActualEndDate[x.predActualEndDate.length-1]),f=f.concat(x.tasks.rows)}"true"==N.isSummaryTask.toLowerCase()?N.leaf=!1:N.leaf=!0;var R=N.TaskSequenceId;if(R&&(N.TaskSequenceId=parseInt(R)),""==N.ConstraintDate)N.ConstraintType="";else{var j=N.ConstraintType;j&&(j=(j=j.replace(/ /g,"")).toLowerCase()),"assoonaspossible"==j&&(j=""),"muststarton"!=N.ConstraintType&&"mustfinishon"!=N.ConstraintType&&(j="",consDate=""),N.ConstraintType=j,N.ConstraintDate=this.formatDate(N.ConstraintDate)}var b=N.Policy;if(-1!=e.OOTBPolicyList.indexOf(b)&&void 0!==App.Nls[N.State]&&(N.State=App.Nls[N.State]),App.Infra.isCustomizedEnvironment){N.StartDate=this.formatDate(N.StartDate),N.EndDate=this.formatDate(N.EndDate),N.BaselineStartDate=this.formatDate(N.BaselineStartDate),N.BaselineEndDate=this.formatDate(N.BaselineEndDate),N.BaselineStartDate&&""!=N.BaselineStartDate||(N.BaselineStartDate=N.StartDate),N.BaselineEndDate&&""!=N.BaselineEndDate||(N.predictiveActualFinishDate?(N.predictiveActualFinishDate=this.formatDate(N.predictiveActualFinishDate),N.BaselineEndDate=N.predictiveActualFinishDate):N.BaselineEndDate=N.EndDate),A.push(N.BaselineStartDate),C.push(N.BaselineEndDate);var U=App.Nls["emxProgramCentral.DurationUnits.Days"];N.BaselineDuration=N.BaselineDuration+" "+U.toLowerCase()}N.EnglishType=this.getEnglishType(P),B&&f.push(N)}}if(d&&d.removedDepArray&&(I=d.removedDepArray),P.relateddata){var V=P.relateddata;if(V.predecessors&&V.predecessors.length>0){var M=i.taskStore.store,q=P.id,_=M.getModelById(P.dataelements.Id),K=_.get("TaskProjectId"),Y=V.predecessors,G=new Array,z=new Array;for(l=0;l<Y.length;l++){(w=Y[l].relelements).Id=Y[l].relId,this.convertToGanttKeyValues(w);w.To;var H=w.Type,$=w.predTaskSeqNumber,Q=w.Lag,J=w.LagUnit,X=w.predProjectName,Z=w.predProjectId,ee=!0;X&&!a.includes(X)?ee=!1:X&&a.includes(X)&&K!=Z?te=X+":":delete w.predProjectName,te=te+$+":"+H+"+"+Q+" "+J;var te=$+":"+H+"+"+Q+" "+J;G.push(te);var ae=Y[l].id;if("SS"==w.Type?w.Type="0":"SF"==w.Type?w.Type="1":"FS"==w.Type?w.Type="2":"FF"==w.Type&&(w.Type="3"),ee){var ne=w.To,re=w.From,se=w.$PhantomId,de=ne+"-"+re;(se=n[de])&&(delete n[de],w.$PhantomId=se),g.push(w)}else w.isExtDep=!0,z.push(w)}if(_){var ie=_.get("ExternalDependencies"),oe=this.mergeExternalDep(z,ie);q=P.dataelements.Id;f.push({Id:q,ExternalDependencies:oe})}G.sort()}if(V.assignees){var le=V.assignees;for(l=0;l<le.length;l++){(w=le[l].relelements).Id=le[l].relId,this.convertToGanttKeyValues(w),y.push(w)}}}}}return{success:!0,tasks:{rows:f,removed:v},dependencies:{rows:g,removed:I},assignments:{rows:y,removed:S},resources:{rows:[],removed:[]},predActualStartDate:A,predActualEndDate:C}},getFormattedDate:function(e){return e instanceof Date?Ext.Date.format(e,"Y-m-d\\TH:i:s"):e},get6WTaskDataSkeleton:function(){return{dataelements:{},id:"",updateAction:"",children:[],relelements:{},relateddata:{predecessors:[]}}},get6WDependencyDataSkeleton:function(e){return{id:"",updateAction:e,relelements:{}}},formatDeletedTask6WData:function(e,t,a){for(var n=e.taskStore.store,r=[],s=n.getRemovedRecords(),d=[],i={},o=0,l=s.length;o<l;o++){var p=s[o],c=p.id,u=p.data.lastParentId;d.push({Id:c}),(m={}).lastParentId=u;var D=p.data.EnglishType;"ProjectSpace"!=D&&"ProjectConcept"!=D&&"Experiment"!=D||(m.isDisconnect=!0),i[c]=m}var h=0;for(o=t.length;h<o;h++){var m,T=t[h].Id,f=(u=(m=i[T]).lastParentId,n.getModelById(u));if(f){var v=f.parentNode.get("Type"),g="DELETE";if(m.isDisconnect&&(g="DISCONNECT"),null!=v){var I=this.get6WTaskDataSkeleton();I.id=u,I.updateAction="NONE";var y=this.get6WTaskDataSkeleton();y.id=T,y.updateAction=g,I.children.push(y),r.push(I)}else{var S=this.get6WTaskDataSkeleton();S.id=T,S.updateAction=g,r.push(S)}}a.push(T)}return e.transport.sync.params.deletedTaskArray=d,r},formatAssignment6WData:function(e,t,a){var n=[],r=e.taskStore.store.assignmentStore;if(t.updated)for(var s=t.updated,d=0,i=s.length;d<i;d++){var o=(u=s[d]).Id,l=u.Units;(h={}).relId=o,h.relelements={allocation:""+l},h.updateAction="MODIFY";var p=r.getModelById(o).get("TaskId");(m={}).id=p,m.relateddata={assignees:[]},m.relateddata.assignees.push(h),m.updateAction="MODIFY",n.push(m)}if(t.removed){var c=t.removed;for(d=0,i=c.length;d<i;d++){e.transport.sync.params;var u,D=(u=c[d]).TaskId;if(!a.includes(D)){var h,m;o=u.Id,l=u.Units;(h={}).relId=o,h.updateAction="DELETE",(m={}).id=D,m.relateddata={assignees:[]},m.relateddata.assignees.push(h),m.updateAction="NONE",n.push(m)}}}return n},formatAddedTask6WData:function(e,t){this.formatTaskDataForSync(e,t,"added");for(var a=e.taskStore.store,n=[],s=e.transport.sync.params.extraParam,d=0,i=t.length;d<i;d++){var o=t[d];o.Duration=""+o.Duration;var l=o.PhantomId;""==o.Name&&delete o.Name,r.TaskPhantomId=l;var p=s[l],c=p.addTaskAbove,u=p.type,D="",h="";h=c?p.selectedTaskId:o.parentId;var m=(v=a.getModelById(h)).parentNode.get("Type");if(c)if(D=h=p.selectedTaskId,null!=m){var T=this.get6WTaskDataSkeleton(),f=v.parentNode.get("Id");T.id=f,T.updateAction="MODIFY",(g=this.get6WTaskDataSkeleton()).updateAction="CREATE",g.id=l,g.type=u,this.convertTo6WKeyValues(o),g.dataelements=o,g.relelements={nextTaskId:D},T.children.push(g),n.push(T)}else{(g=this.get6WTaskDataSkeleton()).updateAction="CREATE",g.id=l,g.type=u,this.convertTo6WKeyValues(o),g.dataelements=o,g.relelements={nextTaskId:D},n.push(g)}else{var v,g,I="",y=(v=a.getModelById(h)).childNodes.length;if(y>i&&(I=v.childNodes[y-(i+1)].id),null!=m)(T=this.get6WTaskDataSkeleton()).id=h,T.updateAction="MODIFY",(g=this.get6WTaskDataSkeleton()).updateAction="CREATE",g.id=l,g.type=u,this.convertTo6WKeyValues(o),g.dataelements=o,g.relelements={previousTaskId:I},T.children.push(g),n.push(T);else(g=this.get6WTaskDataSkeleton()).updateAction="CREATE",g.id=l,g.type=u,this.convertTo6WKeyValues(o),g.dataelements=o,g.relelements={previousTaskId:I},n.push(g)}}return n},formatUpdateTask6WData:function(e,t){1==e.transport.sync.params.DragDrop&&t.sort(function(e,t){return e.index<t.index?-1:e.index>t.index?1:0}),this.formatTaskDataForSync(e,t,"updated");for(var a=[],n=e.taskStore.store,r=0,s=t.length;r<s;r++){var d=this.get6WTaskDataSkeleton(),i=t[r];if(i.Duration&&(i.Duration=""+i.Duration),null!=i.PercentDone&&(i.PercentDone=""+i.PercentDone),d.id=i.Id,e.transport.sync.params.RightIndent&&i.parentId){var o=n.getModelById(i.Id);(u=this.get6WTaskDataSkeleton()).id=o.modified.parentId,u.updateAction="NONE",(D=this.get6WTaskDataSkeleton()).id=i.Id,D.updateAction="DISCONNECT",D.dataelements.operation="IndentationAndDragDrop",u.children.push(D),a.push(u);var l=n.getModelById(i.parentId);"Project Space"==l.get("Type")&&(i.parentId=l.previousSibling.id);o.childNodes.length;(c=this.get6WTaskDataSkeleton()).id=i.parentId,c.updateAction="MODIFY",(h=this.get6WTaskDataSkeleton()).updateAction="CONNECT",h.id=i.Id,o.data.children=[],o.data.ExternalDependencies=[],h.dataelements=o.data,h.dataelements.operation="IndentationAndDragDrop",c.children.push(h),a.push(c)}else if(e.transport.sync.params.LeftIndent&&i.parentId){o=n.getModelById(i.Id);(u=this.get6WTaskDataSkeleton()).id=o.modified.parentId,u.updateAction="NONE",(D=this.get6WTaskDataSkeleton()).id=i.Id,D.updateAction="DISCONNECT",D.dataelements.operation="IndentationAndDragDrop",u.children.push(D),a.push(u),(c=this.get6WTaskDataSkeleton()).id=i.parentId,c.updateAction="MODIFY",(h=this.get6WTaskDataSkeleton()).updateAction="CONNECT",h.id=i.Id,o.data.children=[],o.data.ExternalDependencies=[],h.dataelements=o.data,h.dataelements.operation="IndentationAndDragDrop",i.parentId&&null!=o.nextSibling?h.relelements={nextTaskId:o.nextSibling.id}:null!=o.previousSibling?h.relelements={previousTaskId:o.previousSibling.id}:null!=o.nextSibling?h.relelements={nextTaskId:o.nextSibling.id}:h.relelements={previousTaskId:o.parentNode.id},c.children.push(h),a.push(c)}else if(e.transport.sync.params.DragDrop){var p="",c=(o=n.getModelById(i.Id),this.get6WTaskDataSkeleton());if(1==i.leaf&&1==i.Duration&&(d.updateAction="MODIFY",this.convertTo6WKeyValues(i),d.dataelements=i,a.push(d)),"Active"==i.State)d.updateAction="MODIFY",this.convertTo6WKeyValues(i),d.dataelements=i,a.push(d);else{if(i.parentId){var u,D;o=n.getModelById(i.Id);(u=this.get6WTaskDataSkeleton()).id=o.modified.parentId,u.updateAction="NONE",(D=this.get6WTaskDataSkeleton()).id=i.Id,D.updateAction="DISCONNECT",D.dataelements.operation="IndentationAndDragDrop",u.children.push(D),a.push(u),p="True",c.id=i.parentId}else c.id=o.parentNode.id;if("root"!=c.id){var h;c.updateAction="MODIFY",(h=this.get6WTaskDataSkeleton()).updateAction="CONNECT",h.id=i.Id,o.data.children=[],o.data.ExternalDependencies=[],h.dataelements=o.data,"True"==p&&(h.dataelements.operation="IndentationAndDragDrop"),i.parentId&&null!=o.nextSibling?h.relelements={nextTaskId:o.nextSibling.id}:null!=o.previousSibling?h.relelements={previousTaskId:o.previousSibling.id}:null!=o.nextSibling?h.relelements={nextTaskId:o.nextSibling.id}:h.relelements={previousTaskId:o.parentNode.id},c.children.push(h),a.push(c)}else{o=n.getModelById(i.Id);d.updateAction="MODIFY",this.convertTo6WKeyValues(i),d.dataelements=i,a.push(d)}}}else d.updateAction="MODIFY",this.convertTo6WKeyValues(i),d.dataelements=i,a.push(d)}return a},appendPredecessor6WData:function(e,t,a,r){e.transport.sync.params;if(t.updated){for(var s=t.updated,d=e.taskStore.store.dependencyStore,i={},o=0,l=s.length;o<l;o++){var p=(v=s[o]).isExtDep?v:d.getModelById(v.Id).data,c=p.To;null!=v.Lag?v.LagTime=""+v.Lag:v.LagTime=""+p.Lag,null!=v.LagUnit?v.LagTime=v.LagTime+" "+v.LagUnit:v.LagTime=v.LagTime+" "+p.LagUnit;var u=p.From;if(!r.includes(c)&&!r.includes(u)){"0"==v.Type?v.Type="SS":"1"==v.Type?v.Type="SF":"2"==v.Type?v.Type="FS":"3"==v.Type&&(v.Type="FF");var D="MODIFY";(g=this.get6WDependencyDataSkeleton(D)).id=p.From,this.convertTo6WKeyValues(v),g.relelements=v;i.hasOwnProperty(c)?i[c].push(g):i[c]=[g]}}for(o=0,l=a.length;o<l;o++){i[y=(I=a[o]).id]&&i[y].length>0&&("DELETE"!=I.updateAction&&(I.relateddata.predecessors=I.relateddata.predecessors.concat(i[y])),delete i[y])}}if(t.added){var h=t.added;for(d=e.taskStore.store.dependencyStore,i={},o=0,l=h.length;o<l;o++){c=(v=h[o]).To,u=v.From;if(null!=v.Lag&&(v.LagTime=""+v.Lag),null!=v.LagUnit?v.LagTime=v.Lag+" "+v.LagUnit:v.LagTime=v.Lag+" "+p.LagUnit,!r.includes(c)&&!r.includes(u)){var m=v.$PhantomId;n[k=c+"-"+u]=m,"0"==v.Type?v.Type="SS":"1"==v.Type?v.Type="SF":"2"==v.Type?v.Type="FS":"3"==v.Type&&(v.Type="FF");D="CREATE";(g=this.get6WDependencyDataSkeleton(D)).id=u,this.convertTo6WKeyValues(v),g.relelements=v;i.hasOwnProperty(c)?i[c].push(g):i[c]=[g]}}for(o=0,l=a.length;o<l;o++){i[y=(I=a[o]).id]&&i[y].length>0&&("DELETE"!=I.updateAction&&(I.relateddata.predecessors=I.relateddata.predecessors.concat(i[y])),delete i[y])}}if(t.removed){var T=t.removed,f=(d=e.taskStore.store.dependencyStore,[]);for(i={},o=0,l=T.length;o<l;o++){var v;(v=T[o]).isExtDep||f.push({Id:v.Id});c=v.To,u=v.From;if(!r.includes(c)&&!r.includes(u)){var g;D="DELETE";(g=this.get6WDependencyDataSkeleton(D)).relId=v.Id;i.hasOwnProperty(c)?i[c].push(g):i[c]=[g]}}for(o=0,l=a.length;o<l;o++){var I,y;i[y=(I=a[o]).id]&&i[y].length>0&&("DELETE"!=I.updateAction&&(I.relateddata.predecessors=I.relateddata.predecessors.concat(i[y])),delete i[y])}e.transport.sync.params.removedDepArray=f}var S=[];for(var k in i)if(i.hasOwnProperty(k)){var E=i[k],A=this.get6WTaskDataSkeleton();A.id=k,A.updateAction="MODIFY",A.relateddata.predecessors=A.relateddata.predecessors.concat(E),S=S.concat(A)}return S},format6WData:function(e,t){n={},r={},s={};var a=[],d=e.taskStore.store.getRoot().childNodes[0].data.Id,i=[];if(t.tasks){var o=t.tasks;if(o.updated){var l=o.updated;i=i.concat(this.formatUpdateTask6WData(e,l))}if(o.added){var p=o.added;i=i.concat(this.formatAddedTask6WData(e,p))}if(o.removed){var c=o.removed;i=i.concat(this.formatDeletedTask6WData(e,c,a))}if(o.updated)for(var u=0;u<o.updated.length;u++)if(o.updated[u].ExternalRawDependencies){var D=o.updated[u].ExternalRawDependencies;if(t.dependencies?(t.dependencies.updated||(t.dependencies.updated=[]),t.dependencies.added||(t.dependencies.added=[]),t.dependencies.removed||(t.dependencies.removed=[])):(t.dependencies={},t.dependencies.added=[],t.dependencies.updated=[],t.dependencies.removed=[]),D.updated){var h=t.dependencies.updated;t.dependencies.updated=h.concat(D.updated)}if(D.added){var m=t.dependencies.added;t.dependencies.added=m.concat(D.added)}if(D.removed){var T=t.dependencies.removed;t.dependencies.removed=T.concat(D.removed)}delete o.updated[u].ExternalRawDependencies,delete o.updated[u].ExternalDependencies}}if(t.dependencies&&(i=i.concat(this.appendPredecessor6WData(e,t.dependencies,i,a))),t.assignments){var f=t.assignments;i=i.concat(this.formatAssignment6WData(e,f,a))}var v={};d=e.taskStore.store.getRoot().childNodes[0].data.Id;v.id=d,v.updateAction="MODIFY",v.relateddata={tasks:i};var g=[];return g.push(v),g},formatTaskDataForSync:function(t,a,n){if("updated"==n)for(var r=a.length-1;r>=0;r--){var s=a[r];if(null==t.transport.sync.params.DragDrop&&delete s.index,s.parentId&&t.getTaskStore().getModelById(s.Id).data.State==App.Nls.Active&&t.getTaskStore().getModelById(s.parentId).data.State!=App.Nls.Active&&a.push({Id:s.parentId,State:"Active"}),s.StartDate||s.EndDate||s.Duration){var d=s.Id,i=t.taskStore.store.getModelById(d);if(0==App.Infra.Load.Level||i||(console.log("Updated:"+a[r]),delete a[r]),s.ConstraintDate&&!s.ConstraintType&&(s.ConstraintType=i.get("ConstraintType")),1==s.leaf&&0!=i.modified.Duration&&(delete s.StartDate,delete s.EndDate,delete s.Duration),i)if(0==i.get("leaf")&&(delete s.StartDate,delete s.EndDate,delete s.Duration),t.transport.sync.params.RightIndent||t.transport.sync.params.LeftIndent||t.transport.sync.params.DragDrop||0!=i.get("leaf")){if(s.ConstraintType||s.ConstraintDate){var o=s.ConstraintType;"startnoearlierthan"==o||"startnolaterthan"==o?s.EndDate&&delete s.EndDate:"finishnoearlierthan"==o&&s.StartDate&&delete s.StartDate,s.StartDate&&(s.StartDate=this.getFormattedDate(new Date(s.StartDate))),s.EndDate&&(s.EndDate=this.getFormattedDate(new Date(s.EndDate)))}else delete s.StartDate,delete s.EndDate;delete s.ConstraintType,delete s.ConstraintDate,s.TaskProjectId=i.get("TaskProjectId")}else(s.ConstraintType||s.ConstraintDate||null==s.ConstraintDate&&""==s.ConstraintType)&&(delete s.ConstraintType,delete s.ConstraintDate)}else(s.ConstraintType||s.ConstraintDate||null==s.ConstraintDate&&""==s.ConstraintType)&&(delete s.ConstraintType,delete s.ConstraintDate)}if("added"==n){var l=t.transport.sync.params.extraParam;for(r=0;r<a.length;r++){var p=l[(s=a[r]).PhantomId];if(s.addTaskAbove=p.addTaskAbove,s.type=p.type,1==s.addTaskAbove&&(s.selectedTaskId=p.selectedTaskId),s.StartDate&&(s.StartDate=this.getFormattedDate(new Date(s.StartDate))),s.EndDate&&(s.EndDate=this.getFormattedDate(new Date(s.EndDate))),s.ConstraintDate&&(s.ConstraintDate=this.getFormattedDate(new Date(s.ConstraintDate))),s.ConstraintType){var c=e.constraintType;s.ConstraintType=c[s.ConstraintType]}}}},getCriticalTasksArray:function(e,t){for(var a=new Array,n=e.length,r=0;r<n;r++){var s=e[r],d=s.id;if("TRUE"==s.dataelements.isOverallCritical.toUpperCase()){var i=t.getModelById(d);i&&a.push(i)}var o=s.children;if(o&&o.length>0){var l=this.getCriticalTasksArray(o,t);a=a.concat(l)}}return a},getGanttTableColumnArray:function(e){var t=Ext.ComponentQuery.query("#dpmprojectgantt")[0],a=[];if(t)for(var n=t.columns,r=0;r<n.length;r++){var s=n[r];if((!s||1!=s.hidden||e)&&(a.push(s),n[r].columns))for(var d=n[i].columns,i=0,o=d.length;i<o;i++){var l=d[i];a.push(l)}}return a},stdTimezoneOffset:function(e){var t=new Date(e.getFullYear(),0,1),a=new Date(e.getFullYear(),6,1);return Math.max(t.getTimezoneOffset(),a.getTimezoneOffset())},setProjectModel:function(e){e.TaskType="DS.ENOGantt.Data.ProjectModel",e.AllowDependencies=!0}}});