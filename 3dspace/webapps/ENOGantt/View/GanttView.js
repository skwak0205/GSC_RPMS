try{define("DS/ENOGantt/View/GanttView",["UWA/Drivers/Alone","UWA/Core","UWA/Class/View","DS/UIKIT/Alert","DS/ENOGantt/Ven/Ext","DS/ENOGantt/Ven/Bryntum","DS/E6WCommonUI/Views/DetailsDisplayView","DS/E6WCommonUI/Views/FoundationBaseView","DS/Foundation2/Models/ReferenceModel","DS/Foundation2/FoundationV2Data","DS/ENOGantt/Widget/PreferenceUtils","DS/ENOGantt/Infra","DS/ENOGantt/Data/CrudManager","DS/ENOGantt/View/Toolbar","DS/ENOGantt/View/ResourceUtilizationPanel","DS/ENOGantt/View/TaskCreationPanel","DS/ENOGantt/View/GanttRefinement","DS/ENOGantt/GanttUtil","DS/ENOGantt/Custom/DPMGanttAll","DS/E6WCommonUI/UIHelper","DS/ENOGantt/URLStore","DS/ENOGantt/Nls/Eno/"+window.languageGlobalVar,"css!DS/Sencha/classic/theme-neptune/resources/theme-neptune-all","css!DS/Bryntum/resources/css/sch-gantt-triton-all","css!ENOGantt/GanttWidget.css","css!ENOGantt/GanttGradientPattern.css","css!ENOGantt/Custom/GanttCustomGradientPattern.css"],function(e,t,a,n,r,i,o,s,l,d,c,p,g,u,h,m,f,b,y,v,P,C){"use strict";var w="Project Space,Project Concept,Project Baseline",S=l.extend({get:function(e){if("canEdit"===e)return!0,!0;this._parent.apply(this,arguments)},dataForRendering:function(){return{canEdit:!0}},add:function(e,t){this._fireRelationshipChangeEvents(e,t,!0)}});return s.extend({_uwaClassName:"GanttView",ganttViewAppsettings:void 0,className:"gantt-view",id:function(){return"ganttView"},domEvents:{"dragover ":"handleDragOver","drop ":"handleDrop","drop .drop-target":"handleDrop","dragend .drop-target":"handleDragEnd"},save:function(){this.crudManager.sync()},getViewHeight:function(){return window.isIFWE?this.container.clientHeight:r.getBody().getHeight()},loadGanttView:function(e){let t=UWA.clone(e||{},!1),a=t.contextModel,n=a.id,r=t.collabspace,i=t.AppSettings;this.ganttViewAppsettings=i,this.parentApp=e.parentView,n?(App.ContextModel=a,this.listenTo(a.model,"onSaveModelComplete",this.updateGanttChart),this._onProjectSelected("",n,r,i)):this.hideGanttPanels()},updateGanttChart:function(e,t){let a=r.ComponentQuery.query("#dpmprojectgantt")[0],n=a.taskStore.getModelById(e.id),i=!1;if(Object.keys(t).length>3)i=!0;else for(var o in t)if("description"==o)n.set("Description",t[o]),a.taskStore.commitChanges();else if("title"==o){n.setName(t[o]),a.taskStore.commitChanges();let r=widget.getTitle(),i=r.lastIndexOf(e._previousAttributes.name),s=r.substring(0,i)+t[o];widget.setTitle(s)}else if("currency"!=o){i=!0;break}i&&(App.Infra.loadProjectSelectable||(App.Infra.loadProjectSelectable=!0),b.getStoreTaskExpandStatus(a.getTaskStore()),a.crudManager.load()),this.parentApp.homeView.dispatchEvent("updateCommonFacet")},getSavedProjectPhysicalId:function(){return c.get("savedPhysicalId")},removeProjectPhysicalId:function(){c.set("savedPhysicalId",!1)},setup:function(e){if(this.ganttPlugins=e.ganttPlugins,this.mainPanel=r.create("Ext.panel.Panel",{width:"auto",id:"mainpanel",xtype:"xmainpanel",autoHeight:!0,height:this.getViewHeight(),layout:"border",renderTo:window.isIFWE?this.container:r.getBody()}),window.isIFWE){this.alerter=new n({autoHide:!0,closable:!0}),this.alerter.inject(this.container,"top"),widget.alerter=this.alerter}},prerender:function(){},getGanttPlugins:function(){var e=new this.ganttPlugins;return e&&e.getPlugins()},renderProjectGantt:function(){var e=this;new p({loadWidget:function(t){e.searchPanel&&(e.searchPanel.setLoading(!1),e.searchPanel.setHidden(!0));var a=new g;if(e.crudManager=a.crudManager,r.ComponentQuery.query("#dpmprojectgantt")[0])e.panel.show();else{new y;var n=!1,o=b.getDateFormat();App.Infra.ViewId!=App.Infra.Views.VIEW_TEMPLATE_WBS&&(n=r.create("DS.ENOGantt.DPMGanttAll.TooltipTamplate",null,o));var s={ToolbarRequired:App.Infra.ToolbarRequired};e.undoManager=new i.data.undoredo.Manager({transactionBoundary:"timeout",stores:[e.crudManager.getTaskStore(),e.crudManager.getDependencyStore()],listeners:{undoqueuechange:function(e,t){var a=r.ComponentQuery.query("#dpmprojectgantt")[0].undoManager.getRedoQueue().length,n=r.getCmp("tBarActionRedo");0===a?null!=n&&(n.isDisabled()||n.disable()):null!=n&&n.isDisabled()&&n.enable()}}}),e.panel=r.create("Gnt.panel.Gantt",{xtype:"dpmprojectgantt",id:"dpmprojectgantt",rowHeight:32,region:"center",rightLabelField:{renderer:function(e,t){return b.getGanttLabel(t,!0)}},leftLabelField:{renderer:function(e,t){return b.getGanttLabel(t,!1)}},undoManager:e.undoManager,controller:"GanttViewController",columns:App.Infra.Columns,crudManager:e.crudManager,highlightWeekends:!0,tooltipTpl:n,showTodayLine:!0,showProjectLines:!1,loadMask:!0,zoomKeepsOriginalTimespan:!0,selModel:new r.selection.TreeModel({ignoreRightMouseSelection:!1,mode:"MULTI"}),autoFitOnLoad:!0,columnLines:!0,enableBaseline:!0,baselineVisible:App.Infra.BaselineRequired,enableProgressBarResize:!0,showRollupTasks:!1,allowParentTaskMove:!0,enableTaskReordering:!0,toggleParentTasksOnClick:!1,tbar:e.getTbar(s),bbar:e.getBbar(s),plugins:e.getGanttPlugins(),taskBodyTemplate:'<div class="sch-gantt-progress-bar" style="width:{progressBarWidth}px;{progressBarStyle}" unselectable="on"><span class="sch-gantt-progress-bar-label" style="display: inline-block;margin-top: 3px;padding: 0.5pt 2pt 0 0;border-radius: 2px;background-color: inherit;">{[Gnt.column.PercentDone.prototype.defaultRenderer(values.percentDone)]}%</span></div>',parentTaskBodyTemplate:'<div class="sch-gantt-progress-bar" style="width:{progressBarWidth}px;{progressBarStyle}; text-align: right" unselectable="on"><span class="sch-gantt-progress-bar-label" style="display: inline-block;margin-top: 1px;padding: 0.5pt 2pt 0 0;border-radius: 2px;background-color: inherit; font-size: 0.8em;">{[Gnt.column.PercentDone.prototype.defaultRenderer(values.percentDone)]}%</span></div>',eventRenderer:function(e,t){var a,n,i,o;if(void 0!==e||void 0!==t){if(e.get("Color")&&""!=e.get("Color"))if(a=r.String.format("background-color: #{0}!important;border-color:#{0}!important",e.get("Color")),t.segments)for(n=t.segments,i=0;i<n.length;i++)n[i].style=a;else o={style:a}}else o={};if(e.get("Pattern")&&""!=e.get("Pattern")){var s=e.get("Pattern"),l=s;"Gate"!=e.get("Type")&&"Milestone"!=e.get("Type")||(l=s+"-gate"),0==e.get("leaf")&&(l=s+"-summary"),o&&o.style?(o.cls=l,o.ctcls=l):o={cls:l,ctcls:l}}if(e.get("Color")&&""!=e.get("Color")){var d=function(e,t){e.length<6&&(e=e[0]+e[0]+e[1]+e[1]+e[2]+e[2]);t=t||0;var a,n,r="#";for(n=0;n<3;n++)a=parseInt(e.substr(2*n,2),16),a=Math.round(Math.min(Math.max(0,a+a*t),255)).toString(16),r+=("00"+a).substr(a.length);return r}(e.get("Color"),.5);o.progressBarStyle="background-color:"+d+"!important;border-color:"+d}return void 0!==e&&("TRUE"!=e.get("isTypeMilestone")&&"TRUE"!=e.get("isTypeGate")||e.get("State")!=App.Nls.Complete||(o={style:a=r.String.format("background-color: #969696!important;border-color:#969696!important")})),o},lockedGridConfig:{width:"20%"},listeners:{taskclick:e.getTask}}),e.undoManager.start(),(enoviaServer.viewId==App.Infra.Views.VIEW_STATUS_REPORT||enoviaServer.viewId==App.Infra.Views.VIEW_BASELINE_WBS||enoviaServer.viewId==App.Infra.Views.VIEW_BASELINE_VERSUS_CURRENT_BASELINE||enoviaServer.viewId==App.Infra.Views.VIEW_BASELINE_VERSUS_CURRENT_BASELINE2||enoviaServer.viewId==App.Infra.Views.VIEW_TEMPLATE_WBS||App.Infra.routeId)&&e.panel.setReadOnly(App.Infra.ReadOnly),e.refinement=new f({taskStore:e.crudManager.getTaskStore()}),e.refinement.render(),e.resourceUtilizationPanel=new h,e.ganttTaskCreationPanel=new m;var l={region:"center",layout:"border",items:[e.panel,{xtype:"dpmresourceutilizationpanel",id:"dpmresourceutilizationpanel",region:"south",height:"50%",partnerTimelinePanel:e.panel,hidden:!0}]},p=r.create("Ext.data.Store",{fields:["abbr","name"],data:[{abbr:"Task",name:App.Nls["emxProgramCentral.Type.Task"]},{abbr:"Gate",name:App.Nls["emxProgramCentral.Type.Gate"]},{abbr:"Phase",name:App.Nls["emxProgramCentral.Type.Phase"]},{abbr:"Milestone",name:App.Nls["emxProgramCentral.Type.Milestone"]}]}),u=r.create("Ext.data.Store",{fields:["abbr","name"],data:function(){var e=new Array,t=App.Infra.Columns,a=t.length;for(idx=0;idx<a;idx++){var n=t[idx],r=n.header,i=n.name,o=n.hidden;n.xtype;if(n.columns)for(var s=0,l=n.columns.length;s<l;s++){var d=n.columns[s];o=d.hidden,d.groupedHeader||n.text!=App.Nls.viewStore[0].name?d.groupedHeader||(d.groupedHeader=d.header):d.groupedHeader=n.text+" "+d.header,o||e.push({abbr:d.name,name:d.groupedHeader})}else o||"Dependency"==i||"Status"==i||e.push({abbr:i,name:r})}return e}()}),v=r.create("Ext.form.Panel",{renderTo:document.body,title:App.Nls["emxProgramCentral.GanttConfig.ConfigureBarLabels"],region:"east",id:"ganttConfigPanel",scrollable:!0,width:310,hidden:!0,bodyPadding:10,defaultType:"textfield",defaults:{anchor:"100%",labelAlign:"top",font:"15px/18px Arial,Helvetica,sans-serif"},cls:"x-panel-header-default",layout:"anchor",items:[{xtype:"tagfield",fieldLabel:App.Nls["emxProgramCentral.GanttConfig.SelectType"],store:p,queryMode:"local",maxLength:4,displayField:"name",valueField:"abbr",name:"selecttype",id:"selecttype",filterPickList:!0},{xtype:"fieldset",title:App.Nls["emxProgramCentral.GanttConfig.SelectLabels"],defaultType:"textfield",defaults:{anchor:"100%"},items:[{xtype:"tagfield",fieldLabel:App.Nls["emxProgramCentral.GanttConfig.LeftLabel"],store:u,queryMode:"local",maxLength:2,displayField:"name",valueField:"abbr",name:"leftlb",id:"leftlb",filterPickList:!0},{xtype:"tagfield",fieldLabel:App.Nls["emxProgramCentral.GanttConfig.RightLabel"],store:u,queryMode:"local",maxLength:2,displayField:"name",valueField:"abbr",name:"rightlb",id:"rightlb",filterPickList:!0}]},{boxLabel:App.Nls["emxProgramCentral.GanttConfig.SetDefault"],xtype:"checkboxfield",name:"setDefault",value:"setDefault",checked:!0}],buttons:[{text:"OK",style:"border-color:#368EC4;background-color:#368EC4;color:#FFFFFF !important;font-size:14px",cls:"apply-button-text",handler:function(){var e=this.up("form"),t=e.getValues(),a=r.ComponentQuery.query("#dpmprojectgantt")[0];if(a.setLoading(!1),null==t.setDefault&&""==t.selecttype&&""==t.rightlb&&""==t.leftlb||null==t.setDefault&&""==t.selecttype)r.Msg.alert(App.Nls["emxProgramCentral.GanttConfig.FormErrorMsg"]);else if(e.isValid()){var n={},i={};if(null!=t.setDefault)i.Taskrb="Name",i.Gaterb="Name",i.Milestonerb="Name",i.Phaserb="Name",i.Tasklb="",i.Gatelb="",i.Milestonelb="",i.Phaselb="";else{var o=t.selecttype,s=t.rightlb;s=s.length>1?s[0].concat("#").concat(s[1]):s.toString();var l=t.leftlb;l=l.length>1?l[0].concat("#").concat(l[1]):l.toString(),o.indexOf("Task")>=0&&(i.Tasklb=l,i.Taskrb=s),o.indexOf("Gate")>=0&&(i.Gatelb=l,i.Gaterb=s),o.indexOf("Milestone")>=0&&(i.Milestonelb=l,i.Milestonerb=s),o.indexOf("Phase")>=0&&(i.Phaselb=l,i.Phaserb=s)}var c={updateAction:"MODIFY",dataelements:{ganttConfig:JSON.stringify(i)}};n.data=[c],n.csrf={name:App.csrf.name,value:App.csrf.value};var p="/resources/v1/modeler/projects/"+enoviaServer.physicalId+"?$indexBasedImages=false&$include=none&$fields=none,ganttConfig";a.setLoading(!1);d.ajaxRequest({data:JSON.stringify(n),url:p,type:"PUT",dataType:"json",callback:function(e){var t=(n=r.ComponentQuery.query("#dpmprojectgantt")[0]).crudManager;App.Infra.loadProjectSelectable||(App.Infra.loadProjectSelectable=!0);var a=n.getTaskStore();""==a.data.items[0].data.ganttConfig?a.data.items[0].data.ganttConfig=e.data[0].dataelements.ganttConfig:a.data.items[0].set("ganttConfig",e.data[0].dataelements.ganttConfig),t.commit(),r.ComponentQuery.query("#ganttConfigPanel")[0].hide();for(var n,i=(n=r.ComponentQuery.query("#dpmprojectgantt")[0]).getPlugins(),o=0,s=i.length;o<s;o++)if(pluginId=i[o].id,"RMBMenu"===pluginId){i[o].enable();break}}})}else alert(App.Nls["emxProgramCentral.GanttConfig.ErrorMsg"])}},{id:"btnCloseOpenForm",text:App.Nls["emxProgramCentral.Gantt.DependencyEditor.Cancel"],handler:function(){r.ComponentQuery.query("#ganttConfigPanel")[0].hide();for(var e=r.ComponentQuery.query("#dpmprojectgantt")[0].getPlugins(),t=0,a=e.length;t<a;t++)if(pluginId=e[t].id,"RMBMenu"===pluginId){e[t].enable();break}}}]});window.gantt=e.ganttPanel,r.tip.QuickTipManager.init(),e.mainPanel.add({xtype:e.refinement.panel,reference:"refinement"}),e.mainPanel.add(l),e.mainPanel.add(v),e.mainPanel.add({xtype:"ganttTaskCreationPanel",id:"ganttTaskCreationPanel"})}window.isODTRunning||null!=enoviaServer.physicalId&&e.panel.crudManager.load(),window.isIFWE&&widget.setTitle(c.get("savedTitle"))}})},configureGanttLabelsData:function(e){var t=this.getGantt();if(t.crudManager.hasChanges()){if(!confirm(App.Nls["emxProgramCentral.Project.DiscardChanges"]))return!1;t.getCrudManager().reject()}var a="/resources/v1/modeler/projects/"+enoviaServer.physicalId+"?$indexBasedImages=false&$include=none,getFloatValues";t.setLoading(!1);d.ajaxRequest({url:a,type:"GET",dataType:"json",callback:function(e){alert(e)}})},changeAutoCompleteDisplaySettings:function(){this._searchBar.getElement("input");var e=this._searchBar.getElement(".chooser"),t=(this._searchBar._childrenViews[0].autoCompleteControl,C["emxProgramCentral.GanttView.SearchForProject"]);this._searchBar._childrenViews[0].autoCompleteControl.setOption("placeholder",t),this._searchBar._childrenViews[0].autoCompleteControl.setOption("position",{my:"left-1.5 top",at:"left bottom",of:e,collision:"fit",within:this.container})},hideGanttPanels:function(){var e=r.ComponentQuery.query("#dpmresourceutilizationpanel")[0];e&&e.hide();var t=r.ComponentQuery.query("#GanttRefinementPanel")[0];t&&t.hide();var a=r.ComponentQuery.query("#dpmprojectgantt")[0];a&&a.hide()},renderProjectSearch:function(){var e=r.ComponentQuery.query("#mainpanel")[0];if(e){this.searchPanel=r.ComponentQuery.query("#searchprojectpanel")[0],this.searchPanel||(this.model=new S,this._searchBar=new o({model:this.model,id:"projectSpaceSearch"}),this._searchBar.setConfig([{readWrite:"true",name:"project",attributeToDisplay:"name",imageAttribute:"image",singleObjectOnly:!0,searchTypes:w,validTypes:w,searchTitle:App.Nls["emxProgramCentral.GanttWidget.SearchTitle"],typeAheadCallback:l.typeAheadCallback,type:"object"}]),this.listenTo(this.model,"onChange:project",this._onProjectSelected),this.listenTo(widget,"onResize",function(){this._searchBar._childrenViews[0].container.setStyle("width",.75*widget.body.clientWidth)}),c.get("savedPhysicalId")?c.addClearProjectPreference():c.removeClearProjectPreference(),this._searchBar.render(),this._searchBar._childrenViews[0].container.setStyle("width",.75*widget.body.clientWidth),this._searchBar._childrenViews[0].container.toggleClassName("fluid-width",!0),this._searchBar._childrenViews[0].container.toggleClassName("visible",!0),this._searchBar._childrenViews[0].container.toggleClassName("ds-detail-display",!1),this.changeAutoCompleteDisplaySettings(),this.searchPanel=r.create("Ext.Panel",{xtype:"panel",id:"searchprojectpanel",width:"100%",region:"east",items:[r.get(this._searchBar.getContent())]}),e.add(this.searchPanel)),this.refreshPlaceHolderText(),this.hideGanttPanels(),this.searchPanel.show();var t=widget.data.collabspace,a=t.substring(t.lastIndexOf(".")+1);window.isIFWE&&widget.setTitle(a)}},refreshPlaceHolderText:function(){var e=this._searchBar.getElement("input[type=text]");e&&e.setAttribute("placeholder",C["emxProgramCentral.GanttView.SearchForProject"])},render:function(e){var t=this;if(window.isIFWE){var a=!0;if(c.get("savedPhysicalId"))if(e){var n="",r="";n=c.get("savedObject")?c.get("savedObject"):c.get("savedPhysicalId");var i=c.get("savedTitle"),o=P.getUpdatedDataURL(n,i);d.ajaxRequest({url:o,callback:function(e){var n=UWA.is(e,"object")?e:JSON.parse(e);n.data[0].dataelements.Error?(a=!1,r=n.data[0].dataelements.Error):n.data[0].dataelements.physicalId&&n.data[0].dataelements.physicalId!==c.get("savedPhysicalId")&&(c.set("savedPhysicalId",n.data[0].dataelements.physicalId),c.get("savedObject")&&c.set("savedObject",!1),c.get("savedObjectID")&&c.set("savedObjectID",!1)),a?(enoviaServer.physicalId=c.get("savedPhysicalId"),t.renderProjectGantt()):(t.alerter.setOption("autoHide",!1),t.alerter.setOption("hideDelay",5e3),t.alerter.add({message:r,className:"error"}),t.alerter.show(),c.set("savedPhysicalId",!1),t.renderProjectSearch())}})}else enoviaServer.physicalId=c.get("savedPhysicalId"),t.renderProjectGantt();else c.removeClearProjectPreference(),this.renderProjectSearch()}else this.renderProjectGantt();return t},resize:function(){this.mainPanel.setWidth(r.getBody().getWidth()),this.mainPanel.setHeight(r.getBody().getHeight())},getTask:function(){var e=arguments[1];d.ajaxRequest({url:"/resources/v2/e6w/service/ObjectInfo/"+e.getId()+"?$fields=objectId",dataType:"json",callback:function(e){}})},getBbar:function(e){if(e.ToolbarRequired){var t=[];return t.push("->"),t.push({id:"bbarObjectCount",xtype:"displayfield",cls:"my-toolbar",label:"Objects",name:"Objects",value:0}),t.push({id:"bbarSelectObjectCount",xtype:"displayfield",cls:"my-toolbar",label:"Selected",hidden:!0,name:"Selected",value:0}),t}return[]},getTbar:function(e){if(e.ToolbarRequired){var t={crudManager:this.crudManager};new u(t);return{xtype:"dpmgantttbar"}}return[]},_onProjectSelected:function(e,t,a,n){var r=this;if(n=n||r.ganttViewAppsettings,a=a||n.get("collabspace"),r.searchPanel&&(r.searchPanel.setLoading({msg:C["emxProgramCentral.Gantt.Loading"]}),r._searchBar.hide()),enoviaServer.physicalId=t,enoviaServer.sRealURL&&(enoviaServer.storageUrl=enoviaServer.sRealURL),window.isIFWE){var i=n.get("user");i&&i.login&&(i=i.login);var o=(new Date).getTimezoneOffset(),s=widget.getUrl(),l=n.get("myAppsUrl");s=s.substring(0,s.indexOf("/webapps"));var p=window.widget.lang;window.enoviaServer={params:"",sRealURL:s,showSpace:"true",objectId:"",widgetId:"",widgetName:"",taggerContextId:"auto",appName:"",tenant:"",space:null,rows:null,preferences:{},storageUrl:l,language:p,timezone:o,_getUrl:function(){return this.storageUrl||this.sRealURL},computeUrl:function(e){return n.get("3DSpace")+e},getParams:function(){var e="";return""!==(e+="&tenant="+enoviaServer.tenant)&&(e=e.substring(1)),enoviaServer.space&&enoviaServer.space.length>0&&(e+="&SecurityContext="+encodeURIComponent(enoviaServer.space)),e},getParamsAsJSON:function(){return{}},user:i},enoviaServer.securityContext=encodeURIComponent(a)}d.ajaxRequest({url:"/resources/v2/e6w/service/ObjectInfo/"+t+"?$fields=objectId",callback:function(e){var t=UWA.is(e,"object")?e:JSON.parse(e);if(t.data[0].id){var n=widget.data.collabspace||a,i=n.substring(n.lastIndexOf(".")+1)+" - "+t.data[0].dataelements.title;c.set("savedPhysicalId",t.data[0].id),c.set("savedTitle",i),r.render(!1)}}})},handleDrop:function(e){e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault(),this.container.removeClassName("bordered");var t=v.getDataTransferJSON(e.dataTransfer);return t&&this.processDropData(t),!1},handleDragEnd:function(){this.container.removeClassName("bordered")},handleDragOver:function(e){
//!this._blockerDiv.isInjected() && this._blockerDiv.inject(this.container, 'top');
return e.preventDefault&&e.preventDefault(),e.dataTransfer.dropEffect="copy",c.get("savedPhysicalId")&&this.container.addClassName("bordered"),!1},processDropData:function(e){var t=e.data.items[0],a=t.displayName;a&&a.length>0&&("Project Space"!==t.objectType&&"Project Baseline"!==t.objectType&&"Project Concept"!==t.objectType&&"Experiment"!==t.objectType?(this.alerter.add({message:NLS["emxProgramCentral.GanttView.NotProjectSpace"],className:"error"}),this.alerter.show()):this.parentApp.homeView.handleContextWithDroppedObj(e.data.items))}})})}catch(e){console.log("==============================================Error:======"+e.Name)}