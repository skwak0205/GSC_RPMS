define("DS/ENOGantt/View/ResourceUtilizationContextMenu",["UWA/Class","DS/ENOGantt/Ven/Ext"],function(e,t){return e.extend({init:function(){t.define("DS.ENOGantt.View.ResourceUtilizationContextMenu",{extend:"Ext.menu.Menu",constructor:function(){var e=t.ComponentQuery.query("#dpmprojectgantt")[0],r=t.ComponentQuery.query("#dpmresourceutilizationpanel")[0],n=r.context,o=n.getId(),a=(n.getName(),r.getSelection()[0]),s=a.get("Id"),i=(a.getName(),a.get("Type")),c=(a.get("isReadOnly"),!0);-1!=s.indexOf("assignment-")&&(c=!1);var g=a.data.TaskId;c&&(g=o);var m=e.taskStore.getModelById(g),d=!1;if(m&&(d=m.data.changeSOVAccess),c)var l=e.taskStore.resourceStore.getModelById(s.replace("resource-","")).data.currentState;else l=e.taskStore.assignmentStore.getModelById(s.replace("assignment-","")).getResource().data.currentState;_unassign=function(){if(c){var a=e.taskStore.resourceStore.getModelById(s.replace("resource-","")),i=e.getAssignmentStore().getAssignmentForTaskAndResource(n,a),g=i.getTaskId();e.crudManager.transport.sync.params.contextTaskId=g,t.MessageBox.confirm(App.Nls["emxProgramCentral.Gantt.ResourceUtilization.RemoveResource.Alert.Header"],App.Nls["emxProgramCentral.Gantt.ResourceUtilization.RemoveResource.Alert.Body"],function(t){"yes"===t&&(e.assignmentStore.remove(i),e.crudManager.sync(),e.taskStore.resourceStore.remove(a),e.crudManager.commit())})}else t.MessageBox.confirm(App.Nls["emxProgramCentral.Gantt.ResourceUtilization.RemoveAssignment.Alert.Header"],App.Nls["emxProgramCentral.Gantt.ResourceUtilization.RemoveAssignment.Alert.Body"],function(t){if("yes"===t){var n=e.taskStore.assignmentStore.getModelById(s.replace("assignment-","")),a=n.getResource(),i=n.getTaskId();if(e.crudManager.transport.sync.params={contextTaskId:i},i==o){var c=a.getId();r.resourceStore.getModelById("resource-"+c);e.assignmentStore.remove(n),e.crudManager.sync(),e.taskStore.resourceStore.remove(a),e.crudManager.commit()}else e.assignmentStore.remove(n),e.crudManager.sync()}})};var u=enoviaServer.computeUrl("/common/images/");this.items=[{text:App.Nls["emxProgramCentral.Common.OpenInNewTab"],icon:u+"iconActionOpenShortcuts.png",iconCls:"tBarIcon",handler:function(){var e="",t="../../common/emxNavigator.jsp?physicalId="+(e=c?a.getId().replace("resource-",""):a.get("TaskId"));window.isIFWE&&(t=enoviaServer.computeUrl("/common/")+"emxNavigator.jsp?physicalId="+e),window.open(t)}},{text:App.Nls["emxProgramCentral.Common.Remove"],icon:u+"iconActionDelete.png",iconCls:"tBarIcon",hidden:"External"==i||"TRUE"!=d||"Active"!=l,handler:function(){var n=e.taskStore.assignmentStore.getModifiedRecords(),o=n&&n.length>0,a=e.taskStore.getModifiedRecords(),s=a&&a.length>0;o||s?t.MessageBox.confirm(App.Nls["emxProgramCentral.Gantt.ResourceUtilization.RemoveAssignment.Alert.Header"],App.Nls["emxProgramCentral.Project.DiscardChanges"],function(t){"yes"===t&&(r.getStore().rejectChanges(),e.getCrudManager().reject(),_unassign())}):_unassign()}}],this.callParent(arguments)}})}})});