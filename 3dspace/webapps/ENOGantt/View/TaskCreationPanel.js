define("DS/ENOGantt/View/TaskCreationPanel",["UWA/Class","DS/ENOGantt/Ven/Ext","DS/ENOGantt/Ven/Bryntum","DS/ENOGantt/GanttUtil","DS/ENOGantt/GanttConstants"],function(e,a,t,n,r){return e.extend({init:function(){var e=a.create("Ext.data.Store",{fields:["abbr","name"],data:[{abbr:"Optional",name:App.Nls["emxProgramCentral.Range.Task_Requirement.Optional"]},{abbr:"Mandatory",name:App.Nls["emxProgramCentral.Range.Task_Requirement.Mandatory"]}]}),t=a.create("Ext.data.Store",{fields:["abbr","name"],data:[{abbr:"Yes",name:App.Nls["emxProgramCentral.Range.NeedsReview.Yes"]},{abbr:"No",name:App.Nls["emxProgramCentral.Range.NeedsReview.No"]}]});a.define("DS.ENOGantt.View.TaskCreationPanel",{extend:"Ext.form.Panel",renderTo:document.body,title:App.Nls["emxProgramCentral.Common.AddTask"],region:"east",xtype:"ganttTaskCreationPanel",id:"ganttTaskCreationPanel",width:330,hidden:!0,bodyPadding:10,scrollable:!0,defaultType:"textfield",defaults:{anchor:"100%",labelAlign:"top",font:"15px/18px Arial,Helvetica,sans-serif"},cls:"x-panel-header-default",layout:"anchor",items:[{xtype:"fieldcontainer",id:"requiredFields",fieldLabel:App.Nls["ProgramCentral.GanttTaskCreation.FieldsRequired"],labelCls:"createRequired"},{xtype:"combobox",fieldLabel:App.Nls["emxProgramCentral.Common.Type"],queryMode:"local",displayField:"name",valueField:"abbr",name:"type",id:"type",editable:!1,listeners:{change:function(e,t){var r=a.ComponentQuery.query("#ganttTaskCreationPanel")[0];null==t&&(t="Task");var i=t;"Task"==t?i=App.Nls["emxProgramCentral.Type.Task"]:"Phase"==t?i=App.Nls["emxProgramCentral.Type.Phase"]:"Gate"==t?i=App.Nls["emxProgramCentral.Type.Gate"]:"Milestone"==t&&(i=App.Nls["emxProgramCentral.Type.Milestone"]),r.setTitle(App.Nls["emxProgramCentral.Gantt.Create"]+" : "+i);var l=a.create("Ext.data.Store",{fields:["abbr","name"],data:function(){var e=new Array,a=App.Infra.PoliciesAndTypes[t].split("#")[0],n=a.substring(1,a.length-1).split(","),r=App.Infra.PoliciesAndTypes[t].split("#")[1],i=r.substring(1,r.length-1).split(", "),l=n.length;for(idx=0;idx<l;idx++){var o=n[idx].trim(),s=i[idx].trim();null==s&&(s=o),e.push({abbr:o,name:s})}return e}()});a.getCmp("policy").bindStore(l),n.getGanttItem(r,"policy").setValue(l.data.items[0]);var o=n.getGanttItem(r,"duration");"Gate"==t||"Milestone"==t?(o.setValue(0),o.setReadOnly(!0)):(o.setValue(1),o.setReadOnly(!1))}}},{xtype:"numberfield",fieldLabel:App.Nls["emxProgramCentral.Common.Number"],minValue:1,name:"number",id:"number",value:1,validator:function(e){var a=!0;return this.value<=0||this.value>=100?(a=App.Nls["emxProgramCentral.Gantt.TaskCreationFormNumber"],this.setError(a),a):a},listeners:{change:function(e,t){var r=a.ComponentQuery.query("#ganttTaskCreationPanel")[0],i=n.getGanttItem(r,"namecontainer");t>1?(i.items.items[1].setValue(!0),i.items.items[1].setDisabled(!0),i.items.items[0].setDisabled(!0)):(i.items.items[1].setValue(!1),i.items.items[1].setDisabled(!1),i.items.items[0].setDisabled(!1))}}},{xtype:"fieldcontainer",fieldLabel:App.Nls["emxProgramCentral.Gantt.ResourceUtilization.Header.Name"],id:"namecontainer",name:"Name",labelCls:"createName",layout:{type:"hbox"},items:[{xtype:"textfield",name:"name",id:"name",validator:function(e){var a=!0;if(0==this.nextSibling("[name=autoname]").value&&""==this.value)return a=App.Nls["emxProgramCentral.Gantt.MustHaveName"],this.setError(a),a;if(App.Infra.PoliciesAndTypes)for(var t=App.Infra.PoliciesAndTypes.InvalidChars,n=t.split(" "),r=0;r<n.length;r++){var i=n[r];if(-1!=e.indexOf(i)){a=App.Nls["emxProgramCentral.ProjectImport.InvalidCharacterInTaskName"]+"\n"+t;break}}return a}},{xtype:"checkbox",fieldLabel:App.Nls["emxProgramCentral.Common.AutoName"],labelAlign:"right",name:"autoname",id:"autoname",value:!1,listeners:{change:function(e,t,r,i){var l=a.ComponentQuery.query("#ganttTaskCreationPanel")[0],o=n.getGanttItem(l,"namecontainer");1==t?(o.items.items[0].reset(),o.items.items[0].setDisabled(!0)):o.items.items[0].setDisabled(!1)}}}]},{xtype:"textareafield",fieldLabel:App.Nls["emxProgramCentral.Common.Description"],name:"description",id:"description"},{xtype:"radiogroup",fieldLabel:App.Nls["emxProgramCentral.Button.Insert"],id:"insertradio",columns:1,vertical:!0,items:[{boxLabel:App.Nls["emxProgramCentral.Gantt.Above"],name:"insert",id:"above",inputValue:"above",checked:!0},{boxLabel:App.Nls["emxProgramCentral.Gantt.SubLevel"],name:"insert",id:"sublevel",inputValue:"sublevel"}]},{xtype:"durationfield",fieldLabel:App.Nls["emxProgramCentral.Common.Duration"],minValue:0,name:"duration",durationUnit:"d",id:"duration",value:1,validator:function(e){var a=this.rawValue.split(" "),t=this.up("form").getValues();return App.Infra.PoliciesAndTypes.gateMilestoneTypes.indexOf(t.type)<0&&"0"==a[0]?App.Nls["emxProgramCentral.Common.ValueMustBeAPositiveReal"]:a[1]==App.Nls.durationUnits.day||a[1]==App.Nls.durationUnits.days||a[1]==App.Nls.durationUnits.hour||a[1]==App.Nls.durationUnits.hours||App.Nls["emxProgramCentral.Common.InvalidDuration"].replace(/\\n/g,"\n")}},{xtype:"combobox",fieldLabel:App.Nls["emxProgramCentral.Common.Policy"],queryMode:"local",displayField:"name",valueField:"abbr",name:"policy",id:"policy",editable:!1},{xtype:"combobox",fieldLabel:App.Nls["emxProgramCentral.Common.TaskRequirement"],store:e,queryMode:"local",displayField:"name",valueField:"abbr",name:"taskRequirement",id:"taskRequirement",value:"Optional",editable:!1},{xtype:"constrainttypefield",fieldLabel:App.Nls["emxProgramCentral.WBS.ConstraintType"],name:"constrainttype",id:"constrainttype",editable:!1,value:"assoonaspossible",hidden:App.Infra.TypeOf.ProjectTemplate,validator:function(e){var a=this.nextSibling("[name=constraintdate]");return"assoonaspossible"==this.getValue()||"aslateaspossible"==this.getValue()||""!=a.getValue()&&null!=a.getValue()||App.Nls["emxProgramCentral.Gantt.selectConstraintDate"]}},{xtype:"constraintdatefield",fieldLabel:App.Nls["emxProgramCentral.WBS.ConstraintDate"],name:"constraintdate",id:"constraintdate",format:n.getDateFormat(),hidden:App.Infra.TypeOf.ProjectTemplate},{xtype:"combobox",fieldLabel:App.Nls["emxProgramCentral.Task.NeedsReview"],store:t,queryMode:"local",displayField:"name",valueField:"abbr",name:"needsReview",id:"needsReview",value:"No",editable:!1},{xtype:"radiogroup",fieldLabel:App.Nls["emxProgramCentral.Task.DeliverablesInheritance"],id:"deliverablesInheritance",columns:1,vertical:!0,items:[{boxLabel:App.Nls["emxProgramCentral.Range.NeedsReview.Yes"],name:"deliverablesInheritance",inputValue:"Yes",checked:!0},{boxLabel:App.Nls["emxProgramCentral.Range.NeedsReview.No"],name:"deliverablesInheritance",inputValue:"No"}]}],buttons:[{text:"OK",style:"border-color:#368EC4;background-color:#368EC4;color:#FFFFFF !important;font-size:14px;border-radius: 5px;border-width:1px;border-style:solid;box-shadow: inset 0px 2px 0px rgba(255,255,255,.3), inset 0px 0px 8px rgba(255,255,255,.5);",cls:"apply-button-text",handler:function(){var e=a.ComponentQuery.query("#dpmprojectgantt")[0].lockedGrid.getSelectionModel().selected.items,t=this.up("form"),i=t.getValues(),l=i.type,o=r.actionType.ADD_SUB_TASK;"Phase"===l?o=r.actionType.ADD_PHASE:"Gate"===l?o=r.actionType.ADD_GATE:"Milestone"===l&&(o=r.actionType.ADD_MILESTONE);var s=App.Nls["emxProgramCentral.Common.InvalidDuration"];if(s=s.replace(/\\n/g,"\n"),t.hasInvalidField()){for(var m=[],d=t.items.items,p=0,u=d.length;p<u;p++){if(fieldId=d[p].id,"namecontainer"===fieldId)for(var g=d[p].items.items,b=0,c=g.length;b<c;b++){var x=g[b].getErrors();break}else{if("requiredFields"==d[p].id)continue;x=d[p].getErrors();if("duration"===fieldId&&x.length>0)for(var y=0,f=x.length;y<f;y++)if(x[y].error!=s){x.splice(y,1);break}}x.length>0&&m.push(d[p].fieldLabel)}var C=App.Nls["emxProgramCentral.GanttTaskCreation.InvalidFormErrorMsg"];return alert(C+" : \n"+m),!1}if(n.isValidRMBOperation(e[0],o)&&!t.hasInvalidField()){cpnl.syncOnAddRemoveTask(this,o,i);var v=a.ComponentQuery.query("#ganttTaskCreationPanel")[0];v.hide(),v.reset(),a.getCmp("tBarganttConfiguration").enable()}}},{id:"Apply",text:App.Nls["emxProgramCentral.Gantt.Apply"],handler:function(){var e=a.ComponentQuery.query("#dpmprojectgantt")[0].lockedGrid.getSelectionModel().selected.items,t=this.up("form"),i=t.getValues(),l=i.type,o=r.actionType.ADD_SUB_TASK;"Phase"===l?o=r.actionType.ADD_PHASE:"Gate"===l?o=r.actionType.ADD_GATE:"Milestone"===l&&(o=r.actionType.ADD_MILESTONE);var s=App.Nls["emxProgramCentral.Common.InvalidDuration"];if(s=s.replace(/\\n/g,"\n"),t.hasInvalidField()){for(var m=[],d=t.items.items,p=0,u=d.length;p<u;p++){if(fieldId=d[p].id,"namecontainer"===fieldId)for(var g=d[p].items.items,b=0,c=g.length;b<c;b++){var x=g[b].getErrors();break}else{if("requiredFields"==d[p].id)continue;x=d[p].getErrors();if("duration"===fieldId&&x.length>0)for(var y=0,f=x.length;y<f;y++)if(x[y].error!=s){x.splice(y,1);break}}x.length>0&&m.push(d[p].fieldLabel)}var C=App.Nls["emxProgramCentral.GanttTaskCreation.InvalidFormErrorMsg"];return alert(C+" : \n"+m),!1}n.isValidRMBOperation(e[0],o)&&!t.hasInvalidField()&&cpnl.syncOnAddRemoveTask(this,o,i);a.ComponentQuery.query("#ganttTaskCreationPanel")[0]}},{id:"Close",text:App.Nls["emxProgramCentral.Gantt.DependencyEditor.Cancel"],handler:function(){var e=a.ComponentQuery.query("#ganttTaskCreationPanel")[0];e.hide(),e.reset(),a.getCmp("tBarganttConfiguration").enable()}}]})}})});