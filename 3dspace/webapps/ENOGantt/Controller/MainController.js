var transientWidget="DS/TransientWidget/TransientWidget";define("DS/ENOGantt/Controller/MainController",["DS/ENOGantt/Ven/Ext","DS/ENOGantt/Controller/Finder","DS/ENOGantt/GanttUtil","DS/ENOGantt/GanttConstants","DS/Foundation2/FoundationV2Data","DS/ENOGantt/URLStore",transientWidget],function(e,t,a,r,o,l,s){e.define("DS/ENOGantt/Controller/MainController",{extend:"Ext.app.ViewController",alias:"controller.GanttViewController",control:{"#dpmprojectgantt":{beforetaskresize:"beforetaskresize",beforetaskdrag:"beforetaskdrag",aftertaskresize:"aftertaskresize",taskdrop:"taskdrop",dependencybeforedrag:"dependencybeforedrag",dependencydrop:"dependencydrop",beforedrop:"beforedrop",drop:"drop",selectionchange:"selectionchange",beforeprogressbarresize:"beforeprogressbarresize",afterprogressbarresize:"afterprogressbarresize"},"[reference=ganttTaskCreation]":{click:"showTaskCreationForm"},"[reference=zoomToFit]":{click:"onzoomToFit"},"[reference=undo]":{click:"onUndo"},"[reference=redo]":{click:"onRedo"},"[reference=zoomOut]":{click:"onZoomOut"},"[reference=zoomIn]":{click:"onZoomIn"},"[reference=expandAll]":{click:"onExpandAll"},"#ganttTaskCreation":{click:"showTaskCreationForm"},"#rmbExpandAll":{click:"onExpandAll"},"#expandLevel_1":{click:"onExpandNLevelHandler"},"#expandLevel_2":{click:"onExpandNLevelHandler"},"#expandLevel_3":{click:"onExpandNLevelHandler"},"#expandLevel_4":{click:"onExpandNLevelHandler"},"#expandLevel_5":{click:"onExpandNLevelHandler"},"#expandLevel_all":{click:"onExpandAll"},"[reference=highlightCrit]":{click:"onHighlightCrit"},"[reference=print]":{click:"onPrint"},"[reference=collapseGanttChart]":{click:"onCollapseGanttChart"},"[reference=SaveAll]":{click:"onSave"},"[reference=resetAll]":{click:"onReset"},"[reference=viewDropDown]":{click:"toggleView"},"[reference=showRollUpTask]":{click:"toggleRollUpTaskView"},"[reference=refinement]":{click:"showRefinement"},"[reference=ganttConfiguration]":{click:"showForm"},"[reference=calculateFloatData]":{click:"calculateFloatData"},"[reference=calculateForecastValues]":{click:"calculateForecastValues"},"[reference=promoteSuccessor]":{click:"promoteSuccessor"},"[reference=outdentTask]":{click:"onOutdent"},"[reference=indentTask]":{click:"onIndent"},"#RMB_expandLevel_1":{click:"onExpandNLevelHandler"},"#RMB_expandLevel_2":{click:"onExpandNLevelHandler"},"#RMB_expandLevel_3":{click:"onExpandNLevelHandler"},"#RMB_expandLevel_4":{click:"onExpandNLevelHandler"},"#RMB_expandLevel_5":{click:"onExpandNLevelHandler"},"#RMB_expandLevel_all":{click:"onExpandAll"},"#rmbOpenTaskAction":{click:"openTask"},"#outdentTask":{click:"onOutdent"},"#indentTask":{click:"onIndent"},"#rmbOpenCollabTaskAction":{click:"openTaskinCollabTask"},"[reference=find]":{change:"find"},"[reference=filterByName]":{keyup:"filterByName",specialkey:"filterByName"},"[reference=filter]":{click:"filter"},"[reference=resetFilter]":{click:"resetFilter"},"[reference=hide]":{click:"hide"}},getGantt:function(){return this.getView()},beforetaskdrag:function(e,t,n,r){return"Gnt.model.Project"!=t.get("TaskType")&&(0!=a.doBasicEditChecks(t)&&(t.isStartDateEditable()&&t.isEndDateEditable()))},beforetaskresize:function(e,t,n,r){return 0!=a.doBasicEditChecks(t)&&a.isValidTaskResize(t,n,r)},beforedrop:function(t,a,n,r,o){var i=e.ComponentQuery.query("#dpmprojectgantt")[0].crudManager;if(i.hasChanges()){if(!confirm(App.Nls["emxProgramCentral.Project.DiscardChanges"]))return!1;i.reject()}if(1==App.Infra.BaselineRequired)return!1;if("TRUE"!=a.records[0].data.hasEditAccess)return e.MessageBox.alert(App.Nls["emxProgramCentral.TaskDragdrop.NoAccessToDragDrop"]),!1;var l=a.records[0].get("TaskProjectId"),s=n.get("TaskProjectId"),d=n.parentNode.get("EnglishType");if(null==l){var c=a.records[0].parentNode.get("EnglishType");l="Task"==c||"Phase"==c||"Gate"==c||"Milestone"==c?a.records[0].parentNode.get("TaskProjectId"):a.records[0].get("parentId")}if(null==s&&"ProjectSpace"!=d&&"ProjectConcept"!=d&&"Experiment"!=d){s=n.get("parentId");var p=n.parentNode.get("EnglishType");s="Task"==p||"Phase"==p||"Gate"==p||"Milestone"==p?n.parentNode.get("TaskProjectId"):n.get("parentId")}return a.records.length>1?(e.MessageBox.alert(App.Nls["emxFramework.Common.PleaseSelectOneItemOnly"]),!1):100==a.records[0].get("PercentDone")?(e.MessageBox.alert(App.Nls["emxProgramCentral.TaskDragdrop.TaskInReviewState"]),!1):100==n.parentNode.get("PercentDone")?(e.MessageBox.alert(App.Nls["emxProgramCentral.TaskDragdrop.ParentTaskInReviewCompleteState"]),!1):s==l&&(null!=s||null!=l)||(e.MessageBox.alert(App.Nls["emxProgramCentral.TaskDragdrop.CrossProjectDragdrop"]),!1)},drop:function(t,n,r,o,i){var l=e.ComponentQuery.query("#dpmprojectgantt")[0],s=l.crudManager,d=l.getTaskStore();a.getStoreTaskExpandStatus(d);var c=!1,p=s.getChangeSetPackage();if(p.tasks){var g=p.tasks;if(g.updated)for(var m=g.updated,f=0,u=m.length;f<u;f++){var h=m[f];if(h.parentId){var v=d.getModelById(h.parentId).get("PercentDone");if("FALSE"==d.getModelById(h.parentId).data.hasEditAccess){c=!0,e.MessageBox.alert(App.Nls["emxProgramCentral.TaskDragdrop.NoAccessToDragDrop"]);break}if(100==v){c=!0,e.MessageBox.alert(App.Nls["emxProgramCentral.TaskDragdrop.ParentTaskInReviewCompleteState"]);break}}}}c?s.load():(s.transport.sync.params.DragDrop=!0,l.getCrudManager().sync(),l.getCrudManager().commit())},aftertaskresize:function(e,t,a){var n=t.data,r=n.Policy,o=n.Duration;if("Project Review"!=r&&null!=o&&0==o){var i=App.Nls["emxProgramCentral.Common.ValueMustBeAPositiveReal"];return alert(i),void t.reject()}},taskdrop:function(t,a,n){var r=a.data,o=(r.Policy,r.StartDate),i=r.EndDate,l=(r.Duration,r.DurationUnit);if(null==i&&null!=o){var s=r.Duration;l=r.DurationUnit;i=e.Date.add(o,l,s)}1==t.getTaskStore().data.items[0].data.ScheduleBackwards?a.setConstraint("finishnolaterthan",i):a.setConstraint("startnoearlierthan",o)},dependencybeforedrag:function(e,t,n){return a.doBasicEditChecks(t)},dependencydrop:function(t,a,n,r){var o=e.ComponentQuery.query("#dpmprojectgantt")[0].taskStore,i=a.getSourceId(),l=o.getModelById(i);if(null!=l){var s=l.get("Name"),d=l.get("TaskSequenceId"),c=l.get("TaskProjectId");d&&(d=parseInt(d)),a.data.predTaskSeqNumber=d,a.data.predecessorTaskName=s,a.data.predProjectId=c}var p=a.getTargetId(),g=o.getModelById(p);if(null!=g){var m=g.get("Name"),f=g.get("TaskSequenceId"),u=g.get("taskWBS");f&&(f=parseInt(f)),a.data.taskSeqNumber=f,a.data.successorTaskName=m,a.data.taskWBS=u}if(!n)return!1},selectionchange:function(t,a,n){var r=a.length,o=e.getCmp("bbarSelectObjectCount");if(o&&r>0){o.setHidden(!1);var i=App.Nls["emxProgramCentral.Common.Selected"];o.setValue(r+" "+i)}else o.setHidden(!0)},beforeprogressbarresize:(t,n,r)=>!App.Infra.TypeOf.ProjectTemplate&&(0!=a.doBasicEditChecks(n)&&("Project Space Hold Cancel"!=e.ComponentQuery.query("#dpmprojectgantt")[0].taskStore.getRoot().childNodes[0].data.Policy&&1!=App.Infra.TypeOf.Experiment)),afterprogressbarresize:function(e,t,a){100===t.data.PercentDone&&t.setReadOnly(!0)},onzoomToFit:function(){var e=this.getGantt(),t=e.timeAxis.mainUnit;e.timeAxis.mainUnit="w",e.zoomToFit(),e.timeAxis.mainUnit=t},onUndo:function(){var t=this.getGantt();if(t.undoManager.undo(),0===t.undoManager.getUndoQueue().length){var a=e.getCmp("tBarActionRedo");a.isDisabled()&&(a.enable(),a.setTooltip(App.Nls["emxProgramCentral.Gantt.Redo"]))}},onRedo:function(){this.getGantt().undoManager.redo()},onZoomOut:function(){var e=this.getGantt();e.zoomKeepsOriginalTimespan=!1,e.zoomOut(),e.zoomKeepsOriginalTimespan=!0},onZoomIn:function(){var e=this.getGantt(),t=e.getTaskStore().data.items[0].getDuration();e.maxZoomLevel=t>=10?16:25,e.getCurrentZoomLevelIndex()==e.maxZoomLevel&&alert(App.Nls["emxProgramCentral.Gantt.maxZoomLevel"]),e.zoomIn()},onExpandAll:function(e,t){var n=this.getGantt();new UWA.Promise(function(t,n){var r;e.scope&&(r=e.scope.rec),a.isReadyToExpand(r,t,0)}).then(function(t){n.setLoading(!1),n.setLoading(App.Nls["emxProgramCentral.Gantt.ExpandingStructure"]),setTimeout(function(){(console.time("expand"),App.Gantt.toolbar||(App.Gantt.toolbar={expandAll:{expanded:!1}}),App.Gantt.toolbar.expandAll.expanded=!0,e.scope)?1===e.scope.rec.data.depth?n.expandAll():n.lockedGrid.getSelectionModel().selected.items[0].expand(!0):n.expandAll();n.setLoading(!1),App.Gantt.toolbar.expandAll.expanded=!1,console.timeEnd("expand"),e.scope&&e.scope.done&&e.scope.done()},50)})},onExpandNLevelHandler:function(e){var t=this.getGantt();new UWA.Promise(function(t,n){var r;if(e.scope){r=e.scope.rec;var o=0;0!=e.level&&(o=r.data.depth-1+e.level),a.isReadyToExpand(r,t,o)}else a.isReadyToExpand(r,t,e.level)}).then(function(n){t.setLoading(!1),t.setLoading(App.Nls["emxProgramCentral.Gantt.ExpandingStructure"]),setTimeout(function(){if(console.time("expand"),App.Gantt.toolbar?App.Gantt.toolbar.expandAll.expanded=!0:App.Gantt.toolbar={expandAll:{expanded:!0}},e.scope){var n=t.lockedGrid.getSelectionModel().selected.items[0];a.selectiveExpandFromRMB(n,e.level)}else a.selectiveExpand(t,e.level);t.setLoading(!1),App.Gantt.toolbar.expandAll.expanded=!1,console.timeEnd("expand"),e.done&&e.done()},100)})},onHighlightCrit:function(t){var a=this.getGantt(),r=a.getSchedulingView();if(t.pressed||t.checked){var o,l=(g=e.getCmp("bbarObjectCount")).getValue(),s=App.Infra.Columns,d=!1;for(i=0,m=s.length;i<m;i++){var c=s[i].columns;if(null!=c){for(j=0,n=c.length;j<n;j++){if("TotalFloat"==c[j].dataIndex){o=App.Infra.Columns[i].text,d=!0;break}}if(1==d)break}}var p=o.split("(");criticalUpdateMsg=App.Nls["emxProgramCentral.Gantt.CriticalPath"]+"("+p[1],g.setValue(criticalUpdateMsg+" "+l),a.setLoading(App.Nls["emxProgramCentral.Gantt.ComputingCriticalPath"]||"Computing Critical Path"),setTimeout(function(){r.highlightCriticalPaths(!0),a.setLoading(!1)},50)}else{var g=e.getCmp("bbarObjectCount");r.unhighlightCriticalPaths(!0);var f=App.Nls["emxProgramCentral.Common.Objects"];g.setValue(a.getStore().getRange().length+" "+f)}},onPrint:function(){this.getGantt().print()},onCollapseGanttChart:function(e){if(1!=e.hidden){var t=e.icon,n=this.getGantt(),o=enoviaServer.computeUrl("/common/images/"),i=o+"I_HideChart_32.png",l=o+"I_ShowChart_32.png";n.lockedGrid.getWidth()>r.gantt.lockedGrid.width&&t.contains(l)||t.contains("iconActionImportDesignSyncModule.png")?(n.normalGrid.setCollapsed(!1),n.lockedGrid.setWidth(r.gantt.lockedGrid.width),a.enableButtons(r.toolbarBtnListToEnableDisable),e.setIcon(i),e.overflowText=App.Nls["emxProgramCentral.Gantt.Toolbar.CollapseChart"],e.setTooltip(App.Nls["emxProgramCentral.Gantt.Toolbar.CollapseChart"]),e.fireEvent("iconchange",e,l,i)):(n.lockedGrid.setWidth(n.ownerGrid.getWidth()+n.normalGrid.getWidth()),n.normalGrid.collapse(!0),a.disableButtons(r.toolbarBtnListToEnableDisable),e.setIcon(l),e.overflowText=App.Nls["emxProgramCentral.Gantt.Toolbar.ExpandChart"],e.setTooltip(App.Nls["emxProgramCentral.Gantt.Toolbar.ExpandChart"]),e.fireEvent("iconchange",e,i,l))}},onSave:function(){var t=this.getGantt();if(t.getCrudManager().sync(),!0===e.getCmp("tBarActionZoomToFit").pressed){var a=t.timeAxis.mainUnit;t.timeAxis.mainUnit="w",t.zoomToFit(),t.timeAxis.mainUnit=a}this.filter()},onReset:function(){var t=this.getGantt();App.Infra.OnReset=!0,t.getCrudManager().reject(),e.ComponentQuery.query("#dpmresourceutilizationpanel")[0].getStore().rejectChanges()},togglePlanView:function(t){if(1!=t.hidden){var a=t.pressed;null==a&&(a=t.checked);var r=this.getView(),o=enoviaServer.computeUrl("/common/images/"),l=o+"I_HidePlanActual32.png",s=o+"I_ShowPlanActual32.png";if(App.Infra.ViewId!=App.Infra.Views.VIEW_STATUS_REPORT){var d=r.getColumns();for(i=0,m=d.length;i<m;i++)"BaselineDuration"!=d[i].name&&"BaselineStartDate"!=d[i].name&&"BaselineEndDate"!=d[i].name||d[i].setVisible(a),"TotalFloat"!=d[i].name&&"FreeFloat"!=d[i].name||d[i].setVisible(!a)}if(App.Infra.BaselineRequired=a,r.baselineVisible=App.Infra.BaselineRequired,r.setReadOnly(a),r.getView().refresh(),a){if(r.showBaseline(),App.Infra.ReadOnly=a,enoviaServer.viewId=App.Nls.viewStore[2].viewId,t.setTooltip(App.Nls.viewStore[0].name),t.setIcon(l),null==r.getTaskStore().data.items[0].data.BaselineStartDate&&0==App.Infra.isCustomizedEnvironment&&alert(App.Nls["emxProgramCentral.Gantt.AlertForForecastCalculation"]),0==App.Infra.isCustomizedEnvironment){var c,p=(v=e.getCmp("bbarObjectCount")).getValue(),g=App.Infra.Columns,f=!1;for(i=0,m=g.length;i<m;i++){var u=g[i].columns;if(null!=u){for(j=0,n=u.length;j<n;j++){if("BaselineDuration"==u[j].dataIndex){c=App.Infra.Columns[i].text,f=!0;break}}if(1==f)break}}var h=c.split("(");criticalUpdateMsg=App.Nls["emxProgramCentral.Gantt.Forecast"]+"("+h[1],v.setValue(criticalUpdateMsg+" "+p)}e.getCmp("tBarActionCalculateFloatAndCriticalPath").disable(),e.getCmp("tBarActionRollUpTask").disable(),e.getCmp("tBarActionOutdent").disable(),e.getCmp("tBarActionIndent").disable()}else{if(r.hideBaseline(),App.Infra.ReadOnly=a,enoviaServer.viewId=App.Nls.viewStore[0].viewId,t.setTooltip(App.Nls.viewStore[2].name),t.setIcon(s),0==App.Infra.isCustomizedEnvironment){var v=e.getCmp("bbarObjectCount"),C=App.Nls["emxProgramCentral.Common.Objects"];v.setValue(r.getStore().getRange().length+" "+C)}e.getCmp("tBarActionCalculateFloatAndCriticalPath").enable(),e.getCmp("tBarActionRollUpTask").enable(),e.getCmp("tBarActionOutdent").enable(),e.getCmp("tBarActionIndent").enable()}var k=e.ComponentQuery.query("panel#GanttRefinementPanel")[0];k&&k.isVisible()&&(k.hide(),this.showRefinement())}},toggleView:function(t){var n=this;0!=App.Infra.Load.Level?(App.Infra.ViewId==App.Infra.Views.VIEW_STATUS_REPORT&&(App.Infra.LoadStatusActualData=!0),new UWA.Promise(function(t,n){var r=e.ComponentQuery.query("#dpmprojectgantt")[0];a.getStoreTaskExpandStatus(r.taskStore),a.isReadyToExpand(void 0,t,0)}).then(function(e){n.togglePlanView(t)})):n.togglePlanView(t)},changeIcon:function(e,t){var a=enoviaServer.computeUrl("/common/images/")+t;t=a||"";var n=e,r=n.btnIconEl,o=n.icon||"";n.icon=a,t!==o&&(r&&r.setStyle("background-image",t?"url("+t+")":""),n.fireEvent("iconchange",n,o,a))},toggleRollUpTaskView:function(e){if(1!=e.hidden){var t=e.pressed;null==t&&(t=e.checked);var a=this.getView(),n=enoviaServer.computeUrl("/common/images/"),r=n+"I_ShowRollupTask32.png",o=n+"I_HideRollupTask32.png";a.setShowRollupTasks(t),t?(e.setTooltip(App.Nls["emxProgramCentral.Gantt.Toolbar.hideRollUpTasks"]),e.setIcon(o)):(e.setTooltip(App.Nls["emxProgramCentral.Gantt.Toolbar.showRollUpTasks"]),e.setIcon(r))}},showRefinement:function(){e.ComponentQuery.query("panel#GanttRefinementPanel")[0].show()},showForm:function(){var t=e.ComponentQuery.query("#dpmprojectgantt")[0],a=t.crudManager;if(a.hasChanges()){if(!confirm(App.Nls["emxProgramCentral.Project.DiscardChanges"]))return!1;a.reject()}var n=e.ComponentQuery.query("#ganttConfigPanel")[0];n.reset(),n.show();for(var r=t.getPlugins(),o=0,i=r.length;o<i;o++)if(pluginId=r[o].id,"RMBMenu"===pluginId){r[o].disable();break}},showTaskCreationForm:function(){var t=e.ComponentQuery.query("#dpmprojectgantt")[0],n=t.crudManager;if(n.hasChanges()){if(!confirm(App.Nls["emxProgramCentral.Project.DiscardChanges"]))return!1;n.reject()}var r=e.ComponentQuery.query("#ganttTaskCreationPanel")[0],i=t.lockedGrid.getSelectionModel().selected.items;if(0===i.length)alert(App.Nls["emxFramework.Common.PleaseSelectitem"]);else if(1!==i.length)alert(App.Nls["emxFramework.Common.PleaseSelectOneItemOnly"]);else{var s=a.getGanttItem(r,"insertradio");!a.isValidAddSubTask(i[0])||i[0].isMilestone()&&i[0].isLeaf()?(s.items.items[1].disable(!0),s.items.items[0].enable(!0),s.items.items[0].setValue(!0)):a.isValidAddTaskAbove(i[0])?(s.items.items[0].enable(!0),s.items.items[1].enable(!0),s.items.items[1].setValue(!0)):(s.items.items[0].disable(!0),s.items.items[1].enable(!0),s.items.items[1].setValue(!0));var d=i[0].data.ConstraintType,c=t.taskStore.getRoot().childNodes[0];if(""!=d||"ProjectSpace"!=i[0].data.EnglishType&&"ProjectConcept"!=i[0].data.EnglishType&&"Experiment"!=i[0].data.EnglishType||(d="As Late As Possible"==i[0].data.defaultConstraintType?"aslateaspossible":"assoonaspossible"),""!==d)a.getGanttItem(r,"constrainttype").setValue(d);else if("Project Finish Date"===c.get("ScheduleFrom")){a.getGanttItem(r,"constrainttype").setValue("aslateaspossible")}var p=l.getSubTypePolicyAndBadcharsURL(),g=function(t){App.Infra.PoliciesAndTypes=t.data[0].relateddata.subTypesAndPolicies[0].dataelements;var n=App.Infra.PoliciesAndTypes.gateMilestoneTypes,r=n.substr(1,n.length-2).split(", ");App.Infra.PoliciesAndTypes.gateMilestoneTypes=r;var o=e.create("Ext.data.Store",{fields:["abbr","name"],data:function(){var e=new Array,t=App.Infra.PoliciesAndTypes.AllTypes,a=t.substr(1,t.length-2).split(","),n=a.length;for(idx=0;idx<n;idx++){var r=a[idx].trim(),o=App.Nls["emxProgramCentral.Type."+r];null==o&&(o=r),e.push({abbr:r,name:o})}return e}()});e.getCmp("type").bindStore(o);var i=e.ComponentQuery.query("#ganttTaskCreationPanel")[0];a.getGanttItem(i,"type").setValue("Task"),a.getGanttItem(i,"duration").durationUnit="d","Manual"===App.Infra.PoliciesAndTypes.schedule&&(e.getCmp("constrainttype").setHidden(!0),e.getCmp("constraintdate").setHidden(!0)),i.show(),e.getCmp("tBarganttConfiguration").disable()};window.isODTRunning?(this.type,method="GET",e.Ajax.request({url:p,method:method,async:!1,success:function(e){e=JSON.parse(e.responseText.trim()),g(e)}})):o.ajaxRequest({url:p,type:"GET",dataType:"json",callback:g})}},openTaskinCollabTask:function(e){if(e.scope){var t={ids:e.scope.rec.getId(),x3dPlatformId:window.widget.getValue("x3dPlatformId")};"OnPremise"==t.x3dPlatformId?s.showWidget("ENOTASP_AP","",t):s.showWidget("ENOTASK_AP","",t)}},openTask:function(e){this.getGantt();if(e.scope){var t=e.scope.rec.getId();t.indexOf("_")>=0&&(t=t.split("_")[0]);var a="../../common/emxNavigator.jsp?physicalId="+t;window.isIFWE&&(a=enoviaServer.computeUrl("/common/emxNavigator.jsp?physicalId=")+t),window.open(a)}},resetCache:function(){if(App.Gantt.filter.filterBy)for(var e in App.Gantt.filter.filterBy)"Name"!==e&&delete App.Gantt.filter.filterBy[e]},resetFilter:function(){if(this.getView().reset(),enoviaServer.resetRefinement=!0,this.resetCache(),this.filter(),0==e.Object.getSize(App.Gantt.filter.filterBy)){var t=e.ComponentQuery.query("#tBarActionRefine")[0];this.changeIcon(t,"iconActionFilter.png")}},hide:function(){this.getView().hide()},filter:function(){var t=e.ComponentQuery.query("panel#GanttRefinementPanel")[0],a=["PercentDone","Duration","BaselineDuration","TotalFloat","FreeFloat","Deviation"],n=t.getValues(),r=App.Gantt.filter.fields;for(var o in this.resetCache(),n)if(App.Gantt.filter.filterBy){var i=n[o],l=!1;if(i instanceof Array){if(""!=i.join(""))if(a.includes(o))for(var s=0,d=t.items.items.length;s<d;s++){if("cid"+o==t.items.items[s].id){var c=t.items.items[s].items.items[0];c.minValue.toString()==i[0]&&c.maxValue.toString()==i[1]?l=!1:(l=!0,i=i.join("@"));break}}else""!=i.join("")&&("datefield"==r[o].fieldDataType?(l=!0,i[0]=i[0]+"#"+e.getCmp(o+"_from_date").getValue(),i[1]=i[1]+"#"+e.getCmp(o+"_to_date").getValue(),i=i.join("@")):(l=!0,i=i.join("@")))}else i+""==""&&"Pattern"!=o&&"Color"!=o||(l=!0);if(l)if(App.Gantt.filter.filterBy[o]){var p=App.Gantt.filter.filterBy[o];p=p+"@"+i.toString(),App.Gantt.filter.filterBy[o]=p}else App.Gantt.filter.filterBy[o]=i.toString()}var g=App.Gantt.filter.filterBy;g&&Object.keys(g).length>0?this.getView().store.filterTreeBy():(this.getView().store.clearTreeFilter(),App.Gantt.filter.filterBy={});var m=e.ComponentQuery.query("#tBarActionRefine")[0];e.Object.getSize(App.Gantt.filter.filterBy)>0?this.changeIcon(m,"iconActionFiltersApplied.png"):e.Object.isEmpty(App.Gantt.filter.filterBy)&&this.changeIcon(m,"iconActionFilter.png")},filterByName:function(t,a){a.getKey()===a.ESC&&(delete App.Gantt.filter.filterBy.Name,t.reset());var n=t.getValue();if(n.length>0){App.Gantt.filter.filterBy.Name=n,this.getGantt().getTaskStore().filterTreeBy();var r=e.ComponentQuery.query("#tBarActionRefine")[0];this.changeIcon(r,"iconActionFiltersApplied.png")}else if(delete App.Gantt.filter.filterBy.Name,this.getGantt().getTaskStore().filterTreeBy(!0),0==e.Object.getSize(App.Gantt.filter.filterBy)){r=e.ComponentQuery.query("#tBarActionRefine")[0];this.changeIcon(r,"iconActionFilter.png")}},find:function(a,n,r){var o=this.getView(),i=o.getTaskStore();a.focus(!1);var l=this;this.finder=new t({field:a,view:o,store:i,newValue:n,oldValue:r}),e.Function.defer(function(){0!=App.Infra.Load.Level?l.finder.ExpandAndFind(l,!1):l.finder.find(!1,!1)},500)},clear:function(e){e.focus(!1),this.finder.reset()},previous:function(e){e.focus(!1);this.finder.find(!0,!0)},next:function(e){e.focus(!1);this.finder.find(!1,!0)},calculateFloatData:function(){var t=this.getGantt();if(t.crudManager.hasChanges()){if(!confirm(App.Nls["emxProgramCentral.Project.DiscardChanges"]))return!1;t.getCrudManager().reject()}var a=(new Date).getTimezoneOffset()/60;enoviaServer.clientTimezone=a;var r="/resources/v1/modeler/projects/"+enoviaServer.physicalId+"?$indexBasedImages=false&$include=none,getFloatValues&clientTimezone="+a;t.setLoading(!1),t.setLoading(App.Nls["emxProgramCentral.Gantt.CalculatingRollUp"]);o.ajaxRequest({url:r,type:"GET",dataType:"json",callback:function(t){for(var a=e.ComponentQuery.query("#dpmprojectgantt")[0],r=a.getTaskStore(),o=t.data[0].relateddata.getFloatValues,i=App.Infra.Columns,l=0,s=o.length;l<s;l++){var d=o[l],c=d.id;if("Last Modified"==c){var g=!1;for(k=0,m=i.length;k<m;k++){var f=i[k].columns;if(null!=f){for(p=0,n=f.length;p<n;p++)if("TotalFloat"==f[p].dataIndex){i[k].text=d.dataelements.lastModified,g=!0;break}if(1==g)break}}}else{var u=d.dataelements.totalFloat,h=d.dataelements.freeFloat,v=r.getModelById(c);v&&(v.set("TotalFloat",u),v.set("FreeFloat",h))}}a.crudManager.commit(),a.setLoading(!1)}})},calculateForecastValues:function(){var t=this.getGantt();if(t.crudManager.hasChanges()){if(!confirm(App.Nls["emxProgramCentral.Project.DiscardChanges"]))return!1;t.getCrudManager().reject()}var a=(new Date).getTimezoneOffset()/60;enoviaServer.clientTimezone=a;var r="/resources/v1/modeler/projects/"+enoviaServer.physicalId+"?$indexBasedImages=false&$include=none,getForecastValues&clientTimezone="+a;t.setLoading(!1),t.setLoading(App.Nls["emxProgramCentral.Gantt.CalculatingForecast"]);o.ajaxRequest({url:r,type:"GET",dataType:"json",callback:function(t){for(var a=e.ComponentQuery.query("#dpmprojectgantt")[0],r=a.getTaskStore(),o=t.data[0].relateddata.getForecastValues,i=App.Infra.Columns,l=0,s=o.length;l<s;l++){var d=o[l],c=d.id;if("Last Modified"==c){var g=!1;for(k=0,m=i.length;k<m;k++){var f=i[k].columns;if(null!=f){for(p=0,n=f.length;p<n;p++)if("BaselineDuration"==f[p].dataIndex){i[k].text=d.dataelements.forecastUpdatedOn,g=!0;break}if(1==g)break}}}else{var u=d.dataelements.forecastStartDate,h=d.dataelements.forecastFinishDate,v=d.dataelements.forecastDuration,C=d.dataelements.EstStartDate,A=d.dataelements.EstFinishDate,T=d.dataelements.EstDuration,y=r.getModelById(c);y&&(y.set("BaselineStartDate",u),y.set("BaselineEndDate",h),y.set("BaselineDuration",v),y.set("StartDate",C),y.set("EndDate",A),T.includes("d")&&y.set("Duration",T))}}a.crudManager.commit(),a.setLoading(!1)}})},promoteSuccessor:function(){var t=this.getGantt();if(t.crudManager.hasChanges()){if(!confirm(App.Nls["emxProgramCentral.Project.DiscardChanges"]))return!1;t.getCrudManager().reject()}var a="/resources/v1/modeler/projects/"+enoviaServer.physicalId+"?$indexBasedImages=false&$include=none,promoteSuccessor";t.setLoading(!0);o.ajaxRequest({url:a,type:"GET",dataType:"json",callback:function(t){for(var a=e.ComponentQuery.query("#dpmprojectgantt")[0],n=a.getTaskStore(),r=t.data[0].relateddata.promoteSuccessor,o=(App.Infra.Columns,0),i=r.length;o<i;o++){var l=r[o],s=l.id,d=l.dataelements.state,c=n.getModelById(s);c&&c.set("State",App.Nls[d])}a.crudManager.commit(),a.setLoading(!1)}})},onOutdent:function(){var t=e.ComponentQuery.query("#dpmprojectgantt")[0],n=t.crudManager;if(n.hasChanges()){if(!confirm(App.Nls["emxProgramCentral.Project.DiscardChanges"]))return!1;n.reject()}var r=t.lockedGrid.getSelectionModel().selected.items,o=!0;if(r.length>0&&0==(r=a.isValidTaskIndentation(r,!0)).length&&(o=!1),o){var i=e.Array.filter(r,function(e){return!e.isReadOnly()});t.getTaskStore().outdent(i,function(e,r){n.transport.sync.params.LeftIndent=!0,a.getStoreTaskExpandStatus(t.getTaskStore()),n.sync(),n.commit()})}},onIndent:function(){var t=e.ComponentQuery.query("#dpmprojectgantt")[0],n=t.crudManager;if(n.hasChanges()){if(!confirm(App.Nls["emxProgramCentral.Project.DiscardChanges"]))return!1;n.reject()}var r=t.lockedGrid.getSelectionModel().selected.items,o=!0;if(r.length>0&&0==(r=a.isValidTaskIndentation(r,!1)).length&&(o=!1),o){var i=e.Array.filter(r,function(e){return e.previousSibling&&!e.previousSibling.isReadOnly()});t.getTaskStore().indent(i,function(e,r){n.transport.sync.params.RightIndent=!0,a.getStoreTaskExpandStatus(t.getTaskStore()),n.sync(),n.commit()})}}})});