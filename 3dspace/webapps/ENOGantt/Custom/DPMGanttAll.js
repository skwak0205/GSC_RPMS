define("DS/ENOGantt/Custom/DPMGanttAll",["UWA/Class","DS/ENOGantt/Ven/Ext","DS/ENOGantt/Ven/Bryntum","DS/ENOGantt/Data/ResponseUtil","DS/ENOGantt/GanttUtil","DS/ENOGantt/URLStore"],function(e,t,a,r,n,i){return e.extend({init:function(){var e='<h5 class="sch-task-tip-header">{Name}</h5><table><tr><td>'+App.Nls["emxProgramCentral.Common.StartDate"]+':</td> <td align="left">{[this.getStartDateString(values)]}</td></tr><tr><td>'+App.Nls["emxProgramCentral.Common.EndDate"]+':</td> <td align="left">{[this.getEndDateString(values)]}</td></tr><tr><td>'+App.Nls["emxProgramCentral.Gantt.Tooltip.Progress"]+':</td> <td align="left">{[this.getPercentDoneString(values)]}%</td></tr>';App.Infra.ViewId!=App.Infra.Views.VIEW_STATUS_REPORT&&(e=e+'<tr><td valign="top">'+App.Nls["emxProgramCentral.Common.Assignee"]+':</td><td width="100px" align="left">{[values.Assignee]}</td></tr>'),e+="</table>",t.define("DS.ENOGantt.DPMGanttAll.TooltipTamplate",{extend:"Gnt.template.TaskTooltip",disableFormats:!0,dateFormat:null,markup:['<tpl if="records">','<tpl for="records">','<tpl if="xindex &lt;= _maxItemsInTooltip_">',"_bodyTpl_","</tpl>","</tpl>",'<tpl if="records.length &gt; _maxItemsInTooltip_">','<div class="sch-task-tip-extra">',"{[this.getOverflowText(values)]}","</div>","</tpl>","<tpl else>","_bodyTpl_","</tpl>"].join(""),bodyMarkup:[e].join(""),constructor:function(e,t){this.markup=e||this.markup,this.callParent([this.markup]),this.dateFormat=t},getPercentDoneString:function(e){e._record;var t=e.PercentDone;return Math.round(t)}}),t.define("DS.ENGantt.patches.Task",{extend:"Sch.util.Patch",target:"Gnt.model.Task",overrides:{setStartDateWithoutPropagation:function(e,t,a){var r,n,i=this,l=i.getTaskStore(!0);return t=!1!==t,l&&!0!==a&&!1!==a?a=l.skipWeekendsDuringDragDrop:!0!==a&&!1!==a&&(a=!1),i.autoCalculateLag(),i.beginEdit(),e?(!a||i.isMilestone()&&l&&l.scheduleByConstraints||(e=i.skipNonWorkingTime(e,!0)),i.set(i.startDateField,e),l&&i.isSegmented()&&i.updateSegmentsDates(),!1!==t?i.set(i.endDateField,i.recalculateEndDate(e)):(n=this.getEndDate())&&(this.constrainSegments(),i.set(i.durationField,i.calculateDuration(e,n,i.getDurationUnit())))):(i.set(i.durationField,null),i.set(i.startDateField,null),i.setSegmentsWithoutPropagation(null)),r=i.getDuration(),n=i.getEndDate(),e&&n&&null==r&&i.set(i.durationField,i.calculateDuration(e,n,i.getDurationUnit())),i.onPotentialEffortChange(),i.endEdit(),!0},setEndDateWithoutPropagation:function(e,a,r){var n,i,l=this,o=l.getTaskStore(!0);a&&(this.isEndDateModified=!0),a=!1!==a,!0!==r&&!1!==r&&o?r=o.skipWeekendsDuringDragDrop:!0!==r&&!1!==r&&(r=!1),l.autoCalculateLag(),l.beginEdit();var s=l.getEndDate();if(e)if(e<(i=l.getStartDate())&&!1===a&&(e=i),r&&(!r||l.isMilestone()&&o&&o.scheduleByConstraints||(e=l.skipNonWorkingTime(e,!1))),!1!==a)n=l.getDuration(),t.isNumber(n)?(o&&l.isSegmented()&&e-s&&l.updateSegmentsDates({isForward:!1,endDate:e}),l.set(l.startDateField,l.calculateStartDate(e,n,l.getDurationUnit())),l.set(l.endDateField,e)):l.set(l.endDateField,e);else{var d=l.isMilestone();if(e<i&&l.set(l.startDateField,e),l.set(l.endDateField,e),l.constrainSegments(),i&&(l.set(l.durationField,l.calculateDuration(i,e,l.getDurationUnit())),d&&!l.isMilestone())){var p=l.skipNonWorkingTime(i,!0);p-i!=0&&l.set(l.startDateField,p)}}else l.set(l.durationField,null),l.set(l.endDateField,null),l.setSegments(null);return n=l.getDuration(),i=l.getStartDate(),e&&i&&null==n&&l.set(l.durationField,l.calculateDuration(i,e,l.getDurationUnit())),l.onPotentialEffortChange(),l.endEdit(),!0},getPinConstraintType:function(e){var t,a=!1;return"Project Finish Date"===(e=e||this.getTaskStore(!0)).getRoot().childNodes[0].data.ScheduleFrom&&(a=!0),this.isEndDateModified?(t="finishnoearlierthan",a&&(t="finishnolaterthan"),t):a?"finishnolaterthan":"startnoearlierthan"},pinWithoutPropagation:function(e,t){var a=this,r=a.getTaskStore(!0);if(a.isPinnable(r)){var n=a.getPinConstraintType(r),i=!1;scheduleFrom=r.getRoot().childNodes[0].data.ScheduleFrom,"Project Finish Date"===scheduleFrom&&(i=!0),taskDate=i?a.getEndDate():a.isEndDateModified?a.getEndDate():a.getStartDate(),delete a.isEndDateModified,a.setConstraintWithoutPropagation(n,taskDate)}},getCriticalPaths:function(){for(var e,t=[this],a=[[this]];e=t.shift();){for(var r=e.getIncomingDependencies(),n=[],i=0;i<r.length;i++){var l=r[i],o=l.getSourceTask();null!=o&&o.isCritical()&&l.isCritical(l)&&n.push(o)}n.length&&a.push(n)}return a}}}),t.define("DS.ENOGantt.DPMGanttAll.Component",{override:"Ext.Component",getMaskTarget:function(){return this.getEl()}}),t.define("DS.ENOGantt.DPMGanttAll.column.EndDate",{override:"Gnt.column.EndDate",validateStartDate:!1,keepDuration:!0}),t.define("DS.ENOGantt.DPMGanttAll.field.EndDate",{override:"Gnt.field.EndDate",validateStartDate:!1,keepDuration:!0}),t.define("DS.ENOGantt.DPMGanttAll.util.DependencyParser",{override:"Gnt.util.DependencyParser",parse:function(e){if(!e)return[];for(var a=e.split(","),r=[],n=this.dependencyRegex,i=0;i<a.length;i++){var l=a[i];if(l||i!=a.length-1){var o={};if(!(s=n.test(l)))return null;-1==l.indexOf("+")&&-1==l.indexOf("-")&&(l+="+0 d");var s,d=(s=l.split(new RegExp("(([a-zA-Z0-9_-]+((sw+)+))?:)?(-?d+)?:(FS|SF|FF|SS|sf|fs|ff|ss|Sf|Fs|Ff|Ss|sS|sF|fS|fF)?([+-]{1})(d+(.d+)?s[DdHh])?")))[0];if(d.indexOf(":")>=0){var p=d.split(":"),c=p[0];o.predProjectName=c,o.isExtDep=!0,d=p[1]}else App.Infra.RootProjectname&&(o.predProjectName=App.Infra.RootProjectname);o.taskId=parseInt(d,10),o.predTaskSeqNumber=o.taskId,o.type=t.Array.indexOf(this.types,(s[6]||this.types[2]).toUpperCase());var g=s[10];if(g){var u=this.durationParser.parse(g,!0);if(!u)return null;"-"==s[7]&&(u.value=-1*u.value),u.value=parseFloat(u.value).toFixed(1),o.lag=u.value,o.lagUnit=u.unit.toLocaleLowerCase()||Sch.util.Date.DAY}r.push(o)}}return r}}),t.define("DS.ENOGantt.DPMGanttAll.field.Dependency",{override:"Gnt.field.Dependency",getTaskIdFromDependency:function(e,t){var a,r=this.task.getTaskStore(),i=e.taskId;if(this.useSequenceNumber){if(e.isExtDep){var l=e.predProjectName,o=this.task.get("TaskProjectId"),s=!1,d=(C=r.toArray()).length,p=0,c="",g=App.Infra.ColumnIndex.Name;for(idx=p;idx<d;idx++){var u=(b=C[idx]).get(App.Infra.Columns[g].dataIndex),h=b.get("Id");if(u&&r.RefinementUtil.patternMatches(l,u)&&o!=h){c=b.get("Id"),s=!0;break}}if(!s){if(t){var f=l,m=i;this.taskId=i;var x=n.getExternalProjectTaskBySequenceId(f,m);return i=x.taskId,projectPhyId=x.projectPhyId,e.fromProjectId=projectPhyId,e.ToAddToTask=!0,e.predTaskSeqNumber=m,i}return{taskId:void 0,isExtprojDep:!0}}o=c,d=(C=r.toArray()).length,p=0;var D=App.Infra.ColumnIndex.TaskSequenceId;for(idx=p;idx<d;idx++){if((u=(b=C[idx]).get(App.Infra.Columns[D].dataIndex))&&""+i==u){if((h=b.get("TaskProjectId"))==o){a=b;break}}else;}}else{o=this.task.get("TaskProjectId"),d=(C=r.toArray()).length,p=0,D=App.Infra.ColumnIndex.TaskSequenceId;var C,v=App.Infra.Columns[D].dataIndex;for(idx=p;idx<d;idx++){var b;if((u=(b=C[idx]).get(v))&&""+i==u){if((h=b.get("TaskProjectId"))==o){a=b;break}}else;}}i=a&&a.getId()}if(!i){l=e.predProjectName,m=e.taskId;this.taskId=i,i=(x=n.getExternalProjectTaskBySequenceId(l,m)).taskId,projectPhyId=x.projectPhyId,e.fromProjectId=projectPhyId}return i},applyChanges:function(e){var a,l=(e=e||this.task).getTaskStore().dependencyStore,o=this.getDependencies(),s=this.isPredecessor(),d=s?e.getIncomingDependencies(!0):e.getOutgoingDependencies(!0),p=[],c=t.Array.map(o,function(e){return this.getTaskIdFromDependency(e)},this);for(a=0;a<d.length;a++)t.Array.contains(c,d[a][s?"getSourceId":"getTargetId"]())||p.push(d[a]);p.length>0&&l.remove(p);var g=[],u=[];for(a=0;a<o.length;a++){var h=o[a],f=this.getTaskIdFromDependency(h,!0),m=l.getTasksLinkingDependency(f,e.getId());if(m)m.beginEdit(),m.setType(h.type),m.setLag(h.lag,h.lagUnit),m.endEdit();else if(h.ToAddToTask){var x={isExtDep:!0};x.From=f,x.To=e.getId(),x.Type=h.type,x.predTaskSeqNumber=h.predTaskSeqNumber,x.predProjectName=h.predProjectName,x.fromProjectId=h.fromProjectId,x.Lag=h.lag||0,x.LagUnit=h.lagUnit||"d",u.push(x)}else{var D=e.taskStore.getModelById(f),C="";if(D)C=D.get("Name");else{var v=h.predProjectName,b=h.predTaskSeqNumber,k=t.ComponentQuery.query("#dpmprojectgantt")[0].taskStore.getRoot().childNodes[0].id,S=i.getExternalProjectTaskBySequenceIdURL(v,b,k,!1);S+="&needTaskName=true",C=n.syncAjaxCall(S,"GET").taskName}var y=e.get("TaskSequenceId");y&&(y=parseInt(y)),(m=new l.model).setSourceId(s?f:e.getId()),m.setTargetId(s?e.getId():f),m.setType(h.type),m.data.predTaskSeqNumber=h.predTaskSeqNumber,m.data.predecessorTaskName=C,m.data.predProjectName=h.predProjectName,m.data.taskSeqNumber=y,m.data.successorTaskName=e.get("Name"),m.fromProjectId=h.fromProjectId,m.setLag(h.lag||0,h.lagUnit||"d"),g.push(m)}}if(g.length>0&&l.add(g),u){var F=e.get("ExternalDependencies"),T=u;F?e.set("ExternalDependencies",T):(e.data.ExternalDependencies=[],e.set("ExternalDependencies",T)),r.setRawExternalDependency(e,u,F)}},getErrors:function(e){if(!e)return[];var a=this.dependencyParser.parse(e);if(!a)return[this.L("invalidFormatText")];for(var r,n=this.getDependencies(),i=this.isPredecessor(),l=this.task,o=l.getTaskStore().dependencyStore,s=l[i?"predecessors":"successors"],d=this.dependencyParser.types,p=o.allowedDependencyTypes,c=o.model.Type,g=[],u=0;u<n.length;u++){var h=n[u],f=this.getTaskIdFromDependency(h,!0);if(f&&f.isExtprojDep)return"";if(!(r=f))return[this.L("invalidDependencyText")];if(o.allowedDependencyTypes&&!o.isValidDependencyType(h.type)){for(var m="",x=0,D=p.length;x<D;x++)m+=d[c[p[x]]]+",";return[t.String.format(this.L("invalidDependencyType"),d[h.type],m.substring(0,m.length-1))]}var C=new o.model;C.setSourceId(i?r:l.getId()),C.setTargetId(i?l.getId():r),C.setType(h.type),C.data.predProjectName=h.predProjectName,C.setLag(h.lag,h.lagUnit),g.push(C)}for(u=0;u<g.length;u++)if(!o.isValidDependency(g[u],g,s))return[this.L("invalidDependencyText")];return this.callParent([a.value])},getFieldDisplayValue:function(e){var t=e.getTaskStore();if(this.isPredecessor()){var a=e.getId(),r=e.getAllDependencies(),n=e.get("ExternalDependencies");n&&n.length>0&&(r=r.concat(n));var i=new Array,l=r.length;for(idx=0;idx<l;idx++){var o=r[idx],s=o.isExtDep;if(s)var d=parseInt(o.Type),p=o.To,c=o.predTaskSeqNumber,g=o.predProjectName,u=(o.predProjectId,o.Lag),h=o.LagUnit;else{if((c=o.getFrom())==a)continue;c=(c=t.getModelById(c))?c.get("TaskSequenceId"):o.data.predTaskSeqNumber;p=o.getTo(),d=o.getType(),u=o.getLag(),g=o.data.predProjectName,h=o.getLagUnit()}if(!g&&o.getFrom()){var f=o.getFrom();if(v=t.getModelById(f)){var m=v.get("TaskProjectId"),x=t.getModelById(m);x&&(g=x.get("Name"))}}switch(d){case 0:d="SS";break;case 1:d="SF";break;case 2:d="FS";break;case 3:d="FF"}var D=parseInt(u)>=0?"+":"",C="";if(g){var v,b=!0,k=(t.data.items[0].data.Id,t.getModelById(p).get("TaskProjectId")),S="";f=s?o.From:o.getFrom();(v=t.getModelById(f))&&(S=v.get("TaskProjectId")),k!=S&&o.fromProjectId!=k||(b=!1),b&&(C=g+":")}C=C+c+":"+d+D+u+" "+h,i.push(C)}return i.sort(),i.join(",")}}}),t.define("DS.ENOGantt.DPMGanttAll.plugin.ConstraintResolutionGui",{override:"Gnt.plugin.ConstraintResolutionGui",onConstraintConflict:function(e,r){var n,i=this,l=i.getCmp(),o=l.lockedGrid.getView(),s=l.normalGrid.getView(),d=l.getDependencyView(),p={destroy:function(){t.destroy(n)}};function c(){o.refreshNode(e),s.refreshNode(e);try{d.updateDependencies(e.getAllDependencies()).then(null,t.emptyFn)}catch(e){console.log(e)}}if(c(),i.hasStoredResolutionForContext(r))i.resolveSilently(r,c);else{var g={dateFormat:i.getDateFormat(),resolutionContext:r};r.windowTitle&&(g.title=r.windowTitle),i.window=new a.widget.ConstraintResolutionWindow(g),n=i.window.on({ok:t.Function.bind(i.onUserActionOk,i,[r,c,i.window,p],!0),cancel:t.Function.bind(i.onUserActionCancel,i,[r,c,i.window,p],!0),close:t.Function.bind(i.onUserActionClose,i,[r,c,p],!0),destroyable:!0}),l.completeEdit(),i.window.show()}}}),t.define("DS.ENOGantt.DPMGanttAll.constraint.Base",{override:"Gnt.constraint.Base",getRemoveConstraintResolutionOption:function(e,a,r){r=r||a.getConstraintDate();var n=a.getTaskStore(!0);return{id:"remove-constraint",title:t.String.format(this.L("Remove the constraint"),this.L("name")),resolve:function(){(a.setConstraintWithoutPropagation("startnoearlierthan"),n.scheduleByConstraints&&a.getEarlyStartDate()<=a.getStartDate())&&a.pinWithoutPropagation(void 0,!0);e()}}}}),t.define("DS.ENOGantt.DPMGanttAll.widget.taskeditor.TaskEditor",{extend:"Sch.util.Patch",target:"Gnt.widget.taskeditor.TaskEditor",overrides:{buildItems:function(){var e=this;return items=[],e.taskForm=t.create(e.taskFormClass,t.apply({xtype:"taskform",xclass:e.taskFormClass,task:e.task,border:!1,taskStore:e.taskStore,showBaseline:e.showBaseline,showRollup:!1},e.taskForm,e.taskFormConfig)),items=e.callParent(arguments),items}}}),t.define("DS.ENOGantt.DPMGanttAll.util.DurationParser",{extend:"Sch.util.Patch",target:"Gnt.util.DurationParser",overrides:{parse:function(e,a){var r=this.durationRegex.exec(e);if(null==e||!r)return null;var n,i=this.parseNumberFn(r[1]),l=r[2];return l&&!a&&(t.iterate(this.L("unitsRegex"),function(e,t){if(t.test(l))return n=Sch.util.Date.getUnitByName(e),!1}),n||(n=l)),n||(n=l),{value:i,unit:n}}}}),t.define("DS.ENOGantt.Ext.tree.View",{extend:"Sch.util.Patch",target:"Ext.tree.View",overrides:{expand:function(e,t,a,r,i){var l=this,o=arguments;if(i)return l.callParent(o);new UWA.Promise(function(t,a){n.isReadyToExpand(e,t)}).then(function(n){return l.expand(e,t,a,r,!0)})}}}),t.define("DS.ENOGantt.picker.Pattern",{extend:"Ext.picker.Color",alias:"widget.patternPicker",renderTpl:['<tpl for="patterns">','<a href="#" role="button" class=" {parent.itemCls} {palleteCls}" hidefocus="on">','<span class="{parent.itemCls}-inner {.} {.}-RMB" >&#160;</span>',"</a>","</tpl>"],patterns:["diagonal1","diagonal2","diagonal3","diagonal4","cal4","pattern1","pattern2","pattern3","pattern4","cal5"],patRe:/(\s.*?-)/,handleClick:function(e){var t;if(e.stopEvent(),!this.disabled){var a=(t=e.currentTarget.children[0].className.match(this.patRe)[1]).substring(t.lastIndexOf(" ")+1,t.length-1);this.fireEvent("select",this,a)}},initRenderData:function(){var e=this,a=this.renderTpl.html;return a=a.replace("{palleteCls}",App.Infra.palleteClass),this.renderTpl.html=a,t.apply(e.superclass.callParent(),{itemCls:e.itemCls,patterns:e.patterns,row:e.row,height:e.height})}}),t.define("DS.ENOGantt.DPMGanttAll.Button",{override:"Ext.button.Button",onEnable:function(){var e=this,t=e.href,a=e.hrefTarget,r=e.el.dom;e.callSuper(),e.removeCls(e._disabledCls),e.el.setTabIndex(e.tabIndex),t&&(r.href=t),a&&(r.target=a)},onDisable:function(){var e=this,t=e.el.dom;e.callSuper(),e.addCls(e._disabledCls),e.removeCls(e.overCls),e.el.setTabIndex(null),e.href&&t.removeAttribute("href"),e.hrefTarget&&t.removeAttribute("target")}}),t.define("DS.ENOGantt.DPMGanttAll.panel.Gantt",{override:"Gnt.panel.Gantt",onTaskReorder:function(e,a,r,n){var i=this.valid;if(i){var l=a.view.store,o=a.view.up("ganttpanel"),s=this.getTargetFromEvent(r),d=this.view.getRecord(s),p=o.getSchedulingView().getVerticalScroll();if(i=d!==n._reorderingTask){var c=n.records,g={},u=this.view;if(o.suspendRefreshOnTaskReorder&&o.suspendRefresh(),t.Array.each(c,function(e){g[e.parentNode.id]=e.parentNode}),l.suspendAutoRecalculateParents++,i=this.self.prototype.onNodeDrop.apply(this,arguments),l.suspendAutoRecalculateParents--,i){g[c[0].parentNode.id]=c[0].parentNode;var h=t.Object.getValues(g);h.sort(function(e,t){return e.data.depth>t.data.depth?-1:1}),t.Array.each(h,function(e){e.refreshCalculatedParentNodeData()})}o.suspendRefreshOnTaskReorder&&o.resumeRefresh(!0),setTimeout(function(){u.setScrollY(p)},0)}}return i}}),t.define("DS.ENOGantt.DPMGanttAll.plugin.gridviewdragdrop",{override:"Ext.tree.plugin.TreeViewDragDrop",dragText:"{0} "+App.Nls["emxProgramCentral.dragdrop.dragText"]}),t.define("DS.ENOGantt.DPMGanttAll.widget.ConstraintResolutionForm",{extend:"Sch.util.Patch",target:"Gnt.widget.ConstraintResolutionForm",overrides:{setupFooterFromResolutionContext:function(e){var a=this;t.isObject(e)&&t.isArray(e.resolutions)||t.Error.raise("Invalid resolution context provided!"),a.fbar={itemId:"footer-tb",items:[{xtype:"checkbox",itemId:"dont-ask-cb",boxLabel:a.L("Don't ask again"),tabIndex:e.resolutions.length+1,hidden:!0},"->",{text:a.L("OK"),itemId:"ok-btn",style:"border-color:#368EC4;background-color:#368EC4;color:#FFFFFF !important;font-size:14px",cls:"apply-button-text",formBind:!0,tabIndex:e.resolutions.length+2,handler:a.onUserActionOk,scope:a},{text:a.L("Cancel"),itemId:"cancel-btn",tabIndex:e.resolutions.length+3,handler:a.onUserActionCancel,scope:a}]}}}}),t.define("DS.ENOGantt.DPMGanttAll.ConstraintType",{extend:"Sch.util.Patch",target:"Gnt.field.ConstraintType",overrides:{statics:{buildDefaultConstraintTypeList:function(e){var a=[];return t.Array.each(t.ClassManager.getNamesByExpression("gntconstraint.*"),function(e){var r=t.ClassManager.get(e),n=r.alias[0].split(".").pop();r&&a.push([n,r.L("name")])}),a=t.Array.sort(a,function(e,t){return e[1]>t[1]?1:-1}),e&&a.unshift([null,""]),a}}}}),t.define("DS.ENOGantt.DPMGanttAll.widget.DependencyGrid",{override:"Gnt.widget.DependencyGrid",buildColumns:function(){var e=this,t=this.store.model.prototype,a=[],r=this.dependencyStore&&this.dependencyStore.getTaskStore();this.tasksCombo=this.buildTasksCombo(),r?this.bindTaskStore():(this.deferredStoreBind=!0,this.tasksCombo.on("afterrender",this.bindTaskStore,this));var n=t["predecessors"===this.direction?"fromField":"toField"];return this.useSequenceNumber?a.push({text:this.L("snText"),dataIndex:n,renderer:function(t,a,r){var i=e.dependencyStore&&e.dependencyStore.getTaskStore(),l=i&&i.getModelById(r.get(n));return l?l.getSequenceNumber():""},width:50}):a.push({text:this.L("idText"),dataIndex:n,width:50}),a.push({text:this.L("taskText"),dataIndex:n,flex:1,editor:this.tasksCombo,renderer:function(t,a,r){return e.taskRender(t,a,r)}}),this.lagEditor=this.buildLagEditor(),this.typesCombo=this.buildTypesCombo(),a.push({text:this.L("typeText"),dataIndex:t.typeField,width:120,renderer:this.dependencyTypeRender,scope:this,editor:this.typesCombo},{text:this.L("lagText"),dataIndex:t.lagField,width:100,editor:this.lagEditor,renderer:function(a,r,n){return e.lagEditor.valueToVisible(a,n.get(t.lagUnitField),2)}}),a}}),t.define("DS.ENOGantt.DPMGanttAll.colorpick.ButtonController",{override:"Ext.ux.colorpick.ButtonController",onClick:function(){var e,a,r=t.ComponentQuery.query("#dpmprojectgantt")[0];if(r)var n=r.lockedGrid.getSelectionModel().selected.items;var i=this.getView(),l=this.getPopup();a=n&&1==n.length?""==(e=n[0].get("Color"))?t.ux.colorpick.ColorUtils.parseColor("#5FA2DD"):t.ux.colorpick.ColorUtils.parseColor(e):t.ux.colorpick.ColorUtils.parseColor("#5FA2DD");var o=l.colorPicker;o.setColor(a),o.setPreviousColor(a),l.showBy(i,"tl-br?")}}),t.define("DS.ENOGantt.DPMGanttAll.colorpick.Button",{override:"Ext.ux.colorpick.Button",renderTpl:'<a class="x-btn x-unselectable x-border-item x-box-item x-btn-default-small" style="padding: 0px 5px; margin: 0px; height: 18px;" hidefocus="on" unselectable="on" role="button" aria-hidden="false" aria-disabled="false" id="{id}" tabindex="0" ><span id="{id}-btnWrap" data-ref="btnWrap" role="presentation" unselectable="on" style class="x-btn-wrap x-btn-wrap-default-small "><span id="{id}-btnEl" data-ref="btnEl" unselectable="on" style="height: auto; width: 75px; text-overflow: ellipsis;" class="x-btn-button x-btn-button-default-small x-btn-text x-btn-button-center " title="'+App.Nls["emxProgramCentral.Gantt.MoreColors"]+'"><span id="{id}-btnIconEl" data-ref="btnIconEl" role="presentation" unselectable="on" class="x-btn-icon-el x-btn-icon-el-default-small" style></span><span id="{id}-btnInnerEl" data-ref="btnInnerEl" unselectable="on" class="x-btn-inner x-btn-inner-default-small">'+App.Nls["emxProgramCentral.Gantt.MoreColors"]+'</span></span></span><div id="{id}-tooltipEl" data-ref="tooltipEl" role="presentation" class="x-btn-tooltip"></div></a>'}),t.define("DS.ENOGantt.DPMGanttAll.colorpick.Selector",{override:"Ext.ux.colorpick.Selector",getPreviewAndButtons:function(e,t){var a=[{xtype:"colorpickercolorpreview",flex:1,bind:{color:{bindTo:"{selectedColor}",deep:!0}}}];return t.showPreviousColor&&a.push({xtype:"colorpickercolorpreview",flex:1,bind:{color:{bindTo:"{previousColor}",deep:!0}},listeners:{click:"onPreviousColorSelected"}}),t.showOkCancelButtons&&a.push({xtype:"button",id:"okButton",text:"OK",tooltip:"OK",margin:"10 0 0 0",padding:"10 0 10 0",handler:"onOK"},{xtype:"button",text:App.Nls["emxProgramCentral.Gantt.DependencyEditor.Cancel"],tooltip:App.Nls["emxProgramCentral.Gantt.DependencyEditor.Cancel"],margin:"10 0 0 0",padding:"10 0 10 0",handler:"onCancel"}),{xtype:"container",viewModel:e,width:70,margin:"0 0 0 10",items:a,layout:{type:"vbox",align:"stretch"}}},getMapAndHexRGBFields:function(e){var a={top:0,right:this.fieldPad,bottom:0,left:0},r=this.fieldWidth;return{xtype:"container",viewModel:e,cls:t.baseCSSPrefix+"colorpicker-escape-overflow",flex:1,layout:{type:"vbox",align:"stretch"},margin:"0 10 0 0",items:[{xtype:"colorpickercolormap",reference:"colorMap",flex:1,bind:{position:{bindTo:"{selectedColor}",deep:!0},hue:"{selectedColor.h}"},listeners:{handledrag:"onColorMapHandleDrag"}},{xtype:"container",layout:"hbox",defaults:{labelAlign:"top",labelSeparator:"",allowBlank:!1,onChange:function(){this.isValid()?t.form.field.Base.prototype.onChange.apply(this,arguments):t.getCmp("okButton").setDisabled(!0),0==t.getCmp("hexField").getErrors().length&&0==t.getCmp("RField").getErrors().length&&0==t.getCmp("BField").getErrors().length&&0==t.getCmp("GField").getErrors().length&&t.getCmp("okButton").setDisabled(!1)}},items:[{xtype:"textfield",id:"hexField",fieldLabel:"HEX",flex:1,bind:"{hex}",margin:a,regex:/^#[0-9a-f]{6}$/i,readonly:this.getHexReadOnly()},{xtype:"numberfield",id:"RField",fieldLabel:"R",bind:"{red}",width:r,hideTrigger:!0,maxValue:255,minValue:0,allowDecimals:!1,margin:a},{xtype:"numberfield",id:"GField",fieldLabel:"G",bind:"{green}",width:r,hideTrigger:!0,maxValue:255,minValue:0,allowDecimals:!1,margin:a},{xtype:"numberfield",id:"BField",fieldLabel:"B",bind:"{blue}",width:r,hideTrigger:!0,maxValue:255,minValue:0,allowDecimals:!1,margin:0}]}]}},getSliderAndHField:function(e){var a=this.fieldWidth;return{xtype:"container",viewModel:e,cls:t.baseCSSPrefix+"colorpicker-escape-overflow",width:a,layout:{type:"vbox",align:"stretch"},items:[{xtype:"colorpickersliderhue",reference:"hueSlider",flex:1,bind:{hue:"{selectedColor.h}"},width:a,listeners:{handledrag:"onHueSliderHandleDrag"}},{xtype:"numberfield",id:"HField",fieldLabel:"H",labelAlign:"top",labelSeparator:"",bind:"{hue}",hideTrigger:!0,maxValue:360,minValue:0,allowBlank:!1,margin:0,validator:function(e){return null==t.getCmp("SField").getValue()||(e<=360&&t.getCmp("RField").getValue()<=255&&t.getCmp("GField").getValue()<=255&&t.getCmp("BField").getValue()<=255&&t.getCmp("SField").getValue()<=100&&t.getCmp("VField").getValue()<=100&&t.getCmp("AField").getValue()<=100?(t.getCmp("okButton").setDisabled(!1),!0):(t.getCmp("okButton").setDisabled(!0),!0))}}]}},getSliderAndSField:function(e){var a=this.fieldWidth;return{xtype:"container",viewModel:e,cls:t.baseCSSPrefix+"colorpicker-escape-overflow",width:a,layout:{type:"vbox",align:"stretch"},margin:{right:this.fieldPad,left:this.fieldPad},items:[{xtype:"colorpickerslidersaturation",reference:"satSlider",flex:1,bind:{saturation:"{saturation}",hue:"{selectedColor.h}"},width:a,listeners:{handledrag:"onSaturationSliderHandleDrag"}},{xtype:"numberfield",fieldLabel:"S",id:"SField",labelAlign:"top",labelSeparator:"",bind:"{saturation}",hideTrigger:!0,maxValue:100,minValue:0,allowBlank:!1,margin:0,validator:function(e){return null==t.getCmp("VField").getValue()||(e<=100&&t.getCmp("RField").getValue()<=255&&t.getCmp("GField").getValue()<=255&&t.getCmp("BField").getValue()<=255&&t.getCmp("HField").getValue()<=360&&t.getCmp("VField").getValue()<=100&&t.getCmp("AField").getValue()<=100?(t.getCmp("okButton").setDisabled(!1),!0):(t.getCmp("okButton").setDisabled(!0),!0))}}]}},getSliderAndVField:function(e){var a=this.fieldWidth;return{xtype:"container",viewModel:e,cls:t.baseCSSPrefix+"colorpicker-escape-overflow",width:a,layout:{type:"vbox",align:"stretch"},items:[{xtype:"colorpickerslidervalue",reference:"valueSlider",flex:1,bind:{value:"{value}",hue:"{selectedColor.h}"},width:a,listeners:{handledrag:"onValueSliderHandleDrag"}},{xtype:"numberfield",fieldLabel:"V",id:"VField",labelAlign:"top",labelSeparator:"",bind:"{value}",hideTrigger:!0,maxValue:100,minValue:0,allowBlank:!1,margin:0,validator:function(e){return null==t.getCmp("AField").getValue()||(e<=100&&t.getCmp("RField").getValue()<=255&&t.getCmp("GField").getValue()<=255&&t.getCmp("BField").getValue()<=255&&t.getCmp("HField").getValue()<=360&&t.getCmp("SField").getValue()<=100&&t.getCmp("AField").getValue()<=100?(t.getCmp("okButton").setDisabled(!1),!0):(t.getCmp("okButton").setDisabled(!0),!0))}}]}},getSliderAndAField:function(e){var a=this.fieldWidth;return{xtype:"container",viewModel:e,cls:t.baseCSSPrefix+"colorpicker-escape-overflow",width:a,layout:{type:"vbox",align:"stretch"},margin:{left:this.fieldPad},items:[{xtype:"colorpickerslideralpha",reference:"alphaSlider",flex:1,bind:{alpha:"{alpha}",color:{bindTo:"{selectedColor}",deep:!0}},width:a,listeners:{handledrag:"onAlphaSliderHandleDrag"}},{xtype:"numberfield",fieldLabel:"A",id:"AField",labelAlign:"top",labelSeparator:"",bind:"{alpha}",hideTrigger:!0,maxValue:100,minValue:0,allowBlank:!1,margin:0,validator:function(e){return e<=100&&t.getCmp("RField").getValue()<=255&&t.getCmp("GField").getValue()<=255&&t.getCmp("BField").getValue()<=255&&t.getCmp("HField").getValue()<=360&&t.getCmp("SField").getValue()<=100&&t.getCmp("VField").getValue()<=100?(t.getCmp("okButton").setDisabled(!1),!0):(t.getCmp("okButton").setDisabled(!0),!0)}}]}}}),t.define("DS.ENOGantt.DPMGanttAll.colorpick.SelectorController",{override:"Ext.ux.colorpick.SelectorController",onCancel:function(){0==t.getCmp("hexField").getErrors().length&&0==t.getCmp("RField").getErrors().length&&0==t.getCmp("GField").getErrors().length&&0==t.getCmp("BField").getErrors().length&&0==t.getCmp("HField").getErrors().length&&0==t.getCmp("SField").getErrors().length&&0==t.getCmp("VField").getErrors().length&&0==t.getCmp("AField").getErrors().length||(t.getCmp("hexField").setValue("#"+this.getView().getValue().toUpperCase()),t.getCmp("RField").setValue(this.getView().color.r),t.getCmp("GField").setValue(this.getView().color.g),t.getCmp("BField").setValue(this.getView().color.b),t.getCmp("HField").setValue(parseFloat(360*this.getView().color.h).toFixed(2)),t.getCmp("SField").setValue(parseFloat(100*this.getView().color.s).toFixed(2)),t.getCmp("VField").setValue(parseFloat(100*this.getView().color.v).toFixed(2)),t.getCmp("AField").setValue(parseFloat(100*this.getView().color.a).toFixed(2))),this.fireViewEvent("cancel",this.getView())}}),t.define("DS.ENOGantt.DPMGanttAll.scroll.Scroller",{override:"Ext.scroll.Scroller",ensureVisible:function(e,a){var r,n,i,l=this,o=l.getPosition();return e?(e&&e.element&&!e.isElement&&(e=(a=e).element),r=(a=a||{}).highlight,(n=l.getEnsureVisibleXY(e,a)).y===o.y&&n.x===o.x||0!=l.component.selection.isLast()?(r&&l.doHighlight(e,r),i=t.Deferred.getCachedResolved()):(r&&l.on({scrollend:"doHighlight",scope:l,single:!0,args:[e,r]}),i=l.doScrollTo(n.x,n.y,a.animation))):i=t.Deferred.getCachedRejected(),i}}),t.define("DS.ENOGantt.DPMGanttAll.model.Task",{override:"Gnt.model.Task",extend:"Sch.model.Range",alias:"gntmodel.event",normalizeParent:function(){for(var e=this.childNodes,t=0,a=0,r=0,n=0,i=0,l=this.autoCalculatePercentDoneForParentTask,o=this.autoCalculateEffortForParentTask,s=this.autoCalculateCostForParentTask,d=e.length>0,p=!1,c=0;c<e.length;c++){var g=e[c],u=g.isLeaf();if(u||g.normalizeParent(),o&&(t+=g.getEffort("MILLI")),s&&(n+=g.getCost(),i+=g.getActualCost()),l){var h=u?g.getDuration("MILLI")||0:g.childTasksDuration,f=g.getPercentDone()||0;a+=h,r+=u?h*f:g.completedChildTasksDuration,p=p||this.hasUnfinishedMilestone||0===h&&f<100,d=d&&0===h&&f>=100}}if(l){var m=0;this.childTasksDuration=a,this.completedChildTasksDuration=r,this.hasUnfinishedMilestone=p,a>0?100===(m=r/a)&&p&&(m=99):d&&(m=100),this.getPercentDone()!=m&&"FALSE"==this.data.isSummaryTask&&(this.data[this.percentDoneField]=m)}o&&this.getEffort("MILLI")!=t&&(this.data[this.effortField]=this.getUnitConverter().convertMSDurationToUnit(t,this.getEffortUnit())),l&&o&&(this.data[this.actualEffortField]=this.calculateActualEffort()),s&&(this.data[this.actualCostField]=i,this.data[this.costField]=n),this.data[this.costVarianceField]=this.calculateCostVariance(),this.data[this.effortVarianceField]=this.calculateEffortVariance()}})}})});