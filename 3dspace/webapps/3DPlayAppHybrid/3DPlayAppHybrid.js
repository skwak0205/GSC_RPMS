const CACHE_NAME="3DPlay-sw-cache_v1";self.addEventListener("fetch",function(e){e.respondWith(caches.open(CACHE_NAME).then(function(t){return t.match(e.request).then(function(o){return o?(console.log("[SW] Fetch from cache ",e.request.url),o):fetch(e.request).then(function(o){return console.log("[SW] Fetch from network ",e.request.url),t.put(e.request,o.clone()),o}).catch(function(e){throw console.error("[SW] Fetching failed :",e),e})})}))}),self.addEventListener("activate",function(e){console.log("[SW] Activating service worker!"),e.waitUntil(self.clients.claim())}),define("DS/3DPlayAppHybrid/3DPlay-hybrid-services",["UWA/Class","DS/WebappsUtils/WebappsUtils","DS/HybridInfraCore/HybridApp","DS/3DPlayHelper/3DPlayHelper"],function(e,t,o,n){"use strict";var a=e.singleton({init:function(){if(this._parent(),this._player=null,this._topBarProxy=null,window.location.protocol.contains("https"))this._myAppsURL=(window.location.origin+"/enovia/resources/AppsMngt").replace("ifwe","apps").replace("space","apps");else if(window.HybridAppArgs&&window.HybridAppArgs.myAppsURL)this._myAppsURL=window.HybridAppArgs.myAppsURL;else{var e=new URLSearchParams(window.location.search);this._myAppsURL=e.get("myAppsURL")}this._platformServices=window.HybridAppArgs&&window.HybridAppArgs.platformServices||null,this._userDatas=window.HybridAppArgs&&window.HybridAppArgs.userDatas||null},startPlayerWithAsset:function(e){var t=null;if(null===this._player){var o={container:"PlayWeb-Container",input:{asset:e},options:{loading:"autoplay",callbacks:{experience:{ExperienceReady:function(){},dispose:function(){this.hideTopBar()}},asset:{LoadingStarted:function(e){},LoadingFinished:function(e){},LoadingError:function(e){}}}}};o.options=o.options||{},o.options.enopad=o.options.enopad||{},o.options.enopad.offline=!0,o.options.enopad.windowOptions=o.options.enopad.windowOptions||{},o.options.enopad.windowOptions.allowDnD=!1,this._player=new Player3DPlayWeb(o)}else(t=UWA.clone(window.this._player.lastOptions,!0)).input={asset:e},this._player.load(t)},logout:function(){o.__getHttpNativeDelegate().then(function(e){e.execute("logout",null).then(function(e){console.log("logout success",e)},function(e){console.log("logout failure",e)})})},openLocalFile:function(e){var t={filename:e,format:"3dxml",mimetype:"3dxml",type:"3dxml",provider:"FILE",proxyurl:"none"};this.start3DPlayWith(t)},importFile:function(){o.onDeviceReady(function(e){o.addDelegate("DocumentBrowserDelegate").then(function(e){e.execute("showDocumentBrowser",null).then(function(e){console.log("showDocumentBrowser :: onData : ",e),e&&e.DocumentURL?a.openLocalFile(e.DocumentURL):console.log("User has not selected a file")},function(e){console.log("showDocumentBrowser :: onError : ",e)})},console.error)})},getStartupParams:function(){const e=this._myAppsURL;return new Promise(function(t,o){require(["DS/WAFData/WAFData"],function(n){var a={type:"json",timeout:25e3,proxy:"none",onComplete:function(e){console.log("Startup params",e),t(e)},onFailure:function(e){console.log("ERROR : getStartupParams",e),o(e)},onTimeout:function(e){console.log("ERROR : getStartupParams",e),o(e)}};n.authenticatedRequest(e+"/user/startup?cors=true&roles=true",a)})})},getPlatformServices:function(){const e=this._myAppsURL;return new Promise(function(t,n){o.onDeviceReady(function(o){require(["DS/WAFData/WAFData"],function(o){var r={type:"json",timeout:25e3,proxy:"none",onComplete:function(e){a._platformServices=e.platforms[0],t(a._platformServices)},onFailure:function(e){console.log("ERROR : getPlatformServices",e),n(e)},onTimeout:function(e){console.log("ERROR : getPlatformServices",e),n(e)}};o.authenticatedRequest(e+"/api/v1/services",r)})})})},getPlatformById:function(e,t){var o=null;for(let n=0;n<e.length;n++){const a=e[n];if(a.id===t){o=a.url;break}}return"3dpassport"===t&&(o=o.replace("/cas","")),o},displayTopBar:function(){const e=this._myAppsURL,t=(this._userDatas,this._platformServices);require({baseUrl:"../"},["DS/TopFrame/TopFrame","DS/TopBar/TopBar","DS/TopBarProxy/TopBarProxy","DS/SNSearchUX/SearchUX_TopBar","DS/SNInfraUX/SearchCom","DS/3DPlayUtils/PublishToSwym","css!TopFrame/TopFrame.css","css!i3DXCompass/i3DXCompass.css","css!TopBar/TopBar.css"],function(o,n,r,s,i,l){var c={userId:"T4E",userName:"Thomas LECONTE",envId:t.id,tenant:t.id,startupParams:{instantMessaging:[{id:t.id,displayName:t.id,url:a.getPlatformById(t.services,"rtc")}],swym:[{id:t.id,displayName:t.id,url:a.getPlatformById(t.services,"swym")}],search:[{id:t.id,displayName:t.id,url:a.getPlatformById(t.services,"3dsearch")}],cstorage:[{id:t.id,displayName:t.id,url:a.getPlatformById(t.services,"distributedfilestore")}],tagger:[{id:t.id,displayName:t.id,url:a.getPlatformById(t.services,"tagger")}]},brand:"CATIA",appId:"3DPlay",application:"3DPlay",lang:"en",baseImgPath:"../../webapps/i3DXCompass/assets/images",baseHtmlPath:"../plugins/Compass/images/",baseAppletPath:"../../WebClient/",activateInstantMessaging:!1,passportUrl:a.getPlatformById(t.services,"3dpassport"),tagsServerUrl:a.getPlatformById(t.services,"tagger"),myAppsBaseURL:e,activateNewSearch:!0,activateFederatedSearch:!0,searchParams:{enable_search:!0,enable_search_in_this_tab:!1,enable_my_content:!0,enable_advanced_search:!1,enable_tenant_selection:!1,open:function(o){console.log("TopFrameSearch :: open",o);require(["DS/SNResultUX/SNResultMgt","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/SearchUtils","DS/SNInfraUX/SearchCom","DS/SNInfraUX/SearchRessources","DS/UIKIT/Modal","DS/TagNavigator/TagNavigator"],function(n,r,s,i,l,c,p){r.initialize(o.url_settings);var u=o.preferences_wdg,d=s.getResultInitArgs({preferences_wdg:u}),g=u.search_ressources,m=UWA.Utils.getUUID();window.modal=new c({className:"site-reset",closable:!0,header:"<h4>Search results</h4>",footer:'<button type="button" class="btn btn-primary">Open</button> '}).inject(document.querySelector("#PlayWeb-Container")),window.modal.getContent().getElements(".btn").forEach(function(o){o.addEvent("click",function(){require(["DS/i3DXCompass/X3DContent"],function(o){var n=o.getX3DContent().data.items[0];if(console.log("Selected Data",n),void 0===n.objectId)console.log("No physicalid \nOpen default visu"),a._player.load({input:{asset:""}});else{var r={requiredAuth:"passport",physicalid:n.objectId,tenant:n.envId,type:n.objectType,dtype:n.objectType,myAppsUrl:e,_3DPlayDatas:{myAppsUrl:e},serverurl:"3ddrive"==n.serviceId.toLowerCase()?getPlatformById(t.services,"drive"):getPlatformById(t.services,"space"),provider:"3ddrive"==n.serviceId.toLowerCase()?"3DDRIVE":"EV6"};console.log("Prepared asset",r),a.start3DPlayWith(r)}}),window.modal.destroy(),window.modal=null})}),new l(g,function(){UWA.merge(d,{tagnavigatorproxy:d.tagnavigatorproxy,tagger_context_id:"context_search",renderTo:window.modal.getBody(),widget_id:m,resources:this,events:{onReady:function(e){window.modal.show(),p.get6WTagger("context_search").setAsCurrent()}}}),window.searchResultMgt=new n(d);var e=UWA.Utils.getUUID(),t=i.createSocket({socket_id:e});t.addListener("search",function(e){console.log("TopFrameSearch :: search",e)}),t.dispatchEvent("onWdgCreation",{},["searchtopbar_socket_id"]),t.addListener("onSearchWdgUpd",function(e){if(console.log("TopFrameSearch :: onSearchWdgUpd",e),searchResultMgt){var t=s.getResultUpdateArgs({options:e});searchResultMgt.onSearch(t)}}),t.dispatchEvent("toggleProxyFocus",{maximized:!0})})})},isOpen:function(e){return null!=window.modal&&window.modal.isVisible},close:function(e){console.log("TopFrameSearch :: close",e)}},topMenus:{notification:!1,profile:!0,add:function(){console.log("Import button clicked"),a.importFile()},share:!0,home:!1,help:!0},events:{tagger:function(e){console.log("Tagger launched with "+e.value)},search:function(e){console.log("Search launched with "+e.value)},clearSearch:function(){console.log("Clear Search")}},onRightPanelMinimize:function(){console.log("onRightPanelMinimize")}};o.init(c),a._topBarProxy=new r({id:"CommandProvider1"}),a._topBarProxy.setContent({share:[{label:"Publish to Communities",onExecute:function(){console.log("Publish to Communities");var e={ctx:a._player.getCtx()};setTimeout(function(){new l(e)},1e3)}},{label:"Share as Picture",onExecute:function(){console.log("Share as Picture");var e={onSuccess:function(e){var t=e.replace("data:image/png;base64,","");console.log("screenshot succeed!",t)},onFail:function(){console.log("screenshot failed!")}};a._player.getExperience().getScreenShot(e)}}],profile:[{label:"Logout",onExecute:function(){a.logout()}}]}),n.MainMenuBar.setActiveMenuProviders("CommandProvider1")})}});return a});