define("DS/VisuLoaders/ThreeDXResourcesLibrary",["DS/Mesh/ThreeJS_Base"],function(e){"use strict";var r=function(){this.refImages={},this.imagesToRequest=new Map};return r.prototype.addImageToRequest=function(e,r,t){this.imagesToRequest.set(e,{map:r,format:t})},r.prototype.getImageToRequest=function(e){return this.imagesToRequest.get(e)},r.prototype.removeImageToRequest=function(e){this.imagesToRequest.delete(e)},r.prototype.getRequestedUids=function(){var e=[];return this.imagesToRequest.forEach(function(r,t){e.push(t)}),e},r.prototype.getIdFromParameters=function(e){var r="";return void 0!==e.wrapS&&(r+="wS"+e.wrapS),void 0!==e.wrapT&&(r+="wT"+e.wrapT),void 0!==e.anisotropy&&(r+="anis"+e.anisotropy),void 0!==e.minFilter&&(r+="minF"+e.minFilter),void 0!==e.magFilter&&(r+="magF"+e.magFilter),e.borderColor&&(r+="borderColor"+e.borderColor.x+"-"+e.borderColor.y+"-"+e.borderColor.z+"-"+e.borderColor.w),void 0!==e.repeat&&(r+="rpt"+e.repeat.x+"-"+e.repeat.y),void 0!==e.sRGB&&(r+="srgb"+e.sRGB),"id"+r.hashCode()},r.prototype.getIdFromTexture=function(e){var r="";return void 0!==e.wrapS&&(r+="wS"+e.wrapS),void 0!==e.wrapT&&(r+="wT"+e.wrapT),void 0!==e.anisotropy&&(r+="anis"+e.anisotropy),void 0!==e.minFilter&&(r+="minF"+e.minFilter),void 0!==e.magFilter&&(r+="magF"+e.magFilter),e.borderColor&&(r+="borderColor"+e.borderColor.x+"-"+e.borderColor.y+"-"+e.borderColor.z+"-"+e.borderColor.w),void 0!==e.repeat&&(r+="rpt"+e.repeat.x+"-"+e.repeat.y),void 0!==e.sRGB&&(r+="srgb"+e.sRGB),"id"+r.hashCode()},r.prototype.getImage=function(e){var r=this.refImages[e];return r?r.values().next().value:null},r.prototype.addImage=function(e,r){if(!r)return!1;var t=this.getIdFromTexture(r),o=this.refImages[e];return!o&&((o=new Map).set(t,r),this.refImages[e]=o,!0)},r.prototype.removeImage=function(e){delete this.refImages[e]},r.prototype.getTexture=function(e,r){var t=this.getIdFromParameters(r),o=this.refImages[e];return o&&o.has(t)?o.get(t):null},r.prototype.addTexture=function(e,r,t){if(!r)return!1;var o=this.getIdFromParameters(t),a=this.refImages[e];return a||(a=new Map,this.refImages[e]=a),a.set(o,r),this.subscribeToImageLoading(r,a),!0},r.prototype.subscribeToImageLoading=function(r,t){t.forEach(function(t,o,a){if(t===r)return;let i=function(t){r.image=t.image,t.loadEndStatus===e.AssetLoadingStatus.READY&&(r.loadEndStatus=e.AssetLoadingStatus.READY),r.format=t.format,r.type=t.type,r.needsUpdate=!0,t.hdr&&(r.minFilter=t.minFilter,r.magFilter=t.magFilter)};if(t.loadEndStatus==e.AssetLoadingStatus.READY)i(t);else if(t.loadEndStatus!==e.AssetLoadingStatus.LOADING)return;t.onLoadCallbacks.push(i)})},r.prototype.debug=function(){for(var e in console.log("=============== ThreeDXResourcesLibrary ==================="),this.refImages){var r=this.refImages[e];r&&(console.log("image "+e+" :"),r.forEach(function(e,r,t){console.log("["+r+"] = "+e.id+" status "+e.loadEndStatus)}))}console.log("===========================================================")},r});