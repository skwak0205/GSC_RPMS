define("DS/VisuLoaders/XMLV43Loader",["DS/Visualization/ThreeJS_DS","WebappsUtils/WebappsUtils","UWA/Utils","DS/Visualization/Utils","DS/VisuDataAccess/Ox4XHRWithProxyAbstraction","DS/Visualization/Node3D","DS/Visualization/Mesh3D","DS/Visualization/MaterialManager","DS/Visualization/PathElement","DS/Visualization/SceneGraph","DS/SceneGraphNodes/AxisSystemNode","DS/Mesh/Mesh","DS/Visualization/LoaderUtils","DS/VisuLoaders/ThreeDXLoader","DS/VisuLoaders/CGRReader","DS/ZipJS2/ZipJS2","DS/ZipJS/LoaderInflate"],function(e,r,t,a,n,i,l,o,s,d,u,f,c,p,h,m,v){"use strict";var g={TECHREP:{module:"DS/SIMAnimationWebMdl",file:"SIMAnimationRepRefUnstreamer"},CDS:{module:"DS/CATAssemblySolverWeb",file:"CATAsmWebJsonUnstreamer"}};return function(n,l){var d=!1,u=!1,f=n,b=void 0;e.supportedExtensions&&(b=!!e.supportedExtensions.elementIndexUint||void 0);var N,C,x=[],M=!1,D=null,S=void 0!==l?l:null,A=null,R=null,k=null,T=null,y=null,E=!0,w=null,I=4,L=null,W=[],B=!1,U=0,F=0,P=4,V=0,G=[],O=null,X=null,_="TESSELLATED",q=[],j=[],z=((new Date).getTime(),!1),H=!1,$=!1,J=!1,Z=!1,Y=!1,K=!1,Q=null,ee=null,re={},te=[],ae=!0,ne=!1,ie=!1,le=!1,oe=!1,se=!1,de=[],ue=!1,fe={},ce={},pe=null,he=2,me=[],ve={};function ge(e,r,t,a,n,i){if(d)if(document.implementation&&document.implementation.createDocument){var l=new XMLHttpRequest;l.overrideMimeType&&l.overrideMimeType(t),"blob"===r&&(l.responseType="blob"),"arraybuffer"===r&&(l.responseType="arraybuffer"),l.onreadystatechange=function(){if(4===l.readyState)if(0===l.status||200===l.status){if(l.response&&"blob"===l.responseType){var r=new Blob([l.response],{type:t});a(r,e,i)}l.response&&"arraybuffer"===l.responseType?a(l.response,e,i):l.responseXML?a(l.responseXML,e,i):l.responseText?a(l.responseText,e,i):(console.error("XMLV43Loader: Empty or non-existing file ("+e+")"),void 0!==n&&n(e))}else void 0!==n&&n(e)},l.open("GET",e,!0),l.send(null)}else alert("Don't know how to parse XML!"),void 0!==n&&n(e);else{var o=e.replace(/^.*[\\\/]/,""),s=D.find(o);if(s&&V<P)V++,"blob"===r?s.getBlob(t).then(function(r){if(V--,G.length>0){var t=G[0];ge(t.url,t.type,t.mime,t.cbLoad,t.cbError,t.args),G.splice(0,1)}a(r,e,i)}):"arraybuffer"===r?s.getUint8Array(t).then(function(r){if(V--,G.length>0){var t=G[0];ge(t.url,t.type,t.mime,t.cbLoad,t.cbError,t.args),G.splice(0,1)}a(r.slice().buffer,e,i)}):"xml"===r?s.getText().then(function(r){if(V--,G.length>0){var t=G[0];ge(t.url,t.type,t.mime,t.cbLoad,t.cbError,t.args),G.splice(0,1)}try{var l=(new DOMParser).parseFromString(r,"text/xml");a(l,e,i)}catch(r){void 0!==n&&n(e)}}):"string"===r&&s.getRope().then(function(r){if(V--,G.length>0){var t=G[0];ge(t.url,t.type,t.mime,t.cbLoad,t.cbError,t.args),G.splice(0,1)}a(r,e,i)});else if(V>=P)G.push({url:e,type:r,mime:t,cbLoad:a,cbError:n,args:i});else if(void 0!==n&&n(e),G.length>0){var u=G[0];G.splice(0,1),ge(u.url,u.type,u.mime,u.cbLoad,u.cbError,u.args)}}}function be(e){if(e instanceof Object){var r="Error loading 3DXML : "+e.url+"\n";switch(e.type){case"LOAD":case"LOAD_ARCHIVE":r+="Could not load the 3DXML file.";break;case"LOAD_ENTRY":r+="Could not read Zip entries for this 3DXML.";break;case"PARSE":r+="Could not parse XML data.";break;case"REPFORMAT":r+="Rep format is not supported.";break;case"VERSION":r+="This version is not supported.";break;case"REVIEW_MISSING":r+="3DXML file does not contain any review data, only briefcase."}}r+="The model is not found, corrupted or not entirely supported.",console.warn(r)}this.abort=function(){if(x=[],F=0,null!==L){for(var e=0;e<L.length;++e)null!==L[e]&&(L[e].terminate(),L[e].onmessage=null);W=[],B=!1,L=null}w&&(w=null),Ce()},this.load=function(e,r,t,a,n,i,l,o,s,f,c,h,v,g,b,C,w,I,P,V,G,X,q,j,J){M?x.push({url:e,readyCallback:r,progressCallback:a,doneCallback:n,errorCallback:i,filterNavReps:l,refreshTime:o,readDeco:s,newInfra:f,optimizeCurvedPipes:J,primWithBS:c,repWithBS:j,edgeTrans:h,withSG:v,withBlanking:g,sharedBuff:b,nmir:C,ssb:w,sag:I,bagUUID:q,sagInfo:P,uvrWorker:V,iapplicativeContainers:G,processText:X,repWithBS:j,optimizeCurvedPipes:J}):(M=!0,N=e,e instanceof Object&&(N=e.serverurl?e.serverurl:"",N+=e.filename?e.filename:"",e.loaderSettings&&e.loaderSettings.uncompressed&&(d=!!e.loaderSettings.uncompressed,"3DX"!==(_=e.loaderSettings.repType?e.loaderSettings.repType:"CGR")||O||(O=new p))),ae=h,ne=X,ie=b,le=C,O&&(O.setSharedBuffers(ie),O.setNoMeshInRAM(le)),A=function(e){F--,null!==T&&T({loaded:U-F,total:U});(new Date).getTime();S&&S({hack:!0,updateInfinitePlane:!0,budgeted:!!F});for(var r=0;r<de.length;r++){var t=de[r];if(void 0!==t){var a=t.occPath._getRenderableOccurrences();if(a.length){for(var n=0;n<a.length;n++)t.material&&(t.material.force=!0,a[n]._3dxmlMaterial=t.material,a[n].material=t.material),null!==t.visible&&(a[n].visible=t.visible,a[n]._occurrence.visible=t.visible);de[r]=void 0}}}if(F<=0){for(r=0;r<L.length;++r)null!==L[r]&&(L[r].terminate(),L[r].onmessage=null);if(W=[],B=!1,L=null,null!==k){var i=k;Ce(),i()}}},R=r,k=n,T=a,y=i,u=l,z=s,$=c,H=J,j=j,Z=w,Y=I,K=q,P=P,E=V,function(e){if(te=[],e)for(var r in e)te.push(r)}(ee=G),oe=v,se=g,d?ge(e+"/CATMaterialRef.3dxml","xml","text/xml",xe,function(e){xe(null,0,!0)}):(D=new m.fs.FS).importHttpContent(e,{useXHR:!1,useRangeHeader:!1,preventHeadRequest:!0}).then(function(){ge(N+"/CATMaterialRef.3dxml","xml","text/xml",xe,function(e){ge(N+"/CATMaterialDisciplines.3dxml","xml","text/xml",xe,function(e){xe(null,0,!0)})})},i||be))};var Ne=this.load;function Ce(){if(D=null,R=null,k=null,T=null,y=null,N="",U=0,F=0,V=0,G=[],_="TESSELLATED",q=[],j=[],(new Date).getTime(),X&&(X.abort(),X=null),de=[],ue=!1,fe={},ce={},C="",pe=null,he=2,me=[],ve={},M=!1,x.length){var e=x.shift();Ne(e.url,e.readyCallback,e.progressCallback,e.doneCallback,e.errorCallback,e.filterNavReps,e.refreshTime,e.readDeco,e.newInfra,e.primWithBS,e.edgeTrans,e.withSG,e.withBlanking,e.sharedBuff,e.nmir,e.ssb,e.sag,e.uvrWorker,e.iapplicativeContainers,e.processText,e.bagUUID,e.repWithBS,e.optimizeCurvedPipes)}}function xe(e,r,t){if(void 0===t||!t){var a=e.firstChild;if("Model_3dxml"!==a.nodeName)return;for(var n=0;n<a.childNodes.length;n++){var i=a.childNodes[n];if("CATMaterialRef"===i.nodeName)for(var l=0;l<i.childNodes.length;l++){var o=i.childNodes[l];if("CATMatReference"===o.nodeName||"MaterialDomainInstance"===o.nodeName||"MaterialDomain"===o.nodeName){var s=o.getAttribute("id"),d=o.getAttribute("name");switch(o.nodeName){case"CATMatReference":void 0!==fe[s]?fe[s].name=d:fe[s]={name:d};break;case"MaterialDomainInstance":for(var u=0,f=0,c=0;c<o.childNodes.length;c++)"IsAggregatedBy"===(g=o.childNodes[c]).nodeName?u=g.textContent:"IsInstanceOf"===g.nodeName&&(f=g.textContent);fe[s]={parent:u,instance:f},void 0!==fe[u]?fe[u].instance=s:fe[u]={instance:s};break;case"MaterialDomain":var p,h=o.getAttribute("associatedFile"),m=o.getAttribute("format");p=h.split("urn:3DXML:"),h=p[1];var v=!0;for(c=0;c<o.childNodes.length;c++){var g,b=(g=o.childNodes[c]).textContent;if("V_MatDomain"===g.nodeName&&"RENDERING"!==b.toUpperCase()){v=!1;break}}if(!v)break;void 0!==fe[s]?(fe[s].filename=h,fe[s].format=m):fe[s]={filename:h,format:m}}}}}}ge(N+"/CATRepImage.3dxml","xml","text/xml",Me,function(e){ge(N+"/PLMDmtDocument.3dxml","xml","text/xml",Me,function(e){Me(null,0,!0)})})}function Me(e,r,t){if(void 0===t||!t){var a=e.firstChild;if("Model_3dxml"!==a.nodeName)return;for(var n=0;n<a.childNodes.length;n++){var i=a.childNodes[n];if("CATRepImage"===i.nodeName)for(var l=0;l<i.childNodes.length;l++){var o=i.childNodes[l];if("CATRepresentationImage"===o.nodeName){var s=o.getAttribute("id"),d=(o.getAttribute("name"),o.getAttribute("format"),o.getAttribute("associatedFile").split("urn:3DXML:"));ce[s]={filename:d[1],buffer:null}}}}}var u=0;for(var f in ce)ce.hasOwnProperty(f)&&u++;Se(u?u-1:0)}function De(e,r){var t=0,a=null;for(var n in e)if(e.hasOwnProperty(n)){if(t===r){a=n;break}t++}return a}function Se(e){if(-1!==e){var r,t=De(ce,e);if(void 0===ce[t]||void 0===ce[t].filename||""===ce[t].filename)Se(e-1);else{var a=/(?:\.([^.]+))?$/.exec(ce[t].filename)[1],n="image/";"jpg"===a&&(a="jpeg"),n+=a;var i="blob";"dds"===a&&(n="application/octet-stream",i="arraybuffer"),ge(N+"/"+ce[t].filename,i,n,Ae,(r=e,function(){Se(r-1)}),e)}}else{var l=0;for(var o in fe)fe.hasOwnProperty(o)&&l++;Re(l?l-1:0)}}function Ae(e,r,t){var a=De(ce,t);ce[a].buffer=e,Se(t-1)}function Re(e){if(-1!==e){var r=De(fe,e);void 0===fe[r]||void 0===fe[r].filename?Re(e-1):"UVR"!==fe[r].format?ge(N+"/"+fe[r].filename,"xml","text/xml",ke,function(){},e):Re(e-1)}else ge(N+"/Manifest.xml","xml","text/xml",Te)}function ke(e,r,t){var a={shading:"Phong",DiffuseMapWrap:[],DiffuseMapRepeat:[0,0]},n=e.firstChild;if("Osm"===n.nodeName){for(var i=0;i<n.childNodes.length;i++){var l=n.childNodes[i],o="Feature"===l.nodeName&&l.getAttribute("Alias");if(o&&-1!==o.indexOf("RenderingFeature"))for(var s=0;s<l.childNodes.length;s++){var d=l.childNodes[s];if("Attr"===d.nodeName){var u=d.getAttribute("Type"),f=d.getAttribute("Value"),c=d.getAttribute("Name");switch(u){case"int":switch(f=parseInt(f,10),a[c]=f,c){case"WrappingModeU":f&&(a.DiffuseMapWrap[0]="repeat",a.DiffuseMapRepeat[0]=1);break;case"WrappingModeV":f&&(a.DiffuseMapWrap[1]="repeat",a.DiffuseMapRepeat[1]=1);break;case"PreviewType":switch(parseInt(f)){case 0:a.mappingFunction="SPHERICAL_ENV_MAP";break;case 2:a.mappingFunction="USER_MAPPING"}}break;case"double":switch(c){case"DiffuseColor":a.colorDiffuse=Ue(f);break;case"SpecularColor":a.colorSpecular=Ue(f);break;case"AmbientColor":a.colorAmbient=Ue(f);break;case"SpecularExponent":a.shininess=128*parseFloat(f);break;case"SpecularCoef":a.specularCoef=parseFloat(f);break;case"Reflectivity":a.reflectivityCoef=parseFloat(f);break;case"Transparency":a.transparency=parseFloat(f),a.transparent=a.transparency>0}break;case"boolean":switch(f="true"===f,c){case"AlphaTest":a.alphaTest=f?.5:0;break;default:a[c]=f}break;case"external":var p=[];p=f.split("urn:3DXML:"),p=(f=p[1]).split("#"),f=p[0];var h=p[1];"TextureImage"===c&&ce[h]&&ce[h].buffer&&(a.DiffuseMap=ce[h])}}}}if(void 0!==t){var m=De(fe,t);void 0===fe[m]&&(fe[m]={}),a.type="material3DXML",fe[m].params=a}Re(t-1)}else Re(t-1)}function Te(e,r){var t=e.firstChild;if(t&&t.childNodes)for(var a=0;a<t.childNodes.length;a++){var n=t.childNodes[a];switch(n.nodeName){case"Root":C=n.textContent}}ge(N+"/"+C,"xml","text/xml",ye,function(e){var r=y||be;r&&r({url:e,type:"REVIEW_MISSING"})})}function ye(n,l){var o=n.firstChild;if(o&&"Model_3dxml"===o.nodeName){for(var s=0;s<o.childNodes.length;s++)if("Header"!==(te=o.childNodes[s]).nodeName){if("ProductStructure"===te.nodeName){var d=te.getAttribute("root");for(H=0;H<te.childNodes.length;H++)if("Reference3D"===(ce=te.childNodes[H]).nodeName||"Instance3D"===ce.nodeName||"ReferenceRep"===ce.nodeName||"InstanceRep"===ce.nodeName){var f=ce.getAttribute("id"),p=ce.getAttribute("name"),h=new i;switch(ce.nodeName){case"Reference3D":void 0===me[f]?me[f]=h:h=me[f];var m=d===f&&null===pe;m&&(pe=h);for(var v=0;v<ce.childNodes.length;v++){var b=ce.childNodes[v];if(m&&"Extension"===b.nodeName)for(var C=0;C<b.childNodes.length;C++){var x=b.childNodes[C];"V_WorldOrientation"===x.nodeName&&(he=parseInt(x.textContent,10))}else"V_Name"===b.nodeName&&(p=b.textContent)}break;case"Instance3D":case"InstanceRep":me[f]=h;var M="",D="",A=null;for(v=0;v<ce.childNodes.length;v++)if("IsAggregatedBy"===(b=ce.childNodes[v]).nodeName)M=b.textContent;else if("IsInstanceOf"===b.nodeName)D=b.textContent;else if("RelativeMatrix"===b.nodeName){var P=Pe(b.textContent);null===A&&(A=new e.Matrix4),A.set(P[0],P[3],P[6],P[9],P[1],P[4],P[7],P[10],P[2],P[5],P[8],P[11],0,0,0,1)}else"V_Name"===b.nodeName&&(p=b.textContent);null!==A&&(h._matrix=A),""!==M&&""!==D&&(void 0===me[M]&&(me[M]=new i),me[M].addChild(h),void 0===me[D]&&(me[D]=new i),h.addChild(me[D]));break;case"ReferenceRep":for(void 0===me[f]?me[f]=h:h=me[f],v=0;v<ce.childNodes.length;v++)"V_Name"===(b=ce.childNodes[v]).nodeName&&(p=b.textContent);D="";var V,G=ce.getAttribute("format");G&&"string"==typeof G&&(V=G.toUpperCase());var O,X=ce.getAttribute("associatedFile");"UVR"!==V&&"TESSELLATED"!==V||("3DX"===_?G="3DX":"CGR"===_?G="CGR":(G=V,_=V)),O=X.split("urn:3DXML:");var z={file:X=O[1],format:G,node:h};void 0!==q[X]?q[X].push(h):(q[X]=[h],"ifc"!==a.getExtension(X)&&j.push(z)),ve[h.id]=z}h.name=p,h.productType=ce.nodeName,h.persistentId=f,h.getPersistentId=function(){return this.persistentId}}}}else for(var H=0;H<te.childNodes.length;H++)if("SchemaVersion"===(ce=te.childNodes[H]).nodeName&&ce.textContent.substring(0,1)<4){var Z=y||be;return void(Z&&Z({url:l,type:"VERSION"}))}for(s=0;s<o.childNodes.length;s++)if("DefaultView"===(te=o.childNodes[s]).nodeName)for(H=0;H<te.childNodes.length;H++)"DefaultViewProperty"===(ce=te.childNodes[H]).nodeName&&Ee(ce);for(s=0;s<o.childNodes.length;s++){var te;if("CATMaterial"===(te=o.childNodes[s]).nodeName)for(H=0;H<te.childNodes.length;H++){var ce;"CATMatConnection"===(ce=te.childNodes[H]).nodeName&&we(ce)}}}if(u&&pe&&pe.traverse(function(e,r){var t=r.indexOf(e);if(-1!==t){r.splice(t,1),"ReferenceRep"===e.productType&&ve[e.id]&&(console.log(ve[e.id]),-1!==(t=j.indexOf(ve[e.id]))&&j.splice(t,1));for(var a=0;a<e.children.length;a++)r.push(e.children[a]);return!1}if("Reference3D"===e.productType){var n=[],i=!1;for(a=0;a<e.children.length;a++){var l=e.children[a];i=i||"Instance3D"===l.productType,"InstanceRep"===l.productType&&n.push(l)}if(i)for(a=0;a<n.length;a++)r.push(n[a])}return!1},new Array),ge(N+"/ProductCDS.json","string","text/string",function(e,r){var t=g.CDS.module+"/"+g.CDS.file;require([t],function(r){var t=new r;t.unstream(e)},function(e){var t=e.requireModules&&e.requireModules[0];console.log("Module "+t+" is missing.");var a=y||be;a&&a({url:r,type:"LOAD_ENTRY"})})},function(){}),j.length)!function(){if(ue){for(var e=0;e<de.length;e++){var n=de[e];if(void 0!==n&&n.matrix){var i=n.occPath._getOccurrences();if(i.length)for(var l=0;l<i.length;l++)i[l]._relativeMatrix=n.matrix}}pe&&pe._updateMatrix()}if("3DX"!==_){if(null!==L){for(var e=0;e<I;++e)L[e].terminate();L[e].onmessage=null}L=null,W=[],B=!1;var o="";if(E||"TESSELLATED"===_)if(null===L){var s=t.matchUrl(r.getWebappsBaseUrl(),window.location)?null:"Passport",d=[],u={provider:"FILE",filename:"AmdLoader.js",serverurl:r.getWebappsBaseUrl()+"AmdLoader/",module:"AmdLoader",requiredAuth:s},f={provider:"FILE",filename:"EasySax.js",serverurl:r.getWebappsBaseUrl()+"EasySax/",module:"EasySax",requiredAuth:s},p={provider:"FILE",filename:"ThreeJS_Base.js",serverurl:r.getWebappsBaseUrl()+"Mesh/",module:"Mesh",requiredAuth:s},h={provider:"FILE",filename:"Mesh.js",serverurl:r.getWebappsBaseUrl()+"Mesh/",module:"Mesh",requiredAuth:s},m={provider:"FILE",filename:"CGRFile.js",serverurl:r.getWebappsBaseUrl()+"Formats/",module:"Formats",requiredAuth:s};"UVR"===_||"CGR"===_?(o={provider:"FILE",filename:"CGRWorkerNewInfra.js",serverurl:r.getWebappsBaseUrl()+"Workers/",module:"Workers",requiredAuth:s},(d=[u,p,h,m,o]).realWorkerUrl=r.getWebappsBaseUrl()+"Workers/CGRWorkerNewInfra.js"):"TESSELLATED"===_&&(o={provider:"FILE",filename:"XMLV43Worker.js",serverurl:r.getWebappsBaseUrl()+"Workers/",module:"Workers",requiredAuth:s},(d=[u,f,p,h,o]).realWorkerUrl=r.getWebappsBaseUrl()+"Workers/XMLV43Worker.js"),a.getWorkerBlobFromSpecs(d,function(e){L=[];for(var r={processText:ne,edgeTransparency:ae,sharedBuffers:ie,noMeshInRAM:le,primitiveWithBS:$,withBlanking:se,repWithBS:J,withSAG:Y,sagInfo:Q,withBagUUID:K},t=0;t<I;++t)L[t]=new Worker(e);for(var t=0;t<I;++t)!function(e){L[e].onmessage=function(t){var a=t.data;if(a.loaded)W.push(e),B||(B=!0,Be(R));else{var n=q[a.node];F--,a.CGR&&(r.fromCGR=!0),c.processData(n,a,{materialLibrary:fe,baseUrl:N},oe,r,function(e){a.applicativesContainers&&Le(a.applicativesContainers,ee,n),null!==T&&T({loaded:U-F,total:U});(new Date).getTime();S&&S({hack:!0,updateInfinitePlane:!0,budgeted:!!F});for(var r=0;r<de.length;r++){var t=de[r];if(void 0!==t){var i=t.occPath._getRenderableOccurrences();if(i.length){for(var l=0;l<i.length;l++)t.material&&(t.material.force||(t.material.force=!0),i[l]._3dxmlMaterial=t.material,i[l].material=t.material),null!==t.visible&&(i[l].visible=t.visible,i[l]._occurrence.visible=t.visible);de[r]=void 0}}}if(F<=0){if(null!==L)for(var r=0;r<L.length;++r)null!==L[r]&&(L[r].terminate(),L[r].onmessage=null);if(w&&(w=null),W=[],B=!1,L=null,null!==k){var o=k;if(Ce(),o(),ee)for(var s in ee)ee[s].doneCallback&&(re&&re[s]&&ee[s].doneCallback?ee[s].doneCallback(re[s]):ee[s].doneCallback([]))}}})}}}(t)})}else B&&Be(R);else w?Be(R):require(["DS/Formats/CGRFile"],function(e){w=e,Be(R)},function(e){var r=e.requireModules&&e.requireModules[0];console.log("Module "+r+" is missing."),y&&y()})}else Be(R)}();else{var Ne=k;Ce(),Ne()}}function Ee(r){for(var t=[],a=!0,n=!1,i=null,l=null,d=new e.Color,u=1,f=0;f<r.childNodes.length;f++){var c=r.childNodes[f];if("OccurenceId"===c.nodeName){for(var p=0;p<c.childNodes.length;p++)if("id"===(v=c.childNodes[p]).nodeName){var h="",m=[];(m=(h=(m=v.textContent.split("urn:3DXML:"))[1]).split("#"))[0],h=m[1],void 0===me[h]||0!==t.length&&me[h]===t[t.length-1]||t.push(me[h])}}else if("GraphicProperties"===c.nodeName)for(p=0;p<c.childNodes.length;p++){var v;if("SurfaceAttributes"===(v=c.childNodes[p]).nodeName)for(var g=0;g<v.childNodes.length;g++){var b=v.childNodes[g];if("Color"===b.nodeName&&(n=!0,d.r=parseFloat(b.getAttribute("red")),d.g=parseFloat(b.getAttribute("green")),d.b=parseFloat(b.getAttribute("blue")),b.getAttribute("alpha")&&(u=parseFloat(b.getAttribute("alpha"))),-1===d.r))return}else"GeneralAttributes"===v.nodeName&&v.getAttribute("visible")&&(a="true"===v.getAttribute("visible"))}else if("RelativePosition"===c.nodeName){var N=Pe(c.textContent);(l=new e.Matrix4).set(N[0],N[3],N[6],N[9],N[1],N[4],N[7],N[10],N[2],N[5],N[8],N[11],0,0,0,1)}}n&&((i=(new o).getMaterialFromGAS({color:d,opacity:u})).force="forceGeomTypeFACE");for(var C=t.length>0,x=[],M=t.length-1;C&&0!==M;){for(var D=t[M],S=t[M-1];D!==S;){x.unshift(D);var A=D.getParents();if(A.length>1||0===A.length){C=!1;break}D=A[0]}M--}C&&(x.unshift(t[0]),de.push({occPath:new s(x),material:i,matrix:l,visible:a})),l&&(ue=!0)}function we(e){e.getAttribute("id"),e.getAttribute("name");for(var r="",t=[],a=null,n=0;n<e.childNodes.length;n++){var i=e.childNodes[n];if("IsAggregatedBy"===i.nodeName)i.textContent;else if("PLMRelation"===i.nodeName)for(var l=0;l<i.childNodes.length;l++){var o=i.childNodes[l];if("C_Role"===o.nodeName)r=o.textContent;else if("Ids"===o.nodeName)for(var d=0;d<o.childNodes.length;d++){var u=o.childNodes[d];if("id"===u.nodeName)if("CATMaterialMadeOfLink"===r||"CATMaterialDressByLink"===r)void 0===me[u.textContent]||0!==t.length&&me[u.textContent]===t[t.length-1]||(t.push(me[u.textContent]),void 0!==me[u.textContent].children[0]&&t.push(me[u.textContent].children[0]));else if("CATMaterialToReferenceLink"===r){var f=[],c=(f=u.textContent.split("urn:3DXML:"))[1];a={file:(f=c.split("#"))[0],id:c=f[1]}}}}}null!==a&&de.push({occPath:new s(t),material:Fe(a.id),visible:null})}var Ie=function(e){var r,t,a,n,i,l;for(r="",a=e.length,t=0;t<a;)switch((n=e[t++])>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:r+=String.fromCharCode(n);break;case 12:case 13:i=e[t++],r+=String.fromCharCode((31&n)<<6|63&i);break;case 14:i=e[t++],l=e[t++],r+=String.fromCharCode((15&n)<<12|(63&i)<<6|(63&l)<<0)}return r},Le=function(e,r,t){if(r&&e)for(var a in r){var n=r[a].errorCallback,i=r[a].binaryOutput;if(e[a]){var l=e[a];if(i){re[a]||(re[a]=[]);for(var o=0;o<t.length;o++)re[a].push({node:t[o],data:l})}else{if(!l){n(),delete r[a];continue}var s=l.buffer.subarray(l.options.offset,l.options.compressed+l.options.offset);if(s.length<=2){n(),delete r[a];continue}if(120!==s[0]){n(),delete r[a];continue}if(218!==s[1]){n(),delete r[a];continue}var d=s.subarray(2,l.options.compressed),u=(new v).Inflate(d),f=Ie(u);for(re[a]||(re[a]=[]),o=0;o<t.length;o++)re[a].push({node:t[o],xml:f})}}}};function We(){if(F--,T&&T({loaded:U-F,total:U}),0===F){if(null!==L){for(var e=0;e<L.length;++e)null!==L[e]&&(L[e].terminate(),L[e].onmessage=null);W=[],B=!1,L=null}if(w&&(w=null),k){var r=k;if(Ce(),r(),ee)for(var t in ee)ee[t].doneCallback&&(re&&re[t]&&ee[t].doneCallback?ee[t].doneCallback(re[t]):ee[t].doneCallback([]))}}}function Be(e){F=j.length,U=F;for(var r=0;r<j.length;r++){var t=j[r],a=t.file,n=t.format,l=t.node;if(void 0!==a){var o=N+"/"+a,s=o,u=q[a];if(""!==a)if("3DX"===n)s+=".3dxc",O.load({url:s,concat:!0,zipped:!1,primitives:!0,reps:!0,ssb:!1,destinationNodes:u,readyCallback:function(e){F--,null!==T&&T({loaded:U-F,total:U});(new Date).getTime();if(S&&S({hack:!0,updateInfinitePlane:!0,budgeted:!!F}),F<=0&&null!==k){var r=k;Ce(),r()}},gasSharing:!0});else if(!E&&w&&"UVR"===n)!function(e,r){ge(o,"arraybuffer","text/plain",function(r){var t={processText:ne,fromCGR:!0,edgeTransparency:ae,sharedBuffers:ie,noMeshInRAM:le,primitiveWithBS:$,withBlanking:se,repWithBS:J,withSAG:Y,sagInfo:Q,withBagUUID:K},a=new Uint8Array(r),n=new w([],!1,$,oe,b,Z,Y,ne,Q,K,J,H,se);n.setFileBuffer(a);var i=n.open(),l=q[e];F--,c.processData(l,i,{materialLibrary:fe,baseUrl:N},void 0,t)})}(a);else if(L)switch(n){case"UVR":case"CGR":"CGR"===n&&(s=s.replace(".3DRep",".cgr"));var p={renderCallback:null,readyCallback:A,doneCallback:null,errorCallback:function(){We(),y()},progressCallback:T};if(d){X||(X=new h(f,null,{keepLoader:!0}));var m={isBuffer:!1,destination:u[0],readDeco:z,optimizeCurvedPipes:H,primWithBS:$,withBlanking:se,repWithBS:J,smartStaticBatching:Z,withSAG:Y,withBagUUID:K,sagInfo:Q,edgeTransparency:ae,sharedBuffers:ie,noMeshInRAM:le,withSceneGraph:oe};X.load({serverurl:s},p,m)}else!function(e,r){ge(o,"arraybuffer","text/plain",function(t,a){var n=W[r%W.length];L&&L[n].postMessage({inputFile:t,node:e,readDecoration:z,primitiveWithBS:$,withBlanking:se,repWithBS:J,smartStaticBatching:Z,withSAG:Y,withBagUUID:K,sagInfo:Q,applicativesContainers:te,withSceneGraph:oe,uint32Index:b,processText:ne,uvr:!0,optimizeCurvedPipes:H},[t])})}(a,r);break;case"TESSELLATED":!function(e,r){ge(o,"string","text/plain",function(t,a){var n=W[r%W.length];L&&L[n].postMessage({path:t,node:e,uint32Index:b})},function(e){var r=y||be;We(),r&&r({url:e,type:"LOAD_ENTRY"})})}(a,r);break;default:g[n]?function(e,r,t){ge(o,"xml","text/xml",function(a,n){var i=g[r].module+"/"+g[r].file;require([i],function(r){(new r).unstream(a,e,t),We()},function(e){var r=e.requireModules&&e.requireModules[0];console.log("Module "+r+" is missing.");var t=y||be;We(),t&&t({url:n,type:"REPFORMAT"})})},function(e){var r=y||be;We(),r&&r({url:e,type:"REPFORMAT"})})}(a,n,l):We()}else We()}}e&&(null===pe&&(pe=new i),e(pe,he))}function Ue(e){var r=[],t=new RegExp(/\[([0,1]|(?:[0-9]?\.[0-9]*(?:[eE][-+][0-9]+)?)),([0,1]|(?:[0-9]?\.[0-9]*(?:[eE][-+][0-9]+)?)),([0,1]|(?:[0-9]?\.[0-9]*(?:[eE][-+][0-9]+)?))\]/),a=t.exec(e);return null!==a?(r[0]=parseFloat(RegExp.$1),r[1]=parseFloat(RegExp.$2),r[2]=parseFloat(RegExp.$3)):null!==(a=(t=new RegExp(/\[([0,1]|(?:[0-9]?\.[0-9]*(?:[eE][-+][0-9]+)?)),([0,1]|(?:[0-9]?\.[0-9]*(?:[eE][-+][0-9]+)?)),([0,1]|(?:[0-9]?\.[0-9]*(?:[eE][-+][0-9]+)?)),([0,1]|(?:[0-9]?\.[0-9]*(?:[eE][-+][0-9]+)?))\]/)).exec(e))&&(r[0]=parseFloat(RegExp.$1),r[1]=parseFloat(RegExp.$2),r[2]=parseFloat(RegExp.$3),r[3]=parseFloat(RegExp.$4)),r}function Fe(r){var t=new o,a=fe[r];if(void 0===a)return null;var n=fe[a.instance];if(void 0===n)return null;var i=fe[n.instance];return void 0===i?null:(void 0===i.material&&void 0!==i.params?(i.material=t.getMaterial3DXML(i.params,N,"XMLV43"),i.material.force=!0):void 0===i.params&&(i.material=e.MaterialUtils.createMatteFaceMaterial(),i.material.force=!0),i.material)}function Pe(e){for(var r=function(e){return e.length>0?function(e){return e.replace(/^\s+/,"").replace(/\s+$/,"")}(e).split(/\s+/):[]}(e),t=[],a=0,n=r.length;a<n;a++)t.push(parseFloat(r[a]));return t}}});