define("DS/VisuLoaders/OBJMTLLoader",["DS/Visualization/ThreeJS_DS","DS/Visualization/Utils","DS/VisuLoaders/MTLLoader","DS/Visualization/ProxyAbstraction"],function(e,r,t,s){"use strict";var a=function(r){e.EventDispatcher.call(this),this.preserveOrder=!(!r||!r.preserveOrder)&&r.preserveOrder};return a.prototype={constructor:e.OBJMTLLoader,load:function(a,n,i){var d=this,o=new s;r.setProxyFromSpec(a,o);var l,c,u,p=a.serverurl?a.serverurl:"";p+=a.filename?a.filename:"";var f=new t(p.substr(0,p.lastIndexOf("/")+1),i);function v(r){if("load"===r.type)r.content instanceof t.MaterialCreator&&(l=!0,(u=r.content).preload());else if("error"===r.type)l=!0;else{var s=r;c=n?d.parse(s):d.parse(s,function(e){l=!1,f.load(f.baseUrl+e)})}l&&c&&(u&&c.traverse(function(r){if(r instanceof e.Mesh&&r.material.name){var t=u.create(r.material.name);t&&(r.material=t)}}),d.dispatchEvent({type:"load",content:c}))}f.addEventListener("load",v),f.addEventListener("error",v),n?(f.load(n),l=!1):l=!0,o.executeGetHttpRequest(p,"text",null,v,function(){d.dispatchEvent({type:"error",message:"Couldn't load URL ["+p+"]"})})},parse:function(r,t){r=r.replace(/\ \\\r\n/g,"");var s=this;function a(r,t,s){return new e.Vector3(r,t,s)}function n(r,t,s,a){return new e.Face3(r,t,s,a)}function i(r,t,s,a,n){return new e.Face4(r,t,s,a,n)}function d(r,t){h.vertices.length>0&&(s.preserveOrder||h.mergeVertices(),h.computeCentroids(),h.computeFaceNormals(),s.preserveOrder&&0===h.faces[0].vertexNormals.length&&h.computeVertexNormals(),h.computeBoundingSphere(),v.add(x),h=new e.Geometry,x=new e.Mesh(h,m),g=0),void 0!==r&&(x.name=r),void 0!==t&&((m=new e.MeshLambertMaterial).name=t,x.material=m)}function o(e){return parseInt(e)-1}function l(e,r,t,a){var i=o(e),d=o(r),l=o(t);s.preserveOrder?h.faces.push(n(i,d,l,a)):(h.vertices.push(L[i],L[d],L[l]),h.faces.push(n(g++,g++,g++,a)))}function c(e,r,t,a,n){var d=o(e),l=o(r),c=o(t),u=o(a);s.preserveOrder?h.faces.push(i(d,l,c,u,n)):(h.vertices.push(L[d],L[l],L[c],L[u]),h.faces.push(i(g++,g++,g++,g++,n)))}for(var u,p,f=new e.Object3D,v=f,h=new e.Geometry,m=new e.MeshLambertMaterial,x=new e.Mesh(h,m),L=s.preserveOrder?h.vertices:[],g=0,w=[],O=[],V=/v( +[\d|\.|\+|\-|e]+)( +[\d|\.|\+|\-|e]+)( +[\d|\.|\+|\-|e]+)/,b=/vn( +[\d|\.|\+|\-|e]+)( +[\d|\.|\+|\-|e]+)( +[\d|\.|\+|\-|e]+)/,F=/vt( +[\d|\.|\+|\-|e]+)( +[\d|\.|\+|\-|e]+)/,M=/f( +\d+)( +\d+)( +\d+)( +\d+)?/,y=/f( +(\d+)\/(\d+))( +(\d+)\/(\d+))( +(\d+)\/(\d+))( +(\d+)\/(\d+))?/,D=/f( +(\d+)\/(\d+)\/(\d+))( +(\d+)\/(\d+)\/(\d+))( +(\d+)\/(\d+)\/(\d+))( +(\d+)\/(\d+)\/(\d+))?/,S=/f( +(\d+)\/\/(\d+))( +(\d+)\/\/(\d+))( +(\d+)\/\/(\d+))( +(\d+)\/\/(\d+))?/,U=r.split("\n"),E=0;E<U.length;E++){var T,B=U[E];if(0!==(B=B.trim()).length&&"#"!==B.charAt(0))if(null!==(T=V.exec(B)))L.push(a(parseFloat(T[1]),parseFloat(T[2]),parseFloat(T[3])));else if(null!==(T=b.exec(B)))w.push(a(parseFloat(T[1]),parseFloat(T[2]),parseFloat(T[3])));else if(null!==(T=F.exec(B)))O.push((u=parseFloat(T[1]),p=parseFloat(T[2]),new e.Vector2(u,p)));else if(null!==(T=M.exec(B)))void 0===T[4]?l(T[1],T[2],T[3]):c(T[1],T[2],T[3],T[4]);else if(null!==(T=y.exec(B)))void 0===T[10]?(l(T[2],T[5],T[8]),h.faceVertexUvs[0].push([O[o(T[3])],O[o(T[6])],O[o(T[9])]])):(c(T[2],T[5],T[8],T[11]),h.faceVertexUvs[0].push([O[o(T[3])],O[o(T[6])],O[o(T[9])],O[o(T[12])]]));else if(null!==(T=D.exec(B)))void 0===T[13]?(l(T[2],T[6],T[10],[w[o(T[4])],w[o(T[8])],w[o(T[12])]]),h.faceVertexUvs[0].push([O[o(T[3])],O[o(T[7])],O[o(T[11])]])):(c(T[2],T[6],T[10],T[14],[w[o(T[4])],w[o(T[8])],w[o(T[12])],w[o(T[16])]]),h.faceVertexUvs[0].push([O[o(T[3])],O[o(T[7])],O[o(T[11])],O[o(T[15])]]));else if(null!==(T=S.exec(B)))void 0===T[10]?l(T[2],T[5],T[8],[w[o(T[3])],w[o(T[6])],w[o(T[9])]]):c(T[2],T[5],T[8],T[11],[w[o(T[3])],w[o(T[6])],w[o(T[9])],w[o(T[12])]]);else if(/^o /.test(B))(v=new e.Object3D).name=B.substring(2).trim(),f.add(v);else if(/^g /.test(B))d(B.substring(2).trim(),void 0);else if(/^usemtl /.test(B))d(void 0,B.substring(7).trim());else if(/^mtllib /.test(B)){if(t){var J=B.substring(7);t(J=J.trim())}}else/^s /.test(B)||console.log("THREE.OBJMTLLoader: Unhandled line "+B)}return d(void 0,void 0),f}},a});