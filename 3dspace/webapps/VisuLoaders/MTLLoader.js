define("DS/VisuLoaders/MTLLoader",["DS/Visualization/ThreeJS_DS"],function(e){"use strict";var t=function(t,r){e.EventDispatcher.call(this),this.baseUrl=t,this.options=r};return t.prototype={load:function(e){var t=this,r=new XMLHttpRequest;r.addEventListener("load",function(r){if(200===r.target.status||0===r.target.status){var s=t.parse(r.target.responseText);t.dispatchEvent({type:"load",content:s})}else t.dispatchEvent({type:"error",message:"Couldn't load URL ["+e+"]",response:r.target.responseText})},!1),r.addEventListener("progress",function(e){t.dispatchEvent({type:"progress",loaded:e.loaded,total:e.total})},!1),r.addEventListener("error",function(){t.dispatchEvent({type:"error",message:"Couldn't load URL ["+e+"]"})},!1),r.open("GET",e,!0),r.send(null)},parse:function(e){for(var r=e.split("\n"),s={},a=/\s+/,i={},n=0;n<r.length;n++){var o=r[n];if(0!==(o=o.trim()).length&&"#"!==o.charAt(0)){var h=o.indexOf(" "),l=h>=0?o.substring(0,h):o;l=l.toLowerCase();var p=h>=0?o.substring(h+1):"";if(p=p.trim(),"newmtl"===l)s={name:p},i[p]=s;else if(s)if("ka"===l||"kd"===l||"ks"===l){var d=p.split(a,3);s[l]=[parseFloat(d[0]),parseFloat(d[1]),parseFloat(d[2])]}else s[l]=p}}var c=new t.MaterialCreator(this.baseUrl,this.options);return c.setMaterials(i),c}},(t.MaterialCreator=function(t,r){e.EventDispatcher.call(this),this.baseUrl=t,this.options=r,this.materialsInfo={},this.materials={},this.materialsArray=[],this.nameLookup={},this.side=this.options&&this.options.side?this.options.side:e.FrontSide,this.wrap=this.options&&this.options.wrap?this.options.wrap:e.RepeatWrapping}).prototype={setMaterials:function(e){this.materialsInfo=this.convert(e),this.materials={},this.materialsArray=[],this.nameLookup={}},convert:function(e){if(!this.options)return e;var t={};for(var r in e){var s=e[r],a={};for(var i in t[r]=a,s){var n=!0,o=s[i],h=i.toLowerCase();switch(h){case"kd":case"ka":case"ks":this.options&&this.options.normalizeRGB&&(o=[o[0]/255,o[1]/255,o[2]/255]),this.options&&this.options.ignoreZeroRGBs&&0===o[0]&&0===o[1]&&0===o[1]&&(n=!1);break;case"d":this.options&&this.options.invertTransparency&&(o=1-o)}n&&(a[h]=o)}}return t},preload:function(){for(var e in this.materialsInfo)this.create(e)},getIndex:function(e){return this.nameLookup[e]},getAsArray:function(){var e=0;for(var t in this.materialsInfo)this.materialsArray[e]=this.create(t),this.nameLookup[t]=e,e++;return this.materialsArray},create:function(e){return void 0===this.materials[e]&&this.createMaterial_(e),this.materials[e]},createMaterial_:function(r){var s=this.materialsInfo[r],a={name:r,side:this.side};for(var i in s){var n=s[i];switch(i.toLowerCase()){case"kd":a.diffuse=(new e.Color).setRGB(n[0],n[1],n[2]);break;case"ka":a.ambient=(new e.Color).setRGB(n[0],n[1],n[2]);break;case"ks":a.specular=(new e.Color).setRGB(n[0],n[1],n[2]);break;case"map_kd":a.map=t.loadTexture(this.baseUrl+n),a.map.wrapS=this.wrap,a.map.wrapT=this.wrap;break;case"ns":a.shininess=n;break;case"d":n<1&&(a.transparent=!0,a.opacity=n)}}return a.diffuse&&(a.ambient||(a.ambient=a.diffuse),a.color=a.diffuse),this.materials[r]=new e.MeshPhongMaterial(a),this.materials[r]}},t.loadTexture=function(r,s,a,i){if(/\.dds$/i.test(r))var n=e.ImageUtils.loadCompressedTexture(r,s,a,i);else{var o=new Image,h=(n=new e.Texture(o,s),new e.ImageLoader);h.addEventListener("load",function(e){n.image=t.ensurePowerOfTwo_(e.content),n.needsUpdate=!0,a&&a(n)}),h.addEventListener("error",function(e){i&&i(e.message)}),h.crossOrigin=this.crossOrigin,h.load(r,o)}return n},t.ensurePowerOfTwo_=function(e){if(!t.isPowerOfTwo_(e.width)||!t.isPowerOfTwo_(e.height)){var r=document.createElement("canvas");return r.width=t.nextHighestPowerOfTwo_(e.width),r.height=t.nextHighestPowerOfTwo_(e.height),r.getContext("2d").drawImage(e,0,0,e.width,e.height,0,0,r.width,r.height),r}return e},t.isPowerOfTwo_=function(e){return 0==(e&e-1)},t.nextHighestPowerOfTwo_=function(e){--e;for(var t=1;t<32;t<<=1)e|=e>>t;return e+1},t});