define("DS/SearchWidget/SearchWidgetConstant",[],function(){return{TYPE_FULL:"all",TYPE_PERSON:"user",TYPE_PROJECT:"collabspace",TYPE_ORGANIZATION:"org",EXTTYPE_USERGRP:"userGrp"}}),define("DS/SearchWidget/models/SW_ItemModel",["UWA/Controls/Abstract"],function(e){"use strict";return e.extend({init:function(e){for(var t in this.itemTitle="",this.itemId="",this.itemIcon="",this.isSW_ItemModel=!0,e)this[t]=e[t]},getTitle:function(){return this.itemTitle},getId:function(){return this.itemId},getIcon:function(){return this.itemIcon},setTitle:function(e){this.itemTitle=e},setId:function(e){this.itemId=e},setIcon:function(e){this.itemIcon=e}})}),define("DS/SearchWidget/componentUI/SearchWidgetUI",["UWA/Core","UWA/Controls/Abstract","UWA/Json","DS/WidgetServices/WidgetServices","DS/UIKIT/Spinner","DS/UIKIT/Input/Text","DS/UIKIT/Input/Button","DS/UIKIT/Scroller","i18n!DS/SearchWidget/assets/nls/langSW"],function(e,t,n,i,r,o,s,a,l){"use strict";return t.extend({_timerLastKey:null,defaultOptions:{className:"SW_InputWithFilter",id:"SW_SearchPeople",Label:"",hint:"",MaxNumber:"6",MaxSize:"",position:"auto",acceptEmpty:!1,setBorderColor:!1,wintop:!1,CSE:!1,IsMoveSearch:!1,autocomplete:"off",currentUser:"",FED:!1,PrivateProjectList:[]},init:function(e){this._parent(e),this._currentNotif=null,this.parentBody=i.getWidgetBody(),this._currentPosition="auto","auto"===this.options.position?this._currentPosition="top":this._currentPosition=this.options.position,this.mainScrollerSearch=null,this.currentChoice=null,this.initUI(),this.mouseIsInBlock=!1},_timeEnd:function(){this._timerLastKey=null,this.dispatchEvent("onUserChoice")},_elementIsButton:function(e){return e&&e.hasClassName("SW_ButtonMoreContainer")},initUI:function(){var e=this;i.get3DSwymUrlAsync({onComplete:function(t){e.options.SwymUrl=t}});var t=e.parentBody.getParent("body");t=t||e.parentBody,e.container=UWA.createElement("div",{class:"SW_upperContainer "+e.options.className,html:""}),e.labelArea=UWA.createElement("label",{id:"label_"+e.options.id,html:e.options.Label}),""==e.options.Label&&e.labelArea.hide(),e.searchDiv=UWA.createElement("div",{class:"SW_SearchInputClass",id:e.options.id,"data-rec-id":"RecSearchsearchDiv"}),e.inputDiv=UWA.createElement("div",{class:"SW_inputDivClass input-group","data-rec-id":"RecSearchinputDiv"}),e.saveIDUser=UWA.createElement("span",{class:"SW_SaveIDUser",text:""}),""==e.options.hint&&(e.options.hint=l.get("hintSearch")),"Empty"==e.options.hint&&(e.options.hint="");var n=null;e.searchInput=new o({value:"",name:"SW_SearchInput",className:"SW_SearchInput",attributes:{placeholder:e.options.hint+" ",autocomplete:"off","data-rec-id":"RecSearchinputText"},events:{onKeyDown:function(t){t.stopPropagation(),e.currentOwner=null;if(13==t.which){var n=e.filterAreaContent.getElement(".js-selected");if(n)e._elementIsButton(n)?(e.selectNextOrPreviousResult("previous"),n.click(),e.selectNextOrPreviousResult("next")):e.__setInput(n);else e.dispatchEvent("onUserChoice")}else 40===t.which?e.selectNextOrPreviousResult("next"):38===t.which?e.selectNextOrPreviousResult("previous"):[39,37,16,9,20].indexOf(t.which)<0&&!t.ctrlKey&&!t.altKey&&(e.currentChoice=null,setTimeout(function(){var t=e.searchInput.getValue();!e.options.setBorderColor||e.options.acceptEmpty&&""===t?e.container.removeClassName("SW_unvalid"):e.container.addClassName("SW_unvalid")}),32!==t.which&&e._removeAllSelections(),null!=e._timerLastKey&&clearTimeout(e._timerLastKey),e._timerLastKey=setTimeout(function(){e._timeEnd()},200),setTimeout(function(){e.dispatchEvent("onUnvalid")},100))},onClick:function(){e.dispatchEvent("onUserChoice")}}}),e.searchInput.elements&&e.searchInput.elements.input&&(e.searchInput.elements.input.addEvent("mouseup",function(){setTimeout(function(){""===e.getCurrentValue()&&(e.currentOwner=null,e.dispatchEvent("onUnvalid"))},100)}),e.searchInput.elements.input.addEvent("drop",function(e){e.preventDefault()}),e.searchInput.elements.input.addEvent("paste",function(t){e.getCurrentValue()!==t.clipboardData.getData("text/plain")&&setTimeout(function(){e.dispatchEvent("onUnvalid")},0)})),(n=new s({attributes:{title:l.get("AR_SearchButton")},value:"",className:"default AR_SearchButton",icon:"search",name:"SW_SearchInputButton"})).getContent().setAttribute("data-rec-id","dataRecSearchInputButton"),n.addEvents({onClick:function(){e.searchInput.setFocus(!0),e.closeDialog(),e.currentOwner=null,e.dispatchEvent("onUserChoiceNoCharLimit")}});var c=this.options.className?" SWD_"+this.options.className:"";if(e.filterContainer=UWA.createElement("div",{class:"searchComponent_filter dropdown-menu dropdown dropup"+c,"data-rec-id":"datarecfilterContainer",html:""}),this._handleStopPropagation=function(e){e.stopPropagation()},this._handleCloseDialog=function(t){e.mouseIsInBlock||e.closeDialog()},e.searchInput.elements.input.addEvents({mousedown:e._handleStopPropagation,touchstart:e._handleStopPropagation}),document.addEventListener("mousedown",e._handleCloseDialog,!1),document.addEventListener("touchstart",e._handleCloseDialog,!1),e.filterContainer.addEvents({mousedown:e._handleStopPropagation,touchstart:e._handleStopPropagation}),e.warningArea=UWA.createElement("div",{class:"SW_warningArea"}).inject(e.filterContainer).hide(),e.warningArea.addEventListener("click",e.warningArea.hide),e.filterAreaMaster=UWA.createElement("div",{name:"masterFilterArea",class:"masterFilterArea","data-rec-id":"datarecfilterAreaMaster",html:""}).inject(e.filterContainer),e.tempFilterArea=UWA.createElement("div",{class:"tempFilterAreaContent  dropdown-menu dropdown dropup"}).inject(t),e.filterArea=UWA.createElement("div",{name:"filterArea",class:"filterArea","data-rec-id":"datarecfilterArea",html:""}).inject(e.filterAreaMaster),e.filterAreaContent=UWA.createElement("div",{class:"filterAreaContent atLeastOneIcon","data-rec-id":"datarecfilterAreaContent"}),e.filterAreaContent.inject(e.filterArea),e.mainScrollerSearch=new a({element:e.filterArea}).inject(e.filterAreaMaster),e.mainScrollerSearch.elements.content.setAttribute("data-rec-id","dataRecmainScrollerSearch"),e.loadingGif=new r({className:"SW_filterSpinner",visible:!0}),e.loadingGif.inject(e.filterContainer),e.filterContainer.hide(),e.searchInput.inject(e.inputDiv),e.inputDiv.setStyle("width","100%"),null!=n){var u=UWA.createElement("span",{class:"input-group-btn"});n.inject(u),u.inject(e.inputDiv)}e.filterContainer.inject(t),e.saveIDUser.inject(e.searchDiv),e.labelArea.inject(e.searchDiv),e.inputDiv.inject(e.searchDiv),e.searchDiv.inject(e.container),this._actionOnMoveOrResize=function(){e._dialogIsOpened()&&e.openDialog()},i.addWidgetResizeEvent(e._actionOnMoveOrResize)},actionOnMove:function(){this.closeDialog()},selectNextOrPreviousResult:function(e){var t=this.filterAreaContent.getElement(".js-selected"),n=this._elementIsButton(t),i=null;if(t){if(n&&"next"!==e)(o=t.previousSibling.getElements(".SW_LiData:not(.SW_hiddenLine)"))&&o.length>0&&(i=o[o.length-1]);if(i||(i=n?null:"next"===e?t.nextSibling:t.previousSibling),!i||"none"===i.getStyle("display")){var r=t.getParent(".SW_DivPeople");if(n||"next"!==e||(i=(i=r.getElement(".SW_ButtonMoreContainer"))&&"none"!==i.getStyle("display")?i:null),!i&&r){var o,s="next"===e?r.nextSibling:r.previousSibling;if(s)if(i=null,"next"===e)i=s.getElement(".SW_LiData");else if(null===(i=(i=s.getElement(".SW_ButtonMoreContainer"))&&"none"!==i.getStyle("display")?i:null))(o=s.getElements(".SW_LiData:not(.SW_hiddenLine)"))&&o.length>0&&(i=o[o.length-1])}}}else i=this.filterAreaContent.getElement(".SW_LiData");if(i&&"none"!==i.getStyle("display")){i.addClassName("js-selected"),t&&t.removeClassName("js-selected");var a=this._getElementPositionInScroller(i);null!=a&&this.mainScrollerSearch.scrollTo(0,a-25)}},_removeAllSelections:function(){this.filterAreaContent.getElements(".js-selected").forEach(function(e){e.removeClassName("js-selected")})},_escapeRegExp:function(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")},getAvatarDetails:function(e){var t={},n=[[7,139,250],[249,87,83],[111,188,75],[158,132,106],[170,75,178],[26,153,123],[245,100,163],[255,138,46]],i=e;i.contains("<b>")&&(i=i.replace("<b>","")).contains("</b>")&&(i=i.replace("</b>",""));var r=i.match(/\b\w/g),o=r[0].toUpperCase(),s=r[r.length-1].toUpperCase();i.contains("/")&&(s=" "!=i.charAt(i.indexOf("/")+1)?i.charAt(i.indexOf("/")+1).toUpperCase():i.charAt(i.indexOf("/")+2).toUpperCase());var a=o+s,l=Math.ceil((o.charCodeAt(0)+s.charCodeAt(0))%n.length),c="rgb("+n[l][0]+","+n[l][1]+","+n[l][2]+")";return t.name=e,t.avatarStr=a,t.avatarColor=c,t},setData:function(e){var t=this,n=this.getCurrentChoiceId();e.forEach(function(e){var r=e.getClass(),o=UWA.createElement("div",{class:"SW_DivPeople "+r,"data-rec-id":"datarecdivPeople",html:{tag:"div",text:e.getTitle(),class:"SW_TitleSection"}}).inject(t.filterAreaContent);""!=r&&(r+=r+"List");var s=UWA.createElement("ul",{class:"filterSSArea dropdown-menu-wrap "+r,"data-rec-id":"datarecfilterSSArea",html:""}).inject(o),a=!1;e.getListItems().forEach(function(e,c){if(c==t.options.MaxNumber){var u=UWA.createElement("div",{class:"SW_ButtonMoreContainer fonticon fonticon-down-open",events:{click:function(e){t.displayMore(e,r)}}}).inject(o);new UWA.createElement("a",{class:"SW_MoreButton","data-rec-id":"datarecMoreButton",html:l.get("MoreButton")}).inject(u),a=!0}var h=e.getId(),p=e.getTitle();p||(p=h);var d=t.getListOfSearchingWord();1==t.options.CSE&&(d.listWord=[],t.tempFilterArea.empty());for(var g=d.listWord,S=g.length,f=0;f<S;f++){var m=new RegExp("("+t._escapeRegExp(g[f])+")","ig");p&&(p=p.replace(m,"<b>$1</b>"))}if(""!=p){var v=[];if(n===h&&v.push({tag:"span",class:"SW_liSelected"}),null!=t.options)if(t.options.hasOwnProperty("topClassHeight"))if(t.options.topClassHeight.contains("SHP_PopupDial")){var w="";e.hasOwnProperty("itemIcon")&&e.itemIcon.hasOwnProperty("class")&&e.itemIcon.class.contains("fonticon-user")&&(w=h).contains("_PRJ")&&(w=w.slice(0,w.length-4));var y=t.getAvatarDetails(p),C=y.avatarColor,_=y.avatarStr;if(""!=w)if(w.contains("uuid:")){"";var I=i.getRealPath("SearchWidget/assets/User_Group_Search.png",widget,!1),D=UWA.createElement("div");UWA.createElement("img",{src:I,class:"search_suggest-img"}).inject(D);v.push(D)}else{if("",t.options.hasOwnProperty("SwymUrl")&&""!=t.options.SwymUrl){I=t.options.SwymUrl+"/api/user/getpicture/login/"+w+"/format/normal",D=UWA.createElement("div"),UWA.createElement("img",{src:I,class:"search_suggest-img"}).inject(D);v.push(D)}else{D=UWA.createElement("div");UWA.createElement("div",{class:"search-team-profile-picture search-team-profile-text",text:_}).inject(D).setStyle("background-color",C),v.push(D)}}else{D=UWA.createElement("div");UWA.createElement("div",{class:"search-team-profile-picture search-team-profile-text",text:_}).inject(D).setStyle("background-color",C),v.push(D)}}else v.push(e.getIcon());else v.push(e.getIcon());else v.push(e.getIcon());v.push({tag:"span","data-rec-id":"RecdataUser",class:"userName",html:p});var W=UWA.createElement("li",{class:"SW_LiData item ","data-rec-id":"RecSearchLiData"+c,IDOwner:h,title:e.getTitle(),html:v});1==a&&t._hideLine(W),W.inject(s),W.addEvent("click",function(e){t._setInput(e)})}})}),this.selectNextOrPreviousResult("next")},_getElementPositionInScroller:function(e){var t=null;if(e){var n=e.getOffsets(),i=this.filterAreaContent.getOffsets();t=n.y-i.y}return t},getCurrentValue:function(){return this.searchInput.getValue()},getListOfSearchingWord:function(){var e=this.searchInput.getValue(),t=[];""!=(e=(e=(e=e.trim()).replace(/\s+/g," ")).replace(/\*/g,".*"))&&(t=e.split(" "));for(var n=t.length-1;n>=0;n--)t[n].search(/^<?([/b]|\/b)>?$/i)>=0&&t.splice(n,1);return{valueSearched:e,listWord:t}},_hideLine:function(e){e.addClassName("SW_hiddenLine")},_showLine:function(e){e.removeClassName("SW_hiddenLine")},displayMore:function(e,t){var n=this,i=e.target.getClosest(".SW_DivPeople").getElements("li"),r=0,o=!0;i.every(function(e,t){return"none"==e.getStyle("display")&&(n._showLine(e),r++),!(r>=n.options.MaxNumber)||(t!=i.length-1&&(o=!1),!1)}),1==o&&e.target.getClosest(".SW_ButtonMoreContainer").hide(),this.updateScroller()},getCurrentChoiceId:function(){return this.currentChoice},_setInput:function(e){var t=e.currentTarget.getClosest(".SW_LiData");this.__setInput(t)},__setInput:function(e){if(this._removeAllSelections(),e){var t=e.getElement(".userName").getText(),n=e.getAttribute("IDOwner");this.currentChoice=n,this.setDisplayValue(t),this.closeDialog(),this.options.setBorderColor&&this.container.removeClassName("SW_unvalid"),this.dispatchEvent("onValid")}},setDisplayValue:function(e){this.searchInput.setValue(e)},getDisplayValue:function(){this.searchInput.getValue()},_dialogIsOpened:function(){return!!this.filterContainer&&"none"!==this.filterContainer.getStyle("display")},openDialog:function(){var e=this.searchDiv.getSize().height,t=this._getMaxSize();"auto"===this.options.position&&(this._currentPosition="top",null!=t&&(t.top>t.bottom?this._currentPosition="top":this._currentPosition="bottom")),this.filterContainer.setStyle("left",t.left+"px"),"top"===this._currentPosition?(this.filterContainer.setStyle("bottom",t.bottom+e+"px"),this.filterContainer.setStyle("top","auto")):(this.filterContainer.setStyle("top",t.top+e+"px"),this.filterContainer.setStyle("bottom","auto")),this.filterContainer.show(),this.filterArea.hide(),this.warningArea.hide(),this._currentNotif?(this.filterContainer.addClassName("SW_FilterWithNotif"),this.warningArea.setText(this._currentNotif.message),this.warningArea.show()):(this.filterContainer.removeClassName("SW_FilterWithNotif"),this.filterArea.show()),this.mouseIsInBlock=!1,this.updateScroller()},destroy:function(){this.searchInput.elements.input.removeEvents({mousedown:this._handleStopPropagation,touchstart:this._handleStopPropagation}),this.parentBody&&this.parentBody.removeEvents({mousedown:this._handleCloseDialog,touchstart:this._handleCloseDialog}),this.filterContainer.removeEvents({mousedown:this._handleStopPropagation,touchstart:this._handleStopPropagation}),this.tempFilterArea.destroy(),this.filterContainer.destroy(),i.removeWidgetResizeEvent(this._actionOnMoveOrResize),this._parent()},updateScroller:function(){var t=e.clone(this.filterAreaContent);this.tempFilterArea.empty(),this.tempFilterArea.appendChild(t);this.searchDiv.getSize().width;var n=this.tempFilterArea.getSize(),i=null,r=this._getMaxSize(),o=(n.width,this.parentBody.getSize()),s=r.right>0?o.width-r.right:o.width,a=this.filterAreaMaster.getDimensions(),l=a.outerWidth-a.innerWidth,c=s-r.left;r&&(this.filterContainer.setStyle("max-width",c+"px"),i="top"===this._currentPosition?r.top:r.bottom,n.width+l>c-l||n.width),(""!=this.options.MaxSize&&this.options.MaxSize<i||null==i)&&(i=this.options.MaxSize);var u=n.height;(n.height>i||n.width>c)&&(u=n.height>i?i:n.height),this.filterArea.setStyle("height",u)},showLoadingGif:function(){this.openDialog(!1),this.filterAreaMaster.hide(),this.loadingGif.show()},hideLoadingGif:function(){this.filterAreaMaster.show(),this.loadingGif.hide()},clearAllResult:function(){this.filterAreaContent.empty()},isResultEmpty:function(){return""===this.filterAreaContent.getHTML()},ClearDialog:function(){this.clearAllResult(),this.filterContainer.hide()},closeDialog:function(){this._removeAllSelections(),this.filterArea.hide(),this.filterContainer.hide()},resetError:function(){this._currentNotif=null},raiseError:function(e){"warning"===e.eventID?(this._currentNotif=e,this.openDialog()):this.dispatchEvent("onError",e)},clearTextArea:function(){this.ClearDialog(),this.clearInput()},clearInput:function(){this.searchInput.setValue(""),this.currentChoice=null,this.dispatchEvent("onUnvalid")},_getMaxSize:function(){var e=null,t=this.searchDiv.getBoundingClientRect(),n=this.parentBody.getBoundingClientRect();return(e={}).bottom=n.height+n.top-t.bottom,e.right=n.width+n.left-t.right,e.top=t.top,e.left=t.left,e}})}),define("DS/SearchWidget/models/SW_GroupModel",["UWA/Controls/Abstract"],function(e){"use strict";return e.extend({init:function(e){for(var t in this.groupTitle="",this.groupClass="",this.groupItems=[],this.isSW_GroupModel=!0,e)this[t]=e[t]},getTitle:function(){return this.groupTitle},getClass:function(){return this.groupClass},getListItems:function(){return this.groupItems},setTitle:function(e){this.groupTitle=e},setClass:function(e){this.groupClass=e},setListItems:function(e){this.groupItems=e}})}),define("DS/SearchWidget/componentUI/SearchWidgetUIWebUX",["UWA/Core","UWA/Controls/Abstract","UWA/Json","DS/WidgetServices/WidgetServices","DS/WUXAutoComplete/AutoComplete","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","i18n!DS/SearchWidget/assets/nls/langSW"],function(e,t,n,i,r,o,s,a){"use strict";return t.extend({_timerLastKey:null,defaultOptions:{className:"SW_InputWithFilter",id:"SW_SearchPeople",Label:"",hint:"",MaxNumber:"6",MaxSize:"",position:"auto",acceptEmpty:!1,setBorderColor:!1,wintop:!1,CSE:!1,IsMoveSearch:!1,autocomplete:"off",currentUser:"",FED:!1,PrivateProjectList:[]},init:function(e){this._parent(e),this._currentNotif=null,this.parentBody=i.getWidgetBody(),this.responseForPerson=[],this.mapToStoreResponse=new Map,this._currentPosition="auto","auto"===this.options.position?this._currentPosition="top":this._currentPosition=this.options.position,this.mainScrollerSearch=null,this.currentChoice=null,this.initUI(),this.mouseIsInBlock=!1},_timeEnd:function(){this._timerLastKey=null,this.dispatchEvent("onUserChoice")},_elementIsButton:function(e){return e&&e.hasClassName("SW_ButtonMoreContainer")},initUI:function(){var e=this;i.get3DSwymUrlAsync({onComplete:function(t){e.options.SwymUrl=t}});var t=e.parentBody.getParent("body");t=t||e.parentBody,e.container=UWA.createElement("div",{class:"SW_upperContainer "+e.options.className,html:""}),e.labelArea=UWA.createElement("label",{id:"label_"+e.options.id,html:e.options.Label}),""==e.options.Label&&e.labelArea.hide(),e.searchDiv=UWA.createElement("div",{class:"SW_SearchInputClass",id:e.options.id,"data-rec-id":"RecSearchsearchDiv"}),e.inputDiv=UWA.createElement("div",{class:"SW_inputDivClass input-group","data-rec-id":"RecSearchinputDiv"}),e.saveIDUser=UWA.createElement("span",{class:"SW_SaveIDUser",text:""}),""==e.options.hint&&(e.options.hint=a.get("hintSearch")),"Empty"==e.options.hint&&(e.options.hint=""),e.searchInput=new r({elementsTree:function(t){return t&&""!==t&&t!==this.value&&t!==e.mapToStoreResponse.get(e.searchInput.value)&&(setTimeout(function(){e.dispatchEvent("onUserChoice")},200),setTimeout(function(){e.dispatchEvent("onUnvalid")},100)),new Promise(function(t,n){e.dispatchEvent("onUserChoice");var i=e;setTimeout(async function(){var e=await i._getResponseForPerson(),n=await i.formatResponseData(e);t(n)},1e3)})},multiSearchMode:!1,minLengthBeforeSearch:3,allowFreeInputFlag:!1,customFilterMessage:a.get("WarningNotFound")}),e.searchInput.getContent().addClassName("SW_SearchInput"),e.searchInput.addEventListener("change",function(t){console.log(t.dsModel.value);var n=t.dsModel.value;e.setOrRemoveCSSErrorField(),n?(e.currentChoice=n,e.dispatchEvent("onValid")):(e.currentChoice=null,e.dispatchEvent("onUnvalid"))}),e.searchInput._editor.elements.inputField.addEventListener("input",function(t){var n=e.searchInput.getValueToCommit();""===n&&(e.searchInput.value=void 0),e.setOrRemoveCSSErrorField(),n!==e.searchInput.value&&n!==e.mapToStoreResponse.get(e.searchInput.value)&&e.dispatchEvent("onUnvalid")}),e.searchInput._editor.addEventListener("change",function(t){t.dsModel.value||(e.searchInput.value=void 0)}),e.searchInput._editor.elements.inputField.addEventListener("blur",function(t){var n=e.searchInput.getValueToCommit();""===n&&(e.searchInput.value=void 0),e.mapToStoreResponse.has(e.searchInput.value)&&n===e.mapToStoreResponse.get(e.searchInput.value)&&e.dispatchEvent("onValid")});this.options.className&&this.options.className;e.searchInput.inject(e.inputDiv),e.inputDiv.setStyle("width","100%"),e.saveIDUser.inject(e.searchDiv),e.labelArea.inject(e.searchDiv),e.inputDiv.inject(e.searchDiv),e.searchDiv.inject(e.container)},actionOnMove:function(){},_escapeRegExp:function(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")},getAvatarDetails:function(e){var t={},n=[[7,139,250],[249,87,83],[111,188,75],[158,132,106],[170,75,178],[26,153,123],[245,100,163],[255,138,46]],i=e;i.contains("<b>")&&(i=i.replace("<b>","")).contains("</b>")&&(i=i.replace("</b>",""));var r=i.match(/\b\w/g),o=r[0].toUpperCase(),s=r[r.length-1].toUpperCase();i.contains("/")&&(s=" "!=i.charAt(i.indexOf("/")+1)?i.charAt(i.indexOf("/")+1).toUpperCase():i.charAt(i.indexOf("/")+2).toUpperCase());var a=o+s,l=Math.ceil((o.charCodeAt(0)+s.charCodeAt(0))%n.length),c="rgb("+n[l][0]+","+n[l][1]+","+n[l][2]+")";return t.name=e,t.avatarStr=a,t.avatarColor=c,t},setData:function(e){},_getElementPositionInScroller:function(e){},getCurrentValue:function(){return this.searchInput.getValueToCommit()},getListOfSearchingWord:function(){var e=this.searchInput.getValueToCommit(),t=[];""!=(e=(e=(e=e.trim()).replace(/\s+/g," ")).replace(/\*/g,".*"))&&(t=e.split(" "));for(var n=t.length-1;n>=0;n--)t[n].search(/^<?([/b]|\/b)>?$/i)>=0&&t.splice(n,1);return{valueSearched:e,listWord:t}},_hideLine:function(e){},_showLine:function(e){},displayMore:function(e,t){},getCurrentChoiceId:function(){return this.currentChoice},setDisplayValue:function(e){e&&(this.searchInput.value=e)},getDisplayValue:function(){this.searchInput.getValueToCommit()},_dialogIsOpened:function(){},openDialog:function(){},destroy:function(){delete this.searchInput,this._parent()},updateScroller:function(){},showLoadingGif:function(){},hideLoadingGif:function(){},clearAllResult:function(){},isResultEmpty:function(){},ClearDialog:function(){},closeDialog:function(){},resetError:function(){this._currentNotif=null},raiseError:function(e){"warning"===e.eventID?this._currentNotif=e:this.dispatchEvent("onError",e)},clearTextArea:function(){this.ClearDialog(),this.clearInput()},clearInput:function(){this.searchInput.value="",this.currentChoice=null,this.dispatchEvent("onUnvalid")},_getMaxSize:function(){},_setResponseForPerson:function(e){e&&(this.responseForPerson=e)},_getResponseForPerson:function(){return this.responseForPerson},formatResponseData:function(e){var t=this,n=new o;return n.prepareUpdate(),e.forEach(function(e){var i=t.createTreeDocNodeModel(e.groupTitle,"");n.addRoot(i),e.groupItems.forEach(function(n){var r=n.itemTitle.split("\n"),o=r[0]+" "+r[1],s=n.itemId,a=n.itemIcon.class,l=null;"People"===e.groupTitle?(l=t.createTreeDocNodeModel(o,s,a,"user"),t.mapToStoreResponse.set(s,o)):l=t.createTreeDocNodeModel(o,s,a),i.addChild(l)})}),n.pushUpdate(),n.expandAll(),n},createTreeDocNodeModel:function(e,t,n,i){var r=[];return r.push(n),new s({label:e,value:t,icons:r})},getImageForWUXPerson:function(e,t){},setOrRemoveCSSErrorField:function(){""===this.searchInput.getValueToCommit()&&void 0===this.searchInput.value?this.searchInput._editor.elements.inputField.addClassName("error-field"):this.searchInput._editor.elements.inputField.removeClassName("error-field")}})}),define("DS/SearchWidget/controllers/SW_Base_Controller",["UWA/Controls/Abstract","UWA/Json","DS/SearchWidget/SearchWidgetConstant","DS/WidgetServices/WidgetServices","DS/SearchWidget/models/SW_GroupModel","DS/SearchWidget/models/SW_ItemModel","DS/SearchWidget/componentUI/SearchWidgetUI","DS/SearchWidget/componentUI/SearchWidgetUIWebUX","i18n!DS/SearchWidget/assets/nls/langSW"],function(e,t,n,i,r,o,s,a,l){"use strict";return e.extend({defaultOptions:{serverName:"",serverUri:"",showEmptyCategory:!0,ForbiddenChar:'"#$@%*,?\\<>[]|:',urlService:"",wintop:!1,webParams:null,dropdown:!1,CSE:!1,IsMoveSearch:!1,autocomplete:"off",currentUser:"",FED:!1,PrivateProjectList:[]},searchWidgetUI:null,addOptions:function(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;n++){var i=t[n];this.options[i]=e[i]}},init:function(e){var t=this;void 0===e.type&&(e.type=n.TYPE_FULL),this._parent(e);var i=e.events;null==i&&(i={}),i.onUserChoice=function(){t.filter(3)},i.onUserChoiceNoCharLimit=function(){t.filter(0)},e.events=i,"person_wux"===e.tw_type?this.searchWidgetUI=this.container=new a(e):this.searchWidgetUI=this.container=new s(e),this.searchWidgetUI.hideLoadingGif(),this.folder="SearchWidget",this._initVariables()},switchDropdownMode:function(e){this.options.dropdown=!0===e},_showDropdown:function(){return this.options.dropdown},_initVariables:function(){this._selectedItems=[],this.requestObject=null,this.currentSearch=null,this.lastSearch="",this.initSearch="",this.listLastSearch={},this.listInitSearch={},this.CSEListOfOrg={},this.CSEListOfCs={},this.listOwner=[],this.repeatSearch=0},destroy:function(){this.searchWidgetUI&&this.searchWidgetUI.destroy(),this._parent()},actionOnMove:function(){this.searchWidgetUI&&this.searchWidgetUI.actionOnMove()},actionOnScroll:function(){this.actionOnMove()},clearTextArea:function(){this.searchWidgetUI.clearTextArea()},clearInput:function(){this.searchWidgetUI.clearInput()},sortResponse:function(e){var t=e.owner,i={person:[],securityContext:[],collabSpace:[],organization:[],userGrp:[]},r=t.length;if(t&&0!=r)for(var o=0;o<r;o++)this.options.type!=n.TYPE_FULL&&this.options.type!=n.TYPE_PERSON||!t[o].hasOwnProperty("person")?this.options.type==n.TYPE_FULL&&t[o].hasOwnProperty("collabSpace")&&t[o].hasOwnProperty("organization")?i.securityContext.push(t[o]):this.options.type!=n.TYPE_FULL&&this.options.type!=n.TYPE_PROJECT||!t[o].hasOwnProperty("collabSpace")?this.options.type!=n.TYPE_FULL&&this.options.type!=n.TYPE_ORGANIZATION||!t[o].hasOwnProperty("organization")?this.options.exttype==n.EXTTYPE_USERGRP&&t[o].hasOwnProperty("userGrp")&&i.userGrp.push(t[o]):i.organization.push(t[o]):i.collabSpace.push(t[o]):i.person.push(t[o]);return i},getOwnerProperties:function(e){var t="",n="",i="";return e.hasOwnProperty("person")?(t=e.person.personID,n=e.person.personFullName):e.hasOwnProperty("collabSpace")||e.hasOwnProperty("organization")?e.hasOwnProperty("collabSpace")&&e.hasOwnProperty("organization")?(t=e.collabSpace.collabSpaceID+e.organization.orgID,n=e.organization.orgID+" / "+e.collabSpace.collabSpaceID,e.organization.hasOwnProperty("orgTitle")&&e.collabSpace.hasOwnProperty("collabSpaceTitle")&&(i=e.organization.orgTitle+" / "+e.collabSpace.collabSpaceTitle)):e.hasOwnProperty("collabSpace")?(t=e.collabSpace.collabSpaceID,n=e.collabSpace.collabSpaceID,""!==(i=e.collabSpace.collabSpaceTitle)&&(n=i)):e.hasOwnProperty("organization")&&(t=e.organization.orgID,n=e.organization.orgID,""!==(i=e.organization.orgTitle)&&(n=i)):e.hasOwnProperty("userGrp")&&(t=e.userGrp.id,n=e.userGrp.label),{IDOwner:t,Name:n,Title:i}},JSFilterPerson:function(e,t){var n=[],i=!0,r=!0;return e.forEach(function(e){i=!0,r=!0;var o=e.person.personID.toLowerCase(),s=e.person.personFullName.toLowerCase();t.every(function(e){return e=e.toLowerCase(),i&&o.indexOf(e)<0&&(i=!1),r&&s.indexOf(e)<0&&(r=!1),0!=i||0!=r}),(i||r)&&n.push(e)}),n},JSFilterSC:function(e,t){var n=[],i=!0;return e.forEach(function(e){i=!0;var r="",o="";e.hasOwnProperty("collabSpace")&&(r=e.collabSpace.hasOwnProperty("collabSpaceTitle")&&e.collabSpace.collabSpaceTitle?e.collabSpace.collabSpaceTitle.toLowerCase():e.collabSpace.collabSpaceID.toLowerCase()),e.hasOwnProperty("organization")&&(o=e.organization.hasOwnProperty("orgTitle")&&e.organization.orgTitle?e.organization.orgTitle.toLowerCase():e.organization.orgID.toLowerCase()),t.every(function(e){return e=e.toLowerCase(),!(r.indexOf(e)<0&&o.indexOf(e)<0)||(i=!1,!1)}),i&&n.push(e)}),n},JSFilterUserGrp:function(e,t){var n=[],i=!0;return e.forEach(function(e){i=!0;var r="";e.hasOwnProperty("userGrp")&&(r=e.userGrp.label.toLowerCase()),t.every(function(e){return e=e.toLowerCase(),r.indexOf(e)<0&&(i=!1),i}),i&&n.push(e)}),n},getDisplayedResult:function(){return this.searchWidgetUI.getCurrentValue()},setValue:function(e){this.searchWidgetUI.setDisplayValue(e)},getValue:function(){return this.searchWidgetUI.getDisplayValue()},updateFilter:function(e,t){var n=!1;this.listOwner=[],this.searchWidgetUI.clearAllResult();var s="",a=[];if(null!=this.searchWidgetUI){var c=this.searchWidgetUI.getListOfSearchingWord();s=c.valueSearched,a=c.listWord}this.lastSearch=s;var u=UWA.clone(e);this.listLastSearch=u,1==t?(this.initSearch=s,this.listInitSearch=UWA.clone(e)):(this.listLastSearch.person&&(this.listLastSearch.person=this.JSFilterPerson(this.listLastSearch.person,a)),this.listLastSearch.collabSpace&&(this.listLastSearch.collabSpace=this.JSFilterSC(this.listLastSearch.collabSpace,a)),this.listLastSearch.organization&&(this.listLastSearch.organization=this.JSFilterSC(this.listLastSearch.organization,a)),this.listLastSearch.securityContext&&(this.listLastSearch.securityContext=this.JSFilterSC(this.listLastSearch.securityContext,a)),this.listLastSearch.userGrp&&(this.listLastSearch.userGrp=this.JSFilterUserGrp(this.listLastSearch.userGrp,a)));for(var h=[],p=!1,d=0;d<4;d++){var g=null,S=[],f="",m="";if(this.options.type&&0==d){if(g=i.getImageUser(1,"small"),S=u.person,0==this.options.showEmptyCategory&&0==S.length)continue;f=l.get("peopleTile"),m="SW_DivPerson"}else if(this.options.type&&1==d){if(g=i.getImageUser(2,"small"),0==(S=u.collabSpace).length?S=u.securityContext:p=!0,0==this.options.showEmptyCategory&&0==S.length)continue;f=l.get("CSORGTitle"),m="SW_DivCS"}else if(this.options.type&&2==d){if(g=i.getImageUser(2,"small"),0==(S=u.organization).length&&(0==p||0==this.options.showEmptyCategory))continue;f=l.get("OrgTitle"),m="SW_DivOrg"}else{if(!this.options.exttype||3!=d)continue;if(g=i.getImageUser(3,"small"),0==(S=u.userGrp).length&&0==this.options.showEmptyCategory)continue;f=l.get("UserGrpTitle"),m="SW_DivUserGrp"}var v=[],w=S.length;if(S&&0!=w){n=!0,!1;for(var y="",C=0;C<w;C++){var _=this.getOwnerProperties(S[C]),I=_.IDOwner;y="";if(""!=(y=""!=_.Title?_.Title:_.Name)){var D=new o;D.setTitle(y),D.setId(I),D.setIcon(g),v.push(D),this.listOwner.push({owner:S[C],IDOwner:I,category:d})}}}var W=new r;W.setTitle(f),W.setClass(m),W.setListItems(v),h.push(W)}if("person_wux"===this.options.tw_type?this.searchWidgetUI._setResponseForPerson(h):this.searchWidgetUI.setData(h),n)this.searchWidgetUI.resetError(),this.searchWidgetUI.openDialog();else{var b={message:l.get("WarningNotFound"),code:"WARN",customClass:"SW_WarningNotFound",type:"warning",eventID:"warning"};this.searchWidgetUI.raiseError(b)}},getOwnerElementFromId:function(e){var t=null;return this.listOwner.every(function(n){return n.IDOwner!=e||(t=n,!1)}),t},getNewOwner:function(){var e={},t=this.searchWidgetUI.getCurrentChoiceId(),n=this.getOwnerElementFromId(t);return null!=n&&((e=n.owner).comment="-"),e},_onComplete:function(e){this.requestObject=null;if(this.currentSearch=null,this.repeatSearch=0,this.searchWidgetUI.hideLoadingGif(),this.searchWidgetUI.ClearDialog(),1==e.success){var t=this.sortResponse(e);this.updateFilter(t,!this._showDropdown()),this.hasOwnProperty("ODTResultForPersonSearchTest")&&(this.ODTResultForPersonSearchTest="Success")}else e.hasOwnProperty("error")&&this.searchWidgetUI.raiseError(e.error)},_onTimeout:function(){this.requestObject=null;this.currentSearch=null,this.searchWidgetUI.hideLoadingGif();var e={message:l.get("ErrorTimeOut"),code:"TO"};this.searchWidgetUI.raiseError(e),this.searchWidgetUI.ClearDialog()},_onFailure:function(e,t,n){this.requestObject=null;this.currentSearch=null,this.searchWidgetUI.hideLoadingGif();var i={};i=null!=t&&t.hasOwnProperty("error")?t.error:{message:l.get("UnknownError"),code:"ERROR"},this.searchWidgetUI.raiseError(i),this.searchWidgetUI.ClearDialog()},_onCancel:function(){this.requestObject=null,this.currentSearch=null,this.searchWidgetUI.hideLoadingGif(),this.searchWidgetUI.ClearDialog()}})}),define("DS/SearchWidget/controllers/SW_BasePnO_Controller",["DS/SearchWidget/controllers/SW_Base_Controller","DS/WAFData/WAFData","UWA/Json","DS/SearchWidget/SearchWidgetConstant","DS/WidgetServices/securityContextServices/SecurityContextServices","DS/WidgetServices/WidgetServices","DS/WidgetServices/MultipleAsynchronousRequests","i18n!DS/SearchWidget/assets/nls/langSW"],function(e,t,n,i,r,o,s,a){"use strict";var l=0;return e.extend({getData:function(){},canBeLaunched:function(){return!0},getWebservicesParam:function(){},setSelectedItemList:function(e){this._selectedItems=e,this.lastSearch="",this.initSearch="",this.stringSearchedInService="",this.listLastSearch={},this.listInitSearch={},this.CSE_ListORGCSPair={},l=0},_ajaxCall:function(e){var i=this,r=e.serverUrl,s=e.query,a=e.securityContext,l=this.getWebservicesParam(),c=this.options.webParams;1==i.options.CSE&&(l.url=i.options.urlService);var u=c&&"function"==typeof c.getQueryParams?c.getQueryParams():{};if(u.pattern=s,i.stringSearchedInService=s,console.log("_ajaxCall",s),1==i.options.CSE&&("collabspace"==i.options.type||"org"==i.options.type)){var h=i.options.currentUser;""!=h&&null!=h&&(u.pattern=h)}p&&(u.tenant=p);var p=o.getTenantID(),d=r+l.url,g="?";for(var S in u)d+=g+S+"="+u[S],g="&";d.contains("/resources/v1/collabServices/base/transferOwnership/owner")&&(d+="&limit=100"),d+="&searchType="+i.options.type;var f=l.method,m={Accept:"application/json","Content-Type":"application/json"};a&&(m.SecurityContext=encodeURIComponent(a.SecurityContext));var v=c&&"function"==typeof c.getData?c.getData():{};v.businessObject=i._selectedItems;var w="GET"==f?"":n.encode(v),y="";0==i.options.wintop&&(y="passport"),i.searchWidgetUI.showLoadingGif(),m["Accept-Language"]=o.getLanguage(),i.requestObject=t.authenticatedRequest(d,{type:"json",method:f,proxy:y,data:w,headers:m,timeout:36e5,onComplete:function(t){e.onComplete(t)},onFailure:function(e,t,n){i._onFailure(e,t,n)},onCancel:function(){i._onCancel()},onTimeout:function(e){i._onTimeout()}})},_OrgFedSearch:function(e){var n=this;o.get3DSearchUrlAsync({wintop:n.options.wintop,serverUrl:n.options.serverUrl,onComplete:function(i){var r="";r=i.contains("odtUrl")?i+"/federated/search":i+"/search";var s=o.getTenantID();s&&(r+="?tenant="+s);var a=o.getLanguage();e.query=e.query.substring(1,e.query.length-1),n.stringSearchedInService=e.query;var l={with_indexing_date:!0,with_nls:!1,label:"3DSpaceSearch-"+widget.getValue("x3dAppId")+"-"+(window.top.dsUserLogin?window.top.dsUserLogin:"unknown")+"-"+(new Date).getTime(),locale:a,select_predicate:["ds6w:label","ds6w:identifier"],select_file:["icon","thumbnail_2d"],query:"[label]:(*"+e.query+"*)",login:{"3dspace":{SecurityContext:e.securityContext.SecurityContext}},order_by:"desc",order_field:"relevance",nresults:100,start:"0",source:["3dspace"],specific_source_parameter:{"3dspace":{additional_query:'AND ((flattenedtaxonomies:"types/Organization"))'}},tenant:s},c={Accept:"application/json","content-type":"application/json","Accept-Language":a},u=0==n.options.wintop?"passport":"";n.searchWidgetUI.showLoadingGif(),n.requestObject=t.authenticatedRequest(r,{type:"json",method:"POST",proxy:u,data:JSON.stringify(l),headers:c,onComplete:function(t){e.onComplete(t)},onFailure:function(e,t,i){n._onFailure(e,t,i)},onCancel:function(){n._onCancel()},onTimeout:function(e){n._onTimeout()}})}})},_allSearch:function(e){var n=this;o.get3DSearchUrlAsync({wintop:n.options.wintop,serverUrl:n.options.serverUrl,onComplete:function(i){var r="";r=i.contains("odtUrl")?i+"/federated/search":i+"/search";var s=o.getTenantID();s&&(r+="?tenant="+s);var a=o.getLanguage();e.query=e.query.substring(1,e.query.length-1),n.stringSearchedInService=e.query;var l="3DSpaceSearch-"+widget.getValue("x3dAppId")+"-"+(window.top.dsUserLogin?window.top.dsUserLogin:"unknown")+"-"+(new Date).getTime(),c='((([ds6w:type]:"Person" AND [ds6w:identifier]:(*'+e.query+'*)) OR ([ds6w:type]:"Person" AND [ds6w:responsible]:(*'+e.query+'*)) OR ([ds6w:type]:"Person" AND [ds6wg:fullname]:(*'+e.query+'*)) OR ([ds6w:type]:"Person" AND [firstname]:(*'+e.query+'*)) OR ([ds6w:type]:"Person" AND [lastname]:(*'+e.query+'*))) AND policycurrent:"Person.Active") OR (([ds6w:type]:"Security Context" AND [ds6w:identifier]:(*.*.*'+e.query+'*)) OR ([ds6w:type]:"Security Context" AND [ds6w:label]:(*.*.*'+e.query+'*))) OR (([ds6w:type]:"Security Context" AND [ds6w:identifier]:(*.*'+e.query+'*.*)) OR ([ds6w:type]:"Security Context" AND [ds6w:label]:(*.*'+e.query+"*.*)))";"user"==n.options.type&&(c='(([ds6w:type]:"Person" AND [ds6w:identifier]:(*'+e.query+'*)) OR ([ds6w:type]:"Person" AND [ds6w:responsible]:(*'+e.query+'*)) OR ([ds6w:type]:"Person" AND [ds6wg:fullname]:(*'+e.query+'*)) OR ([ds6w:type]:"Person" AND [firstname]:(*'+e.query+'*)) OR ([ds6w:type]:"Person" AND [lastname]:(*'+e.query+'*))) AND policycurrent:"Person.Active"');var u={with_indexing_date:!0,with_nls:!1,label:l,locale:a,select_predicate:["ds6w:label","ds6w:type","ds6w:description","ds6w:identifier","ds6w:responsible","ds6wg:fullname","firstname","lastname"],select_file:["icon","thumbnail_2d"],query:c,login:{"3dspace":{SecurityContext:e.securityContext.SecurityContext}},order_by:"desc",order_field:"relevance",nresults:1e3,start:"0",source:["3dspace"],tenant:s},h={Accept:"application/json","content-type":"application/json","Accept-Language":a},p=0==n.options.wintop?"passport":"";n.searchWidgetUI.showLoadingGif(),n.requestObject=t.authenticatedRequest(r,{type:"json",method:"POST",proxy:p,data:JSON.stringify(u),headers:h,onComplete:function(t){e.onComplete(t)},onFailure:function(e,t,i){n._onFailure(e,t,i)},onCancel:function(){n._onCancel()},onTimeout:function(e){n._onTimeout()}})}})},_CustomFedSearch:function(e){var n=this,i="",r="";this.options.type.contains("user")?(i='AND ((flattenedtaxonomies:"types/Person" AND policycurrent:"Person.Active"))',e.source&&"swym"===e.source&&(r='[ds6w:type]:( "pno:Person")',i="AND personOrGroup:("+e.query+")",e.query=r)):this.options.type.contains("collabspace")?e.query="("+e.query+') (flattenedtaxonomies:"types/Security Context")':this.options.type.contains("org")&&(i='AND ((flattenedtaxonomies:"types/Organization"))'),o.get3DSearchUrlAsync({wintop:n.options.wintop,serverUrl:n.options.serverUrl,onComplete:function(r){var s="";s=r.contains("odtUrl")?r+"/federated/search":r+"/search";var a=o.getTenantID();a&&(s+="?tenant="+a);var l=o.getLanguage(),c="3DSpaceSearch-"+widget.getValue("x3dAppId")+"-"+(window.top.dsUserLogin?window.top.dsUserLogin:"unknown")+"-"+(new Date).getTime(),u="";u="3dspace"==e.source?{"3dspace":{additional_query:i}}:{swym:{additional_query:i}};var h=["ds6w:label","ds6w:resourceUid","resourceid","ds6w:type","ds6w:description","ds6w:identifier","ds6w:responsible","ds6wg:fullname"];"3dspace"===e.source?(h.push("firstname"),h.push("lastname")):"swym"===e.source&&(h.push("first_name"),h.push("last_name"));var p={with_indexing_date:!0,with_nls:!1,label:c,locale:l,select_predicate:h,select_file:["icon","thumbnail_2d"],query:e.query,order_by:"desc",order_field:"relevance",nresults:100,start:"0",source:[e.source],specific_source_parameter:u,tenant:a},d={Accept:"application/json","content-type":"application/json","Accept-Language":l},g=0==n.options.wintop?"passport":"";n.requestObject=t.authenticatedRequest(s,{type:"json",method:"POST",proxy:g,data:JSON.stringify(p),headers:d,onComplete:function(t){e.onComplete(t)},onFailure:function(e,t,i){n._onFailure(e,t,i)},onCancel:function(){n._onCancel()},onTimeout:function(e){n._onTimeout()}})}})},_spaceSearch:function(e){var t=this;o.get3DSpaceUrlAsync({wintop:t.options.wintop,serverUrl:t.options.serverUrl,onComplete:function(n){r.getInstance().getSecurityContext({onSuccess:function(i){e.securityContext=i,e.serverUrl=n,t._ajaxCall(e)},onFailure:function(n){t._ajaxCall(e)}})}})},parseResponse:function(e){var t=e=>e.reduce(function(e,n){return e.concat(Array.isArray(n)?t(n):n)},[]);let n=[];if(!UWA.is(e.collabspaces,"array"))return n;let i=[...new Set(t(e.collabspaces.map(e=>e.couples.map(e=>e.organization.name))))].length>1;return e.collabspaces.forEach(e=>{e.couples.forEach(t=>{var r=null==t.role.nls||""==t.role.nls?t.role.name:t.role.nls,o=t.role.name,s=t.organization.name,a=t.organization.title,l=e.name,c=e.title?e.title:e.name;let u=i?c+" ● "+a+" ● "+r:c+" ● "+r,h="ctx::"+o+"."+s+"."+l;n.push({displayName:u,ctx:h})})}),n.sort((e,t)=>e.displayName.localeCompare(t.displayName,void 0,{numeric:!0,sensitivity:"base"}))},_allSearchSecurityContext:function(e){var n=this;o.get3DSpaceUrlAsync({wintop:n.options.wintop,serverUrl:n.options.serverUrl,onComplete:function(i){r.getInstance().getSecurityContext({onSuccess:function(t){e.securityContext=t,e.serverUrl=i,"org"===n.options.type?n._OrgFedSearch(e):n._allSearch(e)},onFailure:function(r){var o=widget.getValue("x3dPlatformId"),s=i+"/resources/modeler/pno/person?tenant="+o+"&current=true&select=preferredcredentials&select=collabspaces",a={Accept:"application/json","Content-Type":"application/json","Accept-Language":widget.lang?widget.lang:widget.getValue("lang")};n.requestObject=t.authenticatedRequest(s,{method:"GET",headers:a,onComplete:function(t){var r=n.parseResponse(JSON.parse(t));r.length<0||!UWA.is(r,"array")?console.error("Missing credentials"):null!=r[0]&&null!=r[0]&&r[0].hasOwnProperty("ctx")&&(e.securityContext={SecurityContext:r[0].ctx,tenant:""},e.serverUrl=i,n._allSearch(e))},onFailure:function(e,t,i){n._onFailure(e,t,i)},onCancel:function(){n._onCancel()},onTimeout:function(e){n._onTimeout()}})}})}})},_fedSearch:function(e){var n=this;o.get3DSearchUrlAsync({wintop:n.options.wintop,serverUrl:n.options.serverUrl,onComplete:function(i){var r=i+"/search",s=o.getTenantID();s&&(r+="?tenant="+s);var a=o.getLanguage(),l={select_predicate:["groupuri","ds6w:label"]};l.locale=a,l.nresults=25,l.tenant=s,l.query='([ds6w:type]:"Group" AND [ds6w:label]:('+e.query+')) OR ([ds6w:type]:"foaf:Group" AND [ds6w:label]:('+e.query+"))",l.start=0;var c={Accept:"application/json","content-type":"application/json","Accept-Language":a},u=0==n.options.wintop?"passport":"",h="searchUserGrp-"+(window.top.dsUserLogin?window.top.dsUserLogin:"unknown")+"-"+(new Date).getTime();l.label=h,n.requestObject=t.authenticatedRequest(r,{type:"json",method:"POST",proxy:u,data:UWA.Json.encode(l),headers:c,onComplete:function(t){e.onComplete(t)},onFailure:function(e,t,i){n._onFailure(e,t,i)},onCancel:function(){n._onCancel()},onTimeout:function(e){n._onTimeout()}})}})},isPrivateProject:function(e){for(var t=!1,n=0;n<this.options.PrivateProjectList.length;n++)if(e===this.options.PrivateProjectList[n]){t=!0;break}return t},filter:function(e){for(var t=this,n=this.searchWidgetUI.getCurrentValue(),r=!0,o=t.options.ForbiddenChar.length,c=0;c<o;c++){var u=t.options.ForbiddenChar[c];if(-1!=n.indexOf(u)){r=!1;var h={code:"",message:a.get("This character is forbidden : {0}").format(u)};this.searchWidgetUI.raiseError(h);break}}var p=(n=n.trim()).replace(/\s+/g," ");if(!this._showDropdown()&&p.length<e&&(r=!1,p.length<e&&this.options.hasOwnProperty("IsMoveSearch")&&this.options.IsMoveSearch)){var d={message:a.get("AutocompleteWarning"),code:"WARN",customClass:"SW_WarningNotFound",type:"warning",eventID:"warning"};this.searchWidgetUI.raiseError(d)}n="*"+(n=p.replace(/\s/g,"* *"))+"*",console.log("valueToSearch: ",n);var g=null!==this.currentSearch&&p.toLowerCase()===this.currentSearch.toLowerCase(),S=!1;if(S=""!=this.stringSearchedInService?p.toLowerCase()===this.stringSearchedInService.toLowerCase()&&(""!==this.stringSearchedInService||!this._showDropdown()):p.toLowerCase()===this.lastSearch.toLowerCase()&&(""!==this.lastSearch||!this._showDropdown()),null!=this.requestObject){if(S||g)return void this.searchWidgetUI.openDialog();this.requestObject.cancel()}if(!(!this._showDropdown()&&p.length<=0||!this.canBeLaunched())&&n&&r)if(g)this._showDropdown()&&this.searchWidgetUI.openDialog();else if(l<2&&S&&!this.searchWidgetUI.isResultEmpty())l++,this.searchWidgetUI.openDialog(),console.log("listLastSearch: ",this.listLastSearch);else{l=0;var f=null;if(f=new s([],function(){t.currentSearch=p;var e=this.getAnswer("A"),n=null;(n=e?UWA.clone(e):{success:!0}).owner=n.owner?n.owner:[];var r=this.getAnswer("CSE");if(r&&r.owner){var o=r.owner?r.owner:[];if(t.options.type==i.TYPE_PROJECT){var s={};t.CSEListOfOrg={};for(var l=0;l<o.length;l++){var c="";(g=o[l].collabSpace).hasOwnProperty("collabSpaceID")&&(c=g.collabSpaceID);var u=null;if((d=o[l].organization).hasOwnProperty("orgID")&&(u=d.orgID),t.CSEListOfOrg.hasOwnProperty(c))t.CSEListOfOrg[c].push(u);else{var h=[];u&&h.push(u),t.CSEListOfOrg[c]=h}s.hasOwnProperty(c)||(s[c]=1,n.owner.push({collabSpace:o[l].collabSpace}))}}else if(t.options.type==i.TYPE_ORGANIZATION){s={};t.CSEListOfCs={};for(l=0;l<o.length;l++){var d,g;c="";if((d=o[l].organization).hasOwnProperty("orgID")&&(c=d.orgID),0==Object.keys(s).length)var S=null;if((d=o[l].organization).hasOwnProperty("orgID")&&(u=d.orgID),(g=o[l].collabSpace).hasOwnProperty("collabSpaceID")&&(S=g.collabSpaceID),t.CSEListOfOrg.hasOwnProperty(u))t.CSEListOfOrg[u].push(S);else{var f=[];S&&f.push(S),t.CSEListOfCs[u]=f}s.hasOwnProperty(c)||(s[c]=1,n.owner.push({organization:o[l].organization}))}}else n.owner=r.owner}var m=[],v=this.getAnswer("CUSTOMFEDSEARCH");v&&v.results&&v.results.forEach(function(e){if(e.attributes&&Array.isArray(e.attributes)){var i=null,r=null,o=null,s=null,a=null,l=null;if(e.attributes.every(function(e){return"ds6w:identifier"===e.name&&"3dspace"==t.options.searchSource&&(i=e.value),"ds6wg:fullname"===e.name&&(r=e.value),"3dspace"!=t.options.searchSource?("resourceid"==e.name&&0===(i=e.value).indexOf("iam:")&&(i=i.slice(4)),"first_name"===e.name&&(o=e.value),"last_name"===e.name&&(s=e.value),"ds6w:label"===e.name&&(r=e.value)):("firstname"===e.name&&(o=e.value),"lastname"===e.name&&(s=e.value),"ds6w:label"===e.name&&(l=e.value)),"ds6w:identifier"===e.name&&(a=e.value),null===i||null===r||null===o||null===s||null===a||null===l}),t.options.type.contains("user")&&null!=r&&null!=i&&("3dspace"===t.options.searchSource&&(i+="_PRJ"),n.owner.push({person:{personFirstName:o,personFullName:r,personID:i,personLastName:s}})),t.options.type.contains("collabspace")&&null!=l){var c="",u=l.split(".");null!=u&&null!=u&&3==u.length&&(c=u[2]),-1==m.indexOf(c)&&m.push(c)}t.options.type.contains("org")&&null!=i&&n.owner.push({organization:{orgID:i}})}}),m.length>0&&t.options.type.contains("collabspace")&&m.forEach(function(e){n.owner.push({collabSpace:{collabSpaceID:e}})});var w=this.getAnswer("C");w&&w.results&&w.results.forEach(function(e){if(e.attributes){var i=null,r=null,o=null,s=null,a=null,l=null;if(e.attributes.every(function(e){return"ds6w:identifier"===e.name&&(i=e.value),"ds6wg:fullname"===e.name&&(r=e.value),"firstname"===e.name&&(o=e.value),"lastname"===e.name&&(s=e.value),"ds6w:identifier"===e.name&&(a=e.value),"ds6w:label"===e.name&&(l=e.value),null===i||null===r||null===o||null===s||null===a||null===l}),null!=r){var c=s+" "+o,u=r+"\n("+i.toLowerCase()+")";null===(i+="_PRJ")&&null===r||(i.toLowerCase().contains(p.toLowerCase())||r.toLowerCase().contains(p.toLowerCase())||c.toLowerCase().contains(p.toLowerCase()))&&n.owner.push({person:{personFirstName:o,personFullName:u,personID:i,personLastName:s}})}else if(null!=a&&null!=l){var h=l.substring(l.indexOf(".")+1,l.length),d=h.lastIndexOf("."),g=h.substring(0,d),S=h.substring(d+1,h.length);d=a.indexOf("."),d=(a=a.substring(d+1,a.length)).indexOf(".");var f=a.substring(0,d),m=a.substring(d+1,a.length),v={collabSpace:{collabSpaceID:m,collabSpaceTitle:S},organization:{orgID:f,orgTitle:g}};if(S.toLowerCase().contains(p.toLowerCase())||g.toLowerCase().contains(p.toLowerCase()))if(n.owner.length>0){var w=!1;n.owner.forEach(function(e){e.hasOwnProperty("collabSpace")&&e.hasOwnProperty("organization")&&e.collabSpace.collabSpaceID===v.collabSpace.collabSpaceID&&e.organization.orgID===v.organization.orgID&&(w=!0)}),0==w&&t.isPrivateProject(S)&&n.owner.push({collabSpace:{collabSpaceID:m,collabSpaceTitle:S},organization:{orgID:f,orgTitle:g}})}else t.isPrivateProject(S)&&n.owner.push({collabSpace:{collabSpaceID:m,collabSpaceTitle:S},organization:{orgID:f,orgTitle:g}})}}});var y=this.getAnswer("ORGFEDSEARCH");y&&y.results&&y.results.forEach(function(e){if(e.attributes){var t=null,i=null;e.attributes.every(function(e){return"ds6w:label"===e.name&&(t=e.value),"ds6w:identifier"===e.name&&(i=e.value),null===t||null===i}),null!=t&&null!=i&&n.owner.push({organization:{orgID:i,orgTitle:t}})}});var C=this.getAnswer("B");C&&C.results&&C.results.forEach(function(e){if(e.attributes){var t=null,i=null,r=0;e.attributes.every(function(e){return"ds6w:label"===e.name&&(i=e.value),"groupuri"===e.name&&(t=e.value),"ds6w:who/ds6w:hasMember"===e.name&&(r+=1),null===t||null===i||0===r}),null===t&&e.attributes.every(function(e){return"resourceid"===e.name&&(t=e.value),null===t}),null!==i&&(i=0===r||1===r?i+"\n("+r+" "+a.get("member")+")":i+"\n("+r+" "+a.get("members")+")"),null===t&&null===i||n.owner.push({userGrp:{id:t,label:i}})}}),t._onComplete(n)}),this.options.hasOwnProperty("IsMoveSearch")&&1==this.options.IsMoveSearch?(this.options.type.contains("user")||this.options.type.contains("collabspace")||this.options.type.contains("org"))&&(this.options.FED&&1==this.options.FED?f.addRequest("CUSTOMFEDSEARCH"):this.options.hasOwnProperty("CSE")&&0==this.options.CSE?f.addRequest("A"):this.options.hasOwnProperty("CSE")&&1==this.options.CSE&&f.addRequest("CSE")):this.options.hasOwnProperty("IsMoveSearch")&&0==this.options.IsMoveSearch&&("all"==this.options.type||"user"==this.options.type?f.addRequest("C"):this.options.type.contains("org")&&f.addRequest("ORGFEDSEARCH")),this.options.exttype&&f.addRequest("B"),this.options.hasOwnProperty("IsMoveSearch")&&1==this.options.IsMoveSearch){if(this.options.type.contains("user")||this.options.type.contains("collabspace")||this.options.type.contains("org"))if(this.options.hasOwnProperty("FED")&&1==this.options.FED){var m=this.options.searchSource?this.options.searchSource:"3dspace";this._CustomFedSearch({query:n,source:m,onComplete:function(e){f.setAnswer("CUSTOMFEDSEARCH",e)}})}else this.options.hasOwnProperty("CSE")&&1==this.options.CSE?this._spaceSearch({query:n,onComplete:function(e){f.setAnswer("CSE",e)}}):this.options.hasOwnProperty("CSE")&&0==this.options.CSE&&this._spaceSearch({query:n,onComplete:function(e){f.setAnswer("A",e)}})}else this.options.hasOwnProperty("IsMoveSearch")&&0==this.options.IsMoveSearch&&("all"==this.options.type||"user"==this.options.type?this._allSearchSecurityContext({query:n,onComplete:function(e){f.setAnswer("C",e)}}):this.options.type.contains("org")&&this._allSearchSecurityContext({query:n,onComplete:function(e){f.setAnswer("ORGFEDSEARCH",e)}}));this.options.exttype&&this._fedSearch({query:n,onComplete:function(e){f.setAnswer("B",e)}})}}})}),define("DS/SearchWidget/controllers/SW_Restricted_Controller",["DS/SearchWidget/controllers/SW_BasePnO_Controller","DS/WAFData/WAFData","UWA/Json","DS/WidgetServices/securityContextServices/SecurityContextServices","DS/WidgetServices/WidgetServices"],function(e,t,n,i,r){"use strict";return e.extend({requestObject:null,defaultOptions:{methodType:"POST"},init:function(e){this._parent(e)},getWebservicesParam:function(){var e=this.options.urlService,t=this.options.methodType,n=e.indexOf("/");return e||0!==n&&(e="/resources/v1/collabServices/base/transferOwnership/owner"),{method:t,url:e}},canBeLaunched:function(){return this._selectedItems.length>0}})}),define("DS/SearchWidget/controllers/SW_FullPos_Controller",["DS/SearchWidget/controllers/SW_BasePnO_Controller","DS/WAFData/WAFData","UWA/Json","DS/SearchWidget/SearchWidgetConstant","DS/WidgetServices/securityContextServices/SecurityContextServices","DS/WidgetServices/WidgetServices"],function(e,t,n,i,r,o){"use strict";return e.extend({requestObject:null,defaultOptions:{type:i.TYPE_FULL,data:null,methodType:"GET"},init:function(e){e.data&&(e.data=this._formatData(e.data)),this._parent(e)},setData:function(e){this._initVariables(),this.options.data=this._formatData(e)},setWebParams:function(e){e&&e.hasOwnProperty("getQueryParams")&&"function"===e.getQueryParams&&(this.options.webParams=e)},getData:function(){return this.options.data},_formatData:function(e){var t=null;if(e){t={person:[],securityContext:[],collabSpace:[],organization:[]};var n={persons:"person",collabSpaces:"collabSpace",organizations:"organization",securityContexts:"securityContext"};for(var i in n)if(e[i]){var r=n[i];e[i].forEach(function(e){var n={};n[r]=e,t[r].push(n)})}}return t},getWebservicesParam:function(){var e=this.options.urlService,t=this.options.methodType,n=e.indexOf("/");return e||0!==n&&(this.options.type==i.TYPE_PERSON?(t="POST",e="/resources/v1/collabServices/base/transferOwnership/owner"):e="/resources/pno/ownership/transfertarget/"+this.options.type),{method:t,url:e}}})}),define("DS/SearchWidget/SearchWidget",["UWA/Controls/Abstract","DS/SearchWidget/controllers/SW_FullPos_Controller","DS/SearchWidget/controllers/SW_Restricted_Controller","css!DS/SearchWidget/SearchWidget.css","i18n!DS/SearchWidget/assets/nls/langSW"],function(e,t,n){"use strict";return{FULL:"FullTriplet",RESTRICTED:"Restrict",getSearchWidget:function(e,i){return e==this.FULL?new t(i):e==this.RESTRICTED?new n(i):void 0}}});