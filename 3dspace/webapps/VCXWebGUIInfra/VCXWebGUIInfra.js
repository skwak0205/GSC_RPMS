define("DS/VCXWebGUIInfra/VCXArcBar",["UWA/Controls/Abstract","DS/Core/PointerEvents","DS/CoreEvents/Events","DS/WebappsUtils/WebappsUtils"],function(t,e,i,s){"use strict";var n=t.extend({defaultOptions:{body:void 0,actionBar:void 0,frmWindow:void 0,heightElem:32,widthElem:32,padding:4,title:"",updateOpacity:!0,minOpacity:Math.pow(.1,2),maxOpacity:1,typeSeparator:"bubble",lJsonElement:[],classpanel:"",Idpanel:"",heightOffset:0,curve:!0,startAngle:void 0,clockwise:!0,center:void 0,startLinearPosition:void 0,radius:500,experienceBase:void 0},init:function(t){if(this._parent(t),this._relatedOpacity=1,this._state=n.State.Visible,this._tokenWindowResized=null,this._listbutton=[],this._panel=null,this._panelInfos={},t.experienceBase){var e=t.experienceBase.getManager("VCXContextManager");e&&e.loadCssFile("VCXWebGUIInfra/VCXArcBar.css",1)}if(this._testUniciyIdFromJson()?(this._createFilter(),this.updateLayout(),this.updateCommandState()):alert("Error: ID not unique"),!t.center&&t.experienceBase){var s=this;this._usableAreaUpdateEvent=i.subscribe({event:"VCX_GUI_USABLEAREA_UPDATE"},function(t){s._updateSize(),s._updatePosition()})}},clear:function(){this._usableAreaUpdateEvent&&(i.unsubscribe(this._usableAreaUpdateEvent),delete this._usableAreaUpdateEvent),this._listbutton=[],this._panel&&(this._panel.destroy(),this._panel=null),this.stopMouseMoveEvent(),this._tokenWindowResized&&(i.unsubscribe(this._tokenWindowResized),this._tokenWindowResized=null)},getPositioningMethod:function(){return!this.options.curve&&this.options.startLinearPosition?n.PositioningMethod.Position:this.options.center?n.PositioningMethod.Center:n.PositioningMethod.Bottom},_findDuplicates:function(t){for(var e=t.length,i=[],s={},n=0;n<e;n++){s[o=t[n]]=s[o]>=1?s[o]+1:1}for(var o in s)s[o]>1&&i.push(o);return i},_testUniciyIdFromJson:function(){for(var t=[],e=0;e<this.options.lJsonElement.length;e++)"element"===this.options.lJsonElement[e].type&&t.push(this.options.lJsonElement[e].id);var i=this._findDuplicates(t);return!i||0===i.length},_setStyleChecked:function(t,e){e?t.addClassName("vcx-ui-state-checked"):t.removeClassName("vcx-ui-state-checked")},_setStyleEnabled:function(t,e){e?(t.removeClassName("vcx-ui-state-disabled"),t.icon.removeClassName("vcx-ui-state-disabled")):(t.addClassName("vcx-ui-state-disabled"),t.icon.addClassName("vcx-ui-state-disabled"))},_inputDiv:function(t,e){var i=UWA.createElement("div",{html:"",id:t,class:t}).inject(e);return i.style.display="block",i},_createButton:function(t,i,s,n){var o=UWA.createElement("div",{class:"vcx-filter-Button",id:t.id,title:t.nls,styles:{display:"inline-block",position:"absolute",background:"rgb(255,255,255)",opacity:"1",top:s+"px",left:n+"px",borderRadius:"50%",width:this.options.widthElem+"px",height:this.options.heightElem+"px",cursor:"pointer"}}).inject(i),a=this._createButtonIcon(t.url).inject(o);o.icon=a,void 0===t.userdata&&(t.userdata=t.id);var l={button:o,userdata:t.userdata,callback:t.callback,callbackUpdate:t.callbackUpdate};this._listbutton.push(l);var r=this;return o.addEvent(e.POINTERUP,function(t){if(l.callback){var e={enable:!0,check:void 0};l.callbackUpdate&&l.callbackUpdate.call(o,e,l.userdata),e.enable&&l.callback.call(o,l.userdata)}r.updateCommandState()}),o},_createButtonIcon:function(t){var e=UWA.createElement("img",{});return e.src=t,e.setStyles({position:"absolute",display:"block",width:"100%",height:"100%",padding:this.options.padding+"px"}),e},_createPanel:function(){var t=UWA.createElement("div",{id:"vcx-filter-panel "+this.options.Idpanel,class:"vcx-filter-panel "+this.options.classpanel,styles:{position:"absolute",pointerEvents:"none",width:"auto",transition:"opacity 0.3s ease-in-out"}});return t.addEvent("dragstart",function(t){t.preventDefault()}),t},_createSeparator:function(t,e,i,s,n){var o;(o="bubble"===e?UWA.createElement("div",{class:"vcx-filter-Separator",styles:{position:"absolute",display:"inline-block",width:2*n+"px",height:2*n+"px",opacity:"0.45",borderRadius:"50%",background:"black"}}).inject(t):UWA.createElement("div",{class:"vcx-filter-Separator",styles:{position:"absolute",opacity:"1",width:2*n+"px",height:this.options.heightElem+"px",background:"-webkit-radial-gradient(50% 50%, circle, rgba(0, 0, 0, 0.6), rgba(0, 0, 0, 0.3) 40%, rgba(0, 0, 0, 0) 80%)"}}).inject(t)).style.top=i+"px",o.style.left=s+"px";var a={button:o,userdata:null,callback:null,callbackUpdate:null};return this._listbutton.push(a),o},_updateSize:function(){for(var t,e,i=0;i<this._listbutton.length;i++){var s=this._listbutton[i];if(s){var n=s.button.getBoundingClientRect();this._panelInfos.top=void 0===this._panelInfos.top?n.top:Math.min(this._panelInfos.top,n.top),this._panelInfos.left=void 0===this._panelInfos.left?n.left:Math.min(this._panelInfos.left,n.left),t=void 0===t?n.right:Math.max(t,n.right),e=void 0===e?n.bottom:Math.max(e,n.bottom)}}this._panelInfos.width=t-this._panelInfos.left,this._panelInfos.height=e-this._panelInfos.top,this._panel.style.width=this._panelInfos.width+"px",this._panel.style.height=this._panelInfos.height+"px"},_calcBottomPosition:function(){if(null!==this.options.body){if(this.options.experienceBase){var t=this.options.experienceBase.getManager("VCXGUIManager"),e=t&&t.getUsableArea(),i=e&&e.getBoundingClientRect();this._panelInfos.left=i.left+(i.width-this._panelInfos.width)/2}else this._panelInfos.left=(parseInt(this.options.body.offsetWidth)-this._panelInfos.width)/2;this._panelInfos.left+=this.options.widthElem/2;var s=parseInt(this.options.frmWindow.getContent().offsetHeight);if(this.options.actionBar&&this.options.actionBar.elements&&this.options.actionBar.elements.container){var n=parseInt(this.options.actionBar.elements.container.offsetHeight);this._panelInfos.top=s-2*n}else this._panelInfos.top=s-145}},_calcStartLinearPosition:function(){this._panelInfos.left=this.options.startLinearPosition.x,this._panelInfos.top=this.options.startLinearPosition.y},_calcCenterPosition:function(){var t=0;void 0!==this.options.startAngle&&(t=Math.PI*this.options.startAngle/180);var e=Math.cos(t)*this.options.radius,i=Math.sin(t)*this.options.radius;this._panelInfos.left=this.options.center.x+e,this._panelInfos.top=this.options.center.y-i},_updatePosition:function(){switch(this.getPositioningMethod()){case n.PositioningMethod.Position:this._calcStartLinearPosition();break;case n.PositioningMethod.Center:this._calcCenterPosition();break;case n.PositioningMethod.Bottom:this._calcBottomPosition()}this._panelInfos.top-=this.options.heightElem/2,this._panelInfos.left-=this.options.widthElem/2,this._panelInfos.top-=this.options.heightOffset,this._panel.style.top=this._panelInfos.top+"px",this._panel.style.left=this._panelInfos.left+"px"},_getElementRadius:function(t){return"separator"===t.type?"bubble"===this.options.typeSeparator?1.5:3:this.options.widthElem/2},_calcDemiAngle:function(t){var e=this.options.radius;return Math.asin(t/e)},_calcElementDemiAngle:function(t){var e=this._getElementRadius(t);return this._calcDemiAngle(e)},_calcStartAngle:function(t){if(null!=this.options.startAngle){var e=Math.PI*this.options.startAngle/180;return this.options.curve||(e-=Math.PI/2),e}for(var i=0,s=this.options.lJsonElement.length,n=0;n<s;n++){i+=2*this._calcElementDemiAngle(this.options.lJsonElement[n]),n!=s-1&&(i+=t)}return e=1.5*Math.PI-i/2},_createFilter:function(){this._panel=this._createPanel();for(var t=this.options.lJsonElement.length,e=0;e<t;e++){var s=this.options.lJsonElement[e];switch(s.type){case"separator":var n=this._getElementRadius(s);this._createSeparator(this._panel,this.options.typeSeparator,0,0,n);break;case"element":var o=this._createButton(s,this._panel,0,0);o&&(o.setAttribute("data-rec-id",this.options.Idpanel+"_"+s.id),o.icon&&o.icon.setAttribute("data-rec-id",this.options.Idpanel+"_img_"+s.id));break;case"spacer":this._listbutton.push(null);break;default:console.error("element type not known")}}if(this.startMouseMoveEvent(),this.options.body){this._panel.inject(this.options.body);var a=this;this._tokenWindowResized=i.subscribe({event:"/VISU/onWindowResized"},function(t){"@onWindowResized"===t.eventType&&a.options.updateOpacity&&a._updatePosition()})}},updateLayout:function(t,e){if(this._panel){t&&(this.options.center=t),e&&(this.options.radius=e);var i=this.options.lJsonElement.length;!this.options.center&&i<=3&&(this.options.curve=!1),this.options.curve||(this.options.radius=1e6);var s=this._calcDemiAngle(10),n=0,o=0,a=this._calcStartAngle(s),l=this.options.radius,r=1;this.options.clockwise||(r=-1);n=0,o=0;for(var h=0;h<i;h++){var p=this.options.lJsonElement[h];if("spacer"!==p.type){var c=this._calcElementDemiAngle(p);(!this.options.startAngle||h>0)&&(a+=c*r);var u=Math.cos(a)*l,d=Math.sin(a)*l;0===h&&(n=u,o=-d);var f=u-n,_=-d-o,v=this._getElementRadius(p),b=_-("separator"===p.type&&"bubble"===this.options.typeSeparator?v:this.options.heightElem/2),g=f-v,m=this._listbutton[h].button;if("separator"===p.type){var y=m;if("bubble"!==this.options.typeSeparator){var I=90-180*a/Math.PI;y.style.transform="rotate("+I+"deg) rotateY(85deg)"}}b+=this.options.heightElem/2,g+=this.options.widthElem/2,m.style.top=b+"px",m.style.left=g+"px",a+=(c+s)*r}else{void 0!==p.spacerAngle?a+=Math.PI*p.spacerAngle/180*r:null!=p.spacerStartAngle&&(a=Math.PI*p.spacerStartAngle/180),void 0!==p.spacerClockwise&&(r=p.spacerClockwise?1:-1)}}this._updateSize(),this._updatePosition()}},updateCommandState:function(){for(var t=0;t<this._listbutton.length;t++){var e=this._listbutton[t];if(e){var i=e.button,s=e.callbackUpdate;if(s){var n={enable:!0,check:void 0};s.call(i,n,e.userdata),void 0!==n.enable&&this._setStyleEnabled(i,n.enable),void 0!==n.check&&this._setStyleChecked(i,n.check)}}}},startMouseMoveEvent:function(){var t=this.options.minOpacity,i=this.options.maxOpacity,s=this;this._callbackMouseMove=function(e){if(s._mouseX=e.clientX,s._mouseY=e.clientY,s.options.updateOpacity){var n=1*s._panelInfos.height,o=2*s._panelInfos.height,a=e.clientY,l=(Math.abs(s._panelInfos.top-a)*(i-t)-o+t*n)/(n-o);l=Math.max(l,t),l=Math.min(l,i),l=Math.sqrt(l),s._panel.style.opacity=l}else{var r=s.isInCircle();s.setMouseOn(r),s.updateVisibilityStyle()}},this.options.frmWindow.getContent().addEvent(e.POINTERMOVE,this._callbackMouseMove)},stopMouseMoveEvent:function(){this._callbackMouseMove&&this.options.frmWindow.getContent().removeEvent(e.POINTERMOVE,this._callbackMouseMove)},setRelatedOpacity:function(t){this._relatedOpacity=t},getRelatedOpacity:function(){return this._relatedOpacity},setState:function(t,e){t?this._state|=e:this._state&=~e},setVisible:function(t){this.setState(t,n.State.Visible)},isVisible:function(){return this._state&n.State.Visible},setSelected:function(t){this.setState(t,n.State.Selected)},isSelected:function(){return this._state&n.State.Selected},setMouseOn:function(t){this.setState(t,n.State.MouseOn)},isMouseOn:function(){return this._state&n.State.MouseOn},setInManipulation:function(t){this.setState(t,n.State.InManipulation)},isInManipulation:function(){return this._state&n.State.InManipulation},_show:function(t){this._panel.style.opacity=t?1:0},updateVisibilityStyle:function(){this._panel&&(this.isVisible()&&!this.isInManipulation()?this._panel.style.display="block":this._panel.style.display="none",this.isSelected()?this._show(this.getRelatedOpacity()&&!0):this._show(this.getRelatedOpacity()&&this.isMouseOn()))},isInCircle:function(){var t=this.options.center,e=this.options.radius,i=this.options.widthElem,s=this._mouseX-t.x,n=this._mouseY-t.y;return Math.sqrt(s*s+n*n)<=e+i}});return n.PositioningMethod={Position:1,Center:2,Bottom:3},n.State={Visible:1,Opacity:2,Selected:4,MouseOn:8,InManipulation:16},n.Separator={type:"separator"},n});