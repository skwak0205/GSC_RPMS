!window.widget||window.ds&&window.ds.isMDE||define("DS/UWPClientCode/UWA/Environment",["DS/CAT3DSKBootstrap/CAT3DSketchWidgetEnv"],function(e){return e}),define("DS/CAT3DSKBootstrap/CAT3DSketchWidgetEnv",["UWA/Core","DS/UWPClientCode/Boot/Environment"],function(e,t){"use strict";return t.extend({updatePlatformInfoIcon:function(){},buildSkeleton:function(){var t=this.wp,s=e.createElement,i=this.html;i.module.classList.contains("module")||(i.module=s("div",{class:"module",styles:{width:"100%",height:"100%"}}).inject(i.module)),i.module.classList.add("wi-"+this.wp.id),i.wrapper=s("div",{class:"moduleWrapper",styles:{width:"100%",height:"100%"}}).inject(i.module),t.isContainer?(i.body=i.wrapper,i.module.classList.add("moduleLayout")):i.body=s("div",{class:"moduleContent w-"+t.widgetId}).inject(i.wrapper)}})}),define("DS/CAT3DSKBootstrap/CAT3DSKBootstrapHelper",["UWA/Class","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/CAT3DSKBootstrap/CAT3DSketchWidgetEnv","DS/UWPClientCode/WidgetFactory","DS/i3DXCompass/i3DXCompass"],function(e,t,s,i,a){var n=e.extend({init:function(){this._parent()},createWidget:function(e,t,n,o){e?(!window.widget||window.ds&&window.ds.isMDE||window.ds&&window.ds.swymIM&&window.ds.env&&"MOBILE"===window.ds.env)&&!window.bundles.ifwe?a.getAppInfo({appId:"X3DSKET_AP",onComplete:function(a){var n=a.launchInfos;a.platforms.length&&a.platforms.forEach(function(e){e.id==t.swymTenant.toUpperCase()&&(n=e.launchInfos)});var d={widgetId:n,isolationLevel:1,el:e,parent:!0,preview:!1,header:!1,data:JSON.stringify({params:t})};i.load(d,o,s,function(){console.error("cannot load 3dsketch widget")})}.bind(this)}):top.require("DS/i3DXCompass/i3DXCompass").getAppInfo({appId:"X3DSKET_AP",onComplete:function(i){var a=i.launchInfos;i.platforms.length&&i.platforms.forEach(function(e){e.id==t.swymTenant.toUpperCase()&&(a=e.launchInfos)});var n={widgetId:a,isolationLevel:1,el:e,parent:!0,preview:!1,appId:"X3DSKET_AP",header:!1,data:JSON.stringify({params:t}),token:i.checksum};top.require("DS/UWPClientCode/WidgetFactory").load(n,o,s,function(){console.error("cannot load 3dsketch widget")})}.bind(this)}):console.error("IFrame creation error : container is null")},createIFrame:function(e,s,i,a){if(e){if(s){var n=document.createElement("iframe");return n.style.position="relative",n.style.width="100%",n.style.height="100%",n.style.border="0px",n.style.top="0px",n.style.left="0px",n.allowFullScreen=n.mozAllowFullScreen=n.webkitAllowFullScreen=!0,n.onload=function(){UWA.debug&&console.timeEnd("[PERFO - 3DSketch] iFrame creation time");var e=JSON.stringify(i),t={message:JSON.parse(e),type:a+":sendData"};n.contentWindow.postMessage(t,"*")},t.getServiceUrl({public:!1,serviceName:"my3dexperience",platformId:i.swymTenant.toUpperCase(),onComplete:function(t){var i=t+"/resources/3DSketch/en/webapps/"+s;n.src=i,e.appendChild(n)}.bind(this)}),n}console.error("IFrame creation error : source is null")}else console.error("IFrame creation error : container is null")}});return UWA.namespace("DS/CAT3DSKBootstrap/CAT3DSKBootstrapHelper",n)}),define("DS/CAT3DSKBootstrap/CAT3DSketchBootstrap",["UWA/Class","UWA/Core","DS/CAT3DSKBootstrap/CAT3DSKBootstrapHelper","DS/UWPClientCode/PublicAPI","DS/WAFData/WAFData","DS/PlatformAPI/PlatformAPI"],function(e,t,s,i,a,n){"use strict";var o=e.extend({init:function(){this._parent(),this._widget=null,this._name="3DSketch",this._onReceiveMessage=null,this._configList=["app.swymfeature.activateSketchCoreview","app.swymfeature.activate3dsktSupport"]},create:function(e,o){o||(console.log("no params"),o={});var d=new s;if(o.widgetAppContext=!0,this._configList.length)for(var r=null,l=0;l<this._configList.length;l++)r=this._configList[l],o[r]=i.getApplicationConfiguration(r);o.coreview&&o.coreview.data&&o.coreview.data.communityId&&(o.threadType="dm",o.threadId=o.coreview.data.communityId),o&&o.model&&o.model._attributes&&o.model._attributes.format_3dsa&&"3dwb"===o.model._attributes.format_3dsa&&(o.edit=!0),o.swymTenant=n.getTenant(),o.debug=t.debug,"undefined"!=typeof ds&&(o.swymTenant||(o.swymTenant=ds.swymTenant),o.isMDE=ds.isMDE);var c=o.onShowMediaLib;c&&(o.useMediaLib=!0);var p=function(){d.createWidget(e,o,this._name,function(e){this._widget=e.widget}.bind(this))}.bind(this);o&&o.wakeUpUrl?a.authenticatedRequest(o.wakeUpUrl,{method:"GET",type:"json",onComplete:function(){p()},onFailure:function(){p()}}):p();var m=o.onContentPublishedInSwym,h=o.onActivateFullscreen,u=o.onDeactivateFullscreen;this._onReceiveMessage=function(e){if(e&&e.data&&e.data.type&&e.data.type.contains("3DSketch")){if(!this._widget||this._widget&&this._widget.body&&!this._widget.body.getParent())return void this.destroy();if("3DSketch:initPostMessage"===e.data.type&&(window.postMessageIframe=e.source),"3DSketch:endPublish"===e.data.type&&m&&m(e.data.message.data,e.data.message.threadId,e.data.message.threadType),"3DSketch:endEditPublish"===e.data.type){var t=e.data.message,s=t||{};this.onEndEditPublish(s),this.destroy()}"3DSketch:activateFullscreen"===e.data.type&&h&&o.edit&&h(),"3DSketch:deactivateFullscreen"===e.data.type&&u&&o.edit&&u(),e.data.type&&"3DSketch:showMediaLib"===e.data.type&&(this._mediaMessage={message:{hasSelectedMedias:!1},type:"3DSketch:hideMediaLib"},c(e.data.message.threadId,e.data.message.threadType,function(e,t,s){this._mediaMessage.message.hasSelectedMedias=!0,this._mediaMessage.message.selectedSwymMedias=e,this._mediaMessage.message.selectedDeviceMedias=t,this._mediaMessage.message.selectedDriveFiles=s}.bind(this),function(){setTimeout(function(){window.postMessageIframe.postMessage(this._mediaMessage,"*")}.bind(this),100)}.bind(this)))}}.bind(this),window.addEventListener("message",this._onReceiveMessage)},onChangeCollabMaster:function(e){console.log(e);var t={message:e,type:this._name+":onChangeCollabMaster"};window.postMessageIframe&&window.postMessageIframe.postMessage(t,"*")},startPublish:function(e){this.onEndEditPublish=e;var t={message:null,type:this._name+":startEditPublish"};window.postMessageIframe&&window.postMessageIframe.postMessage(t,"*")},destroy:function(){var e={message:null,type:this._name+":destroy"};window.postMessageIframe&&window.postMessageIframe.postMessage(e,"*"),this._widget&&(this._widget.destroy(),this._widget=null),window.removeEventListener("message",this._onReceiveMessage),this._onReceiveMessage=null}});return t.namespace("DS/CAT3DSKBootstrap/CAT3DSketchBootstrap",o)});