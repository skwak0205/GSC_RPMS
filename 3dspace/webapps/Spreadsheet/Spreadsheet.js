define("DS/Spreadsheet/CellModel",["UWA/Core","UWA/Event","DS/Core/Core"],function(e,t,i){"use strict";var n=-1;function o(e,t){this.defaultOptions={isHeader:!1,isStatic:!1,isHidden:!1,isEditable:void 0,isResizable:!0,value:void 0,rowID:0,columnID:0,manager:null,width:100,height:28,rowSpan:1,colSpan:1},this.options=e,this._parentElement=t,this._manager=this.options.manager,this._style=null,this._cellCssClasses=null,this._highlightClass="wux-datagrid-cell-highlighted",this._isActive=!1,this._isHighlighted=!1,this._isSelected=!1,this._isInWriteMode=void 0,this._viewIsUpdated=!1,this._id=n++}return o.prototype.destroy=function(){this.defaultOptions=null},o.prototype._getID=function(){return this._id},o.prototype.isMerged=function(){return 0===this.options.rowSpan&&0===this.options.colSpan},o.prototype.isEdited=function(){return this._isInWriteMode},o.prototype.setMergeState=function(e){e?(this.options.rowSpan=0,this.options.colSpan=0):(this.options.rowSpan=1,this.options.colSpan=1)},o.prototype.resetSpan=function(){for(var e=this.getRowID(),t=this.getColumnID(),i=this.getRowSpan(),n=this.getColSpan(),o=0;o<i;o++)for(var s=0;s<n;s++){var l=this._manager.getCell(e+o,t+s);l.setMergeState(!1),l._show()}},o.prototype.setRowSpan=function(e,t){this.options.rowSpan=e,this.options.shiftRowSpan=t},o.prototype.getRowSpan=function(){return this.options.rowSpan},o.prototype.setColSpan=function(e,t){this.options.colSpan=e,this.options.shiftColSpan=t},o.prototype.getColSpan=function(){return this.options.colSpan},o.prototype.notifyModelUpdate=function(){this._manager._modelEvents.publish({event:"cellModelUpdate",data:{},context:this})},o.prototype.setCellContent=function(e){this.options.oldValue=this.options.value,this.options.value=e},o.prototype.getCellContent=function(){return void 0!==this.options.value?this.options.value:""},o.prototype.setCoordinates=function(e,t){this.options.rowID=e,this.options.columnID=t},o.prototype.getRowID=function(){return this.options.rowID},o.prototype.getColumnID=function(){return this.options.columnID},o.prototype.getView=function(){return this._view},o.prototype.setView=function(e){this._view=e},o.prototype.setCellStyle=function(e){this._style=e},o.prototype.removeClass=function(e){if(this._cellCssClasses){var t=this._cellCssClasses.indexOf(e);-1!==t&&(this._cellCssClasses.splice(t,1),0===this._cellCssClasses.length&&(this._cellCssClasses=null))}},o.prototype.hasClass=function(e){return!!this._cellCssClasses&&-1!==this._cellCssClasses.indexOf(e)},o.prototype.addClass=function(e){null===this._cellCssClasses&&(this._cellCssClasses=[]),-1===this._cellCssClasses.indexOf(e)&&this._cellCssClasses.push(e)},o.prototype.getCssClasses=function(){return this._cellCssClasses||[]},o.prototype.active=function(){this._isActive=!0},o.prototype.inactive=function(){this._isActive=!1},o.prototype.isActive=function(){return this._isActive},o.prototype.isHighlighted=function(){return this._isHighlighted},o.prototype.highlight=function(){this._isHighlighted=!0},o.prototype.unhighlight=function(){this._isHighlighted=!1},o.prototype.isSelected=function(){return this._isSelected},o.prototype.select=function(){this._isSelected=!0,this.highlight()},o.prototype.unselect=function(){this._isSelected=!1,this.unhighlight()},o.prototype.getCellStyle=function(){return this._style},o.prototype._show=function(){this.options.isHidden=!1},o.prototype._hide=function(){this.options.isHidden=!0},o.prototype.isHidden=function(){return this.options.isHidden},o.prototype._getPositionInViewPort=function(){return{x:this._x,y:this._y}},o.prototype._getDimensions=function(){return{width:this._manager.getColumnsManager().getColumnWidth(this.options.columnID),height:this._manager.getRowsManager().getRowHeight(this.options.rowID)}},o}),define("DS/Spreadsheet/CellView",["UWA/Core","UWA/Controls/Abstract","DS/Core/PointerEvents","DS/Layouts/GridEngineCellAbstract","DS/UIBehaviors/ContextualMenuManager","DS/Utilities/Dom","DS/Utilities/Utils","DS/Menu/ContextualMenu","css!DS/Menu/assets/css/Menu.css"],function(e,t,i,n,o,s,l,a){"use strict";function r(e){var t=e.target||e.srcElement,i=t.currentStyle||window.getComputedStyle(t,null),n=parseInt(i.borderLeftWidth,10),o=parseInt(i.borderTopWidth,10),s=t.getBoundingClientRect();return{offsetX:e.clientX-n-s.left,offsetY:e.clientY-o-s.top}}return n.extend({defaultOptions:{isHeader:!1},init:function(e){this._parent(e),this.getGridEngine()._enableInteractiveSort(),this._dataGrid=this.options.parent,this._manager=this.options.gridEngine,this._isFlaggedForEdition=!1,this._cellProps={},this._cellInfos=null,this.elements.container.setAttribute("wux-uuid",this._uxid),this.options.isHeader&&(this._manager.options.resize.rows||this._manager.options.resize.columns)&&this._manageResize(),!0===this._dataGrid.options.enableDragAndDrop&&this._manageDragAndDrop();var t=this,i=this.getGridEngine()._getParent().options.onContextualEvent;if(i)a.addEventListener(this.elements.container,{callback:function(e){return i.callback.call(i.this,{context:e.context,infos:e.info,data:e.data,treeview:t.getCellInfos()})}});else{var n=this.getGridEngine().options.onContextualMenuReady,s=n;"function"==typeof n&&(s=function(){console.warn("[DS/Tree/TreeListView] onContextualMenuReady is now deprecated, please use the new onContextualEvent option instead");var e=t.getCellInfos();return n.call(t,e)}),o.listen({target:this.elements.container,nodes:s})}this._debouncedUpdateInternalParameters=l.debounce(function(){this.updateInternalParameters()}.bind(this),this.getGridEngine().options.performances.debounceCellInternalUpdateTimer)},destroy:function(){for(var e in s.removeAllEventsOnElement(this),this._debouncedUpdateInternalParameters=null,delete this._debouncedUpdateInternalParameters,this.elements)this.elements[e].dsView&&(this.elements[e].dsView=null,delete this.elements[e].dsView),this.elements[e].destroy&&this.elements[e].destroy();o.forget({target:this.elements.container}),this._cellInfos=null,this._manager=null,this._parent()},getCellInfos:function(){if(null===this._cellInfos){var e=this.getVirtualCoordinates(),t=this.getGridEngine(),i=t.getColumnOptions(e.virtualColumnID),n=i.dataIndex;return this._cellInfos={virtualRowID:e.virtualRowID,virtualColumnID:e.virtualColumnID,cellModel:t.getCell(e.virtualRowID,e.virtualColumnID),cellView:this,dataIndex:n,typeRepresentation:i.typeRepresentation,manager:t,isHeader:-1===e.virtualRowID||-1===e.virtualColumnID},this._cellInfos}return this._cellInfos},getCellModel:function(){var e=this.getVirtualCoordinates();return this.getGridEngine().getCellModel(e.virtualRowID,e.virtualColumnID)},getDragAndDropInfos:function(){return this._dataToBeTransferred},_clean:function(){this.elements.container.removeAttribute("virtual-row-id"),this.elements.container.removeAttribute("virtual-column-id"),this._cellModel&&(this._cellModel.setView(void 0),this._cellModel=void 0)},switchToWriteView:function(){var e=this.getCellInfos();this._isFlaggedForEdition=!0,e.cellModel._isInWriteMode=!0,this._updateView(),this.getGridEngine()._modelEvents.publish({event:"cell:write",data:e})},isInEditionMode:function(){return this.getCellInfos().cellModel._isInWriteMode},_buildWriteView:function(){var e=this.getCellInfos().cellModel,i=document.createAttribute("is-edited");if(this.getContent().setAttributeNode(i),!0===e._isInWriteMode){var n=this.getVirtualCoordinates().virtualColumnID,o=this.getGridEngine()._getViewForCell({cellView:this,virtualColumnID:n}).switchToWriteView.view.call(this,this.getCellInfos());void 0!==o&&(this._cellReadWriteView=o,this.elements.container.empty(),this._cellReadWriteView instanceof t?this.elements.container.appendChild(this._cellReadWriteView.getContent()):this.elements.container.appendChild(this._cellReadWriteView),this._cellReadWriteView.focus())}},_saveChanges:function(){var e=this._cellModel,t=this.getVirtualCoordinates().virtualColumnID,i=this.getGridEngine()._getViewForCell({cellView:this,virtualColumnID:t});e._isInWriteMode=!1;var n=this.getCellInfos();i.switchToReadView.callback.call(this,n),this.notifyModelUpdate()},notifyModelUpdate:function(){return this.getCellInfos().cellModel.notifyModelUpdate()},getWriteView:function(){return this._cellReadWriteView},switchToReadView:function(){var e=this.getCellInfos();this._isFlaggedForEdition=!1,e.cellModel&&(e.cellModel._isInWriteMode=!1,e.manager.updateCellView(e.virtualRowID,e.virtualColumnID)),this.getGridEngine()._modelEvents.publish({event:"cell:read-only",data:e})},_onChange:function(e){var t=this.getCellInfos();t.manager.setCellContent(t.virtualRowID,t.virtualColumnID,e.target.value),t.cellModel.notifyModelUpdate()},_buildReadView:function(){this.getContent().removeAttribute("is-edited");var e=this;if(this._cellModel){var t=this.getCellInfos(),i=this.getGridEngine().getColumnOptions(t.virtualColumnID);if(2!==this.getGridEngine()._getParent()._getEditionMode()&&i&&"function"==typeof i.onCellRequest)e.getGridEngine()._isRequestingCell=!0,this._cellReadWriteView=i.onCellRequest.call(t.manager,t),e.getGridEngine()._isRequestingCell=!1;else{var n=e.getGridEngine()._getViewForCell({cellView:e,virtualColumnID:t.virtualColumnID});if(n){var o=n.switchToReadView.view.call(this._cellModel,this.getCellInfos());void 0!==o&&(this._cellReadWriteView=o,"string"==typeof this._cellReadWriteView?!1===l.getUnsafeHTMLContentValueToApply(e.getGridEngine().options.shouldCellAllowUnsafeHTMLContentAt(t))?this.elements.container.textContent=this._cellReadWriteView:this.elements.container.innerHTML=this._cellReadWriteView:this.elements.container.setContent(this._cellReadWriteView),this._cellModel._isInWriteMode=!1)}}}},_updateView:function(){this.getCellInfos().cellModel._isInWriteMode?this._buildWriteView():this._buildReadView()},active:function(){this._cellModel.active(),this.elements.container.addClassName("wux-ui-state-active")},inactive:function(){this._cellModel.inactive(),this.elements.container.removeClassName("wux-ui-state-active")},beginEdition:function(){this._isFlaggedForEdition=!0,this.getGridEngine().updateView()},endEdition:function(){this._isFlaggedForEdition=!0,this.getGridEngine().updateView()},highlight:function(){this._cellModel&&(this._cellModel._isHighlighted=!0),this._isHighlighted=!0,this.elements.container.addClassName(this._cellModel._highlightClass)},unhighlight:function(){this._cellModel&&(this._cellModel._isHighlighted=!1),this._isHighlighted&&(this._isHighlighted=!1,this.elements.container.removeClassName(this._cellModel._highlightClass))},select:function(){this._lastClickTime=Date.now(),this._cellModel._isSelected=!0,this.highlight()},unselect:function(){this._lastClickTime=0,this._cellModel._isSelected=!1,this.unhighlight()},_manageResize:function(){var t=this;t.getGridEngine()._enableInteractiveSort();var n,o,l,a,u=5,d=this.elements.container,c=!1;s.addEventOnElement(this,d,i.POINTERMOVE,function(e){if(!p){var i=t.getCellInfos();n=i,o=i.manager,a=o.getColumnWidth(n.virtualColumnID),l=o.getRowHeight(n.virtualRowID);var s=r(e);-1===n.virtualRowID&&o.options.resize.columns&&(s.offsetX<a+u&&s.offsetX>a-u?(t._setResizeStyle("r"),c=!0):(t._setResizeStyle(),c=!1)),-1===n.virtualColumnID&&o.options.resize.rows&&(s.offsetY<l+u&&s.offsetY>l-u?(t._setResizeStyle("b"),c=!0):(t._setResizeStyle(),c=!1))}});var h,m,g=!1,p=!1,w={},f={},v=(e.extendElement(document),0),C=1/0;s.addEventOnElement(this,d,i.POINTERDOWN,function(e){"touchstart"===e.originalEvent.type&&(c=!0,u=32,n=t.getCellInfos(),o=t.getGridEngine(),a=o.getColumnWidth(n.virtualColumnID),l=o.getRowHeight(n.virtualRowID));var i=r(e);if(c&&(-1===n.virtualColumnID&&i.offsetY<l+u&&i.offsetY>l-u||-1===n.virtualRowID&&i.offsetX<a+u&&i.offsetX>a-u)){e.preventDefault(),o.getScroller().getContent().addClassName("wux-ui-locked"),o.lockUI(),w={x:e.clientX,y:e.clientY},h=a,m=l,p=!0;var s=t.getGridEngine()._getColumnOptionValue(n.virtualColumnID,"maxWidth");C=void 0!==s?s:1/0,v=t.getGridEngine()._getColumnOptionValue(n.virtualColumnID,"minWidth"),t.getGridEngine()._disableInteractiveSort(!0)}}),s.addEventOnElement(this,document,i.POINTERMOVE,function(e){p&&c&&(g||t.getGridEngine()._disableInteractiveSort(),g=!0,f.x=e.clientX-w.x,f.y=e.clientY-w.y,-1===n.virtualRowID&&a+f.x>=v&&a+f.x<=C&&(h=a+f.x,t._manager._updateViewOptions={detachAllViews:!1,updateCells:!1,updateColumnsHeaders:!0},o._instance._showColumnInsertionMark(-o.getScroller().getPosition().x+o.getHeadersDimensions().width+o.getColumnPosition(n.virtualColumnID)+h)),-1===n.virtualColumnID&&(m=l+f.y)>=0&&o._instance._showRowInsertionMark(-o.getScroller().getPosition().y+o.getHeadersDimensions().height+o.getRowPosition(n.virtualRowID)+m))}),s.addEventOnElement(this,document,i.POINTERUP,function(e){p&&(e.preventDefault(),e.stopPropagation(),t._setResizeStyle(),t.elements.container&&t.elements.container.removeClassName("wux-ui-state-active"),setTimeout(function(){t.getGridEngine()._enableInteractiveSort()},300),-1!==n.virtualRowID&&o.setRowHeight(n.virtualRowID,m),-1!==n.virtualColumnID&&(o.prepareUpdateView(),o.setColumnWidth(n.virtualColumnID,h),o._requireFullUpdate(),t._manager._updateViewOptions={detachAllViews:!0,updateCells:!0,updateColumnsHeaders:!0},o._recordInteractionFromUI({event:"column:resize",data:{dataIndex:n.dataIndex,width:h}}),o.pushUpdateView(!0)),o._instance._hideRowInsertionMark(),o._instance._hideColumnInsertionMark(),o.unlockUI(),p=!1,c=!1)})},_setResizeStyle:function(e){var t=this.elements.container;e?t.addClassName("wux-datagrid-header-resize-"+e):(t.removeClassName("wux-datagrid-header-resize-l"),t.removeClassName("wux-datagrid-header-resize-r"),t.removeClassName("wux-datagrid-header-resize-t"),t.removeClassName("wux-datagrid-header-resize-b"))},_manageDragAndDrop:function(){this.getContent().setAttribute("draggable",!0)},getPosition:function(){var e=this.getGridEngine(),t=this.getVirtualCoordinates(),i=t.virtualRowID,n=t.virtualColumnID,o=e.getCellModel(t.virtualRowID,t.virtualColumnID);o&&(o.options.shiftRowSpan&&(i+=o.options.shiftRowSpan),o.options.shiftColSpan&&(n+=o.options.shiftColSpan));var s=e.getCellPosition(i,n);return s.top<0&&(s.top=0),s.left<0&&(s.left=0),s},getDimensions:function(){var e=this.getGridEngine(),t=this.getVirtualCoordinates();return{width:e.getColumnWidth(t.virtualColumnID),height:e.getRowHeight(t.virtualRowID)}},_setVirtualCoordinates:function(e){this._virtualRowID=e.virtualRowID,this._virtualColumnID=e.virtualColumnID,this._dataGrid=this.options.parent,this._manager=this._dataGrid._cellsManager,this._cellInfos=null;var t=this.getVirtualCoordinates(),i=this.getCellInfos();this._cellModel=i.cellModel;var n=this.getGridEngine().getDataIndexFromColumnID(e.virtualColumnID);void 0!==e.rowID&&this.elements.container.setAttribute("row-id",e.rowID),void 0!==e.columnID&&this.elements.container.setAttribute("column-id",e.columnID),this.elements.container.setAttribute("data-index",n),this.elements.container.setAttribute("virtual-row-id",this._virtualRowID),this.elements.container.setAttribute("virtual-column-id",this._virtualColumnID),this.getGridEngine().options.performances.use2PassRendering&&this.elements.container.addClassName("wux-ui-tombstone");var o=this.getCellInfos();o.data={rowID:e.virtualRowID,columnID:e.virtualColumnID},o.model=this._cellModel,o.view=this.elements.container,o.parent=this._dataGrid,this._dataToBeTransferred={from:o,data:{rowID:t.virtualRowID,columnID:t.virtualColumnID}},this._drag&&this._drag.updateDataToBeTransferred(this._dataToBeTransferred);var s=this.getCellModel();s&&(s.options.rowID=e.virtualRowID,s.options.columnID=e.virtualColumnID,s.options.virtualRowID=e.virtualRowID,s.options.virtualColumnID=e.virtualColumnID,s._view=this)},_free:function(){this._reusableContent&&(this._reusableContent.__disposable__.dispose(),this._reusableContent=void 0,this._parent())},_resetCell:function(){var e=this.elements.container,t=this.getCellInfos();t.isHeader||(t.cellModel._isInWriteMode=!1),-1===t.virtualRowID&&(e.removeClassName("wux-ui-sort-desc"),e.removeClassName("wux-ui-sort-asc"))},updateInternalParameters:function(){var e=this,t=this.getCellInfos(),i=this.elements.container,n=t.cellModel,o=!0;if(this._resetCell(),this._dataGrid=this.options.parent,this._manager=t.manager,this._cellModel=n,n){-1===t.virtualRowID&&i.hasClassName("wux-ui-sort-desc")&&i.removeClassName("wux-ui-sort-desc"),-1===t.virtualRowID&&i.hasClassName("wux-ui-sort-asc")&&i.removeClassName("wux-ui-sort-asc"),t.virtualRowID%2==0?i.addClassName("wux-datagrid-cell-even"):i.removeClassName("wux-datagrid-cell-even"),i.dsView=this,n.setView(e);var l=n.getCssClasses();l.length>0&&(l.forEach(function(e){i.removeClassName(e)}),i.addClassName(l.join(" "))),e._cellProps.isActive!==n.isActive()&&(n.isActive()?e.active():e.inactive(),e._cellProps.isActive=n.isActive()),n.isHighlighted()?e.highlight():e.unhighlight(),e._cellProps.isHighlighted=n.isHighlighted(),n.getCellStyle()&&i.setStyles(n.getCellStyle()),n._isInWriteMode||-1===t.virtualRowID||-1===t.virtualColumnID||e._updateView(),o=!!n.isHidden();var a,r,u=n.getRowSpan(),d=n.getColSpan(),c=0,h=0;if(u>1)for(var m=0;m<u;m++)h+=this._manager.getRowHeight(t.virtualRowID+m);else h=this.getDimensions().height;if(d>1)for(m=0;m<d;m++){c+=this._manager.getColumnWidth(t.virtualColumnID+m+n.options.shiftColSpan)}else c=this.getDimensions().width;var g={};if(c!==this._cellProps.width&&(this._cellProps.width=c,a=c,g.width=a),h!==this._cellProps.height&&(this._cellProps.height=h,r=h,g.height=r,g.lineHeight=r-1+"px"),s.setStyles(i,g),0!==h&&0!==c&&!o||-1===t.virtualColumnID)i.removeAttribute("is-hidden");else{var p=document.createAttribute("is-hidden");i.setAttributeNode(p)}}this._parent(),this.getGridEngine().options.performances.use2PassRendering&&i.removeClassName("wux-ui-tombstone")},hide:function(){this.elements.container.hide()},updateView:function(){var e=this.getVirtualCoordinates();this.getGridEngine().updateCellView(e.virtualRowID,e.virtualColumnID)},_cancelChanges:function(){}})}),define("DS/Spreadsheet/Manager",["UWA/Core","UWA/Event","UWA/Controls/Abstract","DS/Core/Core","DS/Spreadsheet/CellView","UWA/Class","DS/CoreEvents/ModelEvents","DS/Spreadsheet/CellModel","UWA/Utils","DS/Selection/XSO","DS/Layouts/GridEngine","DS/Utilities/Dom","DS/Core/PointerEvents","DS/UIBehaviors/ContextualMenuManager","DS/Core/ActionsStack","DS/Utilities/Data","DS/Utilities/Array","DS/Utilities/Debug","DS/Controls/Switch","DS/SmartInputs/Number","DS/SmartInputs/Angle","DS/SmartInputs/EulerOrientation","DS/SmartInputs/Distance","DS/SmartInputs/Vector3","DS/Controls/Button","DS/Controls/Toggle","DS/Utilities/Utils","DS/Menu/ContextualMenu","DS/WebRecordEnabler/Adapter","css!DS/Menu/assets/css/Menu.css"],function(e,t,i,n,o,s,l,a,r,u,d,c,h,m,g,p,w,f,v,C,_,D,I,b,R,x,S,M,E){"use strict";var V=!1,y="click",O="dblClick";function A(e,t){var i=e;if(i)return(" "+i.className+" ").replace(/[\n\t]/g," ").indexOf(" "+t+" ")>-1?i:A(i.parentNode,t)}function P(e,t){return(" "+e.className+" ").replace(/[\n\t]/g," ").indexOf(" "+t+" ")>-1}var H=w.optimizedForEach,T=d.extend({defaultOptions:{onCellChange:function(e){return e.event.target.value},scroller:null,viewport:null,sortFunction:function(e,t,i,n){var o=t[e].getCellContent(),s=i[e].getCellContent();return o===s?0:"desc"!==n?o<s?-1:1:o>s?-1:1}},init:function(t,i){if(t.isEditable){var n={switchToWriteView:{event:"dblclick",callback:function(e){this.switchToWriteView()},view:function(t){if(!t.isHeader){var i=t.cellModel.getCellContent().toString(),n=new e.Element("input",{type:"text",value:i,class:"wux-layouts-treeview-label"});return setTimeout(function(){n.setSelectionRange(0,n.value.length)},10),n}}},switchToReadView:{event:"blur",callback:function(e){this.switchToReadView()},view:function(e){if(!e.isHeader){var t,i=e.cellModel.getCellContent().toString();return t="string"==typeof i?i:i.toString(),e.dataIndex,t}}},nodesAreDraggable:!0,cells:!0};!0===t.isEditable?t.isEditable=n:t.isEditable=e.extend(n,t.isEditable,!0)}this._parent(t);var o=this;this._instance=i,this._highlightedRows=new u({eventChannel:"/MANAGER/"+r.getUUID()}),this._selectedRows=new u({useUniqueID:!0,getElementID:function(e){return e},publishOnlyPrePostEvents:!0,eventChannel:"/MANAGER/"+r.getUUID(),areEquals:function(e,t){return e===t}}),this._selectedColumns=new u({eventChannel:"/MANAGER/"+r.getUUID()}),this._selectedCells=new u({useUniqueID:!0,publishOnlyPrePostEvents:!0,eventChannel:"/MANAGER/"+r.getUUID(),areEquals:function(e,t){return e._getID()===t._getID()}}),this._modeIsMultiSel=!1,this._modeIsRange=!1,this._allowSettingMultiSelMode=!1,this._multiSelModeHasBeenForced=!1,this._selectedRows.empty(),this._selectedColumns.empty(),this._selectedCells.empty(),this._scroller=null,this._viewport=null,this._leftStaticContainer=null,this._topStaticContainer=null,this._cellsContainer=null,this._isPreparingView=0,this._abortComputing=!1,this._listOfColumnIsEditableOptionsCached=[],this.options.model=[],this._cellsContentList=[],this._rowsList=[],this._columnsList=[],this._rowIndexes=[],this._listOfColumns=[],this._listOfColumnStates=[],this._listOfCellsInViewPort=[],this._listOfRowsPosition=[],this._listOfColumnPosition=[],this._listOfRowsHeight=[],this._listOfRowsPreviousHeight=[],this._listOfColumnsWidth=[],this._listOfColumnsPreviousWidth=[],this._listOfEditedCells=[],this._columnsReverseIndex=null,this._currentViewPort={rowMin:0,rowMax:0,columnMin:0,columnMax:0},this._previousViewPort={rowMin:0,rowMax:0,columnMin:0,columnMax:0},this._minVisibleCellCoordinates={rowID:1,columnID:1},this._maxVisibleCellCoordinates={rowID:1,columnID:1},this._lastScrollPos={x:0,y:0},this._deltaScrollPos={x:0,y:0},this.registerReusableCellContent({id:"picture",buildContent:function(){var e=o.options.defaultCellHeight-10;return new c.createElement("div",{align:"center",styles:{width:e,height:e,borderRadius:2,backgroundSize:"cover",backgroundPosition:"center",display:"inline-block",border:"1px solid rgb(157, 157, 157)",verticalAlign:"middle",position:"absolute",top:"50%",marginTop:-e/2,left:"50%",marginLeft:-e/2}})}}),this.registerReusableCellContent({id:"color",buildContent:function(){var t=o.options.defaultCellHeight-10;return new e.Element("div",{align:"center",class:"wux-datagrid-cell-type-color",styles:{width:t/2,height:t,marginTop:-t/2,marginLeft:-t/4}})}}),this.onPoolCellCreation(this._onPoolCellCreation.bind(this)),this.onPoolCellDestruction(this._onPoolCellDestruction.bind(this)),this._observeSelMultiSel();var s=this,l=!1;this.onReady(function(){if(!1===l){c.addEventOnElement(this,this.elements.container,h.POINTERDOWN,function(){s._giveFocus()},!0);var t,i=this;c.addEventOnElement(this,this.getScroller().getContent(),"mouseover",function(e){var n=P(e.target,"wux-datagrid-cell")?e.target:A(e.target,"wux-datagrid-cell");n&&n!==t&&(i._modelEvents.publish({event:"newActiveCell",data:n.dsView.getCellInfos()}),t=n)}),c.addEventOnElement(this,this.getScroller().getContent(),"mouseleave",function(e){P(e.target,"wux-scroller")&&i._modelEvents.publish({event:"newActiveCell",data:null})});var n,o=this._getParent().options.onContextualEvent;if(o)M.addEventListener(this.elements.container,{callback:function(e){return o.callback.call(o.this,{context:e.context,infos:e.info,data:e.data,treeview:{manager:s}})}});else{var a=this.options.onContextualMenuReady,r=a;"function"==typeof a&&(r=function(){return console.warn("[DS/Tree/TreeListView] onContextualMenuReady is now deprecated, please use the new onContextualEvent option instead"),a.call(s,{manager:s})}),m.onReady({target:this.elements.container,nodes:r})}this.options.selection.unselectAllOnEmptyArea&&this._listenToClickOnEmptyArea(),this._listOfEditedCells=[],this._modelEvents.subscribe({event:"cell:write"},function(e){s._listOfEditedCells.length>0&&(s._listOfEditedCells.forEach(function(t){e.virtualRowID!==t.virtualRowID&&e.virtualColumnID!==t.virtualColumnID&&e.cellView.switchToReadView()}),s._listOfEditedCells=[]);var t=document.createAttribute("is-edited");e.cellView.getContent().setAttributeNode(t),s._listOfEditedCells.push(e)}),this._modelEvents.subscribe({event:"cell:read-only"},function(e){e.cellView.getContent().removeAttribute("is-edited"),s._listOfEditedCells.length>0&&(s._listOfEditedCells=[])}),this._getParent()._datagrid.getContent().addEvent("blur",function(e){if(setTimeout(function(){if(document.activeElement){var e=P(document.activeElement,"wux-afr-actionbar")?document.activeElement:A(document.activeElement,"wux-afr-actionbar"),t=P(document.activeElement,"wux-datagrid")?document.activeElement:A(document.activeElement,"wux-datagrid");t&&t.getAttribute("wux-uuid")===s._instance._uxid&&!e?s._giveFocus():s._lostFocus()}},1),e.relatedTarget){var t=c.firstParentWithClass(e.relatedTarget,"wux-datagrid");t&&t===this||i._multiSelModeHasBeenForced||(i._modeIsListSel=!1,i._modeIsMultiSel=!1)}else i._multiSelModeHasBeenForced||(i._modeIsListSel=!1,i._modeIsMultiSel=!1)},!0),this._getParent()._datagrid.getContent().addEvent("mouseleave",function(e){i._multiSelModeHasBeenForced||(i._modeIsListSel=!1,i._modeIsMultiSel=!1),i._allowSettingMultiSelMode=!1},!0),this._getParent()._datagrid.getContent().addEvent("mouseenter",function(e){i._allowSettingMultiSelMode=!1},!0),this._getParent()._datagrid.getContent().addEvent("mousemove",function(e){i._allowSettingMultiSelMode=!0},!0),this._getParent()._datagrid.getContent().addEvent("focus",function(e){if(s.elements.container){var t=P(e.target,"wux-datagrid-cell")?e.target:A(e.target,"wux-datagrid-cell"),i=s.elements.container.querySelector(".wux-datagrid-cell[is-edited]");if(i){var o=s._getCellViewFromDom(i);(t&&o.getContent().getAttribute("wux-uuid")!==t.getAttribute("wux-uuid")||void 0===t)&&o.switchToReadView()}t&&(n=t.getAttribute("wux-uuid")),s._giveFocus()}},!0),this._getParent().elements.formContainer.addEvent("blur",function(e){setTimeout(function(){var t=P(document.activeElement,"wux-datagrid-cell")?e.target:A(document.activeElement,"wux-datagrid-cell");t?t&&n!==t.getAttribute("wux-uuid")&&s._onCellBlur.call(s,e):(P(document.activeElement,"wux-afr-actionbar")?document.activeElement:A(document.activeElement,"wux-afr-actionbar"))||s._lostFocus()},1)},!0),this._getParent().elements.formContainer.addEvent("change",this._onCellChange.bind(this)),this._getParent().elements.formContainer.addEvent("submit",function(e){e.stopPropagation(),e.preventDefault();var t=document.createEvent("CustomEvent");return t.initCustomEvent("change",!0,!0,null),"BUTTON"!==document.activeElement.tagName&&A(document.activeElement,"wux-datagrid-cell")&&document.activeElement.dispatchEvent(t),s._giveFocus(),!1},!0),c.addEventOnElement(this,document,"keydown",function(t){"esc"===e.Event.whichKey(t)&&s._listOfEditedCells.length>0&&s._listOfEditedCells[0].cellView._cancelChanges()}),this.getScroller().onScroll(function(){s.__preventDragAndDropOnBlankDuringScrollFlag=!0,s.__preventDragAndDropOnBlankDuringScroll&&clearTimeout(s.__preventDragAndDropOnBlankDuringScroll),s.__preventDragAndDropOnBlankDuringScroll=setTimeout(function(){s.__preventDragAndDropOnBlankDuringScrollFlag=!1},500)})}l=!0})},destroy:function(){c.removeAllEventsOnElement(this),this._instance=null,delete this._instance,this._selectedCells.empty(),this._selectedCells=null,this.elements.container&&(m.forget({target:this.elements.container}),this.processPoolCells(function(e){m.forget({target:e.cellView.elements.container})}),w.clear(this._listOfColumnIsEditableOptionsCached),w.clear(this._cellsContentList),w.clear(this._rowsList),w.clear(this._columnsList),w.clear(this._rowIndexes),w.clear(this._listOfColumns),w.clear(this._listOfColumnStates),w.clear(this._listOfCellsInViewPort),w.clear(this._listOfRowsPosition),w.clear(this._listOfColumnPosition),w.clear(this._listOfRowsHeight),w.clear(this._listOfRowsPreviousHeight),w.clear(this._listOfColumnsWidth),w.clear(this._listOfColumnsPreviousWidth),this._parent())},_onCellBlur:function(e){var t=A(e.target,"wux-datagrid-cell");t&&this._getCellViewFromDom(t).switchToReadView()},_onCellChange:function(e){var t=A(e.target,"wux-datagrid-cell");if(t){var i=this._getCellViewFromDom(t),n=i.getCellInfos(),o=this._getViewForCell({cellView:i,virtualColumnID:n.virtualColumnID});return this.setCellContent(n.virtualRowID,n.virtualColumnID,e.target.value),n.event=e,o.switchToReadView.callback.call(i,n),i.notifyModelUpdate(),!1}},_computePoolSize:function(e,t){var i=this._computeModelSize();void 0===e&&(e=void 0!==this._poolDimensions.numberOfRows?this._poolDimensions.numberOfRows:i.numberOfRows),void 0===t&&(t=void 0!==this._poolDimensions.numberOfColumns?this._poolDimensions.numberOfColumns:i.numberOfColumns);var n,o,s,l,a=this.getViewportDimensions();s=Math.ceil(1*parseInt(a.height/this._getCellHeight(),10)*this.options.performances.numberOfRowsFactor),l=Math.ceil(1*parseInt(a.width/this._getCellWidth(),10)*this.options.performances.numberOfColumnsFactor),this.options.virtualView?(n=Math.ceil(Math.max(1,Math.min(s,e))+this._numberOfRowsToRemove),o=this.options.performances.enableColumnVirtualization?Math.ceil(Math.max(1,Math.max(Math.min(l,t),1))+this._numberOfColumnsToRemove):this.getNumberOfColumns()):(n=i.numberOfRows,o=i.numberOfColumns),this._poolSizeMax={numberOfRows:s,numberOfColumns:l},this._poolSize={numberOfRows:n,numberOfColumns:o},V&&(console.warn(this.options.id,"Viewport size",a.width,"x",a.height,"px"),console.warn(this.options.id,"Generate a pool of ",n,"x",o,"cells"))},needToIndexRowsPositions:function(){return!0},_onPoolCellCreation:function(e){e.cellView||(e=e.data);var t=this,i=e.cellView,n={screenX:0,screenY:0};if(e.cellView.getContent().addEvent(h.POINTERDOWN,function(e){n={screenX:e.screenX,screenY:e.screenY}}),e.cellView.getContent().addEvent(h.POINTERUP,function(i){(Math.abs(i.screenX-n.screenX)<5||Math.abs(i.screenY-n.screenY)<5)&&t._cellViewBindings.onCellPointerUp.call(e,i)}),e.cellView.getContent().addEvent("dblclick",t._cellViewBindings.onCellDblClick.bind(e)),t.options.isEditable){var o=i.getVirtualCoordinates(),s=t._getMergedOption("isEditable",o.virtualColumnID);e.cellView.getContent().addEvent(s.switchToWriteView.event,t._cellViewBindings.onEdition.bind(e))}},_onPoolCellDestruction:function(e){var t=this;e.cellView||(e=e.data);var i=e.cellView;if(e.cellView.getContent().removeEvent(h.POINTERUP,t._cellViewBindings.onCellPointerUp.bind(e)),e.cellView.getContent().removeEvent("dblclick",t._cellViewBindings.onCellDblClick.bind(e)),t.options.isEditable){var n=i.getVirtualCoordinates(),o=t._getMergedOption("isEditable",n.virtualColumnID);o&&e.cellView.getContent().removeEvent(o.switchToWriteView.event,t._cellViewBindings.onEdition)}},_cellViewBindings:{onCellPointerUp:function(e){var t=this.cellView.getCellInfos(),i=t.manager;t.cellView||(t=t.data);var n=t.cellView;if(0===e.button){var o=n.getVirtualCoordinates(),s=i.getCell(o.virtualRowID,o.virtualColumnID);i._modelEvents.publish({event:y,context:s,data:{model:s,view:n,cellModel:s,cellView:n,dataIndex:i.getDataIndexFromColumnID(o.virtualColumnID),virtualRowID:o.virtualRowID,virtualColumnID:o.virtualColumnID,isHeader:!(o.virtualColumnID>-1&&o.virtualRowID>-1)}})}},onCellDblClick:function(e){var t=this.cellView.getCellInfos(),i=t.manager;t.cellView||(t=t.data);var n=t.cellView,o=n.getVirtualCoordinates(),s=i.getCell(o.virtualRowID,o.virtualColumnID);i._modelEvents.publish({event:O,context:s,data:n.getCellInfos()})},onEdition:function(e){var t=this.cellView.getCellInfos(),i=t.manager;if(!t.cellView.getContent().getAttributeNode("is-edited")){var n=i._getViewForCell({cellView:t.cellView,virtualColumnID:t.virtualColumnID});t.event=e,n.switchToWriteView.callback.call(t.cellView,t)}}},loadModel:function(e,t){this._parent(e,t)},appendToModel:function(e,t){var i=this;i.prepareUpdateView(),H(e.data,function(e){i.addRow(e)}),i.pushUpdateView(),t&&t.call(this)},exportColumnsPreferences:function(){return JSON.stringify(this.options.columns)},restoreColumnsPreferences:function(t){var i=this,n=JSON.parse(t),o={};n.forEach(function(e,t){o[e.dataIndex]=t}),this.options.columns.forEach(function(t,s){e.extend(i.options.columns[s],n[o[t.dataIndex]],!0)}),this.updateView(!0)},_postInitialization:function(){this.options.model=(this.options.model.length,this.options.model),this._rowsList=[];for(var e=this.options.model.length,t=0;t<e;t++)this._rowsList[t]=new a({isHeader:!0,isStatic:!1,isEditable:!1,rowID:t,columnID:-1,value:"",manager:this});this._columnsList=[];for(var i=this.getNumberOfColumns(),n=0;n<i;n++)this._columnsList[n]=new a({isHeader:!0,isStatic:!1,isEditable:!1,rowID:-1,columnID:n,value:this.options.columns[n].text,manager:this});this._listenEvents()},_endResizeCallback:function(){this.elements&&this.elements.container&&(this._setColumnsWidth(),this._parent())},scrollToRow:function(e,t){var i,n=this.getRowPosition(e);switch(t){case"top":i=Math.max(n,0);break;default:case"middle":i=Math.max(n-this._viewportDimensions.height/2,0);break;case"bottom":i=Math.max(n-this._viewportDimensions.height+this.options.defaultCellHeight,0)}this.getScroller().setPosition({y:i},!0)},getCellModel:function(e,t){return-1===t?(this._rowsList[e]||(this._rowsList[e]=new a({isHeader:!0,isStatic:!1,isEditable:!1,rowID:e,columnID:-1,value:null,manager:this})),this._rowsList[e]):-1===e?(this._columnsList[t]||(this._columnsList[t]=new a({isHeader:!0,isStatic:!1,isEditable:!1,rowID:-1,columnID:t,value:null,manager:this})),this._columnsList[t]):this.options.model[e]&&this.options.model[e][t]?this.options.model[e][t]:void 0},_getCellsModel:function(){return this.options.model},_initialize:function(){},updateRowViewWithException:function(e,t){"string"==typeof t&&(t=this.getColumnIDFromDataIndex(t));var i=this;this.processCellsOfRow(e,function(e,n,o){o!==t&&i.updateCellView(n,o)}),this._preventNextRowUpdateView=!1},updateRowView:function(e){this._preventNextRowUpdateView||(this._preventNextRowUpdateView=!1,this._renderRow(e))},preventNextUpdateRowView:function(){console.log("prevent next update view"),this._preventNextRowUpdateView=!0},_doesCellNeedToDisplayed:function(e){return!e.cellModel.isMerged()},updateCellView:function(e,t){"string"==typeof t&&(t=this.getColumnIDFromDataIndex(t));var i=this.getVirtualViewport(!1);if(i.minRowID<=e&&e<=i.maxRowID&&i.minColumnID<=t&&t<=i.maxColumnID||-1===e||-1===t){var n=this.getCell(e,t);if(n){var o=n.getView(),s=this;o&&(o.updateInternalParameters(),-1===e?s._onRequestColumnHeaderCB.call(s,o.getCellInfos()):-1===t?s._onRequestRowHeaderCB.call(s,o.getCellInfos()):s._onRequestCellCB.call(s,o.getCellInfos()))}}},_observeSelMultiSel:function(){var t=this;this._multiSelModeHasBeenForced||(this._modeIsMultiSel=!1,this._modeIsListSel=!1),c.addEventOnElement(this,document,"keydown",function(i){switch(e.Event.whichKey(i)){case"alt+ctrl+shift":case"shift+alt":case"alt+shift":case"ctrl+shift":case"shift+ctrl":case"shift":t._modeIsListSel=!0,t._allowSettingMultiSelMode&&!t._multiSelModeHasBeenForced&&(t._modeIsMultiSel=!0);break;case"ctrl":t._allowSettingMultiSelMode&&!t._multiSelModeHasBeenForced&&(t._modeIsMultiSel=!0)}}),c.addEventOnElement(this,document,"keyup",function(i){var n=e.Event.whichKey(i);switch(n){case"alt+ctrl+shift":case"shift+alt":case"alt+shift":case"ctrl+shift":case"shift+ctrl":case"shift":t._multiSelModeHasBeenForced||(t._modeIsListSel=!1,t._modeIsMultiSel=!1);break;case"ctrl":t._multiSelModeHasBeenForced||(t._modeIsMultiSel=!1)}"enter"===n&&t._isInEdition&&(t._isInEdition=!1)})},isInMultiSelection:function(){return(this._modeIsMultiSel||this._modeIsListSel)&&this.options.selection.canMultiSelect},isInListSelection:function(){return this._modeIsMultiSel&&this._modeIsListSel&&this.options.selection.canMultiSelect},forceMultiSelection:function(e){void 0===e&&(e=!0),this._modeIsMultiSel=e&&this.options.selection.canMultiSelect,this._multiSelModeHasBeenForced=e},_listenToClickOnEmptyArea:function(){var e=this;c.addEventOnElement(this,this.elements.container,"click",function(t){-1!==t.target.className.indexOf("wux-scroller")&&e.unselectAll()})},_listenEvents:function(){var t=this;this.onMoveRow(function(e){t.processCellsOfRow(e.toRowID,function(t){t.options.rowID===e.fromRowID&&(t.options.rowID=e.toRowID)})}),this._selectedCells.onPostAdd(function(e){e.forEach(function(e){e.highlight(),e._view&&parseInt(e._view.elements.container.getAttribute("virtual-row-id"),10)===e.options.rowID&&parseInt(e._view.elements.container.getAttribute("virtual-column-id"),10)===e.options.columnID&&e._view.highlight()})}),this._selectedCells.onPostRemove(function(e){e.forEach(function(e){e.unhighlight(),e._view&&parseInt(e._view.elements.container.getAttribute("virtual-row-id"),10)===e.options.rowID&&parseInt(e._view.elements.container.getAttribute("virtual-column-id"),10)===e.options.columnID&&e._view.unhighlight()})}),c.addEventOnElement(this,document,"keydown",function(i){var n=e.Event.whichKey(i);"ctrl"!==n||t._modeIsMultiSel||!t._allowSettingMultiSelMode||t._multiSelModeHasBeenForced||(t._modeIsMultiSel=!0),"shift"!==n||t._modeIsRange||(t._modeIsRange=!0)}),c.addEventOnElement(this,document,"keyup",function(i){var n=e.Event.whichKey(i);"ctrl"!==n||t._multiSelModeHasBeenForced||(t._modeIsMultiSel=!1),"shift"===n&&t._modeIsRange&&(t._modeIsRange=!1)}),this.onCellPointerDown(function(e){var i=e.cellView.getVirtualCoordinates(),n=i.virtualRowID,o=i.virtualColumnID;V&&console.log("-----\x3e",this,e,n,o),t.__disableInteractiveSort||-1===o&&t.options.selection.rowHeaders&&(t.options.selection.canMultiSelect?t.isRowSelected(n)||(t.prepareUpdateView(),e.event.ctrlKey||t._selectedCells.empty(),t.selectRow(n,!e.event.ctrlKey),t.pushUpdateView()):(t.prepareUpdateView(),t._selectedCells.empty(),t.selectRow(n),t.pushUpdateView()))}),c.addEventOnElement(t,t.getContent(),"click",function(){t._hasBeenClicked=!0,setTimeout(function(){t._hasBeenClicked=!1},200)}),this.onCellClick(function(e){var i=e.cellModel,n=e.cellView.getVirtualCoordinates(),o=n.virtualRowID,s=n.virtualColumnID;if(!t.__disableInteractiveSort){if(-1===o){var l=t._getColumnOptionValue(s,"isSortable"),a=["sort:asc","sort:desc"],r=t._getColumnState(s);switch(function(e,t){void 0===t&&(t=0);var i=e.slice(0);return{getCurrent:function(){return i[t]},getNext:function(){return t=++t%i.length,this.getCurrent()},getPrevious:function(){return--t<0&&(t+=i.length),this.getCurrent()}}}(a,a.indexOf(r)).getNext()){case"sort:desc":l&&(t.prepareUpdateView(),t.sortColumnContent(s,{typeOfCell:"number",sortOrder:"desc"}),t.pushUpdateView());break;case"sort:asc":l&&(t.prepareUpdateView(),t.sortColumnContent(s,{typeOfCell:"number",sortOrder:"asc"}),t.pushUpdateView())}}if(-1!==o&&-1!==s&&t.options.selection.cells){if(t.prepareUpdateView(),t._preventNextUpdateView(),t.unselectAll({cells:!0,updateView:!1}),t._modeIsRange){var u,d,c,h,m,g,p=i,w=t._selectedCells.get()[0];t._selectedCells.empty(),t._selectedCells.add(w);var f=w.getView().getVirtualCoordinates(),v=p.getView().getVirtualCoordinates();for(f.virtualRowID<v.virtualRowID?(c=f.virtualRowID,h=v.virtualRowID):(h=f.virtualRowID,c=v.virtualRowID),u=c;u<=h;u++)for(f.virtualColumnID<v.virtualColumnID?(m=f.virtualColumnID,g=v.virtualColumnID):(g=f.virtualColumnID,m=v.virtualColumnID),d=m;d<=g;d++)if(u!==f.virtualRowID||d!==f.virtualColumnID){var C=t.getCell(u,d);t._selectedCells.add(C)}}else t._modeIsMultiSel?t._selectedCells.add(i):t._selectedCells.unique(i);t.pushUpdateView()}}})},_enableDisableInteractiveSort:S.debounce(function(){this.__disableInteractiveSort=this.__disableInteractiveSortNext,this.__disableInteractiveSort},1e3),_disableInteractiveSort:function(e){!0===e?(this.__disableInteractiveSort=!0,this.__disableInteractiveSortNext=!0):(this.__disableInteractiveSortNext=!0,this._enableDisableInteractiveSort())},_enableInteractiveSort:function(){this.__disableInteractiveSortNext=!1,this._enableDisableInteractiveSort()},getCell:function(e,t){if("string"==typeof t&&(t=this.getColumnIDFromDataIndex(t)),void 0!==t){var i=this.getCellModel(e,t);if(i&&(i.options.shiftRowSpan&&(e+=i.options.shiftRowSpan),i.options.shiftColSpan&&(t+=i.options.shiftColSpan)),-1===t)return this._rowsList[e]||(this._rowsList[e]=new a({isHeader:!0,isStatic:!1,isEditable:!1,rowID:e,columnID:-1,value:null,manager:this})),this._rowsList[e];if(-1===e)return this._columnsList[t]||(this._columnsList[t]=new a({isHeader:!0,isStatic:!1,isEditable:!1,rowID:-1,columnID:t,value:null,manager:this})),this._columnsList[t];if(this.options.model[e]&&this.options.model[e][t])return this.options.model[e][t]}},_getCellViewFromDom:function(e,t){if(!t)return e.dsView;var i=A(e,"wux-datagrid-cell");return i?i.dsView:void 0},_getCellViewDom:function(e,t){return"string"==typeof t&&(t=this.getColumnIDFromDataIndex(t)),this.elements.container.querySelector('.wux-datagrid-cell[virtual-row-id="'+e+'"][virtual-column-id="'+t+'"]')},_getCellView2:function(e,t){return"string"==typeof t&&(t=this.getColumnIDFromDataIndex(t)),this.elements.container.querySelector('.wux-datagrid-cell[virtual-row-id="'+e+'"][virtual-column-id="'+t+'"]').dsView},_getCellView:function(e,t){return"string"==typeof t&&(t=this.getColumnIDFromDataIndex(t)),-1===e?this._listOfRenderedColumnHeaders[e+"_"+t]:-1===t?this._listOfRenderedRowHeaders[e+"_"+t]:this._listOfRenderedCells[e+"_"+t]},getCellContent:function(e,t){var i=this.getCell(e,t);if(i)return i.getCellContent()},setCell:function(e,t,i){-1===t?this._rowsList[e]=i:-1===e?this._columnsList[t]=i:(void 0===this.options.model[e]&&(this.options.model[e]=[]),this.options.model[e][t]=i)},_getColumnIdentifiers:function(e){var t,i;return"string"==typeof e?(i=e,t=this.getColumnIDFromDataIndex(e)):(t=e,i=this.getDataIndexFromColumnID(e)),{literalColumnID:i,numericalColumnID:t}},setCellContent:function(e,t,i){var n,o,s=this.getCell(e,t);s&&("string"==typeof t?(o=t,n=this.getColumnIDFromDataIndex(t)):(n=t,o=this.getDataIndexFromColumnID(t)),s.setCellContent(i),this._modelEvents.publish({event:"changeContent",data:{cellModel:s,rowID:e,columnID:n,virtualRowID:e,virtualColumnID:n,dataIndex:o,value:i}}))},onCellContentChange:function(e){return this._modelEvents.subscribe({event:"changeContent"},e)},getRow:function(e,t){var i;switch(i=-1===e?this._columnsList:this.options.model[e],void 0===t&&(t=0),t){default:case 0:return i;case 1:var n={};return H(this.options.columns,function(e,t){n[e.dataIndex]=i[t].getCellContent()}),n}},getRows:function(e){switch(e){case 1:var t=[],i=this;return this.processRows(function(e,n){t.push(i.getRow(n,1))}),t;default:return this.options.model}},getNumberOfColumns:function(){return this.options.columns.length},getNumberOfVisibleColumns:function(){var e=0,t=this;return this.options.columns.forEach(function(i){t.getColumnWidth(i.dataIndex)>0&&e++}),e},getLastVisibleColumnDataIndex:function(){var e,t=this;return this.options.columns.forEach(function(i){t.getColumnWidth(i.dataIndex)>0&&(e=i.dataIndex)}),e},getColumns:function(){return this._instance.options.columns||[]},getColumn:function(e,t){"string"==typeof e&&(e=this.getColumnIDFromDataIndex(e)),void 0===t&&(t=!1);var i=[];return this.processCellsOfColumn({columnID:e,updateView:!1},function(e){i.push(e)}),i},getColumnOptions:function(e){return-1!==e?("string"==typeof e&&(e=this.getColumnIDFromDataIndex(e)),this.options.columns[e]):{}},setColumnOptions:function(t,i){-1!==t&&("string"==typeof t&&(t=this.getColumnIDFromDataIndex(t)),e.extend(this.options.columns[t],i))},_getMergedOption:function(t,i){"string"==typeof i&&(i=this.getColumnIDFromDataIndex(i));var n=this.getColumnOptions(i),o=n?n[t]:{},s=this.options[t];if(void 0!==o){var l={opt:o},a={opt:s};return e.extend(a,l,!0).opt}return s},_getColumnOptionValue:function(e,t){if("string"==typeof e&&(e=this.getColumnIDFromDataIndex(e)),e>-1){var i=this.options[t],n=this.getColumnOptions(e)[t];if(void 0!==i)return void 0!==n?n:i;if(void 0!==n)return n}},getColumnContent:function(e,t){"string"==typeof e&&(e=this.getColumnIDFromDataIndex(e)),void 0===t&&(t=!1);var i=[],n=0;return H(this.options.model,function(o){n>0&&!t&&i.push(o[e]),n++}),i},setColumn:function(e,t){"string"==typeof t&&(t=this.getColumnIDFromDataIndex(t)),this.processCellsOfColumn(t,function(t,i,n){i>0&&t.setCellContent(e[i-1].getCellContent())})},setColumnContent:function(e,t){"string"==typeof t&&(t=this.getColumnIDFromDataIndex(t)),this.processCellsOfColumn(t,function(t,i,n){i>0&&t.setCellContent(e[i-1])})},setRow:function(e,t){this.processCellsOfRow(t,function(t,i,n){t.setCellContent(e[n])})},setRowModel:function(e,t){for(var i in this.prepareUpdateView(),t)this.setCellContent(e,i,t[i]);this.pushUpdateView()},getRowModel:function(e){return this.getRow(e,1)},_getParent:function(){return this._instance._parentObject||this._instance},setColumnOrderState:function(e,t){this._setColumnState(e,"sort:"+t),this._updateViewColumnSort(e)},getColumnOrderState:function(e){var t=this._getColumnState(e);return t?t.replace("sort:",""):"none"},getOrderedColumnState:function(){var e,t=this;return this.options.columns.forEach(function(i,n){var o=t.getColumnOrderState(i.dataIndex);"asc"!==o&&"desc"!==o||(e={columnID:n,dataIndex:i.dataIndex,sortOrder:o})}),e},_updateViewColumnSort:function(e){"string"==typeof e&&(e=this.getColumnIDFromDataIndex(e));var t=this._getColumnState(e),i=this.getCellModel(-1,e);switch(this.prepareUpdateView(),t){case"sort:none":i.removeClass("wux-ui-sort-desc"),i.removeClass("wux-ui-sort-asc");break;case"sort:desc":i.addClass("wux-ui-sort-desc"),i.removeClass("wux-ui-sort-asc");break;case"sort:asc":i.removeClass("wux-ui-sort-desc"),i.addClass("wux-ui-sort-asc")}this.pushUpdateView()},_setColumnState:function(e,t){"string"==typeof e&&(e=this.getColumnIDFromDataIndex(e));var i=this.getOrderedColumnState();i&&(this._listOfColumnStates[i.columnID]=null),this._listOfColumnStates[e]=t},_getColumnState:function(e){return"string"==typeof e&&(e=this.getColumnIDFromDataIndex(e)),this._listOfColumnStates[e]},sortColumnContent:function(t,i){this.prepareUpdateView(),"string"==typeof t&&(t=this.getColumnIDFromDataIndex(t));var n=this._getColumnIdentifiers(t),o=this.getColumnOptions(n.numericalColumnID);if((i=e.extend({sortOrder:"asc",sortFunction:o.sortFunction||function(e,i){var n,o=e[t].getCellContent(),s=i[t].getCellContent();if(o===s)n=0;else{var l=Number(o),a=Number(s);n=isNaN(l)||isNaN(a)?o<s?-1:1:l<a?-1:1}return n}},i)).sortFunction){this._setColumnState(t,"sort:"+i.sortOrder);for(var s=0;s<this.getRow(-1).length;s++)if(s!==t){var l=this.getRow(-1)[s];l._view&&(l._view.getContent().removeClassName("wux-ui-sort-desc"),l._view.getContent().removeClassName("wux-ui-sort-asc")),l.removeClass("wux-ui-sort-desc"),l.removeClass("wux-ui-sort-asc")}this.getCell(-1,t).removeClass("wux-ui-sort-desc"),this.getCell(-1,t).removeClass("wux-ui-sort-asc"),this.getCell(-1,t).addClass("wux-ui-sort-"+i.sortOrder),this.options.model.sort(function(e,t){return("asc"===i.sortOrder?1:-1)*i.sortFunction(e,t)}),this._modelEvents.publish({event:"sort",data:{columnID:t,columnDataIndex:this.getDataIndexFromColumnID(t),sortOrder:i.sortOrder}}),this._computeVirtualViewport(),this.pushUpdateView(!0)}},onSortColumnContent:function(e){return this._modelEvents.subscribe({event:"sort"},e)},_setColumnsWidth:function(){var e=this;this.setCellsContainerSize({width:0},!1);var t=Math.floor(e._getGridContainerDimensions().width)-e.getHeadersDimensions().width;this.getCellsContainerSize().width>t&&(t=this.getCellsContainerSize().width);var i=0;this.getScroller()&&(i=this.getCellsContainerSize().height>this._getScrollerDimensions().height?20:0);var n=t-i,o=[];this._columnsReverseIndex={},H(e.options.columns,function(i,s){var l=e.options.defaultCellWidth;if(e._columnsReverseIndex[i.dataIndex]=s,e.isColumnHidden(s)&&!0===i.isHidden)l=0;else if(void 0===i.width&&(i.width=e.options.defaultCellWidth),void 0!==i.width)if("minimal"===i.width)(r=e._computeMinimalColumnWidth(i.dataIndex))?l=r:o.push(s);else if("auto"!==i.width)if("number"!=typeof i.width&&-1!==i.width.indexOf("%")){var a=Math.floor(t*parseInt(i.width,10)/100)-1;a<=0&&(a=e.options.defaultCellWidth),l=a}else l=i.width;else l=0,o.push(s);if(!e.isColumnHidden(s)&&"auto"!==i.width){var r=null!==i.minWidth&&void 0!==i.minWidth?i.minWidth:0,u=null!==i.maxWidth&&void 0!==i.maxWidth?i.maxWidth:1/0;l=Math.min(u,Math.max(r,l))}n-=l,e._setColumnWidth(s,l,!1)}),H(o,function(t,i){var s=e.options.columns[t],l=Math.floor(n/(o.length-i)),a=Math.max(e.options.defaultCellWidth,l);if(!e.isColumnHidden(i)){var r=null!==s.minWidth&&void 0!==s.minWidth?s.minWidth:0,u=null!==s.maxWidth&&void 0!==s.maxWidth?s.maxWidth:1/0;a=Math.min(u,Math.max(r,a))}n-=a,e._setColumnWidth(t,a,!1)}),this._indexColumnsPosition({fromColumnID:0,async:!1});var s=e.getLastVisibleColumnDataIndex(),l=e.getColumnPosition(s)+e.getColumnWidth(s);e.setCellsContainerSize({width:l},!0)},_applyCellsContainerSizeIfNeeded:function(){!0===this._needToApplyCellContainerSize&&(this._gridContainerDimensionsModified(),this._setColumnsWidth()),this._parent()},_computeMinimalColumnWidth:function(t,i){void 0===i&&(i=!0),"string"==typeof t&&(t=this.getColumnIDFromDataIndex(t));for(var n,o=0,s=new e.Element("div",{styles:{display:"inline-block",position:"relative",opacity:1}}).inject(this.elements.poolContainerRel,"top"),l=(n=i?this.getContent().querySelectorAll('.wux-datagrid-cell[virtual-column-id="'+t+'"]'):this.elements.poolContainerRel.querySelectorAll('.wux-datagrid-cell[virtual-column-id="'+t+'"]')).length,a=0;a<l;a++){var r=n[a].cloneNode(!0);r.style.display="inline-block",r.style.transform="",r.style.position="static",r.style.width="",r.style.top="",r.style.left="";var u=r.querySelector(".wux-layouts-treeview-node");u&&(u.style.position="static"),s.setHTML(r);var d=s.getDimensions().width;d>o&&(o=d)}return s.remove(),o+10},sizeColumnToFit:function(e,t){var i=this;return void 0===t&&(t=!0),"string"==typeof e&&(e=this.getColumnIDFromDataIndex(e)),new Promise(function(n,o){i.onPostUpdateViewOnce(function(){i.prepareUpdateView();var o=i._computeMinimalColumnWidth(e,t);i.setColumnWidth(e,o),i.pushUpdateView(),n(o)}),i.prepareUpdateView(),i.setColumnWidth(e,i._computeMinimalColumnWidth(e,t)),i.pushUpdateView()})},getCellMinimalDimensions:function(t,i){"string"==typeof i&&(i=this.getColumnIDFromDataIndex(i));var n=new e.Element("div",{styles:{display:"inline-block",opacity:0}}).inject(this.elements.container),o=this.elements.container.querySelector('.wux-datagrid-cell[virtual-row-id="'+t+'"][virtual-column-id="'+i+'"]');if(o){var s=o.parentNode;n.setHTML(o);var l=n.getDimensions();s.appendChild(o)}return l},setColumnWidth:function(e,t,i){if(void 0!==e){t<0&&(t=0),"string"==typeof e&&(e=this.getColumnIDFromDataIndex(e)),this.options.columns[e].width=t,this._requireFullUpdate(),this._invalidateLayout();var n=this;setTimeout(function(){n._instance&&n._instance._hideColumnInsertionMark()},100),this._setColumnsWidth(),this._modelEvents.publish({event:"/MANAGER/COLUMN/WIDTH",data:{dataIndex:this.getDataIndexFromColumnID(e),columnID:e,width:t}})}},_setColumnWidth:function(e,t,i){if(void 0===i&&(i=!0,this.prepareUpdateView()),-1===e)this._setHeadersDimensions({width:t});else{"string"==typeof e&&(e=this.getColumnIDFromDataIndex(e));var n=this.getColumnWidth(e);this.setCellsContainerSize({width:this.getCellsContainerSize().width-n+t},!1),this._listOfColumnsWidth[e]=t,this._modelEvents.publish({event:"/MANAGER/COLUMN/WIDTH",data:{columnID:e,width:t}}),i&&this._indexColumnsPosition({fromColumnID:e,onVisibleComplete:this.pushUpdateView.bind(this),async:!1})}},getCellPosition:function(e,t){return"string"==typeof t&&(t=this.getColumnIDFromDataIndex(t)),{top:this.getRowPosition(e),left:this.getColumnPosition(t)}},getColumnWidth:function(e){return"string"==typeof e&&(e=this.getColumnIDFromDataIndex(e)),-1===e?this.getHeadersDimensions().width:this._listOfColumnsWidth&&void 0!==this._listOfColumnsWidth[e]?this._listOfColumnsWidth[e]:this.options.defaultCellWidth},isColumnHidden:function(e){return"string"==typeof e&&(e=this.getColumnIDFromDataIndex(e)),this.options.columns[e].isHidden||0===this.getColumnWidth(e)},_renderCell:function(e){if(void 0!==window.__karma__)return this._parent(e);var t=this.getDataIndexFromColumnID(e.virtualColumnID);return-1!==e.virtualColumnID&&void 0===t||-1!==e.virtualColumnID&&!1!==this.isColumnHidden(t)?void 0:this._parent(e)},onColumnWidthUpdate:function(e){return this._modelEvents.subscribe({event:"/MANAGER/COLUMN/WIDTH"},e)},setCellSpan:function(t,i,n){this.prepareUpdateView(),n=e.extend({rowSpan:1,colSpan:1,shiftRowSpan:0,shiftColSpan:0},n),this.getCell(t,i).resetSpan();for(var o=0;o<n.rowSpan;o++)for(var s=0;s<n.colSpan;s++){var l=this.getCell(t+o,i+s);l.setRowSpan(n.rowSpan,-o),l.setColSpan(n.colSpan,-s)}this.pushUpdateView()},setRowHeight:function(e,t,i){void 0===i&&(i=!0),this.prepareUpdateView(),this._invalidateLayout(),this._instance._hideRowInsertionMark();var n=this.getRowHeight(e);this.setCellsContainerSize({height:this.getCellsContainerSize().height-n+t},!1),this._listOfRowsHeight[e]=t,this._modelEvents.publish({event:"/MANAGER/ROW/HEIGHT",data:{rowID:e,height:t}}),this.needToIndexRowsPositions()&&i?(this._needToIndexRowsPosition(),this.pushUpdateView()):this.pushUpdateView()},_needToIndexRowsPosition:function(){this._updateViewOptions.onPreUpdate=function(){this._indexRowsPosition({fromRowID:0,async:!1})}},_indexRowsPosition:function(t){var i=this;this._timeoutRowsPosIndexation&&clearTimeout(this._timeoutRowsPosIndexation),t=e.extend({fromRowID:0,toRowID:i.getNumberOfRows(),oncomplete:null,onVisibleComplete:null,async:!0},t);var n=this.getVisibleViewport(),o=!1,s=function(){f.beginMeasure("[Manager] - Index row position");for(var e=t.fromRowID;e<t.toRowID+1;e++){var s=0;e>0&&(s=i.getRowHeight(e-1)+i.getRowPosition(e-1)),i._listOfRowsPosition[e]=s,e===n.maxRowID&&t.onVisibleComplete&&(o=!0,t.onVisibleComplete.call(i))}!1===o&&t.onVisibleComplete&&(o=!0,t.onVisibleComplete.call(i)),f.endMeasure("[Manager] - Index row position"),t.oncomplete&&t.oncomplete.call(i)};t.async?this._timeoutRowsPosIndexation=setTimeout(s,1):s()},_getVirtualPositionFromScrollPosition:function(e){void 0===e&&(e=this.getScroller()?this.getScrollerPosition():{x:0,y:0});var t={rowID:Math.floor(e.y/this.options.defaultCellHeight),columnID:Math.floor(e.x/this.options.defaultCellWidth)};if(this.getRowPosition(t.rowID)<e.y){for(;this.getRowPosition(t.rowID)<e.y;)t.rowID++;t.rowID--}else if(this.getRowPosition(t.rowID)>e.y)for(;this.getRowPosition(t.rowID)>e.y;)t.rowID--;if(this.options.performances.enableColumnVirtualization)if(this.getColumnPosition(t.columnID)<e.x){for(;this.getColumnPosition(t.columnID)<e.x;)t.columnID++;t.columnID--}else if(this.getColumnPosition(t.columnID)>e.x)for(;this.getColumnPosition(t.columnID)>e.x;)t.columnID--;return t},getRowPosition:function(e){return 0===e?0:this.needToIndexRowsPositions()&&void 0!==this._listOfRowsPosition[e]?this._listOfRowsPosition[e]:e*this.options.defaultCellHeight},_indexColumnsPosition:function(t){var i=this;t=e.extend({fromColumnID:0,toColumnID:this.getNumberOfColumns(),oncomplete:null,onVisibleComplete:null,async:!0},t),this._timeoutColumnsPosIndexation&&clearTimeout(this._timeoutColumnsPosIndexation);var n=this.getVisibleViewport(),o=!1,s=function(){for(var e=t.fromColumnID;e<=t.toColumnID+1;e++){var s=0;e>0&&(s=i.getColumnWidth(e-1)+i.getColumnPosition(e-1)),i._listOfColumnPosition[e]=s,e===n.maxColumnID&&t.onVisibleComplete&&(o=!0,t.onVisibleComplete.call(i))}!1===o&&t.onVisibleComplete&&(o=!0,t.onVisibleComplete.call(i)),t.oncomplete&&t.oncomplete.call(i)};t.async?this._timeoutColumnsPosIndexation=setTimeout(s,1):s()},getColumnPosition:function(e){return"string"==typeof e&&(e=this.getColumnIDFromDataIndex(e)),0===e?0:void 0!==this._listOfColumnPosition[e]&&null!==this._listOfColumnPosition[e]?this._listOfColumnPosition[e]:e>this._numberOfColumns&&void 0!==this._listOfColumnPosition[this._numberOfColumns]&&null!==this._listOfColumnPosition[this._numberOfColumns]?this._listOfColumnPosition[this._numberOfColumns]+(e-this._numberOfColumns)*this.options.defaultCellWidth:e*this.options.defaultCellWidth},getRowHeight:function(e){return-1===e?this.getHeadersDimensions().height:this._listOfRowsHeight&&void 0!==this._listOfRowsHeight[e]?this._listOfRowsHeight[e]:this.options.defaultCellHeight},onRowHeightUpdate:function(e){return this._modelEvents.subscribe({event:"/MANAGER/ROW/HEIGHT"},e)},removeRows:function(e){var t=this;H(e,function(e){t.removeRow(e)})},removeRow:function(e){this.prepareUpdateView(),this.hideRow(e),this.unselectRow(e),this.processCells(function(e,t,i){e.options.rowID=t-1},{minRowID:e+1,minColumnID:0}),this.options.model.splice(e,1),this._listOfRowsPosition.splice(e,1),this._listOfRowsHeight.splice(e,1),this._listOfRowsPreviousHeight.splice(e,1),this._listOfRowsPreviousHeight.splice(e,1),this._needToIndexRowsPosition(),this.pushUpdateView(!0),this._processRowModel(e,function(e){e.destroy()}),this._modelEvents.publish({event:"/MANAGER/DIMENSIONS/UPDATE"}),this._modelEvents.publish({event:"/MANAGER/ROWS/REMOVE",data:{rowID:e}})},onRemoveRow:function(e){this._modelEvents.subscribe({event:"/MANAGER/ROWS/REMOVE"},e)},removeColumn:function(e){"string"==typeof e&&(e=this.getColumnIDFromDataIndex(e)),this.prepareUpdateView();var t=this;this.hideColumn(e),this.unselectColumn(e),this.processCellsOfColumn(e,function(e,i,n){t._onDetachFromView(i,n,!0)}),this.processCells(function(e,t,i){e.options.columnID=i-1},{minRowID:0,minColumnID:e}),this.processRows(function(i,n){t.options.model[n].splice(e,1)}),this._setColumnsWidth(),t.options.columns.splice(e,1),this.updateView(!0),this._modelEvents.publish({event:"/MANAGER/DIMENSIONS/UPDATE"}),this._modelEvents.publish({event:"/MANAGER/COLUMNS/REMOVE",data:{columnID:e}}),this.pushUpdateView()},processCellsOfColumn:function(t,i){var n=0,o={columnID:0,minRowID:0,maxRowID:this.options.model.length,updateView:!0},s={};"object"==typeof t?s=t:s.columnID=t,"string"==typeof(s=e.extend(o,s)).columnID&&(s.columnID=this.getColumnIDFromDataIndex(s.columnID));var l=this.options.model,a=l.length;for(n=0;n<a;n++){var r=l[n];i&&void 0!==r[s.columnID]&&i&&n>=s.minRowID&&n<=s.maxRowID&&i.call(r[s.columnID],r[s.columnID],n,s.columnID)}s.updateView&&this.updateView()},_processRowModel:function(e,t){var i=this.options.model[e];if(void 0!==i){var n=i.length,o=this.getCell(e,-1);t.call(o,o);for(var s=0;s<n;s++){o=this.getCell(e,s);t.call(o,o)}}},processCellsOfRow:function(t,i){var n=0;if(i){var o={rowID:0,minColumnID:0,maxColumnID:this.options.model[0]?this.options.model[0].length:0},s={};if("object"==typeof t?s=t:s.rowID=t,-1!==(s=e.extend(o,s)).rowID)if(void 0!==this.options.model[s.rowID])for(n=s.minColumnID;n<s.maxColumnID;n++){var l=this.getCell(s.rowID,n);l&&i.call(l,l,s.rowID,n)}}},enableDebug:function(){V=!0},disableDebug:function(){V=!1},isDebug:function(){return V},processRows:function(e,t){var i=0;H(this.options.model,function(t){e&&e.call(t,t,i),i++})},styleRow:function(e,t){this.processCellsOfRow(e,function(e,i,n){e.setCellStyle(t)}),this.updateView(!0)},_selectRowProcessCB:function(e,t,i,n){this.selectCell(t,i,n),e.addClass("wux-datagrid-row-highlighted");var o=e.getView();o&&o.getContent().addClassName("wux-datagrid-row-highlighted")},selectRows:function(e,t){if(e&&0!==e.length){void 0===t&&(t=!0),this._selectedColumns.isEmpty()&&this._selectedRows.isEmpty()||!t||this.unselectAll({updateView:!1});var i=[],n=[],o=this,s=o.options.model[0]?o.options.model[0].length:0;e.forEach(function(e){if(null!=e&&e>=0&&-1===n.indexOf(e)&&(n.push(e),i.push(o.getCell(e,-1)),o.selectCell(e,-1,!0),void 0!==o.options.model[e]))for(var t=0;t<s;t++){var l=o.getCell(e,t);l&&(i.push(l),o._selectRowProcessCB(l,e,t,!0))}}),this._selectedCells.add(i),this._modelEvents.publish({context:this,event:"/MANAGER/SELECT/ROWS",data:n}),this._selectedRows.add(n),this._modelEvents.publish({event:"selectionChange",context:this,data:{}})}},selectRow:function(e,t){if(!(null==e||e<0)){void 0===t&&(t=!0),this._selectedColumns.isEmpty()&&this._selectedRows.isEmpty()||!t||this.unselectAll({updateView:!1}),this.selectCell(e,-1);var i=this;this.processCellsOfRow({rowID:e,minColumnID:0},function(e,t,n){i._selectRowProcessCB(e,t,n)}),this._modelEvents.publish({context:this,event:"/MANAGER/SELECT/ROW",data:e}),this._selectedRows.add(e),this._modelEvents.publish({event:"selectionChange",context:this,data:{}})}},isRowSelected:function(e){return this._selectedRows.isIn(e)},_unselectRowProcessCB:function(e,t,i){e&&e.isSelected()&&this.unselectCell(t,i)},unselectRow:function(e){if(!(null==e||e<0)){this.unhighlightRow(e);var t=this;this.processCellsOfRow({rowID:e,minColumnID:0},function(e,i,n){t._unselectRowProcessCB(e,i,n)}),this.removeRowClass(e,"wux-datagrid-row-highlighted"),this._modelEvents.publish({context:this,event:"/MANAGER/UNSELECT/ROW",data:e}),this._selectedRows.remove(e),this._modelEvents.publish({event:"selectionChange",context:this,data:{}})}},getSelectedRows:function(){return this._selectedRows.get()},selectColumn:function(e,t){"string"==typeof e&&(e=this.getColumnIDFromDataIndex(e)),void 0===t&&(t=!0),t&&this.unselectAll({updateView:!1}),this.highlightColumn(e,!0),this._modelEvents.publish({context:this,event:"/MANAGER/SELECT/COLUMN",data:e}),this._selectedColumns.add(e),this._setColumnState(e,"select"),this._modelEvents.publish({event:"selectionChange",context:this,data:{}})},unselectAllColumns:function(){this._selectedColumns.get().length>0&&this.withUpdate(function(){for(;this._selectedColumns.get().length>0;)this.unselectColumn(this._selectedColumns.get()[0])})},unselectColumn:function(e){"string"==typeof e&&(e=this.getColumnIDFromDataIndex(e)),this.unhighlightColumn(e,!0),this._modelEvents.publish({context:this,event:"/MANAGER/UNSELECT/COLUMN",data:e}),this._selectedColumns.remove(e),this._setColumnState(e),this._modelEvents.publish({event:"selectionChange",context:this,data:{}})},getSelectedColumns:function(){return this._selectedColumns.get()},_focusCell:function(e,t){var i=this.getCell(e,t);this._focusedCell=i,i.select();var n=i.getView();n&&n.select()},selectCell:function(e,t,i){var n,o=this.getCell(e,t);o&&((n=this._getCellView(e,t))&&(o._view=n,o._view._cellModel=o),i||this._selectedCells.add(o),o.select(),(n=o.getView())&&parseInt(n.elements.container.getAttribute("virtual-row-id"),10)===e&&parseInt(n.elements.container.getAttribute("virtual-column-id"),10)===t&&n.select(),i||this._modelEvents.publish({event:"selectionChange",context:this,data:{}}))},unselectCell:function(e,t){var i=this.getCell(e,t);if(i){this._selectedCells.remove(i),i.unselect();var n=i.getView();n&&n.unselect(),this._selectedCells.remove(i),this._modelEvents.publish({event:"selectionChange",context:this,data:{}})}},getSelectedCells:function(){return this._selectedCells.get()},selectAll:function(){var e=this;this.prepareUpdateView(),this.processRows(function(t,i){e.selectRow(i,!1)}),this.pushUpdateView()},unselectAll:function(t){(t=e.extend({rows:!0,columns:!0,cells:!0,updateView:!0},t))&&t.updateView&&this.prepareUpdateView();if(t.columns)for(var i=this.getSelectedColumns();void 0!==i[0];)this.unselectColumn(i[0]);if(t.rows)for(var n=this.getSelectedRows(),o=0;o<n.length;o++)this.unselectRow(n[o]);this._selectedCells.empty(),t&&t.updateView&&this.pushUpdateView()},highlightRow:function(e){var t=this.getCell(e,-1);t&&t.getView()&&t.getView().highlight(),this.processCellsOfRow(e,function(e,t,i){e.highlight(),e.getView()&&e.getView().highlight()}),this._highlightedRows.add(e)},unhighlightRow:function(e){var t=this.getCell(e,-1);t&&t.getView()&&t.getView().unhighlight(),this.processCellsOfRow(e,function(e,t,i){if(e.unhighlight(),e.getView()){var n=e.getView().getCellInfos();n.virtualRowID===t&&n.virtualColumnID===i&&e.getView().unhighlight()}}),this._highlightedRows.remove(e)},isRowHighlighted:function(e){return this._highlightedRows.isIn(e)},highlightColumn:function(e,t){"string"==typeof e&&(e=this.getColumnIDFromDataIndex(e)),this.processCellsOfColumn(e,function(e,i,n){t?e.select():e.highlight();var o=e.getView();o&&(t?o.select():o.highlight())})},unhighlightColumn:function(e,t){"string"==typeof e&&(e=this.getColumnIDFromDataIndex(e)),this.processCellsOfColumn(e,function(e,i,n){t?(this._manager.getCell(i,-1).inactive(),e.unselect()):e.unhighlight();var o=e.getView();o&&(t?o.unselect():o.unhighlight())})},hideRow:function(e){if(!this.isRowHidden(e)){this.prepareUpdateView();var t=this.getRowHeight(e);this._listOfRowsPreviousHeight[e]=t,this.setRowHeight(e,0),this.getCell(e,-1)._hide(),this.processCellsOfRow(e,function(e,t,i){e._hide()}),this.getCell(e,-1)._hide(),this._modelEvents.publish({event:"/MANAGER/DIMENSIONS/UPDATE"}),this._requireFullUpdate(),this.pushUpdateView()}},showRow:function(e){this.prepareUpdateView();var t=void 0!==this._listOfRowsPreviousHeight[e]?this._listOfRowsPreviousHeight[e]:this.options.defaultCellHeight;this.setRowHeight(e,t),this.getCell(e,-1)._show(),this.processCellsOfRow(e,function(e,t,i){e._show()}),this._modelEvents.publish({event:"/MANAGER/DIMENSIONS/UPDATE"}),this._requireFullUpdate(),this.pushUpdateView()},isRowHidden:function(e){return 0===this.getRowHeight(e)},hideColumn:function(e){if(!this.isColumnHidden(e)){"string"==typeof e&&(e=this.getColumnIDFromDataIndex(e)),this.options.columns[e].isHidden=!0,this.prepareUpdateView();var t=this.getColumnWidth(e);this._listOfColumnsPreviousWidth[e]=t,this._listOfColumnsWidth[e]=0,this._setColumnsWidth(),this.getCell(-1,e)._hide(),this.processCellsOfColumn(e,function(e,t,i){e._hide()}),this._modelEvents.publish({event:"/MANAGER/DIMENSIONS/UPDATE"}),this._modelEvents.publish({event:"hideColumn",data:{columnID:e}}),this._modelEvents.publish({event:"columnVisibilityChanged",data:{columnID:e,isHidden:!0}}),this._requireFullUpdate(),this.pushUpdateView(!0)}},showColumn:function(e){"string"==typeof e&&(e=this.getColumnIDFromDataIndex(e)),this.options.columns[e].isHidden=!1,this.prepareUpdateView();var t=this._listOfColumnsPreviousWidth[e];this._listOfColumnsWidth[e]=t,this._setColumnsWidth(),this.getCell(-1,e)._show(),this.processCellsOfColumn(e,function(e,t,i){e._show()}),this._modelEvents.publish({event:"/MANAGER/DIMENSIONS/UPDATE"}),this._modelEvents.publish({event:"showColumn",data:{columnID:e}}),this._modelEvents.publish({event:"columnVisibilityChanged",data:{columnID:e,isHidden:!1}}),this._heavyDataColumnModelRequest("showColumn",{columnID:e}),this._requireFullUpdate(),this.pushUpdateView(!0)},onShowColumn:function(e){return this._modelEvents.subscribe({event:"showColumn"},e)},onHideColumn:function(e){return this._modelEvents.subscribe({event:"hideColumn"},e)},onColumnVisibilityChange:function(e){return this._modelEvents.subscribe({event:"columnVisibilityChanged"},e)},unstyleRow:function(e){this.processCellsOfRow(e,function(e,t,i){e.setCellStyle({background:"",color:""})}),this.updateView(!0)},styleColumn:function(e,t){this.processCellsOfColumn(e,function(e,i,n){e.setCellStyle(t)}),this.updateView(!0)},addColumnClass:function(e,t,i){void 0===i&&(i=!1);var n=function(e,i,n){e.addClass(t);var o=e.getView();o&&o.getContent().addClassName(t)};if(i){var o=this.getVisibleViewport();this.processCellsOfColumn({minRowID:o.minRowID,maxRowID:o.maxRowID,updateView:!1},n)}else this.prepareUpdateView(),this.processCellsOfColumn(e,n),this.pushUpdateView()},removeColumnClass:function(e,t,i){void 0===i&&(i=!1);var n=function(e,i,n){e.addClass(t);var o=e.getView();o&&o.getContent().removeClassName(t)};if(i){var o=this.getVisibleViewport();this.processCellsOfColumn({minRowID:o.minRowID,maxRowID:o.maxRowID,updateView:!1},n)}else this.prepareUpdateView(),this.processCellsOfColumn(e,n),this.pushUpdateView()},addRowClass:function(e,t,i){this.processCellsOfRow({rowID:e,minColumnID:i?-1:0},function(e,i,n){e.addClass(t);var o=e.getView();o&&o.getContent().addClassName(t)})},removeRowClass:function(e,t,i){this.processCellsOfRow({rowID:e,minColumnID:i?-1:0},function(e,i,n){e.removeClass(t);var o=e.getView();o&&o.getContent().removeClassName(t)})},unstyleColumn:function(e){this.processCellsOfColumn(e,function(e,t,i){e.setCellStyle({background:"",color:""})}),this.updateView(!0)},_processCells:function(t,i,n){for(var o=e.extend({minRowID:1,minColumnID:1,maxRowID:this.getNumberOfRows(),maxColumnID:this.getNumberOfColumns()},n),s=o.minRowID;s<o.maxRowID;s++)for(var l=o.minColumnID;l<o.maxColumnID;l++){var a=t[s];if(a){var r=a[l];r&&i.call(r,r,s,l)}}},processCells:function(e,t){this._processCells(this.options.model,e,t)},getVisibleViewport:function(){return this._viewportBbox},_computeModelSize:function(e){var t=this,i=t.options.model.length,n=t.getLastVisibleColumnDataIndex(),o=t.getColumnPosition(n)+t.getColumnWidth(n),s=t.getRowPosition(i-1)+t.getRowHeight(i-1);return t.setCellsContainerSize({width:o,height:s},void 0!==e),t._modelSize={numberOfRows:i,numberOfColumns:this.options.columns.length},t._modelSize},_computeVirtualViewport:function(){var e=this.getViewportDimensions(),t=this.getScrollerPosition(),i=this.getModelSize().numberOfRows,n=this._getVirtualPositionFromScrollPosition(),o=this._getVirtualPositionFromScrollPosition({x:t.x+e.width,y:t.y+e.height}),s=n.rowID-1,l=o.rowID+1,a=this.options.performances.enableColumnVirtualization?n.columnID-1:0,r=this.options.performances.enableColumnVirtualization?o.columnID+1:this.options.columns.length-1;return s=Math.max(0,s),l=Math.min(l,i-1),a=Math.max(0,a),r=Math.min(r,this.options.columns.length-1),this._viewportBbox={minRowID:s,maxRowID:l,minColumnID:a,maxColumnID:r},this._virtualPos={virtualRowID:this._viewportBbox.minRowID,virtualColumnID:this._viewportBbox.minColumnID},this._viewportBbox},moveColumn:function(e,t,i){"string"==typeof e&&(e=this.getColumnIDFromDataIndex(e)),"string"==typeof t&&(t=this.getColumnIDFromDataIndex(t)),this.prepareUpdateView(),this.unselectAll({updateView:!1}),w.array2dMove(this.options.columns,e,t),this.options.model=w.array2dTranspose(this.options.model),w.array2dMove(this.options.model,e,t),this.options.model=w.array2dTranspose(this.options.model),w.array2dMove(this._listOfColumnsWidth,e,t),w.array2dMove(this._columnsList,e,t),this._setColumnsWidth(),this.pushUpdateView(!0),this._modelEvents.publish({event:"/MANAGER/COLUMNS/MOVE",data:{fromColumnID:e,toColumnID:t}})},onMoveColumn:function(e){return this._modelEvents.subscribe({event:"/MANAGER/COLUMNS/MOVE"},e)},moveRow:function(e,t){console.log("move",e,t),this.prepareUpdateView(),w.array2dMove(this.options.model,e,t),this._selectedRows.isIn(e)&&(this.unselectCell(e,-1),this.selectCell(t,-1)),this._modelEvents.publish({event:"/MANAGER/ROWS/MOVE",data:{fromRowID:e,toRowID:t}});var i=this._doINeedToGeneratePool();this.pushUpdateView(i)},onMoveRow:function(e){this._modelEvents.subscribe({event:"/MANAGER/ROWS/MOVE"},e)},getColumnIndexFromColumnID:function(e){return console.warn("[deprecated] - please use getColumnIDFromDataIndex()"),this.getDataIndexFromColumnID(e)},getDataIndexFromColumnID:function(e){var t=this.options.columns;if(e>=0&&e<t.length)return t[e].dataIndex},getColumnIDFromColumnIndex:function(e){return console.warn("[deprecated] - please use getColumnIDFromDataIndex()"),this.getColumnIDFromDataIndex(e)},_needToComputeColumnReverseDataIndexes:function(){this._columnsReverseIndex=null},getColumnIDFromDataIndex:function(e){var t;if(this._columnsReverseIndex&&void 0!==this._columnsReverseIndex[e])t=this._columnsReverseIndex[e];else for(var i=this.getNumberOfColumns(),n=this.options.columns,o=0;o<i;o++)if(n[o].dataIndex===e){t=o;break}return t},addRow:function(e,t){this.prepareUpdateView();var i=this.getNumberOfRows(),n=this,o=new a({isHeader:!0,isStatic:!0,rowID:i,columnID:-1,value:"",scroller:this._scroller,viewport:this._viewport,manager:this},this._leftStaticContainer);this._register({rowID:i,columnID:-1,cell:o});for(var s=this.getColumns(),l=0;l<s.length;l++){var r=s[l].dataIndex,u=this.getColumnIDFromDataIndex(r),d=this.isColumnHidden(u);o=new a({isHeader:!1,isStatic:!1,isHidden:d,isEditable:this.options?this.options.isEditable:this._isEditable,rowID:i,columnID:u,value:e?e[r]:"",scroller:this._scroller,viewport:this._viewport,manager:this},this._cellsContainer),this._register({rowID:i,columnID:u,cell:o})}void 0!==t&&t!==i&&this.moveRow(i,t),H(this.getSelectedRows(),function(e){e>=t&&(n.unselectRow(e),n.selectRow(e+1))});var c=this._doINeedToGeneratePool();return this.pushUpdateView(c),this._modelEvents.publish({event:"/MANAGER/DIMENSIONS/UPDATE"}),this._modelEvents.publish({event:"/MANAGER/ROWS/ADD"}),i},addColumn:function(t){t=e.extend({column:{text:"First Name",dataIndex:"firstname"},data:[]},t);var i=this.options.columns.push(t.column)-1;this._instance._listOfColumns.push(t.column.dataIndex);var n=this;this.processRows(function(e,o){var s=t.data,l=new a({isHeader:!1,isStatic:!1,isHidden:!1,isEditable:n.options?n.options.isEditable:n._isEditable,rowID:o,columnID:i,value:s?s[o]:"",scroller:n._scroller,viewport:n._viewport,manager:n},n._cellsContainer);n._register({rowID:o,columnID:i,cell:l})}),this._setupColumnType(t.column),this._setColumnsWidth(),this._generatePool(!0),this.updateView(!0)},addRows:function(e){for(var t=this,i=this.getNumberOfRows(),n=0;n<e.length;n+=1){var o=new a({isHeader:!0,isStatic:!0,rowID:i,columnID:-1,value:"",scroller:this._scroller,viewport:this._viewport,manager:this},this._leftStaticContainer);this._register({rowID:i,columnID:-1,cell:o});for(var s=this.getColumns(),l=0;l<s.length;l++){var r=s[l].dataIndex,u=this.getColumnIDFromDataIndex(r),d=this.isColumnHidden(u);o=new a({isHeader:!1,isStatic:!1,isHidden:d,isEditable:this.options?this.options.isEditable:this._isEditable,rowID:i,columnID:u,value:e[n]?e[n][r]:"",scroller:this._scroller,viewport:this._viewport,manager:this},this._cellsContainer),this._register({rowID:i,columnID:u,cell:o})}i+=1}this.getNumberOfRows()!==this.getPoolNumberOfRows()&&this._generatePool(),this.updateView(),H(this.getSelectedRows(),function(e){e>=i&&(t.unselectRow(e),t.selectRow(e+1))})},onAddRow:function(e){this._modelEvents.subscribe({event:"/MANAGER/ROWS/ADD"},e)},_onDetachFromView:function(e,t,i){void 0===i&&(i=!1);var n=this.getCell(e,t);n&&n._view&&(n._view.elements.container.remove(),n._view=null)},onCellClick:function(e){return this._modelEvents.subscribe({event:y},e)},onCellDblClick:function(e){return this._modelEvents.subscribe({event:O},e)},_dump:function(){var e="\n";return H(this.options.model,function(t,i){0===i&&(e+="   ",H(t,function(t,i){e=e+"\t\t["+i+"]"}),e+="\n"),e=e+"["+i+"]",H(t,function(t){e=e+"\t\t"+t.getCellContent()}),e+="\n"}),e},_register:function(e){this.setCell(e.rowID,e.columnID,e.cell),this.updateModelSize({numberOfRows:this.getNumberOfRows(),numberOfColumns:this.getNumberOfColumns()})},withUpdate:function(e){this.prepareUpdateView(),e.call(this),this.pushUpdateView()},prepareUpdateView:function(){void 0===this._isPreparingView&&(this._isPreparingView=0),this._isPreparingView++,V&&console.log("prepare",this._isPreparingView),this._parent()},pushUpdateView:function(e){this._isPreparingView>0&&this._isPreparingView--,V&&console.log("push",this._isPreparingView),this._parent(e)},_doesRowNeedToBeRequested:function(e){return!this.isRowHidden(e)},_doesColumnNeedToBeRequested:function(e){return e<this.options.columns.length},empty:function(){this.prepareUpdateView();for(var e=this.getNumberOfRows()-1;e>=0;e--)this.removeRow(e);w.clear(this.options.model),w.clear(this._cellsContentList),w.clear(this._rowsList),w.clear(this._rowIndexes),w.clear(this._listOfCellsInViewPort),w.clear(this._listOfRowsPosition),w.clear(this._listOfRowsHeight),w.clear(this._listOfRowsPreviousHeight),this._viewportBbox={},this._previousViewPort={rowMin:0,rowMax:0,columnMin:0,columnMax:0},this._minVisibleCellCoordinates={rowID:1,columnID:1},this._maxVisibleCellCoordinates={rowID:1,columnID:1},this._lastScrollPos={x:0,y:0},this._deltaScrollPos={x:0,y:0},this.pushUpdateView(!0)},showLoadIndicator:function(e){this._instance.elements.loader.on(e)},hideLoadIndicator:function(){this._instance.elements.loader.off()},updateLoadIndicator:function(e){this._instance.elements.loader.update(e)},_update:function(e){},_requireFullUpdate:function(){this.__preventNextUpdateViewCounter=0,this._needFullUpdate=!0},updateView:function(e){!0===e&&(this._setColumnsWidth(),this._updateViewOptions.generatePool=e),0===this._isPreparingView&&(V&&(this._updateViewOptions.generatePool?console.warn("------------- [update view & generate pool] --------------"):console.warn("------------- [update view] --------------")),this._updateViewOptions&&this._updateViewOptions.detachAllViews&&this._beginUpdate(),this._parent(),this._debugPerformanceIssues&&(this._listOfColumnPerformances={}),this._updateViewOptions&&this._updateViewOptions.detachAllViews&&this._endUpdate())},_getEditView:function(t,i){var n,o=this,s=t.getValue||function(e){return e.cellModel.getCellContent()},l=t.setValue||function(e,t){e.cellModel.setCellContent(t)},a=t.onChange||function(e){console.log("change",e.cellModel.getCellContent())};switch(t.type){case"picture":n=function(e){if(e.virtualRowID>-1){var t=e.manager._reuseCellContent("picture",e.cellView);t&&(t.style.backgroundImage=s.call(o,i.cellView.getCellInfos()))}};break;case"boolean":n=function(e){if(e.virtualRowID>-1){var t=new v({size:"mid",value:s.call(o,i.cellView.getCellInfos())});return t.getContent().setStyles({verticalAlign:"middle"}),t.onChange(function(e){var t=this.getValue();l.call(o,i.cellView.getCellInfos(),t),a&&a.call(o,i.cellView.getCellInfos())}),t}};break;case"color":n=function(e){if(e.virtualRowID>-1){var t=e.manager._reuseCellContent("color",e.cellView);t&&(t.style.backgroundColor=s.call(o,i.cellView.getCellInfos()))}};break;case"datetime":n=function(e){if(e.virtualRowID>-1)return s.call(o,i.cellView.getCellInfos()).toString().split(" ").splice(0,5).join(" ")};break;case"smartinput-distance":case"smartinput-orientation":case"smartinput-angle":case"smartinput-vector":case"smartinput-number":var r={"smartinput-distance":I,"smartinput-orientation":D,"smartinput-angle":_,"smartinput-vector":b,"smartinput-number":C};n=function(e){if(e.virtualRowID>-1){var n=new r[t.type]({value:s.call(o,i.cellView.getCellInfos()),units:""});return c.addEventOnElement(this,n,"change",function(){l.call(o,i.cellView.getCellInfos(),this.getValue())}),n}};break;default:case"string":n=function(t){if(t.virtualRowID>-1)return new e.Element("input",{type:"text",value:s.call(o,i.cellView.getCellInfos())})}}return n},_getViewForCell:function(t){var i=this,n=this.getColumnOptions(t.virtualColumnID),o=n?n.isEditable:{};function s(e,o){if(e.virtualRowID>-1){var s=new c.createElement("div");return n.commands.forEach(function(e){if(!e.viewScope||e.viewScope===o){var n=new R({label:e.label,emphasize:e.isPrimary?"primary":void 0,icon:e.icon});n.getContent().setAttribute("internalCommand",e.command),c.addEventOnElement(this,n.getContent(),h.POINTERDOWN,function(e){e.stopPropagation(),e.preventDefault()}),c.addEventOnElement(this,n.getContent(),h.POINTERUP,function(n){n.stopPropagation(),n.preventDefault(),i._modelEvents.publish({event:"command:"+e.command,data:t.cellView.getCellInfos()})}),s.appendChild(n.getContent())}}),s}}if(t.virtualColumnID>-1&&void 0===n.isEditable&&void 0!==n.type)switch(n.type){case"commands":o={switchToWriteView:{event:"",view:function(e){return s(e,"write")}},switchToReadView:{view:function(e){return s(e,"read")}}};break;case"boolean":o={switchToWriteView:{event:"",view:this._getEditView(n,t)},switchToReadView:{}};break;case"picture":case"color":case"datetime":o={switchToWriteView:{event:"",callback:function(){}},switchToReadView:{view:this._getEditView(n,t)}};break;case"smartinput-distance":case"smartinput-orientation":case"smartinput-angle":case"smartinput-vector":case"smartinput-number":o={switchToWriteView:{event:"",callback:function(){},view:this._getEditView(n,t)},switchToReadView:{event:"blur",callback:function(e){this.switchToReadView()}}};break;default:case"string":o={switchToWriteView:{event:"",callback:function(){},view:this._getEditView(n,t)},switchToReadView:{}}}var l=e.clone(this.options.isEditable),a=l;return!1!==l&&(a=e.extend(l,o,!0)),a},_setupColumnType:function(e){switch(e.type){case"selection":e.onCellChange=function(e){return e.event.target.parentNode.dsModel.checkFlag},e.onCellRequest=function(e){if(!e.isHeader){var t=new x({type:"checkbox",checkFlag:Boolean(e.manager.isRowSelected(e.virtualRowID))});c.addEventOnElement(this,t.getContent(),h.POINTERDOWN,function(e){e.stopPropagation()}),c.addEventOnElement(this,t.getContent(),h.POINTERUP,function(e){e.stopPropagation()},!0),c.addEventOnElement(this,t.getContent(),"change",function(t){t.dsModel.checkFlag?e.manager.selectRow(e.virtualRowID,!1):e.manager.unselectRow(e.virtualRowID,!1),e.manager._giveFocus()}),e.cellView.getContent().setHTML(t)}}}},getDistinctValuesFromColumns:function(){var e={},t={},i=this;return this.processRows(function(n,o){for(var s=i.getNumberOfColumns(),l=0;l<s;l++){var a=i.getDataIndexFromColumnID(l),r=i.getCellContent(o,l);void 0===e[a]&&(e[a]=[],t[a]={}),void 0===t[a][r]&&(t[a][r]=!0,e[a].push(r))}}),e},_giveFocus:function(e){this._instance.elements.container.addClassName("wux-ui-state-focused"),e&&this._instance.elements.container.focus()},_lostFocus:function(){this._instance&&this._instance.options.changeColorOnFocus&&this._instance.elements.container.removeClassName("wux-ui-state-focused"),this._listOfEditedCells&&this._listOfEditedCells.length>0&&(this._listOfEditedCells.forEach(function(e){e.cellView.switchToReadView()}),w.clear(this._listOfEditedCells))},_removeAllInteractiveUIFeedBacks:function(){},_recordInteractionFromUI:function(e){E.addCustomInteraction(this._instance._parentObject.getContent(),{type:"webUX_event",reason:e.reason||"",event:e.event||"",data:e.data||{},eventOptions:{}},"DS/SpreadsheetRec/DataGridRec",{checkAbstract:!1,checkVisibility:!1})},enableDragOverStateForBlank:function(){this.disableDragOverStateForRow(),this.getScroller()&&this.getScroller().getContent().addClassName("wux-ui-state-drag-over")},disableDragOverStateForBlank:function(){this.getScroller()&&this.getScroller().getContent().removeClassName("wux-ui-state-drag-over")},disableDragOverStateForRow:function(){this._instance._hideRowInsertionMark()},enableDragAutoScroll:function(){return this._enableDragAutoScroll()},_enableDragAutoScroll:function(){this.__enableDragAutoScroll=!0,this._enableAutoScroll()},disableDragAutoScroll:function(){return this._disableDragAutoScroll()},_disableDragAutoScroll:function(){this.__enableDragAutoScroll=!1,this._disableAutoScroll()},_scrollToPosition:function(e,t){if(!(Boolean(window.chrome)&&Boolean(window.chrome.webstore))||this.__enableDragAutoScroll){var i=function(e,t){var i,n={},o={};for(i=t.offsetParent,n.x=e.touches?e.touches[0].pageX:e.pageX,n.y=e.touches?e.touches[0].pageY:e.pageY,o.left=t.offsetLeft,o.top=t.offsetTop;i;)o.left+=i.offsetLeft,o.top+=i.offsetTop,i=i.offsetParent;return{x:n.x-o.left,y:n.y-o.top}}(e,this.getScroller().elements.container).y,n=this._getScrollerDimensions().height,o=0;i<=50?o=-(50-i)/50*30:n-50<=i&&(o=(i-(n-50))/50*30),this._setAutoScrollVelocity({x:0,y:o})}}});return e.namespace("WUX/Controls/SpreadsheetManager",T)}),define("DS/Spreadsheet/DataGrid",["UWA/Core","UWA/Controls/Abstract","DS/Controls/Loader","DS/Spreadsheet/Manager","DS/Spreadsheet/CellModel","DS/Core/ActionsStack","DS/Spreadsheet/CellView","DS/Utilities/Data","UWA/Utils/Client","UWA/Utils","DS/Utilities/Utils"],function(e,t,i,n,o,s,l,a,r,u,d){"use strict";var c=!1,h=r.Engine;function m(e,t){var i=e;if(i)return(" "+i.className+" ").replace(/[\n\t]/g," ").indexOf(" "+t+" ")>-1?i:m(i.parentNode,t)}function g(e,t){return(" "+e.className+" ").replace(/[\n\t]/g," ").indexOf(" "+t+" ")>-1}var p=t.extend({defaultOptions:{managerClass:n,childrenMargin:25,data:null,headersDimensions:{width:void 0,height:25},defaultCellMouseWidth:null,defaultCellMouseHeight:null,defaultCellTouchWidth:null,defaultCellTouchHeight:null,defaultCellWidth:100,defaultCellHeight:50,rootMargin:20,showScrollbarsOnHover:!1,show:{rowHeaders:!0,columnHeaders:!0},resize:{rows:!1,columns:!1},selection:{cells:!0,rowHeaders:!0,columnHeaders:!1,unselectAllOnEmptyArea:!0,canMultiSelect:!0},enableDragAndDrop:!0,showLoaderIndicator:!1,showVerticalLines:!1,alternateRowColor:!1,useTransparentScroller:!1,isEditable:!1,rowsAreDraggable:!0,allowUnsafeHTMLContent:void 0,shouldCellAllowUnsafeHTMLContentAt:function(e){return e.manager.options.allowUnsafeHTMLContent},onDragStartColumnHeaderDefault:function(e,t){var i="'"+t.dataIndex+"'";e.dataTransfer.setData("Text",i),e.dataTransfer.effectAllowed="move",t.manager.__draggedAreaVirtualColumnID=t.virtualColumnID,t.manager.__draggedArea="column",t.manager.__draggedColumnID=t.virtualColumnID,t.manager.lockUI()},onDragEnterColumnHeaderDefault:function(e,t){"column"===t.manager.__draggedArea&&(t.virtualColumnID>t.manager.__draggedAreaVirtualColumnID?this._showColumnInsertionMark(t.manager.getScroller().getPosition().x+t.manager.getHeadersDimensions().width+t.manager.getColumnPosition(t.dataIndex)+t.manager.getColumnWidth(t.dataIndex)):this._showColumnInsertionMark(t.manager.getScroller().getPosition().x+t.manager.getHeadersDimensions().width+t.manager.getColumnPosition(t.dataIndex)))},onDragLeaveColumnHeaderDefault:function(e,t){this._hideColumnInsertionMark()},onDragEndColumnHeaderDefault:function(e,t){delete t.manager.__draggedAreaVirtualColumnID,delete t.manager.__draggedArea,this._hideColumnInsertionMark(),t.manager.unlockUI()},onDropColumnHeaderDefault:function(e,t){if(void 0!==t.manager.__draggedAreaVirtualColumnID){var i=e.dataTransfer.getData("Text");i.length>=2&&"'"===i.charAt(0)&&"'"===i.charAt(i.length-1)&&(i=i.slice(1,i.length-1)),this._hideRowInsertionMark(),t.manager.moveColumn(i,t.dataIndex),t.manager._recordInteractionFromUI({event:"drop:move-column",data:{fromVirtualColumnID:i,toVirtualColumnID:t.dataIndex}}),t.manager.unlockUI()}},onDragStartRowHeaderDefault:function(e,t){this.serializeDragAndDropEvent(e,{data:{"dswebux/x-spreadsheet.datagrid.rows+json":[t.manager.getRow(t.virtualRowID,1)]}}),e.dataTransfer.effectAllowed="move",t.manager.__draggedVirtualRowID=t.virtualRowID},onDragOverRowHeaderDefault:function(e,t){"top"===t.dropPosition?this._showRowInsertionMark(t.manager.getScroller().getPosition().y+t.manager.getHeadersDimensions().height+t.manager.getRowPosition(t.virtualRowID)):this._showRowInsertionMark(t.manager.getScroller().getPosition().y+t.manager.getHeadersDimensions().height+t.manager.getRowPosition(t.virtualRowID)+t.manager.getRowHeight(t.virtualRowID))},onDragLeaveRowHeaderDefault:function(e,t){this._hideRowInsertionMark()},onDropRowHeaderDefault:function(e,t){var i=this.unserializeDragAndDropEvent(e);if(i.source.uuid===this._uxid)t.manager.__draggedVirtualRowID<t.virtualRowID?"top"===t.dropPosition?t.manager.moveRow(t.manager.__draggedVirtualRowID,Math.max(0,t.virtualRowID-1)):t.manager.moveRow(t.manager.__draggedVirtualRowID,t.virtualRowID):"top"===t.dropPosition?t.manager.moveRow(t.manager.__draggedVirtualRowID,t.virtualRowID):t.manager.moveRow(t.manager.__draggedVirtualRowID,t.virtualRowID+1);else{var n=i.data["dswebux/x-spreadsheet.datagrid.rows+json"];n&&("top"===t.dropPosition?n.forEach(function(e,i){console.log("+",Math.max(0,t.virtualRowID-1+i)),t.manager.addRow(e,Math.max(0,t.virtualRowID+i))}):n.forEach(function(e,i){console.log("+",t.virtualRowID+i),t.manager.addRow(e,t.virtualRowID+1+i)}))}},onDragEndRowHeaderDefault:function(e,t){delete t.manager.__draggedVirtualRowID},onDragStartCellDefault:function(e,t){},onDropCellDefault:function(e,t){},onDragEnterBlankDefault:function(e,t){this._hideColumnInsertionMark(),this._hideRowInsertionMark(),this.getManager().getScroller().getContent().addClassName("wux-ui-state-drag-over")},onDragLeaveBlankDefault:function(e,t){this._hideColumnInsertionMark(),this._hideRowInsertionMark(),this.getManager().getScroller().getContent().removeClassName("wux-ui-state-drag-over")},onDropBlankDefault:function(e,t){var i=this.unserializeDragAndDropEvent(e);if(i.source.uuid===this._uxid)t.manager.moveRow(t.manager.__draggedVirtualRowID,t.manager.getNumberOfRows()-1);else{var n=i.data["dswebux/x-spreadsheet.datagrid.rows+json"];n&&n.forEach(function(e){t.manager.addRow(e,t.virtualRowID)})}},performances:{numberOfRowsFactor:2,numberOfColumnsFactor:1.2,fullUpdateFactor:2,enableColumnVirtualization:!1,debounceCellInternalUpdateTimer:0},isSortable:!0,showTaskManager:!1,apiVersion:2},init:function(t,i){this._parent(t),this._uxid=u.getUUID(),this._parentObject=i,this._listOfColumns=[],this.buildView();var n=this;this._buildGrid(),!0===this.options.enableDragAndDrop&&(this.elements.container.addEvent("dragstart",this._onDragStart.bind(this)),this.elements.container.addEvent("drop",this._onDrop.bind(this)),this.elements.container.addEvent("dragover",this._onDragOver.bind(this)),this.elements.container.addEvent("drag",this._onDrag.bind(this)),this.elements.container.addEvent("dragend",this._onDragEnd.bind(this)),this.elements.container.addEvent("dragleave",this._onDragLeave.bind(this)),this.elements.container.addEvent("dragenter",this._onDragEnter.bind(this))),this.elements.container.addEvent("mouseleave",function(){n._hideRowInsertionMark(),n._hideColumnInsertionMark(),n._cellsManager._removeAllInteractiveUIFeedBacks()}),this._onBlurCB=function(e){var t=n._cellsManager;setTimeout(function(){if(t&&t._instance){var e=document.activeElement;if(e){var i=g(e,"wux-afr-actionbar")?e:m(e,"wux-afr-actionbar"),n=g(e,"wux-datagrid")?e:m(e,"wux-datagrid");n&&n.getAttribute("wux-uuid")===t._instance._uxid&&!i?t._giveFocus():n||i||t._lostFocus()}}},1)},e.Element.addEvent.call(document.body,"blur",this._onBlurCB,!0),this.elements.container.addEvent("focus",function(e){n._cellsManager._giveFocus()}),this.options.alternateRowColor&&this.elements.container.setAttribute("alternate-row-color","true"),this.options.showVerticalLines?this.elements.container.setAttribute("show-vertical-lines","true"):this.elements.container.setAttribute("show-vertical-lines","false")},destroy:function(){this._onBlurCB&&(e.Element.removeEvent.call(document.body,"blur",this._onBlurCB,!0),this._onBlurCB=null),this._cellsManager.destroy(),this._cellsManager=null,this._parent()},serializeDragAndDropEvent:function(t,i){var n;if(t.dataTransfer&&"string"==typeof t.dataTransfer.getData("text")&&t.dataTransfer.getData("text").length>0)try{n=JSON.parse(t.dataTransfer.getData("text"))}catch(t){return}return i=e.extend({source:{uuid:this._uxid,amd:"DS/Spreadsheet/DataGrid"},data:{"dswebux/x-spreadsheet.datagrid.data+json":""}},i),n&&(i=e.extend(i,n,!0)),t.dataTransfer.setData("Text",JSON.stringify(i)),JSON.stringify(i)},unserializeDragAndDropEvent:function(e){var t=e.dataTransfer.getData("Text");try{return JSON.parse(t)}catch(e){console.warn('the element being in dataTransfer type "text" is not parsable usable JSON.parse')}},_buildGrid:function(t){t&&e.extend(this.options,t);var i=this;if(i.elements.container.setAttribute("wux-uuid",this._uxid),i._cellsManager&&(i._cellsManager.destroy(),i._cellsManager=null,delete i._cellsManager),i._cellsManager=new this.options.managerClass({allowUnsafeHTMLContent:this.options.allowUnsafeHTMLContent,shouldCellAllowUnsafeHTMLContentAt:this.options.shouldCellAllowUnsafeHTMLContentAt,allowTextCopy:this.options.allowTextCopy,touchMode:this.options.touchMode,onContextualMenuReady:this.options.onContextualMenuReady,selection:this.options.selection,isEditable:this.options.isEditable,iconsSize:this.options.iconsSize,columns:this.options.columns,parent:this,headersDimensions:this.options.headersDimensions,cellClass:this.options.cellClass,childrenMargin:this.options.childrenMargin,defaultCellMouseWidth:this.options.defaultCellMouseWidth,defaultCellMouseHeight:this.options.defaultCellMouseHeight,defaultCellTouchWidth:this.options.defaultCellTouchWidth,defaultCellTouchHeight:this.options.defaultCellTouchHeight,defaultCellWidth:this.options.defaultCellWidth,defaultCellHeight:this.options.defaultCellHeight,rootMargin:this.options.rootMargin,manageHeight:this.options.manageHeight,showRowsHeader:this.options.show.rowHeaders,showColumnsHeader:this.options.show.columnHeaders,isSortable:this.options.isSortable,infiniteScrolling:this.options.infiniteScrolling,height:this.options.height,maxHeight:this.options.maxHeight,resize:this.options.resize,useTransparentScroller:this.options.useTransparentScroller,showScrollbarsOnHover:this.options.showScrollbarsOnHover,performances:this.options.performances||{}},this),this.options.data&&this.options.columns){var n=this._loadInternalModel();0,i._cellsManager.loadModel(n,!0),i._cellsManager._postInitialization(),i.elements.container.empty(),i.options.showLoaderIndicator&&(i.elements.loader.inject(i.elements.container),i.elements.loaderOverlay.inject(i.elements.container)),i._cellsManager.inject(this.elements.container),i._cellsManager.onReady(function(){i._parentObject.elements.container.setAttribute("wux-api-version",i.options.apiVersion)}),i._manageCellRequests()}},_processDragAndDropCallback_v2:function(e){var t=this;if("dragstart"===e.type){this._dragAndDropTransitionForSWX2021xFD01=!0;var i=document;t.getContent()&&t.getContent().ownerDocument&&(i=t.getContent().ownerDocument);var n=function(){this._dragAndDropTransitionForSWX2021xFD01=!1,i.removeEventListener("drop",n),i.removeEventListener("dragend",n)};i.addEventListener("drop",n),i.addEventListener("dragend",n)}if("dragend"!==e.type&&"drop"!==e.type&&"dragcancel"!==e.type||(this.options.enableScrollOnDrag&&(h.ie||h.firefox)&&(t._cellsManager._disableDragAutoScroll(),setTimeout(function(){t._cellsManager._removeAllInteractiveUIFeedBacks()},10)),t._cellsManager.disableDragOverStateForBlank(),t._cellsManager.disableDragOverStateForRow()),"dragleave"!==e.type||g(e.target,"wux-scroller")||g(e.target,"wux-datagrid-cell")||m(e.target,"wux-datagrid-cell")||m(e.target,"wux-scroller")){"drop"!==e.type&&"dragend"!==e.type||t._currentDropCellView&&t._currentDropCellView.removeAttribute("wux-ui-drop-position");var o={dragstart:"onDragStart",dragend:"onDragEnd",dragenter:"onDragEnter",dragleave:"onDragLeave",drag:"onDrag",dragover:"onDragOver",drop:"onDrop"}[e.type],s=this._getDragAndDropInfos(e);if("dragstart"===e.type)if(this._parentObject._shouldAcceptDrag(s)){if(e.dataTransfer){var l=e.target.getBoundingClientRect(),a=e.clientX-l.left,r=e.clientY-l.top;"function"==typeof e.dataTransfer.setDragImage&&e.dataTransfer.setDragImage(e.target,a,r)}}else e.preventDefault();if(s.cellView){var u=s.cellView.getVirtualCoordinates(),d=s.cellView.getGridEngine().getColumnOptions(u.virtualColumnID);s.isHeader?(-1===s.virtualColumnID&&p(o,"RowHeader"),-1===s.virtualRowID&&p(o,"ColumnHeader")):("dragover"===e.type&&(this.options.enableScrollOnDrag&&(h.ie||h.firefox)&&(t._cellsManager.__enableDragAutoScroll||t._cellsManager._enableDragAutoScroll(),t._cellsManager._scrollToPosition(e)),h.firefox&&(t._cellsManager.__preventFFLockUIWhenScrollOnDragOver=!0),t.__toStopDragScroll&&window.clearTimeout(t.__toStopDragScroll),t.__toStopDragScroll=window.setTimeout(function(){t._cellsManager&&(t._cellsManager._disableDragAutoScroll(),t._cellsManager.__preventFFLockUIWhenScrollOnDragOver=!1)},300)),p(o,"Cell"))}else t._cellsManager.__preventDragAndDropOnBlankDuringScrollFlag||p(o,"Blank");"drop"!==e.type&&"dragend"!==e.type||(s.manager.disableDragOverStateForRow(),s.manager.disableDragOverStateForBlank())}function p(i,n){var o=!1,l=!!d&&d[i+n],a=s.parent.options[i+n],r=l||a;r?(o=r.call(s.parent,e,s),c&&"onDragOver"!==i&&console.info("[dnd]",i+n,">",o,e.target)):c&&console.warn("[dnd]","cannot find",i+n,"callback");var u=t.options[i+n+"Default"];u&&(void 0===r||a&&o)&&(c&&(a&&o?console.info("\t>[dnd]","dev want to continue to the default behavior for ",i+n," callback"):console.info("\t>[dnd]","use the default behavior for ",i+n," callback")),u.call(s.parent,e,s))}},_computeDragPosition:function(e,t){var i=function(e,t){var i=e.target;void 0!==t&&(i=m(i,t));var n=i.currentStyle||window.getComputedStyle(i,null),o=parseInt(n.borderLeftWidth,10),s=parseInt(n.borderTopWidth,10),l=i.getBoundingClientRect();return{offsetX:e.clientX-o-l.left,offsetY:e.clientY-s-l.top}}(e=e||window.event,"wux-datagrid-cell").offsetY;if(t&&t.cellView){var n="middle",o=t.cellView.getDimensions(),s=1*o.height/4,l=3*o.height/4;return n=i<s?"top":i>=s&&i<l?"middle":"bottom",this._currentDropCellView!==t.view&&(this._currentDropCellView&&this._currentDropCellView.removeAttribute("wux-ui-drop-position"),this._currentDropCellView=t.view),t.cellView._currentDropPosition!==n&&(t.cellView._currentDropPosition=n,t.view.setAttribute("wux-ui-drop-position",n)),n}},_getDragAndDropInfos:function(e){var t=m(e.target,"wux-datagrid-cell");if(t){var i=this.getManager()._getCellViewFromDom(t).getDragAndDropInfos().from;return("dragover"===e.type||"dragenter"===e.type||"dragleave"===e.type)&&i&&i.cellView&&(i.dropPosition=this._computeDragPosition(e,i)),void 0===i&&(i={manager:this.getManager(),parent:this.getManager()._instance}),i}return{manager:this.getManager(),parent:this.getManager()._instance}},_onDragStart:function(e){var t=this.getManager()._getCellInfosFromDom(e.target),i=!0;if(t.isHeader&&-1===t.virtualRowID)!1!==(i=this.getManager().getColumnOptions(t.dataIndex).isDraggable)&&(i=!0);else{var n=!0;if(t&&t.nodeModel&&(n=t.nodeModel.isSelected()),!n){i=!1;var o=m(e.target,"wux-datagrid-cell");if(o){var s=this.getManager()._getCellViewFromDom(o);s&&(i=s._uiNodeUpForTouchOrDownForMouse(e,"up"))}}i&&(i=this.options.shouldAcceptDrag(t))}i?this._processDragAndDropCallback_v2(e):(e.preventDefault(),c&&console.warn("dragstart prevented"))},_onDrag:function(e){this._processDragAndDropCallback_v2(e);var t=this._getDragAndDropInfos(e);this.options.onDrag&&this.options.onDrag.call(this,e,t)},_onDragEnd:function(e){var t=this.getManager()._getCellInfosFromDom(e.target);this.options.shouldAcceptDrag(t)?this._processDragAndDropCallback_v2(e):e.preventDefault()},_onDrop:function(e){e.preventDefault(),e.stopPropagation(),this._hideColumnInsertionMark(),this._hideRowInsertionMark(),this._processDragAndDropCallback_v2(e)},_onDragOver:function(e){e.preventDefault(),this._processDragAndDropCallback_v2(e)},_onDragLeave:function(e){this._processDragAndDropCallback_v2(e)},_onDragEnter:function(e){e.preventDefault(),e.stopPropagation(),this._processDragAndDropCallback_v2(e)},_showRowInsertionMark:function(t){var i=this;setTimeout(function(){void 0===i._insertRowMark?i._insertRowMark=new e.Element("div",{class:"wux-datagrid-row-insertion-mark",styles:{position:"absolute",top:t,left:0,height:2,right:0,zIndex:400010}}).inject(i.elements.container):i._insertRowMark.setStyles({display:"block",top:t})},10)},_hideRowInsertionMark:function(){if(void 0!==this._insertRowMark){this._insertRowMark.hide()}},_showColumnInsertionMark:function(t){var i=this;setTimeout(function(){void 0===i._insertMark?i._insertMark=new e.Element("div",{class:"wux-datagrid-column-insertion-mark",styles:{position:"absolute",top:0,left:t,width:2,bottom:0,zIndex:400010}}).inject(i.elements.container):(i._insertMark.setStyles({display:"block",left:t}),i._insertMark.parentNode||i._insertMark.inject(i.elements.container))},1)},_hideColumnInsertionMark:function(){if(void 0!==this._insertMark){this._insertMark.hide()}},_highlightDropArea:function(e){this._unhighlightDropArea(),this._currentDropArea=e,this._currentDropArea.elements.container.addClassName("wux-ui-state-drag-over")},_unhighlightDropArea:function(){this._currentDropArea&&this._currentDropArea.elements.container.removeClassName("wux-ui-state-drag-over").removeAttribute("wux-ui-drop-position")},_getGlobalIsEditableOptions:function(){var e=this._cellsManager.options.isEditable;return!0===e||!1!==e&&("object"==typeof e?{switchToWriteView:e.switchToWriteView,switchToReadView:e.switchToReadView,rowsHeaders:e.rowsHeaders,columnsHeaders:e.columnsHeaders,cells:e.cells,columnsAreDraggable:e.columnsAreDraggable,rowsAreDraggable:e.rowsAreDraggable}:void 0)},_manageCellRequests:function(){var t=this;this._cellsManager._listOfColumnPerformances={},t._cellsManager.onCellRequest(function(i){var n;t._cellsManager._debugPerformanceIssues&&(void 0===t._cellsManager._listOfColumnPerformances[i.dataIndex]&&(t._cellsManager._listOfColumnPerformances[i.dataIndex]=[]),n=window.performance?performance.now():Date.now());var o=i.virtualRowID,s=i.virtualColumnID,l=i.cellModel;if(l){var a=l.getCellContent(),r=t._getGlobalIsEditableOptions(),u=t._cellsManager.getColumnOptions(s);if(!u.onCellRequest){var c=u?u.isEditable:{};e.extend(r,c,!0).switchToReadView?(i.cellView._virtualRowID=o,i.cellView._virtualColumnID=s):(i.cellView._virtualRowID=o,i.cellView._virtualColumnID=s,d.getUnsafeHTMLContentValueToApply(!1===i.cellView.getGridEngine().options.shouldCellAllowUnsafeHTMLContentAt(i))?i.cellView.getContent().textContent=a:i.cellView.getContent().innerHTML=a)}}if(t._cellsManager._debugPerformanceIssues){var h=window.performance?performance.now():Date.now();t._cellsManager._listOfColumnPerformances[i.dataIndex].push(h-n)}}),t._cellsManager.onColumnHeaderRequest(t._columnHeaderRequest.bind(t))},_columnHeaderRequest:function(e){var t,i=this,n=e.virtualColumnID;if(i.options.columns[n]){t=i.options.columns[n].text,e.cellView.getContent().setContent(t),e.isHeader=!0;var o=i._cellsManager.getColumnOptions(n);o.onCellRequest&&(i._cellsManager._isRequestingCell=!0,o.onCellRequest.call(i._cellsManager,e),i._cellsManager._isRequestingCell=!1)}},updateHeight:function(e){this.elements.container.setStyle("height","auto"===e?"":e),"auto"===e?this.elements.container.setStyles({position:"absolute",top:0,left:0,bottom:0,width:"100%"}):this.elements.container.setStyle("position","relative"),this.getManager().updateHeight(e)},buildView:function(){this.elements.container=new e.Element("div",{class:"wux-datagrid",tabindex:0,styles:{position:"relative",height:"auto"===this.options.height?"":this.options.height}}),"auto"===this.options.height&&this.elements.container.setStyles({position:"absolute",top:0,left:0,bottom:0,width:"100%"}),this.options.showLoaderIndicator&&(this.elements.loader=new i({asyncUpdate:!1}),this.elements.loaderOverlay=new e.Element("div",{class:"wux-datagrid-overlay"}),this.elements.loaderOverlay.inject(this.elements.container),this.elements.loader.inject(this.elements.container),this.elements.loader.getContent().setStyles({position:"absolute",top:"50%",left:"50%",zIndex:1e7}))},_loadInternalModel:function(t){this._cellsManager.prepareUpdateView();var i,n=new s,l=[],r=this.options,u=0,d=r.data.length,c=r.columns.length,h=this;this._cellsManager.empty(),this.options.columns.forEach(function(e,t){h._listOfColumns.push(e.dataIndex),void 0===h.options.columns[t].minWidth&&(h.options.columns[t].minWidth=0),void 0===h.options.columns[t].width&&(h.options.columns[t].width=h.options.defaultCellWidth),h.getManager()._setupColumnType(e),h._cellsManager._columnsList[t]=new o({isHeader:!0,rowID:-1,columnID:t,value:e.text,manager:this})});var m=d*c;return h.options.showLoaderIndicator&&(this.elements.loader.on(0,!0),this.elements.loaderOverlay.addClassName("wux-ui-state-on")),a.forEach(r.data,function(t,s){var a=parseInt(++u*c/m*100,10).toString()+"%";h.options.showLoaderIndicator&&setTimeout(function(){h.elements.loader.update(a)},0),l[s+0]||(l[s+0]=[]);for(var d=h._readRowData(r.data,s),g=0;g<d.length-1;g++){var p,w=d[g];"object"==typeof w&&w.properties?(p=e.extend({isHeader:!1,isEditable:h.options.isEditable,rowID:s+0,columnID:g+0,value:w.value,manager:h._cellsManager},w),1===w.properties.rowSpan&&1===w.properties.colSpan||n.pushAction({actionObj:h._cellsManager,actionFunc:h._cellsManager.setCellSpan,actionParamsList:[s+0,g+0,{rowSpan:w.properties.rowSpan,colSpan:w.properties.colSpan}]})):p={isHeader:!1,isEditable:h.options.isEditable,rowID:s+0,columnID:g+0,value:d[g],manager:h._cellsManager},i=new o(p,h.elements.cellsContainer),l[s+0][g+0]=i}},100,function(){h._cellsManager.pushUpdateView(),t&&t.call(h),h.options.showLoaderIndicator&&(h.elements.loader.off(),h.elements.loaderOverlay.removeClassName("wux-ui-state-on")),h.__loadOverlayTimeOut=window.setTimeout(function(){h.elements&&h.elements.loaderOverlay&&(h.elements.loaderOverlay.remove(),h.__loadOverlayTimeOut=null)},500)}),this._cellsManager.onReady(function(){n.play(),h.options.columns.forEach(function(e,t){e.isHidden&&h._cellsManager.hideColumn(e.dataIndex)})}),l},getManager:function(){return this._cellsManager},_readRowData:function(e,t){for(var i=[],n=t,o=this.options.columns.length,s=0;s<o;s++)void 0!==e[n][this._listOfColumns[s]]?i.push(e[n][this._listOfColumns[s]]):i.push("");return e[n]._rowProperties?i.push(e[n]._rowProperties):i.push({rowIndex:null,isHidden:!1}),i}}),w=t.extend({defaultOptions:{data:[],useHeaders:!0,useFormulaBar:!1,useDynamicLoading:!0,headersAreStatic:!0,_autoDisplay:!0,onDrop:null,onDragOver:null,onDragLeave:null,height:300,isEditable:!1,headersDimensions:{width:50,height:25},defaultCellHeight:50,settings:null,alternateRowColor:!1,cellClass:l,shouldAcceptDrag:function(e){return!0}},init:function(t,i){this._parent(t),void 0===i&&(i=this),this.elements.container=new e.Element("div"),this._datagrid=new p(this.options,i),this._setEditionMode(1),this.buildView()},updateHeight:function(e){this._datagrid.updateHeight(e)},_setEditionMode:function(e){this._editionMode=e},_getEditionMode:function(e){return this._editionMode},destroy:function(){this._datagrid.destroy(),this._datagrid=null,this.__loadOverlayTimeOut&&window.clearTimeout(this.__loadOverlayTimeOut),this._parent()},_shouldAcceptDrag:function(e){var t=this.getManager().getColumnOptions(e.dataIndex);if(e.isHeader){if(-1===e.virtualRowID){var i=t.isColumnMovable;return void 0===i&&(i=!0),i}return this._datagrid.options.rowsAreDraggable}var n=t.isColumnDraggable;return void 0===n&&(n=!0),!!n&&this.options.shouldAcceptDrag(e)},getManager:function(){return this._datagrid?this._datagrid._cellsManager:null},loadModel:function(e){this._datagrid._buildGrid(e),this._datagrid._manageCellRequests()},reloadModel:function(){var e=this._datagrid._loadInternalModel();this.loadModel(e)},buildView:function(){this.elements.formContainer=new e.Element("form",{styles:{height:"100%",margin:0,padding:0}}).inject(this.elements.container);var t=document.createAttribute("novalidate");this.elements.formContainer.setAttributeNode(t),this.elements.formSubmitButton=new e.Element("input",{type:"submit",styles:{display:"none"}}).inject(this.elements.formContainer),this._datagrid.inject(this.elements.formContainer)},giveFocus:function(){this._datagrid.elements.container.focus()},lostFocus:function(){this._datagrid.elements.container.blur()}});return e.namespace("WUX/Controls/Spreadsheet",w)}),define("DS/Spreadsheet/RulesEditor",["UWA/Core","UWA/Event","UWA/Controls/Abstract","DS/Core/Core","DS/Spreadsheet/DataGrid","DS/Core/ActionsStack","DS/Core/PointerEvents"],function(e,t,i,n,o,s,l){"use strict";return i.extend({defaultOptions:{spreadsheet:null},init:function(e){this._parent(e),console.warn("Do not use","Spreadsheet/RulesEditor"),this._rules={},this._actionStack=new s,this._buildView(),this._fillView(),this._buildBottomHeader()},_buildView:function(){this.elements.container=new e.Element("div",{styles:{position:"absolute",top:5,bottom:5,right:5,left:5,padding:20,backgroundColor:"rgba(255,255,255,1)",border:"1px solid white",zIndex:1e3}}).inject(document.body),this.elements.topHeader=new e.Element("h1",{class:"wux-datagrid-preference-topheader",html:"Rules"}).inject(this.elements.container),this.elements.body=new e.Element("div",{class:"wux-datagrid-preference-body",styles:{overflow:"hidden"}}).inject(this.elements.container),this.elements.bottomHeader=new e.Element("div",{class:"wux-datagrid-preference-bottomheader",styles:{textAlign:"right"}}).inject(this.elements.container)},show:function(){this._actionStack.clear(),this.elements.container.show()},_buildBottomHeader:function(){var t=new e.Element("button",{class:"wux-controls-button",html:"Apply"}).inject(this.elements.bottomHeader),i=new e.Element("button",{class:"wux-controls-button",html:"Cancel"}).inject(this.elements.bottomHeader),n=this;t.addEventListener(l.POINTERUP,function(){n.applySetting(),n.elements.container.hide()}),i.addEventListener(l.POINTERUP,function(){n.elements.container.hide()})},applySetting:function(){var e=this.options.spreadsheet.getManager(),t=this._rulesGrid.getManager(),i=[];t.getRows().forEach(function(n,o){var s={};n.forEach(function(e,i){s[t.getDataIndexFromColumnID(i)]=e.getCellContent()}),s.active&&i.push({match:function(e){if(e.dataIndex===s.column)switch(s.operator){case"is":if(e.cellModel.getCellContent()===s.value)return!0;break;case"contains":if(-1!==e.cellModel.getCellContent().indexOf(s.value))return!0;break;case"greater":if(e.cellModel.getCellContent()>s.value)return!0;break;case"lower":if(e.cellModel.getCellContent()<s.value)return!0}},onMatch:function(t){switch(s.ruleAction){case"hide":e.hideRow(t.virtualRowID);break;case"show":e.showRow(t.virtualRowID);break;case"remove":e.removeRow(t.virtualRowID);break;case"highlight":e.highlightRow(t.virtualRowID);break;case"unhighlight":e.unhighlightRow(t.virtualRowID)}},stopProcessingRowAtMatch:!0})}),e.applyRules(i)},_fillView:function(){var t=[],i=this.options.spreadsheet,n=i.getManager().options.columns,s=function(t){var i=new e.Element("select");return t.options.forEach(function(t){new e.Element("option",{html:t.label,value:t.value}).inject(i)}),t.cellModel.setCellContent(i.value),i.addEventListener("change",function(e){t.cellModel.setCellContent(this.value)}),i},l=function(e){var t=[];return n.forEach(function(e){t.push({label:e.text,value:e.dataIndex})}),new s({options:t,cellModel:e.cellModel})},a=function(e){return new s({options:[{label:"is",value:"is"},{label:"contains",value:"contains"},{label:"is greater than",value:"greater"},{label:"is lower than",value:"lower"}],cellModel:e.cellModel})},r=function(e){return new s({options:[{label:"highlight",value:"highlight"},{label:"unhighlight",value:"unhighlight"},{label:"show",value:"show"},{label:"hide",value:"hide"},{label:"remove",value:"remove"}],cellModel:e.cellModel})};n.forEach(function(e,n){var o={colVisibility:!i.getManager().isColumnHidden(n),colName:e.text,colColor:"#FFFFFF"};t.push(o)});var u=new o({columns:[{text:"Enable/Disable",dataIndex:"active",width:"10%"},{text:"Column value",dataIndex:"column",width:"20%"},{text:"Operator",dataIndex:"operator",width:"10%"},{text:"Value to match",dataIndex:"value",width:"20%"},{text:"Action",dataIndex:"ruleAction",width:"20%"},{text:"",dataIndex:"editRules",width:"20%"}],data:t,selection:{cells:!1},headersDimensions:{width:40,height:20},isEditable:{switchToWriteView:{event:"",callback:function(e){},view:function(e){}},switchToReadView:{event:"blur",callback:function(e){this.switchToReadView()},view:function(t){switch(t.dataIndex){case"column":return new l({cellModel:t.cellModel});case"operator":return new a({cellModel:t.cellModel});case"ruleAction":return new r({cellModel:t.cellModel});case"value":return new e.Element("input",{type:"text",value:t.cellModel.getCellContent(),events:{change:function(e){t.cellModel.setCellContent(this.value)}}});case"active":var i=new e.Element("input",{type:"checkbox",events:{change:function(e){t.cellModel.setCellContent(this.checked)}}});return!0===t.cellModel.getCellContent()&&i.setAttribute("checked","true"),i;case"editRules":var n=new e.Element("div");new e.Element("div",{html:"+",styles:{height:16,width:16,minWidth:16,textAlign:"center",padding:0,lineHeight:"16px",borderRadius:"50%",fontWeight:800,color:"grey",fontSize:"14px"},class:"wux-controls-button wux-ui-state-no-selection",events:{click:function(e){t.manager.addRow(void 0,t.virtualRowID)}}}).inject(n),new e.Element("div",{html:"-",styles:{height:16,width:16,minWidth:16,textAlign:"center",padding:0,lineHeight:"16px",borderRadius:"50%",fontWeight:800,color:"grey",fontSize:"14px"},class:"wux-controls-button wux-ui-state-no-selection",events:{click:function(e){t.manager.removeRow(t.virtualRowID)}}}).inject(n);return n;default:return new e.Element("div",{html:t.cellModel.getCellContent()})}}},rowsHeaders:!1,columnsHeaders:!1,cells:!0,columnsAreDraggable:!1,rowsAreDraggable:!0},height:"auto"}).inject(this.elements.body);this._rulesGrid=u,u.getManager().onRowHeaderRequest(function(t){var i,n=this._getCellsModel(),o=t.virtualRowID;(t.cellView.getContent().setStyles({paddingLeft:5,paddingRight:5}),n[o])&&(n[o][0]&&(i=new e.Element("div",{class:"wux-ui-hamburger",styles:{opacity:.5,margin:5,fontSize:"1.5em"}})),t.cellView.getContent&&t.cellView.getContent().setHTML(i))}),u.elements.container.setStyles({width:800});var d=this;u.getManager().onMoveRow(function(e){d._actionStack.pushAction({actionObj:i.getManager(),actionFunc:i.getManager().moveColumn,actionParamsList:[e.fromRowID,e.toRowID]})})}})}),define("DS/Spreadsheet/Preferences",["UWA/Core","UWA/Event","UWA/Controls/Abstract","DS/Core/Core","DS/Spreadsheet/DataGrid","DS/Core/ActionsStack","DS/Core/PointerEvents"],function(e,t,i,n,o,s,l){"use strict";return i.extend({defaultOptions:{spreadsheet:null},init:function(e){this._parent(e),this._thingsToApply={},this._actionStack=new s,this._buildView(),this._fillView(),this._buildBottomHeader()},_buildView:function(){this.elements.container=new e.Element("div",{styles:{position:"absolute",top:5,bottom:5,right:5,left:5,padding:20,backgroundColor:"rgba(255,255,255,1)",border:"1px solid white",zIndex:1e3}}).inject(document.body),this.elements.topHeader=new e.Element("h1",{class:"wux-datagrid-preference-topheader",html:"Grid preferences"}).inject(this.elements.container),this.elements.body=new e.Element("div",{class:"wux-datagrid-preference-body"}).inject(this.elements.container),this.elements.bottomHeader=new e.Element("div",{class:"wux-datagrid-preference-bottomheader",styles:{textAlign:"right"}}).inject(this.elements.container)},show:function(){this._actionStack.clear(),this.elements.container.show()},_buildBottomHeader:function(){var t=new e.Element("button",{class:"wux-controls-button",html:"Apply"}).inject(this.elements.bottomHeader),i=new e.Element("button",{class:"wux-controls-button",html:"Cancel"}).inject(this.elements.bottomHeader),n=this;t.addEventListener(l.POINTERUP,function(){n.applySetting(),n.elements.container.hide()}),i.addEventListener(l.POINTERUP,function(){n.elements.container.hide()})},applySetting:function(){var e=this,t=this.options.spreadsheet;for(var i in e._thingsToApply){var n,o=e._thingsToApply[i];if(void 0!==o.bgColor&&e._actionStack.pushAction({actionObj:t.getManager(),actionFunc:t.getManager().styleColumn,actionParamsList:[parseInt(i,10),{backgroundColor:o.bgColor}]}),void 0!==o.visibility)n=o.visibility?t.getManager().showColumn:t.getManager().hideColumn,e._actionStack.pushAction({actionObj:t.getManager(),actionFunc:n,actionParamsList:[parseInt(i,10)]})}e._actionStack.play()},_fillView:function(){var t=[],i=this.options.spreadsheet;i.getManager().options.columns.forEach(function(e,n){var o={colVisibility:!i.getManager().isColumnHidden(n),colName:e.text,colColor:"#FFFFFF"};t.push(o)});var n=new o({columns:[{text:"Column",dataIndex:"colName"},{text:"Hide/Show",dataIndex:"colVisibility"},{text:"Color",dataIndex:"colColor"}],data:t,selection:{cells:!1},headersDimensions:{width:40,height:20},isEditable:{switchToWriteView:{event:"dblclick",callback:function(e){this.switchToWriteView()},view:function(t){return new e.Element("input",{type:"text",value:t.getCellContent()})}},switchToReadView:{event:"blur",callback:function(e){this.switchToReadView()},view:function(t){switch(t.cellModel.getColumnID()){case 2:var n=i.getManager().getColumnOptions(t.cellModel.getRowID());return new e.Element("input",{type:"color",value:n._bgcolor||"#FFFFFF",events:{change:function(e){console.log(this.value);var i=this.value,o=t.cellModel.getRowID();n._bgcolor=i,s._thingsToApply[o]||(s._thingsToApply[o]={}),s._thingsToApply[o].bgColor=i}}});case 1:var o=new e.Element("input",{type:"checkbox",events:{change:function(e){var i=t.cellModel.getView().getVirtualCoordinates().virtualRowID;s._thingsToApply[i]||(s._thingsToApply[i]={}),s._thingsToApply[i].visibility=this.checked}}});return!0===t.cellModel.getCellContent()&&o.setAttribute("checked","true"),o;default:return new e.Element("div",{html:t.cellModel.getCellContent()})}}},rowsHeaders:!1,columnsHeaders:!1,cells:!0,columnsAreDraggable:!1,rowsAreDraggable:!0}}).inject(this.elements.body);n.getManager().onRowHeaderRequest(function(t){var i;t.cellView.getContent().setStyles({paddingLeft:5,paddingRight:5}),i=new e.Element("div",{class:"wux-ui-fa wux-ui-fa-bars"}),t.cellView.getContent&&t.cellView.getContent().setHTML(i)}),n.elements.container.setStyles({width:440});var s=this;n.getManager().onMoveRow(function(e){s._actionStack.pushAction({actionObj:i.getManager(),actionFunc:i.getManager().moveColumn,actionParamsList:[e.fromRowID,e.toRowID]})})}})});