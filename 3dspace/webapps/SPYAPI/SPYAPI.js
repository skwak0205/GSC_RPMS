/*!  Copyright 2014 Dassault Systemes. All rights reserved. */
define("DS/SPYAPI/SensorsAccess",["UWA/Core","UWA/Class"],function(e,i){"use strict";return i.extend({init:function(e){this._parent(e),this._spm=e.spm,this._seqId=isNaN(e.seqIdx)?0:e.seqIdx},getSequenceName:function(){var e;return this._spm&&!isNaN(this._seqId)&&(e=this._spm.getSequenceName(this._seqId)),e},getGlobalSensors:function(e){var i=[];if(this._spm&&!isNaN(this._seqId)){var n;if(this._spm.dataLevel>=2)n=this._spm.getSharedDataDisplayList(this._seqId);else{var t=this._spm.getDataDisplayList(this._seqId).filter(function(e){return"Result"===e.category});n=t.length>0?[t[0]]:[]}if(n){var a=e&&e.sensorsContainerName?e.sensorsContainerName:"Sensors",s=e&&e.sensorsContainerType?e.sensorsContainerType:"Sensors";n.forEach(function(e){e.getNavDataFrameViewList().forEach(function(e){e.name!==a&&e.type!==s||!e.getChildren||e.getChildren().forEach(function(e){var n={name:e.name,parameters:[]};if(e.getChildren){var t=e.getChildren();if(t&&t.length>0){var a=t[0];if(a&&a.getChildren)a.getChildren().forEach(function(e){n.parameters.push({name:e.name,value:e.value,unit:e.unit})}),i.push(n)}}})})})}}return i},_getSensors:function(e){var i=!e||void 0===e.sensors||e.sensors,n=!e||void 0===e.frequencySensors||e.frequencySensors,t=!e||void 0===e.massSensors||e.massSensors,a=e&&e.globalOnly,s=[];if(this._spm&&!isNaN(this._seqId)){var o;if(this._spm.dataLevel>=2)o=this._spm.getSharedDataDisplayList(this._seqId);else{var r=this._spm.getDataDisplayList(this._seqId).filter(function(e){return"Result"===e.category});o=r.length>0?[r[0]]:[]}if(o){var l=e&&e.sensorsContainerName?e.sensorsContainerName:"Sensors",d=e&&e.sensorsContainerType?e.sensorsContainerType:"Sensors",m=e&&e.sensorName?e.sensorName:void 0;o.forEach(function(e){e.getNavDataFrameViewList().forEach(function(e){e.name!==l&&e.type!==d||!e.getChildren||e.getChildren().forEach(function(e){if(!(m&&e.name!==m||"Sensor"===e.type&&!i||"FrequencySensor"===e.type&&!n||"MassSensor"===e.type&&!t)){var o={name:e.getName(),parameters:[]};if(e.getChildren){var r=e.getChildren();r&&r.length>0&&(r.forEach(function(e){var i=e;if(i&&i.getChildren)i.getChildren().forEach(function(e){o.parameters.push({name:e.getName(),value:e.value,unit:e.unit})});else if(!a&&i.getCurves){var n=i;n.getCurves().forEach(function(e){var i={name:e.name,yUnit:n.unitY,values:[]};e.getValues().forEach(function(e){i.values.push({x:e.getX(),y:e.getY(),groupId:e.getGroupId(),groupIdNls:e.getGroupIdNLS()})}),o.parameters.push(i)})}}),o.parameters.length>0&&s.push(o))}}})})})}}return s},getSensors:function(e){return this._getSensors({sensorName:e?e.sensorName:void 0,globalOnly:e?e.globalOnly:void 0,frequencySensors:!1,massSensors:!1})},getFrequencySensors:function(e){return this._getSensors({sensorName:e?e.sensorName:void 0,globalOnly:e?e.globalOnly:void 0,sensors:!1,massSensors:!1})},getMassSensors:function(e){return this._getSensors({sensorName:e?e.sensorName:void 0,globalOnly:e?e.globalOnly:void 0,sensors:!1,frequencySensors:!1})},getAllSensors:function(e){return this._getSensors({sensorName:e?e.sensorName:void 0,globalOnly:e?e.globalOnly:void 0})}})}),define("DS/SPYAPI/SimulationPlayerAPI",["UWA/Core","UWA/Class","DS/CoreEvents/Events","DS/SPYUI/controllers/SessionStateManager"],function(e,i,n,t){"use strict";var a=function(e){console.error(e)},s=function(e,i){e&&e(i)},o=i.extend({init:function(e){this.spmUI=e?e.mySPMUI:void 0,this.spm=e?e.mySPM?e.mySPM:this.spmUI?this.spmUI.getSPM():void 0:void 0,!this.spmUI||this.spm,this._initDone=this.spm&&this.spmUI,this._initDone||a(" SPY API - init - unexpected error retrieving SPM & SPMUI ")},activatePlot:function(e){if(this._initDone||this.init(),this._initDone&&this.spm)if(e&&!isNaN(e.sequenceIndex)&&e.plotName){var i,n=this.spm.getDataDisplayList(e.sequenceIndex);if(n&&n.length>0){for(var t=0;t<n.length;t++)if(n[t].name===e.plotName){i=t;break}if(isNaN(i))a(" SPY API - activatePlot - plot not found"),s(e.onErrorCallback,"E_PLOTNOTFOUND");else{var o;if(e.frameGlobalIndex)o=e.frameGlobalIndex;else if(void 0===e.stepName)a(" SPY API - activatePlot - step name undefined"),s(e.onErrorCallback,"E_STEPUNDEFINED");else{for(var r=n[i].getAnimationStructure().groupList,l=[],d=0;d<r.length;d++)r[d].rootName===e.stepName&&l.push(r[d]);if(l.length>0){var m,I=[],h="E_UNEXPECTED";if(e.loadCaseName?(m=e.loadCaseName,h="E_LOADCASENOTFOUND"):void 0===l[0].loadCaseName?I=l:m=l[l.length-1].loadCaseName,0===I.length&&m)for(var c=0;c<l.length;c++)l[c].loadCaseName===e.loadCaseName&&I.push(l[c]);if(I.length>0){var g,P,E,f;if(h="E_UNEXPECTED",e.modeIndex){for(h="E_MODENOTFOUND",f=0;f<I.length;f++)if(I[f].modeIndex===e.modeIndex){E=I[f];break}}else if(void 0===I[0].modeIndex)E=I[0];else{var u=isNaN(e.framePosition)?Number(e.framePosition):e.framePosition;if(isNaN(u))E=I[I.length-1];else for(f=0;f<I.length;f++){var p=I[f].frameList;for(P=0;P<p.length;P++)if(p[P].position===u){g=p[P];break}if(g)break}}if(g||E){if(!g)if(e.framePosition||e.frameIndex){for(h="E_FRAMENOTFOUND",P=0;P<E.frameList.length;P++)if(E.frameList[P].position===e.framePosition||E.frameList[P].localIndex===e.frameIndex){g=E.frameList[P];break}g||(a(" SPY API - activatePlot - frame not found"),s(e.onErrorCallback,h))}else g=E.frameList[E.frameList.length-1];g&&(o=g.globalIndex)}else a(" SPY API - activatePlot - mode filtering failed"),s(e.onErrorCallback,h)}else a(" SPY API - activatePlot - load case filtering failed"),s(e.onErrorCallback,h)}else a(" SPY API - activatePlot - step not found"),s(e.onErrorCallback,"E_STEPNOTFOUND")}if(o){var N=function(){this.spmUI.getActiveDD()===n[i]?(e.partialAnimation&&this.spmUI.getActiveDD().setPartialAnimationMode(!0),this.spmUI.navigateToFrame(o,function(){var i;this.spmUI.animationFrameIdx===o-1?(i=e.onCompleteCallback)&&i():(a(" SPY API - activatePlot - error navigating to frame"),s(e.onErrorCallback,"E_FRAMEUNEXPECTED"))}.bind(this))):(a(" SPY API - activatePlot - error activating datadisplay"),s(e.onErrorCallback,"E_PLOTUNEXPECTED"))}.bind(this);this.spmUI.activateContent(e.sequenceIndex,i,N)}}}else a(" SPY API - activatePlot - content of given sequence undefined or empty"),s(e.onErrorCallback,"E_INVALIDSEQUENCE")}else a(" SPY API - activatePlot - invalid options "),s(e.onErrorCallback,"E_INVALIDARG");else a(" SPY API - activatePlot - API not initialized "),s(e.onErrorCallback,"E_APINOTINITIALIZED")},addPlot:function(e){this._initDone||this.init(),this._initDone&&this.spm||(a(" SPY API - addPlot - API not initialized "),s(e.onErrorCallback,"E_APINOTINITIALIZED")),a(" SPY API - addPlot - not implemented"),s(e.onErrorCallback,"E_NOTIMPLEMENTED")},replacePlot:function(e){this._initDone||this.init(),this._initDone&&this.spm||(a(" SPY API - replacePlot - API not initialized "),s(e.onErrorCallback,"E_APINOTINITIALIZED")),a(" SPY API - replacePlot - not implemented"),s(e.onErrorCallback,"E_NOTIMPLEMENTED")},removePlot:function(e){this._initDone||this.init(),this._initDone&&this.spm||(a(" SPY API - removePlot - API not initialized "),s(e.onErrorCallback,"E_APINOTINITIALIZED")),a(" SPY API - removePlot - not implemented"),s(e.onErrorCallback,"E_NOTIMPLEMENTED")},showLegend:function(){if(this._initDone||this.init(),this._initDone&&this.spmUI){var e=this.spmUI.frame2D;e&&(e.style.display="block")}else a(" SPY API - showLegend - API not initialized ")},hideLegend:function(){if(this._initDone||this.init(),this._initDone&&this.spmUI){var e=this.spmUI.frame2D;e&&(e.style.display="none")}else a(" SPY API - hideLegend - API not initialized ")},setLegendMin:function(e){var i;if(this._initDone||this.init(),this._initDone&&this.spm){var n,t=this.spmUI.getActiveDD();if(t&&t.spm.window&&(n=this.spmUI._isAFullExperience(t.spm.window.experience)),n)if(this.spmUI.isAnimationRunning())a(" SPY API - setLegendMin - animation running "),e&&s(e.onErrorCallback,"E_ANIMATIONRUNNING");else{var o=t?t.getLegend():void 0;o?e&&e.minValue?void 0!==e.minValue&&isNaN(e.minValue)?(a(" SPY API - setLegendMin - invalid arguments "),e&&s(e.onErrorCallback,"E_INVALIDARG")):i=o.setUserMin(e.minValue,e.frameGlobalIndex):i=o.setUserMin():(a(" SPY API - setLegendMin - no legend available "),e&&s(e.onErrorCallback,"E_NOLEGEND"))}else a(" SPY API - setLegendMin - experience not authorized "),e&&s(e.onErrorCallback,"E_EXPERIENCENOTAUTHORIZED")}else a(" SPY API - setLegendMin - API not initialized "),e&&s(e.onErrorCallback,"E_APINOTINITIALIZED");return i},setLegendMax:function(e){var i;if(this._initDone||this.init(),this._initDone&&this.spm){var n,t=this.spmUI.getActiveDD();if(t&&t.spm.window&&(n=this.spmUI._isAFullExperience(t.spm.window.experience)),n)if(this.spmUI.isAnimationRunning())a(" SPY API - setLegendMax - animation running "),e&&s(e.onErrorCallback,"E_ANIMATIONRUNNING");else{var o=t?t.getLegend():void 0;o?e&&e.maxValue?void 0!==e.maxValue&&isNaN(e.maxValue)?(a(" SPY API - setLegendMax - invalid arguments "),e&&s(e.onErrorCallback,"E_INVALIDARG")):i=o.setUserMax(e.maxValue,e.frameGlobalIndex):i=o.setUserMax():(a(" SPY API - setLegendMax - no legend available "),e&&s(e.onErrorCallback,"E_NOLEGEND"))}else a(" SPY API - setLegendMax - experience not authorized "),e&&s(e.onErrorCallback,"E_EXPERIENCENOTAUTHORIZED")}else a(" SPY API - setLegendMax - API not initialized "),e&&s(e.onErrorCallback,"E_APINOTINITIALIZED");return i},getLegendUserMin:function(e){var i;if(this._initDone||this.init(),this._initDone&&this.spm){var n=this.spmUI.getActiveDD(),t=n?n.getLegend():void 0;t?i=t.userMin:(a(" SPY API - getLegendUserMin - no legend available "),e&&s(e.onErrorCallback,"E_NOLEGEND"))}else a(" SPY API - getLegendUserMin - API not initialized "),e&&s(e.onErrorCallback,"E_APINOTINITIALIZED");return i},getLegendUserMax:function(e){var i;if(this._initDone||this.init(),this._initDone&&this.spm){var n=this.spmUI.getActiveDD(),t=n?n.getLegend():void 0;t?i=t.userMax:(a(" SPY API - getLegendUserMax - no legend available "),e&&s(e.onErrorCallback,"E_NOLEGEND"))}else a(" SPY API - getLegendUserMax - API not initialized "),e&&s(e.onErrorCallback,"E_APINOTINITIALIZED");return i},getLegendComputedMin:function(e){var i;if(this._initDone||this.init(),this._initDone&&this.spm){var n=this.spmUI.getActiveDD(),t=n?n.getLegend():void 0;t?(i={global:t.min,local:[]},e&&!isNaN(e.frameGlobalIndex)?e.frameGlobalIndex>=0&&e.frameGlobalIndex<t.localMin.length?i.local.push(t.localMin[e.frameGlobalIndex]):(a(" SPY API - getLegendComputedMin - invalid frame index "),s(e.onErrorCallback,"E_INVALIDARG")):i.local=i.local.concat(t.localMin)):(a(" SPY API - getLegendComputedMin - no legend available "),e&&s(e.onErrorCallback,"E_NOLEGEND"))}else a(" SPY API - getLegendComputedMin - API not initialized "),e&&s(e.onErrorCallback,"E_APINOTINITIALIZED");return i},getLegendComputedMax:function(e){var i;if(this._initDone||this.init(),this._initDone&&this.spm){var n=this.spmUI.getActiveDD(),t=n?n.getLegend():void 0;t?(i={global:t.max,local:[]},e&&!isNaN(e.frameGlobalIndex)?e.frameGlobalIndex>=0&&e.frameGlobalIndex<t.localMax.length?i.local.push(t.localMax[e.frameGlobalIndex]):(a(" SPY API - getLegendComputedMax - invalid frame index "),s(e.onErrorCallback,"E_INVALIDARG")):i.local=i.local.concat(t.localMax)):(a(" SPY API - getLegendComputedMax - no legend available "),e&&s(e.onErrorCallback,"E_NOLEGEND"))}else a(" SPY API - getLegendComputedMax - API not initialized "),e&&s(e.onErrorCallback,"E_APINOTINITIALIZED");return i},setExperienceState:function(e,i){this._initDone||this.init(),this._initDone&&this.spm?t.loadState(e,{onComplete:i.onStateChangeComplete,onError:i.onStateChangeFailed}):(a(" SPY API - setExperienceState - API not initialized "),s(i.onStateChangeFailed,"E_APINOTINITIALIZED"))},getExperienceState:function(){return this._initDone||this.init(),this._initDone&&this.spm?t.getState():(a(" SPY API - setExperienceState - API not initialized "),null)},onStreamLoaded:function(e){this._initDone||this.init(),this._initDone&&this.spm?(this._streamLoadedCB&&(n.unsubscribe(this._streamLoadedCB),delete this._streamLoadedCB),e&&(this._streamLoadedCB=n.subscribe({event:this.spm.ctx+"/SPY/SEQUENCE/CREATED"},function(i){var n={streamIndex:i.seqIdx,streamName:i.seqName};i.spm.window&&i.spm.window.experience&&(n.streamTotalNumber=i.spm.window.experience.loader.getReport().streamNb),e(n)}))):a(" SPY API - setExperienceState - API not initialized ")}});return e.namespace("DS/SPYAPI/SimulationPlayerAPI",o)});