define("DS/TerminologySelector/service/TerminologyWebService",["DS/IPClassifyActive/service/IPClassifyActiveWebService","text!DS/TerminologySelector/assets/Terminology_setting.json","DS/WidgetServices/WidgetServices","text!DS/TerminologySelector/assets/config/webservices.conf.json"],function(e,t,n,o){"use strict";var i=JSON.parse(o);const s=["VPMInstance","VPMReference"];var r=null;function a(){return new Promise(function(e,t){n.get3DSearchUrlAsync({onComplete:function(t){e(t)},onFailure:function(e){t(e)}})})}var l=Object.assign({},e);return l.attachTerminology=function(e){var t={};UWA.extend(t,e);var n=e.csrfValue,o=e.spaceUrl,s=e.attachTerm?i.attachTerm:i.attachTerminology,r=o+s.replace(new RegExp("{ID}","g"),e.terminologyID);return t.method="PATCH",t.headers={Accept:"application/json","content-type":"application/json","Accept-Language":widget.lang?widget.lang:widget.getValue("lang"),SecurityContext:this.getSecurityContext(),ENO_CSRF_TOKEN:n},t.type="json",t.payload=[],e.itemsID.forEach(function(n){var i={identifier:n,relativePath:"/resources/v1/modeler/dseng/dseng:EngItem/"+n,type:e.isInstance?"VPMInstance":"VPMReference",source:o};t.payload.push(i)}),t.data=UWA.Json.encode(t.payload),this._executeRequest(r,t,"attachTerminologies")},l.attachTerminologies=function(e){var t=this;return UWA.extend({},e),t.get3DSpaceUrl().then(function(n){return new Promise(function(o,i){var s=n;t.createCSRFTokens({onComplete:function(n){var i=JSON.parse(n).csrf.value;e.onComplete=e.onComplete||function(){},e.onFailure=e.onFailure||function(){};var r={csrfValue:i,spaceUrl:s,terminologyID:"",itemsID:e.itemsID,isInstance:e.isInstance},a=[];e.terminologiesId&&e.terminologiesId.forEach(function(n,o){r.terminologyID=n,r.attachTerm=!1,a.push(new Promise(function(n,o){r.onComplete=function(t){e.onComplete.call(this,t),n(t)},r.onFailure=function(t){e.onFailure.call(this,t),o({error:t,id:r.terminologyID})},t.attachTerminology(r)}))}),e.termsId&&e.termsId.forEach(function(n,o){r.terminologyID=n,r.attachTerm=!0,a.push(new Promise(function(n,o){r.onComplete=function(t){e.onComplete.call(this,t),n(t)},r.onFailure=function(t){e.onFailure.call(this,t),o({error:t,id:r.terminologyID})},t.attachTerminology(r)}))}),o(Promise.allSettled(a))},onFailure:function(e){i(e)}},s)})})},l.detachTerminology=function(e){var t={};UWA.extend(t,e);var n=e.csrfValue,o=e.spaceUrl,s=e.detachTerm?i.detachTerm:i.detachTerminology,r=o+s.replace(new RegExp("{ID}","g"),e.terminologyID);return t.method="PATCH",t.headers={Accept:"application/json","content-type":"application/json","Accept-Language":widget.lang?widget.lang:widget.getValue("lang"),SecurityContext:this.getSecurityContext(),ENO_CSRF_TOKEN:n},t.type="json",t.payload=[],e.itemsID.forEach(function(n){var i={identifier:n,relativePath:"/resources/v1/modeler/dseng/dseng:EngItem/"+n,type:e.isInstance?"VPMInstance":"VPMReference",source:o};t.payload.push(i)}),t.data=UWA.Json.encode(t.payload),this._executeRequest(r,t,"detachTerminologies")},l.detachTerminologies=function(e){var t=this;return UWA.extend({},e),t.get3DSpaceUrl().then(function(n){return new Promise(function(o,i){var s=n;t.createCSRFTokens({onComplete:function(n){var i=JSON.parse(n).csrf.value;e.onComplete=e.onComplete||function(){},e.onFailure=e.onFailure||function(){};var r={csrfValue:i,spaceUrl:s,terminologyID:"",itemsID:e.itemsID,isInstance:e.isInstance},a=[];e.terminologiesId&&e.terminologiesId.forEach(function(n,o){r.terminologyID=n,r.detachTerm=!1,a.push(new Promise(function(n,o){r.onComplete=function(t){e.onComplete.call(this,t),n(t)},r.onFailure=function(t){e.onFailure.call(this,t),o({error:t,id:r.terminologyID})},t.detachTerminology(r)}))}),e.termsId&&e.termsId.forEach(function(n,o){r.terminologyID=n,r.detachTerm=!0,a.push(new Promise(function(n,o){r.onComplete=function(t){e.onComplete.call(this,t),n(t)},r.onFailure=function(t){e.onFailure.call(this,t),o({error:t,id:r.terminologyID})},t.detachTerminology(r)}))}),o(Promise.allSettled(a))},onFailure:function(e){i(e)}},s)})})},l.getAssociatedTerminologies=function(e){var t=this,n={};UWA.extend(n,e);var o=e.isInstance;return t.get3DSpaceUrl().then(function(s){var r=s;t.createCSRFTokens({onComplete:function(s){var a=JSON.parse(s).csrf.value,l=o?i.locateTerm:i.locateTerminology,c=r+l;n.method="POST",n.headers={Accept:"application/json","content-type":"application/json","Accept-Language":widget.lang?widget.lang:widget.getValue("lang"),SecurityContext:t.getSecurityContext(),ENO_CSRF_TOKEN:a},n.type="json",n.payload=[],e.itemsID.forEach(function(t){var o={identifier:t,relativePath:"/resources/v1/modeler/dseng/dseng:EngItem/"+t,type:e.isInstance?"VPMInstance":"VPMReference",source:r};n.payload.push(o)}),n.data=UWA.Json.encode(n.payload);t._executeRequest(c,n,"getAssociatedTerminologies")},onFailure:function(e){}},r)})},l.getSearchQuery=function(){return'type: "Terminology" AND [ds6w:status]: "Terminology.Released"'},l.getType_filter_bo=function(){return["Terminology","Term"]},l.generateSearchQuery=function(e,t){return'((type: "Terminology" AND [ds6w:status]: "Terminology.Released" ) OR type: "Term") AND (label: *'+e+"*)"+(t?' AND NOT physicalid: "'+t+'"':"")},l.getLabel=function(e){return"ActiveTerminology-"+(window.top.dsUserLogin?window.top.dsUserLogin:"unknown")+"-"+(new Date).getTime()},l.getSpecific_source_parameter=function(e,t){return{"3dspace":{search_in_context:{expand:{root_physicalid:e,expand_iter:t?"-1":"1",type_filter_bo:["Term","Terminology"]}}}}},l.generateLabelQuery=function(e){return'(type: "Terminology" OR type: "Term") AND (physicalid:'+e+")"},l.getSetting=function(){return JSON.parse(t)},l.fetchObjectsForFindInTree=function(e){var t=[];if(t.push(a()),this.getSecurityContext()||t.push(this.initSecurityContext()),!UWA.is(e,"object"))throw new Error("Invalid inputs for TerminologyWebService.fetchObjectsForFindInTree");var n=this,o={};UWA.extend(o,e),Promise.allSettled(t).then(function(t){var i=t[0].value+"/search",s=widget.lang?widget.lang:widget.getValue("lang");o.payload={},o.payload.locale=s,e.searchFTSquery&&(o.payload.query="[ds6w:label]:(*"+e.searchFTSquery+"*)"),e.rscIdToSearch&&(o.payload.query="physicalid:"+e.rscIdToSearch),o.payload.select_bo=["physicalid","ds6w:type","ds6w:globalType","ds6w:label"],"TermSection_All"===e.type?o.payload.specific_source_parameter={"3dspace":{search_in_context:{expand:{root_path_physicalid:e.pid,type_filter_bo:["Terminology","Term"]}}}}:o.payload.specific_source_parameter={"3dspace":{search_in_context:{expand:{root_physicalid:e.pid,type_filter_bo:["Terminology","Term"]}}}},o.payload.nresults=100,o.payload.source=["3dspace"],o.payload.login={"3dspace":{SecurityContext:n._securityContext}};var r=new Date,a=window.top.dsUserLogin?window.top.dsUserLogin:"unknown";return o.payload.label=("TerminologyFetchObjectsForFindInTree_"+a+"_"+r.getTime()).replace(new RegExp(" ","g"),"_").replace(new RegExp(",","g"),"").replace(new RegExp("/","g"),"-"),o.timeout=12e4,o.method="POST",o.payload.tenant=n.getTenantID(),o.headers={Accept:"application/json","content-type":"application/json","Accept-Language":s,SecurityContext:n.getSecurityContext()},o.type="json",o.data=UWA.Json.encode(o.payload),n._executeRequest(i,o,"_fetchObjectsForFindInTree")})},l.createCSRFTokens=function(e,t){var n=e,o=t+"/resources/v1/application/CSRF";n.method="GET",this._executeRequest(o,n,"TerminologyAssociation-createCSRFToken")},l.searchTerminologies=function(e){var t={};if(UWA.extend(t,e),!UWA.is(t,"object"))throw new Error("Invalid inputs for TerminologyWebService.searchTerminologies");var n=e.searchTerms?'type: "Term" AND [ds6w:status]: "Term.Released" ':'type: "Terminology" AND [ds6w:status]: "Terminology.Released"',o=this;a().then(function(i){var s=i+"/search",r=widget.lang?widget.lang:widget.getValue("lang");t.payload={with_nls:!1,with_indexing_date:!0,select_predicate:["ds6w:label","ds6w:created","ds6w:reservedBy","relcount","taxonomies","ds6w:classification","icon_2ddefaultthb.subtype","mxid"],select_file:["icon","thumbnail_2d"],order_field:"ds6w:label",order_by:"asc",nresults:100},t.payload.locale=r,t.payload.query=n,t.payload.tenant=o.getTenantID(),t.payload.next_start=void 0,t.payload.start=void 0,t.payload.source=["3dspace"],t.payload.login={"3dspace":{SecurityContext:o.getSecurityContext()}},t.payload.label=o.getLabel(),null!=e.next_start?t.payload.next_start=e.next_start:t.payload.start=0,t.method="POST",t.headers={Accept:"application/json","content-type":"application/json","Accept-Language":r},t.type="json",t.data=UWA.Json.encode(t.payload),t.withoutSC=!0,t.timeout=12e4,o._executeRequest(s,t,"searchTerminologies")})},l.expandV2Terms=function(e){var t={};UWA.extend(t,e);var n=this;return n.get3DSpaceUrl().then(function(o){var s=o+i.expandV2,r=widget.lang?widget.lang:widget.getValue("lang");t.payload={batch:{expands:[]},outputs:{format:"entity_relation",hits:{predefined_computation:["icons"]},select_object:["physicalid","ds6w:label","ds6w:type"],select_relation:["physicalid"]}};var a=[];e.physicalIds.forEach(function(e){var t={label:"terminology-expandv2-"+e,root:{physical_id:e},filter:{and:{filters:[{prefix_filter:{prefix_path:[{physical_id_path:[e]}]}},{and:{filters:[{sequence_filter:{sequence:[{uql:'(taxonomies:"types/Term" OR taxonomies:"types/Terminology") AND [ds6w:status]: "Terminology.Released"'}]}}]}}]}},graph:{descending_condition_object:{uql:'(taxonomies:"types/Term") OR (taxonomies:"types/Terminology")'}}};a.push(t)}),t.payload.batch.expands=a,t.method="POST",t.headers={Accept:"application/json","content-type":"application/json","Accept-Language":r,SecurityContext:n.getSecurityContext(),SecurityToken:window.top.dsUserLogin+"|"+n.getSecurityContext()+"|preferred"},t.type="json",t.data=UWA.Json.encode(t.payload),n._executeRequest(s,t,"expandV2Terminologies")})},l.getTypeInfo=function(e){var t,n=this,o=n.get3DSpaceUrl().then(function(o){var s=o,r={};UWA.extend(r,e);var a=s+i.getTypeInfo;return r.method="POST",r.headers={Accept:"application/json","content-type":"application/json"},r.type="json",r.payload=e.types.slice(),r.data=UWA.Json.encode(r.payload),t=n._executeRequest(a,r,"getTypeInfo")});return o.cancel=function(){t&&t.cancel()},o},l.getSubTypesVPMRefInst=function(e){var t,n,o=this,i=new Promise(function(e,i){if(n=i,r)e(r);else{var a={};a.types=s,a.onComplete=function(t){r=Object.keys(t),e(r)},a.onFailure=function(){i()},t=o.getTypeInfo(a)}});return i.cancel=function(){t&&t.cancel(),n({error:"cancel"})},i},l}),define("DS/TerminologySelector/commands/TerminologyCtxMenuCommands",["i18n!DS/TerminologySelector/assets/nls/TerminologySelector","DS/WidgetServices/WidgetServices","DS/WebappsUtils/WebappsUtils"],function(e,t,n){"use strict";return{ExpandAllCmd:function(e,t){e.plmType;var n=[];"TREE"===t&&e&&n.push(e),n.length&&n.forEach(function(e){null===e.options.children||"TREE"!==t&&"Folder"!==e.plmType&&"TermSection_All"!==e.plmType||e.expand({expandLevel:"All"})})},CollapseAllCmd:function(e,t){e.plmType;var n=[];"TREE"===t&&e&&n.push(e),n.length&&n.forEach(function(e){e.collapseAll(),e.removeChildren()})},_addCtxCmd:function(e,t,n,o){var i=!1;!1!==n.spaceAvailability&&(i=!0),i&&(o&&("separator"!==o.type||t.length>0)&&t.push(o),t.push(n))},GetContextualMenuForTerminology:function(t,o){var i,s=this,r=[],a=!!t.white_Click&&t.white_Click;void 0===(i=!0===a?i=Folder_CSO.getCurrentFolder():t.nodeModel)&&(i=t);var l={label:e.CMDExpandAll,icon:"url("+n.getWebappsAssetUrl("IPClassifyNav","icons/32/I_ExpandAll.png")+")",callback:function(){s.ExpandAllCmd(i,o)},searchAvailability:!0},c={label:e.CMDCollapseAll,icon:"url("+n.getWebappsAssetUrl("IPClassifyNav","icons/32/I_CollapseAll.png")+")",callback:function(){s.CollapseAllCmd(i,o)},searchAvailability:!0};return this._addCtxCmd(o,r,l,{type:"separator"}),this._addCtxCmd(o,r,c),r}}}),define("DS/TerminologySelector/utils/TerminologyUtil",["DS/Notifications/NotificationsManagerUXMessages","DS/Notifications/NotificationsManagerViewOnScreen"],function(e,t){var n=e;t.setNotificationManager(n);return{searchNodesById:function(e,t){return e.search({match:function(e){if(t&&e.nodeModel.getID&&e.nodeModel.getID()&&-1!==e.nodeModel.getID().indexOf(t))return!0}})},getTerminologyParent:function(e){if(!e)return null;var t=e.getParent();return t&&"RootFolder"===t.getType()?t:this.getTerminologyParent(t)},compareArray:function(e,t){return e.length===t.length&&e.every(function(e){return t.includes(e)})}}}),define("DS/TerminologySelector/commands/AssociateTermsCommand",["UWA/Core","DS/ApplicationFrame/Command","DS/TerminologySelector/utils/TerminologyUtil","DS/TerminologySelector/service/TerminologyWebService","DS/Controls/Loader","DS/Controls/ModalContainer","DS/IPClassifyUtil/IPClassifyAlert","i18n!DS/TerminologySelector/assets/nls/TerminologySelector"],function(e,t,n,o,i,s,r,a){"use strict";return t.extend({labelTopBar:e.i18n("AssociateTermsCommand"),isInsert:!0,datas:{},init:function(e){this._parent(e,{mode:"exclusive",isAsynchronous:!1})},beginExecute:function(){},execute:function(){console.log("COMMAND AssociateTermsCommand");require(["DS/TerminologySelector/TerminologyAssociation/TerminologyAssociation","DS/PADUtils/PADContext"],function(e,t){var n=t.get().getSelectedNodes();if(console.log("selected nodes",n),n&&n.length>0&&n.length<=20){var l,c=new i({showButtonFlag:!0});c.on(a.loading),c.elements.stopButton.addEventListener("buttonclick",function(e){console.log("button cancel"),l.cancel()}),s.createModal(widget.body,c.elements.container),(l=o.getSubTypesVPMRefInst()).then(function(t){c.off(),s.removeModal(widget.body);var o=[];if(n&&n.length&&n.forEach(function(e){console.log("node : ",e.getLabel(),e.getID(),e.options.relationtype),e.getRelationID&&e.getRelationID()&&e.options.relationtype&&t.includes(e.options.relationtype)?e.getRelationID()&&o.push({id:e.getRelationID()}):o=null}),o&&o.length>0)new e({items:o,isInstance:!0});else r.displayNotification({message:a.error_command_selection,className:"error"})}).catch(function(e){c.off(),s.removeModal(widget.body),e&&"cancel"==e.error||r.displayNotification({message:a.error_run_command,className:"error"})})}else r.displayNotification({message:a.error_command_selection,className:"error"})})},endExecute:function(){}})}),define("DS/TerminologySelector/commands/TerminologyManagementCommand",["UWA/Core","DS/ApplicationFrame/Command","DS/TerminologySelector/utils/TerminologyUtil","DS/TerminologySelector/service/TerminologyWebService","DS/Controls/Loader","DS/Controls/ModalContainer","DS/IPClassifyUtil/IPClassifyAlert","i18n!DS/TerminologySelector/assets/nls/TerminologySelector"],function(e,t,n,o,i,s,r,a){"use strict";return t.extend({labelTopBar:e.i18n("TerminologyManagement"),isInsert:!0,datas:{},init:function(e){this._parent(e,{mode:"exclusive",isAsynchronous:!1})},beginExecute:function(){},execute:function(){console.log("COMMAND TerminologyManagement");require(["DS/TerminologySelector/TerminologyManagement/TerminologyManagement","DS/PADUtils/PADContext"],function(e,t){var n=t.get().getSelectedNodes();if(console.log("selected nodes",n),n&&n.length>0&&n.length<=20){var l,c=new i({showButtonFlag:!0});c.on(a.loading),c.elements.stopButton.addEventListener("buttonclick",function(e){console.log("button cancel"),l.cancel()}),s.createModal(widget.body,c.elements.container),(l=o.getSubTypesVPMRefInst()).then(function(t){c.off(),s.removeModal(widget.body);var o=[],i=[];if(n&&n.length&&n.forEach(function(e){if(console.log("node : ",e.getLabel(),e.getID(),e.options.type),!(e.options.type&&t.includes(e.options.type)||e.options.relationtype&&t.includes(e.options.relationtype)))return o=null,void(i=null);e.getID()&&o.push({id:e.getID(),label:e.getLabel()}),e.getRelationID()&&i.push({id:e.getRelationID()})}),o&&o.length>0||i&&i.length>0)new e({container:document.body,references:o,instances:i});else r.displayNotification({message:a.error_command_selection,className:"error"})}).catch(function(e){c.off(),s.removeModal(widget.body),e&&"cancel"==e.error||r.displayNotification({message:a.error_run_command,className:"error"})})}else r.displayNotification({message:a.error_command_selection,className:"error"})})},endExecute:function(){}})}),define("DS/TerminologySelector/commands/AssociateTerminologiesCommand",["UWA/Core","DS/ApplicationFrame/Command","DS/TerminologySelector/utils/TerminologyUtil","DS/TerminologySelector/service/TerminologyWebService","DS/Controls/Loader","DS/Controls/ModalContainer","DS/IPClassifyUtil/IPClassifyAlert","i18n!DS/TerminologySelector/assets/nls/TerminologySelector"],function(e,t,n,o,i,s,r,a){"use strict";return t.extend({labelTopBar:e.i18n("AssociateTerminologies"),isInsert:!0,datas:{},init:function(e){this._parent(e,{mode:"exclusive",isAsynchronous:!1})},beginExecute:function(){},execute:function(){console.log("COMMAND AssociateTerminologies");require(["DS/TerminologySelector/TerminologyAssociation/TerminologyAssociation","DS/PADUtils/PADContext"],function(e,t){var n=t.get().getSelectedNodes();if(console.log("selected nodes",n),n&&n.length>0&&n.length<=20){var l,c=new i({showButtonFlag:!0});c.on(a.loading),c.elements.stopButton.addEventListener("buttonclick",function(e){console.log("button cancel"),l.cancel()}),s.createModal(widget.body,c.elements.container),(l=o.getSubTypesVPMRefInst()).then(function(t){c.off(),s.removeModal(widget.body);var o=[];if(n&&n.length&&n.forEach(function(e){console.log("node : ",e.getLabel(),e.getID(),e.options.type),e.getID()&&e.options.type&&t.includes(e.options.type)?e.getID()&&o.push({id:e.getID(),label:e.getLabel()}):o=null}),o&&o.length>0)new e({items:o,isInstance:!1});else r.displayNotification({message:a.error_command_selection,className:"error"})}).catch(function(e){c.off(),s.removeModal(widget.body),e&&"cancel"==e.error||r.displayNotification({message:a.error_run_command,className:"error"})})}else r.displayNotification({message:a.error_command_selection,className:"error"})})},endExecute:function(){}})}),define("DS/TerminologySelector/TerminologyAssociation/TerminologyAssociation",["DS/IPClassifyActive/IPClassifyActive","DS/TerminologySelector/service/TerminologyWebService","DS/TerminologySelector/utils/TerminologyUtil","DS/IPClassifyUtil/IPClassifyAlert","i18n!DS/TerminologySelector/assets/nls/TerminologySelector","DS/WebappsUtils/WebappsUtils","DS/TerminologySelector/commands/TerminologyCtxMenuCommands","DS/Controls/Loader","DS/Controls/ModalContainer","DS/Controls/TooltipModel","text!DS/TerminologySelector/assets/Terminology_setting.json"],function(e,t,n,o,i,s,r,a,l,c,u){var m={iconName:"browsing-structure-root",fontIconFamily:1},d={iconName:"browsing-structure-node",fontIconFamily:1};return e.extend({name:"TerminologyAssociation",_rootNodeFavorite:null,_rootNodeFolders:null,_rootNodeTrash:null,_requestInfo:{},_searchKeys:{},_pathInfo:{},_subBookmarkExpand:{},_favoriteSection:null,_allSection:"TermSection_All",_findInTreeNLS:i,init:function(e){var s=this;this.items=e.items,this.isInstance=e.isInstance||!1,this.deactivateAssociate=e.deactivateAssociate||!1,this.alreadySelected=e.alreadySelected||null,this.mapRelationParentTerms=e.mapRelationParentTerms||null,e.dataProvider={},e.selectionMode="DefaultMulti",e.authoring=!1,e.dialogButtons=!0,e.favoriteButton=!1,e.multiSelectionComponent={withClassify:!1,launchDialog:!0,NLS:i.multiSelectionComponent},e.popOverDialogProperties={modalFlag:!0},e.multiSelectionComponent.NLS.widget_name=s.isInstance?i.widget_name_associate_terms:i.widget_name_associate_terminologies,e.dataProvider.widgetDataProvider={getWidgetIcon:function(){return"browsing-structure-root-add-to"},getSettings:function(){return JSON.parse(u)}},this._parent(e),this._rootNodeFavorite.hide(),this.nestedMenuInContext.popover.elements.container.addClassName("TerminologyAssociation"),this.nestedMenuInContext.nestedMenu._modelEvents.subscribeOnce({event:"onPostExpand:TermSection_All"},function(){s.initSelection()}),this.nestedMenuInContext._modelEvents.subscribe({event:"IPActive/NodeSelection/OnChange"},function(){var e=s.nestedMenuInContext.nestedMenu?s.nestedMenuInContext.nestedMenu._treeView:null,t=e?e.getTreeDocument():null;if(s.nestedMenuInContext._classifyButton.tooltipInfos=null,t){var o=[],r=[];if(t.getSelectedNodes().length<1)s.disableButtonAssociate(i.tooltip_selection_empty);else if(s.alreadySelected&&s.alreadySelected.length>0){n.compareArray(s.alreadySelected,t.getSelectedNodes().map(e=>e.getID()))&&s.disableButtonAssociate(i.tooltip_selection_no_changes)}t.getSelectedNodes().forEach(function(e){if(s.isInstance&&"Folder"!==e.getType()||!s.isInstance&&"RootFolder"!==e.getType())s.disableButtonAssociate(i.tooltip_selection_rows_invalid);else if("Folder"===e.getType()&&!(o.indexOf(e.id)>-1)){o.push(e.id);var t=n.getTerminologyParent(e);t&&(r.indexOf(t.id)>-1||r.push(t.id))}})}}),this.nestedMenuInContext.addEvent("select",function(e){var t=s.nestedMenuInContext.nestedMenu?s.nestedMenuInContext.nestedMenu._treeView:null,o=t?t.getTreeDocument():null;if("Folder"===e.getType()){var i=n.getTerminologyParent(e);i&&o.getSelectedNodes().forEach(function(t){if("Folder"===t.getType()&&t.id!==e.id){var o=n.getTerminologyParent(t);o&&o.id===i.id&&t.unselect()}})}}),this.nestedMenuInContext.addEvent("onClassifyMultiple",function(e){var r=s.nestedMenuInContext.nestedMenu?s.nestedMenuInContext.nestedMenu._treeView:null,c=r?r.getTreeDocument():null,u=s.nestedMenuInContext?s.nestedMenuInContext.getMultiSelectorContainer().getParent():null,m=new a;m.on(i.loading),l.createModal(u,m.elements.container);var d=[],g=[],p={};e.chosenClasses.forEach(function(e,t){n.searchNodesById(c,e).forEach(function(e,t){"RootFolder"!==e.getType()||g.indexOf(e.id)>-1?"Folder"!==e.getType()||d.indexOf(e.id)>-1||(d.push(e.id),p[e.id]=e.getLabel()):(g.push(e.id),p[e.id]=e.getLabel())})});var f=s.items.map(function(e){return e.label}).filter(function(e){return e}),y=s.items.map(function(e){return e.id});s.dispatchEvent("associateTerminology",{terminologiesID:g,termsID:d}),s.deactivateAssociate?(m.off(),l.removeModal(u),s.nestedMenuInContext._classifyButton&&s.nestedMenuInContext.popover.close()):t.attachTerminologies({terminologiesId:g,termsId:d,itemsID:y,isInstance:s.isInstance,onComplete:function(e){var t="";t=this.isInstance?y.length>1?i.success_association_instances_term:i.success_association_instance_term:y.length>1?i.success_association_references_terminology:i.success_association_reference_terminology,t=i.replace(t,{items:f.length>0?f:"",terminology:p[this.terminologyID]}),o.displayNotification({title:i.association_success,message:t,className:"success"})},onFailure:function(e){var t="";t=this.isInstance?y.length>1?i.error_association_instances_term:i.error_association_instance_term:y.length>1?i.error_association_references_terminology:i.error_association_reference_terminology,t=i.replace(t,{items:f.length>0?f:"",terminology:p[this.terminologyID]}),o.displayNotification({title:i.association_error,message:t,className:"error"})}}).then(function(e){m.off(),l.removeModal(u),e.filter(function(e){return"rejected"===e.status}).length<1&&s.nestedMenuInContext._classifyButton&&s.nestedMenuInContext.popover.close()}).catch(function(){m.off(),l.removeModal(u),o.displayNotification({title:i.association_error,message:i.error_association_service,className:"error"})})}),this.nestedMenuInContext.addEvent("onSelectorCancel",function(e){Object.getPrototypeOf(s.nestedMenuInContext.nestedMenu)._expandedNodes=[],s.nestedMenuInContext.destroy()})},_getWebServiceRef:function(){return t},_getPlmType:function(e){return"Terminology"===e?"RootFolder":"Term"===e?"Folder":void 0},_getRootIcon:function(){return s.getWebappsAssetUrl("TerminologySelector","icons/22/Browsing_Structure_22.png")},_getFavoritesIcon:function(){return null},_getRootName:function(){return i.name_Section_AllFolders},_getFavoritesName:function(){return null},_getActiveIcon:function(e){return this.isInstance?s.getWebappsAssetUrl("TerminologySelector","icons/22/Browsing_Node_22.png"):s.getWebappsAssetUrl("TerminologySelector","icons/22/Browsing_Structure_22.png")},_getFocusBtnTooltip:function(){return i.terminology_btn_focus},_showMessageWhileEmpty:function(e){return e?i.terminology_msg_empty:i.terminology_msg_noterminology},_getIcon:function(e,t){var n;return"Terminology"===e.type||"RootFolder"===e.type?n=m:"Term"!==e.type&&"Folder"!==e.type||(n=d),n},couldBeExpand:function(e){return!0},couldBeValid:function(e,t,n,o){var i=!1,s=t.getSelectedNodes().length;if(t&&s>0){if(0==n&&s>1)return!1;i=0==o?!t.getRoots()[0].isSelected():1==o?!t.getRoots()[1].isSelected():!t.getRoots()[0].isSelected()&&!t.getRoots()[1].isSelected()}return i},couldBeSelected:function(e){return!0},getFavoriteKey:function(){return null},_getContextualMenu:function(e,t){return r.GetContextualMenuForTerminology(e,t)},initSelection:function(){var e=this.nestedMenuInContext.nestedMenu?this.nestedMenuInContext.nestedMenu._treeView:null,t=e?e.getTreeDocument():null,o=this;t&&o.alreadySelected&&o.alreadySelected.length>0&&o.alreadySelected.forEach(function(e){if(o.isInstance&&o.mapRelationParentTerms){var i=o.mapRelationParentTerms[e]?o.mapRelationParentTerms[e].parent:null;o.nestedMenuInContext.nestedMenu._modelEvents.subscribeOnce({event:"onPostExpand:"+i},function(){n.searchNodesById(t,e).forEach(function(e){e.select()})}),function e(i){if(i){var s=o.mapRelationParentTerms[i]?o.mapRelationParentTerms[i].parent:null;if(s)o.nestedMenuInContext.nestedMenu._modelEvents.subscribeOnce({event:"onPostExpand:"+s},function(){var e=n.searchNodesById(t,i);e.forEach(function(e){e.expand()})}),e(s);else{var r=n.searchNodesById(t,i);r.forEach(function(e){e.expand()})}}}(i)}else{n.searchNodesById(t,e).forEach(function(e,t){e.select()})}})},disableButtonAssociate:function(e){this.nestedMenuInContext._classifyButton&&(this.nestedMenuInContext._classifyButton.disabled=!0),e&&(this.nestedMenuInContext._classifyButton.tooltipInfos=new c({shortHelp:e}))}})}),define("DS/TerminologySelector/TerminologyManagement/TerminologyManagement",["UWA/Controls/Abstract","UWA/Class/Options","UWA/Class/Events","DS/WUXAutoComplete/AutoComplete","DS/Tree/TreeDocument","DS/Tree/TreeNodeModel","DS/Controls/Button","DS/Windows/ImmersiveFrame","DS/Windows/Dialog","DS/Controls/Loader","DS/Controls/ModalContainer","DS/IPClassifyUtil/IPClassifyAlert","DS/TerminologySelector/service/TerminologyWebService","DS/TerminologySelector/utils/TerminologyUtil","DS/TerminologySelector/TerminologyAssociation/TerminologyAssociation","i18n!DS/TerminologySelector/assets/nls/TerminologySelector","css!DS/TerminologySelector/TerminologySelector.css"],function(e,t,n,o,i,s,r,a,l,c,u,m,d,g,p,f){const y="term",h="terminology";var T={iconName:"browsing-structure-root",fontIconFamily:1},v={iconName:"browsing-structure-node",fontIconFamily:1};return e.extend(t,n,{name:"TerminologyManagement",init:function(e){this.instances=e.instances,this.references=e.references,this.initialSelectedTerms=[],this.initialSelectedTerminologies=[],this.autocompleteTerminologies=null,this.autocompleteTerms=null,this.mapNameIDTerminologies={},this.mapRelationParentTerms={};var t=[this.getAssociatedTerminologies(),this.getAssociatedTerms(),this.getTerminologies()];this.initialPromise=Promise.all(t),this.container=UWA.createElement("div",{class:"terminologyManagement-container"}),this.createModal(e.container,f.terminology_management,this.container),this.loader=new c,this.loader.on(f.loading),u.createModal(this.container.getParent(),this.loader.elements.container),this.createContentTerminologyManagement().inject(this.container)},createAutocompleteComponent:function(e,t,n,i){var s=UWA.createElement("div",{class:"terminologyManagement-autocomplete-container"}),a=(UWA.createElement("div",{class:"terminologyManagement-autocomplete-label",html:"<label>"+e+"</label>"}).inject(s),UWA.createElement("div",{class:"terminologyManagement-autocomplete-line"}).inject(s)),l=UWA.createElement("div",{class:"terminologyManagement-autocomplete"}).inject(a),c=UWA.createElement("div",{class:"terminologyManagement-button-browse"}).inject(a),u=new o({elementsTree:t,allowFreeInputFlag:!1,class:"test"}).inject(l);return new r({displayStyle:"lite",label:"Browse",onClick:i,icon:{iconName:"open-in-a-new-window",fontIconFamily:1},showLabelFlag:!1}).inject(c),s.inject(n),u},setPossibleDatasAutocomplete:function(e,t){e.elementsTree=t},setValuesAutocomplete:function(e,t){e.value=t},createContentTerminologyManagement:function(){var e=this,t=UWA.createElement("div",{class:"terminologyManagement-autocompletes-container"});function n(e,t){return e.map(function(e){return{label:e.label,value:e.id,icon:t?v:T}})}return this.initialPromise.then(function(o){var r=o[0],a=o[1],l=o[2].terminologies,c=o[2].terms,m=o[2].relationsTerms;r&&l&&(e.autocompleteTerminologies=e.createAutocompleteComponent(f.associated_terminologies_reference,[],t,e.browseAssociations.bind(e,e.references,!1)),e.setPossibleDatasAutocomplete(e.autocompleteTerminologies,n(l)),e.displayAssociateTerminologies(r)),a&&c&&(e.autocompleteTerms=e.createAutocompleteComponent(f.associated_terms_instance,[],t,e.browseAssociations.bind(e,e.instances,!0)),e.autocompleteTerms.addEventListener("change",function(){e.autocompleteTerms.selectedItems&&e.autocompleteTerms.selectedItems.length>0&&e.autocompleteTerms.selectedItems.forEach(function(e){e.options.type===h&&e.unselect()})}),l&&m?e.setPossibleDatasAutocomplete(e.autocompleteTerms,function(e,t,n){var o=new i,r={};return o.prepareUpdate(),t.forEach(function(e){var t=a(e.label,e.id,T,h);o.addRoot(t),r[e.id]=t}),e.forEach(function(e){var t=a(e.label,e.id,v,y);r[e.id]=t}),n.forEach(function(e){var t=r[e.parent],n=r[e.child];t&&n&&t.addChild(n)}),o.getRoots().forEach(function(e,t){e.sortChildren({isRecursive:!0,sortFunction:function(e,t){return e.options.label.localeCompare(t.options.label)>=1?1:-1}})}),o.expandAll(),o.pushUpdate(),o;function a(e,t,n,o){var i=new s({label:e,value:t,icon:n,type:o});return i}}(c,l,m)):e.setPossibleDatasAutocomplete(e.autocompleteTerms,n(c,!0)),e.displayAssociateTerms(a)),e.loader.off(),u.removeModal(e.container.getParent())}),t},createModal:function(e,t,n){var o=new a({});that=this,this.dialog=new l({immersiveFrame:o,title:t,content:n,activeFlag:!1,height:"auto",minHeight:50,width:500,modalFlag:!0,domId:"terminologyManagementDialog",buttons:{Cancel:new r({onClick:function(e){that.dialog.close()}}),Save:new r({onClick:that.saveAssociations.bind(that)})}}),o.inject(e)},browseAssociations:function(e,t,n){var o=this,i=null;o.autocompleteTerms&&t?i=o.autocompleteTerms.value||[]:!t&&o.autocompleteTerminologies&&(i=o.autocompleteTerminologies.value||[]),new p({items:e,isInstance:t,deactivateAssociate:!0,alreadySelected:i,mapRelationParentTerms:t?o.mapRelationParentTerms:null}).addEvent("associateTerminology",function(e){o.autocompleteTerminologies&&!t&&o.setValuesAutocomplete(o.autocompleteTerminologies,e.terminologiesID),o.autocompleteTerms&&t&&o.setValuesAutocomplete(o.autocompleteTerms,e.termsID)})},saveAssociations:function(){var e=this,t=e.container.getParent(),n=new c;n.on(f.loading),u.createModal(t,n.elements.container);var o=[],i=[],s=[],r=[];if(e.autocompleteTerminologies){var a=e.autocompleteTerminologies.value||[];o=g(e.initialSelectedTerminologies,a),s=p(e.initialSelectedTerminologies,a)}if(e.autocompleteTerms){var l=e.autocompleteTerms.value||[];i=g(e.initialSelectedTerms,l),r=p(e.initialSelectedTerms,l)}function g(e,t){return y(e,t)}function p(e,t){return y(t,e)}function y(e,t){var n=[];return e.forEach(function(e){t.includes(e)||n.push(e)}),n}var h=[],T=s.length>0?d.attachTerminologies({terminologiesId:s,itemsID:e.references.map(function(e){return e.id}),isInstance:!1}):Promise.resolve(null),v=r.length>0?d.attachTerminologies({termsId:r,itemsID:e.instances.map(function(e){return e.id}),isInstance:!0}):Promise.resolve(null),S=o.length>0?d.detachTerminologies({terminologiesId:o,itemsID:e.references.map(function(e){return e.id}),isInstance:!1}):Promise.resolve(null),_=i.length>0?d.detachTerminologies({termsId:i,itemsID:e.instances.map(function(e){return e.id}),isInstance:!0}):Promise.resolve(null);h.push(T,v,S,_),Promise.all(h).then(function(o){var i=o[0],s=o[1],r=o[2],a=o[3],l=!0;(i||r)&&(l=e.displayReponseAssociations(i,r)),(s||a)&&e.displayReponseAssociations(s,a,!0),l&&l?e.dialog.close():((i||r)&&e.updateAssociatedTerminologies(),(s||a)&&e.updateAssociatedTerms()),n.off(),u.removeModal(t)}).catch(function(e){n.off(),u.removeModal(t),m.displayNotification({title:f.association_error,message:f.error_association_service,className:"error"})})},displayReponseAssociations:function(e,t,n){var o=this;function i(e){if(e&&null!=e.length){var t=[],n=[];return e.forEach(function(e){var i=e.status,s=null;"fulfilled"===i?(s=e.value.member[0],t.push({id:s.id,label:o.mapNameIDTerminologies[s.id]})):"rejected"===i&&(s=e.reason,n.push({id:s.id,label:o.mapNameIDTerminologies[s.id]}))}),{successID:t,errorID:n}}return null}var s=i(e),r=i(t);if(s||r){var a="",l="",c="",u="";return n?(a=f.title_association_success_terms,l=f.title_association_error_terms):(a=f.title_association_success_terminologies,l=f.title_association_error_terminologies),s&&(s.successID.length>0&&(c+=n?f.association_success_terms:f.association_success_terminologies,c+="\n",c=f.replace(c,{terminologies:s.successID.map(function(e){return e.label})})),s.errorID.length>0&&(u+=n?f.association_error_terms:f.association_error_terminologies,u+="\n",u=f.replace(u,{terminologies:s.errorID.map(function(e){return e.label})}))),r&&(r.successID.length>0&&(c+=n?f.detach_success_terms:f.detach_success_terminologies,c=f.replace(c,{terminologies:r.successID.map(function(e){return e.label})})),r.errorID.length>0&&(u+=n?f.detach_error_terms:f.detach_error_terminologies,u=f.replace(u,{terminologies:r.errorID.map(function(e){return e.label})}))),c&&m.displayNotification({title:a,message:c,className:"success"}),!u||(m.displayNotification({title:l,message:u,className:"error"}),!1)}},getAssociatedTerminologies:function(){var e=this;if(e.references&&e.references.length>0)return new Promise(function(t,n){d.getAssociatedTerminologies({itemsID:e.references.map(function(e){return e.id}),isInstance:!1,onComplete:function(n){var o=n?e.getResultIntersectionOfTerminologies(n,!1):[];e.initialSelectedTerminologies=o,t(o)},onFailure:function(e){t([])}})});Promise.resolve(null)},getAssociatedTerms:function(){var e=this;if(e.instances&&e.instances.length>0)return new Promise(function(t,n){d.getAssociatedTerminologies({itemsID:e.instances.map(function(e){return e.id}),isInstance:!0,onComplete:function(n){var o=n?e.getResultIntersectionOfTerminologies(n,!0):[];e.initialSelectedTerms=o,t(o)},onFailure:function(e){t([])}})});Promise.resolve(null)},displayAssociateTerminologies:function(e){this.setValuesAutocomplete(this.autocompleteTerminologies,e)},displayAssociateTerms:function(e){this.setValuesAutocomplete(this.autocompleteTerms,e)},updateAssociatedTerminologies:function(){this.getAssociatedTerminologies().then(function(e){e&&that.displayAssociateTerminologies(e)})},updateAssociatedTerms:function(){this.getAssociatedTerms().then(function(e){e&&that.displayAssociateTerms(e)})},getResultIntersectionOfTerminologies:function(e,t){t=t||!1;var n=e.member,o=[];if(n&&n.length>1)o=n.map(function(e){var n=t?e.browsingNodes:e.browsingStructures;return n&&n.member&&n.member.length>0?n.member.map(function(e){return e.identifier}):[]}).reduce(function(e,t){return e.filter(function(e){return t.includes(e)})});else if(n&&1===n.length){var i=t?n[0].browsingNodes:n[0].browsingStructures;i&&i.member&&i.member.length>0&&(o=i.member.map(function(e){return e.identifier}))}return o.slice()},addmapNameIDTerminologies:function(e){var t=this;e&&e.length>0&&e.forEach(function(e){t.mapNameIDTerminologies[e.id]=e.label})},getTerminologies:function(){var e=this;return this.references&&this.references.length>0?new Promise(function(t,n){d.searchTerminologies({searchTerms:!1,onComplete:function(n){var o=n.results,i=e.parseDataSearch(o);e.addmapNameIDTerminologies(i);var s={};s.terminologies=i||[],e.instances&&e.instances.length>0?d.expandV2Terms({physicalIds:i.map(function(e){return e.id}),onComplete:function(n){var o=e.parseDataExpandV2(n)||{};UWA.extend(o,s),o.terminologies=i||[],e.addmapNameIDTerminologies(o.terms),t(o)},onFailure:function(e){}}):t(s)},onFailure:function(e){}})}):Promise.resolve(null)},parseDataExpandV2:function(e){var t=e.results,n=[],o=[],i=this;return t&&t.length>0?(t.forEach(function(e){e.from&&e.to?o.push({parent:e.from,child:e.to}):"Term"===e["ds6w:type"]&&n.push({label:e["ds6w:label"],id:e.resourceid,icon:e.icon})}),o&&o.length>0&&o.forEach(function(e){i.mapRelationParentTerms[e.child]={id:e.child,parent:e.parent}}),{terms:n,relationsTerms:o}):null},parseDataSearch:function(e){var t=[];return e&&e.length>0&&e.forEach(function(e){var n=e.attributes,o={};n.forEach(function(e,t){"resourceid"===e.name&&(o.id=e.value),"ds6w:label"===e.name&&(o.label=e.value),"type_icon_url"===e.name&&(o.icon=e.value)}),t.push(o)}),t}})});