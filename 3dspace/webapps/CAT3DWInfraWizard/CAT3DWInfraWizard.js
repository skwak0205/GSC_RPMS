define("DS/CAT3DWInfraWizard/CAT3DWTimeline",["UWA/Controls/Abstract","DS/CAT3DWInfra/CAT3DWPreferenceManager"],function(t,e){"use strict";return t.extend({init:function(t){this._parent(t),this._items=t.items||[],this._stepNum=t.step||1,this._noHomeButton=t.noHomeButton||0,this._3DButton=t.button3d||0,this._onClickCB=t.onClickCB,this._buildSkeleton()},_buildSkeleton:function(){this.elements.container=new UWA.Element("div",{class:e.getPreferenceValue("MobileMode")?"CATLS-Timeline CATLS-MobileMode":"CATLS-Timeline"}),this._computeContent()},_computeContent:function(){for(var t=[],e=0;e<this._items.length;e++){var i=e+1,n="disable";i===this._stepNum?n="current":i<this._stepNum&&(n="past"),t.push(this._createItem(i,this._items[e],n,this._items.length))}var s=new UWA.Element("div",{class:"bar-container"});this._noHomeButton||new UWA.Element("div",{html:" ",class:"CAT3DW-TimelineButton CAT3DW-TimelineHome fonticon fonticon-home-alt",events:{click:function(t){this._onClickCB&&this._onClickCB("Home")}.bind(this)}}).inject(s),this._3DButton&&new UWA.Element("div",{html:" ",class:"CAT3DW-TimelineButton CAT3DW-Timeline3D fonticon fonticon-compass-3d",events:{click:function(t){this._onClickCB&&this._onClickCB("3D")}.bind(this)}}).inject(s),new UWA.Element("ul",{html:t}).inject(s),this.elements.container.setContent(s)},_createItem:function(t,e,i,n){if(n>1)var s=[{tag:"div",class:"past"!=i?"number":"fonticon fonticon-check number",html:"past"!=i?t+"":""},{tag:"div",class:"text",html:e}];else s=[{tag:"div",class:"text",html:e}];e.extra&&s.push(e.extra);var o={tag:"li",html:s};return"current"===i?o.class="current":"past"===i&&(o.class="past",o.events={click:function(e){this._onClickCB&&this._onClickCB(t)}.bind(this)}),o},setActive:function(t){t>=1&&t<=this._items.length&&(this._stepNum=t,this._computeContent())},setClickCB:function(t){this._onClickCB=t},setHomeButton:function(t){this._noHomeButton=!t}})}),define("DS/CAT3DWInfraWizard/CAT3DWWizardController",["DS/ApplicationFrame/FrameWindowsManager","DS/Visualization/Node3D","DS/CoreEvents/Events"],function(t,e,i){"use strict";var n=UWA.Class.extend({init:function(i){this._image=i?i.image:null,this._rootWizardNode=null,this._onEndCB=i?i.endCB:void 0,this.perspectiveController=i?i.perspectiveController:void 0,this._steps=[],this._step=0,this._outData={},this._data={},i&&"object"==typeof i.data&&(this._data=i.data),this._frameWindow=t.getFrameWindow(),this._viewpoint=this._frameWindow.getViewpoint();var n=this._frameWindow.getViewer().getRootNode();this._rootWizardNode=new e("boxWizard"),n.addChild(this._rootWizardNode),this.frame3D.setViewerToImageSize(this.perspectiveController.getImage()),this.setSteps(i.steps),this.run()},run:function(t){i.publish({event:"CAT3DWStartWizard",data:{}});var e=t?this._getStepIdFromServiceId(t):0;this.setStep(e),this.runStep()},exit:function(){this.reset(),this._onEndCB&&this._onEndCB(this._image,this._outData),this.frame3D.applyDefaultSketchViewpointSettings(),this._image=null,this._outData={}},cancel:function(){this.reset(),this._onEndCB&&this._onEndCB(this._image,this._outData),this._image=null,this._outData={}},reset:function(){this._rootWizardNode.removeChildren(),this._rootWizardNode.remove(),this._rootWizardNode=null,this._steps=[],this.onRunStep=null,this._data={},i.unsubscribe(this._clearToken)},getRootWizardNode:function(){return this._rootWizardNode},setStep:function(t){return this._step=t,this._step},setSteps:function(t){if(!t)return!1;for(var e=[],i=null,n=0;n<t.length;n++)t[n].initialize(this,this._afterStepCB.bind(this)),this._steps.push(t[n]),i=this._steps[n].getId(),e.push(i);return this.setData("stepsIds",e),this._steps},getSteps:function(){return this._steps},getStepsIds:function(){for(var t=[],e=null,i=0;i<this._steps.length;i++)e=this._steps[i].getId(),t.push(e);return t},runStep:function(t){var e=null;if(t){var i=this._getStepIdFromServiceId(t);i>=0?(this._step=i,e=this._steps[i]):this.exit()}else this._step<this._steps.length?e=this._steps[this._step]:this.exit();e&&(this.onRunStep&&this.onRunStep(e),this.currentStep=e,e.setImage(this._image),e.run())},getImage:function(){return this._image},setData:function(t,e){return this._data[t]=e,this._data[t]},getData:function(t){return this._data[t]},setOutData:function(t,e){return this._outData[t]=e,this._outData[t]},getOutData:function(t){return this._outData[t]},setOnRunStep:function(t){this.onRunStep=t},_getStepIdFromServiceId:function(t){if("exitWizard"==t)return-1;for(var e=0;e<this._steps.length;e++)if(this._steps[e].getId()==t)return e;return-1},_afterStepCB:function(t,e){this.setData("lastStepId",this._steps[this._step].getId()),e||this._step++,this._image=t,this.runStep(e)}});return UWA.namespace("DS/CAT3DWInfraWizard/CAT3DWWizardController",n)}),define("DS/CAT3DWInfraWizard/CAT3DWSidePanelController",["UWA/Core","UWA/Element","UWA/Controls/Abstract","UWA/Json","DS/CoreEvents/Events","DS/Core/PointerEvents","DS/Controls/Button","DS/Controls/Accordeon","DS/Controls/Popup","DS/Panels/SidePanel","WebappsUtils/WebappsUtils","DS/CAT3DWInfra/CAT3DWPreferenceManager","text!DS/CAT3DWInfraWizard/assets/sidePanelContent.json"],function(t,e,i,n,s,o,a,l,r,h,d,c,u){"use strict";var m=i.extend({sidePanel:null,accordeonDiv:null,panelAccordeon:null,panelState:null,init:function(t){this._parent(t)},createSidePanel:function(t){this.sidePanel&&(this.sidePanel.destroy(),this.sidePanel=null),this.sidePanel=new h({side:"right",title:{html:'<i class= "wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-lightbulb " ></i>  Tips'}});var e=this;this.tipsButton=new a({label:"",icon:{iconClasses:"wux-ui-3ds wux-ui-3ds-2x wux-ui-3ds-lightbulb"},displayStyle:"icon",onClick:function(t){e.sidePanel.slideIn(),e.setPanelState("SLIDEIN"),e.tipsButton.hide()},allowUnsafeHTMLLabel:!1}).inject(this.sidePanel.elements.container);var i={"pointer-events":"all",position:"fixed",top:"50%",bottom:"50%",right:"20px",color:"#5b5d5e",opacity:.8,background:"white"};this.tipsButton.elements.button.setStyles(i),this.tipsButton.elements.button.addEvent("mouseenter",function(t){this.tipsButton.elements.button.setStyles({color:"#005686",opacity:1})}.bind(this)),this.tipsButton.elements.button.addEvent("mouseleave",function(t){this.tipsButton.elements.button.setStyles(i)}.bind(this)),this._setPanelStyle(t),this.sidePanel.elements.lateralHandle.hide(),this.sidePanel.slideOut(),this._browseJSON();var n=this.getPanelState();this.slideSidePanel(n),this._token=[],this._token.push(s.subscribe({event:"ChangeSidePanelContent"},this._updateContentCB.bind(this),!1)),this._token.push(s.subscribe({event:"UpdatePanelSteps"},this._updateStepsCB.bind(this),!1)),this._token.push(s.subscribe({event:"UpdatePanelImage"},this._updateImageCB.bind(this),!1));var o={" height":this.sidePanel.elements.panel.getBoundingClientRect().height-this.sidePanel.elements.title.getBoundingClientRect().height};return this.sidePanel.elements.content.setStyles(o),this.sidePanel},slideSidePanel:function(t){"SLIDEOUT"==t?(this.sidePanel.slideOut(),this.tipsButton.show()):"SLIDEIN"==t&&(this.sidePanel.slideIn(),this.tipsButton.hide())},setPanelState:function(t){this._browseJSON();var e=n.decode(this._currentPath);e[0].panelState=t,this._currentPath=n.encode(e),localStorage.setItem(this._settingsURL,this._currentPath)},getPanelState:function(){var t=n.decode(this._currentPath);return this._panelState=n.path(t[0],"$.panelState")[0],this._panelState},_setPanelStyle:function(e,i){if(this.sidePanel){this.sidePanel.elements.title.setStyles({background:"white",color:"#5b5d5e",fontSize:20,border:"0px",marginTop:"50px",marginBottom:"20px",display:"flex","justify-content":"space-between",position:"sticky",width:"100%","z-index":10,top:0}),this.contentWidth=220,this.imageHeight=180;this.sidePanel.elements.panel.setStyles({"pointer-events":"all","overflow-y":"auto",marginTop:"50px",marginRight:"0px",background:"white",position:"fixed"});var n=new a({label:"",icon:{iconClasses:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-open-right"},emphasize:"secondary",type:"check",displayStyle:"flyout",onClick:function(t){h.sidePanel.slideOut(),h.setPanelState("SLIDEOUT"),h.tipsButton.show()},allowUnsafeHTMLLabel:!1}).inject(this.sidePanel.elements.title);n.elements.container.setStyles({right:"20px",color:"#B4B6BA",fontSize:25,background:"transparent",border:"0px"}),n.elements.container.addEvent("mouseenter",function(t){n.elements.container.setStyles({color:"#5b5d5e"})}.bind(this)),n.elements.container.addEvent("mouseleave",function(t){n.elements.container.setStyles({color:"#B4B6BA"})}.bind(this)),i&&(this.titleDiv=new t.Element("div",{styles:{width:this.contentWidth+"px",color:"#5b5d5e",fontSize:16}}).inject(this.sidePanel.elements.content),new t.Element("hr").inject(this.sidePanel.elements.content));var s={"background-image":"url("+d.getWebappsAssetUrl("CAT3DWInfraWizard","graphics/VerticalSeparator.png")+")","background-position":" 0px 0px","background-repeat":"no-repeat"," height":"800px","padding-left":"12px"};if(this.sidePanel.elements.content.setStyles(s),this.imgContainer=new t.Element("div",{styles:{width:this.contentWidth+"px"}}).inject(this.sidePanel.elements.content),this.videoContainer=new t.Element("div",{styles:{width:this.contentWidth+"px"}}).inject(this.sidePanel.elements.content),new t.Element("hr").inject(this.sidePanel.elements.content),this.textDiv=new t.Element("div",{styles:{width:this.contentWidth+"px",color:"#5b5d5e",fontSize:14}}).inject(this.sidePanel.elements.content),e){new t.Element("hr").inject(this.sidePanel.elements.content);var o=new t.Element("div",{class:"wux-control-inline-container",style:{"vertical-align":"top"}});o.inject(this.sidePanel.elements.content);var l=new a({label:"OK",emphasize:"primary",onClick:function(t){WUX.AFR.CommandsManager.getCommand(WUX.AFR.CommandsManager._getCurrent()).end()},allowUnsafeHTMLLabel:!1}).inject(o),r=new a({label:"Cancel",onClick:function(t){WUX.AFR.CommandsManager.getCommand(WUX.AFR.CommandsManager._getCurrent()).cancel()},allowUnsafeHTMLLabel:!1}).inject(o);l.elements.container.setStyles({position:"fixed",right:"100px"});r.elements.container.setStyles({position:"fixed",right:"20px"})}new t.Element("div",{class:"wux-control-inline-container"}).inject(this.sidePanel.elements.content);var h=this}},_updateContentCB:function(e){if(this._jsonContent=this._getPanelContentByID(e),this.titleDiv){var i=d.getWebappsAssetUrl("CAT3DWInfraWizard",this._jsonContent.icon);this.titleDiv.setHTML("<p> <img src= "+i+"  />"+this._jsonContent.title+" </p>")}if(this.videoDiv&&this.videoDiv.destroy(),this.imgDiv&&this.imgDiv.destroy(),this._jsonContent.video){this.videoDiv=new t.Element("video",{autoplay:!0,loop:!0,controls:!0,crossOrigin:c.getPreferenceValue("CrossOrigin"),type:"video/mp4",styles:{height:this.imageHeight+"px",width:this.contentWidth+"px"}}).inject(this.videoContainer),this.videoDiv.src=d.getWebappsAssetUrl("CAT3DWInfraWizard",this._jsonContent.video[0]);var n=!0}else this._jsonContent.image&&(n||(this.imgDiv=new t.Element("img",{crossOrigin:c.getPreferenceValue("CrossOrigin"),styles:{"text-align":"center",height:this.imageHeight+"px",width:this.contentWidth+"px"}}).inject(this.imgContainer),this.imgDiv.src=d.getWebappsAssetUrl("CAT3DWInfraWizard",this._jsonContent.image[0])));this.textContentDiv&&(this.textContentDiv.destroy(),this.textContentDiv=null),this.textContentDiv=new t.Element("div",{}).inject(this.textDiv);var s=this._jsonContent.text;if(s){this.items=[];for(var o=0;o<s.length;o++)this.items[o]=new t.Element("div",{html:s[o]}),this.items[o].inject(this.textContentDiv)}this.iconTextContainer&&(this.iconTextContainer.destroy(),this.iconTextContainer=null),this.iconTextContainer=new t.Element("table",{}).inject(this.textDiv);var a=this._jsonContent.iconText;if(a){this.items=[];for(o=0;o<a.length;o++){i=d.getWebappsAssetUrl("CAT3DWInfraWizard",a[o].icon);var l=a[o].text;this.items[o]=new t.Element("tr",{html:"<th> <img class='bas' src= "+i+" height= '35' width= '35'/> </th> <td>"+l+"</td>"}),this.items[o].inject(this.iconTextContainer),new t.Element("br").inject(this.iconTextContainer)}}},_updateStepsCB:function(t){var e=t;if(e&&this.items){for(var i=0;i<this.items.length;i++)this.items[i].setStyles({color:"#5b5d5e",fontSize:15});var n=e-1,s=this.items.length-1;n=n>s?s:n,this.items[n].setStyles({color:"#5b5d5e",fontSize:15})}},_updateImageCB:function(t){if(t)if(this._jsonContent.video){var e=this._jsonContent.video[t-1];e&&(this.videoDiv.src=d.getWebappsAssetUrl("CAT3DWInfraWizard",e))}else if(this._jsonContent.image){var i=this._jsonContent.image[t-1];i&&(this.imgDiv.src=d.getWebappsAssetUrl("CAT3DWInfraWizard",i))}},_browseJSON:function(){var e=JSON.parse(u),i=n.path(e,"$");this._currentPath=t.Json.encode(i)},_getPanelContentByID:function(t){var e=n.decode(this._currentPath);return{icon:n.path(e[0],'$.sections[?(@.id=="'+t+'")].icon')[0],title:n.path(e[0],'$.sections[?(@.id=="'+t+'")].title')[0],image:n.path(e[0],'$.sections[?(@.id=="'+t+'")].image')[0],video:n.path(e[0],'$.sections[?(@.id=="'+t+'")].video')[0],text:n.path(e[0],'$.sections[?(@.id=="'+t+'")].text')[0],iconText:n.path(e[0],'$.sections[?(@.id=="'+t+'")].iconText')[0]}},hide:function(){this.sidePanel&&this.sidePanel.hide()},show:function(){this.sidePanel&&this.sidePanel.show()},clear:function(){this.hide(),s.unsubscribe(this._token)}});return t.namespace("DS/CAT3DWInfraWizard/CAT3DWSidePanelController",m)}),define("DS/CAT3DWInfraWizard/CAT3DWTimelineController",["UWA/Controls/Abstract","DS/CAT3DWInfraWizard/CAT3DWTimeline"],function(t,e){"use strict";return t.extend({init:function(t){this.options={},t&&(this.options=t,t.wizard&&(this.wizardController=t.wizard,this.wizardController.setOnRunStep(this.onChangeStep.bind(this))),t.timelineNodeElement?this.timelineNodeElement=t.timelineNodeElement:console.log("need timelineNodeElement"))},setStepTimeline:function(t,i){for(var n=[],s=0;s<t.length;s++)n.push(t[s].title);this.stepTimeline=t,this.options.items=n,this.options.onClickCB=this.onTimelineCB.bind(this),this.CAT3DWTimeline=new e(this.options),this.timelineNodeElement.setHTML(""),this.CAT3DWTimeline.elements.container.inject(this.timelineNodeElement,"top"),!1===i&&this.CAT3DWTimeline.setHomeButton(!1)},hideTimelineOnThisStep:function(t){this.stepHideTimeline=t},removeTimeline:function(){this.timelineNodeElement.setHTML(""),this.CAT3DWTimeline.destroy(),this.CAT3DWTimeline=null},onTimelineCB:function(t){if("Home"===t)this.wizardController._steps[this.wizardController._step].cancel(t);else if("3D"===t);else{var e=this.stepTimeline[t-1].linkStep.getId();this.wizardController._steps[this.wizardController._step].cancel(e)}},onChangeStep:function(t){for(var e=!1,i=0;i<this.stepTimeline.length;i++)if(this.stepTimeline[i].linkStep==t){this.CAT3DWTimeline.show(),this.CAT3DWTimeline.setActive(i+1),e=!0;break}if(!e&&this.stepHideTimeline)for(i=0;i<this.stepHideTimeline.length;i++)if(this.stepHideTimeline[i]==t){this.CAT3DWTimeline.hide();break}}})}),define("DS/CAT3DWInfraWizard/CAT3DWWizardStep",["UWA/Class","UWA/Core","DS/ApplicationFrame/FrameWindowsManager","DS/CAT3DWInfraWizard/CAT3DWSidePanelController","DS/CoreEvents/Events","DS/Controls/Loader","i18n!DS/CAT3DWInfraWizard/assets/nls/CAT3DWWizardStep","WebappsUtils/WebappsUtils"],function(t,e,i,n,s,o,a,l){"use strict";var r=t.extend({tipsContainer:null,init:function(t){this._ID=t?t.id:null,this._wizardController=t?t.wizardController:null,this._image=t?t.image:null,this._rootWizardNode=t?t.node:null,this._onEndCB=t?t.endCB:void 0,this._htmlNode=e.createElement("div",{}),this._htmlNode.addClassName("wizardContent"),this._title=t?t.title:null,this._titleContainer=null,this._spinner=null,this._menu=null,this._navigationButtons=null,this._validateBtn=null,this._validateBtnLabel=a.get("validateBtnLabel"),this._cancelBtn=null,this._cancelBtnLabel=a.get("cancelBtnLabel"),this._serviceToRun=null,this._eventTokens=[],this._frameWindow=i.getFrameWindow(),this._viewer=this._frameWindow.getViewer(),this._viewpoint=this._frameWindow.getViewpoint(),this._frame3D=t.frame3D},initialize:function(t,e){this._wizardController=t,this._rootWizardNode=this._wizardController.getRootWizardNode(),this._onEndCB=e,this._sidePanel=new n},run:function(){var t=document.getElementsByClassName("wizardNode")[0];this._htmlNode.inject(t),t.show(),this._createSpinner(),this._createMenu(),this._createButtons(),this._createFitAllButton(),this._ViewerResizeToken=this._viewer.onViewerResize(this.onViewerResize.bind(this)),this._eventTokens.push(this._ViewerResizeToken)},cancel:function(){this.reset()},validate:function(){this.showSpinner()},_exit:function(){this.reset(),this._onEndCB&&this._onEndCB(this._image,this._serviceToRun),this.setServiceToRun(null)},reset:function(){this._removeFitAllButton(),this._htmlNode.destroy(),this._rootWizardNode.removeChildren();for(var t=0;t<this._eventTokens.length;t++)s.unsubscribe(this._eventTokens[t]);this._eventTokens=[],this._viewer._modelEvent.unsubscribe(this._ViewerResizeToken)},_onValidateAction:function(){this._validateBtn.hasClassName("disabled")||this.validate()},runStep:function(t){this._menu.hasClassName("disabled")||(this.setServiceToRun(t),this._exit())},_onCancelAction:function(){this._cancelBtn.hasClassName("disabled")||this.cancel()},onViewerResize:function(t){this._updateFitAllButton(),this._frame3D.setViewerToImageSize(this._wizardController.perspectiveController.getImage())},_createTitle:function(){if(!this._title)return!1;this._titleContainer=new e.Element("h2",{text:this._title,class:"title"}).inject(this._htmlNode)},_updateTitle:function(t){t&&(this._titleContainer.textContent=t)},_createSpinner:function(){this._spinner=new e.Element("div",{class:"spinnerContainer"}).inject(this._htmlNode);var t=new o({});t.show(),t.inject(this._spinner),this.hideSpinner()},_createMenu:function(){this._menu=new e.Element("div",{class:"wizardMenu"}).inject(this._htmlNode),this._menu.hide()},_updateMenuPosition:function(t){var e=document.getElementsByClassName("Sketch-framewindow-content")[0].offsetLeft,i=document.getElementsByClassName("Sketch-framewindow-content")[0].offsetTop-this._htmlNode.getOffsetParent().offsetTop+document.getElementsByClassName("Sketch-framewindow-content")[0].offsetHeight/2-(t||this._menu.getSize()).height/2,n=e-70;n=n<10?10:n,this._menu.setStyles({left:n,top:i})},_createButtons:function(){this._navigationButtons=new e.Element("div",{class:"navigationButtons"}).inject(this._htmlNode),this._createValidateButton()},_createValidateButton:function(){this._validateBtn=new e.Element("div",{class:"blueButton smallButton",html:[{tag:"span",id:"ValidationButton",html:this._validateBtnLabel}],events:{click:this._onValidateAction.bind(this)}}).inject(this._navigationButtons),this._validateBtn.addClassName("smallButton")},_createCancelButton:function(){this._cancelBtn=new e.Element("div",{class:"grayButton smallButton",html:[{tag:"span",id:"CancelButton",html:this._cancelBtnLabel}],events:{click:this._onCancelAction.bind(this)}}).inject(this._navigationButtons),this._cancelBtn.addClassName("smallButton")},showSpinner:function(){this._spinner.show()},hideSpinner:function(){this._spinner.hide()},_showFitAllButton:function(){this._fitAllButton&&1!==this._frame3D.getZoom()&&this._fitAllButton.show()},_hideFitAllButton:function(){this._fitAllButton.hide()},_createFitAllButton:function(){this._fitAllButton=new e.Element("span",{class:"transformButton fitAllButton",events:{click:this._onFitAllClick.bind(this)},styles:{backgroundImage:"url("+l.getWebappsAssetUrl("CAT3DSKUI","icons/fitAll.png")+")",backgroundColor:"rgba(0, 0, 0, 0.1)"}}).inject(this._htmlNode),this._updateFitAllButton(),this._hideFitAllButton(),this._zoomInToken=s.subscribe({event:"showFitAllBtn"},this._showFitAllButton.bind(this),!1),this._zoomOutMaxToken=s.subscribe({event:"hideFitAllBtn"},this._hideFitAllButton.bind(this),!1)},_onFitAllClick:function(t){this._hideFitAllButton(),this._frame3D.resetZoom()},_updateFitAllButton:function(){if(this._fitAllButton){var t=document.getElementsByClassName("Sketch-framewindow-content")[0].offsetLeft,e=document.getElementsByClassName("Sketch-framewindow-content")[0].offsetTop;this._fitAllButton.setStyles({left:t+10,top:e})}},_removeFitAllButton:function(){this._fitAllButton&&(this._fitAllButton.destroy(),s.unsubscribe(this._zoomOutMaxToken),s.unsubscribe(this._zoomInToken))},getId:function(){return this._ID},setImage:function(t){return this._image=t,this._image},setData:function(t,e){return this._wizardController.setData(t,e),this._wizardController.getData(t)},getData:function(t){return this._wizardController.getData(t)},setOutData:function(t,e){return this._wizardController.setOutData(t,e),this._wizardController.getOutData(t)},getOutData:function(t){return this._wizardController.getOutData(t)},setServiceToRun:function(t){return this._serviceToRun=t,this._serviceToRun},getServiceToRun:function(){return this._serviceToRun},getStep:function(t){var e=this._wizardController._getStepIdFromServiceId(t);return this._wizardController._steps[e]}});return e.namespace("DS/CAT3DPhotoWebInfraWizard/CAT3DWWizardStep",r)});