define("DS/AppFrameGlobal/transition/TransitionDecision",[],function(){"use strict";var t=function(){};return t.prototype.execute=function(t,e){throw new Error("Not implemented")},t.extend=function(e){e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1}})},t}),define("DS/AppFrameGlobal/model/Container",[],function(){"use strict";function t(t,e){t.currentIndex=e}var e=function(t){this.id=t.id,this.contexts=t.contexts||[],this.currentIndex=void 0===t.currentIndex?-1:t.currentIndex};return e.prototype.getId=function(){return this.id},e.prototype.getContexts=function(){return this.contexts},e.prototype.getCurrentContext=function(){return this.currentIndex<0?null:this.contexts[this.currentIndex]},e.prototype.getCurrentApp=function(){var t=this.getCurrentContext();return t?t.getCurrentApp():null},e.prototype.addExecutionContext=function(e,n){this.contexts.push(e),n&&t(this,this.contexts.length-1)},e.prototype.setCurrentContextIndex=function(e){if(e>=this.contexts.length)throw new Error("The index "+e+"is out of bound > "+this.contexts.length);e<0&&(e=-1),t(this,e)},e.prototype.toString=function(){return"{\n\tid:"+this.id+",\n\t contexts :"+this.contexts+",\n\t currentIndex :"+this.currentIndex+"\n}"},e}),define("DS/AppFrameGlobal/model/FrameContext",[],function(){"use strict";function t(t,e){t.currentIndex=e}var e=function(t){this.containers=[],this.currentIndex=-1};return e.prototype.getContainers=function(){return this.containers},e.prototype.getCurrentContainer=function(){return this.currentIndex<0?null:this.containers[this.currentIndex]},e.prototype.getCurrentExecutionContext=function(){var t=this.getCurrentContainer();return t?t.getCurrentContext():null},e.prototype.getCurrentApp=function(){var t=this.getCurrentExecutionContext();return t?t.getCurrentApp():null},e.prototype.indexOfContainer=function(t){for(var e=this.getContainers(),n=0;n<e.length;n++){if(e[n].getId()==t)return n}return-1},e.prototype.addContainer=function(e,n){this.containers.push(e),n&&t(this,this.containers.length-1)},e.prototype.setCurrentContainerIndex=function(e){if(e>=this.containers.length)throw new Error("The index "+e+"is out of bound > "+this.containers.length);e<0&&(e=-1),t(this,e)},e.prototype.getContextOfApp=function(t){var e=this.getContainerOfApp(t);return e?e.getCurrentContext():null},e.prototype.getContainerOfApp=function(t){for(var e=this.containers,n=0;n<e.length;n++){var r=e[n],o=r.getCurrentApp();if(o&&o.getId()==t)return r}return null},e.prototype.forEachContext=function(t){if(t)for(var e=this.containers,n=0;n<e.length;n++)for(var r=e[n].getContexts(),o=0;o<r.length;o++){t(r[o])}},e.prototype.toString=function(){return"{\n\tcontainers :"+this.containers+",\n\t currentIndex :"+this.currentIndex+"\n}"},e});var AppFramemod_WafData="DS/WAFData/WAFData";define("DS/AppFrameGlobal/DelegateFrame",["UWA/Data",AppFramemod_WafData,"UWA/Class/Promise","DS/WebappsUtils/WebappsUtils"],function(t,e,n,r,o){"use strict";var i=function(){};return i.WAFData=e,i.prototype.requestJson=function(t){return new n(function(n,r){e.request(t,{type:"json",responseType:"json",onComplete:function(t){n(t)},onFailure:r})})},i.prototype.requestWebService=function(t){return new n(function(n,r){e.proxifiedRequest(t,{type:"json",responseType:"json",onComplete:function(t){n(t)},onFailure:r})})},i.prototype.loadIdCard=function(t,e){var r=t.getConfigUrl();if(r){if(r.endsWith(".json")){var o=this;return this.requestJson(r).then(function(t){if(t.afrService){var i="";if(t.afrServiceUrl&&""!==t.afrServiceUrl)i=t.afrServiceUrl;else{var a=(i=r).split(":");a.length>=2&&(i=a[0]+":"+a[1])}return t.afrServicePort&&(i+=":"+t.afrServicePort),t.appId=t.appId||t.afrAppId,i+="/"+t.afrService+t.appId,"string"==typeof e&&""!==e&&(i=i+"?lang="+e),o.requestWebService(i)}return n.resolve(t)})}return this.requestWebService(configUrl)}return"string"==typeof e&&""!==e||(e="en"),r=t.getUrl().replace(/[a-zA-Z]*\/[a-zA-Z]*.html/,"WebAfr/Applications/"+t.getId()+"_"+e+".json"),this.requestJson(r)},i.prototype.buildFrameContext=function(){throw this.options.success&&this.options.success(new FrameContext),new Error("This call must be implemented by sub class")},i.prototype.onTransitionSuccessful=function(t){throw new Error("This call must be implemented by sub class")},i.prototype.createContainer=function(t){throw log("Create container of apps ** To overrride"),errorCallback&&errorCallback.call(),new Error("This call must be implemented by sub class")},i.prototype.publish=function(t,e){throw new Error("This call must be implemented by sub class")},i.prototype.subscribe=function(t,e){throw new Error("This call must be implemented by sub class")},i.prototype.unsubscribe=function(t){throw new Error("This call must be implemented by sub class")},i.prototype.getCurrentLanguage=function(){return o&&o.getCurrentLanguage()},i}),define("DS/AppFrameGlobal/model/App",["UWA/Core"],function(t){"use strict";var e="AppFrameContainer/container.html",n=function(e){this.options={id:null,title:null,brand:null,url:null,configUrl:null},this.options=t.extend(t.clone(this.options),e)};return n.prototype.getId=function(){return this.options.id},n.prototype.getTitle=function(){return this.options.title},n.prototype.getBrand=function(){return this.options.brand},n.prototype.getUrl=function(){return this.options.url},n.prototype.getBaseUrl=function(){var t=this.options.url.indexOf(e);if(t||(t=this.options.url.indexOf("WAfrContainerAsWidget/container.html")),t)return this.options.url.substring(0,t)},n.prototype.getConfigUrl=function(){return this.options.configUrl},n.prototype.getAppConfig=function(){return this.options.appConfig},n.prototype.getFamily=function(){return this.options.appConfig&&this.options.appConfig.afrFamily},n.prototype.setAppConfig=function(e){this.options.appConfig=t.extend(this.options.appConfig||{},e)},n.prototype.getServiceInfo=function(){if(void 0===this._serviceInfo){var t=this.getUrl(),e=t.indexOf("?afrWebService");if(e>0){for(var n=t.substring(e+"?afrWebService".length,t.length).split("/"),r=null,o={protocol:"",host:"",port:"8080",service:null,appId:""},i=0;i<n.length;i++)2===(r=n[i].split(":")).length&&(o[r[0]]=r[1]);var a=o.service?o.service+"/wafr/apps/":"";o.protocol&&o.host&&(a=o.protocol+"://"+o.host+":"+o.port+"/"+a),this._serviceInfo={afrService:a,afrServicePort:o.port,appId:o.appId}}else this._serviceInfo=null}return this._serviceInfo},n.prototype.supportTransition=function(){return this.options.url.endsWith(e)||this.isNewInfra()},n.prototype.isNewInfra=function(){return this.options.url.indexOf("WAfrContainerAsWidget/container.html")>=0},n.prototype.toString=function(){return"{\n\tid:"+this.options.id+", \n\ttitle :"+this.options.title+"\n}"},n}),define("DS/AppFrameGlobal/model/ExecutionContext",[],function(){"use strict";var t=function(t,e){this.id=t,this.currentApp=e};return t.prototype.getId=function(){return this.id},t.prototype.getCurrentApp=function(){return this.currentApp},t.prototype.toString=function(){return"{\n\tid:"+this.id+",\n\t currentApp :"+this.currentApp+"\n}"},t}),define("DS/AppFrameGlobal/transition/CreateNewContainer",["DS/AppFrameGlobal/transition/TransitionDecision","UWA/Class/Promise"],function(t,e){"use strict";var n=function(t){this.containerId=t};return t.extend(n),n.prototype.getContainerId=function(){return this.containerId},n.prototype.execute=function(t){return e.reject(new Error("Transition is not possible"))},n}),define("DS/AppFrameGlobal/transition/ReuseContext",["UWA/Core","DS/AppFrameGlobal/transition/TransitionDecision"],function(t,e){"use strict";var n=function(t){this.options=t||{}};return e.extend(n),n.prototype.getContextId=function(){return this.contextId},n.prototype.execute=function(e,n){var r=this;return new t.Class.Promise(function(t,o){var i=r.options.contextId,a=n.getAppConfig();if(!i){if(r.options.of)i=e.frameContext.getContextOfApp(r.options.of).getId();if(!i){var s=e.frameContext.getCurrentExecutionContext();s||o(new Error("Cannot reuse the current context cause it do not exist ")),i=s.getId()}}i||o(new Error("The id of the current context is null ! "));var p=a;p.baseUrl=n.getBaseUrl(),p.brand=n.options.brand,e.delegateFrame.publish("onReuseContext."+i,p)})},n}),define("DS/AppFrameGlobal/transition/CreateNewContext",["DS/AppFrameGlobal/transition/TransitionDecision","DS/AppFrameGlobal/transition/CreateNewContainer"],function(t,e){"use strict";var n=function(t){this.options=t};return t.extend(n),n.prototype.getContainerId=function(){return this.containerId},n.prototype.execute=function(t,n){var r=null;if(this.options.of){var o=t.frameContext.getContainerOfApp(this.options.of);if(o){r=o.getId();n.getId();return t.delegateFrame.publish("onCreateContext."+r,n.getAppConfig()),UWAPromise.resolve()}}return e.prototype.execute.call(this,t,n)},n}),define("DS/AppFrameGlobal/transition/ErrorDecision",["DS/AppFrameGlobal/transition/TransitionDecision"],function(t){"use strict";var e=function(t){this.messageId=t};return t.extend(e),e.prototype.execute=function(t,e){return alert("Error during transition"),UWA.Class.Promise.reject()},e}),define("DS/AppFrameGlobal/AppFrame",["UWA/Core","UWA/Data","UWA/Class","UWA/Class/Promise","UWA/Utils","WebappsUtils/WebappsUtils","DS/AppFrameGlobal/model/App","DS/AppFrameGlobal/model/Container","DS/AppFrameGlobal/model/ExecutionContext","DS/AppFrameGlobal/model/FrameContext","DS/AppFrameGlobal/DelegateFrame","DS/AppFrameGlobal/transition/CreateNewContainer","DS/AppFrameGlobal/transition/CreateNewContext","DS/AppFrameGlobal/transition/ErrorDecision","DS/AppFrameGlobal/transition/ReuseContext"],function(t,e,n,r,o,i,a,s,p,u,l,c,f,d,m){"use strict";window.performance.mark=window.performance.mark||function(){},window.performance.measure=window.performance.measure||function(){};var g=window.location.href.indexOf("debug")>=0,h={log:function(t){g&&console.log("[Afr]"+t)},warn:function(t){g&&console.warn("[Afr]"+t)},severe:function(t){g&&console.error("[Afr]"+t)},inherit:function(t,e){t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1}})}};h.App=a,h.FrameContext=u,h.FrameContext.ExecutionContext=p,h.FrameContext.Container=s,h.DelegateFrame=l,h.TransitionDecision=Object.create(null),h.TransitionDecision.ErrorDecision=d,h.TransitionDecision.CreateNewContext=f,h.TransitionDecision.CreateNewContainer=c,h.TransitionDecision.ReuseContext=m;var C={type:"CreateNewContext"};function A(e,n){if(!e)throw new Error("Must define a transition");var r=e.type;if(!r)throw new Error("No defined a type");var o=h.TransitionDecision[r];if(!o)throw new Error("No type "+r+" do not exist");var i=t.clone(e);return delete i.type,new o(i)}var x=A(C),b=function(t){if(this.delegateFrame=t,!this.delegateFrame)throw new Error("Need to provide a delegate Frame");if(!(this.delegateFrame instanceof h.DelegateFrame))throw new Error("Not a valid delagate Frame");this._apps={},this.frameContext=null,this._currentTransition=!1};b.prototype.doTransition=function(e){if(this._currentTransition)return r.reject();if(!e)return r.reject();if(!e.supportTransition())return h.warn("The target app "+e+" do not support the Afr transition"),r.reject(new Error("The target app "+e+" do not support the Afr transition"));var n=this,o=e.getId();return o?(window.performance.mark("WAfrGlobalAppFrame_doTransition_"+o),n._currentTransition=!0,new r(function(i,a){var s=function(t){n.delegateFrame.unsubscribe("onAppReady."+o),n.delegateFrame.unsubscribe("onAppFail."+o),n._currentTransition=!1,window.performance.mark("WAfrGlobalAppFrame_doTransitionFailure_"+o),window.performance.measure("WAfrGlobalAppFrame_TotalTransition_Failure_"+o,"WAfrGlobalAppFrame_doTransition_"+o,"WAfrGlobalAppFrame_doTransitionFailure_"+o),a(t)},p=setTimeout(function(){s(new Error("Timeout reaches for a transition !"))},3e5),u=function(t){n._currentTransition&&(n.delegateFrame.unsubscribe("onAppReady."+o),n.delegateFrame.unsubscribe("onAppFail."+o),t.targetApp=e,n.delegateFrame.onTransitionSuccessful(t),n._currentTransition=!1,window.performance.mark("WAfrGlobalAppFrame_doTransitionSuccess_"+o),window.performance.measure("WAfrGlobalAppFrame_TotalTransition_"+o,"WAfrGlobalAppFrame_doTransition_"+o,"WAfrGlobalAppFrame_doTransitionSuccess_"+o),window.clearTimeout(p),i())},l=function(t){s(t),window.clearTimeout(p)},c="";t&&t.Widgets&&t.Widgets.instances&&Array.isArray(t.Widgets.instances)&&t.Widgets.instances.length>0?c=t.Widgets.instances[0].lang:console.error("cannot compute language"),r.all([n._loadAppIdCard(e,c),n.delegateFrame.buildFrameContext().then(function(t){n.frameContext=t;var r=null,o=n.frameContext.getContainers();if(1===o.length)n.frameContext.setCurrentContainerIndex(0);else if(o.length>1){var i=0,a=!1,s=!1;o.forEach(function(t){let e=t.getId();if("string"!=typeof e){let o=e.getView();!o||"maximized"!==o.type&&"fullscreen"!==o.type||(s=!0,e&&e.id&&0===e.id.lastIndexOf("preview")?(a=!0,r=t,n.frameContext.setCurrentContainerIndex(i)):a||(r=t,n.frameContext.setCurrentContainerIndex(i))),!a&&!s&&e.elements&&e.elements.module&&e.elements.module.classList&&e.elements.module.classList.contains("ifwe-focused")&&(r=t,n.frameContext.setCurrentContainerIndex(i))}i++})}if(r=r||n.frameContext.getCurrentContainer()){var p={appTitle:e.getTitle(),id:r.id&&r.id.id?r.id.id:""};n.delegateFrame.publish("displayAfrLoader",p)}return r})]).then(function(t){var r=t[0],i=t[1];n.delegateFrame.subscribe("onAppReady."+o,u),n.delegateFrame.subscribe("onAppFail."+o,s);var a=n._computeTransitionDecisionFrom(e,r,i);return a.constructor===h.TransitionDecision.CreateNewContext&&i&&n.delegateFrame.publish("hideAfrLoader"),a.execute(n,e)},l).then(function(){},l).catch(l)})):r.reject(new Error("The target app "+e+" do not have a valid id"))},b.prototype._loadAppIdCard=function(t,e){var n=this._apps[t.getId()];return n?(t.setAppConfig(n),r.resolve(n)):this.delegateFrame.loadIdCard(t,e)},b.prototype._computeTransitionDecisionFrom=function(t,e,n){e.appId=t.getId(),e.title=t.getTitle(),t.setAppConfig(e);var o=null,i=n?n.getCurrentApp():null;if(n&&!i)return r.reject(new Error("Found a current container but no compatible app, reject the transition"));if(h.log("Compute Transition From "+(i?i.getId():"None App")+" to "+t.getId()),!(o=i?this._computeTransitionDecisionBetween(i,t):this._computeNonAmbiguousTransition(t)))throw new Error("No found transition decision !");return o},b.prototype._computeTransitionDecisionBetween=function(t,e,n){var r=this._computeTransitionTypeBetween(t,e,n);return r?A(r,this.frameContext):null},b.prototype._computeTransitionTypeBetween=function(t,e,n){if(!e)return null;if(!t)return C;if(t.getId()===e.getId())return C;var r,o=e.getAppConfig().afrTransitionsFrom||{},i=t.getAppConfig().afrTransitionsTo;if(i){var a=i[e.getId()];if(void 0===a&&(r=e.getFamily())&&e.getAppConfig().afrTransitionsToFamily&&(a=e.getAppConfig().afrTransitionsToFamily[r]),void 0!==a&&!1===a)return h.warn("The app "+t+" refuse to transit to "+e),C}if(!o&&n)return null;if(!o)return C;var s=null;return r=t.getFamily(),s=o[t.getId()],r&&!s&&(s=e.getAppConfig().afrTransitionsFromFamily[r]),s||n||(s=o._default_)?s||null:(h.log("There is no default transition so create a new container"),C)},b.prototype._computeNonAmbiguousTransition=function(e){var n=e.getAppConfig().afrTransitionsFrom||{};if(!n)return x;var r=[],o=this;if(h.log("[AppFrame] Deduct transition to "+e.getAppConfig().appId),this.frameContext.forEachContext(function(n){if(n){var i=n.getCurrentApp();if(i){var a=o._computeTransitionTypeBetween(i,e,!0),s=t.clone(a);h.log("[AppFrame] Transition From "+i.getId()+" -> "+JSON.stringify(s||{})),s&&(r.push(s),s.of=i.getId())}}}),r.length>1)throw h.warn("[AppFrame] Ambiguous transition"),new Error("To Many apps to decide the correct transition");var i=null;if(r.length>0)i=r[0];else if(!(i=n._default_))return h.log("There is no default transition so create a new container"),x;return A(i,this.frameContext)};var F=n.extend({init:function(t){this._frame=new b(t)},doTransition:function(t){return this._frame.doTransition(t)}});return h.Frame=F,h}),window.performance.mark("AFR_AppFrameGlobal_AppFrame3DD"),define("DS/AppFrameGlobal/AppFrame3DD",["UWA/Core","UWA/Class","UWA/Class/Promise","DS/AppFrameGlobal/AppFrame","DS/PlatformAPI/PlatformAPI"],function(t,e,n,r,o){"use strict";var i=function(){};return r.inherit(i,r.DelegateFrame),i.prototype.getCurrentTabId=function(){window.performance.mark("AFR_AppFrameGlobal_AppFrame3DD_getCurrentTabId"),window.performance.measure("AppFrame3DD_getCurrentTabId","AFR_AppFrameGlobal_AppFrame3DD_getCurrentTabId"),r.log("AppFrame3DD::getCurrentTabId Enter");var e,n,o,i=void 0,a=(e=t.Widgets.instances||[]).length;for(r.log("AppFrame3DD::getCurrentTabId instance = "+a),n=0;n<a;n++)if(void 0!==(o=e[n]).data&&(r.log("AppFrame3DD::getCurrentTabId instance.data = "+JSON.stringify(o.data)),void 0!==o.data.module&&(r.log("AppFrame3DD::getCurrentTabId instance.data.module = "+JSON.stringify(o.data.module)),"DS/Dashboard/Layout/Dashboard"===o.data.module&&(r.log("AppFrame3DD::getCurrentTabId instance.data.module = DS/Dashboard/Layout/Dashboard = "),void 0!==o.layout&&void 0!==o.layout.selectedTab&&void 0!==o.layout.selectedTab.options)))){i=o.layout.selectedTab.options.id,r.log("AppFrame3DD::getCurrentTabId Id current Tab = "+o.layout.selectedTab.options.id);break}return r.log("AppFrame3DD::getCurrentTabId End oId = "+i),i},i.prototype.onTransitionSuccessful=function(){},i.prototype._createContainerFromWidget=function(t,e){var n=new r.FrameContext.Container({id:t}),o=e.afrExecutionContexts;if(o){for(var i=0;i<o.length;i++){var a=o[i],s=new r.App({id:e.afrAppId,appConfig:e}),p=new r.FrameContext.ExecutionContext(a.id,s);n.addExecutionContext(p)}var u=e.afrCurrentExecutionContextIdx;r.log("[AppFrame3DD] Widget "+t+" -> "+JSON.stringify(o)),n.setCurrentContextIndex(Math.max(o.length-1,u))}return n},i.prototype.buildFrameContext=function(){r.log("AppFrame3DD::buildFrameContext Start");for(var e,o,i,a,s,p=new r.FrameContext,u=this.getCurrentTabId(),l=t.Widgets.instances||[],c=0;c<l.length;c++){var f=l[c];e=f._view||{},f.getValue("appId")&&(0===f.id.lastIndexOf("preview")&&"maximized"===e.type?a=f.id:"maximized"===e.type&&(s=f.id))}return l.forEach(function(t){if(e=t._view||{},t.getValue("appId")&&(a?i=t.id===a:s&&(i=t.id===s),t.context===u||i&&void 0===t.context)){r.log("AppFrame3DD::buildFrameContext add container (widget) = "+t);var n={afrAppId:t.getValue("afrAppId"),afrCode:t.getValue("afrCode"),afrCurrentExecutionContextIdx:t.getValue("afrCurrentExecutionContextIdx"),afrExecutionContexts:t.getValue("afrExecutionContexts"),afrFamily:t.getValue("afrFamily"),afrTransitionsFrom:t.getValue("afrTransitionsFrom"),afrTransitionsFromFamily:t.getValue("afrTransitionsFromFamily"),afrTransitionsTo:t.getValue("afrTransitionsTo"),afrVersion:t.getValue("afrVersion")};o=this._createContainerFromWidget(t,n),p.addContainer(o),!p.getCurrentContainer()&&i&&p.setCurrentContainerIndex(p.containers.length-1)}}.bind(this)),r.log("AppFrame3DD::buildFrameContext End"),n.resolve(p)},i.prototype.createContainer=function(){return r.log("AppFrame3DD:createContainer"),n.reject()},i.prototype.publish=function(t,e){o.publish(t,e)},i.prototype.subscribe=function(t,e){o.subscribe(t,e)},i.prototype.unsubscribe=function(t){o.unsubscribe(t)},r.Frame.singleton({init:function(){this._parent(new i)},loadAppInfoAndDoTransition:function(t){window.performance.mark("AFR_AppFrameGlobal_AppFrame3DD_loadAppInfoAndDoTransition"),window.performance.measure("AppFrame3DD_loadAppInfoAndDoTransition","AFR_AppFrameGlobal_AppFrame3DD_loadAppInfoAndDoTransition"),r.log("ApplicationFrame:loadAppInfoAndDoTransition = "+JSON.stringify(t));var e=new r.App({url:t.launchInfos,id:t.id,title:t.title,configUrl:t.config,brand:t.brand});t.targetApp=e,r.log("ApplicationFrame:loadAppInfoAndDoTransition targetApp = "+JSON.stringify(e)),this.doTransition(t.targetApp).then(t.success,t.failure),r.log("ApplicationFrame:loadAppInfoAndDoTransition End doTransition")}})});