define("DS/XCTInfStreamReader/XCTXHRWithProxyAbstraction",["UWA/Core","DS/XCTInfUtilsWeb/XCTLogger"],function(e,t){"use strict";var r=function(){var o=function(e,t,r){var o=e.indexOf("/"),n=e.indexOf("/",o+2);return e.slice(0,o)+"//"+t+":"+r+e.slice(n,e.length)};this.executePostHttpRequest2=function(n,a,s,i,p){if(2===r.proxyUsage){t.log("gestion UWA");var c={timeout:1e5,method:"POST",data:s,type:"text",headers:{"Content-Type":a,Accept:"application/json"},onComplete:i,onFailure:function(){e.log("arguments onFailure"),e.log(arguments)}};null!==p.responseType&&(c.type=p.responseType),r.proxymode&&(c.proxy=r.proxymode),e.Data.request(n,c)}else{1===r.proxyUsage&&(n=o(n,r.server,r.sport));var l=new XMLHttpRequest;l.open("POST",n,!0),l.onload=function(){i(this.response)},(new FormData).append("data",s),l.setRequestHeader("Content-type",a),l.setRequestHeader("Accept","text/plain"),p.responseType&&(l.responseType=p.responseType),l.send(s)}},this.executeSyncPostHttpRequest=function(n,a,s){if(2===r.proxyUsage){var i;t.log("gestion UWA");var p={timeout:1e5,method:"POST",data:s,type:"text",async:!1,headers:{"Content-type":a,Accept:"text/plain"},onComplete:function(e){t.warn("retour >data",e),i=e},onFailure:function(){t.log("arguments onFailure"),t.log(arguments)}};return r.proxymode&&(p.proxy=r.proxymode),e.Data.request(n,p),i}1===r.proxyUsage&&(n=o(n,r.server,r.sport));var c=new XMLHttpRequest;return c.open("POST",n,!1),c.setRequestHeader("Content-type",a),c.setRequestHeader("Accept","text/plain"),c.send(s),c.responseText},this.transformUrlIntoRealUrl=function(n){return 2===r.proxyUsage?(t.log("gestion UWA"),e.Data.proxifyUrl(n,{proxy:"passport"})):1===r.proxyUsage?n=o(n,r.server,r.sport):n},this.syncTransformFCSUrlIntoRealUrl=function(e,t){var r=e.indexOf("v23"),o=e.slice(3,r),n=e.slice(r+3,e.length),a="application/xml";"boolean"==typeof t&&t&&(a="application/xmql");var s=this.executeSyncPostHttpRequest(o,a,n),i=/\{\{([^\}]*)\}\{([^\}]*)\}\}/.exec(s),p=i[1];return"posthttp:"+i[2]+":postparams:__fcs__jobTicket="+encodeURIComponent(p)}};return r.useNoProxy=function(){r.proxyUsage=0,r.server=null,r.sport=null},r.useProxyDefinedBy=function(e,t){r.proxyUsage=1,r.server=e,r.sport=t},r.useUWAProxy=function(e){r.proxyUsage=2,r.server=null,r.sport=null,r.proxymode=e},r}),define("DS/XCTInfStreamReader/XCTInfStreamReader",["UWA/Core","UWA/Class","UWA/Class/Promise","DS/WAFData/WAFData","DS/XCTInfStreamReader/XCTXHRWithProxyAbstraction","DS/XCTInfUtilsWeb/XCTLogger"],function(e,t,r,o,n,a){"use strict";return t.extend({getStreamDescriptors:function(e,t){var r="start transaction;\n";r+="temp query businessobject * * * ",r+='where "physicalid match %1" select physicalid attribute[StreamDescriptors];\n',r=(r+="abort transaction;").replace("%1",e.physicalid);var o=location.protocol+"//"+location.hostname+"/3DSpace/i3dx/services/xmql?raw=true";n.useUWAProxy("passport");var s=new n,i=s.transformUrlIntoRealUrl(o);s.executePostHttpRequest2(i,"application/xmql",r,function(r){for(var o=[],n=r.split("attribute[StreamDescriptors] =")[1].split(":"),s=0;s<n.length;s++){var i=n[s].trim(),p=(i=i.substring(5,i.length-1)).split(","),c=p[0],l=p[1],u=p[6];o.push({format:c,name:e.physicalid+"_"+l+"."+c+"="+u.substring(1,u.length-1)})}a.log(o),t(e,o)},{})},streamDescriptorToTicket:function(e,t,r){var o="start transaction ;\n";o+="get checkout ticket nozip mcsurl %1 \n",o+=" store %2 \n",o+="businessobjectproxy physicalid %3 format %4 filename %5 tcl;\n",o=(o=(o=(o=(o=(o+="abort transaction ;\n").replace("%1","1")).replace("%2","2")).replace("%3",e)).replace("%4",t.format)).replace("%5",t.name);var a=location.protocol+"//"+location.hostname+"/3DSpace/i3dx/services/xmql?raw=true";n.useUWAProxy("passport");var s=new n,i=s.transformUrlIntoRealUrl(a);s.executePostHttpRequest2(i,"application/xmql",o,function(e){var o=/\{\{([^\}]*)\}\{([^\}]*)\}\}/.exec(e),n=o[1],a=o[2]+"?__fcs__jobTicket="+encodeURIComponent(n)+"&jobTicket=__fcs__jobTicket&__fcs__attachment=true";r(t,a)},{})},handleTicket:function(t,r){var o={timeout:1e5,method:"GET",type:"blob",proxy:"passport",headers:{Accept:"application/octet-stream"},onComplete:function(e){r(e)},onFailure:function(){e.log("arguments onFailure"),e.log(arguments)}};e.Data.request(t,o)}})});