define("DS/DELPPWAuxiliaryModule/AuxiliaryModule",["UWA/Core"],function(e){"use strict";return{behaviors:["WUXNodeModelBehavior","UXFactoryBehavior","TreeListViewBehavior","ModelBehavior","LinkBehavior","ResourceBehavior","SearchBehavior","RefreshBehavior","ViewBehavior","TaggerBehavior","DuplicateAdvBehavior","LoadObjectBehavior","MfgProcessBehavior","RootsBehavior"],creator:function(n,t,i,o,a,r,d,s,l,c,g,u,f,h,A){var v,p,y,m,w=[],C=[],R=function(n){var t,i=function(n){var i=!1;return e.is(n)&&e.is(n.get,"function")&&(n.isConnection()?i=C.indexOf(n.get("type"))>-1:(t=a.getPPRType(n),i=w.indexOf(t)>-1)),i};return Array.isArray(n,"array")?n.every(function(e){return i(e)}):i(n)},I=function(){return w.indexOf("PROCESS")>-1},T=function(i){var o,r,d,s={forceDBMode:!0,silent:!0,onComplete:function(t){e.is(t)?a.createRefOrInst({isInstanceOf:t.get("PID")},d.get("PID")):n.debug("Child reference fetch failed")}};o=t.getSelectedNodes(),e.is(o,"array")&&e.is(i)&&(r=o[0].getID(),d=a.getReferenceModel(r),i.forEach(function(e){a.fetchRoot(e.id,s)}))},V=function(){var t=n.getId(),i=!1,o=n.getPreferenceValue("widgetLayoutValues");return e.is(o)&&(i=""!==e.Json.decode(o)[t]),i};return{listenTo:function(){return{addToAuxiliaryView:this.addToAuxiliaryView,addInstance:this.onAddInstance,removeConnection:this.onRemoveConnection,removeReference:this.onRemoveRefOrInst,removeInstance:this.onRemoveRefOrInst,addConnection:this.onAddConnection,changeReference:this.onChangeIRPC,addReference:this.onAddReference,searchAndAddInstance:this.onSearchAndAddInstance,InsertAsCopy:this.onInsertAsCopy,reparentInstances:this.onReparentInstances,reparentBegin:this.onReparentBegin,reparentEnd:this.onReparentEnd,toggleAuxPanel:this.onToggleAuxPanel,expandAll:this.onExpandAll,collapseAll:this.onCollapseAll,widgetLayoutChanged:this.onWidgetLayoutChanged}},onStart:function(a){var r,s=n.getElement(),l=s.getElementsByClassName("tree-list-container")[0],g=i.getComponent("WUXFrameWindowsManager").getFrameWindow(n.getAppContext()),u=e.is(widget.getValue("isMFNToggleAuxiliaryViewVisible"))?"MFN":"MGA",f=widget.getValue("isViewPersistanceOn");if(y=i.getComponent("WUXDockAreaEnum"),!e.is(a.pprTypes)||!e.is(a.linkTypes))throw new Error(n.getId()+": TreeListAuthoringModule initialization failed");w=a.pprTypes,C=a.linkTypes,v=e.is(a.displayBadge)?a.displayBadge:null,p=e.is(a.displayBadgePS)?a.displayBadgePS:null,m=i.create("Panel",{title:d.getNLSValue("View.AUXILIARY.Title"),identifier:"AuxiliaryPanel",minWidth:300,minHeight:250,height:250,width:300,immersiveFrame:g.getImmersiveFrame(),content:s,visibleFlag:!1,resizableFlag:!0,closeButtonFlag:!1,useBordersFlag:!0,collapsibleFlag:!1,verticallyStretchableFlag:!0}),o.loadDocument(t.getWUXNodeModel()),o.getContent().inject(l),c.registerViewforWidgetLayout({viewID:n.getId(),viewType:"treeListView",dockArea:y.LeftDockArea}),r=f?widget.getValue("is"+u+"ToggleAuxiliaryViewVisible"):V(),n.notify("toggleCmdCheckHeaderState",{cmdName:"ToggleAuxiliaryView",cmdState:r})},onStop:function(){e.is(m)&&(m.remove(),m=void 0),c.unregisterViewforWidgetLayout(n.getId(),"treeListView")},onAddReference:function(n){R(n)&&e.is(n.get("PID"))&&t.isNodeAdded(n.get("PID"))&&t.addNode(n,{silentMode:!0,withLinksResolved:!1})},onAddInstance:function(n){var i={silentMode:!0,withLinksResolved:!1},o=function(e){t.addNode(e,i)};e.is(n,"array")?t.withTransactionUpdate(function(){n.forEach(function(e){o(e)})}):o(n)},onAddConnection:function(n){var i=function(n){var i,o;R(n)&&(o=n.get("from"),i=n.get("type"),e.is(v)&&v.linkType===i?t.updateBadge(o,v.badgeIcon):e.is(p)&&p.linkType===i&&t.updateBadge(o,p.badgeIcon))};e.is(n,"array")?t.withTransactionUpdate(function(){n.forEach(function(e){i(e)})}):i(n)},onChangeIRPC:function(n){var i=function(e){R(e)&&t.updateAttributes(e)};e.is(n,"array")?t.withTransactionUpdate(function(){n.forEach(function(e){i(e)})}):i(n)},onRemoveRefOrInst:function(e){var n=[];e=Array.isArray(e)?e:[e],t.withTransactionUpdate(function(){e.forEach(function(e){n.push(e.get("PID"))}),n.length>0&&t.removeNodes(n)})},onRemoveConnection:function(i){var o=[],a=function(t){var i,a;R(t)&&(i=t.get("type"),e.is(i,"string")?(a=t.get("from"),(e.is(v)&&v.linkType===i||e.is(p)&&p.linkType===i)&&o.push(a)):n.debug("Could not get connection type"))};t.withTransactionUpdate(function(){e.is(i,"array")?i.forEach(function(e){a(e)}):a(i),o.length>0&&t.updateBadge(o,null)})},onToggleAuxPanel:function(e){var n,i,o;i=function(){m.visibleFlag||(m._getPositionFromPreferences()||(m.currentDockArea=y.LeftDockArea),m.show()),(n=m.immersiveFrame.getDockingElement(m.currentDockArea))&&(n.collapseDockingZoneFlag=!1)},o=function(){m.visibleFlag&&(m.hide(),t.unSelectAll())},!0===e.state?i():o()},onExpandAll:function(){var n=t.getSelectedNodes();e.is(n,"array")&&n.length>0&&t.expandNode(n)},onCollapseAll:function(){var n=t.getSelectedNodes();e.is(n,"array")&&n.length>0&&t.collapseNode(n)},onWidgetLayoutChanged:function(){var e,t,i=V();m.currentDockArea=y.LeftDockArea,m._saveDockAreaInPreferences(),e=m.currentDockArea,(t=m.immersiveFrame.getDockingElement(e)).getContainedVisibleWindows().length<=0&&(t.visibleDockingZoneFlag=!1),n.notify("toggleCmdCheckHeaderState",{cmdName:"ToggleAuxiliaryView",cmdState:i}),n.notify("AuxLayoutCommandsToggled")},onReparentInstances:function(e){t.reparent(e)},onReparentBegin:function(e){t.isNodeAdded(e)&&(t.showOverlay(),t.unSelectAll())},onReparentEnd:function(e){t.isNodeAdded(e)&&t.removeOverlay()},addToAuxiliaryView:function(o,a){var r,s,l,c,g,u,f=a||{},h={},A=d.getNLSValue(n.getId()),v=0,p=!!e.is(f.forceDBMode)&&f.forceDBMode,y=!!e.is(f.askAddToAuxConfirmation)&&f.askAddToAuxConfirmation,w={withLinksResolved:!1,forceDBMode:p,onAddToTreeListComplete:function(e){v++,n.log(d.getNLSValue("AuxiliaryModule.AddRoot.Title",{objectName:e.get("V_Name"),view:A}),g),v===o.length&&(m.visibleFlag||n.notify("toggleCmdCheckHeaderState",{cmdName:"ToggleAuxiliaryView",cmdState:!0}),0===v&&n.info(d.getNLSValue("AuxiliaryModule.AddRootSuccess.Title",{view:A}),g))}};o=e.is(o,"array")?o:[o],r=function(){g=n.log(d.getNLSValue("AuxiliaryModule.AddRoot.LogMessage",{view:A})),o.forEach(function(i){u=t.validate(i),e.is(u)?(h[u.param]=u.paramValue,c=d.getNLSValue(u.key,h,"ValidationError"),n.warn(c,g),v++):t.addNode(i,w)})},e.is(o)&&(y?(s=d.getNLSValue("Confirmation.AddAsNewRoot"),l=d.getNLSValue("Confirmation.AreYouSure"),i.showConfirmation(l,s,{attributes:["V_Name"],models:o},function(n){e.is(n)&&n&&r()})):r())},onSearchAndAddInstance:function(){var e,n,i=t.getSelectedNodesInfo();1===i.length&&I()&&(n="RESOURCE"!==(e=a.getReferenceModel(i[0].id,!0)).get("PPRTYPE")?a.getValidChildTypes(e):["VPMReference"],s.showSearchDialoguAndActivate(T,{types:n}))},onInsertAsCopy:function(){var e,n=t.getSelectedNodesInfo();1===n.length&&I()&&(e=a.getReferenceModel(n[0].id,!0),s.showSearchDialoguAndActivate(T,{types:a.getValidChildTypes(e),command:"duplicate"}))}}}}});