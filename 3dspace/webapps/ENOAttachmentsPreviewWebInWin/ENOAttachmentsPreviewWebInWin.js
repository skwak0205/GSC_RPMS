define("DS/ENOAttachmentsPreviewWebInWin/Preview",["DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/3DPlayHelper/3DPlayHelper","DS/Controls/ComboBox","css!DS/ENOAttachmentsPreviewWebInWin/assets/css/ENOAttachmentsPreviewWebInWin.css"],function(e,t,n){"use strict";var i=null;return{_3dplay:null,_3dspace:null,_platformId:null,InitWebInWin:function(e,t,n,o){var s=this;i=e;var l={};this._getWebInWinParameters(function(e){l=e||null,s._populate3DSpaceURL(l).then(function(e){s._3dspace=e["3DSpace"]?e["3DSpace"]:"",s._platformId=e.platformId?e.platformId:"";var i=s.buildDocumentArray(t,n,o);i.length>1&&s.buildComboBox(i),i.length>0&&s.buildPlayer(i[0])},function(e){return console.log("Populate 3DSpace URL failed"),Promise.reject(e)})})},_getWebInWinParameters:function(e){window.COMPASS_CONFIG&&window.COMPASS_CONFIG.myAppsBaseUrl?e(window.COMPASS_CONFIG):this._getAppsUrl(function(t){window.COMPASS_CONFIG||(window.COMPASS_CONFIG={}),t&&(window.COMPASS_CONFIG.myAppsBaseUrl=t,window.COMPASS_CONFIG.userId||(window.COMPASS_CONFIG.userId=i),window.COMPASS_CONFIG.lang||(window.COMPASS_CONFIG.lang=widget.lang)),e(window.COMPASS_CONFIG)})},_getAppsUrl:function(e){"function"==typeof dscef.getMyAppsURL?dscef.getMyAppsURL().then(function(t){console.log("MyApps URL",t),e(t)}).catch(function(t){console.error("Failed to fetch MyApps URL: "+t),e(null)}):e(null,null)},_populate3DSpaceURL:function(t){return new Promise(function(n,i){var o=null;t&&((o={}).myAppsBaseUrl=t.myAppsBaseUrl,o.userId=t.userId,o.lang=t.lang),e.getPlatformServices({config:o,onComplete:function(e){for(var t=0;t<e.length;t++)console.log("platformId",e[t].platformId),console.log("3DSpace",e[t]["3DSpace"]),console.log("3DSearch",e[t]["3DSearch"]);n(e.length>0?e[0]:{})},onFailure:i})})},reload:function(e,t,n){var i=this.buildDocumentArray(e,t,n);if(i.length>1)this.buildComboBox(i);else{var o=widget.body.getElement("#Attachments-Preview-Combo");o&&o.setStyle("display","none")}i.length>0&&this.loadAsset(i[0])},loadAsset:function(e){if(this._3dplay&&this._3dspace&&this._platformId){var t={input:{asset:{dtype:e.documentType,provider:"EV6",serverurl:this._3dspace,physicalid:e.physicalId,tenant:this._platformId,requiredAuth:"passport",requestsOptions:{authentication:"passport"}}}};this._3dplay.load(t)}},buildPlayer(e){var n=UWA.createElement("div",{id:"Attachments-Preview-3DPlay"});n.inject(widget.body),this._3dplay=new t({container:n,input:{asset:{dtype:e.documentType,provider:"EV6",serverurl:this._3dspace,physicalid:e.physicalId,tenant:this._platformId,requiredAuth:"passport",requestsOptions:{authentication:"passport"}}},options:{loading:"autoplay"}})},buildComboBox:function(e){var t=this,i=widget.body.getElement("#Attachments-Preview-Combo");if(e.length>1){i?i.setStyle("display","block"):(i=UWA.createElement("div",{id:"Attachments-Preview-Combo"})).inject(widget.body,"top");var o=[];if(e.forEach(e=>{o.push(e.name)}),i.firstChild&&i.firstChild.dsModel)i.firstChild.dsModel.elementsList=o;else{var s=new n({elementsList:o,enableSearchFlag:!1});s.addEventListener("change",function(n){var i=e[n.dsModel.selectedIndex];t.loadAsset(i)}),s.inject(i)}}else i&&i.firstChild&&i.firstChild.dsModel&&(i.firstChild.dsModel.destroy(),i.remove())},buildDocumentArray(e,t,n){var i=[];if(e.length===t.length&&e.length===n.length)for(var o=0;o<e.length;o++)i[o]={physicalId:e[o],name:n[o],documentType:t[o]};return i}}});