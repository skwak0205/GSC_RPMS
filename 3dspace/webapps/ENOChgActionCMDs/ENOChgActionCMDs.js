define("DS/ENOChgActionCMDs/scripts/CAActionBarController",["UWA/Class","DS/Core/ModelEvents","UWA/Class/Promise","DS/ENOChgServices/scripts/services/ChgInfraService","DS/ENOChgServices/scripts/services/ChgServiceGlobalVariable"],function(e,t,n,i,s){"use strict";return e.singleton({_baseJSON:{title:void 0,description:void 0,severity:void 0,proposed:[],context:[],referential:[],assignee:[],reviewer:[],follower:[],changeorder:void 0},_SingletonCAActionBarEventInstance:null,init:function(e){console.log(widget.id);s.getGlobalVariable()},getEventHandler:function(){return null==this._SingletonCAActionBarEventInstance&&(this._SingletonCAActionBarEventInstance=new t),this._SingletonCAActionBarEventInstance},setCommandState:function(){var e=this.getEventHandler();s.getGlobalVariable()&&this.isObjectSelected()?e.publish({event:"AddToCAEnable",data:{}}):e.publish({event:"AddToCADisable",data:{}})},clearObjects:function(){this._baseJSON={title:void 0,description:void 0,severity:void 0,proposed:[],context:[],referential:[],assignee:[],reviewer:[],follower:[],changeorder:void 0},this.setCommandState()},setTenant:function(e){s.getGlobalVariable().tenant=e},setSecurityContext:function(e){s.getGlobalVariable().mySecurityContext=e},addTitle:function(e){e&&(this._baseJSON.title=e,this.setCommandState())},addDescription:function(e){e&&(this._baseJSON.description=e,this.setCommandState())},addSeverity:function(e){e&&(this._baseJSON.severity=e,this.setCommandState())},addContext:function(e){var t=this;e.forEach(function(e){t._baseJSON.context.push(e)}),this.setCommandState()},addReferential:function(e){var t=this;e.forEach(function(e){t._baseJSON.referential.push(e)}),this.setCommandState()},addProposed:function(e){var t=this;e.forEach(function(e){t._baseJSON.proposed.push(e)}),this.setCommandState()},addAssignee:function(e){var t=this;e.forEach(function(e){t._baseJSON.assignee.push(e)}),this.setCommandState()},addReviewer:function(e){var t=this;e.forEach(function(e){t._baseJSON.reviewer.push(e)}),this.setCommandState()},addFollower:function(e){var t=this;e.forEach(function(e){t._baseJSON.follower.push(e)}),this.setCommandState()},setChangeOrder:function(e){e&&(this._baseJSON.changeorder=e,this.setCommandState())},removeProposed:function(e){var t=this;e.forEach(function(e){var n=t._baseJSON.proposed.indexOf(e);-1!=n&&t._baseJSON.proposed.splice(n,1)}),this.setCommandState()},removeContext:function(e){var t=this;e.forEach(function(e){var n=t._baseJSON.context.indexOf(e);-1!=n&&t._baseJSON.context.splice(n,1)}),this.setCommandState()},removeAssignee:function(e){var t=this;e.forEach(function(e){var n=t._baseJSON.assignee.indexOf(e);-1!=n&&t._baseJSON.assignee.splice(n,1)}),this.setCommandState()},removeReviewer:function(e){var t=this;e.forEach(function(e){var n=t._baseJSON.reviewer.indexOf(e);-1!=n&&t._baseJSON.reviewer.splice(n,1)}),this.setCommandState()},removeFollower:function(e){var t=this;e.forEach(function(e){var n=t._baseJSON.follower.indexOf(e);-1!=n&&t._baseJSON.follower.splice(n,1)}),this.setCommandState()},removeReferential:function(e){var t=this;e.forEach(function(e){var n=t._baseJSON.referential.indexOf(e);-1!=n&&t._baseJSON.referential.splice(n,1)}),this.setCommandState()},isObjectSelected:function(){var e=!1;return(this._baseJSON.proposed.length>0||this._baseJSON.context.length>0||this._baseJSON.assignee.length>0||this._baseJSON.reviewer.length>0||this._baseJSON.follower.length>0||this._baseJSON.referential.length>0)&&(e=!0),e},getJSON:function(){return console.log(this._baseJSON),this._baseJSON}})}),define("DS/ENOChgActionCMDs/scripts/SearchSelector",["UWA/Class/View","DS/Handlebars/Handlebars4","DS/UIKIT/Autocomplete","UWA/Class/Promise","DS/ENOChgServices/scripts/services/ChgInfraService","DS/ENOChgServices/scripts/services/ChgServiceGlobalVariable","css!DS/ENOChgActionCMDs/ENOChgActionCMDs"],function(e,t,n,i,s,a,o){"use strict";return e.extend({autocomplete:null,toolbar:null,fieldTemplate:null,searchCallBack:null,confirmCallBack:null,confirmIconSpan:null,setup:function(){},init:function(e){this._parent(e),this.searchCallBack=e.searchCallBack,this.confirmCallBack=e.confirmCallBack;this.fieldTemplate=t.compile('<div id="SearchSelectorContainer" style="height:38px;display:flex">\t\t\t\t\t\t\t\t\t\t<div class="model-selector-container" style="width:270px;display:flex;position:relative"></div>\t\t\t\t\t\t\t\t\t\t<div class="toolbar-model-selector" style="display:flex;position:relative"></div>\t\t\t\t\t\t\t\t\t\t</div>')},render:function(){var e=this;this.container.setHTML(this.fieldTemplate()),this.autocomplete=new n({multiSelect:!1,showSuggestsOnFocus:!1,placeholder:"Type to search Change Action",disabled:!1,allowFreeInput:!0,minLengthBeforeSearch:3,events:{onSelect:function(t,n){e.confirmIconSpan.setStyle("visibility","visible")},onUnselect:function(t,n){e.confirmIconSpan.setStyle("visibility","hidden"),this.removeDataset("searchDataSet")}},datasets:{configuration:{remoteSearchEngine:function(t,n){var o;return!!n&&new i(function(i,c){n.contains("*")||(n+="*");var r={with_indexing_date:!0,with_nls:!1,label:"yus-1515078503005",locale:"en",select_predicate:["ds6w:label","ds6w:type","ds6w:description","ds6w:identifier","ds6w:responsible"],select_file:["icon","thumbnail_2d"],query:'(flattenedtaxonomies:"types/Change Action" AND '+n+")",order_by:"desc",order_field:"relevance",nresults:1e3,start:"0",source:[],tenant:a.getGlobalVariable().tenant},l=(r=JSON.stringify(r),{isfederated:!0});s.makeWSCall("/search?xrequestedwith=xmlhttprequest","POST","enovia","application/json",r,function(n){(o={}).dataset=t,o.matchingItems=n&&t.dataParser&&t.dataParser.call(e,t,n),i(o)},function(e){e.type="error",e.dataset=t,c(e)},l)})},dataParser:function(e,t){var n=[];return t.results&&t.results.length&&t.results.forEach(function(e){if(e.attributes&&e.attributes.length){var t={};e.attributes.forEach(function(e){"resourceid"==e.name?t.value=e.value:"ds6w:identifier"==e.name&&(t.label=e.value)}),n.push(t)}}),n}}}});var t=UWA.createElement("div");t.setStyles({position:"relative",width:"100%"}),t.style.display="inline-block",this.autocomplete.inject(t),t.inject(this.container.getElement(".model-selector-container"));var o=function(t){if(1==t.length){var n=[];n.push({label:t[0][1],value:t[0][0],selected:!0});var i={name:"searchDataSet"};i.items=n,e.autocomplete.addDataset(i)}},c=UWA.createElement("span",{class:"fonticon fonticon-1x fonticon-search",id:"CACMDSearchIcon"});c.addEventListener("click",function(){e.searchCallBack(o)}),this.confirmIconSpan=UWA.createElement("span",{class:"fonticon fonticon-1x fonticon-check",id:"CACMDConfirmIcon"}),this.confirmIconSpan.setStyle("visibility","hidden"),this.confirmIconSpan.setStyle("margin-right","24px"),this.confirmIconSpan.addEventListener("click",function(){e.confirmCallBack(e.autocomplete.getValue())});var r=UWA.createElement("div",{class:"imgSearchContainer1",id:"searchIconCont"});return this.autocomplete.elements.clear.setStyle("margin-right","20px"),this.autocomplete.elements.clear.setStyle("z-index","999"),r.style.opacity="0.5",r.style.float="right",r.style.marginTop="-27px",r.style.marginRight="5px",r.addClassName("imgFocusIdenty"),r.addContent(this.confirmIconSpan),r.addContent(c),r.inject(t),this}})}),define("DS/ENOChgActionCMDs/scripts/Commands/CommandBase",["DS/ApplicationFrame/Command"],function(e){"use strict";return e.extend({name:"",pids:null,init:function(e,t){this.name=t,this._parent(e,{mode:"exclusive",isAsynchronous:!1})},beginExecute:function(){},execute:function(){},endExecute:function(){}})}),define("DS/ENOChgActionCMDs/scripts/Commands/AddToNewCA",["DS/ENOChgActionCMDs/scripts/Commands/CommandBase","DS/ENOChgActionCMDs/scripts/CAActionBarController","DS/ENOChangeActionUX/scripts/CreateCAForm","DS/ENOChgServices/scripts/services/ChgErrors"],function(e,t,n,i){"use strict";return e.extend({init:function(e){var n=this;this._parent(e,"AddToNewCA"),this.disable();var i=t.getEventHandler();i.unsubscribe("AddToCAEnable"),i.subscribe({event:"AddToCAEnable"},function(e){n.enable()}),i.unsubscribe("AddToCADisable"),i.subscribe({event:"AddToCADisable"},function(e){n.disable()})},execute:function(e,s){var a=t.getJSON();console.log(a);n.createCAFromActionBar(a,function(n){e?(t.clearObjects(),e(n)):null!=n.changeaction&&i.success("Successfully added to Change Action: "+n.changeaction.name)},function(e){s&&s(e)}).then(function(e){},function(e){return console.log("CA Create Form Initialization Failed"),Promise.reject(e)})}})}),define("DS/ENOChgActionCMDs/scripts/Commands/AddToExistingCA",["DS/ENOChgActionCMDs/scripts/Commands/CommandBase","DS/ENOChgActionCMDs/scripts/CAActionBarController","DS/ENOChgServices/scripts/services/ChgIDCardCommonServices","DS/ENOChgActionCMDs/scripts/SearchSelector","DS/UIKIT/Modal","DS/UIKIT/Input/Button","DS/ENOChgServices/scripts/services/ChgInfraService","DS/ENOChgServices/scripts/services/ChgErrors","DS/ENOChangeActionUX/scripts/Services/ChgChangeActionServices","DS/ENOChgServices/scripts/services/ChgProposedServices","DS/ENOChgServices/scripts/services/ChgServiceGlobalVariable"],function(e,t,n,i,s,a,o,c,r,l,d){"use strict";return e.extend({searchSelector:null,_modal:null,init:function(e){var n=this;this._parent(e,"AddToExistingCA"),this.disable();var i=t.getEventHandler();i.unsubscribe("AddToCAEnable"),i.subscribe({event:"AddToCAEnable"},function(e){n.enable()}),i.unsubscribe("AddToCADisable"),i.subscribe({event:"AddToCADisable"},function(e){n.disable()})},launchSearchSelector:function(){var e,d,h={},u=widget.body,f=this,S=t.getJSON();h.searchCallBack=function(e){var t=n.activateSearch("AddToExistingCA");n.search("Add To Existing Change Action","Change Action",function(t){e(t)},"AddToExistingCA",t)},h.confirmCallBack=function(t){var n=[],i=S.proposed;if(i.length>0)i.forEach(function(e){n.push("pid:"+e)}),l.getAllowedOperationActivity(n,"pid:"+t).then(function(n){e=r.getJSONForCACreation(S,n);var i="/resources/modeler/change/changeaction/pid:"+t;o.makeWSCall(i,"PUT","enovia","application/json",JSON.stringify(e),function(e){f._modal.destroy(),console.log("data addition: successful"),c.success("Successfully added to Change Action: "+e.changeaction.name)},null)},function(e){console.log("Issue in retrieving default operation")});else{e=r.getJSONForCACreation(S);var s="/resources/modeler/change/changeaction/pid:"+t;o.makeWSCall(s,"PUT","enovia","application/json",JSON.stringify(e),function(e){f._modal.destroy(),console.log("data addition: successful"),c.success("Successfully added to Change Action: "+e.changeaction.name)},null)}},this._modal&&this._modal.destroy(),(d=UWA.createElement("div")).setStyle("display","flex"),new i(h).render().inject(d),new a({value:"",icon:"wrong"}).inject(d).addEvent("onClick",function(){f._modal.destroy()}),this._modal=new s({className:this.name+"_modal",closable:!1,body:d,visible:!0,events:{}}),this._modal.inject(u),this._modal.elements.wrapper.setStyle("width","336px"),(d=this._modal.elements.wrapper.querySelector(".modal-body")).setStyle("padding","0px"),d.setStyle("min-height","0px"),d.setStyle("overflow","visible"),this._modal.elements.wrapper.querySelector(".autocomplete-suggests").setStyle("width","270px"),this._modal.elements.wrapper.setStyle("padding-top","calc("+function(){var e="500px";u.scrollHeight>40&&(e=u.scrollHeight+"px");return e}()+" - 110px)")},execute:function(){var e=this,t=d.getGlobalVariable();if(t.tenant||(t.tenant=widget.getValue("x3dPlatformId")?widget.getValue("x3dPlatformId"):"OnPremise"),t.tenantMappings){for(var n=t.tenantMappings,i=0;i<n.length;i++)t.tenant==n[i].platformId&&(t.baseURL=n[i]["3DSpace"],t.federatedURL=n[i]["3DSearch"]);""!=t.mySecurityContext?e.launchSearchSelector():o.populateSecurityContext().then(function(t){e.launchSearchSelector()},function(e){console.log("ENOChgActionCMDs: populate security context failed")})}else o.populate3DSpaceURL().then(function(n){""!=t.mySecurityContext?e.launchSearchSelector():o.populateSecurityContext().then(function(t){e.launchSearchSelector()},function(e){console.log("ENOChgActionCMDs: populate security context failed")})},function(e){console.log("ENOChgActionCMDs: populate base URL failed")})}})});