define("DS/ViewPanel/ViewPanelController",["DS/VisuTools/SettingManager","DS/Visualization/ThreeJS_R57","DS/QualityManager/QMController"],function(e,i,t){"use strict";var a={materialMode:!1,visuShadingFaceMode:"Shaded",visuShadingEdgeMode:"WithEdges",visuShadingMode:"ShadingEdges",visuEnv:"Basic",visuAppearanceMode:"BASIC",axisState:!1,linesState:!0,planesState:!1,pointsState:!1,verticesState:!0,visuOutlineMode:!1,projectionMode:0};return class{constructor(i,s){i._useQM&&!window.__karma__&&(a.visuEnv="WhiteExperience",t.computeDefaultPreset(),t.unknownOrVeryLowGPU||(a.visuAppearanceMode="GASLOOK")),(s=s||{}).defaultSettings=s.defaultSettings||{},s.uiConfig=s.uiConfig||{},this.defaultSettings={},Object.assign(this.defaultSettings,a),Object.assign(this.defaultSettings,s.defaultSettings),this._settingsManagerParams={useLocalStorage:void 0!==s.useLocalStorage&&s.useLocalStorage,useWidget:void 0===s.useWidget||s.useWidget,name:"VisuViewSettings",viewer:i,importFromOldLocalStorage:void 0!==s.importFromOldLocalStorage&&s.importFromOldLocalStorage};var n=s.uiConfig;this._viewModePanelUIParams={useShadingIllustration:void 0!==n.useShadingIllustration&&n.useShadingIllustration,useOutline:void 0===n.useOutline||n.useOutline},this._viewModePanelUIParams.useOutline=this._viewModePanelUIParams.useOutline&&!this._viewModePanelUIParams.useShadingIllustration,this._keyWriter=e.Write(this._settingsManagerParams),this._eventListeners=[]}init(){var i=this._settingsManagerParams.viewer,t=this._keyWriter,a={},s=this.defaultSettings;if(Object.assign(a,s),Object.assign(a,e.Struct(this._settingsManagerParams)),this._settingsManagerParams.importFromOldLocalStorage&&e.isEmptySettings(this._settingsManagerParams)){var n=localStorage.getItem("visuEnv");n&&n.includes("OCA")&&(n=n.replace("OCA",""),a.visuEnv=n);var o=localStorage.getItem("projectionMode");o&&(a.projectionMode=parseInt(o,10));var d=localStorage.getItem("visuShadingMode");d&&(a.visuShadingMode=d);var r=localStorage.getItem("axisState");r&&(a.axisState="true"===r,a.planesState=a.axisState);var u=localStorage.getItem("linesState");u&&(a.linesState="true"===u,a.verticesState=a.linesState);var g=localStorage.getItem("pointsState");g&&(a.pointsState="true"===g)}var l,v=this._eventListeners,S=this;l=i.onPreRender(function(){i.unsubscribe(l),v.push(i.onMaterialModeChange(function(){t.materialMode=i.getMaterialMode()!==!!s.materialMode?i.getMaterialMode():void 0})),v.push(i.onVisuShadingFaceModeChange(function(){t.visuShadingFaceMode=i.getVisuShadingFaceMode()!==s.visuShadingFaceMode?i.getVisuShadingFaceMode():void 0})),v.push(i.onVisuShadingEdgeModeChange(function(){t.visuShadingEdgeMode=i.getVisuShadingEdgeMode()!==s.visuShadingEdgeMode?i.getVisuShadingEdgeMode():void 0})),v.push(i.onVisuShadingModeChange(function(){t.visuShadingMode=i.getVisuShadingMode()!==s.visuShadingMode?i.getVisuShadingMode():void 0})),v.push(i.onVisuEnvChange(function(){var e=i.getVisuEnv();e.includes("OCA")&&(e=e.replace("OCA",""),t.visuEnv=e!==s.visuEnv?e:void 0)})),v.push(i.onVisuAppearanceModeChange(function(){t.visuAppearanceMode=i.getVisuAppearanceMode()!==s.visuAppearanceMode?i.getVisuAppearanceMode():void 0})),v.push(i.onAxisFilterChange(function(){t.axisState=i.getAxisFilter()!==!!s.axisState?i.getAxisFilter():void 0})),v.push(i.onPlanesFilterChange(function(){t.planesState=i.getPlanesFilter()!==!!s.planesState?i.getPlanesFilter():void 0})),v.push(i.onLinesFilterChange(function(){i.currentViewpoint._2DMode||(t.linesState=i.getLinesFilter()!==!!s.linesState?i.getLinesFilter():void 0)})),v.push(i.onVerticesFilterChange(function(){i.currentViewpoint._2DMode||(t.verticesState=i.getVerticesFilter()!==!!s.verticesState?i.getVerticesFilter():void 0)})),v.push(i.onPointsFilterChange(function(){i.currentViewpoint._2DMode||(t.pointsState=i.getPointsFilter()!==!!s.pointsState?i.getPointsFilter():void 0)})),v.push(i._onVisuOutlineModeChange(function(){t.visuOutlineMode=i._getVisuOutlineMode()!==!!s.visuOutlineMode?i._getVisuOutlineMode():void 0})),v.push(i.onProjectionTypeChange(function(){i.currentViewpoint._2DMode||(t.projectionMode=i.currentViewpoint.getProjectionType()!==s.projectionMode?i.currentViewpoint.getProjectionType():void 0)})),S._apply(a)})}_apply(e){var t=this.defaultSettings,s=this._viewModePanelUIParams,n=this._settingsManagerParams.viewer;if(s.useShadingIllustration?e.visuOutlineMode=!1:("Illustration"===e.visuShadingFaceMode&&(e.visuShadingFaceMode="Illustration"===t.visuShadingFaceMode?a.visuShadingFaceMode:t.visuShadingFaceMode),"ShadingIllustration"===e.visuShadingMode&&(e.visuShadingMode="ShadingIllustration"===t.visuShadingMode?a.visuShadingMode:t.visuShadingMode)),void 0!==e.materialMode&&n.setMaterialMode(e.materialMode),void 0!==e.visuShadingFaceMode&&n.setVisuShadingFaceMode(e.visuShadingFaceMode),void 0!==e.visuShadingEdgeMode&&n.setVisuShadingEdgeMode(e.visuShadingEdgeMode),void 0!==e.visuShadingMode&&n.setVisuShadingMode(e.visuShadingMode),void 0!==e.visuEnv){var o=e.visuEnv;o.includes("OCA")&&(o=o.replace("OCA",""));var d=n.getVisuEnv();d.includes("OCA")&&(d=d.replace("OCA","")),d!==o&&n.setVisuEnvOCA(o)}void 0!==e.visuAppearanceMode&&n.setVisuAppearanceMode(i.DefaultAppearanceMode[e.visuAppearanceMode]),void 0!==e.pointsState&&n.setPointsFilter(e.pointsState),void 0!==e.axisState&&n.setAxisOnlyFilter(e.axisState),void 0!==e.planesState&&n.setPlanesFilter(e.planesState),void 0!==e.linesState&&n.setLinesFilter(e.linesState),void 0!==e.verticesState&&n.setVerticesFilter(e.verticesState),void 0!==e.visuOutlineMode&&n._setVisuOutlineMode(e.visuOutlineMode),void 0!==e.projectionMode&&n.currentViewpoint.setProjectionType(e.projectionMode)}apply(e){var i=this._settingsManagerParams.viewer,t={};Object.assign(t,e||{});var a,s=this;a=i.onPreRender(function(){i.unsubscribe(a),s._apply(t)}),i.render()}dumpSettings(){var e=this._settingsManagerParams.viewer;return{materialMode:e.getMaterialMode(),visuShadingFaceMode:e.getVisuShadingFaceMode(),visuShadingEdgeMode:e.getVisuShadingEdgeMode(),visuShadingMode:e.getVisuShadingMode(),visuEnv:e.getVisuEnv(),visuAppearanceMode:e.getVisuAppearanceMode(),pointsState:e.getPointsFilter(),axisState:e.getAxisFilter(),planesState:e.getPlanesFilter(),linesState:e.getLinesFilter(),verticesState:e.getVerticesFilter(),visuOutlineMode:e._getVisuOutlineMode(),projectionMode:e.currentViewpoint.getProjectionType()}}_updateViewPanelUIConfiguration(e){void 0!==e.useShadingIllustration&&(this._viewModePanelUIParams.useShadingIllustration=e.useShadingIllustration),void 0!==e.useOutline&&(this._viewModePanelUIParams.useOutline=e.useOutline),this._viewModePanelUIParams.useOutline=this._viewModePanelUIParams.useOutline&&!this._viewModePanelUIParams.useShadingIllustration;var i=this._settingsManagerParams.viewer;this._viewModePanelUIParams.useOutline||i._setVisuOutlineMode(!1);var t=this.defaultSettings;this._viewModePanelUIParams.useShadingIllustration||"ShadingIllustration"!==i.getVisuShadingMode()||("ShadingIllustration"===t.visuShadingMode?i.setVisuShadingMode(a.visuShadingMode):(i.setMaterialMode(t.materialMode),i.setVisuShadingFaceMode("Illustration"===t.visuShadingFaceMode?a.visuShadingFaceMode:t.visuShadingFaceMode),i.setVisuShadingEdgeMode(t.visuShadingEdgeMode),i.setVisuShadingMode(t.visuShadingMode)))}restore(){var i={},t=this.defaultSettings;Object.assign(i,t),Object.assign(i,e.Struct(this._settingsManagerParams)),this.apply(i)}dispose(){for(var e=0;e<this._eventListeners.length;e++)this._settingsManagerParams.viewer.unsubscribe(this._eventListeners[e]);this._eventListeners=[]}}});var toto=function(){};toto();