/*!  COPYRIGHT DASSAULT SYSTEMES 2015   */
define("DS/SNNavigationMap/utils/PromisesManager",["UWA/Class","UWA/Promise","DS/WAFData/WAFData","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_internal","DS/Notifications/NotificationsManagerUXMessages","DS/Notifications/NotificationsManagerViewOnScreen","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_internal"],function(e,t,i,n,s,o,a){"use strict";return e.extend({init:function(e){this._debug=e.debugMode||!1,this._notifManager=s,o.setNotificationManager(this._notifManager)},createPromise:function(t,s){var o={},r={},l=this;return this._debug&&(t.params.debug=!0),s||(s="POST"),t.params&&(t.params.label="RelationalExplorer",o=JSON.stringify(t.params)),new e.Promise(function(e,d){i.authenticatedRequest(t.url,{headers:{Accept:"application/json","Content-Type":"application/json",SecurityContext:t.xPrefCredential},method:s,data:o,onComplete:function(i){t.onComplete?t.onComplete(i).then(function(t){e(t)}):e(i)},timeout:t.timeout,onFailure:function(e){r=t.failureParams?t.failureParams:{level:"error",message:n.get("generic"),sticky:!0},console.log(e),t.noErrorMsg||l._notifManager.addNotif(r),d(e)},onTimeout:function(e){console.log(e),l._notifManager.addNotif({level:"error",msg:a.get("timeout"),subtitle:a.get("verifyConnection"),sticky:!0}),d(e)}})})}})}),define("DS/SNNavigationMap/utils/MapSecurityCtxConverter",["UWA/Class","UWA/Promise"],function(e,t){"use strict";return e.singleton({init:function(){},buildSecurityContext:function(e,t,i){return"ctx::"+i+"."+t+"."+e},buildDisplayString:function(e,t,i,n){return n?e+" ● "+i:e+" ● "+t+" ● "+i},extractCouple:function(e){var t="",i="",n="",s="";for(var o in e){var a=e[o];switch(o){case"organization":i=a.title?a.title:a.name,t=a.name;break;case"role":n=a.name,s=a.nls?a.nls:n}}return{org:t,orgLabel:i,role:n,roleNls:s}},prepareForStorage:function(e){var t,i,n,s,o,a=e.pid,r=[],l=null,d=!0;for(var c in e.preferredcredentials){var h=e.preferredcredentials[c];switch(c){case"collabspace":i=h.name,n=h.title?h.title:i;break;case"organization":s=h.name;break;case"role":o=h.name}}for(var u in t=this.buildSecurityContext(n,s,o),e.collabspaces){if((m=e.collabspaces[u]).couples&&m.couples.length)for(var g=0;g<m.couples.length;g++){var p=this.extractCouple(m.couples[g]);if(null===l)l=p.org;else if(l!=p.org){d=!1;break}}}for(var u in e.collabspaces){var m;if((m=e.collabspaces[u]).couples&&m.couples.length)for(g=0;g<m.couples.length;g++){p=this.extractCouple(m.couples[g]);var f=this.buildSecurityContext(m.name,p.org,p.role),v=m.title?m.title:m.name,_={csName:v,label:this.buildDisplayString(v,p.orgLabel,p.roleNls,d),value:f};t===f&&(_.isDefault=!0),r.push(_)}}return{userId:a,securityContext:t,cspaces:r}},getSecurityContext:function(e){var t="string"==typeof e?JSON.parse(e):e;return this.prepareForStorage(t)}})}),define("DS/SNNavigationMap/models/Count",["UWA/Class/Model","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_internal"],function(e,t){"use strict";return e.extend({defaults:{id:"",count:0,name:"",direction:"",source:"",relationName:""},setup:function(e,i){this._parent(e,i),e.name&&this.set("relationName",t[e.name+"_short"]||t[e.name])},parse:function(e){return count=UWA.extend(count,{id:e.id,count:e.count,name:e.name,direction:e.direction,source:e.source,relationName:t[e.name+"_short"]||t[e.name]}),count}})}),define("DS/SNNavigationMap/views/NavigationPager",["UWA/Core","UWA/Class/View","DS/Handlebars/Handlebars4","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_internal","text!DS/SNNavigationMap/assets/templates/pager.html"],function(e,t,i,n,s){"use strict";return t.extend({name:"navigationapp-homepage-view",_matchedNodes:[],_selectedIndex:0,className:function(){return this.getClassNames("-container")},setup:function(t){this._debug=t.debugMode,this._widgetId=t.widgetId||null,this._isWebInWin=t.isWebInWin;var o=i.compile(s),a={previousTitle:n.get("Pager-Previous"),nextTitle:n.get("Pager-Next"),closeTitle:n.get("Pager-Close")},r=o.call(null,a);e.createElement("div",{class:"ENORIPE-pager-container",html:r}).inject(this.container);this._isWebInWin&&this.container.addClassName("enoripe-pager-native"),this._setUpEvents()},render:function(e){if(e&&e.result&&e.result.length&&e.result.length>0){if(this.container.show(),this._matchedNodes=e.result,this._matchedNodes.push("All"),this._selectedIndex=0,this._setCount(this._matchedNodes.length),!e.noChangeFocus){var t=this._matchedNodes[this._selectedIndex];t&&this.dispatchEvent("ENORIPE_HighlightNode",t)}}else this.container.hide()},_setCount:function(e){var t=this._selectedIndex+1,i=this._selectedIndex+1+"/"+(e-1),n=this.getElement(".ENORIPEPagerLabel");t===e&&(i="All"),n&&n.setContent(i)},_clearCount:function(){var e=this.getElement(".ENORIPEPagerLabel");e&&e.empty()},_setUpEvents:function(){this.getElement(".ENORIPEPagerPreviousButton").addEventListener("click",this._prevClick.bind(this)),this.getElement(".ENORIPEPagerNextButton").addEventListener("click",this._nextClick.bind(this)),this.getElement(".ENORIPEPagerCloseButton").addEventListener("click",this._closeClick.bind(this))},_nextClick:function(){if(this._matchedNodes&&this._matchedNodes.length>0){this._selectedIndex===this._matchedNodes.length-1?this._selectedIndex=0:this._selectedIndex++,this._setCount(this._matchedNodes.length);var e=this._matchedNodes[this._selectedIndex];e&&this.dispatchEvent("ENORIPE_HighlightNode",e)}},_prevClick:function(){if(this._matchedNodes&&this._matchedNodes.length>0){0===this._selectedIndex?this._selectedIndex=this._matchedNodes.length-1:this._selectedIndex--,this._setCount(this._matchedNodes.length);var e=this._matchedNodes[this._selectedIndex];e&&this.dispatchEvent("ENORIPE_HighlightNode",e)}},_closeClick:function(){this.closePager(),this.dispatchEvent("ENORIPE_NavPagerClose")},closePager:function(){this._selectedIndex=0,this._matchedNodes=[],this._clearCount(),this.container.hide()},destroy:function(){this._parent(),this.container.destroy(),this.container=null}})}),define("DS/SNNavigationMap/views/SearchViewForNative",["UWA/Core","UWA/Class/View","DS/UIKIT/Autocomplete","DS/Handlebars/Handlebars4","text!DS/SNNavigationMap/assets/templates/searchview.html","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_internal"],function(e,t,i,n,s,o){"use strict";return t.extend({name:"search-native-view",className:function(){return this.getClassNames("-container")},setup:function(e){this._template=n.compile(s),this.container.inject(e.renderTo)},render:function(){var t=this._template.call(null,{clearSearch:o.get("SNNFind_clearSearch"),runSearch:o.get("MapSearchView_search")});return e.createElement("div",{class:"enoripe_search_container",html:t}).inject(this.container),this._setupSearchInput(this.getElement(".enoripe_search_autocomplete_container")),this._setUpEvents(),this},_setUpEvents:function(){var e=this.getElement("#enoripe_clear_search"),t=this.getElement("#enoripe_run_search");e.addEventListener("click",this.clearSearch.bind(this)),t.addEventListener("click",this._performSearch.bind(this)),e.hide()},_onKeyUp:function(e){this._delayTimer&&clearTimeout(this._delayTimer);var t=this;this._delayTimer=setTimeout(function(){var i;i=(e.srcElement||e.target).value,t._handleInput(i),"Enter"!==e.key&&13!==e.keyCode||""!==i&&t._performSearch()},500)},_performSearch:function(){var e=this._autocompleteInput.getSelection();this.dispatchEvent("ENORIPE_performSearch_native",e)},_setupSearchInput:function(e){if(e){this._autocompleteInput=new i({noResultsMessage:!1,showSuggestsOnFocus:!0,closableItems:!1,allowFreeInput:!0,events:{onKeyUp:this._onKeyUp.bind(this)},placeholder:o.get("MapSearchView_search")}).inject(e)}},_handleInput:function(e){var t=this.getElement("#enoripe_clear_search");e.length>0?t.show():t.hide()},clearSearch:function(){this.getElement("#enoripe_clear_search").hide(),this._autocompleteInput.reset(),this.dispatchEvent("ENORIPE_resetSearch_native")},_close:function(){},destroy:function(){this.container=null,this._parent()}})}),define("DS/SNNavigationMap/utils/SearchUtils",["UWA/Class","UWA/Promise","DS/WAFData/WAFData","DS/PlatformAPI/PlatformAPI","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_internal","DS/Notifications/NotificationsManagerUXMessages","DS/Notifications/NotificationsManagerViewOnScreen"],function(e,t,i,n,s,o,a){"use strict";return e.extend({_currentRequest:null,init:function(e){this._debug=e.debugMode||!1,this._isWebInWin=e.isWebInWin,this._notifManager=o,a.setNotificationManager(this._notifManager)},_searchCall:function(t){var n=this,o={};return this._currentRequest&&this._currentRequest.cancel(),this._debug&&(o.debug=!0),o.label=this._getSearchLabel(),o.query=this._getQueryFromIds(t.ids,t.value),o.tenant=t.tenantName,o.with_synthesis_attribute=!1,o.with_synthesis=!1,o.select_predicate=["ds6w:label"],o=JSON.stringify(o),new e.Promise(function(e,a){n._currentRequest=i.authenticatedRequest(t.url,{headers:{Accept:"application/json","Content-Type":"application/json"},method:"POST",data:o,onComplete:function(t){n._currentRequest=null,e(t)},onFailure:function(e){n._currentRequest=null,console.log(e),n._notifManager.addNotif({level:"error",message:s.get("generic"),sticky:!0}),a(e)},onTimeout:function(e){n._currentRequest=null,console.log(e),n._notifManager.addNotif({level:"error",msg:Nls.get("timeout"),subtitle:Nls.get("verifyConnection"),sticky:!0}),a(e)}})})},_getQueryFromIds:function(e,t){for(var i=t+" AND",n=0;n<e.length;n++)i=0===n?i+" (physicalid:"+e[n]:(i+=" OR ")+"physicalid:"+e[n];return i+=")"},_getSearchLabel:function(){if(this._isWebInWin)return"ENORIPE_"+Date.now();var e=n.getUser();return"ENORIPE_"+(null!=e&&void 0!==e.login?e.login:"")+"_"+Date.now()}})}),define("DS/SNNavigationMap/utils/NlsManager",["UWA/Class","UWA/Core","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_internal","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_DEC","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_V6Design","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_V6Manufacturing","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_Customer","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_Simulation","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_DBM","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_V6Knowledgeware","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_Material","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_GEBOM","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_ReviewInterference","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_SimulationProcess","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_ECM","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_DPM","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_AER","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_Issue","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_ModelDefinition","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_RFL","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_PowerBySolidworks","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_PowerByCATIAV5","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_Electronic","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_SystemsArchitecture","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_RequirementManager","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_RTEXP","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_EngineeringDefinition","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_XSourcingApps","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_AnalyticsCase","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_PerformanceSpec","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_RAMS","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_Fastener","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_VRP","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_RouteManagement","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_EngineeringConnection","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_Deformability","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_IPClassification","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_Meeting.json","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_RelativePosition"],function(e,t,i,n,s,o,a,r,l,d,c,h,u,g,p,m,f,v,_,N,S,b,w,E,I,C,y,M,D,P,x,O,T,A,R,V,k,L,F){"use strict";return e.singleton({name:"navigation_relset_nls",getNls:function(){return t.merge(n,n),t.merge(n,s),t.merge(n,o),t.merge(n,a),t.merge(n,r),t.merge(n,l),t.merge(n,d),t.merge(n,c),t.merge(n,h),t.merge(n,u),t.merge(n,g),t.merge(n,p),t.merge(n,m),t.merge(n,f),t.merge(n,v),t.merge(n,_),t.merge(n,N),t.merge(n,S),t.merge(n,b),t.merge(n,w),t.merge(n,E),t.merge(n,I),t.merge(n,C),t.merge(n,y),t.merge(n,M),t.merge(n,D),t.merge(n,P),t.merge(n,x),t.merge(n,O),t.merge(n,T),t.merge(n,A),t.merge(n,R),t.merge(n,V),t.merge(n,k),t.merge(n,L),t.merge(n,F),n}})}),define("DS/SNNavigationMap/MapSettings",["text!DS/SNNavigationMap/assets/SNNavigationMap.settings.json","UWA/Class","UWA/Core","UWA/Class/Options","UWA/Promise","DS/WAFData/WAFData","DS/PlatformAPI/PlatformAPI","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/SNNavigationMap/utils/MapSecurityCtxConverter","DS/PADServices/utils/PADTrackerManager","text!DS/SNNavigationMap/assets/NavigationTrackerMetrics.json","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_internal"],function(e,t,i,n,s,o,a,r,l,d,c,h){"use strict";var u=t.singleton(n,{name:"navigation_map_settings",options:{},init:function(){var t=JSON.parse(e);this.setOptions(t);var i=window.location.search.substring(1);this._updateSettingsFromURLParameters(i);var n=this.getOption("widgetDomain");if(void 0!==n){var s=new URL(decodeURIComponent(n)).search.substring(1);this._updateSettingsFromURLParameters(s)}},getLang:function(){return this.getOption("lang")},getAddinMode:function(){return this.getOption("addinmode")},getYOffset:function(){return"x"===this.getLayoutAxis()?"thumbnailsMode"===this.getThumbnailsMode()?150:75:250},getNodesWidth:function(){return 170},getNodesHeight:function(){return"thumbnailsMode"===this.getThumbnailsMode()?130:65},getExpendHeight:function(){return 23},getLayoutMode:function(){return this.getOption("layoutMode")},getRootIds:function(){return this.getOption("rootIds")},setRootIds:function(e){this.setOption("rootIds",e)},setLayoutMode:function(e){"true"===e||"recompute"===e||!0===e?this.setOption("layoutMode","recompute"):this.setOption("layoutMode",!1)},getLayoutType:function(){return this.getOption("layoutType")},setLayoutType:function(e){e&&this.setOption("layoutType",e)},getThumbnailsMode:function(){return this.getOption("thumbnails2d")},setThumbnailsMode:function(e){"true"===e||"thumbnailsMode"===e||!0===e||void 0===e?this.setOption("thumbnails2d","thumbnailsMode"):this.setOption("thumbnails2d",!1)},getInstancesMode:function(){return this.getOption("showInstances")},setInstancesMode:function(e){"true"===e||"showInstance"===e||!0===e?this.setOption("showInstances",!0):this.setOption("showInstances",!1)},getPublicationsMode:function(){return this.getOption("showPublications")},setPublicationsMode:function(e){"true"===e||"showPublications"===e||!0===e?this.setOption("showPublications",!0):this.setOption("showPublications",!1)},getGhostMode:function(){return this.getOption("showGhost")},setGhostMode:function(e){"true"===e||"showGhost"===e||!0===e?this.setOption("showGhost",!0):this.setOption("showGhost",!1)},getListViewPanelWidth:function(){return this.getOption("listViewPanelWidth")},setListViewPanelWidth:function(e){e&&e>0&&this.setOption("listViewPanelWidth",e)},setInformationPanelStatus:function(e){"true"===e.isInformationPanelVisible||!0===e.isInformationPanelVisible?this.setOption("isInformationPanelVisible",!0):this.setOption("isInformationPanelVisible",!1)},setDefaultAttributesInit:function(){for(var e=u.getUserID()+"_ENORIPE_Type_Attrs",t=localStorage.getItem(e),i=this.getOption("attributes"),n=[],s=0;s<i.length;s++)n.push({uri:i[s],label:h.get(i[s])});var o={AllTypes:{name:"AllTypes",nlsLabel:h.get("AllTypes"),attributes:n},EnoripeColumns:{name:"EnoripeColumns",nlsLabel:h.get("DatagridColumns"),attributes:n}};this.setJSONAttributes(o),t=t?JSON.parse(t):o,this.setDefaultAttributes(t)},setDefaultAttributes:function(e){this.setOption("defaultAttributes"),this.setOption("defaultAttributes",e)},getDefaultAttributes:function(){return this.getOption("defaultAttributes")},setJSONAttributes:function(e){this.setOption("attributesFromJSON"),this.setOption("attributesFromJSON",e)},getJSONAttributes:function(){return this.getOption("attributesFromJSON")},updateJSONAttrsNls:function(e){var t={};e.forEach(function(e){void 0!==e.curi&&(t[e.curi]=e.label)});var i=this.getOption("attributesFromJSON");i.AllTypes&&i.AllTypes.attributes.forEach(function(e){t[e.uri]&&(e.label=t[e.uri])});var n=u.getUserID()+"_ENORIPE_Type_Attrs";localStorage.getItem(n)||this.setDefaultAttributes(i),this.setOption("fetchNlsForattrsFromJSON")},getInformationPanelVisibility:function(){return this.getOption("isInformationPanelVisible")},getLayoutAxis:function(){return this.getOption("layoutAxis")},getLayoutDirection:function(){return this.getOption("layoutDirection")},getLabelPredicates:function(){return this.getOption("labelPredicates")},getDetailPredicates:function(){return this.getOption("detailPredicates")},getAppId:function(){return"undefined"!=typeof widget&&widget.getValue("appId")||"ENORIPE_AP"},getWidgetId:function(){return this.getOption("widgetId")?this.getOption("widgetId"):"undefined"==typeof widget||this.isWebInWin()?"WebInWinId":widget.id},setWidgetId:function(e){this.setOption("widgetId",e)},_getListOfSecurityContext:function(){var e=this;return new s(function(t,i){e.getAllSecurityContexts().then(function(e){var n=[];if(e&&e.cspaces){var s=e.cspaces;if(Array.isArray(s))for(var o=0;o<s.length;o++)n[o]={label:s[o].label,value:s[o].value};JSON.stringify(n),n.length,t(n)}else i("collabspaces not found")})})},getRoles:function(){var e=this.getOption("user_granted_roles"),t=[];if(e&&("string"!=typeof e||"{"!==e[0]&&"["!==e[0]||(e=JSON.parse(e)),i.is(e,"array")))for(var n=0;n<e.length;n++)t.push(e[n].id);return t},getPlatformId:function(){return this.getCurrentTenantName()},get3DSpaceUrl:function(){if(!i.is(this.getOption("platform_services"),"array")&&"ODT_MODE"!==this.getOption("platform_services"))throw new Error("Platform services not initialize yet");var e=this.getCurrentTenantId();return this.getOption("platform_services")[e]["3DSpace"]},get3DSearchUrl:function(){if(!i.is(this.getOption("platform_services"),"array")&&"ODT_MODE"!==this.getOption("platform_services"))throw new Error("Platform services not initialize yet");var e=this.getCurrentTenantId();return this.isWebInWin()?this.getOption("platform_services")[e].Federated:this.getOption("platform_services")[e]["3DSearch"]},getMyAppsUrl:function(){return this.getOption("myappsurl")?this.getOption("myappsurl"):(console.warn("myappsurl value empty"),"")},setMyAppsUrl:function(){var e=this;this.getOption("myappsurl")||window&&window.dscef&&window.dscef.getMyAppsURL&&window.dscef.getMyAppsURL().then(function(t){e.setOption("myappsurl",t)})},setLang:function(e){this.setOption("lang",e)},getCurrentTenantName:function(){return this._currentTenant},getCurrentTenantLabel:function(){for(var e=this.getCurrentTenantName(),t=this.getTenantsPreference(),i=0;i<t.length;i++)if(e===t[i].value&&void 0!==t[i].label){e=t[i].label;break}return e},get_current_tenant_idx:function(){if(null!=current_tenant&&"undefined"!=typeof current_tenant&&!Number.isNaN(current_tenant)){var e=current_tenant;if(null===current_tenant_idx||"undefined"==typeof current_tenant_idx||Number.isNaN(current_tenant_idx)||platform_services[current_tenant_idx].displayName!==e)for(var t=0;t<platform_services.length&&(null===current_tenant_idx||"undefined"==typeof current_tenant_idx||Number.isNaN(current_tenant_idx));t++)platform_services[t].displayName===e&&(current_tenant_idx=t)}return(null===current_tenant_idx||"undefined"==typeof current_tenant_idx||Number.isNaN(current_tenant_idx))&&(console.log("Share current tenant and security context thru PADCommandProxy"),current_tenant_idx=0),current_tenant_idx},getCurrentTenantId_:function(){var e=this.getOption("platform_services");if(i.is(this._currentTenant)){var t=this._currentTenant;if(!i.is(this._currentTenantIdx)||e[this._currentTenantIdx].platformId!==t)for(var n=0;n<e.length&&!i.is(this._currentTenantIdx);n++)e[n].platformId===t&&(this._currentTenantIdx=n)}return i.is(this._currentTenantIdx)||(this._currentTenantIdx=0),this._currentTenantIdx},getCurrentTenantId:function(){var e=this.getOption("platform_services");if(i.is(this._currentTenant)){var t=this._currentTenant;if(!i.is(this._currentTenantIdx)||e[this._currentTenantIdx].platformId!==t)for(var n=0;n<e.length;n++)e[n].platformId===t&&(this._currentTenantIdx=n)}return i.is(this._currentTenantIdx)||(this._currentTenantIdx=0),this._currentTenantIdx},getTenantsPreference:function(e){var t=this,n=[],s=this.getOption("user_granted_roles"),o=!1,a=[],r=this.getOption("platform_services");if("ODT_MODE"===r)return["OnPremise"];if(!i.is(r,"array"))throw new Error("Platform services not initialize yet");if("string"==typeof s)try{s=JSON.parse(s)}catch(e){console.log(e)}for(var l=0;l<s.length;l++)"CSV"===s[l].id&&s[l].platforms&&(a=s[l].platforms),"InternalDS"===s[l].id&&(o=!0);return this.getOption("csvTenants")||this.setOption("csvTenants",a),r.forEach(function(e){t.isWebInWin()?n.push({label:e.displayName,value:e.platformId}):(-1!==a.indexOf(e.platformId)||o)&&n.push({label:e.displayName,value:e.platformId})}),n},getSecurityContext:function(){var e=this;return new s(function(t,i){if(e.getOption("Map_SecurityContext"))t(e.getOption("Map_SecurityContext"));else{var n=e.get3DSpaceUrl()+"/resources/pno/person/getsecuritycontext?tenant="+e.getCurrentTenantName();o.authenticatedRequest(n,{headers:{Accept:"application/json","Content-Type":"application/json"},method:"GET",onComplete:function(i){var n=JSON.parse(i);if(n&&n.SecurityContext){var s=n.SecurityContext,o="";0!==s.indexOf("ctx::")&&(o="ctx::"),s=o+s,e.setOption("Map_SecurityContext",s),t(s)}},onFailure:function(e){console.log(e),e.type="generic",i(e)},onTimeout:function(e){console.log(e),e.type="timeout",i(e)}})}})},getAllSecurityContextsUrl:function(){if(!i.is(this.getOption("platform_services"),"array")&&"ODT_MODE"!==this.getOption("platform_services"))throw new Error("Platform services not initialize yet");return this.get3DSpaceUrl()+"/resources/modeler/pno/person?current=true&select=preferredcredentials&select=collabspaces&tenant="+this.getCurrentTenantName()},getAllSecurityContexts:function(){var e=this;return new s(function(t,i){e.getOption("Map_AllSecurityContexts")?t(e.getOption("Map_AllSecurityContexts")):o.authenticatedRequest(e.getAllSecurityContextsUrl(),{headers:{Accept:"application/json","Content-Type":"application/json"},method:"GET",type:"json",proxy:"passport",onComplete:function(i){if(null!==i){var n=l.getSecurityContext(i);e.setOption("Map_AllSecurityContexts",n),t(n)}},onFailure:function(e){i(e)}})})},getUserID:function(){return"ODT_MODE"===this.getOption("platform_services")?"TEST_USER":(t=this.getOption("userId"))&&""!==t?t:t=null!=(e=a.getUser())&&void 0!==e.login?a.getUser().login:"";var e,t},getLabelAPI:function(){return this.getAppId()+"-"+this.getUserID()+"-"+Date.now()},getXPrefCredential:function(){return 0!==this._xPrefCredential.indexOf("ctx::")&&(this._xPrefCredential="ctx::"+this._xPrefCredential),this._xPrefCredential},setXPrefCredential:function(e){this._xPrefCredential=e},isWebInWin:function(){var e=!1;return this.getOption("iswebinwin")&&(e=!0),e},appInitializationPromised:function(e,t){var i=this,n=new s(function(t,n){e?(i.setOption("platform_services",e.platform_services),i.setMyAppsUrl(),e.noautomode&&i.setOption("noautomode",!0),e.userId?i.setOption("userId",e.userId):i.setOption("userId",""),t()):r.getPlatformServices({onComplete:function(e){i.setOption("platform_services",e),t()},onFailure:function(e){n(e),console.error(e)}})}),o=new s(function(t,n){e?(i.setOption("user_granted_roles",e.user_granted_roles),t()):r.getGrantedRoles(function(e){i._checkRoles(e)?(i.setOption("user_granted_roles",e),t()):n({errType:"NoValidRoles"})})});return new s(function(a,r){s.all([n,o]).then(function(){t&&(i._currentTenant=t);var n=i.getTenantsPreference(e);e?!i._currentTenant&&n[0]&&(i._currentTenant=n[0].value):(i._currentTenant||(i._currentTenant=i._isValidTenant(widget.getValue("x3dPlatformId"))||i._isValidTenant(i._defaultTenant)||i._getDefaultTenant()),i._checkRolesOnTenant(i.getOption("user_granted_roles"),i._currentTenant)?"ENORIPE_AP"===widget.getValue("appId")&&i._updateWidgetPref():r({showMsg:!0,msg:h.get("NoValidRolesOnTenant")}));i.setDefaultAttributesInit(),a()},function(e){"NoValidRoles"===e.errType&&r({showMsg:!0,msg:h.get("NoValidRoles")})})})},_checkRoles:function(e){for(var t=!1,i=0;i<e.length;i++)"CSV"!==e[i].id&&"InternalDS"!==e[i].id||(t=!0);return t},_checkRolesOnTenant:function(e,t){if(null==t)return!1;for(var i=0;i<e.length;i++){if("InternalDS"===e[i].id)return!0;if("CSV"===e[i].id)for(var n=e[i].platforms,s=0;s<n.length;s++)if(n[s]===t)return!0}return!1},_isValidTenant:function(e){var t=!1,i=this.getOption("platform_services");if(e&&i&&i.length)for(var n=0;n<i.length;n++)if(i[n].platformId&&i[n].platformId===e){i[n].hasOwnProperty("3DSpace")&&(t=!0);break}return!0===t&&e},_getDefaultTenant:function(){var e=this.getOption("platform_services"),t="";if(e&&e.length)for(var i=0;i<e.length;i++)if(e[i].hasOwnProperty("platformId")&&e[i].hasOwnProperty("3DSpace")){t=e[i].platformId;break}return t},_updateWidgetPref:function(){if(!this.isWebInWin()){var e=this.getTenantsPreference(),t={name:"selected_tenant",type:"list",label:h.get("tentantPreferenceLabel"),defaultValue:this._currentTenant,options:e};e.length<2&&(t.disabled=!0),widget.addPreference(t)}},setCurrentTenant:function(e){this._currentTenant=e},setDefaultTenant:function(e){this._defaultTenant=e},_updateSettingsFromURLParameters:function(e){for(var t=e.split("&"),i={},n=0;n<t.length;n++){var s=t[n].split("=");1===s.length&&""!==s[0]?i[s[0]]=!0:2===s.length&&s[0].length>0&&(i[s[0]]=s[1])}this.setOptions(i)},getTimeout:function(){var e=this.getOption("timeout");return Math.min(e,18e4)},getnav_history:function(){return this.getOption("nav_history")},getUniqueId:function(){return(Date.now()+Math.random()).toString().replace(".","").substr(0,35)},getValuesInPref:function(e){var t;if(e&&(t=widget?widget.getValue(e):localStorage.getItem(e)))try{return JSON.parse(t)}catch{return t}},saveValuesInPref:function(e,t){e&&(e+="-ENORIPE_AP"),t=JSON.stringify(t),e&&t&&(widget?widget.setValue(e,t):localStorage.setItem(e,t))}});return u}),define("DS/SNNavigationMap/utils/MapFileUtils",["UWA/Class","DS/SNNavigationMap/MapSettings","DS/Notifications/NotificationsManagerUXMessages","DS/Notifications/NotificationsManagerViewOnScreen","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_internal"],function(e,t,i,n,s){return e.extend({init:function(e){this.spinner=e.spinner,this.notifManager=i,n.setNotificationManager(this.notifManager)},handleDownload:function(e,i){this._showSpinner();var n=this,o={tenant:t.getPlatformId(),tenantUrl:t.get3DSpaceUrl(),autoDownload:!0,onComplete:function(e){n._hideSpinner()},onFailure:function(){n._showNotif({level:"error",msg:s.get("DownloadFailure")}),n._hideSpinner()}};require(["DS/DocumentManagement/DocumentManagement","DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext"],function(i,a){if(a){var r=a.get();r&&r.change&&""!==r.change.id&&(o.additionalHeaders={"DS-Change-Authoring-Context":"pid:"+r.change.id})}t.getSecurityContext().then(function(t){o.securityContext=t,i.downloadDocument(e,void 0,!1,o)},function(e){var t={level:"error",msg:s.get(e.type)};n._showNotif(t),n._hideSpinner()})},function(){n._hideSpinner(),console.log("DocumentManagementAMD not found")})},_showNotif:function(e){this.notifManager.addNotif({level:e.level,message:e.msg,sticky:!1})},_hideSpinner:function(){this.spinner&&this.spinner.hide()},_showSpinner:function(){this.spinner&&this.spinner.show()},getFileType:function(){}})}),define("DS/SNNavigationMap/utils/SNNavigationServices",["UWA/Core","UWA/Class/View","DS/SNNavigationMap/MapSettings","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_internal"],function(e,t,i,n){"use strict";return{isWebInWin:function(){var e="undefined"!=typeof dscef||"undefined"!=typeof CATCefSendString,t=void 0!==i.getAddinMode();return e&&!t},sendToMapWebInWin:function(e,t,i){var n=!1;if(this.isWebInWin()){n=!0;var s={action:"string"==typeof i?i:"",id:Array.isArray(t)?t:[t]};this.sendStringRelationsToWebInWin(e,JSON.stringify(s))}return n},sendStringRelationsToWebInWin:function(t,i){if("undefined"!=typeof dscef)dscef.sendString(t+"="+i);else if("undefined"!=typeof CATCefSendString)CATCefSendString(t+"="+i);else{var n=e.createElement("textarea",{name:t,text:i}),s=e.createElement("form",{method:"POST",action:"jsnotif://"}).inject(n);document.documentElement.appendChild(s),n.inject(document.documentElement),s.submit(),s.parentNode.removeChild(s),s=null}},ComputeContextualMenu:function(e,t){var i=[];if(null!=t&&void 0!==t&&!Number.isNaN(t)){var n=JSON.parse(t.actions),s=this._parseContextualMenu(e,n.actions);i=1==s.length?s[0]:this._menusIntersection(n.actions,s)}return i},_parseContextualMenu:function(e,t){for(var i=[],n=t.length,s=0;s<n;s++)i[s]=this._getActionsForOneObject(e,t[s],t[s].actions,"");return i},_getActionsForOneObject:function(e,t,i,n){for(var s=[],o=i.length,a=0;a<o;a++)s[a]=this._getOneActionForOneObject(e,t,i[a],n);return s},_getOneActionForOneObject:function(e,t,i,n){var s;if(null==i.items||void 0===i.items||Number.isNaN(i.items)){s={text:i.title,icon:i.image,multisel:i.multisel},void 0!==i.availabilityMode&&(s.availabilityMode=i.availabilityMode),void 0!==i.id&&(s.actionId=i.id,s.id=i.id,s.data=i.id),void 0!==i.accelerator&&(s.accelerator=i.accelerator),null==i.disabled||void 0===i.disabled||Number.isNaN(i.disabled)||(s.disabled=i.disabled),s.handler=function(n){var s={action:i.id,id:[t.id]};e._onCtxMenuItem(s)},null==n||void 0===n||Number.isNaN(n)||(s.menu=n)}else s={text:i.title},void 0!==i.id&&null!==i.id&&(s.actionId=i.id),s.items=this._getActionsForOneObject(e,t,i.items,i.title);return s},_menusIntersection:function(e,t){var i=[],n=t.length;if(0===n)return i;i=t[0];for(var s=[],o=1;o<n;o++){for(var a=t[o],r=a.length,l=0;l<r;l++){for(var d=i.length,c=!1,h=0;h<d;h++)if(null!=a[l].actionId&&null!=a[l].actionId&&null!=i[h].actionId&&null!=i[h].actionId){if(a[l].actionId===i[h].actionId){c=!0;break}}else if((void 0===a[l].actionId&&void 0===i[h].actionId||null===a[l].actionId&&null===i[h].actionId)&&a[l].text===i[h].text){c=!0;break}!0===c&&s.push(a[l])}i=s,s=[]}return i}}}),define("DS/SNNavigationMap/utils/ProbesUtils",["UWA/Class","UWA/Class/Options","DS/WAFData/WAFData","DS/SNNavigationMap/MapSettings","DS/SNNavigationMap/utils/SNNavigationServices","DS/PADServices/utils/PADTrackerManager","text!DS/SNNavigationMap/assets/NavigationTrackerMetrics.json"],function(e,t,i,n,s,o,a){"use strict";return e.singleton(t,{options:{},PERFORMANCELABEL:"enoripe_",TIMELABEL:"ENORIPE-",init:function(e){},getTracker:function(e,t,i){let s,r={eventCategory:e,eventAction:t,tenant:n.getCurrentTenantName(),appID:n.getAppId(),widgetid:n.getWidgetId()};return i&&(i.tenant&&""!=i.tenant&&(r.tenant=i.tenant),i.appID&&""!=i.appID&&(r.appID=i.appID),i.widgetid&&""!=i.widgetid&&(r.widgetid=i.widgetid)),"performance"===e?s=o.getPADTracker(r,a):"usage"===e&&(s=o.getPADTracker(r)),s},trackUsage:function(e,t){if(s.isWebInWin()){let i={appId:n.getAppId(),category:"Usage",type:"",action:e,label:t,value:1};s.sendStringRelationsToWebInWin("AddUsageProbe",JSON.stringify(i))}else{var i=this.getTracker("usage",e);i&&(i.setEventData({eventLabel:t,eventValue:1}),i.trackPageEvent())}},trackPerformance:function(e,t,i){if(s.isWebInWin()){let e={stepName:t};s.sendStringRelationsToWebInWin("EndPerfoProbe",JSON.stringify(e))}else{var n=this.getStartTime(t),o=null,a={};(o=this.getTracker("performance",this.PERFORMANCELABEL+e))&&(n&&(a={Duration:Date.now()-n}),i&&(a={...a,...i}),o.addMultivaluedEventData(this.PERFORMANCELABEL+t,a),o.trackPageEvent(),this.stopTime(t))}},setStartTime:function(e){if(this.setOption(this.TIMELABEL+e+"-Start",Date.now()),s.isWebInWin()){let t={appId:n.getAppId(),category:"Performance",type:"",action:this.PERFORMANCELABEL+e,label:e+"_Duration",stepName:e};s.sendStringRelationsToWebInWin("StartPerfoProbe",JSON.stringify(t))}},getStartTime:function(e){return this.getOption(this.TIMELABEL+e+"-Start")},stopTime:function(e){this.setOption(this.TIMELABEL+e+"-Start")}})}),define("DS/SNNavigationMap/views/CustomizeAttribute",["UWA/Core","UWA/Class","UWA/Class/View","DS/WAFData/WAFData","DS/SNNavigationMap/MapSettings","DS/SNNavigationMap/utils/ProbesUtils","DS/Handlebars/Handlebars4","DS/Windows/Dialog","DS/Windows/ImmersiveFrame","DS/Controls/Button","DS/Controls/ComboBox","DS/Controls/TooltipModel","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/Tree/TreeListView","DS/DataGridView/DataGridView","DS/DataGridView/DataGridViewLayout","DS/UIKIT/Iconbar","DS/UIKIT/Mask","DS/UIKIT/Autocomplete","DS/UIKIT/Tooltip","DS/UIKIT/Alert","DS/FedDictionaryAccess/FedDictionaryAccessAPI","text!DS/SNNavigationMap/assets/templates/customizeAttribute.html","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_internal"],function(e,t,i,n,s,o,a,r,l,d,c,h,u,g,p,m,f,v,_,N,S,b,w,E,I){"use strict";return i.extend({name:"CustomizeAttribute",_dialog:null,_attributesModel:[],_typesModified:[],className:function(){return this.getClassNames("-container")},setup:function(e){var t=a.compile(E);this.mainTemplateHtml=t.call(null,{typeNls:I.get("CustomizeAttr-Type"),selExtNls:I.get("CustomizeAttr-selExtNls")}),this._immersiveFrame=new l,this._immersiveFrame.inject(this.container),this.dimensions={},this.dimensions.position={},this.dimensions.position.offsetX=0,this.dimensions.position.offsetY=50,this.dimensions.dialogWidth=540,this.dimensions.dialogHeight=520,this.firstLaunch=!0,e.iswebinwin&&w.setConfigForMyApps({myAppsBaseUrl:s.getMyAppsUrl(),userId:s.getUserID(),lang:s.getLang()})},render:function(e){this.defaults=e.defaults||{};var t=this._getDialogContent(e);this._createDialog(t),this._immersiveFrame.elements.container.setStyle("z-index",300),this.show()},_createDialog:function(e){this._dialog=new r({title:I.get("CustomizeAttribute-Title"),content:e,immersiveFrame:this._immersiveFrame,expandedFlag:!1,width:this.dimensions.dialogWidth,height:this.dimensions.dialogHeight,minWidth:540,minHeight:210,maxWidth:600,resizableFlag:!0,activateButtonsIfActionPerformed:!1,position:{at:"top left",my:"top left"},buttons:{Cancel:new d({label:I.get("CustomizeAttribute-Cancel"),allowUnsafeHTMLContent:!1,onClick:this._cancelClick.bind(this)}),Save:new d({label:I.get("Apply"),allowUnsafeHTMLContent:!1,onClick:this._okClick.bind(this)}),Reset:new d({label:I.get("Reset"),allowUnsafeHTMLContent:!1,onClick:this._resetClick.bind(this)})}}),this._dialog.addEventListener("close",this._cancelClick.bind(this)),this._dialog.defaultButton=null,this._adjustDialogDimensions(),this._disableEnableOkBtn(),this._dialog.buttons.Save.disabled=!0},_setUpToolBar:function(e){var t=this,i=[{fonticon:"search",text:I.get("SearchAvailableAttrs"),handler:function(){t._handleSearch()}},{fonticon:"up",text:I.get("MoveUp"),handler:function(){t._handleMove("oneUp")}},{fonticon:"down",text:I.get("MoveDown"),handler:function(){t._handleMove("oneDown")}},{fonticon:"move-to-top",text:I.get("MoveTop"),handler:function(){t._handleMove("toTop")}},{fonticon:"move-to-bottom",text:I.get("MoveBottom"),handler:function(){t._handleMove("toBottom")}}];new v({renderTo:e,className:"customizeattr-arwcmd",items:i})},_setUpComboBox:function(e){var t=e.container;this.viewSelectorDoc=new u,this.viewSelectorDoc.addRoot(new g({label:I.get("TilesAndThumbnails"),grid:{value:"graphView"}})),this.viewSelectorDoc.addRoot(new g({label:I.get("DatagridColumns"),grid:{value:"dgvColumns"}}));var i=0;"dataGridView"===s.getLayoutType()&&(i=1);var n={elementsTree:this.viewSelectorDoc,nbDisplayedElements:this.viewSelectorDoc.getRoots().length,actionOnClickFlag:!1,selectedIndex:i,touchMode:!0,multiSelFlag:!1};this._viewSelectorCombobox=new c(n),this._viewSelectorCombobox.addEventListener("change",this._handleViewChange.bind(this)),this._viewSelectorCombobox.inject(t.getElement("#ENORipeCustomizeAttr-comboboxContainer"))},_setTreeView:function(e){this._setAttributeTree(e);var t=[{dataIndex:"tree",typeRepresentation:"string",text:I.get("CustomizeAttr-AttributesAvailable"),height:"auto",width:"auto",alwaysVisibleFlag:!0,editableFlag:!1,sortableFlag:!1}];this._attrDGV=new m({showRowIndexFlag:!1,showRowBorderFlag:!0,showColumnBorderFlag:!0,showSelectionCheckBoxesFlag:!0,rowSelection:"multiple",cellSelection:"none",useDragAndDrop:!1,selectionBehavior:{unselectAllOnEmptyArea:!0,toggle:!0,canMultiSelect:!0,enableShiftSelection:!0,enableFeedbackForActiveCell:!1,canInteractiveMultiselectWithCheckboxClick:!0},useAsyncPreExpand:!0,columns:t,treeDocument:this._attrTreeDocument}).inject(e.container.getElement("#ENORipeCustomizeAttr-MainTable"))},_setEvents:function(){this.getElement("#ENORipeCustomizeAttr-Movementctrlsright").addEventListener("click",this._addToSelectedAttributes.bind(this)),this.getElement("#ENORipeCustomizeAttr-Movementctrlsleft").addEventListener("click",this._removeFromSelectedAttributes.bind(this))},_onKeyUp:function(e){this._delayTimer&&clearTimeout(this._delayTimer);var t=this;this._delayTimer=setTimeout(function(){var i;i=(e.srcElement||e.target).value,t._performSearch(i)},500)},_resetClick:function(){var e=this._getSelectedView(),t=this._selectedAttrTreeDocumentCols,i=I.get("CustAttrResetDGV");this.defaults=JSON.parse(JSON.stringify(s.getJSONAttributes())),"graphView"===e&&(t=this._selectedAttrTreeDocument,i=I.get("CustAttrResetGraph")),t.prepareUpdate(),t.removeRoots(),t.pushUpdate(),"graphView"===e?this._addToSelectedAttrTreeDoc(this.defaults):this._addToSelectedAttrTreeDocCols(this.defaults),this._disableEnableOkBtn(),this.showNotif({message:i})},_okClick:function(){this._saveChangesInDefaults(),Object.keys(this.defaults).forEach(function(e){o.trackUsage("TypesCustomization","Typescustomization-"+e)}),this._destroyCurrentDialog(),this.dispatchEvent("ENORIPE_UpdateAttributes",[this.defaults])},_cancelClick:function(){this._destroyCurrentDialog()},_handleSearch:function(){this._srchAutocomplete.elements.container.toggleClassName("customize-hidden"),this.getElement(".ENORipeCustomizeAttr-TypeContainer").toggleClassName("customize-hidden")},_getMatchedNodesByTypeName:function(e,t,i){return e.search({match:function(e){if(e.nodeModel.options.grid.type===t&&e.nodeModel.options.grid.name===i)return!0}})},_setSearchAutoComplete:function(e){this._srchAutocomplete=new N({noResultsMessage:!1,placeholder:I.get("CustomizeAttr-SearchTextInvite"),events:{onKeyUp:this._onKeyUp.bind(this)}}).inject(e,"after"),this._srchAutocomplete.elements.container.addClassName("customizeattr-search-autocomplete customize-hidden"),this._srchAutocomplete.elements.clear.addEventListener("click",this._clearSearch.bind(this))},_clearSearch:function(){this._attrTreeDocument.getAllDescendants().forEach(function(e){"attribute"===e.getAttributeValue("type")&&e.show()})},_performSearch:function(e){this.addLoader(),this._clearSearch(),0!==e.length?(e=e.toLocaleLowerCase(),this._attrTreeDocument.getAllDescendants().forEach(function(t){t.getLabel().toLocaleLowerCase().search(e)>-1?(t.show(),t.getParent()&&t.getParent().expand()):"attribute"===t.getAttributeValue("type")&&t.hide()}),this.removeLoader()):this.removeLoader()},_setSelectedTreeView:function(e){this._setSelectedAttributeTree(e);var t=[{dataIndex:"tree",text:I.get("CustomizeAttr-AttributesSelected"),height:"auto",width:"auto",editableFlag:!1,sortableFlag:!1}];this._selectedAttrDGV=new m({showRowIndexFlag:!1,showRowBorderFlag:!0,showColumnBorderFlag:!0,showSelectionCheckBoxesFlag:!0,rowSelection:"multiple",cellSelection:"none",useDragAndDrop:!1,selectionBehavior:{unselectAllOnEmptyArea:!0,toggle:!0,canMultiSelect:!0,enableShiftSelection:!0,enableFeedbackForActiveCell:!1,canInteractiveMultiselectWithCheckboxClick:!0},columns:t,treeDocument:this._selectedAttrTreeDocument}).inject(e.container.getElement("#ENORipeCustomizeAttr-SelectedTable"))},_setSelectedTreeViewColumns:function(e){this._setSelectedAttributeTreeCols(e);var t=[{dataIndex:"tree",text:I.get("CustomizeAttr-AttributesSelected"),height:"auto",width:"auto",editableFlag:!1,sortableFlag:!1}];this._selectedAttrDGVCols=new m({showRowIndexFlag:!1,showRowBorderFlag:!0,showColumnBorderFlag:!0,showSelectionCheckBoxesFlag:!0,rowSelection:"multiple",cellSelection:"none",useDragAndDrop:!0,selectionBehavior:{unselectAllOnEmptyArea:!0,toggle:!0,canMultiSelect:!0,enableShiftSelection:!0,enableFeedbackForActiveCell:!1,canInteractiveMultiselectWithCheckboxClick:!0},columns:t,treeDocument:this._selectedAttrTreeDocumentCols}).inject(e.container.getElement("#ENORipeCustomizeAttr-SelectedTable")),"graphView"===this._getSelectedView()?this._selectedAttrDGVCols.hide():this._selectedAttrDGV.hide()},_addToSelectedAttributes:function(){var e=this._attrTreeDocument.getSelectedNodes(),t=this._getSelectedView();"graphView"===t?this._selectedAttrTreeDocument.prepareUpdate():this._selectedAttrTreeDocumentCols.prepareUpdate();for(var i=0;i<e.length;i++)if("attribute"===e[i].options.grid.type){if(this._isAlreadyAdded(e[i]))continue;var n,s=e[i].getParents(),o=new g({label:e[i].options.label,grid:e[i].options.grid});if("dgvColumns"===t){this._selectedAttrTreeDocumentCols.addRoot(o);continue}for(var a=0;a<s.length;a++)if("ParentType"===s[a].options.grid.type){n=s[a];break}var r=this._getMatchedNodesByTypeName(this._selectedAttrTreeDocument,n.options.grid.type,n.options.grid.name);if(r.length>0){0===this._getMatchedNodesByTypeName(this._selectedAttrTreeDocument,e[i].options.grid.type,e[i].options.grid.name).length&&(r[0].addChild(o),r[0].expand())}else{var l=new g({label:n.options.label,grid:n.options.grid});l.addChild(o),this._selectedAttrTreeDocument.addRoot(l),l.expand()}}"graphView"===t?this._selectedAttrTreeDocument.pushUpdate():this._selectedAttrTreeDocumentCols.pushUpdate(),this._disableEnableOkBtn()},_removeFromSelectedAttributes:function(){var e;if("graphView"===this._getSelectedView()){this._selectedAttrTreeDocument.prepareUpdate(),e=this._selectedAttrTreeDocument.getSelectedNodes();for(var t=0;t<e.length;t++){var i=e[t].getParent();1===i.getAllDescendants().length?this._selectedAttrTreeDocument.removeRoot(i):i.removeChild(e[t])}this._selectedAttrTreeDocument.pushUpdate()}else{this._selectedAttrTreeDocumentCols.prepareUpdate(),e=this._selectedAttrTreeDocumentCols.getSelectedNodes();for(t=0;t<e.length;t++)this._selectedAttrTreeDocumentCols.removeRoot(e[t]);this._selectedAttrTreeDocumentCols.pushUpdate()}this._disableEnableOkBtn()},_setAttributeTree:function(e){var i,n,s=this,o=[];this._attrTreeDocument=new u({shouldBeSelected:function(e){var t=e.options.grid.type;return"MoreBtn"!==t&&"ParentType"!==t&&"extension"!==t}}),this._attrTreeDocument.prepareUpdate();for(var a=e.types,r=0;r<a.length;r++)i={label:a[r].nlsLabel,children:[],grid:{name:a[r].name,type:"ParentType",label:a[r].nlsLabel}},n=new g(i),this._attrTreeDocument.addRoot(n),o.push(a[r].name);i={label:I.get("Customize-More"),grid:{name:"MoreBtn",type:"MoreBtn",label:I.get("Customize-More")},children:[]},n=new g(i),this._attrTreeDocument.addRoot(n),this._attrTreeDocument.pushUpdate(),this._attrTreeDocument.onPreExpand(function(e){var i=e.target;if(i.hasChildren())i.preExpandDone();else if("MoreBtn"===i.options.grid.type)s._attrTreeDocument.removeRoot(i),s._getAndAddMoreTypes(o).then(function(){i.preExpandDone()});else{var n=s._getAndAddAttributes(i),a=s._getAndAddExtension(i);t.Promise.all([n,a]).then(function(){i.preExpandDone()})}})},_setSelectedAttributeTree:function(e){this._selectedAttrTreeDocument=new u({shouldAcceptDrop:function(e){return"middle"!==e.dropPosition},shouldBeSelected:function(e){return"ParentType"!==e.options.grid.type}}),this._addToSelectedAttrTreeDoc(e.defaults)},_addToSelectedAttrTreeDoc:function(e){for(var t in this._selectedAttrTreeDocument.prepareUpdate(),e)if(e.hasOwnProperty(t)){if("EnoripeColumns"===t)continue;var i=e[t],n={label:i.nlsLabel,grid:{name:i.name,type:"ParentType",label:i.nlsLabel},children:[]},s=new g(n);if(i.attributes)for(var o=0;o<i.attributes.length;o++){var a=i.attributes[o],r={label:a.label,grid:{name:a.uri,type:"attributes",label:a.label}};s.addChild(new g(r))}this._selectedAttrTreeDocument.addRoot(s)}this._selectedAttrTreeDocument.pushUpdate()},_setSelectedAttributeTreeCols:function(e){this._selectedAttrTreeDocumentCols=new u({shouldBeSelected:function(e){return"ds6w:label"!==e.options.grid.name}}),this._addToSelectedAttrTreeDocCols(e.defaults)},_addToSelectedAttrTreeDocCols:function(e){this._selectedAttrTreeDocumentCols.prepareUpdate();for(var t=e.EnoripeColumns.attributes,i=0;i<t.length;i++){var n=t[i],s={label:n.label,grid:{name:n.uri,type:"attributes",label:n.label,dataType:n.dataType}};this._selectedAttrTreeDocumentCols.addRoot(new g(s))}this._selectedAttrTreeDocumentCols.pushUpdate()},_handleMove:function(e){var t,i;if("graphView"===this._getSelectedView()){if(0===this._selectedAttrTreeDocument.getSelectedNodes().length)return;for(var n=this._selectedAttrTreeDocument.getRoots(),s=0;s<n.length;s++){i=(t=n[s]).getChildren();for(var o=0;o<i.length;o++)if(i[o].isSelected()){switch(e){case"oneUp":this._moveOneUp(t,i,this._selectedAttrTreeDocument);break;case"oneDown":this._moveOneDown(t,i,this._selectedAttrTreeDocument);break;case"toTop":this._moveToTop(t,i,this._selectedAttrTreeDocument);break;case"toBottom":this._moveToBottom(t,i,this._selectedAttrTreeDocument)}break}}}else{if(0===this._selectedAttrTreeDocumentCols.getSelectedNodes().length)return;switch(i=(t=this._selectedAttrTreeDocumentCols).getChildren(),e){case"oneUp":this._moveOneUp(t,i,this._selectedAttrTreeDocumentCols,!0);break;case"oneDown":this._moveOneDown(t,i,this._selectedAttrTreeDocumentCols,!0);break;case"toTop":this._moveToTop(t,i,this._selectedAttrTreeDocumentCols,!0);break;case"toBottom":this._moveToBottom(t,i,this._selectedAttrTreeDocumentCols,!0)}}this._disableEnableOkBtn()},_moveOneUp:function(e,t,i,n){for(var s=0,o=[];s<t.length&&t[s].isSelected();)t[s].options.grid.isSequence=!0,s++;for(var a=0;a<t.length;a++)t[a].isSelected()&&(o.push(t[a]),!0!==t[a].options.grid.isSequence&&(t[a].options.grid.moveToIndex=a-1));i.prepareUpdate();for(var r=0;r<t.length;r++)if(t[r].isSelected()&&void 0!==t[r].options.grid.moveToIndex){var l;if(n){if("ds6w:label"===(l=e.getNthRoot(t[r].options.grid.moveToIndex)).getAttributeValue("name"))continue}else l=e.getNthChild(t[r].options.grid.moveToIndex);e.insertBefore(t[r],l)}i.pushUpdate(),this._persistSelection(o),this._resetSequencing(i)},_moveOneDown:function(e,t,i,n){for(var s=[],o=t.length-1;o>-1&&t[o].isSelected();)t[o].options.grid.isSequence=!0,o--;for(var a=0;a<t.length;a++)t[a].isSelected()&&(s.push(t[a]),a!==t.length-1&&!0!==t[a].options.grid.isSequence&&(t[a].options.grid.moveToIndex=a+2));i.prepareUpdate();for(var r=t.length-1;r>-1;r--)if(void 0!==t[r].options.grid.moveToIndex){var l;if(t[r].options.grid.moveToIndex===t.length)e.insertBefore(t[r]);else l=n?e.getNthRoot(t[r].options.grid.moveToIndex):e.getNthChild(t[r].options.grid.moveToIndex),e.insertBefore(t[r],l);t[r].options.grid.moveToIndex=void 0}i.pushUpdate(),this._persistSelection(s),this._resetSequencing(i)},_moveToTop:function(e,t,i,n){for(var s=[],o=0;o<t.length&&t[o].isSelected();)t[o].options.grid.isSequence=!0,o++;var a=0;n&&(a=1);for(var r=0;r<t.length;r++)t[r].isSelected()&&(s.push(t[r]),!0!==t[r].options.grid.isSequence&&(t[r].options.grid.moveToIndex=a),a++);i.prepareUpdate();for(var l=0;l<t.length;l++)if(t[l].isSelected()&&void 0!==t[l].options.grid.moveToIndex){var d;if(n){if("ds6w:label"===(d=e.getNthRoot(t[l].options.grid.moveToIndex)).getAttributeValue("name"))continue}else d=e.getNthChild(t[l].options.grid.moveToIndex);t[l]!==d&&e.insertBefore(t[l],d)}i.pushUpdate(),this._persistSelection(s),this._resetSequencing(i)},_moveToBottom:function(e,t,i,n){for(var s=[],o=t.length-1;o>-1&&t[o].isSelected();)t[o].options.grid.isSequence=!0,o--;for(var a=t.length,r=t.length-1;r>=0;r--)t[r].isSelected()&&(s.push(t[r]),r!==t.length-1&&!0!==t[r].options.grid.isSequence&&(t[r].options.grid.moveToIndex=a),a--);i.prepareUpdate();for(var l=t.length-1;l>-1;l--)if(void 0!==t[l].options.grid.moveToIndex){var d;if(t[l].options.grid.moveToIndex===t.length)e.insertBefore(t[l]);else d=n?e.getNthRoot(t[l].options.grid.moveToIndex):e.getNthChild(t[l].options.grid.moveToIndex),e.insertBefore(t[l],d);t[l].options.grid.moveToIndex=void 0}i.pushUpdate(),this._persistSelection(s),this._resetSequencing(i)},_getAndAddExtension:function(e){var i=this,n=e.options.grid.name;return new t.Promise(function(t,s){"AllTypes"!==n&&"extension"!==e.options.grid.type?i._getDataSet(n).then(function(n){i._parseAndAddDataSet(n,e),t()},function(e){console.log(e),t("extensionFetch-err")}):t()})},_getDataSet:function(e){return new t.Promise(function(t,i){var n=s.getCurrentTenantName(),o=s.getLang();w.getExtensionsForClass(e,{tenantId:n,lang:o,apiVersion:"R2019x",onComplete:t,onFailure:function(e){i(e)}})})},_parseAndAddDataSet:function(e,t){var i=[];if(e&&e.extensions&&e.extensions.length>0&&(e.extensions.sort(function(e,t){return e.label.toUpperCase()<t.label.toUpperCase()?-1:e.label.toUpperCase()>t.label.toUpperCase()?1:0}),e.extensions.forEach(function(e){i.push({name:e.curi,value:e.label})})),i.length>0){var n,s;t.options.grid.name;t.prepareUpdate();for(var o=0;o<i.length;o++)n={label:i[o].value,grid:{name:i[o].name,type:"extension",label:i[o].value},children:[]},s=new g(n),t.addChild(s);t.pushUpdate()}},_getAndAddAttributes:function(e){var i=this,n=e.options.grid.name,s="ds6wg:";return"AllTypes"===n?s+="PLMEntity":n.contains("ds6wg:")?s=n:s+=n,new t.Promise(function(t,n){i._getAttrPredicates(s).then(function(n){i._processAndUpdateAttributes(n,s,e),t()},function(e){console.log(e),n()})})},_getAttrPredicates:function(e){return new t.Promise(function(t,i){w.getPropertiesForClass(e,{tenantId:s.getCurrentTenantName(),lang:s.getLang(),apiVersion:"R2019x",onComplete:function(e){t(e)},onFailure:function(e){i(e)}})})},_processAndUpdateAttributes:function(e,t,i){var n,s;if(e&&e.length>0){i.prepareUpdate();for(var o=e[0].properties,a=0;a<o.length;a++){var r=o[a].dataType;n={label:o[a].label,grid:{name:o[a].curi,typeUri:t,label:o[a].label,type:"attribute",dataType:r.slice(r.lastIndexOf("#")+1)}},s=new g(n),i.addChild(s)}i.pushUpdate()}},_getMoreTypes:function(){return new t.Promise(function(e,t){w.getVocabularyClasses("ds6wg",{tenantId:s.getCurrentTenantName(),lang:s.getLang(),apiVersion:"R2019x",onComplete:function(t){e(t)},onFailure:function(e){t(e)}})})},_getAndAddMoreTypes:function(e){var i=this;function n(e,t){var i=e.label.toUpperCase(),n=t.label.toUpperCase(),s=0;return i>n?s=1:i<n&&(s=-1),s}return new t.Promise(function(t,s){i._getMoreTypes().then(function(s){if(i._attrTreeDocument.prepareUpdate(),s.classes&&s.classes.length){s.classes.sort(n);for(var o=0;o<s.classes.length;o++)if(-1===e.indexOf(s.classes[o].curi.replace("ds6wg:",""))){var a=s.classes[o],r={label:a.label,grid:{name:a.curi,type:"ParentType",label:a.label},children:[]},l=new g(r);i._attrTreeDocument.addRoot(l)}i._attrTreeDocument.pushUpdate(),t()}})})},_getSelectedAttributes:function(){var e=[];return"graphView"===this._getSelectedView()?this._selectedAttrTreeDocument.getRoots().forEach(function(t){e=e.concat(t.getAllDescendants())}):e=e.concat(this._selectedAttrTreeDocumentCols.getAllDescendants()),e},_disableEnableOkBtn:function(){this._getSelectedAttributes().length>2?this._dialog.buttons.Save.disabled=!1:this._dialog.buttons.Save.disabled=!0},_getDialogContent:function(t){var i=e.createElement("div",{class:"ENORipeCustomizeAttr-Main",html:this.mainTemplateHtml}),n={types:t.types||[],container:i,selectedIndex:t.selectedIndex};return t.container=i,this._setUpComboBox(n),this._setSearchAutoComplete(i.getElement(".ENORipeCustomizeAttr-TypeContainer")),this._setUpToolBar(i.getElement(".ENORipeCustomizeAttr-ToolBar")),this._setTreeView(t),this._setSelectedTreeView(t),this._setSelectedTreeViewColumns(t),i},_isAlreadyAdded:function(e){var t;if("dgvColumns"===this._getSelectedView()){t=this._selectedAttrTreeDocumentCols.getAllDescendants();for(var i=0;i<t.length;i++)if(t[i].getAttributeValue("name")===e.getAttributeValue("name"))return!0}else for(var n=e.getParent().getAttributeValue("name"),s=this._selectedAttrTreeDocument.getRoots(),o=0;o<s.length;o++)if(s[o].getAttributeValue("name")===n){t=s[o].getAllDescendants();for(i=0;i<t.length;i++)if(t[i].getAttributeValue("name")===e.getAttributeValue("name"))return!0;break}return!1},_handleViewChange:function(){"graphView"===this._getSelectedView()?(this._selectedAttrDGV.show(),this._selectedAttrDGVCols.hide()):(this._selectedAttrDGVCols.show(),this._selectedAttrDGV.hide())},_getSelectedView:function(){return this.viewSelectorDoc.getRoots()[this._viewSelectorCombobox.selectedIndex].options.grid.value},_persistSelection:function(e){e.forEach(function(e){e.select()})},_resetSequencing:function(e){e.getAllDescendants().forEach(function(e){e.options.grid.isSequence=!1,e.options.grid.moveToIndex=void 0})},_saveChangesInDefaults:function(){for(var e=this._selectedAttrTreeDocument.getRoots(),t=this._selectedAttrTreeDocumentCols.getRoots(),i=0;i<e.length;i++){var n=e[i].getAllDescendants(),s=[];n.forEach(function(e){s.push({uri:e.options.grid.name,label:e.getLabel()})}),this.defaults[e[i].options.grid.name]={name:e[i].options.grid.name,nlsLabel:e[i].getLabel(),attributes:s}}var o=[];for(i=0;i<t.length;i++)o.push({uri:t[i].options.grid.name,label:t[i].getLabel(),dataType:t[i].options.grid.dataType});this.defaults.EnoripeColumns.attributes=o},_adjustDialogDimensions:function(){var e=!1;this._dialog.position.offsetX=this.dimensions.position.offsetX,this._dialog.position.offsetY=this.dimensions.position.offsetY;var t=window.innerHeight-140;if(this.firstLaunch)if(this.firstLaunch=!1,this._dialog.elements._contentDiv.clientHeight<this._dialog.elements._contentDiv.scrollHeight){var i=this._dialog.elements._contentDiv.scrollHeight-this._dialog.elements._contentDiv.clientHeight,n=this._dialog.height+i;n>t&&(n=t),this._dialog.position.offsetY>50&&(this._dialog.position.offsetY=50),this._dialog.height=n}else e=!0;else e=!0;e&&(this._dialog.height>t&&(this._dialog.height=t),this._dialog.position.offsetY>50&&(this._dialog.position.offsetY=50)),this.dimensions.dialogHeight=this._dialog.height,this.dimensions.position.offsetY=this._dialog.position.offsetY,this._dialog._applyPosition(),this._dialog._applyHeight(),this._dialog._applyWidth(),this._setEvents()},showNotif:function(e){this.alert&&this.alert.destroy();var t=e.container||this._dialog.elements.container;this.alert=new b({visible:!0,autoHide:!0,hideDelay:3e3,animate:!0}).inject(t),this.alert.add({className:e.lvl?e.lvl:"primary",message:e.message})},addLoader:function(e){e?_.mask(e):_.mask(this._dialog.content)},removeLoader:function(e){e?_.unmask(e):_.unmask(this._dialog.content)},_destroyCurrentDialog:function(){this._immersiveFrame.elements.container.setStyle("z-index",0),this.dimensions.dialogWidth=this._dialog.width,this.dimensions.dialogHeight=this._dialog.height,this.dimensions.position=this._dialog.position,this._dialog.destroy(),this._dialog=null,this._typesModified=[],this._attrTreeDocument=null,this._attrDGV=null,this._typeCombobox=null,this.typeTreeDocument=null,this.isMoreEvtSet=!1,this.hide()}})}),define("DS/SNNavigationMap/views/SelectionAssistantView",["UWA/Core","UWA/Class","UWA/Class/View","DS/Windows/Dialog","DS/Windows/ImmersiveFrame","DS/Controls/Button","DS/UIKIT/Input/Toggle","DS/SNNavigationMap/utils/ProbesUtils","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_internal"],function(e,t,i,n,s,o,a,r,l){"use strict";return i.extend({name:"SelectionAssistant",_dialog:null,className:function(){return this.getClassNames("-container")},setup:function(e){this._immersiveFrame=new s,this._immersiveFrame.inject(this.container),this.dimensions={},this.dimensions.position={},this.dimensions.position.offsetX=0,this.dimensions.position.offsetY=200,this.dimensions.dialogWidth=270,this.dimensions.dialogHeight=270,this.firstLaunch=!0},render:function(e){this._options=e;var t=this._getDialogContent();this._createDialog(t),this._immersiveFrame.elements.container.setStyle("z-index",300),this.show()},_createDialog:function(e){this._dialog=new n({title:l.get("SelectionAssistant-Title"),content:e,immersiveFrame:this._immersiveFrame,expandedFlag:!1,width:this.dimensions.dialogWidth,height:this.dimensions.dialogHeight,minWidth:200,minHeight:210,maxWidth:750,resizableFlag:!1,position:{at:"top center",my:"top center"},buttons:{Cancel:new o({label:l.get("SelectionAssistant-Cancel"),allowUnsafeHTMLContent:!1,onClick:this._cancelClick.bind(this)}),Save:new o({label:l.get("SelectionAssistant-OK"),allowUnsafeHTMLContent:!1,onClick:this._okClick.bind(this)})}}),this._dialog.addEventListener("close",this._cancelClick.bind(this)),this._isCheckBoxChecked()?this._dialog.buttons.Save.disabled=!1:this._dialog.buttons.Save.disabled=!0,this._adjustDialogDimensions()},_okClick:function(){var e=this,t=[];this.getElements("input").forEach(function(i){e._options.selOptions[i.value]=i.checked,i.checked&&t.push(i.value)}),this._destroyCurrentDialog(),r.trackUsage("SelectionAssistant","Options-"+t.join("_")),this.dispatchEvent("ENORIPE_UpdateSelection",[this._options])},_cancelClick:function(){this._destroyCurrentDialog()},_onCheckBoxClick:function(){var e=this._isCheckBoxChecked();this._dialog.buttons.Save.disabled=!e},_isCheckBoxChecked:function(){var e=this.getElements("input"),t=!1;return e.forEach(function(e){"checkbox"!==e.type||void 0===e.checked||!0!==e.checked||(t=!0)}),t},_getDialogContent:function(){var t=e.createElement("div",{class:"ENORipeSelAsst-Main"}),i=e.createElement("div",{class:"ENORipeSelAsst-SelOptions"}).inject(t),n=e.createElement("div",{class:"ENORipeSelAsst-CommonOptions"}).inject(t),s=new a({type:"checkbox",value:"SDP",className:"primary ENORIPE-SDP",events:{onClick:this._onCheckBoxClick.bind(this)},label:l.get("SelectionAssistant-SDP-Title")}).inject(i),o=new a({type:"checkbox",value:"SAP",className:"primary ENORIPE-SAP",events:{onClick:this._onCheckBoxClick.bind(this)},label:l.get("SelectionAssistant-SAP-Title")}).inject(i),r=new a({type:"checkbox",value:"SDS",className:"primary ENORIPE-SDS",events:{onClick:this._onCheckBoxClick.bind(this)},label:l.get("SelectionAssistant-SDS-Title")}).inject(i),d=new a({type:"checkbox",value:"SAS",className:"primary ENORIPE-SAS",events:{onClick:this._onCheckBoxClick.bind(this)},label:l.get("SelectionAssistant-SAS-Title")}).inject(i),c=new a({type:"switch",value:"CommonResults",className:"primary ENORIPE-SA-CommonResults",label:l.get("SelectionAssistant-CommonResults-Title")}).inject(n);return this._options&&this._options.selOptions&&(this._options.selOptions.SDP&&s.check(),this._options.selOptions.SAP&&o.check(),this._options.selOptions.SDS&&r.check(),this._options.selOptions.SAS&&d.check(),this._options.selOptions.CommonResults?c.check():this._options.disableCommon&&c.disable()),t},_adjustDialogDimensions:function(){this._dialog.position.offsetX=this.dimensions.position.offsetX,this._dialog.position.offsetY=this.dimensions.position.offsetY,this.dimensions.dialogHeight=this._dialog.height,this.dimensions.position.offsetY=this._dialog.position.offsetY,this._dialog._applyPosition(),this._dialog._applyHeight(),this._dialog._applyWidth()},_destroyCurrentDialog:function(){this._immersiveFrame.elements.container.setStyle("z-index",0),this.dimensions.dialogWidth=this._dialog.width,this.dimensions.dialogHeight=this._dialog.height,this.dimensions.position=this._dialog.position,this._dialog.destroy(),this._dialog=null,this.hide()}})}),define("DS/SNNavigationMap/views/CustomizeView",["UWA/Core","UWA/Class/View","DS/SNNavigationMap/MapSettings","DS/SNNavigationMap/utils/ProbesUtils","DS/Handlebars/Handlebars4","DS/WebappsUtils/WebappsUtils","DS/Windows/Dialog","DS/Windows/ImmersiveFrame","DS/Controls/Button","text!DS/SNNavigationMap/assets/templates/customize.html","text!DS/SNNavigationMap/assets/templates/displayPref.html","text!DS/SNNavigationMap/assets/templates/customizeGrouped.html","DS/Notifications/NotificationsManagerUXMessages","DS/UIKIT/Iconbar","DS/UIKIT/Autocomplete","DS/UIKIT/DropdownMenu","DS/Controls/ComboBox","DS/UIKIT/SuperModal","DS/UIKIT/Form","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_internal"],function(e,t,i,n,s,o,a,r,l,d,c,h,u,g,p,m,f,v,_,N,S,b){"use strict";return t.extend({name:"Customize",_dialog:null,className:function(){return this.getClassNames("-container")},setup:function(t){var i=e.clone(t,!1);i.settings&&(this._immersiveFrame=new r,this._immersiveFrame.inject(this.container),this._groupRelations=t.needTranslate||!1,this._template=s.compile(this._groupRelations?h:d),this._displayPrefTemplate=s.compile(c),this.currentProfile=t.currentProfile,this.dimensions={},this.dimensions.position={},this.dimensions.position.offsetX=0,this.dimensions.position.offsetY=50,this.dimensions.dialogWidth=400,this.dimensions.dialogHeight=520,this.firstLaunch=!0,this._notifManager=u,this._thumbnails2d=t.thumbnails2d,this._recompute=t.recomputeLayout,this._autoNav=t.autoNav,this._templateContent={relations:this._translateRelations(i.settings),automaticNavigation:this._autoNav,notPresent:i.notPresentRelations,title:i.title,sectionName:b.get("relationsToShow"),moreName:b.get("Customize-More"),lessName:b.get("Customize-Less"),moreNls:b.get("Customize-MoreTitle"),lessNls:b.get("Customize-LessTitle"),expanderTitle:b.get("Customize-ExpanderTitle"),bodyText:this._getBodyText(t.currentProfile,i.settings)},this.dontHandleProfileChange=!1,this._initComboBox(t))},render:function(e){if(void 0===this._template||null===this._template)return null!==this._notifManager&&void 0!==this._notifManager||(this._notifManager=u),void this._notifManager.addNotif({level:"info",message:b.get("noProfile"),sticky:!1});if(null===this._dialog){var t=this._getDialogContent(e);this._createDialog(t)}this._handleDropDownCommands(),this._immersiveFrame.elements.container.setStyle("z-index",300),this.getElement("#relations-list")&&(this._relationsList=this.getElement("#relations-list")),this._previousProfile=this._getSelectedProfile().options.data.name},showRelation:function(e,t,i){this._templateContent.automaticNavigation=this._autoNav,this._templateContent.relations=this._translateRelations(e),this._autoNav&&i&&(this._templateContent.notPresent=i),this._templateContent.bodyText=this._getBodyText(this.currentProfile,e),t!==this._groupRelations&&(this._groupRelations=t,this._template=s.compile(this._groupRelations?h:d));var n=this._getProfileModel(this.currentProfile),o=b.get(this.currentProfile);n&&(o=n.getLabel()),this._templateContent.sectionName=b.get("relationsToShow")+o;var a=this._template.call(null,this._templateContent);this._dialog&&(this._dialog.elements.container.querySelector(".customize-bodycontent").innerHTML=a,this._setUpEvents(),t&&this._checkParentToggleState(this.container),this._handleDropDownCommands())},_createDialog:function(t){var i=this;this._dialog=new a({title:this._templateContent.title,content:t,immersiveFrame:this._immersiveFrame,expandedFlag:!1,width:this.dimensions.dialogWidth,height:this.dimensions.dialogHeight,minWidth:160,minHeight:210,resizableFlag:!0,position:{at:"top left",my:"top left"},buttons:{Cancel:new l({label:b.get("SNNCustomize_Cancel"),onClick:this._cancelClick.bind(this)}),Save:new l({label:b.get("SNNCustomize_Save"),onClick:this._okClick.bind(this)})}});var n={target:this.getElement(".Customize_RelationSet").getChildren()[0],closeOnClick:!0,className:"customize-dropdownmenu"};n.items=[{id:"customize-saverelationset",text:b.get("Customize_SaveRelationSet"),className:"customize-hidden customize-item",handler:function(){i._onSaveClick()}},{id:"customize-deleterelationset",text:b.get("Customize_DeleteRelationSet"),className:"customize-hidden customize-item",handler:function(){i._onDeleteClick()}},{id:"customize-createrelationset",text:b.get("Customize_CreateRelationSet"),className:"customize-item",handler:function(){i._onCreateClick()}}],this.relationSetMenu=new m(n),this.relationSetMenu.addEvent("onShow",function(){i.isCustomProfileSet()&&i._showHideDropDownCommands("customize-deleterelationset",!0),i._handleDropDownCommands()}),this._dialog.buttons.Save.elements.button.title=b.get("SNNCustomize_Save"),this._dialog.buttons.Cancel.elements.button.title=b.get("SNNCustomize_Cancel"),e.createElement("span",{class:"navigation-dialog-resize fonticon fonticon-resize-full"}).inject(this._dialog.elements._bottomLeftResizeHandler),this._dialog.addEventListener("close",this._cancelClick.bind(this)),this._dialog.elements._bottomLeftResizeHandler.addEventListener("touchstart",function(e){e.preventDefault()}),this._adjustDialogDimensions(),this._setUpEvents(),this._dialog.buttons.Save.disabled=!0},_setUpComboBox:function(e){this._profileCombobox&&this._profileCombobox.removeEventListener("change",this.handleProfileChange);var t={elementsTree:this.profileTreeDocument,nbDisplayedElements:this.profileTreeDocument.getRoots().length,enableSearchFlag:!0,actionOnClickFlag:!1,selectedIndex:e.selectedIndex,touchMode:!0};this._profileCombobox=new f(t),this._profileCombobox.addEventListener("change",this.handleProfileChange.bind(this))},_renderComboBox:function(){var t=e.createElement("div",{class:"comboBox-component",minWidth:150,title:b.get("SNNavigationMap.Profiles.Title")});return this.customizeProfileContainer=e.createElement("div",{class:"CustomizeProfile_Container item"}),this._setUpComboBox({selectedIndex:this._selectedIndex}),this._profileCombobox.inject(t),t.inject(this.customizeProfileContainer),this.customizeProfileContainer},_getBodyText:function(e,t){var i;if(this._autoNav){if(t&&Object.keys(t))i=this._isAbsentRelExpanded()?b.get("Customize_AllRelBodyText_More"):0===Object.keys(t).length?b.get("Customize-NoRelation"):b.get("Customize_AllRelBodyText_Less");return i}var n=this._getProfileModel(e),s=b.get(e);return n&&(s=n.getLabel()),s.contains(" Relations")&&(s=s.replace(" Relations","")),i=b.replace(b.get("Customize_BodyText"),{N:s})},_initComboBox:function(e){for(var t,i,n=this._getProfilesForComboBox(e.profileArray,e.recentProfiles),s=e.currentProfile||e.lastUsedProfile,o=160,a=-1,r=2,l=e.lang||null,d=0;d<n.length;d++)"custom"===n[d].type?(t=n[d].nls||b.get(n[d].name),b[n[d].name]=t):t=b.get(n[d].name),i=l&&"ja"===l?14:7,"AutoModeProfile"===n[d].name&&(r=d),o=o<t.length*i?t.length*i:o,null!==s&&""!==s&&void 0!==s&&(n[d].name===s&&"text"!==n[d].type&&(a=d),this._autoNav="AutoModeProfile"===s);-1===a&&(a=r),this.profileTreeDocument=new N({shouldBeSelected:function(e){return e.options.data.selectable}}),this.profileTreeDocument.prepareUpdate();for(var c=0;c<n.length;c++){var h={label:t="custom"===n[c].type?n[c].nls:b.get(n[c].name),data:{name:n[c].name,selectable:!1!==n[c].selectable}};n[c].comboBoxSemantics&&(h.comboBoxSemantics=n[c].comboBoxSemantics),"Recent"!==n[c].id&&"MyRelationSet"!==n[c].id||"text"===n[c].type&&(h.data.selectable=!1,h.comboBoxSemantics="section"),n[c].isRecent?h.icons=[{iconName:"clock"}]:"UserDefined"!==n[c].type&&"custom"!==n[c].type||(h.icons=[{iconName:"user"}]),n[c].type&&(h.data.type=n[c].type),n[c].isRecent&&(h.data.isRecent=!0);var u=new S(h);this.profileTreeDocument.addRoot(u)}this.profileTreeDocument.pushUpdate(),this.currentProfile=n[a].name,this._selectedIndex=a},_getProfilesForComboBox:function(e,t){var i=[],n=[{name:b.get("Recent"),id:"Recent",type:"text"}],s=[{name:b.get("MyRelationSet"),id:"MyRelationSet",type:"text"}],o=e.map(e=>e.name);t&&t.forEach(function(e){e.isRecent=!0,-1===o.indexOf(e.name)&&(e.comboBoxSemantics="customdisabled"),n.push(e)});for(var a=0;a<e.length;a++)"UserDefined"===e[a].type?s.push(e[a]):i.push(e[a]);return n.concat(s.concat(i))},_getDialogContent:function(t){var i=this;this._templateContent.sectionName=b.get("relationsToShow")+b.get(this.currentProfile),this._templateContent.automaticNavigation=this._autoNav,this._templateContent.autoNavLabel=b.get("autoNavLabel"),this._autoNav&&t&&t.settings&&t.notPresentRelations&&(this._templateContent.relations=t.settings,this._templateContent.notPresent=t.notPresentRelations),t&&t.settings&&(this._templateContent.bodyText=this._getBodyText(this.currentProfile,t.settings));var n=this._template.call(null,this._templateContent),s=(this._displayPrefTemplate.call(null,{thumbnails2DNls:b.get("thumbnails2DNls"),recumputeNls:b.get("recumputeNls"),ltrNls:b.get("ltrNls"),rtlNls:b.get("rtlNls"),tbNls:b.get("tbNls"),btNls:b.get("btNls"),graphOrientationNls:b.get("graphOrientationNls"),thumbnailsIcon:o.getWebappsAssetUrl("SNNavigationMap","icons/32/I_ExpandCollapseThumbnails.png"),thumbnailscbValue:this._thumbnails2d,recomputecbValue:this._recompute}),new e.createElement("div",{class:"customize-content",draggable:"false"})),a=new e.createElement("div",{class:"customize-headercontent",draggable:"false"}).inject(s);new e.createElement("div",{class:"customize-bodycontent",html:n,draggable:"false"}).inject(s);this._autocompleteInput=new p({noResultsMessage:!1,placeholder:b.get("Customize-SearchTextInvite"),events:{onKeyUp:i._onKeyUp.bind(i)}}).inject(a),this._renderComboBox().inject(a),this._autocompleteInput.elements.container.addClassName("customize-autocomplete customize-hidden"),this._autocompleteInput.elements.clear.addEventListener("click",this._clearSearch.bind(i));var r=[{fonticon:"search",text:b.get("Customize_SearchCommmand"),className:"Customize_SearchCommand",handler:function(){this.getItem(0).elements.container.toggleClassName("pressed"),i._autocompleteInput.elements.container.toggleClassName("customize-hidden"),i.customizeProfileContainer.toggleClassName("customize-hidden"),i._autocompleteInput.elements.container.hasClassName("customize-hidden")?(a.setStyle("justify-content","flex-end"),i._clearSearch()):a.setStyle("justify-content","space-between")}},{fonticon:"menu",text:b.get("Customize_RelationSet"),className:"Customize_RelationSet",handler:function(){}},{fonticon:"select-all",text:b.get("Customize__selectAll"),className:"Customize_multisel-icons",content:{type:"dropdownmenu",options:{items:[{fonticon:"select-all",text:b.get("Customize__selectAll"),className:"Customize__selectAll",selectable:!0,handler:function(){i._selectAll()}},{fonticon:"select-none",text:b.get("Customize_Un_selectAll"),className:"Customize_Un_selectAll",selectable:!0,handler:function(){i._clearAll()}}]}}}];new g({renderTo:a,className:"customize-toolbar",items:r});return this._groupRelations&&this._checkParentToggleState(s),s},_handleDropDownCommands:function(){this._isSaveRequired()?this._showHideDropDownCommands("customize-saverelationset",!0):this._showHideDropDownCommands("customize-saverelationset")},_showHideDropDownCommands:function(e,t){if(this.relationSetMenu){var i=this.relationSetMenu.getItem(e);i&&i.elements&&i.elements.container&&(t?i.elements.container.removeClassName("customize-hidden"):i.elements.container.addClassName("customize-hidden"))}},_onKeyUp:function(e){this._delayTimer&&clearTimeout(this._delayTimer);var t=this;this._delayTimer=setTimeout(function(){var i;i=(e.srcElement||e.target).value,t._performSearch(i)},500)},_onCreateClick:function(){var t=this,i=null,n=new v({className:"Customize-Relationsetmodal",animate:!0,events:{onHide:function(e){n.destroy()}}}),s={fields:[{type:"text",required:!0,pattern:"^[_ A-Za-z0-9]+$",value:"",placeholder:b.get("Customize_RelationSetCreation"),name:"inputval"}],events:{onSubmit:function(e){var s=!1;if((i=t.profileTreeDocument.getRoots())&&i.length)for(var o=0;o<i.length;o++)if(i[o]&&i[o].options&&i[o].options.data&&i[o].options.data.name===e.inputval&&"text"!==i[o].options.data.type){s=!0;break}s?!0===confirm(b.get("Customize-ExistingRelationSet"))&&(n.modals.current.hide(),t._createRelationSet(e.inputval)):(n.modals.current.hide(),t._createRelationSet(e.inputval))},onInvalid:function(){var e="";e=0===a.value.trim().length?b.get("Customize_EmptyProfileErr"):(e=b.get("Customize_SpecialCharErr")).concat(" !@#$%^&*()+=[]\\';,./{}|\":<>?-"),r.setContent(e)}}},o=new _(s),a=o.elements.container.getElement("input"),r=(e.createElement("p",{class:"CustomizeCreate",html:b.get("Customize_RelationSetTitle")}).inject(a,"before"),e.createElement("div",{class:"Customize-ProfileNameError",html:""}));n.dialog({body:o,title:b.get("Customize_ModalCreate"),buttons:[{className:"primary customize-newrelset-ok",value:b.get("SNNCustomize_Save"),action:function(){o.submit()}},{value:b.get("SNNCustomize_Cancel"),action:function(){n.modals.current.hide()}}]}),n.modals.current.elements.body&&n.modals.current.getBody().addContent(r),a.addEventListener("click",function(e){this.focus()})},_onSaveClick:function(){var e=this._getCheckedRelations(),t={};t.name=this._getSelectedProfile().options.data.name,t.relations=[];for(var i=0;i<e.length;i++)t.relations.push({name:e[i]});this.dispatchEvent("ENORIPE_SaveNewProfile",[t]),this._showHideDropDownCommands("customize-saverelationset")},_onDeleteClick:function(){var e,t=this.profileTreeDocument.getRoots(),i=this._getSelectedProfile(),s=null,o=null;if(this.dontHandleProfileChange=!1,i){for(var a=0;a<t.length;a++)if(t[a]._options.data.name===i.options.data.name&&!t[a].options.data.isRecent&&"text"!==t[a]._options.data.type){this.profileTreeDocument.removeRoot(a),e=a;break}s=i.options.data.name,this._profileCombobox.selectedIndex===e?(this._profileCombobox._applySelectedIndex(),this.handleProfileChange()):(this._profileCombobox.selectedIndex=e,this._profileCombobox._applySelectedIndex()),o=(i=this._getSelectedProfile()).options.data.name}n.trackUsage("Customize","DeleteCustom"),this.dispatchEvent("ENORIPE_DeleteProfile",[s,o]),this.disableRecent(s),this.isCustomProfileSet()||this._showHideDropDownCommands("customize-deleterelationset"),this._previousProfile===s&&(this._previousProfile=o)},_okClick:function(e){var t=this._getCheckedRelations();this.dispatchEvent("ENORIPE_updatePref",[t]),this.addRecent(),!0!==e&&(this.dimensions.dialogWidth=this._dialog.width,this.dimensions.dialogHeight=this._dialog.height,this.dimensions.position=this._dialog.position,this.destroyCurrentDialog()),n.setStartTime("relationsChange")},_cancelClick:function(){if(this._previousProfile&&this._previousProfile!==this._getSelectedProfile().options.data.name)for(var e=this.profileTreeDocument.getRoots(),t=0;t<e.length;t++)e[t].options.data.name===this._previousProfile&&(this._profileCombobox.selectedIndex=t);this.destroyCurrentDialog(),this.dispatchEvent("ENORIPE_UpdateLUP",[this._previousProfile])},_setUpEvents:function(){var e=this.getElements("input"),t=this;if(e.length>0)for(var i=0;i<e.length;i++)e[i].hasClassName("autocomplete-input")||e[i].addEventListener("click",this._onCheckboxClick.bind(this));this.getElements(".customize-downarrow").forEach(function(e){e.addEventListener("click",function(){this.toggleClassName("customize-inverticon");var e=this.getParent()?this.getParent().getParent():null;if(e)for(var t=e.getElementsByClassName("customize-childrel"),i=0;i<t.length;i++)t[i].hasAttribute("hidden")?t[i].removeAttribute("hidden"):t[i].setAttribute("hidden","")})});var n=this._dialog.elements.container.getElement(".Customize-More"),s=this._dialog.elements.container.getElement(".Customize-Less"),o=this._dialog.elements.container.getElement(".Customize-Divider"),a=this.getElement(".customize-bodytext"),r=this._dialog.elements.container.getElement(".CustomizeAbsent-relations"),l=null;n&&n.addEventListener("click",function(){r&&r.toggleClassName("customize-hidden"),s&&s.toggleClassName("customize-hidden"),o&&o.toggleClassName("customize-hidden"),a&&(l=t._getBodyText(t.currentProfile,t._templateContent.relations),a.innerText=l),n.toggleClassName("customize-hidden")}),s&&s.addEventListener("click",function(){r&&r.toggleClassName("customize-hidden"),n&&n.toggleClassName("customize-hidden"),o&&o.toggleClassName("customize-hidden"),a&&(l=t._getBodyText(t.currentProfile,t._templateContent.relations),a.innerText=l),s.toggleClassName("customize-hidden")})},_onCheckboxClick:function(e){var t;(this._dialog.buttons.Save.disabled=!1,this._dialog.buttons.Cancel.disabled=!1,"autoNav-cb"===e.target.id&&this._relationsList&&(!0===e.target.checked?this._relationsList.hide():this._relationsList.show()),this._groupRelations)&&(e.target.hasClassName("customize-parenttoggle")&&e.target.parentElement&&e.target.parentElement.parentElement&&((t=e.target.parentElement.parentElement).querySelector(".customized-grouprel").removeClassName("customized-grouprel-mixed"),!0===e.target.checked?t.getElements(".customize-childtoggle").forEach(function(e){e.checked=!0}):!1===e.target.checked&&t.getElements(".customize-childtoggle").forEach(function(e){e.checked=!1})),e.target.hasClassName("customize-childtoggle")&&this._checkParentToggleState(this.container));this._isSaveRequired()&&this._showHideDropDownCommands("customize-saverelationset",!0)},_performSearch:function(e){if(this._clearSearch(),0!==e.length){e=e.toLocaleLowerCase();var t=this.getElements(".customize-childtoggle"),i=this.getElements(".customize-relations-input"),n=this.getElement(".customize-bodycontent"),s=0;if(n&&n.addClassName("Customize-SearchOn"),this._groupRelations){i.forEach(function(e){e.setAttribute("hidden",!0)});for(var o=0;o<i.length;o++)for(var a=i[o].getElements(".customize-childtoggle"),r=0;r<a.length;r++)if(b.get(a[r].value).toLocaleLowerCase().search(e)>-1){s++,i[o].removeAttribute("hidden");break}}else for(var l=0;l<t.length;l++)-1===b.get(t[l].value).toLocaleLowerCase().search(e)?t[l].getParent().addClassName("Customize-NoSearchMatch"):(s++,t[l].getParent().addClassName("Customize-SearchMatch"),t[l].getParent().removeAttribute("hidden"));if(s>0){var d=this.getElement(".CustomizeAbsent-relations");d&&d.hasClassName("customize-hidden")&&(d.removeClassName("customize-hidden"),this.isMoreExpanded=!0)}}},_clearSearch:function(){var e=this.getElements(".Customize-SearchMatch"),t=this.getElements(".Customize-NoSearchMatch"),i=this.getElements(".customize-relations-input"),n=this.getElement(".customize-bodycontent");if(e.forEach(function(e){e.removeClassName("Customize-SearchMatch"),e.hasAttribute("hidden")&&e.removeAttribute("hidden")}),i.forEach(function(e){e.removeAttribute("hidden")}),t.forEach(function(e){e.removeClassName("Customize-NoSearchMatch")}),n.removeClassName("Customize-SearchOn"),this.isMoreExpanded){this.isMoreExpanded=!1;var s=this.getElement(".CustomizeAbsent-relations");s&&!s.hasClassName("customize-hidden")&&s.addClassName("customize-hidden")}},_getFilteredInputs:function(){var e=[],t=this.getElements(".customize-relations-input");t=this._groupRelations?this.getElements(".customize-relations-input"):this.getElements(".Customize-SearchOn").length>0?this.getElements(".Customize-SearchMatch"):this.getElements("#relations-list .toggle-primary");var i=[];return t.forEach(function(t){t.hidden||(i=t.getElements("input"),e=e.concat(i))}),e},_selectAll:function(){var e=this._getFilteredInputs(),t=this.getElements(".customized-grouprel-mixed"),i=!1;e.forEach(function(e){"checkbox"===e.type&&(void 0!==e.checked&&!1===e.checked&&(i=!0),e.checked=!0)}),t.forEach(function(e){e.removeClassName("customized-grouprel-mixed")}),i&&(this._dialog.buttons.Save.disabled=!1),this._handleDropDownCommands()},_clearAll:function(){var e=this._getFilteredInputs(),t=!1;e.length>0&&e.forEach(function(e){"checkbox"===e.type&&(void 0!==e.checked&&!0===e.checked&&(t=!0),e.checked=!1)}),t&&(this._dialog.buttons.Save.disabled=!1),this._handleDropDownCommands()},isCustomProfileSet:function(){var e=this._getSelectedProfile(),t=!1;return e&&e.options.data&&e.options.data.type&&"UserDefined"===e.options.data.type&&(t=!0),t},handleProfileChange:function(e,t){if(this.dontHandleProfileChange)this.dontHandleProfileChange=!1;else{if(this.isCustomProfileSet()?this._showHideDropDownCommands("customize-deleterelationset",!0):this._showHideDropDownCommands("customize-deleterelationset"),t){this.currentProfile=t;for(var i=this.profileTreeDocument.getRoots(),n=0;n<i.length;n++)t===i[n].options.data.name&&(this._selectedIndex=n)}else this.currentProfile=this._getSelectedProfile().options.data.name;"AutoModeProfile"===this.currentProfile?this._autoNav=!0:this._autoNav=!1,this._dialog&&(this._dialog.buttons.Save.disabled=!1,this._dialog.buttons.Cancel.disabled=!1),this.dispatchEvent("ENORIPE_updateRelations",[this.currentProfile])}},setAutoNavMode:function(e){this._autoNav=e},_getProfileModel:function(e){if(this.profileTreeDocument)for(var t=this.profileTreeDocument.getAllDescendants(),i=0;t.length;i++)if(t[i].options.data.name===e)return t[i]},_createNewProfile:function(e){for(var t=!0,i=this.profileTreeDocument.getRoots(),s=0;s<i.length;s++)i[s].options.data.name===e.name&&"text"!==i[s].options.data.type&&(t=!1);var o=this._getRecentSize()+2;this._profileCombobox._properties.preselectedIndex.value=-1,this._profileCombobox._applyPreselectedIndex(),t&&this.profileTreeDocument.addRoot(new S({label:e.name,icons:[{iconName:"user"}],data:{type:"UserDefined",name:e.name,selectable:!0}}),o),n.trackUsage("Customize","NewCustom"),this.dispatchEvent("ENORIPE_CreateNewProfile",[e]),this._profileCombobox.selectedIndex===o?(this._profileCombobox._applySelectedIndex(),this.handleProfileChange()):(this._profileCombobox.selectedIndex=o,this._profileCombobox._applySelectedIndex())},_getSelectedProfile:function(){var e=this.profileTreeDocument.getRoots()[this._profileCombobox.selectedIndex];if(e)return e},addRecent:function(){var e=this._getSelectedProfile(),t=this.getRecents();this.profileTreeDocument.prepareUpdate();for(var i=0;i<t.length;i++)this.profileTreeDocument.removeRoot(1);this.profileTreeDocument.pushUpdate(),t.unshift(new S({label:e.getLabel(),icons:[{iconName:"clock"}],data:{type:e.options.data.type,name:e.options.data.name,selectable:!0,isRecent:!0}}));for(var n=t.length-1;n;)e.options.data.name===t[n].options.data.name&&t.splice(n,1),n--;for(t.length>3&&t.splice(3,1),this.profileTreeDocument.prepareUpdate(),i=t.length-1;i>=0;i--)this.profileTreeDocument.addRoot(t[i],1);this.profileTreeDocument.pushUpdate();for(var s=this.profileTreeDocument.getRoots(),o=0;o<s.length;o++)if(e.options.data.name===s[o].options.data.name&&!s[o].options.data.isRecent){this.dontHandleProfileChange=!0,this._selectedIndex=o,this._profileCombobox.selectedIndex=o;break}this.dispatchEvent("ENORIPE_SetRecentRelationSet",[t])},disableRecent:function(e){for(var t,i=this.profileTreeDocument.getRoots(),n=!1,s=0;s<i.length;s++)if((t=i[s]._options.data)&&t.isRecent&&t.name===e){t.selectable=!1,i[s]._options.comboBoxSemantics="customdisabled",n=!0;break}if(n){var o=this.getRecents();this.dispatchEvent("ENORIPE_SetRecentRelationSet",[o])}},getRecents:function(){for(var e=this.profileTreeDocument.getRoots(),t=[],i=0;i<e.length;i++)e[i]._options.data&&e[i]._options.data.isRecent&&t.push(e[i]);return t},_getRecentSize:function(){for(var e=this.profileTreeDocument.getRoots(),t=0,i=0;i<e.length;i++)e[i]._options.data&&e[i]._options.data.isRecent&&t++;return t},setNewValues:function(e){var t=this._templateContent.relations;for(var i in t)if(t.hasOwnProperty(i))for(var n=0;n<t[i].length;n++)void 0!==e[t[i][n].id]&&(t[i][n].value="false"!==e[t[i][n].id]&&"true")},_checkParentToggleState:function(e){for(var t=e.getElements(".customize-relations-input"),i=0;i<t.length;i++){for(var n=t[i].getElements(".customize-childtoggle"),s=0,o=0;o<n.length;o++)n[o].checked&&s++;0===s?(t[i].getElement(".customize-parenttoggle").checked=!1,t[i].getElement(".customized-grouprel").removeClassName("customized-grouprel-mixed")):s===n.length?(t[i].getElement(".customize-parenttoggle").checked=!0,t[i].getElement(".customized-grouprel").removeClassName("customized-grouprel-mixed")):(t[i].getElement(".customize-parenttoggle").checked=!0,t[i].getElement(".customized-grouprel").addClassName("customized-grouprel-mixed"))}},_createRelationSet:function(e){var t=this._getCheckedRelations(),i={};i.name=e,i.relations=[];for(var n=0;n<t.length;n++)i.relations.push({name:t[n]});i.type="UserDefined",this._createNewProfile(i),this._showHideDropDownCommands("customize-saverelationset"),this._showHideDropDownCommands("customize-deleterelationset",!0)},_getCheckedRelations:function(){var e=this.getElements(".customize-childtoggle"),t=[];if(e.length>0)for(var i=0;i<e.length;i++)e[i].checked&&t.push(e[i].value);return t},_isAbsentRelExpanded:function(){var t=!1;if(this._dialog){var i=this.getElement(".CustomizeAbsent-relations");e.is(i)&&e.is(i.hasClassName)&&(t=!i.hasClassName("customize-hidden"))}return t},_getRelationsSet:function(){var e=localStorage.getItem(i.getUserID()+"_ENORIPE_CustomRelationsSet");if(e)return JSON.parse(e)},_getSavedRelationsForCustomProfiles:function(e){for(var t=this._getRelationsSet(),i=[],n=[],s=0;s<t.length;s++)if(t[s].name===e){i=t[s].relations;break}for(var o=0;o<i.length;o++)i[o].name&&n.push(i[o].name);return n},_translateRelations:function(e){return this._groupRelations?this._translateAndGroupRelations(e):this._translateAndFlatten(e)},_translateAndGroupRelations:function(e){return e.v6&&(e=e.v6),e},_translateAndFlatten:function(e){for(var t in e)if(e.hasOwnProperty(t))for(var i=0;i<e[t].length;i++);return e},_isSaveRequired:function(){var e=this.isCustomProfileSet(),t=this._getCheckedRelations(),i=this._getSelectedProfile().options.data.name,n=!1;if(e){var s=this._getSavedRelationsForCustomProfiles(i);!1===UWA.Array.equals(t,s)&&(n=!0)}return n},_adjustDialogDimensions:function(){var e=!1;this._dialog.position.offsetX=this.dimensions.position.offsetX,this._dialog.position.offsetY=this.dimensions.position.offsetY;var t=window.innerHeight-140;if(this.firstLaunch)if(this.firstLaunch=!1,this._dialog.elements._contentDiv.clientHeight<this._dialog.elements._contentDiv.scrollHeight){var i=this._dialog.elements._contentDiv.scrollHeight-this._dialog.elements._contentDiv.clientHeight,n=this._dialog.height+i;n>t&&(n=t),this._dialog.position.offsetY>50&&(this._dialog.position.offsetY=50),this._dialog.height=n}else e=!0;else e=!0;e&&(this._dialog.height>t&&(this._dialog.height=t),this._dialog.position.offsetY>50&&(this._dialog.position.offsetY=50)),this.dimensions.dialogHeight=this._dialog.height,this.dimensions.position.offsetY=this._dialog.position.offsetY,this._dialog._applyPosition(),this._dialog._applyHeight(),this._dialog._applyWidth()},updateDialogSizeOnResize:function(){if(this._dialog){var e=window.innerHeight-140;this._dialog.height=e>this._dialog.minHeight?e:this._dialog.minHeight,this.dimensions.dialogHeight=this._dialog.height,this._dialog.position.offsetY>50&&(this._dialog.position.offsetY=50,this.dimensions.position.offsetY=this._dialog.position.offsetY),this._dialog._applyPosition(),this._dialog._applyHeight()}},destroyCurrentDialog:function(){this.relationSetMenu.hide(),this._immersiveFrame.elements.container.setStyle("z-index",0),this.dimensions.dialogWidth=this._dialog.width,this.dimensions.dialogHeight=this._dialog.height,this.dimensions.position=this._dialog.position,this._selectedIndex=this._profileCombobox.selectedIndex,this.dontHandleProfileChange=!1,this._dialog.destroy(),this._dialog=null,this.hide()}})}),define("DS/SNNavigationMap/utils/CommonUtils",["UWA/Class","UWA/Class/Options","DS/WAFData/WAFData","DS/SNNavigationMap/MapSettings","DS/SNNavigationMap/utils/PromisesManager","DS/FedDictionaryAccess/FedDictionaryAccessAPI","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_internal"],function(e,t,i,n,s,o,a){"use strict";return e.singleton(t,{_currentRequest:null,init:function(e){},getAttributes:function(e){var t=n.getDefaultAttributes(),i={};return e=e||"AllTypes",t&&(void 0!==t[e]?i.attributes=t[e].attributes:i.attributes=t.AllTypes.attributes),i.attributes&&(i.attrs=i.attributes.map(function(e){return e.uri})),i},_processData:function(t,i){var n=this;if(i){i=JSON.parse(i);for(var s={},o=0;o<i.results.length;o++)for(var a=i.results[o].attributes,r=0;r<a.length;r++)(a[r].name.contains("ds6w")||a[r].name.contains("ds6wg"))&&(s[a[r].name]?-1===s[a[r].name].indexOf(a[r].value)&&s[a[r].name].push(a[r].value):s[a[r].name]=[a[r].value])}return new e.Promise(function(e,o){i&&i.results&&i.results.length>0?n.getNls(s).then(function(s){t=n._processFetchData(t,i),t=n._processNlsDataForFetch(t,s),e(t)}):(console.log("no results in fetch service for tooltip"),e(t))})},_prepareDataToNls:function(e){var t=null,i=[],n=[],s={};if(e)for(var o=0;o<e.length;o++){t=e[o]._attributes,i=Object.keys(t),n=Object.values(t);for(var a=0;a<i.length;a++)(i[a].contains("ds6w")||i[a].contains("ds6wg"))&&(s[i[a]]?-1===s[i[a]].indexOf(n[a])&&s[i[a]].push(n[a]):s[i[a]]=[n[a]])}return s},_getNls:function(t,i){return new e.Promise(function(e,s){o.getNlsOfPropertiesValues(JSON.stringify(t),{tenantId:n.getCurrentTenantName(),lang:n.getLang(),apiVersion:"R2019x",onComplete:function(t){t.ids=i,e(t)},onFailure:function(t){console.log("Error in fetching NLS data from FedDictionaryAccessAPI.getNlsOfPropertiesValues, the response received is ::"+t),e()}})})},_getNlsAndProcessData:function(t,i,n,s){var o=this;return new e.Promise(function(e,a){o._getNls(t,i).then(function(t){var i=o._getNlsObj(t,n,s);i.isInstances=s,e(i)})},function(){reject()})},_getNlsObj:function(e,t,i){for(var n={},s={ids:[],nlsObj:{}},o={},a=[],r=0;r<e.ids.length;r++){var l=null;Object.keys(t).indexOf(e.ids[r])>-1&&(l=t[e.ids[r]]._attributes),a.push(l)}for(var d=0;d<a.length;d++){var c=a[d];for(var h in n={},c)if(c.hasOwnProperty(h)&&h.contains("ds6w")&&e[h]&&e[h].hasOwnProperty(c[h])){var u=e[h][c[h]];n[h]=u}Object.keys(n).length>0&&(o[c.id]={...n},s.ids.push(c.id))}return s.nlsObj=o,s},_processFetchData:function(e,t){if(t)for(var i=t.results,n=null,s=e.attrs,o=0;o<i.length;o++)if(i[o].attributes&&i[o].attributes.length>0)for(var a=0;a<i[o].attributes.length;a++){var r=i[o].attributes[a];if("resourceid"===r.name){(n=this._getAttrForIds(r.value,i[o].attributes,s))&&(e.nlsObj||(e.nlsObj={}),e.nlsObj[r.value]=n);break}}return e},getResourcesInfo:function(t){return new e.Promise(function(e,i){o.getResourcesInfo(t.join(","),{tenantId:n.getCurrentTenantName(),lang:n.getLang(),apiVersion:"R2019x",onComplete:function(t){e(t)},onFailure:function(t){console.log("Error in fetching NLS data from FedDictionaryAccessAPI.getNlsOfPropertiesValues, the response received is ::"+t),e()}})})},_getAttrForIds:function(e,t,i){if(e&&t){for(var n={},s=0;s<t.length;s++)-1!==i.indexOf(t[s].name)&&(n[t[s].name]=t[s].value);if(Object.keys(n).length>0)return n}return null},_processNlsDataForFetch:function(e,t){if(t){var i=e.nlsObj;for(var n in i)if(i.hasOwnProperty(n)){var s=i[n];for(var o in s)if(s.hasOwnProperty(o)&&void 0!==t[o]){s[o];void 0!==t[o][s[o]]&&(e.nlsObj[n][o]=t[o][s[o]])}}}return e},getContentForOpenWith:function(e,t,i){if(e&&t){var s={data:{items:[{serviceId:"3DSpace",envId:n.getCurrentTenantName(),objectId:e,objectType:t}]}};if(i&&i.length>0){var o=this.getTaxonomies(i);o&&o.length>0&&(s.data.items[0].objectTaxonomies=o)}else"3DShape"===t&&(s.data.items[0].objectTaxonomies=["PLMEntity","PLMReference","PLMCoreRepReference","LPAbstractRepReference","LPAbstract3DRepReference","PHYSICALAbstract3DRepReference","VPMRepReference","3DShape"]);return s}},getTaxonomies:function(e){if(e&&e.length>0){for(var t=e.split(","),i=0;i<t.length;i++)if(t[i].contains("types")){t=t[i];break}var n=t.split("/");return n.length>1?(n.splice(0,1),n):[]}},getReverseRelations:function(e){return e.indexOf("_from")>-1?e.replace("_from","_to"):e.replace("_to","_from")},getMainRelName:function(e){return"_to"===e.substr(e.length-3)?e.substr(0,e.length-3):e.substr(0,e.length-5)},setAvailableRelations:function(e){for(var t=e,i={},n=0;n<t.length;n++)i[t[n].name]=!0;this._baseRelations=i,this._availableRelations=t},getProfileDirections:function(e){var t=e.indexOf("_from")>-1?e.replace("_from",""):e.replace("_to",""),i={};return i._from=this._baseRelations[t+"_from"],i._to=this._baseRelations[t+"_to"],void 0===this._baseRelations[t+"_from"]&&void 0===this._baseRelations[t+"_to"]&&(i={_from:!0,_to:!0}),i},switchRelationsDirection:function(e){var t=e.source,i=e.target;return"link"===e.modelType&&"in"===e.direction&&(this.getProfileDirections(e.type),e.type=e.type.replace("_from","_to"),e.source=i,e.target=t),e},getTitleLabel:function(e,t){if(t){for(var i="",s="",o=0;o<t.length;o++){if(s="",e.hasOwnProperty(t[o]))if(s=e[t[o]],t[o].contains("modified"))s=new Date(s).toLocaleString(n.getLang());if(s&&s.length>0&&(i=i.length>0?i+n.getOption("displayNameSeparator")+s:s),2===o)break}return i}},getRelationLinkNls:function(e){var t=e.display_name_attributes;return t&&t.length?a[e[t[0]]]||e[t[0]]:a[e.type+"_short"]||a[e.type]||e.type}})}),define("DS/SNNavigationMap/utils/RelationsServices",["UWA/Controls/Abstract","UWA/Class/Events","UWA/Class","UWA/Class/Options","UWA/Core","UWA/Promise","DS/SNNavigationMap/MapSettings","DS/SNNavigationMap/utils/ProbesUtils","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_internal","DS/SNNavigationMap/utils/PromisesManager"],function(e,t,i,n,s,o,a,r,l,d){"use strict";return i.singleton(n,{promiseManager:null,EXCLUDEDRELATIONS:["v6_structure_roots_from"],init:function(){this.promiseManager=new d({debugMode:"1"===a.getOption("debug_me")})},getRelationsCount:function(e){var t=this,i={};return i={widgetId:a.getWidgetId(),label:a.getLabelAPI(),ids:e.ids},e.trueREST&&(i.trueREST=!0,i.widgetId=a.getUniqueId(),i.publicationsMode=a.getPublicationsMode(),i.ghostMode=a.getGhostMode(),a.getOption("LastUsedProfile")&&"AutoModeProfile"===a.getOption("LastUsedProfile")?(i.relations=["use-auto-by-type-relations"],i.excludedRelations=this.EXCLUDEDRELATIONS):i.relations=a.getOption("currentRelations")),e.excludedRelations&&(i.excludedRelations=i.excludedRelations.concat(e.excludedRelations)),r.setStartTime("getRelationCount",Date.now()),a.setOption("getRelationCountNoOfObjects",i.ids.length),this.promiseManager.createPromise({url:a.get3DSpaceUrl()+"/resources/enorelnav/v2/navigate/getRelationCount?tenant="+a.getCurrentTenantName(),params:i,timeout:a.getTimeout(),xPrefCredential:a.getXPrefCredential(),onComplete:function(e){return new o(function(i,n){t.trackServices(),i(e)})}})},getEcosystem:function(e,t){var i=this,n={};return n={widgetId:a.getWidgetId(),label:a.getLabelAPI(),ids:e,lang:a.getLang(),trueREST:!1,direction:"both",excludedRelations:[],restrictedMode:!!t.restrictedMode,responseMode:t.responseMode?t.responseMode:"ObjectsAndLinks"},!t.direction||"in"!==t.direction&&"out"!==t.direction||(n.direction=t.direction),t.widgetId&&(n.widgetId=t.widgetId),t.relations&&t.relations.length>0&&(n.relations=t.relations),t.fullImportMode&&(n.fullImportMode=t.fullImportMode),a.getOption("LastUsedProfile")&&"AutoModeProfile"===a.getOption("LastUsedProfile")&&(n.excludedRelations=this.EXCLUDEDRELATIONS),t.excludedRelations&&(n.excludedRelations=n.excludedRelations.concat(t.excludedRelations)),t.trueREST&&!0===t.trueREST&&(trueREST=!0,n.relations=["use-auto-by-type-relations"],n.widgetId=a.getUniqueId(),a.getOption("LastUsedProfile")&&"AutoModeProfile"!==!a.getOption("LastUsedProfile")||(n.relations=a.getOption("currentRelations"))),r.setStartTime("getecosystem",Date.now()),a.setOption("ecosystemNoOfObjects",n.ids.length),this.promiseManager.createPromise({url:a.get3DSpaceUrl()+"/resources/enorelnav/v2/navigate/getEcosystem?tenant="+a.getCurrentTenantName(),params:n,timeout:a.getTimeout(),xPrefCredential:a.getXPrefCredential(),onComplete:function(e){return new o(function(t,n){i.trackServices(),t(e)})}})},getInfosForSupportedObjects:function(e){return this.promiseManager.createPromise({url:a.get3DSpaceUrl()+"/resources/enorelnav/navigate/getInfosForSupportedObjects?tenant="+a.getCurrentTenantName(),params:{widgetId:a.getWidgetId(),ids:e,checkSupported:!1},xPrefCredential:a.getXPrefCredential(),timeout:a.getTimeout()})},setPreferences:function(e){var t=["use-auto-by-type-relations"],i=[],n={};return e.relations?t=e.relations:a.getOption("LastUsedProfile")&&"AutoModeProfile"!=a.getOption("LastUsedProfile")?t=a.getOption("currentRelations"):n.excludedRelations=this.EXCLUDEDRELATIONS,e.excludedRelations&&e.excludedRelations.length>0&&(i=[...new Set([...e.excludedRelations,...n.excludedRelations])]),n={widgetId:a.getWidgetId(),label:a.getLabelAPI(),relations:t,lang:a.getLang(),computeWithInstances:!0,allRelationsMode:void 0!==e.allRelationsMode&&e.allRelationsMode,publicationsMode:a.getPublicationsMode(),attributesForView:e.attributes,ghostMode:a.getGhostMode()},i.length>0&&(n.excludedRelations=i),e.widgetId&&(n.widgetId=e.widgetId),this.promiseManager.createPromise({url:a.get3DSpaceUrl()+"/resources/enorelnav/v2/navigate/setPreferences?tenant="+a.getCurrentTenantName(),params:n,xPrefCredential:a.getXPrefCredential(),timeout:a.getTimeout()})},getDetails:function(e,t){var i={};return i={widgetId:a.getWidgetId(),direction:"both",id:e},!t.direction||"in"!==t.direction&&"out"!==t.direction||(i.direction=t.direction),r.setStartTime("detail",Date.now()),this.promiseManager.createPromise({url:a.get3DSpaceUrl()+"/resources/enorelnav/navigate/detail?tenant="+a.getCurrentTenantName(),params:i,xPrefCredential:a.getXPrefCredential(),timeout:a.getTimeout(),onComplete:function(e){return new o(function(t,i){that.trackServices(),t(e)})}})},clear:function(){return this.promiseManager.createPromise({url:a.get3DSpaceUrl()+"/resources/enorelnav/v2/navigate/clear?tenant="+a.getCurrentTenantName(),params:{widgetId:a.getWidgetId()},xPrefCredential:a.getXPrefCredential(),timeout:a.getTimeout()})},getFavorites:function(e){return this.promiseManager.createPromise({url:a.get3DSpaceUrl()+"/resources/enorelnavfav/favorite/getFavorites?tenant="+a.getCurrentTenantName(),xPrefCredential:e,params:{widgetId:a.getWidgetId()}})},createFavorite:function(e,t){var i="",n={...t,...{name:a.getUniqueId(),favDescription:"my nav fav",layoutType:a.getLayoutType()}};i="<p>"+l.get("Favorite_ErrorNotAccess")+"</br>";return i+=l.get("Favorite_ErrorCheckAccess")+"</br>",this.promiseManager.createPromise({url:a.get3DSpaceUrl()+"/resources/enorelnavfav/favorite/createFavorite?tenant="+a.getCurrentTenantName(),xPrefCredential:e,params:n,failureParams:{message:i,subtitle:l.get("Favorite_ErrorTypeObject"),level:"error"}})},updateFavorite:function(e,t){var i={...t,...{favDescription:"my nav fav",layoutType:a.getLayoutType()}};return this.promiseManager.createPromise({url:a.get3DSpaceUrl()+"/resources/enorelnavfav/favorite/updateFavorite?tenant="+a.getCurrentTenantName(),xPrefCredential:e,params:i})},getFavoriteInfo:function(e,t){return this.promiseManager.createPromise({url:a.get3DSpaceUrl()+"/resources/enorelnavfav/favorite/getFavoriteInfo?tenant="+a.getCurrentTenantName(),xPrefCredential:e,params:{widgetId:a.getWidgetId(),id:t}})},isFavorite:function(e,t){return this.promiseManager.createPromise({url:a.get3DSpaceUrl()+"/resources/enorelnavfav/favorite/isFavorite?tenant="+a.getCurrentTenantName(),xPrefCredential:e,params:{widgetId:a.getWidgetId(),id:t}})},getSettingsAndRelSets:function(){var e=this.getRelSettings(),t=this.getPatterns(),i=this.getProfiles();return o.all([e,t,i])},getRelSettings:function(){var e=this;return this.promiseManager.createPromise({url:a.get3DSpaceUrl()+"/resources/enorelcc/cc_services/getrelsettings?tenant="+a.getCurrentTenantName(),onComplete:function(t){return e._parseSettings(JSON.parse(t))}},"GET")},_parseSettings:function(e){var t=this;return new o(function(i,n){e.notexist||void 0===e.relation_apps?t.getResetRelApps().then(function(e){i(e)}):i(e=e)})},getResetRelApps:function(){var e=this;return void 0===e._resetSettingsFromServer?this.promiseManager.createPromise({url:a.get3DSpaceUrl()+"/resources/enorelcc/cc_services/getrelappsinit?tenant="+a.getCurrentTenantName(),onComplete:function(t){return new o(function(i,n){e._resetSettingsFromServer=JSON.parse(t),i(e._resetSettingsFromServer)})}},"GET"):new o(function(t,i){t(e._resetSettingsFromServer)})},getPatterns:function(){return this.promiseManager.createPromise({url:a.get3DSpaceUrl()+"/resources/enorelnav/v2/navigate/getPatterns?tenant="+a.getCurrentTenantName(),params:{widgetId:a.getWidgetId(),roles:a.getRoles(),lang:a.getLang(),label:a.getLabelAPI()},xPrefCredential:a.getXPrefCredential(),timeout:a.getTimeout()})},getProfiles:function(){return this.promiseManager.createPromise({url:a.get3DSpaceUrl()+"/resources/enorelnav/v2/navigate/getProfiles?tenant="+a.getCurrentTenantName(),params:{widgetId:a.getWidgetId(),roles:a.getRoles(),lang:a.getLang(),label:a.getLabelAPI()},xPrefCredential:a.getXPrefCredential(),timeout:a.getTimeout()})},getSynchroStatus:function(e){return this.promiseManager.createPromise({url:a.get3DSpaceUrl()+"/resources/enorelnav/v2/navigate/getSynchroStatus?tenant="+a.getCurrentTenantName(),params:{widgetId:a.getWidgetId(),ids:e},xPrefCredential:a.getXPrefCredential(),timeout:a.getTimeout()})},fetchAttributes:function(e){var t,i=this,n=e.type||"AllTypes";return t=this.getAttributes(n),(e={...e,...t}).toFetchThumbnail&&e.attrs.push("preview_url"),new o(function(t,n){i._fetchCall(e).then(i._processData.bind(i,e)).then(function(e){t(e)},function(){n()})})},_fetchCall:function(e){return this.promiseManager.createPromise({url:a.get3DSpaceUrl()+"/cvservlet/fetch/v2?tenant="+a.getCurrentTenantName(),params:{physicalid:e.ids,select_predicate:e.attrs},timeout:a.getTimeout()})},trackServices:function(){r.getStartTime("getRelationCount")&&r.trackPerformance("getRelationCount","getRelationCount",{NumberOfObjects:a.getOption("getRelationCountNoOfObjects")}),r.getStartTime("getecosystem")&&r.trackPerformance("getecosystem","getecosystem",{NumberOfObjects:a.getOption("ecosystemNoOfObjects")}),r.getStartTime("detail")&&r.trackPerformance("detail","detail")}})}),define("DS/SNNavigationMap/views/SNMapSelector",["UWA/Core","UWA/Class/View","UWA/Utils/InterCom","DS/SNNavigationMap/utils/SNNavigationServices","DS/i3DXCompassServices/i3DXCompassPubSub","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_internal"],function(e,t,i,n,s,o){"use strict";return{_ctx:{},_mapView:{},_listView:{},_collection:{},_compassSocket:{},_platformId:"",_widgetId:"",_isMultiSelON:0,_ObjectSelected:{},_mapViewSelected:{},_listViewSelected:{},_objectsInCompass:[],_feedBackMultiSelNumber:null,isSetTypesCallbackSubscribed:!1,viewContext:"",initialize:function(e){this._ctx=e.ctx,this._mapView=this._ctx.mapView,this._listView=this._ctx.listView,this._collection=e.collection,this._platformId=e.platformId||"onPremise",this._widgetId=e.widgetId;var t="com.ds."+this._widgetId;this._compassSocket=new i.Socket(t);this._compassSocket.subscribeServer("com.ds.compass",window.parent),this.isSetTypesCallbackSubscribed},updateSelection:function(e,t){if(this._onSetObject(e),null!=e){var i=!1;t&&t!==this.viewContext&&(i=!0),this.isMultiSelActivated()||(this._ObjectSelected={}),this._ObjectSelected[e.get("id")]=e,null==t?t=this.viewContext:this.viewContext=t,"ListView"===t?this._listViewSelected=this._ObjectSelected:this._mapViewSelected=this._ObjectSelected,i&&this._handleContextSwitch(!0);var s=[];s.push(e);var o=this._buildCompassData({widgetId:this._widgetId,envId:this._platformId,selectedModels:s});this._compassSocket&&this._compassSocket.dispatchEvent("onSetX3DContent",o);var a=[];a.push(e.get("id")),n.sendToMapWebInWin("CleanCSO",[]),n.sendToMapWebInWin("InsertInCSO",a)}},_onSetObject:function(e){if(null==e){return this._compassSocket.dispatchEvent("onSetObject",{serviceId:"3DSpace",objectId:"",envId:"OnPremise",contextId:""}),void this._compassSocket.dispatchEvent("onResetX3DContent",{})}var t={serviceId:"3DSpace",objectId:e.get?e.get("id"):e.id,envId:this._platformId,contextId:""};if(this._compassSocket.dispatchEvent){if(this._compassSocket.dispatchEvent("onSetObject",t),e.isPath)return;this._widgetId}},buildSelectionForNativeApps:function(){for(var e,t={version:"2.1",results:[],structures:[{structure:[]}]},i=this.getSelected(),n=0;n<i.length;n++)e=JSON.stringify(n+1),t.results.push({id:e,phid:i[n].id}),t.structures[0].structure.push({id:e,show:!0,select:!0,children:[]});return t},_AddFocusMS:function(e){var t=this._ctx.getElement("#container-"+e);if(t){var i=t.getAttribute("class");-1===i.indexOf(" focus")&&(i+=" focus",t.setAttribute("class",i))}},_RemoveFocusMS:function(e){var t=this._ctx.getElement("#container-"+e);if(t){var i=t.getAttribute("class");if(0<i.indexOf(" focus")){var n=i.replace(" focus","");t.setAttribute("class",n)}}},_changeSelectionToMapView:function(){var e=this._mapView.container,t=this._listView.container;if(this.viewContext="MapView",e){var i=this.getMapViewSelectedIds();e.removeClassName("unfocused"),this._mapView.switchFocus(i,!1)}t&&t.addClassName("unfocused")},_handleContextSwitch:function(e){"MapView"===this.viewContext&&(this._ObjectSelected=this._mapViewSelected,e&&this._changeSelectionToMapView()),this.isMultiSelActivated()&&this.setMultiSelCount(this.nbSelected().toString()),e&&n.sendToMapWebInWin("CleanCSO",[])},onObjectToMultiSel:function(e,t,i){var s=Array.isArray(e)?e:[e],o=s.length,a=[],r="";this.viewContext;if("add"===t){for(var l=0;l<o;l++){var d=(c=s[l]).id;this.isMultiSelActivated()||this.initMultiSel(),this._mapViewSelected[d]=c,this._AddFocusMS(d),a.push(d),void 0!==c&&c.set("focus",!0)}r="InsertInCSO"}else if("remove"===t){for(l=0;l<o;l++){var c;d=(c=s[l]).id;a.push(d),delete this._mapViewSelected[d],this._RemoveFocusMS(d)}r="RemoveFromCSO"}if(this._handleContextSwitch(i),this._syncObjectToCompass(),r.length)if(i){var h=this.getSelectedIDs();h.length>0&&n.sendToMapWebInWin(r,h)}else n.sendToMapWebInWin(r,a)},setMultiSelCount:function(e){this._feedBackMultiSelNumber?"0"===e?this._feedBackMultiSelNumber.setContent(""):this._feedBackMultiSelNumber.setContent(e):this.initFeedbackMultiSel()},initMultiSel:function(e){this._collection.getFocusedNode();e&&this.clearMultiSel(2),""===this.viewContext&&(this.viewContext="MapView"),"ListView"===this.viewContext?this._ObjectSelected=this._listViewSelected:this._ObjectSelected=this._mapViewSelected;var t=this.getSelected();this._isMultiSelON=1,this._mapView&&this._mapView.container&&this._mapView.initMultiSelection(),t.length>0&&this.onObjectToMultiSel(t,"add")},endMultiSel:function(){this.clearMultiSel(0),this._isMultiSelON=0},clearMultiSel:function(e){var t=this.getAllIDs(),i=t.length;if(2!==e){if(0===e);else if("ListView"===this.viewContext)return void this.clearMultiSelForListView();var s=this;this._collection.where({focus:!0}).forEach(function(e){s._RemoveFocusMS(e.get("id")),e.set("focus",!1)}),this._listView.clearPanel(),this._listView.hidePanel()}for(var o=i-1;o>=0;o--)delete this._mapViewSelected[t[o]],delete this._listViewSelected[t[o]],delete this._ObjectSelected[t[o]];this._listView&&this._listView.container&&this._listView.container.removeClassName("unfocused"),this.setMultiSelCount(this.nbSelected().toString()),n.sendToMapWebInWin("CleanCSO",[]),this._syncObjectToCompass()},clearMultiSelForListView:function(){for(var e=this.getAllIDs(),t=e.length-1;t>=0;t--)delete this._listViewSelected[e[t]];this._ObjectSelected=this._listViewSelected,this.setMultiSelCount(this.nbSelected().toString()),n.sendToMapWebInWin("CleanCSO",[]),this._syncObjectToCompass()},initFeedbackMultiSel:function(){var t,i=document.getElementsByClassName("multisel-icons");i&&i.length>0&&(t=i[0].getChildren())&&t.length>0&&(this._feedBackMultiSelNumber=e.createElement("span",{class:"feedBackMultiSel-count",html:""}).inject(t[0]))},updateFeedBack:function(e){for(var t=0;t<e.length;t++)delete this._ObjectSelected[e[t]],delete this._mapViewSelected[e[t]];this.setMultiSelCount(this.nbSelected().toString())},isMultiSelActivated:function(){return this._isMultiSelON},nbSelected:function(){return this.getSelectedIDs().length},isSelected:function(e){return this._ObjectSelected.hasOwnProperty(e)},getSelectedIDs:function(){return Object.keys(this._ObjectSelected)},getAllIDs:function(){var e=Object.keys(this._mapViewSelected);e=e.concat(Object.keys(this._listViewSelected));for(var t=Object.keys(this._ObjectSelected),i=0;i<t.length;i++)-1===e.indexOf(t[i])&&e.push(t[i]);return e},getSelectedItemsForDragAndDrop:function(){return this._collection.where({focus:!0})},getSelected:function(){var e=this;return Object.keys(this._ObjectSelected).map(function(t){return e._ObjectSelected[t]})},getInverseSelection:function(){return this._collection.getNotSelectedNodes()},getMapViewSelectedIds:function(){return Object.keys(this._mapViewSelected)},getNetworkPaths:function(e,t){var i,n,s=[],o=[[]],a=[];if(i=this._collection.get(e),n=this._collection.get(t),i&&n){if(o[0]=[i._attributes],s=[i,n],(s=[...s,...this._getCommon(this.getAllSuccessors([i]),this.getAllPredecessors([n]))]).length>0){if((o=this.getPathObjects([i],t,s,0,o))&&o[0].length>1){var r=0;return o.forEach(function(e){a[r]=[];for(var t=0;t<e.length-1;t++){let i=this._collection.where({modelType:"link",sourceId:e[t].id,targetId:e[t+1].id});1===i.length&&(i=i[0],0===t&&a[r].push(e[t]),a[r].push(i._attributes),a[r].push(e[t+1]))}r++}.bind(this)),a}return null}return null}return null},getPathObjects:function(e,t,i,n,s){var o,a=e.map(function(e){return e.get("id")}),r=[...s[n]];if(o=r[0].id,a.indexOf(t)>-1)return s;if(""!=o&&r.length>1&&a.indexOf(o)>-1)return s.splice(n,1),null;{let o=this._getCommon(this.getSuccessors(e),i);for(var l=0;l<o.length;l++)0===l?s[n].push(o[l]._attributes):(s[n]&&s[n].length>0&&n++,s[n]=[...r],s[n].push(o[l]._attributes)),this.getPathObjects([o[l]],t,i,n,s);return s}},getPredecessors:function(e){if(0!==e.length)return this._getDescendantsOrAscendants(e,"ascendant")},getAllPredecessors:function(e){if(0!==e.length)return this._getAllDescendantsOrAscendants(e,"ascendant")},getSuccessors:function(e){if(0!==e.length)return this._getDescendantsOrAscendants(e,"descendant")},getAllSuccessors:function(e){if(0!==e.length)return this._getAllDescendantsOrAscendants(e,"descendant")},getAllNeighbors:function(e){if(0!==e.length)return[...this.getAllSuccessors(e),...this.getAllPredecessors(e)]},getCommonDirectPredecessors:function(e){if(!(e.length<2)){for(var t=this.getPredecessors([e[0]]),i=1;i<e.length;i++)t=this._getCommon(t,this.getPredecessors([e[i]]));return t}},getCommonAllPredecessors:function(e){if(!(e.length<2)){for(var t=this.getAllPredecessors([e[0]]),i=1;i<e.length;i++)t=this._getCommon(t,this.getAllPredecessors([e[i]]));return t}},getCommonDirectSuccessors:function(e){if(!(e.length<2)){for(var t=this.getSuccessors([e[0]]),i=1;i<e.length;i++)t=this._getCommon(t,this.getSuccessors([e[i]]));return t}},getCommonAllSuccessors:function(e){if(!(e.length<2)){for(var t=this.getAllSuccessors([e[0]]),i=1;i<e.length;i++)t=this._getCommon(t,this.getAllSuccessors([e[i]]));return t}},_getCommon:function(e,t){if(0===e.length||0===t.length)return[];for(var i=[],n=0;n<e.length;n++)t.indexOf(e[n])>-1&&i.push(e[n]);return i},_getAllDescendantsOrAscendants:function(e,t){for(var i,n=[],s=[],o=[],a=this,r=0;r<e.length;r++)if(!(n.indexOf(e[r].get("id"))>-1)){i=this._getdescendantOrAscendantID(e[r].get("id"),t),s=i.slice();for(var l,d=0;i.length>0;)this._getdescendantOrAscendantID(s[d],t).forEach(function(e){-1===s.indexOf(e)&&s.push(e),-1===i.indexOf(e)&&i.push(e)}),l=i.indexOf(s[d]),i.splice(l,1),d++;s.forEach(function(e){-1===n.indexOf(e)&&n.push(e)})}return n.forEach(function(e){o.push(a._collection.get(e))}),o},_getDescendantsOrAscendants:function(e,t){for(var i,n=[],s=[],o=this,a=0;a<e.length;a++){i=this._getdescendantOrAscendantID(e[a].get("id"),t);for(var r=0;r<i.length;r++)-1===n.indexOf(i[r])&&n.push(i[r])}return n.forEach(function(e){s.push(o._collection.get(e))}),s},_getdescendantOrAscendantID:function(e,t){var i,n,s=[];this._collection.get(e);return this._collection.forEach(function(o){"link"===o.get("modelType")&&("descendant"===t?o.get("source")&&o.get("source").id===e&&(i=o.get("target"))&&i.id&&-1===s.indexOf(i.id)&&s.push(i.id):"ascendant"===t&&o.get("target")&&o.get("target").id===e&&(n=o.get("source"))&&n.id&&-1===s.indexOf(n.id)&&s.push(n.id))}),s},_syncPathToCompass:function(e){e.data&&e.data.items&&(0===e.data.items.length?this._onSetObject(null):this._onSetObject({id:e.data.items[0].objectId,isPath:!0}),this._compassSocket.dispatchEvent("onSetX3DContent",e))},_syncObjectToCompass:function(){var e=this.getSelected();if(0===e.length)this._onSetObject(null);else this._widgetId;1===e.length&&this._onSetObject(e[0]);var t=this._buildCompassData({widgetId:this._widgetId,envId:this._platformId,selectedModels:e});this._compassSocket.dispatchEvent("onSetX3DContent",t)},_buildCompassData:function(t){var i={};if(e.is(t)){var n=t.selectedModels;if(e.is(n,"array")){i={protocol:"3DXContent",version:"1.1",source:"ENORIPE_AP",widgetId:t.widgetId,data:{items:[]}};var s=[];n.forEach(function(e){var i={};i=e.get?{envId:t.envId,serviceId:"3DSpace",contextId:"",objectId:e.id,objectType:e.get("type"),displayName:e.get("name"),displayType:e.get("type")}:{envId:t.envId,serviceId:"3DSpace",contextId:"",objectId:e.id,objectType:e.type,displayName:e.name,displayType:e.type},s.push(i)}),i.data.items=s}}return i},handleClearMap:function(){this._feedBackMultiSelNumber&&(this._feedBackMultiSelNumber.destroy(),this._feedBackMultiSelNumber=null)}}}),define("DS/SNNavigationMap/views/PathPanelView",["UWA/Core","UWA/Class/View","UWA/Class/Promise","DS/WAFData/WAFData","DS/SNNavigationMap/MapSettings","DS/Handlebars/Handlebars4","text!DS/SNNavigationMap/assets/templates/paths.html","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_internal","DS/TransientWidget/TransientWidget","DS/WebappsUtils/WebappsUtils","DS/Windows/Dialog","DS/Controls/Button","DS/Windows/ImmersiveFrame","DS/Controls/TileView","DS/Controls/TooltipModel","DS/Tree/Tree","DS/Tree/TreeNodeModel","DS/UIKIT/Input/Button","DS/UIKIT/Input/Toggle","DS/UIKIT/DropdownMenu","DS/i3DXCompassPlatformServices/OpenWith","DS/UIKIT/Spinner","DS/UIKIT/Accordion","DS/ENOFilterBIUX/FilterBIComponentProxy","DS/SNNavigationMap/utils/SNNavigationServices","DS/SNNavigationMap/utils/RelationsServices","DS/SNNavigationMap/views/SNMapSelector"],function(e,t,i,n,s,o,a,r,l,d,c,h,u,g,p,m,f,v,_,N,S,b,w,E,I,C,y){"use strict";return t.extend({name:"path-panel-view",_dialog:null,_paths:null,_anchor:[],models:[],allTrees:[],className:function(){return this.getClassNames("-container")},setup:function(e){this._debug=e.debugMode,this._addinMode=e.addinMode||void 0,this._template=o.compile(a),this._widgetId=e.widgetId||null,this.dimensions={},this.dimensions.position={},this.dimensions.position.offsetX=e.position.offsetX?e.position.offsetX:0,this.dimensions.position.offsetY=e.position.offsetY?e.position.offsetY:-150,this.dimensions.dialogWidth=e.position.dialogWidth?e.position.dialogWidth:600,this.dimensions.dialogHeight=e.position.dialogHeight?e.position.dialogHeight:200,this._immersiveFrame=new u,this._immersiveFrame.inject(this.container),this._filterProxy=new E({tenant:s.getCurrentTenantName(),widgetId:this._widgetId})},renderInit:function(){this._createDialogContent(),null===this._dialog&&this._createDialog(),this.show(),this._dialog.position.offsetX=this.dimensions.position.offsetX,this._dialog.position.offsetY=this.dimensions.position.offsetY;var e=window.innerHeight-115,t=window.innerWidth-180;this._dialog.height>e&&(this._dialog.height=e),this._dialog.width>t&&(this._dialog.width=t),this._dialog.position.offsetY>50&&(this._dialog.position.offsetY=50),this._dialog._applyPosition(),this._dialog._applyHeight(),this._dialog._applyWidth()},render:function(e){if(this.renderInit(),e&&!(e&&e.length<1)){for(var t=0;t<e.length;t++)this.fillDataInLine(t+1,e[t]),this.createNewLine(),this.models.push(e[t]);this.findBtn.disabled=!0,this.isAnchorRemoved=!0}},_createDialog:function(){this._dialog=new c({title:r.get("FindPaths"),content:this.mainContainer,immersiveFrame:this._immersiveFrame,expandedFlag:!1,width:this.dimensions.dialogWidth,height:this.dimensions.dialogHeight,minWidth:100,minHeight:100,resizableFlag:!0,position:{at:"left",my:"center"}}),e.createElement("span",{class:"navigation-dialog-resize fonticon fonticon-resize-full"}).inject(this._dialog.elements._bottomLeftResizeHandler),e.createElement("span",{class:"right-resize navigation-dialog-resize fonticon fonticon-resize-full"}).inject(this._dialog.elements._bottomRightResizeHandler),this._dialog.addEventListener("close",this._close.bind(this)),this._dialog.elements._bottomLeftResizeHandler.addEventListener("touchstart",function(e){e.preventDefault()}),this._dialog.elements._bottomRightResizeHandler.addEventListener("touchstart",function(e){e.preventDefault()})},_createDialogContent:function(){this.mainContainer=e.createElement("div",{class:"path-main-container"});var t=e.createElement("div",{class:"path-input-container"}).inject(this.mainContainer);this.pathContentDiv=e.createElement("div",{class:"path-content"}).inject(t);var i=e.createElement("div",{class:"line-container"}).inject(this.pathContentDiv);e.createElement("div",{class:"path-icon start-icon fonticon fonticon-anchor"}).inject(i);var n=e.createElement("div",{class:"path-line"}).inject(i);e.createElement("div",{class:"path-line-icon"}).inject(n),e.createElement("div",{class:"path-line-content",html:r.get("SelectStart")}).inject(n).setStyle("font-style","italic"),this.createNewLine();var s=e.createElement("div",{class:"findbtn-container"}).inject(t);this.findBtn=new h({label:r.get("Find"),onClick:this.showPathsBetween.bind(this)}).inject(s),this.findBtn.disabled=!0,this._pathsContainerNP=e.createElement("div",{class:"paths-container"}),this._pathsContainerSP=e.createElement("div",{class:"paths-container"}),this.pathsAccordion=new w({className:"relations-paths-accordion",items:[{title:r.get("AllNetWorkPaths"),content:this._pathsContainerNP},{title:r.get("AllStructurePaths"),content:this._pathsContainerSP}],exclusive:!1}),this.pathsAccordion.getItem(0).elements.container.hide(),this.pathsAccordion.getItem(1).elements.container.hide(),this.pathsAccordion.inject(this.mainContainer)},createTreeView:function(t,i){var n=e.createElement("div",{class:"tree-container"}).inject(i),s=Math.floor(t.length/2)+1,o=new m({enableTreeColumnEllipsisOverflow:!0,height:30*s,useAsyncPreExpand:!0,roots:[{label:t[0].displayName,icons:t[0].type_icon_url?[t[0].type_icon_url]:"",children:[]}]}).inject(n);if(t.length>2)for(var a,r=o.getRoots()[0],l="",d=2;d<t.length;d++)2===d?(l=t[d].displayName+"("+t[1].name+")",a=r.addChild(new f({label:l,icons:t[d].type_icon_url?[t[d].type_icon_url]:""}))):t[d].displayName&&(l=t[d].displayName+"("+t[d-1].name+")",a=a.addChild(new f({label:l,icons:t[d].type_icon_url?[t[d].type_icon_url]:""})));n.addEventListener("click",function(e){e.stopPropagation(),e.preventDefault()});var c=o.getRoots();c.length>0&&c[0].expandAll(),n.hide(),this.allTrees.push(o)},createTileContent:function(t,i){var n,s,o=e.createElement("div",{class:"tileview-title"}),a=t.length;if(0===t.length)return"";s=t[0].displayName?"displayName":"ds6w:label",t.length>5?o.addContent(e.createElement("span",{class:"tileview-title-text",html:t[0][s]+"..."})):o.addContent(e.createElement("span",{class:"tileview-title-text",html:t[0][s]})),o.addContent(e.createElement("span",{class:"path-links fonticon fonticon-play"})),3===t.length?o.addContent(e.createElement("span",{class:"tileview-title-text",html:t[2][s]})):(o.addContent(e.createElement("span",{class:"tileview-title-text",html:t[a-3][s]})),n=e.createElement("span",{class:"path-links fonticon fonticon-play"}),o.addContent(n),o.addContent(e.createElement("span",{class:"tileview-title-text",html:t[a-1][s]})));var l=Math.floor(t.length/2)+1;return"StructurePath"===i&&o.addContent(e.createElement("span",{class:"tileview-title-nodecount",html:" ("+l+" "+r.get("Nodes")+")",events:{click:function(e){e.stopPropagation(),e.preventDefault(),this.getParent(".path-container").getElement(".tree-container").toggle()}}})),o},_createDropDown:function(t,i,n,s,o){var a=e.createElement("div",{class:"openWith-container"}).inject(t.elements.cartoucheContent),r=(e.createElement("span",{class:"fonticon fonticon-chevron-down"}).inject(a),this);t.elements.openWith=a,t.elements.openWith.addEventListener("click",function(e){e.stopPropagation(),r.dropDownMenu&&r.dropDownMenu.options.target===this?(r.dropDownMenu.destroy(),r.dropDownMenu=null):r._showDropDown(t,i,n,s,o)}),t.elements.container.addEventListener("contextmenu",function(e){e.preventDefault(),r._showDropDown(t,i,n,s,o)})},_createOpenWithContent:function(e,t){var i={protocol:"3DXContent",version:"1.1",source:"ENORIPE_AP",widgetId:I.isWebInWin()?"web_in_win":this._widgetId,data:{items:[]}};if(e.length>0){var n=e[0],o={envId:s.getPlatformId()||"OnPremise",serviceId:"3DSpace",contextId:"",objectId:n.resourceid,objectType:n.type,displayName:n.displayName,displayType:n.type,session_object:!1};if(i.data.items.push(o),"StructurePath"===t)o.path=e;else for(var a=1;a<e.length;a++)e[a].displayName&&(n=e[a],o={envId:s.getPlatformId()||"OnPremise",serviceId:"3DSpace",contextId:"",objectId:n.resourceid,objectType:n.type,displayName:n.displayName,displayType:n.type,session_object:!1},i.data.items.push(o))}return i},addNodes:function(e){if(-1===this.models.indexOf(e)){this.pathContentDiv.getChildren();if(this.isAnchorRemoved)return this.models.splice(0,0,e),this.fillDataInLine(0,e),this.models.length>1&&(this.findBtn.disabled=!1),void(this.isAnchorRemoved=!1);0===this.models.length?this.fillDataInLine(0,e):1===this.models.length&&(this.fillDataInLine(1,e),this.findBtn.disabled=!1,this.createNewLine()),this.models.push(e),this.addModelInDialog(e)}},addModelInDialog:function(e){if(!(this.models.length<3)){var t=this.models.length-1;this.pathContentDiv.getChildren().length>=t&&this.fillDataInLine(t,e),this.createNewLine()}},createNewLine:function(t){var i=e.createElement("div",{class:"line-container"}).inject(this.pathContentDiv);t||e.createElement("div",{class:"path-icon end-icon fonticon fonticon-plus"}).inject(i);var n=e.createElement("div",{class:"path-line"}).inject(i);e.createElement("div",{class:"path-line-icon"}).inject(n),e.createElement("div",{class:"path-line-content",html:r.get("SelectStop")}).inject(n),n.addClassName("last-node")},fillDataInLine:function(t,i){var n,s=this.pathContentDiv.getChildren();s[t].getElement(".path-line").removeClassName("last-node"),n=i.get("type_icon_url"),s[t].getElement(".path-line-icon").setStyle("background-image","url("+n+")"),s[t].getElement(".path-line-content").innerHTML=i.get("name"),s[t].setData("id",i.get("id")),e.createElement("div",{class:"cross-icon fonticon fonticon-close"}).inject(s[t]).addEvent("click",this.removeLine.bind(this));var o=s[t].getElement(".path-icon");o&&(o.removeClassName("fonticon-plus"),o.addClassName("fonticon-location"))},removeLine:function(e){for(var t=e.srcElement||e.target,i=t.getParent().getData("id"),n=-1,s=0;s<this.models.length;s++)this.models[s].get("id")===i&&(n=s);if(-1!==n){if(0===n&&!this.isAnchorRemoved){this.isAnchorRemoved=!0;var o=this.pathContentDiv.getChildren();return o[0].getElement(".path-line-icon").setStyle("background-image",""),o[0].getElement(".path-line-content").innerHTML=r.get("SelectStart"),t.remove(),this.models.splice(n,1),void(this.findBtn.disabled=!0)}this.models.splice(n,1)}1===this.models.length&&(this.findBtn.disabled=!0),t.getParent().remove()},showPathsBetween:function(){var t=this,n=t.models[0].get("id"),s=0;this.pathsAccordion.getItem(0).elements.container.hide(),this.pathsAccordion.getItem(1).elements.container.hide(),this._pathsContainerNP.setContent(""),this._pathsContainerSP.setContent(""),this._allPathsInfos=[],this._anchor=t.models[0],this.allTrees=[],this._pathSpinner||(this._pathSpinner=(new b).inject(e.createElement("div",{class:"path-panel-spinner",styles:{position:"absolute",left:"49%"}}).inject(this._dialog.elements._titleBarDiv))),this._pathSpinner.show();for(var o=[],a=[],r=[],l=1;l<t.models.length;l++)s=t.models[l].get("id"),t._selected=t.models[l],null!=(r=y.getNetworkPaths(n,s))&&r.length>0&&(a=a.concat(y.getNetworkPaths(n,s)));this._parseResponse({paths:a});for(var d=1;d<t.models.length;d++)"ENOStrRefinementSpecification"===t.models[0].get("type")?o.push(t.computeFilterPath(t.models[0],t.models[d])):o.push(t.computeStructurePaths(t.models[0],t.models[d]));i.allSettled(o).then(function(){t._pathSpinner.hide()})},_renderStructurePaths:function(e){var t=[],i=[],n={};e.infos.error||void 0!==e.results&&0!==e.results.length&&(e.results.forEach(function(e){e.Path?t.push(e.Path):e.resourceid&&(e.from?e.name=e["ds6w:label"]:e.displayName=e["ds6w:label"],e.type=e["ds6w:type"],n[e.resourceid]=e)}),t.forEach(function(e){var t=[];e.forEach(function(e){t.push(n[e])}),i.push(t)}),this._setPaths(i,"StructurePath"))},_setPaths:function(t,i){for(var n=0;n<t.length;n++){this._allPathsInfos.length;var s=e.createElement("div",{class:"path-container",id:"map-path-container-"+this._allPathsInfos.length}),o=e.createElement("div",{class:"list-node",id:"map-path-"+this._allPathsInfos.length,draggable:"true"}).inject(s),a=new g({size:"small"}),r={paths:t[n],tile:a,container:s,typeOfPath:i};s.tooltipInfos=new p({longHelp:this._getToolTipInfos(t[n])}),t[n][0].preview_url?a.setPicture(t[n][0].preview_url):this._anchor.get("preview_url")&&a.setPicture(this._anchor.get("preview_url"));var l=this.createTileContent(t[n],i);if(a.setTitle(l),a.setDescription(""),a.setSubtitle(""),a.inject(o),!this.ODTMode){var d=this._createOpenWithContent(t[n],i);this._createDropDown(a,d,i,t[n],this._allPathsInfos.length)}I.isWebInWin(),a.elements.menu.hide(),"StructurePath"===i&&this.createTreeView(t[n],s),this._allPathsInfos.push(r),"StructurePath"===i?this._pathsContainerSP.addContent(s):this._pathsContainerNP.addContent(s),this._setUpEvents(s)}"StructurePath"===i?this.pathsAccordion.getItem(1).elements.container.show():this.pathsAccordion.getItem(0).elements.container.show()},_showDropDown:function(e,t,i,n,s){var o=[],a=this,l=n.map(function(e){return e.resourceid});if(I.isWebInWin()){var d=a._buildDragMessage(s,"drag",!1);if(!d)return a.dispatchEvent("_showError",[{message:"noPathSelected"}]),!1;d=JSON.stringify(d);var c="";"StructurePath"===i&&(c=a._buildAddMessage(s)),I.sendToMapWebInWin("onComputeCtxMenu",[]);var h={targetId:l,targetElement:e.elements.openWith,typeOfPath:i,jsonMsgForOpen:d,jsonMsgForAddInGraph:c};this.dispatchEvent("ContextualMenuFindPath",h)}else{"StructurePath"===i?o.push({fonticon:"select-on",text:r.get("addInGraph"),handler:function(e){var t=a._buildAddMessage(s);a.dispatchEvent("ENORIPE_AddInGraph",[l,t])}}):o.push({fonticon:"select-on",text:r.get("SelectInGraph"),handler:function(e){a.dispatchEvent("ENORIPE_SelectInGraph",[l])}});var u={target:e.elements.openWith,position:"bottom left",items:o};this.dropDownMenu&&(this.dropDownMenu.destroy(),this.dropDownMenu=null),this.dropDownMenu=new N(u);(new S).set3DXContent(t).render(this.dropDownMenu);setTimeout(function(){a.dropDownMenu.show()}.bind(this),50)}},_onDragEnd:function(){this.dispatchEvent("ENORIPE_dragEnd")},_setUpEvents:function(e){var t=this;e.addEventListener("click",function(e){e.stopPropagation(),t._onPathClick(this,e)}),e.addEventListener("dragend",this._onDragEnd.bind(this)),e.addEventListener("dragstart",function(e){t._onDragStart(this,e)}),e.addEventListener("mouseenter",function(e){t._onMouseEnter(this,e)}),e.addEventListener("mouseleave",function(e){t._onMouseLeave(this,e)})},_onMouseEnter:function(e,t){var i=this,n=e.id,s=parseInt(n.split("-").pop());if(-1!==s){var o=this._allPathsInfos[s];this._highlightTimeout&&clearTimeout(this._highlightTimeout),this._highlightTimeout=setTimeout(function(){i.dispatchEvent("ENORIPE_HighlightPath",[o])},1e3)}},_onMouseLeave:function(e,t){this._highlightTimeout&&(clearTimeout(this._highlightTimeout),this._highlightTimeout=null);var i=e.id,n=parseInt(i.split("-").pop());if(-1!==n){var s=this._allPathsInfos[n];this.dispatchEvent("ENORIPE_UnHighlightPath",[s])}},_onPathClick:function(t,i){var n=t.id,s=parseInt(n.split("-").pop());if(-1!==s){var o=this._allPathsInfos[s].tile;e.is(o)&&(t.setAttribute("isSelected","true"),i.toElement&&(i.toElement.hasClassName("wux-ui-fa")||o.elements.checkbox.toggle()),t.getElementsByTagName("input")&&(t.getElementsByTagName("input")[0]&&t.getElementsByTagName("input")[0].checked?t.setAttribute("isSelected","true"):t.setAttribute("isSelected","false"))),this._setPathOnCompass(s)}},_onDragStart:function(t,i){var n,s=t.id;if(e.is(s)){var o=s.split("-").pop();if(o=parseInt(o),!(n=this._buildDragMessage(o,"drag")))return this.dispatchEvent("_showError",[{message:"noPathSelected"}]),!1;if(n=JSON.stringify(n),i.dataTransfer)if(I.isWebInWin())i.dataTransfer.setData("text",n);else try{i.dataTransfer.setData("text",n),i.dataTransfer.setData("text/searchitems",n)}catch(e){console.log(e),i.dataTransfer.setData("Text",n)}I.isWebInWin()||l.closeWidget()}},_buildDragMessage:function(e,t,i=!0){var n,o=null,a=[],r=null,l={};try{n=s.getPlatformId()||"OnPremise"}catch(e){n=""}l={protocol:"3DXContent",version:"1.1",source:"ENORIPE_AP",widgetId:I.isWebInWin()?"web_in_win":this._widgetId,data:{items:[]}};for(var d=0;d<this._allPathsInfos.length;d++)if(this._allPathsInfos[d].tile.isHighlighted()||t&&"drag"===t&&d===e)if(o=this._allPathsInfos[d].paths,"StructurePath"===this._allPathsInfos[d].typeOfPath)a={envId:n,serviceId:"3DSpace",contextId:"",objectId:(r=o[0]).resourceid,objectType:r.type,displayName:r.displayName,displayType:r.type,session_object:!1,path:o},l.data.items.push(a);else for(var c=0;c<o.length;c++)void 0!==o[c].displayName&&(a={envId:n,serviceId:"3DSpace",contextId:"",objectId:(r=o[c]).resourceid,objectType:r.type,displayName:r.displayName},l.data.items.push(a));if(I.isWebInWin()&&i){var h,u,g,p=[];for(d=0;d<this._allPathsInfos.length;d++)if(h=[],u=0,g=[],this._allPathsInfos[d].tile.isHighlighted()||d===e){r=(o=this._allPathsInfos[d].paths)[0],u=(h=o).length;for(var m=0;m<u;m++)g.push(h[m].resourceid);p.push(g)}p.length>0&&I.sendToMapWebInWin("RefreshOnDragPath",p,"path")}return l},_buildAddMessage:function(e){var t,i=null,n=[],o=null,a={};try{t=s.getPlatformId()||"OnPremise"}catch(e){t=""}a={protocol:"3DXContent",version:"1.1",source:"ENORIPE_AP",widgetId:I.isWebInWin()?"web_in_win":this._widgetId,data:{items:[]}};for(var r=0;r<this._allPathsInfos.length;r++)if(r===e){i=this._allPathsInfos[r].paths;for(var l=0;l<i.length;l++)void 0!==i[l].displayName&&(n={envId:t,serviceId:"3DSpace",contextId:"",objectId:(o=i[l]).resourceid,objectType:o.type,displayName:o.displayName},a.data.items.push(n))}return a},_getToolTipInfos:function(e){var t="";if(e&&e.length>0){var i=1;e.forEach(function(n,s){if(void 0!==n.displayName||void 0!==n["ds6w:label"]){var o=n.displayName||n["ds6w:label"];t=t+i+". "+o,i++,s<e.length-1&&(t+="\n")}})}return t},_getExpandParams:function(e,t){var i=[],n={sequence:[{uql:"physicalid:"+t}]},s={label:"Relations "+Date.now(),root:{physical_id:e},graph:{descending_condition:{uql:"[ds6w:type]:*"}},filter:{or:{filters:[{sequence_filter:n}]}},aggregation_processors:[{truncate:{max_distance_from_prefix:0,compute_matching_subpaths_lengths:1,sequence_filter:n}}]};return i.push(s),{batch:{expands:i},outputs:{select_object:["physicalid","ds6w:label","ds6w:type"],select_relation:["physicalid","ds6w:label","ds6w:type"],matching_lengths:1,hits:{predefined_computation:["thumbnail_2d","icon"]},format:"entity_relation_occurrence"}}},_setPathOnCompass:function(e){for(var t=!1,i=null,n=0;n<this._allPathsInfos.length;n++)if(this._allPathsInfos[n].tile.isHighlighted()){t=!0;break}i=t?this._buildDragMessage(e,"select"):{protocol:"3DXContent",version:"1.1",source:"ENORIPE_AP",widgetId:this._widgetId,data:{items:[]}},this.dispatchEvent("ENORIPE_SetPathOnCompass",[i])},computeStructurePaths:function(e,t){var n=this,s=t.get("id"),o=e.get("id"),a=this._getExpandParams(o,s);return new i(function(i,s){n._expandCall(a).then(function(s){s=s.substr(0,s.length-2),(s=JSON.parse(s)).infos.error?i():void 0!==s.results?(0===s.results.length?n.dispatchEvent("noPathsFound",{type:"StructurePath",anchor:e.get("name"),selected:t.get("name")}):n._renderStructurePaths(s),i()):i()})})},computeFilterPath:function(e,t){var n=this;return new i(function(i,o){var a=t.get("id"),r=e.get("linked").get("id"),l=e.get("id");if(r!==a){var d=n._getExpandParams(r,a);s.get3DSpaceUrl(),s.getCurrentTenantName();n._filterProxy.getFilterIdSpec(l,{V2:{find_in_context:"physicalid:"+a}}).then(function(s){if(void 0!==s)if(void 0!==s.filter){try{delete s.filter.or.filters[0].and.filters[1].sequence_filter.sequence[0].uql_prefix_handler}catch(e){return console.log(e),void i()}d.batch.expands[0].filter=s.filter,n._expandCall(d).then(function(s){s=s.substr(0,s.length-2),(s=JSON.parse(s)).infos.error?i():void 0!==s.results?(0===s.results.length?n.dispatchEvent("noPathsFound",{type:"StructurePath",anchor:e.get("name"),selected:t.get("name")}):n._renderStructurePaths(s),i()):i()})}else i();else i()},function(e){console.log(e),i()})}else i()})},_expandCall:function(e){var t=s.get3DSpaceUrl()+"/cvservlet/progressiveexpand/v2?tenant="+s.getCurrentTenantName();return new i(function(i,s){n.authenticatedRequest(t,{headers:{Accept:"application/json","Content-Type":"application/json"},method:"POST",data:JSON.stringify(e),onComplete:function(e){i(e)},onFailure:function(e){console.log(e),s(e)},onTimeout:function(e){console.log(e),s(e)}})})},_parseResponse:function(e){if(e&&void 0!==typeof e.paths){if(0===e.paths.length)return void this.dispatchEvent("noPathsFound",{type:"NetworkPath",anchor:this._anchor.get("name"),selected:this._selected.get("name")});e.paths.forEach(function(e){e.forEach(function(e){e.resourceid=e.id,void 0===e.displayName&&(e.type.contains("_to")||e.type.contains("_from")||(e.displayName=e.name))})}),this._setPaths(e.paths,"NetworkPath")}},updateDialogSizeOnResize:function(){if(this._dialog){var e=window.innerHeight-115,t=window.innerWidth-180;this._dialog.height>e&&(this._dialog.height=e),this._dialog.width>t&&(this._dialog.width=t),this._dialog.position.offsetY>50&&(this._dialog.position.offsetY=50),this._dialog._applyPosition(),this._dialog._applyHeight(),this._dialog._applyWidth()}},_close:function(){this._dialog&&(this.dimensions.dialogWidth=this._dialog.width,this.dimensions.dialogHeight=this._dialog.height,this.dimensions.position=this._dialog.position,this.models=[],this._dialog.destroy(),this._dialog=null,this.hide(),this.dispatchEvent("PathPanelViewClose"))},destroy:function(){this._pathSpinner=null,this.pathContentDiv=null,this._pathsContainerNP=null,this._pathsContainerSP=null,this.pathsAccordion=null,this.mainContainer=null,this._dialog&&this._close(),this.container=null,this._parent()}})}),define("DS/SNNavigationMap/utils/TaggerServices",["UWA/Controls/Abstract","UWA/Class/Events","UWA/Core","DS/ENOFilterBIUX/FilterBIComponentProxy","DS/SNNavigationMap/MapSettings","DS/SNNavigationMap/utils/SNNavigationServices","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_internal"],function(e,t,i,n,s,o,a){"use strict";return e.extend(t,{widgetId:null,addVolatileTags:!1,_filterProxy:null,_colorMapsForVolatileTags:{},_summariesForVolatileTags:[],_activate:!0,init:function(e){this.widgetId=e.widgetId,this.addVolatileTags=e.addVolatileTags,this.addVolatileTags&&(this._colorMapsForVolatileTags=e.colorMapsForVolatileTags,this._summariesForVolatileTags=e.summariesForVolatileTags),this.createFilterProxy()},createFilterProxy:function(){var e=this;this._filterProxy||(this._filterProxy=new n({tenant:s.getCurrentTenantName(),appId:s.getAppId(),colorize:!0,widgetId:this.widgetId,isWebInWin:o.isWebInWin(),platformServices:s.getOption("platform_services")}),this._filterProxy.addEvent("fetchFilterBIColorizeEvent",function(t){e._activate&&e.dispatchEvent("Tagger_FilterBIColorize",[t])}),this._filterProxy.addEvent("FilterBIUnColorize",function(t){e._activate&&e.dispatchEvent("Tagger_FilterBIUnColorize")}),this._filterProxy.addEvent("fetchFilterBIFilteringEvent",function(t){e._activate&&e.dispatchEvent("Tagger_FilterBIFilteringEvent",t)}),this._filterProxy.addEvent("ColorizeVolatile",function(t){e._activate&&e.dispatchEvent("Tagger_ColorizeVolatile",t)}),this._filterProxy.addEvent("FilterVolatile",function(t){e._activate&&e.dispatchEvent("Tagger_FilteringVolatile",t)}))},updateFilterProxy:function(e,t){var i=this;t=t||!1,this._filterProxy&&(this.addVolatileTags?this._filterProxy.setTagsWithFetchSynthesis(e,function(e){i._filterProxy.setVolatileTags({summary:i._summariesForVolatileTags,colorMap:i._colorMapsForVolatileTags,paramsFromFBI:e})},t):this._filterProxy.setTagsWithFetchSynthesis(e))},updateVolatileTags:function(e){e&&(this._summariesForVolatileTags=e)},cleanProxy:function(){this._filterProxy&&this._filterProxy.cleanProxy()},removeRoots:function(e){this._filterProxy&&this._filterProxy.removeRoot(e)},deactivate:function(){this._activate=!1,this._filterProxy.deactivate()},activate:function(){this._activate=!0,this._filterProxy.activate()}})}),define("DS/SNNavigationMap/views/PreviewView",["UWA/Core","UWA/Class/View","UWA/Date","UWA/Utils/InterCom","DS/Tree/TreeNodeModel","DS/Controls/TooltipModel","DS/WebappsUtils/WebappsUtils","DS/UIKIT/Modal","DS/UIKIT/Input/Button","DS/UIKIT/DropdownMenu","DS/UIKIT/Spinner","DS/UIKIT/Alert","DS/UIKIT/Tooltip","DS/UIKIT/Accordion","DS/UIKIT/Scroller","DS/PlatformAPI/PlatformAPI","DS/SNNavigationMap/utils/TaggerServices","DS/SNNavigationMap/MapSettings","DS/SNNavigationMap/utils/ProbesUtils","DS/SNNavigationMap/utils/SNNavigationServices","DS/SNNavigationMap/utils/CommonUtils","DS/i3DXCompassPlatformServices/OpenWith","DS/i3DXCompassServices/i3DXCompassPubSub","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_internal"],function(e,t,i,n,s,o,a,r,l,d,c,h,u,g,p,m,f,v,_,N,S,b,w,E){"use strict";return t.extend({_SERVICENAME:"3DSpace",name:"preview",_propertiesCommandRequire:"DS/ENOCollabSharingCmds/commands/EditPropCmd/EditPropCmdBase",_views:[{fonticon:"view-small-tile",text:E.get("TileView"),className:"tileview",loader:"DS/CollectionView/ResponsiveLargeTilesCollectionView",options:{height:"inherit",displayTitleTooltip:!0,displayedOptionalCellProperties:["description","contextualMenu"],useDragAndDrop:!0},layout:{columnMaxWidth:400}},{fonticon:"view-small-thb",text:E.get("ThumbnailView"),className:"thumbnailview",loader:"DS/CollectionView/ResponsiveThumbnailsCollectionView",options:{height:"inherit",allowUnsafeHTMLContent:!1,displayTitleTooltip:!0,displayedOptionalCellProperties:["description","contextualMenu"],useDragAndDrop:!0},layout:{columnMaxWidth:250}}],taggerServices:null,_currentListNodes:{},_currentFilteredNodes:[],_currentModels:{},_isWebInWin:N.isWebInWin(),_widgetId:"",separator:"",collectionsViews:{},direction:"",scrollerElement:null,previewAccordion:null,_accordionOpenedItem:[],className:function(){return this.getClassNames("-container")},setup:function(t){this._compassSocket=new n.Socket("com.ds."+widget.id),this._compassSocket.subscribeServer("com.ds.compass",window.parent),this._getValues("typeLayoutView")||this._saveValues("typeLayoutView","tileview"),this._widgetId=t.widgetId?t.widgetId:null,this.separator=t.separator?t.separator:null,this.modalPreview=new r({className:"modal-preview",closable:!0,header:"<h4>"+E.get("previewUpAndDownstream")+"</h4>",events:{onHide:function(){this.cleanView(),this._cleanPreviewPanel()}.bind(this)}}).inject(this.container),t.direction&&this.setModalTitle(t.direction);var i=e.createElement("div",{class:"actionButton-container"});this.importInGraphButton=new l({value:E.get("addInGraph"),className:"primary extract",disabled:!0,events:{onClick:function(){this._extractNode()}.bind(this)}}).inject(i);new l({value:E.get("close"),className:"default cancel",events:{onClick:function(){this.modalPreview.hide()}.bind(this)}}).inject(i);this.modalPreview.setFooter(i),this.modalBody=e.createElement("div",{class:"modal-body-container"}),this.alertError=new h({lassName:"error"}).inject(this.modalBody);var s=e.createElement("div",{class:"iconbar-container"}).inject(this.modalBody),o=this._views.filter(function(e){return e.className===this._getValues("typeLayoutView")}.bind(this))[0];this._isWebInWin&&e.createElement("span",{class:"fonticon fonticon-search enoripe-preview-searchcommand",title:E.get("MapSearchView_search")}).inject(s).addEventListener("click",this._handleSearch.bind(this));var a=e.createElement("span",{class:"fonticon fonticon-select-all enoripe-preview-selectcommands",title:E.get("Select-Deselect-Nodes")}).inject(s),u=e.createElement("span",{class:"fonticon fonticon-"+o.fonticon,title:o.text}).inject(s);new d({target:u,className:"count-list-layout-dropdown",items:this._views,events:{onClick:function(e,t){this._currentListNodes&&Object.values(this._currentListNodes).length>0&&(this._saveValues("typeLayoutView",t.className),u.set("class",t.elements.icon.className),u.title=t.text,this._showLoading(),this.setPreview(this.sourceId,this._currentListNodes,this.direction))}.bind(this)}}),new d({target:a,className:"count-list-layout-dropdown",items:[{text:E.get("SNNavigationMap.selectAll.Title"),fonticon:"select-all",selectable:!1},{text:E.get("SNNavigationMap.clearSelection.Title"),fonticon:"select-none",selectable:!1}],events:{onClick:function(e,t){"select-all"===t.fonticon?this.selectAllVisibleNodes():this.unselectAll()}.bind(this)}});this.detailsContainer=e.createElement("div",{class:"detailsContainer"}).inject(this.modalBody),this.spinner=(new c).inject(this.modalBody).show(),this.modalPreview.setBody(this.modalBody),this._initTagger()},setPreview:function(t,i,n){var s=[];if(this.cleanView(),i&&(this._currentListNodes=i),t&&(this.sourceId=t),n&&(this.setModalTitle(n),this.direction=n),i&&Object.keys(i).length>0){for(var o in this.previewAccordion=new g({className:"preview-accordion",items:[],exclusive:!1}).inject(this.detailsContainer),i=Object.keys(i).sort(function(e,t){return e.localeCompare(t)}).reduce(function(e,t){return e[t]=i[t],e},{})){var a;this.previewAccordion.addItem({title:o+" ("+i[o].length+")",name:o}),a=e.createElement("div",{class:"collectionContainer"}).inject(this.previewAccordion.getItem(o).elements.content),this._createCollection(o,i[o],a),s=s.concat(i[o])}this._accordionOpenedItem.forEach(function(e){this.previewAccordion.selectItem(e)}.bind(this))}else{e.createElement("div",{class:"noResult",html:E.get("noResult")}).inject(this.detailsContainer);this._hideLoading()}this.scrollerElement=new p({element:this.detailsContainer}).inject(this.modalBody),this._updateFilterProxy([],s)},render:function(e){this.modalPreview.show(),e?this.setModalTitle(e):e="both",this._showLoading(),_.trackUsage("PreviewView","Commands"),_.trackUsage("PreviewView","Options-"+e)},setModalTitle:function(e){var t="";switch(e){case"in":t=E.get("previewUpstream");break;case"out":t=E.get("previewDownstream");break;default:t=E.get("previewUpAndDownstream")}this.modalPreview.setHeader("<h4>"+t+"</h4>")},_createCollection:function(t,i,n){var r=this,l=null,d=[],c={},h=[],u=[],g=0;if(this.collectionsViews[t]&&this.collectionsViews[t].TreedocModel.getSelectedNodes()){h=this.collectionsViews[t].TreedocModel.getSelectedNodes();for(var p=0;p<h.length;p++)u.push(h[p].getAttributeValue("id"))}if(!i||0===i.length){e.createElement("div",{class:"noResult",html:E.get("noResult")}).inject(this.detailsContainer);return this._hideLoading(),this.alertError.add({message:E.get("noDetails"),className:"error"}),void this.alertError.show()}c=this._views.filter(function(e){return e.className===this._getValues("typeLayoutView")}.bind(this))[0],require([c.loader],function(e){for(var h=0;h<i.length;h++){var p,m=i[h],f=m.type,_=v.getDefaultAttributes(),N=(p=void 0!==_[f]?_[f].attributes:_.AllTypes.attributes).map(function(e){return e.uri}),b=S.getTitleLabel(m,N.slice(0,3)),w=S.getTitleLabel(m,N.slice(3,6)),I=m.preview_url?m.preview_url:a.getWebappsAssetUrl("SNNavigationMap","icons/thumbnailLargeDefault.png"),C={label:b,icons:[m.type_icon_url],subLabel:w,thumbnail:I,contextualMenu:"A",customTooltip:new o({shortHelp:b,longHelp:this._getLongHelp(m,p)}),grid:{id:m.id,type:m.type,element:m}};m.instances&&m.instances.length>0&&(C.description=m.instances.length+" ",m.instances.length>1?C.description+=E.get("instances"):C.description+=E.get("instance")),d.push(new s(C))}d.sort(function(e,t){return e.getAttributeValue("label").localeCompare(t.getAttributeValue("label"))}),c.options.onDragStartCell=this._onDragStart.bind(this),(l=new e(c.options)).selectionBehavior={unselectAllOnEmptyArea:!0,toggle:!0,canMultiSelect:!0,canInteractiveMultiselectWithCheckboxClick:!0,enableShiftSelection:!0,enableFeedbackForActiveCell:!1},l.layout&&l.layout.columnMaxWidth&&(l.layout.columnMaxWidth=c.layout.columnMaxWidth),l.onSelectionAdd(function(e){r._syncObjectToCompass(),1==r._getSelectedNodes().length&&r.importInGraphButton.enable()}),l.onSelectionRemove(function(e){r._syncObjectToCompass(),0==r._getSelectedNodes().length&&r.importInGraphButton.disable()}),l.updateView({updateCellContent:!0}),l.model=d,this._currentModels[t]=d,r._currentFilteredNodes&&r._currentFilteredNodes.length>0&&l.model.forEach(function(e){r._currentFilteredNodes.includes(e.getAttributeValue("id"))||e.hide()}),u.length>0&&l.model.forEach(function(e){u.indexOf(e.getAttributeValue("id"))>-1&&l.selectNodeModel(e,!0,!1)}.bind(this)),l.onContextualEvent={this:r,callback:function(e){r._handleMenuClick(e),e.data.event.stopPropagation()}},l.getContent().inject(n),this.collectionsViews[t]=l,this._updateNls(i),this._hideLoading(),l.onReady(function(){l.getVisibleCellsInViewport();g=l.getContent().getElement(".wux-layouts-gridengine-poolcontainer-rel").getBoundingClientRect().height,n.setStyle("height",g+5)}.bind(this))}.bind(this))},_updateNls:function(e){var t,i,n=this,s={};e.forEach(function(e){if(!e.nlsObj&&!s[e.id]){var t={_attributes:e};s[e.id]=t}}),t=Object.values(s),i=Object.keys(s);var o=S._prepareDataToNls(t);S._getNlsAndProcessData(o,i,s).then(function(e){n._getCollectionsModels(!0).forEach(function(t){Object.keys(e.nlsObj).indexOf(t.getAttributeValue("id"))>-1&&n.updateAttributes(e.nlsObj[t.getAttributeValue("id")],t)})})},getFilteredIds:function(){if(this._currentlyFilteredNodes&&this._currentlyFilteredNodes.length>0)return this._currentlyFilteredNodes;var e=[];return this._getCollectionsModels(!0).forEach(function(t){-1===e.indexOf(t.getAttributeValue("id"))&&e.push(t.getAttributeValue("id"))}),e},getIdsSorted:function(e){var t=[];return this._getCollectionsModels(!0).forEach(function(i){e.indexOf(i.getAttributeValue("id"))>-1&&t.push(i.getAttributeValue("id"))}),t},filterByFading:function(e){this._getCollectionsModels(!0).forEach(function(t){e.includes(t.getAttributeValue("id"))?t.show():t.hide()})},clearSearch:function(){var e=this.getFilteredIds();this._getCollectionsModels(!0).forEach(function(t){e.includes(t.getAttributeValue("id"))?t.show():t.hide()})},_handleSearch:function(){var t=this;if(this._searchModule)this._searchModule.container.toggle();else{var i=e.createElement("li",{class:"Enoripe-SearchContainer"}).inject(this.getElement(".iconbar-container"),"top");require(["DS/SNNavigationMap/views/SearchViewForNative"],function(e){t._searchModule=new e({renderTo:i}),t._searchModule.render(),t.listenTo(t._searchModule,"ENORIPE_performSearch_native",function(e){t.dispatchEvent("ENORIPE_performSearch_native",e)}),t.listenTo(t._searchModule,"ENORIPE_resetSearch_native",function(){t.dispatchEvent("ENORIPE_resetSearch_native")})})}},selectNode:function(e){"All"===e?this.selectAllVisibleNodes():this._getCollectionsModels().forEach(function(t){t.options.data.id===e?t.select():t.unselect()})},selectAllVisibleNodes:function(){for(var e in this.collectionsViews)this.collectionsViews[e].selectAllVisibleNodes()},unselectAll:function(){for(var e in this.collectionsViews)this.collectionsViews[e].unselectAll()},_getSelectedNodes:function(){var e=[];for(var t in this.collectionsViews)e=e.concat(this.collectionsViews[t].TreedocModel.getSelectedNodes());return e},_handleMenuClick:function(e){var t,i=null;e&&e.infos&&e.infos.target?t=e.infos.target:e&&e.data&&e.data.target&&(t=e.data.target),e.cellInfos&&e.cellInfos.cellModel?i=e.cellInfos.cellModel.getAttributeValue("element"):e.context&&e.context.cellInfos&&e.context.cellInfos.cellModel&&(i=e.context.cellInfos.cellModel.getAttributeValue("element"));var n={target:t,items:[],events:{onClick:function(e){e.stopPropagation()},onClickOutside:function(){this.destroy()}}};if(this.dropDownMenu&&(this.dropDownMenu.destroy(),this.dropDownMenu=null),this.dropDownMenu=new d(n),i)if(this._isWebInWin)this.dispatchEvent("ContextualMenuPreviewGroup",{targetId:i.id,targetElement:t}),N.sendToMapWebInWin("onComputeCtxMenu",[i.id]);else{this.dropDownMenu.addItem({text:E.get("Properties"),name:"properties",fonticon:"attributes",handler:function(){this._manageEditProp([i])}.bind(this)});var s=S.getContentForOpenWith(i.id,i.type,i.relTypesTaxonomies);(new b).set3DXContent(s).render(this.dropDownMenu),0==this.dropDownMenu.items.length&&(this.dropDownMenu.items=[{}]),this.dropDownMenu.show(),i.type&&i.type.contains("Document")&&this.dropDownMenu.addItem({text:E.get("Download"),fonticon:"download",handler:function(){this.dispatchEvent("ENORIPE_DownloadDocument",[i.id,i.name])}.bind(this)})}},_extractNode:function(){var e=[],t=[],i=this._getSelectedNodes();i&&i.length>0&&i.forEach(function(i){e.push(i.getAttributeValue("element")),i.getAttributeValue("element").relation&&t.push(i.getAttributeValue("element").relation)}),e.length>0&&(this.dispatchEvent("ENORIPE_extractNode",{sourceIds:this.sourceId,objects:e,links:t}),this.modalPreview.hide(),_.trackUsage("PreviewView","AddInGraph-Commands"),_.trackUsage("PreviewView","AddInGraph-ExtractNumber",e.length))},_onDragStart:function(e,t){var i;if((i=this._getSelectedNodes())&&i.length>0){var n=this._buildCompassData({widgetId:this._widgetId,envId:v.getPlatformId(),selectedModels:i});try{e.dataTransfer.setData("text/searchitems",JSON.stringify(n)),e.dataTransfer.setData("text",JSON.stringify(n))}catch(t){console.log(t),e.dataTransfer.setData("text",JSON.stringify(n))}}return e.stopPropagation(),!1},_fetchAttributes:function(e){var t=this;RelationsServices.fetchAttributes(e).then(function(i){i&&i.nlsObj&&Object.keys(i.nlsObj).length>0&&t._getCollectionsModels(!0).forEach(function(n){Object.keys(i.nlsObj).indexOf(n.getAttributeValue("id"))>-1&&t.updateAttributes(e.nlsObj[n.getAttributeValue("id")],e.attributes,n)})},function(e){console.log("err while fetching tooltip")})},updateAttributes:function(e,t){var i,n,s,a;a=(s=S.getAttributes(t.getAttributeValue("type")).attributes).map(function(e){return e.uri}),i=S.getTitleLabel(e,a.slice(0,3)),n=S.getTitleLabel(e,a.slice(3,6)),t.setLabel(i),t._options.subLabel=n,t._options.customTooltip=new o({shortHelp:i,longHelp:this._getLongHelp(e,s)}),!t._options.preview_url&&e.preview_url&&(t._options.preview_url=e.preview_url),t.updateOptions()},_initTagger:function(){var e=this;this.taggerServices||(this.taggerServices=new f({widgetId:this._widgetId,addVolatileTags:!1}),this.taggerServices.addEvent("Tagger_FilterBIColorize",function(t){e.onFilterBIColorize(t)}),this.taggerServices.addEvent("Tagger_FilterBIUnColorize",function(t){e.onFilterBIUnColorize(t)}),this.taggerServices.addEvent("Tagger_FilterBIFilteringEvent",function(t){e.onFilterBIFilteringEvent(t)}))},_updateFilterProxy:function(e,t){var i=[],n=[],s=0,o=!1;if(this.taggerServices.activate(),e&&e.length>0&&(Object.keys(e.allfilters).length>0||e.volatileFilters&&Object.keys(e.volatileFilters).length>0)&&(o=!0),o){if(e&&e.matchingIDs)for(s=0;s<e.matchingIDs.length;s++)"_"!==e.matchingIDs[s].slice(-2,-1)&&(i.push(e.matchingIDs[s]),n.push([s]))}else for(s=0;s<t.length;s++)i.push(t[s].id),n.push([s]);this.taggerServices.updateFilterProxy(i)},onFilterBIColorize:function(e){var t=[];this.onFilterBIUnColorize(),e.forEach(function(e){t[e.id]=e.color}),this._getCollectionsModels().forEach(function(e){Object.keys(t).includes(e.getAttributeValue("id"))&&e.updateOptions({color:t[e.getAttributeValue("id")]})})},onFilterBIUnColorize:function(){this._getCollectionsModels().forEach(function(e){e.updateOptions({color:""})})},onFilterBIFilteringEvent:function(e){var t=this;for(var i in this._currentFilteredNodes=e.matchingIDs,this.collectionsViews)this._currentModels[i]&&(this.collectionsViews[i].model=this._currentModels[i]);this._getCollectionsModels().forEach(function(e){t._currentFilteredNodes.includes(e.getAttributeValue("id"))?e.show():e.hide()})},_manageEditProp:function(e){var t=this._getSelectedNodes();require([this._propertiesCommandRequire],function(e){var i={getSelectedNodes:function(){var e=[];return t.forEach(function(t){var i={id:t.getAttributeValue("id"),tenant:v.getPlatformId()||"OnPremise",source:"3DSpace",getID:function(){return t.getAttributeValue("id")},getRelationID:function(){return t.getAttributeValue("id")}};e.push(i)}),e}};(new e).launchProperties(i)}.bind(this))},_syncObjectToCompass:function(){var e=this._getSelectedNodes();if(0===e.length)this.updateSelection(null),w.publish("resetTypes");else{var t={widgetId:this._widgetId};w.publish("setTypes",t)}1===e.length&&this.updateSelection(e[0]);var i=this._buildCompassData({widgetId:this._widgetId,envId:v.getPlatformId(),selectedModels:e});this._compassSocket.dispatchEvent("onSetX3DContent",i),this._publishSelectionEvent(e)},_publishSelectionEvent:function(t){var i={metadata:{uid:e.Utils.getUUID(),originUid:this._selectUuid,timestamp:Date.now(),appid:"/no_private_channel",originWidgetId:this._widgetId,ignoreFromSameWidgetId:!1,origin:"SNNavigationMap"},data:{tenant:this._tenant,version:"1.1"}};"undefined"!=typeof widget&&null!==widget&&(void 0!==widget.getValue("x3dSharedId")?i.metadata.appid="/"+widget.getValue("x3dSharedId"):void 0!==widget.getValue("x3dAppId")?i.metadata.appid="/"+widget.getValue("x3dAppId"):void 0!==widget.getValue("appId")&&(i.metadata.appid="/"+widget.getValue("appId")+"_"+widget.id)),i.data.paths=[];for(var n=0;n<t.length;n++)i.data.paths[n]=[t[n].getAttributeValue("id")];try{require(["DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext"],function(e){i.data.changeControl=e.get()})}catch(e){console.warn("No Change")}m.publish("DS/PADUtils/PADCommandProxy/select",i)},updateSelection:function(e){if(null===e){var t={objectId:"",envId:v.getPlatformId(),contextId:"",serviceId:this._serviceName||"3DSpace"};return this._compassSocket.dispatchEvent("onSetObject",t),void this._compassSocket.dispatchEvent("onResetX3DContent",{})}var i={objectId:e.getAttributeValue("id"),envId:v.getPlatformId(),contextId:"",serviceId:this._serviceName||"3DSpace"};if(this._compassSocket.dispatchEvent){this._compassSocket.dispatchEvent("onSetObject",i);var n={widgetId:this._widgetId};w.publish("setTypes",n)}},_buildCompassData:function(t){var i=this,n={};if(e.is(t)){var s=t.selectedModels;if(e.is(s,"array")){n={protocol:"3DXContent",version:"1.1",source:"ENORIPE_AP",widgetId:this._widgetId,data:{items:[]}};var o=[];s.forEach(function(e){var n={envId:t.envId,serviceId:i._serviceName,contextId:"",objectId:e.getAttributeValue("id"),objectType:e.getAttributeValue("type"),displayName:e._options.label,displayType:e.getAttributeValue("type")};o.push(n)}),n.data.items=o}}return n},buildSelectionForNativeApps:function(){for(var e,t={version:"2.1",results:[],structures:[{structure:[]}]},i=this._getSelectedNodes(),n=0;n<i.length;n++)e=JSON.stringify(n+1),t.results.push({id:e,phid:i[n].id}),t.structures[0].structure.push({id:e,show:!0,select:!0,children:[]});return JSON.stringify(t)},_showLoading:function(){this.spinner.show()},_hideLoading:function(){this.spinner.hide()},_getLongHelp:function(e,t){var i="",n="";if(e)for(var s=0;s<t.length;s++)if(void 0!==(n=e[t[s].uri])){var o=t[s].label;if(t[s].uri.contains("modified"))if(""!==n)n=new Date(n).toLocaleString(v.getLang());i=i+o+" : "+n+"\n"}return i},_getValues:function(e){var t;if(e&&(e+="-ENORIPE_AP",t=widget?widget.getValue(e):localStorage.getItem(e)))return t},_saveValues:function(e,t){e&&(e+="-ENORIPE_AP"),e&&t&&(widget?widget.setValue(e,t):localStorage.setItem(e,t))},_getCollectionsModels:function(e){var t=[];for(var i in this.collectionsViews)t=e?t.concat(this.collectionsViews[i].TreedocModel.getRoots()):t.concat(this.collectionsViews[i].model);return t},_cleanPreviewPanel:function(){if(this._currentFilteredNodes=[],this.previewAccordion=null,this._accordionOpenedItem=[],this.collectionsViews){for(var e in this.collectionsViews)this.collectionsViews[e].destroy(),this.collectionsViews[e]=null;this.collectionsViews={}}this.importInGraphButton.disable(),this.taggerServices.cleanProxy(),this.taggerServices.deactivate(),this.dispatchEvent("PreviewHide")},cleanView:function(){if(this.previewAccordion){var e=this.previewAccordion.getUnselectedItems().map(function(e){return this.previewAccordion.getItem(e.id).name}.bind(this));this._accordionOpenedItem=this._accordionOpenedItem.filter(function(t){return e.indexOf(t)<0}),this.previewAccordion.getSelectedItems().forEach(function(e){this._accordionOpenedItem.indexOf(this.previewAccordion.getItem(e.id).name)<0&&this._accordionOpenedItem.push(this.previewAccordion.getItem(e.id).name)}.bind(this))}this.scrollerElement&&(this.scrollerElement.destroy(),this.scrollerElement=null),this.detailsContainer.destroy(),this.alertError.hide()}})}),define("DS/SNNavigationMap/models/CountOnNode",["UWA/Class/Model","UWA/Class/Collection","DS/SNNavigationMap/models/Count","DS/SNNavigationMap/MapSettings","DS/SNNavigationMap/utils/CommonUtils","DS/SNNavigationMap/utils/RelationsServices","DS/WAFData/WAFData"],function(e,t,i,n,s,o,a){"use strict";return e.extend({defaults:{source:"",requestDone:!1,realCounts:null,allCounts:null},setup:function(e){this.set("realCounts",new UWA.Class.Collection([],{model:i})),this.set("allCounts",new UWA.Class.Collection([],{model:i})),this.set("source",e.source)},parse:function(e){e.forEach(function(e){this.get("allCounts").add(this.createCount(e))}.bind(this))},createCount:function(e){return new i(e)},resetRealCount:function(e){this.get("realCounts").reset(),this._buildRealCount(e,"in"),this._buildRealCount(e,"out")},_buildRealCount:function(e,t){var n=[],o=[],a={},r=null;this.getAllCounts(t).forEach(function(l){o=[],"out"===t?n=e.where({modelType:"link",sourceId:l.get("source")}):"in"===t&&(n=e.where({modelType:"link",targetId:l.get("source")})),n.forEach(function(e){s.getMainRelName(e.get("type"))===s.getMainRelName(l.get("name"))&&o.push(e)}),a=l.toJSON(),o.length>0?(a.count=a.count-o.length,a.count>0&&(r=new i(a),this.get("realCounts").add(r))):(a.count=parseInt(a.count),r=new i(a),this.get("realCounts").add(r))}.bind(this))},getCountsNumber:function(e){var t=0;return e.forEach(function(e){t+=parseInt(e.get("count"))}),t},isAllExpanded:function(e){return e?0===this.getCountsNumber(this.getRealCounts(e))||0===this.getRealCounts(e).length:this.isAllExpanded("in")&&this.isAllExpanded("out")},isAllCollapsed:function(e){return e?this.getCountsNumber(this.getRealCounts(e))===this.getCountsNumber(this.getAllCounts(e)):this.isAllCollapsed("in")&&this.isAllCollapsed("out")},isRequestDone:function(){return this.get("requestDone")},getExpandedRelations:function(){var e=[];return this.get("allCounts").filter(function(t){if(this.get("realCounts").get(t.id)){let i=this.get("realCounts").get(t.id);t.get("count")>i.get("count")&&e.push({count:t.get("count")-i.get("count"),relations:t.get("name")})}else e.push({count:t.get("count"),relations:t.get("name")})}.bind(this)),e},hasCount:function(e){return e?this.getCountsNumber(this.getAllCounts(e))>0:this.hasCount("in")||this.hasCount("out")},hasRealCount:function(e){return e?this.getCountsNumber(this.getRealCounts(e))>0:this.hasRealCount("in")||this.hasRealCount("out")},getAllCounts:function(e){return e?this.get("allCounts").where({direction:e}):[...this.getAllCounts("in"),...this.getAllCounts("out")]},getRealCounts:function(e){return e?this.get("realCounts").where({direction:e}):[...this.getRealCounts("in"),...this.getRealCounts("out")]},getRealCountAttribute:function(e,t){return this.getRealCounts(t).map(function(t){return t.get(e)})},getAllCountAttribute:function(e,t){return this.getAllCounts(t).map(function(t){return t.get(e)})}})}),define("DS/SNNavigationMap/views/popups/ExpandNLevel",["UWA/Core","UWA/Class/View","DS/UIKIT/SuperModal","DS/UIKIT/Input/Button","DS/UIKIT/Form","DS/SNNavigationMap/utils/PromisesManager","DS/SNNavigationMap/MapSettings","DS/SNNavigationMap/utils/RelationsServices","DS/SNNavigationMap/utils/ProbesUtils","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_internal"],function(e,t,i,n,s,o,a,r,l,d){"use strict";return t.extend({name:"expandNLevel-view",superModal:null,widgetId:"",selectedNode:[],progressContainer:null,nodesExpandedIdByLevel:[null],expandSessionId:"",continueGetEcosystem:!0,setup:function(e){this._PM=new o({debugMode:"1"===a.getOption("debug_me")}),this.widgetId=e.widgetId},initModal:function(t){var n=this,o={},a=null;if(this.expandSessionId=t.expandSessionId?t.expandSessionId:this.getExpandSessionId(),this.continueGetEcosystem=!0,this.nodesExpandedIdByLevel=[null],t&&t.selectedNode){this.selectedNode=t.selectedNode,o={className:"vertical",grid:"1 2",fields:[{type:"select",label:d.get("NavigationDirectionLabel"),name:"navigationDirection",options:[{label:d.get("UpAndDownstream"),value:"",selected:!0},{label:d.get("Upstream"),value:"in"},{label:d.get("Downstream"),value:"out"}]},{type:"number",label:d.get("HowManyLevelExpand"),value:2,nativeNumber:!0,step:"1",min:"1",max:"5",name:"expandLevel",required:!0}],events:{onSubmit:function(e){e.expandLevel>0&&e.expandLevel<6&&n.setCalculateView(e)}}},a=new s(o);var r=e.createElement("span",{class:"error-text",text:d.get("NumberError")});r.hide(),a.elements.container[1].parentNode.insertBefore(r,a.elements.container[1].nextSibling),a.elements.container[1].addEventListener("blur",function(e){this.value<1||this.value>5?(this.style.borderColor="red",r.show()):(this.style.borderColor="#b4b6ba",r.hide())}),this.superModal=new i({renderTo:widget.body,className:"Enoripe-Modal-ExpandNLevel",animate:!0,events:{onHide:function(e){}.bind(this)}}),this.superModal.dialog({body:a,title:d.get("ExpandNLevelTitle")+" - 1/2",buttons:[{className:"primary",value:d.get("Calculate"),action:function(){a.submit()}},{value:d.get("cancel"),action:function(e){this.closeModal(e)}.bind(this)}]}),this.superModal.modals.current.elements.close.addEventListener("click",function(){this.closeModal(this.superModal.modals.current)}.bind(this))}},setCalculateView:function(t){var i,n,s=parseInt(t.expandLevel);this.progressContainer=e.createElement("div",{class:"progressContainer"}),n=e.createElement("div",{class:"progress w-0-percent",id:"self-animated"}).inject(this.progressContainer),i=e.createElement("div",{class:"separatorContainer"}).inject(n);for(var o=0;o<s;o++)e.createElement("div",{class:"separatorLevel","data-after":d.get("level")+" "+(o+1),styles:{width:"calc(100%/"+s+")",left:"calc((100%/"+s+")*"+o+")"}}).inject(i);e.createElement("div",{class:"progress-bar"}).inject(n),e.createElement("label",{id:"self-animated-label",text:d.get("Uploading")+"..."}).inject(n),this.superModal.dialog({body:this.progressContainer,title:d.get("ExpandNLevelTitle")+" - 2/2",buttons:[{className:"primary btn-create",value:d.get("OK"),disabled:!0},{value:d.get("cancel"),action:function(e){this.closeModal(e)}.bind(this)}]}),this.superModal.next();var a={progressLevel:0,expandLevel:s,selectedNode:this.selectedNode};t.navigationDirection&&(a.direction=t.navigationDirection),this._getEcosystemByLevel(a)},endUploading:function(t,i,n,s){var o,r=null,c=null,h=0;(r=this.progressContainer.getElement("#self-animated-label"))&&r.setText(d.get("UploadComplete")),this.progressContainer.getElement(".progress").addClassName("progress-success"),o=e.createElement("div",{class:"uploadCommentContainer"}).inject(this.progressContainer),n!=i&&e.createElement("span",{class:"endingLevel",text:d.get("TheLevel")+" "+i+" "+d.get("noMoreObjects")}).inject(o);for(var u=1;u<t.length;u++)h+=t[u].length;var g=h>1?d.get("objectsExpanded").format(h,i):d.get("objectExpanded").format(h,i);e.createElement("span",{class:"numberObjectsExpanded",text:g}).inject(o),h>0&&(e.createElement("span",{class:"addObjectsText",text:d.get("AddinGraphText")}).inject(o),(c=this.superModal.modals.current.getFooter().getElement(".btn-create")).removeClassName("disabled"),c.disabled=!1,c.addEventListener("click",function(){s=s||"both",l.trackPerformance("expandNLevel","expandNLevel",{Level:n,Direction:s}),a.setOption("fullImportNoOfObjects",h),this.dispatchEvent("ENORIPE_fullImport",{sessionId:this.expandSessionId}),this.closeModal(this.superModal.modals.current)}.bind(this)))},closeModal:function(e){e.hide(),this.superModal.destroy(),this.continueGetEcosystem=!1},getExpandSessionId:function(){var e=new Date,t=e.getDay()+e.getMonth()+e.getFullYear()+"-"+e.getHours()+":"+e.getMinutes()+":"+e.getSeconds();return"ENORIPE_Relations_Expand_"+Math.floor(1e4*Math.random())+"_"+t},_getEcosystemByLevel:function(e){var t,i=this,n=e.progressLevel?e.progressLevel:0,s=e.expandLevel?e.expandLevel:0;t={widgetId:this.expandSessionId,direction:e.direction,fullImportMode:!0},r.getEcosystem(e.selectedNode,t).then(function(t){t=JSON.parse(t),n++,i.progressContainer.getElement(".progress-bar").style.width=Math.round(100/s*n)+"%",i.nodesExpandedIdByLevel[n]=[];for(var o=0;o<t.objects.length;o++){var a=t.objects[o].id;i.nodesExpandedIdByLevel[n].indexOf(a)<0&&e.selectedNode.indexOf(a)<0&&i.nodesExpandedIdByLevel[n].push(a)}if(i.nodesExpandedIdByLevel=i.nodesExpandedIdByLevel.map(JSON.stringify).reverse().filter(function(e,t,i){return-1===i.indexOf(e,t+1)}).reverse().map(JSON.parse),i.continueGetEcosystem)if(i.nodesExpandedIdByLevel[n]&&i.nodesExpandedIdByLevel[n].length>0&&n<s){var r={progressLevel:n,expandLevel:s,selectedNode:i.nodesExpandedIdByLevel[n],direction:e.direction};i._getEcosystemByLevel(r)}else i.endUploading(i.nodesExpandedIdByLevel,n,s,e.direction)},function(){i.endUploading(i.nodesExpandedIdByLevel,n,s,e.direction)})}})}),define("DS/SNNavigationMap/views/SplittedDropView",["UWA/Core","UWA/Class/View","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_internal","DS/SNNavigationMap/utils/SNNavigationServices"],function(e,t,i,n){"use strict";return t.extend({name:"SDV-drop",_zonesCounter:{add:0,replace:0},className:function(){return this.getClassNames("-container")},setup:function(){this._addContentDiv=e.createElement("div",{class:"drop-zone add-content",html:{tag:"div",html:[{tag:"span",class:"fonticon fonticon-popup"},{tag:"p",html:i.get("dropAddContent")}]}}),this._replaceContentDiv=e.createElement("div",{class:"drop-zone replace-content",html:{tag:"div",html:[{tag:"span",class:"fonticon fonticon-shuffle"},{tag:"p",html:i.get("dropReplaceContent")}]}}),this._addContentDiv.addEventListener("dragenter",this._onDragEnter.bind(this)),this._addContentDiv.addEventListener("dragleave",this._dragleave.bind(this)),this._addContentDiv.addEventListener("drop",this._onDrop.bind(this)),this._replaceContentDiv.addEventListener("dragenter",this._onDragEnter.bind(this)),this._replaceContentDiv.addEventListener("dragleave",this._dragleave.bind(this)),this._replaceContentDiv.addEventListener("drop",this._onDrop.bind(this)),this.container.addEventListener("dragover",this._onDragOver),this.container.setContent(this._replaceContentDiv,this._addContentDiv),this.container.hide()},show:function(e,t){"none"===this.container.getStyle("display")&&(this.container.setStyle("width",e+"px"),"extract"===sessionStorage.getItem("ENORIPE_currentDrag")||!0===t?(this._addContentDiv.addClassName("full"),this._replaceContentDiv.hide()):(this._addContentDiv.removeClassName("full"),this._replaceContentDiv.show())),this.container.show()},hide:function(){this.container.getElements(".current-dragover").forEach(function(e){e.removeClassName("current-dragover")}),this.container.hide(),this._zonesCounter.add=0,this._zonesCounter.replace=0,this.dispatchEvent("ENORIPE_SDV_hide",[])},_onDragOver:function(e){e.stopPropagation(),e.preventDefault()},_onDragEnter:function(e){var t=e.currentTarget;e.stopPropagation(),e.preventDefault(),t.hasClassName("add-content")?this._zonesCounter.add++:this._zonesCounter.replace++,t.addClassName("current-dragover")},_dragleave:function(e){var t,i=e.currentTarget;e.stopPropagation(),e.preventDefault(),i.hasClassName("add-content")?(this._zonesCounter.add--,t=this._zonesCounter.add):(this._zonesCounter.replace--,t=this._zonesCounter.replace),0===t&&(i.removeClassName("current-dragover"),this.container.getElement(".current-dragover")||this.hide())},_onDrop:function(t){t.stopPropagation(),t.preventDefault(),this.hide();for(var i,s,o,a=e.is(t.dataTransfer.types.indexOf,"function")?"indexOf":"contains",r="",l=["text/searchitems","text/plain","Text"],d=t.currentTarget.hasClassName("add-content")?"add":"replace",c=0;c<l.length&&""===r;c++)o=t.dataTransfer.types[a](l[c]),(e.is(o,"number")&&o>=0||e.is(o,"boolean")&&!0===o)&&(r=l[c]);""===r?n.sendToMapWebInWin("RefreshOnDrop",[],d)||this.dispatchEvent("ENORIPE_dropNotSupported"):((s=t.dataTransfer.getData(r)).length&&(i=JSON.parse(s),d&&"add"===d&&i.action&&(d=i.action)),this.dispatchEvent("ENORIPE_drop",[d,i]),sessionStorage.removeItem("ENORIPE_currentDrag"))},updateHeight:function(e,t){t&&this.container.setStyle("width",t),this._addContentDiv.setStyle("height",e+"px"),this._replaceContentDiv.setStyle("height",e+"px")},_getFreeZoneWidth:function(){var e=document.querySelector(".list-view-container"),t=null,i=null;if(e&&!e.isHidden()&&(t=e.querySelector("div.wux-windows-docking-element-free-zone.wux-docking-element-right")),t){if(i=t.getStyle("width"))return parseFloat(i.substr(0,i.length-2))}else{var n=document.getElementById("svg-root").getStyle("width");if(n)return parseFloat(n.substr(0,n.length-2))-50}return window.innerWidth}})}),define("DS/SNNavigationMap/views/elements/Links",["UWA/Class","UWA/Core","DS/Controls/TooltipModel","DS/SNNavigationMap/utils/CommonUtils","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_internal"],function(e,t,i,n,s){"use strict";return e.extend({svgNS:null,init:function(){this.svgNS={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"}},createNode:function(e){var n=t.extendElement(document.createElementNS(this.svgNS.svg,"g")),o=t.extendElement(document.createElementNS(this.svgNS.svg,"title")),a=t.extendElement(document.createElementNS(this.svgNS.svg,"path")),r=t.extendElement(document.createElementNS(this.svgNS.svg,"text")),l=t.extendElement(document.createElementNS(this.svgNS.svg,"textPath")),d=!0===e.source.focus||!0===e.target.focus,c="link col"+e.source.columnID+"-col"+e.target.columnID,h=e.display_name_attributes,u="",g=e.instancelink?e.instanceTargetId:e.target.id;if(a.setAttributes({id:"from_"+e.source.id+"_to_"+g,class:"path-element",fill:"none","marker-end":d?"url(#node-arrow-focus)":"url(#node-arrow)"}),r.setAttributes({class:"labelText","text-anchor":"middle",dy:-5,"font-size":"13px"}),l.setAttributeNS(this.svgNS.xlink,"href","#from_"+e.source.id+"_to_"+g),l.setAttribute("startOffset","50%"),(u=h&&h.length?s[e[h[0]]]||e[h[0]]:s[e.type+"_short"]||s[e.type]||e.type).length>12)var p=u.slice(0,12)+"...";p?l.setContent(p):l.setContent(u),r.setContent(l),o.setContent(u),n.setAttribute("class",d?c+" focus":c),e.instancelink&&(n.addClassName("displaynone"),n.addClassName("duplicate")),n.setAttribute("id",e.id),n.setContent([a,r]);var m=new i({shortHelp:this.getShortHelp(e),longHelp:this.getLongHelp(e),longHelpImageDimension:{x:2e3,y:1e3}});return n.tooltipInfos=m,n},updateLabel:function(e,t){var i=n.getRelationLinkNls(t);e.setContent(i)},getShortHelp:function(e){var t="",i="";return e&&(i=n.getRelationLinkNls(e)),i&&(t=i),t},getLongHelp:function(e){var t="";if(e){var i=n.getMainRelName(e.type),o=s[i+"_short"]||s[i]||s[e.type];o&&(t=o)}return t}})}),define("DS/SNNavigationMap/views/elements/RoundedRect",["UWA/Class","UWA/Core","UWA/Utils/Client","DS/WebappsUtils/WebappsUtils","DS/SNNavigationMap/MapSettings","DS/SNNavigationMap/utils/CommonUtils","DS/TransientWidget/TransientWidget","DS/UIKIT/DropdownMenu","UWA/Date","DS/i3DXCompassPlatformServices/OpenWith","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_internal","DS/SNNavigationMap/utils/SNNavigationServices","UWA/Class/Events","DS/Controls/TooltipModel"],function(e,t,i,n,s,o,a,r,l,d,c,h,u,g){"use strict";return e.extend(u,{name:"Rounded-Rect",STRLIMIT:20,NODEWIDTH:170,THUMBNAILHEIGHT:130,PADDINGTOPINSTANCELIST:5,svgNS:null,mainContainer:null,_UncheckedIcon:n.getWebappsAssetUrl("SNNavigationMap","icons/16/MultiSel_Unchecked.png"),_CheckedIcon:n.getWebappsAssetUrl("SNNavigationMap","icons/16/MultiSel_Checked.png"),init:function(e){this._selector=e,this.svgNS={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"}},createNode:function(e){if(e.isGhost)return this.createGhost(e);this.mainContainer=t.extendElement(document.createElementNS(this.svgNS.svg,"g"));var i,n,o,a=t.extendElement(document.createElementNS(this.svgNS.svg,"g")),r=(t.extendElement(document.createElementNS(this.svgNS.svg,"title")),t.extendElement(document.createElementNS(this.svgNS.svg,"rect"))),l=t.extendElement(document.createElementNS(this.svgNS.svg,"foreignObject")),d=null,c=null,u=null,g=null,p=null,m=t.extendElement(document.createElementNS(this.svgNS.svg,"text")),f=null;return n=(o=!1!==s.getThumbnailsMode()&&!!e.preview_url)?90:25,e.preview_url&&((g=t.extendElement(document.createElementNS(this.svgNS.svg,"image"))).setAttributeNS(this.svgNS.xlink,"href",e.preview_url),g.setAttributes({class:"thumbnail-image",x:10,y:10,height:110,width:150})),e.type_icon_url&&((p=t.extendElement(document.createElementNS(this.svgNS.svg,"image"))).setAttributeNS(this.svgNS.xlink,"href",e.type_icon_url),p.setAttributes({x:o?5:20,y:n,height:16,width:16,class:"map-type-icon"})),r.setAttributes({class:"background",width:this.NODEWIDTH,height:o?this.THUMBNAILHEIGHT:65}),(c=t.extendElement(document.createElementNS(this.svgNS.svg,"rect"))).setAttributes({class:"small-rect",x:5,y:85,height:42,width:160}),(d=t.extendElement(document.createElementNS(this.svgNS.svg,"rect"))).setAttributes({class:"thumbnail-background",x:5,y:5,width:160,height:o?120:55}),o?this.mainContainer.setAttribute("data-height",130):this.mainContainer.setAttribute("data-height",65),l.setAttributes({x:0,y:0,class:"drag-shape-container",width:this.NODEWIDTH,height:o?this.THUMBNAILHEIGHT:65}),u=t.createElement("div",{class:"drag-shape",draggable:"true","data-id":e.id}),l.setContent(u),this.setDragEvents(u,e),this.layoutingOn&&u.setStyle("display","none"),i=this._createMultiSelIcon(e),e.preview_url&&t.extendElement(document.createElementNS(this.svgNS.xhtml,"img")).setAttributes({src:e.preview_url}),m.setAttributes({class:"node-text",x:o?25:40,y:n}),this.mainContainer.setAttributes({class:"node"+(e.focus?" focus":"")+(e.preview_url?"":" no-thumbnail"),id:"container-"+e.id,"data-id":e.id}),a.setAttributes({class:"nodeReference",id:"referenceContainer-"+e.id,"data-id":e.id}),m.setContent(this.wrapText(e.name,o)),a.setContent([r,d,g,c,p,m,l,i]),this.mainContainer.setContent([a]),f=h.isWebInWin()?"":this._createForeignObject(e,this.mainContainer),this.mainContainer.addContent([f]),this._addInstancesList(this.mainContainer,e),e.instances&&e.instances.length>0&&this.toggleListInstances(this.mainContainer,s.getInstancesMode()),e.nlsObj||this.dispatchEvent("ENORIPE_GetNlsAttrInfo",e.id),this.mainContainer},createGhost:function(e){var i=t.extendElement(document.createElementNS(this.svgNS.svg,"g")),n=t.extendElement(document.createElementNS(this.svgNS.svg,"g")),s=t.extendElement(document.createElementNS(this.svgNS.svg,"text")),o=t.extendElement(document.createElementNS(this.svgNS.svg,"rect")),a=null;return(a=t.extendElement(document.createElementNS(this.svgNS.svg,"image"))).setAttributeNS(this.svgNS.xlink,"href",e.type_icon_url),a.setAttributes({x:25,y:25,height:16,width:16,class:"ghost-icon"}),o.setAttributes({class:"ghostBackground",width:this.NODEWIDTH,height:65}),s.setAttributes({class:"node-text",x:50,y:38}),s.setContent(e.name),i.setAttributes({class:"node ghost"+(e.focus?" focus":""),id:"container-"+e.id,"data-id":e.id,"data-height":65}),n.setAttributes({class:"nodeReference",id:"referenceContainer-"+e.id,"data-id":e.id}),n.setContent([o,a,s]),i.setContent([n]),i},createThumbnail:function(e,i){if(e&&i&&!e.getElement(".thumbnail-image")){var n=e.getElement(".thumbnail-background"),s=t.extendElement(document.createElementNS(this.svgNS.svg,"image"));s.setAttributeNS(this.svgNS.xlink,"href",i),s.setAttributes({class:"thumbnail-image",x:10,y:10,height:110,width:150}).inject(n,"after")}},_createInstanceText:function(e,i,n){var s=this,o=this._trim(e.name),a="instance-text";return this._trim(e.name)||(o=c.get("noTitle"),a+=" noTitle"),t.createElement("span",{class:a,id:"instance-"+e.id,text:o,events:{click:function(e){e.stopPropagation(),"chrome"===t.Utils.Client.Engine.name&&e&&e.detail&&"true"===e.detail.isCustom||s._toggleInstance(n,this,i.id)}}})},_createForeignObject:function(e,i){var n,o=this,a=t.extendElement(document.createElementNS(this.svgNS.svg,"foreignObject"));return n=!1!==s.getThumbnailsMode()&&!!i.getElement(".thumbnail-image"),a.setAttributes({class:"foreign-object-count-mobile",x:130,y:n?95:35,height:40,width:40}),a.setContent(t.createElement("span",{class:"fonticon-2x fonticon fonticon-chevron-down",events:{click:function(n){"chrome"===t.Utils.Client.Engine.name?"true"===n.detail.isCustom&&(o.dropDownMenu&&o.dropDownMenu.options.target===this?(o.dropDownMenu.destroy(),o.dropDownMenu=null):o._showDropDownContextualMenu(e,i)):o.dropDownMenu&&o.dropDownMenu.options.target===this?(o.dropDownMenu.destroy(),o.dropDownMenu=null):o._showDropDownContextualMenu(e,i)}}})),a.addEvent("click",function(e){e.stopPropagation()}),i.addEventListener("contextmenu",function(t){o._showDropDownContextualMenu(e,i)}),a},_createMultiSelIcon:function(e){var i=t.extendElement(document.createElementNS(this.svgNS.svg,"image")),n=!0===e.focus?this._CheckedIcon:this._UncheckedIcon;return i.setAttributeNS(this.svgNS.xlink,"href",n),i.setAttributes({class:"multiSel-mapView-icon","data-id":e.id,"data-checked":e.focus||!1,x:149,y:5,width:16,height:16}),i},_getLongHelp:function(e,t){var i="",n="";if(e)for(var o=0;o<t.length;o++)if(void 0!==(n=e[t[o].uri])){var a=t[o].label;if(t[o].uri.contains("modified"))if(""!==n)n=new Date(n).toLocaleString(s.getLang());i=i+a+" : "+n+"\n"}return i},_showDropDownContextualMenu:function(e,t){var i=this,n=200,s=t.getElement(".foreign-object-count-mobile"),a={target:s.firstChild,renderTo:s,position:"bottom left",events:{onHide:function(){i.dropDownMenu.destroy(),i.dropDownMenu=null,s.setAttributes({height:40,width:40})},onShow:function(){this.items&&this.items.length>0&&(n=45*this.items.length+50),s.setAttributes({height:n||200,width:1e3})}},items:[{text:c.get("previewUpAndDownstream"),fonticon:"eye",handler:function(){i.dispatchEvent("ENORIPE_ShowPreview",{modelId:e.id})}}]};e.type&&e.type.contains("Document")&&a.items.push({id:e.id,name:e.name,text:c.get("Download"),fonticon:"download",handler:function(t){t.stopPropagation(),i.dispatchEvent("ENORIPE_downloadDocument",[e.id,e.name])}}),this.dropDownMenu&&(this.dropDownMenu.destroy(),this.dropDownMenu=null),this.dropDownMenu=new r(a),this.dropDownMenu.inject(s),this.dropDownMenu.items&&this.dropDownMenu.items.length>0&&(n=45*this.dropDownMenu.items.length+50),s.setAttributes({height:n||200,width:200});var l=o.getContentForOpenWith(e.id,e.type,e.relTypesTaxonomies);(new d).set3DXContent(l).render(this.dropDownMenu);this.dispatchEvent("ENORIPE_movetofront",t),this.dispatchEvent("ENORIPE_movetofront",s),setTimeout(function(){this.dropDownMenu.show()}.bind(this),50)},updateLabel:function(e,t){var i,n=t.ids[0],a=t.attrs.slice(0,3),r=o.getTitleLabel(t.nlsObj[n],a);i=!1!==s.getThumbnailsMode()&&!!e.getElement(".thumbnail-image"),e.getElement(".node-text").setContent(this.wrapText(r,i))},updateToolTip:function(e,t,i){e&&t&&t.nlsObj&&t.nlsObj.hasOwnProperty(i)&&(e.tooltipInfos=new g({shortHelp:o.getTitleLabel(t.nlsObj[i],t.attrs.slice(0,3)),longHelp:this._getLongHelp(t.nlsObj[i],t.attributes)}))},updateListInstancesSize:function(e,t){var i=e.getElement("#toggleMoreInstance"),n=e.getElement(".instance-list-g");0!=(t=parseInt(t))&&(t=23*(i?n.getElements(".instance-text").length+1:n.getElements(".instance-text").length)+10),e.getElement(".instance-expander-g").style.transform="translateY("+t+"px)",e.getElement(".foreign-object-instances").setAttribute("height",t),e.getElement(".rect-list-instance").setAttribute("height",t)},toggleListInstances:function(e,t){var i=e.getElement(".instance-list-g"),n="fonticon-expand-up";(t=void 0!==t?t:!i.classList.contains("expand"))?(this.updateListInstancesSize(e),i.classList.add("expand")):(i.classList.remove("expand"),this.updateListInstancesSize(e,0),n="fonticon-expand-down"),e.getElement(".foreign-object-expand .fonticon").className="fonticon "+n},removeSelectedInstance:function(e,t){var i=e.getElement(".instance-text.select");if(i){var n=i.id.replace("instance-","");i.classList.remove("select"),this.dispatchEvent("ENORIPE_toggleInstance",{nodeId:t,selected:null,instanceId:n})}},_addInstancesList:function(e,i){if(i.instances){var n,o=this,a=Math.min(i.instances.length,s.getOption("showInstancesLimit")),r=t.extendElement(document.createElementNS(this.svgNS.svg,"g"));r.setAttribute("class","instance-expander-g"),r.tooltipInfos=new g({shortHelp:c.get("expander-help")});var l=t.extendElement(document.createElementNS(this.svgNS.svg,"rect"));n=!1!==s.getThumbnailsMode()&&!!i.preview_url,l.setAttributes({width:45,height:15,class:"rect-bkg-instance",y:n?130:65,x:65}),l.inject(r);var d=t.extendElement(document.createElementNS(this.svgNS.svg,"foreignObject"));d.inject(r),d.setAttributes({class:"foreign-object-expand",x:80,y:n?129:64,height:40,width:40}),d.setContent(t.createElement("span",{class:"fonticon-1x fonticon fonticon-expand-down "}));var h,u=t.extendElement(document.createElementNS(this.svgNS.svg,"g"));u.setAttributes({class:"instance-list-g"}),(h=t.extendElement(document.createElementNS(this.svgNS.svg,"rect"))).setAttributes({class:"rect-list-instance",y:n?this.THUMBNAILHEIGHT:68,width:o.NODEWIDTH,height:0}),h.inject(u);var p=t.extendElement(document.createElementNS(this.svgNS.svg,"foreignObject"));p.inject(u),p.setAttributes({class:"foreign-object-instances",y:n?this.THUMBNAILHEIGHT+this.PADDINGTOPINSTANCELIST:68+this.PADDINGTOPINSTANCELIST,x:-2,height:0,width:o.NODEWIDTH});for(var m=0;m<a;m++)p.appendChild(this._createInstanceText(i.instances[m],i,u));i.instances.length-a>0&&p.appendChild(t.createElement("span",{class:"toggle-more-instance",id:"toggleMoreInstance",text:"+"+(i.instances.length-a),events:{click:function(n){if(n.stopPropagation(),"chrome"!==t.Utils.Client.Engine.name||!n||!n.detail||"true"!==n.detail.isCustom){for(var s=p.getElements(".instance-text").length;s<i.instances.length;s++)p.appendChild(o._createInstanceText(i.instances[s],i,u));this.remove(),o.updateListInstancesSize(e),o.dispatchEvent("ENORIPE_FetchAttrInfo",i.id)}}}})),r.inject(e),u.inject(e)}},_toggleInstance:function(e,t,i){var n=!0,s=t.id.replace("instance-",""),o=e.getElement(".instance-text.select");o&&o!=t&&o.classList.remove("select"),t.classList.contains("select")?(n=!1,t.classList.remove("select")):t.classList.add("select"),this.dispatchEvent("ENORIPE_toggleInstance",{nodeId:i,selected:n,instanceId:s})},_trim:function(e){if(e)return e.length>this.STRLIMIT?e.slice(0,this.STRLIMIT)+"...":e},wrapText:function(e,i){for(var n,s=[],o=[],a=0,r=0,l=22,d=0,c=0;d<e.length;)0!==c&&1!==c||(d=r+22,a=this._widthOfText(e.substring(r,d)),0===c&&(a+=7),a>=34?l=10:a>22?(l=22-22/a*(a-22),l=Math.floor(l)):l=22),d=r+l,s.push(e.substring(r,d)),r=d,c++;s.length>2&&(s[1]=s[1].substring(0,s[1].length-3)+"...");for(var h=0;h<s.length&&(n=t.extendElement(document.createElementNS(this.svgNS.svg,"tspan")),0===h?n.setAttributes({x:i?26:40,dy:10*(h+1)}):n.setAttributes({x:10,dy:10*(h+1)}),n.setContent(s[h]),o.push(n),1!==h);h++);return o},_widthOfText:function(e){for(var t=0,i=["$","_","<",">","+","~","&"],n="",s=0;s<e.length;s++)"%"===(n=e.charAt(s))||"@"===n?t+=2.2:"#"===n||"$"===n||"?"===n?t+=1.2:n===n.toUpperCase()&&n!==n.toLowerCase()?t+=1.5:-1!==i.indexOf(n)?t+=1.3:t++;return Math.ceil(t)},setDragEvents:function(e,t){var i=this;e.addEventListener("mousedown",function(e){e.stopPropagation()}),e.addEventListener("click",function(e){console.log("click")}),e.addEventListener("dragstart",function(e){e.stopPropagation();var n={protocol:"3DXContent",version:"1.0",source:"ENORIPE_AP",data:{items:i.getSelectedItems({serviceId:"3DSpace",objectId:t.id,objectType:t.type,displayName:t.name})}};i.dispatchEvent("ENORIPE_dragElement",[e,n])})},getFeedbackReorder:function(e){var i;return this._reorderFeedback||(this._reorderFeedback=t.extendElement(document.createElementNS(this.svgNS.svg,"rect"))),i="top"===e?-10:"thumbnailsMode"===s.getThumbnailsMode()?this.THUMBNAILHEIGHT:65,this._reorderFeedback.setAttributes({y:i,id:"reorder-feedback",width:"170px",height:"10px"}),this._reorderFeedback},getSelectedItems:function(e){var t=[],i=!1,n=s.getCurrentTenantName()||"OnPremise";1===this._selector.isMultiSelActivated()?(this._selector.getSelectedItemsForDragAndDrop().forEach(function(s){s.get("id")===e.objectId&&(i=!0),t.push({envId:n,serviceId:"3DSpace",objectId:s.get("id"),objectType:s.get("type"),displayName:s.get("name")})}),!1===i&&(e.envId=n,t.push(e))):(e.envId=n,t.push(e));return t},showColor:function(e,i){var n,s=null;if(n=e.hasClassName("no-thumbnail"),e){var o=e.getElements(".small-rect")[1]||e.getElement(".drag-shape-container");o?((s=t.extendElement(document.createElementNS(this.svgNS.svg,"rect"))).setAttributes({class:"colored-rect-bi",fill:i,x:5,y:5,width:5,height:n?55:120}).inject(o,"after"),n&&(s.style.height=55)):(o=e.closest(".instance-list-g"))&&t.extendElement(document.createElementNS(this.svgNS.svg,"rect")).setAttributes({class:"colored-rect-instance",fill:i,x:5,y:135,width:5,height:25}).inject(o)}}})}),define("DS/SNNavigationMap/collections/NavigationCollection",["UWA/Core","UWA/Class/Collection","DS/SNNavigationMap/MapSettings","DS/SNNavigationMap/models/CountOnNode","DS/WAFData/WAFData","DS/WebappsUtils/WebappsUtils","UWA/Promise","DS/PlatformAPI/PlatformAPI","DS/SNNavigationMap/utils/CommonUtils","DS/SNNavigationMap/utils/ProbesUtils","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_internal"],function(e,t,i,n,s,o,a,r,l,d,c){"use strict";return t.extend({updateColumnId:!1,instancesMatch:{},currentModelId:0,_noLinkedNodesIds:[],_requests:[],_layoutRecomputeReq:!0,setup:function(e,t){this.add(e),this._layoutUtils=t.layoutUtils,this._widgetId=t.widgetId||null,this._savedColumns=t.savedColumns||{},this._debug=t.debugMode||!1},parse:function(e){var t=[],i=this,s=0;try{e=JSON.parse(e)}catch(e){}return e.objectsAndLinksBySteps||(e.objectsAndLinksBySteps=[e]),e.unindexedObjects&&e.unindexedObjects.length>0&&this.dispatchEvent("ENORIPE_someObjectsNotIndex",e.unindexedObjects.length),e.objectsAndLinksBySteps.forEach(function(e){e.objects.forEach(function(e){if(!i.get(e.id)){var a=i._savedColumns||{};if(e.modelType="node",e.instances)for(var r=0;r<e.instances.length;r++)i.instancesMatch[e.instances[r].id]=e.id;e.level=s,t.push(e),e.isGhost&&(e.name=c.get("GhostName"),e["ds6w:label"]=c.get("GhostName"),e.type_icon_url=o.getWebappsAssetUrl("SNNavigationMap","icons/ghost_icon.png")),0===i.length&&(e.columnID=a[e.id]||0,i._savedColumns[e.id]=e.columnID),e.counts=new n({source:e.id})}}),e.links.forEach(function(e){if(0===i.where({uniqueId:e.uniqueId}).length&&!e.isReflexive){t.some(function(t){return t.uniqueId===e.uniqueId})||(e.modelType="link","in"===e.direction&&(e=l.switchRelationsDirection(e)),t.push(e))}})}),s++,t},setColumnIds:function(e){this._savedColumns=e},getReferenceModel:function(e){var t=this.get(e);if(!t){var i=this.filter(function(e){return"link"===e._attributes.modelType}).find(function(t){return t.get("instanceTargetId")&&t.get("instanceTargetId")===e});i&&i.get("target").id&&(t=this.get(i.get("target").id))}return t},fullImport:function(e){var t=this,n={widgetIdTo:i.getWidgetId(),timeout:i.getTimeout(),label:i.getLabelAPI()};e&&(n.widgetIdFrom=e),d.setStartTime("fullImport"),this.fetch({url:i.get3DSpaceUrl()+"/resources/enorelnav/v2/navigate/fullImport?tenant="+i.getCurrentTenantName(),data:JSON.stringify(n),remove:!1,timeout:i.getTimeout(),onComplete:function(e,i){i=JSON.parse(i),t._prepareNodesAndLinks(e)}})},getFocusedNode:function(){return 1===this.length?this._models[0]:this.findWhere({focus:!0})},getEcoSystem:function(e){this.currentModelId=e.id,this._isBusy();var t={widgetId:e.widgetId?e.widgetId:i.getWidgetId(),label:i.getLabelAPI(),lang:i.getLang(),ids:e.ids?e.ids:[],trueREST:!1,direction:"both",restrictedMode:!!e.restrictedMode&&e.restrictedMode,responseMode:e.responseMode?e.responseMode:"ObjectsAndLinks"};return!e.direction||"in"!==e.direction&&"out"!==e.direction||(t.direction=e.direction),e.relations&&e.relations.length>0&&(t.relations=e.relations),e.trueREST&&!0===e.trueREST&&(trueREST=!0,t.relations=["use-auto-by-type-relations"],t.widgetId=i.getUniqueId(),i.getOption("LastUsedProfile")&&"AutoModeProfile"!==!i.getOption("LastUsedProfile")||(t.relations=i.getOption("currentRelations"))),d.setStartTime("getecosystem",Date.now()),i.setOption("ecosystemNoOfObjects",this.getNoOfObjects(t.ids)),new a(function(n){this.fetch({url:i.get3DSpaceUrl()+"/resources/enorelnav/v2/navigate/getEcosystem?tenant="+i.getCurrentTenantName(),data:JSON.stringify(t),remove:!1,timeout:i.getTimeout(),onComplete:function(){this._prepareNodesAndLinks(this),n()}.bind(this),onFailure:function(t){console.log(t),that.dispatchEvent("ENORIPE_handleErrorMsgs",[e]),reject(t)},onTimeout:function(e){console.log(e),reject(e)}})}.bind(this))},getNotSelectedNodes:function(){return this.filter(function(e){return"node"===e.get("modelType")&&!0!==e.get("focus")})},removeNodes:function(e){var t=this,i=[];return new a(function(n){(i=this.getRemovedObject(e))&&(i.removedObjectsId.forEach(function(e){this.remove(e)}.bind(this)),t._setColumnBasedOnLayout(),n())}.bind(this))},getRemovedObject:function(e){for(var t=[],i=[],n=[],s=[],o=[],a=0;a<e.length;a++){for(var r=this.filter(function(t){return"link"===t.get("modelType")&&(t.get("target")===e[a]._attributes||t.get("source")===e[a]._attributes)}),l=0;l<r.length;l++)-1===i.indexOf(r[l].id)&&i.push(r[l].id);n=n.concat(r),t.push(e[a].id),e[a]&&e[a]._attributes&&e[a]._attributes.instances&&e[a]._attributes.instances.forEach(function(e){-1===t.indexOf(e.id)&&t.push(e.id)})}return s=(s=s.concat(e)).concat(n),{removedObjectsId:o=(o=o.concat(t)).concat(i),removedNodesId:t,removedLinksId:i,removedObjects:s}},_isBusy:function(){var e=!1,t=[];return this._requests.forEach(function(i){4!==i.xhr.readyState&&(e=!0,t.push(i))}),this._requests=t,e},_prepareNodesAndLinks:function(t){this.trackServices();var i=t.filter(function(t){var i=t._attributes;return"link"===i.modelType&&(e.is(i.source,"string")||e.is(i.target,"string"))});t.where({modelType:"node"});i.forEach(function(e){(t.get(e.get("source"))?e.set("source",t.get(e.get("source"))._attributes):t.instancesMatch[e.get("source")]&&e.set("source",t.get(t.instancesMatch[e.get("source")])._attributes),e.set("sourceId",e.get("source").id),t.get(e.get("target"))?e.set("target",t.get(e.get("target"))._attributes):t.instancesMatch[e.get("target")]&&(e._attributes.target.id?e.set("instanceTargetId",e._attributes.target.id):e.set("instanceTargetId",e._attributes.target),e.set("target",t.get(t.instancesMatch[e.get("target")])._attributes)),e.set("targetId",e.get("target").id),!0!==e.get("instancelink"))&&t.where({source:e.get("source"),target:e.get("target"),"ro.xcadbasedependency.v_cadlinktype":e.get("ro.xcadbasedependency.v_cadlinktype")}).forEach(function(t){t.id!==e.id&&t.get("type")===e.get("type")&&t.set("instancelink",!0)})}),t._setColumnOnNodes(),t.dispatchEvent("ENORIPE_updateProxy")},_setRowBasedOnLayout:function(){var e,t={},i=null;t=this.groupBy("columnID"),e=Object.keys(t).sort(function(e,t){return e-t});for(var n=0;n<e.length;n++){i=t[e[n]].sort(this._sortRow.bind(this));for(var s=0;s<i.length;s++)void 0===i[s].get("rowID")&&i[s].set("rowID",s)}},_setColumnBasedOnLayout:function(e){this._layoutUtils._dagre.layout(this._layoutUtils._graphObject);for(var t,i={},n=null,s=null,o=this._layoutUtils._graphObject.nodes(),a=0;a<o.length;a++)(n=this.get(o[a]))&&(n.set("xColumn",this._layoutUtils._graphObject.node(o[a]).x),n.set("yColumn",this._layoutUtils._graphObject.node(o[a]).y));for(delete(i=this.groupBy("xColumn"))[void 0],t=Object.keys(i).sort(function(e,t){return e-t}),a=0;a<t.length;a++){s=i[t[a]].sort(function(e,t){return e.get("yColumn")-t.get("yColumn")});for(var r=0;r<s.length;r++)s[r].set("columnID",a),this._savedColumns[s[r].id]=a,e&&s[r].set("rowID",r)}this.dispatchEvent("ENORIPE_setSavedColumnIds",["ENORIPE_savedColumnIds",this._savedColumns])},_setColumnOnNodes:function(){this._layoutUtils.setData(this.getLinksAndNodes()),"recompute"!==i.getLayoutMode()&&!0!==this.updateColumnId||(this._setColumnBasedOnLayout("recompute"===i.getLayoutMode()),this.updateColumnId=!1);for(var t=this.groupBy("level"),n=0;n<Object.keys(t).length;n++)if(!isNaN(parseInt(Object.keys(t)[n]))){var s=this,o=t[Object.keys(t)[n]].filter(function(e){return"node"===e.get("modelType")&&void 0===e.get("columnID")}),a=0,r=[],l=[],d=0,c=[],h=[],u=(e.is(this._savedColumns,"string")?JSON.parse(this._savedColumns):this._savedColumns)||{};for(var g in u)this.isLinked(s.get(g)._attributes)&&this._noLinkedNodesIds.indexOf(g)>-1&&(this._noLinkedNodesIds.splice(this._noLinkedNodesIds.indexOf(g),1),o.unshift(s.get(g)));for(var p=0;p<o.length;p++){if(r=s.where({target:o[p]._attributes}),l=s.where({source:o[p]._attributes}),d=r.length+l.length,r.length){for(var m=0;m<r.length;m++)Number.isInteger(r[m].get("source").columnID)&&(((a=this._noLinkedNodesIds.indexOf(r[m].get("source").id))<0||1===d)&&(void 0!==s.get(r[m].get("source").id)?c.push(s.get(r[m].get("source").id)):void 0!==s.get(r[m].get("source"))&&c.push(s.get(r[m].get("source")))),a>-1&&this._noLinkedNodesIds.splice(a,1));c.length>0&&o[p].set("columnID",Math.max.apply(Math,c.map(function(e){return e.get("columnID")}))+1)}if(l.length){for(n=0;n<l.length;n++)Number.isInteger(l[n].get("target").columnID)&&(((a=this._noLinkedNodesIds.indexOf(l[n].get("target").id))<0||1===d)&&(void 0!==s.get(l[n].get("target").id)?h.push(s.get(l[n].get("target").id)):void 0!==s.get(l[n].get("target"))&&c.push(s.get(l[n].get("target")))),a>-1&&this._noLinkedNodesIds.splice(a,1));h.length>0&&o[p].set("columnID",Math.min.apply(Math,h.map(function(e){return e.get("columnID")}))-1)}o[p].get("columnID")||o[p].set("columnID",0),u[o[p].get("id")]=o[p].get("columnID"),r=[],l=[],c=[],h=[],delete o[p]._attributes.level}var f=Object.keys(u).length>0?Math.min.apply(Math,Object.values(u)):0;for(var v in u){for(;Object.values(u).indexOf(u[v]-1)<0&&u[v]!=f;)Object.keys(u).filter(function(e){s.get(e)&&s.get(e).get("columnID")>=u[v]&&(u[e]--,s.get(e).set("columnID",u[e]))});if(s.get(v)){let e=this._noLinkedNodesIds.indexOf(v);!this.isLinked(s.get(v)._attributes)&&e<0&&this._noLinkedNodesIds.push(v)}}this._savedColumns=u,"recompute"!=i.getLayoutMode()&&this._setRowBasedOnLayout(),this.dispatchEvent("ENORIPE_setSavedColumnIds",["ENORIPE_savedColumnIds",u])}},filterOrphanNodes:function(e){var t=this.filter(function(e){return"node"===e.get("modelType")}),n=[],s=[],o=[],a=[];o=i.getRootIds();for(var r=0;r<t.length;r++)n=this.where({target:t[r]._attributes}),s=this.where({source:t[r]._attributes}),0===n.length&&0===s.length&&(o&&o.indexOf(t[r].id)<0||e)&&(this.remove(t[r],{silent:!0}),a.push(t[r].id));return a},reset:function(e){if(this._savedColumns=[],e)for(var t=0;t<e.length;t++)e[t].id&&e[t].columnID>-1&&(this._savedColumns[e[t].id]=e[t].columnID);return this._noLinkedNodesIds=[],this._parent(e)},remove:function(e){return e.id||(e=this.get(e)),e&&(Object.keys(this._savedColumns).indexOf(e.id)>-1&&delete this._savedColumns[e.id],this._noLinkedNodesIds.indexOf(e.id)>0&&this._noLinkedNodesIds.splice(this._noLinkedNodesIds.indexOf(e.id),1)),this._parent(e)},sync:function(t,n,o){var a=this;this._debug&&(e.is(o.data,"string")&&(o.data=JSON.parse(o.data)),o.data.debug=!0,o.data=JSON.stringify(o.data));try{switch(t){case"read":var r=s.authenticatedRequest(o.url,{headers:{Accept:"application/json","Content-Type":"application/json",SecurityContext:i.getXPrefCredential()},method:"POST",data:o.data,timeout:o.timeout,onComplete:o.onComplete,onFailure:function(e){console.log(e);var t={type:"generic"};a.dispatchEvent("ENORIPE_handleErrorMsgs",[t]),a.resetServiceTracker()},onTimeout:function(e){console.log(e);var t={type:"timeout"};a.dispatchEvent("ENORIPE_handleErrorMsgs",[t]),a.resetServiceTracker()}});break;case"create":break;case"update":case"patch":case"delete":break;default:throw new Error('Unsupported method "{0}"'.format(t))}this._requests.push(r)}catch(e){e.message}return{cancel:function(){}}},isLinked:function(e){var t=this.where({target:e}),i=this.where({source:e});return 0!==t.length||0!==i.length},getModelsAttrs:function(e){if(e)return this.where({modelType:e}).invoke("toJSON");this.toJSON()},getLinksAndNodes:function(){var e=[],t=[];return this.filter(function(i){"node"===i.get("modelType")?e.push(i._attributes):"link"===i.get("modelType")&&t.push(i._attributes)}),{nodes:e,links:t}},getNodesIds:function(){return this.getLinksAndNodes().nodes.map(function(e){return e.id})},getNoOfObjects:function(e){var t=0;return"string"==typeof e?t=1:e.length&&(t=e.length),t},setNlsObj:function(e,t){var i=this.get(e);i&&t&&i.set("nlsObj",t)},trackServices:function(){d.getStartTime("getecosystem")&&d.trackPerformance("getecosystem","getecosystem",{NumberOfObjects:i.getOption("ecosystemNoOfObjects")}),d.getStartTime("fullImport")&&d.trackPerformance("fullImport","fullImport",{NumberOfObjects:i.getOption("fullImportNoOfObjects")})},resetServiceTracker:function(){d.stopTime("getecosystem")},_sortRow:function(e,t){var i=0;if("node"===e.get("modelType")&&"node"===t.get("modelType")){if(null!=e.get("rowID"))return-1;if(null!=t.get("rowID"))return 1;if(0===(i=this._groupByLinkType(e,t))){let i=l.getAttributes(e.get("type")).attrs.slice(0,3),n=l.getTitleLabel(e._attributes,i),s=l.getTitleLabel(t._attributes,i);return n.localeCompare(s)}}return i},_groupByLinkType:function(e,t){var i=this.getAllModelLinks(e),n=this.getAllModelLinks(t);if(i.length>0&&n.length>0){let e=l.getRelationLinkNls(i[0]._attributes),t=l.getRelationLinkNls(n[0]._attributes);return e.localeCompare(t)}return-1},getAllModelLinks:function(e){var t,i,n=[];return t=this.where({modelType:"link",sourceId:e.id}),i=this.where({modelType:"link",targetId:e.id}),(n=[...t,...i]).sort(function(e,t){let i=l.getRelationLinkNls(e._attributes),n=l.getRelationLinkNls(t._attributes);return i.localeCompare(n)}),n}})}),define("DS/SNNavigationMap/utils/LayoutUtils",["UWA/Class","DS/DagreShim/DagreShim","DS/SNNavigationMap/MapSettings"],function(e,t,i){return e.extend({init:function(e){this._dagre=t,this.layoutOptions=e},getNodesWidth:function(){return i.getNodesWidth()},getNodesHeight:function(){return i.getNodesHeight()},_setupGraph:function(){this._graphObject&&(this._graphObject=null,delete this._graphObject),this._graphObject=new this._dagre.graphlib.Graph({}).setGraph({rankdir:"LR",align:"DL",ranksep:350,directed:!0,multigraph:!0}).setDefaultEdgeLabel(function(){return{}})},setData:function(e){this._setupGraph();var t=this,i=0;return e.nodes.forEach(function(e){e.instances&&(!0===e.instancesCollapsed||(i=t.getNodesHeightWithInstance(e))),t._graphObject.setNode(e.id,{label:e.name,width:t.getNodesWidth(),height:i})}),e.links.forEach(function(e){t._graphObject.setEdge(e.source.id,e.target.id)}),this},getNodesHeightWithInstance:function(e){var t;return t=e.instances?30*e.instances.length:0,this.getNodesHeight()+t},findLoops:function(){return this._dagre.graphlib.alg.findCycles(this._graphObject)},getPathCoordinates:function(e,t,i,n,s){var o="";return"x"===this.layoutOptions.layoutAxis&&(o=this._getPathCoordinatesXAxis(e,t,i,n,s)),o},_getPathCoordinatesXAxis:function(e,t,n,s,o){var a,r,l=e.source.columnID===e.target.columnID-1||e.source.columnID===e.target.columnID+1,d=e.source.columnID===e.target.columnID,c=e.source.columnID<e.target.columnID,h="",u="",g=0,p=0,m=this.getNodesHeight()/2,f=this.getNodesWidth(),v=e.target.y,_=e.target.x;if(i.getThumbnailsMode()?(g=e.source.preview_url?i.getOption("nodeHeightWtThumb")/2:i.getOption("nodeHeightWtoutThumb")/2,p=e.target.preview_url?i.getOption("nodeHeightWtThumb")/2:i.getOption("nodeHeightWtoutThumb")/2):(g=i.getOption("nodeHeightWtoutThumb")/2,p=i.getOption("nodeHeightWtoutThumb")/2),o.classed("duplicate")&&o.classed("displaynone",!0),e.target.instancesExpanded>0&&e.instanceTargetId){var N=e.target.instances.map(function(e){return e.id}).indexOf(e.instanceTargetId);N>-1&&N<e.target.instancesExpanded&&(o.classed("duplicate")&&o.classed("displaynone",!1),v=e.target.y+17+23*N+p)}return(!d&&!e.target.instancesExpanded||e.target.instancesExpanded<=0)&&n&&c&&(m-=32.5,g-=32.5,p-=32.5),!e.target.counts||!e.target.counts.hasCount("in")||n&&c||(_-=15),!e.source.counts||!e.source.counts.hasCount("out")||n&&c||(f+=15),h=c?e.source.x+f+" "+(e.source.y+g):e.source.x+" "+(e.source.y+g),u=c?_+" "+(v+p):e.target.x+f+" "+(v+p),l?"M"+h+" L "+u:d?(a=e.source.y+(v-e.source.y)/2,h=e.source.x+f+" "+(e.source.y+g),u=e.target.x+f+" "+(v+p),"M"+h+" Q "+(e.target.x+220)+" "+a+" "+u):(c||(t.attr("marker-end")&&(r=t.attr("marker-end").slice(0,-1),r+="-reverse)",t.attr("marker-start",r),t.attr("marker-end",null)),o.attr("transform","rotate(180) translate("+parseFloat(-(e.source.x+(e.target.x+f)))+", "+parseFloat(-(e.source.y+m+(v+m)))+")")),"M"+h+" Q "+(a=e.source.x+(e.target.x-e.source.x)/2)+" 0 "+u)},rotateTextLabel:function(e,t){if("x"===this.layoutOptions.layoutAxis)return this._rotateTextLabelXlayout(e,t)},_rotateTextLabelXlayout:function(e,t){var i=e.source.columnID===e.target.columnID-1||e.source.columnID===e.target.columnID+1,n=(e.source.columnID,e.target.columnID,e.source.columnID<e.target.columnID),s=this.getNodesWidth(),o=this.getNodesHeight()/2,a=e.target.y;if(e.target.instancesExpanded>0&&e.instanceTargetId){var r=e.target.instances.map(function(e){return e.id}).indexOf(e.instanceTargetId);r>-1&&(a=e.target.y+17+23*r+this.getNodesHeight()/2)}if(!n&&i)return"rotate(180) translate("+parseFloat(-(e.source.x+(e.target.x+s)))+", "+parseFloat(-(e.source.y+o+(a+o)))+")"}})}),define("DS/SNNavigationMap/views/NavigationHomePage",["UWA/Core","UWA/Class/View","DS/WAFData/WAFData","DS/SNNavigationMap/MapSettings","DS/SNNavigationMap/utils/ProbesUtils","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_internal","DS/TransientWidget/TransientWidget","DS/WebappsUtils/WebappsUtils","DS/Handlebars/Handlebars4","DS/ENOXTriptych/js/ENOXTriptych","DS/Tree/TreeNodeModel","DS/UIKIT/DropdownMenu","DS/UIKIT/Mask","DS/CollectionView/ResponsiveTilesCollectionView","UWA/Date","DS/SNNavigationMap/utils/SNNavigationServices","DS/Notifications/NotificationsManagerUXMessages","DS/Notifications/NotificationsManagerViewOnScreen","text!DS/SNNavigationMap/assets/templates/homepageleft.html","text!DS/SNNavigationMap/assets/templates/homepageright.html"],function(e,t,i,n,s,o,a,r,l,d,c,h,u,g,p,m,f,v,_,N){"use strict";return t.extend({name:"navigationapp-homepage-view",models:[],_nameLabel:null,_detailLabel1:null,_detailLabel2:null,_thumbnailIcon:r.getWebappsAssetUrl("SNNavigationMap","icons/I_RelatedObjectsFavoriteThumbnail.png"),_smallIcon:r.getWebappsAssetUrl("SNNavigationMap","icons/I_RelatedObjectsFavorite22.png"),className:function(){return this.getClassNames("-container")},setup:function(t){this._debug=t.debugMode,this._widgetId=t.widgetId||null,this._isWebInWin=t.isWebInWin,this._nameLabel=t.nameLabel,this._detailLabel1=t.detailLabel1,this._detailLabel2=t.detailLabel2,this._separator=t.separator,this._tenantId=t.platformId,this._leftWidth=270,this.tempDropZone=!1;var i=l.compile(_),n={header1:o.get("NavHomePage-Header1"),header2:o.get("NavHomePage-Header2"),quickAccess:o.get("NavHomePage-QuickAccess"),favorite:o.get("NavHomePage-Favorite"),recents:o.get("NavHomePage-Recents")},s=l.compile(N),a={header:o.get("NavHomePage-Recents")},r=i.call(null,n),c=s.call(null,a),h=e.createElement("div",{class:"ENORIPE-leftside-container",html:r}),u=e.createElement("div",{class:"ENORipe-rightside-container",html:c}),g=e.createElement("div",{class:"ENORipe-rightside-container-ignore",html:""}),p={left:{originalState:"open",overMobile:!0,minWidth:this._leftWidth,originalSize:this._leftWidth},borderLeft:!0,container:this.container,withtransition:!0,withoverflowhidden:!0};this._triptych=new d,this._triptych.init(p,h,u,g),this._notifManager=f,v.setNotificationManager(this._notifManager),this._setUpEvents()},render:function(){this.container.show();var e=this.getElement("#ENORipe-Favorite"),t=this.getElement("#ENORipe-Recents");this.changeTab(e,t),s.trackUsage("HomePage","OnHomepage")},showObjects:function(t){var i,n,s=null,a="",l="",d="",h=[];this.clearContent();try{if(t.objects&&t.objects.length>0){var u=!1;if(t.objects.forEach(function(e){!1!==e.found&&"false"!==e.found&&(u=!0)}),u){this.responsiveTiles=this._getResponsiveTile({isDraggable:!0});for(var g=0;g<t.objects.length;g++)if(!(s=t.objects[g])||!1!==s.found){a=this._getLabels(s,this._nameLabel),l=this._getLabels(s,this._detailLabel1),d=this._getLabels(s,this._detailLabel2);var p=s.preview_url?s.preview_url:r.getWebappsAssetUrl("SNNavigationMap","icons/thumbnailLargeDefault.png");n=new c({label:a,icons:[s.type_icon_url],subLabel:l,description:d,thumbnail:p,contextualMenu:"A",data:{id:s.id,type:s.type,element:s,name:s.name}}),h.push(n)}this.responsiveTiles.model=h,i=e.createElement("div",{class:"list-tiles-container"}).inject(this.getElement("#ENORipe-Recents-Container"));var m=window.innerHeight-47+"px";i.setStyle("height",m),this.responsiveTiles.getContent().inject(i)}else this.dispatchEvent("ENORIPE_showNotif",{level:"error",lvl:"error",msg:o.get("ObjectNotFound"),container:this.container}),this.showDropInvite(this.getElement("#ENORipe-Recents-Container"))}else this.showDropInvite(this.getElement("#ENORipe-Recents-Container"))}catch(e){console.log(e),this.unmask()}this.unmask()},showFavorites:function(t){var i,s,a=null,r="",l="",d="",h=[],u={};try{if(this.clearContent(),t.favorite&&t.favorite.length>0){this.responsiveTiles=this._getResponsiveTile({isDraggable:!0});for(var g=0;g<t.favorite.length;g++)r=(a=t.favorite[g]).title,l=a.owner+" | "+new Date(a.modified).toLocaleString(n.getLang()),d=o.get(a.profilename),u={label:r,icons:this._smallIcon,subLabel:l,description:d,thumbnail:this._thumbnailIcon,contextualMenu:"A",data:{id:a.id,name:a.favoriteName,element:a,type:"ENORelationalExplorerFavorite",title:a.title,layoutType:a.layoutType||"linearGraph"}},a.rootIds&&(u.data.rootIds=a.rootIds),s=new c(u),h.push(s);this.responsiveTiles.model=h,i=e.createElement("div",{class:"list-tiles-container"}).inject(this.getElement("#ENORipe-Recents-Container"));var p=window.innerHeight-47+"px";i.setStyle("height",p),this.responsiveTiles.getContent().inject(i)}else this.showEmptyView("Favorite")}catch(e){console.log(e),this.unmask()}this.unmask()},changeTab:function(e,t){if(e&&e.id){this.getElements(".ENORipe-ActionContainer .selected").forEach(function(e){e&&e.removeClassName&&e.removeClassName("selected")}),e.addClassName("selected");var i=o.get("NavHomePage-Recents");e.id.contains("Favorite")?(i=o.get("NavHomePage-Favorite"),t?this.dispatchEvent("ENORIPE_HandleFavorite",t):this.dispatchEvent("ENORIPE_HandleFavorite")):e.id.contains("Recents")&&(i=o.get("NavHomePage-Recents"),this.dispatchEvent("ENORIPE_HandleRecents")),this.getElement(".ENORipe-rightside-headertext").innerHTML=i}},mask:function(){u.mask(this.container)},unmask:function(){u.unmask(this.container)},showEmptyView:function(t){var i,n="",s="";switch(i=e.createElement("div",{class:"empty-container"}).inject(this.getElement("#ENORipe-Recents-Container")),t){default:case"Recents":s="fonticon-clock",n=o.get("NoRecentFound");break;case"Favorite":s="fonticon-favorite-on",n=o.get("NoFavoriteFound")}e.createElement("span",{class:"empty-view-icon center-block fonticon "+s+" fonticon-5x"}).inject(i),e.createElement("span",{class:"empty-view-title center-block",html:n}).inject(i),this.unmask()},getSelectedItems:function(e){var t=[],i=this._tenantId,n=null;return e.envId=i,t.push(e),(n=this.responsiveTiles.TreedocModel.getSelectedNodes())&&n.length>0&&n.forEach(function(n){n._options.data.id!==e.objectId&&t.push({envId:i,serviceId:"3DSpace",objectId:n._options.data.id,objectType:n._options.data.type,displayName:n._options.data.title})}),t},showDropInvite:function(t){this._dropInviteContainer=e.createElement("div",{class:"SDV-drop-container"}).inject(t),e.createElement("div",{class:"drop-invite",html:[{tag:"span",class:"wux-ui-3ds wux-ui-3ds-5x wux-ui-3ds-drag-drop"},{tag:"h5",class:"font-3dsregular",html:o.get("dropHere")}]}).inject(this._dropInviteContainer),this._addContentDiv=e.createElement("div",{class:"drop-zone add-content",html:{tag:"div",class:"dropzonemsg-container",html:[{tag:"span",class:"fonticon fonticon-popup"},{tag:"p",html:o.get("dropAddContent")}]}}).inject(this._dropInviteContainer).hide(),this._dropInviteContainer.addEventListener("dragenter",this._onDragEnter.bind(this)),this._addContentDiv.addEventListener("dragenter",this._onDragEnter.bind(this)),this._addContentDiv.addEventListener("dragleave",this._onDragLeave.bind(this)),this._addContentDiv.addEventListener("drop",this._onDrop.bind(this)),this.getElement(".dropzonemsg-container").addEventListener("dragleave",function(e){e.stopPropagation(),e.preventDefault()})},hideDropInvite:function(){this._dropInviteContainer&&this._dropInviteContainer.hide()},removeDropInvite:function(){this._dropInviteContainer&&this._dropInviteContainer.parentNode.removeChild(this._dropInviteContainer)},_onDragEnter:function(e){e.stopPropagation(),e.preventDefault(),this._addContentDiv.show(),this._dropInviteContainer.addClassName("current-dragover")},_onDragLeave:function(e){e.stopPropagation(),e.preventDefault(),this._addContentDiv.hide(),this._dropInviteContainer.removeClassName("current-dragover"),!0===this.tempDropZone&&this.removeDropInvite(),this.tempDropZone=!1},_onDragOver:function(e){e.stopPropagation(),e.preventDefault()},_onDrop:function(t){t.stopPropagation(),t.preventDefault(),this._dropInviteContainer.removeClassName("current-dragover");for(var i,n,s,o=e.is(t.dataTransfer.types.indexOf,"function")?"indexOf":"contains",a="",r=["text/searchitems","text/plain","Text"],l=0;l<r.length&&""===a;l++)s=t.dataTransfer.types[o](r[l]),(e.is(s,"number")&&s>=0||e.is(s,"boolean")&&!0===s)&&(a=r[l]);if(""===a){if(!m.sendToMapWebInWin("RefreshOnDrop",[],"replace"))return this.dispatchEvent("ENORIPE_dropNotSupported"),void this._addContentDiv.hide();this.hideDropInvite(),this.hide(),this.clearContent()}else(n=t.dataTransfer.getData(a)).length&&(i=JSON.parse(n)),this.hideDropInvite(),this.hide(),this.clearContent(),this.dispatchEvent("ENORIPE_drop",["replace",i]);this._addContentDiv.hide()},_onDragStart:function(e,t){var i={protocol:"3DXContent",version:"1.0",source:"ENORIPE_AP",data:{items:this.getSelectedItems({serviceId:"3DSpace",objectId:t.cellModel._options.data.id,objectType:t.cellModel._options.data.type,displayName:t.cellModel._options.data.title})}};try{e.dataTransfer.setData("text/searchitems",JSON.stringify(i)),e.dataTransfer.setData("text",JSON.stringify(i))}catch(t){console.log(t),e.dataTransfer.setData("text",JSON.stringify(i))}a.closeWidget()},_getResponsiveTile:function(e){var t=this,i={height:"inherit",displayTitleTooltip:!0,displayPropertiesTooltip:!0,displayedOptionalCellProperties:["description","contextualMenu"],useDragAndDrop:e.isDraggable};e.isDraggable&&(i.onDragStartCell=this._onDragStart.bind(this));var n=new g(i);return n.selectionBehavior={unselectAllOnEmptyArea:!0,toggle:!0,canMultiSelect:!0,canInteractiveMultiselectWithCheckboxClick:!0,enableShiftSelection:!0,enableFeedbackForActiveCell:!1},n.onContextualEvent={callback:function(e){var i=[];if(e&&e.cellInfos&&e.cellInfos.cellModel){var n=e.cellInfos.cellModel._options.data;i.push({type:"PushItem",title:o.get("open"),icon:"open",action:{callback:function(e){n&&t._openRelExp(n)}}})}return i}},n.onCellDoubleClick(function(e){var i=e.cellModel._options.data;i&&t._openRelExp(i)}),n},_openRelExp:function(e){e.id&&(this.hide(),this.clearContent(),this.dispatchEvent("ENORIPE_OpenRelExp",[e]))},_getLabels:function(e,t){if(t){for(var i="",s=0,o="",a=0;a<t.length;a++){if(o="",e.hasOwnProperty(t[a]))if(o=e[t[a]],t[a].contains("modified"))if(""!==o)o=new Date(o).toLocaleString(n.getLang());if(o&&o.length>0&&(i=i.length>0?i+this._separator+o:o,s++),3===s)break}return i}},_hideLeftPanel:function(){this.getElement(".triptych-left").addClassName("display-none"),this.getElement(".fonticon-menu").removeClassName("display-none"),this.getElement(".openicon").addClassName("display-none"),this.getElement(".triptych-main").setStyle("left","0px"),this.getElement(".overlay-left").addClassName("display-none")},_showLeftPanel:function(){this._triptych._showPanel("left"),this.getElement(".triptych-left").removeClassName("display-none"),this.getElement(".openicon").removeClassName("display-none"),this.getElement(".triptych-left").removeClassName("close"),this.getElement(".triptych-left").addClassName("open"),this.getElement(".fonticon-menu").addClassName("display-none"),this.getElement(".triptych-main").setStyle("left",this._leftWidth+"px"),this.getElement(".triptych-left").setStyle("width",this._leftWidth+"px")},_updateContainerDimensions:function(){var t=this.container.parentElement;if(t){var i=(t=t.getDimensions?t:e.extendElement(t)).getDimensions();this.ctnWidth=i.width,this.ctnHeight=this._isWebInWin?window.innerHeight:i.height,this.container.setStyle("height",this.ctnHeight),this.container.getElement(".ENORipe-View-Container").setStyle("height",this.ctnHeight-55);var n=this.getElement(".list-tiles-container");if(n){var s=window.innerHeight-47+"px";n.setStyle("height",s)}this.getElement(".triptych-main")&&(window.innerWidth<580?this._hideLeftPanel():(this._isCollapsed,this._showLeftPanel()))}},_setUpEvents:function(){var e=this;this.getElements(".ENORipe-ActionContainer .action-btn").forEach(function(t){t.addEventListener("click",function(t){e.changeTab(t.currentTarget)})}),this.getElements(".ENORipe-rightside-header").forEach(function(t){t.addEventListener("click",e._handleArrowClick.bind(e))}),this.container.addEventListener("dragover",this._onDragOver),this.getElement("#ENORipe-Recents-Container").addEventListener("dragenter",function(){this.tempDropZone=!0,this.showDropInvite(this.getElement("#ENORipe-Recents-Container")),this.getElement(".drop-invite")&&this.getElement(".drop-invite").hide()}.bind(this))},_handleArrowClick:function(e){var t=e.currentTarget.getElement(".fonticon-menu"),i=e.currentTarget.getElement(".openicon");t.hasClassName("display-none")?i.hasClassName("fonticon-open-left")?(this._leftWidth=45,this._isCollapsed=!0,i.removeClassName("fonticon-open-left"),i.addClassName("fonticon-open-right"),this.getElement(".triptych-left").addClassName("ENORIPE-collapsed"),this.getElement(".triptych-main").setStyle("left",this._leftWidth+"px")):(this._leftWidth=270,this._isCollapsed=!1,i.removeClassName("fonticon-open-right"),i.addClassName("fonticon-open-left"),this.getElement(".triptych-left").removeClassName("ENORIPE-collapsed"),this.getElement(".triptych-left").setStyle("width",this._leftWidth+"px"),this.getElement(".triptych-main").setStyle("left",this._leftWidth+"px")):this._handleMenuClick(t)},_handleMenuClick:function(e){var t=this;if(!this.dropDownMenu){var i={target:e,items:[{id:"favorite",text:o.get("NavHomePage-Favorite"),fonticon:"favorite-on"},{id:"recents",text:o.get("NavHomePage-Recents"),fonticon:"clock"}]};i.events={onClick:function(e,i){e.stopPropagation();var n=o.get("NavHomePage-Recents");i.id.contains("favorite")?(n=o.get("NavHomePage-Favorite"),t.dispatchEvent("ENORIPE_HandleFavorite")):i.id.contains("recents")&&(n=o.get("NavHomePage-Recents"),t.dispatchEvent("ENORIPE_HandleRecents")),t.getElement(".ENORipe-rightside-headertext").innerHTML=n}},this.dropDownMenu=new h(i),this.dropDownMenu.show()}},onResize:function(){this._updateContainerDimensions(),this.dispatchEvent("ENORIPE_ResizeDialog")},clearContent:function(){var e=this.getElement("#ENORipe-Recents-Container"),t=this.getElement("#ENORipe-Recents-Container"),i=this.getElement(".list-tiles-container");e&&e.empty(),t&&t.empty(),i&&i.destroy()},destroy:function(){this.clearContent(),this._parent(),this.container.destroy(),this.container=null}})}),define("DS/SNNavigationMap/views/elements/ExpandMenu",["UWA/Class/View","UWA/Core","UWA/Class/Events","DS/WebappsUtils/WebappsUtils","DS/Controls/TooltipModel","DS/SNNavigationMap/MapSettings","DS/UIKIT/Spinner","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_internal"],function(e,t,i,n,s,o,a,r){"use strict";return e.extend(i,{name:"ExpandMenu",direction:"",nodeData:{},roundedRectContainer:null,isCollapse:!1,toggleEcosystemContainer:null,counts:[],nodeWidth:0,nodeHeight:0,setup:function(e,t,i,n){switch(this.svgNS={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"},this.setMenuData({direction:e,nodeData:t,roundedRectContainer:i,isCollapse:!1}),this.nodeWidth=o.getNodesWidth(),this.nodeHeight=i.getAttribute("data-height"),n){default:case 0:this.setBubble(0);break;case 1:this.showExpandMenu();break;case 2:this.setCollapseMenu()}},setMenuData:function(e){e.direction&&(this.direction=e.direction),e.nodeData&&(this.nodeData=e.nodeData),e.roundedRectContainer&&(this.roundedRectContainer=e.roundedRectContainer),e.isCollapse&&(this.isCollapse=e.isCollapse),this.nodeData&&this.direction&&(this.counts=this.nodeData.counts.getRealCounts(this.direction))},setBubble:function(e){var i,n=this,s=0,o=0,a=0;"out"===this.direction&&(o=this.nodeWidth),i=this.nodeHeight/2,this.toggleEcosystemContainer=t.extendElement(document.createElementNS(this.svgNS.svg,"g")),this.toggleEcosystemContainer.setAttributes({class:"expandMenuDirection-"+this.direction,id:"toggleEcosystem",style:"transform:translate("+o+"px,"+(i-30)+"px)"}),this.toggleEcosystemContainer.inject(this.roundedRectContainer),this.expandMenu=t.extendElement(document.createElementNS(this.svgNS.svg,"foreignObject")),this.expandMenu.setAttributes({class:"foreignObjectExpandMenu",x:"in"===this.direction?-190:0,y:0}),this.expandMenu.inject(this.toggleEcosystemContainer);var r=t.extendElement(document.createElementNS(this.svgNS.svg,"g"));r.setAttributes({class:"expandBubble"}),r.inject(this.toggleEcosystemContainer);var l=t.extendElement(document.createElementNS(this.svgNS.svg,"foreignObject"));l.setAttributes({class:"foreignObjectCircleExpand",x:8,y:8,width:30,height:30}),l.inject(r),t.createElement("div",{class:"circleExpand"}).inject(l);var d=t.extendElement(document.createElementNS(this.svgNS.svg,"foreignObject"));d.inject(r),d.setAttributes({class:"foreignObjectFonticon",x:-20,y:20,height:40,width:40});var c=t.extendElement(document.createElementNS(this.svgNS.svg,"circle"));switch(c.setAttributes({class:"loadingExpander",cx:"0",cy:"32.5",r:"13"}),c.inject(r),this.createLoaderGif().inject(this.toggleEcosystemContainer),e){default:case 0:this.showWaiting();break;case 1:this.toggleEcosystemContainer.addEventListener("mouseenter",function(e){e.touchFlag||this.showExpandedMenu()}.bind(this)),this.toggleEcosystemContainer.addEventListener("mouseleave",this.hideExpandedMenu.bind(this)),d.setContent(t.createElement("span",{class:"fonticon fonticon-plus"})),r.addEventListener("click",function(e){e.stopPropagation(),e&&e.detail&&!e.detail.isCustom&&this.splitCount()}.bind(this)),r.addEventListener("touchstart",function(e){e.stopPropagation(),e.preventDefault(),s=(new Date).getTime(),a=setTimeout(function(){n.showExpandedMenu(e)},1e3)}),r.addEventListener("touchend",function(e){e.stopPropagation(),e.preventDefault();var t=(new Date).getTime()-s;t?(t<1e3&&n.splitCount(),clearTimeout(a)):n.splitCount()});break;case 2:d.setContent(t.createElement("span",{class:"fonticon fonticon-minus"})),r.addEventListener("click",function(e){e.stopPropagation(),e&&e.detail&&!e.detail.isCustom&&this.dispatchEvent("ENORIPE_Collapse",[this.nodeData.id,this.direction])}.bind(this))}},setExpandMenu:function(e){this.toggleEcosystemContainer&&(this.toggleEcosystemContainer.remove(),this.toggleEcosystemContainer=null),this.setMenuData({nodeData:e,isCollapse:!1}),this.showExpandMenu()},setCollapseMenu:function(){this.destroy(),this.setBubble(2),this.setMenuData({isCollapse:!0})},showExpandMenu:function(){var e,i=this;this.setBubble(1),e=this.calculateExpandNumber();var n=t.extendElement(document.createElementNS(this.svgNS.svg,"g"));n.inject(this.toggleEcosystemContainer),n.setAttributes({class:"expandNumberContainer"});var o=t.extendElement(document.createElementNS(this.svgNS.svg,"rect"));o.inject(n);var a=t.extendElement(document.createElementNS(this.svgNS.svg,"text"));a.inject(n);var l=t.extendElement(document.createElementNS(this.svgNS.svg,"tspan"));l.inject(a),l.setAttributes({class:"expandNumberText",dy:13,x:-3}),l.setContent(e);var d=l.getBBox();o.setAttributes({class:"expandNumberBackground",x:-4,y:0,width:d.width+2,height:17}),n.setContent([o,a]),this.expandMenuContainer=t.createElement("div",{class:"expandMenuContainer"}).inject(this.expandMenu);var c=t.createElement("div",{class:"expandMenuContents"}).inject(this.expandMenuContainer),h=e;h+=e>1?" "+r.get("objects"):" "+r.get("object");t.createElement("span",{class:"objectsNumber",text:h}).inject(c);for(var u=t.createElement("ul",{class:"expandMenuList"}).inject(c),g=0;g<this.counts.length;g++)t.createElement("li",{id:this.counts[g].get("id"),"data-relation":this.counts[g].get("name"),html:"<a>"+this.counts[g].get("count")+" "+this.getNlsRelationValue(this.counts[g].get("name"))+"</a>",events:{click:function(e){e.stopPropagation(),e.detail&&!e.detail.isCustom&&(console.log(this),i.splitCount([this.dataset.relation]))}}}).inject(u).tooltipInfos=new s({longHelp:this.getNlsRelationValue(this.counts[g].get("name"))});t.createElement("a",{class:"previewLink",text:r.get("PreviewAll"),events:{click:function(e){e.detail&&!e.detail.isCustom&&this.dispatchEvent("ENORIPE_ShowPreview",{modelId:this.nodeData.id,direction:this.direction})}.bind(this)}}).inject(c)},showExpandedMenu:function(){var e=0;this.toggleEcosystemContainer&&!this.toggleEcosystemContainer.classList.contains("expanded")&&(this.toggleEcosystemContainer.classList.add("expanded"),this.dispatchEvent("ENORIPE_movetofront",this.roundedRectContainer),e=-15*this.counts.length,this.expandMenu.setAttributes({y:e,width:190,height:300}))},hideExpandedMenu:function(){this.toggleEcosystemContainer&&this.toggleEcosystemContainer.classList.contains("expanded")&&(this.toggleEcosystemContainer.classList.remove("expanded"),this.expandMenu.setAttributes({y:0,width:0,height:0}))},calculateExpandNumber:function(){var e=0;return this.counts&&this.counts.forEach(function(t){t.get("count")&&parseInt(t.get("count"))>0&&(e+=parseInt(t.get("count")))}),e},getNlsRelationValue:function(e){return r[e+"_short"]||r[e]||e},splitCount:function(e){if(!this.isLoading()){if(this.showLoading(),!e){e=[];for(var t=0;t<this.counts.length;t++)e.push(this.counts[t].get("name"))}e.length>0?this.dispatchEvent("ENORIPE_splitCount",[[this.nodeData.id],e,this.direction]):this.hideLoading()}},showLoading:function(){this.isLoading()||this.toggleEcosystemContainer.classList.add("is-loading")},hideLoading:function(){this.isLoading()&&this.toggleEcosystemContainer.classList.remove("is-loading")},showWaiting:function(){this.isWaiting()||this.toggleEcosystemContainer.classList.add("is-waiting")},hideWaiting:function(){this.isWaiting()&&this.toggleEcosystemContainer.classList.remove("is-waiting")},isLoading:function(){return this.toggleEcosystemContainer.classList.contains("is-loading")},isWaiting:function(){return this.toggleEcosystemContainer.classList.contains("is-wainting")},createLoaderGif:function(){var e=t.extendElement(document.createElementNS(this.svgNS.svg,"image"));return e.setAttributeNS(this.svgNS.xlink,"href",n.getWebappsAssetUrl("SNNavigationMap","icons/ui/uikit-loader.gif")),e.setAttributes({x:-15,y:17,height:30,width:30,class:"loader-icon"}),e},destroy:function(){this.toggleEcosystemContainer&&(this.toggleEcosystemContainer.remove(),this.toggleEcosystemContainer=null),this.container=null}})}),define("DS/SNNavigationMap/views/ToolBarView",["UWA/Core","UWA/Class/View","UWA/Utils/Client","DS/Controls/ComboBox","DS/UIKIT/Iconbar","DS/UIKIT/DropdownMenu","DS/SNNavigationMap/MapSettings","DS/SNNavigationMap/utils/ProbesUtils","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_internal","DS/SNNavigationMap/views/SNMapSelector","DS/UIKIT/Tooltip"],function(e,t,i,n,s,o,a,r,l,d,c){"use strict";return t.extend({name:"ToolBar",toolbar:null,optionsDropdownMenu:null,leftIconBar:null,rightIconBar:null,renderTo:null,_addinMode:!1,_isWebInWin:!1,_excludedCommands:[],className:function(){return this.getClassNames("-container")},setup:function(t){this.toolBar=new e.createElement("ul",{class:"map-toolbar",draggable:"false"}),this.renderTo=t.renderTo,this._addinMode=t.addinMode,this._isWebInWin=t.isWebInWin,this._excludedCommands=t.excludedCommands||[]},render:function(){var t=this,n=[{fonticon:"flow-tree-expand-down-cog",text:l.get("SNNavigationMap.ExpandCollapse.Title"),className:"ExpandCollapse_Command selectionIcon",id:"ExpandCollapse_Command",content:{type:"dropdownmenu",closeOnClick:!0,options:{multiSelect:!0,items:[{text:l.get("SNNavigationMap.Expand.Title"),className:"header"},{fonticon:"exchange-add",text:l.get("SNNavigationMap.ExpandUpAndDownstream.Title"),className:"ExpandUpAndDownstream_Command",name:"ExpandUpAndDownstream",selectable:!1,handler:function(){t.dispatchEvent("ENORIPE_Expand_Command")}},{fonticon:"left-add",text:l.get("SNNavigationMap.ExpandUpstream.Title"),className:"ExpandUpstream_Command",name:"ExpandUpstream",selectable:!1,handler:function(){t.dispatchEvent("ENORIPE_Expand_Command","in")}},{fonticon:"right-add",text:l.get("SNNavigationMap.ExpandDownstream.Title"),className:"ExpandDownstream_Command",name:"ExpandDownstream",selectable:!1,handler:function(){t.dispatchEvent("ENORIPE_Expand_Command","out")}},{fonticon:"exchange-cog",text:l.get("SNNavigationMap.ExpandNLevel.Title"),className:"ExpandNLevel_Command",name:"ExpandNLevel",selectable:!1,handler:function(){t.dispatchEvent("ENORIPE_ExpandNLevel")}},{className:"divider"},{text:l.get("SNNavigationMap.Collapse.Title"),className:"header"},{fonticon:"exchange-minus",text:l.get("SNNavigationMap.CollapseUpAndDownstream.Title"),className:"CollapseUpAndDownstream_Command",name:"CollapseUpAndDownstream",selectable:!1,handler:function(){t.dispatchEvent("ENORIPE_Collapse_Command")}},{fonticon:"left-minus",text:l.get("SNNavigationMap.CollapseUpstream.Title"),className:"CollapseUpstream_Command",name:"CollapseUpstream",selectable:!1,handler:function(){t.dispatchEvent("ENORIPE_Collapse_Command","in")}},{fonticon:"right-minus",text:l.get("SNNavigationMap.CollapseDownstream.Title"),className:"CollapseDownstream_Command",name:"CollapseDownstream",selectable:!1,handler:function(){t.dispatchEvent("ENORIPE_Collapse_Command","out")}}],events:{onClick:function(e,t){r.trackUsage(t.name,"Commands")}}}}},{fonticon:"eye-off",text:l.get("SNNavigationMap.HideObjects.Title"),className:"Hide_Command selectionIcon",name:"Hide",handler:function(e,i){r.trackUsage(i.name,"Commands"),t.dispatchEvent("ENORIPE_HideCommand")}},{className:"divider selectionIcon",name:"divider"},{fonticon:"linearGraph"==a.getLayoutType()?"graph-linear":"view-list",text:l.get("SNNavigationMap.SwitchView.Title"),className:"LayoutType_Command",id:"LayoutType_Command",content:{type:"dropdownmenu",closeOnClick:!0,options:{multiSelect:!1,items:[{fonticon:"graph-linear",text:l.get("SNNavigationMap.LinearGraph.Title"),className:"linearGraph_Command",name:"linearGraph",selectable:!0,selected:"linearGraph"==a.getLayoutType()},{fonticon:"view-list",text:l.get("SNNavigationMap.DataGrid.Title"),className:"dataGrid_Command",name:"dataGridView",selectable:!0,selected:"dataGridView"==a.getLayoutType()}],events:{onClick:function(e,i){r.trackUsage("ChangeView","LayoutType-"+i.name),t.dispatchEvent("ENORIPE_SwitchLayout",i.name)}}}}},{fonticon:"object-related-cog",text:l.get("SNNavigationMap.Customize.Title"),className:"Customize_Command",handler:function(){r.trackUsage("Customize","Commands"),t.dispatchEvent("ENORIPE_CustomizeCommandClick")}},{fonticon:"select-on",text:l.get("SNNavigationMap.MultiSelection.Title"),className:"multisel-icons",id:"Selection_Command",content:{type:"dropdownmenu",closeOnClick:!0,options:{multiSelect:!0,items:[{fonticon:"select-all",text:l.get("SNNavigationMap.selectAll.Title"),className:"SelectAll_Command",name:"SelectAll",selectable:!1,handler:function(e){t.dispatchEvent("ENORIPE_selectAllFromCommand")}},{fonticon:"filter-select-on",text:l.get("SNNavigationMap.selectFiltered.Title"),className:"SelectFiltered_Command disabledOnDatagrid",name:"SelectFiltered",id:"SelectFiltered",selectable:!1,handler:function(e){t.dispatchEvent("ENORIPE_selectOutFilteredFromCommand")}},{fonticon:"select-inverted",text:l.get("SNNavigationMap.selectInverse.Title"),className:"SelectInverse_Command",name:"SelectInverse",selectable:!1,handler:function(e){t.dispatchEvent("ENORIPE_selectInverseFromCommand")}},{fonticon:"select-on-cog",text:l.get("SelectionAssistant-Title"),className:"SelectionAssistant_Command",name:"SelectionAssistant",selectable:!1,handler:function(){t.dispatchEvent("ENORIPE_SelectionAssistantFromCommand")}},{fonticon:"select-none",text:l.get("SNNavigationMap.clearSelection.Title"),className:"ClearSelection_Command",name:"ClearSelection",selectable:!1,handler:function(){t.dispatchEvent("ENORIPE_clearSelectionFromCommand")}}],events:{onClick:function(e,t){r.trackUsage(t.name,"Commands")},onShow:function(e,t){this.updateLayout()}.bind(this)}}}},{fonticon:"pencil",text:l.get("SNNavigationMap.EditLayout.Title"),className:"EditLayout_Command disabledOnDatagrid",id:"EditLayout_Command",selectable:!0,name:"EditLayout",handler:function(e,i){r.trackUsage(i.name,"Commands"),t.dispatchEvent("ENORIPE_EditLayoutCommandClick")}},{fonticon:"favorite-on",text:l.get("SNNavigationMap.Favorite.Title"),className:"Favorite_Command",name:"Favorite",handler:function(e,i){r.trackUsage(i.name,"Commands"),t.dispatchEvent("ENORIPE_FavoriteCommandClick")}},{fonticon:"info",text:l.get("SNNavigationMap.Information.Title"),className:"Info_Command",name:"Information",handler:function(e,i){t.dispatchEvent("ENORIPE_InfoCommandClick")}},{fonticon:"menu-dot",className:"DropdownMenu_Command",text:l.get("SNNavigationMap.Options.Title"),id:"toolBar-dropdownMenu",handler:function(){t.toolBar.getElement(".iconbar-overflow-menu-trigger")&&t.optionsDropdownMenu.show()}}].filter(function(e){return void 0!==e}),d=[{fonticon:"eye-cog",text:l.get("SNNavigationMap.CustomizeDisplay.Title"),className:"CustomizeDisplay_Command",items:[{fonticon:"attributes-cog",text:l.get("CustomizeAttribute-Title"),className:"CustomizeAttribute-Command",id:"CustomizeAttribute-Command",name:"CustomizeAttributes",selectable:!1,selected:!1},{fonticon:"chart-thumbnail-graph",text:l.get("thumbnails2DNls"),className:"Thumbnails2DNls_Command disabledOnDatagrid",id:"Thumbnails2DNls_Command",name:"CustomizeDisplay",selectable:!0,selected:a.getThumbnailsMode()},{fonticon:"flow-children-eye",text:l.get("showInstances"),className:"ShowInstances_Command",id:"ShowInstances_Command",name:"ShowInstances",selectable:!0,selected:a.getInstancesMode()},{fonticon:"publish",text:l.get("showPublications"),className:"ShowPublications_Command",id:"ShowPublications_Command",name:"ShowPublications",selectable:!0,selected:a.getPublicationsMode()},{fonticon:"flow-dashed-line-delete",text:l.get("showGhost"),className:"ShowGhost_Command",id:"ShowGhost_Command",name:"ShowGhost",selectable:!0,selected:a.getGhostMode()},{fonticon:"update",text:l.get("recumputeNls"),className:"RecumputeNls_Command disabledOnDatagrid",id:"RecumputeNls_Command",name:"RecomputeLayout",selectable:!0,selected:!1}],multiSelect:!0,closeOnClick:!1},{fonticon:"path-related",text:l.get("SNNavigationMap.computePaths.Title"),className:"ComputePath_Command",name:"ComputePath",handler:function(e,i){t.dispatchEvent("ENORIPE_ComputePathCommandClick")}},{className:"divider"},{fonticon:"arrow-double-combo",text:l.get("SNNavigationMap.fitAll.Title"),className:"FitAllIn_Command disabledOnDatagrid",name:"FitAllIn",handler:function(e,i){t.dispatchEvent("ENORIPE_FitAllCommandClick")}},{fonticon:"close",text:l.get("SNNavigationMap.clearMap.Title"),className:"ClearView_Command",name:"ClearMap",handler:function(e,i){t.dispatchEvent("ENORIPE_ClearMapCommandClick")}},{fonticon:"reload",text:l.get("SNNavigationMap.refreshMap.Title"),tooltipPosition:"bottom right",className:"Refresh_Command",name:"RefreshMap",handler:function(e,i){t.dispatchEvent("ENORIPE_RefreshMapCommandClick")}},{fonticon:"print",text:l.get("SNNavigationMap.printMap.Title"),className:"Print_Command",name:"PrintMap",handler:function(e,i){t.dispatchEvent("ENORIPE_PrintCommandClick")}}].filter(function(e){return void 0!==e});i.Platform.android&&(d=d.filter(function(e){return"Print_Command"!==e.className})),"solidworks"!==this._addinMode&&"catiav5"!==this._addinMode||n.unshift({fonticon:"open",text:l.get("SNNavigationMap.openMap.Title"),className:"Open_Command",name:"Open",handler:function(e,i){r.trackUsage(i.name,"Commands"),t.dispatchEvent("ENORIPE_OpenCommandClick")}}),this._isWebInWin&&n.unshift({fonticon:"search",text:l.get("MapSearchView_search"),className:"Search_Command",name:"Search",handler:function(e,i){r.trackUsage(i.name,"Commands"),t._handleSearch()}});var h=[{fonticon:"home-alt",text:l.get("SNNavigationMap.home.Title"),className:"Home_Command",name:"HomePage",handler:function(e,i){r.trackUsage(i.name,"Commands"),t.dispatchEvent("ENORIPE_HomeCommandClick")}}];this._excludedCommands.length>0&&(n=1===this._excludedCommands.length&&"All"===this._excludedCommands[0]?[]:this.excludeCommands(n),h=1===this._excludedCommands.length&&"All"===this._excludedCommands[0]?[]:this.excludeCommands(h),d=1===this._excludedCommands.length&&"All"===this._excludedCommands[0]?[]:this.excludeCommands(d)),this.leftIconBar=new s({renderTo:t.toolBar,className:"left-toolbar-relations",tooltipsPosition:"bottom",items:h}),this.rightIconBar=new s({renderTo:t.toolBar,className:"right-toolbar-relations",tooltipsPosition:"bottom",items:n});var u=e.createElement("span",{class:"Enoripe-FavoriteText"});return u.addEventListener("mouseenter",e=>{let t=e.target;t.offsetWidth<t.scrollWidth?(t.tooltipInfos&&null!==t.tooltipInfos.elements||(t.tooltipInfos=new c({position:"bottom right",target:t,body:t.textContent})),e.touchFlag&&t.tooltipInfos.show()):t.tooltipInfos&&t.tooltipInfos.elements&&t.tooltipInfos.destroy()}),u.inject(this.leftIconBar.elements.container),this._isWebInWin&&(this.searchContainer=e.createElement("li",{class:"Enoripe-SearchContainer"})),this.toolBar.addEventListener("dragenter",function(e){e.stopPropagation()}),this.toolBar.inject(this.renderTo),-1===this._excludedCommands.indexOf("All")&&-1===this._excludedCommands.indexOf("DropdownMenu_Command")&&(this.optionsDropdownMenu=new o({target:this.rightIconBar.getItem("toolBar-dropdownMenu").elements.container,className:"optionsDropdownMenu",multiSelect:!0,items:d,responsiveMode:!0,events:{onClick:function(e,t){0!=t.selected&&r.trackUsage(t.name,"Commands"),"CustomizeAttributes"===t.name&&r.trackUsage(t.name,"Commands"),this.dispatchEvent("ENORIPE_"+t.name,t.selected)}.bind(this),onShow:function(){this.updateLayout()}.bind(this)}})),this.updateLayout(),this.showAllToolbar(),this},getCommand:function(e){var t=this.toolBar.getElement("."+e);return t||((t=this.optionsDropdownMenu.elements.container.getElement("."+e))?t:void 0)},excludeCommands:function(e){for(var t=0;t<e.length;t++)this._excludedCommands.indexOf(e[t].className)>-1?(e.splice(t,1),t--):e[t].content&&"dropdownmenu"===e[t].content.type?e[t].content.options.items=this.excludeCommands(e[t].content.options.items):e[t].items&&(e[t].items=this.excludeCommands(e[t].items));return e},hideRightToolbar:function(){this.rightIconBar.hide()},hideItems:function(e){for(var t=document.getElementsByClassName("item "+e),i=0;i<t.length;i++)document.getElementById(t[i].id)&&document.getElementById(t[i].id).hide()},showItems:function(e){for(var t=document.getElementsByClassName("item "+e),i=0;i<t.length;i++)document.getElementById(t[i].id)&&document.getElementById(t[i].id).show()},hideSelectionIcon:function(){this.rightIconBar.elements.container.getElements(".selectionIcon").forEach(function(e){e.hide()}),this.toolBar.classList.remove("selectionIconOn"),this.rightIconBar.resize()},showSelectionIcon:function(){var e=a.getLayoutType();this.rightIconBar.elements.container.getElements(".selectionIcon").forEach(function(t){"dataGridView"===e&&t.className.contains("disabledOnDatagrid")||t.show()}.bind(this)),this.toolBar.addClassName("selectionIconOn"),this.rightIconBar.resize()},showAllToolbar:function(){this.toolBar.show(),this.rightIconBar.show(),this.leftIconBar.show()},toggleInfoCommand:function(){var e=this.getCommand("Info_Command");e.hasClassName("pressed")?e.removeClassName("pressed"):(e.addClassName("pressed"),r.trackUsage(e.getAttribute("name"),"Commands"))},updateLayout:function(){let e=this.rightIconBar.getItem("LayoutType_Command"),t=e.elements.container,i=e.content.component;switch(a.getLayoutType()){default:case"linearGraph":this.showItems("disabledOnDatagrid"),d.getSelected().length<=0&&this.hideSelectionIcon(),t.firstChild.className="fonticon fonticon-graph-linear",void 0!==i&&(i.getItem("linearGraph").elements.container.addClassName("selected"),i.getItem("dataGridView").elements.container.removeClassName("selected"));break;case"dataGridView":this.hideItems("disabledOnDatagrid"),t.firstChild.className="fonticon fonticon-view-list",void 0!==i&&(i.getItem("dataGridView").elements.container.addClassName("selected"),i.getItem("linearGraph").elements.container.removeClassName("selected"))}},disableSelectionAssistantCommand:function(){try{var e=this.rightIconBar.getItem("Selection_Command").content.component;void 0!==e&&e.disableItem("SelectionAssistant")}catch(e){console.log(e)}},enableSelectionAssistantCommand:function(){try{var e=this.rightIconBar.getItem("Selection_Command").content.component;void 0!==e&&e.enableItem("SelectionAssistant")}catch(e){console.log(e)}},_handleSearch:function(){var t=this;if(this._searchModule)this._searchModule.container.isHidden()||this._searchModule.clearSearch(),this._searchModule.container.toggle();else{var i=e.createElement("li",{class:"Enoripe-SearchContainer"}).inject(this.rightIconBar.getContent().getChildren()[0],"top");require(["DS/SNNavigationMap/views/SearchViewForNative"],function(e){t._searchModule=new e({renderTo:i}),t._searchModule.render(),t.listenTo(t._searchModule,"ENORIPE_performSearch_native",function(e){t.dispatchEvent("ENORIPE_performSearch_native",e)}),t.listenTo(t._searchModule,"ENORIPE_resetSearch_native",function(){t.dispatchEvent("ENORIPE_resetSearch_native")})})}},destroy:function(){this._parent(),this.toolBar.destroy(),this.toolBar=null,this.container=null},resizeHandler:function(){if(window&&window.innerWidth)window.innerWidth}})}),define("DS/SNNavigationMap/utils/DataGridCustoColumnsUtils",["UWA/Class","DS/WebappsUtils/WebappsUtils","DS/PADServices/utils/MaturityUtils","DS/PADServices/utils/PlatformURL","DS/PlatformAPI/PlatformAPI","DS/i3DXCompassServices/i3DXCompassServices","DS/SNNavigationMap/MapSettings","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_internal"],function(e,t,i,n,s,o,a,r){"use strict";return e.extend({init:function(e){this._dataGridCollection=e,o.getServiceUrl({serviceName:"3DSwym",platformId:n.getPlatformId(),onComplete:e=>{this._swymUrl=e},onFailure:()=>{this._swymUrl=void 0}}),this._availableCADMasters=new Map;let i=["CATIAV5","SOLIDWORKS","NX","CREO","SOLIDEDGE","ALTIUM","INVENTOR","AUTOCAD","CAAUPSAPP","CADENCEALLEGRO","3DEXPERIENCE","EPLAN","SURPAC"];for(var r=0;r<i.length;r++)this._availableCADMasters.set(i[r],t.getWebappsAssetUrl("PADServices","icons/cadmasters/I_CADMaster"+i[r]+".png"));this._isWebInWin=a.isWebInWin(),this._isWebInWin||(this._currentUser=s.getUser())},getCustoColumns:function(){var e=this;return{"ds6w:cadMaster":{dataIndex:"ds6w:cadMaster",kind:"image",width:40,minWidth:40,editableFlag:!1,typeRepresentation:"image",alignment:"center",customisation:{exportable:{lock:!1,value:!0}},getCellValue:function(t){let i;if(t.nodeModel){let n=t.nodeModel.id,s=e._dataGridCollection.get(n);if(n&&s){let t=s._attributes["ds6w:cadMaster"];void 0!==t&&(i=e._availableCADMasters.get(t))}}return i?{iconPath:i,iconSize:{height:"22px"}}:""}},"ds6w:status":{dataIndex:"ds6w:status",kind:"tag",minWidth:50,editableFlag:!1,typeRepresentation:"tag",className:"lc-maturity-state",customisation:{exportable:{lock:!1,value:!0}},getCellClassName:function(t){if(t.nodeModel){let s=t.nodeModel.id,o=e._dataGridCollection.get(s);if(s&&o){let e=o._attributes["ds6w:status"];var n;return e&&(n=i.getAndCreateMaturityClass(e,"wux-controls-label")),n}}}},"ds6w:isLastRevision":{dataIndex:"ds6w:isLastRevision",kind:"boolean",typeRepresentation:"boolean",minWidth:50,editableFlag:!1,alignment:"center",customisation:{exportable:{lock:!1,value:!0}},getCellTooltip:function(t){let i="";if(t.nodeModel){let n=t.nodeModel.id,s=e._dataGridCollection.get(n);if(n&&s){let e=s._attributes["ds6w:isLastRevision"];void 0!==e&&(i=("boolean"==typeof e?e:"TRUE"===e.toUpperCase())?{shortHelp:r.get("LastRevision")}:{shortHelp:r.get("NotlastRevision")})}}return i},getCellClassName:function(t){if(t.nodeModel){let i=t.nodeModel.id,n=e._dataGridCollection.get(i);if(i&&n){let e=n._attributes["ds6w:isLastRevision"];if(void 0!==e)return("boolean"==typeof e?e:"TRUE"===e.toUpperCase())?"lc_dgv-lastversion-check":"lc_dgv-lastversion-wrong"}}}},"ds6wg:PLMReference.V_isLastVersion":{dataIndex:"ds6wg:PLMReference.V_isLastVersion",kind:"boolean",typeRepresentation:"boolean",minWidth:50,editableFlag:!1,alignment:"center",customisation:{exportable:{lock:!1,value:!0}},getCellClassName:function(t){if(t.nodeModel){let i=t.nodeModel.id,n=e._dataGridCollection.get(i);if(i&&n){let e=n._attributes["ds6wg:PLMReference.V_isLastVersion"];if(void 0!==e)return("boolean"==typeof e?e:"TRUE"===e.toUpperCase())?"lc_dgv-lastversion-check":"lc_dgv-lastversion-wrong"}}},getCellTooltip:function(t){let i="";if(t.nodeModel){let n=t.nodeModel.id,s=e._dataGridCollection.get(n);if(n&&s){let e=s._attributes["ds6w:isLastRevision"];void 0!==e&&(i=("boolean"==typeof e?e:"TRUE"===e.toUpperCase())?{shortHelp:r.get("LastRevision")}:{shortHelp:r.get("NotlastRevision")})}}return i}},"ds6w:reserved":{dataIndex:"ds6w:reserved",kind:"icon",minWidth:50,editableFlag:!1,typeRepresentation:"icon",alignment:"center",customisation:{exportable:{lock:!1,value:!0}},getCellValue:function(t){var i=void 0;if(!t.isHeader&&t.nodeModel){let a=t.nodeModel.id,r=e._dataGridCollection.get(a);if(a&&r){let t=r._attributes["ds6w:reserved"],l=r._attributes["ds6w:reservedBy"]?e._dataGridCollection.get(a)._attributes["ds6w:reservedBy"]:"";if(i="wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-key lc_dgv_lock","boolean"==typeof t?t:"TRUE"===t.toUpperCase())if(e._isWebInWin)i="wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-lock lc_dgv_lock_default";else{var n=e._getUserLogin(),s=e._getUserName(),o=!1;l.trim().length>0&&((o=l.toUpperCase().trim()===n.toUpperCase().trim()||!1)||(o=l.toUpperCase().trim()===s.toUpperCase().trim()||!1)),o||(i="wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-lock lc_dgv_lock_other")}else i="wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-lock-open lc_dgv_unlock"}}return i}},"ds6w:responsible":{dataIndex:"ds6w:responsible",kind:"user",minWidth:150,editableFlag:!1,customisation:{exportable:{lock:!1,value:!0}},getCellTypeRepresentation:function(e){return e.nodeModel&&!0===e.nodeModel.options.isGroupingNode?"string":"user"},getCellValue:function(t){let i,n;if(t.nodeModel){let o=t.nodeModel.id,a=e._dataGridCollection.get(o);if(o&&a){let t=a._attributes.owner;var s=t?e._getUserThumbnailURL(t):void 0;i=s?{iconPath:"url("+s+")",className:"dgv-user-thumbnail"}:{iconName:"topbar-user",fontIconFamily:1},n=a._attributes["ds6w:responsible"]}}return n?{icon:i,label:n}:void 0}}}},_getUserThumbnailURL:function(e,t){let i;return this._swymUrl&&(i=this._swymUrl+"/api/user/getpicture/login/"+e,t&&(i+="/format/"+t)),i},_getUserLogin:function(){var e=this._currentUser,t="";return void 0!==e&&(t=e.login),t},_getUserName:function(){var e=this._currentUser,t="";return void 0!==e&&(t=e.firstName+" "+e.lastName),t}})}),define("DS/SNNavigationMap/views/D3MapView",["UWA/Core","UWA/Class/View","DS/D3js_external/D3js","DS/SNNavigationMap/views/elements/RoundedRect","DS/SNNavigationMap/views/elements/ExpandMenu","DS/SNNavigationMap/views/elements/Links","DS/D3Cola/D3Cola","UWA/Utils/Client","DS/UIKIT/Tooltip","DS/WebappsUtils/WebappsUtils","DS/SNNavigationMap/MapSettings","DS/SNNavigationMap/utils/ProbesUtils","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_internal"],function(e,t,i,n,s,o,a,r,l,d,c,h,u){"use strict";return t.extend({name:"d3-map-view",className:function(){return this.getClassNames("-container multisel-off")},nodeMouseDown:!1,dragNodeStarted:!1,currentlyDraggingNode:!1,markersData:[{id:"node-arrow",position:10,color:"#77797c",dValue:"M 0 0 L 10 5 L 0 10 z"},{id:"node-arrow-focus",position:10,color:"#368ec4",dValue:"M 0 0 L 10 5 L 0 10 z"},{id:"node-arrow-focus-reverse",position:0,color:"#368ec4",dValue:"M 10 10 L 0 5 L 10 0 z"},{id:"node-arrow-reverse",position:0,color:"#77797c",dValue:"M 10 10 L 0 5 L 10 0 z"},{id:"node-arrow-red",position:10,color:"#EA4F37",dValue:"M 0 0 L 10 5 L 0 10 z"},{id:"node-arrow-green",position:10,color:"#57B847",dValue:"M 0 0 L 10 5 L 0 10 z"},{id:"node-arrow-orange",position:10,color:"#FFA500",dValue:"M 0 0 L 10 5 L 0 10 z"}],_highlightTimeout:null,_isMultiSelON:0,_currentDraggedNode:null,_selectedNode:null,_inFilteringMode:!1,_expandMenuViews:{out:{},in:{}},_scaleExtent:[.2,3],_UncheckedIcon:d.getWebappsAssetUrl("SNNavigationMap","icons/16/MultiSel_Unchecked.png"),_CheckedIcon:d.getWebappsAssetUrl("SNNavigationMap","icons/16/MultiSel_Checked.png"),_unfocusedIcon:d.getWebappsAssetUrl("SNNavigationMap","icons/16/MultiSel-unfocused.png"),setup:function(e){var t=this;i.selection.prototype.moveToFront=function(){return this.each(function(){this.parentNode.appendChild(this)})},this._selector=e.selector,this._spinnerMap=e.spinner,this.NodeCreator=new n(this._selector),this.NodeCreator.isChrome=this.isChrome(),this.NodeCreator._dropZone=e.dropZone,this.NodeCreator.layoutingOn=!1,this.NodeCreator.addEvent("ENORIPE_downloadDocument",function(e,i){t.dispatchEvent("ENORIPE_downloadDocument",[e,i])}),this.NodeCreator.addEvent("ENORIPE_Drop",function(e,i){t.dispatchEvent("ENORIPE_Drop",[e,i])}),this.NodeCreator.addEvent("ENORIPE_ShowPreview",function(e){t.dispatchEvent("ENORIPE_ShowPreview",e)}),this.NodeCreator.addEvent("ENORIPE_movetofront",function(e){i.select(e).moveToFront()}),this.NodeCreator.addEvent("ENORIPE_FetchAttrInfo",function(e){t.dispatchEvent("ENORIPE_FetchAttrInfo",e)}),this.NodeCreator.addEvent("ENORIPE_GetNlsAttrInfo",function(e){t.dispatchEvent("ENORIPE_GetNlsAttrInfo",e)}),this.NodeCreator.addEvent("ENORIPE_toggleInstance",function(e){t.dispatchEvent("ENORIPE_toggleInstance",e)}),this.NodeCreator.addEvent("ENORIPE_dragElement",function(e,i){t.dispatchEvent("ENORIPE_dragElement",[e,i])}),this.LinksCreator=new o,this.initDragListener(),this.layoutAxis=c.getLayoutAxis(),this.layoutDirection=c.getLayoutDirection(),!1===c.getThumbnailsMode()&&this.container.addClassName("no-thumbnails"),this._countLimit=e.countLimit,this.NodeCreator.nameLabel=e.nameLabel,this.NodeCreator.separator=e.separator,this._layoutUtils=e.layoutUtils,this.nodeRadius=80,this.width=window.innerWidth,this.height=window.innerHeight-150,this.zoomListener=i.behavior.zoom().scaleExtent(this._scaleExtent),this.svgContainer=i.select(this.container).append("svg").attr("id","svg-root").attr("width",this.width).attr("height",this.height).attr("pointer-events","all").call(this.zoomListener.on("zoom",this._redraw.bind(this))).on("dblclick.zoom",null).on("mousedown",function(){t.mouseDownTimeInContainer=new Date}).on("mouseup",function(){t.mouseUpTimeInContainer=new Date}).on("click",this._clearSelection.bind(this)).on("touchmove",function(){i.event.preventDefault()}),this.svgRootG=this.svgContainer.append("g"),this.linksContainer=this.svgRootG.append("g").attr("id","all-links"),this.nodesContainer=this.svgRootG.append("g").attr("id","all-nodes"),this.focusContainer=this.svgRootG.append("g").attr("id","focused-objects"),this.defs=this.svgContainer.append("svg:defs"),this.defs.selectAll("marker").data(this.markersData).enter().append("svg:marker").attr("id",function(e){return e.id}).attr("viewBox","0 0 10 10").attr("refX",function(e){return e.position}).attr("refY",5).attr("markerWidth",10).attr("markerHeight",10).attr("orient","auto").append("svg:path").attr("d",function(e){return e.dValue}).attr("fill",function(e){return e.color}),this.force=a.d3adaptor().linkDistance(150).size([this.width,this.height]).on("tick",this.tick.bind(this)).on("end",this.onViewReady.bind(this)),this.svgElement=this.getElement("svg")},render:function(e,t){var i=e.nodes;return this._resetFocusedLinksPosition(),this._d3Update(e),this.updateConstraints(e,t),i.forEach(function(e){if(!e.counts.isRequestDone()){var t=this.getElement("#container-"+e.id);this.createExpandMenu("in",e,t,!1),this.createExpandMenu("out",e,t,!1)}}.bind(this)),this},_d3Update:function(e){var t=this,n=e.nodes,s=e.links,o=0;this.force.size([this.width,this.height]).nodes(n).links(s);var a=this.linksContainer.selectAll(".link").data(s,function(e){return e.id}),l=this.nodesContainer.selectAll(".node").data(n,function(e){return e.id});l.classed("focus",function(e){return e.focus}),a.classed("focus",function(e){var i=!0===e.source.focus||!0===e.target.focus,n=this.getElementsByTagName("textPath")[0];return i?(this.getElement("path").hasAttribute("marker-end")&&this.getElement("path").setAttribute("marker-end","url(#node-arrow-focus)"),this.getElement("path").hasAttribute("marker-start")&&this.getElement("path").setAttribute("marker-start","url(#node-arrow-focus)")):(this.getElement("path").hasAttribute("marker-end")&&this.getElement("path").setAttribute("marker-end","url(#node-arrow)"),this.getElement("path").hasAttribute("marker-start")&&this.getElement("path").setAttribute("marker-start","url(#node-arrow)")),t.LinksCreator.updateLabel(n,e),i});var d=l.enter().append(this.NodeCreator.createNode.bind(this.NodeCreator));d.on("mousedown",function(){t.nodeMouseDown=!0,i.event.stopPropagation()}).on("mouseup",function(){t.nodeMouseDown=!1}).on("touchmove",function(){i.event.preventDefault(),i.event.stopPropagation()}).on("touchstart",function(e){o=setTimeout(function(){t.nodeLongtouch(e)},1e3)}).on("touchend",function(){o&&clearTimeout(o)}).call(this.dragListener).on("click",this.nodeClicked.bind(this)).on("contextmenu",this.nodeRightClicked.bind(this)).each(this._setupEvents.bind(this)),!0!==r.Platform.ios&&!0!==r.Platform.ipad&&d.on("mouseenter",this._onMouseEnter.bind(this)).on("mouseleave",this._onMouseLeave.bind(this)),a.enter().append(this.LinksCreator.createNode.bind(this.LinksCreator)),this.dispatchEvent("ENORIPE_UpdateD3Map")},_redraw:function(e){this.nodeMouseDown||(e?this.svgRootG.transition():this.svgRootG).attr("transform","translate("+this.zoomListener.translate()+") scale("+this.zoomListener.scale()+")")},_generateConstraints:function(e,t){var i,n=[],s={},o={},a=[],r=0,l=[],d=function(e,t){return e._attributes.rowID>t._attributes.rowID?1:t._attributes.rowID>e._attributes.rowID?-1:0};for(var h in e.undefined&&delete e.undefined,e)if(e.hasOwnProperty(h)){a=e[h],h=parseInt(h),a=this._generateRowIDs(a);for(var u=0;u<a.length;u++)a[u].get("rowID")>-1&&(l[a[u].get("rowID")]?l[a[u].get("rowID")].push(a[u]):l[a[u].get("rowID")]=[a[u]]);if(e[h+1]&&n.push({axis:this.layoutAxis,left:t.indexOf(a[0]._attributes),right:t.indexOf(e[h+1][0]._attributes),gap:300}),a.length>1){a.sort(d),s={type:"alignment",axis:this.layoutAxis,offsets:[]},o={type:"alignment",axis:"x"===this.layoutAxis?"y":"x",offsets:[]};for(u=0;u<a.length;u++)r=o.offsets[u-1]?o.offsets[u-1].offset+c.getYOffset():0,(i=a[u-1])&&i.get("instances")&&(r+=c.getExpendHeight(),i.get("instancesExpanded")>0&&(r+=i.get("instancesExpanded")*c.getExpendHeight(),i.get("instancesExpanded")<i.get("instances").length&&(r+=c.getExpendHeight()))),s.offsets.push({node:t.indexOf(a[u]._attributes),offset:"0"}),o.offsets.push({node:t.indexOf(a[u]._attributes),offset:r});n.push(s,o)}}if(1===Object.keys(l).length){o={type:"alignment",axis:"x"===this.layoutAxis?"y":"x",offsets:[]};for(u=0;u<l[0].length;u++)o.offsets.push({node:t.indexOf(l[0][u]._attributes),offset:0});n.push(o)}return n},_generateRowIDs:function(e){for(var t,i=e.filter(function(e){return void 0!==e.get("rowID")}),n=e.filter(function(e){return void 0===e.get("rowID")}),s=[],o=e.length,a=0;a<i.length;a++)(t=i[a].get("rowID"))>e.length-1?i[a].set("rowID",e.length-1):t<0&&i[a].set("rowID",0),s[i[a].get("rowID")]?(i[a].unset("rowID"),n.push(i[a])):s[i[a].get("rowID")]=i[a];for(a=0;a<n.length;a++)for(var r=0;r<o;r++)if(void 0===s[r]){n[a].set("rowID",r),s[r]=n[a];break}return s},setAttrData:function(e,t){var i;if(e.isInstances)for(var n=0;n<e.ids.length;n++)(i=this.getElement("#instance-"+e.ids[n]))&&this.NodeCreator.updateToolTip(i,e,e.ids[n]);else if((i=this.getElement("#container-"+e.ids[0]))&&(this.NodeCreator.updateLabel(i,e),this.NodeCreator.updateToolTip(i.getElement(".drag-shape"),e,e.ids[0]),e.toFetchThumbnail)){var s=e.nlsObj[e.ids[0]].preview_url;this.NodeCreator.createThumbnail(i,s)}},initDragListener:function(){var e=this;this.nodeMousePressTime=0,this.dragListener=i.behavior.drag().on("dragstart",function(t){e.nodeMouseDownTime=new Date,e.mouseOriginalY=i.mouse(this)[1],e.dragNodeStarted=!0,e.currentlyDraggingNode=!0,i.event.sourceEvent.stopPropagation()}).on("drag",function(t){if(!1!==e.NodeCreator.layoutingOn){var n=i.mouse(this),s=i.mouse(e.svgContainer[0][0]);if(e.dragNodeStarted&&e.initiateDrag(t,this),s[1]<20)e._panTimer=!0,e._pan(this,"up");else if(s[1]>e.svgContainer[0][0].height.baseVal.value-20)e._panTimer=!0,e._pan(this,"down");else try{clearTimeout(e._panTimer)}catch(e){}t.y0+=n[1]-e.mouseOriginalY;var o,a=e.getElement("#"+this.id).getBoundingClientRect(),r=(a.top+a.bottom)/2;this._selectedNode=null,i.selectAll(".node").each(function(i){t.columnID===i.columnID&&t.id!==i.id&&(o=e.getElement("#"+this.id).getBoundingClientRect()).top<r&&r<o.bottom&&(e._selectedNode=i)}),i.select(this).attr("transform","translate("+t.x+","+t.y0+")"),e._updateReorderFeedback()}}).on("dragend",function(t){var n,s,o,a=i.select(this);if(e.nodeMouseUpTime&&new Date-e.nodeMouseUpTime<100)return;if(e.nodeMouseUpTime=new Date,e.nodeMousePressTime=e.nodeMouseUpTime-e.nodeMouseDownTime,a.classed("node-dragging",!1),e.currentlyDraggingNode=!1,e.mouseOriginalY=0,e.nodeMouseDown=!1,e._selectedNode?(n=e._currentDraggedNode.rowID<e._selectedNode.rowID?"down":"up",s=e._currentDraggedNode.y0<e._selectedNode.y-("thumbnailsMode"===c.getThumbnailsMode()?-20:-5)?"top":"bottom","up"===n&&"top"===s||"down"===n&&"bottom"===s?o=e._selectedNode.rowID:"up"===n&&"bottom"===s?o=e._selectedNode.rowID+1:"down"===n&&"top"===s&&(o=e._selectedNode.rowID-1),e._currentDraggedNode.rowID!==o?e.dispatchEvent("ENORIPE_ReorderColumn",[e._currentDraggedNode,e._selectedNode,o]):a.attr("transform","translate("+t.x+","+t.y+")")):a.attr("transform","translate("+t.x+","+t.y+")"),e._currentDraggedNode=null,e._selectedNode=null,e.svgContainer.classed("dragging",!1),e._updateReorderFeedback(),e.isChrome()&&1===i.event.sourceEvent.which&&0!==e.nodeMousePressTime&&e.nodeMousePressTime<250){var r=new CustomEvent("click",{detail:{isCustom:"true",ctrlKey:i.event.sourceEvent.ctrlKey},bubbles:!0,cancelable:!0});i.event.sourceEvent.toElement?i.event.sourceEvent.toElement.dispatchEvent(r):i.event.sourceEvent.target&&i.event.sourceEvent.target.dispatchEvent(r)}})},initiateDrag:function(e,t){this._currentDraggedNode=e,this.dragNodeStarted=!1,this.svgContainer.classed("dragging",!0),i.select(t).classed("node-dragging",!0).moveToFront()},nodeLongtouch:function(e){["in","out"].forEach(function(t){this._expandMenuViews[t][e.id]&&Object.keys(e[t]).length>0&&this._expandMenuViews[t][e.id].showExpandedMenu()}.bind(this))},nodeClicked:function(e){if(i.event.srcElement){if("multiSel-mapView-icon"===i.event.srcElement.className.baseVal)return}else if(i.event.target&&"multiSel-mapView-icon"===i.event.target.className.baseVal)return;if((!this.isChrome()||i.event.srcElement.hasClassName("drag-shape")||i.event.detail&&"true"===i.event.detail.isCustom)&&!(i.event.defaultPrevented&&this.nodeMousePressTime>100)){i.event.stopPropagation&&i.event.stopPropagation();var t=!1;t=i.event.detail&&i.event.detail.ctrlKey?i.event.detail.ctrlKey:i.event.ctrlKey;var n=this._updateMultiSelState(e);if(t||this._isTouchDevice())this.dispatchEvent("ENORIPE_MultiSel_Object",[{models:e.id,sAction:n,origin:"MapView"}]);else{this.getElement("#container-"+e.id);this._resetOpacity(),this.dispatchEvent("onNodeClicked",[e.id,n]),void 0===this._nodeClickCounter&&(this._nodeClickCounter=0),this._nodeClickCounter++}}},nodeRightClicked:function(e){i.event.stopPropagation(),i.event.preventDefault(),this._resetOpacity(),this.dispatchEvent("onNodeRightClicked",[{id:e.id,context:"D3MapView"}])},_setupDragEndEvent:function(e){var t=this.getElement("#container-"+e.id+" .drag-shap"),i=this;t&&t.addEventListener("dragend",function(){i.dispatchEvent("ENORIPE_dragEnd")})},_onMouseEnter:function(e){var t=this.getElement("#container-"+e.id+" .multiSel-mapView-icon");t&&t.show();var i=this;this._highlightTimeout&&clearTimeout(this._highlightTimeout),this._highlightTimeout=setTimeout(function(){i._fadeLinks(e)},1e3)},_onMouseLeave:function(e){this._highlightTimeout&&clearTimeout(this._highlightTimeout),this._resetOpacity();var t=this.getElement("#container-"+e.id+" .multiSel-mapView-icon");t&&!this._isMultiSelON&&t.removeAttribute("style")},_setupEvents:function(e){var t=this.getElement("#container-"+e.id+" .instance-expander-g"),i=this.getElement("#container-"+e.id+" #toggleMoreInstance");this._setupDragEndEvent(e),this._setupMultiSelEvent(e),t&&t.addEvent("click",this._onClickListInstances.bind(this)),i&&i.addEvent("click",function(t){this._onClickMoreInstances(t,e.instances)}.bind(this))},filter:function(e){var t=e.matchingIDs,i=[],n=[],s=[],o=[];this.endFilter(),this._inFilteringMode=!0,this.svgRootG.classed("links-nodes-faded",!0),(o=t.map(function(e){return"#referenceContainer-"+e})).length>0&&(i=document.querySelectorAll(o.join(", ")));for(var a=0;a<i.length;a++)i[a].addClassName("highlighted");if(e.filteredLinks)for(n=e.filteredLinks.map(function(e){return document.getElementById(e)}),a=0;a<n.length;a++)n[a]&&n[a].addClassName("highlighted");var r=t.map(function(e){return"#instance-"+e});r.length>0&&(s=document.querySelectorAll(r.join(", ")));for(a=0;a<s.length;a++){if(s[a].closest(".node")){var l=s[a].closest(".node").getElement(".nodeReference");l&&l.addClassName("highlighted")}s[a].addClassName("highlighted")}return t},endFilter:function(e){this._inFilteringMode=!1,this._resetOpacity(e)},highlightPath:function(e){this.svgRootG.classed("links-nodes-faded",!0),e.forEach(function(e){var t=document.getElementById("referenceContainer-"+e)||document.getElementById(e);i.select(t).classed("highlighted mouseover",!0)})},unhighlightPath:function(){this.svgRootG.classed("links-nodes-faded",!1),this.svgRootG.selectAll(".highlighted").classed("highlighted",!1).classed("mouseover",!1)},_fadeLinks:function(e){if(null!=this.container&&0!==this.getElements(".link").length){this.getElement("#container-"+e.id);this.currentlyDraggingNode||(this.svgRootG.classed("links-nodes-faded",!0),this.svgRootG.selectAll(".link:not(.highlighted)").filter(function(t){if(t.source.id===e.id||t.target.id===e.id)return i.select("#referenceContainer-"+t.source.id+":not(.highlighted)").classed("highlighted mouseover",!0),i.select("#referenceContainer-"+t.target.id+":not(.highlighted)").classed("highlighted mouseover",!0),t.target.instancesExpanded>0&&i.select("#instance-"+t.instanceTargetId+":not(.highlighted)").classed("highlighted mouseover",!0),!0}).classed("highlighted mouseover",!0),this.svgRootG.selectAll(".link").filter(function(t){if(t.source.id===e.id||t.target.id===e.id)return!0}))}},_resetOpacity:function(e){!e&&this._inFilteringMode?(this.svgRootG.selectAll(".mouseover").classed("highlighted",!1).classed("mouseover",!1),this._inFilteringMode||0!=this.svgRootG.selectAll(".highlighted").data().length||(this.svgRootG.classed("links-nodes-faded",!1),clearTimeout(this._highlightTimeout),this._highlightTimeout=null)):(this._inFilteringMode=!1,this.svgRootG.selectAll(".highlighted").classed("highlighted",!1),this.svgRootG.classed("links-nodes-faded",!1),this.svgRootG.classed("links-faded",!1))},colorize:function(e){var t=null;e.matchingIDs.forEach(function(e){t=null,this.getElement("#container-"+e.id)?t=this.getElement("#container-"+e.id):this.getElement("#instance-"+e.id)&&(t=this.getElement("#instance-"+e.id)),t&&this.NodeCreator.showColor(t,e.color)}.bind(this)),e.filteredLinks&&e.filteredLinks.colorMap&&this.colorizeLinks(e.filteredLinks)},unColorize:function(){this.getElements(".colored-rect-bi").forEach(function(e){e.remove()}),this.getElements(".colored-rect-instance").forEach(function(e){e.remove()}),this.uncolorizeLinks()},setColorOnLink:function(e,t,n){i.select(e).select("path").attr("marker-end","url(#"+t+"_"+n),e.setStyle("fill",n),e.setStyle("stroke",n),e.addClassName("filtered_rel")},setMarkerColorize:function(e,t){for(var i=!1,n=!1,s=0;s<t.length;s++){for(var o={id:e+"_"+t[s].color,position:10,color:t[s].color,dValue:"M 0 0 L 10 5 L 0 10 z"},a=(i=!1,0);a<this.markersData.length;a++)this.markersData[a].id===o.id&&(i=!0);!1===i&&(this.markersData.push(o),n=!0)}n&&this.defs.selectAll("marker").data(this.markersData).enter().append("svg:marker").attr("id",function(e){return e.id}).attr("viewBox","0 0 10 10").attr("refX",function(e){return e.position}).attr("refY",5).attr("markerWidth",10).attr("markerHeight",10).attr("orient","auto").append("svg:path").attr("d",function(e){return e.dValue}).attr("fill",function(e){return e.color})},colorizeLinks:function(e){for(var t in this.setMarkerColorize("node-arrow-relations",e.tagColors),e.colorMap)if(e.colorMap.hasOwnProperty(t)){this.setColorOnLink(document.getElementById(t),"node-arrow-relations",e.colorMap[t]);var n=i.select(document.getElementById(t)).select("path").attr("marker-end");i.select(document.getElementById(t)).select("path").attr("previous-marker",n)}},uncolorizeLinks:function(){i.selectAll(".filtered_rel").select("path").attr("marker-end",function(e){return i.select(document.getElementById(e.id)).select("path").attr("previous-marker")}),i.selectAll(".link").select("path").attr("marker-end","url(#node-arrow)"),i.selectAll(".focus.link").select("path").attr("marker-end","url(#node-arrow-focus)"),this.svgRootG.selectAll(".filtered_rel").classed("filtered_rel",!1),i.selectAll(".link").style("fill",""),i.selectAll(".link").style("stroke","")},initMultiSelection:function(){this._isMultiSelON=1,this.container.removeClassName("multisel-off"),this.container.addClassName("multisel-on")},clearMultiSelection:function(){if(this._isMultiSelON=0,this.container){this.container.removeClassName("multisel-on"),this.container.addClassName("multisel-off"),this.container.removeClassName("unfocused");var e=this;this.getElements(".multiSel-mapView-icon").forEach(function(t){t.setAttribute("data-checked","false"),t.setAttributeNS("http://www.w3.org/1999/xlink","href",e._UncheckedIcon)})}},addToSelection:function(e,t){var i=this.getElement("#container-"+e+" .multiSel-mapView-icon");i&&(i.setAttribute("data-checked","true"),i.setAttributeNS("http://www.w3.org/1999/xlink","href",this._CheckedIcon)),t&&this.updateFocusClasses(e)},removeToSelection:function(e){var t=this.getElement("#container-"+e+" .multiSel-mapView-icon"),i=this.getElement("#container-"+e);i&&(i.removeClassName("focus"),this.NodeCreator.removeSelectedInstance(i,e)),t&&(t.setAttribute("data-checked","false"),t.setAttributeNS("http://www.w3.org/1999/xlink","href",this._UncheckedIcon))},switchFocus:function(e,t){for(var i,n,s=0;s<e.length;s++)i=e[s],(n=this.getElement("#container-"+i+" .multiSel-mapView-icon"))&&(t?(n.setAttribute("data-checked","false"),n.setAttributeNS("http://www.w3.org/1999/xlink","href",this._unfocusedIcon)):(n.setAttribute("data-checked","true"),n.setAttributeNS("http://www.w3.org/1999/xlink","href",this._CheckedIcon)))},_clearSelection:function(){if(i.event.srcElement){if(""!==i.event.srcElement.className.baseVal)return}else if(i.event.target&&""!==i.event.target.className.baseVal)return;var e=this.mouseUpTimeInContainer-this.mouseDownTimeInContainer;i.event.defaultPrevented&&e>100||(this.hideAllExpandedMenu(),this.dispatchEvent("ENORIPE_clearSelection",["MapView"]))},_setupMultiSelEvent:function(e){var t=this.getElement("#container-"+e.id+" .multiSel-mapView-icon"),i=this;t&&t.addEventListener("click",function(t){if(!i.isChrome()||t.detail&&"true"===t.detail.isCustom){t.stopPropagation();var n=i._updateMultiSelState(e);i.dispatchEvent("ENORIPE_MultiSel_Object",[{models:e.id,sAction:n,origin:"MapView"}])}})},_updateMultiSelState:function(e){var t=this.getElement("#container-"+e.id+" .multiSel-mapView-icon"),i="";if(t){this._xUncheckedIcon&&0,this._xCheckedIcon&&0;var n,s=t.getAttribute("data-checked");"false"===s?(s="true",n=this._CheckedIcon,i="add"):(s="false",n=this._UncheckedIcon,i="remove"),t.setAttributeNS("http://www.w3.org/1999/xlink","href",n),t.setAttribute("data-checked",s)}return i},toggleAllInstances:function(e,t){var i=this.getElements(".node");this.updateConstraints(e.getLinksAndNodes(),e.groupBy("columnID")),i.forEach(function(e){e.getElement(".instance-list-g")&&this.NodeCreator.toggleListInstances(e,t)}.bind(this))},_onClickListInstances:function(e){e.stopPropagation(),e.detail&&!e.detail.isCustom&&(this.dispatchEvent("ENORIPE_clickListInstance",[e.currentTarget.parentNode.getAttribute("data-id")]),this.NodeCreator.toggleListInstances(this.getElement("#container-"+e.currentTarget.parentNode.getAttribute("data-id"))))},_onClickMoreInstances:function(e,t){var i=e.currentTarget.closest(".node");e.stopPropagation(),i&&e.detail&&!e.detail.isCustom&&this.dispatchEvent("ENORIPE_clickMoreInstance",[i.getAttribute("data-id"),t])},updateNodesYposition:function(e){var t=[],i=null,n=null,s=null,o=null,a=null,r=null,l=null,d=!0,h=0,u=c.getNodesHeight();t=this.getElements(".node");for(var g=0;g<t.length;g++){d="thumbnailsMode"==e&&!!t[g].getElement(".thumbnail-image"),h=d?u:65,t[g].getElement(".drag-shape-container").setAttribute("height",h),(i=t[g].getElement(".node-text")).setAttribute("y",h-40),i.setAttribute("x",d?25:40),(n=t[g].getElement(".map-type-icon"))&&(n.setAttribute("y",h-40),n.setAttribute("x",d?5:20)),(s=t[g].getElement(".background"))&&s.setAttribute("height",h),(o=t[g].getElement(".thumbnail-background"))&&o.setAttribute("height",h-10),t[g].getElement(".foreign-object-count-mobile").setAttribute("y",h-35),a=t[g].getElements("#toggleEcosystem");for(var p=0;p<a.length;p++)a[p].hasClassName("expandMenuDirection-in")?a[p].setAttribute("style","transform:translate(0px,"+(h/2-30)+"px"):a[p].setAttribute("style","transform:translate("+c.getNodesWidth()+"px,"+(h/2-30)+"px");var m;if(r=t[g].getElement(".instance-expander-g .rect-bkg-instance"),l=t[g].getElements(".rect-list-instance"),r&&l)r.setAttribute("y",h+3),t[g].getElement(".foreign-object-expand").setAttribute("y",h+2),t[g].getElement(".foreign-object-instances").setAttribute("y",h+5),l.forEach(function(e){e.setAttribute("y",h),m=e.getElements(".rect-bkg-instance"),i=e.getElements(".node-text");for(var t=0;t<m.length;t++)m[t].setAttribute("y",d?155+23*t:90+23*t);for(t=0;t<i.length;t++)i[t].setAttribute("y",d?170+23*t:105+23*t)})}var f=document.getElementsByClassName("loader-icon");for(g=0;g<f.length;g++){var v=f[g];d&&"20"===v.getAttribute("y")?v.setAttribute("y","40"):d||"40"!==v.getAttribute("y")||v.setAttribute("y","20")}},updateConstraints:function(e,t){var i=this._generateConstraints(t,e.nodes);this.force.constraints(i).start(),e.nodes.forEach(function(e){e.y0=e.y})},updateFocusClasses:function(e){e&&(this.svgRootG.selectAll(".node.focus").classed("focus",!1),this.nodesContainer.select("#container-"+e).classed({focus:!0}),this.svgRootG.selectAll(".link").classed("focus",function(e){var t=e.source.focus||e.target.focus;return i.select(this).select("path").attr("marker-end",t?"url(#node-arrow-focus)":"url(#node-arrow)"),t}))},centerTheGraph:function(e){var t=this.getBounds();if(t){var n=t.windowHeight,s=t.windowWidth,o=(n+e.actionBarHt)/2,a=(s-e.sidePanelWidth)/2,r=t.left+t.width/2,l=t.top+t.height/2,d=i.transform(i.select("g").attr("transform")),c=d.scale[0],h=d.translate[0]+(a-r),u=d.translate[1]+(o-l);this.zoomListener.translate([h,u]).scale(c),this._redraw(!0)}},fitAllIn:function(e){null==e&&(e={sidePanelWidth:0,actionBarHt:48});var t=this.getBounds(),n=t.windowWidth,s=t.windowHeight,o=s*n,a=t.nodeWidth*t.nodeHeight/o*100,r=Math.sqrt(10/a),l=t.width,d=t.height,c=n-e.sidePanelWidth,h=s-e.actionBarHt,u=Math.min(c/l,h/d);u=u>r?r:u;var g=i.transform(i.select("g").attr("transform")),p=g.scale[0],m=g.translate[0],f=g.translate[1];u=(u=(u*=p)>this._scaleExtent[1]?this._scaleExtent[1]:u)<this._scaleExtent[0]?this._scaleExtent[0]:u,this.zoomListener.translate([m,f]).scale(u),this._redraw(!1),this.centerTheGraph(e)},setSVGDimensions:function(e,t){this.width=t,this.height=e,this.container.setStyle(e),this.svgContainer.attr("width",t).attr("height",e)},addMissingThumbnail:function(e){var t=e.where({thumbnailTBU:!0}),i=this;t.length>0&&t.forEach(function(e){e.get("thumbnail")&&i.NodeCreator.createThumbnail(i.getElement("#container-"+e.id),e.get("thumbnail"))})},layoutingOff:function(){i.selectAll(".node .drag-shape").style("display",""),this.NodeCreator.layoutingOn=!1},layoutingOn:function(){i.selectAll(".node .drag-shape").style("display","none"),this.NodeCreator.layoutingOn=!0},tick:function(){var e=this.svgRootG.selectAll(".link"),t=this.nodesContainer.selectAll(".node"),n=this,s={};t.attr("transform",function(e){return"translate("+e.x+","+e.y+")"}),e.each(function(){var e=i.select(this),t=e.select("path"),o=e.select(".labelText"),a=i.select(this).datum(),l=n.getElements("#from_"+a.source.id+"_to_"+a.target.id),d=!1;if(l.length>1&&(s["#from_"+a.source.id+"_to_"+a.target.id]>=0&&(d=!0,s["#from_"+a.source.id+"_to_"+a.target.id]++),s["#from_"+a.source.id+"_to_"+a.target.id]||(d=!1,s["#from_"+a.source.id+"_to_"+a.target.id]=0)),"ie"===r.Engine.name&&this.parentNode.insertBefore(this,this),t.attr("d",function(e){var t=n.getElement("#from_"+e.target.id+"_to_"+e.source.id);return n._layoutUtils.getPathCoordinates(e,i.select(this),t,d,i.select(this.parentNode))}),!0===d){var c=15*s["#from_"+a.source.id+"_to_"+a.target.id]+5;o.attr("dy",-c)}o.attr("transform",function(e){return n._layoutUtils.rotateTextLabel(e,d)})}),s={}},removeSelectedNodes:function(e,t){e.nodes;return this._removeSelectedNodes(e),this._d3Update(e),this.updateConstraints(e,t),this},_removeSelectedNodes:function(e){var t=e.nodes,i=e.links,n=this.linksContainer.selectAll(".link").data(i,function(e){return e.id});this.nodesContainer.selectAll(".node").data(t,function(e){return e.id}).exit().remove(),n.exit().remove()},_resetFocusedLinksPosition:function(){var e=this.focusContainer.selectAll("g").remove(),t=this;e.empty()||e.each(function(){var e=this;t.linksContainer.append(function(){return e})})},_updateReorderFeedback:function(){var e;i.select("#reorder-feedback").remove(),null!==this._currentDraggedNode&&null!==this._selectedNode&&(e=this._selectedNode.y-("thumbnailsMode"===c.getThumbnailsMode()?-20:-5),this._currentDraggedNode.y0<e?this.getElement("#container-"+this._selectedNode.id).appendChild(this.NodeCreator.getFeedbackReorder("top")):this.getElement("#container-"+this._selectedNode.id).appendChild(this.NodeCreator.getFeedbackReorder("bottom")))},_pan:function(e,t){var n,s,o,a=this;if(this._panTimer){clearTimeout(this._panTimer);var r=i.transform(this.svgRootG.attr("transform"));"up"!==t&&"down"!==t||(n=r.translate[0],s="up"===t?r.translate[1]+50:r.translate[1]-50),o=this.zoomListener.scale(),void 0!==n&&void 0!==s&&(this.zoomListener.translate([n,s]).scale(o),this.svgRootG.transition().attr("transform","translate("+this.zoomListener.translate()+") scale("+this.zoomListener.scale()+")"),this._panTimer=setTimeout(function(){a._pan(e,50,t)},50))}},removeLoadingClass:function(e){var t=this.getElement("#container-"+e);t&&i.select(t).classed("is-loading",!1)},addLoader:function(e){if(e){var t=this.getElement("#container-"+e);i.select(t).classed("is-loading",!0)}},removeLoader:function(e){if(e){var t=this.getElement("#container-"+e);i.select(t).classed("is-loading",!1)}},getBounds:function(){var e=/(msie|trident)/i.test(navigator.userAgent),t=0;if(i.select("g").node()&&i.select(".node").node()){t=i.select("g").node().getBoundingClientRect();var n=i.select(".node").node().getBoundingClientRect(),s={};if(e){for(var o=this.getElements(".node"),a=Number.POSITIVE_INFINITY,r=Number.POSITIVE_INFINITY,l=Number.NEGATIVE_INFINITY,d=Number.NEGATIVE_INFINITY,c=0;c<o.length;c++){var h=o[c].getOffsets();r=Math.min(r,h.x),l=Math.max(l,h.x),a=Math.min(a,h.y),d=Math.max(d,h.y)}var u=n.width,g=n.height,p=(d+=g)-a,m=(l+=u)-r;s.left=r,s.top=a,s.right=l,s.bottom=d,s.windowWidth=window.innerWidth,s.windowHeight=window.innerHeight,s.width=m,s.height=p,s.nodeWidth=u,s.nodeHeight=g}else s.left=t.left,s.top=t.top,s.right=t.right,s.bottom=t.bottom,s.windowWidth=window.innerWidth,s.windowHeight=window.innerHeight,s.width=t.width,s.height=t.height,s.nodeWidth=n.width,s.nodeHeight=n.height}return s},isPathPanel:function(){var e=document.getElementsByClassName("path-panel-view-container");return e.length>0&&"none"!=e[0].style.display},_isTouchDevice:function(){var e=!1;return(r.Platform.ios||r.Platform.android||r.Platform.tablet||r.Platform.blackberry||navigator&&navigator.maxTouchPoints>1)&&(e=!0),e},isChrome:function(){var t=!1;return"chrome"===e.Utils.Client.Engine.name&&(t=!0),t},isInitWithNodes:function(){if(this.nodesContainer){let e=this.nodesContainer.selectAll(".node");return!!(e[0]&&e[0].length>1)}return!1},_graphBounds:function(){var e=Number.POSITIVE_INFINITY,t=Number.NEGATIVE_INFINITY,i=Number.POSITIVE_INFINITY,n=Number.NEGATIVE_INFINITY;return this.nodesContainer.selectAll(".node").each(function(s){e=Math.min(e,s.x-10),t=Math.max(t,s.x+180),i=Math.min(i,s.y),n=Math.max(n,s.y+70)}),{x:e,X:t,y:i,Y:n}},updateCount:function(e){var t=e.getLinksAndNodes().nodes,i=null;t.forEach(function(e){i=this.getElement("#container-"+e.id),this.expandMenuUpdate("in",e,i),this.expandMenuUpdate("out",e,i)}.bind(this)),this.tick()},expandMenuUpdate:function(e,t,i){var n,s=null,o=null;n=(o=t.counts).isAllExpanded(e),i.getElement(".expandMenuDirection-"+e)?this._expandMenuViews[e][t.id]&&(s=this._expandMenuViews[e][t.id],n?o.hasCount(e)?s.setCollapseMenu():s.destroy():s.setExpandMenu(t)):this.createExpandMenu(e,t,i,!0)},createExpandMenu:function(e,t,n,o){var a=null,r=0;n.getElement(".expandMenuDirection-"+e)||(o&&t.counts.hasCount(e)||!o)&&(r=o?t.counts.hasRealCount(e)?1:2:0,this._expandMenuViews[e][t.id]=new s(e,t,n,r),a=this._expandMenuViews[e][t.id],this.listenTo(a,"ENORIPE_ShowPreview",function(e){this.dispatchEvent("ENORIPE_ShowPreview",e)}.bind(this)),this.listenTo(a,"ENORIPE_splitCount",function(e,t,i){this.dispatchEvent("ENORIPE_splitCount",[e,t,i])}.bind(this)),this.listenTo(a,"ENORIPE_movetofront",function(e){i.select(e).moveToFront()}.bind(this)),this.listenTo(a,"ENORIPE_Collapse",function(e,t){this.dispatchEvent("ENORIPE_Collapse",[[e],t])}.bind(this)))},hideAllExpandedMenu:function(){for(var e=0;e<Object.keys(this._expandMenuViews).length;e++)for(var t=this._expandMenuViews[Object.keys(this._expandMenuViews)[e]],i=0;i<Object.keys(t).length;i++)t[Object.keys(t)[i]].hideExpandedMenu()},destroy:function(){this._parent(),this.container=null},hideSpinner:function(){this._spinnerMap&&this._spinnerMap.hide()},onViewReady:function(){this.hideSpinner()}})}),define("DS/SNNavigationMap/views/DataGridView",["UWA/Core","UWA/Class","UWA/Class/View","UWA/Controls/Abstract","DS/Tree/TreeDocument","DS/Tree/TreeNodeModel","DS/DataGridView/DataGridView","DS/DataGridView/DataGridViewLayout","DS/i3DXCompassPlatformServices/OpenWith","DS/Windows/ImmersiveFrame","DS/Utilities/Utils","DS/SNNavigationMap/utils/CommonUtils","DS/SNNavigationMap/utils/RelationsServices","DS/SNNavigationMap/MapSettings","DS/SNNavigationMap/utils/DataGridCustoColumnsUtils","DS/WebappsUtils/WebappsUtils","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_internal"],function(e,t,i,n,s,o,a,r,l,d,c,h,u,g,p,m,f){"use strict";return i.extend({name:"datagrid-view",tree:{},collectionView:{},models:[],cols:[],attributes:[],promiseManager:{},isWebInWin:!1,modelsToAdd:{},linksInTree:[],expandingModelIds:[],expandDirection:{upstream:!0,downstream:!0},rightClickModel:null,tenantName:"",_countInfos:{},_custoColumns:[],_taggerInUse:!1,_nbFixedColumn:3,_fromSwitch:!1,TIMEOUT:6e4,LOOPINTERVAL:1e3,className:function(){return this.getClassNames("-container")},setup:function(e){this.tree=new s,this.promiseManager=e.promiseManager||null,this.isWebInWin=e.isWebInWin||!1,this.collection=e.collection,this.tenantName=e.tenantName||"OnPremise",this._custoColumns=new p(this.collection).getCustoColumns()},buildSkeleton:function(e,t,i,n){var s=this;this._fromSwitch=n,this.clear(),i&&(this.attributes=i),this.cols=[{text:f.get("DatagridColumn-Title"),dataIndex:"tree",typeRepresentation:"string",width:250,getCellKPIColor:function(e){if(!e.isHeader&&e.nodeModel&&e.nodeModel.options.color)return e.nodeModel.options.color}},{text:f.get("DatagridColumn-Title"),dataIndex:"instanceTitle",typeRepresentation:"string",icon:"flow-cascade",visibleFlag:g.getInstancesMode()},{text:f.get("DatagridColumn-Relation"),dataIndex:"relation",typeRepresentation:"string",icon:this.expandDirection.upstream&&this.expandDirection.downstream?"":"filter",width:100},{text:"Direction",dataIndex:"linkDirection",typeRepresentation:"string",visibleFlag:!1}],this._nbFixedColumn=g.getInstancesMode()?3:2;for(var o={},l=0;l<i.length;l++)if("ds6w:label"!==i[l].uri){if(i[l].uri in this._custoColumns)o={text:i[l].label,...this._custoColumns[i[l].uri]};else{var h="ds6w:modified"===i[l].uri?"datetime":"string";void 0!==i[l].dataType&&(h=i[l].dataType.toLowerCase()),"real"===h?h="string":"timestamp"===h&&(h="datetime"),o={text:i[l].label,dataIndex:i[l].uri,typeRepresentation:h,alignment:"boolean"===h?"center":"near"}}this.cols.push(o)}this.cols=this.cols.map(e=>void 0===e.getCellTooltip?{...e,getCellTooltip:(e=>{var t=void 0;if(e.nodeModel&&e.nodeModel.options.grid&&e.nodeModel.options.grid.nlsObj){var i=s.collectionView.getColumnOrGroup(e.columnID),n=i.dataIndex;if("tree"===i.dataIndex&&(n="ds6w:label"),"relation"===n)t=e.nodeModel.options.grid.relation;else if(t=e.nodeModel.options.grid.nlsObj[n],"datetime"===i.typeRepresentation){t=new Intl.DateTimeFormat(g.getLang(),{year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"numeric"}).format(new Date(t))}}return void 0!==t?{shortHelp:t}:s.collectionView.getCellDefaultTooltip(e)}).bind(s)}:e),this.cols=this.setColumnsWidth(this.cols);var u=new r({cellHeight:38,useLastColumnWidthAutoFlag:!0});this.collectionView=new a({treeDocument:this.tree,columns:this.cols,showRowIndexFlag:!1,cellDragEnabledFlag:!0,showRowBorderFlag:!0,showColumnBorderFlag:!0,showSelectionCheckBoxesFlag:!0,columnDragEnabledFlag:!1,rowSelection:"multiple",cellSelection:"none",useDragAndDrop:!0,selectionBehavior:{unselectAllOnEmptyArea:!0,toggle:!1,canMultiSelect:!0,enableShiftSelection:!0,canInteractiveMultiselectWithCheckboxClick:!0},defaultColumnDef:{editableFlag:!1,alignment:"near"},layout:u,sortModel:[{dataIndex:"linkDirection",sort:"desc"},{dataIndex:"relation",sort:"asc"},{dataIndex:"tree",sort:"asc"}],onDelayedModelDataRequest:function(e){c.debounce(function(){this.updateAttributes(e)}.bind(this),500)()}.bind(this),onContextualEvent:function(e){return this._buildContextualMenu(e).then(function(e){return e})}.bind(this)});var p=new d;if(p.setContentInBackgroundLayer(this.collectionView.getContent()),p.reactToPointerEventsFlag=!1,p.inject(this.container),g.getValuesInPref("expandedDirection")){let e=JSON.parse(g.getValuesInPref("expandedDirection"));this.setExpandDirection(e)}this.setRootNodes(e,n,!0),this.setData(!1),this._setRowEvent(),this._setDatagridEvent()},setData:function(e,t){var i={},n=[],s={},o={},a=!1;(n=this.collection.where({modelType:"link"}),this._fromSwitch=e,0===this.expandingModelIds.length&&(t||(a=!0)),this.tree.getAllDescendants().forEach(function(e){(0===this.expandingModelIds.length||this.expandingModelIds.indexOf(e._id)>-1)&&(i[e.id]||(i[e.id]=[]),i[e.id].push(e))}.bind(this)),n.forEach(function(e){if(this.linksInTree.indexOf(e.id)<0){var t,n=Object.keys(i);if(n.indexOf(e.get("source").id)>-1)s={targetId:e.get("target").id,sourceId:e.get("source").id,inverseDirection:!1,link:e},(t=this._buildModelToAdd(s,i))&&(this.linksInTree.push(e.id),o[s.targetId]=t,this._setModelToAdd(s.targetId,t));if(n.indexOf(e.get("target").id)>-1)s={targetId:e.get("source").id,sourceId:e.get("target").id,inverseDirection:!0,link:e},(t=this._buildModelToAdd(s,i))&&(this.linksInTree.push(e.id),o[s.targetId]=t,this._setModelToAdd(s.targetId,t))}}.bind(this)),this.tree.prepareUpdate(),Object.keys(o).length>0&&(this._addRelationsNode(Object.keys(o),a),(e||a)&&this.setData(e)),this.collection.currentModelId&&0===[].length&&0===Object.keys(o).length&&this.expandingModelIds.length>0)&&this.getAllNodesById(this.collection.currentModelId[0]).forEach(function(e){}.bind(this));this.collectionView.reapplySortModel(),this.tree.pushUpdate()},createNode:function(e,t){var i={},n={},s="";if(e.nlsObj&&(e={...e,...e.nlsObj}),t&&(e={...e,...t},s=this.getDirectionIcon(t.linkDirection)),n={label:e.name,icons:[{iconName:s},{iconPath:e.type_icon_url}],children:[],grid:e},this._fromSwitch||(n.icons[1].badges={topLeft:{iconName:"reload wux-ui-3ds-spin",fontIconSize:"1x",className:"dgv-badge-top"}}),(i=new o(n)).id=e.id,!0===e.focus){var a=this.tree.getXSO();let e={isMultisel:this.getSelectedModels().length>1,nodeId:i.id,action:"add",selected:!0};i.getAttributeValue("instanceId")&&(e.instanceId=i.getAttributeValue("instanceId")),this.dispatchEvent("ENORIPE_onRowClicked",e),a.add(i)}return i.onPostCollapse(function(e){var t=[...i.getChildren()];this._collapseNode(t,i)}.bind(this)),i.onPostExpand(function(t){var n=[],s=(this.TIMEOUT,this.LOOPINTERVAL,n=i.getChildren(),[]);this._taggerInUse||(n.forEach(function(e){e.isHidden()&&e.show()}),this.setNodeInExpandingState(i),e.counts&&(s=e.counts.getRealCountAttribute("name")),this.dispatchEvent("ENORIPE_ExpandNode",[[i.id],s]))}.bind(this)),i},_isChild:function(e,t){var i=e.getChildren();if(i)for(var n=0;n<i.length;n++)if(i[n].id===t)return!0;return!1},_addRelationsNode:function(e,t){var i=!1,n=[];e.forEach(function(e){i=this.setNewChildNode(e,t)}.bind(this)),i&&this.dispatchEvent("ENORIPE_UpdateCollectionWithView"),e.forEach(function(e){this.modelsToAdd[e].forEach(function(e){e.sources.forEach(function(e){if(n.indexOf(e._id)<0){this.collection.get(e.id).get("counts");n.push(e._id)}}.bind(this))}.bind(this)),delete this.modelsToAdd[e]}.bind(this))},_addRootNodes:function(e,t){var i={};e.forEach(function(e){i=this.createNode(e),this.tree.addRoot(i)}.bind(this))},setRootNodes:function(e,t,i){var n=[],s=[],o=!1;e.forEach(function(e){this.models.indexOf(e)<0&&this.models.push(e)}.bind(this)),e.forEach(function(e){var t=e._attributes;s.push(t),t.nlsObj||n.push({targetId:t.id})}.bind(this)),!(this.collection.getNodesIds().length===e.length&&e.every(function(e){return this.collection.getNodesIds().includes(e.id)}.bind(this)))&&i&&(o=!0),this.tree.prepareUpdate(),this._addRootNodes(s,o),t&&this.setData(t),this.tree.pushUpdate()},setNewChildNode:function(e,t){var i=null,n=this.modelsToAdd[e],s={},o=!1,a="collapsed",r=!1;return this.collection.get(e)&&this.collection.get(e)._attributes&&(i={...this.collection.get(e)._attributes}),i&&n.forEach(function(e){this.mustBeHidden(e)?r=!0:e.sources.forEach(function(n){this.collection.get(n.id)&&this.collection.get(n.id).get("counts");if(e.relation&&(s={relation:e.relation,linkId:e.linkId,linkDirection:e.linkDirection,linkType:e.linkType}),t&&(i.fromInit=!0),i.instances&&i.instances.length>0&&i.instances.forEach(function(e){if(s.linkId.contains(e.id)){i.instanceTitle=e["ds6w:label"],i.instanceId=e.id,i.test=!0;let t=this.createNode(i,s);return n.addChild(t),a=this.getExpandStatus(t.getAttributeValue("counts"),t),t.setState({state:a}),this.expandingModelIds.indexOf(t._id)>-1&&this.expandingModelIds.splice(this.expandingModelIds.indexOf(t._id),1),void(o=!0)}}.bind(this)),!o){let e=this.createNode(i,s);n.addChild(e),a=this.getExpandStatus(e.getAttributeValue("counts"),e),e.setState({state:a}),this.expandingModelIds.indexOf(e._id)>-1&&this.expandingModelIds.splice(this.expandingModelIds.indexOf(e._id),1)}a=this.getExpandStatus(n.getAttributeValue("counts"),n),n.setState({state:a}),this.expandingModelIds.indexOf(n._id)>-1&&this.expandingModelIds.splice(this.expandingModelIds.indexOf(n._id),1),o=!1}.bind(this))}.bind(this)),r},toggleAllInstances:function(){var e=!this.collectionView.layout.getColumnVisibleFlag("instanceTitle");this.collectionView.layout.setColumnVisibleFlag("instanceTitle",e),this._nbFixedColumn=e?3:2},setNodeInExpandingState:function(e){this.expandingModelIds.push(e._id),e.setState({state:"expanding"})},updateColumns:function(e){for(var t=-1,i=[],n=-1,s=-1,o=0;o<e.length;o++)"ds6w:label"!==e[o].uri&&(t=this.collectionView.layout.getColumnIndex(e[o].uri))>=0&&(n=(i=this.collectionView.layout.getVisibleOrderedColumnsIndexes()).indexOf(t)+1,s=i[o+(this._nbFixedColumn-1)],n!=o+this._nbFixedColumn&&this.collectionView.layout.moveColumn(t,s))},updateColumnIcon:function(e,t){var i;i=this.collectionView.layout.getColumnIndex(e),this.collectionView.layout.setColumnOrGroupProperties(i,{icon:t})},collapseNode:function(e,t){var i=[];this.tree.getSelectedNodes().forEach(function(n){t.indexOf(n.id)>-1&&(i=[],n.getChildren().forEach(function(t){e.indexOf(t.id)>-1&&i.push(t)}),i.length>0&&this._collapseNode(i,n))}.bind(this))},_collapseNode:function(e,t){var i=[];e.forEach(function(e){1===this.getAllNodesById(e.id).length&&i.push(e.id),e.remove(),e.getAttributeValue("linkId")&&this.linksInTree.indexOf(e.getAttributeValue("linkId"))>-1&&(this.linksInTree.splice(this.linksInTree.indexOf(e.getAttributeValue("linkId")),1),i.push(e.getAttributeValue("linkId")))}.bind(this)),t.getNumberOfVisibleChildren()>0?t.setState({state:"partiallyExpanded"}):t.setState({state:"collapsed"}),this.expandingModelIds.indexOf(t._id)>-1&&this.expandingModelIds.splice(this.expandingModelIds.indexOf(t._id),1),this.dispatchEvent("ENORIPE_CollapseNode",[[t.id],i,this.getVisibleNodes(!1)])},setExpandDirection:function(e){null!=e.upstream&&(this.expandDirection.upstream=e.upstream),null!=e.downstream&&(this.expandDirection.downstream=e.downstream)},setColumnsWidth:function(e){return g.getValuesInPref("dgvOptions")&&JSON.parse(g.getValuesInPref("dgvOptions")).forEach(function(t){e.find(function(i,n){if(i.dataIndex===t.dataIndex&&t.width)return e[n].width=t.width,!0})}),e},addToSelection:function(e,t,i){var n=this.tree.getXSO();this.getAllNodesById(e).forEach(function(e){e.isSelected()||(i?e.getAttributeValue("instanceId")===i&&n.add(e):n.add(e))})},removeToSelection:function(e,t){var i=this.tree.getXSO();this.getAllNodesById(e).forEach(function(e){e.isSelected()&&(t?e.getAttributeValue("instanceId")===t&&i.remove(e):i.remove(e))})},updateAttributes:function(e){var t=this,i=this.getVisibleNodes(),n=[],s={};this.tree.prepareUpdate();for(var o=e.startNodeIndex;o<=e.endNodeIndex;o++)i[o]&&this.collection.get(i[o].id)&&!this.collection.get(i[o].id)._attributes.nlsObj&&n.indexOf(i[o].id)<0&&n.push(i[o].id);n.length>0&&this._getNls(n).then(function(e){e.forEach(function(e){t.getAllNodesById(e).forEach(function(e){s=t.collection.get(e.id)._attributes,s={...s,...s.nlsObj},e.updateOptions({grid:s})})})}),this.tree.pushUpdate()},_buildModelToAdd:function(e,t){for(var i=e.targetId,n=e.link,s={},o=null,a={sources:[]},r="",l="",d=!1,c=[],u="",g=0;g<t[e.sourceId].length;g++){if((o=t[e.sourceId][g]).getReferenceValue("instances")&&(o.getReferenceValue("instances").forEach(function(e){n.get("id").contains(e.id)&&(d=!0)}),d&&o.getReferenceValue("instanceId")&&!n.get("id").contains(o.getReferenceValue("instanceId"))))return;if(s=h.getProfileDirections(n.get("type")),e.inverseDirection&&s._from?(r=n.get("type").replace("_to","_from"),l=f[r+"_short"]||f[r]||r):(r=n.get("type"),l=f[r+"_short"]||f[r]||r),"to"===(c=r.split("_"))[c.length-1]?u="downstream":"from"===c[c.length-1]&&(u="upstream"),this._getIndexModelToAdd(i,o,n.id)<0&&!this._isInBranch(o,i,r))if(0===a.sources.length){a.sources.push(o);var p={relation:l,linkId:n.get("id"),linkDirection:u,linkType:r};a={...a,...p}}else a.sources.push(o)}return 0!=a.sources.length?a:null},_setModelToAdd:function(e,t){e&&(this.modelsToAdd[e]||(this.modelsToAdd[e]=[]),this.modelsToAdd[e].push(t))},_updateDirection:function(e){this.expandDirection[e]?this.dispatchEvent("ENORIPE_HideOneDirection",e):this.dispatchEvent("ENORIPE_ShowOneDirection",e),this.expandDirection[e]=!this.expandDirection[e]},updateCount:function(e){this.tree.processDescendants({processNode:function(t){if(e.get(t.nodeModel.id)&&e.get(t.nodeModel.id).get("counts")){let i=e.get(t.nodeModel.id).get("counts"),n=this.getExpandStatus(i,t.nodeModel);t.nodeModel.setState({state:n}),t.nodeModel.preExpandDone({state:n}),this.expandingModelIds.indexOf(t.nodeModel._id)>-1&&this.expandingModelIds.splice(this.expandingModelIds.indexOf(t.nodeModel._id),1);let s=UWA.clone(t.nodeModel.options.icons);s[1].badges&&(s[1].badges.topLeft=null,t.nodeModel.updateOptions({icons:s}))}}.bind(this)})},removeSelectedNodes:function(){return this.tree.getSelectedNodes().forEach(function(e){var t=[...e.getChildren()];t.length>0&&this.collapseNode(t,[e]),e.getParent()&&(e.getParent().removeChild(e),this.linksInTree.indexOf(e.getAttributeValue("linkId"))>-1&&this.linksInTree.splice(this.linksInTree.indexOf(e.getAttributeValue("linkId")),1))}.bind(this)),console.log("end"),this},filter:function(e){var t,i=[];return this.endFilter(),this._taggerInUse=!0,e.matchingIDs.forEach(function(t){this.getAllNodesById(t).forEach(function(t){e.filteredLinks&&e.filteredLinks.length>0?e.filteredLinks.indexOf(t.getAttributeValue("linkId"))>-1&&i.push(t):i.push(t)})}.bind(this)),i.forEach(function(e){e.getParents().forEach(function(e){i.push(e)})}),this.tree.search({match:function(e){if(i.indexOf(e.nodeModel)<0&&"collapsed"!=e.nodeModel.getParent().getState()){var t="partiallyExpanded"===e.nodeModel.getParent().getState();return e.nodeModel.setAttribute("filter",!0),e.nodeModel.hide(),0===e.nodeModel.getParent().getNumberOfVisibleChildren()&&t&&e.nodeModel.getParent().setState({state:"collapsed"}),!0}}.bind(this)}),t=i.map(function(e){return e.id}),this._taggerInUse=!1,t},endFilter:function(){this._taggerInUse=!0,this.tree.getAllDescendants().forEach(function(e){e.getAttributeValue("filter")&&(e.setAttribute("filter",!1),e.show(),e.getParent().isExpanded()||e.reverseExpand())}),this._taggerInUse=!1},colorize:function(e){var t={};e.matchingIDs&&e.matchingIDs.forEach(function(e){this.getAllNodesById(e.id).forEach(function(t){t.updateOptions({color:e.color})}.bind(this))}.bind(this)),e.filteredLinks&&e.filteredLinks.colorMap&&(t=e.filteredLinks.colorMap,this.tree.search({match:function(e){Object.keys(t).indexOf(e.nodeModel.getAttributeValue("linkId"))>-1&&e.nodeModel.updateOptions({color:t[e.nodeModel.getAttributeValue("linkId")]})}}))},unColorize:function(){this.tree.getAllDescendants().forEach(function(e){e.updateOptions({color:null})}.bind(this))},_setRowEvent:function(){var e=this,t={},i=null,n=!1;(i=this.tree.getXSO()).onPostAdd(function(s){s.forEach(function(s){g.getInstancesMode()||e.getAllNodesById(s.getAttributeValue("id")).forEach(function(e){i.add(e)}),n=e.getSelectedModels().length>1,t={isMultisel:n,nodeId:s.id,action:"add",selected:!0},s.getAttributeValue("instanceId")&&(t.instanceId=s.getAttributeValue("instanceId")),e.dispatchEvent("ENORIPE_onRowClicked",t)})}),i.onPostRemove(function(n){n.forEach(function(n){e.collection.get(n.id)&&(g.getInstancesMode()||e.getAllNodesById(n.getAttributeValue("id")).forEach(function(e){i.remove(e)}),t={isMultisel:!0,nodeId:n.id,action:"remove",selected:!1},n.getAttributeValue("instanceId")&&(t.instanceId=n.getAttributeValue("instanceId")),e.dispatchEvent("ENORIPE_onRowClicked",t))})})},_setDatagridEvent:function(){var e=this;this.collectionView.onDragStartCell=function(t,i){var n=[],s=[];i.draggedNodes.forEach(function(t){s.indexOf(t.getAttributeValue("id"))<0&&(s.push(t.getAttributeValue("id")),n.push({serviceId:"3DSpace",objectId:t.getAttributeValue("id"),objectType:t.getAttributeValue("type"),displayName:t.getAttributeValue("name"),envId:e.tenantName}))});var o={protocol:"3DXContent",version:"1.0",source:"ENORIPE_AP",data:{items:n}};e.dispatchEvent("ENORIPE_dragElement",[t,o])},this.collectionView.addEventListener("userPreferencesChange",function(e){for(var t=this.collectionView.layout.getOrderedColumnsIndexes(),i=[],n=0;n<t.length;n++){let e=this.collectionView.getColumnOrGroup(t[n]);e.width&&i.push({width:e.width,dataIndex:e.dataIndex})}g.saveValuesInPref("dgvOptions",JSON.stringify(i))}.bind(this))},_buildContextualMenu:function(e){var i=this,n=[],s={},o={},a=null;return e.cellInfos&&e.cellInfos.nodeModel&&e.cellInfos.rowID>-1&&(a=e.cellInfos.nodeModel,this.rightClickModel=a),new t.Promise(function(t,r){this.isWebInWin?a&&(this.dispatchEvent("onRowRightClicked",[{id:a.id,context:"DataGridView"}]),t([])):a&&e.cellInfos&&e.cellInfos.rowID>-1&&(a.getAttributeValue("type")&&a.getAttributeValue("type").contains("Document")&&n.push({type:"PushItem",title:f.get("Download"),icon:{iconName:"download",fontIconFamily:1},action:{callback:function(){i.dispatchEvent("ENORIPE_DownloadDocument",[a.id,a.getAttributeValue("name")])}},state:"enabled"}),this.getExpandCollapseCtxMenu(a,!1).then(function(e){n=[...n,...e]}.bind(this)).finally(function(){s=h.getContentForOpenWith(a.id,a.getAttributeValue("type"),a.getAttributeValue("relTypesTaxonomies")),(o=(new l).set3DXContent(s)).retrieveCompatibleApps(function(e){if(e&&e.length>0){var i=[];if(e.forEach(function(e){i.push({type:"PushItem",title:e.text,fonticon:e.fonticon&&e.fonticon.length>0?{content:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-"+e.fonticon,family:WUXManagedFontIcons.Font3DS}:void 0,icon:e.icon?e.icon:"",action:{callback:e.handler}})}),i.length>0){var s={name:"OpenWith",type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-"+o.DROPDOWN_CONF.fonticon},title:o.DROPDOWN_CONF.text,submenu:i};n.push(s)}}t(n)})})),e.cellInfos&&-1===e.cellInfos.rowID&&(n.push({type:"PushItem",title:this.expandDirection.upstream?f.get("HideUpstream"):f.get("ShowUpstream"),icon:{iconName:this.expandDirection.upstream?"left-minus":"left-add",fontIconFamily:1},action:{callback:function(){this._updateDirection("upstream")}.bind(this)}}),n.push({type:"PushItem",title:this.expandDirection.downstream?f.get("HideDownstream"):f.get("ShowDownstream"),icon:{iconName:this.expandDirection.downstream?"right-minus":"right-add",fontIconFamily:1},action:{callback:function(){this._updateDirection("downstream")}.bind(this)}}),t(n))}.bind(this))},getExpandCollapseCtxMenu:function(e,i){var n=[],s=[],o=[],a={};return new t.Promise(function(t,r){if("expanded"!==e.getState()&&"partiallyExpanded"!==e.getState()||((a={model:e,upstreamChildren:this.getChildrenInOneDirection(e,"upstream"),downstreamChildren:this.getChildrenInOneDirection(e,"downstream")}).upstreamChildren.length>0&&(a.direction="upstream",o=this._getCollapseSubMenu(a,i),n.push(o)),a.downstreamChildren.length>0&&(a.direction="downstream",o=this._getCollapseSubMenu(a,i),n.push(o)),"expanded"===e.getState()&&t(n)),"collapsed"===e.getState()||"partiallyExpanded"===e.getState()){var l={};a={model:e},e.getAttributeValue("counts")?((l=this._getCurrentCounts(e.getAttributeValue("counts"),e)).upstreamCounts.length>0&&(a.direction="upstream",s=this._getExpandSubMenu(a,l,i),n.push(s)),l.downstreamCounts.length>0&&(a.direction="downstream",s=this._getExpandSubMenu(a,l,i),n.push(s)),t(n)):r()}r()}.bind(this))},getChildrenInOneDirection:function(e,t){var i=[];return e.getChildren().forEach(function(e){e.isHidden()||e.getAttributeValue("linkDirection")===t&&i.push(e)}),i},_getExpandSubMenu:function(e,t,i){var n={},s=[],o="",a=0,r={},l={},d=[];if("upstream"===e.direction?(o="in",d=t.upstreamCounts):(o="out",d=t.downstreamCounts),d.forEach(function(t){(l={}).title=t.get("count")+" "+t.get("relationName"),l.callback=function(){this.setNodeInExpandingState(e.model),this.dispatchEvent("ENORIPE_ExpandNode",[[e.model.id],[t.get("name")],o])}.bind(this),t.get("count")>0&&(s.push(this._getContextualObject(i,l)),a+=parseInt(t.get("count")))}.bind(this)),a>0){switch(e.direction){case"upstream":r.icon=i?m.getWebappsAssetUrl("SNNavigationMap","icons/upstream_arrow.png"):"left-add",r.title=f.get("SNNavigationMap.ExpandUpstream.Title")+" ("+a+")";break;case"downstream":r.icon=i?m.getWebappsAssetUrl("SNNavigationMap","icons/downstream_arrow.png"):"right-add",r.title=f.get("SNNavigationMap.ExpandDownstream.Title")+" ("+a+")";break;default:return n}r.callback=function(){this.setNodeInExpandingState(e.model),this.dispatchEvent("ENORIPE_ExpandNode",[[e.model.id],[],o])}.bind(this),i&&s.push(this._getContextualObject(i,{title:f.get("SNNavigationMap.ExpandAll.Title")+" ("+a+")",callback:r.callback})),n=this._getContextualObject(i,r,s)}return n},_getCollapseSubMenu:function(e,t){var i,n={},s=[],o={},a=[],r={},l=[];switch(i=e.model,e.direction){case"upstream":r.icon=t?m.getWebappsAssetUrl("SNNavigationMap","icons/upstream_arrow.png"):"left-minus",a=e.upstreamChildren,e.downstreamChildren,r.title=f.get("SNNavigationMap.CollapseUpstream.Title")+" ("+a.length+")";break;case"downstream":r.icon=t?m.getWebappsAssetUrl("SNNavigationMap","icons/downstream_arrow.png"):"right-minus",a=e.downstreamChildren,e.upstreamChildren,r.title=f.get("SNNavigationMap.CollapseDownstream.Title")+" ("+a.length+")";break;default:return n}return l=this.getCountsFromNodes(a),Object.keys(l).forEach(function(e){(o={}).title=l[e].length+" "+e,o.callback=function(){var t=[];a.forEach(function(i){l[e].indexOf(i.id)>-1&&t.push(i)}.bind(this)),this._collapseNode(t,i)}.bind(this),s.push(this._getContextualObject(t,o))}.bind(this)),r.callback=function(){this._collapseNode(a,i)}.bind(this),t&&s.push(this._getContextualObject(t,{title:f.get("SNNavigationMap.CollapseAll.Title")+" ("+a.length+")",callback:r.callback})),n=this._getContextualObject(t,r,s)},_getContextualObject:function(e,t,i){var n={};return t.title&&(e?(n={text:t.title,handler:t.callback},t.icon&&(n.icon=t.icon),i&&i.length>0&&(n.items=i)):(n={type:"PushItem",title:t.title,action:{callback:t.callback}},t.icon&&(n.icon={iconName:t.icon,fontIconFamily:1}),i&&i.length>0&&(n.submenu=i))),n},getDirectionIcon:function(e){var t="";switch(e){case"upstream":t="left";break;case"downstream":t="right";break;default:t=""}return t},getOneDirectionLink:function(e){var t=[],i=!1;return this.tree.getAllDescendants().forEach(function(n){i=!1,t.indexOf(n.id)<0&&n.getAttributeValue("linkDirection")===e&&(this.getAllNodesById(n.id).forEach(function(t){t.getAttributeValue("linkDirection")!=e&&(i=!0)}),i||t.push(n.id))}.bind(this)),t},getRightClickModel:function(){return this.rightClickModel},getCountsFromNodes:function(e){var t={},i="";return e.forEach(function(e){e.isHidden()||(i=e.getAttributeValue("relation"),Object.keys(t).indexOf(i)<0?(t[i]=[],t[i].push(e.id)):t[i].push(e.id))}),t},getAllNodesByLabel:function(e){return this.tree.search({match:function(t){if(e&&-1!==t.nodeModel.getLabel().indexOf(e))return!0}})},getAllNodesById:function(e){return this.tree.search({match:function(t){if(e&&t.nodeModel.id===e)return!0}})},getSelectedModels:function(){var e=[];return this.tree.getSelectedNodes().forEach(function(t){this.collection.get(t.id)&&e.push(this.collection.get(t.id))}.bind(this)),e},getRootModels:function(){return[...this.models]},getRootModelsIds:function(){return this.models.map(function(e){return e.id})},getVisibleNodes:function(e){var t=[];return this.tree.processDescendants({onlyVisibleNodes:!0,processNode:function(i){e&&t.indexOf(i.nodeModel.id)<0?t.push(i.nodeModel.id):!e&&t.indexOf(i.nodeModel)<0&&t.push(i.nodeModel)}}),t},getAllNodes:function(e){var t=[];return this.tree.processDescendants({onlyVisibleNodes:!1,processNode:function(i){t.indexOf(i.nodeModel.id)<0&&(e?t.push(i.nodeModel.id):t.push(i.nodeModel))}}),t},getExpandDirection:function(){return this.expandDirection()},_getCurrentCounts:function(e,t){var i=[],n=0,s="",o={};return o={downstreamCounts:[],upstreamCounts:[],counts:[],childrenNumber:0},"collapsed"!=t.getState()&&(i=this.getCountsFromNodes(t.getChildren())),e.getAllCounts().forEach(function(e){n=e.get("count"),s=e.get("relationName");let a=e.clone();t.getAttributeValue("linkType")&&h.getReverseRelations(t.getAttributeValue("linkType"))===e.get("name")&&n--,Object.keys(i).indexOf(s)>-1&&(n-=i[s].length),n>0&&(a.set(e,n),"out"===e.get("direction")?o.downstreamCounts.push(a):o.upstreamCounts.push(a)),o.childrenNumber+=parseInt(n)}),o.counts=[...o.downstreamCounts,...o.upstreamCounts],o.childrenNumber+=t.getNumberOfVisibleChildren(),o},_getIndexModelToAdd:function(e,t,i){if(this.modelsToAdd[e])for(var n=0;n<this.modelsToAdd[e].length;n++){var s=this.modelsToAdd[e][n];if(s.sources.indexOf(t)>-1&&s.linkId===i)return n}return-1},_isInBranch:function(e,t,i){var n=[],s=[];if(e){if(e.getRoot().id===t||e.id===t)return!0;if(n=e.getChildren())for(var o=0;o<n.length;o++)if(n[o].id===t&&n[o].getAttributeValue("type")===i)return!0;s=e.getParents(!0);for(o=0;o<s.length;o++)if(s[o].id===t)return!0}return!1},getExpandStatus:function(e,t){var i=0,n=e.getCountsNumber(e.getAllCounts());t.getChildren()&&(i=t.getChildren().length);let s=e.getExpandedRelations();return s.forEach(function(e){t.getAttributeValue("linkType")===h.getReverseRelations(e.relations)&&n--}),0===n?"noChildren":t.getChildren()?n===i?"expanded":1!==s.length||1!==s[0].count||t.isRoot()?e.getCountsNumber(e.getAllCounts())===s.length?"noChildren":0===i?"collapsed":"partiallyExpanded":t.getAttributeValue("linkType")===h.getReverseRelations(s[0].relations)?"collapsed":"partiallyExpanded":void 0},isInitWithNodes:function(){var e=this.getRootModels();return!!(e&&e.length>0)},mustBeHidden:function(e){return!(!e||!e.linkDirection||!1!==this.expandDirection[e.linkDirection])},_getNls:function(e){var i,n=this,s={};return e.forEach(function(e){n.collection.get(e)&&(s[e]=n.collection.get(e))}),i=h._prepareDataToNls(Object.values(s)),new t.Promise(function(t,o){h._getNlsAndProcessData(i,e,s,!1).then(function(i){for(var s=0;s<Object.keys(i.nlsObj).length;s++)n.collection.setNlsObj(Object.keys(i.nlsObj)[s],Object.values(i.nlsObj)[s]);t(e)},function(){console.log("err while fetching attributes"),t()})})},updateColumnsHeaderNls:function(e){let t={};e.EnoripeColumns.attributes.forEach(e=>{t[e.uri]=e.label}),this.cols.forEach(e=>{void 0!==t[e.dataIndex]&&(e.text=t[e.dataIndex])})},clear:function(){this.cols=[],this.models=[],this.attributes=[],this.modelsToAdd={},this.tree=new s,this.linksInTree=[],this.expandingModelIds=[],this.container.innerHTML="",this.rightClickModel=null}})}),define("DS/SNNavigationMap/views/ListView",["UWA/Core","UWA/Class/View","UWA/Class","DS/Windows/Panel","DS/Windows/ImmersiveFrame","DS/WAFData/WAFData","DS/SNNavigationMap/MapSettings","DS/WebappsUtils/WebappsUtils","DS/UIKIT/Spinner","UWA/Class/Model","UWA/Date","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_internal","DS/EditPropWidget/constants/EditPropConstants","DS/EditPropWidget/models/EditPropModel","DS/EditPropWidget/EditPropWidget"],function(e,t,i,n,s,o,a,r,l,d,c,h,u,g,p){"use strict";return t.extend({name:"list-view",isVisible:!1,isWebInWin:!1,panel:null,model:{},_immersiveFrame:null,_informationPanel:null,_widgetId:"",_listSpinner:null,className:function(){return this.getClassNames("-container multisel-off")},setup:function(t){this._widgetId=t.widgetId||null,this._parent(t),this.isWebInWin=t.isWebInWin,this._immersiveFrame=new s,this._immersiveFrame.inject(this.container),this.panel=new n({closeButtonFlag:!1,width:a.getListViewPanelWidth(),resizableFlag:!0,immersiveFrame:this._immersiveFrame,position:{my:"bottom right",at:"bottom right",offsetY:48},touchMode:!0,verticallyStretchableFlag:!0,floatableFlag:!1}),this.hideTitle();var i=this._immersiveFrame.getDockingElement(WUXDockAreaEnum.RightDockArea);i.dockingZoneSize=a.getListViewPanelWidth(),i.collapsibleFlag=!1,this._immersiveFrame.dockWindow(this.panel,WUXDockAreaEnum.RightDockArea),this.panel.addEventListener("stopResize",function(e){this.dispatchEvent("ENORIPE_ResizeListViewPanel",this.panel.elements.container.offsetWidth)}.bind(this)),this._listSpinner=(new l).inject(e.createElement("div",{styles:{"text-align":"center",position:"absolute",top:"-4px",width:"95%"}}).inject(this.panel.elements.container)).show(),this.container.addEventListener("dragenter",function(e){e.stopPropagation()}),this.hidePanel();try{this.isWebInWin&&a.getSecurityContext()}catch(e){console.log(e)}},setModel:function(e){Array.isArray(e)||(e=[e]),(!this.model||this.container.isHidden()||this.model.length!=e.length||this.model[0]!=e[0]||e[0].get("instances")&&e[0].get("instances").length>1)&&(this.model=e,null!=this._informationPanel?this._setInformationPanelObject(this.model):this._initInformationsPanel(this.model))},_initInformationsPanel:function(e){var t=this;e&&e.length>0||this.model;if(null===t._informationPanel){var i=t.getpropOptions(u);t._informationPanel=new p(i),t._setInformationPanelObject(e),t.isLoading(!1),require(["DS/ENORIPE_Relations/RelationsTabSettings"],function(e){t.facetRelationsModule=e;var i={isDraggable:!0,isProfilesVisible:!1,appID:"ENORIPE_AP",publicationsMode:a.getPublicationsMode()};e.isAvailable(t._informationPanel.model,i).then(function(e){"object"==typeof e&&e.facetInfo?(e.facetInfo.options={defaultProfile:a.getValuesInPref("LastUsedProfile")},e.facetInfo.position=3,e.facetInfo.supportMerge=!0,t.relationsFacetInfos=e.facetInfo,t._informationPanel.addFacets([e.facetInfo]),require(["DS/PlatformAPI/PlatformAPI"],function(e){t.platformAPI=e;var i=t.facetRelationsModule.getLocalKey()+"/addInGraph";e.subscribe(i,function(e){if(e.models){var i=[];e.models.forEach(function(e){i.push(e.id)});var n=t.model.map(function(e){return e.id});t.dispatchEvent("ENORIPE_extractNode",{sourceIds:n,ids:i,sidePanelwidgetId:e.widgetSessionId})}});i=t.facetRelationsModule.getLocalKey()+"/downloadDocument",e.subscribe(i,function(e){e.modelId&&e.modelName&&t.dispatchEvent("ENORIPE_DownloadDocument",[e.modelId,e.modelName])})})):t.log("facets info is NOT in good format")},function(){t.log("this facet is not available for this context = "+e)})},function(e){console.warn("Cannot load "+e.requireModules)})}},_setInformationPanelObject:function(e){var t=this,i=[];e=Array.isArray(e)?e:[e],null!==t._informationPanel&&(e.forEach(function(e){if(e)if(e.get("selectedInstance")){e.get("selectedInstance").forEach(function(e){i.push(t.getPropModel(e,!0))})}else i.push(t.getPropModel(e.id,!1))}),i&&t._informationPanel.initDatas(i),t.panel.content=t._informationPanel,this.showPanel(),this.relationsFacetInfos&&this._informationPanel.addFacets([this.relationsFacetInfos]))},updateAttributes:function(){if(this.isVisible){var e=this.facetRelationsModule.getLocalKey()+"/updateAttributes",t={attrs:a.getDefaultAttributes()};this.platformAPI.publish(e,t)}},updateProfileRelations:function(e){this.facetRelationsModule&&this.facetRelationsModule.setProfile(e)},updatePublicationsMode:function(e){this.facetRelationsModule&&this.facetRelationsModule.updatePublicationsMode(e)},getWidth:function(){var e=0;return this.isVisible&&(e=400),e},getpropOptions:function(e){var t=[e.FACET_PROPERTIES,e.FACET_INSTANCE,e.FACET_VIEWS,e.FACET_EFFECTIVITY,e.FACET_CHANGE,e.FACET_SWYMCOMMENTS,e.FACET_SHARING,e.FACET_PC_CONTENT];this.isWebInWin||t.push(e.FACET_REVISIONS);var i={typeOfDisplay:e.ALL,selectionType:e.NO_SELECTION,facets:t,readOnly:!0,extraNotif:!0,multiselection:!1,setCloseButton:!0,actions:[{name:"action_close_panel",text:h.get("close"),icon:"close",handler:function(){this.dispatchEvent("ENORIPE_CloseListView")}.bind(this)}]};try{var n=a.getXPrefCredential();n&&(n=n.replace("ctx::",""),i.context={getSecurityContext:function(){return{SecurityContext:n}}})}catch(e){console.log("error in getting security context"+e)}return i},getPropModel:function(t,i){if(!e.is(t))return null;var n=i?"relationship":"businessobject";return widget.setValue("x3dPlatformId",a.getPlatformId()),new g({metatype:n,objectId:t,source:"3DSpace",tenant:a.getPlatformId()||"OnPremise"})},hidePanel:function(){this.container.hide(),this.isVisible=!1,this._informationPanel&&this._informationPanel.initDatas([])},showPanel:function(){this.container.show(),this.isVisible=!0},hideTitle:function(){this.panel.elements._titleBarDiv.hide()},showTitle:function(){this.panel.elements._titleBarDiv.show()},isLoading:function(e){e?this._listSpinner.show():this._listSpinner.hide()},clearPanel:function(){this.panel.title="",this.model=null},destroy:function(){this.clearPanel(),this._parent(),this.container=null}})}),define("DS/SNNavigationMap/views/NavigationApp",["UWA/Core","UWA/Class","UWA/Class/View","UWA/Class/Model","DS/UIKIT/Spinner","DS/Notifications/NotificationsManagerUXMessages","DS/Notifications/NotificationsManagerViewOnScreen","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_internal","DS/SNNavigationMap/views/SplittedDropView","DS/UIKIT/Native/Dropdown","DS/SNNavigationMap/utils/SNNavigationServices","DS/SNNavigationMap/views/SNMapSelector","DS/SNNavigationMap/models/CountOnNode","DS/PlatformAPI/PlatformAPI","DS/UIKIT/Alert","DS/UIKIT/Mask","DS/UIKIT/SuperModal","DS/UIKIT/Modal","DS/UIKIT/Form","DS/UIKIT/Input/Button","DS/SNNavigationMap/MapSettings","DS/SNNavigationMap/utils/ProbesUtils","DS/SNNavigationMap/views/D3MapView","DS/SNNavigationMap/views/DataGridView","DS/SNNavigationMap/views/ListView","DS/SNNavigationMap/views/ToolBarView","DS/SNNavigationMap/views/NavigationPager","DS/SNNavigationMap/utils/TaggerServices","DS/SNNavigationMap/utils/CommonUtils","DS/SNNavigationMap/utils/RelationsServices","DS/SNNavigationMap/views/popups/ExpandNLevel","DS/FedDictionaryAccess/FedDictionaryAccessAPI","DS/TransientWidget/TransientWidget","DS/WebappsUtils/WebappsUtils","css!DS/SNNavigationMap/SNNavigationMap"],function(e,t,i,n,s,o,a,r,l,d,c,h,u,g,p,m,f,v,_,N,S,b,w,E,I,C,y,M,D,P,x,O,T,A){"use strict";return i.extend({name:"navigation-app-view",rootModel:null,_isFiltered:!1,_isSearched:!1,_currentlyFilteredNodes:[],_currentlySearchedNodes:[],_lastFilterData:{},_isEmpty:!0,_isWebInWin:c.isWebInWin(),_theContextualMenu:null,_theContextualMenuTarget:{},_infoPanelCommandClick:!1,_isPreviewPanelOpen:!1,_appliedTags:0,_currentLayout:"linearGraph",_currentView:null,className:function(){return this.getClassNames("-container")},setup:function(t){this._autoNavMode=t.autoNavMode,this._layoutUtils=t.layoutUtils,this._countLimit=t.countLimit,this._lang=t.lang,this._isEmpty=t.isEmpty,this._widgetId=t.widgetId,this._widget=t.widget,this._platformId=t.platformId,this._lastRootID=t.lastRootID,this._debug=t.debugMode||!1,this._errorOnParseCompassData=t.errorOnParseCompassData||!1,this._addinMode=t.addinMode,this._separator=t.separator,this._nameLabel=t.nameLabel,this._detailLabel1=t.detailLabel1,this._detailLabel2=t.detailLabel2,this.collection=t.collection?t.collection:null,this._PM=t.promiseManager,this._preSelectedObjectIds=t.preSelectedObjectIds,this._inAppOptions=t.inAppOptions,S.getLayoutType()&&(this._currentLayout=S.getLayoutType(),b.trackUsage("InitLayoutType","LayoutType-"+this._currentLayout)),"catiav5"!==this._addinMode&&"solidworks"!==this._addinMode||this.container.addClassName("addin-mode-ripe"),this._errorOnParseCompassData&&(this._showNotif({level:"error",msg:r.get("ErrorCompassData")}),this._errorOnParseCompassData=!1),this._spinner=(new s).inject(e.createElement("div",{styles:{position:"absolute"}}).inject(this.container,"top")),this.showSpinner(),this._notifManager=o,a.setNotificationManager(this._notifManager),this._errorOnParseCompassData&&this._showNotif({level:"error",msg:r.get("ErrorCompassData")}),this._updateNLSForSavedAttrs(),this._initCollection(this.collection),this._initialize()},_initialize:function(){var t=this;this.setContainerEvents(),this._dropInvite=e.createElement("div",{class:"drop-invite",html:[{tag:"span",class:"wux-ui-3ds wux-ui-3ds-5x wux-ui-3ds-drag-drop"},{tag:"h5",class:"font-3dsregular",html:r.get("dropHere")}]}).inject(this.container).hide(),this._dropZone=(new l).inject(this.container),this.listenTo(this._dropZone,"ENORIPE_drop",this._handleDrop),this.listenTo(this._dropZone,"ENORIPE_dropNotSupported",function(){t._showNotif({level:"error",msg:r.get("dropNotSupported")})}),this.listenTo(this._dropZone,"ENORIPE_SDV_hide",this.setContainerEvents),window.addEventListener("keyup",this._onKeyUp.bind(this)),this._isEmpty?this._initEmptyMap():this._initSubViews(),this._initTagger()},_initCollection:function(e){e&&e!=this.collection&&(this.collection=e,this.listenTo(this.collection,"onSync",this.render.bind(this)))},_initSubViews:function(){this.showSpinner();var e=this.collection.getFocusedNode(),t=this;if(this.mapView||(this.mapView=new w({layoutUtils:this._layoutUtils,layoutAxis:this._layoutAxis,layoutDirection:this._layoutDirection,countLimit:this._countLimit,nameLabel:this._nameLabel,separator:this._separator,selector:h,dropZone:this._dropZone,spinner:this._spinner}),this.mapView.setSVGDimensions(this.ctnHeight,this.ctnWidth),this.listenTo(this.mapView,"onNodeClicked",this.nodeClicked),this.listenTo(this.mapView,"onNodeRightClicked",this._OnRightClick),this.listenTo(this.mapView,"ENORIPE_splitCount",this.splitCount),this.listenTo(this.mapView,"ENORIPE_Collapse",this.collapseNode),this.listenTo(this.mapView,"ENORIPE_dragEnd",this._hideDropZones),this.listenTo(this.mapView,"ENORIPE_showNotif",this._showNotif),this.listenTo(this.mapView,"ENORIPE_MultiSel_Object",function(e){this._manageSelection(!0,e)}.bind(this)),this.listenTo(this.mapView,"ENORIPE_ReorderColumn",this._reorderColumn),this.listenTo(this.mapView,"ENORIPE_downloadDocument",this._handleDownload),this.listenTo(this.mapView,"ENORIPE_clearSelection",this.clearSelection),this.listenTo(this.mapView,"ENORIPE_Drop",this._handleDrop),this.listenTo(this.mapView,"ENORIPE_clickListInstance",this._clickListInstance),this.listenTo(this.mapView,"ENORIPE_clickMoreInstance",this._clickMoreInstance),this.listenTo(this.mapView,"ENORIPE_toggleInstance",this.toggleInstance),this.listenTo(this.mapView,"ENORIPE_dragElement",this.dragElement),this.listenTo(this.mapView,"ENORIPE_ShowPreview",this._showPreview),this.listenTo(this.mapView,"ENORIPE_HandlePathPanel",function(e){if(e){var i=t.collection.get(e);i&&("ENOStrRefinementSpecification"===i.get("type")&&this.collection.filter(function(e){"link"===e.get("modelType")&&(e.get("source").id===i.get("id")?i._attributes.linked=t.collection.get(e.get("target").id):e.get("target").id===i.get("id")&&(i._attributes.linked=t.collection.get(e.get("source").id)))}),t.pathPanel.addNodes(i))}}),this.listenTo(this.mapView,"removefocus",function(e){if(e){var i=t.collection.get(e);i&&i.set("focus",!1)}}),this.listenTo(this.mapView,"ENORIPE_FetchAttrInfo",this.updateMapViewAttributes.bind(this)),this.listenTo(this.mapView,"ENORIPE_GetNlsAttrInfo",this.updateMapViewAttributesNls.bind(this)),this.listenTo(this.mapView,"ENORIPE_UpdateD3Map",this._updateCollection),this.mapView.inject(this.container),this._currentView=this.mapView),this.dataGridView?this.dataGridView.clear():(this.dataGridView=new E({promiseManager:this._PM,isWebInWin:this._isWebInWin,collection:this.collection,tenantName:S.getCurrentTenantName()||"OnPremise"},this.collection),this.dataGridView.inject(this.container),this.dataGridView.hide(),this.listenTo(this.dataGridView,"handleServerErrorMsgs",this.handleServerErrorMsgs),this.listenTo(this.dataGridView,"ENORIPE_CollapseNode",this.collapseNodeOnDatagrid),this.listenTo(this.dataGridView,"ENORIPE_ExpandNode",this.splitCount),this.listenTo(this.dataGridView,"ENORIPE_DownloadDocument",this._handleDownload),this.listenTo(this.dataGridView,"ENORIPE_SetNavigatedNode",function(e){this.dispatchEvent("ENORIPE_SetNavigatedNode",[e])}.bind(this)),this.listenTo(this.dataGridView,"onRowRightClicked",this._OnRightClick),this.listenTo(this.dataGridView,"ENORIPE_onRowClicked",function(e){e.nodeId&&e.action&&(S.getInstancesMode()&&e.instanceId?this.toggleInstance(e):this._manageSelection(e.isMultisel,{models:e.nodeId,sAction:e.action,origin:"DataGridView"}))}.bind(this)),this.listenTo(this.dataGridView,"ENORIPE_dragElement",this.dragElement),this.listenTo(this.dataGridView,"ENORIPE_HideOneDirection",function(e){this.hideOneDirection(e)}.bind(this)),this.listenTo(this.dataGridView,"ENORIPE_ShowOneDirection",function(e){this.dispatchEvent("ENORIPE_ShowOneDirection",[e,!0])}.bind(this)),this.listenTo(this.dataGridView,"ExpandOneDirection",function(e){this.dispatchEvent("ExpandOneDirection",e)}.bind(this)),this.listenTo(this.dataGridView,"ENORIPE_UpdateCollectionWithView",this._updateCollectionWithView)),!this.listView){this.listView=new I({model:e,widgetId:this._widgetId,isWebInWin:this._isWebInWin}),this.listenTo(this.listView,"ENORIPE_handleErrorMsgs",this.handleServerErrorMsgs),this.listenTo(this.listView,"ENORIPE_CloseListView",this.toggleInformationsPanel),this.listenTo(this.listView,"ENORIPE_ResizeListViewPanel",function(e){this.dispatchEvent("ENORIPE_ResizeListViewPanel",e)}.bind(this)),t.listenTo(t.listView,"ENORIPE_extractNode",function(e){t.showSpinner();var i=[...e.ids,...e.sourceIds];this.collection.getEcoSystem({ids:i,restrictedMode:!0})}),t.listenTo(t.listView,"ENORIPE_DownloadDocument",this._handleDownload);let i=this.container.parentElement||this.container;this.listView.inject(i)}this._toolBarView?this._toolBarView.showAllToolbar():this.setUpToolBar(C);try{S.getOption("inAppMode")&&this._setupInAppView()}catch(e){console.log("inAppsError--"+e)}S.getInformationPanelVisibility()!=this.listView.isVisible&&this.toggleInformationsPanel(),this.expandNLevelView||(this.expandNLevelView=new x({widgetId:this._widgetId}),this.listenTo(this.expandNLevelView,"ENORIPE_fullImport",function(e){e&&e.sessionId&&this.collection.fullImport(e.sessionId)}.bind(this)));var i={ctx:this,collection:this.collection,platformId:this._platformId,widgetId:this._widgetId};h.initialize(i),!0===this._setFirstFocusOnCompass&&(this._setFirstFocusOnCompass=!1),!this._isEmpty&&this._dropInvite&&this._dropInvite.hide(),this._isEmpty||this.dispatchEvent("ENORIPE_HideHomePage")},_setupInAppView:function(){var t=this;if(!this._inAppView){var i,n,s,o=e.createElement("div",{class:"enoripe-inAppContainer"}).inject(this.container),a=new N({value:r.get("inAppOK"),className:"primary enoripe-inAppOK"}).inject(o),l=new N({value:r.get("inAppCancel"),className:"default enoripe-inAppCancel"}).inject(o);this._inAppOptions&&this._inAppOptions.localUID&&(i="ENORIPE-InApp-"+this._inAppOptions.localUID,n=i+"/onOK",s=i+"/onCancel"),a.addEvent("onClick",function(){var e=[];t.collection.where({modelType:"node",focus:!0}).forEach(function(t){e.push({id:t.id})}),t._inAppOptions&&t._inAppOptions.localUID&&g.publish(n,e),T.closeWidget()}),l.addEvent("onClick",function(){t._inAppOptions&&t._inAppOptions.localUID&&g.publish(s),T.closeWidget()}),this._inAppView={container:o,okBtn:a,cancelBtn:l}}},render:function(e,t,i){var n=e.getLinksAndNodes(!1),s=i?JSON.parse(i.data):"";t=t?JSON.parse(t):null;if(this._isSearched)if(this._continueSearch){var o=this._searchValue;o&&this.dispatchEvent("ENORIPE_Search",o),this._continueSearch=!1}else this.clearFilterBySearch();if(0!==n.nodes.length){if(this._lastRootID&&0!==this._lastRootID.length||this._initLastRootWithColumnId(),"dataGridView"==this._currentLayout)this._updateDatagridView(e),this._currentView=this.dataGridView;else if(this.mapView){let t=!1;this.mapView.isInitWithNodes()||(t=!0),this.mapView.render(n,e.groupBy("columnID")),this._currentView=this.mapView,t&&this._manageFocus()}return b.getStartTime("init")&&b.trackPerformance("init","init",{LayoutType:S.getLayoutType()}),b.getStartTime("relationsChange")&&b.trackPerformance("relationsChange","relationsChange",{NumberOfObjects:this.collection.getLinksAndNodes().nodes.length}),this.dispatchEvent("ENORIPE_SetNavigatedNode",[this.collection.getLinksAndNodes().nodes]),this._updateCountModel().then(function(){this._updateCountView()}.bind(this)),this.listView&&(this._infoPanelCommandClick&&this.manageProperties(),s.id&&this.mapView.removeLoadingClass(s.id)),this._isWebInWin&&(this.collection._isBusy()||c.sendStringRelationsToWebInWin("ENORIPE_ViewReady","done")),this._afterRender(),this.updateFilterProxy(),void 0!==this._preSelectedObjectIds&&Array.isArray(this._preSelectedObjectIds)&&this._preSelectedObjectIds.length>0&&(this.clearSelection(),this._selectInGraph(this._preSelectedObjectIds),this._preSelectedObjectIds=[]),S.getOption("inAppMode")&&(this._inAppOptions&&void 0!==this._inAppOptions.preSelectedObjectIds&&(this.clearSelection(),this._selectInGraph(this._inAppOptions.preSelectedObjectIds)),this._checkInAppOkBtn()),this}this.dispatchEvent("ENORIPE_ClearMap")},renderAfterRemove:function(e){var t=e.getLinksAndNodes(!1);if(this._lastRootID&&0!==this._lastRootID.length||this._initLastRootWithColumnId(),this._currentView.removeSelectedNodes(t,e.groupBy("columnID")),this.mapView){let e=!1;this.mapView.isInitWithNodes()||(e=!0),e&&this._manageFocus()}return this._updateCountModel().then(function(){this._updateCountView()}.bind(this)),this.updateFilterProxy(),this.hideSpinner(),this},setUpToolBar:function(e){var t=this;this.profileArray=[],this.dispatchEvent("ENORIPE_ProfileInfo");var i=[];this._inAppOptions&&void 0!==this._inAppOptions.excludedToolBarCommands&&(i=this._inAppOptions.excludedToolBarCommands);let n=this.container.parentElement||this.container;if(this._toolBarView=new e({renderTo:n,lang:this._lang,addinMode:this._addinMode,isWebInWin:this._isWebInWin,excludedCommands:i}),this._toolBarView.render(),this._favTitle){var s=document.querySelector(".Enoripe-FavoriteText");s&&s.setContent(this._favTitle)}this.listenTo(this._toolBarView,"ENORIPE_selectAllFromCommand",this.selectAllFromCmd),this.listenTo(this._toolBarView,"ENORIPE_selectOutFilteredFromCommand",this.selectOutFilteredFromComd),this.listenTo(this._toolBarView,"ENORIPE_selectInverseFromCommand",this.inverseSelectionFromCmd),this.listenTo(this._toolBarView,"ENORIPE_clearSelectionFromCommand",this.clearSelection),this.listenTo(this._toolBarView,"ENORIPE_CustomizeCommandClick",this.customize),this.listenTo(this._toolBarView,"ENORIPE_CustomizeDisplay",this.toggleNodeThumbnail),this.listenTo(this._toolBarView,"ENORIPE_RecomputeLayout",this.toggleRecompute),this.listenTo(this._toolBarView,"ENORIPE_ShowInstances",this.toggleListInstances),this.listenTo(this._toolBarView,"ENORIPE_ShowPublications",this.togglePublications),this.listenTo(this._toolBarView,"ENORIPE_ShowGhost",this.toggleGhost),this.listenTo(this._toolBarView,"ENORIPE_CustomizeAttributes",this.customizeAttribute),this.listenTo(this._toolBarView,"ENORIPE_InfoCommandClick",this.toggleInformationsPanel),this.listenTo(this._toolBarView,"ENORIPE_PrintCommandClick",this.printMap),this.listenTo(this._toolBarView,"ENORIPE_ComputePathCommandClick",function(){t.pathPanel&&!t.pathPanel.container.isHidden()||t.computePaths()}),this.listenTo(this._toolBarView,"ENORIPE_FitAllCommandClick",this.fitAllInMap),this.listenTo(this._toolBarView,"ENORIPE_ClearMapCommandClick",this.clearMapClick),this.listenTo(this._toolBarView,"ENORIPE_RefreshMapCommandClick",this.refreshMapCmd),this.listenTo(this._toolBarView,"ENORIPE_OpenCommandClick",this.openCAD),this.listenTo(this._toolBarView,"ENORIPE_HideCommand",this.hideNodes),this.listenTo(this._toolBarView,"ENORIPE_ExcludeCommand",this.excludeNodes),this.listenTo(this._toolBarView,"ENORIPE_Expand_Command",this.expandSelectedNodes),this.listenTo(this._toolBarView,"ENORIPE_Collapse_Command",this.collapseSelectedNodes),this.listenTo(this._toolBarView,"ENORIPE_EditLayoutCommandClick",this.editLayout),this.listenTo(this._toolBarView,"ENORIPE_ExpandNLevel",this.expandNLevel.bind(this)),this.listenTo(this._toolBarView,"ENORIPE_HomeCommandClick",function(){this.collection&&this.collection.getNodesIds().length>0?this.dispatchEvent("ENORIPE_ShowSaveInFavoritesModal"):this.dispatchEvent("ENORIPE_ShowHomePage")}.bind(this)),this.listenTo(this._toolBarView,"ENORIPE_FavoriteCommandClick",this.handleFavorite.bind(this)),this.listenTo(this._toolBarView,"ENORIPE_SelectionAssistantFromCommand",this.selectionAssistant.bind(this)),this.listenTo(this._toolBarView,"ENORIPE_SwitchLayout",function(e){this.switchLayout(e)}),this._isWebInWin&&(this.listenTo(this._toolBarView,"ENORIPE_performSearch_native",function(e){this.dispatchEvent("ENORIPE_performSearch_native",e)}),this.listenTo(this._toolBarView,"ENORIPE_resetSearch_native",function(){this.clearFilterBySearch()}))},_initEmptyMap:function(e){"maximized"!==this._widgetStateAtInit||e||this._errorOnParseCompassData||this._showNotif({level:"error",msg:r.get("emptyMap")}),this._errorOnParseCompassData=!1,this.hideSpinner(),this._isEmpty&&this._dropInvite&&this._dropInvite.show()},_updateContainerDimensions:function(){var t=this.container.parentElement;if(t){var i=(t=t.getDimensions?t:e.extendElement(t)).getDimensions();this.ctnWidth=i.width,this.ctnHeight=this._isWebInWin?window.innerHeight:i.height,this.container.setStyle("height",this.ctnHeight)}},_updateDropZonesHeight:function(){var e=this.listView?this.container.getDimensions().width-this.listView.getWidth():this.container.getDimensions().width;this._dropZone&&this._dropZone.updateHeight(this.ctnHeight,e)},_updateSVGContainer:function(){this.mapView&&this.mapView.setSVGDimensions(this.ctnHeight,this.ctnWidth)},_reorderColumn:function(e,t,i){var n=this.collection.groupBy("columnID")[e.columnID];n.sort(function(e,t){return e._attributes.rowID>t._attributes.rowID?1:t._attributes.rowID>e._attributes.rowID?-1:0}),n.splice(i,0,n.splice(e.rowID,1)[0]);for(var s=0;s<n.length;s++)n[s].set("rowID",s);this.mapView.render(this.collection.getLinksAndNodes(),this.collection.groupBy("columnID"))},_afterRender:function(){this._pathSelReq&&(this._pathSelReq=!1,this._selectInGraph(this._pathSelReqNodes))},_checkInAppOkBtn:function(){if(this.collection){var e=this.collection.where({modelType:"node",focus:!0}).length;this._inAppView&&(e>0?this._inAppView.okBtn.enable():this._inAppView.okBtn.disable())}},_updateCollection:function(){var e=this,t=null,i=null;this.collection.filter(function(n){(t=e.mapView.getElement("#container-"+n.id+" .instance-list-g"))&&"node"===n.get("modelType")&&n.get("instances")&&n.get("instances").length>0&&(i=t.getElements(".instance-text"),t.classList.contains("expand")?n.set("instancesExpanded",i.length):n.get("instancesExpanded")>S.getOption("showInstancesLimit")?n.set("instancesExpanded",-1):n.set("instancesExpanded",0))})},_hideDropZones:function(){this._dropZone&&this._dropZone.hide()},_updateCountModel:function(){var e=[],i=[],n={},s=[],o=[];return new t.Promise(function(t,a){(e=this.collection.where({modelType:"node"})).forEach(function(e){e.get("counts")?e.get("counts").get("requestDone")||i.push(e.id):e.set("counts",new u({source:e.id}))}.bind(this)),i.length>0?P.getRelationsCount({ids:i}).then(function(a){s=JSON.parse(a).counts,i.forEach(function(e){(n=this.collection.get(e).get("counts")).set("requestDone",!0),(o=s.filter(function(t){return t.source===e})).length>0&&n.parse(o)}.bind(this)),e.forEach(function(e){e.get("counts").resetRealCount(this.collection)}.bind(this)),t()}.bind(this)):(e.forEach(function(e){e.get("counts").resetRealCount(this.collection)}.bind(this)),t())}.bind(this))},_updateCountView:function(){this._currentView.updateCount(this.collection)},_clickListInstance:function(e){var t=this.collection.get(e),i=this.mapView.getElement("#container-"+e+" .instance-list-g"),n=[];if(i){if(t.get("instancesExpanded")>0){t.get("instancesExpanded")>S.getOption("showInstancesLimit")?t.set("instancesExpanded",-1):t.set("instancesExpanded",0);for(var s=i.getElements(".instance-text"),o=0;o<s.length;o++){var a=s[o].id.replace("instance-","");n.push(a),this._currentlyFilteredNodes&&this._currentlyFilteredNodes.indexOf(a)>-1&&this._currentlyFilteredNodes.splice(this._currentlyFilteredNodes.indexOf(a),1)}this.taggerServices.removeRoots(n)}else{s=i.getElements(".instance-text");if(t.set("instancesExpanded",s.length),this._currentlyFilteredNodes&&this._currentlyFilteredNodes.length>0)for(o=0;o<s.length;o++)this._currentlyFilteredNodes.indexOf(s[o].id.replace("instance-",""))<0&&this._currentlyFilteredNodes.push(s[o].id.replace("instance-",""))}this.mapView.updateConstraints(this.collection.getLinksAndNodes(),this.collection.groupBy("columnID")),this.updateFilterProxy()}},_clickMoreInstance:function(e,t){var i=this.collection.get(e);if(this.mapView.getElement("#container-"+e+" .instance-list-g")&&(i.set("instancesExpanded",t.length),this._currentlyFilteredNodes&&this._currentlyFilteredNodes.length>0))for(var n=0;n<t.length;n++)this._currentlyFilteredNodes.indexOf(t[n].id)<0&&this._currentlyFilteredNodes.push(t[n].id);this.mapView.updateConstraints(this.collection.getLinksAndNodes(),this.collection.groupBy("columnID")),this.updateFilterProxy()},toggleInstance:function(e){var t=this.collection.get(e.nodeId),i=[];if(null!=t.get("selectedInstance")&&(i=t.get("selectedInstance")),e.selected?(null!=i?i.push(e.instanceId):i=[e.instanceId],t.set("selectedInstance",i)):i.length>1&&e.instanceId&&i.indexOf(e.instanceId)?(i.splice(i.indexOf(e.instanceId),1),t.set("selectedInstance",i)):t.set("selectedInstance",null),null!=e.selected){var n=e.selected?"add":"remove";this._manageSelection(!0,{models:e.nodeId,sAction:n,instanceId:e.instanceId}),this.manageProperties()}},toggleListInstances:function(e){this.collection.filter(function(t){if("node"===t.get("modelType")&&t.get("instances")&&t.get("instances").length>0)if(e){var i=Math.min(t.get("instances").length,S.getOption("showInstancesLimit"));-1==t.get("instancesExpanded")&&(i=t.get("instances").length),t.set("instancesExpanded",i)}else t.set("selectedInstance",null),t.get("instancesExpanded")>0&&(t.get("instancesExpanded")>S.getOption("showInstancesLimit")?t.set("instancesExpanded",-1):t.set("instancesExpanded",0))}),this._currentView.toggleAllInstances(this.collection,e),this.updateFilterProxy(),this.listView&&this._infoPanelCommandClick&&this.manageProperties(),this.dispatchEvent("ENORIPE_UpdatePrefInstances",e)},selectionAssistant:function(){var e=this,t=this.collection.where({modelType:"node",focus:!0}),i=!0;t&&t.length>1&&(i=!1),this._SARenderOption||(this._SARenderOption={selOptions:{SDP:!1,SAP:!1,SDS:!1,SAS:!1,CommonResults:!1},disableCommon:i}),this.addLoader(),this._selectionAssistant?(this._SARenderOption.disableCommon=i,i&&(this._SARenderOption.selOptions.CommonResults=!1),this._selectionAssistant.render(this._SARenderOption),this.removeLoader()):require(["DS/SNNavigationMap/views/SelectionAssistantView"],function(t){e._selectionAssistant=new t,e._selectionAssistant.inject(e.container.parentElement),e._selectionAssistant.render(e._SARenderOption),e.removeLoader(),e.listenTo(e._selectionAssistant,"ENORIPE_UpdateSelection",function(t){e._SARenderOption=t,e.handleSelections(t)})})},handleSelections:function(e){var t=e.selOptions,i=h.getSelected();if(t.CommonResults){var n,s=0;Object.values(t).forEach(function(e){e&&s++}),void 0!==(n=s>2?this._handleCommonSelForMultiCriteria(t,i):this._handleCommonSelections(t,i))&&n&&n.showNotif&&this._showNotif({level:"info",lvl:"primary",msg:r.get("SA-NoNewSelection")})}else for(var o in t)if(t[o])switch(o){case"SDP":this._handleSDP(i);break;case"SAP":this._handleSAP(i);break;case"SDS":this._handleSDS(i);break;case"SAS":this._handleSAS(i)}},_handleCommonSelForMultiCriteria:function(e,t){var i=!1,n=[],s=[];e.SAP?t.forEach(function(e){n[e.id]||(n[e.id]=[]);var t=h.getAllPredecessors([e]);t&&(n[e.id]=[...n[e.id],...t])}):e.SDP&&t.forEach(function(e){n[e.id]||(n[e.id]=[]);var t=h.getPredecessors([e]);t&&(n[e.id]=[...n[e.id],...t])}),e.SAS?t.forEach(function(e){n[e.id]||(n[e.id]=[]);var t=h.getAllSuccessors([e]);t&&(n[e.id]=[...n[e.id],...t])}):e.SDS&&t.forEach(function(e){n[e.id]||(n[e.id]=[]);var t=h.getSuccessors([e]);t&&(n[e.id]=[...n[e.id],...t])});s=n[Object.keys(n)[0]];for(var o=1;o<Object.keys(n).length;o++)s=h._getCommon(s,n[Object.keys(n)[o]]);s.length>0?this._manageSelection(!0,{models:s,sAction:"add"}):i=!0,i&&this._showNotif({level:"info",lvl:"primary",msg:r.get("SA-NoNewSelection")})},_handleCommonSelections:function(e,t){if(t.length<2)return{showNotif:!0};var i,n=!1;e.SDP?i=h.getCommonDirectPredecessors(t):e.SAP?i=h.getCommonAllPredecessors(t):e.SDS?i=h.getCommonDirectSuccessors(t):e.SAS&&(i=h.getCommonAllSuccessors(t)),i&&i.length>0&&(i=this._processSelection(i)).length?this._manageSelection(!0,{models:i,sAction:"add"}):n=!0,n&&this._showNotif({level:"info",lvl:"primary",msg:r.get("SA-NoNewSelection")})},_handleSDP:function(e){var t=h.getPredecessors(e),i=!1;t&&(t=this._processSelection(t)).length?this._manageSelection(!0,{models:t,sAction:"add"}):i=!0,i&&this._showNotif({level:"info",lvl:"primary",msg:r.get("SA-NoNewSelection")})},_handleSAP:function(e){var t=h.getAllPredecessors(e),i=!1;t&&(t=this._processSelection(t)).length?this._manageSelection(!0,{models:t,sAction:"add"}):i=!0,i&&this._showNotif({level:"info",lvl:"primary",msg:r.get("SA-NoNewSelection")})},_handleSDS:function(e){var t=h.getSuccessors(e),i=!1;t&&(t=this._processSelection(t)).length?this._manageSelection(!0,{models:t,sAction:"add"}):i=!0,i&&this._showNotif({level:"info",lvl:"primary",msg:r.get("SA-NoNewSelection")})},_handleSAS:function(e){var t=h.getAllSuccessors(e),i=!1;t&&(t=this._processSelection(t)).length?this._manageSelection(!0,{models:t,sAction:"add"}):i=!0,i&&this._showNotif({level:"info",lvl:"primary",msg:r.get("SA-NoNewSelection")})},openCAD:function(){g.publish("webinwin:web:notification",JSON.stringify({operation:"open/setTypes",operationVersion:"1.0",content:h.buildSelectionForNativeApps()}))},_handleDownload:function(e,t){var i=this;this.fileUtils?this.fileUtils.handleDownload(e,t):require(["DS/SNNavigationMap/utils/MapFileUtils"],function(n){i.fileUtils=new n({spinner:i._spinner,notifManager:i._notifManager}),i.fileUtils.handleDownload(e,t)})},_renderCustomizeAttribute:function(e){var t=this,i={defaults:S.getDefaultAttributes(),selectedIndex:0,types:e};this.addLoader(),this._customizeAttribute?(this._customizeAttribute.render(i),this.removeLoader()):require(["DS/SNNavigationMap/views/CustomizeAttribute"],function(e){t._customizeAttribute=new e({iswebinwin:t._isWebInWin}),t._customizeAttribute.inject(t.container.parentElement),t._customizeAttribute.render(i),t.removeLoader(),t.listenTo(t._customizeAttribute,"ENORIPE_addLoader",function(){t.addLoader()}),t.listenTo(t._customizeAttribute,"ENORIPE_removeLoader",function(){t.removeLoader()}),t.listenTo(t._customizeAttribute,"ENORIPE_UpdateAttributes",function(e){var t,i;if(e=this._checkDefaults(e),t=this._isDiffFromDefault(e),i=this._attributesOrderChange(e),t||i){var n=[];if(S.setDefaultAttributes(e),this.listView.updateAttributes(),this.dataGridView&&"dataGridView"===S.getLayoutType())this.dataGridView.updateColumns(e.EnoripeColumns.attributes);else{this.collection.filter(function(e){if("node"===e.get("modelType")){var t=e.get("id");-1===n.indexOf(t)&&n.push(t)}});for(var s=0;s<n.length;s++)this.updateMapViewAttributesNls(n[s])}this.saveDefaultsInStorage(e),t&&this.dispatchEvent("ENORIPE_UpdateAttributes"),this._showNotif({level:"info",lvl:"primary",msg:r.get("AttributesSavedSuccess")})}})})},customizeAttribute:function(){var e=this,t=[],i=[{name:"AllTypes",nlsLabel:r.get("AllTypes")}];this.collection.filter(function(e){if("node"===e.get("modelType")){var i=e.get("type");null!=i&&""!==i&&-1===t.indexOf(i)&&t.push(i);var n=e.get("instances");if(void 0!==n)for(var s=0;s<n.length;s++){var o=n[s].type;null!=o&&""!==o&&-1===t.indexOf(o)&&t.push(o)}}}),this._getTypesNls(t).then(function(t){for(var n in t)t.hasOwnProperty(n)&&i.push({name:n,nlsLabel:t[n]});e._renderCustomizeAttribute(i)})},toggleInformationsPanel:function(){this._toolBarView.getCommand("Info_Command").hasClassName("pressed")===this._infoPanelCommandClick&&this._toolBarView.toggleInfoCommand(),this._infoPanelCommandClick?(this.listView.hidePanel(),this._infoPanelCommandClick=!1):(this._infoPanelCommandClick=!0,this.manageProperties()),this.dispatchEvent("ENORIPE_ToggleInformationPanel",this._infoPanelCommandClick)},manageProperties:function(){var e=this.collection.where({focus:!0});e&&0!==e.length&&this._infoPanelCommandClick?this.listView.setModel(e):this.listView.hidePanel()},_initPreviewView:function(e,t){var i=this;require(["DS/SNNavigationMap/views/PreviewView"],function(n){i.previewView=new n({widgetId:i._widgetId,separator:i._separator,direction:t,collection:i.collection}),i.previewView.inject(i.container),i.previewView.render(),i.dispatchEvent("ENORIPE_ShowPreview",{modelId:e,direction:t}),i.listenTo(i.previewView,"ENORIPE_extractNode",function(e){i.showSpinner();var t=i.collection.parse(e);t.length>0?(t.forEach(function(e){i.collection.add(e)}),i.collection._prepareNodesAndLinks(i.collection),i.render(i.collection)):(i.dispatchEvent("ENORIPE_noObjectToAdded"),i.hideSpinner())}),i.listenTo(i.previewView,"PreviewHide",function(){i.taggerServices.activate(),i.updateFilterProxy(),i._isPreviewPanelOpen=!1,i.clearFilterBySearch()}),i.listenTo(i.previewView,"ContextualMenuPreviewGroup",function(e){e.targetId&&(i._theContextualMenuTarget.targetId=e.targetId,i._theContextualMenuTarget.targetElement=e.targetElement,i._theContextualMenuTarget.context="PreviewGroup")}),i.listenTo(i.previewView,"ENORIPE_DownloadDocument",i._handleDownload),i._isWebInWin&&(i.listenTo(i.previewView,"ENORIPE_performSearch_native",function(e){i.dispatchEvent("ENORIPE_performSearch_native",e)}),i.listenTo(i.previewView,"ENORIPE_resetSearch_native",function(){i.clearFilterBySearch()}))})},_showPreview:function(e){this.clearFilterBySearch();var t=e.direction?e.direction:"both";this._isPreviewPanelOpen=!0,this._currentView.endFilter(),this.previewView?(this.previewView.render(t),this.dispatchEvent("ENORIPE_ShowPreview",e)):this._initPreviewView(e.modelId,t),this.taggerServices.deactivate()},expandNLevel:function(){this.getSelectedIds().length<1?this._showNotif({level:"error",msg:r.get("ActionWithoutSelection")}):this.dispatchEvent("ENORIPE_initExpandNLevel",{selectedNodes:this.getSelectedIds(),expandNLevelView:this.expandNLevelView})},handleFavorite:function(e){var t=new f({className:"Enoripe-Modal",animate:!0});this._isFavOpen?this._favoriteSave(t,e):this._favoriteSaveAs(t,e)},_favoriteSave:function(t,i){var n=this,s=e.createElement("div",{class:"Favorite-OverwriteContainer"}),o=r.replace(r.get("Favorite-Overwrite"),{favName:this._favTitle});e.createElement("div",{html:o}).inject(s),e.createElement("div",{html:r.get("Favorite-Confirm")}).inject(s),t.dialog({body:s,title:r.get("SNNavigationMap.Favorite.Title"),maxlength:80,buttons:[{className:"primary",value:r.get("SNNCustomize_Save"),action:function(e){n.dispatchEvent("ENORIPE_updateFav",i),e.hide()}},{value:r.get("Favorite_SaveAs"),action:function(){n._favoriteSaveAs(t,i,!0)}},{value:r.get("SNNCustomize_Cancel"),action:function(e){e.hide()}}]})},_favoriteSaveAs:function(t,i,n){var s=this,o=null,a=null;S._getListOfSecurityContext().then(function(l){o=l,a=S.getOption("selectedSCForFav");for(var d=0;d<o.length;d++)if(a===o[d].value){o[d].selected=!0;break}var c={fields:[{type:"text",required:!0,pattern:"^[_ A-Za-z0-9]+$",value:"",placeholder:r.get("Favorite_SaveAsPlaceholder"),label:r.get("Favorite_SaveAsPlaceholder"),name:"inputval",maxlength:80},{type:"select",label:r.get("Favorite_SelectPlaceholder"),placeholder:r.get("Favorite_SelectPlaceholder"),name:"securitycontext",options:o}],events:{onSubmit:function(e){s.dispatchEvent("ENORIPE_createFavorite",[e,i]),t.modals.current.hide()},onInvalid:function(){var e="";e=0===u.value.trim().length?r.get("Favorite_EmptyErr"):(e=r.get("Customize_SpecialCharErr")).concat(" !@#$%^&*()+=[]\\';,./{}|\":<>?-"),g.setContent(e),g.getParent()||t.modals.current.elements.body&&t.modals.current.getBody().addContent(g)}}},h=new _(c),u=h.elements.container.getElement("input"),g=e.createElement("div",{class:"Customize-ProfileNameError",html:""});t.dialog({body:h,title:r.get("SNNavigationMap.Favorite.Title"),buttons:[{className:"primary",value:r.get("SNNCustomize_Save"),action:function(){h.submit()}},{value:r.get("SNNCustomize_Cancel"),action:function(e){e.hide()}}]}),n&&t.next(),u.addEventListener("click",function(e){this.focus()})})},_initDatagridView:function(e){var t=[],i=[],n=!e;this._manageFocus(),t=this.collection.where({modelType:"node",focus:!0,isCount:void 0}),this.mapView&&this.mapView.hide(),t&&(i=t.map(function(e){return e.id}),this.dispatchEvent("setLastRootNodeID",[i])),this.buildDatagrid(n),this._isFiltered&&this.updateFilterProxy()},buildDatagrid:function(e){var t,i,n=!e;t=S.getDefaultAttributes().EnoripeColumns.attributes,i=this.collection.where({modelType:"node",focus:!0}),this.dataGridView.buildSkeleton(i,this.collection,t,n),this.dataGridView.show(),this.hideSpinner(),n&&this._updateCollectionWithView()},_updateDatagridView:function(e){var t=[];this.dataGridView&&(this.dataGridView.getRootModels()&&0!==this.dataGridView.getRootModels().length?(this._lastRootID.forEach(function(i){this.dataGridView.getRootModelsIds().indexOf(i)<0&&e.get(i)&&t.push(e.get(i))}.bind(this)),t.length>0?this.dataGridView.setRootNodes(t):this.dataGridView.setData(!1),this.hideSpinner()):this._initDatagridView())},collapseNodeOnDatagrid:function(e,t,i){var n=[];t&&e&&(i.map(function(e){return e.id}),n=this.collection.filter(function(e){if(t.indexOf(e.id)>-1)return!0}),t.length>0&&(this.collection.getRemovedObject(n).removedObjectsId.forEach(function(e){this.collection.remove(e)}.bind(this)),this.dispatchEvent("ENORIPE_SetNavigatedNode",[i]),this.updateFilterProxy())),this.render(this.collection)},expandNodeOnDatagrid:function(e,t,i){var n={},s={};n={ids:e,countmanagement:!1},t&&(s={direction:t,excludedRelations:["v6_structure_roots_from"],trueREST:!0,publicationsMode:S.getPublicationsMode(),widgetId:"1"},i&&i.length>0?s.relations=i:S.getOption("LastUsedProfile")&&"AutoModeProfile"===S.getOption("LastUsedProfile")?s.relations=["use-auto-by-type-relations"]:s.relations=S.getOption("currentRelations"),n={...n,...s}),this.collection.getEcoSystem(n)},customize:function(){this.dispatchEvent("ENORIPE_Customize")},customizeDisplay:function(){this.dispatchEvent("ENORIPE_CustomizeDisplay")},updateProfile:function(e){this.listView&&this.listView.updateProfileRelations(e),this.dataGridView&&"dataGridView"===this._currentLayout&&this.dataGridView.setExpandDirection({upstream:!0,downstream:!0}),b.trackUsage("ProfileUsage",e)},computePaths:function(){var e=this.collection.where({focus:!0});this.pathPanel?this.pathPanel.render(e):this._initPathPanel()},managePathPanel:function(e){let t=this;if(e&&this.pathPanel&&!this.pathPanel.container.isHidden()){var i=this.collection.get(e);i&&("ENOStrRefinementSpecification"===i.get("type")&&this.collection.filter(function(e){"link"===e.get("modelType")&&(e.get("source").id===i.get("id")?i._attributes.linked=t.collection.get(e.get("target").id):e.get("target").id===i.get("id")&&(i._attributes.linked=t.collection.get(e.get("source").id)))}),this.pathPanel.addNodes(i))}},_initPathPanel:function(){var e=this;require(["DS/SNNavigationMap/views/PathPanelView"],function(t){e.pathPanel=new t({spinner:e._spinner,widgetId:e._widgetId,debugMode:e._debug,position:{offsetX:0,offsetY:24,dialogWidth:520,dialogHeight:600},addinMode:e._addinMode}),e.listenTo(e.pathPanel,"ENORIPE_dragEnd",e._hideDropZones),e.listenTo(e.pathPanel,"ENORIPE_handleErrorMsgs",e.handleServerErrorMsgs),e.listenTo(e.pathPanel,"ENORIPE_ComputePath",e.computePaths),e.listenTo(e.pathPanel,"ENORIPE_AddInGraph",e._addInGraph),e.listenTo(e.pathPanel,"ENORIPE_SelectInGraph",e._selectInGraph),e.listenTo(e.pathPanel,"ENORIPE_SetPathOnCompass",function(e){h&&h._syncPathToCompass(e)}),e.listenTo(e.pathPanel,"ContextualMenuFindPath",function(t){t.targetId&&(e._theContextualMenuTarget.context="FindPath",e._theContextualMenuTarget.targetId=t.targetId,e._theContextualMenuTarget.targetElement=t.targetElement,e._theContextualMenuTarget.typeOfPath=t.typeOfPath,e._theContextualMenuTarget.jsonMsgForOpen=t.jsonMsgForOpen,e._theContextualMenuTarget.jsonMsgForAddInGraph=t.jsonMsgForAddInGraph)}),e.pathPanel.inject(e.container,"top"),e.pathPanel.addEvent("PathPanelViewRender",function(){e.hideSpinner()}.bind(e)),e.pathPanel.addEvent("PathPanelViewClose",function(){e._toolBarView.getCommand("ComputePath_Command").removeClassName("pressed")}.bind(e)),e.pathPanel.addEvent("ENORIPE_HighlightPath",e._highlightPath.bind(e)),e.pathPanel.addEvent("ENORIPE_UnHighlightPath",function(t){e._currentView.endFilter()}.bind(e)),e.pathPanel.addEvent("noPathsFound",function(t){var i="noPathsFoundNP";"StructurePath"===t.type&&(i="noPathsFoundSP"),e._showNotif({level:"info",lvl:"primary",msg:r.replace(r.get(i),{anchor:t.anchor,selected:t.selected}),sticky:!1})}.bind(e)),e.pathPanel.render(e.collection.where({focus:!0}))})},_highlightPath:function(e){for(var t=e.paths,i=[],n=0;n<t.length;n++)if("StructurePath"===e.typeOfPath&&(t[n].from||t[n].to)||"NetworkPath"===e.typeOfPath&&t[n].type&&(t[n].type.contains("_from")||t[n].type.contains("_to"))){this.collection.where({modelType:"link"});var s=t[n-1],o=t[n+1];s&&o&&s.resourceid&&o.resourceid&&this.collection.filter(function(e){if("link"===e.get("modelType")){var t=e.get("id"),n=e.get("source"),a=e.get("target");n&&a&&(s.resourceid===n.id?o.resourceid===a.id&&i.push(t):s.resourceid===a.id&&o.resourceid===n.id&&i.push(t))}})}else"0"!==t[n].resourceid&&i.push(t[n].resourceid);"linearGraph"===this._currentLayout&&this.mapView?this.mapView.highlightPath(i):this.dataGridView.filter({matchingIDs:i})},dragElement:function(e,t){if(c.isWebInWin()&&t.data.items[0].objectId&&c.sendToMapWebInWin("RefreshOnDrag",t.data.items[0].objectId),e.dataTransfer)if(c.isWebInWin())try{e.dataTransfer.setData("text",JSON.stringify(t))}catch(e){console.log("Error in set Data for web in win : "+e)}else try{e.dataTransfer.setData("text/searchitems",JSON.stringify(t)),e.dataTransfer.setData("text",JSON.stringify(t))}catch(i){console.log(i),e.dataTransfer.setData("Text",JSON.stringify(t))}T.closeWidget()},setContainerEvents:function(){var e=this;this.container.addEventListener("dragenter",this.onDragEnter.bind(this)),this.container.addEventListener("mousedown",function(){e.containerMouseDownTime=new Date})},_onHide:function(){this.hide(),this._toolBarView&&this._toolBarView.toolBar.hide(),this.listView&&this.listView.hidePanel(),this.dispatchEvent("ENORIPE_HideLeftToolBar")},_onShow:function(){this.show(),this._toolBarView&&this._toolBarView.toolBar.show(),this._infoPanelCommandClick&&this.listView.showPanel(),this.dispatchEvent("ENORIPE_ShowLeftToolBar")},_onKeyUp:function(e){if(!0===e.ctrlKey){e.stopPropagation(),e.preventDefault();var t=e.keyCode||e.which,i=String.fromCharCode(t);"a"!==i&&"A"!==i||this.selectAllFromCmd()}},_handleDrop:function(t,i){this.showSpinner(),this._doContinueSearch();var n="extract"===t?i.id:null,s=i.data&&e.is(i.data.items[0].objectId)?i.data.items:null,o="extract"===t&&i.data.sourceIds?i.data.sourceIds:[];b.trackUsage("ObjectsDrop","Objectsdrop-"+t,s.length);var a=[t,o,s,n];i.data&&i.data.widgetSessionId&&a.push(i.data.widgetSessionId),this.dispatchEvent("ENORIPE_DropByMode",a)},onDropFromWebInWin:function(t){var i=t.action,n=t.objects&&e.is(t.objects)?JSON.parse(t.objects):null,s=h.isMultiSelActivated();n?(this.showSpinner(),this.dispatchEvent("ENORIPE_DropByMode",[i,n,null,s])):this._showNotif({level:"warning",lvl:"warning",msg:r.get("InvalidSelection")})},refreshMapCmd:function(){this.dispatchEvent("ENORIPE_refreshMap",[{initWithNodes:[],needClear:!0}]),this.refreshMsgPending=!0},refresh:function(e){this._isEmpty=e.isEmpty,e.isEmpty?this.hideSpinner():(this._initCollection(e.collection),this._initSubViews())},onResize:function(){if(this._updateContainerDimensions(),this._updateSVGContainer(),this._updateDropZonesHeight(),this._toolBarView&&this._toolBarView.resizeHandler(),this.pathPanel&&this.pathPanel.updateDialogSizeOnResize(),this.mapView){var e={sidePanelWidth:this.listView.getWidth(),actionBarHt:48};this.mapView.centerTheGraph(e)}this.dispatchEvent("ENORIPE_ResizeDialog")},onDragEnter:function(e){console.log("ondragEnter"),e.stopPropagation(),e.preventDefault();var t=this.listView&&this.listView.container&&this.listView.isVisible?this.listView.getWidth():0;this._isPreviewPanelOpen||this._dropZone.show(parseFloat(this.container.getStyle("width").slice(0,-2))-t,this._isEmpty)},_getTypesNls:function(e){var i=this,n={},s={};return e.forEach(function(e){n[e]=r.get(e)}),new t.Promise(function(t,o){i._isWebInWin&&O.setConfigForMyApps({myAppsBaseUrl:S.getMyAppsUrl(),userId:S.getUserID(),lang:S.getLang()}),e.length>0?s={"ds6w:type":e}:t(n),O.getNlsOfPropertiesValues(JSON.stringify(s),{tenantId:S.getCurrentTenantName(),lang:S.getLang(),apiVersion:"R2019x",onComplete:function(e){e&&void 0!==e["ds6w:type"]?t(e["ds6w:type"]):t(n)},onFailure:function(e){console.log("Error in fetching NLS data from FedDictionaryAccessAPI.getNlsOfPropertiesValues, the response received is ::"+e),t(n)}})})},_updateNLSForSavedAttrs:function(){var e=this,i=S.getJSONAttributes(),n=S.getDefaultAttributes();return new t.Promise(function(t,s){for(var o,a=[],r=0;r<2;r++)for(var l in o=0===r?i:n)o.hasOwnProperty(l)&&o[l].attributes&&o[l].attributes.forEach(function(e){-1===a.indexOf(e.uri)&&a.push(e.uri)});D.getResourcesInfo(a).then(function(s){if(s){var a={};s.forEach(function(e){a[e.curi]=e.label});for(var r=0;r<2;r++)for(var l in o=0===r?i:n)o.hasOwnProperty(l)&&o[l].attributes&&o[l].attributes.forEach(function(e){a[e.uri]&&(e.label=a[e.uri])});S.setJSONAttributes(i),S.setDefaultAttributes(n),e.saveDefaultsInStorage(n),e.dataGridView&&e.dataGridView.updateColumnsHeaderNls(o)}t()})})},_checkDefaults:function(e){for(var t in e)if(e.hasOwnProperty(t))for(var i=e[t].attributes,n=i.length;n--;)void 0!==i[n].uri&&null!==i[n].uri||i.splice(n,1);return e},updateMapViewAttributes:function(e){if(null!=e&&0!==e.length){var t=this,i=[],n=null,s=!1,o=this.collection.get(e);o&&o.get("instances")&&o.get("instances").length>0&&o.get("instances").forEach(function(e){null===n&&(n=e.type),i.push(e.id)}),o&&!o.get("thumbnail")&&S.getOption("Fetch_Thumbnails")&&(s=!0);var a=o.get("type")||"AllTypes",r={ids:[e],type:a,toFetchThumbnail:s},l={ids:i,type:n=n||"AllTypes",instances:!0};this.mapView.addLoader(e),this._fetchAndSetAttributes(r).then(function(n){if(o&&!o.get("preview_url")){var s=r.nlsObj[r.ids[0]].preview_url;s&&o.set("preview_url",s)}t.mapView.setAttrData(n),o.set("nlsObj",n.nlsObj[r.ids[0]]),i.length>0?t._fetchAndSetAttributes(l).then(function(i){t.mapView.setAttrData(i),t.mapView.removeLoader(e)},function(){t.mapView.removeLoader(e)}):t.mapView.removeLoader(e)},function(){t.mapView.removeLoader(e)})}},updateMapViewAttributesNls:function(e){if(null!=e&&0!==e.length){var t={},i=null;(i=this.collection.get(e))&&((t={modelType:i.get("type")||"AllTypes",ids:[e],models:{}}).models[e]=i,this._getNlsAndSetAttributes(t),i.get("instances")&&i.get("instances").length>0&&(t={ids:[],modelType:"AllTypes",isInstances:!0,models:{}},i.get("instances").forEach(function(i){t.modelType=i.type,t.ids.push(e),t.models[e]={_attributes:i}}),this._getNlsAndSetAttributes(t)))}},_getNlsAndSetAttributes:function(e){var t=this,i={},n={};e.models&&(i=D.getAttributes(e.modelType),n=D._prepareDataToNls(Object.values(e.models)),D._getNlsAndProcessData(n,e.ids,e.models,e.isInstances).then(function(e){e={...e,...i};for(var n=0;n<Object.keys(e.nlsObj).length;n++)t.collection.setNlsObj(Object.keys(e.nlsObj)[n],Object.values(e.nlsObj)[n]);t.mapView&&"linearGraph"===t._currentLayout&&t.mapView.setAttrData(e)}))},_fetchAndSetAttributes:function(e){return new t.Promise(function(t,i){try{P.fetchAttributes(e).then(function(e){e&&e.nlsObj&&Object.keys(e.nlsObj).length>0&&t(e)},function(){i()})}catch(e){console.log("err while fetching attributes"),i()}})},_isDiffFromDefault:function(e){var t=S.getUserID()+"_ENORIPE_Type_Attrs",i=localStorage.getItem(t);if(!i)return!0;if(i=JSON.parse(i),Object.keys(e).length!==Object.keys(i).length)return!0;for(var n in e)if(e.hasOwnProperty(n)){if(void 0===i[n])return!0;var s=e[n].attributes,o=i[n].attributes;if(s.length!==o.length)return!0;for(var a=s.map(function(e){return e.uri}),r=0;r<o.length;r++)if(-1===a.indexOf(o[r].uri))return!0}return!1},_attributesOrderChange:function(e){var t=S.getUserID()+"_ENORIPE_Type_Attrs",i=localStorage.getItem(t)?JSON.parse(localStorage.getItem(t)):null;if(!i||this._isDiffFromDefault(e))return!0;for(var n in e)if(e.hasOwnProperty(n))for(var s=e[n].attributes,o=i[n].attributes,a=0;a<s.length;a++)if(s[a].uri!==o[a].uri)return!0;return!1},hideOneDirection:function(e){this.showSpinner();var t=this.dataGridView.getOneDirectionLink(e);this.collection.filter(function(e){if(t.indexOf(e.id)>-1)return e}).length>0?(this.dispatchEvent("ENORIPE_SetNavigatedNode",[this.collection.getLinksAndNodes().nodes]),this.dispatchEvent("ENORIPE_HideOneDirection",[e,!0]),this.updateFilterProxy()):this.dispatchEvent("ENORIPE_HideOneDirection",[e,!0])},collapseSelectedNodes:function(e){var t=this.getSelectedIds();t.length>0?this.collapseNode(t,e):this._showNotif({level:"error",msg:r.get("ActionWithoutSelection")})},collapseNode:function(e,t){var i,n,s=[];i=this.collection.filter(function(t){if(e.indexOf(t.id)>-1)return t}),("out"===t?h.getAllSuccessors(i):"in"===t?h.getAllPredecessors(i):h.getAllPredecessors(i).concat(h.getAllSuccessors(i))).forEach(function(t){e.indexOf(t.id)<0&&s.push(t)}),n=s.map(function(e){return e.id}),s.length>0?("linearGraph"===S.getLayoutType()?this.removeNodes(s):"dataGridView"===S.getLayoutType()&&this.dataGridView.collapseNode(n,e),this._updateLastRootID(n)):e.length>1?this._showNotif({level:"info",msg:r.get("NodesCantBeCollapsed")}):this._showNotif({level:"info",msg:r.get("NodeCantBeCollapsed")})},removeNodes:function(e){"dataGridView"===S.getLayoutType()&&S.getInstancesMode()&&e.forEach(function(t){let i=this.dataGridView.getAllNodesById(t.id);if(i.length>1){let n=0;i.forEach(function(e){e.isSelected()&&n++}),i.length>n&&e.splice(e.indexOf(t),1)}}.bind(this)),this.collection.removeNodes(e).then(function(){this.renderAfterRemove(this.collection),this._manageSelection(h.isMultiSelActivated(),{models:e,sAction:"remove"})}.bind(this))},hideNodes:function(){var e=[];this._doContinueSearch(),(e=this.collection.where({focus:!0})).length>0?this.collection.where({modelType:"node"}).length===e.length?this._showNotif({level:"error",msg:r.get("AllNodesHidden")}):(this.showSpinner(),this.removeNodes(e),this._updateLastRootID(e.map(function(e){return e.id})),this.listView&&this.listView.isVisible&&this.listView.hidePanel()):this._showNotif({level:"error",msg:r.get("ActionWithoutSelection")})},togglePublications:function(e){this.dispatchEvent("ENORIPE_UpdatePrefPublications",e),this.listView.updatePublicationsMode(e)},toggleGhost:function(e){this.dispatchEvent("ENORIPE_UpdatePrefGhost",e)},removeActions:function(e){var t=[];e&&e.length>0&&(h.isMultiSelActivated()&&h.updateFeedBack(e),this.collection.filter(function(i){"node"===i.get("modelType")&&e.indexOf(i.id)>-1&&t.push(i.id)}),this.taggerServices.removeRoots(t))},expandSelectedNodes:function(e){var t=[],i=[],n=[];S.getLayoutType();if((i=this.collection.where({focus:!0})).length>0){for(var s=0;s<i.length;s++)e?i[s].get("counts").hasCount(e)&&(t.push(i[s].id),n=[...n,...i[s].get("counts").getRealCountAttribute("name",e)]):i[s].get("counts").hasCount()&&(t.push(i[s].id),n=[...n,...i[s].get("counts").getRealCountAttribute("name")]);t.length>0?(this.showSpinner(),this.splitCount(t,n,e)):this.displayMsgAlreadyInGraph(e)}else this._showNotif({level:"error",msg:r.get("ActionWithoutSelection")})},splitCount:function(e,t,i){e&&(this.collection.getEcoSystem({ids:e,relations:t||[],direction:i||"both"}),this._doContinueSearch())},_addInGraph:function(e,t){this._handleDrop("add",t),this._pathSelReq=!0,this._pathSelReqNodes=e},printMap:function(e){var t;if("dataGridView"==this._currentLayout){if(!this._isWebInWin)return void this.dataGridView.collectionView.openPrintableViewWindow(!0);t=this.dataGridView.collectionView.generatePrintableViewHTML()}else t=this.getElements(".d3-map-view-container")[0].outerHTML;this.printHTML(t,e)},printHTML:function(e,t){setTimeout(function(){var i="";let n=window.document.styleSheets;for(let e=0;e<n.length;e++)i+='<link rel="stylesheet" type="text/css" href="'+n[e].href+'" />';const s="<!DOCTYPE html>\n              <html>\n                  <head>\n                      <title>Relations - Print</title>\n                      "+(i+='\n            <style type="text/css" media = "all">\n            @page {margin-top: 1cm; \tmargin-left: 1cm;}\n            #svg-root {overflow: visible; display: inline; zoom : 50%}\n            </style>\n          ')+"\n                  </head>\n                  <body>\n                    "+e+"\n                  </body>\n              </html>",o=URL.createObjectURL(new Blob([s],{type:"text/html"})),a=window.open(o,"_blank","width=1024,height=768,top=0,left=0,scrollbars=yes,status=no,resizable=yes");setTimeout(function(){!0===t?a.close():a.print(),a.close()},500)},0)},fitAllInMap:function(){if(this.mapView){var e={sidePanelWidth:0,actionBarHt:48};e.sidePanelWidth=this.listView.getWidth(),this.mapView.fitAllIn(e)}},switchLayout:function(e){if(this._currentLayout!=e){var t,i=[],n=this.collection.getNodesIds();if(t=this.getSelectedIds(!1),"linearGraph"===this._currentLayout&&0===t.length)return this._showNotif({level:"error",msg:r.get("commandWithoutSelection")}),void this._toolBarView.updateLayout();switch(n.length>S.getOption("navigatedNodeLimite")&&this.resetCollectionWithRoots(),this._currentLayout=e,S.setLayoutType(e),this.dispatchEvent("ENORIPE_SwitchLayout",e),this._toolBarView.updateLayout(),e){case"linearGraph":this.collection.getLinksAndNodes(!1);this.mapView&&(this.mapView.inject(this.container),this.mapView.show(),this._currentView=this.mapView),this.dataGridView&&(i=this.dataGridView.getVisibleNodes(!0),this.dataGridView.hide()),this.dispatchEvent("ENORIPE_refreshMap",[{initWithNodes:i,needClear:!1,selectedNodes:t}]);break;case"dataGridView":this._currentView=this.dataGridView,this.clearMapSuccess(!0),this._initDatagridView(!0)}}},switchThumbnailsMode:function(e){"thumbnailsMode"===e?(this.getElement(".d3-map-view-container").removeClassName("no-thumbnails"),this.mapView.addMissingThumbnail(this.collection)):this.getElement(".d3-map-view-container").addClassName("no-thumbnails"),this.mapView.updateConstraints(this.collection.getLinksAndNodes(),this.collection.groupBy("columnID")),this.mapView.updateNodesYposition(e),this.getElements(".foreign-object-count-mobile").forEach(function(t){t.setAttribute("y","thumbnailsMode"===e?95:35)}),this.getElements(".colored-rect-bi").forEach(function(t){t.setAttribute("height","thumbnailsMode"===e?120:55)}),this.getElements("#toggleEcosystem").forEach(function(e){e.hasClassName("expandMenuDirection-in")?e.setAttribute("style","transform:translate(0px,"+(S.getNodesHeight()/2-30)+"px"):e.setAttribute("style","transform:translate("+S.getNodesWidth()+"px,"+(S.getNodesHeight()/2-30)+"px")})},toggleNodeThumbnail:function(e){this.dispatchEvent("ENORIPE_UpdatePrefNodeThumbnail",e)},toggleRecompute:function(e){this.dispatchEvent("ENORIPE_UpdatePrefRecompute",e)},editLayout:function(){var e=this._toolBarView.getCommand("EditLayout_Command");e&&this.mapView&&(e.hasClassName("pressed")?(e.removeClassName("pressed"),this.mapView.layoutingOff()):(e.addClassName("pressed"),this.mapView.layoutingOn()))},excludeNodes:function(e,t){var i=[];(i=t?i.concat(t):i.concat(this.getSelectedIds())).length>0?this.collection.where({modelType:"node"}).length===i.length?this._showNotif({level:"error",msg:r.get("AllNodesExcluded")}):(this.collection.excludeElements(e,i),e&&this.dispatchEvent("ENORIPE_setExcludeNode",[i])):this._showNotif({level:"error",msg:r.get("ActionWithoutSelection")})},displayMsgAlreadyInGraph:function(e){var t="";switch(e){case"in":t=r.get("UpstreamAlreadyInGraph");break;case"out":t=r.get("DownstreamAlreadyInGraph");break;default:t=r.get("UpAndDownstreamAlreadyInGraph")}this._showNotif({level:"info",lvl:"primary",msg:t})},handleServerErrorMsgs:function(e){e&&("timeout"===e.type?(e.level="error",e.msg=r.get("timeout"),e.subtitle=r.get("verifyConnection")):"internalServerError"===e.type?(e.level="error",e.msg=r.get("internalServerError")):(e.level="error",e.msg=r.get("generic"))),this._spinner&&this.hideSpinner(),this._showNotif(e)},maskMapView:function(){m.mask(this.container)},unmaskMapView:function(){m.unmask(this.container)},_saveForRefresh:function(e,t){this.dispatchEvent("ENORIPE_SaveForRefresh",[e,t])},saveDefaultsInStorage:function(e){var t=S.getUserID()+"_ENORIPE_Type_Attrs";localStorage.setItem(t,JSON.stringify(e))},_updateLastRootID:function(e){var t=this._lastRootID.filter(t=>!e.includes(t));t.length!=this._lastRootID&&this.dispatchEvent("ENORIPE_updateLastRootId",[t])},_updateCollectionWithView:function(){let e=[];this.collection.getNodesIds().forEach(function(t){this.dataGridView.getAllNodes(!0).indexOf(t)<0&&e.push(this.collection.get(t))}.bind(this)),e.length>0&&this.removeNodes(e)},getSelectedIds:function(){return this.collection.where({focus:!0}).map(function(e){return e.id})},_getIdsSortedByColumn:function(e){for(var t=this.collection.sortBy("columnID"),i=[],n="",s=0;s<t.length;s++)if("link"!==t[s]._attributes.modelType){n=t[s]._attributes.id;for(var o=0;o<e.length;o++)if(n===e[o]){i.push(e[o]);break}}return i},_processSelection:function(e){var t=[],i=[...this._currentlyFilteredNodes,...this._currentlySearchedNodes],n=this._isFiltered||this._isSearched;return h.isMultiSelActivated()||this.initMultiSelectionFromCmd(),e.forEach(function(e){n?i.indexOf(e.get("id"))>-1&&t.push(e):t.push(e)}),t},_manageFirstFocusAndAnchor:function(e){this.collection;var t=e&&e.length>0?e:this._lastRootID;if(t&&t.length>0){t.length>1&&!h.isMultiSelActivated()&&this.initMultiSelectionFromCmd();let e=t.map(function(e){return this.collection.get(e)}.bind(this));e.length>0&&e[0]&&this._manageSelection(h.isMultiSelActivated(),{models:e,sAction:"add",origin:"MapView"}),this._setFirstFocusOnCompass=!0}},_manageFocus:function(){if(this._lastRootID&&0!==this._lastRootID.length){0===this.collection.where({modelType:"node",focus:!0,isCount:void 0}).length&&this._manageFirstFocusAndAnchor()}else this._initLastRootWithColumnId()},_initLastRootWithColumnId:function(){var e=[],t=[];t=Object.keys(this.collection.groupBy("columnID")).sort((e,t)=>e-t),this._lastRootID&&0!==this._lastRootID.length||(t.every(function(t){let i=parseInt(t);if(Number.isInteger(i)){let t=this.collection.where({modelType:"node",columnID:i});return!((e=t.map(function(e){return e.id})).length>0)}return!0}.bind(this)),this.dispatchEvent("setLastRootNodeID",[e]),this._currentView&&!this._currentView.isInitWithNodes()&&this._manageFirstFocusAndAnchor(e))},initMultiSelectionFromCmd:function(){h.initMultiSel()},clearSelection:function(e){var t=[];e&&(h.viewContext=e),h.getSelectedIDs().forEach(function(e){this.collection.get(e)&&t.push(this.collection.get(e))}.bind(this)),this._manageSelection(!1,{models:t,sAction:"remove",origin:"MapView"}),h.endMultiSel(),this.mapView&&this.mapView.clearMultiSelection(),this._toolBarView&&(this._toolBarView.hideSelectionIcon(),this._toolBarView.disableSelectionAssistantCommand())},selectAllFromCmd:function(){var e,t;t=this.collection.where({modelType:"node"}),(e=this._processSelection(t)).length&&this._manageSelection(!0,{models:e,sAction:"add"})},selectOutFilteredFromComd:function(){var e=this._isFiltered||this._isSearched,t=[],i=[];e?(h.clearMultiSel(1),t=this._currentlyFilteredNodes,this.collection.where({modelType:"node"}).forEach(function(e){t.indexOf(e.get("id"))<0&&i.push(e)}),this._manageSelection(!0,{models:i,sAction:"add"})):this._showNotif({level:"info",lvl:"primary",msg:r.get("ActionWithoutFiltering")})},inverseSelectionFromCmd:function(){var e;e=h.getInverseSelection(),this._manageSelection(!0,{models:h.getSelected(),sAction:"remove"}),this._manageSelection(!0,{models:e,sAction:"add"})},_manageSelection:function(e,t,i){var n="string"==typeof t.models?[this.collection.get(t.models)]:t.models,s=!1;t.models&&(e?(t.origin&&""!==h.viewContext&&(s=t.origin!==h.viewContext),"MapView"===t.origin?h.viewContext="MapView":"ListView"===t.origin&&(h.viewContext="ListView"),h.onObjectToMultiSel(n,t.sAction,s),this._toolBarView&&("remove"===t.sAction?this._toolBarView.disableSelectionAssistantCommand():this._toolBarView.enableSelectionAssistantCommand())):(this.setFocus(n[0]),h.updateSelection(n[0],t.origin))),n.forEach(function(e){"add"===t.sAction?this._currentView.addToSelection(e.id,!h.isMultiSelActivated(),t.instanceId):"remove"===t.sAction&&this.removeFocus(e,t.instanceId)}.bind(this)),"add"===t.sAction&&n[0].id&&this.pathPanel&&!this.pathPanel.container.isHidden()&&!i&&this.managePathPanel(n[0].id),this.manageProperties(),this.updateToolbarSelectionIcon()},setFocus:function(e){if(!h.isMultiSelActivated()){var t=this.collection.findWhere({focus:!0,modelType:"node"});if(e===t)return;e.set("focus",!0),"node"===e.get("modelType")&&c.sendToMapWebInWin("onObjectSelected",e.id);e.get("id");var i="";t&&(i=t.get("id"),t.set("focus",!1),this._currentView.removeToSelection(i))}},removeFocus:function(e,t){if("dataGridView"===S.getLayoutType()&&S.getInstancesMode()){let t=this.dataGridView.getAllNodesById(e.id);if(t.length>1){let i=0;t.forEach(function(e){e.isSelected()&&i++}),t.length<=i&&e.set("focus",!1)}else e.set("focus",!1)}else e.set("focus",!1);this._currentView.removeToSelection(e.id,t)},updateToolbarSelectionIcon:function(){0===this.getSelectedIds().length?(this._toolBarView&&(this._toolBarView.hideSelectionIcon(),this._toolBarView.disableSelectionAssistantCommand()),h.endMultiSel()):this._toolBarView&&(this._toolBarView.showSelectionIcon(),this._toolBarView.enableSelectionAssistantCommand())},showSpinner:function(){this._spinner&&this._spinner.show()},hideSpinner:function(){this._spinner&&this._spinner.hide()},_selectInGraph:function(e){if(e){if(0===e.length)return;var t,i=[],n=this;e.forEach(function(e){(t=n.collection.get(e))&&"node"===t.get("modelType")&&i.push(t)}),h.isMultiSelActivated()||this.initMultiSelectionFromCmd(),h.viewContext="MapView",this._manageSelection(!0,{models:i,sAction:"add"},!0)}},initMultiSelectionFromCmdIfMultiSelIsActivated:function(){h.isMultiSelActivated()&&h.initMultiSel(!0)},nodeClicked:function(e,t){var i=this.collection.get(e);if(i){this.currentModelClicked=i,this._manageSelection(h.isMultiSelActivated(),{models:e,sAction:t,origin:"MapView"}),h.isMultiSelActivated()||(this._toolBarView.showSelectionIcon(),this._toolBarView.enableSelectionAssistantCommand());this.collection.where({modelType:"node",focus:!0});this._doContinueSearch()}},clearFilterBySearch:function(){if(this._isPreviewPanelOpen&&this.previewView)return this.previewView.clearSearch(),void(this._pager&&this._pager.closePager());this._isSearched=!1,this._continueSearch=!1,this._currentlySearchedNodes=[],this._isFiltered&&this._lastFilterData?this.filter(this._lastFilterData):(this._currentView.endFilter(),this.updateFilterProxy()),this._pager&&this._pager.closePager()},_doContinueSearch:function(){this._isWebInWin||(this._isSearched?this._continueSearch=!0:this._continueSearch=!1)},_onPager:function(e){this._pager||(this._pager=new y({debugMode:this._debug,isWebInWin:this._isWebInWin}),this.listenTo(this._pager,"ENORIPE_NavPagerClose",this.clearFilterBySearch),this.listenTo(this._pager,"ENORIPE_HighlightNode",this._highlightNodeByPager),this._pager.inject(this.container)),this._continueSearch&&(e.noChangeFocus=!0),this._pager.render(e)},_highlightNodeByPager:function(e){if(this._isPreviewPanelOpen)this.previewView.selectNode(e);else if(this.clearSelection(),"All"===e)this.selectAllFromCmd();else{var t=this.collection.get(e);this._manageSelection(!1,{models:[t],sAction:"add"})}},_initTagger:function(){var e=this;if(!this.taggerServices){this.summariesForVolatileTags=[{count:-1,dispValue:r.get("Synchronized"),object:"Synchronized",sixw:"ds6w:what/"+r.get("SynchronizationStatusPredicate"),type:"string",value:"Synchronized"},{count:-1,dispValue:r.get("NotSynchronized"),object:"NotSynchronized",sixw:"ds6w:what/"+r.get("SynchronizationStatusPredicate"),type:"string",value:"NotSynchronized"},{count:-1,dispValue:r.get("Unknown"),object:"Unknown",sixw:"ds6w:what/"+r.get("SynchronizationStatusPredicate"),type:"string",value:"Unknown"},{count:-1,dispValue:r.get("In"),object:"In",sixw:"ds6w:what/"+r.get("LoopsPredicate"),type:"string",value:"In"},{count:-1,dispValue:r.get("Out"),object:"Out",sixw:"ds6w:what/"+r.get("LoopsPredicate"),type:"string",value:"Out"},{count:-1,dispValue:r.get("Yes"),object:"Yes",sixw:"ds6w:what/"+r.get("IsLastVersionPredicate"),type:"string",value:"Yes"},{count:-1,dispValue:r.get("No"),object:"No",sixw:"ds6w:what/"+r.get("IsLastVersionPredicate"),type:"string",value:"No"}];var t={};t["ds6w:what/"+r.get("SynchronizationStatusPredicate")]=[{color:"#57B847",object:"Synchronized",type:"string"},{color:"#EA4F37",object:"NotSynchronized",type:"string"},{color:"#FFA500",object:"Unknown",type:"string"}],t["ds6w:what/"+r.get("LoopsPredicate")]=[{color:"#EA4F37",object:"In",type:"string"},{color:"#57B847",object:"Out",type:"string"}],t["ds6w:what/"+r.get("IsLastVersionPredicate")]=[{color:"#57B847",object:"Yes",type:"string"},{color:"#EA4F37",object:"No",type:"string"}],this.taggerServices=new M({widgetId:this._widgetId,addVolatileTags:!0,summariesForVolatileTags:this.summariesForVolatileTags,colorMapsForVolatileTags:t}),this.taggerServices.addEvent("Tagger_FilterBIColorize",function(t){e.onFilterBIColorize(t)}),this.taggerServices.addEvent("Tagger_FilterBIUnColorize",function(){e.onFilterBIUnColorize()}),this.taggerServices.addEvent("Tagger_FilterBIFilteringEvent",function(t){e.onFilterBIFilteringEvent(t)}),this.taggerServices.addEvent("Tagger_ColorizeVolatile",function(t){t.isVolatileData=!0,e.onFilterColorizeVolatile(t)}),this.taggerServices.addEvent("Tagger_FilteringVolatile",function(t){t.isVolatileData=!0,e.onFilterVolatile(t)})}},updateFilterProxy:function(e,t){var i=[],n=0;if((t=t||[...this._currentlyFilteredNodes,...this._currentlySearchedNodes])&&t.length>0)for(n=0;n<t.length;n++)i.push(t[n]);else e||this.collection.filter(function(e){if("node"===e.get("modelType")&&(i.push(e.get("id")),e.get("instancesExpanded")>0&&e.get("instances")))for(var t=0;t<e.get("instancesExpanded");t++)i.push(e.get("instances")[t].id)});var s=[],o=[];this.collection.filter(function(e){if("link"===e.get("modelType")){var t=e.get("type");if(-1===o.indexOf(t)){o.push(t);var i={count:-1,dispValue:r.get(t),object:t,sixw:"ds6w:what/"+r.get("RelationsPredicate"),type:"string",value:t};s.push(i)}}});var a=this.summariesForVolatileTags.concat(s);this.taggerServices.updateVolatileTags(a),this.taggerServices.updateFilterProxy(i,e)},onFilterBIFilteringEvent:function(e){this._appliedTags=0,this.filter(e)},onFilterBIColorize:function(e,t){var i={matchingIDs:[],filteredLinks:[]};e&&(i.matchingIDs=e),t&&(i.filteredLinks=t),(e||t)&&(this.onFilterBIUnColorize(),this._currentView.colorize(i))},onFilterBIUnColorize:function(){this._currentView.unColorize()},onFilterColorizeVolatile:function(e){if(e&&e.tagColors&&e.tagColors.length>0)switch(this.addLoader(),this.onFilterBIUnColorize(),e.tagColors[0].predicate){case"ds6w:what/"+r.get("SynchronizationStatusPredicate"):this.dispatchEvent("ColorizeSynchro",e);break;case"ds6w:what/"+r.get("LoopsPredicate"):this.loopColorize(e);break;case"ds6w:what/"+r.get("IsLastVersionPredicate"):this.dispatchEvent("ColorizeVersion",e);break;case"ds6w:what/"+r.get("RelationsPredicate"):this.colorizeRelations(e);break;default:this.removeLoader()}},onFilterVolatile:function(e){this._appliedTags=0;e.matchingIDs,this.collection.filter(function(e){return"node"===e.get("modelType")});if(e&&e.allfilters){var t="";this.addLoader(),"linearGraph"===this._currentLayout&&(this.mapView._filteredOpacity=!1),this._currentView.endFilter();for(var i="",n=0;n<Object.keys(e.allfilters).length;n++){switch(t=Object.keys(e.allfilters)[n]){case"ds6w:what/"+r.get("SynchronizationStatusPredicate"):this.dispatchEvent("FilteringSynchro",e);break;case"ds6w:what/"+r.get("LoopsPredicate"):this.loopFiltering(e);break;case"ds6w:what/"+r.get("IsLastVersionPredicate"):this.dispatchEvent("FilteringVersion",e);break;case"ds6w:what/"+r.get("RelationsPredicate"):this.relationsFiltering(e);break;default:this.removeLoader()}var s=e.allfilters[t];s&&s.length&&s.forEach(function(e){i=i+e.object+","})}i.length>0&&(i=i.substr(0,i.length-1),b.trackPerformance("volatileTagUsage","volatileTagUsage",{Label:t,Tags:i}))}},colorizeSynchro:function(e){e.colorMap={};for(var t=0;t<e.tagColors.length;t++)e[e.tagColors[t].object]&&e[e.tagColors[t].object].forEach(function(i){e.colorMap[i]=e.tagColors[t].color});this.onFilterBIColorize([],e),this.removeLoader()},colorizeRelations:function(e){var t={};e.colorMap={};for(var i=0;i<e.tagColors.length;i++)t[e.tagColors[i].object]=e.tagColors[i].color;this.collection.filter(function(i){"link"===i.get("modelType")&&(e.colorMap[i.id]=t[i.get("type")])}),this.onFilterBIColorize([],e),this.removeLoader()},colorizeVersion:function(e){var t={};e.colorMap=[];for(var i=0;i<e.tagColors.length;i++)t[e.tagColors[i].object]=e.tagColors[i].color;this.collection.filter(function(i){"node"===i.get("modelType")&&(Object.values(e.lastVersionNodes).indexOf(i.id)>-1?e.colorMap.push({id:i.id,color:t.Yes}):Object.values(e.notLastVersionNodes).indexOf(i.id)>-1&&e.colorMap.push({id:i.id,color:t.No}))}),this.onFilterBIColorize(e.colorMap),this.removeLoader()},loopColorize:function(e){e.forColorize=!0;var t,i,n=[];e=this.loopFiltering(e);for(var s=0;s<e.tagColors.length;s++)"In"===e.tagColors[s].object?t=e.tagColors[s].color:"Out"===e.tagColors[s].object&&(i=e.tagColors[s].color);for(var o=0;o<e.inLoopNodes.length;o++)n.push({id:e.inLoopNodes[o],color:t});for(var a=0;a<e.outLoopNodes.length;a++)n.push({id:e.outLoopNodes[a],color:i});this.onFilterBIColorize(n),this.removeLoader()},loopFiltering:function(e,t){var i={excluded:!0,tags:[]},n=[],s=[];if(!e.forColorize)for(var o in e.allfilters)if(e.allfilters.hasOwnProperty(o)){o!=="ds6w:what/"+r.get("LoopsPredicate")&&!0;for(var a=0;a<e.allfilters[o].length;a++)if(!e.allfilters[o][a].excluded){i.excluded=!1;break}for(a=0;a<e.allfilters[o].length;a++)"In"!==e.allfilters[o][a].object&&"Out"!==e.allfilters[o][a].object||!e.allfilters[o][a].excluded!=!i.excluded||i.tags.push(e.allfilters[o][a].object)}for(var l=this._layoutUtils.findLoops(),d=0;d<l.length;d++)for(var c=l[d],h=0;h<c.length;h++){n.push(c[h]);var u=this.collection.get(c[h]);if(u&&u.get("instancesExpanded")>0&&u.get("instances"))for(a=0;a<u.get("instances").length;a++)n.push(u.get("instances")[a].id)}if(this.collection.filter(function(e){if("node"===e.get("modelType")&&n.indexOf(e.id)<0&&(s.push(e.id),e.get("instancesExpanded")>0&&e.get("instances")))for(a=0;a<e.get("instances").length;a++)s.push(e.get("instances")[a].id)}),e.forColorize)return e.inLoopNodes=n,e.outLoopNodes=s,e;for(a=0;a<i.tags.length;a++)"In"===i.tags[a]?i.excluded?e.matchingIDs=e.matchingIDs.filter(function(e){return n.indexOf(e)<0}):e.matchingIDs=n.filter(function(t){return e.matchingIDs.indexOf(t)>-1}):"Out"===i.tags[a]&&(i.excluded?e.matchingIDs=e.matchingIDs.filter(function(e){return s.indexOf(e)<0}):e.matchingIDs=s.filter(function(t){return e.matchingIDs.indexOf(t)>-1}));e.isLoopData=!0,this.filter(e)},relationsFiltering:function(e){var t={excluded:!0,tags:[]},i={},n={},s=[];for(var o in e.filteredLinks=[],e.matchingIDs||(e.matchingIDs=[]),e.allfilters)if(e.allfilters.hasOwnProperty(o)&o==="ds6w:what/"+r.get("RelationsPredicate")){for(var a=0;a<e.allfilters[o].length;a++)if(!e.allfilters[o][a].excluded){t.excluded=!1;break}for(a=0;a<e.allfilters[o].length;a++)!e.allfilters[o][a].excluded==!t.excluded&&t.tags.push(e.allfilters[o][a].object)}this.collection.filter(function(i){"link"===i.get("modelType")&&(t.excluded?t.tags.indexOf(i.get("type"))<0&&e.filteredLinks.push(i.id):-1!==t.tags.indexOf(i.get("type"))&&e.filteredLinks.push(i.id))}),this.collection.filter(function(t){if("link"===t.get("modelType")&&e.filteredLinks.indexOf(t.id)>-1){if(i=t.get("source"),n=t.get("target"),i.id&&s.indexOf(i.id)<0&&(s.push(i.id),i.instancesExpanded>0&&i.instances))for(var o=0;o<i.instances.length;o++)s.push(i.instances[o].id);if(n.id&&s.indexOf(n.id)<0&&(s.push(n.id),n.instancesExpanded>0&&n.instances))for(o=0;o<n.instances.length;o++)s.push(n.instances[o].id);t.get("instanceTargetId")&&s.indexOf(t.get("instanceTargetId"))<0&&s.push(t.get("instanceTargetId"))}}),e.matchingIDs=s.filter(function(t){return e.matchingIDs.indexOf(t)>-1}),this.filter(e)},filter:function(e){this._lastFilterData=e,Object.keys(e.allfilters).length>0?(this._isFiltered=!0,this._currentlyFilteredNodes=this._currentView.filter(e),e.isVolatileData&&this.updateFilterProxy(e.isVolatileData)):(this._isFiltered=!1,this._currentlyFilteredNodes=[],this._isSearched?(this._currentView.filter({matchingIDs:this._currentlySearchedNodes}),this.updateFilterProxy(e.isVolatileData,this._currentlySearchedNodes)):("linearGraph"===this._currentLayout&&this.mapView&&(this.mapView._filteredOpacity=!1),this._currentView.endFilter(!0))),this._appliedTags++,this._appliedTags===Object.keys(e.allfilters).length&&this.removeLoader()},filterBySearch:function(t){var i=e.clone(t);i=this._isPreviewPanelOpen?this.previewView.getIdsSorted(i):this._getIdsSortedByColumn(i),this._onPager({result:i}),this._isPreviewPanelOpen?this.previewView.filterByFading(t):(this._isSearched=!0,this._currentlySearchedNodes=t,this._currentView.filter({matchingIDs:t})),0===i.length?this._showNotif({level:"error",msg:r.get("No-SearchMatch")}):this.updateFilterProxy(this._currentlySearchedNodes)},_OnRightClick:function(t){if(this._isWebInWin){var i=this.collection.get(t.id);if(this._theContextualMenuTarget.targetId=t.id,this._theContextualMenuTarget.context=t.context,e.is(i)){e.is(this._theContextualMenu)&&this._theContextualMenu.destroy();var n=[];h.isMultiSelActivated()?((n=h.getSelectedIDs()).includes(t.id)||(n=[t.id]),c.sendToMapWebInWin("onComputeCtxMenu",n)):c.sendToMapWebInWin("onComputeCtxMenu",[t.id])}}},_onCtxMenuItem:function(e){if(this._isWebInWin){var t=h.getSelectedIDs();c.sendToMapWebInWin("onCtxMenuClick",t,e.action)}},SetContextualMenu:function(t){if(this._isWebInWin){var i,n=this,s=h.getSelectedIDs();if(s=s.length?s:[this._theContextualMenuTarget.targetId],i=c.ComputeContextualMenu(this,t),e.is(i))switch(i=i.filter(function(e){return"CATRelNavWebInWinCmdHdr"!==e.actionId}),this._theContextualMenuTarget.context){case"D3MapView":var o=this._theContextualMenuTarget.targetId,a=this.getElement("#container-"+o),l={id:"previewEcosys",text:r.get("previewUpAndDownstream"),icon:A.getWebappsAssetUrl("SNNavigationMap","icons/preview.png"),handler:function(){n._showPreview({modelId:o})}};i.push(l),this._theContextualMenu=new d({isContextual:!0,target:a,items:i}),this._theContextualMenu.show(),this._theContextualMenuTarget={};break;case"DataGridView":o=this._theContextualMenuTarget.targetId,a=this.getElement("#container-"+o);var u=this.dataGridView.getRightClickModel();u&&this.dataGridView.getExpandCollapseCtxMenu(u,!0).then(function(e){i=[...i,...e],this._theContextualMenu=new d({isContextual:!0,target:a,items:i}),this._theContextualMenu.show(),this._theContextualMenuTarget={}}.bind(this));break;case"PreviewGroup":o=this._theContextualMenuTarget.targetId,a=this._theContextualMenuTarget.targetElement;o&&a&&(this._theContextualMenu=new d({isContextual:!0,target:a,items:i}),this._theContextualMenu.show(),this._theContextualMenuTarget={});break;case"FindPath":var g=this._theContextualMenuTarget.targetId,p=(a=this._theContextualMenuTarget.targetElement,this._theContextualMenuTarget.typeOfPath),m=this._theContextualMenuTarget.jsonMsgForOpen,f=this._theContextualMenuTarget.jsonMsgForAddInGraph;if(g&&a){if("StructurePath"==p){var v={accelerator:"Ctrl+O",availabilityMode:"Normal=YES CommandSet=YES Editability=YES SmallScale=YES LargeScale=YES ",id:"OpenSearch",multisel:!0,text:r.get("open"),icon:"I_OpenDB",handler:function(){c.sendStringRelationsToWebInWin("onOpenPathClick",m)}};i.push(v);var _={id:"findPathAddInGraph",text:r.get("addInGraph"),icon:"I_AddResource",handler:function(){n._addInGraph(g,f)}};i.push(_)}else{v={accelerator:"Ctrl+O",availabilityMode:"Normal=YES CommandSet=YES Editability=YES SmallScale=YES LargeScale=YES ",id:"OpenSearch",multisel:!0,text:r.get("open"),icon:"I_OpenDB",handler:function(){c.sendToMapWebInWin("onCtxMenuClick",g,"OpenSearch")}};i.push(v);var N={id:"selectInGraphItem",text:r.get("SelectInGraph"),icon:"I_Select",handler:function(){n._selectInGraph(g)}};i.push(N)}this._theContextualMenu=new d({isContextual:!0,target:a,items:i}),this._theContextualMenu.show(),this._theContextualMenuTarget={}}}}},addLoader:function(){m.mask(this.container)},removeLoader:function(e){this.hideSpinner(),m.unmask(this.container)},_showNotif:function(e){if(c.isWebInWin()){this.alert&&this.alert.destroy();var t=e.container||this.container;this.alert=new p({visible:!0,autoHide:!0,hideDelay:3e3,animate:!0}).inject(t);var i="";return e.title&&(i+=e.title),e.subtitle&&(i+=e.subtitle),e.msg&&(i+=e.msg),this.alert.add({className:e.lvl?e.lvl:"error",message:i}),void this.alert.elements.container.setStyle("top","40px")}this._notifManager.addNotif({level:e.level,message:e.msg,title:e.title?e.title:"",subtitle:e.subtitle?e.subtitle:"",sticky:!1})},clearMapClick:function(){var e=this,t=new f({renderTo:e.container}),i=r.get("ClearConfirmHeader"),n=r.get("ClearConfirmBody");t.dialog({body:n,title:i,buttons:[{className:"primary",value:r.get("ClearView_ClearButton"),action:function(t){e.dispatchEvent("ENORIPE_ClearMap"),t.hide()}},{value:r.get("ClearView_Cancel"),action:function(e){e.hide()}}]})},clearMapFailure:function(){this._notifManager.addNotif({level:"info",message:r.get("clearView_failure"),sticky:!1})},clearMapSuccess:function(t){t||(this._isEmpty=!0),this._toolBarView&&(this._toolBarView.hideSelectionIcon(),this._toolBarView.disableSelectionAssistantCommand()),h&&!t&&(h.handleClearMap(),h.isMultiSelActivated()&&h.endMultiSel()),this.collection&&!t&&this.collection.reset(),e.is(this.mapView)&&(this.mapView.destroy(),this.mapView=null),e.is(this.dataGridView)&&!t&&(this.dataGridView.destroy(),this.dataGridView=null),e.is(this.listView)&&(this.listView.hidePanel(),this.listView.clearPanel(),this._infoPanelCommandClick=!1),e.is(this._pager)&&(this._pager.destroy(),this._pager=null),this._initEmptyMap(!0)},destroy:function(){this.stopListening(this.collection),this.stopListening(this.mapView),this.stopListening(this.listView),this.stopListening(this._dropZone),this.stopListening(this.pathPanel),this.collection.reset(),this.container=null,this._parent()}})}),define("DS/SNNavigationMap/ENORIPE",["UWA/Class","UWA/Core","UWA/Promise","DS/SNNavigationMap/utils/PromisesManager","DS/SNNavigationMap/MapSettings","DS/SNNavigationMap/utils/ProbesUtils","DS/SNNavigationMap/views/NavigationApp","DS/SNNavigationMap/views/NavigationHomePage","DS/SNNavigationMap/collections/NavigationCollection","DS/SNNavigationMap/utils/SNNavigationServices","DS/SNNavigationMap/utils/RelationsServices","DS/ENOFilterBIUX/FilterBIComponentProxy","DS/SNNavigationMap/utils/LayoutUtils","DS/SNNavigationMap/utils/SearchUtils","DS/SNNavigationMap/utils/CommonUtils","DS/UIKIT/Modal","DS/UIKIT/Iconbar","DS/UIKIT/Input/Button","DS/WAFData/WAFData","DS/FedDictionaryAccess/FedDictionaryAccessAPI","DS/ENOXWidgetPreferences/js/ENOXWidgetPreferences","DS/Notifications/NotificationsManagerUXMessages","DS/Notifications/NotificationsManagerViewOnScreen","DS/SNNavigationMap/utils/NlsManager","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_internal"],function(e,t,i,n,s,o,a,r,l,d,c,h,u,g,p,m,f,v,_,N,S,b,w,E,I){"use strict";return e.extend({excludedNodes:[],currentProfile:"",_navigatedNodes:[],_currentRelations:[],_groupedRelations:{},_activeProfiles:[],_availableRelations:[],_lastSavedValues:{},_isHomePageVisible:!1,_preSelectedObjectIds:[],_tempPreferences:[],_isWebInWin:d.isWebInWin(),init:function(e){var i=this;t.merge(I,E.getNls()),o.setStartTime("init"),this._widget=e.widget||null,this.container=e.renderTo||null,this._navigatedNodes=this._getWidgetValue("ENORIPE_navigatedNodes"),this._addinMode=this._getWidgetValue("addinmode"),this.excludedNodeIds=this._getValuesForRefresh("excludedNodes")?this._getValuesForRefresh("excludedNodes"):[],this._errorOnParseCompassData=e.errorOnParseCompassData||!1,this._inAppOptions=e.inAppOptions,this._isWebInWin&&(this.container=t.extendElement(this.container)),s.setOption("iswebinwin",this._isWebInWin),this._PM=new n({debugMode:"1"===s.getOption("debug_me")}),this._notifManager=b,w.setNotificationManager(this._notifManager),this._widget&&(this._widgetId=this._widget&&this._widget.id?this._widget.id:void 0,this._widgetStateAtInit=this._widget.getView?this._widget.getView().type:""),this._widgetId=this._widgetId?this._widgetId:e.widgetId,s.setWidgetId(this._widgetId),e.profile&&void 0!==e.profile&&""!==e.profile&&this._saveValuesInSession("LastUsedProfile",e.profile),e.preSelectedObjectIds&&void 0!==e.preSelectedObjectIds&&(this._preSelectedObjectIds=e.preSelectedObjectIds),e.inAppMode&&s.setOption("inAppMode",!0),this._inAppOptions&&(void 0!==this._inAppOptions.relationSet&&""!==this._inAppOptions.relationSet&&this._saveValuesInSession("LastUsedProfile",this._inAppOptions.relationSet),void 0!==this._inAppOptions.selectedObjectIds&&(e.initWithNodes=JSON.stringify(this._inAppOptions.selectedObjectIds))),this._getValuesForRefresh("favoriteID")&&null!==this._getValuesForRefresh("favoriteID")&&(e.initWithFavorite=this._getValuesForRefresh("favoriteID")),this._getValuesInSession("layoutType")&&""!==this._getValuesInSession("layoutType")&&(s.setLayoutType(this._getValuesInSession("layoutType")),this.container.addClassName("mode-"+this._getValuesInSession("layoutType"))),this._getValuesForRefresh("lastRootNodeID")&&this._getValuesForRefresh("lastRootNodeID")!==[]&&this._updateLastRootID(this._getValuesForRefresh("lastRootNodeID")),e.initWithTenant&&s.setCurrentTenant(e.initWithTenant),e.defaultTenant&&s.setDefaultTenant(e.defaultTenant),s.appInitializationPromised(e.mapSettings).then(function(){i.addCredentialPreferenceToWidget().then(function(){c.getSettingsAndRelSets().then(i._mergeSettings.bind(i)).then(i._parseRelations.bind(i)).then(function(e){o.trackUsage("ProfileUsage",i.currentProfile),i._setPreferences(e)}).then(function(){var t=e.initWithNodes;t&&"[]"!==t&&(0===t.indexOf("[")?t=JSON.parse(t):"string"==typeof t&&(t=[t])),!t&&e.initWithFavorite&&(t=[e.initWithFavorite]),t&&0!==t.length||!i._navigatedNodes||(t=i._navigatedNodes.length?JSON.parse(i._navigatedNodes):t),i.getSelectedSCForFavorites(),t?(i._addRecents(t),i._getValuesForRefresh("favoriteID")?i._openFavorite(t[0]):i._initCollection(e)):i._initCollection(e),i._updateWidgetHeader()})})},function(e){e.showMsg&&i._notifManager.addNotif({level:"error",message:I.get(e.msg),sticky:!0})}),s.setLang(e.lang),s.setLayoutMode(i._getValuesForRefresh("recompute-cb")),void 0!==i._getValuesForRefresh("thumbnails2d-cb")&&s.setThumbnailsMode(i._getValuesForRefresh("thumbnails2d-cb")),void 0!==i._getValuesForRefresh("instances-cb")&&s.setInstancesMode(i._getValuesForRefresh("instances-cb")),void 0!==i._getValuesForRefresh("publications-cb")&&s.setPublicationsMode(i._getValuesForRefresh("publications-cb")),void 0!==i._getValuesForRefresh("ghost-cb")&&s.setGhostMode(i._getValuesForRefresh("ghost-cb")),void 0!==i._getValuesForRefresh("listViewPanelWidth")&&s.setListViewPanelWidth(i._getValuesForRefresh("listViewPanelWidth")),s.setInformationPanelStatus({isInformationPanelVisible:i._getValuesForRefresh("isInformationPanelVisible")}),this._layoutUtils=new u({layoutAxis:s.getLayoutAxis(),layoutDirection:s.getLayoutDirection()})},addCredentialPreferenceToWidget:function(){let e=this;return new i(function(t,i){e._isWebInWin?s._getListOfSecurityContext().then(function(e){s.setXPrefCredential(e[0].value),t()}):S.addCredentialPreferenceToWidget({usePreferredCredentials:!0}).then(function(){let e=widget.getValue("xPref_CREDENTIAL");e||(e=widget.getPreference("xPref_CREDENTIAL").options[0].value,widget.setValue("xPref_CREDENTIAL",e)),s.setXPrefCredential(e),t()})})},getTaggerWebInWin:function(){return this._taggerWIWManager},synchroColorize:function(e){var t,i=this,n={};i.hideSpinner(),(t=this._getLinksIdsToFilter()).length>0?c.getSynchroStatus(t).then(function(t){t&&(n=JSON.parse(t)),e.forColorize=!0,e=i._processSynchroData(e,n),i._navigationMap.colorizeSynchro(e)},function(){i.hideSpinner()}):this._navigationMap.removeLoader()},synchroFiltering:function(e){var t,i=this,n={};i.hideSpinner(),(t=this._getLinksIdsToFilter()).length>0?c.getSynchroStatus(t).then(function(t){t&&(n=JSON.parse(t)),e=i._processSynchroData(e,n),i._navigationMap.filter(e)},function(){i.hideSpinner()}):(this._navigationMap.removeLoader(),this._navigationMap.filter(e))},parseVersionInfo:function(e){var t,i={};return e&&e.results&&e.results.length>0&&e.results.forEach(function(e){if(e.attributes&&e.attributes.length&&e.attributes.length>0){var n;t=e.attributes;for(var s=0;s<t.length;s++)t[s].name&&"resourceid"===t[s].name&&(n=t[s].value),t[s].name&&"ds6wg:PLMReference.V_isLastVersion"===t[s].name&&n&&void 0===i[n]&&(i[n]=t[s].value)}}),i},processVersionInfo:function(e,t){var i=[],n=[],s={excluded:!0,tags:[]};for(var o in e.filteredLinks=[],t)t.hasOwnProperty(o)&&("TRUE"===t[o]?i.push(o):n.push(o));if(e.forColorize)return e.lastVersionNodes=i,e.notLastVersionNodes=n,e;for(var a in e.allfilters)if(e.allfilters.hasOwnProperty(a)){for(var r=0;r<e.allfilters[a].length;r++)if(!e.allfilters[a][r].excluded){s.excluded=!1;break}for(r=0;r<e.allfilters[a].length;r++)("Yes"===e.allfilters[a][r].object||"No"===e.allfilters[a][r].object&&!e.allfilters[a][r].excluded==!s.excluded)&&s.tags.push(e.allfilters[a][r].object)}this.collection.filter(function(e){if("node"===e.get("modelType")){if(i.indexOf(e.id)>-1&&e.get("instancesExpanded")>0&&e.get("instances"))for(r=0;r<e.get("instances").length;r++)i.push(e.get("instances")[r].id);if(n.indexOf(e.id)>-1&&e.get("instancesExpanded")>0&&e.get("instances"))for(r=0;r<e.get("instances").length;r++)n.push(e.get("instances")[r].id)}});for(r=0;r<s.tags.length;r++)"Yes"===s.tags[r]?s.excluded?e.matchingIDs=e.matchingIDs.filter(function(e){return i.indexOf(e)<0}):e.matchingIDs=i.filter(function(t){return e.matchingIDs.indexOf(t)>-1}):"No"===s.tags[r]&&(s.excluded?e.matchingIDs=e.matchingIDs.filter(function(e){return n.indexOf(e)<0}):e.matchingIDs=n.filter(function(t){return e.matchingIDs.indexOf(t)>-1}));return e},versionFiltering:function(e){var t=this;this.getLastVersionInfo().then(function(i){e=t.processVersionInfo(e,t.parseVersionInfo(JSON.parse(i))),t._navigationMap.filter(e)},function(e){t.hideSpinner()})},versionColorize:function(e){var t=this;e.forColorize=!0,this.getLastVersionInfo().then(function(i){e=t.processVersionInfo(e,t.parseVersionInfo(JSON.parse(i))),t._navigationMap.colorizeVersion(e,!1)},function(e){t.hideSpinner()})},_cleanProxy:function(){this._navigationMap&&this._navigationMap.taggerServices&&this._navigationMap.taggerServices.cleanProxy()},_processSynchroData:function(e,t){e.isVolatileData=!0;var i,n=[],s=[],o=[],a=[],r={},l={},d=[],c={excluded:!0,tags:[]};if(!e.forColorize)for(var h in e.allfilters)if(e.allfilters.hasOwnProperty(h)){for(var u=0;u<e.allfilters[h].length;u++)if(!e.allfilters[h][u].excluded){c.excluded=!1;break}for(u=0;u<e.allfilters[h].length;u++)("NotSynchronized"===e.allfilters[h][u].object||"Synchronized"===e.allfilters[h][u].object||"Unknown"===e.allfilters[h][u].object&&!e.allfilters[h][u].excluded==!c.excluded)&&c.tags.push(e.allfilters[h][u].object)}t.outputlist&&t.outputlist.primitives&&(s=t.outputlist.primitives);for(var g=0;g<s.length;g++)"notuptodate"===s[g].stampvalue?n.push(s[g].parentRelationId):"unknown"===s[g].stampvalue?a.push(s[g].parentRelationId):"uptodate"===s[g].stampvalue&&o.push(s[g].parentRelationId);for(g=0;g<s.length;g++)o.indexOf(s[g].parentRelationId)>-1&&(-1!==n.indexOf(s[g].parentRelationId)?(i=o.indexOf(s[g].parentRelationId),o.splice(i,1)):-1!==a.indexOf(s[g].parentRelationId)&&(i=o.indexOf(s[g].parentRelationId),o.splice(i,1))),n.indexOf(s[g].parentRelationId)>-1&&-1!==a.indexOf(s[g].parentRelationId)&&(i=n.indexOf(s[g].parentRelationId),n.splice(i,1));if(e.forColorize)return e.Synchronized=o,e.NotSynchronized=n,e.Unknown=a,e;e.filteredLinks=[];for(u=0;u<c.tags.length;u++)c.excluded?this.collection.filter(function(t){"link"===t.get("modelType")&&("Synchronized"===c.tags[u]&&o.indexOf(t.id)<0&&e.filteredLinks.push(t.id),"NotSynchronized"===c.tags[u]&&n.indexOf(t.id)<0&&e.filteredLinks.push(t.id),"Unknown"===c.tags[u]&&a.indexOf(t.id)<0&&e.filteredLinks.push(t.id))}):"Synchronized"===c.tags[u]?e.filteredLinks=e.filteredLinks.concat(o):"NotSynchronized"===c.tags[u]?e.filteredLinks=e.filteredLinks.concat(n):"Unknown"===c.tags[u]&&(e.filteredLinks=e.filteredLinks.concat(a));return this.collection.filter(function(t){if("link"===t.get("modelType")&&e.filteredLinks.indexOf(t.id)>-1){if(r=t.get("source"),l=t.get("target"),r.id&&d.indexOf(r.id)<0&&(d.push(r.id),r.instancesExpanded>0&&r.instances))for(var i=0;i<r.instances.length;i++)d.push(r.instances[i].id);if(l.id&&d.indexOf(l.id)<0&&(d.push(l.id),l.instancesExpanded>0&&l.instances))for(i=0;i<l.instances.length;i++)d.push(l.instances[i].id)}}),e.matchingIDs&&(e.matchingIDs=d.filter(function(t){return e.matchingIDs.indexOf(t)>-1})),e},getLastVersionInfo:function(){var e=[];return this.collection.filter(function(t){"node"!==t.get("modelType")||t.get("isCount")||e.push(t.get("id"))}),this._navigationMap.listView&&this._navigationMap.listView.models&&Object.keys(this._navigationMap.listView.models).length&&(e=e.concat(Object.keys(this._navigationMap.listView.models))),this._PM.createPromise({url:s.get3DSpaceUrl()+"/cvservlet/fetch/v2?tenant="+s.getCurrentTenantName(),params:{widgetId:this._widgetId,physicalid:e,select_predicate:["ds6wg:PLMReference.V_isLastVersion"]},xPrefCredential:s.getXPrefCredential(),timeout:s.getTimeout()})},_setPreferences:function(e){var t,i={},n=this._autoModeChanged;return i.attributes=this._getAttrForTypes(),i.excludedRelations=[],i.allRelationsMode="AutoModeProfile"===this.currentProfile,e&&(i.widgetId=e),(t=this._initExpandedDirection()).length>0&&(this._currentRelations=t),this._autoNavMode&&(i.excludedRelations=this._getExcludedRelations(),i.excludedRelations.push("v6_structure_roots_from")),n&&!i.allRelationsMode&&(i.relations=this._currentRelations),this._autoModeChanged=!1,c.setPreferences(i)},_getAttrForTypes:function(){var e=s.getDefaultAttributes(),t=[];for(var i in e){if(e.hasOwnProperty(i))e[i].attributes.map(function(e){return e.uri}).forEach(function(e){e&&-1===t.indexOf(e)&&t.push(e)})}return t},_getExcludedRelations:function(){for(var e=[],t=this.autoModeProfile.relations,i=0;i<t.length;i++)-1===this._currentRelations.indexOf(t[i].name)&&e.push(t[i].name);return e},_initCollection:function(e){var t=e.initWithNodes,i=this._navigatedNodes,n=this,o=this._getWidgetValue("ENORIPE_savedColumnIds"),a=e.needClear,r=e.selectedNodes||[];t&&0!==t.length||!i||(t=i.length?i:t),t&&"[]"!==t?(0===t.indexOf("[")?t=JSON.parse(t):"string"==typeof t&&(t=[t]),this.collection||(this.collection=new l([],{widgetId:this._widgetId,layoutUtils:this._layoutUtils,savedColumns:o?JSON.parse(o):null,debugMode:"1"===s.getOption("debug_me")}),this.collection.addEvent("ENORIPE_setSavedColumnIds",this._setWidgetValue.bind(this)),this.collection.addEvent("ENORIPE_noObjectToAdded",function(){n._navigationMap&&n._navigationMap._showNotif({level:"info",lvl:"primary",msg:I.get("ObjectsAlreadyInGraph")})}),this.collection.addEvent("ENORIPE_handleErrorMsgs",function(e){n._navigationMap&&n._navigationMap.handleServerErrorMsgs(e)}),this.collection.addEvent("ENORIPE_someObjectsNotIndex",function(e){n.showMessageNotIndexed(e)}),this.collection.addEvent("ENORIPE_NodesRemoved",function(e,t){if(0===n.collection.length)n.clearMap();else if(n._navigationMap&&n._navigationMap.mapView){if(!0===this._layoutRecomputeReq&&(this._layoutRecomputeReq=!1),this._setColumnOnNodes(),n._navigationMap.mapView.render(n.collection.getLinksAndNodes(),n.collection.groupBy("columnID")),n._navigationMap.removeActions(e),n._navigationMap._continueSearch){var i=n._navigationMap._searchValue;i&&n.onSearch(i)}else n._navigationMap.clearFilterBySearch();n.hideSpinner()}t&&n._navigationMap&&n._navigationMap._showNotif({level:"warning",lvl:"warning",msg:I.get("RemoveWarning")}),n._navigatedNodes=n._navigatedNodes.filter(function(t){return!e.includes(t)})})),this.collection._layoutRecomputeReq=!0,e.needClear||0===this.collection.length?this._getInfosForObjects(t,a,r):(n._initMapView(!1),n._navigationMap.render(n.collection))):(this._isEmpty=!0,this._initMapView(this._isEmpty),this.showHomePage())},_refreshCollection:function(e){if(this._navigationMap&&(this._navigationMap._spinner.show(),e.firedFromWidgetMenu&&(this._navigationMap.refreshMsgPending=!0)),this.collection&&this._navigatedNodes&&this._navigatedNodes.length){this._initCollection({initWithNodes:e.initWithNodes,objectType:e.objecType||null,needClear:e.needClear})}else{if(e.firedFromWidgetMenu)return void(this._navigationMap&&this._navigationMap._spinner.hide());this._initCollection({initWithNodes:e.initWithNodes,objectType:e.objecType||null})}},_setAvailableRelation:function(e){var t=[],i="",n="",s="false";this._availableRelations.forEach(function(e){t.push(e.name)});for(var o=0;o<e.length;o++)-1===t.indexOf(e[o])&&(i=e[o],n="",n=this.currentProfile+":"+i,p.getMainRelName(i),s=e.indexOf(i)>-1?"true":"false",this._saveValuesForRefresh(i,s),this._saveTempPreferences(n,s),this._lastSavedValues[i]=s,this._availableRelations.push({name:i}));p.setAvailableRelations(this._availableRelations)},_initMapView:function(e){var t=this;this._navigationMap?this._navigationMap.refresh({isEmpty:e,collection:this.collection}):(this._navigationMap=new a({addinMode:this._addinMode,collection:this.collection,layoutUtils:this._layoutUtils,autoNavMode:this._autoNavMode,promiseManager:this._PM,countLimit:s.getOption("countLimit"),platformId:s.getPlatformId(),lang:s.getLang(),isEmpty:e,widgetId:this._widgetId,widget:this._widget,lastRootID:this._lastRootID,debugMode:"1"===s.getOption("debug_me"),separator:s.getOption("displayNameSeparator"),nameLabel:s.getOption("displayNameAttributes"),detailLabel1:s.getOption("detailAttributesLevel1"),detailLabel2:s.getOption("detailAttributesLevel2"),preSelectedObjectIds:this._preSelectedObjectIds,inAppOptions:this._inAppOptions,errorOnParseCompassData:this._errorOnParseCompassData}),e&&(this._navigationMap._isEmpty=this._isEmpty),this.collection&&this.collection.addEvent("onSync",function(e,i,n){t._navigationMap&&t._navigationMap.render(e,i,n)}),this._navigationMap.addEvent("ENORIPE_DropByMode",this._dropByMode.bind(this)),this._navigationMap.addEvent("ENORIPE_refreshMap",this._onRefresh.bind(this)),this._navigationMap.addEvent("ENORIPE_ClearMap",this.clearMap.bind(this)),this._navigationMap.addEvent("ENORIPE_SetNavigatedNode",this._setNavigatedIds.bind(this)),this._navigationMap.addEvent("setLastRootNodeID",function(e){t._addRootNode(e,!0)}),this._navigationMap.addEvent("ENORIPE_Customize",this.customize.bind(this)),this._navigationMap.addEvent("ENORIPE_UpdatePrefNodeThumbnail",this._updatePrefNodeThumbnail.bind(this)),this._navigationMap.addEvent("ENORIPE_UpdatePrefRecompute",this._updatePrefRecompute.bind(this)),this._navigationMap.addEvent("ENORIPE_UpdatePrefInstances",this._updatePrefInstances.bind(this)),this._navigationMap.addEvent("ENORIPE_UpdatePrefPublications",this._updatePrefPublications.bind(this)),this._navigationMap.addEvent("ENORIPE_UpdatePrefGhost",this._updatePrefGhost.bind(this)),this._navigationMap.addEvent("ENORIPE_ResizeDialog",t._updateCustomizeDialog.bind(t)),this._navigationMap.addEvent("ENORIPE_ProfileInfo",function(){var e=t._getValuesForProfile("LastUsedProfile");null!==e&&""!==e&&void 0!==e&&(t._navigationMap.lastUsedProfile=e);for(var i=0;i<t._activeProfiles.length;i++)t._navigationMap.profileArray[i]=t._activeProfiles[i].name}),t._navigationMap.addEvent("ENORIPE_updateRelations",t._updateRelations.bind(t)),t._navigationMap.addEvent("ENORIPE_Search",t.onSearch.bind(t)),t._navigationMap.addEvent("ENORIPE_ShowHomePage",t.showHomePage.bind(t)),t._navigationMap.addEvent("ENORIPE_ShowSaveInFavoritesModal",t.showSaveInFavoriteModal.bind(t)),t._navigationMap.addEvent("ENORIPE_HideHomePage",t.hideHomePage.bind(t)),t._navigationMap.addEvent("ENORIPE_createFavorite",t._createFavorite.bind(t)),t._navigationMap.addEvent("ENORIPE_updateFav",t._updateFavorite.bind(t)),this._navigationMap.addEvent("ENORIPE_HideLeftToolBar",function(){t.leftIconBar&&t.leftIconBar.hide()}),this._navigationMap.addEvent("ENORIPE_ShowLeftToolBar",function(){t.leftIconBar&&t.leftIconBar.show()}),t._navigationMap.addEvent("ENORIPE_ShowPreview",function(e){var i={};e.direction&&"WhereUsed"===t.currentProfile&&(e.direction="in"),e.modelId&&c.getEcosystem([e.modelId],{direction:e.direction,responseMode:"objectsByPatterns"}).then(function(n){n=JSON.parse(n),i=t._parseEcosystem(n),t._navigationMap.previewView.setPreview(e.modelId,i)})}),t._navigationMap.addEvent("ColorizeSynchro",function(e){t.synchroColorize(e)}),t._navigationMap.addEvent("ColorizeVersion",function(e){t.versionColorize(e)}),t._navigationMap.addEvent("FilteringSynchro",function(e){t.synchroFiltering(e)}),t._navigationMap.addEvent("FilteringVersion",function(e){t.versionFiltering(e)}),t._navigationMap.addEvent("ENORIPE_ToggleInformationPanel",function(e){t._saveValuesForRefresh("isInformationPanelVisible",e),s.setInformationPanelStatus({isInformationPanelVisible:e})}),t._navigationMap.addEvent("ENORIPE_UpdateAttributes",function(e){t._updatePreferences(e)}),t._navigationMap.addEvent("ENORIPE_ResizeListViewPanel",function(e){e&&this._saveValuesForRefresh("listViewPanelWidth",e)}.bind(this)),t._navigationMap.addEvent("ENORIPE_initExpandNLevel",function(e){t.initExpandNLevel(e)}),t._navigationMap.addEvent("ENORIPE_setExcludeNode",function(e){t.setExcludedNode(e)}),t._navigationMap.addEvent("ENORIPE_SwitchLayout",function(e){e&&t._updateLayoutType(e)}),t._navigationMap.addEvent("ENORIPE_performSearch_native",t.onSearch.bind(t)),t._favData&&(t._navigationMap._isFavOpen=!0,t._navigationMap._favTitle=t._favData.title),this._navigationMap.addEvent("ENORIPE_HideOneDirection",this._hideOneDirection.bind(this)),this._navigationMap.addEvent("ENORIPE_ShowOneDirection",this._showOneDirection.bind(this)),this._navigationMap.addEvent("ExpandOneDirection",function(e){c.getEcosystem(e.ids,{direction:e.direction,trueREST:!0})}.bind(this)),this._navigationMap.addEvent("ENORIPE_noObjectToAdded",function(){t._navigationMap&&t._navigationMap._showNotif({level:"info",lvl:"primary",msg:I.get("ObjectsAlreadyInGraph")})}),this._navigationMap.addEvent("ENORIPE_updateLastRootId",this._updateLastRootID.bind(this)),this.container.setContent(this._navigationMap),this._navigationMap.onResize())},initExpandNLevel:function(e){var t=this,i="";e&&e.selectedNodes&&e.expandNLevelView&&(this.expandNLevelView=e.expandNLevelView,(i=this.expandNLevelView.getExpandSessionId())&&this._setPreferences(i).then(function(){t.expandNLevelView.initModal({selectedNode:e.selectedNodes,expandSessionId:i})}))},_initHomePage:function(){var e=this;this._homePage=new r({addinMode:this._addinMode,collection:this.collection,platformId:s.getPlatformId(),lang:s.getLang(),widgetId:this._widgetId,separator:s.getOption("displayNameSeparator"),nameLabel:s.getOption("displayNameAttributes"),detailLabel1:s.getOption("detailAttributesLevel1"),detailLabel2:s.getOption("detailAttributesLevel2"),debugMode:"1"===s.getOption("debug_me")}).inject(this.container),e._homePage.addEvent("ENORIPE_HandleRecents",e._handleRecents.bind(e)),e._homePage.addEvent("ENORIPE_HandleFavorite",e._handleFavorites.bind(e)),e._homePage.addEvent("ENORIPE_OpenRelExp",e._openRelExp.bind(e)),e._homePage.addEvent("ENORIPE_drop",e._handleDropFromHomePage.bind(e)),e._homePage.addEvent("ENORIPE_showNotif",function(t){e._navigationMap._showNotif(t)}),e._homePage.addEvent("ENORIPE_dropNotSupported",function(){e._navigationMap._showNotif({level:"error",msg:I.get("dropNotSupported")})})},showHomePage:function(){this._homePage||this._initHomePage(),this.leftIconBar&&this.leftIconBar.elements.container.addClassName("displaynone"),this._navigationMap&&this._navigationMap._onHide(),this._homePage.render(),this._isHomePageVisible=!0,this.clearMap()},hideHomePage:function(){this._homePage&&(this._homePage.hide(),this._homePage.clearContent(),this._isHomePageVisible=!1),this.leftIconBar&&this.leftIconBar.elements.container.removeClassName("displaynone"),this._navigationMap&&this._navigationMap._onShow()},_handleDropFromHomePage:function(e,t){this._navigationMap&&(this._navigationMap._onShow(),this._navigationMap._handleDrop(e,t),this._isHomePageVisible=!1)},_handleRecents:function(){var e=this,t=this._getRecents();0===t.length?e._homePage.showEmptyView("Recents"):(this._homePage.mask(),c.getEcosystem(t,{restrictedMode:!0}).then(function(t){t&&e._homePage.showObjects(JSON.parse(t))},function(t){console.log(t),e._homePage.unmask()}))},_isFavorite:function(e){var t=this;return new i(function(i,n){t.getSelectedSCForFavorites().then(function(t){c.isFavorite(t,e).then(function(e){e?(e=JSON.parse(e),i(e.isFavorite)):n()},function(){n()})},function(e){n()})})},_openFavorite:function(e){var t=this;this.getSelectedSCForFavorites().then(function(i){c.getFavoriteInfo(i,e).then(t._renderFavoriteData.bind(t))})},_addFavoriteData:function(e){var t=this;this.getSelectedSCForFavorites().then(function(i){c.getFavoriteInfo(i,e).then(function(e){if(e){e=JSON.parse(e);var i=[];e.favorite[0].rootPhysicalIds.forEach(function(e){i.push({objectId:e})}),t._dropAdd(i)}})})},_renderFavoriteData:function(e){if((e=JSON.parse(e))&&e.favorite&&e.favorite.length>0){var t={},i=e.favorite[0];if(t.element={},t.element.preferences=i.preferences,t.element.profilename=i.profilename,t.element.rootPhysicalIds=i.rootPhysicalIds,this._openRelExpFavInit(t),i.title&&""!=i.title){if(this._saveValuesForRefresh("favoriteID",i.id),this._favData={name:i.favoriteName,title:i.title},this._navigationMap){this._navigationMap._onShow(),this._isHomePageVisible=!1;var n=document.querySelector(".Enoripe-FavoriteText");("ENORelationalExplorerFavorite"===e.type||i&&i.title)&&(n&&n.setContent(i.title),this._navigationMap._isFavOpen=!0,this._navigationMap._favTitle=i.title)}}else this._saveValuesForRefresh("favoriteID",null)}},_handleFavoritesDrop:function(e,t){"add"===e?this._isEmpty?this._openFavorite(t.objectId):this._addFavoriteData(t.objectId):"replace"===e&&this._openFavorite(t.objectId)},showSaveInFavoriteModal:function(){if(!this.saveFavoriteModal){this.saveFavoriteModal=new m({className:"modal-saveFavorite",closable:!0,header:'<h4 class="title">'+I.get("SNNavigationMap.SaveFavoriteModal.Title")+"</h4>",body:"<p>"+I.get("SNNavigationMap.SaveFavoriteModal.BodyIntroduction")+'</p><p class="question">'+I.get("SNNavigationMap.SaveFavoriteModal.BodyQuestion")+"</p>",events:{onHide:function(){}.bind(this)}}).inject(this.container);var e=t.createElement("div",{class:"actionButton-container"});new v({value:I.get("save"),className:"primary save",events:{onClick:function(){this._navigationMap.handleFavorite(!0),this.saveFavoriteModal.hide()}.bind(this)}}).inject(e),new v({value:I.get("dontSave"),className:"default dont-save",events:{onClick:function(){this.showHomePage(),this.saveFavoriteModal.hide()}.bind(this)}}).inject(e),new v({value:I.get("cancel"),className:"default cancel",events:{onClick:function(){this.saveFavoriteModal.hide()}.bind(this)}}).inject(e),this.saveFavoriteModal.setFooter(e)}this.saveFavoriteModal.show()},_handleFavorites:function(e){var t=this;this._homePage.mask(),this.getSelectedSCForFavorites().then(function(e){return c.getFavorites(e)}).then(function(i){(i=JSON.parse(i))&&i.favorite.length>0?t._homePage.showFavorites(i):e?t._homePage.changeTab(e):(t._homePage.showFavorites(i),console.log("info data not found"),t._homePage.unmask())},function(e){console.log(e),t._homePage.clearContent(),t._homePage.unmask()})},_openRelExp:function(e){this.showSpinner(),this._cleanProxy(),e.name&&"ENORelationalExplorerFavorite"===e.type?this._openRelExpFav(e):(this._addRootNode([e.id],!0),this._addRootNode([e.id]),this._onRefresh({initWithNodes:[e.id],needClear:!0})),this.updateFavTitle(e)},updateFavTitle:function(e){var t=document.querySelector(".Enoripe-FavoriteText");"ENORelationalExplorerFavorite"===e.type&&e.title?(this._saveValuesForRefresh("favoriteID",e.id),this._navigationMap&&(this._navigationMap._onShow(),this._isHomePageVisible=!1,this._favData=e,this._navigationMap._isFavOpen=!0,this._navigationMap._favTitle=e.title,t&&t.setContent(e.title))):(this._saveValuesForRefresh("favoriteID",null),this._navigationMap&&t&&t.setContent(""),this._navigationMap._isFavOpen=!1)},_openRelExpFav:function(e){var t=e.element.preferences,i=!0,n=e.element.profilename,s=!1;e.element.excludedIds&&this.setExcludedNode(e.element.excludedIds),n!==this.currentProfile&&(s=!0),s?this._openRelExpFavInit(e):(i=!t.equals(this._currentRelations),e.layoutType&&this._updateLayoutType(e.layoutType),e.rootIds&&e.rootIds.length>0&&this._addRootNode(e.rootIds,!0),i?this._onRefresh({initWithNodes:e.element.rootPhysicalIds,newRelations:t}):this._onRefresh({initWithNodes:e.element.rootPhysicalIds,needClear:!0}))},_openRelExpFavInit:function(e){var t=this,i=e.element.preferences,n=e.element.profilename;this._saveValuesInSession("LastUsedProfile",n),this.currentProfile=n,this._updateWidgetHeader(),this._customizeView&&this._customizeView.handleProfileChange(null,n),this.collection&&i&&this._setAvailableRelation(i),this._currentRelations=i,s.setOption("currentRelations",this._currentRelations),"AutoModeProfile"===n?(this._autoNavMode=!0,this._autoModeChanged=!0):this._autoNavMode=!1,e.layoutType&&this._updateLayoutType(e.layoutType),e.rootIds&&e.rootIds.length>0&&this._addRootNode(e.rootIds),this._setPreferences().then(function(){t._initCollection({initWithNodes:e.element.rootPhysicalIds,objectType:null,needClear:!0})})},_createFavorite:function(e,t){var i,n=this;i={title:e.inputval,ids:this._navigatedNodes,preferences:this._currentRelations,profilename:this.currentProfile,excludedIds:this.excludedNodeIds,rootIds:this._lastRootID},this.setSelectedSCForFavorites(e.securitycontext),o.trackUsage("Favorite","Favorite-CreateFav"),c.createFavorite(e.securitycontext,i).then(function(e){var i=JSON.parse(e).favorite[0];if(i){n._navigationMap._showNotif({level:"info",lvl:"primary",msg:i.title+" "+I.get("FavoriteSuccess")});e={id:i.id,name:i.favoriteName,element:i,type:"ENORelationalExplorerFavorite",title:i.title};t?n.showHomePage():n.updateFavTitle(e)}})},_updateFavorite:function(e){var t,i=this;t={favoriteName:this._favData.name,title:this._favData.title,ids:this._navigatedNodes,preferences:this._currentRelations,profilename:this.currentProfile,excludedIds:this.excludedNodeIds,rootIds:this._lastRootID},this.showSpinner(),this._favData&&this._favData.name&&(o.trackUsage("Favorite","Favorite-UpdateFav"),this.getSelectedSCForFavorites().then(function(n){c.updateFavorite(n,t).then(function(t){i.hideSpinner();var n=JSON.parse(t);n&&i._navigationMap._showNotif({level:"info",lvl:"primary",msg:n.favorite[0].title+" "+I.get("FavoriteUpdate")}),e&&i.showHomePage()},function(){i.hideSpinner()})}))},getSelectedSCForFavorites:function(){var e=this;return new i(function(t,i){e._selectedSCForFav?t(e._selectedSCForFav):s._getListOfSecurityContext().then(function(n){let s=e.getKeyForSCFav(),o=!1,a=e._getValuesInSession(s);if(a)for(let e=0;e<n.length;e++)if(a===n[e].value){o=!0;break}o||(a=n[0].value),a?(e.setSelectedSCForFavorites(a),t(e._selectedSCForFav)):i()})})},getKeyForSCFav:function(){return(s.getUserID()||"defaultUserID")+"-selectedSCForFav"},setSelectedSCForFavorites:function(e){let t=this.getKeyForSCFav();this._selectedSCForFav=e,this._saveValuesInSession(t,e),s.setOption("selectedSCForFav",e)},customize:function(e){var t,i=this,n=s.getOption("noautomode");if(!this._customizeView){this._navigationMap&&this._navigationMap.addLoader();var o,a=this._getValuesForProfile("LastUsedProfile"),r=[];null!==a&&""!==a&&void 0!==a&&(o=a),n&&"AutoModeProfile"===o&&(o=i._activeProfiles[1].name,this._saveValuesInSession("LastUsedProfile",o));for(var l=0,d=0;d<i._activeProfiles.length;d++)if(n&&"AutoModeProfile"===i._activeProfiles[d].name)i._autoNavMode=!1;else{var c=i._activeProfiles[d].type,h=i._activeProfiles[d].nls;i._activeProfiles[d].custom&&(c="custom",h=i._activeProfiles[d].nlsLabel),r[l]={name:i._activeProfiles[d].name,type:c,nls:h},l++}var u=this._groupedRelations;this._autoNavMode&&(t=this._getRelForAutoMode(this._groupedRelations),u=t.present),require(["DS/SNNavigationMap/views/CustomizeView"],function(n){var a={settings:u,notPresentRelations:i._autoNavMode?t.notPresent:[],title:I.get("SNNavigationMap.Customize.Title"),needTranslate:i.isGrouping,currentProfile:i.currentProfile,thumbnails2d:"thumbnailsMode"===s.getThumbnailsMode(),recomputeLayout:"recompute"===s.getLayoutMode(),autoNav:i._autoNavMode,lastUsedProfile:o,profileArray:r,recentProfiles:i.getRecentRelationSet(),lang:s.getLang()};i._customizeView=new n(a),i._customizeView.addEvent("ENORIPE_updatePref",i._updatePreferences.bind(i)),i._customizeView.addEvent("ENORIPE_updateRelations",i._updateRelations.bind(i)),i._customizeView.addEvent("ENORIPE_CreateNewProfile",i._createNewProfile.bind(i)),i._customizeView.addEvent("ENORIPE_SaveNewProfile",i._createNewProfile.bind(i)),i._customizeView.addEvent("ENORIPE_DeleteProfile",i._deleteProfile.bind(i)),i._customizeView.addEvent("ENORIPE_UpdateLUP",function(e){e&&i._saveValuesInSession("LastUsedProfile",e)}),i._customizeView.addEvent("ENORIPE_SetRecentRelationSet",i.setRecentRelationSet.bind(i)),i._customizeView.inject(i.container),i._initCustomizeView(e)})}this._customizeView&&null===this._customizeView._dialog&&!e?this._initCustomizeView(e):this._customizeView&&null!==this._customizeView._dialog&&this._customizeView.destroyCurrentDialog()},_initCustomizeView:function(e){var t={},i={};if(this._customizeView&&null===this._customizeView._dialog&&!e){for(var n=0;n<this._activeProfiles.length;n++)this._activeProfiles[n].name===this.currentProfile&&(this._availableRelations=this._activeProfiles[n].relations,this._splitRelations(this._activeProfiles[n].relations));this._autoNavMode&&(i=this._getRelForAutoMode(this._groupedRelations),t.settings=i.present,t.notPresentRelations=i.notPresent),this._customizeView.show(),this._customizeView.render(t)}this._navigationMap&&this._navigationMap.removeLoader()},_updateCustomizeDialog:function(){this._customizeView&&this._customizeView.updateDialogSizeOnResize()},_updateRelations:function(e){this._autoNavMode=!(!e||"AutoModeProfile"!==e);for(var t=0;t<this._activeProfiles.length;t++)if(this._activeProfiles[t].name===e){this.currentProfile=e,this._availableRelations=this._activeProfiles[t].relations,this._splitRelations(this._activeProfiles[t].relations),this._customizeView&&(this._customizeView.currentProfile=e);var i,n=this._groupedRelations;if(this._autoNavMode){var s=this._getRelForAutoMode(this._groupedRelations);n=s.present,i=s.notPresent}this._customizeView&&this._customizeView.showRelation(n,this.isGrouping,i);break}},_getLinksIdsToFilter:function(e){var t=[];return e?t=this._navigationMap.mapView.filteredLinksByFilter?this._navigationMap.mapView.filteredLinksByFilter:t:this.collection.filter(function(e){"link"===e.get("modelType")&&t.push(e.get("id"))}),t},getLastVersionInfo:function(){var e=[];return this.collection.filter(function(t){"node"===t.get("modelType")&&e.push(t.get("id"))}),this._navigationMap.listView&&this._navigationMap.listView.models&&Object.keys(this._navigationMap.listView.models).length&&(e=e.concat(Object.keys(this._navigationMap.listView.models))),this._PM.createPromise({url:s.get3DSpaceUrl()+"/cvservlet/fetch/v2?tenant="+s.getCurrentTenantName(),params:{widgetId:this._widgetId,physicalid:e,select_predicate:["ds6wg:PLMReference.V_isLastVersion"]},xPrefCredential:s.getXPrefCredential(),timeout:s.getTimeout()})},_getInfosForObjects:function(e,t,i){var n=this;this.collection.reset(),n.collection.updateColumnId=!0,n._initMapView(!1),this.collection.getEcoSystem({ids:e,restrictedMode:!0}).then(function(){let e=this.collection.getNodesIds();n._isEmpty=0===n.collection.length,n._navigationMap&&(n._navigationMap._isEmpty=n._isEmpty),e.length>0?(n._navigationMap._manageFirstFocusAndAnchor(i),n._navigatedNodes=e,n._setWidgetValue("ENORIPE_navigatedNodes",e)):n.hideSpinner()}.bind(this))},_getGrantedUsrGrp:function(){var e=this;return new i(function(t,i){if(s.getOption("user_granted_groups"))t(s.getOption("user_granted_groups"));else{var n={},o=s.get3DSearchUrl()+"/search",a=s.getUserID();n.label="ENORIPE_"+a+"_"+Date.now(),n.select_predicate=["ds6w:label"],n.query="[ds6w:type]:GROUP AND "+a,n.tenant=s.getCurrentTenantName(),n.nresults=100,n.with_synthesis_attribute=!1,n.with_synthesis=!1,n=JSON.stringify(n),_.authenticatedRequest(o,{headers:{Accept:"application/json","Content-Type":"application/json"},method:"POST",data:n,onComplete:function(i){var n=e._parseUserGroups(JSON.parse(i));s.setOption("user_granted_groups",n),t(n)},onFailure:function(e){console.log("failed in fetching granted usrgrps"+e),t([])},onTimeout:function(e){console.log("failed in fetching granted usrgrps"+e),t([])}})}})},_processSynchroData:function(e,t){var i,n=[],s=[],o=[],a=[],r={},l={},d=[],c={excluded:!0,tags:[]};if(!e.forColorize)for(var h in e.allfilters)if(e.allfilters.hasOwnProperty(h)){for(var u=0;u<e.allfilters[h].length;u++)if(!e.allfilters[h][u].excluded){c.excluded=!1;break}for(u=0;u<e.allfilters[h].length;u++)("NotSynchronized"===e.allfilters[h][u].object||"Synchronized"===e.allfilters[h][u].object||"Unknown"===e.allfilters[h][u].object&&!e.allfilters[h][u].excluded==!c.excluded)&&c.tags.push(e.allfilters[h][u].object)}t.outputlist&&t.outputlist.primitives&&(s=t.outputlist.primitives);for(var g=0;g<s.length;g++)"notuptodate"===s[g].stampvalue?n.push(s[g].parentRelationId):"unknown"===s[g].stampvalue?a.push(s[g].parentRelationId):"uptodate"===s[g].stampvalue&&o.push(s[g].parentRelationId);for(g=0;g<s.length;g++)o.indexOf(s[g].parentRelationId)>-1&&(-1!==n.indexOf(s[g].parentRelationId)?(i=o.indexOf(s[g].parentRelationId),o.splice(i,1)):-1!==a.indexOf(s[g].parentRelationId)&&(i=o.indexOf(s[g].parentRelationId),o.splice(i,1))),n.indexOf(s[g].parentRelationId)>-1&&-1!==a.indexOf(s[g].parentRelationId)&&(i=n.indexOf(s[g].parentRelationId),n.splice(i,1));if(e.forColorize)return e.Synchronized=o,e.NotSynchronized=n,e.Unknown=a,e;e.filteredLinks=[];for(u=0;u<c.tags.length;u++)c.excluded?this.collection.filter(function(t){"link"===t.get("modelType")&&("Synchronized"===c.tags[u]&&o.indexOf(t.id)<0&&e.filteredLinks.push(t.id),"NotSynchronized"===c.tags[u]&&n.indexOf(t.id)<0&&e.filteredLinks.push(t.id),"Unknown"===c.tags[u]&&a.indexOf(t.id)<0&&e.filteredLinks.push(t.id))}):"Synchronized"===c.tags[u]?e.filteredLinks=e.filteredLinks.concat(o):"NotSynchronized"===c.tags[u]?e.filteredLinks=e.filteredLinks.concat(n):"Unknown"===c.tags[u]&&(e.filteredLinks=e.filteredLinks.concat(a));return this.collection.filter(function(t){if("link"===t.get("modelType")&&e.filteredLinks.indexOf(t.id)>-1){if(r=t.get("source"),l=t.get("target"),r.id&&d.indexOf(r.id)<0&&(d.push(r.id),r.instancesExpanded>0&&r.instances))for(var i=0;i<r.instances.length;i++)d.push(r.instances[i].id);if(l.id&&d.indexOf(l.id)<0&&(d.push(l.id),l.instancesExpanded>0&&l.instances))for(i=0;i<l.instances.length;i++)d.push(l.instances[i].id)}}),e.matchingIDs&&(e.matchingIDs=d.filter(function(t){return e.matchingIDs.indexOf(t)>-1})),e},_parseRelations:function(e){if(e){var t=this,n="AutoModeProfile",o=e.profiles[0],a=this._getValuesForProfile("LastUsedProfile");this.autoModeProfile&&e.profiles.unshift(this.autoModeProfile);var r=this._getRelationsSet();if(r)for(var l=0;l<r.length;l++)e.profiles.splice(l+1,0,r[l]);n=null!==a&&""!==a&&void 0!==a?a:this._settings.relation_apps.ENORIPE_AP,this.currentProfile=e.profiles[0].name,this._activeProfiles=e.profiles,s.getOption("noautomode")&&(n=e.profiles[1].name,this.currentProfile=e.profiles[1].name,this._autoNavMode=!1);for(var d=0;d<e.profiles.length;d++)if(n===e.profiles[d].name){o=e.profiles[d],this.currentProfile=e.profiles[d].name;break}return"AutoModeProfile"===this.currentProfile?this._autoNavMode=!0:this._autoNavMode=!1,new i(function(e,i){o?(t._availableRelations=o.relations,t._splitRelations(o.relations),t._setAvailableRelation(t._currentRelations),e()):i()})}},_parsePatterns:function(e){if(e){var t=JSON.parse(e);this.autoModeProfile={name:"AutoModeProfile"},this.autoModeProfile.relations=t.patterns?t.patterns:[];for(var n=this.autoModeProfile.relations.length;n--;)this.autoModeProfile.relations[n].name.contains("v6_structure_roots")&&(console.log("rel removed "+this.autoModeProfile.relations[n].name),this.autoModeProfile.relations.splice(n,1));return new i(function(e,t){e()})}},_mergeSettings:function(e){if(e&&e[1]&&e[2]){this._parsePatterns(e[1]);var t=JSON.parse(e[2]),n=s.getRoles(),o=this,a=!1;return o._settings=e[0],new i(function(e,i){o._settings.relation_sets||e(t),0===Object.keys(o._settings.relation_sets).length&&e(t);t.profiles.map(function(e){return e.name});for(var s=0;s<o._settings.relation_sets.length;s++){for(var r=o._settings.relation_sets[s].roles,l=o._settings.relation_sets[s].userGroups,d=!1,c=0;c<r.length;c++)if(n.indexOf(r[c])>-1){d=!0;break}if(l.length>0&&!d){a=!0;break}}a?o._getGrantedUsrGrp().then(function(i){t=o._filterRelSets(t,i),e(t)}):(t=o._filterRelSets(t,[]),e(t))})}},_filterRelSets:function(e,t){var i=s.getRoles(),n=this._getValuesForProfile("LastUsedProfile"),o=e.profiles.map(function(e){return e.name});t=t.map(function(e){return e.resourceid});if(o.indexOf(n)){let t=o.indexOf(n);if(t>-1&&e.profiles[t].applications&&e.profiles[t].applications.length>0){e.profiles[t].applications.map(function(e){return e.name}).indexOf(s.getAppId())<0&&(e.profiles.splice(t,1),this._saveValuesInSession("LastUsedProfile","AutoModeProfile"))}}for(var a=0;a<this._settings.relation_sets.length;a++){var r=this._settings.relation_sets[a].roles,l=this._settings.relation_sets[a].userGroups,d=this._settings.relation_sets[a].applications,c=!1;r&&r.length>0&&(r=r.map(function(e){return e.name})),l&&l.length>0&&(l=l.map(function(e){return e.name}));for(var h=0;h<r.length;h++)if(i.indexOf(r[h])>-1){c=!0;break}if(!c)for(h=0;h<l.length;h++)if(t.indexOf(l[h])>-1){c=!0;break}var u=o.indexOf(this._settings.relation_sets[a].name);if(c){if(-1===u?e.profiles.push(this._settings.relation_sets[a]):e.profiles.splice(u,1,this._settings.relation_sets[a]),d.length>0&&(d=d.map(function(e){return e.name})).indexOf(s.getAppId())<0){u=o.indexOf(this._settings.relation_sets[a].name);e.profiles.splice(u,1),n===this._settings.relation_sets[a].name&&this._saveValuesInSession("LastUsedProfile","AutoModeProfile")}}else-1!==u&&e.profiles.splice(u,1)}return e},_parseEcosystem:function(e){var t={};if(e)for(var i in t=e.objectsByPatterns)t[I.get(i)]=t[i],delete t[i];return t},_parseUserGroups:function(e){var t=[];if(e.results)for(var i=0;i<e.results.length;i++){var n=e.results[i];if(n.attributes){for(var s={},o=0;o<n.attributes.length;o++)"resourceid"===n.attributes[o].name&&(s.resourceid=n.attributes[o].value),"ds6w:label"===n.attributes[o].name&&(s.label=n.attributes[o].value);void 0!==s.resourceid&&t.push(s)}}return t},_getValuesForRefresh:function(e){var t;if(e&&(e+="-ENORIPE_AP",t=widget?widget.getValue(e):localStorage.getItem(e)))return JSON.parse(t)},_saveValuesForRefresh:function(e,t){e&&(e+="-ENORIPE_AP"),t=JSON.stringify(t),e&&t&&(widget?widget.setValue(e,t):localStorage.setItem(e,t))},_getValuesInLocalStorage:function(e){var t;if(e&&(e+="-ENORIPE_AP",t=localStorage.getItem(e)))return JSON.parse(t)},_saveValuesInLocalStorage:function(e,t){e&&(e+="-ENORIPE_AP"),t=JSON.stringify(t),e&&t&&localStorage.setItem(e,t)},_saveValuesInSession:function(e,t){this._isWebInWin?localStorage.setItem(e,t):this._widget&&(this._widget.setValue(e,t),localStorage.setItem(e,t)),s.setOption(e,t)},_getValuesInSession:function(e){var t;!this._isWebInWin&&(!!this._widgetId&&this._widgetId.contains("preview"));if(this._widget&&(t=this._widget.getValue(e)),t&&this._widget||(t=localStorage.getItem(e)),t)return t},_getWidgetValue:function(e){if(this._widget)return this._widget.getValue(e)},_setWidgetValue:function(e,i){this._widget&&(i=t.is(i,"string")?i:JSON.stringify(i),this._widget.setValue(e,i))},_saveTempPreferences:function(e,t){e&&t&&(this._tempPreferences[e]=t)},_getTempPreferences:function(e){if(this._tempPreferences){var t=this._tempPreferences[e];if(t)return t}},_getRelationsSet:function(){var e=localStorage.getItem(s.getUserID()+"_ENORIPE_CustomRelationsSet");if(e)return JSON.parse(e)},_setRelationSet:function(e){var t=s.getUserID()+"_ENORIPE_CustomRelationsSet",i=(JSON.stringify(e),null),n=localStorage.getItem(t),o=!1;if(n){i=JSON.parse(n);for(var a=0;a<i.length;a++)e.name===i[a].name&&(i[a].relations=e.relations,o=!0);o||i.push(e)}else(i=[]).push(e);localStorage.setItem(t,JSON.stringify(i))},getRecentRelationSet:function(){var e=localStorage.getItem(s.getUserID()+"_ENORIPE_RecentRelationsSet");if(e)return JSON.parse(e)},setRecentRelationSet:function(e){var t=s.getUserID()+"_ENORIPE_RecentRelationsSet",i=[],n=null;e.forEach(function(e){n={name:e._options.data.name,type:e._options.data.type,selectable:e._options.data.selectable,isRecent:e._options.data.isRecent,nls:e.getLabel()},e._options.comboBoxSemantics&&(n.comboBoxSemantics=e._options.comboBoxSemantics),e._options.data.nls&&(n.nls=e._options.data.nls),i.push(n)}),localStorage.setItem(t,JSON.stringify(i))},onSearch:function(e){var t=this;if(this._isHomePageVisible)this._navigationMap&&this._navigationMap._showNotif({level:"error",lvl:"error",msg:I.get("SearchCurrentTabHomepageErr"),container:this._homePage.container});else if(void 0!==this.collection&&null!==this.collection){void 0===this._searchUtils&&(this._searchUtils=new g({debug:!1,isWebInWin:this._isWebInWin}));var i=[];if(this._navigationMap._isPreviewPanelOpen?(i=this._navigationMap.previewView.getFilteredIds(),this._navigationMap.previewView._showLoading()):(this.showSpinner(),this.collection.filter(function(e){"node"===e.get("modelType")&&(t._navigationMap._isFiltered?-1!==t._navigationMap._currentlyFilteredNodes.indexOf(e.get("id"))&&i.push(e.get("id")):i.push(e.get("id")))})),e&&i.length>0){var n={};n.ids=i,n.value=e,n.url=s.get3DSearchUrl()+"/search",n.tenantName=s.getCurrentTenantName(),n.locale=s.getLang(),this._searchUtils._searchCall(n).then(function(i){var n=JSON.parse(i);if(n&&void 0!==n.results&&n.infos&&n.infos.nresults>0){var s=t._processSearchResult(n.results);t._navigationMap.filterBySearch(s)}else t._navigationMap.filterBySearch([]);t._navigationMap._searchValue=e,t.hideSpinner(),t._navigationMap.previewView&&t._navigationMap.previewView._hideLoading()},function(){t.hideSpinner(),t._navigationMap.previewView&&t._navigationMap.previewView._hideLoading()})}}},_processSearchResult:function(e){var t=[],i=[];return e.forEach(function(e){if(e.attributes){i=e.attributes;for(var n=0;n<i.length;n++)if("resourceid"===i[n].name){t.push(i[n].value);break}}}),t},onResetSearch:function(){this._navigationMap&&this._navigationMap.clearFilterBySearch()},_updatePrefNodeThumbnail:function(e){void 0!==e&&(s.setThumbnailsMode(e),this._saveValuesForRefresh("thumbnails2d-cb",e),this._navigationMap.switchThumbnailsMode(s.getThumbnailsMode()))},_updatePrefRecompute:function(e){void 0!==e&&(s.setLayoutMode(e),!0===e&&(this.collection._setColumnOnNodes(),this._navigationMap.mapView.render(this.collection.getLinksAndNodes(),this.collection.groupBy("columnID"))))},_updatePrefInstances:function(e){void 0!==e&&(s.setInstancesMode(e),this._saveValuesForRefresh("instances-cb",e))},_updatePrefPublications:function(e){void 0!==e&&(s.setPublicationsMode(e),this._saveValuesForRefresh("publications-cb",e)),this._onRefresh({initWithNodes:this._navigatedNodes,needClear:!0})},_updatePrefGhost:function(e){void 0!==e&&(s.setGhostMode(e),this._saveValuesForRefresh("ghost-cb",e)),this._onRefresh({initWithNodes:this._navigatedNodes,needClear:!0})},_updateLastRootID:function(e){this._lastRootID=e,this._navigationMap&&(this._navigationMap._lastRootID=e),s.setRootIds(e),this._saveValuesForRefresh("lastRootNodeID",e)},_updateLayoutType:function(e){e&&(s.setLayoutType(e),this._navigationMap._currentLayout=e,this._saveValuesInSession("layoutType",e),this._navigationMap._toolBarView&&this._navigationMap._toolBarView.updateLayout(),this.container.className.includes("mode-")?this.container.className=this.container.className.replace(/mode-\w*/,"mode-"+e):this.container.addClassName("mode-"+e))},_updateWidgetHeader:function(){if(!this._isWebInWin&&widget){var e;if(I[this.currentProfile])e=I[this.currentProfile];else for(var t=0;t<this._activeProfiles.length;t++)if(this._activeProfiles[t].name===this.currentProfile){e=this._activeProfiles[t].nlsLabel||I.get(this.currentProfile);break}widget.setTitle(e+" ("+s.getCurrentTenantLabel()+")")}},setExcludedNode:function(e){e&&0!==e.length?(this.excludedNodeIds=this._getValuesForRefresh("excludedNodes")?this._getValuesForRefresh("excludedNodes"):[],this.excludedNodeIds=this.excludedNodeIds.concat(e.filter(function(e){return this.excludedNodeIds.indexOf(e)<0}.bind(this))),this._navigatedNodes=this._navigatedNodes.filter(function(e){return!this.excludedNodeIds.includes(e)}.bind(this))):this.excludedNodeIds=[],this._saveValuesForRefresh("excludedNodes",this.excludedNodeIds)},_changePlatformSL:function(e){s.setCurrentTenant(e),this._getWidgetValue("selected_tenant")!==e&&this._setWidgetValue("selected_tenant",e),this._updateWidgetHeader(),this._navigationMap&&this._navigationMap._showNotif({level:"warning",lvl:"warning",msg:I.get("PlatformChangesTo")+" "+e})},_addRootNode:function(e,t){var i=this._getValuesForRefresh("lastRootNodeID")||[],n=[];if(t)i=e;else for(var s=0;s<e.length;s++)i.indexOf(e[s])<0&&i.push(e[s]),this.collection&&this._navigatedNodes.indexOf(e[s])<0&&this.collection.get(e[s])&&n.push(this.collection.get(e[s]));this._updateLastRootID(i),n.length>0&&this._setNavigatedIds(n,!0)},addToRecents:function(e){var t=[];"string"==typeof e?t.push(e):t=e,this._addRecents(t)},_addRecents:function(e){var t,i,n=s.getUserID()+"_Recents",o=localStorage.getItem(n);t=o?JSON.parse(o):[];for(var a=0;a<e.length;a++)-1===t.indexOf(e[a])?t.push(e[a]):(i=t.indexOf(e[a]),t.splice(i,1),t.push(e[a])),t.length>10&&t.shift();localStorage.setItem(n,JSON.stringify(t))},_setNavigatedIds:function(e,t){if(t||(this._navigatedNodes=[]),"string"==typeof e)this._navigatedNodes.indexOf(e)<0&&this._navigatedNodes.push(e);else for(var i=0;i<e.length;i++)this._navigatedNodes.indexOf(e[i].id)<0&&this._navigatedNodes.push(e[i].id);this._setWidgetValue("ENORIPE_navigatedNodes",this._navigatedNodes)},_createNewProfile:function(e){if(e){e.name;var t=!1;this._setRelationSet(e),this.currentProfile=e.name;for(var i=this._activeProfiles,n=0;n<i.length;n++)i[n].name===e.name&&(this._activeProfiles[n].relations=e.relations,t=!0);t||this._activeProfiles.splice(1,0,e)}},_deleteProfile:function(e,t){var i,n=s.getUserID()+"_ENORIPE_CustomRelationsSet",o=localStorage.getItem(n);if(o){for(var a=i=JSON.parse(o),r=0;r<a.length;r++)a[r].name===e&&i.splice(r,1);localStorage.setItem(n,JSON.stringify(i));for(var l=this._activeProfiles,d=0;d<l.length;d++)l[d].name===e&&this._activeProfiles.splice(d,1);this.currentProfile=t,this._saveValuesInSession("LastUsedProfile",t)}},_getRelForAutoMode:function(e){var t=[],i={};this.collection&&this.collection.filter(function(e){if("link"===e.get("modelType")){var i=e.get("type");-1===t.indexOf(i)&&t.push(i)}});var n=this._sortGroupedRel(e),s={};for(var o in e)if(e.hasOwnProperty(o))for(var a=0;a<e[o].length;a++)for(var r=0;r<t.length;r++)if(e[o][a].id.contains(t[r])){e[o][a].present=!0,0,s[o]=e[o],delete n[o];break}return i.present=s,i.notPresent=n,i},_sortGroupedRel:function(e){if(e){var t={},i=[];for(var n in e)i.push([e[n].nlsLabel,n]);i.sort(function(e,t){var i=e[0].toLowerCase(),n=t[0].toLowerCase();return i<n?-1:i>n?1:0});for(var s=0;s<i.length;s++){var o=i[s][1];t[o]=e[o]}return t}},_splitRelations:function(e){var i,n,o,a={},r=!1,l={},d=[],c="",h=!1,u=!1,g="",m={},f=[];this.isGrouping=!1,e.forEach(function(e){f.push(e.name)});for(var v=0;v<e.length;v++){if(g="",n=e[v].name,g=this.currentProfile+":"+n,c=p.getMainRelName(n),void 0===this._getTempPreferences(g))i=!0;else{var _=this._getTempPreferences(g);"true"===_?_=!0:"false"===_&&(_=!1),i=_}!1===this.isGrouping&&(h=-1!==f.indexOf(c.concat("_to")),u=-1!==f.indexOf(c.concat("_from")),h&&u&&(this.isGrouping=!0)),e[v].showdetail&&"done"!==m[c]&&(m[c]="done",r=void 0!==this._getTempPreferences(this.currentProfile+":details_"+c)&&this._getTempPreferences(this.currentProfile+":details_"+c)),i&&!r?this._currentRelations.push(n):i&&r&&(this._currentRelations=this._currentRelations.concat(e[v].showdetail),this._publications[n]=e[v].showdetail),r=!1,a={id:n,relationName:I[n],value:i},s.setOption("currentRelations",this._currentRelations),d=I.get(c);var N=c+"_to",S=c+"_from";f.indexOf(N)>-1?o=I[N+"_short"]||I[N]:f.indexOf(S)>-1&&(o=I[S+"_short"]||I[S]),t.is(l[d],"array")||(l[d]=[]),a.id.contains("_from")?l[d].unshift(a):l[d].push(a),l[d].title=I[c+"_short"]||I[c]||c,l[d].nlsLabel=o||I[c+"_short"]||I[c]||c}this._groupedRelations=l},_hideOneDirection:function(e,t){var i="",n=[],s={upstream:!0,downstream:!0};return"upstream"===e?i="to":"downstream"===e&&(i="from"),this._currentRelations.forEach(function(e){var t=e.split("_");t[t.length-1]===i&&n.push(e)}),this._getValuesForRefresh("expandedDirection")&&(s=JSON.parse(this._getValuesForRefresh("expandedDirection"))),s[e]=!1,this._saveValuesForRefresh("expandedDirection",JSON.stringify(s)),t&&this._updatePreferences(n),n},_showOneDirection:function(e,t){var i="",n=[...this._currentRelations],s={upstream:!1,downstream:!1};return"upstream"===e?i="from":"downstream"===e&&(i="to"),this._availableRelations.forEach(function(e){var t=e.name.split("_");t[t.length-1]===i&&n.indexOf(e.name)<0&&n.push(e.name)}),this._getValuesForRefresh("expandedDirection")&&(s=JSON.parse(this._getValuesForRefresh("expandedDirection"))),s[e]=!0,this._saveValuesForRefresh("expandedDirection",JSON.stringify(s)),t&&this._updatePreferences(n),n},_initExpandedDirection:function(){var e=[];if(void 0!==this._getValuesForRefresh("expandedDirection")){let t=JSON.parse(this._getValuesForRefresh("expandedDirection"));!1===t.upstream&&(e=this._hideOneDirection("upstream")),!1===t.downstream&&(e=this._hideOneDirection("downstream"))}return e},_getAttrForTypes:function(){var e=s.getDefaultAttributes(),t=[];for(var i in e){if(e.hasOwnProperty(i))e[i].attributes.map(function(e){return e.uri}).forEach(function(e){e&&-1===t.indexOf(e)&&t.push(e)})}return t},_getExcludedRelations:function(){for(var e=[],t=this.autoModeProfile.relations,i=0;i<t.length;i++)-1===this._currentRelations.indexOf(t[i].name)&&e.push(t[i].name);return e},_getValuesForProfile:function(e){var t;!this._isWebInWin&&(!!this._widgetId&&this._widgetId.contains("preview"));if(t=this._getValuesInSession(e))this._saveValuesInSession("LastUsedProfile",t);else{let e="AutoModeProfile";this._settings&&this._settings.relation_apps&&(e=this._settings.relation_apps.ENORIPE_AP),this._saveValuesInSession("LastUsedProfile",e)}return t},_getRecents:function(){var e=s.getUserID()+"_Recents",t=localStorage.getItem(e);return t?JSON.parse(t):[]},onEndEditPref:function(){if("catiav5"!==this._addinMode&&"solidworks"!==this._addinMode){var e=this._getWidgetValue("populateTags"),t=this._getWidgetValue("selected_tenant"),i=!1,n=this._getWidgetValue("xPref_CREDENTIAL");this._populateTags!==e||t!==s.getCurrentTenantName()||n!==s.getXPrefCredential()?(this._populateTags!==e&&(this._populateTags=e,this._navigationMap.updatePopulateTag(this._populateTags)),n!==s.getXPrefCredential()&&(s.setXPrefCredential(n),i=!0),t!==s.getCurrentTenantName()&&(i=!1,this._isEmpty?this._changePlatformSL(t):(this._needToConfirmPlatformChange=!0,this._currentNewTenantValue=t,this._navigationMap?(this._modal||this._setupModal(),this._modal.show()):(this._changePlatformSL(t),this._currentNewTenantValue="",this._isEmpty=!0,this._initMapView(!0),this._navigationMap&&this._navigationMap._showNotif({level:"warning",lvl:"warning",msg:I.get("PlatformChangesTo")+" "+t}))),this._updateWidgetHeader()),i&&(this._dontRefresh=!0,this._onRefresh({initWithNodes:this._navigatedNodes,needClear:!0}))):this._dontRefresh=!0}else try{var o=JSON.parse(widget.getValue("X3DContentId"));this._navigationMap.initMultiSelectionFromCmdIfMultiSelIsActivated(),this._resetMap(o.data.items,!0)}catch(e){console.error(e)}},_dropByMode:function(e,t,i,n,s){var o=this.collection||null,a=[],r={};if(i&&i.length>0)for(var l=0;l<i.length;l++)if(i[l].objectType&&"ENORelationalExplorerFavorite"===i[l].objectType)return void this._handleFavoritesDrop(e,i[l]);if("extract"===e&&o)a=i.map(function(e){return e.objectId}),t&&a.push(...t),r={ids:a,restrictedMode:!0},o.getEcoSystem(r);else if(i&&"replace"===e){this._navigationMap.initMultiSelectionFromCmdIfMultiSelIsActivated(),this._resetMap(i,!0),this._addRecents(i.map(function(e){return e.objectId}));var d=document.querySelector(".Enoripe-FavoriteText");d&&d.setContent(""),this._navigationMap&&(this._saveValuesForRefresh("favoriteID",null),this._addRootNode(i.map(function(e){return e.objectId})),this._navigationMap._isFavOpen=!1)}else{if(this._isEmpty)return this._resetMap(i),void this._addRootNode(i.map(function(e){return e.objectId}));this._dropAdd(i),this._addRecents(i.map(function(e){return e.objectId}))}},_dropAdd:function(e){for(var t=[],i=this._getValuesForRefresh("lastRootNodeID"),n=this.collection,o=0;o<e.length;o++){if(e[o].envId&&s.getCurrentTenantName()!==e[o].envId)return this._addNewObjectsFromDifferentPlatform=e,this._currentNewTenantValue=e[o].envId,this._modal||this._setupModal(),void this._modal.show();i.indexOf(e[o].objectId)<0&&t.push(e[o].objectId)}t.length>0?(n.updateColumnId=!0,this._addRootNode(t),n.getEcoSystem({ids:t,restrictedMode:!0})):this.hideSpinner()},_updatePreferences:function(e){e||(e=this._currentRelations,this._onRefresh({initWithNodes:this._navigatedNodes,newRelations:e})),this._cleanProxy(),this._navigationMap.filter({allfilters:{}});var t,i,n,o=[];this._availableRelations.forEach(function(e){o.push(e.name)});for(var a=0;a<this._activeProfiles.length;a++)this._activeProfiles[a].name===this.currentProfile&&this._getValuesInSession("LastUsedProfile")!=this.currentProfile&&(this._saveValuesInSession("LastUsedProfile",this._activeProfiles[a].name),this._navigationMap.updateProfile(this._activeProfiles[a].name));if(!this._currentRelations.equals(e)){for(a=0;a<this._availableRelations.length;a++)i=this._availableRelations[a].name,"",n=this.currentProfile+":"+i,p.getMainRelName(i),t=e.indexOf(i)>-1?"true":"false",this._saveValuesForRefresh(i,t),this._saveTempPreferences(n,t),this._lastSavedValues[i]=t;if(this._customizeView)this._customizeView.setNewValues(this._lastSavedValues);else for(var r=0;r<this._activeProfiles.length;r++)this._activeProfiles[r].name===this.currentProfile&&(this._availableRelations=this._activeProfiles[r].relations,this._splitRelations(this._activeProfiles[r].relations));this._setAvailableRelation(e),this._currentRelations=e,s.setOption("currentRelations",this._currentRelations),this._autoNavMode&&(this._autoModeChanged=!0),this._onRefresh({initWithNodes:this._navigatedNodes,newRelations:e}),this._updateWidgetHeader()}},_setupModal:function(){var e=this,t=this.container;this._navigationMap&&this._navigationMap.container&&(t=this._navigationMap.container),this._modal=new m({className:"site-reset",closable:!1,header:"<h4>"+I.get("PlatformChange")+"</h4>",body:"<p>"+I.get("PlatformChangeMsg")+"</p>",footer:'<button type="button" id="confirm-change" class="btn btn-primary">'+I.get("SNNCustomize_Save")+'</button> <button type="button" id="cancel-change" class="btn btn-default">'+I.get("SNNCustomize_Cancel")+"</button>"}).inject(t),this._modal.getContent().getElements(".btn").forEach(function(t){t.addEvent("click",function(){e._needToConfirmPlatformChange=!1,e._modal.hide(),"confirm-change"===this.getAttribute("id")?(e.clearMap(),e._changePlatformSL(e._currentNewTenantValue),e._currentNewTenantValue="",e._addNewObjectsFromDifferentPlatform&&(e._resetMap(e._addNewObjectsFromDifferentPlatform),e._addNewObjectsFromDifferentPlatform=void 0)):(e._setWidgetValue("selected_tenant",s.getCurrentTenantName()),e._currentNewTenantValue="",this.hideSpinner())})})},showMessageNotIndexed:function(e){var t=this,i=I.get("ObjectNotLoaded"),n={};e>1&&(i=I.replace(I.get("ObjectsNotLoaded"),{objectNbr:e})),n={level:"error",title:i,subtitle:I.get("ObjectNotIndexed")};let o=s.getXPrefCredential();_.authenticatedRequest(s.get3DSpaceUrl()+"/cvservlet/indexingdate?SecurityContext="+o,{headers:{Accept:"application/json","Content-Type":"application/json",SecurityContext:o},method:"POST",data:JSON.stringify({select_service:["FTS"]}),onComplete:function(e){if((e=JSON.parse(e)).FTS&&e.FTS.allvaultsacl){var i=new Date(1e3*e.FTS.allvaultsacl),s=i.getHours(),o="0"+i.getMinutes(),a="0"+i.getSeconds(),r=s+":"+o.substr(-2)+":"+a.substr(-2);n.msg=" "+I.get("LastIndexed")+" "+r}t._navigationMap._showNotif(n)},onFailure:function(e){t._navigationMap._showNotif(n)},onTimeout:function(e){t._navigationMap._showNotif(n)}})},onResize:function(){this._navigationMap&&this._navigationMap.onResize(),this._homePage&&this._homePage.onResize()},_resetMap:function(e,t){for(var i="[",n="",o=0;o<e.length;o++)""===n?n=e[o].envId:e[o].envId,i+='"'+e[o].objectId+'"',i+=e.length-1>o?",":"",i+=e.length-1===o?"]":"";n&&s.getCurrentTenantName()!==n&&this._changePlatformSL(n),","===i[i.length-2]&&(i=i.substring(0,i.length-2)+"]"),"[]"!==i?(this._cleanProxy(),this.setExcludedNode([]),this._addRootNode([],!0),this._onRefresh({initWithNodes:i,needClear:t})):this.hideSpinner()},_onRefreshWebInWin:function(e){var t=e.initWithNodes,i=this;!t&&e.initWithFavorite&&(t=[e.initWithFavorite]),t&&"[]"!==t?(0===t.indexOf("[")?t=JSON.parse(t):"string"==typeof t&&(t=[t]),i._isFavorite(t[0]).then(function(n){n?i._openFavorite(t[0]):i._onRefresh(e)},function(){i._onRefresh(e)})):i._onRefresh(e)},_onRefresh:function(e){if(this.showSpinner(),e.newRelations&&(this._currentRelations=e.newRelations,s.setOption("currentRelations",this._currentRelations),e.needClear=!0),e.initWithNodes)if(e.initWithNodes&&"[]"!==e.initWithNodes&&"string"==typeof e.initWithNodes&&0===e.initWithNodes.indexOf("[")&&(e.initWithNodes=JSON.parse(e.initWithNodes)),this.showSpinner(),!0===e.needClear){var t=this,i=this._navigatedNodes.map(function(e){return{id:e}});t.clearMap().then(function(){t._setNavigatedIds(i),t._initCollection({initWithNodes:e.initWithNodes,objectType:e.objecType||null,needClear:!0,selectedNodes:e.selectedNodes||[]})})}else this._refreshCollection({initWithNodes:e.initWithNodes,objectType:e.objecType||null})},clearMap:function(){return new i(function(e,t){this._cleanProxy(),this._isEmpty=!0,this._navigatedNodes=[],this.setExcludedNode([]),this._setWidgetValue("ENORIPE_navigatedNodes",this._navigatedNodes),this._setWidgetValue("ENORIPE_savedColumnIds",{}),this._setWidgetValue("X3DContentId",{}),this.collection&&this.collection.reset(),this._customizeView&&this._customizeView.hide();var i=document.querySelector(".Enoripe-FavoriteText");i&&i.setContent(""),c.clear().then(function(){this._setPreferences(),this._navigationMap.clearMapSuccess(!1),e()}.bind(this),function(){this._navigationMap.clearMapFailure(),t()}.bind(this))}.bind(this))},hideSpinner:function(){this._navigationMap&&this._navigationMap.hideSpinner()},showSpinner:function(){this._navigationMap&&this._navigationMap.showSpinner()}})});