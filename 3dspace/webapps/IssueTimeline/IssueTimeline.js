define("DS/IssueTimeline/IssueTimeline",["UWA/Class/View","UWA/Core","DS/UIKIT/Input/Toggle","DS/UIKIT/Tooltip","DS/Logger/Logger","DS/PlatformAPI/PlatformAPI","css!DS/IssueTimeline/IssueTimeline.css"],function(e,t,n,i,s,r){"use strict";return e.extend({name:"DS/IssueTimeline/IssueTimeline",tagName:"div",className:"timeline-component",defaultOptions:{parser:""},_logger:null,view:null,_subscriberTokens:[],setup:function(e){var n=this;this._logger=s.getLogger(n.name),this._logger.debug("Initializing the timeline..."),e=t.merge(e||{},n.defaultOptions),n._parent(e),n._deferred={},n.isLoaded=new Promise(function(e,t){n._deferred.resolve=e,n._deferred.reject=t}),n._subscribers()},render:function(){var e=this;return require(["DS/IssueTimeline/views/Rows"],function(t){var n=e.view=new t({physicalId:e.getOption("physicalId"),parser:e.getOption("parser"),parent:e});e.container.setContent(n.render().container),setTimeout(function(){e._deferred.resolve(),e.dispatchEvent("onReady",{})},1e3)}),e},reset:function(){var e=this;e.isLoaded=new Promise(function(t,n){e._deferred.resolve=t,e._deferred.reject=n}),e._subscriberTokens.forEach(function(e){r.unsubscribe(e)}),e.view.destroy()},destroy:function(){this.reset()},refresh:function(e){return this.reset(),this.setOption("physicalId",e),this.render(),this.isLoaded},resize:function(){this.dispatchEvent("onResize")},_subscribers:function(){var e=this;e._subscriberTokens.push(r.subscribe("DS/Object/update",function(t){t.data.paths.reduce(function(e,t){return e.push(t.pop()),e},[]).indexOf(e.getOption("physicalId"))>-1&&(e.view.destroy(),require(["DS/IssueTimeline/views/Rows"],function(t){var n=e.view=new t({physicalId:e.getOption("physicalId"),parser:e.getOption("parser"),parent:e});e.container.setContent(n.render().container)}))}))}})}),define("DS/IssueTimeline/services/Services",["UWA/Class/Promise","UWA/Core","DS/WAFData/WAFData","DS/IssueServices/services/PlatformServices"],function(e,t,n,i){"use strict";var s="application/json",r="application/json",o=6e5;return{getHistory:function(a){var l={};return a.method="GET",l.headers={Accept:s,"Content-Type":r,SecurityContext:"ctx::"+i.getSecurityContext()},l.timeout=o,new e(function(e,s){l.onComplete=function(n){t.is(n,"string")&&(n=JSON.parse(n)),e(n)},l.onFailure=function(e){t.is(e,"string")&&(e=JSON.parse(e)),s(e)},n.authenticatedRequest(i.assembleURLFor3DSpace("/resources/issues/"+a.physicalId+"/history",""),l)})}}}),define("DS/IssueTimeline/models/Entry",["UWA/Class/Model","DS/Logger/Logger","DS/IssueServices/utils/Performance"],function(e,t,n){"use strict";var i={ICON_BY_ACTION:{default:"fonticon-info",create:"fonticon fonticon-newspaper",addinterface:"fonticon fonticon-list-add",modify:"fonticon fonticon-arrows-ccw",connect:"fonticon fonticon-flow-branch ",disconnect:"fonticon fonticon-flow-branch ",checkin:"fonticon fonticon-down-circled",checkout:"fonticon fonticon-up-circled",movefiles:"fonticon fonticon-shuffle",promote:"fonticon fonticon-up-bold",demote:"fonticon fonticon-down-bold"},CLASS_BY_STATE:{default:"primary",Create:"create",Assign:"assign",Active:"active",Review:"review",Closed:"closed"}},s=0;return e.extend({name:"DS/IssueTimeline/models/Entry",defaults:{id:"",physicalId:"",date:"",title:"",action:"",state:"",author:{user:"",fullName:""},content:"",timestamp:0,subEntries:null,icon:"fonticon-info",className:"primary"},_logger:null,setup:function(){this._logger=t.getLogger("DS/IssueTimeline/Model"),this._logger.debug("Initializing an entry..."),n.start(this.name+" setup"),this.set("id",s+=1),this.set({timestamp:new Date(this.get("date")).getTime()});var e=require("DS/IssueTimeline/collections/Entries");this.get("subEntries")&&Array.isArray(this.get("subEntries"))&&this.get("subEntries").length>0?this.set("subEntries",new e(this.get("subEntries"))):this.set("subEntries",null);var r=this.get("action").trim(),o=this.get("state").trim(),a=void 0!==i.ICON_BY_ACTION[r]?i.ICON_BY_ACTION[r]:i.ICON_BY_ACTION.default,l=void 0!==i.CLASS_BY_STATE[o]?i.CLASS_BY_STATE[o]:i.CLASS_BY_STATE.default;this.set({icon:a,className:l}),n.end(this.name+" setup")}})}),define("DS/IssueTimeline/utils/Parser",["UWA/Class/Promise","UWA/Core","DS/WAFData/WAFData","DS/IssueServices/Contexts","DS/IssueServices/services/PlatformServices","i18n!DS/IssueTimeline/assets/nls/Timeline"],function(e,t,n,i,s,r){"use strict";var o={ACTIONS:{CREATE:"create",CONNECT:"connect",DISCONNECT:"disconnect",PROMOTE:"promote",DEMOTE:"demote",MODIFY:"modify",CHANGE:"change",ADD:"add"},DESCRIPTION:{REPORTED_AGAINST:"Issue to",RESOLVED_BY:"Resolved To to",CONTEXT:"Additional Context to",DOCUMENT:"Reference Document to ",ASSIGNED:"Assigned"},ACTIONS_TITLE:["title","description","priority","actual start date","actual end date","estimated start date","escalation required","due date","resolution recommendation","action taken","resolution statement","originator"]};return{parse:function(e,t){var n=this;return n.getAttributes(t.physicalId).then(function(t){var i=[[],[]];t.results[0].data.forEach(function(e){"Priority"===e.name?(i[0].push(e.name),i[1].push([e.nls,e.value[0]])):(i[0].push(e.name),i[1].push(e.nls))});for(var s=[],r=[];e.length>0&&e[0].action!==o.ACTIONS.CREATE;)e.shift();for(var a=e.length-1;a>-1;a--){var l=e[a];if(n.validEntryByAttribute(l)){var c=new Date(l.date),u={};switch(u.date=n.getDay(c),u.action=l.action,u.description=l.description,u.state=l.state,u.author={user:l.author.user,fullName:l.author.fullName},u.content=l.description,u.title="",u.subEntries=[],l.action){case o.ACTIONS.CREATE:case o.ACTIONS.PROMOTE:case o.ACTIONS.DEMOTE:u.content=n[l.action](l),u.subEntries=r,r=[],s.unshift(u);break;case o.ACTIONS.MODIFY:var d=n[l.action](e,a,i);a=d[1],u.content=d[0],u.content&&u.content.length&&u.content.length>0&&r.push(u);break;case o.ACTIONS.CHANGE:case o.ACTIONS.CONNECT:case o.ACTIONS.DISCONNECT:a=(d=n[l.action](e,a))[1]?d[1]:a,u.content=d[0],u.content&&u.content.length&&u.content.length>0&&r.push(u)}}}return s})},getAttributes:function(t){var i=this;return new e(function(e,r){var o={};o.method="POST",o.headers={Accept:"application/json","Content-Type":"application/json","Accept-Language":window.widget.lang,SecurityContext:i._getCurrentSecurityContext()},o.data=JSON.stringify({lIds:[],relIDs:[],busIDs:[t],plmparameters:"false",attributes:"true",navigateToMain:"true",readonly:"false",debug_properties:""}),o.onComplete=function(t){var n=JSON.parse(t);e(n)},o.onFailure=function(e){r(e)},n.authenticatedRequest(s.assembleURLFor3DSpace("/resources/v1/collabServices/attributes/op/read"),o)})},create:function(){return r.parser.created},promote:function(e){var t=i.get("maturityGraph");return t[e.state]?r.replace(r.parser.promoted,{state:t[e.state].bold()}):r.replace(r.parser.promoted,{state:e.state.bold()})},demote:function(e){var t=i.get("maturityGraph");return t[e.state]?r.replace(r.parser.demoted,{state:t[e.state].bold()}):r.replace(r.parser.demoted,{state:e.state.bold()})},connect:function(e,t){if(e[t].description){if(this._isStatus(e[t].description,o.DESCRIPTION.ASSIGNED))return this._combineSameContentAssign(e,t);if(this._isStatus(e[t].description,o.DESCRIPTION.DOCUMENT))return this._combineSameContentDocument(e,t);if(this._isStatus(e[t].description,o.DESCRIPTION.RESOLVED_BY)||this._isStatus(e[t].description,o.DESCRIPTION.REPORTED_AGAINST)||this._isStatus(e[t].description,o.DESCRIPTION.DOCUMENT))return this._combineSameContentConnect(e,t)}return[[],t]},disconnect:function(e,t){return this.connect(e,t)},modify:function(e,t,n){var i=this,s=t,a=[],l=new Date(e[s].date),c=l.getTime(),u=c,d=(e[s].user,[]),p=[];if(e[t].description.includes("Waiting On")){var h=i._getModify(e[t].description,n);return a.push(h[0]),[a,t]}for(;u>c-6e4&&(e[t].user,1)&&s>-1&&e[s].action===o.ACTIONS.MODIFY&&!e[s].description.includes("Waiting On");){if(e[s].description)(h=i._getModify(e[s].description,n))&&p.push(h.join(""));--s>-1&&(u=new Date(e[s].date).getTime(),e[s].user)}if(p.length>0&&(p=p.sort(i.arrangeTooltip)).forEach(e=>{d.push(i.escapeHtml("<li class= mod-li>"+e+"</li>"))}),d.length>0){var m=r.parser.IssueHasBeen+'<span class="timeline-modified-operations" data-list="'+d.join("")+'">'+r.parser.updated+"</span>";a.push(m)}return[a,s+1]},change:function(e,t){var n=e[t],i=n.description.trim().indexOf("owner:"),s=n.description.trim().indexOf("was:");if(i>-1){var o=n.description.slice(i+"owner: ".length+1,-n.description.trim().length+s);return n.content=r.replace(r.parser.owner,{name:o.bold()}),[n.content,t]}var a=n.description.trim().indexOf("organization:"),l=n.description.trim().indexOf("was:");if(a>-1){o=n.description.slice(a+"organization: ".length+1,-n.description.trim().length+l);return n.content=r.replace(r.parser.organization,{name:o.bold()}),[n.content,t]}var c=n.description.trim().indexOf("project:"),u=n.description.trim().indexOf("was:");if(c>-1){o=n.description.slice(c+"project: ".length+1,-n.description.trim().length+u);return n.content=r.replace(r.parser.project,{name:o.bold()}),[n.content,t]}return[]},_combineSameContentAssign:function(e,t){for(var n,i=t,s=[],a=new Date(e[t].date),l=a.getTime(),c=null,u=[],d=l,p=(e[i].user,e[i].description);d>l-6e4&&(e[t].user,1)&&i>0&&this._isSameConnectStatus(e[t].description,p,o.DESCRIPTION.ASSIGNED)||e[i].action===o.ACTIONS.ADD;){if(e[i].description&&this._isStatus(e[i].description,o.DESCRIPTION.ASSIGNED)){var h=this._getPerson(e[i].description);null===c||c===e[i].action?(u.unshift(h),c=e[i].action):(c===o.ACTIONS.CONNECT?n=r.replace(r.parser.assigned,{name:u.join(", ")}):c===o.ACTIONS.DISCONNECT&&(n=r.replace(r.parser.unassigned,{name:u.join(", ")})),(u=[]).unshift(h),null!==n&&s.unshift(n)),c=e[i].action}--i>0&&(d=new Date(e[i].date).getTime(),e[i].user,p=e[i].description)}return c===o.ACTIONS.CONNECT?n=r.replace(r.parser.assigned,{name:u.join(", ")}):c===o.ACTIONS.DISCONNECT&&(n=r.replace(r.parser.unassigned,{name:u.join(", ")})),null!==n&&s.unshift(n),[s.join("<br>"),i+1]},_combineSameContentDocument:function(e,t){for(var n,i,s=t,a=[],l=new Date(e[t].date),c=l.getTime(),u=null,d=[],p=null,h=c,m=(e[s].user,e[s].description);h>c-6e4&&(e[t].user,1)&&s>0&&this._isSameConnectStatus(e[t].description,m,o.DESCRIPTION.DOCUMENT);)e[s].description&&null!==(i=this._getConnectStatus(e[s].description))&&(e[s].action===o.ACTIONS.CONNECT?i===o.DESCRIPTION.DOCUMENT&&(p="reference"):e[s].action===o.ACTIONS.DISCONNECT&&i===o.DESCRIPTION.DOCUMENT&&(p="unreference"),null===u||u===p?d.unshift(this._getXPrd(e[s].description)):u&&(n=r.replace(r.parser[u],{number:d.length,name:d.join(", ")})+"<br>",a.unshift(n),(d=[]).unshift(this._getXPrd(e[s].description))),u=p),--s>0&&(h=new Date(e[s].date).getTime(),e[s].user,m=e[s].description);return u&&null!==(n=r.replace(r.parser[u],{number:d.length,name:d.join(", ")})+"<br>")&&a.unshift(n),[a,s+1]},_combineSameContentConnect:function(e,t){for(var n,i,s=t,a=[],l=new Date(e[t].date),c=l.getTime(),u=null,d=[],p=null,h=c,m=(e[s].user,e[s].description);h>c-6e4&&(e[t].user,1)&&s>0&&this._isConnectObject(e[t].description,m);)e[s].description&&null!==(i=this._getConnectStatus(e[s].description))&&(e[s].action===o.ACTIONS.CONNECT?i===o.DESCRIPTION.REPORTED_AGAINST?p="reported":i===o.DESCRIPTION.RESOLVED_BY&&(p="resolved"):e[s].action===o.ACTIONS.DISCONNECT&&(i===o.DESCRIPTION.REPORTED_AGAINST?p="unreported":i===o.DESCRIPTION.RESOLVED_BY&&(p="unresolved")),null===u||u===p?d.unshift(this._getXPrd(e[s].description)):u&&(n=r.replace(r.parser[u],{name:d.join(", ")}),a.unshift(n),(d=[]).unshift(this._getXPrd(e[s].description))),u=p),--s>0&&(h=new Date(e[s].date).getTime(),e[s].user,m=e[s].description);return u&&null!==(n=r.replace(r.parser[u],{name:d.join(", ")}))&&a.unshift(n),[a,s+1]},_isSameConnectStatus:function(e,t,n){return this._isStatus(e,n)===this._isStatus(t,n)},_isStatus:function(e,t){return!!e&&e.indexOf(t)>-1},_isConnectObject:function(e,t){return this._isStatus(e,o.DESCRIPTION.RESOLVED_BY)?this._isStatus(t,o.DESCRIPTION.RESOLVED_BY)||this._isStatus(t,o.DESCRIPTION.REPORTED_AGAINST):!!this._isStatus(e,o.DESCRIPTION.REPORTED_AGAINST)&&(this._isStatus(t,o.DESCRIPTION.RESOLVED_BY)||this._isStatus(t,o.DESCRIPTION.REPORTED_AGAINST))},_getConnectStatus:function(e){return this._isStatus(e,o.DESCRIPTION.RESOLVED_BY)?o.DESCRIPTION.RESOLVED_BY:this._isStatus(e,o.DESCRIPTION.REPORTED_AGAINST)?o.DESCRIPTION.REPORTED_AGAINST:this._isStatus(e,o.DESCRIPTION.DOCUMENT)?o.DESCRIPTION.DOCUMENT:null},_getDoc:function(e){var t,n=e.indexOf("Document to Document");return n>-1&&(t="<b>"+e.slice(n,-1).trim()+"</b>"),t},_getModify:function(e,n){var i=e.indexOf(":"),s=e.indexOf("was:"),o=e.indexOf(":GMT"),a="",l=["Field"," "];if(i>-1){a=e.slice(0,i).trim();var c=n[0].indexOf(a);if(c>-1||"Waiting On"===a){if(s>-1)if("Priority"===a){l[0]="<b>"+n[1][c][0]+"</b>";var u="nls";switch(e.slice(i,s).trim()){case": Pre-assigned":case": Low":case": Medium":case": High":case": Urgent":u=": "+n[1][c][1]}l[1]=u+"</br>"}else if(o>-1)l[0]="<b>"+n[1][c]+"</b>",l[1]=t.String.escapeHTML(e.slice(i,o-9).trim())+"</br>";else if("Waiting On"===a){e.slice(i,s).trim().includes("Analyst")?l[0]=r.parser.approvalEnabled:l[0]=r.parser.approvalDisabled}else l[0]="<b>"+n[1][c]+"</b>",l[1]=t.String.escapeHTML(e.slice(i,s).trim())+"</br>"}else"description"===a?(l[0]="<b>"+r.parser.description+"</b>",l[1]=t.String.escapeHTML(e.slice(i,e.length).trim())+"</br>"):l=null}else l=null;return l},escapeHtml:function(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")},_getPerson:function(e){var t=e.indexOf("Person");return t>-1?'<span class="timeline-psn" data-adress=" ">'+e.slice(t+7,e.length-1).trim()+"</span>":r.parser.anObject},arrangeTooltip:function(e,t){return e=e.slice(3,e.indexOf("</b>")),t=t.slice(3,t.indexOf("</b>")),o.ACTIONS_TITLE.indexOf(e.toLowerCase().trim())<o.ACTIONS_TITLE.indexOf(t.toLowerCase().trim())?-1:o.ACTIONS_TITLE.indexOf(e.toLowerCase().trim())>o.ACTIONS_TITLE.indexOf(t.toLowerCase().trim())?1:0},_getXPrd:function(e){for(var t=/\w*\sxPrd-\d*\s.{3}/g,n="";null!==(n=t.exec(e));){n.index===t.lastIndex&&t.lastIndex++;var i=n.toString().split(" ");return'<span class="timeline-tnr" data-type="'+i[0]+'" data-name="'+i[1]+'" data-revision="'+i[2]+'"><span>'+n+"</span></span>"}return e.includes(o.DESCRIPTION.REPORTED_AGAINST)?'<span class="timeline-tnr" "><span>'+(n=e.slice(o.DESCRIPTION.REPORTED_AGAINST.length+1,e.length).trim())+"</span></span>":e.includes(o.DESCRIPTION.RESOLVED_BY)?'<span class="timeline-tnr" "><span>'+(n=e.slice(o.DESCRIPTION.RESOLVED_BY.length+1,e.length).trim())+"</span></span>":e.includes(o.DESCRIPTION.CONTEXT)?'<span class="timeline-tnr" "><span>'+(n=e.slice(o.DESCRIPTION.CONTEXT.length+1,e.length).trim())+"</span></span>":e.includes(o.DESCRIPTION.DOCUMENT)?'<span class="timeline-tnr" "><span>'+(n=e.slice(o.DESCRIPTION.DOCUMENT.length+1,e.length).trim())+"</span></span>":r.parser.anObject},validEntryByAttribute:function(e){return!!e&&(!(!e.hasOwnProperty("date")||t.is(e.date,null)||!t.is(e.date,"string"))&&(!!e.hasOwnProperty("description")&&(!(!e.hasOwnProperty("action")||t.is(e.action,null)||!t.is(e.action,"string"))&&(!(!e.hasOwnProperty("state")||t.is(e.state,null)||!t.is(e.state,"string"))&&(!(!e.hasOwnProperty("author")||t.is(e.state,null)||!t.is(e.author,"object"))&&(!(!e.author.hasOwnProperty("user")||t.is(e.author.user,null)||!t.is(e.author.user,"string"))&&!(!e.author.hasOwnProperty("fullName")||t.is(e.author.fullName,null)||!t.is(e.author.fullName,"string"))))))))},getDay:function(e){var t=i.get("widget")||window.widget;return e.toLocaleString(t.lang)},_getCurrentSecurityContext:function(){var e="",t=i.get("widget")||window.widget;return t.getPreference("securityContext")&&(e=t.getPreference("securityContext").value),e.contains("ctx::")?encodeURIComponent(e.split("::")[1]):encodeURIComponent(e)}}}),define("DS/IssueTimeline/utils/Utils",["UWA/Core","DS/PlatformAPI/PlatformAPI","DS/IssueServices/services/PlatformServices"],function(e,t,n){"use strict";return{getFullName:function(){return t.getUser().firstName.trim()+" "+t.getUser().lastName.trim()},getUserName:function(){return t.getUser().login},escape:function(e){return e.replace(/</g,"&lt;").replace(/>/g,"&gt;")},getLocaleDate:function(e){return e.toLocaleString(window.widget.lang)},getUserImage:function(e){return n.getUserImage(e,"mini")}}}),define("DS/IssueTimeline/views/Row",["UWA/Class/Promise","UWA/Class/View","UWA/Core","DS/UIKIT/Tooltip","DS/IssueServices/services/PlatformServices","DS/IssueServices/utils/Performance","DS/IssueTimeline/utils/Utils","i18n!DS/IssueTimeline/assets/nls/Timeline","css!DS/IssueTimeline/IssueTimeline.css"],function(e,t,n,i,s,r,o,a){"use strict";var l=t.extend({name:"DS/IssueTimeline/views/Row",tagName:"div",className:"timeline-row",_logger:null,parent:null,isSubRow:!1,data:{},subRows:[],elements:{icon:null,expander:null,panel:null},isExpanded:!1,_isSubRowsRendered:!1,_tooltips:[],setup:function(e){var t=this;r.start(t.name+" setup"),t.container.set("id","row_"+t.model.get("id")),t.parent=e.parent,t.isSubRow=!0===e.isSubRow,t.data={},t.subRows=[],t.elements={icon:null,expander:null,panel:null},t.isExpanded=!1,t._isSubRowsRendered=!1,t._tooltips=[];var n=t.model.get("subEntries");return null!==n&&n.length>0&&n.forEach(function(e){var n=new l({model:e,parent:t.parent,isSubRow:!0});t.subRows.push(n)}),r.end(t.name+" setup"),t},render:function(){var e=this;r.start(e.name+" render");var t,o,l,c=null;return!0===e.isSubRow&&e.container.addClassName("sub"),t=n.createElement("div",{class:"timeline-icon",html:'<div class="bg-'+e.model.get("className")+'"><span class="fonticon  '+e.model.get("icon")+'"></span></div>'}),e.elements.header=o=n.createElement("div",{class:"timeline-row-header",html:[n.createElement("span",{class:"timeline-row-header-user",html:[n.createElement("div",{class:"timeline-row-header-user-image",html:s.getUserImageElement(e.model.get("author"),!0,{Title:e.model.get("author").fullName})}),n.createElement("span",{class:"timeline-row-header-user-name",html:e.model.get("author").fullName})]}),n.createElement("span",{class:"timeline-row-header-date",html:e.model.get("date")})]}),e.subRows.length>0&&(e.elements.expander=c=n.createElement("div",{class:"expander",html:a.common.show})),e.elements.panel=l=n.createElement("div",{class:"timeline-panel timeline-content",html:[o,n.createElement("div",{class:"panel-body",html:e.model.get("content")}),null!==c?c:""]}),e.container.setContent([{html:[t,l]}]),n.Element.getElements.call(e.container,".timeline-modified-operations").forEach(function(t){e._tooltips.push(new i({position:"top",target:t,body:'<ul class="mod-Panel" >'+t.dataset.list+"</ul>",trigger:"touch"}))}),e._fetchContentData(),e._subscribers(),r.end(e.name+" render"),e},destroy:function(){this.container.destroy(),this.parent=null,this.isSubRow=!1,this.data={},this.subRows=[],this.elements={icon:null,expander:null,panel:null},this.isExpanded=!1,this._isSubRowsRendered=!1,this._tooltips.forEach(function(e){e.destroy()}),this._tooltips=[]},show:function(){this.container.setStyle("display","inherit"),this.parent.dispatchEvent("onScroll",{height:this.parent.container.offsetHeight,position:this.parent._position})},hide:function(){this.container.setStyle("display","none"),this.container.removeClassName("active")},expand:function(){if(r.start(this.name+" expand"),!1===this._isSubRowsRendered){this._isSubRowsRendered=!0;for(var e=0;e<this.subRows.length;e++)this.container.parentNode.insertBefore(this.subRows[e].render().container,this.container),this.parent.addRow(this.subRows[e]),this.parent.dispatchEvent("onScroll",{height:this.parent.container.offsetHeight,position:this.parent._position})}else for(var t=0;t<this.subRows.length;t++)this.subRows[t].show();r.end(this.name+" expand")},collapse:function(){r.start(this.name+" collapse");for(var e=0;e<this.subRows.length;e++)this.subRows[e].hide();r.end(this.name+" collapse")},_fetchContentData:function(){},_subscribers:function(){var e=this;null!==e.elements.expander&&e.elements.expander.addEventListener("click",function(){!1===e.isExpanded?(e.isExpanded=!0,e.elements.expander.setContent(a.common.hide),e.expand()):(e.isExpanded=!1,e.elements.expander.setContent(a.common.show),e.collapse())})}});return l}),define("DS/IssueTimeline/collections/Entries",["UWA/Class/Collection","DS/Logger/Logger","DS/IssueTimeline/models/Entry","DS/IssueServices/services/PlatformServices","DS/IssueTimeline/services/Services","DS/IssueTimeline/utils/Parser","DS/IssueServices/utils/Performance"],function(e,t,n,i,s,r,o){"use strict";return e.extend({name:"DS/IssueTimeline/collections/Entries",model:n,_logger:null,setup:function(e,n){return this._logger=t.getLogger("DS/IssueTimeline/Model"),this._logger.debug("Initializing the entries..."),o.start(this.name+" setup"),this.physicalId=n.physicalId,Array.isArray(e)&&e.length>0&&this.add(e),o.end(this.name+" setup"),this},fetch:function(e){var t=this;t._logger.debug("Fetching all entries..."),o.start(t.name+" fetch"),i.initPlatformServices().then(function(){return s.getHistory({physicalId:t.physicalId})}).then(function(n){var i=n.body;t._logger.debug("Entries fetched"),e.physicalId=t.physicalId,null!==e.parser?e.parser.parse(i,e).then(function(e){t.reset(e)}):t.parse(i,e).then(function(e){t.reset(e)}),e&&"function"==typeof e.onComplete&&e.onComplete(i),o.end(t.name+" fetch")},function(n){t._logger.error("Fetch entries failed: %o",n),t.reset([]),e&&"function"==typeof e.onFailure&&e.onFailure(n),o.end(t.name+" fetch")})},parse:function(e,t){return this._logger.debug("Parsing entries..."),o.start(this.name+" parse"),e=r.parse(e,t),o.end(this.name+" parse"),e}})}),define("DS/IssueTimeline/views/Rows",["UWA/Class/Promise","UWA/Class/View","UWA/Core","DS/UIKIT/Mask","DS/UIKIT/Scroller","DS/Logger/Logger","DS/IssueTimeline/collections/Entries","DS/IssueServices/utils/Performance","DS/IssueTimeline/views/Row","i18n!DS/IssueTimeline/assets/nls/Timeline","css!DS/IssueTimeline/IssueTimeline.css"],function(e,t,n,i,s,r,o,a,l,c){"use strict";return t.extend({name:"DS/IssueTimeline/views/Rows",tagName:"div",className:"timeline-default flat animated",defaultOptions:{parser:"",flat:9999},parent:null,physicalId:"",_logger:null,_scroller:null,_position:0,_rows:[],setup:function(t){var i=this;a.start(i.name+" setup"),i._logger=r.getLogger(i),i._logger.debug("Initialize the view to build the rows"),t=n.merge(t||{},i.defaultOptions),i._parent(t),i.parent=t.parent,i.physicalId=t.physicalId;var s=i.collection=new o([],{physicalId:i.physicalId});return i.listenTo(s,"onReset",i._onReset),i.listenTo(t.parent,"onResize",i._onResize),i.listenTo(i,"onScroll",i._onScroll),new e(function(e){try{require([i.getOption("parser")],function(t){t&&"function"==typeof t.parse?e(t):e(null)})}catch(t){e(null)}}).then(function(e){s.fetch({reset:!0,parser:e,onComplete:function(){}})}),i._scroller=null,i._position=0,i._rows=[],a.end(i.name+" setup"),i},render:function(){var e=this;a.start(e.name+" render");var t=e.container.offsetWidth;t>=e.getOption("flat")?e.container.removeClassName("flat"):t<e.getOption("flat")&&!e.container.hasClassName("flat")&&e.container.addClassName("flat"),e.container.setAttribute("id","timeline-top");var r=n.createElement("div",{class:"timeline-main"});e._scroller=new s({element:e.container}).inject(r);var o={scroll:function(){var t=e._position=e._scroller._infos.y.scrollPosition;e.dispatchEvent("onScroll",{height:e.container.offsetHeight,position:t})}.bind(this)};return e._scroller.elements.content.addEvents(o),i.mask(e.container),a.end(e.name+" render"),e},destroy:function(){this.stopListening(this.collection,"onReset"),this.stopListening(this.getOption("parent"),"onResize"),this.stopListening(this,"onScroll"),this.parent=null,this._scroller.destroy(),this._scroller=null,this._position=0;for(var e=0;e<this._rows.length;e++)this._rows[e].destroy();this._rows=[],this.collection=null,this.container.destroy(),this.container=null},_onReset:function(e,t){var s=this;a.start(s.name+" _onReset");var r=s._scroller.getInnerElement();if(e.length>0)s.container.addClassName("timeline"),e.forEach(function(e){var n=new l({model:e,parent:s,options:t}).render();s.addRow(n),r.insertBefore(n.container,r.firstChild)}),i.unmask(s.container),s.dispatchEvent("onScroll",{height:s.container.offsetHeight,position:0});else{s.container.removeClassName("timeline");var o=n.createElement("div",{class:"timeline-error",html:c.common.errorMessage});r.insertBefore(o,r.firstChild),i.unmask(s.container),s.dispatchEvent("onScroll",{height:s.container.offsetHeight,position:0})}a.end(s.name+" _onReset")},addRow:function(e){this._rows.push(e)},_onScroll:function(e){for(var t=e.height,n=this._rows,i=0;i<n.length;i++){var s=n[i].container;t>s.getBoundingClientRect().top-this.container.getBoundingClientRect().top+s.offsetHeight&&(s.hasClassName("active")||s.addClassName("active"))}},_onResize:function(){var e=this.container.offsetHeight,t=this.container.offsetWidth;this.dispatchEvent("onScroll",{height:e,position:this._position}),t>=this.getOption("flat")?this.container.removeClassName("flat"):t<this.getOption("flat")&&!this.container.hasClassName("flat")&&this.container.addClassName("flat")}})});