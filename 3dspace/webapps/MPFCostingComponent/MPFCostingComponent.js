define("DS/MPFCostingComponent/PricingSection",["UWA/Core","UWA/Class/View","DS/MPFServices/ObjectService","DS/MPFView/GuidanceHelper","css!DS/MPFCostingComponent/MPFCostingComponent"],function(t,e,i,n){"use strict";return e.extend({className:"mpf-pricing-section",setup:function(e){e||(e={}),i.requiredOfPrototype(e.elements,Array,"options.elements must be an Array"),this.title=e.title,this.guidanceHelperContent=e.guidanceHelperContent,this.elements=e.elements,t.is(e.additionalClassName,"string")&&this.container.addClassName(e.additionalClassName),this.guidanceHelper=this._createGuidanceHelper(),this.titleContainer=this._getTitleContainer()},render:function(){var t=[];return t.push(this.titleContainer),this.elements.forEach(function(e){t.push(e.render())}),this.container.setContent(t),this},_createGuidanceHelper:function(){return new n({content:this.guidanceHelperContent})},_getTitleContainer:function(){return t.createElement("div",{class:"mpf-pricing-title",html:[this.title,this.guidanceHelper]})}})}),define("DS/MPFCostingComponent/DiscountElement",["UWA/Core","UWA/Class/View","DS/UIKIT/Input/Number","DS/UIKIT/Input/Button","DS/MPFServices/ObjectService","DS/MPFShopModel/ShopModel","DS/MPFDiscountModel/DiscountModel","DS/MPFPricingModel/PricingModel","i18n!DS/MPFCostingComponent/assets/nls/CostingComponent","css!DS/MPFCostingComponent/MPFCostingComponent"],function(t,e,i,n,s,o,r,c,u){"use strict";return e.extend({className:"mpf-discount-element",domEvents:{"click span.fonticon-trash":"removeDiscount"},setup:function(t){t||(t={}),s.requiredOfPrototype(t.shop,o,"options.shop must be a ShopModel"),s.requiredOfPrototype(t.discount,r,"options.discount must be a DiscountModel"),s.requiredOfPrototype(t.pricing,c,"options.pricing must be a PricingModel"),this.shop=t.shop,this.discount=t.discount,this.pricing=t.pricing,this.priceInput=this._createPriceInput(),this.discountInput=this._createDiscountInput(),this.percentageOption=this._createPercentageButton(),this.trashDiscountIcon=this._createTrashDiscountIcon()},render:function(){var e,i,n,s,o;return e=t.createElement("span",{class:"mpf-discount-number-label",text:u.get("orderValueLabel")}),s=t.createElement("span",{class:"mpf-discount-currency-label",text:this.shop.getSupportedCurrencies()+","}),o=t.createElement("span",{class:"mpf-discount-number-label",text:u.get("discountLabel")}),i=t.createElement("div",{class:"mpf-discount-line",html:[e,this.priceInput,s]}),n=t.createElement("div",{class:"mpf-discount-line",html:[o,this.discountInput,this.percentageOption]}),this.container.setContent([{tag:"div",class:"mpf-left-column",html:[i,n]},this.trashDiscountIcon]),this},save:function(){return this.discount.savePromise()},isDiscountLimitLowerThatMinOrderCost:function(){return this.discount.getLimit()<this.pricing.getMinimumOrderCost()},removeDiscount:function(){var t=this;return this.discount.destroyPromise().then(function(){t.dispatchEvent("onRemove",t)})},_changeUnit:function(t){var e=this,i={};return i[r.Fields.UNIT]=t,this.discount.savePromise(i,{patch:!0}).then(function(){return e.discountInput=e._createDiscountInput(),e._onDiscountValueChanged()}).then(e.render.bind(e))},_onPriceChanged:function(){var e,i={};if(t.is(this.priceInput)){var n=this.priceInput.getValue();if(","===this.priceInput.options.decimalSeparator&&(n=n.replace(",",".")),(e=parseFloat(n))!==this.discount.getLimit())return i[r.Fields.LIMIT]=e,this.discount.savePromise(i,{patch:!0})}},_onDiscountValueChanged:function(){var e,i={};if(t.is(this.discountInput)&&(e=parseFloat(this.discountInput.getValue()))!==this.discount.getValue())return i[r.Fields.VALUE]=e,this.discount.savePromise(i,{patch:!0})},_createPercentageButton:function(){var t=this;return new n({value:"%",active:"percentage"===this.discount.getUnit(),events:{onClick:function(){this.isActive()||t._changeUnit("percentage").then(function(){t.percentageOption.setActive()})}}})},_createCurrencyButton:function(){var t=this;return new n({value:this.shop.getSupportedCurrencies(),active:this.discount.getUnit()===this.shop.getSupportedCurrencies()[0],events:{onClick:function(){this.isActive()||t._changeUnit(t.shop.getSupportedCurrencies()[0]).then(function(){t.percentageOption.setActive(!1)})}}})},_createTrashDiscountIcon:function(){return t.createElement("span",{class:"fonticon fonticon-2x fonticon-trash"})},_createDiscountInput:function(){var t,e;return e=this.discount.getUnit(),(t=new i({min:0,max:"percentage"===e?99.9:9999.99,step:.1,events:{onChange:this._onDiscountValueChanged.bind(this)}})).setValue(this.discount.getValue()),t},_createPriceInput:function(){var t;return(t=new i({min:this.pricing.getMinimumOrderCost(),max:9999.99,step:.1,events:{onChange:this._onPriceChanged.bind(this)}})).setValue(this.discount.getLimit()),t},destroy:function(){this.shop=null,this.pricing=null,this.discount=null,this.priceInput=null,this.discountInput=null,this.percentageOption=null,this.trashDiscountIcon=null,this._parent(),this.container=null}})}),define("DS/MPFCostingComponent/PricingElement",["UWA/Core","UWA/Class/View","DS/UIKIT/Input/Toggle","DS/UIKIT/Input/Number","DS/MPFServices/ObjectService","DS/MPFShopModel/ShopModel","DS/MPFPricingModel/PricingModel","i18n!DS/MPFCostingComponent/assets/nls/CostingComponent","css!DS/MPFCostingComponent/MPFCostingComponent"],function(t,e,i,n,s,o,r,c){"use strict";return e.extend({className:"mpf-pricing-element",setup:function(t){t||(t={}),s.requiredOfPrototype(t.shop,o,"options.shop must be a ShopModel"),s.requiredOfPrototype(t.pricing,r,"options.pricing must be a PricingModel"),this.shop=t.shop,this.pricing=t.pricing,this.pricingAttribute=t.pricingAttribute,this.switchLabel=t.switchLabel,this.minValue=t.minValue||0,this.maxValue=t.maxValue||10,this.stepValue=t.stepValue||1,this.readOnly=!0===t.readOnly,this.inputNumberLabel=t.inputNumberLabel,this.switchInput=this._createSwitchInput(),this.numberInput=this._createNumberInput()},render:function(){var e;return e=t.createElement("span",{class:"mpf-input-number-label",text:this.inputNumberLabel}),this.container.setContent([this.switchInput,this.numberInput,e]),this},_createSwitchInput:function(){return new i({type:"switch",label:this.switchLabel,checked:!this.pricing.isNew()&&this.pricing.get(this.pricingAttribute)>0,disabled:this.readOnly,events:{onChange:this._onChangeSwitchOption.bind(this)}})},_onChangeSwitchOption:function(){var t;(t=this.switchInput.isChecked())||0===this.pricing.get(this.pricingAttribute)||(this.numberInput.setValue(0),this.numberInput.setDisabled()),t&&0===this.pricing.get(this.pricingAttribute)&&(this.numberInput.setDisabled(!1),this.numberInput.setValue(this.minValue))},_createNumberInput:function(){var t;return(t=new n({min:0,max:this.maxValue,step:this.stepValue,events:{onChange:this._onChangeValue.bind(this)}})).setValue(this.pricing.get(this.pricingAttribute)),t.setDisabled(!this.switchInput.isChecked()||this.readOnly),t},_onChangeValue:function(){var e,i={};if(t.is(this.numberInput)){var n=this.numberInput.getValue();if(","===this.numberInput.options.decimalSeparator&&(n=n.replace(",",".")),(e=parseFloat(n))!==this.pricing.get(this.pricingAttribute))return e>=0&&e<this.minValue&&this.switchInput.isChecked()?this.numberInput.setValue(this.minValue):this.pricing.isNew()?(i[this.pricingAttribute]=e,this.pricing.savePromise(i)):(i[this.pricingAttribute]=e,this.pricing.savePromise(i,{patch:!0}))}},destroy:function(){this.shop=null,this.pricing=null,this.pricingAttribute=null,this.switchLabel=null,this.minValue=null,this.maxValue=null,this.stepValue=null,this.inputNumberLabel=null,this.switchInput=null,this.numberInput=null,this._parent(),this.container=null}})}),define("DS/MPFCostingComponent/DiscountSection",["UWA/Core","DS/MPFCostingComponent/PricingSection","DS/MPFServices/ObjectService","DS/MPFDiscountModel/DiscountFactory","DS/MPFDiscountModel/DiscountModel","DS/MPFDiscountModel/DiscountCollection","DS/MPFShopModel/ShopModel","DS/MPFPricingModel/PricingModel","DS/UIKIT/Input/Button","DS/MPFCostingComponent/DiscountElement","i18n!DS/MPFCostingComponent/assets/nls/CostingComponent","css!DS/MPFCostingComponent/MPFCostingComponent"],function(t,e,i,n,s,o,r,c,u,h,a){"use strict";return e.extend({setup:function(t){t||(t={}),i.requiredOfPrototype(t.shop,r,"options.shop must be a ShopModel"),i.requiredOfPrototype(t.discountFactory,n,"options.discountFactory must be a DiscountFactory"),i.requiredOfPrototype(t.discounts,o,"options.discounts must be a DiscountCollection"),i.requiredOfPrototype(t.pricing,c,"options.pricing must be a PricingModel"),t.title=a.get("discountOrderValue"),t.guidanceHelperContent=this._createTooltip(),t.elements=this._createDiscountElements(t.discounts,t.shop,t.pricing),this._parent(t),this.shop=t.shop,this.discountFactory=t.discountFactory,this.discounts=t.discounts,this.pricing=t.pricing,this.readOnly=!0===t.readOnly,this.addDiscountButton=this._getAddDiscountButton(),this.container.addClassName("mpf-discount-section"),this.listenTo(this.pricing,"onChange:"+c.Fields.MINIMUM_ORDER_COST,this._onChangeMinOrderCost.bind(this,0))},render:function(){var t=[];return t.push(this.titleContainer),this.elements.forEach(function(e){t.push(e.render())}),t.push(this.addDiscountButton),this.container.setContent(t),this},_createTooltip:function(){return t.createElement("div",{class:"mpf-discount-section-tooltip",html:[{tag:"div",text:a.get("discountPerOrderValueSectionTooltip_1")},{tag:"ul",html:[{tag:"li",text:a.get("discountPerOrderValueSectionTooltip_2")},{tag:"li",text:a.get("discountPerOrderValueSectionTooltip_3")},{tag:"li",text:a.get("discountPerOrderValueSectionTooltip_4")}]}]})},_onChangeMinOrderCost:function(t){var e,i=this;if(t<this.elements.length)return(e=this.elements[t]).isDiscountLimitLowerThatMinOrderCost()?e.discount.destroyPromise().then(function(){i._onChangeMinOrderCost(t+1)}):this._onChangeMinOrderCost(t+1);this.elements=this._createDiscountElements(this.discounts,this.shop,this.pricing),this.render()},_addDiscount:function(){var t,e,i=this;return(e=this.discountFactory.createModel(n.Types.SHOP)).parentResourceId=this.shop.id,e.set(s.Fields.LIMIT,this.pricing.getMinimumOrderCost()),this.discounts.add(e),t=new h({shop:this.shop,discount:e,pricing:this.pricing}),this.listenTo(t,"onRemove",this._onRemoveDiscount.bind(this)),t.save().then(function(){i.elements.push(t),i.render()})},_createDiscountElements:function(t,e,i){var n,s=this,o=[];return t.forEach(function(t){t.parentResourceId=e.id,n=new h({shop:e,discount:t,pricing:i}),s.listenTo(n,"onRemove",s._onRemoveDiscount.bind(s)),o.push(n)}),o},_onRemoveDiscount:function(t){this.elements.splice(this.elements.indexOf(t),1),this.stopListening(t,"onRemove"),t.destroy()},_getAddDiscountButton:function(){return new u({value:a.get("addDiscount"),className:"primary",disabled:this.readOnly,events:{onClick:this._addDiscount.bind(this)}})},destroy:function(){this.shop=null,this.pricing=null,this.discountFactory=null,this.discounts=null,this.addDiscountButton=null,this._parent(),this.container=null}})}),define("DS/MPFCostingComponent/CostingComponent",["UWA/Core","UWA/Class/View","DS/MPFServices/ObjectService","DS/MPFShopModel/ShopModel","DS/MPFPricingModel/PricingModel","DS/MPFDiscountModel/DiscountFactory","DS/MPFDiscountModel/DiscountCollection","DS/MPFCostingComponent/PricingSection","DS/MPFCostingComponent/PricingElement","DS/MPFCostingComponent/DiscountSection","i18n!DS/MPFCostingComponent/assets/nls/CostingComponent","css!DS/MPFCostingComponent/MPFCostingComponent"],function(t,e,i,n,s,o,r,c,u,h,a){"use strict";return e.extend({className:"mpf-costing-component",setup:function(t){t||(t={}),i.requiredOfPrototype(t.shop,n,"options.shop must be a ShopModel"),i.requiredOfPrototype(t.pricing,s,"options.pricing must be a PricingModel"),i.requiredOfPrototype(t.discountFactory,o,"options.discountFactory must be a DiscountFactory"),i.requiredOfPrototype(t.discounts,r,"options.discounts must be a DiscountCollection"),this.shop=t.shop,this.pricing=t.pricing,this.discountFactory=t.discountFactory,this.discounts=t.discounts,this.readOnly=!0===t.readOnly,this.generalSection=this._createGeneralSection(),this.automatedPricingSection=this._createAutomatedSection(),this.discountSection=this._createDiscountSection()},render:function(){return this.container.setContent([this.generalSection.render(),this.automatedPricingSection.render(),this.discountSection.render()]),this},_createGeneralSection:function(){return new c({shop:this.shop,pricing:this.pricing,title:a.get("general"),guidanceHelperContent:t.createElement("div",{html:[t.createElement("div",{text:a.get("generalSectionTooltip_1")}),t.createElement("br"),t.createElement("div",{text:a.get("generalSectionTooltip_2")})]}),additionalClassName:"mpf-general-section",elements:[new u({shop:this.shop,pricing:this.pricing,pricingAttribute:s.Fields.MINIMUM_ORDER_COST,switchLabel:a.get("minimumOrderCost"),stepValue:.01,minValue:.01,maxValue:9999.99,inputNumberLabel:this.shop.getSupportedCurrencies(),readOnly:this.readOnly}),new u({shop:this.shop,pricing:this.pricing,pricingAttribute:s.Fields.PRICE_PER_QUOTE,switchLabel:a.get("pricePerQuote"),stepValue:.01,minValue:.01,maxValue:9999.99,inputNumberLabel:this.shop.getSupportedCurrencies(),readOnly:this.readOnly})]})},_createAutomatedSection:function(){return new c({shop:this.shop,pricing:this.pricing,title:a.get("automatedPricing"),guidanceHelperContent:a.get("automatedPricingSectionTooltip"),additionalClassName:"mpf-automated-section",elements:[new u({shop:this.shop,pricing:this.pricing,pricingAttribute:s.Fields.TOTAL_ORDER_PRICE,switchLabel:a.get("totalOrderPriceIs"),stepValue:.01,minValue:.01,maxValue:9999.99,inputNumberLabel:this.shop.getSupportedCurrencies()+" "+a.get("orMore"),readOnly:this.readOnly}),new u({shop:this.shop,pricing:this.pricing,pricingAttribute:s.Fields.TOTAL_PART_QUANTITY,stepValue:1,minValue:1,maxValue:9999,switchLabel:a.get("totalPartQuantityIs"),inputNumberLabel:a.get("unitsOrMore"),readOnly:this.readOnly})]})},_createDiscountSection:function(){return new h({shop:this.shop,discountFactory:this.discountFactory,discounts:this.discounts,pricing:this.pricing,readOnly:this.readOnly})}})}),define("DS/MPFCostingComponent/CostingFactory",["UWA/Class","UWA/Promise","DS/MPFConnector/MarketplaceConnector","DS/MPFModelFactory/MPFFactoriesV2","DS/MPFShopModel/ShopFactory","DS/MPFPricingModel/PricingFactory","DS/MPFDiscountModel/DiscountFactory","DS/MPFCostingComponent/CostingComponent"],function(t,e,i,n,s,o,r,c){"use strict";return t.extend(t.Listener,{init:function(t){t||(t={}),this.shopID=t.shopID,this.container=t.container,this.readOnly=!0===t.readOnly},getCostingComponent:function(){return i.fetchPromise().then(this._initFactories.bind(this)).then(this._fetchShop.bind(this)).then(this._fetchPricing.bind(this)).then(this._fetchDiscounts.bind(this)).then(this._initCostingComponent.bind(this))},_initCostingComponent:function(){return new c({shop:this.shop,pricing:this.pricing,discountFactory:this.discountFactory,discounts:this.discounts,readOnly:this.readOnly})},_fetchPricing:function(){return this.pricing=this.pricingFactory.createModel(o.Types.SHOP),this.pricing.setParentResourceId(this.shopID),this.pricing.fetchPromise().catch(function(t){return 404===t.options.request.xhr.status?t.model.savePromise():e.reject()})},_fetchDiscounts:function(){return this.discounts=this.discountFactory.createCollection(r.Types.SHOP),this.discounts.setParentResourceId(this.shopID),this.discounts.fetchPromise()},_fetchShop:function(){return this.shop=this.shopFactory.createModel(s.Types.SHOP,{id:this.shopID}),this.shop.fetchPromise({uc2:!0})},_initFactories:function(t){var i=this;return this.factories=n.getInstance(t),e.all([this.factories.getFactory(n.Types.SHOP),this.factories.getFactory(n.Types.PRICING),this.factories.getFactory(n.Types.DISCOUNT)]).then(function(t){i.shopFactory=t[0],i.pricingFactory=t[1],i.discountFactory=t[2]})}})});