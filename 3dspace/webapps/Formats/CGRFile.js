/*!  COPYRIGHT DASSAULT SYSTEMES 2014   */
var Uint16HalfFloatToFloat,byteArrayReader=function(e){this.buffer=e,this.currentPosition=0,this.readAt=function(e){return this.buffer[e]},this.length=function(){return buffer.length},this.getCurrentPosition=function(){return this.currentPosition},this.setPosition=function(e){this.currentPosition=e},this.read=function(){return this.buffer[this.currentPosition++]},this.readDouble=function(e,r){return new DataView(buffer.buffer).getFloat64(e,!0)},this.readUcompressedInt=function(e){return e?(this.read()<<24|this.read()<<16|this.read()<<8|this.read())>>>0:(this.read()|this.read()<<8|this.read()<<16|this.read()<<24)>>>0},this.readInt=function(e){return e?this.read()<<24|this.read()<<16|this.read()<<8|this.read():this.read()|this.read()<<8|this.read()<<16|this.read()<<24},this.clone=function(){return new byteArrayReader(this.buffer)},this.getDataViews=function(e,r){return views=[],views.push({dataView:new DataView(this.buffer.buffer,e,r),buffer:this.buffer,offset:e}),views}};{var mantissatable=new Array(2048),exponenttable=new Array(64),offsettable=new Array(64);function convertMantissa(e){for(var r=e<<13,t=0;!(8388608&r);)t-=8388608,r<<=1;return(r&=-8388609)|(t+=947912704)}mantissatable[0]=0;for(var i=1;i<1024;i++)mantissatable[i]=convertMantissa(i);for(i=1024;i<2048;i++)mantissatable[i]=939524096+(i-1024<<13);exponenttable[0]=0;for(i=1;i<31;i++)exponenttable[i]=i<<23;exponenttable[31]=1199570944,exponenttable[32]=2147483648;for(i=33;i<63;i++)exponenttable[i]=i-32+2147483648<<23;exponenttable[63]=3347054592,offsettable[0]=0,offsettable[32]=0;for(i=1;i<64;i++)32!==i&&(offsettable[i]=1024);var uint32Array=new Uint32Array(1),float32Array=new Float32Array(uint32Array.buffer);Uint16HalfFloatToFloat=function(e){return uint32Array[0]=mantissatable[offsettable[e>>10]+(1023&e)]+exponenttable[e>>10],float32Array[0]}}var one_over_65535=1/65535,Uint16PositionsToFloats=function(e,r,t,i,s){for(var n=t.length/3,a=[Math.max(s.x-i.x,1e-6)*one_over_65535,Math.max(s.y-i.y,1e-6)*one_over_65535,Math.max(s.z-i.z,1e-6)*one_over_65535],o=[Math.floor(i.x/a[0]),Math.floor(i.y/a[1]),Math.floor(i.z/a[2])],p=e;p<n+e;p++){var h=t[3*p],u=t[3*p+1],f=t[3*p+2];r[3*p]=(o[0]+h)*a[0],r[3*p+1]=(o[1]+u)*a[1],r[3*p+2]=(o[2]+f)*a[2]}},setOctohedralToFloatArray=function(e,r,t,i){var s=2*r-1,n=2*t-1,a=1-Math.abs(s)-Math.abs(n);if(a<=0){var o=(1-Math.abs(n))*(s>=0?1:-1),p=(1-Math.abs(s))*(n>=0?1:-1);s=o,n=p}var h=Math.sqrt(s*s+n*n+a*a);e[3*i]=s/h,e[3*i+1]=n/h,e[3*i+2]=a/h},Oct24NormalsToFloats=function(e,r,t){for(var i=t.length/3,s=e;s<i+e;s++){var n=t[3*s],a=t[3*s+1],o=t[3*s+2],p=(16*n+Math.floor(a/16))/4095;setOctohedralToFloatArray(r,p,(a%16*256+o)/4095,s)}},Oct16NormalsToFloats=function(e,r,t){for(var i=t.length/2,s=e;s<i+e;s++){var n=t[2*s]/255,a=t[2*s+1]/255;setOctohedralToFloatArray(r,n,a,s)}};define("DS/Formats/CGRFile",["DS/Mesh/Mesh","DS/Mesh/ThreeJS_Base"],function(e,r){"use strict";var t=!1,s=!1,n=!1,a=!1,o=!1,p=!1,h=0,u=!1,f=!1,d=!1,c=!1,l=!1,v=new Float32Array(100),m=new Int16Array(100),y=new Uint16Array(100),g=new Uint8Array(100),x=255,B=80,A=81,I=82,b=83,C=84,w=85,S=86,P=87,M=88,T=89,F=119,U=156,R=157,N=160,G=1,O=2,E=1,V=2,D=4,k=8,L=16,_=0,j=!1,z=0,W=0,H=(new Map([["segoeuiz.ttf",{fontName:"Segoe UI",italic:!0,bold:!0}],["segoeui.ttf",{fontName:"Segoe UI",italic:!1,bold:!1}],["segoeuib.ttf",{fontName:"Segoe UI ",italic:!1,bold:!0}],["segoeuii.ttf",{fontName:"Segoe UI ",italic:!0,bold:!1}],["seguisb.ttf",{fontName:"Segoe UI Semibold",italic:!1,bold:!1}],["DSISO1.otf",{fontName:"DS ISO 1",italic:!1,bold:!1}],["DSISO1I.otf",{fontName:"DS ISO 1",italic:!0,bold:!1}],["DSISO1BI.otf",{fontName:"DS ISO 1",italic:!0,bold:!0}],["DSISO1B.otf",{fontName:"DS ISO 1",italic:!1,bold:!0}],["DroidSerif-Bold.ttf",{fontName:"Droid Serif",italic:!1,bold:!0}],["DroidSerif.ttf",{fontName:"Droid Serif",italic:!1,bold:!1}],["DroidSerif-Italic.ttf",{fontName:"Droid Serif",italic:!0,bold:!1}],["3ds Bold Italic.ttf",{fontName:"3ds",italic:!0,bold:!0}],["3ds Bold.ttf",{fontName:"3ds",italic:!1,bold:!0}],["3ds Italic.ttf",{fontName:"3ds",italic:!0,bold:!1}],["3ds Regular.ttf",{fontName:"3ds",italic:!1,bold:!1}]]),0),q=1,Y=2,X=3,Z=4,Q=5,J=6,K=7,$=8,ee={NEAREST:0,LINEAR:1,NEAREST_MIPMAP_NEAREST:2,NEAREST_MIPMAP_LINEAR:3,LINEAR_MIPMAP_NEAREST:4,LINEAR_MIPMAP_LINEAR:5},re=1,te=2,ie=3,se=5,ne=6,ae={LAYER_MAX:4294967295,LAYER_MAX_MINUS_ONE:4294967294,STREAM_NONE:0,STREAM_MATERIAL:1,STREAM_INHERIT_INT:2,STREAM_INHERIT_UINT:4,STREAM_INHERIT_ULONG:8,STREAM_LAYER_INT:16,STREAM_LAYER_UINT:32,STREAM_LAYER_ULONG:64,STREAM_UVTRANSFO:128,STREAM_MAPPING_INFO:256,STREAM_LIGHTMAP:512,STREAM_ALL_INT:915,STREAM_ALL_UINT:933,STREAM_ALL_ULONG:969},oe=1,pe=0,he=1,ue=3,fe=4,de=5,ce=6,le=7,ve=function(t,i){this.name=i,this.conversion=!1,this.version=0,this.bitBoolean=0,this.bitPacking=0,this.intPacking=0,this.gasPacking=0,this.global_gas=[];var s=!0;this.expandCGR=!1;var n=[];this.isInherit=!1,this.idOrder=0,this.semanticType=0,this.textures=new Us,this.materials=new Us,this.fakeMultiRep=new Us,this.reps=[],this.reps[H]=new Us,this.reps[Y]=new Us,this.reps[J]=new Us,this.reps[X]=new Us,this.reps[K]=new Us,this.reps[Z]=new Us,this.reps[Q]=new Us,this.reps[q]=new Us,this.reps[$]=new Us,this.currentDGs=[],this.currentAttr=null,this.mergeDGs=[],this.filterSceneGraphOrder=264241288,this.axisSystems=new Us,this.curvedPipes=new Us,this.canonicals=new Us,this.sgRep=[],this.nbRep=0,this.decorations=new multiTabDecorations,this.refPlanes=new Us,this.arrows=new Us,this.voxelReps=new Us,this.texts=new Us,this.currentMatrix=[],this.staticMode=[],this.fixedSizeMode=!1,this.multiRefNode=new Us,this.buffer=t,this.numberOfVertices=0,this.cgrContainer=null,this.bitContainer=0,this.bitsRemaining=0,this.nbBitsPerVertex=0;var a=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535,131071,262143,524287,1048575,2097151,4194303,8388607,16777215,33554431,67108863,134217727,268435455,536870911,1073741823,2147483647],o=0,p=[0,0,2,2,3,3,3,3,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9];this.isLightScenegraph=function(){return!1},this.setSemanticType=function(e){this.semanticType=e},this.getSemanticType=function(){return this.semanticType},this.createMatrix3=function(e){return[e[0],e[1],0,e[2],e[3],0,e[4],e[5],1]},this.finalizeMergeDGs=function(){this.currentDGs.sort(function(e,r){if(e.glType<r.glType)return-1;if(e.glType>r.glType)return 1;if(null==e.material&&null!=r.material)return-1;if(null!=e.material&&null==r.material)return 1;if(null!=e.material&&null!=r.material){if(e.material.id<r.material.id)return-1;if(e.material.id>r.material.id)return 1;if(e.material.file<r.material.file)return-1;if(e.material.file>r.material.file)return 1}if(null==e.gas&&null!=r.gas)return-1;if(null!=e.gas&&null==r.gas)return-1;if(null!=e.gas&&null!=r.gas){if(e.gas.set<r.gas.set)return 1;if(r.gas.set<e.gas.set)return-1;if(e.gas.rgba<r.gas.rgba)return 1;if(r.gas.rgba<e.gas.rgba)return-1}if(e._geomType&&r._geomType){if(e._geomType<r._geomType)return-1;if(e._geomType>r._geomType)return 1}return 0});for(var e=0;e<this.currentDGs.length;e++)this.mergeDGs.push(this.currentDGs[e]);this.currentDGs=[],this.currentAttr=null},this.setDGs=function(e){for(var r=0;r<e.length;r++){var t=e[r];if(this.currentDGs.length){var i=this.currentAttr.material;if((null==i&&null==t.material||null!=i&&null!=t.material&&i.id==t.material.id&&i.file==t.material.file)&&(t.gas.set&this.filterSceneGraphOrder)==this.currentAttr.set&&t.gas.rgba==this.currentAttr.rgba)this.currentDGs.push(t);else{this.currentDGs.sort(function(e,r){if(e.glType<r.glType)return-1;if(e.glType>r.glType)return 1;if(null==e.material&&null!=r.material)return-1;if(null!=e.material&&null==r.material)return 1;if(null!=e.material&&null!=r.material){if(e.material.id<r.material.id)return-1;if(e.material.id>r.material.id)return 1;if(e.material.file<r.material.file)return-1;if(e.material.file>r.material.file)return 1}if(null==e.gas&&null!=r.gas)return-1;if(null!=e.gas&&null==r.gas)return-1;if(null!=e.gas&&null!=r.gas){if(e.gas.set<r.gas.set)return 1;if(r.gas.set<e.gas.set)return-1;if(e.gas.rgba<r.gas.rgba)return 1;if(r.gas.rgba<e.gas.rgba)return-1}if(e._geomType&&r._geomType){if(e._geomType<r._geomType)return-1;if(e._geomType>r._geomType)return 1}return 0});for(var s=0;s<this.currentDGs.length;s++)this.mergeDGs.push(this.currentDGs[s]);this.currentDGs=[],this.currentDGs.push(t),this.currentAttr={mat:t.material,gas:t.gas}}}else this.currentDGs.push(t),this.currentAttr={mat:t.material,gas:t.gas}}},this.addReps=function(e,r,t,i,s){var n=0|(i?1:0)<<1|(r?1:0);return s&&(n=8),this.expandCGR&&(n=0),0==n&&1==h&&this.setDGs(e.drawingGroups),{renderType:n,indice:this.reps[n].add(e)}},this.setReps=function(e){this.reps=e},this.getAllReps=function(){return this.reps},this.initReps=function(){this.reps=[],this.reps[H]=new Us,this.reps[Y]=new Us,this.reps[J]=new Us,this.reps[X]=new Us,this.reps[K]=new Us,this.reps[$]=new Us,this.reps[Z]=new Us,this.reps[Q]=new Us,this.reps[q]=new Us},this.getReps=function(e,r){return this.reps[r].get(e)},this.getBytesRemain=function(){return this.buffer.getBytesRemain()},this.readString=function(e){for(var r=new String,t=0;t<e;t++){r+=String.fromCharCode(this.buffer.read())}return r},this.readStringWithLength=function(e){for(var r=new String,t=(e=this.readCompressedInt(),0);t<e;t++){r+=String.fromCharCode(this.buffer.read())}return r},this.readUnicodeString=function(e){for(var r=new String,t=0;t<e-1;t++){var i=this.readUnsignedShort();r+=String.fromCharCode(i)}return this.readUnsignedShort(),r},this.setCurrentPosition=function(e){return!(this.buffer.buffer&&e>this.buffer.buffer.length)&&(this.buffer.setPosition(e),!0)},this.getCurrentPosition=function(){return this.buffer.getCurrentPosition()},this.skip=function(e){this.buffer.setPosition(this.buffer.getCurrentPosition()+e)},this.readClassName=function(){return this.readUnsignedChar()},this.getUnstreamer=function(e){switch(e){case 97:return new Br;case 98:return new Ui;case 99:return new mr;case 100:return new ir;case 101:return new fr;case 102:return new Oi;case 103:return new yi;case 104:return new Ir;case 112:return new Vi;case 113:return new sr;case 114:return new dr;case 115:return new xr;case 116:return new cr;case 120:return new ur;case 137:return new Ei;case 145:case 146:return new yi;case 147:return new Zi;case 148:return new yi;case 149:return new pr;case 150:return new yi;case 152:return new Qi;case 153:return new Ar;case 154:return new Ji;case 158:return new lr;case 159:return new vr;case 161:return new br;case 163:return new Xi;case 170:return new gr;case 171:return new yr;case 172:return new Cr;case 173:return new wr;case 174:return new Pr;case 175:return new Mr;case 176:return new Sr;case 179:return new $i;case 181:return new yi;case 182:return new rs;case 183:return new es;case 184:return new Ki;case 185:return new Ri;case 186:return new Ni;case 188:return new yi;case 189:return new Gi;case 192:return new ns;case 193:return new as;case 194:return new os;case 195:return new ps;case 196:return new hs;case 197:return new us;case 198:return new fs;case 199:return new ds;case 201:return new cs;case 255:return new mi;default:return this.error="file is corrupted.  unknown className..."+e,null}},this.readGraphicAttributeSet=function(){var r=new e.GraphicAttributeSet(this.readUncompressedInt(),this.readUncompressedInt());return r.set=268435384&r.set,r},this.readMatrix=function(){var e=[],t=0;if(this.version>=210021610){var i=this.readCompressedInt(),s=this.readUnsignedChar(),n=[];this.readDoubles(n,s);var a=0;for(t=0,a=0;t<16;t++)switch((i&3<<2*t)>>2*t){case 0:e[t]=n[a++];break;case 1:case-1:e[t]=0;break;case-2:case 2:e[t]=1;break;case 3:case-3:e[t]=-1}}else for(t=0;t<16;++t)e.push(this.readFloat());var o=new r.Matrix4;return o.set(e[0],e[4],e[8],e[12],e[1],e[5],e[9],e[13],e[2],e[6],e[10],e[14],e[3],e[7],e[11],e[15]),o},this.read2DMatrix=function(){var e=[],t=0;for(t=0;t<16;++t)e.push(this.readFloat());var i=new r.Matrix4;return i.set(e[0],e[4],e[8],e[12],e[1],e[5],e[9],e[13],e[2],e[6],e[10],e[14],e[3],e[7],e[11],e[15]),i},this.readFloatArray=function(e,r,t){this.buffer.readFloatArray(e,r,t,this.conversion)},this.readFloatArrayBuffer=function(e,r){this.buffer.readFloatArrayBuffer(e,r,this.conversion)},this.readUnsignedShortArray=function(e,r,t){this.buffer.readUnsignedShortArray(e,r,t,!0)},this.readUnsignedShortArrayBuffer=function(e,r){this.buffer.readUnsignedShortArrayBuffer(e,r,this.conversion)},this.readDouble=function(){return this.buffer.readDouble(this.conversion)},this.readDoubles=function(e,r){for(var t=0;t<r;++t)e.push(this.readDouble())},this.getNumberOfVertices=function(){return this.numberOfVertices},this.setNumberOfVertices=function(e){if(this.numberOfVertices=e,this.bitPacking){if(e<500)return void(o=p[this.numberOfVertices]);o=0;var r=e;do{++o}while(r>>=1)}},this.setContainer=function(e){this.cgrContainer=e},this.getContainer=function(){return this.cgrContainer},this.readBits=function(e){var r;if(e<=this.bitsRemaining)r=this.bitContainer&a[e],this.bitContainer>>=e,this.bitsRemaining-=e;else if(e<=32){r=0;var t=e;r|=this.bitContainer&a[this.bitsRemaining],t-=this.bitsRemaining,this.bitContainer=this.readUncompressedInt(),r|=(this.bitContainer&a[t])<<this.bitsRemaining,this.bitContainer>>=t,this.bitsRemaining=32-t}else{var i=0;t=e;do{for(;this.bitsRemaining&&t;)r|=(1&this.bitContainer)<<i++,bitContainer>>=1,this.bitsRemaining--,t--;t&&(this.bitContainer=this.readUncompressedInt(),this.bitsRemaining=32)}while(t)}return r},this.readBit=function(){var e=0;return this.bitsRemaining?(e=1&this.bitContainer,this.bitContainer>>=1,this.bitsRemaining--,e):(this.bitContainer=this.readUncompressedInt(),e=1&this.bitContainer,this.bitContainer>>=1,this.bitsRemaining=31,e)},this.readBoolean=function(){return this.bitBoolean?this.readBit():this.readUnsignedChar()},this.readPositions=function(e,r,t){var i=3*e;if(this.readBoolean())this.readFloatArray(i,3*r,t);else{var s=Math.ceil(r/4),n=this.buffer.getByteView(s,g),a=this.readCompressedInt();a>v.length&&(v=new Float32Array(a)),this.readFloatArrayBuffer(a,v);for(var o=0,p=0,h=0,u=0,f=0,d=0,c=0,l=0;l<r;l++){0==p&&(c=3&n[o]),1==p&&(c=(12&n[o])>>2),2==p&&(c=(48&n[o])>>4),3==p&&(c=(192&n[o])>>6,p=-1,o++),p++;0==c?(t[i++]=v[h],t[i++]=v[h+1],t[i++]=v[h+2],u=v[h],f=v[h+1],d=v[h+2],h+=3):2==c?(t[i++]=u,t[i++]=f,t[i++]=v[h],d=v[h],h++):3==c?(t[i++]=u,t[i++]=v[h],t[i++]=v[h+1],f=v[h],d=v[h+1],h+=2):(t[i++]=u,t[i++]=f,t[i++]=d)}}},this.readQuantPositions=function(e,r){var t=0;if(this.readBoolean())this.readUnsignedShortArray(0,3*e,r);else{var i=Math.ceil(e/2),s=this.buffer.getByteView(i,g),n=this.readCompressedInt();n>y.length&&(y=new Uint16Array(n)),this.readUnsignedShortArrayBuffer(n,y);for(var a=0,o=0,p=0,h=0,u=0,f=0,d=0,c=0;c<e;c++){0==o&&(d=3&s[a]),1==o&&(d=(12&s[a])>>2),2==o&&(d=(48&s[a])>>4),3==o&&(d=(192&s[a])>>6,o=-1,a++),o++;0==d?(r[t++]=y[p],r[t++]=y[p+1],r[t++]=y[p+2],h=y[p],u=y[p+1],f=y[p+2],p+=3):2==d?(r[t++]=h,r[t++]=u,r[t++]=y[p],f=y[p],p++):3==d?(r[t++]=h,r[t++]=y[p],r[t++]=y[p+1],u=y[p],f=y[p+1],p+=2):(r[t++]=h,r[t++]=u,r[t++]=f)}}},this.readOldPositionsArrayBuffer=function(e,r,t){if(this.readBoolean())for(var i=0;i<e;++i)r[t++]=this.readFloat();else{var s=Math.ceil(e/12),n=new Uint8Array(s);this.readBytes(s,n);var a=this.readCompressedUInt(),o=new Float32Array(a);for(i=0;i<a;++i)o[i]=this.readFloat();var p=0,h=0,u=0,f=0,d=0,c=0;for(i=0;i<e/3;i++){0==h&&(flagvalue=3&n[p]),1==h&&(flagvalue=(12&n[p])>>2),2==h&&(flagvalue=(48&n[p])>>4),3==h&&(flagvalue=(192&n[p])>>6,h=-1,p++),h++;var l=3*i;0==flagvalue?(r[3*t+l]=o[u],r[3*t+l+1]=o[u+1],r[3*t+l+2]=o[u+2],f=o[u],d=o[u+1],c=o[u+2],u+=3):2==flagvalue?(r[3*t+l]=f,r[3*t+l+1]=d,r[3*t+l+2]=o[u],c=o[u],u++):3==flagvalue?(r[3*t+l]=f,r[3*t+l+1]=o[u],r[3*t+l+2]=o[u+1],d=o[u],c=o[u+1],u+=2):(r[3*t+l]=f,r[3*t+l+1]=d,r[3*t+l+2]=c)}}},this.readPositionsArrayBuffer=function(e,r,t){if(this.readBoolean())for(var i=0;i<3*e;++i)r[3*t+i]=this.readFloat();else{var s=Math.ceil(e/4),n=new Uint8Array(s);this.readBytes(s,n);var a=this.readCompressedInt(),o=new Float32Array(a);for(i=0;i<a;++i)o[i]=this.readFloat();var p=0,h=0,u=0,f=0,d=0,c=0,l=0;for(i=0;i<e;i++){0==h&&(l=3&n[p]),1==h&&(l=(12&n[p])>>2),2==h&&(l=(48&n[p])>>4),3==h&&(l=(192&n[p])>>6,h=-1,p++),h++;var v=3*i;0==l?(r[3*t+v]=o[u],r[3*t+v+1]=o[u+1],r[3*t+v+2]=o[u+2],f=o[u],d=o[u+1],c=o[u+2],u+=3):2==l?(r[3*t+v]=f,r[3*t+v+1]=d,r[3*t+v+2]=o[u],c=o[u],u++):3==l?(r[3*t+v]=f,r[3*t+v+1]=o[u],r[3*t+v+2]=o[u+1],d=o[u],c=o[u+1],u+=2):(r[3*t+v]=f,r[3*t+v+1]=d,r[3*t+v+2]=c)}}},this.readNormalsArrayBuffer=function(e,r,t){if(0!=e){var i=1/32767;if(this.version>1101220){var s=this.readCompressedInt();s>m.length&&(m=new Int16Array(s)),this.buffer.readShortArrayBuffer(s,m,this.conversion),(v=Math.ceil(e/2))>g.length&&(g=new Uint8Array(v));for(var n=this.buffer.getByteView(v,g),a=-1,o=0,p=0,h=0,u=3*e,f=3*t,d=0;d<u;d++){switch(d%2?(240&n[a])>>4:15&n[++a]){case 0:p=r[f+1]=m[o++]*i,h=r[f+2]=m[o++]*i,r[f]=Math.sqrt(1-(p*p+h*h));break;case 1:p=r[f+1]=m[o++]*i,h=r[f+2]=m[o++]*i,r[f]=-Math.sqrt(1-(p*p+h*h));break;case 2:p=r[f]=m[o++]*i,h=r[f+2]=m[o++]*i,r[f+1]=Math.sqrt(1-(p*p+h*h));break;case 3:p=r[f]=m[o++]*i,h=r[f+2]=m[o++]*i,r[f+1]=-Math.sqrt(1-(p*p+h*h));break;case 4:p=r[f]=m[o++]*i,h=r[f+1]=m[o++]*i,r[f+2]=Math.sqrt(1-(p*p+h*h));break;case 5:p=r[f]=m[o++]*i,h=r[f+1]=m[o++]*i,r[f+2]=-Math.sqrt(1-(p*p+h*h));break;case 6:r[f]=1,r[f+1]=0,r[f+2]=0;break;case 7:r[f]=-1,r[f+1]=0,r[f+2]=0;break;case 8:r[f]=0,r[f+1]=1,r[f+2]=0;break;case 9:r[f]=0,r[f+1]=-1,r[f+2]=0;break;case 10:r[f]=0,r[f+1]=0,r[f+2]=1;break;case 11:r[f]=0,r[f+1]=0,r[f+2]=-1}f+=3}}else{var c=[],l=(i=1/32767,e/3);this.readShortArray(2*l,c);var v=Math.ceil(l/8);n=new Uint8Array(v);n=this.buffer.getByteView(v,g);var y,x,B=0,A=(a=-1,0);for(o=0,d=0;A<e;A+=3,o+=2,d++){var I;if(r[A]=c[o]*i,r[A+1]=c[o+1]*i,0==(B=d%8)&&a++,(x=1-(r[A]*r[A]+r[A+1]*r[A+1]))<=0)y=0;else for(p=x<=.03?.05:.25+x*(.25+1/(1+x));;){if((I=p-(y=.5*(p+x/p)))<i&&I>-i){p=y;break}p=y}r[A+2]=n[a]&1<<B?-y:y}}}},this.readNormals=function(e,r,t){var i=3*e;if(0!=r){if(this.version>1101220){var s=this.readCompressedInt();s>m.length&&(m=new Int16Array(s)),this.buffer.readShortArrayBuffer(s,m,this.conversion);var n=Math.ceil(r/2);n>g.length&&(g=new Uint8Array(n));for(var a=this.buffer.getByteView(n,g),o=-1,p=0,h=0,u=0,f=3*r,d=0;d<f/3;d++){switch(d%2?(240&a[o])>>4:15&a[++o]){case 0:h=m[p++]*(1/32767),u=m[p++]*(1/32767),t[i++]=Math.sqrt(1-(h*h+u*u)),t[i++]=h,t[i++]=u;break;case 1:h=m[p++]*(1/32767),u=m[p++]*(1/32767),t[i++]=-Math.sqrt(1-(h*h+u*u)),t[i++]=h,t[i++]=u;break;case 2:h=m[p++]*(1/32767),u=m[p++]*(1/32767),t[i++]=h,t[i++]=Math.sqrt(1-(h*h+u*u)),t[i++]=u;break;case 3:h=m[p++]*(1/32767),u=m[p++]*(1/32767),t[i++]=h,t[i++]=-Math.sqrt(1-(h*h+u*u)),t[i++]=u;break;case 4:h=m[p++]*(1/32767),u=m[p++]*(1/32767),t[i++]=h,t[i++]=u,t[i++]=Math.sqrt(1-(h*h+u*u));break;case 5:h=m[p++]*(1/32767),u=m[p++]*(1/32767),t[i++]=h,t[i++]=u,t[i++]=-Math.sqrt(1-(h*h+u*u));break;case 6:t[i++]=1,t[i++]=0,t[i++]=0;break;case 7:t[i++]=-1,t[i++]=0,t[i++]=0;break;case 8:t[i++]=0,t[i++]=1,t[i++]=0;break;case 9:t[i++]=0,t[i++]=-1,t[i++]=0;break;case 10:t[i++]=0,t[i++]=0,t[i++]=1;break;case 11:t[i++]=0,t[i++]=0,t[i++]=-1}3}}}},this.readOctNormals=function(e,r){if(0!=e&&this.version>1101220){var t=this.readUncompressedULong();this.readBytes(t,r)}},this.readTextures=function(e,r,t,i){var s=t*r;if(3!=t){var n=0,a=0,o=new Float32Array(s);if(this.readFloatArray(0,s,o),1==t)for(n=0;n<s;n++)i[3*e+a++]=o[n],i[3*e+a++]=0,i[3*e+a++]=0;else if(2==t)for(n=0;n<s;n+=2)i[3*e+a++]=o[n],i[3*e+a++]=o[n+1],i[3*e+a++]=0}else this.readFloatArray(3*e,s,i)},this.unpackcArray=function(e,r,t){if(this.bitPacking)for(var i=0;i<e;++i)r[i+t]=this.readBits(o);else if(this.version>=1100600&&this.numberOfVertices<256)this.buffer.readBytes(t,e,r);else if(this.numberOfVertices<65536)this.buffer.readUnsignedShortArray(t,e,r,!1);else if(this.numberOfVertices<16777216)this.buffer.unpackc24(t,e,r);else for(i=0;i<e;++i)r[i+t]=this.readCompressedInt()},this.unpackc=function(){return this.bitPacking?this.readBits(o):this.version>=1100600&&this.numberOfVertices<256?this.readUnsignedChar():this.numberOfVertices<65536?this.readUnsignedChar()<<8&65280|255&this.readUnsignedChar():this.numberOfVertices<16777216?this.readUnsignedChar()<<16&16711680|this.readUnsignedChar()<<8&65280|255&this.readUnsignedChar():this.readCompressedInt()},this.getFixMode=function(){return this.fixedSizeMode},this.setFixMode=function(e){this.fixedSizeMode=e},this.getStaticMode=function(){if(this.staticMode.length){var e=this.staticMode[this.staticMode.length-1];if(e)return e}return null},this.pushStaticMode=function(e){this.staticMode.push(e)},this.popStaticMode=function(){this.staticMode.pop()},this.isASMColor=function(){return!!this.global_gas.length&&this.global_gas[this.global_gas.length-1].asmColor},this.getGAS=function(r){if(this.global_gas.length){var t=this.global_gas[this.global_gas.length-1].inherited,i=this.global_gas[this.global_gas.length-1].asmColor;return i&&r==e.ConnectivityTypeEnum.TRIANGLES&&(t.setRGBAColorRGBChannel(i[0],i[1],i[2]),t.setRGBAColorAlphaChannel(i[3])),t}},this.pushGAS=function(e,r){var t,i=0,s=null;if(this.global_gas.length){var n=this.global_gas[this.global_gas.length-1];if(i=n.inh_mode,t=n.inherited,s=n.asmColor,4&i){e.setColor(t.getColor());var a=t.getRGBAColor();e.setRGBAColorRGBChannel(a[0],a[1],a[2])}if(4096&i){a=t.getRGBAColor();e.setRGBAColorAlphaChannel(a[3])}16&i&&e.setLineThickness(t.getLineThickness()),64&i&&e.setLinetype(t.getLinetype());var o=t.isHidden();o&&e.setShowMode(o)}return 1024&r&&(s=e.getDisplayedColor()),this.global_gas.push({inh_mode:i|r,inherited:e,asmColor:s}),e},this.popGAS=function(){return this.global_gas.pop()},this.popMatId=function(){if(n.length>0){var e=n.pop();return e.inherit&&(this.isInherit=!1),e}return{file:"",id:-1}},this.pushMatId=function(e,r,t,i){var s=ae.LAYER_MAX,a=null;n.length>0&&(s=(p=n[n.length-1]).layer,a=p.rep);if(t!==s)if(t<s&&0!==r){var o=!0;1==this.isInherit&&(o=!1),this.isInherit=!0,n.push({file:e.file,id:e.id,inherit:o,layer:t,rep:i})}else{if(n.length>0)(p=n[n.length-1])&&n.push({file:p.file,id:p.id,inherit:!1,layer:p.layer,rep:p.rep})}else if(t==ae.LAYER_MAX_MINUS_ONE||a===i)if(2==r||1==r&&!this.isInherit){o=!0;1==this.isInherit&&(o=!1),this.isInherit=!0,n.push({file:e.file,id:e.id,inherit:o,layer:t,rep:i})}else if(this.isInherit||0!=r){if(n.length>0)(p=n[n.length-1])&&n.push({file:p.file,id:p.id,inherit:!1,layer:p.layer,rep:p.rep})}else n.push({file:"",id:-1,inherit:!1,layer:t,rep:i});else if(0!==r){o=!0;1==this.isInherit&&(o=!1),this.isInherit=!0,n.push({file:e.file,id:e.id,inherit:o,layer:t,rep:i})}else{var p;if(n.length>0)(p=n[n.length-1])&&n.push({file:p.file,id:p.id,inherit:!1,layer:p.layer,rep:p.rep})}},this.check=function(){0!=n.length&&console.warn("material stack length = "+n.length),0!=this.global_gas.length&&console.warn("GAS stack length = "+this.global_gas.length),0!=this.currentMatrix.length&&console.warn("currentMatrix stack length = "+this.currentMatrix.length)},this.pushMatrix=function(e){var t,i=this.currentMatrix[this.currentMatrix.length-1];return null==i?t=e:(t=new r.Matrix4).multiplyMatrices(i,e),this.currentMatrix.push(t),t},this.popMatrix=function(){return this.currentMatrix.pop()},this.getLightDataStreaming=function(){return s},this.setLightDataStreaming=function(e){s=e},this.copyStreamerInheritance=function(e){e.setLightDataStreaming(this.getLightDataStreaming()),e.conversion=this.conversion,e.version=this.version,e.global_gas=this.global_gas,e.textures=this.textures,e.materials=this.materials,e.decorations=this.decorations,e.sgRep=this.sgRep,e.nbRep=this.nbRep,e.currentDGs=this.currentDGs,e.mergeDGs=this.mergeDGs,e.currentAttr=this.currentAttr},this.getCurrentMatrix=function(){return 0!=this.currentMatrix.length?this.currentMatrix[this.currentMatrix.length-1]:null},this.getCurrentMatId=function(){var e=n[n.length-1];return e?{file:e.file,id:e.id}:null}};ve.prototype.readFloat=function(){return this.buffer.readFloat(this.conversion)},ve.prototype.readUnsignedChar=function(){return this.buffer.read()},ve.prototype.readBytes=function(e,r){for(var t=0;t<e;t++)r[t]=this.buffer.read()},ve.prototype.readShortArray=function(e,r){this.buffer.readShortArray(0,e,r,this.conversion)},ve.prototype.readUnsignedShort=function(){return this.conversion?this.buffer.read()<<8|this.buffer.read():this.buffer.read()|this.buffer.read()<<8},ve.prototype.readShort=function(){var e=this.buffer.read(),r=this.buffer.read();if(this.conversion){var t=(127&e)<<8|r;return t-=(128&e)<<8}t=(127&r)<<8|e;return t-=(128&r)<<8},ve.prototype.readUncompressedULong=function(){return this.buffer.readUncompressedULong(this.conversion)},ve.prototype.readUncompressedUInt=function(){return this.buffer.readUncompressedInt(this.conversion)},ve.prototype.readUncompressedInt=function(){return this.buffer.readInt(this.conversion)},ve.prototype.readUncompressedIntArray=function(e,r){for(var t=0;t<e;t++)r[t]=this.readUncompressedInt()},ve.prototype.readCompressedUInt=function(){if(this.intPacking)return this.readCompressedInt();if(this.version>=1101410){var e=this.readUnsignedChar();return 255==e?this.buffer.readInt(this.conversion):e}return this.buffer.readInt(this.conversion)},ve.prototype.readCompressedInt=function(){if(this.version>=1100600){var e=this.buffer.read();return e<255?e:this.buffer.readInt(this.conversion)}return this.buffer.readInt(this.conversion)};var me=function(e){e.readUncompressedInt(!1),e.readUncompressedInt(!1);e.readUncompressedInt(!1);e.readUncompressedInt(!1);if((4294967295&e.readUncompressedInt(!1))<<32,gs){e.readUncompressedInt(!1);(4294967295&e.readUncompressedInt(!1))<<32;e.readUncompressedInt(!1);(4294967295&e.readUncompressedInt(!1))<<32;e.readUncompressedInt(!1),e.readUncompressedInt(!1),e.readUncompressedInt(!1),e.readUncompressedInt(!1),e.readUncompressedInt(!1);var r=new Uint8Array(8);e.readBytes(8,r),e.readUncompressedInt(!1),e.readUncompressedInt(!1)}},ye=function(e){this.offset=e.readUncompressedInt(!1),this.length=e.readUncompressedInt(!1);e.readUncompressedInt(!1);this.beginPos=e.readUncompressedInt(!1);e.readUncompressedInt(!1)},ge=function(e,r){e.readUncompressedInt(!1);this.id=e.readUncompressedInt(!1);e.readUnsignedShort(!1),new me(e);var t=e.readUncompressedInt(!1);this.blocs=[];var i=[];if(t>0)for(var s=0;s<t;++s)this.blocs.push(new ye(e));if(r>0){e.readUncompressedInt(!1),e.readUncompressedInt(!1);for(s=0;s<r;++s)i.push(new ls(e))}this.getRootTocEntry=function(){for(var e=0;e<i.length;++e){i[e].fatherId;if(0==i[e].fatherId)return i[e]}},this.getChildEntryByFatherId=function(e,r){for(var t=0;t<i.length;++t)if(i[t].fatherId==e&&i[t].name==r)return i[t]},this.getChildEntry=function(e,r){return this.getChildEntryByFatherId(e.getId(),r)}},xe=0,Be=1,Ae=-1159921408,Ie=-86375937,be=122298,Ce=-16655622,we=-86376192,Se=121594,Pe=-86376177,Me=251779834,Te=6,Fe=7,Ue=8,Re=9,Ne=1,Ge=2,Oe=3,Ee=4,Ve=function(e,r,t){this._xSize=e,this._ySize=r,this._format=t,this.unstream=function(e,r){var t,i,s,n,a=1,o=1;e.conversion;n=e.readCompressedInt();var p=re;if(n==Ae||n==be?t=e.readCompressedInt():n==Ie||n==Ce?t=e.readCompressedInt():n==we||n==Se||n==Pe||n==Me||(t=n),n!=we&&n!=Se&&n!=Pe&&n!=Me){i=e.readCompressedInt(),C=e.readCompressedInt(),s=e.readCompressedInt();e.readCompressedInt();if(a=e.readFloat(),o=e.readFloat(),0==s)return null;S=new Uint8Array(C),e.readBytes(C,S)}else{switch(e.readCompressedInt()){case Ne:return t=e.readCompressedInt(),i=e.readCompressedInt(),C=e.readCompressedInt(),s=e.readCompressedInt(),e.readCompressedInt(),a=e.readFloat(),o=e.readFloat(),-1;case Ge:if(t=e.readCompressedInt(),i=e.readCompressedInt(),C=e.readCompressedInt(),s=e.readCompressedInt(),e.readCompressedInt(),a=e.readFloat(),o=e.readFloat(),4!=s)return null;s=0,S=new Uint8Array(t*i);for(var h=[0,1,2,3,new Map([[7,2],[8,3],[11,4],[12,5],[14,6],[15,7]]),new Map([[19,8],[20,9],[7,10],[8,11],[27,64],[18,128]]),new Map([[24,1664],[23,192],[8,12],[3,13],[52,14],[53,15],[42,16],[43,17],[7,1]]),new Map([[39,18],[12,19],[8,20],[23,21],[3,22],[4,23],[40,24],[43,25],[19,26],[36,27],[24,28],[55,256]]),new Map([[53,0],[2,29],[3,30],[26,31],[27,32],[18,33],[19,34],[20,35],[21,36],[22,37],[23,38],[40,39],[41,40],[42,41],[43,42],[44,43],[45,44],[4,45],[5,46],[10,47],[11,48],[82,49],[83,50],[84,51],[85,52],[36,53],[37,54],[88,55],[89,56],[90,57],[91,58],[74,59],[75,60],[50,61],[51,62],[52,63],[54,320],[55,384],[100,448],[101,512],[104,576],[103,640]]),new Map([[204,704],[205,768],[210,832],[211,896],[212,960],[213,1024],[214,1088],[215,1152],[216,1216],[217,1280],[218,1344],[219,1408],[152,1472],[153,1536],[154,1600],[155,1728]]),new Map([[15,64],[55,0],[23,16],[24,17],[8,18]]),new Map([[8,1792],[12,1856],[13,1920]]),new Map([[18,1984],[19,2048],[20,2112],[21,2176],[22,2240],[23,2304],[28,2368],[29,2432],[30,2496],[31,2560]])],u=[0,1,new Map([[3,2],[2,3]]),new Map([[3,4],[2,1]]),new Map([[3,5],[2,6]]),new Map([[3,7]]),new Map([[5,8],[4,9]]),new Map([[4,10],[5,11],[7,12]]),new Map([[4,13],[7,14]]),new Map([[24,15]]),new Map([[15,64],[23,16],[24,17],[8,18],[55,0]]),new Map([[8,1792],[12,1856],[13,1920],[103,19],[104,20],[108,21],[55,22],[40,23],[23,24],[24,25]]),new Map([[18,1984],[19,2048],[20,2112],[21,2176],[22,2240],[23,2304],[28,2368],[29,2432],[30,2496],[31,2560],[202,26],[203,27],[204,28],[205,29],[104,30],[105,31],[106,32],[107,33],[210,34],[211,35],[212,36],[213,37],[214,38],[215,39],[108,40],[109,41],[218,42],[219,43],[84,44],[85,45],[86,46],[87,47],[100,48],[101,49],[82,50],[83,51],[36,52],[55,53],[56,54],[39,55],[40,56],[88,57],[89,58],[43,59],[44,60],[90,61],[102,62],[103,63],[200,128],[201,192],[91,256],[51,320],[52,384],[53,448]]),new Map([[108,512],[109,576],[74,640],[75,704],[76,768],[77,832],[114,896],[115,960],[116,1024],[117,1088],[118,1152],[119,1216],[82,1280],[83,1344],[84,1408],[85,1472],[90,1536],[91,1600],[100,1664],[101,1728]])],f=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191],d=[4096,6144,7168,7680,7936,8064,8128,8160,8176,8184,8188,8190,8191],c=function(e,r,t){var i,s=0,n=0,a=Math.floor(t/8),o=t%8;if(r.length<a)return null;i=r[a],r.length>a+1&&(s=r[a+1]),r.length>a+2&&(n=r[a+2]);var p=e?h:u,c=e?4:2,l=0,v=0;if(o>3){v=((i&f[8-o])<<5+o)+(m=s<<o-3)+(n>>11-o)}else{var m=s;o<3&&(m=s>>3-o),v=((i&f[8-o])<<5+o)+m}for(;c<14;){var y=(v&d[c-1])>>13-c;if(null!=(l=p[c].get(y)))break;c++}return c<14?{runLength:l,codeLength:c}:null},l=0;l<i;l++){var v=!0,m=e.readCompressedInt();if(!(m>0))return null;var y=new Uint8Array(m);e.readBytes(m,y);for(var g=0,x=0,B=0;g<t;){var A=c(v,y,x);if(!A)return null;if(B+=A.runLength,x+=A.codeLength,!(A.runLength>63)){for(var I=v?255:0,b=0;b<B;b++)S[l*t+g+b]=I;v=!v,g+=B,B=0}}}break;case Oe:var C;if(t=e.readCompressedInt(),i=e.readCompressedInt(),C=e.readCompressedInt(),s=e.readCompressedInt(),e.readCompressedInt(),a=e.readFloat(),o=e.readFloat(),!(n!=Pe&&n!=Me||s!=Te&&s!=Fe&&s!=Ue&&s!=Re))e.readCompressedInt();S=new Uint8Array(C),e.readBytes(C,S);break;case Ee:p=ie,t=e.readCompressedInt(),i=e.readCompressedInt();var w=e.readCompressedInt();s=e.readCompressedInt(),e.readCompressedInt(),a=e.readFloat(),o=e.readFloat();var S=new Uint8Array(w);if(!w)return null;e.readBytes(w,S)}}return{img:S,width:t,height:i,format:s,url:r,xPixelSize:a,yPixelSize:o,imgType:p}}},De=function(e,r,t){Ve.call(this,e,r,t)};(De.prototype=Object.create(Ve.prototype)).constructor=Ve;var ke=function(){this.createTexture=function(e,r){var t={mipmaps:[],width:0,height:0,format:null,mipmapCount:1,url:r,imgType:te};if(0==e.readCompressedInt()){e.readCompressedInt();if(t.mipmapCount=e.readCompressedUInt(),t.width=e.readCompressedUInt(),t.height=e.readCompressedUInt(),t.format=e.readCompressedInt(),0==t.mipmapCount)return!1;for(var i=t.width,s=t.height,n=1;n<=t.mipmapCount;n++){var a=(new Ve).unstream(e,r);if(3==t.format)return a;if(3==a.imgType)return a;t.mipmaps.push({data:a.img,width:a.width,height:a.height}),(s/=2)<1&&(s=1),(i/=2)<1&&(i=1)}}return t}},Le=function(){this.unstream=function(e,r){var t=(new Ve).unstream(e,r);if(null===t)return null;var i=e.readStringWithLength().split("\\");r=i[i.length-1];return t.url=r,t}},_e=function(){this.unstream=function(e,r){var t={mipmaps:[],width:0,height:0,format:null,mipmapCount:1,url:r,imgType:te};if(0==e.readCompressedInt()){var i=e.readCompressedInt();t.mipmapCount=e.readCompressedUInt(),t.width=e.readCompressedUInt(),t.height=e.readCompressedUInt(),t.format=e.readCompressedInt(),t.streamCmpFormat=i,0==t.mipmapCount&&0;for(var s=t.width,n=t.height,a=1;a<=t.mipmapCount;a++){var o=(new Ve).unstream(e,r);if(3==t.format)return o;t.mipmaps.push({data:o.img,width:o.width,height:o.height}),(n/=2)<1&&(n=1),(s/=2)<1&&(s=1)}}else 0;return t}},je=function(){this.unstream=function(r){var t=new e.Material,i=(r.readCompressedInt(),r.readFloat()),s=r.readFloat(),n=r.readFloat();t.colorAmbient[0]=i,t.colorAmbient[1]=s,t.colorAmbient[2]=n;var a=r.readFloat(),o=r.readFloat(),p=r.readFloat();t.colorDiffuse[0]=a,t.colorDiffuse[1]=o,t.colorDiffuse[2]=p;var h=r.readFloat(),u=r.readFloat(),f=r.readFloat();if(t.colorSpecular[0]=h,t.colorSpecular[1]=u,t.colorSpecular[2]=f,t.shininess=r.readFloat(),t.shininess*=255,t.ambientCoef=r.readFloat(),t.diffuseCoef=r.readFloat(),t.specularCoef=r.readFloat(),t.transparent=r.readFloat(),t.reflectivityCoef=r.readFloat(),r.version>=210042310)r.readBoolean();var d=r.version<2100190&&r.version>=21e5||r.version<1102110;if(r.readUnsignedChar())if(d){if(r.readUnsignedChar()){var c;if(c=r.readCompressedInt(),r.textures.isValidMultiRefIndex(c)){var l=r.textures.getIndex(c);t.textureId=l}else{var v=(new Le).unstream(r),m=r.textures.add(v);r.textures.addMultiRefIndex(c,m),t.textureId=m}}else{v=(new Le).unstream(r),m=r.textures.add(v);t.textureId=m}}else{var y,g=r.getContainer();if(g&&(y=g.getResourceCGRContainer()),y){m=y.getResource(r);t.textureId=m}}switch(t.textureImageNumberComposante=r.readCompressedInt(),t.textureBlending=r.readCompressedInt(),t.magFilter=r.readCompressedInt(),t.minFilter=r.readCompressedInt(),r.readCompressedInt()){case 0:t.mappingFunction="USER_MAPPING";break;case 3:t.mappingFunction="SPHERICAL_ENV_MAP"}if((t.textureWrapS=r.readCompressedInt(),t.textureWrapT=r.readCompressedInt(),t.addedComposantInTexEnv=r.readCompressedInt(),r.skip(76),!d)&&r.readUnsignedChar()){t.textureId=-1;var x=7==r.readCompressedInt(),B=new Ye;B.unstream(r),B&&(t.shaderMaterial={name:B.name,param:B.parameters,PDSFX:x})}return t}},ze=function(){this.skip=function(e){this.unstream(e,!0)},this.unstreamTexture=function(e){var r=1,t=0,i=0;if(e.version>=210041930&&(i=e.readCompressedInt(),e.textures.isValidMultiRefIndex(i)&&(t=e.textures.getIndex(i),r=0)),r){var s=(new Ve).unstream(e);null!=s&&(t=e.textures.add(s)),s&&e.version>=210041930&&e.textures.addMultiRefIndex(i,t)}return t},this.unstream=function(e,r){var t=-1,i={};r||(i=(new je).unstream(e));var s=e.readStringWithLength();i.physicalMaterial=JSON.parse(s);var n=e.readCompressedUInt(),a=e.readCompressedUInt(),o=i.physicalMaterial.Version,p=0;if(i.physicalMaterial&&i.physicalMaterial.PhysicalMaterial&&i.physicalMaterial.PhysicalMaterial.MappingOperator&&i.physicalMaterial.PhysicalMaterial.MappingOperator.UvTransformation){var h=i.physicalMaterial.PhysicalMaterial.MappingOperator.UvTransformation;i.physicalMaterial.PhysicalMaterial.MappingOperator.UvTransformation=[h[0],h[1],h[2],h[4],h[5],h[6],h[8],h[9],h[10]]}o&&o>=3&&(p=e.readCompressedUInt());var u=e.readBoolean(),f=!1;o&&o>=.2&&(f=e.readBoolean());for(var d=0;d<n;d++){var c=!1;t=-1;var l=e.readStringWithLength();if(o>0&&(c=e.readBoolean()),(t=c?this.unstreamTexture(e):qe(e))>=0)i.physicalMaterial.PhysicalMaterial.FloatParameter[l].Texture=t}for(d=n;d<a+n;d++){c=!1;t=-1;l=e.readStringWithLength();if(o>0&&(c=e.readBoolean()),(t=c?this.unstreamTexture(e):qe(e))>=0)i.physicalMaterial.PhysicalMaterial.Float3Parameter[l].Texture=t}t=-1;var v=null;for(i.physicalMaterial.PhysicalMaterial&&i.physicalMaterial.PhysicalMaterial.MapParameter&&(v=i.physicalMaterial.PhysicalMaterial.MapParameter.normalMap),u&&(t=qe(e))>=0&&(v?v.Texture=t:i.physicalMaterial.PhysicalMaterial.NormalMap.Texture=t),f&&qe(e),d=0;d<p;d++){c=!1;t=-1;l=e.readStringWithLength();var m=i.physicalMaterial.PhysicalMaterial.MapParameter[l];o>0&&(c=e.readBoolean()),(t=c?this.unstreamTexture(e):qe(e))>=0&&m&&(m.Texture=t)}return i}};const We=new Uint8Array([171,75,84,88,32,50,48,187,13,10,26,10]);var He=function(){this.unstream=function(e){var r,t={};if(r=e.readCompressedInt(),e.materials.isValidMultiRefIndexWithName(r,e.name))w=e.materials.getIndexWithName(r,e.name),t=e.materials[w];else{var i=e.readStringWithLength(),s=JSON.parse(i);if(s.images&&s.textures){var n,a=e.getContainer();a&&(n=a.getResourceCGRContainer());var o=[];if(n)for(var p=0;p<s.images.length;p++){var h=n.getImage(e,s.images[p].byteOffset,s.images[p].byteOffset+s.images[p].byteLength);o.push(h)}var u=[];if(s.images&&s.images.length)for(p=0;p<s.images.length;p++)u.push(!1);var f=[];for(p=0;p<s.textures.length;p++){var d=!1,c=s.textures[p];if(u[c.image]&&(d=!0),u[c.image]=!0,h.imgType===se){for(var l=new Uint8Array(h.img.buffer),v=!0,m=0;m<We.length;m++)if(l[m]!==We[m]){v=!1;break}v&&(h.imgType=ne)}var y={noTransferable:d,mipmaps:(h=o[c.image]).mipmaps,format:h.format,height:h.height,width:h.width,img:h.img,imgType:h.imgType,wrap:[1,1],filter:[1,1]};if(c.uWrap&&"REPEAT"!=c.uWrap&&(y.wrap[0]=0),c.vWrap&&"REPEAT"!=c.vWrap&&(y.wrap[1]=0),c.magFilter&&(y.filter[1]=ee[c.magFilter]),c.minFilter&&(y.filter[0]=ee[c.minFilter]),c.uvTransform){var g=c.uvTransform;1==g[0]&&0==g[1]&&0==g[2]&&1==g[3]&&0==g[4]&&0==g[5]||(y.uvTransform=c.uvTransform)}var x=e.textures.add(y);f.push(x)}}var B=s.materials[0],A=t;if("Visu.Basic"==B.type){if(t.colorDiffuse=B.DiffuseColor,t.diffuseCoef=B.DiffuseCoeff,t.colorAmbient=B.AmbientColor,t.ambientCoef=B.AmbientCoeff,t.colorSpecular=B.SpecularColor,t.specularCoef=B.SpecularCoeff,t.reflectivityCoef=B.ReflectionCoeff,t.textureId=B.Texture?f[B.Texture.texture]:void 0,null!=t.textureId){var I=e.textures.get(t.textureId);t.minFilter=I.filter[0],t.magFilter=I.filter[1],t.textureWrapS=I.wrap[0],t.textureWrapT=I.wrap[1]}t.shininess=255*B.ShininessCoeff,t.transparency=B.TransparencyCoeff,t.alphaTest=.5*B.IsAlphaTestEnabled}else if("Visu.SpecularGlossiness"==B.type||"Visu.SpecularGlossiness@17x"==B.type||"Visu.SpecularGlossiness@21x"==B.type||"Visu.EVisuPBR"==B.type||"Visu.DSPBR@21x"==B.type||"Visu.DSPBR@22x"==B.type){for(var b in B){void 0!==(C=B[b]).texture&&(C.texture=f[C.texture])}t.physicalMaterial={},(t=t.physicalMaterial).PhysicalMaterial=B,t.PhysicalMaterial.isVisDescription=!0}else if("Visu.ShaderOverride"==B.type){for(var b in B){var C;void 0!==(C=B[b]).texture&&(C.imgId=f[C.texture])}t.shaderMaterial={name:B.shaderName,param:B,PDSFX:!0}}var w=e.materials.add(A);e.materials.addMultiRefIndexWithName(r,w,e.name)}return A}},qe=function(e){var r,t=-1,i=e.getContainer();i&&(r=i.getResourceCGRContainer());return r&&(t=r.getResource(e)),t},Ye=function(){this.parameters={},this.name="",this.unstream=function(e){this.parametersUnstream(e);var r,t=e.getContainer();if(t&&(r=t.getResourceCGRContainer()),r)var i=r.getResourceShader(e);if(null===i)return null;i&&(this.name=i.name)},this.parametersUnstream=function(e){for(var r=e.readCompressedInt(),t=[],i=0;i<r;++i)t[i]=e.readStringWithLength();var s=e.readCompressedInt();for(i=0;i<s;++i){switch(e.readCompressedInt()){case 0:e.readCompressedInt();break;case 1:e.readCompressedInt();var n=e.readFloat(),a=t[i];this.parameters[a]=n;break;case 2:e.readCompressedInt();var o=[];e.readFloatArray(0,4,o);a=t[i];this.parameters[a]=o;break;case 4:e.readCompressedInt();var p,h=e.getContainer();h&&(p=h.getResourceCGRContainer());var u="";if(p){var f=p.getResource(e);ms[f]&&ms[f].url&&(u=ms[f].url)}a=t[i];this.parameters[a]={imgId:f,url:u};break;case 5:case 6:e.readCompressedInt(),o=[];e.readFloatArray(0,4,o);a=t[i];this.parameters[a]=o}}}},Xe=function(){this.name="",this.unstream=function(e){var r=e.readStringWithLength(),t=r.lastIndexOf("\\");-1!==t&&(r=r.substring(t+1,r.length)),-1!==(t=r.lastIndexOf("."))&&(r=r.substring(0,t));var i=e.readCompressedInt();e.skip(i),this.name=r}},Ze=function(){this.unstream=function(e){for(var r=[],t=0;t<2;t++){if(e.readUnsignedChar()){var i=0;if(e.readUnsignedChar())if(i=e.readCompressedInt(),e.materials.isValidMultiRefIndexWithName(i,e.name))r[t]=e.materials.getIndexWithName(i,e.name);else{var s=(1===(a=e.readCompressedInt())?new Ze:new je).unstream(e);if(1===a)n=s;else var n=e.materials.add(s);e.materials.addMultiRefIndexWithName(i,n,e.name),r[t]=n}else{var a;s=(1===(a=e.readCompressedInt())?new Ze:new je).unstream(e);n=1===a?s:e.materials.add(s),r[t]=n}}}return r[0]}},Qe=function(){this.posBuffer=[],this.normalBuffer=[],this.textureBuffer=[],this.uvsBuffer=[],this.binormalsBuffer=[],this.tangentsBuffer=[],this.numberOfVertices=0};Qe.prototype.getNumberOfVertices=function(){return this.numberOfVertices},Qe.prototype.unstream=function(e){var r;this.numberOfVertices=e.readCompressedInt(),r=e.readCompressedInt(),this.hasTextures=e.readUnsignedChar(),this.hasUVs=e.readUnsignedChar(),this.hasTangentsBinormals=e.readUnsignedChar();var t=0;if(this.hasTextures&&(t=e.readUnsignedChar(),e.readTextures(0,this.numberOfVertices,t,this.textureBuffer)),this.numberOfVertices&&e.readPositions(0,this.numberOfVertices,this.posBuffer,0),r&&e.readNormals(0,r,this.normalBuffer,0),this.hasUVs&&this.numberOfVertices)if(f)e.readTextures(0,this.numberOfVertices,2,this.textureBuffer);else{var i=new Float32Array(2*this.numberOfVertices);e.readFloatArray(0,2*this.numberOfVertices,i)}if((this.hasTangentsBinormals&&(e.readFloatArray(0,3*this.numberOfVertices,this.tangentsBuffer),e.readFloatArray(0,3*this.numberOfVertices,this.binormalsBuffer)),e.version>=210041920)&&e.readUnsignedChar()){var s=e.readCompressedInt();if(s>0)for(var n=0;n<s;++n){var a=e.readUnsignedChar();e.readStringWithLength();e.skip(4*a*this.numberOfVertices)}}},Qe.prototype.allocateBuffers=function(){this.posBuffer=new Array(3*this.numberOfVertices),this.totalNumberOfNormals&&(this.normalBuffer=new Array(3*this.totalNumberOfNormals)),this.hasTextures&&(this.textureBuffer=new Array(3*this.numberOfVertices)),this.hasUVs&&(this.uvsBuffer=new Array(2*this.numberOfVertices)),this.hasTangentsBinormals&&(this.tangentsBuffer=new Array(3*this.numberOfVertices),this.binormalsBuffer=new Array(3*this.numberOfVertices))};var Je=function(){Qe.call(this),this.totalNumberOfNormals=0,this.nbTexCoords=0,this.hasTextures=!1,this.hasUVs=!1,this.hasTangentsBinormals=!1};(Je.prototype=new Qe).constructor=Je,Je.prototype.partUnStreamHeader=function(e){this.numberOfVertices=e.readCompressedInt(),this.totalNumberOfNormals=e.readCompressedInt();var r=e.readUnsignedChar();if(this.hasTextures=1&r,this.hasUVs=2&r,this.hasTangentsBinormals=4&r,this.hasExtraTextures=16&r,this.hasTextures&&(this.nbTexCoords=e.readUnsignedChar()),this.hasExtraTextures){this.nbExtraTextureSet=e.readCompressedInt(),this.extraTextureSet=[];for(var t=0;t<this.nbExtraTextureSet;++t){var i=e.readUnsignedChar(),s=e.readStringWithLength();this.extraTextureSet.push({dimension:i,identifier:s})}}this.allocateBuffers()},Je.prototype.partUnStream=function(e,r,t,i,s){var n=j?W:0;if(i)switch(j?z:0){case 0:e.readPositions(r,i,this.posBuffer);break;case D:var a=new Array(3*i);e.readQuantPositions(i,a),Uint16PositionsToFloats(r,this.posBuffer,a,nr,ar);break;default:throw"Uknown position quantization"}if(this.totalNumberOfNormals)switch(n){case 0:e.readNormals(t,s,this.normalBuffer);break;case k:var o=new Array(2*s);e.readOctNormals(s,o),Oct16NormalsToFloats(t,this.normalBuffer,o);break;case L:o=new Array(3*s);e.readOctNormals(s,o),Oct24NormalsToFloats(t,this.normalBuffer,o);break;default:throw"Uknown normals quantization"}if(this.hasTextures&&e.readTextures(r,i,this.nbTexCoords,this.textureBuffer),this.hasUVs&&this.numberOfVertices&&e.readFloatArray(2*r,2*i,this.uvsBuffer),this.hasTangentsBinormals&&(e.readFloatArray(3*r,3*i,this.tangentsBuffer),e.readFloatArray(3*r,3*i,this.binormalsBuffer)),this.nbExtraTextureSet>0&&e.version>=210041920)for(var p=0;p<this.nbExtraTextureSet;++p){var h=this.extraTextureSet[p].dimension;e.skip(4*h*i)}};var Ke=function(){this.geomType=0,this.nbPrimitives=0,this.primitives=[],this.attribute=null,this.material={file:"",id:-1},this.skip=!1};Ke.prototype.unstreamPrimSet=function(e){var r=e.readCompressedInt();this.geomType=xi[r],this.nbPrimitives=e.readCompressedInt(),12==r?this.skip=!0:this.primitives=new Array(this.nbPrimitives);for(var t=0;t<this.nbPrimitives;++t){var i=null;switch(e.readUnsignedChar()){case 1:i=new Ai;break;case 2:i=new Si;break;case 3:i=new Mi;break;case 4:console.log("primitive type not handled..");break;case 5:i=new Ti;break;case 6:i=new Fi;break;default:console.log("primitive type not handled..")}i&&(this.skip?i.skip(e):(i.unstream(e),this.primitives[t]=i))}};var $e=function(){Ke.call(this)};($e.prototype=Object.create(Ke.prototype)).constructor=$e,$e.prototype.unstream=function(r){if(this.unstreamPrimSet(r),this.skip)r.skip(8*this.nbPrimitives);else for(var t=0;t<this.primitives.length;++t){var i=r.readGraphicAttributeSet();r.pushGAS(i,0);var s=r.getGAS(this.primitives[t].connectivity);s.setConnectivity(this.primitives[t].connectivity);var n=s.isNoZ();"WIRE_EDGE"!==this.geomType&&(s.setLineThickness(1),s.setLinetype(e.LinePatternEnum.SOLID)),"BOUNDARY_EDGE"!=this.geomType&&"SHARP_EDGE"!=this.geomType&&"SMOOTH_EDGE"!=this.geomType&&"EDGE"!=this.geomType||s.setRGBAColorAlphaChannel(255),n&&(this.noZ=!0),this.primitives[t].symbol&&s.setSymbol(this.primitives[t].symbol),this.primitives[t].gas=s,r.popGAS()}};var er=function(){Ke.call(this)};(er.prototype=Object.create(Ke.prototype)).constructor=er,er.prototype.unstream=function(r){this.unstreamPrimSet(r);var t=r.readGraphicAttributeSet();r.pushGAS(t,0);var i=r.getGAS(null);i.isNoZ()&&"BOUNDARY_POINT"!=this.geomType&&"SHARP_POINT"!=this.geomType&&"SMOOTH_POINT"!=this.geomType&&"SURFACIC_POINT"!=this.geomType&&"FREE_POINT"!=this.geomType&&(this.noZ=!0),"BOUNDARY_EDGE"!=this.geomType&&"SHARP_EDGE"!=this.geomType&&"SMOOTH_EDGE"!=this.geomType&&"EDGE"!=this.geomType||i.setRGBAColorAlphaChannel(255),"WIRE_EDGE"!==this.geomType&&(i.setLineThickness(1),i.setLinetype(e.LinePatternEnum.SOLID));for(var s=0;s<this.primitives.length;++s){var n=i.clone();n.setConnectivity(this.primitives[s].connectivity),this.primitives[s].symbol&&n.setSymbol(this.primitives[s].symbol),this.primitives[s].gas=n}r.popGAS()};var rr=function(){Ke.call(this)};(rr.prototype=Object.create(Ke.prototype)).constructor=rr,rr.prototype.unstream=function(e){$e.prototype.unstream.call(this,e);for(var r=0,t=[],i=this.primitives.length,s=0;s<i;s++)t[s]=[];if(e.version>=210041800&&(r=e.readCompressedUInt()),r>0){if(e.readUnsignedChar()){for(s=0;s<r;s++){if(e.readUnsignedChar()){for(var n={material:null,inheritanceMaterial:null,layer:null},a=(e.readStringWithLength(),e.readCompressedUInt()),o=0;o<a;o++){t[e.readCompressedUInt()].push(n)}if((c=e.readCompressedUInt())>0)for(o=0;o<c;o++){var p=this.materialApplicationUnstream(e,ae.STREAM_ALL_UINT);if(o==c-1){if(p.mapping){var h=e.materials.get([p.material.id]);h&&(h.mapping=p.mapping)}p.material.primWithMaterials=!0,n.material=p.material,n.inheritanceMaterial=p.inheritanceMaterial,n.layer=p.layer}}}}for(s=0;s<i;s++){var u=this.primitives[s],f=t[s];for(o=0;o<f.length;o++)e.pushMatId(f[o].material,f[o].inheritanceMaterial,f[o].layer,this);u.material=e.getCurrentMatId(),u.material&&(u.material.primWithMaterials=!0);for(o=0;o<f.length;o++)e.popMatId()}e.version;var d=e.readCompressedUInt();for(s=0;s<d;++s){var c;e.readUncompressedInt();if((c=e.readCompressedUInt())>0)for(o=0;o<c;++o){p=this.materialApplicationUnstream(e,ae.streamSettings);0==c&&(e.pushMatId(p.material,p.inheritanceMaterial,p.layer,this),l=e.getCurrentMatId(),e.popMatId())}}}}else for(s=0;s<this.nbPrimitives;s++){if(e.readUnsignedChar()){var l=(p=this.materialApplicationUnstream(e,ae.STREAM_MATERIAL)).material;l.primWithMaterials=!0,this.skip||(this.primitives[s].material=l)}}},rr.prototype.unstreamMaterial=function(e){var r,t={file:"",id:-1},i=0,s=e.readUnsignedChar(),n=0,a=null;if(s){if(2==s){e.readStringWithLength();return i=e.readCompressedInt(),t.id=e.materials.add({external3DXid:i}),t}if(n=e.readCompressedInt(),e.materials.isValidMultiRefIndexWithName(n,e.name))return t={file:"",id:f=e.materials.getIndexWithName(n,e.name)}}if(e.version>=210021320){var o=e.readCompressedInt();a=1===o?new Ze:4===o?new ze:9===o&&e.version>=210042100?new He:new je}else a=new je;r=a.unstream(e);var p=e.getCurrentPosition(),h=e.getBytesRemain();h>32&&(h=32);var u=e.readString(h);(e.setCurrentPosition(p),-1!==u.indexOf('{\n"Version" : '))&&(new ze).skip(e);if(1===o)var f=r;else f=e.materials.add(r);return t={file:"",id:f},s&&e.materials.addMultiRefIndexWithName(n,f,e.name),t},rr.prototype.materialApplicationUnstream=function(e,r){var t={material:null,inheritanceMaterial:1,layer:0};if(r&ae.STREAM_MATERIAL&&(t.material=this.unstreamMaterial(e)),e.version>=1100500?r&ae.STREAM_INHERIT_INT?t.inheritanceMaterial=e.readCompressedInt():r&ae.STREAM_INHERIT_UINT?t.inheritanceMaterial=e.readCompressedInt():r&ae.STREAM_INHERIT_ULONG&&(t.inheritanceMaterial=e.readUncompressedInt()):r&(ae.STREAM_INHERIT_INT|ae.STREAM_INHERIT_UINT|ae.STREAM_INHERIT_ULONG)&&(t.inheritanceMaterial=1),r&ae.STREAM_LAYER_INT?t.layer=e.readUncompressedInt():r&ae.STREAM_LAYER_UINT?t.layer=e.readCompressedInt():r&ae.STREAM_LAYER_ULONG&&(t.layer=e.readUncompressedUInt()),r&ae.STREAM_UVTRANSFO){if(e.version>=210041900){var i=[0,0,0,1];if(e.readBoolean()){var s=!0,n=e.readFloat(),a=e.readFloat(),o=e.readFloat(),p=e.readFloat();n!=i[0]&&(i[0]=n,s=!1),a!=i[1]&&(i[1]=a,s=!1),o!=i[2]&&(i[2]=o,s=!1),p!=i[3]&&(i[3]=p,s=!1),s||(t.mapping={type:0,ObjectTransformation:null,UvTransformation:null,UvTransfoInfos:i,transformSemantic:1})}}}if(r&ae.STREAM_MAPPING_INFO&&(e.version>=210042100&&!e.readBoolean())){var h=e.readStringWithLength();if(h=(h=JSON.parse(h)).mappings[h.uvSlots.Default],t.mapping||(t.mapping={type:0,ObjectTransformation:null,UvTransformation:null,UvTransfoInfos:null,transformSemantic:1}),h.uvTrfSemantic&&(t.mapping.transformSemantic=h.uvTrfSemantic+1),h.uvTransform&&(t.mapping.UvTransformation=e.createMatrix3(h.uvTransform)),h.operator&&(t.mapping.type=h.operator.type,h.operator.transform)){var u=h.operator.transform;t.mapping.ObjectTransformation=u}}if(r&ae.STREAM_LIGHTMAP&&(e.version>=210042320&&1==e.readCompressedInt()))e.readStringWithLength(),e.readCompressedInt(),e.readUncompressedULong();return t};var tr=function(){};tr.prototype.unstream=function(e){var r={};e.readCompressedInt();r.timestamp=e.readUncompressedULong();let t=e.readCompressedInt();return t&&(r.comment=e.readStringWithLength(t)),r.sagmode3D=e.readCompressedInt(),e.version>210041930?r.sag3D=e.readDouble():r.sag3D=e.readFloat(),r};var ir=function(){};ir.prototype.skip=function(e,r){var t=e.readCompressedInt();t<0&&(t=-t-2),e.skip(t-4)},ir.prototype.unstream=function(e,r){var t=new ei,i=e.readCompressedInt();i<0&&(i=-i-2);var s=!1;e.getCurrentPosition();t.rep.unstream(e),e.setNumberOfVertices(16777216);var n,a=e.readCompressedInt();if(a<=0)return e.popMatId(),e.popGAS(),null;for(var o=0;o<a;o++){switch(n=null,e.readUnsignedChar()){case B:case A:n=new Ur;break;case I:case b:n=new Ft;break;case C:n=new Dr;break;case w:n=new kr;break;case S:n=new Lr;break;case P:n=new Er;break;case M:n=new Vr;break;case T:n=new jr;break;case F:n=new zr;break;case U:n=new Wr;break;case R:n=new Hr;break;case N:n=new qr;break;case x:break;default:return}if(null!==n){n.unstream(e);var p,h,u=e.readGraphicAttributeSet();if(e.pushGAS(u,0),(p=e.getGAS(null)).isNoZ())s=!0,(h=e.popGAS()).inherited.setType(0),e.pushGAS(h.inherited,h.inh_mode);n.primitive&&n.primitive.symbol&&p.setSymbol(n.primitive.symbol),n.primitive&&p.setConnectivity(n.primitive.connectivity),t.addGP(n,p,e,r),e.popGAS()}else e.readGraphicAttributeSet()}(t.checkGP(e,r),s)||0==(p=e.getGAS(null)).getType()&&((h=e.popGAS()).inherited.setType(2),e.pushGAS(h.inherited,h.inh_mode));var f=t.addMesh(e);return t.imageRep.length?(t.imageRep.push(t.rep),t.imageRep):f?t.rep:null};var sr=function(){};sr.prototype.unstream=function(r){var t=new Yi,i=r.readCompressedInt();i<0&&(i=-i-2),t.rep.unstream(r);var s=r.readCompressedInt(),n=new e.PrimitiveGroup;n.fillAttr=new e.FillAttributes,n.lineAttr=new e.LineAttributes,n.pointAttr=new e.PointAttributes;for(var a,o=0;o<s;++o){var u=r.readUnsignedChar();switch(2==h&&r.idOrder++,a=null,u){case 121:a=new St;break;case 128:a=new Tt;break;case 129:a=new Pt;break;case 130:a=new Mt;break;case 131:a=new wt;break;case 132:a=new lt;break;case 135:a=new vt;break;case 136:a=new mt;break;case 164:a=new xt;break;case 165:a=new gt;break;case 166:a=new yt;break;case 167:a=new Bt;break;case 168:a=new At;break;case 169:a=new It;break;case 105:a=new bt}if(a){var f=a.unstream(r),d=r.readGraphicAttributeSet();r.pushGAS(d,0);var c=r.getGAS(a.primitive.connectivity);if(a.primitive&&a.primitive.symbol&&c.setSymbol(a.primitive.symbol),c.setBasic(),c.setConnectivity(a.primitive.connectivity),2==f&&d.getBlankingRep(),p&&a instanceof bt&&a.text){var l=c.getDisplayedColor(),v=-1;c.isNoZ()&&(v=c.getPriority()),a.text._noZPriority=v;var m=new e.Color(l[0]/255,l[1]/255,l[2]/255,l[3]/255);a.text.color=m,r.texts.add(a.text)}f&&t.addGP(a,c,r),r.popGAS()}}var y=t.addMesh(r);return t.imageRep.length?(t.imageRep.push(t.rep),t.imageRep):y?t.rep:null};var nr={x:0,y:0,z:0},ar={x:0,y:0,z:0},or=function(){};or.prototype.unstreamRep=function(e,r){r||(r=new ri);e.readCompressedInt();var t=!1;if(r.rep.unstream(e),e.version>=21e5&&!l){var i=0;(g=e.readUnsignedChar())&&(r.vertexBuffer=new Je,r.vertexBuffer.partUnStreamHeader(e),i=r.vertexBuffer.getNumberOfVertices());r.nbLODFaces=e.readUnsignedChar();var s=0;if(r.nbLODFaces){s=new Float32Array(r.nbLODFaces+1);e.readFloatArray(0,r.nbLODFaces+1,s)}else s=e.version>210041930?e.readDouble():e.readFloat();if(o&&(r.rep.node.sag=s),e.version>=210021620)e.readDouble();e.setNumberOfVertices(i);var n=0;r.posInNextStreamer=e.readCompressedInt();for(var a=0,p=0;n<=gi.LSG;)if(0!=r.nbLODFaces||n!=gi.LOD1&&n!=gi.LOD2&&n!=gi.LOD3&&n!=gi.FACES){if(0==r.nbLODFaces&&n==gi.LOD0){if(!(d=e.getContainer()))return e.error=" container not found",!1;var h=d.getStreamerByName("LOD0");if(e.copyStreamerInheritance(h),h){if(h.setCurrentPosition(r.posInNextStreamer),r.posInNextStreamer=h.readCompressedInt(),g){var u=h.readCompressedInt(),f=h.readCompressedInt();r.vertexBuffer.partUnStream(h,a,p,u,f),h.setNumberOfVertices(r.vertexBuffer.getNumberOfVertices())}r.unStreamFaces(h),r.sets[0]&&r.sets[0].noZ&&(t=!0)}}else if(n==gi.LOD0){if(!(d=e.getContainer()))return e.error=" container not found",!1;h=d.getStreamerByName("LOD0");if(e.copyStreamerInheritance(h),h&&(h.setCurrentPosition(r.posInNextStreamer),r.posInNextStreamer=h.readCompressedInt(),g)){u=h.readCompressedInt(),f=h.readCompressedInt();r.vertexBuffer.partUnStream(h,a,p,u,f),a+=u,p+=f}}if(n==gi.LOD1){if(!(d=e.getContainer()))return e.error=" container not found",!1;h=d.getStreamerByName("LOD1");if(e.copyStreamerInheritance(h),h&&(h.setCurrentPosition(r.posInNextStreamer),r.posInNextStreamer=h.readCompressedInt(),g)){u=h.readCompressedInt(),f=h.readCompressedInt();r.vertexBuffer.partUnStream(h,a,p,u,f),a+=u,p+=f}}if(n==gi.LOD2){if(!(d=e.getContainer()))return e.error=" container not found",!1;h=d.getStreamerByName("LOD2");if(e.copyStreamerInheritance(h),h&&(h.setCurrentPosition(r.posInNextStreamer),r.posInNextStreamer=h.readCompressedInt(),g)){u=h.readCompressedInt(),f=h.readCompressedInt();r.vertexBuffer.partUnStream(h,a,p,u,f),a+=u,p+=f}}if(n==gi.LOD3){if(!(d=e.getContainer()))return e.error=" container not found",!1;h=d.getStreamerByName("LOD3");if(e.copyStreamerInheritance(h),h&&(h.setCurrentPosition(r.posInNextStreamer),r.posInNextStreamer=h.readCompressedInt(),g)){u=h.readCompressedInt(),f=h.readCompressedInt();r.vertexBuffer.partUnStream(h,a,p,u,f),a+=u,p+=f}}if(n==gi.FACES){if(!(d=e.getContainer()))return e.error=" container not found",!1;h=d.getStreamerByName("FACES");if(e.copyStreamerInheritance(h),h){if(h.setCurrentPosition(r.posInNextStreamer),r.posInNextStreamer=h.readCompressedInt(),g){u=h.readCompressedInt(),f=h.readCompressedInt();h.setNumberOfVertices(a+u),r.vertexBuffer.partUnStream(h,a,p,u,f),a+=u,p+=f}else h.setNumberOfVertices(0);r.unStreamFaces(h),r.sets[0]&&r.sets[0].noZ&&(t=!0)}}if(n==gi.LSG){var d;if(!(d=e.getContainer()))return e.error=" container not found",!1;var c=d.getStreamerByName("LSG");if(c){e.copyStreamerInheritance(c),c.setNumberOfVertices(i),g?c.setNumberOfVertices(i):c.setNumberOfVertices(0),c.setCurrentPosition(r.posInNextStreamer),r.posInNextStreamer=c.readCompressedInt();var v=r.sets.length,m=c.readUnsignedChar();r.nbSets=m+v;for(var y=0;y<m;++y){switch(c.readUnsignedChar()){case 1:r.sets[y+v]=new er;break;case 2:r.sets[y+v]=new $e;break;default:return void(r.sets[y+v]=null)}if(r.sets[y+v])if(r.sets[y+v].unstream(c),r.sets[y+v].noZ)t=!0,(B=e.popGAS()).inherited.setType(0),e.pushGAS(B.inherited,B.inh_mode)}}}n++}else n++;if(!t)if(0==e.getGAS(null).getType())(B=e.popGAS()).inherited.setType(2),e.pushGAS(B.inherited,B.inh_mode)}else{var g;(g=e.readUnsignedChar())&&(r.vertexBuffer=new Je,r.vertexBuffer.unstream(e),e.setNumberOfVertices(r.vertexBuffer.getNumberOfVertices()));s=0;s=e.version>210041930?e.readDouble():e.readFloat(),r.nbLODFaces=e.readUnsignedChar(),o&&(r.rep.node.sag=s);for(y=0;y<r.nbLODFaces;++y){var x;switch(e.readUnsignedChar()){case 1:x=new Ai;break;case 4:x=new wi}x&&[].push(x.unstream(e)),e.readFloat(),e.readUncompressedInt();e.readUncompressedInt()}r.nbSets=e.readUnsignedChar();for(y=0;y<r.nbSets;++y){var B;switch(e.readUnsignedChar()){case 1:r.sets[y]=new er;break;case 2:r.sets[y]=new $e;break;default:return void(r.sets[y]=null)}if(r.sets[y])if(r.sets[y].unstream(e),r.sets[y].noZ)t=!0,(B=e.popGAS()).inherited.setType(0),e.pushGAS(B.inherited,B.inh_mode)}if(!t)if(0==e.getGAS(null).getType())(B=e.popGAS()).inherited.setType(2),e.pushGAS(B.inherited,B.inh_mode)}return r};var pr=function(){this.repPosInStreamer=0};pr.prototype=Object.create(or.prototype),pr.prototype.constructor=pr,pr.prototype.unstream=function(e){var r=new ri,t=this.unstreamRep(e,r);if(r.posInNextStreamer||(r.posInNextStreamer=0),e.version<21e5&&(r.posInNextStreamer=e.readCompressedInt()),!l){if(!t)return!1;var i=e.getContainer(),s=i?i.getStreamerByName("SurfacicReps"):e;i&&s.setCurrentPosition(r.posInNextStreamer),e.copyStreamerInheritance(s);var n=new hr;if(s)n.unstreamRep(s,r);else{if(s.cgrContainer)return;n.unstream(s,r)}}return!!t&&(r.addMesh(e)?r.rep:null)};var hr=function(){};hr.prototype.unStreamEdgeIndex=function(e){e.readCompressedInt(),e.readCompressedInt()},hr.prototype.unstreamRep=function(e,r){if(!(e.version<1101410)&&r){e.setLightDataStreaming(!1);e.readCompressedInt(),e.readFloat(),e.readFloat();if(e.version>=210041720)128&e.readUnsignedChar()&&e.skip(4);if(e.version>=210042320)e.readUnsignedChar();var t=r.getSet("FACE"),i=r.getSet("EDGE"),s=t.length,n=i.length,a=r.nbLODFaces,o=e.readCompressedInt(),p=new Ur;if(s)for(var h=0;h<s;h++){var u=t[h];p.unstream(e),u.cgmId=p.node.cgmId,u.decoration=p.decoration,u.boundingSphere=p.boundingSphere}for(h=0;h<a;h++)p.unstream(e);var f=new Gr;if(n&&i)for(h=0;h<n;h++){var d=i[h];f.unstream(e),d.cgmId=f.node.cgmId,d.decoration=f.decoration,this.unStreamEdgeIndex(e)}for(h=0;h<o;h++){var c=e.readCompressedInt();e.readUncompressedInt(),e.readUncompressedInt();if(e.version>=1101710&&e.version<210042440&&e.setLightDataStreaming(!0),c)for(var l=new Ft,v=0;v<c;v++)l.skip(e);e.version>=1101710&&e.version<210042440&&e.setLightDataStreaming(!1)}for(var m=r.nbSets,y=new Gr,g=new Dr,x=0;x<m;++x){var B=r.sets[x],A=B.primitives;for(v=0;v<A.length;v++){var I=A[v];if("FACE"!=B.geomType&&"EDGE"!=B.geomType&&"ISOPAR"!=B.geomType){var b=null,C=e.readUnsignedChar();switch(C){case 80:case 81:b=new Ur;break;case 82:b=new Ft;break;case 84:b=g;break;case 96:case 200:b=y;break;case 162:b=new Or;break;case 134:b=new Ut;break;case 86:b=new Lr;break;case 187:b=new Nr;break;default:return}b&&(b.unstream(e),I.cgmId=b.node.cgmId,I.decoration=b.decoration,I.boundingSphere=b.boundingSphere),96!=C&&200!=C&&162!=C||this.unStreamEdgeIndex(e)}}}e.setLightDataStreaming(!0)}};var ur=function(){};ur.prototype.unstream=function(r){var t=new vi,i=(r.readCompressedInt(),!1);t.nbIndicesTotal=0,t.vertexBuffer=new Qe;var s=null,n=null;t.rep.unstream(r);var a=r.readFloat();o&&(t.rep.node.sag=a);r.readFloat(),r.readFloat();r.version>=210041740&&(128&r.readUnsignedChar()&&r.skip(8));if(r.version>=210042320)r.readUnsignedChar();if(t.nbElEdge=r.readCompressedInt(),t.nbElEdge)for(var p=t.nbElEdge-1;p>=0;p--){(s=new Ft).primitive.indices=t.indexBuffer,s.vertexBuffer=t.vertexBuffer,s.unstream(r),s.primitive.cgmId=s.node.cgmId,s.decoration&&(s.primitive.decoration=s.decoration),t.nbIndicesTotal+=s.primitive.count;var h=r.readGraphicAttributeSet();if(r.pushGAS(h,0),(l=r.getGAS(e.ConnectivityTypeEnum.LINES)).setConnectivity(e.ConnectivityTypeEnum.LINES),r.popGAS(),l.isNoZ())i=!0,(v=r.popGAS()).inherited.setType(0),r.pushGAS(v.inherited,v.inh_mode);s.primitive.attr=l;for(var u=t.edgePrimitivesSets.length,f=0;f<u;f++){var d=t.edgePrimitivesSets[f];if(d.attr.set==s.primitive.attr.set&&d.attr.rgba==s.primitive.attr.rgba){d.set.push(s.primitive),d.nbIndices+=s.primitive.count;break}}if(f==t.edgePrimitivesSets.length)(m={}).attr=s.primitive.attr,m.nbIndices=s.primitive.count,m.set=[],m.set.push(s.primitive),t.edgePrimitivesSets.push(m)}if(t.nbElPoints=r.readCompressedInt(),t.nbElPoints){for(p=t.nbElPoints-1;p>=0;p--){(n=new Dr).vertexBuffer=t.vertexBuffer,n.primitive.indices=t.indexBuffer,n.unstream(r),n.primitive.cgmId=n.node.cgmId,n.decoration&&(n.primitive.decoration=n.decoration),t.nbIndicesTotal+=n.primitive.count;u=t.pointPrimimitivesSets.length;for(f=0;f<u;f++){var c=t.pointPrimimitivesSets[f];if(c.symbol==n.primitive.symbol){c.set.push(n.primitive),c.nbIndices+=n.primitive.count;break}}if(f==t.pointPrimimitivesSets.length)(m={}).symbol=n.primitive.symbol,m.nbIndices=n.primitive.count,m.set=[],m.set.push(n.primitive),t.pointPrimimitivesSets.push(m)}var l,v;h=r.readGraphicAttributeSet();if(r.pushGAS(h,0),(l=r.getGAS(e.ConnectivityTypeEnum.POINTS)).setConnectivity(e.ConnectivityTypeEnum.POINTS),r.popGAS(),l.isNoZ())i=!0,(v=r.popGAS()).inherited.setType(0),r.pushGAS(v.inherited,v.inh_mode);for(p=0;p<t.pointPrimimitivesSets.length;p++){var m;(m=t.pointPrimimitivesSets[p]).attr=l.clone(),m.attr.setSymbol(m.symbol)}}i||0==(l=r.getGAS(null)).getType()&&((v=r.popGAS()).inherited.setType(2),r.pushGAS(v.inherited,v.inh_mode));return t.addMesh(r)?t.rep:null};var fr=function(){};fr.prototype=Object.create(or.prototype),fr.prototype.constructor=fr,fr.prototype.unstream=function(e){var r=new ci,t=(e.readCompressedInt(),!0);if(r.rep.unstream(e),r.vertexBuffer=new Qe,r.nbLODFaces=e.readCompressedInt(),r.nbLODFaces>0){for(var i=[],n=1;n<=r.nbLODFaces;++n)i.push(e.readFloat());var a=new Er;t=a.unstream(e,r.vertexBuffer),r.sets.push(a),s&&(r.curveVertices=a.curveVertices,r.startNormal=a.startNormal,r.endNormal=a.endNormal,r.startSideVector=a.startSideVector,r.radius=a.radius);for(n=1;n<=r.nbLODFaces-2;n++){(new Er).skip(e)}(new Ft).skip(e)}return t?r.addMesh(e)?r.rep:null:(e.popMatId(),e.popGAS(),null)};var dr=function(){};dr.prototype=Object.create(or.prototype),dr.prototype.constructor=dr,dr.prototype.unstream=function(e){var r=new ni;e.readCompressedInt();if(r.rep.unstream(e),r.vertexBuffer=new Qe,r.nbLODFaces=e.readCompressedInt(),r.nbLODFaces>0){for(var t=[],i=0;i<r.nbLODFaces;++i)t.push(e.readFloat());for(i=0;i<r.nbLODFaces;++i)(new Ft).unstream(e)}return r.addMesh(e)?r.rep:null};var cr=function(){};cr.prototype=Object.create(or.prototype),cr.prototype.constructor=cr,cr.prototype.unstream=function(e){var r=new fi;e.readCompressedInt();r.rep.unstream(e);var t=new Lr;t.unstream(e);var i=e.getGAS(null),s=i.getDisplayedColor(),n=t.primitive;return r.refPlane.push({rep:r.rep.node,origin:n.origin,xAxis:n.direction1,yAxis:n.direction2,noShow:i.isHidden(),color:s,lengthX:n.length,lengthY:n.length,mode:n.mode,type:"CAT3DPlanRep"}),r.addMesh(e),null};var lr=function(){};lr.prototype=Object.create(or.prototype),lr.prototype.constructor=lr,lr.prototype.unstream=function(e){var r=new si;e.readCompressedInt();if(r.rep.unstream(e),e.readUnsignedChar())(new Wr).unstream(e);return r.addMesh(e)?r.rep:null};var vr=function(){};vr.prototype=Object.create(or.prototype),vr.prototype.constructor=vr,vr.prototype.unstream=function(e){var r=new ai;e.readCompressedInt();if(r.rep.unstream(e),e.readUnsignedChar())(new Wr).unstream(e);return r.addMesh(e)?r.rep:null};var mr=function(){};mr.prototype=Object.create(or.prototype),mr.prototype.constructor=mr,mr.prototype.unstream=function(e){var r=new li;e.readCompressedInt();if(r.rep.unstream(e),r.vertexBuffer=new Qe,r.nbLODFaces=e.readCompressedInt(),r.nbLODFaces>0){for(var t=[],i=1;i<=r.nbLODFaces;++i)t.push(e.readFloat());var n=new Vr;r.isGPUInstanciable=n.unstream(e,r.vertexBuffer),r.sets.push(n),r.isGPUInstanciable&&s&&(r.curveVertices=n.curveVertices,r.startNormal=n.startNormal,r.endNormal=n.endNormal,r.startSideVector=n.startSideVector,r.radius=n.radius);for(i=1;i<=r.nbLODFaces-2;i++){(new Vr).skip(e)}(new Ft).skip(e)}return r.addMesh(e)?r.rep:null};var yr=function(){};yr.prototype=Object.create(or.prototype),yr.prototype.constructor=yr,yr.prototype.unstream=function(e){2==h&&e.idOrder++;var r=new Di;e.readCompressedInt();if(r.rep.unstream(e),r.vertexBuffer=new Qe,e.readUnsignedChar()>0){var t=new St;t.unstream(e),r.gp=t}return r.addMesh(e)?r.rep:null};var gr=function(){};gr.prototype=Object.create(or.prototype),gr.prototype.constructor=gr,gr.prototype.unstream=function(e){2==h&&e.idOrder++;var r=new ki;e.readCompressedInt();r.rep.unstream(e),r.vertexBuffer=new Qe;var t=new Pt;return t.unstream(e),r.gp=t,r.addMesh(e)?r.rep:null};var xr=function(){};xr.prototype=Object.create(or.prototype),xr.prototype.constructor=xr,xr.prototype.unstream=function(e){var r=new pi;e.readCompressedInt();if(r.rep.unstream(e),r.vertexBuffer=new Qe,1==e.readUnsignedChar()){var t=new Dr;t.unstream(e),r.gp=t}return r.addMesh(e)?r.rep:null};var Br=function(){};Br.prototype=Object.create(or.prototype),Br.prototype.constructor=Br,Br.prototype.unstream=function(e){var r=new oi;e.readCompressedInt();r.rep.unstream(e);(new kr).unstream(e),(new kr).unstream(e),(new kr).unstream(e);return r.addMesh(e)?r.rep:null};var Ar=function(){};Ar.prototype=Object.create(or.prototype),Ar.prototype.constructor=Ar,Ar.prototype.unstream=function(e){2==h&&e.idOrder++;var r=new ii;e.readCompressedInt();if(r.rep.unstream(e),r.vertexBuffer=new Qe,1==e.readUnsignedChar()){var t=new Mt;t.unstream(e),r.gp=t}return r.addMesh(e)?r.rep:null};var Ir=function(){};Ir.prototype=Object.create(or.prototype),Ir.prototype.constructor=Ir,Ir.prototype.unstream=function(e){var r=new hi;e.readCompressedInt();r.rep.unstream(e),r.vertexBuffer=new Qe;var t=new Ft;return t.unstream(e),r.gp=t,r.addMesh(e)?r.rep:null};var br=function(){};br.prototype=Object.create(or.prototype),br.prototype.constructor=br,br.prototype.getAxisSystemInfo=function(e){var r,t=e.getCurrentPosition();ir.prototype.skip.call(this,e);var i=0;e.version>=210042110?(r=e.readFloat(),i=e.readCompressedInt()):r=e.readCompressedInt();var s=e.readCompressedInt();return e.setCurrentPosition(t),{isMonoPlane:s,mode:i,axisLength:r}},br.prototype.unstream=function(e){e.readCompressedInt();var r=this.getAxisSystemInfo(e);if(ir.prototype.unstream.call(this,e,r),e.version>=210042110){e.readFloat();e.readCompressedInt()}else e.readCompressedInt();e.readCompressedInt();return null};var Cr=function(){};Cr.prototype=Object.create(or.prototype),Cr.prototype.constructor=Cr,Cr.prototype.unstream=function(e){2==h&&e.idOrder++;var r=new Li;e.readCompressedInt();if(r.rep.unstream(e),r.vertexBuffer=new Qe,e.readUnsignedChar()>0){var t=new Tt;t.unstream(e),r.gp=t}return r.addMesh(e)?r.rep:null};var wr=function(){};wr.prototype=Object.create(or.prototype),wr.prototype.constructor=wr,wr.prototype.unstream=function(e){2==h&&e.idOrder++;var r=new zi;e.readCompressedInt();r.rep.unstream(e),r.vertexBuffer=new Qe;var t=new vt;return t.unstream(e),r.gp=t,r.addMesh(e)?r.rep:null};var Sr=function(){};Sr.prototype=Object.create(or.prototype),Sr.prototype.constructor=Sr,Sr.prototype.unstream=function(e){2==h&&e.idOrder++;var r=new ji;e.readCompressedInt();r.rep.unstream(e),r.vertexBuffer=new Qe,r.unstreamPerforatedPolygon(e);for(var t=e.readCompressedInt(),i=0;i<t;i++){var s=new wt;s.unstream(e),r.gp.push(s)}return r.gp.length?r.addMesh(e)?r.rep:null:(e.popMatId(),e.popGAS(),null)};var Pr=function(){};Pr.prototype=Object.create(or.prototype),Pr.prototype.constructor=Pr,Pr.prototype.unstream=function(e){2==h&&e.idOrder++;var r=new qi;e.readCompressedInt();r.rep.unstream(e),r.vertexBuffer=new Qe;var t=new wt,i=t.unstream(e);return r.gp=t,i&&r.addMesh(e)?r.rep:null};var Mr=function(){};Mr.prototype=Object.create(or.prototype),Mr.prototype.constructor=Mr,Mr.prototype.unstream=function(e){2==h&&e.idOrder++;var t=new Hi;e.readCompressedInt();t.rep.unstream(e),t.vertexBuffer=new Qe;var i=new yt,s=i.unstream(e);if(t.gp=i,s&&i){void 0!==i.zoomQuality&&0===i.zoomQuality&&e.setFixMode(!0),i.point&&(e.pushStaticMode(e.getCurrentMatrix()),e.currentMatrix.push(new r.Matrix4)),i.primitive.material&&e.pushMatId(i.primitive.material,1,0,t.rep),t.gp=i;var n=t.addMesh(e);return e.setFixMode(!1),i.primitive.material&&e.popMatId(),i.point&&(e.currentMatrix.pop(),e.popStaticMode()),n?t.rep:null}return null};var Tr=function(){this.node=new e.SGPrimitive,this.vertexBuffer=null,this.primitive=null,this.decoration=0};(Tr.prototype=Object.create(Tr.prototype)).constructor=Tr,Tr.prototype.unstreamPrimitive=function(e){if(this.node.cgmId=0,this.decoration=0,e.version>=1100700?this.node.cgmId=e.readUncompressedULong():e.version>=1100200&&(this.node.cgmId=e.readCompressedInt()),e.version>=1100800){var r=e.readUnsignedShort();if(r>0){var t=e.decorations,i=[];if(1==r){i.push(0);e.readUnsignedChar()}else if(65535==r)i.push(0);else{i.push(r);for(var s=0;s<r;s++)i.push(e.readUnsignedChar())}this.decoration=t.addDecoration(i)}}},Tr.prototype.create2DArcCircleGP=function(r,t,i,s,n,a,o,p,h,u){t.start=0,o<a&&(o+=2*Math.PI);var f=r.posBuffer.length/3;if(h){t.connectivity=e.ConnectivityTypeEnum.TRIANGLES,t.count+=3*(p-2);for(var d=0;d<p;++d){var c=a+(o-a)*d/(p-1);r.posBuffer.push(i+n*Math.cos(c)),r.posBuffer.push(s+n*Math.sin(c)),r.posBuffer.push(u.idOrder),r.normalBuffer.push(0),r.normalBuffer.push(0),r.normalBuffer.push(1)}for(d=1;d<p-1;d++)t.indices.push(0),t.indices.push(d),t.indices.push(d+1)}else{t.connectivity=e.ConnectivityTypeEnum.LINES,t.count+=2+2*(p-2);c=a;r.posBuffer.push(i+n*Math.cos(c)),r.posBuffer.push(s+n*Math.sin(c)),r.posBuffer.push(u.idOrder);for(d=1;d<p;++d)c=a+(o-a)*d/(p-1),t.indices.push(f++),r.posBuffer.push(i+n*Math.cos(c)),r.posBuffer.push(s+n*Math.sin(c)),r.posBuffer.push(u.idOrder),t.indices.push(f)}},Tr.prototype.createPolylineGP=function(r,t,i,s){switch(t.start=0,t.connectivity=e.ConnectivityTypeEnum.LINES,s){case 0:t.count+=i;for(var n=0;n<i;++n)t.indices.push(r++);break;case 1:t.count+=2+2*(i-2);for(n=1;n<i;++n)t.indices.push(r++),t.indices.push(r);break;case 2:t.count+=4+2*(i-2);var a=r;for(n=0;n<i-1;++n)t.indices.push(r++),t.indices.push(r);t.indices.push(r),t.indices.push(a);break;default:return null}},Tr.prototype.createPolygonGP=function(r,t,i,s,n,a){if(t.start=0,a){t.connectivity=e.ConnectivityTypeEnum.TRIANGLES;switch(n){case 0:case 4:t.count+=s;for(var o=0;o<s;++o)t.indices.push(i[r++]);break;case 1:case 5:t.count+=3*(s-2);var p=0;for(o=0;o<s-2;o++)t.indices.push(i[r]),t.indices.push(i[r+1+p]),t.indices.push(i[r+2-p]),r++,p=1-p;r+=2;break;case 2:case 6:t.count+=3*(s-2);var h=i[r];for(o=0;o<s-2;o++)t.indices.push(h),t.indices.push(i[r+2]),t.indices.push(i[r+1]),r++;r+=2;break;default:return null}}else{t.connectivity=e.ConnectivityTypeEnum.LINES,t.count=2+2*(s-1);for(var u=r,f=1;f<s;++f)t.indices.push(r++),t.indices.push(r);t.indices.push(r),t.indices.push(u)}return r};var Fr=function(){Tr.call(this),this.boundingBoxCenter=new Float32Array(3),this.boundingBoxDim=new Float32Array(3),this.boundingSphere=null};(Fr.prototype=Object.create(Tr.prototype)).constructor=Fr,Fr.prototype.unstreamBBox=function(e){switch(this.unstreamPrimitive(e),j?_:0){case 0:for(var r=0;r<3;r++)this.boundingBoxCenter[r]=e.readFloat();for(r=0;r<3;r++)this.boundingBoxDim[r]=e.readFloat();var t=new Array(3);for(r=0;r<3;r++)t[r]=e.readFloat();var i=e.readFloat();n&&(this.boundingSphere={center:t,radius:i});break;case E:var s=(ar.x-nr.x)*one_over_65535,a=(ar.y-nr.y)*one_over_65535,o=(ar.z-nr.z)*one_over_65535,p={x:e.readUnsignedShort()*s+nr.x,y:e.readUnsignedShort()*a+nr.y,z:e.readUnsignedShort()*o+nr.z},h={x:e.readUnsignedShort()*s+nr.x,y:e.readUnsignedShort()*a+nr.y,z:e.readUnsignedShort()*o+nr.z};this.boundingBoxCenter[0]=.5*(h.x+p.x),this.boundingBoxCenter[1]=.5*(h.y+p.y),this.boundingBoxCenter[2]=.5*(h.z+p.z),this.boundingBoxDim[0]=h.x-p.x,this.boundingBoxDim[1]=h.y-p.y,this.boundingBoxDim[2]=h.z-p.z;for(t=new Array(3),r=0;r<3;r++)t[r]=this.boundingBoxCenter[r];i=Math.max(Math.max(this.boundingBoxDim[0],this.boundingBoxDim[1]),this.boundingBoxDim[2])*Math.sqrt(2)*.5;n&&(this.boundingSphere={center:t,radius:i});break;case V:this.boundingBoxCenter[0]=.5*(ar.x+nr.x),this.boundingBoxCenter[1]=.5*(ar.y+nr.y),this.boundingBoxCenter[2]=.5*(ar.z+nr.z),this.boundingBoxDim[0]=ar.x-nr.x,this.boundingBoxDim[1]=ar.y-nr.y,this.boundingBoxDim[2]=ar.z-nr.z;for(t=new Array(3),r=0;r<3;r++)t[r]=this.boundingBoxCenter[r];i=Math.max(Math.max(this.boundingBoxDim[0],this.boundingBoxDim[1]),this.boundingBoxDim[2])*Math.sqrt(2)*.5;n&&(this.boundingSphere={center:t,radius:i})}};var Ur=function(){Fr.call(this)};Ur.prototype=Object.create(Fr.prototype),Ur.prototype.constructor=Ur,Ur.prototype.unstream=function(e){if(e.version>=1101410){this.unstreamBBox(e),e.getLightDataStreaming()&&(this.primitive=new Ai,this.primitive.unstream(e),e.readUnsignedChar()&&(this.vertexBuffer=new Qe,this.vertexBuffer.unstream(e))),e.version>=1101430?e.readUnsignedChar():0}else{this.unstreamBBox(e);var r=e.readCompressedInt(),t=e.readCompressedInt(),i=e.readCompressedInt(),s=e.readCompressedInt(),n=e.readCompressedInt();this.primitive=new Ai,e.version>=1100700&&e.readUnsignedChar();var a,o=1&(a=e.readUnsignedChar())||2&a,p=4&a||8&a;if(this.vertexBuffer||(this.vertexBuffer=new Qe),o)e.readFloatArray(0,r,this.vertexBuffer.posBuffer),e.readUnsignedChar()&&e.readFloatArray(0,r,this.vertexBuffer.uvBuffer),e.version>1100820&&(multiple_texture=e.readUnsignedChar());if(p)if(e.version>1000800){e.readShortArray(t,this.vertexBuffer.normalBuffer);for(var h=0;h<t;h++)this.vertexBuffer.normalBuffer[h]*=1/32767}else e.readFloatArray(0,t,this.vertexBuffer.normalBuffer);i&&(e.version>=1100600?e.unpackcArray(3*i,this.primitive.indices,0):e.version>1000500?e.unpackcArray(3*i,this.primitive.indices,0):this.primitive.indices=e.readUncompressedIntArray(3*i,this.primitive.indices));var u=[],f=this.primitive.indices.length;if(s){var d=[];for(e.version>1000500?e.unpackcArray(s,d,0):e.readUncompressedIntArray(s,d),h=s-1;h>=0;h--){var c=d[h];e.version>=1100600?e.unpackcArray(c,u,0):e.version>1000500?e.unpackcArray(c,u,0):e.readUncompressedIntArray(c,u);for(var l=2;l<c;++l)l%2?(this.primitive.indices[f++]=u[l],this.primitive.indices[f++]=u[l-1],this.primitive.indices[f++]=u[l-2]):(this.primitive.indices[f++]=u[l-1],this.primitive.indices[f++]=u[l],this.primitive.indices[f++]=u[l-2])}}if(n){var v=[];for(e.version>1000500?e.unpackcArray(n,v,0):e.readUncompressedIntArray(n,v),h=n-1;h>=0;h--){var m=v[h];e.version>=1100600?e.unpackcArray(m,u,0):e.version>1000500?e.unpackcArray(m,u,0):e.readUncompressedIntArray(m,u);for(l=2;l<m;++l)this.primitive.indices[f++]=u[0],this.primitive.indices[f++]=u[l-1],this.primitive.indices[f++]=u[l]}}e.readUnsignedChar()&&e.readFloatArray(0,2*r/3,this.vertexBuffer.uvBuffer),r||3!=t?r&&3==t&&(this.planarNormals=this.vertexBuffer.normalBuffer):this.planarNormals=this.vertexBuffer.normalBuffer}};var Rr=function(){Ur.call(this)};(Rr.prototype=Object.create(Ur.prototype)).constructor=Rr;var Nr=function(){Tr.call(this)};Nr.prototype=Object.create(Tr.prototype),Nr.prototype.constructor=Nr,Nr.prototype.unstream=function(e){if(e.version>=210021710){this.unstreamPrimitive(e);e.readCompressedUInt()}};var Gr=function(){Tr.call(this),this.fref1=null,this.fref2=null,this.vizEdge=null};Gr.prototype=Object.create(Tr.prototype),Gr.prototype.constructor=Gr,Gr.prototype.unstream=function(e){if(e.version>=1101410)return this.unstreamPrimitive(e),void(e.getLightDataStreaming()&&(this.vizEdge=new Si,this.vizEdge.unstream(e),this.vertexBuffer=new Qe,this.vertexBuffer.posBuffer=vizEdge.linePos))};var Or=function(){Gr.call(this)};Or.prototype=Object.create(Gr.prototype),Or.prototype.constructor=Or,Or.prototype.unstream=function(e){if(Gr.prototype.unstream.call(this,e),e.readBoolean()){var r=e.readCompressedUInt();r&&e.skip(3*r*4)}};var Er=function(){Fr.call(this),this.toSkip=!1};Er.prototype=Object.create(Fr.prototype),Er.prototype.constructor=Er,Er.prototype.unstream=function(e,t){this.unstreamBBox(e);var i=e.readCompressedInt();if(0==i){var n=e.readCompressedInt();return e.skip(12),e.skip(12*i),e.skip(24),e.skip(12*n),this.toSkip=!0,!1}n=e.readCompressedInt();var a=new Float32Array(3);a[0]=e.readFloat(),a[1]=e.readFloat(),a[2]=e.readFloat();var o=1/Math.sqrt(a[0]*a[0]+a[1]*a[1]+a[2]*a[2]),p=new Float32Array(3);p[0]=o*a[0],p[1]=o*a[1],p[2]=o*a[2];for(var h=!0,u=!0,f=new Float32Array(12*i),d=new Float32Array(12*i),c=new Uint32Array(12*(i-1)),l=0,v=0,m=0,y=0;y<i;y++)f[l++]=e.readFloat(),f[l++]=e.readFloat(),f[l++]=e.readFloat();var g=1/i,x=[0,0,0];for(y=0;y<i;y++)x[0]+=g*f[3*y],x[1]+=g*f[3*y+1],x[2]+=g*f[3*y+2];if(s){var B=[];B[0]=x[0],B[1]=x[1],B[2]=x[2],B[3]=x[0]+a[0],B[4]=x[1]+a[1],B[5]=x[2]+a[2],this.curveVertices=B,this.startNormal=[-p[0],-p[1],-p[2]],this.endNormal=[p[0],p[1],p[2]];var A=[f[0]-x[0],f[1]-x[1],f[2]-x[2]];this.radius=Math.sqrt(A[0]*A[0]+A[1]*A[1]+A[2]*A[2]),this.startSideVector=new Float32Array([A[0]/this.radius,A[1]/this.radius,A[2]/this.radius])}var I=new Float32Array(3);for(y=0;y<3;y++)I[y]=e.readFloat();var b=new Float32Array(3);for(y=0;y<3;y++)b[y]=e.readFloat();if(s)return n>0&&e.skip(3*n*4),!0;if(i>=3){var C=new r.Vector3(I[0],I[1],I[2]),w=new r.Vector3(b[0],b[1],b[2]);C.cross(w);var S=new r.Vector3(f[3]-f[0],f[4]-f[1],f[5]-f[2]),P=new r.Vector3(f[6]-f[0],f[7]-f[1],f[8]-f[2]);if(i>4){var M=Math.trunc(i/4);P=new r.Vector3(f[3*M]-f[0],f[3*M+1]-f[1],f[3*M+2]-f[2])}S.cross(P);var T=S.dot(C);T<0&&(h=!1),P.set(a[0],a[1],a[2]),(T=P.dot(C))<0&&(u=!1)}var F=!(h^u),U=2*Math.PI/i;if(h)for(y=0;y<i;y++){var R=Math.cos(y*U),N=Math.sin(y*U);d[v++]=R*I[0]+N*b[0],d[v++]=R*I[1]+N*b[1],d[v++]=R*I[2]+N*b[2]}else for(y=i;y>0;y--){R=Math.cos(y*U),N=Math.sin(y*U);d[v++]=R*I[0]+N*b[0],d[v++]=R*I[1]+N*b[1],d[v++]=R*I[2]+N*b[2]}for(y=0;y<i;y++)f[l++]=f[3*y]+a[0],f[l++]=f[3*y+1]+a[1],f[l++]=f[3*y+2]+a[2],d[v++]=d[3*y],d[v++]=d[3*y+1],d[v++]=d[3*y+2];if(F){for(y=0;y<i-1;y++)c[m++]=y,c[m++]=y+1,c[m++]=y+i,c[m++]=y+i,c[m++]=y+1,c[m++]=y+1+i;c[m++]=0,c[m++]=i,c[m++]=i-1,c[m++]=2*i-1,c[m++]=i-1,c[m++]=i}else{for(y=0;y<i-1;y++)c[m++]=y+i,c[m++]=y+1+i,c[m++]=y,c[m++]=y,c[m++]=y+1+i,c[m++]=y+1;c[m++]=i,c[m++]=0,c[m++]=2*i-1,c[m++]=i-1,c[m++]=2*i-1,c[m++]=0}var G=l/3;for(y=0;y<i;y++)d[v++]=-p[0],d[v++]=-p[1],d[v++]=-p[2],f[l++]=f[3*y],f[l++]=f[3*y+1],f[l++]=f[3*y+2];if(F)for(y=0;y<i-2;y++)c[m++]=G,c[m++]=G+i-1-y,c[m++]=G+i-2-y;else for(y=0;y<i-2;y++)c[m++]=G,c[m++]=G+i-2-y,c[m++]=G+i-1-y;for(G=l/3,y=0;y<i;y++)d[v++]=p[0],d[v++]=p[1],d[v++]=p[2],f[l++]=f[3*(y+i)],f[l++]=f[3*(y+i)+1],f[l++]=f[3*(y+i)+2];if(F)for(y=0;y<i-2;y++)c[m++]=G,c[m++]=G+i-2-y,c[m++]=G+i-1-y;else for(y=0;y<i-2;y++)c[m++]=G,c[m++]=G+i-1-y,c[m++]=G+i-2-y;return n>0&&e.skip(3*n*4),t?(t.posBuffer=f,t.normalBuffer=d,this.indices=c):(this.vertexBuffer=new Qe,this.vertexBuffer.posBuffer=f,this.vertexBuffer.normalBuffer=d,this.primitive=new Bi,this.primitive.indices=c),!0},Er.prototype.skip=function(e){this.unstreamBBox(e);var r=e.readCompressedInt(),t=e.readCompressedInt();e.skip(12),e.skip(12*r),e.skip(24),e.skip(12*t)};var Vr=function(){Fr.call(this)};Vr.prototype=Object.create(Fr.prototype),Vr.prototype.constructor=Vr,Vr.prototype.unstream=function(e,r){var t=!0;this.unstreamBBox(e);for(var i=e.readCompressedInt(),n=new Float32Array(3*i),a=0;a<3*i;a++)n[a]=e.readFloat();var o=e.readCompressedInt(),p=o*(i+2),h=new Float32Array(3*p);for(a=0;a<o*i*3;a++)h[a]=e.readFloat();var u=new Float32Array(3);for(a=0;a<3;a++)u[a]=e.readFloat();var f=new Float32Array(3);for(a=0;a<3;a++)f[a]=e.readFloat();var d=e.readFloat(),c=o*i*3,l=o*(i+1)*3,v=new Float32Array(3),m=3*o*(i-1);if(v[0]=d*(h[m]-n[3*(i-1)]),v[1]=d*(h[m+1]-n[3*(i-1)+1]),v[2]=d*(h[m+2]-n[3*(i-1)+2]),v[0]*v[0]+v[1]*v[1]+v[2]*v[2]<.01&&(t=!1),t&&s)h[l]=h[c-3],h[l+1]=h[c-2],h[l+2]=h[c-1];else{a=0;for(var y=3*o-3;a<3*o;a+=3,y-=3)h[c+a]=h[a],h[c+a+1]=h[a+1],h[c+a+2]=h[a+2],h[l+a]=h[c-3*o+y],h[l+a+1]=h[c-3*o+y+1],h[l+a+2]=h[c-3*o+y+2]}if(t&&s){this.curveVertices=n,this.startNormal=u,this.endNormal=f,this.radius=1/d;var g=new Float32Array(3);g[0]=d*(h[0]-n[0]),g[1]=d*(h[1]-n[1]),g[2]=d*(h[2]-n[2]),this.startSideVector=g;var x=new Float32Array(3);x[0]=d*(h[3]-n[0]),x[1]=d*(h[4]-n[1]),x[2]=d*(h[5]-n[2]),u[0]=g[1]*x[2]-g[2]*x[1],u[1]=g[2]*x[0]-g[0]*x[2],u[2]=g[0]*x[1]-g[1]*x[0];var B=new Float32Array(3);B[0]=d*(h[m+3]-n[3*(i-1)]),B[1]=d*(h[m+4]-n[3*(i-1)+1]),B[2]=d*(h[m+5]-n[3*(i-1)+2]),f[0]=-v[1]*B[2]+v[2]*B[1],f[1]=-v[2]*B[0]+v[0]*B[2],f[2]=-v[0]*B[1]+v[1]*B[0];var A=e.readCompressedInt();return e.skip(3*A*4),!0}for(var I,b,C,w=new Float32Array(3*p),S=(a=0,y=o-1,0);a<o*i;a++,y--)I=(h[3*a]-n[3*S])*d,b=(h[3*a+1]-n[3*S+1])*d,C=(h[3*a+2]-n[3*S+2])*d,0==I&&0==b&&0==C?0==S?(w[3*a]=u[0],w[3*a+1]=u[1],w[3*a+2]=u[2]):(w[3*a]=f[0],w[3*a+1]=f[1],w[3*a+2]=f[2]):(w[3*a]=I,w[3*a+1]=b,w[3*a+2]=C),0==y&&(y=o,S++);for(a=0;a<3*o;a+=3)w[c+a]=u[0],w[c+a+1]=u[1],w[c+a+2]=u[2],w[l+a]=f[0],w[l+a+1]=f[1],w[l+a+2]=f[2];var P=0,M=new Uint32Array(6*(i-1)*o+6*(o-2));for(a=1;a<i;a++){for(y=0;y<o-1;y++)M[P++]=y+1+(a-1)*o,M[P++]=y+(a-1)*o,M[P++]=y+a*o,M[P++]=y+1+(a-1)*o,M[P++]=y+a*o,M[P++]=y+1+a*o;M[P++]=a*o,M[P++]=(a-1)*o,M[P++]=a*o-1,M[P++]=a*o-1,M[P++]=(1+a)*o-1,M[P++]=a*o}var T=o*i;for(a=0;a<o-2;a++)M[P++]=T,M[P++]=T+o-2-a,M[P++]=T+o-1-a;T=o*(i+1);for(a=0;a<o-2;a++)M[P++]=T,M[P++]=T+o-2-a,M[P++]=T+o-1-a;A=e.readCompressedInt();return e.skip(3*A*4),r?(r.posBuffer=h,r.normalBuffer=w,this.indices=M):(this.vertexBuffer=new Qe,this.vertexBuffer.posBuffer=h,this.vertexBuffer.normalBuffer=w,this.primitive=new Bi,this.primitive.indices=M),!1},Vr.prototype.skip=function(e){this.unstreamBBox(e);var r=e.readCompressedInt();e.skip(3*r*4);var t=e.readCompressedInt();e.skip(3*t*r*4),e.skip(12),e.skip(12),e.skip(4);var i=e.readCompressedInt();e.skip(3*i*4)};var Dr=function(){Tr.call(this),this.noRender=!0,this.primitive=new Bi,this.vertexBuffer=null};Dr.prototype=Object.create(Tr.prototype),Dr.prototype.constructor=Dr,Dr.prototype.unstream=function(r){if(this.unstreamPrimitive(r),r.getLightDataStreaming()){this.vertexBuffer||(this.vertexBuffer=new Qe),this.primitive.symbol=r.readCompressedInt();var t=this.vertexBuffer.posBuffer.length/3;this.primitive.start=this.primitive.indices.length,this.primitive.connectivity=e.ConnectivityTypeEnum.POINTS;var i=r.readCompressedInt();this.primitive.count=i;for(var s=0;s<i;s++)this.vertexBuffer.posBuffer.push(r.readFloat()),this.vertexBuffer.posBuffer.push(r.readFloat()),this.vertexBuffer.posBuffer.push(r.readFloat()),this.primitive.indices.push(t++)}};var kr=function(){Tr.call(this),this.noRender=!0};kr.prototype=Object.create(Tr.prototype),kr.prototype.constructor=kr,kr.prototype.unstream=function(e){this.unstreamPrimitive(e);var r,t=e.readFloat(),i=e.readFloat(),s=e.readFloat(),n=e.readFloat(),a=e.readFloat(),o=e.readFloat(),p=e.readCompressedInt();e.readCompressedInt();if(e.version<210042210){if((r=e.readCompressedInt())>0)e.readStringWithLength()}else(r=e.readUncompressedULong())>0&&e.skip(2*r);this.primitive={origin:[t,i,s],direction:[n,a,o],length:p}};var Lr=function(){Tr.call(this),this.noRender=!0};Lr.prototype=Object.create(Tr.prototype),Lr.prototype.constructor=Lr,Lr.prototype.unstream=function(e){if(this.unstreamPrimitive(e),e.getLightDataStreaming()){var r=e.readFloat(),t=e.readFloat(),i=e.readFloat(),s=e.readFloat(),n=e.readFloat(),a=e.readFloat(),o=e.readFloat(),p=e.readFloat(),h=e.readFloat(),u=e.readFloat(),f=0;e.version>=1100910&&(f=e.readUnsignedChar()),this.primitive={origin:[r,t,i],direction1:[s,n,a],direction2:[o,p,h],length:u,mode:f}}};var _r=function(){Tr.call(this),this.noRender=!0};(_r.prototype=Object.create(Tr.prototype)).constructor=_r,_r.prototype.unMarshalRP=function(e){var t={},i=e[0];return 0==i>>3&&(t._wireframeMode=!!(4&i),t._labelVisibility=!!(2&i),t._orientationVisibility=!!(1&i),t._frontColor=new r.Color(e[1]/255,e[2]/255,e[3]/255),t._backColor=new r.Color(e[4]/255,e[5]/255,e[6]/255),t._opacity=e[7]),t},_r.prototype.unstream=function(e){if(this.unstreamPrimitive(e),e.getLightDataStreaming()){var r=!1,t=!1;1==e.readUnsignedChar()&&(t=!0);var i=e.readFloat(),s=e.readFloat(),n=e.readFloat(),a=e.readFloat(),o=e.readFloat(),p=e.readFloat(),h=e.readFloat(),u=e.readFloat(),f=e.readFloat(),d=e.readFloat(),c=e.readFloat(),l=e.readUncompressedUInt(),v="";if(l){for(var m=[],y=0;y<l;y++)m.push(String.fromCharCode(e.readUnsignedShort()));v=m.join("")}var g=null;if(e.version>=210042460){var x=e.readCompressedUInt(),B=[];x&&(e.readBytes(x,B),g=this.unMarshalRP(B)),e.version>=210042510&&(r=e.readBit())}this.primitive={label:v,origin:[i,s,n],direction1:[a,o,p],direction2:[u,f,d],lengthX:h,lengthY:c,refPlaneData:g,mode:t,autoSize:r}}};var jr=function(){Tr.call(this),this.noRender=!0};jr.prototype=Object.create(Tr.prototype),jr.prototype.constructor=jr,jr.prototype.unstream=function(e){this.unstreamPrimitive(e);e.readFloat(),e.readFloat(),e.readFloat(),e.readFloat(),e.readCompressedInt(),e.readCompressedInt();var r=e.readCompressedInt();if(r)e.readString(r)};var zr=function(){Tr.call(this),this.noRender=!0};zr.prototype=Object.create(Tr.prototype),zr.prototype.constructor=zr,zr.prototype.unstream=function(e){this.unstreamPrimitive(e);var r=e.readFloat(),t=e.readFloat(),i=e.readFloat(),s=e.readFloat(),n=e.readFloat(),a=e.readFloat(),o=(e.readCompressedInt(),e.readCompressedInt());if(e.readCompressedInt())e.readStringWithLength();this.primitive={origin:[r,t,i],direction:[s,n,a],length:o}};var Wr=function(){Tr.call(this),this.noRender=!0};Wr.prototype=Object.create(Tr.prototype),Wr.prototype.constructor=Wr,Wr.prototype.unstream=function(e){this.unstreamPrimitive(e),e.skip(16),e.readCompressedInt(),e.skip(36)};var Hr=function(){Tr.call(this),this.noRender=!0};Hr.prototype=Object.create(Tr.prototype),Hr.prototype.constructor=Hr,Hr.prototype.unstream=function(e){this.unstreamPrimitive(e),e.readFloat(),e.readFloat(),e.readFloat(),e.readFloat(),e.readCompressedInt(),e.readFloat(),e.readFloat(),e.readFloat(),e.readFloat(),e.readFloat(),e.readFloat(),e.readFloat(),e.readFloat(),e.readFloat()};var qr=function(){Tr.call(this),this.vertexBuffer=null,this.primitive=new Bi,this.point=[],this.zoomQuality=0,this.imageGP=!0,this.noRender=!0};qr.prototype=Object.create(Tr.prototype),qr.prototype.constructor=qr,qr.prototype.unstream=function(r){this.unstreamPrimitive(r);if(r.readUnsignedChar()){var t=(new Ve).unstream(r);this.point.push(r.readFloat()),this.point.push(r.readFloat()),this.point.push(r.readFloat());r.readCompressedInt(),r.readCompressedInt(),r.readCompressedInt();if(null==t)return!1;var i=r.textures.add(t),s=t.width,n=t.height;this.vertexBuffer||(this.vertexBuffer=new Qe),this.primitive.start=this.primitive.indices.length;var a=this.vertexBuffer.posBuffer.length/3;this.vertexBuffer.posBuffer.push(0),this.vertexBuffer.posBuffer.push(0),this.vertexBuffer.posBuffer.push(0),this.vertexBuffer.normalBuffer.push(0),this.vertexBuffer.normalBuffer.push(0),this.vertexBuffer.normalBuffer.push(1),this.vertexBuffer.posBuffer.push(s),this.vertexBuffer.posBuffer.push(0),this.vertexBuffer.posBuffer.push(0),this.vertexBuffer.normalBuffer.push(0),this.vertexBuffer.normalBuffer.push(0),this.vertexBuffer.normalBuffer.push(1),this.vertexBuffer.posBuffer.push(s),this.vertexBuffer.posBuffer.push(n),this.vertexBuffer.posBuffer.push(0),this.vertexBuffer.normalBuffer.push(0),this.vertexBuffer.normalBuffer.push(0),this.vertexBuffer.normalBuffer.push(1),this.vertexBuffer.posBuffer.push(0),this.vertexBuffer.posBuffer.push(n),this.vertexBuffer.posBuffer.push(0),this.vertexBuffer.normalBuffer.push(0),this.vertexBuffer.normalBuffer.push(0),this.vertexBuffer.normalBuffer.push(1),this.primitive.connectivity=e.ConnectivityTypeEnum.TRIANGLES,this.primitive.count=6,this.primitive.indices.push(a),this.primitive.indices.push(a+1),this.primitive.indices.push(a+2),this.primitive.indices.push(a+2),this.primitive.indices.push(a+3),this.primitive.indices.push(a+0),this.vertexBuffer.hasTextures=!0,this.vertexBuffer.textureBuffer.push(0),this.vertexBuffer.textureBuffer.push(0),this.vertexBuffer.textureBuffer.push(0),this.vertexBuffer.textureBuffer.push(1),this.vertexBuffer.textureBuffer.push(0),this.vertexBuffer.textureBuffer.push(0),this.vertexBuffer.textureBuffer.push(1),this.vertexBuffer.textureBuffer.push(1),this.vertexBuffer.textureBuffer.push(0),this.vertexBuffer.textureBuffer.push(0),this.vertexBuffer.textureBuffer.push(1),this.vertexBuffer.textureBuffer.push(0);var o={textureId:i,shading:"Basic",primWithMaterials:!0,useAsGas:!0},p={file:"",id:r.materials.add(o)};return this.primitive.material=p,!0}return!1};var Yr=1,Xr=2,Zr=14,Qr=15,Jr=16,Kr=17,$r=18,et=19,rt=20,tt=21,it=22,st=23,nt=24,at=25,ot=26,pt=27,ht=28,ut=29,ft=30,dt=31,ct=32,lt=function(){Tr.call(this),this.vertexBuffer=null,this.primitive=new Bi};lt.prototype=Object.create(Tr.prototype),lt.prototype.constructor=lt,lt.prototype.lineType=null,lt.prototype.unstream=function(r){this.unstreamPrimitive(r);var t=r.readUnsignedChar(),i=[];r.readFloatArray(0,4,i),this.vertexBuffer||(this.vertexBuffer=new Qe),this.primitive.start=this.primitive.indices.length;var s=this.vertexBuffer.posBuffer.length/3;return this.vertexBuffer.posBuffer.push(i[0]),this.vertexBuffer.posBuffer.push(i[1]),this.vertexBuffer.posBuffer.push(r.idOrder),this.vertexBuffer.posBuffer.push(i[2]),this.vertexBuffer.posBuffer.push(i[1]),this.vertexBuffer.posBuffer.push(r.idOrder),this.vertexBuffer.posBuffer.push(i[2]),this.vertexBuffer.posBuffer.push(i[3]),this.vertexBuffer.posBuffer.push(r.idOrder),this.vertexBuffer.posBuffer.push(i[0]),this.vertexBuffer.posBuffer.push(i[3]),this.vertexBuffer.posBuffer.push(r.idOrder),t?(this.primitive.connectivity=e.ConnectivityTypeEnum.TRIANGLES,this.primitive.count=6,this.primitive.indices.push(s),this.primitive.indices.push(s+1),this.primitive.indices.push(s+2),this.primitive.indices.push(s+2),this.primitive.indices.push(s+3),this.primitive.indices.push(s+0),this.vertexBuffer.normalBuffer.push(0),this.vertexBuffer.normalBuffer.push(0),this.vertexBuffer.normalBuffer.push(1),this.vertexBuffer.normalBuffer.push(0),this.vertexBuffer.normalBuffer.push(0),this.vertexBuffer.normalBuffer.push(1),this.vertexBuffer.normalBuffer.push(0),this.vertexBuffer.normalBuffer.push(0),this.vertexBuffer.normalBuffer.push(1),this.vertexBuffer.normalBuffer.push(0),this.vertexBuffer.normalBuffer.push(0),this.vertexBuffer.normalBuffer.push(1)):(this.primitive.connectivity=e.ConnectivityTypeEnum.LINES,this.primitive.count=8,this.primitive.indices.push(s),this.primitive.indices.push(s+1),this.primitive.indices.push(s+1),this.primitive.indices.push(s+2),this.primitive.indices.push(s+2),this.primitive.indices.push(s+3),this.primitive.indices.push(s+3),this.primitive.indices.push(s+0)),!0};var vt=function(){Tr.call(this),this.vertexBuffer=null,this.primitive=new Bi,this.primitives=[]};vt.prototype=Object.create(Tr.prototype),vt.prototype.constructor=vt,vt.prototype.lineType=null,vt.prototype.unstream=function(e){if(this.unstreamPrimitive(e),e.version>1101410){e.readCompressedInt();var t=[];e.readFloatArray(0,2,t);var i=e.readFloat(),s=e.readCompressedInt()}var n=[];e.readFloatArray(0,2,n);var a=new r.Vector2(n[0],n[1]);a.normalize();var o=e.readFloat(),p=i*Math.tan(o);this.vertexBuffer||(this.vertexBuffer=new Qe);var h=this.vertexBuffer.posBuffer.length/3;switch(s!==dt&&(this.vertexBuffer.posBuffer.push(t[0]-a.x*i+a.y*p),this.vertexBuffer.posBuffer.push(t[1]-a.y*i-a.x*p),this.vertexBuffer.posBuffer.push(e.idOrder),this.vertexBuffer.posBuffer.push(t[0]),this.vertexBuffer.posBuffer.push(t[1]),this.vertexBuffer.posBuffer.push(e.idOrder),this.vertexBuffer.posBuffer.push(t[0]-a.x*i-a.y*p),this.vertexBuffer.posBuffer.push(t[1]-a.y*i+a.x*p),this.vertexBuffer.posBuffer.push(e.idOrder)),s){case Zr:var u=new Bi;this.createPolylineGP(h,u,3,1),this.primitive=u;break;case Qr:(u=new Bi).count=0;var f=[0,1,2];this.createPolygonGP(0,u,f,f.length,0,!1),this.primitive=u;break;case Jr:case Kr:(u=new Bi).count=0;f=[0,1,2];this.createPolygonGP(0,u,f,f.length,0,!0),this.primitive=u;break;case ft:u=new Bi;this.createPolylineGP(h,u,3,1);h=this.vertexBuffer.posBuffer.length/3;this.vertexBuffer.posBuffer.push(t[0]-i*a.x-a.x*i+a.y*p),this.vertexBuffer.posBuffer.push(t[1]-i*a.y-a.y*i-a.x*p),this.vertexBuffer.posBuffer.push(e.idOrder),this.vertexBuffer.posBuffer.push(t[0]-i*a.x),this.vertexBuffer.posBuffer.push(t[1]-i*a.y),this.vertexBuffer.posBuffer.push(e.idOrder),this.vertexBuffer.posBuffer.push(t[0]-i*a.x-a.x*i-a.y*p),this.vertexBuffer.posBuffer.push(t[1]-i*a.y-a.y*i+a.x*p),this.vertexBuffer.posBuffer.push(e.idOrder),this.createPolylineGP(h,u,3,1),this.primitive=u;break;case ct:(u=new Bi).count=0;f=[0,1,2];this.createPolygonGP(0,u,f,f.length,0,!0);h=this.vertexBuffer.posBuffer.length/3;this.vertexBuffer.posBuffer.push(t[0]-i*a.x-a.x*i+a.y*p),this.vertexBuffer.posBuffer.push(t[1]-i*a.y-a.y*i-a.x*p),this.vertexBuffer.posBuffer.push(e.idOrder),this.vertexBuffer.posBuffer.push(t[0]-i*a.x),this.vertexBuffer.posBuffer.push(t[1]-i*a.y),this.vertexBuffer.posBuffer.push(e.idOrder),this.vertexBuffer.posBuffer.push(t[0]-i*a.x-a.x*i-a.y*p),this.vertexBuffer.posBuffer.push(t[1]-i*a.y-a.y*i+a.x*p),this.vertexBuffer.posBuffer.push(e.idOrder);f=[3,5,4];this.createPolygonGP(0,u,f,f.length,0,!0),this.primitive=u;break;case dt:o=Math.acos(-a.y);o=Math.asin(a.x)<0?-o:o;var d=.5*i,c=17;if(ys){var l=ys,v=Math.PI,m=400;if(d*Math.PI*2<ys);else{l>d&&(l=d);var y=Math.acos(1-l/d);m=0==y?400:Math.PI/y+.5}c=Math.floor(v*m*(1/(2*Math.PI))+2.5)}var g=t[0]+d*a.y,x=t[1]-d*a.x,B=new Bi;this.create2DArcCircleGP(this.vertexBuffer,B,g,x,d,o,o+Math.PI,c,!1,e);g=t[0]-d*a.y,x=t[1]+d*a.x;this.create2DArcCircleGP(this.vertexBuffer,B,g,x,d,o+Math.PI,o,c,!1,e),this.primitive=B;break;default:B=new Bi;this.create2DArcCircleGP(this.vertexBuffer,B,t[0],t[1],i/2,0,2*Math.PI,17,!0,e),this.primitive=B}return!0};var mt=function(){Tr.call(this),this.vertexBuffer=null,this.primitive=new Bi,this.primitives=[]};mt.prototype=Object.create(Tr.prototype),mt.prototype.constructor=mt,mt.prototype.lineType=null,mt.prototype.unstream=function(e){this.unstreamPrimitive(e);e.readCompressedInt();var r=[];e.readFloatArray(0,2,r);var t=e.readFloat(),i=17;if(ys){var s=t/2,n=ys,a=2*Math.PI,o=400;if(s*Math.PI*2<ys);else{n>s&&(n=s);var p=Math.acos(1-n/s);o=0==p?400:Math.PI/p+.5}i=Math.floor(a*o*(1/(2*Math.PI))+2.5)}var h=e.readCompressedInt();this.vertexBuffer||(this.vertexBuffer=new Qe);var u=this.vertexBuffer.posBuffer.length/3;switch(h){case $r:var f=new Bi;this.create2DArcCircleGP(this.vertexBuffer,f,r[0],r[1],t/2,0,2*Math.PI,i,!1,e),this.primitive=f;break;case et:case ht:f=new Bi;this.create2DArcCircleGP(this.vertexBuffer,f,r[0],r[1],t/2,0,2*Math.PI,i,!1,e),this.primitive=f;break;case rt:f=new Bi;this.create2DArcCircleGP(this.vertexBuffer,f,r[0],r[1],t/2,0,2*Math.PI,i,!0,e),this.primitive=f;break;case tt:f=new Bi;this.create2DArcCircleGP(this.vertexBuffer,f,r[0],r[1],t/2,0,2*Math.PI,i,!0,e);var d=e.materials.add({backgoundColor:!0});f.material={file:"",id:d},this.primitives.push(f);var c=new Bi;this.create2DArcCircleGP(this.vertexBuffer,c,r[0],r[1],t/2,0,2*Math.PI,i,!1,e);var l=(g=t/2)*Math.cos(Math.PI/4),v=g*Math.sin(Math.PI/4),m=g*Math.cos(5*Math.PI/4),y=g*Math.sin(5*Math.PI/4);u=this.vertexBuffer.posBuffer.length/3;this.vertexBuffer.posBuffer.push(r[0]+l),this.vertexBuffer.posBuffer.push(r[1]+v),this.vertexBuffer.posBuffer.push(e.idOrder),this.vertexBuffer.posBuffer.push(r[0]+m),this.vertexBuffer.posBuffer.push(r[1]+y),this.vertexBuffer.posBuffer.push(e.idOrder),this.vertexBuffer.posBuffer.push(r[0]-l),this.vertexBuffer.posBuffer.push(r[1]-y),this.vertexBuffer.posBuffer.push(e.idOrder),this.vertexBuffer.posBuffer.push(r[0]-m),this.vertexBuffer.posBuffer.push(r[1]-v),this.vertexBuffer.posBuffer.push(e.idOrder),this.createPolylineGP(u,c,4,0),this.primitives.push(c);break;case it:case st:case ot:case pt:var g=t/2;this.vertexBuffer.posBuffer.push(r[0]-g),this.vertexBuffer.posBuffer.push(r[1]-g),this.vertexBuffer.posBuffer.push(e.idOrder),this.vertexBuffer.posBuffer.push(r[0]-g),this.vertexBuffer.posBuffer.push(r[1]+g),this.vertexBuffer.posBuffer.push(e.idOrder),this.vertexBuffer.posBuffer.push(r[0]+g),this.vertexBuffer.posBuffer.push(r[1]+g),this.vertexBuffer.posBuffer.push(e.idOrder),this.vertexBuffer.posBuffer.push(r[0]+g),this.vertexBuffer.posBuffer.push(r[1]-g),this.vertexBuffer.posBuffer.push(e.idOrder);var x=new Bi;x.count=0;var B=[0,1,2,0,2,3];this.createPolygonGP(0,x,B,B.length,0,!0),this.primitive=x;break;case nt:case at:case ut:g=t/2;this.vertexBuffer.posBuffer.push(r[0]),this.vertexBuffer.posBuffer.push(r[1]+g),this.vertexBuffer.posBuffer.push(e.idOrder),this.vertexBuffer.posBuffer.push(r[0]-g),this.vertexBuffer.posBuffer.push(r[1]-g),this.vertexBuffer.posBuffer.push(e.idOrder),this.vertexBuffer.posBuffer.push(r[0]+g),this.vertexBuffer.posBuffer.push(r[1]-g),this.vertexBuffer.posBuffer.push(e.idOrder);var A=new Bi;A.count=0;B=[0,1,2];this.createPolygonGP(0,A,B,B.length,0,!0),this.primitive=A;break;case Yr:case Xr:var I=.5*t,b=1,C=0;h==Yr&&(C=-(b=Math.PI/4)),b*=I,C*=I,this.vertexBuffer.posBuffer.push(r[0]+b),this.vertexBuffer.posBuffer.push(r[1]+C),this.vertexBuffer.posBuffer.push(e.idOrder),this.vertexBuffer.posBuffer.push(r[0]-b),this.vertexBuffer.posBuffer.push(r[1]-C),this.vertexBuffer.posBuffer.push(e.idOrder),this.vertexBuffer.posBuffer.push(r[0]-C),this.vertexBuffer.posBuffer.push(r[1]+b),this.vertexBuffer.posBuffer.push(e.idOrder),this.vertexBuffer.posBuffer.push(r[0]+C),this.vertexBuffer.posBuffer.push(r[1]-b),this.vertexBuffer.posBuffer.push(e.idOrder);var w=new Bi;this.createPolylineGP(u,w,4,0),this.primitive=w;break;default:f=new Bi;this.create2DArcCircleGP(this.vertexBuffer,f,r[0],r[1],t/2,0,2*Math.PI,i,!0,e),this.primitive=f}return!0};var yt=function(){Tr.call(this),this.vertexBuffer=null,this.primitive=new Bi,this.point=[],this.zoomQuality=2,this.imageGP=!0};yt.prototype=Object.create(Tr.prototype),yt.prototype.constructor=yt,yt.prototype.lineType=null,yt.prototype.unstream=function(r){this.unstreamPrimitive(r),r.readFloatArray(0,2,this.point),this.point.push(0);r.readCompressedInt(),r.readCompressedInt(),r.readCompressedInt(),r.readCompressedInt();this.zoomQuality=r.readCompressedInt();var t=null;r.readBoolean()&&(t=(new Ve).unstream(r));if(null==t)return!1;var i=r.textures.add(t),s=t.width*t.xPixelSize,n=t.height*t.yPixelSize;0==this.zoomQuality&&(s=t.width,n=t.height),this.vertexBuffer||(this.vertexBuffer=new Qe),this.primitive.start=this.primitive.indices.length;var a=this.vertexBuffer.posBuffer.length/3;this.vertexBuffer.posBuffer.push(this.point[0]),this.vertexBuffer.posBuffer.push(this.point[1]),this.vertexBuffer.posBuffer.push(r.idOrder),this.vertexBuffer.posBuffer.push(this.point[0]+s),this.vertexBuffer.posBuffer.push(this.point[1]),this.vertexBuffer.posBuffer.push(r.idOrder),this.vertexBuffer.posBuffer.push(this.point[0]+s),this.vertexBuffer.posBuffer.push(this.point[1]+n),this.vertexBuffer.posBuffer.push(r.idOrder),this.vertexBuffer.posBuffer.push(this.point[0]),this.vertexBuffer.posBuffer.push(this.point[1]+n),this.vertexBuffer.posBuffer.push(r.idOrder),this.primitive.connectivity=e.ConnectivityTypeEnum.TRIANGLES,this.primitive.count=6,this.primitive.indices.push(a),this.primitive.indices.push(a+1),this.primitive.indices.push(a+2),this.primitive.indices.push(a+2),this.primitive.indices.push(a+3),this.primitive.indices.push(a+0),this.vertexBuffer.textureBuffer.push(0),this.vertexBuffer.textureBuffer.push(0),this.vertexBuffer.textureBuffer.push(0),this.vertexBuffer.textureBuffer.push(1),this.vertexBuffer.textureBuffer.push(0),this.vertexBuffer.textureBuffer.push(0),this.vertexBuffer.textureBuffer.push(1),this.vertexBuffer.textureBuffer.push(1),this.vertexBuffer.textureBuffer.push(0),this.vertexBuffer.textureBuffer.push(0),this.vertexBuffer.textureBuffer.push(1),this.vertexBuffer.textureBuffer.push(0);var o={textureId:i,shading:"Basic",primWithMaterials:!0,useAsGas:!0},p={file:"",id:r.materials.add(o)};return this.primitive.material=p,!0};var gt=function(){Tr.call(this),this.vertexBuffer=null,this.primitives=[],this.primitive=new Bi};gt.prototype=Object.create(Tr.prototype),gt.prototype.constructor=gt,gt.prototype.lineType=null,gt.prototype.unstream=function(e){return this.skip(e),!1},gt.prototype.skip=function(e){this.unstreamPrimitive(e);e.readFloatArray(0,2,[]),e.readFloatArray(0,2,[]);e.readFloat(),e.readFloat(),e.readFloat(),e.readCompressedInt();e.readFloatArray(0,10,[]),e.readFloatArray(0,2,[]);e.readStringWithLength()};var xt=function(){Tr.call(this),this.vertexBuffer=null,this.primitive=new Bi,this.text=null};xt.prototype=Object.create(Tr.prototype),xt.prototype.constructor=xt,xt.prototype.lineType=null,xt.prototype.unstream=function(e){this.unstreamPrimitive(e);var r=[];e.readFloatArray(0,2,r);var t=e.readFloat();e.readCompressedInt(),e.readCompressedInt();e.readBoolean()&&e.readGraphicAttributeSet(),e.readBoolean()&&e.readGraphicAttributeSet();var i=e.readCompressedInt();if(i>0){var s="",n=[];e.readShortArray(i,n);for(var a=0;a<i;a++)s+=String.fromCharCode(n[a])}return this.text={text:s,anchor:{x:r[0],y:r[1]},height:t},!1};var Bt=function(){Tr.call(this),this.vertexBuffer=null,this.primitive=new Bi,this.nodes=[]};Bt.prototype=Object.create(Tr.prototype),Bt.prototype.constructor=Bt,Bt.prototype.lineType=null,Bt.prototype.unstream=function(r){this.unstreamPrimitive(r);var t=r.readCompressedInt(),i=r.readCompressedInt(),s=r.readCompressedInt(),n=r.readCompressedInt(),a=r.readCompressedInt(),o=r.readFloat(),p=r.readFloat(),h=r.readFloat(),u=[];if(t>0&&i>0){var f=[],d=[];r.readFloatArray(0,2*i,f),r.readFloatArray(0,t,this.nodes),r.readFloatArray(0,i,d)}if(s>0){r.readFloatArray(0,2*s,[])}this.vertexBuffer||(this.vertexBuffer=new Qe),this.primitive.start=this.primitive.indices.length;var c=this.vertexBuffer.posBuffer.length/3;if(this.primitive.connectivity=e.ConnectivityTypeEnum.LINES,n){r.readFloatArray(0,2*n,u);for(var l=0;l<n;l++)this.primitive.indices.push(c++),this.vertexBuffer.posBuffer.push(u[2*l]),this.vertexBuffer.posBuffer.push(u[2*l+1]),this.vertexBuffer.posBuffer.push(r.idOrder),this.primitive.indices.push(c);return this.primitive.count=2*n-2,!0}var v=p-o;if(0==v)return!1;var m=Math.PI/Math.acos(1-.01/h)*.5+.5;m>100&&(m=100);var y,g,x,B=m+1,A=v/m;x=o;for(var I=!0,b=0;b<m+1;b++){var C,w,S,P;C=0,w=0,S=0,P=0;var M=0;for(l=0;l<i;l++)C+=(P=Math.abs(x-p)<=1e-5&&l==i-1?1:this.computeBSplineBase(l,a,x,1))*f[M]*d[l],w+=P*f[M+1]*d[l],S+=P*d[l],M+=2;S<=1e-15?B--:(y=C/S,g=w/S,this.vertexBuffer.posBuffer.push(y),this.vertexBuffer.posBuffer.push(g),this.vertexBuffer.posBuffer.push(r.idOrder),I||(this.primitive.indices.push(c++),this.primitive.indices.push(c)),I=!1),x=o+(b+1)*A}return B>0&&(this.primitive.count=2*B-2,!0)},Bt.prototype.computeBSplineBase=function(e,r,t,i){var s=0;if(1==r)s=t>=this.nodes[e]&&t<this.nodes[e+1]?1:0;else if(t<this.nodes[e]||t>=this.nodes[e+r])s=0;else{var n=this.computeBSplineBase(e,r-1,t,i),a=this.computeBSplineBase(e+1,r-1,t,i),o=1e-6*i;s=(Math.abs(this.nodes[e]-this.nodes[e+r-1])<=o?0:(t-this.nodes[e])/(this.nodes[e+r-1]-this.nodes[e]))*n+(Math.abs(this.nodes[e+1]-this.nodes[e+r])<=o?0:(this.nodes[e+r]-t)/(this.nodes[e+r]-this.nodes[e+1]))*a}return s};var At=function(){Tr.call(this),this.vertexBuffer=null,this.primitive=new Bi};At.prototype=Object.create(Tr.prototype),At.prototype.constructor=At,At.prototype.lineType=null,At.prototype.unstream=function(r){this.unstreamPrimitive(r);var t=r.readCompressedInt(),i=[];if(t>0){r.readFloatArray(0,2*t,i),this.vertexBuffer||(this.vertexBuffer=new Qe),this.primitive.start=this.primitive.indices.length;var s=this.vertexBuffer.posBuffer.length/3;if(this.primitive.connectivity=e.ConnectivityTypeEnum.LINES,t<4)return!1;var n,a,o,p,h,u,f,d,c,l,v,m,y,g,x=(t-1)%3,B=t-x,A=0;n=i[0],a=i[1];for(var I=2,b=0;b<B-1;b+=3){c=(f=i[I+4])-n+3*(o=i[I])-3*(h=i[I+2]),l=(d=i[I+5])-a+3*(p=i[I+1])-3*(u=i[I+3]),v=3*(h-2*o+n),m=3*(u-2*p+a),y=3*(o-n),g=3*(p-a);var C=Math.sqrt((n-f)*(n-f)+(a-d)*(a-d))/2;A=.01;var w=0;if(C>0&&A>=0&&A<=2*C){var S=Math.acos(1-A/C);S>0&&(w=Math.floor(Math.PI/S*.5+.5))}w<=0&&(w=1),w>100&&(w=100);var P,M,T,F=w+1,U=1/w;P=n,M=a,this.vertexBuffer.posBuffer.push(P),this.vertexBuffer.posBuffer.push(M),this.vertexBuffer.posBuffer.push(r.idOrder),T=U;for(var R=0;R<w;R++)P=c*Math.pow(T,3)+v*Math.pow(T,2)+y*T+n,M=l*Math.pow(T,3)+m*Math.pow(T,2)+g*T+a,this.vertexBuffer.posBuffer.push(P),this.vertexBuffer.posBuffer.push(M),this.vertexBuffer.posBuffer.push(r.idOrder),this.primitive.indices.push(s++),this.primitive.indices.push(s),T+=U;this.primitive.count=2*F-2,n=f,a=d,I+=6}if(x>0)for(b=0;b<x+1;b++)this.vertexBuffer.posBuffer.push(i[2*(B-1+b)]),this.vertexBuffer.posBuffer.push(i[2*(B-1+b)+1]),this.primitive.indices.push(s++),this.primitive.indices.push(s);return this.primitive.count+=2*(x+1),!0}return!1};var It=function(){Tr.call(this),this.vertexBuffer=null,this.primitive=new Bi,this.primitives=[]};It.prototype=Object.create(Tr.prototype),It.prototype.constructor=It,It.prototype.lineType=null,It.prototype.unstream=function(r){this.unstreamPrimitive(r);var t=r.readCompressedInt(),i=[],s=0;r.readUncompressedIntArray(t,i);for(var n=0;n<t;++n)s+=i[n];var a=0;a=r.version<1101840||r.version>=21e5&&r.version<2100130?s:r.readCompressedInt();var o=[];r.readFloatArray(0,2*a,o),this.vertexBuffer||(this.vertexBuffer=new Qe);var p=this.vertexBuffer.posBuffer.length/3;for(n=0;n<a;n++)this.vertexBuffer.posBuffer.push(o[2*n]),this.vertexBuffer.posBuffer.push(o[2*n+1]),this.vertexBuffer.posBuffer.push(r.idOrder);if(r.readCompressedInt()){var h=new Bi;h.cgmId=this.primitive.cgmId,h.start=h.indices.length,h.connectivity=e.ConnectivityTypeEnum.TRIANGLES;var u=r.readCompressedInt(),f=[],d=[],c=0,l=[];r.readUncompressedIntArray(u,f),r.readUncompressedIntArray(u,d);for(n=0;n<u;++n)c+=f[n];r.readUncompressedIntArray(c,l),h.count=0;var v=0;for(n=0;n<u;++n)switch(d[n]){case 0:case 4:h.count+=f[n];for(var m=0;m<f[n];++m)h.indices.push(l[v++]-1);break;case 1:case 5:h.count+=3*(f[n]-2);var y=0;for(m=0;m<f[n]-2;m++)h.indices.push(l[v]-1),h.indices.push(l[v+1+y]-1),h.indices.push(l[v+2-y]-1),v++,y=1-y;v+=2;break;case 2:case 6:h.count+=3*(f[n]-2);var g=l[v]-1;for(m=0;m<f[n]-2;m++)h.indices.push(g),h.indices.push(l[v+2]-1),h.indices.push(l[v+1]-1),v++;v+=2;break;default:return null}return this.primitives.push(h),!0}var x=new Bi;x.cgmId=this.primitive.cgmId,x.start=x.indices.length,x.connectivity=e.ConnectivityTypeEnum.LINES,x.count=2*a-2;for(g=p,n=1;n<a;n++)x.indices.push(p++),x.indices.push(p);return x.indices.push(p),x.indices.push(g),this.primitives.push(x),!0};var bt=function(){Tr.call(this),this.vertexBuffer=null,this.primitive=new Bi,this.text=null,this.noRender=!0};bt.prototype=Object.create(Tr.prototype),bt.prototype.constructor=bt,bt.prototype.lineType=null,bt.prototype.unstream=function(r){var t=r.readCompressedInt(),i=[];r.readBytes(t,i);for(var s="",n=0;n<i.length;n++)s+=String.fromCharCode(i[n]);var a=s.substring(s.length-5,s.length),o=!0;".font"!==a&&".FONT"!==a||(o=!1);var h=r.readCompressedInt(),u="";for(n=0;n<h;n++)u+=String.fromCharCode(r.readUnsignedShort());r.readUnsignedShort();r.readFloat(),r.readFloat(),r.readFloat(),r.readFloat();var f=r.readShort();r.readFloatArray(0,4,[]);var d=r.readFloat(),c=r.readShort();r.readShort();r.readFloatArray(0,2,[]);r.readFloat(),r.readFloat(),r.readFloat(),r.readFloat(),r.readFloat();var l=r.readShort();if(r.version>=2100020||r.version>=1101600&&r.version<21e5)r.readCompressedInt();if(r.version>=2100070||r.version>=1101730&&r.version<21e5)r.readCompressedInt();r.readCompressedInt(),r.readCompressedInt();var v=[r.readFloat(),r.readFloat(),r.readFloat(),r.readFloat()];if(r.version>=1101330)r.readFloat();var m=[];if((r.readFloatArray(0,22,m),o&&(r.readFloat(),r.readFloat(),r.readFloat(),r.readFloat(),r.readFloat(),r.readFloat(),r.readFloat()),r.version>=210042530)&&r.readBit()){if(this.vertexBuffer||(this.vertexBuffer=new Qe),r.readBit()){var y=0,g=[];(y=r.readCompressedInt())>0&&r.readFloatArray(0,2*y,g);for(n=0;n<y;++n)this.vertexBuffer.posBuffer.push(g[2*n]),this.vertexBuffer.posBuffer.push(g[2*n+1]),this.vertexBuffer.posBuffer.push(0);var x=r.readCompressedInt(),B=[];x>0&&r.readUncompressedIntArray(x,B);for(n=0;n<x;++n)B[n]-=1;var A=[],I=[],b=0;(P=r.readCompressedInt())>0&&(r.readUncompressedIntArray(P,A),r.readUncompressedIntArray(P,I));for(n=0;n<P;n++)switch(this.primitive.connectivity=e.ConnectivityTypeEnum.TRIANGLES,I[n]){case 0:case 4:this.primitive.count+=A[n];for(var C=0;C<A[n];++C)this.primitive.indices.push(B[b++]);break;case 1:case 5:this.primitive.count+=3*(A[n]-2);var w=0;for(C=0;C<A[n]-2;C++)this.primitive.indices.push(B[b]),this.primitive.indices.push(B[b+1+w]),this.primitive.indices.push(B[b+2-w]),b++,w=1-w;b+=2;break;case 2:case 6:this.primitive.count+=3*(A[n]-2);var S=B[b];for(C=0;C<A[n]-2;C++)this.primitive.indices.push(S),this.primitive.indices.push(B[b+2]),this.primitive.indices.push(B[b+1]),b++;b+=2;break;default:return null}}else{y=0,g=[];(y=r.readCompressedInt())>0&&r.readFloatArray(0,2*y,g);for(n=0;n<y;++n)this.vertexBuffer.posBuffer.push(g[2*n]),this.vertexBuffer.posBuffer.push(g[2*n+1]),this.vertexBuffer.posBuffer.push(0);A=[];var P,M=0;(P=r.readCompressedInt())>0&&r.readUncompressedIntArray(P,A);for(n=0;n<P;n++){this.primitive.connectivity=e.ConnectivityTypeEnum.LINES,this.primitive.count+=A[n];for(C=1;C<A[n];++C)this.primitive.indices.push(M++),this.primitive.indices.push(M);M++}}return!0}if(p&&h){var T=r.getStaticMode(),F=r.getCurrentMatrix();this.text={text:u,attachedPoint:T,bbox:v,horJustif:f,verJustification:l,matrix:F,fontName:s,color:null,stroke:!1,path:c,bold:!1,italic:!1,width:m[21],orientationAngle:d}}};var Ct=function(){Tr.call(this),this.vertexBuffer=null,this.primitive=new Bi};(Ct.prototype=Object.create(Tr.prototype)).constructor=Ct,Ct.prototype.lineType=null,Ct.prototype.unstream=function(e){var r=wt.prototype.unstream.call(this,e),t=e.readCompressedInt();if(t>0){e.readUncompressedIntArray(t,[])}return r};var wt=function(){Tr.call(this),this.vertexBuffer=null,this.primitive=new Bi};wt.prototype=Object.create(Tr.prototype),wt.prototype.constructor=wt,wt.prototype.lineType=null,wt.prototype.unstream=function(r){this.unstreamPrimitive(r);var t=r.readUnsignedChar();if(r.version>=1101900&&r.version<21e5||r.version>=2100170){if(0==r.readCompressedInt())return r.readCompressedInt(),r.readCompressedInt(),!1;var i=[];if((l=r.readCompressedInt())>0){var s=[];r.readFloatArray(0,2*l,i)}var n=r.readCompressedInt();this.vertexBuffer||(this.vertexBuffer=new Qe),this.primitive.start=this.primitive.indices.length;for(var a=this.vertexBuffer.posBuffer.length/3,o=0;o<l;++o)this.vertexBuffer.posBuffer.push(i[2*o]),this.vertexBuffer.posBuffer.push(i[2*o+1]),this.vertexBuffer.posBuffer.push(r.idOrder);if(n>0){if(4!=t&&3!=t||!u)for(o=0;o<l;++o)this.vertexBuffer.normalBuffer.push(0),this.vertexBuffer.normalBuffer.push(0),this.vertexBuffer.normalBuffer.push(1);else for(var o=0;o<l;++o)this.vertexBuffer.normalBuffer.push(0),this.vertexBuffer.normalBuffer.push(0),this.vertexBuffer.normalBuffer.push(0);var p=[],h=[];for(o=0;o<n;++o)p[o]=r.readUncompressedInt();for(o=0;o<n;++o)h[o]=r.readUncompressedInt();var f=0;for(o=0;o<n;o++)f+=h[o];var d=[];for(o=0;o<f;++o)d[o]=r.readUncompressedInt()-1;this.primitive.count=0;var c=a;for(o=0;o<n;++o)c=this.createPolygonGP(c,this.primitive,d,h[o],p[o],!0)}else this.createPolygonGP(a,this.primitive,void 0,l,void 0,!1);return 4!=t&&3!=t||!!u&&2}this.vertexBuffer||(this.vertexBuffer=new Qe),this.primitive.connectivity=e.ConnectivityTypeEnum.TRIANGLES,this.primitive.start=this.primitive.indices.length;var l;a=this.vertexBuffer.posBuffer.length/3;if((l=r.readCompressedInt())>0){s=[];r.readFloatArray(0,2*l,s)}if(1==t){if((n=r.readCompressedInt())>0){for(p=[],h=[],o=0;o<n;++o)p[o]=r.readUncompressedInt();for(o=0;o<n;++o)h[o]=r.readUncompressedInt(),0!==p[o]&&4!==p[o]||h[o]/3,1!==p[o]&&5!==p[o]||h[o]-2,2!==p[o]&&6!==p[o]||h[o]-2;var v=0;for(o=0;o<n;o++)v+=h[o];var m=[];for(o=0;o<v;++o)m[o]=r.readUncompressedInt();var y=0;for(o=0;o<n;++o){if(0===p[o]||4===p[o]){v=h[o];for(var g=0;g<v;++g)this.primitive.indices.push(m[y++]-1+a)}if(1===p[o]||5===p[o]){var x=h[o];for(g=2;g<x;++g)g%2?(this.primitive.indices.push(m[y+g]-1+a),this.primitive.indices.push(m[y+g-1]-1+a),this.primitive.indices.push(m[y+g-2]-1+a)):(this.primitive.indices.push(m[y+g-1]-1+a),this.primitive.indices.push(m[y+g]-1+a),this.primitive.indices.push(m[y+g-2]-1+a));y+=x}if(2===p[o]||6===p[o]){var B=h[o];for(g=2;g<B;++g)this.primitive.indices.push(m[y]-1+a),this.primitive.indices.push(m[y+g-1]-1+a),this.primitive.indices.push(m[y+g]-1+a);y+=B}}this.primitive.count=this.primitive.indices.length}for(o=0;o<l;++o)this.vertexBuffer.posBuffer.push(s[2*o]),this.vertexBuffer.posBuffer.push(s[2*o+1]),this.vertexBuffer.posBuffer.push(r.idOrder)}return 4!=t&&3!=t};var St=function(){Tr.call(this),this.primitive=new Bi};St.prototype=Object.create(Tr.prototype),St.prototype.constructor=St,St.prototype.lineType=null,St.prototype.unstream=function(e){this.unstreamPrimitive(e);var r=e.readDouble(),t=e.readDouble(),i=e.readDouble(),s=e.readDouble(),n=e.readDouble(),a=e.readUnsignedChar(),o=e.readCompressedInt(),p=(e.readDouble(),e.readDouble(),17);if(ys){var h=ys,u=n-s,f=400;if(0==o)if(i*Math.PI*2<ys);else{h>i&&(h=i);var d=Math.acos(1-h/i);f=0==d?400:Math.PI/d+.5}p=Math.floor(u*f*(1/(2*Math.PI))+2.5)}return this.vertexBuffer||(this.vertexBuffer=new Qe),this.create2DArcCircleGP(this.vertexBuffer,this.primitive,r,t,i,s,n,p,a,e),!0};var Pt=function(){Tr.call(this),this.vertexBuffer=null,this.primitive=new Bi};Pt.prototype=Object.create(Tr.prototype),Pt.prototype.constructor=Pt,Pt.prototype.lineType=null,Pt.prototype.unstream=function(r){this.unstreamPrimitive(r),this.primitive.connectivity=e.ConnectivityTypeEnum.LINES,this.vertexBuffer||(this.vertexBuffer=new Qe);var t=this.vertexBuffer.posBuffer.length/3,i=r.readCompressedInt(),s=r.readUnsignedChar(),n=!1;0==s&&1&i&&(i--,n=!0);for(var a=0;a<i;++a)this.vertexBuffer.posBuffer.push(r.readFloat()),this.vertexBuffer.posBuffer.push(r.readFloat()),this.vertexBuffer.posBuffer.push(r.idOrder);if(n&&(r.readFloat(),r.readFloat()),this.createPolylineGP(t,this.primitive,i,s),r.version>=1101850&&r.version<21e5||r.version>=2100170)r.readUnsignedChar();else if(2==i){var o=this.vertexBuffer.posBuffer.length-6;this.vertexBuffer.posBuffer[o],this.vertexBuffer.posBuffer[o+3],this.vertexBuffer.posBuffer[o],this.vertexBuffer.posBuffer[o+3];(this.vertexBuffer.posBuffer[o+1]-this.vertexBuffer.posBuffer[o+4])*(this.vertexBuffer.posBuffer[o+1]-this.vertexBuffer.posBuffer[o+4])}return!0};var Mt=function(){Tr.call(this),this.vertexBuffer=null,this.primitive=new Bi};Mt.prototype=Object.create(Tr.prototype),Mt.prototype.constructor=Mt,Mt.prototype.lineType=null,Mt.prototype.unstream=function(r){this.unstreamPrimitive(r),this.vertexBuffer||(this.vertexBuffer=new Qe),this.primitive.symbol=r.readCompressedInt();var t=this.vertexBuffer.posBuffer.length/3;this.primitive.start=this.primitive.indices.length,this.primitive.connectivity=e.ConnectivityTypeEnum.POINTS;var i=r.readCompressedInt();this.primitive.count=i;for(var s=0;s<i;s++)this.vertexBuffer.posBuffer.push(r.readFloat()),this.vertexBuffer.posBuffer.push(r.readFloat()),this.vertexBuffer.posBuffer.push(r.idOrder),this.primitive.indices.push(t++);return!0};var Tt=function(){Tr.call(this),this.vertexBuffer=null,this.primitive=new Bi};Tt.prototype=Object.create(Tr.prototype),Tt.prototype.constructor=Tt,Tt.prototype.lineType=null,Tt.prototype.unstream=function(t){this.unstreamPrimitive(t);var i=t.readDouble(),s=t.readDouble(),n=t.readDouble(),a=t.readDouble(),o=t.readDouble(),p=t.readDouble(),h=t.readDouble(),u=t.readUnsignedChar(),f=t.readCompressedInt(),d=t.readDouble(),c=t.readDouble(),l=n>a?n:a;p<o&&(p+=2*Math.PI),o<0&&(o+=2*Math.PI,p+=2*Math.PI);var v=p-o,m=17;if(ys){var y=ys,g=(v=p-o,400);if(0==f)if(l*Math.PI*2<ys);else y>l&&(y=l),g=0==(A=Math.acos(1-y/l))?400:Math.PI/A+.5;m=Math.floor(v*g*(1/(2*Math.PI))+2.5)}var x=v/(m-1),B=[];B[0]=d*n,B[1]=c*a,B[2]=t.idOrder;var A=a/n,I=Math.cos(x),b=Math.sin(x),C=0,w=3;for(C=1;C<m;C++)B[w]=I*B[w-3]-b*B[w-2]/A,B[w+1]=b*B[w-3]*A+I*B[w-2],B[w+2]=t.idOrder,w+=3;var S=new r.Matrix4;S.makeRotationZ(h),S.setPosition({x:i,y:s,z:0}),w=0;var P=new r.Vector4;for(C=0;C<m;C++)P.set(B[w],B[w+1],0,1),P.applyMatrix4(S),B[w]=P.x,B[w+1]=P.y,B[w+2]=t.idOrder,w+=3;this.vertexBuffer||(this.vertexBuffer=new Qe),this.primitive.start=this.primitive.indices.length;var M=this.vertexBuffer.posBuffer.length/3;if(u){this.primitive.connectivity=e.ConnectivityTypeEnum.TRIANGLES,this.primitive.count=3*(m-2),this.vertexBuffer.posBuffer=B;for(C=1;C<m-1;C++)this.primitive.indices.push(0),this.primitive.indices.push(C),this.primitive.indices.push(C+1)}else{this.primitive.connectivity=e.ConnectivityTypeEnum.LINES,this.primitive.count=2+2*(m-2),this.vertexBuffer.posBuffer=B;for(C=1;C<m;++C)this.primitive.indices.push(M++),this.primitive.indices.push(M)}return!0};var Ft=function(){Tr.call(this),this.vertexBuffer=null,this.primitive=new Bi,this.noRender=!0};Ft.prototype=Object.create(Tr.prototype),Ft.prototype.constructor=Ft,Ft.prototype.lineType=null,Ft.prototype.unstream=function(r){if(this.unstreamPrimitive(r),r.getLightDataStreaming()){this.primitive.connectivity=e.ConnectivityTypeEnum.LINES,this.vertexBuffer||(this.vertexBuffer=new Qe);var t=this.vertexBuffer.posBuffer.length/3;this.primitive.start=this.primitive.indices.length;var i=r.readCompressedInt(),s=r.readCompressedInt();switch(this.primitive.count=i,s){case 0:this.primitive.count=i;for(var n=0;n<i;++n)this.vertexBuffer.posBuffer.push(r.readFloat()),this.vertexBuffer.posBuffer.push(r.readFloat()),this.vertexBuffer.posBuffer.push(r.readFloat()),this.primitive.indices.push(t++);break;case 1:this.primitive.count=2+2*(i-2),this.vertexBuffer.posBuffer.push(r.readFloat()),this.vertexBuffer.posBuffer.push(r.readFloat()),this.vertexBuffer.posBuffer.push(r.readFloat());for(n=1;n<i;++n)this.primitive.indices.push(t++),this.vertexBuffer.posBuffer.push(r.readFloat()),this.vertexBuffer.posBuffer.push(r.readFloat()),this.vertexBuffer.posBuffer.push(r.readFloat()),this.primitive.indices.push(t);break;case 2:this.primitive.count=4+2*(i-2);var a=t;this.vertexBuffer.posBuffer.push(r.readFloat()),this.vertexBuffer.posBuffer.push(r.readFloat()),this.vertexBuffer.posBuffer.push(r.readFloat());for(n=1;n<i;++n)this.primitive.indices.push(t++),this.vertexBuffer.posBuffer.push(r.readFloat()),this.vertexBuffer.posBuffer.push(r.readFloat()),this.vertexBuffer.posBuffer.push(r.readFloat()),this.primitive.indices.push(t);this.primitive.indices.push(t),this.primitive.indices.push(a);break;default:return null}if(2==i){var o=this.vertexBuffer.posBuffer.length-6,p=this.vertexBuffer.posBuffer,h=(p[o]-p[o+3])*(p[o]-p[o+3]);h+=(p[o+1]-p[o+4])*(p[o+1]-p[o+4]),(h+=(p[o+2]-p[o+5])*(p[o+2]-p[o+5]))>=1e12&&(this.primitive.noRender=!0)}}},Ft.prototype.skip=function(e){if(this.unstreamPrimitive(e),e.getLightDataStreaming()){var r=e.readCompressedInt();e.readCompressedInt();r>0&&e.skip(3*r*4)}};var Ut=function(){Ft.call(this)};Ut.prototype=Object.create(Ft.prototype),Ut.prototype.constructor=Ut;var Rt=0,Nt=1,Gt=2,Ot=1,Et=2,Vt=4,Dt=8,kt=16,Lt=function(){},_t=[],jt=null,zt=function(e,r,t){this.newIdx=e,this.normal=r,this.next=t},Wt=function(e,r,t){if(jt){var i=jt;return jt=jt.next,i.newIdx=e,i.normal=r,i.next=t,i}return new zt(e,r,t)},Ht=function(e){for(var r=e;r;){var t=r.next;r.next=jt,jt=r,r=t}};Lt.prototype.buildRep=function(t,i,s){for(var n=t?t.posBuffer:null,a=t?t.uvsBuffer:null,o=t?t.binormalsBuffer:null,p=t?t.tangentsBuffer:null,h=t?t.normalBuffer:null,u=t?t.textureBuffer:null,f=n?n.length/3:0,d=h?h.length/3:0,c=_t.length;c<f;++c)_t[c]=null;var l=new e.Mesh,v=f,m=0,y=i.length,g=0;for(c=0;c<y;c++)g+=i[c].nbIndices;var x=new Uint32Array(g),B=0;for(c=0;c<y;c++){var A=0,I=i[c],b=null==I.material?s.getCurrentMatId():I.material;switch(I.connectivity){case e.ConnectivityTypeEnum.TRIANGLES:A=new e.DrawingGroup(I.gas,b,4,B,I.nbIndices,void 0,void 0,r.GeomTypeEnum[I.geomType]);break;case e.ConnectivityTypeEnum.LINES:A=new e.DrawingGroup(I.gas,b,1,B,I.nbIndices,void 0,void 0,r.GeomTypeEnum[I.geomType]);break;case e.ConnectivityTypeEnum.POINTS:A=new e.DrawingGroup(I.gas,b,0,B,I.nbIndices,void 0,void 0,r.GeomTypeEnum[I.geomType])}m=I.set.length;var C=I.set;A._primitives=new Array(m);for(var w=0;w<m;w++){var S=B,P=C[w],M=P.indices?P.indices.length:0,T=P.planarNormals,F=P.planarNormals?P.planarNormals.length:0,U=P.indices;if(0===F)M&&(x.set(U,B),B+=M);else for(var R=T[0],N=T[1],G=T[2],O=0;O<M;O++){var E=U[O];if(E<d){var V=3*E;if(h[V]===R&&h[V+1]===N&&h[V+2]===G){x[B++]=E;continue}}else null===_t[E]&&(_t[E]=Wt(E,T,null));for(var D=!1,k=0,L=_t[E];null!==L;){var _=L.normal;if(_[0]===R&&_[1]===N&&_[2]===G){D=!0,k=L.newIdx;break}L=L.next}D?x[B++]=k:(_t[E]=Wt(v,T,_t[E]),x[B++]=v++)}var j=new e.MeshPrimitive(P.cgmId,A,S,M);P.decoration&&(j.decoration=P.decoration),P.boundingSphere&&(j.boundingSphere=P.boundingSphere),A._primitives[w]=j}l.drawingGroups.push(A)}var z=new Float32Array(3*v),W=new Float32Array(3*v),H=null,q=!!t&&t.hasUVs,Y=!!t&&t.hasTangentsBinormals,X=!!t&&t.hasTextures;q&&(H=new Float32Array(3*v));var Z=null;Y&&(Z=new Float32Array(3*v));var Q=null;Y&&(Q=new Float32Array(3*v));var J=null;X&&(J=new Float32Array(3*v));var K=h?h.length:0,$=n?n.length:0;for(c=0;c<K;++c)W[c]=h[c];for(c=0;c<$;++c)z[c]=n[c];if(q)for(c=0;c<$;++c)H[c]=a[c];if(Y)for(c=0;c<$;++c)Z[c]=o[c],Q[c]=p[c];if(X)for(c=0;c<$;++c)J[c]=u[c];for(c=0;c<f;++c)for(L=_t[c];null!==L;){var ee=3*c,re=3*L.newIdx;z[re]=n[ee],z[re+1]=n[ee+1],z[re+2]=n[ee+2],W[re]=L.normal[0],W[re+1]=L.normal[1],W[re+2]=L.normal[2],q&&(H[re]=a[ee],H[re+1]=a[ee+1],H[re+2]=a[ee+2]),Y&&(Z[re]=o[ee],Z[re+1]=o[ee+1],Z[re+2]=o[ee+2],Q[re]=p[ee],Q[re+1]=p[ee+1],Q[re+2]=p[ee+2]),X&&(J[re]=u[ee],J[re+1]=u[ee+1],J[re+2]=u[ee+2]),L=L.next}l.vertexIndexArray=x,l.vertexPositionArray=z,l.vertexNormalArray=W,l.vertexUvArray=J,l.vertexTangentArray=Q,l.vertexBinormalArray=Z;var te=new r.Color,ie=new r.Color,se=this.rep.repGas,ne=se>>24&255,ae=se>>16&255,oe=se>>8&255,pe=255&se;te.setRGB(ne,ae,oe),ie.setRGB(ne,ae,oe),l.gas.fill={color:te,opacity:pe},l.gas.line={color:ie,opacity:pe,lineWidth:1};var he=[0,0,0],ue=[0,0,0],fe=z;if($>=3){var de,ce,le,ve,me,ye;de=ce=fe[0],le=ve=fe[1],me=ye=fe[2];for(var ge=3;ge<$;ge+=3){var xe=fe[ge],Be=fe[ge+1],Ae=fe[ge+2];xe<de?de=xe:xe>ce&&(ce=xe),Be<le?le=Be:Be>ve&&(ve=Be),Ae<me?me=Ae:Ae>ye&&(ye=Ae)}he=[de,le,me],ue=[ce,ve,ye]}l.AABB={min:he,max:ue};for(c=0;c<f;c++)Ht(_t[c]),_t[c]=null;return l},Lt.prototype.resolvedInheritance=function(r,t){if(t.globalMatrix=r.getCurrentMatrix(),t.axis){var i=r.axisSystems.add(t);return t.axisSystems=i,r.popMatId(),r.popGAS(),this}if(t.curveVertices){i=r.curvedPipes.add(t);return this.rep.curvedPipe=i,r.popMatId(),r.popGAS(),this}if(null!=t.canonicalType){i=r.canonicals.add(t);return this.rep.canonical=i,r.popMatId(),r.popGAS(),this}if(t.refPlanes){i=r.refPlanes.add(t);return t.refPlaneInd=i,this}if(t.arrows){i=r.arrows.add(t);return t.arrowInd=i,this}if(t.voxelRep){i=r.voxelReps.add(t);return t.voxelRepInd=i,this}var s=r.getFixMode(),n=r.getGAS(null),o=(n.getType(),n.isNoZ()),p=n.isHidden(),h=n.isSolid(),u=r.getStaticMode();t.gas=n,this.rep.node.solid=h,a&&t.rep instanceof e.SGRep&&(t.rep.boundingSphere=this.rep.boundingSphere),o&&(t.noZ=!0),p&&(t.noShow=!0),u&&(t.attachedPoint=u);var f=r.addReps(t,u,o,this.rep.excludeFromBounding,s);f&&(this.rep.renderType=f.renderType,this.rep.repIndice=f.indice)},Lt.prototype.getCompressedRep=function(e){if(this.rep.node.type){var r=e.sgRep,t=e.nbRep++;return r.push(this.rep.node.cgmId+1),r.push(this.rep.node.solid),r.push(this.rep.node.namingContext),o&&r.push(this.rep.node.sag),a&&(r.push(this.rep.boundingSphere.radius),r.push(this.rep.boundingSphere.center[0]),r.push(this.rep.boundingSphere.center[1]),r.push(this.rep.boundingSphere.center[2])),this.rep.node=t,t}return this.rep.node},Lt.prototype.addMesh=function(e){var r=this.build(e);return null==r?(e.popMatId(),e.popGAS(),null):(this.resolvedInheritance(e,r),r.rep=this.getCompressedRep(e),e.popMatId(),e.popGAS(),this)};var qt=function(){Lt.call(this),this.rep=new Kt};(qt.prototype=Object.create(Lt.prototype)).constructor=qt;var Yt=function(){Lt.call(this),this.rep=new Zt};(Yt.prototype=Object.create(Lt.prototype)).constructor=Yt;var Xt=function(e){e=e||{},this.repInheritanceMode=void 0!==e.repInheritanceMode?e.repInheritanceMode:0,this.repGAS=void 0!==e.repGAS?e.repGAS:0,this.materialInheritance=void 0!==e.materialInheritance?e.materialInheritance:0,this.material=void 0!==e.material?e.material:{file:"",id:-1},this.node=void 0!==e.node?e.node:null,this.boundingSphere=null};Xt.prototype.unstream=function(e){this.namingContext=0,this.repInheritanceMode=e.readCompressedInt(),this.repGAS=e.readGraphicAttributeSet(),this.repGAS.isHidden()&&(this.node.noShow=!0),e.pushGAS(this.repGAS,this.repInheritanceMode),this.material={file:"",id:-1},this.materialInheritance=0;e.readCompressedInt(),e.readCompressedInt();var r=e.readFloat(),t=e.readFloat(),i=e.readFloat(),s=e.readFloat(),n=(t-r)*(t-r)+(s-i)*(s-i);if(n=.5*Math.sqrt(n),this.boundingSphere={radius:n,center:[.5*(t+r),.5*(s+i),0]},e.version>=1101303)e.readFloat();e.version>=210042500&&e.readUnsignedShort()},Xt.prototype.childClone=function(){var e=new Array;for(var r in this.children)e[r]="object"==typeof this.children[r]?this.children[r].clone():this.children[r];return e};var Zt=function(r){Xt.call(this,r=r||{}),this.node=void 0!==r.node?r.node:new e.SGRep,this.repIndice=void 0!==r.repIndice?r.repIndice:-1,this.renderType=void 0!==r.renderType?r.renderType:0};Zt.prototype=Object.create(Xt.prototype),Zt.prototype.constructor=Zt,Zt.prototype.clone=function(){return new Zt({repIndice:this.repIndice,renderType:this.renderType,node:this.node,namingContext:this.namingContext,materialInheritance:this.materialInheritance,currentMatId:this.currentMatId,material:this.material,repGAS:this.repGAS,repInheritanceMode:this.repInheritanceMode})};var Qt=function(r){Xt.call(this,r=r||{}),this.node=void 0!==r.node?r.node:new e.SGBag,this.children=void 0!==r.children?this.childClone(r.children):[]};(Qt.prototype=Object.create(Xt.prototype)).constructor=Qt,Qt.prototype.clone=function(){return new Qt({children:this.childClone(),node:this.node.clone(),materialInheritance:this.materialInheritance,currentMatId:this.currentMatId,material:this.material,repGAS:this.repGAS,repInheritanceMode:this.repInheritanceMode})};var Jt=function(e){e=e||{},this.repInheritanceMode=void 0!==e.repInheritanceMode?e.repInheritanceMode:0,this.repGAS=void 0!==e.repGAS?e.repGAS:0,this.materialInheritance=void 0!==e.materialInheritance?e.materialInheritance:0,this.material=void 0!==e.material?e.material:{file:"",id:-1},this.layer=void 0!==e.layer?e.layer:ae.LAYER_MAX,this.node=void 0!==e.node?e.node:null,this.boundingSphere=null};Jt.prototype.unstream=function(e){this.namingContext=0,this.repInheritanceMode=e.readCompressedUInt(),this.repGAS=e.readGraphicAttributeSet(),this.repGAS.isHidden()&&(this.node.noShow=!0),e.pushGAS(this.repGAS,this.repInheritanceMode),0==e.getGAS(null).getType()&&(this.noZ=!0),this.material={file:"",id:-1},this.materialInheritance=0,2==e.readCompressedInt()&&(this.excludeFromBounding=!0);e.readCompressedInt();var r=e.readFloat(),t=(e.readFloat(),e.readFloat()),i=e.readFloat(),s=e.readFloat();(this.boundingSphere={radius:r,center:[t,i,s]},e.version>=210042410)&&(j=e.readBit(),(_===E||_===V||e.version>=210042415&&z==D)&&j&&(nr.x=e.readFloat(),nr.y=e.readFloat(),nr.z=e.readFloat(),ar.x=e.readFloat(),ar.y=e.readFloat(),ar.z=e.readFloat()));if(e.version>1100800&&(this.node.cgmId=e.readUncompressedULong(),e.readUnsignedShort(),e.version>1101020&&(this.namingContext=e.readUnsignedChar(),this.node.namingContext=this.namingContext)),e.readUnsignedChar()){var n=this.materialApplicationUnstream(e,ae.STREAM_MATERIAL|ae.STREAM_INHERIT_INT);this.material=n.material,this.materialInheritance=n.inheritanceMaterial}if(e.version>=210041800&&e.readUnsignedChar()){if((n=this.materialApplicationUnstream(e,ae.STREAM_LAYER_ULONG|ae.STREAM_UVTRANSFO|ae.STREAM_MAPPING_INFO|ae.STREAM_LIGHTMAP)).mapping)(p=e.materials.get([this.material.id]))&&(p.mapping=n.mapping);this.layer=n.layer;var a=e.readCompressedUInt();if(a>0)for(var o=0;o<a;++o){var p;if((n=this.materialApplicationUnstream(e,ae.STREAM_ALL_ULONG)).mapping)(p=e.materials.get([n.material.id]))&&(p.mapping=n.mapping);(n.layer<this.layer||n.layer==this.layer&&n.inheritanceMaterial>=this.materialInheritance)&&(this.layer=n.layer,this.material=n.material,this.materialInheritance=n.inheritanceMaterial)}}if((e.pushMatId(this.material,this.materialInheritance,this.layer,this),e.version>=210041910)&&e.readUnsignedChar()){e.readBytes(6,[])}},Jt.prototype.materialApplicationUnstream=function(e,r){var t={material:null,inheritanceMaterial:1,layer:0};if(r&ae.STREAM_MATERIAL&&(t.material=this.unstreamMaterial(e)),e.version>=1100500?r&ae.STREAM_INHERIT_INT?t.inheritanceMaterial=e.readCompressedInt():r&ae.STREAM_INHERIT_UINT?t.inheritanceMaterial=e.readCompressedInt():r&ae.STREAM_INHERIT_ULONG&&(t.inheritanceMaterial=e.readUncompressedInt()):r&(ae.STREAM_INHERIT_INT|ae.STREAM_INHERIT_UINT|ae.STREAM_INHERIT_ULONG)&&(t.inheritanceMaterial=1),r&ae.STREAM_LAYER_INT?t.layer=e.readUncompressedInt():r&ae.STREAM_LAYER_UINT?t.layer=e.readUncompressedInt():r&ae.STREAM_LAYER_ULONG&&(t.layer=e.readUncompressedUInt()),r&ae.STREAM_UVTRANSFO){if(e.version>=210041900){var i=[0,0,0,1];if(e.readBoolean()){var s=!0,n=e.readFloat(),a=e.readFloat(),o=e.readFloat(),p=e.readFloat();n!=i[0]&&(i[0]=n,s=!1),a!=i[1]&&(i[1]=a,s=!1),o!=i[2]&&(i[2]=o,s=!1),p!=i[3]&&(i[3]=p,s=!1),s||(t.mapping={type:0,ObjectTransformation:null,UvTransformation:null,UvTransfoInfos:i,transformSemantic:1})}}}if(r&ae.STREAM_MAPPING_INFO&&(e.version>=210042100&&!e.readBoolean())){var h=e.readStringWithLength();if(h=(h=JSON.parse(h)).mappings[h.uvSlots.Default],t.mapping||(t.mapping={type:0,ObjectTransformation:null,UvTransformation:null,UvTransfoInfos:null,transformSemantic:1}),h.uvTrfSemantic&&(t.mapping.transformSemantic=h.uvTrfSemantic+1),h.uvTransform&&(t.mapping.UvTransformation=e.createMatrix3(h.uvTransform)),h.operator&&(t.mapping.type=h.operator.type,h.operator.transform)){var u=h.operator.transform;t.mapping.ObjectTransformation=u}}if(r&ae.STREAM_LIGHTMAP&&(e.version>=210042320&&1==e.readCompressedInt()))e.readStringWithLength(),e.readCompressedInt(),e.readUncompressedULong();return t},Jt.prototype.unstreamMaterial=function(e){var r,t={file:"",id:-1},i=0,s=e.readUnsignedChar(),n=0,a=null;if(s){if(2==s){e.readStringWithLength();return i=e.readCompressedInt(),t.id=e.materials.add({external3DXid:i}),t}if(n=e.readCompressedInt(),e.materials.isValidMultiRefIndexWithName(n,e.name))return t={file:"",id:f=e.materials.getIndexWithName(n,e.name)}}if(e.version>=210021320){var o=e.readCompressedInt();a=1===o?new Ze:4===o?new ze:9===o&&e.version>=210042100?new He:new je}else a=new je;r=a.unstream(e);var p=e.getCurrentPosition(),h=e.getBytesRemain();h>32&&(h=32);var u=e.readString(h);(e.setCurrentPosition(p),-1!==u.indexOf('{\n"Version" : '))&&(new ze).skip(e);if(1===o)var f=r;else f=e.materials.add(r);return t={file:"",id:f},s&&e.materials.addMultiRefIndexWithName(n,f,e.name),t},Jt.prototype.childClone=function(){var e=new Array;for(var r in this.children)e[r]="object"==typeof this.children[r]?this.children[r].clone():this.children[r];return e};var Kt=function(r){Jt.call(this,r=r||{}),this.node=void 0!==r.node?r.node:new e.SGRep,this.namingContext=void 0!==r.namingContext?r.namingContext:0,this.repIndice=void 0!==r.repIndice?r.repIndice:-1,this.renderType=void 0!==r.renderType?r.renderType:0,this.curvedPipe=void 0!==r.curvedPipe?r.curvedPipe:-1};Kt.prototype=Object.create(Jt.prototype),Kt.prototype.constructor=Kt,Kt.prototype.clone=function(){return new Kt({curvedPipe:this.curvedPipe,renderType:this.renderType,repIndice:this.repIndice,node:this.node,namingContext:this.namingContext,materialInheritance:this.materialInheritance,currentMatId:this.currentMatId,material:this.material,repGAS:this.repGAS,repInheritanceMode:this.repInheritanceMode})};var $t=function(r){Jt.call(this,r=r||{}),this.node=void 0!==r.node?r.node:new e.SGBag,this.children=void 0!==r.children?r.children:[]};($t.prototype=Object.create(Jt.prototype)).constructor=$t,$t.prototype.clone=function(){return new $t({children:this.childClone(),node:this.node.clone(),materialInheritance:this.materialInheritance,currentMatId:this.currentMatId,material:this.material,repGAS:this.repGAS,repInheritanceMode:this.repInheritanceMode})};var ei=function(){qt.call(this),this.primitiveSets=[],this.vertexBuffer=null,this.primitiveAxis=[],this.axisSystems=[],this.refPlane=[],this.arrows=[],this.useTexture=!1,this.hasTangentsBinormals=!1,this.gpList=[],this.imageRep=[]};ei.prototype=Object.create(qt.prototype),ei.prototype.constructor=ei,ei.prototype.checkGP=function(e,r){for(var t=0;t<this.gpList.length;t++)this.mergeGP(this.gpList[t].gp,this.gpList[t].att);if(this.primitiveAxis.length){if(r&&r.isMonoPlane){var i=this.primitiveAxis[0].gp.primitive;this.primitiveAxis[0].att.getDisplayedColor();var s=this.primitiveAxis[0].att.getDisplayedColor();if(this.primitiveAxis[0].gp instanceof Lr){var n=this.getCompressedRep(e);this.refPlane.push({rep:n,origin:i.origin,xAxis:i.direction1,yAxis:i.direction2,noShow:this.primitiveAxis[0].att.isHidden(),color:s,lengthX:i.length,lengthY:i.length,mode:i.mode,zoomable:r.mode===oe,type:"CAT3DCustomRep"}),this.primitiveAxis=[]}}for(t=0;t<this.primitiveAxis.length;t++){if(this.primitiveAxis[t].gp instanceof Dr||this.primitiveAxis[t].gp instanceof Ft){this.primitiveAxis[t].gp.noRender=!1;var a=this.primitiveAxis[t].gp.vertexBuffer;a&&(this.useTexture=!!a.hasTextures&&a.hasTextures,this.hasTangentsBinormals=!!a.hasTangentsBinormals&&a.hasTangentsBinormals),this.mergeGP(this.primitiveAxis[t].gp,this.primitiveAxis[t].att)}if(this.primitiveAxis[t].gp instanceof kr){n=this.getCompressedRep(e),i=this.primitiveAxis[t].gp.primitive,s=this.primitiveAxis[t].att.getDisplayedColor();this.arrows.push({infiniteFace:3==e.getSemanticType(),rep:n,origin:i.origin,direction:i.direction,noShow:this.primitiveAxis[t].att.isHidden(),color:s,length:i.length,type:"CAT3DCustomRep"})}}}},ei.prototype.addImage=function(e,t,i,s){var n=new Wi,a=i.getCurrentMatrix();if(n.rep.repInheritanceMode=s.repInheritanceMode,n.rep.repGAS=s.repGAS,n.rep.materialInheritance=s.materialInheritance,n.rep.repInheritanceMode=s.repInheritanceMode,n.rep.node.noShow=s.node.noShow,n.vertexBuffer=new Qe,n.gp=e,e&&e.primitive){if(void 0!==e.zoomQuality&&0===e.zoomQuality&&i.setFixMode(!0),e.point){var o,p=(new r.Matrix4).setPosition({x:e.point[0],y:e.point[1],z:e.point[2]});o=a?(new r.Matrix4).multiplyMatrices(a,p):p,i.pushStaticMode(o),i.currentMatrix.push(new r.Matrix4)}e.primitive.material&&i.pushMatId(e.primitive.material,1,0,n.rep);var h=n.build(i);n.resolvedInheritance(i,h),h.rep=n.getCompressedRep(i),i.popStaticMode(),e.point&&(i.currentMatrix.pop(),i.popStaticMode()),e.primitive.material&&i.popMatId(),i.setFixMode(!1)}return n.rep},ei.prototype.addGP=function(e,r,t,i){if(!e.toSkip)if(e.noRender){if(e.imageGP)return void this.imageRep.push(this.addImage(e,r,t,this.rep));if(this.primitiveAxis.push({gp:e,att:r}),2==this.rep.namingContext&&7==this.primitiveAxis.length&&this.primitiveAxis[0].gp instanceof Dr&&this.primitiveAxis[1].gp instanceof kr&&this.primitiveAxis[2].gp instanceof kr&&this.primitiveAxis[3].gp instanceof kr&&this.primitiveAxis[4].gp instanceof Lr&&this.primitiveAxis[5].gp instanceof Lr&&this.primitiveAxis[6].gp instanceof Lr){var s=this.primitiveAxis[0].att.getDisplayedColor(),n=[(o=this.primitiveAxis[0].gp.vertexBuffer.posBuffer)[(p=this.primitiveAxis[0].gp.primitive.indices)[0]],o[p[0]+1],o[p[0]+2]],a=this.getCompressedRep(t);this.axisSystems.push({rep:a,origin:n,xAxis:this.primitiveAxis[1].gp.primitive.direction,yAxis:this.primitiveAxis[2].gp.primitive.direction,zAxis:this.primitiveAxis[3].gp.primitive.direction,refPlanes:[this.primitiveAxis[4].gp.primitive,this.primitiveAxis[5].gp.primitive,this.primitiveAxis[6].gp.primitive],color:s,zoomable:!1}),this.primitiveAxis=[]}if(2==this.rep.namingContext&&7==this.primitiveAxis.length&&this.primitiveAxis[0].gp instanceof Dr&&this.primitiveAxis[1].gp instanceof zr&&this.primitiveAxis[2].gp instanceof zr&&this.primitiveAxis[3].gp instanceof zr&&this.primitiveAxis[4].gp instanceof Ft&&this.primitiveAxis[5].gp instanceof Ft&&this.primitiveAxis[6].gp instanceof Ft){var o,p;s=this.primitiveAxis[0].att.getDisplayedColor(),n=[(o=this.primitiveAxis[0].gp.vertexBuffer.posBuffer)[(p=this.primitiveAxis[0].gp.primitive.indices)[0]],o[p[0]+1],o[p[0]+2]],a=this.getCompressedRep(t);this.axisSystems.push({rep:a,origin:n,xAxis:this.primitiveAxis[1].gp.primitive.direction,yAxis:this.primitiveAxis[2].gp.primitive.direction,zAxis:this.primitiveAxis[3].gp.primitive.direction,refPlanes:[this.primitiveAxis[4].gp.vertexBuffer.posBuffer,this.primitiveAxis[5].gp.vertexBuffer.posBuffer,this.primitiveAxis[6].gp.vertexBuffer.posBuffer],color:s,zoomable:!0,length:i.axisLength}),this.primitiveAxis=[]}}else{var h=e.vertexBuffer;h&&(this.useTexture=!!h.hasTextures&&h.hasTextures,this.hasTangentsBinormals=!!h.hasTangentsBinormals&&h.hasTangentsBinormals),this.gpList.push({gp:e,att:r})}},ei.prototype.mergeGP=function(e,r){var t=e.primitive,i=void 0;2==this.rep.namingContext&&e instanceof Dr&&(i="FREE_POINT");for(var s=this.primitiveSets.length,n=0;n<s;n++){var a=this.primitiveSets[n];if(a.connectivity==t.connectivity&&a.gas.isEqual(r)&&(null==a.material&&null==t.material||a.material.id==t.material.id&&a.material.file==t.material.file)&&(void 0===i||a.geomType===i)){a.set.push(t),a.nbIndices+=t.indices.length;break}}if(n==this.primitiveSets.length){var o={};o.connectivity=t.connectivity,o.gas=r,o.material=t.material,o.nbIndices=t.indices.length,o.more_indices=0,o.set=[],i&&(o.geomType=i),o.set.push(t),this.primitiveSets.push(o)}null==this.vertexBuffer&&(this.vertexBuffer=new Qe,this.vertexBuffer.hasTextures=this.useTexture,this.vertexBuffer.hasUVs=!1,this.vertexBuffer.hasTangentsBinormals=this.hasTangentsBinormals);for(var p=e.vertexBuffer,h=t.indices,u=this.vertexBuffer.posBuffer.length/3,f=0;f<h.length;f++)h[f]=h[f]+u;for(f=0;f<p.posBuffer.length;f++)this.vertexBuffer.posBuffer.push(p.posBuffer[f]),p.normalBuffer.length?this.vertexBuffer.normalBuffer.push(p.normalBuffer[f]):this.vertexBuffer.normalBuffer.push(0),this.useTexture&&(p.textureBuffer.length?this.vertexBuffer.textureBuffer.push(p.textureBuffer[f]):this.vertexBuffer.textureBuffer.push(0)),this.hasTangentsBinormals&&(p.tangentsBuffer.length?this.vertexBuffer.tangentsBuffer.push(p.tangentsBuffer[f]):this.vertexBuffer.tangentsBuffer.push(0),p.binormalsBuffer.length?this.vertexBuffer.binormalsBuffer.push(p.binormalsBuffer[f]):this.vertexBuffer.binormalsBuffer.push(0))},ei.prototype.build=function(e){if(this.axisSystems.length>0)return{axis:this.axisSystems[0]};if(0==this.primitiveSets.length)return this.arrows&&this.arrows.length>0?{arrows:this.arrows}:this.refPlane&&this.refPlane.length>0?{refPlanes:this.refPlane}:null;var r=this.buildRep(this.vertexBuffer,this.primitiveSets,e);return this.refPlane.length>0&&(r.refPlanes=this.refPlane),this.arrows&&this.arrows.length>0&&(r.arrows=this.arrows),r};var ri=function(){qt.call(this),this.vertexBuffer=null,this.nbLODFaces=0,this.lods=[],this.lodsAttributes=[],this.sag=0,this.sags=[],this.nbSets=0,this.sets=[],this.posInNextStreamer=0};ri.prototype=Object.create(qt.prototype),ri.prototype.constructor=ri,ri.prototype.getSet=function(e){for(var r=[],t=0;t<this.sets.length;t++)if(this.sets[t].geomType==e)for(var i=this.sets[t].primitives,s=0;s<i.length;s++)r.push(i[s]);return r},ri.prototype.unStreamFaces=function(e){if(e.readUnsignedChar()){if(e.version>=2100180)switch(e.readUnsignedChar()){case 2:this.sets[0]=new $e;break;case 3:this.sets[0]=new rr;break;default:this.sets[0]=null}else this.sets[0]=new $e;this.sets[0]&&this.sets[0].unstream(e)}},ri.prototype.build=function(r){var t,i,s,n,a,o=null!==this.vertexBuffer,p=(this.rep.repGAS.getType(),this.rep.repGAS.isSolid(),[]);if(0==this.nbSets)return null;for(t=0;t<this.nbSets;t++)for(this.sets[t].primitive?(n=1,a=[this.sets[t].primitive]):(n=this.sets[t].primitives.length,a=this.sets[t].primitives),i=0;i<n;i++)if(s=a[i]){if(s.posBuffer){this.vertexBuffer||(this.vertexBuffer=new Qe);for(var h=s.indices,u=this.vertexBuffer.posBuffer.length/3,f=0;f<h.length;f++)h[f]=h[f]+u;for(f=0;f<s.posBuffer.length;f++)this.vertexBuffer.posBuffer.push(s.posBuffer[f]),s.normalBuffer&&s.normalBuffer.length?this.vertexBuffer.normalBuffer.push(s.normalBuffer[f]):this.vertexBuffer.normalBuffer.push(0);this.vertexBuffer.hasTangentsBinormals&&(this.vertexBuffer.tangentsBuffer.push(0),this.vertexBuffer.binormalsBuffer.push(0)),this.vertexBuffer.hasTextures&&this.vertexBuffer.textureBuffer.push(0)}else if(!o)continue;s.indices.length,s.planarNormals&&s.planarNormals.length>0&&s.indices.length;var d=p.length;for(f=0;f<d;f++){var c=p[f];if(c.connectivity==s.connectivity&&c.geomType==this.sets[t].geomType&&c.gas.isEqual(s.gas)&&e.isEqualMaterial(c.material,s.material)){c.set.push(s),c.nbIndices+=s.indices.length;break}}if(f==p.length){var l={};l.connectivity=s.connectivity,l.gas=s.gas,l.geomType=this.sets[t].geomType,l.material=s.material,l.nbIndices=s.indices.length,l.more_indices=0,l.set=[],l.set.push(s),p.push(l)}}return this.vertexBuffer?this.buildRep(this.vertexBuffer,p,r):null};var ti=function(){ri.call(this)};(ti.prototype=Object.create(ri.prototype)).constructor=ti,ti.prototype.build=function(e){};var ii=function(){Yt.call(this),this.gp=[]};ii.prototype=Object.create(qt.prototype),ii.prototype.constructor=ii,ii.prototype.build=function(r){var t=new e.Mesh,i=r.getCurrentMatId(),s=r.getGAS(this.gp.primitive.connectivity);this.gp.primitive.symbol&&s.setSymbol(this.gp.primitive.symbol),s.setConnectivity(this.gp.primitive.connectivity);var n=new e.DrawingGroup(s,i,0,0,this.gp.primitive.indices.length),a=new e.MeshPrimitive(this.gp.node.cgmId,n,0,this.gp.primitive.indices.length);this.gp.decoration&&(a.decoration=this.gp.decoration),this.gp.boundingSphere&&(a.boundingSphere=this.gp.boundingSphere),n._primitives.push(a),t.drawingGroups.push(n),t.vertexIndexArray=this.gp.primitive.indices,t.vertexPositionArray=this.gp.vertexBuffer.posBuffer,t.vertexNormalArray=this.gp.vertexBuffer.normalBuffer,t.gas=s;var o=[0,0,0],p=[0,0,0],h=(o=[0,0,0],p=[0,0,0],t.vertexPositionArray.length);if(h>=3){o=[t.vertexPositionArray[0],t.vertexPositionArray[1],t.vertexPositionArray[2]],p=[t.vertexPositionArray[0],t.vertexPositionArray[1],t.vertexPositionArray[2]];for(var u=0;u<h;u+=3)t.vertexPositionArray[u]<o[0]&&(o[0]=t.vertexPositionArray[u]),t.vertexPositionArray[u+1]<o[1]&&(o[1]=t.vertexPositionArray[u+1]),t.vertexPositionArray[u+2]<o[2]&&(o[2]=t.vertexPositionArray[u+2]),t.vertexPositionArray[u]>p[0]&&(p[0]=t.vertexPositionArray[u]),t.vertexPositionArray[u+1]>p[1]&&(p[1]=t.vertexPositionArray[u+1]),t.vertexPositionArray[u+2]>p[2]&&(p[2]=t.vertexPositionArray[u+2])}return o[2]=-.01,p[2]=.01,t.AABB={min:o,max:p},t};var si=function(){qt.call(this),this.gp=[]};si.prototype=Object.create(qt.prototype),si.prototype.constructor=si,si.prototype.build=function(e){return null};var ni=function(){qt.call(this),this.gp=[]};ni.prototype=Object.create(qt.prototype),ni.prototype.constructor=ni,ni.prototype.build=function(e){return null};var ai=function(){qt.call(this),this.gp=[]};ai.prototype=Object.create(qt.prototype),ai.prototype.constructor=ai,ai.prototype.build=function(e){return null};var oi=function(){qt.call(this),this.gp=[]};oi.prototype=Object.create(qt.prototype),oi.prototype.constructor=oi,oi.prototype.build=function(e){return null};var pi=function(){qt.call(this),this.gp=[]};pi.prototype=Object.create(qt.prototype),pi.prototype.constructor=pi,pi.prototype.build=function(t){var i=new e.Mesh,s=t.getCurrentMatId(),n=t.getGAS();this.gp.primitive.symbol&&n.setSymbol(this.gp.primitive.symbol),n.setConnectivity(this.gp.primitive.connectivity);var a=0;3==t.getSemanticType()&&(a=r.GeomTypeEnum.AXIS_SYSTEM);var o=new e.DrawingGroup(n,s,0,0,this.gp.primitive.indices.length,[],null,a),p=new e.MeshPrimitive(this.gp.node.cgmId,o,0,this.gp.primitive.indices.length);this.gp.decoration&&(p.decoration=this.gp.decoration),this.gp.boundingSphere&&(p.boundingSphere=this.gp.boundingSphere),o._primitives.push(p),i.drawingGroups.push(o),i.vertexIndexArray=this.gp.primitive.indices,i.vertexPositionArray=this.gp.vertexBuffer.posBuffer,i.vertexNormalArray=this.gp.vertexBuffer.normalBuffer,i.gas=n;var h=[0,0,0],u=[0,0,0],f=(h=[0,0,0],u=[0,0,0],i.vertexPositionArray.length);if(f>=3){h=[i.vertexPositionArray[0],i.vertexPositionArray[1],i.vertexPositionArray[2]],u=[i.vertexPositionArray[0],i.vertexPositionArray[1],i.vertexPositionArray[2]];for(var d=0;d<f;d+=3)i.vertexPositionArray[d]<h[0]&&(h[0]=i.vertexPositionArray[d]),i.vertexPositionArray[d+1]<h[1]&&(h[1]=i.vertexPositionArray[d+1]),i.vertexPositionArray[d+2]<h[2]&&(h[2]=i.vertexPositionArray[d+2]),i.vertexPositionArray[d]>u[0]&&(u[0]=i.vertexPositionArray[d]),i.vertexPositionArray[d+1]>u[1]&&(u[1]=i.vertexPositionArray[d+1]),i.vertexPositionArray[d+2]>u[2]&&(u[2]=i.vertexPositionArray[d+2])}return h[2]=-.01,u[2]=.01,i.AABB={min:h,max:u},i};var hi=function(){qt.call(this),this.gp=[]};hi.prototype=Object.create(qt.prototype),hi.prototype.constructor=hi,hi.prototype.build=function(r){var t=new e.Mesh,i=r.getCurrentMatId(),s=r.getGAS(this.gp.primitive.connectivity);s.setConnectivity(this.gp.primitive.connectivity);var n=new e.DrawingGroup(s,i,this.gp.primitive.connectivity==e.ConnectivityTypeEnum.LINES?1:4,0,this.gp.primitive.indices.length),a=new e.MeshPrimitive(this.gp.node.cgmId,n,0,this.gp.primitive.indices.length);this.gp.decoration&&(a.decoration=this.gp.decoration),this.gp.boundingSphere&&(a.boundingSphere=this.gp.boundingSphere),n._primitives.push(a),t.drawingGroups.push(n),t.vertexIndexArray=this.gp.primitive.indices,t.vertexPositionArray=this.gp.vertexBuffer.posBuffer,t.vertexNormalArray=this.gp.vertexBuffer.normalBuffer,t.gas=s;var o=[0,0,0],p=[0,0,0],h=(o=[0,0,0],p=[0,0,0],t.vertexPositionArray.length);if(h>=3){o=[t.vertexPositionArray[0],t.vertexPositionArray[1],t.vertexPositionArray[2]],p=[t.vertexPositionArray[0],t.vertexPositionArray[1],t.vertexPositionArray[2]];for(var u=0;u<h;u+=3)t.vertexPositionArray[u]<o[0]&&(o[0]=t.vertexPositionArray[u]),t.vertexPositionArray[u+1]<o[1]&&(o[1]=t.vertexPositionArray[u+1]),t.vertexPositionArray[u+2]<o[2]&&(o[2]=t.vertexPositionArray[u+2]),t.vertexPositionArray[u]>p[0]&&(p[0]=t.vertexPositionArray[u]),t.vertexPositionArray[u+1]>p[1]&&(p[1]=t.vertexPositionArray[u+1]),t.vertexPositionArray[u+2]>p[2]&&(p[2]=t.vertexPositionArray[u+2])}return o[2]=-.01,p[2]=.01,t.AABB={min:o,max:p},t};var ui=function(){qt.call(this),this.gp=[]};(ui.prototype=Object.create(qt.prototype)).constructor=ui,ui.prototype.build=function(r){var t=new e.Mesh,i=r.getCurrentMatId(),s=r.getGAS(this.gp.primitive.connectivity);s.setConnectivity(this.gp.primitive.connectivity);var n=new e.DrawingGroup(s,i,this.gp.primitive.connectivity==e.ConnectivityTypeEnum.LINES?1:4,0,this.gp.primitive.indices.length),a=new e.MeshPrimitive(this.gp.node.cgmId,n,0,this.gp.primitive.indices.length);this.gp.decoration&&(a.decoration=this.gp.decoration),this.gp.boundingSphere&&(a.boundingSphere=this.gp.boundingSphere),n._primitives.push(a),t.drawingGroups.push(n),t.vertexIndexArray=this.gp.primitive.indices,t.vertexPositionArray=this.gp.vertexBuffer.posBuffer,t.vertexNormalArray=this.gp.vertexBuffer.normalBuffer,t.gas=s;var o=[0,0,0],p=[0,0,0],h=(o=[0,0,0],p=[0,0,0],t.vertexPositionArray.length);if(h>=3){o=[t.vertexPositionArray[0],t.vertexPositionArray[1],t.vertexPositionArray[2]],p=[t.vertexPositionArray[0],t.vertexPositionArray[1],t.vertexPositionArray[2]];for(var u=0;u<h;u+=3)t.vertexPositionArray[u]<o[0]&&(o[0]=t.vertexPositionArray[u]),t.vertexPositionArray[u+1]<o[1]&&(o[1]=t.vertexPositionArray[u+1]),t.vertexPositionArray[u+2]<o[2]&&(o[2]=t.vertexPositionArray[u+2]),t.vertexPositionArray[u]>p[0]&&(p[0]=t.vertexPositionArray[u]),t.vertexPositionArray[u+1]>p[1]&&(p[1]=t.vertexPositionArray[u+1]),t.vertexPositionArray[u+2]>p[2]&&(p[2]=t.vertexPositionArray[u+2])}return o[2]=-.01,p[2]=.01,t.AABB={min:o,max:p},t};var fi=function(){qt.call(this),this.refPlane=[]};fi.prototype=Object.create(qt.prototype),fi.prototype.constructor=fi,fi.prototype.build=function(e){if(this.refPlane)return{refPlanes:this.refPlane}};var di=function(){qt.call(this),this.refPlane=[]};(di.prototype=Object.create(qt.prototype)).constructor=di,di.prototype.build=function(e){if(this.refPlane)return{refPlanes:this.refPlane}};var ci=function(){qt.call(this),this.vertexBuffer=null,this.sets=[]};ci.prototype=Object.create(qt.prototype),ci.prototype.constructor=ci,ci.prototype.build=function(t){var i=new e.Mesh,n=t.getCurrentMatId(),a=t.getGAS(e.ConnectivityTypeEnum.TRIANGLES);a.setConnectivity(e.ConnectivityTypeEnum.TRIANGLES);var o=a.getDisplayedColor(),p=new r.Color;if(p.setRGB(o[0]/255,o[1]/255,o[2]/255),s)return{gas:{color:p,opacity:o[3]/255},matId:n,curveVertices:this.curveVertices,startNormal:this.startNormal,endNormal:this.endNormal,radius:this.radius,startSideVector:this.startSideVector};var h=new e.DrawingGroup(a,n,4,0,this.sets[0].indices.length),u=new e.MeshPrimitive(this.sets[0].node.cgmId,h,0,this.sets[0].indices.length);this.sets[0].decoration&&(u.decoration=this.sets[0].decoration),this.sets[0].boundingSphere&&(u.boundingSphere=this.sets[0].boundingSphere),h._primitives.push(u),i.drawingGroups.push(h),i.vertexIndexArray=this.sets[0].indices,i.vertexPositionArray=this.vertexBuffer.posBuffer,i.vertexNormalArray=this.vertexBuffer.normalBuffer,i.gas=a;var f=this.sets[0].boundingBoxCenter,d=this.sets[0].boundingBoxDim,c=[f[0]-d[0],f[1]-d[1],f[2]-d[2]],l=[f[0]+d[0],f[1]+d[1],f[2]+d[2]];return i.AABB={min:c,max:l},i};var li=function(){qt.call(this),this.sets=[],this.isGPUInstanciable=!0};li.prototype=Object.create(qt.prototype),li.prototype.constructor=li,li.prototype.build=function(t){var i=new e.Mesh,n=t.getCurrentMatId(),a=t.getGAS(e.ConnectivityTypeEnum.TRIANGLES);a.setConnectivity(e.ConnectivityTypeEnum.TRIANGLES);var o=a.getDisplayedColor(),p=new r.Color;if(p.setRGB(o[0]/255,o[1]/255,o[2]/255),this.isGPUInstanciable&&s)return{gas:{color:p,opacity:o[3]/255},matId:n,curveVertices:this.curveVertices,startNormal:this.startNormal,endNormal:this.endNormal,radius:this.radius,startSideVector:this.startSideVector};var h=new e.DrawingGroup(a,n,4,0,this.sets[0].indices.length),u=new e.MeshPrimitive(this.sets[0].node.cgmId,h,0,this.sets[0].indices.length);this.sets[0].decoration&&(u.decoration=this.sets[0].decoration),this.sets[0].boundingSphere&&(u.boundingSphere=this.sets[0].boundingSphere),h._primitives.push(u),i.drawingGroups.push(h),i.vertexIndexArray=this.sets[0].indices,i.vertexPositionArray=this.vertexBuffer.posBuffer,i.vertexNormalArray=this.vertexBuffer.normalBuffer,i.gas=a;var f=this.sets[0].boundingBoxCenter,d=this.sets[0].boundingBoxDim,c=[f[0]-d[0],f[1]-d[1],f[2]-d[2]],l=[f[0]+d[0],f[1]+d[1],f[2]+d[2]];return i.AABB={min:c,max:l},i};var vi=function(){qt.call(this),this.pointPrimimitivesSets=[],this.edgePrimitivesSets=[],this.vertexBuffer=null,this.indexBuffer=[],this.nbElEdge=0,this.nbElPoints=0,this.nbIndicesTotal=0};vi.prototype=Object.create(qt.prototype),vi.prototype.constructor=vi,vi.prototype.build=function(t){var i=[0,0,0],s=[0,0,0],n=t.getCurrentMatId();if(this.pointPrimimitivesSets.length||this.edgePrimitivesSets.length){var a=new e.Mesh,o=this.vertexBuffer.posBuffer.length;if(o>=3){i=[this.vertexBuffer.posBuffer[0],this.vertexBuffer.posBuffer[1],this.vertexBuffer.posBuffer[2]],s=[this.vertexBuffer.posBuffer[0],this.vertexBuffer.posBuffer[1],this.vertexBuffer.posBuffer[2]],a.vertexPositionArray=new Float32Array(o);for(var p=0;p<o;p+=3)a.vertexPositionArray[p]=this.vertexBuffer.posBuffer[p],a.vertexPositionArray[p+1]=this.vertexBuffer.posBuffer[p+1],a.vertexPositionArray[p+2]=this.vertexBuffer.posBuffer[p+2],a.vertexPositionArray[p]<i[0]&&(i[0]=a.vertexPositionArray[p]),a.vertexPositionArray[p+1]<i[1]&&(i[1]=a.vertexPositionArray[p+1]),a.vertexPositionArray[p+2]<i[2]&&(i[2]=a.vertexPositionArray[p+2]),a.vertexPositionArray[p]>s[0]&&(s[0]=a.vertexPositionArray[p]),a.vertexPositionArray[p+1]>s[1]&&(s[1]=a.vertexPositionArray[p+1]),a.vertexPositionArray[p+2]>s[2]&&(s[2]=a.vertexPositionArray[p+2])}a.AABB={min:i,max:s},a.vertexNormalArray=new Float32Array(o);for(p=0;p<o;p++)a.vertexNormalArray[p]=0;a.vertexIndexArray=new Uint32Array(this.nbIndicesTotal);var h=0;if(this.nbElEdge>0)for(p=0;p<this.edgePrimitivesSets.length;p++){var u=this.edgePrimitivesSets[p],f=new e.DrawingGroup(u.attr,n,1,h,u.nbIndices,void 0,void 0,r.GeomTypeEnum.WIRE_EDGE);a.drawingGroups.push(f);for(var d=u.set,c=0;c<d.length;c++){var l=d[c];f._primitives.push(l);for(var v=0;v<l.count;v++)a.vertexIndexArray[h++]=this.indexBuffer[l.start+v]}}if(this.nbElPoints)for(p=0;p<this.pointPrimimitivesSets.length;p++){u=this.pointPrimimitivesSets[p],f=new e.DrawingGroup(u.attr,n,0,h,u.nbIndices,void 0,void 0,r.GeomTypeEnum.BOUNDARY_POINT);a.drawingGroups.push(f);for(d=u.set,c=0;c<d.length;c++){(l=d[c]).attr=u.attr,f._primitives.push(l);for(v=0;v<l.count;v++)a.vertexIndexArray[h++]=this.indexBuffer[l.start+v]}}return a}return null};var mi=function(){};mi.prototype.unstream=function(e){return null};var yi=function(){};yi.prototype.unstream=function(e){var r=e.readCompressedInt();r<0&&(r=-r-2),e.skip(r-4)};var gi={LOD0:0,LOD1:1,LOD2:2,LOD3:3,FACES:4,LSG:5},xi=["BOUNDARY_EDGE","SHARP_EDGE","SMOOTH_EDGE","BOUNDARY_POINT","SHARP_POINT","SMOOTH_POINT","SURFACIC_POINT","FREE_POINT","WIRE_EDGE","INFINITE_FACE","FACE","EDGE","ISOPAR","UNKNOWN"],Bi=function(){this.indices=[],this.cgmId=-1,this.count=0,this.start=0,this.material=null,this.connectivity=e.ConnectivityTypeEnum.TRIANGLES,this.gas=null,this.decoration=0,this.boundingSphere=null};Bi.prototype.constructor=Bi;var Ai=function(){Bi.call(this),this.planarNormals=null};Ai.prototype=Object.create(Bi.prototype),Ai.prototype.constructor=Ai;var Ii=[],bi=[],Ci=[];Ai.prototype.unstream=function(e){var r=e.readUnsignedChar(),t=1&r,i=2&r,s=4&r,n=8&r,a=(e.isLightScenegraph(),0);t&&(a=e.readCompressedInt());var o=0;i&&(o=e.readCompressedInt());var p=0;s&&(p=e.readCompressedInt());e.readCompressedInt();n&&(this.planarNormals=new Array(3),e.readFloatArray(0,3,this.planarNormals));var h=a,u=0,f=0;if(e.version>=2100170||e.version>=1101910&&e.version<21e5){for(var d=0;d<o;++d){var c=e.readCompressedInt();Ii[d]=c,f+=c,h+=c-2}for(d=0;d<p;++d){var l=e.readCompressedInt();bi[d]=l,u+=l,h+=l-2}}else{for(d=0;d<o;++d){c=e.unpackc();Ii[d]=c,f+=c,h+=c-2}for(d=0;d<p;++d){l=e.unpackc();bi[d]=l,u+=l,h+=l-2}}if(!(h<=0)){this.indices=new Array(3*h);var v=3*a;e.unpackcArray(v,this.indices,0),e.unpackcArray(f+u,Ci,0);var m=0;for(d=0;d<o;++d){c=Ii[d];m+=2;for(var y=2;y<c;++y)y%2?(this.indices[v++]=Ci[m],this.indices[v++]=Ci[m-1],this.indices[v++]=Ci[m-2]):(this.indices[v++]=Ci[m-1],this.indices[v++]=Ci[m],this.indices[v++]=Ci[m-2]),m++}for(d=0;d<p;++d){var g=m;l=bi[d];m+=2;for(y=2;y<l;++y)this.indices[v++]=Ci[g],this.indices[v++]=Ci[m-1],this.indices[v++]=Ci[m],m++}}};var wi=function(){};wi.prototype.unstream=function(e){var r=e.getNumberOfVertices(),t=e.unpackc();e.setNumberOfVertices(t);var i=(new Ai).unstream(e);return e.setNumberOfVertices(r),i};var Si=function(){Bi.call(this),this.connectivity=e.ConnectivityTypeEnum.LINES};Si.prototype=Object.create(Bi.prototype),Si.prototype.constructor=Si;var Pi=[];Si.prototype.unstream=function(e){var r=e.readCompressedInt();if(r>0){e.unpackcArray(r,Pi,0);var t=1;if(r>1){this.indices=new Array(2*(r-1));this.indices[0]=Pi[0];for(var i=2;i<r;++i){var s=Pi[i-1];this.indices[t++]=s,this.indices[t++]=s}this.indices[t++]=Pi[r-1]}else this.indices=[]}e.version>=210021300&&e.readBoolean()},Si.prototype.skip=function(e){var r=e.readCompressedInt();r>0&&e.unpackcArray(r,Pi,0),e.version>=210021300&&e.readBoolean()};var Mi=function(){Bi.call(this),this.connectivity=e.ConnectivityTypeEnum.LINES,this.posBuffer=[]};Mi.prototype=Object.create(Bi.prototype),Mi.prototype.constructor=Mi,Mi.prototype.unstream=function(e){var r=e.readCompressedInt(),t=e.readCompressedInt(),i=0;if(r)switch(t){case 0:for(var s=0;s<r;++s)this.indices.push(i++),this.posBuffer.push(e.readFloat()),this.posBuffer.push(e.readFloat()),this.posBuffer.push(e.readFloat());break;case 1:if(r>0){this.posBuffer.push(e.readFloat()),this.posBuffer.push(e.readFloat()),this.posBuffer.push(e.readFloat());for(s=1;s<r;++s)this.indices.push(i++),this.indices.push(i),this.posBuffer.push(e.readFloat()),this.posBuffer.push(e.readFloat()),this.posBuffer.push(e.readFloat())}break;case 2:if(r>0){this.posBuffer.push(e.readFloat()),this.posBuffer.push(e.readFloat()),this.posBuffer.push(e.readFloat());for(s=1;s<r;++s)this.indices.push(i++),this.posBuffer.push(e.readFloat()),this.posBuffer.push(e.readFloat()),this.posBuffer.push(e.readFloat()),this.indices.push(i);this.indices.push(i),this.indices.push(0)}}},Mi.prototype.skip=function(e){var r=e.readCompressedInt();e.readCompressedInt();r&&e.skip(4*r*3)};var Ti=function(){Bi.call(this),this.connectivity=e.ConnectivityTypeEnum.POINTS,this.posBuffer=null,this.symbol=0};Ti.prototype=Object.create(Bi.prototype),Ti.prototype.constructor=Ti,Ti.prototype.skip=function(e){e.readCompressedInt();var r=e.readCompressedInt();e.skip(3*r*4)},Ti.prototype.unstream=function(r){this.symbol=r.readCompressedInt(),this.start=this.indices.length,this.connectivity=e.ConnectivityTypeEnum.POINTS;var t=r.readCompressedInt();this.posBuffer=new Array(3*t),r.readFloatArray(0,3*t,this.posBuffer);for(var i=0;i<t;++i)this.indices.push(i)};var Fi=function(){Bi.call(this),this.connectivity=e.ConnectivityTypeEnum.TRIANGLES,this.posBuffer=[]};Fi.prototype=Object.create(Bi.prototype),Fi.prototype.constructor=Fi,Fi.prototype.unstream=function(e){e.readFloat(),e.readFloat(),e.readFloat(),e.readFloat(),e.readFloat(),e.readFloat(),e.readFloat(),e.readFloat(),e.readFloat(),e.readFloat(),e.readUnsignedChar()},Fi.prototype.skip=function(e){e.skip(40),e.readUnsignedChar()};var Ui=function(e){Lt.call(this),this.rep=new $t(e)};Ui.prototype=Object.create(Lt.prototype),Ui.prototype.constructor=Ui,Ui.prototype.unstream=function(e){(this.rep.unstream(e),e.version>=1000800)&&(e.readUnsignedChar()&&(this.rep.node.matrix=e.readMatrix()));e.pushMatrix(this.rep.node.matrix);for(var r=e.readCompressedInt(),t=0;t<r;++t){if(1==e.readUnsignedChar()){var i=e.readCompressedInt();if(e.multiRefNode.isValidIndex(i)){if(o=e.multiRefNode.get(i)){if(!e.expandCGR&&!this.rep.node.noShow){var s=o.clone();this.addMesh(s,!1,e),this.rep.children.push(s);continue}this.rep.children.push(o)}}else{var n=e.readClassName(),a=e.getUnstreamer(n);if(e.error)return!1;var o=a.unstream(e,this.rep.node.noShow);if(e.error)return!1;if(e.multiRefNode.addAt(o,i),o)if(o.length)for(var p=0;p<o.length;p++)this.rep.children.push(o[p]);else this.rep.children.push(o)}}else{n=e.readClassName(),a=e.getUnstreamer(n);if(e.error)return!1;var h=a.unstream(e,this.rep.node.noShow);if(e.error)return!1;if(h)if(h.length)for(p=0;p<h.length;p++)this.rep.children.push(h[p]);else this.rep.children.push(h)}}e.version>=210021330&&(e.readUnsignedChar()&&(c?(this.rep.node.uuid_1=e.readUncompressedInt(),this.rep.node.uuid_2=e.readUncompressedInt(),this.rep.node.uuid_3=e.readUncompressedInt(),this.rep.node.uuid_4=e.readUncompressedInt()):e.skip(16)));return e.popMatId(),e.popGAS(),e.popMatrix(),this.rep},Ui.prototype.getCompressedRep=function(e){var r=e.sgRep,t=e.nbRep++;return r.push(this.rep.node.cgmId+1),r.push(this.rep.node.solid),r.push(this.rep.node.namingContext),o&&r.push(this.rep.node.sag),a&&(r.push(this.rep.boundingSphere.radius),r.push(this.rep.boundingSphere.center[0]),r.push(this.rep.boundingSphere.center[1]),r.push(this.rep.boundingSphere.center[2])),t},Ui.prototype.getCompressedRepMulti=function(e,r){var t=e.sgRep,i=e.nbRep++,s=3;a&&(s+=4),o&&(s+=1);for(var n=r*s,p=0;p<s;p++)t.push(t[n++]);return i},Ui.prototype.addMesh=function(e,r,t){var i=!r;if(e){if(e.node.noShow)return;if(i&&(t.pushGAS(e.repGAS,e.repInheritanceMode),t.pushMatrix(e.node.matrix),t.pushMatId(e.material,e.materialInheritance,e.layer,e)),e instanceof Kt||e instanceof Zt){var s=null;if(-1!==e.repIndice){if((p=t.getReps(e.repIndice,e.renderType)).noZ){var n=t.popGAS();n.inherited.setType(0),t.pushGAS(n.inherited,n.inh_mode)}if(s=p.clone(),2==h&&(t.idOrder++,s.vertexPositionArray))for(var a=2;a<s.vertexPositionArray.length;a+=3)s.vertexPositionArray[a]=t.idOrder;s.rep=this.getCompressedRepMulti(t,e.node);for(a=0;a<s.drawingGroups.length;++a){var o=s.drawingGroups;o[a].material&&o[a].material.primWithMaterials||(o[a].material=t.getCurrentMatId())}}if(e.axisSystems){var p,u=(p=t.axisSystems.get(e.axisSystems)).axis;(s={axis:{origin:[u.origin[0],u.origin[1],u.origin[2]],xAxis:[u.xAxis[0],u.xAxis[1],u.xAxis[2]],yAxis:[u.yAxis[0],u.yAxis[1],u.yAxis[2]],zAxis:[u.zAxis[0],u.zAxis[1],u.zAxis[2]],color:u.color},globalMatrix:t.getCurrentMatrix()}).rep=e.node}if(e.curvedPipe>-1){var f=t.curvedPipes.get(e.curvedPipe);(s={curveVertices:f.curveVertices,startNormal:f.startNormal,endNormal:f.endNormal,radius:f.radius,startSideVector:f.startSideVector,matId:f.matId,gas:f.gas,globalMatrix:t.getCurrentMatrix()}).rep=e.node}if(e.canonical){var d=t.canonical.get(e.canonical);(s={type:d.type,vectors:d.vectors,floats:d.floats,matId:d.matId,gas:d.gas,globalMatrix:t.getCurrentMatrix()}).rep=e.node}return null==s?(t.popMatId(),t.popMatrix(),t.popGAS(),null):(this.resolvedInheritance(t,s),void(i&&(t.popGAS(),t.popMatrix(),t.popMatId())))}}var c=e.children.length;for(a=0;a<c;a++)this.addMesh(e.children[a],!1,t);i&&(t.popGAS(),t.popMatrix(),t.popMatId())};var Ri=function(e){Ui.call(this),this.rep=new $t(e)};Ri.prototype=Object.create(Ui.prototype),Ri.prototype.constructor=Ri,Ri.prototype.unstream=function(e){var r=e.getAllReps();if(e.initReps(),Ui.prototype.unstream.call(this,e),e.version<210021340)e.readFloat();else e.readFloat(),e.readFloat();if(1==e.readUnsignedChar())e.readFloat(),e.readFloat(),e.readFloat();return e.setReps(r),this.rep};var Ni=function(e){Ui.call(this),this.rep=new $t(e)};Ni.prototype=Object.create(Ui.prototype),Ni.prototype.constructor=Oi,Ni.prototype.unstream=function(e){Ui.prototype.unstream.call(this,e);var r=e.readCompressedInt();if(r>0){var t=e.getAllReps();e.initReps();for(var i=0;i<r;i++){e.readFloat();var s=e.readClassName(),n=e.getUnstreamer(s).unstream(e,this.rep.node.noShow);if(e.error)return!1;n&&this.rep.children.push(n)}e.setReps(t)}return this.rep};var Gi=function(e){};Gi.prototype=Object.create(Ui.prototype),Gi.prototype.constructor=Oi,Gi.prototype.unstream=function(e){var r=new di;if(r.rep.unstream(e),e.readBoolean()){var t=new _r;t.unstream(e)}var i=e.getGAS(null),s=i.getDisplayedColor(),n=t.primitive;return r.refPlane.push({rep:r.rep.node,origin:n.origin,xAxis:n.direction1,yAxis:n.direction2,label:n.label,noShow:i.isHidden(),refPlaneData:n.refPlaneData,color:s,lengthX:n.lengthX,lengthY:n.lengthY,mode:n.mode,zoomable:n.mode===oe,type:"CAT3DReferencePlaneRep"}),r.addMesh(e),null};var Oi=function(e){Ui.call(this),this.rep=new $t(e)};Oi.prototype=Object.create(Ui.prototype),Oi.prototype.constructor=Oi,Oi.prototype.unstream=function(e){this.rep.unstream(e);var r=e.getLightDataStreaming();e.setLightDataStreaming(!1);var t=e.readCompressedInt();if(t>0){var s=e.readClassName(),n=e.getUnstreamer(s).unstream(e,this.rep.node.noShow);if(e.error)return!1;n&&this.rep.children.push(n);e.readFloat()}if(t>1){var a=e.getAllReps();for(e.initReps(),i=1;i<t;i++){s=e.readClassName(),n=e.getUnstreamer(s).unstream(e,this.rep.node.noShow);if(e.error)return!1;n&&this.rep.children.push(n);e.readFloat()}e.setReps(a)}return e.popMatId(),e.popGAS(),e.popMatrix(),e.setLightDataStreaming(r),this.rep};var Ei=function(e){this.rep=new $t(e)};Ei.prototype=Object.create(Ui.prototype),Ei.prototype.constructor=Ei,Ei.prototype.readStaticMode=function(e){for(var t=e.readCompressedInt(),i=0;i<t;++i){if(e.readUnsignedChar()){var s=e.readCompressedInt();if(!e.fakeMultiRep.isValidIndex(s)||!e.multiRefNode.isValidIndex(s))if(e.fakeMultiRep.addAt(!0,s),112==(n=e.readClassName()))e.getUnstreamer(n).unstream(e,!0);else(new yi).unstream(e)}else{var n;if(112==(n=e.readClassName()))e.getUnstreamer(n).unstream(e,!0);else(new yi).unstream(e)}}var a=e.readCompressedInt();if(e.readFloatArray(0,3,[]),1==a&&(e.pushStaticMode(e.popMatrix()),e.currentMatrix.push(new r.Matrix4)),e.version>=1101500)e.readCompressedInt(),e.readCompressedInt(),e.readCompressedInt()},Ei.prototype.unstream=function(e){(this.rep.unstream(e),e.version>=1000800)&&(e.readUnsignedChar()&&(this.rep.node.matrix=e.readMatrix()));e.pushMatrix(this.rep.node.matrix);var r=e.getCurrentPosition();this.readStaticMode(e,[]),e.setCurrentPosition(r);for(var t=e.readCompressedInt(),i=0;i<t;++i){if(e.readUnsignedChar()){var s=e.readCompressedInt();if(e.multiRefNode.isValidIndex(s)){if(o=e.multiRefNode.get(s)){if(!e.expandCGR){var n=o.clone();this.addMesh(n,!1,e)}this.rep.children.push(o)}}else{var a=e.readClassName(),o=e.getUnstreamer(a).unstream(e);e.multiRefNode.addAt(o,s),o&&this.rep.children.push(o)}}else{a=e.readClassName();var p=e.getUnstreamer(a).unstream(e);p&&this.rep.children.push(p)}}e.popMatId(),e.popGAS(),e.popMatrix();var h=e.readCompressedInt();if(e.readFloatArray(0,3,[]),h&&e.popStaticMode(),e.version>=1101500)e.readCompressedInt(),e.readCompressedInt(),e.readCompressedInt();return this.rep};var Vi=function(e){this.rep=new Qt(e)};Vi.prototype=Object.create(Ui.prototype),Vi.prototype.constructor=Vi,Vi.prototype.unstream=function(e,r){(this.rep.unstream(e),e.version>=1000800)&&(e.readUnsignedChar()&&(this.rep.node.matrix=e.read2DMatrix()));e.pushMatrix(this.rep.node.matrix);for(var t=e.readCompressedInt(),i=0;i<t;++i){if(1==e.readUnsignedChar()){var s=e.readCompressedInt();if(e.multiRefNode.isValidIndex(s)){if(r)continue;if(o=e.multiRefNode.get(s)){if(!e.expandCGR){var n=o.clone();this.addMesh(n,!1,e)}this.rep.children.push(o)}}else{var a=e.readClassName();if(r){if(e.fakeMultiRep.isValidIndex(s))continue;if(112==a){e.getUnstreamer(a).unstream(e,!0),e.fakeMultiRep.addAt(!0,s);continue}(new yi).unstream(e);continue}var o=e.getUnstreamer(a).unstream(e);e.multiRefNode.addAt(o,s),o&&this.rep.children.push(o)}}else{a=e.readClassName();if(r){if(112==a){e.getUnstreamer(a).unstream(e,!0);continue}(new yi).unstream(e);continue}var p=e.getUnstreamer(a).unstream(e);p&&this.rep.children.push(p)}}return e.popMatId(),e.popGAS(),e.popMatrix(),this.rep};var Di=function(){Yt.call(this),this.gp=[]};Di.prototype=Object.create(Yt.prototype),Di.prototype.constructor=Di,Di.prototype.build=function(r){var t=new e.Mesh,i=r.getCurrentMatId(),s=r.getGAS(this.gp.primitive.connectivity);s.setBasic(),s.setConnectivity(this.gp.primitive.connectivity);var n=new e.DrawingGroup(s,i,this.gp.primitive.connectivity==e.ConnectivityTypeEnum.LINES?1:4,0,this.gp.primitive.indices.length),a=new e.MeshPrimitive(this.gp.node.cgmId,n,0,this.gp.primitive.indices.length);this.gp.decoration&&(a.decoration=this.gp.decoration),this.gp.boundingSphere&&(a.boundingSphere=this.gp.boundingSphere),n._primitives.push(a),t.drawingGroups.push(n),t.vertexIndexArray=this.gp.primitive.indices,t.vertexPositionArray=this.gp.vertexBuffer.posBuffer,t.vertexNormalArray=this.gp.vertexBuffer.normalBuffer,t.gas=s;var o=[0,0,0],p=[0,0,0],h=(o=[0,0,0],p=[0,0,0],t.vertexPositionArray.length);if(h>=3){o=[t.vertexPositionArray[0],t.vertexPositionArray[1],t.vertexPositionArray[2]],p=[t.vertexPositionArray[0],t.vertexPositionArray[1],t.vertexPositionArray[2]];for(var u=0;u<h;u+=3)t.vertexPositionArray[u]<o[0]&&(o[0]=t.vertexPositionArray[u]),t.vertexPositionArray[u+1]<o[1]&&(o[1]=t.vertexPositionArray[u+1]),t.vertexPositionArray[u+2]<o[2]&&(o[2]=t.vertexPositionArray[u+2]),t.vertexPositionArray[u]>p[0]&&(p[0]=t.vertexPositionArray[u]),t.vertexPositionArray[u+1]>p[1]&&(p[1]=t.vertexPositionArray[u+1]),t.vertexPositionArray[u+2]>p[2]&&(p[2]=t.vertexPositionArray[u+2])}return o[2]=-.01,p[2]=.01,t.AABB={min:o,max:p},t};var ki=function(){Yt.call(this),this.gp=[]};ki.prototype=Object.create(Yt.prototype),ki.prototype.constructor=ki,ki.prototype.build=function(r){var t=new e.Mesh,i=r.getCurrentMatId(),s=r.getGAS(this.gp.primitive.connectivity);s.setConnectivity(this.gp.primitive.connectivity);var n=new e.DrawingGroup(s,i,this.gp.primitive.connectivity==e.ConnectivityTypeEnum.LINES?1:4,0,this.gp.primitive.indices.length),a=new e.MeshPrimitive(this.gp.node.cgmId,n,0,this.gp.primitive.indices.length);this.gp.decoration&&(a.decoration=this.gp.decoration),this.gp.boundingSphere&&(a.boundingSphere=this.gp.boundingSphere),n._primitives.push(a),t.drawingGroups.push(n),t.vertexIndexArray=this.gp.primitive.indices,t.vertexPositionArray=this.gp.vertexBuffer.posBuffer,t.vertexNormalArray=this.gp.vertexBuffer.normalBuffer,t.gas=s;var o=[0,0,0],p=[0,0,0],h=(o=[0,0,0],p=[0,0,0],t.vertexPositionArray.length);if(h>=3){o=[t.vertexPositionArray[0],t.vertexPositionArray[1],t.vertexPositionArray[2]],p=[t.vertexPositionArray[0],t.vertexPositionArray[1],t.vertexPositionArray[2]];for(var u=0;u<h;u+=3)t.vertexPositionArray[u]<o[0]&&(o[0]=t.vertexPositionArray[u]),t.vertexPositionArray[u+1]<o[1]&&(o[1]=t.vertexPositionArray[u+1]),t.vertexPositionArray[u+2]<o[2]&&(o[2]=t.vertexPositionArray[u+2]),t.vertexPositionArray[u]>p[0]&&(p[0]=t.vertexPositionArray[u]),t.vertexPositionArray[u+1]>p[1]&&(p[1]=t.vertexPositionArray[u+1]),t.vertexPositionArray[u+2]>p[2]&&(p[2]=t.vertexPositionArray[u+2])}return o[2]=-.01,p[2]=.01,t.AABB={min:o,max:p},t};var Li=function(){Yt.call(this),this.gp=[]};Li.prototype=Object.create(Yt.prototype),Li.prototype.constructor=Li,Li.prototype.build=function(r){var t=new e.Mesh,i=r.getCurrentMatId(),s=r.getGAS(this.gp.primitive.connectivity);s.setBasic(),s.setConnectivity(this.gp.primitive.connectivity);var n=new e.DrawingGroup(s,i,this.gp.primitive.connectivity==e.ConnectivityTypeEnum.LINES?1:4,0,this.gp.primitive.indices.length),a=new e.MeshPrimitive(this.gp.node.cgmId,n,0,this.gp.primitive.indices.length);this.gp.decoration&&(a.decoration=this.gp.decoration),this.gp.boundingSphere&&(a.boundingSphere=this.gp.boundingSphere),n._primitives.push(a),t.drawingGroups.push(n),t.vertexIndexArray=this.gp.primitive.indices,t.vertexPositionArray=this.gp.vertexBuffer.posBuffer,t.vertexNormalArray=this.gp.vertexBuffer.normalBuffer,t.gas=s;var o=[0,0,0],p=[0,0,0],h=(o=[0,0,0],p=[0,0,0],t.vertexPositionArray.length);if(h>=3){o=[t.vertexPositionArray[0],t.vertexPositionArray[1],t.vertexPositionArray[2]],p=[t.vertexPositionArray[0],t.vertexPositionArray[1],t.vertexPositionArray[2]];for(var u=0;u<h;u+=3)t.vertexPositionArray[u]<o[0]&&(o[0]=t.vertexPositionArray[u]),t.vertexPositionArray[u+1]<o[1]&&(o[1]=t.vertexPositionArray[u+1]),t.vertexPositionArray[u+2]<o[2]&&(o[2]=t.vertexPositionArray[u+2]),t.vertexPositionArray[u]>p[0]&&(p[0]=t.vertexPositionArray[u]),t.vertexPositionArray[u+1]>p[1]&&(p[1]=t.vertexPositionArray[u+1]),t.vertexPositionArray[u+2]>p[2]&&(p[2]=t.vertexPositionArray[u+2])}return o[2]=-.01,p[2]=.01,t.AABB={min:o,max:p},t};var _i=function(){Yt.call(this),this.gp=null,this.mat=!1};(_i.prototype=Object.create(Yt.prototype)).constructor=_i,_i.prototype.unstream=function(e){if(e.readBoolean()){var r=null;(e.version>=1101860&&e.version<21e5||e.version>=2100170?(r=new Ct).unstream(e):(r=new wt).unstream(e))&&(this.gp=r)}if(e.readBoolean()){var t=(new je).unstream(e),i={file:"",id:e.materials.add(t)};if(e.pushMatId(i,1,0,this.rep),this.mat=!0,t&&void 0!==t.textureId&&this.gp&&this.gp.primitive&&6==this.gp.primitive.count){var s=this.gp.vertexBuffer.textureBuffer;s.push(0),s.push(0),s.push(0),s.push(1),s.push(0),s.push(0),s.push(1),s.push(1),s.push(0),s.push(0),s.push(1),s.push(0)}}};var ji=function(){Yt.call(this),this.gp=[],this.mat=!1};ji.prototype=Object.create(Yt.prototype),ji.prototype.constructor=ji,ji.prototype.unstreamPerforatedPolygon=function(e){if(e.readBoolean()){var r=new _i;r.unstream(e),r.gp&&(this.gp.push(r.gp),this.mat=r.mat)}},ji.prototype.build=function(r){var t=new e.Mesh,i=r.getCurrentMatId();this.mat&&r.popMatId();var s=r.getGAS(this.gp[0].primitive.connectivity);s.isNoZ()&&s.setBasic(),s.setConnectivity(this.gp[0].primitive.connectivity);var n=new e.DrawingGroup(s,i,this.gp[0].primitive.connectivity==e.ConnectivityTypeEnum.LINES?1:4,0,this.gp[0].primitive.indices.length),a=new e.MeshPrimitive(this.gp[0].node.cgmId,n,0,this.gp[0].primitive.indices.length);this.gp[0].decoration&&(a.decoration=this.gp.decoration),this.gp[0].boundingSphere&&(a.boundingSphere=this.gp[0].boundingSphere),n._primitives.push(a),t.drawingGroups.push(n),t.vertexIndexArray=this.gp[0].primitive.indices,t.vertexPositionArray=this.gp[0].vertexBuffer.posBuffer,t.vertexNormalArray=this.gp[0].vertexBuffer.normalBuffer,t.vertexUvArray=this.gp[0].vertexBuffer.textureBuffer,t.gas=s;var o=[0,0,0],p=[0,0,0],h=(o=[0,0,0],p=[0,0,0],t.vertexPositionArray.length);if(h>=3){o=[t.vertexPositionArray[0],t.vertexPositionArray[1],t.vertexPositionArray[2]],p=[t.vertexPositionArray[0],t.vertexPositionArray[1],t.vertexPositionArray[2]];for(var u=0;u<h;u+=3)t.vertexPositionArray[u]<o[0]&&(o[0]=t.vertexPositionArray[u]),t.vertexPositionArray[u+1]<o[1]&&(o[1]=t.vertexPositionArray[u+1]),t.vertexPositionArray[u+2]<o[2]&&(o[2]=t.vertexPositionArray[u+2]),t.vertexPositionArray[u]>p[0]&&(p[0]=t.vertexPositionArray[u]),t.vertexPositionArray[u+1]>p[1]&&(p[1]=t.vertexPositionArray[u+1]),t.vertexPositionArray[u+2]>p[2]&&(p[2]=t.vertexPositionArray[u+2])}return o[2]=-.01,p[2]=.01,t.AABB={min:o,max:p},t};var zi=function(){Yt.call(this),this.gp=[]};zi.prototype=Object.create(Yt.prototype),zi.prototype.constructor=zi,zi.prototype.build=function(r){var t=new e.Mesh,i=r.getCurrentMatId(),s=r.getGAS(this.gp.primitive.connectivity);s.setConnectivity(this.gp.primitive.connectivity);var n=new e.DrawingGroup(s,i,this.gp.primitive.connectivity==e.ConnectivityTypeEnum.LINES?1:4,0,this.gp.primitive.indices.length),a=new e.MeshPrimitive(this.gp.node.cgmId,n,0,this.gp.primitive.indices.length);this.gp.decoration&&(a.decoration=this.gp.decoration),this.gp.boundingSphere&&(a.boundingSphere=this.gp.boundingSphere),n._primitives.push(a),t.drawingGroups.push(n),t.vertexIndexArray=this.gp.primitive.indices,t.vertexPositionArray=this.gp.vertexBuffer.posBuffer,t.vertexNormalArray=this.gp.vertexBuffer.normalBuffer,t.gas=s;var o=[0,0,0],p=[0,0,0],h=(o=[0,0,0],p=[0,0,0],t.vertexPositionArray.length);if(h>=3){o=[t.vertexPositionArray[0],t.vertexPositionArray[1],t.vertexPositionArray[2]],p=[t.vertexPositionArray[0],t.vertexPositionArray[1],t.vertexPositionArray[2]];for(var u=0;u<h;u+=3)t.vertexPositionArray[u]<o[0]&&(o[0]=t.vertexPositionArray[u]),t.vertexPositionArray[u+1]<o[1]&&(o[1]=t.vertexPositionArray[u+1]),t.vertexPositionArray[u+2]<o[2]&&(o[2]=t.vertexPositionArray[u+2]),t.vertexPositionArray[u]>p[0]&&(p[0]=t.vertexPositionArray[u]),t.vertexPositionArray[u+1]>p[1]&&(p[1]=t.vertexPositionArray[u+1]),t.vertexPositionArray[u+2]>p[2]&&(p[2]=t.vertexPositionArray[u+2])}return o[2]=-.01,p[2]=.01,t.AABB={min:o,max:p},t};var Wi=function(){qt.call(this),this.gp=[]};Wi.prototype=Object.create(qt.prototype),Wi.prototype.constructor=Wi,Wi.prototype.build=function(r){var t=new e.Mesh,i=r.getGAS(e.ConnectivityTypeEnum.TRIANGLES),s=r.getCurrentMatId();i.setConnectivity(0);var n=new e.DrawingGroup(i,s,4,0,this.gp.primitive.indices.length),a=new e.MeshPrimitive(this.gp.node.cgmId,n,0,this.gp.primitive.indices.length);this.gp.decoration&&(a.decoration=this.gp.decoration),this.gp.boundingSphere&&(a.boundingSphere=this.gp.boundingSphere),n._primitives.push(a),t.drawingGroups.push(n),t.vertexIndexArray=this.gp.primitive.indices,t.vertexPositionArray=this.gp.vertexBuffer.posBuffer,t.vertexNormalArray=this.gp.vertexBuffer.normalBuffer,t.vertexUvArray=this.gp.vertexBuffer.textureBuffer,t.gas=i;var o=[0,0,0],p=[0,0,0],h=(o=[0,0,0],p=[0,0,0],t.vertexPositionArray.length);if(h>=3){o=[t.vertexPositionArray[0],t.vertexPositionArray[1],t.vertexPositionArray[2]],p=[t.vertexPositionArray[0],t.vertexPositionArray[1],t.vertexPositionArray[2]];for(var u=0;u<h;u+=3)t.vertexPositionArray[u]<o[0]&&(o[0]=t.vertexPositionArray[u]),t.vertexPositionArray[u+1]<o[1]&&(o[1]=t.vertexPositionArray[u+1]),t.vertexPositionArray[u+2]<o[2]&&(o[2]=t.vertexPositionArray[u+2]),t.vertexPositionArray[u]>p[0]&&(p[0]=t.vertexPositionArray[u]),t.vertexPositionArray[u+1]>p[1]&&(p[1]=t.vertexPositionArray[u+1]),t.vertexPositionArray[u+2]>p[2]&&(p[2]=t.vertexPositionArray[u+2])}return o[2]=-.01,p[2]=.01,t.AABB={min:o,max:p},t};var Hi=function(){Yt.call(this),this.gp=[]};Hi.prototype=Object.create(Yt.prototype),Hi.prototype.constructor=Hi,Hi.prototype.build=function(r){var t=new e.Mesh,i=r.getGAS(this.gp.primitive.connectivity);i.setConnectivity(this.gp.primitive.connectivity);var s=r.getCurrentMatId(),n=new e.DrawingGroup(i,s,4,0,this.gp.primitive.indices.length),a=new e.MeshPrimitive(this.gp.node.cgmId,n,0,this.gp.primitive.indices.length);this.gp.decoration&&(a.decoration=this.gp.decoration),this.gp.boundingSphere&&(a.boundingSphere=this.gp.boundingSphere),n._primitives.push(a),t.drawingGroups.push(n),t.vertexIndexArray=this.gp.primitive.indices,t.vertexPositionArray=this.gp.vertexBuffer.posBuffer,t.vertexNormalArray=this.gp.vertexBuffer.normalBuffer,t.vertexUvArray=this.gp.vertexBuffer.textureBuffer,t.gas=i;var o=[0,0,0],p=[0,0,0],h=(o=[0,0,0],p=[0,0,0],t.vertexPositionArray.length);if(h>=3){o=[t.vertexPositionArray[0],t.vertexPositionArray[1],t.vertexPositionArray[2]],p=[t.vertexPositionArray[0],t.vertexPositionArray[1],t.vertexPositionArray[2]];for(var u=0;u<h;u+=3)t.vertexPositionArray[u]<o[0]&&(o[0]=t.vertexPositionArray[u]),t.vertexPositionArray[u+1]<o[1]&&(o[1]=t.vertexPositionArray[u+1]),t.vertexPositionArray[u+2]<o[2]&&(o[2]=t.vertexPositionArray[u+2]),t.vertexPositionArray[u]>p[0]&&(p[0]=t.vertexPositionArray[u]),t.vertexPositionArray[u+1]>p[1]&&(p[1]=t.vertexPositionArray[u+1]),t.vertexPositionArray[u+2]>p[2]&&(p[2]=t.vertexPositionArray[u+2])}return o[2]=-.01,p[2]=.01,t.AABB={min:o,max:p},t};var qi=function(){Yt.call(this),this.gp=[]};qi.prototype=Object.create(Yt.prototype),qi.prototype.constructor=qi,qi.prototype.build=function(r){var t=new e.Mesh,i=r.getCurrentMatId(),s=r.getGAS(this.gp.primitive.connectivity);s.setBasic(),s.setConnectivity(this.gp.primitive.connectivity);var n=new e.DrawingGroup(s,i,this.gp.primitive.connectivity==e.ConnectivityTypeEnum.LINES?1:4,0,this.gp.primitive.indices.length),a=new e.MeshPrimitive(this.gp.node.cgmId,n,0,this.gp.primitive.indices.length);this.gp.decoration&&(a.decoration=this.gp.decoration),this.gp.boundingSphere&&(a.boundingSphere=this.gp.boundingSphere),n._primitives.push(a),t.drawingGroups.push(n),t.vertexIndexArray=this.gp.primitive.indices,t.vertexPositionArray=this.gp.vertexBuffer.posBuffer,t.vertexNormalArray=this.gp.vertexBuffer.normalBuffer,t.gas=s;var o=[0,0,0],p=[0,0,0],h=(o=[0,0,0],p=[0,0,0],t.vertexPositionArray.length);if(h>=3){o=[t.vertexPositionArray[0],t.vertexPositionArray[1],t.vertexPositionArray[2]],p=[t.vertexPositionArray[0],t.vertexPositionArray[1],t.vertexPositionArray[2]];for(var u=0;u<h;u+=3)t.vertexPositionArray[u]<o[0]&&(o[0]=t.vertexPositionArray[u]),t.vertexPositionArray[u+1]<o[1]&&(o[1]=t.vertexPositionArray[u+1]),t.vertexPositionArray[u+2]<o[2]&&(o[2]=t.vertexPositionArray[u+2]),t.vertexPositionArray[u]>p[0]&&(p[0]=t.vertexPositionArray[u]),t.vertexPositionArray[u+1]>p[1]&&(p[1]=t.vertexPositionArray[u+1]),t.vertexPositionArray[u+2]>p[2]&&(p[2]=t.vertexPositionArray[u+2])}return o[2]=-.01,p[2]=.01,t.AABB={min:o,max:p},t};var Yi=function(){Yt.call(this),this.primitiveSets=[],this.vertexBuffer=null,this.imageRep=[]};Yi.prototype=Object.create(Yt.prototype),Yi.prototype.constructor=Yi,Yi.prototype.addGP=function(r,t,i){if(r.imageGP)this.imageRep.push(this.addImage(r,t,i,this.rep));else{null==this.vertexBuffer&&(this.vertexBuffer=new Qe);for(var s=this.vertexBuffer.posBuffer.length/3,n=r.vertexBuffer,a=0;a<n.posBuffer.length;a++)this.vertexBuffer.posBuffer.push(n.posBuffer[a]),n.normalBuffer.length?this.vertexBuffer.normalBuffer.push(n.normalBuffer[a]):this.vertexBuffer.normalBuffer.push(void 0);var o=[];if(r.primitives&&r.primitives.length?o=r.primitives:o.push(r.primitive),1==h)for(a=0;a<o.length;a++){var p=o[a];(d={}).connectivity=p.connectivity,d.gas=t,d.material=p.material,d.nbIndices=p.indices.length,d.more_indices=0,d.set=[],d.set.push(p),this.primitiveSets.push(d);for(var u=p.indices,f=0;f<u.length;f++)u[f]=u[f]+s}else for(a=0;a<o.length;a++){p=o[a];var d,c=this.primitiveSets.length;for(f=0;f<c;f++){var l=this.primitiveSets[f];if(l.connectivity==p.connectivity&&l.gas.isEqual(t)&&e.isEqualMaterial(l.material,p.material)){l.set.push(p),l.nbIndices+=p.indices.length;break}}if(f==this.primitiveSets.length)(d={}).connectivity=p.connectivity,d.gas=t,d.material=p.material,d.nbIndices=p.indices.length,d.more_indices=0,d.set=[],d.set.push(p),this.primitiveSets.push(d);for(u=p.indices,f=0;f<u.length;f++)u[f]=u[f]+s}}},Yi.prototype.addImage=function(e,t,i,s){var n=new Hi,a=i.getCurrentMatrix();if(n.rep.repInheritanceMode=s.repInheritanceMode,n.rep.repGAS=s.repGAS,n.rep.materialInheritance=s.materialInheritance,n.rep.repInheritanceMode=s.repInheritanceMode,n.rep.node.noShow=s.node.noShow,n.vertexBuffer=new Qe,n.gp=e,e&&e.primitive){if(void 0!==e.zoomQuality&&0===e.zoomQuality&&i.setFixMode(!0),e.point){var o,p=(new r.Matrix4).setPosition({x:e.point[0],y:e.point[1],z:e.point[2]});o=a?(new r.Matrix4).multiplyMatrices(a,p):p,i.pushStaticMode(o),i.currentMatrix.push(new r.Matrix4)}e.primitive.material&&i.pushMatId(e.primitive.material,1,0,n.rep);var h=n.build(i);n.resolvedInheritance(i,h),h.rep=n.getCompressedRep(i),i.popStaticMode(),e.point&&(i.currentMatrix.pop(),i.popStaticMode()),e.primitive.material&&i.popMatId(),i.setFixMode(!1)}return n.rep},Yi.prototype.build=function(e){return 0==this.primitiveSets.length?null:this.buildRep(this.vertexBuffer,this.primitiveSets,e)};var Xi=function(){Ui.call(this)};Xi.prototype=Object.create(Ui.prototype),Xi.prototype.constructor=Xi,Xi.prototype.unstream=function(e){e.readCompressedInt();var r=Ui.prototype.unstream.call(this,e);e.readFloat();return r};var Zi=function(){Ui.call(this)};Zi.prototype=Object.create(Ui.prototype),Zi.prototype.constructor=Zi,Zi.prototype.unstream=function(e){var r=e.getCurrentPosition(),t=r+e.readCompressedInt();e.setCurrentPosition(t);var i=e.readUnsignedChar();e.setSemanticType(i),e.setCurrentPosition(r);e.readCompressedInt();var s=Ui.prototype.unstream.call(this,e);e.readUnsignedChar();return s};var Qi=function(){Vi.call(this)};Qi.prototype=Object.create(Vi.prototype),Qi.prototype.constructor=Qi,Qi.prototype.unstream=function(e){var r=e.readCompressedInt(),t=Vi.prototype.unstream.call(this,e);e.readCompressedInt();return r=e.readCompressedInt(),(r=Math.abs(r))>0&&e.skip(4*(2*r+1)),t};var Ji=function(){Ui.call(this)};Ji.prototype=Object.create(Ui.prototype),Ji.prototype.constructor=Ji,Ji.prototype.unstream=function(e){var r=e.getCurrentPosition()+e.readCompressedInt()+1,t=Ui.prototype.unstream.call(this,e);return e.setCurrentPosition(r),t};var Ki=function(){Ui.call(this)};Ki.prototype=Object.create(Ui.prototype),Ki.prototype.constructor=Ki,Ki.prototype.unstream=function(e){var r=Ui.prototype.unstream.call(this,e);e.readUnsignedChar();return r};var $i=function(){Ji.call(this)};$i.prototype=Object.create(Ji.prototype),$i.prototype.constructor=$i,$i.prototype.unstream=function(e){e.getCurrentPosition(),e.readCompressedInt();var r=Ji.prototype.unstream.call(this,e);return e.readFloat(),r};var es=function(){Ui.call(this)};es.prototype=Object.create(Ui.prototype),es.prototype.constructor=es,es.prototype.applyTextureMatrix=function(t,i,s){if(i.node instanceof e.SGBag)for(o=0;o<i.children.length;o++)this.applyTextureMatrix(t,i.children[o],s);else{var n=t.getReps(i.repIndice,i.renderType).vertexUvArray,a=n?n.length/3:0;if(a>0)for(var o=0,p=0,h=new r.Vector4,o=0;o<a;o++,p+=3)h.set(n[p],n[p+1],n[p+2],1),h.applyMatrix4(s),n[p]=h.x/h.w,n[p+1]=h.y/h.w,n[p+2]=h.z/h.w}},es.prototype.unstream=function(e,r){Ui.prototype.unstream.call(this,e,r);if(e.readBoolean()){var t=ts.prototype.unstream.call(this,e);void 0!==t.textureMatrix&&this.applyTextureMatrix(e,this.rep,t.textureMatrix)}return this.rep};var rs=function(e){Lt.call(this),this.rep=new Kt(e)};rs.prototype=Object.create(Lt.prototype),rs.prototype.constructor=rs,rs.prototype.convertConnectivity=function(r){switch(r){case 0:return e.ConnectivityTypeEnum.POINTS;case 1:return e.ConnectivityTypeEnum.LINES;case 2:return e.ConnectivityTypeEnum.LINE_STRIP;case 3:return e.ConnectivityTypeEnum.LINE_LOOP;case 4:return e.ConnectivityTypeEnum.TRIANGLES;case 5:return e.ConnectivityTypeEnum.TRIANGLE_STRIP;case 6:return e.ConnectivityTypeEnum.TRIANGLE_FAN;default:return e.ConnectivityTypeEnum.TRIANGLES}},rs.prototype.getByteSize=function(r){switch(r){case e.DataTypeEnum.CHAR:case e.DataTypeEnum.UCHAR:return 1;case e.DataTypeEnum.SHORT:case e.DataTypeEnum.USHORT:return 2;case e.DataTypeEnum.INT:case e.DataTypeEnum.UINT:case e.DataTypeEnum.FLOAT:return 4;case e.DataTypeEnum.DOUBLE:return 8;default:return 1}},rs.prototype.addSet=function(e){},rs.prototype.unstream=function(r){r.setNumberOfVertices(16777216);var t=r.readCompressedInt();if(t<=0)return null;var i=[],s=new e.PrimitiveGroup;s.fillAttr=new e.FillAttributes,s.lineAttr=new e.LineAttributes;for(var n=0;n<t;n++){var a=0;(d=new e.Buffer).indexBuffer=r.readBoolean(),a=r.readCompressedInt(),d.format=r.readUnsignedChar(),d.dimension=r.readUnsignedChar(),d.size=a*d.dimension;var o=r.readBoolean();switch(s.addBuffer(n,d),o){case Nt:d.data=new Float32Array(d.size),r.readPositionsArrayBuffer(a,d.data,0);break;case Gt:d.data=new Float32Array(d.size),r.readNormalsArrayBuffer(a,d.data,0);break;case Rt:switch(d.format){case e.DataTypeEnum.FLOAT:d.data=new Float32Array(d.size),r.readFloatArray(0,d.size,d.data);break;case e.DataTypeEnum.INT:d.data=new Int32Array(d.size),r.readUncompressedIntArray(d.size,d.data);break;case e.DataTypeEnum.UINT:d.data=new Uint32Array(d.size),r.readUncompressedIntArray(d.size,d.data);break;default:d.data=new Uint8Array(d.size),r.readBytes(d.size,d.data)}}}var p=r.readCompressedInt();if(p<=0&&t<=0)return this.rep.unstream(r),null;for(n=0;n<p;n++){var h=new e.Primitive;h.nbIndices=r.readCompressedInt(),h.connectivity=this.convertConnectivity(r.readUnsignedChar());for(var u=r.readCompressedInt(),f=0;f<u;f++){var d,c=new e.VertexComponent;if(c.component=r.readUnsignedChar(),c.cardinality=r.readUnsignedChar(),c.bufferId=r.readCompressedInt(),c.offset=r.readCompressedInt(),c.indices=null,null!==(d=s.getBufferFromId(c.bufferId))){var l=this.getByteSize(d.format);if(d.oldDimension?c.offset/=l*d.oldDimension:c.offset/=l*d.dimension,d.component=c.component,(d.component===e.VertexComponentEnum.TEX_COORD_0||d.component===e.VertexComponentEnum.TEX_COORD_1||d.component===e.VertexComponentEnum.TEX_COORD_2||d.component===e.VertexComponentEnum.TEX_COORD_3)&&d.dimension<3){a=d.size/d.dimension;for(var v=new Float32Array(3*a),m=0;m<a;m++)v[3*m]=d.data[d.dimension*m],d.dimension>1?v[3*m+1]=d.data[2*m+1]:v[3*m+1]=0,v[3*m+2]=0;d.data=v,d.size=3*a,d.oldDimension=d.dimension,d.dimension=3}c.nbValuesPerVertex=d.dimension,c.format=d.format}if(r.readBoolean()&&(c.indices=new e.IndexArray,c.indices.bufferId=r.readCompressedInt(),c.indices.offset=r.readCompressedInt(),null!==(d=s.getBufferFromId(c.indices.bufferId)))){l=this.getByteSize(d.format);c.indices.offset/=l,c.indices.format=d.format}h.addVertexComponent(c)}var y=null;if(r.readBoolean()){var g=ts.prototype.unstream.call(this,r);g.gas&&(y=g.gas)}var x=!1;if(h)h._usedVertexColor()&&(x=!0);i.push({prim:h,gas:y,poinSize:g.size,symbol:g.symbol,usedVertexColor:x})}this.rep.unstream(r);var B=!1;for(n=0;n<i.length;n++){if(i[n].gas){r.pushGAS(i[n].gas,0);var A;(A=r.getGAS(i[n].prim.connectivity)).getDisplayedColor(),A.isTransparent(),A.isSolid(),A.getType(),A.getLineThickness();A.setConnectivity(i[n].prim.connectivity),A.isNoZ()&&(B=!0),i[n].prim.attr=A,r.popGAS()}else(A=r.getGAS(i[n].prim.connectivity)).setConnectivity(i[n].prim.connectivity),i[n].prim.attr=A;i[n].pointSize&&i[n].prim.attr.setLineThickness(i.pointSize),i[n].symbol&&i[n].prim.attr.setSymbol(i[n].symbol),i[n].usedVertexColor&&(i[n].prim.attr.setVertexColor(),i[n].prim.connectivity==e.ConnectivityTypeEnum.POINTS&&(i[n].prim.attr.setColor(8),i[n].symbol&&i[n].prim.attr.setSymbol(0),i[n].pointSize||i[n].prim.attr.setLineThickness(1))),s.addPrimitive(i[n].prim)}if(!B&&0==(A=r.getGAS(null)).getType()){var I=r.popGAS();I.inherited.setType(2),r.pushGAS(I.inherited,I.inh_mode)}s.material=r.getCurrentMatId();var b=e.convertToGeometry3js(s,void 0,void 0,void 0,void 0,!0);return b.rep=this.rep.node,this.resolvedInheritance(r,b),b.rep=this.getCompressedRep(r),r.popMatId(),r.popGAS(),this.rep};var ts=function(){};ts.prototype.constructor=ts,ts.prototype.getNbAttributes=function(e){for(var r=0;e;)1&e&&r++,e>>=1;return r},ts.prototype.getAttributeType=function(e,r){for(var t=1,i=0;i<r+1;i++){for(;!(1&e);)e>>=1,t<<=1;e>>=1,i!==r&&(t<<=1)}return t},ts.prototype.unstream=function(e){for(var t={},i=e.readCompressedInt(),s=e.getCurrentPosition(),n=e.readCompressedInt(),a=ts.prototype.getNbAttributes(i),o=0;o<a;o++){switch(ts.prototype.getAttributeType(i,o)){case Ot:t.gas=e.readGraphicAttributeSet();break;case Et:var p=[];if(e.version>=210021610){var h=e.readCompressedUInt(),u=e.readUnsignedChar(),f=[];e.readDoubles(f,u);var d=0;for(o=0,d=0;o<16;o++){switch((h&3<<2*o)>>>2*o){case 0:p.push(f[d++]);break;case 1:p.push(0);break;case 2:p.push(1);break;case 3:p.push(-1)}}}else p=new Float32Array(16),e.readFloatArray(0,16,p);var c=new r.Matrix4;c.set(p[0],p[4],p[8],p[12],p[1],p[5],p[9],p[13],p[2],p[6],p[10],p[14],p[3],p[7],p[11],p[15]),t.textureMatrix=c;break;case Vt:e.readCompressedInt();break;case Dt:t.symbol=e.readCompressedInt();break;case kt:t.size=e.readCompressedInt()}}return e.setCurrentPosition(s+n),t};var is=function(){return Bs?{sag:Bs.sag3D,sagMode:Bs.sagmode3D}:{sag:.2,sagMode:1}},ss=function(e){switch(e){case"Cuboid":case"Sphere":case"PartialSphere":case"Cone":return!0;case"Cylinder":case"PartialTorus":case"Torus":case"CurvedPipe":return!s;default:console.error("wrong type : "+e)}},ns=function(){qt.call(this)};ns.prototype=Object.create(qt.prototype),ns.prototype.constructor=ns,ns.prototype.unstream=function(e){return this.rep.unstream(e),this.infos={bottomCenter:[e.readFloat(),e.readFloat(),e.readFloat()],topCenter:[e.readFloat(),e.readFloat(),e.readFloat()],bottomRadius:e.readFloat(),topRadius:e.readFloat()},this.addMesh(e)?this.rep:null},ns.prototype.build=function(r){var t,i=r.getCurrentMatId(),s=r.getGAS(e.ConnectivityTypeEnum.TRIANGLES);t=r.isASMColor()?r.getGAS(null):s.clone();var n=this.infos;return!ss("Cone")?{gas:s,matId:i,canonicalType:pe,vectors:[n.bottomCenter[0],n.bottomCenter[1],n.bottomCenter[2],n.topCenter[0],n.topCenter[1],n.topCenter[2]],floats:[n.bottomRadius,n.topRadius]}:e._createCustomCylindricalMesh(n.bottomCenter,n.topCenter,n.bottomRadius,n.topRadius,s,i,is(),!0,r.decorations,t)};var as=function(){qt.call(this)};as.prototype=Object.create(qt.prototype),as.prototype.constructor=as,as.prototype.unstream=function(e){return this.rep.unstream(e),this.infos={corner:[e.readFloat(),e.readFloat(),e.readFloat()],firstAxis:[e.readFloat(),e.readFloat(),e.readFloat()],secondAxis:[e.readFloat(),e.readFloat(),e.readFloat()],thirdlength:e.readFloat()},this.addMesh(e)?this.rep:null},as.prototype.build=function(r){var t,i=r.getCurrentMatId(),s=r.getGAS(e.ConnectivityTypeEnum.TRIANGLES);t=r.isASMColor()?r.getGAS(null):s.clone();var n=this.infos;return!ss("Cuboid")?{gas:s,matId:i,canonicalType:ue,vectors:[n.corner[0],n.corner[1],n.corner[2],n.firstAxis[0],n.firstAxis[1],n.firstAxis[2],n.secondAxis[0],n.secondAxis[1],n.secondAxis[2]],floats:[n.thirdlength]}:e._createCuboidMesh(n.corner,n.firstAxis,n.secondAxis,n.thirdlength,s,i,!0,null,t)};var os=function(){qt.call(this)};os.prototype=Object.create(qt.prototype),os.prototype.constructor=os,os.prototype.unstream=function(e){this.rep.unstream(e);for(var r=e.readCompressedUInt(),t=[],i=0;i<3*r;i++)t.push(e.readFloat());return this.infos={centers:t,startN:[e.readFloat(),e.readFloat(),e.readFloat()],endN:[e.readFloat(),e.readFloat(),e.readFloat()],radius:e.readFloat()},this.addMesh(e)?this.rep:null},os.prototype.build=function(t){var i,s=t.getCurrentMatId(),n=t.getGAS(e.ConnectivityTypeEnum.TRIANGLES);i=t.isASMColor()?t.getGAS(null):n.clone();var a=this.infos;if(!ss("CurvedPipe")){var o=[-a.startN[2],a.startN[0],-a.startN[1]],p=(a.endN[2],a.endN[0],a.endN[1],[a.startN[1]*o[2]-a.startN[2]*o[1],a.startN[2]*o[0]-a.startN[0]*o[2],a.startN[0]*o[1]-a.startN[1]*o[0]]),h=n.getDisplayedColor(),u=new r.Color;return u.setRGB(h[0]/255,h[1]/255,h[2]/255),{gas:{color:u,opacity:h[3]/255},matId:s,curveVertices:a.centers,startNormal:a.startN,endNormal:a.endN,radius:a.radius,startSideVector:p}}for(var f=[],d=[],c=0,l=0;l<a.centers.length/3;l++)d.push(a.radius),f.push(new r.Vector3(a.centers[c++],a.centers[c++],a.centers[c++]));var v=new r.Vector3(a.startN[0],a.startN[1],a.startN[2]),m=new r.Vector3(a.endN[0],a.endN[1],a.endN[2]);return e._createCurvedPipeMesh(f,d,v,m,!0,n,s,is(),!0,null,null,i)};var ps=function(){qt.call(this)};ps.prototype=Object.create(qt.prototype),ps.prototype.constructor=ps,ps.prototype.unstream=function(e){return this.rep.unstream(e),this.infos={bottomCenter:[e.readFloat(),e.readFloat(),e.readFloat()],topCenter:[e.readFloat(),e.readFloat(),e.readFloat()],radius:e.readFloat()},this.addMesh(e)?this.rep:null},ps.prototype.build=function(t){var i,n=t.getCurrentMatId(),a=t.getGAS(e.ConnectivityTypeEnum.TRIANGLES);i=t.isASMColor()?t.getGAS(null):a.clone();var o=this.infos,p=[o.topCenter[0]-o.bottomCenter[0],o.topCenter[1]-o.bottomCenter[1],o.topCenter[2]-o.bottomCenter[2]],h=Math.sqrt(p[0]*p[0]+p[1]*p[1]+p[2]*p[2]);p[0]/=h,p[1]/=h,p[2]/=h;var u=[-p[2],p[0],-p[1]],f=[p[1]*u[2]-p[2]*u[1],p[2]*u[0]-p[0]*u[2],p[0]*u[1]-p[1]*u[0]],d=!ss("Cylinder");if(s){var c=a.getDisplayedColor(),l=new r.Color;return l.setRGB(c[0]/255,c[1]/255,c[2]/255),{gas:{color:l,opacity:c[3]/255},matId:n,curveVertices:[o.bottomCenter[0],o.bottomCenter[1],o.bottomCenter[2],o.topCenter[0],o.topCenter[1],o.topCenter[2]],startNormal:[-p[0],-p[1],-p[2]],endNormal:p,radius:o.radius,startSideVector:f}}return d?{gas:a,matId:0,canonicalType:he,vectors:[o.bottomCenter[0],o.bottomCenter[1],o.bottomCenter[2],o.topCenter[0],o.topCenter[1],o.topCenter[2]],floats:[o.radius]}:e._createCustomCylindricalMesh(o.bottomCenter,o.topCenter,o.radius,o.radius,a,n,is(),!0,t.decorations,i)};var hs=function(){qt.call(this)};hs.prototype=Object.create(qt.prototype),hs.prototype.constructor=hs,hs.prototype.unstream=function(e){return this.rep.unstream(e),this.infos={center:[e.readFloat(),e.readFloat(),e.readFloat()],firstAxis:[e.readFloat(),e.readFloat(),e.readFloat()],secondAxis:[e.readFloat(),e.readFloat(),e.readFloat()],meridianStartAngle:e.readFloat(),meridianEndAngle:e.readFloat(),parallelStartAngle:e.readFloat(),parallelEndAngle:e.readFloat()},this.addMesh(e)?this.rep:null},hs.prototype.build=function(r){var t=r.getCurrentMatId(),i=r.getGAS(null),s=this.infos;return!ss("PartialSphere")?{gas:i,matId:t,canonicalType:de,vectors:[s.center[0],s.center[1],s.center[2],s.firstAxis[0],s.firstAxis[1],s.firstAxis[2],s.secondAxis[0],s.secondAxis[1],s.secondAxis[2]],floats:[s.meridianStartAngle,s.meridianEndAngle,s.parallelStartAngle,s.parallelEndAngle]}:e._createCustomSphereMesh(s.parallelStartAngle,s.parallelEndAngle,s.meridianStartAngle,s.meridianEndAngle,s.center,s.firstAxis,s.secondAxis,i,t,is(),!0,r.decorations)};var us=function(){qt.call(this)};us.prototype=Object.create(qt.prototype),us.prototype.constructor=us,us.prototype.unstream=function(e){return this.rep.unstream(e),this.infos={center:[e.readFloat(),e.readFloat(),e.readFloat()],firstAxis:[e.readFloat(),e.readFloat(),e.readFloat()],secondAxis:[e.readFloat(),e.readFloat(),e.readFloat()],minorRadius:e.readFloat(),majorAngle:e.readFloat()},this.addMesh(e)?this.rep:null},us.prototype.build=function(t){var i,n=t.getCurrentMatId(),a=t.getGAS(e.ConnectivityTypeEnum.TRIANGLES);i=t.isASMColor()?t.getGAS(null):a.clone();var o=this.infos,p=!ss("PartialTorus"),h=e._buildCurvedPipeDataFromTorus(new r.Vector3(o.center[0],o.center[1],o.center[2]),new r.Vector3(o.firstAxis[0],o.firstAxis[1],o.firstAxis[2]),new r.Vector3(o.secondAxis[0],o.secondAxis[1],o.secondAxis[2]),o.majorAngle,is(),o.minorRadius);if(s){var u=a.getDisplayedColor(),f=new r.Color;return f.setRGB(u[0]/255,u[1]/255,u[2]/255),{gas:{color:f,opacity:u[3]/255},matId:n,curveVertices:h.centers,startNormal:h.startNormal,endNormal:h.endNormal,startSideVector:o.firstAxis,radius:o.minorRadius}}if(p)return{gas:a,matId:n,canonicalType:le,vectors:[o.center[0],o.center[1],o.center[2],o.firstAxis[0],o.firstAxis[1],o.firstAxis[2],o.secondAxis[0],o.secondAxis[1],o.secondAxis[2]],floats:[o.minorRadius,o.majorAngle]};for(var d=[],c=[],l=0,v=0;v<h.centers.length/3;v++)c.push(o.minorRadius),d.push(new r.Vector3(h.centers[l++],h.centers[l++],h.centers[l++]));var m=new r.Vector3(h.startNormal[0],h.startNormal[1],h.startNormal[2]),y=new r.Vector3(h.endNormal[0],h.endNormal[1],h.endNormal[2]);return e._createCurvedPipeMesh(d,c,m,y,!0,a,n,is(),!0,t.decorations,o,i)};var fs=function(){qt.call(this)};fs.prototype=Object.create(qt.prototype),fs.prototype.constructor=fs,fs.prototype.unstream=function(e){return this.rep.unstream(e),this.infos={center:[e.readFloat(),e.readFloat(),e.readFloat()],radius:e.readFloat()},this.addMesh(e)?this.rep:null},fs.prototype.build=function(r){var t=r.getCurrentMatId(),i=r.getGAS(null),s=this.infos;return!ss("Sphere")?{gas:i,matId:t,canonicalType:fe,vectors:s.center,floats:[s.radius]}:e._createCustomSphereMesh(-Math.PI/2,Math.PI/2,0,2*Math.PI,s.center,[s.radius,0,0],[0,1,0],i,t,is(),!0,r.decorations)};var ds=function(){qt.call(this)};ds.prototype=Object.create(qt.prototype),ds.prototype.constructor=ds,ds.prototype.unstream=function(e){return this.rep.unstream(e),this.infos={center:[e.readFloat(),e.readFloat(),e.readFloat()],planeNormal:[e.readFloat(),e.readFloat(),e.readFloat()],minorRadius:e.readFloat()},this.addMesh(e)?this.rep:null},ds.prototype.build=function(t){var i=t.getCurrentMatId(),n=t.getGAS(null),a=this.infos,o=new r.Vector3(a.planeNormal[0],a.planeNormal[1],a.planeNormal[2]),p=o.length();o.normalize();var h=new r.Vector3(-a.planeNormal[2],a.planeNormal[0],-a.planeNormal[1]),u=new r.Vector3;u.crossVectors(o,h),u.normalize();var f=new r.Vector3;f.crossVectors(o,u),f.normalize(),u.multiplyScalar(p),f.multiplyScalar(p);var d=e._buildCurvedPipeDataFromTorus(new r.Vector3(a.center[0],a.center[1],a.center[2]),u,f,2*Math.PI,is(),a.minorRadius),c=!ss("Torus");if(s){var l=n.getDisplayedColor(),v=new r.Color;return v.setRGB(l[0]/255,l[1]/255,l[2]/255),{gas:{color:v,opacity:l[3]/255},matId:i,curveVertices:d.centers,startNormal:d.startNormal,endNormal:d.endNormal,startSideVector:[u.x,u.y,u.z],radius:a.minorRadius}}if(c)return{gas:n,matId:i,canonicalType:ce,vectors:[a.center[0],a.center[1],a.center[2],a.planeNormal[0],a.planeNormal[1],a.planeNormal[2]],floats:[a.minorRadius]};for(var m=[],y=[],g=0,x=0;x<d.centers.length/3;x++)y.push(a.minorRadius),m.push(new r.Vector3(d.centers[g++],d.centers[g++],d.centers[g++]));var B=new r.Vector3(d.startNormal[0],d.startNormal[1],d.startNormal[2]);new r.Vector3(d.endNormal[0],d.endNormal[1],d.endNormal[2]);return e._createTorusMesh(new r.Vector3(a.center[0],a.center[1],a.center[2]),m,y,B,n,i,is(),!0,t.decorations)};var cs=function(){qt.call(this)};cs.prototype=Object.create(qt.prototype),cs.prototype.constructor=cs,cs.prototype.unstream=function(e){if(this.rep.unstream(e),this.infos={width:e.readCompressedInt(),height:e.readCompressedInt(),depth:e.readCompressedInt(),format:e.readCompressedUInt(),encoding:e.readCompressedUInt(),bufferSize:e.readCompressedUInt(),bufferData:null},this.infos.bufferSize>0){var r=new Uint8Array(this.infos.bufferSize);e.readBytes(this.infos.bufferSize,r),this.infos.bufferData=r}return this.addMesh(e)?this.rep:null},cs.prototype.build=function(e){return{voxelRep:this.infos}};var ls=function(e){this.fatherId=e.readUncompressedInt(!1);new me(e);var r=e.readUncompressedInt(!1);this.name=e.readUnicodeString(r/2),this.blocReader=new ge(e,0),this.getId=function(){return this.blocReader.id}},vs=function(e,r){this.tocEntry=r;var t=e;this.name=r.name;var i=[],s=[];this.header=null,this.getChild=function(e){},this.getStreamerByName=function(e,i){for(var n=0;n<s.length;++n)if(s[n].name==e){var a=s[n];return i&&a.setCurrentPosition(0),a}return null!=(a=t.getStreamer(r,e))&&(null!=this.header&&(a.version=this.header.version,a.conversion=this.header.conversion),a.setContainer(this),s.push(a)),a},this.getStreamer=function(){return this.getStreamerByName(this.name)},this.getChildContainer=function(r){for(var t=0;t<i.length;++t)if(i[t].name==r)return i[t];var s=e.getChildContainer(this.tocEntry,r);return s&&i.push(s),s},this.unstreamHeaderCGR=function(e){if(!this.header){this.header=e?this.getStreamerByName(e):this.getStreamer();var r=this.header.readUnsignedChar();if(this.header.conversion=!r,this.header.version=this.header.readUncompressedInt(),this.header.version>210042530)return console.log("warning cgr version not supported "+this.header.version+">210042530"),{error:"warning cgr version not supported"};this.header.version>=1101310&&this.header.readUncompressedInt()}},this.unstreamHeaderUVR=function(e){this.header=e;var r=this.header.readUnsignedChar();if(this.header.conversion=!r,this.header.version=this.header.readUncompressedInt(),this.header.version>210042530)return console.log("warning ugr version not supported"),{error:"warning ugr version not supported"}},this.getResourceCGRContainer=function(){var e=t.getRootContainer();return e?e.getChildContainer("Resources"):null},this.getResource=function(e){var r,t=null,i=e.readUnsignedChar(),s=e.readCompressedInt();if(e.textures.isValidMultiRefIndex(s))return r=e.textures.getIndex(s);var n=this.getStreamerByName("MainCGRResourceStreamer");n.setCurrentPosition(s),e.copyStreamerInheritance(n);var a=null;if(n.readUnsignedChar()){var o=n.readStringWithLength(),p=n.readStringWithLength();console.log(" providerName = "+o+"resourceUUID = "+p+"not loaded")}else if(i){t=(a=new Le).unstream(n)}else{switch(n.readUnsignedChar()){case xe:break;case Be:a=new _e}var h=n.readStringWithLength().split("\\"),u=h[h.length-1];null!=a&&(t=a.unstream(n,u))}return null!=t?(r=e.textures.add(t),e.textures.addMultiRefIndex(s,r),r):null},this.getImage=function(e,r,t){var i=null,s=this.getStreamerByName("MainCGRResourceStreamer");e.copyStreamerInheritance(s),s.setCurrentPosition(r);var n=s.readUnsignedChar();if(2==n)i=(new ke).createTexture(s);else if(1==n){i=(new Ve).unstream(s)}else if(3==n||4==n||5==n){var a=0;i=null;5==n&&(a=s.readCompressedUInt());var o=s.readCompressedUInt();if(o>0)return i=new Uint8Array(o),s.readBytes(o,i),{img:i,imgType:n,format:a}}return i},this.getResourceShader=function(e){var r=0;e.readUnsignedChar()&&(r=e.readCompressedInt());var t=this.getStreamerByName("MainCGRResourceStreamer");if(t.conversion=e.conversion,t.setCurrentPosition(r),t.version=e.version,!t.readUnsignedChar()){var i=new Xe;i.unstream(t)}return i}},ms=[],ys=0,gs=1,xs=!1,Bs=null,As=function(e){this.multiPartReader=e,this.currentPositionInView=0,this.position=0,this.offsetsInStream=[],this.dataViews=[],this.currentView=null,this.currentBuffer=null,this.offsetInBuffer=0,this.currentViewIndex=0,this.intMaxOffset=0,this.shortMaxOffset=0,this.doubleMaxOffset=0};As.prototype.addBloc=function(e){var r=this.multiPartReader.getDataViews(e.offset,e.length),t=this.dataViews.length;this.offsetsInStream.length&&this.offsetsInStream[this.offsetsInStream.length-1];this.dataViews=this.dataViews.concat(r);for(var i=t;i<this.dataViews.length;++i)0==i?this.offsetsInStream.push(0):this.offsetsInStream.push(this.offsetsInStream[i-1]+this.dataViews[i-1].dataView.byteLength);null===this.currentView&&(this.currentView=this.dataViews[0].dataView,this.currentBuffer=this.dataViews[0].buffer,this.offsetInBuffer=this.dataViews[0].offset,this.currentPositionInView=0,this.intMaxOffset=this.currentView.byteLength-4,this.shortMaxOffset=this.currentView.byteLength-2,this.doubleMaxOffset=this.currentView.byteLength-8)},As.prototype.setFromBuffer=function(e){this.dataViews.push({dataView:new DataView(e.buffer,0,e.length),buffer:e,offset:0}),this.offsetsInStream.push(0),this.currentView=this.dataViews[0].dataView,this.currentBuffer=this.dataViews[0].buffer,this.offsetInBuffer=this.dataViews[0].offset,this.currentPositionInView=0,this.intMaxOffset=this.currentView.byteLength-4,this.shortMaxOffset=this.currentView.byteLength-2,this.doubleMaxOffset=this.currentView.byteLength-8},As.prototype.getBytesRemain=function(){for(var e=this.currentView.byteLength-this.currentPositionInView,r=this.currentViewIndex+1;r<this.dataViews.length;r++){if(this.dataViews[r])e+=this.dataViews[r].dataView.byteLength}return e},As.prototype.read=function(){return this.currentPositionInView<this.currentView.byteLength?this.currentBuffer[this.offsetInBuffer+this.currentPositionInView++]:(this.currentViewIndex++,this.currentView=this.dataViews[this.currentViewIndex].dataView,this.currentBuffer=this.dataViews[this.currentViewIndex].buffer,this.offsetInBuffer=this.dataViews[this.currentViewIndex].offset,this.currentPositionInView=0,this.intMaxOffset=this.currentView.byteLength-4,this.shortMaxOffset=this.currentView.byteLength-2,this.doubleMaxOffset=this.currentView.byteLength-8,this.currentBuffer[this.offsetInBuffer+this.currentPositionInView++])},As.prototype.getCurrentPosition=function(){return this.offsetsInStream[this.currentViewIndex]+this.currentPositionInView},As.prototype.setPosition=function(e){for(var r=0,t=0;e>r+this.dataViews[t].dataView.byteLength;)r+=this.dataViews[t].dataView.byteLength,t++;this.currentViewIndex=t,this.currentView=this.dataViews[this.currentViewIndex].dataView,this.currentBuffer=this.dataViews[this.currentViewIndex].buffer,this.offsetInBuffer=this.dataViews[this.currentViewIndex].offset,this.currentPositionInView=e-r,this.intMaxOffset=this.currentView.byteLength-4,this.shortMaxOffset=this.currentView.byteLength-2,this.doubleMaxOffset=this.currentView.byteLength-8};var Is=new Uint8Array(8),bs=new Int32Array(Is.buffer),Cs=new Uint32Array(Is.buffer),ws=new Int16Array(Is.buffer),Ss=new Uint16Array(Is.buffer),Ps=new Float32Array(Is.buffer),Ms=new Float64Array(Is.buffer);As.prototype.readDouble=function(e){return e?(Is[7]=this.read(),Is[6]=this.read(),Is[5]=this.read(),Is[4]=this.read(),Is[3]=this.read(),Is[2]=this.read(),Is[1]=this.read(),Is[0]=this.read()):(Is[0]=this.read(),Is[1]=this.read(),Is[2]=this.read(),Is[3]=this.read(),Is[4]=this.read(),Is[5]=this.read(),Is[6]=this.read(),Is[7]=this.read()),Ms[0]},As.prototype.readFloatBorder=function(e){return e?(Is[3]=this.read(),Is[2]=this.read(),Is[1]=this.read(),Is[0]=this.read()):(Is[0]=this.read(),Is[1]=this.read(),Is[2]=this.read(),Is[3]=this.read()),Ps[0]};var Ts=new Float32Array(1),Fs=new Uint8Array(Ts.buffer);As.prototype.readFloat=function(e){if(this.currentPositionInView<this.intMaxOffset){var r=this.offsetInBuffer+this.currentPositionInView;return this.currentPositionInView+=4,e?(Fs[3]=this.currentBuffer[r],Fs[2]=this.currentBuffer[r+1],Fs[1]=this.currentBuffer[r+2],Fs[0]=this.currentBuffer[r+3]):(Fs[0]=this.currentBuffer[r],Fs[1]=this.currentBuffer[r+1],Fs[2]=this.currentBuffer[r+2],Fs[3]=this.currentBuffer[r+3]),Ts[0]}return this.readFloatBorder(e)},As.prototype.readIntBorder=function(e){return e?(Is[3]=this.read(),Is[2]=this.read(),Is[1]=this.read(),Is[0]=this.read()):(Is[0]=this.read(),Is[1]=this.read(),Is[2]=this.read(),Is[3]=this.read()),bs[0]},As.prototype.readUIntBorder=function(e){return e?(Is[3]=this.read(),Is[2]=this.read(),Is[1]=this.read(),Is[0]=this.read()):(Is[0]=this.read(),Is[1]=this.read(),Is[2]=this.read(),Is[3]=this.read()),Cs[0]},As.prototype.readInt=function(e){if(this.currentPositionInView<this.intMaxOffset){var r=this.offsetInBuffer+this.currentPositionInView;this.currentPositionInView+=4;var t=this.currentBuffer[r],i=this.currentBuffer[r+1],s=this.currentBuffer[r+2],n=this.currentBuffer[r+3];return e?(t<<24)+(i<<16)+(s<<8)+n:(n<<24)+(s<<16)+(i<<8)+t}return this.readIntBorder(e)},As.prototype.readUncompressedULong=function(e){if(this.currentPositionInView<this.intMaxOffset){var r=this.currentView.getUint32(this.currentPositionInView,!e);return this.currentPositionInView+=4,r}return this.readUIntBorder(e)},As.prototype.readUncompressedInt=function(e){if(this.currentPositionInView<this.intMaxOffset){var r=this.currentView.getUint32(this.currentPositionInView,!e);return this.currentPositionInView+=4,r}return this.readUIntBorder(e)},As.prototype.readUnsignedShortBorder=function(e){return e?(Is[0]=this.read(),Is[1]=this.read()):(Is[1]=this.read(),Is[0]=this.read()),Ss[0]},As.prototype.readShortBorder=function(e){return e?(Is[0]=this.read(),Is[1]=this.read()):(Is[1]=this.read(),Is[0]=this.read()),ws[0]},As.prototype.readUnsignedShort=function(e){if(this.currentPositionInView<this.shortMaxOffset){var r=this.offsetInBuffer+this.currentPositionInView;return this.currentPositionInView+=2,this.currentBuffer[r]<<8&65280|255&this.currentBuffer[r+1]}return this.readUnsignedShortBorder(e)},As.prototype.readShort=function(e){if(this.currentPositionInView<this.shortMaxOffset){var r=this.offsetInBuffer+this.currentPositionInView;this.currentPositionInView+=2;var t=this.currentBuffer[r],i=this.currentBuffer[r+1];if(e){var s=(127&t)<<8|i;return s-=(128&t)<<8}s=(127&i)<<8|t;return s-=(128&i)<<8}return this.readShortBorder(e)},As.prototype.readShortArrayBuffer=function(e,r,t){var i=2*e;if(this.currentPositionInView+2*e<this.currentView.byteLength){var s=new Uint8Array(r.buffer),n=this.offsetInBuffer+this.currentPositionInView;if(t)for(var a=0;a<e;++a)s[2*a+1]=this.currentBuffer[n+2*a],s[2*a]=this.currentBuffer[n+2*a+1];else for(a=0;a<i;++a)s[a]=this.currentBuffer[n+a];this.currentPositionInView+=i}else for(a=0;a<e;++a)r[a]=this.readShort(t)},As.prototype.unpackc24=function(e,r,t){if(this.currentPositionInView+3*r<this.currentView.byteLength){for(var i=0;i<r;++i){var s=this.offsetInBuffer+this.currentPositionInView;t[i+e]=this.currentBuffer[s+3*i]<<16&16711680|this.currentBuffer[s+3*i+1]<<8&65280|255&this.currentBuffer[s+3*i+2]}this.currentPositionInView+=3*r}else for(i=0;i<r;++i)t[i+e]=this.read()<<16&16711680|this.read()<<8&65280|255&this.read()},As.prototype.readShortArray=function(e,r,t,i){if(this.currentPositionInView+2*r<this.currentView.byteLength){if(this.conversion)for(var s=0;s<r;++s){var n=(127&(a=this.currentBuffer[2*s]))<<8|this.currentBuffer[2*s+1];t[e+s]=n-((128&a)<<8)}else for(s=0;s<r;++s){var a;n=(127&(a=this.currentBuffer[2*s]))<<8|this.currentBuffer[2*s+1];t[e+s]=n-((128&a)<<8)}this.currentPositionInView+=2*r}else for(s=0;s<r;++s)t[e+s]=this.readShort(i)},As.prototype.readBytesArrayBuffer=function(e,r,t){if(this.currentPositionInView+r<this.currentView.byteLength){for(var i=this.offsetInBuffer+this.currentPositionInView,s=0;s<r;++s)t[e+s]=this.currentBuffer[i+s];this.currentPositionInView+=r}else for(s=0;s<r;++s)t[e+s]=this.read()},As.prototype.readBytes=function(e,r,t){if(this.currentPositionInView+r<this.currentView.byteLength){for(var i=this.offsetInBuffer+this.currentPositionInView,s=0;s<r;++s)t[e+s]=this.currentBuffer[i+s];this.currentPositionInView+=r}else for(s=0;s<r;++s)t[e+s]=this.read()},As.prototype.getByteView=function(e,r){if(this.currentPositionInView+e<this.currentView.byteLength){var t=new Uint8Array(this.currentBuffer.buffer,this.offsetInBuffer+this.currentPositionInView,e);return this.currentPositionInView+=e,t}for(var i=0;i<e;++i)r[i]=this.read();return r},As.prototype.readUnsignedShortArray=function(e,r,t,i){if(this.currentPositionInView+2*r<this.currentView.byteLength){var s=this.offsetInBuffer+this.currentPositionInView;if(i)for(n=0;n<r;++n)Is[0]=this.currentBuffer[s+2*n],Is[1]=this.currentBuffer[s+2*n+1],t[e+n]=Ss[0];else for(var n=0;n<r;++n)Is[1]=this.currentBuffer[s+2*n],Is[0]=this.currentBuffer[s+2*n+1],t[e+n]=Ss[0];this.currentPositionInView+=2*r}else for(n=0;n<r;++n)t[e+n]=this.readUnsignedShort(i)},As.prototype.readUnsignedShortArrayBuffer=function(e,r,t){if(this.currentPositionInView+2*e<this.currentView.byteLength){var i=new Uint8Array(r.buffer),s=2*e,n=this.offsetInBuffer+this.currentPositionInView;if(t){for(var a=0;a<e;++a)i[2*a+1]=this.currentBuffer[n+2*a],i[2*a]=this.currentBuffer[n+2*a+1];this.currentPositionInView+=4*e}else{for(a=0;a<s;++a)i[a]=this.currentBuffer[n+a];this.currentPositionInView+=s}}else for(a=0;a<e;++a)r[a]=this.readUnsignedShort(t)},As.prototype.readFloatArrayBuffer=function(e,r,t){if(this.currentPositionInView+4*e<this.currentView.byteLength){var i=new Uint8Array(r.buffer),s=4*e,n=this.offsetInBuffer+this.currentPositionInView;if(t){for(var a=0;a<e;++a)i[4*a+3]=this.currentBuffer[n+4*a],i[4*a+2]=this.currentBuffer[n+4*a+1],i[4*a+1]=this.currentBuffer[n+4*a+2],i[4*a]=this.currentBuffer[n+4*a+3];this.currentPositionInView+=4*e}else{for(a=0;a<s;++a)i[a]=this.currentBuffer[n+a];this.currentPositionInView+=s}}else for(a=0;a<e;++a)r[a]=this.readFloat(t)},As.prototype.readFloatArray=function(e,r,t,i){if(this.currentPositionInView+4*r<this.currentView.byteLength)for(var s=this.currentPositionInView+4*r,n=e;this.currentPositionInView<s;)t[n++]=this.readFloat(i);else for(var a=0;a<r;++a)t[e+a]=this.readFloat(i)};var Us=function(){var e=[],r=[];this.remove=function(r){e.splice(r,1)},this.add=function(r){var t=e.length;return e[t]=r,t},this.addAt=function(r,t){e[t]=r},this.isValidIndex=function(r){return r<e.length},this.get=function(r){return e[r]},this.getArray=function(){return e},this.isValidMultiRefIndex=function(e){return void 0!==r[e]},this.isValidMultiRefIndexWithName=function(e,t){if(void 0!==r[e]){for(var i=0;i<r[e].length;i++)if(r[e][i].streamerName===t)return!0;return!1}return!1},this.addMultiRefIndex=function(e,t){r[e]=t},this.addMultiRefIndexWithName=function(e,t,i){void 0!==r[e]?r[e].push({index:t,streamerName:i}):r[e]=[{index:t,streamerName:i}]},this.getIndex=function(e){return r[e]},this.getIndexWithName=function(e,t){for(var i=r[e],s=0;s<i.length;s++)if(i[s].streamerName===t)return i[s].index;return null}};return function(i,v,m,y,g,x,B,A,I,b,C,w,S,P,M){ys=I&&I.sag2D?I.sag2D:0,I&&I.sag3D?I.sag3D:0;this.isV5=!0,this.FTA=!1,!i||i instanceof byteArrayReader?(u=S,this.expand=v,this.withSceneGraph=y,y,d=x,o=B,p=A,h=M,this.uint32Index=g,c=b,f=P):(this.expand=i.expand,this.withSceneGraph=i.withSG,this.withSceneGraph,d=i.computeSSB,o=i.sag,p=i.processText,h=i.sceneGraphOrderMode,this.uint32Index=i.i32Idx,c=i.bagUUID,u=i.withBlanking,f=i.useDefaultTCSet),t=w,n=m,a=C;var T=null,F=i,U=null,R=null,N=null;this.setFileBuffer=function(e){F=new byteArrayReader(e),{file:"",id:-1},null,ms=[],gs=1,this.isV5=!0,T=null,U=null,R=null,N=null};this.addChild=function(e){var r=e.node;if(e.children)for(var t=e.children.length,i=0;i<t;i++){var s=e.children[i].node;r.children.push(s),s.type&&(s.parent=r,this.addChild(e.children[i]))}};var q=function(e,r,t){this.cgmId=e||0,this.matrix=r||null,this.boundingSphere=t||null};this.addChildExpand=function(e){var r=new q(e.node.cgmId,e.node.matrix,e.node.boundingSphere);if(void 0!==e.node.rep?r.rep=e.node.rep:r.children=[],e.children)for(var t=e.children.length,i=0;i<t;i++){var s=this.addChildExpand(e.children[i]);r.children.push(s)}return r},this.compressedChildren=function(e,r){var t,i,s,n,a,o,p=e.node;if(r.offset>r.size&&(r.size*=2,t=new ArrayBuffer(r.size),r.result.push(t),r.view32F=new Float32Array(t),r.view32UInt=new Uint32Array(t),r.view8UInt=new Uint8Array(t)),r.view32UInt[r.offset++]=p.cgmId,r.view8UInt[4*r.offset]=p.type,r.view8UInt[4*r.offset+1]=p.solid,r.offset++,e.children){var h,u=e.children.length;for(r.view32UInt[r.offset++]=u,i=0;i<u;i++)h=e.children[i].node,p.children.push(h),h.parent=p,this.compressedChildren(e.children[i],r)}if(p.primitives)for(u=p.primitives.length,r.view32UInt[r.offset++]=u,i=0;i<u;i++){if(a=!!(s=p.primitives[i]).boundingSphere,o=!!s.decoration&&s.decoration[0],r.view32UInt[r.offset++]=s.cgmId,r.view8UInt[4*r.offset]=s.type,r.view8UInt[4*r.offset+1]=a,r.view8UInt[4*r.offset+2]=o,r.offset++,r.view32UInt[r.offset++]=s.count,r.view32UInt[r.offset++]=s.start,s.group.primitives instanceof Array?(n=r.idGroup++,s.group.primitives=n):n=s.group.primitives,r.view32UInt[r.offset++]=n,o){var f,d=s.decoration.length,c=4*r.offset;for(f=0;f<d;f++)r.view8UInt[c+f]=s.decoration[f];r.offset+=1+(d/4>>0)}a&&(r.view32F[r.offset++]=s.boundingSphere.center[0],r.view32F[r.offset++]=s.boundingSphere.center[1],r.view32F[r.offset++]=s.boundingSphere.center[2],r.view32F[r.offset++]=s.boundingSphere.radius)}},this.applyGlobalMatrix=function(t,i){for(var s=0;s<t.length;s++)if(t[s].globalMatrix&&!t[s].globalMatrix.isIdentity()){var n=new r.Matrix4;if(n.extractRotation(t[s].globalMatrix),e.applyMat(t[s],t[s].globalMatrix,i,n),n.isIdentity()){var a=new r.Vector3(t[s].AABB.min[0],t[s].AABB.min[1],t[s].AABB.min[2]).applyMatrix4(t[s].globalMatrix),o=new r.Vector3(t[s].AABB.max[0],t[s].AABB.max[1],t[s].AABB.max[2]).applyMatrix4(t[s].globalMatrix);t[s].AABB.min[0]=a.x,t[s].AABB.min[1]=a.y,t[s].AABB.min[2]=a.z,t[s].AABB.max[0]=o.x,t[s].AABB.max[1]=o.y,t[s].AABB.max[2]=o.z}else e.computeBB(t[s])}},this.applyGlobalMatrixStatic=function(t,i){for(var s=0;s<t.length;s++)if(t[s].globalMatrix&&!t[s].globalMatrix.isIdentity()){var n=new r.Matrix4;if(n.extractRotation(t[s].globalMatrix),e.applyMat(t[s],t[s].globalMatrix,i,n),n.isIdentity()){var a=new r.Vector3(t[s].AABB.min[0],t[s].AABB.min[1],t[s].AABB.min[2]).applyMatrix4(t[s].globalMatrix),o=new r.Vector3(t[s].AABB.max[0],t[s].AABB.max[1],t[s].AABB.max[2]).applyMatrix4(t[s].globalMatrix);t[s].AABB.min[0]=a.x,t[s].AABB.min[1]=a.y,t[s].AABB.min[2]=a.z,t[s].AABB.max[0]=o.x,t[s].AABB.max[1]=o.y,t[s].AABB.max[2]=o.z}else e.computeBB(t[s])}},this.applyGlobalMatrixAxis=function(e){for(var t=null,i=new r.Matrix4,s=new r.Vector3,n=new r.Vector3,a=new r.Vector3,o=new r.Vector3,p=0;p<e.length;p++)t=e[p].axis,!!e[p].globalMatrix&&!e[p].globalMatrix.isIdentity()&&(s.set(t.origin[0],t.origin[1],t.origin[2]),n.set(t.xAxis[0],t.xAxis[1],t.xAxis[2]),a.set(t.yAxis[0],t.yAxis[1],t.yAxis[2]),o.set(t.zAxis[0],t.zAxis[1],t.zAxis[2]),i.makeBasis(n,a,o),i.setPosition(s),i.multiply(e[p].globalMatrix),t.origin=[i.elements[12],i.elements[13],i.elements[14]],t.xAxis=[i.elements[0],i.elements[1],i.elements[2]],t.yAxis=[i.elements[4],i.elements[5],i.elements[6]],t.zAxis=[i.elements[8],i.elements[9],i.elements[10]]),e[p]=t},this.applyGlobalMatrixArrows=function(e){new r.Matrix4;for(var t=new r.Vector3,i=new r.Vector3,s=0;s<e.length;s++){for(var n=[],a=e[s].arrows,o=0;o<a.length;o++){var p=a[o];!!e[s].globalMatrix&&!e[s].globalMatrix.isIdentity()&&(t.set(p.origin[0],p.origin[1],p.origin[2]),i.set(p.direction[0],p.direction[1],p.direction[2]),t.applyMatrix4(e[s].globalMatrix),i.applyRotation(e[s].globalMatrix),p.origin=[t.x,t.y,t.z],p.direction=[i.x,i.y,i.z]),n.push(p)}e[s]=n}},this.applyGlobalMatrixRefPlanes=function(e){for(var t=new r.Matrix4,i=new r.Vector3,s=new r.Vector3,n=new r.Vector3,a=new r.Vector3,o=0;o<e.length;o++){for(var p=[],h=e[o].refPlanes,u=0;u<h.length;u++){var f=h[u];!!e[o].globalMatrix&&!e[o].globalMatrix.isIdentity()&&(i.set(f.origin[0],f.origin[1],f.origin[2]),s.set(f.xAxis[0],f.xAxis[1],f.xAxis[2]),n.set(f.yAxis[0],f.yAxis[1],f.yAxis[2]),a.crossVectors(s,n),t.makeBasis(s,n,a),t.setPosition(i),t.multiply(e[o].globalMatrix),f.origin=[t.elements[12],t.elements[13],t.elements[14]],f.xAxis=[t.elements[0],t.elements[1],t.elements[2]],f.yAxis=[t.elements[4],t.elements[5],t.elements[6]]),p.push(f)}e[o]=p}},this.computePrimBS=function(e){if(n)for(var r=0;r<e.length;r++)for(var t=e[r],i=t.vertexPositionArray,s=t.vertexIndexArray,a=0;a<t.drawingGroups.length;a++){var o=t.drawingGroups[a];if(0!==o.glType)for(var p=0;p<o._primitives.length;p++){var h=o._primitives[p];if(!h.boundingSphere){for(var u=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],f=[-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE],d=h.start;d<h.start+h.count;d++){var c=s[d];i[3*c]<u[0]&&(u[0]=i[3*c]),i[3*c+1]<u[1]&&(u[1]=i[3*c+1]),i[3*c+2]<u[2]&&(u[2]=i[3*c+2]),i[3*c]>f[0]&&(f[0]=i[3*c]),i[3*c+1]>f[1]&&(f[1]=i[3*c+1]),i[3*c+2]>f[2]&&(f[2]=i[3*c+2])}var l=(u[0]-f[0])*(u[0]-f[0]);l+=(u[1]-f[1])*(u[1]-f[1]),l+=(u[2]-f[2])*(u[2]-f[2]),l=.5*Math.sqrt(l);var v={center:[.5*(u[0]+f[0]),.5*(u[1]+f[1]),.5*(u[2]+f[2])],radius:l};h.boundingSphere=v}}}},this.processAllReps=function(e,t,i,s){var n=[],p=e.length,u=new r.Vector3,f=3;a&&(f+=4),o&&(f+=1);for(var c=0;c<p;c++){var l=[],v=e[c].getArray();if(1&c||8&c)this.computePrimBS(v),this.applyGlobalMatrixStatic(v,t),this.batch_static(v,l,t);else{this.computePrimBS(v),this.applyGlobalMatrix(v,t);for(var m=0;m<v.length;m++){var y=v[m],g=y.AABB.min,x=y.AABB.max;u.x=x[0]-g[0],u.y=x[1]-g[1],u.z=x[2]-g[2],a&&(i[f*y.rep+f-4]=.5*u.length(),i[f*y.rep+f-3]=.5*g[0]+.5*x[0],i[f*y.rep+f-2]=.5*g[1]+.5*x[1],i[f*y.rep+f-1]=.5*g[2]+.5*x[2]),d&&(v[m]._radius=.5*u.length())}0==c&&1==h?this.batch(v,l,t,s):this.batch(v,l,t)}n.push(l)}return n},this.batch=function(r,t,i,s){var a=function(e,r){e.min[0]>r.min[0]&&(e.min[0]=r.min[0]),e.min[1]>r.min[1]&&(e.min[1]=r.min[1]),e.min[2]>r.min[2]&&(e.min[2]=r.min[2]),e.max[0]<r.max[0]&&(e.max[0]=r.max[0]),e.max[1]<r.max[1]&&(e.max[1]=r.max[1]),e.max[2]<r.max[2]&&(e.max[2]=r.max[2])},p={withSceneGraphOrder:1==h,containNoShow:!1,withSAG:o,withBoundingElement:n},u=[],f=null,c=0,l=65535;this.uint32Index&&(l=524287),p.withSceneGraphOrder&&(l=4294967295);for(var v=0;v<r.length;v++)if(r[v].vertexPositionArray&&(this.FTA||!r[v].noShow)){if(f?a(f,r[v].AABB):f=r[v].AABB,c+r[v].vertexPositionArray.length/3>=l){if(0==c){for(var m=e.divideRep(r[v],!0,p),y=0;y<m.length;y++)t.push(m[y]);f=null;continue}(g=e.processRepsCGR(u,!0,d,p,i,s)).AABB={min:f.min,max:f.max},f=null,t.push(g),c=0,u=[]}if(r[v].vertexPositionArray.length/3>=l){for(m=e.divideRep(r[v],!0,p),y=0;y<m.length;y++)t.push(m[y]);f=null}else u.push(r[v]),c+=r[v].vertexPositionArray.length/3}for(v=0;v<r.length;v++)if(r[v].vertexPositionArray&&!this.FTA&&r[v].noShow&&this.withSceneGraph){if(p.containNoShow=!0,c+r[v].vertexPositionArray.length/3>=l){if(0==c){for(m=e.divideRep(r[v],!0,p,s),y=0;y<m.length;y++)t.push(m[y]);f=null;continue}var g;f||(f={min:[0,0,0],max:[0,0,0]}),(g=e.processRepsCGR(u,!0,d,p,i,s)).AABB={min:f.min,max:f.max},f=null,t.push(g),c=0,u=[]}if(r[v].vertexPositionArray.length/3>=l){for(m=e.divideRep(r[v],!0,p),y=0;y<m.length;y++)t.push(m[y]);f=null}else u.push(r[v]),c+=r[v].vertexPositionArray.length/3}u.length>0&&(f||(f={min:[0,0,0],max:[0,0,0]}),(g=e.processRepsCGR(u,!0,d,p,i,s)).AABB={min:f.min,max:f.max},g.AABB.min[0]==g.AABB.max[0]&&g.AABB.min[1]==g.AABB.max[1]&&g.AABB.min[2]==g.AABB.max[2]&&(g.AABB.min[0]-=.1,g.AABB.min[1]-=.1,g.AABB.max[0]+=.1,g.AABB.max[1]+=.1),t.push(g))},this.batch_static=function(r,t,i){for(var s=function(e,r){for(var t=0;t<16;t++)if(e.elements[t]!=r.elements[t])return!1;return!0},a=[],p=0;p<r.length;p++){for(var h=!1,u=r[p],f=0;f<a.length;f++)if(s(u.attachedPoint,a[f].attachedPoint)){a[f].reps.push(u),h=!0;break}if(!h){var d=[u];a.push({attachedPoint:u.attachedPoint,reps:d})}}for(p=0;p<a.length;p++){var c=e.processRepsCGR(a[p].reps,!1,!1,{containNoShow:!1,withSAG:o,withBoundingElement:n},i),l=[];c.AABB.min[0]==c.AABB.max[0]&&c.AABB.min[1]==c.AABB.max[1]&&c.AABB.min[2]==c.AABB.max[2]&&(c.AABB.min[0]-=.1,c.AABB.min[1]-=.1,c.AABB.max[0]+=.1,c.AABB.max[1]+=.1),l.push(c),t.push({tab:l,globalMatrix:a[p].attachedPoint})}},this.buildSceneGraph=function(r){var t=[],i=r.axisSystems,s=r.refPlanes,n=r.arrows,a=r.voxelReps,o=r.texts;if(!this.expand){this.applyGlobalMatrixAxis(i),this.applyGlobalMatrixRefPlanes(s),this.applyGlobalMatrixArrows(n);var p=this.processAllReps(r.reps,r.materials,r.sgRep,r.dgs),h=null;return this.withSceneGraph&&r.rep&&(this.addChild(r.rep),h=r.rep.node),this.withSceneGraph&&r.rep,{reps:p,sceneGraph:h,resource:r.resource,material:r.materials,sgRep:r.sgRep,decorations:r.decorations,curvedPipes:r.curvedPipes,canonicals:r.canonicals,axisSystems:i,arrows:n,refPlanes:s,voxelReps:a,texts:o}}var u=T.reps[H].getArray(),f=[],d=[];h=null,rep&&(h=this.addChildExpand(rep));for(var c=0;c<u.length;c++)if(u[c].vertexPositionArray)if(u[c].vertexPositionArray.length/3>=65535){for(var l=e.divideRep(u[c],!0),v=(t=[],0);v<l.length;v++)t.push(l[v]);d.push(t)}else{t=[],f.push(u[c]);var m=e.processRepsCGR(f);t.push(m),d.push(t),f=[]}return u=[],T.all_reps=[],{mesh:d,resource:T.textures.getArray(),material:T.materials.getArray(),rep:h}},this.init=function(){var e=(T=new ve(F.clone())).readString(6),r=T.readString(2);if(U=r[0],"V5_CFV"!=e)return this.isV5=!1,{mesh:[],resource:[],material:[],excludeReps:[]};gs=3==U?0:1,T.conversion=!0;var t=T.readUncompressedInt(!0),i=T.readUncompressedInt(!0);if(T.skip(8),T.skip(32),T.readUncompressedInt(!0),T.skip(4),gs&&!T.setCurrentPosition(t))return{error:"file corrupted"};r=T.readString(16),T.readUnsignedChar(),T.readUnsignedShort(!0),T.readUnsignedShort(!0),T.readUnsignedShort(!0);var s=T.readUnsignedShort(!0);if(T.readUnsignedShort(!0),T.readUncompressedInt(!0),T.skip(33),gs)R=new ge(T,s);else{var n=new Uint8Array(384+i);T.readBytes(384,n);var a=new Uint8Array(i);T.setCurrentPosition(t),T.readBytes(i,a),n.set(a,384);var o=new ve(new byteArrayReader(n));o.conversion=!0,R=new ge(o,s)}return T.conversion=!1,!0},this.getApplicativeContainer=function(e,r){var t,i=0,s=0,n={},a=!1;if(r)if((t=this.getRootContainer()).unstreamHeaderCGR(),t.header.version>=210042400&&(a=!0),gs)a?(i=t.header.version,s=t.header.conversion):(i=(o=t.getChildContainer("SceneGraph")).header.version,s=o.header.conversion);else{if(!(d=t.getChildContainer("MAIN")).header&&(c=this.getEntryStreamer(d.tocEntry),d.unstreamHeaderUVR(c)))return null;i=d.header.version,s=d.header.conversion}else if(this.init(),(new Date).getTime(),(t=this.getRootContainer()).unstreamHeaderCGR(),t.header.version>=210042400&&(a=!0),gs){var o;a?(i=t.header.version,s=t.header.conversion):((o=t.getChildContainer("SceneGraph")).unstreamHeaderCGR(),i=o.header.version,s=o.header.conversion)}else{for(var p=this.getEntryStreamer(t.tocEntry),h=(p.readUncompressedInt(!1),p.readUncompressedInt(!1),p.readUncompressedInt(!1)),u=0;u<h;u++){p.readUncompressedInt(!1),p.readUncompressedInt(!1),p.readUnsignedShort(!1);var f=p.readUncompressedInt(!1);this.name=p.readUnicodeString(f/2)}var d=t.getChildContainer("MAIN"),c=this.getEntryStreamer(d.tocEntry);d.unstreamHeaderUVR(c),i=d.header.version,s=d.header.conversion}var l=t.getChildContainer("Applicative Containers");if(!l)return null;var v=l.getChildContainer(e);if(!v)return null;var m=v.getChildContainer("MainDataStream");if(!m)return null;var y=this.getBufferFromEntry(m.tocEntry);if(0==y.length)return null;switch(e){case"V4V5_FDT":var g=this.getEntryStreamer(m.tocEntry);gs||(g.bitBoolean=1,g.bitPacking=1,g.gasPacking=1),g.expandCGR=this.expand,g.version=i,g.conversion=s;var x=g.readCompressedInt(),B=g.readCompressedInt();n.oldSize=x,n.compressed=B,n.offset=g.getCurrentPosition(),g.skip(B),g.getBytesRemain()&&(g.readCompressedInt(),n.oldSize=g.readCompressedInt(),n.compressed=g.readCompressedInt(),n.offset=g.getCurrentPosition())}return(new Date).getTime(),{buffer:y,options:n}},this.open=function(e){var r=this.init();if(r&&r.error)return r;if(e&&(gs=0),!this.isV5)//!oldCGR) {
return console.log("warning cgr version not supported or corrupted file"),{error:"cgr version not supported or corrupted file"};l=!1,(new Date).getTime();var i=this.getRootContainer();if(i.unstreamHeaderCGR(),_=0,z=0,W=0,j=!1,nr={x:0,y:0,z:0},ar={x:0,y:0,z:0},s=!!t,xs=!1,i.header.version>=210042400){xs=!0,i.header.readUncompressedInt(),i.header.readUncompressedInt();var n=i.header.readUncompressedInt();if(i.header.skip(n),i.header.version>=210042410){if(i.header.readBoolean())switch(i.header.readUnsignedChar()){case G:break;case O:var a=i.header.readUnsignedChar();a&E&&(_=E),a&V&&(_=V),i.header.version>=210042415&&(a&D&&(z=D),a&k&&(W=k),a&L&&(W=L)),s=!0===t,!1===t&&(s=!1)}Bs=(new tr).unstream(i.header)}}var o=i.getChildContainer("Skeleton"),p=null,u=null;if(!gs&&o){var f=this.getEntryStreamer(i.tocEntry);f.conversion=!0,f.readUncompressedInt(!1),f.readUncompressedInt(!1);for(var d=f.readUncompressedInt(!1),c=0;c<d;c++){f.readUncompressedInt(!1),f.readUncompressedInt(!1),f.readUnsignedShort(!1);var v=f.readUncompressedInt(!1);this.name=f.readUnicodeString(v/2)}f.conversion=!1;var m=i.getChildContainer("MAIN"),y=this.getEntryStreamer(m.tocEntry);if(A=m.unstreamHeaderUVR(y))return A;var g=i.getChildContainer("Options"),x=this.getEntryStreamer(g.tocEntry);if(x.setContainer(i),x.readUnsignedChar()>=5&&x.readUnsignedChar(),!o)return null;(u=this.getEntryStreamer(o.tocEntry)).setContainer(i),u.version=m.header.version,u.conversion=m.header.conversion,u.bitBoolean=1,u.bitPacking=1,u.gasPacking=1,u.expandCGR=this.expand;var B=u.readClassName();p=u.getUnstreamer(B).unstream(u)}else{var A,I=i,b="SceneGraph";if(xs||(I=i.getChildContainer("SceneGraph"),b="MainDataStream"),A=I.unstreamHeaderCGR("SceneGraph"))return A;(u=I.getStreamerByName(b,xs)).expandCGR=this.expand,B=u.readClassName(),p=u.getUnstreamer(B).unstream(u)}return u.check(),1==h&&u.finalizeMergeDGs(),this.buildSceneGraph({axisSystems:u.axisSystems.getArray(),refPlanes:u.refPlanes.getArray(),arrows:u.arrows.getArray(),curvedPipes:u.curvedPipes.getArray(),canonicals:u.canonicals.getArray(),voxelReps:u.voxelReps.getArray(),texts:u.texts.getArray(),resource:u.textures.getArray(),materials:u.materials.getArray(),sgRep:u.sgRep,decorations:u.decorations.getConcatenatedBlocks(),reps:u.reps,rep:p,dgs:u.mergeDGs})},this.openSceneGraph=function(e,r,t){this.FTA=!0,l=!0,t&&(p=t.processText,u=t.withBlankingRep);var i=new As;i.setFromBuffer(e);var s=new ve(i);s.version=1101410,s.readBytes(12,[]);var n=s.readUnsignedChar();s.conversion=!n,s.version=s.readCompressedInt();var a=s.readClassName(),o=s.getUnstreamer(a).unstream(s);if(s.error&&r)return r(s.error),{reps:[],sceneGraph:null,resource:[],material:[],axisSystems:[],refPlanes:[],voxelReps:[],texts:[]};s.check();var h=this.buildSceneGraph({axisSystems:s.axisSystems.getArray(),curvedPipes:s.curvedPipes.getArray(),arrows:s.arrows.getArray(),canonicals:s.canonicals.getArray(),refPlanes:s.refPlanes.getArray(),voxelReps:s.voxelReps.getArray(),texts:s.texts.getArray(),resource:s.textures.getArray(),materials:s.materials.getArray(),sgRep:s.sgRep,decorations:s.decorations.getConcatenatedBlocks(),reps:s.reps,rep:o});return o.node.noShow&&this.withSceneGraph&&(h.sceneGraph.noShow=!0),this.withSceneGraph?h:{mesh:h.reps[0],resource:h.resource,material:h.material,axisSystems:h.axisSystems,curvedPipes:h.curvedPipes,canonicals:h.canonicals,refPlanes:h.refPlanes,voxelReps:h.voxelReps,texts:h.texts,excludeReps:h.reps[2]}},this.setThicknessTable=function(r){e.ThicknessTable=r},this.getBufferFromEntry=function(e){for(var r=0,t=e.blocReader.blocs,i=0;i<t.length;++i)r+=t[i].length;var s=new Uint8Array(r),n=0;for(i=0;i<t.length;++i)for(var a=t[i],o=0;o<a.length;++o)s[n]=F.buffer[a.offset+o],n++;return s},this.getRootContainer=function(){return N||((N=new vs(this,R.getRootTocEntry())).name="MAIN",N)},this.getStreamer=function(e,r){var t=R.getChildEntry(e,r);if(null==t)return null;for(var i=new As(F.clone()),s=0;s<t.blocReader.blocs.length;++s)i.addBloc(t.blocReader.blocs[s]);var n=new ve(i);return n.name=r,n},this.getEntryStreamer=function(e){for(var r=new As(F.clone()),t=0;t<e.blocReader.blocs.length;++t)r.addBloc(e.blocReader.blocs[t]);return new ve(r)},this.getChildContainer=function(e,r){var t=R.getChildEntry(e,r);if(t)return new vs(this,t)}}}),define("Formats/CGRFile",["DS/Formats/CGRFile","DS/DSMigration/DSMigration"],function(e,r){return r.deprecateModule("Formats/CGRFile"),e});