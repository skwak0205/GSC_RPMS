define("DS/ENOMadeFromUX/view/MBMFFacet",["UWA/Core","UWA/Class","UWA/Controls/Abstract","DS/PlatformAPI/PlatformAPI","DS/EditPropWidget/facets/Common/FacetsBase","DS/SpecGridView/SpecGridView","DS/XSRCommonComponents/service/CommandsService","DS/ENOMadeFromUX/utils/MBMFUtils","DS/XSRCommonComponents/utils/TypeUtils","DS/ENOMadeFromUX/service/MBMFServiceProvider","DS/ENOMadeFromUX/model/MBMFItemModel","DS/XSRCommonComponents/components/XSpecDnD/DragDropUtil","DS/ENOMadeFromUX/controller/ConnectMBMFFields","DS/XSRCommonComponents/utils/XspecEvents","DS/XSRCommonComponents/utils/RequestUtil","DS/XSRCommonComponents/utils/XSRSearch","DS/XSRCommonComponents/utils/Notification","DS/XSRCommonComponents/utils/GridCommonActionsManager","DS/XSRCommonComponents/utils/Utils","DS/XSRCommonComponents/utils/XSRMask","DS/XSRCommonComponents/utils/Constants","DS/XSRCommonComponents/service/XSpecsMenuBuilder","DS/XSRCommonComponents/service/XSpecsActionsFactory","DS/XSRCommonComponents/utils/ItemServiceProvider","text!DS/ENOMadeFromUX/assets/MBMFConfig/MBMFToolBarCommands.json","text!DS/ENOMadeFromUX/assets/MBMFConfig/MBMFColumnConfig.json","i18n!DS/ENOMadeFromUX/assets/nls/MadeFromUX","css!DS/ENOMadeFromUX/view/MBMFFacet.css"],function(e,t,o,i,n,s,a,r,d,c,M,l,m,p,u,h,g,f,F,b,v,B,C,I,S,y,N){"use strict";return t.extend(o,n,{init:function(t){if(this._parent(t),this.elements.container||(this.elements.container=e.createElement("div",{class:"xsr-mbmf"})),this.appCore=this.options.appContext,this.appId=t.appId,this.appCore.contextAppId=this.appId,void 0!==widget.data&&"ENXENG_AP"===widget.data.appId&&this.appCore.localStorage.setItem(v.VALUE_QUANTITY_VIEW,!0),this.itemID=t.itemId,this.itemModel=t.itemModel,this.itemTitle=this.itemModel?this.itemModel.getLabel():"",this.itemMaturity=this.itemModel?this.itemModel.getMaturity():"",this.appId!==v.XSR_APP_ID){this.modelEvents=new p,this.appCore.specViewerModelEvents=this.modelEvents,this.appCore.basicModelEvents=this.modelEvents,u.set3DSpaceURL().then(function(){u.setSecurityContext(),u.setCSRFToken(),F.prepareRawMaterialSubtypes(),F.prepareUOMTypes(),F.preparePhysicalProductSubtypes()}).catch(function(e){console.log("Error in setting 3DSpace URL")}),this.appCore.contextManager&&this.appCore.contextManager.getXENTreeDocument()&&this.appCore.contextManager.getXENTreeDocument().getSelectedNodes()&&(this.itemModel=this.appCore.contextManager.getXENTreeDocument().getSelectedNodes(),this.itemID=this.itemModel[0].getID(),this.itemTitle=this.itemModel[0].getLabel(),this.itemMaturity=this.itemModel[0].getMaturity(),this.extApp_SC=this.appCore.contextManager.getSecurityContext().SecurityContext,u.setCSRFToken(),this.firstLoad=!0);var o={};o.modelEvents=this.modelEvents,a.initialize(o),B.initialize(o),C.setOptions(o)}else this.modelEvents=this.appCore.specViewerModelEvents;this.basicModelEvents=this.appCore.basicModelEvents,this.currentTabKey=v.FACET_MBMF,this._MBMFSubscriptionList=[],this._subscribeEvents(),this.preferredView=void 0===widget.getValue("grid-preferred-view-"+this.currentTabKey)?v.GRID_VIEW:widget.getValue("grid-preferred-view-"+this.currentTabKey),this.MBMFService=new c(this.extApp_SC)},_renderEmptyOrManyMsg:function(e){this.mbmfContainer&&this.mbmfContainer.empty(),this.elements.container.empty();let t=u.getTouchMode(),o=UWA.createElement("div",{class:"xsr-message-container"});"Many"==e&&o.addContent(N.Message_TooManyItems),t&&o.addClassName("xsr-mobile-font"),o.inject(this.elements.container)},_renderNoSupportMsg:function(){this.mbmfContainer&&this.mbmfContainer.empty(),this.elements.container.empty();var e=new UWA.Element("div",{class:"xsr-make-from-info"});UWA.createElement("div",{class:"xsr-blocking-icon wux-ui-3ds wux-ui-3ds-3x wux-ui-3ds-block"}).inject(e),new UWA.Element("h4",{class:"make-from-info-msg",html:N.label_NotSupported}).inject(e);e.inject(this.elements.container)},updateFacet:function(){if(this.appId!==v.XSR_APP_ID)if(this.appCore.orgContextManager&&(this.appCore.contextManager=this.appCore.orgContextManager),this.appCore.contextManager&&this.appCore.contextManager.getXENTreeDocument()&&1===this.appCore.contextManager.getXENTreeDocument().getSelectedNodes().length){if(this.itemModel=this.appCore.contextManager.getXENTreeDocument().getSelectedNodes()[0],this.itemID=this.itemModel.getID(),this.itemTitle=this.itemModel.getLabel(),this.itemMaturity=this.itemModel.getMaturity(),!("function"==typeof this.itemModel.isEngineeringItem&&this.itemModel.isEngineeringItem())||d.isRawMaterial(this.itemModel.getType()))return void this._renderNoSupportMsg()}else if(this.appCore.contextManager&&this.appCore.contextManager.getXENTreeDocument()&&this.appCore.contextManager.getXENTreeDocument().getSelectedNodes().length>1)return void this._renderEmptyOrManyMsg("Many");!this.mbmfContainer||this.mbmfContainer&&this.mbmfContainer.getChildren()&&0===this.mbmfContainer.getChildren().length?this._buildView():this.drawMBMFNodes()},loadMBMFGrid:function(){var e=JSON.parse(S),t=r.getNLSLabels(e.actions),o=JSON.parse(y),i=r.getNLSLabels(o.columns),n={itemId:this.itemID,container:this.mbmfContainer,appCore:this.appCore,currentTabKey:this.currentTabKey,enableCrossWidgetFeature:!0,isColorized:!0,parentModel:this.itemModel,dvgOpts:{}};if(n.dvgOpts.rowDragEnabledFlag=!1,this.MBMFGrid=new s(n),this.appId!==v.XSR_APP_ID)for(var a=0;a<i.length;a++)"partNumber"!==i[a].dataIndex&&"ds6wg:revision"!==i[a].dataIndex&&"ds6w:status"!==i[a].dataIndex&&"ds6w:responsible"!==i[a].dataIndex||(i[a].typeRepresentation="string");this.MBMFGrid.setColumns(i),this.MBMFGrid.render(),this.MBMFGrid.setToolBarActions({actions:t}),this.MBMFGrid.toolbar.disableCommands(["removeitem"]),"Released"!=this.itemMaturity&&"Obsolete"!=this.itemMaturity||this.MBMFGrid.toolbar.disableCommands(["addMBMFItem","removeitem"])},_buildView:function(){var t=this;t.elements.container.empty(),t.mbmfContainer=e.createElement("div",{class:"mbmf_container"}).inject(t.elements.container),this.dnd=new l({modelEvents:this.modelEvents}),this.dnd.makeDroppable(t.mbmfContainer,"insertMbmfFacets"),t.appId===v.XSR_APP_ID?(t.loadMBMFGrid(),t.drawMBMFNodes()):t.appId!==v.XSR_APP_ID&&(t.firstLoad?u.set3DSpaceURL().then(function(){u.setSecurityContext(),u.setCSRFToken(),F.prepareRawMaterialSubtypes(),F.prepareUOMTypes(),F.preparePhysicalProductSubtypes(),setTimeout(function(){t.loadMBMFGrid(),t.drawMBMFNodes(),t.firstLoad=!1},1e3)}).catch(function(e){console.log("Error in setting 3DSpace URL")}):(t.loadMBMFGrid(),t.drawMBMFNodes()))},getColumnDef:function(e){return{dataIndex:e.dbName,text:e.nlsLabel,typeRepresentation:"string",editableFlag:!1,forbiddenCheck:!1,allowUnsafeHTMLContent:!1,autoRowHeightFlag:!1,exportFlag:!0,visibleFlag:!0,disabled:!0}},drawMBMFNodes:function(){this.getMBMFNodes(this.itemID),this.checkAndApplyGrouping()},getCoreMatDetails:function(e){for(var t=this,o=[],i=0;i<e.length;i++)o.push(e[i].getID());if(o&&o.length>0){var n={};n.references=o,n.with_partials=!0,(new I).fetchCoreMatDetails(n,e).then(function(o){if(o){for(var i=0;i<e.length;i++)for(const[t,a]of o.entries())if(t===e[i].getID()){var n=a.physicalid,s=(a.V_Name?a.V_Name:"")+" "+(a.revision?a.revision:"-");e[i].setCoreMat(s),e[i].setCoreMatId(n),e[i].updateOptions(e[i].options)}t.MBMFGrid.getTreeDocument().acceptChanges()}}).catch(function(e){g.displayNotification({eventID:"error",msg:e?e.message:N.Error_GetMatInfo}),b.unmaskLoader(t.mbmfContainer)})}},getMBMFNodes:function(e,t){var o=this;r.getMBMFDetails(e,void 0,o.appCore,void 0,void 0,this.extApp_SC).then(function(e){if(e&&e.length>0){o.MBMFGrid.toolbar.disableCommands(["addMBMFItem"]);var i=[],n=new Map;o.MBMFGrid.getTreeDocument().empty(),o.MBMFGrid.getTreeDocument().acceptChanges();for(var s=0;s<e.length;s++){var a=new M({ignoreselectevent:!0,fromfacet:"MBMFFacet"}).set(e[s]);a.currentTabKey=o.currentTabKey,a.appCore=o.appCore,e[s].MakeFrom_extensions.forEach(e=>{e.attributes.forEach(t=>{let o=a.getAttributeObject(t,e.dbName,e.nlsLabel);a.setAttributeToMap(o),n.set(o.dbName,o)})}),a.parentNode=o.itemModel,o._addNewNode(a,"MBMF"),i.push(a)}o.getCoreMatDetails(i);let d=7;if(n.forEach(e=>{o.MBMFGrid.addColumn(o.getColumnDef(e),d),d++}),o.MBMFGrid.getTreeDocument().acceptChanges(),o.appCore.MBMFDialog&&o.appCore.MBMFDialog.closeDialog(),t)if(o.appId===v.XSR_APP_ID)o.modelEvents.publish({event:"MBMFFacet-to-bom-commute-add-node-success",data:{mbmfInfo:e}});else{var r=[];r.push(a),o.publishMBMFUpdateEvent("add",r)}}else o.MBMFGrid.displayEmptyObjectView(),o.MBMFGrid.toolbar.enableCommands(["addMBMFItem"]),o.appId!==v.XSR_APP_ID&&(o.MBMFGrid.getTreeDocument().empty(),o.MBMFGrid.getTreeDocument().acceptChanges())}).catch(function(e){g.displayNotification({eventID:"error",msg:e?e.result.message:N.Error_Get_MBMF}),b.unmaskLoader(o.mbmfContainer)})},_addNewNode:function(e,t){"MBMF"===t&&this.MBMFGrid.addRootNodes(e,!1),this.MBMFGrid.getTreeDocument().acceptChanges(),this.MBMFGrid.updateGroupByIfAny()},_subscribeEvents:function(){var e=this;this._MBMFSubscriptionList.push(this.modelEvents.subscribe({event:"xsr-load-mask"},function(e){b.maskLoader(widget.body,N.WAIT)})),this._MBMFSubscriptionList.push(this.modelEvents.subscribe({event:"xsr-unload-mask"},function(e){b.unmaskLoader(widget.body)})),this._MBMFSubscriptionList.push(this.modelEvents.subscribe({event:"grid-toolbar-action-click-MBMFFacet"},function(t){if(t)switch(t){case"addMBMFItem":!async function(t){const o=await h._getSearchCriteria(e.appCore.immersiveFrame,(e.appCore.immersiveFrame?e.appCore.immersiveFrame.elements.container:document.body).getElementsByClassName("fonticon-part-made-from")[0]);if("addExistingMBMF"===t){var i=e.MBMFGrid.getTreeDocument().getSelectedNodes();if(i&&i.length>0&&d.isRawMaterial(i[0].getTypeActualName()))return void r.getMsgAddNodeOnRM();if(i&&i.length>0&&i[0].getMadeFrom())return void r.getMsgAddNodeOnMBMF();var n={allowedTypes:["VPMReference"],role:"",subType:"",criteria:o,precondition:'NOT [current]:"OBSOLETE"',in_apps_callback:function(t){if(t&&1===t.length){var o={};o.appCore=e.appCore,e.MBMFGrid.getTreeDocument().getSelectedNodes();var i=e.itemID;if(d.isRawMaterial(t[0]["ds6w:type_value"]))o.parentId=i,o.toBeAddedMBMFTitle=t[0]["ds6w:label"],o.toBeAddedMBMFId=t[0].id,o.parentOfMBMFItem=i,o.container=e.elements.container,e.connectOptions=o,o.createCloseAction=o.createAction=function(t){e.getMBMFNodes(t,!0),e.checkAndApplyGrouping()},new m(o,e.extApp_SC);else{var n={madeFromPID:t[0].id};e.MBMFService.connectMBMFItem(n,i).then(function(t){if(t&&t.success&&200===t.statusCode){e.getMBMFNodes(i,!0);var o=t.result.message;g.displayNotification({eventID:"success",msg:o||N.Success_ConnectMBMF})}}).catch(function(t){g.displayNotification({eventID:"error",msg:t.result.message}),b.unmaskLoader(e.mbmfContainer)})}}},multiSel:!1,excludeList:e.itemID?[e.itemID]:[]};new h(n).launchSearch(n)}}("addExistingMBMF");break;case"removeitem":!function(o){var i=e.MBMFGrid.getTreeDocument().getSelectedNodes();if(i&&i.length>0)if(e.appId===v.XSR_APP_ID&&"remove"===o)t="UPSAuthUnparent",C.launchUPSUnparent({data:i});else for(var n=function(t,o,i){(new c).disconnectMBMFItem(t.getParentId(),t.getID()).then(function(n){n&&n.success?(t.parentNodeModel&&t.parentNodeModel.getMBMFChild()&&t.parentNodeModel.setMBMFChild(null),e._removeNodes(t),o===i-1&&g.displayNotification({eventID:"success",msg:N.RemoveMBMFSuccess})):g.displayNotification({eventID:"error",msg:N.RemoveMBMFFailed})}).catch(function(e){var t="";e&&!e.success&&e.result&&(t=e.result.message),g.displayNotification({eventID:"error",msg:t})})},s=0;s<i.length;s++)n(i[s],s,i.length);else g.displayNotification({eventID:"error",msg:N.NoItemSelected})}("remove");break;case"Export":e._exportGrid();break;case"personalize":e._personalize()}})),this.platFormSubscrpition=i.subscribe("DS/PADUtils/PADCommandProxy/refresh",function(t){t.data.authored&&t.data.authored.modified&&t.data.authored.modified.forEach(function(t){var o;UWA.is(t,"object")?o=t.physicalid:UWA.is(t,"string")&&(o=t),e.syncNodeBasedOnID(o,!0),e.MBMFService.fetchItemInfo([e.itemID]).then(function(t){let o=(new M).set(t[0]).getMaturity();"Released"!=o&&"Obsolete"!=o||e.MBMFGrid.toolbar.disableCommands(["addMBMFItem","removeitem"])})})}),this.platFormXENSubscrpition=i.subscribe("XEN/PUBLIC_EVENT/ENGINEERING_ITEM/PART_NUMBER_UPDATED",function(t){if(t&&Array.isArray(t.references))for(var o=t.references,i=0;i<o.length;i++){var n=o[i].physicalid;e.syncNodeBasedOnID(n),"success"===t.status&&e._updateNodeOnBOMTab(null,"update",{attribute:"partNumber",value:t.references[0].partNumber},n)}}),this._MBMFSubscriptionList.push(this.modelEvents.subscribe({event:"xsr-add-item-on-drop-MakeFrom"},function(t){if(t.length>0){var o=[];t.forEach(function(t){var i=e.MBMFService.fetchItemInfo([t.id]);o.push(i)})}Promise.all(o).then(function(t){if("object"==typeof t&&t.length>0){var o={};o.appCore=e.appCore;var i=e.itemID;if(d.isRawMaterial(t[0][0]["ds6w:type_value"])){o.parentId=i,o.toBeAddedMBMFTitle=t[0][0]["ds6w:label"],o.toBeAddedMBMFId=t[0][0].physicalid,o.parentOfMBMFItem=i,o.container=e.elements.container,e.connectOptions=o,o.createCloseAction=o.createAction=function(t){e.getMBMFNodes(t,!0),e.checkAndApplyGrouping()};new m(o,e.extApp_SC)}else{var n={madeFromPID:t[0][0].physicalid};e.MBMFService.connectMBMFItem(n,i).then(function(t){if(t&&t.success&&200===t.statusCode){e.getMBMFNodes(i,!0);var o=t.result.message;g.displayNotification({eventID:"success",msg:o||N.Success_ConnectMBMF})}}).catch(function(t){g.displayNotification({eventID:"error",msg:t.result.message}),b.unmaskLoader(e.mbmfContainer)})}}})})),this._MBMFSubscriptionList.push(this.modelEvents.subscribe({event:"grid-list-remove-node-successful-MBMFFacet"},function(t){e._removeNodes(t)})),this._MBMFSubscriptionList.push(this.modelEvents.subscribe({event:v.UPDATE_ITEMVIEW_TOOLBOOR_COUNT},function(t){0==t?e.MBMFGrid.toolbar.disableCommands(["removeitem"]):e.MBMFGrid.toolbar.enableCommands(["removeitem"])})),this._MBMFSubscriptionList.push(this.modelEvents.subscribe({event:"xsr-slide-in-facet-destroy-updated"},function(t){e.destroyComponent()})),this._MBMFSubscriptionList.push(this.modelEvents.subscribe({event:"grid_action_context_menu-MBMFFacet"},function(t){var o=e.MBMFGrid.getTreeDocument().getSelectedNodes();t.gridInstance=e.MBMFGrid;var i=e.appId===v.XSR_APP_ID?["Information","OpenSpecificationView","DeleteItem"]:["Information","OpenSpecificationView","OpenWith","ManageFiles","SetPartNumber","UPSAuthUnparent","RemoveChild","VersionExplorer","DuplicateItem","CompareWith","RelatedObjects","MaturityGraph","ActionBar_ChangeOwner","MultiOwnership","DownloadReport","DownloadDocument","Subscriptions","DeleteItem","addExisting","RegenerateReport","Close"];if(e.appId===v.XSR_APP_ID||void 0!==widget.data&&"ENXENG_AP"===widget.data.appId)if(o&&o.length>1)(0,f.getMultiActionMenu)(t,i);else if(o&&(0===o.length||1===o.length)){(0,f.getActionMenu)(t,i)}})),this._MBMFSubscriptionList.push(this.modelEvents.subscribe({event:"grid-item-toolbar-mutiactions-list-MBMFFacet"},function(t){if(t&&(t.nodeModel=e.MBMFGrid.getTreeDocument()),t.gridInstance=e.MBMFGrid,e.appId===v.XSR_APP_ID){(0,f.getToolbarActionMenu)(t,["Information","OpenSpecificationView","DeleteItem"])}})),this._MBMFSubscriptionList.push(this.modelEvents.subscribe({event:"grid-cell-value-update-MBMFFacet"},function(t){var o=t.newValue,i=t.oldValue,n=t.nodeModel.getID();b.maskLoader(e.mbmfContainer,N.UpdatingLoader);var s=function(t,o){"success"===t?(e.MBMFGrid.getTreeDocument().acceptChanges(),e.modelEvents.publish({event:"xsr-hide-toolbar-reset-command-"+e.currentTabKey})):e.modelEvents.publish({event:"xsr-show-toolbar-reset-command-"+e.currentTabKey}),g.displayNotification({eventID:t,msg:o}),b.unmaskLoader(e.mbmfContainer)},a=function(o,i,a){e.MBMFGrid.unselectAll(),t.nodeModel.select(),e.MBMFService.updateAndSyncAttributes(n,[{attribute:o,value:i}],t.nodeModel,a).then(function(t){e.syncInstanceModels(t),e._updateNodeOnBOMTab(t,"update",{attribute:o,value:i}),s("success",N.Notify_Updated)}).catch(function(t){b.unmaskLoader(e.mbmfContainer),s("error",N.Failure_Update)})};switch(t.dataIndex){case"ds6w:description":a(v.ITEM_DESCRIPTION,o,"bus");break;case"tree":var c=v.ITEM_V_NAME;o?a(c,o,"bus"):s("error",N.replace(N.get(N.Error_EmptyTitle),{columnName:N.label_Title}));break;case"asNeeded":(M={}).uomType=t.nodeModel.getUOMType(),M.quantity=t.nodeModel.getQuantityMBMF(),M.asRequired=o,r.getMBMFUpdateService(M,t.nodeModel).then(function(i){i&&i.success?(t.nodeModel.setasNeeded(o),e.MBMFGrid.unselectAll(),t.nodeModel.select(),t.nodeModel.sync(),t.nodeModel.acceptChanges(),e._updateNodeOnBOMTab(t.nodeModel,"update",{attribute:"asNeeded",value:o})):(g.displayNotification({eventID:"error",msg:i.result.message}),t.nodeModel.setasNeeded(!1)),b.unmaskLoader(e.mbmfContainer)}).catch(function(t){g.displayNotification({eventID:"error",msg:t.result.message}),b.unmaskLoader(e.mbmfContainer)});break;case"quantity":(M={}).uomType=t.nodeModel.getUOMType(),t.nodeModel.getUOMUnit()?M.quantity=o+" "+t.nodeModel.getUOMUnit():M.quantity=o+"",M.asRequired=t.nodeModel.getasNeeded(),r.getMBMFUpdateService(M,t.nodeModel).then(function(n){n&&n.success?(e.syncNodePostUpdate(t,o),t.nodeModel.setQuantityMBMF(o+" "+t.nodeModel.getUOMUnit()),e._updateNodeOnBOMTab(t.nodeModel,"update",{attribute:"quantity",value:o}),e._updateNodeOnBOMTab(t.nodeModel,"update",{attribute:"quantityMBMF",value:o+" "+t.nodeModel.getUOMUnit()})):(g.displayNotification({eventID:"error",msg:n.result.message}),e.syncNodePostUpdate(t,i)),b.unmaskLoader(e.mbmfContainer)}).catch(function(t){g.displayNotification({eventID:"error",msg:t.result.message}),b.unmaskLoader(e.mbmfContainer)});break;case"uom":var M;(M={}).uomType=t.nodeModel.getUOMType();var l=Object.entries(d.getUOMUnits(t.nodeModel.getUOMType()));if(l){var m=new Map;l.forEach(function(e){m.set(e[1],e[0])})}o&&(M.quantity=t.nodeModel.options.grid.quantity+" "+m.get(o)),M.asRequired=t.nodeModel.getasNeeded(),r.getMBMFUpdateService(M,t.nodeModel).then(function(n){n&&n.success?(t.nodeModel.setUnitOfMeasure(o),t.nodeModel.setQuantityUOM(m.get(o)),t.nodeModel.setQuantityMBMF(t.nodeModel.options.grid.quantity+" "+m.get(o)),e.MBMFGrid.unselectAll(),t.nodeModel.select(),t.nodeModel.sync(),t.nodeModel.acceptChanges(),e._updateNodeOnBOMTab(t.nodeModel,"update",{attribute:"uom",value:o}),e._updateNodeOnBOMTab(t.nodeModel,"update",{attribute:"quantityUOM",value:m.get(o)}),e._updateNodeOnBOMTab(t.nodeModel,"update",{attribute:"quantityMBMF",value:t.nodeModel.options.grid.quantity+" "+m.get(o)})):(g.displayNotification({eventID:"error",msg:n.result.message}),e.syncNodePostUpdate(t,i)),b.unmaskLoader(e.mbmfContainer)}).catch(function(t){g.displayNotification({eventID:"error",msg:t.result.message}),b.unmaskLoader(e.mbmfContainer)});break;default:b.unmaskLoader(e.mbmfContainer)}})),this._MBMFSubscriptionList.push(this.modelEvents.subscribe({event:"bom-to-MBMFFacet-commute-add-node-success"},function(t){if(t&&e.appId===v.XSR_APP_ID&&t.mbmfInfo){var o=(new M).set(t.mbmfInfo[0]);o.currentTabKey=e.currentTabKey,o.appCore=e.appCore,e._addNewNode(o,"MBMF"),e.MBMFGrid.getTreeDocument().acceptChanges(),e._removeNodes(nodeArray)}}))},syncNodePostUpdate:function(e,t){e.nodeModel.setInstanceCount(t),this.MBMFGrid.unselectAll(),e.nodeModel.select(),e.nodeModel.sync(),e.nodeModel.acceptChanges()},syncNodeBasedOnID:function(e,t){var o=this;o.MBMFGrid.getTreeDocument().getSelectedNodes().forEach(function(i){i.getID()===e&&o.MBMFService.fetchItemInfo([e]).then(function(n){n&&Array.isArray(n)?i.set(n[0]):i.set(n),o.syncInstanceModels(i),t&&o._updateNodeOnBOMTab(i,"invokeSyncNodeBasedOnID",null,e)}).catch(function(e){console.log(e)})})},syncInstanceModels:function(e){let t=this.MBMFGrid.getGridNodes();t&&UWA.is(t,"array")&&t.forEach(function(t){t.getID()===e.getID()&&t.getMBMFReferenceName()!=e.getMBMFReferenceName()&&t.syncInstances(e)}),this.MBMFGrid.getTreeDocument().acceptChanges()},_removeNodes:function(e){this.MBMFGrid.removeRootNodes(e),0==this.MBMFGrid.gridTreeDocument.model.getChildren().length&&this.MBMFGrid.toolbar.enableCommands(["addMBMFItem"]),this._updateNodeOnBOMTab(e,"remove")},_updateNodeOnBOMTab:function(e,t,o,i){if("invokeSyncNodeBasedOnID"===t)this.modelEvents.publish({event:"MBMFFacet-update-node-successful",data:{nodeToBeUpdated:e,mode:t,nodeID:i}});else{if((s=this.itemModel?this.itemModel.getChildren():void 0)&&s.length>0)for(var n=0;n<s.length;n++){(e?e.getID():i)===s[n].getID()&&!0&&this.appId===v.XSR_APP_ID&&this.modelEvents.publish({event:"MBMFFacet-update-node-successful",data:{nodeToBeUpdated:s,mode:t,updateAttr:o}})}else if(this.appCore.MBMFAtRootLevel&&this.appCore.MBMFAtRootLevel.NodeAtRootLevel){var s=[];if(!this.appCore.MBMFAtRootLevel.MBMFModel&&this.appCore.MBMFAtRootLevel.NodesToBeUpdated&&this.appCore.MBMFAtRootLevel.NodesToBeUpdated.length>0){var a=this.appCore.MBMFAtRootLevel.NodesToBeUpdated;for(n=0;n<a.length;n++)e&&a[n].getID()===e.getID()&&s.push(a[n])}else this.appCore.MBMFAtRootLevel.MBMFModel&&(s=[this.appCore.MBMFAtRootLevel.MBMFModel]);this.appId===v.XSR_APP_ID&&this.modelEvents.publish({event:"MBMFFacet-update-node-successful",data:{nodeToBeUpdated:s,mode:t,updateAttr:o}})}if(this.appId!==v.XSR_APP_ID){var r=[];r.push(e),this.publishMBMFUpdateEvent(t,r)}}},createNodeFromId:function(e){this.MBMFGrid.getTreeDocument().getSelectedNodes();if(e)return this.getMBMFNodes(e,!0)},publishMBMFUpdateEvent:function(e,t){var o=[];if(Array.isArray(t))for(var n=0;n<t.length;n++){var s={};s.actionMode=e,s.details=t[n]._options.grid,o.push(s)}i.publish("XSR/PUBLIC_EVENT/MAKE_FROM_UPDATE",o)},_exportGrid:function(){var e=this.itemTitle+"_"+this.itemMaturity+"_"+N.label_MakeFrom_Export;this.MBMFGrid.exportGrid(e)},_personalize:function(){this.MBMFGrid.personalize()},checkAndApplyGrouping:function(){let e=this,t=e.MBMFGrid.getGroupByColumns();t?e.MBMFGrid.checkAndUpdatePersistency(t):e.MBMFGrid.setGroupByColumns(void 0)},destroyComponent:function(){this.elements.container.destroy(),this.MBMFGrid.destroy(),this._MBMFSubscriptionList&&this.modelEvents.unsubscribeList(this._MBMFSubscriptionList),this.platFormSubscrpition&&i.unsubscribe(this.platFormSubscrpition),this.platFormXENSubscrpition&&i.unsubscribe(this.platFormXENSubscrpition)}})});