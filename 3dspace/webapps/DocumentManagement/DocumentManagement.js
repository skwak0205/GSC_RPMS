define("DS/DocumentManagement/DocumentFoundationAjax",["UWA/Core","DS/WAFData/WAFData","DS/PlatformAPI/PlatformAPI","i18n!DS/DocumentManagement/assets/nls/DocumentManagementNLS"],function(e,t,n,a){"use strict";var i=["nameNotUnique"],r={widgetization:"ENOVIA_Application_Widget",getParams:function(){var e="";if(this.tenant&&this.tenant.length>0&&(e+="&tenant="+this.tenant),this.rows&&this.rows.length>0&&(e+="&e6w-objLimit="+this.rows),this.language&&this.language.length>0){var t=this.language;e+="&e6w-lang="+(t="zh"===t?"zh_CN":t)}this.timezone&&(e+="&e6w-timezone="+this.timezone);var n=Object.prototype.hasOwnProperty,a=this.preferences;for(var i in a)n.call(a,i)&&(e+="&"+i+"="+a[i]);return this.params&&""!==this.params&&(e+="&"+this.params),""!==e&&(e=e.substring(1)),e},getParamsAsJSON:function(){var e={};this.tenant&&this.tenant.length>0&&(e.tenant=this.tenant),this.space&&this.space.length>0&&(e.SecurityContext=this.space),this.rows&&this.rows.length>0&&(e["e6w-objLimit"]=this.rows),this.language&&this.language.length>0&&(e["e6w-lang"]=this.language),this.timezone&&(e["e6w-timezone"]=this.timezone);var t=Object.prototype.hasOwnProperty,n=this.preferences;for(var a in n)t.call(n,a)&&(e[a]=n[a]);return e},setupEnoviaServer:function(){var e,t,a,i,o;window.widget?(e=window.widget.getUrl(),t=window.widget.getUrl().match(/[?&]runYourApp=([^&]*)?/),a=n.getApplicationConfiguration("app.urls.myapps"),e=e.substring(0,e.indexOf("/webapps")),i=window.widget.lang,o=window.widget.getValue("showSpace")||window.widget.getValue("widgetName")===r.widgetization||"false",window.widget.setValue("showSpace",o)):(e=window.location.origin,o=""),a&&!t||(a=e),window.WidgetConstants={str:{}};var s=(new Date).getTimezoneOffset(),l=n.getUser();l&&l.login&&(l=l.login),window.enoviaServer={params:"",sRealURL:e,showSpace:o,objectId:"",widgetId:"",widgetName:"",taggerContextId:"auto",appName:"",tenant:"",space:null,rows:null,preferences:{},storageUrl:a,language:i,timezone:s,_getUrl:function(){return this.storageUrl||this.sRealURL},getParams:r.getParams,getParamsAsJSON:r.getParamsAsJSON,computeUrl:function(e){return this._getUrl()+e},user:l},window.enoviaServer.storageUrl=window.enoviaServer.storageUrl.replace(":443","")},calculateFinalUrl:function(t,n){var a=t;if(e.Utils.parseUrl(t).protocol)return a;a=window.enoviaServer.computeUrl(a),a+=-1===a.indexOf("?")?"?":"&";var i=window.enoviaServer.getParams();return i&&i.length>0&&!n?a+=i:a+="tenant="+window.enoviaServer.tenant,a},ajaxRequest:function(n,o){var s=r.calculateFinalUrl(n.url,o),l=e.clone(n.headers||{},!1);!l["Accept-Language"]&&window.widget&&window.widget.lang&&(l["Accept-Language"]=window.widget.lang);var c=window.enoviaServer.space;!n.noSecurityContext&&!l.SecurityContext&&c&&c.length>0&&(l.SecurityContext=encodeURIComponent(c));var u=n.onFailure||function(e,t){var r,o=t||{};if(!1!==o.success||!o.error){var s=o&&o.error&&o.error.errorCode;i.includes(s)?o.error=(r="FileManagement.UploadFail."+s,a.get(r)):o={error:"Network Error: Unable to load widget due to network or authentication error.",errorMsg:e&&e.message}}n.callback.call(this,o)},d=n.onTimeout||function(){n.callback.call(this,{error:"Network Error: Unable to load widget due to timeout error."})},f=n.onCancel||function(){n.callback.call(this,{error:"Application Error: Request canceled."})},p=t.authenticatedRequest(s,{method:n.type,type:n.dataType,proxy:"passport",timeout:5e5,cache:3600,data:n.data,onComplete:n.callback,onFailure:u,onCancel:f,onTimeout:d,headers:l});return p=p||{cancel:Function.prototype}},_newTempId:function(){return"temp_"+(new Date).getTime()+Math.floor(1e4*Math.random())}};return r}),define("DS/DocumentManagement/IndependentServiceBase",["UWA/Core","UWA/Class","UWA/Utils","DS/DocumentManagement/DocumentFoundationAjax"],function(e,t,n,a){"use strict";var i;return t.extend({_deleteObject:function(t,n){var i=this,r=e.clone(n||{},!1),o=e.clone(r.additionalHeaders||{},!1);o["content-type"]="application/json",r.requestType="delete";var s=this._prepareService(this._deleteObject.bind(this,t,n),r);return s||a.ajaxRequest({url:t,type:"delete",dataType:"json",data:JSON.stringify({csrf:this.getCsrf(r.tenantUrl)}),callback:function(t){t&&t.csrf&&i.setCsrf(t.csrf,r.tenantUrl),t&&t.success&&e.is(n.onComplete,"function")?n.onComplete(t,n):e.is(n.onFailure,"function")&&n.onFailure(t)},headers:o})},_deleteRootObject:function(e,t){return this._deleteObject(this.SERVICE_ROOT_URL+e,t)},_getObjects:function(t,n){var i=this,r=e.clone(n||{},!1),o=e.clone(r.additionalHeaders||{},!1);o["Content-Type"]="application/x-www-form-urlencoded",r.requestType="get",r.csrf=r.csrf||"notNeeded",this._prepareService(this._getObjects.bind(this,t,n),r),a.ajaxRequest({url:(r.tenantUrl||"")+(this.SERVICE_ROOT_URL||"")+(r.additionalURLParams?"?"+r.additionalURLParams:""),type:"post",dataType:"json",data:"$ids="+t.join(),noSecurityContext:r.noSecurityContext,callback:function(t){t&&t.csrf&&i.setCsrf(t.csrf,r.tenantUrl),t&&t.success&&e.is(n.onComplete,"function")?n.onComplete(t,n):e.is(n.onFailure,"function")&&n.onFailure(t)},headers:o})},_prepareService:function(e,t){var n;window.isIFWE=!0;var i=t||{};if(window.enoviaServer||a.setupEnoviaServer(),i.tenant&&(enoviaServer.tenant=i.tenant),i.securityContext){var r=i.securityContext;0!==r.indexOf("ctx::")&&(r="ctx::"+r),enoviaServer.space=r}return i.tenantUrl&&!i.readOnlyStorageURl&&(enoviaServer.storageUrl=i.tenantUrl),this.getCsrf(i.tenantUrl)&&!i.csrf||(i.csrf?"notNeeded"!==i.csrf&&this.setCsrf(i.csrf,i.tenantUrl):n=this._getCsrf(e,t)),n},_handleTicket:function(t,n){var a=this;if(t&&t.success){var i=t.data[0].dataelements;this.setCsrf(t.csrf,n&&n.tenantUrl);var r=e.clone(n||{},!1),o=r.onComplete;r.onComplete=function(t,n){var i=e.clone(n||{},!1);i.onComplete=o,a._handleFCSReceipt(t,i)},r=e.extend(r,i),a._checkinToFCS(r)}else e.is(n&&n.onFailure,"function")&&n.onFailure(t)},_getCsrf:function(e,t){var n=this,i={url:"/resources/v1/application/E6WFoundation/CSRF",type:"get",dataType:"json",callback:function(a){a&&a.csrf&&(n.setCsrf(a.csrf,t&&t.tenantUrl),e())},headers:{"content-type":"application/json"}};return a.ajaxRequest(i)},getCsrf:function(e){var t=e||enoviaServer.storageUrl;return this.csrf&&this.csrf[t]},setCsrf:function(e,t){var n=t||enoviaServer.storageUrl;return this.csrf=this.csrf||{},this.csrf[n]=e},_checkinToFCS:function(t){var n=t||{},a=n.ticketURL,i=this._getFCSFormData(n),r=new XMLHttpRequest;r.upload.onprogress=n.onProgress,r.open("POST",a,!0);var o=function(){e.is(n.onFailure,"function")&&n.onFailure(r.responseText,n)};return r.onload=function(){200===r.status?n.onComplete(r.responseText,n):o()},r.onabort=o,r.onerror=o,r.ontimeout=o,r.send(i),r},_getFCSFormData:function(e){var t=(e=e||{}).fileInfo||e.documentInfo&&e.documentInfo.fileInfo,n=t&&t.file,a=t&&t.fileName,i=new FormData;return i.append(e.ticketparamname,e.ticket),i.append("file_0",n,a),i},downloadWithPost:function(t,a){var r=document;if(n.Client.Platform.ios&&(void 0!==i&&i.isInjected()||((i=e.createElement("iframe")).style.width=0,i.style.height=0,i.style.display="none",i.inject(widget.body)),i.src=require.toUrl("DS/DocumentManagement/assets/blankForm.html"),r=i.contentDocument),e.is(t,"string")){var o=n.parseUrl(t),s=o.query.length?n.parseQuery(o.query):{};a&&a.notAsAttachment||(s.__fcs__attachment=!0),delete o.query;var l=n.composeUrl(o),c=r.createElement("form");c.style.display="none",c.method="POST",c.action=l,Object.keys(s).forEach(function(e){var t=r.createElement("input");t.setAttribute("name",e),t.setAttribute("value",s[e]),c.appendChild(t)}),r.body.appendChild(c),this.submitForm(c),r.body.removeChild(c)}a.onComplete&&a.onComplete(t,a)},submitForm:function(e){return e.submit()},_handleFCSReceipt:function(){}})}),define("DS/DocumentManagement/DriveDocumentManagement",["UWA/Core","DS/DocumentManagement/DocumentFoundationAjax","DS/DocumentManagement/IndependentServiceBase"],function(e,t,n){"use strict";var a="/resources/3ddrive/v1/bos/",i=a+"ticket",r=new(n.extend({_prepareService:function(t,n){var a=e.clone(n||{},!1);a.readOnlyStorageURl=!0,this._parent(t,a)},createDocument:function(t,n){var a=e.clone(n||{},!1);a.create=!0,a.driveFolderId=t.driveFolderId,this.modifyDocument(t,a)},getDocuments:function(n,i){var r,o=e.clone(i||{},!1);if(n){var s=e.clone(o.additionalHeaders||{},!1);s["content-type"]="application/json";var l={url:o.tenantUrl+a+n+"?tenant="+o.tenant,type:"get",dataType:"json",noSecurityContext:!0,callback:function(t){t&&t.id?e.is(o.onComplete,"function")&&o.onComplete(t):e.is(o&&o.onFailure,"function")&&o.onFailure()},headers:s};r=t.ajaxRequest(l)}return r},getFileUrl:function(n,i){var r=e.clone(i||{},!1);if(n){var o=e.clone(r.additionalHeaders||{},!1);return o["content-type"]="application/json",new Promise(function(e,i){t.ajaxRequest({url:r.tenantUrl+a+n+"/fileurl?tenant="+r.tenant,type:"get",dataType:"json",noSecurityContext:!0,callback:function(t){t&&t.url?e(t.url):i(t)},headers:o})})}},downloadDocument:function(n,i){var r,o=this,s=e.clone(i||{},!1);if(n){var l=e.clone(s.additionalHeaders||{},!1);l["content-type"]="application/json";var c={url:s.tenantUrl+a+n+"/download?tenant="+i.tenant,type:"get",dataType:"json",noSecurityContext:!0,callback:function(t){t&&t.url?s.autoDownload?o.downloadWithPost(t.url,s):e.is(s.onComplete,"function")&&s.onComplete(t.url,s):e.is(s&&s.onFailure,"function")&&s.onFailure(t)},headers:l};r=t.ajaxRequest(c)}return r},modifyDocument:function(n,a){var r,o=e.clone(a||{},!1),s=this;if(n&&n.fileInfo&&n.fileInfo.file){var l=e.clone(o.additionalHeaders||{},!1);l["content-type"]="application/json";var c={url:o.tenantUrl+i+"?tenant="+a.tenant,type:"get",dataType:"json",noSecurityContext:!0,callback:function(t,a){if(t.ticket){var i=a["x-ds-csrftoken"],r=e.clone(n.fileInfo||{},!1);r.fileName=n.fileInfo.file.name;var l={csrf:i,fileInfo:r,docId:n.id,ticket:t.ticket,ticketparamname:t.jobticket,ticketURL:t.actionurl};s._handleTicket(l,o)}else e.is(o&&o.onFailure,"function")&&o.onFailure(t)},headers:l};r=t.ajaxRequest(c)}return r},_handleTicket:function(t,n){var a=this,i=e.clone(n||{},!1),r=i.onComplete;i.onComplete=function(n,i){var o=e.clone(i||{},!1);o.onComplete=r,t.fcsReceipt=n.trim(),a._handleFCSReceipt(t,o)},a._checkinToFCS(e.merge(i,t))},_getFCSFormData:function(){var e=this._parent.apply(this,arguments);return e.append("__fcs__nohtml",!0),e},_handleFCSReceipt:function(n,i){var r,o,s=e.clone(i||{},!1),l={title:n.fileInfo.file.name,receipt:n.fcsReceipt};s.create?(o=s.driveFolderId+"/contents",l.type="DriveFile",r="post"):(o=n.docId,r="put");var c=s.tenantUrl+a+o+"?tenant="+i.tenant,u=e.clone(s.additionalHeaders||{},!1);return u["Content-Type"]="application/json",u["X-DS-CSRFTOKEN"]=n.csrf,t.ajaxRequest({url:c,type:r,dataType:"json",data:JSON.stringify(l),noSecurityContext:!0,callback:function(t){t&&t.id&&e.is(s.onComplete,"function")?s.onComplete(t):e.is(s.onFailure,"function")&&s.onFailure(t)},headers:u})},getNewBlobFileWithOldName:function(e,t){var n=t.get("title");return(e=new Blob([e],{type:e.type})).name=n,e},getFolders:function(n){var a=e.clone(n||{},!1),r=this,o=e.clone(a.additionalHeaders||{},!1);o["content-type"]="application/json";var s={url:a.tenantUrl+i+"?tenant="+a.tenant,type:"get",dataType:"json",noSecurityContext:!0,callback:function(t,n){if(t){var i={csrf:n["x-ds-csrftoken"],ticket:t.ticket,ticketparamname:t.jobticket,ticketURL:t.actionurl};r._handleTicketAndGetFoldersList(i,a)}else e.is(a&&a.onFailure,"function")&&a.onFailure(t)},headers:o};return t.ajaxRequest(s)},_handleTicketAndGetFoldersList:function(n,i){var r=e.clone(i||{},!1),o=e.clone(r.additionalHeaders||{},!1);o["content-type"]="application/json",o["X-DS-CSRFTOKEN"]=n.csrf;var s={url:r.tenantUrl+a+"DSROOT/contents?tenant="+r.tenant,type:"get",dataType:"json",callback:function(t){t?r.callback(t):e.is(r&&r.onFailure,"function")&&r.onFailure(t)},headers:o};return t.ajaxRequest(s)}}));return r.getObjects=r.getDocuments,r.TICKET_URL=i,r.URL=a,r.TENANT_SUFFIX="?tenant=",r}),define("DS/DocumentManagement/ObjectInfoService",["UWA/Core","DS/DocumentManagement/IndependentServiceBase"],function(e,t){"use strict";return new(t.extend({SERVICE_ROOT_URL:"/resources/v3/e6w/service/ObjectInfo/",getObjects:function(t,n){var a=e.clone(n||{},!1),i=a.additionalURLParams&&a.additionalURLParams.split("&")||[];n.getVersions&&i.push("$include=versions");var r=a.relInfo;return r&&r.parentRelName&&(i.push("parentRelName="+r.parentRelName),i.push("parentDirection="+(r.parentDirection||"from"))),a.additionalURLParams=i.join("&"),this._getObjects(t,a)}}))}),define("DS/DocumentManagement/DocumentManagement",["UWA/Core","UWA/Class/Events","DS/DocumentManagement/DocumentFoundationAjax","DS/DocumentManagement/DriveDocumentManagement","DS/DocumentManagement/IndependentServiceBase","DS/DocumentManagement/ObjectInfoService"],function(e,t,n,a,i,r){"use strict";var o,s=function(t,n){var a=e.clone(n||{},!1);return a.onProgress=function(e){n&&n.onProgress&&n.onProgress(e),function(e,t){var n={activity:e,loaded:t.loaded,total:t.total};o.events.dispatchEvent("onActivityProgress",n)}(t,e)},a.onFailure=function(){n&&n.onFailure.apply(this,arguments),o.events.dispatchEvent("onActivityFailure",t)},a.onComplete=function(e){n&&n.onComplete(e,n),o.events.dispatchEvent("onActivityComplete",t)},a},l=i.extend({MSFDocumentClient:null,SERVICE_ROOT_URL:"/resources/v1/modeler/documents/",deleteVersion:function(e,t,n,a){return this._deleteObject(this.SERVICE_ROOT_URL+e+"/files/"+t+"/versions/"+n,a)},deleteFile:function(e,t,n){return this._deleteObject(this.SERVICE_ROOT_URL+e+"/files/"+t,n)},deleteDocument:function(){return this._deleteRootObject.apply(this,arguments)},getDocuments:function(t,n){var a=e.clone(n||{},!1),i=a.additionalURLParams&&a.additionalURLParams.split("&")||[];n.getVersions&&i.push("$include=versions");var r=a.relInfo;return r&&r.parentRelName&&(i.push("parentRelName="+r.parentRelName),i.push("parentDirection="+(r.parentDirection||"from"))),a.additionalURLParams=i.join("&"),this._getObjects(t,a)},connectDocumentToParent:function(e,t){var n=t||{},a=n.relInfo;return a&&(a.updateAction="CONNECT"),this._handleDocumentParentConnection(e,n)},disconnectDocumentFromParent:function(e,t){var n=t||{},a=n.relInfo;return a&&(a.updateAction="DISCONNECT"),this._handleDocumentParentConnection(e,n)},_handleDocumentParentConnection:function(t,a){var i=a||{};i.urlParams="";var r=a.relInfo;if(r&&r.parentId&&r.parentRelName&&t){var o=this,s=this._prepareService(this._handleDocumentParentConnection.bind(this,t,a),i);if(s)return s;var l={csrf:this.getCsrf(i.tenantUrl),data:[{id:t,updateAction:"NONE",relateddata:{parents:[{id:r.parentId,updateAction:r.updateAction}]}}]};let d=[];a.additionalURLParams&&d.push(...a.additionalURLParams.split("&")),d.push("parentRelName="+r.parentRelName),d.push("parentDirection="+(r.parentDirection||"from")),i.urlParams="?"+d.join("&");var c=e.clone(i.additionalHeaders||{},!1);c["content-type"]="application/json";var u={url:this.SERVICE_ROOT_URL+i.urlParams,type:"post",dataType:"json",data:JSON.stringify(l),callback:function(t){t&&t.csrf&&o.setCsrf(t.csrf,i.tenantUrl),t&&t.success&&e.is(a.onComplete,"function")?a.onComplete(t,a):e.is(a.onFailure,"function")&&a.onFailure(t)},headers:c};return n.ajaxRequest(u)}throw new Error("Invalid input")},getDocumentsFromParent:function(t){var a=t;t.getVersions&&((a=e.clone(t||{},!1)).additionalURLParams?a.additionalURLParams=a.additionalURLParams+"&$include=versions":a.additionalURLParams="$include=versions");var i=t.relInfo;if(i&&i.parentId&&i.parentRelName){var r=this;a.requestType="get",a.csrf=a.csrf||"notNeeded",this._prepareService(this.getDocumentsFromParent.bind(this,t),a),n.ajaxRequest({url:this.SERVICE_ROOT_URL+"parentId/"+i.parentId+"?parentRelName="+i.parentRelName+"&parentDirection="+(i.parentDirection||"from")+(a.additionalURLParams?"&"+a.additionalURLParams:""),type:"get",dataType:"json",callback:function(n){n&&n.csrf&&r.setCsrf(n.csrf,a.tenantUrl),n&&n.success&&e.is(t.onComplete,"function")?t.onComplete(n,t):e.is(t.onFailure,"function")&&t.onFailure(n)}})}},downloadDocument:function(t,i,r,o){var s=o||{};if("3DDrive"===s.serviceId)return a.downloadDocument(t,s);var l=s.useObjectNameForZip;void 0===s.useObjectNameForZip&&(l=!0);var c=s.lightweight;if(void 0===s.lightweight&&(c=!1),this.MSFDocumentClient&&this.MSFDocumentClient.IsConnectedToMSFClient()&&!0===o.autoDownload)return this.MSFDocumentClient.DownloadViaMSF([{id:t,fileid:i,checkout:r}],o);var u=s.onComplete,d=this,f="";s.tenantUrl&&(f=s.tenantUrl),f+=this.SERVICE_ROOT_URL+t+"/files/"+(r?"CheckoutTicket":"DownloadTicket")+"?useObjectNameForZip="+l+"&lightweight="+c;var p=this._prepareService(this.downloadDocument.bind(this,t,i,r,o),s);if(p)return p;var m={csrf:this.getCsrf(s.tenantUrl)};i&&(e.is(i,"string")?m.data=[{id:i}]:m.data=[{dataelements:i}]);var h=e.clone(s.additionalHeaders||{},!1);h["content-type"]="application/json";var v={url:f,type:"put",dataType:"json",data:JSON.stringify(m),callback:function(t){if(t&&t.csrf&&d.setCsrf(t.csrf,s.tenantUrl),t&&t.data&&t.data.length&&t.data[0].dataelements&&t.data[0].dataelements.ticketURL){var n=t.data[0].dataelements.ticketURL;s.autoDownload?d.downloadWithPost(n,s):e.is(u,"function")&&u(n,s)}else e.is(s.onFailure,"function")&&s.onFailure(t,s)},headers:h};return n.ajaxRequest(v)},downloadDocuments:function(t,a){if(this.MSFDocumentClient&&this.MSFDocumentClient.IsConnectedToMSFClient())return this.MSFDocumentClient.DownloadViaMSF(t.map(function(e){return{id:e,fileid:void 0}}),a);var i=a||{},r=i.onComplete,o=this,s=this.SERVICE_ROOT_URL+"DownloadTicket",l=t.length;if(!l)throw new Error("no document to download");for(var c=[],u=0;u<l;u++)c.push({id:t[u]});var d=this._prepareService(this.downloadDocuments.bind(this,t,a),i);if(d)return d;var f={csrf:this.getCsrf(i.tenantUrl),data:c};i.urlParams="",i.asZip&&(i.urlParams+=i.urlParams.length?"&":"?",i.urlParams+="zipFiles=true"),i.lightweight&&(i.urlParams+=i.urlParams.length?"&":"?",i.urlParams+="lightweight=true");var p=e.clone(i.additionalHeaders||{},!1);p["content-type"]="application/json";var m={url:s+i.urlParams,type:"put",dataType:"json",data:JSON.stringify(f),callback:function(t){t&&t.csrf&&o.setCsrf(t.csrf,i.tenantUrl);var n=!1,a=!1,s=[];if(t&&t.success){if(t&&t.data&&t.data.length)for(var l=t.data.length,c=0;c<l;c++){var u=t.data[c],d={id:u.id,errorMessage:u.updateMessage};u.dataelements&&u.dataelements.ticketURL?(d.downloadUrl=u.dataelements.ticketURL,u.dataelements.fileName&&(d.fileName=u.dataelements.fileName),u.dataelements.fileNames&&(d.fileNames=u.dataelements.fileNames),n=!0):a=!0,u.updateMessage&&(a=!0),s.push(d)}}else a=!0;n&&e.is(r,"function")&&r(s),a&&e.is(i.onFailure,"function")&&i.onFailure(s,t,i)},headers:p};return n.ajaxRequest(m)},createDocument:function(e,t){if(e&&e.fileInfo&&e.fileInfo.file&&this.events.dispatchEvent("onActivityStart",e.fileInfo.file),e.driveFolderId){var n=s(e.fileInfo.file,t);return a.createDocument(e,n)}return this._handleDocument(e,t)},addFileToDocument:function(e,t){return e.fileInfo.newFile=!0,this._handleDocument(e,t)},modifyDocument:function(e,t){if(e&&e.fileInfo&&e.fileInfo.file&&this.events.dispatchEvent("onActivityStart",[e.fileInfo.file,{update:!0}]),t&&"3DDrive"===t.serviceId){var n=s(e.fileInfo.file,t);return a.modifyDocument(e,n)}return this._handleDocument(e,t)},_handleDocument:function(t,a){var i=e.clone(a||{},!1),r=e.clone(t,!1);if(r.fileInfo&&r.fileInfo.title&&(r.fileInfo=e.clone(r.fileInfo,!1),delete r.fileInfo.title),e.is(r,"array")){for(var o=r.length,l=[],c=0;c<o;c++){var u=r[c];l.push(this._handleDocument(u,a))}return l}var d=this;r&&r.fileInfo&&r.fileInfo.file&&(i=s(t.fileInfo.file,a)),!i.csrf&&r.fileInfo&&(i.csrf="notNeeded");var f=this.SERVICE_ROOT_URL+"files/CheckinTicket",p=this._prepareService(this._handleDocument.bind(this,r,a),i);if(p)return p;var m={csrf:this.getCsrf(i.tenantUrl)};if(i.documentInfo=r,r&&r.fileInfo&&r.fileInfo.file){var h=e.clone(i.additionalHeaders||{},!1);h["content-type"]="application/json";var v={url:f,type:"put",dataType:"json",data:JSON.stringify(m),callback:function(e){d._handleTicket(e,i)},headers:h};return n.ajaxRequest(v)}return this._handleFCSReceipt(void 0,i)},_buildDocumentDataElements:function(e,t){var n=t&&t.documentInfo||Object.create(null),a=n.description,i=n.title,r=n.collabspace,o=t.deriveCollabspace?"true":t.deriveCollabspace,s=n.id,l=n.policy,c=n.fileInfo&&n.fileInfo.file,u=c&&c.name,d=n.relInfo;if(e.dataelements=Object.create(null),!i&&!s&&u){var f=u.lastIndexOf("."),p=u;-1!==f&&(p=p.substring(0,f)),i=p}i&&(e.dataelements.title=i),r&&(e.dataelements.collabspace=r),o&&(e.dataelements.deriveCollabspace=o),a&&(e.dataelements.description=a),l&&(e.dataelements.policy=l),!s&&d&&(e.dataelements.parentId=d.parentId,e.dataelements.parentRelName=d.parentRelName,d.parentDirection&&(e.dataelements.parentDirection=d.parentDirection)),Object.keys(e.dataelements).length||delete e.dataelements},_buildFilesRelatedData:function(e,t){var n=t.documentInfo||Object.create(null),a=n.fileInfo||Object.create(null),i=a.file,r=a.id,o=i&&i.name,s=a.comments,l=a.format,c=t.fcsReceipt,u=n.id;n.fileInfo&&(e.relateddata={files:[{dataelements:{}}]},r&&(e.relateddata.files[0].id=r),o&&(e.relateddata.files[0].dataelements.title=o),s&&(e.relateddata.files[0].dataelements.comments=s),l&&(e.relateddata.files[0].dataelements.format=l),s&&(e.relateddata.files[0].dataelements.comments=s),c&&(e.relateddata.files[0].dataelements.receipt=c),i&&u&&(r||!a.newFile?(e.relateddata.files[0].updateAction="REVISE",t.urlParams="?$include=versions"):e.relateddata.files[0].updateAction="CREATE"))},_handleFCSReceipt:function(t,a){var i=this,r=e.clone(a||{},!1);r.urlParams="";var o=r.documentInfo||Object.create(null),s=o.type,l=o.id,c=o.tempId,u=Object.create(null);this._buildDocumentDataElements(u,r),r.fcsReceipt=t,this._buildFilesRelatedData(u,r),s&&(u.type=s),l?u.id=l:u.tempId=c||n._newTempId(),r.customDocumentObject&&r.customDocumentObject.dataelements&&e.merge(u.dataelements,r.customDocumentObject.dataelements);var d={csrf:i.getCsrf(a&&a.tenantUrl),data:[u]};u.dataelements||u.tempId||(u.updateAction="NONE");let f=[];a.isImage&&(r.urlParams+=r.urlParams.length?"&":"?",f.push("$fields=!image")),a.additionalURLParams&&f.push(...a.additionalURLParams.split("&")),f.length>0&&(r.urlParams="?"+f.join("&"));var p=e.clone(a.additionalHeaders||{},!1);return p["content-type"]="application/json",n.ajaxRequest({url:this.SERVICE_ROOT_URL+r.urlParams,type:l?"put":"post",dataType:"json",data:JSON.stringify(d),callback:function(t){t&&t.csrf&&i.setCsrf(t.csrf,a&&a.tenantUrl),t&&t.success&&e.is(a.onComplete,"function")?a.onComplete(t,a):e.is(a.onFailure,"function")&&a.onFailure(t)},headers:p})}});return(o=new l).events=new t,o.getObjects=o.getDocuments,o});