define("DS/i3DXCompassInviteMember/Views/SelectAppsView",["UWA/Core","UWA/Class/View","UWA/Controls/Pager","DS/i3DXCompassCmp/Controls/Input/Text","DS/UIKIT/Input/Toggle","DS/UIKIT/Mask","DS/i3DXCompassCore/Utils","DS/i3DXCompassCore/Controls/PlatformNotify","DS/i3DXCompassCmp/Modal/Prereq","DS/i3DXCompassCmp/Modal/PrereqError","DS/i3DXCompassCore/Collection/ProcessCollection","UWA/Event","i18n!DS/i3DXCompassInviteMember/assets/nls/i3DXCompassInviteMember"],function(e,t,s,i,n,o,l,a,c,r,m,d,h){"use strict";return t.extend({tagName:"div",hideTableWithoutLicences:1,hideTableWithLicences:0,setup:function(e){if(e.collectionSelected&&(this.collectionSelected=e.collectionSelected),!e.platform)throw new Error("platform is mandatory");return this.platform=e.platform,e.disabledCrossCompany&&(this.disabledCrossCompany=e.disabledCrossCompany),this._disabledRoles=[],this.preSelectedRoleDone=!1,e},render:function(){return this._managePreselection(),this.filterData(),this.subView?(this.collectionFull||(this.collectionFull=new m,this.collectionFull.add(this.collection.toJSON()),this.options.collectionWithOutLicenses&&(this.collectionWithOutLicensesFull=new m,this.collectionWithOutLicensesFull.add(this.options.collectionWithOutLicenses.toJSON())),this.collectionSelected&&(this._managePreselection(),this.collectionSelected.size()>0&&this.filterData())),this.subView.setContent(this.buildSubView()),this.unmask()):(this.container.setContent(this.buildAppSkeleton()),this.mask()),this.options.setNextDisabled&&this._manageNextButton(),this},_manageNextButton:function(){(this.options.tagger?this.options.tagger.getSelected().length:1)&&this.collectionSelected.size()>0?this.options.setNextDisabled(!1):this.options.setNextDisabled(!0)},_managePreselection:function(){var e,t,s=this.options.tagger?this.options.tagger.getSelected().length:1,i=this.platform.canCrossCompany()&&!this.disabledCrossCompany;this.collectionSelected&&this.collectionFull&&!this.preSelectedRoleDone&&(1===(e=this.collectionFull.filter(function(e){var t=!!i||e.get("free")>=s;return!0===e.get("isPlatform")&&t})).length&&(t=e[0],this.collectionSelected.add(t),this._disabledRoles.push(t.get("trigram"))),this.preSelectedRoleDone=!0)},getMaxFreeRole:function(){var e=null;return this.collectionSelected&&this.collectionSelected.forEach(function(t){e=e?Math.min(e,t.get("free")):t.get("free")}),e},buildAppSkeleton:function(){return[this.buildSearch(),this.buildSubView()]},buildSubView:function(){return this.subView=e.createElement("div",{styles:{position:"relative"},class:"wrapper",html:[this.collectionSelected&&this.collectionSelected.size()>0?this.buildSelectedTable():{class:"text-center",text:this.options.emptyText||""},this.collection&&this.collection.size()>0?this.options.collectionWithOutLicenses?this.buildWithoutLicensesTable(this.collection):this.buildTable():null,this.options.collectionWithOutLicenses&&this.options.collectionWithOutLicenses.size()>0?this.buildWithoutLicensesTable(this.options.collectionWithOutLicenses):null]}),this.subView},buildSelectedTable:function(){return{tag:"table",class:"table table-hover table-select-process table-selection",html:[{tag:"thead",html:{tag:"tr",html:[{tag:"th",colspan:2,text:h.get("Selected")}]}},{tag:"tbody",html:this.buildSelectedRows()}]}},buildSelectedRows:function(){var e=[],t=this;return this.collectionSelected.forEach(function(s){e.push(t.buildRow(s))}),e},buildTable:function(){return{tag:"table",class:"table table-hover table-select-process",html:[{tag:"thead",html:{tag:"tr",html:[{tag:"th",colspan:2,text:this.options.titleTableCollection?this.options.titleTableCollection:h.get("Available")}]}},{tag:"tbody",html:this.buildRows()}]}},buildWithoutLicensesTable:function(t){var s=this,i=t===this.options.collectionWithOutLicenses,n=i?this.hideTableWithoutLicences:this.hideTableWithLicences,o=function(e){var t=e.target.getParent("table").getElement("tbody"),s=e.target.getParent("table").getElement(".fonticon");s.hasClassName("fonticon-down-dir")?(t.hide(),s.removeClassName("fonticon-down-dir").addClassName("fonticon-right-dir")):(t.show(),s.removeClassName("fonticon-right-dir").addClassName("fonticon-down-dir"))};return{tag:"table",class:"table table-hover table-select-process",html:[{tag:"thead",html:{tag:"tr",styles:{cursor:"pointer"},html:[{tag:"th",text:i?this.options.titleTableCollectionWithOutLicenses:this.options.titleTableCollection},{tag:"th",html:[{tag:"span",class:n?"fonticon fonticon-right-dir":"fonticon fonticon-down-dir",styles:{float:"right","font-size":"14px",cursor:"pointer"},events:{click:function(t){o(t),i?s.hideTableWithoutLicences=s.hideTableWithoutLicences?0:1:s.hideTableWithLicences=s.hideTableWithLicences?0:1,e.Event.stopPropagation(t)}}}]}],events:{click:function(t){o(t),i?s.hideTableWithoutLicences=s.hideTableWithoutLicences?0:1:s.hideTableWithLicences=s.hideTableWithLicences?0:1,e.Event.stopPropagation(t)}}}},{tag:"tbody",styles:{display:n?"none":""},html:this.buildRows(t)}]}},buildRows:function(e){var t=[],s=this,i=this.collection;return e&&(i=e),i.forEach(function(e){t.push(s.buildRow(e,"other"))}),t},buildRow:function(t){var s=this,i=function(e){var i,n=null,o=0;s.options.tagger&&(o=s.options.tagger.getSelected().length),e.isChecked()?t.hasFree()||t.isTPA()||t.isCustom()?(i=new c({selectedCollection:s.collectionSelected,model:t,number:o,onConfirm:function(e){e.forEach(function(e){(n=s.platform.canCrossCompanyExtended()&&!s.disabledCrossCompany&&s.collectionWithOutLicensesFull&&s.collectionWithOutLicensesFull.get(e.get("uid"))?s.collectionWithOutLicensesFull.get(e.get("uid")):s.collectionFull.get(e.get("uid")))&&(s.collectionSelected.add(n),s.collection.remove(void 0))}),s.collectionSelected.add(t),s.platform.canCrossCompanyExtended()&&!s.disabledCrossCompany&&s.options.collectionWithOutLicenses&&s.options.collectionWithOutLicenses.remove(t.id)?s.options.collectionWithOutLicenses.set(s.options.collectionWithOutLicenses.sortBy("name")):(s.collection.remove(t.id),s.collection.set(s.collection.sortBy("name"))),s.collectionSelected.set(s.collectionSelected.sortBy("name")),s.render(),s._manageCrossCompanySelection()},onCancel:function(){e.uncheck()}})).isNeeded()?i.confirm():(s.collectionSelected.add(t),s.platform.canCrossCompanyExtended()&&!s.disabledCrossCompany&&s.options.collectionWithOutLicenses&&s.options.collectionWithOutLicenses.remove(t.id)?s.options.collectionWithOutLicenses.set(s.options.collectionWithOutLicenses.sortBy("name")):(s.collection.remove(t.id),s.collection.set(s.collection.sortBy("name"))),s.collectionSelected.set(s.collectionSelected.sortBy("name")),s.render(),s._manageCrossCompanySelection()):a.warn(h.get("You have not enough role")):(i=new r({model:t,selectedCollection:s.collectionSelected,onCancel:function(){e.check()}})).isNeeded()?i.show():(s.collectionSelected.remove(t.id),s.collectionSelected.set(s.collectionSelected.sortBy("name")),s.platform.canCrossCompanyExtended()&&!s.disabledCrossCompany&&s.options.collectionWithOutLicenses&&!t.get("withLicenses")?(s.options.collectionWithOutLicenses.add(t),s.options.collectionWithOutLicenses.set(s.options.collectionWithOutLicenses.sortBy("name"))):(s.collection.add(t),s.collection.set(s.collection.sortBy("name"))),s.render(),s._manageCrossCompanySelection())},o=s.collectionSelected.contains(t);t.isTPA()&&!1===t.get("private")&&(o=!0);var m=new n({"data-free":t.get("free"),className:"primary",type:"checkbox",name:"licenses[]",value:t.get("uid"),id:t.get("uid"),label:!0===t.get("option")?l.getTextFromHtml(t.get("name"))+" "+h.get("(Option)"):l.getTextFromHtml(t.get("name")),checked:o,disabled:function(){var e=!1,i=null;return s.options.tagger&&(i=s.options.tagger.getSelected().length),this._disabledRoles.indexOf(t.get("trigram"))>-1&&(e=!0),t.canCrossCompany()&&!s.disabledCrossCompany||!t.isDisabled(!1,i)||(e=!0),!t.isTPA()&&!t.isCustom()&&!t.canCrossCompany()&&this._isCrossCompanyRoleDisabled(),e}.call(this)});return e.createElement("tr",{html:[{tag:"td",styles:{"vertical-align":"middle"},html:m},{tag:"td",class:!s.platform.canCrossCompany()||s.disabledCrossCompany||t.isTPA()||t.isCustom()||!o?"text-right status":"",html:!s.platform.canCrossCompany()||s.disabledCrossCompany||t.isTPA()||t.isCustom()||!o?this._getInformation(t):this._createCrossCompany(t)}],events:{click:function(e){if(!m.isDisabled()&&!e.target.getParent(".toggle-switch")){var t=!m.isChecked();m.setCheck(t),i(m),d.stop(e)}}}})},_getInformation:function(t,s){var i="",n="";return t.isTPA()?i=e.String.format(h.get("Type: {0}"),t.getDisplayType()):!t.isCustom()&&t.get("free")<(this.options.tagger?this.options.tagger.getSelected().length:1)?(i=this.platform.canCrossCompany()&&!this.disabledCrossCompany?t.get("withLicenses")?e.String.format(h.get("Not enough licenses available ({0} remaining)"),t.get("free")):h.get("No license associated"):e.String.format(h.get("Not enough roles available ({0} remaining)"),t.get("free")),n="text-error"):t.isCustom()||(i=t.get("total")?e.String.format(h.get("Used: {0}/{1}"),t.get("total")-t.get("free"),t.get("total")):""),{tag:"span",class:n,text:s&&""!==i?" - "+i:i}},_manageCrossCompanySelection:function(t){var s,i=this,n=this.container.getElements(".table-selection tbody tr"),o=this.collectionSelected.find(function(e){return e.isWA()&&!e.canCrossCompany()});this._isCrossCompanyRoleDisabled()||(s=t&&i.platform.getCrossCompanyRoles().indexOf(t.get("trigram"))>-1?t:this.collectionSelected.find(function(e){return i.platform.getCrossCompanyRoles().indexOf(e.get("trigram"))>-1}),n.forEach(function(t){var n=t.getElement("[name=licensed\\[\\]]"),l=t.getElement("[name=restricted\\[\\]]");if(s&&n&&l){var a=i.collectionSelected.find(function(e){return e.get("trigram")===n.getAttribute("data-trigram")});e.is(o)?i.platform.getCrossCompanyRoles().indexOf(n.getAttribute("data-trigram"))>-1?(s.set("licensed",!0),n.checked=s.get("licensed"),n.disabled=!0,l.checked=s.get("restricted"),l.getParent().toggleClassName("hidden",!s.get("licensed")),a.set("licensed",s.get("licensed")),a.set("restricted",s.get("restricted"))):l.getParent().toggleClassName("hidden",!n.checked):i.platform.getCrossCompanyRoles().indexOf(n.getAttribute("data-trigram"))>-1?(n.checked=s.get("licensed"),n.disabled=!1,l.checked=s.get("restricted"),l.getParent().toggleClassName("hidden",!s.get("licensed")),a.set("licensed",s.get("licensed")),a.set("restricted",s.get("restricted"))):l.getParent().toggleClassName("hidden",!n.checked)}}))},_isCrossCompanyRoleDisabled:function(){var e,t=this;return t.options.tagger&&(e=t.options.tagger.getSelected().length),!!this.collectionSelected.find(function(s){return t.platform.getCrossCompanyRoles().indexOf(s.get("trigram"))>-1&&s.isAssignDisabled(void 0,e)})},_createCrossCompany:function(t){var s=this,i=!t.get("withLicenses")||(this.platform.getCrossCompanyRoles().indexOf(t.get("trigram"))>-1||!t.isTPA()&&!t.isCustom()&&!t.canCrossCompany())&&this._isCrossCompanyRoleDisabled(),o=!i&&!t.isDisabled(!1,s.options.tagger?s.options.tagger.getSelected().length:null)&&(!e.is(t.get("licensed"))||t.get("licensed")),l=new n({className:"primary",type:"switch",name:"licensed[]",attributes:{"data-trigram":t.get("trigram")},checked:o,value:t.get("uid"),disabled:i||!t.canCrossCompany()||t.isDisabled(!1,s.options.tagger?s.options.tagger.getSelected().length:null),label:"",events:{onClick:function(){t.set("licensed",this.isChecked()),s._manageCrossCompanySelection(t)}}}),a=t.get("withLicenses")?new n({className:"primary"+(o?" ":" hidden"),type:"switch",name:"restricted[]",attributes:{"data-trigram":t.get("trigram")},checked:!e.is(t.get("restricted"))||t.get("restricted"),value:t.get("uid"),label:h.get("Restrict Usage to this Platform"),disabled:!t.canCrossCompany()||t.isWU(),events:{onClick:function(){t.set("restricted",this.isChecked()),s._manageCrossCompanySelection(t)}}}):null;return l.getContent().getElement("label").setContent([{tag:"span",text:h.get("Assign License")},{tag:"span",html:this._getInformation(t,!0)}]),[l,a]},filterData:function(){var e=this;e.collectionSelected.forEach(function(t){t&&e.collection.remove(t.id)})},_fetchSearch:function(e){var t=this,s=0;this.mask(),this.collection.setQuery(e),this.collection.setOffset(0),this.collection.reset(),this.collection.fetch({onComplete:function(){t.options.collectionWithOutLicenses&&2!==s?s=1:(t.render(),t._manageCrossCompanySelection())}}),this.platform.canCrossCompanyExtended()&&!this.disabledCrossCompany&&this.options.collectionWithOutLicenses&&(this.options.collectionWithOutLicenses.setQuery(e),this.options.collectionWithOutLicenses.setOffset(0),this.options.collectionWithOutLicenses.reset(),this.options.collectionWithOutLicenses.fetch({onComplete:function(){1===s?(t.render(),t._manageCrossCompanySelection()):s=2}}))},_search:function(e){var t,s=this;(!this.platform.canCrossCompany()||this.disabledCrossCompany)&&this.collection.isFetched()||this.options.collectionWithOutLicenses&&this.options.collectionWithOutLicenses.isFetched()&&this.collection.isFetched()?this._fetchSearch(e):(t=function(){s.collection.removeEvent("onAdd",t),setTimeout(function(){s._fetchSearch(e)},100)},this.collection.addEvent("onAdd",s._search(e)))},buildSearch:function(){var e=this;return new i({attributes:{placeholder:this.options.searchPlaceholder,value:this.collection.getQuery()||"",events:{keyup:function(){e._search.call(e,this.value)}}}})},getBody:function(){return this.content||(this.content=this.container.getElement(".wrapper")),this.content},mask:function(){this.isMasked()||(o.mask(this.getBody()),this.masked=!0)},unmask:function(){this.isMasked()&&(o.unmask(this.getBody()),this.masked=!1)},isMasked:function(){return this.masked}})}),define("DS/i3DXCompassInviteMember/Modal/InviteMember",["UWA/Core","UWA/Controls/Abstract","UWA/Controls/Input","DS/UIKIT/Mask","DS/UIKIT/Tooltip","DS/i3DXCompassCmp/Modal/FullScreenModal","DS/UIKIT/Input/Text","DS/UIKIT/Input/Select","DS/UIKIT/Input/Toggle","DS/UIKIT/Input/Button","DS/UIKIT/Input/ButtonGroup","DS/UIKIT/Input/File","DS/i3DXCompassCore/Controls/PlatformNotify","DS/i3DXCompassCore/Utils/Data","DS/i3DXCompassCmp/Controls/Tagger","DS/i3DXCompassCore/Utils","DS/i3DXCompassInviteMember/Views/SelectAppsView","DS/i3DXCompassCore/Collection/ProcessCollection","DS/i3DXCompassCore/Collection/AppsCollection","DS/i3DXCompassCore/Collection/MemberCollection","DS/i3DXCompassCore/Model/ImportModel","DS/i3DXCompassCore/Model/PlatformModel","DS/i3DXCompassCore/Model/UserRightModel","i18n!DS/i3DXCompassInviteMember/assets/nls/i3DXCompassInviteMember"],function(e,t,s,i,n,o,l,a,c,r,m,d,h,u,p,g,f,C,b,v,y,S,w,x){"use strict";var T,D;return t.extend({defaultOptions:{platform:null,onAdded:function(){}},casualType:{casual:0},mode:0,step:0,viewStep2Casual:null,id:g.getUUID(),selectedLicenses:[],nextButtonDisabled:!0,locationsView:null,init:function(e){this._parent(e),e.mode&&(this.mode=e.mode),this.platform=e.platform,this.inviteInProgress=!1,this.uploadInProgress=!1,this.casualHasRole={},this.buildContainer()},buildContainer:function(){var e=this,t=new C([]),s=4,i=function(){0===--s&&(e.viewStep1=e.buildContent(),e.modal.unmask(),e.elements.container.setBody(e.viewStep1),e.dispatchEvent("onRendered"))};this.modal=new o({closable:!0,className:"invite-member",header:this.getModalTitle(),body:{class:"empty-body"},footer:"",events:{onHide:function(){this.destroy()}}}),this.elements.container=this.modal,this.elements.container.inject(document.body,"top").show(),this.modal.mask(),e.elements.container.setFooter(e.getButtons()),(new w).fetch({onComplete:function(t,s){e.roles=s.roles,e.agreements=s.agreements,i()}}),e.platform.fetch({data:{id:this.platform.get("id"),availability:!0},onComplete:function(t){e.data=t.toJSON(),i()}}),t.fetch({data:{selfexp:!1,platform:e.platform.get("id"),casual:0,limit:1,apps:!1},onComplete:function(t){e.casualHasRole[e.casualType.casual]=t.length>0,e.manageButtonNextText(e.casualHasRole[e.casualType.casual]),i()}}),g.getParentModule("DS/UWPClientCode/I18n",function(e){D=e,i()})},_canCrossCompany:function(){return 0===this.mode&&this.platform.canCrossCompany()},buildContent:function(){var t,s,i,n,o=D.getSupportedLanguages(),c=[],m=this,f=this.buildCasual();if(0===this.step){for(s in o)o.hasOwnProperty(s)&&(n=(i=o[s]).localizedName+" ("+i.staticName+")",c.push({value:s,label:n,selected:s===this.options.lang}));0===this.mode?this.elements.tagger=new p({placeholder:x.get("Enter email"),limit:this._getMinAvailability(),focus:!0,validator:function(e){return g.isEmail(e)},onError:function(e){var t=0!==m.casualType.free||m._canCrossCompany()?x.get("Your Email is not valid"):x.get("No more roles available");e||m.errorInterval||(setTimeout(function(){!0===m.elements.container.isVisible&&h.alert(t)},200),m.errorInterval=!0,setTimeout(function(){m.errorInterval=null},2e3)),m.setNextDisabled(!0)},onLimitError:function(){var t=10<m.casualType.free?e.String.format(x.get("You cant add more than {0} emails"),10):x.get("No more roles available");m._getMinAvailability()<10&&m._getMinAvailability()<m.casualType.free&&e.String.format(x.get("You cant add more than {0} emails because of selected roles"),m._getMinAvailability()),h.alert(t),m.errorInterval=!0,setTimeout(function(){m.errorInterval=null},2e3),m.setNextDisabled(!0)},onSuccess:function(){var e=m.elements.tagger.getSelected().length;null===m.elements.tagger.elements.container.getElement(".has-error")&&(e>0&&!0===m.platform.get("platform")||e>0&&!1===m.platform.get("platform"))?m.setNextDisabled(!1):m.setNextDisabled(!0)},validatorAsync:function(t,s){var i=new v;m.setNextDisabled(!0),i.setLimit(15),i.setOffset(0),i.setQuery(t),i.setPlatform(m.platform.get("id")),i.fetch({onComplete:function(){var n=i.find(function(e){return e.get("email").toLowerCase()===t.toLowerCase()});e.is(n)?(h.alert(x.get("You cannot invite a user already on the platform")),m.setNextDisabled(!0),s.onFailure()):s.onComplete()},onFailure:function(){s.onFailure()}})},onChange:function(){var e=m.elements.tagger.getSelected().length;"none"!==m.platform&&m.updateAvailability(),e&&m.setNextDisabled(!0)}}):(this.elements.iframe=e.createElement("iframe",{class:"hidden",id:"uploadFrame"+this.id,name:"uploadFrame"+this.id,src:u.getUrl("resources")+"s.gif",events:{load:function(){m.modal.unmask(),m.uploadInProgress&&(m.uploadInProgress=!1,h.success(x.get("Import has been created")),m.options.onAdded&&m.options.onAdded(),m.hide())}}}),this.elements.form=e.createElement("form",{class:"form-wrapper",action:"#",method:"POST",enctype:"multipart/form-data",target:"uploadFrame"+this.id,html:[{tag:"input",type:"hidden",name:"__fcs__jobTicket",id:"__fcs__jobTicket"},new d({showResetButton:!1,className:"input-file",attributes:{name:"file_import"},buttonBefore:!1,events:{onChange:function(){var e=this.elements.input,t=this.getValue(),s=g.getFileExtension(t),i=e.getParent(".form-group");""!==t&&"csv"===s?(i.removeClassName("has-error"),m.setNextDisabled(!1)):""!==t?(m.setNextDisabled(!0),i.addClassName("has-error"),h.alert(x.get("Wrong file type. Please select a correct csv file.")),this.setValue()):(i.removeClassName("has-error"),m.setNextDisabled(!0))}}}),{tag:"a",target:"_blank",href:g.getAsset("data/import-sample.csv"),html:new r({value:x.get("See Example"),events:{onClick:function(){e.Utils.Client.Engine.ie&&window.open(g.getAsset("data/import-sample.csv"))}}})},{tag:"input",type:"hidden",value:u.getUrl("faillurePageImport"),name:"__fcs__failurePage",id:"__fcs__failurePage"},{tag:"input",type:"hidden",value:"false",name:"attachment",id:"attachment"},{tag:"input",type:"hidden",value:"",name:"file_0_name",id:"file_0_name"}]})),t=e.createElement("div",{html:[{class:"row",html:{class:"form-group col-sm-12",html:[this.elements.availability,{tag:"label",class:"control-label",html:0===this.mode?e.i18n("Invite by email")+" <em>"+e.i18n("(If multiple separate by ';')")+"</em>":e.i18n("Select a file to import")},0===this.mode?{class:"wrapper",html:this.elements.tagger}:[this.elements.form]]}},0===this.mode?{class:"row",html:[this.displayCompany()?this.buildCompany():this.buildPlatform()]}:{class:"row",html:this.buildCompany()},0===this.mode?this.displayCompany()?{class:"row",html:[this.buildPlatform()]}:{styles:{width:"40%"},html:this.buildCompany()}:null,{styles:{clear:"both"}},{class:"row",html:f},this.locationsView&&this.locationsView.hasLocations()?{class:"form-group col-sm-12",html:this.locationsView.render()}:null,{class:"row",html:{class:"form-group col-sm-6",html:[{tag:"label",for:"language-"+this.id,text:x.get("Invitation Email language")},new a({attributes:{id:"language-"+this.id,name:"language"},placeholder:!1,options:c,className:"select-language"})]}},{class:"row",html:{class:"form-group col-sm-12",html:[{tag:"label",for:"text-"+this.id,text:x.get("Add a message")},new l({multiline:!0,attributes:{id:"text-"+this.id,name:"text",styles:{height:80}}})]}}]})}else m.viewStep2&&m.viewStep2Casual===m.casualType.casual?(t=m.viewStep2,T._manageNextButton.call(T)):(m.viewStep2Casual=m.casualType.casual,t=e.createElement("div",{html:[m.buildLicensesSkeleton(),m.options.hasApp?m.buildAppsSkeleton():null]}),m.viewStep2=t);return t},updateAvailability:function(){this.elements.availability.setText(this.getAvailabilityText()),this.elements.tagger.options.limit=this._getMinAvailability()},_getMinAvailability:function(){var e,t=10;return!this._canCrossCompany()&&T&&(e=T.getMaxFreeRole())&&(t=Math.min(e,t)),Math.min(10,t)},getAvailabilityText:function(){var t=this.elements.tagger?this.elements.tagger.getSelected().length:0,s=this.casualType,i=s.total-s.free+t,n=i+"/"+s.total;return e.String.format(i>1?x.get("Used invitations: {0}"):x.get("Used invitation: {0}"),n)},buildCasual:function(){var t,s=this.data.availability,i=[],n=this;return s.forEach(function(t){e.is(n.casualType.free)||n.casualType.casual!==t.casual||(n.casualType=t),i.detect(function(e){return e.value===""+t.casual})||i.push({value:""+t.casual,label:0===t.casual?x.get("Unlimited"):e.String.format(x.get("Casual {0}h/month"),t.casual),selected:n.casualType.casual===t.casual})}),this.elements.availability=e.createElement("span",{class:"pull-right"+(n._canCrossCompany()?" hidden":""),text:this.getAvailabilityText(this.casualType)}),t=new a({attributes:{name:"casual",id:"casual-"+this.id},placeholder:!1,options:i,events:{onChange:function(){var t=parseInt(this.getValue()[0],10),i=new C([]);n.casualType=e.Array.detect(s,function(e){return e.casual===t}),n.options.hasApp||(e.is(n.casualHasRole[n.casualType.casual])?n.manageButtonNextText(n.casualHasRole[n.casualType.casual]):(n.modal.mask(),i.fetch({data:{limit:1,platform:n.platform.get("id"),casual:n.casualType.casual,selfexp:!1,apps:!1},onComplete:function(e){n.modal.unmask(),n.casualHasRole[n.casualType.casual]=e.length>0,n.manageButtonNextText(n.casualHasRole[n.casualType.casual])}}))),n.updateAvailability()}}}),[{class:i.length>1?"form-group col-sm-6":"form-group col-sm-6 hidden",html:[{tag:"label",for:"casual-"+this.id,text:x.get("Usage Type")},t]}]},displayCompany:function(){return(this.data.companies||[]).length>1},buildCompany:function(){var e=this.data.companies||[],t=[];return e.forEach(function(e){t.push({value:e.id,label:g.isEmptyString(e.name)?e.id:e.name})}),this.elements.company=new a({attributes:{name:"company",id:"company-"+this.id},placeholder:!1,options:t,events:{onChange:function(){}}}),{class:this.displayCompany()?"form-group col-sm-6":"form-group col-sm-6 hidden",html:[{tag:"label",for:"company-"+this.id,text:x.get("Company")},this.elements.company]}},buildRoles:function(){var e,t=this.roles.length,s=[];for(e=0;e<t;e++)"2"!==this.roles[e].id&&s.push({value:this.roles[e].id,label:this.roles[e].name});return s.push({value:"-1",label:x.get("External")}),this.elements.roles=new a({attributes:{name:"role",id:"role-"+this.id},placeholder:!1,options:s,events:{onChange:function(){}}}),this.elements.roles},buildSelectAgreement:function(){var e,t=this,s=[],i=this.agreements.length;for(e=0;e<i;e++)"-1"!==this.agreements[e].id&&s.push({value:this.agreements[e].id,label:this.agreements[e].name});return this.selectAgreement=new c({type:"checkbox",name:"agreement",value:"",label:x.get("External"),className:"primary",events:{onClick:function(){t.elements.roles.setDisabled(this.isChecked())}}}),this.selectAgreement},getModalTitle:function(){var e=x.get("Invite members");return!1===this.platform.get("platform")&&(e=x.get("Grant Roles")),e},buildPlatform:function(){return{class:"form-group col-sm-6"+(this.platform.isPlatform()?"":" hidden"),html:[{tag:"label",for:"role-"+this.id,text:x.get("User rights")},this.buildRoles()]}},buildLicensesSkeleton:function(){var t=this,s=0,i=new C([],{data:{platform:this.platform.get("id"),casual:this.casualType.casual,selfexp:!1,apps:!1,withLicenses:!0}}),n=new C([],{data:{platform:this.platform.get("id"),casual:this.casualType.casual,selfexp:!1,apps:!1,withLicenses:!1}}),o=new C,l=new f({disabledCrossCompany:!t._canCrossCompany(),collection:i,titleTableCollection:t.platform.canCrossCompanyExtended()&&t._canCrossCompany()?x.get("Available roles with licenses"):null,collectionWithOutLicenses:t.platform.canCrossCompanyExtended()&&t._canCrossCompany()?n:null,titleTableCollectionWithOutLicenses:t.platform.canCrossCompanyExtended()&&t._canCrossCompany()?x.get("Available roles without any license"):null,collectionSelected:o,searchPlaceholder:x.get("Search Roles & Options"),tagger:this.elements.tagger,platform:this.platform,setNextDisabled:this.setNextDisabled.bind(this)}),a=e.createElement("span",{class:"fonticon fonticon-down-dir",styles:{opacity:"1"}});return T=l,i.setLimit(999),i.fetch({onComplete:function(){t.platform.canCrossCompanyExtended()&&t._canCrossCompany()&&2!==s?s=1:l.render()}}),this.platform.canCrossCompanyExtended()&&t._canCrossCompany()&&(n.setLimit(999),n.fetch({onComplete:function(){1===s?l.render():s=2}})),[{tag:"h5",html:[a,{tag:"span",text:x.get("Roles & Options")}],events:{click:function(){a.hasClassName("fonticon-down-dir")?(l.hide(),a.removeClassName("fonticon-down-dir").addClassName("fonticon-right-dir")):(l.show(),a.removeClassName("fonticon-right-dir").addClassName("fonticon-down-dir"))}}},l.render(),{class:"clearfix"}]},buildAppsSkeleton:function(){var t=new b([],{data:{platform:this.platform.get("id")}}),s=new b,i=new f({collection:t,platform:this.platform,collectionSelected:s,searchPlaceholder:x.get("Search Additional Apps")}),n=e.createElement("span",{class:"fonticon fonticon-down-dir",styles:{opacity:"1"}});return t.setLimit(999),t.fetch({onComplete:function(){i.render()}}),[{tag:"h5",html:[n,{tag:"span",text:x.get("Additional Apps")}],events:{click:function(){n.hasClassName("fonticon-down-dir")?(i.hide(),n.removeClassName("fonticon-down-dir").addClassName("fonticon-right-dir")):(i.show(),n.removeClassName("fonticon-right-dir").addClassName("fonticon-down-dir"))}}},i.render(),{class:"clearfix"}]},onClickInvite:function(){var e=this,t=[],s=e.elements.container.getBody().getElements(".table-selection tbody tr");if(!1===this.inviteInProgress&&!1===this.uploadInProgress)if(this.inviteInProgress=!0,s.forEach(function(s){var i=s.getElement("[name=licenses\\[\\]]:checked"),n=s.getElement("[name=licensed\\[\\]]"),o=s.getElement("[name=restricted\\[\\]]");e._canCrossCompany()?t.push({id:i.value,licensed:n&&n.checked,restricted:o&&o.checked}):t.push({id:i.value})}),e.modal.mask(),0===e.mode&&e.elements.tagger.getSelected().length>0&&(!0===e.platform.get("platform")||!1===e.platform.get("platform")&&t.length>0)){var i=e.viewStep1.getElement("[name=role]").value,n="0";"-1"!==i?n="0":(i="1",n="1"),u.platformInvite({platform:e.platform.get("id"),emails:e.elements.tagger.getSelected().join(","),role:i,agreement:n,language:e.viewStep1.getElement("[name=language]").value,text:e.viewStep1.getElement("[name=text]").value,licenses:JSON.stringify(t),company:e.viewStep1.getElement("[name=company]").value,casual:e.casualType.casual,location:this.locationsView&&this.locationsView.getValue()},{onComplete:function(t){e.inviteInProgress=!1,h.success(t.message),e.options.onAdded(),e.hide()},onFailure:function(){e.inviteInProgress=!1,e.hide()}})}else 1===e.mode&&(new y).save({platform:e.platform.get("id"),language:e.viewStep1.getElement("[name=language]").value,text:e.viewStep1.getElement("[name=text]").value,licenses:JSON.stringify(t),company:e.viewStep1.getElement("[name=company]").value,casual:e.casualType.casual,location:this.locationsView&&this.locationsView.getValue()},{patch:!0,onComplete:function(t){e.inviteInProgress=!1,e.uploadInProgress=!0,e.elements.form.inject(e.elements.container.elements.body),e.elements.iframe.inject(e.elements.container.elements.body),e.elements.form.addClassName("hidden"),e.elements.form.getElement("[name=__fcs__jobTicket]").setAttribute("value",t.get("fcsJobTicket")),e.elements.form.getElement("[name=file_0_name]").setAttribute("value",e.elements.form.getElement("[name=file_import]").value),e.elements.form.setAttribute("action",t.get("fcsUrl")),e.elements.form.setAttribute("target","uploadFrame"+e.id),e.elements.form.setAttribute("enctype","multipart/form-data"),e.elements.form.submit()},onFailure:function(){e.hide()}})},needSecondStep:function(){return!0===this.casualHasRole[this.casualType.casual]||this.options.hasApp},manageButtonNextText:function(){this.nextButton.setValue(this.getButtonNextText())},getInviteText:function(){return this.platform.isPlatform()?x.get("Invite"):x.get("Grant")},getButtonNextText:function(){return this.needSecondStep()?x.get("Next"):this.getInviteText()},getButtons:function(){var t=this,s=[];return 1===this.step?(s.push(new r({value:x.get("Back"),className:"default pull-left",events:{onClick:function(){t.step=0,t.nextButtonDisabled=!1,t.elements.container.setFooter(t.getButtons()),t.elements.container.setBody(t.viewStep1)}}})),this.nextButton=new r({value:this.getInviteText(),className:"primary",disabled:!1===t.platform.get("platform"),events:{onClick:this.onClickInvite.bind(this)}}),s.push(e.createElement("span",{class:"tooltip-wrapper",html:this.nextButton}))):(this.nextButton=new r({value:this.getButtonNextText(),className:"primary",disabled:t.nextButtonDisabled,events:{onClick:function(){this.needSecondStep()?(this.step=1,this.elements.container.setFooter(this.getButtons()),this.viewStep2=t.buildContent(),this.elements.container.setBody([this.viewStep2]),this.dispatchEvent("onNextViewRendered")):this.onClickInvite()}.bind(this)}}),s.push(e.createElement("div",{class:"tooltip-wrapper",html:this.nextButton}))),s.push(new r({className:"default",value:x.get("Cancel"),events:{onClick:function(){t.elements.container.hide()}}})),t.elements.container.buttons=s,s},setNextDisabled:function(e){var t=1===this.step?1:0;this.nextButton.setDisabled(e),e||this.dispatchEvent("onNextAvailable"),this.tooltip&&(this.tooltip.destroy(),this.tooltip=null),e&&(this.tooltip=new n({position:"top",target:this.elements.container.buttons[t],body:1===this.step?x.get("You need to select a least one role"):x.get("You need to add a least one email")})),this.nextButtonDisabled=e}})});