define("DS/W3DDriveWrapper/FrameLayout",["UWA/Core","i18n!DS/W3DDriveWrapper/assets/nls/W3DDriveWrapper"],function(e,t){"use strict";return{getOptions:function(){return setTimeout(function(){require(["DS/TopBar/TopBar"],function(t){t.addEvent({events:{search:function(t){e.Widgets.instances[1].dispatchEvent("onSearch",t.value)},clearSearch:function(){e.Widgets.instances[1].dispatchEvent("onSearch","")}}})}),require(["DS/TopBarProxy/TopBarProxy","DS/i3DXCompassServices/i3DXCompassServices"],function(e,n){const i=new e({id:"helpMenu"});n.getPlatformServices({onComplete:function(e){e.forEach(function(e){e&&e.hasOwnProperty("3DPassport")&&i.setContent({profile:[{label:t.get("logout"),onExecute:function(){document.location.href=e["3DPassport"].replace(e.platformId.toLowerCase()+"-","")+"/cas/logout?service="+encodeURIComponent(window.location.href)}}]})})}})})},3e3),{brand:"3DDrive",application:"",topMenus:["profile","help"],useTagger:!1,activateLegal:!1,activateFederatedSearch:!1,userId:"",topFrameVue:null,activateAbout:!1}}}}),define("DS/W3DDriveWrapper/saveToMyDrive/saveToMyDriveController",["DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/W3DDrive/Utils/drives","UWA/String","UWA/Array","DS/W3DContentApp/Utils/RequestHelper","DS/i3DXCompass/Data","i18n!DS/W3DDriveWrapper/assets/nls/saveToMyDrive"],function(e,t,n,i,o,r,s){"use strict";return{view:null,drivesLoaded:!1,selectedTenant:null,initialized:!1,binded:!1,treeLoading:{root:{title:s.loading_tree,id:-2}},loadingTenants:{root:{title:s.loading_tenants,id:-1}},noTenantSelected:{root:{title:s.select_tenant,id:-1}},setView:function(e){this.view=e,this.bindToViewEvents()},loadDrives:function(){var e=this;return new Promise(function(n,i){e.drivesLoaded&&n(),t.fetch({reset:!0,merge:!1,onComplete:function(){e.drivesLoaded=!0,n()},onFailure:i})})},loadNode:function(e){var t=this;return new Promise(function(n,i){var o={};e.isFolder()?(o.title=e.get("title"),o.id=e.get("id"),e.inodeTable?e.inodeTable.fetch({reset:e.inodeTable.isEmpty(),remove:!1,merge:!0,onComplete:function(){e.inodeTable.length>0?(o.children=[],e.inodeTable.forEach(function(i){t.loadNode(i).then(function(t){o.children.push(t),o.children.length===e.inodeTable.length&&n(o)})})):n(o)},onFailure:i}):n(o)):n(o)})},refreshTree:function(e){if(this.selectedTenant=e,e){this.view.updateTree(this.treeLoading);var n=this;this.loadDrives().then(function(){var i=t.get(e);if(i){var o=i.getRootInodes().first();n.loadNode(o).then(function(t){n.selectedTenant===e&&n.view.updateTree({root:t})})}})}else this.view.updateTree(this.noTenantSelected)},run:function(){if(this.initialized&&this.binded){var t=this;t.view.updateTree(t.loadingTenants),e.getPlatformServices({onComplete:function(e){var n=[];e.forEach(function(e){n.push({label:e.displayName,value:e.platformId,url:e["3DDrive"]})}),t.tenants=n,t.view.setTenants(n)},onFailure:function(){console.log("fail"),console.log(r)}})}},init:function(e,t){this.view.setTitle(e),r.initialize({myAppsBaseUrl:t,userId:"USER_ID"}),this.initialized=!0,this.run()},_performAutoname:function(e,t,r,s){var a=this;return new Promise(function(l,c){var u={data:{}};u.data.receipt=s,u.data.title=r,u.data.file=r,u.data.description="",u.data.type="Document";var d=i.detect(a.tenants,function(t){return t.value===e});d||c(-1),u.url=n.format("{0}/resources/3ddrive/v1/bos/{1}/contents/autoname?withactions=true&tenant={2}&xrequestedwith=xmlhttprequest",d.url,t,e),u.data=JSON.stringify(u.data),u.type="json",u.method="POST",u.onComplete=l,u.onFailure=c,u.headers=u.headers||{},u.headers["Content-Type"]="application/json;charset=UTF-8",u.auth={},o.performRequestWithOptions(u.url,u)})},addContent:function(e,t,n,i){var o=this;o._performAutoname(e,t,n,i).then(function(){o.finalize(!0)},function(){o.finalize(!1)})},finalize:function(e){console.log("Success = "+e)},cancel:function(){},submit:function(e,t,n){},bindToViewEvents:function(){var e=this;this.view.onTenantSelectionChange=function(t){e.refreshTree(t)},this.view.onPublish=this.submit,this.view.onCancel=this.cancel,this.binded=!0}}}),define("DS/W3DDriveWrapper/saveToMyDrive/saveToMyDriveView",["UWA/Array","DS/UIKIT/Modal","DS/UIKIT/Input/Button","DS/UIKIT/Form","DS/Tree/FileTreeView","DS/Tree/TreeDocument","DS/Tree/TreeNodeModel","DS/W3DContentApp/Utils/drivesInputs","i18n!DS/W3DDriveWrapper/assets/nls/saveToMyDrive","css!DS/UIKIT/UIKIT.css","css!DS/W3DDriveWrapper/W3DDriveWrapper.css"],function(e,t,n,i,o,r,s,a,l){var c=a({drive:{id:"3ddrive"},id:"0",get:function(){return"abc"},isFolder:function(){return!0}});return function(){this.checkFields=function(){this.getFormValues()?this.validatedButton.enable():this.validatedButton.disable()},this.getFormValues=function(){var t=this.form.getValues(),n=e.detect(this.tenants,function(e){return e.value===t.tenant});if(!n.value)return null;var i=this.getSelectedNode();return n&&i&&i.options.id&&t.filename?{tenant:n,folderId:i.options.id,fileName:t.filename}:null},this.publish=function(){var e=this.getFormValues();e&&this.onPublish(e.tenant,e.folderId,e.fileName.trim())},this.cancel=function(){this.container.destroy(),delete this.container,delete this.title,delete this.tenants,delete this.tree,this.onCancel()},this.onPublish=function(e,t,n){console.log("Publish",e,t,n)},this.onCancel=function(){console.log("Cancel")},this.onTenantSelectionChange=function(e){},this.container=new t({className:"saveToMyDrive",escapeToClose:!1,closable:!1,overlay:!1,visible:!0,header:"",body:"",footer:""}),this.title=null,this.tenants=[];var a=this;this.tree,this.setTitle=function(e){this.title=e;var t=this.form.getField("filename");t&&(t.value=this.title)},this.setTenants=function(e){e[0].selected=!0,this.onTenantSelectionChange(e[0].value),this.tenants=e;var t=this.form.options.fields[0];t.options=this.tenants;var n=this.form.fields[t.type](t,this.form);this.form.elements.container.replaceChild(n,this.form.elements.container.querySelector(".form-group")),this.tenants.length<3?this.form.elements.container.querySelector(".form-group").hide():this.form.elements.container.querySelector(".form-group").show()},this.updateTree=function(e){if(e&&(this.tree=e),this.treeView&&this.tree&&this.tree.root){this.treeView.options.treeDocument.removeRoots();var t=this.treeObjectToNode(this.tree.root);this.treeView.options.treeDocument.addChild(t),-1===this.tree.root.id||-2===this.tree.root.id?t.options.icons=null:(t.select(),t.expand())}},this.treeObjectToNode=function(e){var t=[];return e.children&&e.children.map(function(e){e.hasOwnProperty("id")&&t.push(a.treeObjectToNode(e))}),new s({label:e.title,children:t.length>0?t:null,icons:[{iconName:"folder"}],id:null!=e.id?e.id:null,isSelectable:!0})},this.createTreeMap=function(){if(!this.treeView){var e=new r({shouldBeSelected:function(e){return e.options.isSelectable},shouldAcceptDrag:function(){return!1},shouldAcceptDrag:function(){return!1}}),t=this;e.flattenTreeDocument({onUpdate:function(){t.checkFields()}}),this.treeView=new o({treeDocument:e,selection:{toggle:!1},enableExpandOnDoubleClick:!0,height:"inherit",enableDragAndDrop:!1})}return this.treeView.elements.container},this.getSelectedNode=function(){var e=this.treeView.options.treeDocument.getXSO().get();return e.length>0?e[0]:null},this.render=function(){var e=this;this.container.elements.body.empty(),this.form=new i({fields:[{type:"select",label:" ",placeholder:l.select_platform,name:"tenant",options:this.tenants,events:{onChange:function(t){e.checkFields(),e.onTenantSelectionChange(t.target.value)}}},{type:"custom",className:"tree-map"},{type:"field",placeholder:l.title,name:"filename",value:this.title,pattern:c.forbiddenChars.regex,errorText:c.forbiddenChars.text,events:{onKeyDown:function(t){setTimeout(function(){e.checkFields()},1)}}}],buttons:[{type:"submit",value:l.publish}],events:{onSubmit:function(){e.publish()}}}).inject(this.container.elements.body);var t=this.form.buttons[0];t.hide(),this.validatedButton=new n({value:l.publish,className:"primary",disabled:!0,events:{onClick:function(e){t.elements.input.click()}}}).inject(this.container.elements.footer),new n({value:l.cancel,className:"default",events:{onClick:function(t){e.cancel()}}}).inject(this.container.elements.footer);var o=this.container.elements.body.querySelector(".tree-map");return o.parentElement.replaceChild(this.createTreeMap(),o),this},this.inject=function(e){this.container.elements.body,this.container.inject(e)}}});