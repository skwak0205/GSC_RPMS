define("DS/MPFShopFormComponent/CompanyInformationSection",["UWA/Class/View","UWA/Core","DS/MPFServices/MarketplaceServices","DS/MPFServices/ObjectService","DS/MPFCountryModel/CountryCollection","DS/MPFCompanyModel/CompanyModel","DS/MPFShopModel/ShopModel","DS/MPFShopModel/ShopServiceModel","DS/MPFAddressModel/AddressModel","DS/MPFAddressModel/AddressFactory","DS/MPFCompanyComponent/CompanyNameInput","DS/MPFAddressFormComponent/AddressFormComponentV2","DS/MPFCurrencySelectComponent/CurrencySelectComponent","i18n!DS/MPFShopFormComponent/assets/nls/ShopFormComponent","css!DS/MPFShopFormComponent/MPFShopFormComponent"],function(e,t,o,s,n,i,r,a,h,c,d,p,l,m){"use strict";return e.extend({className:"mpf-shop-form-v2-section mpf-company-section mpf-form",setup:function(e){e||(e={}),this._checkPrototypes(e),this._parent(e),this.service=e.service||o.ENGINEERING,this.addressFactory=e.addressFactory,this.address=e.address,this.company=e.company,this.shop=e.shop,this.shopService=e.shopService,this.countries=e.countries,this.readOnly=e.readOnly,this.isCompanyReadOnly=e.isCompanyReadOnly,this.isCountryReadOnly=e.isCountryReadOnly,this.title=this._createTitleContainer(),this.guidance=this._createGuidanceContainer(),this.companyNameInput=this._createCompanyNameInput(),this.addressForm=this._createAddresFormComponent(),this.currencySelect=this._createCurrencySelect(),this.isCountryReadOnly||this.isCompanyReadOnly||this.listenTo(this.address,"onChange:"+h.Fields.COUNTRY,this._onCountryChange.bind(this))},render:function(){var e,o;return e=t.createElement("div",{class:"mpf-section-form",html:[this.companyNameInput.render(),this.addressForm.render(),this.currencySelect.render()]}),o=t.createElement("div",{class:"mpf-section-content",html:[e,this.guidance]}),this.container.setContent([this.title,o]),this},validate:function(){var e=this.companyNameInput.validate().isValid,t=this.addressForm.validate(),o=this.currencySelect.validate().isValid;return e&&t&&o},saveAdress:function(e){return this.addressForm.savePromise(e)},_createGuidanceContainer:function(){var e,o,s;return e=t.createElement("span",{class:"fonticon fonticon-info"}),o=t.createElement("p",{html:[e,t.createElement("span",{text:m.get("companyGuidanceText1")})]}),s=t.createElement("p",{text:m.get("companyGuidanceText2")}),t.createElement("div",{class:"mpf-section-guidance",html:[o,s]})},_checkCurrencyLock:function(){t.is(this.shop.getServices())&&t.is(this.shop.getServices().products)&&this.shop.getServices().products.length>0&&this.currencySelect.setReadOnly(!0)},_onCountryChange:function(){this.company.setCountry(this.address.getCountry())},_createCurrencySelect:function(){return new l({model:this.shop,readOnly:!this.shop.isNew()})},_createTitleContainer:function(){return t.createElement("div",{class:"mpf-section-title",text:m.get("companyInformation")})},_createCompanyNameInput:function(){return new d({model:this.company,readOnly:!0===this.isCompanyReadOnly,required:!0,maxlength:120,dynamicValidation:!0})},_createAddresFormComponent:function(){return new p({addressModel:this.address,addressConstraints:this.addressFactory.getConstraints(),countries:this.countries,countryReadOnly:this.isCountryReadOnly,readOnly:this.readOnly||this.isCompanyReadOnly,horizontalLayout:!0})},_checkPrototypes:function(e){s.requiredOfPrototype(e.countries,n,"options.countries must be a CountryCollection"),s.requiredOfPrototype(e.address,h,"options.addressModel must be an AddressModel"),s.requiredOfPrototype(e.company,i,"options.companyModel must be a CompanyModel"),s.requiredOfPrototype(e.addressFactory,c,"options.addressFactory must be an AddressFactory"),s.requiredOfPrototype(e.shop,r,"options.shop must be a ShopModel"),t.is(e.shopService)&&s.requiredOfPrototype(e.shopService,a,"options.shopService must be a ShopServiceModel")},destroy:function(){this.stopListening(),this.company=null,this.address=null,this.shop=null,this.shopService=null,this.countries=null,this._parent(),this.container=null}})}),define("DS/MPFShopFormComponent/CurrencySection",["UWA/Class/View","UWA/Core","DS/MPFServices/MarketplaceServices","DS/MPFServices/ObjectService","DS/MPFShopModel/ShopModel","DS/MPFShopModel/ShopServiceModel","DS/MPFCurrencySelectComponent/CurrencySelectComponent","i18n!DS/MPFShopFormComponent/assets/nls/ShopFormComponent","css!DS/MPFShopFormComponent/MPFShopFormComponent"],function(e,t,o,s,n,i,r,a){"use strict";return e.extend({className:"mpf-shop-form-v2-section mpf-currency-section mpf-form",setup:function(e){e||(e={}),this._checkPrototypes(e),this._parent(e),this.service=e.service||o.ENGINEERING,this.shop=e.shop,this.shopService=e.shopService,this.title=this._createTitleContainer(),this.guidance=this._createGuidanceContainer(),this.currencySelect=this._createCurrencySelect()},render:function(){var e,o;return e=t.createElement("div",{class:"mpf-section-form",html:this.currencySelect.render()}),o=t.createElement("div",{class:"mpf-section-content",html:[e,this.guidance]}),this.container.setContent([this.title,o]),this},validate:function(){return this.currencySelect.validate().isValid},_createGuidanceContainer:function(){var e,o;return e=t.createElement("span",{class:"fonticon fonticon-info"}),o=t.createElement("p",{html:[e,t.createElement("span",{text:a.get("currencyGuidanceText")})]}),t.createElement("div",{class:"mpf-section-guidance",html:o})},_createTitleContainer:function(){return t.createElement("div",{class:"mpf-section-title",text:a.get("currency")})},_areFieldsReadOnly:function(){return this.readOnly||this.shop.getState()===n.States.SUBMITTED||this.shop.getState()===n.States.ACTIVE&&this.shopService&&this.shopService.getState()===i.States.SUBMITTED},_createCurrencySelect:function(){return new r({model:this.shop,readOnly:this._areFieldsReadOnly()})},_checkPrototypes:function(e){s.requiredOfPrototype(e.shop,n,"options.shop must be a ShopModel"),t.is(e.shopService)&&s.requiredOfPrototype(e.shopService,i,"options.shopService must be a ShopServiceModel")},destroy:function(){this.shop=null,this.shopService=null,this._parent(),this.container=null}})}),define("DS/MPFShopFormComponent/LegalEntityTypeSelector",["UWA/Core","UWA/Class/View","DS/UIKIT/Input/Toggle","i18n!DS/MPFShopFormComponent/assets/nls/ShopFormComponent","css!DS/MPFShopFormComponent/MPFShopFormComponent"],function(e,t,o,s){"use strict";return t.extend({className:"mpf-legal-entity-type",setup:function(e){e||(e={}),this.individualToggle=this._createIndividualToggle(),this.companyToggle=this._createCompanyToggle()},render:function(){return this.container.setContent([this.individualToggle,this.companyToggle]),this},_createIndividualToggle:function(){var e=this;return new o({className:"primary",name:"individualToggle",value:"individual",label:s.get("individual"),checked:!0,events:{onChange:function(){this.isChecked()&&(e.companyToggle.setCheck(!1),e.dispatchEvent("legalEntityTypeChanged","individual"))}}})},_createCompanyToggle:function(){var e=this;return new o({className:"primary",name:"companyToggle",value:"company",label:s.get("company"),checked:!1,events:{onChange:function(){this.isChecked()&&(e.individualToggle.setCheck(!1),e.dispatchEvent("legalEntityTypeChanged","company"))}}})}})}),define("DS/MPFShopFormComponent/ShopInputs",["UWA/Core","UWA/String","UWA/Promise","UWA/Class/View","DS/UIKIT/Tooltip","DS/MPFServices/MarketplaceServices","DS/MPFPersonModel/PersonModel","DS/MPFShopModel/ShopModel","DS/MPFShopModel/ShopServiceModel","DS/MPFShopModel/ShopFactory","DS/MPFShopModel/ShopServiceFactory","DS/MPFCurrencySelectComponent/CurrencySelectComponent","DS/MPFView/FieldTextInputV2","DS/MPFServices/ObjectService","i18n!DS/MPFShopFormComponent/assets/nls/ShopFormComponent","css!DS/MPFShopFormComponent/MPFShopFormComponent"],function(e,t,o,s,n,i,r,a,h,c,d,p,l,m,u){"use strict";return s.extend({className:"mpf-shop-inputs",domEvents:{'change input[name="shopName"]':"_onShopChange",'change input[name="email"]':"_onShopChange",'change input[name="phoneNumber"]':"_onShopChange",'change select[name="supportedCurrencies"]':"_onShopChange"},setup:function(t){t||(t={}),m.requiredOfPrototype(t.me,r,"options.me must be a PersonModel"),m.requiredOfPrototype(t.shopModel,a,"options.shopModel must be a ShopModel"),m.requiredOfPrototype(t.shopFactory,c,"options.shopFactory must be a ShopFactory"),m.requiredOfPrototype(t.shopServiceFactory,d,"options.shopServiceFactory must be a ShopServiceFactory"),t.shopService&&m.requiredOfPrototype(t.shopService,h,"options.shopService must be a ShopServiceModel"),this._parent(t),this.service=t.service||i.ENGINEERING,this.me=t.me,this.shopModel=t.shopModel,this.shopService=t.shopService,this.shopFactory=t.shopFactory,this.shopServiceFactory=t.shopServiceFactory,this.serviceTerm=e.is(t.serviceTerm,"string")?t.serviceTerm:u.get("lab"),this.readOnly=t.readOnly,this.labNameInput=this._createLabNameInput(),this.emailInput=this._createEmailInput(),this.phoneInput=this._createPhoneInput(),this.currencySelectComponent=this._createCurrencySelect(),this.shopHasChanged=!1},render:function(){return this.container.setContent([this.labNameInput.render(),this.emailInput.render(),this._displayInfoMessages("emailPhoneInfo"),this.phoneInput.render(),this.currencySelectComponent.render()]),this._displayCurrencyTooltip(),this._checkCurrencyLock(),this},disable:function(e){var t;t=!1!==e,this.labNameInput.setDisabled(t),this.emailInput.setDisabled(t),this.phoneInput.setDisabled(t),this.currencySelectComponent.setReadOnly(t)},save:function(e){var t=this;return this.validate()?(this.shopModel.setOwner(e.ownerID),this.shopModel.setAddress(e.addressID),this.shopModel.unset(a.Fields.IS_COMPANY),this.shopModel.isNew()?this.shopModel.savePromise().then(function(){var e;return t.shopHasChanged=!1,(e=t.shopService||t.shopServiceFactory.createModel("shop")).set(h.Fields.IS_AVAILABLE_FOR_TENDER,t.service===i.MAKE),e.parentResourceId=t.shopModel.get("id"),e.savePromise()}):this.shopHasChanged?(this.shopModel.dataProxy=this.shopFactory.getDataProxy("shop"),this.shopModel.savePromise(null,{method:"PUT"}).then(function(e){t.shopHasChanged=!1})):o.resolve()):o.reject("Shop validation failed")},validate:function(){var e,t,o,s;return e=this.labNameInput.validate().isValid,t=this.emailInput.validate().isValid,o=this.phoneInput.validate().isValid,s=this.currencySelectComponent.validate().isValid,e&&t&&o&&s},_areFieldsReadOnly:function(){return this.readOnly||this.shopModel.getState()===a.States.SUBMITTED||this.shopModel.getState()===a.States.ACTIVE&&this.shopService&&this.shopService.getState()===h.States.SUBMITTED},_checkCurrencyLock:function(){e.is(this.shopModel.getServices())&&e.is(this.shopModel.getServices().products)&&this.shopModel.getServices().products.length>0&&this.currencySelectComponent.setReadOnly(!0)},_displayCurrencyTooltip:function(){var t;if(t=this.container.getElement(".mpf-select-v2 .fonticon-info-circled"),!e.is(t))return(t=e.createElement("span",{class:"fonticon fonticon-info-circled"})).inject(this.container.getElement(".mpf-select-v2 .mpf-label")),new n({position:"right",target:t,body:u.get("currencyInfo")})},_onShopChange:function(){this.shopHasChanged=!0},_displayInfoMessages:function(o){return e.createElement("div",{class:"mpf-infoData "+o,html:[e.createElement("span",{class:"fonticon fonticon-info-circled"}),"&nbsp;",t.format(u.get(o),this.serviceTerm)]})},_createLabNameInput:function(){var e=t.ucfirst(t.format(u.get("serviceName"),this.serviceTerm));return new l({model:this.shopModel,fieldName:a.Fields.NAME,fieldLabel:e,required:!0,readOnly:this._areFieldsReadOnly(),dynamicValidation:!0,maxlength:40,silent:!1,trim:!0})},_createEmailInput:function(){return new l({model:this.shopModel,fieldName:a.Fields.EMAIL,fieldLabel:u.get("emailAddress"),required:!0,readOnly:this._areFieldsReadOnly(),dynamicValidation:!0,trim:!0,maxlength:70})},_createPhoneInput:function(){return new l({model:this.shopModel,fieldName:a.Fields.PHONE_NUMBER,fieldLabel:u.get("phoneNumber"),required:!0,readOnly:!this.me.isDSOperator()&&this._areFieldsReadOnly(),dynamicValidation:!0,trim:!0,type:"tel"})},_createCurrencySelect:function(){return new p({model:this.shopModel,readOnly:this._areFieldsReadOnly()})},destroy:function(){this.shopModel=null,this.shopService=null,this.model=null,this._parent(),this.container=null}})}),define("DS/MPFShopFormComponent/LabInformationSection",["UWA/Class/View","UWA/Core","UWA/String","DS/MPFServices/MarketplaceServices","DS/MPFServices/ObjectService","DS/MPFShopModel/ShopModel","DS/MPFShopModel/ShopServiceModel","DS/MPFView/FieldTextInputV2","i18n!DS/MPFShopFormComponent/assets/nls/ShopFormComponent","css!DS/MPFShopFormComponent/MPFShopFormComponent"],function(e,t,o,s,n,i,r,a,h){"use strict";return e.extend({className:"mpf-shop-form-v2-section mpf-lab-section mpf-form",setup:function(e){e||(e={}),this._checkPrototypes(e),this._parent(e),this.service=e.service||s.ENGINEERING,this.shop=e.shop,this.shopService=e.shopService,this.serviceTerm=e.serviceTerm,this.readOnly=!0===e.readOnly,this.title=this._createTitleContainer(),this.guidance=this._createGuidanceContainer(),this.labNameInput=this._createLabNameInput()},render:function(){var e,o;return e=t.createElement("div",{class:"mpf-section-form",html:this.labNameInput.render()}),o=t.createElement("div",{class:"mpf-section-content",html:[e,this.guidance]}),this.container.setContent([this.title,o]),this},validate:function(){return this.labNameInput.validate().isValid},_createGuidanceContainer:function(){var e,o;return e=t.createElement("span",{class:"fonticon fonticon-info"}),o=t.createElement("p",{html:[e,t.createElement("span",{text:h.get("labGuidanceText")})]}),t.createElement("div",{class:"mpf-section-guidance",html:o})},_createTitleContainer:function(){return t.createElement("div",{class:"mpf-section-title",text:h.get("labInformation")})},_createLabNameInput:function(){var e=o.ucfirst(o.format(h.get("serviceName"),this.serviceTerm));return new a({model:this.shop,fieldName:i.Fields.NAME,fieldLabel:e,required:!0,readOnly:this._areFieldsReadOnly(),dynamicValidation:!0,maxlength:40,silent:!1,trim:!0})},_areFieldsReadOnly:function(){return this.readOnly||this.shop.getState()===i.States.SUBMITTED||this.shop.getState()===i.States.ACTIVE&&this.shopService&&this.shopService.getState()===r.States.SUBMITTED},_checkPrototypes:function(e){n.requiredOfPrototype(e.shop,i,"options.shop must be a ShopModel"),t.is(e.shopService)&&n.requiredOfPrototype(e.shopService,r,"options.shopService must be a ShopServiceModel")},destroy:function(){this.shop=null,this.shopService=null,this._parent(),this.container=null}})}),define("DS/MPFShopFormComponent/ContactInformationSection",["UWA/Class/View","UWA/Core","DS/MPFServices/MarketplaceServices","DS/MPFServices/ObjectService","DS/MPFPersonModel/PersonModel","DS/MPFCompanyModel/CompanyModel","DS/MPFShopModel/ShopModel","DS/MPFShopModel/ShopServiceModel","DS/MPFCompanyComponent/CompanyCeoInputs","DS/MPFView/FieldTextInputV2","i18n!DS/MPFShopFormComponent/assets/nls/ShopFormComponent","css!DS/MPFShopFormComponent/MPFShopFormComponent"],function(e,t,o,s,n,i,r,a,h,c,d){"use strict";return e.extend({className:"mpf-shop-form-v2-section mpf-contact-section mpf-form",setup:function(e){e||(e={}),this._checkPrototypes(e),this._parent(e),this.service=e.service||o.ENGINEERING,this.me=e.me,this.company=e.company,this.shop=e.shop,this.shopService=e.shopService,this.isCompanyReadOnly=e.isCompanyReadOnly,this.readOnly=!0===e.readOnly,this.title=this._createTitleContainer(),this.guidance=this._createGuidanceContainer(),this.ceoForm=this._createCeoForm(),this.emailInput=this._createEmailInput(),this.phoneInput=this._createPhoneInput()},render:function(){var e,o;return e=t.createElement("div",{class:"mpf-section-form",html:[this.ceoForm.render(),this.emailInput.render(),this.phoneInput.render()]}),o=t.createElement("div",{class:"mpf-section-content",html:[e,this.guidance]}),this.container.setContent([this.title,o]),this},validate:function(){var e,t,o;return e=this.ceoForm.validate(),t=this.emailInput.validate().isValid,o=this.phoneInput.validate().isValid,e&&t&&o},_createCeoForm:function(){return new h({model:this.company,readOnly:!0===this.isCompanyReadOnly,required:!0,maxlength:255,dynamicValidation:!0})},_createEmailInput:function(){return new c({model:this.shop,fieldName:r.Fields.EMAIL,fieldLabel:d.get("emailAddress"),required:!0,readOnly:this._areFieldsReadOnly(),dynamicValidation:!0,trim:!0,maxlength:70})},_createPhoneInput:function(){return new c({model:this.shop,fieldName:r.Fields.PHONE_NUMBER,fieldLabel:d.get("phoneNumber"),required:!0,readOnly:!this.me.isDSOperator()&&this._areFieldsReadOnly(),dynamicValidation:!0,trim:!0,type:"tel"})},_createGuidanceContainer:function(){var e,o,s;return e=t.createElement("span",{class:"fonticon fonticon-info"}),o=t.createElement("p",{html:[e,t.createElement("span",{text:d.get("contactGuidanceText1")})]}),s=t.createElement("p",{text:d.get("contactGuidanceText2")}),t.createElement("div",{class:"mpf-section-guidance",html:[o,s]})},_createTitleContainer:function(){return t.createElement("div",{class:"mpf-section-title",text:d.get("contactInformation")})},_areFieldsReadOnly:function(){return this.readOnly||this.shop.getState()===r.States.SUBMITTED||this.shop.getState()===r.States.ACTIVE&&this.shopService&&this.shopService.getState()===a.States.SUBMITTED},_checkPrototypes:function(e){s.requiredOfPrototype(e.me,n,"options.me must be a PersonModel"),s.requiredOfPrototype(e.shop,r,"options.shop must be a ShopModel"),s.requiredOfPrototype(e.company,i,"options.company must be a CompanyModel"),t.is(e.shopService)&&s.requiredOfPrototype(e.shopService,a,"options.shopService must be a ShopServiceModel")},destroy:function(){this.company=null,this.shop=null,this._parent(),this.container=null}})}),define("DS/MPFShopFormComponent/ShopFormComponent",["UWA/Core","UWA/String","UWA/Promise","UWA/Class/View","DS/UIKIT/Input/Button","DS/UIKIT/Mask","DS/MPFServices/MarketplaceServices","DS/MPFLegalEntityType/LegalEntityType","DS/MPFCountryModel/CountryCollection","DS/MPFShopModel/ShopModel","DS/MPFShopModel/ShopServiceModel","DS/MPFCompanyModel/CompanyModel","DS/MPFAddressModel/AddressModel","DS/MPFPersonModel/PersonModel","DS/MPFAddressModel/AddressFactory","DS/MPFShopModel/ShopFactory","DS/MPFShopModel/ShopServiceFactory","DS/MPFAddressFormComponent/AddressFormComponentV2","DS/MPFCompanyComponent/CompanyShopForm","DS/MPFShopFormComponent/ShopInputs","DS/MPFPersonComponent/PersonNameForm","DS/UIKIT/Alert","DS/UIKIT/Mask","DS/PlatformAPI/PlatformAPI","DS/MPFServices/ObjectService","DS/MPFError/ValidationError","i18n!DS/MPFShopFormComponent/assets/nls/ShopFormComponent","css!DS/MPFShopFormComponent/MPFShopFormComponent"],function(e,t,o,s,n,i,r,a,h,c,d,p,l,m,u,y,S,f,v,C,F,M,g,P,_,O,I){"use strict";const D=s.extend({className:"mpf-form mpf-shop-form mpf-horizontal",tagName:"form",domEvents:{'change select[name="country"]':"_onCountryChange",'change input[name*="addressLine"]':"_onAddressChange",'change input[name="city"]':"_onAddressChange",'change input[name="state"]':"_onAddressChange",'change select[name="state"]':"_onAddressChange",'change input[name="postalCode"]':"_onAddressChange"},setup:function(t){t||(t={}),this._checkPrototypes(t),this._parent(t),this.service=t.service||r.ENGINEERING,this.addressFactory=t.addressFactory,this.shopFactory=t.shopFactory,this.shopServiceFactory=t.shopServiceFactory,this.me=t.me,this.shopModel=this.model,this.shopService=t.shopService,this.countries=t.countries,this.companyModel=t.companyModel,this.addressModel=t.addressModel,this.serviceTerm=e.is(t.serviceTerm,"string")?t.serviceTerm:I.get("lab"),this.readOnly=!0===t.readOnly&&!this.me.isDSOperator(),this.isCompanyReadOnly=this.readOnly||!!this.companyModel.getDrupalId(),this.isCountryReadOnly=this.readOnly||!!this.companyModel.getCountry()||!!this.companyModel.getDrupalId(),this.legalEntityType=a.COMPANY,this.isLegalEntityTypeDetermined=!0,this.alert=this._createAlert(),this.legalEntityForm=this._createLegalEntityForm(),this.addressForm=this._createAddresFormComponent(),this.shopForm=this._createShopInputs(),this.addressHasChanged=!1,this.saveButtonOperator=this._createSaveButtonOperator()},render:function(){const e=[this.alert,this.legalEntityForm.render(),this._displayInfoMessages(),this.shopForm.render(),this.addressForm.render()];return this.me.isDSOperator()&&e.push(this.saveButtonOperator),this.container.setContent(e),this},validate:function(){if(!this.readOnly){const e=this.legalEntityForm.validate(),t=this.addressForm.validate(),o=this.shopForm.validate();return e&&t&&o}},save:function(){const e=this,t=o.deferred(),s=this.shopModel.isCompany(),n={};return this.readOnly?t.resolve():this.validate()?this.legalEntityForm.save().then(this._saveAddressForm.bind(this)).then(function(){return e.addressHasChanged=!1,n.addressID=e.addressModel.get("id"),n.ownerID=s?e.companyModel.get("id"):e.me.get("id"),e.shopForm.save(n)}).then(function(o){const n=[];s?n.push(e.companyModel):n.push(e.me),n.push(e.addressModel),n.push(e.shopModel),o&&n.push(o),t.resolve(n),P.publish("labInfoPage",{completed:!0}),P.publish("newLabCreated",{id:e.model.id})}).catch(function(o){let s;Object.prototype.isPrototypeOf.call(Error.prototype,o)?s=o.toString()||I.get("errorMsg"):(s=I.get("errorMsg"),o=new Error(s)),e.alert.add({className:"error",message:s}).show(),t.reject(o)}):t.reject(new O("ShopFormComponent validation failed")),t.promise},_onTypeChanged:function(e){"company"===e?(this.legalEntityForm=this._createCompanyForm(),this.shopModel.set(c.Fields.IS_COMPANY,!0)):"individual"===e&&(this.legalEntityForm=this._createPersonForm(),this.shopModel.set(c.Fields.IS_COMPANY,!1)),this.render()},_saveAddressForm:function(){const e=this.shopModel.isCompany();return this.addressModel.isNew()?e?(this.addressModel.dataProxy=this.addressFactory.getDataProxy("companyAddress"),this.addressModel.parentResourceId=this.companyModel.get("id"),this.addressForm.savePromise()):(this.addressModel.dataProxy=this.addressFactory.getDataProxy("me"),this.addressForm.savePromise()):this.addressHasChanged?(this.addressModel.dataProxy=this.addressFactory.getDataProxy("address"),this.addressForm.savePromise({method:"PUT"})):o.resolve()},_createAlert:function(){return new M({closable:!0,visible:!1})},_createSaveButtonOperator:function(){const e=this;return new n({className:"primary",value:I.get("save"),events:{onClick:function(){return i.mask(e.saveButtonOperator.elements.container),e.save().finally(i.unmask.bind(i,e.saveButtonOperator.elements.container))}}})},_createAddresFormComponent:function(){return new f({addressModel:this.addressModel,addressConstraints:this.addressFactory.getConstraints(),countries:this.countries,countryReadOnly:this.isCountryReadOnly,readOnly:this.readOnly||this.isCompanyReadOnly,horizontalLayout:!0,preSetCountry:this.isCountryReadOnly&&this.companyModel.getCountry()})},_createShopInputs:function(){return new C({service:this.service,me:this.me,shopModel:this.shopModel,shopService:this.shopService,shopFactory:this.shopFactory,shopServiceFactory:this.shopServiceFactory,serviceTerm:this.serviceTerm,readOnly:this.readOnly})},_createLegalEntityForm:function(){return this.isLegalEntityTypeDetermined?e.equals(this.legalEntityType,a.COMPANY)?(this.shopModel.set(c.Fields.IS_COMPANY,!0),this._createCompanyForm()):e.equals(this.legalEntityType,a.INDIVIDUAL)?(this.shopModel.set(c.Fields.IS_COMPANY,!1),this._createPersonForm()):void 0:(this.shopModel.set(c.Fields.IS_COMPANY,!1),this._createPersonForm())},_createPersonForm:function(){return new F({model:this.me,required:!0,readOnly:!0,lockSave:!0,horizontalLayout:!0})},_createCompanyForm:function(){return new v({model:this.companyModel,readOnly:this.isCompanyReadOnly})},_getLegalEntityType:function(){return a.fromPerson(this.me)},_displayInfoMessages:function(){return e.createElement("div",{class:"mpf-infoData ceoInfo",html:[e.createElement("span",{class:"fonticon fonticon-info-circled"}),"&nbsp;",I.get("ceoInfo"),e.createElement("br"),e.createElement("br"),t.ucfirst(t.format(I.get("shopNameInfo"),t.ucfirst(t.format(I.get("serviceName"),this.serviceTerm))))]})},_onAddressChange:function(e){this.addressHasChanged=!0},_onCountryChange:function(){this.companyModel.setCountry(this.addressModel.getCountry()),this._onAddressChange()},_checkPrototypes:function(e){_.requiredOfPrototype(e.me,m,"options.me must be a PersonModel"),_.requiredOfPrototype(this.model,c,"this.model must be a ShopModel"),_.requiredOfPrototype(e.countries,h,"options.countries must be a CountryCollection"),_.requiredOfPrototype(e.addressModel,l,"options.addressModel must be an AddressModel"),_.requiredOfPrototype(e.companyModel,p,"options.companyModel must be a CompanyModel"),_.requiredOfPrototype(e.addressFactory,u,"options.addressFactory must be an AddressFactory"),_.requiredOfPrototype(e.shopFactory,y,"options.shopFactory must be a ShopFactory"),_.requiredOfPrototype(e.shopServiceFactory,S,"options.shopServiceFactory must be a ShopServiceFactory"),e.shopService&&_.requiredOfPrototype(e.shopService,d,"options.shopService must be a ShopServiceModel")},destroy:function(){this.model=null,this.me=null,this.shopService=null,this._parent(),this.container=null}});return D.isCompleted=function(t,o){_.requiredOfPrototype(t,c,"shop must be a ShopModel"),_.requiredOfPrototype(o,p,"company must be a CompanyModel");const s=e.is(o)&&!o.isNew()&&e.is(o.getName())&&e.is(o.getCeoFirstName())&&e.is(o.getCeoLastName()),n=e.is(t)&&!t.isNew()&&e.is(t.getName())&&e.is(t.getEmail())&&e.is(t.getSupportedCurrencies())&&t.getSupportedCurrencies().length>0&&e.is(t.getAddress());return s&&n},D}),define("DS/MPFShopFormComponent/ShopFormComponentV2",["UWA/Core","UWA/Class/View","UWA/Promise","DS/UIKIT/Alert","DS/UIKIT/Input/Button","DS/UIKIT/Mask","DS/PlatformAPI/PlatformAPI","DS/MPFServices/MarketplaceServices","DS/MPFServices/ObjectService","DS/MPFCountryModel/CountryCollection","DS/MPFShopModel/ShopModel","DS/MPFShopModel/ShopServiceModel","DS/MPFCompanyModel/CompanyModel","DS/MPFAddressModel/AddressModel","DS/MPFPersonModel/PersonModel","DS/MPFAddressModel/AddressFactory","DS/MPFShopModel/ShopServiceFactory","DS/MPFError/ValidationError","DS/MPFShopFormComponent/CompanyInformationSection","DS/MPFShopFormComponent/LabInformationSection","DS/MPFShopFormComponent/ContactInformationSection","i18n!DS/MPFShopFormComponent/assets/nls/ShopFormComponent","css!DS/MPFShopFormComponent/MPFShopFormComponent"],function(e,t,o,s,n,i,r,a,h,c,d,p,l,m,u,y,S,f,v,C,F,M){"use strict";var g=t.extend({className:"mpf-shop-form-v2 mpf-horizontal",domEvents:{'change select[name="country"]':"_onCountryChange",'change input[name*="addressLine"]':"_onAddressChange",'change input[name="city"]':"_onAddressChange",'change input[name="state"]':"_onAddressChange",'change select[name="state"]':"_onAddressChange",'change input[name="postalCode"]':"_onAddressChange",'change input[name="shopName"]':"_onShopChange",'change input[name="email"]':"_onShopChange",'change input[name="phoneNumber"]':"_onShopChange",'change select[name="supportedCurrencies"]':"_onShopChange"},setup:function(t){t||(t={}),this._checkPrototypes(t),this._parent(t),this.service=t.service||a.ENGINEERING,this.addressFactory=t.addressFactory,this.shopServiceFactory=t.shopServiceFactory,this.me=t.me,this.shopModel=this.model,this.shopService=t.shopService,this.countries=t.countries,this.company=t.company,this.address=t.address,this.serviceTerm=e.is(t.serviceTerm,"string")?t.serviceTerm:M.get("lab"),this.readOnly=!0===t.readOnly&&!this.me.isDSOperator(),this.isCompanyReadOnly=this.readOnly||!!this.company.getDrupalId(),this.isCountryReadOnly=this.readOnly||!!this.company.getCountry()||!!this.company.getDrupalId(),this.companyInformationSection=this._createCompanyInformationSection(),this.labInformationSection=this._createLabInformationSection(),this.contactInformationSection=this._createContactInformationSection(),this.guidanceSection=this._createGuidanceSection(),this.saveButtonOperator=this._createSaveButtonOperator(),this.hasAddressBeenModified=!1,this.hasShopBeenModified=!1},render:function(){return this.container.setContent([this.companyInformationSection.render(),this.labInformationSection.render(),this.contactInformationSection.render(),this.guidanceSection]),this.me.isDSOperator()&&this.container.addContent(this.saveButtonOperator),this},validate:function(){var e,t,o;if(!this.readOnly)return e=this.companyInformationSection.validate(),t=this.labInformationSection.validate(),o=this.contactInformationSection.validate(),e&&t&&o},save:function(){return this.readOnly?o.resolve():this.validate()?this._saveCompany().then(this._saveAddress.bind(this)).then(this._saveShop.bind(this)).then(this._notifySaveOk.bind(this)).catch(this._handleError.bind(this)):o.reject(new f("ShopFormComponentV2 validation failed"))},_handleError:function(e){var t;return Object.prototype.isPrototypeOf.call(Error.prototype,e)?t=e.toString()||M.get("errorMsg"):(t=M.get("errorMsg"),e=new Error(t)),new s({messageClassName:"error",closable:!0,visible:!0,messages:t}).inject(this.container,"top"),o.reject(e)},_notifySaveOk:function(t){var s=[this.company,this.shopModel,this.address];return e.is(t)&&s.push(t),r.publish("labInfoPage",{completed:!0}),r.publish("newLabCreated",{id:this.shopModel.id}),o.resolve(s)},_saveCompany:function(){return this.company.isNew()?(this.company.unset(l.Fields.TAX_REGISTRATION_ID),this.company.unset(l.Fields.REGISTRATION_ID),this.company.savePromise()):this.company.hasPendingChanges()?this.company.savePromise(this.company.getPendingChanges(),{patch:!0}).catch(function(e){return console.error(e),o.reject(new Error(M.get("anErrorOccured")))}):o.resolve()},_saveAddress:function(){return this.address.isNew()?(this.address.setParentResourceId(this.company.id),this.companyInformationSection.saveAdress()):this.hasAddressBeenModified?this.companyInformationSection.saveAdress({method:"PUT"}):o.resolve()},_saveShop:function(){var e=this;return this.shopModel.isNew()?(this.shopModel.setOwner(this.company.id),this.shopModel.setAddress(this.address.id),this.shopModel.savePromise().then(function(){var t;return(t=e.shopService||e.shopServiceFactory.createModel(S.Types.SHOP_SHOP_SERVICE)).set(p.Fields.IS_AVAILABLE_FOR_TENDER,e.service===a.MAKE),t.parentResourceId=e.shopModel.id,t.savePromise()})):this.hasShopBeenModified?this.shopModel.savePromise(null,{method:"PUT"}):o.resolve()},_onShopChange:function(){this.hasShopBeenModified=!0},_onAddressChange:function(){this.hasAddressBeenModified=!0},_onCountryChange:function(){this.company.setCountry(this.address.getCountry()),this._onAddressChange()},_createSaveButtonOperator:function(){var e=this;return new n({className:"primary",value:M.get("save"),events:{onClick:function(){return i.mask(e.saveButtonOperator.elements.container),e.save().finally(i.unmask.bind(i,e.saveButtonOperator.elements.container))}}})},_createContactInformationSection:function(){return new F({service:this.service,me:this.me,company:this.company,shop:this.shopModel,readOnly:this.readOnly,shopService:this.shopService,isCompanyReadOnly:this.isCompanyReadOnly})},_createCompanyInformationSection:function(){return new v({service:this.service,addressFactory:this.addressFactory,address:this.address,company:this.company,countries:this.countries,shop:this.shopModel,shopService:this.shopService,readOnly:this.readOnly,isCompanyReadOnly:this.isCompanyReadOnly,isCountryReadOnly:this.isCountryReadOnly})},_createLabInformationSection:function(){return new C({service:this.service,readOnly:this.readOnly,shop:this.shopModel,shopService:this.shopService,serviceTerm:this.serviceTerm})},_createGuidanceSection:function(){return e.createElement("div",{class:"mpf-shop-form-v2-section guidance",text:M.get("guidanceSectionText")})},_checkPrototypes:function(e){h.requiredOfPrototype(e.me,u,"options.me must be a PersonModel"),h.requiredOfPrototype(this.model,d,"this.model must be a ShopModel"),h.requiredOfPrototype(e.countries,c,"options.countries must be a CountryCollection"),h.requiredOfPrototype(e.address,m,"options.address must be an AddressModel"),h.requiredOfPrototype(e.company,l,"options.company must be a CompanyModel"),h.requiredOfPrototype(e.addressFactory,y,"options.addressFactory must be an AddressFactory"),h.requiredOfPrototype(e.shopServiceFactory,S,"options.shopServiceFactory must be a ShopServiceFactory"),e.shopService&&h.requiredOfPrototype(e.shopService,p,"options.shopService must be a ShopServiceModel")},destroy:function(){this.model=null,this.shopModel=null,this.me=null,this.shopService=null,this._parent(),this.container=null}});return g.isCompleted=function(t,o){var s,n;return h.requiredOfPrototype(t,d,"shop must be a ShopModel"),h.requiredOfPrototype(o,l,"company must be a CompanyModel"),s=e.is(o)&&!o.isNew()&&e.is(o.getName())&&e.is(o.getCeoFirstName())&&e.is(o.getCeoLastName()),n=e.is(t)&&!t.isNew()&&e.is(t.getName())&&e.is(t.getEmail())&&e.is(t.getSupportedCurrencies())&&t.getSupportedCurrencies().length>0&&e.is(t.getAddress()),s&&n},g}),define("DS/MPFShopFormComponent/ShopFormFactory",["UWA/Class","UWA/Promise","DS/MPFServices/MarketplaceServices","DS/MPFDataProxy/Connector","DS/MPFShopModel/ShopModel","DS/MPFShopModel/ShopServiceFactory","DS/MPFAddressModel/AddressModel","DS/MPFModelFactory/MPFFactoriesV2","DS/MPFAddressModel/AddressFactory","DS/MPFShopFormComponent/ShopFormComponentV2","DS/MPFServices/ObjectService","DS/MPFUrl/UrlUtils"],function(e,t,o,s,n,i,r,a,h,c,d,p){"use strict";return e.extend({init:function(e){e||(e={}),d.requiredOfPrototype(e.connector,s,"options.connector must be a Connector"),this.connector=e.connector,this.isCompanyReadOnly=!0===e.isCompanyReadOnly,this.isReadOnly=!0===e.isReadOnly,this.factoryDispenser=a.getInstance(this.connector),this.service=e.service||o.ENGINEERING},fromMe:function(e,t){return this._initFactoriesAndFetchCountries().then(this._fetchMe.bind(this)).then(this._fetchMyShops.bind(this)).then(this._fetchMyShop.bind(this,e,t)).then(this._getShopService.bind(this)).then(this._fetchShopAddress.bind(this)).then(this._fetchMyCompany.bind(this)).then(this._getCompanyAddressesAsCollection.bind(this)).then(this._getCompanyAddress.bind(this)).then(this._buildShopFormComponent.bind(this))},fromShopId:function(e){return this._initFactoriesAndFetchCountries().then(this._fetchShop.bind(this,e)).then(this._getShopService.bind(this)).then(this._fetchShopAddress.bind(this)).then(this._fetchCompanyFromShop.bind(this)).then(this._getCompanyAddressesAsCollection.bind(this)).then(this._getCompanyAddress.bind(this)).then(this._fetchMe.bind(this)).then(this._buildShopFormComponent.bind(this))},_initFactoriesAndFetchCountries:function(){var e=this;return t.all([this.factoryDispenser.getFactory(a.Types.PERSON),this.factoryDispenser.getFactory(a.Types.COUNTRY),this.factoryDispenser.getFactory(a.Types.SHOP),this.factoryDispenser.getFactory(a.Types.SHOP_SERVICE),this.factoryDispenser.getFactory(a.Types.COMPANY),this.factoryDispenser.getFactory(a.Types.ADDRESS)]).then(function(t){return e.personFactory=t[0],e.countryFactory=t[1],e.shopFactory=t[2],e.shopServiceFactory=t[3],e.companyFactory=t[4],e.addressFactory=t[5],e.companyFactory.addressFactory=e.addressFactory,e.countries=e.countryFactory.createCollection("seller"),e.countries.fetchPromise()}).catch(function(e){return console.error(e),t.reject("error init factories")})},_fetchMe:function(){return this.me=this.personFactory.createModel("me"),this.me.fetchPromise()},_fetchMyCompany:function(){var e,o;return(o=this.me.getCompany())?e=this._fetchCompanyFromRef(o):(this.company=this.companyFactory.createModel("me"),e=t.resolve(this.company)),e},_fetchCompanyFromRef:function(e){var t;return t=(e.match(/[A-Z0-9]{32}$/)||[]).pop(),this.company=this.companyFactory.createModel(null,{id:t},{addressFactory:this.addressFactory}),this.company.fetchPromise()},_getCompanyAddressesAsCollection:function(){var e;e=this.company.addresses?this.company.addresses.toArray():[],this.companyAddresses=this.addressFactory.createCollection(h.Types.COMPANY,e),this.companyAddresses.parentResourceId=this.company.id},_getCompanyAddress:function(){var e;return this.companyAddresses.isEmpty()?(this.companyAddress=this.addressFactory.createModel(h.Types.COMPANY),this.companyAddress.parentResourceId=this.company.id,(e=this.company.getCountry())&&this.companyAddress.set(r.Fields.COUNTRY,e)):this.companyAddress=this.companyAddresses.first(),t.resolve(this.companyAddress)},_fetchMyShops:function(){return this.shops=this.shopFactory.createCollection("me"),this.shops.fetchPromise({expand:[n.Expands.SHOP_SERVICES]})},_fetchMyShop:function(e,o){return this.shops.isEmpty()||!0===o?(this.shop=this.shopFactory.createModel("me"),this.shop.set(n.Fields.IS_AUTOMATIC_PRICING,"FALSE")):this.shop=this.shops.get(e)||this.shops.first(),t.resolve(this.shop)},_fetchShop:function(e){return this.shop=this.shopFactory.createModel("shop",{id:e}),this.shop.fetchPromise({expand:[n.Expands.SHOP_SERVICES]})},_getShopService:function(){this.shopService=this.shopServiceFactory.createModel(i.Types.SHOP_SHOP_SERVICE,this.shop.getService(this.service),{parentResourceId:this.shop.get("id")})},_fetchShopAddress:function(){var e,o,s;return o=this.shop.getAddress(),r.prototype.isPrototypeOf(o)?(this.shopAddress=o,e=t.resolve()):"string"==typeof o&&o.length>0?(s=new p(o).extractId(),this.shopAddress=this.addressFactory.createModel(h.Types.ADDRESS),this.shopAddress.set("id",s),e=this.shopAddress.fetchPromise()):e=t.resolve(),e},_fetchCompanyFromShop:function(){var e;return e=this.shop.getOwner(),this._fetchCompanyFromRef(e)},_buildShopFormComponent:function(){return new c({service:this.service,me:this.me,model:this.shop,shopService:this.shopService,shopServiceFactory:this.shopServiceFactory,countries:this.countries,company:this.company,address:this.shopAddress||this.companyAddress,addressFactory:this.addressFactory,readOnly:this.isReadOnly})}})});