define("DS/WUXAutoComplete/AutoComplete",["UWA/Core","DS/Utilities/Dom","DS/Controls/Abstract","DS/Controls/SelectionChips","DS/Controls/LineEditor","DS/Controls/Popup","DS/DataGridView/DataGridView","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/Utilities/Array","DS/Utilities/KeyboardUtils","DS/Utilities/Utils","i18n!DS/WUXAutoComplete/assets/nls/translation","DS/Menu/Menu"],function(e,t,i,o,s,l,n,a,d,r,h,p,u,c){"use strict";var m=10;const _={ADD:1,REMOVE:2};const f={classic:{expanderStyle:"classic",buildLinks:!0,depthIncrement:14},triangle:{expanderStyle:"triangle",buildLinks:!1,depthIncrement:14},none:{expanderStyle:"none",buildLinks:!1,depthIncrement:14}};function g(e){return void 0!==e?Array.isArray(e)?this.multiSearchMode?e:e.length?[e[0]]:[]:[e]:[]}function v(e){A.call(this,this._valueOperation,{operationType:_.ADD,noOfItemsModified:1},function(){const t=()=>{this.multiSearchMode?this._editor.value="":this._editor.value=this.selectedItems&&this.selectedItems.getLabel?this.selectedItems.getLabel():""};if(!e)return void(this.multiSearchMode||(this.selectedItems=void 0));let i=!0;if(!(i=this.multiSearchMode?!this.selectedItems||this.selectedItems.every(t=>t.getLabel()!==e):!this.selectedItems||this.selectedItems.getLabel&&this.selectedItems.getLabel()!==e))return void t();let o,s=D.call(this,e);if(!(s=s&&s[0])){if(!this.allowFreeInputFlag)return void t();s=new d({label:e,value:e,customNode:!0})}this.multiSearchMode?(o=(o=g.call(this,this.selectedItems)).slice(0),r.pushUnique(o,s)):o=[s],this.selectedItems=o})}function y(e){let t=0,i=!1;if(!this._dataGridView||!this._dataGridViewContainer)return i;let o=this._dataGridView.layout.getDefaultCellHeight();if(this._pendingPromise)t=o*m;else{t=0;let i=m*(o+1),s=e?Math.min(e.bottom-4,i):i;if(0===this._model.getNumberOfVisibleDescendants())t=o;else{for(let[e,i,l]=[0,0,this._model?this._model.getNumberOfVisibleDescendants():0];e<l&&t<s;e++)t+=i=(this._dataGridView.layout&&this._dataGridView.layout.getRowHeightFunction?this._dataGridView.layout.getRowHeightFunction(e):o)+1;this._hasScrollBar=t>=s,t=Math.min(t,s)}}const s=t+"px";return this._dataGridViewContainer.style.height!==s&&(this._dataGridViewContainer.style.height=s,i=!0),i}function C(e,i){this._totoCpt++;let o=!1,s=0;if(this.popupSizeAdjustPolicy===l.SizeAdjustPolicyEnum.NoAdjust)s=this._DGVContainerFitWidth;else if(this._dataGridView){const e=this._hasScrollBar?p.getScrollbarWidth():0;let i,o=!0;if(this._model&&this._model.processDescendants({onlyVisibleNodes:!0,processNode:()=>(o=!1,{stopProcessing:!0})}),o){if(void 0===this._customFilterMessageWidth){const e=parseFloat(window.getComputedStyle(this.getContent(),null).getPropertyValue("font-size"));this._customFilterMessageWidth=t.computeStringWidth(this.customFilterMessage,e,"Arial",!0)}i=this._customFilterMessageWidth+(e?0:20)}else i=this._dataGridView._getMaxContentSizeInfo(["tree"],{computeAllRows:this.popupSizeAdjustPolicy===l.SizeAdjustPolicyEnum.AdjustToAllContents}).tree.maxContentSize;s=Math.max(this._DGVContainerMinWidth,i+e),this._DGVContainerWidth!==s&&(this._DGVContainerMinWidth=s)}if(this._availableSpaceObject=e,e){const t=this._DGVContainerFitWidth+e.left+e.right;s=Math.min(s,t)}return 0!==s&&this._DGVContainerWidth!==s&&(this._DGVContainerWidth=s,this._dataGridViewContainer.setStyle("width",s+"px"),o=!0),(o||i)&&this.elements.popup._updateView(),!this._popupVisibility&&this.elements.popup&&this.elements.popup.visibleFlag&&!this._lockPopupVisibilityChange&&(this._popupVisibility=!0,this.elements.popup.getContent().setStyle("visibility","visible"),this.fire("popupVisibilityChange")),o||i}function w(e){const t=y.call(this,e);return C.call(this,e,t)}function b(){var e=void 0;this._selectionChips&&(e=this._selectionChips.getContent().getDimensions().height),e!==this._selectionChipsHeight&&(this.elements.popup&&this.elements.popup._updateView(),w.call(this)),this._selectionChipsHeight=e}function I(e){this.filterCB(e),w.call(this),this.allowFreeInputFlag||""===e||function(){if(!this._dataGridView||!this._model)return;this._dataGridView.setActiveCell(-1,!0,!0),this._dataGridView.setPreselectedCell(-1),this._model.getChildren().every(e=>{if(e.isVisible()){let t=this._dataGridView.layout.getCellIDFromCoordinates({rowID:e._getRowID(),columnID:0});return this._dataGridView.setPreselectedCell(t),!1}return!0})}.call(this)}function V(e){if(!this._model)return;const t=this._model.getRoots(),i=t.length>0&&t[0].options.customNode?t[0]:void 0;if(!e||!this.allowFreeInputFlag||!this.displayCustomNodeInDropDown)return void(i&&this._model.removeRoot(i));const o=D.call(this,e);if(o&&o[0])return void(i&&i!==o[0]&&this._model.removeRoot(t[0]));if(i)return void i.updateOptions({label:e,value:e});const s=new d({label:e,value:e,icons:[{iconName:"pencil"}],customNode:!0});this._dataGridView&&this._dataGridView.setActiveCell(-1,!0,!0);this._model.addRoot(s,0)}function M(t,i){if(!this._modelLoaded)if(this.selectedItems&&i&&(A.call(this,this._valueModifiedbyAPI,!0,function(){this._model&&(this._model.getXSO().isEmpty()||this._model.getXSO().empty())}),this._properties.value.value=void 0,this._properties.selectedItems.value=void 0,this._selectionChips&&this._selectionChips.removeAllChips(),this._editor&&(this._editor.value="")),this._model&&I.call(this,""),function(){this._model&&(this._modelToken.forEach(e=>this._model.removeEventListener(e)),this._modelToken=[],this._xsoToken.forEach(e=>this._model.getXSO().unsubscribe(e)),this._xsoToken=[])}.call(this),void 0===t)this._ownModel||(this._model=this._defaultModel),this._model.empty(),this._modelLoaded=!0;else{if(t instanceof a)return function(e){if(e instanceof a){this._ownModel=!1;const t=!this.isDirty("value")&&!this.isDirty("selectedItems"),i=g.call(this,this.selectedItems);if(t){const t=e.getXSO().get(),o=Array(i.length).fill(!1);i.length>0&&(e.search({match:e=>{const s=i.indexOf(e.nodeModel);if(-1!==s){o[s]=!0,i[s].select(),delete i[s].options.customNode;const l=t.indexOf(e.nodeModel);return-1!==l&&t.splice(l,1),!0}return!1},shouldStop:()=>o.every(e=>!0===e)}),i.forEach((e,t)=>{!1===o[t]&&(e.options.customNode=!0)}),i.push(...t))}this._model=e,this._modelLoaded=!0,this._dataGridView&&(this._dataGridView.treeDocument=this._model),t&&i.length>0&&A.call(this,this._valueOperation,{operationType:_.ADD,noOfItemsModified:i.length},function(){this.selectedItems=i}),F.call(this)}}.call(this,t);if(Array.isArray(t))return function(t){if(Array.isArray(t)){this._ownModel=!0;const s=!this.isDirty("value")&&!this.isDirty("selectedItems"),l=g.call(this,this.selectedItems),n=Array(l.length).fill(!1);for(var i=[],o=0;o<t.length;o++){const a=t[o],r="object"==typeof a,h=r?void 0!==a.value&&null!==a.value?a.value:a.label:a+"",p=r?a.label||("object"==typeof a.value?a.value.label:a.value+""):a+"",u=r?a.icon:void 0,c=r?a.typeRepresentation:typeof a,m=r&&a.hasOwnProperty("grid");let _,f=!0;s&&(f=l.every((t,i)=>!!n[i]||(t.getLabel()!==p||t.options.value!==h||!e.equals(t.options.icon,u)||(_=t,n[i]=!0,delete _.options.customNode,!1))));let g=m?{label:p,value:h,icon:u,grid:a.grid,typeRepresentation:c}:{label:p,value:h,icon:u,typeRepresentation:c};f&&(_=new d(g)),i.push(_)}s&&l.forEach((e,t)=>{!1===n[t]&&(e.options.customNode=!0)}),this._model&&this._ownModel||(this._model=this._defaultModel),this._model.empty(),this._model.addRoot(i),this._dataGridView&&(this._dataGridView.treeDocument=this._model),this._modelLoaded=!0,s&&this._model.getXSO().add(l),F.call(this)}}.call(this,t);if(t instanceof Function)return this._lastSearchedString=this._editor?this._editor.valueToCommit:"",M.call(this,t.call(this,this._lastSearchedString),!1);if(t instanceof Promise){this._pendingPromise=!0,this._dataGridView&&(this._dataGridView.displayModalLoader(u.get("AutoComplete").Loading),this._dataGridView.placeholder="");var o=this;t.then(function(e){M.call(o,e,!1),V.call(o,o._editor.valueToCommit)}).finally(function(e){o._pendingPromise=!1,o._dataGridView&&(o._dataGridView.removeModalLoader(u.get("AutoComplete").Loading),o._dataGridView.placeholder=o.customFilterMessage,o._editor&&I.call(o,o._editor.valueToCommit))})}}}function S(){this._editor&&void 0!==this._editor.valueToCommit&&this._editor.valueToCommit.length>=this.minLengthBeforeSearch&&(!this._modelLoaded&&!this._pendingPromise||!this.keepSearchResultsFlag&&!this._pendingPromise||this.elementsTree instanceof Function&&this.minLengthBeforeSearch>0&&this._editor.valueToCommit.toLowerCase().indexOf(this._lastSearchedString.toLowerCase())<0)&&(this._modelLoaded=!1,M.call(this,this.elementsTree,!1))}function F(){const e=this;if(0===this._modelToken.length){const t=()=>{w.call(this)},i=this._model.addModelEventListener("addChild",t);this._modelToken.push(i);const o=this._model.addModelEventListener("removeChild",t);this._modelToken.push(o);const s=this._model.onPostExpand(function(){w.call(e)});this._modelToken.push(s);const l=this._model.onPostCollapse(function(){w.call(e)});this._modelToken.push(l)}if(0===this._xsoToken.length){const t=this._model.getXSO().onPostAdd(function(t){e._valueModifiedbyAPI||A.call(e,e._valueOperation,{operationType:_.ADD,noOfItemsModified:t.length},function(){if(e.multiSearchMode){var i=[];e.selectedItems&&(i=e.selectedItems.slice(0)),t&&t.forEach(function(e){r.pushUnique(i,e)}),e.selectedItems=i,e.minLengthBeforeSearch?e._hidePopup():b.call(e)}else e._hidePopup(),e.selectedItems=t[0]})});this._xsoToken.push(t);const i=this._model.getXSO().onPostRemove(function(t){e.displayCustomNodeInDropDown&&t[0].options&&t[0].options.customNode||e._valueModifiedbyAPI||A.call(e,e._valueOperation,{operationType:_.REMOVE,noOfItemsModified:t.length},function(){if(e.multiSearchMode){var i=[];e.selectedItems&&(i=e.selectedItems.slice(0)),t.forEach(function(e){for(var t=i.length-1;t>=0;t--)if(i[t]===e){i.splice(t,1);break}}),e.selectedItems=i,e.minLengthBeforeSearch&&void 0!==e._editor.value&&e._editor.value.length<e.minLengthBeforeSearch?e._hidePopup():b.call(e)}})});this._xsoToken.push(i)}}function A(e,t,i){var o=this._valueModifiedbyAPI;!0===e.hasOwnProperty("operationType")&&!0===e.hasOwnProperty("noOfItemsModified")?(this._valueOperation.operationType=t.operationType,this._valueOperation.noOfItemsModified=t.noOfItemsModified):this._valueModifiedbyAPI=t,i.call(this),e.operationType&&e.noOfItemsModified?(this._valueOperation.operationType=void 0,this._valueOperation.noOfItemsModified=void 0):this._valueModifiedbyAPI=o}function D(t){let i;i=Array.isArray(t)?Array.from(t,e=>({value:e,found:!1})):[{value:t,found:!1}];const o=Array(i.length).fill(void 0);if(!this._model||0===i.length)return o;const s=i.length;let l=0;const n=(e,t)=>(l++,i[e].found=!0,o[e]=t,!0);return this._model.search({useTransaction:!1,match:t=>{const o=t.nodeModel,s=o.options.label,l=o.options.value,a=l instanceof Object&&l.hasOwnProperty("value")?l.value:l;for(let t=0;t<i.length;t++){const l=i[t].value,r=i[t].found,h=typeof l;if(null!=l&&!0!==r){if(o.options.hasOwnProperty("value")&&void 0!==a)if("string"===h){if("string"==typeof a&&e.equals(l.toLowerCase(),a.toLowerCase()))return n(t,o)}else if("number"===h){if("number"==typeof a&&l===a)return n(t,o)}else if("object"===h){if(l instanceof d&&e.equals(l.options.value,a)||e.equals(l,a))return n(t,o);if(l.hasOwnProperty("value")&&e.equals(l.value,a))return n(t,o);if(e.equals(l,a))return n(t,o)}if(o.options.hasOwnProperty("label")&&void 0!==s)if("string"===h){if("string"==typeof s&&e.equals(l.toLowerCase(),s.toLowerCase()))return n(t,o)}else if("number"===h){if("number"==typeof s&&l===s)return n(t,o)}else if("object"===h&&(l instanceof d&&e.equals(l.options.label,s)||e.equals(l,s)))return n(t,o)}}},shouldStop:()=>s===l}),o}function P(){var e=this,t=void 0;return this.selectedItems&&Array.isArray(this.selectedItems)&&this.selectedItems.forEach(function(i,o){e._selectionChips._items[o].isSelected&&(t=i)}),t}return i.inherit({name:"autoComplete",publishedProperties:{placeholder:{defaultValue:u.get("AutoComplete").Placeholder,type:"string",category:"Appearance"},multiSearchMode:{defaultValue:!0,type:"boolean",category:"Behavior"},displayCustomNodeInDropDown:{defaultValue:!0,type:"boolean",category:"Behavior",noNeedToApplyFlag:!0},value:{defaultValue:void 0,type:"object",category:"Appearance"},elementsTree:{defaultValue:void 0,type:"object",category:"Model"},selectedItems:{defaultValue:void 0,type:"Array",category:"Appearance"},filterCB:{defaultValue:function(e){this.filterItems(e,{filterId:"stringRegexp"})},type:"function"},customFilterMessage:{defaultValue:u.get("AutoComplete").CustomFilterMessage,type:"string",category:"Appearance"},allowFreeInputFlag:{defaultValue:!0,type:"boolean",category:"Behavior",noNeedToApplyFlag:!0},allowResetToUndefinedByUIFlag:{defaultValue:!0,type:"boolean",category:"Behavior"},minLengthBeforeSearch:{defaultValue:0,type:"integer",category:"Behavior",noNeedToApplyFlag:!0},typeDelayBeforeSearch:{defaultValue:0,type:"integer",category:"Behavior",noNeedToApplyFlag:!0},keepSearchResultsFlag:{defaultValue:!0,type:"boolean",category:"Behavior",noNeedToApplyFlag:!0},popupSizeAdjustPolicy:{defaultValue:l.SizeAdjustPolicyEnum.AdjustToVisibleContents,type:"integer",category:"Appearance"},getChipInfo:{defaultValue:function(e){return this.getDefaultChipInfo(e)},type:"function"},columnOptions:{defaultValue:void 0,type:"object",category:"Appearance"}},getDefaultChipInfo:function(e){let t="object"==typeof e.options.value?e.options.value.label||e.getLabel():e.getLabel()||e.options.value+"",i=e.options.icon||("object"==typeof e.options.value?e.options.value.icon:void 0),o={roundFlag:"user"===this.getTypeRepresentation(e)||"detailedUser"===this.getTypeRepresentation(e)};return i||"user"!==this.getTypeRepresentation(e)&&"detailedUser"!==this.getTypeRepresentation(e)||(i={userName:"object"==typeof e.options.value?e.options.value.label||e.getLabel():e.getLabel()||e.options.value+""}),{label:t,icon:i,_iconOptions:o}},canClosePopup:function(e){if(e)return!0;var t=P.call(this);if(null!=t){if(this._dataGridView){var i;i=this._dataGridView.layout.getCellIDFromCoordinates({rowID:t._rowID,columnID:0}),this._dataGridView.setPreselectedCell(i)}return!1}return!0},getTypeRepresentation:function(e){return(e?e.options.typeRepresentation:void 0)||this.columnOptions&&void 0!==this.columnOptions.getTypeRepresentation&&this.columnOptions.getTypeRepresentation({nodeModel:e})||this.columnOptions&&this.columnOptions.typeRepresentation||"string"},keymaps:{tab:"manageTab","shift+tab":"manageTab",esc:"manageEscape",up:"upMove",down:"downMove",pageup:"pageupMove",pagedown:"pagedownMove",home:"homeMove",end:"endMove"},commands:{manageTab:function(e){return this._hidePopup(),v.call(this,this._editor.valueToCommit),{stopPropagation:!1}},manageEscape:function(e){return this.elements.popup&&this.elements.popup.visibleFlag&&(!this.multiSearchMode&&this._editor&&this._editor._myInput&&this.selectedItems&&(this._editor.valueToCommit=this.selectedItems.getLabel(),this._editor.value=this.selectedItems.getLabel()),this.callMethodFromUIInteraction("_hidePopup")),{stopPropagation:!1}},upMove:function(){return this._manageNavigationKey("up")},downMove:function(){return this._manageNavigationKey("down")},pageupMove:function(){return this._manageNavigationKey("pageup")},pagedownMove:function(){return this._manageNavigationKey("pagedown")},homeMove:function(){return this._manageNavigationKey("home",!0)},endMove:function(){return this._manageNavigationKey("end",!0)}},buildView:function(){this.elements.container.addClassName("wux-controls-autoComplete"),this._totoCpt=0,this._modelLoaded=!1,this._defaultModel=new a,this._ownModel=!1,this._model=null,this._lastSearchedString="",this._valueOperation={operationType:void 0,noOfItemsModified:void 0},this._xsoToken=[],this._modelToken=[],this._nbItemsToDisplay=-1,this._valueModifiedbyAPI=!1,this._selectionChipsHeight=0,this._DGVContainerFitWidth=0,this._DGVContainerMinWidth=0,this._DGVContainerWidth=0},_postBuildView:function(){void 0===this._editor&&(this._editor=new s({placeholder:this.placeholder,displayStyle:"text",fireOnlyFromUIInteractionFlag:!0,selectAllOnFocus:!0,disabled:this.disabled}),this._editor.getContent().addClassName("wux-controls-autoComplete-editor")),this._editor.touchMode=this.touchMode,this._applyMultiSearchMode(),this.multiSearchMode||this.selectedItems&&(this._editor.value=Array.isArray(this.selectedItems)?this.selectedItems[0].options.label:this.selectedItems.options.label),this._delayPopupCreation()},handleEvents:function(){var e=this,i=function(){var t=!1;e._valueModifiedbyAPI||(!(e._editor&&""!==e._editor.valueToCommit&&e._editor.valueToCommit.length>=e.minLengthBeforeSearch)||e.elements.popup&&e.elements.popup.visibleFlag?e.elements.popup&&e.elements.popup.visibleFlag&&e._editor&&void 0!==e._editor.valueToCommit&&e._editor.valueToCommit.length<e.minLengthBeforeSearch&&e._hidePopup():(e._showPopup(),t=!0,e._dataGridView&&(e._dataGridView.setScrollerPosition({x:0,y:0,animate:!1}),e.multiSearchMode||e._dataGridView.unselectAll(),e._dataGridView.setActiveCell(-1,!0,!0),e._dataGridView.setPreselectedCell(-1),e._selectionAllowed=!1))),!t&&e.elements.popup&&e.elements.popup.visibleFlag&&S.call(e),e.displayCustomNodeInDropDown&&V.call(e,e._editor.valueToCommit),I.call(e,e._editor.valueToCommit),e.elements.popup&&e.elements.popup.visibleFlag&&e._dataGridView&&(e._dataGridView.setFindStr(e._editor.valueToCommit,!1,void 0,!0,e._hasARegExpFilter),C.call(e))};t.addEventOnElement(this,this._editor,"uncommittedChange",function(t){if(t.stopPropagation(),!e._valueModifiedbyAPI){if(c.hide(),e.elements.popup&&e.elements.popup.visibleFlag&&e._editor&&void 0!==e._editor.valueToCommit&&e._editor.valueToCommit.length<e.minLengthBeforeSearch)return void e._hidePopup();e._editor&&""===e._editor.valueToCommit&&e._editor.valueToCommit.length>=e.minLengthBeforeSearch&&e._dataGridView&&(e._dataGridView.setActiveCell(-1,!0,!0),e._dataGridView.setPreselectedCell(-1))}!e._valueModifiedbyAPI&&e.typeDelayBeforeSearch>0?(this._debouncedlaunchSearch||(this._debouncedlaunchSearch=p.debounce(i,e.typeDelayBeforeSearch)),this._debouncedlaunchSearch()):i(),e.fire("uncommittedChange",t.options)}),t.addEventOnElement(this,this._editor,"change",function(t){t.stopPropagation(),e._valueModifiedbyAPI||(v.call(e,e._editor.value),e._hidePopup())}),t.addEventOnElement(this,this,"keydown",function(t){t.keyCode==h.SPACE&&e._selectionAllowed&&!t.actionPerformed?e._manageSpace(t):t.keyCode===h.HOME?e._manageNavigationKey("home",!0):t.keyCode===h.END?e._manageNavigationKey("end",!0):t.keyCode!=h.ENTER||t.actionPerformed||e._manageReturn(t)},!0)},_manageSpace:function(e){if(this.multiSearchMode&&this.elements.popup&&this.elements.popup.visibleFlag&&this._dataGridView){var t=this._dataGridView.getActiveCellID();if(t>=0){var i=this._dataGridView.getNodeModelAt(t);i&&(i.isSelected()?i.unselect():i.select(),e&&(e.stopPropagation(),e.preventDefault()),this._editor&&this._editor.focus({preventScroll:!0}))}}},_manageReturn:function(e){var t,i=!1;if(this.elements.popup&&this.elements.popup.visibleFlag){if(this._dataGridView){var o=this._dataGridView.getActiveCellID();o>=0&&(t=this._dataGridView.getNodeModelAt(o))}this._hidePopup()}return t?(t.select(),i=!0):this._editor.value&&(v.call(this,this._editor.value),i=!0),{stopPropagation:!1,infos:{actionPerformed:i}}},_manageNavigationKey:function(e,t){if(c.hide(),this.elements.popup&&this.elements.popup.visibleFlag){if(this._dataGridView){var i=-1,o=this._dataGridView.getActiveCellID();this._selectionAllowed=!0,i=void 0===o||o<0?this._dataGridView.layout.getCellIDFromCoordinates({rowID:"end"===e?this._dataGridView.model.length-1:0,columnID:0}):this._dataGridView.computeCellIDFromActiveCell(e,t),this._dataGridView.setActiveCell(i,!0,!0),this._dataGridView.setPreselectedCell(i)}}else this._showPopup();return{preventDefault:!0}},_getDefaultCellHeight:function(){if(this.columnOptions&&this.columnOptions.autoRowHeightFlag||!this._dataGridView.layout||this._dataGridView.layout.getRowHeightFunction)return this.touchMode?40:27;this._dataGridView.layout.getRowHeightFunction=function(){return this._dataGridView.layout.getDefaultCellHeight()}},_delayPopupCreation:function(){if(!this._delayPopupCreationInfos){var i=this,o={target:this,position:"bottom",offset:{x:0,y:4},trigger:"click escape",toggleFlag:!0,forceKeepOrientation:!0,constraint:"screen",className:"wux-controls-autoComplete-popup wux-controls-popup",alignment:"near",overlap:!1,shouldDisplayCallback:function(){return S.call(i),!(i._editor&&(!(""!==i._editor.valueToCommit||i._model&&0!==i._model.getRoots().length||i._pendingPromise)||void 0!==i._editor.valueToCommit&&i._editor.valueToCommit.length<i.minLengthBeforeSearch))},getBody:function(){i._dataGridViewContainer=new e.Element("div"),i._dataGridViewContainer.addClassName("wux-controls-autoComplete-dataGridViewContainer");let o=i.columnOptions&&i.columnOptions.style&&f[i.columnOptions.style]?i.columnOptions.style:"classic";var s={treeDocument:i._model,cellSelection:"none",selectionBehavior:{toggle:!0,selectOnPointerUp:!0},showAlternateBackgroundFlag:!1,showRowBorderFlag:!0,selectionStyle:"lightSelectionEdging",rowSelection:i.multiSearchMode?"multiple":"single",selectNextCellOnEnterFlag:!1,layoutOptions:{columnsHeader:!1,rowsHeader:!1},treeNodeCellOptions:f[o],touchMode:i.touchMode};let a={autoRowHeightFlag:!1,typeRepresentation:i.typeRepresentation,getCellTypeRepresentation:i.typeRepresentation?void 0:function(e){return i.getTypeRepresentation(e.nodeModel)},getCellValue:function(e){return e.nodeModel?"string"===i.getTypeRepresentation(e.nodeModel)&&"string"==typeof e.nodeModel.options.label&&""!==e.nodeModel.options.label?e.nodeModel.options.label:e.nodeModel.options.value:""},getCellIcons:function(e){let t=e.nodeModel&&e.nodeModel.getIcons?e.nodeModel.getIcons():[];return e.nodeModel&&e.nodeModel.options.icon&&t[t.length-1]!==e.nodeModel.options.icon&&t.push(e.nodeModel.options.icon),t}},d=Object.assign(a,i.columnOptions),r={dataIndex:"tree",text:"",showTextFlag:!1,icon:void 0,minWidth:40,width:"auto",visibleFlag:!0,editableFlag:!1,editionPolicy:"EditionOnDoubleClick",resizableFlag:!1,selectableFlag:!1,sortableFlag:!1,groupableFlag:!1,printableFlag:!1,massUpdateAllowedFlag:!1,splittableFlag:!1,compareFunctionCB:void 0,autoSizePadding:0,pinned:"unpinned",onCellRequest:void 0,hasCellValue:void 0,setCellValue:void 0,getCellValueForCopy:void 0,getCellValueForSort:void 0,processCellValueFromPaste:void 0,getCellValueForExport:void 0,getCellValueForSort:void 0,getCellKPIColor:void 0,getCellGroupingKey:void 0,getGroupingNodeOptions:void 0};return d=Object.assign(d,r),s.columns=[d],i._dataGridView=new n(s),i._dataGridView._setScrollbarsHidden({horizontal:!0}),i.customFilterMessage&&(i._dataGridView.placeholder=i.customFilterMessage),i._dataGridView.getContent().addClassName("wux-controls-autoComplete-dataGridView"),i._dataGridView.inject(i._dataGridViewContainer),t.addEventOnElement(i,i._dataGridView,"focus",function(e){i._editor&&i._editor._onFocusReceived(!1)}),t.addEventOnElement(i,i._dataGridView,"click",function(e){if(this._preselectedCellStableID&&this._preselectedCellStableID.nodeModel){let e=this._preselectedCellStableID.nodeModel._options.label;if(i._properties.selectedItems.value&&i._properties.selectedItems.value._options){e===i._properties.selectedItems.value._options.label&&(i._editor.valueToCommit=e)}}}),t.addEventOnElement(i,i._dataGridView,"preselectedCellChange",function(e){if(!i._selectionChips||!i._selectionChips._items||0===i._selectionChips._items.length)return;let t=!1;e.dsModel._preselectedCellStableID&&i._selectionChips._items.forEach(function(o){e.dsModel._preselectedCellStableID.nodeModel===o.chipOptions.value&&(i._selectionChips.selectChip(o),t=!0)}),void 0!==e.dsModel._preselectedCellStableID&&t||i._selectionChips._items.forEach(function(e){i._selectionChips.unselectChip(e)}),e.stopPropagation()}),i._dataGridView._getScroller().onScrollEnd(function(){(i.popupSizeAdjustPolicy===l.SizeAdjustPolicyEnum.AdjustToVisibleContents||i._lockPopupVisibilityChange)&&(i._lockPopupVisibilityChange=!1,C.call(i))}),i._dataGridViewContainer},overlapCallback:function(e){let t=e.availableSpaces;this._lockPopupVisibilityChange=!0,w.call(this,t),this._lockPopupVisibilityChange=!1}.bind(this),beforeDisplayCallback:function(){i._lockPopupVisibilityChange=!0,i.elements.popup.getContent().setStyle("visibility","hidden"),i._popupVisibility=!1;let e=0,t=0;if(!i.multiSearchMode&&i._editor&&i._editor._myInput){const o=window.getComputedStyle(i._editor._myInput);0===parseInt(o.borderLeft.slice(0,-2))&&(e=-1,t=2),i.elements.popup.offset={x:e,y:4}}let o="";i.multiSearchMode&&(o=i._editor.valueToCommit),I.call(i,o),i._dataGridView&&i._dataGridView.setFindStr(o,!1,void 0,!0),i._DGVContainerFitWidth=i.elements.container.getBoundingClientRect().width+t,i._DGVContainerMinWidth=i._DGVContainerFitWidth,i._DGVContainerWidth=i._DGVContainerFitWidth,i._dataGridViewContainer.style.width=i._DGVContainerWidth+"px",i._lockPopupVisibilityChange=!1}};this._delayPopupCreationInfos=l.delayPopupCreation(o,function(e){i.elements.popup=e,i._editor.preventBlurForTargetedElements([i.elements.popup]),t.addEventOnElement(i,e,"show",async function(e){e.stopPropagation(),i.elements.popup&&i.elements.popup.visibleFlag&&i._dataGridView&&i._dataGridView.setFindStr(i._editor.valueToCommit,!1,void 0,!0,i._hasRegExpFilter),i.displayCustomNodeInDropDown&&V.call(i,i._editor.valueToCommit),i._dataGridView.subscribeOnceToAllCellsRendered(function(){i._dataGridView.layout.prepareLayout(),y.call(i,i._availableSpaceObject),function(){if(this._dataGridView){var e=-1,t=P.call(this);if(void 0===t&&(t=Array.isArray(this.selectedItems)?this.selectedItems[this.selectedItems.length-1]:this.selectedItems),t){if(t.options.customNode||this._model!==t.getTreeDocument())return!1;e=this._dataGridView.layout.getCellIDFromCoordinates({rowID:t._getRowID(),columnID:0})}return this._dataGridView.setPreselectedCell(e),this._dataGridView.ensureNodeModelVisible(t,!1,!0,0)}}.call(i)?i._lockPopupVisibilityChange=!0:C.call(i,i._availableSpaceObject),i.fire("show")})}),t.addEventOnElement(i,e,"hide",function(e){e.stopPropagation(),i.fire("hide")})})}},_applyProperties:function(e){if(this._parent(e),this.isDirty("placeholder")&&this._applyPlaceholder(e.placeholder),this.isDirty("multiSearchMode")&&this._applyMultiSearchMode(e.multiSearchMode),this.isDirty("elementsTree")&&this._applyElementsTree(e.elementsTree),this.isDirty("value")&&e&&e.hasOwnProperty("value"))this._applyValue(e.value);else if(this.isDirty("selectedItems")&&e&&e.hasOwnProperty("selectedItems"))this._applySelectedItems(e.selectedItems);else if(this.isDirty("elementsTree")&&this.elementsTree&&this.elementsTree instanceof a){var t=this.elementsTree.getXSO().get();t.length>0&&A.call(this,this._valueOperation,{operationType:_.ADD,noOfItemsModified:t.length},function(){this.selectedItems=t})}this.isDirty("customFilterMessage")&&this._applyCustomFilterMessage(e.customFilterMessage),this.isDirty("allowResetToUndefinedByUIFlag")&&this._applyAllowResetToUndefinedByUIFlag(e.allowResetToUndefinedByUIFlag)},_applyDisabled:function(){this._parent(),this._editor&&(this._editor.disabled=this.disabled),this._selectionChips&&(this._selectionChips.disabled=this.disabled)},_applyPlaceholder:function(){this._editor&&(this._editor.placeholder=this.placeholder)},_applyMultiSearchMode:function(e){this.multiSearchMode?(this._editor&&!0===this.elements.container.hasChildNodes()&&this._editor.remove(),void 0!==this.elements.popup&&A.call(this,this._valueModifiedbyAPI,!0,function(){this._dataGridView.rowSelection="multiple"}),this._selectionChips||function(){this._selectionChips=new o({fireOnlyFromUIInteractionFlag:!0,disabled:this.disabled}),this._selectionChips.getContent().addClassName("wux-controls-autoComplete-selectionChips"),this._selectionChips.touchMode=this.touchMode,this._selectionChips.selection.mode=o.SELECTION_MODE.SINGLE;var e=this;t.addEventOnElement(this,this._selectionChips,"onPostRemove",function(t){e._valueModifiedbyAPI||A.call(e,e._valueOperation,{operationType:_.REMOVE,noOfItemsModified:t.options.chips.length},function(){if(e.multiSearchMode&&t.options.chips){if(t.options.allChipsRemoved)return void(e.selectedItems=[]);for(var i=0;i<t.options.chips.length;i++){const s=t.options.chips[i].chipOptions;if(s.value&&s.value.options.customNode){const t=g.call(e,e.selectedItems).findIndex(e=>e===s.value);if(-1!==t){const i=e.selectedItems.slice(0);i.splice(t,1),e.selectedItems=i}}else if(s.value){var o=D.call(e,s.value);o&&o[0]&&s.value.unselect()}}}})}),t.addEventOnElement(this,this._selectionChips,"change",function(e){e.stopPropagation()})}.call(this),this._editor&&this._editor._myInput&&this._selectionChips&&!1===this.elements.container.hasChildNodes()&&(this._editor.displayStyle="lite",this._selectionChips.addLastWidget(this._editor),this._selectionChips.inject(this.elements.container))):(this._selectionChips&&!0===this.elements.container.hasChildNodes()&&this._selectionChips.remove(),this.elements.popup&&A.call(this,this._valueModifiedbyAPI,!0,function(){this._dataGridView.rowSelection="single"}),this._editor&&this._editor._myInput&&!1===this.elements.container.hasChildNodes()&&(this._editor.displayStyle="text",this._editor.inject(this.elements.container))),this._applyAllowResetToUndefinedByUIFlag(),void 0!==e&&this.multiSearchMode!==e&&(this.isDirty("value")||this.isDirty("selectedItems")||(A.call(this,this._valueModifiedbyAPI,!0,function(){this._model&&(this._model.getXSO().isEmpty()||this._model.getXSO().empty())}),this._properties.value.value=void 0,this._properties.selectedItems.value=void 0,this._selectionChips&&this._selectionChips.removeAllChips(),this._editor&&(this._editor.value="")))},_applyValue:function(e,t){if(void 0===this.value)return this.selectedItems=[],void(this._modelLoaded||this.fire("change"));var i=g.call(this,this.value);this.multiSearchMode?Array.isArray(this.value)||(this._properties.value.value=i):Array.isArray(this.value)&&(this._properties.value.value=i[0]),A.call(this,this._valueModifiedbyAPI,!0,function(){var o=[];const s=D.call(this,i);for(var l=0;i.length>l;l++){var n=s[l];if(!n&&i[l]&&""!==i[l])if(this.allowFreeInputFlag||this.elementsTree instanceof Function){let e=i[l],t=i[l],o=void 0;i[l]instanceof d?(t=i[l].options.value,e=i[l].options.label,o=i[l].options.icon,e=e||t):"object"==typeof i[l]&&i[l].value&&(e=i[l].label?i[l].label:i[l].value,t=i[l].value,o=i[l].icon),n=new d({label:e,value:t,icon:o,customNode:!0})}else if(!this.multiSearchMode){if(this._modelLoaded)return this.value=e,void(this._editor.value=e);this._editor.value=t}n&&r.pushUnique(o,n)}this.selectedItems=this.multiSearchMode?o:o[0]}),b.call(this)},_applyElementsTree:function(e){this._modelLoaded=!1,(this.elements.popup&&this.elements.popup.visibleFlag||!this.elementsTree||this.elementsTree instanceof a||Array.isArray(this.elementsTree))&&M.call(this,this.elementsTree,!this.isDirty("value")&&!this.isDirty("selectedItems"))},filterItems:function(e,t){if(this._model){var i=t&&t.property||"label",o=t&&t.type||"contains",s=t&&t.filterId||"stringRegexp",l=t?t.filterOptions:void 0;"stringRegExp"===s&&(this._hasARegExpFilter="stringRegexp"===s),this._model.getFilterManager().setPropertyFilterModel(i,{filterId:s,filterModel:{condition1:{type:o,filter:e}},filterOptions:l})}},_applySelectedItems:function(){this._dataGridView&&this._dataGridView.setPreselectedCell(-1);var e=this,t=g.call(this,this.selectedItems);this.multiSearchMode?Array.isArray(this.selectedItems)||(this._properties.selectedItems.value=t):Array.isArray(this.selectedItems)&&(this._properties.selectedItems.value=t[0]);for(var i=[],o=0;o<t.length;o++)r.pushUnique(i,t[o]);t.length!==i.length&&(t=i,this.multiSearchMode?this._properties.selectedItems.value=t:this._properties.selectedItems.value=t[0]);const s=D.call(this,t);for(let e=0;e<s.length;e++)s[e]||(t[e].options.customNode=!0);if(this.multiSearchMode){let i=[];A.call(this,this._valueModifiedbyAPI,!0,function(){this._model&&!this._model.getXSO().isEmpty()&&this._model.getXSO().empty();for(var i=0;t.length>i;i++)t[i].select();if(this._selectionChips){var o=[];let i;t.forEach(function(t){i=e.getChipInfo(t),r.pushUnique(o,{label:i.label,value:t,icon:i.icon,_iconOptions:i._iconOptions})}),this._selectionChips.removeAllChips(),this._selectionChips.addChips(o)}I.call(this,""),this._editor&&(this._editor.valueToCommit="",this._editor.value="")});e=this;t.forEach(function(e){e.options.hasOwnProperty("value")&&void 0!==e.options.value?i.push(e.options.value):i.push(e.options.label)}),(this._properties.value.value||i&&i.length>0)&&(this._properties.value.value=i)}else A.call(this,this._valueModifiedbyAPI,!0,function(){this._valueOperation.operationType!==_.REMOVE&&(this._model&&!this._model.getXSO().isEmpty()&&this._model.getXSO().empty(),t.length>0&&t[0]&&t[0].select());var e="";this._editor&&(t[0]&&("string"==typeof t[0]||"number"==typeof t[0]?e=t[0]+"":"object"==typeof t[0].options&&(t[0].options.label?e=t[0].options.label:t[0].options.value&&("string"==typeof t[0].options.value||"number"==typeof t[0].options.value?e=t[0].options.value+"":"object"==typeof t[0].options.value&&(e=t[0].options.value.label?t[0].options.value.label:"")))),this._editor.value=e);var i=void 0;if(t[0])if(t[0].options.hasOwnProperty("value")&&void 0!==t[0].options.value){let e=t[0].options.value;i=e instanceof Object&&e.hasOwnProperty("value")?e.value:e}else i=t[0].options.label;this._properties.value.value=i});V.call(this,""),this.fire("change")},_showPopup:function(){if(this.elements.popup){if(this.elements.popup.visibleFlag)return;this.elements.popup.visibleFlag=!0}else this._delayPopupCreationInfos&&"function"==typeof this._delayPopupCreationInfos.createVisiblePopup&&this._delayPopupCreationInfos.createVisiblePopup()},_hidePopup:function(){if(this.elements.popup&&this.elements.popup.visibleFlag&&(this.elements.popup.visibleFlag=!1,this._editor)){var e=this;setTimeout(function(){e._editor&&!e._editor._isFocused()&&e._editor._onFocusReceived(!1)},1)}},_onFocusReceived:function(){this._parent(),this._editor&&this._editor._onFocusReceived()},_giveFocus:function(){this._parent(),this._editor&&this._editor._giveFocus()},_applyCustomFilterMessage:function(){this._dataGridView&&(this._dataGridView.placeholder=this.customFilterMessage),this._customFilterMessageWidth=void 0},_applyAllowResetToUndefinedByUIFlag:function(){this._editor&&(this._editor.displayClearFieldButtonFlag=this.allowResetToUndefinedByUIFlag&&!this.multiSearchMode)},_applyTouchMode:function(){this._parent(),this._getCurrentTouchMode()?this.elements.container.setAttributeNode(document.createAttribute("touch-mode")):this.elements.container.removeAttribute("touch-mode"),this._editor&&(this._editor.touchMode=this.touchMode),this._selectionChips&&(this._selectionChips.touchMode=this.touchMode),this._dataGridView&&(this._dataGridView.touchMode=this.touchMode)},_getElementToFocus:function(){return this._editor._getElementToFocus()},getValueToCommit:function(){return this._editor?this._editor.valueToCommit:""},destroy:function(){this._dataGridView&&(this._dataGridView.destroy(),delete this._dataGridView),this._editor&&(this._editor.destroy(),delete this._editor),this._selectionChips&&(this._selectionChips.destroy(),delete this._selectionChips),this._parent()}})});