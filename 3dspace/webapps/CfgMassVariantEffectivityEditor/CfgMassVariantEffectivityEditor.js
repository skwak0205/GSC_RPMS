define("DS/CfgMassVariantEffectivityEditor/scripts/CfgMassVariantEditorServices",["DS/Tree/TreeDocument","DS/Tree/TreeNodeModel","DS/TreeModel/DataModelSet","DS/CfgBaseUX/scripts/CfgUtility","DS/CfgBaseUX/scripts/CfgXMLServices","DS/CfgBaseUX/scripts/CfgColumnManager","i18n!DS/CfgBaseUX/assets/nls/CfgBaseUXNLS","DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext","i18n!DS/CfgMassVariantEffectivityEditor/assets/nls/CfgMassVariantEffectivityEditor"],function(e,t,i,n,o,a,s,r,l){var d={processAttachedModels:function(e){for(var t=[],i=e.contexts.content.results,n=0;n<i.length;n++){var o={displayName:"",name:"",revision:""};o.physicalId=i[n].physicalID;for(var a=0;a<i[n].data.length;a++)"Marketing Name"==i[n].data[a].name&&i[n].data[a].value&&(o.displayName=i[n].data[a].value[0]);for(a=0;a<i[n].basicData.length;a++)"name"==i[n].basicData[a].name&&(o.name=i[n].basicData[a].value[0]);""==o.displayName&&(o.displayName=o.name),t.push(o)}return t},buildFeature:function(e,t){return'<Feature Type = "ConfigFeature" Name = "'+e.replace(/&(?!amp;)/g,"&amp;")+'">'+t+"</Feature>"},buildOption:function(e){return'<Feature Type = "ConfigFeature" Name = "'+e.replace(/&(?!amp;)/g,"&amp;")+'"/>'},buildContext:function(e,t){return'<Context HolderType = "Model" HolderName = "'+e.replace(/&(?!amp;)/g,"&amp;")+'">'+t+"</Context>"},buildGlobalExpression:function(e){return'<CfgEffectivityExpression xs:schemaLocation = "urn:com:dassault_systemes:config CfgEffectivityExpression.xsd" xmlns:xs = "http://www.w3.org/2001/XMLSchema-instance" xmlns = "urn:com:dassault_systemes:config"><Expression Domain="ConfigChange_Variant">'+e+"</Expression></CfgEffectivityExpression>"},getFilterablesVariantGrid:function(e,t){for(var i=[],o=0;o<t.length;o++)i.push({instancePID:t[o].instanceId});return new Promise(function(t,o){var a={version:"1.0",mode:"Display",modelPID:e,withBinaries:"NO",instances:i,modelMask:"",featureMask:"Read",optionMask:"Read"},s=JSON.stringify(a);n.makeWSCall("/resources/modeler/configuration/navigationServices/getFilterablesVariantGrid","POST","enovia","application/json",s,function(e){t(e)},function(e,t){o(t||e)},!0)})},loadDictionary:function(e,t,i){var a=this;null!=e.get("dictionary")&&i(e.get("id"));var s=e.get("configurationContext"),r="",l=t.getEvolutionExpressionFromModelName(s.name);""!==l&&(r={evolutionExpression:JSON.stringify({filterExpression:o.getValidXmlWithoutDescId(l)})}),n.getLegacyCfgDico(e.get("id"),r).then(function(t){var n=a.processDictionary(t);e.set("dictionary",n);var o=a.createDictionaryTreeDocument(n);e.set("treeDocumentVariantView",o),i(e.get("id"))})},processDictionary:function(e){for(var t=[],i=0;i<e.features.length;i++){var n=e.features[i],o={name:n.name,displayName:n.displayValue,revision:n.revision,options:[],type:n.type_NLS,current:n.current_NLS,originated:n.originated,description:null!=n.description?n.description:"",selectionType:n.selectionType,check:!1,physicalID:n.id.replace("pid:","")};if("Preliminary"!==n.current&&"Obsolete"!==n.current){for(var a=0;a<n.options.length;a++){var s=n.options[a];o.options.push({name:s.name,displayName:s.displayValue,type:s.type_NLS,current:s.current_NLS,originated:s.originated,description:null!=s.description?s.description:"",selectionType:n.selectionType,check:!1,physicalID:s.id.replace("pid:","")})}t.push(o)}}return t},updateAttributes:function(e,t){for(var i=e._options.grid,n=a.getColumnIndexes("VariantsAndOptionGroups"),o=0;o<n.length;o++){var s=n[o];"type"!=n[o]&&"current"!=n[o]||(s+="_NLS"),null==t[s]&&(s=n[o]),i[n[o]]=t[s]}e.updateOptions({grid:i})},createDictionaryTreeDocument:function(n){var o=new i,s=new e({dataModelSet:o});s.prepareUpdate();for(var r=0;r<n.length;r++){for(var l=n[r],d={},c=a.getColumnIndexes("VariantsAndOptionGroups"),u=0;u<c.length;u++)d[c[u]]="";var f=new t({label:l.displayName,grid:{name:l.name,type:l.type,checkbx:!1},data:{self:l,feature:l}});this.updateAttributes(f,l),s.addRoot(f);for(var p=0;p<l.options.length;p++){var h=l.options[p],g=new t({label:h.displayName,grid:{name:h.name,type:h.type,checkbx:!1},data:{self:h,feature:l}});this.updateAttributes(g,h),f.addChild(g)}}return s.expandAll(),s.pushUpdate(),s},setEffectivity:function(e,t,i,o,a){this.numberOfModifiedInstances=t,d.unsetEffectivitySuccessfulCount=0,d.unsetEffectivityFailedCount=0,d.effectivityExpression=[],d.unsetEffectivityExpression=[],d.PADContext=o;d.instanceIds=Object.keys(e);for(var s=0;s<d.instanceIds.length;s++)if(-1!=t.indexOf(e[d.instanceIds[s]].data.instance.instanceId)){var r={};r.pid=e[d.instanceIds[s]].data.instance.instanceId,r.expressions=[{VariantContent:e[d.instanceIds[s]].xml}],""!=e[d.instanceIds[s]].xml?d.effectivityExpression.push(r):d.unsetEffectivityExpression.push(r)}0==d.unsetEffectivityExpression.length&&0==d.effectivityExpression.length&&(n.showwarning(l.CFG_Edit_Effectivity_AllSuccessful,"success"),i()),d.unsetEffectivityExpression.length>0&&this._unsetEffectivities(d.unsetEffectivityExpression,i,a),0!=d.effectivityExpression.length&&this._setEffectivity(d.effectivityExpression,i,a)},_unsetEffectivities:function(e,t,i){return new Promise(function(o,a){var s=[];for(counter=0;counter<e.length;counter++)s.push(e[counter].pid);var c;c={version:"1.0",unsetList:s,domain:"Variant"};var u=JSON.stringify(c),f=[],p=r.get();if(p&&p.AuthoringContextHeader)for(var h in p.AuthoringContextHeader)f.push({key:h,value:p.AuthoringContextHeader[h]});var g=null;f.length>0&&(g={operationheader:{key:f[0].key,value:f[0].value}}),n.makeWSCall("/resources/modeler/configuration/authoringServices/unsetVariantEffectivities","POST","enovia","json",u,function(e){if(void 0===e.GlobalStatus||"SUCCESS"!=e.GlobalStatus&&"ATLEAST_ONEFAILURE"!=e.GlobalStatus)t(),0==d.effectivityExpression&&n.showwarning(l.CFG_Unset_Effectivity_Failed,"error");else{for(var a=[],s=0;s<e.results.length;s++){var r=e.results[s],c=r.existing,u=r.new;"SUCCESS"==e.results[s].status&&null!=u&&null!=u.pid&&null!=c&&null!=c.pid&&a.push(c.pid)}var f={commandName:"cfgMassEditVariant",widgetId:widget.id,response:e,data:{}};n.publishPostProcessingEventForApplications(f),a.length>0&&n.showwarning(l.CFG_Application_Refresh_For_Instance_Evolved,"info"),d.emptyInstanceID=[],d.unsetEffectivityExpression.forEach(function(e){d.emptyInstanceID.push(e.pid)}),t(),i.initiateCurrentEffectivityXmls(),i.resetModifiedInstances(),0==d.effectivityExpression&&(void 0!==e.GlobalStatus&&"SUCCESS"==e.GlobalStatus?n.showwarning(l.CFG_Unset_Effectivity_Successful,"success"):void 0!==e.GlobalStatus&&"ATLEAST_ONEFAILURE"==e.GlobalStatus&&n.showwarning(l.CFG_Unset_Effectivity_Partially_Successful,"info"))}o(e)},function(e){t(),0==d.effectivityExpression&&(n.isDefined(e)&&n.isDefined(e.errorMessage)?n.showwarning(l.CFG_Unset_Effectivity_Failed+"\n"+e.errorMessage,"error"):n.showwarning(l.CFG_Unset_Effectivity_Failed,"error")),a(e)},!0,g)})},_setEffectivity:function(e,t,i){return new Promise(function(o,a){var d=[],c=r.get();if(c&&c.AuthoringContextHeader)for(var u in c.AuthoringContextHeader)d.push({key:u,value:c.AuthoringContextHeader[u]});var f=null;d.length>0&&(f={operationheader:{key:d[0].key,value:d[0].value}});var p,h=[];for(counter=0;counter<e.length;counter++)h.push({pid:e[counter].pid,VariantContent:e[counter].expressions[0].VariantContent});p={version:"1.1",output:{domains:"Variant",view:"Current",targetFormat:"TXT"},domain:"Variant",view:"All",expressionList:h};var g=JSON.stringify(p);n.makeWSCall("/resources/modeler/configuration/authoringServices/setVariantEffectivities?traces=0&perfo=0 HTTP/1.1","POST","enovia","application/json",g,function(e){for(var a=[],r=0;r<e.results.length;r++){var d=e.results[r],c=d.existing,u=d.new;"SUCCESS"==e.results[r].status&&null!=u&&null!=u.pid&&null!=c&&null!=c.pid&&a.push(c.pid)}var f={commandName:"cfgMassEditVariant",widgetId:widget.id,response:e,data:{}};if(n.publishPostProcessingEventForApplications(f),a.length>0&&n.showwarning(l.CFG_Application_Refresh_For_Instance_Evolved,"info"),t(),i.initiateCurrentEffectivityXmls(),i.resetModifiedInstances(),null!=e.GlobalStatus&&"ERROR"==e.GlobalStatus)if(null!=e.results&&null!=e.results[0]){let t="";t=126==e.results[0].errorCode?l.CFG_Mass_EditVariant_Failed_WorkUnder_Different_Criteria+"<b>"+s.CfgHeaderEditConfigurationContext+"</b>":e.results[0].message,n.showwarning(t,"error"),console.log("Mass Edit Variant Effectivity operation error = "+e.results[0].errorDetails)}else n.showwarning(l.CFG_Edit_Effectivity_AllFailed,"error");else null!=e.GlobalStatus&&"ATLEAST_ONEFAILURE"==e.GlobalStatus?n.showwarning(l.CFG_Edit_Effectivity_Partially_Successful,"info"):n.showwarning(l.CFG_Edit_Effectivity_AllSuccessful,"success");o(e)},function(e){t(),n.isDefined(e)&&n.isDefined(e.errorMessage)?n.showwarning(l.CFG_Edit_Effectivity_AllFailed+"\n"+e.errorMessage,"error"):n.showwarning(l.CFG_Edit_Effectivity_AllFailed,"error"),a(e)},!0,f)})},isKarmaOdtMode:function(){return void 0!==window.__karma__}};return d}),define("DS/CfgMassVariantEffectivityEditor/scripts/CfgTweakerTristate",["UWA/Core","DS/Tweakers/TweakerBase","DS/Utilities/Dom","DS/Utilities/Utils","DS/Core/PointerEvents"],function(e,t,i,n,o){"use strict";var a=t.inherit({name:"TweakerTristate",publishedProperties:{value:{defaultValue:!1,type:"boolean",advancedSetter:!0},valueType:{defaultValue:"boolean",type:"string"},displayStyle:{defaultValue:"checkbox",type:"string"}},computeTweakerContentLength:function(){return this._getCurrentTouchMode()?19:14},_upgradeValue:function(e){return"1"===e||1===e||"true"===e||!0===e||"0"!==e&&0!==e&&"false"!==e&&!1!==e&&"undefined"}}),s=function(e,i){t.prototype.baseViewModule.call(this,e,i)};n.applyMixin(s,t.prototype.baseViewModule);var r=function(e,t){s.call(this,e,t)};n.applyMixin(r,s),r.prototype.buildView=function(){if(this._tweaker.elements.container){var t,i=this._options.viewOptions||{};i.type=this._options.viewOptions.displayStyle,i.touchMode=this._tweaker._getCurrentTouchMode(),i.fireOnlyFromUIInteractionFlag=!0,this._view=new e.Element("div"),this.icon=new e.Element("div"),this.icon.inject(this._view),this.icon.setStyles({height:"100%",width:"100%"}),"undefined"===this._tweaker.value?t="wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-checkbox-off wux-ui-3ds-lg unselectedIcon":!0===this._tweaker.value?t="wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-check wux-ui-3ds-lg checkIcon":!1===this._tweaker.value&&(t="wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-wrong wux-ui-3ds-lg notIcon"),this.icon.addClassName(t),this.setValue(this._tweaker.value)}},r.prototype.handleEvents=function(){var e=this._view,t=this.icon,n=this._tweaker;i.addEventOnElement(n,e,o.POINTERHIT,function(e){e.stopPropagation(),t.className="";var i="";!1===n.value?(i="wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-checkbox-off wux-ui-3ds-lg unselectedIcon",n.value="undefined"):!0===n.value?(i="wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-checkbox-off wux-ui-3ds-lg unselectedIcon",n.value="undefined"):"undefined"===n.value&&(n.value=!0,i="wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-check wux-ui-3ds-lg checkIcon"),t.addClassName(i)})},r.prototype.setValue=function(e,t){if(this.icon){var i="";"undefined"===this._tweaker.value?i="wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-checkbox-off wux-ui-3ds-lg unselectedIcon":!0===this._tweaker.value?i="wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-check wux-ui-3ds-lg checkIcon":!1===this._tweaker.value&&(i="wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-wrong wux-ui-3ds-lg notIcon"),this.icon.className="",this.icon.addClassName(i)}},r.prototype.setTouchMode=function(e,t){this.icon&&(this.icon.touchMode=e)};var l=function(e,t){s.call(this,e,t)};return n.applyMixin(l,s),l.prototype.buildView=function(){var t;this._tweaker.elements.container&&(this._view=new e.Element("span"),"undefined"===this._tweaker.value?t="wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-checkbox-off wux-ui-3ds-lg unselectedIcon":!0===this._tweaker.value?t="wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-check wux-ui-3ds-lg ":!1===this._tweaker.value&&(t="wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-wrong wux-ui-3ds-lg "),this._view.addClassName(t),this.setValue(this._tweaker.value),this.setTouchMode(this._tweaker._getCurrentTouchMode()))},l.prototype.setValue=function(e,t){if(this._view){var i="";"undefined"===this._tweaker.value?i="wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-checkbox-off wux-ui-3ds-lg unselectedIcon":!0===this._tweaker.value?i="wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-check wux-ui-3ds-lg ":!1===this._tweaker.value&&(i="wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-wrong wux-ui-3ds-lg "),this._view.className="",this._view.addClassName(i)}},l.prototype.setTouchMode=function(e,t){this._view&&(this._tweaker.readOnly?this._view.style.paddingLeft=e?"14px":"7px":this._view.touchMode=e)},a.prototype.baseViewModule=s,a.prototype.VIEW_MODULES={switch:{classObject:r,options:{viewOptions:{displayStyle:"switch"}}},readOnly:{classObject:l,options:{viewOptions:{displayStyle:"switch"}}},checkbox:{classObject:r,options:{viewOptions:{displayStyle:"checkbox"}}}},a.prototype.registerViewModule=function(e,t){},a}),define("DS/CfgMassVariantEffectivityEditor/scripts/CfgMassVariantEffectivityEditorModelSelector",["UWA/Drivers/Alone","DS/Core/Core","DS/Controls/ComboBox","UWA/Class/View","i18n!DS/CfgMassVariantEffectivityEditor/assets/nls/CfgMassVariantEffectivityEditor"],function(e,t,i,n,o){"use strict";return n.extend({_textNode:null,setup:function(e){this._parent(e)},enable:function(){1!=this.options.data.length&&(this._wuxComboBox.disabled=!1)},disable:function(){this._wuxComboBox.disabled=!0},render:function(){var e=this;this.options.processedData=[];for(var t=0;t<this.options.data.length;t++){var n=this.options.data[t];this.options.processedData.push({valueItem:n,labelItem:n.displayName})}return this._wuxComboBox=new i({enableSearchFlag:!1,actionOnClickFlag:!1,elementsList:this.options.processedData,placeholder:o.CFG_Select_Model,selectedIndex:0}),this._wuxComboBox.addEventListener("change",function(t){e.options.onChangeCB(e._wuxComboBox.currentValue),console.log(t)}),1==this.options.data.length&&(this._wuxComboBox.hide(),this._text=this.options.data[0].displayName),this}})}),define("DS/CfgMassVariantEffectivityEditor/scripts/CfgMassVariantEditorDataGridViewToolbar",["DS/CfgBaseUX/scripts/CfgDialog","DS/Controls/Toggle","i18n!DS/CfgMassVariantEffectivityEditor/assets/nls/CfgMassVariantEffectivityEditor"],function(e,t,i){var n=Object.create(null);return n.toolbar=null,n.isPasteEffectivityWarningToShow=!0,n.writetoolbarDefination=function(){var e={entries:[{id:"ID_ColumnText",dataElements:{typeRepresentation:"string",value:"",label:i.CFG_SearchColumns,tooltip:i.CFG_SearchColumns,placeholder:i.CFG_SearchColumns,overflowPriority:"none",visibleFlag:!1,displayLabel:!1,category:"other",class:"CfgMassVariantSearchOptionTextBox"},position:"far",children:[]},{id:"ID_Search",dataElements:{typeRepresentation:"functionIcon",tooltip:i.CFG_SearchColumns,disabled:!1,icon:{iconName:"search",fontIconFamily:1},category:"other",action:{module:"DS/CfgMassVariantEffectivityEditor/scripts/CfgMassVariantEditorDataGridViewToolbar",func:"onSearchClick"}},position:"far",children:[]},{id:"ID_Plus",dataElements:{typeRepresentation:"functionIcon",tooltip:i.CFG_AddORConditions,disabled:!0,icon:{iconName:"plus",fontIconFamily:1},category:"Touch",action:{module:"DS/CfgMassVariantEffectivityEditor/scripts/CfgMassVariantEditorDataGridViewToolbar",func:"onPlusClick"}},position:"far",children:[]},{id:"ID_Copy",dataElements:{typeRepresentation:"functionIcon",tooltip:i.CFG_CopyEffectivityConditions,disabled:!0,icon:{iconName:"copy",fontIconFamily:1},category:"Touch",action:{module:"DS/CfgMassVariantEffectivityEditor/scripts/CfgMassVariantEditorDataGridViewToolbar",func:"onCopyClick"}},position:"far",children:[]},{id:"ID_Paste",dataElements:{typeRepresentation:"functionIcon",tooltip:i.CFG_PasteEffectivityConditions,disabled:!0,icon:{iconName:"paste",fontIconFamily:1},category:"Touch",action:{module:"DS/CfgMassVariantEffectivityEditor/scripts/CfgMassVariantEditorDataGridViewToolbar",func:"onPasteClick"}},position:"far",children:[]},{id:"ID_Duplicate",dataElements:{typeRepresentation:"functionIcon",tooltip:i.CFG_DuplicateEffectivityConditions,disabled:!0,icon:{iconName:"duplicate",fontIconFamily:1},category:"Touch",action:{module:"DS/CfgMassVariantEffectivityEditor/scripts/CfgMassVariantEditorDataGridViewToolbar",func:"onDuplicateClick"}},position:"far",children:[]},{id:"ID_Minus",dataElements:{tooltip:i.CFG_DeleteORConditions,typeRepresentation:"functionIcon",disabled:!0,icon:{iconName:"trash",fontIconFamily:1},category:"Touch",action:{module:"DS/CfgMassVariantEffectivityEditor/scripts/CfgMassVariantEditorDataGridViewToolbar",func:"onMinusClick"}},position:"far",children:[]},{id:"ID_SwitchView",dataElements:{typeRepresentation:"functionIcon",tooltip:i.CFG_VerticalSwitchView,disabled:!1,visibleFlag:!1,icon:{iconName:"table-vertical",fontIconFamily:1},category:"Touch",action:{module:"DS/CfgMassVariantEffectivityEditor/scripts/CfgMassVariantEditorDataGridViewToolbar",func:"onSwitchViewClick"}},position:"far",children:[]},{id:"ID_Dictionary",dataElements:{typeRepresentation:"functionIcon",tooltip:i.CFG_AddVariantsOptions,disabled:!1,visibleFlag:!1,icon:{iconName:"book-open",fontIconFamily:1},category:"Touch",action:{module:"DS/CfgMassVariantEffectivityEditor/scripts/CfgMassVariantEditorDataGridViewToolbar",func:"onShowDictionaryClick"}},position:"far",children:[]}]};return JSON.stringify(e)},n.onPlusClick=function(e){n.toolbar.currentModel.addORCondition(),n.toolbar.currentModel.onModelUpdateCallback&&n.toolbar.currentModel.onModelUpdateCallback()},n.onSearchClick=function(e){1==n.toolbar.getNodeModelByID("ID_ColumnText").options.visibleFlag?n.toolbar.updateNodeModel("ID_ColumnText",{visibleFlag:!1}):n.toolbar.updateNodeModel("ID_ColumnText",{visibleFlag:!0})},n.onCopyClick=function(e){n.toolbar.currentModel.addCopyCondition(),n.toolbar.isCopyOperationPerformed="YES"},n.performPasteOperation=function(){n.toolbar.currentModel.addPasteCondition();var e=[{IdValue:"ID_Paste",StateValue:!0}];n.setToolbarState(e),n.toolbar.isCopyOperationPerformed="NO",n.toolbar.currentModel.set("copiedInstances",[]),n.toolbar.currentModel.onModelUpdateCallback&&n.toolbar.currentModel.onModelUpdateCallback()},n.onPasteClick=function(e){1!=n.isPasteEffectivityWarningToShow?(n.performPasteOperation(),n.toolbar.currentModel.onModelUpdateCallback&&n.toolbar.currentModel.onModelUpdateCallback()):n.showPasteEffectivityWarningDialog()},n.onDuplicateClick=function(e){n.toolbar.currentModel.addDuplicateCondition();var t=[{IdValue:"ID_Duplicate",StateValue:!0},{IdValue:"ID_Paste",StateValue:!0}];n.setToolbarState(t),n.toolbar.currentModel.onModelUpdateCallback&&n.toolbar.currentModel.onModelUpdateCallback()},n.onMinusClick=function(e){n.toolbar.currentModel.removeORCondition(),n.toolbar.currentModel.onModelUpdateCallback&&n.toolbar.currentModel.onModelUpdateCallback()},n.setToolbarState=function(e){if(e)for(var t=0;t<e.length;t++){var i=e[t];n.toolbar.updateNodeModel(i.IdValue,{disabled:i.StateValue})}},n.showPasteEffectivityWarningDialog=function(){var o=function(){s.closeDialog()},a={width:446,height:215,isResizable:!1,dialogue:{header:i.CFG_Paste_Effectivity_Heading,buttonArray:[{label:"Ok",labelValue:i.Ok,handler:function(){n.performPasteOperation(),s.closeDialog()},className:"primary"},{label:"Cancel",labelValue:i.Cancel,handler:o,className:"default"}],target:widget.body,object:null,postCrossHandler:o}},s=new e(a);s.render(),s.container.setStyle("overflow","auto"),s.container.setHTML(i.CFG_Paste_Effectivity_Warning+"<br><br>"+i.CFG_Paste_Effectivity_Question+"<br>");var r=new t({label:i.CFG_Paste_Effectivity_Preference_Warning});r.addEventListener("change",function(e){1==e.dsModel.checkFlag?n.isPasteEffectivityWarningToShow=!1:n.isPasteEffectivityWarningToShow=!0}),r.inject(s.container)},n}),define("DS/CfgMassVariantEffectivityEditor/scripts/CfgMassVariantEditorModel",["UWA/Class/Model","DS/Tree/TreeDocument","DS/Tree/TreeNodeModel","DS/TreeModel/DataModelSet","DS/CfgBaseUX/scripts/CfgUtility","DS/CfgMassVariantEffectivityEditor/scripts/CfgMassVariantEditorServices","i18n!DS/CfgMassVariantEffectivityEditor/assets/nls/CfgMassVariantEffectivityEditor"],function(e,t,i,n,o,a,s){return e.extend({_onNodeModelUpdateSubscriptionToken:"",_processedAttributes:{},defaults:function(){return{gridEffectivityForConfigurationContext:null,treeDocumentEffectivityGridView:null,treeDocumentVariantView:null,gridViewEffectivityColumns:[],configurationContext:{},selectedInstances:[],copiedInstances:[],dictionary:null}},_addExpressionColumn:function(){var e="350";return window.matchMedia("(max-width: 767px)").matches&&(e="100"),{text:s.CFG_Expression,dataIndex:"Expression",pinned:"right",width:e,editionPolicy:"none"}},_addInstanceColumn:function(){var e="250";return window.matchMedia("(max-width: 767px)").matches&&(e="100"),{text:s.CFG_Instance,dataIndex:"instance",pinned:"left",alwaysVisibleFlag:"true",width:e,editionPolicy:""}},addFeatureColumn:function(e,t,i,n,o,a){for(var s=0;s<e.length;s++)if(e[s].dataIndex==o)return e[s];var r=this.getColumnDefination();return r.name=t,r.text=i,r.dataIndex=o,r.typeRepresentation="string",r.editionPolicy="",r.columnType="Feature",r.featureType=a,e.push(r),r},addOptionColumn:function(e,t,i,n,o,s){var r=this.getColumnDefination();r.name=t,r.text=i,r.dataIndex=s,r.typeRepresentation="tristate",r.editionPolicy="EditionInPlace",r.columnType="Option",r.featureType="",r.parentId=o,1==a.isReadOnlyMode&&(r.editionPolicy="none"),void 0===e.children&&(e.children=[]),e.children.push(r)},getColumnDefination:function(){return{name:"",text:"",dataIndex:"",typeRepresentation:"string",editionPolicy:"",columnType:"",featureType:"",parentId:""}},createColumns:function(e){var t=[];if(t.push(this._addInstanceColumn()),null!=e.criterias)for(var i=e.criterias.features,n=0;n<i.length;n++){var o=i[n].featureAttributes.results[0];(l=this._extractAttributes(o)).parentId="",null!=i[n].featureType?l.featureType=i[n].featureType:l.featureType="NonExclusive",this._processedAttributes[i[n].featurePID]=l;var s=this.addFeatureColumn(t,l.name,l.displayName,l.type,l.physicalId,l.featureType);s.children=[];for(var r=0;r<i[n].options.length;r++){var l;o=i[n].options[r].optionAttributes.results[0];(l=this._extractAttributes(o)).parentId=i[n].featurePID,this._processedAttributes[i[n].options[r].optionPID]=l;var d=this.getColumnDefination();d.name=l.name,d.text=l.displayName,d.dataIndex=l.physicalId,d.typeRepresentation="tristate",d.editionPolicy="EditionInPlace",d.columnType="Option",d.featureType=l.type,d.parentId=l.parentId,1==a.isReadOnlyMode&&(d.editionPolicy="none"),s.children.push(d)}}t.push(this._addExpressionColumn()),this.set("gridViewEffectivityColumns",t)},_extractAttributes:function(e){var t={};return t.physicalId=e.physicalID,e.data.forEach(function(e){"Display Name"==e.name&&(t.displayName=e.value[0])}),e.basicData.forEach(function(e){"name"==e.name&&(t.name=e.value[0])}),t.type=e.type,t},getProcessedInstances:function(){for(var e={},t=this.get("selectedInstances"),i=0;i<t.length;i++)e[t[i].instanceId]=t[i];return e},createTreeDocument:function(e){for(var a=this.get("gridViewEffectivityColumns"),r={},l=0;l<a.length;l++){r[a[l].dataIndex]="";for(var d=0;null!=a[l].children&&d<a[l].children.length;d++)r[a[l].children[d].dataIndex]="undefined"}r.instance="",r.Expression="";var c=!1,u=this.getProcessedInstances(),f=new n,p=new t({dataModelSet:f});p.prepareUpdate();var h=[];if(null!=e.expressions)for(var g=0;g<e.expressions.length;g++)h[e.expressions[g].instancePID]=e.expressions[g];if(null!=e.classification)for(g=0;g<e.classification.length;g++){"LEGACY_EFF"!=e.classification[g].classificationCode?h[e.classification[g].instancePID]={effectivity:[]}:c=!0}for(var v in u)if(u.hasOwnProperty(v)){if(void 0===h[v])continue;var C=h[v].effectivity;if(void 0===C)continue;for(var y=u[v],m=0;m<C.length;m++){for(var E=C[m].optionSelection,w=Object.assign({},r),I={},V=y.name,D=0;D<E.length;D++){var x=E[D],_=x.isSelected;"YES"==_&&(_=!0),"NOT"==_&&(_=!1),w[this._processedAttributes[x.optionPID].physicalId]=_,I.instance=y,I.isModified=!1,I.isAllowed=!0,0!=m&&(V="")}w.instance=V;var b=new i({label:V,grid:w,data:I});this.updateDisplayExpression(b),b.options.data.isModified=!1,p.addChild(b)}if(0===C.length){(I={}).instance=y;var M=Object.assign({},r);M.instance=y.name,I.isModified=!1,I.isAllowed=!0;b=new i({label:y.name,grid:M,data:I});p.addChild(b)}}p.expandAll(),p.pushUpdate(),this.set("treeDocumentEffectivityGridView",p),this.registeronNodeUpdateEvent(),0==p.getAllDescendants().length?o.showwarning(s.CFG_Invalid_All_Objects,"info"):1==c&&o.showwarning(s.CFG_Invalid_Objects,"info")},updateDisplayExpression:function(e){var t=this.get("configurationContext"),i=this.get("gridViewEffectivityColumns"),n=this.getORConditionXML(i,e,"TXT"),s=encodeURIComponent(t.displayName);""!=n&&(n=a.buildContext(s,n)),n=a.buildGlobalExpression(n);var r=decodeURIComponent(o.getDisplayExpressionUsingXSLT(n,"TRUE"));e.prepareUpdate(),e.options.data.isModified=!0,e.updateOptions({grid:{Expression:r}}),e.pushUpdate()},getORConditionXML:function(e,t,i){for(var n=t.options.grid,o=[],s=[],r=!1,l=0;l<e.length;l++){e[l].dataIndex;var d=e[l].name;if("TXT"==i&&(d=encodeURIComponent(e[l].text)),o=[],r=!1,void 0!==e[l].children){for(var c=0;c<e[l].children.length;c++){var u=n[e[l].children[c].dataIndex],f=(e[l].children[c].dataIndex,e[l].children[c].name);"TXT"==i&&(f=encodeURIComponent(e[l].children[c].text)),1!=u&&0!=u||(0==u&&(r=!0),o.push({isNOT:r,xml:a.buildOption(f)}),r=!1)}if(0!=o.length)if("NonExclusive"==e[l].featureType)for(var p=0;p<o.length;p++){var h=a.buildFeature(d,o[p].xml);1==o[p].isNOT&&(h="<NOT>"+h+"</NOT>"),s.push(h)}else{for(var g="",v=(r=!1,0);v<o.length;v++)g+=o[v].xml,r=o[v].isNOT;h=a.buildFeature(d,g);1==r&&(h="<NOT>"+h+"</NOT>"),s.push(h)}}}o="";for(var C=0;C<s.length;C++)o+=s[C];return""!=o&&s.length>1&&(o="<AND>"+o+"</AND>"),o},registeronNodeUpdateEvent:function(){var e=this;this._onNodeModelUpdateSubscriptionToken=this.get("treeDocumentEffectivityGridView").onNodeModelUpdate(function(t){e.undoRegisteronNodeUpdateEvent(),e.updateVariantsSelection(t.data.nodeModel),e.updateDisplayExpression(t.data.nodeModel),e.onModelUpdateCallback&&e.onModelUpdateCallback(),e.registeronNodeUpdateEvent()})},updateVariantsSelection:function(e){for(var t=this.get("gridViewEffectivityColumns"),i=0;i<t.length;i++)if(void 0!==t[i].children){var n={};for(childrenCount=0;null!=t[i].children&&"Exclusive"==t[i].featureType&&childrenCount<t[i].children.length;childrenCount++){var o=e.options.grid[t[i].children[childrenCount].dataIndex];"undefined"!=o&&(n[""+o]="")}if(Object.keys(n).length>1)for(childrenCount=0;null!=t[i].children&&"Exclusive"==t[i].featureType&&childrenCount<t[i].children.length;childrenCount++)0==e.options.grid[t[i].children[childrenCount].dataIndex]&&(e.options.grid[t[i].children[childrenCount].dataIndex]="undefined")}},undoRegisteronNodeUpdateEvent:function(){this.get("treeDocumentEffectivityGridView").unsubscribe(this._onNodeModelUpdateSubscriptionToken)},treeUpdateForAddOR:function(e){e.prepareUpdate();var t=e.getSelectedNodes(),n=t[0]._rowID+1,o={};for(var a in Object.assign(o,t[0].options.grid),o)o.hasOwnProperty(a)&&(!0!==o[a]&&!1!==o[a]||(o[a]="undefined"),"instance"==a&&(o[a]=""),"Expression"==a&&(o[a]=""));var s=new i({label:"",grid:o,icons:"",data:t[0].options.data});e.addChild(s,n),e.pushUpdate()},addORCondition:function(){var e=this.get("treeDocumentEffectivityGridView");1==this.isRowSelectionValidForAdd()&&this.treeUpdateForAddOR(e)},processSelectedDataForCopyOperation:function(e){for(var t=[],i=0;i<e.length;i++){var n={grid:JSON.parse(JSON.stringify(e[i].options.grid))};t.push(n)}return t},addCopyCondition:function(){var e=this.get("treeDocumentEffectivityGridView"),t=e.getSelectedNodes(),i=this.processSelectedDataForCopyOperation(t);i.length>0&&(this.set("copiedInstances",i),e._xso.empty())},sortNumber:function(e,t){return e-t},getDataForPasteOperation:function(){for(var e=this.get("treeDocumentEffectivityGridView").getSelectedNodes(),t=[],i=[],n=0;n<e.length;n++){var o=e[n].options.data.instance.instanceId;-1==t.indexOf(o)&&t.push(o)}for(n=0;n<t.length;n++){for(var a=t[n],s=[],r=0;r<e.length;r++)e[r].options.data.instance.instanceId==a&&s.push(e[r]._rowID);s.sort(this.sortNumber),i.push({instanceId:a,rowIds:s})}return i},setModifiedInstances:function(e){for(var t=this.get("treeDocumentEffectivityGridView").getAllDescendants(),i=0;i<t.length;i++)-1!=e.indexOf(t[i].options.data.instance.instanceId)&&(t[i].options.data.isModified=!0)},getInstancesForPasteScenario:function(){var e=this.get("copiedInstances"),t=this.getDataForPasteOperation(),i=this.get("treeDocumentEffectivityGridView").getSelectedNodes(),n=[],o=[],a={};i.forEach(function(e){a[""+e._rowID]=e});for(var s=0;s<t.length;s++){var r=t[s].instanceId,l=t[s].rowIds.length,d=t[s].rowIds,c=e.length;if(l>=c)for(var u=0;u<c;u++){var f=JSON.parse(JSON.stringify(e[u].grid)),p=d[u];n.push(a[p].options.data.instance.instanceId),f.instance=a[p].options.grid.instance,a[p].updateOptions({grid:f})}else{for(u=0;u<l;u++){f=JSON.parse(JSON.stringify(e[u].grid)),p=d[u];n.push(a[p].options.data.instance.instanceId),f.instance=a[p].options.grid.instance,a[p].updateOptions({grid:f})}o.push({instanceId:r,pasteCount:l,copyCount:c})}}return this.setModifiedInstances(n),o},addPasteCondition:function(){var e=this.get("copiedInstances"),t=this.get("treeDocumentEffectivityGridView"),n=t.getSelectedNodes(),o=this.getInstancesForPasteScenario();t.prepareUpdate();for(var a=o.length-1;a>=0;a--)for(var s=o[a].instanceId,r=o[a].pasteCount,l=o[a].copyCount,d=n.length-1;d>=0;d--)if(n[d].options.data.instance.instanceId==s){for(var c=n[d]._rowID+1,u=0;u<l;u++)if(u>=r){var f=JSON.parse(JSON.stringify(e[u].grid));for(var p in f)f.hasOwnProperty(p)&&"instance"==p&&(f[p]="");var h=new i({label:"",grid:f,icons:"",data:n[d].options.data});t.addChild(h,c),c++}break}t.pushUpdate(),t._xso.empty()},treeUpdateForAddDuplicate:function(e,t){e.prepareUpdate();var n=e.getSelectedNodes(),o={},a=[];n.forEach(function(e){a.push(e._rowID),o[""+e._rowID]=e}),a.sort(this.sortNumber);for(var s=a.length-1;s>=0;s--){var r=a[s];t.push(o[r].options.data.instance.instanceId);var l=r+1,d=JSON.parse(JSON.stringify(o[r].options.grid));for(var c in d)d.hasOwnProperty(c)&&"instance"==c&&(d[c]="");var u=new i({label:"",grid:d,icons:"",data:o[r].options.data});e.addChild(u,l)}return e.pushUpdate(),t},addDuplicateCondition:function(){var e=this.get("treeDocumentEffectivityGridView"),t=[];1==this.isRowSelectionValidForDelete()&&(t=this.treeUpdateForAddDuplicate(e,t)),this.setModifiedInstances(t),e._xso.empty()},treeUpdateForRemoveOR:function(e,t){e.prepareUpdate();for(var i=e.getSelectedNodes(),n=0;n<i.length;n++)if(t.push(i[n].options.data.instance.instanceId),""==i[n].options.grid.instance)e.removeRoot(i[n]);else{var o=i[n].options.grid;for(var a in o)if(o.hasOwnProperty(a)){if("instance"==a)continue;"Expression"==a&&(o[a]=""),!0!==o[a]&&!1!==o[a]||(o[a]="undefined")}i[n].updateOptions({grid:o})}return e.pushUpdate(),t},removeORCondition:function(){var e=this.get("treeDocumentEffectivityGridView"),t=[];1==this.isRowSelectionValidForDelete()&&(t=this.treeUpdateForRemoveOR(e,t));for(var i=this.get("treeDocumentEffectivityGridView").getAllDescendants(),n=0;n<i.length;n++)-1!=t.indexOf(i[n].options.data.instance.instanceId)&&(i[n].options.data.isModified=!0)},isRowSelectionValidForDelete:function(){var e=this.get("treeDocumentEffectivityGridView").getSelectedNodes();if(0==e.length)return o.showwarning(s.CFG_No_Selection,"error"),!1;for(var t=0;t<e.length;t++)if(0==e[t].options.data.isAllowed)return o.showwarning(s.CFG_Select_Valid_Object,"error"),!1;return!0},isRowSelectionValidForAdd:function(){var e=this.get("treeDocumentEffectivityGridView").getSelectedNodes();return 0==e.length?(o.showwarning(s.CFG_No_Selection,"error"),!1):e.length>1?(o.showwarning(s.CFG_MultiSelection_Not_Allowed,"error"),!1):0!=e[0].options.data.isAllowed||(o.showwarning(s.CFG_Select_Valid_Object,"error"),!1)},addEffectivityGridViewColumn:function(e){this.undoRegisteronNodeUpdateEvent();var t={},i=this.get("gridViewEffectivityColumns"),n=this.get("treeDocumentEffectivityGridView");n.prepareUpdate();var o=e.feature.selectionType;"Single"==o?o="Exclusive":"Multiple"==o&&(o="NonExclusive");var a=this.addFeatureColumn(i,e.feature.name,e.feature.displayName,e.feature.type,e.feature.physicalID,o);if(t[e.feature.physicalID]="",null!=e.self.options)for(var s=0;s<e.feature.options.length;s++)this.addOptionColumn(a,e.feature.options[s].name,e.feature.options[s].displayName,e.feature.name,e.feature.physicalID,e.feature.options[s].physicalID),t[e.feature.options[s].physicalID]="undefined";else this.addOptionColumn(a,e.self.name,e.self.displayName,e.feature.name,e.feature.physicalID,e.self.physicalID),t[e.self.physicalID]="undefined";var r=n.getAllDescendants();for(s=0;s<r.length;s++){var l=r[s].options.grid;0!=r[s].options.data.isAllowed&&(Object.assign(l,t),r[s].updateOptions({grid:l}))}n.pushUpdate(),this.registeronNodeUpdateEvent()},addEffectivityGridViewColumnWUX:function(e){this.undoRegisteronNodeUpdateEvent();var t={};let i=[];var n=this.get("gridViewEffectivityColumns"),o=this.get("treeDocumentEffectivityGridView");o.prepareUpdate();var a=e.feature.selectionType;"Single"==a?a="Exclusive":"Multiple"==a&&(a="NonExclusive");var s=this.addFeatureColumn(n,e.feature.name,e.feature.displayName,e.feature.type,e.feature.physicalID,a);if(s&&s.children&&s.children.forEach(e=>{i.push(e.name)}),t[e.feature.physicalID]="",null!=e.self.options)for(var r=0;r<e.feature.options.length;r++)i.includes(e.feature.options[r].name)||(this.addOptionColumn(s,e.feature.options[r].name,e.feature.options[r].displayName,e.feature.name,e.feature.physicalID,e.feature.options[r].physicalID),t[e.feature.options[r].physicalID]="undefined");else this.addOptionColumn(s,e.self.name,e.self.displayName,e.feature.name,e.feature.physicalID,e.self.physicalID),t[e.self.physicalID]="undefined";var l=o.getAllDescendants();for(r=0;r<l.length;r++){var d=l[r].options.grid;0!=l[r].options.data.isAllowed&&(Object.assign(d,t),l[r].updateOptions({grid:d}))}o.pushUpdate(),this.registeronNodeUpdateEvent()},removeEffectivityGridViewColumn:function(e){this.undoRegisteronNodeUpdateEvent();var t={},i=this.get("gridViewEffectivityColumns"),n=this.get("treeDocumentEffectivityGridView");if(n.prepareUpdate(),null!=e.self.options){t[e.feature.physicalID]="";for(var o=0;o<e.feature.options.length;o++)t[e.feature.options[o].physicalID]=""}else t[e.self.physicalID]="";var a=n.getAllDescendants();for(o=0;o<a.length;o++){var s=a[o].options.grid;Object.keys(t).forEach(function(e,t){delete s[e]}),a[o].updateOptions({grid:s})}null!=e.self.options?this._removeFeatureColumn(i,e.feature.physicalID):this._removeOptionColumn(i,e.self.physicalID),n.pushUpdate();var r=this;a.forEach(function(e){r.updateDisplayExpression(e)}),this.registeronNodeUpdateEvent()},_removeFeatureColumn:function(e,t){for(var i=e.length-1;i>=0;i--)if(e[i].dataIndex===t){e.splice(i,1);break}},_removeOptionColumn:function(e,t){for(var i=e.length-1;i>=0;i--)for(var n=0;null!=e[i].children&&n<e[i].children.length;n++)if(e[i].children[n].dataIndex===t){e[i].children.splice(n,1);break}},filterColumns:function(e){console.log("filter columns")}})}),define("DS/CfgMassVariantEffectivityEditor/scripts/CfgMassVariantEditorDataGridView",["UWA/Class/View","DS/DataGridView/DataGridView","DS/CfgMassVariantEffectivityEditor/scripts/CfgMassVariantEditorServices","DS/CfgMassVariantEffectivityEditor/scripts/CfgMassVariantEditorDataGridViewToolbar","DS/Core/PointerEvents","DS/CfgBaseUX/scripts/CfgDialog","DS/CfgBaseUX/scripts/CfgUtility","i18n!DS/CfgMassVariantEffectivityEditor/assets/nls/CfgMassVariantEffectivityEditor"],function(e,t,i,n,o,a,s,r){return e.extend({toolbar:null,processedColumns:null,isExpressionColumnAvailable:!0,init:function(e){this._parent(e)},render:function(){this.columnsDeepCloned=JSON.parse(JSON.stringify(this.options.columns)),this.massVariantGridView=new t({treeDocument:this.options.treeDocument,columns:this.columnsDeepCloned,initialEffectivitiesOfInstances:this.options.initialEffectivitiesOfInstances,selectionMode:"cell",defaultColumnDef:{width:"auto",typeRepresentation:"string",editableFlag:!0,resizableFlag:!0,sortableFlag:!1}});return this.massVariantGridView.getTypeRepresentationFactory().registerTypeTemplates({tristatetemplate:{path:"DS/CfgMassVariantEffectivityEditor/scripts/CfgTweakerTristate",options:{}}}),this.massVariantGridView.getTypeRepresentationFactory().registerTypeRepresentations({tristate:{stdTemplate:"tristatetemplate"}}),this.massVariantGridView.showEditableFeedbackFlag=!1,this.massVariantGridView.layout.rowsHeader=!0,this._getCellTooltip(),0==i.isReadOnlyMode&&!1===i.isKarmaOdtMode()&&(n.toolbar=this.massVariantGridView.setToolbar(n.writetoolbarDefination())),this.toolbar=n.toolbar,this.toolbarExportExtentionsForCallbacks=n,this.registerUpdateToolbarCommandStatesEvent(),this.registerLiveChangeEvent(),this.buildContextualMenu(),this},_getCellTooltip:function(){this.massVariantGridView.getCellTooltip=function(e){var t=null;return e.cellModel&&("undefined"==e.cellModel||1==e.cellModel||(t=e.cellModel)),{shortHelp:t,updateModel:!1}}.bind(this)},setToolbarStateOnPostAdd:function(){var e=[{IdValue:"ID_Plus",StateValue:!1},{IdValue:"ID_Copy",StateValue:!1},{IdValue:"ID_Duplicate",StateValue:!1},{IdValue:"ID_Minus",StateValue:!1}];null!=this.toolbar.isCopyOperationPerformed&&"YES"==this.toolbar.isCopyOperationPerformed&&e.push({IdValue:"ID_Paste",StateValue:!1}),n.setToolbarState(e)},setToolbarStateOnPostRemove:function(){if(this.massVariantGridView.treeDocument.getXSO().isEmpty()){var e=[{IdValue:"ID_Plus",StateValue:!0},{IdValue:"ID_Copy",StateValue:!0},{IdValue:"ID_Paste",StateValue:!0},{IdValue:"ID_Duplicate",StateValue:!0},{IdValue:"ID_Minus",StateValue:!0}];n.setToolbarState(e)}},registerUpdateToolbarCommandStatesEvent:function(){var e=this;this.massVariantGridView.treeDocument.getXSO().onPostAdd(function(){e.setToolbarStateOnPostAdd(e)}),this.massVariantGridView.treeDocument.getXSO().onPostRemove(function(){e.setToolbarStateOnPostRemove(e)})},registerLiveChangeEvent:function(){if(this.toolbar){var e=this;this.toolbar.addEventListener("liveChange",function(t){1==t.dsModel._properties.value.dirty&&e.filterColumns(t.dsModel._properties.value.value)})}},filterColumns:function(e){for(var t=this.massVariantGridView.layout,i=this.massVariantGridView.layout.getLeafColumns(),n=0;null!=i&&n<i.length;n++)"Expression"!==i[n].name&&"instance"!==i[n].name&&void 0!==i[n].name&&(t.setColumnVisibleFlag(i[n].dataIndex,!1,{isUserInteraction:!0}),-1!=i[n].text.toUpperCase().indexOf(e.toUpperCase())&&t.setColumnVisibleFlag(i[n].dataIndex,!0,{isUserInteraction:!0}))},filterRows:function(e){this.massVariantGridView.layout;for(var t=this.options.treeDocument.getAllDescendants(),i=0;i<t.length;i++)t[i].show(),-1===t[i]._options.data.instance.name.toUpperCase().indexOf(e.toUpperCase())&&t[i].hide()},isValidNotMenuCell:function(e){if(!0===e.cellInfos.cellModel||!1===e.cellInfos.cellModel||"undefined"===e.cellInfos.cellModel)return!0},updateCellValues:function(e,t,i){var n={};if("Exclusive"==this.options.columns[i.parentIndex].featureType&&"undefined"!=e){var o=this.options.columns[i.parentIndex].children;if(void 0===o)return;for(var a="undefined",s=0;s<o.length;s++){var r=this.options.columns[i.parentIndex].children[s];"undefined"!=t.options.grid[r.dataIndex]&&(a=t.options.grid[r.dataIndex])}if(a!=e)for(s=0;s<o.length;s++){n[(r=this.options.columns[i.parentIndex].children[s]).dataIndex]="undefined"}}n[this.options.columns[i.parentIndex].children[i.childIndex].dataIndex]=e,t.options.data.isModified=!0,t.updateOptions({grid:n}),t.pushUpdate()},setCellValues:function(e,t){var i=this.options.treeDocument.getNthRoot(e.cellInfos.rowID);i.prepareUpdate();var n=this.getColumnFromcolumnID(e.cellInfos.columnID);if(-1!=n.childIndex){this.updateCellValues(t,i,n)}},getColumnFromcolumnID:function(e){for(var t=-1,i=null,n=-1,o=0,a=this.options.columns,s=0;s<a.length;s++){for(void 0===a[s].children&&t++,i=s,childrenCount=0;null!=a[s].children&&childrenCount<a[s].children.length;childrenCount++)if(e==++t){n=childrenCount,o=1;break}if(1==o)break}return{parentIndex:i,childIndex:n}},buildCellSelectionContextualMenu:function(e){var t=this,i=[];return i.push({type:"PushItem",title:r.CFG_Set_Not,fonticon:"",state:"",action:{callback:function(i){i&&i.context&&i.context.id&&t.setCellValues(e,!1)},context:{id:"NOT"}}},{type:"PushItem",title:r.CFG_Set_Selected,fonticon:"",state:"",action:{callback:function(i){i&&i.context&&i.context.id&&t.setCellValues(e,!0)},context:{id:"Select"}}},{type:"PushItem",title:r.CFG_Set_Unselected,fonticon:"",state:"",action:{callback:function(i){i&&i.context&&i.context.id&&t.setCellValues(e,"undefined")},context:{id:"Unselect"}}}),i},buildHeaderContextualMenu:function(e){var t=[];if(0==this.isExpressionColumnAvailable)return t;var i=this.massVariantGridView,n="";return 1==i.layout.getColumnVisibleFlag("Expression")&&(n={family:"DSFontIcon",content:"wux-ui-3ds wux-ui-3ds-check"}),"Expression"!=e.cellInfos.cellModel&&e.cellInfos.cellModel,t.push({type:"PushItem",title:r.CFG_Expression,fonticon:n,state:"",action:{callback:function(e){if(e&&e.context&&e.context.id){var t=i.layout.getColumnVisibleFlag(e.context.id);i.layout.setColumnVisibleFlag(e.context.id,!t,{isUserInteraction:!0})}},context:{id:"Expression"}}}),t},buildInformationContextualMenu:function(e){var t=[],i=this;return t.push({type:"PushItem",title:r.CFG_Information,fonticon:{family:"DSFontIcon",content:"wux-ui-3ds wux-ui-3ds-info"},state:"",action:{callback:function(t){if(t&&t.context&&t.context.id){var n=i.options.treeDocument.getNthRoot(e.cellInfos.rowID)._options.data.instance.currentEffectivityXmls.xml,o=r.Effectivity_Not_Set;""!=n&&(o=decodeURIComponent(s.getDisplayExpressionUsingXSLT(n))),o=o.replace(/\n/gi,"<br/><br/>"),i.showGlobalEffectivityDialog(o,e.cellInfos.nodeModel.options.grid.instance)}},context:{id:"globalEffectivity"}}}),t},contextualMenuCall:function(e){return 1==this.isValidNotMenuCell(e)?this.buildCellSelectionContextualMenu(e):0===e.cellInfos.columnID&&null!=e.cellInfos.nodeModel?this.buildInformationContextualMenu(e):void 0===e.cellInfos.nodeModel?this.buildHeaderContextualMenu(e):void 0},buildContextualMenu:function(){var e=this;this.massVariantGridView.onContextualEvent=function(t){return e.contextualMenuCall(t)}},cssAdjustmentsForLayout:function(e){this.massVariantGridView.getContent(".wux-layouts-collectionview").setStyle("top","48px")},refreshColumns:function(e){var t=JSON.parse(JSON.stringify(e)),i=this.massVariantGridView.layout.getColumnVisibleFlag("Expression");this.massVariantGridView.columns=t,this.massVariantGridView.layout.setColumnVisibleFlag("Expression",i,{isUserInteraction:!0})},showGlobalEffectivityDialog:function(e,t){var i={width:481,height:212,dialogue:{header:r.Current_Variant_Effectivity+" - "+t,buttonArray:[],target:widget.body,object:null,postCloseHandler:null}},n=new a(i);n.render(),n.container.setStyle("overflow","auto"),n.container.setHTML(e)}})}),define("DS/CfgMassVariantEffectivityEditor/scripts/CfgMassVariantEditorModelsCollection",["UWA/Class/Collection","DS/CfgMassVariantEffectivityEditor/scripts/CfgMassVariantEditorModel","DS/CfgMassVariantEffectivityEditor/scripts/CfgMassVariantEditorServices","DS/CfgBaseUX/scripts/CfgXMLServices","i18n!DS/CfgMassVariantEffectivityEditor/assets/nls/CfgMassVariantEffectivityEditor"],function(e,t,i,n,o){return e.extend({model:t,attachedModels:[],selectedInstances:[],evolutionXmlsPerModel:{contextsFilterXML:[]},evolutionExpression:"",init:function(e){this._parent(e)},setEvolutionExpression:function(e){this.evolutionExpression=e,this.evolutionXmlsPerModel=n.EvolutionXMLtoJSONforFilterVariant(e)},getEvolutionExpressionFromModelName:function(e){Array.isArray(e)&&(e=e[0]);var t="";if(this.evolutionExpression)for(var i=0;i<this.evolutionXmlsPerModel.contextsFilterXML.length;i++)if(this.evolutionXmlsPerModel.contextsFilterXML[i].name==e){t=this.evolutionXmlsPerModel.contextsFilterXML[i].expression;break}return t},setSelectedInstances:function(e){evolutionXmlsPerModel=this.selectedInstances=e},setAttachedModels:function(e){this.attachedModels=e},initialiseModels:function(){for(var e=0;e<this.attachedModels.length;e++){var i=new t({id:this.attachedModels[e].physicalId,treeDocumentEffectivityGridView:null,gridViewEffectivityColumns:[],configurationContext:this.attachedModels[e],selectedInstances:this.selectedInstances});this.add(i)}},getProbesInfoDetailsWithXML:function(){let e=[],t=this.processJsonToXml("XML");for(let t=0;t<this.length;t++){let i=this.at(t),n=this.at(t).get("dictionary");null!=n&&e.push({currentModelId:i.id,currentModelFeatures:n})}return n.getProbesMassVariantCriteria(t,e)},processJsonToXml:function(e){for(var t={},n=0;n<this.length;n++){var o=this.at(n).get("gridViewEffectivityColumns");if(null!=this.at(n).get("treeDocumentEffectivityGridView"))for(var a=this.at(n).get("treeDocumentEffectivityGridView").getAllDescendants(),s=this.at(n).get("configurationContext"),r="",l=0,d=0;d<a.length;d++)if(0!=a[d].options.data.isAllowed){var c=this.at(n).getORConditionXML(o,a[d],e);if(""!=c&&l++,r+=c,null==a[d+1]||a[d].options.data.instance.instanceId!=a[d+1].options.data.instance.instanceId){l>1&&(r="<OR>"+r+"</OR>"),l=0;var u="";u="XML"==e?s.name:encodeURIComponent(s.displayName),""!=r&&(r=i.buildContext(u,r)),void 0===t[a[d].options.data.instance.instanceId]&&(t[a[d].options.data.instance.instanceId]={xmls:[],data:a[d].options.data}),t[a[d].options.data.instance.instanceId].xmls.push(r),r=""}}}var f={};for(var p in t)if(t.hasOwnProperty(p)){for(var h="",g=t[p].xmls,v=0;v<g.length;v++)h+=g[v];g.length>1&&""!=h&&(h="<MultiContextView>"+h+"</MultiContextView>"),""!=h&&(h=i.buildGlobalExpression(h)),f[p]={xml:h,data:t[p].data}}return f},initiateCurrentEffectivityXmls:function(){for(var e=this.processJsonToXml("TXT"),t=0;t<this.length;t++)if(null!=this.at(t).get("treeDocumentEffectivityGridView")){var i=this.at(t).get("treeDocumentEffectivityGridView").getAllDescendants();for(cnt=0;cnt<i.length;cnt++)i[cnt].options.data.instance.currentEffectivityXmls=e[i[cnt].options.data.instance.instanceId]}},getModifiedInstances:function(){for(var e=[],t=0;t<this.length;t++)if(null!=this.at(t).get("treeDocumentEffectivityGridView")){var i=this.at(t).get("treeDocumentEffectivityGridView").getAllDescendants();for(cnt=0;cnt<i.length;cnt++){if(1==i[cnt].options.data.isModified)-1==e.indexOf(i[cnt].options.data.instance.instanceId)&&e.push(i[cnt].options.data.instance.instanceId)}}return e},resetModifiedInstances:function(){for(var e=0;e<this.length;e++)if(null!=this.at(e).get("treeDocumentEffectivityGridView")){var t=this.at(e).get("treeDocumentEffectivityGridView").getAllDescendants();for(cnt=0;cnt<t.length;cnt++)t[cnt].options.data.isModified=!1}}})}),define("DS/CfgMassVariantEffectivityEditor/scripts/CfgMassVariantEffectivityEditorLayout",["UWA/Class/View","DS/Handlebars/Handlebars4","DS/CfgBaseUX/scripts/CfgSliderView","DS/CfgMassVariantEffectivityEditor/scripts/CfgMassVariantEffectivityEditorModelSelector","DS/CfgMassVariantEffectivityEditor/scripts/CfgMassVariantEditorDataGridView","DS/CfgMassVariantEffectivityEditor/scripts/CfgMassVariantEditorServices","DS/CfgMassVariantEffectivityEditor/scripts/CfgMassVariantEditorModelsCollection","DS/Utilities/TouchUtils","DS/CfgBaseUX/scripts/CfgUtility","DS/CfgBaseUX/scripts/CfgColumnManager","DS/CfgBaseUX/scripts/CfgUserSettings","DS/CfgBaseUX/scripts/CfgFeatureOptionsView","DS/CfgTracker/CfgTracker","DS/CfgTracker/CfgDimension","DS/CfgTracker/CfgValue","i18n!DS/CfgMassVariantEffectivityEditor/assets/nls/CfgMassVariantEffectivityEditor","css!DS/CfgMassVariantEffectivityEditor/assets/styles/CfgMassVariantEffectivityEditor.css"],function(e,t,i,n,o,a,s,r,l,d,c,u,f,p,h,g){"use strict";var v={gridView:null,featureOptionsView:null,sliderView:null,collection:null,render:function(e){r.setTouchMode(!1),this.options=e,a.isReadOnlyMode=!1,!0===a.isKarmaOdtMode()&&(a.isReadOnlyMode=!1),c.retrieveUserSettings(),this.collection=new s;var t=a.processAttachedModels(e.attachedModels);return this.collection.setAttachedModels(t),this.collection.setSelectedInstances(e.selectedInstances),this.collection.setEvolutionExpression(e.evolutionExpression),this.collection.initialiseModels(),this.buildSelector(),this.buildSlider(),a.getFilterablesVariantGrid(t[0].physicalId,e.selectedInstances).then(function(i){var n=v.collection.at(0);n.createColumns(i),n.createTreeDocument(i),v.initialiseGridView(),v.sliderView.clearRightLayout(),v.sliderView.disableRightLayout(),a.loadDictionary(n,v.collection,v.onLoadDictionaryComplete),1==t.length?v.collection.initiateCurrentEffectivityXmls():v.loadNextModelsEffectivitiesAsyncronously(t,e)},function(e){console.log(e),l.isDefined(e)&&l.isDefined(e.errorMessage)&&l.showwarning(e.errorMessage,"error"),v.sliderView.clearLeftLayout(),v.sliderView.clearRightLayout(),v.sliderView.disablePrimaryButtons()}),v},loadNextModelsEffectivitiesAsyncronously:function(e,t){for(var i=[],n=1;n<e.length;n++)i.push(a.getFilterablesVariantGrid(e[n].physicalId,t.selectedInstances));Promise.all(i).then(function(e){for(var t=0;t<e.length;t++)if(null!=e[t].criterias){var i=e[t].criterias.modelPID,n=v.collection.get(i);n.createColumns(e[t]),n.createTreeDocument(e[t])}v.collection.initiateCurrentEffectivityXmls()})},initialiseGridView:function(){this.buildGridView()},onLoadDictionaryComplete:function(e){v.buildfeatureOptionView(e);var t=v.collection.get(e);v.featureOptionsView.selectColumns(t.get("gridViewEffectivityColumns")),v.modelSelector.enable()},showColumnManager:function(e){var t={type:"VariantsAndOptionGroups",viewId:e.viewId,parent:v.sliderView._rightPanel.getElement(".gridViewContainer"),onCloseCallback:v.onColumnManagerComplete,touchMode:!0};d.create(t)},onToolbarClickCallback:function(e){if("ID_USERSETTINGS"==e._event){var t={};t.viewId=e.viewId,v.showColumnManager(t)}},onColumnManagerComplete:function(e){"SAVE"==e._event&&v.featureOptionsView.updateColumnsFromSettings(),v.buildfeatureOptionView(v.currentSelectedModelId)},buildfeatureOptionView:function(e){var t=this.collection.get(e),i={treeDocument:t.get("treeDocumentVariantView"),onFeatureOptionSelectionChange:this.onFeatureOptionSelectionChange,features:t.get("dictionary"),onToolbarClickCallback:v.onToolbarClickCallback};this.featureOptionsView=new u(i),this.featureOptionsView.render(),this.featureOptionsView.setColumnRemoveWarningToShow(!0),this.sliderView.clearRightLayout(),this.sliderView.setRightView(this.featureOptionsView.featureOptionGridView,this.featureOptionsView.toolbar);var n=r.getTouchMode();0==a.isReadOnlyMode&&this.featureOptionsView.cssAdjustmentsForLayout(n)},onFeatureOptionSelectionChange:function(e,t){v.gridView.toolbar.isCopyOperationPerformed="NO",v.gridView.toolbar.currentModel.set("copiedInstances",[]),v.gridView.options.treeDocument.unselectAll();var i=v.collection.get(v.modelSelector._wuxComboBox.currentValue.physicalId);0==t?i.addEffectivityGridViewColumn(e):i.removeEffectivityGridViewColumn(e),v.refreshDataGridView(v.modelSelector._wuxComboBox.currentValue.physicalId)},refreshDataGridView:function(e){var t=null;t=void 0===e?this.collection.at(0):this.collection.get(e),this.gridView.refreshColumns(t.get("gridViewEffectivityColumns"))},buildSlider:function(){var e=!0;1==a.isReadOnlyMode&&(e=!1);var t={isReadOnlyMode:a.isReadOnlyMode,position:"fixed",gridpadding:"0px",leftHeader:g.GridHeader,rightHeader:g.DictionaryHeader,Apply:g.ApplyAndClose,Verify:g.Apply,Cancel:g.Cancel,Touch:g.Touch,onButtonClickCB:this.onButtonClickCB,isRightFooter:!1,isLeftFooter:e,headerControl:this.modelSelector._wuxComboBox,headerText:this.modelSelector._text};null!=this.options.WorkUnderDetails&&this.options.WorkUnderDetails.length>0&&delete t.Verify,this.sliderView=new i(t).render()},buildSelector:function(){var e={onChangeCB:this.onHeaderControlChangeCB,data:this.collection.attachedModels};this.modelSelector=new n(e),this.modelSelector.render(),this.modelSelector.disable()},buildGridView:function(e){var t=null;t=void 0===e?this.collection.at(0):this.collection.get(e),v.currentSelectedModelId=t.id;var i={treeDocument:t.get("treeDocumentEffectivityGridView"),columns:t.get("gridViewEffectivityColumns"),context:t.get("configurationContext"),initialEffectivitiesOfInstances:t.get("initialEffectivitiesOfInstances")};this.gridView=new o(i),this.gridView.render(),this.sliderView.clearLeftLayout(),this.sliderView.setLeftView(this.gridView.massVariantGridView,this.gridView.toolbar),null!=this.gridView.toolbar&&(this.gridView.toolbar.currentModel=t);var n=r.getTouchMode();1==a.isReadOnlyMode?this.modelSelector.enable():this.gridView.cssAdjustmentsForLayout(n)},onHeaderControlChangeCB:function(e){v.refreshView(e.physicalId)},refreshView:function(e){var t=v.collection.get(e);(a.loadDictionary(t,v.collection,v.onLoadDictionaryComplete),null==t.get("treeDocumentEffectivityGridView"))?(v.modelSelector.disable(),a.getFilterablesVariantGrid(e,v.options.selectedInstances).then(function(t){var i=v.collection.get(e);i.createColumns(t),i.createTreeDocument(t),v.buildGridView(e),v.modelSelector.enable()})):(v.buildGridView(e),v.modelSelector.enable())},sendEditVariantTrackerEvent:function(e){let t="",i="",n=e.noOfContext,o=e.noOfReference,a=e.totalVariantLength,s=e.totalVariantValueLength,r=e.totalOptionGroupLength,l=e.totalOptionLength,d=e.totalNotOperatorLength,c=e.variantComplexity,u=e.totalFeaturesLength,g=e.totalFeatureOptionsLength;"Native"==e.mode?(t="Native",i="Web In Win"):(t=widget.data.appId,i=null!=widget.options?widget.options.title:"ODT Environment");let v=f.getDeviceUsedForOperation(),C=f.ConfigOperationMode.CREATE;"Edit"==e.variantMode&&(C=f.ConfigOperationMode.EDIT);let y=f.AuthoringMode.EMPTY;"Empty"!=e.authoringMode&&(y=f.AuthoringMode[e.authoringMode]);let m=f.EditVariantMode.MULTIPLE;f.createEventBuilder({category:f.Category.USAGE,action:f.Events.CLICK,tenant:enoviaServerFilterWidget.tenant}).setLabel(f.Labels.EDIT_VARIANT_EFFECTIVITY).setAppId(t).addDimension(p.EDIT_VARIANT_EFFECTIVITY.EDIT_VARIANT_EFFECTIVITY_WIDGET,i).addDimension(p.EDIT_VARIANT_EFFECTIVITY.EDIT_VARIANT_EFFECTIVITY_MEDIA,v).addDimension(p.EDIT_VARIANT_EFFECTIVITY.EDIT_VARIANT_EFFECTIVITY_MODE,C).addDimension(p.EDIT_VARIANT_EFFECTIVITY.EDIT_VARIANT_AUTHORING_MODE,y).addDimension(p.EDIT_VARIANT_EFFECTIVITY.EDIT_VARIANT_EFFECTIVITY_TYPE_MODE,m).addPersonalValue(h.EDIT_VARIANT_EFFECTIVITY.EDIT_VARIANT_NO_OF_MODEL,n).addPersonalValue(h.EDIT_VARIANT_EFFECTIVITY.EDIT_VARIANT_REFERENCE_SELECTED,o).addPersonalValue(h.EDIT_VARIANT_EFFECTIVITY.EDIT_VARIANT_TOTAL_NO_VARIANT,a).addPersonalValue(h.EDIT_VARIANT_EFFECTIVITY.EDIT_VARIANT_TOTAL_NO_VARIANT_VALUE,s).addPersonalValue(h.EDIT_VARIANT_EFFECTIVITY.EDIT_VARIANT_TOTAL_NO_OPTION_GROUP,r).addPersonalValue(h.EDIT_VARIANT_EFFECTIVITY.EDIT_VARIANT_TOTAL_NO_OPTION,l).addPersonalValue(h.EDIT_VARIANT_EFFECTIVITY.EDIT_VARIANT_TOTAL_NO_NOT_OPERATOR,d).addPersonalValue(h.EDIT_VARIANT_EFFECTIVITY.EDIT_VARIANT_COMPLEXITY,c).addPersonalValue(h.EDIT_VARIANT_EFFECTIVITY.EDIT_VARIANT_DICTIONARY_FEATURES,u).addPersonalValue(h.EDIT_VARIANT_EFFECTIVITY.EDIT_VARIANT_DICTIONARY_FEATURE_OPTIONS,g).send()},callEditVariantTrackerEvent:function(e){let t={noOfContext:v.collection.length,mode:"Dashboard"};"Native"==e.mode&&(t.mode="Native"),t.variantMode="Create",e.modifiedInstances.length>0&&(t.variantMode="Edit"),t.authoringMode="Empty",v.options.WorkUnderDetails.length>0&&("DS-Change-Authoring-Context"==v.options.WorkUnderDetails[0].key?t.authoringMode="CHANGE":"DS-Configuration-Authoring-Context"==v.options.WorkUnderDetails[0].key&&(t.authoringMode="EVOLUTION")),t.noOfReference=v.options.selectedInstances.length;let i=v.collection.getProbesInfoDetailsWithXML();t.totalVariantLength=i.totalVariantLength,t.totalVariantValueLength=i.totalVariantValueLength,t.totalOptionGroupLength=i.totalOptionGroupLength,t.totalOptionLength=i.totalOptionLength,t.totalNotOperatorLength=i.totalNotOperatorLength,t.variantComplexity=i.variantComplexity,t.totalFeaturesLength=i.totalFeaturesLength,t.totalFeatureOptionsLength=i.totalFeatureOptionsLength,v.sendEditVariantTrackerEvent(t)},onButtonClickCB:function(e){var t={};if("leftVerify"==e.buttonId||"leftApply"==e.buttonId){null!=v.gridView.toolbar&&(v.gridView.toolbar.isCopyOperationPerformed="NO",v.gridView.toolbar.currentModel.set("copiedInstances",[]),v.gridView.options.treeDocument.unselectAll()),t=v.collection.processJsonToXml("XML");var i=v.collection.getModifiedInstances();v.sliderView.disableRightLayout(),v.sliderView.disableLeftLayout(),"leftVerify"==e.buttonId?a.setEffectivity(t,i,v.enableLayout,v.options.PADContext,v.collection):a.setEffectivity(t,i,v.destroyLayout,v.options.PADContext,v.collection),v.callEditVariantTrackerEvent({mode:"Dashboard",modifiedInstances:i})}else if("touch"==e.buttonId){var n=r.getTouchMode();r.setTouchMode(!n),v.gridView.cssAdjustmentsForLayout(!n),0==a.isReadOnlyMode&&v.featureOptionsView.cssAdjustmentsForLayout(!n)}},destroyLayout:function(){v.sliderView.destroyLayout()},enableLayout:function(){v.sliderView.enableButtons()}};return v});