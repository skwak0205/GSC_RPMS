var ThreeDS,DSMath,cgmMath;define("DS/MathematicsES/MathConstantsJS",function(){"use strict";var t={};return Object.defineProperty(t,"PI",{value:Math.PI,writable:!1,enumerable:!0,configurable:!1}),Object.defineProperty(t,"PI2",{value:2*Math.PI,writable:!1,enumerable:!0,configurable:!1}),Object.defineProperty(t,"PI3",{value:3*Math.PI,writable:!1,enumerable:!0,configurable:!1}),Object.defineProperty(t,"PIBY2",{value:Math.PI/2,writable:!1,enumerable:!0,configurable:!1}),Object.defineProperty(t,"PI3BY2",{value:3*Math.PI/2,writable:!1,enumerable:!0,configurable:!1}),Object.defineProperty(t,"PIBY4",{value:Math.PI/4,writable:!1,enumerable:!0,configurable:!1}),Object.defineProperty(t,"PI3BY4",{value:3*Math.PI/4,writable:!1,enumerable:!0,configurable:!1}),Object.defineProperty(t,"INV_PI",{value:1/Math.PI,writable:!1,enumerable:!0,configurable:!1}),Object.defineProperty(t,"INV_PI2",{value:1/(2*Math.PI),writable:!1,enumerable:!0,configurable:!1}),Object.defineProperty(t,"SQRT2",{value:Math.SQRT2,writable:!1,enumerable:!0,configurable:!1}),Object.defineProperty(t,"INV_SQRT2",{value:Math.SQRT1_2,writable:!1,enumerable:!0,configurable:!1}),Object.defineProperty(t,"SQRT3",{value:1.7320508075688772,writable:!1,enumerable:!0,configurable:!1}),Object.defineProperty(t,"INV_SQRT3",{value:.5773502691896257,writable:!1,enumerable:!0,configurable:!1}),Object.defineProperty(t,"RAD_TO_DEG",{value:180/Math.PI,writable:!1,enumerable:!0,configurable:!1}),Object.defineProperty(t,"DEG_TO_RAD",{value:Math.PI/180,writable:!1,enumerable:!0,configurable:!1}),Object.defineProperty(t,"INVPI",{value:t.INV_PI,writable:!1,enumerable:!0,configurable:!1}),Object.defineProperty(t,"INV2PI",{value:t.INV_PI2,writable:!1,enumerable:!0,configurable:!1}),Object.defineProperty(t,"INVSQRT2",{value:t.INV_SQRT2,writable:!1,enumerable:!0,configurable:!1}),Object.defineProperty(t,"INVSQRT3",{value:t.INV_SQRT3,writable:!1,enumerable:!0,configurable:!1}),Object.defineProperty(t,"RadToDeg",{value:t.RAD_TO_DEG,writable:!1,enumerable:!0,configurable:!1}),Object.defineProperty(t,"DegToRad",{value:t.DEG_TO_RAD,writable:!1,enumerable:!0,configurable:!1}),t}),define("MathematicsES/MathConstantsJS",["DS/MathematicsES/MathConstantsJS"],function(t){return t}),define("DS/MathematicsES/MathMigration",function(){return new function(){this.deprecateModule=function(t){}}}),define("DS/MathematicsES/MathTolerancesJS",function(){"use strict";var t=function(){Object.defineProperty(this,"scale",{value:1,writable:!1,enumerable:!0,configurable:!1}),Object.defineProperty(this,"epsgForAngleTest",{value:1e-12,writable:!1,enumerable:!0,configurable:!1}),Object.defineProperty(this,"epsgForSquareAngleTest",{value:this.epsgForAngleTest*this.epsgForAngleTest,writable:!1,enumerable:!0,configurable:!1}),Object.defineProperty(this,"epsgForSqrtAngleTest",{value:Math.sqrt(this.epsgForAngleTest),writable:!1,enumerable:!0,configurable:!1}),Object.defineProperty(this,"epsilonForAngleTest",{value:1e-15,writable:!1,enumerable:!0,configurable:!1}),Object.defineProperty(this,"epsilonForSquareAngleTest",{value:this.epsilonForAngleTest*this.epsilonForAngleTest,writable:!1,enumerable:!0,configurable:!1}),Object.defineProperty(this,"epsilonForSqrtAngleTest",{value:Math.sqrt(this.epsilonForAngleTest),writable:!1,enumerable:!0,configurable:!1}),Object.defineProperty(this,"epsgForRelativeTest",{value:1e-12,writable:!1,enumerable:!0,configurable:!1}),Object.defineProperty(this,"epsgForSquareRelativeTest",{value:this.epsgForRelativeTest*this.epsgForRelativeTest,writable:!1,enumerable:!0,configurable:!1}),Object.defineProperty(this,"epsgForSqrtRelativeTest",{value:Math.sqrt(this.epsgForRelativeTest),writable:!1,enumerable:!0,configurable:!1}),Object.defineProperty(this,"epsilonForRelativeTest",{value:1e-15,writable:!1,enumerable:!0,configurable:!1}),Object.defineProperty(this,"epsilonForSquareRelativeTest",{value:this.epsilonForRelativeTest*this.epsilonForRelativeTest,writable:!1,enumerable:!0,configurable:!1}),Object.defineProperty(this,"epsilonForSqrtRelativeTest",{value:Math.sqrt(this.epsilonForRelativeTest),writable:!1,enumerable:!0,configurable:!1}),Object.defineProperty(this,"epsgForLengthTest",{value:1e-12*this.scale,writable:!1,enumerable:!0,configurable:!1}),Object.defineProperty(this,"epsgForSquareLengthTest",{value:this.epsgForLengthTest*this.epsgForLengthTest,writable:!1,enumerable:!0,configurable:!1}),Object.defineProperty(this,"epsgForSqrtLengthTest",{value:Math.sqrt(this.epsgForLengthTest),writable:!1,enumerable:!0,configurable:!1}),Object.defineProperty(this,"epsilonForLengthTest",{value:1e-15*this.scale,writable:!1,enumerable:!0,configurable:!1}),Object.defineProperty(this,"epsilonForSquareLengthTest",{value:this.epsilonForLengthTest*this.epsilonForLengthTest,writable:!1,enumerable:!0,configurable:!1}),Object.defineProperty(this,"epsilonForSqrtLengthTest",{value:Math.sqrt(this.epsilonForLengthTest),writable:!1,enumerable:!0,configurable:!1})},e=new t;return Object.defineProperty(t,"defaultTolerances",{value:e,writable:!1,enumerable:!0,configurable:!1}),t}),define("MathematicsES/MathTolerancesJS",["DS/MathematicsES/MathTolerancesJS"],function(t){return t}),define("DS/MathematicsES/MathNameSpace",["DS/MathematicsES/MathTolerancesJS","DS/MathematicsES/MathConstantsJS"],function(t,e){"use strict";return(ThreeDS=ThreeDS||{}).Mathematics={},DSMath=ThreeDS.Mathematics,cgmMath=DSMath,Object.defineProperty(DSMath,"defaultTolerances",{value:t.defaultTolerances,writable:!1,enumerable:!0,configurable:!1}),Object.defineProperty(DSMath,"constants",{value:e,writable:!1,enumerable:!0,configurable:!1}),DSMath}),define("MathematicsES/MathNameSpace",["DS/MathematicsES/MathNameSpace"],function(t){return t}),define("DS/MathematicsES/MathTypeCheck",["DS/MathematicsES/MathNameSpace"],function(t){"use strict";var e=function(t,r,n,o){return e.prototype.Eval(t,r,n,o)};return e.prototype.NoTypeCheck=function(t,e,r,n){},e.prototype.DoTypeCheck=function(t,r,n,o){var i=e.prototype.TypeCheckPrivate(t,r,!0,n,o);return!1===i?(e.prototype.PrintKO(!0,"TypeCheck is KO --\x3e throw error"),e.prototype.ThrowError()):e.prototype.PrintOK("TypeCheck is OK"),i},e.prototype.Eval=e.prototype.NoTypeCheck,e.prototype.Activate=function(){e.prototype.Eval=e.prototype.DoTypeCheck},e.prototype.Deactivate=function(){e.prototype.Eval=e.prototype.NoTypeCheck},e.prototype.LogInf=!1,e.prototype.LogErr=!0,e.prototype._DEPTH=-1,e.prototype.ThrowError=function(){e.prototype.PrintKO(!0,"  --\x3e TypeCheck.ThrowError!")},e.prototype.SingleTypeCheck=function(t,r){return isNaN(t)?t instanceof Array?(e.prototype.PrintKO(!0,"SingleTypeCheck: has an array as input"),!1):t.constructor===r:"number"===r||r===Boolean},e.prototype.TypeCheckPrivate=function(t,r,n,o,i){e.prototype._DEPTH++;var s=e.prototype.DoTypeCheckPrivate(t,r,n,o,i);return e.prototype._DEPTH--,s},e.prototype.DoTypeCheckPrivate=function(t,r,n,o,i){if(null==t)return!0===r?(e.prototype.PrintKO(n,"DoTypeCheck("+e.prototype._DEPTH+"): mandatory argument is null / undefined"),!1):(e.prototype.PrintOK("DoTypeCheck("+e.prototype._DEPTH+"): undefined / null argument is OK"),!0);if(o instanceof Array){var s;if(void 0===i){s=!1;for(var a=0;a<o.length&&!1===s;a++)s=e.prototype.TypeCheckPrivate(t,!0,!1,o[a])}else if(t instanceof Array)if(s=!0,i instanceof Array)if(0===i.length)if(0===o.length)s=!0;else{s=!0;for(a=0;a<t.length&&!0===s;a++)s=e.prototype.TypeCheckPrivate(t[a],!0,!0,o)}else{s=!0;for(a=0;a<i.length&&!0===s;a++)s=e.prototype.TypeCheckPrivate(t[a],!0,!0,i[a])}else if(isNaN(i))s=!1;else for(var c=0;c<i&&!0===s;c++)s=e.prototype.TypeCheckPrivate(t[c],!0,!0,o);else s=!1;return!1===s?(e.prototype.PrintKO(n,"DoTypeCheck("+e.prototype._DEPTH+"): expected array types are KO"),!1):(e.prototype.PrintOK("DoTypeCheck("+e.prototype._DEPTH+"): expected array types are OK"),!0)}return!1===e.prototype.SingleTypeCheck(t,o)?(e.prototype.PrintKO(n,"DoTypeCheck("+e.prototype._DEPTH+"): expected type does not match actual type"),!1):(e.prototype.PrintOK("DoTypeCheck("+e.prototype._DEPTH+"): expected type is OK"),!0)},e.prototype.PrintKO=function(t,r){!0===e.prototype.LogErr&&t&&console.error(r)},e.prototype.PrintOK=function(t){!0!==e.prototype.LogInf||console.log(t)},t.TypeCheck=e,e}),define("MathematicsES/MathTypeCheck",["DS/MathematicsES/MathTypeCheck"],function(t){return t}),define("DS/MathematicsES/MathTypeCheckInternal",["DS/MathematicsES/MathNameSpace","DS/MathematicsES/MathTypeCheck"],function(t){"use strict";var e=function(t,r,n,o){return e.prototype.Eval(t,r,n,o)};return e.prototype.NoTypeCheck=function(t,e,r,n){return!0},e.prototype.DoTypeCheck=function(e,r,n,o){return t.DoTypeCheck(e,r,n,o)},e.prototype.Eval=e.prototype.NoTypeCheck,e.prototype.Activate=function(){e.prototype.Eval=e.prototype.DoTypeCheck},e.prototype.Deactivate=function(){e.prototype.Eval=e.prototype.NoTypeCheck},t.TypeCheckInternal=e,e}),define("MathematicsES/MathTypeCheckInternal",["DS/MathematicsES/MathTypeCheckInternal"],function(t){return t}),define("DS/MathematicsES/MathVector3DJSImpl",["DS/MathematicsES/MathNameSpace","DS/MathematicsES/MathTypeCheck","DS/MathematicsES/MathTypeCheckInternal"],function(t,e,r){"use strict";var n=function(e,r,n){t.TypeCheck(e,!1,"number"),t.TypeCheck(r,!1,"number"),t.TypeCheck(n,!1,"number"),this.x=e||0,this.y=r||0,this.z=n||0};return n.prototype.x=null,n.prototype.y=null,n.prototype.z=null,n.prototype.constructor=n,n.prototype.clone=function(){return new n(this.x,this.y,this.z)},n.prototype.copy=function(e){return t.TypeCheck(e,!0,t.Vector3D),this.x=e.x,this.y=e.y,this.z=e.z,this},n.prototype.set=function(e,r,n){return t.TypeCheck(e,!0,"number"),t.TypeCheck(r,!0,"number"),t.TypeCheck(n,!0,"number"),this.x=e,this.y=r,this.z=n,this},n.prototype.setFromArray=function(e){return t.TypeCheck(e,!0,["number"],3),this.x=e[0],this.y=e[1],this.z=e[2],this},n.prototype.setFromPoint=function(e){return t.TypeCheck(e,!0,t.Point),this.x=e.x,this.y=e.y,this.z=e.z,this},n.prototype.setX=function(e){return t.TypeCheck(e,!0,"number"),this.x=e,this},n.prototype.setY=function(e){return t.TypeCheck(e,!0,"number"),this.y=e,this},n.prototype.setZ=function(e){return t.TypeCheck(e,!0,"number"),this.z=e,this},n.prototype.getArray=function(e){return t.TypeCheck(e,!1,["number"],3),(e=e||new Array(3))[0]=this.x,e[1]=this.y,e[2]=this.z,e},n.prototype.squareNorm=function(){return this.x*this.x+this.y*this.y+this.z*this.z},n.prototype.norm=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},n.prototype.normalize=function(){var e=t.defaultTolerances.epsilonForRelativeTest,r=this.x*this.x+this.y*this.y+this.z*this.z,n=Math.abs(r-1)<=2*e?1:1/Math.sqrt(r);return this.x*=n,this.y*=n,this.z*=n,this},n.prototype.negate=function(){return this.x*=-1,this.y*=-1,this.z*=-1,this},n.prototype.add=function(e){return t.TypeCheck(e,!0,t.Vector3D),this.x+=e.x,this.y+=e.y,this.z+=e.z,this},n.prototype.addScaledVector=function(e,r){return t.TypeCheck(e,!0,t.Vector3D),t.TypeCheck(r,!0,"number"),this.x+=r*e.x,this.y+=r*e.y,this.z+=r*e.z,this},n.prototype.addScalar=function(e){return t.TypeCheck(e,!0,"number"),this.x+=e,this.y+=e,this.z+=e,this},n.prototype.sub=function(e){return t.TypeCheck(e,!0,t.Vector3D),this.x-=e.x,this.y-=e.y,this.z-=e.z,this},n.prototype.subScaledVector=function(e,r){return t.TypeCheck(e,!0,t.Vector3D),t.TypeCheck(r,!0,"number"),this.x-=r*e.x,this.y-=r*e.y,this.z-=r*e.z,this},n.prototype.subScalar=function(e){return t.TypeCheck(e,!0,"number"),this.x-=e,this.y-=e,this.z-=e,this},n.prototype.multiplyScalar=function(e){return t.TypeCheck(e,!0,"number"),this.x*=e,this.y*=e,this.z*=e,this},n.prototype.divideScalar=function(e){return t.TypeCheck(e,!0,"number"),this.x/=e,this.y/=e,this.z/=e,this},n.prototype.cross=function(e){t.TypeCheck(e,!0,t.Vector3D);var r=this.y,n=this.x,o=this.z;return this.x=r*e.z-o*e.y,this.y=o*e.x-n*e.z,this.z=n*e.y-r*e.x,this},n.prototype.dot=function(e){return t.TypeCheck(e,!0,t.Vector3D),this.x*e.x+this.y*e.y+this.z*e.z},n.prototype.isOrthogonal=function(e){t.TypeCheck(e,!0,t.Vector3D);var r=this.squareNorm(),n=e.squareNorm(),o=t.defaultTolerances.epsilonForSquareAngleTest,i=this.dot(e);return i*=i,r<=o*Math.max(1,n)||n<=o*Math.max(1,r)||i<=r*n*o},n.prototype.isParallel=function(e){t.TypeCheck(e,!0,t.Vector3D);var r=this.squareNorm(),n=e.squareNorm(),o=t.defaultTolerances.epsilonForSquareAngleTest,i=1-o,s=this.dot(e);return s*=s,r<=o*Math.max(1,n)||n<=o*Math.max(1,r)||s>=r*n*i},n.prototype.orthoComponents=function(e){t.TypeCheck(e,!0,t.Vector3D);var r=n.project(this,e);return[r,n.sub(this,r)]},n.prototype.project=function(e){t.TypeCheck(e,!0,t.Vector3D);var r=e.squareNorm(),n=this.dot(e)/r;return this.copy(e),this.multiplyScalar(n),this},n.prototype.projectOrthogonal=function(e){t.TypeCheck(e,!0,t.Vector3D);var r=e.squareNorm(),n=this.dot(e)/r;return this.subScaledVector(e,n),this},n.prototype.projectOnPlane=function(e){t.TypeCheck(e,!0,t.Plane);var r=e.getDirectionsNotCloned(),n=this.dot(r[0]),o=this.dot(r[1]);return this.x=n*r[0].x+o*r[1].x,this.y=n*r[0].y+o*r[1].y,this.z=n*r[0].z+o*r[1].z,this},n.prototype.projectOnPlaneFromVectors=function(e,r){t.TypeCheck(e,!0,t.Vector3D),t.TypeCheck(r,!0,t.Vector3D),e.isOrthogonal(r)&&e.isNormalized()&&r.isNormalized()||(e=e.clone(),r=r.clone(),n.orthoNormalize(e,r));var o=this.dot(e),i=this.dot(r);return this.x=o*e.x+i*r.x,this.y=o*e.y+i*r.y,this.z=o*e.z+i*r.z,this},n.prototype.isEqual=function(e,r){t.TypeCheck(e,!0,t.Vector3D),t.TypeCheck(r,!1,"number");return arguments.length<2?this.x==e.x&&this.y==e.y&&this.z==e.z:!(Math.abs(this.x-e.x)>r||Math.abs(this.y-e.y)>r||Math.abs(this.z-e.z)>r)},n.prototype.isNormalized=function(){var e=t.defaultTolerances.epsilonForRelativeTest,r=this.squareNorm();return Math.abs(r-1)<=2*e},n.prototype.lerp=function(e,r){return t.TypeCheck(e,!0,t.Vector3D),t.TypeCheck(r,!0,"number"),this.x+=r*(e.x-this.x),this.y+=r*(e.y-this.y),this.z+=r*(e.z-this.z),this},n.prototype.getAngleTo=function(e){t.TypeCheck(e,!0,t.Vector3D);var r=0,o=this.squareNorm(),i=e.squareNorm();if(0!=o&&0!=i){var s=this.dot(e),a=n.cross(this,e).norm();r=Math.atan2(a,s)}return r},n.prototype.getSignedAngleTo=function(e,r){t.TypeCheck(e,!0,t.Vector3D),t.TypeCheck(r,!0,t.Vector3D);var o=0,i=this.squareNorm(),s=e.squareNorm();if(0!=i&&0!=s){var a=n.cross(this,e),c=a.dot(r),h=Math.sign(c),p=this.dot(e),l=a.norm();o=Math.atan2(h*l,p)}return o},n.prototype.clamp=function(e,r){return t.TypeCheck(e,!0,t.Vector3D),t.TypeCheck(r,!0,t.Vector3D),this.x=this.x<e.x?e.x:this.x>r.x?r.x:this.x,this.y=this.y<e.y?e.y:this.y>r.y?r.y:this.y,this.z=this.z<e.z?e.z:this.z>r.z?r.z:this.z,this},n.prototype.clampScalar=function(e,r){return t.TypeCheck(e,!0,"number"),t.TypeCheck(r,!0,"number"),this.x=this.x<e?e:this.x>r?r:this.x,this.y=this.y<e?e:this.y>r?r:this.y,this.z=this.z<e?e:this.z>r?r:this.z,this},n.prototype.applyMatrix3x3=function(e){t.TypeCheck(e,!0,t.Matrix3x3);var r=e.coef,n=this.x,o=this.y,i=this.z;return this.x=r[0]*n+r[1]*o+r[2]*i,this.y=r[3]*n+r[4]*o+r[5]*i,this.z=r[6]*n+r[7]*o+r[8]*i,this},n.prototype.applyTransformation=function(e){return t.TypeCheck(e,!0,t.Transformation),this.applyMatrix3x3(e.matrix),this},n.prototype.applyQuaternion=function(e){t.TypeCheck(e,!0,t.Quaternion);var r=e.squareNorm(),n=this.x,o=this.y,i=this.z,s=e.x,a=e.y,c=e.z,h=e.s,p=-s*n-a*o-c*i,l=h*n+a*i-c*o,u=h*o+c*n-s*i,y=h*i+s*o-a*n;return this.x=(l*h+p*-s+u*-c-y*-a)/r,this.y=(u*h+p*-a+y*-s-l*-c)/r,this.z=(y*h+p*-c+l*-a-u*-s)/r,this},Object.defineProperty(n,"xVect",{value:new n(1,0,0),writable:!1,enumerable:!0,configurable:!1}),Object.freeze(n.xVect),Object.defineProperty(n,"yVect",{value:new n(0,1,0),writable:!1,enumerable:!0,configurable:!1}),Object.freeze(n.yVect),Object.defineProperty(n,"zVect",{value:new n(0,0,1),writable:!1,enumerable:!0,configurable:!1}),Object.freeze(n.zVect),n.normalize=function(e,r){return t.TypeCheck(e,!0,t.Vector3D),t.TypeCheck(r,!1,t.Vector3D),(r=r?r.copy(e):e.clone()).normalize()},n.add=function(e,r,o){return t.TypeCheck(e,!0,t.Vector3D),t.TypeCheck(r,!0,t.Vector3D),t.TypeCheck(o,!1,t.Vector3D),(o=o||new n).x=e.x+r.x,o.y=e.y+r.y,o.z=e.z+r.z,o},n.sub=function(e,r,o){return t.TypeCheck(e,!0,t.Vector3D),t.TypeCheck(r,!0,t.Vector3D),t.TypeCheck(o,!1,t.Vector3D),(o=o||new n).x=e.x-r.x,o.y=e.y-r.y,o.z=e.z-r.z,o},n.negate=function(e,r){return t.TypeCheck(e,!0,t.Vector3D),t.TypeCheck(r,!1,t.Vector3D),(r=r?r.copy(e):e.clone()).negate()},n.multiplyScalar=function(e,r,n){return t.TypeCheck(e,!0,t.Vector3D),t.TypeCheck(r,!0,"number"),t.TypeCheck(n,!1,t.Vector3D),(n=n?n.copy(e):e.clone()).multiplyScalar(r)},n.divideScalar=function(e,r,n){return t.TypeCheck(e,!0,t.Vector3D),t.TypeCheck(r,!0,"number"),t.TypeCheck(n,!1,t.Vector3D),(n=n?n.copy(e):e.clone()).divideScalar(r)},n.project=function(e,r,o){t.TypeCheck(e,!0,t.Vector3D),t.TypeCheck(r,!0,t.Vector3D),t.TypeCheck(o,!1,t.Vector3D),o=o||new n;var i=r.squareNorm(),s=e.dot(r)/i;return o.copy(r).multiplyScalar(s)},n.cross=function(e,r,o){t.TypeCheck(e,!0,t.Vector3D),t.TypeCheck(r,!0,t.Vector3D),t.TypeCheck(o,!1,t.Vector3D),o=o||new n;var i=e.x,s=e.y,a=e.z,c=r.x,h=r.y,p=r.z;return o.x=s*p-a*h,o.y=a*c-i*p,o.z=i*h-s*c,o},n.lerp=function(e,r,o,i){return t.TypeCheck(e,!0,t.Vector3D),t.TypeCheck(r,!0,t.Vector3D),t.TypeCheck(o,!0,"number"),t.TypeCheck(i,!1,t.Vector3D),(i=i||new n).x=e.x+o*(r.x-e.x),i.y=e.y+o*(r.y-e.y),i.z=e.z+o*(r.z-e.z),i},n.orthoNormalize=function(e,r,o){if(t.TypeCheck(e,!0,t.Vector3D),t.TypeCheck(r,!0,t.Vector3D),t.TypeCheck(o,!1,t.Vector3D),e.isParallel(r)?(e.normalize(),e.x>t.defaultTolerances.epsilonForRelativeTest?r.set(-e.y,e.x,0):r.set(1,0,0),r.normalize()):(e.normalize(),r.projectOrthogonal(e),r.normalize()),o){var i=n.cross(e,r),s=i.dot(o);o.copy(i),s<-t.defaultTolerances.epsilonForRelativeTest&&o.multiplyScalar(-1)}},t.Vector3D=n,n}),define("MathematicsES/MathVector3DJSImpl",["DS/MathematicsES/MathVector3DJSImpl"],function(t){return t}),define("DS/MathematicsES/MathVector2DJSImpl",["DS/MathematicsES/MathNameSpace","DS/MathematicsES/MathTypeCheck","DS/MathematicsES/MathTypeCheckInternal"],function(t,e,r){"use strict";var n=function(e,r){t.TypeCheck(e,!1,"number"),t.TypeCheck(r,!1,"number"),this.x=e||0,this.y=r||0};return n.prototype.x=null,n.prototype.y=null,n.prototype.constructor=n,n.prototype.clone=function(){return new n(this.x,this.y)},n.prototype.copy=function(e){return t.TypeCheck(e,!0,t.Vector2D),this.x=e.x,this.y=e.y,this},n.prototype.set=function(e,r){return t.TypeCheck(e,!0,"number"),t.TypeCheck(r,!0,"number"),this.x=e,this.y=r,this},n.prototype.setX=function(e){return t.TypeCheck(e,!0,"number"),this.x=e,this},n.prototype.setY=function(e){return t.TypeCheck(e,!0,"number"),this.y=e,this},n.prototype.setFromArray=function(e){return t.TypeCheck(e,!0,["number"],2),this.x=e[0],this.y=e[1],this},n.prototype.setFromPoint=function(e){return t.TypeCheck(e,!0,t.Point2D),this.x=e.x,this.y=e.y,this},n.prototype.getArray=function(e){return t.TypeCheck(e,!1,["number"],2),(e=e||new Array(2))[0]=this.x,e[1]=this.y,e},n.prototype.squareNorm=function(){return this.x*this.x+this.y*this.y},n.prototype.norm=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},n.prototype.normalize=function(){var e=t.defaultTolerances.epsilonForRelativeTest,r=this.x*this.x+this.y*this.y,n=Math.abs(r-1)<=2*e?1:1/Math.sqrt(r);return this.x*=n,this.y*=n,this},n.prototype.negate=function(){return this.x*=-1,this.y*=-1,this},n.prototype.add=function(e){return t.TypeCheck(e,!0,t.Vector2D),this.x+=e.x,this.y+=e.y,this},n.prototype.addScaledVector=function(e,r){return t.TypeCheck(e,!0,t.Vector2D),t.TypeCheck(r,!0,"number"),this.x+=r*e.x,this.y+=r*e.y,this},n.prototype.addScalar=function(e){return t.TypeCheck(e,!0,"number"),this.x+=e,this.y+=e,this},n.prototype.sub=function(e){return t.TypeCheck(e,!0,t.Vector2D),this.x-=e.x,this.y-=e.y,this},n.prototype.subScaledVector=function(e,r){return t.TypeCheck(e,!0,t.Vector2D),t.TypeCheck(r,!0,"number"),this.x-=r*e.x,this.y-=r*e.y,this},n.prototype.subScalar=function(e){return t.TypeCheck(e,!0,"number"),this.x-=e,this.y-=e,this},n.prototype.multiplyScalar=function(e){return t.TypeCheck(e,!0,"number"),this.x*=e,this.y*=e,this},n.prototype.divideScalar=function(e){return t.TypeCheck(e,!0,"number"),this.x/=e,this.y/=e,this},n.prototype.dot=function(e){return t.TypeCheck(e,!0,t.Vector2D),this.x*e.x+this.y*e.y},n.prototype.cross=function(e){return t.TypeCheck(e,!0,t.Vector2D),this.x*e.y-this.y*e.x},n.prototype.isOrthogonal=function(e){t.TypeCheck(e,!0,t.Vector2D);var r=this.squareNorm(),n=e.squareNorm(),o=t.defaultTolerances.epsilonForSquareAngleTest,i=this.dot(e);return i*=i,r<=o*Math.min(1,n)||n<=o*Math.min(1,r)||i<=r*n*o},n.prototype.isParallel=function(e){t.TypeCheck(e,!0,t.Vector2D);var r=this.squareNorm(),n=e.squareNorm(),o=t.defaultTolerances.epsilonForSquareAngleTest,i=1-o,s=this.dot(e);return s*=s,r<=o*Math.min(1,n)||n<=o*Math.min(1,r)||s>=r*n*i},n.prototype.orthoComponents=function(e){t.TypeCheck(e,!0,t.Vector2D);var r=n.project(this,e);return[r,n.sub(this,r)]},n.prototype.isEqual=function(e,r){t.TypeCheck(e,!0,t.Vector2D),t.TypeCheck(r,!1,"number");return arguments.length<2?this.x==e.x&&this.y==e.y:!(Math.abs(this.x-e.x)>r||Math.abs(this.y-e.y)>r)},n.prototype.isNormalized=function(){var e=t.defaultTolerances.epsilonForRelativeTest,r=this.squareNorm();return Math.abs(r-1)<=2*e},n.prototype.project=function(e){t.TypeCheck(e,!0,t.Vector2D);var r=e.squareNorm(),n=this.dot(e)/r;return this.copy(e),this.multiplyScalar(n),this},n.prototype.projectOrthogonal=function(e){t.TypeCheck(e,!0,t.Vector2D);var r=e.squareNorm(),n=this.dot(e)/r;return this.subScaledVector(e,n),this},n.prototype.lerp=function(e,r){return t.TypeCheck(e,!0,t.Vector2D),t.TypeCheck(r,!0,"number"),this.x+=r*(e.x-this.x),this.y+=r*(e.y-this.y),this},n.prototype.getAngleTo=function(e){return t.TypeCheck(e,!0,t.Vector2D),Math.abs(this.getSignedAngleTo(e))},n.prototype.getSignedAngleTo=function(e){t.TypeCheck(e,!0,t.Vector2D);var r=0,n=this.squareNorm(),o=e.squareNorm();if(0!=n&&0!=o){var i=this.dot(e),s=this.cross(e);r=Math.atan2(s,i)}return r},n.prototype.clamp=function(e,r){return t.TypeCheck(e,!0,t.Vector2D),t.TypeCheck(r,!0,t.Vector2D),this.x=this.x<e.x?e.x:this.x>r.x?r.x:this.x,this.y=this.y<e.y?e.y:this.y>r.y?r.y:this.y,this},n.prototype.clampScalar=function(e,r){return t.TypeCheck(e,!0,"number"),t.TypeCheck(r,!0,"number"),this.x=this.x<e?e:this.x>r?r:this.x,this.y=this.y<e?e:this.y>r?r:this.y,this},Object.defineProperty(n,"xVect",{value:new n(1,0),writable:!1,enumerable:!0,configurable:!1}),Object.freeze(n.xVect),Object.defineProperty(n,"yVect",{value:new n(0,1),writable:!1,enumerable:!0,configurable:!1}),Object.freeze(n.yVect),n.normalize=function(e,r){return t.TypeCheck(e,!0,t.Vector2D),t.TypeCheck(r,!1,t.Vector2D),(r=r?r.copy(e):e.clone()).normalize()},n.add=function(e,r,o){return t.TypeCheck(e,!0,t.Vector2D),t.TypeCheck(r,!0,t.Vector2D),t.TypeCheck(o,!1,t.Vector2D),arguments.length<3&&(o=new n),o.x=e.x+r.x,o.y=e.y+r.y,o},n.sub=function(e,r,o){return t.TypeCheck(e,!0,t.Vector2D),t.TypeCheck(r,!0,t.Vector2D),t.TypeCheck(o,!1,t.Vector2D),arguments.length<3&&(o=new n),o.x=e.x-r.x,o.y=e.y-r.y,o},n.negate=function(e,r){return t.TypeCheck(e,!0,t.Vector2D),t.TypeCheck(r,!1,t.Vector2D),(r=r?r.copy(e):e.clone()).negate()},n.multiplyScalar=function(e,r,n){return t.TypeCheck(e,!0,t.Vector2D),t.TypeCheck(r,!0,"number"),t.TypeCheck(n,!1,t.Vector2D),(n=n?n.copy(e):e.clone()).multiplyScalar(r)},n.divideScalar=function(e,r,n){return t.TypeCheck(e,!0,t.Vector2D),t.TypeCheck(r,!0,"number"),t.TypeCheck(n,!1,t.Vector2D),(n=n?n.copy(e):e.clone()).divideScalar(r)},n.project=function(e,r,o){t.TypeCheck(e,!0,t.Vector2D),t.TypeCheck(r,!0,t.Vector2D),t.TypeCheck(o,!1,t.Vector2D),o=o||new n;var i=r.squareNorm(),s=e.dot(r)/i;return o.copy(r).multiplyScalar(s)},n.lerp=function(e,r,o,i){return t.TypeCheck(e,!0,t.Vector2D),t.TypeCheck(r,!0,t.Vector2D),t.TypeCheck(o,!0,"number"),t.TypeCheck(i,!1,t.Vector2D),(i=i||new n).x=e.x+o*(r.x-e.x),i.y=e.y+o*(r.y-e.y),i},n.orthoNormalize=function(e,r){t.TypeCheck(e,!0,t.Vector2D),t.TypeCheck(r,!0,t.Vector2D),e.normalize(),r.projectOrthogonal(e),r.normalize()},t.Vector2D=n,n}),define("MathematicsES/MathVector2DJSImpl",["DS/MathematicsES/MathVector2DJSImpl"],function(t){return t}),define("DS/MathematicsES/MathPointJSImpl",["DS/MathematicsES/MathNameSpace","DS/MathematicsES/MathTypeCheck","DS/MathematicsES/MathTypeCheckInternal","DS/MathematicsES/MathVector2DJSImpl","DS/MathematicsES/MathVector3DJSImpl"],function(t,e,r,n,o){"use strict";var i=function(e,r,n){t.TypeCheck(e,!1,"number"),t.TypeCheck(r,!1,"number"),t.TypeCheck(n,!1,"number"),this.x=e||0,this.y=r||0,this.z=n||0};return i.prototype.x=null,i.prototype.y=null,i.prototype.z=null,i.prototype.constructor=i,i.prototype.clone=function(){return new t.Point(this.x,this.y,this.z)},i.prototype.copy=function(e){return t.TypeCheck(e,!0,t.Point),this.x=e.x,this.y=e.y,this.z=e.z,this},i.prototype.set=function(e,r,n){return t.TypeCheck(e,!0,"number"),t.TypeCheck(r,!0,"number"),t.TypeCheck(n,!0,"number"),this.x=e,this.y=r,this.z=n,this},i.prototype.setFromArray=function(e){return t.TypeCheck(e,!0,["number"],3),this.x=e[0],this.y=e[1],this.z=e[2],this},i.prototype.setFromVector=function(e){return t.TypeCheck(e,!0,t.Vector3D),this.x=e.x,this.y=e.y,this.z=e.z,this},i.prototype.getArray=function(e){return t.TypeCheck(e,!1,["number"],3),(e=e||new Array(3))[0]=this.x,e[1]=this.y,e[2]=this.z,e},i.prototype.add=function(e){return t.TypeCheck(e,!0,t.Point),this.x+=e.x,this.y+=e.y,this.z+=e.z,this},i.prototype.addScaledPoint=function(e,r){return t.TypeCheck(e,!0,t.Point),t.TypeCheck(r,!0,"number"),this.x+=r*e.x,this.y+=r*e.y,this.z+=r*e.z,this},i.prototype.addVector=function(e){return t.TypeCheck(e,!0,t.Vector3D),this.x+=e.x,this.y+=e.y,this.z+=e.z,this},i.prototype.addScaledVector=function(e,r){return t.TypeCheck(e,!0,t.Vector3D),t.TypeCheck(r,!0,"number"),this.x+=e.x*r,this.y+=e.y*r,this.z+=e.z*r,this},i.prototype.sub=function(e,r){return t.TypeCheck(e,!0,t.Point),t.TypeCheck(r,!1,t.Vector3D),(r=r||new o).x=this.x-e.x,r.y=this.y-e.y,r.z=this.z-e.z,r},i.prototype.subVector=function(e){return t.TypeCheck(e,!0,t.Vector3D),this.x-=e.x,this.y-=e.y,this.z-=e.z,this},i.prototype.subScaledVector=function(e,r){return t.TypeCheck(e,!0,t.Vector3D),t.TypeCheck(r,!0,"number"),this.x-=e.x*r,this.y-=e.y*r,this.z-=e.z*r,this},i.prototype.multiplyScalar=function(e){return t.TypeCheck(e,!0,"number"),this.x*=e,this.y*=e,this.z*=e,this},i.prototype.divideScalar=function(e){return t.TypeCheck(e,!0,"number"),this.x/=e,this.y/=e,this.z/=e,this},i.prototype.distanceTo=function(e){t.TypeCheck(e,!0,t.Point);var r=this.x-e.x,n=this.y-e.y,o=this.z-e.z;return Math.sqrt(r*r+n*n+o*o)},i.prototype.squareDistanceTo=function(e){t.TypeCheck(e,!0,t.Point);var r=this.x-e.x,n=this.y-e.y,o=this.z-e.z;return r*r+n*n+o*o},i.prototype.squareDistanceToOrigin=function(){return this.x*this.x+this.y*this.y+this.z*this.z},i.prototype.distanceToLine=function(e){return t.TypeCheck(e,!0,t.Line),e.distanceToPoint(this)},i.prototype.distanceToCircle=function(e){t.TypeCheck(e,!0,t.Circle);var r=e.getDirectionsNotCloned(),n=this.sub(e.center).projectOnPlaneFromVectors(r[0],r[1]).norm();return Math.abs(n-e.radius)},i.prototype.distanceToPlane=function(e){t.TypeCheck(e,!0,t.Plane);var r=e.getNormal(),n=this.sub(e.origin);return Math.abs(r.dot(n))},i.prototype.distanceToPointArray=function(e,r){t.TypeCheck(e,!0,[t.Point],[]),t.TypeCheck(r,!1,["number"],[]);var n=new Array(1),o=0,i=0,s=0,a=e.length,c=1/0;for(i=0;i<a;i++)(s=(this.x-e[i].x)*(this.x-e[i].x)+(this.y-e[i].y)*(this.y-e[i].y)+(this.z-e[i].z)*(this.z-e[i].z))<c?(c=s,n[0]=i,o=1):s==c&&(n[o]=i,o++);if(r)for(i=o-1;i>-1;i--)r[i]=n[i];return s=Math.sqrt(c)},i.prototype.projectOnLine=function(e){t.TypeCheck(e,!0,t.Line);var r=this.sub(e.origin);return r.project(e.direction),this.copy(e.origin),this.addVector(r),this},i.prototype.projectOnCircle=function(e){t.TypeCheck(e,!0,t.Circle);var r=e.getDirectionsNotCloned(),n=this.sub(e.center).projectOnPlaneFromVectors(r[0],r[1]),o=n.norm();return o>t.defaultTolerances.epsgForRelativeTest&&this.setFromVector(n).multiplyScalar(e.radius/o).add(e.center),this},i.prototype.projectOnPlane=function(e){t.TypeCheck(e,!0,t.Plane);var r=e.getDirectionsNotCloned(),n=this.sub(e.origin),o=n.dot(r[0]),i=n.dot(r[1]);return this.copy(e.origin).addScaledVector(r[0],o).addScaledVector(r[1],i),this},i.prototype.isEqual=function(e,r){t.TypeCheck(e,!0,t.Point),t.TypeCheck(r,!1,"number");return arguments.length<2?this.x==e.x&&this.y==e.y&&this.z==e.z:!(Math.abs(this.x-e.x)>r||Math.abs(this.y-e.y)>r||Math.abs(this.z-e.z)>r)},i.prototype.lerp=function(e,r){return t.TypeCheck(e,!0,t.Point),t.TypeCheck(r,!0,"number"),this.x+=r*(e.x-this.x),this.y+=r*(e.y-this.y),this.z+=r*(e.z-this.z),this},i.prototype.clamp=function(e,r){return t.TypeCheck(e,!0,t.Point),t.TypeCheck(r,!0,t.Point),this.x=this.x<e.x?e.x:this.x>r.x?r.x:this.x,this.y=this.y<e.y?e.y:this.y>r.y?r.y:this.y,this.z=this.z<e.z?e.z:this.z>r.z?r.z:this.z,this},i.prototype.clampScalar=function(e,r){return t.TypeCheck(e,!0,"number"),t.TypeCheck(r,!0,"number"),this.x=this.x<e?e:this.x>r?r:this.x,this.y=this.y<e?e:this.y>r?r:this.y,this.z=this.z<e?e:this.z>r?r:this.z,this},i.prototype.applyMatrix3x3=function(e){t.TypeCheck(e,!0,t.Matrix3x3);var r=e.coef,n=this.x,o=this.y,i=this.z;return this.x=r[0]*n+r[1]*o+r[2]*i,this.y=r[3]*n+r[4]*o+r[5]*i,this.z=r[6]*n+r[7]*o+r[8]*i,this},i.prototype.applyTransformation=function(e){t.TypeCheck(e,!0,t.Transformation);var r=e.matrix.coef,n=e.vector,o=this.x,i=this.y,s=this.z;return this.x=r[0]*o+r[1]*i+r[2]*s+n.x,this.y=r[3]*o+r[4]*i+r[5]*s+n.y,this.z=r[6]*o+r[7]*i+r[8]*s+n.z,this},i.prototype.applyQuaternion=function(e){t.TypeCheck(e,!0,t.Quaternion);var r=e.squareNorm(),n=this.x,o=this.y,i=this.z,s=e.x,a=e.y,c=e.z,h=e.s,p=-s*n-a*o-c*i,l=h*n+a*i-c*o,u=h*o+c*n-s*i,y=h*i+s*o-a*n;return this.x=(l*h+p*-s+u*-c-y*-a)/r,this.y=(u*h+p*-a+y*-s-l*-c)/r,this.z=(y*h+p*-c+l*-a-u*-s)/r,this},Object.defineProperty(i,"origin",{value:new i(0,0,0),writable:!1,enumerable:!0,configurable:!1}),Object.freeze(i.origin),i.add=function(e,r,n){return t.TypeCheck(e,!0,t.Point),t.TypeCheck(r,!0,t.Point),t.TypeCheck(n,!1,t.Point),(n=n||new i).x=e.x+r.x,n.y=e.y+r.y,n.z=e.z+r.z,n},i.addVector=function(e,r,n){return t.TypeCheck(e,!0,t.Point),t.TypeCheck(r,!0,t.Vector3D),t.TypeCheck(n,!1,t.Point),(n=n?n.copy(e):e.clone()).addVector(r)},i.subVector=function(e,r,n){return t.TypeCheck(e,!0,t.Point),t.TypeCheck(r,!0,t.Vector3D),t.TypeCheck(n,!1,t.Point),(n=n?n.copy(e):e.clone()).subVector(r)},i.multiplyScalar=function(e,r,n){return t.TypeCheck(e,!0,t.Point),t.TypeCheck(r,!0,"number"),t.TypeCheck(n,!1,t.Point),(n=n?n.copy(e):e.clone()).multiplyScalar(r)},i.divideScalar=function(e,r,n){return t.TypeCheck(e,!0,t.Point),t.TypeCheck(r,!0,"number"),t.TypeCheck(n,!1,t.Point),(n=n?n.copy(e):e.clone()).divideScalar(r)},i.lerp=function(e,r,n,o){return t.TypeCheck(e,!0,t.Point),t.TypeCheck(r,!0,t.Point),t.TypeCheck(n,!0,"number"),t.TypeCheck(o,!1,t.Point),(o=o||new i).x=e.x+n*(r.x-e.x),o.y=e.y+n*(r.y-e.y),o.z=e.z+n*(r.z-e.z),o},t.Point=i,i}),define("MathematicsES/MathPointJSImpl",["DS/MathematicsES/MathPointJSImpl"],function(t){return t}),define("DS/MathematicsES/MathPoint2DJSImpl",["DS/MathematicsES/MathNameSpace","DS/MathematicsES/MathTypeCheck","DS/MathematicsES/MathTypeCheckInternal","DS/MathematicsES/MathVector2DJSImpl"],function(t,e,r,n){"use strict";var o=function(e,r){t.TypeCheck(e,!1,"number"),t.TypeCheck(r,!1,"number"),this.x=e||0,this.y=r||0};return o.prototype.x=null,o.prototype.y=null,o.prototype.constructor=o,o.prototype.clone=function(){return new t.Point2D(this.x,this.y)},o.prototype.copy=function(e){return t.TypeCheck(e,!0,t.Point2D),this.x=e.x,this.y=e.y,this},o.prototype.set=function(e,r){return t.TypeCheck(e,!0,"number"),t.TypeCheck(r,!0,"number"),this.x=e,this.y=r,this},o.prototype.setFromArray=function(e){return t.TypeCheck(e,!0,["number"],2),this.x=e[0],this.y=e[1],this},o.prototype.setFromVector=function(e){return t.TypeCheck(e,!0,t.Vector2D),this.x=e.x,this.y=e.y,this},o.prototype.getArray=function(e){return t.TypeCheck(e,!1,[t.Point2D],2),(e=e||new Array(2))[0]=this.x,e[1]=this.y,e},o.prototype.add=function(e){return t.TypeCheck(e,!0,t.Point2D),this.x+=e.x,this.y+=e.y,this},o.prototype.addScaledPoint=function(e,r){return t.TypeCheck(e,!0,t.Point2D),t.TypeCheck(r,!0,"number"),this.x+=r*e.x,this.y+=r*e.y,this},o.prototype.addVector=function(e){return t.TypeCheck(e,!0,t.Vector2D),this.x+=e.x,this.y+=e.y,this},o.prototype.addScaledVector=function(e,r){return t.TypeCheck(e,!0,t.Vector2D),t.TypeCheck(r,!0,"number"),this.x+=e.x*r,this.y+=e.y*r,this},o.prototype.sub=function(e,r){return t.TypeCheck(e,!0,t.Point2D),t.TypeCheck(r,!1,t.Vector2D),(r=r||new n).x=this.x-e.x,r.y=this.y-e.y,r},o.prototype.subVector=function(e){return t.TypeCheck(e,!0,t.Vector2D),this.x-=e.x,this.y-=e.y,this},o.prototype.subScaledVector=function(e,r){return t.TypeCheck(e,!0,t.Vector2D),t.TypeCheck(r,!0,"number"),this.x-=e.x*r,this.y-=e.y*r,this},o.prototype.multiplyScalar=function(e){return t.TypeCheck(e,!0,"number"),this.x*=e,this.y*=e,this},o.prototype.divideScalar=function(e){return t.TypeCheck(e,!0,"number"),this.x/=e,this.y/=e,this},o.prototype.distanceTo=function(e){t.TypeCheck(e,!0,t.Point2D);var r=this.x-e.x,n=this.y-e.y;return Math.sqrt(r*r+n*n)},o.prototype.squareDistanceTo=function(e){t.TypeCheck(e,!0,t.Point2D);var r=this.x-e.x,n=this.y-e.y;return r*r+n*n},o.prototype.squareDistanceToOrigin=function(){return this.x*this.x+this.y*this.y},o.prototype.distanceToPoint2DArray=function(e,r){t.TypeCheck(e,!0,[t.Point2D],[]),t.TypeCheck(r,!1,["number"],[]);var n=new Array(1),o=0,i=0,s=0,a=e.length,c=1/0;for(i=0;i<a;i++)(s=(this.x-e[i].x)*(this.x-e[i].x)+(this.y-e[i].y)*(this.y-e[i].y))<c?(c=s,n[0]=i,o=1):s==c&&(n[o]=i,o++);if(r)for(i=o-1;i>-1;i--)r[i]=n[i];return s=Math.sqrt(c)},o.prototype.projectOnLine=function(e){t.TypeCheck(e,!0,t.Line2D);var r=this.sub(e.origin);return r.project(e.direction),this.copy(e.origin),this.addVector(r),this},o.prototype.isEqual=function(e,r){t.TypeCheck(e,!0,t.Point2D),t.TypeCheck(r,!1,"number");return arguments.length<2?this.x==e.x&&this.y==e.y:!(Math.abs(this.x-e.x)>r||Math.abs(this.y-e.y)>r)},o.prototype.lerp=function(e,r){return t.TypeCheck(e,!0,t.Point2D),t.TypeCheck(r,!0,"number"),this.x+=r*(e.x-this.x),this.y+=r*(e.y-this.y),this},o.prototype.clamp=function(e,r){return t.TypeCheck(e,!0,t.Point2D),t.TypeCheck(r,!0,t.Point2D),this.x=this.x<e.x?e.x:this.x>r.x?r.x:this.x,this.y=this.y<e.y?e.y:this.y>r.y?r.y:this.y,this},o.prototype.clampScalar=function(e,r){return t.TypeCheck(e,!0,"number"),t.TypeCheck(r,!0,"number"),this.x=this.x<e?e:this.x>r?r:this.x,this.y=this.y<e?e:this.y>r?r:this.y,this},Object.defineProperty(o,"origin",{value:new o(0,0),writable:!1,enumerable:!0,configurable:!1}),Object.freeze(o.origin),o.add=function(e,r,n){return t.TypeCheck(e,!0,t.Point2D),t.TypeCheck(r,!0,t.Point2D),t.TypeCheck(n,!1,t.Point2D),(n=n||new o).x=e.x+r.x,n.y=e.y+r.y,n},o.addVector=function(e,r,n){return t.TypeCheck(e,!0,t.Point2D),t.TypeCheck(r,!0,t.Vector2D),t.TypeCheck(n,!1,t.Point2D),(n=n?n.copy(e):e.clone()).addVector(r)},o.subVector=function(e,r,n){return t.TypeCheck(e,!0,t.Point2D),t.TypeCheck(r,!0,t.Vector2D),t.TypeCheck(n,!1,t.Point2D),(n=n?n.copy(e):e.clone()).subVector(r)},o.multiplyScalar=function(e,r,n){return t.TypeCheck(e,!0,t.Point2D),t.TypeCheck(r,!0,"number"),t.TypeCheck(n,!1,t.Point2D),(n=n?n.copy(e):e.clone()).multiplyScalar(r)},o.divideScalar=function(e,r,n){return t.TypeCheck(e,!0,t.Point2D),t.TypeCheck(r,!0,"number"),t.TypeCheck(n,!1,t.Point2D),(n=n?n.copy(e):e.clone()).divideScalar(r)},o.lerp=function(e,r,n,i){return t.TypeCheck(e,!0,t.Point2D),t.TypeCheck(r,!0,t.Point2D),t.TypeCheck(n,!0,"number"),t.TypeCheck(i,!1,t.Point2D),(i=i||new o).x=e.x+n*(r.x-e.x),i.y=e.y+n*(r.y-e.y),i},t.Point2D=o,o}),define("MathematicsES/MathPoint2DJSImpl",["DS/MathematicsES/MathPoint2DJSImpl"],function(t){return t}),define("DS/MathematicsES/MathBoxJSImpl",["DS/MathematicsES/MathNameSpace","DS/MathematicsES/MathTypeCheck","DS/MathematicsES/MathTypeCheckInternal","DS/MathematicsES/MathPointJSImpl","DS/MathematicsES/MathPoint2DJSImpl"],function(t,e,r,n){"use strict";var o=function(e,r){t.TypeCheck(e,!1,t.Point),t.TypeCheck(r,!1,t.Point),this.Low=e?e.clone():null,this.Upp=r?r.clone():null};return o.prototype.clone=function(){return new t.Box(this.Low,this.Upp)},o.prototype.SetCorners=function(e,r){t.TypeCheck(e,!0,t.Point),t.TypeCheck(r,!0,t.Point),this.Low=e.clone(),this.Upp=r.clone()},o.prototype.Update=function(e){t.TypeCheck(e,!0,t.Point),null===this.Low?this.Low=e.clone():(e.x<this.Low.x&&(this.Low.x=e.x),e.y<this.Low.y&&(this.Low.y=e.y),e.z<this.Low.z&&(this.Low.z=e.z)),null===this.Upp?this.Upp=e.clone():(e.x>this.Upp.x&&(this.Upp.x=e.x),e.y>this.Upp.y&&(this.Upp.y=e.y),e.z>this.Upp.z&&(this.Upp.z=e.z))},o.prototype.Inflate=function(e){return t.TypeCheck(e,!0,"number"),this.Low.x-=e,this.Low.y-=e,this.Low.z-=e,this.Upp.x+=e,this.Upp.y+=e,this.Upp.z+=e,this},o.prototype.InteractsWith=function(e,r){if(t.TypeCheck(e,!0,t.Box),t.TypeCheck(r,!1,"number"),void 0===r)return!(this.Upp.x<e.Low.x||this.Low.x>e.Upp.x)&&(!(this.Upp.y<e.Low.y||this.Low.y>e.Upp.y)&&!(this.Upp.z<e.Low.z||this.Low.z>e.Upp.z));var n=e.clone().Inflate(r),o=this.clone().Inflate(r);return n.InteractsWith(o)},o.prototype.Contains=function(e){return t.TypeCheck(e,!0,t.Point),!(e.x<this.Low.x||e.x>this.Upp.x)&&(!(e.y<this.Low.y||e.y>this.Upp.y)&&!(e.z<this.Low.z||e.z>this.Upp.z))},o.prototype.DistanceTo=function(e){if(t.TypeCheck(e,!0,t.Point),!0===this.Contains(e))return 0;var r=e.clone();return r.x<this.Low.x?r.x=this.Low.x:r.x>this.Upp.x&&(r.x=this.Upp.x),r.y<this.Low.y?r.y=this.Low.y:r.y>this.Upp.y&&(r.y=this.Upp.y),r.z<this.Low.z?r.z=this.Low.z:r.z>this.Upp.z&&(r.z=this.Upp.z),r.distanceTo(e)},o.prototype.GetBorderLines=function(){var e=[],r=new t.Vector3D(1,0,0),n=new t.Vector3D(0,1,0),o=new t.Vector3D(0,0,1),i=Math.abs(this.Upp.x-this.Low.x),s=Math.abs(this.Upp.y-this.Low.y),a=Math.abs(this.Upp.z-this.Low.z);if(i>1e-4){var c=this.Low.clone();e.push({_Line:(new t.Line).setOrigin(c).setDirection(r),_Range:[0,i]}),c.y=this.Upp.y,c.z=this.Upp.z,e.push({_Line:(new t.Line).setOrigin(c).setDirection(r),_Range:[0,i]}),s>1e-4&&(c.y=this.Upp.y,c.z=this.Low.z,e.push({_Line:(new t.Line).setOrigin(c).setDirection(r),_Range:[0,i]})),a>1e-4&&(c.y=this.Low.y,c.z=this.Upp.z,e.push({_Line:(new t.Line).setOrigin(c).setDirection(r),_Range:[0,i]}))}if(s>1e-4){c=this.Low.clone();e.push({_Line:(new t.Line).setOrigin(c).setDirection(n),_Range:[0,s]}),c.x=this.Upp.x,c.z=this.Upp.z,e.push({_Line:(new t.Line).setOrigin(c).setDirection(n),_Range:[0,s]}),i>1e-4&&(c.x=this.Upp.x,c.z=this.Low.z,e.push({_Line:(new t.Line).setOrigin(c).setDirection(n),_Range:[0,s]})),a>1e-4&&(c.x=this.Low.x,c.z=this.Upp.z,e.push({_Line:(new t.Line).setOrigin(c).setDirection(n),_Range:[0,s]}))}if(a>1e-4){c=this.Low.clone();e.push({_Line:(new t.Line).setOrigin(c).setDirection(o),_Range:[0,a]}),c.x=this.Upp.x,c.y=this.Upp.y,e.push({_Line:(new t.Line).setOrigin(c).setDirection(o),_Range:[0,a]}),i>1e-4&&(c.x=this.Upp.x,c.y=this.Low.y,e.push({_Line:(new t.Line).setOrigin(c).setDirection(o),_Range:[0,a]})),s>1e-4&&(c.x=this.Low.x,c.y=this.Upp.y,e.push({_Line:(new t.Line).setOrigin(c).setDirection(o),_Range:[0,a]}))}return e},t.Box=o,o}),define("MathematicsES/MathBoxJSImpl",["DS/MathematicsES/MathBoxJSImpl"],function(t){return t}),define("DS/MathematicsES/MathLineJSImpl",["DS/MathematicsES/MathNameSpace","DS/MathematicsES/MathTypeCheck","DS/MathematicsES/MathTypeCheckInternal","DS/MathematicsES/MathPointJSImpl","DS/MathematicsES/MathVector3DJSImpl","DS/MathematicsES/MathBoxJSImpl"],function(t,e,r,n,o,i){"use strict";var s=function(e,r){t.TypeCheck(e,!1,t.Point),t.TypeCheck(r,!1,t.Vector3D),this.origin=e?e.clone():new n(0,0,0),this.direction=r?r.clone():new o(1,0,0)};return s.prototype.origin=null,s.prototype.direction=null,Object.defineProperty(s.prototype,"scale",{enumerable:!0,configurable:!0,get:function(){return this.getScale()},set:function(t){return this.setScale(t)}}),s.prototype.IsInfinite=function(){return!0},s.prototype.IsPeriodic=function(){return!1},s.prototype.GetDegree=function(){return 1},s.prototype.clone=function(){return(new s).copy(this)},s.prototype.copy=function(e){return t.TypeCheck(e,!0,t.Line),this.origin.copy(e.origin),this.direction.copy(e.direction),this},s.prototype.set=function(e,r,n,o,i,s){return t.TypeCheck(e,!1,"number"),t.TypeCheck(r,!1,"number"),t.TypeCheck(n,!1,"number"),t.TypeCheck(o,!1,"number"),t.TypeCheck(i,!1,"number"),t.TypeCheck(s,!1,"number"),this.origin.set(e||0,r||0,n||0),this.direction.set(o||0,i||0,s||0),this},s.prototype.setOrigin=function(e,r,o){return t.TypeCheck(e,!0,["number",t.Point]),t.TypeCheck(r,!1,"number"),t.TypeCheck(o,!1,"number"),e.constructor===n?this.origin.copy(e):this.origin.set(e,r||0,o||0),this},s.prototype.setDirection=function(e,r,n){return t.TypeCheck(e,!0,["number",t.Vector3D]),t.TypeCheck(r,!1,"number"),t.TypeCheck(n,!1,"number"),e.constructor===o?this.direction.copy(e):this.direction.set(e,r||0,n||0),this},s.prototype.setScale=function(e){return t.TypeCheck(e,!0,"number"),Math.abs(e)>t.defaultTolerances.epsgForLengthTest&&(this.direction.normalize(),this.direction.multiplyScalar(e)),this},s.prototype.getScale=function(){return this.direction.norm()},s.prototype.evalPoint=function(e,r){return t.TypeCheck(e,!0,"number"),t.TypeCheck(r,!1,t.Point),(r=r?op.copy(this.origin):this.origin.clone()).addScaledVector(this.direction,e)},s.prototype.evalFirstDeriv=function(e){return t.TypeCheck(e,!0,"number"),this.direction.clone()},s.prototype.evalSecondDeriv=function(e){return t.TypeCheck(e,!0,"number"),new t.Vector3D(0,0,0)},s.prototype.GetBox=function(e){t.TypeCheck(e,!0,["number"],2);var r=new t.Box;return r.Update(this.evalPoint(e[0])),r.Update(this.evalPoint(e[1])),r},s.prototype.Dump=function(t){console.log("var geo"+t+"; // line"),console.log("{"),console.log("  var lOri = new DSMath.Point("+this.origin.getArray()+");"),console.log("  var lDir = new DSMath.Vector3D("+this.direction.getArray()+");"),console.log("  geo"+t+" = new DSMath.Line().setOrigin(lOri).setDirection(lDir);"),console.log("} // end of line creation")},s.prototype.squareDistanceToPoint=function(e){t.TypeCheck(e,!0,t.Point);var r=this.direction;return this.origin.sub(e).cross(r).squareNorm()/r.squareNorm()},s.prototype.distanceToPoint=function(e){return t.TypeCheck(e,!0,t.Point),Math.sqrt(this.squareDistanceToPoint(e))},s.prototype.distanceToLine=function(e,r){t.TypeCheck(e,!0,t.Line),t.TypeCheck(r,!1,Object),r=r||{param1:0,param2:0,diag:0};var n=0,i=t.defaultTolerances.epsgForSquareAngleTest,s=t.defaultTolerances.epsilonForRelativeTest,a=this.getScale(),c=this.direction,h=e.getScale(),p=e.direction,l=this.origin.sub(e.origin),u=c.dot(p)/(a*h);if(Math.abs(u*u-1)<i)s=this.distanceTo(e),r.diag=n<s?2:1,r.param2=Math.sqrt(l.squareNorm()-n*n)/h,r.param2*=l.dot(p)>0?1:-1;else{n=Math.abs(o.cross(c,p).dot(l))/(a*h);var y=1-u*u,m=l.dot(c)/a,f=l.dot(p)/h;r.diag=0,r.param1=(u*f-m)/(y*a),r.param2=(f-u*m)/(y*h)}return n},s.prototype.squareDistanceToLine=function(e,r){t.TypeCheck(e,!0,t.Line),t.TypeCheck(r,!1,Object),r=r||{param1:0,param2:0,diag:0};var n=this.distanceToLine(e,r);return n*n},s.prototype.getParam=function(e,r,n,o){t.TypeCheck(e,!0,t.Point),t.TypeCheck(r,!0,"number"),t.TypeCheck(n,!0,"number"),t.TypeCheck(o,!1,"number");var i=[],s=e.sub(this.origin),a=s.dot(this.direction)/this.direction.squareNorm();return a=a<r?r:n<a?n:a,(s=this.evalPoint(a).sub(e,s)).squareNorm()<o*o&&(i[0]=a),i},s.prototype.intersectLine=function(e,r,n,o,i,s){t.TypeCheck(e,!0,t.Line),t.TypeCheck(r,!0,"number"),t.TypeCheck(n,!0,"number"),t.TypeCheck(o,!0,"number"),t.TypeCheck(i,!0,"number"),t.TypeCheck(s,!1,"number"),s=s||t.defaultTolerances.epsgForRelativeTest;var a=t.defaultTolerances.epsgForSquareRelativeTest,c=a*Math.max(1,this.origin.squareDistanceToOrigin()),h={param1:0,param2:0,diag:-1},p=this.direction,l=p.norm(),u=e.direction,y=u.norm(),m=p.dot(u)/(l*y),f=1-m*m;if(f>a){var v=0,g=0,C=this.origin,D=e.origin,T=p.clone().cross(u),S=T.clone().cross(p),d=C.sub(D).dot(S),M=u.dot(S);g=d/M;var k=T.clone().cross(u);v=(v=(d=C.sub(D).dot(k))/(M=-p.dot(k)))<r?r:v>n?n:v,g=g<o?o:g>i?i:g;S=this.evalPoint(v),k=e.evalPoint(g);S.squareDistanceTo(k)<s*s&&(h.param1=v,h.param2=g,h.diag=0)}else e.squareDistanceToPoint(this.origin)<c&&(h.diag=1);return h},s.prototype.intersectFullLine=function(e,r){t.TypeCheck(e,!0,t.Line),t.TypeCheck(r,!1,"number"),r=r||t.defaultTolerances.epsgForRelativeTest;var n=t.defaultTolerances.epsgForSquareRelativeTest,o=n*Math.max(1,this.origin.squareDistanceToOrigin()),i={param1:0,param2:0,diag:-1},s=this.direction,a=s.norm(),c=e.direction,h=c.norm(),p=s.dot(c)/(a*h),l=1-p*p;if(l>n){var u=this.origin.sub(e.origin),y=u.dot(s),m=u.dot(c),f=(p*m-y)/(l*a*a),v=(m-p*y)/(l*h*h),g=this.evalPoint(f),C=e.evalPoint(v);g.squareDistanceTo(C)<r*r&&(i.param1=f,i.param2=v,i.diag=0)}else e.squareDistanceToPoint(this.origin)<o&&(i.diag=1);return i},s.prototype.intersectCircle=function(e,r,n,o,i,s){return t.TypeCheck(e,!0,t.Circle),t.TypeCheck(r,!0,"number"),t.TypeCheck(n,!0,"number"),t.TypeCheck(o,!0,"number"),t.TypeCheck(i,!0,"number"),t.TypeCheck(s,!0,"number"),e.intersectLine(this,o,i,r,n,s)},s.prototype.applyTransformation=function(e){return t.TypeCheck(e,!0,t.Transformation),this.origin.applyTransformation(e),this.direction.applyTransformation(e),this},s.makeFromPoints=function(e,r,n,o){t.TypeCheck(e,!0,t.Point),t.TypeCheck(r,!0,t.Point),t.TypeCheck(n,!1,"number"),t.TypeCheck(o,!1,"number");var i=new t.Line;return r.sub(e,i.direction),arguments.length>=4&&Math.abs(o-n)>t.defaultTolerances.epsgForLengthTest?i.setScale(i.direction.norm()/(o-n)):i.setScale(1),i.origin.copy(e),n&&i.origin.addScaledVector(i.direction,-n),i},t.Line=s,s}),define("MathematicsES/MathLineJSImpl",["DS/MathematicsES/MathLineJSImpl"],function(t){return t}),define("DS/MathematicsES/MathNurbsCurveJSImpl",["DS/MathematicsES/MathNameSpace","DS/MathematicsES/MathTypeCheck","DS/MathematicsES/MathTypeCheckInternal","DS/MathematicsES/MathPointJSImpl","DS/MathematicsES/MathVector3DJSImpl","DS/MathematicsES/MathBoxJSImpl"],function(t,e,r,n,o,i){"use strict";var s=function(e,r,n,o,i){t.TypeCheck(e,!1,[Object],[]),t.TypeCheck(r,!1,[t.Point],[]),t.TypeCheck(n,!1,["number"],[]),t.TypeCheck(o,!1,"number"),this.OK=!1,e&&r&&n&&o&&this.setData(e,r,n,o,i),this.FindRangeActiveCP=function(t){var e=this.FindFullKnotIndex(t),r=[];return r[0]=Math.min(Math.max(e-this.Degree-1,0),this.CPs.length-1),r[1]=Math.min(Math.max(e-1,0),this.CPs.length-1),this._DEBUG>=1&&console.log("    --\x3e in arc: "+e+" (active CPs: ["+r[0]+", "+r[1]+"])"),r},this.FindArcIndex=function(e){if(t.TypeCheckInternal(e,!0,"number"),2==this.KnotVec.length)return 0;for(var r=[0,this.KnotVec.length-1];r[1]-r[0]>1;){var n=r[0]+Math.floor((r[1]-r[0])/2);e<this.KnotVec[n].knotValue?r[1]=n:e>=this.KnotVec[n+1].knotValue?r[0]=n:(r[0]=n,r[1]=n+1)}return r[0]},this.EvalPolynomial=function(e,r,n){t.TypeCheckInternal(e,!0,"number"),t.TypeCheckInternal(r,!0,"number"),t.TypeCheckInternal(n,!0,"number");var o=e;1===this._ScalePoly&&(o=(e-this.GetPolyShift(r))/this.GetPolyScale(r));for(var i=this.PolyCache[r][n][0],s=1;s<=this.Degree;s++)i+=this.PolyCache[r][n][s]*Math.pow(o,s);return i},this.EvalPolynomialFirstDeriv=function(e,r,n){t.TypeCheckInternal(e,!0,"number"),t.TypeCheckInternal(r,!0,"number"),t.TypeCheckInternal(n,!0,"number");var o=e;1===this._ScalePoly&&(o=(e-this.GetPolyShift(r))/this.GetPolyScale(r));for(var i=this.PolyCache[r][n][1],s=1;s<=this.Degree-1;s++)i+=this.PolyCache[r][n][s+1]*(s+1)*Math.pow(o,s);return 1===this._ScalePoly&&(i/=this.GetPolyScale(r)),i},this.EvalPolynomialSecondDeriv=function(e,r,n){if(t.TypeCheckInternal(e,!0,"number"),t.TypeCheckInternal(r,!0,"number"),t.TypeCheckInternal(n,!0,"number"),this.Degree<2)return 0;var o=e;1===this._ScalePoly&&(o=(e-this.GetPolyShift(r))/this.GetPolyScale(r));for(var i=2*this.PolyCache[r][n][2],s=1;s<=this.Degree-2;s++)i+=this.PolyCache[r][n][s+2]*(s+2)*(s+1)*Math.pow(o,s);return 1===this._ScalePoly&&(i/=Math.pow(this.GetPolyScale(r),2)),i},this.EvalBasisFunction=function(e,r,n){if(t.TypeCheckInternal(e,!0,"number"),t.TypeCheckInternal(r,!0,"number"),t.TypeCheckInternal(n,!0,"number"),this._DEBUG>=3&&(this._DEBUG_INDENT+="  ",console.log(this._DEBUG_INDENT+"EvalBasisFunction("+r+", "+n+") at "+e)),0==n){var o=!1;if(this._DEBUG>=3&&console.log(this._DEBUG_INDENT+"Arc range "+this.KnotVecFull[r]+" -> "+this.KnotVecFull[r+1]),!0===this.IsArcActive(r)){if(this._DEBUG>=3&&console.log(this._DEBUG_INDENT+" --\x3e active arc"),e>=this.KnotVecFull[r]){var i=!1;if(!1===this.IsClosed){var s=this.KnotVec[this.KnotVec.length-1].knotMult;r==this.KnotVecFull.length-s-1&&(i=!0,this._DEBUG>=3&&console.log(this._DEBUG_INDENT+"  --\x3e detected last arc"))}!0===i?e<=this.KnotVecFull[r+1]&&(o=!0):e<this.KnotVecFull[r+1]&&(o=!0)}}else this._DEBUG>=3&&console.log(this._DEBUG_INDENT+" --\x3e inactive arc");var a=0;return!0===o&&(a=1),this._DEBUG>=3&&(console.log(this._DEBUG_INDENT+"EvalBasisFunction("+r+", "+n+") at "+e+"  --\x3e "+a),this._DEBUG_INDENT=this._DEBUG_INDENT.slice(0,this._DEBUG_INDENT.length-2)),a}var c=this.ComputeLocalKnotInfo(r),h=0;if(c.knotSubIndex+n>=this.KnotVec[c.knotIndex].knotMult){var p=(e-this.KnotVecFull[r])/(this.KnotVecFull[r+n]-this.KnotVecFull[r]),l=this.EvalBasisFunction(e,r,n-1);h+=p*l,this._DEBUG>=3&&(console.log(this._DEBUG_INDENT+" 1st term: "+p+" * "+l),console.log(this._DEBUG_INDENT+"           coef: ("+e+" - "+this.KnotVecFull[r]+") / ("+this.KnotVecFull[r+n]+" - "+this.KnotVecFull[r]+")"))}if((c=this.PropagateKnotInfo(c)).knotSubIndex+n+1>=this.KnotVec[c.knotIndex].knotMult){var u=(this.KnotVecFull[r+n+1]-e)/(this.KnotVecFull[r+n+1]-this.KnotVecFull[r+1]),y=this.EvalBasisFunction(e,r+1,n-1);h+=u*y,this._DEBUG>=3&&(console.log(this._DEBUG_INDENT+" 2nd term: "+u+" * "+y),console.log(this._DEBUG_INDENT+"           coef: ("+this.KnotVecFull[r+n+1]+" - "+e+") / ("+this.KnotVecFull[r+n+1]+" - "+this.KnotVecFull[r+1]+")"))}return this._DEBUG>=3&&(console.log(this._DEBUG_INDENT+"EvalBasisFunction("+r+", "+n+") at "+e+"  --\x3e "+h),this._DEBUG_INDENT=this._DEBUG_INDENT.slice(0,this._DEBUG_INDENT.length-2)),h},this.EvalBasisFunctionFirstDeriv=function(e,r,n){if(t.TypeCheckInternal(e,!0,"number"),t.TypeCheckInternal(r,!0,"number"),t.TypeCheckInternal(n,!0,"number"),0==n)return 0;var o=this.ComputeLocalKnotInfo(r),i=0;if(o.knotSubIndex+n>=this.KnotVec[o.knotIndex].knotMult){var s=(e-this.KnotVecFull[r])/(this.KnotVecFull[r+n]-this.KnotVecFull[r]),a=1/(this.KnotVecFull[r+n]-this.KnotVecFull[r]),c=this.EvalBasisFunction(e,r,n-1);i+=s*this.EvalBasisFunctionFirstDeriv(e,r,n-1)+a*c}if((o=this.PropagateKnotInfo(o)).knotSubIndex+n+1>=this.KnotVec[o.knotIndex].knotMult){var h=(this.KnotVecFull[r+n+1]-e)/(this.KnotVecFull[r+n+1]-this.KnotVecFull[r+1]),p=-1/(this.KnotVecFull[r+n+1]-this.KnotVecFull[r+1]),l=this.EvalBasisFunction(e,r+1,n-1);i+=h*this.EvalBasisFunctionFirstDeriv(e,r+1,n-1)+p*l}return i},this.EvalBasisFunctionSecondDeriv=function(e,r,n){if(t.TypeCheckInternal(e,!0,"number"),t.TypeCheckInternal(r,!0,"number"),t.TypeCheckInternal(n,!0,"number"),0==n||1==n)return 0;var o=this.ComputeLocalKnotInfo(r),i=0;if(o.knotSubIndex+n>=this.KnotVec[o.knotIndex].knotMult){var s=(e-this.KnotVecFull[r])/(this.KnotVecFull[r+n]-this.KnotVecFull[r]),a=1/(this.KnotVecFull[r+n]-this.KnotVecFull[r]),c=this.EvalBasisFunctionFirstDeriv(e,r,n-1);i+=s*this.EvalBasisFunctionSecondDeriv(e,r,n-1)+2*a*c}if((o=this.PropagateKnotInfo(o)).knotSubIndex+n+1>=this.KnotVec[o.knotIndex].knotMult){var h=(this.KnotVecFull[r+n+1]-e)/(this.KnotVecFull[r+n+1]-this.KnotVecFull[r+1]),p=-1/(this.KnotVecFull[r+n+1]-this.KnotVecFull[r+1]),l=this.EvalBasisFunctionFirstDeriv(e,r+1,n-1);i+=h*this.EvalBasisFunctionSecondDeriv(e,r+1,n-1)+2*p*l}return i},this.ComputeLocalKnotInfo=function(t){for(var e=0,r=0,n=0;n<this.KnotVec.length;n++){var o=e+this.KnotVec[n].knotMult;if(o>t)break;e=o,r++}return{knotIndex:r,knotIndexFull:e,knotSubIndex:t-e}},this.PropagateKnotInfo=function(t){var e={knotIndex:t.knotIndex,knotIndexFull:t.knotIndexFull,knotSubIndex:t.knotSubIndex};return t.knotSubIndex+1==this.KnotVec[t.knotIndex].knotMult&&(e.knotIndex++,e.knotSubIndex=-1),e.knotIndexFull++,e},this.IsArcActive=function(t){var e=this.ComputeLocalKnotInfo(t),r=e.knotIndex;e.knotIndexFull;if(e.knotSubIndex!=this.KnotVec[r].knotMult-1)return!1;if(!0===this.IsClosed){if(r<this.Degree)return!1;if(r>=this.KnotVec.length-1-this.Degree)return!1}else if(r==this.KnotVec.length-1)return!1;return!0},this._DEBUG=0,this._DEBUG_INDENT="  ",this._DEBUG_NUM_EVAL=0};return s.prototype.OK=null,s.prototype.KnotVec=null,s.prototype.CPs=null,s.prototype.Weights=null,s.prototype.Degree=null,s.prototype.IsClosed=null,s.prototype.PolyCache=null,s.prototype._ScalePoly=1,s.prototype._VERSION=5,s.prototype.IsInfinite=function(){return!1},s.prototype.IsPeriodic=function(){return this.IsClosed},s.prototype.GetPeriodicRange=function(){return this.IsPeriodic()?this.GetKnotRange():void 0},s.prototype.GetDegree=function(){return this.Degree},s.prototype.GetFirstKnot=function(){return!0===this.IsClosed?this.KnotVec[this.Degree].knotValue:this.KnotVec[0].knotValue},s.prototype.GetLastKnot=function(){return!0===this.IsClosed?this.KnotVec[this.KnotVec.length-1-this.Degree].knotValue:this.KnotVec[this.KnotVec.length-1].knotValue},s.prototype.GetKnotRange=function(){var t=[];return t[0]=this.GetFirstKnot(),t[1]=this.GetLastKnot(),t},s.prototype.GetBox=function(e){if(t.TypeCheck(e,!0,["number"],2),this._VERSION>=3){var r=-1,n=-1;if(Math.abs(e[0]-this.GetFirstKnot())<1e-4&&(r=0),Math.abs(e[1]-this.GetLastKnot())<1e-4&&(n=this.CPs.length-1),r<0||n<0){for(var o=-1,i=0;i<this.KnotVec.length-1;i++){if(!(e[0]>this.KnotVec[i].knotValue)){e[0]===this.KnotVec[i].knotValue&&o++;break}o++}var s=-1;for(i=0;i<this.KnotVec.length-1&&e[1]>this.KnotVec[i].knotValue;i++)s++;r=o,n=s+this.Degree}for(var a=new t.Box,c=r;c<=n;c++){var h=c%this.CPs.length;a.Update(this.CPs[h])}return a}if(this._VERSION>=2){for(var p=0,l=0,u=0;u<this.KnotVec.length-1&&(e[0]>=this.KnotVec[u].knotValue&&(p=u),e[1]>this.KnotVec[u].knotValue);u++)l=u;for(r=p,n=l+this.Degree,a=new t.Box,c=r;c<=n;c++){h=c%this.CPs.length;a.Update(this.CPs[h])}return a}var y=0;for(u=0;u<this.KnotVec.length-1;u++){if(this.KnotVec[u+1].knotValue>e[0])break;y++}var m=y;for(u=y;u<this.KnotVec.length-1;u++){if(this.KnotVec[u+1].knotValue>e[1])break;m++}for(a=new t.Box,r=y,n=m+this.Degree+1,c=r+1;c<n;c++){h=c%this.CPs.length;a.Update(this.CPs[h])}return a},s.prototype.GetSampleInits=function(t,e){if(this._VERSION>=1){for(var r=!1,n=!1,o=[],i=0;i<this.KnotVec.length-1;i++){var s=this.KnotVec[i].knotValue,a=this.KnotVec[i+1].knotValue;if(!(s>e[1]||a<e[0])){for(var c=(a-s)/((l=this.Degree*t)+1),h=0;h<=l;h++){var p=s+h*c;if(!(p<e[0])&&(!1===r&&(o.push(e[0]),r=!0),p>e[0]&&p<e[1]&&o.push(p),p>Range[1])){o.push(e[1]),n=!0;break}}if(n)break}}return n||o.push(e[1]),o}for(o=[],i=0;i<this.KnotVec.length-1;i++){s=this.KnotVec[i].knotValue,a=this.KnotVec[i+1].knotValue;o.push(s);var l;for(c=(a-s)/((l=this.Degree*t)+1),h=1;h<=l;h++)o.push(s+h*c)}return o.push(this.GetLastKnot()),o},s.prototype.Dump=function(t){console.log("var geo"+t+"; // NURBS"),console.log("{"),console.log("  var nDeg = "+this.Degree+";"),console.log("  var nCPs = [];");for(var e=0;e<this.CPs.length;e++)console.log("  nCPs.push(new DSMath.Point("+this.CPs[e].getArray()+")); // CP-"+e);console.log("  var nW = [];");for(e=0;e<this.CPs.length;e++)console.log("  nW.push("+this.Weights[e]+"); // weight-"+e);console.log("  var nKnot = [];");for(var r=0;r<this.KnotVec.length;r++)console.log("  nKnot.push({ knotValue: "+this.KnotVec[r].knotValue+", knotMult: "+this.KnotVec[r].knotMult+"});");console.log("  geo"+t+" = new DSMath.NurbsCurve(nKnot, nCPs, nW, nDeg);"),console.log("  geo"+t+"._VERSION = "+this._VERSION+";"),console.log("} // end of NURBS creation")},s.prototype.UpdateDegree=function(t){!0===this.IsClosed&&(this.Degree=t)},s.prototype.putInPrincipalRange=function(t){if(!1===this.IsClosed)return t;if(t>=this.GetFirstKnot()&&t<this.GetLastKnot())return t;var e=this.GetLastKnot()-this.GetFirstKnot();return t-Math.floor((t-this.GetFirstKnot())/e)*e},s.prototype.setData=function(e,r,n,o,i){t.TypeCheck(e,!0,[Object],[]),t.TypeCheck(r,!0,[t.Point],[]),t.TypeCheck(n,!0,["number"],[]),t.TypeCheck(o,!0,"number"),this.OK=!0;for(var s=0,a=0;a<e.length;a++)s+=e[a].knotMult;var c=i||!1;if(c?s!=r.length+1&&(this.OK=!1):s!=r.length+1+o&&(this.OK=!1),n.length>0&&n.length!=r.length&&(this.OK=!1),!1===this.OK)return this;if(this.IsClosed=c,this.Degree=o,this.KnotVec=[],!0===this.IsClosed){var h=e[1].knotValue-e[0].knotValue;this.KnotVec.push({knotValue:e[0].knotValue-2*h,knotMult:1}),this.KnotVec.push({knotValue:e[0].knotValue-h,knotMult:1})}for(a=0;a<e.length;a++)this.KnotVec.push({knotValue:e[a].knotValue,knotMult:e[a].knotMult});if(!0===this.IsClosed){h=e[e.length-1].knotValue-e[e.length-2].knotValue;this.KnotVec.push({knotValue:e[e.length-1].knotValue+h,knotMult:1}),this.KnotVec.push({knotValue:e[e.length-1].knotValue+2*h,knotMult:1})}this.KnotVecFull=[];for(a=0;a<this.KnotVec.length;a++)for(var p=0;p<this.KnotVec[a].knotMult;p++)this.KnotVecFull.push(this.KnotVec[a].knotValue);if(this.CPs=[],this.Weights=[],0==n.length)for(a=0;a<r.length;a++)n.push(1);for(a=0;a<r.length;a++)this.CPs.push(r[a].clone()),this.Weights.push(n[a]);if(!0===c)for(a=0;a<this.Degree;a++)this.CPs.push(r[a].clone()),this.Weights.push(n[a]);return this._VERSION>=5&&!1===c&&this.ComputePolynomialCache(),this},s.prototype.ComputePolynomialCache=function(){this.PolyCache=[];for(var t=this.KnotVec.length-1,e=0,r=0;r<t;r++){if(this._DEBUG>=3){console.log(""),console.log("Basis functions for arc-"+r+" ["+this.KnotVec[r].knotValue+", "+this.KnotVec[r+1].knotValue+"]");for(var n=0;n<this.CPs.length;n++)for(var o=1;o<=this.Degree;o++){var i=this.KnotVecFull[n],s=(this.KnotVecFull[n+o],this.KnotVecFull[n+1]),a=this.KnotVecFull[n+o+1];console.log("  N_"+n+"_"+o+":"),console.log("     (u - "+i+") / ("+s+" - "+i+" * N_"+n+"_"+(o-1)),console.log("   + ("+a+" - u) / ("+a+" - "+s+" * N_"+(n+1)+"_"+(o-1))}}for(var c=[],h=0;h<this.Degree+1;h++){var p=this.ComputePolyCoefs(r,e+h,this.Degree);c.push(p)}this.PolyCache.push(c),e+=this.KnotVec[r+1].knotMult}},s.prototype.FindFullKnotIndex=function(e){if(t.TypeCheckInternal(e,!0,"number"),2==this.KnotVec.length)return this.KnotVec[0].knotMult;for(var r=[0,this.KnotVec.length-1];r[1]-r[0]>1;){var n=r[0]+Math.floor((r[1]-r[0])/2);e<this.KnotVec[n].knotValue?r[1]=n:e>=this.KnotVec[n+1].knotValue?r[0]=n:(r[0]=n,r[1]=n+1)}for(var o=0,i=0;i<=r[0];i++)o+=this.KnotVec[i].knotMult;return o},s.prototype.GetPolyShift=function(t){return.5*(this.KnotVec[t].knotValue+this.KnotVec[t+1].knotValue)},s.prototype.GetPolyScale=function(t){return.5*(this.KnotVec[t+1].knotValue-this.KnotVec[t].knotValue)},s.prototype.ComputePolyCoefs=function(e,r,n){t.TypeCheckInternal(e,!0,"number"),t.TypeCheckInternal(r,!0,"number"),t.TypeCheckInternal(n,!0,"number");for(var o=[],i=0;i<=n;i++)o.push(0);if(0==n){for(var s=!1,a=0,c=0;c<=e;c++)a+=this.KnotVec[c].knotMult;return a-1===r&&(s=!0),!0===s&&(o[0]=1),this._DEBUG>=3&&console.log("N_"+r+"_"+n+": "+o[0]),o}var h=this.KnotVecFull[r],p=this.KnotVecFull[r+n],l=[0,0];if(p-h>0){l[0]=-h/(p-h),l[1]=1/(p-h),1===this._ScalePoly&&(l[0]+=this.GetPolyShift(e)/(p-h),l[1]*=this.GetPolyScale(e));var u=this.ComputePolyCoefs(e,r,n-1);for(i=0;i<u.length;i++)o[i]+=l[0]*u[i],o[i+1]+=l[1]*u[i]}var y=this.KnotVecFull[r+1],m=this.KnotVecFull[r+n+1],f=[0,0];if(m-y>0){f[0]=m/(m-y),f[1]=-1/(m-y),1===this._ScalePoly&&(f[0]-=this.GetPolyShift(e)/(m-y),f[1]*=this.GetPolyScale(e)),u=this.ComputePolyCoefs(e,r+1,n-1);for(i=0;i<u.length;i++)o[i]+=f[0]*u[i],o[i+1]+=f[1]*u[i]}return this._DEBUG>=3&&(console.log("N_"+r+"_"+n+": "),console.log("   ("+l[0]+" + "+l[1]+"*u) * N_"+r+"_"+(n-1)),console.log(" + ("+f[0]+" + "+f[1]+"*u) * N_"+(r+1)+"_"+(n-1))),o},s.prototype.clone=function(){return(new s).copy(this)},s.prototype.copy=function(e){return t.TypeCheck(e,!0,t.NurbsCurve),!1===e.OK?(this.OK=!1,this):(this.setData(e.KnotVec,e.CPs,e.Weights,e.Degree),this)},s.prototype.evalPoint=function(e){t.TypeCheck(e,!0,"number"),this._DEBUG_NUM_EVAL++,this._DEBUG>=1&&console.log("NurbsCurve evalPoint at "+e),e=this.putInPrincipalRange(e),this._DEBUG>=1&&!0===this.IsClosed&&console.log("  periodic NURBS --\x3e evaluate at "+e);var r=[0,this.CPs.length-1];this._VERSION>=4&&!1===this.IsClosed&&(r=this.FindRangeActiveCP(e));var n=new t.Point,o=0;if(null!==this.PolyCache)for(var i=this.FindArcIndex(e),s=r[1]-r[0],a=0;a<=s;a++){var c=r[0]+a;this._DEBUG>=2&&console.log("  Compute contribution from CP["+c+"] at: ("+this.CPs[c].getArray()+")");var h=this.Weights[c]*this.EvalPolynomial(e,i,a);this._DEBUG>=2&&console.log("  --\x3e weighted contribution of "+h),n.addScaledPoint(this.CPs[c],h),o+=h}else for(a=r[0];a<=r[1];a++){this._DEBUG>=2&&console.log("  Compute contribution from CP["+a+"] at: ("+this.CPs[a].getArray()+")");var p=this.Weights[a]*this.EvalBasisFunction(e,a,this.Degree);this._DEBUG>=2&&console.log("  --\x3e weighted contribution of "+p),n.addScaledPoint(this.CPs[a],p),o+=p}var l=this.ComputePoint(n,o);return this._DEBUG>=1&&console.log("NurbsCurve evalPoint at "+e+" --\x3e "+l.getArray()),l},s.prototype.evalFirstDeriv=function(e){t.TypeCheck(e,!0,"number"),this._DEBUG>=1&&console.log("NurbsCurve evalFirstDeriv at "+e),e=this.putInPrincipalRange(e),this._DEBUG>=1&&!0===this.IsClosed&&console.log("  periodic NURBS --\x3e evaluate at "+e);var r=[0,this.CPs.length-1];this._VERSION>=4&&!1===this.IsClosed&&(r=this.FindRangeActiveCP(e));var n=new t.Point,o=new t.Point,i=0,s=0;if(null!==this.PolyCache)for(var a=this.FindArcIndex(e),c=r[1]-r[0],h=0;h<=c;h++){var p=r[0]+h;this._DEBUG>=2&&console.log("  Compute contribution from CP["+p+"] at: ("+this.CPs[p].getArray()+")");var l=this.Weights[p]*this.EvalPolynomial(e,a,h),u=this.Weights[p]*this.EvalPolynomialFirstDeriv(e,a,h);this._DEBUG>=2&&(console.log("  --\x3e weighted contribution (term ) of "+l),console.log("  --\x3e weighted contribution (deriv) of "+u)),n.addScaledPoint(this.CPs[p],l),o.addScaledPoint(this.CPs[p],u),i+=l,s+=u}else for(h=r[0];h<=r[1];h++){this._DEBUG>=2&&console.log("  Compute contribution from CP["+h+"] at: ("+this.CPs[h].getArray()+")");l=this.Weights[h]*this.EvalBasisFunction(e,h,this.Degree),u=this.Weights[h]*this.EvalBasisFunctionFirstDeriv(e,h,this.Degree);this._DEBUG>=2&&(console.log("  --\x3e weighted contribution (term ) of "+l),console.log("  --\x3e weighted contribution (deriv) of "+u)),n.addScaledPoint(this.CPs[h],l),o.addScaledPoint(this.CPs[h],u),i+=l,s+=u}var y=this.ComputeFirstDeriv(n,o,i,s);return this._DEBUG>=1&&console.log("NurbsCurve evalFirstDeriv at "+e+" --\x3e "+y.getArray()),y},s.prototype.evalSecondDeriv=function(e){t.TypeCheck(e,!0,"number"),this._DEBUG>=1&&console.log("NurbsCurve evalSecondDeriv at "+e),e=this.putInPrincipalRange(e),this._DEBUG>=1&&!0===this.IsClosed&&console.log("  periodic NURBS --\x3e evaluate at "+e);var r=[0,this.CPs.length-1];this._VERSION>=4&&!1===this.IsClosed&&(r=this.FindRangeActiveCP(e));var n=new t.Point,o=new t.Point,i=new t.Point,s=0,a=0,c=0;if(null!==this.PolyCache)for(var h=this.FindArcIndex(e),p=r[1]-r[0],l=0;l<=p;l++){var u=r[0]+l;this._DEBUG>=2&&console.log("  Compute contribution from CP["+u+"] at: ("+this.CPs[u].getArray()+")");var y=this.Weights[u]*this.EvalPolynomial(e,h,l),m=this.Weights[u]*this.EvalPolynomialFirstDeriv(e,h,l),f=this.Weights[u]*this.EvalPolynomialSecondDeriv(e,h,l);this._DEBUG>=2&&(console.log("  --\x3e weighted contribution (term )   of "+y),console.log("  --\x3e weighted contribution (deriv-1) of "+m),console.log("  --\x3e weighted contribution (deriv-2) of "+f)),n.addScaledPoint(this.CPs[u],y),o.addScaledPoint(this.CPs[u],m),i.addScaledPoint(this.CPs[u],f),s+=y,a+=m,c+=f}else for(l=r[0];l<=r[1];l++){this._DEBUG>=2&&console.log("  Compute contribution from CP["+l+"] at: ("+this.CPs[l].getArray()+")");y=this.Weights[l]*this.EvalBasisFunction(e,l,this.Degree),m=this.Weights[l]*this.EvalBasisFunctionFirstDeriv(e,l,this.Degree),f=this.Weights[l]*this.EvalBasisFunctionSecondDeriv(e,l,this.Degree);this._DEBUG>=2&&(console.log("  --\x3e weighted contribution (term )   of "+y),console.log("  --\x3e weighted contribution (deriv-1) of "+m),console.log("  --\x3e weighted contribution (deriv-2) of "+f)),n.addScaledPoint(this.CPs[l],y),o.addScaledPoint(this.CPs[l],m),i.addScaledPoint(this.CPs[l],f),s+=y,a+=m,c+=f}var v=this.ComputeSecondDeriv(n,o,i,s,a,c);return this._DEBUG>=1&&console.log("NurbsCurve evalSecondDeriv at "+e+" --\x3e "+v.getArray()),v},s.prototype.ComputePoint=function(e,r){return t.TypeCheck(e,!0,t.Point),t.TypeCheck(r,!0,"number"),e.clone().divideScalar(r)},s.prototype.ComputeFirstDeriv=function(e,r,n,o){t.TypeCheck(e,!0,t.Point),t.TypeCheck(r,!0,t.Point),t.TypeCheck(n,!0,"number"),t.TypeCheck(o,!0,"number");var i=this.ComputePoint(e,n),s=r.clone().divideScalar(n),a=i.multiplyScalar(o/n);return s.sub(a)},s.prototype.ComputeSecondDeriv=function(e,r,n,o,i,s){t.TypeCheck(e,!0,t.Point),t.TypeCheck(r,!0,t.Point),t.TypeCheck(n,!0,t.Point),t.TypeCheck(o,!0,"number"),t.TypeCheck(i,!0,"number"),t.TypeCheck(s,!0,"number");var a=this.ComputePoint(e,o),c=this.ComputeFirstDeriv(e,r,o,i),h=n.clone().subScaledVector(c,2*i).sub(a.multiplyScalar(s));return h.divideScalar(o),h},s.prototype.FindDiscontinuties=function(t){var e=[];if(!1===this.OK)return e;var r=1,n=this.KnotVec.length-1;!0===this.IsClosed&&(r+=this.Degree-1,n-=this.Degree-1);for(var o=r;o<n;o++)this.Degree-this.KnotVec[o].knotMult<t&&e.push(o);return e},s.prototype.getParam=function(e,r,n,o){var i=o||1e-13,s=[];if(this.evalPoint(r).distanceTo(e)<=i&&s.push(r),this.evalPoint(n).distanceTo(e)<=i&&s.push(n),0==s.length){var a=new t.MinDistPtCrv(this,[r,n],e),c=a.Run();if(!0===a.hasSol)this.evalPoint(c).distanceTo(e)<=i&&s.push(c)}return s},s.prototype.arcLength=function(t,e){for(var r=0,n=0,o=0;o<this.CPs.length-1;o++)n+=this.CPs[o].distanceTo(this.CPs[o+1]);var i=.001*(this.GetLastKnot()-this.GetFirstKnot())/n,s=Math.ceil((e-t)/i);i=(e-t)/s;for(var a=this.evalPoint(t),c=1;c<=s;c++){var h=t+c*i,p=this.evalPoint(h);r+=a.distanceTo(p),a.copy(p)}return r},s.prototype.selfIntersections=function(){for(var e=[],r=0;r<this.KnotVec.length-2;r++)for(var n=[this.KnotVec[r].knotValue,this.KnotVec[r+1].knotValue],o=r+1;o<this.KnotVec.length-1;o++)for(var i=[this.KnotVec[o].knotValue,this.KnotVec[o+1].knotValue],s=new t.Intersect(this,this,n[0],n[1],i[0],i[1]),a=s.Run(),c=0;c<a.length;c++)s._VERSION>=3?Math.abs(a[c][0]-a[c][1])>s.tolLength&&e.push(new t.Point2D(a[c][0],a[c][1])):Math.abs(a[c].x-a[c].y)>s.tolLength&&e.push(new t.Point2D(a[c].x,a[c].y));return e},s.prototype.ComputePolyline=function(){for(var e=[],r=0;r<this.CPs.length-1;r++){var n=new t.Vector3D;this.CPs[r+1].sub(this.CPs[r],n),e.push(new t.Line(this.CPs[r],n))}return e},t.NurbsCurve=s,s}),define("MathematicsES/MathNurbsCurveJSImpl",["DS/MathematicsES/MathNurbsCurveJSImpl"],function(t){return t}),define("DS/MathematicsES/MathPlaneJSImpl",["DS/MathematicsES/MathNameSpace","DS/MathematicsES/MathTypeCheck","DS/MathematicsES/MathTypeCheckInternal","DS/MathematicsES/MathLineJSImpl","DS/MathematicsES/MathPointJSImpl","DS/MathematicsES/MathVector3DJSImpl"],function(t,e,r,n,o,i){"use strict";var s=function(e,r,n){t.TypeCheck(e,!1,t.Point),t.TypeCheck(r,!1,t.Vector3D),t.TypeCheck(n,!1,t.Vector3D),this.origin=e?e.clone():new o(0,0,0);var s=new Array(2);s[0]=r?r.clone():new i(1,0,0),s[1]=n?n.clone():new i(0,1,0),(r||n)&&i.orthoNormalize(s[0],s[1]),this.getDirectionsNotCloned=function(){return s}};return s.prototype.origin=null,s.prototype.clone=function(){var t=new s;return t.copy(this),t},s.prototype.copy=function(e){t.TypeCheck(e,!1,t.Plane);var r=this.getDirectionsNotCloned(),n=e.getDirectionsNotCloned();r[0].copy(n[0]),r[1].copy(n[1]),this.origin.copy(e.origin)},s.prototype.setOrigin=function(e,r,n){return t.TypeCheck(e,!0,["number",t.Point]),t.TypeCheck(r,!1,"number"),t.TypeCheck(n,!1,"number"),e.constructor===o?this.origin.copy(e):this.origin.set(e,r||0,n||0),this},s.prototype.setVectors=function(e,r){t.TypeCheck(e,!0,[t.Vector3D,"number"]),t.TypeCheck(r,!1,[t.Vector3D,"number"]),t.TypeCheck(arguments[2],!1,"number"),t.TypeCheck(arguments[3],!1,"number"),t.TypeCheck(arguments[4],!1,"number"),t.TypeCheck(arguments[5],!1,"number");var n=this.getDirectionsNotCloned();return n[0]=e.constructor===i?n[0].copy(e):n[0].set(arguments[0],arguments[1]||0,arguments[2]||0),n[1]=r.constructor===i?n[1].copy(r):n[1].set(arguments[3]||0,arguments[4]||0,arguments[5]||0),i.orthoNormalize(n[0],n[1]),this},s.prototype.setNormal=function(e,r,n){t.TypeCheck(e,!0,["number",t.Vector3D]),t.TypeCheck(r,!1,"number"),t.TypeCheck(n,!1,"number");var o=this.getDirectionsNotCloned();e.constructor===i?o[0].copy(e):o[0].set(e,r,n);var s=o[0].squareNorm();return o[1].copy(o[0]).cross(t.Vector3D.xVect),o[1].squareNorm()<t.defaultTolerances.epsgForSquareAngleTest*s&&o[1].copy(o[0]).cross(t.Vector3D.yVect),o[1].normalize(),o[0].cross(o[1]).multiplyScalar(-1).normalize(),this},s.prototype.makeFromPoints=function(e,r,n){t.TypeCheck(e,!0,t.Point),t.TypeCheck(r,!0,t.Point),t.TypeCheck(n,!0,t.Point),this.origin=e;var o=r.sub(e),i=n.sub(e);return this.setVectors(o,i),this},s.prototype.getDirections=function(e){t.TypeCheck(e,!1,[t.Vector3D],2);var r=this.getDirectionsNotCloned();return arguments.length<1?new Array(r[0].clone(),r[1].clone()):(e[0].copy(r[0]),e[1].copy(r[1]),e)},s.prototype.getNormal=function(e){t.TypeCheck(e,!1,t.Vector3D);var r=this.getDirectionsNotCloned();return(e=e?e.copy(r[0]):r[0].clone()).cross(r[1]),e},s.prototype.evalPoint=function(e,r,n){t.TypeCheck(e,!0,"number"),t.TypeCheck(r,!0,"number"),t.TypeCheck(n,!1,t.Point);var o=this.getDirectionsNotCloned();return(n=n?n.copy(this.origin):this.origin.clone()).addScaledVector(o[0],e).addScaledVector(o[1],r),n},s.prototype.intersectLine=function(e,r){t.TypeCheck(e,!0,t.Line),t.TypeCheck(r,!1,"number");var n={paramOnLine:0,param1OnPlane:0,param2OnPlane:0,diag:-1};r=r||t.defaultTolerances.epsgForRelativeTest;var o=this.getDirectionsNotCloned(),i=e.direction,s=e.scale,a=this.getNormal(),c=e.origin.sub(this.origin),h=Math.abs(c.dot(a)),p=i.dot(a)/s;return p*p>t.defaultTolerances.epsilonForSquareRelativeTest?(n.paramOnLine=-h/p/s,n.param1OnPlane=c.dot(o[0])+i.dot(o[0])*n.paramOnLine,n.param2OnPlane=c.dot(o[1])+i.dot(o[1])*n.paramOnLine,n.diag=0):n.diag=h<r?1:-1,n},s.prototype.applyTransformation=function(e){t.TypeCheck(e,!0,t.Transformation);var r=this.getDirectionsNotCloned();return this.origin.applyTransformation(e),r[0].applyTransformation(e),r[1].applyTransformation(e),e.matrix.isAnIsometry()||this.setVectors(r[0],r[1]),this},t.Plane=s,s}),define("MathematicsES/MathPlaneJSImpl",["DS/MathematicsES/MathPlaneJSImpl"],function(t){return t}),define("DS/MathematicsES/MathCircleJSImpl",["DS/MathematicsES/MathNameSpace","DS/MathematicsES/MathTypeCheck","DS/MathematicsES/MathTypeCheckInternal","DS/MathematicsES/MathPointJSImpl","DS/MathematicsES/MathVector2DJSImpl","DS/MathematicsES/MathVector3DJSImpl","DS/MathematicsES/MathLineJSImpl","DS/MathematicsES/MathPlaneJSImpl","DS/MathematicsES/MathBoxJSImpl"],function(t,e,r,n,o,i,s,a,c){"use strict";var h=function(e,r,o,s,a,c){t.TypeCheck(e,!1,"number"),t.TypeCheck(r,!1,"number"),t.TypeCheck(o,!1,t.Point),t.TypeCheck(s,!1,t.Vector3D),t.TypeCheck(a,!1,t.Vector3D),t.TypeCheck(c,!1,"number"),this.center=o?o.clone():new n,this.radius=e||1,this.shift=c||0,this.scale=r||1;var h=new Array(2);h[0]=s?s.clone():new i(1,0,0),h[1]=a?a.clone():new i(0,1,0),(s||a)&&i.orthoNormalize(h[0],h[1]),this.getDirectionsNotCloned=function(){return h}};return h.prototype.center=null,h.prototype.radius=null,h.prototype.shift=null,h.prototype.scale=null,h.prototype._VERSION=1,h.prototype.putInRange=function(e,r){t.TypeCheckInternal(e,!0,"number"),t.TypeCheckInternal(r,!0,["number"],2);var n=e;if(n<r[0]||n>r[1]){var o=e-Math.floor((n-r[0])/t.constants.PI2)*t.constants.PI2;o>=r[0]&&o<=r[1]&&(n=o)}return n},h.prototype.computePrincipleRange=function(e,r){if(t.TypeCheckInternal(e,!0,["number"],2),t.TypeCheckInternal(r,!0,[]),r[0]=[e[0],e[1]],r[0][1]-r[0][0]>=t.constants.PI2)r[0][0]=0,r[0][1]=t.constants.PI2;else if(r[0][1]>t.constants.PI2){if(r[0][0]>t.constants.PI2){var n=Math.floor(r[0][0]/t.constants.PI2);r[0][0]=r[0][0]-n*t.constants.PI2,r[0][1]=r[0][1]-n*t.constants.PI2}r[0][1]>t.constants.PI2&&(r[1]=[0,r[0][1]-t.constants.PI2],r[0][1]=t.constants.PI2)}else if(r[0][0]<0){if(r[0][1]<0){n=Math.floor(r[0][1]/t.constants.PI2);r[0][0]=r[0][0]-n*t.constants.PI2,r[0][1]=r[0][1]-n*t.constants.PI2}r[0][0]<0&&(r[1]=[r[0][0]+t.constants.PI2,t.constants.PI2],r[0][0]=0)}},h.prototype.IsInfinite=function(){return!0},h.prototype.IsPeriodic=function(){return!0},h.prototype.GetPeriodicRange=function(){return[0,t.constants.PI2]},h.prototype.GetDegree=function(){return 2},h.prototype.clone=function(){return(new h).copy(this)},h.prototype.copy=function(e){t.TypeCheck(e,!0,t.Circle),this.center.copy(e.center),this.radius=e.radius,this.shift=e.shift,this.scale=e.scale;var r=this.getDirectionsNotCloned(),n=e.getDirectionsNotCloned();return r[0].copy(n[0]),r[1].copy(n[1]),this},h.prototype.setCenter=function(e,r,o){return t.TypeCheck(e,!0,["number",t.Point]),t.TypeCheck(r,!1,"number"),t.TypeCheck(o,!1,"number"),e.constructor===n?this.center.copy(e):this.center.set(e,r||0,o||0),this},h.prototype.setVectors=function(e,r){return t.TypeCheck(e,!0,[t.Vector3D,"number"]),t.TypeCheck(r,!1,[t.Vector3D,"number"]),t.TypeCheck(arguments[2],!1,"number"),t.TypeCheck(arguments[3],!1,"number"),t.TypeCheck(arguments[4],!1,"number"),t.TypeCheck(arguments[5],!1,"number"),a.prototype.setVectors.apply(this,arguments),this},h.prototype.setRadius=function(e){return t.TypeCheck(e,!1,"number"),this.radius=e||1,this},h.prototype.setScale=function(e){return t.TypeCheck(e,!1,"number"),this.scale=e||1,this},h.prototype.setShift=function(e){return t.TypeCheck(e,!1,"number"),this.shift=e||0,this},h.prototype.getDirections=function(e){return t.TypeCheck(e,!1,[t.Vector3D],2),a.prototype.getDirections.apply(this,arguments)},h.prototype.evalPoint=function(e){t.TypeCheck(e,!0,"number");var r=e*this.scale+this.shift,n=Math.cos(r),o=Math.sin(r),i=this.getDirectionsNotCloned(),s=new t.Point;return s.x=this.center.x+this.radius*(n*i[0].x+o*i[1].x),s.y=this.center.y+this.radius*(n*i[0].y+o*i[1].y),s.z=this.center.z+this.radius*(n*i[0].z+o*i[1].z),s},h.prototype.evalFirstDeriv=function(e){t.TypeCheck(e,!0,"number");var r=e*this.scale+this.shift,n=Math.cos(r),o=Math.sin(r),i=this.getDirectionsNotCloned(),s=new t.Vector3D;return s.x=this.radius*(-o*i[0].x+n*i[1].x),s.y=this.radius*(-o*i[0].y+n*i[1].y),s.z=this.radius*(-o*i[0].z+n*i[1].z),s},h.prototype.evalSecondDeriv=function(e){t.TypeCheck(e,!0,"number");var r=e*this.scale+this.shift,n=Math.cos(r),o=Math.sin(r),i=this.getDirectionsNotCloned(),s=new t.Vector3D;return s.x=this.radius*(-n*i[0].x-o*i[1].x),s.y=this.radius*(-n*i[0].y-o*i[1].y),s.z=this.radius*(-n*i[0].z-o*i[1].z),s},h.prototype.eval=function(e,r,n){t.TypeCheck(e,!0,"number"),t.TypeCheck(r,!1,t.Point),t.TypeCheck(n,!1,t.Vector2D);var o=e*this.scale+this.shift,i=Math.cos(o),s=Math.sin(o);if(n&&n.set(this.radius*i,this.radius*s),r){var a=this.getDirectionsNotCloned();r.x=this.center.x+this.radius*(i*a[0].x+s*a[1].x),r.y=this.center.y+this.radius*(i*a[0].y+s*a[1].y),r.z=this.center.z+this.radius*(i*a[0].z+s*a[1].z)}},h.prototype.GetBox=function(e){t.TypeCheck(e,!0,["number"],2);var r=new t.Box;r.Update(this.evalPoint(e[0])),r.Update(this.evalPoint(e[1]));for(var n=this.getDirectionsNotCloned(),o=n[0].getArray(),i=n[1].getArray(),s=[],a=0;a<3;a++){var c=Math.atan2(i[a],o[a]);c>=0?(s.push(c),s.push(c+t.constants.PI)):(s.push(c+t.constants.PI),s.push(c+t.constants.PI2))}var h=[];this._VERSION>=1?this.computePrincipleRange(e,h):h[0]=[e[0],e[1]];for(var p=0;p<s.length;p++)for(var l=0;l<h.length;l++)h[l][0]<=s[p]&&s[p]<=h[l][1]&&r.Update(this.evalPoint(s[p]));return r},h.prototype.Dump=function(t){console.log("var geo"+t+"; // circle"),console.log("{"),console.log("  var cCen = new DSMath.Point("+this.center.getArray()+");");var e=this.getDirectionsNotCloned();console.log("  var cDirX = new DSMath.Vector3D("+e[0].getArray()+");"),console.log("  var cDirY = new DSMath.Vector3D("+e[1].getArray()+");"),console.log("  var cRad = "+this.radius+";"),console.log("  geo"+t+" = new DSMath.Circle(cRad).setCenter(cCen).setVectors(cDirX, cDirY);"),console.log("} // end of circle creation")},h.prototype.applyTransformation=function(e){t.TypeCheck(e,!0,t.Transformation);var r=e.getScaling();if(r.scale>0){var n=this.getDirectionsNotCloned();this.center.applyTransformation(e),n[0].applyTransformation(e).normalize(),n[1].applyTransformation(e).normalize(),this.radius*=r.scale}return this},h.prototype.getParam=function(e,r,n,i){t.TypeCheck(e,!0,t.Point),t.TypeCheck(r,!0,"number"),t.TypeCheck(n,!0,"number"),t.TypeCheck(i,!1,"number");var s=[],a=this.getDirectionsNotCloned(),c=Math.min(i,t.defaultTolerances.epsgForRelativeTest*this.radius),h=e.sub(this.center),p=new o;if(p.set(h.dot(a[0]),h.dot(a[1])),p.squareNorm()<c*c)return s;var l=1*(Math.atan2(p.y,p.x)-this.shift)/this.scale,u=this.evalPoint(l);if(u.squareDistanceTo(e)>i*i)return s;var y=u,m=new o;this.eval(r,y,m);var f=y.squareDistanceTo(e)<i*i&&m.cross(p)<c,v=y,g=m;this.eval(n,v,g);var C=v.squareDistanceTo(e)<i*i&&g.cross(p)>-c;if(f&&(s[0]=r),C&&(s[s.length]=n),!f&&!C){var D=2*Math.PI/Math.abs(this.scale),T=Math.floor(r/D);l+=l>0?T*D:(T+1)*D,(l+=l<r?D:0)>=r*(1-t.defaultTolerances.epsgForRelativeTest)&&l<=n*(1+t.defaultTolerances.epsgForRelativeTest)&&(s[0]=l)}return s},h.prototype.intersectLine=function(e,r,n,o,s,a){t.TypeCheck(e,!0,t.Line),t.TypeCheck(r,!0,"number"),t.TypeCheck(n,!0,"number"),t.TypeCheck(o,!0,"number"),t.TypeCheck(s,!0,"number"),t.TypeCheck(a,!0,"number");var c=[],h=t.defaultTolerances.epsgForRelativeTest,p=e.clone();p.direction.normalize();var l=p.direction.dot(e.direction);r*=l,n*=l;var u=this.getDirectionsNotCloned(),y=[],m=i.cross(u[0],u[1]),f=this.center.sub(e.origin),v=f.dot(p.direction),g=p.evalPoint(v),C=this.center.sub(g,f),D=C.dot(m),T=p.direction.dot(m);if(Math.abs(T)<h&&Math.abs(D)<a*(1+h)){var S=this.radius*this.radius+D*D-C.squareNorm();S>0?(y[0]=Math.sqrt(S),y[1]=-y[0]):y[0]=0}else Math.abs(T)>h&&(y[0]=D/T);for(var d=0;d<y.length;d++){y[d]+=v,y[d]<r?y[d]=r:y[d]>n&&(y[d]=n);var M=p.evalPoint(y[d]),k=M.sub(this.center,C),b=(Math.atan2(k.dot(u[1]),k.dot(u[0]))-this.shift)/this.scale,x=t.constants.PI2/Math.abs(this.scale),I=b<0?Math.floor(o/x)+1:Math.floor(o/x);if(b+I*x<o){var P=o-(b+I*x);b=(E=s-(b+(I+1)*x))>=0?b+(I+1)*x:P<=-E?o:s}else if(b+I*x>s){var E=b+I*x-s;b=(P=b+(I-1)*x-o)>=0?b+(I-1)*x:-P<E?o:s}else b+=I*x;var V=this.evalPoint(b);M.sub(V,k).squareNorm()<a*a&&(c[c.length]={paramCircle:b,paramLine:y[d]/l})}return c},h.prototype.intersectCircle=function(e,r,n,o,s,a){t.TypeCheck(e,!0,t.Circle),t.TypeCheck(r,!0,"number"),t.TypeCheck(n,!0,"number"),t.TypeCheck(o,!0,"number"),t.TypeCheck(s,!0,"number"),t.TypeCheck(a,!0,"number");var c=[],h=t.defaultTolerances.epsgForRelativeTest,p=h*h*Math.max(this.center.squareDistanceToOrigin(),e.center.squareDistanceToOrigin(),1),l=e.center.sub(this.center),u=(l.squareNorm(),this.getDirectionsNotCloned()),y=e.getDirectionsNotCloned(),m=i.cross(u[0],u[1]),f=i.cross(y[0],y[1]),v=i.cross(m,f),g=v.squareNorm(),C=void 0,D=void 0,T=0;if(g<h){var S=l.dot(m),d=i.multiplyScalar(m,S),M=(d=i.sub(l,d,d)).squareNorm(),k=this.radius+e.radius+a,b=Math.abs(this.radius-e.radius)-a;if(M<b*b||k*k<M||S>a)return 0;if(M>p){var x=this.radius+e.radius-a;if(x*x<M&&M<k*k){var I=d.norm();d.multiplyScalar(this.radius/I),C=t.Point.addVector(this.center,d),T=1}else{var P=.5*(1+(this.radius*this.radius-e.radius*e.radius)/M),E=this.radius*this.radius-P*P*M;if(T=1,E>0){var V=i.cross(m,d);E=Math.sqrt(E/M),D=i.multiplyScalar(V,E,V),T+=1}d.multiplyScalar(P),C=t.Point.addVector(this.center,d)}}}else{var _=l.dot(f);P=this.radius*this.radius-_*_/g;(V=i.cross(m,v)).multiplyScalar(-_/g),C=t.Point.addVector(this.center,V),T=1,P>p&&(D=v.multiplyScalar(Math.sqrt(P)),T+=1)}for(var w,N,z=t.constants.PI2/Math.abs(this.scale),R=t.constants.PI2/Math.abs(e.scale),O=0;O<T;O++){1==O&&D.multiplyScalar(-1);var F=1==T?C:t.Point.addVector(C,D),A=F.sub(this.center,l),G=(Math.atan2(A.dot(u[1]),A.dot(u[0]))-this.shift)/this.scale,U=G<0?Math.floor(o/z)+1:Math.floor(o/z);if(G+U*z<o){var L=o-(G+U*z);G=(B=s-(G+(U+1)*z))>=0?G+(U+1)*z:L<=-B?o:s}else if(G+U*z>s){var B=G+U*z-s;G=(L=G+(U-1)*z-o)>=0?G+(U-1)*z:-L<B?o:s}else G+=U*z;w=this.evalPoint(G);var J=F.sub(e.center,A),K=(Math.atan2(J.dot(y[1]),A.dot(y[0]))-e.shift)/e.scale,q=K<0?Math.floor(r/R)+1:Math.floor(r/R);if(K+q*R<r){L=r-(K+q*R);K=(B=n-(K+(q+1)*R))>=0?K+(q+1)*R:L<=-B?r:n}else if(K+q*R>n){B=K+q*R-n;K=(L=K+(q-1)*R-r)>=0?K+(q-1)*R:-L<B?r:n}else K+=q*R;N=e.evalPoint(K),w.squareDistanceTo(N)<a*a&&(c[c.length]={paramCircle:G,paramOtherCircle:K})}return c},t.Circle=h,h}),define("MathematicsES/MathCircleJSImpl",["DS/MathematicsES/MathCircleJSImpl"],function(t){return t}),define("DS/MathematicsES/MathEllipseJSImpl",["DS/MathematicsES/MathNameSpace","DS/MathematicsES/MathTypeCheck","DS/MathematicsES/MathTypeCheckInternal","DS/MathematicsES/MathPointJSImpl","DS/MathematicsES/MathPoint2DJSImpl","DS/MathematicsES/MathVector2DJSImpl","DS/MathematicsES/MathVector3DJSImpl","DS/MathematicsES/MathLineJSImpl","DS/MathematicsES/MathCircleJSImpl","DS/MathematicsES/MathPlaneJSImpl","DS/MathematicsES/MathBoxJSImpl"],function(t,e,r,n,o,i,s,a,c,h,p){"use strict";var l=function(e,r,o,i,a,c,h){t.TypeCheck(e,!1,"number"),t.TypeCheck(r,!1,"number"),t.TypeCheck(o,!1,t.Point),t.TypeCheck(i,!1,t.Vector3D),t.TypeCheck(a,!1,t.Vector3D),t.TypeCheck(c,!1,"number"),t.TypeCheck(h,!1,"number"),this.center=o?o.clone():new n,this.radiusMaj=e||1,this.radiusMin=r||1,this.shift=h||0,this.scale=c||1;var p=new Array(2);p[0]=i?i.clone():new s(1,0,0),p[1]=a?a.clone():new s(0,1,0),(i||a)&&s.orthoNormalize(p[0],p[1]),this.getDirectionsNotCloned=function(){return p}};return l.prototype.center=null,l.prototype.radiusMaj=null,l.prototype.radiusMin=null,l.prototype.shift=null,l.prototype.scale=null,l.prototype._VERSION=1,l.prototype.EvalUV=function(e){t.TypeCheckInternal(e,!0,"number");var r=e*this.scale+this.shift,n=Math.cos(r),o=Math.sin(r),i=new t.Point2D;return i.x=this.radiusMaj*n,i.y=this.radiusMin*o,i},l.prototype.EvalFirstDerivUV=function(e){t.TypeCheckInternal(e,!0,"number");var r=e*this.scale+this.shift,n=Math.cos(r),o=Math.sin(r),i=new t.Vector2D;return i.x=this.radiusMaj*-o,i.y=this.radiusMin*n,i},l.prototype.EvalSecondDerivUV=function(e){t.TypeCheckInternal(e,!0,"number");var r=e*this.scale+this.shift,n=Math.cos(r),o=Math.sin(r),i=new t.Vector2D;return i.x=this.radiusMaj*-n,i.y=this.radiusMin*-o,i},l.prototype.putInRange=function(e,r){return t.TypeCheckInternal(e,!0,"number"),t.TypeCheckInternal(r,!0,["number"],2),c.prototype.putInRange(e,r)},l.prototype.computePrincipleRange=function(e,r){return t.TypeCheckInternal(e,!0,["number"],2),t.TypeCheckInternal(r,!0,[]),c.prototype.computePrincipleRange(e,r)},l.prototype.IsInfinite=function(){return!0},l.prototype.IsPeriodic=function(){return!0},l.prototype.GetPeriodicRange=function(){return[0,t.constants.PI2]},l.prototype.GetDegree=function(){return 2},l.prototype.clone=function(){return(new l).copy(this)},l.prototype.copy=function(e){t.TypeCheck(e,!0,t.Ellipse),this.center.copy(e.center),this.radiusMaj=e.radiusMaj,this.radiusMin=e.radiusMin,this.shift=e.shift,this.scale=e.scale;var r=this.getDirectionsNotCloned(),n=e.getDirectionsNotCloned();return r[0].copy(n[0]),r[1].copy(n[1]),this},l.prototype.setCenter=function(e,r,o){return t.TypeCheck(e,!0,["number",t.Point]),t.TypeCheck(r,!1,"number"),t.TypeCheck(o,!1,"number"),e.constructor===n?this.center.copy(e):this.center.set(e,r||0,o||0),this},l.prototype.setVectors=function(e,r){return t.TypeCheck(e,!0,[t.Vector3D,"number"]),t.TypeCheck(r,!1,[t.Vector3D,"number"]),t.TypeCheck(arguments[2],!1,"number"),t.TypeCheck(arguments[3],!1,"number"),t.TypeCheck(arguments[4],!1,"number"),t.TypeCheck(arguments[5],!1,"number"),h.prototype.setVectors.apply(this,arguments),this},l.prototype.setMajorRadius=function(e){return t.TypeCheck(e,!1,"number"),e&&(this.radiusMaj=e),this},l.prototype.setMinorRadius=function(e){return t.TypeCheck(e,!1,"number"),e&&(this.radiusMin=e),this},l.prototype.setRadii=function(e,r){return t.TypeCheck(e,!1,"number"),t.TypeCheck(r,!1,"number"),this.setMajorRadius(e),this.setMinorRadius(r),this},l.prototype.setScale=function(e){return t.TypeCheck(e,!1,"number"),this.scale=e||1,this},l.prototype.setShift=function(e){return t.TypeCheck(e,!1,"number"),this.shift=e||0,this},l.prototype.getDirections=function(e){return t.TypeCheck(e,!1,[t.Vector3D],2),h.prototype.getDirections.apply(this,arguments)},l.prototype.evalPoint=function(e){t.TypeCheck(e,!0,["number",t.Point2D]);var r=e.constructor===o?e:this.EvalUV(e),n=this.getDirectionsNotCloned(),i=new t.Point;return i.x=this.center.x+r.x*n[0].x+r.y*n[1].x,i.y=this.center.y+r.x*n[0].y+r.y*n[1].y,i.z=this.center.z+r.x*n[0].z+r.y*n[1].z,i},l.prototype.evalFirstDeriv=function(e){t.TypeCheck(e,!0,["number",t.Vector2D]);var r=e.constructor===i?e:this.EvalFirstDerivUV(e),n=this.getDirectionsNotCloned(),o=new t.Vector3D;return o.x=r.x*n[0].x+r.y*n[1].x,o.y=r.x*n[0].y+r.y*n[1].y,o.z=r.x*n[0].z+r.y*n[1].z,o},l.prototype.evalSecondDeriv=function(e){t.TypeCheck(e,!0,["number",t.Vector2D]);var r=e.constructor===i?e:this.EvalSecondDerivUV(e),n=this.getDirectionsNotCloned(),o=new t.Vector3D;return o.x=r.x*n[0].x+r.y*n[1].x,o.y=r.x*n[0].y+r.y*n[1].y,o.z=r.x*n[0].z+r.y*n[1].z,o},l.prototype.eval=function(e,r,n){t.TypeCheck(e,!0,"number"),t.TypeCheck(r,!1,t.Point),t.TypeCheck(n,!1,t.Vector2D);var o=this.EvalUV(e);n&&n.set(o.x,o.y),r&&r.copy(this.evalPoint(o))},l.prototype.GetBox=function(e){t.TypeCheck(e,!0,["number"],2);var r=new t.Box;r.Update(this.evalPoint(e[0])),r.Update(this.evalPoint(e[1]));for(var n=this.getDirectionsNotCloned(),o=n[0].getArray(),i=n[1].getArray(),s=[],a=0;a<3;a++){var c=Math.atan2(this.radiusMin*i[a],this.radiusMaj*o[a]);c>=0?(s.push(c),s.push(c+t.constants.PI)):(s.push(c+t.constants.PI),s.push(c+t.constants.PI2))}var h=[];this._VERSION>=1?this.computePrincipleRange(e,h):h[0]=[e[0],e[1]];for(var p=0;p<s.length;p++)for(var l=0;l<h.length;l++)h[l][0]<=s[p]&&s[p]<=h[l][1]&&r.Update(this.evalPoint(s[p]));return r},l.prototype.Dump=function(t){console.log("var geo"+t+"; // ellipse"),console.log("{"),console.log("  var eCen = new DSMath.Point("+this.center.getArray()+");");var e=this.getDirectionsNotCloned();console.log("  var eDirX = new DSMath.Vector3D("+e[0].getArray()+");"),console.log("  var eDirY = new DSMath.Vector3D("+e[1].getArray()+");"),console.log("  var eRad1 = "+this.radiusMaj+";"),console.log("  var eRad2 = "+this.radiusMin+";"),console.log("  geo"+t+" = new DSMath.Ellipse(eRad1, eRad2).setCenter(eCen).setVectors(eDirX, eDirY);"),console.log("} // end of ellipse creation")},l.prototype.applyTransformation=function(e){if(t.TypeCheck(e,!0,t.Transformation),e.matrix.isOrthogonal()){var r=this.getDirectionsNotCloned();this.center.applyTransformation(e),r[0].applyTransformation(e),r[1].applyTransformation(e);var n=r[0].norm(),o=r[1].norm();r[0].normalize(),r[1].normalize(),this.radiusMaj*=n,this.radiusMin*=o}return this},l.prototype.getParam=function(e,r,n,o){t.TypeCheck(e,!0,t.Point),t.TypeCheck(r,!0,"number"),t.TypeCheck(n,!0,"number"),t.TypeCheck(o,!1,"number");var i=[],s=this.getDirectionsNotCloned(),a=e.sub(this.center),c=s[0].dot(a),h=s[1].dot(a),p=new t.Point2D(c,h);if(this.evalPoint(p).distanceTo(e)>o)return i;if(this.evalPoint(r).distanceTo(e)<=o&&i.push(r),this.evalPoint(n).distanceTo(e)<=o&&i.push(n),0==i.length){for(var l=1*(Math.atan2(h/this.radiusMin,c/this.radiusMaj)-this.shift)/this.scale;l<r;)l+=2*Math.PI;for(;l>n;)l-=2*Math.PI;l>=r&&l<=n&&i.push(l)}return i},l.prototype.arcLength=function(e,r){t.TypeCheck(e,!0,"number"),t.TypeCheck(r,!0,"number");for(var n=0,o=(e-this.shift)/this.scale,i=(r-this.shift)/this.scale,s=Math.PI/500,a=Math.ceil((i-o)/s),c=o+(s=(i-o)/a)/2,h=0;h<=a;h++){var p=Math.sqrt(Math.pow(this.radiusMaj*Math.cos(c),2)+Math.pow(this.radiusMin*Math.sin(c),2));0!=h&&h!=a||(p*=.5),n+=p*s,c+=s}return n},l.prototype.intersectLine=function(e,r,n,o,i,a){t.TypeCheck(e,!0,t.Line),t.TypeCheck(r,!0,"number"),t.TypeCheck(n,!0,"number"),t.TypeCheck(o,!0,"number"),t.TypeCheck(i,!0,"number"),t.TypeCheck(a,!0,"number");var c=[],h=this.getDirections(),p=new t.Plane;p.setOrigin(this.center),p.setVectors(h[0],h[1]);var l=p.intersectLine(e,a);if(-1==l.diag)return c;if(0==l.diag){var u=e.evalPoint(l.paramOnLine),y=this.shift,m=t.PI2*this.scale+this.shift;return 1==(w=this.getParam(u,y,m,a)).length&&(c[0]={paramEllipse:w,paramLine:l.paramOnLine}),c}var f=this.center.sub(e.origin),v=s.cross(e.direction,p.getNormal()),g=this.radiusMaj*h[0].dot(v),C=this.radiusMin*h[1].dot(v),D=f.dot(v),T=Math.sqrt(g*g+C*C);if(Math.abs(D)>Math.abs(T)+a)return c;var S=-D/T;Math.abs(S)>1&&(S=Math.sign(S));var d=Math.acos(S),M=Math.atan2(C/T,g/T),k=[M-d];d>0&&(k[1]=M+d);for(var b=o*this.scale+this.shift,x=i*this.scale+this.shift,I=Math.floor(b/t.constants.PI2)-1,P=Math.ceil(x/t.constants.PI2)+1,E=0,V=I;V<P;V++)for(var _=0;_<k.length;_++){var w;if((w=(k[_]+V*t.constants.PI2-this.shift)/this.scale)<o&&w>=o-a?w=o:w>i&&w<=i+a&&(w=i),w>=o&&w<=i){var N=this.evalPoint(w),z=e.getParam(N,r,n,a);if(1==z.length){for(var R=!0,O=0;O<E&&!0===R;O++)Math.abs(w-c[O].paramEllipse)<a&&Math.abs(z[0]-c[O].paramLine)<a&&(R=!1);!0===R&&(c[E]={paramEllipse:w,paramLine:z[0]},E++)}}}return c},t.Ellipse=l,l}),define("MathematicsES/MathEllipseJSImpl",["DS/MathematicsES/MathEllipseJSImpl"],function(t){return t}),define("DS/MathematicsES/MathMat3x3JSImpl",["DS/MathematicsES/MathNameSpace","DS/MathematicsES/MathTypeCheck","DS/MathematicsES/MathTypeCheckInternal","DS/MathematicsES/MathVector3DJSImpl"],function(t,e,r,n){"use strict";var o=function(){this.coef=[1,0,0,0,1,0,0,0,1];for(var t=0;t<arguments.length;t++)this.coef[t]=arguments[t]};return o.prototype.coef=null,o.prototype.clone=function(){var t=this.coef;return new o(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8])},o.prototype.copy=function(e){return t.TypeCheck(e,!0,t.Matrix3x3),this.setFromArray(e.coef),this},o.prototype.set=function(){if(9==arguments.length){var t=this.coef;t[0]=arguments[0],t[1]=arguments[1],t[2]=arguments[2],t[3]=arguments[3],t[4]=arguments[4],t[5]=arguments[5],t[6]=arguments[6],t[7]=arguments[7],t[8]=arguments[8]}return this},o.prototype.setFromArray=function(e,r){t.TypeCheck(e,!0,["number"],9),t.TypeCheck(r,!1,"number");var n=this.coef;return 0==(r=r||0)?(n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n[4]=e[4],n[5]=e[5],n[6]=e[6],n[7]=e[7],n[8]=e[8]):(n[0]=e[0],n[1]=e[3],n[2]=e[6],n[3]=e[1],n[4]=e[4],n[5]=e[7],n[6]=e[2],n[7]=e[5],n[8]=e[8]),this},o.prototype.getArray=function(e,r){t.TypeCheck(e,!1,"number"),t.TypeCheck(r,!1,[],[]),r=r||new Array(9),e=e||0;var n=this.coef;return 0==e?(r[0]=n[0],r[1]=n[1],r[2]=n[2],r[3]=n[3],r[4]=n[4],r[5]=n[5],r[6]=n[6],r[7]=n[7],r[8]=n[8]):(r[0]=n[0],r[3]=n[1],r[6]=n[2],r[1]=n[3],r[4]=n[4],r[7]=n[5],r[2]=n[6],r[5]=n[7],r[8]=n[8]),r},o.prototype.setFirstColumn=function(e){t.TypeCheck(e,!0,t.Vector3D);var r=this.coef;return r[0]=e.x,r[3]=e.y,r[6]=e.z,this},o.prototype.getFirstColumn=function(e){t.TypeCheck(e,!1,t.Vector3D),e=e||new n;var r=this.coef;return e.x=r[0],e.y=r[3],e.z=r[6],e},o.prototype.setSecondColumn=function(e){t.TypeCheck(e,!0,t.Vector3D);var r=this.coef;return r[1]=e.x,r[4]=e.y,r[7]=e.z,this},o.prototype.getSecondColumn=function(e){t.TypeCheck(e,!1,t.Vector3D),e=e||new n;var r=this.coef;return e.x=r[1],e.y=r[4],e.z=r[7],e},o.prototype.setThirdColumn=function(e){t.TypeCheck(e,!0,t.Vector3D);var r=this.coef;return r[2]=e.x,r[5]=e.y,r[8]=e.z,this},o.prototype.getThirdColumn=function(e){t.TypeCheck(e,!1,t.Vector3D),e=e||new n;var r=this.coef;return e.x=r[2],e.y=r[5],e.z=r[8],e},o.prototype.makeRotation=function(e,r){t.TypeCheck(e,!0,t.Vector3D),t.TypeCheck(r,!0,"number");var n=e.norm(),o=e.x/n,i=e.y/n,s=e.z/n,a=Math.sin(r),c=Math.cos(r),h=1-c,p=h*o,l=h*i,u=this.coef;return u[0]=p*o+c,u[1]=p*i-a*s,u[2]=p*s+a*i,u[3]=p*i+a*s,u[4]=l*i+c,u[5]=l*s-a*o,u[6]=p*s-a*i,u[7]=l*s+a*o,u[8]=h*s*s+c,this},o.prototype.makeRotationFromEuler=function(e,r){t.TypeCheck(e,!0,["number"],3),t.TypeCheck(r,!1,String);var n=r||"ZXY",o=e[0],i=e[1],s=e[2],a=Math.cos(o),c=Math.sin(o),h=Math.cos(i),p=Math.sin(i),l=Math.cos(s),u=Math.sin(s),y=this.coef;return"XYZ"===n?(y[0]=h*l,y[1]=-h*u,y[2]=p,y[3]=a*u+l*c*p,y[4]=a*l-c*p*u,y[5]=-h*c,y[6]=c*u-a*l*p,y[7]=l*c+a*p*u,y[8]=a*h):"YXZ"===n?(y[0]=a*l+c*p*u,y[1]=l*c*p-a*u,y[2]=h*c,y[3]=h*u,y[4]=h*l,y[5]=-p,y[6]=a*p*u-l*c,y[7]=a*l*p+c*u,y[8]=a*h):"XZY"===n?(y[0]=h*l,y[1]=-p,y[2]=h*u,y[3]=c*u+a*l*p,y[4]=a*h,y[5]=a*p*u-l*c,y[6]=l*c*p-a*u,y[7]=h*c,y[8]=a*l+c*p*u):"ZYX"===n?(y[0]=a*h,y[1]=a*p*u-l*c,y[2]=c*u+a*l*p,y[3]=h*c,y[4]=a*l+c*p*u,y[5]=l*c*p-a*u,y[6]=-p,y[7]=h*u,y[8]=h*l):"YZX"===n?(y[0]=a*h,y[1]=c*u-a*l*p,y[2]=l*c+a*p*u,y[3]=p,y[4]=h*l,y[5]=-h*u,y[6]=-h*c,y[7]=a*u+l*c*p,y[8]=a*l-c*p*u):(y[0]=l*a-p*u*c,y[1]=-h*c,y[2]=a*u+l*p*c,y[3]=a*p*u+l*c,y[4]=h*a,y[5]=u*c-l*a*p,y[6]=-h*u,y[7]=p,y[8]=h*l),this},o.prototype.makeDiagonal=function(e,r,n){t.TypeCheck(e,!0,"number"),t.TypeCheck(r,!0,"number"),t.TypeCheck(n,!0,"number");var o=this.coef;return o[0]=e,o[1]=0,o[2]=0,o[3]=0,o[4]=r,o[5]=0,o[6]=0,o[7]=0,o[8]=n,this},o.prototype.makeScaling=function(e){return t.TypeCheck(e,!0,"number"),this.makeDiagonal(e,e,e)},o.prototype.inverse=function(){var e=this.coef,r=e[0],n=e[1],o=e[2],i=e[3],s=e[4],a=e[5],c=e[6],h=e[7],p=e[8],l=this.determinant();return Math.abs(l)>t.defaultTolerances.epsilonForSquareRelativeTest&&(e[0]=(s*p-h*a)/l,e[1]=(h*o-n*p)/l,e[2]=(n*a-s*o)/l,e[3]=(c*a-i*p)/l,e[4]=(r*p-c*o)/l,e[5]=(i*o-r*a)/l,e[6]=(i*h-c*s)/l,e[7]=(c*n-r*h)/l,e[8]=(r*s-i*n)/l),this},o.prototype.getInverse=function(e){return t.TypeCheck(e,!1,t.Matrix3x3),(e=e?e.copy(this):this.clone()).inverse()},o.prototype.transpose=function(){var t=this.coef;return t[1]=t[3]+(t[3]=t[1],0),t[2]=t[6]+(t[6]=t[2],0),t[5]=t[7]+(t[7]=t[5],0),this},o.prototype.getTranspose=function(e){return t.TypeCheck(e,!1,t.Matrix3x3),(e=e?e.copy(this):this.clone()).transpose()},o.prototype.determinant=function(){var t=this.coef,e=t[0],r=t[1],n=t[2],o=t[3],i=t[4],s=t[5],a=t[6],c=t[7],h=t[8];return e*i*h+o*c*n+s*r*a-(a*i*n+e*s*c+o*r*h)},o.prototype.trace=function(){var t=this.coef;return t[0]+t[4]+t[8]},o.prototype.infiniteNorm=function(){for(var t=0,e=0;e<9;e++){var r=this.coef[e];t=t*t<r*r?Math.abs(r):t}return t},o.prototype.getQuaternion=function(e){t.TypeCheck(e,!1,t.Quaternion),e=e||new t.Quaternion;var r=this.coef,n=r[0]+r[4]+r[8];if(n>0){var o=2*Math.sqrt(1+n);e.s=.25*o,e.x=(r[7]-r[5])/o,e.y=(r[2]-r[6])/o,e.z=(r[3]-r[1])/o}else if(r[0]>r[4]&&r[0]>r[8]){var i=2*Math.sqrt(1+r[0]-r[4]-r[8]);e.s=(r[7]-r[5])/i,e.x=.25*i,e.y=(r[1]+r[3])/i,e.z=(r[2]+r[6])/i}else if(r[4]>r[8]){var s=2*Math.sqrt(1+r[4]-r[0]-r[8]);e.s=(r[2]-r[6])/s,e.x=(r[1]+r[3])/s,e.y=.25*s,e.z=(r[5]+r[7])/s}else{var a=2*Math.sqrt(1+r[8]-r[0]-r[4]);e.s=(r[3]-r[1])/a,e.x=(r[2]+r[6])/a,e.y=(r[5]+r[7])/a,e.z=.25*a}return e.normalize(),e},o.prototype.getEuler=function(e){t.TypeCheck(e,!1,String);var r,n,o,i=e||"ZXY",s=this.coef,a=t.defaultTolerances.epsilonForSqrtAngleTest*t.constants.SQRT2;if("XYZ"===i){n=Math.asin(s[2]);var c=Math.cos(n);Math.abs(c)>a?(o=Math.atan2(-s[1],s[0]),r=Math.atan2(-s[5],s[8])):(r=Math.atan2(s[7],s[4]),o=0)}else if("YXZ"===i){n=Math.asin(-s[5]);c=Math.cos(n);Math.abs(c)?(o=Math.atan2(s[3],s[4]),r=Math.atan2(s[2],s[8])):(r=Math.atan2(-s[6],s[0]),o=0)}else if("ZYX"===i){n=Math.asin(-s[6]);c=Math.cos(n);Math.abs(c)>a?(r=Math.atan2(s[3],s[0]),o=Math.atan2(s[7],s[8])):(r=Math.atan2(-s[1],s[4]),o=0)}else if("YZX"===i){n=Math.asin(s[3]);c=Math.cos(n);Math.abs(c)>a?(r=Math.atan2(-s[6],s[0]),o=Math.atan2(-s[5],s[4])):(r=Math.atan2(s[2],s[8]),o=0)}else if("XZY"===i){n=Math.asin(-s[1]);c=Math.cos(n);Math.abs(c)>a?(r=Math.atan2(s[7],s[4]),o=Math.atan2(s[2],s[0])):(r=Math.atan2(-s[5],s[8]),o=0)}else{n=Math.asin(s[7]);var h=Math.cos(n);if(Math.abs(h)>a){var p=-s[1]/h,l=s[4]/h;r=Math.atan2(p,l);var u=-s[6]/h,y=s[8]/h;o=Math.atan2(u,y)}else{n=s[7]>0?Math.PI/2:-Math.PI/2,o=0;p=s[2]/s[7],l=s[0];r=Math.atan2(p,l)}}return[r,n,o]},o.prototype.getScale=function(){var e=t.defaultTolerances.epsgForRelativeTest,r=t.defaultTolerances.epsilonForRelativeTest,n=this.determinant(),o=0;return Math.abs(n)>=r&&(o=Math.abs(Math.abs(n)-1)<=3*e?1:Math.pow(Math.abs(n),1/3),o*=n>0?1:-1),o},o.prototype.isOrthogonal=function(){var e=this.coef,r=t.defaultTolerances.epsgForSquareRelativeTest,n=e[0]*e[0]+e[3]*e[3]+e[6]*e[6],o=e[1]*e[1]+e[4]*e[4]+e[7]*e[7],i=e[2]*e[2]+e[5]*e[5]+e[8]*e[8],s=e[0]*e[1]+e[3]*e[4]+e[6]*e[7],a=e[0]*e[2]+e[3]*e[5]+e[6]*e[8],c=e[1]*e[2]+e[4]*e[5]+e[7]*e[8];return s*s<=r*n*o&&a*a<=r*n*i&&c*c<=r*o*i},o.prototype.isScaling=function(e){t.TypeCheck(e,!1,Object);var r=this.coef,n=!1,o=t.defaultTolerances.epsgForRelativeTest,i=o*o,s=t.defaultTolerances.epsilonForSquareRelativeTest;if(this.isOrthogonal()){var a=Math.abs(this.getScale());e&&(e.scale=a);var c=a*a;if(c>s){var h=r[0]*r[0]+r[3]*r[3]+r[6]*r[6],p=r[1]*r[1]+r[4]*r[4]+r[7]*r[7],l=r[2]*r[2]+r[5]*r[5]+r[8]*r[8];n=Math.abs(h/c-1)<2*o+i&&Math.abs(p/c-1)<2*o+i&&Math.abs(l/c-1)<2*o+i}}return n},o.prototype.isReflecting=function(){var t=this.isScaling();return t=t&&this.determinant()<0},o.prototype.isAnIsometry=function(e){t.TypeCheck(e,!1,Object);var r=this.coef,n=!1,o=t.defaultTolerances.epsgForRelativeTest,i=o*o,s=t.defaultTolerances.epsilonForSquareRelativeTest,a=this.determinant();if(a*a>s&&this.isOrthogonal()){var c=r[0]*r[0]+r[3]*r[3]+r[6]*r[6],h=r[1]*r[1]+r[4]*r[4]+r[7]*r[7],p=r[2]*r[2]+r[5]*r[5]+r[8]*r[8];(n=Math.abs(c-1)<2*o+i&&Math.abs(h-1)<2*o+i&&Math.abs(p-1)<2*o+i)&&e&&(e.direct=a>0)}return n},o.prototype.isAScaling=function(e){t.TypeCheck(e,!1,Object),e=e||{scale:1};var r=!1,n=t.defaultTolerances.epsgForRelativeTest;if(this.isScaling(e)){var o=this.trace();r=o>0&&Math.abs(o-3*e.scale)<=Math.max(o,1)*n}return r},o.prototype.isARotation=function(e){t.TypeCheck(e,!1,Object);var r={direct:!1},o=this.isAnIsometry(r);return(o=o&&r.direct)&&e&&(e.angle=0,e.vector=e.vector.constructor==n?e.vector:new t.Vector3D,this.getQuaternion().getRotationData(e)),o},o.prototype.add=function(e){t.TypeCheck(e,!0,t.Matrix3x3);for(var r=this.coef,n=e.coef,o=0;o<9;o++)r[o]+=n[o];return this},o.prototype.sub=function(e){t.TypeCheck(e,!0,t.Matrix3x3);for(var r=this.coef,n=e.coef,o=0;o<9;o++)r[o]-=n[o];return this},o.prototype.multiply=function(e,r){t.TypeCheck(e,!0,t.Matrix3x3),t.TypeCheck(r,!1,Boolean),r=r||!1;var n=this.coef,o=e.coef,i=o[0],s=o[1],a=o[2],c=o[3],h=o[4],p=o[5],l=o[6],u=o[7],y=o[8];if(r)for(m=0;m<3;m++){v=n[m],g=n[3+m],C=n[6+m];n[m]=i*v+s*g+a*C,n[3+m]=c*v+h*g+p*C,n[6+m]=l*v+u*g+y*C}else for(var m=0;m<3;m++){var f=3*m,v=n[f],g=n[f+1],C=n[f+2];n[f]=v*i+g*c+C*l,n[f+1]=v*s+g*h+C*u,n[f+2]=v*a+g*p+C*y}return this},o.prototype.multiplyScalar=function(e){t.TypeCheck(e,!0,"number");var r=this.coef;return r[0]*=e,r[1]*=e,r[2]*=e,r[3]*=e,r[4]*=e,r[5]*=e,r[6]*=e,r[7]*=e,r[8]*=e,this},Object.defineProperty(o,"identity",{value:new o(1,0,0,0,1,0,0,0,1),writable:!1,enumerable:!0,configurable:!1}),Object.freeze(o.identity),o.makeRotation=function(e,r){return t.TypeCheck(e,!0,t.Vector3D),t.TypeCheck(r,!0,"number"),(new o).makeRotation(e,r)},o.makeRotationFromEuler=function(e,r){return t.TypeCheck(e,!0,["number"],3),t.TypeCheck(r,!1,String),(new o).makeRotationFromEuler(e,r)},o.makeDiagonal=function(e,r,n){return t.TypeCheck(e,!0,"number"),t.TypeCheck(r,!0,"number"),t.TypeCheck(n,!0,"number"),(new o).makeDiagonal(e,r,n)},o.makeScaling=function(e){return t.TypeCheck(e,!0,"number"),(new o).makeScaling(e)},o.add=function(e,r,n){t.TypeCheck(e,!0,t.Matrix3x3),t.TypeCheck(r,!0,t.Matrix3x3),t.TypeCheck(n,!1,t.Matrix3x3);for(var i=(n=n||new o).coef,s=e.coef,a=r.coef,c=0;c<9;c++)i[c]=s[c]+a[c];return n},o.sub=function(e,r,n){t.TypeCheck(e,!0,t.Matrix3x3),t.TypeCheck(r,!0,t.Matrix3x3),t.TypeCheck(n,!1,t.Matrix3x3);for(var i=(n=n||new o).coef,s=e.coef,a=r.coef,c=0;c<9;c++)i[c]=s[c]-a[c];return n},o.multiply=function(e,r,n){return t.TypeCheck(e,!0,t.Matrix3x3),t.TypeCheck(r,!0,t.Matrix3x3),t.TypeCheck(n,!1,t.Matrix3x3),n=n?n===r?n.multiply(e,!0):n.copy(e).multiply(r):e.clone().multiply(r)},o.multiplyScalar=function(e,r,n){return t.TypeCheck(e,!0,t.Matrix3x3),t.TypeCheck(r,!0,"number"),t.TypeCheck(n,!1,t.Matrix3x3),(n=n?n.copy(e):e.clone()).multiplyScalar(r)},t.Matrix3x3=o,o}),define("MathematicsES/MathMat3x3JSImpl",["DS/MathematicsES/MathMat3x3JSImpl"],function(t){return t}),define("DS/MathematicsES/MathParabolaJSImpl",["DS/MathematicsES/MathNameSpace","DS/MathematicsES/MathTypeCheck","DS/MathematicsES/MathTypeCheckInternal","DS/MathematicsES/MathPlaneJSImpl","DS/MathematicsES/MathPointJSImpl","DS/MathematicsES/MathPoint2DJSImpl","DS/MathematicsES/MathVector3DJSImpl","DS/MathematicsES/MathVector2DJSImpl","DS/MathematicsES/MathBoxJSImpl"],function(t,e,r,n,o,i,s,a,c){"use strict";var h=function(e,r,n,i){t.TypeCheck(e,!1,"number"),t.TypeCheck(r,!1,t.Point),t.TypeCheck(n,!1,t.Vector3D),t.TypeCheck(i,!1,t.Vector3D),this.vertex=r?r.clone():new o,this.focalParam=e||1,this.dir=new Array(2),this.dir[0]=n?n.clone():new s(1,0,0),this.dir[1]=i?i.clone():new s(0,1,0),(n||i)&&s.orthoNormalize(dir[0],dir[1]),this.focalParamSq=this.focalParam*this.focalParam,this.sqrt2P=Math.sqrt(2*this.focalParam)};return h.prototype._VERSION=0,h.prototype.EvalUV=function(e){t.TypeCheckInternal(e,!0,"number");var r=e*e,n=1/Math.sqrt(4*this.focalParamSq+r),o=new t.Point2D;return o.x=r*n,o.y=e*this.sqrt2P*Math.sqrt(n),o},h.prototype.EvalFirstDerivUV=function(e){t.TypeCheckInternal(e,!0,"number");var r=e*e,n=8*this.focalParamSq+r,o=4*this.focalParamSq+r,i=new t.Vector2D;return i.x=e*n/Math.pow(o,1.5),i.y=this.sqrt2P*n/(2*Math.pow(o,5/4)),i},h.prototype.EvalSecondDerivUV=function(e){t.TypeCheckInternal(e,!0,"number");var r=e*e,n=-8*this.focalParamSq+r,o=24*this.focalParamSq+r,i=4*this.focalParamSq+r,s=new t.Vector2D;return s.x=-4*this.focalParamSq*n/Math.pow(i,2.5),s.y=-this.sqrt2P*e*o/(4*Math.pow(i,9/4)),s},h.prototype.IsInfinite=function(){return!1},h.prototype.IsPeriodic=function(){return!1},h.prototype.GetDegree=function(){return 2},h.prototype.clone=function(){return(new h).copy(this)},h.prototype.copy=function(e){return t.TypeCheck(e,!0,t.Parabola),this.setVertex(e.vertex),this.setFocalParam(e.focalParam),this.setVectors(e.dir[0],e.dir[1]),this},h.prototype.setVertex=function(e,r,n){return t.TypeCheck(e,!0,["number",t.Point]),t.TypeCheck(r,!1,"number"),t.TypeCheck(n,!1,"number"),e.constructor===t.Point?this.vertex.copy(e):this.vertex.set(e,r||0,n||0),this},h.prototype.setFocalParam=function(e){return t.TypeCheck(e,!0,"number"),this.focalParam=e,this.focalParamSq=this.focalParam*this.focalParam,this.sqrt2P=Math.sqrt(2*this.focalParam),this},h.prototype.setVectors=function(e,r){return t.TypeCheck(e,!0,[t.Vector3D,"number"]),t.TypeCheck(r,!1,[t.Vector3D,"number"]),t.TypeCheck(arguments[2],!1,"number"),t.TypeCheck(arguments[3],!1,"number"),t.TypeCheck(arguments[4],!1,"number"),t.TypeCheck(arguments[5],!1,"number"),e.constructor===s?this.dir[0].copy(e):this.dir[0].set(arguments[0],arguments[1]||0,arguments[2]||0),r.constructor===s?this.dir[1].copy(r):this.dir[1].set(arguments[3]||0,arguments[4]||0,arguments[5]||0),s.orthoNormalize(this.dir[0],this.dir[1]),this},h.prototype.getDirections=function(e){return t.TypeCheck(e,!1,[t.Vector3D],2),e?(e[0].copy(this.dir[0]),void e[1].copy(this.dir[1])):new Array(this.dir[0].clone(),this.dir[1].clone())},h.prototype.evalPoint=function(e){t.TypeCheck(e,!0,["number",t.Point2D]);var r=e.constructor===i?e:this.EvalUV(e),n=new t.Point;return n.x=this.vertex.x+r.x*this.dir[0].x+r.y*this.dir[1].x,n.y=this.vertex.y+r.x*this.dir[0].y+r.y*this.dir[1].y,n.z=this.vertex.z+r.x*this.dir[0].z+r.y*this.dir[1].z,n},h.prototype.evalFirstDeriv=function(e){t.TypeCheck(e,!0,["number",t.Vector2D]);var r=e.constructor===a?e:this.EvalFirstDerivUV(e),n=new t.Vector3D;return n.x=r.x*this.dir[0].x+r.y*this.dir[1].x,n.y=r.x*this.dir[0].y+r.y*this.dir[1].y,n.z=r.x*this.dir[0].z+r.y*this.dir[1].z,n},h.prototype.evalSecondDeriv=function(e){t.TypeCheck(e,!0,["number",t.Vector2D]);var r=e.constructor===a?e:this.EvalSecondDerivUV(e),n=new t.Vector3D;return n.x=r.x*this.dir[0].x+r.y*this.dir[1].x,n.y=r.x*this.dir[0].y+r.y*this.dir[1].y,n.z=r.x*this.dir[0].z+r.y*this.dir[1].z,n},h.prototype.eval=function(e,r,n){t.TypeCheck(e,!0,"number"),t.TypeCheck(r,!1,t.Point),t.TypeCheck(n,!1,t.Vector2D);var o=this.EvalUV(e);n&&n.set(o.x,o.y),r&&r.copy(this.evalPoint(o))},h.prototype.GetBox=function(e){t.TypeCheck(e,!0,["number"],2);var r=new t.Box;return r.Update(this.evalPoint(e[0])),r.Update(this.evalPoint(e[1])),e[0]*e[1]<0&&r.Update(this.vertex),r},h.prototype.Dump=function(t){console.log("var geo"+t+"; // parabola"),console.log("{"),console.log("  var pVertex = new DSMath.Point("+this.vertex.getArray()+");"),console.log("  var pDirX = new DSMath.Vector3D("+this.dir[0].getArray()+");"),console.log("  var pDirY = new DSMath.Vector3D("+this.dir[1].getArray()+");"),console.log("  var pFP = "+this.focalParam+";"),console.log("  geo"+t+" = new DSMath.Parabola(pFP).setVertex(pVertex).setVectors(pDirX, pDirY);"),console.log("} // end of parabola creation")},t.Parabola=h,h}),define("MathematicsES/MathParabolaJSImpl",["DS/MathematicsES/MathParabolaJSImpl"],function(t){return t}),define("DS/MathematicsES/MathGeometryUtils",["DS/MathematicsES/MathNameSpace","DS/MathematicsES/MathLineJSImpl","DS/MathematicsES/MathCircleJSImpl","DS/MathematicsES/MathEllipseJSImpl","DS/MathematicsES/MathNurbsCurveJSImpl","DS/MathematicsES/MathParabolaJSImpl"],function(t){"use strict";var e=function(){};return e.prototype.GetSampleInits=function(e,r,n){if(t.TypeCheck(e,!0,[t.Line,t.Circle,t.Ellipse,t.NurbsCurve,t.Parabola]),t.TypeCheck(r,!0,"number"),t.TypeCheck(n,!0,["number"],2),e.constructor===t.NurbsCurve)return e.GetSampleInits(r,n);var o=[],i=e.GetDegree()*r;if(i<2)return o;for(var s=(n[1]-n[0])/(i-1),a=0;a<i;a++){var c=n[0]+a*s;o.push(c)}return o},e.prototype.PutInRange=function(e,r,n){if(t.TypeCheck(e,!0,[t.Line,t.Circle,t.Ellipse,t.NurbsCurve,t.Parabola]),t.TypeCheck(r,!0,"number"),t.TypeCheck(n,!0,["number"],2),e.constructor===t.Ellipse||e.constructor===t.Circle)return o=e.putInRange(r,n);var o=r;return e.constructor===t.NurbsCurve&&!0===e.IsPeriodic()&&(o=e.putInPrincipalRange(r)),o=Math.max(n[0],Math.min(n[1],o))},e.prototype.PutInDomain=function(e,r,n){t.TypeCheckInternal(e,!0,"number"),t.TypeCheckInternal(r,!0,["number"],2),t.TypeCheckInternal(n,!0,"number");var o=[e,!0];return e<r[0]&&(e<r[0]-n?o[1]=!1:o[0]=r[0]),e>r[1]&&(e>r[1]+n?o[1]=!1:o[0]=r[1]),o},t.GeometryUtils=e,e}),define("MathematicsES/MathGeometryUtils",["DS/MathematicsES/MathGeometryUtils"],function(t){return t}),define("DS/MathematicsES/MathMat2x2JSImpl",["DS/MathematicsES/MathNameSpace","DS/MathematicsES/MathTypeCheck","DS/MathematicsES/MathTypeCheckInternal","DS/MathematicsES/MathVector2DJSImpl"],function(t,e,r,n){"use strict";var o=function(){this.coef=[1,0,0,1];for(var t=0;t<arguments.length;t++)this.coef[t]=arguments[t]};return o.prototype.coef=null,o.prototype.clone=function(){var t=this.coef;return new o(t[0],t[1],t[2],t[3])},o.prototype.copy=function(e){return t.TypeCheck(e,!0,t.Matrix2x2),this.setFromArray(e.coef),this},o.prototype.set=function(){if(t.TypeCheck(Array.prototype.slice.call(arguments),!1,["number"],4),4==arguments.length){var e=this.coef;e[0]=arguments[0],e[1]=arguments[1],e[2]=arguments[2],e[3]=arguments[3]}return this},o.prototype.setFromArray=function(e,r){t.TypeCheck(e,!0,["number"],4),t.TypeCheck(r,!1,"number");var n=this.coef;return 0==(r=r||0)?(n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3]):(n[0]=e[0],n[2]=e[1],n[1]=e[2],n[3]=e[3]),this},o.prototype.getArray=function(e,r){t.TypeCheck(e,!1,"number"),t.TypeCheck(r,!1,["number"],4),r=r||new Array(4),e=e||0;var n=this.coef;return 0==e?(r[0]=n[0],r[1]=n[1],r[2]=n[2],r[3]=n[3]):(r[0]=n[0],r[2]=n[1],r[1]=n[2],r[3]=n[3]),r},o.prototype.setFirstColumn=function(e){t.TypeCheck(e,!0,t.Vector2D);var r=this.coef;return r[0]=e.x,r[2]=e.y,this},o.prototype.getFirstColumn=function(e){t.TypeCheck(e,!1,t.Vector2D),e=e||new n;var r=this.coef;return e.x=r[0],e.y=r[2],e},o.prototype.setSecondColumn=function(e){t.TypeCheck(e,!0,t.Vector2D);var r=this.coef;return r[1]=e.x,r[3]=e.y,this},o.prototype.getSecondColumn=function(e){t.TypeCheck(e,!1,t.Vector2D),e=e||new n;var r=this.coef;return e.x=r[1],e.y=r[3],e},o.prototype.makeRotation=function(e){t.TypeCheck(e,!0,"number");var r=Math.sin(e),n=Math.cos(e),o=this.coef;return o[0]=n,o[1]=-r,o[2]=r,o[3]=n,this},o.prototype.makeDiagonal=function(e,r){t.TypeCheck(e,!0,"number"),t.TypeCheck(r,!0,"number");var n=this.coef;return n[0]=e,n[1]=0,n[2]=0,n[3]=r,this},o.prototype.makeScaling=function(e){return t.TypeCheck(e,!0,"number"),this.makeDiagonal(e,e,e)},o.prototype.inverse=function(){var e=this.coef,r=e[0],n=this.determinant();return Math.abs(n)>t.defaultTolerances.epsilonForSquareRelativeTest&&(e[0]=e[3]/n,e[1]=-e[1]/n,e[2]=-e[2]/n,e[3]=r/n),this},o.prototype.getInverse=function(e){return t.TypeCheck(e,!1,t.Matrix2x2),(e=e?e.copy(this):this.clone()).inverse()},o.prototype.transpose=function(){var t=this.coef;return t[1]=t[2]+(t[2]=t[1],0),this},o.prototype.getTranspose=function(e){return t.TypeCheck(e,!1,t.Matrix2x2),(e=e?e.copy(this):this.clone()).transpose()},o.prototype.determinant=function(){var t=this.coef;return t[0]*t[3]-t[1]*t[2]},o.prototype.trace=function(){var t=this.coef;return t[0]+t[3]},o.prototype.infiniteNorm=function(){for(var t=0,e=0;e<4;e++){var r=this.coef[e];t=t*t<r*r?Math.abs(r):t}return t},o.prototype.getScale=function(){var e=t.defaultTolerances.epsgForRelativeTest,r=t.defaultTolerances.epsilonForRelativeTest,n=this.determinant(),o=0;return Math.abs(n)>=r&&(o=Math.abs(Math.abs(n)-1)<=2*e?1:Math.sqrt(Math.abs(n)),o*=n>0?1:-1),o},o.prototype.isOrthogonal=function(){var e=this.coef,r=t.defaultTolerances.epsgForSquareRelativeTest,n=e[0]*e[0]+e[2]*e[2],o=e[1]*e[1]+e[3]*e[3],i=e[0]*e[1]+e[2]*e[3];return i*i<=r*n*o},o.prototype.isScaling=function(e){t.TypeCheck(e,!1,Object);var r=this.coef,n=!1,o=t.defaultTolerances.epsgForRelativeTest,i=o*o,s=t.defaultTolerances.epsilonForSquareRelativeTest;if(this.isOrthogonal()){var a=Math.abs(this.getScale());e&&(e.scale=a);var c=a*a;if(c>s){var h=r[0]*r[0]+r[2]*r[2],p=r[1]*r[1]+r[3]*r[3];n=Math.abs(h/c-1)<2*o+i&&Math.abs(p/c-1)<2*o+i}}return n},o.prototype.isReflecting=function(){var t=this.isScaling();return t=t&&this.determinant()<0},o.prototype.isAnIsometry=function(e){t.TypeCheck(e,!1,Object);var r=this.coef,n=!1,o=t.defaultTolerances.epsgForRelativeTest,i=o*o,s=t.defaultTolerances.epsilonForSquareRelativeTest,a=this.determinant();if(a*a>s&&this.isOrthogonal()){var c=r[0]*r[0]+r[2]*r[2],h=r[1]*r[1]+r[3]*r[3];(n=Math.abs(c-1)<2*o+i&&Math.abs(h-1)<2*o+i)&&e&&(e.direct=a>0)}return n},o.prototype.isAScaling=function(e){t.TypeCheck(e,!1,Object),e=e||{scale:1};var r=!1,n=t.defaultTolerances.epsgForRelativeTest;if(this.isScaling(e)){var o=this.trace();r=o>0&&Math.abs(o-2*e.scale)<=Math.max(o,1)*n}return r},o.prototype.isARotation=function(e){t.TypeCheck(e,!1,Object);var r={direct:!1},n=this.isAnIsometry(r);return(n=n&&r.direct)&&e&&(e.angle=Math.atan2(this.coef[2],this.coef[0])),n},o.prototype.add=function(e){t.TypeCheck(e,!0,t.Matrix2x2);for(var r=this.coef,n=e.coef,o=0;o<4;o++)r[o]+=n[o];return this},o.prototype.sub=function(e){t.TypeCheck(e,!0,t.Matrix2x2);for(var r=this.coef,n=e.coef,o=0;o<4;o++)r[o]-=n[o];return this},o.prototype.multiply=function(e,r){t.TypeCheck(e,!0,t.Matrix2x2),t.TypeCheck(r,!1,Boolean),r=r||!1;var n=this.coef,o=e.coef,i=o[0],s=o[1],a=o[2],c=o[3];if(r)for(h=0;h<2;h++){l=n[h],u=n[2+h];n[h]=i*l+s*u,n[2+h]=a*l+c*u}else for(var h=0;h<2;h++){var p=2*h,l=n[p],u=n[p+1];n[p]=l*i+u*a,n[p+1]=l*s+u*c}return this},o.prototype.multiplyScalar=function(e){t.TypeCheck(e,!0,"number");var r=this.coef;return r[0]*=e,r[1]*=e,r[2]*=e,r[3]*=e,this},Object.defineProperty(o,"identity",{value:new o(1,0,0,1),writable:!1,enumerable:!0,configurable:!1}),Object.freeze(o.identity),o.makeRotation=function(e){return t.TypeCheck(e,!0,"number"),(new o).makeRotation(e)},o.makeDiagonal=function(e,r){return t.TypeCheck(e,!0,"number"),t.TypeCheck(r,!0,"number"),(new o).makeDiagonal(e,r)},o.makeScaling=function(e){return t.TypeCheck(e,!0,"number"),(new o).makeScaling(e)},o.add=function(e,r,n){t.TypeCheck(e,!0,t.Matrix2x2),t.TypeCheck(r,!0,t.Matrix2x2),t.TypeCheck(n,!1,t.Matrix2x2);for(var i=(n=n||new o).coef,s=e.coef,a=r.coef,c=0;c<4;c++)i[c]=s[c]+a[c];return n},o.sub=function(e,r,n){t.TypeCheck(e,!0,t.Matrix2x2),t.TypeCheck(r,!0,t.Matrix2x2),t.TypeCheck(n,!1,t.Matrix2x2);for(var i=(n=n||new o).coef,s=e.coef,a=r.coef,c=0;c<4;c++)i[c]=s[c]-a[c];return n},o.multiply=function(e,r,n){return t.TypeCheck(e,!0,t.Matrix2x2),t.TypeCheck(r,!0,t.Matrix2x2),t.TypeCheck(n,!1,t.Matrix2x2),n=n?n===r?n.multiply(e,!0):n.copy(e).multiply(r):e.clone().multiply(r)},o.multiplyScalar=function(e,r,n){return t.TypeCheck(e,!0,t.Matrix2x2),t.TypeCheck(r,!0,"number"),t.TypeCheck(n,!1,t.Matrix2x2),(n=n?n.copy(e):e.clone()).multiplyScalar(r)},t.Matrix2x2=o,o}),define("MathematicsES/MathMat2x2JSImpl",["DS/MathematicsES/MathMat2x2JSImpl"],function(t){return t}),define("DS/MathematicsES/MathAxisJSImpl",["DS/MathematicsES/MathNameSpace","DS/MathematicsES/MathTypeCheck","DS/MathematicsES/MathVector3DJSImpl","DS/MathematicsES/MathPointJSImpl"],function(t,e,r,n){"use strict";var o=function(e,o,i,s){t.TypeCheck(e,!1,t.Point),t.TypeCheck(o,!1,t.Vector3D),t.TypeCheck(i,!1,t.Vector3D),t.TypeCheck(s,!1,t.Vector3D),this.origin=e?e.clone():new n(0,0,0);var a=new Array(3);a[0]=o?o.clone():new r(1,0,0),a[1]=i?i.clone():new r(0,1,0),a[2]=s?s.clone():new r(0,0,1),this.getDirectionsNotCloned=function(){return a}};return o.prototype.origin=null,o.prototype.clone=function(){return(new o).copy(this)},o.prototype.copy=function(e){t.TypeCheck(e,!0,t.Axis);var r=this.getDirectionsNotCloned(),n=e.getDirectionsNotCloned();return r[0].copy(n[0]),r[1].copy(n[1]),r[2].copy(n[2]),this.origin.copy(e.origin),this},o.prototype.setOrigin=function(e,r,o){return t.TypeCheck(e,!0,["number",t.Point]),t.TypeCheck(r,!1,"number"),t.TypeCheck(o,!1,"number"),e.constructor===n?this.origin.copy(e):this.origin.set(e,r||0,o||0),this},o.prototype.setVectors=function(e,n,o){t.TypeCheck(e,!0,t.Vector3D),t.TypeCheck(n,!0,t.Vector3D),t.TypeCheck(o,!0,t.Vector3D);var i=this.getDirectionsNotCloned();return i[0].copy(e),i[1].copy(n),i[2].copy(o),r.orthoNormalize(i[0],i[1],i[2]),this},o.prototype.setVectorsFromMatrix=function(e){t.TypeCheck(e,!0,t.Matrix3x3);var n=this.getDirectionsNotCloned();return e.getFirstColumn(n[0]),e.getSecondColumn(n[1]),e.getThirdColumn(n[2]),r.orthoNormalize(n[0],n[1],n[2]),this},o.prototype.getDirections=function(e){t.TypeCheck(e,!1,[t.Vector3D],3);var r=this.getDirectionsNotCloned();return e?(e[0].copy(r[0]),e[1].copy(r[1]),e[2].copy(r[2]),e):new Array(r[0].clone(),r[1].clone(),r[2].clone())},o.prototype.getFirstDirection=function(e){t.TypeCheck(e,!1,t.Vector3D);var r=this.getDirectionsNotCloned();return e=e?e.copy(r[0]):r[0].clone()},o.prototype.getSecondDirection=function(e){t.TypeCheck(e,!1,t.Vector3D);var r=this.getDirectionsNotCloned();return e=e?e.copy(r[1]):r[1].clone()},o.prototype.getThirdDirection=function(e){t.TypeCheck(e,!1,t.Vector3D);var r=this.getDirectionsNotCloned();return e=e?e.copy(r[2]):r[2].clone()},o.prototype.applyTransformation=function(e){t.TypeCheck(e,!0,t.Transformation);var r=this.getDirectionsNotCloned();return this.origin.applyTransformation(e),r[0].applyTransformation(e),r[1].applyTransformation(e),r[2].applyTransformation(e),e.matrix.isAnIsometry()||this.setVectors(r[0],r[1],r[2]),this},t.Axis=o,o}),define("MathematicsES/MathAxisJSImpl",["DS/MathematicsES/MathAxisJSImpl"],function(t){return t}),define("DS/MathematicsES/MathDebugUtils",["DS/MathematicsES/MathNameSpace"],function(t){"use strict";var e=function(){this._LEVEL=0};return e.prototype.IsActive=function(t){if(this._LEVEL>=t)return!0},e.prototype.PrintType=function(e){return void 0===e?"undefined":e instanceof Array?"Array":e.constructor===t.Point?"Point":e.constructor===t.Point2D?"Point2D":e.constructor===t.Line?"Line":e.constructor===t.Circle?"Circle":e.constructor===t.Ellipse?"Ellipse":e.constructor===t.NurbsCurve?"NurbsCurve":e.constructor===t.MinDist?"MinDist":e.constructor===t.MinDistPtCrv?"MinDistPtCrv":e.constructor===t.MinDistCrvCrv?"MinDistCrvCrv":e.constructor===t.Intersect?"Intersect":e.constructor===t.Direction?"Direction":"Unknown"},t.DebugUtils=e,e}),define("MathematicsES/MathDebugUtils",["DS/MathematicsES/MathDebugUtils"],function(t){return t}),define("DS/MathematicsES/MathQuaternionJSImpl",["DS/MathematicsES/MathNameSpace","DS/MathematicsES/MathTypeCheck","DS/MathematicsES/MathTypeCheckInternal","DS/MathematicsES/MathPointJSImpl","DS/MathematicsES/MathVector3DJSImpl","DS/MathematicsES/MathMat3x3JSImpl"],function(t,e,r,n,o,i){"use strict";var s=function(e,r,n,o){t.TypeCheck(e,!1,"number"),t.TypeCheck(r,!1,"number"),t.TypeCheck(n,!1,"number"),t.TypeCheck(o,!1,"number"),this.s=null==e?1:e,this.x=r||0,this.y=n||0,this.z=o||0};return s.prototype.x=null,s.prototype.y=null,s.prototype.z=null,s.prototype.s=null,s.prototype.clone=function(){return new s(this.s,this.x,this.y,this.z)},s.prototype.copy=function(e){return t.TypeCheck(e,!0,t.Quaternion),this.s=e.s,this.x=e.x,this.y=e.y,this.z=e.z,this},s.prototype.set=function(e,r,n,o){return t.TypeCheck(e,!0,"number"),t.TypeCheck(r,!0,"number"),t.TypeCheck(n,!0,"number"),t.TypeCheck(o,!0,"number"),this.s=e,this.x=r,this.y=n,this.z=o,this},s.prototype.setFromArray=function(e,r){return t.TypeCheck(e,!0,["number"],4),t.TypeCheck(r,!0,"number"),1===r?this.set(e[0],e[1],e[2],e[3]):this.set(e[3],e[0],e[1],e[2]),this},s.prototype.getArray=function(e){return t.TypeCheck(e,!0,"number"),1===e?new Array(this.s,this.x,this.y,this.z):new Array(this.x,this.y,this.z,this.s)},s.prototype.setVector=function(e){return t.TypeCheck(e,!0,t.Vector3D),this.x=e.x,this.y=e.y,this.z=e.z,this},s.prototype.getVector=function(e){return t.TypeCheck(e,!1,t.Vector3D),(e=e||new o).set(this.x,this.y,this.z),e},s.prototype.makeRotation=function(e,r){t.TypeCheck(e,!0,t.Vector3D),t.TypeCheck(r,!0,"number");var n=e.norm(),o=Math.sin(r/2),i=Math.cos(r/2);return this.s=i,this.x=e.x*o/n,this.y=e.y*o/n,this.z=e.z*o/n,this},s.prototype.makeRotationFromVectors=function(e,r){if(t.TypeCheck(e,!0,t.Vector3D),t.TypeCheck(r,!0,t.Vector3D),e.isParallel(r))this.set(1,0,0,0);else{var n=e.norm(),i=r.norm(),s=o.cross(e,r).divideScalar(n*i),a=s.norm(),c=Math.asin(a);s.divideScalar(a),this.makeRotation(s,c)}return this},s.prototype.norm=function(){return Math.sqrt(this.s*this.s+this.x*this.x+this.y*this.y+this.z*this.z)},s.prototype.squareNorm=function(){var t=this.s,e=this.x,r=this.y,n=this.z;return t*t+e*e+r*r+n*n},s.prototype.normalize=function(){var e=t.defaultTolerances.epsilonForRelativeTest,r=this.s*this.s+this.x*this.x+this.y*this.y+this.z*this.z,n=Math.abs(r-1)<=2*e?1:1/Math.sqrt(r);return this.s=this.s*n,this.x=this.x*n,this.y=this.y*n,this.z=this.z*n,this},s.prototype.getRotationData=function(e){t.TypeCheck(e,!1,Object),e=e||{angle:0,vector:new o};var r=this.norm();this.getVector(e.vector);var n=this.s/r;n<-1&&(n=-1),n>1&&(n=1),e.angle=2*Math.acos(n);var i=1-n*n;if(i>0){var s=Math.sqrt(i);e.vector.divideScalar(r*s)}else e.angle=0,e.vector.set(1,0,0);return e},s.prototype.getMatrix=function(e){t.TypeCheck(e,!1,t.Matrix3x3);var r=(e=e||new i).coef,n=this.squareNorm(),o=this.s*this.s/n,s=this.x*this.x/n,a=this.y*this.y/n,c=this.z*this.z/n,h=this.s*this.x/n,p=this.s*this.y/n,l=this.s*this.z/n,u=this.x*this.y/n,y=this.x*this.z/n,m=this.y*this.z/n;return r[0]=o+s-a-c,r[1]=2*(u-l),r[2]=2*(y+p),r[3]=2*(u+l),r[4]=o-s+a-c,r[5]=2*(m-h),r[6]=2*(y-p),r[7]=2*(m+h),r[8]=o-s-a+c,e},s.prototype.add=function(e){return t.TypeCheck(e,!0,t.Quaternion),this.s+=e.s,this.x+=e.x,this.y+=e.y,this.z+=e.z,this},s.prototype.addScaledQuaternion=function(e,r){return t.TypeCheck(e,!0,t.Quaternion),t.TypeCheck(r,!0,"number"),this.s+=e.s*r,this.x+=e.x*r,this.y+=e.y*r,this.z+=e.z*r,this},s.prototype.multiply=function(e,r){t.TypeCheck(e,!0,t.Quaternion),t.TypeCheck(r,!1,Boolean);var n=(r=r||!1)?e:this,o=r?this:e,i=n.s,s=n.x,a=n.y,c=n.z,h=o.s,p=o.x,l=o.y,u=o.z;return this.s=i*h-s*p-a*l-c*u,this.x=i*p+s*h+a*u-c*l,this.y=i*l-s*u+a*h+c*p,this.z=i*u+s*l-a*p+c*h,this},s.prototype.multiplyScalar=function(e,r){return t.TypeCheck(e,!0,"number"),t.TypeCheck(r,!0,Boolean),(r=arguments.length<2||r)&&(this.s*=e),this.x*=e,this.y*=e,this.z*=e,this},s.prototype.divideScalar=function(e,r){return t.TypeCheck(e,!0,"number"),t.TypeCheck(r,!1,Boolean),(r=arguments.length<2||r)&&(this.s/=e),this.x/=e,this.y/=e,this.z/=e,this},s.prototype.conjugate=function(){return this.x*=-1,this.y*=-1,this.z*=-1,this},s.prototype.dot=function(e){return t.TypeCheck(e,!0,t.Quaternion),this.s*e.s+this.x*e.x+this.y*e.y+this.z*e.z},s.prototype.lerp=function(e,r,n){t.TypeCheck(e,!0,t.Quaternion),t.TypeCheck(r,!0,"number"),t.TypeCheck(n,!1,Boolean),n=arguments.length<3||n;var o=this.norm(),i=e.norm(),s=this.dot(e)/(o*i)<=-t.defaultTolerances.epsgForAngleTest&&n?-1:1,a=(1-r)/o,c=s*r/i;return this.s=s*(this.s*a+e.s*c),this.x=s*(this.x*a+e.x*c),this.y=s*(this.y*a+e.y*c),this.z=s*(this.z*a+e.z*c),this.normalize()},s.prototype.slerp=function(e,r,n){t.TypeCheck(e,!0,t.Quaternion),t.TypeCheck(r,!0,"number"),t.TypeCheck(n,!1,Boolean),n=arguments.length<3||n;var o=this.norm(),i=e.norm(),s=this.dot(e)/(o*i);if(s*s<1-t.defaultTolerances.epsgForSquareAngleTest){var a=s<=-t.defaultTolerances.epsgForAngleTest&&n?-1:1,c=Math.acos(a*s),h=Math.sqrt(1-s*s),p=Math.sin((1-r)*c)/(h*o),l=a*Math.sin(r*c)/(h*i);this.s=a*(this.s*p+e.s*l),this.x=a*(this.x*p+e.x*l),this.y=a*(this.y*p+e.y*l),this.z=a*(this.z*p+e.z*l)}else 1!=r||n?this.divideScalar(o):this.copy(e).divideScalar(i);return this},s.makeRotation=function(e,r){return t.TypeCheck(e,!0,t.Vector3D),t.TypeCheck(r,!0,"number"),(new s).makeRotation(e,r)},s.makeRotationFromVectors=function(e,r){return t.TypeCheck(e,!0,t.Vector3D),t.TypeCheck(r,!0,t.Vector3D),(new s).makeRotationFromVectors(e,r)},s.multiply=function(e,r,n){return t.TypeCheck(e,!0,t.Quaternion),t.TypeCheck(r,!0,t.Quaternion),t.TypeCheck(n,!1,t.Quaternion),n=n?n===r?n.multiply(e,!0):n.copy(e).multiply(r):e.clone().multiply(r)},s.lerp=function(e,r,n,o,i){return t.TypeCheck(e,!0,t.Quaternion),t.TypeCheck(r,!0,t.Quaternion),t.TypeCheck(n,!0,"number"),t.TypeCheck(o,!1,Boolean),t.TypeCheck(i,!1,t.Quaternion),o=arguments.length<4||o,i=i?i===r?i.lerp(e,1-n,o):i.copy(e).lerp(r,n,o):e.clone().lerp(r,n,o)},s.slerp=function(e,r,n,o,i){return t.TypeCheck(e,!0,t.Quaternion),t.TypeCheck(r,!0,t.Quaternion),t.TypeCheck(n,!0,"number"),t.TypeCheck(o,!1,Boolean),t.TypeCheck(i,!1,t.Quaternion),o=arguments.length<4||o,i=i?i===r?i.slerp(e,1-n,o):i.copy(e).slerp(r,n,o):e.clone().slerp(r,n,o)},t.Quaternion=s,s}),define("MathematicsES/MathQuaternionJSImpl",["DS/MathematicsES/MathQuaternionJSImpl"],function(t){return t}),define("DS/MathematicsES/TransformationJSImpl",["DS/MathematicsES/MathNameSpace","DS/MathematicsES/MathTypeCheck","DS/MathematicsES/MathTypeCheckInternal","DS/MathematicsES/MathPointJSImpl","DS/MathematicsES/MathVector3DJSImpl","DS/MathematicsES/MathMat3x3JSImpl","DS/MathematicsES/MathLineJSImpl","DS/MathematicsES/MathAxisJSImpl"],function(t,e,r,n,o,i,s,a){"use strict";var c=function(e,r){t.TypeCheck(e,!1,t.Matrix3x3),t.TypeCheck(r,!1,t.Vector3D),this.matrix=e?e.clone():i.identity.clone(),this.vector=r?r.clone():new o(0,0,0)};return c.prototype.constructor=c,c.prototype.matrix=null,c.prototype.vector=null,c.prototype.clone=function(){return(new c).copy(this)},c.prototype.copy=function(e){return t.TypeCheck(e,!0,t.Transformation),this.matrix.copy(e.matrix),this.vector.copy(e.vector),this},c.prototype.setRotation=function(e,r){return t.TypeCheck(e,!0,t.Vector3D),t.TypeCheck(r,!0,"number"),this.matrix.makeRotation(e,r),this},c.prototype.setRotationFromEuler=function(e){return t.TypeCheck(e,!0,["number"],3),this.matrix.makeRotationFromEuler(e),this},c.prototype.setVector=function(e,r,n){return t.TypeCheck(e,!0,["number",t.Vector3D]),t.TypeCheck(r,!1,"number"),t.TypeCheck(n,!1,"number"),e.constructor===o?this.vector.copy(e):this.vector.set(e,r||0,n||0),this},c.prototype.makeScaling=function(e,r){return t.TypeCheck(e,!0,"number"),t.TypeCheck(r,!1,t.Point),this.matrix.makeScaling(e),r?(r.sub(n.origin,this.vector),this.vector.multiplyScalar(1-e)):this.vector.set(0,0,0),this},c.prototype.makeRotation=function(e,r,n){if(t.TypeCheck(e,!0,t.Vector3D),t.TypeCheck(r,!0,"number"),t.TypeCheck(n,!1,t.Point),this.setRotation(e,r),n){var o=n.clone().applyMatrix3x3(this.matrix);n.sub(o,this.vector)}else this.vector.set(0,0,0);return this},c.prototype.makeRotationFromEuler=function(e,r){if(t.TypeCheck(e,!0,["number"],3),t.TypeCheck(r,!1,t.Point),this.setRotationFromEuler(e),r){var n=r.clone().applyMatrix3x3(this.matrix);r.sub(n,this.vector)}else this.vector.set(0,0,0);return this},c.prototype.setFromArray=function(e,r){t.TypeCheck(e,!0,["number"],12),t.TypeCheck(r,!1,"number");var n=this.matrix.coef,o=this.vector;if(1==(r=r||0))n[0]=e[0],n[1]=e[1],n[2]=e[2],o.x=e[3],n[3]=e[4],n[4]=e[5],n[5]=e[6],o.y=e[7],n[6]=e[8],n[7]=e[9],n[8]=e[10],o.z=e[11];else{var i=16==e.length&&0==r?1:0,s=i;n[0]=e[0],n[3]=e[1],n[6]=e[2],n[1]=e[3+s],n[4]=e[4+s],n[7]=e[5+s],s+=i,n[2]=e[6+s],n[5]=e[7+s],n[8]=e[8+s],s+=i,o.x=e[9+s],o.y=e[10+s],o.z=e[11+s]}return this},c.prototype.getArray=function(e){t.TypeCheck(e,!1,"number");var r=this.matrix.coef,n=this.vector;return 0==(e=e||0)?[r[0],r[3],r[6],r[1],r[4],r[7],r[2],r[5],r[8],n.x,n.y,n.z]:[r[0],r[1],r[2],n.x,r[3],r[4],r[5],n.y,r[6],r[7],r[8],n.z]},c.prototype.getEuler=function(){return this.matrix.getEuler()},c.prototype.inverse=function(){return this.matrix.inverse(),this.vector.applyMatrix3x3(this.matrix).negate(),this},c.prototype.getInverse=function(e){return t.TypeCheck(e,!1,t.Transformation),(e=e?e.copy(this):this.clone()).inverse()},c.prototype.multiply=function(e,r){if(t.TypeCheck(e,!0,t.Transformation),t.TypeCheck(r,!1,Boolean),r=r||!1){var n=e.vector===this?this.vector.clone():this.vector;n.applyMatrix3x3(e.matrix).add(e.vector),this.vector.copy(n)}else{var o=e.vector.clone().applyMatrix3x3(this.matrix);this.vector.add(o)}return this.matrix.multiply(e.matrix,r),this},c.prototype.multiplyByEuler=function(e,r){t.TypeCheck(e,!0,["number"],3),t.TypeCheck(r,!1,Boolean);var n=c.makeRotationFromEuler(e);return this.multiply(n,r)},c.prototype.multiplyByScaling=function(e,r,n){t.TypeCheck(e,!0,"number"),t.TypeCheck(r,!1,t.Point),t.TypeCheck(n,!1,Boolean),n=n||!1;var o=c.makeScaling(e,r||void 0);return this.multiply(o,n)},c.prototype.getScaling=function(){var e={scale:-1,center:new t.Point(0,0,0)},r=t.defaultTolerances.epsgForRelativeTest;if(this.matrix.isScaling(e)){if(Math.abs(e.scale-1)>=r){var n=this.matrix.getTranspose().multiplyScalar(1/e.scale);e.center.set(this.vector.x,this.vector.y,this.vector.z),e.center.applyMatrix3x3(n).divideScalar(1-e.scale)}}else e.scale=-1;return e},c.prototype.isScaling=function(e){return t.TypeCheck(e,!1,Object),this.matrix.isScaling(e)},c.prototype.isReflecting=function(){return this.matrix.isReflecting()},c.prototype.isAScaling=function(e){return t.TypeCheck(e,!1,Object),this.matrix.isAScaling(e)},c.prototype.isARotation=function(e){return t.TypeCheck(e,!1,Object),e?this.matrix.isARotation(e):this.matrix.isARotation()},c.prototype.isIdentity=function(){var e=!1,r=this.matrix.coef,n=t.defaultTolerances.epsgForRelativeTest,o=Math.abs(r[0]-1),i=Math.abs(r[4]-1),s=Math.abs(r[8]-1),a=Math.abs(r[1]),c=Math.abs(r[2]),h=Math.abs(r[3]),p=Math.abs(r[5]),l=Math.abs(r[6]),u=Math.abs(r[7]);return o<=n&&i<=n&&s<=n&&a<=n&&c<=n&&h<=n&&p<=n&&l<=n&&u<=n&&(e=!0),e},c.makeRotation=function(e,r,n){return t.TypeCheck(e,!0,t.Vector3D),t.TypeCheck(r,!0,"number"),t.TypeCheck(n,!1,t.Point),(new c).makeRotation(e,r,n||void 0)},c.makeRotationFromEuler=function(e,r){return t.TypeCheck(e,!0,["number"],3),t.TypeCheck(r,!1,t.Point),(new c).makeRotationFromEuler(e,r||void 0)},c.makeScaling=function(e,r){return t.TypeCheck(e,!0,"number"),t.TypeCheck(r,!1,t.Point),(new c).makeScaling(e,r||void 0)},c.multiply=function(e,r,n){return t.TypeCheck(e,!0,t.Transformation),t.TypeCheck(r,!0,t.Transformation),t.TypeCheck(n,!1,t.Transformation),n=n?n===r?n.multiply(e,!0):n.copy(e).multiply(r):e.clone().multiply(r)},t.Transformation=c,c}),define("MathematicsES/TransformationJSImpl",["DS/MathematicsES/TransformationJSImpl"],function(t){return t}),define("DS/MathematicsES/MathLine2DJSImpl",["DS/MathematicsES/MathNameSpace","DS/MathematicsES/MathTypeCheck","DS/MathematicsES/MathTypeCheckInternal","DS/MathematicsES/MathPoint2DJSImpl","DS/MathematicsES/MathVector2DJSImpl"],function(t,e,r,n,o){"use strict";var i=function(e,r){t.TypeCheck(e,!1,t.Point2D),t.TypeCheck(r,!1,t.Vector2D),this.origin=e?e.clone():new n(0,0),this.direction=r?r.clone():new o(1,0)};return i.prototype.origin=null,i.prototype.direction=null,Object.defineProperty(i.prototype,"scale",{enumerable:!0,configurable:!0,get:function(){return this.getScale()},set:function(t){return this.setScale(t)}}),i.prototype.clone=function(){return(new i).copy(this)},i.prototype.copy=function(e){return t.TypeCheck(e,!0,t.Line2D),this.origin.copy(e.origin),this.direction.copy(e.direction),this},i.prototype.set=function(e,r,n,o){return t.TypeCheck(e,!1,"number"),t.TypeCheck(r,!1,"number"),t.TypeCheck(n,!1,"number"),t.TypeCheck(o,!1,"number"),this.origin.set(e||0,r||0),this.direction.set(n||0,o||0),this},i.prototype.setOrigin=function(e,r,o){return t.TypeCheck(e,!0,["number",t.Point2D]),t.TypeCheck(r,!1,"number"),t.TypeCheck(o,!1,"number"),e.constructor===n?this.origin.copy(e):this.origin.set(e,r||0,o||0),this},i.prototype.setDirection=function(e,r,n){return t.TypeCheck(e,!0,["number",t.Vector2D]),t.TypeCheck(r,!1,"number"),t.TypeCheck(n,!1,"number"),e.constructor===o?this.direction.copy(e):this.direction.set(e,r||0,n||0),this},i.prototype.setScale=function(e){return t.TypeCheck(e,!0,"number"),Math.abs(e)>t.defaultTolerances.epsgForLengthTest&&(this.direction.normalize(),this.direction.multiplyScalar(e)),this},i.prototype.getScale=function(){return this.direction.norm()},i.prototype.evalPoint=function(e,r){return t.TypeCheck(e,!0,"number"),t.TypeCheck(r,!1,t.Point2D),(r=r?op.copy(this.origin):this.origin.clone()).addScaledVector(this.direction,e)},i.prototype.squareDistanceToPoint=function(e){t.TypeCheck(e,!0,t.Point2D);var r=this.direction,n=this.origin.sub(e).cross(r);return n*n/r.squareNorm()},i.prototype.distanceToPoint=function(e){return t.TypeCheck(e,!0,t.Point2D),Math.sqrt(this.squareDistanceToPoint(e))},i.prototype.getParam=function(e,r,n,o){t.TypeCheck(e,!0,t.Point2D),t.TypeCheck(r,!0,"number"),t.TypeCheck(n,!0,"number"),t.TypeCheck(o,!1,"number");var i=[],s=e.sub(this.origin),a=s.dot(this.direction)/this.direction.squareNorm();return a=a<r?r:n<a?n:a,(s=this.evalPoint(a).sub(e,s)).squareNorm()<o*o&&(i[0]=a),i},i.prototype.intersectLine=function(e,r,n,o,i,s){t.TypeCheck(e,!0,t.Line2D),t.TypeCheck(r,!0,"number"),t.TypeCheck(n,!0,"number"),t.TypeCheck(o,!0,"number"),t.TypeCheck(i,!0,"number"),t.TypeCheck(s,!1,"number"),s=s||t.defaultTolerances.epsgForRelativeTest;var a=t.defaultTolerances.epsgForSquareRelativeTest*Math.max(1,this.origin.squareDistanceToOrigin()),c={param1:0,param2:0,diag:-1},h=this.direction,p=h.norm(),l=e.direction,u=l.norm(),y=-h.x*l.y+h.y*l.x;if(Math.abs(y)>t.defaultTolerances.epsgForRelativeTest*p*u){var m=e.origin.sub(this.origin),f=(-l.y*m.x+l.x*m.y)/y,v=(-h.y*m.x+h.x*m.y)/y;v=v<r?r:v>n?n:v,f=f<o?o:f>i?i:f;var g=this.evalPoint(v),C=e.evalPoint(f);g.squareDistanceTo(C)<s*s&&(c.param1=v,c.param2=f,c.diag=0)}else e.squareDistanceToPoint(this.origin)<a&&(c.diag=1);return c},i.prototype.intersectFullLine=function(e,r){t.TypeCheck(e,!0,t.Line2D),t.TypeCheck(r,!1,"number"),r=r||t.defaultTolerances.epsgForRelativeTest;var n=t.defaultTolerances.epsgForSquareRelativeTest*Math.max(1,this.origin.squareDistanceToOrigin()),o={param1:0,param2:0,diag:-1},i=this.direction,s=i.norm(),a=e.direction,c=a.norm(),h=-i.x*a.y+i.y*a.x;if(Math.abs(h)>t.defaultTolerances.epsgForRelativeTest*s*c){var p=e.origin.sub(this.origin);o.diag=0,o.param1=(-a.y*p.x+a.x*p.y)/h,o.param2=(-i.y*p.x+i.x*p.y)/h}else e.squareDistanceToPoint(this.origin)<n&&(o.diag=1);return o},i.makeFromPoints=function(e,r,n,o){t.TypeCheck(e,!0,t.Point2D),t.TypeCheck(r,!0,t.Point2D),t.TypeCheck(n,!1,"number"),t.TypeCheck(o,!1,"number");var i=new t.Line2D;return r.sub(e,i.direction),arguments.length>=4&&Math.abs(o-n)>t.defaultTolerances.epsgForLengthTest?i.setScale(i.direction.norm()/(o-n)):i.setScale(1),i.origin.copy(e),n&&i.origin.addScaledVector(i.direction,-n),i},t.Line2D=i,i}),define("MathematicsES/MathLine2DJSImpl",["DS/MathematicsES/MathLine2DJSImpl"],function(t){return t}),define("DS/MathematicsES/MathDeprecated",["DS/MathematicsES/MathNameSpace","DS/MathematicsES/MathAxisJSImpl","DS/MathematicsES/MathLineJSImpl","DS/MathematicsES/MathMat3x3JSImpl","DS/MathematicsES/MathPlaneJSImpl","DS/MathematicsES/MathPointJSImpl","DS/MathematicsES/MathQuaternionJSImpl","DS/MathematicsES/MathVector2DJSImpl","DS/MathematicsES/MathVector3DJSImpl","DS/MathematicsES/MathCircleJSImpl","DS/MathematicsES/TransformationJSImpl"],function(t){"use strict";return t.Vector2D.prototype.addVectorToVector=function(t){return this.add(t)},t.Vector2D.prototype.subVectorFromVector=function(t){return this.sub(t)},t.Vector2D.prototype.cross2D=function(t){return this.x*t.y-this.y*t.x},t.Vector2D.prototype.multiplyVector=function(t){return this.multiplyScalar(t)},t.Vector2D.prototype.divideVector=function(t){return this.divideScalar(t)},t.Vector2D.prototype.vectEquals=function(t,e){return this.isEqual(t,e)},t.Vector2D.prototype.setCoord=function(t,e){return this.x=t,this.y=e,this},t.normalize2D=function(t,e){return(e=arguments.length<2?t.clone():e.copy(t)).normalize()},t.addVectorToVector2D=function(t,e,r){return(r=arguments.length<3?t.clone():r.copy(t)).add(e)},t.subVectorFromVector2D=function(t,e,r){return(r=arguments.length<3?t.clone():r.copy(t)).sub(e)},t.dot2D=function(t,e,r){return t.x*e.x+t.y*e.y},t.negate2D=function(e,r){return arguments.length<2&&(r=new t.Vector2D),r.x=-e.x,r.y=-e.y,r},t.multiplyVector2D=function(e,r,n){return arguments.length<3&&(n=new t.Vector2D),n.x=e.x*r,n.y=e.y*r,n},t.divideVector2D=function(e,r,n){return arguments.length<3&&(n=new t.Vector2D),n.x=e.x/r,n.y=e.y/r,n},t.Vector3D.prototype.addVectorToVector=function(t){return this.add(t)},t.Vector3D.prototype.subVectorFromVector=function(t){return this.sub(t)},t.Vector3D.prototype.multiplyVector=function(t){return this.multiplyScalar(t)},t.Vector3D.prototype.divideVector=function(t){return this.divideScalar(t)},t.Vector3D.prototype.setCoord=function(t,e,r){this.x=t,this.y=e,this.z=r},t.normalize=function(t,e){return(e=arguments.length<2?t.clone():e.copy(t)).normalize()},t.addVectorToVector=function(t,e,r){return(r=arguments.length<3?t.clone():r.copy(t)).add(e)},t.subVectorFromVector=function(e,r,n){return arguments.length<3&&(n=new t.Vector3D),n.x=e.x-r.x,n.y=e.y-r.y,n.z=e.z-r.z,n},t.negate=function(e,r){return arguments.length<2&&(r=new t.Vector3D(e.x,e.y,e.z)),r.x*=-1,r.y*=-1,r.z*=-1,r},t.multiplyVector=function(t,e,r){return(r=arguments.length<3?t.clone():r.copy(t)).multiplyScalar(e)},t.divideVector=function(t,e,r){return(r=arguments.length<3?t.clone():r.copy(t)).divideScalar(e)},t.cross=function(e,r,n){return arguments.length<3&&(n=new t.Vector3D),n.x=e.y*r.z-e.z*r.y,n.y=e.z*r.x-e.x*r.z,n.z=e.x*r.y-e.y*r.x,n},t.Point.prototype.addPointToPoint=function(t){return this.add(t)},t.Point.prototype.addVectorToPoint=function(t){return this.addVector(t)},t.Point.prototype.subPointFromPoint=function(e,r){return r=r||new t.Vector3D,this.sub(e,r)},t.Point.prototype.subVectorFromPoint=function(t){return this.subVector(t)},t.Point.prototype.vectorFromPoints=function(e,r){return r=r||new t.Vector3D,this.sub(e,r)},t.Point.prototype.ptPtSquareDistanceTo=function(t){return this.squareDistanceTo(t)},t.Point.prototype.ptPtDistanceTo=function(t){return this.distanceTo(t)},t.Point.prototype.ptPtsDistanceTo=function(t){return this.distanceToPointArray(t)},t.Point.prototype.multiplyPoint=function(t){return this.multiplyScalar(t)},t.Point.prototype.dividePoint=function(t){return this.divideScalar(t)},t.Point.prototype.setCoord=function(t,e,r){return this.set(t,e,r)},t.addPointToPoint=function(t,e,r){return(r=arguments.length<3?t.clone():r.copy(t)).add(e)},t.addVectorToPoint=function(e,r,n){return arguments.length<3&&(n=new t.Point),n.x=e.x+r.x,n.y=e.y+r.y,n.z=e.z+r.z,n},t.subPointFromPoint=function(e,r,n){return n=n||new t.Vector3D,e.sub(r,n)},t.subVectorFromPoint=function(e,r,n){return arguments.length<3&&(n=new t.Point),n.x=e.x-r.x,n.y=e.y-r.y,n.z=e.z-r.z,n},t.vectorFromPoints=function(e,r,n){return n=n||new t.Vector3D,e.sub(r,n)},t.ptPtSquareDistanceTo=function(t,e){return t.squareDistanceTo(e)},t.ptPtDistanceTo=function(t,e){return t.distanceTo(e)},t.ptPtsDistanceTo=function(t,e,r){var n=0,o=(r=0,e.length),i=(t.x-e[0].x)*(t.x-e[0].x)+(t.y-e[0].y)*(t.y-e[0].y)+(t.z-e[0].z)*(t.z-e[0].z);for(n=1;n<o;n++)if((r=(t.x-e[n].x)*(t.x-e[n].x)+(t.y-e[n].y)*(t.y-e[n].y)+(t.z-e[n].z)*(t.z-e[n].z))<i){i=r}return r=Math.sqrt(i)},t.multiplyPoint=function(t,e,r){return(r=arguments.length<3?t.clone():r.copy(t)).multiplyScalar(e)},t.dividePoint=function(t,e,r){return(r=arguments.length<3?t.clone():r.copy(t)).divideScalar(e)},t.Matrix3x3.prototype.setCoef=function(t){this.coef=[t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8]]},t.Matrix3x3.prototype.getCoef=function(t){return t=t||new Array(9),this.getArray(0,t)},t.Matrix3x3.prototype.setRotation=function(t,e){var r=t.normalize(),n=r.x,o=r.y,i=r.z,s=n*n,a=o*o,c=i*i,h=n*o,p=n*i,l=o*i,u=Math.sin(e),y=Math.cos(e),m=[s+(a+c)*y,h-h*y-i*u,p-p*y+o*u,h-h*y+i*u,a+(s+c)*y,l-l*y-n*u,p-p*y-o*u,l-l*y+n*u,c+(s+a)*y];this.coef=m},t.Matrix3x3.prototype.diagonalMatrix=function(t,e,r){var n=[t,0,0,0,e,0,0,0,r];this.coef=n},t.Matrix3x3.prototype.scalarMatrix=function(t){var e=[t,0,0,0,t,0,0,0,t];this.coef=e},t.Matrix3x3.prototype.addMatrixToMatrix=function(t){return this.add(t)},t.Matrix3x3.prototype.subMatrixFromMatrix=function(t){return this.sub(t)},t.Matrix3x3.prototype.multiplyMatrixByMatrix=function(e){return t.multiplyMatrixByMatrix(this,e,this)},t.Matrix3x3.prototype.multiplyMatrix=function(t){return this.multiplyScalar(t)},t.Matrix3x3.prototype.multiplyMatrixByVector=function(t){return t.clone().applyMatrix3x3(this)},t.Matrix3x3.prototype.computeMatrixType=function(){var e=t.defaultTolerances.epsgForRelativeTest,r=t.defaultTolerances.epsilonForSquareRelativeTest,n=this.getFirstColumn(),o=this.getSecondColumn(),i=this.getThirdColumn(),s=n.norm(),a=o.norm(),c=i.norm(),h=n.dot(o);if(Math.abs(h)>e*s*a)return 0;var p=n.dot(i);if(Math.abs(p)>e*s*c)return 0;var l=o.dot(i);if(Math.abs(l)>e*a*c)return 0;var u=this.determinant();if(u*u<r)return 0;if(Math.abs(s-1)<e&&Math.abs(a-1)<e&&Math.abs(c-1)<e)return u>0?1:-1;var y=Math.pow(Math.abs(u),1/3);return Math.abs(s/y-1)>e?0:Math.abs(a/y-1)>e?0:Math.abs(c/y-1)>e?0:u>0?2:-2},t.addMatrixToMatrix=function(t,e,r){return(r=arguments.length<3?t.clone():r.copy(t)).add(e)},t.subMatrixFromMatrix=function(t,e,r){return(r=arguments.length<3?t.clone():r.copy(t)).sub(e)},t.multiplyMatrixByMatrix=function(e,r,n){var o,i,s,a,c,h,p,l,u;arguments.length<3&&(n=new t.Matrix3x3);var y=e.getCoef(),m=r.getCoef(),f=y[0],v=y[1],g=y[2],C=y[3],D=y[4],T=y[5],S=y[6],d=y[7],M=y[8],k=m[0],b=m[1],x=m[2],I=m[3],P=m[4],E=m[5],V=m[6],_=m[7],w=m[8];return o=f*k+v*I+g*V,a=f*b+v*P+g*_,p=f*x+v*E+g*w,i=C*k+D*I+T*V,c=C*b+D*P+T*_,l=C*x+D*E+T*w,s=S*k+d*I+M*V,h=S*b+d*P+M*_,u=S*x+d*E+M*w,n.coef=[o,a,p,i,c,l,s,h,u],n},t.multiplyMatrix=function(t,e,r){return(r=arguments.length<3?t.clone():r.copy(t)).multiplyScalar(e)},t.multiplyMatrixByVector=function(t,e,r){var n=t.multiplyMatrixByVector(e);return arguments.length>=3&&r.copy(n),n},t.Transformation.prototype.setEuler=function(t){var e=Math.cos(t[1]),r=Math.sin(t[1]),n=Math.cos(t[2]),o=Math.sin(t[2]),i=Math.cos(t[0]),s=Math.sin(t[0]),a=[n*i-r*o*s,-e*s,i*o+n*r*s,i*r*o+n*s,e*i,o*s-n*i*r,-e*o,r,e*n];this.matrix.coef=a},t.Transformation.prototype.setEulerRotation=function(t){return this.multiplyByEuler(t)},t.Transformation.prototype.setCoefficients=function(t){var e=[t[0],t[3],t[6],t[1],t[4],t[7],t[2],t[5],t[8]];this.matrix.coef=e,this.vector.setCoord(t[9],t[10],t[11])},t.Transformation.prototype.getCoefficients=function(){return this.getArray()},t.Transformation.prototype.multiplyTransfo=function(t,e){return e=e||!1,this.multiply(t,e)},t.Transformation.prototype.setScaling=function(e){var r=new t.Transformation;return r.matrix.makeScaling(e.scale),e.center.sub(t.Point.origin,r.vector),r.vector.multiplyScalar(1-e.scale),this.multiplyTransfo(r),this},t.Transformation.prototype.isRotation=function(){var t=!1,e=Math.pow(10,-15);return Math.abs(this.matrix.determinant()-1)<=e&&(t=!this.isIdentity()),t},t.Transformation.prototype.applyToPoint=function(e,r){var n=arguments.length<2?new t.Point:r,o=this.matrix.coef;return n.x=o[0]*e.x+o[1]*e.y+o[2]*e.z+this.vector.x,n.y=o[3]*e.x+o[4]*e.y+o[5]*e.z+this.vector.y,n.z=o[6]*e.x+o[7]*e.y+o[8]*e.z+this.vector.z,n},t.Transformation.prototype.applyToVector=function(e,r){var n=arguments.length<2?new t.Vector3D:r,o=this.matrix.coef;return n.x=o[0]*e.x+o[1]*e.y+o[2]*e.z,n.y=o[3]*e.x+o[4]*e.y+o[5]*e.z,n.z=o[6]*e.x+o[7]*e.y+o[8]*e.z,n},t.Transformation.prototype.applyToLine=function(e,r){var n=arguments.length<2?new t.Line:r;return this.applyToPoint(e.origin,n.origin),this.applyToVector(e.direction,n.direction),n},t.Transformation.prototype.applyToAxis=function(t,e){return(e=arguments.length<2?t.clone():e.copy(t)).applyTransformation(this)},t.Transformation.prototype.computeInverse=function(){var e=new t.Transformation;return this.matrix.getInverse(e.matrix),e.vector.copy(this.vector),e.vector.applyMatrix3x3(e.matrix).negate(),e},t.multiplyTransfo=function(t,e,r){return(r=arguments.length<3?t.clone():r.copy(t)).multiply(e)},t.Quaternion.prototype.setQuatCoord=function(t,e){return this.setFromArray(t,e)},t.Quaternion.prototype.getQuatCoord=function(t){return this.getArray(t)},t.Quaternion.prototype.getScalar=function(){return this.s},t.Quaternion.prototype.setScalar=function(t){this.s=t},t.Quaternion.prototype.setRotationData=function(t){return this.s=Math.cos(t.angle/2),this.x=t.vector.x*Math.sin(t.angle/2),this.y=t.vector.y*Math.sin(t.angle/2),this.z=t.vector.z*Math.sin(t.angle/2),this},t.Quaternion.prototype.length=function(){return this.norm()},t.Quaternion.prototype.quaternionToRotMatrix=function(){return this.getMatrix()},t.Quaternion.prototype.rotMatrixToQuaternion=function(t){return t.getQuaternion(this)},t.Quaternion.prototype.rotate=function(e){var r=this.squareNorm(),n=new t.Quaternion(0,e.x,e.y,e.z),o=t.multiplyQuatByQuat(this,n),i=t.conjugate(this);o.multiplyQuatByQuat(i),o.divideScalar(r);var s=new t.Point;return s.setCoord(o.x,o.y,o.z),s},t.Quaternion.prototype.multiplyQuatByQuat=function(t){var e=this.s,r=this.x,n=this.y,o=this.z,i=t.s,s=t.x,a=t.y,c=t.z;return this.s=e*i-r*s-n*a-o*c,this.x=e*s+r*i+n*c-o*a,this.y=e*a-r*c+n*i+o*s,this.z=e*c+r*a-n*s+o*i,this},t.multiplyQuatByQuat=function(t,e,r){return(r=arguments.length<3?t.clone():r.copy(t)).multiplyQuatByQuat(e)},t.conjugate=function(t,e){return(e=e?e.copy(t):t.clone()).conjugate()},t.Line.prototype.setOriginAndVector=function(t,e){this.origin=t,this.direction=e},t.Line.prototype.lnPtSquareDistanceTo=function(t){return this.squareDistanceToPoint(t)},t.Line.prototype.lnPtDistanceTo=function(t){return this.distanceToPoint(t)},t.Line.prototype.lnLnDistanceTo=function(e){var r={dist:0,param1:0,param2:0,diag:1},n=e.direction;e.origin;this.direction.normalize();this.origin;var o=this.direction,i=n.dot(o),s=this.origin.sub(e.origin);Math.abs(Math.abs(i-1))<Math.pow(10,-15)&&(r.dist=t.Vector3D.cross(n,e.direction).norm(),r.dist<Math.pow(10,-15)?r.diag=2:r.diag=0),r.param1=s.dot(n)-i*s.dot(o)/((1-i*i)*e.scale),r.param2=i*s.dot(n)-s.dot(o)/((1-i*i)*this.scale);var a=t.Vector3D.cross(n,o),c=a.norm();return r.dist=c>0?Math.abs(s.dot(a)/c):t.Vector3D.cross(s,n).norm(),r.diag=1,r},t.Line.prototype.lnLnIntersect=function(e,r,n,o,i,s){var a={param1:0,param2:0,diag:0},c=e.direction.dot(this.direction),h=c*c-1;if(Math.abs(h)>Math.pow(10,-15)){var p=t.vectorFromPoints(this.origin,e.origin),l=p.dot(e.direction),u=p.dot(this.direction),y=(u*c-l)/h,m=(u-l*c)/h;y<r*e.scale?y=r*e.scale:y>n*e.scale&&(y=n*e.scale),m<o*this.scale?m=o*this.scale:m>i*this.scale&&(m=i*this.scale);var f=t.addVectorToPoint(e.origin,t.multiplyVector(e.direction,y)),v=t.addVectorToPoint(this.origin,t.multiplyVector(this.direction,m));f.ptPtSquareDistanceTo(v)<s*s&&(a.param1=y/e.scale,a.param2=m/this.scale,a.diag=0),a.diag=1}return a},t.Plane.prototype.getVectors=function(e){return e=e||new Array(new t.Vector3D,new t.Vector3D),this.getDirections(e)},t.Plane.prototype.set3Points=function(t,e,r){return this.makeFromPoints(t,e,r)},t.Plane.prototype.setPointAndVectors=function(t,e,r){this.setOrigin(t).setVectors(e,r)},t.Plane.prototype.setOriginAndNormal=function(t,e){this.setOrigin(t).setNormal(e)},t.Plane.prototype.projectPointToPlane=function(t){return t.clone().projectOnPlane(this)},t.Plane.prototype.intersectLineAndPlane=function(e){var r={paramOnline:0,param1OnPlane:0,param2OnPlane:0,diagnosis:-1},n=e.origin,o=e.direction,i=this.getDirectionsNotCloned(),s=i[0].x,a=i[0].y,c=i[0].z,h=i[1].x,p=i[1].y,l=i[1].z,u=o.x,y=o.y,m=o.z,f=n.x,v=n.y,g=n.z,C=this.origin.x,D=this.origin.y,T=this.origin.z;C=f-C,D=v-D,T=g-T;var S=p*m-l*y,d=h*m-l*u,M=h*y-p*u,k=s*S-a*d+c*M;if(Math.abs(k)>=t.defaultTolerances.epsilonForRelativeTest)k=1/k,r.param1OnPlane=(C*S-D*d+T*M)*k,r.param2OnPlane=(s*(D*m-T*y)-a*(C*m-T*u)+c*(C*y-D*u))*k,r.paramOnLine=-(s*(p*T-l*D)-a*(h*T-l*C)+c*(h*D-p*C))*k,r.paramOnLine=r.paramOnLine/e.scale;else{r.paramOnLine=0,r.param1OnPlane=0,r.param2OnPlane=0;var b=new t.Vector3D;b.x=C,b.y=D,b.z=T;var x=t.Vector3D.cross(i[0],i[1]);Math.abs(b.dot(x))<1e-13?r.diagnosis=2:r.diagnosis=0}return r.diagnosis=1,r},t.Axis.prototype.getVectors=function(t){return this.getDirections(t||void 0)},t}),define("MathematicsES/MathDeprecated",["DS/MathematicsES/MathDeprecated"],function(t){return t}),define("DS/MathematicsES/MathIntersect3DJSImpl",["DS/MathematicsES/MathNameSpace","DS/MathematicsES/MathTypeCheck","DS/MathematicsES/MathTypeCheckInternal","DS/MathematicsES/MathGeometryUtils","DS/MathematicsES/MathPointJSImpl","DS/MathematicsES/MathPoint2DJSImpl","DS/MathematicsES/MathVector2DJSImpl","DS/MathematicsES/MathVector3DJSImpl","DS/MathematicsES/MathMat2x2JSImpl","DS/MathematicsES/MathLineJSImpl","DS/MathematicsES/MathCircleJSImpl","DS/MathematicsES/MathEllipseJSImpl","DS/MathematicsES/MathNurbsCurveJSImpl","DS/MathematicsES/MathPlaneJSImpl"],function(t,e,r,n,o,i,s,a,c,h,p,l,u,y){"use strict";var m=function(e,r,n,o,i,s){t.TypeCheck(e,!1,[t.Line,t.Circle,t.Ellipse,t.NurbsCurve]),t.TypeCheck(r,!1,[t.Plane]),t.TypeCheck(n,!1,"number"),t.TypeCheck(o,!1,"number"),t.TypeCheck(i,!1,["number"],2),t.TypeCheck(s,!1,["number"],2),this.crv=e||null,this.pln=r||null,this.rangeCrv=[n,o],this.rangePlnU=[i[0],s[0]],this.rangePlnV=[i[1],s[1]]};return m.prototype.CheckInputs=function(){return void 0!==this.crv&&null!==this.crv&&(void 0!==this.pln&&null!==this.pln&&(void 0!==this.tolLength&&null!==this.tolLength&&(void 0!==this._VERSION&&null!==this._VERSION&&(void 0!==this._VERSION_EXT&&null!==this._VERSION_EXT))))},m.prototype.Eval=function(e,r){t.TypeCheckInternal(e,!0,"number"),t.TypeCheckInternal(r,!0,"number");var n=this.crv.evalPoint(e),o=this.pln.origin,i=this.pln.getNormal();return r=n.sub(o).dot(i)},m.prototype.EvalStep=function(e,r){t.TypeCheckInternal(e,!0,"number");var n=this.crv.evalFirstDeriv(e),o=this.pln.getNormal();return-r/n.dot(o)},m.prototype.Solve=function(e,r){t.TypeCheckInternal(e,!0,"number"),t.TypeCheckInternal(r,!0,[],[]);var n=[];if(!this.SolveCrv(e,n))return!1;var o=this.crv.evalPoint(n[0]),i=this.pln.origin,s=o.sub(i),a=this.pln.getDirections(),c=a[0].dot(s),h=a[1].dot(s);return r[0]=new Array,r[0][0]=n[0],r[0][1]=c,r[0][2]=h,!0},m.prototype.SolveCrv=function(e,r){t.TypeCheckInternal(e,!0,"number"),t.TypeCheckInternal(r,!0,[],[]);for(var o=t.defaultTolerances.epsgForLengthTest,i=(Math.pow(o,2),this.Eval(e,i)),s=e,a=!1,c=0;c<1e4;){(i=this.Eval(s))*i,this._DEBUG>=2&&(console.log("  Iteration "+c),console.log("    at "+s),console.log("      --\x3e fX = "+i));var h=this.EvalStep(s,i);if(this._DEBUG>=2&&console.log("    step is: "+h),Math.abs(h)<o){this._DEBUG>=2&&console.log("    converged!"),a=!0;break}s+=h,!1===this.crv.IsInfinite()&&(s=n.prototype.PutInRange(this.crv,s,this.rangeCrv)),c++}return 1e4===c?(this._DEBUG>=1&&console.log("  Failed to converge after 10000 (= max) iterations"),!1):!1===a?(this._DEBUG>=1&&console.log("  Failed to converge after "+c+" iterations"),!1):(!0===this.crv.IsInfinite()&&(s=n.prototype.PutInRange(this.crv,s,this.rangeCrv)),r[0]=s,!0)},m.prototype.ComputeInits=function(e){if(t.TypeCheckInternal(e,!0,[],[]),this.crv.constructor!=h)if(this.crv.constructor!=p&&this.crv.constructor!=l)if(this.crv.constructor!=u)console.error("No implementation of init computation");else{var r=this.crv.GetKnotRange(),n=this.crv.ComputePolyline(),o=0;for(f=0;f<n.length;f++)o+=n[f].direction.norm();var i=0;for(f=0;f<n.length;f++){var s=n[f].direction.norm();if(n[f].evalPoint(0).sub(this.pln.origin).dot(this.pln.getNormal())*n[f].evalPoint(1).sub(this.pln.origin).dot(this.pln.getNormal())<0){var a=new t.Intersect(n[f],this.pln,0,1,[-1e5,-1e5],[1e5,1e5]).Run([.5,0,0]);if(a.length>0){var c=(i+a[0][0]*s)/o,y=r[0]+(r[1]-r[0])*c;e.push(y)}}i+=s}if(this._DEBUG>=1){console.log("Computed "+e.length+" NURBS inits");for(v=0;v<e.length;v++)console.log("  init-"+v+": "+e[v])}}else{for(var m=(this.rangeCrv[1]-this.rangeCrv[0])/2,f=0;f<=2;f++)e.push(this.rangeCrv[0]+f*m);if(this._DEBUG>=1){console.log("Computed "+e.length+" circle / ellipse inits");for(var v=0;v<e.length;v++)console.log("  init-"+v+": "+e[v])}}else{var g=.5*(this.rangeCrv[0]+this.rangeCrv[1]);if(e.push(g),this._DEBUG>=1){console.log("Computed "+e.length+" line inits");for(var v=0;v<e.length;v++)console.log("  init-"+v+": "+e[v])}}},m.prototype.Run=function(e){t.TypeCheck(e,!1,t.Point2D);var r=[];if(!this.CheckInputs())return r;var o=new Array;e?o[0]=e[0]:this.ComputeInits(o);for(var i=0;i<o.length;i++){if(this._DEBUG>=1){var s=this.crv.evalPoint(o[i]);console.log(""),console.log("Solve from init at: "+o[i]),console.log("  --\x3e at 3D point: "+s.getArray()+" on curve")}var a=[];if(!1!==this.Solve(o[i],a))if(0!=a.length){var c=a[0];this._DEBUG>=1&&(console.log("  --\x3e converged to (w,u,v) point: "+c),console.log("    --\x3e 3D point (crv): "+this.crv.evalPoint(c[0]).getArray()),console.log("    --\x3e 3D point (pln): "+this.pln.evalPoint(c[1],c[2]).getArray()));var h=n.prototype.PutInDomain(c[0],this.rangeCrv,this.tolLength),p=n.prototype.PutInDomain(c[1],this.rangePlnU,this.tolLength),l=n.prototype.PutInDomain(c[2],this.rangePlnV,this.tolLength);!1!==h[1]&&!1!==p[1]&&!1!==l[1]?(c[0]=h[0],c[1]=p[0],c[2]=l[0],r.push(c)):this._DEBUG>=1&&(console.log("  --\x3e converged to solution outside range"),!1===h[1]&&consoel.log("        outside the domain for the curve: "+this.rangeCrv),!1===p[1]&&console.log("        outside the domain for plane(U): "+this.rangePlnU),!1===l[1]&&console.log("        outside the domain for plane(V): "+this.rangePlnV))}else this._DEBUG>=1&&console.log("  --\x3e solve was OK but no solution found");else this._DEBUG>=1&&console.log("  --\x3e failed to converge")}var u=[];for(i=0;i<r.length;i++){for(var y=!0,m=0;m<u.length&&!0===y;m++){var f=!0;if(Math.abs(r[i][0]-u[m][0])<this.tolLength)f=!1;else{for(var v=0,g=1;g<=2;g++)v+=(r[i][g]-u[m][g])*(r[i][g]-u[m][g]);v<this.tolLength*this.tolLength&&(f=!1)}f||(y=!1)}!0===y&&u.push(r[i].slice())}return u},t.Intersect3D=m,m}),define("MathematicsES/MathIntersect3DJSImpl",["DS/MathematicsES/MathIntersect3DJSImpl"],function(t){return t}),define("DS/MathematicsES/MathMinDistCrvCrvJSImpl",["DS/MathematicsES/MathNameSpace","DS/MathematicsES/MathTypeCheck","DS/MathematicsES/MathTypeCheckInternal","DS/MathematicsES/MathDebugUtils","DS/MathematicsES/MathPointJSImpl","DS/MathematicsES/MathVector3DJSImpl","DS/MathematicsES/MathLineJSImpl","DS/MathematicsES/MathCircleJSImpl","DS/MathematicsES/MathEllipseJSImpl","DS/MathematicsES/MathNurbsCurveJSImpl"],function(t,e,r,n,o,i,s,a,c){"use strict";var h=function(e,r,n,o){t.TypeCheck(e,!0,[t.Line,t.Circle,t.Ellipse,t.NurbsCurve]),t.TypeCheck(r,!0,["number"],2),t.TypeCheck(n,!0,[t.Line,t.Circle,t.Ellipse,t.NurbsCurve]),t.TypeCheck(o,!0,["number"],2),this.hasSol=!1,this.crv1=e||null,this.crv2=n||null,this.range1=[r[0],r[1]],this.range2=[o[0],o[1]]};return h.prototype.tolLength=1e-6,h.prototype.tolAngle=1e-8,h.prototype._VERSION=0,h.prototype._VERSION_EXT=0,h.prototype._DEBUG=new t.DebugUtils,h.prototype._CAPTURE=0,h.prototype.IsSolution=function(e,r,n){t.TypeCheckInternal(e,!0,t.Point2D),t.TypeCheckInternal(r,!1,t.Vector3D),t.TypeCheckInternal(n,!1,[t.Vector3D],2);var o=r,i=n;if(void 0!==o&&void 0!==i||(o=new t.Vector3D,(i=[]).push(new t.Vector3D),i.push(new t.Vector3D),this.Eval(e,o,i)),o.squareNorm()<this.tolLength*this.tolLength)return!0;for(var s=!0,a=0;a<2&&!0===s;a++){var c=o.getAngleTo(i[a])-Math.PI/2;Math.abs(c)>this.tolAngle&&(s=!1)}return s},h.prototype.Eval=function(e,r,n,o){t.TypeCheckInternal(e,!0,t.Point2D),t.TypeCheckInternal(r,!1,t.Vector3D),t.TypeCheckInternal(n,!1,[t.Vector3D],2),t.TypeCheckInternal(o,!1,[],[]);var i=[];i.push(this.crv1.evalPoint(e.x)),i.push(this.crv2.evalPoint(e.y));var s=[];s.push(this.crv1.evalFirstDeriv(e.x)),s.push(this.crv2.evalFirstDeriv(e.y));var a=i[1].sub(i[0]);if(r&&r.copy(a),n&&(n[0].copy(s[0]),n[1].copy(s[1])),void 0!==o&&o.length>0&&(o[0]=this.IsSolution(e,a,s),!0===o[0]))return new t.Vector2D;var c=a.dot(s[0])/s[0].norm(),h=a.dot(s[1])/s[1].norm();return new t.Vector2D(c,h)},h.prototype.EvalStep=function(e,r,n,o,i){t.TypeCheckInternal(e,!0,t.Point2D),t.TypeCheckInternal(r,!0,t.Vector2D),t.TypeCheckInternal(n,!0,t.Vector3D),t.TypeCheckInternal(o,!0,[t.Vector3D],2);var s=[];s.push(this.crv1.evalSecondDeriv(e.x)),s.push(this.crv2.evalSecondDeriv(e.y));var a=[o[0].norm(),o[1].norm()],c=[];c[0]=o[0].dot(s[0])/a[0],c[1]=o[1].dot(s[1])/a[1];var h=[];h[0]=o[0].clone().divideScalar(a[0]),h[1]=o[1].clone().divideScalar(a[1]);var p=[];p[0]=s[0].clone().multiplyScalar(a[0]).sub(o[0].clone().multiplyScalar(c[0])).divideScalar(a[0]*a[0]),p[1]=s[1].clone().multiplyScalar(a[1]).sub(o[1].clone().multiplyScalar(c[1])).divideScalar(a[1]*a[1]);var l=[];l[0]=new t.Vector2D,l[0].x=n.dot(p[0])-o[0].norm(),l[0].y=o[1].dot(h[0]),l[1]=new t.Vector2D,l[1].x=-o[0].dot(h[1]),l[1].y=n.dot(p[1])+o[1].norm();var u=l[0].cross(l[1]);if(Math.abs(u)<1e-12)return!1;var y=1/u,m=new t.Vector2D(l[1].y,-l[0].y),f=new t.Vector2D(-l[1].x,l[0].x);return i.x=-y*r.dot(m),i.y=-y*r.dot(f),!0},h.prototype.Solve=function(e,r){if(t.TypeCheckInternal(e,!0,t.Point2D),t.TypeCheckInternal(r,!0,[]),this._DEBUG.IsActive(2)&&(console.log(""),console.log("  MinDistCrvCrv::Solve from "+e.getArray())),!0===this.IsSolution(e))return this._DEBUG.IsActive(2)&&console.log("    Init is a solution --\x3e stop processing"),r.push(e.clone()),!0;for(var n=e.clone(),o=!1,i=0;i<100;){var s=new t.Vector3D,a=[new t.Vector3D,new t.Vector3D],c=[!1],h=this.Eval(n,s,a,c);if(this._DEBUG.IsActive(3)&&(console.log("     Iteration "+i),console.log("       at "+n.getArray()),console.log("         --\x3e "+this.crv1.evalPoint(n.x).getArray()+" on curve-1"),console.log("         --\x3e "+this.crv2.evalPoint(n.y).getArray()+" on curve-2")),!0===c[0]){this._DEBUG.IsActive(3)&&console.log("         --\x3e has converged!"),o=!0;break}this._DEBUG.IsActive(3)&&(console.log("         --\x3e separation vector: "+s.getArray()),console.log("         --\x3e crv1 tangent: "+a[0].getArray()),console.log("         --\x3e crv2 tangent: "+a[1].getArray()),console.log("         --\x3e fX = "+h.getArray()));var p=new t.Vector2D,l=this.EvalStep(n,h,s,a,p);if(this._DEBUG.IsActive(3)&&console.log("      step is "+l+" ("+p.getArray()+")"),!1===l)break;if(isNaN(p.x)||isNaN(p.y)){this._DEBUG.IsActive(3)&&console.log("           --\x3e invalid step");break}for(var u=!1,y=0;y<2&&!u;y++){var m=0===y?n.x:n.y,f=0===y?p.x:p.y,v=0===y?this.range1:this.range2,g=!1;if(m<=v[0]&&f<0&&(g=!0),m>=v[1]&&f>0&&(g=!0),g){this._DEBUG.IsActive(2)&&console.log("  MinDistCrvCrv::Solve at domain limit for curve-"+y);var C=0===y?this.crv1:this.crv2,D=1===y?this.crv1:this.crv2,T=1===y?this.range1:this.range2,S=C.evalPoint(m),d=new t.MinDistPtCrv(D,T,S),M=d.Run();if(!d.hasSol)return this._DEBUG.IsActive(2)&&console.log("  MinDistCrvCrv::Solve at domain limit for curve-"+y+" failed to converge"),!1;var k=[0,0];k[y]=m,k[1-y]=M,n.setFromArray(k),u=!0}}if(u){o=!0;break}n.addVector(p),n.x=this.PutInRange(this.crv1,n.x,this.range1),n.y=this.PutInRange(this.crv2,n.y,this.range2),i++}return this._DEBUG.IsActive(2)&&(console.log("  MinDistCrvCrv::Solve finished at "+n.getArray()),console.log("                     on crv-1 at: "+this.crv1.evalPoint(n.x).getArray()),console.log("                     on crv-2 at: "+this.crv2.evalPoint(n.y).getArray())),100===i?(this._DEBUG.IsActive(2)&&console.log("    Failed to converge after 100 (= max) iterations"),!1):!1===o?(this._DEBUG.IsActive(2)&&console.log("    Failed to converge after "+i+" iterations"),!1):(this._DEBUG.IsActive(2)&&console.log("    Converged after "+i+" iterations"),r.push(n.clone()),!0)},h.prototype.ComputeAnalytic=function(e){if(t.TypeCheckInternal(e,!0,[]),this.crv1.constructor===t.Line&&this.crv2.constructor===t.Line){var r=this.crv1.direction.clone(),n=this.crv2.direction.clone(),o=this.crv1.origin.clone(),i=this.crv2.origin.clone(),s=new t.Matrix2x2(r.dot(r),-r.dot(n),r.dot(n),-n.dot(n));s.inverse(),s.transpose();var a=s.getFirstColumn(),c=s.getSecondColumn(),h=i.sub(o),p=new t.Vector2D(h.dot(r),h.dot(n)),l=a.dot(p),u=c.dot(p);return e.push(new t.Point2D(l,u)),!0}if(this.crv1.constructor===t.Circle&&this.crv2.constructor===t.Circle){o=this.crv1.center.clone(),h=(i=this.crv2.center.clone()).sub(o);var y=this.crv1.getDirections()[0].getAngleTo(h);y=this.crv1.putInRange(y,[0,t.constants.PI2]);var m=this.crv2.getDirections()[0].getAngleTo(h)+t.constants.PI;return m=this.crv2.putInRange(m,[0,t.constants.PI2]),e.push(new t.Point2D(y,m)),!0}var f=0;if(this.crv1.constructor===t.Circle&&this.crv2.constructor===t.Line&&(f=1),this.crv1.constructor===t.Line&&this.crv2.constructor===t.Circle&&(f=2),f>0){var v=1===f?this.crv2:this.crv1,g=1===f?this.crv1:this.crv2,C=v.origin.clone(),D=g.center.clone(),T=v.direction.clone(),S=(h=D.sub(C)).dot(T)/T.squareNorm(),d=v.evalPoint(S),M=g.getDirections()[0].getAngleTo(d.sub(D)),k=new t.Point2D;return 1===f?(k.x=M,k.y=S):(k.x=S,k.y=M),e.push(k),!0}return!1},h.prototype.ComputeInits=function(e){t.TypeCheckInternal(e,!0,[],[]);var r=[this.crv1,this.crv2];this.range1,this.range2;if(r[0].constructor===t.NurbsCurve||r[1].constructor===t.NurbsCurve)return this.ComputeInits_Nurbs(e);if(r[0].constructor===t.Line||r[1].constructor===t.Line)return this.ComputeInits_Line(e);var n=r[0].constructor===t.Circle||r[0].constructor===t.Ellipse,o=r[1].constructor===t.Circle||r[1].constructor===t.Ellipse;return!(!n||!o)&&this.ComputeInits_WithCentres(e)},h.prototype.ComputeInits_WithCentres=function(e){t.TypeCheckInternal(e,!0,[],[]);for(var r=this.crv2.center.sub(this.crv1.center),n=new t.Line(this.crv1.center,r.clone().normalize()),o=[this.crv1,this.crv2],i=[this.range1,this.range2],s=[0,0],a=0;a<2;a++){var c=new t.Intersect(o[a],n,i[a][0],i[a][1],0,r.norm()),h=c.Run();1===h.length&&(c._VERSION>=3?s[a]=h[0][0]:s[a]=h[0].x)}var p=(new t.Point2D).setFromArray(s);return e.push(p),e},h.prototype.ComputeInits_Line=function(e){var r;if(t.TypeCheckInternal(e,!0,[],[]),this.crv1.constructor===t.Line)r=0;else{if(this.crv2.constructor!==t.Line)return!1;r=1}var n=[this.crv1,this.crv2],o=[this.range1,this.range2],i=n[r],s=n[1-r],a=new t.MinDistPtCrv(i,o[r],s.center).Run(),c=i.evalPoint(a),h=new t.MinDistPtCrv(s,o[1-r],c).Run(),p=[0,0];p[r]=a,p[1-r]=h;var l=(new t.Point2D).setFromArray(p);return e.push(l),e},h.prototype.ComputeInits_Nurbs=function(e){var r;if(t.TypeCheckInternal(e,!0,[],[]),this.crv1.constructor===t.NurbsCurve)r=0;else{if(this.crv2.constructor!==t.NurbsCurve)return!1;r=1}for(var n=[this.crv1,this.crv2],o=[this.range1,this.range2],i=n[r],s=n[1-r],a=[],c=i.KnotVec.length,h=0;h<c-1;h++){var p=i.KnotVec[h].knotValue;a.push(p);var l=(i.KnotVec[h+1].knotValue+i.KnotVec[h].knotValue)/2;a.push(l)}if(a.push(i.GetLastKnot()),s.constructor===t.NurbsCurve){var u=[];for(c=s.KnotVec.length,h=0;h<c-1;h++){p=s.KnotVec[h].knotValue;u.push(p);l=(s.KnotVec[h+1].knotValue+s.KnotVec[h].knotValue)/2;u.push(l)}u.push(s.GetLastKnot());for(var y=0;y<a.length;y++)for(var m=0;m<u.length;m++){(v=[0,0])[r]=a[y],v[1-r]=u[m];var f=(new t.Point2D).setFromArray(v);e.push(f)}return!0}for(y=0;y<a.length;y++){var v,g=i.evalPoint(a[y]),C=new t.MinDistPtCrv(n[1-r],o[1-r],g).Run();(v=[0,0])[r]=a[y],v[1-r]=C;f=(new t.Point2D).setFromArray(v);e.push(f)}return!0},h.prototype.PutInRange=function(e,r,n){if(t.TypeCheck(e,!0,[t.Line,t.Circle,t.Ellipse,t.NurbsCurve]),t.TypeCheck(r,!0,"number"),t.TypeCheck(n,!0,["number"],2),e.constructor===t.Ellipse||e.constructor===t.Circle)return o=e.putInRange(r,n);var o=r;return e.constructor===t.NurbsCurve&&!0===e.IsPeriodic&&(o=e.putInPrincipalRange(r)),o=Math.max(n[0],Math.min(n[1],o))},h.prototype.Run=function(e){t.TypeCheck(e,!1,t.Point2D),this._CAPTURE>=1&&this.Dump(),this._DEBUG.IsActive(1)&&console.log("MinDistCrvCrv::Run between "+this._DEBUG.PrintType(this.crv1)+" and "+this._DEBUG.PrintType(this.crv2)),this.hasSol=!1;var r=[];if(!0===this.ComputeAnalytic(r))return r[0];var n=new Array;if(e?n[0]=e:this.ComputeInits(n),this._DEBUG.IsActive(1)){console.log(""),console.log("Found "+n.length+" inits");for(var o=0;o<n.length;o++)console.log("At "+n[o].getArray())}var i=new t.Point2D,s=-1;for(o=0;o<n.length;o++){this._DEBUG.IsActive(1)&&(console.log(""),console.log("MinDistCrvCrv::Run solve from init-"+o+" at: "+n[o].getArray()),console.log("                     on crv-1 at: "+this.crv1.evalPoint(n[o].x).getArray()),console.log("                     on crv-2 at: "+this.crv2.evalPoint(n[o].y).getArray()));var a=[];if(this.Solve(n[o],a)){var c=a[0];this._DEBUG.IsActive(1)&&(console.log("MinDistCrvCrv::Run solve from init-"+o+" converged"),console.log("  to: "+c.getArray()));var h=this.crv1.evalPoint(c.x).sub(this.crv2.evalPoint(c.y)).norm();(h<s||s<0)&&(this._DEBUG.IsActive(1)&&console.log("MinDistCrvCrv::Run --\x3e store as current best solution"),this.hasSol=!0,s=h,i.copy(c))}else this._DEBUG.IsActive(1)&&console.error("MinDistCrvCrv::Run solve from init-"+o+" failed to solve")}return this._DEBUG.IsActive(1)&&(console.log("MinDistCrvCrv::Run --\x3e return best solution "+i.getArray()),console.log("                     on crv-1 at: "+this.crv1.evalPoint(i.x).getArray()),console.log("                     on crv-2 at: "+this.crv2.evalPoint(i.y).getArray())),i},h.prototype.Dump=function(){console.log("var minDistOp;"),console.log("{"),console.log(""),this.crv1.Dump(0),console.log(""),this.crv2.Dump(1),console.log(""),console.log("var range0 = ["+this.range1[0]+", "+this.range1[1]+"];"),console.log("var range1 = ["+this.range2[0]+", "+this.range2[1]+"];"),console.log(""),console.log("var geoObj0 = { _Geometry : geo0, _Range: range0 };"),console.log("var geoObj1 = { _Geometry : geo1, _Range: range1 };"),console.log("minDistOp = new DSMath.MinDist(geoObj0, geoObj1);"),console.log("minDistOp._VERSION_EXT = "+this._VERSION_EXT+";"),console.log("minDistOp._VERSION = "+this._VERSION+";"),console.log("minDistOp._FX = "+this._FX+";"),console.log("} // end of min dist creation"),console.log(""),console.log("var sol = minDistOp.Run();")},t.MinDistCrvCrv=h,h}),define("MathematicsES/MathMinDistCrvCrvJSImpl",["DS/MathematicsES/MathMinDistCrvCrvJSImpl"],function(t){return t}),define("DS/MathematicsES/MathMinDistPtCrvJSImpl",["DS/MathematicsES/MathNameSpace","DS/MathematicsES/MathTypeCheck","DS/MathematicsES/MathTypeCheckInternal","DS/MathematicsES/MathGeometryUtils","DS/MathematicsES/MathDebugUtils","DS/MathematicsES/MathPointJSImpl","DS/MathematicsES/MathVector3DJSImpl","DS/MathematicsES/MathLineJSImpl","DS/MathematicsES/MathCircleJSImpl","DS/MathematicsES/MathEllipseJSImpl","DS/MathematicsES/MathNurbsCurveJSImpl","DS/MathematicsES/MathParabolaJSImpl"],function(t,e,r,n,o,i,s,a,c,h,p){"use strict";var l=function(e,r,n){t.TypeCheck(e,!0,[t.Line,t.Circle,t.Ellipse,t.NurbsCurve,t.Parabola]),t.TypeCheck(r,!0,["number"],2),t.TypeCheck(n,!0,t.Point),this.hasSol=!1,this.crv=e||null,this.range=[r[0],r[1]],this.pt3D=n?n.clone():null,this._DEBUG=new t.DebugUtils};return l.prototype.tolLength=1e-6,l.prototype.tolAngle=1e-8,l.prototype._VERSION=0,l.prototype._VERSION_EXT=0,l.prototype._CAPTURE=0,l.prototype.IsSolution=function(e,r,n){var o,i;if(t.TypeCheckInternal(e,!0,"number"),t.TypeCheckInternal(r,!1,t.Vector3D),t.TypeCheckInternal(n,!1,t.Vector3D),r&&n?(o=r,i=n):(o=new t.Vector3D,i=new t.Vector3D,this.Eval(e,o,i)),o.squareNorm()<this.tolLength*this.tolLength)return!0;var s=o.getAngleTo(i)-Math.PI/2;return Math.abs(s)<this.tolAngle},l.prototype.IsAdmissibleSolution=function(e){return t.TypeCheckInternal(e,!0,"number"),e===this.range[0]||e===this.range[1]},l.prototype.Eval=function(e,r,n,o){t.TypeCheckInternal(e,!0,"number"),t.TypeCheckInternal(r,!1,t.Vector3D),t.TypeCheckInternal(n,!1,t.Vector3D),t.TypeCheckInternal(o,!1,[],[]);var i=this.crv.evalPoint(e),s=this.crv.evalFirstDeriv(e),a=i.sub(this.pt3D);return r&&r.copy(a),n&&n.copy(s),void 0!==o&&o.length>0&&(o[0]=this.IsSolution(e,a,s),!0===o[0])?0:4===this._FX?a.dot(s)/a.norm():3===this._FX?a.dot(s)/s.norm():2===this._FX?a.dot(s)/(a.norm()*s.norm()):a.dot(s)},l.prototype.EvalGrad=function(e,r,n,o){t.TypeCheckInternal(e,!0,"number"),t.TypeCheckInternal(r,!0,"number"),t.TypeCheckInternal(n,!0,t.Vector3D),t.TypeCheckInternal(o,!0,t.Vector3D);var i=this.crv.evalSecondDeriv(e);if(4===this._FX){var s=n.norm()*(n.dot(i)+o.squareNorm())-r*o.dot(n);return s/=n.squareNorm()}if(3===this._FX){if(this._VERSION>=3)return s=n.dot(i)/o.norm()-o.dot(i)*(r/o.squareNorm())+o.norm();var s=o.norm()*(n.dot(i)+o.squareNorm())-r*o.dot(i);return s/=o.squareNorm()}if(2===this._FX){s=n.dot(i)+o.squareNorm()-r*(r*o.squareNorm()+o.dot(i)*n.norm()/o.norm());return s/=n.norm()*o.norm()}return s=n.dot(i)+o.squareNorm()},l.prototype.Solve=function(e){if(t.TypeCheckInternal(e,!0,"number"),this._DEBUG.IsActive(1)&&console.log("MinDistPtCrv::Solve from "+e),!0===this.IsSolution(e))return this._DEBUG.IsActive(1)&&console.log("  Init is a solution --\x3e stop processing"),e;for(var r=e,o=[!1,!1],i=0;i<100;){if(this._VERSION>=1){var s=!1;if(!0===o[0]&&r==this.range[0]?s=!0:!0===o[1]&&r==this.range[1]&&(s=!0),!0===s){this._DEBUG.IsActive(1)&&console.log(" Revisited domain boundary --\x3e stuck in a loop --\x3e fail to converge");break}r==this.range[0]?o[0]=!0:r==this.range[1]&&(o[1]=!0)}var a=new t.Vector3D,c=new t.Vector3D,h=[!1],p=this.Eval(r,a,c,h);if(this._DEBUG.IsActive(2)&&(console.log("   Iteration "+i),console.log("     at "+r+"  (= "+this.crv.evalPoint(r).getArray()+")")),!0===h[0]){this._DEBUG.IsActive(2)&&console.log("       --\x3e has converged!");break}this._DEBUG.IsActive(2)&&(console.log("       --\x3e vec to target: "+a.getArray()),console.log("       --\x3e crv tangent: "+c.getArray()),console.log("       --\x3e fX = "+p));var l=this.EvalGrad(r,p,a,c),u=-p/l;if(this._DEBUG.IsActive(2)&&(console.log("     --\x3e gradient = "+l),console.log("     --\x3e step of "+u)),isNaN(l)||isNaN(u)){this._DEBUG.IsActive(2)&&console.log("         --\x3e invalid step");break}r+=u,r=n.prototype.PutInRange(this.crv,r,this.range),i++}var y=r;return this._DEBUG.IsActive(1)&&console.log("MinDistPtCrv::Solve finished at "+y),y},l.prototype.ComputeAnalytic=function(e){if(t.TypeCheckInternal(e,!0,["number"],[]),this.crv.constructor===t.Line){var r=this.pt3D.sub(this.crv.origin).dot(this.crv.direction)/this.crv.direction.squareNorm();return this._VERSION>=3&&(r=n.prototype.PutInRange(this.crv,r,this.range)),e.push(r),!0}if(this.crv.constructor===t.Circle){var o=this.pt3D.sub(this.crv.center),i=[new t.Vector3D,new t.Vector3D];this.crv.getDirections(i);var s=o.dot(i[0]),a=o.dot(i[1]),c=Math.atan2(a,s);return c=this.crv.putInRange(c,this.range),e.push(c),!0}return!1},l.prototype.ComputeInits=function(){if(this.crv.constructor===t.Ellipse){var e=this.pt3D.sub(this.crv.center),r=[new t.Vector3D,new t.Vector3D];this.crv.getDirections(r);var o=e.dot(r[0]),i=e.dot(r[1]),s=Math.atan2(i,o);return N=[s=this.crv.putInRange(s,this.range)]}var a=this._VERSION>=2;if(this._VERSION>=3&&this.crv.constructor===t.NurbsCurve&&(a=!1),a)return N=n.prototype.GetSampleInits(this.crv,1,this.range);if(this.crv.constructor===t.NurbsCurve){if(this._VERSION>=3){var c,h=!0;if(this._VERSION>=4){var p=[],l=-1;for(R=0;R<this.crv.KnotVec.length-1;R++){(y=[]).push(this.crv.KnotVec[R].knotValue),y.push(this.crv.KnotVec[R+1].knotValue);var u=this.crv.GetBox(y).DistanceTo(this.pt3D);this._DEBUG.IsActive(2)&&(console.log("Process arc-"+R),console.log("  --\x3e box distance to pt: "+u)),u<l||l<0?(this._DEBUG.IsActive(2)&&console.log("     --\x3e is best so far"),l=u,(p=[]).push(R)):u<=l&&(this._DEBUG.IsActive(2)&&console.log("     --\x3e is as good as previous arcs"),p.push(R))}for(this._DEBUG.IsActive(1)&&(console.log(""),console.log("Consider arcs-"+p)),c=[],R=0;R<p.length;R++){var y;(y=[]).push(this.crv.KnotVec[p[R]].knotValue),y.push(this.crv.KnotVec[p[R]+1].knotValue),y[0]=Math.max(y[0],this.range[0]),y[1]=Math.min(y[1],this.range[1]);var m=n.prototype.GetSampleInits(this.crv,1,y);c.push.apply(c,m)}l>0&&(h=!1)}else c=n.prototype.GetSampleInits(this.crv,1,this.range);if(this._DEBUG.IsActive(2))for(console.log("Initial init parameter values ("+c.length+" values)"),_=0;_<c.length;_++)console.log("  "+c[_]);var f=[],v=[];for(_=0;_<c.length;_++){var g=c[_],C=this.crv.evalPoint(g),D={_Dist:C.sub(this.pt3D).norm(),_pSol:g};v.push(D),f.push(C)}if(!0===h)for(_=0;_<c.length-1;_++){this._DEBUG.IsActive(2)&&console.log("Consider init line "+_);var T=c[_],S=c[_+1],d=f[_],M=f[_+1];this._DEBUG.IsActive(2)&&(console.log("  --\x3e arc start at: "+T+" --\x3e "+d.getArray()),console.log("  --\x3e arc end   at: "+S+" --\x3e "+M.getArray()));var k=new t.Vector3D;M.sub(d,k);var b={_Geometry:new t.Line(d,k),_Range:[0,1]},x={_Geometry:this.pt3D},I=new t.MinDist(b,x).Run();if(this._DEBUG.IsActive(2)&&console.log("   --\x3e min dist solution on line: "+I),I>0&&I<1){var P=I*(S-T),E=T+P;this._DEBUG.IsActive(2)&&(console.log("  --\x3e initArc: "+P),console.log("  --\x3e initCrv: "+E));var V={_Dist:this.crv.evalPoint(E).sub(this.pt3D).norm(),_pSol:E};v.push(V)}}if(this._DEBUG.IsActive(1))for(var _=0;_<v.length;_++)console.log("Init-"+_+" at "+v[_]._pSol+" --\x3e dist "+v[_]._Dist);if(v.sort(function(t,e){return t._Dist-e._Dist}),(N=[]).push(v[0]._pSol),this._VERSION>=6)for(var w=1;w<v.length;w++)v[w]._Dist-v[0]._Dist<t.defaultTolerances.epsgForLengthTest&&N.push(v[w]._pSol);return N}for(var N=[],z=this.crv.KnotVec.length,R=0;R<z-1;R++){var O=(this.crv.KnotVec[R+1].knotValue+this.crv.KnotVec[R].knotValue)/2;N.push(O)}return N}return[]},l.prototype.Run=function(e){if((t.TypeCheck(e,!1,"number"),this._CAPTURE>=1&&this.Dump(),this._VERSION>=5)&&(this._MaxAllowedDist>0&&this.crv.GetBox(this.range).DistanceTo(this.pt3D)>this._MaxAllowedDist))return;if(void 0===this._FX&&(this._FX=3),this._DEBUG.IsActive(1)&&(console.log(""),console.log("MinDistPtCrv::Run in mode "+this._FX),console.log("\ttarget is "+this.pt3D.getArray()),this._DEBUG.IsActive(4))){console.log("Sample the curve (FX = "+this._FX+")");for(var r=0;r<101;r++){var n=(this.range[1]-this.range[0])*(r/100),o=this.Eval(n);console.log(n+", "+o)}}this.hasSol=!1;var i,s=[];if(this.hasSol=this.ComputeAnalytic(s),this.hasSol)return s[0];if(i=e?[e]:this.ComputeInits(),this._DEBUG.IsActive(1)){console.log(""),console.log("Computed "+i.length+" inits");for(var a=0;a<i.length;a++)console.log("  init-"+a+": "+i[a])}var c=0;this._VERSION>=1&&(c=void 0);for(var h=-1,p=0;p<i.length;p++){this._DEBUG.IsActive(1)&&(console.log(""),console.log("MinDistPtCrv::Run solve from init-"+p+" at: "+i[p]+" ("+this.crv.evalPoint(i[p]).getArray()+")"));var l=this.Solve(i[p]),u=this.IsSolution(l);if(this._DEBUG.IsActive(1)&&(console.log("MinDistPtCrv::Run solve from init-"+p+" stopped at: "+l),!0===u?console.log("MinDistPtCrv::Run solve from init-"+p+" converged"):console.error("MinDistPtCrv::Run solve from init-"+p+" did not converge")),this._VERSION>=1&&!1===u&&(u=this.IsAdmissibleSolution(l),this._DEBUG.IsActive(1)&&!0===u&&console.log("MinDistPtCrv::Run --\x3e current solution is admissible")),!0===u){var y=this.crv.evalPoint(l).sub(this.pt3D).norm();y<h||h<0?(this._DEBUG.IsActive(1)&&(console.log("MinDistPtCrv::Run --\x3e store as current best solution"),console.log("                        current distance: "+y),console.log("                        BSF     distance: "+h)),this.hasSol=!0,h=y,c=l):this._DEBUG.IsActive(1)&&console.log("MinDistPtCrv::Run but is not closer than the current best")}}return c},l.prototype.Dump=function(){console.log("var minDistOp;"),console.log("{"),console.log(""),this.crv.Dump(0),console.log(""),console.log("var target3D = new DSMath.Point("+this.pt3D.getArray()+");"),console.log(""),console.log("var range = ["+this.range[0]+", "+this.range[1]+"];"),console.log(""),console.log("var geoObj0 = { _Geometry : geo0, _Range: range };"),console.log("var geoObj1 = { _Geometry : target3D };"),console.log("minDistOp = new DSMath.MinDist(geoObj0, geoObj1);"),console.log("minDistOp._VERSION_EXT = "+this._VERSION_EXT+";"),console.log("minDistOp._VERSION = "+this._VERSION+";"),console.log("} // end of min dist creation"),console.log(""),console.log("var sol = minDistOp.Run();")},t.MinDistPtCrv=l,l}),define("MathematicsES/MathMinDistPtCrvJSImpl",["DS/MathematicsES/MathMinDistPtCrvJSImpl"],function(t){return t}),define("DS/MathematicsES/MathMinDistJSImpl",["DS/MathematicsES/MathNameSpace","DS/MathematicsES/MathTypeCheck","DS/MathematicsES/MathTypeCheckInternal","DS/MathematicsES/MathDebugUtils","DS/MathematicsES/MathMinDistPtCrvJSImpl","DS/MathematicsES/MathMinDistCrvCrvJSImpl","DS/MathematicsES/MathPointJSImpl","DS/MathematicsES/MathPoint2DJSImpl","DS/MathematicsES/MathVector3DJSImpl","DS/MathematicsES/MathLineJSImpl","DS/MathematicsES/MathCircleJSImpl","DS/MathematicsES/MathEllipseJSImpl","DS/MathematicsES/MathNurbsCurveJSImpl","DS/MathematicsES/MathParabolaJSImpl"],function(t,e,r,n,o,i,s,a,c,h,p,l,u,y){"use strict";var m=function(e,r){t.TypeCheck(e,!0,Object),t.TypeCheck(r,!0,Object),t.TypeCheck(e._Geometry,!0,t.Point|t.Line|t.Circle|t.Ellipse|t.NurbsCurve|t.Parabola),t.TypeCheck(e._Range,!1,["number"]),t.TypeCheck(r._Geometry,!0,t.Point|t.Line|t.Circle|t.Ellipse|t.NurbsCurve|t.Parabola),t.TypeCheck(r._Range,!1,["number"]),this.Geometry1=e,this.Geometry2=r,this._DEBUG=new t.DebugUtils};return m.prototype._MaxAllowedDist=-1,m.prototype._VERSION=6,m.prototype._VERSION_EXT=0,m.prototype._CAPTURE=0,m.prototype.IsValidPoint=function(e){return t.TypeCheckInternal(e,!0,Object),e._Geometry.constructor==t.Point},m.prototype.IsValidCurve=function(e){t.TypeCheckInternal(e,!0,Object);var r=!1;return e._Geometry.constructor==t.Line&&(r=!0),e._Geometry.constructor==t.Circle&&(r=!0),e._Geometry.constructor==t.Ellipse&&(r=!0),e._Geometry.constructor==t.NurbsCurve&&(r=!0),e._Geometry.constructor==t.Parabola&&(r=!0),!(!r||null==e._Range)},m.prototype.SetOptions=function(t){t._VERSION=this._VERSION,t._VERSION_EXT=this._VERSION_EXT,this._FX&&(t._FX=this._FX),t._MaxAllowedDist=this._MaxAllowedDist,t._DEBUG._LEVEL=this._DEBUG._LEVEL,t._CAPTURE=this._CAPTURE},m.prototype.UpdateGeometry=function(e,r){return t.TypeCheck(e,!0,"number"),t.TypeCheck(r,!0,Object),0===e?(this.Geometry1=r,!0):1===e&&(this.Geometry2=r,!0)},m.prototype.Run=function(e){if(t.TypeCheck(e,!1,["number",t.Point2D]),this._DEBUG.IsActive(1)&&console.log("MinDist::Run between "+this._DEBUG.PrintType(this.Geometry1._Geometry)+" and "+this._DEBUG.PrintType(this.Geometry2._Geometry)),this.IsValidPoint(this.Geometry1)&&this.IsValidCurve(this.Geometry2)){var r=new t.MinDistPtCrv(this.Geometry2._Geometry,this.Geometry2._Range,this.Geometry1._Geometry);this.SetOptions(r);var n=r.Run(e);return this._DEBUG.IsActive(1)&&(console.log(""),console.log("MinDist::Run returning "+n)),r._CAPTURE>=1&&this.DumpOutput1D(n),n}if(this.IsValidCurve(this.Geometry1)&&this.IsValidPoint(this.Geometry2)){r=new t.MinDistPtCrv(this.Geometry1._Geometry,this.Geometry1._Range,this.Geometry2._Geometry);this.SetOptions(r);n=r.Run(e);return this._DEBUG.IsActive(1)&&console.log("MinDist::Run returning "+n),r._CAPTURE>=1&&this.DumpOutput1D(n),n}if(this.IsValidCurve(this.Geometry1)&&this.IsValidCurve(this.Geometry2)){var o=new t.MinDistCrvCrv(this.Geometry1._Geometry,this.Geometry1._Range,this.Geometry2._Geometry,this.Geometry2._Range);this.SetOptions(o);n=o.Run(e);return this._DEBUG.IsActive(1)&&console.log("MinDist::Run returning "+n.getArray()),o._CAPTURE>=1&&this.DumpOutput2D(n),n}return!1},m.prototype.DumpOutput1D=function(t){console.log("var refSol1D = "+t+";")},m.prototype.DumpOutput2D=function(t){console.log("var refSol2D = new DSMath.Point2D("+t.getArray()+");")},t.MinDist=m,m}),define("MathematicsES/MathMinDistJSImpl",["DS/MathematicsES/MathMinDistJSImpl"],function(t){return t}),define("DS/MathematicsES/MathIntersect2DJSImpl",["DS/MathematicsES/MathNameSpace","DS/MathematicsES/MathTypeCheck","DS/MathematicsES/MathTypeCheckInternal","DS/MathematicsES/MathGeometryUtils","DS/MathematicsES/MathPointJSImpl","DS/MathematicsES/MathPoint2DJSImpl","DS/MathematicsES/MathVector2DJSImpl","DS/MathematicsES/MathVector3DJSImpl","DS/MathematicsES/MathMat2x2JSImpl","DS/MathematicsES/MathLineJSImpl","DS/MathematicsES/MathCircleJSImpl","DS/MathematicsES/MathEllipseJSImpl","DS/MathematicsES/MathNurbsCurveJSImpl","DS/MathematicsES/MathPlaneJSImpl","DS/MathematicsES/MathMinDistJSImpl"],function(t,e,r,n,o,i,s,a,c,h,p,l,u,y,m){"use strict";var f=function(e,r,n,o,i,s){t.TypeCheck(e,!1,[t.Line,t.Circle,t.Ellipse,t.NurbsCurve]),t.TypeCheck(r,!1,[t.Line,t.Circle,t.Ellipse,t.NurbsCurve]),t.TypeCheck(n,!1,"number"),t.TypeCheck(o,!1,"number"),t.TypeCheck(i,!1,"number"),t.TypeCheck(s,!1,"number"),this.crv1=e||null,this.crv2=r||null,this.range1=[n,o],this.range2=[i,s]};return f.prototype.CheckInputs=function(){return void 0!==this.crv1&&null!==this.crv1&&(void 0!==this.crv2&&null!==this.crv2&&(void 0!==this.tolLength&&null!==this.tolLength&&(void 0!==this._VERSION&&null!==this._VERSION&&(void 0!==this._VERSION_EXT&&null!==this._VERSION_EXT))))},f.prototype.RevisitDomainBoundary=function(e,r){t.TypeCheckInternal(e,!0,t.Point2D),t.TypeCheckInternal(r,!0,[Boolean],2);var n=e.x==this.range1[0],o=e.x==this.range1[1],i=e.y==this.range2[0],s=e.y==this.range2[1],a=!1;return!0===r[0][0]&&n?a=!0:!0===r[0][1]&&o?a=!0:!0===r[1][0]&&i?a=!0:!0===r[1][1]&&s&&(a=!0),!0===a?(this._DEBUG>=1&&console.log(" Revisited domain boundary --\x3e stuck in a loop --\x3e fail to converge"),!0):(n?r[0][0]=!0:o&&(r[0][1]=!0),i?r[1][0]=!0:s&&(r[1][1]=!0),!1)},f.prototype.Eval=function(t,e){var r=this.crv1.evalPoint(t.x),n=this.crv2.evalPoint(t.y),o=r.sub(n);return e&&e.copy(o),o.squareNorm()},f.prototype.EvalStep=function(e,r,n){var o=this.crv1.evalFirstDeriv(e.x),i=this.crv2.evalFirstDeriv(e.y),s=o.dot(o),a=-o.dot(i),c=i.dot(i),h=s*c-a*a;if(Math.abs(h)<1e-12)return!1;var p=1/h,l=new t.Vector3D;l.addScaledVector(o,c),l.addScaledVector(i,a),l.multiplyScalar(p);var u=new t.Vector3D;return u.addScaledVector(o,-a),u.addScaledVector(i,-s),u.multiplyScalar(p),n.x=l.dot(r),n.y=u.dot(r),!isNaN(n.x)&&!isNaN(n.y)},f.prototype.Solve=function(e,r){t.TypeCheckInternal(e,!0,t.Point2D),t.TypeCheckInternal(r,!0,[],[]);var o=Math.pow(t.defaultTolerances.epsgForLengthTest,2);if(this.Eval(e)<o)return r[0]=e.clone(),this._VERSION>=5||1==this._VERSION_IR767064||void 0;for(var i=e.clone(),s=!1,a=[[!1,!1],[!1,!1]],c=0;c<1e4;){if(this._VERSION<10&&(this._VERSION>=5||1==this._VERSION_IR767064))if(1==this.RevisitDomainBoundary(i,a))return!1;var h=new t.Vector3D,p=this.Eval(i,h);if(this._DEBUG>=2&&(console.log("  Iteration "+c),console.log("    at "+i.getArray()),console.log("      --\x3e fX = "+p)),p<o){this._DEBUG>=2&&console.log("    converged!"),s=!0;break}var l=new t.Vector2D,u=this.EvalStep(i,h,l);if(this._DEBUG>=2&&console.log("    step is "+u+" ("+l.getArray()+")"),!1===u)break;if(this._VERSION>=10){var y=!0;if(this._VERSION>=13&&(y=c>0),y)if(1==this.RevisitDomainBoundary(i,a)){if(this._VERSION>=12)break;return!1}}i.addScaledVector(l,-1),this._VERSION>=13?(!1===this.crv1.IsPeriodic()&&(i.x=n.prototype.PutInRange(this.crv1,i.x,this.range1)),!1===this.crv2.IsPeriodic()&&(i.y=n.prototype.PutInRange(this.crv2,i.y,this.range2))):(!1===this.crv1.IsInfinite()&&(i.x=n.prototype.PutInRange(this.crv1,i.x,this.range1)),!1===this.crv2.IsInfinite()&&(i.y=n.prototype.PutInRange(this.crv2,i.y,this.range2))),c++}if(1e4===c)return this._DEBUG>=1&&console.log("  Failed to converge after 10000 (= max) iterations"),!1;if(!1===s){this._DEBUG>=1&&console.log("  Failed to converge after "+c+" iterations");var m=!1;if(this._VERSION>=12){var f=this.tolLength*this.tolLength;(p=this.Eval(i))<f&&(this._DEBUG>=1&&console.log("    but the solution is close enough --\x3e keep it"),m=!0)}if(!1===m)return!1}return this._VERSION>=13?(!0===this.crv1.IsPeriodic()&&(i.x=n.prototype.PutInRange(this.crv1,i.x,this.range1)),!0===this.crv2.IsPeriodic()&&(i.y=n.prototype.PutInRange(this.crv2,i.y,this.range2))):(!0===this.crv1.IsInfinite()&&(i.x=n.prototype.PutInRange(this.crv1,i.x,this.range1)),!0===this.crv2.IsInfinite()&&(i.y=n.prototype.PutInRange(this.crv2,i.y,this.range2))),r[0]=i.clone(),!0},f.prototype.ComputeAnalytic=function(e){if(t.TypeCheckInternal(e,!0,[],[]),this.crv1.constructor==h&&this.crv2.constructor==h){var r=void 0;return this._VERSION>=2&&(r=this.tolLength),0===(n=this.crv1.intersectLine(this.crv2,this.range1[0],this.range1[1],this.range2[0],this.range2[1],r)).diag&&(e[0]=new t.Point2D(n.param1,n.param2)),!0}if(this.crv1.constructor==p&&this.crv2.constructor==p){r=void 0;if(this._VERSION>=1&&(r=this.tolLength),this._VERSION>=1)var n=this.crv1.intersectCircle(this.crv2,this.range2[0],this.range2[1],this.range1[0],this.range1[1],r);else n=this.crv1.intersectCircle(this.crv2,this.range1[0],this.range1[1],this.range2[0],this.range2[1],r);return 0!=n&&n.length>0&&(e[0]=new t.Point2D(n[0].paramCircle,n[0].paramOtherCircle),n.length>1&&(e[1]=new t.Point2D(n[1].paramCircle,n[1].paramOtherCircle))),!0}for(var o=!1,i=[this.crv1,this.crv2],s=[this.range1,this.range2],a=0;a<2&&!1===o;a++)if(i[a].constructor===p&&i[1-a].constructor===h){n=i[a].intersectLine(i[1-a],s[1-a][0],s[1-a][1],s[a][0],s[a][1],this.tolLength);for(var c=0;c<n.length;c++){(u=new Array(0,0))[a]=n[c].paramCircle,u[1-a]=n[c].paramLine,e[c]=(new t.Point2D).setFromArray(u)}o=!0}if(!0===o)return!0;for(a=0;a<2&&!1===o;a++)if(i[a].constructor===l&&i[1-a].constructor===h){for(n=i[a].intersectLine(i[1-a],s[1-a][0],s[1-a][1],s[a][0],s[a][1],this.tolLength),c=0;c<n.length;c++){var u;(u=new Array(0,0))[a]=n[c].paramEllipse,u[1-a]=n[c].paramLine,e[c]=(new t.Point2D).setFromArray(u)}o=!0}return!0===o},f.prototype.ComputeAnalyticTilted=function(e){return t.TypeCheckInternal(e,!0,[],[]),!1},f.prototype.ComputeInits=function(e){t.TypeCheckInternal(e,!0,[],[]);var r=[!1,!1];if(this.crv1.constructor!=p&&this.crv1.constructor!=l||(r[0]=!0),this.crv2.constructor!=p&&this.crv2.constructor!=l||(r[1]=!0),!(r[0]&&r[1]&&(this.ComputeInits_CentreCentre(e),this._VERSION<11||e.length>0))){if(this.crv1.constructor==t.NurbsCurve){if(this.ComputeInits_Nurbs(this.crv1,this.crv2,0,r,e),this._VERSION<11||e.length>0)return}else if(this.crv2.constructor==t.NurbsCurve&&(this.ComputeInits_Nurbs(this.crv2,this.crv1,1,r,e),this._VERSION<11||e.length>0))return;this.ComputeInits_Sampling(e)}},f.prototype.ComputeInits_Nurbs=function(e,r,n,o,i){var s=1-n;if((this._VERSION>=3||1==this._VERSION_IR765594)&&o[s])this.ComputeInits_NurbsCentre(e,r,n,i);else if((this._VERSION>=6||1==this._VERSION_IR767064)&&r.constructor==t.Line){this.ComputeInits_NurbsCanonical(e,r,n,1,i)}else if(this._VERSION>=10&&r.constructor==t.NurbsCurve)this.ComputeInits_NurbsNurbs(i);else if(!(this._VERSION>=11)){var a=[];this.crv1.constructor==u?a=this.crv1.ComputePolyline():this.crv1.constructor==h&&(a[0]=this.crv1);var c=[];this.crv2.constructor==u?c=this.crv2.ComputePolyline():this.crv2.constructor==h&&(c[0]=this.crv2),a.length>0?c.length>0?this.ComputeInits_LineLine(a,c,i):this.ComputeInits_PolyLineCentre(a,this.crv2,0,i):c.length>0?this.ComputeInits_PolyLineCentre(c,this.crv1,1,i):this.ComputeInits_NoImpl()}},f.prototype.ComputeInits_NurbsCentre=function(e,r,n,o){if(t.TypeCheckInternal(e,!0,t.NurbsCurve),t.TypeCheckInternal(r,!0,[t.Circle,t.Ellipse]),t.TypeCheckInternal(n,!0,"number"),t.TypeCheckInternal(o,!0,[],[]),this._VERSION>=7||1==this._VERSION_IR768315){this.ComputeInits_NurbsCanonical(e,r,n,2,o)}else{for(var i=e.ComputePolyline(),s=0,a=0;a<i.length;a++)s+=i[a].direction.norm();var c=0;for(a=0;a<e.CPs.length;a++){for(var h=c/s*(e.GetLastKnot()-e.GetFirstKnot()),p=r.center.sub(e.CPs[a]),l=new t.Line(e.CPs[a],p),u=(new t.Intersect(r,l,0,t.constants.PI2,0,p.norm()),lineIntersectorn()),y=0;y<u.length;y++){this._DEBUG>=2&&(console.log(""),console.log("Process intersection solution "+y));var m=new t.Point2D;0==n?(m.x=h,m.y=u[y][0]):(m.x=u[y][0],m.y=h),o.push(m)}a<e.CPs.length-1&&(c+=i[a].direction.norm())}}},f.prototype.ComputeInits_NurbsCanonical=function(e,r,n,o,i){if(t.TypeCheckInternal(e,!0,t.NurbsCurve),t.TypeCheckInternal(r,!0,[t.Line,t.Circle,t.Ellipse]),t.TypeCheckInternal(n,!0,"number"),t.TypeCheckInternal(o,!0,"number"),t.TypeCheckInternal(i,!0,[],[]),0==n)var s=this.range1;else s=this.range2;var a=e.GetSampleInits(o,s);if(0==n)var c=this.range2;else c=this.range1;var h={_Geometry:r,_Range:c},p={_Geometry:null},l=new t.MinDist(h,p);2===this._CAPTURE&&(l._CAPTURE=1),this._DEBUG>=3&&(l._DEBUG._LEVEL=this._DEBUG-1);for(var u=0;u<a.length;u++){p._Geometry=e.evalPoint(a[u]),l.UpdateGeometry(1,p);var y=l.Run();if(!1!==l.hasSol){if(this._VERSION>=8)y<c[0]?y=c[0]:y>c[1]&&(y=c[1]);else if(y<c[0]||y>c[1])continue;var m=new t.Point2D;0==n?(m.x=a[u],m.y=y):(m.y=a[u],m.x=y),i.push(m)}}},f.prototype.ComputeInits_NurbsNurbs=function(e){t.TypeCheckInternal(e,!0,[],[]),this.ComputeInits_Sampling(e)},f.prototype.ComputeInits_Sampling=function(e){for(var r=[this.crv1.GetDegree(),this.crv2.GetDegree()],o=[this.crv1,this.crv2],i=[this.range1,this.range2],s=(this.crv1.GetBox(this.range1),this.crv2.GetBox(this.range2),0);s<2;s++){var a=n.prototype.GetSampleInits(o[s],r[1-s],i[s]);this._DEBUG>=2&&console.log("Processing "+a.length+" inits for curve-"+s);var c={_Geometry:o[1-s],_Range:i[1-s]},h={_Geometry:null},p=new t.MinDist(c,h);2===this._CAPTURE&&(p._CAPTURE=1),this._DEBUG>=3&&(p._DEBUG._LEVEL=this._DEBUG-1);for(var l=0;l<a.length;l++){this._DEBUG>=2&&console.log("  Processing init["+l+"] at "+a[l]);var u=o[s].evalPoint(a[l]);h._Geometry=u,p.UpdateGeometry(1,h);var y=p.Run();if(!1!==p.hasSol){var m=new t.Point2D;0==s?(m.x=a[l],m.y=y):(m.x=y,m.y=a[l]),this._DEBUG>=2&&console.log("    --\x3e add init point at:"+m.getArray()),e.push(m)}else this._DEBUG>=2&&console.log("    --\x3e no min-dist solution --\x3e skip init")}}},f.prototype.ComputeInits_CentreCentre=function(e){t.TypeCheckInternal(e,!0,[],[]);for(var r=[this.crv1,this.crv2],n=0,o=0;o<2;o++)r[o].constructor==p?n+=r[o].radius:r[o].constructor==l&&(n+=r[o].radiusMaj);for(o=0;o<2;o++){var i=[new t.Vector3D,new t.Vector3D];r[o].getDirections(i);for(var s=0;s<2;s++)for(var a=new t.Line(r[o].center,i[s]),c=new t.Intersect(a,r[1-o],-n,n,0,t.constants.PI2).Run(),h=0;h<c.length;h++)for(var u=new t.Point2D(c[h][0],c[h][1]),y=r[1-o].evalPoint(u.y),m=r[1-o].evalFirstDeriv(u.y).normalize(),f=new t.Line(y,m),v=new t.Intersect(f,r[o],-n,n,0,t.constants.PI2).Run(),g=0;g<v.length;g++){var C=new t.Point2D(v[g][0],v[g][1]);0===o?e.push(new t.Point2D(C.y,u.y)):e.push(new t.Point2D(u.y,C.y))}}},f.prototype.IsCurveOutsideBox=function(e,r,n){t.TypeCheckInternal(e,!0,[t.Line,t.Circle,t.Ellipse,t.NurbsCurve]),t.TypeCheckInternal(r,!0,["number"],2),t.TypeCheckInternal(n,!0,t.Box);var o=.5*(r[0]+r[1]),i=e.evalPoint(o);if(n.Contains(i))return!1;for(var s=n.GetBorderLines(),a=0;a<s.length;a++){var c=s[a]._Line,h=s[a]._Range,p=new t.Intersect(e,c,r[0],r[1],h[0],h[1]);if(p.singleSol=!0,p.Run().length>0)return!1}return!0},f.prototype.ComputeInits_LineLine=function(e,r,n){t.TypeCheckInternal(e,!0,[t.Line],[]),t.TypeCheckInternal(r,!0,[t.Line],[]),t.TypeCheckInternal(n,!0,[],[]);for(var o=0,i=0;i<e.length;i++)o+=e[i].direction.norm();var s=0;for(i=0;i<r.length;i++)s+=r[i].direction.norm();var a=0;for(i=0;i<e.length;i++){for(var c=e[i].direction.norm(),h=0,p=0;p<r.length;p++){this._DEBUG>=2&&(console.log(""),console.log("Compute init from intersection of line["+i+"] and line["+p+"]"));var l=r[p].direction.norm(),u=e[i].intersectLine(r[p],-1e5,1e5,-1e5,1e5);if(0===u.diag){var y=(a+c/2)/o,m=(h+l/2)/s,f=new t.Point2D;f.x=this.UpdateInitParameter(this.crv1,e[i],this.range1,i,u.param1,y),f.y=this.UpdateInitParameter(this.crv2,r[p],this.range2,p,u.param2,m),n.push(f)}h+=l}a+=c}},f.prototype.ComputeInits_PolyLineCentre=function(e,r,n,o){for(var i=0,s=0;s<e.length;s++)i+=e[s].direction.norm();var a=0;for(s=0;s<e.length;s++){var c=e[s].direction.norm();this._DEBUG>=2&&(console.log(""),console.log("Compute init from intersection of line["+s+"] and other curve"),console.log(""));for(var h=(a+c/2)/i,p=new t.Intersect(e[s],r,-1e5,1e5,0,t.constants.PI2).Run(),l=0;l<p.length;l++){this._DEBUG>=2&&(console.log(""),console.log("Process intersection solution "+l));var u=new t.Point2D(p[l][0],p[l][1]);0===n?u.x=this.UpdateInitParameter(this.crv1,e[s],this.range1,s,u.x,h):u.y=this.UpdateInitParameter(this.crv2,e[s],this.range2,s,u.y,h),o.push(u)}a+=c}},f.prototype.ComputeInits_NoImpl=function(){console.error("No implementation of init computation")},f.prototype.UpdateInitParameter=function(e,r,o,i,s,a){t.TypeCheckInternal(e,!0,[t.Line,t.Circle,t.Ellipse,t.NurbsCurve]),t.TypeCheckInternal(r,!0,t.Line),t.TypeCheckInternal(o,!0,["number"],2),t.TypeCheckInternal(i,!0,"number"),t.TypeCheckInternal(s,!0,"number"),t.TypeCheckInternal(a,!0,"number");var c=s;if(e.constructor==u){var p=r.evalPoint(s),l=e.KnotVec[0].knotValue,y=e.KnotVec[e.KnotVec.length-1].knotValue;this._DEBUG>=2&&console.log("  NURBS curve - compute init near 3D point: "+p.getArray());var m={_Geometry:e,_Range:[l,y]},f={_Geometry:p},v=new t.MinDist(m,f);2===this._CAPTURE&&(v._CAPTURE=1),this._DEBUG>=1&&(v._DEBUG._LEVEL=this._DEBUG-1);var g,C=a*(y-l);g=!0===e.IsPeriodic()?v.Run():v.Run(C),!0===v.hasSol?(c=g,this._DEBUG>=2&&console.log("  min-dist operator converged to: "+c)):(c=C,this._DEBUG>=2&&console.warn("  min-dist operator didn't converge --\x3e use initial guess: "+C))}else e.constructor==h&&(c=n.prototype.PutInRange(r,s,o));return c},f.prototype.Run=function(e){t.TypeCheck(e,!1,["number"],2),1===this._CAPTURE&&this.Dump(),this._DEBUG>=1&&this.DebugSampleCurves();var r=[];if(!this.CheckInputs())return r;if(this._VERSION>=4||1==this._VERSION_IR767064){var o=this.crv1.GetBox(this.range1),i=this.crv2.GetBox(this.range2);if(this._DEBUG>=1&&(console.log("Curve-1 box from: "+o.Low.getArray()),console.log("              to: "+o.Upp.getArray()),console.log("Curve-2 box from: "+i.Low.getArray()),console.log("              to: "+i.Upp.getArray())),this._VERSION>=13){if(!1===o.InteractsWith(i,this.tolLength))return this._DEBUG>=1&&console.log(" Geometry boxes do not interact --\x3e no intersection"),r}else if(this._VERSION>=9&&(o.Inflate(this.tolLength),i.Inflate(this.tolLength)),!1===o.InteractsWith(i))return this._DEBUG>=1&&console.log(" Geometry boxes do not interact --\x3e no intersection"),r}var s=!1;if(!1===s&&(s=this.ComputeAnalytic(r),this._VERSION<1&&!0===s))return r;if(!1===s&&(s=this.ComputeAnalyticTilted(r),this._VERSION<1&&!0===s))return r;if(this._VERSION>=13){if(this.crv1.constructor===t.NurbsCurve&&this.crv2.constructor!==t.Line&&!0===this.IsCurveOutsideBox(this.crv1,this.range1,i))return this._DEBUG>=1&&console.log(" Curve-1 is outside the box of curve-2 --\x3e no intersection"),r;if(this.crv2.constructor===t.NurbsCurve&&this.crv1.constructor!==t.Line&&!0===this.IsCurveOutsideBox(this.crv2,this.range2,o))return this._DEBUG>=1&&console.log(" Curve-1 is outside the box of curve-2 --\x3e no intersection"),r}if(!1===s){var a=new Array;if(e?a[0]=new t.Point2D(e[0],e[1]):this.ComputeInits(a),this._DEBUG>=1){console.log("Computed "+a.length+" inits");for(e=0;e<a.length;e++)console.log("  init-"+e+": "+a[e].getArray())}for(var c=0;c<a.length;c++){if(this._DEBUG>=1){var h=this.crv1.evalPoint(a[c].x),p=this.crv2.evalPoint(a[c].y);console.log(""),console.log("Solve from init at: "+a[c].getArray()),this._DEBUG>=2&&(console.log("  --\x3e at 3D point: "+h.getArray()+" on curve-0"),console.log("  --\x3e at 3D point: "+p.getArray()+" on curve-1"));var l=h.sub(p).norm();console.log(" --\x3e separation: "+l)}var u=[];if(!1!==this.Solve(a[c],u)){for(var y=0;y<u.length;y++){var m=u[y];if(this._DEBUG>=1){console.log("  --\x3e converged to 2D point: "+m.getArray());var f=this.crv1.evalPoint(m.x),v=this.crv2.evalPoint(m.y);this._DEBUG>=2&&(console.log("    --\x3e 3D point (crv1): "+f.getArray()),console.log("    --\x3e 3D point (crv2): "+v.getArray()));l=f.sub(v).norm();console.log("   --\x3e separation: "+l)}var g=n.prototype.PutInDomain(m.x,this.range1,this.tolLength),C=n.prototype.PutInDomain(m.y,this.range2,this.tolLength);!1!==g[1]&&!1!==C[1]?(m.x=g[0],m.y=C[0],r.push(m.clone())):this._DEBUG>=1&&(console.log("  --\x3e converged to solution outside range"),!1===g[1]&&console.log("        outside the domain for curve-1: "+this.range1),!1===C[1]&&console.log("        outside the domain for curve-2: "+this.range2))}if(!0===this.singleSol&&r.length>0)break}else this._DEBUG>=1&&console.log("  --\x3e failed to converge")}}var D=[];for(c=0;c<r.length;c++){for(var T=!0,S=0;S<D.length&&!0===T;S++)Math.abs(r[c].x-D[S].x)<this.tolLength&&Math.abs(r[c].y-D[S].y)<this.tolLength&&(T=!1);!0===T&&(this._DEBUG>=1&&console.log("Adding solution pt-"+D.length+" at "+r[c].getArray()),D.push(r[c].clone()))}return D},f.prototype.Dump=function(){console.log("var interOp;"),console.log("{"),console.log(""),this.crv1.Dump(0),console.log(""),this.crv2.Dump(1),console.log(""),console.log("var range0 = ["+this.range1[0]+", "+this.range1[1]+"];"),console.log("var range1 = ["+this.range2[0]+", "+this.range2[1]+"];"),console.log("interOp = new DSMath.Intersect(geo0, geo1, range0[0], range0[1], range1[0], range1[1]);"),console.log("interOp.tolLength = "+this.tolLength+";"),console.log("interOp._VERSION_EXT = "+this._VERSION_EXT+";"),console.log("interOp._VERSION = "+this._VERSION+";"),console.log("} // end of intersection creation"),console.log(""),console.log("var sol2D = interOp.Run();"),console.log("var sol3D = interOp.Get3D(sol2D);")},f.prototype.DebugSampleCurves=function(){console.log("Intersect2D::Run");for(var e=[this.crv1,this.crv2],r=0;r<2;r++)if(e[r].constructor===l||e[r].constructor===p){console.log("  Sample curve-"+r);for(var n=0;n<4;n++){var o=n*t.constants.PI2/4,i=e[r].evalPoint(o),s=e[r].evalFirstDeriv(o);console.log("    at "+o+" --\x3e "+i.getArray()),console.log("      --\x3e tgt "+s.getArray())}}},t.Intersect2D=f,f}),define("MathematicsES/MathIntersect2DJSImpl",["DS/MathematicsES/MathIntersect2DJSImpl"],function(t){return t}),define("DS/MathematicsES/MathIntersectJSImpl",["DS/MathematicsES/MathNameSpace","DS/MathematicsES/MathTypeCheck","DS/MathematicsES/MathTypeCheckInternal","DS/MathematicsES/MathPointJSImpl","DS/MathematicsES/MathPoint2DJSImpl","DS/MathematicsES/MathLineJSImpl","DS/MathematicsES/MathCircleJSImpl","DS/MathematicsES/MathEllipseJSImpl","DS/MathematicsES/MathNurbsCurveJSImpl","DS/MathematicsES/MathPlaneJSImpl","DS/MathematicsES/MathIntersect2DJSImpl","DS/MathematicsES/MathIntersect3DJSImpl"],function(t,e,r,n,o,i,s,a,c,h){"use strict";var p=function(e,r,n,o,i,s){t.TypeCheck(e,!1,[t.Line,t.Circle,t.Ellipse,t.NurbsCurve,t.Plane]),t.TypeCheck(r,!1,[t.Line,t.Circle,t.Ellipse,t.NurbsCurve,t.Plane]),t.TypeCheck(n,!1,["number",["number"]]),t.TypeCheck(o,!1,["number",["number"]]),t.TypeCheck(i,!1,["number",["number"]]),t.TypeCheck(s,!1,["number",["number"]]),this.geo1=e||null,this.geo2=r||null,this.range1=[n,o],this.range2=[i,s]};return p.prototype.tolLength=1e-6,p.prototype.singleSol=!1,p.prototype._VERSION=13,p.prototype._VERSION_EXT=2,p.prototype._VERSION_IR765594=0,p.prototype._VERSION_IR767064=0,p.prototype._VERSION_IR768315=0,p.prototype._DEBUG=0,p.prototype._FORCE_LATEST_LEVEL=0,p.prototype._CAPTURE=0,p.prototype.ComputeDimension=function(e){var r=0;return e.constructor==i?r=1:e.constructor==s?r=1:e.constructor==a?r=1:e.constructor==c?r=1:e.constructor==t.Parabola?r=1:e.constructor==h&&(r=2),r},p.prototype.SetOptions=function(t){t._VERSION=this._VERSION,t._VERSION_EXT=this._VERSION_EXT,1===this._FORCE_LATEST_LEVEL&&(t._VERSION=p.prototype._VERSION),t._VERSION_IR765594=this._VERSION_IR765594,t._VERSION_IR767064=this._VERSION_IR767064,t._VERSION_IR768315=this._VERSION_IR768315,t._DEBUG=this._DEBUG,t._CAPTURE=this._CAPTURE,t.tolLength=this.tolLength,t.singleSol=this.singleSol},p.prototype.Run=function(e){t.TypeCheck(e,!1,[t.Point2D,["number"]]),1!=this._VERSION_IR765594&&1!=this._VERSION_IR767064||(this._VERSION_EXT=0);var r=this.ComputeDimension(this.geo1),n=this.ComputeDimension(this.geo2);if(1==r&&1==n){var o=new t.Intersect2D(this.geo1,this.geo2,this.range1[0],this.range1[1],this.range2[0],this.range2[1]);this.SetOptions(o);var i=o.Run(e);if(this._VERSION_EXT<1)return 1===this._CAPTURE&&this.DumpOutput3D(i),i;for(var s=[],a=0;a<i.length;a++)s.push([i[a].x,i[a].y]);return 1===this._CAPTURE&&this.DumpOutput3D(s),s}if(this._VERSION_EXT<2){return[]}if(1==r&&2==n){var c=new t.Intersect3D(this.geo1,this.geo2,this.range1[0],this.range1[1],this.range2[0],this.range2[1]);return this.SetOptions(c),p=c.Run(e)}if(2==r&&1==n){var h;c=new t.Intersect3D(this.geo2,this.geo1,this.range2[0],this.range2[1],this.range1[0],this.range1[1]);this.SetOptions(c),e&&(h=new Array(e[2],e[0],e[1]));for(var p=c.Run(h),s=[],l=0;l<p.length;l++)s.push(new Array(p[l][1],p[l][2],p[l][0]));return s}return s=[]},p.prototype.Get3D=function(e){t.TypeCheck(e,!0,["number"],[]);for(var r=[],n=0;n<e.length;n++){var o=[];if(0==this._VERSION_EXT)o[0]=this.geo1.evalPoint(e[n].x),o[1]=this.geo2.evalPoint(e[n].y);else for(var i=[this.geo1,this.geo2],s=0,a=0;a<2;a++){var c=this.ComputeDimension(i[a]);1==c?o[a]=i[a].evalPoint(e[n][s]):2==c&&(o[a]=i[a].evalPoint(e[n][s],e[n][s+1])),s+=c}var h=new t.Point;h.addScaledPoint(o[0],.5).addScaledPoint(o[1],.5),r[n]=h}return r},p.prototype.DumpOutput3D=function(t){var e=this.Get3D(t);console.log("var refSol3D = [];");for(var r=0;r<e.length;r++)console.log("refSol3D.push(new DSMath.Point("+e[r].getArray()+"));")},t.Intersect=p,p}),define("MathematicsES/MathIntersectJSImpl",["DS/MathematicsES/MathIntersectJSImpl"],function(t){return t}),define("DS/MathematicsES/MathDirectionJSImpl",["DS/MathematicsES/MathNameSpace","DS/MathematicsES/MathTypeCheck","DS/MathematicsES/MathTypeCheckInternal"],function(t,e,r){"use strict";var n=function(e,r,n){t.TypeCheck(e,!1,"number"),t.TypeCheck(r,!1,"number"),t.TypeCheck(n,!1,"number"),this.x=e||0,this.y=r||0,this.z=n||0,this.normalize()};return n.prototype.x=null,n.prototype.y=null,n.prototype.z=null,n.prototype.constructor=n,n.prototype.clone=function(){return new n(this.x,this.y,this.z)},n.prototype.copy=function(e){return t.TypeCheck(e,!0,t.Direction),this.x=e.x,this.y=e.y,this.z=e.z,this},n.prototype.set=function(e,r,n){return t.TypeCheck(e,!0,"number"),t.TypeCheck(r,!0,"number"),t.TypeCheck(n,!0,"number"),this.x=e,this.y=r,this.z=n,this.normalize(),this},n.prototype.setFromArray=function(e){return t.TypeCheck(e,!0,["number"],3),this.x=e[0],this.y=e[1],this.z=e[2],this.normalize(),this},n.prototype.setFromPoint=function(e){return t.TypeCheck(e,!0,t.Point),this.x=e.x,this.y=e.y,this.z=e.z,this.normalize(),this},n.prototype.setX=function(e){return t.TypeCheck(e,!0,"number"),this.x=e,this.normalize(),this},n.prototype.setY=function(e){return t.TypeCheck(e,!0,"number"),this.y=e,this.normalize(),this},n.prototype.setZ=function(e){return t.TypeCheck(e,!0,"number"),this.z=e,this.normalize(),this},n.prototype.getArray=function(e){return t.TypeCheck(e,!1,["number"],3),(e=e||new Array(3))[0]=this.x,e[1]=this.y,e[2]=this.z,e},n.prototype.squareNorm=function(){return 1},n.prototype.norm=function(){return 1},n.prototype.normalize=function(){var t=this.x*this.x+this.y*this.y+this.z*this.z;if(1==t);else if(0!=t){var e=1/Math.sqrt(t);this.x=this.x*e,this.y=this.y*e,this.z=this.z*e}else this.x=1,this.y=0,this.z=0},n.prototype.negate=function(){return this.x*=-1,this.y*=-1,this.z*=-1,this},n.prototype.cross=function(e){t.TypeCheck(e,!0,t.Direction);var r=this.x,n=this.y,o=this.z;return this.x=n*e.z-o*e.y,this.y=o*e.x-r*e.z,this.z=r*e.y-n*e.x,this.normalize(),this},n.prototype.dot=function(e){return t.TypeCheck(e,!0,t.Direction),this.x*e.x+this.y*e.y+this.z*e.z},n.prototype.isEqual=function(e,r){t.TypeCheck(e,!0,t.Direction),t.TypeCheck(r,!1,"number");return arguments.length<2?this.x==e.x&&this.y==e.y&&this.z==e.z:!(Math.abs(this.x-e.x)>r||Math.abs(this.y-e.y)>r||Math.abs(this.z-e.z)>r)},Object.defineProperty(n,"xDir",{value:new n(1,0,0),writable:!1,enumerable:!0,configurable:!1}),Object.freeze(n.xDir),Object.defineProperty(n,"yDir",{value:new n(0,1,0),writable:!1,enumerable:!0,configurable:!1}),Object.freeze(n.yDir),Object.defineProperty(n,"zDir",{value:new n(0,0,1),writable:!1,enumerable:!0,configurable:!1}),Object.freeze(n.zDir),n.negate=function(e,r){return t.TypeCheck(e,!0,t.Direction),t.TypeCheck(r,!1,t.Direction),(r=r?r.copy(e):e.clone()).negate()},n.cross=function(e,r,o){t.TypeCheck(e,!0,t.Direction),t.TypeCheck(r,!0,t.Direction),t.TypeCheck(o,!1,t.Direction),o=o||new n;var i=e.x,s=e.y,a=e.z,c=r.x,h=r.y,p=r.z;return o.x=s*p-a*h,o.y=a*c-i*p,o.z=i*h-s*c,o.normalize(),o},t.Direction=n,n}),define("MathematicsES/MathDirectionJSImpl",["DS/MathematicsES/MathDirectionJSImpl"],function(t){return t}),define("DS/MathematicsES/MathsDef",["DS/MathematicsES/MathNameSpace","DS/MathematicsES/MathGeometryUtils","DS/MathematicsES/MathAxisJSImpl","DS/MathematicsES/MathLineJSImpl","DS/MathematicsES/MathLine2DJSImpl","DS/MathematicsES/MathMat3x3JSImpl","DS/MathematicsES/MathMat2x2JSImpl","DS/MathematicsES/MathPlaneJSImpl","DS/MathematicsES/MathPoint2DJSImpl","DS/MathematicsES/MathPointJSImpl","DS/MathematicsES/MathQuaternionJSImpl","DS/MathematicsES/MathVector2DJSImpl","DS/MathematicsES/MathVector3DJSImpl","DS/MathematicsES/MathCircleJSImpl","DS/MathematicsES/MathEllipseJSImpl","DS/MathematicsES/MathNurbsCurveJSImpl","DS/MathematicsES/MathParabolaJSImpl","DS/MathematicsES/TransformationJSImpl","DS/MathematicsES/MathIntersectJSImpl","DS/MathematicsES/MathMinDistJSImpl","DS/MathematicsES/MathDirectionJSImpl","DS/MathematicsES/MathDeprecated"],function(t){"use strict";return t}),define("MathematicsES/MathsDef",["DS/MathematicsES/MathsDef"],function(t){return t});