define("DS/IssueComponents/external/RelationalExplorer",[],function(){"use strict";var e={WIDTH:700,HEIGHT:800};return{execute:function(t){require(["DS/TransientWidget/TransientWidget","DS/IssueServices/Contexts","DS/IssueServices/services/PlatformServices"],function(s,n,i){var r=n.get("widget"),a=[];if(t.forEach(function(e){a.push({envId:i.getTenant(),serviceId:"3DSpace",contextId:r.id,objectId:e,objectType:"",displayName:""})}),a.length>0){var o={protocol:"3DXContent",version:"1.1",source:n.get("widget").name,data:{items:a}},l={mode:"panel",height:e.HEIGHT,width:e.WIDTH};s.showWidget("ENORIPE_AP","",{X3DContentId:JSON.stringify(o),x3dPlatformId:i.getTenant()},l)}})}}}),define("DS/IssueComponents/team/MembersFilterView",["UWA/Class/View","i18n!DS/IssueComponents/assets/nls/IssueComponents","UWA/Core"],function(e,t,s){return e.extend({name:"teamfilter",tagName:"div",className:"iss-member-view",setup:function(){this.template='                                                <div class="'+this.getClassNames("-role-filter")+'">                                                    <table class="filter-table table">                                                        <tr >                                                            <td style="color: gray;">'+t.team.filter.filterByName+'</td>                                                            <td>                                                                <div class="filter-input">                                                                    <input type="text" placeholder="'+t.team.filter.searchPlaceholder+'" class="form-control form-control-root filtertext">                                                                    <div class="clear-filter fonticon fonticon-cancel-circled"></div>                                                                </div>                                                            </td>                                                        </tr>                                                      </table>                                                   </div>'},init:function(e){e=s.clone(e||{},!1),this._parent.call(this,e)},render:function(){this.name,this.cid;this.container.empty(),containerReference=this.container;var e=UWA.createElement("div",{class:"iss-member-view-role-filter",styles:{height:"10%"}});return e.addContent(this.template),e.inject(containerReference),this},domEvents:{"keyup .filtertext":function(e){var t=e.target.value,s=this.container.getElement(".clear-filter");t.length>0?s.setStyle("visibility","visible"):s.setStyle("visibility","hidden"),this.dispatchEvent("memberFilterKeyUp",arguments)},"click .clear-filter":function(e){this.container.getElement(".clear-filter").setStyle("visibility","hidden");var t=this.container.getElement(".filtertext");if(t){t.value=""}this.dispatchEvent("memberFilterKeyUp",{target:{value:""}})},"focus .filtertext":function(){var e=document.getElementsByClassName("searchfiler-input-container");e.addClassName("highlighted-border"),e.removeClassName("border-without-focus")}}})}),define("DS/IssueComponents/routes/Routes",["UWA/Class/View","UWA/Core","UWA/Class/Promise","DS/Logger/Logger","DS/Tree/TreeListView","DS/TreeModel/TreeNodeModel","DS/UIKIT/Scroller","DS/UIKIT/Tooltip","DS/IssueCommon/commands/CommandsManager","DS/IssueCommon/utils/Utils","DS/IssueServices/Contexts","DS/IssueServices/services/IssueServices","DS/IssueServices/services/PlatformServices","DS/IssueServices/utils/Performance","i18n!DS/IssueComponents/assets/nls/IssueComponents","css!DS/IssueComponents/IssueComponents.css"],function(e,t,s,n,i,r,a,o,l,c,d,u,m,p,f){"use strict";var h={STATES:{CREATE:0,ASSIGN:1,ACTIVE:2,REVIEW:3,CLOSED:4},STATES_ORDER:{0:"CREATE",1:"ASSIGN",2:"ACTIVE",3:"REVIEW",4:"CLOSED"},CSS:{ELEMENTS:{SCROLLCONTENT:"im-routes-scroll-content",SCROLLCONTAINER:"im-routes-scroll-container",TABLE_CONTAINER:"im-routes-table-container",TABLE_HEADER:"im-routes-table-header",TABLE_HEADER_STATES:"im-routes-table-header-states",TABLE_HEADER_ROUTES:"im-routes-table-header-routes",TABLE_ROWS_CONTAINER:"im-routes-table-rows-container",TABLE_ROW:"im-routes-table-row",TABLE_ROW_STATES_CELL:"im-routes-table-row-states-cell",TABLE_ROW_STATES_CELL_STATE_BLOCK:"im-routes-table-row-states-cell-state-block",TABLE_ROW_STATES_CELL_STATE_BLOCK_CURRENT:"im-routes-table-row-states-cell-state-block-curr",TABLE_ROW_STATES_CELL_STATE_BLOCK_CREATE:"im-routes-table-row-states-cell-state-block-create",TABLE_ROW_STATES_CELL_STATE_BLOCK_ASSIGN:"im-routes-table-row-states-cell-state-block-assign",TABLE_ROW_STATES_CELL_STATE_BLOCK_ACTIVE:"im-routes-table-row-states-cell-state-block-active",TABLE_ROW_STATES_CELL_STATE_BLOCK_REVIEW:"im-routes-table-row-states-cell-state-block-review",TABLE_ROW_STATES_CELL_STATE_BLOCK_CLOSED:"im-routes-table-row-states-cell-state-block-closed",TABLE_ROW_STATES_CELL_ARROW_ASC:"fonticon fonticon-2x fonticon-double-chevron-down im-lifecycle-approve-modal-preview-arrow",TABLE_ROW_STATES_CELL_ARROW_DESC:"fonticon fonticon-2x fonticon-double-chevron-up im-lifecycle-approve-modal-preview-arrow",TABLE_ROW_ROUTES_CELL:"im-routes-table-row-routes-cell",TABLE_ROW_ROUTES_CELL_STATUS:"im-routes-table-row-routes-cell-status",TABLE_ROW_ROUTES_CELL_MULTI:"im-routes-table-row-routes-cell-multi",TABLE_ROW_ROUTES_CELL_DECISION_ROW:"im-routes-table-row-routes-cell-decision-row",TABLE_ROW_ROUTES_CELL_DECISION_STATUS:"im-routes-table-row-routes-cell-decision-status",ICON_APPROVED:"fonticon fonticon-check im-routes-icon-approved",ICON_REJECTED:"fonticon fonticon-wrong im-routes-icon-rejected",ICON_ABSTAINED:"fonticon fonticon-minus im-routes-icon-abstained",ICON_INPROGRESS:"fonticon fonticon-clock im-routes-icon-inprogress",CELL_DECISION_TEXT:"im-routes-table-row-routes-cell-decision-text",CELL_DECISION_TOOLTIP_TEXT:"im-routes-table-row-routes-cell-decision-tooltip-text",WEBUX_CELL_SINGLE:"im-routes-wux-datagrid-cell-single",WEBUX_CELL_MULTI:"im-routes-wux-datagrid-cell-multi"}},TREELIST:{CELLHEIGHT:32,GRID:{allowUnsafeHTMLContent:!1,height:"100%",apiVersion:2,defaultCellHeight:26,headersDimensions:{width:void 0,height:26},useTransparentScroller:!1,useNativeScroller:!1,useAsyncPreExpand:!0,resize:{columns:!0,rows:!1},selection:{unselectAllOnEmptyArea:!0,toggle:!1,canMultiSelect:!0,enableListSelection:!0,renderingMode:"adaptive"},columns:[{dataIndex:"tree",isHidden:!0,isSortable:!1},{dataIndex:"status",width:55,isDraggable:!1,text:"",isSortable:!1},{width:37,dataIndex:"decisionStatus",isDraggable:!1,text:"",isSortable:!1},{width:"auto",dataIndex:"reviewer",isDraggable:!1,text:f.routes.columns.reviewer,isSortable:!1},{width:"auto",dataIndex:"date",isDraggable:!1,text:f.routes.columns.date,isSortable:!1},{width:"auto",dataIndex:"reason",isDraggable:!1,text:f.routes.columns.reason,isSortable:!1},{width:"auto",dataIndex:"attachments",isDraggable:!1,text:f.routes.columns.attachments,isSortable:!1}]}}};return e.extend({name:"DS/IssueComponents/routes/Routes",tagName:"div",className:"im-routes-component",_logger:null,domEvents:{},defaultOptions:{ids:[],states:["Create","Assign","Active","Review","Closed"]},setup:function(e){var t=this;p.start(t.name+" setup"),t._parent(e),t._logger=n.getLogger(t.name),t.elements={},t._tooltips=[],t._deferred={},t.isLoaded=new s(function(e,s){t._deferred.resolve=e,t._deferred.reject=s}),t.physicalId=e.physicalId,t.order="descending",t.routes=null,t.treeLists=null,t.isEmpty=!1,p.end(t.name+" setup")},render:function(){p.start(this.name+" render");var e=this.elements.tableContainer=t.createElement("div",{class:h.CSS.ELEMENTS.TABLE_CONTAINER+" "+h.CSS.ELEMENTS.SCROLLCONTENT});e.inject(this.container);var s=this.elements.tableHeader=t.createElement("div",{class:h.CSS.ELEMENTS.TABLE_HEADER});s.inject(e),t.createElement("div",{class:h.CSS.ELEMENTS.TABLE_HEADER_STATES,html:f.routes.header.states,title:f.routes.header.states}).inject(s),t.createElement("div",{class:h.CSS.ELEMENTS.TABLE_HEADER_ROUTES,html:f.routes.header.routes}).inject(s),(this.elements.tableRowsContainer=t.createElement("div",{class:h.CSS.ELEMENTS.TABLE_ROWS_CONTAINER})).inject(e);var n=this.elements.scrollContainer=t.createElement("div",{class:h.CSS.ELEMENTS.SCROLLCONTAINER}).inject(this.container);return this._scroller=new a({element:e}).inject(n),this.refresh(this.physicalId),this},refresh:function(e){var s=this;return s.reset(),s.physicalId=e,s.setOption("physicalId",e),u.routes.retrieve({data:{objects:[{physicalId:e}]}}).then(function(e){if(Array.isArray(e.results)&&1===e.results.length){var n=s.routes=e.results[0].body,a={create:[],assign:[],active:[],review:[],closed:[]};s.treeLists={create:null,assign:null,active:null,review:null,closed:null};var o=d.get("maturityGraph");n.history.forEach(function(e){a[e.from.toLowerCase()].push(e)}),Object.keys(a).forEach(function(e){a[e]=a[e].sort(function(e,t){var n=0;if(e.date)if(t.date){n=new Date(e.date)-new Date(t.date)}else n=1;else n=-1;return n*("ascending"===s.order?1:-1)}),a[e].forEach(function(e){e.decisions=e.decisions.sort(function(e,t){var n=0;if(e.date)if(t.date){n=new Date(e.date)-new Date(t.date)}else n=1;else n=-1;return n*("ascending"===s.order?1:-1)})})}),n.current&&n.current.from&&("ascending"===s.order?a[n.current.from.toLowerCase()].push(n.current):a[n.current.from.toLowerCase()].unshift(n.current)),s.isEmpty=Object.keys(a).every(function(e){return 0===a[e].length});var l=Object.keys(a);"ascending"!==s.order&&(l=l.reverse()),l.forEach(function(e){var l=a[e];if(l.length>0){var c=t.createElement("div",{class:h.CSS.ELEMENTS.TABLE_ROW});c.setData("state",e),c.inject(s.elements.tableRowsContainer);var d=t.createElement("div",{class:h.CSS.ELEMENTS.TABLE_ROW_STATES_CELL});d.inject(c);var u=e.substring(0,1).toUpperCase()+e.substring(1).toLowerCase(),m=t.createElement("div",{class:h.CSS.ELEMENTS.TABLE_ROW_STATES_CELL_STATE_BLOCK+" "+h.CSS.ELEMENTS["TABLE_ROW_STATES_CELL_STATE_BLOCK_"+e.toUpperCase()]+" "+h.CSS.ELEMENTS.TABLE_ROW_STATES_CELL_STATE_BLOCK_CURRENT,html:o[u]});m.inject(d),m.setStyle("order","ascending"===s.order?1:3);var p=t.createElement("span",{class:"ascending"===s.order?h.CSS.ELEMENTS.TABLE_ROW_STATES_CELL_ARROW_ASC:h.CSS.ELEMENTS.TABLE_ROW_STATES_CELL_ARROW_DESC});p.inject(d),p.setStyle("order",2);var g=h.STATES_ORDER[h.STATES[e.toUpperCase()]+1].toLowerCase(),v=g.substring(0,1).toUpperCase()+g.substring(1).toLowerCase(),b=t.createElement("div",{class:h.CSS.ELEMENTS.TABLE_ROW_STATES_CELL_STATE_BLOCK+" "+h.CSS.ELEMENTS["TABLE_ROW_STATES_CELL_STATE_BLOCK_"+g.toUpperCase()],html:o[v]});b.inject(d),b.setStyle("order","ascending"===s.order?3:1);var C=t.createElement("div",{class:h.CSS.ELEMENTS.TABLE_ROW_ROUTES_CELL});C.inject(c);var E=t.clone(h.TREELIST.GRID);E.id="im-routes-component-treelist-"+e;var I=l.reduce(function(e,t){return t.decisions.length>e&&(e=t.decisions.length),e},1);E.defaultCellHeight=h.TREELIST.CELLHEIGHT*I,E.columns=s._customizeColumnRendering(E.columns);var y=new i(E);y.options.shouldDisplayTooltip=function(e){if(!e.isHeader){var t="";if("status"==e.dataIndex)switch(e.nodeModel.options.grid.status){case"inProgress":t=f.routes.status.inProgress;break;case"approved":t=f.routes.status.approved;break;case"rejected":t=f.routes.status.rejected}return{longHelp:t}}},y.onNodeClick(function(){Object.keys(s.treeLists).forEach(function(e){null!==s.treeLists[e]&&s.treeLists[e]!==y&&s.treeLists[e].getManager().unselectAll()})}),y.inject(C),l.forEach(function(e){var s={id:e.physicalId,grid:t.clone(e)};s.grid.issueId=n.physicalId;var i=new r(s);y.addRoot(i)}),c.setStyle("height",(l.length*I+1)*h.TREELIST.CELLHEIGHT+20),y.elements.container.setStyle("height","100%"),s.treeLists[e]=y}})}}).then(function(){s.resize(),s.dispatchEvent("onReady")}).catch(function(e){s.dispatchEvent("onFailure",e)})},resize:function(){},reset:function(){this.elements.tableRowsContainer.empty();try{this._tooltips.forEach(function(e){e.destroy()})}catch(e){}this._tooltips=[]},destroy:function(){this.reset()},selectRoute:function(e){var t=this;Object.keys(t.treeLists).forEach(function(e){null!==t.treeLists[e]&&t.treeLists[e].getManager().unselectAll()});var s=t.treeLists[e.from.toLowerCase()];null!=s&&s.getRoots().forEach(function(t){t.options.id===e.physicalId&&(t.highlight(),t.select())})},_customizeColumnRendering:function(e){var s=this,n=t.clone(e);return n.forEach(function(e){switch(e.dataIndex){case"status":e.onCellRequest=s._columnRenderer.status.bind(s);break;case"decisionStatus":e.onCellRequest=s._columnRenderer.decisionStatus.bind(s);break;case"reviewer":e.onCellRequest=s._columnRenderer.reviewer.bind(s);break;case"date":e.onCellRequest=s._columnRenderer.date.bind(s);break;case"reason":e.onCellRequest=s._columnRenderer.reason.bind(s);break;case"attachments":e.onCellRequest=s._columnRenderer.attachments.bind(s)}}),n},_columnRenderer:{status:function(e){if(!e.isHeader){var s=e.nodeModel.options.grid,n=t.createElement("div",{class:h.CSS.ELEMENTS.TABLE_ROW_ROUTES_CELL_STATUS}),i=h.CSS.ELEMENTS["ICON_"+s.status.toUpperCase()];t.createElement("div",{class:i}).inject(n),e.cellView.getContent().addClassName(h.CSS.ELEMENTS.WEBUX_CELL_SINGLE),e.cellView.getContent().setContent(n)}},decisionStatus:function(e){if(!e.isHeader){var s=e.nodeModel.options.grid,n=t.createElement("div",{class:h.CSS.ELEMENTS.TABLE_ROW_ROUTES_CELL_MULTI});s.decisions.forEach(function(i){e.cellView.getContent().addClassName(h.CSS.ELEMENTS.WEBUX_CELL_MULTI);var r=t.createElement("div",{class:h.CSS.ELEMENTS.TABLE_ROW_ROUTES_CELL_DECISION_ROW}),a=Math.floor(1/s.decisions.length*100);r.setStyle("height",a+"%"),r.inject(n);var o=h.CSS.ELEMENTS["ICON_"+i.status.toUpperCase()];t.createElement("span",{class:o}).inject(r)}),e.cellView.getContent().setContent(n)}},reviewer:function(e){var s=this;if(!e.isHeader){var n=e.nodeModel.options.grid,i=t.createElement("div",{class:h.CSS.ELEMENTS.TABLE_ROW_ROUTES_CELL_MULTI});n.decisions.forEach(function(r){e.cellView.getContent().addClassName(h.CSS.ELEMENTS.WEBUX_CELL_MULTI);var a=t.createElement("div",{class:h.CSS.ELEMENTS.TABLE_ROW_ROUTES_CELL_DECISION_ROW}),l=Math.floor(1/n.decisions.length*100);a.setStyle("height",l+"%"),a.inject(i);var c=r.reviewer.fullName,d=t.createElement("div",{class:h.CSS.ELEMENTS.CELL_DECISION_TEXT,html:c});d.inject(a),s._tooltips.push(new o({position:"bottom",target:d,body:t.createElement("span",{class:h.CSS.ELEMENTS.CELL_DECISION_TOOLTIP_TEXT,html:c})}))}),e.cellView.getContent().setContent(i)}},date:function(e){var s=this;if(!e.isHeader){var n=e.nodeModel.options.grid,i=t.createElement("div",{class:h.CSS.ELEMENTS.TABLE_ROW_ROUTES_CELL_MULTI});n.decisions.forEach(function(r){e.cellView.getContent().addClassName(h.CSS.ELEMENTS.WEBUX_CELL_MULTI);var a=t.createElement("div",{class:h.CSS.ELEMENTS.TABLE_ROW_ROUTES_CELL_DECISION_ROW}),l=Math.floor(1/n.decisions.length*100);a.setStyle("height",l+"%"),a.inject(i);var c=r.date?new Date(r.date).toLocaleString(d.get("widget").lang):"",u=t.createElement("div",{class:h.CSS.ELEMENTS.CELL_DECISION_TEXT,html:c});u.inject(a),s._tooltips.push(new o({position:"bottom",target:u,body:t.createElement("span",{class:h.CSS.ELEMENTS.CELL_DECISION_TOOLTIP_TEXT,html:c})}))}),e.cellView.getContent().setContent(i)}},reason:function(e){var s=this;if(!e.isHeader){var n=e.nodeModel.options.grid,i=t.createElement("div",{class:h.CSS.ELEMENTS.TABLE_ROW_ROUTES_CELL_MULTI});n.decisions.forEach(function(r){e.cellView.getContent().addClassName(h.CSS.ELEMENTS.WEBUX_CELL_MULTI);var a=t.createElement("div",{class:h.CSS.ELEMENTS.TABLE_ROW_ROUTES_CELL_DECISION_ROW}),l=Math.floor(1/n.decisions.length*100);a.setStyle("height",l+"%"),a.inject(i);var d=r.reason||r.comment,u=t.createElement("div",{class:h.CSS.ELEMENTS.CELL_DECISION_TEXT,html:c.getTextFromHTML(d)});u.inject(a),s._tooltips.push(new o({position:"bottom",target:u,body:t.createElement("span",{class:h.CSS.ELEMENTS.CELL_DECISION_TOOLTIP_TEXT,html:c.getTextFromHTML(d)})}))}),e.cellView.getContent().setContent(i)}},attachments:function(e){if(!e.isHeader){var s=e.nodeModel.options.grid,n=t.createElement("div",{class:h.CSS.ELEMENTS.TABLE_ROW_ROUTES_CELL_MULTI});e.cellView.getContent().addClassName(h.CSS.ELEMENTS.WEBUX_CELL_MULTI);var i=t.createElement("div",{class:h.CSS.ELEMENTS.TABLE_ROW_ROUTES_CELL_DECISION_ROW}),r=Math.floor(1/s.decisions.length*100);i.setStyle("height",r+"%"),i.inject(n);var a=t.createElement("span",{class:"fonticon fonticon-popup"}),o=t.createElement("div",{class:h.CSS.ELEMENTS.CELL_DECISION_TEXT+" clickable",html:a});o.inject(i),o.addEventListener("click",function(){l.getCommand("AttachmentManager").selectedObject={physicalId:s.issueId,title:f.replace(f.routes.attachmentsManagerTitle,{fromState:f.maturity[s.from.toLowerCase()],toState:f.maturity[s.approveTo.toLowerCase()]})},l.getCommand("AttachmentManager").begin()}),e.cellView.getContent().setContent(n)}}}})}),define("DS/IssueComponents/create/AutoComplete",["UWA/Core","DS/Utilities/Dom","DS/Controls/Abstract","DS/Controls/SelectionChips","DS/Controls/LineEditor","DS/Controls/Popup","DS/DataGridView/DataGridView","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/Core/PointerEvents"],function(e,t,s,n,i,r,a,o,l,c){"use strict";var d=[{text:"Text",dataIndex:"tree",autoRowHeightFlag:!0}];return s.inherit({name:"autoComplete",publishedProperties:{placeholder:{defaultValue:"",type:"string"},selectedValues:{defaultValue:[],type:"array"},rangeValues:{defaultValue:[],type:"array"},dataType:{defaultValue:"string",type:"string"}},buildView:function(e){this.elements.container.addClassName("wux-controls-autoComplete"),this.selectedItems=[],this._nbItemsToDisplay=-1},_postBuildView:function(){if(void 0===this._editor){var e="";"integer"===this.dataType?e="[0-9]+":"real"===this.dataType&&(e="[0-9]+|([0-9]+.[0-9]+)"),this._editor=new i({placeholder:this.placeholder,displayStyle:"text",fireOnlyFromUIInteractionFlag:!0,pattern:e}),this._editor.getContent().setStyle("width","100%"),this._editor.getContent().addClassName("iss-controls-autoComplete-editor")}(function(){this._selectionChips=new n({fireOnlyFromUIInteractionFlag:!0}),this._selectionChips.getContent().addClassName("wux-controls-autoComplete-selectionChips");var e=this;t.addEventOnElement(this,this._selectionChips,"onPostRemove",function(t){if(t.options.chips.length>1)e.selectedItems=[];else for(var s=t.options.chips.chipOptions.value,n=0;n<e.selectedItems.length;n++)if(e.selectedItems[n].value===s){e.selectedItems.splice(n,1);break}e.fire("change")}),t.addEventOnElement(this,this._selectionChips,"change",function(e){e.stopPropagation()})}).call(this),this._editor._myInput.style.width="70%",this._editor.displayStyle="lite",this._editor.displayStyle="lite",this._selectionChips.addLastWidget(this._editor),this._selectionChips.inject(this.elements.container),void 0!==this.selectedValues&&this.selectedValues.length>0&&this._addChips(this.selectedValues)},_showPopup:function(){if(!this.elements.popup){var t={target:this,position:"bottom",offset:{x:0,y:4},className:"wux-controls-autoComplete-popup wux-controls-popup",constraint:"screen",alignment:"near",overlap:!1,trigger:"",overlapCallback:function(e){}};if(this.elements.popup=new r(t),this._dataGridViewContainer=new e.Element("div"),this.elements.popup.setBody(this._dataGridViewContainer),this._dataGridViewContainer.addClassName("wux-controls-autoComplete-dataGridViewContainer"),this._model=new o,this.rangeValues.length>0)for(var s=0;s<this.rangeValues.length;s++){this._model.prepareUpdate();var n=new l({label:this.rangeValues[s],id:this.rangeValues[s]});this._model.addRoot(n),this._model.pushUpdate()}var i={treeDocument:this._model,columns:d,cellSelection:"none",selectionBehavior:{toggle:!0},showAlternateBackgroundFlag:!1,showRowBorderFlag:!0};this._dataGridView=new a(i),this._dataGridView.layout.columnsHeader=!1,this._dataGridView.layout.rowsHeader=!1,this._dataGridView.getContent().addClassName("wux-controls-autoComplete-dataGridView"),this._dataGridView.inject(this._dataGridViewContainer);var c=this;this._dataGridView.getTreeDocument().getXSO().onAdd(function(e){if(c._dataGridView.unselectAll(),c._hidePopup(),!c._selectionChips.getAllChipsAsLabels().includes(e.options.label)){var t=[];t.push(e.options.label),c._addChips(t)}c._editor._myInput.value="",!c.rangeValues.length>0&&c._editor._myInput.focus()})}this._updateNbDisplayedElements(this),this._updatePopupHeight(this);var u=this.elements.container.getBoundingClientRect().width;this._dataGridViewContainer.style.width=u+"px",this.elements.popup.visibleFlag=!0,this.fire("show")},_addChips:function(e){var t=this;e.forEach(function(e){e=e.toString(),t._selectionChips.addChip({label:e,value:e}),t.selectedItems.push({label:e,value:e}),t.fire("change")})},_updateNbDisplayedElements:function(e){var t=0;this._model.processDescendants({onlyVisibleNodes:!0,processNode:function(e){t++}}),this._nbItemsToDisplay=t<10?t:10},_updatePopupHeight:function(){if(this._dataGridViewContainer){var e=27*this._nbItemsToDisplay+"px";this._nbItemsToDisplay<10&&0!=this._nbItemsToDisplay?this._dataGridViewContainer.style.height!==e&&(this._dataGridViewContainer.style.height=e):0==this._nbItemsToDisplay?this._dataGridViewContainer.style.height="27px":(e=27*this._nbItemsToDisplay+"px",this._dataGridViewContainer.style.height=e),null!=this.elements.popup&&this.elements.popup._updateView()}},_hidePopup:function(){this.elements.popup&&this.elements.popup.visibleFlag&&(this.elements.popup.visibleFlag=!1,this.fire("hide"))},handleEvents:function(){var e=this;t.addEventOnElement(this,this._editor,"change",function(e){e.stopPropagation()}),t.addEventOnElement(this,this._editor._myInput,"focus",function(t){e.rangeValues.length>0&&e._showPopup()}),t.addEventOnElement(this,this._editor._myInput,"input",function(t){if(""==e._editor._myInput.value)!e.rangeValues.length>0&&e._hidePopup();else if(e._editor.validFlag){if(e._showPopup(),!e.rangeValues.length>0){e._model.empty();var s=new l({label:e._editor._myInput.value,id:e._editor._myInput.value});e._model.addRoot(s)}}else e._hidePopup()}),t.addEventOnElement(this,this._editor._myInput,"keyup",function(t){if(13===t.keyCode)if(e.rangeValues.length>0&&e.rangeValues.includes(e._editor._myInput.value)||!e.rangeValues.length>0&&e._editor.validFlag){if(!e._selectionChips.getAllChipsAsLabels().includes(e._editor._myInput.value)){var s=[];s.push(e._editor._myInput.value),e._addChips(s)}e._editor._myInput.value="",e._hidePopup(),e._editor._myInput.focus()}else e._editor._myInput.value=""}),t.addEventOnElement(this,document,c.POINTERDOWN,function(t){e.elements.container&&e.elements.popup&&(e.elements.container.contains(event.target)||e.elements.popup.elements.container.contains(event.target)||e._hidePopup())})}})}),define("DS/IssueComponents/search/PeopleSearchUI",["DS/SearchWidget/componentUI/SearchWidgetUI","i18n!DS/IssueComponents/assets/nls/IssueComponents"],function(e,t){"use strict";var s="js-selected";return e.extend({init:function(e){var t=this;t._parent(e);var n=t.searchInput.options.events.onKeyDown;t.searchInput.removeEvent("onKeyDown"),t.searchInput.addEvent("onKeyDown",function(e){if(13===e.which){var i=t.filterAreaContent.getElement("."+s);if(null!==i)t._elementIsButton(i)?(t.selectNextOrPreviousResult("previous"),i.click(),t.selectNextOrPreviousResult("next")):t.__setInput(i),e.stopPropagation();else t.hideLoadingGif(),t.ClearDialog(),t.dispatchEvent("onExpressSearch",t.searchInput.getValue())}else 38===e.which||40===e.which?n(e):(t.hideLoadingGif(),t.ClearDialog(),n(e))}),t._raiseError=t.raiseError,t.raiseError=function(e){t.customRaiseError(e)}},customRaiseError:function(e){"SW_WarningNotFound"===e.customClass&&this.searchInput.getValue().contains(";")&&(e.code="info",e.message=t.search.info.expressSearch),this._raiseError(e)}})}),define("DS/IssueComponents/team/MembersDataGridViewToolbar",["i18n!DS/IssueComponents/assets/nls/IssueComponents"],function(e){var t=Object.create(null);return t.toolbar=null,t.propagate={menu:[{type:"PushItem",title:e.team.toolbar.propagateCoowners,action:{module:"DS/IssueComponents/team/MembersDataGridLayout",func:"propagateCoowners"},tooltip:e.team.toolbar.propagateCoowners},{type:"PushItem",title:e.team.toolbar.propagateAssignees,action:{module:"DS/IssueComponents/team/MembersDataGridLayout",func:"propagateAssignees"},tooltip:e.team.toolbar.propagateAssignees},{type:"PushItem",title:e.team.toolbar.propagateContributors,action:{module:"DS/IssueComponents/team/MembersDataGridLayout",func:"propagateContributors"},tooltip:e.team.toolbar.propagateContributors},{type:"PushItem",title:e.team.toolbar.propagateInformedUsers,action:{module:"DS/IssueComponents/team/MembersDataGridLayout",func:"propagateInformedUsers"},tooltip:e.team.toolbar.propagateInformedUsers}]},t.writetoolbarDefinition=function(){var t={entries:[{id:"assigntoself",dataElements:{typeRepresentation:"functionIcon",icon:{iconName:"user-ok",fontIconFamily:1},tooltip:e.team.toolbar.assignToSelf,position:"far",category:"add",action:{module:"DS/IssueComponents/team/AddMembersLayout",func:"assignToSelf"}}},{id:"add",dataElements:{typeRepresentation:"functionIcon",icon:{iconName:"user-add",fontIconFamily:1},tooltip:e.team.toolbar.addMember,position:"far",category:"add",action:{module:"DS/IssueComponents/team/AddMembersLayout",func:"launchAddMemberPanel"}}},{id:"remove",dataElements:{typeRepresentation:"functionIcon",icon:{iconName:"remove",fontIconFamily:1},tooltip:e.team.toolbar.remove,position:"far",disabled:!0,category:"modify",action:{module:"DS/IssueComponents/team/MembersDataGridLayout",func:"removeHandler"}}},{id:"filter",dataElements:{typeRepresentation:"functionIcon",icon:{iconName:"filter",fontIconFamily:1},tooltip:e.team.toolbar.filter,position:"far",category:"modify",action:{module:"DS/IssueComponents/team/MembersFilterLayout",func:"launchFilterMemberPanel"}}},{id:"propagate",dataElements:{typeRepresentation:"sortingdropdown",icon:{iconName:"propagate",fontIconFamily:1},tooltip:e.team.menu.propagate,value:this.propagate},position:"far",category:"modify"}]};return JSON.stringify(t)},t}),define("DS/IssueComponents/konami/Konami",["UWA/Core","DS/WebappsUtils/WebappsUtils","css!DS/IssueComponents/IssueComponents.css"],function(e,t){"use strict";return{kojima:function(){this.onKonamiCode(function(){new Audio(t.getWebappsAssetUrl("IssueComponents","others/kojima.png")).play()})},onKonamiCode:function(e){var t="",s="38384040373937396665";document.addEventListener("keydown",function(n){if((t+=n.keyCode.toString())===s)return e();s.indexOf(t)&&(t=n.keyCode.toString())})}}}),define("DS/IssueComponents/open/Open",["UWA/Class/Promise","UWA/Core","UWA/Utils/InterCom","DS/Logger/Logger","DS/PADUtils/views/PADAlert","DS/WAFData/WAFData","DS/IssueCommon/utils/Selector","DS/IssueServices/Contexts","DS/IssueServices/services/PlatformServices","DS/IssueServices/utils/LocalStorage","DS/IssueServices/utils/Performance","DS/IssueServices/utils/Views","i18n!DS/IssueComponents/assets/nls/IssueComponents","css!DS/IssueComponents/IssueComponents.css"],function(e,t,s,n,i,r,a,o,l,c,d,u,m){"use strict";var p="DS/IssueComponents/open/Open",f=6e5,h="ENXISSU_AP",g="ENX3DIR_AP",v={expand:function(s){var n=o.get("widget");return new e(function(e,i){var a={method:"POST"};a.headers={Accept:"application/json","Accept-Language":n.lang,"Content-Type":"application/json",SecurityContext:"ctx::"+l.getSecurityContext()},a.timeout=f,a.onComplete=function(s){var n=t.is(s,"string")?JSON.parse(s):s;e(n)},a.onFailure=function(e){i(e)};var o=s.reduce(function(e,t){return e.push([t]),e},[]),c={label:n.name+"-"+l.getUserName()+"-"+Date.now(),authored:!1,root_path_physicalid:o,intent:"explore_2D","q.iterative_filter_query_bo":'[ds6w:globalType]:"ds6w:Document" OR [ds6w:globalType]:"ds6w:Part"',no_type_filter_rel:["XCADBaseDependency"],include_param_Attributes:!0,paths:o,level:"-1",source:"cstorage"};a.data=JSON.stringify(c),r.authenticatedRequest(l.assembleURLFor3DSpace("/resources/enopad/lwc/expand"),a)})},generateFileContent:function(e,s){var n={version:"2.2",results:[],structures:[],viewpoint:[]};return this.expand(e).then(function(i){var r=i.results,a={},o={};if("ENOUSWC_AP"==s)for(var l=0;l<r.length;l++){if(r[l]&&Array.isArray(r[l].attributes)){for(var c=r[l].attributes,d="",u="",m="",p=0;p<c.length;p++)""===d&&"did"===c[p].name&&(d=c[p].value),""===u&&"physicalid"===c[p].name&&(u=c[p].value),""===m&&"ds6w:cadMaster"===c[p].name&&(m=c[p].value);""!==d&&(a[d]={did:d,physicalId:u},e.find(function(e){e==u&&n.results.push({id:d,phid:u,CADOrigin:m})}))}if(r[l]&&Array.isArray(r[l].path))for(var f=r[l].path,h=null,g=0;g<f.length;g++)null===h&&(t.is(o[f[g]],"object")?h=o[f[g]]:(o[f[g]]={},h=o[f[g]]))}else for(l=0;l<r.length;l++){if(r[l]&&Array.isArray(r[l].attributes)){for(c=r[l].attributes,d="",u="",p=0;p<c.length;p++)""===d&&"did"===c[p].name&&(d=c[p].value),""===u&&"physicalid"===c[p].name&&(u=c[p].value);""!==d&&(a[d]={did:d,physicalId:u},n.results.push({id:d,phid:u,CADOrigin:"CATIAV5"}))}if(r[l]&&Array.isArray(r[l].path))for(f=r[l].path,h=null,g=0;g<f.length;g++)null===h?t.is(o[f[g]],"object")?h=o[f[g]]:(o[f[g]]={},h=o[f[g]]):t.is(h[f[g]],"object")?h=h[f[g]]:(h[f[g]]={},h=h[f[g]])}var v=function(e,t){for(var s in e)if(e.hasOwnProperty(s)){var n=[],i={id:s,show:!0,children:n,select:!0};t.push(i),v(e[s],n)}},b=[];v(o,b);for(var C=0;C<b.length;C++)n.structures.push({structure:b[C]});return n},function(e){throw new Error("An error occurred during the expand "+e)})}};return{socket:"",compass:null,setTypesCallbackForOFW:function(e,n){d.start(p+" setTypesCallbackForOFW");var r=o.get("widget"),c=u.getCompassPubSub();if(!1===n.setTypesCallbackSubscribe&&(this.socket="compass_"+r.id,this.compass=new s.Socket(this.socket),this.compass.subscribeServer("com.ds.compass",window.parent),c.subscribe("setTypesCallback",function(e){d.start(p+" setTypesCallbackForOFW setTypesCallback");var t=o.get("widget");if(e.widgetId===t.id){var s=[];s=e.data&&Array.isArray(e.data.items)?e.data.items.reduce(function(e,t){return e.push(t.objectId),e},[]):a.getSelection().physicalIds,Array.isArray(s)&&s.length>0?v.generateFileContent(s,e.appId).then(function(t){var s={appId:e.appId,widgetId:e.widgetId,fileName:"-file",fileContent:JSON.stringify(t)};c.publish("launchApp",s)},function(){i.displayNotification({msg:m.open.error,eventID:"error"})}):c.publish("launchApp",{appId:e.appId,widgetId:e.widgetId}),d.end(p+" setTypesCallbackForOFW setTypesCallback")}})),e.length>0){var f=e.map(function(e){if(r.name===h){var s="",n="",i="";return t.is(e.options,"object")?(s=e.options.physicalId,n=e.options.type,i=e.options.title+" ("+e.options.name+")"):(s=e.physicalId,n=e.type,i=e.title+" ("+e.name+")"),{envId:l.getTenant(),serviceId:"3DSpace",contextId:r.id,objectId:s,objectType:n,displayName:i}}return r.name===g?{envId:l.getTenant(),serviceId:"3DSpace",contextId:r.id,objectId:e.id,objectType:e.type,displayName:e.title+" ("+e.name+")"}:{}});this.compass.dispatchEvent("onSetX3DContent",{protocol:"3DXContent",version:"1.1",source:r.name,widgetId:r.id,data:{items:f}},this.socket),c.publish("setTypes",{widgetId:o.get("widget").id})}else this.compass.dispatchEvent("onResetX3DContent",{},this.socket),c.publish("resetTypes");d.end(p+" setTypesCallbackForOFW")},modal:null,openWith:function(){var e=this,s=o.get("widget"),n="";s.name===h?n="DS/IssueManagement/components/ContextualMenu":s.name===g&&(n="DS/Issue3DReview/components/ContextualMenu"),require(["UWA/Class/Promise","DS/UIKIT/Input/Button","DS/UIKIT/Input/Select","DS/UIKIT/Input/Toggle","DS/ENOFloatingPanel/ENOFloatingPanel",n],function(n,i,r,a,o,l){l.getContextualMenu().then(function(e){for(var t=0;t<e.length;t++)if("Open"===e[t].name)return e[t];return{submenu:[]}}).then(function(n){var l=c.getItem("open"),d={};d=t.is(l,"object")?{type:l.type?l.type:"",app:l.app?l.app:""}:{type:"",app:""};var u=null,p=null,f=null,h=null,g=null,v=null,b=null,C={},E=function(e,s){null!==g&&t.is(e,"object")&&Array.isArray(e.submenu)&&0!==e.submenu.length&&(g.remove(),C={},e.submenu.forEach(function(e){e&&t.is(e.name,"string")&&(g.add({value:e.name,label:e.title,selected:e.name===s}),C[e.name]=e.action.callback,e.name===s&&v.enable())}))};n.submenu.forEach(function(e){"contexts"===e.name&&((u=new a({className:"primary contexts-chooser",name:"typeChooser",value:"contexts",label:"",checked:"contexts"===d.type,events:{onChange:function(){d.type="contexts",c.setItem("open",d),E(e,d.app)}}})).elements.label.setContent([t.createElement("i",{class:"where-to-open-icon where-to-open-contexts wux-ui-3ds wux-ui-3ds-3d-object"}),m.open.labels.contexts]),"contexts"===d.type&&(b=e)),"reportedAgainst"===e.name&&((p=new a({className:"primary reported-against-chooser",name:"typeChooser",value:"reportedAgainst",label:"",checked:"reportedAgainst"===d.type,events:{onChange:function(){d.type="reportedAgainst",c.setItem("open",d),E(e,d.app)}}})).elements.label.setContent([t.createElement("i",{class:"where-to-open-icon where-to-open-reported-against wux-ui-3ds wux-ui-3ds-location"}),m.open.labels.reportedAgainst]),"reportedAgainst"===d.type&&(b=e)),"resolvedBy"===e.name&&((f=new a({className:"primary resolved-by-chooser",name:"typeChooser",value:"resolvedBy",label:"",checked:"resolvedBy"===d.type,events:{onChange:function(){d.type="resolvedBy",c.setItem("open",d),E(e,d.app)}}})).elements.label.setContent([t.createElement("i",{class:"where-to-open-icon where-to-open-contexts-resolved-by fonticon fonticon-docs"}),m.open.labels.resolvedBy]),"resolvedBy"===d.type&&(b=e)),"resolvedItems"===e.name&&((h=new a({className:"primary resolved-items-chooser",name:"typeChooser",value:"resolvedItems",label:"",checked:"resolvedItems"===d.type,events:{onChange:function(){d.type="resolvedItems",c.setItem("open",d),E(e,d.app)}}})).elements.label.setContent([t.createElement("i",{class:"where-to-open-icon where-to-open-contexts-resolved-items fonticon fonticon-docs"}),m.open.labels.resolvedItems]),"resolvedItems"===d.type&&(b=e))});var I=null;n.submenu.length>0?(g=new r({custom:!1,multiple:!1,placeholder:m.open.labels.placeholder,options:[],events:{onChange:function(){var e=this.getValue();e.length>0&&""===e[e.length-1]?v.disable():(d.app=e[e.length-1],c.setItem("open",d),v.enable())}}}),I=t.createElement("div",{html:[u,p,h,f,g]})):I=t.createElement("div",{class:"nothing-to-open",html:t.createElement("span",{class:"nothing-to-open-label",html:m.open.labels.nothing})}),e.modal=new o({animate:!0,autocenter:!0,closable:!0,limitParent:!1,overlay:!0,resizable:!0,visible:!0,className:"open-issues-dialog",title:m.open.dialog.title,header:null,body:I,footer:[v=new i({value:m.open.dialog.open,className:"primary",events:{onClick:function(){var s=g.getValue();s.length>0&&s[s.length-1]&&t.is(C[s[s.length-1]],"function")&&C[s[s.length-1]].call(),e.modal.destroy()}},disabled:!0}),new i({value:m.open.dialog.cancel,events:{onClick:function(){e.modal.destroy()}}})],events:{onClose:function(){this.destroy()}}}).inject(s.body),null!==b&&E(b,d.app)})})}}}),define("DS/IssueComponents/external/3DMarkup",[],function(){"use strict";var e={WIDTH:700,HEIGHT:800},t="Issue";return{execute:function(s){require(["DS/TransientWidget/TransientWidget","DS/IssueServices/Contexts","DS/IssueServices/services/PlatformServices"],function(n,i,r){var a=i.get("widget"),o=[];if(s.forEach(function(e){o.push({envId:r.getTenant(),serviceId:"3DSpace",contextId:a.id,objectId:e,objectType:t,displayName:""})}),o.length>0){var l={protocol:"3DXContent",version:"1.1",source:i.get("widget").name,data:{items:o}},c={mode:"panel",height:e.HEIGHT,width:e.WIDTH};n.showWidget("ENOR3D_AP","",{X3DContentId:JSON.stringify(l),x3dPlatformId:r.getTenant()},c)}})}}}),define("DS/IssueComponents/users/Users",["UWA/Class/Promise","UWA/Core","DS/UIKIT/Popover","DS/UIKIT/Spinner","DS/WAFData/WAFData","DS/IssueServices/Contexts","DS/IssueServices/services/PlatformServices","DS/IssueServices/services/SwymServices","i18n!DS/IssueComponents/assets/nls/IssueComponents","css!DS/IssueComponents/IssueComponents.css"],function(e,t,s,n,i,r,a,o,l){"use strict";var c=function(e){return t.createElement("div",{class:"issue-user-content",html:[{class:"issue-user-image",html:e.image},{class:"issue-user-info",html:e.info}]})},d=function(e){return t.createElement("div",{class:"issue-user-image-sub",html:t.createElement("img",{class:"issue-user-image-sub-img img-circle",src:a.getUserImage(e.user)})})},u=function(e){return t.createElement("div",{class:"issue-user-info-sub",html:[{class:"issue-user-info-sub-id",html:[{class:"issue-user-info-sub-name",html:e.name},{class:"issue-user-info-sub-user",html:"("+e.user+")"}]},{class:"issue-user-info-sub-email",html:e.email},{class:"issue-user-info-sub-address",html:[{class:"issue-user-info-sub-address-city",html:e.city},{class:"issue-user-info-sub-address-city",html:e.country}]},{class:"issue-user-info-sub-more",html:l.users.more,events:{click:function(){a.getUserProfile(e.user)}}}]})};return{create:function(e){for(var s,n=t.createElement("div",{class:"issue-users-list"}),i=0;i<e.users.length;i++)"group"===e.users[i].type?t.createElement("div",{class:"user-group wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-users-group"}).inject(n):(s=e.users[i],t.createElement("div",{class:"issue-user-image",html:a.getUserImageElement(s,!0,{cssClass:"issue-user-image-img",Title:""})})).inject(n);return n},display:function(e){var i=new n,r=t.createElement("div",{class:"issue-user-info-ph",html:i}),a=d({user:e.user}),l=null;(l=new s({className:"issue-user-popover",target:e.target,body:c({image:a,info:r})})).show(),l.updatePosition(),i.show(),o.users.retrieve({user:e.user}).then(function(e){i.destroy(),r.parentNode.replaceChild(u(e),r),l.updatePosition()})},open:function(e){var t=e.user;a.getUserProfile(t)}}}),define("DS/IssueComponents/create/Form",["UWA/Controls/Form"],function(e){"use strict";return e.extend({init:function(e){this.autocompletes=[],this.fields=e.fields,this.events={onInvalid:function(){}},this._parent(e)},unvalidate:function(){return this.getContent().getElements(".has-error").forEach(function(e){e.removeClassName("has-error")}),this},validate:function(e,t){var s=[];return this.unvalidate(),this.fields.forEach(function(e){switch(e.name){case"button":case"submit":break;case"buttonGroup":if("radio"===e.type)if(e.requiredFlag&&!e.disabled)!(e.value.length>1)&&s.push(e);break;case"checkbox":e.requiredFlag&&!1===e.checked&&!e.disabled&&s.push(e);break;case"lineEditor":case"editor":case"email":case"url":case"tel":e.requiredFlag&&""===e.value&&!e.disabled&&s.push(e);break;case"autoComplete":!e.requiredFlag||""!==e.value&&void 0!==e.value||e.disabled||s.push(e);break;default:e.requiredFlag&&""===e.value&&!e.disabled&&s.push(e)}}),this.dispatchEvent(0===s.length?"onValid":"onInvalid"),0===s.length}})}),define("DS/IssueComponents/team/AddMembersView",["UWA/Class/View","i18n!DS/IssueComponents/assets/nls/IssueComponents","UWA/Core"],function(e,t,s){return e.extend({name:"iss-add-member",tagName:"div",className:"iss-add-member",setup:function(){this.template='                                                <div class="'+this.getClassNames("-container")+'">\t\t\t\t\t\t\t\t\t\t\t\t\t<div class="'+this.getClassNames("-body")+'">\t\t\t\t\t\t\t\t\t\t\t\t\t\t<table class="add-member-table table">\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<tr class="'+this.getClassNames("-coowner")+'" >\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<td>'+t.team.addMember.coowner+'</td>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<td class="'+this.getClassNames("-coowner-field-container")+'">\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class="'+this.getClassNames("-coowner-field")+'">\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class="fonticon fonticon-search coowner-field-search">\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</span>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</td>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</tr>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<tr class="'+this.getClassNames("-assignee")+'" >\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<td>'+t.team.addMember.assignee+'</td>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<td class="'+this.getClassNames("-assignee-field-container")+'">\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class="'+this.getClassNames("-assignee-field")+'">\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class="fonticon fonticon-search assignee-field-search">\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</span>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</td>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</tr>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<tr class="'+this.getClassNames("-contributor")+'" >\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<td>'+t.team.addMember.contributor+'</td>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<td class="'+this.getClassNames("-contributor-field-container")+'">\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class="'+this.getClassNames("-contributor-field")+'">\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class="fonticon fonticon-search contributor-field-search">\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</span>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</td>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</tr>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<tr class="'+this.getClassNames("-informeduser")+'" >\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<td>'+t.team.addMember.informedUser+'</td>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<td class="'+this.getClassNames("-informedUser-field-container")+'">\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class="'+this.getClassNames("-informedUser-field")+'">\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class="fonticon fonticon-search informedUser-field-search">\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</span>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</td>\t\t\t\t\t\t\t\t\t\t\t\t\t\t   </tr>\t\t\t\t\t\t\t\t\t\t\t\t\t\t</table>\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t\t\t\t\t\t\t<div class="'+this.getClassNames("-button")+'">\t\t\t\t\t\t\t\t\t\t\t\t\t</div>                                                </div>'},init:function(e){e=s.clone(e||{},!1),this._parent.call(this,e)},render:function(){this.name,this.cid;this.container.empty(),containerReference=this.container;var e=UWA.createElement("div",{class:"iss-member-view",styles:{height:"10%"}});return e.addContent(this.template),e.inject(containerReference),this},domEvents:{"click .assignee-field-search":function(){this.dispatchEvent("searchMember","Assignee")},"click .coowner-field-search":function(){this.dispatchEvent("searchMember","Coowner")},"click .contributor-field-search":function(){this.dispatchEvent("searchMember","Contributor")},"click .informedUser-field-search":function(){this.dispatchEvent("searchMember","InformedUser")}}})}),define("DS/IssueComponents/utils/Utils",["UWA/Class/Promise","UWA/Controls/Input","UWA/Core","DS/Logger/Logger","DS/PADUtils/views/PADAlert","DS/WebappsUtils/WebappsUtils","DS/IssueServices/Contexts","DS/IssueServices/services/PlatformServices","i18n!DS/IssueCommon/assets/nls/IssueCommon"],function(e,t,s,n,i,r,a,o,l){"use strict";var c="Issue",d="Create",u="Assign",m="Active",p="Review",f="Closed",h=["created","modified","estimatedStartDate","estimatedEndDate","actualStartDate","actualEndDate","resolutionDate"];return{getIconByState:function(e,t,s){var n="";if(t!=c&&""!=s)n=o.get3DSpaceUrl()+"/"+s;else switch(e){case d:n=r.getWebappsAssetUrl("IssueCommon","icons/32/states/iconCreateState.png");break;case u:n=r.getWebappsAssetUrl("IssueCommon","icons/32/states/iconAssignState.png");break;case m:n=r.getWebappsAssetUrl("IssueCommon","icons/32/states/iconActiveState.png");break;case p:n=r.getWebappsAssetUrl("IssueCommon","icons/32/states/iconReviewState.png");break;case f:n=r.getWebappsAssetUrl("IssueCommon","icons/32/states/iconClosedState.png")}return n},getColorByState:function(e){var t="";switch(e){case d:t="#9B2C98";break;case u:t="#E03400";break;case m:t="#007DA3";break;case p:t="#018308";break;case f:t="#757575"}return t},getFormattedDate:function(e,t){for(var s=window.widget.lang,n=h,i=0;i<n.length;i++)isNaN(Date.parse(e[n[i]]))?e[n[i]]="":e[n[i]]=new Date(e[n[i]]).toLocaleString(s,t);return e},getTextFromHTML:function(e){var t=s.createElement("div",{html:e});return t.textContent||t.innerText||""},timeSince:function(e){var t=Math.floor((new Date-e)/1e3),s=Math.floor(t/31536e3);return s>1?l.replace(l.dates.years,{number:s}):(s=Math.floor(t/2592e3))>1?l.replace(l.dates.months,{number:s}):(s=Math.floor(t/86400))>1?l.replace(l.dates.days,{number:s}):(s=Math.floor(t/3600))>1?l.replace(l.dates.hours,{number:s}):(s=Math.floor(t/60))>1?l.replace(l.dates.minutes,{number:s}):l.replace(l.dates.seconds,{number:Math.floor(t>=0?t:0)})},getFilesFromDrop:function(e){var t=[];if(e.dataTransfer.items)for(var s=0;s<e.dataTransfer.items.length;s++)"file"===e.dataTransfer.items[s].kind&&t.push(e.dataTransfer.items[s].getAsFile());else for(var n=0;n<e.dataTransfer.files.length;n++)t.push(e.dataTransfer.files[n]);return t},uploadImages:function(s){var n=this;return new e(function(e){var n=new t.File("Input.File",{visibility:"hidden",styles:{display:"none"}});n.elements.container.setStyle("display","none"),n.elements.input.multiple=void 0===s||s,n.elements.input.accept="image/png, image/jpeg",n.elements.input.addEventListener("change",function(t){n.destroy(),n=null,e(t.target.files)},!1),n.elements.input.addEventListener("click",function(e){e.stopPropagation()}),n.elements.input.click()}).then(function(t){if(0===(t=Array.from(t)).length)return e.reject(new Error("No selected files to be uploaded"));var s=[];return t.forEach(function(e){s.push(n.isImage(e))}),e.all(s)}).then(function(t){return 0===(t=t.reduce(function(e,t){return"success"===t.status?e.push(t.file):i.displayNotification({msg:l.replace(l.images.errorUpload,{name:t.file.name}),eventID:"error"}),e},[])).length?e.reject(new Error("No valid files to be uploaded")):e.resolve(t)})},isImage:function(t){var s=new FileReader;return new e(function(e){s.onload=function(s){var n=s.target.result,i=new Uint8Array(n);255===i[0]&&216===i[1]&&255===i[i.byteLength-2]&&217===i[i.byteLength-1]?e({status:"success",file:t}):137===i[0]&&80===i[1]&&78===i[2]&&71===i[3]?e({status:"success",file:t}):71===i[0]&&73===i[1]&&70===i[2]&&56===i[3]?e({status:"error",file:t}):(66===i[0]&&i[1],e({status:"error",file:t}))},s.readAsArrayBuffer(t)})},readImageURI:function(t){var s=new FileReader;return new e(function(e){s.onload=function(t){e(t.target.result)},s.readAsDataURL(t)})},getDroppableData:function(e){for(var t={},n=s.is(e.dataTransfer.types.indexOf,"function")?"indexOf":"contains",i="",r=["text/searchitems","text/plain","Text"],a=0;a<r.length&&""===i;a++){var o=e.dataTransfer.types[n](r[a]);(s.is(o,"number")&&o>=0||s.is(o,"boolean")&&!0===o)&&(i=r[a])}var l={};if(""===i)throw new Error("Unknown type in DnD");l=e.dataTransfer.getData(i);try{t=JSON.parse(l)}catch(e){t={data:{items:[]}}}return t},setDroppableData:function(e){for(var t=a.get("widget")||window.widget,s={protocol:"3DXContent",version:"1.1",source:t.name,widgetId:t.id,data:{items:[]}},n=0;n<e.length;n++){var i=e[n],r=i.options.id.split(","),l=r[r.length-1];s.data.items.push({envId:o.getTenant(),serviceId:"3DSpace",contextId:"",objectId:l,objectType:i.options.type,displayName:i.options.name,displayType:i.options.type})}var c="text/plain";try{(window.navigator.userAgent.indexOf("MSIE ")>0||navigator.userAgent.match(/Trident.*rv\:11\./))&&(c="text")}catch(e){}return 0===s.data.items.length?null:{type:c,data:s}},createGhostDrag:function(e,t){var n=s.createElement("div",{class:"issue-ghost-container",html:[s.createElement("div",{class:"issue-ghost-panel",html:[s.createElement("img",{class:"issue-ghost-image",src:e.icons[e.icons.length-1]}),s.createElement("div",{class:"issue-ghost-title",html:e.title+" ("+e.name+")"})]}),s.createElement("span",{class:"issue-ghost-counter",html:t})]});return n.setStyle("transform","translate3d(0,0,0)"),n},isJson:function(e){try{JSON.parse(e)}catch(e){return!1}return!0},utils:{isInteger:function(e){return Number.isInteger?Number.isInteger(e):"number"==typeof e&&isFinite(e)&&Math.floor(e)===e}}}}),define("DS/IssueComponents/team/MembersMakeDroppable",["DS/DataDragAndDrop/DataDragAndDrop","DS/PADUtils/views/PADAlert","DS/UIKIT/Mask","i18n!DS/IssueComponents/assets/nls/IssueComponents"],function(e,t,s,n){"use strict";var i={makeDroppable:function(s,r){e.droppable(s,{drop:function(e,a,o){if(o.stopPropagation&&o.stopPropagation(),o.preventDefault&&o.preventDefault(),o.dataTransfer&&o.dataTransfer.dropEffect&&(o.dataTransfer.dropEffect="copy"),UWA.is(e)&&""!=e){var l=JSON.parse(e);i.ExecuteDrop(l,r)}else t.displayNotification({msg:n.team.error.dropNotSupported,eventID:"error"});s.style.borderWidth="0px"},over:function(){arguments[0].setStyles({borderStyle:"solid",borderColor:"#368ec4",borderWidth:"1px"})},leave:function(){arguments[0].setStyle("borderWidth","0px")}})},ExecuteDrop:function(e,s){if(e){var i=e.data.items;UWA.is(i)&&UWA.is(i.length)&&i.length>0&&s(i)}else t.displayNotification({msg:n.team.error.dropNotSupported,eventID:"error"})}};return i}),define("DS/IssueComponents/external/CollaborativeLifecycle",[],function(){"use strict";var e={WIDTH:700,HEIGHT:800};return{execute:function(t){require(["DS/TransientWidget/TransientWidget","DS/IssueServices/Contexts","DS/IssueServices/services/PlatformServices"],function(s,n,i){var r=n.get("widget"),a=[];if(t.forEach(function(e){a.push({envId:i.getTenant(),serviceId:"3DSpace",contextId:r.id,objectId:e,objectType:"",displayName:""})}),a.length>0){var o={protocol:"3DXContent",version:"1.1",source:n.get("widget").name,data:{items:a}},l={mode:"panel",height:e.HEIGHT,width:e.WIDTH};s.showWidget("ENOLCMI_AP","",{X3DContentId:JSON.stringify(o),x3dPlatformId:i.getTenant()},l)}})}}}),define("DS/IssueComponents/models/TreeNodeModel",["UWA/Core","DS/Tree/TreeNodeModel"],function(e,t){"use strict";function s(s){s=e.extend({id:"",label:"",icons:[],grid:{},type:""},s),t.call(this,s)}return s.prototype=Object.create(t.prototype),s.prototype.getID=function(){return this.options.id},s}),define("DS/IssueComponents/create/Finalize",["UWA/Class/Promise","UWA/Class/View","UWA/Core","DS/UIKIT/Form","DS/UIKIT/Input/Text","DS/UIKIT/Input/Toggle","DS/Controls/Toggle","DS/Controls/ButtonGroup","DS/Controls/LineEditor","DS/Controls/Editor","DS/ENOFloatingPanel/ENOFloatingPanel","DS/Logger/Logger","DS/IssueServices/Contexts","DS/IssueServices/services/IssueServices","DS/IssueServices/services/PlatformServices","DS/IssueServices/utils/Performance","i18n!DS/IssueComponents/assets/nls/IssueComponents","css!DS/IssueComponents/IssueComponents.css"],function(e,t,s,n,i,r,a,o,l,c,d,u,m,p,f,h,g){"use strict";var v="Analyst";return t.extend({name:"DS/IssueComponents/create/Finalize",tag:"div",className:"create-view-content-subview create-finalize",isInit:null,_deferredInit:{resolve:null,reject:null},setup:function(t){var s=this;s._parent(t),s.parent=t.parent,s.isInit=new e(function(e,t){s._deferredInit.resolve=e,s._deferredInit.reject=t}),s.form=null,s.formElements={enableApproval:null,saveAsTemplate:null,assignContentOwner:null},s.formElementsToggler={enableApproval:null,saveAsTemplate:null,assignContentOwner:null},s.fields={automation:{enableApproval:null,saveAsTemplate:null,assignContentOwner:null},saveAsTemplate:{name:null,description:null}},s._appliedTemplate=null,s._deferredInit.resolve()},destroy:function(){this.form=null,this.formElements={enableApproval:null,saveAsTemplate:null,assignContentOwner:null},this.formElementsToggler={enableApproval:null,saveAsTemplate:null,assignContentOwner:null},this.fields={automation:{enableApproval:null,saveAsTemplate:null,assignContentOwner:null},saveAsTemplate:{name:null,description:null}},this._appliedTemplate=null},render:function(){var e=this;p.preferences.getApprovalEnablement({data:{}}).then(function(t){var n=t.body.ApprovalProcess;e.adminPreference=n,"Always"==n?(e.fields.automation.enableApproval.checkFlag=!0,e.fields.automation.enableApproval.disabled=!0):"Never"==n?(e.fields.automation.enableApproval.checkFlag=!1,e.fields.automation.enableApproval.disabled=!0):e._appliedTemplate?Array.isArray(e._appliedTemplate.data.automationTasks)&&(e._appliedTemplate.data.automationTasks.indexOf("enableApproval")>-1?(e.fields.automation.enableApproval.checkFlag=!0,e.fields.automation.enableApproval.disabled=!1):(e.fields.automation.enableApproval.checkFlag=!1,e.fields.automation.enableApproval.disabled=!1)):p.preferences.get({data:{name:"approvalPreference"}}).then(function(t){if(!e._appliedTemplate){var s=t.body;e.fields.automation.enableApproval.checkFlag=s,e.fields.automation.enableApproval.disabled=!1}}).catch(function(e){e&&s.is(e.error,"object")&&s.is(e.error.message,"string")&&PADAlert.displayNotification({msg:e.error.message,eventID:"error"})})}),e.form=new n({className:"create-finalize-form",fields:[],events:{onInvalid:function(){}}}).inject(e.container);var t=s.createElement("div",{class:"create-form-content",html:[e._renderContentField(),e._renderApprovalField(),e._renderTemplateField(),e._renderTemplateForm()]});return p.preferences.get({data:{name:"assignPreference"}}).then(function(t){if(!e._appliedTemplate){var s=t.body;e.fields.automation.assignContentOwner.checkFlag=s,localStorage.setItem("assignPreferenceTemplate",s)}}),t.inject(e.form.elements.container),e},_renderContentField:function(){var e=this,t=new o({type:"checkbox"}),n=e.fields.automation.assignContentOwner=new a({type:"checkbox",label:g.create.finalize.assignContentOwner,value:0});return n.addEventListener("buttonclick",function(t){t.dsModel.checkFlag?(localStorage.setItem("assignPreferenceTemplate",!0),p.preferences.set({data:{name:"assignPreference",value:!0}}).catch(function(t){e._logger.error("Could not save the preferences: %o",t)})):(localStorage.setItem("assignPreferenceTemplate",!1),p.preferences.set({data:{name:"assignPreference",value:!1}}).catch(function(t){e._logger.error("Could not save the preferences: %o",t)}))}),t.addChild(n),e.formElements.assignContentOwner=s.createElement("div",{class:"create-form-element",html:[{tag:"div",class:"create-form-visibility-mask"},{tag:"div",class:"create-form-visibility-toggle",html:[e.formElementsToggler.assignContentOwner=s.createElement("span",{class:"fonticon fonticon-eye"})]},{tag:"div",class:"create-form-field create-form-settings",html:[t]}]})},_renderApprovalField:function(){var e=this,t=new o({type:"checkbox"}),n=e.fields.automation.enableApproval=new a({type:"checkbox",label:g.create.finalize.enableApproval,value:1});return n.addEventListener("buttonclick",function(t){t.dsModel.checkFlag?p.preferences.set({data:{name:"approvalPreference",value:!0}}).catch(function(t){e._logger.error("Could not save the preferences: %o",t)}):p.preferences.set({data:{name:"approvalPreference",value:!1}}).catch(function(t){e._logger.error("Could not save the preferences: %o",t)})}),t.addChild(n),e.formElements.enableApproval=s.createElement("div",{class:"create-form-element",html:[{tag:"div",class:"create-form-visibility-mask"},{tag:"div",class:"create-form-visibility-toggle",html:[e.formElementsToggler.enableApproval=s.createElement("span",{class:"fonticon fonticon-eye"})]},{tag:"div",class:"create-form-field create-form-settings",html:[t]}]})},_renderTemplateField:function(){var e=new o({type:"checkbox"}),t=!1,n=!1;this.parent.isTemplate&&(t=!0,n=!0);var i=this.fields.automation.saveAsTemplate=new a({type:"checkbox",label:g.create.finalize.saveAsTemplateToggle,value:2,checkFlag:t,disabled:n});return i.addEventListener("change",function(e){e.dsModel.checkFlag?document.querySelector(".create-expander-body-template").style.display="block":document.querySelector(".create-expander-body-template").style.display="none"}),e.addChild(i),this.formElements.saveAsTemplate=s.createElement("div",{class:"create-form-element",html:[{tag:"div",class:"create-form-visibility-mask"},{tag:"div",class:"create-form-visibility-toggle",html:[this.formElementsToggler.saveAsTemplate=s.createElement("span",{class:"fonticon fonticon-eye"})]},{tag:"div",class:"create-form-field create-form-settings",html:[e]}]})},_renderTemplateForm:function(){var e=this;e.templateContainer=new s.Element("div",{class:"create-expander-body-template"}),e.templateContainer.style.display="none",e.parent.isTemplate&&(e.templateContainer.style.display="block");var t="required-form-field-title-label"+(e.isTemplate?"":" highlight"),n="required-form-field-required-label"+(e.isTemplate?"":" highlight");s.createElement("h5",{class:"required-form-field",html:[s.createElement("span",{class:t,html:g.create.templateName}),s.createElement("div",{class:n+" wux-ui-3ds-required wux-ui-3ds"})]}).inject(e.templateContainer);var i=e.fields.saveAsTemplate.name=new l({requiredFlag:!0});i.getContent().setStyle("width","100%"),e.fields.saveAsTemplate.name.addEventListener("keyup",function(){var t=e.fields.saveAsTemplate.name.valueToCommit;e._onTemplateNameChange(t)}),i.inject(e.templateContainer),s.createElement("h5",{class:"create-form-field-label",html:g.create.templateDesc}).inject(e.templateContainer);var r=e.fields.saveAsTemplate.description=new c({nbRows:4,newLineMode:"enter"});return r.getContent().setStyle("width","100%"),r.inject(e.templateContainer),e.templateContainer},validate:function(){return!0!==this.fields.automation.saveAsTemplate.checkFlag||""!==this.fields.saveAsTemplate.name.value},getTasks:function(){var e=this,t=[];return Object.keys(e.fields.automation).forEach(function(s){e.fields.automation[s].checkFlag&&!0===e.fields.automation[s].checkFlag&&t.push(s)}),t},getApprovalValue:function(){return this.fields.automation.enableApproval.checkFlag},getContentValue:function(){return this.fields.automation.assignContentOwner.checkFlag},getTemplateValue:function(){return this.fields.automation.saveAsTemplate.checkFlag},getValues:function(){var e={};return!0===this.getApprovalValue()&&(e.waitingOn=v),!0===this.getContentValue()&&(e.assignContentOwner=!0),!0===this.getTemplateValue()&&(e.saveAsTemplate=!0),e},getHiddenAttributes:function(){var e={};for(var t in this.formElements)s.is(this.formElementsToggler[t])&&(e[t]=this.formElementsToggler[t].hasClassName("fonticon-eye-off"));return e},getTemplateValues:function(){var e={name:this.fields.saveAsTemplate.name.value,description:this.fields.saveAsTemplate.description.value};return this.parent.options.editMode&&this._appliedTemplate&&this._appliedTemplate.lastUsed?e.lastUsed=this._appliedTemplate.lastUsed:e.lastUsed=null,e},applyTemplate:function(t){var n=this;return new e(function(e){if(n._appliedTemplate=t,Array.isArray(t.data.automationTasks)&&Object.keys(n.fields.automation).forEach(function(e){"saveAsTemplate"===e||-1===t.data.automationTasks.indexOf(e)?("saveAsTemplate"===e&&n.parent.isTemplate?n.fields.automation[e].checkFlag=!0:"assignContentOwner"===e?null!=t.applyIssue&&t.applyIssue||(n.fields.automation[e].checkFlag=!1,localStorage.setItem("assignPreferenceTemplate",!1)):"enableApproval"===e&&"UserChoice"==n.adminPreference&&(n.fields.automation[e].checkFlag=!1,n.fields.automation[e].disabled=!1),"assignContentOwner"===e&&localStorage.setItem("assignPreferenceTemplate",!1)):"saveAsTemplate"===e?n.fields.automation[e].checkFlag=!0:"assignContentOwner"===e?(n.fields.automation[e].checkFlag=!0,localStorage.setItem("assignPreferenceTemplate",!0)):"enableApproval"===e&&"UserChoice"==n.adminPreference&&(n.fields.automation[e].checkFlag=!0,n.fields.automation[e].disabled=!1)}),s.is(t.info,"object")&&(!0===s.is(t.info.name,"string")&&(n.fields.saveAsTemplate.name.value=t.info.name,n._onTemplateNameChange(t.info.name)),!0===s.is(t.info.description,"string")&&(n.fields.saveAsTemplate.description.value=t.info.description)),s.is(t.hidden,"object")&&s.is(n.formElements,"object")&&s.is(n.formElementsToggler,"object")){var i=n.formElements,r=n.formElementsToggler;for(var a in i)!0===t.hidden[a]&&(n.parent.isTemplate?(s.is(i[a])&&i[a].toggleClassName("visibility-masked",!0),s.is(r[a])&&(r[a].toggleClassName("fonticon-eye-off",!0),r[a].toggleClassName("fonticon-eye",!1))):s.is(i[a])&&(i[a].hide(),"saveAsTemplate"===a&&n.templateContainer.hide()))}e()})},_onTemplateNameChange:function(e){"fields"in this&&"saveAsTemplate"in this.fields&&"name"in this.fields.saveAsTemplate&&this.parent&&this.parent.isTemplate&&this.parent.updateTitle(e)}})}),define("DS/IssueComponents/external/Compare",[],function(){"use strict";var e={WIDTH:700,HEIGHT:800};return{execute:function(t){require(["DS/TransientWidget/TransientWidget","DS/IssueServices/Contexts","DS/IssueServices/services/PlatformServices"],function(s,n,i){var r=[];n.get("widget");if(t.forEach(function(e){r.push({envId:i.getTenant(),serviceId:"3DSpace",contextId:i.getSecurityContext(),objectId:e.physicalId,objectType:e.type,displayName:""})}),r.length>0){var a={protocol:"3DXContent",version:"1.1",source:n.get("widget").name,data:{items:r}},o={mode:"panel",height:e.HEIGHT,width:e.WIDTH};s.showWidget("ENOCOMP_AP","",{X3DContentId:JSON.stringify(a),x3dPlatformId:i.getTenant()},o)}})}}}),define("DS/IssueComponents/create/Attachments",["UWA/Class/View","UWA/Class/Promise","UWA/Core","DS/ENOFloatingPanel/ENOFloatingPanel","DS/Logger/Logger","DS/PADUtils/views/PADAlert","DS/PlatformAPI/PlatformAPI","DS/UIKIT/Form","DS/UIKIT/Iconbar","DS/Controls/TooltipModel","DS/UIKIT/Mask","DS/IssueAttachmentManager/components/Collection","DS/IssueAttachmentManager/components/Item","DS/IssueAttachmentManager/services/AttachmentServices","DS/IssueAttachmentManager/views/Catalog","i18n!DS/IssueAttachmentManager/assets/nls/IssueAttachmentManager","DS/IssueCommon/commands/CommandsManager","DS/IssueCommon/utils/Utils","DS/IssueServices/services/IssueServices","DS/IssueServices/services/PlatformServices","DS/IssueServices/Contexts","DS/IssueServices/utils/Performance","DS/2DAnnotation/2DAnnotation","i18n!DS/IssueComponents/assets/nls/IssueComponents","css!DS/IssueComponents/IssueComponents.css"],function(e,t,s,n,i,r,a,o,l,c,d,u,m,p,f,h,g,v,b,C,E,I,y,S){"use strict";var w="ENX3DIR_AP",T=/[/\\?%*:|"<>]/g;return e.extend({name:"DS/IssueComponents/create/Attachments",tag:"div",className:"create-view-content-subview create-attachments",isInit:null,_deferredInit:{resolve:null,reject:null},setup:function(e){var s=this;s._parent(e),s.parent=e.parent,s.annotateCommand=e.annotateCommand||{enable:!1,addTextbox:!1,getText:function(){return""}},s.searchAttachmentCommand=e.searchAttachmentCommand||{getSearchQuery:function(){return t.resolve("")}},s.isInit=new t(function(e,t){s._deferredInit.resolve=e,s._deferredInit.reject=t}),s._logger=i.getLogger(s.name),s.form=null,s.formElements={attachments:null},s.formElementsToggler={attachments:null},s.fields={attachments:{container:null,iconBar:null,title:null}},s.collection=new u({id:Date.now().toString()}),s._deferredInit.resolve()},destroy:function(){this.form=null,this.formElements={attachments:null},this.formElementsToggler={attachments:null},this.fields={attachments:{container:null,iconBar:null,title:null}},this.collection=null,this.catalog=null},render:function(){return this._renderAttachmentsField(),this.form=new o({className:"create-attachments-form",fields:[],events:{onInvalid:function(){}}}).inject(this.container),s.createElement("div",{class:"create-form-content",html:[this.formElements.attachments=s.createElement("div",{class:"create-form-element create-attachments-form-element-attachments",html:[{tag:"div",class:"create-form-visibility-mask"},{tag:"div",class:"create-form-visibility-toggle",html:[this.formElementsToggler.attachments=s.createElement("span",{class:"fonticon fonticon-eye"})]},{tag:"div",class:"create-form-field form-group",html:[this.fields.attachments.title,this.fields.attachments.container]},{tag:"div",class:"create-form-help-tooltip",html:[this.fields.attachments.help]}]})]}).inject(this.form.elements.container),this},_renderAttachmentsField:function(){var e=this;e.fields.attachments.help=s.createElement("div",{html:[s.createElement("span",{class:"fonticon fonticon-help"})]}),e.fields.attachments.help.tooltipInfos=new c({shortHelp:S.create.attachments.labels.attachmentsshortHelper,longHelp:S.create.attachments.labels.attachmentslongHelper}),e.fields.attachments.title=s.createElement("div",{class:"create-form-title-with-iconbar",html:[{tag:"h5",html:S.create.attachments.labels.attachments}]}),e.fields.attachments.iconBar=new l({renderTo:e.fields.attachments.title,items:[{id:"annotate",fonticon:"highlighter",text:S.create.attachments.annotate,selectable:!0,handler:function(){e._annotate()}},{id:"screenshot",fonticon:"camera",text:S.create.attachments.screenshotAvailable,selectable:!0,handler:function(){e._screenshot()}},{id:"attachFromLocalDisk",fonticon:"upload",text:S.create.attachments.attach.fromLocalDisk,selectable:!1,handler:function(){e._onRequestAttachFromLocalDisk()}},{id:"attachFrom3DX",text:S.create.attachments.attach.from3DX,fonticon:"plus",selectable:!1,handler:function(){e.searchAttachmentCommand.getSearchQuery().then(function(t){e._onRequestAttachFrom3DX(t)})}},{className:"divider"},{id:"setAsPrimary",fonticon:"star",text:h.views.Header.Iconbar.actions.setAsPrimary,selectable:!0,handler:function(){var t=e.collection.getSelectedItems()[0];if(e.collection.filter(function(e){return!0===e.get("isPrimary")}).some(function(e){return e.get("id")===t.get("id")}))t.set("isPrimary",!1);else for(var s=0;s<e.collection.size();s++){var n=e.collection.at(s);n.id!==t.id?n.set("isPrimary",!1):n.set("isPrimary",!0)}}},{id:"remove",fonticon:"remove",text:S.create.attachments.remove,selectable:!1,handler:function(){var t=e.collection.getSelectedItems();e.collection.unselectAll(),e.collection.remove(t)}},{className:"divider"},{id:"switchCatalogLayout",type:"checkbox",fonticon:"view-list",text:h.views.Header.Iconbar.actions.switchCatalogLayout,selectable:!0,handler:function(){e.catalog.switchLayout(e.catalog.layout%2+1)}}]}),e.fields.attachments.iconBar.disableItem("remove"),e.fields.attachments.iconBar.disableItem("setAsPrimary"),e.annotateCommand.enable||e.fields.attachments.iconBar.getItem("annotate").elements.container.hide(),e.fields.attachments.container=s.createElement("div",{class:"create-form-attachments-container",tabindex:"-1"}),e.catalog=new f({collection:e.collection,layout:1,searchAttachmentCommand:{getSearchQuery:e.searchAttachmentCommand.getSearchQuery}}).render().inject(e.fields.attachments.container),e.listenTo(e.catalog,"onSwitchLayout",e._onCatalogSwitchLayout.bind(e)),e.listenTo(e.catalog,"request:attachFrom3DX",e._onRequestAttachFrom3DX.bind(e)),e.listenTo(e.catalog,"request:attachFromLocalDisk",e._onRequestAttachFromLocalDisk.bind(e)),e.listenTo(e.collection,"onSelect",e._onCollectionSelect.bind(this)),e.listenTo(e.collection,"onUnselect",e._onCollectionSelect.bind(this)),e._addDropEvent(e.catalog.container)},reset:function(){var e=this;return new t(function(t){e.collection.reset(),e.fields.attachments.iconBar.disableItem("remove"),e.fields.attachments.iconBar.disableItem("setAsPrimary"),t()})},getValues:function(e){var t={attachments:[],primaryAttachment:null};return e&&(t.attachments=this.collection.filter(function(e){return!e.get("isFile")}).map(function(e){return e.get("isPrimary")&&(t.primaryAttachment=e.id),e.get("id")})),t},getHiddenAttributes:function(){var e={};for(var t in this.formElements)s.is(this.formElementsToggler[t])&&(e[t]=this.formElementsToggler[t].hasClassName("fonticon-eye-off"));return e},applyTemplate:function(e){var n=this;return n.reset().then(function(){if(s.is(e.hidden,"object")&&s.is(n.formElements,"object")&&s.is(n.formElementsToggler,"object")){var i=n.formElements,a=n.formElementsToggler;for(var o in i)!0===e.hidden[o]&&(n.parent.isTemplate?(s.is(i[o])&&i[o].toggleClassName("visibility-masked",!0),s.is(a[o])&&(a[o].toggleClassName("fonticon-eye-off",!0),a[o].toggleClassName("fonticon-eye",!1))):s.is(i[o])&&i[o].hide())}return s.is(e.data,"object")&&e.data.hasOwnProperty("attachments")&&e.data.attachments.length>0?p.getDocuments(e.data.attachments).then(function(i){if(s.is(i.attachments,"array")){if(i.attachments.length!==e.data.attachments.length&&(r.displayNotification({msg:S.create.templateApplyWarningAttachments,eventID:"warning"}),0===i.attachments.length))return t.resolve();var a=i.attachments.map(function(e){return e.id});return p.fetch(a).then(function(t){if(s.is(t.results,"array")&&t.results.length===a.length){var i=t.results.map(function(e){return p.parseFromFetch(e)});if(e.data.primaryAttachment)for(var r=0;r<i.length;r++)e.data.primaryAttachment===i[r].id&&(i[r].isPrimary=!0);return n._addObjects(i)}return b.fetcher.recent(a).then(function(t){if(s.is(t.results,"array")){if(t.results.length!==a.length){var i=[];t.results.filter(function(e,t){null!=e.attributes.find(e=>e.value==a)&&i.push(p.parseFromFetch(e))})}else i=t.results.map(function(e){return p.parseFromFetch(e)});if(e.data.primaryAttachment)for(var r=0;r<i.length;r++)e.data.primaryAttachment===i[r].id&&(i[r].isPrimary=!0);return n._addObjects(i)}throw new Error("Unexpected number of fetch results for attachments.")})})}return t.resolve()}).catch(function(e){e&&e.error&&e.error.includes("Invalid Business Object Specified")&&r.displayNotification({msg:S.create.templateApplyWarningAttachments,eventID:"warning"}),t.reject(e)}):t.resolve()})},_addFiles:function(e){for(var t=this,s=[],n=0;n<e.length;n++){var i=e[n],r="temporary_"+Math.floor(Date.now())+"_"+n,o=i.type,l={id:r,title:i.name,type:"Document",dispType:h.views.Attachment.types.Document,owner:{firstName:a.getUser().firstName,fullName:a.getUser().firstName.trim()+" "+a.getUser().lastName.trim(),lastName:a.getUser().lastName,user:a.getUser().login},relOwner:{firstName:a.getUser().firstName,fullName:a.getUser().firstName.trim()+" "+a.getUser().lastName.trim(),lastName:a.getUser().lastName,user:a.getUser().login},relOriginated:(new Date).toString()};i.hasOwnProperty("lastModifiedDate")?i.lastModifiedDate instanceof Date?(l.modified=i.lastModifiedDate.toString(),l.created=i.lastModifiedDate.toString()):(l.modified=new Date(i.lastModifiedDate).toString(),l.created=new Date(i.lastModifiedDate).toString()):(l.modified=(new Date).toString(),l.created=(new Date).toString());var c=new m(l);c.setDocumentTypeByMIME(o),c.set("isFile",!0),c.set("file",i),s.push(c)}return t.collection.add(s),s.forEach(function(e){"image"===e.get("documentType")&&(v.readImageURI(e.get("file")).then(function(t){e.set("thumbnailUrl",t),e.set("contentUrl",t)}),1===t.collection.size()&&e.set("isPrimary",!0))}),s},_addObjects:function(e){var n=this,i=e.filter(function(e){return void 0===n.collection.get(e.id)});if(i.length!==e.length&&r.displayNotification({msg:h.replace(h.notifications.Attach.alreadyAttached,{count:e.length-i.length}),eventID:"warning"}),i.length>0){for(var o=[],l=0;l<i.length;l++){var c=i[l];c.relOwner={firstName:a.getUser().firstName,fullName:a.getUser().firstName.trim()+" "+a.getUser().lastName.trim(),lastName:a.getUser().lastName,user:a.getUser().login};var d=new m(c);o.push(d)}n.collection.add(o);for(var u=[],f=[],g=0;g<o.length;g++){var v=o[g];u.push(v.id),"Document"===v.get("type")&&f.push(v.id)}var C=[t.resolve()];u.length>0&&C.push(p.fetch(u).then(function(e){s.is(e.results,"array")?n.downloadAdditionalData(e.results):C.push(b.fetcher.recent(u).then(function(e){var t;s.is(e.results,"array")?(t=e.results.length!==u.length?e.results.filter(function(e){e.attributes.find(e=>e.value==u)}):e.results,n.downloadAdditionalData(t)):r.displayNotification({msg:S.replace(h.notifications.Fetch.failure),eventID:"error"})}).catch(function(e){r.displayNotification({msg:S.replace(h.notifications.Fetch.failure),eventID:"error"}),n._logger.error(e)}))}).catch(function(e){r.displayNotification({msg:S.replace(h.notifications.Fetch.failure),eventID:"error"}),n._logger.error(e)})),f.length>0&&C.push(p.downloadDocuments(f).then(function(e){for(var t=0;t<e.length;t++){var s=e[t].id,i=n.collection.get(s);i&&e[t].downloadUrl&&void 0===e[t].errorMessage&&i.set("contentUrl",e[t].downloadUrl)}}).catch(function(e){r.displayNotification({msg:S.replace(h.notifications.Download.failure),eventID:"error"}),n._logger.error(e)}))}},downloadAdditionalData:function(e){for(var t=0;t<e.length;t++){var s=e[t].attributes.find(function(e){return"resourceid"===e.name}).value,n=this.collection.get(s);if(n){n.set("isProcessing",!0);var i=e[t].attributes.find(function(e){return"owner"===e.name}),r=e[t].attributes.find(function(e){return"ds6w:responsible"===e.name});i&&i.value&&r&&r.value&&n.set("owner",{user:i.value,fullName:r.value,firstName:"",lastName:""});var a=e[t].attributes.find(function(e){return"ds6w:docextension"===e.name});a&&a.value&&n.setDocumentType(a.value),1===this.collection.size()&&"image"===n.get("documentType")&&n.set("isPrimary",!0),n.set("isProcessing",!1)}}},_screenshot:function(){var e=this,t=E.get("widget").name===w;if(s.is(e.parent)&&s.is(e.parent.elements)&&s.is(e.parent.elements.dialog)&&e.parent.elements.dialog.hide(),t){E.get("component").utils.takeAnnotation(function(t){var s=t.blob;s.lastModifiedDate=new Date;var n=(new Date).toLocaleString();n=n.replace(T,"-"),s.name="screenshot_"+n+".png",e._addFiles([s]),e.parent.elements.dialog.show()},function(){e.parent.elements.dialog.show()},function(t){e._logger.error(t)})}else{var n=E.get("component"),i=n.taskManager.addTakeScreenshotTask(function(t){for(var r=t.data,a=t.fileName,o=t.fileType,l=t.lastModified,c=atob(r.split(",")[1]),d=new ArrayBuffer(c.length),u=new Uint8Array(d),m=0;m<c.length;m++)u[m]=c.charCodeAt(m);var p=new File([d],a,{type:o,lastModified:l});e._addFiles([p]),s.is(e.parent)&&s.is(e.parent.elements)&&s.is(e.parent.elements.dialog)&&e.parent.elements.dialog.show(),n.unmaskForTask(i)},function(){s.is(e.parent)&&s.is(e.parent.elements)&&s.is(e.parent.elements.dialog)&&e.parent.elements.dialog.show(),n.unmaskForTask(i)});n.maskForTask(i,S.tasks.addAttachments)}},_onCollectionSelect:function(){var e=this.collection.getSelectedItems();e.length>0?(this.fields.attachments.iconBar.enableItem("remove"),1===e.length&&"image"===e[0].get("documentType")?(this.fields.attachments.iconBar.enableItem("setAsPrimary"),this.fields.attachments.iconBar.enableItem("annotate")):(this.fields.attachments.iconBar.disableItem("setAsPrimary"),this.fields.attachments.iconBar.disableItem("annotate"))):(this.fields.attachments.iconBar.disableItem("remove"),this.fields.attachments.iconBar.disableItem("setAsPrimary"),this.fields.attachments.iconBar.enableItem("annotate"))},_onCatalogSwitchLayout:function(){this.fields.attachments.iconBar.getItem("switchCatalogLayout").elements.icon.toggleClassName("fonticon-view-small-thb",(this.catalog.layout+1)%2==1),this.fields.attachments.iconBar.getItem("switchCatalogLayout").elements.icon.toggleClassName("fonticon-view-list",this.catalog.layout%2==1)},_onDrop:function(e){var t=this;e.preventDefault(),e.stopPropagation();var n=p.parseFromDragEvent(e);if(n.hasOwnProperty("files")&&n.files instanceof FileList)t._addFiles(n.files);else if(v.isValid3DXContent(n)){var i=n.data.items.map(function(e){return e.objectId});p.fetch(i).then(function(e){if(!s.is(e.results,"array"))throw new Error("Unexpected empty fetch results.");var n=e.results.map(function(e){return p.parseFromFetch(e)});t._addObjects(n)}).catch(function(e){r.displayNotification({msg:S.replace(h.notifications.Attach.failure,{count:i.length}),eventID:"error"}),t._logger.error(e)})}else r.displayNotification({msg:S.notifications.Drop.unsupported,eventID:"error"})},_onRequestAttachFrom3DX:function(e){var t=this,n=E.get("application");if(s.is(n,"object")&&n.isStandalone){var i=E.get("component"),r=i.taskManager.addObjectsTask(function(e){if(Array.isArray(e.physicalIds)){var n=e.physicalIds;p.fetch(n).then(function(e){if(s.is(e.results,"array")&&e.results.length===n.length){var i=e.results.map(function(e){return p.parseFromFetch(e)});return t._addObjects(i)}throw new Error("Unexpected number of fetch results for attachments.")}).finally(function(){s.is(t.parent)&&s.is(t.parent.elements)&&s.is(t.parent.elements.dialog)&&t.parent.elements.dialog.show(),i.unmaskForTask(r)})}else t.parent.elements.dialog.show(),i.unmaskForTask(r)},function(){t.parent.elements.dialog.show(),i.unmaskForTask(r)});i.maskForTask(r,S.tasks.addAttachments)}else C.search({title:h.Attach.SearchTitle,default_search_criteria:s.is(e,"string")?e:"",multiSel:!0,callback:function(e){var s=e.map(function(e){return p.parseFromSearch(e)});t._addObjects(s)},cancel:function(){}})},_onRequestAttachFromLocalDisk:function(){var e=this;p.browseFileFromLocalDisk(e.container).then(e._addFiles.bind(e)).catch(function(t){r.displayNotification({msg:h.replace(h.notifications.BrowseFile.failure),eventID:"error"}),e._logger.error(t)})},_addDropEvent:function(e){var t=this,s=0;e.addEventListener("drop",function(){e.removeClassName("dragenter"),t._onDrop.apply(t,arguments)}),e.addEventListener("dragenter",function(){e.addClassName("dragenter"),s++}),e.addEventListener("dragleave",function(){--s<=0&&e.removeClassName("dragenter")}),e.addEventListener("mouseleave",function(){--s<=0&&e.removeClassName("dragenter")}),document.addEventListener("dragover",function(e){e.preventDefault()})},_annotate:function(){var e=this,t=E.get("widget");v.Mask.mask(t.body);var s=e.collection.getSelectedItems()[0],n={className:"approve-annotation",saveCallback:e._annotationSaveCallback.bind(e),exitCallback:function(){e.annotation.destroy(),e.annotation=null}};if(s&&s.get("contentUrl"))n.imageURL=s.get("contentUrl");else{var i=t.body.getDimensions();n.defaultDimensions={width:i.width-50,height:i.height-50}}var a=new y(n);a.render(),a.isLoaded.then(function(){a.container.inject(t.body),e.annotation=a;var s=e.annotateCommand.getText();if(e.annotateCommand.addTextbox&&s){var n={text:s,centered:!0},i=new Event("onAddNewObject");i.data={tool:"createText",options:n,select:!0},e.annotation.dispatchEvent("onAddNewObject",i)}}).catch(function(t){e.annotation&&(e.annotation.destroy(),e.annotation=null),r.displayNotification({msg:S.replace(h.notifications.Annotation.initFailure),eventID:"error"}),e._logger.error(t)}).finally(function(){v.Mask.unmask(t.body)})},_annotationSaveCallback:function(e){var t=(new Date).toLocaleString();t=t.replace(T,"-");var s=h.replace(h.annotate.defaultName,{date:t}),n=new File([e.blob],s,{type:"image/png",lastModified:Date.now()}),i=this.collection.getSelectedItems(),r=null;if(1===i.length){var a=i[0];r=a.get("isPrimary"),this.collection.remove(a)}var o=this._addFiles([n]);o&&o[0]&&(this.collection.select(o[0].id),r&&o[0].set("isPrimary",!0)),this.annotation.destroy(),this.annotation=null}})}),define("DS/IssueComponents/create/Custom",["UWA/Class/Promise","UWA/Class/View","UWA/Core","DS/UIKIT/Form","DS/UIKIT/Input/Date","DS/UIKIT/Input/Text","DS/UIKIT/Input/Select","DS/UIKIT/Input/Number","DS/UIKIT/Input/Toggle","DS/IssueServices/services/IssueServices","i18n!DS/IssueComponents/assets/nls/IssueComponents","css!DS/IssueComponents/IssueComponents.css"],function(e,t,s,n,i,r,a,o,l,c,d){"use strict";return t.extend({})}),define("DS/IssueComponents/duplicate/Duplicate",["UWA/Class/Promise","UWA/Class/View","UWA/Core","DS/UIKIT/Input/Button","DS/UIKIT/Input/Text","DS/UIKIT/Tooltip","DS/UIKIT/Input/Toggle","DS/UIKIT/Mask","DS/UIKIT/Scroller","DS/Controls/SpinBox","DS/ENOFloatingPanel/ENOFloatingPanel","DS/Logger/Logger","DS/PADUtils/views/PADAlert","DS/PlatformAPI/PlatformAPI","DS/IssueServices/Contexts","DS/IssueServices/services/PlatformServices","DS/IssueServices/services/IssueServices","DS/IssueServices/utils/Performance","DS/IssueCommon/utils/Utils","i18n!DS/IssueComponents/assets/nls/IssueComponents","text!DS/IssueCommon/assets/Settings.json","css!DS/IssueComponents/IssueComponents.css"],function(e,t,s,n,i,r,a,o,l,c,d,u,m,p,f,h,g,v,b,C,E){"use strict";return t.extend({name:"DS/IssueComponents/duplicate/Duplicate",tag:"div",className:"duplicate-view",_logger:null,defaultOptions:{physicalIds:[]},physicalIds:[],issues:{},duplicateIssues:[],modal:null,confirm:null,validate:null,isLoaded:null,_deferred:{resolve:null,reject:null},setup:function(t){var s=this;s._parent(t),s._logger=u.getLogger("DS/IssueComponents/components"),s._logger.log("Initializing the duplicate component"),s.settings=JSON.parse(E),s.issues={},s.modal=null,s.validate=null,s.confirm=null,s.isLoaded=null,s._deferred={resolve:null,reject:null},s.isLoaded=new e(function(e,t){s._deferred.resolve=e,s._deferred.reject=t})},render:function(){var e=this;return v.start(e.name+" render"),e.dialog().then(function(){e._deferred.resolve()},function(){e._deferred.reject()}),v.end(e.name+" render"),e},destroy:function(){v.start(this.name+" destroy"),this.physicalIds=[],this.issues={},this.duplicateIssues=[],this.confirm.destroy(),this.confirm=null,this.modal.destroy(),this.modal=null,this.validate=null,this.isLoaded=null,this._deferred={resolve:null,reject:null},v.end(this.name+" destroy")},dialog:function(){var e=this,t=f.get("widget")||window.widget;return o.mask(e.container),e.modal=new d({animate:!0,autocenter:!0,closable:!0,limitParent:!1,overlay:!0,resizable:!0,visible:!0,className:"duplicate-issues-dialog",title:C.duplicate.preparing,header:null,body:e.container,footer:[e.validate=new n({value:C.duplicate.duplicate,className:"primary",events:{onClick:function(){e._duplicate()}},disabled:!0}),new n({value:C.duplicate.cancel,events:{onClick:function(){e.destroy()}}})],events:{onClose:function(){e.destroy()}}}).inject(t.body),e.build().then(function(t){new l({element:t}).inject(e.container),e.elements.optionsButton=new a({type:"switch",className:"options-button",checked:!1,label:C.duplicate.advancedOptions,events:{onChange:function(){e.displayOptions()}}}).inject(e.container),e.elements.Options=s.createElement("div",{class:"options-view"}).inject(e.container),e.elements.keepRelated=new a({type:"checkbox",className:"keep-related toggle-primary",checked:!0,label:C.duplicate.keepRelated}).inject(e.elements.Options),e.elements.keepAttachments=new a({type:"checkbox",className:"keep-attachments toggle-primary",checked:!1,label:C.duplicate.keepAttachments}).inject(e.elements.Options),e.settings.enableCopies&&(e.elements.copyCount=s.createElement("div",{class:"copy-count",html:[{tag:"span",class:"title-copy-count",html:C.duplicate.copyCount},e.count=new c({minValue:1,maxValue:e.settings.maxNumberOfCopies,stepValue:1,pageStepValue:1})]}).inject(e.elements.Options)),e.elements.titleOptions=s.createElement("div",{class:"title-options-view",html:[{tag:"span",class:"title-modifier",html:C.duplicate.titleModifier}]}).inject(e.elements.Options),new l({element:e.elements.Options}).inject(e.container),s.createElement("div",{class:"advanced-options-item",html:[{tag:"span",class:"advanced-options-label",html:C.duplicate.replace},e.replaceHelp=s.createElement("span",{class:"fonticon fonticon-help"}),e.replace=new i({className:"advanced-options-text",placeholder:C.duplicate.replacePlaceholder})]}).inject(e.elements.titleOptions),s.createElement("div",{class:"advanced-options-item",html:[{tag:"span",class:"advanced-options-label",html:C.duplicate.suffix},e.suffixHelp=s.createElement("span",{class:"fonticon fonticon-help"}),e.suffix=new i({className:"advanced-options-text",placeholder:C.duplicate.suffixPlaceholder})]}).inject(e.elements.titleOptions),s.createElement("div",{class:"advanced-options-item",html:[{tag:"span",class:"advanced-options-label",html:C.duplicate.prefix},e.prefixHelp=s.createElement("span",{class:"fonticon fonticon-help"}),e.prefix=new i({className:"advanced-options-text",placeholder:C.duplicate.prefixPlaceholder})]}).inject(e.elements.titleOptions),e.settings.enableCopies&&(s.createElement("div",{class:"advanced-options-item",html:[{tag:"span",class:"advanced-options-label",html:C.duplicate.iterator},e.iteratorHelp=s.createElement("span",{class:"fonticon fonticon-help"}),e.iterator=new i({className:"advanced-options-text",placeholder:C.duplicate.iteratorPlaceholder})]}).inject(e.elements.titleOptions),e.suffixTooltip=new r({target:e.iteratorHelp,body:C.duplicate.iteratorHelp})),e.replaceTooltip=new r({target:e.replaceHelp,body:C.duplicate.replaceHelp}),e.suffixTooltip=new r({target:e.suffixHelp,body:C.duplicate.suffixHelp}),e.suffixTooltip=new r({target:e.prefixHelp,body:C.duplicate.prefixHelp}),e.elements.Options.hide(),e.validate.enable(),e.physicalIds.length>1?e.modal.setTitle(C.replace(C.duplicate.titleMultiple,{number:e.physicalIds.length})):e.modal.setTitle(C.replace(C.duplicate.titleSingle,{number:e.physicalIds.length})),e.buildConfirmationDialog(),e.confirm.hide(),e.validate.focus(),o.unmask(e.container)})},build:function(){var e=this;return v.start(e.name+" build"),g.preferences.getApprovalEnablement({data:{}}).then(function(t){e.adminPreference=t.body.ApprovalProcess}),e._check(e.getOption("physicalIds")).then(function(t){for(var n=[],i=0;i<e.physicalIds.length;i++){var r=t[e.physicalIds[i]],a=r.title+" ("+r.name+")";n.push(s.createElement("li",{html:[{tag:"span",class:"fonticon fonticon-issue "},s.String.escapeHTML(a)],title:a}))}return v.end(e.name+" build"),s.createElement("div",{html:[{tag:"div",class:"duplicate-issues-label",html:[{tag:"span",class:"duplicate-issues-label",html:C.duplicate.content}]},{tag:"div",class:"duplicate-issues-content",html:s.createElement("ul",{html:n,class:"duplicate-issues-content-list"})}]})})},displayOptions:function(){var e=null,t=null;this.elements.optionsButton.isChecked()?(this.elements.Options.show(),e=this.elements.Options.getSize(),(t=this.modal.elements.container.getSize()).height=t.height+e.height,this.modal.setNewSize(t)):(e=this.elements.Options.getSize(),(t=this.modal.elements.container.getSize()).height=t.height-e.height,this.modal.setNewSize(t),this.elements.Options.hide())},_check:function(e){var t=this;return v.start(t.name+" _check"),g.issues.retrieve({data:{objects:e.reduce(function(e,t){return e.push({physicalId:t}),e},[])}}).then(function(s){for(var n={},i=0;i<s.results.length;i++){var r=s.results[i].body;n[r.physicalId]={physicalId:r.physicalId,name:r.name,state:r.state,title:r.title?r.title:""}}return t.physicalIds=e,t.issues=n,n},function(e){if(t._logger.error(e),e.error.message.includes("'business object' does not exist")){var s=b.getErrorMessage("0");b.displayErrorMessage(s,"error"),t.modal.destroy()}else m.displayNotification({msg:C.duplicate.error,eventID:"error"})}).finally(function(){v.end(t.name+" _check")})},_duplicate:function(){var e=this;v.start(e.name+" _duplicate"),e.duplicateIssues=[];for(var t=!0,s=!1,n=1,i=e.elements.optionsButton.isChecked(),r=e.physicalIds.length,a="",o="",l=0;l<r;l++){var c=e.physicalIds[l],d=e.issues[c].title,u=void 0!==d&&""!==d?d:e.issues[c].name;if(i){t=e.elements.keepRelated.isChecked(),s=e.elements.keepAttachments.isChecked(),n=e.count?e.count.value:1;var m="",p="",f=e.replace.getValue();null!==f&&f.length>1&&(m=f.split(":")[0],p=f.split(":")[1]);var h=e.suffix.getValue(),g=e.prefix.getValue();if(a=e.iterator?e.iterator.getValue():"",m.length>0&&p.length>0&&(u=e.replaceTitle(u,m,p)),a.length>0){o=e.findIterator(d,a);var b=e.nextIterator(o);null!==b&&b.length>0&&(u=e.replaceIterator(u,o,b)),o=b}g.length>0&&(u=g+u),h&&(u+=h)}e.duplicateIssues.push({issue:e.issues[c],newTitle:u,keepRelated:t,keepAttachments:s});for(var C=1;C<n;C++){if(a.length>0){var E=e.nextIterator(o);u=e.replaceIterator(u,o,E),o=E}e.duplicateIssues.push({issue:e.issues[c],newTitle:u,keepRelated:t,keepAttachments:s})}}i?e.confirmDuplication():e.duplicate(e.duplicateIssues).then(function(){e.destroy()})},duplicate:function(e){var t=this,n=t.count?t.count.value:1;v.start(t.name+" duplicate"),t.validate.setDisabled(),t.confirmButton.setDisabled();var i,r=f.get("widget")||window.widget;return o.mask(r.body),i="Always"==t.adminPreference?"Analyst":"Never"==t.adminPreference?"Unassigned":"",g.issues.duplicate({data:{objects:e.map(function(e){return{physicalId:e.issue.physicalId,title:e.newTitle,related:e.keepRelated,attachments:e.keepAttachments,actualStartDate:"",actionTaken:"",resolutionStatement:"",adminPreference:i}})}}).then(function(e){var s="";s=n>1?C.replace(C.duplicate.multipleCopiesSuccess,{number:t.physicalIds.length,multiplication:n}):1===t.physicalIds.length?C.replace(C.duplicate.singleSuccess,{title:t.issues[t.physicalIds[t.physicalIds.length-1]].title+" ("+t.issues[t.physicalIds[t.physicalIds.length-1]].name+")"}):C.replace(C.duplicate.multipleSuccess,{number:t.physicalIds.length}),o.unmask(r.body),m.displayNotification({msg:s,eventID:"success"});var i=e.results.reduce(function(e,t){return e.push([t.body.physicalId]),e},[]),a=e.results.reduce(function(e,t){return e[t.body.physicalId]=t.body,e},{});v.end(t.name+" _duplicate"),p.publish("DS/Object/create",{metadata:{appId:r.id,appName:r.name,timestamp:Math.floor(Date.now())},data:{paths:i,attributes:a},version:"1.0"})},function(e){if(o.unmask(r.body),s.is(e.error.internal)&&e.error.internal.includes("ErrorCode:2003")){var n=b.getErrorMessage("2");b.displayErrorMessage(n,"error")}else m.displayNotification({msg:C.duplicate.error,eventID:"error"});t._logger.error("Cannot duplicate the selected issue(s) because %o",e),v.end(t.name+" _duplicate")})},replaceTitle:function(e,t,s){if(0===t.length||0===s.length)return e;var n=t,i=(n=n.replace(/[-[\]{}()*+?\\^$]/g,"\\$&")).concat("|",t),r=null;try{r=new RegExp(i,"i")}catch(e){r=new RegExp(n,"i")}return e.replace(r,s)},findIterator:function(e,t){var s=null;try{s=new RegExp(t,"i")}catch(e){t=t.replace(/[-[\]{}()*+?\\^$]/g,"\\$&"),s=new RegExp(t,"i")}var n=s.exec(e),i=null;return null!==n&&(i=n[n.length-1]),i},nextIterator:function(e){var t=null;if(null!==e){var s=new RegExp("[0-9]+").exec(e);if(null!==s){var n="";s.forEach(function(e){n+=e});var i=parseInt(n),r=i+1;t=e.replace(i.toString(),r.toString())}}return t},replaceIterator:function(e,t,s){var n=e;if(null!==s&&s.length>0){var i=e.lastIndexOf(t);if(-1!==i)n=e.substring(0,i)+s+e.substring(i+t.length)}return n},buildConfirmationDialog:function(){var e=this,t=f.get("widget")||window.widget;e.confirmMsgCont=new l,e.confirm=new d({animate:!0,autocenter:!0,closable:!0,limitParent:!1,overlay:!0,resizable:!0,visible:!1,className:"duplicate-confirm-dialog",title:C.replace(C.duplicate.confirmTitle,{number:e.physicalIds.length}),header:null,body:e.confirmMsgCont,footer:[e.confirmButton=new n({value:C.duplicate.confirm,className:"primary",events:{onClick:function(){e.duplicate(e.duplicateIssues).then(function(){e.destroy()})}},disabled:!1}),new n({value:C.duplicate.cancel,events:{onClick:function(){e.modal.show(),e.confirm.hide()}}})],events:{onClose:function(){e.modal.show(),e.confirm.hide()}}}).inject(t.body)},confirmDuplication:function(){var e=this;e.modal.hide(),e.confirmMsgCont.getInnerElement().empty();var t={};Object.keys(e.issues).forEach(function(s){t[s]={title:e.issues[s].title,newTitles:[]}}),e.duplicateIssues.forEach(function(e){t[e.issue.physicalId].newTitles.push(e.newTitle)});var n=s.createElement("div",{}),i="";Object.keys(t).forEach(function(e,n){i+=C.replace(C.duplicate.confirmMsg,{title:s.String.escapeHTML(t[e].title)}),t[e].newTitles.forEach(function(e){i=i+"<br> - "+s.String.escapeHTML(e)}),n<Object.keys(t).length-1&&(i+="<hr>")}),s.createElement("span",{html:i}).inject(n),e.confirm.show(),n.inject(e.confirmMsgCont.getInnerElement()),e.confirm.onResize()}})}),define("DS/IssueComponents/delete/Delete",["UWA/Class/Promise","UWA/Class/View","UWA/Core","DS/UIKIT/Input/Button","DS/UIKIT/Mask","DS/UIKIT/Scroller","DS/ENOFloatingPanel/ENOFloatingPanel","DS/Logger/Logger","DS/PADUtils/views/PADAlert","DS/PlatformAPI/PlatformAPI","DS/IssueServices/Contexts","DS/IssueServices/services/PlatformServices","DS/IssueServices/services/IssueServices","DS/IssueServices/utils/Performance","DS/IssueCommon/utils/Utils","i18n!DS/IssueComponents/assets/nls/IssueComponents","css!DS/IssueComponents/IssueComponents.css"],function(e,t,s,n,i,r,a,o,l,c,d,u,m,p,f,h){"use strict";var g="Create";return t.extend({name:"DS/IssueComponents/delete/Delete",tag:"div",className:"delete-view",_logger:null,defaultOptions:{physicalIds:[]},physicalIds:[],issues:{},titles:[],names:[],indelible:[],modal:null,validate:null,isLoaded:null,_deferred:{resolve:null,reject:null},setup:function(t){var s=this;s._parent(t),s._logger=o.getLogger("DS/IssueComponents/components"),s._logger.log("Initializing the delete component"),s.issues={},s.titles=[],s.names=[],s.indelible=[],s.validate=null,s.modal=null,s.isLoaded=null,s._deferred={resolve:null,reject:null},s.isLoaded=new e(function(e,t){s._deferred.resolve=e,s._deferred.reject=t})},render:function(){var e=this;return p.start(e.name+" render"),e.dialog().then(function(){e._deferred.resolve()},function(){e._deferred.reject()}),p.end(e.name+" render"),e},destroy:function(){p.start(this.name+" destroy"),this.physicalIds=[],this.issues={},this.titles=[],this.names=[],this.indelible=[],this.validate=null,this.modal.destroy(),this.modal=null,this.isLoaded=null,this._deferred={resolve:null,reject:null},p.end(this.name+" destroy")},dialog:function(){var e=this,t=d.get("widget")||window.widget;return i.mask(e.container),e.modal=new a({animate:!0,autocenter:!0,closable:!0,limitParent:!1,overlay:!0,resizable:!0,visible:!0,className:"delete-issues-dialog",title:h.delete.preparing,header:null,body:e.container,footer:[e.validate=new n({value:h.delete.delete,className:"primary",events:{onClick:function(){e._delete().then(function(){e.destroy()})}},disabled:!0}),new n({value:h.delete.cancel,events:{onClick:function(){e.destroy()}}})],events:{onClose:function(){e.destroy()}}}).inject(t.body),e.build().then(function(t){t.inject(e.container),e.physicalIds.length>0?(e.validate.enable(),e.modal.setTitle(h.replace(h.delete.title,{number:e.physicalIds.length})),0===e.indelible.length&&(e.container.getElement(".no-delete-issues-label").addClassName("hidden"),e.container.getElement(".no-delete-issues-content").addClassName("hidden"))):(e.validate.disable(),e.modal.setTitle(h.delete.nothing),e.container.getElement(".delete-issues-label").addClassName("hidden"),e.container.getElement(".delete-issues-content").addClassName("hidden")),e.validate.focus(),i.unmask(e.container),new r({element:e.container}).inject(e.modal.getBody())})},build:function(){var e=this;return p.start(e.name+" build"),e._check(e.getOption("physicalIds")).then(function(t){for(var n=t.deletable,i=t.indelible,r={physicalIds:[],titles:[],icons:[]},a=0;a<n.length;a++)r.physicalIds.push(n[a].physicalId),r.titles.push(n[a].title+" ("+n[a].name+")"),r.icons.push({tag:"span",class:"fonticon fonticon-issue "+n[a].state.toLowerCase()});var o=[];r.titles.forEach(function(e,t){o.push(s.createElement("li",{html:[r.icons[t],s.String.escapeHTML(e)],title:e}))});for(var l={physicalIds:[],titles:[],icons:[]},c=0;c<i.length;c++)l.physicalIds.push(i[c].physicalId),l.titles.push(i[c].title+" ("+i[c].name+")"),l.icons.push({tag:"span",class:"fonticon fonticon-issue "});var d=[];return l.titles.forEach(function(e,t){d.push(s.createElement("li",{html:[l.icons[t],s.String.escapeHTML(e)],title:e}))}),e.physicalIds=r.physicalIds,e.titles=r.titles,e.indelible=l.physicalIds,p.end(e.name+" build"),s.createElement("div",{html:[{tag:"div",class:"delete-issues-label",html:[{tag:"span",class:"delete-issues-label-first",html:h.delete.warning},{tag:"span",class:"delete-issues-label-second",html:h.delete.deletable}]},{tag:"div",class:"delete-issues-content",html:s.createElement("ul",{html:o,class:"delete-issues-content-list"})},{tag:"div",class:"no-delete-issues-label",html:h.delete.indelible},{tag:"div",class:"no-delete-issues-content",html:s.createElement("ul",{html:d,class:"no-delete-issues-content-list"})}]})})},_check:function(e){var t=this;return p.start(t.name+" _check"),m.issues.retrieve({data:{objects:e.map(function(e){return{physicalId:e}})}}).then(function(e){for(var s={deletable:[],indelible:[]},n=0;n<e.results.length;n++){var i=e.results[n].body;!0===t.utils.isDeletable(i)?s.deletable.push({physicalId:i.physicalId,name:i.name,state:i.state,title:i.title?i.title:""}):s.indelible.push({physicalId:i.physicalId,name:i.name,state:i.state,title:i.title?i.title:""})}return t.issues=s,p.end(t.name+" _check"),s},function(e){if(t._logger.error(e),e.error.message.includes("'business object' does not exist")){var s=f.getErrorMessage("0");f.displayErrorMessage(s,"error"),t.destroy()}else l.displayNotification({msg:h.delete.error,eventID:"error"});p.end(t.name+" _check")})},_delete:function(){var e=this;p.start(e.name+" _delete");var t=d.get("widget")||window.widget;return i.mask(t.body),m.issues.delete({data:{objects:e.physicalIds.map(function(e){return{physicalId:e}})}}).then(function(){var s="";s=1===e.physicalIds.length?h.replace(h.delete.singleSuccess,{title:e.titles[e.titles.length-1]}):h.replace(h.delete.multipleSuccess,{number:e.physicalIds.length}),i.unmask(t.body),l.displayNotification({msg:s,eventID:"success"});var n=e.physicalIds.reduce(function(e,t){return e.push([t]),e},[]),r=e.physicalIds.reduce(function(t,s,n){return t[s]=e.issues.deletable[n],t},{});p.end(e.name+" _delete"),c.publish("DS/Object/delete",{metadata:{appId:t.id,appName:t.name,timestamp:Math.floor(Date.now())},data:{paths:n,attributes:r},version:"1.0"})},function(s){if(i.unmask(t.body),s.report[0].error.includes(h.delete.deletePrivilege)){var n=h.delete.deletePrivilege;l.displayNotification({msg:n,eventID:"error"})}else if(s.report[0].error.includes("1500028")){var r=f.getErrorMessage("1500028");f.displayErrorMessage(r,"error")}else l.displayNotification({msg:h.delete.error,eventID:"error"});p.end(e.name+" _delete"),e._logger.error("Cannot delete the selected issue(s) because %o",s)})},utils:{isDeletable:function(e){return e.state===g}}})}),define("DS/IssueComponents/reopen/Reopen",["UWA/Class/Promise","UWA/Class/View","UWA/Core","DS/UIKIT/Input/Button","DS/UIKIT/Input/Text","DS/UIKIT/Mask","DS/UIKIT/Scroller","DS/ENOFloatingPanel/ENOFloatingPanel","DS/Logger/Logger","DS/PADUtils/views/PADAlert","DS/PlatformAPI/PlatformAPI","DS/IssueServices/Contexts","DS/IssueServices/services/PlatformServices","DS/IssueServices/services/IssueServices","DS/IssueServices/utils/Performance","DS/IssueCommon/utils/Utils","i18n!DS/IssueComponents/assets/nls/IssueComponents","css!DS/IssueComponents/IssueComponents.css"],function(e,t,s,n,i,r,a,o,l,c,d,u,m,p,f,h,g){"use strict";var v="Closed";return t.extend({name:"DS/IssueComponents/reopen/Reopen",tag:"div",className:"isu-reopen-view",_logger:null,defaultOptions:{physicalIds:[]},physicalIds:[],issues:{},titles:[],names:[],indelible:[],modal:null,validate:null,isLoaded:null,_deferred:{resolve:null,reject:null},setup:function(t){var s=this;s._parent(t),s._logger=l.getLogger("DS/IssueComponents/components"),s._logger.log("Initializing the reopen component"),s.issues={},s.titles=[],s.names=[],s.indelible=[],s.fields={},s.validate=null,s.modal=null,s.isLoaded=null,s._deferred={resolve:null,reject:null},s.isLoaded=new e(function(e,t){s._deferred.resolve=e,s._deferred.reject=t})},render:function(){return f.start(this.name+" render"),this.dialog().then(this._deferred.resolve,this._deferred.reject),f.end(this.name+" render"),this},destroy:function(){f.start(this.name+" destroy"),this.physicalIds=[],this.issues={},this.titles=[],this.names=[],this.indelible=[],this.fields={},this.validate=null,this.modal.destroy(),this.modal=null,this.isLoaded=null,this._deferred={resolve:null,reject:null},f.end(this.name+" destroy")},dialog:function(){var e=this,t=u.get("widget");return r.mask(e.container),e.modal=new o({animate:!0,autocenter:!0,closable:!0,limitParent:!1,overlay:!0,resizable:!0,visible:!0,className:"isu-reopen-dialog",title:g.reopen.preparing,header:null,body:e.container,footer:[e.validate=new n({value:g.reopen.reopen,className:"primary",events:{onClick:function(){e.reopen().then(function(){e.destroy()})}},disabled:!0}),new n({value:g.reopen.cancel,events:{onClick:function(){e.destroy()}}})],events:{onClose:function(){e.destroy()}}}).inject(t.body),e.build().then(function(t){t.inject(e.container),e.physicalIds.length>0?(e.validate.enable(),e.modal.setTitle(g.replace(g.reopen.title,{number:e.physicalIds.length})),0===e.indelible.length&&(e.container.getElement(".isu-reopen-no-issues-label").addClassName("hidden"),e.container.getElement(".isu-reopen-no-issues-content").addClassName("hidden"))):(e.validate.disable(),e.modal.setTitle(g.reopen.nothing),e.container.getElement(".isu-reopen-label").addClassName("hidden"),e.container.getElement(".isu-reopen-content").addClassName("hidden")),e.validate.focus(),r.unmask(e.container),new a({element:e.container}).inject(e.modal.getBody())})},build:function(){var e=this;return f.start(e.name+" build"),e._check(e.getOption("physicalIds")).then(function(t){var n="";s.is(t,"object")&&s.is(t.closable,"array")&&1===t.closable.length&&(n=t.closable[0].resolutionRecommendation);for(var r=s.createElement("div",{class:"isu-reopen-form",html:[{tag:"h5",class:"",html:g.create.properties.labels.resolutionRecommendation},e.fields.resolutionRecommendation=new i({name:"isu-reopen-resolution-recommendation ",id:"isu-reopen-resolution-recommendation",className:"isu-reopen-resolution-recommendation",value:n,multiline:!0,required:!1,placeholder:g.create.properties.labels.resolutionRecommendationPlaceholder})]}),a=t.closable,o=t.indelible,l={physicalIds:[],titles:[],icons:[]},c=0;c<a.length;c++)l.physicalIds.push(a[c].physicalId),l.titles.push(a[c].title+" ("+a[c].name+")"),l.icons.push({tag:"span",class:"fonticon fonticon-issue "+a[c].state.toLowerCase()});var d=[];l.titles.forEach(function(e,t){d.push(s.createElement("li",{html:[l.icons[t],s.String.escapeHTML(e)],title:e}))});for(var u={physicalIds:[],titles:[],icons:[]},m=0;m<o.length;m++)u.physicalIds.push(o[m].physicalId),u.titles.push(o[m].title+" ("+o[m].name+")"),u.icons.push({tag:"span",class:"fonticon fonticon-issue "+o[m].state.toLowerCase()});var p=[];u.titles.forEach(function(e,t){p.push(s.createElement("li",{html:[u.icons[t],s.String.escapeHTML(e)],title:e}))}),e.physicalIds=l.physicalIds,e.titles=l.titles,e.indelible=u.physicalIds,f.end(e.name+" build");var h=s.createElement("div",{class:"isu-reopen-list",html:[{tag:"div",class:"isu-reopen-label",html:[{tag:"span",class:"isu-reopen-label-first",html:g.reopen.warning},{tag:"span",class:"isu-reopen-label-second",html:g.reopen.closable}]},{tag:"div",class:"isu-reopen-content",html:s.createElement("ul",{html:d,class:"isu-reopen-content-list"})},{tag:"div",class:"isu-reopen-no-issues-label",html:g.reopen.indelible},{tag:"div",class:"isu-reopen-no-issues-content",html:s.createElement("ul",{html:p,class:"isu-reopen-no-issues-content-list"})}]}),v=s.createElement("div",{html:[]});return e.physicalIds.length>0&&r.inject(v),h.inject(v),v})},_check:function(e){var t=this;return f.start(t.name+" _check"),p.issues.retrieve({data:{objects:e.map(function(e){return{physicalId:e}})}}).then(function(e){for(var s={closable:[],indelible:[]},n=0;n<e.results.length;n++){var i=e.results[n].body;!0===t.utils.isReopenable(i)?s.closable.push({physicalId:i.physicalId,name:i.name,state:i.state,title:i.title?i.title:"",resolutionRecommendation:i.resolutionRecommendation}):s.indelible.push({physicalId:i.physicalId,name:i.name,state:i.state,title:i.title?i.title:"",resolutionRecommendation:i.resolutionRecommendation})}return t.issues=s,f.end(t.name+" _check"),s},function(e){t._logger.error(e),c.displayNotification({msg:g.reopen.error,eventID:"error"}),f.end(t.name+" _check")})},reopen:function(){var e=this;f.start(e.name+" reopen");var t=u.get("widget");r.mask(t.body);var s=e.fields.resolutionRecommendation.getValue().trim();return p.issues.reopen({data:{objects:e.physicalIds.map(function(e){var t={physicalId:e};return""!==s&&(t.resolutionRecommendation=s),t})}}).then(function(){var s="";s=1===e.physicalIds.length?g.replace(g.reopen.singleSuccess,{title:e.titles[e.titles.length-1]}):g.replace(g.reopen.multipleSuccess,{number:e.physicalIds.length}),r.unmask(t.body),c.displayNotification({msg:s,eventID:"success"});var n=e.physicalIds.reduce(function(e,t){return e.push([t]),e},[]),i=e.physicalIds.reduce(function(t,s,n){return t[s]=e.issues.closable[n],t[s].state="Create",t[s].type="Issue",t[s].modifiedAttributes=["state"],t},{});f.end(e.name+" reopen"),d.publish("DS/Object/update",{metadata:{appId:t.id,appName:t.name,timestamp:Math.floor(Date.now())},data:{paths:n,attributes:i},version:"1.0"})},function(s){if(r.unmask(t.body),s.error&&s.error.internal&&s.error.internal.includes("You do not have the permissions to perform this action")){var n=h.getErrorMessage("1005");h.displayErrorMessage(n,"error")}else c.displayNotification({msg:s.error.message,eventID:"error"});f.end(e.name+" reopen"),e._logger.error("Cannot reopen the selected issue(s) because %o",s)})},utils:{isReopenable:function(e){return e.state===v}}})}),define("DS/IssueComponents/team/MembersMenu",["UWA/Core","DS/IssueServices/services/PlatformServices","DS/IssueCommon/commands/CommandsManager","i18n!DS/IssueComponents/assets/nls/IssueComponents"],function(e,t,s,n){"use strict";var i={showRMBMenuOnGrid:function(e,s){return new Promise(function(n,r){var a={},o=s.cellInfos.nodeModel.getTreeDocument().getSelectedNodes(),l=o[0].options.grid.roles;a.currentObjType=o[0].options.grid.type;var c=0,d=[];require(["DS/IssueComponents/team/MembersDataGridLayout"],function(r){l.indexOf("Co-owner")>=0?(a.Coowner="DISCONNECT",c++):a.Coowner="CONNECT",l.indexOf("Contributor")>=0?(a.Contributor="DISCONNECT",c++):a.Contributor="CONNECT",l.indexOf("Assignee")>=0?(a.Assignee="DISCONNECT",c++):a.Assignee="CONNECT",l.indexOf("InformedUser")>=0?(a.InformedUser="DISCONNECT",c++):a.InformedUser="CONNECT";var u=l.indexOf("Owner")>=0,m="Owner"===s.cellInfos.nodeModel.getParent().options.grid.role;if(1==o.length){if(1==r.issues.length){if(u||1!=c||(a.showConfirmation=!0),"group"!==s.cellInfos.nodeModel.options.grid.type){var p=t.getUserName(),f=r.issues[0].coOwners.filter(function(e){return e.user===p});(p===r.issues[0].owner.user||f.length>0)&&(u||d.push(i.getCoownerMenu(e,s,a)))}d.push(i.getAssigneeMenu(e,s,a)),"group"!==s.cellInfos.nodeModel.options.grid.type&&d.push(i.getContributorMenu(e,s,a)),d.push(i.getInformedUserMenu(e,s,a)),d.push({type:"SeparatorItem"})}m&&d.push(i.getChangeOwnerMenu(e,s,a)),""!==t.get3DSwymUrl()&&"group"!==s.cellInfos.nodeModel.options.grid.type&&d.push(i.getViewProfileMenu(e,s,a))}if(r.issues.length>1){var h=s.cellInfos.nodeModel.options.grid.common,g=s.cellInfos.nodeModel.options.grid.isRoot;u="Owner"===s.cellInfos.nodeModel.getParent().options.grid.role;if(1!=o.length||g||u||h){if(o.length>1){var v=o.every(function(e){return"Owner"===e.getParent().options.grid.role}),b=o.every(function(e){return void 0===e.options.grid.common||e.options.grid.common});v||b||d.push(i.getPropagateMenu(e,o,a))}}else d.push(i.getPropagateMenu(e,o,a))}u=l.indexOf("Owner")>=0;(1==o.length&&(!u||l.length>1)||o.length>1)&&d.push(i.getRemoveMenu(e,s,a)),n(d)})})},getCoownerMenu:function(e,t,s){var i={type:"CheckItem",title:n.team.menu.coowner,tooltip:n.create.team.labels.coOwnersHelper,action:{callback:function(){require(["DS/IssueComponents/team/MembersDataGridLayout"],function(e){console.log("Coowner : "+s.Coowner),s.role="Coowner",e.updatePersonRole(t.cellInfos,s)})}}};return"DISCONNECT"==s.Coowner&&(i.state="selected"),i},getContributorMenu:function(e,t,s){var i={type:"CheckItem",title:n.team.menu.contributor,tooltip:n.create.team.labels.contributorHelper,action:{callback:function(){require(["DS/IssueComponents/team/MembersDataGridLayout"],function(e){console.log("Contributor : "+s.Contributor),s.role="Contributor",e.updatePersonRole(t.cellInfos,s)})}}};return"DISCONNECT"==s.Contributor&&(i.state="selected"),i},getAssigneeMenu:function(e,t,s){var i={type:"CheckItem",title:n.team.menu.assignee,tooltip:n.create.team.labels.assigneesHelper,action:{callback:function(){require(["DS/IssueComponents/team/MembersDataGridLayout"],function(e){console.log("Assignee : "+s.Assignee),s.role="Assignee",e.updatePersonRole(t.cellInfos,s)})}}};return"DISCONNECT"==s.Assignee&&(i.state="selected"),i},getInformedUserMenu:function(e,t,s){var i={type:"CheckItem",title:n.team.menu.informedUser,tooltip:n.create.team.labels.informedUserHelper,action:{callback:function(){require(["DS/IssueComponents/team/MembersDataGridLayout"],function(e){console.log("Informed User : "+s.InformedUser),s.role="InformedUser",e.updatePersonRole(t.cellInfos,s)})}}};return"DISCONNECT"==s.InformedUser&&(i.state="selected"),i},getRemoveMenu:function(e,t,s){return{type:"PushItem",title:n.team.menu.remove,fonticon:{family:1,content:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-remove"},action:{callback:function(){require(["DS/IssueComponents/team/MembersDataGridLayout"],function(e){console.log("remove "),s.role=[],s.role.push("Contributor"),s.role.push("Coowner"),s.role.push("Assignee"),s.role.push("InformedUser"),s.Coowner="DISCONNECT",s.Assignee="DISCONNECT",s.Contributor="DISCONNECT",s.InformedUser="DISCONNECT",s.showConfirmation=!0,s.remove=!0,e.updatePersonRole(t.cellInfos,s)})}}}},getViewProfileMenu:function(e,s,i){return{type:"PushItem",title:n.team.menu.profile,fonticon:{family:1,content:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-eye"},action:{callback:function(){t.getUserProfile(s.cellInfos.nodeModel.options.grid.user)}}}},getPropagateMenu:function(e,t,s){return{type:"PushItem",title:n.team.menu.propagate,fonticon:{family:1,content:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-propagate"},action:{callback:function(){require(["DS/IssueComponents/team/MembersDataGridLayout"],function(e){e.propagateMember(t)})}}}},getChangeOwnerMenu:function(e,t,i){return{type:"PushItem",title:n.team.menu.changeOwner,fonticon:{family:1,content:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-user-change"},action:{callback:function(){s.getCommand("ChangeOwner").begin()}}}}};return i}),define("DS/IssueComponents/close/Close",["UWA/Class/Promise","UWA/Class/View","UWA/Core","DS/UIKIT/Input/Button","DS/UIKIT/Input/Text","DS/UIKIT/Mask","DS/UIKIT/Scroller","DS/ENOFloatingPanel/ENOFloatingPanel","DS/Logger/Logger","DS/PADUtils/views/PADAlert","DS/PlatformAPI/PlatformAPI","DS/IssueServices/Contexts","DS/IssueServices/services/PlatformServices","DS/IssueServices/services/IssueServices","DS/IssueServices/utils/Performance","DS/IssueCommon/utils/Utils","i18n!DS/IssueComponents/assets/nls/IssueComponents","css!DS/IssueComponents/IssueComponents.css"],function(e,t,s,n,i,r,a,o,l,c,d,u,m,p,f,h,g){"use strict";var v="Closed";return t.extend({name:"DS/IssueComponents/close/Close",tag:"div",className:"isu-close-view",_logger:null,defaultOptions:{physicalIds:[]},physicalIds:[],issues:{},titles:[],names:[],indelible:[],modal:null,validate:null,isLoaded:null,_deferred:{resolve:null,reject:null},setup:function(t){var s=this;s._parent(t),s._logger=l.getLogger("DS/IssueComponents/components"),s._logger.log("Initializing the close component"),s.issues={},s.titles=[],s.names=[],s.indelible=[],s.fields={},s.validate=null,s.modal=null,s.isLoaded=null,s._deferred={resolve:null,reject:null},s.isLoaded=new e(function(e,t){s._deferred.resolve=e,s._deferred.reject=t})},render:function(){return f.start(this.name+" render"),this.dialog().then(this._deferred.resolve,this._deferred.reject),f.end(this.name+" render"),this},destroy:function(){f.start(this.name+" destroy"),this.physicalIds=[],this.issues={},this.titles=[],this.names=[],this.indelible=[],this.fields={},this.validate=null,this.modal.destroy(),this.modal=null,this.isLoaded=null,this._deferred={resolve:null,reject:null},f.end(this.name+" destroy")},dialog:function(){var e=this,t=u.get("widget")||window.widget;return r.mask(e.container),e.modal=new o({animate:!0,autocenter:!0,closable:!0,limitParent:!1,overlay:!0,resizable:!0,visible:!0,className:"isu-close-dialog",title:g.close.preparing,header:null,body:e.container,footer:[e.validate=new n({value:g.close.close,className:"primary",events:{onClick:function(){e.close().then(function(){e.destroy()})}},disabled:!0}),new n({value:g.close.cancel,events:{onClick:function(){e.destroy()}}})],events:{onClose:function(){e.destroy()}}}).inject(t.body),e.build().then(function(t){if(t.inject(e.container),e.physicalIds.length>0){e.validate.enable();var s="";s=e.physicalIds.length>1?g.replace(g.close.titleMultiple,{number:e.physicalIds.length}):g.replace(g.close.titleSingle,{number:e.physicalIds.length}),e.modal.setTitle(s),0===e.indelible.length&&(e.container.getElement(".isu-close-no-issues-label").addClassName("hidden"),e.container.getElement(".isu-close-no-issues-content").addClassName("hidden"))}else e.validate.disable(),e.modal.setTitle(g.close.nothing),e.container.getElement(".isu-close-label").addClassName("hidden"),e.container.getElement(".isu-close-content").addClassName("hidden");e.validate.focus(),r.unmask(e.container),new a({element:e.container}).inject(e.modal.getBody())})},build:function(){var e=this;return f.start(e.name+" build"),e._check(e.getOption("physicalIds")).then(function(t){var n="";s.is(t,"object")&&s.is(t.closable,"array")&&1===t.closable.length&&(n=t.closable[0].resolutionStatement);for(var r=s.createElement("div",{class:"isu-close-form",html:[{tag:"h5",class:"",html:g.create.properties.labels.resolutionStatement},e.fields.resolutionStatement=new i({name:"isu-close-resolution-statement",id:"isu-close-resolution-statement",className:"isu-close-resolution-statement",value:n,multiline:!0,required:!1,placeholder:g.create.properties.labels.resolutionStatementPlaceholder})]}),a=t.closable,o=t.indelible,l={physicalIds:[],titles:[],icons:[]},c=0;c<a.length;c++)l.physicalIds.push(a[c].physicalId),l.titles.push(a[c].title+" ("+a[c].name+")"),l.icons.push({tag:"span",class:"fonticon fonticon-issue "});var d=[];l.titles.forEach(function(e,t){d.push(s.createElement("li",{html:[l.icons[t],s.String.escapeHTML(e)],title:e}))});for(var u={physicalIds:[],titles:[],icons:[]},m=0;m<o.length;m++)u.physicalIds.push(o[m].physicalId),u.titles.push(o[m].title+" ("+o[m].name+")"),u.icons.push({tag:"span",class:"fonticon fonticon-issue "});var p=[];u.titles.forEach(function(e,t){p.push(s.createElement("li",{html:[u.icons[t],s.String.escapeHTML(e)],title:e}))}),e.physicalIds=l.physicalIds,e.titles=l.titles,e.indelible=u.physicalIds,f.end(e.name+" build");var h=s.createElement("div",{class:"isu-close-list",html:[{tag:"div",class:"isu-close-label",html:[{tag:"span",class:"isu-close-label-first",html:g.close.warning},{tag:"span",class:"isu-close-label-second",html:g.close.closable}]},{tag:"div",class:"isu-close-content",html:s.createElement("ul",{html:d,class:"isu-close-content-list"})},{tag:"div",class:"isu-close-no-issues-label",html:g.close.indelible},{tag:"div",class:"isu-close-no-issues-content",html:s.createElement("ul",{html:p,class:"isu-close-no-issues-content-list"})}]}),v=s.createElement("div",{html:[]});return e.physicalIds.length>0&&r.inject(v),h.inject(v),v})},_check:function(e){var t=this;return f.start(t.name+" _check"),p.issues.retrieve({data:{objects:e.map(function(e){return{physicalId:e}})}}).then(function(e){for(var s={closable:[],indelible:[]},n=0;n<e.results.length;n++){var i=e.results[n].body;!0===t.utils.isClosable(i)?s.closable.push({physicalId:i.physicalId,name:i.name,state:i.state,title:i.title?i.title:"",resolutionStatement:i.resolutionStatement}):s.indelible.push({physicalId:i.physicalId,name:i.name,state:i.state,title:i.title?i.title:"",resolutionStatement:i.resolutionStatement})}return t.issues=s,f.end(t.name+" _check"),s},function(e){t._logger.error(e),c.displayNotification({msg:g.close.error,eventID:"error"}),f.end(t.name+" _check")})},close:function(){var e=this;f.start(e.name+" close");var t=u.get("widget")||window.widget;r.mask(t.body);var n=e.fields.resolutionStatement.getValue().trim();return p.issues.close({data:{objects:e.physicalIds.map(function(e){var t={physicalId:e};return""!==n&&(t.resolutionStatement=n),t})}}).then(function(){var s="";s=1===e.physicalIds.length?g.replace(g.close.singleSuccess,{title:e.titles[e.titles.length-1]}):g.replace(g.close.multipleSuccess,{number:e.physicalIds.length}),r.unmask(t.body),c.displayNotification({msg:s,eventID:"success"});var n=e.physicalIds.reduce(function(e,t){return e.push([t]),e},[]),i=e.physicalIds.reduce(function(t,s,n){return t[s]=e.issues.closable[n],t[s].state="Closed",t[s].type="Issue",t[s].modifiedAttributes=["state"],t},{});f.end(e.name+" close"),d.publish("DS/Object/update",{metadata:{appId:t.id,appName:t.name,timestamp:Math.floor(Date.now())},data:{paths:n,attributes:i},version:"1.0"})},function(n){r.unmask(t.body);var i="";if(n&&n.error&&s.is(n.error.message,"string")&&(i=n.error.message),n.error&&n.error.internal&&n.error.internal.includes("You do not have the permissions to perform this action")){var a=h.getErrorMessage("1005");h.displayErrorMessage(a,"error")}else if(i.includes("Action Taken and Resolution Statement are not filled in")){var o=h.getErrorMessage("5");h.displayErrorMessage(o,"error")}else if(i.includes("Action Taken field is not filled in")){o=h.getErrorMessage("6");h.displayErrorMessage(o,"error")}else if(i.includes("Resolution Statement field is not filled in")){o=h.getErrorMessage("7");h.displayErrorMessage(o,"error")}else if(i.includes("Resolution Date is not filled in")){o=h.getErrorMessage("8");h.displayErrorMessage(o,"error")}else c.displayNotification({msg:n.error.message,eventID:"error"});f.end(e.name+" close"),e._logger.error("Cannot close the selected issue(s) because %o",n)})},utils:{isClosable:function(e){return e.state!==v}}})}),define("DS/IssueComponents/related/RelatedContentActionBar",["i18n!DS/IssueComponents/assets/nls/IssueComponents"],function(e){var t=Object.create(null);return t.toolbar=null,t.viewData={menu:[{type:"PushItem",title:e.toolbar.ISU_TOOLTIP_GRID_VIEW,fonticon:{family:1,content:"wux-ui-3ds wux-ui-3ds-view-list"},action:{module:"DS/ENOChgActionGridUX/scripts/View/ChgDataGridLayout",func:"changeView"},tooltip:e.toolbar.ISU_TOOLTIP_GRID_VIEW},{type:"PushItem",title:e.toolbar.ISU_TOOLTIP_TILE_VIEW,fonticon:{family:1,content:"wux-ui-3ds wux-ui-3ds-view-small-tile"},action:{module:"DS/ENOChgActionGridUX/scripts/View/ChgTileViewLayout",func:"changeView"},tooltip:e.toolbar.ISU_TOOLTIP_TILE_VIEW}]},t.writetoolbarDefination=function(t){var s={entries:[{id:"addExistingCommand",dataElements:{typeRepresentation:"functionMenuIcon",icon:{iconName:"plus",fontIconFamily:1},category:"add",readOnly:!1,position:"far",tooltip:e.toolbar.addCommand},children:[{id:"addAffectedItem",dataElements:{typeRepresentation:"PushItem",label:e.toolbar.addAffectedItem,action:{module:"DS/IssueComponents/related/RelatedContentActionBar",func:"addAffectedItem"},icon:{iconName:"location",fontIconFamily:WUXManagedFontIcons.Font3DS,fontIconSize:"0.75x"}}},{id:"addResolvedby",dataElements:{typeRepresentation:"PushItem",label:e.toolbar.addResolvedBy,action:{module:"DS/IssueComponents/related/RelatedContentActionBar",func:"addResolvedBy"},icon:{iconName:"docs",fontIconFamily:WUXManagedFontIcons.Font3DS,fontIconSize:"0.75x"}}},{id:"addResolvedItems",dataElements:{typeRepresentation:"PushItem",label:e.toolbar.addResolvedItems,action:{module:"DS/IssueComponents/related/RelatedContentActionBar",func:"addResolvedItems"},icon:{iconName:"markup-review",fontIconFamily:WUXManagedFontIcons.Font3DS,fontIconSize:"0.75x"}}},{id:"addContexts",dataElements:{typeRepresentation:"PushItem",label:e.toolbar.addContexts,action:{module:"DS/IssueComponents/related/RelatedContentActionBar",func:"addContexts"},icon:{iconName:"3d-object",fontIconFamily:WUXManagedFontIcons.Font3DS,fontIconSize:"0.75x"}}}]},{id:"pickCommand",dataElements:{typeRepresentation:"functionMenuIcon",icon:{iconName:"location",fontIconFamily:1},category:"add",readOnly:!1,position:"far",tooltip:e.toolbar.pickCommand},children:[{id:"pickAffectedItem",dataElements:{typeRepresentation:"PushItem",label:e.toolbar.pickAffectedItem,action:{module:"DS/IssueComponents/related/RelatedContentActionBar",func:"pickAffectedItem"},icon:{iconName:"location",fontIconFamily:WUXManagedFontIcons.Font3DS,fontIconSize:"0.75x"}}},{id:"pickResolvedItems",dataElements:{typeRepresentation:"PushItem",label:e.toolbar.pickResolvedItems,action:{module:"DS/IssueComponents/related/RelatedContentActionBar",func:"pickResolvedItems"},icon:{iconName:"markup-review",fontIconFamily:WUXManagedFontIcons.Font3DS,fontIconSize:"0.75x"}}},{id:"pickContexts",dataElements:{typeRepresentation:"PushItem",label:e.toolbar.pickContext,action:{module:"DS/IssueComponents/related/RelatedContentActionBar",func:"pickContexts"},icon:{iconName:"3d-object",fontIconFamily:WUXManagedFontIcons.Font3DS,fontIconSize:"0.75x"}}}]}]};return JSON.stringify(s)},t.pickAffectedItem=function(e){e._event="pickAffectedItem",t.toolbar.onToolbarClickCallback(e)},t.pickResolvedBy=function(e){e._event="pickResolvedBy",t.toolbar.onToolbarClickCallback(e)},t.pickResolvedItems=function(e){e._event="pickResolvedItems",t.toolbar.onToolbarClickCallback(e)},t.pickContexts=function(e){e._event="pickContexts",t.toolbar.onToolbarClickCallback(e)},t.addAffectedItem=function(e){e._event="addAffectedItem",t.toolbar.onToolbarClickCallback(e)},t.addResolvedBy=function(e){e._event="addResolvedBy",t.toolbar.onToolbarClickCallback(e)},t.addResolvedItems=function(e){e._event="addResolvedItems",t.toolbar.onToolbarClickCallback(e)},t.addContexts=function(e){e._event="addContexts",t.toolbar.onToolbarClickCallback(e)},t}),define("DS/IssueComponents/helper/Helper",["UWA/Core","DS/UIKIT/Input/Button","DS/UIKIT/Scroller","DS/UIKIT/Toggler","DS/ENOFloatingPanel/ENOFloatingPanel","DS/IssueComponents/utils/Utils","DS/WebappsUtils/WebappsUtils","i18n!DS/IssueComponents/assets/nls/IssueComponents","css!DS/IssueComponents/IssueComponents.css"],function(e,t,s,n,i,r,a,o){"use strict";var l="Create",c="Assign",d="Active",u="Review",m="Closed",p="minimized";return{name:"DS/IssueComponents/helper/Helper",show:function(t){var n=this;if(n.modal)return null;var r=e.createElement("div",{class:"helper-dialog-body",html:n.getDialogBody()}),a=new i({animate:!0,autocenter:!0,closable:!0,limitParent:!1,overlay:!1,resizable:!0,visible:!0,persistId:"ISUHelper",className:"helper-dialog",title:o.helper.dialog.title,header:null,body:r,events:{onClose:function(){a.destroy(),n.modal=null,n.views=null}}}).inject(t),l=e.createElement("span",{class:"right-actions minimize fonticon fonticon-minus"}),c=a.rightButtons.querySelector(".fonticon-cancel");a.rightButtons.insertBefore(l,c),l.addEventListener("click",function(){n.minimize()}),n.views.minimize={},n.views.minimize.icon=l,a.addEvent("onResizeFloating",function(){"44px"!==a.elements.container.getStyle("height")&&n.views.minimize.icon.hasClassName(p)&&n.views.minimize.icon.removeClassName(p)});var d=new s({element:n.views.contentsBody});return a.show(),n.modal=a,d},getBody:function(){for(var t=e.createElement("div",{class:"tooltip-header-body"}),s=[],n=[l,c,d,u,m],i=0;i<n.length;i++){var r="";i===n.length-1&&(r="th-last-row"),s.push(this.getStateHelper(n[i],r))}var a=e.createElement("table");return a.setContent(s),t.setContent(a),t},getStateHelper:function(t,s){var n=[e.createElement("th",{class:"th-title "+s,html:e.createElement("span",{class:"state-title",html:e.createElement("span",{class:"state-content",html:o.maturity[t.toLowerCase()]}),styles:{"background-color":r.getColorByState(t)}})}),e.createElement("th",{class:"th-description "+s,html:e.createElement("span",{class:"state-description",html:o.helper.states[t.toLowerCase()]})})];return e.createElement("tr",{class:"helper-state",html:n})},getDialogBody:function(){var t=this,s=e.createElement("nav",{class:"tab",html:[e.createElement("li",{class:"tab-item active",id:"state",html:[e.createElement("span",{class:"fonticon fonticon-issue "}),o.helper.dialog.tabStates]}),e.createElement("li",{class:"tab-item",id:"shortcut",html:[e.createElement("span",{class:"fonticon fonticon-keyboard"}),o.helper.dialog.tabShortcuts]}),e.createElement("li",{class:"tab-item",id:"workflow",html:[e.createElement("span",{class:"fonticon fonticon-route"}),o.helper.dialog.workflow]})]}),i=new n({container:s,events:{onToggle:function(e){"id"in e&&(Object.keys(t.views.contents).forEach(function(e){t.views.contents[e].hide()}),t.views.contents[e.id].show())}}});t.views={},t.views.contents={},t.views.contents.state=t.state(),t.views.contents.shortcut=t.shortcut(),t.views.contents.workflow=t.workflow(),t.views.contents.shortcut.hide(),t.views.contents.workflow.hide();var r=e.createElement("div",{class:"helper-content-main",html:[t.views.contents.state,t.views.contents.shortcut,t.views.contents.workflow]});return t.views.contentsBody=r,[i,r]},workflow:function(){var t=this,s=e.createElement("div",{class:"helper-content-workflow helper-content-state"});t.lifecycle={Create:{name:"Create",type:"state",index:0,next:["route1","Closed"],organisation:"Reporting",previous:""},route1:{name:"Confirm",type:"route",index:1,organisation:"Reporting",next:["Assign"],previous:""},Assign:{name:"Assign",type:"state",index:2,organisation:"Responsible",next:["route2","Closed"],previous:""},route2:{name:"Approve",type:"route",index:3,organisation:"Responsible",next:["Active"],previous:"Create"},Active:{name:"Active",type:"state",index:4,organisation:"Responsible",next:["route3","Closed"],previous:""},route3:{name:"Confirm",type:"route",index:5,organisation:"Responsible",next:["Review"],previous:""},Review:{name:"Review",type:"state",index:6,organisation:"Reporting",next:["route4","Closed"],previous:""},route4:{name:"Approve",type:"route",index:7,organisation:"Reporting",next:["Closed"],previous:"Active"},Closed:{name:"Closed",type:"state",index:8,organisation:"Reporting",next:[],previous:""}};var n=Object.keys(t.lifecycle);t.grid=e.createElement("table",{class:"helper-workflow-grid"}).inject(s);var i=0,r=0,a=[];n.forEach(function(e){t.lifecycle[e].next.length>0&&(i=i+t.lifecycle[e].next.length-1),""!==t.lifecycle[e].previous&&(r+=1),t.lifecycle[e].organisation.length>0&&(a.includes(t.lifecycle[e].organisation)||a.push(t.lifecycle[e].organisation))});var l=a.length,c=n.length+2*(n.length-1)+1,d=i+r+5+l+2*(l-1),u=0,m=0;for(u=0;u<d;u++){var p=e.createElement("tr",{class:"helper-workflow-grid-row"}).inject(t.grid);for(m=0;m<c;m++)e.createElement("td",{class:"helper-workflow-grid-cell",html:e.createElement("div",{class:"lifecycle-cell-content"})}).inject(p)}t.grid.getElementsByTagName("tr")[11].setStyle("height","65px");var f=new Array(d);for(u=0;u<d;u++)f[u]=new Array(c);for(var h=0;h<d;h++)for(var g=0;g<c;g++)f[h][g]=t.grid.getChildren()[h].getChildren()[g].getElement(".lifecycle-cell-content");t.graphComponents.cells=f,t.nodes=[];var v=0===i?0:i+2;t.createNodes(f,v,a);var b={forward:t.grid.getChildren().length-1,reverse:1},C=[];t.nodes.forEach(function(e){var s=t.connectNodes(e,f,b);C=C.concat(s)});var E=[];if(a.length>1){var I=0,y=v+1;for(u=0;u<a.length;u++){var S={name:a[u],start:I,end:y};y=(I=S.end+1)+2,u===a.length-1&&(S.end=d-1),E.push(S)}t.grid.setStyle("background","#f9f9f9"),t.grid.setStyle("border","1px solid");var w=t.grid.getChildren();for(w.forEach(function(e){e.getChildren()[0].getChildren()[0].setStyle("width","30px"),e.getChildren()[0].setStyle("border-right","1px solid")}),u=0;u<E.length;u++){var T=E[u].name;for(I=E[u].start,y=E[u].end,m=I;m<=y;m++)if(u%2==0&&w[m].setStyle("background","#f0f8ff"),m===y){w[m].setStyle("border-bottom","1px solid");var D=w[m].getChildren()[0].getChildren()[0];E[u].caption=e.createElement("div",{class:"lifecycle-helper-caption-wrapper",html:e.createElement("div",{class:"lifecycle-helper-caption",html:o.lifecycle.orgs[T]})}).inject(D)}}}return s.show=function(){s.setStyle("display","table"),C.forEach(function(e){var t=0,s=0,n=0;e.end.c-e.start.c>0?(s=e.start.c,n=e.end.c):(s=e.end.c,n=e.start.c);for(var i=e.start.r,r=s+1;r<n;r++)t+=f[i][r].getSize().width;e.caption.setStyle("width",t)}),E.forEach(function(e){for(var t=0,s=e.start;s<=e.end-1;s++)t+=f[s][0].getSize().height;e.caption.setStyle("width",t),e.caption.setStyle("padding","15px"),e.caption.setStyle("transform-origin","left"),e.caption.setStyle("transform","rotate(-90deg)")})},s},createNodes:function(e,t,s){for(var n=Object.keys(this.lifecycle),i=1,r=0;r<n.length;r++){var a={},o=s.indexOf(this.lifecycle[n[r]].organisation),l=0;l=0!==o?t+o+2*o:t,a.cell=this.createNode(this.lifecycle[n[r]],l,i),a.index={r:l,c:i},a.state=this.lifecycle[n[r]],this.nodes.push(a),i+=3}},createNode:function(e,t,s){var n=null;return"state"===e.type?n=this.graphComponents.createStateNode(e,t,s):"route"===e.type&&(n=this.graphComponents.createRouteNode(e,t,s)),n},connectNodes:function(t,s,n){for(var i=this,r=t.state.next.length,a=0,l=0,c=0,d=0,u=[],m=null,p=function(e,t){return i.nodes.find(function(e){return e.state.index===t.index})},f=function(e,t){return i.nodes.find(function(e){return e.state.index===t.index})},h=0;h<r;h++){var g=i.lifecycle[t.state.next[h]],v=p(0,g),b=g.index-t.state.index,C=v.index.r-t.index.r;if(1===b)if(a=t.index.r,l=t.index.c+1,0===C){if(i.graphComponents.createHorizontalLine().inject(s[a][l]),l+=1,"Approve"===t.state.name){i.graphComponents.createHorizontalLine().inject(s[a][l]);var E=e.createElement("span",{class:"lifecycle-helper-caption",html:o.lifecycle.paths.approve}).inject(s[a][l]);E.setStyle("position","inherit"),E.setStyle("white-space","pre")}i.graphComponents.createHorizontalConnectorArrowRight(a,l)}else C>0?(i.graphComponents.createHorizontalConnector(0,"left",a,l,"start"),a=(m=i.graphComponents.createVerticalConnector(C-1,"down",a,l)).end.r,l=m.end.c,i.graphComponents.createHorizontalConnector(0,"Right",a,l,"start"),l+=1,i.graphComponents.createHorizontalConnectorArrowRight(a,l)):C<0&&(C=Math.abs(C),i.graphComponents.createHorizontalConnector(0,"left",a,l,"start"),a=(m=i.graphComponents.createVerticalConnector(C-1,"up",a,l)).end.r,l=m.end.c,i.graphComponents.createHorizontalConnector(0,"Right",a,l,"start"),l+=1,i.graphComponents.createHorizontalConnectorArrowRight(a,l));else if(b>1){var I=n.forward-t.index.r-1;b=v.index.c-t.index.c-1,n.forward=n.forward-1,a=t.index.r+1,l=t.index.c,a=(m=i.graphComponents.createVerticalConnector(I,"down",a,l,"end")).end.r,l=m.end.c,a=(m=i.graphComponents.createHorizontalConnector(b,"Right",a,l)).end.r,l=m.end.c,c=m.start.c+1,d=m.start.r,m.caption=e.createElement("div",{class:"lifecycle-helper-caption-wrapper",html:e.createElement("div",{class:"lifecycle-helper-caption",html:o.lifecycle.paths.anyStateToClose})}).inject(s[d][c]),u.push(m),I=a-v.index.r-1,a=(m=i.graphComponents.createVerticalConnector(I-1,"up",a,l,"start")).end.r,l=m.end.c,a=(m=i.graphComponents.createVerticalConnectorArrowUp(a,l)).end.r,l=m.end.c}var y=i.lifecycle[t.state.previous];if(void 0!==y){var S=t.index.r-n.reverse-1,w=f(0,y);b=t.index.c-w.index.c-1,a=t.index.r-1,l=t.index.c,a=(m=i.graphComponents.createVerticalConnector(S,"up",a,l,"end")).end.r,l=m.end.c,a=(m=i.graphComponents.createHorizontalConnector(b,"Left",a,l)).end.r,l=m.end.c,c=m.end.c+1,d=m.start.r,m.caption=e.createElement("div",{class:"lifecycle-helper-caption-wrapper",html:e.createElement("div",{class:"lifecycle-helper-caption",html:o.lifecycle.paths.reject})}).inject(s[d][c]),u.push(m),S=w.index.r-a-1,a=(m=i.graphComponents.createVerticalConnector(S-1,"down",a,l,"start")).end.r,l=m.end.c,a=(m=i.graphComponents.createVerticalConnectorArrowDown(a,l)).end.r,l=m.end.c}}return u},state:function(){var t=e.createElement("div",{class:"helper-content helper-content-state"}),s=e.createElement("div",{class:"helper-content-header-container",html:e.createElement("div",{class:"helper-content-header-title",html:o.helper.dialog.tabStates})}),n=e.createElement("div",{class:"helper-content-body-container"}),i=function(t,s){var n=[e.createElement("th",{class:"th-title "+s,html:e.createElement("span",{class:"state-title",html:e.createElement("span",{class:"state-content",html:o.maturity[t.toLowerCase()]}),styles:{"background-color":r.getColorByState(t)}})}),e.createElement("th",{class:s,html:e.createElement("span",{class:"th-description",html:o.helper.dialog.states[t.toLowerCase()]})})];return e.createElement("tr",{class:"helper-state",html:n})};t.addContent(s),t.addContent(n);for(var a=[],p=[l,c,d,u,m],f=0;f<p.length;f++){var h="";f===p.length-1&&(h="th-last-row"),a.push(i(p[f],h))}var g=e.createElement("table");return g.setContent(a),n.addContent(g),t},shortcut:function(){var t=e.createElement("div",{class:"helper-content"}),s=function(t,s,n){var i=[e.createElement("th",{class:"th-helper-dialog-key "+n,html:e.createElement("span",{class:"default-helper-title key-shortcut-key",html:e.createElement("span",{class:"default-helper-content ",html:o.helper.dialog.shortcut.key[s][t]})})}),e.createElement("th",{class:n,html:e.createElement("span",{class:"th-helper-dialog-description",html:o.helper.dialog.shortcut.detail[s][t]})})];return e.createElement("tr",{class:"helper-state",html:i})},n=function(t,n,i,r){var a=e.createElement("div",{class:"helper-content-header-container",html:e.createElement("div",{class:"helper-content-header-title",html:n})}),o=e.createElement("div",{class:"helper-content-body-container default-content-body-container"});t.addContent(a),t.addContent(o);for(var l=[],c=0;c<i.length;c++){var d="";c===i.length-1&&(d="th-last-row"),l.push(s(i[c],r,d))}var u=e.createElement("table");u.setContent(l),o.addContent(u)};return n(t,o.helper.dialog.subtitleShortcuts,["arrowUp","arrowDown","arrowLeft","arrowRight","shiftArrow","ctrlA","ctrlC","delete","enter"],"shortcut"),n(t,o.helper.dialog.subtitleMouseOperation,["ctrlClick","shiftClick","doubleClick"],"mouse"),t},minimize:function(){this.views.minimize.icon.hasClassName(p)?(this.views.minimize.icon.removeClassName(p),this.modal.elements.container.setStyle("height",this.views.minimize.height)):(this.views.minimize.icon.addClassName(p),this.views.minimize.height=this.modal.elements.container.getStyle("height"),this.modal.elements.container.setStyle("height","44px"))},graphComponents:{createRouteNode:function(t,s,n){var i=a.getWebappsAssetUrl("IssueComponents","images/decisionBox.PNG");return e.createElement("div",{class:"lifecycle-decision-box",html:[e.createElement("img",{src:i}),e.createElement("div",{class:"route-content",html:o.routes[t.name.toLowerCase()]})]}).inject(this.cells[s][n])},createStateNode:function(t,s,n){return e.createElement("div",{class:"state-content",html:e.createElement("span",{class:"state-title",html:e.createElement("span",{class:"state-content",html:o.maturity[t.name.toLowerCase()]}),styles:{"background-color":r.getColorByState(t.name)}})}).inject(this.cells[s][n])},createHorizontalLine:function(){return e.createElement("div",{class:"lifecycle-horizontal-line",html:e.createElement("hr",{class:"horizontal-line"})})},createVerticalLine:function(){return e.createElement("div",{class:"lifecycle-vertical-line",html:e.createElement("div",{class:"vertical-line"})})},createVerticalConnector:function(e,t,s,n,i){return"up"===t?this.createVerticalConnectorUp(e,s,n,i):this.createVerticalConnectorDown(e,s,n,i)},createVerticalConnectorUp:function(t,s,n,i){var r={div:e.createElement("div"),start:{r:s,c:n},end:{r:s,c:n}};"end"!==i&&(this.createVerticalLine().inject(this.cells[s][n]).getChildren()[0].setStyle("height","50%"),s--);for(var a=0;a<t;a++)this.createVerticalLine().inject(this.cells[s][n]),s--;if("start"!==i){var o=this.createVerticalLine().inject(this.cells[s][n]);o.getChildren()[0].setStyle("height","50%"),o.style.transform="rotateZ(180deg)"}return r.end.r=s,r.end.c=n,r},createVerticalConnectorDown:function(t,s,n,i){var r={div:e.createElement("div"),start:{r:s,c:n},end:{r:s,c:n}};if("end"!==i){var a=this.createVerticalLine().inject(this.cells[s][n]);a.getChildren()[0].setStyle("height","50%"),a.style.transform="rotateZ(180deg)",s++}for(var o=0;o<t;o++)this.createVerticalLine().inject(this.cells[s][n]),s++;"start"!==i&&this.createVerticalLine().inject(this.cells[s][n]).getChildren()[0].setStyle("height","50%");return r.end.r=s,r.end.c=n,r},createHorizontalConnector:function(e,t,s,n,i){return"Right"===t?this.createHorizontalConnectorRight(e,s,n,i):this.createHorizontalConnectorLeft(e,s,n,i)},createHorizontalConnectorRight:function(t,s,n,i){var r={div:e.createElement("div"),start:{r:s,c:n},end:{r:s,c:n}};if("end"!==i){var a=this.createHorizontalLine().inject(this.cells[s][n]);a.getChildren()[0].setStyle("width","50%"),a.style.transform="rotate(180deg)"}n++;for(var o=0;o<t;o++)this.createHorizontalLine().inject(this.cells[s][n]),n++;"start"!==i&&this.createHorizontalLine().inject(this.cells[s][n]).getChildren()[0].setStyle("width","50%");return r.end.r=s,r.end.c=n,r},createHorizontalConnectorLeft:function(t,s,n,i){var r={div:e.createElement("div"),start:{r:s,c:n},end:{r:s,c:n}};"end"!==i&&this.createHorizontalLine().inject(this.cells[s][n]).getChildren()[0].setStyle("width","50%");n--;for(var a=0;a<t;a++)this.createHorizontalLine().inject(this.cells[s][n]),n--;if("start"!==i){var o=this.createHorizontalLine().inject(this.cells[s][n]);o.getChildren()[0].setStyle("width","50%"),o.style.transform="rotate(180deg)"}return r.end.r=s,r.end.c=n,r},createVerticalConnectorArrowUp:function(t,s){var n={div:e.createElement("div"),start:{r:t,c:s},end:{r:t,c:s}};return e.createElement("div",{class:"lifecycle-vertical-arrow-up",html:[e.createElement("div",{class:"lifecycle-vertical-line",html:e.createElement("div",{class:"vertical-line"})}),e.createElement("div"),{class:"lifecycle-helper-arrow",html:e.createElement("div",{class:"vertical-arrow-up"})}]}).inject(this.cells[t][s]),n.end.r=t,n.end.c=s,n},createVerticalConnectorArrowDown:function(t,s){var n={div:e.createElement("div"),start:{r:t,c:s},end:{r:t,c:s}};return e.createElement("div",{class:"lifecycle-vertical-arrow-down",html:[e.createElement("div",{class:"lifecycle-vertical-line",html:e.createElement("div",{class:"vertical-line"})}),e.createElement("div"),{class:"lifecycle-helper-arrow",html:e.createElement("div",{class:"vertical-arrow-down"})}]}).inject(this.cells[t][s]),n.end.r=t,n.end.c=s,n},createHorizontalConnectorArrowRight:function(t,s){e.createElement("div",{class:"lifecycle-horizontal-arrow-right",html:[this.createHorizontalLine(),e.createElement("div"),{class:"lifecycle-helper-arrow",html:e.createElement("div",{class:"lifecycle-arrow"})}]}).inject(this.cells[t][s])},createHorizontalConnectorArrowleft:function(t,s){e.createElement("div",{class:"lifecycle-horizontal-arrow-left",html:[e.createElement("div"),{class:"lifecycle-helper-arrow",html:e.createElement("div",{class:"lifecycle-arrow"}).setStyle("transform","rotate(180deg)")},this.createHorizontalLine()]}).inject(this.cells[t][s])}}}}),define("DS/IssueComponents/lifecycle/Lifecycle",["UWA/Class/View","UWA/Core","UWA/Class/Promise","DS/Logger/Logger","DS/UIKIT/Input/Button","DS/UIKIT/Input/Text","DS/UIKIT/Tooltip","DS/UIKIT/Scroller","DS/ENOFloatingPanel/ENOFloatingPanel","DS/PADUtils/views/PADAlert","DS/IssueAttachmentManager/components/Collection","DS/IssueAttachmentManager/services/AttachmentServices","DS/IssueAttachmentManager/views/UploadDialog","i18n!DS/IssueAttachmentManager/assets/nls/IssueAttachmentManager","DS/IssueCommon/utils/Utils","DS/IssueComponents/create/Attachments","DS/IssueComponents/close/Close","DS/IssueServices/Contexts","DS/IssueServices/services/IssueServices","DS/IssueServices/services/PlatformServices","DS/IssueServices/utils/Performance","i18n!DS/IssueComponents/assets/nls/IssueComponents","css!DS/IssueComponents/IssueComponents.css"],function(e,t,s,n,i,r,a,o,l,c,d,u,m,p,f,h,g,v,b,C,E,I){"use strict";var y={STATES:{CREATE:0,ASSIGN:1,ACTIVE:2,REVIEW:3,CLOSED:4},STATES_ORDER:{0:"CREATE",1:"ASSIGN",2:"ACTIVE",3:"REVIEW",4:"CLOSED"},STATES_VALUES:{CREATE:"Create",ASSIGN:"Assign",ACTIVE:"Active",REVIEW:"Review",CLOSED:"Closed"},CSS:{ELEMENTS:{GRAPH_CONTAINER:"im-lifecycle-graph-container",GRAPH_NOT_SUPPORTED:"im-lifecycle-graph-not-supported",GRAPH_NOT_SUPPORTED_TEXT:"im-lifecycle-graph-not-supported-text",GRAPH_ARIADNE:"im-lifecycle-graph-ariadne",GRAPH_ARIADNE_PLACEHOLDER:"im-lifecycle-graph-ariadne-placeholder",GRAPH_ARIADNE_ROPE:"im-lifecycle-graph-ariadne-rope",GRAPH_STATES_CONTAINER:"im-lifecycle-graph-states-ctn",GRAPH_STATE:"im-lifecycle-graph-state",GRAPH_STATE_TEXT:"im-lifecycle-graph-state-text",GRAPH_STATE_OVERLAY:"im-lifecycle-graph-state-overlay",GRAPH_STATE_PREV:"im-lifecycle-graph-state-prev",GRAPH_STATE_CURR:"im-lifecycle-graph-state-curr",GRAPH_STATE_NEXT:"im-lifecycle-graph-state-next",GRAPH_STATE_CLICKABLE:"im-lifecycle-graph-state-clickable",GRAPH_STATE_REQUIRES_APPROVAL:"im-lifecycle-graph-state-requires-approval",GRAPH_STATE_CREATE:"im-lifecycle-graph-state-create",GRAPH_STATE_ASSIGN:"im-lifecycle-graph-state-assign",GRAPH_STATE_ACTIVE:"im-lifecycle-graph-state-active",GRAPH_STATE_REVIEW:"im-lifecycle-graph-state-review",GRAPH_STATE_CLOSED:"im-lifecycle-graph-state-closed",GRAPH_STATE_CURRENT_INDICATOR:"fonticon fonticon-expand-down im-lifecycle-graph-state-current-indicator",GRAPH_STATE_APPROVE:"fonticon fonticon-thumbs-up im-lifecycle-graph-state-approve",GRAPH_STATE_REJECT:"fonticon fonticon-thumbs-down im-lifecycle-graph-state-reject",GRAPH_STATE_INPROGRESS:"fonticon fonticon-clock im-lifecycle-graph-state-inprogress",GRAPH_HISTORY_CONTAINER:"im-lifecycle-graph-history-container",GRAPH_HISTORY_APPROVED:"fonticon fonticon-check im-lifecycle-graph-history-approved ",GRAPH_HISTORY_REJECTED:"fonticon fonticon-wrong im-lifecycle-graph-history-rejected",GRAPH_HISTORY_MORE:"fonticon fonticon-menu-dot im-lifecycle-graph-history-more",GRAPH_HISTORY_TOOLTIP:"im-lifecycle-graph-history-tooltip",GRAPH_HISTORY_TOOLTIP_TITLE:"im-lifecycle-graph-history-tooltip-title",STATE_APPROVE_MODAL:"im-lifecycle-approve-modal",STATE_APPROVE_MODAL_HEIGHT:490,STATE_APPROVE_MODAL_WIDTH:510,STATE_APPROVE_MODAL_BODY:"im-lifecycle-approve-modal-body",STATE_APPROVE_MODAL_REASON:"im-lifecycle-approve-modal-reason",STATE_APPROVE_MODAL_ATTACHMENTS:"im-lifecycle-approve-modal-attachments"}}};return e.extend({name:"DS/IssueComponents/lifecycle/Lifecycle",tagName:"div",className:"im-lifecycle-graph-component",_logger:null,domEvents:{"click div.im-lifecycle-graph-state":"_onStateClick"},defaultOptions:{ids:[],state:"Create",states:["Create","Assign","Active","Review","Closed"]},setup:function(e){var t=this;E.start(t.name+" setup"),t._parent(e),t._logger=n.getLogger(t.name),t.elements={},t._tooltips=[],t._statesTooltips=[],t._deferred={},t.isLoaded=new s(function(e,s){t._deferred.resolve=e,t._deferred.reject=s}),t.physicalIds=[],t._isProcessing=!1,E.end(t.name+" setup")},render:function(){var e=this;E.start(e.name+" render");var s=e.elements.graph=t.createElement("div",{class:y.CSS.ELEMENTS.GRAPH_CONTAINER});s.inject(e.container),(e.elements.notSupported=t.createElement("span",{class:y.CSS.ELEMENTS.GRAPH_NOT_SUPPORTED_TEXT,html:I.lifecycle.notSupported,title:I.lifecycle.notSupported})).inject(s);var n=t.createElement("div",{class:y.CSS.ELEMENTS.GRAPH_ARIADNE});t.createElement("div",{class:y.CSS.ELEMENTS.GRAPH_ARIADNE_PLACEHOLDER}).inject(n),(e.elements.ariadneRope=t.createElement("div",{class:y.CSS.ELEMENTS.GRAPH_ARIADNE_ROPE})).inject(n),n.inject(s);var i=t.createElement("div",{class:y.CSS.ELEMENTS.GRAPH_STATES_CONTAINER});i.inject(s);var r=Object.keys(y.STATES);return e.elements.states={create:null,assign:null,active:null,review:null,closed:null},e.elements.routesContainer={create:null,assign:null,active:null,review:null},r.sort(function(e,t){return y.STATES[e.toUpperCase()]-y.STATES[t.toUpperCase()]}).forEach(function(s,n){var o=y.CSS.ELEMENTS["GRAPH_STATE_"+s.toUpperCase()],l=I.maturity[s.toLowerCase()],c=t.createElement("span",{class:y.CSS.ELEMENTS.GRAPH_STATE_TEXT,html:l}),d=t.createElement("div",{class:y.CSS.ELEMENTS.GRAPH_STATE_OVERLAY}),u=t.createElement("div",{class:y.CSS.ELEMENTS.GRAPH_STATE+" "+o,html:[d,c]});if(u.setData("state",s.toLowerCase()),e.elements.states[s.toLowerCase()]=u,u.inject(i),u.hide(),e._statesTooltips.push(new a({position:"top",target:c,body:I.lifecycle[s.toLowerCase()]})),n<r.length-1){var m=t.createElement("div",{class:y.CSS.ELEMENTS.GRAPH_HISTORY_CONTAINER});e.elements.routesContainer[s.toLowerCase()]=m,m.inject(i),m.hide()}}),E.end(e.name+" render"),e},_renderApproveRejectButtons:function(e){var s=this,n=v.get("widget")||window.widget,d=e[0];s.elements.states[d.current.approveTo.toLowerCase()].toggleClassName(y.CSS.ELEMENTS.GRAPH_STATE_REQUIRES_APPROVAL,!0);var m=I.maturity[d.current.approveTo.toLowerCase()],p=s.maturityGraph,g=y.STATES[d.current.approveTo.toUpperCase()];""!==p&&null!=p&&(m=p[g].stateUserName);var b=t.createElement("span",{class:y.CSS.ELEMENTS.GRAPH_STATE_APPROVE});s._tooltips.push(new a({position:"left",target:b,body:I.replace(I.lifecycle.approveModal.header,{approveTo:m})})),b.addEventListener("click",function(){var e=t.createElement("div",{class:y.CSS.ELEMENTS.STATE_APPROVE_MODAL_BODY}),a=t.createElement("div",{class:y.CSS.ELEMENTS.STATE_APPROVE_MODAL_REASON});a.inject(e),t.createElement("label",{html:I.lifecycle.approveModal.reasonLabel}).inject(a);var d=new r({multiline:!0,rows:4,placeholder:I.lifecycle.approveModal.reasonPlaceholder});d.inject(a),d.getContent().toggleClassName("highlight",""===d.getValue()),d.getContent().addEventListener("keyup",function(){d.getContent().toggleClassName("highlight",""===d.getValue())});var p=t.createElement("div",{class:y.CSS.ELEMENTS.STATE_APPROVE_MODAL_ATTACHMENTS});p.inject(e);var g=new h({parent:s,annotateCommand:{enable:!0,addTextbox:!0,getText:function(){var e=null,t=d.getValue();t&&(e=C.getFullName()+"\n"+(new Date).toLocaleString(n.lang,{})+"\n"+t);return e}},searchAttachmentCommand:{getSearchQuery:function(){return u.getSearchQuery(s.physicalIds)}}});g.render(),g.inject(p),s.approveComponents={},s.approveComponents.attachments=g,s.approveComponents.reasonInput=d;var v={},b=new o({element:e}),E=new l({animate:!0,autocenter:!0,closable:!0,limitParent:!1,overlay:!0,resizable:!0,visible:!0,className:y.CSS.ELEMENTS.STATE_APPROVE_MODAL,header:t.createElement("h4",{html:I.replace(I.lifecycle.approveModal.header,{approveTo:m})}),body:b,footer:[v.okButton=new i({value:I.lifecycle.approveModal.okButton,className:"primary",events:{onClick:function(){""!==d.getValue()?(f.Mask.mask(e),v.okButton.elements.container.addClassName("disabled"),v.cancelButton.elements.container.addClassName("disabled"),s._approveRoutes(s.routes,d.getValue(),g).then(function(){E.destroy(),s.approveComponents=null}).catch(function(t){var n=I.lifecycle.error;if(null!=t&&void 0!==t&&null!=t.error&&(n=t.error.message),n.includes("Action Taken and Resolution Statement are not filled in")){v.cancelButton.elements.container.removeClassName("disabled");var i=f.getErrorMessage("5");f.displayErrorMessage(i,"error")}else if(n.includes("Action Taken field is not filled in")){v.cancelButton.elements.container.removeClassName("disabled");i=f.getErrorMessage("6");f.displayErrorMessage(i,"error")}else if(n.includes("Resolution Statement field is not filled in")){v.cancelButton.elements.container.removeClassName("disabled");i=f.getErrorMessage("7");f.displayErrorMessage(i,"error")}else if(n.includes("Resolution Date is not filled in")){v.cancelButton.elements.container.removeClassName("disabled");i=f.getErrorMessage("8");f.displayErrorMessage(i,"error")}else c.displayNotification({msg:n,eventID:"error"});s._logger.error(t),f.Mask.unmask(e)})):c.displayNotification({msg:I.lifecycle.approveModal.reasonRequired,eventID:"warning"})}}}),v.cancelButton=new i({value:I.lifecycle.approveModal.cancelButton,className:"default",events:{onClick:function(){E.destroy(),s.approveComponents=null}}})]});E.inject(n.body),E.elements.container.setStyle("height",y.CSS.ELEMENTS.STATE_APPROVE_MODAL_HEIGHT),E.elements.container.setStyle("width",y.CSS.ELEMENTS.STATE_APPROVE_MODAL_WIDTH),E.show(),d.focus()}),s.elements.approve=b,b.inject(s.elements.states[d.current.approveTo.toLowerCase()]);var E=t.createElement("span",{class:y.CSS.ELEMENTS.GRAPH_STATE_REJECT});s._tooltips.push(new a({position:"left",target:E,body:I.replace(I.lifecycle.rejectModal.header,{approveTo:m})})),E.addEventListener("click",function(){var e=t.createElement("div",{class:y.CSS.ELEMENTS.STATE_APPROVE_MODAL_BODY}),a=t.createElement("div",{class:y.CSS.ELEMENTS.STATE_APPROVE_MODAL_REASON});a.inject(e),t.createElement("label",{html:I.lifecycle.rejectModal.reasonLabel}).inject(a);var d=new r({multiline:!0,rows:4,placeholder:I.lifecycle.rejectModal.reasonPlaceholder});d.inject(a),d.getContent().toggleClassName("highlight",""===d.getValue()),d.getContent().addEventListener("keyup",function(){d.getContent().toggleClassName("highlight",""===d.getValue())});var p=t.createElement("div",{class:y.CSS.ELEMENTS.STATE_APPROVE_MODAL_ATTACHMENTS});p.inject(e);var g=new h({parent:s,annotateCommand:{enable:!0,addTextbox:!0,getText:function(){var e=null,t=d.getValue();t&&(e=C.getFullName()+"\n"+(new Date).toLocaleString(n.lang,{})+"\n"+t);return e}},searchAttachmentCommand:{getSearchQuery:function(){return u.getSearchQuery(s.physicalIds)}}});g.render(),g.inject(p),s.rejectComponents={},s.rejectComponents.attachments=g,s.rejectComponents.reasonInput=d;var v={},b=new o({element:e}),E=new l({animate:!0,autocenter:!0,closable:!0,limitParent:!1,overlay:!0,resizable:!0,visible:!0,className:y.CSS.ELEMENTS.STATE_APPROVE_MODAL,header:t.createElement("h4",{html:I.replace(I.lifecycle.rejectModal.header,{approveTo:m})}),body:b,footer:[v.okButton=new i({value:I.lifecycle.rejectModal.okButton,className:"primary",events:{onClick:function(){if(""===d.getValue())return c.displayNotification({msg:I.lifecycle.rejectModal.reasonRequired,eventID:"warning"}),void d.elements.container.addClassName("highlight");f.Mask.mask(e),v.okButton.elements.container.addClassName("disabled"),v.cancelButton.elements.container.addClassName("disabled"),s._rejectRoutes(s.routes,d.getValue(),g).then(function(){E.destroy()}).catch(function(t){c.displayNotification({msg:I.lifecycle.error,eventID:"error"}),s._logger.error(t),f.Mask.unmask(e)})}}}),v.cancelButton=new i({value:I.lifecycle.rejectModal.cancelButton,className:"default",events:{onClick:function(){E.destroy()}}})]});E.inject(n.body),E.elements.container.setStyle("height",y.CSS.ELEMENTS.STATE_APPROVE_MODAL_HEIGHT),E.elements.container.setStyle("width",y.CSS.ELEMENTS.STATE_APPROVE_MODAL_WIDTH),E.show(),d.focus()}),s.elements.reject=E,E.inject(s.elements.states[d.current.approveTo.toLowerCase()])},_renderInProgressIndicator:function(e){var s=t.createElement("span",{class:y.CSS.ELEMENTS.GRAPH_STATE_INPROGRESS});this.elements.inProgressIndicator=s;var n=t.createElement("div",{class:y.CSS.ELEMENTS.GRAPH_HISTORY_TOOLTIP}),i=e[0];if(e.length>1)this._tooltips.push(new a({position:"bottom",target:s,body:"<span>"+I.lifecycle.routeIndicatorTooltip.inProgressTooltip.multiSelectionTitle+"</span>"})),s.inject(this.elements.states[i.current.approveTo.toLowerCase()]);else if(1===e.length){var r=i.current.reviewers,o=i.current.decisions.filter(function(e){return"approved"===e.status||"rejected"===e.status}).map(function(e){return e.reviewer.user}),l=r.filter(function(e){return-1===o.indexOf(e.user)});if(l.length>0){var c=t.createElement("div",{html:'<span class="'+y.CSS.ELEMENTS.GRAPH_HISTORY_TOOLTIP_TITLE+'">'+I.lifecycle.routeIndicatorTooltip.inProgressTooltip.title+"</span>"});l.forEach(function(e){t.createElement("span",{html:"<span>"+e.fullName+"</span>"}).inject(c)}),c.inject(n)}var d=i.current.decisions.filter(function(e){return"approved"===e.status});if(d.length>0){var u=t.createElement("div",{html:'<span class="'+y.CSS.ELEMENTS.GRAPH_HISTORY_TOOLTIP_TITLE+'">'+I.lifecycle.routeIndicatorTooltip.approvalTitle+"</span>"});d.forEach(function(e){var s=I.replace(I.lifecycle.routeIndicatorTooltip.approvalText,{name:e.reviewer.fullName,date:new Date(e.date).toLocaleString(v.get("widget").lang)});t.createElement("span",{html:"<span>"+s+"</span>"}).inject(u)}),u.inject(n)}this._tooltips.push(new a({position:"bottom",target:s,body:n})),s.inject(this.elements.states[i.current.approveTo.toLowerCase()])}},_renderRoutesHistory:function(e){var s=this;if(Array.isArray(e.history)&&e.history.length>0){s.elements.routesIndicators={create:{more:null,last:null,nonLast:[]},assign:{more:null,last:null,nonLast:[]},active:{more:null,last:null,nonLast:[]},review:{more:null,last:null,nonLast:[]}};var n={create:[],assign:[],active:[],review:[]};e.history.forEach(function(e){n[e.from.toLowerCase()].push(e)}),Object.keys(n).forEach(function(i){s.elements.routesContainer[i].empty();var r=t.createElement("div",{class:y.CSS.ELEMENTS.GRAPH_HISTORY_MORE});r.inject(s.elements.routesContainer[i]),r.hide(),s.elements.routesIndicators[i].more={element:r,tooltip:null},n[i]=n[i].sort(function(e,t){return e.date?t.date?new Date(e.date)-new Date(t.date):-1:1}),n[i].forEach(function(r,o){var l="approved"===r.status?y.CSS.ELEMENTS.GRAPH_HISTORY_APPROVED:y.CSS.ELEMENTS.GRAPH_HISTORY_REJECTED,c=t.createElement("div",{class:l});c.addEventListener("click",function(){s.dispatchEvent("request:openRoute",{issueId:e.physicalId,route:r})});var d=s.elements.routesContainer[i];c.inject(d),o===n[i].length-1?s.elements.routesIndicators[i].last={data:r,element:c}:s.elements.routesIndicators[i].nonLast.unshift({data:r,element:c});var u=t.createElement("div",{class:y.CSS.ELEMENTS.GRAPH_HISTORY_TOOLTIP}),m=r.decisions.filter(function(e){return"rejected"===e.status});if(m.length>0){var p=t.createElement("div",{html:'<span class="'+y.CSS.ELEMENTS.GRAPH_HISTORY_TOOLTIP_TITLE+'">'+I.lifecycle.routeIndicatorTooltip.rejectionTitle+"</span>"});m.forEach(function(e){var s=I.replace(I.lifecycle.routeIndicatorTooltip.rejectionText,{name:e.reviewer.fullName,date:new Date(e.date).toLocaleString(v.get("widget").lang)});t.createElement("span",{html:"<span>"+s+"</span>"}).inject(p)}),p.inject(u)}var f=r.decisions.filter(function(e){return"approved"===e.status});if(f.length>0){var h=t.createElement("div",{html:'<span class="'+y.CSS.ELEMENTS.GRAPH_HISTORY_TOOLTIP_TITLE+'">'+I.lifecycle.routeIndicatorTooltip.approvalTitle+"</span>"});f.forEach(function(e){var s=I.replace(I.lifecycle.routeIndicatorTooltip.approvalText,{name:e.reviewer.fullName,date:new Date(e.date).toLocaleString(v.get("widget").lang)});t.createElement("span",{html:"<span>"+s+"</span>"}).inject(h)}),h.inject(u)}s._tooltips.push(new a({position:"bottom",target:c,body:u}))})})}},refresh:function(e){var s=this;s.physicalIds=e;var n=e[0],i=[];return b.issues.getMaturityGraph({data:{id:n}}).then(function(n){""!==n&&null!=n&&(i=n.data.policies[0].maturityGraph.states,s.maturityGraph=i),b.routes.retrieve({data:{objects:e.map(function(e){return{physicalId:e}})}}).then(function(n){s.reset(),s.routes=n.results.map(function(e){return e.body});var r=s.routes.every(function(e){return e.state===s.routes[0].state});if(e.length===n.results.length&&r){var a=t.is(s.routes[0].current,"object")&&t.is(s.routes[0].current.from,"string");if(s.routes.every(function(e){return(t.is(e.current,"object")&&t.is(e.current.from,"string"))===a})){var o=s.routes[0],l=o.state,c=y.STATES[l.toUpperCase()],d=y.STATES_ORDER[c+1],u=y.STATES_ORDER[c-1];if(Object.keys(s.elements.states).forEach(function(e){if(e!==y.STATES_VALUES.CLOSED.toLowerCase()?s.elements.states[e].toggleClassName(y.CSS.ELEMENTS.GRAPH_STATE_CLICKABLE,!1):s.elements.states[e].toggleClassName(y.CSS.ELEMENTS.GRAPH_STATE_CLICKABLE,!0),s.elements.states[e].removeClassName(y.CSS.ELEMENTS.GRAPH_STATE_CURR),e===o.state.toLowerCase()&&(s.elements.states[e].addClassName(y.CSS.ELEMENTS.GRAPH_STATE_CURR),s.elements.currentIndicator=t.createElement("span",{class:y.CSS.ELEMENTS.GRAPH_STATE_CURRENT_INDICATOR}),s.elements.currentIndicator.inject(s.elements.states[e])),null!=i&&""!==i){var n=y.STATES[e.toUpperCase()],r=i[n].stateUserName;s.getContent().getElementsByClassName(y.CSS.ELEMENTS.GRAPH_STATE_TEXT)[n].setText(r);s._statesTooltips[n].getBody();var a=I.lifecycle[e.toUpperCase()];if(null!=a&&""!==a){var l=I.replace(I.lifecycle[e.toUpperCase()],{stateDisplayName:r});s._statesTooltips[n].setBody(l)}}}),o.current&&o.current.from===l){void 0!==d&&s.elements.states[d.toLowerCase()].toggleClassName(y.CSS.ELEMENTS.GRAPH_STATE_CLICKABLE,!1),void 0!==u&&u!=y.STATES_ORDER[Object.keys(y.STATES_ORDER).length-2]&&s.elements.states[u.toLowerCase()].toggleClassName(y.CSS.ELEMENTS.GRAPH_STATE_CLICKABLE,!1);var m=C.getUserName();if(s.routes.every(function(e){return-1!==e.current.reviewers.map(function(e){return e.user}).indexOf(m)}))s.routes.some(function(e){return-1===e.current.decisions.filter(function(e){return"approved"===e.status||"rejected"===e.status}).map(function(e){return e.reviewer.user}).indexOf(m)})?s._renderApproveRejectButtons(s.routes):s._renderInProgressIndicator(s.routes);else s._renderInProgressIndicator(s.routes)}else void 0!==d&&(s.elements.states[d.toLowerCase()].toggleClassName(y.CSS.ELEMENTS.GRAPH_STATE_CLICKABLE,!0),s.elements.states[y.STATES_VALUES.CLOSED.toLowerCase()].toggleClassName(y.CSS.ELEMENTS.GRAPH_STATE_CLICKABLE,!0)),void 0!==u&&u!=y.STATES_ORDER[Object.keys(y.STATES_ORDER).length-2]&&s.elements.states[u.toLowerCase()].toggleClassName(y.CSS.ELEMENTS.GRAPH_STATE_CLICKABLE,!0)}else s.container.addClassName(y.CSS.ELEMENTS.GRAPH_NOT_SUPPORTED);1===s.routes.length&&s._renderRoutesHistory(s.routes[0])}else s.container.addClassName(y.CSS.ELEMENTS.GRAPH_NOT_SUPPORTED)}).then(function(){s.resize(),s.dispatchEvent("onReady")})})},resize:function(){var e=this;if(Array.isArray(e.routes)&&0!==e.routes.length){var s=Object.keys(e.elements.states),n=e.routes[0].state.toLowerCase(),i=y.STATES[n.toUpperCase()],r=e.container.offsetWidth,o=Math.floor(r/140);if(o=o>s.length?5:o,s.forEach(function(t){e.elements.states[t].hide(),void 0!==e.elements.routesContainer[t]&&null!==e.elements.routesContainer[t]&&e.elements.routesContainer[t].hide()}),e.elements.states[n].show(),void 0!==e.elements.routesContainer[n]&&null!==e.elements.routesContainer[n]&&e.elements.routesContainer[n].show(),"closed"===n){var l=i-1,c=y.STATES_ORDER[l].toLowerCase();e.elements.states[c].show(),void 0!==e.elements.routesContainer[c]&&null!==e.elements.routesContainer[c]&&e.elements.routesContainer[c].show()}else{var d=i+1,u=y.STATES_ORDER[d].toLowerCase();e.elements.states[u].show()}if(o>=2)for(var m="closed"===n?i-1:i,p=0;p<o-2;p++){var f=m-p-1;if(f>=0){var h=y.STATES_ORDER[f].toLowerCase();e.elements.states[h].show(),void 0!==e.elements.routesContainer[h]&&null!==e.elements.routesContainer[h]&&e.elements.routesContainer[h].show()}else{f=p+2;var g=y.STATES_ORDER[f].toLowerCase();e.elements.states[g].show();var b=y.STATES_ORDER[f-1].toLowerCase();void 0!==e.elements.routesContainer[b]&&null!==e.elements.routesContainer[b]&&e.elements.routesContainer[b].show()}}var C=(r-100*o)/(o-1);Object.keys(e.elements.routesContainer).forEach(function(s){if(e.elements.routesContainer[s].setStyle("width",C),void 0!==e.elements.routesIndicators&&null!==e.elements.routesIndicators)if(null!==e.elements.routesIndicators[s].last&&e.elements.routesIndicators[s].last.element.show(),Array.isArray(e.elements.routesIndicators[s].nonLast)&&1===e.elements.routesIndicators[s].nonLast.length)e.elements.routesIndicators[s].nonLast[0].element.show(),e.elements.routesIndicators[s].more.element.hide();else if(e.elements.routesIndicators[s].nonLast.length>1){var n=Math.floor(C/26)-1,i=0;e.elements.routesIndicators[s].nonLast.forEach(function(t,r){i<n?i===n-1&&r<e.elements.routesIndicators[s].nonLast.length-1?(t.element.hide(),i+=1):(t.element.show(),i+=1):t.element.hide()});var r=e.elements.routesIndicators[s].nonLast.filter(function(e){return e.element.isHidden()});if(r.length>0){if(e.elements.routesIndicators[s].more.element.show(),null!==e.elements.routesIndicators[s].more.tooltip)try{e.elements.routesIndicators[s].more.tooltip.destroy()}catch(e){}for(var o=t.createElement("div",{class:y.CSS.ELEMENTS.GRAPH_HISTORY_TOOLTIP,html:'<span class="'+y.CSS.ELEMENTS.GRAPH_HISTORY_TOOLTIP_TITLE+'">'+I.replace(I.lifecycle.routeIndicatorTooltip.moreTooltip.title,{number:r.length})+"</span>"}),l=r.length-1;l>=0;l--){var c=r[l].data.date,d="approved"===r[l].data.status?"approvalText":"rejectionText";t.createElement("div",{html:"<span>"+I.replace(I.lifecycle.routeIndicatorTooltip.moreTooltip[d],{date:new Date(c).toLocaleString(v.get("widget").lang)})+"</span>"}).inject(o)}e.elements.routesIndicators[s].more.tooltip=new a({position:"bottom",target:e.elements.routesIndicators[s].more.element,body:o})}else if(e.elements.routesIndicators[s].more.element.hide(),null!==e.elements.routesIndicators[s].more.tooltip)try{e.elements.routesIndicators[s].more.tooltip.destroy()}catch(e){}}});var E=e.elements.states[n].offsetLeft;e.elements.ariadneRope.setStyles({width:E+"px"})}},reset:function(){var e=this;e.container.removeClassName(y.CSS.ELEMENTS.GRAPH_NOT_SUPPORTED),Object.keys(e.elements.states).forEach(function(t){t!==y.STATES_VALUES.CLOSED.toLowerCase()?e.elements.states[t].toggleClassName(y.CSS.ELEMENTS.GRAPH_STATE_CLICKABLE,!1):e.elements.states[t].toggleClassName(y.CSS.ELEMENTS.GRAPH_STATE_CLICKABLE,!0),e.elements.states[t].removeClassName(y.CSS.ELEMENTS.GRAPH_STATE_CURR),e.elements.states[t].removeClassName(y.CSS.ELEMENTS.GRAPH_STATE_REQUIRES_APPROVAL),void 0!==e.elements.routesContainer[t]&&e.elements.routesContainer[t].empty()}),e.elements.currentIndicator&&e.elements.currentIndicator.destroy(),e.elements.approve&&e.elements.approve.destroy(),e.elements.reject&&e.elements.reject.destroy(),e.elements.inProgressIndicator&&e.elements.inProgressIndicator.destroy();try{e._tooltips.forEach(function(e){e.destroy()})}catch(e){}e._tooltips=[],e._isProcessing=!1},destroy:function(){this.reset();try{this._statesTooltips.forEach(function(e){e.destroy()})}catch(e){}this._statesTooltips=[]},_onStateClick:function(e){var s=this;if(!s._isProcessing){var n=null;if(e.target.hasClassName(y.CSS.ELEMENTS.GRAPH_STATE)?n=e.target:e.target.getParent().hasClassName(y.CSS.ELEMENTS.GRAPH_STATE)&&(n=e.target.getParent()),null!==n&&n.hasClassName(y.CSS.ELEMENTS.GRAPH_STATE_CLICKABLE)){var i=s.routes[0].state.toLowerCase(),r=n.getData("state"),a=y.STATES[r.toUpperCase()]-y.STATES[i.toUpperCase()];if(1===a||-1===a){s._isProcessing=!0,f.Mask.mask(s.container);var o=1===a?"promote":"demote",l=s.routes.map(function(e){return{physicalId:e.physicalId,state:y.STATES_VALUES[r.toUpperCase()]}});b.issues[o]({data:{objects:l}}).then(function(){1===a?s.dispatchEvent("onPromotionCompleted",{issues:l}):s.dispatchEvent("onDemotionCompleted",{issues:l})}).catch(function(e){var n=I.lifecycle.error,i="";if(e&&e.error&&t.is(e.error.message,"string")&&(i=e.error.message),i.includes("Action Taken and Resolution Statement are not filled in")){n=f.getErrorMessage("5");f.displayErrorMessage(n,"error")}else if(i.includes("Action Taken field is not filled in")){n=f.getErrorMessage("6");f.displayErrorMessage(n,"error")}else if(i.includes("Resolution Statement field is not filled in")){n=f.getErrorMessage("7");f.displayErrorMessage(n,"error")}else if(i.includes("Resolution Date is not filled in")){n=f.getErrorMessage("8");f.displayErrorMessage(n,"error")}else if(i.includes("User does not have necessary privileges or selected object is not in correct maturity state for this operation.")){var r=f.getErrorMessage("1005_1");f.displayErrorMessage(r,"error")}else if(e.error&&e.error.internal&&(e.error.internal.includes("Message:No privilege for operation Severity:2 ErrorCode:1500019")||e.error.internal.includes("User does not have necessary privileges"))){r=f.getErrorMessage("1005");f.displayErrorMessage(r,"error")}else if(e.error&&e.error.internal&&e.error.internal.includes("You need at least one assignee to promote or demote this issue, as a validation process is attached to the issue for assignees")){r=f.getErrorMessage("1004");f.displayErrorMessage(r,"error")}else if(e.error&&e.error.internal&&e.error.internal.includes("Issue object cannot be demoted, as atleast one Resolving Item connected to Issue has Passed IN Work state.")){r=f.getErrorMessage("9");f.displayErrorMessage(r,"error")}else if(e.error&&e.error.internal&&e.error.internal.includes("Issue object cannot be promoted, as atleast one Resolving Item connected to Issue is not Completed.")){r=f.getErrorMessage("13");f.displayErrorMessage(r,"error")}else e&&e.error&&t.is(e.error.message,"string")&&(n=e.error.message,c.displayNotification({msg:n,eventID:"error"}));s._logger.error(e)}).finally(function(){s.refresh(s.physicalIds).then(function(){f.Mask.unmask(s.container),s._isProcessing=!1})})}else if(r===y.STATES_VALUES.CLOSED.toLowerCase()&&1!==a){var d=s.routes.map(function(e){return e.physicalId});new g({physicalIds:d}).render()}else c.displayNotification({msg:I.replace(a>0?I.kanban.dnd.unsupportedPromote:I.kanban.dnd.unsupportedDemote,{currState:i,state:r}),eventID:"error"}),s._logger.error(new Error("Unexpected or unsupported promotion/demotion."))}}},_approveRoutes:function(e,t,s){var n=this,i=e.map(function(e){return e.physicalId});return f.Mask.mask(n.container),n._connectAttachments(i,s).then(function(){return b.routes.approve({data:{objects:e.map(function(e){return{physicalId:e.physicalId,comment:t}})}}).then(function(e){var t=e.results.map(function(e){return{physicalId:e.body.physicalId,task:e.body.task}});n.dispatchEvent("onApprovalCompleted",{issues:t,modifiedAttributes:["attachments"]})})}).finally(function(){n.refresh(n.physicalIds).then(function(){f.Mask.unmask(n.container)})})},_rejectRoutes:function(e,t,s){var n=this,i=e.map(function(e){return e.physicalId});return f.Mask.mask(n.container),n._connectAttachments(i,s).then(function(){return b.routes.reject({data:{objects:e.map(function(e){return{physicalId:e.physicalId,reason:t}})}}).then(function(e){var t=e.results.map(function(e){return{physicalId:e.body.physicalId,task:e.body.task}});n.dispatchEvent("onRejectionCompleted",{issues:t,modifiedAttributes:["attachments"]})})}).finally(function(){n.refresh(n.physicalIds).then(function(){f.Mask.unmask(n.container)})})},_connectAttachments:function(e,t){var n=this,i=v.get("widget")||window.widget,r=t.collection,a=r.filter(function(e){return!0===e.get("isFile")}).map(function(e){var t=e.clone();return t.set("isProcessing",!0),t}),o=[];if(a.length>0){var l=new d({id:"uploadAttachmentsToRoutes",attachments:a});new m({container:i.body,collection:l}).render(),o=a.map(function(e){var t=u.uploadFile(e.get("file"),null,{onCheckinStart:function(e){this.set("isCancelable",!0),this.set("request",e)}.bind(e),onCheckinProgress:function(e){if(e.lengthComputable){var t=e.loaded/e.total;this.set("requestProgress",t)}}.bind(e),onCheckinComplete:function(){this.set("isCancelable",!1),this.set("request",null)}.bind(e)});return t=t.then(function(t){t&&t.data&&t.data.length>0&&t.data[0].id&&(r.get(e.id).set("isFile",!1),r.get(e.id).set("id",t.data[0].id),e.set("id",t.data[0].id),e.set("isFile",!1),e.set("isProcessing",!1))}).catch(function(t){e.set("isFailed",!0),e.set("isProcessing",!1),e.set("isCancelable",!1),e.set("request",null),t instanceof Error&&(c.displayNotification({msg:p.replace(p.notifications.Upload.failure,{count:1}),eventID:"error"}),n._logger.error(t))})})}return s.all(o).then(function(){var t=r.filter(function(e){return!0!==e.get("isFile")}).map(function(e){return e.clone()}),i=[];return t.length>0&&e.forEach(function(e){var s=t.map(function(e){return e.id});i.push(u.connectDocumentsToParent(s,e).catch(function(e){c.displayNotification({msg:p.replace(p.notifications.Attach.failure,{count:1}),eventID:"error"}),n._logger.error(e)}))}),s.all(i)}).then(function(){var t=[],i=r.filter(function(e){return!0===e.get("isPrimary")});if(1===i.length){var a=i[0];return e.forEach(function(e){t.push(u.setAsPrimary(a.get("id"),e,!0).then(function(){}).catch(function(e){c.displayNotification({msg:p.notifications.SetAsPrimary.failure,eventID:"error"}),n._logger.error(e)}))}),s.all(t)}return s.resolve()})}})}),define("DS/IssueComponents/team/MembersGridUtil",["i18n!DS/IssueComponents/assets/nls/IssueComponents","DS/IssueComponents/team/MembersDataGridViewToolbar"],function(e,t){"use strict";var s=Object.create(null);return s.getColumns=function(){return[{dataIndex:"propagate",visibleFlag:!1,width:35,allowUnsafeHTMLContent:!0,icon:"propagate",sortableFlag:!1},{text:e.team.columns.title,dataIndex:"tree",editableFlag:!1,alwaysVisibleFlag:!0,allowUnsafeHTMLContent:!0,width:"200",getCellGroupingKey:function(e){return e.nodeModel.options.grid.fullName}},{text:e.team.columns.name,dataIndex:"username",editableFlag:!1},{text:e.team.columns.memberof,dataIndex:"memberof",editableFlag:!1,visibleFlag:!1}]},s.changeView=function(s){if("GridView"==s){this.currentView="Grid",widget.setValue("membersView","GridView");var n=t.toolbar.getNodeModelByID("view");n&&"view-list"!=n.options.grid.semantics.icon.iconName&&n.updateOptions({grid:{semantics:{icon:{iconName:"view-list"}}},tooltip:e.team.toolbar.gridView});var i=document.querySelector(".toolbar-member-grid-div .wux-ui-3ds-view-list");i&&i.addClassName("currentView");var r=document.querySelector(".toolbar-member-grid-div .wux-ui-3ds-view-small-tile");r&&r.removeClassName("currentView");var a=document.querySelector(".iss-member-grid-div");a&&(a.removeClassName("hideView"),a.removeClassName("nonVisible"),a.addClassName("showView"));var o=document.querySelector(".membertileView");o&&(o.removeClassName("showView"),o.addClassName("hideView"))}},s.getRoleNLSValue=function(t){let s="";switch(t){case"Owner":s=e.team.owner.label;break;case"Co-owner":s=e.team.coOwners.label;break;case"Assignee":s=e.team.assignees.label;break;case"Contributor":s=e.team.contributors.label;break;case"InformedUser":s=e.team.informedUsers.label;break;default:console.log("NLS is not defined for : "+t)}return s},s.removeRole=function(e,t){let s=","+t,n=", "+t,i=t+",",r=t+" ,";return e.includes(s)?e=e.replace(s,""):e.includes(n)?e=e.replace(n,""):e.includes(i)?e=e.replace(i,""):e.includes(r)&&(e=e.replace(r,"")),e},s}),define("DS/IssueComponents/search/PeopleSearch",["DS/PADUtils/views/PADAlert","DS/SearchWidget/controllers/SW_FullPos_Controller","DS/IssueComponents/search/PeopleSearchUI","DS/IssueServices/services/PlatformServices","i18n!DS/IssueComponents/assets/nls/IssueComponents"],function(e,t,s,n,i){"use strict";return t.extend({init:function(e){var t=this;t._parent(e);var n=e.events;null===n&&(n={}),n.onExpressSearch=function(){t.expressSearch()},e.events=n,t.searchWidgetUI.destroy(),t.searchWidgetUI=t.container=new s(e)},expressSearch:function(){var t=this,s=[],r="",a=function(){if(s.length>0){var n=Object.assign({},s);t.dispatchEvent("onValidUsers",n)}r.length>0&&(r=(r=r.trim()).replace(/.$/,""),e.displayNotification({msg:i.replace(i.search.error.usersNotFound,{users:r}),eventID:"error"}))},o=t.searchWidgetUI.searchInput.getValue().trim(),l=0,c=o.split(";");(c=c.filter(function(e){return""!==e})).length>0&&c.forEach(function(e){e=e.trim(),n.getUserInfo(e,{onComplete:function(e){l+=1;var t=JSON.parse(e);s.push(t),l===c.length&&a()},onFailure:function(){r=r+e+", ",(l+=1)===c.length&&a()}})})}})}),define("DS/IssueComponents/team/Team",["UWA/Class/Promise","UWA/Class/View","UWA/Core","DS/UIKIT/Iconbar","DS/UIKIT/Input/Button","DS/UIKIT/Input/Text","DS/UIKIT/Mask","DS/UIKIT/Scroller","DS/UIKIT/Tooltip","DS/Controls/TooltipModel","DS/ENOFloatingPanel/ENOFloatingPanel","DS/Logger/Logger","DS/PADUtils/views/PADAlert","DS/SearchWidget/SearchWidgetConstant","DS/IssueCommon/commands/CommandsManager","DS/IssueComponents/search/PeopleSearch","DS/IssueServices/services/IssueServices","DS/IssueServices/services/PlatformServices","DS/IssueServices/Contexts","DS/IssueServices/utils/Performance","DS/IssueCommon/utils/Utils","i18n!DS/IssueComponents/assets/nls/IssueComponents","css!DS/IssueComponents/IssueComponents.css"],function(e,t,s,n,i,r,a,o,l,c,d,u,m,p,f,h,g,v,b,C,E,I){"use strict";return t.extend({})}),define("DS/IssueComponents/team/MembersDataGridModel",["UWA/Class/Model","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/IssueComponents/team/MembersGridUtil","DS/IssueServices/services/IssueServices","i18n!DS/IssueComponents/assets/nls/IssueComponents","DS/IssueServices/services/PlatformServices","DS/IssueCommon/utils/Utils","DS/PADUtils/views/PADAlert","DS/UIKIT/Mask"],function(e,t,s,n,i,r,a,o,l,c){"use strict";var d=e.extend({init:function(e){this.contextID=e},setTreeDocument:function(e){this.treeDocument=e},getTreeDocument:function(){return this.treeDocument},createTreeDocument:function(){var e=new t({useAsyncPreExpand:!0,id:"issMembers",shouldBeSelected:function(e){return 1!=e.options.grid.isRoot}});return this.setTreeDocument(e),e},loadMembersData:function(e,t,n,i,a,o){e.prepareUpdate(),this.owner=new s({label:r.team.owner.title+" (0)",icons:[{iconName:"user"}],grid:{isRoot:!0,role:"Owner"}}),this.coowners=new s({label:r.team.coOwners.title+" (0)",icons:[{iconName:"user"}],grid:{isRoot:!0,role:"Co-owner"}}),this.assignees=new s({label:r.team.assignees.title+" (0)",icons:[{iconName:"user"}],grid:{isRoot:!0,role:"Assignee"}}),this.contributors=new s({label:r.team.contributors.title+" (0)",icons:[{iconName:"user"}],grid:{isRoot:!0,role:"Contributor"}}),this.informedUsers=new s({label:r.team.informedUsers.title+" (0)",icons:[{iconName:"user"}],grid:{isRoot:!0,role:"InformedUser"}}),e.addRoot(this.owner),e.addRoot(this.coowners),e.addRoot(this.assignees),e.addRoot(this.contributors),e.addRoot(this.informedUsers);var l=this.createTreeDocumentNodeModel(t,"owner");this.owner.addChild(l),this.owner.setLabel(r.team.owner.title+" ("+l.length+")"),this.owner.expandAll(),l=this.createTreeDocumentNodeModel(n,"coowners"),this.coowners.addChild(l),this.coowners.setLabel(r.team.coOwners.title+" ("+l.length+")"),this.coowners.expandAll(),l=this.createTreeDocumentNodeModel(i,"assignees"),this.assignees.addChild(l),this.assignees.setLabel(r.team.assignees.title+" ("+l.length+")"),this.assignees.expandAll(),l=this.createTreeDocumentNodeModel(a,"contributors"),this.contributors.addChild(l),this.contributors.setLabel(r.team.contributors.title+" ("+l.length+")"),this.contributors.expandAll(),l=this.createTreeDocumentNodeModel(o,"informedUsers"),this.informedUsers.addChild(l),this.informedUsers.setLabel(r.team.informedUsers.title+" ("+l.length+")"),this.informedUsers.expandAll(),e.pushUpdate();var d=document.getElementById("iss-outer-member-grid-div");d&&c.isMasked(d)&&c.unmask(d)},createTreeDocumentNodeModel:function(e,t){var s=[];for(var n in e){var i=this.createTreeNode(e[n],t);s.push(i)}return s},createTreeDocumentNodeModelForNewMember:function(e,t){for(var s=[],n=0;n<e.length;n++){var i=this.createTreeNode(e[n],t);s.push(i)}return s},createTreeNode:function(e,t){e.username=e.user,e.root=t,e.role="",e.roleList="";for(var i=0;i<e.roles.length;i++){var r=e.roles[i],o=n.getRoleNLSValue(r);e.role+=r,e.roleList+=o,i!=e.roles.length-1&&(e.role+=",",e.roleList+=", ")}var l=e.roleList;a.get3DSpaceUrl();return"group"===e.type&&(e.username=""),new s({subLabel:"",description:l,grid:e})},createCustomPersonNameField:function(e){var t="";t="person"===e.type?e.fullName+" ("+e.user+")":e.fullName;var s=new UWA.Element("div",{class:"members "+e.root,title:t}),n="";(n="group"===e.type?UWA.createElement("span",{class:"user-group wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-users-group"}):this.getPersonImageDiv(e)).addClassName("assignee");var i=UWA.createElement("span",{class:"userName",html:e.fullName});return n.inject(s),i.inject(s),s},getPersonImageDiv:function(e,t){var s="/api/user/getpicture/login/"+e.user+"/format/normal",n=a.get3DSwymUrl(),i=new UWA.Element("div",{}),r="";if(""!==n)(r=UWA.createElement("img",{class:"userIcon",src:n+s})).addEventListener("click",function(){a.getUserProfile(e.user)});else{var o=a.getAvatarDetails(e.fullName);r=UWA.createElement("div",{html:o.avatarStr}),1==t?(r.addClassName("member-profile-picture"),r.addClassName("member-profile-text")):r.addClassName("avatarIcon"),r.style.setProperty("background",o.avatarColor)}return r.inject(i),i},addNodesInLayoutModel:function(e,t,s){var n=d.prototype.createTreeDocumentNodeModelForNewMember(t,s);e.prepareUpdate(),"coowners"===s?(this.coowners.addChild(n),this.coowners.setLabel(r.team.coOwners.title+" ("+this.coowners.getNumberOfChildren()+")")):"assignees"===s?(this.assignees.addChild(n),this.assignees.setLabel(r.team.assignees.title+" ("+this.assignees.getNumberOfChildren()+")")):"contributors"===s?(this.contributors.addChild(n),this.contributors.setLabel(r.team.contributors.title+" ("+this.contributors.getNumberOfChildren()+")")):"informedUsers"===s&&(this.informedUsers.addChild(n),this.informedUsers.setLabel(r.team.informedUsers.title+" ("+this.informedUsers.getNumberOfChildren()+")")),this.coowners.expandAll(),this.assignees.expandAll(),this.contributors.expandAll(),this.informedUsers.expandAll(),e.pushUpdate()},removeChildren:function(){var e=this,t=(e.contextID,document.getElementById("iss-outer-member-grid-div"));c.mask(t);var s=e.treeDocument.getSelectedNodes();if(0!=s.length){for(var n=[],a=[],d=[],u=[],m=0;m<s.length;m++){let e=s[m].options.grid;var p=e.roles;p.includes("Co-owner")&&d.push({user:e.user}),p.includes("Assignee")&&a.push({user:e.user,type:e.type}),p.includes("Contributor")&&n.push({user:e.user}),p.includes("InformedUser")&&u.push({user:e.user})}(d.length>0||a.length>0||n.length>0||u.length>0)&&require(["DS/IssueComponents/team/MembersDataGridLayout"],function(m){for(var p=[],f=0;f<m.issues.length;f++){var h={physicalId:m.issues[f].id};d.length>0&&(h.coOwners=d),a.length>0&&(h.assignees=a),n.length>0&&(h.contributors=n),u.length>0&&(h.informedUsers=u),p.push(h)}i.people.delete({data:{objects:p}}).then(function(){for(var n=!1,i=0;i<s.length;i++){var a=s[i].options.grid.roles,o=a.indexOf("Owner")>=0,d=a.indexOf("Co-owner")>=0,u=a.indexOf("Assignee")>=0,p=a.indexOf("Contributor")>=0,f=a.indexOf("InformedUser")>=0,h=s[i].options.grid.user;if(o&&(n=!0),d){var g=e.coowners.getAllDescendants().filter(e=>e.options.grid.user==h);g.length>0&&(g[0].remove(),a=a.filter(function(e){return"Co-owner"!=e}),s[i].options.grid.roles=a,e.coowners.setLabel(r.team.coOwners.title+" ("+e.coowners.getNumberOfChildren()+")"))}if(u){var v=e.assignees.getAllDescendants().filter(e=>e.options.grid.user==h);v.length>0&&(v[0].remove(),a=a.filter(function(e){return"Assignee"!=e}),s[i].options.grid.roles=a,e.assignees.setLabel(r.team.assignees.title+" ("+e.assignees.getNumberOfChildren()+")"))}if(p){var b=e.contributors.getAllDescendants().filter(e=>e.options.grid.user==h);b.length>0&&(b[0].remove(),a=a.filter(function(e){return"Contributor"!=e}),s[i].options.grid.roles=a,e.contributors.setLabel(r.team.contributors.title+" ("+e.contributors.getNumberOfChildren()+")"))}if(f){var C=e.informedUsers.getAllDescendants().filter(e=>e.options.grid.user==h);C.length>0&&(C[0].remove(),a=a.filter(function(e){return"InformedUser"!=e}),s[i].options.grid.roles=a,e.informedUsers.setLabel(r.team.informedUsers.title+" ("+e.informedUsers.getNumberOfChildren()+")"))}}n&&(e.owner.getAllDescendants()[0].options.grid.roles=["Owner"],l.displayNotification({msg:r.team.error.skipRemoveOwner,eventID:"info"}));m.view.dispatchEvent("onUpdate",{issues:m.issues}),c.unmask(t)}).catch(function(e){if(c.unmask(t),e.error.message.includes("'business object' does not exist")){var s=o.getErrorMessage("0");o.displayErrorMessage(s,"error")}else if(UWA.is(e.error.internal)&&(e.error.internal.includes("No 'modify' access on Attribute 'Co-Owners' for")||e.error.internal.includes("No 'read' access on Attribute 'Co-Owners' for")||e.error.internal.includes("You do not have the permissions to perform this action"))){s=o.getErrorMessage("1");o.displayErrorMessage(s,"error")}else l.displayNotification({msg:e.error.message,eventID:"error"})})})}}});return d}),define("DS/IssueComponents/create/CustomNew",["UWA/Class/Promise","UWA/Class/View","UWA/Core","DS/IssueComponents/create/Form","DS/Controls/DatePicker","DS/Controls/LineEditor","DS/Controls/Editor","DS/Controls/ComboBox","DS/Controls/SpinBox","DS/Controls/Toggle","DS/WUXAutoComplete/AutoComplete","DS/Tree/TreeDocument","DS/Tree/TreeNodeModel","DS/IssueServices/services/IssueServices","i18n!DS/IssueComponents/assets/nls/IssueComponents","css!DS/IssueComponents/IssueComponents.css"],function(e,t,s,n,i,r,a,o,l,c,d,u,m,p,f){"use strict";var h={READ_ONLY:"ReadOnly",NONE:"None"},g={MEMO:"textarea",DATE:"timestamp",TEXT:"string",INT:"integer",REAL:"real",BOOL:"boolean"},v="TRUE";return t.extend({name:"DS/IssueComponents/create/Custom",tag:"div",className:"create-view-content-subview create-custom",isInit:null,_deferredInit:{resolve:null,reject:null},setup:function(t){var s=this;s._parent(t),s.parent=t.parent,s.isInit=new e(function(e,t){s._deferredInit.resolve=e,s._deferredInit.reject=t}),s.formElements={},s.formElementsToggler={},s.fields={},s.requiredLabels={},s.noShow=!0;let n={};var i=[];s._customProperties=[],new e(function(t,r){i.push(p.custom.getCustomAttributes(n)),i.push(p.type.getProperties("Issue")),e.all(i).then(e=>{var n={};e.length>1&&void 0!==e[1]&&(Array.isArray(e[1].classPredicates)&&e[1].classPredicates.length>0&&e[1].classPredicates[0].vocabularyPredicateInfo.forEach(e=>{e.userAccess&&(n[e.name]=e.nlsName)}));e.length&&Array.isArray(e[0].body)&&e[0].body.length&&(e[0].body.forEach(e=>{n[e.name]&&(e.title=n[e.name])}),s._customProperties=e[0].body,s.noShow=!1),t()})}).then(s._deferredInit.resolve).catch(s._deferredInit.reject)},destroy:function(){var e=this;e.form=null,Object.keys(e.fields).forEach(function(t){e.fields[t]=null,e.parent.formElements[t]=null,e.parent.formElementsToggler[t]=null})},render:function(){var e=this;e.form=new n({className:"create-properties-form",fields:[],events:{onInvalid:function(){}}}).inject(e.container),e.form.getContent().setAttribute("novalidate",!1);var t=s.createElement("div",{class:"create-form-content"}),i=[],r=[];return e._customProperties.forEach(function(t,s){var n=[];if(""!==t.range){var a=t.NLSRange.split(",");t.range.split(",").forEach(function(e,t){n.push({labelItem:a[t],valueItem:e})})}t.type==g.DATE&&""==t.defaults&&(t.defaults=void 0);var o={};if(o.index=s,o.element=t.name,o.value=t.defaults,o.required="Yes"===t.mandatory,o.placeholder=e.getPlaceholder(t),o.help=e.getHelper(t),o.type=t.type,o.label=e.getLabel(t),o.rangeItems=n,o.UIAccess=t.UIAccess,o.requiredText=f.create.required,o.selectedIndex=-1,o.MultiValuated=t.valuetype,o.type!==g.INT&&o.type!==g.REAL||o.rangeItems.sort(function(e,t){return e.valueItem-t.valueItem}),o.rangeItems.length>0&&o.rangeItems.forEach(function(e,t){o.value===e&&(o.selectedIndex=t)}),h.NONE!=t.UIAccess&&h.READ_ONLY!=t.UIAccess){var l=e.createFormElement(o);o.required?i.push(l):r.push(l)}}),i.forEach(function(e){e.inject(t)}),r.forEach(function(e){e.inject(t)}),t.inject(e.form.elements.container),e},createFormElement:function(e){var t="create-form-element create-properties-form-element-"+e.element,n=this.parent.formElements[e.element]=s.createElement("div",{class:t});this.parent.parent.isTemplate&&!e.required&&this.createVisibilityMask(e).inject(n);return this.createFormGroup(e).inject(n),n},createFormGroup:function(e){var t=s.createElement("div",{class:"create-form-field form-group"});return(e.required?this.createRequiredLabel(e):this.createLabel(e)).inject(t),this.createFormField(e).inject(t),t},createVisibilityMask:function(e){return s.createElement("div",{html:[{tag:"div",class:"create-form-visibility-mask"},{tag:"div",class:"create-form-visibility-toggle",html:[this.parent.formElementsToggler[e.element]=s.createElement("span",{class:"fonticon fonticon-eye"})]}]})},createRequiredLabel:function(e){e.element;var t="required-form-field-title-label"+(this.parent.parent.isTemplate?"":" highlight"),n="required-form-field-required-label"+(this.parent.parent.isTemplate?"":" highlight");return this.requiredLabels[e.element]=s.createElement("h5",{class:"required-form-field",html:[s.createElement("span",{class:t,html:e.label}),s.createElement("span",{class:n,html:e.requiredText})]})},createLabel:function(e){e.element;return s.createElement("h5",{class:"create-form-field-label",html:e.label})},createFormField:function(e){var t=this,n=s.createElement("div",{name:e.name,id:e.id}),i=null;if(e.rangeItems.length>0&&e.type!==g.BOOL)i=t.createComboBox(e);else switch(e.type){case g.TEXT:case g.MEMO:if(s.is(e.MultiValuated)&&"multival"==e.MultiValuated)(i=t.createComboBox(e)).allowFreeInputFlag=!0;else(i=t.createTextField(e)).getContent().querySelectorAll("input, div").forEach(function(e){e.style.width="100%",e.style.fontSize="medium"});break;case g.DATE:(i=t.createDateField(e)).getContent().querySelectorAll("input").forEach(function(e){e.style.fontSize="medium"});break;case g.BOOL:i=t.createBooleanField(e);break;case g.INT:case g.REAL:if(s.is(e.MultiValuated)&&"multival"==e.MultiValuated){var r="";e.type===g.INT?r="[0-9]+":e.type===g.REAL&&(r="[0-9]+|([0-9]+.[0-9]+)"),(i=t.createComboBox(e)).allowFreeInputFlag=!0,i._editor.pattern=r}else i=t.createNumberField(e),t.fields[e.element].getContent().style.height="auto",i.getContent().style.width="100%",i.getContent().querySelectorAll("input").forEach(function(e){e.style.fontSize="medium"})}return i.getContent().addEventListener("change",function(){switch(e.type){case g.TEXT:case g.MEMO:t._customProperties[e.index].value=t.fields[e.element].value;break;case g.DATE:var s=t.fields[e.element].value;t._customProperties[e.index].value=s.getMonth()+1+"/"+s.getDate()+"/"+s.getFullYear();break;case g.BOOL:t._customProperties[e.index].value=t.fields[e.element].checkFlag?"true":"false";break;case g.INT:case g.REAL:var n=t.fields[e.element].value,i=t._customProperties[e.index].valuetype;t._customProperties[e.index].value=null!=n&&""!==n&&"singleval"==i?n.toString():n}}),i.inject(n),n},createTextField:function(e){var t=null;return"string"===e.type?(t=this.fields[e.element]=new r({value:e.value,requiredFlag:e.required&&!this.parent.parent.isTemplate,placeholder:e.placeholder})).getContent().setStyle("width","100%"):(t=this.fields[e.element]=new a({value:e.value,nbRows:4,requiredFlag:e.required&&!this.parent.parent.isTemplate,placeholder:e.placeholder,newLineMode:"enter"})).getContent().setStyle("width","100%"),t},createDateField:function(e){return this.fields[e.element]=new i({value:e.value,minValue:e.minValue,maxValue:e.maxValue})},createNumberField:function(e){var t="integer"===e.type?parseInt(e.value):parseFloat(e.value);return this.fields[e.element]=new l({value:t,stepValue:"integer"===e.type?1:.1,maxValue:"integer"===e.type?2147483646:999999999999999})},createComboBox:function(e){var t=e.rangeItems,n=function(){var e=new u;e.prepareUpdate();for(var s=0;s<t.length;s++){var n=t[s].labelItem,i=t[s].valueItem,r=new m({label:n,value:i});e.addRoot(r)}return e.pushUpdate(),e}(),i=!1;s.is(e.MultiValuated)&&"multival"==e.MultiValuated&&(i=!0);var r=[];t.length>0&&t.forEach(function(t,s){e.value===t.valueItem&&r.push(n.getRoots()[s])});var a=e.required,o=(e.placeholder,this.fields[e.element]=new d({elementsTree:n,multiSearchMode:i,selectedItems:r,allowFreeInputFlag:!1}));return(1==i||t.length>0)&&o.getContent().addEventListener("keydown",function(e){13==e.keyCode&&e.stopPropagation()}),o.requiredFlag=a,o},createBooleanField:function(e){var t=this.fields[e.element]=new c({type:"switch",checkFlag:e.value===v});return t.getContent().addEventListener("keydown",function(e){13==e.keyCode&&e.stopPropagation()}),t},show:function(){this._parent(),this.fields[this._customProperties[0].name]&&"focus"in this.fields[this._customProperties[0].name]&&this.fields[this._customProperties[0].name].focus()},hide:function(){this._parent()},validate:function(){return this.form.fields=Object.values(this.fields).filter(function(e){return null!==e}),this.form.validate(!1,!1)},getValues:function(){var e={custom:{}};return this._customProperties.forEach(function(t){t.range.length>0?""!=t.value&&(e.custom[t.path]=t.value):e.custom[t.path]=t.value}),e},getHiddenAttributes:function(){var e={custom:{}};for(var t in this.parent.formElements)s.is(this.parent.formElementsToggler[t])&&(e.custom[t]=this.parent.formElementsToggler[t].hasClassName("fonticon-eye-off"));return e},reset:function(){var e=this;e._customProperties.forEach(function(t){if(t.value=t.defaults,e.fields[t.name])switch(t.type){case g.TEXT:case g.MEMO:e.fields[t.name].value=t.defaults;break;case g.DATE:break;case g.BOOL:e.fields[t.name].checkFlag="true"===t.defaults;break;case g.INT:case g.REAL:e.fields[t.name].value=""===t.defaults?0:"integer"===t.type?parseInt(t.defaults):parseFloat(t.defaults)}})},applyTemplate:function(t){var n=this;if(n.reset(),s.is(t.data,"object")&&s.is(t.data.custom,"object")&&n._customProperties.forEach(function(e){if(s.is(t.data.custom[e.path],"string")){if(e.value=t.data.custom[e.path],n.fields[e.name])switch(e.type){case g.TEXT:case g.MEMO:case g.DATE:n.fields[e.name].value=e.value;break;case g.BOOL:n.fields[e.name].checkFlag="true"===e.value;break;case g.INT:case g.REAL:n.fields[e.name].value=""===e.value?0:"integer"===e.type?parseInt(e.value):parseFloat(e.value)}}else s.is(t.data.custom[e.path],"array")&&(e.value=[],e.value=t.data.custom[e.path],n.fields[e.name].value=e.value)}),s.is(t.hidden,"object")&&s.is(t.hidden.custom,"object")&&s.is(n.parent.formElements,"object")&&s.is(n.parent.formElementsToggler,"object")){var i=n.parent.formElements,r=n.parent.formElementsToggler;for(var a in i)!0===t.hidden.custom[a]&&(n.parent.parent.isTemplate?(s.is(i[a])&&i[a].toggleClassName("visibility-masked",!0),s.is(r[a])&&(r[a].toggleClassName("fonticon-eye-off",!0),r[a].toggleClassName("fonticon-eye",!1))):s.is(i[a])&&i[a].hide())}return e.resolve()},getLabel:function(e){var t="",s=f.create.properties.custom;if(void 0!==s){var n=s[e.name];void 0!==n&&(t=n.label)}return""!==t&&void 0!==t||(t=e.title),""!==t&&void 0!==t||(t=e.name),t},getPlaceholder:function(e){var t="",s=f.create.properties.custom;if(void 0!==s){var n=s[e.name];void 0!==n&&(t=n.placeholder)}return""!==t&&void 0!==t||(t=e.title),""!==t&&void 0!==t||(t=e.name),t},getHelper:function(e){var t="",s=f.create.properties.custom;if(void 0!==s){var n=s[e.name];void 0!==n&&(t=n.helper)}return""!==t&&void 0!==t||(t=e.title),""!==t&&void 0!==t||(t=e.name),t}})}),define("DS/IssueComponents/team/AddMembersLayout",["DS/IssueComponents/team/AddMembersView","DS/IssueComponents/team/MembersGridUtil","DS/IssueComponents/team/MembersMakeDroppable","DS/IssueComponents/team/MembersDataGridModel","DS/IssueServices/services/IssueServices","DS/IssueServices/services/PlatformServices","DS/IssueCommon/utils/Utils","DS/Controls/Button","DS/WUXAutoComplete/AutoComplete","DS/Tree/TreeDocument","DS/Tree/TreeNodeModel","DS/PADUtils/views/PADAlert","DS/UIKIT/Mask","i18n!DS/IssueComponents/assets/nls/IssueComponents"],function(e,t,s,n,i,r,a,o,l,c,d,u,m,p){"use strict";var f={createAddMemberPanel:function(t){f.teamlayoutModel=t.model,new e({events:{searchMember:function(e){var t='(flattenedtaxonomies:"types/Person" AND policycurrent:"Person.Active")';if("Assignee"===e||"InformedUser"===e){t+="OnPremise"===r.getTenant()?' OR (flattenedtaxonomies:"types/Group" AND current:"active")':" OR ([ds6w:type]:(Group))"}r.search({title:p.team.addMember[e.toLowerCase()],default_search_criteria:"",precond:t,multiSel:!0,callback:function(t){for(var s=[],n=0;n<t.length;n++)s.push({objectId:t[n].id,identifier:t[n]["ds6w:identifier"],objectType:t[n]["ds6w:type"],displayType:t[n]["ds6w:type_value"],displayName:t[n]["ds6w:label"],serviceId:t[n].sourceid});var i={data:{}};i.data.items=s,f.ExecuteDropForAddMemberPanel(i,e)},cancel:function(){}})}}}).render().inject(t.target);var n=t.target.querySelector(".iss-add-member-coowner-field"),a=t.target.querySelector(".iss-add-member-assignee-field"),u=t.target.querySelector(".iss-add-member-contributor-field"),m=t.target.querySelector(".iss-add-member-informedUser-field"),h=t.target.querySelector(".iss-add-member-button"),g=t.target.querySelector(".iss-add-member-coowner-field-container"),v=t.target.querySelector(".iss-add-member-assignee-field-container"),b=t.target.querySelector(".iss-add-member-contributor-field-container"),C=t.target.querySelector(".iss-add-member-informedUser-field-container");s.makeDroppable(g,f.ExecuteDropForCoownerField),s.makeDroppable(v,f.ExecuteDropForAssigneeField),s.makeDroppable(b,f.ExecuteDropForContributorField),s.makeDroppable(C,f.ExecuteDropForInformedUserField),f.addButton=new o({label:p.team.addMember.add,emphasize:"primary",disabled:!0}).inject(h),f.cancelButton=new o({label:p.team.addMember.cancel,emphasize:"secondary"}).inject(h),f.modelForCoowner=new c,f.modelForContributor=new c,f.modelForAssignee=new c,f.modelForInformedUser=new c,f.autoCompleteAssignee=new l({elementsTree:function(e){return new Promise(function(t,s){setTimeout(function(){f.modelForAssignee.empty(),i.getMembers({text:e}).then(function(e){f.modelForAssignee.prepareUpdate(),require(["DS/IssueComponents/team/MembersDataGridLayout"],function(s){let n={};s.issues;var i=s.membersDataGridModel.assignees.getChildren()?s.membersDataGridModel.assignees.getChildren():[];for(let e=0;e<i.length;e++){let t=i[e].options.grid;n[t.user]=t.role}for(var r=f.autoCompleteAssignee.selectedItems,a=0;a<e.length;a++){var o=e[a].identifier,l=[];if(r&&r.length>0&&(l=r.filter(t=>"person"===e[a].type.toLowerCase()?t.options.identifier===e[a].identifier:t.options.identifier===e[a].id)),!r||0==r.length||0==l.length)if("person"===e[a].type.toLowerCase()){var c=e[a].name+" ("+e[a].identifier.toUpperCase()+")";if(!n.hasOwnProperty(o)||!n[o].contains("Assignee")){var u=new d({label:c,value:e[a].identifier,name:e[a].name,identifier:e[a].identifier,type:e[a].type.toLowerCase()});f.modelForAssignee.addRoot(u)}}else if(!("group"!==e[a].type.toLowerCase()||n.hasOwnProperty(e[a].id)&&n[e[a].id].contains("Assignee"))){u=new d({label:e[a].name,value:e[a].identifier,name:e[a].name,identifier:e[a].id,type:e[a].type.toLowerCase()});f.modelForAssignee.addRoot(u)}}f.modelForAssignee.pushUpdate(),t(f.modelForAssignee)})},function(e){t(f.modelForAssignee)})},1e3)})},placeholder:p.team.addMember.typeToSearch,customFilterMessage:p.team.addMember.noSearchFound,multiSearchMode:!0,allowFreeInputFlag:!1,minLengthBeforeSearch:3,keepSearchResultsFlag:!1}).inject(a),f.autoCompleteCoowner=new l({elementsTree:function(e){return new Promise(function(t,s){setTimeout(function(){f.modelForCoowner.empty(),i.getMembers({text:e}).then(function(e){f.modelForCoowner.prepareUpdate(),require(["DS/IssueComponents/team/MembersDataGridLayout"],function(s){let n={};s.issues;var i=s.membersDataGridModel.coowners.getChildren()?s.membersDataGridModel.coowners.getChildren():[];for(let e=0;e<i.length;e++){let t=i[e].options.grid;n[t.user]=t.role}for(var r=f.autoCompleteCoowner.selectedItems,a=0;a<e.length;a++){var o=e[a].identifier,l=[];r&&r.length>0&&(l=r.filter(t=>t.options.identifier===e[a].identifier));var c=(s.membersDataGridModel.owner.getChildren()?s.membersDataGridModel.owner.getChildren():[]).filter(t=>t.options.grid.user===e[a].identifier);if((!r||0==r.length||0==l.length)&&0==c.length&&"person"===e[a].type.toLowerCase()){var u=e[a].name+" ("+e[a].identifier.toUpperCase()+")";if(!n.hasOwnProperty(o)||!n[o].contains("Co-owner")){var m=new d({label:u,value:e[a].identifier,name:e[a].name,identifier:e[a].identifier,type:e[a].type.toLowerCase()});f.modelForCoowner.addRoot(m)}}}f.modelForCoowner.pushUpdate(),t(f.modelForCoowner)})},function(e){t(f.modelForCoowner)})},1e3)})},placeholder:p.team.addMember.typeToSearch,customFilterMessage:p.team.addMember.noSearchFound,multiSearchMode:!0,allowFreeInputFlag:!1,minLengthBeforeSearch:3,keepSearchResultsFlag:!1}).inject(n),f.autoCompleteContributor=new l({elementsTree:function(e){return new Promise(function(t,s){setTimeout(function(){f.modelForContributor.empty(),i.getMembers({text:e}).then(function(e){f.modelForContributor.prepareUpdate(),require(["DS/IssueComponents/team/MembersDataGridLayout"],function(s){let n={};s.issues;var i=s.membersDataGridModel.contributors.getChildren()?s.membersDataGridModel.contributors.getChildren():[];for(let e=0;e<i.length;e++){let t=i[e].options.grid;n[t.user]=t.role}for(var r=f.autoCompleteContributor.selectedItems,a=0;a<e.length;a++){var o=e[a].identifier,l=[];if(r&&r.length>0&&(l=r.filter(t=>t.options.identifier===e[a].identifier)),(!r||0==r.length||0==l.length)&&"person"===e[a].type.toLowerCase()){var c=e[a].name+" ("+e[a].identifier.toUpperCase()+")";if(!n.hasOwnProperty(o)||!n[o].contains("Contributor")){var u=new d({label:c,value:e[a].identifier,name:e[a].name,identifier:e[a].identifier,type:e[a].type.toLowerCase()});f.modelForContributor.addRoot(u)}}}f.modelForContributor.pushUpdate(),t(f.modelForContributor)})},function(e){t(f.modelForContributor)})},1e3)})},placeholder:p.team.addMember.typeToSearch,customFilterMessage:p.team.addMember.noSearchFound,multiSearchMode:!0,allowFreeInputFlag:!1,minLengthBeforeSearch:3,keepSearchResultsFlag:!1}).inject(u),f.autoCompleteInformedUser=new l({elementsTree:function(e){return new Promise(function(t,s){setTimeout(function(){f.modelForInformedUser.empty(),i.getMembers({text:e}).then(function(e){f.modelForInformedUser.prepareUpdate(),require(["DS/IssueComponents/team/MembersDataGridLayout"],function(s){let n={};s.issues;var i=s.membersDataGridModel.informedUsers.getChildren()?s.membersDataGridModel.informedUsers.getChildren():[];for(let e=0;e<i.length;e++){let t=i[e].options.grid;n[t.user]=t.role}for(var r=f.autoCompleteInformedUser.selectedItems,a=0;a<e.length;a++){var o=e[a].identifier,l=[];if(r&&r.length>0&&(l=r.filter(t=>"person"===e[a].type.toLowerCase()?t.options.identifier===e[a].identifier:t.options.identifier===e[a].id)),!r||0==r.length||0==l.length)if("person"===e[a].type.toLowerCase()){var c=e[a].name+" ("+e[a].identifier.toUpperCase()+")";if(!n.hasOwnProperty(o)||!n[o].contains("InformedUser")){var u=new d({label:c,value:e[a].identifier,name:e[a].name,identifier:e[a].identifier,type:e[a].type.toLowerCase()});f.modelForInformedUser.addRoot(u)}}else if(!("group"!==e[a].type.toLowerCase()||n.hasOwnProperty(e[a].id)&&n[e[a].id].contains("InformedUser"))){u=new d({label:e[a].name,value:e[a].identifier,name:e[a].name,identifier:e[a].id,type:e[a].type.toLowerCase()});f.modelForInformedUser.addRoot(u)}}f.modelForInformedUser.pushUpdate(),t(f.modelForInformedUser)})},function(e){t(f.modelForInformedUser)})},1e3)})},placeholder:p.team.addMember.typeToSearch,customFilterMessage:p.team.addMember.noSearchFound,multiSearchMode:!0,allowFreeInputFlag:!1,minLengthBeforeSearch:3,keepSearchResultsFlag:!1}).inject(m),f.autoCompleteAssignee.addEventListener("change",function(){f.enableAddButton()}),f.autoCompleteCoowner.addEventListener("change",function(){f.enableAddButton()}),f.autoCompleteContributor.addEventListener("change",function(){f.enableAddButton()}),f.autoCompleteInformedUser.addEventListener("change",function(){f.enableAddButton()}),f.enableAddButton=function(){var e=f.autoCompleteAssignee.selectedItems?f.autoCompleteAssignee.selectedItems.length:0,t=f.autoCompleteCoowner.selectedItems?f.autoCompleteCoowner.selectedItems.length:0,s=f.autoCompleteContributor.selectedItems?f.autoCompleteContributor.selectedItems.length:0,n=f.autoCompleteInformedUser.selectedItems?f.autoCompleteInformedUser.selectedItems.length:0;f.addButton.disabled=!(e>0||t>0||s>0||n>0)},f.addButton.addEventListener("buttonclick",function(e){t.target.hide(),document.querySelector(".toolbar-member-grid-div .wux-ui-3ds-user-add").removeClassName("member-toolbar-active");var s=document.querySelector(".iss-member-grid-div"),n=document.querySelector(".membertileView");s.removeClassName("teamview-opaque"),n.removeClassName("teamview-opaque");var i=[],r=[],a=[],o=[];if(null!=f.autoCompleteCoowner.selectedItems)for(var l=0;l<f.autoCompleteCoowner.selectedItems.length;l++){let e=f.autoCompleteCoowner.selectedItems[l].options;i.push(e)}if(null!=f.autoCompleteAssignee.selectedItems)for(l=0;l<f.autoCompleteAssignee.selectedItems.length;l++){let e=f.autoCompleteAssignee.selectedItems[l].options;r.push(e)}if(null!=f.autoCompleteContributor.selectedItems)for(l=0;l<f.autoCompleteContributor.selectedItems.length;l++){let e=f.autoCompleteContributor.selectedItems[l].options;a.push(e)}if(null!=f.autoCompleteInformedUser.selectedItems)for(l=0;l<f.autoCompleteInformedUser.selectedItems.length;l++){let e=f.autoCompleteInformedUser.selectedItems[l].options;o.push(e)}(i.length>0||r.length>0||a.length>0||o.length>0)&&(f.autoCompleteCoowner.selectedItems=f.autoCompleteAssignee.selectedItems=f.autoCompleteContributor.selectedItems=void 0,f.addMembers(i,r,a,o))}),f.cancelButton.addEventListener("buttonclick",function(e){t.target.hide(),document.querySelector(".toolbar-member-grid-div .wux-ui-3ds-user-add").removeClassName("member-toolbar-active");var s=document.querySelector(".iss-member-grid-div"),n=document.querySelector(".membertileView");s.removeClassName("teamview-opaque"),n.removeClassName("teamview-opaque")})},launchAddMemberPanel:function(){var e=document.querySelector(".toolbar-member-grid-div .wux-ui-3ds-user-add"),t=document.querySelector(".toolbar-member-grid-div .wux-ui-3ds-filter"),s=document.querySelector(".addmemberView"),n=document.querySelector(".memberfilterView"),i=document.querySelector(".iss-member-grid-div"),r=document.querySelector(".membertileView");n.hide(),t.removeClassName("member-toolbar-active"),i.removeClassName("teamview-opaque"),r.removeClassName("teamview-opaque"),"block"==s.style.display?(s.hide(),e.removeClassName("member-toolbar-active")):(s.show(),e.addClassName("member-toolbar-active"),i.addClassName("teamview-opaque"),r.addClassName("teamview-opaque"))},addMembers:function(e,t,s,n,r,o,l){require(["DS/IssueComponents/team/MembersDataGridLayout"],function(c){var d=document.getElementById("iss-outer-member-grid-div");m.mask(d);for(var h=c.issues,g=[],v=0;v<h.length;v++){var b=h[v],C={physicalId:b.id},E=!1;e=e.filter(function(e){return e.identifier===b.owner.user&&(E=!0),e.identifier!==b.owner.user}),E&&u.displayNotification({msg:p.replace(p.team.error.isOwner,{name:b.owner.fullName}),eventID:"info"}),e.length>0&&(C.coOwners=e.map(function(e){return{user:e.identifier}})),t.length>0&&(C.assignees=t.map(function(e){return{user:e.identifier,type:e.type}})),s.length>0&&(C.contributors=s.map(function(e){return{user:e.identifier}})),n.length>0&&(C.informedUsers=n.map(function(e){return{user:e.identifier,type:e.type}})),g.push(C)}i.people.update({data:{objects:g}}).then(function(){for(var i=[],a=c.membersDataGridModel.coowners.getChildren()?c.membersDataGridModel.coowners.getChildren():[],u=[],p=0;p<e.length;p++){var h=(I=e[p]).identifier;I.fullName=I.name,I.user=I.identifier,I.roles=[],I.roles.push("Co-owner");for(var g=!1,v=0;v<a.length;v++)if(h==a[v].options.grid.user){g=!0;break}if(1==g);else c.membersDataGridModel.treeDocument.getAllDescendants().forEach(function(e){e.options.grid.user===I.user&&(e.options.grid.roles.includes("Co-owner")||e.options.grid.roles.push("Co-owner"),I.roles=e.options.grid.roles)}),i.push(I.user),u.push(I)}u.length>0&&c.addNodesInLayout(u,"coowners");var b=c.membersDataGridModel.assignees.getChildren()?c.membersDataGridModel.assignees.getChildren():[];u=[];for(p=0;p<t.length;p++){h=(I=t[p]).identifier;I.user=I.identifier,I.fullName=I.name,I.roles=[],I.roles.push("Assignee");for(g=!1,v=0;v<b.length;v++)if(h==b[v].options.grid.user){g=!0;break}if(1==g);else c.membersDataGridModel.treeDocument.getAllDescendants().forEach(function(e){e.options.grid.user===I.user&&(e.options.grid.roles.includes("Assignee")||e.options.grid.roles.push("Assignee"),I.roles=e.options.grid.roles)}),u.push(I)}u.length>0&&c.addNodesInLayout(u,"assignees");var C=c.membersDataGridModel.contributors.getChildren()?c.membersDataGridModel.contributors.getChildren():[];u=[];for(p=0;p<s.length;p++){h=(I=s[p]).identifier;I.user=I.identifier,I.fullName=I.name,I.roles=[],I.roles.push("Contributor");for(g=!1,v=0;v<C.length;v++)if(h==C[v].options.grid.user){g=!0;break}if(1==g);else c.membersDataGridModel.treeDocument.getAllDescendants().forEach(function(e){e.options.grid.user===I.user&&(e.options.grid.roles.includes("Contributor")||e.options.grid.roles.push("Contributor"),I.roles=e.options.grid.roles)}),u.push(I)}u.length>0&&c.addNodesInLayout(u,"contributors");var E=c.membersDataGridModel.informedUsers.getChildren()?c.membersDataGridModel.informedUsers.getChildren():[];u=[];for(p=0;p<n.length;p++){var I;h=(I=n[p]).identifier;I.user=I.identifier,I.fullName=I.name,I.roles=[],I.roles.push("InformedUser");for(g=!1,v=0;v<E.length;v++)if(h==E[v].options.grid.user){g=!0;break}if(1==g);else c.membersDataGridModel.treeDocument.getAllDescendants().forEach(function(e){e.options.grid.user===I.user&&(e.options.grid.roles.includes("InformedUser")||e.options.grid.roles.push("InformedUser"),I.roles=e.options.grid.roles)}),u.push(I)}if(u.length>0&&c.addNodesInLayout(u,"informedUsers"),l&&l.updateOptions({grid:{common:!0}}),!0===r){var y=[];"coOwners"==o?y=c.membersDataGridModel.coowners.getChildren()?c.membersDataGridModel.coowners.getChildren():[]:"assignees"==o?y=c.membersDataGridModel.assignees.getChildren()?c.membersDataGridModel.assignees.getChildren():[]:"contributors"==o?y=c.membersDataGridModel.contributors.getChildren()?c.membersDataGridModel.contributors.getChildren():[]:"informedUsers"==o&&(y=c.membersDataGridModel.informedUsers.getChildren()?c.membersDataGridModel.informedUsers.getChildren():[]),y.forEach(function(e){e.updateOptions({grid:{common:!0}})})}f.modelForCoowner.empty(),f.modelForAssignee.empty(),f.modelForContributor.empty(),f.modelForInformedUser.empty(),c.view.dispatchEvent("onUpdate",{issues:c.issues}),m.unmask(d)}).catch(function(e){if(m.unmask(d),e.error.message.includes("'business object' does not exist")){var t=a.getErrorMessage("0");a.displayErrorMessage(t,"error")}else if(UWA.is(e.error.internal)&&e.error.internal.includes("You do not have the permissions to perform this action")){t=a.getErrorMessage("1");a.displayErrorMessage(t,"error")}else if(UWA.is(e.error.internal)&&e.error.internal.includes("No toconnect access to business object")){t=a.getErrorMessage("10");a.displayErrorMessage(t,"error")}else if(UWA.is(e.error.internal)&&e.error.internal.includes("No 'modify' access on Attribute 'Co-Owners' for")){t=a.getErrorMessage("2005");a.displayErrorMessage(t,"error")}else u.displayNotification({msg:e.error.message,eventID:"error"})})})},assignToSelf:function(){require(["DS/IssueComponents/team/MembersDataGridLayout"],function(e){var t=r.getUserName(),s=r.getFullName(),n=f.modelForAssignee.getAllDescendants(),i=(m=e.membersDataGridModel.assignees.getChildren()?e.membersDataGridModel.assignees.getChildren():[]).filter(e=>e.options.grid.user===t),a=f.autoCompleteAssignee.selectedItems,o=n.filter(e=>e.options.identifier===t),l=f.autoCompleteAssignee.selectedItems,c=[];if(l&&l.length>0&&(c=l.filter(e=>e.options.identifier===t)),i.length>0)u.displayNotification({msg:p.team.memberAlreadyAdded,eventID:"info"});else if(0==o.length&&0==i.length&&0==c.length){if(document.querySelector(".addmemberView").isHidden()){var m;(m=[]).push({identifier:t,name:s,type:"person"}),f.addMembers([],m,[],[])}else{a=f.autoCompleteAssignee.selectedItems;f.modelForAssignee.prepareUpdate();var h=s+" ("+t.toUpperCase()+")",g=new d({label:h,value:t,name:s,identifier:t,type:"person"});f.modelForAssignee.addRoot(g),a?(a=a.concat(g),f.autoCompleteAssignee.selectedItems=a):(a=[g],f.autoCompleteAssignee.selectedItems=a),f.modelForAssignee.pushUpdate()}}else 1==o.length&&(a=a.concat(o[0]),f.autoCompleteAssignee.selectedItems=a)})},ExecuteDropForCoownerField:function(e){var t={data:{}};t.data.items=e,f.ExecuteDropForAddMemberPanel(t,"Coowner")},ExecuteDropForContributorField:function(e){var t={data:{items:[]}};t.data.items=e,f.ExecuteDropForAddMemberPanel(t,"Contributor")},ExecuteDropForAssigneeField:function(e){var t={data:{}};t.data.items=e,f.ExecuteDropForAddMemberPanel(t,"Assignee")},ExecuteDropForInformedUserField:function(e){var t={data:{}};t.data.items=e,f.ExecuteDropForAddMemberPanel(t,"InformedUser")},ExecuteDropForAddMemberPanel:function(e,t){if(e&&e.data&&e.data.items){var s=e.data.items;if(UWA.is(s)&&UWA.is(s.length)&&s.length>0){for(var n=[],r=[],a=[],o=[],l=0;l<s.length;l++)if(s[l].objectId){var c=s[l].serviceId.toLowerCase();c.includes("3dspace")?n.push(s[l].objectId):"3dswym"==c&&"pno:Person"==s[l].objectType&&(r.push(s[l].objectId.replace("iam:","")),a.push(s[l].displayName),o.push(s[l]))}n.length>0&&i.getAdditionalObjectInfo({pidArray:n}).then(function(e){require(["DS/IssueComponents/team/MembersDataGridLayout"],function(s){for(var i=0;i<n.length;i++){var r=e.additionObjectInfo[n[i]];if("Coowner"===t){var a=f.modelForCoowner.getAllDescendants(),o=s.membersDataGridModel.coowners.getChildren()?s.membersDataGridModel.coowners.getChildren():[],l=s.membersDataGridModel.owner.getChildren()?s.membersDataGridModel.owner.getChildren():[],c=f.autoCompleteCoowner.selectedItems,m=a.filter(e=>e.options.identifier===r.objectTitle),h=[];(w=f.autoCompleteCoowner.selectedItems)&&w.length>0&&(h=w.filter(e=>e.options.identifier===r.objectTitle));var g=o.filter(e=>e.options.grid.user===r.objectTitle),v=l.filter(e=>e.options.grid.user===r.objectTitle);if(0==m.length&&0==g.length&&0==h.length&&0==v.length){if("person"===r.type.toLowerCase()){f.modelForCoowner.prepareUpdate();var b=r.fullName+" ("+r.objectTitle.toUpperCase()+")",C=new d({label:b,value:r.objectTitle,name:r.fullName,identifier:r.objectTitle,type:r.type.toLowerCase()});f.modelForCoowner.addRoot(C),m.push(C),c?(c=c.concat(C),f.autoCompleteCoowner.selectedItems=c):(c=[C],f.autoCompleteCoowner.selectedItems=c),f.modelForCoowner.pushUpdate()}}else 1==m.length&&(c=c.concat(m[0]),f.autoCompleteCoowner.selectedItems=c);g.length>0?u.displayNotification({msg:p.team.memberAlreadyAdded,eventID:"info"}):v.length>0?u.displayNotification({msg:p.replace(p.team.error.isOwner,{name:r.objectName}),eventID:"info"}):0==m.length&&0==h.length&&u.displayNotification({msg:p.team.error.notSupportedObjects,eventID:"warning"})}else if("Contributor"===t){a=f.modelForContributor.getAllDescendants();var E=s.membersDataGridModel.contributors.getChildren()?s.membersDataGridModel.contributors.getChildren():[];c=f.autoCompleteContributor.selectedItems,m=a.filter(e=>e.options.identifier===r.objectTitle),h=[];(w=f.autoCompleteContributor.selectedItems)&&w.length>0&&(h=w.filter(e=>e.options.identifier===r.objectTitle));g=E.filter(e=>e.options.grid.user===r.objectTitle);if(0==m.length&&0==g.length&&0==h.length){if("person"===r.type.toLowerCase()){f.modelForContributor.prepareUpdate();b=r.fullName+" ("+r.objectTitle.toUpperCase()+")";var I=new d({label:b,value:r.objectTitle,name:r.fullName,identifier:r.objectTitle,type:r.type.toLowerCase()});f.modelForContributor.addRoot(I),m.push(I),c?(c=c.concat(I),f.autoCompleteContributor.selectedItems=c):(c=[I],f.autoCompleteContributor.selectedItems=c),f.modelForContributor.pushUpdate()}}else 1==m.length&&(c=c.concat(m[0]),f.autoCompleteContributor.selectedItems=c);g.length>0?u.displayNotification({msg:p.team.memberAlreadyAdded,eventID:"info"}):0==m.length&&0==h.length&&u.displayNotification({msg:p.team.error.notSupportedObjects,eventID:"warning"})}else if("Assignee"===t){a=f.modelForAssignee.getAllDescendants();var y=s.membersDataGridModel.assignees.getChildren()?s.membersDataGridModel.assignees.getChildren():[];c=f.autoCompleteAssignee.selectedItems,m=a.filter(e=>"person"===r.type.toLowerCase()?e.options.identifier===r.objectTitle:e.options.identifier===r.pid),h=[];(w=f.autoCompleteAssignee.selectedItems)&&w.length>0&&(h=w.filter(e=>"person"===r.type.toLowerCase()?e.options.identifier===r.objectTitle:e.options.identifier===r.pid));g=y.filter(e=>"person"===r.type.toLowerCase()?e.options.grid.user===r.objectTitle:e.options.grid.user===r.pid);if(0==m.length&&0==g.length&&0==h.length){if("person"===r.type.toLowerCase()){f.modelForAssignee.prepareUpdate();b=r.fullName+" ("+r.objectTitle.toUpperCase()+")";var S=new d({label:b,value:r.objectTitle,name:r.fullName,identifier:r.objectTitle,type:r.type.toLowerCase()});f.modelForAssignee.addRoot(S),m.push(S),c?(c=c.concat(S),f.autoCompleteAssignee.selectedItems=c):(c=[S],f.autoCompleteAssignee.selectedItems=c),f.modelForAssignee.pushUpdate()}else if("group"===r.type.toLowerCase()){f.modelForAssignee.prepareUpdate();S=new d({label:r.objectTitle,value:r.objectTitle,name:r.objectTitle,identifier:r.pid,type:r.type.toLowerCase()});f.modelForAssignee.addRoot(S),m.push(S),c?(c=c.concat(S),f.autoCompleteAssignee.selectedItems=c):(c=[S],f.autoCompleteAssignee.selectedItems=c),f.modelForAssignee.pushUpdate()}}else 1==m.length&&(c=c.concat(m[0]),f.autoCompleteAssignee.selectedItems=c);g.length>0?u.displayNotification({msg:p.team.memberAlreadyAdded,eventID:"info"}):0==m.length&&0==h.length&&u.displayNotification({msg:p.team.error.notSupportedObjects,eventID:"warning"})}else if("InformedUser"===t){a=f.modelForInformedUser.getAllDescendants();var w,T=s.membersDataGridModel.informedUsers.getChildren()?s.membersDataGridModel.informedUsers.getChildren():[];c=f.autoCompleteInformedUser.selectedItems,m=a.filter(e=>"person"===r.type.toLowerCase()?e.options.identifier===r.objectTitle:e.options.identifier===r.pid),h=[];(w=f.autoCompleteInformedUser.selectedItems)&&w.length>0&&(h=w.filter(e=>"person"===r.type.toLowerCase()?e.options.identifier===r.objectTitle:e.options.identifier===r.pid));g=T.filter(e=>"person"===r.type.toLowerCase()?e.options.grid.user===r.objectTitle:e.options.grid.user===r.pid);if(0==m.length&&0==g.length&&0==h.length){if("person"===r.type.toLowerCase()){f.modelForInformedUser.prepareUpdate();b=r.fullName+" ("+r.objectTitle.toUpperCase()+")";var D=new d({label:b,value:r.objectTitle,name:r.fullName,identifier:r.objectTitle,type:r.type.toLowerCase()});f.modelForInformedUser.addRoot(D),m.push(D),c?(c=c.concat(D),f.autoCompleteInformedUser.selectedItems=c):(c=[D],f.autoCompleteInformedUser.selectedItems=c),f.modelForInformedUser.pushUpdate()}else if("group"===r.type.toLowerCase()){f.modelForInformedUser.prepareUpdate();D=new d({label:r.objectTitle,value:r.objectTitle,name:r.objectTitle,identifier:r.pid,type:r.type.toLowerCase()});f.modelForInformedUser.addRoot(D),m.push(D),c?(c=c.concat(D),f.autoCompleteInformedUser.selectedItems=c):(c=[D],f.autoCompleteInformedUser.selectedItems=c),f.modelForInformedUser.pushUpdate()}}else 1==m.length&&(c=c.concat(m[0]),f.autoCompleteInformedUser.selectedItems=c);g.length>0?u.displayNotification({msg:p.team.memberAlreadyAdded,eventID:"info"}):0==m.length&&0==h.length&&u.displayNotification({msg:p.team.error.notSupportedObjects,eventID:"warning"})}}})},function(e){return console.log("Failed in getting person id"),Promise.reject(e)}),r.length>0&&require(["DS/IssueComponents/team/MembersDataGridLayout"],function(e){for(var s=0;s<r.length;s++){var n=r[s],i=o[s];if("Coowner"===t){var a=f.modelForCoowner.getAllDescendants(),l=e.membersDataGridModel.coowners.getChildren()?e.membersDataGridModel.coowners.getChildren():[],c=e.membersDataGridModel.owner.getChildren()?e.membersDataGridModel.owner.getChildren():[],m=f.autoCompleteCoowner.selectedItems,h=a.filter(e=>e.options.identifier===n),g=[];(T=f.autoCompleteCoowner.selectedItems)&&T.length>0&&(g=T.filter(e=>e.options.identifier===n));var v=l.filter(e=>e.options.grid.user===n),b=c.filter(e=>e.options.grid.user===n);if(0==h.length&&0==v.length&&0==g.length&&0==b.length){if("pno:person"===i.objectType.toLowerCase()){f.modelForCoowner.prepareUpdate();var C=i.displayName+" ("+r[s].toUpperCase()+")",E=new d({label:C,value:r[s],name:i.displayName,identifier:r[s],type:"person"});f.modelForCoowner.addRoot(E),h.push(E),m?(m=m.concat(E),f.autoCompleteCoowner.selectedItems=m):(m=[E],f.autoCompleteCoowner.selectedItems=m),f.modelForCoowner.pushUpdate()}}else 1==h.length&&(m=m.concat(h[0]),f.autoCompleteCoowner.selectedItems=m);v.length>0?u.displayNotification({msg:p.team.memberAlreadyAdded,eventID:"info"}):b.length>0?u.displayNotification({msg:p.replace(p.team.error.isOwner,{name:n}),eventID:"info"}):0==h.length&&0==g.length&&u.displayNotification({msg:p.team.error.notSupportedObjects,eventID:"warning"})}else if("Contributor"===t){a=f.modelForContributor.getAllDescendants();var I=e.membersDataGridModel.contributors.getChildren()?e.membersDataGridModel.contributors.getChildren():[];m=f.autoCompleteContributor.selectedItems,h=a.filter(e=>e.options.identifier===n),g=[];(T=f.autoCompleteContributor.selectedItems)&&T.length>0&&(g=T.filter(e=>e.options.identifier===n));v=I.filter(e=>e.options.grid.user===n);if(0==h.length&&0==v.length&&0==g.length){if("pno:person"===i.objectType.toLowerCase()){f.modelForContributor.prepareUpdate();C=i.displayName+" ("+r[s].toUpperCase()+")";var y=new d({label:C,value:r[s],name:i.displayName,identifier:r[s],type:"person"});f.modelForContributor.addRoot(y),h.push(y),m?(m=m.concat(y),f.autoCompleteContributor.selectedItems=m):(m=[y],f.autoCompleteContributor.selectedItems=m),f.modelForContributor.pushUpdate()}}else 1==h.length&&(m=m.concat(h[0]),f.autoCompleteContributor.selectedItems=m);v.length>0?u.displayNotification({msg:p.team.memberAlreadyAdded,eventID:"info"}):0==h.length&&0==g.length&&u.displayNotification({msg:p.team.error.notSupportedObjects,eventID:"warning"})}else if("Assignee"===t){a=f.modelForAssignee.getAllDescendants();var S=e.membersDataGridModel.assignees.getChildren()?e.membersDataGridModel.assignees.getChildren():[];m=f.autoCompleteAssignee.selectedItems,h=a.filter(e=>e.options.identifier===n),g=[];(T=f.autoCompleteAssignee.selectedItems)&&T.length>0&&(g=T.filter(e=>e.options.identifier===n));v=S.filter(e=>e.options.grid.user===n);if(0==h.length&&0==v.length&&0==g.length){if("pno:person"===i.objectType.toLowerCase()){f.modelForAssignee.prepareUpdate();C=i.displayName+" ("+r[s].toUpperCase()+")";var w=new d({label:C,value:r[s],name:i.displayName,identifier:r[s],type:"person"});f.modelForAssignee.addRoot(w),h.push(w),m?(m=m.concat(w),f.autoCompleteAssignee.selectedItems=m):(m=[w],f.autoCompleteAssignee.selectedItems=m),f.modelForAssignee.pushUpdate()}}else 1==h.length&&(m=m.concat(h[0]),f.autoCompleteAssignee.selectedItems=m);v.length>0?u.displayNotification({msg:p.team.memberAlreadyAdded,eventID:"info"}):0==h.length&&0==g.length&&u.displayNotification({msg:p.team.error.notSupportedObjects,eventID:"warning"})}else if("InformedUser"===t){a=f.modelForInformedUser.getAllDescendants();var T,D=e.membersDataGridModel.informedUsers.getChildren()?e.membersDataGridModel.informedUsers.getChildren():[];m=f.autoCompleteInformedUser.selectedItems,h=a.filter(e=>e.options.identifier===n),g=[];(T=f.autoCompleteInformedUser.selectedItems)&&T.length>0&&(g=T.filter(e=>e.options.identifier===n));v=D.filter(e=>e.options.grid.user===n);if(0==h.length&&0==v.length&&0==g.length){if("pno:person"===i.objectType.toLowerCase()){f.modelForInformedUser.prepareUpdate();C=i.displayName+" ("+r[s].toUpperCase()+")";var A=new d({label:C,value:r[s],name:i.displayName,identifier:r[s],type:"person"});f.modelForInformedUser.addRoot(A),h.push(A),m?(m=m.concat(A),f.autoCompleteInformedUser.selectedItems=m):(m=[A],f.autoCompleteInformedUser.selectedItems=m),f.modelForInformedUser.pushUpdate()}}else 1==h.length&&(m=m.concat(h[0]),f.autoCompleteInformedUser.selectedItems=m);v.length>0?u.displayNotification({msg:p.team.memberAlreadyAdded,eventID:"info"}):0==h.length&&0==g.length&&u.displayNotification({msg:p.team.error.notSupportedObjects,eventID:"warning"})}}}),0==n.length&&0==r.length&&u.displayNotification({msg:p.team.error.dropNotSupported,eventID:"error"})}}else console.log("Drop_Not_Supported")}};return f}),define("DS/IssueComponents/create/Classification",["UWA/Class/Promise","UWA/Class/View","UWA/Core","DS/Controls/DatePicker","DS/Controls/LineEditor","DS/Controls/ComboBox","DS/Controls/Toggle","DS/Controls/Expander","DS/Controls/SpinBox","DS/WUXAutoComplete/AutoComplete","DS/Tree/TreeDocument","DS/Tree/TreeNodeModel","DS/IssueComponents/create/AutoComplete","DS/IssueServices/services/IssueServices","DS/IssueServices/services/PlatformServices","i18n!DS/IssueComponents/assets/nls/IssueComponents","css!DS/IssueComponents/IssueComponents.css"],function(e,t,s,n,i,r,a,o,l,c,d,u,m,p,f,h){"use strict";var g={DATE:"timestamp",TEXT:"string",INT:"integer",REAL:"real",BOOL:"boolean"},v="true";return t.extend({name:"DS/IssueComponents/create/Classify",tag:"div",className:"create-view-content-subview create-classify",isInit:null,_deferredInit:{resolve:null,reject:null},setup:function(t){var s=this;s._parent(t),s.parent=t.parent,s.isInit=new e(function(e,t){s._deferredInit.resolve=e,s._deferredInit.reject=t}),s.formElements={},s.formElementsToggler={},s.fields={},s.noShow=!t.classification,s._classes=[],s._classificationData=t.classification?t.classification.data:[],s.templateAttributes=t.classification.attributes?t.classification.attributes:{},s.selectedData=t.classification.selectedData?t.classification.selectedData:[],s.classModel=t.classification.classModel?t.classification.classModel:{},s._deferredInit.resolve()},destroy:function(){var e=this;e.form=null,Object.keys(e.fields).forEach(function(t){e.fields[t]=null,e.formElements[t]=null,e.formElementsToggler[t]=null})},render:function(){return this.form=s.createElement("div",{class:"classify-form"}),this.renderClassificationAttributes(),this},renderClassificationAttributes:function(){var e=this;e._classificationData.forEach(function(t,n){e._classes.push(t.classId);var i=s.createElement("div",{}),r=[];t.classAttributes.sort((e,t)=>e.name>t.name?1:-1),t.classAttributes.forEach(function(i,a){var o=e.getPlaceholder(i),l=i.authorizedValues,c=!!i.multivalued&&i.multivalued,d=[];l&&i.authorizedValues.forEach(function(e){d.push(e)});var u=s.createElement("h5",{class:"form-field",html:[s.createElement("span",{html:e.getLabel(i)})]});switch(i.type){case g.DATE:var m=e.formElements[i.name]=s.createElement("div",{class:"create-form-element create-properties-form-element-date",html:[{tag:"div",class:"classify-form-field",html:[{html:u},e.fields[i.name]=e.getDateField(e._classificationData[n].classAttributes[a],i.default,e.templateAttributes[i.name])]}]});if(e.selectedData.attributeFields[i.name]){p=e.selectedData.attributeFields[i.name].fields,f={classPath:t.classPath,field:e.fields[i.name]};p.push(f)}else{var p=[],f={classPath:t.classPath,field:e.fields[i.name]};p.push(f),e.selectedData.attributeFields[i.name]={},e.selectedData.attributeFields[i.name].fields=p}r.push(m);break;case g.INT:case g.REAL:var h=e.formElements[i.name]=s.createElement("div",{class:"create-form-element create-properties-form-element-number",html:[{tag:"div",class:"classify-form-field",html:[{html:u},e.fields[i.name]=l?e.getComboBox(e._classificationData[n].classAttributes[a],d,c,e.templateAttributes[i.name]):e.getNumberField(e._classificationData[n].classAttributes[a],o,c,e.templateAttributes[i.name])]}]});if(e.selectedData.attributeFields[i.name]){p=e.selectedData.attributeFields[i.name].fields,f={classPath:t.classPath,field:e.fields[i.name]};p.push(f)}else{var p=[],f={classPath:t.classPath,field:e.fields[i.name]};p.push(f),e.selectedData.attributeFields[i.name]={},e.selectedData.attributeFields[i.name].fields=p}r.push(h);break;case g.BOOL:var b=e.formElements[i.name]=s.createElement("div",{class:"create-form-element create-properties-form-element-boolean",html:[{tag:"div",class:"classify-form-field",html:[{html:u},e.fields[i.name]=e.getBooleanField(e._classificationData[n].classAttributes[a],i.default===v,e.templateAttributes[i.name])]}]});if(e.selectedData.attributeFields[i.name]){p=e.selectedData.attributeFields[i.name].fields,f={classPath:t.classPath,field:e.fields[i.name]};p.push(f)}else{p=[],f={classPath:t.classPath,field:e.fields[i.name]};p.push(f),e.selectedData.attributeFields[i.name]={},e.selectedData.attributeFields[i.name].fields=p}r.push(b);break;case g.TEXT:var C=e.formElements[i.name]=s.createElement("div",{class:"create-form-element create-properties-form-element-text",html:[{tag:"div",class:"classify-form-field",html:[{html:u},e.fields[i.name]=l?e.getComboBox(e._classificationData[n].classAttributes[a],d,c,e.templateAttributes[i.name]):e.getTextField(e._classificationData[n].classAttributes[a],o,c,e.templateAttributes[i.name])]}]});if(e.selectedData.attributeFields[i.name]){p=e.selectedData.attributeFields[i.name].fields,f={classPath:t.classPath,field:e.fields[i.name]};p.push(f)}else{p=[],f={classPath:t.classPath,field:e.fields[i.name]};p.push(f),e.selectedData.attributeFields[i.name]={},e.selectedData.attributeFields[i.name].fields=p}r.push(C)}}),r.forEach(function(e){e.inject(i)});var a=s.createElement("div",{class:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-close"});a.addEvent("click",function(){delete e.selectedData.classes[t.classId];for(var s=e.selectedData._classificationData,n=0;n<s.length;n++)s[n][0].classId===t.classId&&s.splice(n,1);var i=l.header,r=(l.body.getChildren(),l.body.querySelectorAll("h5"));r.length>0&&r.forEach(function(t){for(var s=e.selectedData.attributeFields[t.textContent].fields,n=0;n<s.length;n++)if(s[n].classPath===i){s.splice(n,1);break}0===s.length&&delete e.selectedData.attributeFields[t.textContent]}),l.destroy()});var l=new o({header:t.classPath,body:i,customHeader:a,expandedFlag:!0});l.inject(e.form)})},show:function(){this._parent()},hide:function(){this._parent()},getLabel:function(e){var t="",s=h.create.properties.classification;if(void 0!==s){var n=s[e.name];void 0!==n&&(t=n.label)}return""!==t&&void 0!==t||(t=e.name),t},getPlaceholder:function(e){var t="",s=h.create.properties.classification;if(void 0!==s){var n=s[e.name];void 0!==n&&(t=n.placeholder)}return""!==t&&void 0!==t||(t=e.name),t},getDateField:function(e,t,s){var i=this,r="";if(i.selectedData.attributeFields[e.name]&&void 0!==i.selectedData.attributeFields[e.name].value)e.value=i.selectedData.attributeFields[e.name].value,i.selectedData.attributes[e.name]=e.value,r=e.value;else if(void 0!==s)e.value=s,i.selectedData.attributes[e.name]=s,r=new Date(s);else if(void 0!==t){var a=t.substr(8,2),o=t.substr(5,2)-1,l=t.substr(0,4);r=new Date(l,o,a)}else r=void 0;var c=new n({value:r});return c.getContent().addEventListener("change",function(){var t=c.value;null!==t&&(e.value=t.getMonth()+1+"/"+t.getDate()+"/"+t.getFullYear(),i.selectedData.attributes[e.name]=e.value,i.selectedData.attributeFields[e.name].fields.forEach(function(e){e.field.value=t}),i.selectedData.attributeFields[e.name].value=t)}),c},getTextField:function(e,t,s,n){var r=this,a=(e.type,void 0===e.default?"":e.default);r.selectedData.attributeFields[e.name]&&void 0!==r.selectedData.attributeFields[e.name].value?(e.value=r.selectedData.attributeFields[e.name].value,r.selectedData.attributes[e.name]=e.value,a=e.value):void 0!==n&&(e.value=n,r.selectedData.attributes[e.name]=n,a=n);var o=null;return s?o=r.getMultiValueField(e,a,n):((o=new i({placeholder:t,value:a})).getContent().setStyle("width","100%"),o.addEventListener("change",function(){e.value=o.value,r.selectedData.attributes[e.name]=e.value,r.selectedData.attributeFields[e.name].fields.forEach(function(t){t.field.value=e.value}),r.selectedData.attributeFields[e.name].value=e.value})),o},getNumberField:function(e,t,s,n){var i=this,r=e.type,a=void 0===e.default?0:e.default;i.selectedData.attributeFields[e.name]&&void 0!==i.selectedData.attributeFields[e.name].value?(e.value=i.selectedData.attributeFields[e.name].value,i.selectedData.attributes[e.name]=e.value,a=e.value):void 0!==n&&(e.value=n,i.selectedData.attributes[e.name]=n,a=n);var o=null;if(s)o=i.getMultiValueField(e,a,n);else{var c=e.maximum,d=e.minimum;c=void 0!==c?r===g.INT?parseInt(c):parseFloat(c):r===g.INT?2147483646:999999999999999,(o=new l({value:r===g.INT?parseInt(a):parseFloat(a),stepValue:r===g.INT?1:.1,minValue:d?r===g.INT?parseInt(d):parseFloat(d):"",maxValue:c,decimals:r===g.INT?0:6})).addEventListener("change",function(){e.value=o.value,i.selectedData.attributes[e.name]=e.value,i.selectedData.attributeFields[e.name].fields.forEach(function(t){t.field.value=e.value}),i.selectedData.attributeFields[e.name].value=e.value})}return o},getComboBox:function(e,t,s,n){var i=this,r=null,a=e.type,o=e.default;if(i.selectedData.attributeFields[e.name]&&void 0!==i.selectedData.attributeFields[e.name].value?(e.value=i.selectedData.attributeFields[e.name].value,i.selectedData.attributes[e.name]=e.value,o=e.value):void 0!==n&&(e.value=n,i.selectedData.attributes[e.name]=n,o=n),a!==g.INT&&a!==g.REAL||t.sort(function(e,t){return e-t}),s)if(""!==t&&t.length>0){var l=[];""!==t&&t.forEach(function(e,t){l.push({labelItem:e,valueItem:e})});var m=function(e,t){return new u({label:e,value:t})},p=function(){var e=new d;e.prepareUpdate();for(var t=0;t<l.length;t++){var s=l[t].labelItem,n=l[t].valueItem,i=m(s,n);e.addRoot(i)}return e.pushUpdate(),e}(),f=!0,h=[];l.length>0&&l.forEach(function(e,t){var s=[];if(null!=o)for(var n=0;n<o.length;n++)s[n]=o[n]+"";null!=o&&s.includes(e.valueItem)&&h.push(p.getRoots()[t])}),(r=new c({elementsTree:p,multiSearchMode:f,selectedItems:h,allowFreeInputFlag:!1})).addEventListener("change",function(){for(var t=r.selectedItems,s=[],n=i.selectedData.attributeFields[e.name].fields,a=0;a<t.length;a++)s.push(t[a].options.value);n.forEach(function(e){e.field.selectedItems=t}),e.value=s,i.selectedData.attributes[e.name]=e.value,i.selectedData.attributeFields[e.name].value=e.value})}else r=i.getMultiValueField(e,o,n,t);else{var v=void 0===o?"":o;l=[];""!==t&&t.forEach(function(e,t){l.push({labelItem:e,valueItem:e})});m=function(e,t){return new u({label:e,value:t})},p=function(){var e=new d;e.prepareUpdate();for(var t=0;t<l.length;t++){var s=l[t].labelItem,n=l[t].valueItem,i=m(s,n);e.addRoot(i)}return e.pushUpdate(),e}(),f=!1,h=[];l.length>0&&l.forEach(function(e,t){v+""===e.valueItem&&h.push(p.getRoots()[t])}),(r=new c({elementsTree:p,multiSearchMode:f,selectedItems:h,allowFreeInputFlag:!1})).addEventListener("change",function(){e.value=r.value,i.selectedData.attributes[e.name]=e.value,i.selectedData.attributeFields[e.name].fields.forEach(function(t){t.field.value=e.value}),i.selectedData.attributeFields[e.name].value=e.value})}return r.getContent().addEventListener("keydown",function(e){13==e.keyCode&&e.stopPropagation()}),r},getBooleanField:function(e,t,s){var n=this;n.selectedData.attributeFields[e.name]&&void 0!==n.selectedData.attributeFields[e.name].value?(e.value=n.selectedData.attributeFields[e.name].value,n.selectedData.attributes[e.name]=e.value,t=e.value):void 0!==s&&(e.value=s,n.selectedData.attributes[e.name]=e.value,t=s);var i=new a({type:"switch",checkFlag:t});return i.addEventListener("change",function(){e.value=i.checkFlag,n.selectedData.attributes[e.name]=e.value,n.selectedData.attributeFields[e.name].fields.forEach(function(t){t.field.checkFlag=e.value}),n.selectedData.attributeFields[e.name].value=e.value}),i.getContent().addEventListener("keydown",function(e){13==e.keyCode&&e.stopPropagation()}),i},getMultiValueField:function(e,t,s,n){var i=this;s=t||s,n=n||[];var r=new m({dataType:e.type,selectedValues:s,rangeValues:n});return r.addEventListener("change",function(){var t=r.selectedItems,s=[];i.selectedData.attributeFields[e.name].fields.forEach(function(e){e.field._selectionChips.removeAllChips(),e.field.selectedItems=[],s=[];for(var n=0;n<t.length;n++)s.push(t[n].value),e.field._selectionChips.addChip({label:t[n].value,value:t[n].value}),e.field.selectedItems.push({label:t[n].value,value:t[n].value})}),e.value=s,i.selectedData.attributes[e.name]=e.value,i.selectedData.attributeFields[e.name].value=e.value}),r.getContent().addEventListener("keydown",function(e){13==e.keyCode&&e.stopPropagation()}),r}})}),define("DS/IssueComponents/create/Team",["UWA/Class/View","UWA/Class/Promise","UWA/Core","DS/ENOFloatingPanel/ENOFloatingPanel","DS/Logger/Logger","DS/PADUtils/views/PADAlert","DS/SearchWidget/SearchWidgetConstant","DS/UIKIT/Form","DS/UIKIT/Input/Select","DS/UIKIT/Input/Toggle","DS/UIKIT/Tooltip","DS/Controls/TooltipModel","DS/IssueCommon/commands/CommandsManager","DS/IssueCommon/utils/Utils","DS/IssueComponents/search/PeopleSearch","DS/IssueServices/services/IssueServices","DS/IssueServices/services/PlatformServices","DS/IssueServices/Contexts","DS/IssueServices/utils/Performance","i18n!DS/IssueComponents/assets/nls/IssueComponents","css!DS/IssueComponents/IssueComponents.css"],function(e,t,s,n,i,r,a,o,l,c,d,u,m,p,f,h,g,v,b,C){"use strict";var E="_PRJ",I={OWNER:"owner",CO_OWNERS:"coOwners",ASSIGNEES:"assignees",CONTRIBUTORS:"contributors",INFORMEDUSERS:"informedUsers"};return e.extend({name:"DS/IssueComponents/create/Team",tag:"div",className:"create-view-content-subview create-team",isInit:null,_deferredInit:{resolve:null,reject:null},setup:function(e){var s=this;s._parent(e),s.parent=e.parent,s.isInit=new t(function(e,t){s._deferredInit.resolve=e,s._deferredInit.reject=t}),s.form=null,s.formElements={owner:null,coOwners:null,assigness:null,contributors:null,informedUsers:null},s.formElementsToggler={owner:null,coOwners:null,assigness:null,contributors:null,informedUsers:null},s.fields={assignToMe:null,addOwner:null,addCoOwners:null,addAssignees:null,addReviewers:null,addContributors:null,addInformedUsers:null},s.values={owner:{},coOwners:{},assignees:{},contributors:{},informedUsers:{}},s.listenTo(s.parent,"related-add-reportedAgainst",function(e){let t={user:e.data.owner,fullName:e.data.responsible};s._addUser(t,"assignees")}),h.organizations.getCompanies({onComplete:function(e){s.organizations=e.body},onFailure:function(){s.organizations=[]}}).finally(function(){s._deferredInit.resolve()})},destroy:function(){this.form=null,this.formElements={coOwners:null,assigness:null,contributors:null},this.formElementsToggler={coOwners:null,assigness:null,contributors:null},this.fields={assignToMe:null},this.values={coOwners:{},assignees:{},contributors:{}}},render:function(){var e=this;return e.form=new o({className:"create-team-form",fields:[],events:{onInvalid:function(){}}}).inject(e.container),s.createElement("div",{class:"create-form-content",html:[e.formElements.owner=s.createElement("div",{class:"create-form-element create-team-form-element-owner",html:[{tag:"div",class:"create-form-visibility-mask"},{tag:"div",class:"create-form-visibility-toggle",html:[e.formElementsToggler.owner=s.createElement("span",{class:"fonticon fonticon-eye"})]},{tag:"div",class:"create-form-field form-group",html:[s.createElement("div",{class:"create-form-element-title",html:[{tag:"h5",html:C.create.team.labels.owner}]}),{tag:"div",class:"issue-owner-search-container",html:[s.createElement("div",{class:"form-group-owner",html:e.fields.addOwner=e._peopleSearch(I.OWNER)}),e.fields.owner=s.createElement("div",{class:"form-group-owner-holder"}),e.fields.owner.ownerHelper=s.createElement("div",{html:[s.createElement("span",{class:"fonticon fonticon-help"})]})]}]},{tag:"div",class:"create-form-help-tooltip",html:[e.fields.owner.ownerHelper]}]}),e.formElements.coOwners=s.createElement("div",{class:"create-form-element create-team-form-element-coowners",html:[{tag:"div",class:"create-form-visibility-mask"},{tag:"div",class:"create-form-visibility-toggle",html:[e.formElementsToggler.coOwners=s.createElement("span",{class:"fonticon fonticon-eye"})]},{tag:"div",class:"create-form-field form-group",html:[s.createElement("div",{class:"create-form-element-title",html:[{tag:"h5",html:C.create.team.labels.coOwners}]}),{tag:"div",class:"issue-coowners-search-container",html:[s.createElement("div",{class:"form-group-coowners",html:e.fields.addCoOwners=e._peopleSearch(I.CO_OWNERS)}),e.fields.coOwners=s.createElement("div",{class:"form-group-coowners-holder"}),e.fields.coOwners.coOwnersHelper=s.createElement("div",{html:[s.createElement("span",{class:"fonticon fonticon-help"})]})]}]},{tag:"div",class:"create-form-help-tooltip",html:[e.fields.coOwners.coOwnersHelper]}]}),e.formElements.assignees=s.createElement("div",{class:"create-form-element create-team-form-element-assignees",html:[{tag:"div",class:"create-form-visibility-mask"},{tag:"div",class:"create-form-visibility-toggle",html:[e.formElementsToggler.assignees=s.createElement("span",{class:"fonticon fonticon-eye"})]},{tag:"div",class:"create-form-field form-group",html:[s.createElement("div",{class:"create-form-element-title",html:[{tag:"h5",html:C.create.team.labels.assignees},{tag:"span",class:"issue-assign-to-me",html:e.fields.assignToMe=new c({type:"checkbox",value:"assign-me",label:C.create.team.labels.assignToMe,checked:!1,className:"primary",events:{onChange:function(){this.isChecked()?e._addUser({user:g.getUserName(),fullName:g.getFullName(),position:0},I.ASSIGNEES):e._removeUser({user:g.getUserName(),fullName:g.getFullName()},I.ASSIGNEES)}}})}]}),{tag:"div",class:"issue-assignees-search-container",html:[s.createElement("div",{class:"form-group-assignees",html:e.fields.addAssignees=e._peopleSearch(I.ASSIGNEES)}),e.fields.assignees=s.createElement("div",{class:"form-group-assignees-holder"}),e.fields.assignees.assigneesHelper=s.createElement("div",{html:[s.createElement("span",{class:"fonticon fonticon-help"})]})]}]},{tag:"div",class:"create-form-help-tooltip",html:[e.fields.assignees.assigneesHelper]}]}),e.formElements.contributors=s.createElement("div",{class:"create-form-element create-team-form-element-contributors",html:[{tag:"div",class:"create-form-visibility-mask"},{tag:"div",class:"create-form-visibility-toggle",html:[e.formElementsToggler.contributors=s.createElement("span",{class:"fonticon fonticon-eye"})]},{tag:"div",class:"create-form-field form-group",html:[s.createElement("div",{class:"create-form-element-title",html:[{tag:"h5",html:C.create.team.labels.contributors}]}),{tag:"div",class:"issue-contributors-search-container",html:[s.createElement("div",{class:"form-group-contributors",html:e.fields.addContributors=e._peopleSearch(I.CONTRIBUTORS)}),e.fields.contributors=s.createElement("div",{class:"form-group-contributors-holder"}),e.fields.contributors.contributorHelper=s.createElement("div",{html:[s.createElement("span",{class:"fonticon fonticon-help"})]})]}]},{tag:"div",class:"create-form-help-tooltip",html:[e.fields.contributors.contributorHelper]}]}),e.formElements.informedUsers=s.createElement("div",{class:"create-form-element create-team-form-element-informedUsers",html:[{tag:"div",class:"create-form-visibility-mask"},{tag:"div",class:"create-form-visibility-toggle",html:[e.formElementsToggler.informedUsers=s.createElement("span",{class:"fonticon fonticon-eye"})]},{tag:"div",class:"create-form-field form-group",html:[s.createElement("div",{class:"create-form-element-title",html:[{tag:"h5",html:C.create.team.labels.informedUsers}]}),{tag:"div",class:"issue-informedUsers-search-container",html:[s.createElement("div",{class:"form-group-informedUsers",html:e.fields.addInformedUsers=e._peopleSearch(I.INFORMEDUSERS)}),e.fields.informedUsers=s.createElement("div",{class:"form-group-informedUsers-holder"}),e.fields.informedUsers.informedUserHelper=s.createElement("div",{html:[s.createElement("span",{class:"fonticon fonticon-help"})]})]}]},{tag:"div",class:"create-form-help-tooltip",html:[e.fields.informedUsers.informedUserHelper]}]})]}).inject(e.form.elements.container),e.fields.owner.ownerHelper.tooltipInfos=new u({shortHelp:C.create.team.labels.ownerHelper}),e.fields.coOwners.coOwnersHelper.tooltipInfos=new u({shortHelp:C.create.team.labels.coOwnersHelper}),e.fields.assignees.assigneesHelper.tooltipInfos=new u({shortHelp:C.create.team.labels.assigneesHelper}),e.fields.contributors.contributorHelper.tooltipInfos=new u({shortHelp:C.create.team.labels.contributorHelper}),e.fields.informedUsers.informedUserHelper.tooltipInfos=new u({shortHelp:C.create.team.labels.informedUserHelper}),e.reset().then(e._deferredInit.resolve),e},getValues:function(){return{owner:{user:Object.keys(this.values.owner)[0]},coOwners:Object.keys(this.values.coOwners).map(function(e){return{user:e}}),assignees:Object.values(this.values.assignees).map(function(e){return{user:e.user,type:e.type}}),contributors:Object.keys(this.values.contributors).map(function(e){return{user:e}}),informedUsers:Object.values(this.values.informedUsers).map(function(e){return{user:e.user,type:e.type}})}},getUIValues:function(){return{owner:this.values.owner,coOwners:this.values.coOwners,assignees:this.values.assignees,contributors:this.values.contributors,informedUsers:this.values.informedUsers}},getHiddenAttributes:function(){var e={};for(var t in this.formElements)s.is(this.formElementsToggler[t])&&(e[t]=this.formElementsToggler[t].hasClassName("fonticon-eye-off"));return e},applyTemplate:function(e){var n=this;return n.reset().then(function(){if(s.is(e.ui)&&(s.is(e.ui.owner,"object")&&n._addUser({user:g.getUserName(),fullName:g.getFullName(),position:0},I.OWNER),s.is(e.ui.coOwners,"object")&&Object.keys(e.ui.coOwners).forEach(function(t){n._addUser(e.ui.coOwners[t],I.CO_OWNERS)}),s.is(e.ui.assignees,"object")&&Object.keys(e.ui.assignees).forEach(function(t){n._addUser(e.ui.assignees[t],I.ASSIGNEES)}),s.is(e.ui.contributors,"object")&&Object.keys(e.ui.contributors).forEach(function(t){n._addUser(e.ui.contributors[t],I.CONTRIBUTORS)}),s.is(e.ui.informedUsers,"object")&&Object.keys(e.ui.informedUsers).forEach(function(t){n._addUser(e.ui.informedUsers[t],I.INFORMEDUSERS)})),s.is(e.hidden,"object")&&s.is(n.formElements,"object")&&s.is(n.formElementsToggler,"object")){var i=n.formElements,r=n.formElementsToggler;for(var a in i)!0===e.hidden[a]&&(n.parent.isTemplate?(s.is(i[a])&&i[a].toggleClassName("visibility-masked",!0),s.is(r[a])&&(r[a].toggleClassName("fonticon-eye-off",!0),r[a].toggleClassName("fonticon-eye",!1))):s.is(i[a])&&i[a].hide())}return t.resolve()})},reset:function(){var e=this;return new t(function(t){Object.keys(e.values.owner).forEach(function(t){e._removeUser(e.values.owner[t],I.OWNER)}),e._addUser({user:g.getUserName(),fullName:g.getFullName()},I.OWNER),Object.keys(e.values.coOwners).forEach(function(t){e._removeUser(e.values.coOwners[t],I.CO_OWNERS)}),Object.keys(e.values.assignees).forEach(function(t){e._removeUser(e.values.assignees[t],I.ASSIGNEES)}),Object.keys(e.values.contributors).forEach(function(t){e._removeUser(e.values.contributors[t],I.CONTRIBUTORS)}),Object.keys(e.values.informedUsers).forEach(function(t){e._removeUser(e.values.informedUsers[t],I.INFORMEDUSERS)}),t()})},_peopleSearch:function(e){var t=this,s="";e!==I.ASSIGNEES&&e!==I.INFORMEDUSERS||(s=a.EXTTYPE_USERGRP);var n=new f({className:"searchPeople_TransferOwnership",MaxNumber:"5",MaxSize:"300",position:"auto",showEmptyCategory:!1,type:a.TYPE_PERSON,exttype:s,events:{onValid:function(){var s=n.getNewOwner().person,i=n.getNewOwner().userGrp;void 0!==s?t._addUser({user:s.personID.replace(E,""),fullName:s.personFullName,type:"person"},e):void 0!==i&&t._addUser({user:i.id,fullName:i.label,type:"group"},e),n.clearInput(),n.getContent().searchInput.focus()},onUnvalid:function(){},onError:function(){r.displayNotification({msg:C.team.error.notFound,eventID:"info"})},onValidUsers:function(s){Object.keys(s).map(function(e){return s[e]}).forEach(function(s){var n={};n.user=s.name,n.fullName=s.firstname+" "+s.lastname,t._addUser(n,e)}),n.clearInput(),n.getContent().searchInput.focus()}}});return n.setSelectedItemList([{objectID:t.organizations[0].physicalId}]),n},_addUser:function(e,t){var n=this;if(t===I.OWNER&&(Object.keys(n.values.owner).forEach(function(e){n._removeUser(n.values.owner[e],I.OWNER)}),n.values.coOwners.hasOwnProperty(e.user)&&n._removeUser(n.values.coOwners[e.user],I.CO_OWNERS)),t===I.CO_OWNERS&&n.values.owner.hasOwnProperty(e.user))r.displayNotification({msg:C.create.team.cannotAddOwnerAsCoOwner,eventID:"error"});else if(n.values[t][e.user])r.displayNotification({msg:C.replace(C.create.team.alreadyAssigned,{name:e.fullName}),eventID:"info"});else{var i=n._createUserHTML(e,t);if(t!==I.OWNER){var a=s.createElement("span",{class:"team-content-user-remove wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-remove"}).inject(i),o=new d({position:"left",target:a,body:C.create.team.removeAssignee,animate:!1});a.addEventListener("click",function(){n._removeUser(e,t),o.destroy()})}n._isInteger(e.position)?n.fields[t].insertBefore(i,n.fields[t].children[e.position]):n.fields[t].appendChild(i),t!==I.ASSIGNEES||e.user!==g.getUserName()||n.fields.assignToMe.isChecked()||n.fields.assignToMe.check(),e.element=i,n.values[t][e.user]=e}},_removeUser:function(e,t){this.values[t][e.user]&&(t===I.ASSIGNEES&&e.user===g.getUserName()&&!0===this.fields.assignToMe.isChecked()&&this.fields.assignToMe.uncheck(),this.values[t][e.user].element.destroy(),delete this.values[t][e.user])},_createUserHTML:function(e,t){var n=s.createElement("div",{id:t+"-"+p.getTextFromHTML(e.user),class:"team-content-user-container"});("group"===e.type?s.createElement("span",{class:"team-content-user-group wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-users-group",title:e.fullName}):g.getUserImageElement(e,!0,{cssClass:"team-content-user-img",Title:p.getTextFromHTML(e.fullName+" ("+e.user+")")})).inject(n);var i=s.createElement("div",{class:"team-content-user-info"}).inject(n);return"group"===e.type?s.createElement("span",{class:"team-content-user-group-label",html:p.getTextFromHTML(e.fullName)}).inject(i):(s.createElement("span",{class:"team-content-user-full-name",html:p.getTextFromHTML(e.fullName)}).inject(i),s.createElement("span",{class:"team-content-user-id",html:p.getTextFromHTML(e.user)}).inject(i)),n},_isInteger:function(e){return Number.isInteger?Number.isInteger(e):"number"==typeof e&&isFinite(e)&&Math.floor(e)===e}})}),define("DS/IssueComponents/related/TreeListView",["UWA/Core","UWA/Class","UWA/Controls/Abstract","UWA/Class/Promise","DS/Core/Events","DS/Logger/Logger","DS/UIKIT/Iconbar","DS/UIKIT/Input/Button","DS/UIKIT/Mask","DS/UIKIT/Scroller","DS/UIKIT/Tooltip","DS/Menu/Menu","DS/Tree/TreeDocument","DS/Tree/TreeListView","DS/LifecycleServices/LifecycleServicesSettings","DS/IssueServices/Contexts","DS/IssueServices/services/IssueServices","DS/IssueServices/services/PlatformServices","DS/IssueServices/utils/Parser","DS/IssueServices/utils/Performance","DS/IssueServices/utils/Views","DS/IssueComponents/models/TreeNodeModel","DS/IssueComponents/utils/Utils","DS/IssueCommon/utils/Utils","DS/ENOFloatingPanel/ENOFloatingPanel","DS/PADUtils/views/PADAlert","DS/PADUtils/PADUtilsServices","DS/PlatformAPI/PlatformAPI","DS/UIBehaviors/ContextualMenuManager","DS/WebappsUtils/WebappsUtils","DS/IssueCommon/utils/DocumentUtils","DS/IssueAttachmentManager/services/AttachmentServices","i18n!DS/IssueComponents/assets/nls/IssueComponents","css!DS/IssueComponents/IssueComponents.css"],function(e,t,s,n,i,r,a,o,l,c,d,u,m,p,f,h,g,v,b,C,E,I,y,S,w,T,D,A,_,O,N,L,R){"use strict";return s.extend({name:"DS/IssueComponents/related/TreeListView",_preventEvents:!1,_syncSort:!1,_logger:null})}),define("DS/IssueComponents/related/Related",["UWA/Class/View","UWA/Class/Promise","UWA/Core","DS/Logger/Logger","DS/PADUtils/views/PADAlert","DS/PlatformAPI/PlatformAPI","DS/UIKIT/Iconbar","DS/UIKIT/Mask","DS/UIKIT/Scroller","DS/IssueCommon/utils/Utils","DS/IssueComponents/utils/Utils","DS/IssueComponents/related/TreeListView","DS/IssueServices/Contexts","DS/IssueServices/services/IssueServices","DS/IssueServices/services/PlatformServices","DS/IssueServices/utils/Performance","css!DS/IssueComponents/IssueComponents.css","i18n!DS/IssueComponents/assets/nls/IssueComponents"],function(e,t,s,n,i,r,a,o,l,c,d,u,m,p,f,h,g,v){"use strict";return e.extend({name:"DS/IssueComponents/related/Related",tag:"div",className:"related-objects-view"})}),define("DS/IssueComponents/team/MembersFilterLayout",["DS/IssueComponents/team/MembersFilterView"],function(e){"use strict";var t={createMemberFilter:function(s){t.teamlayoutModel=s.model,this.filterMembersView;var n={events:{memberFilterKeyUp:function(e){t.enteredText=e.target.value;var s={filteringMode:"name",text:t.enteredText};t.filterCollectionAndUpdateUI(s)}}};this.filterMembersView=new e(n),this.filterMembersView.render().inject(s.target)},filterCollectionAndUpdateUI:function(e){var s=e.text;t.teamlayoutModel.setFilterModel({fullName:{filterId:"stringRegexp",filterModel:{condition1:{type:"contains",filter:s}}},role:{filterId:"stringRegexp"}});t.teamlayoutModel.getFilterManager().getFilters().role},launchFilterMemberPanel:function(){var e=document.querySelector(".toolbar-member-grid-div .wux-ui-3ds-filter"),t=document.querySelector(".toolbar-member-grid-div .wux-ui-3ds-user-add"),s=document.querySelector(".addmemberView"),n=document.querySelector(".memberfilterView"),i=document.querySelector(".iss-member-grid-div"),r=document.querySelector(".membertileView");s.hide(),t.removeClassName("member-toolbar-active"),i.removeClassName("teamview-opaque"),r.removeClassName("teamview-opaque"),"block"==n.style.display?(n.hide(),e.removeClassName("member-toolbar-active")):(n.show(),e.addClassName("member-toolbar-active"))}};return t}),define("DS/IssueComponents/create/Properties",["UWA/Class/Promise","UWA/Class/View","UWA/Core","DS/UIKIT/Form","DS/UIKIT/Input/Button","DS/UIKIT/Input/ButtonGroup","DS/UIKIT/Input/Date","DS/UIKIT/Input/Text","DS/CKEditor/CKEditor","DS/ENOFloatingPanel/ENOFloatingPanel","DS/Logger/Logger","DS/WebappsUtils/WebappsUtils","DS/IssueCommon/commands/CommandsManager","DS/IssueCommon/utils/Utils","DS/IssueComponents/utils/Utils","DS/IssueServices/Contexts","DS/IssueServices/services/IssueServices","DS/IssueServices/services/PlatformServices","DS/IssueServices/utils/Parser","DS/IssueServices/utils/Performance","DS/WUXAutoComplete/AutoComplete","DS/Tree/TreeDocument","DS/Tree/TreeNodeModel","DS/IssueComponents/create/Classification","i18n!DS/IssueComponents/assets/nls/IssueComponents","text!DS/IssueCommon/assets/Settings.json","css!DS/IssueComponents/IssueComponents.css"],function(e,t,s,n,i,r,a,o,l,c,d,u,m,p,f,h,g,v,b,C,E,I,y,S,w,T){"use strict";return t.extend({})}),define("DS/IssueComponents/team/MembersTileViewLayout",["UWA/Core","DS/IssueComponents/team/MembersGridUtil"],function(e,t){"use strict";return{}}),define("DS/IssueComponents/team/MembersDataGridView",["UWA/Class/View","DS/DataGridView/DataGridView","DS/CollectionView/ResponsiveTilesCollectionView","DS/IssueComponents/team/MembersDataGridViewToolbar","DS/IssueComponents/team/MembersFilterLayout","DS/IssueComponents/team/AddMembersLayout","DS/IssueComponents/team/MembersMenu","DS/IssueServices/services/PlatformServices","DS/CollectionView/CollectionViewStatusBar","i18n!DS/IssueComponents/assets/nls/IssueComponents"],function(e,t,s,n,i,r,a,o,l,c){"use strict";return e.extend({init:function(e){this._parent(e);this.membersDatagridView="","undefined"!=this.options.target&&null!=this.options.target&&(this.render(),this.membersDatagridView.inject(this.options.target),this.membersDatagridView.setStyle("width",this.options.target.offsetWidth))},render:function(){try{var e=this.processColumns(),l=this,d={treeDocument:this.options.treeDocument,columns:e,cellSelection:"none",rowSelection:"multiple",columnDragEnabledFlag:!1,cellDragEnabledFlag:!1,showRowIndexFlag:!1,identifier:widget.id+"_members",isEditable:!1,defaultColumnDef:{width:"auto",resizableFlag:!0,sortableFlag:!0},resize:{columns:!0},headersDimensions:{height:26},selection:{unselectAllOnEmptyArea:!0,toggle:!1,canMultiSelect:!0,enableListSelection:!0,renderingMode:"adaptive"},performances:{buildLinks:!1,enableColumnVirtualization:!0,useRequestAnimationFrameRendering:!0,preloadPool:!0},showContextualMenuColumnFlag:!0,enableExpandOnDoubleClick:!0,onContextualEvent:function(e){var t=[];if(e&&e.collectionView&&e.cellInfos){if(e.cellInfos.rowID>-1)return a.showRMBMenuOnGrid(l,e).then(function(e){return e});e.collectionView.columns.length,e.cellInfos.columnID;t=e.collectionView.buildDefaultContextualMenu(e,{pin:!0,firstColumnsVisibility:!0,columnsManagement:!1,sizeColumnToFit:!0})}return t}};d=UWA.merge(d,this.options);var u={model:this.options.treeDocument,height:"inherit",allowUnsafeHTMLContent:!0,displayedOptionalCellProperties:["contextualMenu","description","propertiesList","activeFlag"]};this.membersDatagrid=new t(d),this.membersDatagrid.layout.setColumnOrGroupProperties("ContextualMenuColumn",{text:c.team.columns.actions,width:60,isHidden:!1,visibleFlag:!0,defaultVisibility:!0,pinned:"right"}),this.tileView=new s(u);var m={callback:function(e){if(e&&e.cellInfos&&e.cellInfos.cellModel)return a.showRMBMenuOnGrid(l,e).then(function(e){return e})}};this.tileView.onContextualEvent=m;this.membersDatagrid.getTypeRepresentationFactory().registerTypeRepresentations({sortingdropdown:{stdTemplate:"functionMenuIcon",semantics:{label:"action",icon:"plus"}}}),n.toolbar=this.membersDatagrid.setToolbar(n.writetoolbarDefinition()),this.toolbar=n.toolbar,(l=this).membersDatagrid.getTreeDocument().getXSO().onAdd(function(e){if(e.getTreeDocument()){var t=e.getTreeDocument().getSelectedNodes().length;require(["DS/IssueComponents/team/MembersDataGridLayout"],function(e){0===t?e.membersDataGridView.membersDatagrid.getToolbar().updateNodeModel("remove",{disabled:!0}):e.membersDataGridView.membersDatagrid.getToolbar().updateNodeModel("remove",{disabled:!1})})}}),l.membersDatagrid.getTreeDocument().getXSO().onRemove(function(e){0==e.getTreeDocument().getSelectedNodes().length&&require(["DS/IssueComponents/team/MembersDataGridLayout"],function(e){e.membersDataGridView.membersDatagrid.getToolbar().updateNodeModel("remove",{disabled:!0})})}),l.membersDatagrid.getTreeDocument().onNodeModelUpdate(function(e){require(["DS/IssueComponents/team/MembersDataGridLayout"],function(e){var t=o.getUserName();(e.membersDataGridModel.assignees.getChildren()?e.membersDataGridModel.assignees.getChildren():[]).filter(e=>e.options.grid.user===t).length>0?e.membersDataGridView.membersDatagrid.getToolbar().updateNodeModel("assigntoself",{visibleFlag:!1}):e.membersDataGridView.membersDatagrid.getToolbar().updateNodeModel("assigntoself",{visibleFlag:!0})})}),this.membersDatagridView=UWA.createElement("div",{id:"iss-outer-member-grid-div",class:"outer-member-grid-div"});var p=UWA.createElement("div",{styles:{width:"100%"},class:"toolbar-member-grid-div"});this.toolbar.inject(p);var f=UWA.createElement("div",{class:"iss-member-grid-div expanded-header-height hideView"}),h=UWA.createElement("div",{class:"iss-member-tile-div membertileView expanded-header-height"}),g=UWA.createElement("div",{styles:{position:"relative"},class:"iss-member-filter-div memberfilterView hideView"}),v=UWA.createElement("div",{styles:{position:"relative"},class:"iss-add-member-div addmemberView hideView"}),b=UWA.createElement("div",{class:"hideView",id:"issMemberEmptyTileViewDiv"});UWA.createElement("div",{html:c.team.datagridPlaceholder}).inject(b);var C={target:g,model:this.options.treeDocument},E={target:v,model:this.options.treeDocument};this.membersFilterLayout=i,i.createMemberFilter(C),r.createAddMemberPanel(E),this.membersDatagrid.inject(f),this.tileView.inject(h),b.inject(h),this.membersDatagridView.addContent(p),this.membersDatagridView.addContent(g),this.membersDatagridView.addContent(v),this.membersDatagridView.addContent(f),this.membersDatagridView.addContent(h)}catch(e){}},processColumns:function(){return this.options.columns},reapplySortModel:function(){this.membersDatagrid.reapplySortModel()}})}),define("DS/IssueComponents/create/Related",["UWA/Class/Promise","UWA/Class/View","UWA/Core","DS/UIKIT/Form","DS/UIKIT/Iconbar","DS/Controls/TooltipModel","DS/ENOFloatingPanel/ENOFloatingPanel","DS/Logger/Logger","DS/PADUtils/views/PADAlert","DS/Tree/TreeListView","DS/TreeModel/TreeNodeModel","DS/Visualization/ThreeJS_DS","DS/IssueCommon/commands/CommandsManager","DS/IssueComponents/utils/Utils","DS/IssueServices/Contexts","DS/IssueServices/services/IssueServices","DS/IssueServices/services/PlatformServices","DS/IssueServices/utils/Parser","DS/IssueServices/utils/Performance","i18n!DS/IssueComponents/assets/nls/IssueComponents","css!DS/IssueComponents/IssueComponents.css"],function(e,t,s,n,i,r,a,o,l,c,d,u,m,p,f,h,g,v,b,C){"use strict";var E="ENX3DIR_AP",I="Issue",y={CONTEXTS:"contexts",REPORTED_AGAINST:"reportedAgainst"};return t.extend({name:"DS/IssueComponents/create/Related",tag:"div",className:"create-view-content-subview create-related",defaultOptions:{treelist:{grid:{height:"100%",apiVersion:2,defaultCellHeight:26,useTransparentScroller:!1,useNativeScroller:!1,useAsyncPreExpand:!0,resize:{columns:!0,rows:!1},selection:{unselectAllOnEmptyArea:!0,toggle:!1,canMultiSelect:!0,enableListSelection:!0,renderingMode:"adaptive"},columns:[{text:C.create.related.treelist.tree,dataIndex:"tree",width:"auto",isDraggable:!1},{text:C.create.related.treelist["ds6w:type"],width:"auto",dataIndex:"ds6w:type",isDraggable:!1},{text:C.create.related.treelist["ds6w:identifier"],width:"auto",dataIndex:"ds6w:identifier",isDraggable:!1},{text:C.create.related.treelist["ds6wg:revision"],width:"auto",dataIndex:"ds6wg:revision",isDraggable:!1}]}}},isInit:null,_deferredInit:{resolve:null,reject:null},setup:function(t){var s=this;s._parent(t),s.parent=t.parent,s.isInit=new e(function(e,t){s._deferredInit.resolve=e,s._deferredInit.reject=t}),s.form=null,s.formElements={reportedAgainst:null,contexts:null},s.formElementsToggler={reportedAgainst:null,contexts:null},s.fields={reportedAgainst:{},contexts:{},balloons:null},s._deferredInit.resolve()},destroy:function(){this.fields.reportedAgainst.treeList&&this.fields.reportedAgainst.treeList.getRoots().forEach(function(e){if(e.options.position&&e.options.position.balloons&&e.options.position.balloons.length)for(var t=e.options.position.balloons,s=0;s<t.length;s++)e.options.position.balloons[s].destroy()}),this.form=null,this.formElements={reportedAgainst:null,contexts:null},this.formElementsToggler={reportedAgainst:null,contexts:null},this.fields={reportedAgainst:{},contexts:{},balloons:null}},render:function(){return this._renderReportedAgainstField(),this._renderContextField(),this.form=new n({className:"create-related-form",fields:[],events:{onInvalid:function(){}}}).inject(this.container),s.createElement("div",{class:"create-form-content",html:[this.formElements.reportedAgainst=s.createElement("div",{class:"create-form-element create-related-form-element-reported-against",html:[{tag:"div",class:"create-form-visibility-mask"},{tag:"div",class:"create-form-visibility-toggle",html:[this.formElementsToggler.reportedAgainst=s.createElement("span",{class:"fonticon fonticon-eye"})]},{tag:"div",class:"create-form-field form-group",html:[this.fields.reportedAgainst.title,this.fields.reportedAgainst.treeListContainer]},{tag:"div",class:"create-form-help-tooltip",html:[this.fields.reportedAgainst.help]}]}),this.formElements.contexts=s.createElement("div",{class:"create-form-element create-related-form-element-contexts",html:[{tag:"div",class:"create-form-visibility-mask"},{tag:"div",class:"create-form-visibility-toggle",html:[this.formElementsToggler.contexts=s.createElement("span",{class:"fonticon fonticon-eye"})]},{tag:"div",class:"create-form-field form-group",html:[this.fields.contexts.title,this.fields.contexts.treeListContainer]},{tag:"div",class:"create-form-help-tooltip",html:[this.fields.contexts.help]}]})]}).inject(this.form.elements.container),this},getValues:function(){var e=[];this.fields.reportedAgainst.treeList.getDocument().getRoots().forEach(function(t){var s=t.options.id.split(","),n={physicalId:s[s.length-1],path:s};e.push(n),t.options.hasOwnProperty("position")&&null!==t.options.position&&void 0!==t.options.position&&(n.position={x:t.options.position.x,y:t.options.position.y,z:t.options.position.z})});var t=[];return this.fields.contexts.treeList.getDocument().getRoots().forEach(function(e){var s={physicalId:e.options.id};t.push(s)}),{reportedAgainst:e,contexts:t}},getHiddenAttributes:function(){var e={};for(var t in this.formElements)s.is(this.formElementsToggler[t])&&(e[t]=this.formElementsToggler[t].hasClassName("fonticon-eye-off"));return e},applyTemplate:function(t){var n=this;return n.reset().then(function(){var i=[];if(Array.isArray(t.data.reportedAgainst)&&t.data.reportedAgainst.length>0&&t.data.reportedAgainst.forEach(function(t){var r=t.position&&s.is(t.position,"object"),a=[];Array.isArray(t.path)?a=t.path:a.push(t.physicalId);var o=s.merge(t.automation||{},{assignee:!1,context:!1});if(!0===r){var l=f.get("widget").name===E,c=f.get("component"),d=c&&"getManager"in c&&c.getManager(),u=[],m={};if(m[a.join()]={x:Number(t.position.x),y:Number(t.position.y),z:Number(t.position.z),balloons:[]},l&&d&&(u=c.getManager().getNodesById(t.physicalId)),u.hasOwnProperty("nodes")&&u.nodes.length>0){for(var p=[],h=0;h<u.nodes.length;h++){u.paths[h].toString().includes(a.toString())&&p.push(new e(function(e){n._addBalloon(m[a.join()],t.physicalId,u.paths[h],function(){m[a.join()].balloons.push(this),e()})}))}i.push(e.all(p).then(function(){return n.parent.elements.dialog.show(),n._addNodes([a.join()],y.REPORTED_AGAINST,m,!o.assignee)}))}else i.push(n._addNodes([a.join()],y.REPORTED_AGAINST,m,!o.assignee))}else i.push(n._addNodes([a.join()],y.REPORTED_AGAINST,null,!o.assignee))}),Array.isArray(t.data.contexts)&&t.data.contexts.length>0&&i.push(n._addNodes(t.data.contexts.map(function(e){return e.physicalId}),y.CONTEXTS)),s.is(t.hidden,"object")&&s.is(n.formElements,"object")&&s.is(n.formElementsToggler,"object")){var r=n.formElements,a=n.formElementsToggler;for(var o in r)!0===t.hidden[o]&&(n.parent.isTemplate?(s.is(r[o])&&r[o].toggleClassName("visibility-masked",!0),s.is(a[o])&&(a[o].toggleClassName("fonticon-eye-off",!0),a[o].toggleClassName("fonticon-eye",!1))):s.is(r[o])&&r[o].hide())}return e.all(i)})},reset:function(){var t=this;return new e(function(e){var s=t.fields.reportedAgainst.treeList.getRoots();t._removeNodes(s,y.REPORTED_AGAINST),t._removeNodes(t.fields.contexts.treeList.getRoots(),y.CONTEXTS),e()})},_renderReportedAgainstField:function(){var t=this,n=f.get("widget").name===E;t.fields.reportedAgainst.help=s.createElement("div",{html:[s.createElement("span",{class:"fonticon fonticon-help"})]}),t.fields.reportedAgainst.help.tooltipInfos=new r({shortHelp:C.create.related.labels.reportedAgainstshortHelper,longHelp:C.create.related.labels.reportedAgainstlongHelper}),t.fields.reportedAgainst.title=s.createElement("div",{class:"create-form-title-with-iconbar",html:[{tag:"h5",html:C.create.related.labels.reportedAgainst}]}),t.fields.reportedAgainst.iconBar=new i({renderTo:t.fields.reportedAgainst.title,items:[{id:"location",fonticon:"location",text:C.create.related.addBalloonAvailable,handler:function(){var i=f.get("component"),r=function(i,r,a,o){for(var l=i.split(","),c=[],d=0;d<a.nodes.length;d++){var u=a.paths[d].toString().includes(l.toString());n?u&&c.push(new e(function(e){t._addBalloon(r[i],i,a.paths[d],function(){r[i].balloons.push(this),e()})})):c.push(e.resolve())}e.all(c).then(function(){t.parent.elements.dialog.show();var e=[t._addNodes([i],y.REPORTED_AGAINST,r)];return s.is(o,"string")&&e.push(t._addNodes([o],y.CONTEXTS)),e})};if(n)t.parent.elements.dialog.hide(),i.utils.selectIn3D(function(e,t,s,n){r(e,t,s,n)},function(){t.parent.elements.dialog.show()},[{isOccurenceSelection:!0}]);else{var a=i.taskManager.addSelectIn3DTask(function(e){var t=e.target,s=e.positions,n=e.nodes,o=e.context;r(t,s,n,o),i.unmaskForTask(a)},function(){i.unmaskForTask(a)},{isOccurenceSelection:!0});i.maskForTask(a,C.tasks.selectIn3D)}}},{id:"addReported",text:C.create.related.search,fonticon:"plus",handler:function(){var e=f.get("application");if(s.is(e,"object")&&e.isStandalone){var n=f.get("component"),i=n.taskManager.addObjectsTask(function(e){Array.isArray(e.physicalIds)&&t._addNodes(e.physicalIds,y.REPORTED_AGAINST),n.unmaskForTask(i)},function(){n.unmaskForTask(i)});n.maskForTask(i,C.tasks.addObjects)}else{var r=[I];h.type.getSubType().then(e=>{var s=e;null!=s&&Object.keys(s).length>1&&(r=Object.keys(s)),g.search({title:C.create.related.labels.reportedAgainst,default_search_criteria:"",callback:function(e){for(var s=[],n=0,i=0;i<e.length;i++)r.includes(e[i]["ds6w:type_value"])?n++:s.push(e[i].id);0===n?t._addNodes(s,y.REPORTED_AGAINST):l.displayNotification({msg:C.replace(C.resolveIssues.issueNotDroppable,{number:n}),eventID:"error"})},cancel:function(){}})})}}},{id:"removeReported",text:C.create.related.remove,fonticon:"remove",handler:function(){t._removeSelectedNodes(y.REPORTED_AGAINST)}}]}),t.fields.reportedAgainst.iconBar.disableItem("removeReported"),t.fields.reportedAgainst.treeListContainer=s.createElement("div",{class:"create-form-treelist treelist-empty",id:y.REPORTED_AGAINST,tabindex:"-1"}),t.fields.reportedAgainst.treeListPlaceholder=s.createElement("span",{class:"treelist-placeholder",html:C.create.related.labels.reportedAgainstPlaceholder}).inject(t.fields.reportedAgainst.treeListContainer),t._addDropEvent(t.fields.reportedAgainst.treeListContainer);var a=s.clone(t.options.treelist.grid);a.id=y.REPORTED_AGAINST,a.onDropBlank=t._onTreeListDrop.bind(t),a.onDropCell=t._onTreeListDrop.bind(t),a.onDragStartCell=t._onDragStartCell.bind(t),a.allowUnsafeHTMLContent=!1,t.addOccurencePathColumn(a),t.fields.reportedAgainst.treeList=new c(a),t.fields.reportedAgainst.treeList.inject(t.fields.reportedAgainst.treeListContainer)},addOccurencePathColumn:function(e){e.columns.splice(1,0,{text:C.create.related.treelist.occurrence,dataIndex:"occurrence",width:"auto",isDraggable:!1})},_renderContextField:function(){var e=this,t=f.get("widget").name===E;e.fields.contexts.help=s.createElement("div",{html:[s.createElement("span",{class:"fonticon fonticon-help"})]}),e.fields.contexts.help.tooltipInfos=new r({shortHelp:C.create.related.labels.contextshortHelper,longHelp:C.create.related.labels.contextlongHelper}),e.fields.contexts.title=s.createElement("div",{class:"create-form-title-with-iconbar",html:[{tag:"h5",html:C.create.related.labels.contexts}]}),e.fields.contexts.iconBar=new i({renderTo:e.fields.contexts.title,items:[{id:"location",fonticon:"location",text:C.create.related.selectContextIn3D,handler:function(){var s=f.get("component");if(t)e.parent.elements.dialog.hide(),s.utils.selectIn3D(function(t){e.parent.elements.dialog.show(),e._addNodes([t],y.CONTEXTS)},function(){e.parent.elements.dialog.show()});else{var n=s.taskManager.addSelectIn3DTask(function(t){var i=t.target;s.unmaskForTask(n),e._addNodes([i],y.CONTEXTS)},function(){s.unmaskForTask(n)});s.maskForTask(n)}}},{id:"addContext",text:C.create.related.search,fonticon:"plus",handler:function(){var t=f.get("application");if(s.is(t,"object")&&t.isStandalone){var n=f.get("component"),i=n.taskManager.addObjectsTask(function(t){Array.isArray(t.physicalIds)&&e._addNodes(t.physicalIds,y.CONTEXTS),n.unmaskForTask(i)},function(){n.unmaskForTask(i)});n.maskForTask(i,C.tasks.addObjects)}else{var r=[I];h.type.getSubType().then(t=>{var s=t;null!=s&&Object.keys(s).length>1&&(r=Object.keys(s)),g.search({title:C.create.related.labels.contexts,default_search_criteria:"",multiSel:!0,callback:function(t){for(var s=[],n=0,i=0;i<t.length;i++)r.includes(t[i]["ds6w:type_value"])?n++:s.push(t[i].id);0===n?e._addNodes(s,y.CONTEXTS):l.displayNotification({msg:C.replace(C.resolveIssues.issueNotDroppable,{number:n}),eventID:"error"})},cancel:function(){}})})}}},{id:"removeContext",text:C.create.related.remove,fonticon:"remove",handler:function(){e._removeSelectedNodes(y.CONTEXTS)}}]}),e.fields.contexts.iconBar.disableItem("removeContext"),e.fields.contexts.treeListContainer=s.createElement("div",{class:"create-form-treelist treelist-empty",id:y.CONTEXTS,tabindex:"-1"}),e.fields.contexts.treeListPlaceholder=s.createElement("span",{class:"treelist-placeholder",html:C.create.related.labels.contextPlaceholder}).inject(e.fields.contexts.treeListContainer),e._addDropEvent(e.fields.contexts.treeListContainer);var n=s.clone(e.options.treelist.grid);n.id=y.CONTEXTS,n.onDropBlank=e._onTreeListDrop.bind(e),n.onDropCell=e._onTreeListDrop.bind(e),n.onDragStartCell=e._onDragStartCell.bind(e),e.fields.contexts.treeList=new c(n),e.fields.contexts.treeList.inject(e.fields.contexts.treeListContainer)},_addNodesReportedAgainst:function(t,n,i,r){var a=this,o=a.fields[n].treeList;return new e(function(e,c){var u={skipped:{ids:[]},error:{ids:[]},result:{ids:[]}},m=[],p=s.clone(t);o.getRoots().forEach(function(e){var t=p.indexOf(e.options.id);-1!==t&&(p.splice(t,1),u.skipped.ids.push(e.options.id),m.push(e))}),m.forEach(function(e){if(i&&e.options.id in i){for(var t=e.options.position.balloons||[],s=0;s<t.length;s++)t[s].destroy();e.options.position=i[e.options.id]}});for(var f=[],g=0;g<p.length;g++)if(p[g]){var b=p[g].split(",");f.push(b[b.length-1])}else f.push(p);p.length?h.fetch({data:{objects:f.map(function(e){return{physicalId:e}})},onComplete:function(t){var s=t.body;s.infos&&s.infos.nresults&&f.length!==s.infos.nresults&&l.displayNotification({msg:C.create.templateApplyWarningRelated,eventID:"warning"});var m=[];s.infos&&s.infos.nresults&&s.infos.nresults>0?(o.getDocument().withTransactionUpdate(function(){if("results"in s){var e={};s.results.forEach(function(t){var s=v.parseFetchResponse(t);e[s.value.id]=s},c)}else c(t);for(var l=0;l<p.length;l++){var f={label:null,icons:[],grid:{}},h=p[l].split(","),g=e[h[h.length-1]];if(f.icons.push(g.value.typeIcon),f.id=p[l],f.grid["ds6w:label"]=g.display.title,f.label=g.display.title,f.title=g.display.title,f.grid["ds6w:type"]=g.display.type,f.type=g.value.type,f.grid["ds6w:identifier"]=g.display.name,f.name=g.value.name,f.grid["ds6wg:revision"]=g.display.revision,f.revision=g.value.revision,f.grid["ds6w:organizationResponsible"]=g.display.organization,f.organizationResponsible=g.value.organization,f.grid["ds6w:responsible"]=g.display.responsible,f.responsible=g.value.responsible,f.grid.owner=g.display.owner,f.owner=g.value.owner,"Issue"===f.type)u.error.ids.push(f.id);else{var b=new d(f);if(i&&b.options.id in i&&(b.options.position=i[b.options.id]),b.onSelect(function(e){n===y.REPORTED_AGAINST?a.fields.reportedAgainst.iconBar.enableItem("removeReported"):n===y.CONTEXTS&&a.fields.contexts.iconBar.enableItem("removeContext")}),b.onUnselect(function(e){0===o.getDocument().getSelectedNodes().length&&(n===y.REPORTED_AGAINST?a.fields.reportedAgainst.iconBar.disableItem("removeReported"):n===y.CONTEXTS&&a.fields.contexts.iconBar.disableItem("removeContext"))}),o.addRoot(b),m.push(b),u.result.ids.push(f.id),!r&&n===y.REPORTED_AGAINST)"true"===localStorage.getItem("assignPreferenceTemplate")&&a.parent.dispatchEvent("related-add-reportedAgainst",{data:b.options})}}}),a.fetchOccurencePath(m,p,o),o.getDocument().getRoots().length&&a.fields[n].treeListContainer.removeClassName("treelist-empty"),e(u)):e(u)},onFailure:function(e){c(e)}}):e(u)})},_addNodes:function(t,n,i,r){var a=this;if(n!=y.REPORTED_AGAINST){var o=a.fields[n].treeList;return new e(function(e,c){var u={skipped:{ids:[]},error:{ids:[]},result:{ids:[]}},m=[],p=s.clone(t);o.getRoots().forEach(function(e){var t=p.indexOf(e.options.id);-1!==t&&(p.splice(t,1),u.skipped.ids.push(e.options.id),m.push(e))}),m.forEach(function(e){if(i&&e.options.id in i){for(var t=e.options.position.balloons||[],s=0;s<t.length;s++)t[s].destroy();e.options.position=i[e.options.id]}}),p.length?h.fetch({data:{objects:p.map(function(e){return{physicalId:e}})},onComplete:function(t){var s=t.body;s.infos&&s.infos.nresults&&p.length!==s.infos.nresults&&l.displayNotification({msg:C.create.templateApplyWarningRelated,eventID:"warning"}),s.infos&&s.infos.nresults&&s.infos.nresults>0?(o.getDocument().withTransactionUpdate(function(){"results"in s?s.results.forEach(function(e){var t={label:null,icons:[],grid:{}},s=v.parseFetchResponse(e);if(t.icons.push(s.value.typeIcon),t.id=s.value.id,t.grid["ds6w:label"]=s.display.title,t.label=s.value.title,t.title=s.value.title,t.grid["ds6w:type"]=s.display.type,t.type=s.value.type,t.grid["ds6w:identifier"]=s.display.name,t.name=s.value.name,t.grid["ds6wg:revision"]=s.display.revision,t.revision=s.value.revision,t.grid["ds6w:organizationResponsible"]=s.display.organization,t.organizationResponsible=s.value.organization,t.grid["ds6w:responsible"]=s.display.responsible,t.responsible=s.value.responsible,t.grid.owner=s.display.owner,t.owner=s.value.owner,"Issue"===t.type)u.error.ids.push(t.id);else{var l=new d(t);if(i&&l.options.id in i&&(l.options.position=i[l.options.id]),l.onSelect(function(e){n===y.REPORTED_AGAINST?a.fields.reportedAgainst.iconBar.enableItem("removeReported"):n===y.CONTEXTS&&a.fields.contexts.iconBar.enableItem("removeContext")}),l.onUnselect(function(e){0===o.getDocument().getSelectedNodes().length&&(n===y.REPORTED_AGAINST?a.fields.reportedAgainst.iconBar.disableItem("removeReported"):n===y.CONTEXTS&&a.fields.contexts.iconBar.disableItem("removeContext"))}),o.addRoot(l),u.result.ids.push(t.id),!r&&n===y.REPORTED_AGAINST)"true"===localStorage.getItem("assignPreferenceTemplate")&&a.parent.dispatchEvent("related-add-reportedAgainst",{data:l.options})}},c):c(t)}),o.getDocument().getRoots().length&&a.fields[n].treeListContainer.removeClassName("treelist-empty"),e(u)):e(u)},onFailure:function(e){c(e)}}):e(u)})}a._addNodesReportedAgainst(t,n,i,r)},_addBalloon:function(e,t,s,n){f.get("component").utils.createBalloon({id:t,position:e,path:s,color:"red",parent:this,temporary:!0}).then(function(e){n.call(e)})},_removeSelectedNodes:function(e){var t=this.fields[e].treeList.getDocument().getSelectedNodes();t.length?this._removeNodes(t,e):l.displayNotification({msg:C.create.related.removeErrorNoSelection,eventID:"warning"})},_removeNodes:function(e,t){var s=this.fields[t].treeList;s.getDocument().withTransactionUpdate(function(){for(var t=e.length-1;t>=0;t--){var n=e[t];if(n.options.position&&n.options.position.balloons&&n.options.position.balloons.length)for(var i=n.options.position.balloons,r=0;r<i.length;r++)n.options.position.balloons[r].destroy();s.getDocument().removeRoot(n)}}),0===s.getDocument().getRoots().length&&this.fields[t].treeListContainer.addClassName("treelist-empty")},_addDropEvent:function(e){var t=0;e.addEventListener("drop",this._onTreeListDrop.bind(this)),e.addEventListener("dragenter",function(){e.addClassName("drag-enter"),t++}),e.addEventListener("dragleave",function(){0===--t&&e.removeClassName("drag-enter")}),document.addEventListener("dragover",function(e){e.preventDefault()})},_onTreeListDrop:function(e,t){e.currentTarget.removeClassName("drag-enter"),e.preventDefault();var s,n;if(s=t?t.parent.options.id:e.currentTarget.id,""!==e.dataTransfer.getData("text/searchitems"))n=JSON.parse(e.dataTransfer.getData("text/searchitems"));else if(""!==e.dataTransfer.getData("text/plain"))try{n=JSON.parse(e.dataTransfer.getData("text/plain"))}catch(e){}if(n){var i=n.data.items,r=[];i.forEach(function(e){"objectId"in e&&r.push(e.objectId)}),this._addNodes(r,s).then(function(e){e.error&&e.error.ids&&e.error.ids.length>0&&l.displayNotification({msg:C.create.related.dropError,eventID:"error"})})}else l.displayNotification({msg:C.create.related.dropError,eventID:"error"})},_onDragStartCell:function(e,t){var n="";n=s.is(t,"object")?t.parent.options.id:e.currentTarget.id;var i=this.fields[n].treeList.getDocument().getSelectedNodes();if(0===i.length)return!1;var r=p.setDroppableData(i),a={type:r.type,data:JSON.stringify(r.data)};return e.dataTransfer.setData(a.type,a.data),this._ghost&&(this._ghost.destroy(),this._ghost=null),this._ghost=p.createGhostDrag(t.nodeModel.options,i.length),document.body.appendChild(this._ghost),e.dataTransfer.setDragImage(this._ghost,e.offsetX,e.offsetY),!0},fetchOccurencePath:function(e,t,s){var n=[];if(0!=e.length){for(var i=0;i<t.length;i++)if(t[i])for(var r=t[i].split(","),a=0;a<r.length;a++)0!=a&&a%2!=1&&a!=r.length-1||n.push(r[a]);h.fetch({data:{objects:n.map(function(e){return{physicalId:e}})},onComplete:function(t){var i=t.body;if(i.infos&&i.infos.nresults&&n.length!==i.infos.nresults&&l.displayNotification({msg:C.create.templateApplyWarningRelated,eventID:"warning"}),i.infos&&i.infos.nresults&&i.infos.nresults>0){var r={};e.forEach(function(e){r[e.options.id]="NewNode"}),s.getDocument().withTransactionUpdate(function(){var e={};"results"in i&&i.results.forEach(function(t){var s=v.parseFetchResponse(t);e[s.value.id]=s});for(var t=s.getRoots(),n=0;n<t.length;n++)if("NewNode"==r[t[n].options.id]){var a=t[n].options.id.split(","),o="",l="";a.length>0&&(o=e[a[a.length-1]].display.title);for(var c=0;c<a.length;c++)e[a[c]]&&c!=a.length-1&&(l+=e[a[c]].display.title,c!=a.length-2&&(l+="\\"));var d=t[n]._options.grid;1==a.length?(d.occurrence="",d["ds6w:label"]=o):(d.occurrence=l,d["ds6w:label"]=l),t[n].updateOptions({grid:d}),t[n].setLabel(o),t[n].options.title=o}})}},onFailure:function(e){}})}}})}),define("DS/IssueComponents/team/MembersDataGridLayout",["DS/IssueComponents/team/MembersDataGridView","DS/IssueComponents/team/MembersTileViewLayout","DS/IssueComponents/team/MembersGridUtil","DS/IssueComponents/team/MembersDataGridModel","DS/IssueComponents/team/AddMembersLayout","DS/IssueComponents/team/MembersDataGridViewToolbar","DS/IssueServices/services/IssueServices","DS/IssueCommon/utils/Utils","DS/Windows/ImmersiveFrame","DS/Windows/Dialog","DS/Controls/Button","DS/Controls/TooltipModel","DS/PADUtils/views/PADAlert","DS/UIKIT/Mask","i18n!DS/IssueComponents/assets/nls/IssueComponents"],function(e,t,s,n,i,r,a,o,l,c,d,u,m,p,f){"use strict";var h={createMembersView:function(t){this.view=t;var i={};(i=UWA.merge(i,t.options)).columns=s.getColumns(),this.membersDataGridModel=new n(t.options.id),i.treeDocument=this.membersDataGridModel.createTreeDocument(),this.membersTreeModel=i.treeDocument;var r=new e(i);this.membersDataGridView=r,this._customizeColumnRendering(i.columns);this.membersDataGridView.membersDatagrid;return this.loadContent(i.physicalIds)},loadContent:function(e){var t=this;return t.physicalIds=e,t.membersTreeModel.removeRoots(),new Promise(function(s,n){a.issues.retrieve({timestamp:t._timestampUpdate?t._timestampUpdate:null,data:{objects:e.map(function(e){return{physicalId:e}})},onComplete:function(e){var i;t.physicalIds.length>1?(t.membersDataGridView.membersDatagrid.layout.setColumnVisibleFlag("propagate",!0),t.membersDataGridView.membersDatagrid.layout.setColumnVisibleFlag("memberof",!0),!(i=r.toolbar.getNodeModelByID("propagate"))||0!=i.options.grid.semantics.visibleFlag&&void 0!==i.options.grid.semantics.visibleFlag||i.updateOptions({grid:{semantics:{visibleFlag:!0}}})):(t.membersDataGridView.membersDatagrid.layout.setColumnVisibleFlag("propagate",!1),t.membersDataGridView.membersDatagrid.layout.setColumnVisibleFlag("memberof",!1),!(i=r.toolbar.getNodeModelByID("propagate"))||1!=i.options.grid.semantics.visibleFlag&&void 0!==i.options.grid.semantics.visibleFlag||i.updateOptions({grid:{semantics:{visibleFlag:!1}}}));if(Array.isArray(e.results)){for(var a=e.results.map(function(e){return e.body}),o=[],l=0;l<a.length;l++){var c={id:a[l].physicalId,name:a[l].name,state:a[l].state,title:a[l].title?a[l].title:"",type:a[l].type,assignees:a[l].assignees,coOwners:a[l].coOwners,owner:a[l].owner,contributors:a[l].contributors,informedUsers:a[l].informedUsers};o.push(c)}t.issues=o;o&&o.length>0&&(t.owners=t.getUsersMap(o,"owner"),Object.keys(t.owners),Object.assign({},t.owners),t.coOwners=t.getUsersMap(o,"coOwners"),t.assignees=t.getUsersMap(o,"assignees"),t.contributors=t.getUsersMap(o,"contributors"),t.informedUsers=t.getUsersMap(o,"informedUsers"),Object.keys(t.owners).forEach(function(e){t.coOwners.hasOwnProperty(e)&&(t.owners[e].roles.includes("Co-owner")||t.owners[e].roles.push("Co-owner")),t.assignees.hasOwnProperty(e)&&(t.owners[e].roles.includes("Assignee")||t.owners[e].roles.push("Assignee")),t.contributors.hasOwnProperty(e)&&(t.owners[e].roles.includes("Contributor")||t.owners[e].roles.push("Contributor")),t.informedUsers.hasOwnProperty(e)&&(t.owners[e].roles.includes("InformedUser")||t.owners[e].roles.push("InformedUser"))}),Object.keys(t.coOwners).forEach(function(e){t.owners.hasOwnProperty(e)&&(t.coOwners[e].roles.includes("Owner")||t.coOwners[e].roles.push("Owner")),t.assignees.hasOwnProperty(e)&&(t.coOwners[e].roles.includes("Assignee")||t.coOwners[e].roles.push("Assignee")),t.contributors.hasOwnProperty(e)&&(t.coOwners[e].roles.includes("Contributor")||t.coOwners[e].roles.push("Contributor")),t.informedUsers.hasOwnProperty(e)&&(t.coOwners[e].roles.includes("InformedUser")||t.coOwners[e].roles.push("InformedUser"))}),Object.keys(t.assignees).forEach(function(e){t.owners.hasOwnProperty(e)&&(t.assignees[e].roles.includes("Owner")||t.assignees[e].roles.push("Owner")),t.coOwners.hasOwnProperty(e)&&(t.assignees[e].roles.includes("Co-owner")||t.assignees[e].roles.push("Co-owner")),t.contributors.hasOwnProperty(e)&&(t.assignees[e].roles.includes("Contributor")||t.assignees[e].roles.push("Contributor")),t.informedUsers.hasOwnProperty(e)&&(t.assignees[e].roles.includes("InformedUser")||t.assignees[e].roles.push("InformedUser"))}),Object.keys(t.contributors).forEach(function(e){t.owners.hasOwnProperty(e)&&(t.contributors[e].roles.includes("Owner")||t.contributors[e].roles.push("Owner")),t.assignees.hasOwnProperty(e)&&(t.contributors[e].roles.includes("Assignee")||t.contributors[e].roles.push("Assignee")),t.coOwners.hasOwnProperty(e)&&(t.contributors[e].roles.includes("Co-owner")||t.contributors[e].roles.push("Co-owner")),t.informedUsers.hasOwnProperty(e)&&(t.contributors[e].roles.includes("InformedUser")||t.contributors[e].roles.push("InformedUser"))}),Object.keys(t.informedUsers).forEach(function(e){t.owners.hasOwnProperty(e)&&(t.informedUsers[e].roles.includes("Owner")||t.informedUsers[e].roles.push("Owner")),t.assignees.hasOwnProperty(e)&&(t.informedUsers[e].roles.includes("Assignee")||t.informedUsers[e].roles.push("Assignee")),t.coOwners.hasOwnProperty(e)&&(t.informedUsers[e].roles.includes("Co-owner")||t.informedUsers[e].roles.push("Co-owner")),t.contributors.hasOwnProperty(e)&&(t.informedUsers[e].roles.includes("Contributor")||t.informedUsers[e].roles.push("Contributor"))})),t.membersDataGridModel.loadMembersData(t.membersTreeModel,t.owners,t.coOwners,t.assignees,t.contributors,t.informedUsers),h.changeView(),s()}else n(new Error("Unexpected response when retrieving issues."))},onFailure:function(e){m.displayNotification({msg:f.team.error.loadContent,eventID:"error"}),n(e)}})})},getUsersMap:function(e,t){var s={},n="";switch(t){case"owner":n="Owner";break;case"coOwners":n="Co-owner";break;case"assignees":n="Assignee";break;case"contributors":n="Contributor";break;case"informedUsers":n="InformedUser";break;default:console.log("Incorrect role")}return e&&e.length>0&&(s=e.reduce(function(s,i){if(i[t])if(Array.isArray(i[t]))for(var r=i[t],a=0;a<r.length;a++)i[t][a].roles=[n],i[t][a].type=r[a].type,void 0!==s[i[t][a].user]?(i[t][a].count=s[i[t][a].user].count+1,i[t][a].count==e.length?i[t][a].common=!0:i[t][a].common=!1):(i[t][a].count=1,i[t][a].common=!1),s[i[t][a].user]=i[t][a];else i[t].roles=[n],i[t].type="person",s[i[t].user]=i[t];return s},{})),s},_customizeColumnRendering:function(e){var t=this;e.forEach(function(e){switch(e.dataIndex){case"tree":e.onCellRequest=t.rendering.title.bind(t);break;case"propagate":e.onCellRequest=t.rendering.propagate.bind(t);break;case"user":break;case"memberof":e.onCellRequest=t.rendering.memberOf.bind(t);break;case"ContextualMenuColumn":e.hasCellValue=t.rendering.contextualMenuColumn.bind(t)}})},rendering:{title:function(e){var t="";if(e.nodeModel.options.grid.isRoot){var s=e.nodeModel.getNumberOfChildren();"Owner"===e.nodeModel.options.grid.role?t=UWA.createElement("span",{class:"member-title",html:f.team.owner.title+" ("+s+")"}):"Co-owner"===e.nodeModel.options.grid.role?t=UWA.createElement("span",{class:"member-title",html:f.team.coOwners.title+" ("+s+")"}):"Assignee"===e.nodeModel.options.grid.role?t=UWA.createElement("span",{class:"member-title",html:f.team.assignees.title+" ("+s+")"}):"Contributor"===e.nodeModel.options.grid.role?t=UWA.createElement("span",{class:"member-title",html:f.team.contributors.title+" ("+s+")"}):"InformedUser"===e.nodeModel.options.grid.role&&(t=UWA.createElement("span",{class:"member-title",html:f.team.informedUsers.title+" ("+s+")"}))}else t=this.membersDataGridModel.createCustomPersonNameField(e.nodeModel.options.grid);t.computeContentSize=function(){return this.getChildren().length>0&&this.getChildren()[1]?this.getChildren()[1].getDimensions().width+50:this.getDimensions().width+50},e.cellView.setReusableContent(t)},propagate:function(e){var t=this,s="",n=null;let i="";if(e.nodeModel.options.grid.isRoot||"Owner"===e.nodeModel.getParent().options.grid.role||1==t.physicalIds.length)n=UWA.createElement("span",{}),e.cellView.setReusableContent(n);else{var r=e.nodeModel.options.grid.common;n=UWA.createElement("span",{class:"propagate-column",html:UWA.createElement("span",{class:s})}),0==r&&(s="wux-ui-3ds wux-ui-3ds-propagate wux-ui-3ds-lg members-propagate",n.addContent(UWA.createElement("span",{class:s})),i=f.resolveIssues.tooltips.propagateTooltip,n.addEventListener("click",function(){var s=[e.nodeModel];t.propagateMember(s)}.bind(t))),e.cellView.setReusableContent(n)}n&&(n.tooltipInfos=new u({shortHelp:i,mouseRelativePosition:!1,position:"bottom"}))},memberOf:function(e){var t=null;if(e.nodeModel.options.grid.isRoot||"Owner"===e.nodeModel.getParent().options.grid.role)t=UWA.createElement("span",{}),e.cellView.setReusableContent(t);else{var s=e.nodeModel.options.grid.common;t=UWA.createElement("span",{class:"memberof-column"}),0==s&&this.physicalIds.length>1?t.addContent(UWA.createElement("span",{class:"memberof",html:f.team.common.varies})):t.addContent(UWA.createElement("span",{class:"memberof",html:f.team.common.allIssues})),e.cellView.setReusableContent(t)}},contextualMenuColumn:function(e){let t=!0;return t=!e.nodeModel.options.grid.isRoot}},propagateMember:function(e){for(var t=0;t<e.length;t++){var s=e[t].getParent().options.grid.role,n={identifier:e[t].options.grid.user,name:e[t].options.grid.fullName,type:e[t].options.grid.type},r=[],a=[],o=[],l=[];"Co-owner"==s?r.push(n):"Assignee"==s?a.push(n):"Contributor"==s?o.push(n):"InformedUser"==s&&l.push(n),i.addMembers(r,a,o,l,!1,"",e[t])}},propagateCoowners:function(e){e.role="coOwners",h.propagateMembers(e)},propagateAssignees:function(e){e.role="assignees",h.propagateMembers(e)},propagateContributors:function(e){e.role="contributors",h.propagateMembers(e)},propagateInformedUsers:function(e){e.role="informedUsers",h.propagateMembers(e)},propagateMembers:function(e){var t=[],s=[],n=[],r=[];if("coOwners"==e.role){var a=h.coOwners;for(var o in a){var l=a[o],c={identifier:l.user,name:l.fullName};t.push(c)}}if("assignees"==e.role){var d=h.assignees;for(var o in d){var u=d[o];c={identifier:u.user,name:u.fullName,type:u.type};s.push(c)}}if("contributors"==e.role){var m=h.contributors;for(var o in m){var p=m[o];c={identifier:p.user,name:p.fullName};n.push(c)}}if("informedUsers"==e.role){var f=h.informedUsers;for(var o in f){var g=f[o];c={identifier:g.user,name:g.fullName,type:g.type};r.push(c)}}i.addMembers(t,s,n,r,!0,e.role)},changeView:function(e){s.changeView("GridView")},addNodesInLayout:function(e,t){h.membersDataGridModel.addNodesInLayoutModel(this.membersTreeModel,e,t)},removeHandler:function(){var e=h.membersDataGridModel.treeDocument.getSelectedNodes(),t=e[0].options.grid.roles,s=(t.indexOf("Owner"),1==t.length&&t.indexOf("Owner")>=0);if(1==e.length&&s)m.displayNotification({msg:f.team.error.warnRemoveOwner,eventID:"warning"});else{var n=new l({}),i=document.getElementById("iss-outer-member-grid-div");n.inject(i),new c({immersiveFrame:n,title:f.team.removeTitle,content:f.team.removeMessage,activeFlag:!1,modelFlag:!0,width:500,buttons:{No:new d({domId:"removeMemberNo",onClick:function(e){n.destroy()}}),Yes:new d({domId:"removeMemberYes",onClick:function(e){n.destroy(),h.membersDataGridModel.removeChildren()}})}}).addEventListener("close",function(e){n&&n.destroy()})}},updatePersonRole:function(e,t){console.log("updatePersonRole");var s=h.membersTreeModel.getSelectedNodes();if(s.length>0){for(var n=[],i=[],r=[],a=[],o=t.role,l=Array.isArray(o)?t[o[0]]:t[o],c=0;c<s.length;c++){var d=s[c].options.grid.user,u=s[c].options.grid.type;s[c].options.grid.roles;o.indexOf("Contributor")>=0&&n.push({user:d}),o.indexOf("Assignee")>=0&&i.push({user:d,type:u}),o.indexOf("Coowner")>=0&&r.push({user:d}),o.indexOf("InformedUser")>=0&&a.push({user:d,type:u})}"DISCONNECT"==l&&1==t.showConfirmation?h.showConfirmationDialog(l,r,i,n,a):h.updateMembers(l,r,i,n,a,!1)}},showConfirmationDialog:function(e,t,s,n,i){var r=new l({}),a=document.getElementById("iss-outer-member-grid-div");r.inject(a),new c({immersiveFrame:r,title:f.team.removeTitle,content:f.team.removeMessage,activeFlag:!1,modelFlag:!0,width:500,buttons:{No:new d({domId:"removeMemberNo",onClick:function(e){r.destroy()}}),Yes:new d({domId:"removeMemberYes",onClick:function(a){r.destroy(),h.updateMembers(e,t,s,n,i,!0)}})}}).addEventListener("close",function(e){r&&r.destroy()})},updateMembers:function(e,t,n,i,r,l){var c=this,d=[],u="",g=document.getElementById("iss-outer-member-grid-div");p.mask(g);for(var v=0;v<c.issues.length;v++){var b={physicalId:c.issues[v].id};t.length>0&&(b.coOwners=t,u="Co-owner"),n.length>0&&(b.assignees=n,u="Assignee"),i.length>0&&(b.contributors=i,u="Contributor"),r.length>0&&(b.informedUsers=r,u="InformedUser"),d.push(b)}"CONNECT"===e?a.people.update({data:{objects:d}}).then(function(){var e=h.membersTreeModel,t=e.getSelectedNodes()[0];e.prepareUpdate();var n=t.options.grid.role,i=t.options.description,r=s.getRoleNLSValue(u);let a=","+u,o=", "+r;var l=i.concat(o);h.membersDataGridModel.treeDocument.getAllDescendants().forEach(function(e){e.options.grid.user===t.options.grid.user&&(e.setAttribute("roleList",l),e.options.description=l,e.options.grid.role=n.concat(a),e.options.grid.roles.push(u))});var d={};d.user=t.options.grid.user,d.fullName=t.options.grid.fullName,d.roles=t.options.grid.roles,d.type=t.options.grid.type,"Co-owner"===u?h.addNodesInLayout([d],"coowners"):"Assignee"===u?h.addNodesInLayout([d],"assignees"):"Contributor"===u?h.addNodesInLayout([d],"contributors"):"InformedUser"===u&&h.addNodesInLayout([d],"informedUsers"),e.pushUpdate(),c.view.dispatchEvent("onUpdate",{issues:h.issues}),p.unmask(g)}).catch(function(e){if(p.unmask(g),e.error.message.includes("'business object' does not exist")){var t=o.getErrorMessage("0");o.displayErrorMessage(t,"error")}else if(UWA.is(e.error.internal)&&e.error.internal.includes("You do not have the permissions to perform this action")){t=o.getErrorMessage("1");o.displayErrorMessage(t,"error")}else if(UWA.is(e.error.internal)&&e.error.internal.includes("No toconnect access to business object")){t=o.getErrorMessage("10");o.displayErrorMessage(t,"error")}else if(UWA.is(e.error.internal)&&e.error.internal.includes("No 'modify' access on Attribute 'Co-Owners' for")){t=o.getErrorMessage("2005");o.displayErrorMessage(t,"error")}else m.displayNotification({msg:e.error.message,eventID:"error"})}):"DISCONNECT"===e&&a.people.delete({data:{objects:d}}).then(function(){var e=h.membersTreeModel,t=e.getSelectedNodes(),n=!1;if(1==l)for(var i=0;i<t.length;i++){t[i].options.grid.roles.indexOf("Owner")>=0&&(n=!0),(a=h.membersDataGridModel.treeDocument.getAllDescendants()).forEach(function(e){e.options.grid.user===t[i].options.grid.user&&("Owner"!=e.getParent().options.grid.role?e.remove():e.options.grid.roles=["Owner"])})}else{e.prepareUpdate();var r=e.getSelectedNodes()[0],a=h.membersDataGridModel.treeDocument.getAllDescendants(),o=r.options.grid.role,d=r.options.description,v=s.getRoleNLSValue(u),b=s.removeRole(d,v);a.forEach(function(e){if(e.options.grid.user===r.options.grid.user)if(e.getParent().options.grid.role==u)e.remove();else{e.setAttribute("roleList",b),e.options.description=b,e.options.grid.role=s.removeRole(o,u);var t=r.options.grid.roles.filter(function(e,t,s){return e!=u});e.options.grid.roles=t}}),e.pushUpdate()}h.membersDataGridModel.coowners.setLabel(f.team.coOwners.title+" ("+h.membersDataGridModel.coowners.getNumberOfChildren()+")"),h.membersDataGridModel.assignees.setLabel(f.team.assignees.title+" ("+h.membersDataGridModel.assignees.getNumberOfChildren()+")"),h.membersDataGridModel.contributors.setLabel(f.team.contributors.title+" ("+h.membersDataGridModel.contributors.getNumberOfChildren()+")"),h.membersDataGridModel.informedUsers.setLabel(f.team.informedUsers.title+" ("+h.membersDataGridModel.informedUsers.getNumberOfChildren()+")"),n&&m.displayNotification({msg:f.team.error.skipRemoveOwner,eventID:"info"}),c.view.dispatchEvent("onUpdate",{issues:h.issues}),p.unmask(g)}).catch(function(e){if(p.unmask(g),e.error.message.includes("'business object' does not exist")){var t=o.getErrorMessage("0");o.displayErrorMessage(t,"error")}else if(UWA.is(e.error.internal)&&(e.error.internal.includes("No 'modify' access on Attribute 'Co-Owners' for")||e.error.internal.includes("No 'read' access on Attribute 'Co-Owners' for")||e.error.internal.includes("You do not have the permissions to perform this action"))){t=o.getErrorMessage("1");o.displayErrorMessage(t,"error")}else m.displayNotification({msg:e.error.message,eventID:"error"})})}};return h}),define("DS/IssueComponents/team/TeamNew",["UWA/Class/Promise","UWA/Class/View","UWA/Core","DS/UIKIT/Mask","DS/Logger/Logger","DS/IssueComponents/team/MembersDataGridLayout","i18n!DS/IssueComponents/assets/nls/IssueComponents","css!DS/IssueComponents/IssueComponents.css"],function(e,t,s,n,i,r,a){"use strict";return t.extend({name:"DS/IssueComponents/team/TeamNew",tag:"div",className:"team-view-panel",setup:function(e){this._logger=i.getLogger("DS/IssueComponents/team/TeamNew"),this._logger.log("Initializing the team component"),this.isLoaded=null,this._deferred={resolve:null,reject:null},this.physicalIds=e.physicalIds,this.issues=[],this.options=e,this.reset()},reset:function(){var t=this;t.isLoaded=new e(function(e,s){t._deferred.resolve=e,t._deferred.reject=s}),s.is(t.view,"object")&&t.view.container&&t.view.container.destroy(),t.view={container:null}},destroy:function(){for(var e in this.view&&this.view.container&&this.view.container.destroy(),this)this.hasOwnProperty(e)&&delete this[e]},render:function(){var e=this;return n.mask(e.container),e.view={},e.view.container=s.createElement("div",{class:"team-view-container"}),e.options.target=e.view.container,e.view.container.inject(e.container),e.layout=r,r.createMembersView(e).then(function(){n.unmask(e.container),e._deferred.resolve()},function(t){n.unmask(e.container),e._deferred.reject(t),e.dispatchEvent("onFailure",{error:t})}),e},refresh:function(e){return Array.isArray(e)&&(this.physicalIds=e,this.setOption("physicalIds",e)),this.loadMembers(this.physicalIds),this.isLoaded},loadMembers:function(e){var t=this;return n.mask(t.container),r.loadContent(e).then(function(){n.unmask(t.container),t._deferred.resolve()},function(e){n.unmask(t.container),t._deferred.reject(e),t.dispatchEvent("onFailure",{error:e})}),t}})}),define("DS/IssueComponents/related/DatagridView",["UWA/Core","UWA/Class","UWA/Controls/Abstract","UWA/Class/Promise","DS/Core/Events","DS/Logger/Logger","DS/UIKIT/Input/Button","DS/UIKIT/Mask","DS/UIKIT/Scroller","DS/Tree/TreeDocument","DS/IssueComponents/models/TreeNodeModel","DS/DataGridView/DataGridView","DS/Controls/TooltipModel","DS/IssueServices/utils/Performance","DS/IssueServices/utils/Parser","DS/IssueServices/services/IssueServices","DS/IssueServices/services/PlatformServices","DS/IssueAttachmentManager/services/AttachmentServices","DS/IssueServices/Contexts","DS/IssueServices/utils/Views","DS/IssueComponents/utils/Utils","DS/IssueCommon/utils/Utils","DS/IssueCommon/utils/DocumentUtils","DS/LifecycleServices/LifecycleServicesSettings","DS/ENOFloatingPanel/ENOFloatingPanel","DS/PADUtils/views/PADAlert","DS/WebappsUtils/WebappsUtils","DS/Utilities/Dom","i18n!DS/IssueComponents/assets/nls/IssueComponents","css!DS/IssueComponents/IssueComponents.css"],function(e,t,s,n,i,r,a,o,l,c,d,u,m,p,f,h,g,v,b,C,E,I,y,S,w,T,D,A,_){"use strict";var O={ISSUE_TYPE:"Issue",TIMEOUT_UPDATE_COLUMN_WITH:250,REVISION_TARGETS:{STABLE_LATEST:"STABLE_LATEST",RELEASE_LATEST:"RELEASE_LATEST",LATEST:"LATEST"},CATEGORY_REPORTED_AGAINST:"reportedAgainst",CATEGORY_RESOLVED_BY:"resolvedBy",CATEGORY_CONTEXTS:"contexts",CATEGORY_RESOLVED_ITEMS:"resolvedItems",CATEGORY_REPORTED_AGAINST_INSTANCE:"reportedAgainst_instance",CATEGORY_RESOLVED_BY_INSTANCE:"resolvedBy_instance",CATEGORIES:[{CATEGORY_NAME:"reportedAgainst",CATEGORY_LABEL:_.open.labels.reportedAgainst,CATEGORY_ICON:"location"},{CATEGORY_NAME:"resolvedBy",CATEGORY_LABEL:_.open.labels.resolvedBy,CATEGORY_ICON:"docs"},{CATEGORY_NAME:"resolvedItems",CATEGORY_LABEL:_.open.labels.resolvedItems,CATEGORY_ICON:"markup-review"},{CATEGORY_NAME:"contexts",CATEGORY_LABEL:_.open.labels.contexts,CATEGORY_ICON:"3d-object"}],CATEGORY_NLS:{reportedAgainst:_.open.labels.reportedAgainst,resolvedBy:_.open.labels.resolvedBy,resolvedItems:_.open.labels.resolvedItems,contexts:_.open.labels.contexts}};return s.extend({name:"relatedcontent-datagridview",parentView:null,_logger:null,_publishSelection:!1,defaultOptions:{grid:{cellSelection:"none",cellDragEnabledFlag:!0,showRowIndexFlag:!1,showContextualMenuColumnFlag:!0,allowUnsafeHTMLContent:!0,apiVersion:2,defaultCellHeight:26,height:"100%",useAsyncPreExpand:!0,isEditable:!1,isSortable:!0,resize:{columns:!0},headersDimensions:{height:26},selection:{unselectAllOnEmptyArea:!0,toggle:!1,canMultiSelect:!0,enableListSelection:!0,renderingMode:"adaptive"},performances:{buildLinks:!1,enableColumnVirtualization:!0,useRequestAnimationFrameRendering:!0,preloadPool:!0},enableExpandOnDoubleClick:!0,placeholder:_.placeholder.emptyRelatedDatagridView,columns:[{text:_.resolveIssues.common,description:_.resolveIssues.propagate,dataIndex:"common",visibleFlag:!1,width:35,isDraggable:!0,icon:"propagate"},{text:_.resolveIssues.label,dataIndex:"tree",alwaysVisibleFlag:!0,width:200,isDraggable:!0},{text:_.create.related.treelist.occurrence,dataIndex:"occurrence",width:"auto",visibleFlag:!1,isDraggable:!0},{text:_.resolveIssues.type,dataIndex:"type",width:150,isDraggable:!0},{text:_.resolveIssues.name,dataIndex:"name",width:200,isDraggable:!0},{text:_.resolveIssues.revision,dataIndex:"revision",width:150,isDraggable:!0,className:"revisionPopup",typeRepresentation:"url"},{text:_.resolveIssues.state,dataIndex:"dispState",width:150,isDraggable:!0},{text:_.resolveIssues.isLastRevision,dataIndex:"isLastRevision",width:150,isDraggable:!0},{text:"Actions",dataIndex:"ContextualMenuColumn"}]}},callbacks:{onModifyGrid:null},destroy:function(){this.dgView&&(this.dgView=null)},init:function(e,t,s){var i=this;p.start(i.name+" init"),i._logger=r.getLogger("DS/IssueCommon/components/IssueContextsDatagridView"),i.relatedObjects=[],i.parentView=s,i._deferred={resolve:null,reject:null},i.dgView=null,i.tooltips=[],i.timestampLastRefresh=null,i.container=e,i.treeDocument=new c({useAsyncPreExpand:!0,shouldAcceptDrag:function(e){return 1!=e.options.grid.isCategory},shouldBeSelected:function(e){return 1!=e.options.grid.isCategory}}),i._customizeColumnRendering(i.defaultOptions.grid.columns);var a=b.get("widget")||window.widget;i.defaultOptions.grid.identifier=a.id+"_contents";var o=i.defaultOptions.grid;i.dgView=new u(o),i.dgView.treeDocument=i.treeDocument,i.dgView.inject(e),i.container.addClassName("issue-tree-list-view"),i.dgView.getCellTooltip=function(e){return i.dgView.getCellDefaultTooltip(e)},i.dgView.onContextualEvent=function(e){if(e&&e.cellInfos){var t=e.cellInfos;if(-1===t.rowID&&e.collectionView){return e.collectionView.buildDefaultContextualMenu(e,{pin:!0,firstColumnsVisibility:!0,columnsManagement:!1,sizeColumnToFit:!0})}if(t.nodeModel.options.grid.isCategory)return!1;if(t.nodeModel){var s,r=i._getTreeDocument().getSelectedNodes();r.length>1?(s=r,i._removeCategoryRootsFromSelection(s)):t.nodeModel&&(i.dgView.unselectAll(),t.nodeModel.select(),s=[t.nodeModel]);var a="blank";return s&&s.length>0&&(a="children"),i.getContextualMenu({type:a,models:s||[]})}return n.resolve()}return n.resolve()},i.dgView.layout.setColumnOrGroupProperties("ContextualMenuColumn",{text:_.columns.actionsColumn,width:50}),i.dgView.layout.setColumnOrGroupProperties("common",{width:20}),i.dgView.onDragStartCell=function(e,t){var s=i._getTreeDocument().getSelectedNodes();if(0===s.length)return!1;var n=E.setDroppableData(s),r={type:n.type,data:JSON.stringify(n.data)},a=n.data.data.items.length;return e.dataTransfer.setData(r.type,r.data),i._ghost&&(i._ghost.destroy(),i._ghost=null),i._ghost=E.createGhostDrag(t.nodeModel.options,a),document.body.appendChild(i._ghost),e.dataTransfer.setDragImage(i._ghost,e.offsetX,e.offsetY),!0}},_removeCategoryRoots:function(){this.dgView.getTreeDocument().removeRoots()},_getCategoryRoots:function(){return this.dgView.getTreeDocument().getRoots()},_getCategoryRoot:function(e){return this._getCategoryRoots().filter(t=>{if(t.options.grid.Name===e&&1==t.options.grid.isCategory)return t})[0]},_getTreeDocument:function(){return this.dgView.getTreeDocument()},_customizeColumnRendering:function(e){var t=this;e.forEach(function(e){switch(e.dataIndex){case"tree":break;case"common":e.onCellRequest=t.rendering.common.bind(t);break;case"isLastRevision":e.onCellRequest=t.rendering.isLastRevision.bind(t);break;case"revision":e.onCellRequest=t.rendering.revision.bind(t);break;case"ContextualMenuColumn":e.hasCellValue=t.rendering.contextualMenuColumn.bind(t);break;case"dispState":e.onCellRequest=t.rendering.state.bind(t)}})},rendering:{common:function(t){p.start(this.name+" rendering common");var s="",n=null;let i="";if(t.nodeModel.options.grid.isCategory)n=e.createElement("span",{}),t.cellView.setReusableContent(n);else{var r=t.nodeModel.options.common;n=e.createElement("span",{class:"clickable-column",html:e.createElement("span",{class:s})}),r||(s="wux-ui-3ds wux-ui-3ds-propagate wux-ui-3ds-lg related-propagate",n.addContent(e.createElement("span",{class:s})),i=_.resolveIssues.tooltips.propagateTooltip,n.addEventListener("click",function(){let e=t.nodeModel.getParent().options.grid.Name;this.propagate&&this.propagate([t.nodeModel],e)}.bind(this))),t.cellView.setReusableContent(n)}n&&(n.tooltipInfos=new m({shortHelp:i,mouseRelativePosition:!1,position:"bottom"})),p.end(this.name+" rendering common")},isLastRevision:function(t){p.start(this.name+" rendering isLastRevision");var s="";let n="";""!=t.nodeModel.options.type&&""!=t.nodeModel.options.revision&&null!=t.nodeModel.options.revision&&null!=t.nodeModel.options.isLastRevision&&null!=t.nodeModel.options.isLastRevision?1==t.nodeModel.options.isLastRevision?(s=e.createElement("div",{class:"isLastRevisionTrue wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-check"}),n=_.resolveIssues.tooltips.isLastRevision,t.cellView.setReusableContent(s)):0==t.nodeModel.options.isLastRevision&&(s=e.createElement("div",{class:"isLastRevisionFalse wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-wrong"}),n=_.resolveIssues.tooltips.isNotLastRevision,t.cellView.setReusableContent(s)):(s=e.createElement("div",{}),n="",t.cellView.setReusableContent(s)),s.tooltipInfos=new m({shortHelp:n,mouseRelativePosition:!1,position:"bottom"}),p.end(this.name+" rendering isLastRevision")},revision:function(t){var s="";s=e.createElement("div",{html:t.nodeModel.options.revision,class:"revisionColumn"}),null!=t.nodeModel.options.revision&&""!=t.nodeModel.options.revision&&"-"!=t.nodeModel.options.revision&&s.addEventListener("click",function(){I.showRevisionModal(t)}.bind(this)),t.cellView.setReusableContent(s)},contextualMenuColumn:function(e){let t=!0;return t=!e.nodeModel.options.grid.isCategory},state:function(t){var s="";if(null!=t.nodeModel.options.grid.dispState)s=e.createElement("div",{styles:{display:"inline-block"},html:e.createElement("span",{class:"related-list-cell-state "+t.nodeModel.options.grid.dispState.replace(/ /g,"").toLowerCase(),html:e.createElement("span",{class:"cell-state-content",html:t.nodeModel.options.grid.dispState})})});t.cellView.setReusableContent(s)}},load:function(e){var t=this;p.start(t.name+" load"),t.isLoaded=new n(function(e,s){t._deferred.resolve=e,t._deferred.reject=s}),t.issues=e,1===e.length?t.dgView.layout.setColumnVisibleFlag("common",!1):e.length>1&&t.dgView.layout.setColumnVisibleFlag("common",!0),t._removeCategoryRoots();var s=t.computeRelatedObjectsCommon(O.CATEGORIES[0].CATEGORY_NAME),i=t.computeRelatedObjectsCommon(O.CATEGORIES[1].CATEGORY_NAME),r=t.computeRelatedObjectsCommon(O.CATEGORIES[2].CATEGORY_NAME),a=t.computeRelatedObjectsCommon(O.CATEGORIES[3].CATEGORY_NAME);let o=[];if(o.push(s),o.push(i),o.push(r),o.push(a),t.timestampLastRefresh=null,s.length||i.length||r.length||a.length){t._createCategoryRoots();for(let e=0;e<o.length;e++)t.fetchRelatedObjects(o[e],!1).then(function(s){t.dgView.getTreeDocument().withTransactionUpdate(function(){t.timestampLastRefresh=Math.floor(Date.now());let n=t._getCategoryRoots()[e].options.grid.Name,i=t._getCategoryRoots()[e];for(let e=0;e<s.length;e++){let r=s[e];t.relatedObjects[n].objects[r.options.id]&&(r.options.common=t.relatedObjects[n].objects[r.options.id].common),i.addChild(r),t._refreshItemCount(i,n),t.relatedObjects[n].objects[r.options.id].model=r}s.length&&i.expandAll(),t._deferred.resolve()},function(){t._logger.error('An error occurred during "%s"',"load")})})}else t._deferred.resolve();p.end(t.name+" load")},_createCategoryRoots:function(){let e=O.CATEGORIES;for(let s=0;s<e.length;s++){var t=new d({label:e[s].CATEGORY_LABEL+" (0)",icons:[{iconName:e[s].CATEGORY_ICON}],grid:{isCategory:!0,Name:e[s].CATEGORY_NAME}});this.dgView.getTreeDocument().addRoot(t)}},updateRelatedObjectsCommon:function(e,t){var s=this;e.forEach(function(e){e.options.common=s.relatedObjects[t].objects[e.options.id].common})},computeRelatedObjectsCommon:function(e){var t=this,s=[];return t.issues.forEach(function(n){for(var i=t.utils.getRelatedObjects(n,e),r=0;r<i.length;r++){var a=i[r];-1===s.indexOf(a)&&s.push(a)}}),t.relatedObjects[e]={},t.relatedObjects[e].objects={},s.forEach(function(s){for(var n=!0,i=0;i<t.issues.length;i++){var r=t.utils.getRelatedObjects(t.issues[i],e);if(r&&-1===r.indexOf(s)){n=!1;break}}t.relatedObjects[e].objects[s]={},t.relatedObjects[e].objects[s].common=n}),s},fetch:function(e){var t=this;return p.start(t.name+" fetch"),new n(function(s,n){0!==e.length?h.fetch({data:{objects:e.map(function(e){return{physicalId:e}})},onComplete:function(i){var r=i.body;t._logger.log("fetch :Success..."),p.end(t.name+" fetch"),r.results&&r.results.length===e.length?s(r.results):(t._logger.error("fetch :Failure... Not indexed."),n(new Error("fetch :Failure... Not indexed.")))},onFailure:function(e){t._logger.error("fetch :Failure..."),t._logger.error(e),p.end(t.name+" fetch"),n(new Error("fetch :Failure..."))}}):s([])})},fetchRelatedObjects:function(e){for(var t=[],s=0;s<e.length;s++)for(var i=e[s].split(","),r=0;r<i.length;r++)0!=r&&r%2!=1&&r!=i.length-1||t.push(i[r]);var a=[...e];t=[...new Set(t)];var l=this;return new n(function(s){var n=[];o.mask(l.container),l.fetch(t).then(function(t){for(var i={},r=0;r<t.length;r++){var c=f.parseFetchResponse(t[r]);i[c.value.id]=c}for(var u=0;u<a.length;u++){var m=e[u].split(","),p=m[m.length-1],h=i[p],g="";m.length>0&&(g=i[m[m.length-1]].display.title);for(var v="",b=0;b<m.length;b++)i[m[b]]&&b!=m.length-1&&(v+=i[m[b]].display.title,b!=m.length-2&&(v+=" \\ "));var C=new d({id:e[u],pid:p,name:h.value.name,title:g,type:h.value.type,dispTypeValue:h.display.type,revision:h.value.revision,label:g,icons:[h.value.typeIcon],isLastRevision:h.value.isLastRevision,common:!0,state:h.value.state,grid:{name:h.display.name,type:h.display.type,revision:h.display.revision,dispState:h.display.state,occurrence:v}});n.push(C)}o.unmask(l.container),s(n)},function(){T.displayNotification({msg:_.resolveIssues.errorFetch,eventID:"error"}),o.unmask(l.container),l._deferred.reject()})})},addObjects:function(e,t,s){var n=this;p.start(n.name+" addObjects");var i=[].concat(e);i&&i.length&&i.forEach(function(e){for(var t=0,s=0;s<i.length;s++){e===i[s]&&t++,t>1&&(i.splice(s,1),s--,n._logger.log("remove the same id from object-id list"))}}),n.addRelatedObjects(i,t,s),p.end(n.name+" addObjects")},addRelatedObjects:function(e,t,s){var n=this,i=[],r=[];if(t!=O.CATEGORY_REPORTED_AGAINST)for(var a=0;a<e.length;a++){var o=e[a].split(",");e[a]=o[o.length-1]}for(var l=function(e,t){for(var s=[].concat(t),n=0;n<e.length;n++)for(var i=e[n],r=0;r<s.length;r++)if(i===s[r]){s.splice(r,1);break}return s},c=0;c<n.issues.length;c++){var d={physicalId:n.issues[c].id};d[t]={};var u=[].concat(e);if((u=l(n.utils.getRelatedObjects(n.issues[c],t),u)).length>0){d[t]=u.map(function(e){var t=[];e.contains(",")?t=e.split(","):t.push(e);var n={physicalId:t[t.length-1],path:t};if(s)for(var i=0;i<s.length;i++)s[i].id===e&&(n.position=s[i],n.position.id=t[t.length-1]);return n}),i.push(d);var m={id:n.issues[c].id,issue:n.issues[c]};r.push(m)}}if(i.length>0){var p=n.timestampLastRefresh;n.updateIssues(i).then(function(t){n.fetchRelatedObjects(e,!0).then(function(e){n.timestampLastRefresh===p&&(0==n._getCategoryRoots().length&&n._createCategoryRoots(),n.dgView.getTreeDocument().withTransactionUpdate(function(){let s=n._getCategoryRoot(t),i=s.getChildren();for(let o=0;o<e.length;o++){let l=e[o],c=-1;n.relatedObjects[t].objects[l.options.id]&&n.relatedObjects[t].objects[l.options.id].model&&(c=i.indexOf(n.relatedObjects[t].objects[l.options.id].model)),-1!==c?(i.splice(c,1),n._getCategoryRoot(t).addChild(l,c)):(s.addChild(l,0),n._refreshItemCount(s,t)),n.relatedObjects[t].objects[l.options.id]={},n.relatedObjects[t].objects[l.options.id].model=l,n.relatedObjects[t].objects[l.options.id].common=!0;for(var r=0;r<n.issues.length;r++){var a=n.utils.getRelatedObjects(n.issues[r],t);-1===a.indexOf(l.options.id)&&a.push(l.options.id)}}e.length&&s.expandAll(),T.displayNotification({msg:_.resolveIssues.successResolved,eventID:"success"})},function(){n._logger.error('An error occurred during "%s"',"add child")}),n.dispatchEvent("onUpdate",{issues:r,relation:t}))})},function(){})}else T.displayNotification({msg:_.resolveIssues.nothingToAdd,eventID:"info"})},updateIssues:function(t,s){var i=this;if(p.start(i.name+" updateIssues"),Array.isArray(t[0].reportedAgainst))for(var r=0;r<t[0].reportedAgainst.length;r++)if(!("path"in t[0].reportedAgainst[r])){var a=t[0].reportedAgainst[r].physicalId,l=(a=a.split(","))[a.length-1];t[0].reportedAgainst[r].physicalId=l+"",t[0].reportedAgainst[r].path=a}return new n(function(n,r){o.mask(i.container);var a=s?"delete":"update";h.related[a]({data:{objects:t},onComplete:function(){o.unmask(i.container);let e="";Object.keys(t[0]).includes(O.CATEGORY_REPORTED_AGAINST)?e=O.CATEGORY_REPORTED_AGAINST:Object.keys(t[0]).includes(O.CATEGORY_RESOLVED_BY)?e=O.CATEGORY_RESOLVED_BY:Object.keys(t[0]).includes(O.CATEGORY_RESOLVED_ITEMS)?e=O.CATEGORY_RESOLVED_ITEMS:Object.keys(t[0]).includes(O.CATEGORY_CONTEXTS)&&(e=O.CATEGORY_CONTEXTS),i.dispatchEvent("onUpdateComplete"),n(e)},onFailure:function(t){i._logger.error(t),e.is(t.error)&&e.is(t.error.internal)&&"'business object' does not exist"==t.error.internal?I.displayErrorMessage(I.getErrorMessage("0"),"error"):e.is(t.error)&&e.is(t.error.internal)&&t.error.internal.includes("ErrorCode:2005")?I.displayErrorMessage(I.getErrorMessage("2005"),"error"):e.is(t.error)&&e.is(t.error.internal)&&(t.error.internal.includes("No fromdisconnect access to object")||t.error.internal.includes("User should be Owner or Co-owner or Assignee for this operation")||t.error.internal.includes("If the issue is open, your responsibility does not permit you to add Reported Against, Contexts or Resolved by. If the issue is closed, related objects or contexts cannot be added"))?I.displayErrorMessage(I.getErrorMessage("10"),"error"):T.displayNotification({msg:t.error.message,eventID:"error"}),o.unmask(i.container),i.dispatchEvent("onUpdateFailure"),i.parentView&&i.parentView.refresh(),r(new Error("Failed to update issues..."))}})})},_refreshItemCount:function(e,t){let s=null!==e.getChildren()?e.getChildren().length:0;e.setLabel(O.CATEGORY_NLS[t]+" ("+s+")")},getContextualMenu:function(e){var t=this;p.start(t.name+" getContextualMenu");var s=[],i=e.models,r=null,a=null,o=null,l=null,c=null,d=null,u=null,m=null,f=null,h=new n(function(e){r={name:"Remove",title:_.resolveIssues.contextualMenus.remove,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-remove"},data:i,action:{callback:function(e){t.dgView.getTreeDocument().withTransactionUpdate(function(){let s=t.extractCategoryObjects(e.context);t.removeRelatedObjects(s)},function(){t._logger.error('An error occurred during "%s"',"removeCommand")})},context:i}},a={title:_.resolveIssues.contextualMenus.propagate,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-propagate"},data:i,action:{callback:function(e){t.propagate(e.context)},context:i}},o={name:"Maturity State",title:_.resolveIssues.contextualMenus.maturity,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-compass"},data:i,action:{callback:function(e){require(["DS/IssueComponents/external/CollaborativeLifecycle"],function(t){for(var s=[],n=e.context,i=0;i<n.length;i++)s.push(n[i].options.pid);t.execute(s)})},context:i}},l={name:"Compare",title:_.resolveIssues.contextualMenus.compare,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-compare-on"},data:i,action:{callback:function(e){require(["DS/IssueComponents/external/Compare"],function(t){for(var s=[],n=e.context,i=0;i<n.length;i++)s.push({physicalId:n[i].options.pid,type:n[i].options.type});t.execute(s)})},context:i}},c={name:"WhereUsed",title:_.resolveIssues.contextualMenus.relationalExplorer,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-object-related"},data:i,action:{callback:function(e){require(["DS/IssueComponents/external/RelationalExplorer"],function(t){for(var s=[],n=e.context,i=0;i<n.length;i++)s.push(n[i].options.pid);t.execute(s)})},context:i}},d={name:"ReplaceByLatestRevision",title:_.resolveIssues.contextualMenus.replaceByLatestRevision,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-step-3"},data:i,action:{callback:function(e){let s=t.extractCategoryObjects(e.context);t.replaceByRevision(s,O.REVISION_TARGETS.LATEST)},context:i}},u={name:"ReplaceByReleasedLatestRevision",title:_.resolveIssues.contextualMenus.replaceByReleasedLatestRevision,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-step-1"},data:i,action:{callback:function(e){let s=t.extractCategoryObjects(e.context);t.replaceByRevision(s,O.REVISION_TARGETS.RELEASE_LATEST)},context:i}},m={name:"ReplaceByStableLatestRevision",title:_.resolveIssues.contextualMenus.replaceByStableLatestRevision,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-step-2"},data:i,action:{callback:function(e){let s=t.extractCategoryObjects(e.context);t.replaceByRevision(s,O.REVISION_TARGETS.STABLE_LATEST)},context:i}},f={name:"information",title:_.resolveIssues.contextualMenus.information,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-properties"},data:null,action:{callback:function(){I.viewProperties(i[0].options.pid)}}},e()});if(1===i.length&&"Document"===i[0].options.type){var g=null,b=null,C=null,E=null,S=null;h=h.then(function(){return v.getDocuments([i[0].options.id]).then(function(e){g=e.data[0]})}).then(function(){var e={data:g,from:"related"},s=[];s.push(i[0].options);var n={data:g,from:"related",menu:t,selected:s};b={name:"Preview",title:_.resolveIssues.contextualMenus.preview,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-eye"},data:null,action:{callback:function(){y.preview(n)}}},""===g.relateddata.files[0].dataelements.locker?C={name:"Edit",title:_.resolveIssues.contextualMenus.edit,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-pencil"},data:null,action:{callback:function(){y.edit(e)}}}:(E={name:"UndoEdit",title:_.resolveIssues.contextualMenus.undoEdit,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-undo"},data:null,action:{callback:function(){y.undoEdit(e)}}},S={name:"Update",title:_.resolveIssues.contextualMenus.update,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-upload"},data:null,action:{callback:function(){y.update(e)}}})})}if(i.every(e=>"Document"==e.options.type)){for(var w=null,T=[],D=0;D<i.length;D++)T.push(i[D].options);var A={from:"related",menu:t,selected:T};w={name:"Download",title:_.resolveIssues.contextualMenus.download,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-download"},data:null,action:{callback:function(){y.download(A)}}}}return h=h.then(function(){return t._getOpenWithMenu(e).then(function(n){if(s=s.concat(n),"children"===e.type){if(s.push({type:"SeparatorItem"}),1===e.models.length&&"Document"===e.models[0].options.type&&(b&&(s.push(b),s.push({type:"SeparatorItem"})),null!==C&&s.push(C),null!==E&&s.push(E),null!==S&&s.push(S)),e.models[0].options.type!==O.ISSUE_TYPE){var h=[],g={name:"ReplaceByRevision",type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-replace-by-existing"},title:_.resolveIssues.contextualMenus.replaceByRevision,submenu:h};h.push(u),h.push(m),h.push(d),s.push(g)}s.push({type:"SeparatorItem"}),1===e.models.length&&s.push(o),e.models.length<=2&&s.push(l),s.push({type:"SeparatorItem"}),e.models.every(e=>"Document"==e.options.type)&&null!==w&&s.push(w),s.push(c),1===i.length&&s.push(f),s.push(r);for(var v=0;v<e.models.length;v++)if(!e.models[v].options.common){s.push(a);break}}return p.end(t.name+" getContextualMenu"),s})})},_getOpenWithMenu:function(t){p.start(name+" getMenu");var s=[],i=t.models||[];return 0===i.length||"blank"===t.type?n.resolve([]):new n(function(t){p.start(name+" getOpenWithMenu");var n=[],r=[],a=[O.ISSUE_TYPE];h.type.getSubType().then(o=>{var l=o;null!=l&&Object.keys(l).length>1&&(a=Object.keys(l));for(var c=0;c<i.length;c++){var d=i[c];a.includes(d.options.type)||(r.push(d.options.type),n.push({envId:g.getTenant(),serviceId:"3DSpace",objectId:d.options.pid,objectType:d.options.type,objectTaxonomies:[d.options.type],displayName:d.options.title?d.options.title:d.options.name})),a.includes(d.options.type)&&(d.options.children?d.options.children.forEach(function(e){r.push(e.options.type),n.push({envId:g.getTenant(),serviceId:"3DSpace",objectId:e.options.pid,objectType:e.options.type,objectTaxonomies:[e.options.type],displayName:e.options.title?e.options.title:e.options.name})}):(r.push(d.options.type),n.push({envId:g.getTenant(),serviceId:"3DSpace",objectId:d.options.id,objectType:d.options.type,objectTaxonomies:[d.options.type],displayName:d.options.title?d.options.title:d.options.name})))}h.getTypesHierarchy({types:r,onComplete:function(i){if(e.is(i.types_hierarchies,"array")&&i.types_hierarchies.forEach(function(e,t){n.forEach(function(t,s){t.objectTaxonomies[0]===e.type&&(t.objectTaxonomies=t.objectTaxonomies.concat(e.hierarchy))})}),0===n.length)return p.end(name+" getOpenWithMenu"),void t(s);var r=b.get("widget")||window.widget;C.getOpenWith().set3DXContent({protocol:"3DXContent",version:"1.1",source:r.name,widgetId:r.id,data:{items:n}},!0).retrieveCompatibleApps(function(e){if(e&&e.length>0){var n=[],i=[];if(e.forEach(function(e){i={name:e.text.replace(/ /g,""),type:"PushItem",title:e.text,action:{callback:e.handler}},null!=e.fonticon?i.fonticon={content:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-"+e.fonticon}:i.icon=e.icon,n.push(i)}),n.length>0){var r={name:"OpenWith",type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-open-menu-dot"},title:_.resolveIssues.contextualMenus.openWith,submenu:n};s.push(r),s.push({type:"SeparatorItem"})}}t(s)}),p.end(name+" getOpenWithMenu")},onFailure:function(e){t(s)}})}).catch(()=>{})})},extractCategoryObjects:function(e){let t=[],s=[],n=[],i=[];for(let r=0;r<e.length;r++)if(!e[r].options.grid.isCategory){switch(e[r].getParent().options.grid.Name){case O.CATEGORY_REPORTED_AGAINST:t.push(e[r]);break;case O.CATEGORY_RESOLVED_BY:s.push(e[r]);break;case O.CATEGORY_RESOLVED_ITEMS:n.push(e[r]);break;case O.CATEGORY_CONTEXTS:i.push(e[r])}}let r=[];return t.length&&r.push({category:O.CATEGORY_REPORTED_AGAINST,objs:t}),s.length&&r.push({category:O.CATEGORY_RESOLVED_BY,objs:s}),n.length&&r.push({category:O.CATEGORY_RESOLVED_ITEMS,objs:n}),i.length&&r.push({category:O.CATEGORY_CONTEXTS,objs:i}),r},removeRelatedObjects:function(e){for(var t=this,s=[],n=[],i=function(e,t){for(var s=[].concat(t),n=0;n<s.length;n++){var i=s[n];-1===e.indexOf(i)&&(s.splice(n,1),n--)}return s},r=0;r<t.issues.length;r++)for(let c=0;c<e.length;c++){var a={physicalId:t.issues[r].id};let d=e[c].category,u=e[c].objs,m=[];u.forEach(function(e){m.push(e.options.id)}),a[d]={};var o=[].concat(m);(o=i(t.utils.getRelatedObjects(t.issues[r],d),o)).length>0&&(a[d]=o.map(function(e){return{physicalId:e}})),s.push(a);var l={id:t.issues[r].id,issue:t.issues[r]};n.push(l)}if(s.length>0){var c=t.timestampLastRefresh;t.confirmDetach(e).then(function(){for(let i=0;i<s.length;i++)t.updateIssues([s[i]],!0).then(function(s){t.timestampLastRefresh===c&&(t.dgView.getTreeDocument().withTransactionUpdate(function(){let n=[];for(let t=0;t<e.length;t++)e[t].category==s&&(n=e[t].objs);for(var i=0;i<n.length;i++){var r=n[i];r.remove(),t.relatedObjects[s].objects[r.options.id]=null,delete t.relatedObjects[s].objects[r.options.id];for(var a=0;a<t.issues.length;a++){var o=t.utils.getRelatedObjects(t.issues[a],s),l=o.indexOf(r.options.id);l>-1&&o.splice(l,1)}let e=t._getCategoryRoot(s);t._refreshItemCount(e,s)}T.displayNotification({msg:_.resolveIssues.successResolved,eventID:"success"})},function(){t._logger.error('An error occurred during "%s"',"remove child")}),t.dispatchEvent("onUpdate",{issues:n}))},function(){t._logger.error('An error occurred during "%s"',"remove child in withTransactionUpdate")})},function(){t._logger.log('User cancel the operation. "%s"',"Detach related objects")})}},_removeCategoryRootsFromSelection:function(e){for(let t=0;t<e.length;t++)e[t].options.grid.isCategory&&(e.splice(t,1),t--)},confirmDetach:function(e){for(var t=[],s=0;s<e.length;s++){e[s].objs.forEach(function(e){t.push(e.options.title+" ("+e.options.name+")")})}return this._showConfirm(t,_.resolveIssues.confirmDialog.confirmDetach,_.resolveIssues.confirmDialog.detachTitle)},_showConfirm:function(t,s,i){var r=this,o=b.get("widget")||window.widget,c=t,d=[];c.forEach(function(t){d.push(e.createElement("li",{html:t,title:t}))});var u=e.createElement("div",{html:[s,e.createElement("ul",{class:"related-confirm-dialog-ul",html:d})]}),m=_.replace(i,{number:c.length,issues:r.issues.length});return new n(function(e,t){var s,n=r.dialog=new w({animate:!0,autocenter:!0,closable:!0,limitParent:!1,overlay:!0,resizable:!0,visible:!0,className:"related-confirm-dialog",title:m,header:null,body:u,footer:[s=new a({value:_.resolveIssues.okButton,className:"primary related-confirm-dialog-ok",events:{onClick:function(){n.destroy(),r.dialog=null,e()}}}),new a({value:_.resolveIssues.cancel,className:"default related-confirm-dialog-cancel",events:{onClick:function(){n.destroy(),r.dialog=null,t(new Error("The dialog has been closed by the end user"))}}})],events:{onClose:function(){n.destroy(),r.dialog=null,t(new Error("The dialog has been closed by the end user"))}}}).inject(o.body);new l({element:u}).inject(n.getBody()),n.show(),s.focus()})},propagate:function(e,t){var s=this;s.confirmPropagate(e,t).then(function(){s.extractCategoryObjects(e).forEach(e=>{for(var t=[],n=0;n<e.objs.length;n++)t.push(e.objs[n].options.id);s.addRelatedObjects(t,e.category)})},function(){s._logger.log('User cancel the operation. "%s"',"Propagate related objects")})},confirmPropagate:function(e,t){for(var s=[],n=0;n<e.length;n++){var i=e[n];s.push(i.options.title+" ("+i.options.name+")")}return this._showConfirm(s,_.resolveIssues.confirmDialog.confirmPropagate,_.resolveIssues.confirmDialog.propagateTitle)},replaceByRevision:function(e,t){var s=this;let n=[],i=[];e.forEach(e=>{n.indexOf(e.category)&&n.push(e.category),i.push(...e.objs)}),s.getRevisions(i).then(function(i){var r=[],a=[];i.forEach(function(e){e.targetModel.getParent().options.grid.isCategory&&(e.category=e.targetModel.getParent().options.grid.Name),null!==e[t]&&e[t].id!==e.pid&&(r.push(e),a.push(e))});var o={issuesToAdd:[],issuesToRemove:[]},l=[],c=[];for(let n=0;n<s.issues.length;n++)for(let i=0;i<e.length;i++){let a=e[i].category;var d={physicalId:s.issues[n].id};d[a]=[];var u={physicalId:s.issues[n].id};if(u[a]=[],r.forEach(function(e){var i=s.utils.getRelatedObjects(s.issues[n],a).indexOf(e.id);e[t]&&i>-1&&(-1===u[a].indexOf(e.id)&&u[a].push({physicalId:e.id}),-1===d[a].indexOf(e[t].id)&&(d[a].push({physicalId:e[t].id}),-1===c.indexOf(e[t].id)&&c.push(e[t].id)))}),u[a].length>0||d[a].length>0){o.issuesToAdd.push(d),o.issuesToRemove.push(u);var m={id:s.issues[n].id,issue:s.issues[n]};l.push(m)}}if(o.issuesToAdd.length>0||o.issuesToRemove.length>0){var p=s.timestampLastRefresh;s.confirmReplaceByRevision(a,t).then(function(){s.updateIssues(o.issuesToAdd,!1).then(function(){s.updateIssues(o.issuesToRemove,!0).then(function(){s.fetchRelatedObjects(c,!0).then(function(e){var i={};e.forEach(function(e){i[e.options.id]=e}),s.timestampLastRefresh===p&&(s._getTreeDocument().withTransactionUpdate(function(){n.forEach(n=>{let a=s._getCategoryRoot(n),o=a.getChildren(),l=o.map(e=>e.options.id);r.forEach(function(e){var r=o.indexOf(e.targetModel);if(r>-1){e.targetModel.remove();var c=i[e[t].id];c&&(-1==l.indexOf(c.options.id)&&a.addChild(c,r),i[e[t].id]=null)}s.issues.forEach(function(i){var r=s.utils.getRelatedObjects(i,n),a=r.indexOf(e.id);a>-1&&(r.splice(a,1),r.indexOf(e[t].id)>-1||r.splice(a,0,e[t].id))})}),s.computeRelatedObjectsCommon(n),s.updateRelatedObjectsCommon(a.getChildren(),n),e.length&&a.expandAll(),T.displayNotification({msg:_.resolveIssues.successResolved,eventID:"success"})})},function(){s._logger.error('An error occurred during "%s"',"add child")}),s.dispatchEvent("onUpdate",{issues:l}))})},function(){s._logger.error('An error occurred during "%s"',"removing in replace revision in withTransactionUpdate")})},function(){s._logger.error('An error occurred during "%s"',"adding in replace revision in withTransactionUpdate")})},function(){s._logger.log('User cancel the operation. "%s"',"replace revision")})}else T.displayNotification({msg:_.resolveIssues.nothingToReplace,eventID:"info"})},function(){})},getRevisions:function(e){var t=this;return p.start(t.name+" getRevisions"),new n(function(s,n){if(e&&0!==e.length){var i={graphRequests:[]},r=[];e.forEach(function(e){r.push(e.options.pid)}),(r=[...new Set(r)]).forEach(function(e){i.graphRequests.push({id:e})}),h.getRevisions({data:i,onComplete:function(n){var i=n.body;t._logger.log("getRevisions :Success...");var r=[];e.forEach(function(e){for(var s=null,n=null,a=null,o=null,l=null,c=i.graphs,d=0;d<c.length;d++){var u=c[d];if(u.versions)for(var m=0;m<u.versions.length;m++)if(e.options.pid===u.versions[m].id){s=u.versions;break}if(s)break}if(s){for(var p=0;p<s.length;p++)if(s[p].isLastVersion){n=s[p];break}for(var f=s.length-1;f>=0;f--)if("RELEASED"===s[f].maturity){l=s[f];break}for(var h=s.length-1;h>=0;h--)if("RELEASED"===s[h].maturity||"FROZEN"===s[h].maturity){o=s[h];break}for(var g=0;g<s.length;g++)if(s[g].id===e.options.pid){a=s[g];break}}else t._logger.log("getRevisions :no revision -> "+e.options.pid);var v={id:e.options.id,pid:e.options.pid,targetModel:e,revisionFamily:s,CURRENT:a,STABLE_LATEST:o,RELEASE_LATEST:l,LATEST:n};r.push(v)}),p.end(t.name+" getRevisions"),s(r)},onFailure:function(e){t._logger.error("getRevisions :Failure..."),t._logger.error(e),T.displayNotification({msg:_.resolveIssues.errorResolved,eventID:"error"}),p.end(t.name+" getRevisions"),n(e)}})}else s([])})},confirmReplaceByRevision:function(e,t){var s=_.resolveIssues.confirmDialog.replaceByLatestRevisionTitle,n=_.resolveIssues.confirmDialog.confirmReplaceByLatestRevision;t===O.REVISION_TARGETS.RELEASE_LATEST?(s=_.resolveIssues.confirmDialog.replaceByReleasedLatestRevisionTitle,n=_.resolveIssues.confirmDialog.confirmReplaceByReleasedLatestRevision):t===O.REVISION_TARGETS.STABLE_LATEST&&(s=_.resolveIssues.confirmDialog.replaceByStableLatestRevisionTitle,n=_.resolveIssues.confirmDialog.confirmReplaceByStableLatestRevision);for(var i=[],r=0;r<e.length;r++){var a=e[r].targetModel,o=_.replace(_.resolveIssues.confirmDialog.confirmReplaceByTitleMessage,{target:a.options.title+" ("+a.options.name+") "+a.options.revision,latest:e[r][t].code});i.push(o)}return this._showConfirm(i,n,s)},utils:{_debounceTimeouts:[],debounce:function(e,t,s){var n,i=this;return function(){var r=this,a=arguments,o=s&&!n;clearTimeout(n);var l=i._debounceTimeouts.indexOf(n);-1!==l&&i._debounceTimeouts.splice(l,1),n=setTimeout(function(){n=null,s||e.apply(r,a)},t),i._debounceTimeouts.push(n),o&&e.apply(r,a)}},getRelatedObjects:function(e,t){return e.relatedObjects[t]},sortJudgment:function(e,t){return(e=e||"")<(t=t||"")?-1:e>t?1:0}}})}),define("DS/IssueComponents/related/RelatedContent",["UWA/Class/View","UWA/Class/Promise","UWA/Core","DS/Logger/Logger","DS/PADUtils/views/PADAlert","DS/IssueCommon/utils/Utils","DS/IssueComponents/utils/Utils","DS/IssueComponents/related/DatagridView","DS/IssueComponents/related/RelatedContentActionBar","DS/IssueServices/Contexts","DS/IssueServices/services/IssueServices","DS/IssueServices/services/PlatformServices","DS/IssueServices/utils/Performance","DS/Utilities/Dom","css!DS/IssueComponents/IssueComponents.css","i18n!DS/IssueComponents/assets/nls/IssueComponents"],function(e,t,s,n,i,r,a,o,l,c,d,u,m,p,f,h){"use strict";var g={ISSUE_TYPE:"Issue",CATEGORY_REPORTED_AGAINST:"reportedAgainst",CATEGORY_RESOLVED_BY:"resolvedBy",CATEGORY_CONTEXTS:"contexts",CATEGORY_RESOLVED_ITEMS:"resolvedItems",CATEGORY_REPORTED_AGAINST_INSTANCE:"reportedAgainst_instance",CATEGORY_RESOLVED_BY_INSTANCE:"resolvedBy_instance",CATEGORY_NLS:{reportedAgainst:"Affected Items",resolvedBy:"Resolvedby",contexts:"Contexts",resolvedItems:"Resolved Items"},CATEGORIES_TO_ADD_ISSUE_TYPE_OBJECT:["resolvedBy"],ISSUE_3D_REVIEW:"ENX3DIR_AP"},v={actual:null,count:0};return e.extend({name:"DS/IssueComponents/related/RelatedContent",tag:"div",className:"relatedContent-objects-view",_deferred:{resolve:null,reject:null},setup:function(e){m.start(this.name+" setup"),this._logger=n.getLogger(this.name),this._logger.log("Initializing related"),this._parent(e),this.options.ids=e.ids,this.issues={},this.views={},this.views.relatedContent={},this.grids={},this.isLoaded=null,m.end(this.name+" setup")},render:function(){return this.build(),this.load(this.options.ids),m.end(this.name+" init"),this},build:function(){var e=this;m.start(e.name+" build"),e.views.main=s.createElement("div",{styles:{width:"100%",height:"100%",display:"inline-block"},class:"relatedContent-objects-view-main",html:e.createRelatedContent()}),e.views.main.inject(e.container),e.grids.relatedContent=new o(e.views.relatedContent.dgView,g.CATEGORY_CONTEXTS),l.toolbar=e.grids.relatedContent.dgView.setToolbar(l.writetoolbarDefination()),l.toolbar.onToolbarClickCallback=this.onToolbarClickCallback.bind(e),l.toolbar.inject(e.views.relatedContent.relatedContentHeader),e._addDropEvent(e.views.relatedContent.droppable);for(var t=[{id:g.CATEGORY_REPORTED_AGAINST,icon:"location",title:h.open.labels.reportedAgainst},{id:g.CATEGORY_RESOLVED_BY,icon:"docs",title:h.open.labels.resolvedBy},{id:g.CATEGORY_RESOLVED_ITEMS,icon:"markup-review",title:h.open.labels.resolvedItems},{id:g.CATEGORY_CONTEXTS,icon:"3d-object",title:h.open.labels.contexts}],n=0;n<t.length;n++){var i=s.createElement("div",{class:"relatedcontent-dgv-dropZoneGlobal "+t[n].id,draggable:!1}),r=s.createElement("div",{class:"relatedcontent-dgv-dropZone "+t[n].id,draggable:!1}).inject(i),a=s.createElement("div",{class:"relatedcontent-dgv-dropIconAndText "+t[n].id}).inject(r);s.createElement("i",{class:"relatedcontent-dgv_img wux-ui-3ds wux-ui-3ds-2x wux-ui-3ds-"+t[n].icon}).inject(a),s.createElement("h5",{class:"relatedcontent-dgv_txt "+t[n].id,text:t[n].title}).inject(a),i.inject(e.views.relatedContent.dropzones)}e.views.relatedContent.dropzones.hide(),e.grids.relatedContent.callbacks.onModifyGrid=e._refreshItemCount.bind(e),e.listenTo(e.grids.relatedContent,"onUpdate",function(t){var n={issues:s.clone(t.issues).map(function(e){return e.issue}),relation:t.relation};e.dispatchEvent("onUpdate",n)}),m.end(e.name+" build")},onToolbarClickCallback:function(e){"addAffectedItem"==e._event&&this._addItem(g.CATEGORY_REPORTED_AGAINST),"addResolvedBy"==e._event&&this._addItem(g.CATEGORY_RESOLVED_BY),"addResolvedItems"==e._event&&this._addItem(g.CATEGORY_RESOLVED_ITEMS),"addContexts"==e._event&&this._addItem(g.CATEGORY_CONTEXTS),"pickAffectedItem"==e._event&&this._pickItem(g.CATEGORY_REPORTED_AGAINST),"pickResolvedBy"==e._event&&this._pickItem(g.CATEGORY_RESOLVED_BY),"pickResolvedItems"==e._event&&this._pickItem(g.CATEGORY_RESOLVED_ITEMS),"pickContexts"==e._event&&this._pickItem(g.CATEGORY_CONTEXTS),e._event},_pickItem:function(e){var t=this,s=c.get("component"),n=c.get("widget").name===g.ISSUE_3D_REVIEW,r=!1;if(e===g.CATEGORY_REPORTED_AGAINST&&(r=!0),n)s.isInspected()?i.displayNotification({msg:h.resolveIssues.pickupError_needtoExitInspectionMode,eventID:"error"}):s.utils.selectIn3D(function(s,n){var i=[{id:s,x:n[s].x,y:n[s].y,z:n[s].z}];t.grids.relatedContent.addObjects([s],e,i)});else{var a=s.taskManager.addSelectIn3DTask(function(n){var i=n.target,r=n.positions,o=[{id:i,x:r[i].x,y:r[i].y,z:r[i].z}];t.grids.relatedContent.addObjects([i],e,o),s.unmaskForTask(a)},function(){s.unmaskForTask(a)},{isOccurenceSelection:r});s.maskForTask(a,h.tasks.selectIn3D)}},_addItem:function(e){var t=this,n=c.get("application");if(s.is(n,"object")&&n.isStandalone){var r=c.get("component"),a=r.taskManager.addObjectsTask(function(s){Array.isArray(s.physicalIds)&&t.grids.relatedContent.addObjects(s.physicalIds,e),r.unmaskForTask(a)},function(){r.unmaskForTask(a)});r.maskForTask(a,h.tasks.addObjects)}else{u.getTenant();let s=h.open.labels[e];u.search({title:s,default_search_criteria:"",callback:function(s){var n=[g.ISSUE_TYPE];try{for(var r=[],a=0,o=0;o<s.length;o++){var l=s[o];if(l.hasOwnProperty("sourceid_value"))if(-1===l.sourceid_value.indexOf("3dspace"))throw new Error("Object not supported");n.includes(s[o]["ds6w:type_value"])&&!g.CATEGORIES_TO_ADD_ISSUE_TYPE_OBJECT.includes(e)?a++:r.push(s[o].id)}if(r.length>0&&t.grids.relatedContent.addObjects(r,e),0!==a)return void i.displayNotification({msg:h.replace(h.resolveIssues.issueNotDroppable,{number:a}),eventID:"error"})}catch(e){return i.displayNotification({msg:h.resolveIssues.errorNotSupportedObject,eventID:"warning"}),null}},cancel:function(){}})}},_refreshItemCount:function(){console.log("refresh count")},createRelatedContent:function(){return m.start(this.name+" createRelatedContent"),this.views.relatedContent.main=s.createElement("div",{styles:{width:"100%",height:"100%",display:"inline-block"},class:"issue-relatedContent-main",html:[this.views.relatedContent.relatedContentHeader=s.createElement("div",{styles:{width:"100%",height:"40px",display:"flex","align-items":"center"},class:"issue-relatedContent-header"}),this.views.relatedContent.droppable=s.createElement("div",{styles:{width:"100%",position:"relative"},class:"issue-relatedContent-droppable",html:[this.views.relatedContent.dgView=s.createElement("div",{styles:{width:"100%",height:"100%",position:"absolute"},class:"issue-relatedContent-datagridview"}),this.views.relatedContent.tileView=s.createElement("div",{styles:{width:"100%",height:"100%",position:"absolute",display:"none"},class:"issue-relatedContent-tileview",html:"Test"}),this.views.relatedContent.dropzones=s.createElement("div",{styles:{position:"absolute","z-index":5e4,"justify-content":"space-around","align-items":"center","margin-top":"30px","margin-bottom":"30px"},class:"issue-relatedContent-dropzones"})]})]}),m.end(this.name+" createRelatedContent"),this.views.relatedContent.main},clear:function(){this.issues={}},destroy:function(){this.views.main&&this.views.main.destroy(),this.stopListening(this.grids.relatedContent,"onUpdate"),this.grids.relatedContent&&(this.grids.relatedContent.destroy(),this.grids.relatedContent=null),this.views={},this.grids={},this._timestampUpdate=0},reBuildPanel:function(e){m.start(this.name+" reBuildPanel"),this.clear(),this.options.ids=e,this.load(this.options.ids),m.end(this.name+" reBuildPanel")},refresh:function(e){m.start(this.name+" refresh");var t=e;return t||(t=this.options.ids),this.reBuildPanel(t),m.end(this.name+" refresh"),this.isLoaded},load:function(e){var n=this;n.isLoaded=new t(function(e,t){n._deferred.resolve=e,n._deferred.reject=t}),n.fetchIssuesAndRelatedObjects(e).then(function(e){if(n.issues=e.issues,n.issues.length>0){n.grids.relatedContent.load(e.issues);var t=0,s=0,i=function(e){e||s++,1===++t&&(s>0?(n._deferred.reject(),n.dispatchEvent("onFailure",{error:"Cannot load the related view"})):(n._deferred.resolve(),n.dispatchEvent("onReady",{})))};n.grids.relatedContent.isLoaded.then(function(){i(!0)},function(){i(!1)})}},function(e){s.is(e.error)&&s.is(e.error.internal)&&"'business object' does not exist"==e.error.internal?r.displayErrorMessage(r.getErrorMessage("0"),"error"):i.displayNotification({msg:h.resolveIssues.errorGetIssues,eventID:"error"}),n._deferred.reject()})},fetchIssuesAndRelatedObjects:function(e){var s=this;return new t(function(t,n){d.issues.retrieve({timestamp:s._timestampUpdate?s._timestampUpdate:null,data:{objects:e.map(function(e){return{physicalId:e}})},onComplete:function(e){if(Array.isArray(e.results)){for(var s={issues:[]},i=0;i<e.results.length;i++){var r=e.results[i].body,a={id:r.physicalId,name:r.name,title:r.title,type:r.type,revision:"",state:r.state,description:r.description,rowNumForEmpty:{},relatedObjects:{}};s.issues.push(a),a.relatedObjects[g.CATEGORY_REPORTED_AGAINST]=[],a.relatedObjects[g.CATEGORY_RESOLVED_BY]=[],a.relatedObjects[g.CATEGORY_RESOLVED_ITEMS]=[],a.relatedObjects[g.CATEGORY_CONTEXTS]=[];for(var o=0;o<r.reportedAgainst.length;o++)a.relatedObjects[g.CATEGORY_REPORTED_AGAINST].push(r.reportedAgainst[o].path.join());for(let e=0;e<r.resolvedBy.length;e++)a.relatedObjects[g.CATEGORY_RESOLVED_BY].push(r.resolvedBy[e].physicalId);for(let e=0;e<r.resolvedItems.length;e++)a.relatedObjects[g.CATEGORY_RESOLVED_ITEMS].push(r.resolvedItems[e].physicalId);for(var l=0;l<r.contexts.length;l++)a.relatedObjects[g.CATEGORY_CONTEXTS].push(r.contexts[l].physicalId)}t(s)}else n(new Error("Unexpected response when retrieving issues."))},onFailure:function(e){s._logger.log("getIssues :Failure..."+e),n(e)}})})},_addDropEvent:function(e){var t=this,s=0;let n=t.views.relatedContent.dropzones;document.addEventListener("dragover",function(e){e.preventDefault()}),e.addEventListener("drop",function(s){if(e.removeClassName("dragenter"),t.views.relatedContent.dgView.style.opacity="1",n.hide(),v.count=0,s.stopPropagation(),!s.defaultPrevented){s.preventDefault();let e=[g.CATEGORY_REPORTED_AGAINST,g.CATEGORY_RESOLVED_BY,g.CATEGORY_RESOLVED_ITEMS,g.CATEGORY_CONTEXTS];var i="";for(let t=0;t<e.length;t++)if(v.actual.classList.contains(e[t])){i=e[t];break}var r=t.getDroppedInfo(s,i);r&&t.grids.relatedContent.addObjects(r,i)}}),e.addEventListener("dragenter",function(i){0===v.count&&(t.views.relatedContent.dgView.style.opacity="0.4",e.addClassName("dragenter"),n.show(),n.addClassName("dropzone-flex"));var r=p.firstParentWithClass(i.target,"relatedcontent-dgv-dropZoneGlobal");if(r){var a=r.querySelector(".relatedcontent-dgv-dropZone");v.actual!==a&&(v.actual&&v.actual.classList.remove("zoneHighlighted"),a.classList.add("zoneHighlighted"),v.actual=a)}v.count++,s++,i.stopPropagation()}),e.addEventListener("mouseenter",function(){e.hasClassName("dragenter")&&s++}),e.addEventListener("mouseleave",function(){e.hasClassName("dragenter")&&--s<=0&&e.removeClassName("dragenter")}),e.addEventListener("dragleave",function(i){v.count--,0===v.count&&(t.views.relatedContent.dgView.style.opacity="1",e.removeClassName("dragenter"),n.hide()),i.target===v.actual&&(v.actual.classList.remove("zoneHighlighted"),v.actual=null),0===--s&&(e.removeClassName("dragenter"),n.hide()),console.log("dragleave...."),i.stopPropagation()}.bind(t))},getDroppedInfo:function(e,t){var n=[];try{var r=a.getDroppableData(e).data.items;if(0==r.length)throw new Error("Object not supported");var o=0;if(r.forEach(function(e){if(e.objectType!==g.ISSUE_TYPE||g.CATEGORIES_TO_ADD_ISSUE_TYPE_OBJECT.includes(t)){if(!e.hasOwnProperty("serviceId")||!s.is(e.serviceId,"string")||"3DSpace"!==e.serviceId)throw new Error("Object not supported");-1===n.indexOf(e.objectId)&&n.push(e.objectId)}else o++}),0!==o)return i.displayNotification({msg:h.replace(h.resolveIssues.issueNotDroppable,{number:o}),eventID:"error"}),null}catch(e){return i.displayNotification({msg:h.resolveIssues.errorNotSupportedObject,eventID:"warning"}),null}return n},utils:{pushObjectIdIntoArrayOnce:function(e,t){return t.indexOf(e)>-1&&(t.push(e),!0)}}})}),define("DS/IssueComponents/create/Specialization",["UWA/Class/Promise","UWA/Class/View","UWA/Core","DS/IssueComponents/create/Form","DS/Controls/DatePicker","DS/Controls/LineEditor","DS/Controls/Editor","DS/Controls/ComboBox","DS/Controls/SpinBox","DS/Controls/Toggle","DS/WUXAutoComplete/AutoComplete","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/IssueServices/services/IssueServices","i18n!DS/IssueComponents/assets/nls/IssueComponents","css!DS/IssueComponents/IssueComponents.css"],function(e,t,s,n,i,r,a,o,l,c,d,u,m,p,f){"use strict";var h={UI_ACCESS:{READ_ONLY:"ReadOnly",NONE:"None"},CUSTOM_PROPERTY_TYPE:{MEMO:"textarea",DATE:"timestamp",TEXT:"string",INT:"integer",REAL:"real",BOOL:"boolean"},ISSUE_TYPE:"Issue",BOOL_TRUE:"TRUE"};return t.extend({name:"DS/IssueComponents/create/Specialization",tag:"div",className:"create-view-content-subview create-specialize",isInit:null,_deferredInit:{resolve:null,reject:null},setup:function(t){var s=this;s._parent(t),s.parent=t.parent,s.DefaultType=h.ISSUE_TYPE,s.isInit=new e(function(e,t){s._deferredInit.resolve=e,s._deferredInit.reject=t}),s.formElements={},s.formElementsToggler={},s.fields={},s.requiredLabels={},s.noShow=!0,s.noShowSubType=!0,s._customProperties=[],s.subTypeRes={};var n=[],i=s.getSubTypes();n.push(i),e.all(n).then(s._deferredInit.resolve).catch(s._deferredInit.reject)},destroy:function(){var e=this;e.form=null,Object.keys(e.fields).forEach(function(t){e.fields[t]=null,e.formElements[t]=null,e.formElementsToggler[t]=null})},render:function(){return this.form=new n({className:"create-properties-form",fields:[],events:{onInvalid:function(){}}}).inject(this.container),this.form.getContent().setAttribute("novalidate",!1),this.setFormContent(),this},getSubTypeAttributes:function(t){let s=[];var n={type:h.ISSUE_TYPE};return s.push(p.type.getSubTypesAllAttributes(n)),s.push(p.type.getSubTypesAllAttributes(t)),s.push(p.type.getProperties(t.type)),e.all(s).then(t=>{var s={};if(t.length>1&&void 0!==t[2]){let e=t[2];if(Array.isArray(e.classPredicates)&&e.classPredicates.length>0)e.classPredicates[0].vocabularyPredicateInfo.forEach(e=>{e.userAccess&&(s[e.name]=e.nlsName)})}let n=t[0].Attributes.map(e=>e.Name);var i=t[1].Attributes.filter(e=>!n.includes(e.Name));return t[1].Attributes=i,t[1].Attributes.length&&t[1].Attributes.forEach(e=>{s[e.Name]&&(e.NLS=s[e.Name])}),e.resolve(t[1])})},updateTypeAttributeOnSelect:function(t){var n,i,r=this,a=new e((e,t)=>{i=t,n=e}),o=[];if(r.form.elements.container.empty(),r._customProperties=[],r.noShow=!1,void 0!==t&&r.DefaultType!=t.type){var l=new e((e,n)=>{r.getSubTypeAttributes(t).then(t=>{if(void 0!==t&&Array.isArray(t.Attributes)&&t.Attributes.length>0){var n=t.Attributes.map(e=>{var t=e.Type.toLowerCase();switch(t){case"date":t=h.CUSTOM_PROPERTY_TYPE.DATE;break;case"double":t=h.CUSTOM_PROPERTY_TYPE.REAL}var n=[],i=[];return"Yes"===e.HasRangeDefined&&e.AuthorizedValues.forEach(function(e){n.push(e.Name),i.push(e.NLS)}),{title:e.NLS,name:e.Name,type:t,defaults:e.DefaultValue,NLSRange:i,range:n,path:e.Name,UIAccess:s.is(e.UIAccess)?e.UIAccess:""}});e(n)}else e()})});o.push(l)}return e.all(o).then(e=>{e.forEach(e=>{s.is(e,"array")&&(r._customProperties=r._customProperties.concat(e))}),r.setFormContent(),n()}).catch(e=>{console.log(e),i()}),a},getSubTypes:function(t){var s=this;return new e(t=>{p.type.getSubType().then(t=>(s.subTypeRes=t,null!=s.subTypeRes&&Object.keys(s.subTypeRes).length>1&&(s.noShowSubType=!1),e.resolve(t))).catch(function(){return s.subTypeRes=null,e.resolve({Issue:{}})}).then(t)})},setFormContent:function(e){var t=this;if(t._customProperties.length>0){var n=s.createElement("div",{class:"create-form-content"}),i=[],r=[];t._customProperties.forEach(function(e,s){var n=[],a={};if(null!==e.range){var o=e.NLSRange;e.range.forEach(function(e,t){n.push({labelItem:o[t],valueItem:e})})}if(e.type==h.CUSTOM_PROPERTY_TYPE.DATE&&""==e.defaults&&(e.defaults=void 0),a.index=s,a.element=e.name,a.value=e.defaults,a.required="Yes"===e.mandatory,a.placeholder=t.getPlaceholder(e),a.help=t.getHelper(e),a.type=e.type,a.label=t.getLabel(e),a.rangeItems=n,a.UIAccess=e.UIAccess,a.requiredText=f.create.required,a.selectedIndex=-1,a.type!==h.CUSTOM_PROPERTY_TYPE.INT&&a.type!==h.CUSTOM_PROPERTY_TYPE.REAL||a.rangeItems.sort(function(e,t){return e-t}),a.rangeItems.length>0&&a.rangeItems.forEach(function(e,t){a.value===e&&(a.selectedIndex=t)}),h.UI_ACCESS.NONE!=e.UIAccess&&h.UI_ACCESS.READ_ONLY!=e.UIAccess){var l=t.createFormElement(a);a.required?i.push(l):r.push(l)}}),i.forEach(function(e){e.inject(n)}),r.forEach(function(e){e.inject(n)}),n.inject(t.form.elements.container)}},createFormElement:function(e){var t="create-form-element create-properties-form-element-"+e.element,n=this.formElements[e.element]=s.createElement("div",{class:t});this.parent.isTemplate&&!e.required&&this.createVisibilityMask(e).inject(n);return this.createFormGroup(e).inject(n),n},createFormGroup:function(e){var t=s.createElement("div",{class:"create-form-field form-group"});return(e.required?this.createRequiredLabel(e):this.createLabel(e)).inject(t),this.createFormField(e).inject(t),t},createVisibilityMask:function(e){return s.createElement("div",{html:[{tag:"div",class:"create-form-visibility-mask"},{tag:"div",class:"create-form-visibility-toggle",html:[this.formElementsToggler[e.element]=s.createElement("span",{class:"fonticon fonticon-eye"})]}]})},createRequiredLabel:function(e){e.element;var t="required-form-field-title-label"+(this.parent.isTemplate?"":" highlight"),n="required-form-field-required-label"+(this.parent.isTemplate?"":" highlight");return this.requiredLabels[e.element]=s.createElement("h5",{class:"required-form-field",html:[s.createElement("span",{class:t,html:e.label}),s.createElement("span",{class:n,html:e.requiredText})]})},createLabel:function(e){e.element;return s.createElement("h5",{class:"create-form-field-label",html:e.label})},createFormField:function(e){var t=this,n=s.createElement("div",{name:e.name,id:e.id}),i=null;if(e.rangeItems.length>0&&e.type!==h.CUSTOM_PROPERTY_TYPE.BOOL)i=t.createComboBox(e);else switch(e.type){case h.CUSTOM_PROPERTY_TYPE.TEXT:case h.CUSTOM_PROPERTY_TYPE.MEMO:(i=t.createTextField(e)).getContent().querySelectorAll("input, div").forEach(function(e){e.style.width="100%",e.style.fontSize="medium"});break;case h.CUSTOM_PROPERTY_TYPE.DATE:(i=t.createDateField(e)).getContent().querySelectorAll("input").forEach(function(e){e.style.fontSize="medium"});break;case h.CUSTOM_PROPERTY_TYPE.BOOL:i=t.createBooleanField(e);break;case h.CUSTOM_PROPERTY_TYPE.INT:case h.CUSTOM_PROPERTY_TYPE.REAL:i=t.createNumberField(e),t.fields[e.element].getContent().style.height="auto",i.getContent().style.width="100%",i.getContent().querySelectorAll("input").forEach(function(e){e.style.fontSize="medium"})}return i.getContent().addEventListener("change",function(){switch(e.type){case h.CUSTOM_PROPERTY_TYPE.TEXT:case h.CUSTOM_PROPERTY_TYPE.MEMO:t._customProperties[e.index].value=t.fields[e.element].value;break;case h.CUSTOM_PROPERTY_TYPE.DATE:var s=t.fields[e.element].value;t._customProperties[e.index].value=s.getMonth()+1+"/"+s.getDate()+"/"+s.getFullYear();break;case h.CUSTOM_PROPERTY_TYPE.BOOL:t._customProperties[e.index].value=t.fields[e.element].checkFlag?"true":"false";break;case h.CUSTOM_PROPERTY_TYPE.INT:case h.CUSTOM_PROPERTY_TYPE.REAL:var n=t.fields[e.element].value;t._customProperties[e.index].value=null!=n&&""!==n?n.toString():n}}),i.inject(n),n},createTextField:function(e){var t=null;return"string"===e.type?(t=this.fields[e.element]=new r({value:e.value,requiredFlag:e.required&&!this.parent.isTemplate,placeholder:e.placeholder})).getContent().setStyle("width","100%"):(t=this.fields[e.element]=new a({value:e.value,nbRows:4,requiredFlag:e.required&&!this.parent.isTemplate,placeholder:e.placeholder,newLineMode:"enter"})).getContent().setStyle("width","100%"),t},createDateField:function(e){return this.fields[e.element]=new i({value:e.value,minValue:e.minValue,maxValue:e.maxValue})},createNumberField:function(e){var t="integer"===e.type?parseInt(e.value):parseFloat(e.value);return this.fields[e.element]=new l({value:t,stepValue:"integer"===e.type?1:.1,maxValue:"integer"===e.type?2147483646:999999999999999})},createComboBox:function(e){var t=e.rangeItems,n=function(){var e=new u;e.prepareUpdate();for(var s=0;s<t.length;s++){var n=t[s].labelItem,i=t[s].valueItem,r=new m({label:n,value:i});e.addRoot(r)}return e.pushUpdate(),e}(),i=!1;s.is(e.MultiValuated)&&(i=!0);var r=[];t.length>0&&t.forEach(function(t,s){e.value===t.labelItem&&r.push(n.getRoots()[s])});var a=e.required,o=(e.placeholder,this.fields[e.element]=new d({elementsTree:n,multiSearchMode:i,selectedItems:r,allowFreeInputFlag:!1}));return(1==i||t.length>0)&&o.getContent().addEventListener("keydown",function(e){13==e.keyCode&&e.stopPropagation()}),o.requiredFlag=a,o},createBooleanField:function(e){var t=this.fields[e.element]=new c({type:"switch",checkFlag:e.value.toLowerCase()===h.BOOL_TRUE.toLowerCase()});return t.getContent().addEventListener("keydown",function(e){13==e.keyCode&&e.stopPropagation()}),t},show:function(){this._parent(),this._customProperties.length>0&&this.fields[this._customProperties[0].name]&&"focus"in this.fields[this._customProperties[0].name]&&this.fields[this._customProperties[0].name].focus()},hide:function(){this._parent()},validate:function(){return this.form.fields=Object.values(this.fields).filter(function(e){return null!==e}),this.form.validate(!1,!1)},getValues:function(){var e={specialization:{}};return s.is(this.subTypeSelector,"object")&&(e.type=this.subTypeSelector.value),this._customProperties.forEach(function(t){"undefined"!=t.value&&(e.specialization[t.path]=t.value)}),e},getHiddenAttributes:function(){var e={custom:{}};for(var t in this.formElements)s.is(this.formElementsToggler[t])&&(e.custom[t]=this.formElementsToggler[t].hasClassName("fonticon-eye-off"));return e},reset:function(){var e=this;e._customProperties.forEach(function(t){if(t.value=t.defaults,e.fields[t.name])switch(t.type){case h.CUSTOM_PROPERTY_TYPE.TEXT:case h.CUSTOM_PROPERTY_TYPE.MEMO:e.fields[t.name].value=t.defaults;break;case h.CUSTOM_PROPERTY_TYPE.DATE:break;case h.CUSTOM_PROPERTY_TYPE.BOOL:e.fields[t.name].checkFlag="true"===t.defaults;break;case h.CUSTOM_PROPERTY_TYPE.INT:case h.CUSTOM_PROPERTY_TYPE.REAL:e.fields[t.name].value=""===t.defaults?0:"integer"===t.type?parseInt(t.defaults):parseFloat(t.defaults)}})},applyTemplate:function(t){var n,i=this;i.reset();var r=new e((e,t)=>{t,n=e});if(s.is(i.subTypeSelector,"object")){i.subTypeSelector.removeEventListener("change",i.subTypeSelectorClick),i.subTypeSelector.value=s.is(t.data.type,"string")?t.data.type:i.DefaultType,i.subTypeSelector.addEventListener("change",i.subTypeSelectorClick);var a={type:i.subTypeSelector.value}}return i.updateTypeAttributeOnSelect(a).then(()=>{if(s.is(t.data,"object")&&s.is(t.data.specialization,"object")&&i._customProperties.forEach(function(e){if(s.is(t.data.specialization[e.path],"string")&&(e.value=t.data.specialization[e.path],i.fields[e.name]))switch(e.type){case h.CUSTOM_PROPERTY_TYPE.TEXT:case h.CUSTOM_PROPERTY_TYPE.MEMO:case h.CUSTOM_PROPERTY_TYPE.DATE:i.fields[e.name].value=e.value;break;case h.CUSTOM_PROPERTY_TYPE.BOOL:i.fields[e.name].checkFlag="true"===e.value;break;case h.CUSTOM_PROPERTY_TYPE.INT:case h.CUSTOM_PROPERTY_TYPE.REAL:i.fields[e.name].value=""===e.value?0:"integer"===e.type?parseInt(e.value):parseFloat(e.value)}}),s.is(t.hidden,"object")&&s.is(t.hidden.custom,"object")&&s.is(i.formElements,"object")&&s.is(i.formElementsToggler,"object")){var e=i.formElements,r=i.formElementsToggler;for(var a in e)!0===t.hidden.custom[a]&&(i.parent.isTemplate?(s.is(e[a])&&e[a].toggleClassName("visibility-masked",!0),s.is(r[a])&&(r[a].toggleClassName("fonticon-eye-off",!0),r[a].toggleClassName("fonticon-eye",!1))):s.is(e[a])&&e[a].hide())}n()}),r},getLabel:function(e){var t="",s=f.create.properties.custom;if(void 0!==s){var n=s[e.name];void 0!==n&&(t=n.label)}return""!==t&&void 0!==t||(t=e.title),""!==t&&void 0!==t||(t=e.name),t},getPlaceholder:function(e){var t="",s=f.create.properties.custom;if(void 0!==s){var n=s[e.name];void 0!==n&&(t=n.placeholder)}return""!==t&&void 0!==t||(t=e.title),""!==t&&void 0!==t||(t=e.name),t},getHelper:function(e){var t="",s=f.create.properties.custom;if(void 0!==s){var n=s[e.name];void 0!==n&&(t=n.helper)}return""!==t&&void 0!==t||(t=e.title),""!==t&&void 0!==t||(t=e.name),t},getSubTypePicker:function(e){var t=this;t.myTreeDocument=new u;var n=new m({label:t.DefaultType});t.myTreeDocument.addRoot(n),t.subTypeRes=s.is(e,"object")?e:t.subTypeRes;var i={"ds6w:type":[]};if(null!=t.subTypeRes&&Object.keys(t.subTypeRes).length>1){var r=Object.keys(t.subTypeRes);r.sort(function(e,t){return e.localeCompare(t)}),r.forEach(e=>{var s={label:e,grid:{valueItem:e}};e!=t.DefaultType&&(t.myTreeDocument.addRoot(new m(s)),i["ds6w:type"].push(e))}),t.noShow=!1}t.myTreeDocument.expandAll(),i["ds6w:type"].length>0&&p.getNLSValuesPromise(i).then(e=>{s.is(e)&&s.is(e["ds6w:type"])&&t.myTreeDocument.getAllDescendants().forEach(t=>{var n=t.options.grid.valueItem;s.is(e["ds6w:type"][n])&&(t.options.label=e["ds6w:type"][n])})});var a=t.subTypeSelector=new o({enableSearchFlag:!1,elementsTree:t.myTreeDocument});a.getContent().style.width="100%";var l=a.getContent().querySelectorAll("button")[0];l.onfocusin=function(){a.getContent().style.borderColor="#368ec4"},l.onmouseout=function(){a.getContent().style.borderColor="#b4b6ba"},l.onmouseover=function(){a.getContent().style.borderColor="#77797c"},a.getContent().querySelectorAll("button").forEach(function(e){e.style.fontSize="medium",e.style.paddingLeft="3px",e.style.background="white"}),t.subTypeSelectorClick=function(e){var s={type:t.subTypeSelector.value};t.updateTypeAttributeOnSelect(s)},t.subTypeSelector.addEventListener("change",t.subTypeSelectorClick);var c=s.createElement("div",{class:"issue-comboBox-Type"});return t.subTypeSelector.inject(c),t.subTypeSelector}})}),define("DS/IssueComponents/create/PropertiesNew",["UWA/Class/Promise","UWA/Class/View","UWA/Core","DS/IssueComponents/create/Form","DS/Controls/Button","DS/Controls/ButtonGroup","DS/Controls/Editor","DS/Controls/LineEditor","DS/Controls/DatePicker","DS/Controls/TooltipModel","DS/CKEditor/CKEditor","DS/ENOFloatingPanel/ENOFloatingPanel","DS/Logger/Logger","DS/WebappsUtils/WebappsUtils","DS/PADUtils/views/PADAlert","DS/IssueCommon/commands/CommandsManager","DS/IssueCommon/utils/Utils","DS/IssueComponents/utils/Utils","DS/IssueComponents/create/CustomNew","DS/IssueServices/Contexts","DS/IssueServices/services/IssueServices","DS/IssueServices/services/PlatformServices","DS/IssueServices/utils/Parser","DS/IssueServices/utils/Performance","DS/WUXAutoComplete/AutoComplete","DS/Controls/ComboBox","DS/Tree/TreeDocument","DS/Tree/TreeNodeModel","DS/IssueComponents/create/Classification","DS/IssueComponents/create/Specialization","DS/IssueComponents/search/PeopleSearch","DS/SearchWidget/SearchWidgetConstant","i18n!DS/IssueComponents/assets/nls/IssueComponents","text!DS/IssueCommon/assets/Settings.json","css!DS/IssueComponents/IssueComponents.css"],function(e,t,s,n,i,r,a,o,l,c,d,u,m,p,f,h,g,v,b,C,E,I,y,S,w,T,D,A,_,O,N,L,R,M){"use strict";var P="ISU_TYPE_NLS",U=50,x=1e3;return t.extend({name:"DS/IssueComponents/create/PropertiesNew",tag:"div",className:"create-view-content-subview create-properties",isInit:null,_deferredInit:{resolve:null,reject:null},setup:function(t){var s=this;s._parent(t),s.parent=t.parent,s.isInit=new e(function(e,t){s._deferredInit.resolve=e,s._deferredInit.reject=t}),s.settings=JSON.parse(M),s.form=null,s.formElements={title:null,type:null,similarIssues:null,description:null,classifications:null,resolutionRecommendation:null,priority:null,resolutionDate:null,reportingOrganization:null,responsibleOrganization:null},s.formElementsToggler={description:null,classifications:null,resolutionRecommendation:null,priority:null,resolutionDate:null,reportingOrganization:null,responsibleOrganization:null},s.fields={title:null,titleLabel:null,similarIssues:null,similarIssuesLabel:null,description:null,escalationRequired:null,classifications:null,attributes:null,resolutionRecommendation:null,priority:null,resolutionDate:null,reportingOrganization:null,responsibleOrganization:null},s.values={libIDs:[],classIDs:[],classNames:[],reportingOrganization:null,responsibleOrganization:null,reportingOrganizationTitle:null,responsibleOrganizationTitle:null},s.selected={classes:{},attributes:{},_classificationData:[],templateAttributes:{},attributeFields:{}};var n=[];if(s.customPropertiesView=new b({parent:s}),n.push(s.customPropertiesView.isInit),s.specializeProperties=new O({parent:s}),n.push(s.specializeProperties.isInit),s.settings.enableClassification){var i=new e(function(e,t){E.classification.getLibraries().then(function(e){return e.member}).then(function(e){s.classModel=new D({shouldBeSelected:function(e){return"Class"===e.options.grid.type},useAsyncPreExpand:!0}),s.classModel.prepareUpdate(),e.forEach(function(e){if("Inactive"!==e.state&&"Obsolete"!==e.state){s.values.libIDs.push(e.id);var t=s._createNode(e.title,e.id,"library","Library",e.libraryName,e.id);s.classModel.addRoot(t)}}),s.classModel.onPreExpand(function(e){var t=e.data.nodeModel;t.hasChildren()?e.target.preExpandDone():E.classification.getClasses({libId:t.options.id}).then(function(n){var i=n.member[0].ChildClasses.member,r=""!==n.member[0].title?n.member[0].title:n.member[0].name;s.classModel.prepareUpdate(),i.forEach(function(n){if("Obsolete"!==n.state&&"Inactive"!==n.state){s.values.classIDs.push(n.id);var i=""!==n.title?n.title:n.name;s.values.classNames.push(i);var a=r+" > "+i,o=t.options.id+","+n.id,l=s._createNode(i,n.id,"library-class","Class",a,o);e.target.addChild(l);var c=function(e,t){e.ChildClasses&&e.ChildClasses.member&&e.ChildClasses.member.forEach(function(e){if("Obsolete"!==e.state&&"Inactive"!==e.state){s.values.classIDs.push(e.id);var n=""!==e.title?e.title:e.name;s.values.classNames.push(n),o=t.options.grid.idPath+","+e.id,a=t.options.grid.path+" > "+n;var i=s._createNode(n,e.id,"library-class","Class",a,o);t.addChild(i),c(e,i)}})};c(n,l)}}),s.classModel.pushUpdate(),e.target.preExpandDone()})}),s.classModel.pushUpdate()}).finally(function(){e()})});n.push(i)}var r=new e(function(e,t){E.organizations.getCompanies({onComplete:function(e){s.organizations=e.body},onFailure:function(){s.organizations=[]}}).finally(function(){e()})});n.push(r),e.all(n).then(s._deferredInit.resolve).catch(function(e){console.log(e),s._deferredInit.reject(e)}),s._ckeditor="issue-description-creation-"+Date.now(),s._similarIssues=[],s._debouncedSearch=g.debounce(s._searchSimilarIssues.bind(s),x)},_createNode:function(e,t,s,n,i,r){return new A({label:e,id:t,icons:[s],grid:{idPath:r,type:n,path:i},children:"Library"===n?[]:null})},_addClasesForLibraries:function(){var t=this,s=[],n=!0;return t.classModel.getRoots().forEach(function(i){if(!i.isExpanded()){n=!1;var r=new e(e=>{t._addClassesForLibrary(i).then(e)});s.push(r)}}),n?e.resolve():e.all(s)},_addClassesForLibrary:function(t){var s=this;return new e(e=>{E.classification.getClasses({libId:t.options.id}).then(function(n){if(t.isExpanded())e();else{s.classModel.prepareUpdate();var i=n.member[0].ChildClasses.member,r=""!==n.member[0].title?n.member[0].title:n.member[0].name;i.forEach(function(e){if("Obsolete"!==e.state&&"Inactive"!==e.state){s.values.classIDs.push(e.id);var n=""!==e.title?e.title:e.name;s.values.classNames.push(n);var i=r+" > "+n,a=t.options.id+","+e.id,o=s._createNode(n,e.id,"library-class","Class",i,a);t.addChild(o);var l=function(e,t){e.ChildClasses&&e.ChildClasses.member&&e.ChildClasses.member.forEach(function(e){if("Obsolete"!==e.state&&"Inactive"!==e.state){s.values.classIDs.push(e.id);var n=""!==e.title?e.title:e.name;s.values.classNames.push(n),a=t.options.grid.idPath+","+e.id,i=t.options.grid.path+" > "+n;var r=s._createNode(n,e.id,"library-class","Class",i,a);t.addChild(r),t.expandAll(),l(e,r)}})};l(e,o)}}),t.expandAll(),s.classModel.pushUpdate(),e()}})})},destroy:function(){this.form=null,this.formElements={title:null,type:null,similarIssues:null,description:null,classifications:null,resolutionRecommendation:null,priority:null,resolutionDate:null},this.formElementsToggler={description:null,classifications:null,resolutionRecommendation:null,priority:null,resolutionDate:null},this.fields={title:null,type:null,titleLabel:null,similarIssues:null,similarIssuesLabel:null,description:null,classifications:null,attributes:null,resolutionRecommendation:null,priority:null,resolutionDate:null},this.values={libIDs:[],classIDs:[],classNames:[]},this.selected={classes:{},attributes:{},_classificationData:[],templateAttributes:{},attributeFields:{}},delete CKEDITOR.instances[this._ckeditor],this._ckeditor="",this._issuesForSimilarity=null,s.is(this.specializeProperties,"object")&&this.specializeProperties.destroy(),s.is(this.customPropertiesView,"object")&&this.customPropertiesView.destroy()},render:function(){var e=this,t=C.get("widget")||window.widget;e.form=new n({className:"create-properties-form"}).inject(e.container),e.form.getContent().setAttribute("novalidate",!1);var i=new Date,r=new Date(i);r.setDate(r.getDate()-1);var a=new Date(i);a.setDate(a.getDate()+7);var o=s.createElement("div",{class:"create-form-content"}),l={id:"",name:"",element:"",type:"",placeholder:"",required:!1,value:"",minValue:"",maxValue:"",cssClass:"create-form-field",help:"",label:"",emphasize:"",icons:"",requiredText:R.create.required};l.element="title",l.type="text",l.placeholder="",l.required=!0,l.help=R.create.properties.labels.titleHelper,l.label=R.create.properties.labels.title,(d=e.createFormElement(l)).inject(o),l.element="type",l.type="subType",l.placeholder=R.create.properties.labels.titlePlaceholder,l.required=!1,l.help=R.create.properties.labels.typeHelper,l.label=R.create.properties.labels.type;var d=e.createFormElement(l);e.specializeProperties.noShowSubType||d.inject(o),l.element="securityContexts",l.type="comboBox",l.required=!1,l.label=R.create.properties.labels.credentials;let u=I.getSecurityContexts().cspaces;l.rangeItems=u.map(e=>({labelItem:e.label,valueItem:e.value})),l.value=t.getPreference("securityContext")?t.getPreference("securityContext").value:u[0].value,l.enableSearchFlag=!1;let m=e.createFormElement(l);u.length>1&&m.inject(o);e.formElements.title.getElementsByClassName("form-group")[0].querySelectorAll("input, div");e.formElements.title.querySelectorAll("input")[0].oninput=function(t){var s=this.value;e.parent&&!e.parent.isTemplate&&e.parent.updateTitle(s),e.parent.isTemplate?(e.fields.titleLabel.getElement(".required-form-field-required-label").removeClassName("highlight"),e.fields.titleLabel.getElement(".required-form-field-title-label").removeClassName("highlight")):(e.fields.titleLabel.getElement(".required-form-field-required-label").addClassName("highlight"),e.fields.titleLabel.getElement(".required-form-field-title-label").addClassName("highlight")),e._debouncedSearch()},e.fields.title.addEventListener("change",function(t){var s=e.formElements.title.querySelectorAll("input")[0];if(!t||document.activeElement!==s){var n=e.fields.title.value.trim();e.fields.title.value=n,e.parent.isTemplate?(e.fields.titleLabel.getElement(".required-form-field-required-label").removeClassName("highlight"),e.fields.titleLabel.getElement(".required-form-field-title-label").removeClassName("highlight")):(e.fields.titleLabel.getElement(".required-form-field-required-label").addClassName("highlight"),e.fields.titleLabel.getElement(".required-form-field-title-label").addClassName("highlight")),e._debouncedSearch()}});var p=e.similarIssueDiv();e.formElements.similarIssues=p,p.inject(o),e.formElements.similarIssues.hide(),l.element="description",l.type="memo",l.id=e._ckeditor,l.placeholder=R.create.properties.labels.descriptionPlaceholder,l.required=!1,l.help=R.create.properties.labels.descriptionHelper,l.label=R.create.properties.labels.description,l.value="",l.rangeItems=[],e.createFormElement(l).inject(o),e.formElements.description.getElementsByClassName("form-group")[0].querySelectorAll("textarea, div").forEach(function(e){e.style.width="100%",e.style.fontSize="medium"}),e.createClassificationField(l).inject(o),l.element="resolutionRecommendation",l.type="memo",l.placeholder=R.create.properties.labels.resolutionRecommendationPlaceholder,l.required=!1,l.value="",l.minValue="",l.maxValue="",l.cssClass="",l.label=R.create.properties.labels.resolutionRecommendation,l.help=R.create.properties.labels.resolutionRecommendationHelper,e.createFormElement(l).inject(o),e.formElements.resolutionRecommendation.getElementsByClassName("form-group")[0].querySelectorAll("textarea").forEach(function(e){e.style.width="100%",e.style.fontSize="medium",e.style.resize="both",e.style.overflow="auto"}),l.element="priority",l.type="buttonToggle",l.placeholder=R.create.properties.labels.priority,l.required=!1,l.id=["Low","Medium","High","Urgent"],l.value=["low","medium","high","urgent"],l.emphasize=["success","info","medium-attention","high-attention"],l.icons=["level-low","level-medium","level-high","alert"],l.minValue="",l.maxValue="",l.cssClass="",l.label=R.priorities.title,l.help=R.create.properties.labels.priorityHelper,e.createFormElement(l).inject(o);var f=C.get("ISU_AUTO_DATES");l.element="resolutionDate",l.type="date",l.placeholder=R.create.properties.labels.dueDatePlaceholder,l.required=!1,l.value="true"==f?a:void 0,l.emphasize="",l.icons="",l.minValue=r,l.maxValue="",l.cssClass="",l.label=R.create.properties.labels.dueDate,l.help=R.create.properties.labels.dueDatePlaceholder,e.createFormElement(l).inject(o),e.formElements.resolutionDate.getElementsByClassName("form-group")[0].querySelectorAll("input").forEach(function(e){e.style.fontSize="medium"}),l.element="escalationRequired",l.name="escalationRequired",l.id="escalationRequired_id",l.type="comboBox",l.label=R.create.properties.labels.escalationRequired,l.rangeItems=[{labelItem:R.create.properties.labels.escalationRequired_No,valueItem:"No"},{labelItem:R.create.properties.labels.escalationRequired_Yes,valueItem:"Yes"}],l.value="No",l.selectedIndex=0,l.enableSearchFlag=!1,e.createFormElement(l).inject(o);let h=e.formElements.reportingOrganization=s.createElement("div",{class:"create-form-element create-properties-form-element-reporting-organization",html:[{tag:"div",class:"create-form-visibility-mask"},{tag:"div",class:"create-form-visibility-toggle",html:[e.formElementsToggler.reportingOrganization=s.createElement("span",{class:"fonticon fonticon-eye"})]},{tag:"div",class:"create-form-field form-group",html:[{tag:"h5",html:R.create.team.labels.reportingOrganization},{tag:"div",html:[e.fields.addReportingOrganization=e._orgSearch("reportingOrganization"),e.fields.reportingOrganization=s.createElement("div",{class:"form-group-reporting-organization-holder"}),e.fields.reportingOrganization.reportingOrganizationHelper=s.createElement("div",{html:[s.createElement("span",{class:"fonticon fonticon-help"})]})]}]},{tag:"div",class:"create-form-help-tooltip",html:[e.fields.reportingOrganization.reportingOrganizationHelper]}]});e._setOrganization(I.getCurrentCredentials().organization,"reportingOrganization",I.getCurrentCredentials().details.orgNls),e.fields.reportingOrganization.reportingOrganizationHelper.tooltipInfos=new c({shortHelp:R.create.team.labels.reportingOrganizationHelper}),h.inject(o);let g=e.formElements.responsibleOrganization=s.createElement("div",{class:"create-form-element create-properties-form-element-responsible-organization",html:[{tag:"div",class:"create-form-visibility-mask"},{tag:"div",class:"create-form-visibility-toggle",html:[e.formElementsToggler.responsibleOrganization=s.createElement("span",{class:"fonticon fonticon-eye"})]},{tag:"div",class:"create-form-field form-group",html:[{tag:"h5",html:R.create.team.labels.responsibleOrganization},{tag:"div",html:[e.fields.addResponsibleOrganization=e._orgSearch("responsibleOrganization"),e.fields.responsibleOrganization=s.createElement("div",{class:"form-group-responsible-organization-holder"}),e.fields.responsibleOrganization.responsibleOrganizationHelper=s.createElement("div",{html:[s.createElement("span",{class:"fonticon fonticon-help"})]})]}]},{tag:"div",class:"create-form-help-tooltip",html:[e.fields.responsibleOrganization.responsibleOrganizationHelper]}]});return e._setOrganization(I.getCurrentCredentials().organization,"responsibleOrganization",I.getCurrentCredentials().details.orgNls),e.fields.responsibleOrganization.responsibleOrganizationHelper.tooltipInfos=new c({shortHelp:R.create.team.labels.responsibleOrganizationHelper}),g.inject(o),o.inject(e.form.elements.container),e.settings.enableCKEditor&&e._richTextField(),e.values.libIDs.length>0?e.formElements.classifications.show():e.formElements.classifications.hide(),s.is(e.specializeProperties,"object")&&!e.specializeProperties.noShow&&e.form.elements.container.addContent(e.specializeProperties.render()),s.is(e.customPropertiesView,"object")&&!e.customPropertiesView.noShow&&e.form.elements.container.addContent(e.customPropertiesView.render()),e},similarIssueDiv:function(){return this.formElements.similarIssues=s.createElement("div",{class:"create-form-element create-properties-form-element-similar-issues",html:[{tag:"div",class:"create-form-field form-group",html:[this.fields.similarIssuesLabel=s.createElement("h5",{class:"create-form-field-similar-issues-label",html:R.create.properties.labels.similarIssues}),this.fields.similarIssues=s.createElement("div",{class:"create-form-field-similar-issues"})]}]}),this.formElements.similarIssues},createClassificationField:function(e){return this.formElements.classifications=s.createElement("div",{class:"create-form-element",html:[{tag:"div",class:"create-form-visibility-mask"},{tag:"div",class:"create-form-visibility-toggle",html:[this.formElementsToggler.classifications=s.createElement("span",{class:"fonticon fonticon-eye"})]},{tag:"div",class:"create-form-field form-group",html:[{tag:"h5",html:R.create.properties.labels.classification},{tag:"div",html:[s.createElement("div",{class:"form-field-classification",html:this.fields.classifications=this._getClassificationField()}),this.fields.attributes=s.createElement("div",{class:"form-field-attributes"})]}]}]})},createFormElement:function(e){var t="create-form-element create-properties-form-element-"+e.element,n=this.formElements[e.element]=s.createElement("div",{class:t});this.parent.isTemplate&&!e.required&&this.createVisibilityMask(e).inject(n);return this.createFormGroup(e).inject(n),n},createFormGroup:function(e){var t=s.createElement("div",{class:"create-form-field form-group"});return(e.required?this.createRequiredLabel(e):this.createLabel(e)).inject(t),this.createFormField(e).inject(t),t},createVisibilityMask:function(e){return s.createElement("div",{html:[{tag:"div",class:"create-form-visibility-mask"},{tag:"div",class:"create-form-visibility-toggle",html:[this.formElementsToggler[e.element]=s.createElement("span",{class:"fonticon fonticon-eye"})]}]})},createRequiredLabel:function(e){var t=e.element+"Label",n="required-form-field-title-label"+(this.parent.isTemplate?"":" highlight"),i="required-form-field-required-label"+(this.parent.isTemplate?"":" highlight");return this.fields[t]=s.createElement("h5",{class:"required-form-field",html:[s.createElement("span",{class:n,html:R.create.properties.labels[e.element]}),s.createElement("div",{class:i+" wux-ui-3ds-required wux-ui-3ds"})]})},createLabel:function(e){e.element;return s.createElement("h5",{class:"create-form-field-label",html:e.label})},createFormField:function(e){var t=s.createElement("div",{name:e.name,id:e.id}),n=null;switch(e.type){case"text":case"memo":n=this.createTextField(e);break;case"date":n=this.createDateField(e);break;case"buttonToggle":n=this.createButtonToggle(e);break;case"subType":n=this.createSubTypePicker(e);break;case"comboBox":n=this.createComboBox(e)}return n.inject(t),t},createTextField:function(e){var t=null;return"text"===e.type?(t=this.fields[e.element]=new o({value:e.value,requiredFlag:e.required&&!this.parent.isTemplate,placeholder:e.placeholder})).getContent().setStyle("width","100%"):(t=this.fields[e.element]=new a({value:e.value,nbRows:4,requiredFlag:e.required&&!this.parent.isTemplate,placeholder:e.placeholder,newLineMode:"enter"})).getContent().setStyle("width","100%"),t},createDateField:function(e){return this.fields[e.element]=new l({value:e.value,minValue:e.minValue,maxValue:e.maxValue})},createButtonToggle:function(e){var t=this.fields[e.element]=new r({type:"radio"}),s=[];return e.value.forEach(function(n,r){var a=new i({label:R.priorities[n],value:e.id[r],icon:{iconName:e.icons[r],fontIconFamily:WUXManagedFontIcons.Font3DS,fontIconSize:"1x"},emphasize:e.emphasize[r],checkFlag:0===r});t.addEventListener("buttonclick",function(e){e.dsModel.checkFlag=!0}),s.push(a),t.addChild(a)}),t},createSubTypePicker:function(e){var t=null;return"type"==e.element&&(t=this.specializeProperties.getSubTypePicker()),t},show:function(){s.is(this.specializeProperties,"object")&&!this.specializeProperties.noShow&&this.specializeProperties.show(),s.is(this.customPropertiesView,"object")&&!this.customPropertiesView.noShow&&this.customPropertiesView.show(),this._parent(),this.formElements.title.querySelectorAll("input").length>0&&this.formElements.title.querySelectorAll("input")[0].focus()},hide:function(){s.is(this.specializeProperties,"object")&&this.specializeProperties.hide(),s.is(this.customPropertiesView,"object")&&this.customPropertiesView.hide(),this._parent()},validate:function(){var e=!1;return this.form.fields=Object.values(this.fields).filter(function(e){return null!==e}),e=this.form.validate(!1,!1),s.is(this.specializeProperties,"object")&&!this.specializeProperties.noShow&&(e=e?this.specializeProperties.validate():e),s.is(this.customPropertiesView,"object")&&!this.customPropertiesView.noShow&&(e=e?this.customPropertiesView.validate():e),e},getValues:function(){var e,t,n,i=this,r=new Date,a=i.fields.resolutionDate.value;null!=a&&""!==a&&(n=a.toString()),"true"==C.get("ISU_AUTO_DATES")&&(e=r.toString(),t=r.toString());var o="";o=i.settings.enableCKEditor?CKEDITOR.instances[i._ckeditor].getData():s.String.escapeHTML(i.fields.description.value);var l=[],c={};i.selected._classificationData.forEach(function(e){l.push(e[0].classId),e[0].classAttributes.forEach(function(e){c[e.name]=i.selected.attributes[e.name]?i.selected.attributes[e.name]:e.value})});var d={title:i.fields.title.value,description:o,securityContexts:i.fields.securityContexts.value,resolutionRecommendation:i.fields.resolutionRecommendation.value,priority:i.fields.priority.value[0],escalationRequired:i.fields.escalationRequired.value,resolutionDate:n,estimatedStartDate:e,estimatedEndDate:t,classes:l,attributes:c,classification:i.selected._classificationData,reportingOrganization:i.values.reportingOrganization,responsibleOrganization:i.values.responsibleOrganization,reportingOrganizationTitle:i.values.reportingOrganizationTitle,responsibleOrganizationTitle:i.values.responsibleOrganizationTitle};return s.is(i.specializeProperties,"object")&&s.merge(d,i.specializeProperties.getValues()),s.is(i.customPropertiesView,"object")&&s.merge(d,i.customPropertiesView.getValues()),d},getHiddenAttributes:function(){var e={};for(var t in this.formElements)s.is(this.formElementsToggler[t])&&(e[t]=this.formElementsToggler[t].hasClassName("fonticon-eye-off"));return s.is(this.specializeProperties,"object")&&!this.specializeProperties.noShow&&s.merge(e,this.specializeProperties.getHiddenAttributes()),s.is(this.customPropertiesView,"object")&&!this.customPropertiesView.noShow&&s.merge(e,this.customPropertiesView.getHiddenAttributes()),e},applyTemplate:function(t){var n=this;return n.reset().then(function(){var i=[];s.is(t.data.title)&&(n.fields.title.value=t.data.title,n.formElements.title.querySelectorAll("input")[0].oninput(),n.parent&&!n.parent.isTemplate&&n.parent.updateTitle(t.data.title));if(s.is(t.data.description))if(n.settings.enableCKEditor){var r=new e(function(e){var s=setInterval(function(){void 0!==CKEDITOR.instances[n._ckeditor]&&(clearInterval(s),CKEDITOR.instances[n._ckeditor].setData(t.data.description,{callback:e}))},U)});i.push(r)}else n.fields.description.value=v.getTextFromHTML(t.data.description);if(s.is(t.data.resolutionRecommendation)&&(n.fields.resolutionRecommendation.value=t.data.resolutionRecommendation),s.is(t.data.priority)&&(n.fields.priority.getButtonFromValue(t.data.priority).checkFlag=!0),s.is(t.data.resolutionDate)&&(n.fields.resolutionDate.value=t.data.resolutionDate),s.is(t.data.escalationRequired)&&(n.fields.escalationRequired.value=t.data.escalationRequired),s.is(t.data.securityContexts)&&(n.fields.securityContexts.value=t.data.securityContexts),n.selected.templateAttributes=t.data.attributes,s.is(t.data.classification,"array")&&n.applyClass(t.data.classification),s.is(t.hidden,"object")&&s.is(n.formElements,"object")&&s.is(n.formElementsToggler,"object")){var a=n.formElements,o=n.formElementsToggler;for(var l in a)!0===t.hidden[l]&&(n.parent.isTemplate?(s.is(a[l])&&a[l].toggleClassName("visibility-masked",!0),s.is(o[l])&&(o[l].toggleClassName("fonticon-eye-off",!0),o[l].toggleClassName("fonticon-eye",!1))):s.is(a[l])&&a[l].hide())}return s.is(n.specializeProperties,"object")&&!n.specializeProperties.noShow&&i.push(n.specializeProperties.applyTemplate(t)),s.is(n.customPropertiesView,"object")&&!n.customPropertiesView.noShow&&i.push(n.customPropertiesView.applyTemplate(t)),s.is(t.data.responsibleOrganization)&&(t.data.responsibleOrganizationTitle?n._setOrganization(t.data.responsibleOrganization,"responsibleOrganization",t.data.responsibleOrganizationTitle):n._setOrganization(t.data.responsibleOrganization,"responsibleOrganization")),s.is(t.data.reportingOrganization)&&(t.data.reportingOrganizationTitle?n._setOrganization(t.data.reportingOrganization,"reportingOrganization",t.data.reportingOrganizationTitle):n._setOrganization(t.data.reportingOrganization,"reportingOrganization")),e.all(i)})},applyClass:function(t){var n=this,i=[],r=[];s.is(t)&&s.is(t[0])&&s.is(t[0][0])&&s.is(t[0][0].classIdPath)?t.forEach(function(t){var s=new e(e=>{var s=t[0],i=s.classIdPath.substring(0,s.classIdPath.indexOf(",")),a=n.classModel.getAllDescendants().filter(e=>e.options.grid.idPath==i);if(1==a.length)if(a[0].isExpanded()){var o={model:a[0],data:[t]};e(o)}else n._addClassesForLibrary(a[0]).then(()=>{var s={model:a[0],data:[t]};e(s)});else r.push(s),e()});i.push(s)}):i.push(new e(e=>{n._addClasesForLibraries().then(()=>{var s={model:n.classModel,data:t};e(s)})})),e.all(i).then(e=>{e.forEach(function(e){var t;e&&(t=e.model,e.data.forEach(function(e){var s=e[0],n=t.getAllDescendants().filter(e=>e.options.id===s.classId);0==n.length?r.push(s):n.map(e=>{e.select()})}))});var t=n.autoCompleteMultiSel.selectedItems;if(n.autoCompleteMultiSel._selectionChips.removeAllChips(),n.addBtn.disabled=!0,t&&t.length>0&&n._addClass(t),r.length>0){var s=r.map(e=>e.className).join(", ");f.displayNotification({msg:R.replace(R.templates.errors.classificationApplyTemplateFailed,{ClassNames:s}),eventID:"error"})}})},reset:function(){var t=this;return new e(function(e){t.fields.title.value="",t.formElements.title.querySelectorAll("input")[0].oninput();var s=new Date,n=new Date(s);n.setDate(n.getDate()+7);var i=C.get("ISU_AUTO_DATES");if(t.fields.resolutionRecommendation.value="",t.fields.priority.getButton(0).checkFlag=!0,t.fields.resolutionDate.value="true"==i?n:void 0,t.settings.enableCKEditor)var r=setInterval(function(){void 0!==CKEDITOR.instances[t._ckeditor]&&(clearInterval(r),CKEDITOR.instances[t._ckeditor].setData("",{callback:e}))},U);else t.fields.description.value="",e()})},_searchSimilarIssues:function(){var e=this;if(s.is(e.fields)&&s.is(e.fields.title)&&s.is(e.fields.similarIssues)&&s.is(e.fields.similarIssuesLabel)&&s.is(e.formElements)&&s.is(e.formElements.similarIssues)){var t="";if(e.formElements.title.querySelectorAll("input").length>0)t=e.formElements.title.querySelectorAll("input")[0].value;t.length>0?E.search({data:{query:"(3dexpiss:#all) "+t,select_predicate:["resourceid","ds6w:created","ds6w:modified","ds6w:identifier","owner","ds6w:responsible","ds6wg:revision","ds6w:status","ds6w:label","ds6w:type"]}}).then(function(t){if(Array.isArray(t.body.results)?e._similarIssues=t.body.results.map(function(e){return y.parseFetchResponse(e).value}):e._similarIssues=[],e._similarIssues.length>0){e.fields.similarIssues.empty();for(var n=0;n<e._similarIssues.length;n++){var i=s.clone(e._similarIssues[n]),r=e._similarIssues[n].name+"  "+R.create.properties.labels.Created+" "+g.timeSince(new Date(i.created))+" "+R.create.properties.labels.ago+" by "+i.responsible+"  "+R.create.properties.labels.Updated+" "+g.timeSince(new Date(i.modified))+" "+R.create.properties.labels.ago,a=g.computeSharedIssuesURL([i.physicalId]);s.createElement("div",{class:"create-form-field-similar-issues-line",html:[s.createElement("a",{html:[s.createElement("div",{class:"create-form-field-similar-issues-line-title",html:[s.createElement("img",{src:g.getIconByState(i.state,i.type,i.typeIcon),title:R.maturity[i.state.toLowerCase()]}),s.createElement("span",{html:s.String.escapeHTML(e._similarIssues[n].title)})]}),s.createElement("div",{class:"create-form-field-similar-issues-line-info",html:g.getTextFromHTML(r)})],href:a,target:"_blank"})]}).inject(e.fields.similarIssues)}var o=g.computeSharedIssuesURL(e._similarIssues.map(function(e){return e.physicalId}));e.fields.similarIssuesLabel.setContent([R.create.properties.labels.similarIssues," (",{tag:"a",html:e._similarIssues.length,href:o,target:"_blank"},")"]),e.formElements.similarIssues.show()}else e.formElements.similarIssues.hide()}).catch(function(){e.formElements.similarIssues.hide()}):e.formElements.similarIssues.hide()}},_richTextField:function(){var e=this,t=C.get("widget")||window.widget,n=p.getWebappsBaseUrl()+"/ExternalComponents/libraries/ckeditor",i=n+"/config.js",r={sharedspace:n+"/plugins/sharedspace/",colorbutton:n+"/plugins/colorbutton/",panelbutton:n+"/plugins/panelbutton/",quicktable:n+"/plugins/quicktable/"},a="";for(var o in r)CKEDITOR.plugins.addExternal(o,r[o],"plugin.js"),a+=o+",";var l={skin:"office2013,"+n+"/skins/office2013/",contentsCss:n+"/contents.css",customConfig:i,extraPlugins:a=a.slice(0,-1),removePlugins:"elementspath",language:t.lang,toolbar:"Rich",height:100,autoGrow_minHeight:100,on:{focus:function(){},instanceReady:function(){var t=this;if(s.Utils.Client.Features.touchEvents){var n=t.document.getBody();n.$.addEventListener("touchstart",function(){t.focusManager.focus(),n.$.focus()}),document.addEventListener("mouseup",function(){t.focusManager.hasFocus&&(t.focusManager.blur(),e.fields.title.focus(),e.fields.title.blur())})}},blur:function(){},change:function(){}}},c=setInterval(function(){void 0!==CKEDITOR.dom.element.get(e._ckeditor)&&(clearInterval(c),CKEDITOR.instances.hasOwnProperty(e._ckeditor)||CKEDITOR.replace(e._ckeditor,l))},U)},_getClassificationField:function(){var e=this;return e.classificationField=new s.Element("div",{class:"classification-container"}),e.autoCompleteMultiSel=new w({elementsTree:e.classModel,placeholder:R.create.properties.labels.classificationPlaceholder}),e.autoCompleteMultiSel.addEventListener("change",function(){var t=e.autoCompleteMultiSel.selectedItems;e.selectedClasses=t,0===e.autoCompleteMultiSel._selectionChips.getNumberOfChips()&&(e.addBtn.disabled=!0);for(var s=!1,n=t.length-1;n>=0;n--)if(!e.values.classNames.includes(t[n].options.label)){e.autoCompleteMultiSel._selectionChips.removeChip(t[n].options.label),e.autoCompleteMultiSel.selectedItems.splice(n,1),s=!0;break}!s&&e.autoCompleteMultiSel._selectionChips.getNumberOfChips()>0&&(e.addBtn.disabled=!1)}),e.autoCompleteMultiSel.getContent().addEventListener("keydown",function(e){13==e.keyCode&&e.stopPropagation()}),e.autoCompleteMultiSel.inject(e.classificationField),e.addBtn=new i({label:R.create.properties.labels.classificationAddBtn,domId:"addBtn",disabled:!0}),e.addBtn.getContent().addEventListener("buttonclick",function(){e.autoCompleteMultiSel._selectionChips.removeAllChips(),e._addClass(e.selectedClasses),e.addBtn.disabled=!0}),e.addBtn.inject(e.classificationField),e.classificationField},_addClass:function(t){var s=this;s.classModel.unselectAll();var n=[];t.forEach(function(t){if(!s.selected.classes[t.options.id]){s.selected.classes[t.options.id]={};var i=new e(function(e){E.classification.getClassificationAttributesOfClass({id:t.options.id,onFailure:function(e){console.log(e)}}).then(function(s){e({data:s,item:t})})});n.push(i)}}),e.all(n).then(function(e){e.forEach(function(e){var t=[{classId:e.data.member[0].id,className:e.data.member[0].name,classPath:e.item.options.grid.path,classIdPath:e.item.options.grid.idPath,classAttributes:e.data.member[0].ClassAttributes.member}];s.classification=new _({classification:{data:t,attributes:s.selected.templateAttributes,selectedData:s.selected,classModel:s.classModel}});var n=s.classification.render();s.selected._classificationData.push(n._classificationData);var i=n.form;i.inject(s.fields.attributes,"top");var r={classId:e.data.member[0].id,element:i};s.selected.classes[e.item.options.id]=r})})},createComboBox:function(e){var t=e.rangeItems,s=function(){var e=new D;e.prepareUpdate();for(var s=0;s<t.length;s++){var n=t[s].labelItem,i=t[s].valueItem,r=new A({label:n,grid:{valueItem:i}});e.addRoot(r)}return e.pushUpdate(),e}();return this.fields[e.element]=new T({elementsTree:s,value:e.value,enableSearchFlag:1==e.enableSearchFlag})},_orgSearch:function(e){var t=this,s=new N({className:"searchPeople_TransferOwnership",MaxNumber:"5",MaxSize:"300",position:"auto",showEmptyCategory:!1,type:L.TYPE_ORGANIZATION,events:{onValid:function(){var n=s.getNewOwner().organization;t._setOrganization(n.orgID,e,n.orgTitle),s.clearInput(),s.getContent().searchInput.focus()},onUnvalid:function(){console.log("inside no valid")},onError:function(){f.displayNotification({msg:R.team.error.orgNotFound,eventID:"info"})}}});return s.setSelectedItemList([{objectID:t.organizations[0].physicalId}]),s},_setOrganization:function(e,t,n){if(!s.is(n)||""==n){n=e;var i=C.get(P);s.is(i)&&s.is(i["ds6w:organizationResponsible"][e])&&(n=i["ds6w:organizationResponsible"][e])}var r=s.createElement("div",{class:"team-content-org-container",html:[s.createElement("span",{class:"team-content-org-icon fonticon view-icon fonticon-users"}),s.createElement("span",{class:"team-content-org-info",html:g.getTextFromHTML(n)})]});this.fields[t].empty(),this.fields[t].appendChild(r),this.values[t]=e,this.values[t+"Title"]=n}})}),define("DS/IssueComponents/create/Create",["UWA/Class/Events","UWA/Class/Promise","UWA/Controls/Abstract","DS/Controls/TabBar","UWA/Core","DS/UIKIT/Iconbar","DS/UIKIT/Input/Button","DS/UIKIT/Mask","DS/UIKIT/Scroller","DS/UIKIT/Toggler","DS/UIKIT/Tooltip","DS/Controls/ComboBox","DS/ENOFloatingPanel/ENOFloatingPanel","DS/Logger/Logger","DS/PADUtils/views/PADAlert","DS/PlatformAPI/PlatformAPI","DS/Controls/Expander","DS/Controls/Toggle","DS/Controls/ButtonGroup","DS/Controls/LineEditor","DS/Controls/Editor","DS/IssueAttachmentManager/components/Collection","DS/IssueAttachmentManager/services/AttachmentServices","DS/IssueAttachmentManager/views/UploadDialog","i18n!DS/IssueAttachmentManager/assets/nls/IssueAttachmentManager","DS/IssueCommon/commands/CommandsManager","DS/IssueCommon/utils/Utils","DS/IssueComponents/create/Custom","DS/IssueComponents/create/CustomNew","DS/IssueComponents/create/Attachments","DS/IssueComponents/create/Finalize","DS/IssueComponents/create/Properties","DS/IssueComponents/create/PropertiesNew","DS/IssueComponents/create/Related","DS/IssueComponents/create/Team","DS/IssueComponents/utils/Utils","DS/IssueServices/Contexts","DS/IssueServices/services/IssueServices","DS/IssueServices/services/PlatformServices","DS/IssueServices/utils/Performance","text!DS/IssueCommon/assets/Settings.json","i18n!DS/IssueComponents/assets/nls/IssueComponents","css!DS/IssueComponents/IssueComponents.css"],function(e,t,s,n,i,r,a,o,l,c,d,u,m,p,f,h,g,v,b,C,E,I,y,S,w,T,D,A,_,O,N,L,R,M,P,U,x,k,j,F,V,B){"use strict";var G="Issue",H={MULTI_STEP:"multi-step",FULL_VIEW:"full-view"},W={MULTI_STEP:"view-big-tile",FULL_VIEW:"view-list"},z="IssueCommon",q=100,Y=600,K=600,X=13;return s.extend(e,{name:"DS/IssueComponents/create/Create",isLoaded:null,_deferred:{resolve:null,reject:null},_tooltips:[],_defaultViewMode:null,defaultOptions:{editMode:!1,isTemplate:!1,escapeToClose:!0,resizable:!0},overwrite:null,init:function(e,t){this._parent(t),this.parentContainer=e,this._logger=p.getLogger(this.name),this._logger.log("Initializing the creation component"),this.elements={dialog:null,header:null,body:null,footer:null},this.modeToggler={iconBar:null},this.navigator={container:null,toggler:null},this.content={container:null},this.scroller=null,this.buttons={create:null,saveAsDraft:null,cancel:null},this._tooltips=[],this.isTemplate=this.options.isTemplate,this._allViewsHaveBeenRendered=!1,this._defaultViewMode=localStorage.getItem("IssueCommonCreateViewMode"),this.activeMode=null,this.activeView=null,this.views={},this.settings=JSON.parse(V),this.views={properties:{id:0,key:"properties",label:B.create.views.properties,fonticon:"view-icon fonticon-newspaper",view:this.settings.enableClassification?new R({parent:this}):new L({parent:this}),order:2},related:{id:1,key:"related",label:B.create.views.relatedObjects,fonticon:"view-icon fonticon-location",view:new M({parent:this}),order:4},attachments:{id:2,key:"attachments",label:B.create.views.attachments,fonticon:"view-icon fonticon-attach",view:new O({parent:this}),order:5},team:{id:3,key:"team",label:B.create.views.team,fonticon:"view-icon fonticon-users",view:new P({parent:this}),order:6}}},destroy:function(){var e=this,t=x.get("component");t&&t._tasks&&t._tasks.current&&"SELECT_IN_3D"===t._tasks.current.taskType&&t.taskManager.cancel(t._tasks.current.taskId),e._tooltips.forEach(function(e){e.destroy()}),Object.keys(e.views).forEach(function(t){e.views[t].view.destroy(),e.views[t]=null}),e.elements={dialog:null,header:null,body:null,footer:null},e.modeToggler={iconBar:null},e.navigator={container:null,toggler:null},e.content={container:null},e.scroller.destroy(),e.scroller=null,e.buttons={create:null},e._tooltips=[],e._allViewsHaveBeenRendered=!1,e._defaultViewMode=null,e.activeMode=null,e.activeView=null,e.sortedViewsIds=null,e.views={},e.parentContainer=null},render:function(){var e=this;e.isLoaded=new t(function(t,s){e._deferred.resolve=t,e._deferred.reject=s});var s=Object.keys(e.views).map(function(t){return e.views[t].view.isInit});t.all(s).then(function(){Object.keys(e.views).forEach(function(t){e.views[t].view.noShow&&delete e.views[t]}),e.sortedViewsIds=Object.keys(e.views),e.sortedViewsIds.sort(function(t,s){return e.views[t].order-e.views[s].order}),e.footer(),e.body(),e.dialog(e.parentContainer)}).catch(e._deferred.reject)},dialog:function(e){var t=this,s=D.throttle(function(){t.onResize()},q);t.elements.dialog=new m({animate:!0,autocenter:!0,closable:!0,escapeToClose:t.options.escapeToClose,limitParent:!1,overlay:!1,resizable:t.options.resizable,visible:!0,className:"create-view-dialog",title:"",body:t.elements.body,footer:t.elements.footer,events:{onShow:function(){t.build()},onResizeFloating:function(){s()},onMove:function(){},onClose:function(){t.dispatchEvent("onCreateDialogClose"),t.elements.dialog.destroy(),t.destroy()}}}),t.updateTitle(),t.elements.dialog.inject(e)},body:function(){var e=this;e.elements.body=i.createElement("div",{class:"create-view-body multi-step"+(e.isTemplate?" template-mode":"")}),e.elements.body.addEventListener("keydown",function(t){t.which===X&&e._create(!1)});var t=e.finalize=new N({parent:e}).render(),s=!1;e.isTemplate&&(s=!0),e.settingsExpander=new g({header:"",body:t,orientation:"horizontal",icon:"cog",expandedFlag:s}).inject(e.elements.body),e.settingsExpander.elements.header.title=B.create.settings,e.createContainer=i.createElement("div",{class:"create-container"}).inject(e.elements.body),e.navigator.container=i.createElement("nav",{class:"create-view-navigator-container"}).inject(e.createContainer),e._createPanelTabBar(["strip"],e.navigator.container),e.content.container=i.createElement("div",{class:"create-view-content"}).inject(e.createContainer),e.content.scrollable=i.createElement("div",{class:"create-view-scrollable-content"}),e.scroller=new l({element:e.content.scrollable}).inject(e.content.container),e.sortedViewsIds.forEach(function(t){var s=e.views[t];s.view&&(s.view.inject(e.scroller.getInnerElement()),s.view.hide())});var n={scroll:e._onScroll.bind(e)};e.scroller.elements.content.addEvents(n)},_createPanelTabBar:function(e,t,s){var i=this;s||(s="properties"),i.createPanelTabs&&i.createPanelTabs.destroy(),i.createPanelTabs=new n({displayStyle:e,minWidth:"100%"}),i.createPanelTabs.add({label:B.create.views.properties,isSelected:"properties"==s,icon:{iconName:"newspaper",fontIconFamily:WUXManagedFontIcons.Font3DS}}),i.createPanelTabs.add({label:B.create.views.relatedObjects,isSelected:"related"==s,icon:{iconName:"location",fontIconFamily:WUXManagedFontIcons.Font3DS}}),i.createPanelTabs.add({label:B.create.views.attachments,isSelected:"attachments"==s,icon:{iconName:"attach",fontIconFamily:WUXManagedFontIcons.Font3DS}}),i.createPanelTabs.add({label:B.create.views.team,isSelected:"team"==s,icon:{iconName:"users",fontIconFamily:WUXManagedFontIcons.Font3DS}}),i.createPanelTabs.inject(t),i.createPanelTabs.addEventListener("tabButtonClick",function(e,t){let s=e.dsModel.value[0],n=i._getViewIdFromTabValue(s);i.switchView(n)})},footer:function(){var e=this;e.elements.footer=i.createElement("div",{class:"create-view-footer"}),e.modeToggler.iconBar=new r({renderTo:e.elements.footer,items:[{name:"SwitchView",fonticon:e._defaultViewMode===H.FULL_VIEW?W.MULTI_STEP:W.FULL_VIEW,text:e._defaultViewMode===H.FULL_VIEW?B.create.modeToggler.tooltipMultiStep:B.create.modeToggler.tooltipFullView,handler:function(){var t=e.modeToggler.iconBar.getItem("SwitchView").elements.icon,s=e.modeToggler.iconBar.getItem("SwitchView").tooltip;!0===t.hasClassName("fonticon-"+W.MULTI_STEP)?(t.removeClassName("fonticon-"+W.MULTI_STEP),t.addClassName("fonticon-"+W.FULL_VIEW),s.setBody(B.create.modeToggler.tooltipFullView),e.switchViewMode(H.MULTI_STEP)):(t.removeClassName("fonticon-"+W.FULL_VIEW),t.addClassName("fonticon-"+W.MULTI_STEP),s.setBody(B.create.modeToggler.tooltipMultiStep),e.switchViewMode(H.FULL_VIEW))}}]});var t=i.createElement("div",{class:"create-view-footer-btn-container"}).inject(e.elements.footer);((e.buttons.create=new a({value:e.isTemplate?B.create.saveButton:B.create.sendButton,id:"create-view-footer-create-btn",className:"primary"}).inject(t)).addEvent("onClick",function(){e._create()}),e.isTemplate)||(e.buttons.saveAsDraft=new a({value:B.create.saveAsDraftButton,id:"create-view-footer-save-as-draft-btn",className:"default"}).inject(t)).addEvent("onClick",function(){e._create(!0)});(e.buttons.cancel=new a({value:B.create.cancelButton,id:"create-view-footer-cancel-btn",className:"default"}).inject(t)).addEvent("onClick",function(){e.cancel()})},build:function(){var e=this;if(!e._allViewsHaveBeenRendered){var t=function(e,t,s){return function(){i.is(e[s])&&e[s].toggleClassName("visibility-masked"),i.is(t[s])&&(t[s].toggleClassName("fonticon-eye"),t[s].toggleClassName("fonticon-eye-off"))}};Object.keys(e.views).forEach(function(s){var n=e.views[s];if(n.view&&(n.view.render(),e.isTemplate&&i.is(n.view.formElements,"object")&&i.is(n.view.formElementsToggler,"object"))){var r=n.view.formElements,a=n.view.formElementsToggler;for(var o in r)i.is(a[o])&&a[o].addEventListener("click",t(r,a,o))}});var s=e.finalize.formElements,n=e.finalize.formElementsToggler;for(var r in s)i.is(n[r])&&n[r].addEventListener("click",t(s,n,r));e.switchViewMode(e._defaultViewMode?e._defaultViewMode:H.MULTI_STEP),e.switchView(e.sortedViewsIds[0]),e._allViewsHaveBeenRendered=!0,e._deferred.resolve()}},onResize:function(){var e=this.elements.dialog.elements.container.getSize(),t=e.width<Y,s=e.height<K;this.elements.dialog.elements.container.toggleClassName("responsive-width-phone",t),this.elements.dialog.elements.container.toggleClassName("responsive-height-phone",s)},updateTitle:function(e){var t=this.options.editMode?B.create.titleActionEdit:B.create.titleActionCreate;t+=" ",t+=this.isTemplate?B.create.titleTemplate:B.create.title,e&&e.length&&(t+=": "+e),this.elements.dialog.setTitle(t)},_getViewIdFromTabValue:function(e){const{properties:t,related:s,attachments:n,team:i}=this.views;return[t,s,n,i].reduce((t,s)=>(s.id===e&&t.push(s),t),[])[0].key},_navItem:function(e){var t=this,s={};return s.container=i.createElement("a",{id:e.id,class:"nav-item"}),s.container.addEventListener("click",function(){t.activeMode===H.FULL_VIEW&&t.activeView===e.id&&t._highlightElement(e.view.container)}),s.container.addEventListener("dragover",function(){t.switchView(e.id)}),s.activeIndicator=i.createElement("div",{class:"nav-item-active-indicator"}).inject(s.container),i.createElement("span",{class:"fonticon fonticon-expand-down"}).inject(s.activeIndicator),s.circle=i.createElement("div",{class:"nav-item-circle"}).inject(s.container),i.createElement("span",{class:"fonticon "+e.fonticon}).inject(s.circle),s.label=i.createElement("div",{class:"nav-item-label",html:e.label}).inject(s.container),s},switchViewMode:function(e){var t=this;if(t.elements.body)if(e===H.MULTI_STEP)t._createPanelTabBar(["strip"],t.navigator.container,t.activeView),t.elements.body.addClassName("multi-step"),Object.keys(t.views).forEach(function(e){e!==t.activeView&&"view"in t.views[e]&&t.views[e].view.hide()});else if(t.elements.body.removeClassName("multi-step"),t._createPanelTabBar(["strip","vertical"],t.navigator.container,t.activeView),Object.keys(t.views).forEach(function(e){"view"in t.views[e]&&t.views[e].view.show()}),t.activeView in t.views&&"view"in t.views[t.activeView]){var s=t.views[t.activeView].view.container;t.scroller.scrollToElement(s),t._highlightElement(s)}t.activeMode=e,localStorage.setItem("IssueCommonCreateViewMode",e)},switchView:function(e){var t=this;if(t.navigator&&t.navigator.container&&t.activeView){var s=t.navigator.container.getElements("a"),n=!1;s.forEach(function(s){if(!1===n?s.removeClassName("filled").addClassName("filled"):s.removeClassName("filled"),s.id===t.activeView&&s.removeClassName("active"),s.id===e){s.addClassName("active");var i=s.getElement(".view-icon.fonticon");if(t.elements.body.hasClassName("multi-step")){var r=i.getPosition().x/t.navigator.container.getSize().width*100;r+=10,t.navigator.container.getElement(".ariadne-rope").setStyles({width:r+"%",height:"2px"})}else{var a=i.getPosition().y/t.navigator.container.getSize().height*100;t.navigator.container.getElement(".ariadne-rope").setStyles({width:"2px",height:a+"%"})}n=!0}})}if(t.activeMode===H.MULTI_STEP)t.activeView in t.views&&"view"in t.views[t.activeView]&&t.views[t.activeView].view.hide(),e in t.views&&"view"in t.views[e]&&t.views[e].view.show();else if(e in t.views&&"view"in t.views[e]&&t.scroller){var i=t.views[e].view.container;t.scroller.scrollToElement(i),t._highlightElement(i)}t.activeView=e},applyTemplate:function(e,s){var n=this;for(var i in s&&!0===s.overwrite&&(n.overwrite=e),o.mask(n.elements.dialog.getBody()),n.buttons)n.buttons.hasOwnProperty(i)&&n.buttons[i]&&n.buttons[i].disable();var r=Object.keys(n.views),a=[];if(r.forEach(function(t){var s=n.views[t];"applyTemplate"in s.view&&a.push(s.view.applyTemplate(e))}),a.push(n.finalize.applyTemplate(e)),!n.options.editMode&&!n.isTemplate){var l=n.templates.getTemplates().then(function(t){for(var s=new Date,i=0;i<t.length;i++)e.id&&e.id===t[i].id&&(t[i].info.lastUsed=s.getTime());return n.templates.setTemplates(t)});a.push(l)}return t.all(a).then(function(e){for(var t in o.unmask(n.elements.dialog.getBody()),n.buttons)n.buttons.hasOwnProperty(t)&&n.buttons[t]&&n.buttons[t].enable();return e})},applyIssue:function(e){var t=this,s=x.get("widget")||window.widget,n={};return k.preferences.getApprovalEnablement({data:{}}).then(function(e){var s=e.body.ApprovalProcess;t.adminPreference=s}),k.issues.retrieve({data:{objects:[{physicalId:e.id}]}}).then(function(r){var a=r.results[r.results.length-1].body;return n={id:"template-"+s.id+"-"+Date.now(),info:{description:null,name:null},ui:{assignees:a.assignees.reduce(function(e,t){return e[t.user]={fullName:t.fullName,user:t.user,type:t.type},e},{}),responsibleOrganization:a.responsibleOrganization,coOwners:a.coOwners.reduce(function(e,t){return e[t.user]={fullName:t.fullName,user:t.user,type:t.type},e},{}),contributors:a.contributors.reduce(function(e,t){return e[t.user]={fullName:t.fullName,user:t.user,type:t.type},e},{}),informedUsers:a.informedUsers.reduce(function(e,t){return e[t.user]={fullName:t.fullName,user:t.user,type:t.type},e},{})},data:{assignees:a.assignees,automationTasks:[],contexts:a.contexts,custom:a.custom,specialization:a.specialization,description:a.description||"",escalationRequired:a.escalationRequired,priority:a.priority||"Low",reportedAgainst:a.reportedAgainst,resolutionDate:a.resolutionDate,resolutionRecommendation:a.resolutionRecommendation||"",responsibleOrganization:a.responsibleOrganization,reportingOrganization:a.reportingOrganization,responsibleOrganizationTitle:a.responsibleOrganizationTitle,reportingOrganizationTitle:a.reportingOrganizationTitle,title:a.title||"",type:a.type||G,securityContexts:a.collaborativeSpace},hidden:{},applyIssue:!0},i.is(a.waitingOn,"string")&&("Always"==t.adminPreference?(a.waitingOn="Analyst",n.data.automationTasks.push("enableApproval")):"Never"==t.adminPreference?a.waitingOn="Unassigned":(t.adminPreference="Analyst"===a.waitingOn)&&n.data.automationTasks.push("enableApproval")),y.getDocumentsFrom(e.id)}).then(function(t){return Array.isArray(t.attachments)&&(n.data.attachments=t.attachments.map(function(e){return e.id})),y.getPrimary(e.id)}).then(function(t){var s=JSON.parse(t);return i.is(s.documentId,"string")&&""!==s.documentId&&(n.data.primaryAttachment=s.documentId),k.classification.getClassificationAttributesOfClassifiedItem({issueId:e.id})}).then(function(s){var i=[],r={};return s.member[0].ClassificationAttributes.member.forEach(function(e){var t=[],s={classId:e.ClassID};t.push(s),i.push(t),e.Attributes.forEach(function(e){r[e.name]=e.value})}),n.data.classification=i,n.data.attributes=r,t.applyTemplate(n).then(function(){f.displayNotification({msg:B.replace(B.create.issueApplySuccess,{title:e["ds6w:label"],name:e["ds6w:identifier"]}),eventID:"info"})})}).catch(function(s){f.displayNotification({msg:B.replace(B.create.issueApplyError,{title:e["ds6w:label"],name:e["ds6w:identifier"]}),eventID:"error"}),t._logger.error(s)})},cancel:function(){this.elements.dialog.options.events.onClose()},getDialog:function(){return this.elements.dialog},_onScroll:function(){var e=this;setTimeout(function(){if(e.activeMode===H.FULL_VIEW){var t=e.scroller._infos.y.scrollPosition;Object.keys(e.views).forEach(function(s){var n=e.views[s];if(n.view&&n.view.container){var i=n.view.container;if(t>=i.offsetTop&&t<i.offsetTop+i.offsetHeight){e.activeView=s;let t=e.views[s].id;e.createPanelTabs.getButtonFromValue(t).checkFlag=!0}}})}},0)},_highlightElement:function(e){e.addClassName("highlight"),e.addEventListener("animationend",function(){e&&e.removeClassName("highlight")})},_create:function(e){var s,n=this,r=x.get("widget")||window.widget,a=!0;for(var l in o.mask(r.body),n.buttons)n.buttons.hasOwnProperty(l)&&n.buttons[l]&&n.buttons[l].disable();return n.elements.dialog.rightButtons.getElement(".fonticon-cancel").addClassName("disabled"),n.isTemplate?s=n._validate().then(function(){return n._connectAttachments()}).then(function(){return n._saveAsTemplate().then(function(){n._publishTemplateCreateEvent()})}).catch(function(){a=!1}):(s=n._validate().then(function(){return n._createRequest(e)}).then(function(e){var s=e.physicalId;return n._publishEvent(s,"DS/Object/create"),t.resolve(s)}).then(function(e){return new t(function(t,s){n._connectAttachments(e).then(function(){t(e)}).catch(s)})}).then(function(e){var t=n.createData.classes;return Array.isArray(t)&&t.length>0?k.classification.getcsrf().then(function(t){return{issueId:e,csrf:t.csrf.value}}).catch(function(e){e&&i.is(e.body,"object")&&i.is(e.body.message,"string")?f.displayNotification({msg:e.body.message,eventID:"error"}):f.displayNotification({msg:B.create.classificationFailed,eventID:"error"}),null!=n.elements.dialog&&n.cancel(),o.unmask(r.body),n._logger.error(e)}):{issueId:e}}).then(function(e){var s=[],a=n.createData.classes;return Array.isArray(a)&&a.length>0?(a.forEach(function(a){var l=new t(function(t,s){k.classification.classify({classID:a,issueID:e.issueId,token:e.csrf}).then(function(s){"KO"===s.body.StatusOfObjects[e.issueId].status?(f.displayNotification({msg:B.create.classificationFailed,eventID:"error"}),null!=n.elements.dialog&&n.cancel(),o.unmask(r.body)):t(e)}).catch(function(e){e&&i.is(e.body,"object")&&i.is(e.body.message,"string")?f.displayNotification({msg:e.body.message,eventID:"error"}):f.displayNotification({msg:B.create.classificationFailed,eventID:"error"}),null!=n.elements.dialog&&n.cancel(),o.unmask(r.body),n._logger.error(e)})});s.push(l)}),t.all(s).then(function(e){return e[0]})):e}).then(function(e){var t=n.createData.classes;return Array.isArray(t)&&t.length>0?k.classification.getClassificationAttributesOfClassifiedItem({issueId:e.issueId}).then(function(t){var s=t.member[0]?t.member[0].cestamp:"";return{issueId:e.issueId,csrf:e.csrf,cestamp:s}}).catch(function(e){e&&i.is(e.body,"object")&&i.is(e.body.message,"string")?f.displayNotification({msg:e.body.message,eventID:"error"}):f.displayNotification({msg:B.create.setAttributesFailed,eventID:"error"}),null!=n.elements.dialog&&n.cancel(),n._logger.error(e)}):e}).then(function(e){var t=n.createData.attributes;return e.cestamp?k.classification.setClassificationAttributes({issueId:e.issueId,attributes:t,cestamp:e.cestamp,csrf:e.csrf}).then(function(t){return e.issueId}).catch(function(e){e&&i.is(e.body,"object")&&i.is(e.body.message,"string")?f.displayNotification({msg:e.body.message,eventID:"error"}):f.displayNotification({msg:B.create.setAttributesFailed,eventID:"error"}),null!=n.elements.dialog&&n.cancel(),n._logger.error(e)}):e.issueId}).then(function(e){var t=x.get("component");for(var s in n.createData.attributes)if(i.is(t)&&i.is(t.attributes)&&!t.attributes.includes(s)&&"cestamp"!==s){t.attributes.push(s);var r={column:{text:s,dataIndex:s,isDraggable:!0,isHidden:!0,visibleFlag:!1,export:{value:!0,lock:!1},moveable:!0,width:120,minWidth:5,isCustom:"Classification"}};if(t.listView){r.column.onCellRequest=t.list.rendering.classificationAttributes,t.list.getManager().getColumns().filter(e=>e.dataIndex==r.column.dataIndex).length<=0&&t.list.getManager().addColumn(r)}else{var a={that:t,attr:{name:s}};r.column.getCellValue=t.list.rendering.classificationAttributes.bind(a),t.list.getManager().getColumns().filter(e=>e.dataIndex==r.column.dataIndex).length<=0&&t.list.getManager().addColumnOrGroup(r.column)}}return e}).then(function(e){var s=[];return s.push(n._execAutomationTasks(e)),t.all(s)})).catch(function(){a=!1}),s.catch(function(e){return n._logger.error(e),t.reject(e)}).finally(function(){for(var e in o.unmask(r.body),n.buttons)n.buttons.hasOwnProperty(e)&&null!==n.buttons[e]&&n.buttons[e].enable();n.elements.dialog.rightButtons.getElement(".fonticon-cancel").removeClassName("disabled"),a&&n.elements.dialog.options.events.onClose()})},_createRequest:function(e){var t=this,s=Object.keys(t.views),n={};return s.forEach(function(e){var s=t.views[e];"getValues"in s.view&&i.merge(n,s.view.getValues())}),i.merge(n,t.finalize.getValues()),t.createData=n,i.is(n.custom)&&Object.values(n.custom)&&Object.values(n.custom).forEach((e,t)=>{Array.isArray(e)&&(n.custom[Object.keys(n.custom)[t]]=e.toString())}),i.is(n.description,"string")&&(n.description=U.getTextFromHTML(n.description),n.description.match(/.*\n$/)&&(n.description=n.description.replace(/\n+$/,""))),n.state=!0!==e?"Assign":"Create",k.issues.create({data:n}).then(function(e){try{D.cloudProbeUtils.sendCreateIssueTrackerEvent(t)}catch(e){}finally{return f.displayNotification({msg:B.create.creationSuccess,eventID:"success"}),e.body}}).catch(function(e){if(e.error&&e.error.internal&&e.error.internal.includes("You need at least one assignee to create an issue, as a validation process is attached to the issue for assignees")){var s=D.getErrorMessage("1004");D.displayErrorMessage(s,"error")}else if(i.is(e.error,"object")&&i.is(e.error.internal)&&(e.error.internal.includes("ErrorCode:2004")||e.error.internal.includes("Admin not allowed to create Issue"))){s=D.getErrorMessage("4");D.displayErrorMessage(s,"error")}else if(i.is(e.error,"object")&&i.is(e.error.internal)&&e.error.internal.includes("ErrorCode:2006")){s=(s=e.error.internal).replace("ErrorCode:2006","").replace("java.lang.Exception:",""),f.displayNotification({msg:s,eventID:"error"})}else if(i.is(e.error,"object")&&i.is(e.error.internal)&&e.error.internal.includes("exceeds maximum length")){s=e.error.message;f.displayNotification({msg:s,eventID:"error"})}else f.displayNotification({msg:B.create.creationFailed,eventID:"error"});t._logger.error(e)})},_validate:function(){var e=this,s=Object.keys(e.views);return new t(function(t,n){var i=s.every(function(t){var s=e.views[t],n=!0;return"validate"in s.view&&(n=s.view.validate()),n});i&&(i=e.finalize.validate()),i?t():(f.displayNotification({msg:B.create.validationFailed,eventID:"error"}),n(new Error("invalid fields")))})},_connectAttachments:function(e){var s=this,n=x.get("widget")||window.widget;if("attachments"in s.views&&"collection"in s.views.attachments.view){var i=s.views.attachments.view.collection,r=s.views.attachments.view.catalog,a=function(e){this.set("isCancelable",!0),this.set("request",e)},o=function(e){if(e.lengthComputable){var t=e.loaded/e.total;this.set("requestProgress",t)}},l=function(){this.set("isCancelable",!1),this.set("request",null)},c=i.filter(function(e){return!0===e.get("isFile")}).map(function(e){var t=e.clone();return t.set("isProcessing",!0),t}),d=[];if(c.length>0){var u=new I({id:e||"template",attachments:c});s.views.attachments.view.uploadCollection=u,new S({container:n.body,collection:u}).render(),d=c.map(function(n){t.resolve();return(null!=e?y.uploadFile(n.get("file"),e,{onCheckinStart:a.bind(n),onCheckinProgress:o.bind(n),onCheckinComplete:l.bind(n)}):y.uploadFile(n.get("file"),null,{onCheckinStart:a.bind(n),onCheckinProgress:o.bind(n),onCheckinComplete:l.bind(n)})).then(function(e){if(e&&e.data&&e.data.length>0&&e.data[0].id){var t=i.get(n.id);t.set("id",e.data[0].id),t.set("isFile",!1),r.attachments[e.data[0].id]=r.attachments[n.id],r.attachments[e.data[0].id].id=t.get("id"),r.attachments[e.data[0].id].container.id=t.get("id"),r.attachments[e.data[0].id].container.setAttribute("id","attachment-"+t.get("id")),r.attachments[e.data[0].id].container.setData("id",t.get("id")),delete r.attachments[n.id],n.set("id",e.data[0].id),n.set("isFile",!1),n.set("isProcessing",!1)}}).catch(function(e){n.set("isFailed",!0),n.set("isProcessing",!1),n.set("isCancelable",!1),n.set("request",null),e instanceof Error&&(f.displayNotification({msg:w.replace(w.notifications.Upload.failure,{count:1}),eventID:"error"}),s._logger.error(e))})})}var m=i.filter(function(e){return!0!==e.get("isFile")}).map(function(e){return e.clone()}),p=[];return m.length>0&&(p=m.map(function(n){return null!=e?y.connectDocumentToParent(n.id,e).catch(function(e){f.displayNotification({msg:w.notifications.Attach.failure,eventID:"error",count:1}),s._logger.error(e)}):t.resolve()})),t.all(d.concat(p)).then(function(){if(!s.isTemplate){var n=i.filter(function(e){return!0===e.get("isPrimary")});if(1===n.length){var r=n[0];return y.setAsPrimary(r.get("id"),e,!0).then(function(){f.displayNotification({msg:w.notifications.SetAsPrimary.success,eventID:"info"})}).catch(function(e){f.displayNotification({msg:w.notifications.SetAsPrimary.failure,eventID:"error"}),s._logger.error(e)})}}return t.resolve()})}return t.resolve()},_execAutomationTasks:function(){var e=t.resolve();if(this.finalize){var s=[];-1!==this.finalize.getTasks().indexOf("saveAsTemplate")&&s.push(this._saveAsTemplate()),e=t.all(s)}else e=t.resolve();return e},_saveAsTemplate:function(){var e=this,t=x.get("widget")||window.widget,s=Object.keys(e.views),n={},r={},a={};s.forEach(function(t){var s=e.views[t];"getValues"in s.view&&i.merge(n,s.view.getValues(!0)),"getUIValues"in s.view&&i.merge(r,s.view.getUIValues(!0)),"getHiddenAttributes"in s.view&&i.merge(a,s.view.getHiddenAttributes(!0))}),i.merge(a,e.finalize.getHiddenAttributes(!0)),n.automationTasks=e.finalize.getTasks();var o=e.finalize.getTemplateValues();o.version=x.version,o.tenant=j.getTenant();var l={id:"template-"+t.id+"-"+Date.now(),info:o,data:n,ui:r,hidden:a};return!0===i.is(e.overwrite,"object")&&(l.id=e.overwrite.id,l.info.lastUsed=e.overwrite.info.lastUsed,!0===e.templates.isShared(e.overwrite)&&(l.info.share=e.overwrite.info.share)),e.templates.getTemplates().then(function(t){var s=-1;if(!0===t.some(function(e,t){return e.id===l.id&&(s=t,!0)})){if(!0===e.templates.isShared(l))return e.templates.updateSharedTemplate(l).then(function(e){return t.splice(s,1,e),t});t.splice(s,1,l)}else t.push(l);return t}).then(function(t){return e.templates.setTemplates(t).then(function(){var t=B.create.creationTemplateSuccess;!0===i.is(e.overwrite,"object")&&(t=B.create.updateTemplateSuccess),f.displayNotification({msg:t,eventID:"success"})})})},_publishEvent:function(e,t){var s=x.get("widget")||window.widget,n=[],i={};n.push([e]),i[e]={};var r=Math.floor(Date.now()),a={metadata:{appId:s.id,appName:z,timestamp:r,options:{}},data:{paths:n,attributes:i},version:"1.0"};h.publish(t,a)},_publishTemplateCreateEvent:function(){this.dispatchEvent("onTemplateCreate")},templates:{getTemplates:function(){return new t(function(e,t){require(["DS/IssueComponents/templates/Templates"],function(s){var n=new s(x.get("widget"),{editMode:!0,onClose:function(){},onEnd:function(){}});n.getTemplates().then(function(t){e(t)},function(e){t(e)}).finally(function(){n.destroy(),n=null})})})},setTemplates:function(e){return new t(function(t,s){require(["DS/IssueComponents/templates/Templates"],function(n){var i=new n(x.get("widget"),{editMode:!0,onClose:function(){},onEnd:function(){}});i.setTemplates(e).then(t,s).finally(function(){i.destroy(),i=null})})})},updateSharedTemplate:function(e){return new t(function(t,s){require(["DS/IssueComponents/templates/Templates"],function(n){var i=new n(x.get("widget"),{editMode:!0,onClose:function(){},onEnd:function(){}});i.updateSharedTemplate(e).then(function(e){t(e)},function(e){s(e)}).finally(function(){i.destroy(),i=null})})})},isShared:function(e){return!0===i.is(e.info.share,"object")}}})}),define("DS/IssueComponents/templates/Templates",["UWA/Class/Promise","UWA/Class/View","UWA/Core","DS/UIKIT/Iconbar","DS/UIKIT/Input/Button","DS/UIKIT/Mask","DS/UIKIT/Popover","DS/UIKIT/Scroller","DS/UIKIT/Input/Text","DS/UIKIT/Toggler","DS/UIKIT/Tooltip","DS/Core/PointerEvents","DS/DocumentManagement/DocumentManagement","DS/ENOFloatingPanel/ENOFloatingPanel","DS/Logger/Logger","DS/PADUtils/views/PADAlert","DS/PlatformAPI/PlatformAPI","DS/Tree/TreeListView","DS/TreeModel/TreeNodeModel","DS/IssueCommon/commands/CommandsManager","DS/IssueCommon/utils/Utils","DS/IssueComponents/create/Create","DS/IssueComponents/users/Users","DS/IssueServices/Contexts","DS/IssueServices/services/IssueServices","DS/IssueServices/services/PlatformServices","DS/IssueServices/utils/Parser","DS/IssueServices/utils/Performance","i18n!DS/IssueComponents/assets/nls/IssueComponents","css!DS/IssueComponents/IssueComponents.css"],function(e,t,s,n,i,r,a,o,l,c,d,u,m,p,f,h,g,v,b,C,E,I,y,S,w,T,D,A,_){"use strict";var O="Low",N="Medium",L="High",R="Urgent",M="ISU_TEMPLATES",P=0,U=4,x="#dashboard:/tab:/app:ENXISSU_AP/content:XTemplateContentId=",k=100;return t.extend({name:"DS/IssueComponents/templates/Templates",_logger:null,isLoaded:null,_deferred:{resolve:null,reject:null},_isRendered:!1,defaultOptions:{editMode:!1,treeList:{grid:{allowUnsafeHTMLContent:!0,selection:{toggle:!1,unselectAllOnEmptyArea:!0,canMultiSelect:!0,enableListSelection:!0},height:"100%",apiVersion:2,defaultCellHeight:26,useTransparentScroller:!1,useNativeScroller:!1,useAsyncPreExpand:!0,resize:{columns:!0,rows:!0},columns:[{text:s.createElement("div",{class:"template-shared-header-container",html:s.createElement("span",{class:"fonticon fonticon-share-alt"})}),dataIndex:"shared",width:50,isDraggable:!1,resizable:!1},{text:_.templates.treeList.tree,dataIndex:"tree",width:270,isDraggable:!1},{text:_.templates.treeList.description,width:"auto",dataIndex:"description",isDraggable:!1},{text:_.templates.treeList.owner,width:60,dataIndex:"owner",isDraggable:!1,resizable:!1}]}}},init:function(e,t){this._parent(t),this.container=e,this._logger=f.getLogger(this.name),this._logger.log("Initializing the templates component"),this.elements={dialog:null,header:null,body:null,footer:null},this.templateList={container:null,title:null,treeListContainer:null,treeList:null,iconBarContainer:null,iconBar:null},this.templateLastUsed={container:null,header:null,previews:{container:null,templates:{}}},this.buttons={cancel:null,select:null},this._tooltips=[],this.user=T.getUserName(),this.userInfo=g.getUser(),this.popover=null,this.onClose=t.onClose.bind(this),this.onEnd=t.onEnd.bind(this)},destroy:function(){this._tooltips.forEach(function(e){e.destroy()}),this._tooltips=[],this.elements={dialog:null,header:null,body:null,footer:null},this.templateList={container:null,title:null,treeListContainer:null,treeList:null,iconBarContainer:null,iconBar:null},this.templateLastUsed={container:null,header:null,previews:{container:null,templates:{}}},this.buttons={cancel:null,select:null},this.user="",this.userInfo="",this._destroyPopover()},render:function(){var t=this;t.isLoaded=new e(function(e,s){t._deferred.resolve=e,t._deferred.reject=s}),t.setBody(),t.setFooter(),t.dialog(t.container)},dialog:function(e){var t=this;t._closeCallbackEnabled=!0,t.elements.dialog=new p({animate:!0,autocenter:!0,closable:!0,limitParent:!1,overlay:!1,resizable:!0,visible:!0,className:"create-template-chooser-dialog",title:t.options.editMode?_.templates.titleEdit:_.templates.title,header:null,footer:t.elements.footer,events:{onShow:function(){t.build()},onResizeFloating:function(){},onMove:function(){},onClose:function(){!0===t._closeCallbackEnabled&&(t.elements.dialog.destroy(),t.onClose(),t.destroy())}}}),new o({element:t.elements.body}).inject(t.elements.dialog.getBody()),t.elements.dialog.inject(e)},setBody:function(){var e=this;e.elements.body=s.createElement("div",{class:"create-template-chooser-body hide-last-used"}),!0===e.options.editMode&&e.elements.body.addClassName("edit-mode"),e.templateLastUsed.container=s.createElement("div",{class:"create-template-chooser-last-used"}).inject(e.elements.body),e.templateLastUsed.header=s.createElement("div",{class:"h5 create-template-chooser-last-used-header",html:_.templates.lastUsed.title}).inject(e.templateLastUsed.container),e.templateLastUsed.previews.container=s.createElement("div",{class:"create-template-chooser-last-used-previews-container"}).inject(e.templateLastUsed.container),e.templateList.container=s.createElement("div",{class:"create-template-chooser-list"}).inject(e.elements.body),e.templateList.iconBarContainer=s.createElement("div",{class:"create-template-chooser-list-iconbar"}).inject(e.templateList.container),e.templateList.title=s.createElement("div",{class:"h5 create-template-chooser-list-title",html:_.templates.iconBar.title}).inject(e.templateList.iconBarContainer),!0===e.options.editMode&&(e.templateList.iconBar=new n({renderTo:e.templateList.iconBarContainer,items:[{id:"create",text:_.templates.iconBar.create,fonticon:"plus",handler:function(){e.hide();var t=new I(e.container,{isTemplate:!0});t.render(),e._listenToCreateEvents(t)}},{id:"fromIssue",text:_.templates.iconBar.fromIssue,fonticon:"import",handler:function(){var t=S.get("application");if(s.is(t,"object")&&t.isStandalone){var n=S.get("component"),i=n.taskManager.addObjectsTask(function(t){if(Array.isArray(t.physicalIds)){e.hide();var s=new I(e.container,{isTemplate:!0});s.render(),s.isLoaded.then(function(){var e={id:t.physicalIds[t.physicalIds.length-1]};s.applyIssue(e)}).finally(function(){e._listenToCreateEvents(s)})}n.unmaskForTask(i)},function(){n.unmaskForTask(i)});n.maskForTask(i,_.tasks.addObjects)}else T.search({title:_.create.start.actionPage.issue.fromIssue,default_search_criteria:"",precond:'(flattenedtaxonomies:"types/Issue")',multiSel:!1,callback:function(t){e.hide();var s=new I(e.container,{isTemplate:!0});s.render(),s.isLoaded.then(function(){s.applyIssue(t[t.length-1])}).finally(function(){e._listenToCreateEvents(s)})},cancel:function(){}})}},{id:"clone",text:_.templates.iconBar.clone,fonticon:"duplicate",handler:function(){var t=e.templateList.treeList.getDocument().getSelectedNodes();if(1===t.length){var n=s.clone(t[t.length-1].options.data);e.hide(),n.info.name=_.replace(_.templates.clonePrefix,{name:n.info.name});var i=new I(e.container,{isTemplate:!0});i.render(),i.isLoaded.then(function(){return i.applyTemplate(n,{overwrite:!1}).catch(function(t){e._logger.error('Could not apply template "%s"',t),h.displayNotification({msg:_.replace(_.create.templateApplyError,{name:n.info.name}),eventID:"error"})})}).finally(function(){e._listenToCreateEvents(i)})}}},{id:"edit",text:_.templates.iconBar.edit,fonticon:"pencil",handler:function(){var t=e.templateList.treeList.getDocument().getSelectedNodes();if(1===t.length){var s=t[t.length-1].options.data;e.hide();var n=new I(e.container,{editMode:!0,isTemplate:!0});n.render(),n.isLoaded.then(function(){return n.applyTemplate(s,{overwrite:!0}).catch(function(t){e._logger.error('Could not apply template "%s"',t),h.displayNotification({msg:_.replace(_.create.templateApplyError,{name:s.info.name}),eventID:"error"})})}).finally(function(){e._listenToCreateEvents(n)})}}},{id:"delete",text:_.templates.iconBar.delete,fonticon:"trash",handler:function(){var t=e.templateList.treeList.getDocument().getSelectedNodes(),n=t.some(function(t){return e.utils.isShared(t.options.data)}),r=t.some(function(t){return e.utils.isOwnedBy(t.options.data,e.user)}),a=new p({animate:!0,autocenter:!0,closable:!0,limitParent:!1,overlay:!0,resizable:!0,visible:!0,className:"confirm-delete-template-dialog",title:_.replace(_.templates.confirmDelete.title,{number:t.length}),header:null,body:!0===n&&!0===r?[_.templates.confirmDelete.text,s.createElement("div",{class:"warning-delete-shared-template",html:_.templates.confirmDelete.sharedWarning})]:[_.templates.confirmDelete.text,s.createElement("div",{class:"info-delete-shared-template",html:_.templates.confirmDelete.sharedInfo})],footer:[new i({value:_.templates.confirmDelete.okButton,className:"primary",id:"delete-template-confirm-ok-button",events:{onClick:function(){a.destroy(),e.removeTemplates(t).then(function(){return e.refresh()}).catch(function(){h.displayNotification({msg:_.templates.errors.remove,eventID:"error"})})}}}),new i({value:_.templates.confirmDelete.cancelButton,className:"default",id:"delete-template-confirm-cancel-button",events:{onClick:function(){a.destroy()}}})],events:{onClose:function(){a.destroy()}}}),o=S.get("widget")||window.widget;a.inject(o.body)}},{id:"share",text:_.templates.iconBar.share,fonticon:"share-alt",handler:function(){r.mask(e.elements.dialog.getBody());var t=e.templateList.treeList.getDocument().getSelectedNodes();if(1===t.length){var s=t[t.length-1],n=s.options.data;e.share(n).then(function(t){s.options.data.id=t.id,s.options.data.info.share=t.info.share,s.updateOptions({isShared:!0,grid:{shared:e.utils.getSharedImage().outerHTML}}),e.templateList.container.getElement(".wux-datagrid-cell.wux-layouts-treeview-cell.wux-datagrid-row-highlighted.wux-datagrid-cell-highlighted").dispatchEvent(new MouseEvent("click"))}).finally(function(){r.unmask(e.elements.dialog.getBody())})}}}]}),e.templateList.iconBar.getItem("edit").elements.container.addClassName("disabled"),e.templateList.iconBar.getItem("clone").elements.container.addClassName("disabled"),e.templateList.iconBar.getItem("delete").elements.container.addClassName("disabled"),e.templateList.iconBar.getItem("share").elements.container.addClassName("disabled")),e.templateList.treeListContainer=s.createElement("div",{class:"create-template-chooser-list-tree-list tree-list-empty"}).inject(e.templateList.container),e.templateList.treeListPlaceholder=s.createElement("span",{class:"tree-list-placeholder",html:{tag:"span",class:"fonticon fonticon-5x fonticon-newspaper"}}).inject(e.templateList.treeListContainer);var t=s.clone(e.options.treeList.grid);t.id="templates",t.onDropBlank=function(){return!1},t.onDropCell=function(){return!1},t.onDragStartCell=function(){return!1},t.shouldDisplayTooltip=function(e){var t="";if(e.isHeader)switch(e.dataIndex){case"shared":t=_.templates.treeList.shared;break;default:"string"==typeof e.cellModel.options.value&&(t=e.cellModel.options.value)}else switch(e.dataIndex){case"tree":t=e.nodeModel.options.label;break;case"shared":var s=e.cellModel.options.value;t="string"==typeof s&&""!==s?_.templates.treeList.isShared:_.templates.treeList.isNotShared;break;case"owner":t=e.nodeModel.options.owner;break;case"description":t=e.nodeModel.options.description;break;default:"string"==typeof e.cellModel.options.value&&(t=e.cellModel.options.value)}return{shortHelp:t}},e.templateList.treeList=new v(t),t.columns.forEach(function(e){e.onCellRequest=function(t){var n=t.manager;if(!t.isHeader){var i="tree"===e.dataIndex?"label":e.dataIndex;t.cellView.getContent().setContent(t.nodeModel.options.grid[i]),s.is(t.nodeModel.options.data.info.tenant,"string")&&t.nodeModel.options.data.info.tenant!==T.getTenant()?t.cellView.getContent().hasClassName("disabled-template")||n.addRowClass(t.data.rowID,"disabled-template"):t.cellView.getContent().hasClassName("disabled-template")&&n.removeRowClass(t.data.rowID,"disabled-template")}}}),e.templateList.treeList.inject(e.templateList.treeListContainer),e.templateList.treeList.onNodeClick(function(t){if("shared"===t.dataIndex&&t.nodeModel&&t.nodeModel.options&&!0===t.nodeModel.options.isShared){e._destroyPopover();var n=t.nodeModel.options.data,r=T.get3DDashboardUrl()+x+encodeURIComponent('{"template":{"document":"'+n.info.share.document+'","file":"'+n.info.share.file+'", "envId":"'+n.info.tenant+'"}}'),o=new l({className:"template-url-share",value:r}),c=new i({className:"default template-button-share",icon:"clipboard-add",attributes:{title:_.templates.shared.popover.copy},events:{onClick:function(){E.copyTextToClipboard(r),h.displayNotification({msg:_.templates.notifications.sharedTemplateURL,eventID:"info"})}}});new d({position:"right",target:c.getContent()}),o.elements.input.setAttribute("readonly",!0),o.elements.container.addEventListener("click",function(){o.elements.input.select()});var u=s.createElement("div",{class:"template-body-share",html:[o,c]});e.popover=new a({target:t.cellView.elements.container,position:"top",body:u,title:_.templates.shared.popover.title,events:{onHide:function(){e._destroyPopover()}}}),setTimeout(function(){e.popover.show()},k)}else"owner"===t.dataIndex&&""!=T.getUserImage(t.nodeModel.options.user)&&T.getUserProfile(t.nodeModel.options.user)});var o=e.templateList.treeList.getDocument().getXSO();o.onEmpty(function(){e._destroyPopover(),null!==e.buttons.select&&e.buttons.select.disable(),null!==e.templateList.iconBar&&(e.templateList.iconBar.getItem("edit").elements.container.addClassName("disabled"),e.templateList.iconBar.getItem("clone").elements.container.addClassName("disabled"),e.templateList.iconBar.getItem("delete").elements.container.addClassName("disabled"),e.templateList.iconBar.getItem("share").elements.container.addClassName("disabled"));for(var t=Object.keys(e.templateLastUsed.previews.templates),s=0;s<t.length;s++)e.templateLastUsed.previews.templates[t[s]].removeClassName("active")}),o.onChange(function(){e._destroyPopover();var t=e.templateList.treeList.getDocument().getSelectedNodes();if(1===t.length){if(null!==e.buttons.select&&e.buttons.select.enable(),null!==e.templateList.iconBar){var s=t[t.length-1];e.utils.isShared(s.options.data)&&!e.utils.isOwnedBy(s.options.data,e.user)?e.templateList.iconBar.getItem("edit").elements.container.addClassName("disabled"):e.templateList.iconBar.getItem("edit").elements.container.removeClassName("disabled"),e.templateList.iconBar.getItem("clone").elements.container.removeClassName("disabled"),e.templateList.iconBar.getItem("share").elements.container.removeClassName("disabled")}}else null!==e.buttons.select&&e.buttons.select.disable(),null!==e.templateList.iconBar&&(e.templateList.iconBar.getItem("edit").elements.container.addClassName("disabled"),e.templateList.iconBar.getItem("clone").elements.container.addClassName("disabled"),e.templateList.iconBar.getItem("share").elements.container.addClassName("disabled"));null!==e.templateList.iconBar&&(e.templateList.treeList.getDocument().getSelectedNodes().length>0?e.templateList.iconBar.getItem("delete").elements.container.removeClassName("disabled"):e.templateList.iconBar.getItem("delete").elements.container.addClassName("disabled"));for(var n=Object.keys(e.templateLastUsed.previews.templates),i=e.templateList.treeList.getDocument().getSelectedNodes().reduce(function(e,t){return e.push(t.options.id),e},[]),r=0;r<n.length;r++){var a=e.templateLastUsed.previews.templates[n[r]];i.indexOf(a.id)>-1?a.addClassName("active"):a.removeClassName("active")}}),e.templateLastUsed.container.addEventListener("click",function(){e.templateList.treeList.getDocument().unselectAll();for(var t=Object.keys(e.templateLastUsed.previews.templates),s=0;s<t.length;s++)e.templateLastUsed.previews.templates[t[s]].removeClassName("active")}),e.templateList.treeList.getManager().onNodeDblClick(function(){!1===e.options.editMode&&e.onEndCallback()})},setFooter:function(){var e=this;e.elements.footer=s.createElement("div",{class:"create-template-chooser-footer"});var t=s.createElement("div",{class:"create-template-chooser-footer-btn-container"}).inject(e.elements.footer);if(!1===e.options.editMode){var n=e.buttons.select=new i({value:_.templates.selectButton,id:"create-template-chooser-footer-select-btn",className:"primary"}).inject(t);n.disable(),n.addEvent("onClick",function(){e.onEndCallback()})}(e.buttons.cancel=new i({value:e.options.editMode?_.templates.closeButton:_.templates.cancelButton,id:"create-template-chooser-footer-cancel-btn",className:"default"}).inject(t)).addEvent("onClick",function(){e.elements.dialog.options.events.onClose()})},build:function(){var e=this;!1===e._isRendered&&e.refresh().then(function(){e._isRendered=!0,e._deferred.resolve()}).catch(function(t){e._deferred.reject(t)})},refresh:function(){var t=this;return r.mask(t.elements.body),t.getAndFetchTemplates().then(t=>new e((e,n)=>{var i=[];t.map(e=>{i.push(e.data.responsibleOrganization),i.push(e.data.reportingOrganization)});var r={"ds6w:organizationResponsible":i};w.getNLSValuesPromise(r).then(n=>{s.is(n["ds6w:organizationResponsible"])&&t.map(e=>{s.is(n["ds6w:organizationResponsible"][e.data.responsibleOrganization])&&(e.data.responsibleOrganizationTitle=n["ds6w:organizationResponsible"][e.data.responsibleOrganization]),s.is(n["ds6w:organizationResponsible"][e.data.reportingOrganization])&&(e.data.reportingOrganizationTitle=n["ds6w:organizationResponsible"][e.data.reportingOrganization])}),e(t)}).catch(s=>{console.log(s),e(t)})})).then(function(e){if(t.templateList.treeList.getDocument().empty(),t.templateLastUsed.previews.container.empty(),t.templateLastUsed.previews.templates={},e.length>0){t.templateList.treeList.getDocument().withTransactionUpdate(function(){e.forEach(function(e){var n=t.utils.isShared(e),i="",r="",a="",o="";!0===n?(r=(o=e.info.share.owner).user,a=e.info.share.owner.fullName,i=y.create({users:[o]}).addClassName("template-owner-container").outerHTML):(r=(o=t.userInfo).user=t.userInfo.login,a=o.fullName=T.getFullName(),i=y.create({users:[o]}).addClassName("template-owner-container").outerHTML);var l;l=!0===n?t.utils.getSharedImage().outerHTML:"";var c={id:e.id,label:e.info.name,description:e.info.description,owner:a+" ("+r+")",user:o,isShared:n,grid:{label:s.String.escapeHTML(e.info.name),description:s.String.escapeHTML(e.info.description),owner:i,shared:l},data:e},d=new b(c);t.templateList.treeList.addRoot(d)})}),t.templateList.treeList.getDocument().getRoots().length&&t.templateList.treeListContainer.removeClassName("tree-list-empty");var n=e.filter(function(e){return Number.isInteger(e.info.lastUsed)});if((n=n.sort(function(e,t){return t.info.lastUsed-e.info.lastUsed})).length>0){t.elements.body.removeClassName("hide-last-used");for(var i=0;i<n.length&&i<U;i++){var r=n[i],a=t.createPreview(r).inject(t.templateLastUsed.previews.container);a.addEventListener("click",function(e){e.stopPropagation(),t.templateList.treeList.getDocument().withTransactionUpdate(function(){if(!e.ctrlKey){t.templateList.treeList.getDocument().unselectAll();for(var s=Object.keys(t.templateLastUsed.previews.templates),n=0;n<s.length;n++)t.templateLastUsed.previews.templates[s[n]].removeClassName("active")}for(var i=t.templateList.treeList.getRoots(),r=0;r<i.length;r++)i[r].options.id===e.currentTarget.id&&i[r].select();e.currentTarget.addClassName("active")})}),a.addEventListener("dblclick",function(){t.options.editMode||t.onEndCallback()}),t.templateLastUsed.previews.templates[n[i].id]=a}}else t.elements.body.addClassName("hide-last-used")}else t.templateList.treeListContainer.addClassName("tree-list-empty"),t.templateList.treeListPlaceholder.setContent(_.templates.treeList.placeholder)}).catch(function(e){h.displayNotification({msg:_.templates.errors.get,eventID:"error"})}).finally(function(){r.unmask(t.elements.body)})},getTemplates:function(){var e=this,t=[];return w.preferences.get({data:{name:M}}).then(function(n){if(t=n.body,!Array.isArray(t))return[];for(var i=[],r=0;r<t.length;r++){var a=s.clone(t[r]);s.is(a.info.version,"string")||(a.info.version=""),s.is(a.info.tenant,"string")||(a.info.tenant="OnPremise"),s.is(e.converters[a.info.version],"function")?i.push(e.converters[a.info.version](a)):i.push(a)}return i}).catch(function(t){return e._logger.error("Could not fetch the templates from the preferences: %o",t),[]})},getAndFetchTemplates:function(){var e=this;return e.getTemplates().then(function(t){var n=[],i=[],r={};return t.forEach(function(t){n.push(t.id),r[t.id]=t,!0===e.utils.isShared(t)&&i.push(t)}),e._getSharedTemplates(i).then(function(i){var a=[];n.forEach(function(t){e.utils.isShared(r[t])?s.is(i.map[t],"object")?a.push(i.map[t]):r[t].info.tenant==T.getTenant()&&delete r[t]:a.push(r[t])});for(var o=[],l=0;l<t.length;l++)r[t[l].id]&&o.push(t[l]);return t=o,a=a.filter(function(t){return e.utils.isShared(r[t.id])||t.info.tenant===T.getTenant()}),t.length!==n.length?e.setTemplates(t).then(function(){return a}):a})})},setTemplates:function(e){var t=this;return w.preferences.set({data:{name:M,value:JSON.stringify(e)}}).catch(function(e){t._logger.error("Could not save the preferences: %o",e)})},removeTemplates:function(e){var t=this,s=e.reduce(function(e,t){return e[t.options.data.id]=t.options.data,e},{}),n=e.map(function(e){return e.options.id});return t.getTemplates().then(function(e){for(var i=[],r=[],a=0;a<e.length;a++)-1===n.indexOf(e[a].id)?i.push(e[a]):!0===t.utils.isShared(s[e[a].id])&&t.utils.isOwnedBy(s[e[a].id],t.user)&&(r.push(s[e[a].id].info.share.document),i.push(s[e[a].id]));return t.removeSharedTemplates(r).then(function(){return t.setTemplates(i)})})},removeSharedTemplates:function(t){for(var s=function(t){return new e(function(e){m.deleteDocument(t,{tenantUrl:T.get3DSpaceUrl(),tenant:T.getTenant(),securityContext:decodeURIComponent(T.getSecurityContext()),onComplete:e,onFailure:function(e){if(e&&e.internalError&&e.internalError.includes("1500028")){var t=E.getErrorMessage("11_1");E.displayErrorMessage(t,"error")}else e&&e.error&&h.displayNotification({msg:e.error,eventID:"error"})}})})},n=[],i=0;i<t.length;i++){var r=t[i];n.push(s(r).then(function(e){return{documentId:this.documentId,response:e}}.bind({documentId:r})))}return e.all(n)},onEndCallback:function(){var e=this.templateList.treeList.getDocument().getSelectedNodes(),t=e[e.length-1].options.data;this.onEnd(t),this.elements.dialog.destroy(),this.destroy()},createPreview:function(e){var t=s.createElement("div",{class:"card create-template-chooser-preview",id:e.id});s.is(e.info.tenant,"string")&&e.info.tenant!==T.getTenant()&&t.addClassName("disabled-template"),s.createElement("div",{class:"card-block create-template-chooser-preview-name",html:s.String.escapeHTML(e.info.name),title:E.getTextFromHTML(e.info.name)}).inject(t);var n=s.createElement("div",{class:"card-block create-template-chooser-preview-details"}).inject(t),i="";switch(e.data.priority){case O:i="low wux-ui-3ds wux-ui-3ds-level-low";break;case N:i="medium wux-ui-3ds wux-ui-3ds-level-medium";break;case L:i="high wux-ui-3ds wux-ui-3ds-level-high";break;case R:i="urgent wux-ui-3ds wux-ui-3ds-alert "}s.createElement("div",{class:"create-template-chooser-preview-priority",html:[s.createElement("span",{class:"issue-list-priority-icon "+i,title:_.priorities[e.data.priority.toLowerCase()]}),_.priorities[e.data.priority.toLowerCase()]]}).inject(n);var r=s.createElement("div",{class:"create-template-chooser-preview-reported-against"}).inject(n);s.createElement("span",{class:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-library-class",title:_.create.properties.labels.classification}).inject(r);var a=s.createElement("span",{class:"preview-reported-against-title"}).inject(r),o=e.data.classification;if(o&&o.length>0){var l="";o.forEach(function(e){var t=e[0].classPath;l+=t+"\n"}),a.title=l,a.innerHTML=o.length+" "+_.templates.preview.objectCount}else a.innerHTML=_.templates.preview.noObject,a.addClassName("no-object");var c=s.createElement("div",{class:"create-template-chooser-preview-reported-against"}).inject(n);s.createElement("span",{class:"preview-reported-against-icon wux-ui-3ds wux-ui-3ds-location",title:_.create.related.labels.reportedAgainst}).inject(c);var d=s.createElement("span",{class:"preview-reported-against-title"}).inject(c);e.data.reportedAgainst.length>0?this._fetchAndInject(e.data.reportedAgainst,d):(d.innerHTML=_.templates.preview.noObject,d.addClassName("no-object"));var u=s.createElement("div",{class:"create-template-chooser-preview-contexts"}).inject(n);s.createElement("span",{class:"preview-contexts-icon wux-ui-3ds wux-ui-3ds-3d-object",title:_.create.related.labels.contexts}).inject(u);var m=s.createElement("span",{class:"preview-contexts-title"}).inject(u);e.data.contexts.length>0?this._fetchAndInject(e.data.contexts,m):(m.innerHTML=_.templates.preview.noObject,m.addClassName("no-object"));var p=s.createElement("div",{class:"create-template-chooser-preview-responsible-organization"}).inject(n);s.createElement("span",{class:"preview-responsible-organization-icon fonticon fonticon-users",title:_.create.team.labels.responsibleOrganization}).inject(p);var f=s.createElement("span",{class:"preview-responsible-organization-title"}).inject(p);"string"==typeof e.data.responsibleOrganization&&(f.title=s.is(e.data.responsibleOrganizationTitle)?e.data.responsibleOrganizationTitle:e.data.responsibleOrganization,f.innerHTML=s.is(e.data.responsibleOrganizationTitle)?e.data.responsibleOrganizationTitle:e.data.responsibleOrganization);var h=s.createElement("div",{class:"create-template-chooser-preview-users"}).inject(n),g=!1;if(e.data.assignees.forEach(function(t,n){T.getUserImage(t.user);var i=e.ui.assignees[t.user];n>2?g=!0:"group"===i.type?s.createElement("div",{class:"user-group wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-users-group",title:i.fullName}).inject(h):T.getUserImageElement(i,!0,{cssClass:"preview-users-img",Title:i.fullName+" ("+i.user+")"}).inject(h)}),!0===g){l="";e.data.assignees.forEach(function(t){var s=e.ui.assignees[t.user];"group"===s.type?l+=s.fullName+"\n":l+=s.fullName+" ("+s.user+")\n"}),s.createElement("div",{class:"preview-users-ellipsis",html:"...",title:l}).inject(h)}return t},share:function(t){var s=this,n=null,i=null;if(!0===s.utils.isShared(t))return e.resolve(t);Number.isInteger(t.info.lastUsed)&&(i=t.info.lastUsed,t.info.lastUsed=null);var r=JSON.stringify(t),a=new Blob([r],{type:"application/json"});return new e(function(e,s){var n=_.templates.shared.description+" \n "+t.info.name+" ( "+t.info.description+")";m.createDocument({title:_.replace(_.templates.shared.title,{owner:T.getFullName()}),description:n,fileInfo:{file:new File([a],_.replace(_.templates.shared.title,{owner:T.getFullName()})+".json")}},{tenantUrl:T.get3DSpaceUrl(),tenant:T.getTenant(),securityContext:decodeURIComponent(T.getSecurityContext()),onComplete:function(n){try{var r=n.data[P].id,a=n.data[P].relateddata.files[P].id;e({id:t.id,info:{share:{document:r,file:a},lastUsed:i,tenant:t.info.tenant}})}catch(e){s(new Error("Error during the document creation "+n+e))}},onFailure:function(e){if(e&&e.internalError&&e.internalError.includes("1500028")){var t=E.getErrorMessage("11");E.displayErrorMessage(t,"error")}else e&&e.error&&h.displayNotification({msg:e.error,eventID:"error"});s(new Error("Error during the document creation "+e))}})}).then(function(e){return n=e,s.getTemplates().then(function(s){for(var n=[],i=0;i<s.length;i++)t.id===s[i].id?n.push(e):n.push(s[i]);return n})}).then(function(e){return s.setTemplates(e)}).then(function(){var e,t;return e=n.info.share,t=T.get3DDashboardUrl()+x+encodeURIComponent('{"template":{"document":"'+e.document+'","file":"'+e.file+'"}}'),E.copyTextToClipboard(t),h.displayNotification({msg:_.templates.notifications.sharedSuccess,eventID:"success"}),n.info.share.owner={user:s.user},n})},addSharedTemplateToPreferences:function(e){var t=this,s={id:e.document+"-"+e.file,info:{share:{document:e.document,file:e.file},lastUsed:null}};return t._getSharedTemplates([s]).then(function(e){return Array.isArray(e.array)&&0!==e.array.length?e:(h.displayNotification({msg:_.templates.notifications.sharedTemplateNotValid,eventID:"warning"}),{array:[],map:{}})}).then(function(n){return n&&!Array.isArray(n.array)||0===n.array.length?[]:t.getTemplates().then(function(n){for(var i=0;i<n.length;i++)if(t.utils.isShared(n[i])&&n[i].info.share.document===e.document)return h.displayNotification({msg:_.templates.notifications.sharedTemplateAlreadyAdded,eventID:"info"}),[];return n.push(s),n})}).then(function(e){return Array.isArray(e)&&0!==e.length?t.setTemplates(e).then(function(){h.displayNotification({msg:_.templates.notifications.sharedTemplateAdded,eventID:"success"})}):[]})},updateSharedTemplate:function(t){if(!1===this.utils.isShared(t))return e.reject(new Error("This template is not a shared template"));if(this.utils.isShared(t)&&!this.utils.isOwnedBy(t,this.user))return e.reject(new Error("You do not owned this shared template"));var n=s.clone(t),i=n.info.share.document,r=n.info.share.file,a=null;Number.isInteger(n.info.lastUsed)&&(a=n.info.lastUsed,n.info.lastUsed=null),delete n.info.share;var o=JSON.stringify(n),l=new Blob([o],{type:"application/json"});return new e(function(e,t){m.modifyDocument({id:i,fileInfo:{id:r,file:new File([l],_.replace(_.templates.shared.title,{owner:T.getFullName()})+".json")}},{tenantUrl:T.get3DSpaceUrl(),tenant:T.getTenant(),securityContext:decodeURIComponent(T.getSecurityContext()),onComplete:function(s){try{e({id:n.id,info:{share:{document:i,file:s.data[P].relateddata.files[P].id},lastUsed:a}})}catch(e){t(new Error("Error during the document creation "+s+e))}},onFailure:function(e){t(new Error("Error during the document creation "+e))}})})},_getSharedTemplates:function(t){var n=this,i=s.clone(t),r={array:[],map:{}};return 0===i.length?e.resolve(r):new e(function(e,t){var r=i.reduce(function(e,t){return e.push(t.info.share.document),e},[]),a=i.reduce(function(e,t){return e[t.info.share.document]=t,e},{});m.getDocuments(r,{tenantUrl:T.get3DSpaceUrl(),tenant:T.getTenant(),securityContext:decodeURIComponent(T.getSecurityContext()),onComplete:function(o){o&&Array.isArray(o.data)||t(new Error("Could not fetch the documents "+o));var l=[],c=[];o.data.forEach(function(e){var t=n.utils.getFileInfo(o,e.id);t&&t.id&&(c.push(e.id),a[e.id].info.share.file=t.id,l.push(t))});var d=[],u=[];s.clone(r).forEach(function(e){c.indexOf(e)>-1?(u.push(a[e].info.share.document),d.push(a[e].info.share.file)):delete a[e]});for(var m=[],p=0;p<i.length;p++)a[i[p].info.share.document]&&m.push(i[p]);i=m,e({documents:u,files:d,results:l})},onFailure:function(e){t(new Error("Could not fetch the documents "+e))}})}).then(function(a){return 0===i.length?e.resolve(r):(t.length,i.length,new e(function(t){m.downloadDocuments(a.files,{tenantUrl:T.get3DSpaceUrl(),tenant:T.getTenant(),securityContext:decodeURIComponent(T.getSecurityContext()),onComplete:function(o){var l=[];o.forEach(function(e){l.push(n.utils.getContentFromURL(e.id,e.downloadUrl))}),e.all(l).then(function(e){var o=e.reduce(function(e,t){return e.push(t.id),e},[]);s.clone(a.files).forEach(function(t,l){var c=o.indexOf(t);if(-1===c)i.splice(l,1),a.documents.splice(l,1),a.files.splice(l,1);else{var d=s.clone(e[c]),u=d.content.info.version;s.is(u,"string")||(u=d.content.info.version=""),s.is(n.converters[u],"function")&&(d.content=n.converters[u](d.content));var m=s.clone(d.content);m.id=i[l].id,m.info.lastUsed=i[l].info.lastUsed,m.info.share={document:a.documents[c],file:a.files[c],owner:a.results[c].owner},r.array.push(m),r.map[m.id]=m}}),t()},function(e){n._logger.error('The downloaded document is not valid "%s"',e),t()})},onFailure:function(e){n._logger.error('The download call failed "%s"',e),t()}})}))},function(t){return e.resolve(r)}).then(function(){return r})},_setParseAttributes:function(e){this.parsed={icons:[],id:null,title:null,type:null,name:null,revision:null};var t=D.parseFetchResponse(e);this.parsed.icons.push(t.display.typeIcon),this.parsed.title=t.display.title,this.parsed.type=t.display.type,this.parsed.name=t.display.name,this.parsed.revision=t.display.revision},_fetchAndInject:function(e,t){var s=this;w.fetch({data:{objects:e.map(function(e){return{physicalId:e.physicalId}})},onComplete:function(n){var i=n.body;if("results"in i)if(1===e.length){var r=i.results[i.results.length-1];s._setParseAttributes(r),t.title=s.parsed.title+" ("+s.parsed.name+" - "+s.parsed.type+" - "+s.parsed.revision+")",t.innerHTML=s.parsed.title}else if(e.length>1){for(var a="",o={},l=0;l<i.results.length;l++){var c=D.parseFetchResponse(i.results[l]);o[c.value.id]=c}e.forEach(function(e){var s=o[e.physicalId];a+=s.display.title+" ("+s.display.name+" - "+s.display.type+" - "+s.display.revision+")\n",t.title=a}),t.innerHTML=e.length+" "+_.templates.preview.objectCount}},onFailure:function(){}})},_listenToCreateEvents:function(e){var t=this;t.listenTo(e,"onTemplateCreate",function(){t.refresh()}),t.listenTo(e,"onCreateDialogClose",function(){t.show()})},show:function(){this.elements.dialog.show(),this._closeCallbackEnabled=!0},hide:function(){this._closeCallbackEnabled=!1,this.elements.dialog.hide()},_destroyPopover:function(){if(null!==this.popover){try{this.popover.destroy()}catch(e){}this.popover=null}},converters:{"":function(e){var t=s.clone(e);if(f.getLogger("DS/IssueComponents/templates/Templates").info("Converting a template prior to 19x FD03"),!0===s.is(t.info.share,"object"))return e;var n=[],i=[],r=[],a={};(t.data.assignees&&Array.isArray(t.data.assignees.add)&&(t.data.assignees.add.forEach(function(e){n.push({user:e})}),t.data.assignees=n),t.data.reportedAgainst&&Array.isArray(t.data.reportedAgainst.add)&&(t.data.reportedAgainst.add.forEach(function(e){i.push({physicalId:e})}),t.data.reportedAgainst=i),Array.isArray(t.data.positions)&&(t.data.positions.forEach(function(e){for(var s=0;s<t.data.reportedAgainst.length;s++)t.data.reportedAgainst[s].physicalId===e.id&&(t.data.reportedAgainst[s].position=e.coordinates)}),delete t.data.positions),s.is(t.data.context,"string")&&(t.data.context.length>0&&r.push({physicalId:t.data.context}),t.data.contexts=r,delete t.data.context),t.ui&&t.ui.assignees&&s.is(t.ui.assignees.add,"object"))&&(Object.keys(t.ui.assignees.add).forEach(function(e){a[e]=t.ui.assignees.add[e]}),delete t.ui.assignees.add,t.ui.assignees=a);var o={id:t.id,info:t.info,data:t.data,ui:t.ui};return this["19x FD03"](o)},"19x FD03":function(e){var t=s.clone(e);return f.getLogger("DS/IssueComponents/templates/Templates").info("Converting a template from 19x FD03"),!0===s.is(t.info.share,"object")?e:(Array.isArray(t.data.coOwners)||(t.data.coOwners=[]),s.is(t.ui.coOwners,"object")||(t.ui.coOwners={}),{id:t.id,info:t.info,data:t.data,ui:t.ui})}},utils:{isShared:function(e){return!0===s.is(e.info.share,"object")},isOwnedBy:function(e,t){return!0===this.isShared(e)&&e.info.share.owner&&e.info.share.owner.user===t},getFileInfo:function(e,t){var s={};try{e.data.forEach(function(e){if(e.id===t&&e.relateddata.files&&1===e.relateddata.files.length){var n=e.relateddata.ownerInfo[e.relateddata.ownerInfo.length-1].dataelements;s.id=e.relateddata.files[e.relateddata.files.length-1].id,s.owner={lastName:n.lastname,firstName:n.firstname,fullName:n.firstname+" "+n.lastname,user:n.name}}})}catch(e){}return s},getContentFromURL:function(t,s){var n=this,i=new XMLHttpRequest;return new e(function(e,r){i.open("GET",s,!0),i.responseType="blob",i.onload=function(){var s=new FileReader;s.readAsDataURL(i.response),s.onload=function(s){try{e({id:t,content:JSON.parse(n.base64.decode(s.target.result.split(",").pop()))})}catch(e){r(new Error("The shared template from the URL is not a JSON "+e))}}},i.onerror=function(){r(new Error("Could not read the shared template from the URL "+s))},i.send()})},getUserImage:function(e){var t=s.createElement("div",{class:"template-owner-container"});return T.getUserImageElement(e,!1,{cssClass:"template-owner-img",Title:e.fullName+" ("+e.user+")"}).inject(t),t},getSharedImage:function(){var e=s.createElement("div",{class:"template-shared-container"});return s.createElement("span",{class:"wux-button-icon-fi wux-ui-3ds wux-ui-3ds-users wux-ui-3ds-lg"}).inject(e),e},base64:{decode:function(e){return decodeURIComponent(Array.prototype.map.call(atob(e),function(e){return"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)}).join(""))}}}})});