define("DS/XCT3DPlayIntegratability/CRC_32",["UWA/Class"],function(e){"use strict";return e.extend({init:function(){},crc32_generate:function(e){var t,i,a,r=[];for(t=0;t<256;t++){for(a=t,i=8;i>0;i--)1==(1&a)?a=a>>>1^e:a>>>=1;r[t]=a}return r},crc32_initial:function(){return 4294967295},crc32_add_byte:function(e,t,i){return t=t>>>8^e[i^255&t]},crc32_final:function(e){return e=(e=~e)<0?4294967295+e+1:e},crc32_compute_string:function(e,t){var i,a=this.crc32_generate(e),r=0;for(r=this.crc32_initial(),i=0;i<t.length;i++)r=this.crc32_add_byte(a,r,t.charCodeAt(i));return r=this.crc32_final(r)},crc32_compute_buffer:function(e,t){var i,a=new DataView(t),r=this.crc32_generate(e),s=0;for(s=this.crc32_initial(),i=0;i<a.byteLength;i++);return s=this.crc32_add_byte(r,s,a.getUint8(i)),s=this.crc32_final(s)},crc32_reverse:function(e){var t,i=0;for(t=0;t<32;t++)i<<=1,i|=e>>>t&1;return i},calcCRC:function(e){return this.crc32_compute_string(3988292384,e)}})}),define("DS/XCT3DPlayIntegratability/XCTStandalonePlayerAPI",["UWA/Core","UWA/Class","DS/Selection/HSOManager","DS/Selection/PSOManager","DS/WebUtils/ContextedSingleton","DS/WebappsUtils/Utils","DS/WebSystem/BrowserInfos","DS/WebSystem/MemoryInfo","DS/XCTInfNotifications/XCTInfNotifications","i18n!DS/XCT3DPlayIntegratability/assets/nls/XCT3DPlayIntegratability"],function(e,t,i,a,r,s,n,o,g,l){"use strict";return t.extend({init:function(e,t,i){this._player3DPlay=e.args.options.helper||r.get(e.args.ctx,"helper"),this._player=e.player,this._ID=e.args.input.ID,this._playOptions=e.args.input.playOptions,this._multiViewer=!e.args.visu||e.args.visu.multiViewer,this._experienceName=t,this._type="",this._ready=!1,this._mediaInspector=i,this._downSampling=void 0,this._actorsAssetsList=null,this._materialsAssetsList=null,this._environmentsAssetsList=null,this._resourcesAssetsList=null,this._onExperienceReadyListener=this._onExperienceReady.bind(this),window.document.addEventListener("ExperienceReady",this._onExperienceReadyListener,!1),this._onMessageListener=this._onMessage.bind(this),window.addEventListener("message",this._onMessageListener,!1)},_getExperienceBase:function(){return this._experienceBase},_onExperienceReady:function(e){var t;if(e.detail.experienceLoaded&&(e.detail.experienceLoaded.args?t=e.detail.experienceLoaded.args.input.ID:(t=e.detail.experienceLoaded._experienceBase.webApplication.args.input.ID,this._experienceBase=e.detail.experienceLoaded._experienceBase),t===this._ID)){this._type=e.detail.type,this._ready=!0,"3D"===this._type&&this._setVisuDefaultOptions(),"2.5D"===this._type&&this._set25DDefaultUI();var i={type:this._type,canvasId:this._getCanvasID()};this._trigger("ExperienceReady",i)}},_trigger(e,t){var i={protocol:"ExperienceCommunication",playerID:this._ID,action:e,params:t};window.parent.postMessage(i,"*")},_onMessage(e){if(this._ready&&e&&e.data&&"ExperienceCommunication"===e.data.protocol){if(this._ID!==e.data.playerID)return;if(e.data){var t=e.data.action,i=e.data.params;"load"===t?this._load(i.path,i.options):"play"===t?this._play():"pause"===t?this._pause():"stop"===t?this._stop():"play25DVariant"===t?this._play25DVariant(i.index):"get25DVariants"===t?this._get25DVariants():"get25DVariantsNumber"===t?this._get25DVariantsNumber():"showImmersiveHelp"===t?this._showImmersiveHelp(i.show):"showVariantGUI"===t?this._showVariantGUI(i.show):"playAct"===t?this._playActByName(i.name):"getActs"===t?this._getActs():"getActsNumber"===t?this._getActsNumber():"playScene"===t?this._playSceneByName(i.name):"getScenes"===t?this._getScenes():"getScenesNumber"===t?this._getScenesNumber():"getActsFromScene"===t?this._getActsFromScene(i.name):"playActOfScene"===t?this._playActOfScene(i.sceneName,i.actName):"playPermanentAct"===t?this._playPermanentActByName(i.name):"getPermanentActs"===t?this._getPermanentActs():"getPermanentActsNumber"===t?this._getPermanentActsNumber():"highlight"===t?this._highlight(i.id,i.mode,i.reset):"show"===t?this._show(i.id,i.mode):"getActorInfos"===t?this._getActorInfos(i.id,i.type):"showFPS"===t?this._showFPS(i.show):"showVisuDebugInfos"===t?this._showVisuDebugInfos(i.show):"setTransparentBackground"===t?this._setTransparentBackground(i.transparentBackground):"setVisuOptionsPreset"===t?this._setVisuOptionsPreset(i.preset):"setVisuOptionsAdvanced"===t?this._setVisuOptionsAdvanced(i.options):"setAntiAliasing"===t?this._setAntiAliasing(i.aa,i.mode):"setFlakesQuality"===t?this._setFlakesQuality(i.quality,i.mode):"setOIT"===t?this._setOIT(i.oit,i.mode):"setSSAO"===t?this._setSSAO(i.ssao,i.mode):"setShadow"===t?this._setShadow(i.shadow,i.mode):"setMirror"===t?this._setMirror(i.mirror,i.mode):"setGroundShadow"===t?this._setGroundShadow(i.groundShadow,i.mode):"setBloom"===t?this._setBloom(i.bloom,i.mode):"setTriLights"===t?this._setTriLights(i.triLights,i.mode):"setLightParameters"===t?this._setLightParameters(i.intensity,i.lightIndex,i.color):"setDirectionalLight"===t?this._setDirectionalLight(i.latitude,i.longitude,i.color,i.intensity):"setAmbientLight"===t?this._setAmbientLight(i.color):"setPixelCulling"===t?this._setPixelCulling(i.pixelCulling,i.mode):"setRoughnessMap"===t?this._setRoughnessMap(i.path):"getInfos"===t?this._getInfos(i.infos):"getConsoleMessages"===t&&this._getConsoleMessages()}}},_getCanvasID:function(){if(this._player&&this._getExperienceBase()){var e=this._getExperienceBase().getManager("CAT3DXVisuManager");if(e&&e.getViewer()&&e.getViewer().canvas)return e.getViewer().canvas.id}return"canvasNotFound"},_showFPS:function(e){if(this._player&&this._getExperienceBase()){var t=this._getExperienceBase().getManager("CAT3DXVisuManager");t&&t.getViewer().setDebugFPS(e,60)}},_showVisuDebugInfos:function(e){if(this._player&&this._getExperienceBase()){var t=this._getExperienceBase().getManager("CAT3DXVisuManager");t&&(t.getViewer().showInfos(e,986895),t.getViewer().showNodeCounter(e,986895),t.getViewer().showPerfo(e,!0,0,null,!1))}},_setVisuDefaultOptions:function(){if(this._player&&this._getExperienceBase()){var e=this._getExperienceBase().getManager("CAT3DXVisuManager");if(e){e.getViewer().setMaterialMode(!0),e.getViewer().setRenderMode("@Edge",!1),e.getViewer().setRenderMode("@Point",!1),e.getViewer().setRenderMode("@InternalEdge",!1),e.getViewer().setGrid(!1),e.getViewer().displayInfinitePlane(!1),e.getViewer().setAntiAliasing("MSAA","static");let t=e.getViewer().currentViewpoint;t&&t.setPixelCulling(0),e.getViewer().setManipulators({preActivate:!1}),e.getViewer().setSmallRenderTargetPicking(!0),this._downSampling=Math.min(1,1/window.devicePixelRatio),e.getViewer().setDownsamplingFactor(this._downSampling),this._playOptions&&this._playOptions.visuOptionsPreset&&("Low"!==this._playOptions.visuOptionsPreset&&"Medium"!==this._playOptions.visuOptionsPreset&&"High"!==this._playOptions.visuOptionsPreset||this._setVisuOptionsPreset(this._playOptions.visuOptionsPreset))}}},_set25DDefaultUI:function(){this._playOptions&&!1===this._playOptions.showImmersiveHelp&&this._showImmersiveHelp(!1),this._playOptions&&!1===this._playOptions.showVariantGUI&&this._showVariantGUI(!1)},_setVisuDefaultLights:function(){if(this._player&&this._getExperienceBase()){var e=this._getExperienceBase().getManager("CAT3DXVisuManager");e&&(e.getViewer().setAmbientLight(12632256),e.getViewer().setTriLights(!0),e.getViewer().setDirectionalLight(.3,.6,16777215,2))}},_load:function(e,t){var i="";if(e.asset&&e.asset.format)i=e.asset.format;else{i=/(?:\.([^.]+))?$/.exec(e)[1]}i&&(i=i.toLowerCase()),"dsxm"===i||"dsxmb"===i?this._player&&this._player3DPlay&&this._player3DPlay.loadAsset(e,t):g.showError(l.error_format_not_supported)},_play:function(){if(this._player&&this._getExperienceBase()){var e=this._getExperienceBase().getManager("APIPlayerManager");if(e){var t=this;e.play().done(function(){t._trigger("onPlay")})}}},_pause:function(){if(this._player&&this._getExperienceBase()){var e=this._getExperienceBase().getManager("APIPlayerManager");if(e){var t=this;e.pause().done(function(){t._trigger("onPause")})}}},_stop:function(){if(this._player&&this._getExperienceBase()){var e=this._getExperienceBase().getManager("APIPlayerManager");if(e){var t=this;e.stop().done(function(){t._trigger("onStop")})}}},_get25DVariants:function(){if(this._player&&this._player.api){for(var e=this._player.api.getVariants(),t=[],i=0;i<e.length;i++)t.push(e[i].name);var a={variants:t};this._trigger("onGet25DVariants",a)}},_get25DVariantsNumber:function(){if(this._player&&this._player.api){var e={number:this._player.api.getVariants().length};this._trigger("onGet25DVariantsNumber",e)}},_play25DVariant:function(e){this._player&&this._player.api&&this._player.api.setVariant(e)},_showImmersiveHelp:function(e){this._player&&this._player.api&&this._player.api.setImmersiveHelpVisibility(e)},_showVariantGUI:function(e){this._player&&this._player.api&&this._player.api.setVariantGUIVisibility(e)},_getActs:function(){if(this._player&&this._getExperienceBase()){var e=this._getExperienceBase().getManager("APIPlayerManager");if(e){var t={acts:e.getActs()};this._trigger("onGetActs",t)}}},_getActsNumber:function(){if(this._player&&this._getExperienceBase()){var e=this._getExperienceBase().getManager("APIPlayerManager");if(e){var t=e.getActs();if(t){var i={number:t.length};this._trigger("onGetActsNumber",i)}}}},_playActByName:function(e){if(this._player&&this._getExperienceBase()){var t=this._getExperienceBase().getManager("APIPlayerManager");t&&t.playAct(e)}},_getScenes:function(){if(this._player&&this._getExperienceBase()){var e=this._getExperienceBase().getManager("APIPlayerManager");if(e){var t={scenes:e.getScenes()};this._trigger("onGetScenes",t)}}},_getScenesNumber:function(){if(this._player&&this._getExperienceBase()){var e=this._getExperienceBase().getManager("APIPlayerManager");if(e){var t=e.getScenes();if(t){var i={number:t.length};this._trigger("onGetScenesNumber",i)}}}},_playSceneByName:function(e){if(this._player&&this._getExperienceBase()){var t=this._getExperienceBase().getManager("APIPlayerManager");t&&t.playScene(e)}},_getActsFromScene:function(e){if(this._player&&this._getExperienceBase()){var t=this._getExperienceBase().getManager("APIPlayerManager");if(t){var i={acts:t.getActsFromScene(e)};this._trigger("onGetActsFromScene"+e,i)}}},_playActOfScene:function(e,t){if(this._player&&this._getExperienceBase()){var i=this._getExperienceBase().getManager("APIPlayerManager");if(i){if(i.getCurrentScene()!==e&&(i.playScene(e),i.getCurrentActFromCurrentScene()===t))return;i.playActFromCurrentScene(t)}}},_getPermanentActs:function(){if(this._player&&this._getExperienceBase()){var e=this._getExperienceBase().getManager("APIPlayerManager");if(e){var t={acts:e.getPermanentActs()};this._trigger("onGetPermanentActs",t)}}},_getPermanentActsNumber:function(){if(this._player&&this._getExperienceBase()){var e=this._getExperienceBase().getManager("APIPlayerManager");if(e){var t=e.getPermanentActs();if(t){var i={number:t.length};this._trigger("onGetPermanentActsNumber",i)}}}},_playPermanentActByName:function(e){if(this._player&&this._getExperienceBase()){var t=this._getExperienceBase().getManager("APIPlayerManager");t&&t.playPermanentAct(e)}},_setTransparentBackground:function(e){if(this._player&&this._getExperienceBase()){var t=this._getExperienceBase().getManager("CAT3DXVisuManager");t&&(e?(this.previousVisu=this.previousVisu||{},this.previousVisu.transparentBk={},this.previousVisu.transparentBk.ambienceActivated=t.getViewer().ambience.getBackground().isActivated(),this.previousVisu.transparentBk.grid=t.getViewer().getGrid(),this.previousVisu.transparentBk.color=t.getViewer().bgColor,this.previousVisu.transparentBk.alpha=t.getViewer().bgAlpha,t.getViewer().ambience.getBackground().setActivated(!1),t.getViewer().setGrid(!1),t.getViewer().setBackgroundColor("rgb(0,0,0)","0")):this.previousVisu&&this.previousVisu.transparentBk&&(t.getViewer().ambience.getBackground().setActivated(this.previousVisu.transparentBk.ambienceActivated),t.getViewer().setGrid(this.previousVisu.transparentBk.grid),t.getViewer().setBackgroundColor(this.previousVisu.transparentBk.color,this.previousVisu.transparentBk.alpha)))}},_setVisuOptionsPreset:function(e){if(this._player&&this._getExperienceBase()){var t=this._getExperienceBase().getManager("CAT3DXVisuManager");t&&("Low"===e?(t.getViewer().setAntiAliasing("FXAA","dynamic"),t.getViewer().setSSAO(!1),t.getViewer().setShadowQuality("Low"),t.getViewer().setShadow(!1)):"Medium"===e?(t.getViewer().setAntiAliasing("SSAA","dynamic"),t.getViewer().setSSAO(!0),t.getViewer().setShadow(!0),t.getViewer().setShadowQuality("Medium")):"High"===e&&(t.getViewer().setAntiAliasing("SSAA","dynamic"),t.getViewer().setSSAO(!0),t.getViewer().setShadow(!0),t.getViewer().setShadowQuality("High")),t.getViewer().render())}},_setVisuOptionsAdvanced:function(t){var i,a;if(this._player&&this._getExperienceBase()&&(!0===t.lights&&this._setVisuDefaultLights(),void 0!==t.useShadowMap&&(i=this._getExperienceBase().getManager("CAT3DXVisuManager"))&&(i.getViewer().useShadowMap=t.useShadowMap),void 0!==t.grid&&(i=this._getExperienceBase().getManager("CAT3DXVisuManager"))&&i.getViewer().setGrid(t.grid),void 0!==t.ground&&(i=this._getExperienceBase().getManager("CAT3DXVisuManager"))&&i.getViewer().displayInfinitePlane(t.ground),void 0!==t.downsamplingFactor&&(i=this._getExperienceBase().getManager("CAT3DXVisuManager"))&&(this._downSampling=t.downsamplingFactor,i.getViewer().setDownsamplingFactor(this._downSampling)),void 0!==t.ambiance&&(i=this._getExperienceBase().getManager("CAT3DXVisuManager"))&&(!1===t.ambiance?i.getViewer().removeAmbience():i.getViewer().restoreAmbiance()),void 0!==t.renderMode&&(i=this._getExperienceBase().getManager("CAT3DXVisuManager"))&&(i.getViewer().setVisuShadingMode(t.renderMode),i.getViewer().render()),void 0!==t.backFaceCulling&&(i=this._getExperienceBase().getManager("CAT3DXVisuManager"))&&(i.getViewer().setDisableBackFaceCulling(!t.backFaceCulling),i.getViewer().render()),void 0!==t.ssr&&(i=this._getExperienceBase().getManager("CAT3DXVisuManager"))&&(i.getViewer().setSSLR(t.ssr),i.getViewer().render()),t.rotatePerfos&&(i=this._getExperienceBase().getManager("CAT3DXVisuManager"))&&(a=i.getViewer().currentViewpoint)&&a.rotateCameraForPerfos(3,1e4,!1),t.zoomPerfos&&(i=this._getExperienceBase().getManager("CAT3DXVisuManager"))&&(a=i.getViewer().currentViewpoint)&&a.zoomCameraInAndOutForPerfos(1e4,!1),t.screenCapture&&(i=this._getExperienceBase().getManager("CAT3DXVisuManager")))){let t=i.getViewer(),a=t.SCREEN_WIDTH,h=t.SCREEN_HEIGHT,p={data:null,width:a,height:h};t.renderToTarget(p,t.currentViewpoint,!1,{AntiAliasing:"MSAA",IterativeSSAO:!0,NbIterations:32});let d=e.createElement("canvas");d.width=a,d.height=h;var r=d.getContext("2d");let u=r.createImageData(a,h);for(var s=u.data,n=4*a,o=0;o<h;o++)for(var g=o*a*4,l=(h-1-o)*a*4,c=n;c--;)s[g+c]=p.data[l+c];r.putImageData(u,0,0),d.toBlob(function(e){let t=window.URL.createObjectURL(e),i=document.createElement("a");document.body.appendChild(i),i.style="display: none",i.href=t,i.download="myCapture",i.click(),setTimeout(()=>{document.body.removeChild(i),window.URL.revokeObjectURL(t)},100)},"image/webp")}},_setAntiAliasing:function(e,t){if(this._player&&this._getExperienceBase()){var i=this._getExperienceBase().getManager("CAT3DXVisuManager");i&&(i.getViewer().setAntiAliasing(e,t),i.getViewer().render())}},_setFlakesQuality:function(e,t){if(this._player&&this._getExperienceBase()){var i=this._getExperienceBase().getManager("CAT3DXVisuManager");i&&(i.getViewer().setFlakesQuality(e,t),i.getViewer().render())}},_setOIT:function(e,t){if(this._player&&this._getExperienceBase()){var i=this._getExperienceBase().getManager("CAT3DXVisuManager");i&&(i.getViewer().setOIT(e,t),i.getViewer().render())}},_setSSAO:function(e,t){if(this._player&&this._getExperienceBase()){var i=this._getExperienceBase().getManager("CAT3DXVisuManager");i&&(i.getViewer().setSSAO(e,t),i.getViewer().render())}},_setShadow:function(e,t){if(this._player&&this._getExperienceBase()){var i=this._getExperienceBase().getManager("CAT3DXVisuManager");i&&(i.getViewer().setShadow(e,t),i.getViewer().render())}},_setMirror:function(e,t){if(this._player&&this._getExperienceBase()){var i=this._getExperienceBase().getManager("CAT3DXVisuManager");i&&(i.getViewer().setMirror(e,t),i.getViewer().render())}},_setGroundShadow:function(e,t){if(this._player&&this._getExperienceBase()){var i=this._getExperienceBase().getManager("CAT3DXVisuManager");i&&(i.getViewer().setGroundShadow(e,t),i.getViewer().render())}},_setBloom:function(e,t){if(this._player&&this._getExperienceBase()){var i=this._getExperienceBase().getManager("CAT3DXVisuManager");i&&(i.getViewer().setBloom(e,t),i.getViewer().render())}},_setTriLights(e){if(this._player&&this._getExperienceBase()){var t=this._getExperienceBase().getManager("CAT3DXVisuManager");t&&(t.getViewer().setTriLights(e),t.getViewer().render())}},_setLightParameters(e,t,i){if(this._player&&this._getExperienceBase()){var a=this._getExperienceBase().getManager("CAT3DXVisuManager");if(a){var r={intensity:e,lightIndex:t,color:i};a.getViewer().setLightParameters(r),a.getViewer().render()}}},_setDirectionalLight(e,t,i,a){if(this._player&&this._getExperienceBase()){var r=this._getExperienceBase().getManager("CAT3DXVisuManager");r&&(r.getViewer().setDirectionalLight(e,t,i,a),r.getViewer().render())}},_setAmbientLight(e){if(this._player&&this._getExperienceBase()){var t=this._getExperienceBase().getManager("CAT3DXVisuManager");t&&(t.getViewer().setAmbientLight(e),t.getViewer().render())}},_setPixelCulling(e,t){if(this._player&&this._getExperienceBase()){var i=this._getExperienceBase().getManager("CAT3DXVisuManager");if(i){let a=i.getViewer().currentViewpoint;a&&(a.setPixelCulling(e,t),i.getViewer().render())}}},_setRoughnessMap(e){if(this._player&&this._getExperienceBase()){var t=this._getExperienceBase().getManager("CAT3DXVisuManager");if(t){var i=t.getViewer().ambience;i&&i.setRoughnessMap({url:e,hdr:!0})}}},_getExperienceObjectFromId:function(e,t,i){for(var a=0;a<i.length;a++){var r=i[a];if(r.experienceObject.GetID()===t)return r.experienceObject}},_highlight:function(e,t,r){if(this._player&&this._getExperienceBase()&&this._actorsAssetsList){if(e&&!r||(1===t?a.empty(!0):i.empty(!0)),!e)return;var s=this._getExperienceObjectFromId(this,e,this._actorsAssetsList);if(s){var n=[],o=s.QueryInterface("CATI3DGeoVisu");if(o){var g=o.GetPathElement(),l=o.GetLocalNodes();l&&(g=g.clone()).externalPath.push(l),n.push({pathElement:g})}1===t?a.add(n):i.add(n)}}},_showVisibilityOverride:function(e,t,i){if(!t)return;let a=t.QueryInterface("CATI3DGeoVisu");if(!a)return;var r=a.GetPathElement(),s=a.GetLocalNodes();s&&(r=r.clone()).externalPath.push(s);let n=e.getUniqueOverrideFromPathElement(r);if(!n){let t=e.getOverridesFromPathElement(r);n=t?t[0]:e.createOverride(r)}n&&("show"===i?(n.setVisibility(!0),n.getOpacity()&&n.resetOpacity()):"ghost"===i?n.setOpacity(.07,!0):"hide"===i&&n.setVisibility(!1))},_show:function(e,t){if(this._player&&this._getExperienceBase()&&this._actorsAssetsList){if(!e)return;let r=!1;t.startsWith("gp")&&(r=!0,t=t.slice(2));let s=this._getExperienceBase().getManager("CAT3DXVisuManager");if(s){var i=this._getExperienceObjectFromId(this,e,this._actorsAssetsList);if(i){var a=s.getOverrideSet();if(this._showVisibilityOverride(a,i,t),r){let e=i.QueryInterface("CATI3DExperienceObject");e.SetValueByName("visible",t);let r=e.GetParent();for(;r;)this._showVisibilityOverride(a,r,t),(e=r.QueryInterface("CATI3DExperienceObject")).SetValueByName("visible",t),r=e.GetParent()}}s.getViewer().render()}}},_getActorInfos:function(e,t){var i=function(e,t){e&&e.image&&(t.width<e.image.width&&(t.width=e.image.width),t.height<e.image.height&&(t.height=e.image.height))};let a=!1;if("material"===t)if("materials.3dx"===e||"materials.3dxc"===e){let t=!1,i={},a=this._getExperienceBase().getManager("CAT3DXVisuManager");if(a){let e=a.getViewer();if(e&&e.materialManager&&e.materialManager.CGRSharedMaterials){if(t=!0,e.materialManager.CGRSharedMaterials.size>0){var r={};for(const t of e.materialManager.CGRSharedMaterials.values())void 0!==r[t.getType()]?r[t.getType()]=r[t.getType()]+1:r[t.getType()]=1;i.types=r}}}i.loaded=t,this._trigger("onGetActorInfos"+e,i)}else{var s=this._getExperienceObjectFromId(this,e,this._materialsAssetsList);if(s){a=!0;let t=!1,r={},n=s.QueryInterface("CATI3DXMaterialAsset");if(n&&n._material){t=!0,r.type=n._material.getType();let e={width:0,height:0};i(n._material.map,e),i(n._material.bumpMap,e),i(n._material.clearCoatMap,e),i(n._material.envMap,e),i(n._material.normalMap,e),i(n._material.roughnessMap,e),i(n._material.sheenMap,e),i(n._material.specularMap,e),i(n._material.translucencyMap,e),i(n._material.transparencyMap,e),r.maxWidth=e.width,r.maxHeight=e.height}r.loaded=t,this._trigger("onGetActorInfos"+e,r)}}else if("environment"===t){var n=this._getExperienceObjectFromId(this,e,this._environmentsAssetsList);if(n){a=!0;let t=!1,i={},r=n.QueryInterface("CATI3DXAmbienceAsset");if(r&&r._ambience){t=!0;let e=r._ambience.getIblMap();e&&e.image&&(i.iblWidth=e.image.width,i.iblHeight=e.image.height);let a=r._ambience.getBackground();if(a&&a.getImage){let e=a.getImage();if(e&&e.getTexture){let t=e.getTexture();t&&t.image&&(i.backgroundWidth=t.image.width,i.backgroundHeight=t.image.height)}}}i.loaded=t,this._trigger("onGetActorInfos"+e,i)}}else if("resource"===t){var o=this._getExperienceObjectFromId(this,e,this._resourcesAssetsList);if(o){a=!0;let t=!1,i={},r=o.QueryInterface("CATI3DXPictureResourceAsset");r&&r._picture&&(t=!0,i.width=r._picture.width,i.height=r._picture.height),i.loaded=t,this._trigger("onGetActorInfos"+e,i)}}if(!a){let t={Actor:"Not found"};this._trigger("onGetActorInfos"+e,t)}},_getInfos(e){let t,i=[],a=function(t){return"object"==typeof e?e.includes(t):e===t},r=function(t,a){"object"==typeof e?i[t]=a:i=a},g="visu.render";if(a(g)&&this._player&&this._getExperienceBase()&&(t=this._getExperienceBase().getManager("CAT3DXVisuManager"))){let e=t.getViewer(),i=e.getInfos().render,a=Object.assign({},i);e.internalSceneGraph&&e.internalSceneGraph.scene&&e.internalSceneGraph.scene.__lights&&(a.lights=e.internalSceneGraph.scene.__lights.length),r(g,a)}if(a(g="visu.memory")&&this._player&&this._getExperienceBase()&&(t=this._getExperienceBase().getManager("CAT3DXVisuManager"))&&r(g,t.getViewer().getInfos().memory),a(g="media.inspector")&&r(g,JSON.stringify(this._mediaInspector)),a(g="media.size")&&r(g,this._mediaInspector.mediaSize),a(g="media.authoringApplication")&&r(g,this._mediaInspector.authoringApplication),a(g="media.formatVersion")&&r(g,this._mediaInspector.formatVersion),a(g="media.playerVersion")&&r(g,this._mediaInspector.playerVersion),a(g="media.downloadTimes")){r(g,{startDownloadTime:this._mediaInspector.startDownloadTime,downloadTime:this._mediaInspector.downloadTime})}if(a(g="experience.assets")&&this._player&&this._getExperienceBase()){var l=this._getExperienceBase().getManager("APIPlayerManager");if(l){var c=function(e){var t=0;if(e.mesh3js&&e.mesh3js.geometry&&"Mesh3D"===e.getNodeType())for(var i=0;i<e.mesh3js.geometry.length;i++)for(var a=e.mesh3js.geometry[i]?e.mesh3js.geometry[i].drawingGroups:null,r=a?a.length:0,s=0;s<r;s++){var n=a[s];if(n._primitives&&4===n.glType&&8192===n._geomType)for(var o=0;o<n._primitives.length;o++)t+=n._primitives[o].count/3}else if(e.children)for(var g=0;g<e.children.length;g++)t+=c(e.children[g]);return t},h=function(e,t,i){var a=[];if(t)for(var r=0;r<t.length;r++){var s=t[r];if(s.assetLink&&""!==s.assetLink){var n={};if(n.name=s.name,n.objectId=s.experienceObject.GetID(),n.id=e._getIdFromAssetLink(s.assetLink),a.push(n),"actors"===i){var o=0,g=s.experienceObject.QueryInterface("CATI3DGeoVisu");if(g&&g._node3D&&g._node3D.children)for(var l=0;l<g._node3D.children.length;l++)""===g._node3D.children[l].name&&(o+=c(g._node3D.children[l]));n.nbTriangles=o}}}return a},p={};this._actorsAssetsList=l._listActorsAssets();var d=h(this,this._actorsAssetsList,"actors");p.actors=d,this._materialsAssetsList=l._listMaterialsAssets();var u=h(this,this._materialsAssetsList,"materials");p.materials=u,this._environmentsAssetsList=l._listEnvironmentsAssets();var _=h(this,this._environmentsAssetsList,"environments");p.environments=_,this._resourcesAssetsList=l._listResourcesAssets();var m=h(this,this._resourcesAssetsList,"resources");if(p.resources=m,t=this._getExperienceBase().getManager("CAT3DXVisuManager")){let e=t.getViewer();e&&e.materialManager&&e.materialManager.CGRSharedMaterials&&(p.nbSharedMaterials=e.materialManager.CGRSharedMaterials.size)}r(g,p)}}let f="system.info.memory";if((a(g="system.info")||a(f))&&this._player&&this._getExperienceBase()){let e={};if(a(g)){let t=n.browser.os;if(t){let i=t.name;"win"===t.name&&(i="Windows"),e.OS=i+" "+t.version}}if(a(g)||a(f)){let t=o();e["Used JS heap size (MB)"]=t}if(a(g)&&window.navigator){let t=s.clientEngine;e.Browser=t.name,e["Browser version"]=t.version;let i=s.clientPlatform;e.Mobile=n.isMobile(),e.Platform=i.name,e.Locale=navigator.language||"en-US"}a(f)&&(g=f),r(g,e)}if((a(g="webgl.info")||a("webgl.info.min"))&&this._player&&this._getExperienceBase()){let e={};if((t=this._getExperienceBase().getManager("CAT3DXVisuManager"))&&t.getViewer()&&t.getViewer().canvas){let i=t.getViewer().canvas;if(e.Resolution=i.width+"x"+i.height,e.Downsampling=this._downSampling,a(g)){let a=null,r=1,s=t.getViewer().materialManager;if(s&&(a=s.getContext()),a||a||(a=i.getContext("experimental-webgl",{stencil:!0}),r=1),a){let t=a.getExtension("WEBGL_debug_renderer_info");if(e["Dbg vendor"]=a.getParameter(t.UNMASKED_VENDOR_WEBGL),e["Dbg renderer"]=a.getParameter(t.UNMASKED_RENDERER_WEBGL),e.Version=a.getParameter(a.VERSION),e.Renderer=a.getParameter(a.RENDERER),e["Shading language version"]=a.getParameter(a.SHADING_LANGUAGE_VERSION),e["Depth bits"]=a.getParameter(a.DEPTH_BITS),e["Stencil bits"]=a.getParameter(a.STENCIL_BITS),e["Max texture image units"]=a.getParameter(a.MAX_TEXTURE_IMAGE_UNITS),e["Max texture size"]=a.getParameter(a.MAX_TEXTURE_SIZE),r>1)e["Draw buffers"]=!0,e["Depth texture"]=!0;else{var y=a.getExtension("WEBGL_draw_buffers");e["Draw buffers"]=null!==y;var w=a.getExtension("WEBGL_depth_texture");e["Depth texture"]=null!==w}e["Multi viewer"]=this._multiViewer}}else g="webgl.info.min"}r(g,e)}var v={infos:i};this._trigger("onGetInfos_"+e,v)},_getConsoleMessages:function(){"undefined"!=typeof console&&(void 0!==console.log?void 0===console.olog&&(console.olog=console.log):console.olog=function(){});let e=this;console.log=function(t){console.olog(t);var i={message:t};e._trigger("onGetConsoleMessages",i)},console.error=console.warn=console.debug=console.info=console.log},_getIdFromAssetLink:function(e){var t=void 0;if(e){let i=e.lastIndexOf("/");-1!==i&&(t=e.substring(i+1,e.length))}return t},clean:function(){this._onExperienceReadyListener&&(window.document.removeEventListener("ExperienceReady",this._onExperienceReadyListener,!1),this._onExperienceReadyListener=null),this._onMessageListener&&(window.removeEventListener("message",this._onMessageListener,!1),this._onMessageListener=null),this._player=null,this._ID="",this._experienceName="",this._type="",this._ready=!1}})}),define("DS/XCT3DPlayIntegratability/XCTExtPlatformMediaHelpers",["DS/WAFData/WAFData"],function(e){"use strict";return{listStreams:function(t,i,a,r){var s=i.physicalid,n=i.serverurl,o=i.tenant,g=n+"/resources/experience/medias/"+s+"/streams"+(o?"/?tenant="+o:"");t=i.contextid?i.contextid:t,i.Play3DXContent&&i.Play3DXContent.source.includes("X3DSEAR")&&(t=""),e.authenticatedRequest(g,{method:"GET",type:"json",headers:{"Content-Type":"application/json",SecurityContext:t},onComplete:function(e){null!=a&&a(e.results)},onFailure:function(e){null!=r&&r(e)}})}}}),define("DS/XCT3DPlayIntegratability/ConfigMapping",[],function(){"use strict";return Object.freeze({default:"DS/CXP3DPlay/CXP3DPlayAppStream",defaultStandalone:"DS/CXP3DPlay/CXP3DPlayAppFile",sequence:"DS/XCT25DExperience/XCT25DPlayApp","25D_asset":"DS/XCT25DExperience/XCT25DPlayApp"})}),define("DS/XCT3DPlayIntegratability/XCT3DPlayIntegratability",["UWA/Core","DS/XCT3DPlayIntegratability/ConfigMapping","DS/XCT3DPlayIntegratability/XCTExtPlatformMediaHelpers","DS/3DPlayExperienceModule/PlayExperience3D","DS/ApplicationFrame/FrameWindow3D","DS/XCTInfNotifications/XCTInfNotifications","DS/CoreEvents/Events","DS/WebSystem/Environment","DS/ZipJS/zip-fs","DS/WAFData/WAFData","DS/WebappsUtils/WebappsUtils","DS/XCT3DPlayIntegratability/CRC_32","DS/XCT3DPlayIntegratability/XCTStandalonePlayerAPI","i18n!DS/XCT3DPlayIntegratability/assets/nls/XCT3DPlayIntegratability"],function(e,t,i,a,r,s,n,o,g,l,c,h,p,d){"use strict";return a.extend({init:function(t){(t=t||{}).commandApplication=!1,t.asset=t.input.asset,t.physicalId=t.input.asset.physicalid,t.experience=this,t.workbenchs=t.workbenchs||[],t.visu&&t.visu.clearQM&&localStorage.removeItem("QualityPresets");let i=!0;if(t.visu&&!1===t.visu.multiViewer&&(i=!1),i){var a={visu:{multiViewer:!0,multiViewerFix:!0}};e.extend(t,a,!0)}this._APIManager=null,this._parent(t)},onPostCreate:function(){this.autoReframe=!1,this._parent(),n.publish({event:"3DPlay:Ready"})},loadAssets:function(e,t){s.showInfo(d.error_loadingMultipleFiles_title),this.loadAsset({asset:e.asset[0]},t)},loadAsset:function(t,i){const a=this;this._experienceBase.webApplication.frmWindow.options.viewerOptions.highlight.trapSelection=!1,this._experienceBase.webApplication.frmWindow.options.viewerOptions.picking=!1,this._experienceBase.webApplication.requestNewExperienceBaseAsync().done(function(){if(t){if(a.asset=t.asset,e.is(i.env)&&e.is(i.IBL)&&a.frmWindow._3dViewer.setEnvMap({envMap:i.env,IBLMap:i.IBL}),"FILE"===t.asset.provider&&(t.asset.format&&"dsxm"===t.asset.format.toLowerCase()||t.asset.format&&"dsxmb"===t.asset.format.toLowerCase()))return t.playOptions=i.playOptions?i.playOptions:{},void a.LaunchRightPlayerFromDSXM(t,i);a.LaunchRightPlayerFromStreams(t,i)}})},initExperienceBase:function(e,t){this._parent(e),this._experienceBase=e,t&&t(0)},disposeExperienceBase:function(t){var i;return i=this.player&&this.player.disposeExperienceBase?this.player.disposeExperienceBase():e.Promise.resolve(),this.player=null,i.then(function(){t&&t()})},clearView:function(){this._APIManager&&this._APIManager.clean&&this._APIManager.clean(),this._APIManager=null,this.player&&this.player.clean&&this.player.clean()},LaunchRightPlayerFromStreams:function(e){this.onModelLoadingStarted&&this.onModelLoadingStarted(e.showProgressBar),this.onModelLoadingProgression&&this.onModelLoadingProgression({loaded:20,total:100});var a=this;i.listStreams(e.asset.contextid,e.asset,function(i){a.onModelLoadingProgression&&a.onModelLoadingProgression({loaded:50,total:100});var r=a._getFileType(i),s=!1;"dsxm"===r&&(s=!0,r="25D_asset"),void 0===t[r]&&(r="default"),require([t[r]],function(t){a.player=new t(a,e,s)})})},_getFileType:function(e){for(var t="",i="",a=0;a<e.length;a++)-1!==(i=e[a]).persistencyname.indexOf(".json")&&(t=i.persistencyname.match(/[^.]*/i)[0]),-1!==i.persistencyname.indexOf(".dsxm")&&(t="dsxm");return t},LaunchRightPlayerFromDSXM:function(i,a){var r=this;if(!0===a.addProgressBarCallbacks){var s=function(e,t){var i={protocol:"ExperienceCommunication",playerID:r.args.input.ID,action:e,params:t};window.parent.postMessage(i,"*")};this.addCallbacks({asset:{LoadingStarted:function(e){var t={step:"LoadingStarted",path:e.data,progress:0};s("onLoad",t)},LoadingProgress:function(e){var t={step:"LoadingProgress",path:e.model,progress:e.progress};s("onLoad",t)},loadingFinished:function(e){var t={step:"loadingFinished",path:e.model,progress:100,duration:e.time};s("onLoad",t)},LoadingError:function(e){var t={step:"LoadingError",path:name,error:e};s("onLoad",t)}}})}this.onModelLoadingStarted&&this.onModelLoadingStarted(i.showProgressBar),r.onModelLoadingProgression&&r.onModelLoadingProgression({loaded:20,total:100});let n=Date.now();performance.mark("EXP_Player_MediaDownload_start");let o=i.asset.url||i.asset.filename;l.authenticatedRequest(o,{method:"GET",responseType:"blob",timeout:0,headers:{Accept:"application/octet-stream"},onProgress:function(t){if(t.lengthComputable){var i=t.loaded/t.total*50+20;r.onModelLoadingProgression&&r.onModelLoadingProgression({loaded:i,total:100})}else e.log(d.error_progress_calculation)},onComplete:function(s){performance.mark("EXP_Player_MediaDownload_end");var o="defaultStandalone",l=new g.fs.FS;g.workerScriptsPath=c.getWebappsBaseUrl()+"ZipJS/",l.importBlob(s,function(){i.blob=s,i.onModelLoadingStarted=r.onModelLoadingStarted,i.onModelLoadingProgression=r.onModelLoadingProgression,i.onModelLoadingCompleted=r.onModelLoadingCompleted;var g={geometries:{array:[]},materials:{array:[]},environments:{array:[]},resources:{array:[]}};g.mediaSize=(s.size/1048576).toFixed(2);for(var c=0,h=0,p=!1,d=0;d<l.entries.length;d++){var u=l.entries[d];if(e.is(u.name)&&u.data){var _=u.name,m=u.data.compressedSize/1024,f=parseFloat(m.toFixed(2));p||-1===_.indexOf(".json")||(o=_.match(/[^.]*/i)[0],void 0===t[o]&&(o="defaultStandalone"),p=!0);var y={filename:_,size:f};"materials.3dx"===_||"materials.3dxc"===_?g.materials.array.push(y):-1!==_.indexOf(".xcgr")?(c+=m,g.geometries.array.push(y)):-1!==_.indexOf(".3dx")||-1!==_.indexOf(".3dxc")?g.environments.array.push(y):-1!==_.indexOf(".json")||(h+=m,g.resources.array.push(y))}}g.geometries.size=parseFloat(c.toFixed(2)),g.resources.size=parseFloat(h.toFixed(2)),performance.measure("EXP_Player_MediaDownload","EXP_Player_MediaDownload_start","EXP_Player_MediaDownload_end");let w=performance.getEntriesByName("EXP_Player_MediaDownload");g.startDownloadTime=n,g.downloadTime=(w[0].duration/1e3).toFixed(2),performance.clearMarks("EXP_Player_MediaDownload_start"),performance.clearMarks("EXP_Player_MediaDownload_end"),performance.clearMeasures("EXP_Player_MediaDownload"),r._DoIntegrityCheckAndLaunch(o,i,a,l,g)}),l.closeZipReader()},onFailure:function(t){e.log(t)}})},_DoIntegrityCheckAndLaunch:function(i,a,r,n,g){var l=this;if("defaultStandalone"===i){for(var c=[],u=0,_=0;_<n.entries.length;_++){var m=n.entries[_];if(e.is(m.name))"manifest.json"===m.name?u=_:m.data&&c.push(m.data.uncompressedSize)}c.sort(function(e,t){return e-t});for(var f="",y=0;y<c.length;y++)f+=c[y];n.entries[u].getText(function(e){var n="",c=void 0;if(e&&e.currentTarget&&e.currentTarget.result&&(n=e.currentTarget.result),""!==n&&(c=JSON.parse(n),g.authoringApplication=c.authoringApplication,g.formatVersion=c.manifestVersion),window.SHARE&&window.SHARE.Core&&window.SHARE.Core.getVersion){let e=window.SHARE.Core.getVersion();if(g.playerVersion=e,"6.420.0.0"!==e&&c&&c.authoringApplication&&c.authoringApplication.version){(function(e,t){if("string"!=typeof e)return!1;if("string"!=typeof t)return!1;e=e.split("."),t=t.split(".");const i=Math.min(e.length,t.length);for(let a=0;a<i;++a){if(e[a]=parseInt(e[a],10),t[a]=parseInt(t[a],10),e[a]>t[a])return 1;if(e[a]<t[a])return-1}return e.length===t.length?0:e.length<t.length?-1:1})(e,c.authoringApplication.version)<0&&s.showWarning(d.warning_media_greater_than_player)}}if("true"===o.get("3DPlay.ExpLoadNoIntegrityCheck")||r&&r.playOptions&&!0===r.playOptions.ExpLoadNoIntegrityCheck)require([t[i]],function(e){l.player=new e(l,a),r&&!0===r.addExperienceCommunication&&(l._APIManager=new p(l,a.asset.filename,g))});else{var u="0",_=!1;if(c){var m=c.mediaInformation;m&&(u=m.hash,!0!==m.bundle&&"yes"!==m.bundle||(_=!0))}if(_){var y="";window.SHARE&&window.SHARE.Core&&window.SHARE.Core.getVersion&&(y=window.SHARE.Core.getVersion()),f=f+"experience-3ds-player"+y}u===(new h).calcCRC(f)?require([t[i]],function(e){l.player=new e(l,a),!0===r.addExperienceCommunication&&(l._APIManager=new p(l,a.asset.filename,g))}):(s.showError(d.error_integrityCheck_title),l.onModelLoadingCompleted&&l.onModelLoadingCompleted())}})}else require([t[i]],function(e){l.player=new e(l,a),r&&!0===r.addExperienceCommunication&&(l._APIManager=new p(l,a.asset.filename,g))})}})});