!function(global){"use strict";define("DS/ENXSBToolbarClient/ENXSBToolbarClient",["DS/Core/Core","DS/Tweakers/GeneratedToolbar","DS/Controls/Toggle","DS/Menu/Menu","DS/Utilities/TouchUtils","DS/Windows/ImmersiveFrame","DS/Windows/Panel","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/WebappsUtils/WebappsUtils","DS/Tweakers/TypeRepresentationFactory","DS/WAFData/WAFData","DS/ENXSBGridConnector/StandardFunctions"],function(WUX,WUXGeneratedToolbar,WUXToggle,Menu,WUXTouch,WUXImmersiveFrame,WUXPanel,TreeDocument,TreeNodeModel,WebappsUtils,TypeRepresentationFactory,WAFData,StandardFunctions){var exports={dynamicItems:[]},loadToolbar=function(e){var t=loadTreeDocument(e),n=new TypeRepresentationFactory;if(t.enums)for(var a in t.enums)n.registerEnum(a,t.enums[a]);t.typeReps&&n.registerTypeRepresentations(t.typeReps);var o=document.getElementById("toolbar"),r=new WUXGeneratedToolbar({overflowManagement:"dropdown",direction:"horizontal",items:t.treeDoc,typeRepresentationFactory:n}),s=new WUXImmersiveFrame({}).inject(o),i=(new WUXPanel({title:"ToolBar",immersiveFrame:s,content:r,resizableFlag:!0,width:1e3}),t.content);Menu.show(i,{submenu:"outside"});UWA.createElement("div").inject(document.body)},loadTreeDocument=function(e){var t,n,a,o;if(n=(t=e.data)[0].relateddata.entries,a=t[0].relateddata.enums,o=t[0].relateddata.typeRepresentations,n){n.forEach(function(e){e=processEntry(e)});var r={};return o.forEach(function(e){e=processTypeRep(e),r[e.id]=e}),{entries:n,typeRepresentations:r,enums:a}}},loadTreeDocumentFromTechno=function(e){var t,n;if(t=new TreeDocument({}),(n=JSON.parse(e)).entries)return n.entries.forEach(function(e){t.addRoot(new TreeNodeModel(e))}),{treeDoc:t,typeReps:n.typeRepresentations,enums:n.enums,content:""}},processEntry=function(entry){if(entry.children&&0==entry.children.length&&delete entry.children,entry.dataElements=entry.dataelements,null!=entry.dataelements.disabled&&(entry.dataelements.disabled=JSON.parse(entry.dataelements.disabled)),null!=entry.dataelements.single&&(entry.dataelements.single=JSON.parse(entry.dataelements.single)),entry.dataelements.action)var action=JSON.parse(entry.dataelements.action);void 0!==entry.dataElements.addEventListener&&"true"==entry.dataElements.addEventListener&&void 0!==action?(addEventListenersTo.push({nodeModelId:entry.id,argument:action.argument}),delete entry.dataelements.action):entry.dataelements.action&&(entry.dataelements.action=action),"functionMenu"!=entry.dataElements.typeRepresentation&&"functionMenuIcon"!=entry.dataElements.typeRepresentation&&"function"!=entry.dataElements.typeRepresentation&&"functionIcon"!=entry.dataElements.typeRepresentation&&"PushItem"!=entry.dataElements.typeRepresentation&&"SeparatorItem"!=entry.dataElements.typeRepresentation&&toolbarInputControlsIds.push(entry.id);var cachedDisplayView=dgView.layout._getDataFromPreferences("displayView");void 0===cachedDisplayView&&"DataGridDisplayDetails"==entry.id?entry.dataelements.icon="../../common/images/utilCheckboxChecked.png":void 0!==cachedDisplayView&&entry.id.toLowerCase().contains(cachedDisplayView)&&(entry.dataelements.icon="../../common/images/utilCheckboxChecked.png");var jsBeforeLoad=entry.dataelements.jsBeforeLoad;if(StandardFunctions.isNotNullAndNotEmpty(jsBeforeLoad)&&"javascript:"===jsBeforeLoad.substring(0,11)){jsBeforeLoad=jsBeforeLoad.substring(11),"()"==jsBeforeLoad.substring(jsBeforeLoad.length-2)&&(jsBeforeLoad=jsBeforeLoad.substring(0,jsBeforeLoad.length-2));var fnJsBeforeLoad=eval(jsBeforeLoad);"function"==typeof fnJsBeforeLoad&&fnJsBeforeLoad(entry)}return entry.children&&entry.children.length>0&&entry.children.forEach(function(e){e=processEntry(e)}),entry},processDynamicEntries=function(e){var t={};e.dataelements.rowSelect&&(t.rowSelect=e.dataelements.rowSelect),e.dataelements.displayView&&(t.displayView=e.dataelements.displayView),Object.keys(t).length>0&&(exports.dynamicItems[e.id]=t),e.children&&e.children.length>0&&e.children.forEach(function(e){processDynamicEntries(e)})},processTypeRep=function(e){var t=JSON.parse(e.dataelements.semantics);return e.semantics=t,e.stdTemplate=e.dataelements.stdTemplate,e},createItem=function(e){return{title:e.dataelements.label,type:"PushItem"}};return exports.enableDisableItems=function(e,t){var n={disabled:!0,state:"disabled"},a={disabled:!1,state:"enabled"};e&&null!=e||(e="details");var o=this.dynamicItems,r=this.toolbar;Object.keys(o).forEach(function(s){var i=!1;o[s].displayView&&(o[s].displayView.includes(e)?r.updateNodeModel(s,a):(r.updateNodeModel(s,n),i=!0)),o[s].rowSelect&&(0==t?r.updateNodeModel(s,n):1!=t||i?"single"==o[s].rowSelect?r.updateNodeModel(s,n):i||r.updateNodeModel(s,a):r.updateNodeModel(s,a))})},exports.setEnableState=function(e,t,n,a){t.forEach(function(t){for(var o in t)"menu"==t[o]?e.updateNodeModel(o,{disabled:n}):"subMenu"==t[o]&&e.updateNodeModel(o,{state:a})})},exports.processToolbarData=function(e,t){var n=this.defineToolbar(e);console.log(n),exports.toolbar=t.setToolbar(JSON.stringify(n)),dgView._dgViewToolbar=exports.toolbar,n.entries.forEach(function(e){processDynamicEntries(e)})},exports.init=function(){_pref3DSpace="../..",this.on3dspaceURLRetrieved(_pref3DSpace)},exports.on3dspaceURLRetrieved=function(e){var t=e+"/resources/v1/ui/toolbar/getToolbar?toolbar="+new URL(location.href).searchParams.get("toolbar"),n={type:"json",onComplete:function(e){loadToolbar(e)}};WAFData.authenticatedRequest(t,n)},exports.defineToolbar=function(e){return loadTreeDocument(e)},exports.processedEntries=function(e,t){processDisabledEntries(e,t);return t},exports.processedRSEntries=function(e,t){processRowSelectSinglEntries(e,t);return t},exports})}(this);