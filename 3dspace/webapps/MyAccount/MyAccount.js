define("DS/MyAccount/Column",["UWA/Core","UWA/Class/Promise","DS/i3DXCompass/i3DXCompass","DS/TopFrame/Environment"],function(e,t,n,o){"use strict";var a=require("DS/UWPClientCode/WidgetFactory"),s=require("DS/UWPClientCode/PublicAPI");return{init:function(e,t){t.refreshIfVisible()},_getAppInfo:function(e){return new t(function(t,o){n?n.getAppInfo({appId:e,onComplete:function(e){e?t(e):o("Could not locate app information.")},onFailure:o}):o()})},_instantiateApp:function(n,r,i){return new t(function(t){var i=s&&s.getUserProperty("tenantId"),c=i&&{x3dPlatformId:i}||{},l=l||{},u=e.merge(l,c),f={el:r,title:"",parent:!1,preview:!0,appId:n.id,data:u,header:!0};if(!n||!(n.checksum&&n.launchInfos||n.platforms&&n.platforms[0]&&n.platforms[0].checksum&&n.platforms[0].launchInfos))throw new Error("Could not get valid Config from MyApps for the App "+f.appId);f=e.extend(f,{widgetId:e.is(n.launchInfos)?n.launchInfos:n.platforms[0].launchInfos,isolationLevel:e.is(n.isolationLevel)?n.isolationLevel:n.platforms[0].isolationLevel,token:e.is(n.checksum)?n.checksum:n.platforms[0].checksum}),a.load(f,function(){f.widget&&f.widget.environment&&self.wp&&self.wp.isVisible&&f.widget.environment.setVisible(!0,!0),t(f.widget)},o)})},onBeforeLoadColumns:function(t,n){var o=this,a=document.body.querySelector(".main"),s=document.body.querySelector(".my-account-header"),r=a&&e.extendElement(a).getSize().height||588,i=s&&e.extendElement(s).getSize().height||100,c=t&&t.getValue("appId")||"X3DCALC_AP",l=e.createElement("div",{class:"module my-account-module",styles:{height:r-i-65}});l.inject(t.layout.columns[0].body),o._getAppInfo(c).then(function(e){return o._instantiateApp(e,l,"")})}}}),define("DS/MyAccount/EditableTabView",["UWA/Core","UWA/Utils","UWA/Promise","DS/TopBar/TopBar","DS/TopBarProxy/TopBarProxy","css!DS/MyAccount/MyAccount.css"],function(e,t,n,o,a){"use strict";var s=require("DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices"),r=require("DS/UWPClientCode/PublicAPI"),i=require("DS/WAFData/WAFData");return{showDefaultCard:!1,init:function(e,t){var n=this;n.tabsOptions={className:"my-account",classNames:{scroller:"my-account-tablist-scroller",scrollerButton:"my-account-scroller-button",tabView:"my-account-tabview",tabList:"my-account-tablist",tabPanels:"my-account-tabview-panel"},editable:!1,allowNewTab:!1},n.endpoint="account",n.widget=e,n.enableUserSearch(),e.setValue("tabsOptions",n.tabsOptions),n.setApplicationName(),n.setRightMenu(),n.addTopBarItemProfil(),n.getCurrentUser().then(function(e){n.user=e,t.refreshIfVisible()})},onBeforeLoadCards:function(t,n,o){var a,s,i,c,l=r&&r.getUser(),u=o.length;if(l.login!==this.user.login){for(Array.prototype.clean=function(e){for(var t=0;t<this.length;t++)this[t]===e&&(this.splice(t,1),t--);return this},a=0;a<u;a++){i=(s=o[a])&&s.data;try{c=JSON.parse(i)}catch(e){c={restricted:"false"}}e.is(c.restricted,"boolean")&&!0===c.restricted&&(o[a]=null)}o.clean(null)}},onLoadCards:function(t,n){var o,a,r,i,c,l,u=t.layout.elements.container,f=0,m=this.user;t.body.innerHTML+='<div class="my-account-banner row"></div><div class="my-account-header row"><div class="col-xs-12 col-xs-offset-0 col-sm-4 col-sm-offset-2 col-md-4 col-md-offset-2 my-account-header-logo text-center"><div class="logo"></div></div><div class="col-xs-12 col-sm-6 col-md-6 my-account-header-info"><p class="firstname-lastname-trigramme"><span class="firstname">'+m.firstName+'</span> <span class="lastname-trigramme">'+m.lastName+" ("+m.login+')</span></p><span class="fonticon fonticon-open-down font-3dsregular chevron-tenant"></span>'+(m.company&&m.job?'<p class="job-company"><span class="job">Job title Lorem Ipsum </span></br> <span class="company">Company name Lorem Ipsum </span></p>':"")+'<p class="location-mail-phone">'+(m.address&&m.city?'<span class="location"><span class="fonticon fonticon-3ds-where"></span> '+m.address+", "+m.city+"</span>":"")+(m.email?'<a class="mail"><span class="fonticon fonticon-mail"></span> '+m.email+"</a>":"")+(m.telephone?'<a class="phone"><span class="fonticon fonticon-phone"></span> '+m.telephone+"</a>":"")+"</p></div></div>",s.getPlatformServices({onComplete:function(t){var n,o,a=m&&m.login,s=t&&t[0],r=s&&s["3DSwym"];r&&a&&(n=r+"/api/user/getpicture/login/"+a+"/format/normal",o=e.extendElement(document.body.querySelector(".my-account-header-logo .logo")),e.createElement("img",{src:n}).inject(o))}}),this.enableSelectTenant(document.body.querySelector(".chevron-tenant")),u.className+=" row",a=u.querySelector("."+this.tabsOptions.classNames.scroller+"-ctn"),o=u.querySelector("."+this.tabsOptions.classNames.tabPanels),a.className+=" col-xs-4 col-xs-offset-2 col-sm-4 col-sm-offset-2 col-md-4 col-md-offset-2 resetPadding",o.className+=" col-xs-12 col-sm-6 col-md-6",i=e.createElement("select",{class:"form-control mobile-tab-select"}),c=u.querySelectorAll("."+this.tabsOptions.classNames.tabList+" > .wp-tab .title"),l=["user","navigation-history","search","lock","cog","rss","list","help"],[].forEach.call(c,function(e){e.innerHTML='<span class="fonticon fonticon-'+l.shift()+'"></span> '+e.innerHTML,i.innerHTML+='<option value="'+f+'">'+e.innerHTML+"</option>",f++}),r=e.createElement("div",{class:"mobile-tab-container col-xs-12"}),i.inject(r),u.insertBefore(r,o),i.addEvent("change",function(e){var t=e&&e.target,n=t&&t.value,o=document.body.querySelectorAll(".my-account-tablist li");o[n]&&o[n].click()}),n.switchCard(this.getTabToLoad(t))},enableUserSearch:function(){var e=this;s.getPlatformServices({onComplete:function(t){var n=t&&t[0];n&&n["3DSwym"]?o.addEvent({events:{search:function(t){var n=t.value||"";window.location.hash=e.endpoint+":"+n,location.reload()},clearSearch:function(){}}}):console.error("Account search feature disable")}})},getCurrentUser:function(){var e=r&&r.getUser(),t=this.parseUrl(),o=t&&t.account;return o?this.getUserInfos(o):e?new n(function(t){t(e)}):void console.error("User is not defined")},getUserInfos:function(t){var o=r&&r.getUser();return o&&o.login===t?new n(function(e){e(o)}):new n(function(e,t){s.getPlatformServices({onComplete:function(n){var o=n&&n[0],a=o&&o["3DSwym"];a?e(a):(console.error("Swym URL not found"),t())}})}).then(function(e){return new n(function(t,n){e?i.authenticatedRequest(e+"/api/index/tk",{type:"json",onComplete:function(o){!o||!o.result||o.error||o.errorcode?(console.error("Cannot get Swym Token"),n()):t({swymURL:e,token:o.result.ServerToken})}}):(console.error("Swym URL not defined"),n())})}).then(function(o){return new n(function(n,a){var s=o&&o.swymURL,r=o&&o.token;s&&r?i.authenticatedRequest(s+"/api/user/find/login/"+t,{method:"GET",headers:{"X-DS-SWYM-CSRFTOKEN":r,"Content-Type":"application/json",Accept:"application/json"},onComplete:function(t){e.is(t,"string")&&(t=JSON.parse(t)),t&&t.result?n(t.result):(console.error("Error on parsing data from Swym"),a())},onFailure:a,onTimeout:a}):(console.error("Swym URL or Token not defined"),a())})}).then(this.formatUser)},formatUser:function(e){return new n(function(t){e.firstName=e.firstName||e.first_name,e.lastName=e.lastName||e.last_name,t(e)})},parseUrl:function(){var e=window&&window.location,t=e&&e.hash,n=(e&&e.pathname,{});return/#account(\:\w+)?\/?(tab\:\w+)?/g.test(t)&&((t=t.substring(1)).split("/").forEach(function(e){var t=e.split(":");n[t[0]]=t[1]}),n.tab&&(n.tab=n.tab.charAt(0).toUpperCase()+n.tab.slice(1).toLowerCase())),n},setApplicationName:function(){this.getCurrentUser().then(function(e){(r&&r.getUser())===e?o.set({application:"My Account"}):o.set({application:"Profil"})})},addTopBarItemProfil:function(){var e=new a({id:this.endpoint});e.empty(),e.setContent({profile:[{label:"My Account",onExecute:function(){}}]})},setRightMenu:function(){require(["DS/TopBarProxy/TopBarProxy"],function(e){new e({id:"MyAccount"}).addContent({profile:[{label:"My Account",onExecute:function(){}},{label:"Preferences",onExecute:function(){}},{label:"Sign Out",onExecute:function(){}}]})})},enableSelectTenant:function(e){s.getPlatformServices({onComplete:function(t){var n=[];t.forEach(function(e){var t=e.platformId;n.push({text:t})}),require(["DS/UIKIT/DropdownMenu"],function(t){new t({target:e,items:n,events:{onClick:function(e,t){r.setUserProperty("tenantId",t.name),window.location.reload()}}})})}})},getTabToLoad:function(e){var t=e&&e.getValue("defaultCard")||0,n=this.parseUrl();return n&&n.tab||t}}});