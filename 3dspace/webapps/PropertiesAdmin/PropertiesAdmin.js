define("DS/PropertiesAdmin/ajax/AjaxRequests",["DS/WidgetServices/WidgetServices","DS/EditPropWidget/ajaxRequests/ServicesAjaxRequests","DS/WAFData/WAFData","i18n!DS/MaskCustomization/assets/nls/maskCustomization"],function(e,t,n){"use strict";var i={createRequest:function(i,o,s,a){i.handleRequest||(i.handleRequest={}),i.handleRequest.handle=e.get3DSpaceUrlAsync({onComplete:function(e){var r=e+s,l={Accept:"application/json","content-type":"application/json"};l["Accept-Language"]=widget.lang;var c=i.securityContext;c&&(l.SecurityContext=encodeURIComponent(c));var u={type:"json",method:o,timeout:36e5,proxy:"passport",headers:l,onComplete:function(e){i.onComplete(e)},onFailure:function(e,n,o){t._onFailure(e,n,o,i)},onTimeout:function(e){t._onTimeout(i)}};widget.getValue("isStandalone")||(u.authentication="passport"),a&&(u.data=UWA.Json.encode(a)),i.handleRequest.handle=n.handleRequest(t._formatUrl(null,r),u)}})},getListOfSettings:function(e){i.createRequest(e,"GET","/resources/collabCommon/settings/list",null)},getSettingsFile:function(e){var t="/resources/collabCommon/settings/"+e.name;i.createRequest(e,"GET",t,null)},getOriginFile:function(e){var t="/resources/collabCommon/settings/"+e.name+"/origin";i.createRequest(e,"GET",t,null)},updateSettingsFile:function(e){var t=e.content;void 0===e.content.settings&&(t={settings:t});var n="/resources/collabCommon/settings/"+e.name;i.createRequest(e,"PATCH",n,t)},getAllMaskTypes:function(e){i.createRequest(e,"GET","/resources/collabCommon/settings/listallmasktypes",null)},downloadOriginMask:function(e){var t={type:e.type,name:e.name};i.createRequest(e,"POST","/resources/collabCommon/settings/originmask",t)},downloadMask:function(e){var t={type:e.type,name:e.name};i.createRequest(e,"POST","/resources/collabCommon/settings/getmask",t)},uploadMask:function(e){var t={type:e.type,name:e.name,fileContent:e.fileContent};i.createRequest(e,"PATCH","/resources/collabCommon/settings/uploadmask",t)},downloadBackup:function(e){var t={type:e.type,name:e.name};i.createRequest(e,"POST","/resources/collabCommon/settings/getbackup",t)},isBackupAvailable:function(e){var t={type:e.type,name:e.name};i.createRequest(e,"POST","/resources/collabCommon/settings/isbackup",t)}};return{getListOfSettings:function(e){t.securityContextDispatcher(e,i.getListOfSettings)},getSettingsFile:function(e){t.securityContextDispatcher(e,i.getSettingsFile)},updateSettingsFile:function(e){t.securityContextDispatcher(e,i.updateSettingsFile)},getOriginFile:function(e){t.securityContextDispatcher(e,i.getOriginFile)},getAllMaskTypes:function(e){t.securityContextDispatcher(e,i.getAllMaskTypes)},downloadOriginMask:function(e){t.securityContextDispatcher(e,i.downloadOriginMask)},downloadMask:function(e){t.securityContextDispatcher(e,i.downloadMask)},uploadMask:function(e){t.securityContextDispatcher(e,i.uploadMask)},downloadBackup:function(e){t.securityContextDispatcher(e,i.downloadBackup)},isBackupAvailable:function(e){t.securityContextDispatcher(e,i.isBackupAvailable)}}}),define("DS/PropertiesAdmin/PropertiesAdmin",["DS/EditPropWidget/facets/Common/FacetsBase","DS/PropertiesAdmin/ajax/AjaxRequests","DS/EditPropMaskUX/scripts/controller/MaskController","DS/UIKIT/Mask","DS/Controls/Button","DS/Controls/TooltipModel","DS/WidgetServices/WidgetServices","i18n!DS/PropertiesAdmin/assets/nls/propertiesAdmin","css!DS/PropertiesAdmin/PropertiesAdmin.css"],function(e,t,n,i,o,s,a,r){require(["DS/UIKIT/SuperModal"]);var l=e.extend({init:function(e){this._parent(e),this._maskNumber=0,this._initUI()},_setError:function(e,t,n){t=t||"error",this._raiseNotification(e,t,n)},_manageError:function(e){var t=!1===e.success;if(t){var n=void 0!==e.message?e.message:e.error&&e.error.message?e.error.message:"server error";this._setError(n)}return t},_initUI:function(){this.elements.settingsContainer=UWA.createElement("div",{class:"containerSettings"}),this.elements.container=this.elements.settingsContainer,this.onRefresh()},__uploadFile:function(e,n){var i=this,o=new FileReader;o.onload=function(n){try{var o=JSON.parse(n.target.result);t.updateSettingsFile({name:e,content:o,onComplete:function(e){i._manageError(e)||i._raiseNotification(r.uploadDone,"success")}})}catch(n){i._raiseNotification(r.notJson,"error")}},o.readAsText(n)},_uploadFile:function(e,t,n){for(var i,o=this,s=n.target.files,a=null,l=0;i=s[l];l++){if(i.name.match(".*json")){a=i;break}this._raiseNotification(r.ChooseJson,"warning")}a&&(0!==a.name.indexOf(e)?require(["DS/UIKIT/SuperModal"],function(e){o.elements.validUpload=o.elements.validUpload?o.elements.validUpload:new e({renderTo:o.elements.container}),o.elements.validUpload.confirm(r.wrongNameMsg,r.wrongNameTitle,function(e){e&&o.__uploadFile(t,a)})}):o.__uploadFile(t,a))},_addSettings:function(e){var n=this,i=e.name,l=e.label;"enoPropertiesFacetsParameters"==i?l=r.FacetMgmtLabel:"enoMaskOptions"==i?l=r.FormOptionsLabel:"enoAttributesOptions"==i&&(l=r.PropOptionsLabel);var c=UWA.createElement("div",{class:"containerFile"}).inject(this.elements.settingsContainer);UWA.createElement("div",{text:l,class:"fileTitle"}).inject(c);var u=UWA.createElement("div",{class:"fileButtons"}).inject(c),m=new o({label:r.Download,emphasize:"primary",icon:{iconName:"download",fontIconFamily:WUXManagedFontIcons.Font3DS,fontIconSize:"1x"}}).inject(UWA.createElement("div",{class:"buttonContainer"}).inject(u));m.tooltipInfos=new s({shortHelp:r.DownloadTooltip,mouseRelativePosition:!0}),m.addEventListener("buttonclick",function(){n.showLoader(),t.getSettingsFile({name:i,onComplete:function(e){n.hideLoader(),n._manageError(e)||a.download(l,e.settings,"json",!0)}})});var d=UWA.createElement("input",{type:"file",class:"inputSettings",events:{change:function(e){n._uploadFile(l,i,e),this.value=null}}}).inject(c);d.hide();var p=new o({label:r.Upload,emphasize:"primary",icon:{iconName:"upload",fontIconFamily:WUXManagedFontIcons.Font3DS,fontIconSize:"1x"}}).inject(UWA.createElement("div",{class:"buttonContainer"}).inject(u));p.tooltipInfos=new s({shortHelp:r.UploadTooltip,mouseRelativePosition:!0}),p.addEventListener("buttonclick",function(){a.isReplayedODT()||d.click()});var g=new o({label:r.Origin,emphasize:"primary",icon:{iconName:"export",fontIconFamily:WUXManagedFontIcons.Font3DS,fontIconSize:"1x"}}).inject(UWA.createElement("div",{class:"buttonContainer"}).inject(u));g.tooltipInfos=new s({shortHelp:r.OriginTooltip,mouseRelativePosition:!0}),g.addEventListener("buttonclick",function(){n.showLoader(),t.getOriginFile({name:i,onComplete:function(e){n.hideLoader(),n._manageError(e)||a.download(l,e.settings,"json",!0)}})})},_addMaskSettings:function(){var e=UWA.createElement("div",{class:"containerFile"}).inject(this.elements.settingsContainer);UWA.createElement("div",{text:r.MaskUXLabel,class:"fileTitle"}).inject(e);var t=UWA.createElement("div",{class:"fileButtons"}).inject(e);new n({maskUXMainContainer:t,touchMode:!1}).initMaskServices("OnPremise")},onRefresh:function(){var e=this;this._maskNumber++,i.mask(this.elements.container),t.getListOfSettings({onComplete:function(t){(e._maskNumber--,e._maskNumber<=0&&i.unmask(e.elements.container),e._manageError(t))||(t.settings.forEach(function(t){e._addSettings(t)}),e._addMaskSettings())}})}});return a.isReplayedODT()&&(l.priv=a),l});