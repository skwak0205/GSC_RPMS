define("DS/AccessRightWidget/AccessRightModel",["UWA/Controls/Abstract"],function(e){return e.extend({init:function(e){this._RightList=[],this._DataList=[],this._ObjectId=e,this._ownerId="",this._projId="",this._orgId="",this._userGrpId="",this._objectType=""},setPOV:function(e,t,n,i){this._ownerId=e,this._projId=t,this._orgId=n,this._userGrpId=i},getOwnerId:function(){return this._ownerId},getProjId:function(){return this._projId},getOrgId:function(){return this._orgId},getUserGrpId:function(){return this._userGrpId},getObjectType:function(){return this._objectType},setRightList:function(e){this._RightList=e},setDataList:function(e){this._DataList=e},setObjectId:function(e){this._ObjectId=e},setObjectType:function(e){this._objectType=e},getRightList:function(){return this._RightList},getDataList:function(){return this._DataList},getObjectId:function(){return this._ObjectId}})}),define("DS/AccessRightWidget/AccessRightController",["UWA/Controls/Abstract","UWA/Json","DS/AccessRightWidget/AccessRightModel","DS/WidgetServices/WidgetServices","DS/WAFData/WAFData","DS/WidgetServices/securityContextServices/SecurityContextServices","i18n!DS/AccessRightWidget/assets/nls/langAR"],function(e,t,n,i,r,o,s){var a=i.getProdLevel();return e.extend({defaultOptions:{uniqueRightList:!1,wintop:!1,serverName:"",serverUri:"",isReadOnly:!1,odtMode:!1,parent:null},init:function(e,t){a=i.getProdLevel(),this.widget=e,this.AccessRightModelList=[],this.ECToParentMap=JSON.parse("[]"),this.IdToECMap=JSON.parse("[]"),this.SelectedItemsMap=JSON.parse("[]"),this.ExistingECItemsMap=JSON.parse("[]"),this.AggrItemsMap=JSON.parse("[]"),this.ErrorExistingECAndAggrItemsMap=JSON.parse("[]"),this.SelectedItems=[],this.SelectedItemsTypeMap=JSON.parse("[]"),this.NonEmbeddedComponentList=[],this._bInitDatas=!1,this._options=t,this._parent(t),this.accessLogicalNlsMap={}},getRightList:function(e){var t=[];return 1==this.options.uniqueRightList?this.AccessRightModelList.length>0&&(t=this.AccessRightModelList[0].getRightList()):this.AccessRightModelList.every(function(n){return n.getObjectId()!=e||(t=n.getRightList(),!1)}),t},getFormattedRightList:function(e){var t=this.getRightList(e),n=[];return t.forEach(function(e,t){var i={label:e.nls,value:e.logical};n.push(i)}),n},getAccessNls:function(e){return this.accessLogicalNlsMap[e]},getOwnership:function(e){var t=[];return this.AccessRightModelList.every(function(n){return n.getObjectId()!=e||(t=n.getDataList(),!1)}),t},isInherited:function(e,t){var n=this.getOwnershipFromOwner(e,t),i=!1;return null!=n&&n.hasOwnProperty("inheritedPath")&&n.inheritedPath.length>0&&(i=!0),i},getOwner:function(e,t){var n=this.getOwnershipFromOwner(e,t);return null==n?null:n.owner},getOwnershipFromOwner:function(e,t){var n=this.getOwnership(e),i=null,r=this;return n.every(function(e){return 1!=r.ownerAreSame(e.owner,t).same||(i=e,!1)}),i},getFusionOwnership:function(){var e=this,t=[];return e.options.odtMode&&this.AccessRightModelList.length>0&&(this.AccessRightModelList[0]._DataList[0]={owner:{comment:"-",person:{personID:"svc_qauser1_PRJ",personFullName:"Mr svc_qauser1",personFirstName:"Mr",personLastName:"svc_qauser1"},collabSpace:{collabSpaceID:"TestCollabSpace1"},organization:{orgID:"Company Name"}},access:{logical:"Basic"},inheritedPath:[]}),this.AccessRightModelList.forEach(function(n,i){var r=n.getDataList();if(0==i)r.forEach(function(e){t.push({ownership:e,isTrueComment:!0,inheritedPath:!0})});else{var o=[];t.forEach(function(t){element=t.ownership,r.every(function(n){if(element.access.logical==n.access.logical){var i=e.ownerAreSame(element.owner,n.owner);if(1==i.same){if(0==t.hasOwnProperty("isTrueComment")&&(t.isTrueComment=!0),0==i.sameComment&&(element.owner.comment=UWA.i18n("DifferentFromItem"),t.isTrueComment=!1),0==t.hasOwnProperty("isTrueInheritedPath")&&(t.isTrueInheritedPath=!0),1==t.isTrueInheritedPath){var r=!0;if(1==element.hasOwnProperty("inheritedPath")||1==n.hasOwnProperty("inheritedPath")?1==element.hasOwnProperty("inheritedPath")&&1==n.hasOwnProperty("inheritedPath")?((element.inheritedPath.length<=0||n.inheritedPath.length<=0)&&(t.isAllInherit=!1),r=e.inheritedPathAreSame(element.inheritedPath,n.inheritedPath)):r=!1:element.isAllInherit=!1,0==r){var s=[{inheritedFrom:{objectID:"undefined",objectTNR:UWA.i18n("DifferentFromItem")},inheritedAccess:{logical:UWA.i18n("DifferentFromItem")}}];element.inheritedPath=s}}return o.push(t),!1}}return!0})}),t=o}}),t},inheritedPathAreSame:function(e,t){var n=!0;if(e.length==t.length){var i=t.slice();e.every(function(e){var t=!1;return i.every(function(n,r){return e.inheritedFrom.objectID!=n.inheritedFrom.objectID||(i.splice(r,1),t=!0,!1)}),0!=t||(n=!1,!1)})}else n=!1;return n},ownerAreSame:function(e,t){var n=!0,i=!1;return(e.hasOwnProperty("person")||t.hasOwnProperty("person"))&&(e.hasOwnProperty("person")&&t.hasOwnProperty("person")?e.person.personID!=t.person.personID&&(n=!1):n=!1),(1==n&&e.hasOwnProperty("collabSpace")||t.hasOwnProperty("collabSpace"))&&(e.hasOwnProperty("collabSpace")&&t.hasOwnProperty("collabSpace")?e.collabSpace.collabSpaceID!=t.collabSpace.collabSpaceID&&(n=!1):n=!1),(1==n&&e.hasOwnProperty("organization")||t.hasOwnProperty("organization"))&&(e.hasOwnProperty("organization")&&t.hasOwnProperty("organization")?e.organization.orgID!=t.organization.orgID&&(n=!1):n=!1),(1==n&&e.hasOwnProperty("userGrp")||t.hasOwnProperty("userGrp"))&&(e.hasOwnProperty("userGrp")&&t.hasOwnProperty("userGrp")?e.userGrp.userGrpID!=t.userGrp.userGrpID&&(n=!1):n=!1),(1==n&&e.hasOwnProperty("group")||t.hasOwnProperty("group"))&&(e.hasOwnProperty("group")&&t.hasOwnProperty("group")?e.group.groupURI!=t.group.groupURI&&(n=!1):n=!1),(e.hasOwnProperty("comment")||t.hasOwnProperty("comment"))&&e.hasOwnProperty("comment")&&t.hasOwnProperty("comment")&&e.comment==t.comment&&(i=!0),{same:n,sameComment:i}},_accessListSame:function(e,t){if(returnedValue=!0,e.length!=t.length)returnedValue=!1;else{var n=t.slice(),i=!0;e.every(function(e){var t=!1;return n.every(function(i,r){return e.logical!=i.logical||(t=!0,n.splice(r,1),!1)}),0!=t||(i=!1,!1)}),0==i&&(returnedValue=!1)}return returnedValue},onLoad:function(){this.AccessRightModelList=[],this.widget=widget,this.AccessRightModelList=[],this.ECToParentMap=JSON.parse("[]"),this.IdToECMap=JSON.parse("[]"),this.SelectedItemsMap=JSON.parse("[]"),this.ExistingECItemsMap=JSON.parse("[]"),this.AggrItemsMap=JSON.parse("[]"),this.ErrorExistingECAndAggrItemsMap=JSON.parse("[]"),this.SelectedItems=[],this.SelectedItemsTypeMap=JSON.parse("[]"),this.NonEmbeddedComponentList=[],this._bInitDatas=!1},onRefresh:function(){var e=[];this.AccessRightModelList.forEach(function(t){e.push({objectID:t.getObjectId()})}),this.AccessRightModelList=[],this._addSelectedIdInList(e)},getCurrentSelectedItems:function(){var e=[];return this.AccessRightModelList.forEach(function(t){e.push({objectID:t.getObjectId()})}),e},isPovOwner:function(e,t){var n=this._getModel(e);return null!=n&&n.getOwnerId()==t},isPovCollabSpace:function(e,t,n){var i=this._getModel(e);return null!=i&&(i.getProjId()==t&&i.getOrgId()==n)},isPovUserGroup:function(e,t){var n=this._getModel(e);return null!=n&&n.getUserGrpId()==t},_getModel:function(e){for(var t=0;t<this.AccessRightModelList.length;t++){var i=this.AccessRightModelList[t];if(i.getObjectId()==e)return i}var r=new n(e);return this.AccessRightModelList.push(r),r},flatten:function(e){var t=this;return e.reduce(function(e,n){return e.concat(Array.isArray(n)?t.flatten(n):n)},[])},parseResponse:function(e){let t=[];if(!UWA.is(e.collabspaces,"array"))return t;let n=[...new Set(this.flatten(e.collabspaces.map(e=>e.couples.map(e=>e.organization.name))))].length>1;return e.collabspaces.forEach(e=>{e.couples.forEach(i=>{var r=null==i.role.nls||""==i.role.nls?i.role.name:i.role.nls,o=i.role.name,s=i.organization.name,a=i.organization.title,c=e.name,l=e.title?e.title:e.name;let d=n?l+" ● "+a+" ● "+r:l+" ● "+r,h="ctx::"+o+"."+s+"."+c;t.push({displayName:d,ctx:h})})}),t.sort((e,t)=>e.displayName.localeCompare(t.displayName,void 0,{numeric:!0,sensitivity:"base"}))},_createFilterPayload:function(e,t){let n={Command:t,SecurityContexts:e.map(e=>e.ctx)};return JSON.stringify(n)},isAdminCred:function(e){let t=e.match(/(ctx::)([^.]+)/);return t.length>2&&"VPLMAdmin"===t[2]},adminFilterPatch:function(e){var t=this;return e.filter(e=>!t.isAdminCred(e))},filterCredentials:function(e,t,n,i,r){var o=this,s=o._createFilterPayload(t,n);this._post3("/resources/lifecycle/util/filterValidSCs",s,function(e){e.status&&"success"===e.status&&i(o.adminFilterPatch(e.data))},function(e){r(e)})},_loadCredentials:function(e,t,n){var i=this;this._get("/resources/modeler/pno/person",{current:"true",select:"collabspaces&select=preferredcredentials"},function(e){t(i.parseResponse(e))},function(e){n(e)})},_fillAttributesOfSelectedItems:function(e,t,n){for(var i=[],r=e.length,o=[],s=0;s<r;s++)o.push(e[s].physicalId);for(var a=o.length,c=0;c<a;c++){var l=o[c];i.push(l)}var d=i;this._post2("/resources/accessRightServices/ar/getAttributesForAccessRights",d,function(e,n){t(e,n)},function(e){n(e)})},_fillModels:function(e){for(var t=this,n=e.length,i=0;i<n;i++){var r=e[i];if(null!==r){var o=t._getModel(r.physicalId);null!=o&&(t.IdToECMap[r.physicalId]=r.v_IsEmbeddedComponent,t.SelectedItemsMap[r.physicalId]=r,t.SelectedItemsTypeMap[r.type]=r,o.setPOV(r.owner+"_PRJ",r.project,r.organization),o.setObjectType(r.type))}}if(t.SelectedItems=e.splice(0),0==t._bInitDatas){var s=[];t._bInitDatas=!0,t.AccessRightModelList.forEach(function(e){t.NonEmbeddedComponentList.push(e.getObjectId()),s.push({objectID:e.getObjectId()})}),t._getAccessListForIds(s)}},_getSecurityContext:function(e,t){o.getInstance().getSecurityContext({onSuccess:function(t){var n="";null!=t&&null!=t.SecurityContext&&0!=(n=t.SecurityContext).indexOf("ctx::")&&(n="ctx::"+n),e(n)},onFailure:function(e){t(e)}})},_post2:function(e,n,r,o){var a=this;datasString=t.encode({requests:n}),this._getSecurityContext(function(t){i.get3DSpaceUrlAsync({onComplete:function(n){var c=n+e,l={Accept:"application/json","Content-Type":"application/json"};l.SecurityContext=encodeURIComponent(t),l["Accept-Language"]=widget.lang;var d=i.getTenantID();d&&0!=d.length?c+="?tenant="+d:c+="?tenant=OnPremise",i.partitionedAuthenticatedRequest(c,{method:"POST",headers:l,timeout:864e5,cancelCallback:function(){return!1},partisionedProgressLabel:s.get("AR_FilteringAttributes"),progressBarContext:a.options.contextArea1,progressBarWaitContext:a.options.progressBarWaitContext,data:datasString,type:"json",onComplete:function(e){r(e,n)},onFailure:function(e){o(e)},onTimeout:function(){o("timeout")}})},serverUrl:a.options.serverUrl,wintop:a.options.wintop})},function(e){o(e)})},_post:function(e,t,n,r){var o=this;this._getSecurityContext(function(a){i.get3DSpaceUrlAsync({onComplete:function(c){var l=c+e,d={Accept:"application/json","Content-Type":"application/json"};d.SecurityContext=encodeURIComponent(a);var h=i.getTenantID();h&&0!=h.length?l+="?tenant="+h:l+="?tenant=OnPremise",i.partitionedAuthenticatedRequest(l,{method:"POST",headers:d,timeout:864e5,cancelCallback:function(){return!1},partisionedProgressLabel:s.get("AR_RetrievingAttributes"),progressBarContext:o.options.contextArea1,progressBarWaitContext:o.options.progressBarWaitContext,data:UWA.Json.encode(t),type:"json",onComplete:function(e){n(e)},onFailure:function(e){r(e)},onTimeout:function(){r("timeout")}})},serverUrl:o.options.serverUrl,wintop:o.options.wintop})},function(e){r(e)})},_post3:function(e,t,n,r){var o=this;this._getSecurityContext(function(a){i.get3DSpaceUrlAsync({onComplete:function(c){var l=c+e,d={Accept:"application/json","Content-Type":"application/json"};d.SecurityContext=encodeURIComponent(a);var h=i.getTenantID();h&&0!=h.length?l+="?tenant="+h:l+="?tenant=OnPremise",i.partitionedAuthenticatedRequest(l,{method:"POST",headers:d,timeout:864e5,cancelCallback:function(){return!1},partisionedProgressLabel:s.get(""),progressBarContext:o.options.contextArea1,progressBarWaitContext:o.options.progressBarWaitContext,data:t,type:"json",onComplete:function(e){n(e)},onFailure:function(e){r(e)},onTimeout:function(){r("timeout")}})},serverUrl:o.options.serverUrl,wintop:o.options.wintop})},function(e){r(e)})},_get:function(e,t,n,o){var s=this;this._getSecurityContext(function(o){i.get3DSpaceUrlAsync({onComplete:function(c){var l=c+e,d={Accept:"application/json","Content-Type":"application/json"};d.SecurityContext=encodeURIComponent(o);var h=i.getTenantID();h&&0!=h.length?l+="?tenant="+h:l+="?tenant=OnPremise",t.hasOwnProperty("current")&&t.hasOwnProperty("select")&&(l+="&current="+t.current+"&select="+t.select);var u="";2==a&&(u="passport"),r.authenticatedRequest(l,{type:"json",method:"GET",headers:d,proxy:u,data:"",onComplete:function(e){n(e)},onFailure:function(e,t,n){s._onFailureAvailability(e,t,n)},onTimeout:function(){s._onTimeoutAvailability(items)}})},serverUrl:s.options.serverUrl,wintop:s.options.wintop})},function(e){o(e)})},_addSelectedIdInList:function(e){var n=this;this.options.serverName,this.options.serverUri;this._getSecurityContext(function(r){i.get3DSpaceUrlAsync({onComplete:function(o){var c="",l=i.getRealPath("assets/dataRightList.json",n.widget),d="GET",h="";2==a&&(h="passport"),2==a&&(c='{ "businessObject": '+t.encode(e)+"}",l=o+"/resources/pno/ownership/logicalaccess",d="POST"),headers={Accept:"application/json"},headers["Content-Type"]="application/json",headers["Accept-Language"]=widget.lang,headers.SecurityContext=encodeURIComponent(r),n.RightList=[];var u=i.getTenantID();u&&0!=u.length?l+="?tenant="+u:l+="?tenant=OnPremise",i.partitionedAuthenticatedRequest(l,{type:"json",method:d,headers:headers,proxy:h,timeout:864e5,cancelCallback:function(){return!1},partisionedProgressLabel:s.get("AR_DeterminingAccessRights"),progressBarContext:n.options.contextArea1,progressBarWaitContext:n.options.progressBarWaitContext,data:c,onComplete:function(t){n._onCompleteRightList(t,e)},onFailure:function(e,t,i){n._onFailure(e,t,i)},onTimeout:function(){n._onTimeout()}})},serverUrl:n.options.serverUrl,wintop:n.options.wintop})},function(e){onError(e)})},_onFailure:function(e,t,n){var i={};i=null!=t&&t.hasOwnProperty("error")?t.error:{message:UWA.i18n("UnknownError"),code:"ERROR"},this.dispatchEvent("onError",i)},_onTimeout:function(){var e={message:UWA.i18n("ErrorTimeOut"),code:"TO"};this.dispatchEvent("onError",e)},_onCompleteRightList:function(e,n){var r=this;if(1==e.success){var o={Accept:"application/json","Content-Type":"application/json"};r.RightList=[];var c=i.getRealPath("assets/dataUserStandAlone.json",r.widget),l="GET",d="",h="";2==a&&(d="passport"),this._getSecurityContext(function(u){i.get3DSpaceUrlAsync({onComplete:function(p){if(2==a){r.options.serverName,r.options.serverUri;h='{ "businessObject": '+t.encode(n)+"}",c=p+"/resources/pno/ownership",l="POST"}var g=e.accessList,m=null,f=[];n.forEach(function(e){var t=r._getModel(e.objectID);f.push(t)});var v=-1,A=-1;if(g.every(function(e,t){var n=!1;if(f.every(function(t,i){return A=i,t.getObjectId()!=e.objectID||(t.setRightList(e.access),n=!0,!1)}),1==n&&1==r.options.uniqueRightList){var i=!0;if(0==r.AccessRightModelList.length&&t>0&&v>=0?i=r._accessListSame(f[v].getRightList(),e.access):r.AccessRightModelList.length>0&&(i=r._accessListSame(r.AccessRightModelList[0].getRightList(),e.access)),0==i)return m={message:UWA.i18n("ErrorDismatchAccessList"),code:""},r.dispatchEvent("onError",m),r.dispatchEvent("onDataLoaded"),!1;v=A}return!0}),null==m){o["Accept-Language"]=widget.lang,o.SecurityContext=encodeURIComponent(u);var I=i.getTenantID();I&&0!=I.length?c+="?tenant="+I:c+="?tenant=OnPremise",i.partitionedAuthenticatedRequest(c,{type:"json",method:l,headers:o,proxy:d,cancelCallback:function(){return!1},partisionedProgressLabel:s.get("AR_RetrievingOwnershipInformation"),progressBarContext:r.options.contextArea1,progressBarWaitContext:r.options.progressBarWaitContext,data:h,timeout:864e5,onComplete:function(e){r._onCompleteDataList(e)},onFailure:function(e,t,n){r._onFailure(e,t,n)},onTimeout:function(){r._onTimeout()}})}},serverUrl:r.options.serverUrl,wintop:r.options.wintop})},function(e){onError(e)})}else e.hasOwnProperty("error")&&r.dispatchEvent("onError",e.error)},_getAccessListForIds:function(e){var n=this,r=[];if(null!=n.SelectedItemsTypeMap){Object.keys(n.SelectedItemsTypeMap).map(function(e){return n.SelectedItemsTypeMap[e]}).forEach(function(e){null!=e&&r.push({objectID:e.physicalId})})}this.options.serverName,this.options.serverUri;this._getSecurityContext(function(o){i.get3DSpaceUrlAsync({onComplete:function(c){var l="",d=i.getRealPath("assets/dataRightList.json",n.widget),h="GET",u="";2==a&&(u="passport"),2==a&&(l='{ "businessObject": '+t.encode(r)+"}",d=c+"/resources/pno/ownership/logicalaccess",h="POST"),headers={Accept:"application/json"},headers["Content-Type"]="application/json",headers["Accept-Language"]=widget.lang,headers.SecurityContext=encodeURIComponent(o),n.RightList=[];var p=i.getTenantID();p&&0!=p.length?d+="?tenant="+p:d+="?tenant=OnPremise",i.partitionedAuthenticatedRequest(d,{type:"json",method:h,headers:headers,proxy:u,cancelCallback:function(){return!1},partisionedProgressLabel:s.get("AR_DeterminingAccessRights"),progressBarContext:n.options.contextArea1,progressBarWaitContext:n.options.progressBarWaitContext,data:l,timeout:864e5,onComplete:function(t){n._onCompleteGetAccessListForIds(t,e)},onFailure:function(e,t,i){n._onFailure(e,t,i)},onTimeout:function(){n._onTimeout()}})},serverUrl:n.options.serverUrl,wintop:n.options.wintop})},function(e){onError(e)})},_onCompleteGetAccessListForIds:function(e,n){var r=this;if(1==e.success){var o={Accept:"application/json","Content-Type":"application/json"};r.RightList=[];var c=i.getRealPath("assets/dataUserStandAlone.json",r.widget),l="GET",d="",h="";2==a&&(d="passport"),this._getSecurityContext(function(u){i.get3DSpaceUrlAsync({onComplete:function(p){if(2==a){r.options.serverName,r.options.serverUri;h='{ "businessObject": '+t.encode(n)+"}",c=p+"/resources/pno/ownership",l="POST"}var g=e.accessList,m=null,f=[],v=-1,A=-1;if(g.every(function(e,t){e.access.forEach(function(e){r.accessLogicalNlsMap[e.logical]=e.nls});var n=e.objectID,i=r.SelectedItemsMap[n],o=null;if(null!=i&&(o=i.type),r.AccessRightModelList.every(function(t,n){return A=n,t.getObjectType()!=o||(t.setRightList(e.access),itemFound=!0,!1)}),1==itemFound&&1==r.options.uniqueRightList){var s=!0;if(0==r.AccessRightModelList.length&&t>0&&v>=0?s=r._accessListSame(f[v].getRightList(),e.access):r.AccessRightModelList.length>0&&(s=r._accessListSame(r.AccessRightModelList[0].getRightList(),e.access)),0==s)return m={message:UWA.i18n("ErrorDismatchAccessList"),code:""},r.dispatchEvent("onError",m),r.dispatchEvent("onDataLoaded"),!1;v=A}return!0}),null==m){o["Accept-Language"]=widget.lang,o.SecurityContext=encodeURIComponent(u);var I=i.getTenantID();I&&0!=I.length?c+="?tenant="+I:c+="?tenant=OnPremise",i.partitionedAuthenticatedRequest(c,{type:"json",method:l,headers:o,proxy:d,cancelCallback:function(){return!1},partisionedProgressLabel:s.get("AR_RetrievingOwnershipInformation"),progressBarContext:r.options.contextArea1,progressBarWaitContext:r.options.progressBarWaitContext,data:h,timeout:864e5,onComplete:function(e){r._onCompleteDataList(e)},onFailure:function(e,t,n){r._onFailure(e,t,n)},onTimeout:function(){r._onTimeout()}})}},serverUrl:r.options.serverUrl,wintop:r.options.wintop})},function(e){onError(e)})}else e.hasOwnProperty("error")&&r.dispatchEvent("onError",e.error)},_getEmbeddedComponentList:function(e){var n=this,r="";this.options.serverName,this.options.serverUri,this.options.launchTransfer,this.caHeader;i.get3DSpaceUrlAsync({onComplete:function(e){var o={Accept:"application/json","content-type":"application/json"};o.SecurityContext=null!=n.securityContext?encodeURIComponent(n.securityContext):n.securityContext;var c=n.parseDataForRequest(n.SelectedItems);r=i.getRealPath("assets/transferOwnership.json",widget);var l="",d="GET",h="";2==a&&(r=e+"/resources/accessRightServices/ar/getEmbeddedAndAggregatedComponentDataList?admin=true",h="passport",d="PUT",l=t.encode({requests:c}));o["Accept-Language"]=widget.lang;var u=i.getTenantID();u&&(r+="&tenant="+u),i.partitionedAuthenticatedRequest(r,{type:"json",method:d,proxy:h,cancelCallback:function(){return!1},partisionedProgressLabel:s.get("AR_RetrievingEmbeddedObjects"),progressBarContext:n.options.contextArea1,progressBarWaitContext:n.options.progressBarWaitContext,headers:o,data:l,timeout:36e5,onComplete:function(e){n._listEmbeddedComponent(e)},onFailure:function(e,t,i){n._onFailure(e,t,i)},onTimeout:function(e){n._onTimeout()}})}})},parseDataForRequest:function(e){for(var t=[],n=0;n<e.length;n++)if(null!=e[n].physicalId){e[n].physicalId,e[n].category;t.push(e[n].physicalId)}return t},_listEmbeddedComponent:function(e){var t=[];if(e.results.length>0)for(var n=0;n<e.results.length;n++){e.results[n];if(!1===e.results[n].EmbeddedComponent)this.NonEmbeddedComponentList.push(e.results[n].physicalId);else if(!0===e.results[n].EmbeddedComponent)if(1==e.results[n].ECDataNotToTransfer){var i={physicalId:e.results[n].physicalId,project:e.results[n].project,organization:e.results[n].organization};this.ErrorExistingECAndAggrItemsMap[e.results[n].physicalId]=i}else if(0==e.results[n].ECDataNotToTransfer){i={physicalId:e.results[n].physicalId,project:e.results[n].project,organization:e.results[n].organization};this.ExistingECItemsMap[e.results[n].physicalId]=i}}this._bInitDatas=!0,this.AccessRightModelList.forEach(function(e){t.push({objectID:e.getObjectId()})}),this._getAccessListForIds(t)},_onCompleteDataList:function(e){var t=this;1==e.success?(e.ownershipVector.forEach(function(e){t.AccessRightModelList.every(function(t){return t.getObjectId()!=e.objectID||(t.setDataList(e.ownership),!1)})}),t.dispatchEvent("onDataLoaded")):e.hasOwnProperty("error")&&t.dispatchEvent("onError",e.error)},modifyDataWithSC:function(e,n,r){var o=this,c={Accept:"application/json","Content-Type":"application/json"};if(null!=r&&""!=r&&r.hasOwnProperty("SecurityContext")){0!=r.SecurityContext.indexOf("ctx::")&&"ctx::",c.SecurityContext=encodeURIComponent(r.SecurityContext);var l=o.getAggrItemList();if(e.length>0&&null!=l){var d=[],h=Object.keys(l);e.length>0&&h.forEach(function(t){var n={objectID:t,ownership:e[0].ownership};d.push(n),e.push(n)})}this.options.serverName,this.options.serverUri;for(var u=[],p=0;p<n.length;p++)u.indexOf(n[p])<0&&u.push(n[p]);i.get3DSpaceUrlAsync({onComplete:function(n){var l="POST",d="",h=i.getRealPath("assets/validModification.json",o.widget),p=t.encode({requests:u});2==a&&(d="passport");2==a&&(h=n+"/resources/accessRightServices/ar/getCompletedData",l="POST"),c["Accept-Language"]=widget.lang;var g=i.getTenantID();g&&0!=g.length?h+="?tenant="+g:h+="?tenant=OnPremise",i.partitionedAuthenticatedRequest(h,{type:"json",method:l,proxy:d,headers:c,cancelCallback:function(){return!1},partisionedProgressLabel:s.get("AR_FindingRelatedObjects"),progressBarContext:o.options.contextArea2,progressBarWaitContext:o.options.progressBarWaitContext,data:p,timeout:864e5,onComplete:function(t){if(null!=t.results[0].invalidList&&t.results[0].invalidList.length>0){t.results[0].invalidList.forEach(function(t){void 0!==o.SelectedItemsMap[t]&&null!==o.SelectedItemsMap[t]&&(o.ErrorExistingECAndAggrItemsMap[t]=o.SelectedItemsMap[t]);for(var n=0;n<e.length;n++)e[n].objectID===t&&e.splice(n,1)})}else if(null!=t.results[0].validList&&t.results[0].validList.length>0){var n=[];n=t.results[0].validList,expandedOwnershipItems=[],n.forEach(function(t){null!=o.SelectedItemsMap[t]&&null!==o.SelectedItemsMap[t]||null!=o.AggrItemsMap[t]&&null!==o.AggrItemsMap[t]||e.length>0&&expandedOwnershipItems.push({objectID:t,ownership:e[0].ownership})}),expandedOwnershipItems.forEach(function(t){e.push(t)})}o.getAndAddAggregatedItemsForUpdate(e,r)},onFailure:function(e,t,n){o._onFailure(e,t,n)},onTimeout:function(){o._onTimeout()}})},serverUrl:o.options.serverUrl,wintop:o.options.wintop})}else{var g={message:UWA.i18n("ErrorSecurityContextEmpty"),code:"ERROR"};o.dispatchEvent("onError",g)}},getAndAddAggregatedItemsForUpdate:function(e,n){for(var r=this,o=[],c=0;c<r.NonEmbeddedComponentList.length;c++)o.indexOf(r.NonEmbeddedComponentList[c])<0&&o.push(r.NonEmbeddedComponentList[c]);var l={Accept:"application/json","Content-Type":"application/json"};if(null!=n&&""!=n&&n.hasOwnProperty("SecurityContext")){0!=n.SecurityContext.indexOf("ctx::")&&"ctx::",l.SecurityContext=encodeURIComponent(n.SecurityContext);this.options.serverName,this.options.serverUri;i.get3DSpaceUrlAsync({onComplete:function(c){var d="GET",h="",u=i.getRealPath("assets/validModification.json",r.widget);2==a&&(h="passport");2==a&&(u=c+"/resources/accessRightServices/ar/getAggrList",d="PUT");var p=t.encode({requests:o});l["Accept-Language"]=widget.lang;var g=i.getTenantID();g&&0!=g.length?u+="?tenant="+g:u+="?tenant=OnPremise",i.partitionedAuthenticatedRequest(u,{type:"json",method:d,proxy:h,headers:l,cancelCallback:function(){return!1},responseArray:function(e){return e.results.aggrItems},responseArrayMerge:function(e,t){return e.results.aggrItems=t,e},partisionedProgressLabel:s.get("AR_FindingAgregateItems"),progressBarContext:r.options.contextArea2,progressBarWaitContext:r.options.progressBarWaitContext,data:p,timeout:864e5,onComplete:function(t){if(null!==t.results.aggrItems&&t.results.aggrItems.length>0){var i=[];i=t.results.aggrItems,expandedOwnershipItems=[],i.forEach(function(t){null!=r.SelectedItemsMap[t.physicalId]&&null!==r.SelectedItemsMap[t.physicalId]||e.length>0&&expandedOwnershipItems.push({objectID:t.physicalId,ownership:e[0].ownership})}),expandedOwnershipItems.forEach(function(t){e.push(t)})}r.commitWithSCPCS(e,n)},onFailure:function(e,t,n){r._onFailure(e,t,n)},onTimeout:function(){r._onTimeout()}})},serverUrl:r.options.serverUrl,wintop:r.options.wintop})}else{var d={message:UWA.i18n("ErrorSecurityContextEmpty"),code:"ERROR"};this.setError(d)}},commitWithSCPCS:function(e,n){var r=this,o={Accept:"application/json","Content-Type":"application/json"};if(null!=n&&""!=n&&n.hasOwnProperty("SecurityContext")){0!=n.SecurityContext.indexOf("ctx::")&&"ctx::",o.SecurityContext=encodeURIComponent(n.SecurityContext);this.options.serverName,this.options.serverUri;this._getSecurityContext(function(n){i.get3DSpaceUrlAsync({onComplete:function(c){var l="",d=i.getRealPath("assets/validModification.json",r.widget);2==a&&(l="passport"),2==a&&(d=c+"/resources/pno/ownership/update");var h='{ "ownershipVector": '+t.encode(e)+"}";console.log("<<<<<<<<<<< Data to send = "+h);var u={ov:e};r.dispatchEvent("fireWintopNotif",u),o["Accept-Language"]=widget.lang,o.SecurityContext=encodeURIComponent(n);var p=i.getTenantID();p&&0!=p.length?d+="?tenant="+p:d+="?tenant=OnPremise",i.partitionedAuthenticatedRequest(d,{type:"json",method:"POST",proxy:l,headers:o,cancelCallback:function(){return!1},partisionedProgressLabel:s.get("AR_UpdatingAccessRights"),progressBarContext:r.options.contextArea2,progressBarWaitContext:r.options.progressBarWaitContext,data:h,timeout:864e5,onComplete:function(e){!0===r._options.odtMode?null!==r.options.parent&&r.options.parent.ODTModificationComplete(e):r.dispatchEvent("onModificationComplete",e)},onFailure:function(e,t,n){r._onFailure(e,t,n)},onTimeout:function(){r._onTimeout()}})},serverUrl:r.options.serverUrl,wintop:r.options.wintop})},function(e){onError(e)})}else{var c={message:UWA.i18n("ErrorSecurityContextEmpty"),code:"ERROR"};this.setError(c)}},getSelectedItemList:function(){return this.SelectedItems},getErrorSelectedItemList:function(){return this.ErrorExistingECAndAggrItemsMap},getAggrItemList:function(){return this.AggrItemsMap}})}),define("DS/AccessRightWidget/AccessRightWidget",["UWA/Core","UWA/Controls/Input","UWA/Controls/Abstract","UWA/Json","DS/WAFData/WAFData","DS/SearchWidget/SearchWidget","DS/SearchWidget/SearchWidgetConstant","DS/ErrorWidget/ErrorWidget","DS/DataGridWidget/DataGridWidget","DS/WidgetServices/WidgetServices","DS/WidgetServices/securityContextServices/SecurityContextServices","DS/WarningWidget/WarningWidget","DS/AccessRightWidget/AccessRightController","DS/UIKIT/Input/Button","DS/UIKIT/Input/Select","DS/UIKIT/Spinner","DS/UIKIT/Input/ButtonGroup","DS/Logger/Logger","DS/WebToWinInfra/WebToWinCom","DS/Controls/Toggle","DS/UIKIT/Input/Text","css!DS/AccessRightWidget/AccessRightWidget.css","i18n!DS/AccessRightWidget/assets/nls/langAR"],function(e,t,n,i,r,o,s,a,c,l,d,h,u,p,g,m,f,v,A,I,y,C,S){"use strict";UWA.debug=!0;var R=l.getProdLevel();return n.extend({defaultOptions:{className:"",ForbiddenChar:'"#$@%*,?\\<>[]|:',setValidButton:!0,setCloseButton:!0,showTopBar:!0,wintop:!1,topClassHeight:"AR_MasterContain",readOnly:"auto",displayWarningForAutoRO:!1,serverName:"",serverUri:"",activeMultisel:!0,activeComment:!1,serverUrl:""},init:function(e,t,n){if(this._parent(n),1==this.options.wintop&&(this.webToWinCom_Socket=A.createSocket({socket_id:"webinwinAccessRights_socket_"+Math.floor(1e5*Math.random()+1)}),void 0!==this.options.serverUrl&&this.options.serverUrl.length>0&&void 0!==this.options.serverUrl[0].platformId)){var i=this.options.serverUrl[0].platformId;l.setTenantID(i)}this.isODT=!1,void 0!==typeof this.options&&null!==this.options&&this.options.hasOwnProperty("odtmode")&&(this.isODT=this.options.odtmode),R=l.getProdLevel(),this.options.activeMultisel=this.options.activeMultisel||l.isMultiSelODT(),this.options.activeComment=this.options.activeComment||l.isCommentODT(),this._initDataStructures(),this.isReadOnly=!1,this.listID=[],this.listOfIds=[],this.arDone=!1,!0===this.options.readOnly&&(this.isReadOnly=!0),this.widget=e,this.parentWidget=t,this.initUI()},_initDataStructures:function(){this.objectIds={},this.listOfError=[],this.SelectedItemsWithEC=[],this.ctxObjectIds=[],this.SelectedItems=[],this.dumpSection=null,this.firstInit=!0,this.addUserMultipleSelection=!1,this.arDone=!1,this._bAddUserError=!1,this.listInputErrors=[],this.listInvalidPovOwnerErrorMsg=[],this.listInvalidPovCollabSpaceErrorMsg=[],this.containsInheritedAccess=!1,this.csoTableLines=[]},createWebInWinSocket:function(e){return A.createSocket({socket_id:e+Math.floor(1e5*Math.random()+1)})},fireWintopCommand:function(e,t,n){var i=n+"\n",r="";if("onModificationAccessRights"===n){var o=null;t.hasOwnProperty("ov")&&(o=t.ov),o.forEach(function(e,t){if(e.hasOwnProperty("ownership")){var n=e.objectID;r=n,e.ownership.forEach(function(e,t){var n,r=e.operation,o=e.access.logical;e.owner.hasOwnProperty("person")?n=e.owner.person.personID:e.owner.hasOwnProperty("collabSpace")&&(n=e.owner.collabSpace.collabSpaceID),i=i+" "+r+" "+o+" "+n+"\n"})}})}var s={severity:"warning",ID:r,message:i},a=A.createJSONArrayMessage(n,s);a.length>0&&e.dispatchEvent("onDispatchToWin",{notif_name:"onDisplayMessageODT",notif_parameters:a},"lf_web_in_win")},onResize:function(){this.resizeSearchLine(),this.csoTable.resizeTable(),this.table.resizeTable()},initData:function(e){var t={wintop:this.options.wintop,serverUrl:this.options.serverUrl};d.getInstance(t).getSecurityContext(),this.SelectedItems=[],this._initDataStructures(),this.AccessRightController.onLoad(),1==this.options.wintop&&this.options.readOnly,this.addDataPCS(e),this.getPrivateProjectList()},initDatafromWin:function(e){this.initData(e)},getBottomBar:function(){return this.getTopBar()},isPovOwner:function(e,t){if(t.hasOwnProperty("person")){var n=t.person.personID,i=this.AccessRightController.isPovOwner(e,n);return console.log("IsPovOwner.... of "+e+"---- Selected Person "+n+"/n"),i}return!1},isPovCollabSpace:function(e,t){if(t.hasOwnProperty("collabSpace")&&t.hasOwnProperty("organization")){var n=t.collabSpace.collabSpaceID,i=t.organization.orgID;return this.AccessRightController.isPovCollabSpace(e,n,i)}return!1},isPovUserGrp:function(e,t){if(t.hasOwnProperty("group")){var n=t.group.groupURI;return i=this.AccessRightController.isPovUserGroup(e,n)}if(null!==t&&t.hasOwnProperty("userGrp")){n=t.userGrp.id;var i=this.AccessRightController.isPovUserGroup(e,n)}return i},validateNotPovOwner:function(e,t,n,i){if(this.isPovOwner(e,t)){var r=t.person.personFullName;i(UWA.i18n("povOwner").format(r))}else n()},validateNotPovCollabSpace:function(e,t,n,i){if(this.isPovCollabSpace(e,t)){var r=t.organization.orgID+" / "+t.collabSpace.collabSpaceID;i(UWA.i18n("povCollabSpace").format(r))}else{if(this.isPovUserGrp(e,t))i(UWA.i18n("povCollabSpace").format(r));else n()}},validateNotPovUserGrp:function(e,t,n,i){(t.hasOwnProperty("userGrp")&&(t.group={groupURI:t.userGrp.id,groupTitle:t.userGrp.label},delete t.userGrp),this.isPovUserGrp(e,t.group.groupURI))?i(UWA.i18n("povCollabSpace").format(selectedCollabSpace)):n()},validateInput:function(e,t){var n=this;n._bAddUserError=!1,n.listInputErrors=[],n.listInvalidPovOwnerErrorMsg=[],n.listInvalidPovCollabSpaceErrorMsg=[];for(var i=n.searchWidget.getNewOwner(),r=n.AccessRightController.getSelectedItemList(),o=r.length,s=0;s<o&&!1===n._bAddUserError;s++){var a=r[s].physicalId;n.validateNotPovOwner(a,i,function(){n.validateNotPovCollabSpace(a,i,function(){e()},t)},t)}null!=n.listInputErrors&&n.listInputErrors.length>0&&n.listInputErrors.length>0&&n.listInputErrors.length===o&&n.setError(n.listInputErrors[0])},onRefresh:function(){this.addData()},addData:function(e){var t=this;if(null==e&&(e=this.SelectedItems),"auto"==this.options.readOnly){var n={wintop:t.options.wintop,serverUrl:t.options.serverUrl};d.getInstance(n).getSecurityContext({onSuccess:function(n){t._testAvailability(e,n)},onFailure:function(e){t.setError(e)}})}else this._addData(e)},getPrivateProjectList:function(){var e=this,t={wintop:e.options.wintop,serverUrl:e.options.serverUrl};d.getInstance(t).getSecurityContext({onSuccess:function(t){e.getListOfPrivateCS(t)},onFailure:function(t){e.setError(t)}})},addDataPCS:function(e){var t=this;if(null==e&&(e=this.SelectedItems),"auto"==this.options.readOnly){var n={wintop:t.options.wintop,serverUrl:t.options.serverUrl};d.getInstance(n).getSecurityContext({onSuccess:function(n){t._testAvailability(e,n)},onFailure:function(e){t.setError(e)}})}else this._addDataPCS(e)},_addDataPCS:function(e){this._ManageValidButton(!1),this.hideMainErrorArea();var t=[],n=this;if(1==this.options.activeMultisel?(null!=e&&(t=e.slice()),l.removeDuplicate(t,function(e){return e.physicalId}),t.forEach(function(e){l.arrayContains(n.SelectedItems,e,function(e){return e.physicalId})<0&&n.SelectedItems.push(e)})):null!=e&&e.length>0&&(n.SelectedItems=[],n.SelectedItems.push(e[0]),t.push(e[0])),n.SelectedItems.length<=0)return n.table.clearAllLine(),1==this.options.wintop?this.showMainErrorArea(UWA.i18n("NoItemToDisplay")):this.showMainErrorArea(UWA.i18n("NoItemSelected")),this.hideMainLoadingArea(),this.hideMainComponent(),void n.dispatchEvent("onChangeSize");this.displayLoadingArea(),this.displayLoadingArea(),this.csoTable.clearAllLine();n.SelectedItems.length>0&&this.AccessRightController._fillAttributesOfSelectedItems(n.SelectedItems,function(e,t){if(0==e.completionData.validList.length)n.isReadOnly=!0,n.addError(UWA.i18n("ShareNotSupported")),n._updateReadOnlyDisplay();else{for(var i=0,r=0;r<e.results.length;r++)for(var o=e.results[r],s=0;s<n.SelectedItems.length;s++)o.physicalId===n.SelectedItems[s].physicalId&&(o.isPortConnection&&(i+=1),n.SelectedItems[s].owner=o.owner,n.SelectedItems[s].responsibleName=o.responsibleName,n.SelectedItems[s].Revision=o.Revision,n.SelectedItems[s].project=o.project,null==o.collabSpaceTitle?n.SelectedItems[s].collabSpaceTitle=o.project:n.SelectedItems[s].collabSpaceTitle=o.collabSpaceTitle,n.SelectedItems[s].organization=o.organization,n.SelectedItems[s].organizationTitle=o.orgTitle,n.SelectedItems[s].type=o.type,n.SelectedItems[s].typeDisplayName=o.typeDisplayName,n.SelectedItems[s].urlIcon=t+o.typeIcon,"gif"===n.SelectedItems[s].urlIcon.substr(n.SelectedItems[s].urlIcon.length-3,n.SelectedItems[s].urlIcon.length)&&(n.SelectedItems[s].urlIcon=n.SelectedItems[s].urlIcon.substr(0,n.SelectedItems[s].urlIcon.length-3)+"png"),n.SelectedItems[s].v_IsEmbeddedComponent=o["attribute[XCADEmbeddedCmp.V_IsEmbeddedComponent]"]);i===n.SelectedItems.length&&(n.isReadOnly=!0,n.addError(UWA.i18n("ShareNotSupported")),n._updateReadOnlyDisplay()),n.AccessRightController._fillModels(n.SelectedItems)}},function(e){}),n.csoTable.clearAllLine()},_getSecurityContext:function(e,t){d.getInstance().getSecurityContext({onSuccess:function(t){var n="";null!=t&&null!=t.SecurityContext&&0!=(n=t.SecurityContext).indexOf("ctx::")&&(n="ctx::"+n),e(n)},onFailure:function(e){t(e)}})},hideElements:function(e,t){for(var n=e.getElements(t),i=n.length,r=0;r<i;r++){n[r].hide()}},showElements:function(e,t){for(var n=e.getElements(t),i=n.length,r=0;r<i;r++){n[r].show()}},destroy:function(){this.searchWidget&&this.searchWidget.destroy(),this._parent()},initUI:function(){var e=this,n=this.container=UWA.createElement("div",{name:"AR_MasterContain","data-rec-id":"AR_MasterContain",class:"AR_MasterContain "+e.options.className});this.globalDiv=UWA.createElement("div",{class:"AR_GlobalContain","data-rec-id":"datarecGlobalContain"}).inject(n);var i="AR_ManageButtonDiv";this.options.wintop&&(i="AR_ManageButtonDivWintop"),this.ManageButtonDiv=UWA.createElement("table",{class:i,"data-rec-id":"datarecManageButtonDiv",html:{}}),e.ManageButtonRight=UWA.createElement("td",{class:"AR_ManageButtonRight","data-rec-id":"datarecManageButtonRight"}),e.ManageButtonLeft=UWA.createElement("td",{class:"AR_ManageButtonLeft","data-rec-id":"datarecManageButtonLeft"});var r=null,c=null;e.boutonValid=new p({attributes:{title:UWA.i18n("")},name:"TopButtonValid",value:UWA.i18n("AR_Valid"),className:"default medium AR_buttonTop primary",disabled:!0});var l=e.boutonValid.getContent();null!=l&&l.setAttribute("data-rec-id","boutonValid"),r=new p({attributes:{title:UWA.i18n("AR_Reload"),"data-rec-id":"datarecButtonRefresh"},name:"TopButtonRefresh",value:"",className:"default medium AR_buttonTop",icon:"ccw"}),c=new p({attributes:{title:UWA.i18n(""),"data-rec-id":"datarecButtonCancel"},name:"TopButtonCancel",value:UWA.i18n("AR_CloseOverlay"),className:"default medium AR_buttonTop"}),e.boutonValid.addEvents({onClick:function(){e._ManageValidButton(!1),e.displayLoadingArea(),e.modifyDataPCS(),c.setValue(UWA.i18n("AR_Close"))}}),r.addEvents({onClick:function(){e.onRefresh()}}),c.addEvents({onClick:function(){e.table.clearAllLine(),e._ManageValidButton(!1),e.dispatchEvent("onCancel")}}),0==this.isReadOnly&&1==e.options.setValidButton&&e.boutonValid.inject(e.ManageButtonRight),1==e.options.setCloseButton&&c.inject(e.ManageButtonRight),e.ManageButtonLeft.inject(this.ManageButtonDiv),e.ManageButtonRight.inject(this.ManageButtonDiv),e.options.showTopBar&&this.ManageButtonDiv.inject(e.globalDiv),e.mainInterface=UWA.createElement("div",{class:"AR_MainInterface","data-rec-id":"datarecMainInterface"}).inject(this.globalDiv).hide(),e.mainLoading=UWA.createElement("div",{class:"AR_MainLoading","data-rec-id":"datarecMainLoading"}).inject(this.globalDiv),e.mainError=UWA.createElement("div",{class:"AR_MainError","data-rec-id":"datarecMainError"}).inject(this.globalDiv).hide(),e.csoTableContainer=UWA.createElement("div",{class:"AR_CSOTableContainer","data-rec-id":"datarecinitialItemsList"}),e.csoTableContainer.inject(e.mainInterface),e.csoTable=this.createInitialSelectedTable(),e.csoTable.inject(this.csoTableContainer),e.loadingArea32=UWA.createElement("div",{class:"AR_MAINProgressBar","data-rec-id":"datarecidmainprogress"}),e.loadingArea32.inject(e.mainLoading);var d=null;(d=new p({attributes:{title:UWA.i18n("AR_AddUser")},value:"",name:"addUserButton",className:"default medium AR_addUser",icon:"user-add"})).getContent().setAttribute("data-rec-id","dataRecAddUser"),d.elements.icon.setAttribute("data-rec-id","dataRecAddUserIcon"),d.addEvents({onClick:function(){e.validateInput(function(){e.AddUser(),e._bAddUserError=!1,e.dispatchEvent("onChangeSize"),e._ManageValidButton(!0)},function(t){if(e.searchWidget.clearInput(),!1===e._bAddUserError){var n={code:"",message:t};e.setError(n)}!1===e._bAddUserError&&(e._bAddUserError=!0)}),e.searchWidget.clearInput()}});e.selectRightNewUser=new g({nativeSelect:!0,placeholder:!1}),e.selectRightNewUser.elements.container.setAttribute("data-rec-id","dataRecselectRightNewUserContainer"),e.selectRightNewUser.elements.content.setAttribute("data-rec-id","dataRecselectRightNewUser"),e.TextComment=new t.Text({text:"",className:"AR_commentText",attributes:{placeholder:UWA.i18n("PutComments")}}),e.TextComment.elements.container.setAttribute("data-rec-id","dataRecComments");var h=e.options.ForbiddenChar;e.searchWidget=o.getSearchWidget(o.RESTRICTED,{className:"searchPeople_AccessRights",ForbiddenChar:h,MaxNumber:"5",MaxSize:"300",topClassHeight:e.options.topClassHeight,position:"auto",serverName:this.options.serverName,serverUri:this.options.serverUri,serverUrl:this.options.serverUrl,exttype:s.EXTTYPE_USERGRP,showEmptyCategory:!1,events:{onValid:function(){e.searchRight.show(),e.searchAdd.show(),1==e.options.activeComment&&e.searchComment.show(),e.dispatchEvent("onChangeSize"),e.resizeSearchLine()},onUnvalid:function(){e.searchRight.hide(),e.searchAdd.hide(),1==e.options.activeComment&&e.searchComment.hide(),e.dispatchEvent("onChangeSize"),e.resizeSearchLine()},onError:function(t){e.setError(t)}}}),e.tableSearch=UWA.createElement("table",{name:"AR_TableSearch",class:"AR_TableSearch table","data-rec-id":"datarecTableSearch",html:""});var m=new UWA.createElement("tbody").inject(e.tableSearch),f=UWA.createElement("tr",{class:"AR_DivSearch","data-rec-id":"datarecDivSearch"}),v=UWA.createElement("td",{name:"SearchInputCell",class:"AR_SearchInputColumn AR_SpanNew","data-rec-id":"datarecSearchInputCell",html:""});e.searchWidget.inject(v),e.searchRight=UWA.createElement("td",{class:"AR_NewSelectRightColumn AR_SpanNew","data-rec-id":"datarecSelectRightColumnSpanNew",html:""}).hide(),e.selectRightNewUser.inject(e.searchRight),e.searchAdd=UWA.createElement("td",{class:"AR_AddUserColumn AR_SpanNew","data-rec-id":"datarecAddUserColumnSpanNew",html:""}).hide(),d.inject(e.searchAdd),1==e.options.activeComment&&(e.searchComment=UWA.createElement("td",{class:"AR_NewComment AR_SpanNew","data-rec-id":"datarecNewCommentColumnSpanNew",html:""}).hide(),e.TextComment.inject(e.searchComment)),v.inject(f),e.searchRight.inject(f),1==e.options.activeComment&&e.searchComment.inject(f),e.searchAdd.inject(f),f.inject(m),this.moreButton=new UWA.createElement("a",{html:UWA.i18n("More")+"&rsaquo;",class:"AR_advancedSwitch","data-rec-id":"datarecMoreAdvancedSwitchSpanNew",name:"AR_AdvButton",events:{click:function(t){e.moreButton.hide(),e.lessButton.show(),e.currentMode=e.lessButton,e.manageAdvancedMode()}}}),this.lessButton=new UWA.createElement("a",{html:"&lsaquo;"+UWA.i18n("Less"),class:"AR_advancedSwitch","data-rec-id":"datarecLessAdvancedSwitchSpanNew",name:"AR_SimpleButton",events:{click:function(t){e.lessButton.hide(),e.moreButton.show(),e.currentMode=e.moreButton,e.manageAdvancedMode()}}}).hide(),0==this.isReadOnly&&e.tableSearch.inject(e.mainInterface),this.tableContainer=UWA.createElement("div",{class:"AR_tableContainer","data-rec-id":"datarectableContainer"}),e.table=e.createTable(),e.table.inject(this.tableContainer),this.tableContainer.inject(e.mainInterface),e.errorOverlay=new a(e.widget,e.container,{className:"errorComponent_AccessRight","data-rec-id":"datarecErrorComponentAccessRight"}),this.AccessRightController=new u(e.widget,{uniqueRightList:!this.isReadOnly,serverName:this.options.serverName,wintop:this.options.wintop,serverUri:this.options.serverUri,serverUrl:this.options.serverUrl,isReadOnly:this.isReadOnly,odtMode:this.isODT,parent:this,contextArea1:this.loadingArea32,contextArea2:this.ManageButtonLeft,progressBarWaitContext:e.container,events:{onError:function(t){e.hideFailMainLoadingArea(),e.addError(t)},onDataLoaded:function(){if(null!=e.container.getParent()){e.hideMainLoadingArea();var t=e.AccessRightController.getFormattedRightList();e.selectRightNewUser.add(t,!0),t.length>0&&e.selectRightNewUser.setValue(t[0]);var n=e.selectRightNewUser.elements.container.childNodes[0].childNodes;if(n.forEach)n.forEach(function(e,t){e.setAttribute("data-rec-id","dataRecComboRightsValue"+t)});else Array.prototype.slice.call(n).forEach(function(e,t){e.setAttribute("data-rec-id","dataRecComboRightsValue"+t)});var i=e.AccessRightController.getFusionOwnership();e.AddDataInTable(i),e.AddSelectedItemsInTable(),e.searchWidget.setSelectedItemList(e.AccessRightController.getCurrentSelectedItems()),!0===e.firstInit&&(e.dispatchEvent("onFirstBuild"),e.firstInit=!1),e.onResize()}},onModificationComplete:function(t){for(var n=e.table.getAllLine(),i=0;i<n.length;i++){var r=n[i],o=e.table.getCellContent(r,"Id");if(null!=o&&""!=o){var s=e.table.getCellValue(r,"ComboRights");e.getOwnerElementFromID(o).InitRights=s}}e.hideLoadingArea(),e.showNotificationInTable(t),e.addErrorAfterOperation(e,t),e._ManageValidButton(!1)},fireWintopNotif:function(t){!0===e.options.wintop&&e.fireWintopCommand(e.webToWinCom_Socket,t,"onModificationAccessRights")}}}),this._ManageValidButton()},_updateReadOnlyDisplay:function(){1==this.isReadOnly?(null!=this.tableSearch&&this.tableSearch.hide(),null!=this.boutonValid&&this.boutonValid.hide()):(null!=this.tableSearch&&this.tableSearch.show(),null!=this.boutonValid&&this.boutonValid.show())},_ManageValidButton:function(e){var t=this.createJSONArrayModif(),n=e;null!=e&&void 0!==typeof e||(n=t.length>0),n?this.boutonValid.setDisabled(!1):this.boutonValid.setDisabled(!0)},getTopBar:function(){return this.ManageButtonDiv},resizeSearchLine:function(){if(null!=this.tableSearch){var e=this.tableSearch.getElements("td");e.forEach(function(e){"none"!=e.getStyle("display")&&e.setStyle("display","table-cell")});var t=this.tableSearch.getSize(),n=this.globalDiv.getSize();t.width>n.width&&e.forEach(function(e){"none"!=e.getStyle("display")&&e.setStyle("display","inline-block")})}},getNewIDLine:function(){for(var e=!0,t=this.listID.length;1==e;)t++,e=!1,this.listID.forEach(function(n){t==n.Id&&(e=!0)});return t},getNewIDItem:function(){for(var e=!0,t=this.SelectedItems.length;1==e;)t++,e=!1,this.SelectedItems.forEach(function(n){t==n.index&&(e=!0)});return t},getOwnershipContainerFromID:function(e){var t=null;return this.listID.forEach(function(n){e==n.Id&&(t=n.OwnershipContainer)}),t},getOwnerElementFromID:function(e){for(var t=0;t<this.listID.length;t++){var n=this.listID[t];if(n.Id==e)return n}return null},getPositionFromId:function(e){var t=null;return this.listID.forEach(function(n,i){e==n.Id&&(t=i)}),t},showNotificationInTable:function(e){for(var t=JSON.parse("[]"),n=this.csoTable.getAllLine(),i=n.length,r=0;r<i;r++)null!=n[r]&&(t[n[r].getElementsByClassName("Id")[0].innerHTML]=n[r]);var o=this.AccessRightController.getErrorSelectedItemList();JSON.parse("[]");if(e&&e.ownershipVector)for(var s=e.ownershipVector.length,a=0;a<s;a++){var c=e.ownershipVector[a];if(c){var l=c.ownership,d="access right success",h=!1;0==this.isODT&&(d=S.get("accessRightSuccess"));for(var u=0;u<l.length;u++){var p=l[u];if(p.hasOwnProperty("result")){d="access right failure",0==this.isODT&&(d=p.result.message),h=!0;break}}h||null!=o[e.ownershipVector[a].objectID]&&null!=t[e.ownershipVector[a].objectID]&&(d="access right failure",0==this.isODT&&(d=S.get("accessRightFailure")));var g="syc-green-circle-symbol";h&&(g="syc-red-circle-symbol");var m=UWA.createElement("div",{class:g}),f=t[e.ownershipVector[a].objectID];null!=f&&(f.getElementsByClassName("Symbol")[0].appendChild(m),f.getElementsByClassName("Result")[0].innerHTML=d)}}},setError:function(e){"object"==typeof e&&"1500028"===e.code&&(e.message=UWA.i18n("ErrorNotAccessRight")),this.addError(e)},addError:function(e){this.errorOverlay.displayJSONError(i.encode(e))},hideAllAreas:function(){this.hideLoadingArea(),this.hideMainComponent()},displayLoadingArea:function(){},hideLoadingArea:function(){},displayMainInterfaceArea:function(){this.hideAllAreas(),null!=this.mainInterface&&this.mainInterface.show(),null!=this.boutonValid&&this.boutonValid.show()},hideMainComponent:function(){this.hideLoadingArea(),this.mainInterface.hide(),this.boutonValid.hide()},hideMainLoadingArea:function(){this.mainInterface.show(),this.boutonValid.show(),this.mainLoading.hide(),this._updateReadOnlyDisplay()},hideFailMainLoadingArea:function(){this.loadingArea32.hide(),this.mainLoading.hide()},hideMainErrorArea:function(){this.mainError.hide()},showMainErrorArea:function(e){null!=e&&""!=e&&(this.clearAllMainError(),this.addMainError(e)),this.mainError.show()},addMainError:function(e){new UWA.createElement("div",{text:e}).inject(this.mainError)},clearAllMainError:function(){this.mainError.setContent("")},manageAdvancedMode:function(e){this.currentMode==this.lessButton?(this.showElements(this.mainInterface,".inherit_From"),this.showElements(this.mainInterface,".inherit_Access"),1==this.options.activeComment&&this.showElements(this.mainInterface,".Comments")):(this.hideElements(this.mainInterface,".inherit_From"),this.hideElements(this.mainInterface,".inherit_Access"),1==this.options.activeComment&&this.hideElements(this.mainInterface,".Comments")),this.resizeTable()},addErrorAfterOperation:function(e,t){t.hasOwnProperty("error")&&e.setError(t.error),t.ownershipVector.forEach(function(t,n){t.hasOwnProperty("ownership")&&t.ownership.forEach(function(t,n){t.hasOwnProperty("result")&&e.setError(t.result)})})},ownerAlreadyExist:function(e){var t=[],n=!1;return this.listID.every(function(i,r){var o=i.OwnershipContainer.ownership.owner,s=i.Id;if(o.hasOwnProperty("person")||e.hasOwnProperty("person")){if(!o.hasOwnProperty("person")||!e.hasOwnProperty("person"))return!0;if(o.person.personID!=e.person.personID)return!0}if(o.hasOwnProperty("collabSpace")||e.hasOwnProperty("collabSpace")){if(!o.hasOwnProperty("collabSpace")||!e.hasOwnProperty("collabSpace"))return!0;if(o.collabSpace.collabSpaceID!=e.collabSpace.collabSpaceID)return!0}if(o.hasOwnProperty("organization")||e.hasOwnProperty("organization")){if(!o.hasOwnProperty("organization")||!e.hasOwnProperty("organization"))return!0;if(o.organization.orgID!=e.organization.orgID)return!0}if(o.hasOwnProperty("group")||e.hasOwnProperty("group")){if(!o.hasOwnProperty("group")||!e.hasOwnProperty("group"))return!0;if(o.group.groupURI!=e.group.groupURI)return!0}return(o.hasOwnProperty("comment")||e.hasOwnProperty("comment"))&&o.hasOwnProperty("comment")&&e.hasOwnProperty("comment")&&o.comment==e.comment&&(n=!0),t.push({Index:r,Id:s,IsSame:n}),!0}),t},modifyDataPCS:function(){var e=this,t=e.createJSONArrayModif(),n=[],i=new Array,r=e.AccessRightController.getSelectedItemList(),o=e.AccessRightController.getErrorSelectedItemList();if(o.length!==r.length){var s=[];r.forEach(function(e){null==o[e]&&s.push(e)}),s.forEach(function(r,o){var s=new Array;r.hasOwnProperty("embeddedComp")&&!0===r.embeddedComp||(t.forEach(function(t){var n=t.operation,i=e.AccessRightController.getOwner(r.physicalId,n.owner),o=e.AccessRightController.isInherited(r.physicalId,n.owner),a=e.isPovOwner(r.physicalId,n.owner);o||a||(null!=i&&("MODIFY"==t.action?0==t.isTrueComment&&(n.owner=i):"ADD"==t.action?n.owner.comment!=i.comment&&s.push({operation:"REMOVE",owner:i,access:{logical:"empty"}}):"REMOVE"==t.action&&"REMOVE"==t.action&&0==t.isTrueComment&&(n.owner=i)),s.push(n))}),i.push(r.physicalId),n.push({objectID:r.physicalId,ownership:s}))});var a={wintop:e.options.wintop,serverUrl:e.options.serverUrl};d.getInstance(a).getSecurityContext({onSuccess:function(t){e.AccessRightController.modifyDataWithSC(n,i,t)},onFailure:function(t){e.setError(t)}})}},modifyDataWithSC:function(e,t,n){var r=this,o={Accept:"application/json","Content-Type":"application/json"};if(null!=n&&""!=n&&n.hasOwnProperty("SecurityContext")){0!=n.SecurityContext.indexOf("ctx::")&&"ctx::",o.SecurityContext=encodeURIComponent(n.SecurityContext);this.options.serverName,this.options.serverUri;l.get3DSpaceUrlAsync({onComplete:function(s){var a="POST",c="",d=l.getRealPath("assets/validModification.json",r.widget),h={ownershipVector:e},u=JSON.stringify(h);S.get("AR_"),i.encode({requests:u});2==R&&(c="passport");h="";2==R&&(d=s+"/resources/accessRightServices/ar/completeInput",a="POST"),r.displayLoadingArea(),o["Accept-Language"]=widget.lang;var p=l.getTenantID();p&&0!=p.length?d+="?tenant="+p:d+="?tenant=OnPremise",l.partitionedAuthenticatedRequest(d,{type:"json",method:a,proxy:c,headers:o,partisionedProgressLabel:S.get("AR_RetrievingOwnership"),progressBarContext:r.loadingArea32,progressBarWaitContext:r.container,data:u,onComplete:function(i){r._getCompletedData(i,e,t,n)},onFailure:function(e,t,n){r._onFailure(e,t,n)},onTimeout:function(){r._onTimeout()}})},serverUrl:r.options.serverUrl,wintop:r.options.wintop})}else{var s={message:UWA.i18n("ErrorSecurityContextEmpty"),code:"ERROR"};this.setError(s)}},_onFailure:function(e,t,n,r,o,s){this.hideLoadingArea(),i.isJson(t)&&(t=i.decode(t));var a={};a=null!=t&&t.hasOwnProperty("error")?t.error:{message:UWA.i18n("AR_ErrorModification"),code:"ERROR"},this.setError(a)},_onTimeout:function(){this.hideLoadingArea();var e={message:UWA.i18n("ErrorTimeOut"),code:"TO"};this.setError(e)},getListOfPrivateCS:function(e){var t=this,n={Accept:"application/json","Content-Type":"application/json"};if(null!=e&&""!=e&&e.hasOwnProperty("SecurityContext")){0!=e.SecurityContext.indexOf("ctx::")&&"ctx::",n.SecurityContext=encodeURIComponent(e.SecurityContext);this.options.serverName,this.options.serverUri;l.get3DSpaceUrlAsync({onComplete:function(e){var o="",s=l.getRealPath("assets/availability.json",t.widget);2==R&&(o="passport"),2==R&&(s=e+"/resources/accessRightServices/ar/getPrivateProjectList");i.encode({requests:""});n["Accept-Language"]=widget.lang;var a=l.getTenantID();a&&0!=a.length?s+="?tenant="+a:s+="?tenant=OnPremise",r.authenticatedRequest(s,{type:"json",method:"GET",headers:n,proxy:o,data:"",onComplete:function(e){t._onCompletePrivateProjectList(e)},onFailure:function(e,n,i){t._onFailureAvailability(e,n,i)},onTimeout:function(){t._onTimeoutAvailability(items)}})},serverUrl:t.options.serverUrl,wintop:t.options.wintop})}else{var o={message:UWA.i18n("ErrorSecurityContextEmpty"),code:"ERROR"};this.setError(o)}},_testAvailability:function(e,t){var n=this,r={Accept:"application/json","Content-Type":"application/json"};if(null==t||""==t||!t.hasOwnProperty("SecurityContext")){var o={message:UWA.i18n("ErrorSecurityContextEmpty"),code:"ERROR"};return this.setError(o),this.isReadOnly=!0,this._updateReadOnlyDisplay(),void this._addDataPCS(e)}t.SecurityContext.indexOf("ctx::"),r.SecurityContext=encodeURIComponent(t.SecurityContext);var s=[],a=e.length;a>10&&(a=10);for(var c=0;c<a;c++){var d=e[c];s.push({objectID:d.physicalId,accessRight:[{access:{physical:"changesov"}}]})}this.options.serverName,this.options.serverUri;l.get3DSpaceUrlAsync({onComplete:function(t){var o="",a="GET",c="",d=l.getRealPath("assets/availability.json",n.widget);2==R&&(c="passport"),2==R&&(d=t+"/resources/pno/ownership/checkaccess",a="POST",o='{ "boAccessRights": '+i.encode(s)+"}"),r["Accept-Language"]=widget.lang;var h=l.getTenantID();h&&0!=h.length?d+="?tenant="+h:d+="?tenant=OnPremise";l.partitionedAuthenticatedRequest(d,{type:"json",method:a,proxy:c,partisionedProgressLabel:S.get("AR_CheckingAccess"),progressBarContext:n.loadingArea32,progressBarWaitContext:n.container,data:o,headers:r,onComplete:function(t){n.reponse=t;var i=l.getTenantID();n.AccessRightController._loadCredentials(i,function(r){n.AccessRightController.filterCredentials(i,r,"accessRight",function(i){i.length;0==i.length?(n.isReadOnly=!0,n.addError(UWA.i18n("ShareBlockedForCurrentResponsibility")),n._updateReadOnlyDisplay()):n._onCompleteAvailability(t,e)})})},onFailure:function(t,i,r){n._onFailureAvailability(t,i,r,e)},onTimeout:function(){n._onTimeoutAvailability(e)}})},serverUrl:n.options.serverUrl,wintop:n.options.wintop})},_onTimeoutAvailability:function(e){this.isReadOnly=!0,this.hideLoadingArea();var t={message:UWA.i18n("ErrorTimeOut"),code:"TO"};this.setError(t),this._updateReadOnlyDisplay(),this._addDataPCS(e)},_onFailureAvailability:function(e,t,n,r){this.isReadOnly=!0,this.hideLoadingArea();var o={};i.isJson(t)&&(t=i.decode(t)),o=null!=t&&t.hasOwnProperty("error")?t.error:{message:UWA.i18n("UnknownError"),code:"ERROR"},this.setError(o),this._updateReadOnlyDisplay(),this._addDataPCS(r)},_onCompletePrivateProjectList:function(e){e.hasOwnProperty("PrivateProjects")&&(this.listOfPrivateProjects=e.PrivateProjects.PrivateProjectList,this.searchWidget.options.PrivateProjectList=e.PrivateProjects.PrivateProjectList)},_onCompleteAvailability:function(e,t){var n=this;if(1==e.success){this.isReadOnly=!1;var i=0;if(e.hasOwnProperty("boAccessRights")){var r=e.boAccessRights;r.forEach(function(e){e.hasOwnProperty("accessRight")&&e.accessRight.forEach(function(r){if(r.hasOwnProperty("error")){i++;var o=r.error;o.type="warning";var s=UWA.i18n("an object");switch(t.every(function(t){t.physicalId==e.objectID&&t.hasOwnProperty("name")&&(s=t.name)}),o.code+""){case"1501603":o.message=UWA.i18n("Bad credential for {0}").format(s);break;case"1501601":o.message=UWA.i18n("Not the owner of {0}").format(s);break;case"1501602":o.message=UWA.i18n("No right on {0}").format(s)}!0===n.options.displayWarningForAutoRO&&n.addError(o),v.warn("Access right : "+o.message)}})});var o=r.length;o==i&&(n.isReadOnly=!0,t.length>o&&(n.isReadOnly=!1,n.addError(UWA.i18n("ErrorNoAccessToAtLeast10"))))}n._updateReadOnlyDisplay(),n._addDataPCS(t)}else{if(this.isReadOnly=!0,e.hasOwnProperty("error")){var s=e.error;s.message.contains("does not exist")?n.addError(UWA.i18n("AR_ObjectDoesNotExist")):n.addError(s)}this.hideMainLoadingArea()}},_manageTableHeader:function(){var e=this.tableContainer.getElement(".AR_mainTableHeader");null!==e&&(this.table.allIsHidden()?e.hide():e.show())},AddUser:function(){var e=this;if(!l.isProgressBusy()){var t=e.searchWidget.getNewOwner();if(null!==t&&""!==t){t.hasOwnProperty("userGrp")&&(t.group={groupURI:t.userGrp.id,groupTitle:t.userGrp.label},delete t.userGrp);e.SelectedItems.length;var n=e.selectRightNewUser.getValue(),i="";if(n.length>0){i=n[0];var r=e.TextComment.getValue();null!=r&&""!=r&&(t.comment=r);var o=this.ownerAlreadyExist(t),s="";if(o.length>0){var a=!0,c=!1,d=o[0],h=!1;if(o.forEach(function(t){var n=e.table.getCellsContent({Id:t.Id},"ComboRights");0!=n.length&&null!=n[0]&&""!=n[0]&&(h=!0),1==t.IsSame&&(d=t)}),0==h){c=!0;var u=this.getOwnerElementFromID(d.Id).InitRights;0==d.IsSame?(c=!1,0!=u.length&&null!=u[0]&&""!=u[0]||(c=!0),a=!1):0!=u.length&&null!=u[0]&&""!=u[0]&&(s=u[0])}if(1==c&&(this.table.removeLine({Id:d.Id}),this.listID.splice(d.Index,1),a=!1),1==a){var p={code:"",message:e.getNameUserFromOwner(t).name+" "+UWA.i18n("alreadyExists")};return void this.listInputErrors.push(p)}}var g={ownership:{InitRights:s,operation:"ADD",owner:t,access:{logical:i}},isTrueComment:!0,isTrueInheritedPath:!0},m=e.AddOwnershipInTable(g);null!=m&&(e.table.AddDataInTable(m),e.manageAdvancedMode()),this._manageTableHeader(),this._ManageValidButton(),this.onResize()}}}},DeleteUser:function(e){if(!l.isProgressBusy()){var t=parseInt(e),n=this.getOwnerElementFromID(t).InitRights;if(0==n.length||null==n[0]||""==n[0]){this.table.removeLine({Id:t});var i=this.getPositionFromId(t);this.listID.splice(i,1)}else this.table.HideLine({Id:t},!0),this.table.clearCell({Id:t},"ComboRights");this._manageTableHeader(),this._ManageValidButton()}},getNameUserFromOwner:function(e){var t=null,n="",i=-1;if(e.hasOwnProperty("person"))n=e.person.personLastName+" "+e.person.personFirstName,i=1;else{var r=!1;e.hasOwnProperty("organization")&&(r=!0,n=e.organization.orgTitle),e.hasOwnProperty("collabSpace")&&(1==r&&(n+=" / "),n+=e.collabSpace.collabSpaceTitle),e.hasOwnProperty("group")&&(n=e.group.groupTitle),i=2}return i>0&&(t={name:n,type:i}),t},createInitialSelectedTable:function(){var e;return 1==this.isODT?("Title","Revision","Organization","Collaborative Space","Responsible","Result",(e=new c([{text:"PhysicalID",dataIndex:"Id",sortKey:function(e){return e},sortable:!0},{text:"",dataIndex:"Symbol",sortKey:function(e){return e},sortable:!0},{text:"Title",dataIndex:"Title",sortKey:function(e){return e},sortable:!0},{text:"Revision",dataIndex:"Revision",sortKey:function(e){return e},sortable:!0},{text:"Organization",dataIndex:"Organization",sortKey:function(e){return e},defaultSort:!0,sortable:!0},{text:"Collaborative Space",dataIndex:"CollaborativeSpace",sortKey:function(e){return e},defaultSort:!0,sortable:!0},{text:"Responsible",dataIndex:"Responsible",sortKey:function(e){return e},defaultSort:!0,sortable:!0},{text:"Result",dataIndex:"Result",sortKey:function(e){return e},sortable:!0}],{className:"AR_csoTable",activeSelection:!1,setScroller:!0,useNativeScroller:!0,maxHeightScroller:""})).getContent().setAttribute("data-rec-id","dataRecInitialSelectedGridAccess"),e):((e=new c([{text:"PhysicalID",dataIndex:"Id",sortKey:function(e){return e},sortable:!0},{text:"",dataIndex:"Symbol",sortKey:function(e){return e},sortable:!0},{text:UWA.i18n("AR_Title"),dataIndex:"Title",sortKey:function(e){return e},sortable:!0},{text:UWA.i18n("AR_Type"),dataIndex:"Type",sortKey:function(e){return e},sortable:!0},{text:UWA.i18n("AR_Revision"),dataIndex:"Revision",sortKey:function(e){return e},sortable:!0},{text:UWA.i18n("AR_Sum_Org"),dataIndex:"Organization",sortKey:function(e){return e},defaultSort:!0,sortable:!0},{text:UWA.i18n("AR_Sum_Collab"),dataIndex:"CollaborativeSpace",sortKey:function(e){return e},defaultSort:!0,sortable:!0},{text:UWA.i18n("AR_Sum_Resp"),dataIndex:"Responsible",sortKey:function(e){return e},defaultSort:!0,sortable:!0},{text:UWA.i18n("AR_Result"),dataIndex:"Result",sortKey:function(e){return e},sortable:!0}],{className:"AR_csoTable",activeSelection:!1,setScroller:!0,useNativeScroller:!0,maxHeightScroller:""})).getContent().setAttribute("data-rec-id","dataRecInitialSelectedGridAccess"),e)},createSelectedTable:function(){var e=new c([{text:UWA.i18n("Id"),dataIndex:"Id",sortKey:function(e){return e}},{text:"",dataIndex:"AR_IconItem"},{text:"",dataIndex:"AR_SelectedName",sortKey:function(e){return e.getText()},defaultSort:!0,sortable:!0}],{name:"AR_tableSelected",className:"AR_tableSelected",setHeaderColumn:!1,setScroller:!1});return e.getContent().setAttribute("data-rec-id","dataRecGridAccess"),e},createInitialSelNewLineItem:function(e,t){var n=this.getNewIDItem();return this.SelectedItemsWithEC[t].index=n,{Id:n,Symbol:"",Title:e.title,Revision:e.revision,Organization:e.org,CollaborativeSpace:e.project,Responsible:e.owner,Result:""}},createTable:function(){var e=this,t="",n="";1==this.isReadOnly&&(t=this.moreButton,n=this.lessButton);var i="User_CS";this.options.wintop&&(i="User_only");var r=new c([{text:UWA.i18n("Id"),dataIndex:"Id",sortKey:function(e){return e}},{text:UWA.i18n(i),dataIndex:"UserName",sortKey:function(e){return e.getElement(".AR_UserName").getText()},defaultSort:!0,sortable:!0},{text:UWA.i18n("AR_Rights"),html:t,dataIndex:"ComboRights",sortKey:function(t){if(1==e.isReadOnly)return t;var n="";if("object"==typeof t)if(3===t.nodeType)n=t.textContent;else{var i=t.getSelection(!1);i.length>0&&("Can Edit"==(n=i[0].attributes[0].value)?n="Author":"Can Read"==n?n="Reader":"Can Manage"==n&&(n="Owner"))}return n},sortable:!0},{text:UWA.i18n("InheritedFrom"),dataIndex:"inherit_From",sortKey:function(e){return e},sortable:!0},{text:UWA.i18n("InheritedAccess"),html:n,dataIndex:"inherit_Access",sortKey:function(e){return e},sortable:!0}],{className:"AR_mainTable",maxHeightScroller:"",setScroller:!0});if(1==e.options.activeComment&&r.addHeader([{text:UWA.i18n("Comments"),dataIndex:"Comments",sortKey:function(t){return 1==e.isReadOnly?t:t.getValue()},sortable:!0}]),0==e.isReadOnly){var o=new UWA.createElement("span");this.moreButton.inject(o),this.lessButton.inject(o),r.addHeader([{html:o,dataIndex:"Delete",sortKey:function(e){return e}}])}return r},resizeTable:function(){this.table.resizeTable()},createJSONArrayModif:function(){var e=[];if(1==this.isReadOnly)return e;for(var t=this.table.getAllLine(),n=t.length,r=0;r<n;r++){var o=null,s=this.table.getCellContent(t[r],"Id");if(null!=s&&""!=s){var a=this.getOwnershipContainerFromID(s);o=a.ownership.owner;var c=!0,l=!0;a.hasOwnProperty("isTrueComment")&&(c=a.isTrueComment),a.hasOwnProperty("isTrueInheritedPath")&&(l=a.isTrueInheritedPath);var d="";1==this.options.activeComment&&(d=this.table.getCellValue(t[r],"Comments"));var h=this.getOwnerElementFromID(s).InitRights,u=this.table.getCellValue(t[r],"ComboRights"),p=!1;null!=u&&""!=u||(p=!0);var g=!1;null!=h&&""!=h||(g=!0);var m=!1;if(""!=d&&d!=o.comment&&(m=!0),1==g&&0==p&&(1==m&&(o.comment=d),e.push({operation:{operation:"ADD",owner:o,access:{logical:u}},isTrueComment:!0,isTrueInheritedPath:!0,action:"ADD"})),0==g&&1==p&&e.push({operation:{operation:"REMOVE",owner:o,access:{logical:"Empty"}},isTrueComment:c,isTrueInheritedPath:l,action:"REMOVE"}),0==g&&0==p)if(1==m){var f=i.decode(i.encode(o));f.comment=d,e.push({operation:{operation:"ADD",owner:f,access:{logical:u}},isTrueComment:!0,isTrueInheritedPath:!0,action:"ADD"})}else u!=h&&e.push({operation:{operation:"ADD",owner:o,access:{logical:u}},isTrueComment:c,isTrueInheritedPath:l,action:"MODIFY"})}}return e},AddDataInTable:function(e){var t=this;t.table.clearAllLine(),t.listID=[];var n=[];e.forEach(function(e,i){var r=t.AddOwnershipInTable(e);null!=r&&n.push(r)}),t.table.AddDatasInTable(n),this.containsInheritedAccess&&(this.moreButton.click(),this.currentMode=t.lessButton),t._manageTableHeader(),t.manageAdvancedMode()},AddOwnershipInTable:function(e){var n=i.decode(i.encode(e)),r=n.ownership,o=this,s="",a=this.getNewIDLine(),c=null,d=o.getNameUserFromOwner(r.owner);null!=d&&(c=l.getImageUser(d.type,"medium",o.widget),s=d.name);var h=UWA.createElement("div",{html:[c,{tag:"span",class:"AR_UserName",text:s}]}),u=UWA.createElement("div"),m=UWA.createElement("div");if(r.hasOwnProperty("inheritedPath")){var f=r.inheritedPath;null!==f&&void 0!==typeof f&&f.length>0&&(this.containsInheritedAccess=!0),f.forEach(function(e,t){UWA.createElement("div",{html:" -&nbsp;"+e.inheritedFrom.objectTNR}).inject(u);var n="";e.inheritedAccess.hasOwnProperty("logical")?n=o.AccessRightController.getAccessNls(e.inheritedAccess.logical):e.inheritedAccess.hasOwnProperty("physical")&&(n=e.inheritedAccess.physical),UWA.createElement("div",{html:n}).inject(m)})}var v="";r.owner.hasOwnProperty("comment")&&(v=r.owner.comment);var A=v;0==this.isReadOnly&&(A=new t.Text({value:v,className:"input-tree-label"}));var I=!0;n.hasOwnProperty("isAllInherit")?I=n.isAllInherit:""==u.getText()&&(I=!1);for(var y=!1,C=o.AccessRightController.getSelectedItemList(),R=C.length,b=0;b<R;b++)if(this.isPovOwner(C[b].physicalId,r.owner)){y=!0;break}var w="";I||0!=this.isReadOnly||y||((w=new p({attributes:{title:UWA.i18n("RemoveAccess")},value:"",className:"default medium AR_DeleteUser",icon:"cancel"})).getContent().setAttribute("data-rec-id","DeleteButton"+a),w.elements.icon.setAttribute("data-rec-id","DeleteButtonicon"+a),w.addEvents({onClick:function(){o.DeleteUser(a),o.onResize(),o.dispatchEvent("onChangeSize")}}));var O=r.access.logical,E=r.access.logical,D=O,_=this.AccessRightController.getFormattedRightList();if(0==this.isReadOnly&&!I&&!y){_.forEach(function(e,t){e.label==O&&t}),(D=new g({nativeSelect:!0,placeholder:!1,options:_,events:{onChange:function(){o._ManageValidButton()}}})).elements.container.setAttribute("data-rec-id","dataRecComboRightsContainer"+a),D.elements.content.setAttribute("data-rec-id","dataRecComboRights"+a),D.select(O),r.hasOwnProperty("InitRights")&&(E=r.InitRights)}if(I)D=S.get("AR_Inherited_Message");else if(y){D=UWA.i18n("povOwner").format(s)}else if(this.isReadOnly){r.access.nls;D=o.AccessRightController.getAccessNls(r.access.logical)}var P={OwnershipContainer:n,InitRights:E,Id:a};return o.listID.push(P),{Id:a,InitRights:E,UserName:h,ComboRights:D,inherit_From:u.getText(),inherit_Access:m.getText(),Comments:A,Delete:w}},AddSelectedItemsInTable:function(){var e=this,t=[],n=[];t=e.AccessRightController.getSelectedItemList();var i=e.AccessRightController.getErrorSelectedItemList();JSON.parse("[]");t.forEach(function(t){var r=!1;if(null!=t&&null!=t.physicalId){null!=i[t.physicalId]&&(r=!0);var o="",s=null,a="";0==e.isODT&&r&&(o=S.get("accessRightFailure")),!0===e.isODT&&r&&(o="access right failure"),0==e.isODT&&r&&(s="syc-red-circle-symbol",a=UWA.createElement("div",{class:s}));var c=UWA.createElement("img",{src:t.urlIcon}),l=UWA.createElement("div",{text:t.name}),d=UWA.createElement("div",{class:"TitleDiv"});l.setStyles({display:"inline-block","padding-left":"6px"}),d.appendChild(c),d.appendChild(l);var h={Id:t.physicalId,Title:d,Type:t.typeDisplayName,Symbol:a,Revision:t.Revision,Organization:t.organizationTitle,CollaborativeSpace:t.collabSpaceTitle,Responsible:t.responsibleName,Result:o};n.push(h)}}),e.csoTable.AddDatasInTable(n),e.hideLoadingArea()},ODTModificationComplete:function(e){this.hideLoadingArea(),1==e.success?this.showNotificationInTable(e):this.addErrorAfterOperation(this,e),this._ManageValidButton(!1)},ODTGetListOfItemsInTable:function(){return this.AccessRightController.getSelectedItemList().length},ODTGetListOfUserItemsInTable:function(){return this.table.getAllLine().length}})});