define("DS/E6WCommonApps/Collections/ConstraintsPseudoCollection",["UWA/Core","UWA/Class","UWA/Class/Events","UWA/Class/Listener","UWA/Class/Collection"],function(e,t,n,s,i){"use strict";var o=t.extend(n,s,{_iterateOverWorkscopes:function(e,t){var n,s=this;if(e instanceof i)return e.some(function(e){return s._iterateOverWorkscopes(e,t)});if(n=t.call(this,e))return n;for(var o=e.getWorkscopes(),a=o.length,r=0;r<a&&!n;r++){var l=o.at(r);n=this._iterateOverWorkscopes(l,t)}return n},_onCollectionEvent:function(e,t,n,s,i){if(!this.requestReset){switch(e){case"onReset":var o=this;this.requestReset=window.requestAnimationFrame(function(){delete o.requestReset,o.dispatchEvent(e,[t,o,s])}),this._handleConstraintResetForWorkscope(t,n,i);break;case"onAdd":return void this.add(t,i,s);case"onRemove":return void this.remove(t,i,s)}this.dispatchEvent(e,[t,this,s])}},_handleConstraintResetForWorkscope:function(t,n,s){var i,a,r=[],l=e.is(n.previousModels,"array")?n.previousModels.slice():[];for(t.forEach(function(e){var t=l.indexOf(e);-1===t?r.push(e):l.splice(t,1)}),i=0;i<r.length;i++)a=r[i],this.add(a,s);for(i=0;i<l.length;i++)a=l[i],o.parentProjectIsDisplayed(a)||this.remove(a,s)},_listenToWorkscopeConstraints:function(e){var t=e.getOwnConstraints();this.listenTo(t,"onAnyEvent",function(t,n,s,i){this._onCollectionEvent(t,n,s,i,e)}),this._addConstraintsFromWorkscope(e)},_startListeningToWorkscope:function(e){this._listenToWorkscopeConstraints(e);var t=e.getWorkscopes(),n={onAdd:this._onAddWorkscope,onReset:this._onResetWorkscope,onRemove:this._onRemoveWorkscope};this.listenTo(t,n)},_stopListeningToWorkscope:function(e){var t=e.getWorkscopes();this.stopListening(t),this.stopListening(e.getOwnConstraints())},_onAddWorkscope:function(e){this._iterateOverWorkscopes(e,this._startListeningToWorkscope,!1),this._iterateOverWorkscopes(e,function(e){this._addConstraintsFromWorkscope(e)})},_addConstraintsFromWorkscope:function(e){var t=e.getOwnConstraints(),n=this;t.forEach(function(t){t.dispatchEvent("onAdd",[t,n]),n.add(t,e)})},_listenToWorkscopeAndAddConstraintsToMap:function(e){if(e instanceof t.Model){this._startListeningToWorkscope(e);var n=this;e.getOwnConstraints().forEach(function(t){n.add(t,e,{silent:!0})})}},_onResetWorkscope:function(e,t){if(0!==e.length||0!==t.previousModels.length){this._constraintMap.clear(),this._constraintParentMap.clear(),this._constraintIDMap.clear(),this.stopListening();var n=this;this._iterateOverWorkscopes(this.model,function(e){n._listenToWorkscopeAndAddConstraintsToMap(e)}),this.dispatchEvent("onReset",[this])}},_onRemoveWorkscope:function(e){var t=this;this._iterateOverWorkscopes(e,this._stopListeningToWorkscope,!1),this._iterateOverWorkscopes(e,function(n){n.getOwnConstraints().forEach(function(n){n.dispatchEvent("onRemove",[n,t]),t.remove(n,e)})});var n=e.hasViewAccess()&&e.getParent();n&&n.hasViewAccess()&&n.getOwnConstraints().forEach(function(n){t.add(n,e,{silent:!0})})},init:function(e){this.model=e,this._constraintMap=new Map,this._constraintIDMap=new Map,this._constraintParentMap=new Map,Object.defineProperty(this,"id",{get:function(){return(this.model.id||this.model.getUri())+":allConstraints"}}),Object.defineProperty(this,"length",{get:function(){return this._constraintMap.size}});var t=this;if(this._iterateOverWorkscopes(this.model,function(e){t._listenToWorkscopeAndAddConstraintsToMap(e)}),this.model instanceof i){var n={onAdd:this._onAddWorkscope,onRemove:this._onRemoveWorkscope,onReset:this._onResetWorkscope};this.listenTo(this.model,n)}},first:function(){return this.at(0)},get:function(e){return this._constraintIDMap.get(e)},add:function(e,t,n){var s=this._constraintParentMap.get(e.cid)?this._constraintParentMap.get(e.cid):new Set,i=0===s.size,o=i&&(!n||!n.silent);s.add(t.id),i&&this._constraintMap.set(e.cid,e),i&&this._constraintParentMap.set(e.cid,s),e.id&&this._constraintIDMap.set(e.id,e),o&&this.dispatchEvent("onAdd",[e,this,n])},remove:function(e,t,n){var s=this._constraintParentMap.get(e.cid);s&&(s.delete(t.id),0===s.size&&this._constraintMap.delete(e.cid),0===s.size&&this._constraintIDMap.delete(e.id),!(0!==s.size||n&&n.silent)&&this.dispatchEvent("onRemove",[e,this,n]))},at:function(e){var t,n=0;if(!(e>this._constraintMap.size-1)){if(this._constraintMap.values){for(var s=this._constraintMap.values(),i=s.next();!i.done&&n<e;)i=s.next(),n++;return i.value}return this._constraintMap.forEach(function(s){n===e&&(t=s),n++}),t}},forEach:function(e,t){var n=0;this._constraintMap.forEach(function(s){e.call(t,s,n),n++})},destroy:function(){window.cancelAnimationFrame(this.requestReset),this.stopListening(),delete this.model,delete this.requestReset,this._constraintMap.clear(),this._constraintParentMap.clear(),this._constraintIDMap.clear(),delete this._constraintMap,delete this._constraintParentMap,delete this._constraintIDMap},contains:function(e){return Boolean(this._constraintIDMap.get(e.id))}});return o.parentProjectIsDisplayed=function(e){let t=e.getPredecessor(),n=t&&t.hasViewAccess()&&t.getParent();return t&&n&&n.hasViewAccess()&&n.hasDataForMask("dsplan:MVMask.WorkPackage.ScheduleView")},o}),define("DS/E6WCommonApps/Models/BaselineModel",["UWA/Core","DS/RDFFoundation/Models/ResultModel","DS/RDFFoundation/RDFUtils"],function(e,t,n){"use strict";const s=["start","end","actualStart","actualEnd"];var i=t.extend({init:function(t,n){const s=e.clone(t||{},!1);s.forceDslc=!0,this._parent(s,n)},loadFCSFile:function(t){let s=e.clone(t||{});this._modelMap||(this._loading=!0,n.downloadFCSFile(this.id,{onComplete:e=>{this._parseFCSFile(e),s.onComplete&&t.onComplete(),this._loading=!1},onFailure:()=>{this._loading=!1,s.onFailure&&s.onFailure()}}))},_parseFCSFile:function(t){let i=JSON.parse(t);this._modelMap={},i.elements.forEach(t=>{let i=e.clone(t||{},!1);s.forEach(e=>{i[e]&&(i[e]=new Date(i[e]))}),this._modelMap[n.removeBracketLongURI(t.id)]=i})},isLoading:function(){return this._loading},hasLoadedFCSData:function(){return Boolean(this._modelMap)},getDataForModel:function(t){if(this.hasLoadedFCSData()){let n=this._modelMap[t.id];if(n){let t=e.clone(n);return"Task"===n.type&&"Open"!==n.state||"Milestone"===n.type&&"Done"===n.state?t.start=n.actualStart:t.start=n.start,t.end="Done"===n.state?n.actualEnd:n.end,t}}}});return i.COMPLETE="Done",i.OPEN="Open",i.TASK="Task",i}),define("DS/E6WCommonApps/Models/InvokeSolver",["UWA/Core","DS/RDFFoundation/RDFUtils","DS/E6WCommonUI/UIHelper"],function(e,t,n){"use strict";var s=t.createRequestQueue(1);return s.solve=function(i,o,a){var r=i&&i.additionalElementsToSolve||[];r.unshift(o);var l=i&&i.additionalParentElementsToSolve||[];a&&l.unshift(a);var d={IsWhatIf:!1};d[i&&i.listName||"ScheduleElementList"]=r,d.ParentScheduleElementList=l,d=[d];var c=t.getPendingRequests(s),p=new Set;c.forEach(function(e){var t=JSON.parse(e.options.data)[0];t.ParentScheduleElementList&&t.ParentScheduleElementList.forEach(e=>p.add(e)),t.ProjectList&&t.ProjectList.forEach(e=>p.add(e))});var u=d[0],h=!1;if(u.ParentScheduleElementList)for(let e of u.ParentScheduleElementList)if(!p.has(e)){h=!0;break}if(u.ProjectList)for(let e of u.ProjectList)if(!p.has(e)){h=!0;break}h?t.request(t.expandUrl("invoke/dsmf:xplan.Scheduler.JSONScheduleObjects?$mask=dsplan:MVMask.ScheduleElements.Complex"),{method:"POST",queue:s,onComplete:i&&i.onComplete,onFailure:function(){return widget.alerter?n.displayWarning(n.i18n("SolverFailed")):console.log("Solver failed. Likely no solution found"),i&&e.is(i.onFailure,"function")&&i.onFailure.apply(this,arguments)},onTimeout:i&&i.onFailure,data:JSON.stringify(d),type:"json"}):i&&i.onCancel&&i.onCancel()},s}),define("DS/E6WCommonApps/PreferenceUtils",[],function(){"use strict";return{get:function(e){return widget.getValue(e)},set:function(e,t){widget.setValue(e,t)},parse:function(e){return e?JSON.parse(e):e}}}),define("DS/E6WCommonApps/SubscribeUtil",["UWA/Core","UWA/Utils","DS/E6WCommonUI/UIHelper","DS/PlatformAPI/PlatformAPI","DS/DocumentManagement/DocumentManagement","i18n!DS/E6WCommonApps/assets/nls/E6WCommonAppsNLS"],function(e,t,n,s,i,o){"use strict";var a=o.get.bind(o);var r={getMessage:function(e){var t=e&&a(e.reason);return e.args&&(t=o.replace(t,e.args)),t},subscribeActivity:function(n,i){var o=e.clone(i||{},!1),a=o.uuid||t.getUUID(),l="XApp.Magic.Feedback."+a,d={name:n,id:a};return s.subscribe(l,function(e){console.log(JSON.stringify(e));var t=e.type,n=r.getMessage(e);n&&console.log(t+": "+n),r.events.dispatchEvent("onActivityProgress",{activity:d,loaded:e.loaded,total:e.total,type:t,log:n}),"complete"!==t&&"fail"!==t||(d.msgType=t,r.events.dispatchEvent("onActivityComplete",d))}),o.start&&r.startActivity(n,a),a},startActivity:function(e,t){r.events.dispatchEvent("onActivityStart",{name:e,id:t})}};return Object.defineProperty(r,"events",{get:function(){return i.events}}),r.ACTIVITY_COMPLETE="onActivityComplete",r.MESSAGE_COMPLETE="complete",r}),define("DS/E6WCommonApps/Models/E6WCommonAppsConstants",["UWA/Core","DS/E6WCommonUI/E6WCommonUIConstants"],function(e,t){"use strict";var n={TASK:"Task",TASK_RDF_TYPE:"dsplan:Task",ENDDATE_ATTR:"dsplan:estimatedEndDate",DSLC_ENDDATE_ATTR:"dsxplan:estimatedEndDate",STARTDATE_ATTR:"dsplan:estimatedStartDate",DSLC_STARTDATE_ATTR:"dsxplan:estimatedStartDate",ESTIMATED_DATE_ATTR:"dsplan:estimatedDate",SUGGESTED_DATE_ATTR:"dsplan:suggestedDate",TASK_VOCABULARY_ATTR:"dsplan:hasTaskVocabulary",START_DATE_MIN_ATTR:"dsplan:startDateIntervalMin",START_DATE_MAX_ATTR:"dsplan:startDateIntervalMax",END_DATE_MIN_ATTR:"dsplan:endDateIntervalMin",END_DATE_MAX_ATTR:"dsplan:endDateIntervalMax",ACTUAL_START_DATE:"dsplan:actualStartDate",ACTUAL_END_DATE:"dsplan:actualEndDate",BASELINE_ESTIMATED_START_DATE:"dsplan:baselineEstimatedStartDate",BASELINE_ESTIMATED_END_DATE:"dsplan:baselineEstimatedEndDate",BASELINE_ACTUAL_START_DATE:"dsplan:baselineActualStartDate",BASELINE_ACTUAL_END_DATE:"dsplan:baselineActualEndDate",DSLC_ACTUAL_START_DATE:"dsxplan:actualStartDate",DSLC_ACTUAL_END_DATE:"dsxplan:actualEndDate",ACTUAL_DELIVERABLE_ATTR:"dsplan:actualDeliverable",ATTACHMENT_ATTR:"dsplan:hasAttachment",ASSIGNEE_ATTR:"dsplan:hasAssignee",USER_DEFINED_DATES_ATTR:"dsplan:userDefinedDates",USER_DEFINED_START_DATE_ATTR:"dsplan:userDefinedStart",USER_DEFINED_END_DATE_ATTR:"dsxplan:userDefinedEnd",CHILDREN_ATTR:"dsplan:hasWorkDecomposition",OBJECT:"Object",COMPLETE_PERCENT_ATTR:"dsplan:percentageCompletion",SEQUENCE_ORDER_ATTR:"dsplan:sequenceOrder",SEQUENCE_ORDER_ATTR_DSLC:"dsxplan:sequenceOrder",WORK_CONTEXT_ATTR:"dsplan:hasWorkContext",RESTRICT_ASSIGNEE_ATTR:"dsxplan:restrictAssigneeAccess",RESTRICT_ASSIGNEE_ATTR_SERVER:"dsplan:restrictAssigneeAccess",DURATION:"dsplan:duration",DURATION_RANGE:"dsplan:durationRange",DURATION_MIN:"dsplan:durationIntervalMin",DURATION_MAX:"dsplan:durationIntervalMax",DURATION_SUGGESTED:"dsplan:suggestedDuration",DURATION_ESTIMATED:"dsplan:estimatedDuration",DURATION_ESTIMATED_RANGE:"dsplan:estimatedDurationRange",DURATION_ACTUAL_RANGE:"dsplan:actualDurationRange",DURATION_ACTUAL:"dsplan:actualDuration",TITLE_ATTR:"title",INV_DSLC_TITLE_ATTR:"dskern:label",DSLC_DESCRIPTION_ATTR:"dsxplan:comment",HAS_SUB_TASKS:"dsxplan:hasSubtasks",PARENT_ATTR:"dsxplan:workscopeParent",HAS_PARENT_ATTR:"dsplan:hasParent",PARENT_HAS_SWYM_COMMUNITY:"dsplan:hasCommunity",PARENT_HAS_LEAN_BOARD:"dsxplan:hasLeanBoard",LASTUPDATED_ATTR:"dspol:modificationDate",CREATION_DATE_ATTR:"dspol:creationDate",WORKSCOPE_PARENT_ATTR:"dsxplan:workDecompositionParent",TASK_PARENT_ATTR:"dsxplan:taskParent",COMMON_TASK_PARENT_ATTR:"commonTaskParent",WORKSCOPE_PARENT_ALL_ATTR:"dsplan:workscopeParentForAll",MILESTONE_PARENT_ATTR:"dsxplan:workscopeParentForMilestone",DSLC_DURATION_RANGE:"dsxplan:durationRange",DSLC_DURATION_MIN:"dsxplan:durationIntervalMin",DSLC_DURATION_MAX:"dsxplan:durationIntervalMax",DSLC_DURATION_ESTIMATED:"dsxplan:estimatedDuration",PRIORITY_ATTR:"dsplan:hasPriority",PRIORITY_HIGH:"dsxplan:High",PRIORITY_MEDIUM:"dsxplan:Medium",PRIORITY_LOW:"dsxplan:Low",PRIORITY_URGENT:"dsxplan:Urgent",STATE_OPEN:"dsxplan:Open",STATE_IN_PROGRESS:"dsxplan:InProgress",STATE_DONE:"dsxplan:Done",STATE_ATTR:"dscom:hasMaturity",BASELINE_STATE_OPEN:"Open",BASELINE_STATE_IN_PROGRESS:"InProgress",BASELINE_STATE_DONE:"Done",DSLC_STATE_ATTR:"dsxplan:hasMaturity",DSLC_PRIORITY_ATTR:"dsxplan:hasPriority",dslcMapping:{title:"dsxplan:label","dskern:label":"dsxplan:label","dsplan:durationIntervalMin":"dsxplan:durationIntervalMin","dsplan:estimatedStartDate":"dsxplan:estimatedStartDate","dsplan:estimatedEndDate":"dsxplan:estimatedEndDate","dsplan:comment":"dsxplan:comment","dsplan:sequenceOrder":"dsxplan:sequenceOrder","dsplan:durationIntervalMax":"dsxplan:durationIntervalMax","dsplan:estimatedDuration":"dsxplan:estimatedDuration","dsplan:endDateIntervalMin":"dsxplan:endDateIntervalMin","dsplan:endDateIntervalMax":"dsxplan:endDateIntervalMax","dsplan:startDateIntervalMax":"dsxplan:startDateIntervalMax","dsplan:startDateIntervalMin":"dsxplan:startDateIntervalMin","dsplan:solveStart":"dsxplan:solveStart","dsplan:solveEnd":"dsxplan:solveEnd","dsplan:percentageCompletion":"dsxplan:percentageCompletion","dsplan:actualStartDate":"dsxplan:actualStartDate","dsplan:actualEndDate":"dsxplan:actualEndDate","dsplan:actualDeliverable":"dsxplan:actualDeliverable","dscom:hasMaturity":"dsxplan:hasMaturity","dsplan:userDefinedDates":"dsxplan:userDefinedDates","dsplan:userDefinedStart":"dsxplan:userDefinedStart","dsplan:userDefinedEnd":"dsxplan:userDefinedEnd","dsplan:hasAssignee":"dsxplan:hasAssignee","dsplan:requiresSkill":"dsxplan:requiresSkill","rdf:type":"dsxplan:type",subtitle:"dsxplan:comment","dsplan:hasAttachment":"dsxplan:hasAttachment","dsplan:hasPriority":"dsxplan:hasPriority","dsplan:hasCommunity":"dsxplan:hasCommunity","dsplan:hasSubtask":"dsxplan:hasSubtask","dsplan:estimatedDate":"dsxplan:estimatedDate","dsplan:dateIntervalMax":"dsxplan:dateIntervalMax","dsplan:dateIntervalMin":"dsxplan:dateIntervalMin","dsplan:actualDate":"dsxplan:actualDate","dspol:modificationDate":"dsxplan:modificationDate","dsplan:suggestedDate":"dsxplan:suggestedDate","dsplan:ScheduleUpdateStatus":"dsxplan:ScheduleUpdateStatus","dsplan:schedulingStrategy":"dsxplan:schedulingStrategy","dskern:image":"dxplan:image","dsplan:hasThumbnail":"dsxplan:hasThumbnail","dsplan:hasWorkContext":"dsxplan:hasWorkContext","dsplan:hasWorkDecomposition":"dsxplan:hasWorkDecomposition","dsplan:hasTask":"dsxplan:hasTask","dsplan:hasMilestone":"dsxplan:hasMilestone"},attributeImpactingSolve:{"dsplan:durationIntervalMin":!0,"dsplan:durationIntervalMax":!0,"dsplan:startDateIntervalMin":!0,"dsplan:startDateIntervalMax":!0,"dsplan:estimatedStartDate":!0,"dsplan:endDateIntervalMin":!0,"dsplan:endDateIntervalMax":!0,"dsplan:estimatedEndDate":!0,"dsplan:hasAssignee":!0,"dsplan:actualStartDate":!0,"dsplan:actualEndDate":!0,"dscom:hasMaturity":!0,"dsplan:userDefinedDates":!0,"dsplan:userDefinedStart":!0,"dsplan:userDefinedEnd":!0,"dsxplan:workscopeParent":!0,"dsxplan:taskParent":!0},PROGRAM:"Program",PROGRAM_RDF_TYPE:"dsplan:Program",PROJECT:"Project",XPROJECT:"Enterprise Project",PROJECT_RDF_TYPE:"dsplan:Project",XPROJECT_RDF_TYPE:"dsplan:xProject",DELETED_PROJECT_RDF_TYPE:"dsplan:DeletedProject",ACTUAL_DATES_STRATEGY_ATTR:"dsplan:actualDatesStrategy",SCHEDULING_FROM_STRATEGY_ATTR:"dsplan:schedulingFromStrategy",PLANNED_DATES_STRATEGY:"Keep Planned Dates",CURRENT_DATES_STRATEGY:"Use Current Dates",STARTDATE_SCHEDULINGFROM_STRATEGY:"Start Date",CURRENTDATE_SCHEDULINGFROM_STRATEGY:"Current Date",PROJECT_TYPE:"dsplan:projectType",RELATED_PLANS:"dsxplan:relatedPlans",WORKPACKAGE:"WorkPackage",WORKPACKAGE_RDF_TYPE:"dsplan:WorkPackage",CONSTRAINT_RELATION_ATTR:"dsplan:hasConstraint",AUTOSOLVE_OFF:1,AUTOSOLVE_ON:2,ACTUAL_TYPE_ATTR:"dsplan:actualType",TYPE_ATTR:"@type",DESCRIPTION_ATTR:"subtitle",FONTICON_ATTR:"fonticon",KPI_RELATION_ATTR:"dsplan:hasSpecification",MILESTONE_VOCABULARY_ATTR:"dsplan:hasMilestoneVocabulary",MILESTONE_RDF_TYPE:"dsplan:Milestone",MILESTONE_VOCABULARY_TYPE:"dsxplan:vocabularyType",OWNER_ATTR:"dskern:owner",CONTENT_REPOSITORY:"dsxplan:hasContentRepository",RISK_REPOSITORY:"dsplan:hasCollaborativeSpace",BOOKMARK_FOR_FILE_REPOSITORY:"dsplan:hasBookmark",REQUEST_TYPE_ADD:"addOperation",REQUEST_TYPE_REPLACE:"resetOperation",REQUEST_TYPE_REMOVE:"removeOperation",REQUEST_TYPE_PREVIEW:"previewOperation",REQUEST_TYPE_EDIT:"editOperation",REQUEST_TYPE_ASSIGN:"assignOperation",REQUEST_TYPE_DELETE:"deleteOperation",NO_SOLVER_ERROR:"dsxplan:NoSolverError",PARENT_CHILD_ERROR:"ParentChildError",RESOURCE_AFFECTATION:"ResourceAffectation",RESPONSIBILITY_LEADER:"dsplan:Leader",RESPONSIBILITY_VIEWER:"dsplan:Viewer",RESPONSIBILITY_AUTHOR:"dsplan:Author",APP_3DPLAN:"ENXPLAN_AP",APP_TSK:"ENOTASK_AP",PRIORITY_LOW_ICON:"fonticon-low",PRIORITY_MEDIUM_ICON:"fonticon-medium",PRIORITY_HIGH_ICON:"fonticon-high",PRIORITY_URGENT_ICON:"fonticon-alert",TODO_STATE_COLOR:"#488EB8",IN_PROGRESS_STATE_COLOR:"#005686",DONE_STATE_COLOR:"#B5B6BA",DROP_CLASS_NAME:"drag-over",STATE_FOR_DISPLAY_ATTR:"stateForDisplay",PRIORITY_DISPLAY:"priority",DUE_DATE_CATEGORY:"dueDateCategory",COOWNERATTR:"co-owners",PERCENT_COMPLETE:"percentComplete",SIMULATION_TYPE:"Simulation",SIMULATION_TEMPLATE_TYPE:"Simulation Template",PAST_DUE:"PAST_DUE",NO_DATE:"NO_DATE",DUE_TODAY:"DUE_TODAY",DUE_TOMORROW:"DUE_TOMORROW",DUE_THIS_WEEK:"DUE_THIS_WEEK",DUE_FUTURE:"DUE_FUTURE",EXPLICIT_TAGS_DATA:"explicitTagsData",ALL_LEVEL_TASKS:"allLevelTasks",FIRST_LEVEL_TASKS:"firstLevelTasks",LEVEL_PREF:"taskLevelPref",NONRDF_ATTACHMENT_ATTR:"references",NONRDF_DELIVERABLE_ATTR:"deliverables",SCHEDULE_ERROR_ATTR:"dsplan:hasScheduleError",DEPENDENCY_FILTER_TYPE:"dependencyType",DEPENDENCY_FILTER_STATUS:"dependencyStatus",DEPENDENCY_FILTER_SOURCE:"dependencySource",DEPENDENCY_FILTER_SUBPROJECTS:"subprojectDependencies",DEPENDENCY_FILTER_ALL:"all",DEPENDENCY_TYPE_ENFORCED:"enforced",DEPENDENCY_TYPE_FLEXIBLE:"flexible",DEPENDENCY_STATUS_BROKEN:"broken",DEPENDENCY_STATUS_OK:"OK",DEPENDENCY_SOURCE_EXTERNAL:"external",DEPENDENCY_SOURCE_INTERNAL:"internal",SCOPEATTR:"scopes",DPMPROJECTATTR:"DPMProject",BUSINESS_METHOD_TEMPLATE:"businessMethodTemplate",BUSINESS_METHOD_SNAPSHOTDATE:"snapshotDate",DUPLICATE_TASK:"duplicate",SPLIT_TASK:"split",ACTIVE:"Active",COMPLETE:"Complete",TASK_TABLE:"taskTable"};return e.merge(n,t),n}),define("DS/E6WCommonApps/SharedWidgetUwaUtils",["UWA/Core","UWA/Class","UWA/Array","DS/E6WCommonUI/UIHelper","DS/E6WCommonUI/PlatformManager","i18n!DS/E6WCommonUI/assets/nls/E6WCommonUINLS"],function(e,t,n,s,i,o){"use strict";var a={processStorages:function(t,n,s){var o=e.clone(s||{},!1),r=widget.getValue("x3dPlatformId"),l=r&&t.find(function(e){return e.platformId.toUpperCase()===r.toUpperCase()});l&&(l["3DSpace"]||l[o.additionalStorage])?(enoviaServer.storageUrl=l.url,enoviaServer.tenant=l.platformId,enoviaServer.swym=l["3DSwym"],enoviaServer.searchUrl=l["3DSearch"],enoviaServer.tenantDisplayName=l.displayName,e.extend(enoviaServer,l),i.setInvalidTenant(),widget.setValue("x3dPlatformId",enoviaServer.tenant)):(i.setInvalidTenant(r),a.showTenantError())},onRefresh:function(){var e=window.parent.document.getElementById("frame-"+widget.id);e.src=e.src},showTenantError:function(){if(widget.alerter){var e=o.get("E6WCommonUI.Warning.TenantNotAvailable");s.displayError(o.replace(e,{TENANT:i.getInvalidTenant()}))}},setStoragesPrefs:function(e,t,n,s){var i=[];t.forEach(function(e){n===e.platformId&&(enoviaServer.storageUrl=e.url,enoviaServer.tenant=e.platformId),i.push({label:e.displayName,value:e.platformId})}),e.addPreference({name:"collabstorage",type:"list",defaultValue:enoviaServer.tenant,options:i,label:WidgetConstants.str.CollaborativeStorages,onchange:"onStorageChange"}),"false"!==s.toLowerCase()&&e.addPreference({name:"collabspace",type:"list",defaultValue:"",options:[{label:"",value:""}],label:WidgetConstants.str.CollaborativeSpaces})}};return a}),define("DS/E6WCommonApps/Views/SignaturePopup",["UWA/Core","UWA/Class/Listener","DS/UIKIT/SuperModal","DS/UIKIT/Input/Password","DS/UIKIT/Input/Text","DS/UIKIT/Input/Toggle","DS/E6WCommonUI/UIHelper","i18n!DS/E6WCommonApps/assets/nls/E6WCommonAppsNLS"],function(e,t,n,s,i,o,a,r){"use strict";var l=function(e){return r.get(e)};return n.extend({init:function(n){this._parent.apply(this,arguments);var s=e.clone(n||{},!1);this._initializeOptionsForDialog(s),this._listener=new t,this.dialog(this._createDialog()),this._setFocusToFirstField(),this._setDisabledClassOnSignButton(!0),this._parent.apply(this,arguments)},_initializeOptionsForDialog:function(t){this.container=e.createElement("div"),this._callback=t.callback},_setFocusToFirstField:function(){a.isIpad()||a.isAndroid()||this.container.getElement("[id='username']").focus()},destroy:function(){this.destroyed||(this.dispatchEvent("onDestroy",[this]),this._listener&&(this._listener.stopListening(),delete this._listener),this._modalRef&&(this._modalRef.destroy(),delete this._modalRef),this._parent.apply(this,arguments),this.destroyed=!0)},modalFactory:function(){var e=this;return this._modalRef=this._parent.apply(this,arguments),this._listener.listenTo(this,"onHide",function(){e.destroy()}),this._modalRef},getBody:function(){return this._modalRef&&this._modalRef.getBody()},_getTitle:function(){return this._dialogTitle||l("E6WCommonApps.Signature.Title")},_setDisabledClassOnSignButton:function(e){var t=document.getElementsByClassName("modal")[0];t&&t.getElement(".btn-create").toggleClassName("disabled",e)},_validate:function(){var e=function(e){return!e||e.trim&&!e.trim().length},t=e(this.usernameField.getValue())||e(this.passwordField.getValue())||!this.toggleField.isChecked();this._setDisabledClassOnSignButton(t)},_createDialog:function(){var t=this;e.createElement("p",{html:l("E6WCommonApps.Signature.Instructions")}).inject(this.container),e.createElement("label",{text:l("E6WCommonApps.Signature.Label.Id")}).inject(this.container);this.usernameField=new i({id:"username",label:l("E6WCommonApps.Signature.Label.Id"),placeholder:l("E6WCommonApps.Signature.Placeholder.UserName"),events:{onChange:function(e){t._validate()}}}).inject(this.container);e.createElement("label").inject(this.container);return this.passwordField=new s({id:"password",placeholder:l("E6WCommonApps.Signature.Placeholder.Password"),events:{onChange:function(e){t._validate()}}}).inject(this.container),this.toggleField=new o({id:"readAndUnderstands",type:"checkbox",label:l("E6WCommonApps.Signature.ReadAndUnderstands"),checked:!1,events:{onChange:function(e){t._validate()}}}).inject(this.container),{body:this.container,title:this._getTitle(),buttons:[{className:"primary btn-create",value:l("E6WCommonApps.Signature.Label.OK"),action:function(){t.save()}},{className:"default",value:l("E6WCommonApps.Signature.Label.Cancel"),action:function(){t.destroy()}}]}},save:function(){this.destroy(),this._callback&&this._callback({username:this.usernameField.getValue(),password:this.passwordField.getValue()})}})}),define("DS/E6WCommonApps/Models/CalendarModel",["UWA/Core","DS/RDFFoundation/Models/ResultModel","DS/RDFFoundation/Collections/ResultCollection","i18n!DS/E6WCommonApps/assets/nls/E6WCommonAppsNLS"],function(e,t,n,s){"use strict";var i="dsplan:MVMask.Calendar.Basic",o="dsplan:timezoneOffset",a=t.extend({_uwaClassName:"CalendarModel",timeOffsetToUTCString:function(){var e,t=this.get(o)/60;return!isNaN(t)||Math.abs(t)>24?(e=t>=0?"UTC+":"UTC",e+=t):(e="Invalid Calendar timeOffset: "+t,console.error("Invalid time offset: "+t)),e},getDateInWorkscopeCalendarTimeZone:function(e){var t=this.get(a.OFFSET_ATTR)+e.getTimezoneOffset();return new Date(e.getTime()+60*t*1e3)},getDropdownDisplayValue:function(){var e,t=this.get("dsplan:representativeCities").replace(/ /g,"").replace(/,/g,"_");return this.timeOffsetToUTCString()+" "+(e="E6WCommonApps.Calendar."+t,s.get(e))}}),r=n.extend({_uwaClassName:"CalendarCollection",comparator:function(e,t){return parseInt(e.get(o))-parseInt(t.get(o))},getUri:function(){return"/classes/dsplan:Calendar"},getMask:function(){return i}});return a.calendarCollection=new r(void 0,{detailsMask:i,defaultModel:a}),a.fetchCalendars=function(t){var n=e.clone(t||{},!1),s=n.onComplete;n.onComplete=function(){a._calendarsFetched=!0,e.is(s,"function")&&s()},n.reset=!0,a.calendarCollection.fetch(n)},a.haveCalendarsBeenFetched=function(){return Boolean(a._calendarsFetched)},a.getCalendarsForDropdown=function(){var e=[];return a.calendarCollection.forEach(function(t){e.push({actualValue:t.id,displayValue:t.getDropdownDisplayValue&&t.getDropdownDisplayValue()})}),e},a.getCalendarClosestToUserTimeZone=function(){if(!a._closestCalendar){var e=(n=new Date(2018,0,1,0,0,0,0),s=n.toUTCString(),(n-new Date(s.substring(0,s.lastIndexOf(" ")-1)))/36e5),t=25;a.calendarCollection.forEach(function(n){var s=parseInt(n.get(o))/60-e;!isNaN(s)&&Math.abs(s)<t&&(t=Math.abs(s),a._closestCalendar=n)})}var n,s;return a._closestCalendar},a.OFFSET_ATTR=o,a.CITIES_ATTR="dsplan:representativeCities",a.LOAD_ALL_CALENDARS_URL="/classes/dsplan:Calendar",a}),define("DS/E6WCommonApps/Views/RichTextEditorConfig",["DS/E6WCommonUI/PlatformManager"],function(e){"use strict";var t={getConfig:function(){return{toolbarGroups:[{name:"basicstyles",groups:["basicstyles","cleanup"]},{name:"styles",groups:["styles"]},{name:"links",groups:["links"]}],title:!1,contentsLangDirection:"ltr",removeDialogTabs:"link:advanced;link:target",removeButtons:"Source,Save,Cut,Undo,Find,SelectAll,NewPage,Preview,Print,PasteFromWord,PasteText,Paste,Copy,Redo,Templates,Replace,Checkbox,Form,Scayt,Radio,TextField,Textarea,Select,Button,ImageButton,HiddenField,CopyFormatting,Subscript,Superscript,NumberedList,BulletedList,Indent,Outdent,Blockquote,CreateDiv,JustifyLeft,JustifyCenter,JustifyRight,JustifyBlock,Language,BidiRtl,BidiLtr,Anchor,Image,Flash,Table,HorizontalRule,Smiley,SpecialChar,PageBreak,Iframe,FontSize,Font,Format,Styles,Maximize,ShowBlocks,BGColor,TextColor,About",language:e.getCurrentLanguage(),removePlugins:"exportpdf"}}};return t}),define("DS/E6WCommonApps/ColorUtil",[],function(){"use strict";var e={rgbToHex:function(e){var t=Number(e).toString(16);return t.length<2&&(t="0"+t),t},parseColor:function(e){return{red:Number.parseInt(e.slice(1,3),16),green:Number.parseInt(e.slice(3,5),16),blue:Number.parseInt(e.slice(5,7),16)}},squareColorObject:function(e){return{red:Math.floor(e.red*e.red/255),green:Math.floor(e.green*e.green/255),blue:Math.floor(e.blue*e.blue/255)}},colorObjectToHex:function(t){return`#${e.rgbToHex(t.red)}${e.rgbToHex(t.green)}${e.rgbToHex(t.blue)}`},getHighlightColorForTaggedObject:function(t){const n=e.parseColor(t),s=e.squareColorObject(n);return e.colorObjectToHex(s)}};return e}),define("DS/E6WCommonApps/Views/DocumentFileChooserPopup",["UWA/Core","UWA/Class/Listener","DS/UIKIT/SuperModal","DS/UIKIT/Input/File","DS/UIKIT/Input/Text","DS/E6WCommonUI/UIHelper","i18n!DS/E6WCommonApps/assets/nls/E6WCommonAppsNLS","i18n!DS/E6WCommonUI/assets/nls/E6WCommonUINLS"],function(e,t,n,s,i,o,a,r){"use strict";var l=function(e){var t=r.get(e);return t===e&&(t=a.get(e)),t};return n.extend({init:function(n){this._parent.apply(this,arguments);var s=e.clone(n||{},!1);this._initializeDialogOptions(s),this._listener=new t,this.dialog(this._createDialog(s)),this._parent.apply(this,arguments)},_initializeDialogOptions:function(t){this.container=e.createElement("div")},_createDialog:function(t){var n=this;n.docModel=t.docModel.contentProxyModel||t.docModel,n.fileInfo={},this.fileField=new s({id:"fileSelect",multiple:!1,label:l("E6WCommonUI.Label.File"),placeholder:l("E6WCommonUI.Label.FileChooser"),buttonClassName:"primary",events:{onChange:function(e){n.fileInfo.file=e.target.files}}}).inject(this.container);e.createElement("label",{text:l("E6WCommonApps.Command.Comments")}).inject(this.container);return this.commentsField=new i({id:"filecomments",label:l("E6WCommonApps.Command.Comments"),placeholder:l("E6WCommonApps.Command.Comments"),events:{onChange:function(e){n.fileInfo.comment=e.target.value}}}).inject(this.container),{body:this.container,title:l("E6WCommonUI.Label.Update"),buttons:[{className:"primary btn-create",value:l("E6WCommonUI.Label.Update"),action:function(e){e.hide(),o.updateDocumentConfirmation(n.fileInfo.file,n.docModel,t.updateDocumentCallback,n.fileInfo.comment)}},{className:"default",value:l("E6WCommonUI.Label.Cancel"),action:function(e){e.hide()}}]}}})}),define("DS/E6WCommonApps/Models/NoAccessModel",["DS/RDFFoundation/Models/NoAccessModel"],function(e){"use strict";return e}),define("DS/E6WCommonApps/XTaskScope",["UWA/Core","DS/RDFFoundation/RDFUtils"],function(e,t){"use strict";var n="scopeId_18x",s={getCollection:function(){return this._collection},setCollection:function(e){this._collection=e},isScopeRDF:function(){return!this._initialized&&this.initialize(),this._scopeIsRDF},getScopeId:function(){return!this._initialized&&this.initialize(),this._scopeId},getScope:function(){return t.getObjectById(this.getScopeId())},getScopeType:function(){return!this._initialized&&this.initialize(),this._scopeType},initialize:function(){var e=widget.getValue(n);if(void 0!==e)(e=JSON.parse(e))&&e.id?(e.localOnly=!0,this.setScopeData(e)):this.removeScopeData();else{var t=widget.getValue("scopeId"),s={};if(t){var i="~~";-1===t.indexOf("~~")&&(i=":");var o=t.split(i);s={id:o[1],type:o[0],isRDF:Boolean(widget.getValue("scopeIsRDF"))},this.setScopeData(s),widget.deleteValue("scopeIsRDF"),widget.deleteValue("scopeId")}else this.removeScopeData()}},setScopeData:function(t){var s=e.clone(t||{},!1);if(!s.id||!s.type||void 0===s.isRDF)throw new Error("id, type, and isRDF must be passed in an options object to setScopeData");var i={id:s.id,type:s.type,isRDF:Boolean(s.isRDF)};s.localOnly||widget.setValue(n,JSON.stringify(i)),window.enoviaServer.preferences.scopeId=i.id,window.enoviaServer.preferences.scopeType=i.type,this._scopeId=i.id,this._scopeType=i.type,this._scopeIsRDF=i.isRDF,this._widgetScopeId=i.id,this._widgetScopeType=i.type,this._widgetScopeIsRDF=i.isRDF,this._initialized=!0,s.hasOwnProperty(s.collection)&&this.setCollection(s.collection)},removeScopeData:function(){widget.setValue(n,JSON.stringify({id:void 0,type:void 0,isRDF:void 0})),this._widgetScopeId=void 0,this._widgetScopeType=void 0,this._widgetScopeIsRDF=void 0,this.removeUserScopeData()},removeUserScopeData:function(){this._scopeId=void 0,this._scopeType=void 0,this._scopeIsRDF=void 0,this._initialized=!0,this._collection=void 0,window.enoviaServer.preferences&&(delete window.enoviaServer.preferences.scopeId,delete window.enoviaServer.preferences.scopeType,delete window.enoviaServer.preferences.scopeIsRDF)},resetLocalScopeData:function(){delete this._widgetScopeId,delete this._widgetScopeType,delete this._widgetScopeIsRDF,delete this._initialized,this._collection=void 0},getFilter:function(){return widget.getValue("currentTaskFilter")||"all"},setFilter:function(e){widget.setValue("currentTaskFilter",e)},setScopeToInvalid:function(e){this._isInvalidScope=e},isInvalidScope:function(){return this._isInvalidScope},FILTER_ASSIGNED:"assigned",FILTER_OWNED:"owned",FILTER_ALL:"all",FILTER_ASSIGNED_TO_GROUP:"assignedToMyGroups"};return s}),define("DS/E6WCommonApps/Models/RollUpModel",["DS/RDFFoundation/Models/ResultModel"],function(e){"use strict";return e.extend({isDSLC:function(){return!0},dslcMapping:{"dsplan:estimatedEndDate":"dsxplan:estimatedEndDate","dsplan:estimatedStartDate":"dsxplan:estimatedStartDate"},_propertyDictionary:{"dsplan:isRolledUpInfoFor":{inverseProperty:"dsplan:hasRolledUpInfo"}}})}),define("DS/E6WCommonApps/Models/SolverModelMixin",[],function(){"use strict";return{setup:function(){this._previous.apply(this,arguments),this.listenTo(this,"onChange:solveCounter",function(){var e=this.getParent&&this.getParent();e&&(e.solveCounter+=this.solveCounter-this.prevSolveCounter)})},prevSolveCounterDef:{get:function(){return this.previousAttributes().solveCounter||0}},solveCounterDef:{get:function(){return this.get("solveCounter")||0},set:function(e){this.set("solveCounter",e)}}}}),define("DS/E6WCommonApps/Constants",["i18n!DS/E6WCommonApps/assets/nls/TimelineNLS"],function(e){"use strict";var t=e.get.bind(e);return{MONTH_LONG_NAMES:[t("January"),t("February"),t("March"),t("April"),t("May"),t("June"),t("July"),t("August"),t("September"),t("October"),t("November"),t("December")],MONTH_SHORT_NAMES:[t("Jan"),t("Feb"),t("Mar"),t("Apr"),t("May"),t("Jun"),t("Jul"),t("Aug"),t("Sep"),t("Oct"),t("Nov"),t("Dec")],DAY_LONG_NAMES:[t("Sunday"),t("Monday"),t("Tuesday"),t("Wednesday"),t("Thursday"),t("Friday"),t("Saturday")],DAY_SHORT_NAMES:[t("Sun"),t("Mon"),t("Tue"),t("Wed"),t("Thu"),t("Fri"),t("Sat")],NCAPSULATOR_BUFFER:18,DIVIDER_WIDTH:8}}),define("DS/E6WCommonApps/Views/ProgressBarPopupView",["UWA/Core","DS/Handlebars/Handlebars4","DS/E6WCommonUI/Views/FoundationBaseView","DS/DocumentManagement/DocumentManagement","DS/Controls/Accordeon","DS/Controls/ProgressBar","text!DS/E6WCommonApps/assets/templates/popover.html.handlebars","i18n!DS/E6WCommonApps/assets/nls/E6WCommonAppsNLS"],function(e,t,n,s,i,o,a,r){"use strict";var l=function(e){return r.get(e)},d={error:"error",fail:"error",info:"info",warning:"warning"},c=t.compile(a);return n.extend({_uwaClassName:"ProgressBarPopupView",id:function(){return"progressBar_"+this.cid},domEvents:{"click .minimize-btn":"toggleMinimizedMaximized","click .cancel-btn":"cancel"},setup:function(t){var n=e.clone(t||{},!1);this._activityElementObj={},this._progressBarObj={},this._isHidden=!0,this._error={},this._warning={};var i={onActivityStart:this.addActivityView,onActivityProgress:this.updateActivityView,onActivityComplete:this.removeActivityView,onActivityFailure:this.removeActivityView};n.additionalEventProducer&&this.listenTo(n.additionalEventProducer,i);var o=s.events;this.listenTo(o,i),this._activityCount=0},render:function(){return this.container.setHTML(c({title:l("E6WCommonApps.ProgressBar.Title")})),this._parent.apply(this,arguments),this.container.toggleClassName("hidden",this._isHidden),this},toggleMinimizedMaximized:function(){var e=this.getPopupOver(),t=e.getElement(".minimize-btn"),n=t.hasClassName("fonticon-down-open");t.toggleClassName("fonticon-down-open",!n),t.toggleClassName("fonticon-up-open",n),e.toggleClassName("minimized")},cancel:function(){this.close()},getPopupOver:function(){return this.getElement(".popover")},getPopupOverBody:function(){return this.getElement(".popover-body")},updateActivityView:function(t){var n=e.clone(t||{},!1),s=n.activity,i=s.name+"_"+s.id,o=this._activityElementObj[i],a=this._progressBarObj[i],r=o.getElement(".process-log"),c=o.getElement(".status");c.setText(l("E6WCommonApps.ProgressBar.Processing")),o.addClassName("processing");var p=Math.ceil(100*t.loaded/t.total);if(n.log&&isNaN(p)&&(p=a.value||0),isNaN(p)||"fail"===n.type?(o.removeClassName("processing"),c.setText(l("E6WCommonApps.ProgressBar.Failure"))):a.value=p,"error"===n.type||"fail"===n.type){var u=this._error[i]||[];u.push(n.log),this._error[i]=u}if("warning"===n.type){var h=this._warning[i]||[];h.push(n.log),this._warning[i]=h}n.log&&(o.removeClassName("no-log"),e.createElement("li",{class:d[n.type],html:n.log}).inject(r))},removeActivityView:function(e){var t=e.name+"_"+e.id,n=this.getPopupOverBody(),s=this._activityElementObj[t],i=this._progressBarObj[t],o=this;if(this._activityCount--,0===this._activityCount&&0===Object.keys(this._error).length&&0===Object.keys(this._warning).length)this._hideTimeout=setTimeout(function(){o.close()},1e3);else if(this._error[t]||this._warning[t])if(this._error[t])this._error[t]&&(i.emphasize="high-attention");else{s.removeClassName("processing"),s.getElement(".status").setText(l("E6WCommonApps.ProgressBar.Completed"))}else n.removeChild(s),delete this._activityElementObj[t],delete this._progressBarObj[t]},addActivityView:function(t,n){var s=e.clone(n||{},!1);this.show(),this._activityCount++,t.id=t.id?t.id:(new Date).getTime();var i=this.createActivityView(t,s);this.getPopupOverBody().appendChild(i),this._activityElementObj[t.name+"_"+t.id]=i},createActivityView:function(t,n){var s=e.clone(n||{},!1).update?l("E6WCommonApps.ProgressBar.Updating"):l("E6WCommonApps.ProgressBar.Pending"),a=e.createElement("div",{id:t.name+"_"+t.id,class:"task-view no-log"}),r=new i({items:[{id:t.id,header:t.name,content:new e.Element("ul",{class:"process-log"})}],style:"simple"}).getContent(),d=r.getElement(".wux-controls-expander-header"),c=new o({value:0,statusFlag:!1}).inject(d);return this._progressBarObj[t.name+"_"+t.id]=c,e.createElement("div",{class:"status",text:s}).inject(d),r.inject(a),a},destroy:function(){this._parent(),this._hideTimeout&&clearTimeout(this._hideTimeout)},show:function(){this._isHidden=!1,this.container.toggleClassName("hidden",this._isHidden)},hide:function(){this._isHidden=!0,this.container.toggleClassName("hidden",this._isHidden)},close:function(){this.hide(),this._error={},this._warning={},this._activityElementObj=[],this._progressBarObj=[],this._activityCount=0,this.getPopupOverBody().empty()}})}),define("DS/E6WCommonApps/Views/LinkLauncherUtils",["UWA/Core","UWA/Promise","DS/RDFFoundation/SecurityContextUtils","DS/E6WCommonUI/Views/ObjectCardView","DS/E6WCommonUI/PlatformManager","DS/TransientWidget/TransientWidget","DS/E6WCommonUI/WidgetUtils","DS/PlatformAPI/PlatformAPI","UWA/Class/Collection","DS/E6WCommonAppsLightbox/Views/Lightbox","i18n!DS/E6WCommonUI/assets/nls/E6WCommonUINLS"],function(e,t,n,s,i,o,a,r,l,d,c){"use strict";var p=["VPMReference","Drawing","XCADModelRepReference","SLDPRT",".SLDPRT","SLDASM",".SLDASM","SLDDRW",".SLDDRW"],u=["VPMReference","VPMRepReference","Drawing","XCADNonPSBaseRepReference","CATPart",".CATPart","CATProduct",".CATProduct","CATShape",".CATShape","CATDrawing",".CATDrawing","CATAnalysis",".CATAnalysis","CATAnalysisResults",".CATAnalysisResults","CATAnalysisComputation",".CATAnalysisComputation","CATProcess",".CATProcess","CATMaterial",".CATMaterial"],h=["person","pno:person","Simulation","Simulation Template"],m=["Project Management","Route"],T=function(e){return c.get(e)},g={showPreview:function(e){var t=e&&e.get("parentTypes");if(t&&t.length&&t.find(e=>m.includes(e)))return!1;var n=e&&e.get("type"),s=e&&e.serviceHosting;return("3DSpace"===s||"3DDrive"===s)&&!h.includes(n)},launchProperties:function(e,t){var n=t&&t.model,s=n&&n.serviceHosting,i=n&&n.tenant,o=n&&n.physicalId||e,r={model:{objectId:o,tenant:i,source:s}};switch(n.sourceName&&(r.model.sourceName=n.sourceName),s){case"3DSwym":case"3dplan":case"geoservice":case"3dportfolio":case"fedsearch":r.model.sourceName=n.sourceName,r.model.source="fedsearch",r.model.objectId=n.fedSearchIdQuery,r.model["ds6w:type"]=n.get("ds6w:type")||n.get("dsxplan:jsType");break;case"3DDrive":r.model.sourceName="drive"}let l=!0;if(g.showPreview(n)){sessionStorage.setItem(a.getSessionId(),widget.getView().type),widget.dispatchEvent("onViewRequest",{type:"fullscreen"});var c=this;(l=g.getPropertiesElement(r.model)).then(function(e){var s={inode:n,properties:e,actions:[c.getDownloadButton&&c.getDownloadButton(t)],config3dPlay:g.get3DPlayOptions(n)};if(!g.lightbox){const e=d.init(s);widget.body.prepend(e),g.lightbox=e}g.lightbox.toggleVisibility(!0),g.lightbox.animationFrameId=window.requestAnimationFrame(function(){g.lightbox.refresh(s)})})}else require(["DS/LifecycleControls/EditPropDialog"],function(e){new e({ID:"propFor"+o}).launchProperties(r)});return l},get3DPlayOptions:function(t){const s={contextId:n.getDefaultSecurityContext(),physicalid:t.get("physicalId"),serverurl:i.getServiceUrl(t.serviceHosting),tenant:t.get("tenant")||i.getTenant()};return"3DDrive"===t.serviceHosting?e.extend(s,{provider:"FILE",filename:t.get("preview_url"),format:t.get("fileExtension")}):e.extend(s,{provider:"EV6",dtype:t.get("type"),requiredAuth:"passport"}),{asset:s}},getPropertiesElement:function(e){return new t(function(t,n){require(["DS/EditPropWidget/models/EditPropModel","DS/EditPropWidget/constants/EditPropConstants","DS/EditPropWidget/EditPropWidget"],function(n,s,i){var o=new n(e),a=new i({className:"editTaskProperties",setEditButton:!1,readOnly:!0,typeOfDisplay:s.ONLY_EDIT_PROPERTIES,selectionType:s.NO_SELECTION,multiselection:!1,collapseTabs:!1,context:widget,actions:[]});a.initDatas([o]),t(a.elements.container.elements)},function(e){n(e)})})},polymorphicOpenMenuItem:function(t,n,s,i){var o=this,a=e.clone(t||{},!1),r=this._getAddInMode(),d=i.normalizedGet(i.model,i._config.name);d=e.is(d,"array")?d[a.index||0]:d instanceof l?d.at(a.index||0):d;var c;if(!((c=this._isDPMProject(i,d))||d.getObjectType&&"Project"===d.getObjectType())){a.isProjectOrPlan=c,a.model=d,a.isProject=!1,a.isURL="URL"===i.normalizedGet(d,"type");var p=i.normalizedGet(d,"physicalId")||d.id;return c&&(a.handler=function(){o.openDPMProject(p)}),a.isURL&&(a.handler=function(){window.open(i.normalizedGet(d,"linkURL"),"_blank")}),"solidworks"===r&&this.isSolidWorksFile(a.model)||"catiav5"===r&&this._isCatiaFile(a.model)?this.getAddInOpenMenuItem(a,n,s,i):this.getWebAppOpenMenuItem(a,n,s,i)}},_isDPMProject:function(e,t){var n=t.get("parentTypes");return"Project Space"===e.normalizedGet(t,"type")||n&&n.includes("Project Space")},openDPMProject:function(e){window.open(this.getProjectURL(!1,e),"projectWindow")},openInApp:function(e){var t=e.getLaunchOptions(),n=t.appId;delete t.appId,o.showWidget(n,"",t)},getProjectURL:function(e,t){var n="ENOPRPR_AP",s=window.enoviaServer["3DSpace"],i=encodeURIComponent(window.enoviaServer.tenant),o=s+"/emxLogin.jsp?appName="+n+"&physicalId="+encodeURIComponent(t);return e&&(n=e?"ENXPLAN_AP":"ENXPLAW_AP",o=this.getDashboardUrl(t,n)),o+="&tenant="+i,o+="&x3dPlatformId="+i},getDashboardUrl:function(e,t){return t=t||widget.getValue("appId"),window.enoviaServer["3DDashboard"]+"#app:"+t+"/content:ids="+encodeURIComponent(e)},getAddInOpenMenuItem:function(e,t,n){var s=this._getAddInMode(),i="solidworks"===s&&this.isSolidWorksFile(e.model)||"catiav5"===s&&this._isCatiaFile(e.model);return{className:t+(i?"":" disabled"),text:T("E6WCommonUI.Label.Open"),fonticon:"open",handler:function(){return i&&r.publish("webinwin:web:notification",JSON.stringify({operation:"open/setObject",operationVersion:"1.0",content:[{phid:e.model.get("physicalId")}]})),n.apply(this,arguments)}}},getWebAppOpenMenuItem:function(e){var t;return(e.isProjectOrPlan||e.isURL)&&(t={id:"open",text:T("E6WCommonUI.Label.Open"),fonticon:"open",handler:e.handler}),t},isSolidWorksFile:function(e){var t=e.get("type"),n=e.get("busType");return-1!==p.indexOf(t)||-1!==p.indexOf(n)},_isCatiaFile:function(e){var t=e.get("type"),n=e.get("busType");return-1!==u.indexOf(t)||-1!==u.indexOf(n)},_getAddInMode:function(){return widget.getValue("addinmode")}};return g}),define("DS/E6WCommonApps/Views/E6WCustomUomView",["UWA/Core","DS/E6WCommonUI/Views/UomView"],function(e,t){"use strict";return t.extend({_uwaClassName:"E6WCustomUomView",isValidInput:function(){return!0}})}),define("DS/E6WCommonApps/CommonAppsHandlebarsHelper",["DS/Handlebars/Handlebars","text!DS/E6WCommonApps/assets/templates/showhidearrow.html.handlebars"],function(e,t){"use strict";return{registerPartials:function(){e.registerPartial("showHideArrow",t)}}}),define("DS/E6WCommonApps/TaskUtils",["DS/E6WCommonApps/Models/E6WCommonAppsConstants","DS/E6WCommonUI/TopBarSearchDispatcher"],function(e,t){"use strict";return{useFTS:function(){var n=widget.getValue(e.LEVEL_PREF)===e.ALL_LEVEL_TASKS,s=Boolean(t.getSearchString());return n||s}}}),define("DS/E6WCommonApps/TaggerChipColorMixin",["UWA/Core","UWA/Class/Listener","DS/E6WCommonApps/ColorUtil","DS/E6WCommonApps/Models/E6WCommonAppsConstants","i18n!DS/E6WCommonApps/assets/nls/E6WCommonAppsNLS","i18n!DS/E6WCommonApps/assets/nls/CollaborativeTasksNLS"],function(e,t,n,s,i,o){"use strict";var a=function(e){var t=o.get(e);return t===e&&(t=i.get(e)),t},r={_stopListeningToTaggerEvents:function(){this.stopListening&&this.stopListening(void 0,"onChangeTaggerColoring")},addTaggerChipColorChangeEvents:function(t){var n=e.clone(t||{},!1).model||this.model;this._stopListeningToTaggerEvents(),this.listenTo(n,"onChangeTaggerColoring",function(){this.colorTaggerChip(t)})},addTaggerChipColorChangeEventsForMilestoneGroupView:function(){var e=this;this._stopListeningToTaggerEvents(),this.options.milestoneCollection.forEach(function(t){let n=t.rdfModel||t;e.listenTo(n,"onChangeTaggerColoring",function(){var s={container:e.getBody().getElement('li[milestone-id="'+t.id+'"]'),model:n};e.colorTaggerChip.apply(s)})})},colorTaggerChip:function(t){var s=e.clone(t||{},!1).model||this.model,i=this.container;if(s.tagColor){i.style.setProperty("--te-fill",s.tagColor);const e=n.getHighlightColorForTaggedObject(s.tagColor);i.style.setProperty("--te-highlight",e),i.toggleClassName&&i.toggleClassName("tag-color",!0)||i.classList.add("tag-color")}else i.removeClassName&&i.removeClassName("tag-color")||i.classList.remove("tag-color"),i.style.removeProperty("--te-fill"),i.style.removeProperty("--te-highlight")},getTaggerChipElement:function(){return e.createElement("span",{class:"tag-color-chip"})},getMilestoneTaggerChipElement:function(){var e=this.createSVGElement("svg",{class:"tag-color-chip",width:8,height:16,x:0,y:2,viewBox:"0 0 8 16"});return this.createSVGElement("path",{class:"badge",d:"M6,16H2c-1.1,0-2-0.9-2-2V2c0-1.1,0.9-2,2-2h4c1.1,0,2,0.9,2,2v12C8,15.1,7.1,16,6,16z"}).inject(e,"top"),e},setTaggerColorMap:function(e){var t={"ds6w:why/ds6w:priority":[{object:a("E6WCommonApps.Label.Low"),type:"string",color:"#57b847"},{object:a("E6WCommonApps.Label.Medium"),type:"string",color:"#00b8de"},{object:a("E6WCommonApps.Label.High"),type:"string",color:"#e87b00"},{object:a("E6WCommonApps.Label.Urgent"),type:"string",color:"#ea4f37"}],"ds6w:what/ds6w:status":[{object:a("emxCollaborativeTasks.Label.ToDo"),type:"string",color:s.TODO_STATE_COLOR},{object:"Project Task.Assign",type:"string",color:s.TODO_STATE_COLOR},{object:"Project Task.Create",type:"string",color:s.TODO_STATE_COLOR},{object:a("emxCollaborativeTasks.Label.InWork"),type:"string",color:s.IN_PROGRESS_STATE_COLOR},{object:"Project Task.Active",type:"string",color:s.IN_PROGRESS_STATE_COLOR},{object:"Project Task.Review",type:"string",color:s.IN_PROGRESS_STATE_COLOR},{object:a("emxCollaborativeTasks.Label.Completed"),type:"string",color:s.DONE_STATE_COLOR},{object:"Project Task.Complete",type:"string",color:s.DONE_STATE_COLOR}]};e.setColorMap(t)},TAG_COLOR_CLASS:"tag-color",TAG_COLOR_CHIP_CLASS:"tag-color-chip"};return r}),define("DS/E6WCommonApps/SmartSchedulerUtils",["UWA/Core","DS/RDFFoundation/RDFUtils","DS/RDFFoundation/Models/ComponentProxyModel","DS/RDFFoundation/SecurityContextUtils","DS/E6WCommonUI/UIHelper","DS/Foundation2/FoundationV2Data","DS/Foundation2/Models/FoundationV2Model","DS/E6WCommonApps/Views/LinkLauncherUtils","DS/E6WCommonApps/Views/DocumentFileChooserPopup","i18n!DS/E6WCommonApps/assets/nls/E6WCommonAppsNLS","i18n!DS/E6WCommonUI/assets/nls/E6WCommonUINLS"],function(e,t,n,s,i,o,a,r,l,d,c){"use strict";var p=function(e){var t=d.get(e);return t===e&&(t=c.get(e)),t},u={getCompletedTaskFilter:function(){var e="all",t=widget.getValue(u.COMPLETED_TASK_PREF_NAME);if(t&&"all"!==t){var n=new Date;n.setDate(n.getDate()-t),e=n.toISOString()}return e},setCompletedTaskFilter:function(e){widget.setValue(u.COMPLETED_TASK_PREF_NAME,e)},getCompletedTasksFilterPref:function(e){return{name:u.COMPLETED_TASK_PREF_NAME,type:"list",defaultValue:e,options:[{label:p("E6WCommonApps.Label.CompletedTasksLast10Days"),value:10},{label:p("E6WCommonApps.Label.CompletedTasksLast30Days"),value:30},{label:p("E6WCommonApps.Label.CompletedTasksLast60Days"),value:60},{label:p("E6WCommonApps.Label.CompletedTasksAllDays"),value:"all"}],label:p("E6WCommonApps.Label.CompletedTasksDisplayPref")}},getDropDownMenuItems:function(e,t){var n=Boolean(this._config.readWrite),s=this.normalizedGet(this.model,this._config.name),i="Project"===this.normalizedGet(s,"type"),o=widget.xPlanApp&&widget.xPlanApp.getManagementView(),a=[o?u.getOpenMenuConfig(s,o):u.getPreviewMenuConfig(s,i),u.getDetachMenuConfig.call(this,n,t)];if(s){var r=u.getPropertiesMenuConfig.call(this,t);a.splice(0,0,r)}return a},fetchParentTypesWithCallback:function(e,t){if("3DSpace"!==(e.serviceHosting||"3DSpace")||e.get("parentTypes"))t();else{var n=i.getParentTypesFromMap(e.get("type"));n?(e.set("parentTypes",n,{silent:!0}),t()):this.fetchParentTypes(e,{onComplete:function(){t()}})}},fetchParentTypes:function(e,t){var s=e.id;e instanceof n&&(s=s.replace("dscom:3DSpace_",""));var a={url:"/resources/v3/e6w/service/ParentTypes/"+s,type:"GET",callback:function(n){if(n.error&&t.onComplete&&t.onComplete.apply(e,arguments),n&&n.data&&n.data[0]){var s=n.data[0].parentTypes;e.set("parentTypes",s,{silent:!0}),i.addToParentTypesMap(e.get("type"),s),t.onComplete&&t.onComplete.apply(e,arguments)}},dataType:"json",headers:{"content-type":"application/json"}};o.ajaxRequest(a)},getPreviewMenuConfig:function(e){return{text:p("E6WCommonApps.Label.Open"),fonticon:"open",name:"preview-button",className:e.hasViewAccess&&!e.hasViewAccess()?" disabled":"",handler:function(){r.openInApp(e)}}},getDetachMenuConfig:function(e,t){var n=this;return{text:p("E6WCommonApps.Label.Detach"),fonticon:"link-off",name:"detach-button",className:n.normalizedGet(n.model,"canEdit")&&e?"":" hidden",handler:function(){var e=n._config.name;if("commonTaskParent"===e){var s=d.replace(p("E6WCommonApps.Alert.TaskDetach"),{OBJECT_NAME:n.model.get("title")});i.displayWarning(s)}n.model.remove(e,t.index,t.options)}}},getOpenMenuConfig:function(e,n){var s=n.currentModel===e;return{text:p("E6WCommonApps.Label.Open"),fonticon:"open",name:"open-project-button",className:e.hasViewAccess&&!e.hasViewAccess()||s?"disabled":"",handler:function(){n.collection.add(e),n.skel.setRoute("/projects/"+t.removeBracketLongURI(e.id)+"/"+n._getDefaultFacet()+"/")}}},getPropertiesMenuConfig:function(e){var t=this;return{text:p("E6WCommonApps.Command.Properties"),fonticon:"attributes",handler:function(){t.objectClick(e.event)},name:"propertiesButton"}},getDividerConfig:function(){return{className:"divider"}},getEditMenuConfig:function(e,t,n){var s=t.currentModel===e;return{text:p("E6WCommonApps.Label.Edit"),fonticon:"pencil",handler:function(){t.openPropertyPanel({modelIsRoot:s,selectedModel:e,isShadowMilestone:n})}}},getFlexibleConfig:function(e){var t=e.canEnforce()||!e.hasFetchedAccessData(),n=e.get("dsxplan:isEnforced");return void 0===n&&(n=!0),{text:p("E6WCommonApps.Label.flexible"),fonticon:"dependency",className:t?"":"disabled",selectable:!0,selected:!n,handler:function(){var t=p(n?"E6WCommonApps.Alert.ConstraintNotEnforced":"E6WCommonApps.Alert.ConstraintEnforced"),s={};s["dsxplan:isEnforced"]=!n,e.save(s,{onComplete:function(){i.displaySuccess(t)},onFailure:function(){i.displayError(p("E6WCommonApps.Error.ConstraintEnforceFailed"))}})}}},getDeleteMenuConfig:function(e,t){var n=e.canDelete()||!e.hasFetchedAccessData();return{text:p("E6WCommonApps.Label.Delete"),fonticon:"trash",className:n?"":"disabled",handler:t}},getPinMenuConfig:function(e,t){var n=e.isFixed();return{text:p(n?"E6WCommonApps.Label.Unpin":"E6WCommonApps.Label.Pin"),fonticon:n?"pin-off":"pin",className:!e.canModify()||e.isComplete()?"disabled":"",handler:t}},getBookmarkURLMenuConfig:function(e){return{id:"bookmarkButton",text:p("E6WCommonApps.Label.CopyBookmark"),title:p("E6WCommonApps.Label.CopyBookmark"),fonticon:"link",handler:function(){var t=e.get("physicalId")||e.id,n=e.getObjectType&&"Project"===e.getObjectType(),s=n?r.getProjectURL(n,t):r.getDashboardUrl(t);i.copyTextToClipboard(s),i.displaySuccess(p("E6WCommonApps.Alert.BookmarkCopied"))}}},fetchTemplates:function(e){if(this.templateObjects)e.onComplete(this.templateObjects,!1);else{var n=JSON.stringify(["dsplan:Project"]);this.templateObjects=[],this.templateObjects.push({actualValue:"TeamProject",displayValue:p("E6WCommonApps.Label.DefaultProject")});var s=this;t.request(t.expandUrl("/invoke/dsxplan:getTemplates?$mask=dsplan:MVMask.Template.Basic","v0"),{method:"POST",type:"json",data:n,headers:{"Content-Type":"application/json"},onComplete:function(t){if(t){var n=t.member;n&&(s.templateObjects=s.templateObjects.concat(n.map(function(e){return{actualValue:e["@id"],displayValue:e["dskern:nlsLabel"]}})))}e.onComplete(s.templateObjects,!0)},onFailure:function(){e.onFailure(s.templateObjects,!0)}})}},getDocumentServiceDropDownMenuItems:function(e,t){require(["DS/DocumentCommands/ENOXDocumentCommands"],n=>{var i=e.get("dscom:Tenant")||enoviaServer.tenant,o=enoviaServer["3DSpace"],a=enoviaServer["3DDashboard"],r=e.get("type")||e.get("@type"),l=s.getDefaultSecurityContext(),d={document:{id:e.get("physicalId"),contextId:l,serviceId:"3DSpace",envId:i,index:1,data:{id:e.get("physicalId"),title:e.get("title")},type:r},platformUrls:{"3DSpace":o,"3DDashboard":a}};d.document.filesCallback=function(n){e._actionsData=n,t(n)};var c=new n;c.init(d);var p=window.enoviaServer&&window.enoviaServer.space;c.render(),(window.enoviaServer&&window.enoviaServer.space)!==p&&(window.enoviaServer.space=p)})},getDocumentTypeDropDownMenuItems:function(e,t,s){var i=this.options?this.options.docMenuItems:t,o=t.model||s,r=this.getDropDownMenuItems(e,t);if(o instanceof a||o instanceof n&&"3DSpace"===o.serviceHosting){var l=u.updateMenuItemsWithDocumentCommands.bind(this,i,r,o);u.fetchParentTypesWithCallback(o,l)}return r},updateMenuItemsWithDocumentCommands:function(e,t,n){var s=n.get("parentTypes");if(s&&s.includes("DOCUMENTS")){var i=t.findIndex(e=>"documentUpdateButton"===e.id),o=i>0,a=function(e){i=e.findIndex(e=>"documentUpdateButton"===e.id),o&&e.splice(i,1)};if(o)if(e.Edit)a(t),t.splice(1,0,e.Edit);else if(e.UndoEdit){if(e.Update){var r=t[i];a(t),t.splice(1,0,r)}t.splice(2,0,e.UndoEdit)}}return t},createDocumentUpdateModal:function(e,t){this.fileChooserModal=new l({renderTo:widget.body,docModel:e,updateDocumentCallback:t})},findIndex:function(e,t,n){return(e=e&&e.length&&(e.findIndex?e:e.toArray()))&&e.findIndex(e=>e[t]===n)},COMPLETION_DATE_TASK_FILTER_ATTR:"fromCompletionDate",COMPLETED_TASK_PREF_NAME:"completedTasksDisplayPref",COMPLETED_TASK_FILTER_ALL_DAYS:"all",COMPLETED_TASK_FILTER_30_DAYS:"30"};return u}),define("DS/E6WCommonApps/Models/AddTaskMixin",["UWA/Core","DS/E6WCommonApps/Models/E6WCommonAppsConstants","DS/RDFFoundation/RDFUtils"],function(e,t,n){"use strict";var s={addTask:function(n,s){var i=e.clone(n||{},!1),o=this.getDefaultTaskAttributes(),a="RDFTaskModel"===this._uwaClassName?"dsxplan:hasSubtask":"dsxplan:hasTask";o[t.SEQUENCE_ORDER_ATTR]=this._getDefaultSequenceOrderForAttribute(a);var r=i[t.DURATION_MIN];e.is(r,"number")&&(i[t.DURATION_MIN]=this.getDurationString(r));var l=i[t.DURATION_MAX];e.is(l,"number")&&(i[t.DURATION_MAX]=this.getDurationString(l)),e.extend(o,i);var d=e.clone(s||{},!1);d._defaultModel=void 0;var c=this._addScheduleElement(this.TASK_RELATION_ATTR,o,d);return c.newThisSession=!0,c},getDefaultTaskAttributes:function(){var e=new Date,n={};return n["@type"]=t.TASK_RDF_TYPE,n[t.TITLE_ATTR]="Task",n[t.DURATION_MIN]=this.getDurationString(1),n[t.DURATION_MAX]=this.getDurationString(1),n[t.STARTDATE_ATTR]=e,n[t.ENDDATE_ATTR]=new Date(e.getTime()+864e5),n[t.COMPLETE_PERCENT_ATTR]=0,n[t.PRIORITY_ATTR]={"@id":"dsxplan:Medium"},n},getDurationString:function(e){return n.millisecondsToXsdDayTimeDuration(8*parseFloat(e)*60*60*1e3)},_addScheduleElement:function(n,s,i){var o=e.clone(s||{},!1),a=enoviaServer.useFD01CodeFor3DPlan?"Open":{"@id":"dsxplan:Open"};o[t.DESCRIPTION_ATTR]=o[t.DESCRIPTION_ATTR]||"",o[t.STATE_ATTR]=o[t.STATE_ATTR]||a,o[t.CONTENT_REPOSITORY]=o[t.CONTENT_REPOSITORY]||this.get(t.CONTENT_REPOSITORY),o["dsxplan:usesCalendar"]=this.get("dsxplan:usesCalendar"),this.isDSLC()&&(n=this.dslcMapping[n]);var r=this.addModelToAttributeWithCollection(n,o,i);return this._registerAsElementParent(r),r},_getDefaultSequenceOrderForAttribute:function(e){var t=Math.random(),n=s.RapidRDFModelRegistry?s.RapidRDFModelRegistry.getRapidModelByURI(this.id):void 0,i=n||this;if(i.hasFetchedAttribute(e))return this.computeAndReturnCorrectSequenceNumber(t,i,e)},computeAndReturnCorrectSequenceNumber:function(e,n,s){var i=n.get(s).last();return i&&(void 0===(e=i.get(t.SEQUENCE_ORDER_ATTR_DSLC))&&(e=0),e+=Math.random()),e}};return s}),define("DS/E6WCommonApps/Models/TaskModelMixin",["UWA/Core","UWA/Promise","DS/E6WCommonUI/UIHelper","DS/PlatformAPI/PlatformAPI","DS/E6WCommonApps/SmartSchedulerUtils","UWA/Utils","DS/E6WCommonApps/Models/E6WCommonAppsConstants","DS/E6WCommonUI/PlatformManager","i18n!DS/E6WCommonApps/assets/nls/CollaborativeTasksNLS"],function(e,t,n,s,i,o,a,r,l){"use strict";var d=function(e,t,n){var s=new Date(n);return e<t?s.setHours(s.getHours()+1):s.setHours(24),s},c={OWNERATTR:"ownerInfo",DPMPROJECTATTR:"DPMProject",ASSIGNEESATTR:"assignees",REFERENCEATTR:"references",SCOPESATTR:"scopes",DUEDATECATEGORY:a.DUE_DATE_CATEGORY,DUEDATEATTR:"dueDate",ACTUALSTARTDATEATTR:"actualStartDate",_categories:["PAST_DUE","NO_DATE","DUE_TODAY","DUE_TOMORROW","DUE_THIS_WEEK","DUE_FUTURE"],isComplete:function(){return"Complete"===this.get("state")},_onRequest:function(e){this.nbInFlightRequests++,1===this.nbInFlightRequests&&this.dispatchEvent("onChange:nbInFlightRequests",[this,e])},_onCompleteRequest:function(e){this.nbInFlightRequests--,this.nbInFlightRequests=this.nbInFlightRequests<0?0:this.nbInFlightRequests,0===this.nbInFlightRequests&&this.dispatchEvent("onChange:nbInFlightRequests",[this,e])},add:function(t,n,s){var i=e.clone(s||{}),o=i.onFailure,a=i.onComplete,r=this;i.onComplete=function(){r._onCompleteRequest(),a&&a.apply(this,arguments)},i.onFailure=function(){r._onCompleteRequest(),o&&o.apply(this,arguments)};var l,d=n.split(",").map(function(e){return e.trim()});return(l=this.addObjects(d,t))&&l.length&&(this._onRequest(),l[0].save(void 0,i)),l},addSelfAssignToInWorkMessage:function(){var t=n.setHelper.apply(this,arguments).options||{},s=t.onComplete,i=this.get("title");e.extend(t,{onComplete:function(){s.apply(this,arguments);var e,t=(e="emxCollaborativeTasks.Label.InWorkTaskSelfAssigned",l.get(e));t=t.replace("%TASK_TITLE%",i),n.displaySuccess(t)}})},remove:function(t,n,s){var i=this.removeObject(t,n),o=e.clone(s||{}),a=o.onFailure,r=o.onComplete,l=this;return o.onComplete=function(e,t,n){l._onCompleteRequest(n),r&&r.apply(this,arguments)},o.onFailure=function(e,t,n){l._onCompleteRequest(n),a&&a.apply(this,arguments)},i&&(this._onRequest(),i.save(void 0,o)),i},fetchDeliverableParentTypes:function(e){const s=function(){const t=n.parentTypesMap[this.get("type")];t&&-1!==t.indexOf("VPMReference")&&e.push(this.get("physicalId"))},o=[];return(()=>{const e=this.getDeliverables();if(e&&e.length>0){const a={};e.forEach(function(e){const t=e.get("type");n.parentTypesMap[t]?s.call(e):a[t]=e}),Object.values(a).forEach(function(e){o.push(new t(function(t,n){i.fetchParentTypes(e,{onComplete:function(){s.call(this),t()},onFailure:n})}))})}return t.all(o)})()},markDeliverablesOn3DNavigate:function(){if(r.is3DViewerPresent()){var e=[];let t={metadata:{ignoreFromSameWidgetId:!1,appid:widget&&widget.getValue("appId"),originUid:this.id,originWidgetId:widget&&widget.id,timestamp:Date.now(),uid:o.getUUID()},data:{intent:"focus",referenceIds:e}};this.fetchDeliverableParentTypes(e).then(function(){e.length&&s.publish("DS/PADUtils/PADCommandProxy/focus",t)})}},getMappedAttribute:function(e){return this.rdfCollabTaskInverseMapping&&this.rdfCollabTaskInverseMapping[e]||e},removeAssigneeByIndex:function(e){return this.removeObject(this.ASSIGNEESATTR,e)},addReferencesById:function(e){return this.addObjects(e,this.REFERENCEATTR)},sync:function(e,t,n){var s=Array.prototype.slice.call(arguments,0),i=n.onFailure,o=n.onComplete,a=this;n.onFailure=function(e,t,n){a._onCompleteRequest(n),n&&(n.response=t),i&&i.apply(this,arguments)},n.onComplete=function(e,t,n){a._onCompleteRequest(n),o&&o.apply(this,arguments)},a._onRequest(n),this._parent.apply(this,s)},dueDateCategory:function(t){var n=void 0===t?this.get("dueDate"):t,s="NO_DATE";if(n=e.is(n,"string")?parseInt(n,10):n,(n=e.is(n,"number")||n instanceof Date?new Date(n):n)instanceof Date)if(isNaN(n))s="NO_DATE";else{n.setHours(0,0,0,0);var i=new Date;i.setHours(0,0,0,0);var o=n-i;if(o<0)s="PAST_DUE";else if(0===o)s="DUE_TODAY";else{var a=new Date(i);if(a.setDate(a.getDate()+1),n.getTime()===a.getTime())s="DUE_TOMORROW";else s=(o=n-this.dateHelper.getLastDayofThisWeek())<0?"DUE_THIS_WEEK":"DUE_FUTURE"}}return s},dueDateCategory2DueDate:function(e){var t,n=this.dateHelper;switch(e){case"DUE_TOMORROW":t=n.getTomorrow();break;case"DUE_TODAY":t=n.getToday();break;case"NO_DATE":t=new Date(NaN);break;case"PAST_DUE":t=n.getPast();break;case"DUE_THIS_WEEK":t=n.getLastDayofThisWeek();break;case"DUE_FUTURE":t=n.getFuture()}return t},dateHelper:{ONE_DAY:864e5,THIRTY_DAYS:2592e6,getLocaleDate:function(e){return e.toLocaleDateString()},getToday:function(){var e=new Date;return e.setHours(23,59,59,999),e},getTomorrow:function(){var e=new Date((new Date).getTime()+this.ONE_DAY);return e.setHours(23,59,59,999),e},getFuture:function(){var e=new Date((new Date).getTime()+this.THIRTY_DAYS);return e.setHours(23,59,59,999),e},getPast:function(){var e=new Date((new Date).getTime()-this.ONE_DAY);return e.setHours(23,59,59,999),e},getLastDayofThisWeek:function(){var e=new Date;e.setHours(23,59,59,999);var t=(e.getDay()+6)%7;return e.setDate(e.getDate()-t+4),e}},isAtRisk:function(){if(this.isProjectTask())return"behindSchedule"===this.get("status");var e=this.isComplete(),t=this.get(this.DUEDATEATTR);if(e||!t)return!1;var n=!1,s=this.getStartDate(),i=s instanceof Date?s.getTime():Date.parse(s),o=this.getPercentComplete();if(i&&o>=0){var a=new Date(i+(t.getTime()-i)*(o/100));n=new Date>d(this.getDuration(),this.getWorkingHoursInMilliseconds(),a)}return n},isLate:function(){if(this.isProjectTask())return"late"===this.get("status");var e=this.isComplete(),t=this.get(this.DUEDATEATTR);if(e||!t)return!1;var n=d(this.getDuration(),this.getWorkingHoursInMilliseconds(),t);return new Date>n},getDuration:function(){var e=this.getDefinedDuration(),t=this.getWorkDayLength()+2;return(isNaN(e)?t:e)*this.getWorkingHoursInMilliseconds()},canAssignToSelf:function(e){return!this.isComplete()&&this.get("canEdit")&&!this.isAssignedToCurrentUser(e)},isAssignedToCurrentUser:function(t){var s=!1,i=t||this.get(this.ASSIGNEESATTR);if(i)for(var o=0;o<i.length;o++){var a=i.at?i.at(o):i[o],r=a&&e.is(a.get,"function")&&a.get("dsaccess:accountName")||a&&a["dsaccess:accountName"];if(n.isLoggedInUser(r)){s=!0;break}}return s},THRESHOLD:36e5};return c}),define("DS/E6WCommonApps/Models/FileManagementMixin",["UWA/Core","DS/DocumentManagement/DocumentManagement","DS/DocumentManagement/DriveDocumentManagement","DS/RDFFoundation/SecurityContextUtils","DS/Foundation/FoundationAjax","DS/E6WCommonUI/UIHelper","DS/RDFFoundation/Models/DriveRepositoryProxyModel","DS/RDFFoundation/RDFUtils","DS/RDFFoundation/Models/ObjectProxyUtil","DS/E6WCommonUI/PlatformManager","DS/E6WCommonApps/Models/E6WCommonAppsConstants","i18n!DS/E6WCommonApps/assets/nls/E6WCommonAppsNLS"],function(e,t,n,s,i,o,a,r,l,d,c,p){"use strict";var u=function(e){return p.get(e)},h={uploadFiles:function(e,t,n){if(e.length>0)for(var s=e.length-1;s>=0;s--)this.uploadFile(e[s],t,n)},imageExtensions:[".gif",".jpg",".png",".gif",".jpeg",".3dxml",".cgr",".pdf",".bpm",".psd",".ai"],_validateBeforeUpload:function(){if(!this.id)throw new Error("Invalid object, cannot upload file on a model not saved yet")},_isImageFile:function(e){var t,n=e.name;e.FileName&&(n=e.FileName);var s=n.lastIndexOf(".");if(-1!==s){var i=n.substring(s);t=-1!==this.imageExtensions.indexOf(i)}return t},_validateFileUploadRepositoryAccess:function(e){var t,n=this.get(c.CONTENT_REPOSITORY),i=e.driveFolderProxyId||e.collabspaceId;return!i&&n&&(i=n.id),i?i&&i.startsWith(a.ID_PREFIX)?(n=r.getObjectById(i))&&!n.hasViewAccess()&&(t=u("E6WCommonApps.Error.NoContentRepositoryAccess")):s.hasAccessToContentRepository(i)||(t=u("E6WCommonApps.Error.NoContentRepositoryAccess")):t=s.getUsersContentRepositories().length>0?u("E6WCommonApps.Error.NoContentRepository"):u("E6WCommonApps.Error.NoContentRepositoryAndNoneAvailable"),t},getDriveRepositoryId:function(e){var t,n=e.driveFolderProxyId,s=this.get(c.CONTENT_REPOSITORY);return n||(n=s&&s.id),n&&n.startsWith(a.ID_PREFIX)&&(t=(s=r.getObjectById(n))&&s.get("physicalId")),t},_onFileUploadComplete:function(t,n,s,i){this._fileUploadCount--;var o=t;if(t&&t.data&&((o=t.data[0]).dataelements.hasfiles="TRUE"),s&&!n.FileName){var a=window.URL.createObjectURL(n);o.dataelements?o.dataelements.image=a:o.image=a}if(o.type&&"DriveFile"===o.type&&(o.serviceId="3DDrive",o.image||(o.image=o.icon)),i&&e.is(i.onComplete,"function")){var r=i.fileWrapper&&i.fileWrapper.config.singleObjectOnly;i.onComplete(o,i.contextModel,r)}},_onFileUploadFailure:function(t,n){if(this._fileUploadCount--,e.is(n.onFailure,"function")){var s=e.clone(n||{},!1);s.file=t;var i=s.errorMsg||null;n.onFailure(i,s.contextModel,s)}},isUploadingFiles:function(){return Boolean(this._fileUploadCount)},updateDocument:function(s,i,a){var r=i.get("dscom:ServiceHosting"),l=i.get("physicalId"),d=i.get("dscom:Tenant");"3DDrive"===r&&(s=n.getNewBlobFileWithOldName(s,i));var c={id:l,fileInfo:{file:s,comments:a}};t.modifyDocument(c,{tenant:d,serviceId:r,tenantUrl:window.enoviaServer[r],onComplete:function(t,n){var a=e.clone(n||{},!1);a.proxyModel=i,h._updateModificationDate(t,a);var r=s.name.substring(0,s.name.lastIndexOf("."));r!==i.get("title")&&i.set("title",r),o.displaySuccess(u("E6WCommonApps.Alert.UpdateSucess"))},onFailure:function(e){e.internalError?o.displayError(e.internalError):o.displayError(u("E6WCommonApps.Alert.UpdateFail"))}})},_updateModificationDate:function(e,t){if(e){var n=e.modified;"3DSpace"===t.serviceId&&(n=e.data[0].relateddata.files[0].dataelements.modified);var s=l.getDate(n);t.proxyModel.set("modified",s)}}};return h}),define("DS/E6WCommonApps/LiveUpdateUtils",["UWA/Core","UWA/Class/Events","DS/RDFFoundation/RDFUtils","DS/RDFFoundation/MaskUtils","DS/RDFFoundation/Models/ResultModel","DS/E6WCommonApps/Models/E6WCommonAppsConstants"],function(e,t,n,s,i,o){"use strict";var a=new t,r=new WeakMap,l=new WeakMap;function d(e){try{var t=n.getObjectById(e["@id"]);t&&t.get("dsxplan:jsType")!==o.DELETED_PROJECT_RDF_TYPE&&(t.dispatchEvent("onDeleteNotification"),t.destroy({onFailure:Function.prototype,noServer:!0,fromNotification:!0})),a.dispatchEvent("onDeleteNotification",e)}catch(e){console.error(e)}}function c(t){try{var s=function(){var s=n.getModelConstructor(t);if((s.shouldCreateOnLiveUpdate||i.shouldCreateOnLiveUpdate)(t)){var o=e.clone(t,!1);delete o["@parentId"],n.getObjectForAdding(s,t["@id"],{attrs:o}).processLiveUpdateCreation(t)}a.dispatchEvent("onCreateNotification",t)},r=n.getObjectById(t["@id"]);r?r.get("dsxplan:jsType")===o.DELETED_PROJECT_RDF_TYPE&&(r.destroy({onFailure:Function.prototype,noServer:!0,fromNotification:!0}),s()):s(),a.dispatchEvent("onAllCreateNotification",t)}catch(e){console.error(e)}}function p(e){try{n.getExistingAndMerge(e);var t=n.getObjectById(e["@id"]);t&&!e.hasOwnProperty("dsxplan:estimatedEndDate")&&t.unset("dsxplan:estimatedEndDate"),t&&!e.hasOwnProperty("dsxplan:estimatedStartDate")&&t.unset("dsxplan:estimatedStartDate")}catch(e){console.error(e)}}return a.attributeTimestampMap=r,a.ignoreLiveUpdateMap=l,a.shouldBeUpdated=function(e,t,n){return!a.attributeTimestampMap.get(e)||!a.attributeTimestampMap.get(e)[t]||n>a.attributeTimestampMap.get(e)[t]},a.updateAttributeTimestamps=function(e,t,n){if(t){Object.keys(t).forEach(t=>{e.isDSLC()&&e.dslcMapping[t]&&(t=e.dslcMapping[t]),a.attributeTimestampMap.get(e)||a.attributeTimestampMap.set(e,{}),a.attributeTimestampMap.get(e)[t]=n})}},a.addToIgnoreLiveUpdateMap=function(e){l.set(e,!0)},a.resetObjectMap=function(){a.ignoreLiveUpdateMap={}},a.updateFunc=function(e){var t=this;let i=function(e,n){var i=e.id;(t.uniqueMap||(t.uniqueMap={}),t.uniqueMap[i])||(t.uniqueMap[i]=i,r=!0,(n?s.getMinMaskArray(e.getMasks(),{attributes:n}):s.getMinMaskArray(e.getMasks())).forEach(function(n){var s=t.masksToFetch[n]||[];s.push(e.id),t.masksToFetch[n]=s}))};var r=!1,d=n.getObjectById(e["@id"]);if(!d||!l.get(d)){if(d&&e.data){let t=Object.keys(e.data),n={},s=[];t.forEach(function(t){if("operation"===t)return;let i=o.dslcMapping[t]||t;"object"==typeof e.data[t]?s.push(i):e.timeStamp&&a.shouldBeUpdated(d,i,e.timeStamp)&&(n[i]=e.data[t])}),d.save(n,{noServer:!0,fromNotification:!0}),a.updateAttributeTimestamps(d,n,e.timeStamp),0!==Object.keys(s).length&&i(d,s)}else d&&d.get("@etag")!==e.ceStamp&&i(d);return a.dispatchEvent("onUpdateNotification",e),r}l.delete(d)},a.onNotification=function(e){this._notifQueue.push(e),this._notifTimeout||(this._notifTimeout=setTimeout(function(e){delete e._notifTimeout,a.handlenotifications(e._notifQueue)},2e3,this))},a.handlenotifications=function(e){for(var t=Object.create(null),s=Object.create(null),i=[],o=n.getBatchGenerator(),r=function(e,t){try{var s=n.getObjectById(t["@id"]),i=t.data;s&&s.onShareNotification(e,i),a.dispatchEvent("onShareNotification",t)}catch(e){console.error(e)}}.bind(void 0,o),l=function(e,t){try{var s=n.getObjectById(t["@id"]),i=t.data;s&&s.onShareNotification(e,i),a.dispatchEvent("onUnShareNotification",t)}catch(e){console.error(e)}}.bind(void 0,o);e.length;){var u=e.shift();try{u&&u.deleted&&u.deleted.forEach(d),u&&u.shared&&u.shared.forEach(r),u&&u.unshared&&u.unshared.forEach(l),u&&u.updated&&i.splice.apply(i,[1,0].concat(u.updated.filter(a.updateFunc,{masksToFetch:t,uniqueMap:s}))),u&&u.created&&u.created.forEach(c,this),u&&u.updatedRollUp&&u.updatedRollUp.forEach(p)}catch(e){console.error(e)}}if(i.length)for(var h=Object.keys(t),m=h.length,T=0;T<m;T++){var g=h[T],E=t[g];n.complete(void 0,E,{batchGenerator:o,mask:g,animate:!0})}for(;o.requests.length>50;){var A=o.requests.splice(0,50),f=n.getBatchGenerator();f.requests=A,f.sendBatch({waitOnInFlightRequests:!0})}o.sendBatch({waitOnInFlightRequests:!0})},a.NOTIFICATION_PROCESSING_DELAY=2e3,a}),define("DS/E6WCommonApps/Models/RepositoryModelMixin",["UWA/Core","DS/RDFFoundation/RDFUtils","DS/RDFFoundation/Models/DriveRepositoryProxyModel","DS/RDFFoundation/Models/CollabspaceRepositoryModel","DS/E6WCommonApps/Models/E6WCommonAppsConstants","DS/RDFFoundation/SecurityContextUtils","DS/E6WCommonUI/PlatformManager","DS/DocumentManagement/DocumentManagement","DS/E6WCommonApps/Models/NoAccessModel"],function(e,t,n,s,i,o,a,r,l){"use strict";return{_normalizedRepo:function(e){var n=this.getRepositoryModelConstructor(e),s=t.getObjectForAdding(n,e);return s.hasViewAccess()?s:new l},getRepositoryModelConstructor:function(e){return e.startsWith(n.ID_PREFIX)?n:s},uploadFile:function(t,n,s){var l=e.clone(s||{},!1),d=this;this._validateBeforeUpload();var c=this._validateFileUploadRepositoryAccess(l);if(c)l.onFailure&&l.onFailure(c);else{this._fileUploadCount=this._fileUploadCount?this._fileUploadCount+1:1,l.isImage=this._isImageFile(t);var p=e.clone(s||{},!1);p.contextModel=d,l.onComplete=function(e){d._onFileUploadComplete(e,t,l.isImage,p)},l.onFailure=function(n){var s=n&&n.error;s&&e.merge(p,{errorMsg:s}),d._onFileUploadFailure(t,p)},l.csrf=this.csrf,l.securityContext=o.getDefaultSecurityContext(),l.tenant=a.getTenant();var u=this.getDriveRepositoryId(l);l.tenantUrl=u?a.getServiceUrl("3DDrive"):a.getServiceUrl("3DSpace");var h={fileInfo:{file:t},relInfo:l.relInfo,collabspace:!u&&(l.collabspaceId||this.get(i.CONTENT_REPOSITORY).id),driveFolderId:u};r.createDocument(h,l)}}}}),define("DS/E6WCommonApps/Views/E6WObjectCardView",["UWA/Core","DS/UIKIT/DropdownMenu","DS/E6WCommonUI/Views/ObjectCardView","DS/E6WCommonApps/Views/LinkLauncherUtils","DS/E6WCommonApps/SmartSchedulerUtils","DS/RDFFoundation/SecurityContextUtils","DS/RDFFoundation/RDFUtils","DS/E6WCommonUI/UIHelper","DS/Foundation2/Models/FoundationV2Model","DS/RDFFoundation/Models/ComponentProxyModel","DS/E6WCommonApps/Models/E6WCommonAppsConstants","i18n!DS/E6WCommonUI/assets/nls/E6WCommonUINLS","i18n!DS/E6WCommonApps/assets/nls/E6WCommonAppsNLS"],function(e,t,n,s,i,o,a,r,l,d,c,p,u){"use strict";var h=function(e){return!e||!e.hasViewAccess||e.hasViewAccess()},m=function(e){var t=p.get(e);return t===e&&(t=u.get(e)),t},T=[c.WORKSCOPE_PARENT_ATTR,c.PARENT_ATTR,c.COMMON_TASK_PARENT_ATTR],g=n.extend({_uwaClassName:"E6WObjectCardView",getPropertiesButton:function(t){var n=this._parent.apply(this,arguments);return e.extend(n,g.getPropertiesButtonInfo(t.model)),n},getRemoveItemButton:function(t){var n=e.clone(t||{},!1).model;if(n){var s=!1,o=n.getObjectType&&n.getObjectType();if(h(n)&&("Project"!==o&&"Enterprise Project"!==o||-1===T.indexOf(this._config.name)?"Task"===o&&"commonTaskParent"===this._config.name&&(s=!0):s=!0,s))return i.getDetachMenuConfig.call(this,Boolean(this._config.readWrite),t)}var a,r=this._parent.apply(this,arguments);return r.className=null===r.className&&("scope"===t.options.config.name||(a=this.model.model)&&(a.canModify?a.canModify():a.get("canEdit")))&&!this._config.disableRemove?"":"disabled",r=this.addClassNamesToButton(r)},createMenuButtons:function(t){const n=e.clone(t||{},!1);n.zIndex=1050;var s=n.model;if(s)if(s instanceof l||s instanceof d&&"3DSpace"===s.serviceHosting){var o=this._parent.bind(this,n);i.fetchParentTypesWithCallback(s,o)}else this._parent(n);else this._parent(n)},createAndShowContextMenu:function(e){e.preventDefault(),this._createDropDownMenu(e)},addOpenAndOpenWith:function(e){var t=s.polymorphicOpenMenuItem(e,"openAppInCompass",function(e){this.selectModelInCompass(e.model)},this);t&&this.dropdownMenu.addItem(t),this._config.noOpenWith||"person"===this._config.type||this.addOpenWith(e.model)},getUpdateButton:function(e){var t=this._parent.apply(this,arguments),n=e.model&&e.model.get("files"),s=this.normalizedGet(this.model,"canEdit"),i=(!n||n&&"object"==typeof n&&1===n.length)&&s;return t.className=null===t.className&&i?"":"disabled",t=this.addClassNamesToButton(t)},getDownloadButton:function(e){var t=this._parent.apply(this,arguments);return t.className=null===t.className&&h(e.model)?"":"disabled",t=this.addClassNamesToButton(t)},addClassNamesToButton:function(e){return e.className+=e.className&&e.className.contains("disabled")&&"propertiesButton"!==e.name?" hidden":"",e},getDropDownMenuItems:function(t,n){var o=e.clone(n||{},!1),a=o.model,r=!!a&&s.isSolidWorksFile(a);o.documentUpdateHandler=i.createDocumentUpdateModal;var l=this._parent(t&&!r,o);if(a&&h(a)){var d,p=a.getObjectType&&("Project"===a.getObjectType()||"Enterprise Project"===a.getObjectType()),u=a.getObjectType&&"swym:Community"===a.getObjectType(),T="3dportfolio"===a.serviceHosting,g=l.findIndex(function(e){return"detach-button"===e.name}),E=widget.xPlanApp&&widget.xPlanApp.getManagementView();p&&widget.getValue("appId")===c.APP_3DPLAN?((d=E?i.getOpenMenuConfig(a,E):i.getPreviewMenuConfig(a,p)).text=m("E6WCommonApps.Label.SetAsRoot"),d.fonticon="tree-view-root"):(u||T)&&(d=i.getPreviewMenuConfig(a,p)),d&&(-1===g?l.push(d):l.splice(g,0,d))}return l},_addDropDownMenuListener:function(e){for(var t=this,n=this.getElements(".fonticon-down-open"),s=n.length,i=0;i<s;i++){n[i].getClosest("button").addEvent("click",function(e){t._createDropDownMenu(e)})}},_createDropDownMenu:function(t){var n=this,s=e.Event.getElement(t),o=s.getClosest(".object-card").getAttribute("data-id"),a=function(){n.createMenu(t,{target:s}),n._showAndUpdateDropdownMenuPosition(n.dropdownMenu,t),n.listenToOnce(n._parentView,"onScroll",()=>{n.dropdownMenu&&n.dropdownMenu.hide()})};if(o){var r=n.getActiveModel(o);if(r instanceof l||r instanceof d&&"3DSpace"===r.serviceHosting){i.fetchParentTypesWithCallback(r,function(){var s=r.get("parentTypes");s&&s.includes("DOCUMENTS")?(i.getDocumentServiceDropDownMenuItems(r,function(e){n.options.docMenuItems=e,a()}),n.dropdownMenu&&n.dropdownMenu.destroy(),n.createDropdownMenu({target:e.Event.getElement(t),items:[{text:m("E6WCommonUI.Info.LoadingData")}]}),n._showAndUpdateDropdownMenuPosition(n.dropdownMenu,t)):a()})}else a()}else a()},_submodelCallback:function(){this._parent.apply(this,arguments);var e={config:this._config},t=this.model;this.model.dispatchEvent("onChange",[t,e])},_showAndUpdateDropdownMenuPosition:function(e,t){e.options.contextual=!0,this.dropdownMenu.items.filter(function(e){return!e.className||!e.className.contains("hidden")}).length>0&&e.show(),e.updatePosition(t),e.options.contextual=!1},destroy:function(){r.destroyOpenWith(this),this._parent.apply(this,arguments)},validateDroppedObject:function(e){var t=e.serviceId,n=e.objectType,s=this._config.name;return"dsplan:hasAttachment"!==s&&"dsplan:actualDeliverable"!==s||"3dplan"!==t&&"swym:WeDo"!==n?this._parent.apply(this,arguments):p.replace(p.get("E6WCommonUI.Alert.FailedToAttachProjectPlanningObjects"))}});return g.getPropertiesButtonInfo=function(e){return s.showPreview(e)?{text:m("E6WCommonApps.Label.Preview"),fonticon:"eye"}:{text:m("E6WCommonUI.Label.Properties"),fonticon:"attributes"}},g}),define("DS/E6WCommonApps/Preferences",["UWA/Core","UWA/Class/Events","DS/RDFFoundation/RDFUtils","DS/E6WCommonUI/UIHelper","DS/E6WCommonApps/PreferenceUtils","DS/E6WCommonApps/Models/BaselineModel"],function(e,t,n,s,i,o){"use strict";var a=i.get,r=i.set,l=i.parse;const d={DATE_RANGE:"timeline-daterange1",DIVIDER:"timeline-divider",FONT_SIZE:"timeline-fontsize",ZOOM:"timeline-zoom",EXPAND_LIST:"timeline-expand-list",SCROLL_TOP:"timeline-scroll-top",TIME_MACHINE:"timeline-time-machine",LEFT_MARGIN:"timeline-left-margin1",SHOW_TIME_MACHINE:"show-time-machine",SHOW_ACTIONBAR:"show-action-bar",SHOW_CONSTRAINTS:"show-constraints",SHOW_COMPRESSION:"show-compression",HIDE_WEEKLABEL:"hide-weeklabel",EXPAND_IDS:"expand-ids",COLLAPSED_IDS:"collapsed-ids",HIDE_TASKS:"hide-tasks",USE_FTS_ON_SCHEDULE_TAB:"useFTSonScheduleTab",SHOW_SUMMARY_TIMELINE:"show-summary-timeline",SHOW_BASELINES:"show-baselines",ACTIVE_BASELINE:"active-baseline",SCHEDULE_TAGGER_FILTER:"scheduleTaggerFilter",HIGHLIGHT_CRITCIAL_PATH:"highlightCriticalPath",FILTER_CRITCIAL_PATH:"filterCriticalPath",HIDE_ASSIGNEES:"hideAssignees"};var c=new(t.extend({POSTFIX:"",PREF_KEYS:d,setCurrentProject:function(t){if(this.PREF_KEYS=e.clone(d,!0),Object.keys(this.PREF_KEYS).forEach(function(e){this[e]=this[e]+t},this.PREF_KEYS),void 0===this.useFTSonScheduleTab()){this.setUseFTSonScheduleTab(!1)}void 0===l(a(this.PREF_KEYS.EXPAND_IDS))&&this.setExpandIds([t])},getDateRange:function(){return l(a(this.PREF_KEYS.DATE_RANGE))},setDateRange:function(e){r(this.PREF_KEYS.DATE_RANGE,JSON.stringify(e))},getDividerPositionAsTimelinePercentage:function(){return l(a(this.PREF_KEYS.DIVIDER))},setDividerPositionAsTimelinePercentage:function(e){r(this.PREF_KEYS.DIVIDER,JSON.stringify(e))},getFontSize:function(){return l(a(this.PREF_KEYS.FONT_SIZE))},setFontSize:function(e){r(this.PREF_KEYS.FONT_SIZE,JSON.stringify(e))},getZoomLevel:function(){return l(a(this.PREF_KEYS.ZOOM))},setZoomLevel:function(e){r(this.PREF_KEYS.ZOOM,JSON.stringify(e))},getExpandList:function(){return l(a(this.PREF_KEYS.EXPAND_LIST))},setExpandList:function(e){r(this.PREF_KEYS.EXPAND_LIST,JSON.stringify(e))},getScrollTop:function(){return l(a(this.PREF_KEYS.SCROLL_TOP))},setScrollTop:function(e){r(this.PREF_KEYS.SCROLL_TOP,JSON.stringify(e))},getTimeMachineRange:function(){return l(a(this.PREF_KEYS.TIME_MACHINE))},setTimeMachineRange:function(e){r(this.PREF_KEYS.TIME_MACHINE,JSON.stringify(e))},getShowTimeMachine:function(){return l(a(this.PREF_KEYS.SHOW_TIME_MACHINE))},setShowTimeMachine:function(e){r(this.PREF_KEYS.SHOW_TIME_MACHINE,JSON.stringify(!0===e))},getShowActionBar:function(){return l(a(this.PREF_KEYS.SHOW_ACTIONBAR))},setShowActionBar:function(e){r(this.PREF_KEYS.SHOW_ACTIONBAR,JSON.stringify(!0===e))},getShowConstraints:function(){return!1!==l(a(this.PREF_KEYS.SHOW_CONSTRAINTS))},setShowConstraints:function(e){r(this.PREF_KEYS.SHOW_CONSTRAINTS,JSON.stringify(!0===e))},getShowCompression:function(){return!1!==l(a(this.PREF_KEYS.SHOW_COMPRESSION))},setShowCompression:function(e){r(this.PREF_KEYS.SHOW_COMPRESSION,JSON.stringify(!0===e))},getHideWeekLabel:function(){return!1!==l(a(this.PREF_KEYS.HIDE_WEEKLABEL))},setHideWeekLabel:function(e){r(this.PREF_KEYS.HIDE_WEEKLABEL,JSON.stringify(!0===e))},setExpandIds:function(e){r(this.PREF_KEYS.EXPAND_IDS,JSON.stringify(e))},getExpandIds:function(){return l(a(this.PREF_KEYS.EXPAND_IDS))||[]},setCollapsedIds:function(e){r(this.PREF_KEYS.COLLAPSED_IDS,JSON.stringify(e))},getCollapsedIds:function(){return l(a(this.PREF_KEYS.COLLAPSED_IDS))||[]},setHideTasks:function(e){r(this.PREF_KEYS.HIDE_TASKS,JSON.stringify(!0===e))},getHideTasks:function(){var e=l(a(this.PREF_KEYS.HIDE_TASKS));return void 0===e&&(e=!1),e},getHighlightCriticalPath:function(){return l(a(this.PREF_KEYS.HIGHLIGHT_CRITCIAL_PATH))||!1},setHighlightCriticalPath:function(e){r(this.PREF_KEYS.HIGHLIGHT_CRITCIAL_PATH,JSON.stringify(e))},getCriticalPathFilters:function(){return l(a(this.PREF_KEYS.FILTER_CRITCIAL_PATH))||!1},setCriticalPathFilters:function(e){r(this.PREF_KEYS.FILTER_CRITCIAL_PATH,JSON.stringify(e))},useFTSonScheduleTab:function(){return l(a(this.PREF_KEYS.USE_FTS_ON_SCHEDULE_TAB))},setUseFTSonScheduleTab:function(e){r(this.PREF_KEYS.USE_FTS_ON_SCHEDULE_TAB,JSON.stringify(e))},getShowSummaryTimeline:function(){return l(a(this.PREF_KEYS.SHOW_SUMMARY_TIMELINE))},setShowSummaryTimeline:function(e){r(this.PREF_KEYS.SHOW_SUMMARY_TIMELINE,JSON.stringify(e))},setShowBaselines:function(e){var t=this.getShowBaselines();r(this.PREF_KEYS.SHOW_BASELINES,JSON.stringify(e)),t!==this.getShowBaselines()&&this.dispatchEvent("onChange:"+d.SHOW_BASELINES)},getShowBaselines:function(){return l(a(this.PREF_KEYS.SHOW_BASELINES))},setActiveBaselineModel:function(e){let t=e?e.id:void 0;var n=this.getActiveBaselineModel();r(this.PREF_KEYS.ACTIVE_BASELINE,JSON.stringify(t)),e!==n&&this.dispatchEvent("onChange:"+d.ACTIVE_BASELINE)},getActiveBaselineModel:function(){let e=l(a(this.PREF_KEYS.ACTIVE_BASELINE));if(e)return n.getObjectForAdding(o,e,{})},getBaselineDataForModelToRender:function(e){const t=c.getActiveBaselineModel(),n=t&&t.getDataForModel(e);return c.getShowBaselines()?n:void 0},getBaselineFormattedDate:function(e,t){let n=this.getBaselineDataForModelToRender(t);if(n)return s.getIntlDateFormat(n[e])},setScheduleTaggerFilters:function(e){this[this.PREF_KEYS.SCHEDULE_TAGGER_FILTER]=e},getScheduleTaggerFilters:function(){return this[this.PREF_KEYS.SCHEDULE_TAGGER_FILTER]},showScheduleElement:function(e){var t=this.getScheduleTaggerFilters();return!(t&&!t[e.uri])},getHideAssignees:function(){return!1!==l(a(this.PREF_KEYS.HIDE_ASSIGNEES))},setHideAssignees:function(e){r(this.PREF_KEYS.HIDE_ASSIGNEES,JSON.stringify(!0===e))}}));return c.KEYS=d,c}),define("DS/E6WCommonApps/TreeNodeUtil",["DS/E6WCommonApps/Models/E6WCommonAppsConstants","DS/RDFFoundation/RDFUtils","i18n!DS/E6WCommonApps/assets/nls/E6WCommonAppsNLS"],function(e,t,n){"use strict";var s=function(e){return n.get(e)},i={title:"title",description:"description",context:"context",project:"project",maturity:"maturity",priority:"priority",routeContent:"routeContent",routeTaskAction:"routeTaskAction",routeTaskInstructions:"routeTaskInstructions",estimatedStartDate:"estimatedStartDate",estimatedFinishDate:"estimatedFinishDate",estimatedDuration:"estimatedDuration",attachments:"references",deliverables:"deliverables",actualStartDate:"actualStartDate",actualFinishDate:"actualFinishDate",created:"created",modified:"modified",assignees:"assignees",owner:"owner"},o={[i.title]:"dsplan:MVMask.Task.Title",[i.description]:"dsplan:MVMask.Task.Description",[i.project]:"dsplan:MVMask.Task.Project",[i.maturity]:"dsplan:MVMask.Task.Maturity",[i.priority]:"dsplan:MVMask.Task.Priority",[i.estimatedStartDate]:"dsplan:MVMask.Task.PlannedStart",[i.estimatedFinishDate]:"dsplan:MVMask.Task.PlannedEnd",[i.estimatedDuration]:"dsplan:MVMask.Task.EstimatedDuration",[i.attachments]:"dsplan:MVMask.Task.Attachments",[i.deliverables]:"dsplan:MVMask.Task.Deliverables",[i.actualStartDate]:"dsplan:MVMask.Task.ActualStart",[i.actualFinishDate]:"dsplan:MVMask.Task.ActualEnd",[i.created]:"dsplan:MVMask.Task.Created",[i.modified]:"dsplan:MVMask.Task.Modified",[i.assignees]:"dsplan:MVMask.Task.Assignees",[i.owner]:"dsplan:MVMask.Task.Owner"},a={[e.DSLC_TITLE_ATTR]:i.title,[e.DESCRIPTION_ATTR]:i.description,[e.COMMON_TASK_PARENT_ATTR]:i.project,[e.TASK_PARENT_ATTR]:i.project,[e.PARENT_ATTR]:i.project,[e.DSLC_STATE_ATTR]:i.maturity,[e.DSLC_PRIORITY_ATTR]:i.priority,[e.STARTDATE_ATTR]:i.estimatedStartDate,[e.ENDDATE_ATTR]:i.estimatedFinishDate,[e.DSLC_DURATION_ESTIMATED]:i.estimatedDuration,[e.DSLC_DURATION_MIN]:i.estimatedDuration,[e.DSLC_DURATION_MAX]:i.estimatedDuration,[e.ATTACHMENT_ATTR]:i.attachments,[e.ACTUAL_DELIVERABLE_ATTR]:i.deliverables,[e.ACTUAL_START_DATE]:i.actualStartDate,[e.ACTUAL_END_DATE]:i.actualFinishDate,[e.CREATION_DATE_ATTR]:i.created,[e.LASTUPDATED_ATTR]:i.modified,"dsxplan:hasAssignee":i.assignees,[e.OWNER_ATTR]:i.owner},r={title:i.title,description:i.description,context:i.context,DPMProject:i.project,scopes:i.context,contents:i.routeContent,routeTaskAction:i.routeTaskAction,routeTaskInstructions:i.routeTaskInstructions,state:i.maturity,estimatedStartDate:i.estimatedStartDate,dueDate:i.estimatedFinishDate,routeTaskDueDate:i.estimatedFinishDate,estimatedDuration:i.estimatedDuration,estimatedDurationInputValue:i.estimatedDuration,estimatedDurationInputUnit:i.estimatedDuration,references:i.attachments,deliverables:i.deliverables,actualStartDate:i.actualStartDate,actualFinishDate:i.actualFinishDate,originated:i.created,modified:i.modified,assignees:i.assignees,owner:i.owner},l=[e.DSLC_DURATION_ESTIMATED,e.DSLC_DURATION_MIN,e.DSLC_DURATION_MAX,"estimatedDuration","estimatedDurationInputValue","estimatedDurationInputUnit"],d=[e.DSLC_STATE_ATTR,"state"],c=[e.DSLC_DESCRIPTION_ATTR,"subtitle"],p=function(e){return e%1==0?Math.round(e):e},u=function(e){if(e.isRouteTask()){var t=e.dataForRendering({attributes:"cardTitle"}).cardTitle;return t&&t.split("|")[1]}return""},h=function(t){var n;if(t.isRDFTask())return((n=t.get(e.DSLC_DURATION_ESTIMATED))?t.getEstimatedDuration():t.getSuggestedDuration())+" "+s("E6WCommonApps.Label.Days")+" +/- "+t.getSuggestedOffset();n=t.get("estimatedDuration");var i=t.get("estimatedDurationInputValue"),o=t.get("estimatedDurationInputUnit");return"d"===o?p(n)+" "+s("E6WCommonApps.Label.Days"):"h"===o?p(i)+" "+s("E6WCommonApps.Label.Hours"):void 0},m=function(e){switch(e){case"Create":return s("E6WCommonApps.Label.Preliminary");case"Open":case"Assign":return s("E6WCommonApps.Label.ToDo");case"InProgress":case"Active":return s("E6WCommonApps.Label.InWork");case"Review":return s("E6WCommonApps.Label.InApproval");case"Done":case"Complete":return s("E6WCommonApps.Label.Completed");default:return""}},T=function(e){return e?e.replaceAll("</p>\n\n<p>","<br/>").replaceAll("\n",""):""};return{COLUMN_DATA_INDICES:i,RDF_TO_TREE_NODE:a,ER_TO_TREE_NODE:r,addListenersOnTreeNode:function(t){var n,s,o=t.getAttributeValue("correspondingModel");if(o.isRDFTask()?(n=Object.keys(a),s=a):(n=Object.keys(r),s=r),n.forEach(n=>{o.addEvent("onChange:"+n,function(i,o){var a;a=-1!==l.indexOf(n)?h(i):-1!==d.indexOf(n)?m(i.getMaturityState()):-1!==c.indexOf(n)?T(o):n===e.DSLC_PRIORITY_ATTR?i.getPriorityValueNLSString():i.isRouteTask()&&"contents"===n?u(i):i.get(n),t.setAttribute(s[n],a)})}),o.isRDFTask()){var p=o.get("dsxplan:hasAssignee");p&&o.listenTo(p,"onAccessSetOfGroup",function(e){t.setAttribute(i.assignees,e.get("ds6w:label"))})}},getMasksForFetchingRDFTaskDetails:function(e){return o[e]},getDisplayLabelForDuration:h,getDisplayLabelForState:m,getDisplayLabelForRouteContent:u,getDisplayLabelForDescription:T}}),define("DS/E6WCommonApps/Models/AccessModel",["UWA/Core","DS/RDFFoundation/Models/ComponentProxyModel","DS/RDFFoundation/Models/ResultModel","DS/RDFFoundation/RDFUtils","DS/TreeModel/TreeNodeModel","DS/E6WCommonApps/TreeNodeUtil","DS/E6WCommonUI/PlatformManager","DS/RDFFoundation/MemberUtils"],function(e,t,n,s,i,o,a,r){"use strict";var l,d="invoke/dsxplan:checkOperationOnResourceClone",c="dsaccess:Operation.Shareable.Modify",p="dsaccess:Operation.Shareable.Delete",u=n.extend({_uwaClassName:"AccessModel",sourceName:"3dplan",parse:function(){var e=this._parent.apply(this,arguments);return this.handleRepositoryAttributes(e,"dsxplan:hasContentRepository"),this.handleRepositoryAttributes(e,"dsplan:hasCollaborativeSpace"),e},handleRepositoryAttributes:function(t,n){var s=t[n]||this.get(n);if(s&&e.is(s,"string")){var i=this._normalizedRepo(s);this._models[n]=i,t[n]=i}},get:function(e){return"canEdit"===e?this.canModify():"deleteAccess"===e?this.canDelete():"source"===e?"3dplan":this._parent.apply(this,arguments)},isDSLC:function(e){var t=e||this._attributes;return!(!t||!t["dsxplan:jsType"]&&!t["@type"])},syncCreate:function(e,t){this._parent.apply(this,arguments);var i=t.idToDuplicate?n.CLONE_ITEM_VERSION_URI:n.CREATE_ITEM_VERSION_URI,o=t.mask||this.writeMask||this.getMask(),a=o?"?$mask="+o:"";t.url=s.expandUrl(i+a);var r=this.getParentPath(),l=t.idToDuplicate,d=t.activityIdToSubscribe;t.data=l?JSON.stringify([t.attrs,l,r,d]):JSON.stringify([t.attrs,r]),t.method="POST"},canModify:function(){return this.hasFetchedAccessData()||l.requestFetch(this),Boolean(this._accessModify)},canDelete:function(){return this.hasFetchedAccessData()||l.requestFetch(this),Boolean(this._accessDelete)},canShare:function(){return Boolean(this._accessShare)},createNodeData:function(){return{title:""}},getTreeNodeModel:function(){if(this._treeNodeModel)this._treeNodeModel.show();else{var e=this.createNodeData();this._treeNodeModel=new i({label:e.title,grid:e}),o.addListenersOnTreeNode(this._treeNodeModel)}return this._treeNodeModel},fetchAccess:function(e){this.hasFetchedAccessData()||l.requestFetch(this,e)},refreshAccessData:function(e){this.hasFetchedAccessData()&&l.requestFetch(this,e)},getAccessBatch:function(t){var n=this,i=s.getBatchGenerator({ignoreDictionary:t&&t.ignoreDictionary});i.ajax(s.expandUrl(d),{method:"POST",onComplete:function(s){return n.setModifyAccess(s["@value"]),t&&e.is(t.onComplete,"function")&&t.onComplete.apply(this,arguments)},onFailure:function(){return t&&e.is(t.onFailure,"function")&&t.onFailure.apply(this,arguments)},onTimeout:t&&t.onFailure,headers:{"Content-Type":"application/json"},data:JSON.stringify([this.id,c]),type:"json"}),i.ajax(s.expandUrl(d),{method:"POST",onComplete:function(s){return n.setDeleteAccess(s["@value"]),t&&e.is(t.onComplete,"function")&&t.onComplete.apply(this,arguments)},onFailure:function(){return t&&e.is(t.onFailure,"function")&&t.onFailure.apply(this,arguments)},onTimeout:t&&t.onFailure,headers:{"Content-Type":"application/json"},data:JSON.stringify([this.id,p]),type:"json"});var o=i.sendBatch;return i.sendBatch=function(t){var s=e.clone(t||{},!1);n.fetchingAccessRights=!0,s.onComplete=function(){delete n.fetchingAccessRights,t&&t.onComplete&&t.onComplete()},s.onFailure=function(){delete n.fetchingAccessRights,t&&t.onFailure&&t.onFailure()},o.call(this,s)},i},hasFetchedAccessData:function(){return Boolean(void 0!==this._accessModify&&void 0!==this._accessDelete)},setAccess:function(t,n){var s=e.clone(n||{},!1),i=s.silent;s.silent=!0;var o=this._accessModify,a=this._accessDelete,r=this._accessShare;this.setModifyAccess(t,s),this.setDeleteAccess(t,s),this.setShareAccess(t,s),i||(a!==t&&this.dispatchEvent("onDeleteAccessChanged"),o!==t&&this.dispatchEvent("onModifyAccessChanged"),r!==t&&this.dispatchEvent("onShareAccessChanged"))},setModifyAccess:function(t,n){var s=e.clone(n||{},!1);this._accessModify!==t&&(this._accessModify=t,!s.silent&&this.dispatchEvent("onModifyAccessChanged"))},setDeleteAccess:function(t,n){var s=e.clone(n||{},!1);this._accessDelete!==t&&(this._accessDelete=t,!s.silent&&this.dispatchEvent("onDeleteAccessChanged"))},setShareAccess:function(t,n){var s=e.clone(n||{},!1);this._accessShare!==t&&(this._accessShare=t,!s.silent&&this.dispatchEvent("onShareAccessChanged"))},clearAccess:function(e){this.setDeleteAccess(void 0,e),this.setModifyAccess(void 0,e),this.setShareAccess(void 0,e)},onShareNotification:function(e,t){var n,i=t&&t.agentList,o=!1,l=t&&Object.keys(t)[0];if(!i&&"dsplan:hasAssignee"===l){var d=t["dsplan:hasAssignee"]["@id"];i=[d],(n=s.getObjectById(d))&&"foaf:Group"===n.get("dsxplan:jsType")&&(o=!0)}(i=i.map(function(e){if(e)return s.removeBracketLongURI(e)}))&&(i.includes(r.addUUIDToURI(a.getContextUserUid()))||o)&&(this.refreshAccessData(),this.fetch({mask:"dsplan:MVMask.ScheduleElements.Basic",ajax:e.ajax,onComplete:function(e,t){t["dsxplan:jsType"]?"dsplan:Task"===t["dsxplan:jsType"]&&"dsplan:hasAssignee"===l&&e.unset("dsxplan:hasAssignee"):(e.dispatchEvent("liveUpdateAccessRevoked"),e.destroy({noServer:!0,fromNotification:!0}))},onFailure:function(e){e.dispatchEvent("liveUpdateAccessRevoked"),e.destroy({noServer:!0,fromNotification:!0})},onTimeout:function(){}}))},getRelatedModelCompactJson:function(e,n){return"dsxplan:hasContentRepository"===n&&e instanceof t?e.id:this._parent.apply(this,arguments)},currentUserIsLeader:function(){return this.canShare()}}),h={cancel:function(){this.fetching?(delete this._onComplete,delete this.queue.fetching[this.model.id]):delete this.queue.toBeFetched[this.model.id]},onComplete:function(){this._onComplete&&this._onComplete.apply(this,arguments),delete this.queue.fetching[this.model.id]},onFailure:function(){this._onFailure&&this._onFailure.apply(this,arguments),delete this.queue.fetching[this.model.id]}},m=function(){this.onComplete=h.onComplete.bind(this),this.onFailure=h.onFailure.bind(this),this.cancel=h.cancel.bind(this)};return m.prototype=m.prototype,(l={fetchAccess:function(){delete this.fetchTimeout;var t=this.toBeFetched;this.toBeFetched={};var n=Object.keys(t),i=n.length;if(!i)return{cancel:function(){}};for(var o=s.getBatchGenerator(),a=0;a<i;a++){var r=n[a],l=t[r];l.fetching=!0,this.fetching[r]=l;var d=l.model;o.addRequestsFromBatch(d.getAccessBatch(e.extend(l,{ignoreDictionary:!0})))}return o.sendBatch()},requestFetch:function(t,n){if(!t.id)return t.setAccess(!0),{cancel:function(){}};if(t.fetchingAccessRights)return{cancel:function(){}};var s=e.clone(n||{},!1),i=this.toBeFetched[t.id]||this.fetching[t.id];return i||((i=new m).model=t,i._onComplete=s.onComplete,i._onFailure=s.onFailure,i.queue=this,this.toBeFetched[t.id]=i,this.fetchTimeout||(this.fetchTimeout=setTimeout(this.fetchAccess.bind(this),this.TIMEOUT_LENGTH)),Object.keys(this.toBeFetched).length>=u.MAX_FETCH_COUNT&&(clearTimeout(this.fetchTimeout),delete this.fetchTimeout,this.fetchAccess()),i)},resetQueue:function(){this.toBeFetched={},this.fetching={},clearTimeout(this.fetchTimeout),delete this.fetchTimeout}}).toBeFetched={},l.fetching={},l.TIMEOUT_LENGTH=97,u.AccessModelQueue=l,u.DELETE_DATA=p,u.MODIFY_DATA=c,u.ACCESS_URL=d,u.SHARE_DATA="dsaccess:Operation.Shareable.Share",Object.defineProperty(u,"MAX_FETCH_COUNT",{get:function(){return u._maxFetchCountGet()}}),u._maxFetchCountGet=function(){return 20},u.AccessModelQueue=l,u}),define("DS/E6WCommonApps/Models/ConstraintModel",["UWA/Core","DS/RDFFoundation/Models/ResultModel","DS/E6WCommonApps/Models/NoAccessModel","DS/E6WCommonApps/Models/AccessModel","DS/RDFFoundation/RDFUtils","DS/E6WCommonApps/Models/E6WCommonAppsConstants","DS/E6WCommonApps/Models/TaskModelMixin","DS/E6WCommonUI/UIHelper","i18n!DS/E6WCommonApps/assets/nls/E6WCommonAppsNLS"],function(e,t,n,s,i,o,a,r,l){"use strict";var d="dsxplan:constraintType",c="dsxplan:deleteTemporalConstraint",p="dsxplan:createTemporalConstraint",u="dsxplan:modifyTemporalConstraint",h=function(e){return l.get(e)},m=t.extend({_uwaClassName:"ConstraintModel",liveUpdateCreateMask:"dsplan:MVMask.Constraint.Complex",setup:function(t,n){var s=e.clone(n||{},!1);this._parent.apply(this,arguments),s.dontUpdateConstrainedScheduleElements||this.updatePointers(s),this.hasAccessListeners=!1},updatePointers:function(e){this.updateBackpointers(),this.updateParentWorkscopes({silent:e&&e.silent})},save:function(t,n){var s=this,i=e.clone(n||{},!1),o=Array.prototype.slice.call(arguments,0);o[1]=i;var a=this.getPredecessor(),r=this.getSuccessor();if(a&&a.shouldWeSolve({assumeChanges:!0})){var l=i.onComplete;i.onComplete=function(){if(s.get(m.ENFORCE_ATTR)||t&&void 0!==t[m.ENFORCE_ATTR]){var n={};if(r){var i=r.getParent();n.additionalElementsToSolve=[r.id],n.additionalParentElementsToSolve=[i&&i.id]}a.solve(n)}e.is(l,"function")&&l.apply(this,arguments)}}return this._parent.apply(this,o)},destroy:function(t){var n=this,s=this.getPredecessor(),i=this.getSuccessor();this.stopListening(s),this.stopListening(i);var o=e.clone(t||{},!1),a=Array.prototype.slice.call(arguments,0);if(a[0]=o,!o.fromNotification&&s&&s.shouldWeSolve({assumeChanges:!0})){var r=o.onComplete;o.onComplete=function(t){if(!t.isNew()){var o=n.get(m.ENFORCE_ATTR);if(e.is(o)&&o){var a=i.getParent(),l=i&&{additionalElementsToSolve:[i.id],additionalParentElementsToSolve:[a&&a.id]};s.solve(l)}n.removeFromScheduleElements(),e.is(r,"function")&&r.apply(this,arguments)}}}this._parent.apply(this,a)},getLeadLagTime:function(e){return e=void 0!==e?i.xsdDayTimeDurationToMilliseconds(e)/(60*o.WORKING_HOURS_IN_A_DAY*60*1e3):0,String(e)},isCompleted:function(){return this.get("dsxplan:from").isCompleted&&this.get("dsxplan:from").isCompleted()&&this.get("dsxplan:to").isCompleted&&this.get("dsxplan:to").isCompleted()},get:function(e){return"canEdit"===e?this.canModify():this._parent.apply(this,arguments)},getObjectType:function(){return"Constraint"},toJSON:function(t){var n=e.clone(t||{},!1),s=this._parent.apply(this,arguments);return n.dataForRendering&&(s=e.merge(s,this.dataForRendering())),s},getErrorStatus:function(){var e=this.get(o.SCHEDULE_ERROR_ATTR);return e&&("function"==typeof e.get&&e.id!==o.NO_SOLVER_ERROR||"string"==typeof e&&i.longToShortURI(e)!==o.NO_SOLVER_ERROR)?o.DEPENDENCY_STATUS_BROKEN:o.DEPENDENCY_STATUS_OK},getDateForRendering:function(e){return r.getIntlDateFormat(e).displayValue},dataForRendering:function(){var t,s=this.get("dsxplan:from"),i=this.get("dsxplan:to"),a=this.get("dsxplan:lag"),l={type:this.get(d),subtitle:this.get("subtitle"),canEdit:this.get("canEdit"),physicalId:this.get("physicalId")||this.cid,enforcedType:this.get("dsxplan:isEnforced")?o.DEPENDENCY_TYPE_ENFORCED:o.DEPENDENCY_TYPE_FLEXIBLE};if(l[m.DAYS_STRING]=r.getDaysStringForDate(a),s instanceof m.ScheduleElementModel){let t,n="",i=s.get(o.PARENT_ATTR);i&&(t=i.get("@id"),n=i.get(o.DSLC_TITLE_ATTR)),l=e.extend(l,{predecessor:{id:s.get("@href"),ref:s.get("@id"),title:s.get("title")},predecessorTitle:s.get("title"),predecessorImage:s.getIconURL(),predecessorParent:n,predecessorParentId:t}),s.get(o.DSLC_STATE_ATTR)&&(l.fromStatus=s.get(o.DSLC_STATE_ATTR).get("title")),s.get("fromDate")&&(l.fromDate=this.getDateForRendering(s.get("fromDate")))}else t=new n,(l=e.extend(l,{predecessorTitle:t.get("dsxplan:label"),predecessorImage:t.get("image")})).fromStatus=t.get("dsxplan:label"),l.fromDate=t.get("dsxplan:label"),l.fromStatusImage=t.get("image");if(i instanceof m.ScheduleElementModel){let t,n="",s=i.get(o.PARENT_ATTR);s&&(t=s.get("@id"),n=s.get(o.DSLC_TITLE_ATTR)),l=e.extend(l,{successor:{id:i.get("@href"),ref:i.get("@id"),title:i.get("title")},successorTitle:i.get("title"),successorImage:i.getIconURL(),successorParent:n,successorParentId:t}),i.get(o.DSLC_STATE_ATTR)&&(l.toStatus=i.get(o.DSLC_STATE_ATTR).get("title")),i.get("toDate")&&(l.toDate=this.getDateForRendering(i.get("toDate")))}else t=new n,(l=e.extend(l,{successorTitle:t.get("dsxplan:label"),successorImage:t.get("image")})).toStatus=t.get("dsxplan:label"),l.toDate=t.get("dsxplan:label"),l.toStatusImage=t.get("image");l.leadLagTime=this.getLeadLagTime(this.get("dsxplan:lag")),l.status=this.getErrorStatus();let c=this.get(d),p="";return m.TYPES_DISPLAY_MAPPING.forEach(function(e){e.actualValue===c&&(p=e.displayValue)}),l.relationship=p,l},_getFullEndPoint:function(e){var t,n=this.get(e);return n instanceof m.ScheduleElementModel&&(t=n),t},getSuccessor:function(){return this._getFullEndPoint("dsxplan:to")},getPredecessor:function(){return this._getFullEndPoint("dsxplan:from")},getType:function(){return this.get(d)},updateBackpointers:function(e){var t=this,n=this.getPredecessor();n&&n.addPredecessorConstraint&&(n.addPredecessorConstraint(this,e),this.stopListening(n),this.listenTo(n,"onModifyAccessChanged",function(){t.dispatchEvent("onModifyAccessChanged")}),this.listenTo(n,"onDeleteAccessChanged",function(){t.dispatchEvent("onDeleteAccessChanged")}));var s=this.getSuccessor();s&&s.addSuccessorConstraint&&s.addSuccessorConstraint(this,e)},removeFromScheduleElements:function(){var e=this.getPredecessor(),t=this.getSuccessor();e&&e.removePredecessorConstraint&&e.removePredecessorConstraint(this),t&&t.removeSuccessorConstraint&&t.removeSuccessorConstraint(this)},syncDelete:function(e){this._parent.apply(this,arguments),e.url=i.expandUrl("invoke/"+c),e.data=JSON.stringify([this.id]),e.method="POST"},syncCreate:function(e,t){t.noStringify=!0,this._parent(e,t),t.url=i.expandUrl("invoke/"+p),t.data=JSON.stringify([t.attrs]),t.method="POST"},syncPatch:function(e,t){if(t.noStringify=!0,this._parent(e,t),!t.attrs)return{cancel:function(){}};t.url=i.expandUrl("invoke/"+u),t.data=JSON.stringify([t.attrs,this.id]),t.method="POST"},canModify:function(){var e=!1,t=this.getPredecessor(),n=this.getSuccessor(),s=this.hasFetchedAccessData();if(n&&t){!this.hasAccessListeners&&this.listenToAccessChanged(n,t);var i=n.hasViewAccess()&&t.hasViewAccess(),o=t.canModify()||n.canModify();e=i&&o}return s||this.fetchAccessData(),!s||e},hasFetchedAccessData:function(){var e=this.getPredecessor(),t=this.getSuccessor();return e&&t&&e.hasFetchedAccessData()&&t.hasFetchedAccessData()},fetchAccessData:function(){var e=this.getPredecessor(),t=this.getSuccessor();e&&s.AccessModelQueue.requestFetch(e),t&&s.AccessModelQueue.requestFetch(t)},getPropertyMask:function(){return"dsplan:MVMask.Constraint.Complex"},fetchForProperty:function(){var e={mask:this.getPropertyMask&&this.getPropertyMask(),dontUpdateMask:!0,onlyIfNeeded:!0};this.fetch(e)},listenToAccessChanged:function(e,t){this.hasAccessListeners=!0;var n={onModifyAccessChanged:function(){this.dispatchEvent("onModifyAccessChanged",[this])}.bind(this),onDeleteAccessChanged:function(){this.dispatchEvent("onDeleteAccessChanged",[this])}.bind(this)};this.listenTo(e,n),this.listenTo(t,n)},canDelete:function(){return this.canModify()},canEnforce:function(){return this.canModify()},updateParentWorkscopes:function(t){var n=e.clone(t||{},!1),s=n.fromParent||this.getParentWorkscope(this.getPredecessor()),i=n.toParent||this.getParentWorkscope(this.getSuccessor());s&&s.hasViewAccess()&&s&&s.addModelToAttributeWithCollection(o.CONSTRAINT_RELATION_ATTR,this,t),!i||!i.hasViewAccess()||s&&s.id===i.id||i.addModelToAttributeWithCollection(o.CONSTRAINT_RELATION_ATTR,this,t)},getParentWorkscope:function(e){var t=e&&e.hasViewAccess()&&e.getParent();if(e&&e.hasViewAccess()){var n=e.getParent();if(n&&"RDFTaskModel"===n._uwaClassName){for(var s=m.RapidRDFModelRegistry.getRapidModelByURI(n.id);s&&"RapidWorkscope"!==s._uwaClassName;)s=s.getParentRapidModel();t=s&&s.getRDFModel()}}return t},getParentPath:function(){return""},getWorkDayLength:function(){return 8},processLiveUpdateCreation:function(e){var t=i.getObjectById(e["@parentFromId"]),n=i.getObjectById(e["@fromId"]),s=i.getObjectById(e["@parentToId"]),a=i.getObjectById(e["@toId"]);(t&&t.hasFetchedAttribute(o.CONSTRAINT_RELATION_ATTR)||s&&s.hasFetchedAttribute(o.CONSTRAINT_RELATION_ATTR)||a&&a.hasFetchedAttribute("dsplan:taskHasConstraint")||n&&n.hasFetchedAttribute("dsplan:taskHasConstraint"))&&this.fetch({mask:this.liveUpdateCreateMask,onComplete:function(e){e.updateBackpointers(),e.updateParentWorkscopes({fromParent:t,toParent:s})}})},_parseNestedModelsAndCollections:function(e){var t,n,s=e["dsplan:hasScheduleError"];return s&&s.member&&(n=(t=s).member,t["dsxplan:jsType"]||n||(t["dsxplan:jsType"]="dsxplan:ScheduleError"),n&&n.forEach(function(e){e["dsxplan:jsType"]||(e["dsxplan:jsType"]="dsxplan:ScheduleError")})),this._parent.apply(this,arguments)}});return m.shouldCreateOnLiveUpdate=function(e){var t=i.getObjectById(e["@parentFromId"]),n=i.getObjectById(e["@fromId"]),s=i.getObjectById(e["@parentToId"]),o=i.getObjectById(e["@toId"]);return t||n||s||o},m.PREDECESSOR_ATTR="dsxplan:from",m.SUCCESSOR_ATTR="dsxplan:to",m.TYPE_ATTR=d,m.CONSTRAINT_TYPE_ATTR="relationship",m.ENFORCE_ATTR="dsxplan:isEnforced",m.LAG_ATTR="dsxplan:lag",m.TYPE_FINISH_TO_START="Before",m.TYPE_START_TO_START="SS",m.TYPE_FINISH_TO_FINISH="FF",m.TYPE_START_TO_FINISH="SF",m.CONSTRAINT_RDF_TYPE="dsplan:TemporalConstraint",m.CONSTRAINT_FLEXIBLE_RDF_TYPE="dsplan:ControlledTemporalConstraint",m.DELETE_URL=c,m.CREATE_URL=p,m.MODIFY_URL=u,m.ENFORCED_TYPE="enforcedType",m.ERROR_STATUS="status",m.FROM="from",m.TO="to",m.FROM_DATE="fromDate",m.TO_DATE="toDate",m.FROM_MATURITY="fromStatus",m.TO_MATURITY="toStatus",m.DAYS_STRING="daysString",m.LEAD_LAG_TIME="leadLagTime",m.TYPES_DISPLAY_MAPPING=[{actualValue:m.TYPE_START_TO_START,displayValue:h("E6WCommonApps.Label.StartToStart")},{actualValue:m.TYPE_FINISH_TO_START,displayValue:h("E6WCommonApps.Label.FinishToStart")},{actualValue:m.TYPE_FINISH_TO_FINISH,displayValue:h("E6WCommonApps.Label.FinishToFinish")},{actualValue:m.TYPE_START_TO_FINISH,displayValue:h("E6WCommonApps.Label.StartToFinish")}],m}),define("DS/E6WCommonApps/Models/ScheduleElementModel",["UWA/Core","DS/RDFFoundation/Collections/ResultCollection","DS/E6WCommonApps/Models/AccessModel","DS/E6WCommonApps/Models/E6WCommonAppsConstants","DS/E6WCommonApps/Models/ConstraintModel","DS/RDFFoundation/RDFUtils","DS/RDFFoundation/Collections/CollectionTaggerHelper","DS/E6WCommonUI/UIHelper","DS/E6WCommonApps/Models/InvokeSolver","DS/E6WCommonApps/Models/SolverModelMixin","DS/E6WCommonApps/Models/NoAccessModel","DS/E6WCommonApps/Models/RepositoryModelMixin","i18n!DS/E6WCommonApps/assets/nls/E6WCommonAppsNLS","i18n!DS/E6WCommonApps/assets/nls/CollaborativeTasksNLS"],function(e,t,n,s,i,o,a,r,l,d,c,p,u,h){"use strict";var m=function(e){var t=u.get(e);return t===e&&(t=h.get(e)),t},T={"dsxplan:Open":"To Do","dsxplan:InProgress":"In Work","dsxplan:Done":"Completed"},g={parentMask:"dsplan:MVMask.Schedule.Complex",_uwaClassName:"ScheduleElementModel",_propertyDictionary:{solveCounter:{volatility:!0},toConstraints:{volatility:!0},fromConstraints:{volatility:!0}},onChangeState:Function.prototype,addPredecessorConstraint:function(t,n){var s=e.clone(n||{});this.addModelToAttributeWithCollection("fromConstraints",t,n),this._changing||(this._changed={}),!s.silent&&this._fireRelationshipChangeEvents("fromConstraints")},addSuccessorConstraint:function(t,n){var s=e.clone(n||{});this.addModelToAttributeWithCollection("toConstraints",t,n),this._changing||(this._changed={}),!s.silent&&this._fireRelationshipChangeEvents("toConstraints")},removePredecessorConstraint:function(e){this.get("fromConstraints").remove(e),this._fireRelationshipChangeEvents("fromConstraints")},removeSuccessorConstraint:function(e){this.get("toConstraints").remove(e),this._fireRelationshipChangeEvents("toConstraints")},getParent:function(){return o.getObjectById(this.parentId)||this.get(s.WORKSCOPE_PARENT_ALL_ATTR)},getStateForDisplayValue:function(e){return T[e["@id"]||e.id||e]},isCompleted:function(){return this.get(s.DSLC_STATE_ATTR).id===s.STATE_DONE},getValidTypes:function(e){var t=[],n=this.getParent();if(n){var s=n.get(e);if(s){var i=s.get("dsxplan:vocabularyTerms")||s.get("dsplan:vocabularyTerms");if(i){for(var o=0;o<i.length;o++){var a=i.at(o),r="E6WCommonApps.Type."+a.id.substring(a.id.indexOf(":")+1);t.push({actualValue:a.id,displayValue:m(r)})}return t}}}return t},setup:function(){return this.setCollection("toConstraints",new t),this.setCollection("fromConstraints",new t),this.listenTo(this,"onChange:"+s.STATE_ATTR,function(e,t){this.onChangeState.apply(this,arguments);var n=t&&(t["@id"]||t.id);a.dispatcher.dispatchEvent("refreshTagger",[e,"ds6w:what/ds6w:status",m("emxCollaborativeTasks.Label."+T[n])])}),this._parent.apply(this,arguments)},canModify:function(){return!(!this.getParent()||!this.getParent()._accessModify)||this._parent.apply(this,arguments)},canDelete:function(){return!(!this.getParent()||!this.getParent()._accessDelete)||this._parent.apply(this,arguments)},canShare:function(){return!(!this.getParent()||!this.getParent()._accessShare)||this._parent.apply(this,arguments)},sync:function(t,n,s){if("update"===t||"patch"===t){var i=e.clone(s||{},!1);if(i.hasOwnProperty("solve")||(i.solve=this.shouldWeSolve(i)),i.solve){var o=this;i.onComplete=function(){var t=s&&e.is(s.onComplete,"function")&&s.onComplete.apply(this,arguments);return o.solve(),t};var a=Array.prototype.slice.call(arguments,0);return a[2]=i,this._parent.apply(this,a)}}return this._parent.apply(this,arguments)},isAttributeImpactingSolve:function(e){var t=e;return this.isDSLC()&&this.inverseDslcMapping&&(t=this.inverseDslcMapping[t]||t),this.attributeImpactingSolve&&this.attributeImpactingSolve[t]},shouldWeSolve:function(e){if(this.isWedo&&this.isWedo()&&!this.get(s.PARENT_ATTR))return!1;if(this.isLeanTask&&this.isLeanTask()&&!this.get(s.PARENT_ATTR))return!1;if(e&&e.fromNotification)return!1;if(this.getChangedAttributesSinceLastSave().some(this.isAttributeImpactingSolve.bind(this))||e.assumeChanges){for(var t=this.getParent();t&&t.hasViewAccess();t=t.getParent()){if(t.autosolve===s.AUTOSOLVE_OFF)return g.dispatcher.dispatchEvent("solveNeeded",[this]),!1;if(t.autosolve===s.AUTOSOLVE_ON)return!0}return!0}return!1},solve:function(t){var n=this;this.solveCounter++;var s=e.clone(t||{}),i=s.onComplete;s.onComplete=function(e){n.solveCounter--;for(var t=e&&e.member||[],s=0;s<t.length;s++)o.getExistingAndMerge(t[s],{animate:!0});return i&&i.apply(this,arguments)};var a=s.onFailure;s.onFailure=function(){return n.solveCounter--,a&&a.apply(this,arguments)},s.onCancel=function(){n.solveCounter--};var r=this.getParent(),d=r&&r.id;l.solve(s,this.id,d)},getDurationAttributeAsDays:Function.prototype,getFromConstraints:function(){return this.get("fromConstraints")},getToConstraints:function(){return this.get("toConstraints")},removeObject:function(e,t,n){t instanceof i?t.destroy(n):this._parent.apply(this,arguments)},getIconURL:function(){return""},hasConstraintWith:function(e){return this.getFromConstraints().some(function(t){return t.getSuccessor().id===e.id})||this.getToConstraints().some(function(t){return t.getPredecessor()&&t.getPredecessor().id===e.id})},isVersion:function(){return!0},get:function(e){var t,n=this._parent.apply(this,arguments),i=!1;return e===s.COMMON_TASK_PARENT_ATTR&&!n&&this.hasFetchedAttribute(e)&&(i=!0,t=this.isStandaloneTask&&this.isStandaloneTask()),!i||t||r.isWedoTask(this.get(s.JS_TYPE_ATTR))||(n=new c),n},_parseNestedModelsAndCollections:function(e){var t,n,s=e["dsplan:hasScheduleError"];return s&&(n=(t=s).member,t["dsxplan:jsType"]||n||(t["dsxplan:jsType"]="dsxplan:ScheduleError"),n&&n.forEach(function(e){e["dsxplan:jsType"]||(e["dsxplan:jsType"]="dsxplan:ScheduleError")})),this._parent.apply(this,arguments)},destroy:function(e){this._parent(e),this.getFromConstraints().forEach(function(e){e.get("dsxplan:to").removeSuccessorConstraint(e)}),this.getToConstraints().forEach(function(e){e.get("dsxplan:from").removePredecessorConstraint(e)})},syncDelete:function(e){var t=this.getParent();this._parent.apply(this,arguments);var n=e.onComplete;e.onComplete=function(){n&&n.apply(this,arguments),t&&t.solve()}}};return g._propertyDictionary["dsplan:actualType"]={volatility:!0},(g=n.extend(g,d,p)).dispatcher=new e.Class.Events,Object.defineProperty(g.prototype,"solveCounter",d.solveCounterDef),Object.defineProperty(g.prototype,"prevSolveCounter",d.prevSolveCounterDef),g.SOLVER_URI="dsmf:xplan.Scheduler.JSONScheduleObjects?$mask=dsplan:MVMask.ScheduleElements.Complex",i.ScheduleElementModel=g,g}),define("DS/E6WCommonApps/Models/RDFTaskModel",["UWA/Core","UWA/Array","UWA/Class/Collection","DS/Foundation2/FoundationV2Data","DS/RDFFoundation/Models/ResultModel","DS/RDFFoundation/Collections/ResultCollection","DS/RDFFoundation/Collections/PersonCollection","DS/RDFFoundation/Collections/UserCollection","DS/RDFFoundation/Models/PersonRDFModel","DS/RDFFoundation/MaskUtils","DS/RDFFoundation/RDFUtils","DS/RDFFoundation/MemberUtils","DS/RDFFoundation/Collections/CollectionTaggerHelper","DS/RDFFoundation/Models/MemberModel","DS/E6WCommonUI/UIHelper","DS/E6WCommonUI/PlatformManager","DS/E6WCommonApps/Models/ScheduleElementModel","DS/E6WCommonApps/Models/TaskModelMixin","DS/E6WCommonApps/Models/FileManagementMixin","DS/E6WCommonApps/XTaskScope","DS/E6WCommonApps/Models/E6WCommonAppsConstants","DS/E6WCommonApps/Models/AddTaskMixin","DS/E6WCommonApps/Models/NoAccessModel","DS/E6WCommonApps/Models/CalendarModel","DS/E6WCommonApps/LiveUpdateUtils","DS/E6WCommonApps/TreeNodeUtil","i18n!DS/E6WCommonApps/assets/nls/E6WCommonAppsNLS","i18n!DS/E6WCommonApps/assets/nls/CollaborativeTasksNLS"],function(e,t,n,s,i,o,a,r,l,d,c,p,u,h,m,T,g,E,A,f,C,D,_,S,v,R,y,M){"use strict";var I=function(e){var t=y.get(e);return t===e&&(t=M.get(e)),t===e&&(t=s.getWidgetConstant.apply(this,arguments)),t},b=C.dslcMapping;delete b["dspol:modificationDate"];var O=c.inverseMapping(b),P=function(e){e.setMinutes(0),e.setSeconds(0),e.setMilliseconds(0)},F=C.STATE_FOR_DISPLAY_ATTR,N={"dsxplan:Open":"To Do","dsxplan:InProgress":"In Progress","dsxplan:Done":"Done"},k={"dsxplan:Low":"Low","dsxplan:Medium":"Medium","dsxplan:High":"High","dsxplan:Urgent":"Urgent"},W={Low:I("E6WCommonApps.Label.Low"),Medium:I("E6WCommonApps.Label.Medium"),High:I("E6WCommonApps.Label.High"),Urgent:I("E6WCommonApps.Label.Urgent")},U={Low:"dsxplan:Low",Medium:"dsxplan:Medium",High:"dsxplan:High",Urgent:"dsxplan:Urgent"},L={"To Do":"dsxplan:Open","In Progress":"dsxplan:InProgress",Done:"dsxplan:Done"},w={"dsxplan:Open":"Assign","dsxplan:InProgress":"Active","dsxplan:Done":"Complete"},x={Create:"dsxplan:Open",Assign:"dsxplan:Open",Active:"dsxplan:InProgress",Review:"dsxplan:InProgress",Complete:"dsxplan:Done"},V={Open:"To Do","In Progress":"In Progress",Done:"Done"},j={"To Do":"Open","In Progress":"In Progress",Done:"Done"},B={Open:"Assign","In Progress":"Active",Done:"Complete"},H={Create:"Open",Assign:"Open",Active:"In Progress",Review:"In Progress",Complete:"Done"},Y={"dsplan:hasAssignee":E.ASSIGNEESATTR,"dskern:owner":E.OWNERATTR,"dsplan:actualStartDate":"actualStartDate","dspol:modificationDate":"modified","dsplan:hasAttachment":"references","dsplan:actualDeliverable":"deliverables","dsplan:percentageCompletion":"percentComplete"};Y["dsplan:estimatedEndDate"]=E.DUEDATEATTR;var G=c.inverseMapping(Y),K={"dsxplan:estimatedEndDate":{format:"UTC",itemType:"field",name:"dsxplan:estimatedEndDate"},"dsxplan:modificationDate":{format:"UTC",itemType:"field",name:"dsxplan:modificationDate"}},J=g.extend({writeMask:"dsplan:MVMask.Task.Complex",liveUpdateCreateMask:"dsplan:MVMask.Task.CollaborativeTasks.Complex",TASK_RELATION_ATTR:"dsplan:hasSubtask",_propertyDictionary:{solveCounter:{volatility:!0},toConstraints:{volatility:!0},fromConstraints:{volatility:!0},dueDateCategory:{volatility:!0},dueDate:{date:!0},modified:{date:!0},actualStartDate:{date:!0},"dsxplan:workscopeParent":{inverseProperty:"dsxplan:hasTask",inversePropertyIsCollection:!0},"dsxplan:taskParent":{inverseProperty:"dsxplan:hasSubtask",inversePropertyIsCollection:!0},"dsxplan:hasScheduleError":{volatility:!0},"dsplan:hasScheduleError":{volatility:!0},hasFiles:{volatility:!0},atRisk:{volatility:!0},readyToStart:{volatility:!0},late:{volatility:!0},compressionLevel:{volatility:!0},_tagData:{volatility:!0},explicitTagsData:{volatility:!0},"dsplan:workscopeParentForAll":{volatility:!0}},idAttribute:"@id",_uwaClassName:"RDFTaskModel",_relations:[{key:"rdf:type",relatedCollection:o},{key:"dsxplan:hasAssignee",relatedCollection:r}],_collectionConstructor:o,getObjectType:function(){return C.TASK},getParent:function(){var e=this.get(C.COMMON_TASK_PARENT_ATTR);if(e&&"dsplan:DummyProject"!==e.id)return e},getProjectParent:function(e){if(e)return m.isProject(e.get(C.PROJECT_TYPE))?e:this.getProjectParent(e.getParent())},getTagPrefix:function(){return this.hasWeDoTagData()?c.WEDO_TAGGER_URI_PREFIX:c.TAGGER_URI_PREFIX},getAttachments:function(){return this.getCollectionAttribute(C.ATTACHMENT_ATTR,{"@mask":"dsplan:MVMask.Task.Property"})},getDeliverables:function(){return this.getCollectionAttribute(C.ACTUAL_DELIVERABLE_ATTR,{"@mask":"dsplan:MVMask.Task.Property"})},setup:function(){var t=this;this.nbInFlightRequests=0,this._parent.apply(this,arguments);var n={};n["onChange:"+C.ACTUAL_START_DATE]=this._clearStartDateCachedValue,n["onChange:"+C.STARTDATE_ATTR]=this._clearStartDateCachedValue,n["onChange:"+C.STATE_ATTR]=this._clearStartDateCachedValue;var s=this.getParent();s&&this.listenTo(s,"onChange:title",function(){this.dispatchEvent("onChange",[this])}),this.listenTo(this,n),this.listenTo(this,"onReset",this._filterDatabyScope),this.listenTo(this,"onChange:"+this.ASSIGNEESATTR,function(){this._filterDatabyScope()}),this.listenTo(this,"onChange:"+C.OWNER_ATTR,function(){this._filterDatabyScope()}),this.listenTo(this,"onChange:"+C.PRIORITY_ATTR,function(t,n,s){var i=e.clone(s||{},!1),o=n&&k[n["@id"]||n.id];!i.silent&&t.dispatchEvent("onChange:priority",[t,o,i]),u.dispatcher.dispatchEvent("refreshTagger",[t,"ds6w:why/ds6w:priority",I("E6WCommonApps.Label."+o)])}),Object.keys(Y).forEach(function(e){t.listenTo(t,"onChange:"+e,function(t,n,s){s&&s.silent||t.dispatchEvent("onChange:"+Y[e],arguments)})}),this.listenTo(this,"onChange:"+this.DUEDATEATTR,function(e,t,n){var s=new Date(this.previousAttributes()["dsxplan:estimatedEndDate"]),i=this.dueDateCategory(s),o=this.dueDateCategory(t);n.silent||i===o||e.dispatchEvent("onChange:"+this.DUEDATECATEGORY,arguments)});var i=function(){var e=this.get(C.ACTUAL_DELIVERABLE_ATTR),t=e?e.length:0,n=this.get(C.ATTACHMENT_ATTR),s=t+(n?n.length:0)>0;s!==this.get("hasFiles")&&this.set("hasFiles",s)};this.getAttachments(),this.getDeliverables(),this.listenTo(this,"onChange:"+C.ACTUAL_DELIVERABLE_ATTR,i),this.listenTo(this,"onChange:"+C.ATTACHMENT_ATTR,i),this.listenTo(this,"onChange:"+C.PARENT_ATTR,function(e,t){this===e?t||(this.parentId=void 0,this.parentConstructor=void 0):console.error("invalid onChange parent to be checked")}),this.getSubtasks()},onChangeState:function(e,t,n){var s,i;enoviaServer.useFD01CodeFor3DPlan?(s=V[t],i=B[t]):(s=t&&N[t["@id"]||t.id],i=w[t]);var o=C.STATE_ATTR;this.isDSLC()&&(o=this.dslcMapping[C.STATE_ATTR]),N[this.previousAttributes()[o]]===s||n.silent||(this.dispatchEvent("onChange:"+F,[e,s,n]),this.dispatchEvent("onChange:state",[e,i,n]))},getSubtasks:function(){return this.getCollectionAttribute("dsplan:hasSubtask",{mask:"dsplan:MVMask.Task.Complex",detailsMask:"dsplan:MVMask.Task.Basic"})},hasSubtasks:function(){var e=this.getSubtasks();return Boolean(e.length||e.hasMoreItems())},updateReadyToStart:function(){this.set("readyToStart",this.isReadyToStart())},updateAtRisk:function(){this.set("atRisk",this.isAtRisk())},updateLate:function(){this.set("late",this.isLate())},updateCompressionLevel:function(){this.set("compressionLevel",this.getCompressionLevel())},calculateAndSetUpListenersForVisualAttributesIfNeeded:function(){void 0===this.get("readyToStart")&&(this.updateReadyToStart(),this.listenTo(this,"onChange:"+C.STATE_ATTR,this.updateReadyToStart),this.listenTo(this,"onChange:"+C.STARTDATE_ATTR,this.updateReadyToStart)),void 0===this.get("atRisk")&&(this.updateAtRisk(),this.listenTo(this,"onChange:state",this.updateAtRisk),this.listenTo(this,"onChange:"+this.DUEDATEATTR,this.updateAtRisk),this.listenTo(this,"onChange:"+C.ACTUAL_START_DATE,this.updateAtRisk),this.listenTo(this,"onChange:"+C.STARTDATE_ATTR,this.updateAtRisk),this.listenTo(this,"onChange:"+C.COMPLETE_PERCENT_ATTR,this.updateAtRisk),this.listenTo(this,"onChange:"+C.DURATION_MIN,this.updateAtRisk),this.listenTo(this,"onChange:"+C.DURATION_MAX,this.updateAtRisk)),void 0===this.get("late")&&(this.updateLate(),this.listenTo(this,"onChange:state",this.updateLate),this.listenTo(this,"onChange:"+this.DUEDATEATTR,this.updateLate),this.listenTo(this,"onChange:"+C.DURATION_MIN,this.updateLate),this.listenTo(this,"onChange:"+C.DURATION_MAX,this.updateLate)),void 0===this.get("compressionLevel")&&(this.updateCompressionLevel(),this.listenTo(this,"onChange:"+C.DURATION_MIN,this.updateCompressionLevel),this.listenTo(this,"onChange:"+C.DURATION_MAX,this.updateCompressionLevel),this.listenTo(this,"onChange:"+C.DURATION_ESTIMATED,this.updateCompressionLevel))},isProjectTask:function(){return!1},isRouteTask:function(){return!1},isRDFTask:function(){return!0},isWedo:function(){return Boolean(this.get(C.PARENT_HAS_SWYM_COMMUNITY))},getFonticonValue:function(){return"fonticon-plan-task"},hasWeDoTagData:function(){return!!this.tagsData&&this.tagsData.filter(e=>"ds6w:what/ds6w:type"===e.sixw&&"swym:WeDo"===e.object).length>0},getMaturityState:function(){var e=this.get(C.DSLC_STATE_ATTR),t=e&&(e["@id"]||e.get&&e.get("@id"));return t&&t.substring(8)},dataForRendering:function(){var e=this._parent.apply(this,arguments);return e.name=this.get(C.DSLC_TITLE_ATTR),e.image=this.get("dsplan:hasThumbnail")||this.get("image"),e.physicalId=this.get("physicalId"),e.percentComplete||(e.percentComplete=0),e},createNodeData:function(){return{title:this.get(C.DSLC_TITLE_ATTR),description:R.getDisplayLabelForDescription(this.get(C.DSLC_DESCRIPTION_ATTR)),project:this.getParentAsLabel(),maturity:R.getDisplayLabelForState(this.getMaturityState()),priority:this.getPriorityValueNLSString(),estimatedStartDate:this.get(C.DSLC_STARTDATE_ATTR),estimatedFinishDate:this.get(C.DSLC_ENDDATE_ATTR),estimatedDuration:R.getDisplayLabelForDuration(this),attachments:this.getAttachments().getModels(),deliverables:this.getDeliverables().getModels(),actualStartDate:this.get(C.DSLC_ACTUAL_START_DATE),actualFinishDate:this.get(C.DSLC_ACTUAL_END_DATE),created:this.get(C.CREATION_DATE_ATTR),modified:this.get(C.LASTUPDATED_ATTR),assignees:this.getAssignees().getModels(),owner:this.get(C.OWNER_ATTR),correspondingModel:this}},isLeanTask:function(){return Boolean(this.get(C.PARENT_HAS_LEAN_BOARD))},isStandaloneTask:function(){return Boolean(!this.get(C.HAS_PARENT_ATTR))},subscriptionsEnabled:function(){return!1},getCustomFields:function(){},isInCurrentScope:function(){if(this.noFilter)return!0;var e=f.getScope();if(f.isScopeRDF()&&!e.ownsOrContainsTask(this))return!1;if("all"===f.getFilter()&&f.isScopeRDF())return!0;var t=this._isOwnedByOrAssignedToCurrentUser();return!(f.getScopeId()||!t)||!(!f.isScopeRDF()||!t)},_isAssignedToCurrentUser:function(){var e,n,s=this.hasFetchedAttribute("dsxplan:hasAssignee");if(s){var i=this.getAssignees().toArray().map(function(e){if("foaf:Person"===e.get("dsxplan:jsType"))return e.get("dsaccess:accountName",{noMapping:!0});"foaf:Group"===e.get("dsxplan:jsType")&&(n=!0)});e=t.detect(i,function(e){return e&&e.toUpperCase()===window.enoviaServer.user.toUpperCase()})}return Boolean(!s||e)||n},_isOwnedByCurrentUser:function(){var e,t=this.hasFetchedAttribute(C.OWNER_ATTR);if(t){var n=this.get(C.OWNER_ATTR);if(n){var s=n.get("dsaccess:accountName");e=m.isLoggedInUser(s)}}return Boolean(!t||e||this.isNew())},_isOwnedByOrAssignedToCurrentUser:function(){return this._isOwnedByCurrentUser()||this._isAssignedToCurrentUser()},_filterDatabyScope:function(t){var n=this;f.getCollection()&&!f.isScopeRDF()&&e.Utils.setImmediate(function(){var e=f.getCollection();e&&!n.isInCurrentScope()&&e.remove(n,{dontRegisterChange:!0}),"function"==typeof t&&t()})},getValidTypes:function(){var e=this.isDSLC()?"dsxplan:hasTaskVocabulary":C.TASK_VOCABULARY_ATTR;return this._parent(e)},get:function(e){var t=Array.prototype.slice.call(arguments,0),n=G[e]||e;t[0]=n;var s=this._parent.apply(this,t),i=this._propertyDictionary[e];if(i&&i.date){return s?new Date(s):void 0}if(!s&&"dsplan:hasAssignee"===n){var o=D.RapidRDFModelRegistry?D.RapidRDFModelRegistry.getRapidModelByURI(this.id):void 0;if(!o)return s;if(s=s||[],o&&o.assigneeIds&&o.assigneeIds.length)for(var a=o.assigneeIds,r=a.length,d=0;d<r;d++){var u=c.getObjectForAdding(l,a[d],{mask:p.getPersonMask(),attrs:{"dsaccess:accountName":p.addIamToURI(T.getContextUser())}});s.push(u)}}return n===e&&(s=this._getAttributeValue(e,s)),"source"===n&&m.isWedoTask(this.get(C.JS_TYPE_ATTR))&&(s="swym"),n===C.FONTICON_ATTR&&(s="fonticon-plan-task"),s},_getParentProjectOrTask:function(e){var t=this.get(C.PARENT_ATTR),n=this.get(C.TASK_PARENT_ATTR);return n||(t||((this.hasFetchedAttribute(C.PARENT_ATTR)||this.hasFetchedAttribute(C.TASK_PARENT_ATTR))&&this.isStandaloneTask&&!this.isStandaloneTask()?new _:e))},_getAttributeValue:function(e,t){switch(e){case"image":return this.getIconURL();case"dsplan:actualType":case"dsxplan:actualType":var n=t;return n?{actualValue:t.id,displayValue:n.get("title")}:null;case"dsxplan:vocabularyType":t||(t="dsplan:Task");break;case"state":var s=this.get(C.STATE_ATTR);return s&&(t=enoviaServer.useFD01CodeFor3DPlan?B[s]:w[s["@id"]||s.id||s]),t;case F:var i=this.get(C.STATE_ATTR);return this.getStateForDisplayValue(i);case this.DUEDATECATEGORY:return this.dueDateCategory(this.get(this.DUEDATEATTR));case this.REFERENCEATTR:case"deliverables":return[];case C.PARENT_ATTR:return t||g.prototype.getParent.call(this);case C.COMMON_TASK_PARENT_ATTR:return this._getParentProjectOrTask(t);case"priority":return this.getPriorityValue()}return t},getStateForDisplayValue:function(e){let t;return e&&(t=enoviaServer.useFD01CodeFor3DPlan?V[e]:N[e["@id"]||e.id||e]),t},getPriorityValue:function(){var e=this.get(C.PRIORITY_ATTR);return k[e&&e.id]},getPriorityValueNLSString:function(){return W[this.getPriorityValue()]},getFieldDef:function(e){return K[e]},addObjects:function(e,t){var n=Array.prototype.slice.call(arguments,0);return n[1]=this.rdfCollabTaskInverseMapping[t]||t,this._parent.apply(this,n)},set:function(){var t=m.setHelper.apply(this,arguments),n=e.clone(t.attrs||{},!1),s=e.clone(t.options||{},!1);return n?(n.hasOwnProperty("state")&&(n[C.STATE_ATTR]=enoviaServer.useFD01CodeFor3DPlan?H[n.state]:c.getObjectForAdding(i,x[n.state]),delete n.state),n.hasOwnProperty(F)&&(n[C.STATE_ATTR]=enoviaServer.useFD01CodeFor3DPlan?j[n[F]]:c.getObjectForAdding(i,L[n[F]]),delete n[F]),n.hasOwnProperty(this.DUEDATECATEGORY)&&(n[this.DUEDATEATTR]=this.dueDateCategory2DueDate(n[this.DUEDATECATEGORY]),delete n[this.DUEDATECATEGORY]),n.hasOwnProperty(this.DUEDATEATTR)&&this._processDueDate(n),!n[C.STATE_ATTR]||"dsxplan:InProgress"!==n[C.STATE_ATTR].id&&"dsxplan:Done"!==n[C.STATE_ATTR].id||(s.dontAdjustDates=!0),s.parse||s.dontAdjustDates||this._adjustStartAndEndDates(n,s),n.hasOwnProperty(C.DSLC_TITLE_ATTR)&&void 0!==n[C.DSLC_TITLE_ATTR]&&(n[C.DSLC_TITLE_ATTR]=n[C.DSLC_TITLE_ATTR].substring(0,128)),n.hasOwnProperty("priority")&&(n[C.PRIORITY_ATTR]=c.getObjectForAdding(i,U[n.priority]),delete n.priority),this._parent(n,s)):this._parent.apply(this,arguments)},_processDueDate:function(t){var n=t[this.DUEDATEATTR];if(delete t[this.DUEDATEATTR],n=(n=e.is(n,"string")?parseInt(n,10):n)instanceof Date?n:new Date(n),t["dsplan:estimatedEndDate"]=n,!this.isStarted()){var s=new Date(this._attributes["dsxplan:estimatedEndDate"]).getTime()-new Date(this._attributes["dsxplan:estimatedStartDate"]).getTime(),i=new Date(n).getTime()-s;t["dsplan:estimatedStartDate"]=new Date(i)}var o=!isNaN(n);t[C.USER_DEFINED_START_DATE_ATTR]=o,t[C.USER_DEFINED_END_DATE_ATTR]=o},_adjustStartAndEndDates:function(t,n){var s=this,i=e.clone(n||{},!1),o=function(e,o,a,r){var l=t[e],d=t[o];if(l||d){var c=l||s.getStartDate(),p=d||s.getEndDate(),u=s._getDatesWithAdjustedHours(l,d,c,p,a,r,n);(i.adjustStartDate||l||u.end<new Date(c))&&(t[e]=u.start.toISOString()),(i.adjustEndDate||(d||u.start>new Date(p))&&!s.isInProgress())&&(t[o]=u.end.toISOString())}},a=this.isStartDateFixed(t[C.USER_DEFINED_START_DATE_ATTR]),r=this.isEndDateFixed(t[C.USER_DEFINED_END_DATE_ATTR]);(t[C.STARTDATE_ATTR]||t[C.ENDDATE_ATTR])&&o(C.STARTDATE_ATTR,C.ENDDATE_ATTR,a,r),(t[C.ACTUAL_START_DATE]||t[C.ACTUAL_END_DATE])&&o(C.ACTUAL_START_DATE,C.ACTUAL_END_DATE,a,r)},_getDatesWithAdjustedHours:function(e,t,n,s,i,o,a){var r;return n&&s?(r={start:new Date(n),end:new Date(s)},this.adjustDatesBasedOnDuration(r,i,o,a)):r={start:new Date(e),end:new Date(t)},r},addAssigneesById:function(e){var t=c.getObjectForAdding(l,e,{mask:p.getPersonMask(),attrs:{"dsaccess:accountName":p.addIamToURI(T.getContextUser())}});return this.addObjects([t],"dsxplan:hasAssignee")},assignToSelf:function(){var e=this;T.getContextUserUid()&&(this.addAssigneesById(p.addUUIDToURI(T.getContextUserUid())),this.save(null,{patch:!0,onComplete:function(){e.dispatchEvent("onChange:"+e.ASSIGNEESATTR);var t=I("emxCollaborativeTasks.Label.SuccessfullyAssignedToSelf");m.displaySuccess(t)},onFailure:function(){var e=I("emxCollaborativeTasks.Error.FailAssignToSelf");m.displayError(e)}}))},toJSON:function(t){var n,s=e.clone(t||{},!1);if(s.attributes&&s.dataForRendering){n=Object.create(null);for(var i=e.clone(s.attributes,!1),o=i.length,a=0;a<o;a++){var r=i[a],l=G[r];n[r]=!0,l&&(n[l]=!0,i.push(l))}s.attributes=i}var d=this._parent(s);if(s.dataForRendering||delete d.dueDateCategory,s.dataForRendering){var c=!n,p=this,u=function(e){if(c||n[e]){var t=p.get(e);t&&(d[e]=t)}};if(c||n[C.PARENT_ATTR]){var h=this.get(C.PARENT_ATTR);if(h){var T=s.ancestors;T||(s.ancestors=T={}),T[h.id]=!0,d[C.PARENT_ATTR]=h.toJSON(s)}}if(u("state"),u(this.DUEDATEATTR),u(this.DUEDATECATEGORY),u("modified"),u("actualStartDate"),u("canEdit"),u("priority"),d.image=this.get("dsplan:hasThumbnail")||this.get("image"),d.id=this.id,c||n.assignees){var g=d["dsplan:hasAssignee"]||d["dsplan:hasAssignee"];g&&(d.assignees=g)}u(F),d.date=new Date(this.getEndDate())}for(var E=Object.keys(d),A=E.length,f=0;f<A;f++){var D=E[f],_=d[D];_ instanceof Date&&(d[D]=_=m.dateForJSON(_,"UTC",this.dateHelper,t))}return d.physicalId=this.get("physicalId"),d},getCreationDate:function(){return this.get(C.CREATION_DATE_ATTR)},getStartAndFinishDates:function(){return{start:new Date(this.getStartDate()),finish:new Date(this.getEndDate())}},getStartDateAttr:function(){return this.isStarted()?C.ACTUAL_START_DATE:J.STARTDATE_ATTR},getStartDate:function(){var e=this.getStartDateAttr();return this._changing&&this.hasChanged(e)&&this._clearStartDateCachedValue(),this._startDate||(this._startDate=this.get(e)),this._startDate},setStartDate:function(e,t){this.isStarted()&&e>new Date||this._setDateAttribute(this.getStartDateAttr(),e,t)},_clearStartDateCachedValue:function(){delete this._startDate},getEndDateAttribute:function(){return this.isComplete()?C.ACTUAL_END_DATE:J.ENDDATE_ATTR},getEndDate:function(){return this.get(this.getEndDateAttribute())},setEndDate:function(e,t){this.isComplete()&&e>new Date||this._setDateAttribute(this.getEndDateAttribute(),e,t)},getPercentComplete:function(){return this.get("dsplan:percentageCompletion")||0},getDurationMinAsDays:function(){return this.getDurationAttributeAsDays(C.DURATION_MIN)},getDurationMaxAsDays:function(){return this.getDurationAttributeAsDays(C.DURATION_MAX)},getDurationAttributeAsDays:function(e){var t=this.get(e)||1;return t=t&&this.getDaysAsUnit(t)},getSuggestedDuration:function(){var e=this.getDurationMinAsDays(),t=this.getDurationMaxAsDays();return void 0===e?t:void 0===t?e:(e+t)/2},getSuggestedOffset:function(){var e=this.getDurationMinAsDays(),t=this.getDurationMaxAsDays();return void 0===e||void 0===t?0:(t-e)/2},getEstimatedDuration:function(){var e=this.get(C.DURATION_ESTIMATED);return e&&(e=this.getDaysAsUnit(e)),e},getAssignees:function(){return this.getCollectionAttribute(C.ASSIGNEE_ATTR,{detailsMask:"dsplan:MVMask.Person.Complex"})},isComplete:function(){var e=this.get(C.STATE_ATTR);return enoviaServer.useFD01CodeFor3DPlan?"Done"===e:(e&&(e.id||e["@id"]||e))===C.STATE_DONE},isStarted:function(){var e=this.get(C.STATE_ATTR);if(enoviaServer.useFD01CodeFor3DPlan)return"Done"===e||"In Progress"===e;var t=e&&(e.id||e["@id"]||e);return t===C.STATE_DONE||t===C.STATE_IN_PROGRESS},isInProgress:function(){var e=this.get(C.STATE_ATTR);return enoviaServer.useFD01CodeFor3DPlan?"In Progress"===e:(e&&(e.id||e["@id"]||e))===C.STATE_IN_PROGRESS},isFixed:function(){return this.isStartDateFixed()||this.isEndDateFixed()},isStartDateFixed:function(e){return Boolean(e)||this.get(C.USER_DEFINED_START_DATE_ATTR)},isEndDateFixed:function(e){return Boolean(e)||this.get(C.USER_DEFINED_END_DATE_ATTR)},getPropertyMask:function(){return"dsplan:MVMask.Task.Property"},fetchForProperty:function(){var e=this,t=function(t){e.fetch({ajax:t,mask:e.getPropertyMask&&e.getPropertyMask(),onlyIfNeeded:!0,onComplete:function(){e._getTitlesForConnectedScheduleElements()}})};if(this.hasFetchedAccessData())t();else{var n=this.getAccessBatch();t(n.ajax),n.sendBatch()}},_getTitlesForConnectedScheduleElements:function(){var e=[],t=function(t){t.get(C.DSLC_TITLE_ATTR)||-1!==e.indexOf(t.id)||e.push(t.id)};this.getToConstraints().forEach(function(e){e.getPredecessor()&&t(e.getPredecessor())}),this.getFromConstraints().forEach(function(e){e.getSuccessor()&&t(e.getSuccessor())}),e.length>0&&c.complete(void 0,e,{mask:"dsplan:MVMask.Task.Basic"})},getCompressionLevel:function(){var e=0;if(!this.isComplete()){var t=this.getSuggestedDuration(),n=this.getEstimatedDuration(),s=this.getSuggestedOffset();n&&t<n?n>=t+s&&(e=-1):n&&n<t&&(e=n<t-s/2?2:1)}return e},getCollectionAttributeBasedOnModel:function(e){if(e instanceof J)return"dsxplan:hasSubtask"},getIconURL:function(){return T.getServiceUrl("3dplan")+"/common/images/I_dsxplan_Task.png"},getWorkDayLength:function(){return C.WORKING_HOURS_IN_A_DAY},_getStartOfWorkDay:function(){return this._getUTCStartOrEndInMinutes(8)},_getEndOfWorkDay:function(){return this._getUTCStartOrEndInMinutes(16)},_getUTCStartOrEndInMinutes:function(e){var t=this.getProjectParent(this.getParent());return t?60*e-t.getCalendar().get(S.OFFSET_ATTR):60*e+240},getWorkingHoursInMilliseconds:function(){return 60*this.getWorkDayLength()*60*1e3},getErrorAssigneeIds:function(){var e=this.get("dsplan:hasScheduleError"),t=[];if(e){var s=function(e){if(e.get("@id")!==C.NO_SOLVER_ERROR){var n=e.get("dsplan:errorObject");n&&n.get&&t.push(n.get("@id"))}};e instanceof n?e.forEach(s):s(e)}return t},getDaysAsUnit:function(e){var t=c.xsdDayTimeDurationToMilliseconds(e)/this.getWorkingHoursInMilliseconds();return Math.round(100*t)/100},getDaysAsString:function(e){return c.millisecondsToXsdDayTimeDuration(e*this.getWorkingHoursInMilliseconds())},getDefinedDuration:function(){var e=this.getSuggestedDuration();return e||this.getEstimatedDuration()},handleUnsetActualStartDate:function(e){var t=this.isDSLC()?"dsxplan:hasMaturity":"dscom:hasMaturity",n=e&&"To Do"===e[F];(n=n||"To Do"===(e&&e[t]||this.changedAttributes()[t]))&&this.get(C.ACTUAL_START_DATE)&&this.unset(C.ACTUAL_START_DATE,{silent:!0})},handleUnsetParent:function(e){if(e){var t=this.getParent(),n=t&&t.getObjectType();if(n&&n!==C.TASK&&-1!==e.indexOf(C.TASK_PARENT_ATTR)&&this.unset(C.PARENT_ATTR),!this.get(C.PARENT_ATTR)&&!this.get(C.TASK_PARENT_ATTR)){this.get("dsplan:taskHasConstraint")&&this.unset("dsplan:taskHasConstraint",{silent:!0,dontRegisterChange:!0});var s=this.get("toConstraints");if(s&&s.length)s.toArray().forEach(e=>{e.destroy({noServer:!0})});var i=this.get("fromConstraints");if(i&&i.length)i.toArray().forEach(e=>{e.destroy({noServer:!0})})}}},handleSelfAssignToInWorkTask:function(){var e=m.setHelper.apply(this,arguments).attrs||{},t=this.get(this.ASSIGNEESATTR),n=!t||0===t.length,s=e.state,i=e.stateForDisplay,o=e["dscom:hasMaturity"]&&e["dscom:hasMaturity"].id,a=e["dsplan:percentageCompletion"],r=this.get("state");n&&("Active"===s||"In Progress"===i||"dsxplan:InProgress"===o||"Active"!==r&&a>0&&a<100)&&(this.addAssigneesById(p.addUUIDToURI(T.getContextUserUid())),this.addSelfAssignToInWorkMessage.apply(this,arguments))},save:function(){var e,t=m.setHelper.apply(this,arguments).attrs||{},n=this.getCombinedAttributes(t);this.markDeliverablesOn3DNavigate(),this.handleUnsetActualStartDate(t),this.handleUnsetParent(n),this.handleSelfAssignToInWorkTask.apply(this,arguments),m.isWedoTask(this.get("dsxplan:jsType"))&&(e=-1!==n.indexOf(C.PARENT_ATTR)),e&&(arguments[1].mask="dsplan:MVMask.Task.Property",arguments[1].onComplete=function(e){e.getParent()&&m.displaySuccess(I("E6WCommonApps.Alert.WedoAdded"))}),t.hasOwnProperty(C.DURATION_ESTIMATED)&&v.addToIgnoreLiveUpdateMap(this),this._parent.apply(this,arguments)},isAttributeImpactingSolve:function(e){var t=this._parent.apply(this,arguments);if(!t&&"dsxplan:percentageCompletion"===e){var n=this.get(C.STATE_ATTR),s=this.get(C.COMPLETE_PERCENT_ATTR);if(n&&(n.id===C.STATE_OPEN&&s>0||n.id===C.STATE_IN_PROGRESS&&0===s))return!0}return t},parse:function(t){var n=this.getParent();const s=this.hasFetchedAttribute(C.PARENT_ATTR)&&this.hasFetchedAttribute(C.TASK_PARENT_ATTR);var i=this._parent.apply(this,arguments);if(t&&e.is(t,"object")){var o=t["@mask"],a=d.getMask(o)||{};s&&void 0===n&&(a[C.PARENT_ATTR]&&!t[C.PARENT_ATTR]&&this.dispatchEvent("onChange:"+C.PARENT_ATTR,[this]),a[C.TASK_PARENT_ATTR]&&!t[C.TASK_PARENT_ATTR]&&this.dispatchEvent("onChange:"+C.TASK_PARENT_ATTR,[this]))}return i},adjustDatesBasedOnDuration:function(t,n,s,i){var o=e.clone(i||{},!1);P(t.start),P(t.end);var a=(this.getDefinedDuration()||1)-1;o.resized||(n&&!s?(t.end=new Date(t.start),t.end.setDate(t.start.getDate()+a)):s&&!n?(t.start=new Date(t.end),t.start.setDate(t.end.getDate()-a)):o.fromDragHandler&&s&&n&&(t.start=new Date(t.end),t.start.setDate(t.end.getDate()-a)));var r=t.start,l=this._getStartOfWorkDay();t.start=new Date(Date.UTC(r.getFullYear(),r.getMonth(),r.getDate(),0,l,0));var d=t.end,c=this._getEndOfWorkDay();this.isComplete()&&d>new Date&&(d=new Date),t.end=new Date(Date.UTC(d.getFullYear(),d.getMonth(),d.getDate(),0,c,0))},canDelete:function(){return!m.isWedoTask(this.get(C.JS_TYPE_ATTR))&&(this._parent&&this._parent())},isReadyToStart:function(){var e=this.get("dsxplan:hasMaturity");if(e&&"dsxplan:Open"===e.id){var t=this.get("dsxplan:estimatedStartDate");return new Date(t)-E.THRESHOLD>Date.now()}return!1},getParentAsLabel:function(){var e,t=this.getParent&&this.getParent();if(t&&this.isRDFTask()){var n=t.get("title");n||(n=this.get("_workscopeParent")),n&&(e={key:m.isProject(t.get("dsxplan:jsType"))?I("emxCollaborativeTasks.Label.Project"):I("emxCollaborativeTasks.Label.ParentTask"),value:n})}else this.isWedo&&this.isWedo()?e={key:I("E6WCommonApps.Label.Community"),value:this.get(C.PARENT_HAS_SWYM_COMMUNITY).get("title")}:this.get("_workscopeParent")&&(e={key:I("emxCollaborativeTasks.Label.Project"),value:this.get("_workscopeParent")});return e},getTransferObject:function(t){var n=this.getDragType(),s=e.clone(t||{},!1);return m.isWedoTask(n)&&(s.serviceId="swym"),this._parent(s)},_registerAsElementParent:function(e){e.parentId=this.id||this.cid,e.parentConstructor=this.constructor},_getDefaultSequenceOrderForAttribute:function(e){var t=Math.random();if(this.hasFetchedAttribute(e)){var n=this.get(e).last();n&&(void 0===(t=n.get(C.SEQUENCE_ORDER_ATTR_DSLC))&&(t=0),t+=Math.random())}return t},calculateAndSetDuration:function(t,n){var s=this,i=e.clone(n||{},!1),o=i.startDate||this.getStartDate(),a=i.endDate||this.getEndDate();c.request(c.expandUrl("invoke/dsmf:xplan.Scheduler.calculateTaskDuration"),{method:"POST",type:"json",data:JSON.stringify({project:t||this.getParent().id,startDate:new Date(o).toISOString(),endDate:new Date(a).toISOString()}),headers:{"Content-Type":"application/json"},onComplete:function(t){t&&t["@value"]&&s._setDurationOnModel(t["@value"]),i.dontSave||s.save(void 0,{onFailure:function(){m.displayError(I("E6WCommonApps.Error.SaveFailed"))}}),e.is(i.onComplete,"function")&&i.onComplete.apply(this,arguments)},onFailure:function(){m.displayError(I("E6WCommonApps.Error.SaveFailed"))}})},_setDurationOnModel:function(e){var t=this.getDaysAsUnit(e),n=(this.getDaysAsUnit(this.get(C.DURATION_MAX))-this.getDaysAsUnit(this.get(C.DURATION_MIN)))/2;Math.abs(n)>t&&(n=t);var s=t+n,i=t-n;this.set(C.DURATION_ESTIMATED,e),this.set(C.DURATION_MIN,this.getDaysAsString(i)),this.set(C.DURATION_MAX,this.getDaysAsString(s))},parsePruneModel:function(e){this.get(C.TASK_PARENT_ATTR)&&"dsxplan:workscopeParent"===e||this._parent.apply(this,arguments)}});return J.implement(E,{fetchDeliverableParentTypes:function(e){if(!this.hasFetchedAttribute("dsxplan:hasAttachment")){const t=this._previous.bind(this,e);return new Promise((e,n)=>{this.fetch({mask:"dsplan:MVMask.Task.ScheduleView",onComplete:function(){t().then(()=>{e()})},onFailure:n})})}return this._previous(e)}}),J.implement(A,D),J.PersonRDFModel=l,J.STARTDATE_ATTR="dsplan:estimatedStartDate",J.ENDDATE_ATTR="dsplan:estimatedEndDate",J.STATE_ATTR=C.STATE_ATTR,J.prototype.dslcMapping=b,J.prototype.inverseDslcMapping=O,J.prototype.attributeImpactingSolve=C.attributeImpactingSolve,J.prototype.rdfCollabTaskMapping=Y,J.prototype.rdfCollabTaskInverseMapping=G,Object.defineProperty(J.prototype,"completed",{get:function(){var e=this.collection&&this.collection.getDetailsMask&&this.collection.getDetailsMask()||"dsplan:MVMask.Task.CollaborativeTasks.Complex";return this.hasDataForMask(e)&&!this.fetching}}),Object.defineProperty(J.prototype,"extid",{get:function(){return this.cid}}),Object.defineProperty(J.prototype,"fixed",{get:function(){return this.isFixed()}}),Object.defineProperty(J.prototype,"fedSearchIdQuery",{get:function(){if(this.id)return'uri:"'+c.shortToLongURI(this.id)+'" OR resourceid:"'+c.removeBracketLongURI(this.id)+'"'}}),J.ATTS={PARENT:C.PARENT_ATTR,TASK_PARENT:C.TASK_PARENT_ATTR},J.PROPERTY_MASK="dsplan:MVMask.Task.Property",J}),define("DS/E6WCommonApps/DuplicateItemUtils",["UWA/Core","DS/RDFFoundation/SecurityContextUtils","DS/E6WCommonUI/UIHelper","DS/UIKIT/Input/Toggle","DS/E6WCommonApps/Models/ConstraintModel","DS/E6WCommonApps/Models/E6WCommonAppsConstants","DS/RDFFoundation/RDFUtils","DS/E6WCommonApps/Models/NoAccessModel","DS/E6WCommonApps/Models/RDFTaskModel","DS/E6WCommonApps/Models/AddTaskMixin","DS/E6WCommonApps/XTaskScope","DS/E6WCommonApps/SubscribeUtil","i18n!DS/E6WCommonUI/assets/nls/E6WCommonUINLS","i18n!DS/E6WCommonApps/assets/nls/E6WCommonAppsNLS"],function(e,t,n,s,i,o,a,r,l,d,c,p,u,h){"use strict";var m=function(e){var t=u.get(e);return t===e&&(t=h.get(e)),t},T={_getDuplicateTaskModalBody:function(){var t=e.createElement("div");return this._radio1=new s({id:"duplicateTask",name:"radio1",value:o.DUPLICATE_TASK,className:"primary",label:m("E6WCommonApps.Label.CreateDuplicateTask"),checked:!0}).inject(t),this._radio2=new s({id:"splitTask",name:"radio1",value:o.SPLIT_TASK,label:m("E6WCommonApps.Label.SplitTask"),className:"primary"}).inject(t),t},getAssigneeList:function(e){var t=[];return e.getAssignees&&e.getAssignees().length&&(t=e.getAssignees()),t},duplicateItem:function(t){var n=this,s=e.clone(t||{},!1),i=s.model,a=s.parentView,r=s.modal||a&&a.getSuperModal(),l=i.get("title"),d=s.getAssignees&&s.getAssignees(i)||n.getAssigneeList(i);d.length>1||1===d.length&&"foaf:Group"===d.at(0).get("dsxplan:jsType")?r.dialog({body:T._getDuplicateTaskModalBody(),title:h.replace(m("E6WCommonApps.Label.CreateDuplicateTask"),{NAME:l}),buttons:[{id:"duplicateBtn",className:"primary",value:m("E6WCommonUI.Label.Duplicate"),action:function(e){var t;n._radio1.isChecked()?t=n._radio1.getValue():n._radio2.isChecked()&&(t=n._radio2.getValue()),T._createDuplicateTask(i,a,{toggleValue:t,assigneeList:d,...s}),e.hide()}},{id:"duplicateCancelBtn",className:"default",value:m("E6WCommonApps.Command.Cancel"),action:function(e){e.hide()}}]}):T._createDuplicateTask(i,a,{toggleValue:o.DUPLICATE_TASK,assigneeList:d,...s})},getDurationString:function(e){return a.millisecondsToXsdDayTimeDuration(8*parseFloat(e)*60*60*1e3)},_getDefaultDupTaskAttributes:function(e){var t=d.getDefaultTaskAttributes();return t[o.TITLE_ATTR]=e.get("title"),t[o.DURATION_MIN]=this.getDurationString(e.getDurationMinAsDays()),t[o.DURATION_MAX]=this.getDurationString(e.getDurationMaxAsDays()),t[o.STARTDATE_ATTR]=new Date(e.getStartDate()),t[o.ENDDATE_ATTR]=new Date(e.getEndDate()),t[o.STATE_ATTR]={"@id":"dsxplan:Open"},t},_addDummyModelToCollection:function(e,t,n){t&&t.add(e),n&&n.add(e)},_createDummyModel:function(e){var t=this._getDefaultDupTaskAttributes(e);return new l(t,{parse:!0,dontRegisterChange:!0})},_handleConstraintsForDuplicateTask:function(e){var t=function(e){e.updateParentWorkscopes({forceDispatchEvent:!0})};e.forEach(e=>{e.getToConstraints().forEach(e=>t(e)),e.getFromConstraints().forEach(e=>t(e))})},_createDuplicateTask:function(s,i,l){var d=e.clone(l||{},!1),u=d.toggleValue?d.toggleValue:"duplicate",h=d.assigneeList?d.assigneeList:[],T=a.expandUrl("invoke/dsxplan:createDuplicateTask?$mask=dsplan:MVMask.Task.Property","v1"),g=e.is(s.getParent,"function")&&s.getParent();if(!g)return n.displayError(m("E6WCommonApps.Error.StandaloneTaskDuplicateFailed"));if(g instanceof r)return n.displayError(m("E6WCommonApps.Error.NoModifyAccessOnParent"));var E=s.get(o.PARENT_ATTR),A=s.get(o.TASK_PARENT_ATTR),f=[];E&&(f=e.is(E.getTasks,"function")&&E.getTasks()),A&&(f=e.is(A.getSubtasks,"function")&&A.getSubtasks());var C=g.get("dsxplan:hasLeafTasks");t.isTSKContext()&&c.getCollection()&&(f=c.getCollection());var D=[];if(u===o.SPLIT_TASK)for(let e=0;e<h.length;e++){let e=this._createDummyModel(s);this._addDummyModelToCollection(e,f,C),D.push(e)}else{let e=this._createDummyModel(s);this._addDummyModelToCollection(e,f,C),D.push(e)}let _=u===o.SPLIT_TASK?"E6WCommonApps.Label.SplitTask":"E6WCommonApps.Label.CreateDuplicateTask",S=p.subscribeActivity(m(_),{start:!0});a.request(T,{method:"POST",type:"json",data:JSON.stringify([{taskId:s.get("@id"),option:u,identifier:S}]),headers:{"Content-Type":"application/json"},onComplete:e=>{e.member?(this.onCompleteHandler(e,s,D,d),d.onDupTaskComplete&&d.onDupTaskComplete(D),d.onDupTaskComplete?d.onDupTaskComplete(D):!t.isTSKContext()&&this._handleConstraintsForDuplicateTask(D),s.solve()):this.onFailedHandler(e,void 0,D)},onFailure:(e,t)=>{this.onFailedHandler(e,t,D)}})},onCompleteHandler:function(e,t,s,i){var o,a=s.length<=1?m("E6WCommonApps.Label.TaskDuplicateSuccess"):m("E6WCommonApps.Label.TaskSplitSuccess");n.displaySuccess(a),s.forEach((t,n)=>{o=t._mapDslcAttributes(e.member[n]),o=t.parse(o),i.parse=!0,i.noServer=!0,t.set(o,i)})},onFailedHandler:function(e,t,s){s.forEach(e=>{e.destroy({noServer:!0})});var i=t&&t.message;i||(i=m("E6WCommonApps.Error.TaskDuplicateFailed")),n.displayError(m(i))}};return T}),define("DS/E6WCommonApps/Models/MilestoneModel",["UWA/Core","UWA/Class/Collection","DS/RDFFoundation/RDFUtils","DS/RDFFoundation/Models/ResultModel","DS/E6WCommonUI/UIHelper","DS/E6WCommonApps/Models/E6WCommonAppsConstants","DS/E6WCommonApps/Models/FileManagementMixin","DS/E6WCommonApps/Models/ScheduleElementModel","DS/E6WCommonApps/LiveUpdateUtils"],function(e,t,n,s,i,o,a,r,l){"use strict";var d=o.dslcMapping,c=n.inverseMapping(d),p=r.extend({attributeImpactingSolve:{"dsplan:dateIntervalMin":!0,"dsplan:dateIntervalMax":!0,"dsplan:estimatedDate":!0,"dsplan:suggestedDate":!0,"dscom:hasMaturity":!0,"dsplan:userDefinedDates":!0,"dsxplan:vocabularyType":!0},_uwaClassName:"MilestoneModel",_propertyDictionary:{explicitTagsData:{volatility:!0},"dsxplan:workscopeParentForMilestone":{inverseProperty:"dsxplan:hasMilestone",inversePropertyIsCollection:!0},"dsplan:workscopeParentForAll":{volatility:!0}},writeMask:"dsplan:MVMask.Milestone.Property",liveUpdateCreateMask:"dsplan:MVMask.Milestone.Complex",getAttachments:function(){return this.getCollectionAttribute(o.ATTACHMENT_ATTR,{"@mask":"dsplan:MVMask.Milestone.Property"})},setup:function(){this._parent.apply(this,arguments),this.getAttachments(),this._shadowParents=new t},save:function(){var e=i.setHelper.apply(this,arguments).options;return this.isGhost()?(e&&e.onFailure&&e.onFailure(this,{msg:"Error: xPlan.Error.NoModifyDPMMilestone","@code":401}),this.rollbackChanges(),!1):this._parent.apply(this,arguments)},validate_:function(e){var t,n={fields:[]},s=this,i=!0,a=function(t){var n;return e&&(n=e[t]),n||s.get(t)},r=Date(a.call(this,p.STARTDATE_ATTR)),l=Date(a.call(this,p.DATE_MIN_ATTR)),d=Date(a.call(this,p.DATE_MAX_ATTR)),c=a.call(this,o.SUGGESTED_DATE_ATTR);c||(n.fields.push(o.SUGGESTED_DATE_ATTR),i=!1),p.prototype._validateDateBoundaries(r,l,d,n)||(i=!1),p.prototype._validateSuggestedDate(c,n)||(i=!1);var u=a(o.TITLE_ATTR);return null==u&&(u=a(o.DSLC_TITLE_ATTR)),u&&u.trim().length||(n.fields.push(o.TITLE_ATTR),i=!1),i||(t=n),t},_validateSuggestedDate:function(e,t){var n=!0;return e&&e.actualValue&&(e=e.actualValue),e instanceof Date||(e=new Date(e),i.isValidDate(e)||(t.fields.push(o.SUGGESTED_DATE_ATTR),n=!1)),n},_validateDateBoundaries:function(e,t,n,s){var i=!0;return t>n&&(s.fields.push(p.DATE_MIN_ATTR),s.fields.push(p.DATE_MAX_ATTR),i=!1),(e>n||e<t)&&(s.fields.push(p.STARTDATE_ATTR),e>n&&-1===s.fields.indexOf(p.DATE_MAX_ATTR)&&s.fields.push(p.DATE_MAX_ATTR),e<t&&-1===s.fields.indexOf(p.DATE_MIN_ATTR)&&s.fields.push(p.DATE_MIN_ATTR),i=!1),i},getObjectType:function(){return"Milestone"},getValidTypes:function(){var e=this.isDSLC()?"dsxplan:hasMilestoneVocabulary":o.MILESTONE_VOCABULARY_ATTR;return this._parent(e)},get:function(e,t){var n=this._parent.apply(this,arguments);switch(e){case"dsplan:estimatedDate":case"dsplan:suggestedDate":case"dsplan:actualDate":case"dsplan:dateIntervalMin":case"dsplan:dateIntervalMax":t&&t.rawValue||void 0!==n&&(n=new Date(n));break;case"dsplan:actualType":case"dsxplan:actualType":t&&t.rawValue||(n=n?{actualValue:n.id,displayValue:n.get("title")}:null);break;case"dsxplan:vocabularyType":n||(n="dsplan:Milestone");break;case"title":n=n||this.get("dsxplan:label");break;case"canEdit":n=!this.isGhost()&&n}return n},getStartDate:function(){return this.isComplete()?this.get("dsplan:actualDate"):this.get(p.STARTDATE_ATTR)},setStartDate:function(e,t){var n,s,i,o,a,r=new Date(this.getStartDate());this._setDateAttribute(p.STARTDATE_ATTR,e,t),this._setDateAttribute(p.SUGGESTEDDATE_ATTR,e,t),t&&(t.updateRestrictionWithStartDate&&(n=e-r,s=[],o=this.get(p.DATE_MIN_ATTR),a=this.get(p.DATE_MAX_ATTR),o&&(o=o.getTime(),o+=n,this.setDateIntervalMin(new Date(o),{silent:!0}),s.push("onChange:"+p.DATE_MIN_ATTR),i=!0),a&&(a=a.getTime(),a+=n,this.setDateIntervalMax(new Date(a),{silent:!0}),s.push("onChange:"+p.DATE_MAX_ATTR),i=!0),i&&this.dispatchEvent("onChange:minAndMax",[s])),t.updateRestrictionIfExceeded&&(s=[],(o=this.get(p.DATE_MIN_ATTR))&&(o-e>0&&o-r<=0)&&(this.setDateIntervalMin(e,{silent:!0}),s.push("onChange:"+p.DATE_MIN_ATTR),i=!0),(a=this.get(p.DATE_MAX_ATTR))&&(e-a>0&&r-a<=0)&&(this.setDateIntervalMax(e,{silent:!0}),s.push("onChange:"+p.DATE_MAX_ATTR),i=!0),i&&this.dispatchEvent("onChange:minAndMax",s)))},setDateInterval:s.prototype._setDateAttribute,setDateIntervalMin:function(t,n){var s=e.clone(n||{},!1),i=this.getDateIntervalMin(),o=this.getDateIntervalMax();this.setDateInterval(p.DATE_MIN_ATTR,t,s);var a=new Date(this.getStartDate());t-a>0&&i-a<=0&&(s.updateRestrictionIfExceeded=!0,this.setStartDate(t,s)),t-o>0&&(delete s.updateRestrictionIfExceeded,this.setDateIntervalMax(t,s))},setDateIntervalMax:function(t,n){var s=e.clone(n||{},!1),i=this.getDateIntervalMax(),o=this.getDateIntervalMin();this.setDateInterval(p.DATE_MAX_ATTR,t,s);var a=new Date(this.getStartDate());a-t>0&&a-i<=0&&(s.updateRestrictionIfExceeded=!0,this.setStartDate(t,s)),o-t>0&&(delete s.updateRestrictionIfExceeded,this.setDateIntervalMin(t,s))},getDateIntervalMin:function(){return this.get(p.DATE_MIN_ATTR)},getDateIntervalMax:function(){return this.get(p.DATE_MAX_ATTR)},isFixed:function(){return this.get(p.FIXED_DATE)},isComplete:function(){var e=this.get(o.STATE_ATTR);return(e&&(e.id||e["@id"]))===o.STATE_DONE},canModify:function(){return!this.isGhost()&&this._parent.apply(this,arguments)},canDelete:function(){return!this.isGhost()&&this._parent.apply(this,arguments)},getIconURL:function(){return require.toUrl("DS/E6WCommonApps/assets/img/iconSmallMilestone.png")},getPropertyMask:function(){return"dsplan:MVMask.Milestone.Property"},fetchForProperty:function(){var e={mask:this.getPropertyMask&&this.getPropertyMask(),dontUpdateMask:!0,onlyIfNeeded:!0};this.fetch(e),this.fetchWorkscopeCalendar()},fetchWorkscopeCalendar:function(t){this.getParent().fetch({mask:"dsplan:MVMask.WorkPackage.CalendarOnly",onlyIfNeeded:!0,onComplete:function(){e.is(t,"function")&&t()}})},isGhost:function(){return"dsxnpi:MilestoneExternal"===this.get("dsxplan:vocabularyType")},addShadowParent:function(e){this._shadowParents.add(e)},removeShadowParent:function(e){this._shadowParents.remove(e)},getShadowParents:function(){return this._shadowParents},processLiveUpdateCreation:function(e){this._parent.apply(this,arguments),this.parentId||(this.parentId=e["@parentId"])},set:function(){var t=i.setHelper.apply(this,arguments);e.clone(t.attrs||{},!1),e.clone(t.options||{},!1);return this._parent.apply(this,arguments)}});return p.STARTDATE_ATTR="dsplan:estimatedDate",p.SUGGESTEDDATE_ATTR="dsplan:suggestedDate",p.DATE_MIN_ATTR="dsplan:dateIntervalMin",p.DATE_MAX_ATTR="dsplan:dateIntervalMax",p.FIXED_DATE="dsplan:userDefinedDates",p.STATE_ATTR="dscom:hasMaturity",p.ACTUAL_DATE="dsplan:actualDate",p.prototype.dslcMapping=d,p.prototype.inverseDslcMapping=c,p.implement(a),p}),define("DS/E6WCommonApps/Views/PropertyPanel",["UWA/Core","DS/SocialToolbar/SocialToolbar","DS/Handlebars/Handlebars4","DS/UIKIT/SuperModal","DS/E6WCommonUI/Views/FoundationBaseView","DS/E6WCommonApps/Models/MilestoneModel","DS/UIKIT/Scroller","DS/E6WCommonUI/Views/DetailsDisplayView","DS/E6WCommonApps/Models/E6WCommonAppsConstants","text!DS/E6WCommonApps/assets/templates/propertypanel.html.handlebars","i18n!DS/E6WCommonApps/assets/nls/E6WCommonAppsNLS","DS/E6WCommonUI/Views/E6WHandlebarsHelpers","DS/RDFFoundation/RDFUtils","DS/E6WCommonUI/UIHelper","DS/E6WCommonUI/PlatformManager"],function(e,t,n,s,i,o,a,r,l,d,c,p,u,h,m){"use strict";var T=n.compile(d),g=i.extend({i18n:function(e){return c.get(e)},propertyComponentFields:{},_uwaClassName:"E6WCommonUIPropertyPanel",tagName:"div",className:"property-panel",name:"E6WCommonUI.PropertyPanel",domEvents:{"click #cancelButton":"cancel","click #commentsTab":"onCommentsTabClicked","click #detailsTab":"onDetailsTabClicked","click #membersTab":"onMembersTabClicked","click #classificationTab":"onClassificationTabClicked","click #closeButton":"close","click #saveButton":"save","dragover  .panel-tab":"handleDragOver","dragleave  .panel-tab":"handleDragLeave"},id:function(){return"e6WCommonUIPropertyPanel"+this.cid},handleDragLeave:function(){this._dragOverTimeout&&clearTimeout(this._dragOverTimeout),delete this._dragOverTimeout},handleDragOver:function(t){var n=this;return this._dragOverTimeout||(this._dragOverTimeout=setTimeout(function(){t.preventDefault&&t.preventDefault(),t.dataTransfer.dropEffect="copy";var s=e.Event.getElement(t);s.getElement(".panel-tab")||(s=s.getClosest(".panel-tab")),"detailsTab"===s.id?n.onDetailsTabClicked():"membersTab"===s.id?n.onMembersTabClicked():"commentsTab"===s.id&&n.onCommentsTabClicked()},1e3)),!1},setup:function(t){var n=e.clone(t||{},!1),i=n.alertMessageContainer||this.container;this._parent.apply(this,arguments),this.modal=new s({renderTo:i,okButtonText:this.i18n("E6WCommonApps.Command.Yes"),koButtonText:this.i18n("E6WCommonApps.Command.No")});var o=this.cloneModelForDetailDisplayView();o&&(o.validationError=e.is(o.validate,"function")&&o.validate(o.toJSON()));var a=e.clone(t.detailsViewParameters||{},!1);a.model=o,a.context=t.context,a.i18n=this.i18n,a.tenant=window.enoviaServer.tenant,a.isPropertyPanel=!0,a.isShadowMilestone=n.isShadowMilestone,this._detailsView=new r(a),this.addChildView(this._detailsView),this.buttonConfig=n.buttons||[],this._selectedTab="detailsTab",this.model&&(this.resetModel(this.model,{force:!0,onDelete:n.onDelete,noRender:n.noRender,isShadowMilestone:n&&n.isShadowMilestone,isSummaryTask:n.isSummaryTask}),this.listenTo(this._detailsView.model,"onChange:modificationsPending",this.setSaveState)),this.listenTo(this._detailsView,"scrollToElement",this.scrollToElement)},createCommonLibrary:function(e){h.loadJSDependency("DS/ENOProjectMgmtCommonComponents/components/CommonInitializer").then(t=>{h.fixDisplayMessageMethod(),g.commonInitializerLibrary=new t({isComponent:!0,loadClassification:!0,isLibraryInstalled:e,securityContext:window.enoviaServer.space})}).catch(e=>{"scripterror"===e.requireType&&console.error(e.message)})},onFieldValueChange:function(){var e=this._scroller&&this._scroller.getInnerElement().scrollTop,t=this._scroller&&this._scroller.getInnerElement().scrollLeft;this._detailsView.setConfig(this.getConfig()),this._renderBodyContent(),this._scroller&&this._scroller.scrollTo(t,e)},updateCommonInitializerLibrary:function(){g.commonInitializerLibrary&&g.commonInitializerLibrary.initializeComponent&&g.commonInitializerLibrary.initializeComponent({isComponent:!0,loadClassification:!0,securityContext:window.enoviaServer.space})},render:function(){if(!this.model)return this;this.container.setHTML(this.template()),this._initButtons(this.buttonConfig),this._renderBodyContent();var e=this.container.getElement("#detailsTab"),t=this.container.getElement("#membersTab"),n=this.container.getElement("#commentsTab"),s=this.container.getElement("#classificationTab");return this.addChildView(h.createTooltip(e,this.i18n("E6WCommonApps.Command.Properties"))),this.addChildView(h.createTooltip(t,this.i18n("E6WCommonApps.Command.Members"))),this.addChildView(h.createTooltip(n,this.i18n("E6WCommonApps.Command.Comments"))),this.addChildView(h.createTooltip(s,this.i18n("E6WCommonApps.Command.Classification"))),this},_renderBodyContent:function(){this._detailsView.remove(),this._commentsView&&this._commentsView.remove(),this._classificationTabContainer&&this._classificationTabContainer.remove(),this.container.getElement("#detailsPanelFrame").empty(),this._scrollerElement&&this._scrollerElement.destroy(),this._scrollerElement=e.createElement("div",{id:"detailsPanelScroller",styles:{"-webkit-user-select":"text"}}),this._scrollerElement.inject(this.container.getElement("#detailsPanelFrame")),this._setSelectedTab(this._selectedTab);var t=this._detailsView.render({boundingElement:this._scrollerElement}).container;t.inject(this._scrollerElement),"commentsTab"===this._selectedTab&&(t.remove(),this._commentsView.inject(this._scrollerElement));var n=this,s=this.container.getElement("#classificationTab"),i=this.model.get("dsxplan:jsType")||this.model.get("type"),o=n.validTypesForClassificationTab(i);o&&!n.model.isRDF?s.style.display="inline-block":(s.style.display="none","classificationTab"===n._selectedTab&&n._setSelectedTab("detailsTab"));var a=function(){n._scrollerTimeout&&clearTimeout(n._scrollerTimeout),delete n._scrollerTimeout,"detailsTab"!==n._selectedTab&&"membersTab"!==n._selectedTab||!n._detailsView?"commentsTab"===n._selectedTab?(!n._commentsView&&n._initCommentsView(),n._setScrollerContent(n._commentsView)):"classificationTab"===n._selectedTab&&o&&!n.model.isRDF&&(!n._classificationTabContainer&&n._initClassificationTabView(),n._setScrollerContent(n._classificationTabContainer)):n._detailsView.container.offsetWidth?n._setScrollerContent(n._detailsView):n._scrollerTimeout=setTimeout(a,500)};a()},validTypesForClassificationTab:function(e){return["dsplan:Task","swym:WeDo","Task","Gate","Milestone","Phase"].includes(e)},cancel:function(t){var n=e.clone(t||{},!1),s=this,i=function(){n.keepPanelOpen||s.close(),e.is(n.onCancel,"function")&&n.onCancel(),s.dispatchEvent("onCancel")};this._detailsView&&this._detailsView.model&&this._detailsView.model.modificationsPending?this.model.destroying?(h.displayInfo(this.model.get("title")+" "+this.i18n("E6WCommonApps.Error.HasBeenDeleted")),this._detailsView.model.cancel(),i()):this.modal.confirm(this.i18n("E6WCommonApps.Warning.PendingChanges"),this.i18n("E6WCommonApps.Command.CancelChanges"),function(t){t?(s._detailsView.model.cancel(),i()):e.is(n.onAbortCancel,"function")&&n.onAbortCancel()}):i()},save:function(){var t=this,n=this._detailsView._config,s=n&&e.clone(n.options||{},!1);t.model.isSavePending=!0;var i=this.model,o=this._detailsView.model,a=this.classificationView&&this.classificationView.currentModel,r=a&&a.get("ClassificationAttributes"),d=o.localAttributes.hasOwnProperty(l.ACTUAL_START_DATE)||o.localAttributes.hasOwnProperty(l.ACTUAL_END_DATE),c=function(){t._detailsView.model.save({mask:i.getPropertyMask&&i.getPropertyMask(),onComplete:function(n,o){delete i.isSavePending,i.dispatchEvent("saveCompleted"),s&&e.is(s.onComplete,"function")&&s.onComplete.apply(t,arguments),o&&!r&&h.displaySuccess(t.i18n("E6WCommonApps.Label.SuccessfulSave"))},onFailure:function(){s&&e.is(s.onFailure,"function")&&s.onFailure.apply(t,arguments)}})};if("dsplan:Task"===i.getObjectType()&&d){var p=i.getProjectParent(i).id;i.calculateAndSetDuration(p,{startDate:o.getStartDate().actualValue,endDate:o.getEndDate().actualValue,dontSave:!0,onComplete:function(){c()}})}else c();r&&r.length>0&&t.classificationView.save({onComplete:function(){s&&e.is(s.onComplete,"function")&&s.onComplete.apply(this,arguments),arguments[0]&&arguments[0].err?h.displayError(arguments[0].err.message):h.displaySuccess(t.i18n("E6WCommonApps.Label.SuccessfulSave"))}})},resetModel:function(t,n){var s=e.clone(n||{},!1),i=s.force;if(t&&t.fetchForProperty&&t.fetchForProperty(),i||t!==this.model){if(this._detailsView.model&&this.stopListening(this._detailsView.model),i||this._detailsView){var o=this._detailsView.model;this.model&&t.constructor!==this.model.constructor&&this._detailsView.setConfig([]),this.model=t;var a=this.cloneModelForDetailDisplayView();a.validationError=e.is(a.validate,"function")&&a.validate(a.toJSON()),this._detailsView.resetModel(a,void 0,{noRender:!0,isShadowMilestone:s.isShadowMilestone}),this._handlePeopleTabDisplay(n),this._detailsView.setConfig(this.getConfig(n)),o&&o.destroy()}this._initCommentsView(),this._addModelEvents();var r=this.model.get("dsxplan:jsType")||this.model.get("type");this.validTypesForClassificationTab(r)&&!this.model.isRDF&&this._detailsView.model?this._handleClassificationTabDisplay():this.classificationView=void 0,this.setSaveState(),!s.noRender&&this._smartRender(),t.isValid()?this.enableSaveButton():this.disableSaveButton(),this._updateActionButtonsState(s)}},_handleClassificationTabDisplay:function(){this._initClassificationTabView(),this.renderClassificationView()},renderClassificationView:function(){var e=this;h.loadJSDependency("DS/ENOProjectMgmtCommonComponents/views/ClassificationView").then(function(t){h.fixDisplayMessageMethod(),e.classificationView=new t(e._classificationTabContainer,{isComponent:"true",currentModel:e._detailsView.model,homeView:e}),e.classificationView.render()}).catch(e=>{"scripterror"===e.requireType&&console.error(e.message)})},onDeleteAccessChange:function(){this._detailsView.setConfig(this.getConfig({isShadowMilestone:this.isShadowMilestone})),this._smartRender(),this._updateStateOfDeleteButton()},getManagementView:function(){return this.managementView},getIfShadowMilestoneView:function(){var e=this.getManagementView(),t=e&&e.getCurrentlySelectedViewOnScheduleView&&e.getCurrentlySelectedViewOnScheduleView();return t&&t.isShadowMilestone},_addModelEvents:function(){var e={"onChange:modificationsPending":this.setSaveState,onValidationFailure:this.disableSaveButton,onValidationSuccess:this.enableSaveButton,onChange:function(e,t){if(t&&t.config&&("dsplan:hasAssignee"===t.config.name||"assignees"===t.config.name)){var n=e.get(t.config.name);this._updateStateOfAssignToSelfButton(n)}}};this.listenTo(this._detailsView.model,e);var t={"onChange:dsxplan:hasAssignee":this._updateActionButtonsState,onChange:function(e,t){t&&"assignees"===t.relationshipChanged&&this._updateActionButtonsState()},onModifyAccessChanged:function(){this._detailsView.render(),this._updateActionButtonsState()},onDeleteAccessChanged:this.onDeleteAccessChange,onDestroy:this.close};this.listenTo(this.model,t),this.listenTo(this._detailsView.model,"onChange:"+l.CONTENT_REPOSITORY,this.onFieldValueChange),this.listenTo(this.model,"onChange:"+l.MILESTONE_VOCABULARY_TYPE,this.onFieldValueChange)},_updateActionButtonsState:function(e){this._updateStateOfAssignToSelfButton(),this._updateStateOfDuplicateButton(e),this._updateStateOfDeleteButton(e),this._handlePeopleTabDisplay(e)},_updateStateOfAssignToSelfButton:function(e){var t=this.getElement("#assignToSelfItem");t&&(this.model&&!this.model.canAssignToSelf(e)?t.toggleClassName("disabled",!0):t.toggleClassName("disabled",!1))},_updateStateOfDuplicateButton:function(t){var n=this.getElement("#duplicateButton");n&&(t&&t.isSummaryTask||e.is(this.model.canModify,"function")&&!this.model.canModify()?n.toggleClassName("disabled",!0):n.toggleClassName("disabled",!1))},_updateStateOfDeleteButton:function(e){var t=this.getElement("#deleteButton");t&&(e&&e.isShadowMilestone||this.isShadowMilestone||this.model&&(this.model.isRouteTask&&this.model.isRouteTask()||!this.model.canDelete())?t.toggleClassName("disabled",!0):t.toggleClassName("disabled",!1))},_handlePeopleTabDisplay:function(t){var n=e.clone(t||{},!1);n.isShadowMilestone=t&&t.isShadowMilestone||this.isShadowMilestone;var s=this.getPersonConfig(this.getOriginalConfig(n)),i=this.container.getElement("#membersTab");n.isShadowMilestone&&i&&(i.style.display="none"),i&&(0===s.length?(i.style.display="none","membersTab"===this._selectedTab&&this._setSelectedTab("detailsTab")):i.style.display="inline-block")},_smartRender:function(){0!==this.container.childElementCount?this._renderBodyContent():this.render()},disableSaveButton:function(){var e=this.container.getElement("#saveButton");e&&e.setAttribute("disabled","disabled")},enableSaveButton:function(){var e=this.container.getElement("#saveButton");e&&e.removeAttribute("disabled")},showOrHideBookmarkForRepositoryField:function(e){let t=this._detailsView&&this._detailsView.model;var n=t&&t.get(l.CONTENT_REPOSITORY);if(t&&(!n||"3DDrive"===n.serviceHosting)){var s=e.findIndex(function(e){return e.name===l.BOOKMARK_FOR_FILE_REPOSITORY});-1!==s&&e.splice(s,1)}},template:function(t){var n=e.clone(t||{},!1).data;n={};var s=p.i18n;p.i18n=this.i18n;var i=T(n);return p.i18n=s,i},selectTab:function(e){"commentsTab"===e&&this.onCommentsTabClicked()},onCommentsTabClicked:function(){"commentsTab"!==this._selectedTab&&(this._setSelectedTab("commentsTab"),this._setScrollerContent(this._commentsView))},onMembersTabClicked:function(){"membersTab"!==this._selectedTab&&(this._setSelectedTab("membersTab"),this._detailsView.setConfig(this.getConfig()),this._setScrollerContent(this._detailsView.render().container),this._updateStateOfAssignToSelfButton())},onDetailsTabClicked:function(){"detailsTab"!==this._selectedTab&&(this._setSelectedTab("detailsTab"),this._detailsView.setConfig(this.getConfig({isShadowMilestone:this.isShadowMilestone})),this._setScrollerContent(this._detailsView.render().container))},onClassificationTabClicked:function(){if("classificationTab"!==this._selectedTab){this._setSelectedTab("classificationTab");this._classificationTabContainer;this.renderClassificationView(),this.classificationView&&this._setScrollerContent(this.classificationView.container)}},_disableTabFocusOnElements:function(){this._setTabIndexOnFocusableElements(-1)},_enableTabFocusOnElements:function(){this._setTabIndexOnFocusableElements(0)},_setTabIndexOnFocusableElements:function(e){var t=-1===e?0:-1;this.container.getElements("input").concat(this.container.getElements("a")).concat(this.container.getElements("link")).concat(this.container.getElements("select")).concat(this.container.getElements("textarea")).concat(this.container.getElements("button")).concat(this.container.getElements(".autocomplete-searchbox")).concat(this.container.getElements("[tabIndex='"+t+"']")).forEach(function(t){t.setAttribute("tabIndex",e)})},close:function(){this._disableTabFocusOnElements()},open:function(){this._enableTabFocusOnElements()},getConfig:function(e){if(g.DEACTIVATE_MEMBERS_TAB)return e;var t=this.getPersonConfig(e),n=e.filter(e=>"person"!==e.type);return"membersTab"===this._selectedTab?(t.options=e.options,t):(n.options=e.options,n)},getPersonConfig:function(e){return e.filter(e=>"person"===e.type)},setSaveState:function(){this.container.toggleClassName("save-needed",this.saveNeeded())},saveNeeded:function(){return Boolean(this._detailsView.model.modificationsPending)},cloneModelForDetailDisplayView:function(){throw new Error("In PropertyPanel cloneModelForDetailDisplayView, this should be implemented in subclass.")},getOriginalConfig:function(){throw new Error("In PropertyPanel getOriginalConfig, this should be implemented in subclass.")},destroy:function(){this._parent(),delete this._detailsView,this._commentsView&&this._commentsView.destroy(),delete this._commentsView,this._classificationTabContainer&&this._classificationTabContainer.destroy(),delete this._classificationTabContainer,this.modal.destroy(),delete this.modal;var e=this._detailsView&&this._detailsView.model;e&&e.destroy(),this._scrollerElement&&this._scrollerElement.destroy(),delete this._scrollerElement,this._scroller&&this._scroller.destroy(),delete this._scroller,delete this.buttonConfig,this._scrollerTimeout&&clearTimeout(this._scrollerTimeout),delete this._scrollerTimeout},_initClassificationTabView:function(){this._classificationTabContainer&&this._classificationTabContainer.destroy(),this._classificationTabContainer=e.createElement("div",{class:"classification-tab"})},_setSelectedTab:function(e){this._selectedTab=e,this.container.getElements(".panel-tab").forEach(function(t){t.toggleClassName("selected",t.id===e)})},_initCommentsView:function(){this._commentsView&&this._commentsView.destroy();var e={tenantId:enoviaServer.tenant,enableShare:!1,"3DSwymUrl":window.enoviaServer.swym,commentsNumberAtInit:8};this.model.isRDF?(e.subjectURI=this.model.id,e.serviceURL=m.getServiceUrl("3dplan")+"/dsplan"):(e.subjectURI="pid:"+this.model.id,e.serviceURL=window.enoviaServer.computeUrl("/resources/"),e.commentProxyToken={header:"X-DS-CSRFTOKEN"},e.appForcedLinkUri="/#app:"+widget.getValue("appId")+"/content:id="+this.model.id+"&propertyPanelTab=commentsTab&x3dPlatformId="+enoviaServer.tenant),this._commentsView=new t(e)},_setScrollerContent:function(e){this._scroller&&(this._scroller.destroy(),this._scrollerElement.empty()),e.inject(this._scrollerElement),this._scroller=new a({element:this._scrollerElement}).inject(this.getElement("#detailsPanelFrame")),this.getElement(".scroller-content").addEventListener("scroll",()=>{this._detailsView.handleParentScroll()})},_initButtons:function(t){var n=this.container.getElement(".panel-actions");if(t&&n){n.empty();var s=this,i=0;t.forEach(function(t){var o;o=t.content?e.createElement("div",{class:"panel-action",id:t.id,"data-title":t.title,html:t.content}):e.createElement("div",{class:"panel-action icon-only-button",html:{tag:"button",id:t.id||s.cid+"Button"+i,class:"btn","data-title":t.title,html:{tag:"span",class:"fonticon fonticon-"+(t.fonticon||"info")}}}),h.createTooltip(o,t.title),o.inject(n),i+=1})}},getCloneModel:function(){return this._detailsView.model},getFieldViewByName:function(e){return this._detailsView.getFieldViewByName(e)},scrollToElement:function(e){this._scroller.scrollToElement(e)}});return g.COMMENTS_TAB="commentsTab",g.MEMBERS_TAB="membersTab",g.DEACTIVATE_MEMBERS_TAB=!1,g.DRAGOVER_DELAY=1e3,g}),define("DS/E6WCommonApps/ReparentingUtils",["UWA/Core","DS/RDFFoundation/RDFUtils","DS/E6WCommonApps/Models/RDFTaskModel"],function(e,t,n){"use strict";var s={checkParentHierarchyForId:function(e){var s,i,o,a,r=t.getBatchGenerator(),l=JSON.stringify([e.parentId,e.childId]);r.ajax(t.expandUrl("/invoke/dsxplan:checkIfChildIsAlreadyInAncestor"),{method:"POST",type:"json",data:l,headers:{"Content-Type":"application/json"},onComplete:function(e){s=e.value||e["@value"]}}),o=e.type===n?"dsplan:MVMask.Task.CollaborativeTask.siblings":"dsplan:MVMask.WorkPackage.Drop";var d=(a=t.getObjectForAdding(e.type,e.childId,void 0)).getParent&&a.getParent();d?i=d.id===e.parentId:a.fetch({mask:o,ajax:r.ajax,onlyIfNeeded:!0,onComplete:function(t){var n=t&&t.getParent();i=Boolean(n&&n.id===e.parentId)}}),r.sendBatch({onComplete:function(){e.onComplete({value:s||i,parentName:d&&d.get("title"),childName:a&&a.get("title")})}})}};return s}),define("DS/E6WCommonApps/Collections/TasksSplitCollection",["UWA/Core","UWA/Class/Collection","DS/E6WCommonApps/Models/E6WCommonAppsConstants"],function(e,t,n){"use strict";var s=function(e){return e&&e.actualValue||e},i=n.DUE_DATE_CATEGORY;return t.extend({_uwaClassName:"XTaskSplitCollection",model:{},fetch:function(){},complete:function(){this._parentCollection.complete.apply(this._parentCollection,arguments)},setup:function(e,t){var n=Array.prototype.slice.call(arguments,0);this._filterAttr=t.filterAttr,this._valueForFiltering=t.valueForFiltering,this._parentCollection=t.parentCollection;var s="onChange:"+this._filterAttr,o={onAdd:this._onParentAdd,onRemove:this._onParentRemove,onReset:this._onParentReset};o[s]=this._onAttrChange,this._filterAttr!==i&&"priority"!==this._filterAttr||(o["onChange:state"]=this._onAttrChange),this.listenTo(this._parentCollection,o),this._parent.apply(this,n)},_onParentAdd:function(t,n,i){if(n===this._parentCollection){var o=s(t.get(this._filterAttr)),a=s(this._valueForFiltering),r=e.clone(i||{},!1);r.at=0,r.parse=!1,o===a&&this._canIncludeModel(t)&&this.add(t,r)}else this.stopListening(n,"onAdd")},_onParentRemove:function(e,t){t===this._parentCollection?this.remove(e):this.stopListening(t,"onRemove")},_onParentReset:function(e){if(e===this._parentCollection){var t=e.tasksWithAttrValue(this._valueForFiltering,this._filterAttr);this.reset(t)}else this.stopListening(e,"onReset")},_onAttrChange:function(e,t,n){s(e.get(this._filterAttr))===s(this._valueForFiltering)&&this._canIncludeModel(e)?(this.add(e,{at:0}),n.at=0):this.remove(e)},_canIncludeModel:function(e){var t;return this._filterAttr===n.DUE_DATE_CATEGORY&&(t=s(e.get("state"))),"priority"===this._filterAttr&&(t=s(e.get("stateForDisplay"))),!("Complete"===t||"Done"===t)},dataForRendering:function(){var t={};if("state"===this._filterAttr)if("string"===e.typeOf(this._valueForFiltering)){var n={actualValue:this._valueForFiltering,displayValue:this._valueForFiltering};t.state=n}else t.state=this._valueForFiltering;if(this._filterAttr===i){var s=this._valueForFiltering;s.displayValue||(s.displayValue=s.actualValue),t.dueDate=s}return t.collabSpace=this.collabSpace,t.extid=this.extid,t.filteredByAttr=this._filterAttr,t.filteredByValue=this._valueForFiltering,t.filteredCount=this.size(),t},getSaveAttributes:function(){var e={},t=s(this._valueForFiltering);return e[this._filterAttr]=t,e}})}),define("DS/E6WCommonApps/Collections/RDFTasksCollection",["UWA/Core","UWA/Class/Events","UWA/Class/Listener","UWA/Class","UWA/Class/Collection","DS/RDFFoundation/Collections/ResultCollection","DS/E6WCommonUI/UIHelper","DS/E6WCommonApps/Models/RDFTaskModel","DS/E6WCommonApps/Models/AddTaskMixin","DS/RDFFoundation/RDFUtils","DS/RDFFoundation/Models/ResultModel","DS/E6WCommonApps/Models/E6WCommonAppsConstants","DS/E6WCommonApps/XTaskScope","DS/RDFFoundation/Models/PersonRDFModel","DS/E6WCommonApps/SmartSchedulerUtils","DS/E6WCommonApps/Collections/TasksSplitCollection","i18n!DS/E6WCommonApps/assets/nls/E6WCommonAppsNLS","i18n!DS/E6WCommonUI/assets/nls/E6WCommonUINLS"],function(e,t,n,s,i,o,a,r,l,d,c,p,u,h,m,T,g,E){"use strict";var A=Function.prototype,f=function(e){return e&&e.actualValue||e},C=o.extend({_uwaClassName:"RDFWorkscopeCollection"}),D=o.extend({model:r,_relations:{key:"scopes",relatedCollection:C},_uwaClassName:"RDFTasksCollection",comparator:function(e,t){var n=e.get("dsxplan:sequenceOrder"),s=t.get("dsxplan:sequenceOrder");if(void 0!==n&&void 0!==s&&n!==s)return n-s;var i,o,a=e.newThisSession?1:0,r=t.newThisSession?1:0;return e.newThisSession||t.newThisSession||(i=new Date(e.getStartDate()),o=new Date(t.getStartDate()),a=i.getTime(),r=o.getTime()),a===r&&(i=new Date(e.get("dspol:creationDate")),o=new Date(t.get("dspol:creationDate")),a=i.getTime(),r=o.getTime()),a-r},_completeModelsInQueue:function(){if(this.toComplete&&this.toComplete.length){var e=this.toComplete;delete this.toComplete,this.complete(e)}},complete:function(t,n){var s=e.clone(n||{},!1),i=t.filter(function(t){return t instanceof c||e.is(t,"string")}).map(function(e){return e.id||e});if(i.length)if(!this.completing||n&&n.mask){var o=this;this.completing=!0,d.complete(this.model,i,{mask:n&&n.mask||this.getDetailsMask(),onComplete:function(){o.completing=!1,o._completeModelsInQueue(),n&&n.onComplete&&n.onComplete(),o.dispatchEvent("doneCompleting")},onlyIfNeeded:s.onlyIfNeeded,attrs:{forceDslc:!0}})}else this.toComplete||(this.toComplete=[]),Array.prototype.push.apply(this.toComplete,i)},setAttrToSplitBy:function(e){this._attrToSplitBy=e},setIdForCreateChild:function(e){this._createChildId=e},getIdForCreateChildDSLC:function(){return this._createChildId?this._createChildId:this._parent.apply(this,arguments)},createStandaloneRDFTask:function(t){var n=e.clone(t||{},!1),s=l.getDefaultTaskAttributes();e.extend(s,n);return s[p.DESCRIPTION_ATTR]="",s[p.STATE_ATTR]={"@id":"dsxplan:Open"},new r(s)},addNewTask:function(e,t,n){var s;if(widget){var i={title:e,"dsxplan:durationIntervalMin":"PT86400S","dsxplan:durationIntervalMax":"PT86400S"},o=t||this.parentModel;s=o?o.addTask(i):this.createStandaloneRDFTask(i);var r="/invoke/dsxplan:getTasks"===this.getUri()?this.currentScopeCollection:this;(!o||r&&r!==o.getTasks())&&(this.add(s),s.keepWhenUpdating=!0),s.save(null,{onFailure:function(){var e,t;a.displayError((e="E6WCommonApps.Error.FailedToCreateTask",(t=E.get(e))===e&&(t=g.get(e)),t)),n&&n.onFailure&&n.onFailure.apply(this,arguments)},onComplete:function(e){e.solve(),n&&n.onComplete&&n.onComplete.apply(this,arguments)},at:0})}return s},setup:function(t,n){var s=Array.prototype.slice.call(arguments,0);this._TasksByAttr={},this._attrToSplitBy="state",this.extid="allTasks";var i=e.clone(n,!1);this.parentModel=i.parentModel,s[1]=i,this._parent.apply(this,s)},setSearch:function(e){this._search=e.toLowerCase(),this._cleanupSubCollections()},resetSearch:function(){delete this._search,this._cleanupSubCollections()},getSearch:function(){return this._search},tasksWithAttrValue:function(e,t){var n=this,s=t||this._attrToSplitBy,i=f(e);return this.filter(function(e){var t=f(e.get("state")),o=f(e.get(s)),r=f(e.get("dsxplan:label"));r=r?r.toLowerCase():"";var l=!n._search||a.match(n._search,r);return(s!==p.DUE_DATE_CATEGORY&&"priority"!==s||"Complete"!==t)&&(o===i&&l)})},tasksWithAttrValueCollection:function(e,t){if(void 0===e)throw new Error("Invalid attribute value passed.");var n=t||this._attrToSplitBy,s=f(e),i=this._TasksByAttr[n];if(!i||!i[s]){var o=this.tasksWithAttrValue(e,n),a={filterAttr:n,valueForFiltering:e,parentCollection:this},r=new D.TasksSplitCollection(o,a);r.extid="tasks-"+n+"-"+s,i||(this._TasksByAttr[n]=i={}),i[s]=r}return i[s]},_cleanupSubCollections:function(){var e=Object.prototype.hasOwnProperty;for(var t in this._TasksByAttr)e.call(this._TasksByAttr,t)&&this._cleanupSubCollectionForAttr(t)},_cleanupSubCollectionForAttr:function(e){var t=Object.prototype.hasOwnProperty,n=this._TasksByAttr[e];for(var s in n){if(t.call(n,s))n[s].stopListening(),delete n[s]}},scopesTypesForSearch:function(){return[]},scopesTypes:function(){return[]},projectTypesForSearch:function(){if(d.typeDictionary&&d.typeDictionary.typeHierarchy)return d.typeDictionary.typeHierarchy["dsplan:WorkPackage"]},projectTypes:function(){if(d.typeDictionary&&d.typeDictionary.typeHierarchy)return d.typeDictionary.typeHierarchy["dsplan:WorkPackage"]},reset:function(e,t){var n=Array.prototype.slice.call(arguments,0);if(u.isScopeRDF()&&t&&t.parse){var s={};try{s.member=e["dsxplan:hasTask"].member,s["@href"]="/classes/dsplan:Task",s["@id"]="dsplan:Task",s["@mask"]="dsplan:MVMask.Task.CollaborativeTask.Basic",s["@type"]="Collection",s.totalItems=s.member.length,n[0]=s}catch(e){}}this._parent.apply(this,n)},_scopeCollectionAdd:function(t,n,s){var i=e.clone(s||{},!1);i.parse=!1,this.add(t,i)},_scopeCollectionRemove:function(t,n,s){e.clone(s||{},!1).parse=!1,this.remove(t,s)},_scopeCollectionReset:function(e){var t=e.toArray();this.reset(t)},fetch:function(t){var n=this,s={cancel:A,noFetch:!0},o=e.clone(t||{},!1);if(o.dontFetch)return s;if(u.getScopeId()&&!u.isScopeRDF())return this.reset(void 0,o),s;var a={onAdd:this._scopeCollectionAdd,onRemove:this._scopeCollectionRemove,onReset:this._scopeCollectionReset};if(this.stopListening(void 0,a),u.isScopeRDF()&&o.reset){var r=d.hasLoadedDictionary()?void 0:{newTransaction:!0,onFailure:function(){n.dispatchEvent("onFailToFindScope")},attrs:{forceDslc:!0}},l=d.getObjectForAdding(D.RDFWorkscopeModel,u.getScopeId(),r).getTaskCollectionForFilter(u.getFilter(),r);return this!==l&&(this.listenTo(l,a),this.currentScopeCollection=l,this.reset(l.toArray())),s}if(o.reset){var c={fromCompletionDate:m.getCompletedTaskFilter()};e.merge(o,{method:"POST",data:JSON.stringify([u.getFilter(),c]),headers:{"Content-Type":"application/json"}})}return o.url?(o.reset=!0,i.prototype.fetch.call(this,o)):(o.onComplete=function(){n._completeModelsInQueue(),t&&t.onComplete&&t.onComplete.apply(this,arguments)},o.onFailure=function(){n._completeModelsInQueue(),t&&t.onFailure&&t.onFailure()},this._parent(o))},getRelatedObject:function(e,t){var n=new h(d.createPlaceholder(t));return n.fetch({mask:"dsplan:MVMask.Person.Complex"}),n},add:function(e){var t,n=this._parent.apply(this,arguments);if(n){t=n,n instanceof r&&(t=[n]);for(var s=0;s<t.length;s++){var i=t[s];this.stopListening(i,"onChange:"+p.SEQUENCE_ORDER_ATTR),this.listenTo(i,"onChange:"+p.SEQUENCE_ORDER_ATTR,this.sort)}}return e&&this._dispatchModelEvent(t,"onRapidAdd"),n},remove:function(e){var t=this._parent.apply(this,arguments);return e&&this._dispatchModelEvent(e,"onRapidRemove"),t},_dispatchModelEvent:function(e,t){var n=this;e&&e.forEach?e.forEach(function(e){n.dispatchEvent(t,[e])}):e&&this.dispatchEvent(t,[e])}});return D.TasksSplitCollection=T.extend({model:r,_uwaClassName:"RDFTasksSplitCollection",setup:function(){var e=this._parent.apply(this,arguments);return this.listenTo(this._parentCollection,"onTaskCollectionFetchComplete",function(){this.dispatchEvent("onTaskCollectionFetchComplete")}),e},add:function(t){var n=Array.prototype.slice.call(arguments,0);if(e.is(t,"array"))n[0]=t.filter(function(e){return e.isInCurrentScope&&e.isInCurrentScope()});else if(t.isInCurrentScope&&!t.isInCurrentScope())return!1;return this._parent.apply(this,n)},comparator:function(e,t){var n=e.get("dsplan:sequenceOrder"),s=t.get("dsplan:sequenceOrder");if(void 0!==n&&void 0!==s)return n-s;var i=new Date(e.getStartDate()),o=new Date(t.getStartDate());return i.getTime()-o.getTime()}}),D}),define("DS/E6WCommonApps/Collections/HasConstraintsCollection",["UWA/Core","DS/RDFFoundation/Collections/ResultCollection","DS/E6WCommonApps/Models/ConstraintModel"],function(e,t,n){"use strict";var s=t.extend({_uwaClassName:"HasConstraintCollection",setup:function(){this._parent.apply(this,arguments),this.setDetailsMask("dsplan:MVMask.Constraint.Complex")},getUri:function(e){return e&&e.forNewObject&&s.computedProperty?"/classes/"+n.CONSTRAINT_RDF_TYPE:this._parent.apply(this,arguments)}});return s.computedProperty=!0,s}),define("DS/E6WCommonApps/Models/ScheduleElementCloneModel",["DS/RDFFoundation/RDFUtils","DS/E6WCommonUI/UIHelper","DS/RDFFoundation/Models/CloneModelForRepository","DS/E6WCommonApps/Models/E6WCommonAppsConstants","i18n!DS/E6WCommonApps/assets/nls/E6WCommonAppsNLS"],function(e,t,n,s,i){"use strict";var o=i.get.bind(i);return n.extend({i18n:o,buildBatchWithPreprocessedObjects:function(){var t=this._parent.apply(this,arguments);return(this.localRelatedData.toConstraints||this.localRelatedData.fromConstraints)&&(t=t||e.getBatchGenerator(),this._processAddedConstraints(t),this._processRemovedConstraints(t)),delete this.localRelatedData.toConstraints,delete this.localRelatedData.fromConstraints,t},_processAddedConstraints:function(e){var n=this,s=function(e){return"add"===e.operation},i=function(s,i){s.updateBackpointers({silent:!0}),s.updateParentWorkscopes(),s.save(void 0,{ajax:e.ajax,onComplete:function(){t.displaySuccess(n.i18n("E6WCommonApps.Label.SuccessfulSave"))},onFailure:function(e,t){n._onConstraintFailure(i,t.message,s),s.destroy({noServer:!0})}})};this.localRelatedData.toConstraints&&this.localRelatedData.toConstraints.filter(s).forEach(function(e){i(e.value,"toConstraints")}),this.localRelatedData.fromConstraints&&this.localRelatedData.fromConstraints.filter(s).forEach(function(e){i(e.value,"fromConstraints")})},_processRemovedConstraints:function(e){var n=this;this.localRelatedData.toConstraints&&this.localRelatedData.toConstraints.forEach(function(s){"remove"===s.operation&&n.model.removeObject("toConstraints",s.value,{silentOnChange:!0,ajax:e.ajax,onComplete:function(){t.displaySuccess(n.i18n("E6WCommonApps.Label.SuccessfulSave"))},onFailure:n._onConstraintFailure.bind(n,"toConstraints","E6WCommonApps.Error.ConstraintNotRemoved")})}),this.localRelatedData.fromConstraints&&this.localRelatedData.fromConstraints.forEach(function(t){"remove"===t.operation&&n.model.removeObject("fromConstraints",t.value,{silentOnChange:!0,ajax:e.ajax,onFailure:n._onConstraintFailure.bind(n,"fromConstraints","E6WCommonApps.Error.ConstraintNotRemoved")})})},_onConstraintFailure:function(e,n,s){var o,a=("toConstraints"===e?s.getPredecessor():s.getSuccessor()).get("dsxplan:label");"E6WCommonApps.Error.ConstraintNotCreated"!==n&&"E6WCommonApps.Error.ConstraintNotRemoved"!==n||(o=i.replace(i.get(n),{OBJECT_NAME:a}),t.displayError(o)),this._fireRelationshipChangeEvents(e,{})}})}),define("DS/E6WCommonApps/E6WNonWorkingDayIterator",["UWA/Core","UWA/Class","DS/E6WCommonApps/Constants","text!DS/E6WCommonApps/assets/CalendarData.json"],function(e,t,n,s){"use strict";return t.extend({init:function(){this._recurringNonWorkingDays=[],this._staticHolidayDates=[],this._staticHolidayTitles=[],this._variableHolidayEvents=[],this._variableHolidayDates=[],this._parseCalendarData()},_isHoliday:function(e){var t=String(e.getDate()),s=String(e.getMonth());if(-1!==this._staticHolidayDates.indexOf(t.concat("-").concat(s)))return!0;return-1!==this._variableHolidayDates.indexOf(s.concat("-").concat(["First","Second","Third","Fourth","Last"][Math.ceil(t/7)-1]).concat("-").concat(n.DAY_LONG_NAMES[e.getDay()]))},_isNWD:function(e){return-1!==this._recurringNonWorkingDays.indexOf(e.getDay())},countWorkingDays:function(e,t){var n=new Date(e.getTime());let s=0;for(;n.getTime()<=t.getTime();){var i=new Date(n);i.setDate(n.getDate()+1),this._isHoliday(n)||this._isNWD(n)||s++,n=i}return s},_parseCalendarData:function(){var e,t=this;JSON.parse(s).data[0].relateddata.events.forEach(function(s){var i=s.relelements["Event Type"],o=s.relelements["Calendar Exception Type"];if("Work Week"===i&&"Non Working"===o)e=s.relelements.Title,t._recurringNonWorkingDays.push(e-1);else if("Exception"===i&&"Non Working"===o){var a=s.relelements["Day Of Month"];if(e=s.relelements.Title,"0"!==a){var r=s.relelements["Month Of Year"],l=n.MONTH_LONG_NAMES.indexOf(r);t._staticHolidayDates.push(a.concat("-").concat(l)),t._staticHolidayTitles.push(e)}else t._variableHolidayEvents.push(s),t._variableHolidayDates.push(String(n.MONTH_LONG_NAMES.indexOf(s.relelements["Month Of Year"])).concat("-").concat(s.relelements["Week Of Month"]).concat("-").concat(s.relelements["Day Of Week"]))}})}})}),define("DS/E6WCommonApps/Views/E6WStartStopView",["UWA/Core","DS/E6WCommonApps/Models/E6WCommonAppsConstants","DS/E6WCommonUI/Views/StartStopView"],function(e,t,n){"use strict";return n.extend({setup:function(){this._parent.apply(this,arguments),this.model&&(this.listenTo(this.model,"onChange:"+t.ACTUAL_START_DATE,this.render),this.listenTo(this.model,"onChange:"+t.ACTUAL_END_DATE,this.render))},render:function(){return this._parent.apply(this,arguments),this}})}),define("DS/E6WCommonApps/Views/PriorityView",["UWA/Core","DS/Handlebars/Handlebars4","DS/UIKIT/Input/Button","DS/UIKIT/Input/ButtonGroup","DS/E6WCommonUI/Views/FoundationBaseView","DS/E6WCommonUI/Views/DetailsDisplaySharedView","DS/DocumentManagement/DocumentManagement","text!DS/E6WCommonApps/assets/templates/popover.html.handlebars","DS/E6WCommonApps/Models/E6WCommonAppsConstants","i18n!DS/E6WCommonApps/assets/nls/E6WCommonAppsNLS"],function(e,t,n,s,i,o,a,r,l,d){"use strict";var c=function(e){return d.get(e)};return o.extend({_uwaClassName:"PriorityView",id:function(){return"PriorityView_"+this.cid},setup:function(){this._parent.apply(this,arguments),this.titleElement=this.createPriorityButtonGroupTitle(),this.priorityButtonGroup=this.createPriorityButtonGroup()},render:function(){this.container.empty();let e=this._config.readWrite;e||(e=!1);let t=!this.normalizedGet(this.model,"canEdit")||!e;return this.priorityButtonGroup.setDisabled(t),this.titleElement.inject(this.container),this.priorityButtonGroup.inject(this.container),this},createPriorityButtonGroup:function(){var e=this.model.get(l.PRIORITY_ATTR);e=e&&e.id;var t=new s({type:"radio",buttons:[new n({name:l.PRIORITY_LOW,className:"success large",icon:"low",attributes:{title:c("E6WCommonApps.Label.Low")},active:e===l.PRIORITY_LOW}),new n({name:l.PRIORITY_MEDIUM,className:"info large",icon:"medium",attributes:{title:c("E6WCommonApps.Label.Medium")},active:e===l.PRIORITY_MEDIUM}),new n({name:l.PRIORITY_HIGH,className:"warning large",icon:"high",attributes:{title:c("E6WCommonApps.Label.High")},active:e===l.PRIORITY_HIGH}),new n({name:l.PRIORITY_URGENT,className:"error large",icon:"alert",attributes:{title:c("E6WCommonApps.Label.Urgent")},active:e===l.PRIORITY_URGENT})],events:{onClick:this.onClickButton.bind(this)}});return t.setClassName("item-priority"),t},createPriorityButtonGroupTitle:function(){return e.createElement("label",{text:c("E6WCommonApps.Label.Priority")})},destroy:function(){this.priorityButtonGroup.destroy(),this._parent.apply(this,arguments)},onClickButton:function(e,t){this.model.set(this._config.name,t.options.name)}})}),define("DS/E6WCommonApps/Collections/RDFLeafTasksCollection",["UWA/Core","DS/E6WCommonApps/Collections/RDFTasksCollection","DS/E6WCommonApps/Models/E6WCommonAppsConstants","DS/E6WCommonUI/UIHelper","DS/E6WCommonApps/SmartSchedulerUtils"],function(e,t,n,s,i){"use strict";return t.extend({_uwaClassName:"RDFLeafTasksCollection",setup:function(t,n){var s=e.clone(n||{},!1);s["@mask"]="dsplan:MVMask.Task.CollaborativeTask.Basic",s.detailsMask="dsplan:MVMask.Task.Complex",s["@href"]="invoke/dsxplan:getFirstLevelLeafTasks",this.ownerFilter=s.ownerFilter,this.trackNextFetch=s.trackNextFetch,this._parent(t,s)},_trackFetch:function(e){var t=Date.now()-e;s.trackPageEvent({eventCategory:"taskView",eventAction:"Open",eventLabel:"loadTasks",eventValue:t,persDim:{pd2:this.ownerFilter},persVal:{pv4:t}})},fetch:function(t){var s=this,o=e.clone(t||{},!1),a=i.getCompletedTaskFilter(),r=[{versionURI:this.parentModel.id,filter:this.ownerFilter,fromCompletionDate:a}],l=Date.now();return o.data=JSON.stringify(r),this.reset(),o.onComplete=function(){function e(e,t){!t&&e&&s.remove(e)}s.forEach(t=>{t.set(n.PARENT_ATTR,s.parentModel,{dontRegisterChange:!0}),s.listenTo(t,"onChange:"+n.TASK_PARENT_ATTR,e),s.listenTo(t,"onChange:"+n.PARENT_ATTR,e)}),s.cacheCollection(),s.dispatchEvent("onTaskCollectionFetchComplete"),t&&t.onComplete&&t.onComplete.apply(s,arguments),s.trackNextFetch&&(s._trackFetch(l),delete s.trackNextFetch)},this._parent(o)}})}),define("DS/E6WCommonApps/Models/ModificationModel",["UWA/Core","UWA/Class/Model","UWA/Class/Collection","DS/RDFFoundation/Models/ResultModel","DS/RDFFoundation/RDFUtils","DS/RDFFoundation/Models/PersonRDFModel","DS/E6WCommonApps/Models/E6WCommonAppsConstants","i18n!DS/E6WCommonApps/assets/nls/E6WCommonAppsNLS"],function(e,t,n,s,i,o,a,r){"use strict";var l=r.get.bind(r),d="dsplan:modificationType",c={};c.created=l("E6WCommonApps.Modification.ElementAdded"),c.commentAdded=l("E6WCommonApps.Modification.CommentAdded"),c.contentAdded=l("E6WCommonApps.Modification.ContentAdded"),c.contentRemoved=l("E6WCommonApps.Modification.ContentRemoved"),c.memberAdded=l("E6WCommonApps.Modification.MemberAdded"),c.memberRemoved=l("E6WCommonApps.Modification.MemberRemoved"),c.elementRemoved=l("E6WCommonApps.Modification.ElementRemoved"),c.projectCreated=l("E6WCommonApps.Modification.ProjectAdded"),c.projectChanged=l("E6WCommonApps.Modification.ProjectChanged"),c.completed=l("E6WCommonApps.Modification.ElementCompleted"),c.reopened=l("E6WCommonApps.Modification.ElementReopened"),c.taskDuplicated=l("E6WCommonApps.Modification.TaskDuplicated"),c.taskSplit=l("E6WCommonApps.Modification.TaskSplit");var p=new t({title:""});p.getObjectType=function(){return"Object"};var u=["contentAdded","contentRemoved","memberAdded","memberRemoved"],h=s.extend({_uwaClassName:"ModificationModel",_relations:[{key:"modifications",relatedCollection:n}],buildText:function(){var e=this.get(d),t=c[e];return r.replace(t,this._getNlsValuesToReplace())},_getNlsValuesToReplace:function(){var e=this.getModifiedObject(),t=this.getRelatedObject(),n=function(e){return"<strong>"+(e?e.htmlEncode():e)+"</strong>"},s={USER:n(this.getModifier().fullName)};switch(this.get(d)){case"created":case"completed":case"commentAdded":case"reopened":case"taskDuplicated":case"taskSplit":s.TYPE=l("E6WCommonApps.Type."+e.getObjectType()),s.TITLE=n(e.get("title"));break;case"contentAdded":case"contentRemoved":s.TYPE=l("E6WCommonApps.Type."+e.getObjectType()),s.TITLE=n(e.get("title")),s.CONTENT=n(t.get("title"));break;case"memberAdded":case"memberRemoved":s.MEMBER=n(t.fullName);break;case"projectCreated":s.TITLE=n(e.get("title"));break;case"projectChanged":s.TITLE=n(e.get("title")),s.NEW_PROJECT_TYPE=l(e.getProjectTypeNLS()),s.ORIGINAL_PROJECT_TYPE=l("E6WCommonApps.Type.TeamProject")}return s},get:function(e){switch(e){case"image":return this.getImage();case"text":return this.buildText();case"timeStamp":return this.getDate().strftime("%H:%M");default:return this._parent.apply(this,arguments)}},getProject:function(){return this.get("dsplan:forProject")},getModifiedObject:function(){var e=this.get("dsplan:modifies");return e&&e.getObjectType()?e:p},getModifier:function(){return this.get("dsplan:performedBy")},getDate:function(){return new Date(this.get("dspol:creationDate"))},getRelatedObject:function(){return this.get("dsplan:relatedObject")},getImage:function(){var e=this.getModifier()&&this.getModifier().get("image");if(-1!==u.indexOf(this.get(d))){var t=this.getRelatedObject();e=t&&t.get("image")}return e}});return h.TYPE=d,h.MODIFIES="dsplan:modifies",h.MODIFICATIONS="modifications",h.FOR_PROJECT="dsplan:forProject",h.PERFORMED_BY="dsplan:performedBy",h.RELATED_OBJECT="dsplan:relatedObject",h.TYPE_CREATED="created",h.TYPE_COMMENT="commentAdded",h.TYPE_CONTENT_ADDED="contentAdded",h.TYPE_CONTENT_REMOVED="contentRemoved",h.TYPE_MEMBER_ADDED="memberAdded",h.TYPE_MEMBER_REMOVED="memberRemoved",h.TYPE_COMPLETED="completed",h.TYPE_ELEMENT_REMOVED="elementRemoved",h.TYPE_PROJECT_CREATED="projectCreated",h.TYPE_PROJECT_CHANGED="projectChanged",h.TYPE_HIDDEN="hidden",h.TYPE_REOPENED="reopened",h.TYPE_TASK_DUPLICATED="taskDuplicated",h.TYPE_TASK_SPLIT="taskSplit",h}),define("DS/E6WCommonApps/Models/GroupedModificationModel",["UWA/Core","DS/RDFFoundation/RDFUtils","DS/RDFFoundation/RequestUtils","DS/RDFFoundation/Collections/ResultCollection","DS/E6WCommonApps/Models/ModificationModel","i18n!DS/E6WCommonApps/assets/nls/E6WCommonAppsNLS"],function(e,t,n,s,i,o){"use strict";var a=i.MODIFICATIONS,r=i.TYPE,l={};l[i.TYPE_CREATED]="E6WCommonApps.Modification.ElementsAdded",l[i.TYPE_COMMENT]="E6WCommonApps.Modification.CommentsAdded",l[i.TYPE_CONTENT_ADDED]="E6WCommonApps.Modification.ContentsAdded",l[i.TYPE_CONTENT_REMOVED]="E6WCommonApps.Modification.ContentsRemoved",l[i.TYPE_MEMBER_ADDED]="E6WCommonApps.Modification.MembersAdded",l[i.TYPE_COMPLETED]="E6WCommonApps.Modification.ElementsCompletedOrReopened",l[i.TYPE_REOPENED]="E6WCommonApps.Modification.ElementsCompletedOrReopened",l[i.TYPE_MEMBER_REMOVED]="E6WCommonApps.Modification.MembersRemoved",l[i.TYPE_ELEMENT_REMOVED]="E6WCommonApps.Modification.ElementsRemoved",l[i.TYPE_PROJECT_CREATED]="E6WCommonApps.Modification.ProjectsAdded",l[i.TYPE_PROJECT_CHANGED]="E6WCommonApps.Modification.ProjectsChanged",l[i.TYPE_TASK_DUPLICATED]="E6WCommonApps.Modification.TaskDuplicatedOrSplit",l[i.TYPE_TASK_SPLIT]="E6WCommonApps.Modification.TaskDuplicatedOrSplit";var d=s.extend({_uwaClassName:"GroupedModifcationCollection",init:function(t,n){var s=e.clone(n||{},!1);s.defaultModel=i,this._parent(t,s),this._groupId=n.groupId},fetch:function(t){var n=e.clone(t||{},!1);return n.data=JSON.stringify([this._groupId]),n.method="POST",this._parent(n)},update:function(){var e=this.remove;this.remove=Function.prototype,this._parent.apply(this,arguments),this.remove=e},url:function(){var e=t.expandUrl("/invoke/dsxplan:expandModification","v1");return n.addQueryParams(e,[{name:"$mask",value:"dsplan:Modification.Basic"}])}}),c=i.extend({_uwaClassName:"GroupedModificationModel",_relations:[{key:a,relatedCollection:d}],setup:function(){this._parent.apply(this,arguments),this._createCollection(a,void 0,{groupId:this.get("dsplan:groupId")}),this.listenTo(this.getProject(),"onDestroy",function(){this.destroy({noServer:!0})})},buildGroupedText:function(){var e=l[this.get(r)]||this.get(r),t=".UnknownAmount",n="";return this.get("dsplan:groupedModificationsCount")&&(t=1===(n=this.get("dsplan:groupedModificationsCount").getTotalRecords())?".Singular":".Plural"),0!==this.get(a).length&&(t=1===(n=this.get(a).length)?".Singular":".Plural"),e+=t,o.replace(o.get(e),{COUNT:n})+" "},buildText:function(){var e="";return this.hasDataForMask("dsplan:Modification.Basic")&&(e=this._parent()),e},get:function(e){switch(e){case"projectImage":return this.getProject().get("image");case"groupedText":return this.buildGroupedText();case"project":return this.getProject().get("title");case"modified":return new Date(this.get("dspol:modificationDate")).strftime("%H:%M");default:return this._parent.apply(this,arguments)}},fetchRelatedModificationsIfNeeded:function(){var e=this.get(a);0===e.length&&e.fetch()}});return c.MODIFICATIONS=a,c.MODIFICATION_COUNT_COLLECTION="dsplan:groupedModificationsCount",c}),define("DS/E6WCommonApps/Views/FixedStartStopView",["UWA/Core","DS/Controls/Toggle","DS/E6WCommonApps/Models/E6WCommonAppsConstants","DS/E6WCommonUI/Views/StartStopView","DS/E6WCommonUI/UIHelper","DS/Handlebars/Handlebars4","i18n!DS/E6WCommonApps/assets/nls/E6WCommonAppsNLS","text!DS/E6WCommonApps/assets/templates/fixedstartstop.html.handlebars"],function(e,t,n,s,i,o,a,r){"use strict";var l=o.compile(r);return s.extend({setup:function(){this._parent.apply(this,arguments),this.model&&(this.listenTo(this.model,"onValidationSuccess",function(){for(var e=this.container.getElements(".has-error"),t=0;t<e.length;t++)e[t].toggleClassName("has-error",!1)}),this.listenTo(this.model,"onChange:"+this._config.isEndDateManualAttribute,this.render),this.listenTo(this.model,"onChange:"+this._config.isStartDateManualAttribute,this.render))},domEvents:{'change input.data-entry[type="checkbox"]':"_toggleDataEntry"},setFixed:function(t,s){var i=e.clone(this._config,!1),o=s?n.USER_DEFINED_START_DATE_ATTR:n.USER_DEFINED_END_DATE_ATTR;i.name=o,this.normalizedSet(this.model,i,t)},render:function(){this._parent.apply(this,arguments);let e=this._config.readWrite;e||(e=!1);let t=this.normalizedGet(this.model,"canEdit")&&e;if(this.moveLabelPosition("top"),!0===this._config.showFixedPin){var s=this.model.get(n.STARTDATE_ATTR),i=this.model.get(n.ENDDATE_ATTR),o=this.container.getElement(".start label"),r=this.container.getElement(".stop label");this._togglePinVisibility(o,s),this._togglePinVisibility(r,i)}else{var d=!t||this.model.isStarted();d||this.container.getElement(".start").addContent(l({id:"start"+(new Date).getTime(),label:a.get("E6WCommonApps.Label.Fixed"),checked:!0===this.model.isStartDateFixed(),disabled:d}));var c=!t||this.model.isComplete();c||this.container.getElement(".stop").addContent(l({id:"stop"+(new Date).getTime(),label:a.get("E6WCommonApps.Label.Fixed"),checked:!0===this.model.isEndDateFixed(),disabled:c}))}return this},_togglePinVisibility:function(t,n){t.addClassName("fixed-date"),e.createElement("span",{class:"fonticon fonticon-pin hidden"}).inject(t);var s=t.getElement(".fonticon-pin");n=n&&n.actualValue||n,s&&s.toggleClassName("hidden",!i.isValidDate(n))},_toggleDataEntry:function(t){var n=e.Event.getElement(t);this.setFixed(n.checked,n.id.startsWith("start"))}})}),define("DS/E6WCommonApps/Models/ConstraintCloneModel",["UWA/Core","DS/E6WCommonUI/Models/CloneModel","DS/E6WCommonApps/Models/ConstraintModel","DS/RDFFoundation/RDFUtils","DS/E6WCommonApps/Models/E6WCommonAppsConstants"],function(e,t,n,s,i){"use strict";var o=t.extend({init:function(){this._parent.apply(this,arguments)},dataForRendering:function(){var e=this._parent();e[n.TYPE_ATTR]=this.get(n.TYPE_ATTR);var t=this.get(n.PREDECESSOR_ATTR);e[n.PREDECESSOR_ATTR]=t&&{title:t.get(i.TITLE_ATTR)};var s=this.get(n.SUCCESSOR_ATTR);return e[n.SUCCESSOR_ATTR]=s&&{title:s.get(i.TITLE_ATTR)},e[n.LAG_ATTR]=this.get(n.LAG_ATTR),e[n.ENFORCE_ATTR]=this.getIsEnforcedValue()?"FALSE":"TRUE",e},getIsEnforcedValue:function(){var e=this.get(n.ENFORCE_ATTR);return void 0===e||e},get:function(e){var t=this._parent.apply(this,arguments);return e===n.PREDECESSOR_ATTR||e===n.SUCCESSOR_ATTR?t:(e===n.LAG_ATTR&&(t=void 0!==t?s.xsdDayTimeDurationToMilliseconds(t)/(60*this.getWorkDayLength()*60*1e3):0),t)},set:function(e,t){var s=t;e===n.LAG_ATTR?s=this.getDurationString(t):e===n.TYPE_ATTR?s=t.actualValue?t.actualValue:s:e===n.ENFORCE_ATTR&&(s="FALSE"===t);var i=this._parent(e,s,{whisper:!0});return e!==n.TYPE_ATTR&&e!==n.ENFORCE_ATTR||this.dispatchEvent("onChange:"+e),i},getWorkDayLength:function(){return this.model.getWorkDayLength()},getDurationString:function(e){var t=this.model.getWorkDayLength();return s.millisecondsToXsdDayTimeDuration(e*(60*t*60*1e3))}});return n.prototype.getClone=function(e,t){return new o(e,t)},o}),define("DS/E6WCommonApps/Collections/PaginatedTasksCollection",["UWA/Core","UWA/Class","UWA/Class/Events","UWA/Class/Listener","DS/RDFFoundation/RDFUtils","DS/RDFFoundation/RequestUtils","DS/E6WCommonApps/XTaskScope","DS/E6WCommonApps/Models/RDFTaskModel","DS/E6WCommonApps/Models/TaskModelMixin","DS/E6WCommonApps/Models/E6WCommonAppsConstants","DS/E6WCommonApps/Collections/RDFTasksCollection","DS/E6WCommonUI/UIHelper","DS/E6WCommonUI/PlatformManager"],function(e,t,n,s,i,o,a,r,l,d,c,p,u){"use strict";var h=["dsplan:estimatedEndDate","dsplan:hasPriority","dscom:hasMaturity","dsplan:actualEndDate"],m=["dsplan:estimatedEndDate","dsplan:sequenceOrder"],T={stateForDisplay:"dscom:hasMaturity",priority:"dsplan:hasPriority"};T[d.DUE_DATE_CATEGORY]=d.DUE_DATE_CATEGORY;var g={"To Do":"dsxplan:Open","In Progress":"dsxplan:InProgress",Done:"dsxplan:Done",Low:"dsxplan:Low",Medium:"dsxplan:Medium",High:"dsxplan:High",Urgent:"dsxplan:Urgent"},E={id:"blankModel",isBlank:!0,isNew:function(){return!1},dataForRendering:function(){return{}},calculateAndSetUpListenersForVisualAttributesIfNeeded:Function.prototype,get:Function.prototype},A=l.dateHelper,f=new n,C=t.extend({_uwaClassName:"PaginatedTasksCollection",init:function(e,t){this._parent.apply(this,arguments),this.setup(e,t)},setup:function(e,t){this._view=t.view,this._filterAttr=T[t.view],this._filterAttrNLS=t.attrNLSValue,this.actualValueForFiltering=g[t.attrValue]?g[t.attrValue]:t.attrValue,this._valueForFiltering=t.attrValue,this._filterValue=t.attrValue,this.initialLoad=!0,this.parentModel=t.parentModel,this._models=[],this.loadedRanges=[],this.fetching=null,this.nextFetching=null},url:function(){var e=i.expandUrl("/invoke/dsxplan:getProjectTasks");return e=e.replace("3DPLAN","3drdfindex")},fetch:function(t){if(!this.hasContextUserBeenSet())return C._isSettingUserContext||C.loginToRDFIndexVM(),void this.listenTo(f,"onLogin",function(){this.fetch(t)});var n=e.clone(t||{},!1);n.limit=n.limit||C.LIMIT,n.offset=e.is(n.offset)?n.offset:0,this.fetching&&this.fetching.offset===n.offset&&this.fetching.limit===n.limit||(this.fetching?this.nextFetching=n:(this.fetching=n,i.request(this.url(),this.buildFetchOptions(n))))},buildFetchOptions:function(e){var t={id:this.parentModel.id,limit:e.limit,includeCount:e.includeCount,attrs:h,offset:e.offset,sortKeys:m,filterAttrs:[],jsType:e.jsType};this._view===d.DUE_DATE_CATEGORY?t.filterAttrs=t.filterAttrs.concat(this.getDateFilters(this.actualValueForFiltering)):t.filterAttrs.push({name:this._filterAttr,value:this.actualValueForFiltering,comparator:"="}),"priority"!==this._view&&this._view!==d.DUE_DATE_CATEGORY||t.filterAttrs.push({name:"dscom:hasMaturity",value:"dsxplan:Done",comparator:"!="}),this._addOwnerAndAssigneeFilterIfNeeded(t.filterAttrs),this._addJSType(t);var n={method:"POST",type:"json",at:e.offset,data:JSON.stringify(t),fromServer:!0,onComplete:e.onComplete,headers:{"Content-Type":"application/json"}};if(!e.noSet){var s=this;n.onComplete=function(t){s.set(t.items.member,{at:e.offset,totalItems:t.totalItems}),e.onComplete&&e.onComplete()}}return n},_addOwnerAndAssigneeFilterIfNeeded:function(e){var t=a.getFilter();t===a.FILTER_ASSIGNED?e.push({name:"dsplan:hasAssignee",value:u.getContextUserUid(),comparator:"="}):t===a.FILTER_OWNED&&e.push({name:"dskern:owner",value:u.getContextUserUid(),comparator:"="})},_addJSType:function(e){if(e.jsType){for(var t=JSON.parse(e.jsType),n=0;n<t.length;n++)e.filterAttrs.push({name:"dsplan:jsType",value:' "'+t[n]+'" ',comparator:"="});delete e.jsType}},indexOf:function(e){return this._models.indexOf(e)},add:function(e,t){var n,s;if(s=t&&void 0!==t.position?{position:t.position,blank:!1}:this.findInsertable(e),this.loadedRanges.length>0&&(this.loadedRanges.forEach(function(e){e.start=s.position<=e.start?e.start+1:e.start,e.end=s.position<=e.end?e.end+1:e.end}),n=s.position),n&&0!==n||(n=0,this.updateLoadedRanges({start:0,end:1})),e=s.blank?E:e,this._models.splice(n,0,e),t&&t.replace){var i=this.indexOf(E);-1!==i&&this._models.splice(i,1)}return this.dispatchEvent(C.Events.SizeEvent,[this._models.length]),this.dispatchEvent("onAdd",e),this._listenToModel(e),n},_listenToModel:function(e){function t(e,t){!t&&e&&this.remove(e)}this.listenTo(e,"onAnyEvent",function(e,t,n,s){this.dispatchEvent(e,[t,n,s])}),this.listenTo(e,"onChange:"+d.TASK_PARENT_ATTR,t),this.listenTo(e,"onChange:"+d.PARENT_ATTR,t),this.listenTo(e,"onDestroy",this.remove)},comparator:function(e,t){var n=Date.parse(e.getEndDate()),s=Date.parse(t.getEndDate());return this.actualValueForFiltering===d.STATE_DONE?s-n:n!==s?n-s:e.get(d.SEQUENCE_ORDER_ATTR)-t.get(d.SEQUENCE_ORDER_ATTR)},findInsertable:function(e){var t={position:-1,blank:!0};if(e.isNew())t.position=0,t.blank=!1;else if(this.loadedRanges.length>0)e:for(var n=0;n<this.loadedRanges.length;n++){var s=this.loadedRanges[n],i=this.comparator(e,this.at(s.start))<=0;if(!i&&this.comparator(e,this.at(s.end-1))<=0){t.blank=!1;for(var o=s.start;o<s.end;o++){if(!(this.comparator(e,this.at(o))<=0)){t.position++;break e}t.position=o}}else if(i&&-1===t.position){0===s.start?(t.blank=!1,t.position=0):t.position=s.start-1;break e}}return-1===t.position&&(t.blank=!1,t.position=this._models.length),t},at:function(e){return this._models[e]},getSelection:function(e,t){return this._models.slice(e,t)},contains:function(e){return this._models.includes(e)},reset:function(){var e=this;this._models.forEach(t=>{e.stopListening(t)}),this._models=[],this.loadedRanges=[],this.dispatchEvent(C.Events.SizeEvent,[0])},remove:function(e){var t=this.indexOf(e),n=-1;return this.loadedRanges.forEach(function(e,s){e.start=t<=e.start&&0!==e.start?e.start-1:e.start,e.end=t<=e.end?e.end-1:e.end,e.start===e.end&&(n=s)}),-1!==n&&this.loadedRanges.splice(n,1),-1!==t&&this._models.splice(t,1),this.stopListening(e),this.dispatchEvent(C.Events.SizeEvent,[this._models.length]),this.dispatchEvent("onRemove",[e,this,{index:t}]),e},get:function(){},size:function(){return this._models.length},set:function(e,t){t.totalItems&&0===this._models.length&&(this._models=Array.apply(null,Array(t.totalItems)).map(function(){return E}));for(var n=e.length,s=0;s<n;s++){var o=s+t.at,a=e[s],l=i.getExistingAndMerge(a);l||(l=new r(a,{parse:!0,mask:"dsplan:MVMask.Task.Basic"})),this._models[o]=l,this._listenToModel(l)}this.updateLoadedRanges({start:t.at,end:t.at+n}),this.dispatchEvent(C.Events.ModelsAdded,[t.at,n]),this.fetching=null,this.nextFetching&&(this.fetch(this.nextFetching),this.nextFetching=null)},updateLoadedRanges:function(e){if(e.start!==e.end){var t,n,s=this.loadedRanges.length;for(t=0;t<this.loadedRanges.length;t++)if(n=this.loadedRanges[t],e.start<n.start){s=t;break}this.loadedRanges.splice(s,0,e);for(var i=[],o=1;o<this.loadedRanges.length;){var a=this.loadedRanges[o-1];for(t=o++;t<this.loadedRanges.length;t++){n=this.loadedRanges[t];var r=a.start<=n.start&&a.end>=n.start,l=a.start<=n.end&&a.end>=n.end;r&&l?i.push(n):r?(a.end=n.end,i.push(n)):l&&(e.start=n.start,i.push(n))}this.loadedRanges=this.loadedRanges.filter(function(e){return!i.includes(e)})}}},getMissingDataInRange:function(e,t,n){var s,i;void 0===n&&(n=!1),n?(s=e-t,i=e):(s=e,i=e+t),s=s>0?s:0,i=i<this._models.length?i:this._models.length;for(var o,a,r={},l=0;l<this.loadedRanges.length;l++){var d=this.loadedRanges[l],c=d.start<=s&&d.end>=s,p=d.start<=i&&d.end>=i,u=d.end>i;if(c&&p){r=null;break}if(c){o=d.end;break}if(p){a=d.start;break}if(u)break}return o?r.start=o:a&&(r.end=a),r},dataForRendering:function(){var e={},t={actualValue:this.actualValueForFiltering,displayValue:this._filterAttrNLS};return e.state=t,e.collabSpace=this.collabSpace,e.extid=this.extid,e.filteredByAttr=this._filterAttr,e.filteredByValue={actualValue:this._valueForFiltering,displayValue:this._filterAttrNLS},e.filteredCount=this.size(),e},getSaveAttributes:function(){var e,t={},n=(e=this._filterValue)&&e.actualValue||e;return t[this._view]=n,t},getMask:function(){return"dsplan:MVMask.Task.CollaborativeTasks.Complex"},getDateFilters:function(e){var t,n=[];switch(e){case"PAST_DUE":t={name:"dsplan:estimatedEndDate",value:p.getIntlDateFormat(A.getPast()).actualValue,comparator:"<"},n.push(t);break;case"DUE_TODAY":this.addBetweenDates(n,A.getPast(),A.getToday());break;case"DUE_TOMORROW":this.addBetweenDates(n,A.getToday(),A.getTomorrow());break;case"DUE_THIS_WEEK":this.addBetweenDates(n,A.getTomorrow(),A.getLastDayofThisWeek());break;case"DUE_FUTURE":t={name:"dsplan:estimatedEndDate",value:p.getIntlDateFormat(A.getLastDayofThisWeek()).actualValue,comparator:">"},n.push(t)}return n},addBetweenDates:function(e,t,n){var s={name:"dsplan:estimatedEndDate",value:p.getIntlDateFormat(t).actualValue,comparator:">"},i={name:"dsplan:estimatedEndDate",value:p.getIntlDateFormat(n).actualValue,comparator:"<"};e.push(s),e.push(i)},destroy:function(){this.stopListening()},hasContextUserBeenSet:function(){return C._hasContextUserBeenSet}});return C.loginToRDFIndexVM=function(){C._isSettingUserContext=!0,i.request(i.expandUrl("classes/dsplan:Task?$top=0","v1",{rdfIndex:!0}),{timeout:6e4,ignoreDictionary:!0,method:"GET",data:{},onComplete:function(){C._isSettingUserContext=void 0,C.setContextUserSet(!0),f.dispatchEvent("onLogin")},onFailure:function(){C._isSettingUserContext=void 0,C.setContextUserSet(!0),f.dispatchEvent("onLogin")},onTimeout:function(){C.loginToRDFIndexVM()}})},C.setContextUserSet=function(e){C._hasContextUserBeenSet=e},Object.defineProperty(C.prototype,"length",{get:function(){return this._models.length}}),C.implement(n,s),C.Events={SizeEvent:"sizeEvent",ModelsAdded:"modelsAdded"},C.ATTRIBUTE_MAP=T,C.LIMIT=300,C.INITIAL=30,C.TASK_ATTRS=h,C.BLANK_MODEL=E,C.SORT_KEYS=m,C.loginListener=f,C}),define("DS/E6WCommonApps/Collections/FTSTaskPseudoCollection",["DS/RDFFoundation/RDFUtils","DS/E6WCommonUI/ApolloUtils","DS/RDFFoundation/Models/PersonRDFModel","DS/E6WCommonApps/XTaskScope","DS/E6WCommonApps/Models/TaskModelMixin","DS/E6WCommonApps/Models/E6WCommonAppsConstants","DS/E6WCommonApps/Collections/PaginatedTasksCollection","DS/E6WCommonApps/SmartSchedulerUtils","DS/E6WCommonUI/TopBarSearchDispatcher","DS/E6WCommonUI/PlatformManager"],function(e,t,n,s,i,o,a,r,l,d){"use strict";var c={};c[o.STATE_FOR_DISPLAY_ATTR]="custom_ProjectTasksByMaturity",c[o.PRIORITY_DISPLAY]="custom_ProjectTasksByPriority",c[o.DUE_DATE_CATEGORY]="custom_ProjectTasksByDate",c[o.TASK_TABLE]="custom_ProjectTaskIds";var p={};p[o.STATE_FOR_DISPLAY_ATTR]="state",p[o.PRIORITY_DISPLAY]="priority";var u=i.dateHelper,h=a.extend({_uwaClassName:"FTSTaskPseudoCollection",url:function(){return t.getServiceUrl()},buildFetchOptions:function(t){var n=[{key:"parentID",value:JSON.stringify(e.shortToLongURI(this.parentModel.id))},{key:"limit",value:JSON.stringify(t.limit)},{key:"offset",value:JSON.stringify(t.offset)},{key:"includeCount",value:JSON.stringify(Boolean(t.includeCount))},{key:"lang",value:JSON.stringify(d.getCurrentLanguage())},{key:"tenant",value:JSON.stringify(d.getTenant().toLowerCase())}];t.tagFilters&&(n=n.concat(t.tagFilters)),this._view===o.DUE_DATE_CATEGORY?n=n.concat(this.getDateFilters()):this._view!==o.TASK_TABLE&&n.push({key:p[this._view],value:JSON.stringify(e.shortToLongURI(this.actualValueForFiltering))});var s=r.getCompletedTaskFilter();""!==s&&s!==r.COMPLETED_TASK_FILTER_ALL_DAYS&&n.push({key:"fromCompletionDate",value:JSON.stringify(s)}),h.addSearchTermAsParameter(n),h.addOwnerAndAssigneeFilterIfNeeded(n),widget.getValue(o.LEVEL_PREF)===o.FIRST_LEVEL_TASKS&&n.push({key:"firstLevelOnly",value:JSON.stringify(!0)});var i=this;return{data:JSON.stringify({data_query_name:c[this._view],parameters:n}),method:"POST",fromServer:!0,headers:{"Content-Type":"application/json"},onComplete:function(e){try{i.parse(t,e),t.onComplete&&t.onComplete()}catch(e){console.error(e),t.onFailure&&t.onFailure(),h.setWorkingCorrectly(!1)}},onFailure:t.onFailure,onTimeout:t.onTimeout}},parse:function(n,s){var i,a,r=JSON.parse(s),l=r.result.tasks.views.tasks.data,d=n.includeCount&&r.result.count.views.count.data;this._view===o.TASK_TABLE?i=l.map(t=>({"@id":e.removeBracketLongURI(t),"dsxplan:jsType":"dsplan:Task"})):l?(i=(a=t.parse(l)).models,d-=a.deletedModelsFound):i=[],this.set(i,{at:n.offset,totalItems:d})},getDateFilters:function(){var e=[];switch(this.actualValueForFiltering){case"PAST_DUE":e.push({key:"end",value:JSON.stringify(u.getPast().toISOString())});break;case"DUE_TODAY":this.addBetweenDates(e,u.getPast(),u.getToday());break;case"DUE_TOMORROW":this.addBetweenDates(e,u.getToday(),u.getTomorrow());break;case"DUE_THIS_WEEK":this.addBetweenDates(e,u.getTomorrow(),u.getLastDayofThisWeek());break;case"DUE_FUTURE":e.push({key:"start",value:JSON.stringify(u.getLastDayofThisWeek().toISOString())})}return e},addBetweenDates:function(e,t,n){var s={key:"start",value:JSON.stringify(t.toISOString())},i={key:"end",value:JSON.stringify(n.toISOString())};e.push(s),e.push(i)},hasContextUserBeenSet:function(){return!0}});return h.addOwnerAndAssigneeFilterIfNeeded=function(t){var n,i,o=s.getFilter();o===s.FILTER_ASSIGNED?(n=t.find(function(e){return"assigneeFilter"===e.key}),i=JSON.stringify([e.getCurrentUserName()]),n?n.value=i:t.push({key:"assigneeFilter",value:i})):o===s.FILTER_OWNED?(n=t.find(function(e){return"ownerFilter"===e.key}),i=JSON.stringify([e.getCurrentUserName()]),n?n.value=i:t.push({key:"ownerFilter",value:i})):o===s.FILTER_ASSIGNED_TO_GROUP&&(n=t.find(function(e){return"assignedToMyGroups"===e.key}),i=JSON.stringify(!0),n?n.value=i:t.push({key:"assignedToMyGroups",value:i}))},h.addSearchTermAsParameter=function(e){var t=l.getSearchStringConvertedToRegex();t&&e.push({key:"searchTerm",value:JSON.stringify(t)})},h._isWorkingCorrectly=!0,h.setWorkingCorrectly=function(e){h._isWorkingCorrectly=e},h.isWorkingCorrectly=function(){return Boolean(h._isWorkingCorrectly)},h}),define("DS/E6WCommonApps/FileUploadRepositoryUtil",["UWA/Core","DS/RDFFoundation/RDFUtils","DS/DocumentManagement/DriveDocumentManagement","DS/RDFFoundation/SecurityContextUtils","DS/E6WCommonUI/UIHelper","DS/RDFFoundation/Models/CollabspaceRepositoryModel","DS/RDFFoundation/Models/DriveRepositoryProxyModel","DS/E6WCommonUI/Views/ObjectCardView","DS/RDFFoundation/FederatedSearchUtil","DS/E6WCommonApps/Views/LinkLauncherUtils","DS/E6WCommonApps/Views/E6WObjectCardView","DS/E6WCommonApps/Models/E6WCommonAppsConstants","i18n!DS/E6WCommonApps/assets/nls/E6WCommonAppsNLS"],function(e,t,n,s,i,o,a,r,l,d,c,p,u){"use strict";var h=u.get.bind(u),m={fileUploadRepositoryTypeAheadCallback:function(n,s,i,o){var r=[],l=e.clone(o||{},!1);l.attribute=n.name,s.length>1&&n.searchSource&&n.searchSource.length>0?(r=m.getFiltered3DSpaceFileUploadRepository(s,l),t.typeAheadCallback(n,s,function(e,n){if(e&&e.length>0)for(var s=0;s<e.length;s++){var o=a.ID_PREFIX+e[s].value;e[s].value=o,t.getObjectForAdding(a,o),r.push(e[s])}i(r,n)},o)):i(m.getFiltered3DSpaceFileUploadRepository(s,l))},getFiltered3DSpaceFileUploadRepository:function(e,n){for(var i=new RegExp(e,"i"),a=[],r=s.getContentRepositoryValuesForDetailDisplay(n.model.model,n)(),l=0;l<r.length;l++){var d=r[l].actualValue,c=t.getObjectForAdding(o,d,{attrs:r[l]});c.get("title").match(i)&&a.push({id:c.id,label:c.get("title"),image:c.get("image"),model:c})}return a},repositoryDropHandler:function(e,n,s){if(s.objectView.validateDroppedObjects(e))return!1;var o=i.getDataTransferJSON(e);if(o&&o.data.items){var r=o.data.items[0];if("3DDrive"===r.serviceId){var l=a.ID_PREFIX+r.objectId;return o.data.items[0].objectId=l,t.getObjectForAdding(a,l),s.objectView.processDropData(o),!0}}return!1},getRepositoryFieldConfig:function(e){return{readWrite:!e&&"true",name:p.CONTENT_REPOSITORY,label:h("E6WCommonApps.Label.CollaborativeSpace"),attributeToDisplay:"title",imageAttribute:"image",searchTitle:h("E6WCommonApps.Label.SearchForUploadRepository"),type:"object",customView:c,minLengthBeforeAutocomplete:0,singleObjectOnly:!0,typeAheadCallback:m.fileUploadRepositoryTypeAheadCallback,dropHandler:m.repositoryDropHandler,placeHolder:h("E6WCommonApps.Label.ObjectPlaceHolder"),validateSameTenant:!0,linkCallback:d.launchProperties,searchSource:l.filterSearchSources(["drive"]),excludeSearchTypes:{drive:["DriveFile"]},noOpenWith:!0}},getCollaborativeSpaceForRiskConfig:function(e){return{readWrite:e.canShare(),name:p.RISK_REPOSITORY,label:h("E6WCommonApps.Label.CollaborativeSpaceForRisk"),attributeToDisplay:"title",imageAttribute:"image",type:"object",isThumbnail:!0,disableRemove:!0,customView:c,minLengthBeforeAutocomplete:0,singleObjectOnly:!0,typeAheadCallback:m.fileUploadRepositoryTypeAheadCallback,placeHolder:h("E6WCommonApps.Label.TypeAheadOnlyPlaceHolder"),validateSameTenant:!0,linkCallback:d.launchProperties,noOpenWith:!0,noAction:!0}},getBookmarkForRepositoryFieldConfig:function(e){return{readWrite:!e&&"true",name:p.BOOKMARK_FOR_FILE_REPOSITORY,attributeToDisplay:"title",imageAttribute:"image",singleObjectOnly:!0,label:h("E6WCommonApps.Label.BookmarkForRepository"),searchTitle:h("xPlan.Label.SearchForBookmark"),type:"object",customView:c,typeAheadCallback:t.typeAheadCallback,minLengthBeforeAutocomplete:2,linkCallback:d.launchProperties,placeHolder:h("E6WCommonApps.Label.ObjectPlaceHolder"),searchSourceTypes:{"3dspace":["Workspace","Workspace Vault"]},searchSource:["3dspace"]}}};return m});var ckeditor="DS/CKEditor/CKEditor";define("DS/E6WCommonApps/Views/RichTextEditorView",["DS/E6WCommonUI/Views/TextAreaView",ckeditor,"DS/E6WCommonApps/Views/RichTextEditorConfig","UWA/Core","DS/E6WCommonUI/UIHelper","UWA/Utils","DS/Handlebars/Handlebars4","text!DS/E6WCommonApps/assets/templates/richtexteditor.html.handlebars"],function(e,t,n,s,i,o,a,r){"use strict";var l=e.extend({_uwaClassName:"RichTextEditorView",className:"RTEditor-container details-display-shared-view ddv-field form-group",domEvents:{"mouseup .ck-editor":"displayContextualToolbarWRTTextSelection","keyup .ck-editor":"_onKeyup"},compiledTemplate:a.compile(r),render:function(){return this._parent.apply(this,arguments),this.setConfiguredTemplate(),this.destroyCKEditor(),this.normalizedGet(this.model,"canEdit")&&this.options.config.readWrite&&(t.disableAutoInline=!0,this.ckInstance=t.inline(this.container.getElement(".content"),n.getConfig()),this.ckInstance.config.colorButton_renderContentColors=!1,this.ckInstance.setActiveFilter(!1),this._registerEvents(),this.ckInstance.setData(this.normalizedGet(this.model,this._config.name)),this._postTreatmentTextArea(this._config)),this},_registerEvents:function(){var e=this;this.ckInstance.on("change",function(){if(e._checkIfChangeNeeded()&&(e.onCKEInputDataEvent(),o.Client.Features.touchEvents)){var t=e.getToolbarElement();if(t&&!t.isHidden()){var n=getSelection();n.toString().length>0&&n.rangeCount>0&&(n.removeAllRanges(),t.removeClassName("shown"),t.addClassName("hidden"))}}}),this.ckInstance.on("blur",function(){t.env.iOS||t.env.mobile?e.onCKEInputDataEvent():e.displayContextualToolbarWRTTextSelection()}),this.ckInstance.on("focus",function(){var t=e.getToolbarElement();t.removeClassName("shown"),t.addClassName("hidden"),e._textAreaShowMore()})},_checkIfChangeNeeded:function(){return this.ckInstance&&this.normalizedGet(this.model,this._config.name)!==this.ckInstance.getData()},getToolbarElement:function(){return this.ckInstance&&s.extendElement(document.body.getElement("."+this.ckInstance.id))},_onKeyup:function(e){var t=e.ctrlKey||e.metaKey;(16===e.keyCode||17===e.keyCode||e.shiftKey||t)&&this.displayContextualToolbarWRTTextSelection()},displayContextualToolbarWRTTextSelection:function(){var e,t,n=this.getToolbarElement();if(n){var s=getSelection();s.toString().length>0&&s.rangeCount>0?(this.positionToolbar(s),e="hidden",t="shown"):(e="shown",t="hidden"),n.removeClassName(e),n.addClassName(t)}},positionToolbar:function(e){var t;t=e.getRangeAt(0).getBoundingClientRect().top,this.getToolbarElement().setStyle("top",t-50+"px","important")},onCKEInputDataEvent:function(){null!==this.container&&(this.normalizedSet(this.model,this._config,this.ckInstance.getData()),this._postTreatmentTextArea(this._config))},_postTreatmentTextArea:function(){var e=this,t=this._parent,n=this.ckInstance;if(n)switch(n.status){case"destroyed":break;case"ready":this.container&&t.apply(this,arguments);break;default:var s=Array.prototype.slice.call(arguments,0);n.once("instanceReady",function(){e._handleEmoji(),e.container&&t.apply(e,s)})}},_handleEmoji:function(){var e=this,t=this.ckInstance&&this.ckInstance.editable();t&&t.attachListener(t,"input",function(){e.ckInstance.fire("change")})},destroy:function(){this.destroyCKEditor(),this._parent.apply(this,arguments)},destroyCKEditor:function(){var e=this.ckInstance;if(e)switch(e.status){case"destroyed":break;case"ready":e.destroy(),delete e.mode;break;default:e.once("instanceReady",function(){e.destroy()})}delete this.ckInstance},getTextValue:function(){var e=this.ckInstance&&this.ckInstance.getData();return e=e&&e.replace(/^(?=\n)$|^\s*|\s*$|\n\n+/gm,"")},getViewAllHeight:function(){return this._parent()+10},getDesiredHeight:function(){return this._parent()+10},getFocusDesiredHeight:function(){return this._parent()+10}});return t.on("dialogDefinition",function(e){var t=e.data.name,n=e.data.definition;"link"===t&&n.getContents("info").get("linkType").items.splice(1,1)}),l}),define("DS/E6WCommonApps/Views/ConstraintFieldView",["UWA/Core","DS/UIKIT/DropdownMenu","DS/RDFFoundation/RDFUtils","DS/RDFFoundation/Collections/ResultCollection","DS/RDFFoundation/Models/ResultModel","DS/E6WCommonUI/Views/ObjectCardView","DS/E6WCommonUI/Views/DetailsDisplayView","DS/E6WCommonUI/UIHelper","DS/E6WCommonApps/Models/ConstraintModel","DS/E6WCommonApps/Models/ConstraintCloneModel","DS/E6WCommonApps/Models/RDFTaskModel","DS/E6WCommonApps/Models/ScheduleElementModel","DS/E6WCommonApps/SmartSchedulerUtils","DS/E6WCommonApps/Views/LinkLauncherUtils","i18n!DS/E6WCommonApps/assets/nls/E6WCommonAppsNLS"],function(e,t,n,s,i,o,a,r,l,d,c,p,u,h,m){"use strict";var T=10,g=[{name:l.TYPE_ATTR,label:m.get("E6WCommonApps.Label.Type"),type:"select",values:[{actualValue:l.TYPE_START_TO_START,displayValue:m.get("E6WCommonApps.Label.StartToStart")},{actualValue:l.TYPE_FINISH_TO_START,displayValue:m.get("E6WCommonApps.Label.FinishToStart")},{actualValue:l.TYPE_FINISH_TO_FINISH,displayValue:m.get("E6WCommonApps.Label.FinishToFinish")}]},{name:l.LAG_ATTR,label:m.get("E6WCommonApps.Label.LeadLag"),type:"uom",uomValues:[m.get("E6WCommonApps.Label.Days"),m.get("E6WCommonApps.Label.Hours")],minimumValue:"0",conversionTable:[1,24]}],E=o.extend({_uwaClassName:"ConstraintFieldView",setup:function(){this._parent.apply(this,arguments),this._config.dropHandler=this.onDrop.bind(this)},getDataOptions:function(){var e=this._parent.apply(this,arguments);return e.level=2,e.attributes.push(l.PREDECESSOR_ATTR,l.SUCCESSOR_ATTR),e},createMenuButtons:function(e){var t=this;this.dropdownMenu&&(this.dropdownMenu.destroy(),delete this.dropdownMenu),this.createDropdownMenu({target:e.target,items:[]}),this.addOpenWith(e.model),this.getDropDownMenuItems(e.model.get("type"),e).forEach(function(e){t.dropdownMenu.addItem(e)}),this.listenToOnce(this._parentView,"onScroll",()=>{this.dropdownMenu.hide()})},getDropDownMenuItems:function(e,t){var n=this,s=t.model,o=this.getPropertiesButton(t),a=this.getRemoveItemButton(t),r=s.canModify&&!s.canModify();o.disabled=r,a.disabled=s.canDelete&&!s.canDelete();var l={text:m.get("E6WCommonApps.Label.ToggleConstraintProperties"),fonticon:"doc-text",handler:function(){n._onConstraintDropdownSelected(t.event.target.getParent("li"))},disabled:!t.model.id||r};return t.model instanceof i?[o,l,a]:[o]},_onConstraintDropdownSelected:function(e){var t=n.getObjectById(e.getAttribute("data-id"));this._selectedConstraint===t?(this._hideDetailsDisplay(),delete this._selectedConstraint):(this._setupDetailsDisplay(t),this._detailsDisplayContainer.inject(e,"after"),this._selectedConstraint=t)},_hideDetailsDisplay:function(){this._detailsDisplayContainer&&this._detailsDisplayContainer.remove()},_setupDetailsDisplay:function(t){this._detailsDisplayView||(this._detailsDisplayView=new a,this.addChildView(this._detailsDisplayView),this._detailsDisplayView.setConfig(g),this._detailsDisplayContainer=e.createElement("li",{class:"nested-properties",styles:{height:"152px","background-color":"rgb(240, 240, 240)",border:"1px solid rgb(161, 161, 161)"}}),this._detailsDisplayView.inject(this._detailsDisplayContainer)),this._detailsDisplayView.resetModel(new d(t)),this._detailsDisplayView.render()},getExistingObjs:function(){var e=[];return this.normalizedGet(this.model,"toConstraints").forEach(function(t){t.getPredecessor()&&e.push({id:t.getPredecessor().id})}),this.normalizedGet(this.model,"fromConstraints").forEach(function(t){t.getSuccessor()&&e.push({id:t.getSuccessor().id})}),e},getModelFromFullTextSearch:function(e){var t=n.getObjectById(e.id),s=this;if(!t){var i=e["ds6w:type_value"]||e["ds6w:type"];(t=new(n.getModelConstructor({"@type":i}))(n.createPlaceholder(n.removeBracketLongURI(e.id),"",i,{forceDslc:!0}))).addEventOnce("onSync",function(){s.model.dispatchEvent("onChange:"+s._config.name)}),t.fetch({mask:"dsplan:MVMask.Task.Basic"})}return t},_modelCanBeUsedAsDependency:function(e){var t;if(e instanceof p)if(e.id===this.model.model.id)t=m.replace(m.get("E6WCommonUI.Alert.CantBeConstrainedToItself"),{OBJECT_NAME:e.get("title")});else{var n=this.normalizedGet(this.model,"toConstraints").some(function(t){return t.getPredecessor()&&t.getPredecessor().id===e.id});(n=n||this.normalizedGet(this.model,"fromConstraints").some(function(t){return t.getSuccessor()&&t.getSuccessor().id===e.id}))&&(t=m.replace(m.get("E6WCommonUI.Alert.AlreadyHasConstraint"),{OBJECT_THIS:this.model.get("title"),OBJECT_THAT:e.get("title")}))}else t=m.get("E6WCommonUI.Alert.CanOnlyConstrainTasksAndMilestones");return t&&r.displayWarning(t),void 0===t},modelAdd:function(e,t,n){var s=this,i=[];n.detailedObjects.forEach(function(t){if(!t.model&&t["ds6w:type"]&&(t.model=s.getModelFromFullTextSearch(t)),s._modelCanBeUsedAsDependency(t.model)){var n=t.model,o={};o[l.TYPE_ATTR]=l.TYPE_FINISH_TO_START,o[l.PREDECESSOR_ATTR]="fromConstraints"===e?s.model.model:n,o[l.SUCCESSOR_ATTR]="fromConstraints"===e?n:s.model.model,o[l.ENFORCE_ATTR]=!0,i.push(new l(o,{mask:"dsplan:MVMask.TempConstraint.Complex",dontUpdateConstrainedScheduleElements:!0}))}}),i.length>0&&this.model.add(this._config.name,i,n)},getModelFromCard:function(){var e=this._parent.apply(this,arguments);return e instanceof l?"fromConstraints"===this._config.name?e.getSuccessor():e.getPredecessor():e},onDrop:function(e){if(this.validateDroppedObjects(e))return!0;var t=r.getDataTransferJSON(e);if(t){for(var n=[],s=0;s<t.data.items.length;s++){var i=t.data.items[s],o=i.objectType;n.push({id:i.objectId,"ds6w:type":o})}this.modelAdd(this._config.name,[],{detailedObjects:n})}return!0},getActiveModel:function(e){var t=this._parent.apply(this,arguments);t||this.normalizedGet(this.model,this._config.name).some(function(n){return n.cid===e&&(t=n),n.cid===e});return t},objectClick:function(e){var t=this.getModelFromCard(e.target);u.fetchParentTypesWithCallback(t,function(){h.launchProperties(t.id,{model:t})})}}),A=function(e){var t={};return t.value=e.id,t.label=e.get("dsxplan:label"),t.model=e,t.image=e.getIconURL(),t};return E.typeAheadCallback=function(e,t,s,i){var o=e.modelId,a=e.getVisibleModels,r=e.getModelsToFilter;(function(e,t,n,s){var i=new RegExp(e,"i"),o=this.model.model,a=function(){var a=[];if(e.length<2&&t)a=t();else{var r=[];if(n)r=n();else{var l=o.getParent();l&&(r=l.getTasks())}r.forEach(function(e){e.get("title")&&e.get("title").match(i)&&a.push(e)})}s(a)};if(n&&e.length>=2)a();else{var r=o.getParent();if(r&&r.hasViewAccess()&&r.getTasks().length)return void a();o.fetch({mask:"dsplan:MVMask.Task.CollaborativeTask.siblings",onComplete:a,onFailure:a})}}).call(this,s,a,r,function(e){var t=n.getBatchGenerator(),s=[],a=[];function r(e){var t=e.isComplete&&e.isComplete();return o!==e.id&&e.isRDF&&!t}function l(e){for(var n=0;n<e.length&&s.length<T;n++){var i=e[n];i.hasFetchedAccessData()?r(i)&&s.push(A(i)):(a.push(i),t.addRequestsFromBatch(i.getAccessBatch()))}}l(e),s.length<T&&t.requests.length?t.sendBatch({onComplete:function(){l(a),i(s)}}):i(s)})},E}),define("DS/E6WCommonApps/Models/TeamMemberResponsibilityModel",["UWA/Core","UWA/Class/Model","DS/E6WCommonApps/Models/E6WCommonAppsConstants","DS/RDFFoundation/RDFUtils","DS/RDFFoundation/MemberUtils","DS/RDFFoundation/Models/PersonRDFModel","DS/RDFFoundation/Models/UsersGroupRDFModel","DS/RDFFoundation/Models/LogicalUserModel","i18n!DS/E6WCommonApps/assets/nls/E6WCommonAppsNLS"],function(e,t,n,s,i,o,a,r,l){"use strict";var d=l.get.bind(l),c={"dsplan:Viewer":0,"dsplan:Author":1,"dsplan:Leader":2},p=t.extend({_uwaClassName:"TeamMemberResponsibilityModel",idAttribute:"@id",setup:function(e){this._parent.apply(this,arguments),e.memberPersonModel&&this.listenTo(e.memberPersonModel,"onAnyEvent",function(e){var t=Array.prototype.slice.call(arguments,1);this.dispatchEvent(e,t)})},parse:function(t,n){var s=e.clone(t||{},!1);return this._parent(s,n)},get:function(e){var t=this._parent.apply(this,arguments);switch(e){case"title":return this.get("memberPersonModel").fullName||this.get("memberPersonModel").title;case"type":return this.get("memberPersonModel").getObjectType();case"image":return this.get("memberPersonModel").get("image");case"personRDFId":case"physicalId":return this.get("memberPersonModel").id;case"responsibility":return this.getHighestResponsibility();case"responsibilityNLS":return this.getResponsibilityNLS();case"memberType":return d("E6WCommonApps.Member.MemberType."+this.get("memberType"))}return t},getResponsibilityNLS:function(){var e=this.get("responsibility"),t=s.splitUri(e)[1];return i.isPendingUser(this.get("memberPersonModel"))?d("E6WCommonApps.Label.ResponsibilityDisplayPending."+t):d("E6WCommonApps.Label."+t)},isMemberLogicalUser:function(){let e=this.get("memberPersonModel");return e&&e instanceof r},toJSON:function(e){var t=this._parent.apply(this,arguments);t.responsibilityNLS=this.get("responsibilityNLS");let s=e&&e.ancestors||{},i=this.get("memberPersonModel");this.get("type")===n.LOGICAL_USER_TYPE?t.memberType=d("E6WCommonApps.Member.MemberType.Pending"):t.memberType=d("E6WCommonApps.Member.MemberType.Member"),s[i.id]?delete t.memberPersonModel:t.memberPersonModel=i.toJSON(e);let o=this.get("parentWorkscopeModel");return o&&!s[o.id]?t.parentWorkscopeModel=o.toJSON(e):delete t.parentWorkscopeModel,t.title=this.get("title"),t.image=this.get("image"),t},getHighestResponsibility:function(){for(var e=this.get("allResponsibilitiesArray"),t=e[0],n=c[t],s=1;s<e.length;s++){var i=e[s],o=c[i];o>n&&(n=o,t=i)}return t},getTaggerURI:function(){var e=this.get("physicalId")||this.id;return this.isRDF&&(e=this.getTagPrefix()+s.conditionalShortToLongURI(e)),e}});return p.processRawData=function(e,t){for(var o=[],a=Object.keys(e),r=a.length,l=0;l<r;l++){var d=a[l],c=e[d],u=c&&c.member;if(u){let e=u[0]["dsplan:jsType"];var h,m,T;if("foaf:Person"===e&&(e="pno:Person",(h=u[0]["dsaccess:accountName"])&&i.addUserUIdToMap(i.addIamToURI(h),s.removeBracketLongURI(d))),e===n.LOGICAL_USER_TYPE){let n=u[0].title,i=p.getAllResponsibilitiesArray(c.member);T={"@id":s.removeBracketLongURI(d),id:s.removeBracketLongURI(d),type:e,allResponsibilitiesArray:i,parentWorkscopeModel:t,title:n,workforceRequestId:u[0].requestId}}else{T={id:d,type:e,allResponsibilitiesArray:p.getAllResponsibilitiesArray(c.member),parentWorkscopeModel:t,accountName:h}}m=p.getMemberObj(T),o.push(m)}}return o},p.getAllResponsibilitiesArray=function(e){for(var t=[],n=0;n<e.length;n++){var s=e[n].responsibility;t.push(s)}return t},p.getMemberObj=function(t){var l;let d={attrs:{"dsxplan:jsType":t.type}};var c,u;d.mask=i.getPersonMask(),d.attrs["dsxplan:jsType"]=t.type,"pno:Person"===t.type?(l=o,d.attrs["dsaccess:accountName"]=t.accountName):t.type===n.LOGICAL_USER_TYPE?(l=r,d.attrs.type=t.type,d.attrs.title=t.title,d.attrs.workforceRequestId=t.workforceRequestId,c=s.getObjectById(t.id)):(l=a,d.attrs["dsaccess:accountName"]=t.accountName),c?(c.set(d.attrs),u=c):u=s.getObjectForAdding(l,t.id,d);var h=t.allResponsibilitiesArray;return h&&e.is(h,"string")&&(h=[h]),{"@id":p.getInstanceId(t.id,t.parentWorkscopeModel.id),allResponsibilitiesArray:h,memberPersonModel:u,parentWorkscopeModel:t.parentWorkscopeModel}},p.getInstanceId=function(e,t){return s.getObjectIDFromUserMap(e)?s.getObjectIDFromUserMap(e)+"_"+t:e+"_"+t},Object.defineProperty(p.prototype,"fetching",{get:function(){return this.get("memberPersonModel").fetching}}),Object.defineProperty(p.prototype,"tagsData",{get:function(){return this.get("memberPersonModel").tagsData}}),Object.defineProperty(p.prototype,"serviceId",{get:function(){return this.get("memberPersonModel").serviceId}}),p}),define("DS/E6WCommonApps/Collections/ProjectTeamCollection",["UWA/Core","DS/RDFFoundation/Collections/ResultCollection","DS/RDFFoundation/RDFUtils","DS/E6WCommonUI/UIHelper","DS/RDFFoundation/Models/PersonRDFModel","DS/RDFFoundation/Models/LogicalUserModel","DS/E6WCommonApps/Models/TeamMemberResponsibilityModel","DS/E6WCommonApps/Models/E6WCommonAppsConstants","DS/E6WCommonApps/SubscribeUtil","i18n!DS/E6WCommonApps/assets/nls/E6WCommonAppsNLS"],function(e,t,n,s,i,o,a,r,l,d){"use strict";var c=function(e){return d.get(e)},p={resetOperation:c("E6WCommonApps.Member.ProgressBar.ModifyOperation"),addOperation:c("E6WCommonApps.Member.ProgressBar.AddOperation"),removeOperation:c("E6WCommonApps.Member.ProgressBar.RemoveOperation")},u=function(e){e.data[e.action]=e.data[e.action]||[];var t=function(e){var t=e.data[e.action].detect(function(t){return t.responsibility===e.role});return t||(t=t||{responsibility:e.role,persons:[],groups:[]},e.data[e.action].push(t)),t}(e);"pno:Person"===e.type||e.type===r.LOGICAL_USER_TYPE?-1===t.persons.indexOf(e.id)&&t.persons.push(e.id):-1===t.groups.indexOf(e.id)&&t.groups.push(e.id)};return t.extend({_uwaClassName:"ProjectTeamCollection",model:a,setup:function(t,n){var s=e.clone(n||{},!1);s["@mask"]="dsplan:MVMask.Person.Complex",this._workscope=s.workscope,this._uri=s.uri,this._workscope&&this._addCollectionListeners(),this._parent(t,s)},_addCollectionListeners:function(){var e=this._workscope.getCollectionAttribute(r.ASSIGNEE_ATTR);this.listenTo(e,"onAdd",this._onAssigneeAddedToParentWorkscopeCollection),this.listenTo(this,"onRemove",function(){this._removeMemberFromParentWorkscope.apply(this,arguments)})},_onAssigneeAddedToParentWorkscopeCollection:function(e){if(!this.get(a.getInstanceId(e.id,this._workscope.id))){var t={id:e.id,type:e.getObjectType(),allResponsibilitiesArray:r.RESPONSIBILITY_LEADER};this.addMember(t)}},_removeMemberFromParentWorkscope:function(e,t,n){n&&!n.dontRemoveParentWorkscope&&this._workscope.removeObject(r.ASSIGNEE_ATTR,e.get("memberPersonModel"),n)},fetch:function(t){var n=e.clone(t||{},!1);if(!n.dontFetch){var s=[this._workscope.id];return n.searchStr&&s.push(n.searchStr),n.data=JSON.stringify(s),this._parent(n)}},getUri:function(){return this._uri||"/invoke/dsxplan:getResourceSharing"},parse:function(e){return a.processRawData(e,this._workscope)},onSaveComplete:function(e){var t=this,n=[],s=[];e.forEach(function(e){var t=e.memberModel;t&&(e.requestType===r.REQUEST_TYPE_ADD?n[t.id]="":e.requestType===r.REQUEST_TYPE_REPLACE&&(s[t.id]=""))}),e.forEach(function(e){var i=e.memberModel;if(i){var o,a=e.requestType;a===r.REQUEST_TYPE_ADD?o=c("E6WCommonApps.Label.AddMember"):a===r.REQUEST_TYPE_REMOVE?(o=c("E6WCommonApps.Label.RemoveMember"),e.options&&e.options.isLoggedInUser&&t._destroyModelAndSetNewRoute(t._workscope)):a===r.REQUEST_TYPE_REPLACE&&(o=c("E6WCommonApps.Label.ReplaceMember")),i.get("title")?t._showAlertAndRemoveProgress(n,s,e,o):i.addEventOnce("onSync",function(){t._showAlertAndRemoveProgress(n,s,e,o)})}})},onSaveFailure:function(e,t,i){var o=this;e.forEach(function(e){o.rollbackMemberChanges(e);var t,a=i&&i.msg;a?(t=n.splitUri(a)[1].trim(),i.error||(t=n.splitUri(JSON.parse(a).msg)[1].trim()),"E6WCommonApps.Error.ownerRefused"===t&&(t=d.replace(c(t),{MEMBER_NAME:e.memberModel.get("title")})),s.displayError(c(t))):s.displayError(c("E6WCommonApps.Error.SaveFailed"));e.memberModel.dispatchEvent("removeProgress")})},onSaveTimeout:function(e){e.forEach(function(e){e.memberModel.dispatchEvent("removeProgress")})},save:function(t){var s=function(t){var n={};return t.forEach(function(t){n[t.requestType]=n[t.requestType]||[];var s=t.memberModel.get("type"),i=t.memberModel.get("personRDFId"),o={data:n,id:i,action:t.requestType,type:s};switch(t.requestType){case r.REQUEST_TYPE_REMOVE:t.memberModel.get("allResponsibilitiesArray").forEach(function(t){u(e.extend(o,{role:t}))});break;default:u(e.extend(o,{role:t.memberModel.get("responsibility")}))}}),Object.keys(n).forEach(function(e){n[e].forEach(function(e){e.persons&&(e.persons=JSON.stringify(e.persons)),e.groups&&(e.groups=JSON.stringify(e.groups))})}),n}(t),i=Object.keys(s),a={};let d=function(){for(var e of i){var t=p[e],n=l.subscribeActivity(t);a[e]=n,l.startActivity(t,n)}};var c;1===t.length?t[0].memberModel.get("memberPersonModel")instanceof o||d():t.length>1&&d();c=0===Object.keys(a).length?JSON.stringify([s,this._workscope.id]):JSON.stringify([s,this._workscope.id,{identifier:a}]),n.request(n.expandUrl("/invoke/dsxplan:shareResources","v0"),{method:"POST",type:"json",data:c,headers:{"Content-Type":"application/json"},onComplete:this.onSaveComplete.bind(this,t),onFailure:this.onSaveFailure.bind(this,t),onTimeout:this.onSaveTimeout.bind(this,t)})},addMember:function(t,n){var s=e.clone(n||{},!1);s.dontRegisterChange=!0,e.extend(t,{parentWorkscopeModel:this._workscope});var i=a.getMemberObj(t),o=this.add(i,s),l=r.REQUEST_TYPE_ADD;return!s.rollBackFlag&&o.dispatchEvent("addProgress"),{memberModel:o,requestType:l}},resetMember:function(t,n,s){var i=e.clone(s||{},!1);e.is(n,"string")&&(n=[n]);var o=r.REQUEST_TYPE_REPLACE,a=t.get("allResponsibilitiesArray");return t.set("allResponsibilitiesArray",n),!i.rollBackFlag&&t.dispatchEvent("addProgress"),{memberModel:t,requestType:o,oldResponsibilitiesArray:a}},removeMember:function(t,n){var s=e.clone(n||{},!1);s.dontRegisterChange=!0;var i=r.REQUEST_TYPE_REMOVE,o=t.get("allResponsibilitiesArray");return this.remove(t,s),{memberModel:t,requestType:i,oldResponsibilitiesArray:o,options:s}},rollbackMemberChanges:function(e){var t=e.memberModel.get("personRDFId"),n=e.requestType;if(n===r.REQUEST_TYPE_ADD)this.removeMember(e.memberModel);else if(n===r.REQUEST_TYPE_REMOVE){var s={id:t,type:e.memberModel.get("type"),allResponsibilitiesArray:e.oldResponsibilitiesArray};this.addMember(s,{rollBackFlag:!0})}else this.resetMember(e.memberModel,e.oldResponsibilitiesArray,{rollBackFlag:!0})},_destroyModelAndSetNewRoute:function(e,t){var n=t&&s.getNewRouteIndexFromManagmentView(e,t);e.destroy({noServer:!0}),t&&t.setRoute(n)},_showAlertAndRemoveProgress:function(e,t,n,i){var o=n.memberModel,a=d.replace(i,{MEMBER_NAME:o.get("title"),ROLE:o.getResponsibilityNLS()}),l=Object.keys(e).length,p=Object.keys(t).length;n.requestType===r.REQUEST_TYPE_REMOVE?s.displaySuccess(a):Object.keys(e).length+Object.keys(t).length===1?s.displaySuccess(a):(n.requestType===r.REQUEST_TYPE_ADD?e[n.memberModel.id]=a:t[n.memberModel.id]=a,(a=function(){var n,s="",i="";for(var o in e){if(!(n=e[o]))return"";s&&(s+=",<br>"),s+=n}for(var o in t){if(!(n=t[o]))return"";i&&(i+=",<br>"),i+=n}return n="",s&&(l>1||p>=1)&&(s="<p>"+c("E6WCommonApps.Label.AddMembers")+s+"</p>"),n=s,i&&(l>=1||p>1)&&(i="<p>"+c("E6WCommonApps.Label.ReplaceMembers")+i+"</p>"),i&&(n+=i),n}())&&s.displaySuccess(a)),o.dispatchEvent("removeProgress")}})}),define("DS/E6WCommonApps/Models/WorkscopeModel",["UWA/Core","UWA/Class/Collection","DS/RDFFoundation/RDFUtils","DS/RDFFoundation/Models/ComponentProxyModel","DS/RDFFoundation/Collections/ResultCollection","DS/RDFFoundation/Collections/UserCollection","DS/E6WCommonApps/Collections/ProjectTeamCollection","DS/E6WCommonApps/Models/RDFTaskModel","DS/E6WCommonApps/Models/E6WCommonAppsConstants","DS/E6WCommonApps/Models/ScheduleElementModel","DS/E6WCommonApps/Collections/ConstraintsPseudoCollection","DS/E6WCommonApps/Models/ConstraintModel","DS/E6WCommonApps/Collections/RDFTasksCollection","DS/E6WCommonApps/Collections/HasConstraintsCollection","DS/E6WCommonApps/Models/SolverModelMixin","DS/E6WCommonApps/Models/CalendarModel","DS/E6WCommonApps/Models/AccessModel","DS/E6WCommonApps/Models/FileManagementMixin","DS/E6WCommonApps/Models/MilestoneModel","DS/E6WCommonApps/Models/RepositoryModelMixin","DS/E6WCommonApps/Models/AddTaskMixin","DS/E6WCommonApps/Models/NoAccessModel","DS/E6WCommonApps/ReparentingUtils","DS/E6WCommonApps/Collections/RDFLeafTasksCollection","DS/E6WCommonApps/LiveUpdateUtils","DS/E6WCommonUI/UIHelper","DS/E6WCommonUI/Models/DropValidator","DS/E6WCommonUI/PlatformManager","i18n!DS/E6WCommonApps/assets/nls/E6WCommonAppsNLS","i18n!DS/E6WCommonUI/assets/nls/E6WCommonUINLS"],function(e,t,n,s,i,o,a,r,l,d,c,p,u,h,m,T,g,E,A,f,C,D,_,S,v,R,y,M,I,b){"use strict";var O=function(e){var t=b.get(e);return t===e&&(t=I.get(e)),t},P=l.CONSTRAINT_RELATION_ATTR,F=l.RESTRICT_ASSIGNEE_ATTR,N=l.RESTRICT_ASSIGNEE_ATTR_SERVER,k={"dsplan:schedulingStrategy":!0,"dsxplan:schedulingStrategy":!0,"dsplan:schedulingFromStrategy":!0,"dsplan:startDateIntervalMin":!0,"dsxplan:startDateIntervalMin":!0,"dsplan:endDateIntervalMax":!0,"dsxplan:endDateIntervalMax":!0,"dsxplan:usesCalendar":!0},W={all:{attribute:"dsxplan:hasLeafTasks",parentMask:"dsplan:MVMask.WorkPackage.Complex"},owned:{attribute:"dsplan:ownedTasks",parentMask:"dsplan:MVMask.WorkPackage.CollaborativeTasks.owned"},assigned:{attribute:"dsplan:assignedTasks",parentMask:"dsplan:MVMask.WorkPackage.CollaborativeTasks.assigned"},assignedToMyGroups:{attribute:"dsplan:assignedToMyGroupTasks"}},U=g.extend({TASK_RELATION_ATTR:"dsplan:hasTask",liveUpdateCreateMask:"dsplan:MVMask.WorkPackage.Collapsed",dslcMapping:l.dslcMapping,_propertyDictionary:{team_members:{volatility:!0},thumbnail:{volatility:!0},solveCounter:{volatility:!0},"dsxplan:hasConstraint":{volatility:!0},"dsplan:hasConstraint":{volatility:!0},"dsxplan:workDecompositionParent":{inverseProperty:"dsxplan:hasWorkDecomposition",inversePropertyIsCollection:!0},"dsxplan:hasWorkDecomposition":{inverseProperty:l.WORKSCOPE_PARENT_ATTR},"dsxplan:hasTask":{inverseProperty:"dsxplan:workscopeParent"},"dsplan:hasRolledUpInfo":{inverseProperty:"dsplan:isRolledUpInfoFor"},"dsplan:hasParent":{volatility:!0},explicitTagsData:{volatility:!0},"dsplan:accessedDate":{volatility:!0},"dsplan:isFavorite":{volatility:!0}},_relations:[{key:l.CHILDREN_ATTR},{key:"dsxplan:hasWorkDecomposition"},{key:"dsplan:hasTask",relatedCollection:u},{key:"dsxplan:hasLeafTasks",relatedCollection:S},{key:"dsplan:assignedToMyGroupTasks",relatedCollection:S},{key:"dsxplan:hasTask",relatedCollection:u},{key:"dsplan:assignedTasks",relatedCollection:S},{key:"dsplan:ownedTasks",relatedCollection:S},{key:P,relatedCollection:h},{key:"dsxplan:hasConstraint",relatedCollection:h},{key:"dsxplan:hasMilestone",relatedCollection:i},{key:"dsxplan:hasAssignee",relatedCollection:o},{key:"dsxplan:hasBaseline",relatedCollection:i}],_modelProperties:{"dsplan:hasWorkContext":!0,"dsxplan:hasWorkContext":!0},_uwaClassName:"WorkscopeModel",parentMask:"dsplan:MVMask.WorkPackage.Complex",mask:"dsplan:MVMask.WorkPackage.Basic",writeMask:"dsplan:MVMask.WorkPackage.Complex",syncWithDPMIfNeeded:function(){n.request(n.expandUrl("invoke/dsplan:syncWithDPMIfNeeded"),{method:"POST",type:"json",data:JSON.stringify([this.compactJson()]),headers:{"Content-Type":"application/json"},onComplete:function(){}})},isFavorite:function(){return this.get("dsplan:isFavorite")},_getImage:function(e){return e||(e=this.getDefaultImage()),e&&-1===e.indexOf("http://")&&-1===e.indexOf("https://")?require.toUrl("XPlanApp/assets/img/"+e):e},getDefaultImage:function(){var e=this.isXProject()?require.toUrl("E6WCommonApps/assets/img/I_EnterpriseProject_Thumbnail.png"):require.toUrl("E6WCommonApps/assets/img/I_TeamProject_Thumbnail.png");if(e)return e},solve:function(t){var n=e.clone(t||{},!1);return n.listName="ProjectList",d.prototype.solve.call(this,n)},sync:function(t,n,s){var i=e.clone(s||{},!1);if("update"===t&&(i.solve||(i.solve=this.shouldWeSolve(i)),i.solve)){var o=this;i.onComplete=function(){var t=s&&e.is(s.onComplete,"function")&&s.onComplete.apply(this,arguments);return o.solve(),t};var a=Array.prototype.slice.call(arguments,0);return a[2]=i,this._parent.apply(this,a)}return this._parent.apply(this,arguments)},syncCreate:function(e,t){var n=Array.prototype.slice.call(arguments,0),s=n[1],i=this;i.beingCreatedOnServer=!0;var o=t.onFailure,a=t.onComplete,r=t.onTimeout;s.onComplete=function(){i.beingCreatedOnServer=!1,a&&a.apply(this,arguments)},s.onFailure=function(e,t,n){i.beingCreatedOnServer=!1,n&&(n.response=t),o&&o.apply(this,arguments)},s.onTimeout=function(e,t,n){i.beingCreatedOnServer=!1,n&&(n.response=t),r&&r.apply(this,arguments)},this._parent.apply(this,n)},shouldWeSolve:function(e){var t;if(this.getChangedAttributesSinceLastSave().some(this.isAttributeImpactingSolve.bind(this))||e.assumeChanges){for(t=this.getParent();t;t=t.getParent()){if(t.autosolve===l.AUTOSOLVE_OFF)return d.dispatcher.dispatchEvent("solveNeeded",[this]),!1;if(t.autosolve===l.AUTOSOLVE_ON)return!0}if(!t){if(this.autosolve===l.AUTOSOLVE_OFF)return d.dispatcher.dispatchEvent("solveNeeded",[this]),!1;if(this.autosolve===l.AUTOSOLVE_ON)return!0}return!0}return!1},_registerAsElementParent:function(e){var t=this.id;e.parentId=t||this.cid,e.parentConstructor=this.constructor,e instanceof U&&t&&e.set(l.WORKSCOPE_PARENT_ATTR,this,{dontRegisterChange:!0})},onAtIdChange:function(){this._parent.apply(this,arguments),this.getCollectionAttribute(l.CHILDREN_ATTR).forEach(this._registerAsElementParent,this),this.getTasks().forEach(this._registerAsElementParent,this),this.getMilestones().forEach(this._registerAsElementParent,this)},updateThumbnailImage:function(e){var t=e||this.get("dsplan:hasThumbnail");t&&(this.thumbnail=t)},hasParent:function(){return Boolean(this.get(l.HAS_PARENT_ATTR))},setup:function(){this._beingCreatedOnServer=!1,this._listenToModel(),this._listenToChildrenCollections(),this._registerAsParentOfAllChildrenModels(),this._parent.apply(this,arguments),this.updateThumbnailImage(),this.isNew()&&(this.mask="dsplan:MVMask.WorkPackage.Complex"),this._fetchCount=0,this.getCollectionAttribute(l.CONSTRAINT_RELATION_ATTR,void 0,{}),this.getAttachments(),this.getDeliverables(),this.getBaselines(),this.workscopeId="WorkscopeModel"+parseInt(1e4*Math.random())},_listenToModel:function(){var e={"onChange:title":function(){this.dispatchEvent("onChange:name",arguments)}};e["onChange:"+l.WORKSCOPE_PARENT_ATTR]=function(e,t){this===e?t||(this.parentId=void 0,this.parentConstructor=void 0):console.error("invalid onChange parent to be checked")},e.onSync=function(){this._setAndSaveSequenceOrders(this.getTasks()),this._setAndSaveSequenceOrders(this.getWorkscopes())},e["onChange:"+l.WORK_CONTEXT_ATTR]=this._onContextChanged,this.listenTo(this,e)},_onContextChanged:function(e,t){var n=this.previousAttributes()[l.WORK_CONTEXT_ATTR];n&&n instanceof U&&(this.stopListening(n.getMilestones()),n.getMilestones().forEach(e=>{e.removeShadowParent(this)})),t&&t instanceof U&&(t.getMilestones().forEach(e=>{e.addShadowParent(this)}),this.listenTo(t.getMilestones(),{onAdd:e=>{e.addShadowParent(this)},onRemove:e=>{e.removeShadowParent(this)}}))},_listenToChildrenCollections:function(){for(var e=[this.getWorkscopes(),this.getTasks(),this.getMilestones()],t=0;t<e.length;t++){var n=e[t];this.listenTo(n,{onAdd:this._registerAsElementParent,onReset:this._registerAsParentOfEachElement})}this.listenTo(this.getTasks(),"onSync",function(){this._setAndSaveSequenceOrders(this.getTasks())}),this.listenTo(this.getWorkscopes(),"onSync",function(){this._setAndSaveSequenceOrders(this.getWorkscopes())})},_registerAsParentOfEachElement:function(e){e.forEach(this._registerAsElementParent,this)},_registerAsParentOfAllChildrenModels:function(){this.getWorkscopes().forEach(this._registerAsElementParent,this),this.getTasks().forEach(this._registerAsElementParent,this),this.getMilestones().forEach(this._registerAsElementParent,this)},getParent:function(){return n.getObjectById(this.parentId)||this.get(l.WORKSCOPE_PARENT_ATTR)},getCalendar:function(){return this.get("dsxplan:usesCalendar")},getObjectTypeLabel:function(e){return e===l.PROGRAM_RDF_TYPE||"dsxplan:Program"===e||"dsxplan:ProgramVersion"===e?l.PROGRAM:e===l.PROJECT_RDF_TYPE?l.PROJECT:e===l.XPROJECT_RDF_TYPE?l.XPROJECT:e===l.WORKPACKAGE_RDF_TYPE||"dsxplan:WorkPackage"===e||"dsxplan:WorkPackageVersion"===e?l.WORKPACKAGE:l.OBJECT},getObjectType:function(){var e=this.get("dsxplan:jsType")||this.get("dsxplan:actualType")||this.get(l.ACTUAL_TYPE_ATTR)||this.get(l.TYPE_ATTR);if(e){var t=e.id||e;return this.getObjectTypeLabel(t)}return l.OBJECT},getProjectTypeNLS:function(){var e=this.get(l.PROJECT_TYPE);if(e){if(e===l.PROJECT_RDF_TYPE)return I.get("E6WCommonApps.Type.TeamProject");if(e===l.XPROJECT_RDF_TYPE)return I.get("E6WCommonApps.Type.EnterpriseProject")}},get:function(e){var t=this._parent.apply(this,arguments);switch(e){case"image":var n=this.get("dsplan:hasThumbnail");return n||this._getImage(this._parent.apply(this,arguments));case"type":return this.getObjectType();case"name":return this._parent("title");case"description":return this.get(l.DESCRIPTION_ATTR);case"ds6w:type":return this.get(l.PROJECT_TYPE);case"dsplan:actualDatesStrategy":return t||(t=l.CURRENT_DATES_STRATEGY),t;case l.SCHEDULING_FROM_STRATEGY_ATTR:return t||(t=l.CURRENTDATE_SCHEDULINGFROM_STRATEGY),t;case l.WORKSCOPE_PARENT_ATTR:return!t&&this.hasParent()&&(t=new D),t;default:return t}},getTeamMembers:function(){var e=this.get("team_members");return e||(e=new a(void 0,{workscope:this,"@mask":"dsplan:MVMask.WorkPackage.Property"}),this.setCollection("team_members",e)),e},dataForRendering:function(t){var n,s=e.clone(t||{},!1);if(s.attributes){n=Object.create(null);for(var i=s.attributes,o=i.length,a=0;a<o;a++){var r=i[a];n[r]=!0}s.attributes=i}var d=!n,c=this._parent.apply(this,arguments),p=this;return c.autosolve=this.autosolve!==l.AUTOSOLVE_OFF,c.name=this.get(l.DSLC_TITLE_ATTR),c.image=this.get("dsplan:hasThumbnail")||this.get("image"),c.physicalId=this.get("physicalId"),function(s){if(d||n[s]){var i=p.get(s);i&&(e.is(i.dataForRendering,"function")&&(i=i.dataForRendering(t)),c[s]=i)}}(this.get(l.WORKSCOPE_PARENT_ATTR)),c},toJSON:function(){let e=this._parent.apply(this,arguments);return e.isFavorite=e["dsplan:isFavorite"],e},getWorkscopes:function(){return this.getCollectionAttribute(l.CHILDREN_ATTR)},getConstraints:function(){return this._allConstraints=this._allConstraints||new c(this),this._allConstraints},getPropertyMask:function(){return"dsplan:MVMask.WorkPackage.Property"},fetchForProperty:function(){var e={};T.haveCalendarsBeenFetched()||(e=n.getBatchGenerator(),T.fetchCalendars({ajax:e.ajax}));var t={mask:this.getPropertyMask&&this.getPropertyMask(),dontUpdateMask:!0,ajax:e.ajax,onlyIfNeeded:!0};this.fetch(t),T.haveCalendarsBeenFetched()||e.sendBatch()},fetch:function(t){var n=e.clone(t||{},!1),s=this;return s.fetchCount++,n.onComplete=function(){s.fetchCount--,t&&e.is(t.onComplete,"function")&&t.onComplete.apply(this,arguments)},n.onFailure=function(){s.fetchCount--,t&&e.is(t.onFailure,"function")&&t.onFailure.apply(this,arguments)},this._parent(n)},destroy:function(){this.getWorkscopes().reset([],{silent:!0}),this._parent.apply(this,arguments)},getMilestoneTypes:function(){return this._getTypes(l.MILESTONE_VOCABULARY_ATTR)},getTaskTypes:function(){return this._getTypes(l.TASK_VOCABULARY_ATTR)},getDSLCTaskTypes:function(){return this._getTypes("dsxplan:hasTaskVocabulary")},getDSLCMilestoneTypes:function(){return this._getTypes("dsxplan:hasMilestoneVocabulary")},_getTypes:function(e){var t=[],n=this,s=function(){for(var t=n.get(e);!t&&n&&n.hasViewAccess();)(n=n.getParent())&&(t=n.get(e));return t}();if(s){var i=s.get("dsplan:vocabularyTerms");if(i)for(var o=0;o<i.length;o++){var a=i.at(o),r="E6WCommonApps.Type."+a.id.substring(a.id.indexOf(":")+1);t.push({actualValue:a.id,displayValue:O(r)})}}return t},createChildWorkscope:function(t,n){var s=this._getDefaultChildWorkscopeAttributes();e.extend(s,t);var i=this._getChildWorkscopeType(s[l.TYPE_ATTR]),o=l.CHILDREN_ATTR.replace("dsplan","dsxplan");s[l.TYPE_ATTR]=i;var a=e.clone(n||{},!1);a._defaultModel=U;var r=this.addModelToAttributeWithCollection(o,s,a);return this._registerAsElementParent(r),r},_getChildWorkscopeType:function(e){return e||(e="Program"===this.getObjectType()?l.PROJECT_RDF_TYPE:l.WORKPACKAGE_RDF_TYPE),e},getStartAndFinishDates:function(){var e={},t=function(t){isNaN(t.start)||e.start&&!(t.start<e.start)||(e.start=t.start),isNaN(t.finish)||e.finish&&!(t.finish>e.finish)||(e.finish=t.finish)};this.getMilestones().forEach(function(e){var n=new Date(e.getStartDate());t({start:n,finish:n})});var n=this.get("dsxplan:hasRolledUpInfo");if(n){var s=n.get("dsxplan:estimatedStartDate")&&new Date(n.get("dsxplan:estimatedStartDate")),i=n.get("dsxplan:estimatedEndDate")&&new Date(n.get("dsxplan:estimatedEndDate"));t({start:s,finish:i})}return e},isAttributeImpactingSolve:function(e){return k[e]},getAssignees:function(){return this.getCollectionAttribute(l.ASSIGNEE_ATTR,{detailsMask:"dsplan:MVMask.Person.Complex"})},save:function(){var t=R.setHelper.apply(this,arguments),n=t.attrs||{};n=this.handleRestrictAssigneeAccess(n);var s=t.options,i=e.clone(s||{},!1),o=this.getCombinedAttributes(n);if(i.onComplete=this._getCallbackThatWillFetchTeamMembersOnCompleteIfNeeded(o,s),!i.forceSequenceOrder&&this._hasNewWorkscopeParentAttributeWithoutNewSequenceOrderAttribute(o)){var a=this._calculateNewSequenceOrderFromParentThenSave(n,s);if(a)return a}return this._parent(n,i)},restore:function(e){n.request(n.expandUrl("/invoke/dsxplan:restore"),{method:"POST",type:"json",data:JSON.stringify([this.id]),headers:{"Content-Type":"application/json"},onComplete:e&&e.onComplete,onFailure:e&&e.onFailure,onTimeout:e&&e.onTimeout})},_hasNewWorkscopeParentAttributeWithoutNewSequenceOrderAttribute:function(e){var t=-1!==e.indexOf(l.WORKSCOPE_PARENT_ATTR),n=this.isDSLC()?this.dslcMapping[l.SEQUENCE_ORDER_ATTR]:l.SEQUENCE_ORDER_ATTR,s=-1!==e.indexOf(n);return t&&!s},_calculateNewSequenceOrderFromParentThenSave:function(t,n){var s=t[l.WORKSCOPE_PARENT_ATTR]||this.get(l.WORKSCOPE_PARENT_ATTR),i=this;return s&&s.fetch({onlyIfNeeded:!0,mask:"dsplan:MVMask.WorkPackage.Collapsed",onComplete:function(){var o=e.clone(t||{},!1),a=e.clone(n||{},!1);o[i.isDSLC()?i.dslcMapping[l.SEQUENCE_ORDER_ATTR]:l.SEQUENCE_ORDER_ATTR]=s.getWorkscopes().getTotalRecords()+Math.random(),delete a.ajax,i.save(o,a)}})},_getCallbackThatWillFetchTeamMembersOnCompleteIfNeeded:function(e,t){var n=t&&t.onComplete;if(e.some(function(e){return l.dslcMapping[l.ASSIGNEE_ATTR]===e})){var s=this;n=function(){var e=s.get("team_members");e&&e.fetch(),t&&t.onComplete&&t.onComplete.apply(this,arguments)}}return n},getMilestoneById:function(e){var t;return this.getMilestones().some(function(n){return n.id===e&&(t=n,!0)}),t},getMilestones:function(){return this.getCollectionAttribute("dsplan:hasMilestone",{"@mask":"dsplan:MVMask.WorkPackage.MilestonesOnly"})},getShadowMilestones:function(){var t=this.get(l.WORK_CONTEXT_ATTR);return t&&t.getMilestones?t.getMilestones():new e.Class.Collection},getTaskById:function(e){return this.getTasks().get(e)},getTasks:function(){return this.getCollectionAttribute("dsplan:hasTask",{"@mask":"dsplan:MVMask.WorkPackage.CollaborativeTasks.all",detailsMask:"dsplan:MVMask.Task.Complex"})},getAttachments:function(){return this.getCollectionAttribute(l.ATTACHMENT_ATTR,{"@mask":"dsplan:MVMask.WorkPackage.Property"})},getDeliverables:function(){return this.getCollectionAttribute(l.ACTUAL_DELIVERABLE_ATTR,{"@mask":"dsplan:MVMask.WorkPackage.Property"})},getBaselines:function(){return this.getCollectionAttribute("dsxplan:hasBaseline",{"@mask":"dsplan:MVMask.WorkPackage.Baselines"})},getBaselinesForComboBox:function(){return this.getBaselines().toArray().map(e=>({label:e.get("dsxplan:label"),icon:"stop",value:e.id}))},getTaskCollectionForFilter:function(t,n){var s=e.clone(n||{},!1),i=W[t];return this.getCollectionAttribute(i.attribute,{ownerFilter:t,onComplete:s.onComplete})},getOwnConstraints:function(){return this.getCollectionAttribute(P,{"@mask":"dsplan:MVMask.WorkPackage.ScheduleView"})},addConstraint:function(t,n){var s,i=e.clone(n||{},!1);return i._defaultModel=p,t[p.PREDECESSOR_ATTR].id!==t[p.SUCCESSOR_ATTR].id&&(s=this.addModelToAttributeWithCollection(P,t,i)),s},addMilestone:function(t){var n=e.clone(t||{},!1),s=n[l.SUGGESTED_DATE_ATTR]||new Date,i=n[l.ESTIMATED_DATE_ATTR]||new Date(s);return n["@type"]=n["@type"]||l.MILESTONE_RDF_TYPE,n[l.TITLE_ATTR]=n[l.TITLE_ATTR]||"Milestone",n[l.SUGGESTED_DATE_ATTR]=s,n[l.ESTIMATED_DATE_ATTR]=i,this._addScheduleElement("dsplan:hasMilestone",n)},addChildWorkscopeAndSave:function(t,s){var i=this,o=e.clone(s||{},!1);e.extend(o,{parentId:this.id,childId:t.id,type:U,onComplete:function(e){if(e.value||e["@value"]){var o=I.replace(R.i18n("E6WCommonUI.Alert.ChildIsAlreadyInParentStructure"),{PARENT_NAME:i.get("title"),CHILD_NAME:t.get("title")});R.displayError(o),s&&s.onFailure&&s.onFailure(void 0,void 0,{dontShowFailureMessage:!0})}else i.addValidatedChildWorkscopeAndSave(n.getObjectById(t.id),s)}}),_.checkParentHierarchyForId(o)},addValidatedChildWorkscopeAndSave:function(t,n){var s=e.clone(n||{},!1).sequenceOrder||this._getDefaultSequenceOrderForAttribute(l.CHILDREN_ATTR),i={};i[this.isDSLC()?"dsxplan:sequenceOrder":l.SEQUENCE_ORDER_ATTR]=s,i[l.WORKSCOPE_PARENT_ATTR]=this,t.save(i,{onComplete:n.onComplete,onFailure:n.onFailure,mask:"dsplan:MVMask.WorkPackage.Collapsed"})},add:function(e,t,n){if(e===l.CHILDREN_ATTR)throw new Error("Use addChildWorkscopeAndSave method instead");return[this.addModelToAttributeWithCollection(e,t,n)]},isVersion:function(){return!0},getDurationString:function(e){return n.millisecondsToXsdDayTimeDuration(8*parseFloat(e)*60*60*1e3)},_onRequest:function(){this.fetchCount++},_onCompleteRequest:function(){this.fetchCount--},_getDefaultChildWorkscopeAttributes:function(){var e={};return e[l.TITLE_ATTR]="Child WS",e[l.DESCRIPTION_ATTR]="",e[l.STATE_ATTR]="dsxplan:Open",e["dsxplan:jsType"]="dsplan:Project",e[l.SEQUENCE_ORDER_ATTR]=this._getDefaultSequenceOrderForAttribute(l.CHILDREN_ATTR),e},insertChildWorkscopeAtTop:function(e,t){var n=this.getSequenceOrderForNewFirstChild("dsxplan:hasWorkDecomposition");this._insertChildWorkscopeWithSequenceOrder(e,n,t)},insertChildWorkscopeBefore:function(e,t){var n=this.getSequenceOrderForObject({model:e,collection:this.getWorkscopes(),referenceModel:t.referenceModel,placement:"before"});this._insertChildWorkscopeWithSequenceOrder(e,n,t)},insertChildWorkscopeAfter:function(e,t){var n=this.getSequenceOrderForObject({model:e,collection:this.getWorkscopes(),referenceModel:t.referenceModel,placement:"after"});this._insertChildWorkscopeWithSequenceOrder(e,n,t)},insertChildWorkscopeAtBottom:function(e,t){var n=this;this.fetch({mask:"dsplan:MVMask.WorkPackage.Expanded",onlyIfNeeded:!0,onComplete:function(){var s=n.getSequenceOrderForLastChild("dsplan:hasWorkDecomposition");n._insertChildWorkscopeWithSequenceOrder(e,s,t)}})},_insertChildWorkscopeWithSequenceOrder:function(t,n,s){var i=e.clone(s,!1);this.getWorkscopes().contains(t)?(t.set(l.SEQUENCE_ORDER_ATTR,n),t.save(void 0,{onComplete:i&&i.onComplete,onFailure:i&&i.onFailure})):this.addChildWorkscopeAndSave(t,{sequenceOrder:n,onComplete:i&&i.onComplete,onFailure:i&&i.onFailure})},getSequenceOrderForObject:function(e){var t=e.placement||"after",n=e.collection.indexOf(e.referenceModel),s=e.referenceModel.get(l.SEQUENCE_ORDER_ATTR);if(0===n&&"after"!==t)return s-1-Math.random();if(n===e.collection.length-1&&"after"===t)return s+1+Math.random();var i="after"===t?n+1:n-1,o=e.collection.at(i).get(l.SEQUENCE_ORDER_ATTR);return(s+o)/2+(Math.random()-.5)*(s-o)/2},getSequenceOrderForNewFirstChild:function(e){var t=this.get(e);return 0===t.length?Math.random():t.first().get(l.SEQUENCE_ORDER_ATTR)-1-Math.random()},getSequenceOrderForLastChild:function(e){var t=this.get(e);return 0===t.length?Math.random():t.last().get(l.SEQUENCE_ORDER_ATTR)+1+Math.random()},_setAndSaveSequenceOrders:function(){},getCollectionAttributeBasedOnModel:function(e){return e instanceof p?"dsxplan:hasConstraint":e instanceof A?"dsxplan:hasMilestone":e instanceof r?"dsxplan:hasTask":e instanceof U?"dsxplan:hasWorkDecomposition":void 0},onShareNotification:function(e){this._parent.apply(this,arguments),this.getTeamMembers().length>0&&this.getTeamMembers().fetch({ajax:e.ajax,remove:!0,forceFetch:!0,onFailure:function(){this.destroy({noServer:!0})}.bind(this)})},onCollectionRollback:function(e){"dsxplan:hasAssignee"===e&&this.getTeamMembers().length>0&&this.getTeamMembers().fetch({reset:!0})},hasChildWorkscopes:function(){var e=this.getWorkscopes();return Boolean(e.length||e.hasMoreItems())},hasTasks:function(){var e=this.getTasks();return Boolean(e.length||e.hasMoreItems())},hasViewAccess:function(){return M.isXPPAuthorized()},ownsOrContainsTask:function(e){var t=this.get("dsplan:ownedTasks");if(t&&-1!==t.indexOf(e))return!0;var n=this.get("dsplan:assignedTasks");if(n&&-1!==n.indexOf(e))return!0;var s=this.get("dsxplan:hasLeafTasks");if(s&&-1!==s.indexOf(e))return!0;var i=this.get("dsplan:assignedToMyGroupTasks");return!(!i||-1===i.indexOf(e))||-1!==this.getTasks().indexOf(e)},_parseNestedModelsAndCollections:function(e){var t=e["dsxplan:hasTaskVocabulary"],n=e["dsxplan:hasMilestoneVocabulary"];function s(e){e["dsxplan:jsType"]||(e["dsxplan:jsType"]="dsxplan:Vocabulary");var t=e["dsplan:vocabularyTerms"];t&&t.member.forEach(function(e){e["dsxplan:jsType"]||(e["dsxplan:jsType"]="dsxplan:VocabTerm")})}return t&&s(t),n&&s(n),this._parent.apply(this,arguments)},canShare:function(){return void 0===this._accessShare&&g.AccessModelQueue.requestFetch(this),Boolean(this._accessShare)},checkStatusOfLRT:function(e,t,s){var i=this;if(202===e["@code"]){var o=e["@id"],a=n.expandUrl("task/"+o.toString(),"v1"),r={method:"GET",type:"json",headers:{"Content-Type":"application/json"},onComplete:function(e){i.checkStatusOfLRT(e,t,1e4)}};setTimeout(function(){n.request(a,r)},s)}else t(e)},exportToCSV:function(t){var s=this,i=e.clone(t||{},!1);i.type="json",i.headers={"Content-Type":"application/json"};var o=i.onComplete;i.method="POST",i.data=JSON.stringify(this.id),i.onComplete=function(e){s.checkStatusOfLRT(e,o,2e3)};var a=n.expandUrl("task/dsxplan:downloadCSV","v1");n.request(a,i)},getAccessBatch:function(t){var s=this,i=this._parent.apply(this,arguments);return i.ajax(n.expandUrl(g.ACCESS_URL),{method:"POST",onComplete:function(n){return s.setShareAccess(n["@value"]),t&&e.is(t.onComplete,"function")&&t.onComplete.apply(this,arguments)},onFailure:function(){return t&&e.is(t.onFailure,"function")&&t.onFailure.apply(this,arguments)},onTimeout:t&&t.onFailure,headers:{"Content-Type":"application/json"},data:JSON.stringify([this.id,g.SHARE_DATA]),type:"json"}),i},handleDeleteFailure:function(e){var t=e.onTimeout,n=this;e.onTimeout=function(){delete n._collectionsRemovedFrom,t&&t.apply(n,arguments)},this._parent(e)},parse:function(e,t){var n;this.dispatchEvent("onParseStart");try{n=this.handleIsFavoriteAndAccessedDate(e),n=this.handleRestrictAssigneeAccess(e),n=this._parent(n,t)}finally{this.dispatchEvent("onParseEnd")}return n},handleRestrictAssigneeAccess:function(e){if(e&&e.hasOwnProperty(N)&&(e[F]=e[N],delete e[N]),e&&e[F]){let t=e[F];e[F]=t&&"boolean"==typeof t?t?"TRUE":"FALSE":"TRUE"===t}return e},handleIsFavoriteAndAccessedDate:function(e){if(e){let t=e["dsxplan:projectAccess"];t&&(e["dsplan:accessedDate"]=t["dsplan:accessedDate"],e["dsplan:isFavorite"]=t["dsplan:isFavorite"],delete e["dsxplan:projectAccess"])}return e},unset:function(e){e===l.WORKSCOPE_PARENT_ATTR&&this.unset(l.HAS_PARENT_ATTR),this._parent.apply(this,arguments)},isXProject:function(){return"dsplan:xProject"===(this.get(l.PROJECT_TYPE)||this.get("@type"))},getDragType:function(){var e=this.get(l.PROJECT_TYPE);return e||(e=this._parent.apply(this,arguments)),e},set:function(){var t=R.setHelper.apply(this,arguments),n=e.clone(t.attrs||{},!1),s=e.clone(t.options||{},!1);return this.isXProject()&&!s.dontRegisterChange&&delete n[l.PROJECT_TYPE],this._parent(n,s)},addAsRecent:function(e){var t=this;let s=[n.jsonURIToSparqlURI(this.id)];e&&(s.push(!0),this.set("dsplan:isFavorite",!0)),this.adding=!0,n.request(n.expandUrl("invoke/dsxplan:addToRecentProjects?mask=dsplan:MVMask.WorkPackage.Favorite"),{method:"POST",type:"json",data:JSON.stringify(s),headers:{"Content-Type":"application/json"},onComplete:function(n){t.adding=!1,t.set("dsplan:accessedDate",n.accessedDate),e&&R.displaySuccess(O("E6WCommonApps.Alert.AddToFavoritesSuccess").replace("{PROJECT_NAME}",t.get("title")))},onFailure:function(){t.adding=!1,e&&(t.set("dsplan:isFavorite",!1),R.displayError(O("E6WCommonApps.Alert.AddToFavoritesFailure").replace("{PROJECT_NAME}",t.get("title"))))}})},removeFromFavorites:function(){var e=this;this.set("dsplan:isFavorite",!1),n.request(n.expandUrl("invoke/dsxplan:removeFromFavorites?mask=dsplan:MVMask.WorkPackage.Favorite"),{method:"POST",type:"json",data:JSON.stringify(n.jsonURIToSparqlURI(this.id)),headers:{"Content-Type":"application/json"},onComplete:function(){R.displaySuccess(O("E6WCommonApps.Alert.RemoveFromFavoritesSuccess").replace("{PROJECT_NAME}",e.get("title")))},onFailure:function(){e.set("dsplan:isFavorite",!0),R.displayError(O("E6WCommonApps.Alert.RemoveFromFavoritesFailure").replace("{PROJECT_NAME}",e.get("title")))}})}},m,f);U.SEQUENCE_ORDER_ATTR="dsplan:sequenceOrder",Object.defineProperty(U.prototype,"fetchCount",{get:function(){return this._fetchCount},set:function(e){var t=this._fetchCount;this._fetchCount=e,0===t!=(0===this._fetchCount)&&this.dispatchEvent("onChange:FetchCount")}}),Object.defineProperty(U.prototype,"beingCreatedOnServer",{get:function(){return this._beingCreatedOnServer},set:function(e){var t=this._beingCreatedOnServer;this._beingCreatedOnServer=e,t!==this._beingCreatedOnServer&&this.dispatchEvent("onChange:beingCreatedOnServer")}}),Object.defineProperty(U.prototype,"solveCounter",m.solveCounterDef),Object.defineProperty(U.prototype,"prevSolveCounter",m.prevSolveCounterDef),U.KPI_URI="dsmf:xplan.xPlanKPI.getKPIsForUpcomingMilestone?$mask=dsplan:MVMask.KeyPerformanceIndicator.Complex";var L=U.prototype.dslcMapping,w=n.inverseMapping(L);return U.prototype.inverseDslcMapping=w,U.CALENDAR_ATTR="dsxplan:usesCalendar",U.implement(E,C),U.parentPlanTypeAhead=function(e,t,s,i){var o=i.model.get("dsxplan:jsType");t=U.sanitizeTermForSearch(t);var a=[];a="dsplan:Task"===o?["dsplan:Project","dsplan:Task"]:["dsplan:Project"];var r=JSON.stringify([a,!1,t,[],["dsplan:Leader","dsplan:Author"],10]);return n.request(n.expandUrl("/invoke/dsxplan:getFilteredVersions?$mask=dsplan:MVMask.WorkPackage.Basic"),{method:"POST",type:"json",data:r,headers:{"Content-Type":"application/json"},onComplete:function(e){var t,n,o,a=[];if(e){var r=e.member;if(r)for(var d=0;d<r.length&&d<10;d++)i.model&&i.model.id===r[d]["@id"]||a.push((t=r[d],n=void 0,o=void 0,n={},o=t[l.THUMBNAIL_ATTR]||t["dsxplan:hasThumbnail"],n.value=t["@id"],n.label=t["dsxplan:label"],n.image=o||R.getDefaultImage(t),n.model=t,n.serviceId=l.SERVICE_3DPLAN,n["ds6w:type"]=t["dsxplan:jsType"],n))}s(a,i)},onFailure:function(){R.displayError(O("E6WCommonApps.Alert.NoResultFound"))}})},U.processDropData=function(e,t){var s=this&&this.id,i=R.getDataTransferJSON(e),o=!1;return i.data&&i.data.items.forEach(function(e){var i=y.validateDroppedObject(e,t);i||s!==n.removeBracketLongURI(e.objectId)||(i=R.i18n("E6WCommonUI.Alert.PlanOwnChild")),i&&(R.displayError(i),o=!0)}),o},U.sanitizeTermForSearch=function(e){return e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")},U.MILESTONE_RELATION_ATTR="dsplan:hasMilestone",U.TASK_RELATION_ATTR="dsplan:hasTask",U.TEAM_MEMBERS="team_members",U}),define("DS/E6WCommonApps/E6WCommonAppsTypeDictionary",["UWA/Core","DS/RDFFoundation/Models/PersonRDFModel","DS/RDFFoundation/Models/UsersGroupRDFModel","DS/RDFFoundation/RDFUtils","DS/RDFFoundation/Models/ComponentProxyModel","DS/RDFFoundation/Models/ResultModel","DS/RDFFoundation/Models/LogicalUserModel","DS/E6WCommonApps/Models/ConstraintModel","DS/E6WCommonApps/Models/RDFTaskModel","DS/E6WCommonApps/Models/MilestoneModel","DS/E6WCommonApps/Models/CalendarModel","DS/E6WCommonApps/Models/WorkscopeModel","DS/E6WCommonApps/Models/RollUpModel","DS/E6WCommonApps/Models/BaselineModel"],function(e,t,n,s,i,o,a,r,l,d,c,p,u,h){"use strict";return e.merge(s.typeDictionary,{mapping:[{key:"dsplan:Project",type:p},{key:"dsplan:xProject",type:p},{key:"dsxplan:WorkPackageVersion",type:p},{key:"dsplan:WorkPackage",type:p},{key:"dsxplan:WorkPackage",type:p},{key:"dsplan:Task",type:l},{key:"dsxplan:Task",type:l},{key:"dsxplan:TaskVersion",type:l},{key:"dsplan:Milestone",type:d},{key:"dsxplan:Milestone",type:d},{key:"dsxplan:MilestoneVersion",type:d},{key:"dsplan:TemporalConstraint",type:r},{key:"dsxplan:TemporalConstraint",type:r},{key:"dsplan:ControlledTemporalConstraint",type:r},{key:"dsxplan:ControlledTemporalConstraint",type:r},{key:"foaf:Person",type:t},{key:"foaf:Group",type:n},{key:"dsplan:LogicalUser",type:a},{key:"dscom:ComponentProxy",type:i},{key:"Person",type:t},{key:"dsplan:Calendar",type:c},{key:"swym:WeDo",type:l},{key:"dsplan:RolledUpInfo",type:u},{key:"dsplan:Baseline",type:h}],masksStrength:{"dsplan:MVMask.Task.CollaborativeTask.siblings":2,"dsplan:MVMask.WorkPackage.Basic":15,"dsplan:MVMask.WorkPackage.Collapsed":27,"dsplan:MVMask.WorkPackage.Expanded":32,"dsplan:MVMask.WorkPackage.Complex":111,"dsplan:MVMask.Task.Property":235,"dsplan:MVMask.Task.Basic":42,"dsplan:MVMask.Task.Complex":53,"dsplan:MVMask.Task.CollaborativeTasks.Complex":57}}),s.typeDictionary}),define("DS/E6WCommonApps/DeleteUtil",["UWA/Core","DS/E6WCommonUI/UIHelper","DS/UIKIT/Input/Toggle","DS/E6WCommonApps/Models/WorkscopeModel","DS/E6WCommonApps/Models/ConstraintModel","DS/E6WCommonApps/Models/E6WCommonAppsConstants","i18n!DS/E6WCommonApps/assets/nls/E6WCommonAppsNLS"],function(e,t,n,s,i,o,a){"use strict";var r=function(e){return a.get(e)},l={_getDeleteModalBody:function(t,s,i){var o=e.createElement("div"),l=s?"E6WCommonApps.Label.AreYouSureDeleteProject":"E6WCommonApps.Label.AreYouSureDelete";return l=i?"E6WCommonApps.Label.AreYouSureConstraint":l,e.createElement("p",{html:a.replace(r(l),{NAME:t})}).inject(o),s&&(this._deleteCheckBox=new n({type:"checkbox",label:r("E6WCommonApps.Label.DeleteSubprojects"),checked:!1,className:"primary"}).inject(o)),o},deleteItem:function(t){var n=e.clone(t||{},!1),o=n.model,d=n.parentView,c=n.modal||d&&d.getSuperModal(),p=o.get("title"),u=o instanceof s,h=o instanceof i,m=h?"E6WCommonApps.Label.ConfirmDeleteConstraint":"E6WCommonApps.Label.ConfirmDelete";c.dialog({body:l._getDeleteModalBody(p,u,h),title:a.replace(r(m),{NAME:p}),buttons:[{className:"primary",value:r("E6WCommonApps.Label.Delete"),action:function(e){n.isStructureDelete=u&&l._deleteCheckBox.isChecked(),l._destroyModelAndSetNewRoute(o,d,{isProject:u,isStructureDelete:u&&l._deleteCheckBox.isChecked()}),e.hide()}},{value:r("E6WCommonApps.Command.Cancel"),action:function(e){e.hide()}}]})},_destroyModelAndSetNewRoute:function(e,n,i){var l=i.isProject;s.justDeletedProjectID=e.get("@id"),setTimeout(function(){delete s.justDeletedProjectID},1e4),e.destroy({onComplete:function(){var s=a.replace(r("E6WCommonApps.Alert.ObjectDeleted"),{OBJECT_NAME:r("E6WCommonApps.Type."+e.getObjectType())});(t.displaySuccess(s),n&&n.closePropertyPanel&&n.closePropertyPanel(),l)&&e.getWorkscopes().forEach(function(e){e.unset(o.WORKSCOPE_PARENT_ATTR,{dontRegisterChange:!0})})},onFailure:function(){var n=a.replace(r("E6WCommonApps.Error.FailedToDeleteObject"),{OBJECT_NAME:r("E6WCommonApps.Type."+e.getObjectType())});t.displayError(n)},onTimeout:function(){l&&t.displaySuccess(r("E6WCommonApps.Label.ProjectDeleted"))},isStructureDelete:i.isStructureDelete})},restoreItem:function(e){var n=e.collection;n&&n.remove(e),e.restore({onComplete:function(){t.displaySuccess(r("E6WCommonApps.Alert.ProjectRestored"))},onFailure:function(){t.displayError(r("E6WCommonApps.Alert.RestoreFailed")),n.add(e)},onTimeout:function(){t.displaySuccess(r("E6WCommonApps.Alert.ProjectRestored"))}})}};return l}),define("DS/E6WCommonApps/Models/AssigneeTypeAhead",["UWA/Core","DS/E6WCommonApps/Models/E6WCommonAppsConstants","DS/Foundation2/Models/ReferenceModel","UWA/Class/Listener","DS/E6WCommonApps/Models/WorkscopeModel","DS/E6WCommonUI/PlatformManager","DS/RDFFoundation/RDFUtils","DS/E6WCommonApps/Collections/ProjectTeamCollection"],function(e,t,n,s,i,o,a,r){"use strict";var l=null,d={callback:function(t,n,s,i){var o=e.clone(i||{},!1).model;return n.length>0&&n.length<3&&l?d._buildTypeAhead(l,o,t,n,s):d._callback(o,t,n,s)},_callback:function(e,t,n,o){var r,c=function(e){return e.fetching},p=e.model,u=function(e){return e instanceof i?e:e.getParent()}(p);return u&&u.hasViewAccess()?((r=d.getTeamMembers(e.model)).fetch({onlyIfNeeded:!0,onComplete:function(i){if(i.some(c)){var a=new s;a.listenTo(i,"onFetchDone",function(){i.some(c)||(l=i,d._buildTypeAhead(i,e,t,n,o),a.stopListening())})}else l=i,d._buildTypeAhead(i,e,t,n,o)}}),r.fetching?{cancel:function(){}}:d._buildTypeAhead(r,e,t,n,o)):a.typeAheadCallback.call(this,t,n,o)},getTeamMembers:function(e){return new r(void 0,{workscope:e,uri:"/invoke/dsxplan:getProjectMembers"})},_buildTypeAhead:function(e,n,s,r,l){var d,c,p={cancel:function(){}};if(c=[],(d=e)&&!d.isEmpty()&&d.forEach(function(e){e.get("responsibility")!==t.RESPONSIBILITY_VIEWER&&c.push(e)}),e=c,r.length<3){var u=n.get("dsxplan:hasAssignee"),h=[];u=u||[],e.forEach(function(e){if(function(e,n,s){var a,r=s.get("memberPersonModel"),l=o.enableUserGroup()&&"foaf:Group"===r.getObjectType();if("pno:Person"===r.getObjectType()||l||r.getObjectType()===t.LOGICAL_USER_TYPE){var d=e instanceof i;a=-1===n.indexOf(s)&&s.id,d&&(a=a&&s.get("responsibility")===t.RESPONSIBILITY_LEADER)}return a}(n.getModelForAssigneeTypeahead(),u,e)){var s=e.get("memberPersonModel");s.getObjectType()===t.LOGICAL_USER_TYPE?h.push({value:s.id,label:s.get("title"),image:s.get("image"),sourceid:"3dplan"}):h.push({value:s.id,label:s.getFullName(),image:s.get("image"),login:s.get("ds6w:identifier"),sourceid:a.sourceFromService(s.serviceHosting)})}}),l(h)}else{var m={};e.forEach(function(e){var t=e.get("memberPersonModel");m[t.id]=!0});p=a.typeAheadCallback.call(this,s,r,function(e,t){var n=[],s=[];e.forEach(function(e){m[e.resourceUid]?n.push(e):s.push(e)});var i=n.concat(s);l(i,t)})}return p}};return d}),define("DS/E6WCommonApps/Views/DependencyGroupView",["UWA/Core","DS/E6WCommonUI/Views/DetailsDisplaySharedView","DS/E6WCommonApps/Views/ConstraintFieldView","DS/E6WCommonApps/Views/LinkLauncherUtils","DS/E6WCommonApps/Models/E6WCommonAppsConstants","i18n!DS/E6WCommonApps/assets/nls/E6WCommonAppsNLS"],function(e,t,n,s,i,o){"use strict";var a=t.extend({_uwaClassName:"DependencyGroupView",tagName:"div",className:"form-section accordion details-display-shared-view ddv-field form-group",domEvents:{"click .form-section-title":"_onGroupLabelClicked"},id:function(){return"DependencyGroup_"+this.cid},setup:function(t){this._parent.apply(this,arguments),this._dependencyi18n=o.get("E6WCommonApps.Label.Dependencies"),this._labelElem=e.createElement("label",{class:"top-label"}),this.container.setAttribute("data-field-index",1),this._setupGroupElements(),this._updateGroupTitle(),this._getVisibleModels=t.config.getVisibleModels,this._getModelsToFilter=t.config.getModelsToFilter,this.model&&this._listenToConstraints()},render:function(){return this._toConstraintView&&(this._toConstraintView.removeAutoCompleteFromDOM(),this._fromConstraintView.removeAutoCompleteFromDOM()),this.container.empty(!0),this._titleElem.inject(this.container),this._fieldContainer.inject(this.container),this._updateGroupTitle(),this._expanded&&this._drawConstraints(),this},resetModel:function(e){this._parent.apply(this,arguments),this._updateGroupTitle(),this._listenToConstraints(),this._fromConstraintView&&(this._fromConstraintView.resetModel(e),this._toConstraintView.resetModel(e))},toggleExpanded:function(e){this._expanded=void 0!==e?e:!this._expanded,this.render()},_getGroupTitle:function(){var e=this._dependencyi18n;if(this.model){var t=this.model.get("toConstraints")||this.model.get("predecessors"),n=t?t.length:0,s=this.model.get("fromConstraints")||this.model.get("successors");e+=" ("+((s?s.length:0)+n)+")"}return e},_updateGroupTitle:function(){this._titleElem.setText(this._getGroupTitle())},_drawConstraints:function(){this._fromConstraintView||this._setupConstraintViews(),this._fieldContainer.empty(!0),this._toConstraintView.render().inject(this._fieldContainer),this._fromConstraintView.render().inject(this._fieldContainer)},_listenToConstraints:function(){var e=this._updateGroupTitle.bind(this),t={"onChange:toConstraints":e,"onChange:fromConstraints":e};this.listenTo(this.model,t)},_onGroupLabelClicked:function(){if(this.toggleExpanded(),this._expanded){var e=this;this._animationFrameForScroll=requestAnimationFrame(function(){e._parentView.dispatchScrollToElementEvent(e.container),delete e._animationFrameForScroll})}},_setupGroupElements:function(){this._titleElem=e.createElement("div",{class:"form-section-title",html:this._getGroupTitle()}),this._fieldContainer=e.createElement("div",{class:"form-section-body"})},_setupConstraintViews:function(){var t=this,s=n.typeAheadCallback.bind(this,{modelId:t.model.id,getVisibleModels:t._getVisibleModels,getModelsToFilter:t._getModelsToFilter}),i=function(n){var i=e.merge(a.getConstraintFieldBasicConfig(t.model),n);return{i18n:o,isPropertyPanel:!0,model:t.model,config:e.merge(i,{typeAheadCallback:s})}},r=a.isModelProjectTask(t.model),l=r?"successors":"fromConstraints",d=r?"predecessors":"toConstraints",c=r?"typeicon":"successorImage",p=r?"typeicon":"predecessorImage",u=r?"title":"successorTitle",h=r?"title":"predecessorTitle";this._fromConstraintView=new n(i({name:l,label:o.get("E6WCommonApps.Label.Impacts"),searchTitle:o.get("E6WCommonApps.Label.Impacts"),attributeToDisplay:u,imageAttribute:c})),this._toConstraintView=new n(i({name:d,label:o.get("E6WCommonApps.Label.DependsOn"),searchTitle:o.get("E6WCommonApps.Label.DependsOn"),attributeToDisplay:h,imageAttribute:p})),this.addChildView(this._fromConstraintView),this.addChildView(this._toConstraintView),this.listenTo(this._parentView,"onScroll",()=>{this.dispatchEvent("onScroll")})},destroy:function(){void 0!==this._animationFrameForScroll&&(cancelAnimationFrame(this._animationFrameForScroll),delete this._animationFrameForScroll),this._parent.apply(this,arguments)}});return a.isModelProjectTask=function(e){return e&&e.isProjectTask&&e.isProjectTask()},a.getConstraintFieldBasicConfig=function(e){let t=e.get(i.RESTRICT_ASSIGNEE_ATTR);return{type:"object",readWrite:!a.isModelProjectTask(e)&&!t,minLengthBeforeAutocomplete:0,validateSameTenant:!0,searchSourceTypes:{"3dplan":["dsplan:Task","dsplan:Milestone"],swym:["swym:WeDo"]},searchSource:["3dplan","swym"],linkCallback:s.launchProperties,noOpenWith:!0}},a}),define("DS/E6WCommonApps/Views/RDFTaskDetailsPanelConfig",["UWA/Core","DS/RDFFoundation/RDFUtils","DS/RDFFoundation/FederatedSearchUtil","DS/E6WCommonApps/Models/E6WCommonAppsConstants","DS/RDFFoundation/SecurityContextUtils","DS/E6WCommonApps/Views/LinkLauncherUtils","DS/E6WCommonApps/SmartSchedulerUtils","DS/E6WCommonApps/Views/DependencyGroupView","DS/E6WCommonApps/Models/AssigneeTypeAhead","DS/E6WCommonApps/Models/WorkscopeModel","DS/E6WCommonApps/Views/FixedStartStopView","DS/E6WCommonApps/Views/E6WStartStopView","DS/E6WCommonUI/Views/StartStopView","DS/E6WCommonApps/Views/RichTextEditorView","DS/E6WCommonApps/Views/PriorityView","DS/E6WCommonUI/Models/DropValidator","DS/E6WCommonUI/Views/ObjectCardView","DS/RDFFoundation/Models/RDFCloneModel","DS/E6WCommonApps/FileUploadRepositoryUtil","DS/E6WCommonApps/Models/NoAccessModel","DS/E6WCommonApps/Views/E6WObjectCardView","DS/E6WCommonUI/UIHelper","DS/E6WCommonUI/PlatformManager","DS/E6WCommonApps/Views/E6WCustomUomView","DS/E6WCommonApps/Preferences","i18n!DS/E6WCommonApps/assets/nls/E6WCommonAppsNLS"],function(e,t,n,s,i,o,a,r,l,d,c,p,u,h,m,T,g,E,A,f,C,D,_,S,v,R){"use strict";var y=R.get.bind(R),M={config:function(e,i){var l=e.isComplete(),d=e.isStarted(),p=e.get(s.COMMON_TASK_PARENT_ATTR),u=D.isWedoTask(e.get(s.JS_TYPE_ATTR)),T=Boolean(p)||p&&"dsplan:DummyProject"!==p.id,g=v.getActiveBaselineModel(),E=e.get(s.HAS_SUB_TASKS),f=e.get(s.RESTRICT_ASSIGNEE_ATTR);var _=[{readWrite:!f,name:s.TITLE_ATTR,label:y("E6WCommonApps.Label.Title"),type:"text",maxLength:128,required:!0,removeCarriageReturns:!0,validate:!0},{readWrite:!f,name:s.DESCRIPTION_ATTR,label:y("E6WCommonApps.Label.Description"),type:"RichText",customView:h,numberOfDisplayLines:3,numberOfEditableLines:3},M.parentFieldConfig(e,f),{readWrite:!f,name:s.PRIORITY_ATTR,customView:m},{readWrite:!E&&"true",name:s.STATE_ATTR,label:y("E6WCommonApps.Label.MaturityState"),type:"select",validate:!0},{readWrite:!E&&"true",name:s.COMPLETE_PERCENT_ATTR,label:y("E6WCommonApps.Label.Percent"),type:"range",step:5,percents:!0},{readWrite:!f,name:d||l?s.ACTUAL_START_DATE:s.STARTDATE_ATTR,startDateLabel:y(d||l?"E6WCommonApps.Label.ActualStart":"E6WCommonApps.Label.PlannedStart"),canEditStartDate:function(e){var t=(d||l)&&E;return(e.isStartDateFixed()||d)&&!t},endDateAttribute:l?s.ACTUAL_END_DATE:s.ENDDATE_ATTR,endDateLabel:y(l?"E6WCommonApps.Label.ActualEnd":"E6WCommonApps.Label.PlannedEnd"),isStartDateManualAttribute:s.USER_DEFINED_START_DATE_ATTR,isEndDateManualAttribute:s.USER_DEFINED_END_DATE_ATTR,canEditEndDate:function(e){var t=l&&E;return(e.isEndDateFixed()||l)&&!t},type:"startStop",customView:c,validate:!0},M.durationFieldConfig(l,f),M.assigneeFieldConfig(e,f),M.attachmentFieldConfig,{readWrite:"true",name:s.ACTUAL_DELIVERABLE_ATTR,attributeToDisplay:"title",imageAttribute:"image",label:y("E6WCommonApps.Label.Deliverables"),searchTitle:y("E6WCommonApps.Label.SearchForDeliverables"),type:"object",customView:C,typeAheadCallback:t.typeAheadCallback,linkCallback:o.launchProperties,allowFileManagement:!0,placeHolder:y("E6WCommonApps.Label.ObjectPlaceHolder"),searchSource:n.filterSearchSources(["swym","3dspace","drive","geovia","3dportfolio"]),excludeSearchTypes:{"3dspace":["Person","Security Context","Business Role"],swym:["pno:Person","swym:WeDo"]},validateSameTenant:!0,limit:100,getDropDownMenuItems:a.getDocumentTypeDropDownMenuItems},{readWrite:Boolean(!u&&(D.isModelOwnerTheLoggedInUser(e)||e.model&&e.model.canDelete())),name:s.OWNER_ATTR,attributeToDisplay:"fullName",imageAttribute:"image",label:y("E6WCommonApps.Label.Owner"),searchSourceTypes:{swym:["pno:Person"]},customView:C,type:"person",searchSource:n.filterSearchSources(["swym"]),linkCallback:o.launchProperties,validateSameTenant:!0,typeAheadCallback:t.typeAheadCallback,singleObjectOnly:!0,disableRemove:!0,excludePendingUser:!0,searchTitle:y("E6WCommonApps.Label.ownerSearchTitle")},{name:s.CREATION_DATE_ATTR,label:y("E6WCommonApps.Label.Created"),type:"date"},{name:s.LASTUPDATED_ATTR,label:y("E6WCommonApps.Label.LastUpdated"),type:"date"},A.getRepositoryFieldConfig(f),A.getBookmarkForRepositoryFieldConfig(f),{name:"dependencies",customView:r}];T||_.pop();var S=_.findIndex(e=>e.name===s.COMPLETE_PERCENT_ATTR);if(d&&!l?_.splice(S+1,0,{readWrite:!1,name:s.STARTDATE_ATTR,startDateLabel:y("E6WCommonApps.Label.PlannedStart"),type:"startStop",labelPosition:"top"}):l&&_.splice(S+1,0,{readWrite:!1,name:s.STARTDATE_ATTR,startDateLabel:y("E6WCommonApps.Label.PlannedStart"),endDateAttribute:s.ENDDATE_ATTR,endDateLabel:y("E6WCommonApps.Label.PlannedEnd"),type:"startStop",labelPosition:"top"}),u?_.splice(3,0,{name:s.PARENT_HAS_SWYM_COMMUNITY,label:y("E6WCommonApps.Label.Community"),imageAttribute:"image",type:"object",customView:C,attributeToDisplay:"title",linkCallback:o.launchProperties,validateSameTenant:!0}):e.isLeanTask()&&_.splice(3,0,{name:s.PARENT_HAS_LEAN_BOARD,label:y("E6WCommonApps.Label.LeanBoard"),imageAttribute:"image",type:"object",customView:C,attributeToDisplay:"title",linkCallback:o.launchProperties,validateSameTenant:!0}),g&&v.getShowBaselines()){var R=g.getDataForModel(e);if(R){var I=R.state===s.BASELINE_STATE_IN_PROGRESS,b=R.state===s.BASELINE_STATE_DONE,O=_.findIndex(e=>e.name===s.DURATION_ESTIMATED_RANGE||e.name===s.DURATION);_.splice(O+1,0,{readWrite:!1,name:I||b?s.BASELINE_ACTUAL_START_DATE:s.BASELINE_ESTIMATED_START_DATE,startDateLabel:y(I||b?"E6WCommonApps.Label.BaselineActualStart":"E6WCommonApps.Label.BaselinePlannedStart"),endDateAttribute:b?s.BASELINE_ACTUAL_END_DATE:s.BASELINE_ESTIMATED_END_DATE,endDateLabel:y(b?"E6WCommonApps.Label.BaselineActualEnd":"E6WCommonApps.Label.BaselinePlannedEnd"),type:"startStop",labelPosition:"top"})}}return _}};return M.options={onFailure:function(e,t){if(t&&(t.msg||t.message)){var n=t.msg.replace("Error: ","");-1!==t.msg.indexOf("{")&&(t=JSON.parse(t.msg.trim())),t.message&&(n=t.message);var s=n.split("|");if(s.length>1){if("xPlan.Error.invalidReparenting"===(n=s[0])){var i=D.i18n("E6WCommonUI.Alert.ReparentingFailed");D.displayError(i)}}else"E6WCommonApps.Error.notALeader"===n?e.isStandaloneTask()?D.displayError(y("E6WCommonApps.Error.parentProjectChangeRefusedStandaloneTask")):D.displayError(y("E6WCommonApps.Error.parentProjectChangeRefused")):"xPlan.Error.InvalidParentChildConstraint"===n?D.displayError(y("E6WCommonApps.Error.InvalidParentChildConstraint")):D.displayError(y(n))}else"E6WCommonApps.Error.NoWedoModifyAccess"===t?D.displayError(y(t)):D.displayError(y("E6WCommonApps.Error.SaveFailed"))}},M.assigneeFieldConfig=function(e,t){var i,a;_.enableUserGroup()?(i={swym:["pno:Person"],usersgroup:["foaf:Group"]},a=n.filterSearchSources(["swym","usersgroup"])):(i={swym:["pno:Person"]},a=n.filterSearchSources(["swym"]));var r={readWrite:!t,name:s.ASSIGNEE_ATTR,attributeToDisplay:"fullName",imageAttribute:"image",label:y("E6WCommonApps.Label.Assignees"),searchSourceTypes:i,dropTypes:T.RDF_ASSIGNEE_DROP_TYPES,mask:"dsplan:MVMask.Person.Complex",typeAheadCallback:l.callback,type:"person",customView:C,searchSource:a,dropHandler:T.hasInvalidDroppedObject,linkCallback:o.launchProperties,minLengthBeforeAutocomplete:0,placeHolder:y("E6WCommonApps.Label.ObjectPlaceHolder"),validateSameTenant:!0,addMembers:!0,searchTitle:y("E6WCommonApps.Label.assigneeSearchTitle"),customButtons:[D.assignToSelfButtonConfig()]};return D.isWedoTask(e.get(s.JS_TYPE_ATTR))&&delete r.readWrite,r},M.durationFieldConfig=function(e,t){return e?{readWrite:!1,name:s.DURATION_ESTIMATED_RANGE,startDateLabel:y("E6WCommonApps.Label.Duration"),endDateAttribute:s.DURATION_ACTUAL,endDateLabel:y("E6WCommonApps.Label.ActualDuration"),type:"startStop",customView:p,labelPosition:"top"}:{readWrite:!t,name:s.DURATION,fieldLabel:y("E6WCommonApps.Label.Duration"),type:"uom",customView:S,uomValues:[y("E6WCommonApps.Label.Days"),y("E6WCommonApps.Label.Hours")],minimumValue:"0",toleranceName:s.DURATION_RANGE,toleranceLabel:y("E6WCommonApps.Label.PlusMinusOffset"),conversionTable:[1,8],validate:!0}},M.parentFieldConfig=function(e,t){return{readWrite:!(e.get(s.COMMON_TASK_PARENT_ATTR)instanceof f||t),name:s.COMMON_TASK_PARENT_ATTR,attributeToDisplay:"title",imageAttribute:"image",singleObjectOnly:!0,label:y("E6WCommonApps.Label.Parent"),typeAheadCallback:d.parentPlanTypeAhead,minLengthBeforeAutocomplete:2,type:"object",disableRemove:!0,customView:C,searchSourceTypes:{"3dplan":["dsplan:Project","dsplan:Task","dsplan:xProject"]},searchSource:"3dplan",searchTitle:y("E6WCommonApps.Label.Parent"),placeHolder:y("E6WCommonApps.Label.ObjectPlaceHolder"),dropHandler:d.processDropData,linkCallback:o.launchProperties,validateSameTenant:!0}},Object.defineProperty(M,"attachmentFieldConfig",{get:function(){return{readWrite:"true",name:s.ATTACHMENT_ATTR,attributeToDisplay:"title",imageAttribute:"image",label:y("E6WCommonApps.Label.Attachments"),searchTitle:y("E6WCommonApps.Label.SearchForAttachments"),type:"object",customView:C,typeAheadCallback:t.typeAheadCallback,linkCallback:o.launchProperties,allowFileManagement:!0,placeHolder:y("E6WCommonApps.Label.ObjectPlaceHolder"),searchSource:n.filterSearchSources(["swym","3dspace","drive","geovia","3dportfolio"]),excludeSearchTypes:{"3dspace":["Person","Security Context","Business Role"],swym:["pno:Person","swym:WeDo"]},validateSameTenant:!0,limit:100,getDropDownMenuItems:a.getDocumentTypeDropDownMenuItems}}}),M}),define("DS/E6WCommonApps/Models/TaskValidator",["UWA/Core","UWA/Class","DS/E6WCommonApps/Models/E6WCommonAppsConstants"],function(e,t,n){"use strict";return t.extend({_uwaClassName:"TaskValidator",_attributesGet:function(e,t){var n;return e&&(n=e[t]),n||this.get(t)},_validateDuration:function(e,t){var s=!0,i=this._attributesGet(e,n.DURATION),o=this._attributesGet(e,n.DURATION_RANGE);return(i<0||o<0||(void 0===i||void 0===o)||i-o<0||isNaN(i)||isNaN(o))&&(t.fields.push(n.DURATION),t.fields.push(n.DURATION_RANGE),t.fields.push(n.DURATION_MIN),t.fields.push(n.DURATION_MAX),s=!1),s},_validateActualDates:function(e,t){var s=!0,i=this._attributesGet(e,n.STATE_ATTR),o=this.get(n.ACTUAL_START_DATE),a=new Date;return o&&o.actualValue>a&&i!==n.STATE_OPEN&&(t.fields.push(n.ACTUAL_START_DATE),s=!1),(o=this.get(n.ACTUAL_END_DATE))&&o.actualValue>a&&i===n.STATE_DONE&&(t.fields.push(n.ACTUAL_END_DATE),s=!1),s},_validateEstimatedDates:function(e,t){var s=this.getStartDate(e);s=s&&s.actualValue||s;var i=this.getEndDate(e);i=i&&i.actualValue||i;var o=this._validateStartDate(s,e,t),a=this._validateEndDate(i,e,t);return s>i&&!this.isStartOrEndDateAutomatic(e)?(t.fields.push(this.isStarted(e)?n.ACTUAL_START_DATE:n.STARTDATE_ATTR),t.fields.push(this.isComplete(e)?n.ACTUAL_END_DATE:n.ENDDATE_ATTR),!1):o&&a},_validateStartDate:function(e,t,s){return!(this.isStartDateFixed(t)&&(!e||isNaN(e.getTime())))||(s.fields.push(this.isStarted(t)?n.ACTUAL_START_DATE:n.STARTDATE_ATTR),!1)},_validateEndDate:function(e,t,s){return!(this.isEndDateFixed(t)&&(!e||isNaN(e.getTime())))||(s.fields.push(this.isComplete(t)?n.ACTUAL_END_DATE:n.ENDDATE_ATTR),!1)},validate:function(e){var t={fields:[]},s=!0;s=this._validateDuration(e,t);var i=this._validateActualDates(e,t);s=s&&i,i=this._validateEstimatedDates(e,t),s=s&&i;var o=this._attributesGet(e,n.TITLE_ATTR);if(null==o&&(o=this._attributesGet(e,n.DSLC_TITLE_ATTR)),o&&o.trim().length||(t.fields.push(n.TITLE_ATTR),s=!1),!s)return t},getStartDate:function(t){var s;return s=(s=this.isStarted(t)&&this._attributesGet(t,n.ACTUAL_START_DATE)||this._attributesGet(t,n.STARTDATE_ATTR))&&e.is(s,"string")?new Date(s):s},getEndDate:function(t){var s;return s=(s=this.isComplete(t)&&this._attributesGet(t,n.ACTUAL_END_DATE)||this._attributesGet(t,n.ENDDATE_ATTR))&&e.is(s,"string")?new Date(s):s},isComplete:function(e){return this._attributesGet(e,n.STATE_ATTR)===n.STATE_DONE},isStarted:function(e){return this.isComplete(e)||this._attributesGet(e,n.STATE_ATTR)===n.STATE_IN_PROGRESS},isFixed:function(e){return this._attributesGet(e,n.USER_DEFINED_DATES_ATTR)||this.isStartDateFixed(e)||this.isEndDateFixed(e)},isStartDateFixed:function(e){return this._attributesGet(e,n.USER_DEFINED_START_DATE_ATTR)},isEndDateFixed:function(e){return this._attributesGet(e,n.USER_DEFINED_END_DATE_ATTR)},isStartDateAutomatic:function(e){return!this.isStartDateFixed(e)&&!this.isStarted(e)},isEndDateAutomatic:function(e){return!this.isEndDateFixed(e)&&!this.isComplete(e)},isStartOrEndDateAutomatic:function(e){return this.isStartDateAutomatic(e)||this.isEndDateAutomatic(e)}})}),define("DS/E6WCommonApps/Models/RDFTaskCloneModel",["UWA/Core","DS/E6WCommonApps/Models/E6WCommonAppsConstants","DS/E6WCommonUI/UIHelper","DS/E6WCommonUI/PlatformManager","DS/E6WCommonApps/Models/ScheduleElementCloneModel","DS/E6WCommonApps/Models/RDFTaskModel","DS/E6WCommonApps/ReparentingUtils","DS/E6WCommonApps/E6WNonWorkingDayIterator","DS/E6WCommonApps/Preferences","DS/RDFFoundation/MemberUtils","DS/RDFFoundation/Models/ResultModel","DS/RDFFoundation/RDFUtils","DS/E6WCommonApps/Models/TaskValidator","i18n!DS/E6WCommonApps/assets/nls/E6WCommonAppsNLS"],function(e,t,n,s,i,o,a,r,l,d,c,p,u,h){"use strict";var m=function(e){return h.get(e)};return i.extend(u,{_uwaClassName:"RDFTaskCloneModel",getWorkDayLength:function(){return this.model.getWorkDayLength()},_updateRanges:function(e,n,s){var i=this.get(t.DURATION),o=this.get(t.DURATION_RANGE),a=s&&s.settingDuration,r=s&&s.settingRange;!a&&i!==e&&this.dispatchEvent("onChange:"+t.DURATION,[this,i]),!r&&o!==n&&this.dispatchEvent("onChange:"+t.DURATION_RANGE,[this,o]),this.validationError=this.validate(this.toJSON()),this.validationError?this.dispatchEvent("onValidationFailure"):this.dispatchEvent("onValidationSuccess")},init:function(){this._parent.apply(this,arguments),this.nonWorkingDayIterator=new r;var e={};e["onChange:"+t.DURATION_MAX]=e["onChange:"+t.DURATION_MIN]=function(e,t,n){this._updateRanges(void 0,void 0,n)},this.listenTo(this,e)},toJSON:function(){var e=this._parent.apply(this,arguments);return e[t.DURATION]=this.get(t.DURATION),e[t.DURATION_RANGE]=this.get(t.DURATION_RANGE),e[t.DURATION_ESTIMATED]=this.get(t.DURATION_ESTIMATED),e},dataForRendering:function(e){var n=this._parent.apply(this,arguments);n[t.DURATION]=this.get(t.DURATION),n[t.DURATION_RANGE]=this.get(t.DURATION_RANGE),n[t.DURATION_ESTIMATED]=this.get(t.DURATION_ESTIMATED),n[t.DURATION_ESTIMATED_RANGE]=this.get(t.DURATION_ESTIMATED_RANGE),n[t.DURATION_ACTUAL]=this.get(t.DURATION_ACTUAL),n[t.ESTIMATED_DATE_ATTR]=this.get(t.ESTIMATED_DATE_ATTR),n[t.STARTDATE_ATTR]=this.get(t.STARTDATE_ATTR),n[t.ENDDATE_ATTR]=this.get(t.ENDDATE_ATTR),n[t.ACTUAL_START_DATE]=this.get(t.ACTUAL_START_DATE),n[t.ACTUAL_END_DATE]=this.get(t.ACTUAL_END_DATE),n[t.BASELINE_ESTIMATED_START_DATE]=this.get(t.BASELINE_ESTIMATED_START_DATE),n[t.BASELINE_ESTIMATED_END_DATE]=this.get(t.BASELINE_ESTIMATED_END_DATE),n[t.BASELINE_ACTUAL_START_DATE]=this.get(t.BASELINE_ACTUAL_START_DATE),n[t.BASELINE_ACTUAL_END_DATE]=this.get(t.BASELINE_ACTUAL_END_DATE),n[t.CREATION_DATE_ATTR]=this.get(t.CREATION_DATE_ATTR),n[t.LASTUPDATED_ATTR]=this.get(t.LASTUPDATED_ATTR);var s=n[t.COMMON_TASK_PARENT_ATTR];if(s&&"dsplan:DummyProject"===s.physicalId)n[t.COMMON_TASK_PARENT_ATTR]=[];else if(e.attributes.includes(t.COMMON_TASK_PARENT_ATTR)){var i=this.get(t.COMMON_TASK_PARENT_ATTR);i&&"dsplan:DummyProject"!==i.id&&(n[t.COMMON_TASK_PARENT_ATTR]=[i.toJSON(e)])}return n},get:function(s){switch(s){case t.DURATION:return this.getDuration();case t.DURATION_ACTUAL:return this.getFormattedActualDuration();case t.DURATION_RANGE:return this.getDurationOffset();case t.DURATION_ESTIMATED_RANGE:return this.getDurationRangeFormat(this.getDuration(),this.getDurationOffset());case t.BASELINE_ESTIMATED_START_DATE:return l.getBaselineFormattedDate("start",this.model);case t.BASELINE_ESTIMATED_END_DATE:return l.getBaselineFormattedDate("end",this.model);case t.BASELINE_ACTUAL_START_DATE:return l.getBaselineFormattedDate("actualStart",this.model);case t.BASELINE_ACTUAL_END_DATE:return l.getBaselineFormattedDate("actualEnd",this.model)}var i=this._parent.apply(this,arguments);if(i)switch(s){case t.ESTIMATED_DATE_ATTR:case t.ENDDATE_ATTR:case t.STARTDATE_ATTR:case t.ACTUAL_START_DATE:case t.ACTUAL_END_DATE:i=n.getIntlDateFormat(i);break;case t.CREATION_DATE_ATTR:case t.LASTUPDATED_ATTR:i=n.getIntlDateTimeFormat(i);break;case t.DURATION_ESTIMATED:case t.DURATION_MIN:case t.DURATION_MAX:i=p.xsdDayTimeDurationToMilliseconds(i)/(60*this.getWorkDayLength()*60*1e3);break;case t.STATE_ATTR:return e.is(i,"object")&&!enoviaServer.useFD01CodeFor3DPlan?i.id:i}return i},getFormattedActualDuration:function(){var e,n=this.get(t.ACTUAL_START_DATE),s=this.get(t.ACTUAL_END_DATE);if(n&&s){var i=this.nonWorkingDayIterator.countWorkingDays(n.actualValue,s.actualValue)+" "+m("E6WCommonApps.Label.Days");e={actualValue:i,displayValue:i}}return e},getDurationRangeFormat:function(e,t){let n=e+" "+m("E6WCommonApps.Label.Days")+" "+m("E6WCommonApps.Label.PlusMinusOffset")+" "+t;return{actualValue:n,displayValue:n}},getDurationOffset:function(){var e=i.prototype.get.call(this,t.DURATION_RANGE);if(void 0===e){var n=this.get(t.DURATION_MIN),s=this.get(t.DURATION_MAX);void 0!==n&&void 0!==s||(e=0),e=(s-n)/2}return e},getDuration:function(){var e=i.prototype.get.call(this,t.DURATION);if(void 0===e){var n=this.get(t.DURATION_MIN),s=this.get(t.DURATION_MAX);e=void 0===n?s:void 0===s?n:(n+s)/2}return e},_setDuration:function(n,s,i){var o,a,r;o=!1;var l=s,d=e.clone(i||{},!1),c=d&&d.whisper;c&&delete d.silent;var p,u=d&&d.silent;if(n===t.DURATION_MIN||n===t.DURATION_MAX){var h=this.get(t.DURATION),m=this.get(t.DURATION_RANGE);l=this.model.getDaysAsString(s),this.cleanupLocalAttributes(),o=d.parent.call(this,n,l,d);var T=d.settingDuration;!d.settingRange&&!T&&this._updateRanges(h,m,d),o={handled:!0,returnValue:o}}else n===t.DURATION?(e.is(s,"string")&&(l=parseFloat(s,10)),r=this.get(t.DURATION_RANGE),a=l,d.settingDuration=!0,p=d.validate,d.validate=!1,o=this._setComputedMinAndMaxVal(a,r,d),d.validate=p,d.parent.call(this,n,l,d),u||c||this.dispatchEvent("onChange:"+t.DURATION,[this,l,d]),o={handled:!0,returnValue:o}):n===t.DURATION_RANGE&&(e.is(s,"string")&&(l=parseFloat(s,10)),a=this.get(t.DURATION),r=l,d.settingRange=!0,p=d.validate,d.validate=!1,o=this._setComputedMinAndMaxVal(a,r,d),d.validate=p,d.parent.call(this,n,l,d),u||c||this.dispatchEvent("onChange:"+t.DURATION_RANGE,[this,l,d]),o={handled:!0,returnValue:o});return o},add:function(s,i,r){var l,d;if(s!==t.COMMON_TASK_PARENT_ATTR||(r&&(r.isObject=!(i instanceof e.Class.Model||i instanceof FileList||i instanceof File)),(l=this.getDetailedObjectToBeAdded(s,i,r))&&(d=l.getObjectType()),!d||d!==t.TASK||p.removeBracketLongURI(i)!==p.removeBracketLongURI(this.model.id))){var c=this._parent.apply(this,arguments),u=Array.prototype.slice.call(arguments,0);if(s===t.COMMON_TASK_PARENT_ATTR&&d&&d!==t.OBJECT){if(d===t.TASK){var m=this,T={};T.parentId=i,T.childId=this.model.id,T.type=o,T.onComplete=function(e){if(e["@value"]||e.value){var s=u[2].dropObj,i=r.detailedObjects,o=i?i[0].label:s.displayName,a=h.replace(n.i18n("E6WCommonUI.Alert.ChildIsAlreadyInParentStructure"),{PARENT_NAME:o,CHILD_NAME:m.model.get("title")});n.displayError(a),m.remove(t.PARENT_ATTR,void 0,r)}else m.remove(t.PARENT_ATTR,void 0,r),m.add(t.TASK_PARENT_ATTR,m.id,r)},a.checkParentHierarchyForId(T)}d!==t.PROJECT&&d!==t.XPROJECT||(this.remove(t.TASK_PARENT_ATTR,void 0,r),this.add(t.PARENT_ATTR,l.id,r))}return c}n.displayError(n.i18n("E6WCommonUI.Alert.PlanOwnChild"))},isProjectTask:function(){return this.model.isProjectTask()},isStandaloneTask:function(){return Boolean(!this.get(t.HAS_PARENT_ATTR))},set:function(s,i,o){var a=i,r=e.clone(o||{},!1);r.parent=this._parent;var l,d=this._setDuration(s,i,r);if(delete r.parent,d.handled)return d.returnValue;if(((l=s)===t.ENDDATE_ATTR||l===t.STARTDATE_ATTR||l===t.ACTUAL_START_DATE||l===t.ACTUAL_END_DATE)&&a&&a.actualValue&&(a=new Date(a.actualValue)),(s===t.STATE_ATTR&&!enoviaServer.useFD01CodeFor3DPlan||s===t.PRIORITY_ATTR)&&(a=a&&a.actualValue?a.actualValue:a)&&(a=p.getObjectForAdding(c,a)),s===t.STATE_ATTR&&i&&i.actualValue&&i.actualValue===t.STATE_IN_PROGRESS&&void 0===this.get(t.ACTUAL_START_DATE)){var u=this.get(t.PARENT_ATTR);if(u&&n.isProject(u.get(t.TYPE_ATTR))){var h=u.get(t.ACTUAL_DATES_STRATEGY_ATTR);if(h&&h.toString()===t.PLANNED_DATES_STRATEGY){var m=this.get(t.STARTDATE_ATTR);if(m){var T=new Date(m.actualValue),g=new Date,E=T<g?m:g;this.set(t.ACTUAL_START_DATE,E,r)}}else this.set(t.ACTUAL_START_DATE,new Date,r)}else this.isStandaloneTask()&&this.set(t.ACTUAL_START_DATE,new Date,r)}s===t.STATE_ATTR&&i&&i.actualValue&&i.actualValue===t.STATE_OPEN&&void 0!==this.get(t.ACTUAL_START_DATE)&&delete this.localAttributes[t.ACTUAL_START_DATE];var A=this._parent(s,a,o);return s!==t.USER_DEFINED_START_DATE_ATTR&&s!==t.USER_DEFINED_END_DATE_ATTR||this.dispatchEvent("onChange:"+s,[this,a,r]),A},remove:function(e,n,s){if(e===t.COMMON_TASK_PARENT_ATTR){var i=this.get(e);if(i){var o=i.getObjectType()===t.TASK?t.TASK_PARENT_ATTR:t.PARENT_ATTR;this.remove(o,i.id,s)}}this._parent(e,n,s)},_setComputedMinAndMaxVal:function(n,s,i){var o=i&&i.silent,a=e.clone(i||{},!1),r=n-s,l=n+s,d=this.modificationsPending;this.modificationsPending=!0,o||d===this.modificationsPending||this.dispatchEvent("onChange:modificationsPending",[this]);var c=a.validate;a.validate=!1;var p=!isNaN(r)&&this.set(t.DURATION_MIN,r,a),u=!isNaN(l)&&this.set(t.DURATION_MAX,l,a);a.validate=c;var h,m,T=new Date(this.getStartDate()&&(this.getStartDate().actualValue||this.getStartDate()));if(this.isEndDateFixed()){if(!this.isStarted()&&!this.isStartDateFixed()){var g=this.get(t.ENDDATE_ATTR);g=g&&(g.actualValue||g),(T=new Date(g)).setDate(T.getDate()-(l+r)/2),h=T,m=t.STARTDATE_ATTR}}else{var E=new Date(T);E.setDate(T.getDate()+(l+r)/2),h=E,m=t.ENDDATE_ATTR}return this.set(m,h,a),a.whisper&&(delete a.detailsDisplayViewDebounce,this.dispatchEvent("onChange:"+m,[this,h,a])),this.set(t.DURATION_ESTIMATED,this.model.getDaysAsString(n),a),p&&u},cleanupLocalAttributes:function(){delete this.localAttributes[t.DURATION],delete this.localAttributes[t.DURATION_RANGE],delete this.localAttributes[t.COMMON_TASK_PARENT_ATTR],delete this.localRelatedData[t.COMMON_TASK_PARENT_ATTR]},save:function(t){this.cleanupLocalAttributes();var n=Array.prototype.slice.call(arguments,0),s=e.clone(t||{},!1);return n[0]=s,s.animate=!0,this._parent.apply(this,n)},isWedo:function(){return Boolean(this.get(t.PARENT_HAS_SWYM_COMMUNITY))},isLeanTask:function(){return Boolean(this.get(t.PARENT_HAS_LEAN_BOARD))},getModelForAssigneeTypeahead:function(){return this},assignToSelf:function(e){this.add(t.ASSIGNEE_ATTR,d.addUUIDToURI(s.getContextUserUid()),e)}})});