define("DS/ENODerivedFormatManagement/Views/DerivedFormatListView",["DS/Handlebars/Handlebars","UWA/Class/View","DS/Controls/Toggle","DS/Controls/ButtonGroup","DS/Controls/Popup","DS/UIKIT/Input/Button","DS/UIKIT/Popover","DS/UIKIT/Dropdown","DS/Utilities/Dom","DS/Tree/TreeDocument","DS/Tree/TreeNodeModel","DS/TreeModel/DataModelSet","DS/TreeModel/BaseFilter","DS/DataGridView/DataGridView","DS/ENODerivedFormatManagement/Collections/DerivedFormatRules","DS/ENODerivedFormatManagement/Views/Tbar","DS/ENODerivedFormatManagement/Views/DerivedFormatCreate","DS/ENODerivedFormatManagement/Views/ParamListView","DS/ENODerivedFormatManagement/Views/ParamListFormattedView","DS/UIKIT/Input/Button","DS/ENODerivedFormatManagement/Utils/DerivedFormatUtil","DS/ENO6WPlugins/jQuery","DS/ENO6WPlugins/jQueryUI","css!DS/ENODerivedFormatManagement/ENODerivedFormatManagement"],function(e,t,a,n,o,i,r,l,d,s,c,m,u,g,p,v,f,D,b,S,w,h,y){var N,T,L;return t.extend({tagName:"div",className:"edfm-formatlistview",tapedTwice:!1,setup:function(e){var t=this;derivedformatmanagementinfra.servererror||(t.setupTbar(),t.setupListView(),t.setupApplyResetToolbar(),widget.addEvent("onResize",t.adjust)),this.listenTo(t.collection,"onAdd",t.derivedFormatRuleCreatePostProcess.bind(null,t)),this.listenTo(t.collection,"onChange",t.derivedFormatRuleEditPostProcess.bind(null,t)),this.listenTo(t.collection,"onRemove",t.derivedFormatRuleDeletePostProcess.bind(null))},render:function(e){return e&&e.container&&this.container.inject(e.container),this},setupApplyResetToolbar:function(){var e,t,a,n,o,i=this;return e=UWA.createElement("div",{class:"dfm-list-applyResetDiv",styles:{bottom:"0",right:"0",position:"fixed"}}).inject(i.container),t=UWA.createElement("table",{class:"",id:"",width:"100%"}).inject(e),a=UWA.createElement("tr").inject(t),n=UWA.createElement("td",{width:"45%",Align:"left"}).inject(a),new S({className:"primary",id:"buttonExport",icon:"export",attributes:{disabled:!1,title:derivedformatmanagementinfra.getNLSData().button.applyTitle,text:derivedformatmanagementinfra.getNLSData().button.apply},events:{onClick:function(){i.applyParams(i)}}}).inject(n).getContent().setStyle("width",130),o=UWA.createElement("td",{width:"45%",Align:"right"}).inject(a),new S({className:"warning",icon:"loop",attributes:{disabled:!1,title:derivedformatmanagementinfra.getNLSData().button.resetTitle,text:derivedformatmanagementinfra.getNLSData().button.reset},events:{onClick:function(){i.resetButton(i)}}}).inject(o).getContent().setStyle("width",130),e},applyParams:function(e){e.collection.length&&e.collection.applyRules()},resetButton:function(e){var t=L.getChildren(),a=new Array;if(t){for(idx=0;idx<t.length;idx++)node=t[idx].options.grid,a.push(node);e.collection.remove(a)}e.collection.fetch()},setupTbar:function(){var e=this;new v({actions:[{icon:"plus",label:derivedformatmanagementinfra.getNLSData().button.addRule,hasAccess:!0,handler:e.createDerivedFormatRule.bind(null,e)},{icon:"trash",label:derivedformatmanagementinfra.getNLSData().button.deleteRule,hasAccess:!0,handler:e.deleteDerivedFormatRule.bind(null,e)}]}).render({container:e.container})},createDerivedFormatRule:function(e){new f({collection:e.collection,event:e.event}).render({container:void 0})},deleteDerivedFormatRule:function(e){var t=L.getSelectedNodes(),a=new Array,n=new Array,o=!1;if(t)for(var i=t.length,r=0;r<i;r++){var l=t[r],d=e.collection.get(l.options.grid);"deleted"!=d.get("action")&&(d.id?(o=!0,n.push(d)):a.push(d))}o?w.confimationModal(function(t){e.collection.setToBeDeleted(n),e.collection.remove(a),t.hide()},"delete"):e.collection.remove(a)},setupListView:function(){var e=this;T=new m,L=new s({dataModelSet:T}),_formatListViewDiv=UWA.createElement("div",{class:"dfm-list-view",styles:{}}).inject(e.container),N=new g({scrollable:!0,treeDocument:L,cellSelection:"none",height:widget.body.clientHeight-130,rowSelection:"multiple",columns:[{text:derivedformatmanagementinfra.getNLSData().label.converter,dataIndex:"converter"},{text:derivedformatmanagementinfra.getNLSData().label.connector,dataIndex:"connector"},{text:derivedformatmanagementinfra.getNLSData().label.type,dataIndex:"source"},{text:derivedformatmanagementinfra.getNLSData().label.format,dataIndex:"target",typeRepresentation:"url",getCellValue:function(e){if(e.nodeModel&&e.nodeModel.getAttributeValue("inputstreamid")){var t=e.nodeModel.getAttributeValue("inputstreamid").toLowerCase(),a=e.nodeModel.getAttributeValue("target");return"authoring"!==t?{icon:"attention",label:a}:{label:a}}}},{text:derivedformatmanagementinfra.getNLSData().label.parameters,dataIndex:"parameters",allowUnsafeHTMLContent:!0},{text:derivedformatmanagementinfra.getNLSData().label.alias,dataIndex:"alias"},{text:derivedformatmanagementinfra.getNLSData().label.event,dataIndex:"eventDisplay"},{text:derivedformatmanagementinfra.getNLSData().label.activation,dataIndex:"activation"},{text:derivedformatmanagementinfra.getNLSData().label.deployStatus,dataIndex:"status",typeRepresentation:"icon",width:"10%"}],defaultColumnDef:{width:"auto",typeRepresentation:"string",editableFlag:!1,resizableFlag:!0,sortableFlag:!0},getCellTooltip:function(t){if(8===t.columnID&&t.nodeModel&&t.nodeModel.options.grid){var a="",n=e.collection.get(t.nodeModel.options.grid);return{shortHelp:a=derivedformatmanagementinfra.getNLSData().button[n.get("action")],mouseRelativePosition:!0}}if(3===t.columnID&&t.nodeModel&&t.nodeModel.options.grid&&t.nodeModel.getAttributeValue("inputstreamid")){var o=t.nodeModel.getAttributeValue("inputstreamid").toLowerCase(),i=t.nodeModel.getAttributeValue("datatype").toLowerCase(),r=t.nodeModel.getAttributeValue("sourceformat").toLowerCase();if("authoring"!==o){if(i||("slddrw"===r||"catdrawing"===r||"dwg"===r?i="drawing":"sldprt"!==r&&"catpart"!==r&&"catpart"!==r&&"itp"!==r&&"prt"!==r||(i="part")),a=derivedformatmanagementinfra.getNLSData().label[o+i])return{shortHelp:a=a.replace("%1",t.nodeModel.getAttributeValue("target")),mouseRelativePosition:!0}}else N.getCellDefaultTooltip(t)}else N.getCellDefaultTooltip(t)}}).inject(_formatListViewDiv),d.addEventOnElement(N,N,"click",function(t,a){if(!e.tapedTwice)return e.tapedTwice=!0,setTimeout(function(){e.tapedTwice=!1},600),!1;var n=a.nodeModel.options.grid,o=e.collection.get(n);"deleted"!=o.get("action")&&new f({event:e.event,collection:e.collection,container:void 0,selection:o}).render()}),e.customizeLayout()},customizeLayout:function(){N.layout.columnHeaderHeight=40,N.layout.cellHeight=35,N.layout.collectionView.showRowBorderFlag=!0},getDeployStatusIcon:function(e){var t,a=this,n=e.get("action");switch(n){case"deployed":t=a.buildImgSpan("check","green",n);break;case"notdeployed":t=a.buildImgSpan("cog","orange",n);break;case"created":t=a.buildImgSpan("cog","black",n);break;case"updated":t=a.buildImgSpan("pencil","orange",n);break;case"deleted":t=a.buildImgSpan("trash","red",n)}return t},buildImgSpan:function(e,t,a){return"fonticon fonticon-1x fonticon-"+e+" dfm-action-icon-"+t},derivedFormatRuleCreatePostProcess:function(e,t){var a=t.get("converter"),n=t.get("target");derivedformatmanagementinfra.getNLSData()[a]&&derivedformatmanagementinfra.getNLSData()[a].target[n]&&(n=derivedformatmanagementinfra.getNLSData()[a].target[n]),L.prepareUpdate();var o=new b({model:t}),i=t.get("eventToDisplay"),r=t.get("stateToDisplay");i=r?i+" â†’ "+r:i;var l=e.getDeployStatusIcon(t),d=t.get("sourceToDisplay"),s={id:t.id,cid:t.cid,converter:a,source:d,target:n,inputstreamid:t.get("inputStreamId"),datatype:t.get("sourceType"),parameters:o.getContent().outerHTML,alias:t.get("outputStreamId"),event:t.get("event"),eventDisplay:i,connector:t.get("category"),status:l,activation:derivedformatmanagementinfra.getNLSData().label[t.get("activation")],sourceformat:t.get("source")},m=c.createTreeNodeDataModel(T,{label:s.text,grid:s});L.addChild(m),L.pushUpdate()},derivedFormatRuleEditPostProcess:function(e,t){L.prepareUpdate();for(var a=L.getChildren(),n=a.length,o=0;o<n;o++){var i=a[o];if(i.options.grid.cid==t.cid){var r=e.getDeployStatusIcon(t);i.updateOptions({grid:{parameters:new b({model:t}).getContent().outerHTML,status:r,alias:t.get("outputStreamId")}});break}}L.pushUpdate()},derivedFormatRuleDeletePostProcess:function(e){L.prepareUpdate();for(var t=L.getChildren(),a=t.length,n=0;n<a;n++){var o=t[n],i=o.options.grid.id,r=o.options.grid.cid;if(i&&i==e.id){o.remove();break}if(r&&r==e.cid){o.remove();break}}L.pushUpdate()},adjust:function(){N.height=document.getElementsByClassName("facetviews")[1].clientHeight-90}})});