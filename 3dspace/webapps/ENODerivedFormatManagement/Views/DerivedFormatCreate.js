define("DS/ENODerivedFormatManagement/Views/DerivedFormatCreate",["UWA/Class/View","DS/Handlebars/Handlebars","DS/UIKIT/Input/Select","DS/UIKIT/Form","DS/UIKIT/SuperModal","DS/ENODerivedFormatManagement/Models/DerivedFormatRule","DS/ENODerivedFormatManagement/Views/ParamListView","text!DS/ENODerivedFormatManagement/assets/templates/edfm.formatparams.html","text!DS/ENODerivedFormatManagement/assets/templates/edfm.form.html","DS/ENODerivedFormatManagement/Utils/DerivedFormatUtil","DS/ENO6WPlugins/jQuery","DS/ENO6WPlugins/jQueryUI","DS/Controls/TooltipModel"],function(e,t,n,a,r,i,o,d,l,s,c,m,u){var f,v,g;return e.extend({className:"derivedformatformview",viewMe:this,disableFields:!1,id:function(){return"derivedformatformview"},setup:function(e){var t=this;t.selection=e.selection,t.superModal=new r,t.superModal.dialog({closable:!0,body:t.getForm(),title:t.selection?derivedformatmanagementinfra.getNLSData().label.editRuleTitle:derivedformatmanagementinfra.getNLSData().label.createRuleTitle}),t.setupEvent()},setupEvent:function(){var e=this;viewMe=this,f.getDocument().getElementById("derivedformatfield-converter").addEventListener("change",e.resetConverterForms.bind(null,e)),f.getDocument().getElementById("derivedformatfield-connector").addEventListener("change",e.resetFormFields.bind(null,e)),f.getDocument().getElementById("derivedformatfield-event").addEventListener("change",e.switchEventField.bind(null,e)),f.getDocument().getElementById("derivedformatfield-source").addEventListener("change",e.switchSourceFormat.bind(null,e)),f.getDocument().getElementById("derivedformatfield-target").addEventListener("change",e.switchTargetFormat.bind(null,e)),f.getDocument().getElementById("btnActionSubmit").addEventListener("click",e.save.bind(null,e)),f.getDocument().getElementById("btnActionCancel").addEventListener("click",e.cancel.bind(null,e)),e.switchEventField(),e.switchTargetFormat()},populateData:function(e,t){for(var n in e.innerText=null,t){var a=new Option(t[n].label,t[n].value);t[n].selected&&(a.selected=!0),e.add(a)}},populateSourceData:function(e,t){for(var n in e.innerText=null,t){var a=new Option(t[n].label,t[n].value);t[n].selected&&(a.selected=!0),t[n].partExtension&&(a.dataset.partExtension=t[n].partExtension),a.dataset.type=t[n].type,e.add(a)}},populateEventData:function(e,t){for(var n in e.innerText=null,t){var a=new Option(t[n].label,t[n].value);a.lifecycle=t[n].lifecycle,e.add(a)}},refresh:function(){},getForm:function(){v=new o({selection:(g=this).selection,parameters:g.selection?g.selection.get("parameters"):{}});var e,n,a,r,i,s,c,m,u;t.compile(d);f=UWA.createElement("div",{id:"divCreateDerivedFormatFormContainer"}),g.selection&&(g.disableFields=!0,e=g.selection.get("converter"),n=g.selection.get("category"),a=g.selection.get("source"),r=g.selection.get("target"),i=g.selection.get("event"),s=g.selection.get("inputStreamId"),c=g.selection.get("outputStreamId"),m=g.selection.get("partExtension"),u=g.selection.get("sourceType"));var g,p=t.compile(l),y=(g=this).getConverters();e||(e=y.find(e=>e.selected).value);var E=g.getConnectors(e);n||(n=E.find(e=>e.selected).value);var D=g.getSourceFormats(e,n);a||(a=D.find(e=>e.selected).value,u=D.find(e=>e.selected).type,m=D.find(e=>e.selected).partExtension);var I=g.getEvents(e,n);i||(i=I.find(e=>e.selected).value);var h=g.getTargetFormats(e,n,a,u);if(r||(r=h.find(e=>e.selected).value),!s||!c){var w=g.getStreamIds(e,n,a,u,r);s=w.inputStreamId,c=w.outputStreamId}return f.setHTML(p({labels:derivedformatmanagementinfra.getNLSData().label,buttons:derivedformatmanagementinfra.getNLSData().button,converters:y,connectors:E,events:g.getEvents(e,n),activation:g.getActivation(e,n,i),states:g.getStates(e,n,a),sources:D,sourceFormat:a,targets:h,disableFields:g.disableFields,inputStreamId:g.inputStreamId,outputStreamId:g.outputStreamId,partExtension:m,sourceType:u})),f.getElementsByClassName("derivedformatfield-formatparams")[0].append(v.getContent()),f},switchEventField:function(e){var t=f.getDocument().getElementById("derivedformatfield-event"),n=f.getDocument().getElementById("derivedformatfield-activation");if(t&&t.selectedOptions[0]){var a=t.selectedOptions[0];"yes"==a.lifecycle||"yes"==a.getAttribute("lifecycle")?f.getDocument().getElementById("derivedformatfield-state-container").style.display="block":f.getDocument().getElementById("derivedformatfield-state-container").style.display="none";var r=viewMe.getActivation("","",a.value);viewMe.populateData(n,r),viewMe.fieldActivationTest(r,n)}},cancel:function(e){e.superModal.modals.current.hide()},switchSourceFormat:function(){var e=f.getDocument().getElementById("derivedformatfield-converter").selectedOptions[0].value,t=f.getDocument().getElementById("derivedformatfield-connector").selectedOptions[0].value,n=f.getDocument().getElementById("derivedformatfield-source").selectedOptions[0].value,a=f.getDocument().getElementById("derivedformatfield-source").selectedOptions[0].dataset.type;f.getDocument().getElementById("derivedformatfield-sourceFormat").value=n;var r=f.getDocument().getElementById("derivedformatfield-target"),i=viewMe.getTargetFormats(e,t,n,a);viewMe.populateData(r,i),viewMe.fieldActivationTest(i,r);var o=f.getDocument().getElementById("derivedformatfield-state"),d=viewMe.getStates(e,t,n);viewMe.populateData(o,d),viewMe.switchTargetFormat()},resetConverterForms:function(){var e=f.getDocument().getElementById("derivedformatfield-converter").selectedOptions[0].value,t=f.getDocument().getElementById("derivedformatfield-connector"),n=viewMe.getConnectors(e);viewMe.populateData(t,n),viewMe.fieldActivationTest(n,t),viewMe.resetFormFields()},fieldActivationTest:function(e,t){1==e.length?t.disabled=!0:0==viewMe.disableFields&&(t.disabled=!1)},resetFormFields:function(){var e=f.getDocument().getElementById("derivedformatfield-converter").selectedOptions[0].value,t=f.getDocument().getElementById("derivedformatfield-connector").selectedOptions[0].value,n=f.getDocument().getElementById("derivedformatfield-event"),a=f.getDocument().getElementById("derivedformatfield-state"),r=f.getDocument().getElementById("derivedformatfield-source"),i=(f.getDocument().getElementById("derivedformatfield-target"),viewMe.getEvents(e,t));viewMe.populateEventData(n,i);var o=viewMe.getStates(e,t);viewMe.populateData(a,o);var d=viewMe.getSourceFormats(e,t);viewMe.populateSourceData(r,d),viewMe.fieldActivationTest(i,n),viewMe.fieldActivationTest(o,a),viewMe.fieldActivationTest(d,r),viewMe.switchSourceFormat(),viewMe.switchEventField()},switchTargetFormat:function(){var e,t,n,a,r;g&&g.destroy();var i=f.getDocument().getElementById("derivedformatfield-converter"),d=f.getDocument().getElementById("derivedformatfield-connector"),l=f.getDocument().getElementById("derivedformatfield-source"),s=f.getDocument().getElementById("derivedformatfield-target");i&&(t=i.selectedOptions[0].value),d&&(n=d.selectedOptions[0].value),l&&(a=l.selectedOptions[0].value,r=l.selectedOptions[0].dataset.type),s&&(e=s.selectedOptions[0].value);var c=viewMe.getStreamIds(t,n,a,r,e),m=f.getDocument().getElementById("derivedformatfield-inputStreamId"),p=f.getDocument().getElementById("derivedformatfield-outputStreamId");if(m&&(m.value=c.inputStreamId),p&&(p.value=c.outputStreamId),v=new o({selection:this.selection,parameters:this.selection?this.selection.get("parameters"):{},derivedForm:f}),"authoring"!==m.value){var y=f.getDocument().getElementById("derivedformatfield-warning-icon");g=UWA.createElement("span",{html:'<span class="fonticon fonticon-1x fonticon-attention" style="font-size: 19px; height: 32px"></span>'}).inject(y);var E=m.value.toLowerCase(),D=r.toLowerCase(),I=derivedformatmanagementinfra.getNLSData().label[E+D];I&&(I=I.replace("%1",e)),g.tooltipInfos=new u({shortHelp:I})}if(i&&d&&l&&s&&!s.disabled&&"3DEXPERIENCE"==i.value&&"SOLIDWORKS"==d.value&&"SLDPRT"==l.value&&"ExactGeometry"==s.value){f.getDocument().getElementById("edfm-derivedformatparamview-param-warning-row").style.display="";var h=f.getDocument().getElementById("edfm-derivedformatparamview-param-warning");UWA.createElement("span",{class:"edfm-derivedformatparamview-param-warning-msg",html:derivedformatmanagementinfra.getNLSData().label.polyhedralFalseWarning,styles:{}}).inject(h)}},save:function(e){var t,n=e.getData(),a={};e.selection?((a=e.selection).set(n),t=a._previousAttributes):a=new i(n),a.get("deployed")&&!a.hasChanged()||(a.get("deployed")&&a.hasChanged()||"updated"==a.get("action")?a.set("action","updated"):a.set("action","created"));var r=e.isDuplicateRule(e,a);r&&a.isNew()?(a.set(t),e.superModal.modals.current.hide(),s.alert().add({className:"warning",message:derivedformatmanagementinfra.getNLSData().label.ruleExists})):!r&&n&&a.isValid()?(e.collection.add(a),e.superModal.modals.current.hide()):a.isNew()||(a.set(t),e.cancel(e),s.alert().add({className:"warning",message:derivedformatmanagementinfra.getNLSData().label.ruleExists}))},isDuplicateRule:function(e,t){var n=e.collection._models;for(var a in refModelAttr=t._attributes,n)if(modelAttr=n[a]._attributes,t.cid!=n[a].cid&&refModelAttr.converter===modelAttr.converter&&refModelAttr.source===modelAttr.source&&refModelAttr.target===modelAttr.target&&refModelAttr.event===modelAttr.event&&refModelAttr.category===modelAttr.category&&e.checkPartExtension(modelAttr,refModelAttr)&&e.checkState(modelAttr,refModelAttr)&&e.checkParameters(modelAttr.parameters,refModelAttr.parameters))return console.log(),!0;return!1},checkPartExtension:(e,t)=>!e.partExtension||!(!t.partExtension||t.partExtension!==e.partExtension),checkState:function(e,t){return!e.state||!(!t.state||t.state!==e.state)},checkParameters:function(e,t){if(0===Object.keys(e).length&&0===Object.keys(t).length)return!0;if(Object.keys(e).length!==Object.keys(t).length)return!1;var n;if(Object.keys(e).length>0)for(var a in e)if(val=e[a],(n=t[a])!==val||void 0===n&&""==n)return!1;return!0},getData:function(){var e={};e.converter=f.getDocument().getElementById("derivedformatfield-converter").value,e.category=f.getDocument().getElementById("derivedformatfield-connector").value;var t=f.getDocument().getElementById("derivedformatfield-event").options.selectedIndex;if(e.event=f.getDocument().getElementById("derivedformatfield-event").value,e.eventToDisplay=f.getDocument().getElementById("derivedformatfield-event").options[t]?f.getDocument().getElementById("derivedformatfield-event").options[t].innerHTML:"",e.activation=f.getDocument().getElementById("derivedformatfield-activation").value,"PROMOTE"==e.event||"promote"==e.event){var n=f.getDocument().getElementById("derivedformatfield-state").options.selectedIndex;e.state=f.getDocument().getElementById("derivedformatfield-state").value,e.stateToDisplay=f.getDocument().getElementById("derivedformatfield-state").options[n].innerHTML}else e.state="",e.stateToDisplay="";var a=f.getDocument().getElementById("derivedformatfield-source").options.selectedIndex;return e.source=f.getDocument().getElementById("derivedformatfield-source").value,e.sourceToDisplay=f.getDocument().getElementById("derivedformatfield-source").options[a].innerHTML,e.partExtension=f.getDocument().getElementById("derivedformatfield-source").options[a].dataset.partExtension,e.sourceType=f.getDocument().getElementById("derivedformatfield-source").options[a].dataset.type,e.target=f.getDocument().getElementById("derivedformatfield-target").value,e.updateOnly=!1,e.inputStreamId=f.getDocument().getElementById("derivedformatfield-inputStreamId").value,e.outputStreamId=f.getDocument().getElementById("derivedformatfield-outputStreamId").value,e.parameters=v.getData(),e},getConverters:function(){var e=derivedformatmanagementinfra.getInfraCollection(),t=new Array,n=e._models[0]._attributes.name;this.selection&&(n=this.selection.get("converter"));let a=derivedformatmanagementinfra.getNLSData().label.synchronous?derivedformatmanagementinfra.getNLSData().label.synchronous:"Synchronous, at save",r=derivedformatmanagementinfra.getNLSData().label.asynchronous?derivedformatmanagementinfra.getNLSData().label.asynchronous:"Asynchronous";return e.forEach(function(e,i){var o=!0===e.get("synchronous")||"true"===e.get("synchronous")?a:r;t.push({label:e.get("name")+" ("+o+")",value:e.get("name"),selected:e.get("name")==n})}),t},getConnectors:function(e){var t=derivedformatmanagementinfra.getInfraCollection().find(function(t,n){return t.get("name")==e}),n=new Array,a=t.get("connectors"),r=a[0].name;return this.selection&&(r=this.selection.get("category")),a.forEach(function(e,t){n.push({label:e.name,value:e.name,selected:e.name==r})}),n},getEvents:function(e,t){var n=new Array,a=derivedformatmanagementinfra.getInfraCollection().find(function(t,n){return t.get("name")==e});if(a){var r=a.get("connectors").find(function(e,n){return e.name==t});if(r&&r.actions){var i=r.actions,o=i[0].name;this.selection&&(o=this.selection.get("event")),i.forEach(function(e,t){n.push({label:e.value,value:e.name,selected:e.name==o,lifecycle:"lifecycle"==e.maturityGraph?"yes":"no"})})}}return n},getActivation:function(e,t,n){var a=new Array,r=derivedformatmanagementinfra.getInfraCollection();!e&&f.getDocument().getElementById("derivedformatfield-converter").selectedOptions[0]&&(e=f.getDocument().getElementById("derivedformatfield-converter").selectedOptions[0].value),!t&&f.getDocument().getElementById("derivedformatfield-connector").selectedOptions[0]&&(t=f.getDocument().getElementById("derivedformatfield-connector").selectedOptions[0].value);var i=r.find(function(t,n){return t.get("name")==e});if(i){var o=i.get("connectors").find(function(e,n){return e.name==t});if(o&&o.actions){var d=o.actions.find(function(e,t){return e.name==n});if(d){var l=d.activation.split("|"),s=l[0];this.selection&&(s=this.selection.get("activation")),l.forEach(function(e,t){a.push({label:derivedformatmanagementinfra.getNLSData().label[e],value:e,selected:e==s})})}}}return a},getStates:function(e,t,n){var a=new Array,r=derivedformatmanagementinfra.getInfraCollection().find(function(t,n){return t.get("name")==e});if(r){var i=r.get("connectors").find(function(e,n){return e.name==t});if(i&&i.actions){var o=i.actions,d=UWA.Array.detect(o,function(e){return"PROMOTE"==e.name||"promote"==e.name});if(d){var l=this.getSourceFormats(e,t).find(function(e,t){return e.value==n});if(l){var s=null;if(l.type.includes("Part")||l.type.includes("SEComponent")?s=d.states.Part:l.type.includes("Drawing")&&(s=d.states.Drawing),s){var c=s[0];this.selection&&(c=this.selection.get("state")),s.forEach(function(e,t){a.push({label:e.value,value:e.name,selected:e.name==c})})}}}}}return a},getTargetFormats:function(e,t,n,a){var r=new Array,i=derivedformatmanagementinfra.getInfraCollection().find(function(t,n){return t.get("name")==e});if(i){var o=i.get("connectors").find(function(e,n){return e.name==t});if(o){var d=o.supportedformats.find(function(e,t){return e.source.name==n&&e.source.type==a});if(d){var l=d.targets[0].target;this.selection&&(l=this.selection.get("target")),d.targets.forEach(function(t,n){var a=t.target,i=a;derivedformatmanagementinfra.getNLSData()[e]&&derivedformatmanagementinfra.getNLSData()[e].target[a]&&(i=derivedformatmanagementinfra.getNLSData()[e].target[a]),r.push({label:i,value:a,selected:a==l})})}}}return r},getStreamIds:function(e,t,n,a,r){var i={},o=derivedformatmanagementinfra.getInfraCollection().find(function(t,n){return t.get("name")==e});if(o){var d=o.get("connectors").find(function(e,n){return e.name==t});if(d){var l=d.supportedformats.find(function(e,t){return e.source.name==n&&e.source.type==a});if(l&&l.targets)l.targets.forEach(function(e,t){e.target==r&&(i.inputStreamId=e.inputStreamId,i.outputStreamId=e.outputStreamId)})}}return i},getSourceFormats:function(e,t){var n=derivedformatmanagementinfra.getInfraCollection().find(function(t,n){return t.get("name")==e}),a=new Array;if(n){var r,i,o=n.get("connectors").find(function(e,n){return e.name==t});if(o)this.selection?(r=this.selection.get("source"),i=this.selection.get("partExtension")):(r=o.supportedformats[0].source.name,i=o.supportedformats[0].source.partExtension),o.supportedformats.forEach(function(e,t){var n="";n=e.source.partExtension?e.source.partExtensionValue:derivedformatmanagementinfra.getNLSData().label[e.source.type.toLowerCase()]?derivedformatmanagementinfra.getNLSData().label[e.source.type.toLowerCase()]:e.source.type;var o=e.source.name==r;i&&(o=o&&e.source.partExtension==i),a.push({label:n,value:e.source.name,type:e.source.type,selected:o,partExtension:e.source.partExtension})})}return a},getParamListView:function(){return v}})});