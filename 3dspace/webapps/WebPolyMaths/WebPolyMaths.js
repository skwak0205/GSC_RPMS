define("DS/WebPolyMaths/WebToolsMaths",["DS/Visualization/ThreeJS_DS"],function(e){"use strict";var t={isZero:function(e){return Math.abs(e)<.001},areEqual:function(e,t,i,n){var r=void 0!==n?n:.001,o=!0,a=void 0!==i?i:"float";switch(a){case"float":o=Math.abs(e-t)<r;break;case"Vector3":o=Math.abs(e.x-t.x)<r&&Math.abs(e.y-t.y)<r&&Math.abs(e.z-t.z)<r;break;case"Matrix4":for(var s=0;s<16&&o;s++)o=Math.abs(e.elements[s]-t.elements[s])<r;break;default:console.log("areEqual used with unknown type: "+a)}return o},isLessOrEqual:function(e,t,i){return e<=t+(void 0!==i?i:.001)},isLessThan:function(e,t,i){return e<t+(void 0!==i?i:.001)},computeMatrixFromLines:function(i,n,r,o){var a,s,c=n.clone().normalize();return void 0!==r?(s=(new e.Vector3).crossVectors(c,r),a=(new e.Vector3).crossVectors(s,c)):void 0!==o?(a=(new e.Vector3).crossVectors(c,o),s=(new e.Vector3).crossVectors(c,a)):(a=(new e.Vector3).crossVectors(c,new e.Vector3(0,0,1)),t.isZero(a.length())&&(a=(new e.Vector3).crossVectors(c,new e.Vector3(0,1,0))),s=(new e.Vector3).crossVectors(c,a)),new e.Matrix4(c.x,a.x,s.x,i.x,c.y,a.y,s.y,i.y,c.z,a.z,s.z,i.z,0,0,0,1)},computeTransformationBetweenTwoLines:function(i,n,r,o){var a={returnCode:1};if(i&&n&&r&&o){var s=n.clone().normalize(),c=o.clone().normalize(),l=(new e.Matrix4).makeTranslation(-i.x,-i.y,-i.z),u=(new e.Vector3).crossVectors(s,c);t.isZero(u.length())&&(u=(new e.Vector3).crossVectors(s,new e.Vector3(1,0,0)),t.isZero(u.length())&&(u=(new e.Vector3).crossVectors(s,new e.Vector3(0,1,0))));var p=Math.acos(c.dot(s)),h=(new e.Matrix4).makeRotationAxis(u.normalize(),p),d=(new e.Matrix4).makeTranslation(r.x,r.y,r.z).clone().multiply(h).multiply(l);a.returnCode=0,a.transformation=d}return a},quaternionToAxisSystem:function(t){var i={},n=(new e.Matrix4).setRotationFromQuaternion(t.clone()).elements;return i.X=new e.Vector3(n[0],n[1],n[2]),i.Y=new e.Vector3(n[4],n[5],n[6]),i.Z=new e.Vector3(n[8],n[9],n[10]),i.Origin=new e.Vector3(n[12],n[13],n[14]),i}};return t}),define("DS/WebPolyMaths/WebMathsVector3D",[],function(){"use strict";var e=.001,t=1e-6;return{modifyEpsilon:function(i){var n=e;return i>0&&(e=i,t=i*i),n},isNull:function(t){return Math.abs(t[0])<e&&Math.abs(t[1])<e&&Math.abs(t[2])<e},clone:function(e){var t=[];return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},length:function(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2])},squaredLength:function(e){return e[0]*e[0]+e[1]*e[1]+e[2]*e[2]},normalize:function(e,i){var n,r=e[0]*e[0]+e[1]*e[1]+e[2]*e[2];if(Math.abs(r-1)<t)(n=i||[0,0,0])[0]=e[0],n[1]=e[1],n[2]=e[2];else if(r>t){var o=Math.sqrt(r);(n=i||[0,0,0])[0]=e[0]/o,n[1]=e[1]/o,n[2]=e[2]/o}return n},multiply:function(e,t,i){var n=i||[0,0,0];return n[0]=t*e[0],n[1]=t*e[1],n[2]=t*e[2],n},areEqual:function(t,i){return Math.abs(i[0]-t[0])<e&&Math.abs(i[1]-t[1])<e&&Math.abs(i[2]-t[2])<e},add:function(e,t,i){var n=i||[0,0,0];return n[0]=t[0]+e[0],n[1]=t[1]+e[1],n[2]=t[2]+e[2],n},sub:function(e,t,i){var n=i||[0,0,0];return n[0]=t[0]-e[0],n[1]=t[1]-e[1],n[2]=t[2]-e[2],n},angle:function(t,i){var n,r=Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]),o=Math.sqrt(i[0]*i[0]+i[1]*i[1]+i[2]*i[2]);if(r>e&&o>e){var a=(t[0]*i[0]+t[1]*i[1]+t[2]*i[2])/(r*o);n=Math.acos(Math.min(Math.max(a,-1),1))}return n},dot:function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]},cross:function(e,t,i){var n=i||[0,0,0],r=e[0],o=e[1],a=e[2],s=t[0],c=t[1],l=t[2];return n[0]=o*l-a*c,n[1]=a*s-r*l,n[2]=r*c-o*s,n},subAndLength:function(e,t,i){var n=i||[0,0,0];return n[0]=t[0]-e[0],n[1]=t[1]-e[1],n[2]=t[2]-e[2],Math.sqrt(n[0]*n[0]+n[1]*n[1]+n[2]*n[2])},subAndSquaredLength:function(e,t,i){var n=i||[0,0,0];return n[0]=t[0]-e[0],n[1]=t[1]-e[1],n[2]=t[2]-e[2],n[0]*n[0]+n[1]*n[1]+n[2]*n[2]},multiplyAndAdd:function(e,t,i,n){var r=n||[0,0,0];return r[0]=e[0]*t+i[0],r[1]=e[1]*t+i[1],r[2]=e[2]*t+i[2],r},isIdentity:function(t){return Math.abs(t[0]-1)<e&&Math.abs(t[1])<e&&Math.abs(t[2])<e&&Math.abs(t[3])<e&&Math.abs(t[4])<e&&Math.abs(t[5]-1)<e&&Math.abs(t[6])<e&&Math.abs(t[7])<e&&Math.abs(t[8])<e&&Math.abs(t[9])<e&&Math.abs(t[10]-1)<e&&Math.abs(t[11])<e&&Math.abs(t[12])<e&&Math.abs(t[13])<e&&Math.abs(t[14])<e&&Math.abs(t[15]-1)<e},areMatrixEqual:function(t,i){return Math.abs(t[0]-i[0])<e&&Math.abs(t[1]-i[1])<e&&Math.abs(t[2]-i[2])<e&&Math.abs(t[3]-i[3])<e&&Math.abs(t[4]-i[4])<e&&Math.abs(t[5]-i[5])<e&&Math.abs(t[6]-i[6])<e&&Math.abs(t[7]-i[7])<e&&Math.abs(t[8]-i[8])<e&&Math.abs(t[9]-i[9])<e&&Math.abs(t[10]-i[10])<e&&Math.abs(t[11]-i[11])<e&&Math.abs(t[12]-i[12])<e&&Math.abs(t[13]-i[13])<e&&Math.abs(t[14]-i[14])<e&&Math.abs(t[15]-i[15])<e},transformVector:function(e,t,i){var n=i||[0,0,0],r=e[0],o=e[1],a=e[2];return n[0]=t[0]*r+t[4]*o+t[8]*a,n[1]=t[1]*r+t[5]*o+t[9]*a,n[2]=t[2]*r+t[6]*o+t[10]*a,n},transformPoint:function(e,t,i){var n=i||[0,0,0],r=e[0],o=e[1],a=e[2];return n[0]=t[0]*r+t[4]*o+t[8]*a+t[12],n[1]=t[1]*r+t[5]*o+t[9]*a+t[13],n[2]=t[2]*r+t[6]*o+t[10]*a+t[14],n}}}),define("DS/WebPolyMaths/WebGeometryEnums",[],function(){"use strict";var e=e||{REVISION:"1"};return e.GeometryType={POINT:0,PICKINGPT:1,CURVE:2,LINE:3,CIRCLE:4,SURFACE:5,PLANE:6,CYLINDER:7,CONE:8,SPHERE:9,PRODUCT:10},e.Relationship={NONE:0,COINCIDENT:1,PARRALLEL:2,INTERSECTING:3},e.Mode={EXACT:0,FACETTED:1},e}),define("DS/WebPolyMaths/WebMeasureEnums",[],function(){"use strict";var e=e||{REVISION:"1"};return e.ResultType={POINT:0,PICKINGPT:1,CENTER:2,CURVE:3,LINE:4,AXIS:5,CIRCLE:6,SURFACE:7,PLANE:8,CYLINDER:9,CONE:10,SPHERE:11,PRODUCT:12},e.ViewedType={POINT:0,CENTER:1,AXIS:2,CURVE:3,INFPLANE:4,SURFACE:5,PRODUCT:6,CIRCLE:7,CYCOSP:8},e.RadiusResultDisplayType={CENTER:0,TANGENT:1},e}),define("DS/WebPolyMaths/WebMeshCreation",["DS/Visualization/ThreeJS_DS","DS/Visualization/Node3D","DS/Mesh/MeshUtils","DS/WebPolyMaths/WebToolsMaths"],function(e,t,i,n){"use strict";var r={createPolylines:function(e,t,n,r){var o=new i.PrimitiveGroup,a=new i.Color(t[0].r,t[0].g,t[0].b,1);o.fillAttr=new i.FillAttributes,o.lineAttr=new i.LineAttributes(a,n,r),o.pointAttr=new i.PointAttributes;for(var s=0,c=e.length,l=0;l<c;l++)for(var u=(f=e[l]).length,p=0;p<u;p++)s+=f[p].length;var h=new i.Buffer;h.size=3*s,h.component=i.VertexComponentEnum.POSITION,h.format=i.DataTypeEnum.FLOAT,h.dimension=3,h.data=new Float32Array(h.size);var d=h.data,g=0;for(l=0;l<c;l++)for(u=(f=e[l]).length,p=0;p<u;p++){s=(v=f[p]).length;for(var m=0;m<s;m++){var y=v[m];d[g]=y[0],d[g+1]=y[1],d[g+2]=y[2],g+=3}}o.addBuffer(0,h);var P=0;for(l=0;l<c;l++){var f=e[l];for(a=new i.Color(t[l].r,t[l].g,t[l].b,1),u=f.length,p=0;p<u;p++){var v;s=(v=f[p]).length;var T=new i.Primitive;T.nbIndices=s,T.connectivity=i.ConnectivityTypeEnum.LINE_STRIP,T.attr={fill:new i.FillAttributes(a),line:new i.LineAttributes(a,n,r),point:new i.PointAttributes};var _=new i.VertexComponent;_.component=i.VertexComponentEnum.POSITION,_.nbVertices=s,_.nbValuesPerVertex=3,_.format=i.DataTypeEnum.FLOAT,_.cardinality=0,_.bufferId=0,_.offset=P,P+=s,T.addVertexComponent(_),o.addPrimitive(T)}}return o},createRectangle:function(e,t,i,n,o,a){var s=[],c=0;s[c++]=0,s[c++]=0,s[c++]=0,s[c++]=e,s[c++]=0,s[c++]=0,s[c++]=e,s[c++]=t,s[c++]=0,s[c++]=0,s[c++]=t,s[c++]=0;var l=[];l[0]=0,l[1]=0,l[2]=1;var u=[];c=0;return u[c++]=0,u[c++]=1,u[c++]=1,u[c++]=0,r.createPlanarPolygon(s,l,u,!1,i,n,o,a)},createArrow:function(e,t,i,n,o,a,s){var c=(1-i)*t,l=e/2,u=[],p=0;u[p++]=0,u[p++]=0,u[p++]=0,u[p++]=c,u[p++]=-e,u[p++]=0,u[p++]=c,u[p++]=-l,u[p++]=0,u[p++]=t,u[p++]=-l,u[p++]=0,u[p++]=t,u[p++]=l,u[p++]=0,u[p++]=c,u[p++]=l,u[p++]=0,u[p++]=c,u[p++]=e,u[p++]=0;var h=[];h[0]=0,h[1]=0,h[2]=1;var d=[];p=0;return d[p++]=1,d[p++]=1,d[p++]=1,d[p++]=0,d[p++]=0,d[p++]=1,d[p++]=1,r.createPlanarPolygon(u,h,d,!1,n,o,a,s)},createRing:function(e,t,i,o,a,s,c,l,u,p){var h=(o-i)/a,d=[],g=0,m=[],y=0,P=p?1:0,f=1-P,v=n.isZero(e);v&&(d[g++]=0,d[g++]=0,d[g++]=0,m[y++]=P);for(var T=0;T<=a;T++){var _=i+T*h;v||(d[g++]=e*Math.cos(_),d[g++]=e*Math.sin(_),d[g++]=0,m[y++]=P),d[g++]=t*Math.cos(_),d[g++]=t*Math.sin(_),d[g++]=0,m[y++]=f}var C=[];return C[0]=0,C[1]=0,C[2]=1,r.createPlanarPolygon(d,C,m,!v,s,c,l,u)},createPlanarPolygon:function(e,t,n,r,o,a,s,c){var l=e.length/3,u=o?l+1:0,p=s?l:0,h=r?i.ConnectivityTypeEnum.TRIANGLE_STRIP:i.ConnectivityTypeEnum.TRIANGLE_FAN,d=void 0!==c?c:new i.Color(.5,.5,.5,1),g=void 0!==a?a:new i.Color(.5,.5,.5,1),m=new i.PrimitiveGroup;m.fillAttr=new i.FillAttributes,m.lineAttr=new i.LineAttributes,m.pointAttr=new i.PointAttributes;var y=new i.Buffer;y.size=3*l,y.component=i.VertexComponentEnum.POSITION,y.format=i.DataTypeEnum.FLOAT,y.dimension=3,y.data=new Float32Array(y.size);var P=new i.Buffer;P.size=3,P.component=i.VertexComponentEnum.NORMAL,P.format=i.DataTypeEnum.FLOAT,P.dimension=3,P.data=new Float32Array(P.size);var f=new i.Buffer;f.size=6,f.component=i.VertexComponentEnum.TEX_COORD_0,f.format=i.DataTypeEnum.FLOAT,f.dimension=3,f.data=new Float32Array(f.size);var v=new i.Buffer;v.indexBuffer=!0,v.size=u+p,v.format=i.DataTypeEnum.UINT,v.dimension=1,v.data=new Uint16Array(v.size);var T=new i.Buffer;T.indexBuffer=!0,T.size=p,T.format=i.DataTypeEnum.UINT,T.dimension=1,T.data=new Uint16Array(T.size);var _=new i.Buffer;_.indexBuffer=!0,_.size=u+p,_.format=i.DataTypeEnum.UINT,_.dimension=1,_.data=new Uint16Array(_.size);m.addBuffer(0,y),m.addBuffer(1,P),m.addBuffer(2,v),m.addBuffer(3,T),m.addBuffer(4,f),m.addBuffer(5,_);var C=v.data,M=0,E=0;if(o){for(E=0;E<l;E++)C[M++]=E;C[M++]=0}if(s)for(E=0;E<l;E++)C[M++]=E;if(C=T.data,M=0,s)for(E=0;E<l;E++)C[M++]=0;if(C=_.data,M=0,s)for(E=0;E<l;E++)C[M++]=n[E];for(C=y.data,M=0;M<3*l;M++)C[M]=e[M];if(M=0,(C=P.data)[M++]=t[0],C[M++]=t[1],C[M++]=t[2],M=0,(C=f.data)[M++]=0,C[M++]=0,C[M++]=0,C[M++]=1,C[M++]=0,C[M++]=0,o){var A=new i.Primitive;A.nbIndices=l+1,A.connectivity=i.ConnectivityTypeEnum.LINE_STRIP,A.attr={fill:new i.FillAttributes(g),line:new i.LineAttributes(g),point:new i.PointAttributes};var b=new i.VertexComponent;b.component=i.VertexComponentEnum.POSITION,b.nbVertices=l,b.nbValuesPerVertex=3,b.format=i.DataTypeEnum.FLOAT,b.cardinality=0,b.bufferId=0,b.indices=new i.IndexArray,b.indices.format=i.DataTypeEnum.UINT,b.indices.bufferId=2,b.indices.offset=0,A.addVertexComponent(b),m.addPrimitive(A)}if(s){var S=new i.Primitive;S.nbIndices=l,S.connectivity=h,S.attr={fill:new i.FillAttributes(d),line:new i.LineAttributes,point:new i.PointAttributes};var R=new i.VertexComponent;R.component=i.VertexComponentEnum.POSITION,R.nbVertices=l,R.nbValuesPerVertex=3,R.format=i.DataTypeEnum.FLOAT,R.cardinality=0,R.bufferId=0,R.indices=new i.IndexArray,R.indices.format=i.DataTypeEnum.UINT,R.indices.bufferId=2,R.indices.offset=u;var D=new i.VertexComponent;D.component=i.VertexComponentEnum.NORMAL,D.nbVertices=1,D.nbValuesPerVertex=3,D.format=i.DataTypeEnum.FLOAT,D.cardinality=0,D.bufferId=1,D.indices=new i.IndexArray,D.indices.format=i.DataTypeEnum.UINT,D.indices.bufferId=3,D.indices.offset=0;var V=new i.VertexComponent;V.component=i.VertexComponentEnum.TEX_COORD_0,V.nbVertices=2,V.nbValuesPerVertex=3,V.format=i.DataTypeEnum.FLOAT,V.cardinality=0,V.bufferId=4,V.indices=new i.IndexArray,V.indices.format=i.DataTypeEnum.UINT,V.indices.bufferId=5,V.indices.offset=0,S.addVertexComponent(R),S.addVertexComponent(D),S.addVertexComponent(V),m.addPrimitive(S)}return m},_computeTotalLength:function(e){var t=[];if(e.length>0){t.push(0);for(var i=0,n=1;n<e.length;n++)i+=e[n-1].distanceTo(e[n]),t.push(i)}return t},_intersection:function(t,i,n){var r=((t.x-n.x)*i.x-(n.y-t.y)*i.y)/(-i.x*i.x-i.y*i.y);return new e.Vector2(t.x+r*i.x,t.y+r*i.y)},boundingBoxCompute:function(t){for(var i=Number.MAX_VALUE,n=[],r=[],o=0,a=0,s=0,c=0,l=0;l<t.length;l++)r.push(t[(l+1)%t.length].clone().sub(t[l]).normalize()),t[l].x<t[o].x&&(o=l),t[l].x>t[a].x&&(a=l),t[l].y<t[c].y&&(c=l),t[l].y>t[s].y&&(s=l);var u=new e.Vector2(-1,0),p=new e.Vector2(0,-1);for(l=0;l<t.length;l++){var h=[p.dot(r[o]),-p.dot(r[a]),u.dot(r[s]),-u.dot(r[c])];switch(h.indexOf(Math.max.apply(Math,h))){case 0:(u=r[o].clone()).set(u.y,-u.x),o=(o+1)%t.length;break;case 1:(u=r[a].clone().negate()).set(u.y,-u.x),a=(a+1)%t.length;break;case 2:u=r[s].clone(),s=(s+1)%t.length;break;case 3:u=r[c].clone().negate(),c=(c+1)%t.length}(p=u.clone().negate()).set(p.y,-p.x);var d=this._intersection(t[o],p,t[s]),g=this._intersection(t[a],p,t[s]),m=this._intersection(t[c],u,t[o]),y=this._intersection(t[c],u,t[a]),P=d.distanceTo(m),f=d.distanceTo(g),v=f*P;v<i&&(n=[d,m,y,g,f,P],i=v)}return n}};return r}),define("DS/WebPolyMaths/WebMathsBoundingGeometry",["DS/WebPolyMaths/WebMathsVector3D"],function(e){"use strict";var t={areEqualAABB:function(e,t){return Math.abs(t[0]-e[0])<.001&&Math.abs(t[1]-e[1])<.001&&Math.abs(t[2]-e[2])<.001&&Math.abs(t[3]-e[3])<.001&&Math.abs(t[4]-e[4])<.001&&Math.abs(t[5]-e[5])<.001},computeAABBDistance:function(e,i){return Math.sqrt(t.computeAABBSquaredDistance(e,i))},computeAABBSquaredDistance:function(e,t){var i=0,n=0,r=0,o=0;return e[3]<t[0]?n=t[0]-e[3]:e[0]>t[3]&&(n=e[0]-t[3]),e[4]<t[1]?r=t[1]-e[4]:e[1]>t[4]&&(r=e[1]-t[4]),e[5]<t[2]?o=t[2]-e[5]:e[2]>t[5]&&(o=e[2]-t[5]),0===n&&0===r&&0===o||(i=n*n+r*r+o*o),i},computeAABBSquaredMaxDistance:function(e,t){var i=Math.max(Math.abs(t[0]-e[3]),Math.abs(t[3]-e[0])),n=Math.max(Math.abs(t[1]-e[4]),Math.abs(t[4]-e[1])),r=Math.max(Math.abs(t[2]-e[5]),Math.abs(t[5]-e[2]));return i*i+n*n+r*r},computeAABBForPoint:function(e){var t=[];return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[0],t[4]=e[1],t[5]=e[2],t},computeAABBForPoints:function(e){var t,i,n,r=[],o=e.length;r[0]=e[0][0],r[1]=e[0][1],r[2]=e[0][2],r[3]=r[0],r[4]=r[1],r[5]=r[2];for(var a=1;a<o;a++)t=e[a][0],i=e[a][1],n=e[a][2],t<r[0]?r[0]=t:t>r[3]&&(r[3]=t),i<r[1]?r[1]=i:i>r[4]&&(r[4]=i),n<r[2]?r[2]=n:n>r[5]&&(r[5]=n);return r},computeAABBForUnsortedPoints:function(t,i,n,r,o){var a,s,c,l,u=[];if(o&&!e.isIdentity(o)){a=3*n[i],(u=e.transformPoint([r[a],r[a+1],r[a+2]],o))[3]=u[0],u[4]=u[1],u[5]=u[2];for(var p=1;p<t;p++){a=3*n[i+p];var h=e.transformPoint([r[a],r[a+1],r[a+2]],o);s=h[0],c=h[1],l=h[2],s<u[0]?u[0]=s:s>u[3]&&(u[3]=s),c<u[1]?u[1]=c:c>u[4]&&(u[4]=c),l<u[2]?u[2]=l:l>u[5]&&(u[5]=l)}}else{a=3*n[i],u[0]=r[a],u[1]=r[a+1],u[2]=r[a+2],u[3]=u[0],u[4]=u[1],u[5]=u[2];for(p=1;p<t;p++)s=r[a=3*n[i+p]],c=r[a+1],l=r[a+2],s<u[0]?u[0]=s:s>u[3]&&(u[3]=s),c<u[1]?u[1]=c:c>u[4]&&(u[4]=c),l<u[2]?u[2]=l:l>u[5]&&(u[5]=l)}return u},computeAABBForSegment:function(e,t){var i=[];return i[0]=Math.min(e[0],t[0]),i[1]=Math.min(e[1],t[1]),i[2]=Math.min(e[2],t[2]),i[3]=Math.max(e[0],t[0]),i[4]=Math.max(e[1],t[1]),i[5]=Math.max(e[2],t[2]),i},computeAABBForTriangle:function(e,t,i){var n=[];return n[0]=Math.min(e[0],t[0],i[0]),n[1]=Math.min(e[1],t[1],i[1]),n[2]=Math.min(e[2],t[2],i[2]),n[3]=Math.max(e[0],t[0],i[0]),n[4]=Math.max(e[1],t[1],i[1]),n[5]=Math.max(e[2],t[2],i[2]),n},intersectAABBWithRay:function(e,t,i){var n,r,o,a,s,c=!1;(Math.abs(i[0])>.001||t[0]>e[0]&&t[0]<e[3])&&(Math.abs(i[1])>.001||t[1]>e[1]&&t[1]<e[4])&&(Math.abs(i[2])>.001||t[2]>e[2]&&t[2]<e[5])&&(Math.abs(i[0])<.001?(n=-Number.MAX_VALUE,r=Number.MAX_VALUE):(s=1/i[0])>=0?(n=(e[0]-t[0])*s,r=(e[3]-t[0])*s):(n=(e[3]-t[0])*s,r=(e[0]-t[0])*s),Math.abs(i[1])<.001?(o=-Number.MAX_VALUE,a=Number.MAX_VALUE):(s=1/i[1])>=0?(o=(e[1]-t[1])*s,a=(e[4]-t[1])*s):(o=(e[4]-t[1])*s,a=(e[1]-t[1])*s),n<a&&o<r&&(o>n&&(n=o),a<r&&(r=a),Math.abs(i[2])<.001?(o=-Number.MAX_VALUE,a=Number.MAX_VALUE):(s=1/i[2])>=0?(o=(e[2]-t[2])*s,a=(e[5]-t[2])*s):(o=(e[5]-t[2])*s,a=(e[2]-t[2])*s),n<a&&o<r&&(o>n&&(n=o),a<r&&(r=a),r>0&&(c=!0))));return c},areEqualBoundingSpheres:function(e,t){return Math.abs(t[0]-e[0])<.001&&Math.abs(t[1]-e[1])<.001&&Math.abs(t[2]-e[2])<.001&&Math.abs(t[3]-e[3])<.001},computeBoundingSpheresDistance:function(t,i){return Math.max(0,e.subAndLength(t,i)-t[3]-i[3])},computeBoundingSpheresSquaredDistance:function(e,i){var n=t.computeBoundingSpheresDistance(e,i);return n*n},computeBoundingSphereForPoint:function(e){var t=[];return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=0,t},computeBoundingSphereForPoints:function(e){var i=t.computeAABBForPoints(e),n=[i[3],i[4],i[5]];return t.computeBoundingSphereForSegment(i,n)},computeBoundingSphereForSegment:function(t,i){var n=[];return n[0]=(t[0]+i[0])/2,n[1]=(t[1]+i[1])/2,n[2]=(t[2]+i[2])/2,n[3]=e.subAndLength(t,i)/2,n},computeBoundingSphereForTriangle:function(i,n,r){var o,a=[],s=e.sub(i,n),c=e.sub(i,r),l=e.squaredLength(s),u=e.squaredLength(c),p=e.dot(s,c),h=2*(l*u-p*p);if(Math.abs(h)<=1e-6){var d=t.computeAABBForTriangle(i,n,r);o=[d[3],d[4],d[5]],a=t.computeBoundingSphereForSegment(d,o)}else{var g=(l*u-u*p)/h,m=(u*l-l*p)/h;g<=0?(o=e.add(i,r),a=e.multiply(o,.5)):m<=0?(o=e.add(i,n),a=e.multiply(o,.5)):g+m>=1?(o=e.add(n,r),a=e.multiply(o,.5),n):(o=e.multiplyAndAdd(s,g,i),a=e.multiplyAndAdd(c,m,o)),a[3]=e.subAndLength(a,i)}return a}};return t}),define("DS/WebPolyMaths/WebMathsInfiniteGeometry",["DS/WebPolyMaths/WebMathsVector3D","DS/WebPolyMaths/WebGeometryEnums"],function(e,t){"use strict";var i={computeTwoPointsDistance:function(i,n){var r={returnCode:1};return i&&n&&(r.returnCode=0,r.distance=e.subAndLength(i,n),r.relationship=r.distance<.001?t.Relationship.COINCIDENT:t.Relationship.NONE),r},computePointLineDistance:function(i,n,r){var o={returnCode:1};if(i&&n&&r){var a=e.squaredLength(r);if(a>1e-6){o.returnCode=0;var s=e.dot(e.sub(n,i),r)/a;o.aPosition=e.multiplyAndAdd(r,s,n),o.distance=e.subAndLength(i,o.aPosition),o.relationship=o.distance<.001?t.Relationship.COINCIDENT:t.Relationship.NONE}}return o},computePointPlaneDistance:function(i,n,r){var o={returnCode:1};if(i&&n&&r){var a=e.squaredLength(r);if(a>1e-6){o.returnCode=0;var s=e.dot(e.sub(i,n),r)/a;o.aPosition=e.multiplyAndAdd(r,s,i),o.distance=e.subAndLength(i,o.aPosition),o.relationship=o.distance<.001?t.Relationship.COINCIDENT:t.Relationship.NONE}}return o},computeTwoLinesDistance:function(i,n,r,o){var a={returnCode:1};if(i&&n&&r&&o){a.returnCode=0;var s=e.sub(r,i),c=e.squaredLength(n),l=e.dot(n,o),u=e.squaredLength(o),p=e.dot(n,s),h=e.dot(o,s),d=c*u-l*l,g=0,m=0;d<.001?(g=0,m=l>u?p/l:h/u,a.aPosition1=e.clone(i),a.aPosition2=e.multiplyAndAdd(o,m,r),a.distance=e.subAndLength(a.aPosition1,a.aPosition2),a.relationship=a.distance<.001?t.Relationship.COINCIDENT:t.Relationship.PARRALLEL,a.angle=0):(g=(l*h-u*p)/d,m=(c*h-l*p)/d,a.aPosition1=e.multiplyAndAdd(n,g,i),a.aPosition2=e.multiplyAndAdd(o,m,r),a.distance=e.subAndLength(a.aPosition1,a.aPosition2),a.relationship=a.distance<.001?t.Relationship.INTERSECTING:t.Relationship.NONE,a.angle=e.angle(n,o))}return a},computeLinePlaneDistance:function(n,r,o,a){var s={returnCode:1};if(n&&r&&o&&a){s.returnCode=0;var c=e.normalize(r),l=e.normalize(a),u=e.dot(c,l);if(Math.abs(u)<.001){s.angle=0;var p=i.computePointPlaneDistance(n,o,l);0===p.returnCode&&p.distance<.001?(s.distance=0,s.aPosition=e.clone(n),s.relationship=t.Relationship.COINCIDENT):(s.distance=p.distance,s.aPosition=p.aPosition,s.relationship=t.Relationship.PARRALLEL)}else{s.distance=0,s.angle=Math.asin(u);var h=e.dot(e.sub(n,o),l)/u;s.aPosition=e.multiplyAndAdd(c,h,n),s.relationship=t.Relationship.INTERSECTING}}return s},computeTwoPlanesDistance:function(n,r,o,a){var s={returnCode:1};if(n&&r&&o&&a){s.returnCode=0;var c=e.normalize(r),l=e.normalize(a);if(e.areEqual(c,l)||e.isNull(e.add(c,l))){s.angle=0;var u=e.areEqual(c,l)?1:-1,p=e.dot(n,c),h=e.dot(o,l);s.distance=Math.abs(p-u*h);var d=i.computePointPlaneDistance(o,n,c);s.aPosition1=d.aPosition;var g=i.computePointPlaneDistance(n,o,l);s.aPosition2=g.aPosition,s.relationship=s.distance<.001?t.Relationship.COINCIDENT:t.Relationship.PARRALLEL}else{s.distance=0,s.angle=Math.acos(e.dot(c,l));var m=e.cross(c,l),y=e.cross(c,m),P=e.cross(l,m),f=i.computeLinePlaneDistance(o,P,n,c);s.aPosition1=f.aPosition;var v=i.computeLinePlaneDistance(n,y,o,l);s.aPosition2=v.aPosition,s.relationship=t.Relationship.INTERSECTING}}return s}};return i}),define("DS/WebPolyMaths/WebMeshServices",["DS/WebPolyMaths/WebToolsMaths","DS/WebPolyMaths/WebGeometryEnums","DS/WebPolyMaths/WebMathsVector3D","DS/WebPolyMaths/WebMathsInfiniteGeometry","DS/WebPolyMaths/WebMathsBoundingGeometry"],function(e,t,i,n,r){"use strict";var o={verifyMesh:function(e){var t=void 0!==e&&void 0!==e.getGroup()&&void 0!==e.getGroup().glType&&void 0!==e.getGroup().geometry;return t=t&&void 0!==e.getCount()&&e.getCount()>0&&void 0!==e.getGroup().geometry.vertexIndexArray},extractMeshVertices:function(e,t,n,r){var o=[],a=e.getCount();n&&n<a&&(a=n);var s=r||!1,c=e.getStart(),l=e.getGroup().geometry;if(l&&l.vertexIndexArray&&l.vertexPositionArray){var u,p=l.vertexIndexArray,h=l.vertexPositionArray,d=0,g=0;if(t&&!i.isIdentity(t))if(s){var m=[];for(d=0;d<a;d++){u=3*p[c+d];var y=!1;for(g=0;!y&&g<m.length;g++)y=u===m[g];y||(o.push(i.transformPoint([h[u],h[u+1],h[u+2]],t)),m.push(u))}}else for(d=0;d<a;d++)u=3*p[c+d],o[d]=i.transformPoint([h[u],h[u+1],h[u+2]],t);else if(s){var P=[];for(d=0;d<a;d++){u=3*p[c+d];var f=!1;for(g=0;!f&&g<P.length;g++)f=u===P[g];f||(o.push([h[u],h[u+1],h[u+2]]),P.push(u))}}else for(g=0;g<a;g++)u=3*p[c+g],o[g]=[h[u],h[u+1],h[u+2]]}return o},extractMeshNormals:function(e,t,n,r){var a=[];if(o.verifyMesh(e)){var s=e.getCount();n&&n<s&&(s=n);var c,l=r||!1,u=e.getStart(),p=e.getGroup().geometry,h=p.vertexIndexArray,d=p.vertexNormalArray,g=0,m=0;if(t&&!i.isIdentity(t))if(l){var y=[];for(g=0;g<s;g++){c=3*h[u+g];var P=!1;for(m=0;!P&&m<y.length;m++)P=c===y[m];P||(a.push(i.transformVector([d[c],d[c+1],d[c+2]],t)),y.push(c))}}else for(g=0;g<s;g++)c=3*h[u+g],a[g]=i.transformVector([d[c],d[c+1],d[c+2]],t);else if(l){var f=[];for(g=0;g<s;g++){c=3*h[u+g];var v=!1;for(m=0;!v&&m<f.length;m++)v=c===f[m];v||(a.push([d[c],d[c+1],d[c+2]]),f.push(c))}}else for(m=0;m<s;m++)c=3*h[u+m],a[m]=[d[c],d[c+1],d[c+2]]}return a},computeAABB:function(e,t){var i=e.getCount(),n=e.getStart(),o=e.getGroup().geometry,a=o.vertexIndexArray,s=o.vertexPositionArray;return r.computeAABBForUnsortedPoints(i,n,a,s,t)},computeBoundingSphere:function(e,t){var i=o.extractMeshVertices(e,t);return r.computeBoundingSphereForPoints(i)},_computeVolume:function(t,n){var r={returnCode:1};if(4===t.getGroup().glType){for(var a=o.extractMeshVertices(t),s=a.length/3,c=0,l=[0,0,0],u=[0,0,0],p=[0,0,0],h=[0,0,0],d=[0,0,0],g=[0,0,0],m=0;m<s;m++){u=i.sub(n,a[3*m],u),p=i.sub(n,a[3*m+1],p);var y=-(h=i.sub(n,a[3*m+2],h))[0]*p[1]*u[2]+p[0]*h[1]*u[2]+h[0]*u[1]*p[2]-u[0]*h[1]*p[2]-p[0]*u[1]*h[2]+u[0]*p[1]*h[2];d=i.add(u,i.add(p,h,d),d),c+=y,l=i.multiplyAndAdd(d,y,l,g)}r.returnCode=0,r.volume=c/6,r.aCog=e.isZero(c)?[0,0,0]:i.multiplyAndAdd(l,1/(4*c),n)}return r}};return o}),define("DS/WebPolyMaths/WebMeshRecognition",["DS/WebPolyMaths/WebToolsMaths","DS/WebPolyMaths/WebGeometryEnums","DS/WebPolyMaths/WebMathsVector3D","DS/WebPolyMaths/WebMathsInfiniteGeometry","DS/WebPolyMaths/WebMathsBoundingGeometry","DS/WebPolyMaths/WebMeshServices","DS/Visualization/ThreeJS_DS","DS/Visualization/Measurable"],function(e,t,i,n,r,o,a,s){"use strict";var c={recognizeCanonicGeometry:function(e,i,n){var r={returnCode:1};if(e.getDecoration()){var a=new s(e);switch(a.getType()){case s.TYPEUNKNOWN:1===(p=o.extractMeshVertices(e)).length&&(r.returnCode=0,r.type=t.GeometryType.POINT,r.position=c._buildVector3(p[0]).applyMatrix4(i));break;case s.TYPEPLANE:var l=a.getPlane();l&&(r.returnCode=0,r.type=t.GeometryType.PLANE,r.origin=c._buildVector3(l.position).applyMatrix4(i),r.normal=c._buildVector3(l.normal).transformDirection(i));break;case s.TYPECYLINDER:var u=a.getCylinder();if(u)if(r.returnCode=0,r.type=t.GeometryType.CYLINDER,r.radius=u.radius,n){var p=o.extractMeshVertices(e);0===(_=c._computeMinMaxProjection(p,u.axis,u.center)).returnCode&&(r.point1=c._buildVector3(_.aPoint1).applyMatrix4(i),r.point2=c._buildVector3(_.aPoint2).applyMatrix4(i))}else r.point1=c._buildVector3(u.center).applyMatrix4(i),r.point2=r.point1.clone().sub(c._buildVector3(u.axis)).applyMatrix4(i);break;case s.TYPECONE:var h=a.getCone();if(h){if(r.returnCode=0,r.type=t.GeometryType.CONE,r.semiAngle=h.semiAngle>Math.PI?h.semiAngle*Math.PI/180:h.semiAngle,r.apex=c._buildVector3(h.center).applyMatrix4(i),r.axis=c._buildVector3(h.axis).transformDirection(i),n){p=o.extractMeshVertices(e);var d=!0;r.semiAngle>Math.PI/2&&(d=!1),0===(_=c._computeMinMaxProjection(p,h.axis,h.center,d)).returnCode&&(r.point1=c._buildVector3(_.aPoint1).applyMatrix4(i),r.point2=c._buildVector3(_.aPoint2).applyMatrix4(i))}else r.point1=c._buildVector3(h.center).applyMatrix4(i),r.point2=r.point1.clone().sub(c._buildVector3(h.axis)).applyMatrix4(i);if(_&&void 0!==_.baseRadius){var g=_.baseRadius/Math.tan(r.semiAngle),m=r.axis.clone().normalize().negate().multiplyScalar(g);r.apex=r.point2.clone().add(m)}}break;case s.TYPESPHERE:var y=a.getSphere();y&&(r.returnCode=0,r.type=t.GeometryType.SPHERE,r.radius=y.radius,r.center=c._buildVector3(y.center).applyMatrix4(i));break;case s.TYPELINE:var P=a.getLine();P&&(r.returnCode=0,r.type=t.GeometryType.LINE,r.point1=c._buildVector3(P.startPosition).applyMatrix4(i),r.point2=c._buildVector3(P.endPosition).applyMatrix4(i));break;case s.TYPECIRCLE:var f=a.getCircle();f&&(r.returnCode=0,r.type=t.GeometryType.CIRCLE,r.radius=f.radius,r.center=c._buildVector3(f.center).applyMatrix4(i),r.normal=c._buildVector3(f.axis).transformDirection(i))}r.exact=0===r.returnCode}if(1===r.returnCode){if(void 0===e._bNotRecognized){if(o.verifyMesh(e)){p=o.extractMeshVertices(e);var v=e.getGroup().glType,T=p.length;if(1===T)r.returnCode=0,r.type=t.GeometryType.POINT,r.position=c._buildVector3(p[0]).applyMatrix4(i);else if(2===T)0===(r=c._recognizeLine(p)).returnCode&&(r.point1=c._buildVector3(r.aPoint1).applyMatrix4(i),r.point2=c._buildVector3(r.aPoint2).applyMatrix4(i));else{if(1===v)0===(_=c._recognizeCircle(p)).returnCode?((r=_).center=c._buildVector3(r.aCenter).applyMatrix4(i),r.normal=c._buildVector3(r.aNormal).transformDirection(i)):0===(r=c._recognizeLine(p)).returnCode&&(r.point1=c._buildVector3(r.aPoint1).applyMatrix4(i),r.point2=c._buildVector3(r.aPoint2).applyMatrix4(i));else if(4===v){var _;if(0===(_=c._recognizePlane(p)).returnCode)(r=_).origin=c._buildVector3(r.aOrigin).applyMatrix4(i),r.normal=c._buildVector3(r.aNormal).transformDirection(i);else{var C=o.extractMeshNormals(e);0===(r=c._recognizeCylinder(p,C)).returnCode?(r.point1=c._buildVector3(r.aPoint1).applyMatrix4(i),r.point2=c._buildVector3(r.aPoint2).applyMatrix4(i)):0===(r=c._recognizeSphere(p,C)).returnCode?r.center=c._buildVector3(r.aCenter).applyMatrix4(i):0===(r=c._recognizeCone(p,C)).returnCode&&(r.apex=c._buildVector3(r.aApex).applyMatrix4(i),r.axis=c._buildVector3(r.aAxis).applyMatrix4(i),r.point1=c._buildVector3(r.aPoint1).applyMatrix4(i),r.point2=c._buildVector3(r.aPoint2).applyMatrix4(i))}}}}1===r.returnCode&&(e._bNotRecognized=!0)}r.exact=!1}return r},recognizeNonCanonicGeometry:function(e,t,i){var n={returnCode:1};if(o.verifyMesh(e)){var r=o.extractMeshVertices(e,t.elements),a=e.getGroup().glType;if(1===a){var s=c._recognizeCircle(r,i);0===s.returnCode&&i?((n=s).center=c._buildVector3(n.aCenter).applyMatrix4(t),n.normal=c._buildVector3(n.aNormal).transformDirection(t)):0===(n=c._recognizeCurve(r,i)).returnCode&&i&&(n.point1=c._buildVector3(n.aPoint1),n.point2=c._buildVector3(n.aPoint2))}else 4===a&&0===(n=c._recognizeSurface(r,i)).returnCode&&i&&(n.cog=c._buildVector3(n.aCog))}return n},_recognizeLine:function(n){var r={returnCode:1},o=n.length;if(2===o)r.returnCode=0,r.type=t.GeometryType.LINE,r.aPoint1=n[0],r.aPoint2=n[1];else if(o>2){for(var a,s=i.sub(n[1],n[0]),c=!0,l=1;c&&l<o;l++)a=i.sub(n[l],n[0]),c=e.isZero(i.length(i.cross(s,a)));if(c){for(var u=0,p=1,h=0,d=i.dot(s,s),g=2;g<o;g++){a=i.sub(n[g],n[0]);var m=i.dot(s,a);m<h?(u=g,h=m):m>d&&(p=g,d=m)}r.returnCode=0,r.type=t.GeometryType.LINE,r.aPoint1=n[u],r.aPoint2=n[p]}}return r},_recognizePlane:function(n){for(var r,o,a={returnCode:1},s=n.length,c=0,l=0,u=1;u<s&&0===l;u++)if(0===c)r=i.sub(n[0],n[u]),i.length(r)>.1&&(c=u);else if(0===l&&(o=i.sub(n[0],n[u]),i.length(o)>.1)){var p=i.angle(r,o);p>.02&&p<Math.PI-.02&&(l=u)}if(0!==c&&0!==l){for(var h=i.cross(r,o),d=!0,g=0;d&&g<s;g++)if(0!==g&&g!==c&&g!==l){var m=i.sub(n[0],n[g]),y=i.cross(r,m);if(!e.isZero(i.length(y))){var P=i.angle(h,y);d=!(P>.02&&P<Math.PI-.02)}}d&&(a.returnCode=0,a.type=t.GeometryType.PLANE,a.aOrigin=n[0],a.aNormal=i.normalize(h))}return a},_recognizeCircle:function(n){var r={returnCode:1},o=n.length;if(o>6){var a=c._recognizePlane(n);if(a&&a.type===t.GeometryType.PLANE){var s=a.aNormal,l=Math.floor(2*o/3),u=Math.floor(o/3),p=c._computeCircleThru3Points(n[0],n[u],n[l]);if(0===p.returnCode){for(var h=p.radius,d=p.aCenter,g=!0,m=0;g&&m<o;m++){var y=i.length(i.sub(n[m],d));g=e.areEqual(h,y,"float",.0017)}if(g){r.returnCode=0,r.type=t.GeometryType.CIRCLE,r.radius=p.radius,r.aCenter=p.aCenter,r.aNormal=s,r.length=2*Math.PI*p.radius;var P=i.sub(n[0],p.aCenter),f=Math.ceil(o/2),v=i.sub(n[f-1],p.aCenter),T=i.sub(n[o-1],p.aCenter),_=i.angle(P,v)+i.angle(v,T);r.arcLength=r.length*(_/(2*Math.PI))}}}}return r},_recognizeCylinder:function(e,n,r){var o={returnCode:1},a=r&&r<=e.length?r:e.length,s=!0;if(a>50){var l=c._recognizeCylinder(e,n,50);s=void 0!==l&&void 0!==l.type&&l.type===t.GeometryType.CYLINDER}if(s){var u,p,h,d=!1;if(a>7)for(var g=0;g<a;g++)for(var m=g+1;m<a;m++)if(p=i.cross(n[g],n[m]),d){var y=i.dot(h,p);u=i.add(u,i.multiply(p,y))}else i.length(p)>.1&&(d=!0,h=p,u=p);if(u){h=i.normalize(u),u=[0,0,0];for(var P=0,f=[],v=0;v<a;v++)p=i.cross(n[v],h),i.length(p)/i.length(n[v])>.7?(P++,f[v]=1):f[v]=0;var T=!0;if(P>1){for(var _=0;_<a&&1===f[_];_++)for(var C=_+1;C<a&&1===f[C];C++)if(p=i.cross(n[_],n[C]),d){var M=i.dot(h,p);u=i.add(u,i.multiply(p,M))}else i.length(p)>.1&&(d=!0,h=p,u=p);u=i.normalize(u);for(var E=0;E<a&&1===f[E]&&T;E++)p=i.cross(n[E],u),1-i.length(p)/i.length(n[E])>.02&&(T=!1)}else T=!1;if(.1>=i.length(u)&&(T=!1),T){for(var A,b=0,S=[],R=0,D=0,V=0,I=0,x=0;x<a;x++){A=i.dot(i.sub(e[0],e[x]),u);for(var N=i.sub(i.multiply(u,A),e[x]),L=!1,G=0;G<b&&!L;G++){L=i.subAndLength(S[G],N)<.1}L||(S[b]=N,b++),A>V&&(V=A,I=x),A<R&&(R=A,D=x)}var w=c._recognizeCircle(S);if(w&&w.type===t.GeometryType.CIRCLE){A=i.dot(i.sub(w.aCenter,e[D]),u);var B=i.add(i.multiply(u,A),w.aCenter);A=i.dot(i.sub(w.aCenter,e[I]),u);var O=i.add(i.multiply(u,A),w.aCenter);o.returnCode=0,o.type=t.GeometryType.CYLINDER,o.radius=w.radius,o.aPoint1=B,o.aPoint2=O}}}}return o},_recognizeCone:function(r,o,a,s){var l={returnCode:1},u=a&&a<=r.length?a:r.length,p=s&&s<=o.length?s:o.length,h=!0;if(u>50){var d=c._recognizeCone(r,o,50,50);h=void 0!==d&&void 0!==d.type&&d.type===t.GeometryType.CONE}if(h){if(3<u){for(var g=[],m=1;m<u;m++)i.areEqual(r[0],r[m])||g.push(r[m]);var y=c._recognizeCircle(g);if(y&&y.type===t.GeometryType.CIRCLE){var P=i.sub(y.aCenter,r[0]);i.areEqual(i.normalize(P),y.aNormal)&&(l.returnCode=0,l.type=t.GeometryType.CONE,l.aApex=r[0],l.aPoint1=r[0],l.aPoint2=y.aCenter,l.aAxis=y.aNormal,l.semiAngle=i.angle(i.sub(r[1],r[0]),P))}}if(0!==l.returnCode&&u===p){for(var f=!1,v=-1,T=-1,_=-1,C=-1,M=0;M<p&&!f;M++)for(var E=M+1;E<p&&!f;E++)i.areEqual(o[M],o[E])&&!i.areEqual(r[M],r[E])&&(0>v?(v=M,_=E):i.areEqual(o[v],o[M])||(T=M,C=E,f=!0));if(0<=v&&0<=_&&0<=T&&0<=C){var A,b,S=i.sub(r[v],r[_]),R=i.cross(S,o[v]),D=i.sub(r[T],r[C]),V=i.cross(D,o[T]),I=!1,x=i.angle(R,V);if(x>.02&&x<Math.PI-.02){if(0===(A=n.computeLinePlaneDistance(r[v],S,r[T],V)).returnCode&&A.relationship===t.Relationship.INTERSECTING)0===(b=n.computeLinePlaneDistance(r[v],o[v],r[T],V)).returnCode&&b.relationship===t.Relationship.INTERSECTING&&(I=!0,l.aApex=A.aPosition,l.aAxis=i.normalize(i.sub(A.aPosition,b.aPosition)))}else if(0===(A=n.computeTwoLinesDistance(r[v],S,r[T],D)).returnCode&&A.relationship===t.Relationship.INTERSECTING)0===(b=n.computeTwoLinesDistance(r[v],o[v],r[T],o[T])).returnCode&&b.relationship===t.Relationship.INTERSECTING&&(I=!0,l.aApex=A.aPosition1,l.aAxis=i.normalize(i.sub(A.aPosition1,b.aPosition1)));if(I&&l.aAxis){l.semiAngle=i.angle(S,l.aAxis);for(var N=0;N<u&&I;N++)P=i.sub(l.aApex,r[N]),x=i.angle(P,l.aAxis),I=e.areEqual(l.semiAngle,x);if(I){l.returnCode=0,l.type=t.GeometryType.CONE;var L=c._computeMinMaxProjection(r,l.aAxis,l.aApex);l.aPoint1=L.aPoint1,l.aPoint2=L.aPoint2}}}}}return l},_recognizeSphere:function(n,r){var o={returnCode:1},a=n.length;if(a===r.length){for(var s,l,u,p,h,d=0,g=0,m=0,y=1;y<a&&0===m;y++)0===d?(s=i.sub(n[0],n[y]),i.length(s)>.1&&(d=y)):0===g?(l=i.sub(n[0],n[y]),i.length(l)>.1&&(h=i.angle(s,l))>.02&&h<Math.PI-.02&&(g=y,p=i.cross(s,l))):0===m&&(u=i.sub(n[0],n[y]),i.length(u)>.1&&(h=i.angle(p,i.cross(s,u)))>.02&&h<Math.PI-.02&&(m=y));if(0!==d&&0!==g&&0!==m){var P=c._computeSphereThru4Points(n[0],n[d],n[g],n[m]);if(0===P.returnCode){for(var f,v,T=!0,_=0;_<a&&T;_++)v=i.sub(n[_],P.aCenter),f=i.length(v),T=e.areEqual(P.radius,f)&&i.areEqual(i.normalize(v),i.normalize(r[_]));T&&(o.returnCode=0,o.type=t.GeometryType.SPHERE,o.aCenter=P.aCenter,o.radius=P.radius)}}}return o},_recognizeCurve:function(e,n){var r={returnCode:0};if(r.type=t.GeometryType.CURVE,r.length=0,n){for(var o=e.length,a=0,s=0;s<o;s+=2)a+=i.length(i.sub(e[s],e[s+1]));r.length=a,r.aPoint1=e[0],r.aPoint2=e[o-1]}return r},_recognizeSurface:function(n,r){var o={returnCode:1};if(o.type=t.GeometryType.SURFACE,o.area=0,r){for(var a=n.length/3,s=0,c=[0,0,0],l=0;l<a;l++){var u=i.sub(n[3*l],n[3*l+1]),p=i.sub(n[3*l],n[3*l+2]),h=i.length(i.cross(u,p)),d=i.add(n[3*l],i.add(n[3*l+1],n[3*l+2]));s+=h,c=i.multiplyAndAdd(d,h,c)}o.returnCode=0,o.area=s/2,o.aCog=e.isZero(s)?[0,0,0]:i.multiply(c,1/(3*s))}return o},_computeMinMaxProjection:function(e,t,r,o){for(var a,s={returnCode:0},c=e.length,l=i.normalize(t),u=Number.MAX_VALUE,p=-Number.MAX_VALUE,h=[0,0,0],d=0,g=0;g<c;g++)if((a=i.dot(i.sub(r,e[g],h),l))>p&&(p=a),a<u&&(u=a),o){var m=n.computePointLineDistance(e[g],r,t);m.distance>d&&(d=m.distance)}return s.aPoint1=i.multiplyAndAdd(l,u,r),s.aPoint2=i.multiplyAndAdd(l,p,r),o&&(s.baseRadius=d),s},_computeCircleThru3Points:function(e,n,r){var o={returnCode:1},a=i.sub(e,n),s=i.sub(n,r),c=i.cross(a,s);if(i.areEqual(e,n))o.aCenter=i.multiply(i.add(e,r),.5),c=i.cross([0,0,1],s);else if(i.areEqual(e,r))o.aCenter=i.multiply(i.add(e,n),.5),c=i.cross([0,0,1],a);else if(i.areEqual(n,r))o.aCenter=i.multiply(i.add(e,n),.5),c=i.cross([0,0,1],a);else{var l=i.squaredLength(c);if(l>1e-6){var u=(.5*i.squaredLength(s)+.5*i.dot(a,s))/l,p=i.multiplyAndAdd(a,.5,e);o.aCenter=i.multiplyAndAdd(i.cross(a,c),-u,p)}}return void 0!==o.aCenter&&(o.returnCode=0,o.type=t.GeometryType.CIRCLE,o.radius=i.subAndLength(o.aCenter,e),o.aNormal=i.normalize(c)),o},_computeSphereThru4Points:function(e,r,o,a){var s={returnCode:1},l=c._computeCircleThru3Points(e,r,o);if(0===l.returnCode){var u=c._computeCircleThru3Points(r,o,a);if(0===u.returnCode){var p=n.computeTwoLinesDistance(l.aCenter,l.aNormal,u.aCenter,u.aNormal);0===p.returnCode&&p.relationship===t.Relationship.INTERSECTING&&(s.returnCode=0,s.type=t.GeometryType.SPHERE,s.aCenter=p.aPosition1,s.radius=i.subAndLength(s.aCenter,e))}}return s},_buildVector3:function(e){return new a.Vector3(e[0],e[1],e[2])},verifyMesh:function(e){return console.log("DEPRECATED: use WebMeshServices.verifyMesh"),o.verifyMesh(e)},extractMeshVertices:function(e,t){return console.log("DEPRECATED: use WebMeshServices.extractMeshVertices"),o.extractMeshVertices(e,t)},extractMeshNormals:function(e,t){return console.log("DEPRECATED: use WebMeshServices.extractMeshNormals"),o.extractMeshNormals(e,t)},_computeVolume:function(e,t){return console.log("DEPRECATED: use WebMeshServices._computeVolume"),o._computeVolume(e,t)}};return c}),define("DS/WebPolyMaths/WebToolsSceneGraph",["DS/Visualization/PathElement","DS/SceneGraphOverrides/SceneGraphOverrideSet","DS/Visualization/IdPath","DS/Visualization/IdPathMatcher","DS/Visualization/ThreeJS_DS","DS/WebPolyMaths/WebToolsMaths"],function(e,t,i,n,r,o){"use strict";var a=void 0,s={callPad3DViewerModelServices:function(e,t){return!a&&require.defined("DS/ENOPAD3DViewer/utils/PAD3DViewerModelServices")&&(a=require("DS/ENOPAD3DViewer/utils/PAD3DViewerModelServices")),a&&e&&a[e]?a[e](t):void 0},isReference:function(e){var t=!1;return e&&((t=s.callPad3DViewerModelServices("isReference",e))||(t=void 0!==e.productType?"Reference3D"===e.productType||"ReferenceRep"===e.productType:t),t||(t=void 0!==e.isPLMReference?e.isPLMReference():t)),t},isRepReference:function(e){var t=!1;return e&&((t=s.callPad3DViewerModelServices("isRepReference",e))||(t=void 0!==e.productType?"RepReference3D"===e.productType||"ReferenceRep"===e.productType:t),t||(t=void 0!==e.isPLMRepReference?e.isPLMRepReference():t)),t},isRepInstance:function(e){var t=!1;return e&&((t=s.callPad3DViewerModelServices("isRepInstance",e))||(t=void 0!==e.productType?"RepInstance3D"===e.productType||"InstanceRep"===e.productType:t),t||(t=void 0!==e.isPLMRepInstance?e.isPLMRepInstance():t)),t},isInstance:function(e){var t=!1;return e&&((t=s.callPad3DViewerModelServices("isInstance",e))||(t=void 0!==e.productType?"Instance3D"===e.productType||"InstanceRep"===e.productType:t),t||(t=void 0!==e.isPLMInstance?e.isPLMInstance():t)),t},isReferenceOrInstance:function(e,t){var i=s.isReference(e);return i||(i=s.isInstance(e)),i||(i=s.isRepInstance(e)),!i&&t&&(i=s.isRepReference(e)),i},isLeaf:function(e,t){var i=!0;if(t&&s.isPLMNode(e))(i=s.is3DLeaf(e))||(i=s.isRepReference(e));else if(e){for(var n=!1,r=0;r<e.children.length;r++)if(s.isReferenceOrInstance(e.children[r],t)){n=!0;break}i=!n}return i},is3DLeaf:function(e){var t=s.callPad3DViewerModelServices("is3DLeaf",e);return!t&&e&&e.is3DLeaf&&(t=e.is3DLeaf()),t},isPLMNode:function(e,t){var i=s.callPad3DViewerModelServices("isPLMNode",e);return i||t||(i=s.isReferenceOrInstance(e,!0)),i},isAModelPath:function(e){return s.callPad3DViewerModelServices("isAModelPath",e)},getNodeType:function(e){var t=s.callPad3DViewerModelServices("getNodeType",e);return!t&&e&&e.getType&&(t=e.getType()),t},getNodeID:function(e){var t=s.callPad3DViewerModelServices("getNodeID",e);return t||(t=e&&"string"==typeof e.persistentId?e.persistentId:t),t||(t=e&&e.getID?e.getID():t),"string"==typeof t?t:""},isVisible:function(e,t){var i=!1;if(t&&e){var n=e.getSceneGraphOverrideSetManager().getCurrentVisibility(t);i=null==n||n}return i},parseForLeafNodes:function(e,t,i,n){if(e&&t){var r=e.clone(),o=r.getChildrenPathes();if(s.isLeaf(r.getLastElement(!0),!0)||0===o.length)s.isVisible(t,r)?i&&i.push(r):n&&n.push(r);else for(var a=0;a<o.length;a++)s.isReferenceOrInstance(o[a].getLastElement(!0),!0)&&(s.isVisible(t,o[a])?s.parseForLeafNodes(o[a],t,i,n):n&&n.push(o[a].clone()))}},parseForLeafNodesOfScene:function(e,t,i){for(var n=e?e.getRootBagPath().getChildrenPathes():[],r=0;r<n.length;r++)s.parseForLeafNodes(n[r],e.getViewer(),t,i)},getName:function(e,t,i,n){var r=n||"";if(e&&t){for(var o=[],a=[],c=!0,l=e.length,u=0;u<l;u++){var p=e[u],h=s.callPad3DViewerModelServices("getNodeID",p);h?(c=!1,(s.isInstance(p)||s.isRepInstance(p))&&(p=p.children[0]),a.push(h),o.push(r)):o.push(p.name)}if(t(o),!c){var d=[];for(u=0;u<a.length;u++){for(var g=!1,m=0;!g&&m<u;m++)g=a[u]===a[m];g||d.push(a[u])}var y=i.getController();y.getAttributes({ids:d,attributes:["ds6w:label"],callbacks:{onComplete:function(e){o=[];for(var i=0;i<a.length;i++){var n=e[a[i]];o.push(n["ds6w:label"])}t(o)},onFailure:function(){return null}}})}}},getNameWithInstances:function(e,t,i,n,r){var o=r;if(e&&t){var a,c=[],l=e;if(l){var u=s.getLastReference(l),p=u.getLastElement(!0);if(s.isPLMNode(p)&&(s.isReference(p)||s.is3DLeaf(p))){a={pathElement:l,idRef:s.getNodeID(p)},c.push(a.idRef);var h=s.getLastInstance(u).getLastElement(!0);s.isPLMNode(h)&&s.isInstance(h)&&c.push(a.idInst=s.getNodeID(h))}}if(!c.length)return;i.getController().getAttributes({ids:c,attributes:["ds6w:label"],callbacks:{onComplete:function(e){i=void 0;var i=e[a.idRef]?e[a.idRef]["ds6w:label"]:"";a.idInst&&e[a.idInst]&&e[a.idInst]["ds6w:label"]&&(i+=" ("+e[a.idInst]["ds6w:label"]+")"),t({name:i,forPathNum:o})},onFailure:function(){return null}}})}},getRoots:function(e){var t=s.callPad3DViewerModelServices("getRoots",e);return void 0===t&&e.getRoots&&(t=e.getRoots()),t},getProductRoots:function(e){var t=[];return s._recursiveGetProductRoots(e.getRootNode(),t,!0),t},_recursiveGetProductRoots:function(e,t,i){for(var n=e.children,r=n.length,o=0;o<r;o++)if(!0===s.isReference(n[o])){if(!i){t.push(e);break}t.push(n[o])}else s._recursiveGetProductRoots(n[o],t,!1)},getRootReferences:function(e){var t=[];return s._recursiveGetRootReferences(e.getRootNode(),t),t},_recursiveGetRootReferences:function(e,t){if(s.isReference(e)||s.isRepReference(e))t.push(e);else for(var i=e.children,n=i.length,r=0;r<n;r++)s._recursiveGetRootReferences(i[r],t)},getSceneRoot:function(e){return e.getRootNode()},getViewerRoot:function(e){return e.getRootNode()},getRootBag:function(e){var t=require("DS/PADUtils/PADContext").get();return t&&t.getViewer()===e?t.getRootBagPath().getElement(0):e.getRootNode().getChildByName("RootBag")},recursiveGetPathElementVisibility:function(e,t){var i;if(e.hasSceneGraphOverrideSet()){var n=e.getSceneGraphOverrideSetManager();if(n)for(var r=n.getNumberOfSceneGraphOverrideSets(),o=0;o<r;o++){var a=n.getSceneGraphOverrideSetAt(o);if(a){var c=a.getOverridesFromPathElement(t);if(c)for(var l=0;l<c.length&&null===(i=c[l].getVisibility());l++);else{var u=t.getChildrenPathes();for(l=0;l<u.length&&null===(i=s.recursiveGetPathElementVisibility(e,u[l]));l++);}}}else if(e&&t&&e.sceneGraphState&&null===(i=e.sceneGraphState.getAppliedVisibility(t))){var p=t.getChildrenPathes();for(l=0;l<p.length&&null===(i=s.recursiveGetPathElementVisibility(e,p[l]));l++);}}return i},isVisible:function(e,t){var i=!1;if(t&&e){var n=e.getSceneGraphOverrideSetManager().getCurrentVisibility(t);i=null==n||n}return i},getFirstReference:function(t){for(var i=new e,n=t.getLength(),r=0;r<n;r++){var o=t.getElement(r);if(s.isReference(o)||s.isRepReference(o)){i.addElement(o);break}}return i},getLastReference:function(t){return t.getLength()>1?s.isReference(t.getLastElement(!0))?t.clone():s.getLastReference(t.getParentPath()):new e},getLastRepReference:function(t){return t.getLength()>1?s.isRepReference(t.getLastElement(!0))?t.clone():s.getLastRepReference(t.getParentPath()):new e},getLastInstance:function(t){return t.getLength()>1?s.isInstance(t.getLastElement(!0))||s.isRepInstance(t.getLastElement(!0))?t.clone():s.getLastInstance(t.getParentPath()):new e},truncatePathElement:function(t,i){for(var n=new e,r=Math.min(t.getLength(),i),o=0;o<r;o++)n.addElement(t.getElement(o));return n},buildPathElement:function(t){for(var i=new e,n=[],r=t;r&&!r.notAllowedInPathElement;)n.splice(0,0,r),r=r.parents[0];return i.setFromArray(n),i},isDescendant:function(e,t){var i=!1,n=e.getLength();if(t.getLength()>=n){i=!0;for(var r=0;i&&r<n;r++)i=t.getElement(r)===e.getElement(r)}return i},getAllOthers:function(e){for(var t=[],i=e;i&&this.isReferenceOrInstance(i.getLastElement());)t=t.concat(this._getBrothers(i)),i=i.getParentPath();return t},_getBrothers:function(e){var t=[],i=e.getParentPath();return i&&(t=i.getChildrenPathes(e)),t},getRenderables:function(e){return e._getRenderableOccurrences()},getRootBagId:function(){var e=require("DS/PADUtils/PADContext").get();return e&&e.getController()&&e.getController().getRootBagId?e.getController().getRootBagId():"rootBag"},getContextViewer:function(e){var t=require("DS/PADUtils/PADContext").get();return t&&t.getViewer()===e.viewer?t:null},initIdPathMatcher:function(e){var t=function(e,i){if(s.getNodeID(i)===e)return i;var n,r=i.children;if(r&&r.length)for(var o=0;o<r.length;o++)if(n=t(e,r[o]))return n};e.setIdPathMatcher(new n({idToNodeCB:function(i){var n=require("DS/PADUtils/PADContext").get();if(n)return i===s.getRootBagId()?s.getRootBag(e):n&&n.getController().getNode({id:i})?n.getController().getNode({id:i}):t(i,s.getRootBag(e))},nodeToIdCB:function(t){return t===s.getRootBag(e)?s.getRootBagId():s.getNodeID(t)},isNodeRepRefCB:function(t){return t!==s.getRootBag(e)&&s.isRepReference(t)}}))},createSceneGraphOverrideSet:function(e){e.getIdPathMatcher()||s.initIdPathMatcher(e);var i,n=e.getSceneGraphOverrideSetManager(),r=s.getRootBag(e);return r&&n&&(i=new t(r,s.getRootBagId()),n.pushSceneGraphOverrideSet(i)),i},ensurePriorityOfSceneGraphOverrideSet:function(e,t){if(e&&t){var i=e.getSceneGraphOverrideSetManager();i&&i.getSceneGraphOverrideSetIndex(t)!==i.getNumberOfSceneGraphOverrideSets()-1&&(i.removeSceneGraphOverrideSet(t),i.pushSceneGraphOverrideSet(t))}},removeSceneGraphOverrideSet:function(e,t){if(e&&t){var i=e.getSceneGraphOverrideSetManager();i&&i.removeSceneGraphOverrideSet(t)}},getIdPath:function(e){var t=[];return e&&e.externalPath.forEach(function(e){if("RootBag"!==e.name){var i=s.getNodeID(e);i&&s.isPLMNode(e)&&t.push(i)}}),t},getOverrides:function(e,t,n){var r,o,a,c=[];if(e&&t)if(t.pathElements&&t.pathElements.length)t.pathElements.forEach(function(t){if(o=t.clone(),e._viewers[0]){var i=s.getRootBag(e._viewers[0].viewer);o.getElement(0).id!==i.id&&o.externalPath.unshift(i)}(r=e.getUniqueOverrideFromPathElement(o))||n||(r=e.createOverride({pathes:[o]})),r&&c.push(r)});else if(t.idPaths&&t.idPaths.length){var l=s.getRootBagId();t.idPaths.forEach(function(s){Array.isArray(s)&&((o=s.slice())[0]!==l&&o.unshift(l),a=new i(o),(r=e.getUniqueOverrideFromIdPath(a))||n||(r=e.createIdPathOverride({idPathes:[a],propagateUntilRepRefs:t.propagateUntilRepRefs,propagateToParents:t.propagateToParents})),r&&c.push(r))})}return c},removeOverride:function(e,t){if(e&&t){var n;if(t.pathElement){var r=t.pathElement.clone();if(e._viewers[0]){var o=s.getRootBag(e._viewers[0].viewer);r.getElement(0).id!==o.id&&r.externalPath.unshift(o)}n=e.getUniqueOverrideFromPathElement(r)}else if(t.idPath){var a=t.idPath.slice(),c=s.getRootBagId();a[0]!==c&&a.unshift(c),n=e.getUniqueOverrideFromIdPath(new i(a))}n&&e.deleteOverride(n)}},computeBoundingBox:function(e,t){var i,n,r,o=0;if(t&&(o=t.length)>0){var a,c,l;for(r=0;r<o;r++)(l=t[r])&&(a=s.getLastReference(l).getLastElement())&&(n=a.getBoundingBox(),(c=l.getWorldMatrix())&&n.applyMatrix4(c),0===r?i=n:i.mergeWithBox(n))}else{var u=s.getRootReferences(e);for(o=u.length,r=0;r<o;r++)n=u[r].getBoundingBox(),0===r?i=n:i.mergeWithBox(n)}return i},computeBoundingSphere:function(e){var t,i,n,r,o=s.getRootReferences(e);for(n=o.length,r=0;r<n;r++)i=o[r].getBoundingSphere(),t?i&&i.radius&&t.mergeWithSphere(i,t):t=i;return t},getXYAxisDirFromZ:function(e){if(e){var t,i;e.normalize();var n=(t=new r.Vector3(1,0,0).projectOnPlane(e)).length(),a=(i=new r.Vector3(0,1,0).projectOnPlane(e)).length(),s=(new r.Vector3).crossVectors(new r.Vector3(0,0,1),e),c=new r.Vector3(0,0,1).dot(e);return o.areEqual(Math.abs(c),1,"float")?o.areEqual(n,a,"float")?(t.normalize(),i=(new r.Vector3).crossVectors(e,t).normalize()):n<a?(i.normalize(),t=(new r.Vector3).crossVectors(i,e).normalize()):(t.normalize(),i=(new r.Vector3).crossVectors(e,t).normalize()):(t=s.normalize(),i=(new r.Vector3).crossVectors(e,t).normalize()),{xDir:t,yDir:i}}},getMatFromNormWithPos:function(e,t){if(e&&t){var i=e.clone().negate().normalize(),n=s.getXYAxisDirFromZ(i),o=n.xDir,a=n.yDir,c=(new r.Matrix4).makeBasis(o,a,i.negate()),l=(new r.Vector3).copy(t);return c.setPosition(l),c}}};return s}),define("DS/WebPolyMaths/WebMathsFiniteGeometry",["DS/WebPolyMaths/WebMathsVector3D","DS/WebPolyMaths/WebMathsInfiniteGeometry","DS/WebPolyMaths/WebGeometryEnums"],function(e,t,i){"use strict";var n={computePointSegmentDistance:function(t,n,r,o){var a={returnCode:1};if(t&&n&&r){a.returnCode=2;var s=void 0!==o?o:Number.MAX_VALUE;if(s>1e-6){var c=e.sub(t,n),l=e.sub(n,r),u=-e.dot(c,l);if(u<=0)a.aPosition=e.clone(n),s=e.squaredLength(c);else{var p=e.squaredLength(l);p<1e-6?(a.aPosition=e.clone(n),s=e.squaredLength(c)):(u/=p)>=1?(a.aPosition=e.clone(r),s=e.subAndSquaredLength(r,t)):(a.aPosition=e.multiplyAndAdd(l,u,n),s=e.subAndSquaredLength(a.aPosition,t))}(void 0===o||o>s)&&(a.returnCode=0,a.squaredDistance=s,a.distance=Math.sqrt(s),a.relationship=s<1e-6?i.Relationship.COINCIDENT:i.Relationship.NONE)}}return a},computePointTriangleDistance:function(t,r,o,a,s){var c={returnCode:1};if(t&&r&&o&&a){c.returnCode=2;var l=e.sub(r,o),u=e.squaredLength(l),p=e.sub(r,a),h=e.squaredLength(p),d=e.sub(o,a),g=e.squaredLength(d);if(u<1e-6)c=n.computePointSegmentDistance(t,r,a);else if(h<1e-6||g<1e-6)c=n.computePointSegmentDistance(t,r,o);else{var m=e.sub(t,r),y=e.dot(l,p),P=e.dot(l,m),f=e.dot(p,m),v=u*h-y*y,T=y*f-h*P,_=y*P-u*f;if(T+_<=v)T<0?_<0?P<0?(_=0,T=-P>=u?1:-P/u):(T=0,_=f>=0?0:-f>=h?1:_=-f/h):(T=0,_=f>=0?0:-f>=h?1:-f/h):_<0?(_=0,T=P>=0?0:-P>=u?1:-P/u):(T*=v=1/v,_*=v);else{var C=0,M=0,E=0,A=0;T<0?(M=h+f)>(C=y+P)?_=1-(T=(E=M-C)>=(A=u-2*y+h)?1:E/A):(T=0,_=M<=0?1:f>=0?0:-f/h):_<0?(M=h+f)>(C=y+P)?_=1-(T=(E=M-C)>=(A=u-2*y+h)?1:E/A):(T=0,_=M<=0?1:f>=0?0:-f/h):_=1-(T=(E=h+f-y-P)<=0?0:E>=(A=u-2*y+h)?1:E/A)}c.aPosition=e.multiplyAndAdd(p,_,e.multiplyAndAdd(l,T,r)),c.squaredDistance=e.subAndSquaredLength(c.aPosition,t),(void 0===s||c.squaredDistance<s)&&(c.relationship=c.squaredDistance<1e-6?i.Relationship.COINCIDENT:i.Relationship.NONE,c.returnCode=0)}}return c},computeTwoSegmentsDistance:function(t,r,o,a,s){var c={returnCode:1};if(t&&r&&o&&a){if(c.returnCode=2,e.areEqual(t,r))return(c=n.computePointSegmentDistance(t,o,a,s)).angle=0,c.aPosition1=e.clone(t),c.aPosition2=c.aPosition,c;if(e.areEqual(o,a))return(c=n.computePointSegmentDistance(o,t,r,s)).angle=0,c.aPosition1=c.aPosition,c.aPosition2=e.clone(o),c;var l=!1,u=e.sub(t,r),p=e.sub(o,a),h=e.cross(u,p),d=e.squaredLength(h),g=0,m=0,y=0,P=0,f=0,v=0,T=0,_=0,C=0,M=0;if(d>1e-6*e.squaredLength(u)*e.squaredLength(p)){if(y=e.sub(t,o),M=e.dot(y,h),M*=M,void 0!==s&&M>s*d)return c;var E=e.cross(h,y);v=e.dot(E,u),T=e.dot(E,p);var A=!1;v<=0?f=e.clone(o):v>=d?f=e.clone(a):A=1;var b=!1;if(T<=0?P=e.clone(t):T>=d?P=e.clone(r):b=1,A||b)if(_=0,A&&b){var S=1/d;v*=S,T*=S,f=e.multiplyAndAdd(p,v,o),P=e.multiplyAndAdd(u,T,t),M*=S}else if(A){if(g=e.sub(o,P),_=e.squaredLength(p),h=e.cross(p,g),M=e.squaredLength(h),void 0!==s&&M>s*_)return c;if((C=e.dot(p,g))<=0){if(f=e.clone(o),M=e.squaredLength(e.sub(f,P)),void 0!==s&&M>s*_)return c}else if(C>=_){if(f=e.clone(a),M=e.squaredLength(e.sub(f,P)),void 0!==s&&M>s*_)return c}else M*=_=1/_,C*=_,f=e.multiplyAndAdd(p,C,o)}else{if(m=e.sub(f,t),_=e.squaredLength(u),h=e.cross(u,m),M=e.squaredLength(h),void 0!==s&&M>s*_)return c;if((C=-(C=e.dot(u,m)))<=0){if(P=e.clone(t),M=e.squaredLength(e.sub(f,P)),void 0!==s&&M>s*_)return c}else if(C>=_){if(P=e.clone(r),M=e.squaredLength(e.sub(f,P)),void 0!==s&&M>s*_)return c}else M*=_=1/_,C*=_,P=e.multiplyAndAdd(u,C,t)}else{var R;m=e.sub(f,t),T=-e.dot(m,u),_=e.squaredLength(u),T<=0?R=e.clone(t):T>=_?R=e.clone(r):(T/=_,R=e.multiplyAndAdd(u,T,t));var D,V=e.subAndSquaredLength(f,R);g=e.sub(o,P),v=e.dot(g,p),C=e.squaredLength(p),v<=0?D=e.clone(o):v>=C?D=e.clone(a):(v/=C,D=e.multiplyAndAdd(p,v,o));var I=e.subAndSquaredLength(P,D);if(V<=I){if(void 0!==s&&V>s)return c;M=V,P=R}else{if(void 0!==s&&I>s)return c;M=I,f=D}}}else{l=!0,_=e.squaredLength(p),y=e.sub(o,t),v=e.dot(y,p);var x=e.sub(o,r);if(T=e.dot(x,p),_<1e-6||Math.abs(v-T)<1e-6)return c;if(v>_?T>_?(f=e.clone(a),P=T>=v?e.clone(t):e.clone(r)):T>=0?(P=e.clone(r),T/=_,f=e.multiplyAndAdd(p,T,o)):(f=e.clone(o),T=v/(v-T),P=e.multiplyAndAdd(u,T,t)):v<0?T<0?(f=e.clone(o),P=T<v?e.clone(t):e.clone(r)):T<=_?(P=e.clone(r),T/=_,f=e.multiplyAndAdd(p,T,o)):(f=e.clone(o),T=v/(v-T),P=e.multiplyAndAdd(u,T,t)):(P=e.clone(t),v/=_,f=e.multiplyAndAdd(p,v,o)),M=e.squaredLength(e.sub(f,P)),void 0!==s&&M>s)return c}(void 0===s||M<s)&&(c.squaredDistance=M,c.distance=Math.sqrt(M),l?(c.relationship=c.distance<.001?i.Relationship.COINCIDENT:i.Relationship.PARRALLEL,c.angle=0):(c.relationship=c.distance<.001?i.Relationship.INTERSECTING:i.Relationship.NONE,c.angle=e.angle(u,p)),c.aPosition1=P,c.aPosition2=f,c.returnCode=0)}return c},computeSegmentTriangleSquaredDistance:function(r,o,a,s,c,l){var u={returnCode:1};if(r&&o&&a&&s&&c){u.returnCode=2;var p=void 0!==l?l:Number.MAX_VALUE;if(p>1e-6){var h,d,g=!1,m=e.sub(a,s),y=e.sub(a,c),P=e.cross(m,y);e.normalize(P)||(P=e.multiply(P,1e3));var f=e.sub(a,r),v=e.sub(a,o),T=e.dot(P,f),_=e.dot(P,v);if(T>0&&_<0||T<0&&_>0){var C=e.sub(r,o);0===(M=t.computeLinePlaneDistance(r,C,a,P)).returnCode&&M.aPosition&&2!==(M=n.computePointTriangleDistance(M.aPosition,a,s,c,p)).returnCode&&M.relationship===i.Relationship.COINCIDENT&&(p=M.squaredDistance,h=e.clone(M.aPosition),d=e.clone(M.aPosition),g=!0)}if(!g){for(var M,E=[r,o],A=[a,s,c,a],b=0;b<3&&p>1e-6;b++)2!==(M=n.computeTwoSegmentsDistance(r,o,A[b],A[b+1],p)).returnCode&&(p=M.squaredDistance,h=e.clone(M.aPosition1),d=e.clone(M.aPosition2),g=!0);for(var S=0;S<2&&p>1e-6;S++)2!==(M=n.computePointTriangleDistance(E[S],a,s,c,p)).returnCode&&(p=M.squaredDistance,h=e.clone(E[S]),d=e.clone(M.aPosition),g=!0)}g&&(u.returnCode=0,u.squaredDistance=p,u.aPosition1=h,u.aPosition2=d,u.angle=0,u.relationship=u.squaredDistance<1e-6?i.Relationship.INTERSECTING:i.Relationship.NONE)}}return u},computeTwoTrianglesSquaredDistance:function(t,r,o,a,s,c,l){var u={returnCode:1};if(t&&r&&a&&s&&c){u.returnCode=2;var p=void 0!==l?l:Number.MAX_VALUE;if(p>1e-6){for(var h,d,g,m=[t,r,o,t],y=[a,s,c,a],P=!1,f=0;f<3&&p>1e-6;f++)2!==(g=n.computeSegmentTriangleSquaredDistance(m[f],m[f+1],a,s,c,p)).returnCode&&(p=g.squaredDistance,h=e.clone(g.aPosition1),d=e.clone(g.aPosition2),P=!0);for(var v=0;v<3&&p>1e-6;v++)2!==(g=n.computeSegmentTriangleSquaredDistance(y[v],y[v+1],t,r,o,p)).returnCode&&(p=g.squaredDistance,h=e.clone(g.aPosition2),d=e.clone(g.aPosition1),P=!0);P&&(u.returnCode=0,u.squaredDistance=p,u.aPosition1=h,u.aPosition2=d,u.angle=0,u.relationship=i.Relationship.NONE)}}return u}};return n}),define("DS/WebPolyMaths/WebMeshMeasure",["DS/WebPolyMaths/WebMathsVector3D","DS/WebPolyMaths/WebMathsFiniteGeometry","DS/WebPolyMaths/WebMathsBoundingGeometry","DS/WebPolyMaths/WebMeshServices"],function(e,t,i,n){"use strict";var r={computePointMeshSquaredDistance:function(e,t,i,o){var a={returnCode:1};if(t&&t.getGroup()&&t.getGroup().geometry&&void 0!==t.getStart()&&void 0!==t.getCount()&&t.getCount()>0){var s=t.getCount(),c=t.getGroup().glType,l=n.extractMeshVertices(t,i.elements),u=1===c?s/2:s/3;1===c?a=r._computePointCurveSquaredDistance(e,u,l,o):4===c&&(a=r._computePointSurfaceSquaredDistance(e,u,l,o))}return a},_computePointMeshSquaredMaxDistance:function(t,r,o,a){var s={returnCode:1};if(r&&r.getGroup()&&r.getGroup().geometry&&void 0!==r.getStart()&&void 0!==r.getCount()&&r.getCount()>0){s.returnCode=2;var c,l=n.extractMeshVertices(r,o.elements,void 0,!0),u=l.length,p=a||0,h=[0,0,0],d=i.computeAABBForPoint(t),g=i.computeAABBForPoints(l),m=i.computeAABBSquaredMaxDistance(d,g);if(m>p){for(var y=0;y<u;y++)(m=e.subAndSquaredLength(t,l[y],h))>p&&(p=m,c=e.clone(l[y]),s.returnCode=0);0===s.returnCode&&(s.squaredMaxDistance=p,s.aPosition1=t,s.aPosition2=c)}}return s},computeTwoMeshesSquaredDistance:function(e,t,i,o,a){var s={returnCode:1},c=e&&e.getGroup()&&e.getGroup().geometry&&void 0!==e.getStart()&&void 0!==e.getCount()&&e.getCount()>0,l=i&&i.getGroup()&&i.getGroup().geometry&&void 0!==i.getStart()&&void 0!==i.getCount()&&i.getCount()>0;if(c&&l){var u=e.getCount(),p=e.getGroup().glType,h=n.extractMeshVertices(e,t.elements),d=1===p?u/2:u/3,g=i.getCount(),m=i.getGroup().glType,y=n.extractMeshVertices(i,o.elements),P=1===m?g/2:g/3;if(1===p)1===m?s=r._computeTwoCurvesSquaredDistance(d,h,P,y,a):4===m&&(s=r._computeCurveSurfaceSquaredDistance(d,h,P,y,a));else if(4===p)if(1===m){var f=(s=r._computeCurveSurfaceSquaredDistance(P,y,d,h,a)).aPosition1;s.aPosition1=s.aPosition2,s.aPosition2=f}else 4===m&&(s=r._computeSurfaceSurfaceSquaredDistance(d,h,P,y,a))}return s},_computeTwoMeshesSquaredMaxDistance:function(t,r,o,a,s){var c={returnCode:1},l=t&&t.getGroup()&&t.getGroup().geometry&&void 0!==t.getStart()&&void 0!==t.getCount()&&t.getCount()>0,u=o&&o.getGroup()&&o.getGroup().geometry&&void 0!==o.getStart()&&void 0!==o.getCount()&&o.getCount()>0;if(l&&u){c.returnCode=2;var p,h,d=n.extractMeshVertices(t,r.elements),g=d.length,m=n.extractMeshVertices(o,a.elements),y=m.length,P=s||0,f=[0,0,0],v=i.computeAABBForPoints(d),T=i.computeAABBForPoints(m),_=i.computeAABBSquaredMaxDistance(v,T);if(_>P){for(var C=0;C<g;C++)for(var M=0;M<y;M++)(_=e.subAndSquaredLength(d[C],m[M],f))>P&&(P=_,p=e.clone(d[C]),h=e.clone(m[M]),c.returnCode=0);0===c.returnCode&&(c.squaredMaxDistance=P,c.aPosition1=p,c.aPosition2=h)}}return c},_computePointCurveSquaredDistance:function(n,r,o,a){var s={returnCode:1};if(void 0!==r&&o){s.returnCode=2;for(var c,l=a||Number.MAX_VALUE,u=i.computeAABBForPoint(n),p=0;p<r&&l>1e-6;p++){var h=i.computeAABBForSegment(o[2*p],o[2*p+1]);if(i.computeAABBSquaredDistance(u,h)<l){var d=t.computePointSegmentDistance(n,o[2*p],o[2*p+1],l);2!==d.returnCode&&(s.returnCode=0,l=d.squaredDistance,c=e.clone(d.aPosition))}}0===s.returnCode&&(s.squaredDistance=l,s.aPosition1=n,s.aPosition2=c)}return s},_computePointSurfaceSquaredDistance:function(n,r,o,a){var s={returnCode:1};if(void 0!==r&&o){s.returnCode=2;for(var c,l=a||Number.MAX_VALUE,u=i.computeAABBForPoint(n),p=0;p<r&&l>1e-6;p++){var h=i.computeAABBForTriangle(o[3*p],o[3*p+1],o[3*p+2]);if(i.computeAABBSquaredDistance(u,h)<l){var d=t.computePointTriangleDistance(n,o[3*p],o[3*p+1],o[3*p+2],l);2!==d.returnCode&&(s.returnCode=0,l=d.squaredDistance,c=e.clone(d.aPosition))}}0===s.returnCode&&(s.squaredDistance=l,s.aPosition1=n,s.aPosition2=c)}return s},_computeTwoCurvesSquaredDistance:function(n,r,o,a,s){var c={returnCode:1};if(void 0!==n&&r&&void 0!==o&&a){c.returnCode=2;for(var l,u,p=s||Number.MAX_VALUE,h=0;h<n&&p>1e-6;h++)for(var d=i.computeAABBForSegment(r[2*h],r[2*h+1]),g=0;g<o&&p>1e-6;g++){var m=i.computeAABBForSegment(a[2*g],a[2*g+1]);if(i.computeAABBSquaredDistance(d,m)<p){var y=t.computeTwoSegmentsDistance(r[2*h],r[2*h+1],a[2*g],a[2*g+1],p);2!==y.returnCode&&(c.returnCode=0,p=y.squaredDistance,l=e.clone(y.aPosition1),u=e.clone(y.aPosition2))}}0===c.returnCode&&(c.squaredDistance=p,c.aPosition1=l,c.aPosition2=u)}return c},_computeCurveSurfaceSquaredDistance:function(n,r,o,a,s){var c={returnCode:1};if(void 0!==n&&r&&void 0!==o&&a){c.returnCode=2;for(var l,u,p=s||Number.MAX_VALUE,h=0;h<n&&p>1e-6;h++)for(var d=i.computeAABBForSegment(r[2*h],r[2*h+1]),g=0;g<o&&p>1e-6;g++){var m=i.computeAABBForTriangle(a[3*g],a[3*g+1],a[3*g+2]);if(i.computeAABBSquaredDistance(d,m)<p){var y=t.computeSegmentTriangleSquaredDistance(r[2*h],r[2*h+1],a[3*g],a[3*g+1],a[3*g+2],p);2!==y.returnCode&&(c.returnCode=0,p=y.squaredDistance,l=e.clone(y.aPosition1),u=e.clone(y.aPosition2))}}0===c.returnCode&&(c.squaredDistance=p,c.aPosition1=l,c.aPosition2=u)}return c},_computeSurfaceSurfaceSquaredDistance:function(n,r,o,a,s){var c={returnCode:1};if(void 0!==n&&r&&void 0!==o&&a){c.returnCode=2;var l,u,p,h,d,g,m=s||Number.MAX_VALUE,y=[];n>o?(l=n,u=o,p=r,h=a):(l=o,u=n,p=a,h=r);for(var P=0;P<l&&m>1e-6;P++)for(var f=i.computeAABBForTriangle(p[3*P],p[3*P+1],p[3*P+2]),v=0;v<u&&m>1e-6;v++){if(void 0===y[v]&&(y[v]=i.computeAABBForTriangle(h[3*v],h[3*v+1],h[3*v+2])),i.computeAABBSquaredDistance(f,y[v])<m){var T=t.computeTwoTrianglesSquaredDistance(p[3*P],p[3*P+1],p[3*P+2],h[3*v],h[3*v+1],h[3*v+2],m);2!==T.returnCode&&(c.returnCode=0,m=T.squaredDistance,d=e.clone(T.aPosition1),g=e.clone(T.aPosition2))}}0===c.returnCode&&(c.squaredDistance=m,n>o?(c.aPosition1=d,c.aPosition2=g):(c.aPosition1=g,c.aPosition2=d))}return c},_computePointCurveSquaredMaxDistance:function(n,r,o,a){var s={returnCode:1};if(void 0!==r&&o){s.returnCode=2;for(var c,l=a||Number.MAX_VALUE,u=i.computeAABBForPoint(n),p=0;p<r&&l>1e-6;p++){var h=i.computeAABBForSegment(o[2*p],o[2*p+1]);if(i.computeAABBSquaredMaxDistance(u,h)<l){var d=t.computePointSegmentDistance(n,o[2*p],o[2*p+1],l);2!==d.returnCode&&(s.returnCode=0,l=d.squaredMaxDistance,c=e.clone(d.aPosition))}}0===s.returnCode&&(s.squaredMaxDistance=l,s.aPosition1=n,s.aPosition2=c)}return s}};return r}),define("DS/WebPolyMaths/WebMeshIntersection",["DS/WebPolyMaths/WebMathsVector3D","DS/WebPolyMaths/WebMathsBoundingGeometry","DS/WebPolyMaths/WebMathsInfiniteGeometry","DS/WebPolyMaths/WebMeshServices","DS/WebPolyMaths/WebMeshMeasure","DS/Visualization/ThreeJS_DS"],function(e,t,i,n,r,o){"use strict";var a={computeSectionCurves:function(t,i,n){for(var r,o,s,c,l,u={returnCode:2,nbIntersections:0,nbTotTriangles:0,aPolylines:[]},p=[n[12],n[13],n[14]],h=[n[8],n[9],n[10]],d=-e.dot(p,h),g=t.getCount(),m=t.getStart(),y=t.getGroup().geometry,P=y.vertexIndexArray,f=y.vertexPositionArray,v=[0,0,0],T=[0,0,0],_=[0,0,0],C=[],M=[0,0,0,0,0,0],E=g/3,A=0;A<E;A++){u.nbTotTriangles++,l=3*P[c=m+3*A],v[0]=f[l],v[1]=f[l+1],v[2]=f[l+2],l=3*P[c+1],T[0]=f[l],T[1]=f[l+1],T[2]=f[l+2],l=3*P[c+2],_[0]=f[l],_[1]=f[l+1],_[2]=f[l+2],r=v[0]*h[0]+v[1]*h[1]+v[2]*h[2]+d,o=T[0]*h[0]+T[1]*h[1]+T[2]*h[2]+d,s=_[0]*h[0]+_[1]*h[1]+_[2]*h[2]+d;var b=0,S=0;if(r>0?o>0?s<=0&&(b=1):s>0?b=2:(b=1,S=2):o>0?(s>0&&(b=1),S=2):s>0&&(b=1),0!==b||0!==S){u.nbIntersections++;var R,D=3-b-S;(R=0===D?a._computeIntersectionTrianglePlane(v,T,_,p,h,M):1===D?a._computeIntersectionTrianglePlane(T,_,v,p,h,M):a._computeIntersectionTrianglePlane(_,v,T,p,h,M))&&2===R.length&&C.push([R[0],R[1]])}}if(C.length>0){u.returnCode=0,a._mergePolylines(C);for(var V=0;V<C.length;V++)a._simplifyPolylinePerpendicularDistance(C[V],4e-4,M);for(var I=C.length,x=0;x<I;x++){for(var N=C[x].length,L=0;L<N;L++)C[x][L]=e.transformPoint(C[x][L],i,C[x][L]);u.aPolylines[x]=C[x]}}return u},_computeIntersectionTrianglePlane:function(e,t,i,n,r,o){var a,s=o||[0,0,0,0,0,0];s[0]=e[0]-t[0],s[1]=e[1]-t[1],s[2]=e[2]-t[2],s[3]=e[0]-i[0],s[4]=e[1]-i[1],s[5]=e[2]-i[2];var c=s[0]*r[0]+s[1]*r[1]+s[2]*r[2],l=s[3]*r[0]+s[4]*r[1]+s[5]*r[2];if(Math.abs(c)>.001&&Math.abs(l)>.001){var u=(n[0]-e[0])*r[0]+(n[1]-e[1])*r[1]+(n[2]-e[2])*r[2],p=u/c,h=u/l,d=s[0]*p,g=s[1]*p,m=s[2]*p,y=s[3]*h,P=s[4]*h,f=s[5]*h;(Math.abs(d-y)>.001||Math.abs(g-P)>.001||Math.abs(m-f)>.001)&&((a=[])[0]=[d+e[0],g+e[1],m+e[2]],a[1]=[y+e[0],P+e[1],f+e[2]])}return a},_mergePolylines:function(e){for(var t,i,n,r,o=!0;o;){o=!1;for(var a=0;a<e.length;a++){t=e[a][0],i=e[a][e[a].length-1];for(var s=a+1;s<e.length;s++)if(n=e[s][0],r=e[s][e[s].length-1],(t[0]-n[0])*(t[0]-n[0])+(t[1]-n[1])*(t[1]-n[1])+(t[2]-n[2])*(t[2]-n[2])<1e-6){for(var c=1,l=e[s].length;c<l;c++)e[a].unshift(e[s][c]);t=e[a][0],e.splice(s,1),o=!0,s--}else if((t[0]-r[0])*(t[0]-r[0])+(t[1]-r[1])*(t[1]-r[1])+(t[2]-r[2])*(t[2]-r[2])<1e-6){for(c=e[s].length-2;0<=c;c--)e[a].unshift(e[s][c]);t=e[a][0],e.splice(s,1),o=!0,s--}else if((i[0]-n[0])*(i[0]-n[0])+(i[1]-n[1])*(i[1]-n[1])+(i[2]-n[2])*(i[2]-n[2])<1e-6){for(c=1,l=e[s].length;c<l;c++)e[a].push(e[s][c]);i=e[a][e[a].length-1],e.splice(s,1),o=!0,s--}else if((i[0]-r[0])*(i[0]-r[0])+(i[1]-r[1])*(i[1]-r[1])+(i[2]-r[2])*(i[2]-r[2])<1e-6){for(c=e[s].length-2;0<=c;c--)e[a].push(e[s][c]);i=e[a][e[a].length-1],e.splice(s,1),o=!0,s--}}}},_simplifyPolylinePerpendicularDistance:function(e,t,i){for(var n,r,o,a,s,c=i||[0,0,0,0,0,0],l=1;l<e.length-1;l++)if(n=e[l-1],r=e[l],o=e[l+1],c[0]=o[0]-n[0],c[1]=o[1]-n[1],c[2]=o[2]-n[2],(a=c[0]*c[0]+c[1]*c[1]+c[2]*c[2])>1e-6&&(s=((r[0]-n[0])*c[0]+(r[1]-n[1])*c[1]+(r[2]-n[2])*c[2])/a,c[3]=c[0]*s+n[0]-r[0],c[4]=c[1]*s+n[1]-r[1],c[5]=c[2]*s+n[2]-r[2],c[3]*c[3]+c[4]*c[4]+c[5]*c[5]<t)){for(var u=l+1;u<e.length;u++)e[u-1]=e[u];e.length=e.length-1,l--}},detectTwoMeshesInterference:function(e,t,i,o,a){var s=1,c=e&&e.getGroup()&&e.getGroup().geometry&&void 0!==e.getStart()&&void 0!==e.getCount()&&e.getCount()>0,l=i&&i.getGroup()&&i.getGroup().geometry&&void 0!==i.getStart()&&void 0!==i.getCount()&&i.getCount()>0;if(c&&l){s=0;var u=e.getGroup().glType,p=i.getGroup().glType;if(4===u&&4===p){var h=e.getCount(),d=n.extractMeshVertices(e,t.elements),g=h/3,m=i.getCount(),y=n.extractMeshVertices(i,o.elements),P=m/3,f=r._computeSurfaceSurfaceSquaredDistance(g,d,P,y,a);s=0===f.returnCode&&f.squaredDistance<1e-6?2:0}}return s},computeRayMeshIntersection:function(i,n,r){var o={returnCode:1,aParameters:[]};if(i&&n&&r&&r.getGroup()&&r.getGroup().glType&&4===r.getGroup().glType){o.returnCode=0;var a=r.getCount(),s=r.getStart(),c=r.getGroup().geometry,l=c.vertexIndexArray,u=c.vertexPositionArray,p=t.computeAABBForUnsortedPoints(a,s,l,u);if(t.intersectAABBWithRay(p,i,n)){var h,d,g,m,y,P,f,v,T,_,C,M,E,A,b,S,R,D,V,I,x=a/3,N=[],L=[0,0,0],G=[!0,!0,!0],w=[!0,!0,!0];for(h=0;h<x;h++)if(y=3*l[m=s+3*h],N[0]=[u[y],u[y+1],u[y+2]],y=3*l[m+1],N[1]=[u[y],u[y+1],u[y+2]],y=3*l[m+2],N[2]=[u[y],u[y+1],u[y+2]],N[3]=N[0],P=N[1][0]-N[0][0],f=N[1][1]-N[0][1],v=N[1][2]-N[0][2],T=N[2][0]-N[0][0],_=N[2][1]-N[0][1],C=N[2][2]-N[0][2],C=N[2][2]-N[0][2],L[0]=f*C-v*_,L[1]=v*T-P*C,L[2]=P*_-f*T,M=L[0]*n[0]+L[1]*n[1]+L[2]*n[2],Math.abs(M)>.001&&(E=L[0]*(i[0]-N[0][0])+L[1]*(i[1]-N[0][1])+L[2]*(i[2]-N[0][2]),M>0&&E<0||M<0&&E>0)){for(d=0;d<3;d++)P=N[d][0]-i[0],f=N[d][1]-i[1],v=N[d][2]-i[2],T=N[d+1][0]-i[0],_=N[d+1][1]-i[1],A=(f*(C=N[d+1][2]-i[2])-v*_)*n[0]+(v*T-P*C)*n[1]+(P*_-f*T)*n[2],G[d]=Math.abs(A)<.001,w[d]=A>0;if(b=!1,G[0]?(b=!0,S=G[1]?w[2]:G[2]?w[1]:w[1]&&w[2]):G[1]?(b=!0,S=G[2]?w[0]:w[2]&&w[0]):G[2]?(b=!0,S=w[0]&&w[1]):w[0]&&w[1]&&w[2]?(b=!0,S=!0):w[0]||w[1]||w[2]||(b=!0,S=!1),b){for(R=e.dot(n,L),D=e.dot(e.sub(i,N[0]),L)/R,S&&(D=-D),V=o.aParameters.length,I=!0,g=0;I&&g<V;g++)I=Math.abs(o.aParameters[g]-D)>.001;I&&o.aParameters.push(D)}}}}return o},computeRayIntersection:function(e,t,i,n,r){for(var a=new o.Ray(e,t),s=a.intersectMeshInstances({object:i},n,a.origin,1),c=s[0].object.id,l=[],u=0;u<s.length;u++)c===s[u].object.id&&l.push(s[u]);return r?l:l[0]}};return a}),define("DS/WebPolyMaths/WebToolsMeasure",["DS/WebPolyMaths/WebMathsInfiniteGeometry","DS/WebPolyMaths/WebMathsBoundingGeometry","DS/WebPolyMaths/WebGeometryEnums","DS/WebPolyMaths/WebMathsVector3D","DS/WebPolyMaths/WebToolsSceneGraph","DS/WebPolyMaths/WebMeshServices","DS/WebPolyMaths/WebMeshRecognition","DS/WebPolyMaths/WebMeshMeasure","DS/WebPolyMaths/WebToolsMaths","DS/WebPolyMaths/WebMeasureEnums","DS/Visualization/ThreeJS_DS","DS/Visualization/PathElement","DS/Visualization/SubElement","DS/Mesh/MeshUtils"],function(e,t,i,n,r,o,a,s,c,l,u,p,h,d){"use strict";var g=function(e){var t=r.getLastReference(e);return t&&t.getLastElement(!0)?t:(t=r.getLastRepReference(e))&&t.getLastElement(!0)?t:e.clone()},m={measureItem:function(e,t,n,o){var a,s={};o&&!0===o&&(a=(new Date).getTime());var c,u=e.getPathElement(),p=e.getLevel();p?(s.product=u.getElement(p-1),c=r.truncatePathElement(u,p)):(c=g(u))&&c.getLastElement(!0)&&(s.product=c.getLastElement(!0));var h=e.getType();if(void 0!==t&&t===l.ViewedType.PRODUCT){e.updateProductMeasurable(),s.type=i.GeometryType.PRODUCT,s.position=e.getSelPoint(),s.aabb=m.retrieveProductAABB(s.product,c.getWorldMatrix()),s.volume=e.getVolume(),s.area=e.getArea(),s.cog=e.getCoG(),s.length=e.getLength();var d=e.getPoints();d&&d.beginPoint&&d.endPoint&&(s.startpoint=d.beginPoint,s.endpoint=d.endPoint),s.originPoint=e.getOriginPoint()}else if(void 0!==t&&t===l.ViewedType.POINT||h===i.GeometryType.POINT||h===i.GeometryType.PICKINGPT)s.type=i.GeometryType.POINT,s.position=e.getPoint(),s.position||(s.position=e.getSelPoint());else if(h===i.GeometryType.LINE){s.type=h,s.length=e.getLength();var y=e.getPoints();s.point1=y.beginPoint,s.point2=y.endPoint,s.position=s.point1.clone().add(s.point2).multiplyScalar(.5)}else if(h===i.GeometryType.CIRCLE)s.type=h,s.length=e.getLength(),s.position=e.getSelPoint(),s.radius=e.getRadius(),s.center=e.getCenter(),s.normal=e.getAxis(),s.arcLength=e.getArcLength(),s.arcMidPoint=e.getArcMidPoint();else if(h===i.GeometryType.CYLINDER){s.type=h,s.area=e.getArea(),s.cog=e.getCoG(),s.position=e.getSelPoint(),s.radius=e.getRadius();var P=e.getPoints();s.point1=P.beginPoint,s.point2=P.endPoint}else if(h===i.GeometryType.CONE){s.type=h,s.area=e.getArea(),s.cog=e.getCoG(),s.position=e.getSelPoint(),s.apex=e.getApex(),s.semiAngle=e.getSemiAngle(),s.axis=e.getAxis();var f=e.getPoints();s.point1=f.beginPoint,s.point2=f.endPoint}else if(h===i.GeometryType.SPHERE)s.type=h,s.area=e.getArea(),s.cog=e.getCoG(),s.position=e.getSelPoint(),s.radius=e.getRadius(),s.center=e.getCenter();else if(h===i.GeometryType.PLANE){s.type=h,s.area=e.getArea(),s.cog=e.getCoG(),s.position=e.getSelPoint();var v=e.getPlane();s.origin=v.origin,s.normal=v.normal}else h===i.GeometryType.CURVE?(s.type=h,s.length=e.getLength(),s.position=e.getSelPoint()):h===i.GeometryType.SURFACE&&(s.type=h,s.area=e.getArea(),s.cog=e.getCoG(),s.position=e.getSelPoint());return o&&!0===o&&console.log("PCS measureItem="+((new Date).getTime()-a)),s},measureProduct:function(e){var t,i={},s=e.getPathElement(),l=e.getLevel();t=l?r.truncatePathElement(s,l):g(s);var p,m=r.getRenderables(t),y=0,P=0,f=0,v=[0,0,0],T=[0,0,0],_=0,C=[0,0,0],M=[0,0,0],E=[0,0,0],A=0,b=0,S=!1,R=!1,D=m.length;s&&(i.originPoint=new u.Vector3,i.originPoint.getPositionFromMatrix(s.getMatrix()));for(var V=0;V<D;V++)for(var I=m[V].matrix.elements,x=m[V].geometry,N=x.length,L=0;L<N;L++){x[L].startIteration();for(var G=x[L].drawingGroups,w=G.length,B=0;B<w;B++)if(G[B]._geomType&&("FACE"===d.GeomTypeString[G[B]._geomType]||"EDGE"===d.GeomTypeString[G[B]._geomType]||"WIRE_EDGE"===d.GeomTypeString[G[B]._geomType]||"FREE_POINT"===d.GeomTypeString[G[B]._geomType]))for(var O=G[B].getPrimitivesCount(),q=0;q<O;q++){var W=new d.SGPrimitiveHelper;W.set(G[B],q);var z=h.getFromSGNode(W),U=a.recognizeNonCanonicGeometry(W,new u.Matrix4,!0);if("FACE"===d.GeomTypeString[G[B]._geomType]){S=!0;var F=z.getBodyDimension();if(3===F){P+=U.area||0;var k=o._computeVolume(W,E);y+=k.volume||0;var X=n.transformPoint(k.aCog,I);v=n.multiplyAndAdd(X,k.volume,v)}else if(2===F&&0===U.returnCode){f+=U.area;var H=n.transformPoint(U.aCog,I);T=n.multiplyAndAdd(H,U.area,T)}}else if(S||"EDGE"!==d.GeomTypeString[G[B]._geomType]&&"WIRE_EDGE"!==d.GeomTypeString[G[B]._geomType]){if(!S&&!R&&"FREE_POINT"===d.GeomTypeString[G[B]._geomType]&&1===++b&&o.verifyMesh(W)){var Y=new u.Matrix4;p=o.extractMeshVertices(W,Y.elements)}}else if(R=!0,A++,U.length&&U.length>0&&(_+=U.length,1===A)){if(void 0===U.point1&&void 0===U.point2&&o.verifyMesh(W)){var Z=new u.Matrix4,j=o.extractMeshVertices(W,Z.elements),K=a._recognizeCurve(j,!0);0===K.returnCode&&(U.point1=a._buildVector3(K.aPoint1),U.point2=a._buildVector3(K.aPoint2))}if(U.point1&&U.point2){var J=[U.point1.x,U.point1.y,U.point1.z],Q=[U.point2.x,U.point2.y,U.point2.z];C=n.transformPoint(J,I),M=n.transformPoint(Q,I)}}}x[L].endIteration()}return S?(y>0&&(i.volume=y),(P>0||f>0)&&(i.area=y>0?P>0?P:0:f>0?f:0),(y>0||P>0||f>0)&&(v=c.isZero(y)?c.isZero(f)?[0,0,0]:n.multiply(T,1/f):n.multiply(v,1/y),i.cog=new u.Vector3(v[0],v[1],v[2]))):!S&&R&&_>0?(i.length=_,1===A&&(i.startpoint=new u.Vector3(C[0],C[1],C[2]),i.endpoint=new u.Vector3(M[0],M[1],M[2]))):S||R||1!==b||(i.cog=new u.Vector3(p[0][0],p[0][1],p[0][2])),i},measureBetween2DGeometries:function(t,n,r,o,a){var c,p,h={},d=n._type,y=o._type;if("Angle"===t)h=m.measureBetween(n,l.ViewedType.AXIS,o,l.ViewedType.AXIS);else if("Distance"===t)if(c=n.getSelPoint().toArray(),p=o.getSelPoint().toArray(),d===i.GeometryType.CIRCLE&&(c=n.getCenter().toArray(),r=l.ViewedType.CENTER),y===i.GeometryType.CIRCLE&&(p=o.getCenter().toArray(),a=l.ViewedType.CENTER),d!==i.GeometryType.CIRCLE&&d!==i.GeometryType.POINT||y!==i.GeometryType.CIRCLE&&y!==i.GeometryType.POINT){if(d===i.GeometryType.CIRCLE)(h=s.computePointMeshSquaredDistance(c,o.getPrimitive(),o.getReferentialPosition())).type1=l.ViewedType.POINT,h.type2=m.MeasuredType.CURVE,h.distance=Math.sqrt(h.squaredDistance);else if(y===i.GeometryType.CIRCLE){(h=s.computePointMeshSquaredDistance(p,n.getPrimitive(),n.getReferentialPosition())).type1=m.MeasuredType.CURVE,h.type2=l.ViewedType.POINT;var P=h.aPosition1;h.aPosition1=h.aPosition2,h.aPosition2=P,h.distance=Math.sqrt(h.squaredDistance)}else if(d===i.GeometryType.LINE&&y===i.GeometryType.LINE){var f={};if((f=m.measureBetween(n,r,o,a)).position1&&f.position2){var v=o.getPoints().endPoint,T=v.clone().sub(o.getPoints().beginPoint),_=f.position1.clone(),C=e.computePointLineDistance(_.toArray(),v.toArray(),T.toArray());0===C.returnCode&&(f.position2=new u.Vector3(C.aPosition[0],C.aPosition[1],C.aPosition[2]),f.distance=C.distance)}h=f}}else(h=e.computeTwoPointsDistance(c,p)).type2=a,h.type1=r,h.aPosition1=c,h.aPosition2=p;else if("MinimumDistance"===t||"MaximumDistance"===t){if(d===i.GeometryType.CIRCLE&&(r=l.ViewedType.CURVE),y===i.GeometryType.CIRCLE&&(a=l.ViewedType.CURVE),d===i.GeometryType.POINT)c=n.getSelPoint().toArray(),(h="MaximumDistance"===t?s._computePointMeshSquaredMaxDistance(c,o.getPrimitive(),o.getReferentialPosition()):s.computePointMeshSquaredDistance(c,o.getPrimitive(),o.getReferentialPosition())).type1=l.ViewedType.POINT,h.type2=m.MeasuredType.CURVE;else if(y===i.GeometryType.POINT){p=o.getSelPoint().toArray(),(h="MaximumDistance"===t?s._computePointMeshSquaredMaxDistance(p,n.getPrimitive(),n.getReferentialPosition()):s.computePointMeshSquaredDistance(p,n.getPrimitive(),n.getReferentialPosition())).type1=m.MeasuredType.CURVE,h.type2=l.ViewedType.POINT;var M=h.aPosition1;h.aPosition1=h.aPosition2,h.aPosition2=M}else{if(h="MaximumDistance"===t?s._computeTwoMeshesSquaredMaxDistance(n.getPrimitive(),n.getReferentialPosition(),o.getPrimitive(),o.getReferentialPosition()):s.computeTwoMeshesSquaredDistance(n.getPrimitive(),n.getReferentialPosition(),o.getPrimitive(),o.getReferentialPosition()),n._normal&&o._normal){var E=new u.Vector3(h.aPosition1[0],h.aPosition1[1],h.aPosition1[2]),A=new u.Vector3(h.aPosition2[0],h.aPosition2[1],h.aPosition2[2]);Math.abs(n._normal.angleTo(A.clone().sub(E))-Math.PI/2)<.001&&(h.aExtension=n._normal.clone().toArray())}if(h.type1=l.ViewedType.CURVE,h.type2=l.ViewedType.CURVE,d===i.GeometryType.LINE&&y===i.GeometryType.LINE){var b=n.getPoints().endPoint.clone().sub(n.getPoints().beginPoint),S=o.getPoints().endPoint.clone().sub(o.getPoints().beginPoint),R=b.normalize().dot(S.normalize());1!==Math.abs(R)&&(h.angle=1)}}h.distance="MaximumDistance"===t?Math.sqrt(h.squaredMaxDistance):Math.sqrt(h.squaredDistance)}if(!h.product1){var D=n.getPathElement();D&&(h.product1=g(D).getLastElement())}if(!h.product2){var V=o.getPathElement();V&&(h.product2=g(V).getLastElement())}return h.aPosition1&&!h.position1&&(h.position1=new u.Vector3(h.aPosition1[0],h.aPosition1[1],h.aPosition1[2])),h.aPosition2&&!h.position2&&(h.position2=new u.Vector3(h.aPosition2[0],h.aPosition2[1],h.aPosition2[2])),h.aExtension&&!h.extensionDirection&&(h.extensionDirection=new u.Vector3(h.aExtension[0],h.aExtension[1],h.aExtension[2])),n.get2DScale&&h.distance&&(h.distance=h.distance/n.get2DScale()),h},measureBetween:function(t,n,r,o,a){var c={};if(n!==l.ViewedType.POINT&&n!==l.ViewedType.AXIS&&n!==l.ViewedType.CENTER&&n!==l.ViewedType.INFPLANE||o!==l.ViewedType.POINT&&o!==l.ViewedType.AXIS&&o!==l.ViewedType.CENTER&&o!==l.ViewedType.INFPLANE)if(n===l.ViewedType.PRODUCT||o===l.ViewedType.PRODUCT){var p=Number.MAX_VALUE;if(t.getSelPoint()&&r.getSelPoint()){var h=e.computeTwoPointsDistance(t.getSelPoint().toArray(),r.getSelPoint().toArray());p=h.distance*h.distance}if(n===l.ViewedType.PRODUCT&&o===l.ViewedType.PRODUCT)(c=m.measureBetweenWithProducts(m.MeasuredType.PRODUCT,t,r,p,a)).type1=n,c.type2=o;else if(n!==l.ViewedType.PRODUCT||o!==i.GeometryType.POINT&&o!==l.ViewedType.CENTER)if(o!==l.ViewedType.PRODUCT||n!==i.GeometryType.POINT&&n!==l.ViewedType.CENTER)if(n===l.ViewedType.PRODUCT){(c=m.measureBetweenWithProducts(m.MeasuredType.MESH,r,t,p,a)).type1=m.MeasuredType.MESH,c.type2=m.MeasuredType.MESH;var d=c.aPosition1;c.aPosition1=c.aPosition2,c.aPosition2=d;var y=c.product1;c.product1=c.product2,c.product2=y}else(c=m.measureBetweenWithProducts(m.MeasuredType.MESH,t,r,p,a)).type1=m.MeasuredType.MESH,c.type2=m.MeasuredType.MESH;else(c=m.measureBetweenWithProducts(m.MeasuredType.POINT,t,r,p,a)).type1=l.ViewedType.POINT,c.type2=o;else{(c=m.measureBetweenWithProducts(m.MeasuredType.POINT,r,t,p,a)).type1=n,c.type2=l.ViewedType.POINT;var P=c.aPosition1;c.aPosition1=c.aPosition2,c.aPosition2=P;var f=c.product1;c.product1=c.product2,c.product2=f}c.distance=Math.sqrt(c.squaredDistance)}else{if(n!==l.ViewedType.POINT&&n!==l.ViewedType.CENTER||o!==l.ViewedType.CURVE&&o!==l.ViewedType.SURFACE&&o!==l.ViewedType.CIRCLE&&o!==l.ViewedType.CYCOSP)if(o!==l.ViewedType.POINT&&o!==l.ViewedType.CENTER||n!==l.ViewedType.CURVE&&n!==l.ViewedType.SURFACE&&n!==l.ViewedType.CIRCLE&&n!==l.ViewedType.CYCOSP){if(c=s.computeTwoMeshesSquaredDistance(t.getPrimitive(),t.getReferentialPosition(),r.getPrimitive(),r.getReferentialPosition()),t._normal&&r._normal){var v=new u.Vector3(c.aPosition1[0],c.aPosition1[1],c.aPosition1[2]),T=new u.Vector3(c.aPosition2[0],c.aPosition2[1],c.aPosition2[2]);Math.abs(t._normal.angleTo(T.clone().sub(v))-Math.PI/2)<.001&&(c.aExtension=t._normal.clone().toArray())}c.type1=m.MeasuredType.MESH,c.type2=m.MeasuredType.MESH}else{C=o===l.ViewedType.CENTER?r.getCenter().toArray():r.getSelPoint().toArray();(c=s.computePointMeshSquaredDistance(C,t.getPrimitive(),t.getReferentialPosition())).type1=m.MeasuredType.MESH,c.type2=l.ViewedType.POINT;var _=c.aPosition1;c.aPosition1=c.aPosition2,c.aPosition2=_}else{var C=n===l.ViewedType.CENTER?t.getCenter().toArray():t.getSelPoint().toArray();(c=s.computePointMeshSquaredDistance(C,r.getPrimitive(),r.getReferentialPosition())).type1=l.ViewedType.POINT,c.type2=m.MeasuredType.MESH}c.distance=Math.sqrt(c.squaredDistance)}else c=m.measureBetweenInfinite(t,n,r,o);if(c.type1===m.MeasuredType.MESH){var M=t.getType();M===i.GeometryType.CURVE||M===i.GeometryType.LINE||M===i.GeometryType.CIRCLE?c.type1=l.ViewedType.CURVE:c.type1=l.ViewedType.SURFACE}if(c.type2===m.MeasuredType.MESH){var E=r.getType();E===i.GeometryType.CURVE||E===i.GeometryType.LINE||E===i.GeometryType.CIRCLE?c.type2=l.ViewedType.CURVE:c.type2=l.ViewedType.SURFACE}if(void 0===c.product1){var A=t.getPathElement();A&&(c.product1=g(A).getLastElement())}if(void 0===c.product2){var b=r.getPathElement();b&&(c.product2=g(b).getLastElement())}return c.aPosition1&&(c.position1=new u.Vector3(c.aPosition1[0],c.aPosition1[1],c.aPosition1[2])),c.aPosition2&&(c.position2=new u.Vector3(c.aPosition2[0],c.aPosition2[1],c.aPosition2[2])),c.aExtension&&(c.extensionDirection=new u.Vector3(c.aExtension[0],c.aExtension[1],c.aExtension[2])),c},measureThreepoints:function(e,t,i){var r={},o=e.getSelPoint(),a=t.getSelPoint(),s=i.getSelPoint();if(o&&a&&s){var c=o.toArray(),l=a.toArray(),p=s.toArray(),h=n.sub(c,l),d=n.sub(l,p);r.angle=Math.PI-n.angle(h,d);var g,m=n.cross(h,d);if(r.normal=new u.Vector3(m[0],m[1],m[2]),n.areEqual(c,l))g=n.multiply(n.add(c,p),.5);else if(n.areEqual(c,p))g=n.multiply(n.add(c,l),.5);else if(n.areEqual(l,p))g=n.multiply(n.add(c,l),.5);else{var y=n.squaredLength(m);if(y>1e-6){var P=(.5*n.squaredLength(d)+.5*n.dot(h,d))/y,f=n.multiplyAndAdd(h,.5,c);g=n.multiplyAndAdd(n.cross(h,m),-P,f)}}void 0!==g&&(r.radius=n.subAndLength(g,c),r.center=new u.Vector3(g[0],g[1],g[2]))}return r},measureBetweenInfinite:function(t,r,o,a){for(var s={},c=[t,o],u=[{_selectedType:r},{_selectedType:a}],p=0;p<2;p++){var h,d=c[p].getType();if(u[p].realType=d,u[p]._selectedType===l.ViewedType.POINT)u[p].type=i.GeometryType.POINT,u[p].position=c[p].getSelPoint(),d===i.GeometryType.CIRCLE||d===i.GeometryType.PLANE?u[p].normal=c[p]._normal:d!==i.GeometryType.CYLINDER&&d!==i.GeometryType.SPHERE&&d!==i.GeometryType.CONE&&d!==i.GeometryType.SURFACE||c[p].getSelNormal&&c[p]._selNormal&&(u[p].normal=c[p].getSelNormal());else if(d===i.GeometryType.POINT||d===i.GeometryType.PICKINGPT)u[p].type=i.GeometryType.POINT,u[p].position=c[p].getPoint();else if(d===i.GeometryType.LINE)u[p].type=i.GeometryType.LINE,h=c[p].getPoints(),u[p].position=c[p].getSelPoint(),u[p].direction=h.endPoint.sub(h.beginPoint);else if(d===i.GeometryType.CIRCLE)u[p]._selectedType===l.ViewedType.CENTER?(u[p].type=i.GeometryType.POINT,u[p].position=c[p].getCenter()):(u[p].type=i.GeometryType.LINE,u[p].position=c[p].getCenter(),u[p].direction=c[p].getAxis()),c[p]._normal&&(u[p].normal=c[p]._normal);else if(d===i.GeometryType.CYLINDER)u[p].type=i.GeometryType.LINE,h=c[p].getPoints(),u[p].position=h.beginPoint,u[p].direction=h.endPoint.sub(h.beginPoint);else if(d===i.GeometryType.CONE)u[p].type=i.GeometryType.LINE,h=c[p].getPoints(),u[p].position=h.beginPoint,u[p].direction=h.endPoint.sub(h.beginPoint);else if(d===i.GeometryType.SPHERE)u[p].type=i.GeometryType.POINT,u[p].position=c[p].getCenter();else if(d===i.GeometryType.PLANE){u[p].type=i.GeometryType.PLANE;var g=c[p].getPlane();u[p].origin=c[p].getSelPoint(),u[p].normal=g.normal}}var m,y=u[0],P=u[1],f=!1;(u[0].type===i.GeometryType.LINE&&u[1].type===i.GeometryType.PLANE||u[0].type===i.GeometryType.POINT||u[0].type===i.GeometryType.PICKINGPT)&&(y=u[1],P=u[0],f=!0);var v=[],T=[];if(y.type===i.GeometryType.PLANE)T[0]=l.ViewedType.INFPLANE,P.type===i.GeometryType.PLANE?(T[1]=l.ViewedType.INFPLANE,(m=e.computeTwoPlanesDistance(y.origin.toArray(),y.normal.toArray(),P.origin.toArray(),P.normal.toArray()))&&0===m.returnCode&&(s.distance=m.distance,s.angle=m.angle>Math.PI/2?Math.PI-m.angle:m.angle,s.relationship=m.relationship,m.relationship===i.Relationship.INTERSECTING?(v[0]=n.clone(m.aPosition1),v[1]=n.clone(m.aPosition2)):(v[0]=y.origin.toArray(),v[1]=m.aPosition2))):P.type===i.GeometryType.LINE?(T[1]=l.ViewedType.AXIS,(m=e.computeLinePlaneDistance(P.position.toArray(),P.direction.toArray(),y.origin.toArray(),y.normal.toArray()))&&0===m.returnCode&&(s.distance=m.distance,s.angle=m.angle>Math.PI/2?Math.PI-m.angle:m.angle,s.relationship=m.relationship,m.relationship===i.Relationship.INTERSECTING?(v[0]=m.aPosition,v[1]=m.aPosition):(v[0]=m.aPosition,v[1]=P.position.toArray()),s.aExtension=P.direction.toArray())):(T[1]=l.ViewedType.POINT,(m=e.computePointPlaneDistance(P.position.toArray(),y.origin.toArray(),y.normal.toArray()))&&0===m.returnCode&&(s.distance=m.distance,s.relationship=m.relationship,v[0]=m.aPosition,v[1]=P.position.toArray()));else if(y.type===i.GeometryType.LINE)T[0]=l.ViewedType.AXIS,P.type===i.GeometryType.LINE?(T[1]=l.ViewedType.AXIS,(m=e.computeTwoLinesDistance(y.position.toArray(),y.direction.toArray(),P.position.toArray(),P.direction.toArray()))&&0===m.returnCode&&(s.distance=m.distance,s.angle=m.angle>Math.PI/2?Math.PI-m.angle:m.angle,s.relationship=m.relationship,m.relationship===i.Relationship.INTERSECTING||m.relationship===i.Relationship.NONE?(v[0]=m.aPosition1,v[1]=m.aPosition2,s.aExtension=n.sub(y.position.toArray(),m.aPosition1)):(v[0]=y.position.toArray(),v[1]=m.aPosition2,y.realType===i.GeometryType.CIRCLE||y.realType===i.GeometryType.CYLINDER||y.realType===i.GeometryType.CONE||(y.realType,i.GeometryType.SPHERE)))):(T[1]=l.ViewedType.POINT,(m=e.computePointLineDistance(P.position.toArray(),y.position.toArray(),y.direction.toArray()))&&0===m.returnCode&&(s.distance=m.distance,s.relationship=m.relationship,v[0]=m.aPosition,v[1]=P.position.toArray())),s.aExtension=y.direction.toArray();else if(T[0]=l.ViewedType.POINT,T[1]=l.ViewedType.POINT,v[0]=y.position.toArray(),v[1]=P.position.toArray(),(m=e.computeTwoPointsDistance(v[0],v[1]))&&0===m.returnCode&&(s.distance=m.distance,s.relationship=m.relationship,P.normal&&y.normal)){var _=P.position.clone().sub(y.position),C=y.normal.angleTo(_),M=P.normal.angleTo(_);if(Math.abs(C-M)<.001)Math.abs(C-Math.PI/2)<.001&&(s.aExtension=y.normal.toArray())}return f?(s.aPosition1=v[1],s.aPosition2=v[0],s.type1=T[1],s.type2=T[0]):(s.aPosition1=v[0],s.aPosition2=v[1],s.type1=T[0],s.type2=T[1]),s},measureBetweenWithProducts:function(e,i,n,o,a){var s,c={};a&&!0===a&&(s=(new Date).getTime());var l=o||Number.MAX_VALUE;c.squaredDistance=l;var u,p,h,d=e===m.MeasuredType.PRODUCT,y=i.getPathElement(),P=i.getLevel();P?(u=y.getElement(P-1),p=r.truncatePathElement(y,P)):u=(p=g(y)).getLastElement();var f,v=n.getPathElement(),T=n.getLevel();T?(h=v.getElement(T-1),f=r.truncatePathElement(v,T)):h=(f=g(v)).getLastElement();var _=!1;if(d){var C,M,E,A=p.externalPath.length,b=f.externalPath.length;A<b?(C=A,M=f,E=p):(C=b,M=p,E=f),_=!0;for(var S=0;_&&S<C;S++)_=M.externalPath[S]===E.externalPath[S]}if(_)c.squaredDistance=0,c.aPosition1=i.getSelPoint().toArray(),c.aPosition2=c.aPosition1,c.product1=u,c.product2=h;else{a&&!0===a&&(d?console.log("Measure Products: "+u.name+" / "+h.name):console.log("Measure Products: "+e+" / "+h.name));var R,D,V=[],I=[],x=[],N=[],L=[],G=[],w=0;if(i.isPartial())for(w=0;w<i._partialPaths.length;w++)V.push(i._partialPaths[w]);else V.push(p);if(n.isPartial())for(w=0;w<n._partialPaths.length;w++)I.push(n._partialPaths[w]);else I.push(f);for(w=0;w<V.length;w++)for(var B=0;B<I.length;B++)x.push(V[w]),N.push(I[B]);d||(R=e===m.MeasuredType.MESH?m.retrieveMeshPrimitivesAndAABB(i):t.computeAABBForPoint(i.getSelPoint().toArray()));var O,q=!d;for(w=0;w<x.length;w++){var W,z;if(d&&(R=m.retrieveProductAABB(x[w].getLastElement(!0),i.getReferentialPosition())),D=m.retrieveProductAABB(N[w].getLastElement(!0),n.getReferentialPosition()),t.computeAABBSquaredDistance(R,D)<l)if(d&&(q=r.isLeaf(x[w].getLastElement(!0))),O=r.isLeaf(N[w].getLastElement(!0)),q&&O)d?L.push(x[w]):L.push(i),G.push(N[w]);else if(q||!O&&x[w].getLastElement(!0).bSphere.radius<N[w].getLastElement(!0).bSphere.radius){z=(W=N[w].getChildrenPathes()).length;for(var U=0;U<z;U++)r.isReferenceOrInstance(W[U].getLastElement())&&(d?x.push(x[w]):x.push(i),N.push(W[U]))}else{z=(W=x[w].getChildrenPathes()).length;for(var F=0;F<z;F++)r.isReferenceOrInstance(W[F].getLastElement())&&(x.push(W[F]),N.push(N[w]))}}for(var k=L.length,X=(new Date).getTime()-s,H=0;H<k;H++){var Y;Y=L[H];var Z=G[H],j=m.measureBetweenWithParts(e,Y,Z,l,a);j.squaredDistance<l&&(l=j.squaredDistance,(c=j).product1=L[H],c.product2=G[H])}!P&&d||(c.product1=u),T&&(c.product2=h),a&&!0===a&&console.log("Measure Products: Parts Couples="+k+" Scan duration="+X+" Duration="+((new Date).getTime()-s))}return c},measureBetweenWithParts:function(e,i,n,r,o){var a={},s=null;switch(e){case m.MeasuredType.PRODUCT:a=m.retrievePartPrimitivesAndAABB(i),s=i.getWorldMatrix();break;case m.MeasuredType.MESH:a=m.retrieveMeshPrimitivesAndAABB(i),s=i.getReferentialPosition();break;case m.MeasuredType.POINT:a.primitives=[],a.primitives[0]=i.getSelPoint().toArray(),a.AABB=[],a.AABB[0]=t.computeAABBForPoint(a.primitives[0]),s=null}var c=m.retrievePartPrimitivesAndAABB(n),l=n.getWorldMatrix();return m.measureBetweenPrimitivesAABB(e,a,s,c,l,r,o)},retrieveProductAABB:function(e,t){var i=[],n=e.bBox.clone().applyMatrix4(t);return i[0]=n.min.x,i[1]=n.min.y,i[2]=n.min.z,i[3]=n.max.x,i[4]=n.max.y,i[5]=n.max.z,i},retrievePartPrimitivesAndAABB:function(e){for(var t={primitives:[]},i=r.getRenderables(e),n=i.length,a=0;a<n;a++)for(var s=i[a].geometry,c=s.length,l=0;l<c;l++){s[l].startIteration();for(var p=s[l].drawingGroups,h=p.length,g=0;g<h;g++)if(p[g]._geomType&&"FACE"===d.GeomTypeString[p[g]._geomType])for(var m=p[g].getPrimitivesCount(),y=0;y<m;y++){var P=new d.SGPrimitiveHelper;P.set(p[g],y),t.primitives.push(P)}s[l].endIteration()}if(0<t.primitives.length){var f=o.extractMeshVertices(t.primitives[0],void 0,1);0<f.length&&(t.vertice=new u.Vector3(f[0][0],f[0][1],f[0][2]));var v=o.extractMeshNormals(t.primitives[0],void 0,1);0<v.length&&(t.normal=new u.Vector3(v[0][0],v[0][1],v[0][2]))}t.AABB=[];for(var T=e.getWorldMatrix().elements,_=(m=t.primitives.length,0);_<m;_++)t.AABB[_]=o.computeAABB(t.primitives[_],T);return t},retrieveMeshPrimitivesAndAABB:function(e){var t={primitives:[]};return t.primitives.push(e.getPrimitive()),t.AABB=[],t.AABB[0]=o.computeAABB(e.getPrimitive(),e.getReferentialPosition().elements),t},measureBetweenPrimitivesAABB:function(e,i,n,r,o,a,c){var l={},u=(new Date).getTime(),p=a||Number.MAX_VALUE;l.squaredDistance=p;var h,d=[],g=0,y=i.primitives.length,P=r.primitives.length,f=0;for(f=0;f<y;f++)for(var v=0;v<P;v++)(h=t.computeAABBSquaredDistance(i.AABB[f],r.AABB[v]))<p&&(d[g]=[f,v,h],g++);var T=d.length,_=0;if(e===m.MeasuredType.POINT){for(f=0;f<T&&p>1e-6;f++)if(d[f][2]<p){var C=s.computePointMeshSquaredDistance(i.primitives[d[f][0]],r.primitives[d[f][1]],o,p);C.squaredDistance<p&&(p=C.squaredDistance,l=C),_++}}else for(f=0;f<T&&p>1e-6;f++)if(d[f][2]<p){var M=s.computeTwoMeshesSquaredDistance(i.primitives[d[f][0]],n,r.primitives[d[f][1]],o,p);M.squaredDistance<p&&(p=M.squaredDistance,l=M),_++}return c&&!0===c&&console.log("Measure Parts: Primitives Couples="+y*P+" ("+y+"-"+P+")  Candidates="+d.length+"  MeasuredCandidates="+_+"  duration="+((new Date).getTime()-u)),l},MeasuredType:{POINT:0,MESH:1,PRODUCT:2}};return m}),define("DS/WebPolyMaths/WebMeasurable",["UWA/Core","DS/WebPolyMaths/WebGeometryEnums","DS/WebPolyMaths/WebMeshServices","DS/WebPolyMaths/WebMeshRecognition","DS/WebPolyMaths/WebToolsMeasure","DS/WebPolyMaths/WebMeasureEnums","DS/Visualization/ThreeJS_DS","DS/Visualization/PathElement"],function(e,t,i,n,r,o,a,s){"use strict";var c=e.Class.extend({init:function(e,r){if(!r){if(this._bRealPathElement=!1,e.pathElement?(this._pathElement=e.pathElement.clone(),this._bRealPathElement=!0):this._matrix=e.position?e.position.clone():new a.Matrix4,e.selpoint){var s=(new a.Matrix4).getInverse(this._getMatrix());this._selPosition=e.selpoint.clone().applyMatrix4(s)}if(e.selnormal){var c=(new a.Matrix4).getInverse(this._getMatrix());this._selNormal=e.selnormal.clone().transformDirection(c)}var l;if(e.canonic?((l=e.canonic).exact=!0,l.returnCode=0,this._length=e.canonic.length,this._cog=e.canonic.cog,this._area=e.canonic.area,this._SGPrimitive=e.canonic.primitive):e.primitive&&(this._SGPrimitive=e.primitive,l=e.bAvoidRecognition?{returnCode:1}:n.recognizeCanonicGeometry(this._SGPrimitive,new a.Matrix4,!0)),0===l.returnCode){switch(this._type=l.type,l.type){case t.GeometryType.POINT:case t.GeometryType.PICKINGPT:this._selectedType=o.ViewedType.POINT,this._position=l.position,this._selPosition||(this._selPosition=l.position.clone());break;case t.GeometryType.LINE:this._selectedType=o.ViewedType.AXIS,this._point1=l.point1,this._point2=l.point2,this._selPosition||(this._selPosition=this._point1.clone());break;case t.GeometryType.CIRCLE:this._selectedType=o.ViewedType.CIRCLE,this._center=l.center,this._radius=l.radius,this._normal=l.normal;var u=i.extractMeshVertices(this._SGPrimitive),p=u.length-1;this._point1=new a.Vector3(u[0][0],u[0][1],u[0][2]),this._point2=new a.Vector3(u[p][0],u[p][1],u[p][2]);var h,d,g=0;u.length%2?(g=(u.length-1)/2-1,h=new a.Vector3(u[g][0],u[g][1],u[g][2]),d=new a.Vector3(u[g+2][0],u[g+2][1],u[g+2][2])):(g=u.length/2-1,h=new a.Vector3(u[g][0],u[g][1],u[g][2]),d=new a.Vector3(u[g+1][0],u[g+1][1],u[g+1][2]));var m=h.clone().add(d.clone()).multiplyScalar(.5).clone().sub(l.center.clone()).normalize().multiplyScalar(l.radius).clone().add(l.center.clone());this._arcMidPoint=new a.Vector3(m.x,m.y,m.z);var y=this._point1.clone().sub(this._center),P=this._point2.clone().sub(this._center),f=this._arcMidPoint.clone().sub(this._center);this._arcAngle=y.angleTo(f)+P.angleTo(f),l.arcLength||(l.arcLength=this._arcAngle*this._radius),l.length||(l.length=2*Math.PI*this._radius),this._arcLength=l.arcLength,this._length=l.length;break;case t.GeometryType.PLANE:this._selectedType=o.ViewedType.INFPLANE,this._origin=l.origin,this._normal=l.normal,this._selPosition||(this._selPosition=this._origin.clone());break;case t.GeometryType.CYLINDER:this._selectedType=o.ViewedType.CYCOSP,this._radius=l.radius,this._point1=l.point1,this._point2=l.point2;break;case t.GeometryType.CONE:this._selectedType=o.ViewedType.CYCOSP,this._apex=l.apex,this._semiAngle=l.semiAngle,this._axis=l.axis,this._point1=l.point1,this._point2=l.point2;break;case t.GeometryType.SPHERE:this._selectedType=o.ViewedType.CYCOSP,this._radius=l.radius,this._center=l.center;break;case t.GeometryType.PRODUCT:this._selectedType=o.ViewedType.PRODUCT,this._position=l.position,!this._selPosition&&l.position&&(this._selPosition=l.position.clone())}this._mode=l.exact?t.Mode.EXACT:t.Mode.FACETTED}else{switch(this._SGPrimitive.getGroup().glType){case 1:this._type=t.GeometryType.CURVE,this._selectedType=o.ViewedType.CURVE;var v=i.extractMeshVertices(this._SGPrimitive),T=v.length-1;this._point1=new a.Vector3(v[0][0],v[0][1],v[0][2]),this._point2=new a.Vector3(v[T][0],v[T][1],v[T][2]),this._selPosition||(this._selPosition=this._point1.clone());break;case 4:this._type=t.GeometryType.SURFACE,this._selectedType=o.ViewedType.SURFACE;var _=i.extractMeshVertices(this._SGPrimitive);this._selPosition||(this._selPosition=new a.Vector3(_[0][0],_[0][1],_[0][2]))}this._mode=t.Mode.FACETTED}this._isPartial=!1,this._partialPaths=[]}return this},clone:function(){var e=new c({},!0);if(e._type=this._type,e._mode=this._mode,this._SGPrimitive&&(e._SGPrimitive=this._SGPrimitive),this._pathElement&&(e._pathElement=this._pathElement.clone()),this._bRealPathElement&&(e._bRealPathElement=this._bRealPathElement),this._selPosition&&(e._selPosition=this._selPosition),this._selNormal&&(e._selNormal=this._selNormal),this._position&&(e._position=this._position),this._point1&&(e._point1=this._point1.clone()),this._point2&&(e._point2=this._point2.clone()),this._origin&&(e._origin=this._origin.clone()),this._normal&&(e._normal=this._normal.clone()),this._center&&(e._center=this._center.clone()),this._apex&&(e._apex=this._apex.clone()),this._axis&&(e._axis=this._axis.clone()),this._radius&&(e._radius=this._radius),this._semiAngle&&(e._semiAngle=this._semiAngle),this._length&&(e._length=this._length),this._area&&(e._area=this._area),this._cog&&(e._cog=this._cog),this._selectedType&&(e._selectedType=this._selectedType),this._isPartial&&(e._isPartial=this._isPartial),this._partialPaths&&(e._partialPaths=[],this._partialPaths.length>0))for(var t=0;t<this._partialPaths.length;t++)e._partialPaths.push(this._partialPaths[t].clone());return this._arcMidPoint&&(e._arcMidPoint=this._arcMidPoint.clone()),this._arcAngle&&(e._arcAngle=this._arcAngle),e},getType:function(){return this._type},getMode:function(){return this._mode},getPrimitive:function(){return this._SGPrimitive},getPathElement:function(){return this._bRealPathElement?this._pathElement.clone():new s},setLevel:function(e){this._level=e},getLevel:function(){return this._level},setPartial:function(e){this._isPartial=e},isPartial:function(){return this._isPartial},setPartialPathElements:function(e){this._partialPaths=[],this._partialPaths=e},setReferentialPosition:function(e){!this._bRealPathElement&&e&&e instanceof a.Matrix4&&(this._matrix=e.clone())},getReferentialPosition:function(){return this._getMatrix().clone()},getPoint:function(){var e=null;return this._type===t.GeometryType.POINT&&(e=this._position.clone().applyMatrix4(this._getMatrix())),e},getPoints:function(){var e=null;return this._type!==t.GeometryType.LINE&&this._type!==t.GeometryType.CURVE&&this._type!==t.GeometryType.CYLINDER&&this._type!==t.GeometryType.CONE&&this._type!==t.GeometryType.CIRCLE&&this._type!==t.GeometryType.PRODUCT||(e={},this._point1&&this._point2&&(e.beginPoint=this._point1.clone().applyMatrix4(this._getMatrix()),e.endPoint=this._point2.clone().applyMatrix4(this._getMatrix()))),e},getPlane:function(){var e=null;return this._type===t.GeometryType.PLANE&&((e={}).origin=this._origin.clone().applyMatrix4(this._getMatrix()),e.normal=this._normal.clone().transformDirection(this._getMatrix())),e},get2DScale:function(){return this._getMatrix().getScaleOnAxisX()},getRadius:function(){var e=null;return this._type!==t.GeometryType.CIRCLE&&this._type!==t.GeometryType.CYLINDER&&this._type!==t.GeometryType.SPHERE||(e=this._radius),e},getCenter:function(){var e=null;return this._type!==t.GeometryType.CIRCLE&&this._type!==t.GeometryType.SPHERE||(e=this._center.clone().applyMatrix4(this._getMatrix())),e},getAxis:function(){var e=null;return this._type===t.GeometryType.CIRCLE?e=this._normal.clone().transformDirection(this._getMatrix()):this._type!==t.GeometryType.LINE&&this._type!==t.GeometryType.CYLINDER&&this._type!==t.GeometryType.CONE||(e=this._point2.clone().sub(this._point1).normalize().transformDirection(this._getMatrix())),e},getAngle:function(){var e=null;return this._type===t.GeometryType.CIRCLE&&(e=2*Math.PI),e},getArcMidPoint:function(){var e=null;return this._type===t.GeometryType.CIRCLE&&(e=this._arcMidPoint.clone().applyMatrix4(this._getMatrix())),e},getArcAngle:function(){var e=null;return this._type===t.GeometryType.CIRCLE&&(e=this._arcAngle),e},getSemiAngle:function(){var e=null;return this._type===t.GeometryType.CONE&&(e=this._semiAngle),e},getApex:function(){var e=null;return this._type===t.GeometryType.CONE&&(e=this._apex.clone().applyMatrix4(this._getMatrix())),e},getLength:function(){var e=null;return this._type===t.GeometryType.LINE||this._type===t.GeometryType.CIRCLE||this._type===t.GeometryType.CURVE?(this._length||this._complete(),e=this._length):this._type===t.GeometryType.PRODUCT&&this._length&&(e=this._length),e},getArcLength:function(){var e=null;return this._type===t.GeometryType.CIRCLE&&(this._arcLength||this._complete(),e=this._arcLength),e},getCoG:function(){var e=null;return this._type!==t.GeometryType.SURFACE&&this._type!==t.GeometryType.CYLINDER&&this._type!==t.GeometryType.SPHERE&&this._type!==t.GeometryType.CONE&&this._type!==t.GeometryType.PLANE&&this._type!==t.GeometryType.PRODUCT||(this._cog||this._complete(),this._cog&&(e=this._cog.clone().applyMatrix4(this._getMatrix()))),e},getArea:function(){var e=null;return this._type!==t.GeometryType.SURFACE&&this._type!==t.GeometryType.CYLINDER&&this._type!==t.GeometryType.SPHERE&&this._type!==t.GeometryType.CONE&&this._type!==t.GeometryType.PLANE&&this._type!==t.GeometryType.PRODUCT||(this._area||this._complete(),this._area&&(e=this._area)),e},getVolume:function(){var e=null;return this.volume||this._complete(),this.volume&&(e=this.volume),e},getSelPoint:function(){var e=null;return this._type===t.GeometryType.POINT&&void 0!==this._position?e=this._position.clone().applyMatrix4(this._getMatrix()):void 0!==this._selPosition?e=this._selPosition.clone().applyMatrix4(this._getMatrix()):void 0!==this._point1&&(e=this._point1.clone().applyMatrix4(this._getMatrix())),e},getSelNormal:function(){return this._selNormal.clone().transformDirection(this._getMatrix())},getOriginPoint:function(){var e=null;return this._originPoint&&this._type===t.GeometryType.PRODUCT&&(e=this._originPoint.clone().applyMatrix4(this._getMatrix())),e},computeMinimumDistance:function(e){var t={returnCode:1};if(e){var i=r.measureBetween(this,this._selectedType,e,e._selectedType);i.position1&&(t.distance=i.distance,t.relationship=i.relationship,t.position1=i.position1,t.position2=i.position2,t.returnCode=0)}return t},computeAngle:function(e){var t={returnCode:1};if(e){var i=r.measureBetween(this,this._selectedType,e,e._selectedType);i.position1&&(t.angle=i.angle,t.returnCode=0)}return t},exportData:function(e){var i={canonic:{}};switch(i.canonic.type=e(this._type,"int"),i.canonic.mode=e(this._mode,"int"),i.canonic.selectedType=e(this._selectedType,"int"),i.canonic.matrix=e(this._getMatrix(),"Matrix4"),this._type){case t.GeometryType.POINT:case t.GeometryType.PICKINGPT:i.canonic.position=e(this._position,"Vector3");break;case t.GeometryType.LINE:i.canonic.point1=e(this._point1,"Vector3"),i.canonic.point2=e(this._point2,"Vector3"),this._length||this._complete(),i.canonic.length=e(this._length,"float");break;case t.GeometryType.CIRCLE:i.canonic.center=e(this._center,"Vector3"),i.canonic.radius=e(this._radius,"float"),i.canonic.normal=e(this._normal,"Vector3"),this._length&&this._arcLength||this._complete(),i.canonic.length=e(this._length,"float"),i.canonic.arcLength=e(this._arcLength,"float"),i.canonic.arcMidPoint=e(this._arcMidPoint,"Vector3"),i.canonic.point1=e(this._point1,"Vector3"),i.canonic.point2=e(this._point2,"Vector3"),i.canonic.arcAngle=e(this._arcAngle,"float");break;case t.GeometryType.PLANE:i.canonic.origin=e(this._origin,"Vector3"),i.canonic.normal=e(this._normal,"Vector3"),this._cog&&this._area||this._complete(),i.canonic.cog=e(this._cog,"Vector3"),i.canonic.area=e(this._area,"float");break;case t.GeometryType.CYLINDER:i.canonic.radius=e(this._radius,"float"),i.canonic.point1=e(this._point1,"Vector3"),i.canonic.point2=e(this._point2,"Vector3"),this._cog&&this._area||this._complete(),i.canonic.cog=e(this._cog,"Vector3"),i.canonic.area=e(this._area,"float");break;case t.GeometryType.CONE:i.canonic.apex=e(this._apex,"Vector3"),i.canonic.semiAngle=e(this._semiAngle,"float"),i.canonic.axis=e(this._axis,"Vector3"),i.canonic.point1=e(this._point1,"Vector3"),i.canonic.point2=e(this._point2,"Vector3"),this._cog&&this._area||this._complete(),i.canonic.cog=e(this._cog,"Vector3"),i.canonic.area=e(this._area,"float");break;case t.GeometryType.SPHERE:i.canonic.radius=e(this._radius,"float"),i.canonic.center=e(this._center,"Vector3"),this._cog&&this._area||this._complete(),i.canonic.cog=e(this._cog,"Vector3"),i.canonic.area=e(this._area,"float");break;case t.GeometryType.SURFACE:this._cog&&this._area||this._complete(),i.canonic.cog=e(this._cog,"Vector3"),i.canonic.area=e(this._area,"float");break;case t.GeometryType.CURVE:this._length||this._complete(),i.canonic.length=e(this._length,"float"),i.canonic.point1=e(this._point1,"Vector3"),i.canonic.point2=e(this._point2,"Vector3")}return i.selpoint=e(this._selPosition,"Vector3"),this._selNormal&&(i.selnormal=e(this._selNormal,"Vector3")),i},importData:function(e,t){return this._type=t(e.canonic.type,"int"),this._mode=t(e.canonic.mode,"int"),this._bRealPathElement=!1,this._pathElement={},this._matrix=e.canonic.matrix?t(e.canonic.matrix,"Matrix4"):new a.Matrix4,e.selpoint&&(this._selPosition=t(e.selpoint,"Vector3")),e.selnormal&&(this._selNormal=t(e.selnormal,"Vector3")),e.canonic.position&&(this._position=t(e.canonic.position,"Vector3")),e.canonic.point1&&(this._point1=t(e.canonic.point1,"Vector3")),e.canonic.point2&&(this._point2=t(e.canonic.point2,"Vector3")),e.canonic.origin&&(this._origin=t(e.canonic.origin,"Vector3")),e.canonic.normal&&(this._normal=t(e.canonic.normal,"Vector3")),e.canonic.center&&(this._center=t(e.canonic.center,"Vector3")),e.canonic.apex&&(this._apex=t(e.canonic.apex,"Vector3")),e.canonic.axis&&(this._axis=t(e.canonic.axis,"Vector3")),e.canonic.radius&&(this._radius=t(e.canonic.radius,"float")),e.canonic.semiAngle&&(this._semiAngle=t(e.canonic.semiAngle,"float")),e.canonic.length&&(this._length=t(e.canonic.length,"float")),e.canonic.area&&(this._area=t(e.canonic.area,"float")),e.canonic.cog&&(this._cog=t(e.canonic.cog,"Vector3")),e.canonic.selectedType&&(this._selectedType=t(e.canonic.selectedType,"int")),e.canonic.arcMidPoint&&(this._arcMidPoint=t(e.canonic.arcMidPoint,"Vector3")),e.canonic.arcLength&&(this._arcLength=t(e.canonic.arcLength,"float")),e.canonic.arcAngle&&(this._arcAngle=t(e.canonic.arcAngle,"float")),this},print:function(e){var i=void 0!==e?e:"Measurable";switch(console.log(i),this._type){case t.GeometryType.POINT:console.log("    type=POINT point=("+this._position.x+", "+this._position.y+", "+this._position.z+")");break;case t.GeometryType.CURVE:console.log("    type=CURVE point1=("+this._point1.x+", "+this._point1.y+", "+this._point1.z+") point2=("+this._point2.x+", "+this._point2.y+", "+this._point2.z+")");break;case t.GeometryType.LINE:console.log("    type=LINE point1=("+this._point1.x+", "+this._point1.y+", "+this._point1.z+") point2=("+this._point2.x+", "+this._point2.y+", "+this._point2.z+")");break;case t.GeometryType.CIRCLE:console.log("    type=CIRCLE radius="+this._radius+" center=("+this._center.x+", "+this._center.y+", "+this._center.z+") normal=("+this._normal.x+", "+this._normal.y+", "+this._normal.z+")");break;case t.GeometryType.SURFACE:console.log("    type=SURFACE area="+this._area+" cog=("+this._cog.x+", "+this._cog.y+", "+this._cog.z+")");break;case t.GeometryType.PLANE:console.log("    type=PLANE origin=("+this._origin.x+", "+this._origin.y+", "+this._origin.z+") normal=("+this._normal.x+", "+this._normal.y+", "+this._normal.z+")");break;case t.GeometryType.CYLINDER:console.log("    type=CYLINDER point1=("+this._point1.x+", "+this._point1.y+", "+this._point1.z+") point2=("+this._point2.x+", "+this._point2.y+", "+this._point2.z+")");break;case t.GeometryType.CONE:console.log("    type=CONE point1=("+this._point1.x+", "+this._point1.y+", "+this._point1.z+") point2=("+this._point2.x+", "+this._point2.y+", "+this._point2.z+")");break;case t.GeometryType.SPHERE:console.log("    type=SPHERE center=("+this._center.x+", "+this._center.y+", "+this._center.z+")")}var n=this._getMatrix().elements;console.log("    transformation=("+n[0]+", "+n[4]+", "+n[8]+"), ("+n[1]+", "+n[5]+", "+n[9]+"), ("+n[2]+", "+n[6]+", "+n[10]+"), ("+n[3]+", "+n[7]+", "+n[11]+")")},_complete:function(){if(this._type===t.GeometryType.PRODUCT)this.updateProductMeasurable();else{var e=n.recognizeNonCanonicGeometry(this._SGPrimitive,new a.Matrix4,!0);this._type===t.GeometryType.CIRCLE?(this._arcLength=e.arcLength,this._length=e.length):this._type===t.GeometryType.LINE?this._length=e.length:this._type===t.GeometryType.PLANE||this._type===t.GeometryType.CYLINDER||this._type===t.GeometryType.CONE||this._type===t.GeometryType.SPHERE?(this._area=e.area,this._cog=e.cog):this._type===t.GeometryType.CURVE?this._length=e.length:(this._area=e.area,this._cog=e.cog)}},_getMatrix:function(){var e=this._bRealPathElement?this._pathElement.getWorldMatrix():this._matrix;return e||(e=new a.Matrix4),e},updateProductMeasurable:function(){var e=r.measureProduct(this);this.volume=void 0,this._area=void 0,this._cog=void 0,this._length=void 0,this._point1=void 0,this._point2=void 0,this._originPoint=void 0,void 0!==e.volume&&(this.volume=e.volume),void 0!==e.area&&(this._area=e.area),void 0!==e.length&&(this._length=e.length);var t=(new a.Matrix4).getInverse(this._getMatrix());void 0!==e.startpoint&&void 0!==e.endpoint&&(this._point1=e.startpoint.clone().applyMatrix4(t),this._point2=e.endpoint.clone().applyMatrix4(t)),void 0!==e.cog&&(this._cog=e.cog.clone().applyMatrix4(t),this._selPosition||(this._selPosition=this._cog.clone())),void 0!==e.originPoint&&(this._originPoint=e.originPoint)}});return c});