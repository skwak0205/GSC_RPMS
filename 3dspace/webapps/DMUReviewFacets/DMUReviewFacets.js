define("DS/DMUReviewFacets/DMUR3MReviewController",["UWA/Core","UWA/Class","DS/Controls/Expander","DS/Controls/Button","DS/DMUControls/DMUReviewExpander","DS/DMUValidationPersistence/DMUValidationPersistenceServices","i18n!DS/DMUReviewFacets/assets/nls/DMUReviewFacets","css!DS/DMUReviewFacets/DMUReviewFacets.css"],function(e,t,n,s,i,l,a){"use strict";var o=t.extend({init:function(t){this._parent(t);var o=[];o.statusOK={fonticonClass:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-check",fonticonColor:"rgb(71,119,56)"},o.statusKO={fonticonClass:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-wrong",fonticonColor:"rgb(234,79,55)"},o.statusUNK={fonticonClass:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-i-question",fonticonColor:"#007DA3"},o.statusTBA={fonticonClass:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-attention",fonticonColor:"#007DA3"},o.requirement={fonticonClass:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-requirement",fonticonColor:"black"},o.highlight_high={fonticonClass:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-level-high",fonticonColor:"rgb(234,79,55)"},o.highlight_medium={fonticonClass:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-level-medium",fonticonColor:"rgb(232,123,0)"},o.highlight_low={fonticonClass:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-level-low",fonticonColor:"rgb(71,119,56)"},o.ca_high={fonticonClass:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-change",fonticonColor:"rgb(234,79,55)"},o.ca_medium={fonticonClass:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-change",fonticonColor:"rgb(232,123,0)"},o.ca_low={fonticonClass:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-change",fonticonColor:"rgb(71,119,56)"};var c,d,h,r,g=[o.statusUNK,o.statusOK,o.statusKO,o.requirement],u=[o.statusTBA,o.highlight_low,o.highlight_medium,o.highlight_high,o.statusOK],p=[],m=[],f=!1,C=!1,v=[],x=[],w=[],y=[],E=function(){},M=function(e){var t=!1;e.stopPropagation();var n,s=this.getParents();for(let e=0;e<s.length;e++){if(s[e].hasClassName("highlightsExpanders")){t=!0,n=s[e].getElementsByClassName("highlightFacetExpander");for(let e=0;e<n.length;e++)n[e].dsModel.expand()}if(s[e].hasClassName("checksExpanders")){t=!0,n=s[e].getElementsByClassName("checkFacetExpander");for(let e=0;e<n.length;e++)n[e].dsModel.expand()}}if(!1===t)for(let e=0;e<s.length;e++){if(s[e].hasClassName("highlightsContent")){n=s[e].getElementsByClassName("highlightFacetExpander");for(let e=0;e<n.length;e++)n[e].dsModel.expand()}if(s[e].hasClassName("checksContent")){n=s[e].getElementsByClassName("checkFacetExpander");for(let e=0;e<n.length;e++)n[e].dsModel.expand()}}},D=function(e){var t=!1;e.stopPropagation();var n,s=this.getParents();for(let e=0;e<s.length;e++){if(s[e].hasClassName("highlightsExpanders")){t=!0,n=s[e].getElementsByClassName("highlightFacetExpander");for(let e=0;e<n.length;e++)n[e].dsModel.collapse()}if(s[e].hasClassName("checksExpanders")){t=!0,n=s[e].getElementsByClassName("checkFacetExpander");for(let e=0;e<n.length;e++)n[e].dsModel.collapse()}}if(!1===t)for(let e=0;e<s.length;e++){if(s[e].hasClassName("highlightsContent")){n=s[e].getElementsByClassName("highlightFacetExpander");for(let e=0;e<n.length;e++)n[e].dsModel.collapse()}if(s[e].hasClassName("checksContent")){n=s[e].getElementsByClassName("checkFacetExpander");for(let e=0;e<n.length;e++)n[e].dsModel.collapse()}}},k=function(e,t){var n=[];e&&e.length>0&&e.forEach(function(e){var t=e.objectId;t||(t=e.object.getPlmID()),n.push({sObjectId:t,sListOfAttributesToModify:e.attributesList})}),l.updateAttributes({objectsToModify:n,platform:c,onAttributesSaveCompleted:function(e){var n,s,i,l=e.modifiedObjects[0];if(n=[l.pId],l.sName&&(n[l.pId]={title:l.sName},r(n)),l.sDescription&&(n[l.pId]={description:l.sDescription},r(n)),"Check"===t){l.iCheckState&&(n[l.pId]={iCheckState:l.iCheckState},r(n));for(let e=0;e<m.length;e++)m[e].updateImpactedCheckDisplay({id:l.pId,status:l.iCheckState?l.iCheckState:void 0,name:l.sName?l.sName:void 0});for(let e=0;e<x.length;e++){var a=w[x[e]].checks[l.pId];if(a&&l.iCheckState?a.status=l.iCheckState:a&&l.sName?a.name=l.sName:a&&l.sDescription&&(a.description=l.sDescription),v[x[e]]&&v[x[e]][l.pId].length){s=v[x[e]][l.pId];for(let t=0;t<s.length;t++){i=v[x[e]][s[t].id];for(let e=0;e<i.length;e++)i[e].id===l.pId&&(l.iCheckState?i[e].status=l.iCheckState:l.sName&&(i[e].name=l.sName))}}}}if("Highlight"===t){for(let e=0;e<p.length;e++)p[e].updateAssociatedHighlightsDisplay({id:l.pId,rating:l.iPresentationRating?l.iPresentationRating:void 0,name:l.sName?l.sName:void 0});for(let e=0;e<x.length;e++){var o=w[x[e]].highlights[l.pId];if(o&&l.iPresentationRating?o.rating=parseInt(l.iPresentationRating):o&&l.sName?o.name=l.sName:o&&l.sDescription&&(o.description=l.sDescription),v[x[e]]&&v[x[e]][l.pId].length){i=v[x[e]][l.pId];for(let t=0;t<i.length;t++){s=v[x[e]][i[t].id];for(let e=0;e<s.length;e++)s[e].id===l.pId&&(l.iPresentationRating?s[e].rating=l.iPresentationRating:l.sName&&(s[e].name=l.sName))}}}}},onAttributesSaveFailed:function(){}})},I=function(e,t,n){var s=[];"status"===t&&s.push({iCheckState:n}),"name"===t&&s.push({sName:n}),"description"===t&&s.push({sDescription:n});var i=[];i.push({attributesList:s,objectId:e}),k(i,"Check")},N=function(e,t,n){var s=[];"rating"===t&&s.push({iPresentationRating:n}),"name"===t&&s.push({sName:n}),"description"===t&&s.push({sDescription:n});var i=[];i.push({attributesList:s,objectId:e}),k(i,"Highlight")},b=function(e){var t,n;if(e&&e.length)for(let s=0;s<e.length;s++)if(!w[e[s].id]){x.push(e[s].id),w[e[s].id]={highlights:[],checks:[],name:e[s].name},y[e[s].id]={highlights:[],checks:[]},t=e[s].children;for(let i=0;i<t.length;i++)n=t[i].id,"DMUValidationExposedPresentation"===t[i].type&&(w[e[s].id].highlights[n]={id:n,rating:parseInt(t[i].rating),name:t[i].name,description:t[i].description,associatedCheck:t[i].associatedCheck,issues:t[i].Issue,changeAction:t[i].ChangeAction},y[e[s].id].highlights.push({id:n,rating:parseInt(t[i].rating),name:t[i].name,description:t[i].description,associatedCheck:t[i].associatedCheck,issues:t[i].Issue,changeAction:t[i].ChangeAction})),"DMUValidationCheck"===t[i].type&&(w[e[s].id].checks[n]={id:n,status:parseInt(t[i].state),name:t[i].name,description:t[i].description,requirements:t[i].children?t[i].children:void 0},y[e[s].id].checks.push({id:n,status:parseInt(t[i].state),name:t[i].name,description:t[i].description,requirements:t[i].children?t[i].children:void 0}))}},A=function(e){var t,n,s,i;if(e&&e.length)for(let l=0;l<e.length;l++)if(n=e[l].id,!v[n]){t=y[n].highlights;for(let e=0;e<t.length;e++)if(s=t[e].id,t[e].associatedCheck&&t[e].associatedCheck.length){i=t[e].associatedCheck;for(let e=0;e<i.length;e++)v[n]||(v[n]=[]),v[n][s]||(v[n][s]=[]),v[n][i[e]]||(v[n][i[e]]=[]),v[n][s].push({id:w[n].checks[i[e]].id,status:w[n].checks[i[e]].status,name:w[n].checks[i[e]].name}),v[n][i[e]].push({id:w[n].highlights[s].id,rating:w[n].highlights[s].rating,name:w[n].highlights[s].name})}}},j=function(e,t){var n=new i({objectData:{id:e.id,rating:e.rating,name:e.name,description:e.description?e.description:"",changeAction:e.changeAction?e.changeAction:void 0,issues:e.issues?e.issues:void 0},editionMode:!1,readOnly:!1,onHighlightAttributeChanged:N,icons:u,checkIcons:g,impChecksInfos:v[t]?v[t]:[],type:"Highlight",panelType:"facet"});return n.getMainDiv().getContent().addClassName("highlightFacetExpander"),n.getMainDiv().expand(),m.push(n),n},R=function(e,t){var n=new i({objectData:{id:e.id,status:e.status,name:e.name,description:e.description?e.description:"",requirements:e.children?e.children:void 0},editionMode:!1,readOnly:!1,onCheckAttributeChanged:I,icons:g,highlightIcons:u,impChecksInfos:v[t]?v[t]:[],type:"Check",panelType:"facet"});return n.getMainDiv().getContent().addClassName("checkFacetExpander"),n.getMainDiv().expand(),p.push(n),n};this.getValidations=function(t,i,l,o,g,u,p){c=o,r=g;var m=function(t){var i,o,c,d,r,g,u;h=new e.Element("div",{class:"highlightsContent"});var m,f=[];let v=a.noHighlight?a.noHighlight:"The selected Review does not contain any Highlight";if(t&&t.validations&&(b(t.validations),A(t.validations)),t.validations&&t.validations.length&&t.validations.length>1)for(let s=0;s<t.validations.length;s++){var x=new e.Element("div",{class:"highlightExpanderContent"});if(i=t.validations[s].id,l.length&&t.objects){o=[],u=!1;for(let e=0;e<t.objects.length;e++)(g=t.objects[e].validationId)===i&&(o.push(w[g].highlights[t.objects[e].highlightId]),u=!0);u||(o=y[i].highlights),u=!1}else o=y[i].highlights;if(0===o.length)new e.Element("div",{text:v,class:"noHighlight"}).inject(x).setStyles({"padding-top":"10px"});else for(let t=0;t<o.length;t++)C=!0,m=new e.Element("div",{class:"flowContainer"}).inject(x),j(o[t],i).inject(m).getContent().setStyles({"margin-left":"5px"});c=new e.Element("div",{class:"CollapseExpandAll"}),r=new e.Element("span",{class:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-expand-all expandAllIcon"}).inject(c),(d=new e.Element("span",{class:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-collapse-all collapseAllIcon"}).inject(c)).onclick=D,r.onclick=M;var E=new n({header:w[i].name,body:x,style:"simple",customHeader:c}).inject(h);E.expand(),E.elements.bodyContainer.setStyles({"padding-top":"0px"}),E.getContent().setStyles({"padding-bottom":"8px"}),E.getContent().addClassName("highlightsExpanders")}else if(t.validations.length&&1===t.validations.length){if(l.length&&t.objects){o=[],u=!1;for(let e=0;e<t.objects.length;e++)g=t.objects[e].validationId,f.push(g),o.push(w[g].highlights[t.objects[e].highlightId])}else i=t.validations[0].id,o=y[i].highlights;if(o.length>0){var k=new e.Element("div",{class:"globalDiv"}).inject(h);c=new e.Element("div",{class:"CollapseExpandAll"}).inject(k);var I=new e.Element("div",{class:"expandIconPlaceholder"}).inject(c);(r=new s({displayStyle:"lite",label:"expand All",icon:{iconName:"expand-all",fontIconFamily:WUXManagedFontIcons.Font3DS},showLabelFlag:!1}).inject(I)).getContent().addClassName("expandAllIcon");var N=new e.Element("div",{class:"expandIconPlaceholder"}).inject(c);(d=new s({displayStyle:"lite",label:"collapse All",icon:{iconName:"collapse-all",fontIconFamily:WUXManagedFontIcons.Font3DS},showLabelFlag:!1}).inject(N)).getContent().addClassName("collapseAllIcon"),d.getContent().onclick=D,r.getContent().onclick=M}for(let t=0;t<o.length;t++)C=!0,m=new e.Element("div",{class:"flowContainer"}).inject(h),j(o[t],f.length?f[0]:i).inject(m).getContent().setStyles({"margin-left":"5px"})}C||new e.Element("div",{text:v,class:"noHighlight"}).inject(h),C=!1,p(h)},v=function(t){var l,o,c,h,r,g,u;d=new e.Element("div",{class:"checksContent"});var m,C=[];let v=a.noCheck?a.noCheck:"The selected Review does not contain any Check";if(t&&t.validations&&(b(t.validations),A(t.validations)),t.validations&&t.validations.length&&t.validations.length>1)for(let s=0;s<t.validations.length;s++){l=t.validations[s].id;var x=new e.Element("div",{class:"highlightExpanderContent"});if(i.length&&t.objects){o=[],u=!1;for(let e=0;e<t.objects.length;e++)(g=t.objects[e].validationId)===l&&(o.push(w[g].checks[t.objects[e].checkId]),u=!0);u||(o=y[l].checks)}else o=y[l].checks;if(0===o.length)new e.Element("div",{text:v,class:"noCheck"}).inject(x).setStyles({"padding-top":"10px"});else for(let t=0;t<o.length;t++)f=!0,m=new e.Element("div",{class:"flowContainer"}).inject(x),R(o[t],l).inject(m).getContent().setStyles({"margin-left":"5px"});c=new e.Element("div",{class:"CollapseExpandAll"}),r=new e.Element("span",{class:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-expand-all expandAllIcon"}).inject(c),(h=new e.Element("span",{class:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-collapse-all collapseAllIcon"}).inject(c)).onclick=D,r.onclick=M;var E=new n({header:w[l].name,body:x,style:"simple",customHeader:c}).inject(d);E.expand(),E.elements.bodyContainer.setStyles({"padding-top":"0px"}),E.getContent().setStyles({"padding-bottom":"8px"}),E.getContent().addClassName("checksExpanders")}else if(t.validations&&t.validations.length&&1===t.validations.length){if(i.length&&t.objects){o=[];for(let e=0;e<t.objects.length;e++)g=t.objects[e].validationId,C.push(g),o.push(w[g].checks[t.objects[e].checkId])}else l=t.validations[0].id,o=y[l].checks;if(o.length>0){var k=new e.Element("div",{class:"globalDiv"}).inject(d);c=new e.Element("div",{class:"CollapseExpandAll"}).inject(k);var I=new e.Element("div",{class:"expandIconPlaceholder"}).inject(c);(r=new s({displayStyle:"lite",label:"expand All",icon:{iconName:"expand-all",fontIconFamily:WUXManagedFontIcons.Font3DS},showLabelFlag:!1}).inject(I)).getContent().addClassName("expandAllIcon");var N=new e.Element("div",{class:"collapseIconPlaceholder"}).inject(c);(h=new s({displayStyle:"lite",label:"collapse All",icon:{iconName:"collapse-all",fontIconFamily:WUXManagedFontIcons.Font3DS},showLabelFlag:!1}).inject(N)).getContent().addClassName("collapseAllIcon"),h.getContent().onclick=D,r.getContent().onclick=M}for(let t=0;t<o.length;t++)f=!0,m=new e.Element("div",{class:"flowContainer"}).inject(d),R(o[t],C.length?C[0]:l).inject(m).getContent().setStyles({"margin-left":"5px"})}f||new e.Element("div",{text:v,class:"noCheck"}).inject(d),f=!1,p(d)};(l.length||i.length||t.length)&&require(["DS/DMUReadPersistence/DMUValidationReadServices"].concat([]),function(e){(new e).getValidationsFromObjectsIds({highlightIds:l,checkIds:i,validationIds:t,onSuccess:"Highlight"===u?m:v,onFailure:E,platform:o})})},this.clearView=function(e){var t;if("Highlight"===e&&h){m=[];var n=h.getElementsByClassName("highlightsExpanders");if(n.length)for(let e=0;e<n.length;e++){n[e].getElementsByClassName("expandAllIcon").length&&n[e].getElementsByClassName("expandAllIcon")[0].destroy(),n[e].getElementsByClassName("collapseAllIcon").length&&n[e].getElementsByClassName("collapseAllIcon")[0].destroy(),t=n[e].getElementsByClassName("highlightFacetExpander");for(let e=0;e<t.length;e++)t[e].dsModel.clear(),t[e].destroy();n[e].getElementsByClassName("noHighlight").length&&n[e].getElementsByClassName("noHighlight")[0].destroy(),n[e].destroy()}else{h.getElementsByClassName("expandAllIcon").length&&h.getElementsByClassName("expandAllIcon")[0].destroy(),h.getElementsByClassName("collapseAllIcon").length&&h.getElementsByClassName("collapseAllIcon")[0].destroy(),t=h.getElementsByClassName("highlightFacetExpander");for(let e=0;e<t.length;e++)t[e].dsModel.clear(),t[e].destroy()}h.destroy()}if("Check"===e&&d){p=[];var s=d.getElementsByClassName("checksExpanders");if(s.length)for(let e=0;e<s.length;e++){s[e].getElementsByClassName("expandAllIcon").length&&s[e].getElementsByClassName("expandAllIcon")[0].destroy(),s[e].getElementsByClassName("collapseAllIcon").length&&s[e].getElementsByClassName("collapseAllIcon")[0].destroy(),t=s[e].getElementsByClassName("checkFacetExpander");for(let e=0;e<t.length;e++)t[e].dsModel.clear(),t[e].destroy();s[e].getElementsByClassName("noCheck").length&&s[e].getElementsByClassName("noCheck")[0].destroy(),s[e].destroy()}else{d.getElementsByClassName("expandAllIcon").length&&d.getElementsByClassName("expandAllIcon")[0].destroy(),d.getElementsByClassName("collapseAllIcon").length&&d.getElementsByClassName("collapseAllIcon")[0].destroy(),t=d.getElementsByClassName("checkFacetExpander");for(let e=0;e<t.length;e++)t[e].dsModel.clear(),t[e].destroy()}d.destroy()}x=[],y=[],w=[]}}}),c=[];return t.singleton({init:function(){},getDMUR3MReviewController:function(){for(var e,t=0;t<c.length;t++){c[t].counter++,e=c[t].reviewController;break}if(!e){var n=new o;e={getValidations:function(e,t,s,i,l,a,o){if(n)return n.getValidations(e,t,s,i,l,a,o)},clearView:function(e){if(n)return n.clearView(e)}},c.push({reviewController:e,counter:1})}return e?Object.freeze(e):e},giveDMUR3MReviewController:function(){for(var e,t=0;t<c.length;t++){e=c[t].reviewController;break}return e?Object.freeze(e):e},unreferenceDMUR3MReviewController:function(){for(var e=0;e<c.length;e++){c[e].counter--,c[e].counter<=0&&(c[e].reviewController.clear(),c.splice(e,1));break}}})}),define("DS/DMUReviewFacets/DMUwebR3MinfoRvwHighlightTab",["UWA/Core","DS/EditPropWidget/facets/Common/FacetsBase","UWA/Controls/ThemedScroller","DS/DMUReviewFacets/DMUR3MReviewController"],function(e,t,n,s){"use strict";return t.extend({init:function(t){this._parent(t);var i,l=t.requestUtils,a=this;this.elements={},this.elements.container=e.createElement("div",{class:"infoRvwHighlight"});var o=[],c=[],d=function(e){var t=e.getElementsByClassName("reviewExpander"),s=e.getElementsByClassName("highlightsExpanders");for(let e=0;e<t.length;e++)o.push(t[e].dsModel);for(let e=0;e<s.length;e++)c.push(s[e].dsModel);i||(i=(new n).inject(a.elements.container)).getContent().setStyle("height","100%"),i.getInnerElement().setContent(e),a.hideLoader()};this.updateFacet=function(){var e,n,i=this.getModel(),a=i.get("objectId"),o=i.get("_DS_ATTR_type");o=o&&o.valueDB?o.valueDB:i.get("_DS_ATTR_type");var c=[],h=[],r=[],g=s.giveDMUR3MReviewController();if(g||(g=s.getDMUR3MReviewController()),g.clearView("Highlight"),this.showLoader(),!i)return!1;if(i.getMergingModels){e=i.getMergedModelIds(),n=i.getMergingModels();for(let t=0;t<e.length;t++)"DMUValidationValidation"===(o=(o=n[e[t]].get("_DS_ATTR_type"))&&o.valueDB?o.valueDB:n[e[t]].get("_DS_ATTR_type"))?c.push(e[t]):"DMUValidationCheck"===o?h.push(e[t]):"DMUValidationExposedPresentation"===o&&r.push(e[t])}else"DMUValidationValidation"===o?c.push(a):"DMUValidationCheck"===o?h.push(a):"DMUValidationExposedPresentation"===o&&r.push(a);g.getValidations(c,h,r,l,t.onFacetModification,"Highlight",d)},this.destroyComponent=function(){},this.clearFacet=function(){for(let e=0;e<o.length;e++)o[e].destroy();for(let e=0;e<c.length;e++)c[e].destroy();o=[],c=[]},this.onResize=function(){},this.onRefresh=function(){this.clearFacet(),this.updateFacet()}}})}),define("DS/DMUReviewFacets/DMUwebR3MinfoRvwCheckTab",["UWA/Core","DS/EditPropWidget/facets/Common/FacetsBase","UWA/Controls/ThemedScroller","DS/DMUReviewFacets/DMUR3MReviewController"],function(e,t,n,s){"use strict";return t.extend({init:function(t){this._parent(t);var i,l=t.requestUtils,a=this;this.elements={},this.elements.container=e.createElement("div",{class:"infoRvwCheckTab"});var o=[],c=[],d=function(e){var t=e.getElementsByClassName("reviewExpander"),s=e.getElementsByClassName("checksExpanders");for(let e=0;e<t.length;e++)o.push(t[e].dsModel);for(let e=0;e<s.length;e++)c.push(s[e].dsModel);i||(i=(new n).inject(a.elements.container)).getContent().setStyle("height","100%"),i.getInnerElement().setContent(e),a.hideLoader()};this.updateFacet=function(){var e,n,i=this.getModel(),a=i.get("objectId"),o=i.get("_DS_ATTR_type");o=o&&o.valueDB?o.valueDB:i.get("_DS_ATTR_type");var c=[],h=[],r=[],g=s.giveDMUR3MReviewController();if(g||(g=s.getDMUR3MReviewController()),g.clearView("Check"),this.showLoader(),!i)return!1;if(i.getMergingModels){e=i.getMergedModelIds(),n=i.getMergingModels();for(let t=0;t<e.length;t++)"DMUValidationValidation"===(o=(o=n[e[t]].get("_DS_ATTR_type"))&&o.valueDB?o.valueDB:n[e[t]].get("_DS_ATTR_type"))?c.push(e[t]):"DMUValidationCheck"===o?h.push(e[t]):"DMUExposedPresentation"===o&&r.push(e[t])}else"DMUValidationValidation"===o?c.push(a):"DMUValidationCheck"===o?h.push(a):"DMUExposedPresentation"===o&&r.push(a);g.getValidations(c,h,r,l,t.onFacetModification,"Check",d)},this.destroyComponent=function(){},this.onResize=function(){},this.onRefresh=function(){this.updateFacet()}}})});