/*!  Copyright 2016 Dassault Systemes. All rights reserved. */
define("DS/SMAMpwControls/SMAMpwSpinBox",["UWA/Core","DS/Controls/SpinBox"],function(e,t){"use strict";var i=function(){var e;this.elements.inputField&&(e=this.units&&this.units.length>0?this.value.toPrecision(this.precision)+" "+this.units:this.value.toPrecision(this.precision),this.elements.inputField.setText(e),this.elements.inputField.value=e)};return t.inherit({name:"spinBox",publishedProperties:{value:{defaultValue:0,type:Number},units:{defaultValue:"",type:String},minValue:{defaultValue:null,type:Number},maxValue:{defaultValue:null,type:Number},stepValue:{defaultValue:.1,type:Number},pageStepValue:{defaultValue:10,type:Number},decimals:{defaultValue:20,type:Number},precision:{defaultValue:3,type:Number},onValueChanged:{defaultValue:null,type:Function},customClass:{defaultValue:"",type:String},customStyle:{defaultValue:null,type:Object}},_postBuildView:function(){this._parent(),i.call(this),this.elements.container&&(this.elements.container.addClassName(this.customClass),this.customStyle&&e.extend(this.elements.container.style,this.customStyle))},_applyValue:function(e){if(isNaN(this.value))this.value=e;else{var t=function(){var e=this.value;void 0!==this.maxValue&&null!==this.maxValue&&e>this.maxValue&&(e=this.maxValue),void 0!==this.minValue&&null!==this.minValue&&e<this.minValue&&(e=this.minValue);var t=e;return this.precision&&(t=parseFloat(e.toPrecision(this.precision))),t}.call(this);t!==this.value?this.value=t:(i.call(this),this.fire("change"))}},_applyProperties:function(e){this._applyDisabled(),this._applyVisibleFlag(),this._applyTouchMode(),void 0!==e.value&&this._applyValue(e.value)}})}),define("DS/SMAMpwControls/SMAMpwInputCursors",["css!DS/SMAMpwControls/SMAMpwInputCursors.css","UWA/Core","DS/Controls/Abstract","DS/CoreEvents/Events","DS/WebappsUtils/Promise"],function(e,t,i,s,n){"use strict";return i.inherit({name:"SMAMpwInputCursors",publishedProperties:{divLegend:{defaultValue:null,type:HTMLElement},valuePrecision:{defaultValue:null,type:Number},localMinValue:{defaultValue:null,type:Number},localMaxValue:{defaultValue:null,type:Number},globalMinValue:{defaultValue:null,type:Number},globalMaxValue:{defaultValue:null,type:Number},isReadOnly:{defaultValue:!1,type:Boolean},hideCursors:{defaultValue:!1,type:Boolean},passFailImgUrl:{defaultValue:"",type:String},postDOMInsertEventId:{defaultValue:null,type:Number},invertedPalette:{defaultValue:!1,type:Boolean},loadColorsImage:{defaultValue:null,type:Function},userMinGetter:{defaultValue:null,type:Function},userMaxGetter:{defaultValue:null,type:Function},updateUserMax:{defaultValue:null,type:Function},updateUserMin:{defaultValue:null,type:Function}},init:function(e){this.outOfBoundBorderWidth=8.5,this.incrementBorderWidth=6,this.currentIncrement="none",this.currentIncrementSign=0,this.displayPassFail=!1,this.inAnimation=!1,this.isEditing=!1,this.callbacks={cursorInputMaxInputCallback:this._editingInputCursor.bind(this),cursorInputMinInputCallback:this._editingInputCursor.bind(this),cursorInputMaxChangeCallback:this._inputValueChanged.bind(this,"max"),cursorInputMinChangeCallback:this._inputValueChanged.bind(this,"min"),cursorInputMaxMousemoveCallback:this.inputSwitchCallback.bind(this),cursorInputMinMousemoveCallback:this.inputSwitchCallback.bind(this)},this._parent(e),this.drawToCanvasInfo={},this.drawToCanvasInfo.image=new t.Element("img"),this.loadColorsImage(this.drawToCanvasInfo.image);var i=[];i.push(new n(function(e){this.drawToCanvasInfo.image.onload=e()}.bind(this))),this.passFailImgUrl.length&&(this.drawToCanvasInfo.passFailImage=new t.Element("img"),this.drawToCanvasInfo.passFailImage.src=this.passFailImgUrl,i.push(new n(function(e){this.drawToCanvasInfo.passFailImage.onload=e}.bind(this)))),this.drawToCanvasInfo.imagesReady=!1,n.all(i).then(function(){this.drawToCanvasInfo.imagesReady=!0}.bind(this))},updateLocalMinMax:function(e,t){this.localMinValue=e,this.localMaxValue=t},setAnimationMode:function(e){e?(this.cursorsDiv.addClassName("cursors-in-animation"),this.outOfBoundBorderWidth=11.5,this.incrementBorderWidth=8):(this.cursorsDiv.removeClassName("cursors-in-animation"),this.outOfBoundBorderWidth=8.5,this.incrementBorderWidth=6),this.cursorInputMin.min=-this.outOfBoundBorderWidth,this.cursorInputMax.min=-this.outOfBoundBorderWidth,this.cursorInputMin.max=100+this.outOfBoundBorderWidth,this.cursorInputMax.max=100+this.outOfBoundBorderWidth,this.inAnimation=e},getUserMin:function(){var e=this.userMinGetter();return isNaN(e)?this.localMinValue:e},getUserMax:function(){var e=this.userMaxGetter();return isNaN(e)?this.localMaxValue:e},_postBuildView:function(){this._parent(),this.paletteSection=new t.Element("div",{class:"simux-2dlegend-palette"}).inject(this.divLegend),this.paletteMin=new t.Element("div",{class:"simux-2dlegend-colorbar simux-2dlegend-colorbar-min",invertFlag:this.invertedPalette}).inject(this.paletteSection),this.paletteColors=new t.Element("div",{class:"simux-2dlegend-colorbar simux-2dlegend-colorbar-colors"}).inject(this.paletteSection),this.loadColorsImage(this.paletteColors),this.paletteColors.onload=function(){this.colorPaletteImgUrl=this.paletteColors.style["background-image"]}.bind(this),this.paletteColors.src&&(this.paletteColors.style["background-image"]="url("+this.paletteColors.src+")"),this.paletteMax=new t.Element("div",{class:"simux-2dlegend-colorbar simux-2dlegend-colorbar-max",invertFlag:this.invertedPalette}).inject(this.paletteSection),this.cursorsDiv=new t.Element("div",{class:"simux-2dlegend-cursors"}).inject(this.divLegend),this.minOutOfRangeLink=new t.Element("div",{invertFlag:this.invertedPalette,class:"simux-2dlegend-outOfRange simux-2dlegend-outOfRange-min"}).inject(this.cursorsDiv),this.maxOutOfRangeLink=new t.Element("div",{invertFlag:this.invertedPalette,class:"simux-2dlegend-outOfRange simux-2dlegend-outOfRange-max"}).inject(this.cursorsDiv),this.userMinAnimationCursor=new t.Element("div",{class:"simux-2dlegend-userAnimationCursor-min simux-2dlegend-userAnimationCursor"}).inject(this.cursorsDiv),this.userMaxAnimationCursor=new t.Element("div",{class:"simux-2dlegend-userAnimationCursor-max simux-2dlegend-userAnimationCursor"}).inject(this.cursorsDiv),this.cursorInputMin=new t.Element("input",{class:"simux-2dlegend-cursors-input input-cursor-min",invertFlag:this.invertedPalette,attributes:{type:"range",step:.1,value:0,min:-this.outOfBoundBorderWidth,max:100+this.outOfBoundBorderWidth}}).inject(this.cursorsDiv),this.cursorInputMax=new t.Element("input",{class:"simux-2dlegend-cursors-input input-cursor-max",invertFlag:this.invertedPalette,attributes:{type:"range",step:.1,value:100,min:-this.outOfBoundBorderWidth,max:100+this.outOfBoundBorderWidth}}).inject(this.cursorsDiv),this.minOutOfRangeLink.hide(),this.maxOutOfRangeLink.hide(),this.cursorInputMax.hide(),this.cursorInputMin.hide();var e=s.subscribe({event:this.postDOMInsertEventId},function(){this.hideCursors||(this.cursorInputMin.show(),this.cursorInputMax.show(),this.toggleCallbacks(!0),this._updateInputCursor("none",this.cursorInputMin),this._updateInputCursor("none",this.cursorInputMax),this._inputValueChanged("max"),this._inputValueChanged("min")),this.isReadOnly&&(this.cursorInputMin.disabled=!0,this.cursorInputMax.disabled=!0),s.unsubscribe(e)}.bind(this))},_editingInputCursor:function(e,t){var i=parseFloat(this.cursorInputMax.value),s=parseFloat(this.cursorInputMin.value);if(!e||!(e.target===this.cursorInputMin&&this._lastChangedMin===s||e.target===this.cursorInputMax&&this._lastChangedMax===i)){var n;if(e?(n=e.target,this.isEditing=!0):(n="min"===t?this.cursorInputMin:this.cursorInputMax,this.isEditing=!1),s<0&&i<0)n.value="0";else if(s>100&&i>100)n.value="100";else if(s>i){this._updateCursorsColors();var a=this.cursorInputMax;this.cursorInputMax=this.cursorInputMin,this.cursorInputMin=a}if(e||"min"===t||"max"===t){var l=n.className.indexOf("min")>=0?"min":"max";this._updateInputCursor(l,n)}}},_updateInputCursor:function(e,t){var i,s=parseFloat(t.value);if(s<0)"none"!==e&&(i=s<-this.incrementBorderWidth?-1:1,"min"===this.currrentIncrement&&this.currentIncrementSign===i||(this.currentIncrement="min",this.currentIncrementSign=i,this.outOfBoundIncrement("min",i)));else if(s>100)"none"!==e&&(i=s>100+this.incrementBorderWidth?1:-1,"max"===this.currrentIncrement&&this.currentIncrementSign===i||(this.currentIncrement="max",this.currentIncrementSign=i,this.outOfBoundIncrement("max",i)));else{this.currentIncrement="none",this.currentIncrementSign=0;var n=this.localMinValue+s/100*(this.localMaxValue-this.localMinValue);"min"===e?this.updateUserMin(n):"max"===e&&this.updateUserMax(n)}this.updateScale("none"),this._updateOutOfBoundDisplay()},_inputValueChanged:function(e){this.currentIncrement="none",this.isEditing=!1;var t="min"===e?this.cursorInputMin:this.cursorInputMax,i=parseFloat(t.value);i>100?this.getUserMax().toPrecision(this.valuePrecision)===this.localMaxValue.toPrecision(this.valuePrecision)?(t.value="100",this.updateUserMax()):t.value=Math.round(100+this.incrementBorderWidth).toString():i<0&&(this.getUserMin().toPrecision(this.valuePrecision)===this.localMinValue.toPrecision(this.valuePrecision)?(t.value="0",this.updateUserMin()):t.value=Math.round(-this.incrementBorderWidth).toString()),this._lastChangedMin=parseFloat(this.cursorInputMin.value),this._lastChangedMax=parseFloat(this.cursorInputMax.value),this._updateOutOfBoundDisplay()},updateScale:function(e){"min"!==e&&"max"!==e||this.updateCursorsFromMinMax(e);var t,i,s=this.paletteSection.offsetWidth;if(!this.isReadOnly){if(this.localMinValue===this.localMaxValue)return this.paletteMin.style.width=s.toString()+"px",this.paletteMax.style.width=0,this.paletteColors.style.width=0,this.cursorInputMax.hide(),this.cursorInputMin.hide(),this.cursorInputMin.disabled=!0,void(this.cursorInputMax.disabled=!0);(this.cursorInputMin.disabled||this.cursorInputMax.disabled)&&(this.cursorInputMax.show(),this.cursorInputMin.show(),this.inAnimation||(this.cursorInputMin.disabled=!1,this.cursorInputMax.disabled=!1))}this.inAnimation?(t=isNaN(this.userMinGetter())?0:(this.getUserMin()-this.globalMinValue)/(this.globalMaxValue-this.globalMinValue),i=isNaN(this.userMaxGetter())?0:(this.globalMaxValue-this.getUserMax())/(this.globalMaxValue-this.globalMinValue)):(t=(this.getUserMin()-this.localMinValue)/(this.localMaxValue-this.localMinValue),i=(this.localMaxValue-this.getUserMax())/(this.localMaxValue-this.localMinValue));var n=t*s,a=Math.min(i*s,s),l=s-n-a+1,o=function(e){return Math.round(Math.max(Math.min(s,e),0)).toString()+"px"};this.paletteMin.style.width=o(n),this.paletteMax.style.width=o(a),this.paletteColors.style.width=o(Math.min(l,s-n,s-a)),this.paletteColors.style["background-position"]=n<0?n.toString()+"px":0,this.paletteColors.style["background-size"]=l.toString()+"px 25px",this.inAnimation&&(this.userMinGetter()||this.userMaxGetter())?(this.userMinAnimationCursor.style.left=o(t*s),this.userMaxAnimationCursor.style.right=o(i*s),this.userMinAnimationCursor.show(),this.userMaxAnimationCursor.show()):(this.userMinAnimationCursor.hide(),this.userMaxAnimationCursor.hide())},resetInputCursor:function(e){this._editingInputCursor(null,e),this.updateScale("none"),this._updateCursorsColors()},updateCursorsFromMinMax:function(e){if(!this.isEditing){var t,i,s,n=this.getUserMin(),a=this.getUserMax();this.inAnimation?(t=this.globalMinValue,i=this.globalMaxValue,n=this.localMinValue,a=this.localMaxValue):(t=this.localMinValue,i=this.localMaxValue),"min"!==e&&"both"!==e||(n.toPrecision(this.valuePrecision)===t.toPrecision(this.valuePrecision)?s=0:(s=100*(n-t)/(i-t))<0&&(s=-this.incrementBorderWidth),this.cursorInputMin.value=s.toString()),"max"!==e&&"both"!==e||(a.toPrecision(this.valuePrecision)===i.toPrecision(this.valuePrecision)?s=100:(s=100*(1-(i-a)/(i-t)))>100&&(s=100+this.incrementBorderWidth),this.cursorInputMax.value=s.toString()),this._updateOutOfBoundDisplay()}},_updateOutOfBoundDisplay:function(){if(this.localMinValue===this.localMaxValue)return this.minOutOfRangeLink.hide(),void this.maxOutOfRangeLink.hide();parseFloat(this.cursorInputMin.value)<-2?this.minOutOfRangeLink.show():this.minOutOfRangeLink.hide(),102<parseFloat(this.cursorInputMax.value)?this.maxOutOfRangeLink.show():this.maxOutOfRangeLink.hide()},_updateCursorsColors:function(){var e=parseFloat(this.cursorInputMax.value);parseFloat(this.cursorInputMin.value)>e?(this.cursorInputMax.hasClassName("input-cursor-max")&&(this.cursorInputMax.removeClassName("input-cursor-max"),this.cursorInputMax.addClassName("input-cursor-min")),this.cursorInputMin.hasClassName("input-cursor-min")&&(this.cursorInputMin.removeClassName("input-cursor-min"),this.cursorInputMin.addClassName("input-cursor-max"))):(this.cursorInputMax.hasClassName("input-cursor-min")&&(this.cursorInputMax.removeClassName("input-cursor-min"),this.cursorInputMax.addClassName("input-cursor-max")),this.cursorInputMin.hasClassName("input-cursor-max")&&(this.cursorInputMin.removeClassName("input-cursor-max"),this.cursorInputMin.addClassName("input-cursor-min")))},outOfBoundIncrement:function(e,t){if(this.currentIncrement===e&&this.currentIncrementSign===t){var i=(this.localMaxValue-this.localMinValue)/20;if("min"===e){if(this.getUserMin()+t*i>this.localMinValue)return void this.updateUserMin(this.localMinValue);this.updateUserMin(this.getUserMin()+t*i)}else{if(this.getUserMax()+t*i<this.localMaxValue)return void this.updateUserMax(this.localMaxValue);this.updateUserMax(this.getUserMax()+t*i)}this.updateScale("none"),setTimeout(this.outOfBoundIncrement.bind(this,e,t),300)}},_getDistToMouse:function(e,t){var i=(parseFloat(e.value)-parseFloat(e.min))/(parseFloat(e.max)-parseFloat(e.min)),s=e.offsetWidth*i;return Math.abs(s-t)},inputSwitchCallback:function(e){var t,i,s=e.offsetX;this._getDistToMouse(this.cursorInputMin,s)<this._getDistToMouse(this.cursorInputMax,s)?(t=this.cursorInputMin,i=this.cursorInputMax):(t=this.cursorInputMax,i=this.cursorInputMin),e.target!==t&&(t.value=i.value)},togglePassFail:function(){this.displayPassFail=!this.displayPassFail,this.displayPassFail?(this.paletteMin.style["background-color"]="#b8b8b8",this.paletteColors.style["background-image"]=this.passFailImgUrl,this.paletteMax.style["background-color"]="red"):(this.paletteMin.style["background-color"]="blue",this.paletteColors.style["background-image"]=this.colorPaletteImgUrl,this.paletteMax.style["background-color"]="red")},toggleCallbacks:function(e){var t=navigator.userAgent.indexOf("Trident")>=0,i=navigator.userAgent.indexOf("Edge")>=0,s=t?"change":"input",n=t?"mouseup":"change";e&&!this.isReadOnly?(this.cursorInputMax.disabled=!1,this.cursorInputMin.disabled=!1,this.cursorInputMax.addEventListener(s,this.callbacks.cursorInputMaxInputCallback),this.cursorInputMin.addEventListener(s,this.callbacks.cursorInputMinInputCallback),this.cursorInputMax.addEventListener(n,this.callbacks.cursorInputMaxChangeCallback),this.cursorInputMin.addEventListener(n,this.callbacks.cursorInputMinChangeCallback),(t||i)&&(this.cursorInputMax.addEventListener("mousedown",this.callbacks.cursorInputMaxMousemoveCallback),this.cursorInputMin.addEventListener("mousedown",this.callbacks.cursorInputMinMousemoveCallback),this.cursorInputMax.style["pointer-events"]="auto",this.cursorInputMin.style["pointer-events"]="auto")):(this.cursorInputMax.disabled=!0,this.cursorInputMin.disabled=!0,this.cursorInputMax.removeEventListener(s,this.callbacks.cursorInputMaxInputCallback),this.cursorInputMin.removeEventListener(s,this.callbacks.cursorInputMinInputCallback),this.cursorInputMax.removeEventListener(n,this.callbacks.cursorInputMaxChangeCallback),this.cursorInputMin.removeEventListener(n,this.callbacks.cursorInputMinChangeCallback),(t||i)&&(this.cursorInputMax.removeEventListener("mousedown",this.callbacks.cursorInputMaxMousemoveCallback),this.cursorInputMin.removeEventListener("mousedown",this.callbacks.cursorInputMinMousemoveCallback),this.cursorInputMax.style["pointer-events"]="none",this.cursorInputMin.style["pointer-events"]="none")),e&&this.updateCursorsFromMinMax("both")},drawToCanvas:function(e,t,i){this.drawToCanvasInfo.imagesReady;var s=i+this.divLegend.offsetTop,n=function(e){return isNaN(e)?0:e},a=this.invertedPalette?"red":"blue",l=this.invertedPalette?"blue":"red";s+=this.paletteSection.offsetTop-8;var o=function(e,i,a,l,o){var r=e.fillStyle;e.fillStyle=a,e.fillRect(t+i.offsetLeft+n(l),s+i.offsetTop+n(o),i.clientWidth,i.clientHeight),e.fillStyle=r};o(e,this.paletteMin,a);var r=this.paletteColors.clientWidth,u=parseInt(this.paletteColors.style["background-size"]),h=198*r/u,d=-parseInt(this.paletteColors.style["background-position"])*r/u;e.drawImage(this.drawToCanvasInfo.image,d,2,h,5,t+this.paletteMin.clientWidth,s,r,8),o(e,this.paletteMax,l),s-=7,"none"!==this.minOutOfRangeLink.style.display&&o(e,this.minOutOfRangeLink,a),"none"!==this.maxOutOfRangeLink.style.display&&o(e,this.maxOutOfRangeLink,l),s+=10;var c=function(e,i){var n=e.fillStyle,a=i?this.paletteMin.offsetWidth:this.paletteMax.offsetLeft;i&&"none"!==this.minOutOfRangeLink.style.display?a-=15:i||"none"===this.maxOutOfRangeLink.style.display||(a+=15),e.beginPath(),e.arc(t+a,s,8.5,0,2*Math.PI);var l=e.createRadialGradient(t+a,s,4.5,t+a,s,8.5);i&&!this.invertedPalette||!i&&this.invertedPalette?(l.addColorStop(0,"rgb(0, 0, 255)"),l.addColorStop(1,"rgb(0, 0, 190)")):(l.addColorStop(0,"rgb(255, 0, 0)"),l.addColorStop(1,"rgb(190, 0, 0)")),e.fillStyle=l,e.fill(),e.stroke(),e.fillStyle=n}.bind(this);c(e,!0),c(e,!1)}})}),define("DS/SMAMpwControls/SMAMpwPanel",["DS/CoreEvents/Events","DS/Windows/Panel"],function(e,t){"use strict";return t.inherit({name:"SMAMpwPanel",type:"SMAMpwPanel",_saveDataInPreferences:function(t,i){this._parent(t,i),e.publish({event:"/SMAMpw/Panel/LocalSave",data:{panelId:this.identifier}})},getAvailableContentDimensions:function(){var e=this.elements._contentDiv;return{width:e.clientWidth>0?e.clientWidth:this.width,height:e.clientHeight>0?e.clientHeight:this.height}}})}),define("DS/SMAMpwControls/SMAMpwTooltipedImage",["css!DS/SMAMpwControls/SMAMpwTooltipedImage.css","UWA/Core","DS/Controls/Abstract"],function(e,t,i){"use strict";return i.inherit({name:"SMAMpwTooltipedImage",publishedProperties:{imageUrl:{defaultValue:"",type:String},title:{defaultValue:"",type:String},customStyle:{defaultValue:null,type:Object}},init:function(e){this._parent(e)},buildView:function(){},_postBuildView:function(){this._parent(),this.elements.container&&(this.elements.image=new t.Element("img",{class:"simux-tooltiped-image"}).inject(this.elements.container),this.elements.image.src=this.imageUrl,this.elements.title=new t.Element("p").inject(this.elements.container),this.title&&this.title.length>0&&this.elements.title.setText(this.title))}})}),define("DS/SMAMpwControls/SMAMpwEditableLabel",["css!DS/SMAMpwControls/SMAMpwEditableLabel.css","UWA/Core","DS/Controls/Abstract","DS/SMAMpwControls/SMAMpwSpinBox"],function(e,t,i,s){"use strict";return i.inherit({name:"SMAMpwEditableLabel",publishedProperties:{value:{defaultValue:0,type:Number},resetValue:{defaultValue:null,type:Number},units:{defaultValue:"",type:String},minValue:{defaultValue:null,type:Number},maxValue:{defaultValue:null,type:Number},stepValue:{defaultValue:.1,type:Number},pageStepValue:{defaultValue:10,type:Number},precision:{defaultValue:3,type:Number},onSwitchToEditMode:{defaultValue:null,type:Function},onSwitchToLabelMode:{defaultValue:null,type:Function},onValueChanged:{defaultValue:null,type:Function},onValueReset:{defaultValue:null,type:Function},labelCustomClass:{defaultValue:"",type:String},labelStyle:{defaultValue:null,type:Object},spinBoxCustomClass:{defaultValue:"",type:String},spinBoxStyle:{defaultValue:null,type:Object},resetButtonCustomClass:{defaultValue:"",type:String},resetButtonStyle:{defaultValue:null,type:Object},readOnlyFlag:{defaultValue:!1,type:Boolean},editabilityCheck:{defaultValue:null,type:Function},resetFlag:{defaultValue:!1,type:Boolean}},init:function(e){this.inAnimation=!1,this._parent(e)},buildView:function(){},_postBuildView:function(){this._parent(),this.elements.container&&(this.readOnlyFlag||(this.elements.labelEditableDeco=new t.Element("span",{html:'<span class="wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-pencil"></span>',class:"simux-editablelabel-editabledeco "+this.labelCustomClass,styles:this.labelStyle}).inject(this.elements.container)),this.elements.spinBox=new s({value:this.value,units:this.units,minValue:this.minValue,maxValue:this.maxValue,stepValue:this.stepValue,pageStepValue:this.pageStepValue,precision:this.precision,decimals:20,customClass:this.spinBoxCustomClass,customStyle:this.spinBoxStyle}),this.elements.spinBox.inject(this.elements.container),this.readOnlyFlag||this.resetFlag&&(null===this.resetValue&&(this.resetValue=this.value),this.elements.resetButton=new t.Element("a",{html:'<span class="wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-reload"></span>',class:"simux-editablelabel-resetbutton "+this.resetButtonCustomClass,styles:this.resetButtonStyle,events:{click:this.resetToInitialValue.bind(this)}}),this.elements.resetButton.inject(this.elements.container),this._isResetToDisplay()?(this.elements.resetButton.show(),this.elements.spinBox.show(),this.elements.labelEditableDeco.hide()):(this.elements.resetButton&&this.elements.resetButton.hide(),this.elements.spinBox&&this.elements.spinBox.hide(),this.elements.labelEditableDeco&&this.elements.labelEditableDeco.show())),this.setReadOnlyFlag(this.readOnlyFlag))},handleEvents:function(){this.readOnlyFlag||(this.elements&&this.elements.spinBox&&(this.elements.spinBox.handleEvents(),this.elements.spinBox.addEventListener("change",this._onSpinBoxChange.bind(this)),this.elements.spinBox.elements.inputField.addEventListener("focusout",this._updateLabel.bind(this))),this.elements.labelEditableDeco.addEventListener("click",this.switchToEditMode.bind(this)))},setProperties:function(e){this._parent(e),/*!this.readOnlyFlag && */this.elements&&this.elements.spinBox&&this.elements.spinBox.setProperties(e)},resetToInitialValue:function(){this.setProperties({value:this.resetValue}),this.elements.resetButton&&this.elements.resetButton.hide(),this.elements.spinBox&&this.elements.spinBox.hide(),this.elements.labelEditableDeco&&this.elements.labelEditableDeco.show(),this.onValueReset&&this.onValueReset(this.resetValue)},setDisplayedValue:function(e){isNaN(e)||(this._labelValue=e,this.elements.spinBox&&this.value.toPrecision(this.precision)!==this._labelValue.toPrecision(this.precision)&&this.setProperties({value:this._labelValue}),this.readOnlyFlag||(this._isResetToDisplay()?(this.elements.resetButton.show(),this.elements.spinBox.show(),this.elements.labelEditableDeco.hide()):(this.elements.resetButton&&this.elements.resetButton.hide(),this.elements.spinBox&&this.elements.spinBox.hide(),this.elements.labelEditableDeco&&this.elements.labelEditableDeco.show())))},updateLabelDisplay:function(){this._updateLabel()},setResetValue:function(e){isNaN(e)||(this.resetValue=e)},setInAnimation:function(e){this.inAnimation=e},setReadOnlyFlag:function(e){if(this.setProperties({readOnlyFlag:e}),this.readOnlyFlag){this.elements.spinBox.setProperties({disabled:!0}),this.elements.spinBox.displayStyle="lite";var t=document.querySelector(".simux-2dlegend-max-spin:not([focused]) .wux-controls-lineeditor");t&&t.addClassName("spy-max-readOnly")}else{this.elements.spinBox.setProperties({disabled:!1}),this.elements.spinBox.displayStyle="normal";var i=document.querySelector(".simux-2dlegend-max-spin:not([focused]) .wux-controls-lineeditor.spy-max-readOnly");i&&i.classList.remove("spy-max-readOnly")}var s=!1;this.elements.resetButton&&(e?this.elements.resetButton.hide():this._isResetToDisplay()&&(this.elements.resetButton.show(),s=!0)),this.elements.labelEditableDeco&&(e||s?this.elements.labelEditableDeco.hide():this.elements.labelEditableDeco.show()),e&&this.inAnimation?this.elements.spinBox.show():this.value===this.resetValue&&this.elements.spinBox.hide()},switchToEditMode:function(){if(!this.readOnlyFlag&&(null===this.editabilityCheck||this.editabilityCheck())){this.elements.resetButton&&this.elements.resetButton.hide(),this.elements.spinBox.show(),this.elements.labelEditableDeco.hide();var e=this.elements.spinBox.elements.inputField;e.focus(),e.value=parseFloat(e.value).toPrecision(this.precision),e.setSelectionRange(0,e.value.length),this.onSwitchToEditMode&&this.onSwitchToEditMode()}},getText:function(){var e=this.elements.spinBox.elements.inputField.getText();return e.length||(e=this.resetValue.toPrecision(this.precision)),e},_isValueSameAsReset:function(){return this.value.toPrecision(this.precision)===this.resetValue.toPrecision(this.precision)},_isResetToDisplay:function(){return this.resetFlag&&this.elements.spinBox&&!this._isValueSameAsReset()},_onSpinBoxChange:function(){if(!this.inAnimation){this._updateLabel();var e=this.elements.spinBox.value;this._labelValue=e,this.onValueChanged&&(e.toPrecision(this.precision)===this.resetValue.toPrecision(this.precision)?this.onValueChanged():this.onValueChanged(e))}},_updateLabel:function(){this.readOnlyFlag||(this._isValueSameAsReset()?(this.elements.spinBox&&this.elements.spinBox.hide(),this.elements.resetButton&&this.elements.resetButton.hide(),this.elements.labelEditableDeco&&this.elements.labelEditableDeco.show()):(this.elements.spinBox&&this.elements.spinBox.show(),this.elements.resetButton&&this.elements.resetButton.show(),this.elements.labelEditableDeco&&this.elements.labelEditableDeco.hide()))}})}),define("DS/SMAMpwControls/SMAMpwLegend",["require","css!DS/SMAMpwControls/SMAMpwLegend.css","i18n!DS/SMAMpwControls/assets/nls/SMAMpwLegend","UWA/Core","DS/Controls/Abstract","DS/WebappsUtils/WebappsUtils","DS/CoreEvents/Events","DS/UIKIT/Tooltip","DS/UIKIT/Input/Select","DS/SMAMpwControls/SMAMpwEditableLabel","DS/SMAMpwControls/SMAMpwInputCursors"],function(e){"use strict";var t=e("i18n!DS/SMAMpwControls/assets/nls/SMAMpwLegend"),i=e("UWA/Core"),s=e("DS/Controls/Abstract"),n=e("DS/WebappsUtils/WebappsUtils"),a=e("DS/CoreEvents/Events"),l=e("DS/UIKIT/Tooltip"),o=e("DS/UIKIT/Input/Select"),r=e("DS/SMAMpwControls/SMAMpwEditableLabel"),u=e("DS/SMAMpwControls/SMAMpwInputCursors");return Array.prototype.find||(Array.prototype.find=function(e){if(null===this)throw new TypeError("Array.prototype.find called on null or undefined");if("function"!=typeof e)throw new TypeError("predicate must be a function");for(var t,i=Object(this),s=i.length>>>0,n=arguments[1],a=0;a<s;a++)if(t=i[a],e.call(n,t,a,i))return t}),s.inherit({name:"smaMpwLegend",publishedProperties:{readOnly:{defaultValue:!0,type:Boolean},displayMode:{defaultValue:0,type:Number},smoothColors:{defaultValue:!1,type:Boolean},displayTitle:{defaultValue:!0,type:Boolean},displayBlocks:{defaultValue:!0,type:Boolean},displayFrameSelector:{defaultValue:!0,type:Boolean},enableFrameSelector:{defaultValue:!0,type:Boolean},displayLock:{defaultValue:!0,type:Boolean},displayPassFailToggle:{defaultValue:!1,type:Boolean},valuePrecision:{defaultValue:3,type:Number},legendDataProvider:{defaultValue:null,type:Object},legendControler:{defaultValue:null,type:Object}},destroy:function(){this._parent(),this._navModeCallback&&a.unsubscribe(this._navModeCallback),this._animModeCallback&&a.unsubscribe(this._animModeCallback),this._inputsAnimModeCallback&&a.unsubscribe(this._inputsAnimModeCallback),this._inputsNavModeCallback&&a.unsubscribe(this._inputsNavModeCallback),this._userMinMdlCallback&&a.unsubscribe(this._userMinMdlCallback),this._userMaxMdlCallback&&a.unsubscribe(this._userMaxMdlCallback),this._postDomInsertCallback&&a.unsubscribe(this._postDomInsertCallback),this._updateCallback&&a.unsubscribe(this._updateCallback),this._viewerResizedCallback&&a.unsubscribe(this._viewerResizedCallback)},buildView:function(){this._cursorsHidden=!0},_buildLock:function(e){this._partialAnimLockSpan=new i.Element("div",{class:"simux-2dlegend-lock-container"}).inject(e),this._partialAnimLockSpan.style["vertical-align"]="middle",this._partialAnimLock=new i.Element("div",{class:"wux-afr-cmdstarter",styles:{"vertical-align":"middle"}}).inject(this._partialAnimLockSpan),this._partialAnimLockIcon=new i.Element("div",{class:"simux-2dlegend-partialPlay",styles:{"background-image":"url("+n.getWebappsBaseUrl()+"SMAMpwControls/assets/icons/32/I_SimNavPartialPlay.png)"}}).inject(this._partialAnimLock),this._partialAnimLock.addEvent("click",function(){this._partialAnimLock.toggleClassName("wux-ui-state-active");var e=this._partialAnimLock.hasClassName("wux-ui-state-active");this._partialAnimLockIcon.style["background-image"]="url("+n.getWebappsBaseUrl()+"SMAMpwControls/assets/icons/32/I_SimNavPartialPlay"+(e?"On":"")+".png)",e?this.legendControler.onLock():this.legendControler.onUnLock(),this._frameSelector?this._frameSelector.onChange():this.legendControler.onFrameSelectorChange(this.legendControler.getCurrentFrameId()+1)}.bind(this)),this._updatePlayOnlyVisibility(),this._lockTooltip=new l({target:this._partialAnimLockSpan,body:t.get("playOnlyTooltip")})},_buildBlocks:function(e){var t=this.legendDataProvider.getScopeBlocks();if(t.length>1&&t.length<=200){this.timeBlocksDiv=new i.Element("div",{class:"simux-2dlegend-blockzone"}).inject(e),this.timeBlocks=[];for(var s=0;s<t.length;s++){var n=t[s];if(n){var a=new i.Element("span",{id:n.id,class:"simux-2dlegend-block"}).inject(this.timeBlocksDiv),o=!0,r=!0;s<t.length-1&&(o=!1),n.percentSize<5&&(o=!1,r=!1);var u=n.percentSize-1,h=((r?3:0)+(o?3:0))/(t.length+1);a.style.width=(u-h).toString()+"%",a.style["border-right-style"]=o?"solid":"none",a.style["border-left-style"]=r?"solid":"none",n.toolTip=new l({target:a,body:n.name}),this.timeBlocks.push(a)}}this._updateBlocks()}},_buildFrameSelector:function(e,s){var n=this.legendDataProvider.getFrameSelectorEntries(),l=(s+1).toString();if(n.length<=2e3){this._frameSelector=new o({nativeSelect:!0,placeholder:t.get("frameSelectorPlaceHolder"),options:n}).inject(e);var r=this._frameSelector.getContent();r&&(r.style["vertical-align"]="middle"),this._frameSelector.setValue(l)}else{this._frameLabel=new i.Element("p").inject(e);var u=n.find(function(e){return e.value===l});u&&this._frameLabel.setText(u.label)}this._setSelectorAvailability(!1),this.displayFrameSelector=!1,this.enableFrameSelector&&(this._frameSelector&&(this._frameSelector.onChange=function(){this.legendControler.onFrameSelectorChange(parseInt(this._frameSelector.getValue()[0]))}.bind(this)),this._setSelectorAvailability(!0),this._navModeCallback&&a.unsubscribe(this._navModeCallback),this._navModeCallback=a.subscribe({event:this.legendControler.getNavigationModeEventId()},function(){if(this.legendControler.onNavigationMode(),this._setSelectorAvailability(!0),this._cursorsHidden=!0,this.inputCursors){var e=this.legendControler.getCurrentFrameId(),t=this.legendDataProvider.getLocalComputedMin(e),i=this.legendDataProvider.getLocalComputedMax(e);this.inputCursors.updateLocalMinMax(t,i),this.inputCursors.updateScale("none"),this.inputCursors.updateCursorsFromMinMax("both")}this.lowerMinText&&this.lowerMaxText&&(this.lowerMinText.setReadOnlyFlag(this.readOnly),this.lowerMaxText.setReadOnlyFlag(this.readOnly)),this._updatePlayOnlyVisibility()}.bind(this)),this._animModeCallback&&a.unsubscribe(this._animModeCallback),this._animModeCallback=a.subscribe({event:this.legendControler.getAnimationModeEventId()},function(){this._setSelectorAvailability(!1),this.lowerMinText&&this.lowerMaxText&&(this.lowerMinText.setReadOnlyFlag(!0,!0),this.lowerMaxText.setReadOnlyFlag(!0,!0))}.bind(this)))},_buildPassFailToggle:function(e){this.passfailSwitchDiv=new i.Element("div").inject(e),this.passfailSwitchDiv.style["vertical-align"]="middle",this.passfailSwitchDiv.style.display="inline-block",this.pfButton=new i.Element("div",{html:'<span class="wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-thumbs-up simux-2dlegend-thumbs-up-reversed"></span><span class="wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-thumbs-up simux-2dlegend-thumbs-up"></span>',class:"simux-2dlegend-button a",events:{click:function(){this.pfButton.hasClassName("simux-2dlegend-button-active")||(this.pfButton.toggleClassName("simux-2dlegend-button-active"),this.contourButton.toggleClassName("simux-2dlegend-button-active"),this.inputCursors.togglePassFail(),this.legendControler.onPassFailActivation())}.bind(this)}}).inject(this.passfailSwitchDiv),this.contourButton=new i.Element("div",{html:'<span class="wux-ui-3ds wux-ui-3ds-1x"><b>#</b></span>',class:"simux-2dlegend-button simux-2dlegend-button-active simux-2dlegend-font-size-big a",events:{click:function(){this.contourButton.hasClassName("simux-2dlegend-button-active")||(this.contourButton.toggleClassName("simux-2dlegend-button-active"),this.pfButton.toggleClassName("simux-2dlegend-button-active"),this.inputCursors.togglePassFail(),this.legendControler.onPassFailDeactivation())}.bind(this)}}).inject(this.passfailSwitchDiv)},_buildMinMax:function(e){var s="1"===this.legendDataProvider.getInvertedFlag();this.upperMinMaxSection=new i.Element("div",{class:"simux-2dlegend-upperMinMaxSection"}).inject(this.divLegend);var n=new i.Element("div",{class:"simux-2dlegend-upperMin"}).inject(this.upperMinMaxSection);this.upperMinLink=new i.Element("div",{class:"simux-2dlegend-upperMinMaxLink",invertFlag:s}).inject(n);var l=new i.Element("p").inject(n);new i.Element("span",{class:"simux-2dlegend-upperMinMaxPrefix"}).inject(l).setText(t.get("min")+" "),this.minText=new i.Element("span").inject(l),this.minText.setText(this.legendDataProvider.getGlobalComputedMin().toPrecision(this.valuePrecision));var o=new i.Element("div",{class:"simux-2dlegend-upperMax"}).inject(this.upperMinMaxSection),h=new i.Element("p").inject(o);new i.Element("span",{class:"simux-2dlegend-upperMinMaxPrefix"}).inject(h).setText(t.get("max")+" "),this.maxText=new i.Element("span").inject(h),this.maxText.setText(this.legendDataProvider.getGlobalComputedMax().toPrecision(this.valuePrecision)),this.upperMaxLink=new i.Element("div",{class:"simux-2dlegend-upperMinMaxLink",invertFlag:s}).inject(o);var d=this.legendDataProvider.getGlobalComputedMax()-this.legendDataProvider.getGlobalComputedMin();this._zeroGlobalRange=0===d;var c=this.legendDataProvider.getLocalComputedMin(e),p=this.legendDataProvider.getLocalComputedMax(e),m=this.readOnly||this._zeroGlobalRange;this.inputCursors=new u({divLegend:this.divLegend,valuePrecision:this.valuePrecision,passFailImgUrl:this.legendDataProvider.getPassFailColorsImageUrl?"url("+this.legendDataProvider.getPassFailColorsImageUrl()+")":"",localMinValue:c,localMaxValue:p,isReadOnly:m,hideCursors:this._zeroGlobalRange,invertedPalette:s,globalMinValue:this.legendDataProvider.getGlobalComputedMin(),globalMaxValue:this.legendDataProvider.getGlobalComputedMax(),loadColorsImage:this.legendDataProvider.loadColorsImage,userMinGetter:this.legendDataProvider.getUserMin,userMaxGetter:this.legendDataProvider.getUserMax,postDOMInsertEventId:this.legendControler.getPostDOMInsertEventId(),updateUserMin:this.legendControler.onMinChanged,updateUserMax:this.legendControler.onMaxChanged}),this.legendControler.getAnimationModeEventId&&(this._inputsAnimModeCallback&&a.unsubscribe(this._inputsAnimModeCallback),this._inputsAnimModeCallback=a.subscribe({event:this.legendControler.getAnimationModeEventId()},function(){var e=this.legendControler.getCurrentFrameId(),t=this.legendDataProvider.getLocalComputedMin(e),i=this.legendDataProvider.getLocalComputedMax(e);this.inputCursors.updateLocalMinMax(t,i),this.inputCursors.setAnimationMode(!0),this.inputCursors.toggleCallbacks(!1)}.bind(this))),this.legendControler.getNavigationModeEventId&&(this._inputsNavModeCallback&&a.unsubscribe(this._inputsNavModeCallback),this._inputsNavModeCallback=a.subscribe({event:this.legendControler.getNavigationModeEventId()},function(){this.lowerMinText.setInAnimation(!1),this.lowerMaxText.setInAnimation(!1),this._updateUpperMinMax(!1),this.inputCursors.setAnimationMode(!1),this.inputCursors.toggleCallbacks(!0);var e=this.legendControler.getCurrentFrameId(),t=this.legendDataProvider.getLocalComputedMin(e),i=this.legendDataProvider.getLocalComputedMax(e);this.inputCursors.updateLocalMinMax(t,i),this.lowerMinText.setDisplayedValue(this.legendDataProvider.getUserMin()),this.lowerMaxText.setDisplayedValue(this.legendDataProvider.getUserMax())}.bind(this)));var g=new i.Element("div",{class:"simux-2dlegend-local"}).inject(this.divLegend);this.lowerMinText=new r({value:isNaN(this.legendDataProvider.getUserMin())||this._zeroGlobalRange?c:this.legendDataProvider.getUserMin(),resetValue:c,readOnlyFlag:m,resetFlag:!0,editabilityCheck:this.legendControler.checkEditability,maxValue:isNaN(this.legendDataProvider.getUserMax())?p:this.legendDataProvider.getUserMax(),stepValue:(p-c)/10,pageStepValue:(p-c)/4,precision:this.valuePrecision,onSwitchToEditMode:function(){this._minEditing=!0}.bind(this),onSwitchToLabelMode:function(){this._minEditing=!1,this._updateUpperMinMax()}.bind(this),onValueChanged:function(e){this.legendControler.onMinChanged(e)}.bind(this),onValueReset:function(e){this.inputCursors.resetInputCursor("min"),this.legendControler.onMinReset(e)}.bind(this),labelCustomClass:"simux-2dlegend-min-label",spinBoxCustomClass:"simux-2dlegend-min-spin",spinBoxStyle:{height:"30px","min-width":"0px"},resetButtonCustomClass:"simux-2dlegend-min-reset"}),this.lowerMinText.inject(g),this.lowerMinText.elements.container.addClassName("simux-2dlegend-min"),m||(this._userMinMdlCallback&&a.unsubscribe(this._userMinMdlCallback),this._userMinMdlCallback=a.subscribe({event:this.legendControler.getUserMinMdlEventId()},function(e){var t;if(e&&!isNaN(e.value))t=e.value;else{var i=this.legendControler.getCurrentFrameId();t=this.legendDataProvider.getLocalComputedMin(i)}this.lowerMinText&&this.lowerMinText.setDisplayedValue(t),this.lowerMaxText&&this.lowerMaxText.setProperties({minValue:t}),this._updateUpperMinMax(),this.inputCursors.updateScale("min")}.bind(this))),this.lowerMaxText=new r({value:isNaN(this.legendDataProvider.getUserMax())||this._zeroGlobalRange?p:this.legendDataProvider.getUserMax(),resetValue:p,readOnlyFlag:m,resetFlag:!0,editabilityCheck:this.legendControler.checkEditability,minValue:isNaN(this.legendDataProvider.getUserMin())?c:this.legendDataProvider.getUserMin(),stepValue:(p-c)/10,pageStepValue:(p-c)/4,precision:this.valuePrecision,onSwitchToEditMode:function(){this._maxEditing=!0}.bind(this),onSwitchToLabelMode:function(){this._maxEditing=!1,this._updateUpperMinMax()}.bind(this),onValueChanged:function(e){this.legendControler.onMaxChanged(e)}.bind(this),onValueReset:function(e){this.inputCursors.resetInputCursor("max"),this.legendControler.onMaxReset(e)}.bind(this),labelCustomClass:"simux-2dlegend-max-label",spinBoxCustomClass:"simux-2dlegend-max-spin",spinBoxStyle:{height:"30px","min-width":"0px"},resetButtonCustomClass:"simux-2dlegend-max-reset"}),this.lowerMaxText.inject(g),this.lowerMaxText.elements.container.addClassName("simux-2dlegend-max"),m||(this._userMaxMdlCallback&&a.unsubscribe(this._userMaxMdlCallback),this._userMaxMdlCallback=a.subscribe({event:this.legendControler.getUserMaxMdlEventId()},function(e){var t;if(e&&!isNaN(e.value))t=e.value;else{var i=this.legendControler.getCurrentFrameId();t=this.legendDataProvider.getLocalComputedMax(i)}this.lowerMaxText&&this.lowerMaxText.setDisplayedValue(t),this.lowerMinText&&this.lowerMinText.setProperties({maxValue:t}),this._updateUpperMinMax(),this.inputCursors.updateScale("max")}.bind(this))),this._postDomInsertCallback=a.subscribe({event:this.legendControler.getPostDOMInsertEventId()},function(){a.unsubscribe(this._postDomInsertCallback),this._updateUpperMinMax(),this.updateSizeResponsive()}.bind(this))},_postBuildView:function(){if(this._parent(),this.elements.container&&this.legendDataProvider&&this.legendControler){var e=this.legendDataProvider.getDefaultFrameId(),s=new i.Element("div",{id:"legendMainContainer",class:"simux-2dlegend-main"}).inject(this.elements.container);if(this.elements.divMain=s,this.displayTitle){var n=new i.Element("div",{id:"legendTitle",class:"simux-2dlegend-title"}).inject(s);this.elements.title=n,this.titleText=new i.Element("p").inject(n),this._updateTitle()}var l,o=new i.Element("div",{class:"simux-2dlegend-scopeNav"}).inject(s);this.elements.scopeNavDiv=o,this.divLegend=new i.Element("div",{class:"simux-2dlegend"+(this.displayMode>0?" simux-2dlegend-vertical":"")}).inject(s),this.elements.divLegend=this.divLegend,this.displayLock&&this._buildLock(o),(this.displayBlocks||this.displayFrameSelector)&&(l=new i.Element("div",{class:"simux-2dlegend-scopeNav-content",styles:{display:"inline-block"}}).inject(o)),this.displayBlocks&&this._buildBlocks(l),this.displayFrameSelector&&this._buildFrameSelector(l,e),this.displayPassFailToggle&&this._buildPassFailToggle(o);var r=this.legendDataProvider.hasMinMax(),u=this.legendDataProvider.hasDeformationScales();if(r||u){if(r&&this._buildMinMax(e),u){var h=this.legendDataProvider.getDeformationScaleFactor(e);this.scaleDiv=new i.Element("div",{id:"legendScale",class:"simux-2dlegend-scalefactor"}).inject(this.divLegend),h<=0&&this.scaleDiv.hide(),this.scaleText=new i.Element("p",{class:"simux-2dlegend-scaletext"}).inject(this.scaleDiv),this.scaleText.setText(t.get("scaleFactor")+": "+h.toPrecision(this.valuePrecision))}this.legendControler.onNavigationMode&&this.legendControler.onNavigationMode()}this.legendControler.getDataUpdateEventId&&(this._updateCallback=a.subscribe({event:this.legendControler.getDataUpdateEventId()},function(){this._updateTitle(),this._updateLowerSection(),this._updateUpperMinMax(),this.updateSizeResponsive()}.bind(this))),this.legendControler.onPostBuildCallback&&this.legendControler.onPostBuildCallback()}0===this.displayMode&&this.legendControler.getResponsiveEventId&&(this._viewerResizedCallback=a.subscribe({event:this.legendControler.getResponsiveEventId()},this.updateSizeResponsive.bind(this)))},_updateTitle:function(){this.displayTitle&&this.legendDataProvider&&this.legendDataProvider.getTitle()&&this.titleText.setText(this.legendDataProvider.getTitle())},_updateLowerSection:function(e){var i=!!this.legendControler.isInAnimationMode&&this.legendControler.isInAnimationMode();if(this.lowerMinText&&this.lowerMaxText){isNaN(e)||(e=this.legendControler.getCurrentFrameId());var s=this.legendDataProvider.getLocalComputedMin(e),n=this.legendDataProvider.getLocalComputedMax(e),a={stepValue:(n-s)/10,pageStepValue:(n-s)/4};this.lowerMinText.setInAnimation(i),this.lowerMaxText.setInAnimation(i),this.lowerMinText.setResetValue(s),this.lowerMaxText.setResetValue(n),this.lowerMinText.setProperties({maxValue:n}),this.lowerMaxText.setProperties({minValue:s}),this.lowerMinText.setProperties(a),this.lowerMaxText.setProperties(a),(isNaN(this.legendDataProvider.getUserMin())||this._zeroGlobalRange||i)&&this.lowerMinText.setDisplayedValue(s),(isNaN(this.legendDataProvider.getUserMax())||this._zeroGlobalRange||i)&&this.lowerMaxText.setDisplayedValue(n),this.lowerMinText.updateLabelDisplay(),this.lowerMaxText.updateLabelDisplay()}if(this.scaleDiv&&this.scaleText){var l=this.legendDataProvider.getDeformationScaleFactor(e);l>=0?this.scaleDiv.show():this.scaleDiv.hide(),this.scaleText.setText(t.get("scaleFactor")+": "+l.toPrecision(this.valuePrecision))}},_updateUpperMinMax:function(e){if(this.minText&&this.maxText)if(void 0===e&&(e=!!this.legendControler.isInAnimationMode&&this.legendControler.isInAnimationMode()),e)e&&!this.legendDataProvider.hasScanAnimation()&&(this.minText.setText(this.legendDataProvider.getGlobalComputedMin().toPrecision(this.valuePrecision)),this.maxText.setText(this.legendDataProvider.getGlobalComputedMax().toPrecision(this.valuePrecision)));else{var t=this.legendControler.getCurrentFrameId();isNaN(t)||(this.maxText.setText(this.legendDataProvider.getLocalComputedMax(t).toPrecision(this.valuePrecision)),this.minText.setText(this.legendDataProvider.getLocalComputedMin(t).toPrecision(this.valuePrecision)))}},_setSelectorAvailability:function(e){this._frameSelector&&(e?this._frameSelector.enable():this._frameSelector.disable()),this._partialAnimLock&&(e?this._partialAnimLock.removeClassName("wux-ui-state-disabled"):this._partialAnimLock.addClassName("wux-ui-state-disabled"))},_updatePlayOnlyVisibility:function(){if(this._partialAnimLockSpan&&this.legendControler){var e=this.legendControler.getLockAvailability();e&&this.elements.divMain.addClassName("responsive-has-lock"),this._partialAnimLockSpan.style.display=e?"inline-flex":"none",this._partialAnimLock&&(this.legendControler.getLockStatus()?(this._partialAnimLock.addClassName("wux-ui-state-active"),this._partialAnimLockIcon.style["background-image"]="url("+n.getWebappsBaseUrl()+"SMAMpwControls/assets/icons/32/I_SimNavPartialPlayOn.png)"):(this._partialAnimLock.removeClassName("wux-ui-state-active"),this._partialAnimLockIcon.style["background-image"]="url("+n.getWebappsBaseUrl()+"SMAMpwControls/assets/icons/32/I_SimNavPartialPlay.png)"))}},_updateBlocks:function(){if(this.timeBlocks&&this.timeBlocks.length>=1)for(var e=this.legendControler.getCurrentScopeBlockId(),t=this.legendControler.getLockStatus()?"#e2e4e3":"#78befa",i=0;i<this.timeBlocks.length;i++){var s=this.timeBlocks[i];s&&(s.style["background-color"]=t,s.id===e&&(s.style["background-color"]="#368ec4"))}},updateSizeResponsive:function(){var e=this.elements.divMain;if(0!==e.offsetWidth)if(1!==this.displayMode){var t,i=this.elements.container.offsetParent.offsetParent,s=["responsive-medium","responsive-small","responsive-icon","responsive-normal"],n=s.length;for(t=0;t<n;t++)e.removeClassName(s[t]);var a={};a.width=Math.min(i.offsetWidth,i.offsetHeight),a.left=Math.max(0,.5*(i.offsetWidth-i.offsetHeight)),a.right=a.left+a.width,a.top=Math.max(0,.5*(i.offsetHeight-i.offsetWidth));var l=function(){var t=e.offsetParent.offsetTop+e.offsetParent.offsetHeight,i=e.offsetParent.offsetLeft;return Math.min(e.offsetWidth,a.width,Math.max(0,a.right-i))*Math.min(e.offsetHeight,a.width,Math.max(0,t-a.top))>.2*a.width*a.width||e.offsetParent.offsetLeft<=0};i.offsetHeight<290&&e.addClassName("responsive-normal"),l()&&(e.addClassName("responsive-medium"),l()&&(e.addClassName("responsive-small"),l()&&e.addClassName("responsive-icon"))),this.inputCursors&&this.inputCursors.updateScale("none")}else this.inputCursors&&this.inputCursors.updateScale("none")},animate:function(e){this._updateLowerSection(e),this._cursorsHidden=!this.legendControler.areCursorsVisible(e);var t,i,s=!this.legendControler.isInAnimationMode&&this.legendControler.isInAnimationMode();(this._updateUpperMinMax(),this.inputCursors)&&(t=this.legendDataProvider.getLocalComputedMin(e),i=this.legendDataProvider.getLocalComputedMax(e),this.inputCursors.updateLocalMinMax(t,i),this.inputCursors.updateCursorsFromMinMax("both"),this.inputCursors.updateScale("none"));this._updatePlayOnlyVisibility(),this._updateBlocks();var n=this._frameSelector,a=this._frameLabel,l=this.legendDataProvider.getFrameSelectorEntries(),o=n||a,r=function(e){return l.find(function(t){return t.value===e})},u=n?n.getOption.bind(n):r,h=n?n.select.bind(n):function(e){if(a){var t=r(e);t&&a.setText(t.label)}};if(o){var d=(e+1).toString();if(u(d))h(d),this.legendDataProvider.updateDefaultFrameId&&this.legendDataProvider.updateDefaultFrameId(d-1);else if(!s){for(var c=e+1,p=!1,m=this.legendControler.getCurrentScopeStartFrameId(),g=this.legendControler.getCurrentScopeEndFrameId();!p&&c>m&&c<=g+1;)(p=null!==u(d=c.toString()))||c++;p&&(h(d),this.legendDataProvider.updateDefaultFrameId&&this.legendDataProvider.updateDefaultFrameId(d-1))}}},drawToCanvas:function(e,t,i){if(e){i-=70;var s=this.elements.divMain.hasClassName("responsive-icon");this.elements.divMain.removeClassName("responsive-icon");e.font=12..toString()+"px Arial";var n=function(e){return isNaN(e)?0:e},a=function(e,s,a,l){e&&s&&e.fillText(s.getText(),t+n(s.offsetLeft)+n(a),i+n(s.offsetTop)+n(l))},l=function(e,t,i,s){e&&t&&a(e,t,i,s)},o=function(e,s,a,l,o,r){if(e&&s){var u=t+n(s.offsetLeft)+n(o),h=i+n(s.offsetTop)+n(r);e.strokeSyle=a||"black",e.beginPath(),e.moveTo(u,h),l.indexOf("l")>=0?e.lineTo(u,h+s.offsetHeight):e.moveTo(u,h+s.offsetHeight),l.indexOf("b")>=0?e.lineTo(u+s.offsetWidth,h+s.offsetHeight):e.moveTo(u+s.offsetWidth,h+s.offsetHeight),l.indexOf("r")>=0?e.lineTo(u+s.offsetWidth,h):e.moveTo(u+s.offsetWidth,h),l.indexOf("t")>=0?e.lineTo(u,h):e.moveTo(u,h),e.stroke()}};if(a(e,this.titleText,30,45),this._frameSelector){var r=this._frameSelector.getOption(this._frameSelector.getValue()[0]);r&&e.fillText(r.getText(),t+30,i+60+12)}var u=100;if(this.upperMinMaxSection&&this.minText&&this.maxText&&(u=this.upperMinMaxSection.offsetParent.offsetTop+20,a(e,this.minText,this.minText.offsetParent.offsetLeft,u),a(e,this.maxText,this.maxText.offsetParent.offsetLeft,u),o(e,this.upperMinLink,"#666666","lt",this.upperMinLink.offsetParent.offsetLeft,u),o(e,this.upperMaxLink,"#666666","tr",this.upperMaxLink.offsetParent.offsetLeft,u),this.inputCursors.drawToCanvas(e,t,i+20),this.lowerMinText&&this.lowerMaxText)){var h=u+this.lowerMaxText.elements.container.offsetParent.offsetTop+10;l(e,this.lowerMinText,this.lowerMinText.elements.container.offsetLeft,h),l(e,this.lowerMaxText,this.lowerMaxText.elements.container.offsetLeft-30,h)}if(!this.scaleDiv.isHidden()){var d=u+this.scaleDiv.offsetTop;a(e,this.scaleText,0,d),s&&this.elements.divMain.addClassName("responsive-icon")}}}})});