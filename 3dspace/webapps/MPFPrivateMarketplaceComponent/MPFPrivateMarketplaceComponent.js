define("DS/MPFPrivateMarketplaceComponent/EnterpriseMarketplaceCreationComponent",["UWA/Core","UWA/Class/View","DS/UIKIT/Input/Button","DS/UIKIT/Mask","DS/MPFServices/ObjectService","DS/MPFCompanyModel/CompanyModel","DS/MPFView/FieldTextInputV2","DS/MPFView/InformationTooltip","i18n!DS/MPFPrivateMarketplaceComponent/assets/nls/PrivateMarketplaceComponent","css!DS/MPFPrivateMarketplaceComponent/MPFPrivateMarketplaceComponent","css!DS/MPFUI/MPFUI"],function(e,t,i,n,s,o,r,a,c){"use strict";return t.extend({className:"mpf-enterprise-marketplace-creation-widget",setup:function(e){var t,i;e||(e={}),this._parent(e),s.requiredOfPrototype(this.model,o,"this.model must be a CompanyModel"),this.urlPrefix=e.urlPrefix||window.location.origin+"/my-company?esid=",i="string"==typeof(t=this.model.getName())&&t.length>0,this.companyNameInput=this._createCompanyNameInput(i),this.model.getName()&&this.model.setName(this.model.getName()),this.empNameInput=this._createEMPNameInput(),this.createButton=this._createCreateButton(),this.banner=this._createBanner(),this.body=this._createBody()},render:function(){return this.container.setContent([this.banner,this.body]),this},validate:function(){var e,t,i=this.model.getEmpUrl();return e=this.companyNameInput.validate().isValid,t=this.empNameInput.validate().isValid,e&&t&&i&&i.length>0},save:function(){var e,t=this;if(this.generatePrivateMpUrl(),this.validate()&&this.model.hasPendingChanges())return n.mask(this.container),this.model.set(o.Fields.EMP_PROJECT_NAME,this.model.getEmpUrl().split("?esid=").pop()),e=this.model.isNew()?null:this.model.getPendingChanges(),this.model.savePromise(e,{patch:!this.model.isNew()}).then(function(){window.location.href="/my-company?esid="+t.model.getEmpProjectName()}).catch(function(){n.unmask(t.container)})},generatePrivateMpUrl:function(){var e,t;(e=this.model.getName())&&e.length>0&&(t=this.urlPrefix+this._createPathFromName(e),this.model.set(o.Fields.EMP_URL,t,{silent:!0}))},_createPathFromName:function(e){return e||(e=""),e.replace(/[^\w.-]/,"").toLowerCase().replace(/\s+/g,"-")},_createCreateButton:function(){return new i({className:"primary",value:c.get("createEnterpriseService"),events:{onClick:this.save.bind(this)}})},_createEMPNameInput:function(){return new r({required:!0,model:this.model,fieldName:o.Fields.EMP_NAME,fieldLabel:c.get("enterpriseServiceNameLabel"),dynamicValidation:!0,tooltip:c.get("enterpriseServiceNameDesc")})},_createCompanyNameInput:function(e){return new r({required:!0,readOnly:e,model:this.model,fieldName:o.Fields.NAME,fieldLabel:c.get("companyName"),dynamicValidation:!0})},_createBanner:function(){var t,i,n,s;return i=e.createElement("h3",{class:"mpf-title",text:c.get("enterpriseMarketplaceCreationTitle")}),n=e.createElement("h4",{class:"mpf-sub-title",text:c.get("enterpriseMarketplaceCreationSubTitle")}),s=e.createElement("form",{class:"mpf-horizontal",html:[this.companyNameInput.render(),this.empNameInput.render(),this.createButton]}),t=e.createElement("div",{class:"mpf-header",html:[i,n,s]}),e.createElement("div",{class:"mpf-banner",html:t})},_createBody:function(){return e.createElement("div",{class:"row mpf-body",html:[this._createImageBox("mpf-enterprise-marketplace-img-1",c.get("defineEcosystem")),this._createImageBox("mpf-enterprise-marketplace-img-3",c.get("shareIt"))]})},_createImageBox:function(t,i){return e.createElement("div",{class:"mpf-img-box",html:e.createElement("div",{class:"mpf-img-placeholder "+t,text:i})})}})}),define("DS/MPFPrivateMarketplaceComponent/EnterpriseMarketplaceSelectModal",["UWA/Core","UWA/Class","DS/PlatformAPI/PlatformAPI","DS/UIKIT/Input/Select","DS/UIKIT/SuperModal","DS/MPFUrl/UrlUtils","i18n!DS/MPFPrivateMarketplaceComponent/assets/nls/PrivateMarketplaceComponent","css!DS/MPFUI/MPFUI"],function(e,t,i,n,s,o,r){"use strict";return t.extend({init:function(e){var t=this;e=e||{},this.modal=null,this.container=e.container,this.onSelectionCB=e.onSelection,this.empCollection=e.collection,this.selectedEnterpriseMarketplaceID=this._getCurrentEnterpriseMarketplaceID(),this.modal=new s({className:"enterprise-choice-modal",renderTo:this.container}),this._createWebElements(),i.subscribe("EMNameChange",function(e){t.empCollection.get(t.selectedEnterpriseMarketplaceID).setName(e.name)})},showModal:function(){var t;!(-1!==window.location.pathname.indexOf("enterprise-marketplace-creation"))&&this.modal&&(this.modal.dialog({className:"mpf-textAlignCenter",title:r.get("enterpriseAccess"),buttons:this.modalButtons,body:e.createElement("div",{class:"mpf-emModal mpf-textAlignCenter",html:[{tag:"div",class:"mpf-textAlignCenter",text:r.get("continueUsingEnterprise")},this.enterpriseMarketplaceSelect.elements.container]})}),(t=this.container.getElementsByClassName("mpf-emModal")[0].getParent().getParent())&&t.addClassName("mpf-emModalContent"))},_createWebElements:function(){var e=this,t=[];this.modalButtons=[{className:"primary",value:r.get("accessEnterpriseEco"),action:function(t){e.onSelectionCB(e.empCollection.get(e.selectedEnterpriseMarketplaceID)),t.hide()}},{className:"default",value:r.get("accessPublicEco"),action:function(t){e.onSelectionCB("public"),t.hide()}}],this.empCollection.forEach(function(i){t.push({label:i.getName(),value:i.getID(),selected:i.getID()===e.selectedEnterpriseMarketplaceID})}),this.enterpriseMarketplaceSelect=new n({className:"mpf-emModalSelect",options:t,placeholder:!1,events:{onChange:function(t){e.selectedEnterpriseMarketplaceID=t.target.value}}})},_getCurrentEnterpriseMarketplaceID:function(){var t,i,n=this.empCollection.first().getID();return""!==(t=new o(window.location.href).getValueParameter("esid",""))&&(i=this.empCollection.find(function(e){return e.getProjectName()===t}),e.is(i)&&(n=i.getID())),n}})}),define("DS/MPFPrivateMarketplaceComponent/EnterpriseInternalLabServiceInformationComponent",["UWA/Promise","UWA/Class/View","DS/PlatformAPI/PlatformAPI","DS/UIKIT/Alert","DS/MPFShopModel/ShopModel","DS/MPFView/FieldTextInputV2","DS/MPFCurrencySelectComponent/CurrencySelectComponent","DS/MPFAddressFormComponent/AddressFormComponentV2","DS/MPFAddressModel/AddressSaveError","i18n!DS/MPFPrivateMarketplaceComponent/assets/nls/PrivateMarketplaceComponent","css!DS/MPFUI/MPFUI"],function(e,t,i,n,s,o,r,a,c,l){"use strict";return t.extend({className:"mpf-espInternalLabBody mpf-horizontal",setup:function(e){this._parent(e),this.company=e.company,this.addressModel=e.addressModel,this.countries=e.countries,this.shopServiceFactory=e.shopServiceFactory,this.topic=e.topic,this.labNameInput=this._creatNameInput(),this.currencySelectComponent=this._createCurrencyInput(),this.addressFormComponent=this._createAddressForm(),this.alert=this._createAlert(),this.topicSubscription=i.subscribe(this.topic,this._onTopicMessage.bind(this)),this.listenTo(this.labNameInput,"update",this.onLabNameChange.bind(this))},_onTopicMessage:function(e){e.target!==this.id&&"service-information"!==e.target||("labChanged"===e.event?(this.onSaveCB&&this.onSaveCB(),i.publish(this.topic,{event:"saveComplete",id:"service-information",next:this.next})):"save"===e.event&&(this.validate()?this.save({next:e.next}):this._publishValidationFailure()))},onLabNameChange:function(e){i.publish(this.topic,{event:"titleSet",title:e.escape("shopName")})},render:function(){return i.publish(this.topic,{complete:!this.model.isNew(),event:"updateMenu",id:this.id,newModel:this.newModel}),this.container.empty(),this.alert.inject(this.container),this.container.addContent([this.labNameInput.render(),this.currencySelectComponent.render(),this.addressFormComponent.render()]),this},validate:function(){const e=this.addressFormComponent.validate();let t=!0,i=!0;return this.labNameInput.validate(),t=this.currencySelectComponent.validate().isValid,""===this.model.get("shopName")&&(i=!1),e&&t&&i},save:function(e){const t=this.model.isNew(),n=this.model.getPendingChanges().shopName;this.next=e.next,this.onSaveCB=e&&e.onComplete?e.onComplete:null,this.model.set("IsInternal","TRUE"),this.model.set(s.Fields.IS_AUTOMATIC_PRICING,"FALSE"),delete this.model._attributes.isCompany,this.alert.hide(),this.model.savePromise().then(this._createShopService.bind(this,t)).then(this._saveAddress.bind(this)).then(()=>{"service-information-creation"===this.id&&i.publish(this.topic,{event:"idChange",newID:"service-information",oldID:"service-information-creation"}),n?this._publishNewLabCreated():this._publishSaveComplete(e.next)}).catch(this._onSaveError.bind(this))},destroy:function(){this.stopListening(),i.unsubscribe(this.topicSubscription),this.currencySelectComponent.destroy(),this.labNameInput.destroy(),this.addressFormComponent.destroy(),this.addressModel=null,this.countries=null,this.model=null,this._parent(),this.container=null,this.topic=null},_saveAddress:function(){return this.addressModel.setParentResourceId(this.model.get("id")),this.addressFormComponent.savePromise().catch(t=>(Object.prototype.isPrototypeOf.call(Error.prototype,t)||(t=new c(l.get("errorOnSaveAddress"))),e.reject(t)))},_onSaveError:function(e){let t;t=Object.prototype.isPrototypeOf.call(Error.prototype,e)?e.message:l.get("errorOnSave"),this.alert.show(),this.alert.add({className:"error",message:t}),this._publishValidationFailure()},_publishValidationFailure:function(){i.publish(this.topic,{event:"validationFailure",id:"service-information"})},_publishNewLabCreated:function(){i.publish("newLabCreated",{id:this.model.id,topic:this.topic})},_publishSaveComplete:function(e){i.publish(this.topic,{event:"saveComplete",id:this.id,next:e})},_creatNameInput:function(){return new o({model:this.model,fieldName:"shopName",fieldLabel:l.get("serviceName"),required:!0,readOnly:"SUBMITTED"===this.model.get("currentState"),dynamicValidation:!0})},_createCurrencyInput:function(){return new r({className:"mpf-select-v2 mpf-currencySelect",model:this.model})},_createAddressForm:function(){return new a({addressConstraints:this.addressModel.constraints,addressModel:this.addressModel,countries:this.countries})},_createAlert:function(){return new n({autoHide:!0,hideDelay:3e3})},_createShopService:function(e){if(e){const e=this.shopServiceFactory.createModel("shop");return e.setParentResourceId(this.model.id),e.savePromise()}return Promise.resolve()}})}),define("DS/MPFPrivateMarketplaceComponent/ServiceProvidersCommunityComponent",["UWA/Core","UWA/Class/View","DS/MPFServices/ObjectService","DS/MPFCompanyModel/CompanyModel","DS/MPFShopModel/ShopCollection","DS/UIKIT/Input/Button","DS/UIKIT/Alert","DS/UIKIT/Mask","DS/MPFLabMap/LabMap","DS/PlatformAPI/PlatformAPI","DS/MPFShopCardComponent/SmallShopCardComponent","i18n!DS/MPFPrivateMarketplaceComponent/assets/nls/PrivateMarketplaceComponent","css!DS/MPFPrivateMarketplaceComponent/MPFPrivateMarketplaceComponent"],function(e,t,i,n,s,o,r,a,c,l,p,h){"use strict";return t.extend({className:"mpf-esp-container",domEvents:{"click .fonticon-map":"_toggleMapVisibility"},setup:function(e){console.warn('This component is deprecated. Please use "DS/MPFEmpMyEcosystemComponent/CommunityServiceProvidersComponent" instead.'),e=e||{},this._parent(e),this._checkPrototypes(e),this.shopsPublic=e.shopsPublic,this.shopsPrivate=e.shopsPrivate,this.labMap=new c({className:"mpf-esp-map",defaultZoom:2,model:this.shopsPrivate,onCenterChangedCB:this._onCenterChangedCB.bind(this)}),this.selectedLabsIDs=this._getInternLabID(),this.displayedLabList=null,this.isMapActive=!0,l.subscribe("SearchBar/search",this._onTopBarSearch.bind(this)),l.subscribe("SearchBar/clear",this._onTopBarClear.bind(this))},render:function(){var t,i,n,s=[];return this.shopsPrivate.forEach(function(e){s.push(e.get("id"))}),this.displayedLabList=this._displayLabList(this.shopsPublic.toArray(),s),i=e.createElement("div",{class:"mpf-esp-container"}),this.container.setContent(i),a.mask(i),n=e.createElement("div",{class:"mpf-esp-labs-container",html:[this.displayedLabList,this.labMap.render()]}),t=e.createElement("div",{class:"mpf-esp-content",html:[this._initHeader(),n]}),this.container.setContent(t),this},_displayLabList:function(t,i){var n;return n=this._createMapToggle(),e.createElement("div",{class:"mpf-esp-labs",html:[e.createElement("div",{class:"mpf-esp-labs-header",html:[e.createElement("div",{class:"nbResult",html:t.length.toString()+"&nbsp;"+h.get("results")}),n]}),e.createElement("div",{class:"scroller-container",html:this._displayLabs(t,i)})]})},_createMapToggle:function(){var t;return t=e.createElement("div",{class:"fonticon fonticon-map"}),this.isMapActive&&t.addClassName("map-active"),t},_toggleMapVisibility:function(){this.isMapActive?this._hideMap():this._showMap()},_showMap:function(){var e,t,i;e=this.container.getElement(".mpf-esp-labs"),t=this.container.getElement(".mpf-esp-map"),i=this.container.getElement(".fonticon-map"),e&&e.removeClassName("full-width"),t&&t.removeClassName("hidden"),i&&i.addClassName("map-active"),this.isMapActive=!0},_hideMap:function(){var e,t,i;e=this.container.getElement(".mpf-esp-labs"),t=this.container.getElement(".mpf-esp-map"),i=this.container.getElement(".fonticon-map"),e&&e.addClassName("full-width"),t&&t.addClassName("hidden"),i&&i.removeClassName("map-active"),this.isMapActive=!1},_displayLabs:function(e,t){var i=this,n=[];return e.forEach(function(e){var s,o,r={};o=-1!==t.indexOf(e.get("id")),r.shop=e,r.displayEMPIcon=!1,r.isSelected=o,r.button={label:o?h.get("unselect"):h.get("select")},s=new p(r),n.push(s.render()),i.listenTo(s.container,"click",i._onSelect.bind(i,s)),i.listenTo(s,"moreInformationClicked",i._displayMap.bind(i)),o&&-1===i.selectedLabsIDs.indexOf(e.id)&&i.selectedLabsIDs.push(e.id)}),this.labMap.setShopList(e),n},_onSelect:function(e){var t;e.setSelected(!e.isSelected),e.button.setValue(e.isSelected?h.get("unselect"):h.get("select")),t=e.shop.get("id"),e.isSelected?this.selectedLabsIDs.push(t):this.selectedLabsIDs.splice(this.selectedLabsIDs.indexOf(t),1)},_displayMap:function(){e.extendElement(this.container.querySelector(".fonticon-map")).hasClassName("map-active")||this._toggleMapVisibility()},_initHeader:function(){var t,i=this;return this.save=new o({className:"primary",value:h.get("save"),events:{onClick:this._saveSelectedLabsIDs.bind(this)}}),t=e.createElement("span",{class:"fonticon fonticon-left-open",events:{click:function(){i.dispatchEvent("onBack")}}}),e.createElement("div",{class:"mpf-esp-header",html:[t,h.get("selectMyESP"),this.save]})},_saveSelectedLabsIDs:function(){var e=this;return this.model.savePromise({PrivateMPFilter:this.selectedLabsIDs.join(",")},{patch:!0}).then(function(){e.dispatchEvent("save")})},_getInternLabID:function(){var e=[],t=this.shopsPrivate.filter(function(e){return e.isInternal()});return t&&t.forEach(function(t){e.push(t.get("id"))}),e},_onCenterChangedCB:function(t){var i,n=[];e.extendElement(this.container.querySelector(".fonticon-map")).hasClassName("map-active")&&(this.shopsPublic.forEach(function(e){e.getLatitude()<t._northEast.lat&&e.getLatitude()>t._southWest.lat&&e.getLongitude()<t._northEast.lng&&e.getLongitude()>t._southWest.lng&&n.push(e)}),i=this.displayedLabList.getParent(),this.displayedLabList.remove(),this.displayedLabList=this._displayLabList(n,this.selectedLabsIDs),this.displayedLabList.inject(i,"top"))},_refreshLabsList:function(e){var t=this.displayedLabList.getParent();this.displayedLabList.remove(),this.displayedLabList=this._displayLabList(e,this.selectedLabsIDs),this.displayedLabList.inject(t,"top"),this.isMapActive?this._showMap():this._hideMap()},_onTopBarSearch:function(e){if(e=e.toLowerCase()){for(var t=[],i=[],n=0;n<this.shopsPublic.size();n++){var s=this.shopsPublic.at(n);s.getName().toLowerCase().indexOf(e)>-1&&(t.push(s),i.push([s.getLatitude(),s.getLongitude()]))}t.length&&this._refreshLabsList(t);var o=this.container.getElement(".mpf-esp-labs-container");o&&(this._mapAlert||(this._mapAlert=new r({visible:!0,autoHide:!0,maximumVisibleMessages:1}).inject(o,"before")),this._mapAlert.add({className:"primary",message:h.get(t.length>1?"numberLabsFoundPlural":"numberLabsFound",{numberFound:"<b>"+t.length+"</b>",searchString:"&laquo; <b>"+e+"</b> &raquo;"})})),this.labMap.updateMapWithNewListLab(t)}else this._onTopBarClear()},_onTopBarClear:function(){this.labMap.setToDefaultPosition()},_checkPrototypes:function(e){i.requiredOfPrototype(this.model,n,"this.model must be a CompanyModel"),i.requiredOfPrototype(e.shopsPrivate,s,"options.shopsPrivate must be a ShopCollection"),i.requiredOfPrototype(e.shopsPublic,s,"options.shopsPublic must be a ShopCollection")},destroy:function(){this.model=null,this._parent(),this.container=null,l.unsubscribe("SearchBar/search"),l.unsubscribe("SearchBar/clear")}})}),define("DS/MPFPrivateMarketplaceComponent/EnterpriseInternalLabHeaderComponent",["UWA/Core","UWA/Class/View","DS/PlatformAPI/PlatformAPI","DS/UWPClientCode/Navigation","DS/MPFUrl/UrlUtils","DS/PubSub/PubSub","i18n!DS/MPFPrivateMarketplaceComponent/assets/nls/PrivateMarketplaceComponent","css!DS/MPFPrivateMarketplaceComponent/MPFPrivateMarketplaceComponent"],function(e,t,i,n,s,o,r){"use strict";return t.extend({setup:function(t){var n=this;this._parent(t),this.topic=t.topic,this.isUserAnAdmin=!0===t.isUserAnAdmin,this.titleSpan=e.createElement("span",{class:"mpf-espInternalLabHeaderSpan",text:r.get("internalServiceProvider")}),this.stepSpan=e.createElement("span",{class:"mpf-espInternalLabHeaderStepSpan",text:r.get("service-information")}),i.subscribe(this.topic,function(e){"titleSet"===e.event?n.titleSpan.setContent(r.get(e.title||"internalServiceProvider")):"stepSet"===e.event&&n.stepSpan.setContent(r.get(e.step))})},render:function(){var t,i,n,o,r,a,c;return n=(i=new s(window.location.href)).getPath(),o=i.getValueParameter("intlabid"),r=-1!==n.indexOf("/internal-lab")&&e.is(o),this.isUserAnAdmin&&(t=e.createElement("span",{class:"fonticon fonticon-left-open",events:{click:this._onBack.bind(this)}})),a=r?this.titleSpan:[this.titleSpan," | ",this.stepSpan],c=e.createElement("div",{class:"mpf-lab-header",html:e.is(t)?[t,a]:a}),this.container.setContent(c),this},setIsUserAdmin:function(e){this.isUserAnAdmin=!0===e},_onBack:function(){var e,t=new s(window.location.href),r=t.getPath(),a=t.getValueParameter("esid",""),c=t.getValueParameter("intlabid"),l=c&&(-1!==r.indexOf("/my-private-lab")||1!==r.indexOf("/internal-lab")),p=n.previousAddress&&n.previousAddress[0]&&"internal-lab"===n.previousAddress[0].name;-1!==r.indexOf("/my-private-lab/service-information-creation")?n.routeTo("/my-enterprise-service-providers?esid="+a):-1!==r.indexOf("/my-private-lab/additive-pricing")||-1!==r.indexOf("/my-private-lab/finish-pricing")?l||p?n.routeTo("/my-private-lab/pricing?esid="+a+"&intlabid="+c):n.routeTo("/my-private-lab/pricing?esid="+a):/my-private-lab\/printer(\/\w{32})?$/.test(r)?(o.dispatch(o.events.cardNavigation+"8mdBSNWA20HaTcQkaG05",["8mdBSNWA20HaTcQkaG06"]),e="/my-private-lab/printers?esid="+a,c&&(e+="&intlabid="+c),n.routeTo(e)):-1!==r.indexOf("/internal-lab/overview")?(n.routeTo("/my-enterprise-service-providers?esid="+a),i.publish("newLabSelectedRequest",{from:"CompanyEcosystem",id:c,backToPreviousLab:!0})):l||p?n.routeTo("/internal-lab/overview?esid="+a+"&intlabid="+c):n.routeTo("/lab-overview?esid="+a)},destroy:function(){this.model=null,this._parent(),this.container=null,this.stepSpan=null,this.titleSpan=null,this.topic=null}})}),define("DS/MPFPrivateMarketplaceComponent/EnterpriseInternalLabHeaderWidget",["UWA/Class","UWA/Promise","DS/MPFConnector/MarketplaceConnector","DS/MPFModelFactory/MPFFactoriesV2","DS/MPFCompanyModel/CompanyHelper","DS/PlatformAPI/PlatformAPI","DS/MPFPrivateMarketplaceComponent/EnterpriseInternalLabHeaderComponent"],function(e,t,i,n,s,o,r){"use strict";return e.extend({init:function(e){var n=this;this._parent(e),this.topic=e.topic,this.container=e.container,this.deferred=t.deferred(),this.promise=this.deferred.promise,this.headerComponent=this._createHeaderComponent(),i.fetchPromise().then(this._getFactories.bind(this)).then(this._fetchMe.bind(this)).then(this._fetchCompany.bind(this)).then(function(){n.headerComponent.setIsUserAdmin(n.me.isAdminOfThisEMP(n.company.getEmpProjectName())),n.deferred.resolve()})},onShow:function(){var e=this;this.promise.then(function(){e.headerComponent.render()})},_createHeaderComponent:function(){return new r({container:this.container,topic:this.topic})},_fetchCompany:function(){return this.company=s.getCompanyFromPerson(this.me,this.companyFactory),this.company.fetchPromise()},_fetchMe:function(){return this.me=this.personFactory.createModel("me"),this.me.fetchPromise()},_getFactories:function(e){var i=this;return this.factories=n.getInstance(e),t.all([this.factories.getFactory(n.Types.PERSON),this.factories.getFactory(n.Types.COMPANY)]).then(function(e){i.personFactory=e[0],i.companyFactory=e[1]})}})}),define("DS/MPFPrivateMarketplaceComponent/EnterpriseInternalLabServiceInformationWidget",["UWA/Core","UWA/Class","UWA/Promise","DS/UIKIT/Spinner","DS/PlatformAPI/PlatformAPI","DS/MPFDataProxy/MarketplaceConnector","DS/MPFModelFactory/MPFFactoriesV2","DS/MPFShopModel/ShopModel","DS/MPFPrivateMarketplaceComponent/EnterpriseInternalLabServiceInformationComponent","DS/MPFMenuComponent/StepNavigationButtonsComponent","i18n!DS/MPFPrivateMarketplaceComponent/assets/nls/PrivateMarketplaceComponent","css!DS/MPFUI/MPFUI"],function(e,t,i,n,s,o,r,a,c,l,p){"use strict";return t.extend({init:function(t){this._parent(t),this.topic=t.topic,this.creation=t.creation,this.container=t.container,this.subscribed=!1,document.body.style.backgroundColor="#f9f9f9";var i=this;this._getFirstPromise().then(function(){return i.company=i.companyFactory.createModel("company"),i.company.set("id",i.meModel.get("company").split("/")[i.meModel.get("company").split("/").length-1]),i._createNewShop(),i.company.fetchPromise()}).then(function(){i._createComponent(),i.buttonsComponent=new l({container:e.createElement("div",{class:"mpf-companyFooterContainer mpf-service-information-buttons"}),checkSave:!0,displayBack:t.displayBack,displayFinish:t.displayFinish,displayNext:t.displayNext,stepName:i.creation?"service-information-creation":"service-information",topic:i.topic}),(i.creation&&-1!==window.location.pathname.indexOf("service-information-creation")||!i.creation&&-1===window.location.pathname.indexOf("service-information-creation"))&&i.onShow()}).catch(function(){})},onShow:function(){var e,t,i=this;this.creation||this.subscribed||(s.subscribe("newLabSelected",function(e){i.model.get("id")!==e.id&&i._changeSelectedLab({newLab:e,that:i})}),s.publish("newLabSelectedRequest"),s.subscribe("topBarMultiShopsReady",function(){s.publish("newLabSelectedRequest")}),this.subscribed=!0),this.creation?(this.model.isNew()||this._createNewShop(),this._createComponent(),this._setContent(),e="service-information-creation",t="service-information",s.publish(this.topic,{event:"resetMenu",id:"service-information"})):(e="service-information",t="service-information-creation",s.publish("newLabSelectedRequest"),s.publish(i.topic,{complete:!0,event:"updateMenu",id:"service-information",status:"complete"}),this._changeSelectedLab({newLab:this.model,that:i})),s.publish(this.topic,{event:"idChange",newID:e,oldID:t})},_changeSelectedLab:function(e){var t=e.that;return this.creation=!1,this.model=this.shopFactory.createModel("shop"),this.model.set("id",e.newLab.id),this.model.fetchPromise({expand:[],uc2:!0}).then(function(){if(s.publish(t.topic,{event:"titleSet",id:"service-information",title:t.model.escape("shopName")}),t._initAddressModel(),!t.addressModel.isNew())return t.addressModel.fetchPromise()}).then(function(){t._createComponent(),t._setContent()})},_getFirstPromise:function(){var e=this;return o.fetchPromise().then(function(e){var t=r.getInstance(e);return i.all([t.getFactory(r.Types.ADDRESS),t.getFactory(r.Types.COMPANY),t.getFactory(r.Types.PERSON),t.getFactory(r.Types.SHOP),t.getFactory(r.Types.SHOP_SERVICE),t.getFactory(r.Types.COUNTRY)])}).then(function(t){e.addressFactory=t[0],e.companyFactory=t[1];var n=t[2];return e.shopFactory=t[3],e.shopServiceFactory=t[4],e.countryFactory=t[5],e.meModel=n.createModel("me"),e.countries=e.countryFactory.createCollection("seller"),i.all([e.meModel.fetchPromise(),e.countries.fetchPromise()])})},_createNewShop:function(){this.model=this.shopFactory.createModel("me"),this.model.setOwner(this.company.id),this.model.set(a.Fields.IS_INTERNAL,"TRUE"),this.addressModel=this.addressFactory.createModel("shop")},_createComponent:function(){var e;e=this.component,this.component=new c({addressModel:this.addressModel,countries:this.countries,company:this.company,id:this.creation?"service-information-creation":"service-information",model:this.model,shopServiceFactory:this.shopServiceFactory,topic:this.topic}),e&&e.destroy()},_setContent:function(){this.container.setContent([this.component.render(),this.buttonsComponent.render()])},_initAddressModel:function(){var e;if((e=this.model.getAddress())&&e.length>0)return this.addressModel=this.addressFactory.createModel("address"),this.addressModel.set("id",e.substring(e.lastIndexOf("/")+1)),this.addressModel.fetchPromise();this.addressModel=this.addressFactory.createModel("shop"),this.addressModel.setParentResourceId(this.model.id)}})}),define("DS/MPFPrivateMarketplaceComponent/EnterpriseMarketplaceCreationWidget",["UWA/Core","UWA/Class","UWA/Promise","UWA/Utils","DS/UWPClientCode/Navigation","DS/UIKIT/Spinner","DS/MPFConnector/MarketplaceConnector","DS/MPFModelFactory/MPFFactoriesV2","DS/MPFCompanyModel/CompanyHelper","DS/MPFUrl/UrlUtils","DS/MPFPrivateMarketplaceComponent/EnterpriseMarketplaceCreationComponent","DS/MPFError/BadArgumentError"],function(e,t,i,n,s,o,r,a,c,l,p,h){"use strict";return t.extend({init:function(e){this.widget=e},load:function(){var t=this;this.widget.body.addClassName("mpf-page"),(new o).inject(this.widget.body).show(),r.fetchPromise().then(this._getFactories.bind(this)).then(this._fetchMe.bind(this)).then(this._fetchCompany.bind(this)).then(function(){var i;i=t.company.getEmpProjectName(),e.is(i)&&""!==i?s.routeTo("/welcome?esid="+i):(t.empCreationComponent=t._getEMPCreationComponent(),t.widget.setBody(t.empCreationComponent.render()))}).catch(function(e){s.routeTo("/welcome")})},_getEMPCreationComponent:function(){return new p({model:this.company})},_fetchMe:function(){var e;return this.me=this.personFactory.createModel("me"),(e=n.getQueryString(window.location,"platform",""))?this.me.fetchPromise({cache:!1,platform:e}):i.reject(new h("platform parameter should always be there for an EMP creation"))},_getFactories:function(e){var t=this;return this.factories=a.getInstance(e),i.all([this.factories.getFactory(a.Types.PERSON),this.factories.getFactory(a.Types.COMPANY)]).then(function(e){t.personFactory=e[0],t.companyFactory=e[1]})},_fetchCompany:function(){var e=new l(window.location.href).getValueParameter("esid","");return""!==e&&s.routeTo("/welcome?esid="+e),this.company=c.getCompanyFromPerson(this.me,this.companyFactory),this.company?this.company.fetchPromise():i.reject(new h("User should always have a company when creating an EMP"))}})}),define("DS/MPFPrivateMarketplaceComponent/EnterpriseServiceProviderComponent",["UWA/Core","UWA/Utils","UWA/Class/View","DS/MPFServices/ObjectService","DS/MPFCompanyModel/CompanyModel","DS/MPFShopModel/ShopCollection","DS/MPFTcDocumentModel/TCDocumentFactory","DS/MPFShopModel/ShopServiceFactory","DS/UIKIT/Input/Button","DS/UIKIT/Input/Toggle","DS/UIKIT/Alert","DS/UIKIT/Mask","DS/PlatformAPI/PlatformAPI","DS/MPFPrivateMarketplaceComponent/ServiceProvidersCommunityComponent","DS/MPFUrl/UrlUtils","DS/UWPClientCode/Navigation","DS/MPFShopCardComponent/SmallShopCardComponent","i18n!DS/MPFPrivateMarketplaceComponent/assets/nls/PrivateMarketplaceComponent","css!DS/MPFPrivateMarketplaceComponent/MPFPrivateMarketplaceComponent"],function(e,t,i,n,s,o,r,a,c,l,p,h,m,d,u,v,f,P){"use strict";return i.extend({className:"mpf-sp-container",setup:function(e){console.warn('This component is deprecated. Please use "DS/MPFEmpMyEcosystemComponent/ServiceProviderMainPage" instead.'),e||(e={}),this._parent(e),this._checkPrototypes(e),this.shopsPrivate=e.shopsPrivate,this.shopsPublic=e.shopsPublic,this.shopsPublicPromise=e.shopsPublicPromise,this.shopServiceFactory=e.shopServiceFactory,this.tcDocumentFactory=e.tcDocumentFactory,this.topic=e.topic,this._initMyCompanyEcosystemButtonListener(),this.termsFiles={},this.existingServiceProvidersComponent=this._createExistingServiceProvidersComponent(),this.newServiceProviderComponent=this._createNewServiceProviderComponent(),this.checkbox=new l({className:"mpf-sp-checkbox primary",type:"checkbox",value:P.get("allowAllSP"),checked:this.model.getEMPAllowPublicSellers(),events:{onClick:this._allowPublicSellers.bind(this)}})},render:function(){var t,i,n;return this._updateLabCountsInHeaderBoxes(),t=e.createElement("div",{class:"mpf-choice-sp-container",html:[this.existingServiceProvidersComponent,this.newServiceProviderComponent]}),n=e.createElement("div",{class:"mpf-sp-lab-container",html:this._displayLabs(this.shopsPrivate)}),i=e.createElement("div",{class:"mpf-sp-content",html:[t,this.checkbox,n]}),this.container.setContent(i),this.displayAlert(),this},displayAlert:function(){0===this.shopsPrivate.size()&&new p({visible:!0,closeOnClick:!1,maximumVisibleMessages:1,messageClassName:"primary",messages:P.get("noLabsSelected")}).inject(this.container.getElement(".mpf-sp-lab-container"))},_displayLabs:function(e){var t,i,n=this,s=[];return e.forEach(function(e){(i={}).shop=e,i.displayEMPIcon=!0,i.isSelected=!1,e.isInternal()&&(i.button={label:P.get("edit"),onClickCallback:n._onEdit.bind(n,e)}),t=new f(i),s.push(t.render())}),s},_onEdit:function(e){var i,n,s;n=window.location.search,(s=t.parseQuery(n)).intlabid=e.id,i="/internal-lab/overview?"+t.toQueryString(s),m.publish("newLabSelectedRequest",{from:"CompanyEcosystem",id:e.id}),v.routeTo(i)},_allowPublicSellers:function(){return this.model.savePromise({PrivateMPAllowPublicSellers:this.checkbox.isChecked()},{patch:!0})},_createNewServiceProviderComponent:function(){var t,i,n,s,o,r,a=this;return o=e.createElement("span",{text:[P.get("myCompanyServiceProviders")+" | "+this.shopsPrivate.filter(function(e){return e.isInternal()}).length.toString()]}),s=e.createElement("div",{class:"mpf-sp-count",html:o}),t=e.createElement("div",{class:"mpf-sp-image-container mpf-new-sp"}),r=e.createElement("div",{class:"mpf-sp-topHalf-container",html:[s,t]}),i=e.createElement("div",{class:"mpf-choice-sp-container-label",html:e.createElement("span",{class:"mpf-choice-sp-label",text:P.get("newProviderLabel")})}),n=new c({className:"primary",value:P.get("newESPButton"),events:{onClick:function(){m.publish(a.topic,{event:"titleSet"}),v.routeTo("/my-private-lab/service-information-creation"+window.location.search)}}}),e.createElement("div",{class:"mpf-choice-sp mpf-declareNewInternalLab",html:[r,i,n]})},_createExistingServiceProvidersComponent:function(){var t,i,n,s,o,r;return o=e.createElement("span",{text:[P.get("communityServiceProviders")+" | "+this.shopsPrivate.filter(function(e){return!e.isInternal()}).length.toString()]}),s=e.createElement("div",{class:"mpf-sp-count",html:o}),t=e.createElement("div",{class:"mpf-sp-image-container mpf-existing-sp"}),r=e.createElement("div",{class:"mpf-sp-topHalf-container",html:[s,t]}),i=e.createElement("div",{class:"mpf-choice-sp-container-label",html:e.createElement("span",{class:"mpf-choice-sp-label",text:P.get("existingProviderLabel")})}),n=new c({className:"primary",value:P.get("selectESPButton"),events:{onClick:this._displayServiceProvidersCommunityComponent.bind(this)}}),e.createElement("div",{class:"mpf-choice-sp  mpf-selectPublicLabsDiv",html:[r,i,n]})},_displayServiceProvidersCommunityComponent:function(){var e=this;return h.mask(this.container),this.shopsPublicPromise.then(function(){e.espComponent=new d({model:e.model,shopsPublic:e.shopsPublic,shopsPrivate:e.shopsPrivate}),e.container.setContent(e.espComponent.render()),h.unmask(e.container),e.communityServiceProvidersDisplayed=!0,e.listenTo(e.espComponent,"onBack",function(){e.render(),e.communityServiceProvidersDisplayed=!1}),e.listenTo(e.espComponent,"save",e._onSaveCommunityLabs.bind(e))})},_onSaveCommunityLabs:function(){var e=this;this.shopsPrivate.fetchPromise().then(function(){e.render(),e.communityServiceProvidersDisplayed=!1})},_updateLabCountsInHeaderBoxes:function(){var t,i;t=e.createElement("span",{text:[P.get("communityServiceProviders")+" | "+this.shopsPrivate.filter(function(e){return!e.isInternal()}).length.toString()]}),this.existingServiceProvidersComponent.getElement(".mpf-sp-count").setContent(t),i=e.createElement("span",{text:[P.get("myCompanyServiceProviders")+" | "+this.shopsPrivate.filter(function(e){return e.isInternal()}).length.toString()]}),this.newServiceProviderComponent.getElement(".mpf-sp-count").setContent(i)},_initMyCompanyEcosystemButtonListener:function(){var e=this,t=document.body.getElement(".mp-nav-bar li.active");this.communityServiceProvidersDisplayed=!1,this.listenTo(t,"click",function(){e.communityServiceProvidersDisplayed&&(e.render(),e.communityServiceProvidersDisplayed=!1)})},_checkPrototypes:function(e){n.requiredOfPrototype(this.model,s,"this.model must be a CompanyModel"),n.requiredOfPrototype(e.shopsPrivate,o,"options.shopsPrivate must be a ShopCollection"),n.requiredOfPrototype(e.shopsPublic,o,"options.shopsPublic must be a ShopCollection"),n.requiredOfPrototype(e.tcDocumentFactory,r,"options.tcDocumentFactory must be a TCDocumentFactory"),n.requiredOfPrototype(e.shopServiceFactory,a,"options.shopServiceFactory must be a ShopServiceFactory")},destroy:function(){this.model=null,this._parent(),this.container=null}})}),define("DS/MPFPrivateMarketplaceComponent/EnterpriseServiceProviderManagementComponent",["UWA/Core","UWA/Class","UWA/Promise","DS/Logger/Logger","DS/PlatformAPI/PlatformAPI","DS/UIKIT/Mask","DS/UIKIT/Alert","DS/MPFConnector/MarketplaceConnector","DS/MPFModelFactory/MPFFactoriesV2","DS/MPFCompanyModel/CompanyHelper","DS/UWPClientCode/Navigation","DS/MPFUrl/UrlUtils","DS/MPFPrivateMarketplaceComponent/EnterpriseServiceProviderComponent","i18n!DS/MPFPrivateMarketplaceComponent/assets/nls/PrivateMarketplaceComponent"],function(e,t,i,n,s,o,r,a,c,l,p,h,m,d){"use strict";var u=t.extend({init:function(e){this.widget=e,n.setEnabled(!0),this.logger=n.getLogger(u)},load:function(){var t,i=this;this.widget.body.addClassName("mpf-page"),this._displayMask(),a.fetchPromise().then(this._getFactories.bind(this)).then(this._fetchMeAndShops.bind(this)).then(this._fetchCompany.bind(this)).then(function(){i.isUserAnAdmin=i.me.isAdminOfThisEMP(i.company.getEmpProjectName()),i.isUserAnAdmin?(i.enterpriseServiceProvidersComponent=i._getEnterpriseServiceProvidersComponent(),i.widget.setBody(i.enterpriseServiceProvidersComponent.render()),i.enterpriseServiceProvidersComponent.displayAlert(),s.subscribe("newLabCreated",function(){i.shopsPrivate.fetchPromise().then(i.enterpriseServiceProvidersComponent.render.bind(i.enterpriseServiceProvidersComponent))})):(new r({className:"error",messageClassName:"error",messages:d.get("unauthorizedMessage"),closable:!0,visible:!0,autoHide:!0,hideDelay:5e3,closeOnClick:!0}).inject(i.widget.body,"top"),t=new h(window.location.href).getValueParameter("esid"),p.routeTo(e.is(t)?"/welcome?esid="+t:"/welcome"))}).catch(function(t){var n;i.logger.error(t),n=e.createElement("span",{text:d.get("errorLoadingWidget")}),i.widget.setBody(n)})},_getEnterpriseServiceProvidersComponent:function(){return new m({shopsPrivate:this.shopsPrivate,shopsPublic:this.shopsPublic,shopsPublicPromise:this.shopsPublicPromise,model:this.company,shopServiceFactory:this.shopServiceFactory,tcDocumentFactory:this.tcDocumentFactory,topic:this.widget.getValue("mpTopic")})},_fetchCompany:function(){var e;return e=this.me.getCompanyId(),this.company=this.companyFactory.createModel("company",{id:e}),this.company.fetchPromise()},_fetchMeAndShops:function(){return this.shopsPrivate=this.shopFactory.createCollection("publicPMP"),this.shopsPublic=this.shopFactory.createCollection("publicNoESID"),this.me=this.personFactory.createModel("me"),this.shopsPublicPromise=this.shopsPublic.fetchPromise(),i.all([this.me.fetchPromise(),this.shopsPrivate.fetchPromise()])},_getFactories:function(e){var t=this;return this.factories=c.getInstance(e),i.all([this.factories.getFactory(c.Types.PERSON),this.factories.getFactory(c.Types.COMPANY),this.factories.getFactory(c.Types.SHOP),this.factories.getFactory(c.Types.SHOP_SERVICE),this.factories.getFactory(c.Types.TC_DOCUMENT)]).then(function(e){t.personFactory=e[0],t.companyFactory=e[1],t.shopFactory=e[2],t.shopServiceFactory=e[3],t.tcDocumentFactory=e[4]})},_displayMask:function(){var t;(t=e.createElement("div",{styles:{height:"30px",margin:"30px 100px",width:"90%"}})).inject(this.widget.body),o.mask(t)}});return u});