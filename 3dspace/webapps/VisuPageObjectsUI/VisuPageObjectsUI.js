define("DS/VisuPageObjectsUI/VisuPageObjectsConsoleDlg",["UWA/Core","DS/WebappsUtils/WebappsUtils","DS/Controls/Button","DS/Windows/Dialog","DS/VisuTools/WebVisuPOUtils","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/DataGridView/DataGridView","DS/DataGridView/DataGridViewLayout","DS/VisuTools/WebVisuPOEngine","DS/Windows/Panel","DS/VisuEvents/EventsManager"],function(e,t,i,n,o,l,a,s,r,c,d,u){"use strict";var h=null,p=0,m=function(e){window.QAAutomationWebVisuConsoleDlg=this,h=this,this.options=e,this.dlg=null,this.visible=!0,this.play=!0,this.items=[],this.itemsJson=[],this.init(),o.registerConsoleDlg(this)};m.prototype.init=function(){this._webGLV6Viewer=c.getViewer(null),this._immersiveFrame=this.options.immersiveFrame,this._buildDialog()},m.prototype.toggleVisibility=function(){this.visible=!this.visible,this.visible?this.dlg.show():this.dlg.hide()},m.prototype._buildDialog=function(){o.dumpEvents(this._webGLV6Viewer);var e=this,t=UWA.createElement("div",{class:"wux-control-inline-container",style:{"vertical-align":"top"}});e.dlg=new n({title:"Viewer page objects console",content:t,immersiveFrame:e._immersiveFrame,resizableFlag:!0,width:640,height:480,allowedDockAreas:WUXDockAreaEnum.TopDockArea|WUXDockAreaEnum.BottomDockArea|WUXDockAreaEnum.LeftDockArea|WUXDockAreaEnum.RightDockArea}),e.dlg.getContent().id="RasterizerVisualQuality",this._setupDataGridViewConsole(t),e._displayItems(o.getConsoleItems()),e.options.cmd._windowOpen=!0,e.dlg.addEventListener("close",function(){o.consoleDlg=null,e.options.cmd._windowOpen=!1})};var g=0;return m.prototype._displayItems=function(e){var t;if(p+=e.length,this.dataGridViewConsole){var i;for(this.treeDocument.prepareUpdate(),t=0;t<e.length;t++)i=new a({label:"line"+g,grid:{Text:e[t].str}}),this.items.push(e[t].str),this.itemsJson.push(e[t].json),g++,this.treeDocument.addRoot(i);this.treeDocument.pushUpdate()}},m.prototype.dumpContent=function(){console.log(this.items.join("\n"))},m.prototype._setupDataGridViewConsole=function(e){this.treeDocument=new l;this.dataGridViewConsole=new s({treeDocument:this.treeDocument,columns:[{text:"Commands",dataIndex:"Text",sortableFlag:!1}],showRowHeaderBackgroundFlag:!1,layout:new r({columnsHeader:!1,rowsHeader:!1})});var t=this.dataGridViewConsole,i=0;t.onPostUpdateView(function(){var e=t.model;i!==e.length&&(e.length>0&&t.ensureNodeModelVisible(e[e.length-1]),i=e.length)});var n={entries:[{id:"copy",dataElements:{typeRepresentation:"function",label:"Copy",tooltip:navigator.clipboard?"Copy":"Clipboard unavailable: use CTRL-C",icon:"",category:"other",readOnly:!1,position:"near",disabled:!navigator.clipboard,action:{module:"DS/VisuPageObjectsUI/VisuPageObjectsConsoleDlg",func:"copy",argument:{isCheck:!1,mode:"all"}}},children:[]},{id:"level",dataElements:{typeRepresentation:"functionMenu",label:"XXXXXXXXX",category:"other",readOnly:!1},children:[{id:"highLevel",dataElements:{typeRepresentation:"PushItem",label:"Dump high level interactions (ex: mouseClick)",action:{module:"DS/VisuPageObjectsUI/VisuPageObjectsConsoleDlg",func:"setLevel",argument:{level:"high"}}}},{id:"lowLevel",dataElements:{typeRepresentation:"PushItem",label:"Dump low level interactions (ex: mousemove)",action:{module:"DS/VisuPageObjectsUI/VisuPageObjectsConsoleDlg",func:"setLevel",argument:{level:"low"}}}}]},{id:"clear",dataElements:{typeRepresentation:"function",label:"Clear",icon:"",category:"other",readOnly:!1,position:"near",action:{module:"DS/VisuPageObjectsUI/VisuPageObjectsConsoleDlg",func:"clear",argument:{isCheck:!1,mode:"all"}}},children:[]},{id:"play",dataElements:{typeRepresentation:"function",label:"Pause",icon:"",category:"other",readOnly:!1,position:"near",disabled:!1,action:{module:"DS/VisuPageObjectsUI/VisuPageObjectsConsoleDlg",func:"switchPlay",argument:{isCheck:!1,mode:"all"}}},children:[]},{id:"level",dataElements:{typeRepresentation:"functionMenu",label:"Screenshot",category:"other",readOnly:!1},children:[{id:"highLevel",dataElements:{typeRepresentation:"PushItem",label:"Content checker",action:{module:"DS/VisuPageObjectsUI/VisuPageObjectsConsoleDlg",func:"captureScreenshot",argument:{fullPixelChecker:!1}}}},{id:"lowLevel",dataElements:{typeRepresentation:"PushItem",label:"Full pixel checker (RESTRICTED ACCESS)",action:{module:"DS/VisuPageObjectsUI/VisuPageObjectsConsoleDlg",func:"captureScreenshot",argument:{fullPixelChecker:!0}}}}]},{id:"repPick",dataElements:{typeRepresentation:"function",label:"Rep pick",icon:"",category:"other",readOnly:!1,position:"near",disabled:!1,action:{module:"DS/VisuPageObjectsUI/VisuPageObjectsConsoleDlg",func:"repPick",argument:{}}},children:[]}]},o=document.createElement("div");o.style.width="500px",e.appendChild(o),o.className="divToolbar",this.dataGridViewConsole.getContent().style.top="50px";var a=this.dataGridViewConsole.setToolbar(JSON.stringify(n));a.dlg=this,this.toolbar=a,a.updateNodeModel("level",{label:"High"}),e.appendChild(this.dataGridViewConsole.getContent()),o.appendChild(a.getContent());var c=this.dataGridViewConsole.getCellsXSO();function d(){navigator.clipboard&&(c.get().length>0?a.updateNodeModel("copy",{disabled:!1}):a.updateNodeModel("copy",{disabled:!0}))}c.onPostAdd(d),c.onPostRemove(d);var u=this.dataGridViewConsole;u.addEventListener("dblclick",function(){m.copy({context:u})})},m.prototype._onScreenShot=function(e,t,i){var n=document.createElement("img");n.src=i;window.devicePixelRatio;n.width=e,n.height=t,this.screenshotPanel&&this.screenshotPanel.close(),this.screenshotPanel=new d({immersiveFrame:this._immersiveFrame,title:"Screenshot preview",content:n,height:t,width:e,resizableFlag:!0,identifier:"screenshotPanel",position:{my:"center",at:"center",of:this._immersiveFrame}}),this.screenshotPanel.width=e+10,this.screenshotPanel.height=t+20},m.prototype.clear=function(){o.clear(),this.dataGridViewConsole.treeDocument.removeRoots(),this.items=[]},m.copy=function(e){var t,i=h.dataGridViewConsole.getCellsXSO().get(),n="";for(t=0;t<i.length;t++)n+=i[t].nodeModel.getAttributeValue("Text")+"\n";navigator.clipboard.writeText(n)},m.setLevel=function(e){var t=h.toolbar;"high"===e.level?(t.updateNodeModel("level",{label:"High"}),o.setLevel("high")):"low"===e.level&&(t.updateNodeModel("level",{label:"Low"}),o.setLevel("low"))},m.switchPlay=function(e){var t=h.toolbar,i=t.dlg;i.play=!i.play,i.play?t.updateNodeModel("play",{label:"Pause"}):t.updateNodeModel("play",{label:"Play"}),o.setPlay(i.play)},m._dbg_getCount=function(){return p},m.clear=function(e){window.QAAutomationWebVisuConsoleDlg.clear()},m.prototype._displayJSON=function(e){this.repPickJSONPanel&&this.repPickJSONPanel.close();var t=e.replace(/(?:\r\n|\r|\n)/g,"<br>");t=t.replace(/\s/g,"&nbsp;"),this.repPickJSONPanel=new d({immersiveFrame:this._immersiveFrame,title:"rep pick JSON preview",content:t,height:400,width:300,resizableFlag:!0,identifier:"repPickJSONPanel",position:{my:"center",at:"center",of:this._immersiveFrame}}),this.repPickJSONPanel.width=310,this.repPickJSONPanel.height=420},m.repPick=function(e){var t=h.toolbar.dlg,i=t._webGLV6Viewer;i.setPicking({primitive:2});var n=function(e){u.removeEvent(i.canvas,"onLeftClick",n),i.setPicking({primitive:!1});var l=e.from[0].getCurrentPosition();c.doRepPick({x:l.x,y:l.y},{_noCtx:!0},function(e){e&&(t._displayJSON(e),o._onRepPick(i,l.x,l.y))},null)};u.addEvent(i.canvas,"onLeftClick",n)},m.captureScreenshot=function(e){var t=h.toolbar.dlg,i=t._webGLV6Viewer,n=document.createElement("div");n.style.position="absolute",n.style.left="0px",n.style.top="0px",n.style.width=i.SCREEN_WIDTH+"px",n.style.height=i.SCREEN_HEIGHT+"px",n.style.backgroundColor="#ff0000",n.style.opacity=.2,i.canvas.parentNode.appendChild(n);var l={left:0,top:0};try{l=i.canvas.getBoundingClientRect()}catch(e){}!function(e,t,i,n,o){var l=document.createElement("div");l.style.position="absolute",l.style.border="1px dotted #000",l.style.pointerEvents="none",l.hidden=1,e.parentNode.appendChild(l);var a=0,s=0,r=0,c=0;function d(e){"Escape"===e.key&&(h(),o(!1,0,0,0,0))}function u(){var e=Math.min(a,r),t=Math.min(s,c),i=Math.max(a,r),n=Math.max(s,c);l.style.left=e+"px",l.style.top=t+"px",l.style.width=i-e+"px",l.style.height=n-t+"px"}function h(){e.parentNode.removeChild(l),e.removeEventListener("mousedown",p),e.removeEventListener("mouseup",g),e.removeEventListener("mousemove",m),n.dlg.content.removeEventListener("keydown",d)}function p(e){l.hidden=0,a=e.clientX,s=e.clientY,r=a,c=s,u()}function m(e){r=e.clientX,c=e.clientY,u()}function g(e){h();var n=Math.min(a,r),l=Math.min(s,c),d=Math.max(a,r),u=Math.max(s,c);o(!0,n-t,l-i,d-t,u-i)}n.dlg.content.addEventListener("keydown",d),e.addEventListener("mousedown",p),e.addEventListener("mousemove",m),e.addEventListener("mouseup",g),e.addEventListener("touchstart",function(e){l.hidden=0,a=Math.round(e.touches[0].clientX),s=Math.round(e.touches[0].clientY),r=a,c=s,u()}),e.addEventListener("touchmove",function(e){r=Math.round(e.touches[0].clientX),c=Math.round(e.touches[0].clientY),u()}),e.addEventListener("touchend",function(e){h();var n=Math.min(a,r),l=Math.min(s,c),d=Math.max(a,r),u=Math.max(s,c);o(!0,n-t,l-i,d-t,u-i)})}(n,l.left,l.top,t,function(l,a,s,r,d){if(i.canvas.parentNode.removeChild(n),l){var u=r-a+1,h=d-s+1;o._onScreenShot(i,a,s,u,h,e.fullPixelChecker),c.doScreenShot({x:devicePixelRatio*a,y:devicePixelRatio*s,width:devicePixelRatio*u,height:devicePixelRatio*h},{_noCtx:!0},t._onScreenShot.bind(t,u,h),null,{checkerMode:e.fullPixelChecker?"FullPixelChecker":"ContentChecker"})}})},m});