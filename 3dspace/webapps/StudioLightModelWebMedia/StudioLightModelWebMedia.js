define("DS/StudioLightModelWebMedia/extensions/CATELightActor3DGeoVisu",["UWA/Core","DS/CATCXPModel/extensions/CATE3DActor3DGeoVisu","DS/Visualization/ThreeJS_DS","DS/MathematicsES/MathsDef"],function(e,t,i,r){"use strict";return t.extend({init:function(){this._parent()},Dispose:function(){this._parent(),this._colorListener.stopListening(),this._colorListener=null},_Fill:function(e){this._parent(e),this._createOrRefreshLight();var t=this;this.listenTo(this.QueryInterface("CATI3DExperienceObject"),"diffuseColor.CHANGED",function(){t._createOrRefreshDiffuseColorListeners(),t.frameVisuChanges.push(t._refreshColor),t.RequestVisuRefresh()}),this._createOrRefreshDiffuseColorListeners(),this.listenTo(this.QueryInterface("CATI3DExperienceObject"),"power.CHANGED",function(){t.frameVisuChanges.push(t._refreshPower),t.RequestVisuRefresh()}),this.listenTo(this.QueryInterface("CATI3DExperienceObject"),"castShadows.CHANGED",function(){t.frameVisuChanges.push(t._refreshCastShadow),t.RequestVisuRefresh()}),this.frameVisuChanges.push(this._refreshCastShadow),this.setReady(!0)},_createOrRefreshDiffuseColorListeners:function(){this._colorListener?this._colorListener.stopListening():this._colorListener=new e.Class.Listener;var t=this.QueryInterface("CATI3DExperienceObject").GetValueByName("diffuseColor"),i=this;t&&(this._colorListener.listenTo(t.QueryInterface("CATI3DExperienceObject"),"r.CHANGED",function(){i.frameVisuChanges.push(i._refreshColor),i.RequestVisuRefresh()}),this._colorListener.listenTo(t.QueryInterface("CATI3DExperienceObject"),"g.CHANGED",function(){i.frameVisuChanges.push(i._refreshColor),i.RequestVisuRefresh()}),this._colorListener.listenTo(t.QueryInterface("CATI3DExperienceObject"),"b.CHANGED",function(){i.frameVisuChanges.push(i._refreshColor),i.RequestVisuRefresh()}))},_createOrRefreshLight:function(){e.is(this._lightNode)&&(this._node3D.removeChild(this._lightNode),this._lightNode.removeChildren())},_refreshPower:function(){this._lightNode.setPower(this.QueryInterface("CATI3DExperienceObject").GetValueByName("power"))},_refreshColor:function(){this._lightNode.setColor(this._getThreeColor(this.QueryInterface("CATI3DExperienceObject").GetValueByName("diffuseColor")))},_refreshCastShadow:function(){var e=this.QueryInterface("CATI3DExperienceObject").GetValueByName("castShadows");this._lightNode.castShadows(e),e?this._lightNode.updateShadowMap(!0):this._lightNode.updateShadowMap(!1)},GetLocalNodes:function(){return this._lightNode},_getThreeColor:function(e){var t=e.QueryInterface("CATI3DExperienceObject");return new i.Color("rgb("+t.GetValueByName("r")+","+t.GetValueByName("g")+","+t.GetValueByName("b")+")")},GetBoundingBox:function(e){var t,s=this.Get();if(e=e||0,t=s.visible?new i.Box3(new i.Vector3(0,0,0),new i.Vector3(0,0,0)):s.getBoundingBox("invisibleSpace"),0===e){var o=new r.Transformation;this.QueryInterface("CATIMovable").GetAbsPosition(o);var n=o.getArray(),h=new i.Matrix4(n[0],n[3],n[6],n[9],n[1],n[4],n[7],n[10],n[2],n[5],n[8],n[11],0,0,0,1);t.applyMatrix4(h)}return t}})}),define("DS/StudioLightModelWebMedia/extensions/CATEDirectionalLightActor3DGeoVisu",["UWA/Core","DS/StudioLightModelWebMedia/extensions/CATELightActor3DGeoVisu","DS/SceneGraphNodes/DirectionalLightNode","DS/Visualization/ThreeJS_DS"],function(e,t,i,r){"use strict";return t.extend({_createOrRefreshLight:function(){let t=this.QueryInterface("CATI3DExperienceObject"),s=t.GetValueByName("power"),o=this._getThreeColor(t.GetValueByName("diffuseColor")),n=!1;if(e.is(this._lightNode)&&e.is(this._lightNode.color)&&(n=this._refreshUtils.compareColor(o,this._lightNode.color)),e.is(this._lightNode)){if(n&&s===this._lightNode.intensity)return!1;this._parent()}return this._lightNode=new i({color:o,intensity:s}),this._lightNode.setMatrix(new r.Matrix4(0,0,1,0,0,1,0,0,1,0,0,0,0,0,0,1)),this._lightNode.setName(t.GetValueByName("_varName")),this._node3D.addChild(this._lightNode),!0},_refreshPower:function(){let e=this.QueryInterface("CATI3DExperienceObject").GetValueByName("power");return null!==e&&e!==this._lightNode.intensity&&(this._lightNode.setIntensity(e),!0)}})}),define("DS/StudioLightModelWebMedia/extensions/CATESpotLightActor3DGeoVisu",["UWA/Core","DS/StudioLightModelWebMedia/extensions/CATELightActor3DGeoVisu","DS/SceneGraphNodes/SpotLightNode","DS/Visualization/ThreeJS_DS","DS/CATCXPModel/CATCXPRefreshUtils"],function(e,t,i,r,s){"use strict";return t.extend({init:function(){this._parent(),this._refreshUtils=new s},_Fill:function(e){this._parent(e);var t=this;this.listenTo(this.QueryInterface("CATI3DExperienceObject"),"innerAngle.CHANGED",function(){t.frameVisuChanges.push(t._refreshAngles),t.RequestVisuRefresh()}),this.listenTo(this.QueryInterface("CATI3DExperienceObject"),"outerAngle.CHANGED",function(){t.frameVisuChanges.push(t._refreshAngles),t.RequestVisuRefresh()}),this.frameVisuChanges.push(this._refreshAngles)},_createOrRefreshLight:function(){var t=this.QueryInterface("CATI3DExperienceObject"),s=t.GetValueByName("power"),o=this._getThreeColor(t.GetValueByName("diffuseColor")),n=!1;e.is(this._lightNode)&&e.is(this._lightNode.color)&&(n=this._refreshUtils.compareColor(o,this._lightNode.color));var h=t.GetValueByName("outerAngle")/2*Math.PI/180,a=h*t.GetValueByName("innerAngle")/100;if(e.is(this._lightNode)){if(n&&s===this._lightNode.power&&h===this._lightNode.outerAngle&&a===this._lightNode.innerAngle)return!1;this._parent()}return this._lightNode=new i({color:o,power:s,outerAngle:h,innerAngle:a,distance:0,physicalAttenuation:!0}),this._lightNode.setMatrix(new r.Matrix4(0,0,-1,0,0,-1,0,0,-1,0,0,0,0,0,0,1)),this._lightNode.setName(t.GetValueByName("_varName")),this._node3D.addChild(this._lightNode),!0},_refreshAngles:function(){var e=this.QueryInterface("CATI3DExperienceObject"),t=e.GetValueByName("outerAngle")/2*Math.PI/180,i=t*e.GetValueByName("innerAngle")/100;return(t!==this._lightNode.outerAngle||i!==this._lightNode.innerAngle)&&(this._lightNode.setAngles(t,i,!1),!0)}})}),define("DS/StudioLightModelWebMedia/extensions/CATEPointLightActor3DGeoVisu",["UWA/Core","DS/StudioLightModelWebMedia/extensions/CATELightActor3DGeoVisu","DS/SceneGraphNodes/PointLightNode","DS/CATCXPModel/CATCXPRefreshUtils"],function(e,t,i,r){"use strict";return t.extend({init:function(){this._parent(),this._lightNode=null,this._refreshUtils=new r},_createOrRefreshLight:function(){var t=this.QueryInterface("CATI3DExperienceObject"),r=t.GetValueByName("power"),s=this._getThreeColor(t.GetValueByName("diffuseColor")),o=!1;if(e.is(this._lightNode)&&e.is(this._lightNode.color)&&(o=this._refreshUtils.compareColor(s,this._lightNode.color)),e.is(this._lightNode)){if(o&&r===this._lightNode.power)return!1;this._parent()}return this._lightNode=new i({color:s,power:r,distance:0,physicalAttenuation:!0}),this._lightNode.setName(t.GetValueByName("_varName")),this._node3D.addChild(this._lightNode),!0}})});