/*!  COPYRIGHT DASSAULT SYSTEMES 2021   */
define("DS/ENOXParser/modules/common/OfwBuilder",[],function(){function e(e){e.children||(e.children=[])}function t(e){this.options=e,this._referenceMap=new Map}return t.prototype={addReference:function(e){this._referenceMap.set(e.resourceid,e)},addInstance:function(t){t.isInstance=!0;var n=this._referenceMap.get(t.from);e(n),n.children.push(t);var r=this._referenceMap.get(t.resourceid);e(t),t.children.push(r)},getReference:function(e){return this._referenceMap.get(e)},correct:function(){}},t}),define("DS/ENOXParser/modules/Numbers",[],function(){const e=[1,0,0,0,1,0,0,0,1,0,0,0],t=6;function n(e,t){let n=parseFloat(e);if(void 0!==t){let e=n.toFixed(t);n=parseFloat(e)}return n}return{int:parseInt,float:n,checkNotIdentity:function(r){let i=function(e){let r=[];for(let i=0;i<e.length;i++){let o=e[i];r.push(n(o,t))}return r}(r.split(",")),o=!1;for(let t=0;t<i.length&&!o;t++)i[t]!==e[t]&&(o=!0);return o}}}),define("DS/ENOXParser/modules/common/Constants",[],function(){return{NODE_STATES:{COLLAPSED:{state:"collapsed"},EXPANDED:{state:"expanded"},NOCHILDREN:{state:"noChildren"},EXPANDING:{state:"expanding"},PARTIALLY_EXPANDED:{state:"partiallyExpanded"}},GLOBALTYPE_DOC:"ds6w:Document",MATRIX_IDENTITY:[1,0,0,0,1,0,0,0,1,0,0,0]}}),define("DS/ENOXParser/modules/mixins/parser/MergeObj",["DS/PADServices/utils/Iterator"],function(e){const t=["grid","icons"];function n(t,i){let o={},s=0,a=0;var d=[],l=[];return Array.isArray(i)?r(t,i):(e.iterateObj(i,function(e,t){var n;s++,Array.isArray(e)?d.push(t):null!=(n=e)&&!0!==n&&!1!==n&&!n.toPrecision&&n&&n.isPrototypeOf&&n.hasOwnProperty&&!n.trim?l.push(t):a++}),a===s?o=Object.assign({},i):(o=Object.assign({},i),e.iterate(d,function(e){o[e]=r(t,i[e])}),e.iterate(l,function(e){o[e]=n(t,i[e])})),o)}function r(t,r){var i=[];return e.iterate(r,function(e){i.push(n(t,e))}),i}function i(){}return i.prototype={smartAssign:function(n,r){var i=Object.assign({},n,r);return e.iterate(t,function(e){r[e]&&(i[e]=Object.assign({},n[e],r[e]))}),i},assignClone:function(e){return n(this,e)}},i}),define("DS/ENOXParser/modules/ColorMapParser",["DS/PADServices/utils/Iterator"],function(e){function t(t){this.data={predicateKind:"",colorMap:{map:{},predicate:void 0}};let n=this;this.data.predicateKind=t.tagColors&&t.tagColors.length?t.tagColors[0].type:null,e.iterate(t.tagColors,function(e){if(void 0===n.data.colorMap.predicate){var t=e.predicate.split("/"),r=t[t.length-1];n.data.colorMap.predicate=r}var i=e.object;Array.isArray(i)&&(i=i.join("/"),this.predicateKind="arrayPredicates"),n.data.colorMap.map[i]=e.color,n.data.colorMap.map[e.dispValue]=e.color})}return t.prototype={interpret:function(e){}},t}),define("DS/ENOXParser/modules/common/Timeout",[],function(){const e={parseTimeout:!0};function t(e){this.timeout=e,this.start=Date.now()}return t.prototype={check:function(){if(void 0!==this.timeout&&Date.now()-this.start>this.timeout)throw e}},t}),define("DS/ENOXParser/modules/common/Helpers",["UWA/Core","DS/PADServices/utils/Iterator","DS/PADServices/utils/IconMgt"],function(e,t,n){const r={EXPANDV2:{instances:function(e){return void 0!==e.to},references:function(e){let t=void 0===e.to&&void 0!==e.resourceid;if(t&&n.isActive()){var r=n.buildKey(e),i=n.buildThumbKey(e);-1===this.typeMap.indexOf(r)&&(this.typeMap.push(r),this.sampleRscId.push(e.resourceid)),-1===this.typeMapThumbs.indexOf(i)&&(this.typeMapThumbs.push(i),this.thumbsRscId.push(e.resourceid))}return t},pgpOutputs:function(e){return void 0!==e.pgp_output},paths:function(e){return void 0!==e.Path}},OFW:{instances:function(e){return void 0!==e.to},references:function(e){return void 0===e.to&&void 0!==e.resourceid},pgpOutputs:function(e){return void 0!==e.pgp_output}}};var i={divideAndConquer:function(e,t,n){var r={},i=t.timeoutObj,o=Object.keys(n),s=o.length;for(let a=0;a<s;a++){let s=o[a],d=n[s];r[s]=e.filter(d,t),i&&i.check()}return r},node:{setFilterBadge:function(t){let n=e.clone(t.options.icons[0]);n.badges={bottomRight:{iconName:"filter",fontIconSize:"1x",className:"dgv-badge"}};let r={icons:[n]};t.updateOptions(r)},clearBadges:function(t){if(t.options&&t.options.icons){var n=e.clone(t.options.icons[0]);n.badges={bottomRight:null},t.updateOptions({icons:[n]})}},clearChildComputed:function(e){let n=e.getAllDescendants();t.iterate(n,function(e){e.isRelationsObjectGroupingNode||(delete e.options.childComputed,delete e.childComputed)})},updateSpecificColumnViews:function(e,t,n){let r=Object.keys(t);for(let i=0;i<r.length;i++)t[r[i]].updateAttributesDelayed(e,n,this)},extractResAndRel:function(e){let t=e.getID(),n=e.getRelationID();return e.isRoot()&&(n=void 0),{resid:t,relid:n}}},data:{jsonParse:function(e){return"string"==typeof e?JSON.parse(e):e}},array:{compare:function(e,t){if(e instanceof Array&&t instanceof Array){var n=e.length;if(n===t.length){for(var r=0;r<n;r++)if(e[r]!==t[r])return!1;return!0}return!1}return!1},unique:function(e,t){-1===e.indexOf(t)&&e.push(t)}}};return Object.defineProperties(i,{MAPS:{get:function(){return r}}}),i}),define("DS/ENOXParser/modules/mixins/parser/ParseFetch",["DS/ENOXParser/modules/common/Constants","DS/PADServices/utils/HideShowController","DS/PADServices/utils/DictionaryAccess","DS/PADServices/utils/Iterator","DS/PADServices/utils/Meas"],function(e,t,n,r,i){"use strict";function o(e,t,n,r){let i=n;return r&&(i=e.filterAttributesForUpdate({node:t,opts:i})),i&&0===i.relcount&&(i.children=null),i}function s(){}return s.prototype={parseFetch:function(e){var r=i.addOrGetSection("parser");return r.start("parseFetch",{stats:!0}),new Promise(function(i,o){var s=e.treeDoc;s.withTransactionUpdate(function(){for(var o=0;o<e.results.length;o++){let r=this.parseAttributes(e.results[o].attributes);t.defaultHiddenState(r);let i=new e.nodeModelClass(r);s.addRoot(i);let a=s.getRoots().length;s.getModelEvents().publish({event:"onRootAdded",data:{nb_root:a,added_node:i}}),n.updateNLS(i)}r.end("parseFetch"),i()}.bind(this))}.bind(this))},parseMultiFetch:function(e){let t=this;return new Promise(function(i,o){var s=e.treeDoc;s.withTransactionUpdate(function(){r.iterate(e.results,function(e){var i=t.parseAttributes(e.attributes),o=s.getNodesById(i.resourceid);if(o.length)r.iterate(o,function(e){e.updateOptions(i),n.updateNLS(e)});else{var a=s.getNodesByRelId(i.resourceid);a.length&&(delete i.resourceid,r.iterate(a,function(e){e.updateOptions(i),n.updateNLS(e)}))}})}),i()})},refreshFetch:function(n){let i=this;return new Promise(function(o,s){let a=n.roots,d=n.wsResponse.results;d?(r.iterate(d,function(t){let n=i.parseAttributes(t.attributes),r=function(e){let t=a.filter(function(t){return t.getID()===e});return t.length?t[0]:null}(n.resourceid);r&&(r.setState(e.NODE_STATES.COLLAPSED),r.options.childComputed=!1,r.options.children||(r.options.children=[],n.children=[]),i.options.modules.NodeUtils.refreshForRoot(r,n),r.queueNls())}),t.clearHiddenState(a),o()):o()})},refreshNodes:function(t){let n=this;return new Promise(function(i,s){let a=!1;t.treeDoc.filterAttributesForUpdate&&(a=!0);let d=[],l=[],c=(t.wsResponse.results,new Map);r.iterate(t.wsResponse.results,function(e){let t=function(e){let t="";return r.iterateControl(e.attributes,function(e){if("resourceid"===e.name)return t=e.value,{break:!0}}),t}(e),i=n.parseAttributes(e.attributes);c.set(t,i)}),r.iterateMap(c,function(n,i){if(t.refreshParameters.created&&-1!==t.refreshParameters.created.indexOf(i)){var s=t.treeDoc.createNodeModel(n);t.treeDoc.addRoot(s),s.queueNls(),t.treeDoc.getModelEvents().publish({event:"onRootAdded",data:{nb_root:t.treeDoc.getRoots().length,added_node:s}}),d.push(s),l.push(s.getID())}else if(t.refreshParameters.modified&&-1!==t.refreshParameters.modified.indexOf(i)){let s=t.treeDoc.getRoots();r.iterate(s,function(s){let a=s.getNodesById(i);if(a.length)r.iterate(a,function(r){r.updateOptions(o(t.treeDoc,r,n)),r.queueNls(),null===r.options.children&&r.setState(e.NODE_STATES.NO_CHILDREN),d.push(r)});else{let e=s.getNodesByRelId(i);r.iterate(e,function(e){var r=o(t.treeDoc,e,n);delete r.resourceid,e.updateOptions(r),e.queueNls(),d.push(e)})}var l=t.treeDoc.searchRootById(i);if(l)l.updateOptions(o(t.treeDoc,l,n)),l.queueNls(),0===l.options.relcount&&l.setState(e.NODE_STATES.NO_CHILDREN),t.treeDoc.getModelEvents().publish({event:"onRootAdded",data:{nb_root:t.treeDoc.getRoots().length,added_node:l}}),d.push(l);else if(t.refreshParameters.relationids&&-1!==t.refreshParameters.relationids.indexOf(i)){let e=t.treeDoc.getRoots();r.iterate(e,function(e){let t=e.getNodesByRelId(i);r.iterate(t,function(e){e.updateOptions({relationOrder:n.relationOrder}),e.queueNls();let t=e.getParent(),i=e.getBrothers(),o=t.getChildren();o.length>1&&r.iterate(i,function(n){if(n.options.relationOrder>relid.options.relationOrder){let r=o.indexOf(e);if(o.indexOf(n)<r){let e=t.removeChild(relid);t.insertBefore(e,n)}}}),d.push(e)})})}})}}),d.length&&t.treeDoc.fillAttributesAsync(d),i()})}},s}),define("DS/ENOXParser/modules/mixins/parser/ParseAttributes",["DS/PADServices/settings/AppSettings","DS/PADServices/utils/AttributesMgtV2","DS/ENOXParser/modules/common/Constants","DS/ENOXParser/modules/Numbers","DS/PADServices/utils/Meas","DS/PADServices/utils/Iterator","DS/PADServices/utils/IconMgt"],function(e,t,n,r,i,o,s){"use strict";function a(e){return UWA.is(e,"string")?"true"===e.toLowerCase():UWA.is(e,"boolean")?e:void 0}function d(e,t){e.padgrid||(e.padgrid={}),e.padgrid["ds6w:globalType"]=t}function l(e,t,n){let r=e.grid[t];if(void 0!==r){let i=[r];i.push(n),e.grid[t]=i}else Array.isArray(r)?r.push(n):e.grid[t]=n}function c(){}return c.prototype={checkNotIdentity:r.checkNotIdentity,parseAttributes:function(e){for(var n=i.buildOrGetSection("parser.parseAttributes"),r=n.create("overall",{stats:!0}),s=t.getTreeColumn(),c=t.getColumnsOrder(),u={resourceid:"",ensureNLS:!0,grid:{}},p=void 0,f=0;void 0===p&&f<e.length;f++)"ds6w:globaltype"===e[f].name.toLowerCase()&&(p=e[f].value);if(void 0===p&&(p=""),"ds6w:Instance"!==p&&""!==p){let t=n.create("ref",{stats:!0});o.iterate(e,function(e){if("type"===e.name)e.name="ds6w:type";else{var t=e.name.split("/");e.name=t[t.length-1]}switch(UWA.is(e.value)&&UWA.is(e.value.replace,"function")&&(e.value=e.value.replace(/\n/g," "),"FALSE"!==e.value.toUpperCase()&&"TRUE"!==e.value.toUpperCase()||(e.value="TRUE"===e.value.toUpperCase())),e.name.toLowerCase()){case s:u.label=e.value,u.display=u.label;break;case"ds6w:type":u.grid||(u.grid={}),u.grid[e.name]=e.value,u.type=e.value;break;case"resourceid":case"physicalid":u.resourceid=e.value;break;case"did":u.did=e.value;break;case"type_icon_url":u.icons||(u.icons=[]),u.icons.push({iconPath:"url("+e.value+")",className:"dgv-icons"});break;case"preview_url":case"thumbnail_2d":u.thumbnail=e.value,u.grid||(u.grid={}),u.grid.thumbnail=e.value;break;case"ds6w:globaltype":u.grid||(u.grid={}),u.grid.globaltype=e.value,d(u,e.value);break;default:c&&-1!==c.indexOf(e.name)?(u.grid||(u.grid={}),l(u,e.name,e.value)):(u.padgrid||(u.padgrid={}),"bo.pgpshowextension.v_pgp_show"===e.name.toLowerCase()?u.isPADHidden=!a(e.value):(u.grid||(u.grid={}),u.padgrid[e.name]=e.dispValue?e.dispValue:e.value,l(u,e.name,e.dispValue?e.dispValue:e.value)))}}),t.end()}else{let t=n.create("inst",{stats:!0});o.iterate(e,function(e){switch(e.name.toLowerCase()){case"ds6w:type":u.grid||(u.grid={}),u.grid[e.name+"-Instance"]=e.value,u.type=e.value;break;case"resourceid":case"physicalid":u.resourceid=e.value;break;case"treeOrder":case"ro.plminstance.v_treeorder":u.relationOrder=parseFloat(e.value),isNaN(u.relationOrder)&&(u.relationOrder=-1);break;case"matrixtxt":this.checkNotIdentity(e.value)&&(u.grid||(u.grid={}),u.grid["positionMatrix-Instance"]=e.value);break;case"ds6w:globaltype":u.grid||(u.grid={}),u.grid.globaltypeInstance=e.value,d(u,e.value);break;default:c&&-1!==c.indexOf(e.name+"-Instance")?(u.grid||(u.grid={}),u.grid[e.name+"-Instance"]=e.value):(u.padgrid||(u.padgrid={}),"ro.pgpshowextension.v_pgp_show"===e.name.toLowerCase()?u.isPADHidden=!a(e.value):(u.grid||(u.grid={}),u.padgrid[e.name+"-Instance"]=e.dispValue?e.dispValue:e.value,u.grid[e.name+"-Instance"]=e.dispValue?e.dispValue:e.value))}}),t.end()}return u.relationOrder||(u.relationOrder=-1),u.grid||(u.grid={}),r.end(),u},parseNodeOptions:function(e,r){var i=t.getTreeColumn(),l=t.getColumnsOrder(),c={resourceid:"",ensureNLS:!0,grid:{}},u=this;if(o.iterateObj(e.node,function(e,t){if(r)switch(t.toLowerCase()){case"resourceid":c.relationid=e;break;case"from":c.from=e;break;case"to":c.resourceid=e;break;case"matrixtxt":u.checkNotIdentity(e)&&(c.grid["positionMatrix-Instance"]=e);break;case"ds6w:type":c.type=e,c.grid[t+"-Instance"]=e;break;case"ro.plminstance.v_treeorder":c.relationOrder=parseFloat(e),isNaN(c.relationOrder)&&(c.relationOrder=-1);break;case"ro.pgpshowextension.v_pgp_show":c.isPADHiddenInstance=!a(e);break;case"ds6w:islastrevisionperstate":case"ds6wg:plmreference.v_islastversion":c.grid[t]=a(e);break;default:let n=t+"-Instance";l&&l.includes(n)&&(c.grid[n]=e)}else switch(t.toLowerCase()){case"resourceid":c.resourceid=e;break;case i:c.label=e;break;case"ds6w:type":c.type=e,c.grid[t]=e;break;case"icon":case"type_icon_url":if(!s.isActive()){void 0===c.icons&&(c.icons=[]);let t=e;c.icons.push({iconPath:"url("+t+")",className:"dgv-icons"})}break;case"thumbnail":case"thumbnail_2d":c.thumbnail=e,c.grid.thumbnail=e;break;case"ds6w:globaltype":c.globaltype=e,d(c,e);break;case"bo.pgpshowextension.v_pgp_show":c.isPADHiddenReference=!a(e);break;case"ds6w:islastrevisionperstate":case"ds6wg:plmreference.v_islastversion":c.grid[t]=a(e);break;default:"ds6w:cadmaster"===t&&(t="ds6w:cadMaster"),l&&l.includes(t)&&(c.grid[t]=e)}}),!r)if(c.children=[],void 0===c.icons){if(s.isActive()){c.icons=[];let t=s.buildKey(e.node);var p=s.getIcon(t);p&&c.icons.push({iconPath:p})}}else if(void 0===c.thumbnail)if(s.isActive()){let t=s.buildThumbKey(e.node),n=s.getThumbnail(t);n&&(c.thumbnail=n,c.grid.thumbnail=n)}else c.thumbnail=c.icons[0].iconPath.replace("fileType=ICON","fileType=THUMBNAIL_2D"),c.thumbnail=c.thumbnail.substring(4,c.thumbnail.length-1),c.grid.thumbnail=c.thumbnail;return n.GLOBALTYPE_DOC===c.globaltype&&(c.children=null),c},parseGroupingNodeOptions:function(e,n){t.getTreeColumn();var r={resourceid:"",ensureNLS:!0,grid:{}};r.icons=e.icons,r.children=[],r.thumbnail="";return o.iterateObj(e,function(e,t){switch(t.toLowerCase()){case"resourceid":r.resourceid=e;break;case"label":r.label=e;break;case"icon":void 0===r.icons&&(r.icons=[]),r.icons.push({iconPath:"url("+e+")",className:"dgv-icons"});break;case"thumbnail":r.grid.thumbnail=e;break;case"ds6w":r.ds6w=e;break;case"disptext":r.dispText=e;break;case"grid":r.grid=e;break;case"grp":r.grp=e;break;case"grpselected":r.grpSelected=e;break;case"kind":r.kind=e;break;case"isother":r.isOther=e}}),r}},c}),define("DS/ENOXParser/modules/common/LoadModelBuilder",["UWA/Core","DS/ENOXParser/modules/common/Constants","DS/PADServices/utils/Iterator","DS/PADServices/utils/Meas","DS/PADServices/utils/HideShowController"],function(e,t,n,r,i){function o(e,t){return e.relationOrder-t.relationOrder}function s(e){for(var t=[],n=[],r=[],i=[],s=0;s<e.length;s++){var a=e[s];switch(a.globaltype){case"ds6w:Instance":case"ds6w:Document":n.push(a);break;case"ds6w:Part":t.push(a);break;default:r.push(a)}}return n.sort(o),t.sort(o),r.sort(o),i=(i=(i=i.concat(n)).concat(t)).concat(r)}function a(e,n){if(e.isGroupingNode)return void(e.expandedState=t.NODE_STATES.EXPANDED.state);let r=n.findInCtx,i=(n.filter,n.expandAll);if(e.children&&e.children.length)if(1===e.children.length){let n=e.children[0];n.globaltype===t.GLOBALTYPE_DOC?e.expandedState=t.NODE_STATES.COLLAPSED.state:r?(e.expandedState=t.NODE_STATES.PARTIALLY_EXPANDED.state,n.expandedState=t.NODE_STATES.PARTIALLY_EXPANDED.state):e.expandedState=t.NODE_STATES.EXPANDED.state}else e.expandedState=r?t.NODE_STATES.PARTIALLY_EXPANDED.state:t.NODE_STATES.EXPANDED.state;else i&&(e.children=null,e.expandedState=t.NODE_STATES.NOCHILDREN.state)}function d(e){let t=new Map;for(let n=0;n<e.length;n++){let r=e[n];if(r.children&&r.children.length)for(let e=0;e<r.children.length;e++){let n=r.children[e],i=n.resourceid+"_"+n.relationid;t.has(i)||t.set(i,n)}}let r=[];return n.iterateMap(t,function(e,t){r.push(e)}),r.length?r:void 0}function l(e,t,n){result=-1,found=!1;let r=e+1;if(n){if(n.resourceid===t&&(found=!0),found)return r;{recurseFound=!1;let e=n.children;if(e&&e.length)for(let n=0;n<e.length;n++){let i=l(r,t,e[n]);if(-1!==i){result=i,recurseFound=!0;break}}return result}}return result}function c(e){this.options=e,this._parentLookup=new Map,this._arraysOfReferences=new Map,this._correctionList=[],this._orderList=[]}return c.prototype={addChild:function(t,n,r){var i=this._parentLookup.get(t);if(i){var o;(o=i).children||(o.children=[]),this.options.addPaths||r&&"noChildComputed"===r.mode||(i.childComputed=!0);var s=e.clone(n);i.children.push(s),this.options.expandAll&&(s.childComputed=!0);var a,d,l=this._arraysOfReferences.get(s.resourceid);l||(l=[]),l.push(s),l.length>1?this._correctionList.push(s.resourceid):(a=this._orderList,d=i,-1===a.indexOf(d)&&a.push(d)),this._arraysOfReferences.set(s.resourceid,l),this._parentLookup.set(s.resourceid,s)}else console.warn("LoadModelBuilder.addChild unknown parent")},addReference:function(e){this._parentLookup.set(e.resourceid,e)},getReference:function(e){return this._parentLookup.get(e)},getOptions:function(t,n){if(t&&n){let r=this._arraysOfReferences.get(t);if(!r)return e.clone(this._parentLookup.get(t));{let e=r.filter(function(e){return e.relationid===n});if(e.length)return e[0]}}else if(t)return this._parentLookup.get(t)},correct:function(e){r.addOrGetSection("parser");if(!this.options.isRefresh)for(let e=0;e<this._orderList.length;e++){var i=this._orderList[e];i.children.length>1&&(i.children=s(i.children))}this.options.expandIds&&function(e,t,n){const r=n,i=e.map(function(e){return r.get(e)});t.sort(function(e,t){let n,r;for(let o=0;o<i.length;o++){const s=i[o];let a=l(0,e,s),d=l(0,t,s);if(-1!==a&&(n=a),-1!==d&&(r=d),-1!==a&&-1!==d)break}return n>r?-1:n<r?1:0})}(this.options.expandIds,this._correctionList,this._parentLookup);let o=[];for(let t=0;t<this._correctionList.length;t++){let n=this._correctionList[t],r=this._arraysOfReferences.get(n),i=d(r);for(var c=0;c<r.length;c++){let t=r[c];i&&(t.children=e.assignClone(i),o.push(t))}}let u=this.options;n.iterateMap(this._arraysOfReferences,function(e){n.iterate(e,function(e){if(a(e,u),e.children&&1===e.children.length){var n=e.children[0];n.globaltype===t.GLOBALTYPE_DOC&&(e.grid.thumbnail=n.grid.thumbnail)}})}),n.iterate(o,function(e){!function e(t,r){a(t,r),t.children&&n.iterate(t.children,function(t){e(t,r)})}(e,u)})},correctPgpOcc:function(e,t){for(let o of t.keys()){let s=this._parentLookup.get(o[0]);for(var n=0;n<o.length;n+=2)if(s.children)for(var r=0;r<s.children.length;r++)if(s.children[r].relationid===o[n+1]){s=s.children[r];break}s.isPADHidden=t.get(o),i.defaultHiddenState(s),s.isHiddenState===i.STATES.HIDDEN&&(e.isHiddenState=!0)}}},c}),define("DS/ENOXParser/modules/mixins/parser/ExpandV2LoadModel",["DS/ENOXParser/modules/common/LoadModelBuilder","DS/ENOXParser/modules/common/OfwBuilder","DS/ENOXParser/modules/common/Constants","DS/PADServices/utils/HideShowController","DS/WebappsUtils/WebappsUtils","DS/PADServices/utils/IconMgt","DS/ENOXParser/modules/common/Helpers","DS/ENOXParser/modules/common/Timeout","DS/PADServices/utils/DictionaryAccess","DS/PADServices/settings/AppSettings","DS/PADServices/utils/Iterator","DS/PADServices/utils/Generics","DS/PADServices/utils/Meas","DS/PADServices/utils/GlobalModelEvents","DS/PADUtils/PADSession"],function(e,t,n,r,i,o,s,a,d,l,c,u,p,f,h){const g={loadingicon:"url("+i.getWebappsAssetUrl("ENXNav","icons/32/loading22x22.gif")+")",loadingthumbnail:i.getWebappsAssetUrl("ENXNav","icons/32/loading.gif")},D={timeoutObj:new a(void 0)};function v(e,t,n){var r=e.getNodesById(t.resourceid);if(r){for(let e=0;e<r.length;e++){let n=r[e],i=s.node.extractResAndRel(n);t.resourceid===i.resid&&t.relationid===i.relid&&(n.updateOptions(t),d.updateNLS(n),delete n.options.waiting4validation)}return r}if(n){let e=n.addChild(t);d.updateNLS(e)}else console.error("we could not find node and we are supposed to create child.")}function m(e){let t=e.getParent();for(;t&&!t.isRoot();)t.setState(n.NODE_STATES.PARTIALLY_EXPANDED),t=t.getParent()}function b(e,t){-1===e.indexOf(t)&&e.push(t)}function S(e,t,r){let i=function(e,t,r){let i=t.getDepth(),o=e.search({match:function(e){let t=e.nodeModel,o=t.getState(),s=t.getDepth(),a=s>=i&&s-i<=r;return o===n.NODE_STATES.PARTIALLY_EXPANDED.state&&a},useTransaction:!1});return{startDepth:i,matched:o}}(e,t,r);c.iterate(i.matched,function(e){e.getDepth()-i.startDepth===r?e.setState(n.NODE_STATES.COLLAPSED):e.hasChildren()?e.setState(n.NODE_STATES.EXPANDED):e.setState(n.NODE_STATES.COLLAPSED)})}const A=function(e,t){return e.originalIndex-t.originalIndex};function N(){this._list=[],this._dict={},this._cleanup=[]}function E(e,t){let r=e.getTreeDocument(),i=e.getChildren(),o=i?i.filter(function(e,t){return!0!==e.isRelationsObjectGroupingNode}):[],s=o.slice();if(s.length){let i=o.filter(function(e){return-1===s.indexOf(e)}),a=[],d=new N;c.iterate(s,function(e){let r=e.getID(),i=e.getRelationID()?e.getRelationID():void 0;t.children&&c.iterate(t.children,function(t,o){t.resourceid===r&&t.relationid===i?(a.push(o),t.children&&t.children.length&&(e.hasChildren()?function e(t,n){let r=n.getChildren();r||(r=[]);let i=r.map(function(e){let t=e.getID(),n=e.getRelationID();return n||(n=void 0),{resid:t,relid:n,node:e}});c.iterate(t.children,function(t){let r=function(e,t){let n=null;for(let r=0;r<e.length;r++){let i=e[r];if(i.resid===t.resourceid&&i.relid===t.relationid){n=i;break}}return n}(i,t);r?e(t,r.node):n.addChild(t)})}(t,e):(e.addChild(t.children),e.setState(n.NODE_STATES.EXPANDED)))):a.length?d.addAfter(t,e.getParent(),e,o):d.addBefore(t,e.getParent(),e,o)}),d.cleanup(t.children,a),c.iterate(a,function(e){t.children.splice(e,1)}),a.length=0}),c.iterate(i,function(t){e.removeChild(t)}),d.dispatch(r)}else for(var a=0;a<o.length;a++){let t=o[a];e.removeChild(t)}}function O(e,t){let r=e.getState();if(!0===e.options.retrievedFromFocus?(delete e.options.retrievedFromFocus,"expanding"===e.getState()&&e.setState(n.NODE_STATES.EXPANDED)):r!==t.expandedState&&e.setState({state:t.expandedState}),e.hasChildren()){let n=e.getChildren();n&&c.iterate(n,function(e){let n=e.getID(),r=e.getRelationID();r||(r=void 0);let i=function(e,t,n){let r;return c.iterate(e.children,function(e){e.resourceid===t&&e.relationid===n&&(r=e)}),r}(t,n,r);i&&O(e,i)})}}function P(e,t,r){e.expandedState=t>r?n.NODE_STATES.EXPANDED.state:n.NODE_STATES.COLLAPSED.state,e.children&&c.iterate(e.children,function(e){P(e,t,r+1)})}function _(e){var t=e.getChildren();for(t=t||[];t.length;){let n=t[0];e.removeChild(n)}}function x(e,t){let n;for(let r=0;r<e.length;r++){if(n=e[r].getNodeByPath(t,void 0,void 0,!0))return n}return n}function I(e){return{typeMap:[],typeMapThumbs:[],sampleRscId:[],thumbsRscId:[],timeoutObj:e}}function y(e){let t=e.getChildren();return(t?t.filter(function(e,t){return!0!==e.isRelationsObjectGroupingNode}):[]).length>0}function C(e,t,n){let r;for(let i=0;i<e.length;i++){let o=e[i];if(o.getID()===t&&o.getRelationID()===n){r=o;break}}return r?{isFound:!0,node:r,index:e.indexOf(r)}:{isFound:!1}}function w(){}return N.prototype={_add:function(e,t,n,r,i){let o=this._getKeyFromData(e);if(void 0!==this._dict[o]){let e=this._dict[o],t=this._list[e];"before"===i&&(t.goal=i,t.originalIndex=r,t.siblingChild=n)}else{let s={goal:i,originalIndex:r,parentNode:t,siblingChild:n,childData:e};this._list.push(s),this._dict[o]=this._list.length-1}},_getKeyFromData:function(e){let t,n=e.resourceid,r=e.relationid;return r?t=n+"_"+r:(r=void 0,t=n),t},addBefore:function(e,t,n,r){this._add(e,t,n,r,"before")},addAfter:function(e,t,n,r){this._add(e,t,n,r,"after")},cleanup:function(e,t){let n=t.map(function(t){return e[t]}),r=this;this._cleanup=this._cleanup.concat(n.map(function(e){let t=r._getKeyFromData(e),n=r._dict[t];return void 0!==n?{found:!0,index:n,key:t}:{found:!1}}))},dispatch:function(e){let t=this._cleanup.filter(function(e){return e.found});if(t.length){let e=this;t.sort(function(e,t){return t.index-e.index}),c.iterate(t,function(t){e._list.splice(t.index,1),delete e._dict[t.key]})}if(this._list.length){let t=s.divideAndConquer(this._list,D,{befores:function(e){return"before"===e.goal},afters:function(e){return"after"===e.goal}});t.befores.sort(A),t.afters.sort(A),c.iterate(t.befores,function(t){let n=t.childData,r=t.siblingChild._getLocalID();e.withTransactionUpdate(function(){t.parentNode.addChild(n,r)})}),c.iterate(t.afters,function(t){let n=t.childData;e.withTransactionUpdate(function(){t.parentNode.addChild(n)})})}}},w.prototype={parseExpandLoadModel:function(t){let i=p.buildOrGetSection("parser.expandLoadModel"),g="parseExpandLoadModel_"+(-1===t.expandLevel?"expandAll":"expand"+t.expandLevel),D=i.create(g,{stats:!0}),v=this;return new Promise(function(p,g){let b=new Map,A=t.expandedNode,N=t.wsResponse.results,w=t.treeDoc.isGroupingApplied(),T=[];T=A?[A]:t.expandedNodes;let R=new e({expandIds:T.map(function(e){return e.getID()}),expandAll:-1===t.expandLevel,findInCtx:!0===t.findInCtx||!0===t.selectFromTagger,filter:!0===t.filter}),L=l.getSetting("parse_timeout"),M=parseInt(L),k=new a(M),X=I(k);if(N){let e=s.divideAndConquer(N,X,s.MAPS.EXPANDV2),a=new Map;var H=Promise.resolve();o.isActive()&&(H=o.initializeIconMap({typeMap:X.typeMap,typeMapThumbs:X.typeMapThumbs,thumbsRscId:X.thumbsRscId,rscIds:X.sampleRscId})),H.then(function(){c.iterate(e.pgpOutputs,function(e){k.check(),e.pgp_output.pgp_hide&&c.iterate(e.pgp_output.pgp_hide,function(e){a.set(e,!0)}),e.pgp_output.pgp_show&&c.iterate(e.pgp_output.pgp_show,function(e){a.set(e,!1)})}),c.iterate(e.references,function(e){if(k.check(),v.__processReference({node:e,nodesMap:b,builder:R}),w){var n=t.treeDoc.getGroupingNodesList(e.resourceid);c.iterate(n,function(e){v.__processGroupingNode({node:e,parent:e.getParent().getID(),nodesMap:b,builder:R})})}}),c.iterate(e.instances,function(e){k.check(),v.__processInstance({node:e,nodesMap:b,builder:R,expandLevel:t.expandLevel,mode:t.mode,pgpHideOccurrencesMap:a,treeDoc:t.treeDoc,expandedNodes:T})}),t.treeDoc.clearCachedHiddenNodes();var o=i.create("builder_Correct",{stats:!0});if(R.correct(v),R.correctPgpOcc(v,a),o.end(),c.iterate(T,function(e){let o=s.node.extractResAndRel(e);var a=R.getOptions(o.resid,o.relid);let l=!1,p=!0;a&&t.filter&&t.expandLevelRequest!==t.expandLevel?(P(a,t.expandLevelRequest,0),y(e)?(O(e,a),l=!0,E(e,a),S(t.treeDoc,e,t.expandLevel)):0!==t.expandLevelRequest&&(l=!0,function e(t,n){c.iterate(t.children,function(t){let r=n-1;0===r?t.children&&(t.children.length=0):e(t,r)})}(a,t.expandLevelRequest),e.addChild(a.children))):y(e)&&t.filter&&a&&(O(e,a),l=!0,E(e,a),S(t.treeDoc,e,t.expandLevel));let f=!1;if(a&&e.hasChildren()&&y(e)&&0!==t.expandLevel&&(!t.findInCtx&&!t.selectFromTagger&&!t.filter||w)){var g=i.create("treenodemodel_removeChildren",{stats:!0});-1!==t.expandLevel||w?(f=!0,l=!0,E(e,a),S(t.treeDoc,e,t.expandLevel)):(!function(e,t){let n=e.getChildren(),r=n?n.filter(function(e,t){return!0!==e.isRelationsObjectGroupingNode}):[];t.children.sort(function(e,n){let i=C(r,e.resourceid,e.relationid),o=C(r,n.resourceid,n.relationid);return i.isFound&&o.isFound?(i.dataIndex=t.children.indexOf(e),o.dataIndex=t.children.indexOf(n),i.dataIndex===i.index&&o.dataIndex===o.index?0:i.index>o.index?1:i.index<o.index?-1:void 0):0})}(e,a),_(e)),g.end()}if(e.hasChildren()&&(t.findInCtx&&t.isFindDialog||t.selectFromTagger)&&(!function e(t,n){let r=function(e){let t=e.getChildren();return t||(t=[]),t.filter(function(e,t){return!0!==e.isRelationsObjectGroupingNode})}(t).map(function(e,t){let n=e.getID(),r=e.getRelationID();return r||(r=void 0),{resid:n,relid:r,node:e,nodeIndex:t}}),i=[];n.children&&n.children.length&&(i=n.children.map(function(e,t){let n={childOpts:e,childIndex:t},i=r.filter(function(t){return t.resid===e.resourceid&&t.relid===e.relationid});return i.length&&(n.finders=i),n})),c.iterate(i,function(n){if(n.finders){if(1===n.finders.length){let t=n.finders[0],r=u.clone(n.childOpts);delete r.children,t.node.updateOptions(r),e(t.node,n.childOpts)}}else t.addChild(n.childOpts,n.childIndex)})}(e,a),l=!0),a){let i;if(l||(-1!==t.expandLevel&&t.filter&&(_(e),P(a,t.expandLevelRequest,0)),a.children&&(i=a.children,delete a.children),r.cleanupOptions(e,a),null===a.children&&function(e){let t=e.getChildren();return(t?t.filter(function(e,t){return!0===e.isRelationsObjectGroupingNode}):[]).length>0}(e)&&(p=!1,delete a.children),e.updateOptions(a)),d.updateNLS(e),e.isRoot()){!0!==t.FBIProxy.HasFilter(e.getID()).hasFilter||h.isAuthoring()?s.node.clearBadges(e):s.node.setFilterBadge(e)}if(!l)if(i){t.treeDoc.withTransactionUpdate(function(){t.treeDoc.loadModel(i,e),f&&S(t.treeDoc,e,t.expandLevel),e.getRoot().cleanUpPathes()})}else p&&(e.updateOptions({children:null}),e.setState(n.NODE_STATES.NOCHILDREN));if(v.isHiddenState||r.shouldeRecalculate(e)){delete v.isHiddenState;let e=[];t.treeDoc.processDescendants({processNode:function(){r.gatherParentsIfHidden(e,this)}}),r.calculateParents(e,!0)}}}),!0===t.selectPaths){var l=i.create("selectPaths",{stats:!0});c.iterate(e.paths,function(e){if(e.matching_lengths)for(let n=0;n<e.matching_lengths.length;n++){var r=e.Path.slice(0,e.matching_lengths[n]);(i=x(T,r))?(i.select(),i.isRoot()||!t.findInCtx&&!t.selectFromTagger||m(i)):console.warn("Unknown path "+JSON.stringify(r))}var i;(i=x(T,e.Path))?(i.select(),(t.findInCtx||t.selectFromTagger)&&(i.hasChildren()&&i.setState(n.NODE_STATES.PARTIALLY_EXPANDED),i.isRoot()||m(i))):console.warn("Unknown path "+JSON.stringify(e))}),l.end()}D.end(),f.publish({event:"ENXModel/Expand/parseDone"}),p()}).catch(function(e){g(e)})}})},addPathsUpdateTempNodes:function(t){let n=p.addOrGetSection("parser"),i=n.create("parseExpandLoadModel",{stats:!0}),d=this;return new Promise(function(l,u){let p=new Map,f=t.wsResponse.results,h=new e({expandAll:-1===t.expandLevel,addPaths:!0});if(t.wsResponse.timeoutOccurs)console.warn("Timeout occurs on popluating temp nodes....failure path...");else{let e=I(new a(void 0)),u=s.divideAndConquer(f,e,s.MAPS.EXPANDV2),D=new Map;var g=Promise.resolve();o.isActive()&&(g=o.initializeIconMap({typeMap:e.typeMap,typeMapThumbs:e.typeMapThumbs,thumbsRscId:e.thumbsRscId,rscIds:e.sampleRscId})),g.then(function(){c.iterate(u.references,function(e){d.__processReference({node:e,nodesMap:p,builder:h})}),c.iterate(u.instances,function(e){d.__processInstance({node:e,nodesMap:p,builder:h,expandLevel:t.expandLevel})}),n.start("builder_Correct",{stats:!0}),h.correct(d),h.correctPgpOcc(d,D),n.end("builder_Correct");let e=[],o=[];t.treeDoc.withTransactionUpdate(function(){c.iterate(t.idsToFetch,function(n){var i=n;let a=t.treeDoc.getNodesById(i);c.iterate(a,function(n){let a=s.node.extractResAndRel(n),d=h.getOptions(a.resid,a.relid);if(d){let n=d.children;delete d.children,v(t.treeDoc,d),e.push(i),n&&n.length&&c.iterate(n,function(e){let n=e.children;delete e.children;let i=v(t.treeDoc,e);c.iterate(i,function(e){r.gatherParentsIfHidden(o,e)}),n&&n.length&&c.iterate(i,function(e){!function e(t,n,r){for(let o=0;o<r.length;o++){let s=r[o];var i=s.children;delete s.children,v(t,s,n),i&&e(t,n,i)}}(t.treeDoc,e,n)})})}})}),r.calculateParents(o,!1,!0),!0===t.selectPaths&&c.iterate(u.paths,function(e){t.treeDoc.getNodeByOccurencePath(e)?e.select():console.warn("Unknown path "+JSON.stringify(e))})}),i.end(),l({nodesId:e})})}})},buildTemporaryBranches:function(e){if(!UWA.is(e.treeDoc,"object")||!UWA.is(e.paths,"array"))throw new Error("Invalid input parameters");var t=[],n=[],r=[],i=[],o=[],s=e.treeDoc,a=e.state?e.state:"partiallyExpanded",d=e.paths;let l=this;return s.withTransactionUpdate(function(){d.forEach(function(d){var c,u=null,p=s.getRoots(),f=0;for(c=0;c<p.length&&null===u;c++)if(d[0]===p[c].getID()){i.push(d[0]);var h=(u=p[c]).getNodeByPath(d,void 0,void 0,!0);h&&(u=h,f=d.indexOf(u.getID()))}if(!0===e.temporaryRoot&&null===u){var D={resourceid:d[0],label:l.options.nls.loadingText,icons:[{iconPath:g.loadingicon}],thumbnail:g.loadingthumbnail,alternText:l.options.nls.loadingText,waiting4validation:!0,parseV2:!0};u=new e.nodeModelClass(D),s.addRoot(u),-1===t.indexOf(d[0])&&t.push(d[0]);var v=s.getRoots().length;s.getModelEvents().publish({event:"onRootAdded",data:{nb_root:v,added_node:u}})}if(u)if(u.getID()===d[d.length-1]){if(!0!==e.forceCollapsed&&null!==u.getRoot()){var m=u.reverseExpand({state:a});m.ids.length&&(t=t.concat(m.ids)),m.relids.length&&(o=o.concat(m.relids))}}else for(var S=f+1;S<d.length;S+=2){var A=d[S],N=d[S+1],E={resourceid:N,relationid:A,label:l.options.nls.loadingText,icons:[{iconPath:g.loadingicon}],thumbnail:g.loadingthumbnail,alternText:l.options.nls.loadingText,waiting4validation:!0},O=new e.nodeModelClass(E),P=u.getState();u.addChild(O),"collapsed"===P?(a!==P&&(u.setState({state:a}),u.options.padstate=a),u.childValidationChecker()):"partiallyExpanded"===P&&(u.setState({state:P}),u.options.padstate=P,b(n,N),b(r,A)),u=O,b(t,N),b(o,A)}})}),{ids_to_fetch:t,relationids:o,rootsAlreadyLoaded:i,visibleNodesIds:n,visibleNodesRelIds:r}},ofwPrep:function(e){let n=this;return new Promise(function(r,i){let o=new Map,a=e.wsResponse.results,d=new t({expandAll:-1===e.expandLevel}),l=s.divideAndConquer(a,{},s.MAPS.OFW);c.iterate(l.references,function(e){n.__processReference({node:e,nodesMap:o,builder:d})}),c.iterate(l.instances,function(t){n.__processInstanceOfw({node:t,nodesMap:o,builder:d,expandLevel:e.expandLevel})}),d.correct(n);let u=[];for(let t=0;t<e.rootIds.length;t++){let n=d.getReference(e.rootIds[t]);u.push(n)}r(u)})},refresh:function(t){let n=p.addOrGetSection("parser");n.start("refresh",{stats:!0});let i=this,d=t.roots;t.visibles;return new Promise(function(l,u){let p=new Map,f=t.wsResponse.results,h=new e({expandIds:d.map(function(e){return e.getID()}),expandAll:-1===t.expandLevel,isRefresh:!0});if(!f)return i.processErrors(t.wsResponse.errors,"refresh"),void l();let g=I(new a(void 0)),D=s.divideAndConquer(f,g,s.MAPS.EXPANDV2),v=new Map,m=[];var b=Promise.resolve();o.isActive()&&(b=o.initializeIconMap({typeMap:g.typeMap,typeMapThumbs:g.typeMapThumbs,thumbsRscId:g.thumbsRscId,rscIds:g.sampleRscId})),b.then(function(){c.iterate(D.pgpOutputs,function(e){e.pgp_output.pgp_hide&&c.iterate(e.pgp_output.pgp_hide,function(e){v.set(e,!0)}),e.pgp_output.pgp_show&&c.iterate(e.pgp_output.pgp_show,function(e){v.set(e,!1)})}),c.iterate(D.references,function(e){i.__processReference({node:e,nodesMap:p,builder:h})}),c.iterate(D.instances,function(e){i.__processInstance({node:e,nodesMap:p,builder:h,doNotCalcByChildren:m,expandLevel:t.expandLevel})}),n.start("builder_Correct",{stats:!0}),h.correct(i),h.correctPgpOcc(i,v);for(let n=0;n<d.length;n++){let s=d[n];i.options.modules.NodeUtils.recursiveUpdateForRefresh(t.treeDoc,s,h.getReference(s.getID()));var e=[],o=[];for(let t of v.keys()){let n=s.getNodesById(t[0])[0];if(n){let r=n.getNodeByPath(t);r&&(v.get(t)?e.push(r):o.push(r))}}if(i.isHiddenState){delete i.isHiddenState,r.updateHideShowStatus(e,o);const n=function(e){return{resid:e.options.resourceid,relid:e.options.relationid}};m=m.concat(e.map(n)).concat(o.map(n));let s=[];t.treeDoc.processDescendants({processNode:function(){r.gatherParentsIfHiddenOrShown(s,this)}}),s.sort(function(e,t){return t.getDepth()-e.getDepth()});for(let e=0;e<m.length;e++){let t=m[e],n=s.filter(function(e){return e.options.resourceid===t.resid&&e.options.relationid===t.relid});n.length&&s.splice(s.indexOf(n[0]),1)}r.calculateParents(s,!0)}else r.clearHiddenState(s.getAllDescendants())}n.end("builder_Correct"),n.end("refresh"),l()})})},__processReference:function(e){var t=this.parseNodeOptions(e);t.isPADHidden=t.isPADHiddenReference,e.builder.addReference(t),e.nodesMap.set(t.resourceid,t)},__processGroupingNode:function(e){var t=this.parseGroupingNodeOptions(e.node.options);t.isGroupingNode=!0,e.builder.addReference(t),e.nodesMap.set(t.resourceid,t),e.builder.addChild(e.parent,t,{mode:"noChildComputed"})},__processInstance:function(e){var t=this.parseNodeOptions(e,!0);delete t.type;var i=e.nodesMap.get(t.resourceid),o=this.smartAssign(i,t);if(o.children&&o.children.length&&(o.childComputed=!0),"noChildComputed"===e.mode&&delete o.childComputed,void 0!==e.pgpHideOccurrencesMap){var a=e.pgpHideOccurrencesMap;for(const[e,n]of a.entries()){e[e.length-1]===t.resourceid&&(o.isPADHiddenOccurrence=n)}}void 0!==o.isPADHiddenInstance?(o.isPADHidden=o.isPADHiddenInstance,o.isHiddenStateFrom=r.FROMS.PGP):void 0!==o.isPADHiddenReference?(o.isPADHidden=o.isPADHiddenReference,o.isHiddenStateFrom=r.FROMS.PGP):void 0!==o.isPADHiddenOccurrence&&(o.isPADHidden=o.isPADHiddenOccurrence,o.isHiddenStateFrom=r.FROMS.PGP);let d=!0;if(e.treeDoc){var l=e.treeDoc.getNodesByRelId(e.node.resourceid);if(l.length>0){var c=l[0].options.isHiddenState;c!==r.STATES.HIDDEN&&c!==r.STATES.MIXED||(d=!1,o.isHiddenState=c)}let t=e.treeDoc.options.hiddenNodes;if(t&&t.size>0){let n=e.expandedNodes;for(let i=0;i<n.length;i++){let s=n[i].isRoot()?n[i]:n[i].getRoot(),a=t.get(s);if(a&&a.length>0)for(let t=0;t<a.length;t++)e.node.resourceid===a[t].options.relationid&&(d=!1,o.isHiddenState=r.STATES.HIDDEN)}}}d&&r.defaultHiddenState(o),void 0!==o.isPADHidden&&(e.doNotCalcByChildren&&e.doNotCalcByChildren.push({resid:o.resourceid,relid:o.relationid}),this.isHiddenState=!0);var u=void 0;if(e.treeDoc){if(e.treeDoc.isGroupingApplied()){let t=e.treeDoc.getGroupingNodeV2(e.node.from,o);u=t.groupNode,t.shouldBeNewGroup&&(o._shouldBeNewGroup=!0,o._actualGroupKey=t.actualGroupKey)}}u?(e.nodesMap.get(u.options.resourceid)||(u.options.contentRetrieved=!0,u.options.expandedState=n.NODE_STATES.EXPANDED.state,this.__processGroupingNode({node:u,parent:o.from,nodesMap:e.nodesMap,builder:e.builder})),s.array.unique(e.expandedNodes,u),e.builder.addChild(u.options.resourceid,o)):e.builder.addChild(o.from,o),-1===e.expandLevel&&(o.childComputed=!0)},__processInstanceOfw:function(e){var t=this.parseNodeOptions(e,!0);e.builder.addInstance(t)},processErrors:function(e,t){t||console.warn("please pass context"),c.iterate(e,function(e){e.code})}},w}),define("DS/ENOXParser/modules/TwoDParser",["DS/ENOXParser/modules/mixins/parser/ParseAttributes","DS/ENOXParser/modules/mixins/parser/ParseFetch","DS/ENOXParser/modules/mixins/parser/ExpandV2LoadModel","DS/ENOXParser/modules/mixins/parser/MergeObj"],function(e,t,n,r){"use strict";function i(){}var o;return i.prototype={setup:function(e){return this.options=e,new Promise(function(e,t){e()})}},i.prototype=Object.assign(i.prototype,e.prototype),i.prototype=Object.assign(i.prototype,t.prototype),i.prototype=Object.assign(i.prototype,n.prototype),i.prototype=Object.assign(i.prototype,r.prototype),o||(o=new i),o}),define("DS/ENOXParser/modules/PADParser",["UWA/Core","DS/PADServices/utils/Iterator","DS/ENOXParser/modules/TwoDParser","DS/ENOXParser/modules/common/Constants","DS/PADServices/utils/AttributesMgt","DS/PADServices/utils/DictionaryAccess"],function(e,t,n,r,i,o){const s="ds6w:label-Instance";function a(t,r,i){let o,a,d=t.relationid;if((o=r[t.resourceid])&&((a=n.parseAttributes(o.attributes)).relationid=d,i&&d)){let e=n.parseAttributes(o.attributes);a.grid[s]=e.label}return e.clone(a,!1)}function d(e,t,n,r,i,o){let s,a,d,l,c,u,p,f,h=function(e,t){for(var n={beforeNodes:[],afterNodes:[],afterPosition:-1},r=e.length;r--;){child=e[r];var i=child._options.relationid;if(i===t.after){n.afterNodes=[child],n.afterPosition=r;break}if(i===t.before){n.beforeNodes=[child];break}}return n};for(let r=e.length;r--;)for(let o=(d=t[s=e[r]]).length;o--&&((a=(l=d[o]).getChildren())&&0!==a.length);){p=n[s],u=a[0];for(var g=p.length;g--&&(c=(f=p[g]).resourceid,f.ordering);){var D,v=f.ordering.before,m=f.ordering.after,b=!(!v||""===v),S=!(!m||""===m),A=h(a,f.ordering),N=A.beforeNodes.length>0,E=-1!==A.afterPosition;b&&S?(N&&(i[c]={before:A.beforeNodes}),E&&(D=A.afterPosition+2,i[c]={after:[D]})):b?N?i[c]={before:A.beforeNodes}:u&&(i[c]={before:[u]}):S&&E&&(D=A.afterPosition+2,i[c]={after:[D]})}}}function l(){}let c;return l.prototype={insertNodes:function(t){let n={transactions:[]},l=-1!==i.getAvailableColumns().indexOf(s),c=t.treedocument,u=c.getRoots(),p=t.response.results,f=e.clone(t.insert_parameters,!1),h=Object.keys(f),g={},D={},v={};!function(e,t){for(var n,r,i,o=e.length;o--;)for(var s=(r=(n=e[o]).attributes).length;s--;)if("resourceid"===(i=r[s]).name){t[i.value]=n;break}}(p,D),function(e,t,n){let r,i;for(let o=e.length;o--;){i=e[o];for(let e=t.length;e--;)if((r=t[e].getNodesById(i)).length>0){n[i]=r;break}}}(h,u,g),d(h,g,f,0,v);Date.now();for(var m,b=h.length;b--;){m=h[b];var S=[],A={insertExisting:{modified:[],inserted:[],created:[]}},N=g[m],E=f[m];if(c.withTransactionUpdate(function(){for(var e,t,n=E.length;n--;){node_2_insert=E[n],t=node_2_insert.resourceid,e=a(node_2_insert,D,l);for(var i=N.length;i--;){let n=N[i];var s=new c.options.nodeModelClass(e);if(node_2_insert.ordering){var u=v[t];u?u.before?n.insertBefore(s,u.before[0]):u.after?n.addChild(s,u.after[0]):n.addChild(s):n.addChild(s)}else n.addChild(s);n.options.padstate!==r.NODE_STATES.EXPANDED.state&&(n.setState(r.NODE_STATES.PARTIALLY_EXPANDED),n.options.padstate=r.NODE_STATES.PARTIALLY_EXPANDED.state),n.options.padstate===r.NODE_STATES.NOCHILDREN.state&&(n.setState(r.NODE_STATES.EXPANDED),n.options.padstate=r.NODE_STATES.EXPANDED.state),(n._isExpanded||n._expandState===r.NODE_STATES.EXPANDING.state)&&(n.options.padstate=r.NODE_STATES.EXPANDED.state,n.setState(r.NODE_STATES.EXPANDED)),A.insertExisting.modified.push(n.getID()),A.insertExisting.inserted.push(s.getID()),S.push(s.getRelationID()),A.insertExisting.created.push(s.getRelationID()),A.insertExisting.withContext=!1,o.updateNLS(s),d(h,g,f,0,v)}}}),S.length){var O=[];S.forEach(function(e){var t=c.getNodesByRelId(e);t&&O.push(t[0].getOccurencePath())}),A.insertExisting.inserted=O}n.transactions.push(A)}return n},insertNodes_old:function(t){var r={transactions:[]},s=i.getAvailableColumns(),a=t.treedocument,d=a.getRoots(),l=t.response.results;console.log("replace insert response_results",l);var c,u,p,f=e.clone(t.insert_parameters,!1),h=Object.keys(f),g={},D={},v={};Date.now();function m(){for(var e,t,n,r,i,o,s,a=function(e,t){for(var n={beforeNodes:[],afterNodes:[],afterPosition:-1},r=e.length;r--;){var i=(u=e[r])._options.relationid;if(i===t.after){n.afterNodes=[u],n.afterPosition=r;break}if(i===t.before){n.beforeNodes=[u];break}}return n},d=h.length;d--;){e=h[d];for(var l=(n=g[e]).length;l--&&((t=n[l].getChildren())&&0!==t.length);){o=f[e],i=t[0];for(var c=o.length;c--&&(r=(s=o[c]).resourceid,s.ordering);){var p,D=s.ordering.before,m=s.ordering.after,b=!(!D||""===D),S=!(!m||""===m),A=a(t,s.ordering),N=A.beforeNodes.length>0,E=-1!==A.afterPosition;b&&S?(N&&(v[r]={before:A.beforeNodes}),E&&(p=A.afterPosition+2,v[r]={after:[p]})):b?N?v[r]={before:A.beforeNodes}:i&&(v[r]={before:[i]}):S&&E&&(p=A.afterPosition+2,v[r]={after:[p]})}}}}function b(t){var r,i,o=t.relationid;if((r=D[t.resourceid])&&((i=n.parseAttributes(r.attributes)).relationid=o,-1!==s.indexOf("instanceName")&&o&&D[o])){var a=n.parseAttributes(D[o].attributes);i.grid.instanceName=a.label}return e.clone(i,!1)}!function(){for(var e,t,n=h.length;n--;){t=h[n];for(var r=d.length;r--;)if((e=d[r].getNodesById(t)).length>0){g[t]=e;break}}}(),function(){for(var e,t,n,r,i=l.length;i--;){e=l[i],console.log("insert result",e);for(var o=(t=e.attributes).length;o--;)if("resourceid"===(n=t[o]).name){r=n.value,D[r]=e;break}}}(),m();Date.now();for(var S,A=h.length;A--;){S=h[A];var N=[],E={insertExisting:{modified:[],inserted:[],created:[]}},O=g[S],P=f[S];if(a.withTransactionUpdate(function(){for(var e,t,n=P.length;n--;){t=(p=P[n]).resourceid,e=b(p);for(var r=O.length;r--;){c=O[r];var i=new a.options.nodeModelClass(e);if(p.ordering){var s=v[t];s?s.before?c.insertBefore(i,s.before[0]):s.after?c.addChild(i,s.after[0]):c.addChild(i):c.addChild(i)}else c.addChild(i);"expanded"!==c.options.padstate&&(c.setState({state:"partiallyExpanded"}),c.options.padstate="partiallyExpanded"),"noChildren"===c.options.padstate&&(c.setState({state:"expanded"}),c.options.padstate="expanded"),(c._isExpanded||"expandState"===c._expandState)&&(c.options.padstate="expanded",c.setState({state:"expanded"})),E.insertExisting.modified.push(c.getID()),E.insertExisting.inserted.push(i.getID()),N.push(i.getRelationID()),E.insertExisting.created.push(i.getRelationID()),E.insertExisting.withContext=!1,o.updateNLS(i),m()}}}),r.transactions.push(E),N.length){var _=[];N.forEach(function(e){var t=a.getNodesByRelId(e);t&&_.push(t[0].getOccurencePath())}),r.transactions[0].insertExisting.inserted=_}}return r},insertNodesExpand:function(e){return new Promise(function(i,o){let s=[];t.iterate(e.expandedNodes,function(e){let t=e.getChildren();t&&t.length&&(s=s.concat(t))}),n.parseExpandLoadModel(e).then(function(){t.iterate(e.expandedNodes,function(e){t.iterate(e.getChildren(),function(e){-1===s.indexOf(e)&&e.select()}),e.setState(r.NODE_STATES.PARTIALLY_EXPANDED),delete e.options.childComputed}),i()})})},updateInstances:function(e){var r=[];e.treedocument.withTransactionUpdate(function(){t.iterate(e.response.results,function(i){if(i.attributes){var o="";let s=i.attributes.filter(function(e){return"resourceid"==e.name});s.length&&(o=s[0].value);e.newRelIds&&-1!==e.newRelIds.indexOf(o)&&t.iterate(e.treedocument.getRoots(),function(s){var a=s.getNodesByRelId(o);a.length&&t.iterate(a,function(t){var s=function(t,r){var i=n.parseAttributes(r.attributes);return Generics.checks.function(e.treedocument.filterAttributesForUpdate)&&(i=e.treedocument.filterAttributesForUpdate({node:t,node_opts:i})),i&&0===i.relcount&&(i.children=null),i}(t,i),a=t.getLabel();delete s.resourceid,s.display=a,s.label=a,s.instanceMatrix&&(s.relationid=o,s.grid.instanceMatrix=s.instanceMatrix);var d=t.getState();t.updateOptions(s),PADPredicatesNls.updateNLS(t),d===NODE_STATE.EXPANDED&&t.setState({state:NODE_STATE.PARTIALLY_EXPANDED}),r.push(t)})})}})}),e.editCfg?e.treedocument.refreshCfgValues({relids:e.newRelIds}):r.length&&e.treedocument.fillAttributesAsync(r)}},l.prototype=Object.assign(l.prototype,n),c||(c=new l)});