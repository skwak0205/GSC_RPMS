/*!  COPYRIGHT DASSAULT SYSTEMES 2015   */
function ENXSceneV2(e){"use strict";function t(e){return"string"==typeof e?JSON.parse(e):null}var n=function(e){return UWA.is(e,"string")&&(e=e.replace(/"label":"((\\"|[^"])*)",/gi,"")),e},i=function(e){var t=!1;return UWA.is(e,"boolean")?t=e:UWA.is(e,"string")&&(t="true"===e.toLowerCase()),t};function o(e,t,n,i){let o=new Promise(function(o,s){Promise.all(e).then(function(){i()?require([n],function(e){e.isAdditionalColumnsAvailable(function(n){!0===n&&t.push(e),o()})},o):o()})});o.name="Add-"+n,e.push(o)}var s={widget:null,activeBody:"welcome",xnav_component_opts:{x3dAppId:null,widget:null,active_view:null,action_bar_opts:null,configuration:{toolbarActivated:!1,toolbarOpts:{definition:"ENXScene/assets/configuration/xsceneToolbar.json"},dynamicCtxActivated:!1,ctxMenuOpts:{definition:"ENXScene/assets/configuration/xsceneCtxMenu.json"},commands:{definition:"ENXScene/assets/configuration/xsceneCmds.json"}},layout:{view_customization:null,padshell:!0,withWelcomePanel:!0},amd_custo:{}},xnav_component:null,init:function(e){this.pcsPrefix=widget.id+"_"+widget.title,window.top.performance.mark(this.pcsPrefix+"_init"),window.top.performance.measure(this.pcsPrefix+"_call_init","enxscene_load_html",this.pcsPrefix+"_init"),this.widget=e.widget,e.odt_settings&&(this._odt_settings=e.odt_settings),e.odt_xnavcomponents_opts&&(this.xnav_component_opts=e.odt_xnavcomponents_opts),this.widget.addEvent("onLoad",this.onLoad.bind(this)),this.widget.addEvent("onRefresh",this.onRefresh.bind(this)),this.widget.addEvent("onSearch",this.onSearch.bind(this))},onRefresh:function(){var e=this;require(["DS/PADUtils/PADSettingsMgt"],function(t){!0===t.getSetting("refresh_v2")&&null!==e.xnav_component&&e.xnav_component.refresh()})},onLoad:function(){var e=this;window.top.performance.mark(this.pcsPrefix+"_onload"),window.top.performance.measure(this.pcsPrefix+"_call_onload",this.pcsPrefix+"_init",this.pcsPrefix+"_onload");for(var t=-1,n=widget.preferences.length,i=0;i<n&&-1===t;i++)"storedObjectMgt"===widget.preferences[i].name&&(t=i);-1!==t&&widget.preferences.splice(t,1),this.widget.setValue("tenantAware",!0),null===this.xnav_component&&require(["DS/ENOXInterWdgCom/LinkManager","DS/PADUtils/PADSettingsMgt","text!DS/ENXScene/assets/xscene_settings.json"],(t,n,i)=>{var o=JSON.parse(i);e._odt_settings&&(o.padsettings=UWA.extend(o.padsettings,e._odt_settings,!0)),n.setApp(o.padsettings,"enxscene",!0),!0===n.getSetting("activateWidgetLink")?t.initializeWidgetLink(widget,n.getSetting("widgetLink_options")).then(()=>{e._init()}):this._init()});try{require(["DS/MSFDocumentManagement/WidgetIntegration"],function(e){widget.MSFDocumentClient=e,widget.MSFDocumentClient.ConnectWidgetWithMSF()})}catch(e){console.error(e)}},_init:function(){var e=this;require(["DS/PADUtils/PADSettingsMgt","DS/PADUtils/PADSession","DS/PADServices/utils/AttributesMgtV2","DS/PADServices/utils/GlobalUtils","DS/PADUtils/PADSharedSettings","DS/PADUtils/PADWebInWinServices","UWA/Utils/Client","text!DS/ENXScene/assets/xscene_settings.json","i18n!DS/ENXScene/assets/nls/ENXScene.json","i18n!DS/PADUtils/assets/nls/PADUtils.json","DS/PADUtils/Configuration","text!DS/ENXScene/assets/ProductExplorerConf.json","DS/PADServices/utils/PADTrackerManager","DS/PADServices/utils/ZipUtils","DS/PADUtils/PADUtilsServices","DS/WebUAUtils/WebUAUtils"],function(t,o,s,a,r,l,d,c,u,g,p,v,m,f,h,_){o.softInit(!0),window.top.performance.mark(e.pcsPrefix+"_require_infra_padutils"),window.top.performance.measure(e.pcsPrefix+"_require_infra",e.pcsPrefix+"_onload",e.pcsPrefix+"_require_infra_padutils"),e.widget.getValue("x3dSharedId")||e.widget.getValue("x3dAppId")||e.widget.addPreference({name:"x3dAppId",type:"hidden",defaultValue:"ENXScene_appId"}),_.setAppid("ENOSC2D_AP");var w=window.top.performance.getEntriesByName(e.pcsPrefix+"_call_init"),P=w.length>0?w[w.length-1].duration:void 0,S=w.length>0?w[w.length-1].startTime:void 0,D=(w=window.top.performance.getEntriesByName(e.pcsPrefix+"_call_onload")).length>0?w[w.length-1].duration:void 0,A=w.length>0?w[w.length-1].startTime:void 0,x=m.getPADTracker({eventCategory:"performance",eventAction:"2d_app_init"});x?x.addMultivaluedEventData("2d_app_init",{call_init_start:S,call_init_duration:P,call_onload_start:A,call_onload_duration:D}):console.warn("tracker not defined"),s.initialize({defaultAttributesJSON:"DS/PADServices/assets/init/AttributesMgt.json",appAttributesJSON:"DS/ENXScene/assets/json/AppDefaultAttributes.json"}).then(function(){var o=JSON.parse(v);p.mergeConfig(o);var u=JSON.parse(c);e._odt_settings&&(u.padsettings=UWA.extend(u.padsettings,e._odt_settings,!0)),e._migrate_settings(),l.initialize({widget:e.widget}),t.setApp(u.padsettings,"enxscene",!0),r.addSharedSettings(e.widget,["x3dPlatformId","showWelcomePanel","autoreload","pad_security_ctx","synthesisModeOnInstance"]),e.widget.mergePreferences(t.getWidgetPreferences()),e.widget.addEvent("endEdit",function(){void 0!==e.widget&&-1!==t.getSetting("webInWin_context_availability").indexOf(e.widget.getValue("addinmode"))&&e.widget.getValue("X3DContentId")?e._processContentID({callback:function(){require("DS/PADServices/utils/GlobalModelEvents").publish({event:"ENXViews/WelcomePanel/closeLandingPage"}),e.widget.dispatchEvent("onContentAdded")}}):t.updateWidgetPreferences.call(t)}),e.widget.addEvent("onChangeControlUpdate",e._onChangeControlUpdateHandler.bind(e)),t.updateWidgetPreferences();var g=e.xnav_component_opts,m=!!widget.getValue("forceTouchMode")&&widget.getValue("forceTouchMode")||d.Features.touchEvents&&!d.Features.pointerEvents?u.action_bar.touch:u.action_bar.standard;l.isWebInWinContext()&&(m=u.action_bar.webinwin),g.layout.propertiesFacet=t.getSetting("propertiesFacet"),m.language=e.widget.lang,g.x3dAppId=e.widget.getValue("x3dAppId"),g.widget=e.widget,g.insert_replace=!0,g.active_view=e.widget.getValue("default_view"),g.authorize_setStructure=!0,g.insert_replace=!0,g.renderTo=document.body,!0===t.getSetting("activateDropInviteWithFilter")&&(g.layout.drop_invite="inviteWithFilter"),!0===t.getSetting("authorizeChangeControl")&&(g.authorizeChangeControl=!0,void 0!==e.widget.getValue("changeControlActivation")&&t.setSetting("changeControlActivation",e.widget.getBool("changeControlActivation"))),!0===t.getSetting("activateDGV")&&(g.layout.amdTreeView="datagridview","treelistview"===g.active_view&&(g.active_view="datagridview")),!0!==e.xnav_component_opts.layout.noactionbar&&(g.action_bar_opts=m),g.configuration.toolbarActivated=!0===i(a.getURLParameter("activateToolbar")),g.configuration.dynamicCtxActivated=!0!==i(a.getURLParameter("NoCtxEvo"))&&!0!==t.getSetting("FUN103640-NoCtxEvo"),e._odt_settings&&e._odt_settings.onModifyViewSettings&&e._odt_settings.onModifyViewSettings(u.view_settings),s.updateAttributesList(o.columnsCusto);var h,_,w,P="null"===(h=e.widget.getValue("xscene_custoParams"))?null:h;P&&s.updateSelectedParams(JSON.parse(P));var S=t.getSetting("resetCustomization");if(!S){"null"===(_=e.widget.getValue("xscene_custo"))&&(_=null);try{_=f.jsonUnzip(_),(_=n(_))&&(w=JSON.parse(_))}catch(e){S=!0}}S||_&&"{"!==_.charAt(0)&&!1===_.startsWith("ZIP:")?(localStorage.removeItem("PADTreeListDefinition."+g.x3dAppId),e._initialize_component(g)):w?(g.layout.view_customization=w,e._initialize_component(g)):require(["DS/PADUtils/PADUtilsServices","DS/PADUtils/PADWSAccess"],function(t,i){t.app_initialization(function(o){o&&o.success?i.getMyAppsTemplate({preference_name:g.x3dAppId+"-"+t.getPlatformId(),onComplete:function(t){var i=null;try{t.length>0&&(t.startsWith("ZIP:")&&(t=f.jsonUnzip(t)),"{"===(t=n(t)).charAt(0)&&(i=JSON.parse(t)).selectedExtensions&&i.selectedTypes&&(s.updateSelectedParams({selectedExtensions:i.selectedExtensions,selectedTypes:i.selectedTypes}),delete i.selectedExtensions,delete i.selectedTypes))}catch(e){}g.layout.view_customization=i,e._initialize_component(g)},onFailure:function(t){e._initialize_component(g)}}):e._initialize_failure()})})})})},_onChangeControlUpdateHandler:function(e,t){var n=require("DS/PADUtils/PADSettingsMgt"),i="bottom-right";i=sessionStorage.getItem("changeControlPosition")?sessionStorage.getItem("changeControlPosition"):n.getSetting("changeControlPosition");var o=require("DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext");!1===t?(o.hide(),this.widget.addPreference({name:"changeControlPosition",type:"hidden",defaultValue:i})):(o.show(),this.widget.addPreference({name:"changeControlPosition",defaultValue:i,type:"list",label:"changeControlPosition_label",options:[{label:"bottom-right_label",value:"bottom-right"},{label:"bottom-left_label",value:"bottom-left"},{label:"top-right_label",value:"top-right"}]})),this.widget.dispatchEvent("onEdit")},onDestroy:function(){for(this.xnav_component.destroy(),this.xnav_component=null,this.welcome.destroy(),this.welcome=null;this.elements.mainBody.firstChild;)this.elements.mainBody.removeChild(this.elements.mainBody.firstChild);this.elements.mainBody.parentNode&&this.elements.mainBody.parentNode.removeChild(this.elements.mainBody),delete this.elements.mainBody,require("DS/PADUtils/PADSharedSettings").destroy(),require("DS/PADServices/utils/AttributesMgtV2").deleteMapping()},_migrate_settings:function(){var e=this.widget.getValue("xscene_root_pids"),n=this.widget.getValue("xscene_root_pids_detached"),i=this.widget.getValue("xscene_struture"),o=t(e),s=t(n),a=t(i),r=!1,l={products:{},filters:{}};if(a)for(var d=Object.keys(a),c=0;c<d.length;c++){var u=d[c];if(!l.products[u]){l.products[u]={};a[u];r=!0}}if(o)for(var g=0;g<o.length;g++){var p=o[g];s&&-1!==s.indexOf(p)&&(l.id2detach||(l.id2detach=[]),l.id2detach.push(p)),l.products[p]={},r=!0}r&&this.widget.setValue("xsceneStoredObjects",JSON.stringify(l)),this.widget.deleteValue("xscene_root_pids"),this.widget.deleteValue("xscene_root_pids_detached"),this.widget.deleteValue("xscene_struture"),this.widget.deleteValue("saved_filter_ids")},_initialize_component:function(e){var t=this,n=e||{};window.top.performance.mark(t.pcsPrefix+"_require_xnavcomponent_before"),require(["DS/PADServices/views/ENXWelcomePanel","DS/PADServices/utils/GlobalModelEvents","DS/PADServices/utils/GlobalUtils","DS/PADUtils/Configuration","DS/PADUtils/PADUtilsServices","DS/PADUtils/PADProbes","DS/PADUtils/PADSettingsMgt","DS/PADServices/views/private/AppStructure","i18n!DS/ENXScene/assets/nls/ENXScene","DS/UIKIT/Mask","i18n!DS/PADServices/assets/nls/PADServices"],function(e,s,a,r,l,d,c,u,g,p,v){u.setWidget(t.widget),l.app_initialization(function(){t._buildDOM(),p.mask(t.elements.mainBody,v.welcomePanel.appLoading);var l=s.getModelEvents(),d=t.widget.getValue("xsceneStoredObjects");"null"===d&&(d=null),"xsceneStoredObjects"===a.getURLParameter("cleanSetting")?(t.widget.deleteValue("xsceneStoredObjects"),d={products:{},filters:{}}):d=UWA.is(d,"string")?JSON.parse(d):{products:{},filters:{}};var u=c.getSetting("pad_security_ctx");u?a.setSecurityContext(u):c.addEvent("onPad_security_ctx",function(e){a.setSecurityContext(e)});var m=i(widget.getValue("autoreload")),f=i(widget.getValue("showWelcomePanel")),h=t.widget.getValue("X3DContentId"),_=null!=h,w=void 0,P={appTitle:"Product Structure Explore",description:g.appDescription,modelEvents:l,storedObjects:d,autoreload:m,structKey:"xsceneStoredObjects",readOnlyApp:r.getConfig("readOnlyApp")},S=[];r.getConfig("AMDDebugCommands")&&S.push(new Promise(function(e){require([r.getConfig("AMDDebugCommands")],function(n){n.updateWelcomePanelOpts(P,{app:t,target:t.elements.mainBody}).then(e)})})),Promise.all(S).then(function(){t.welcome=new e(P),t.welcome.initialize().then(function(){!0===f&&(!1!==m||_||(p.unmask(t.elements.mainBody),t._setActiveView(t.activeBody,t.welcome)))}),m&&(w=d),require(["DS/ENXNav/XNavComponent","DS/PADServices/utils/PADTrackerManager"],function(e,s){var l=[],d=[],u=new Promise(function(e){Promise.all(d).then(function(){if(!0===c.getSetting("Activate_relationsColumns")){require(["DS/ENORIPE_RelationsColumns/RelationsColumns"],function(t){t.isAdditionalColumnsAvailable(function(n){!0===n&&(l.push(t),t.setPreferenceProxy()),e()}),u.name="Add "+t.getName()},e)}else e()})});d.push(u),o(d,l,"DS/CfgWebAppEffectivityUX/scripts/CfgEffectivityColumns",function(){return!0!==c.getSetting("removeCfgColumns")&&!0===i(a.getURLParameter("pe-add-cfg-col"))}),o(d,l,"DS/CfgWebAppEffectivityUX/scripts/CfgConfigurationRevisionColumn",function(){return!0!==c.getSetting("removeCfgColumns")&&!0===i(a.getURLParameter("pe-add-cfg-col"))}),o(d,l,"DS/CfgWebAppEffectivityUX/scripts/CfgConfigurationContextColumn",function(){return!0!==c.getSetting("removeCfgColumns")&&!0===i(a.getURLParameter("pe-add-cfg-col"))}),o(d,l,"DS/CfgWebAppEffectivityUX/scripts/CfgProductConfigurationColumn",function(){return!0!==c.getSetting("removeCfgColumns")&&!0===i(a.getURLParameter("pe-add-cfg-col"))});var g=new Promise(function(i){Promise.all(d).then(function(){!function(i){window.top.performance.mark(t.pcsPrefix+"_require_xnavcomponent_done"),window.top.performance.measure(t.pcsPrefix+"_require_xnavcomponent",t.pcsPrefix+"_require_xnavcomponent_before",t.pcsPrefix+"_require_xnavcomponent_done");var o=window.top.performance.getEntriesByName(t.pcsPrefix+"_require_infra"),a=o.length>0?o[o.length-1].startTime:void 0,l=o.length>0?o[o.length-1].duration:void 0,d=(o=window.top.performance.getEntriesByName(t.pcsPrefix+"_require_xnavcomponent")).length>0?o[o.length-1].startTime:void 0,u=o.length>0?o[o.length-1].duration:void 0,g=s.getPADTracker({eventCategory:"performance",eventAction:"2d_app_init"});g?g.addMultivaluedEventData("2d_app_init",{require_infra_start:a,require_infra_duration:l,require_xnavcomponent_start:d,require_xnavcomponent_duration:u}):console.warn("tracker not defined");var p=UWA.extend(n,t._addEventsCB());if(w&&(p.objects2Load=w),i.length?p.additionalColumnsModules=i:p.additionalColumnsModules=[],c.getSetting("expandv2")){var v=r.getConfig("TreeDocModelAMD");v&&(p.amd_custo.TreeDocument=v)}t.xnav_component=new e(p)}(l),i()})});g.name="Launch real initialization",d.push(g)})})})})},_initialize_failure:function(){var e=this;require(["css!DS/ENXNav/ENXNav","DS/ENXNav/views/xNavInitError","i18n!DS/ENXNav/assets/nls/ENXNav.json"],function(t,n,i){e.elements||e._buildDOM();var o=e.elements.fakeContainer=UWA.createElement("div",{class:"xnav_component"}),s=new n({msg:i.initialization_error});o.setContent(s),e._setActiveView("failure",e.elements.fakeContainer),e.widget.dispatchEvent("onXSceneReady",e)})},_processContentID:function(e){var t=this,n=t.widget.getValue("X3DContentId"),i=UWA.is(n,"string")?JSON.parse(n):n;require(["DS/PADUtils/PADTypesMgt","DS/PADUtils/PADUtilsServices","DS/ENXNav/utils/xNavKindProcessor"],function(n,o,s){n.retrieveAuthorizedObjects({version:"2.0",X3DContentId:i,behavior:"WITH_CONTEXT",displayNotif:!1,callback:function(n){var i=n.authorized_objects[0].envId;o.updatePlatformId(i),s.loadKinds(t.xnav_component,n,"fromx3dContentId",!1,e&&e.callback?e.callback:void 0),t.widget.deleteValue("X3DContentId")}})})},_addEventsCB:function(){var e=this;return{events:{onReady:function(t){require("DS/UIKIT/Mask").unmask(e.elements.mainBody),window.top.performance.mark(e.pcsPrefix+"_xnavcomponent_onready"),window.top.performance.measure(e.pcsPrefix+"_xnavcomponent_ready",e.pcsPrefix+"_require_xnavcomponent_done",e.pcsPrefix+"_xnavcomponent_onready");var n=require("DS/PADServices/utils/PADTrackerManager"),o=(c=window.top.performance.getEntriesByName(e.pcsPrefix+"_xnavcomponent_ready")).length>0?c[c.length-1].startTime:void 0,s=c.length>0?c[c.length-1].duration:void 0,a=n.getPADTracker({eventCategory:"performance",eventAction:"2d_app_init"});a?a.addMultivaluedEventData("2d_app_init",{app_loading_start:o,app_loading_duration:s}):console.warn("tracker not defined");var r=e.widget.getValue("X3DContentId"),l=require("DS/PADServices/utils/GlobalModelEvents");UWA.is(r)&&e._processContentID({callback:function(){e.xnav_component.getRoots().length>0&&l.publish({event:"ENXViews/WelcomePanel/closeLandingPage"})}}),e.widget.addEvent("onViewChange",e.xnav_component.onResize.bind(e.xnav_component)),e.widget.addEvent("onResize",e.xnav_component.onResize.bind(e.xnav_component));var d=(l=require("DS/PADServices/utils/GlobalModelEvents")).getModelEvents();d.subscribe({event:"ENXViews/Views/showInWidgetBody"},function(t){t.html?(t.title&&widget.setTitle(t.title),e._setActiveView(t.idView,t.html)):!0===t.restore&&(widget.setTitle(e.xnav_component.getWidgetTitle()),"welcome"===e.previousBody?e._setActiveView("welcome",e.welcome):"app"!==e.previousBody&&"app"!==t.idView||e._setActiveView("app",e.xnav_component))}),require("DS/PADUtils/PADSharedSettings").resetDebounceFlags(),e.xnav_component.addEvent("onToggleView",function(t){e.widget.setValue("default_view",t)}),t&&t.addInView&&e._setActiveView("app",e.xnav_component),t&&!0===t.error&&e._initialize_failure(),d.subscribe({event:"ENXViews/WelcomePanel/openContent"},function(t){switch(e._setActiveView("app",e.xnav_component),t.mode){case"welcome":e.xnav_component.openStoredObjects(t);break;case"drop":e.xnav_component.openDroppedObjects(t).then(function(e){e&&e.error});break;default:console.error("Unknown mode")}}),d.subscribe({event:"ENXViews/WelcomePanel/removeFromStored"},function(t){if(t.item2remove){var n=t.item2remove,i=[],o=e.widget.getValue("xsceneStoredObjects");if("null"===o&&(o=null),UWA.is(o,"string")){o=JSON.parse(o);var s,a,r=n.length,l=!1;for(s=0;s<r;s++){if(o.products&&o.products.hasOwnProperty(n[s]))(u=e.xnav_component.options.model.searchRootById(n[s]))&&i.push(n[s]),delete o.products[n[s]],l=!0;if(o.filters){var d=Object.getOwnPropertyNames(o.filters);for(a=d.length-1;a>=0;a--){var c,u;if(o.filters[d[a]].associatedProduct===n[s]?c=n[s]:d[a]===n[s]&&(c=o.filters[d[a]].associatedProduct),c)(u=e.xnav_component.options.model.searchRootById(c))&&(e.xnav_component.options.model.removeRoot(u),i.push(d[a])),delete o.filters[d[a]],l=!0}}}if(l&&widget.setValue("xsceneStoredObjects",JSON.stringify(o)),i.length){var g=require("DS/PADServices/utils/GlobalModelEvents").getModelEvents();g.publish({event:"ENXViews/WelcomePanel/openedObject",data:{kind:"deleteRoots",removeIds:i}}),g.publish({event:"ENXViews/WelcomePanel/removeFromView",data:{item2remove:i}})}}}}),d.subscribe({event:"ENXViews/WelcomePanel/activate"},function(t){d.publish({event:"ENXViews/WelcomePanel/refreshView"}),"fromHome"===t&&(e.welcome.fromHome=!0),e._setActiveView("welcome",e.welcome)}),d.subscribe({event:"ENXViews/WelcomePanel/closeLandingPage"},function(){e._setActiveView("app",e.xnav_component)}),d.subscribe({event:"ENXViews/WelcomePanel/unselectAllInModel"},function(){e.xnav_component.getPADTreeDocument().unselectAll()}),d.subscribe({event:"ENXViews/WelcomePanel/removeFromView"},function(t){var n=t.item2remove,i=n?n.length:0,o=e.xnav_component.getPADTreeDocument();o.withTransactionUpdate(function(){for(var e=0;e<i;e++){var t=o.searchRootById(n[e]);t&&o.removeRoot(t)}})}),e.appReady=!0,d.publish({event:"ENXViews/WelcomePanel/appReady"}),window.top.performance.mark(e.pcsPrefix+"_app_load_complete"),window.top.performance.measure(e.pcsPrefix+"_app_load_completed","enxscene_load_html",e.pcsPrefix+"_app_load_complete");var c,u=(c=window.top.performance.getEntriesByName(e.pcsPrefix+"_app_load_completed")).length>0?c[c.length-1].duration:void 0;a?(a.setEventData({eventLabel:"Initialization",eventValue:u}),a.trackPageEvent()):console.warn("tracker not defined"),e.widget.dispatchEvent("onXSceneReady",e),!1===i(widget.getValue("showWelcomePanel"))&&e._setActiveView("app",e.xnav_component),l.publish({event:"ENXViews/WelcomePanel/loadData"})},onAddPaths:function(e){var t=require("DS/PADServices/views/private/AppStructure"),n=t.retrieveData("xsceneStoredObjects");t.addProductPath(n,e.addedPaths),t.addOpenProduct(n,e.addedPaths),t.persistData("xsceneStoredObjects",n);var i=require("DS/PADServices/utils/GlobalModelEvents").getModelEvents();i.publish({event:"ENXViews/WelcomePanel/openedObject",data:{kind:"products",addedPaths:e.addedPaths}}),i.publish({event:"ENXViews/WelcomePanel/closeLandingPage"})},onAddFilters:function(e){for(var t=require("DS/PADServices/views/private/AppStructure"),n=t.retrieveData("xsceneStoredObjects"),i={filters:{}},o=0;o<e.filterIds.length;o++){var s=e.filterIds[o];t.addFilter(n,s,e.rootIds[o]),t.addOpenFilter(n,[s]),i.filters[e.filterIds[o]]={associatedProduct:e.rootIds[o],filterName:e.filterNames[o]}}t.persistData("xsceneStoredObjects",n);var a=require("DS/PADServices/utils/GlobalModelEvents").getModelEvents();a.publish({event:"ENXViews/WelcomePanel/openedObject",data:{kind:"filters",addedFilters:i}}),a.publish({event:"ENXViews/WelcomePanel/closeLandingPage"})},onDeleteRoots:function(e){var t=JSON.parse(e),n=require("DS/PADServices/views/private/AppStructure"),i=n.retrieveData("xsceneStoredObjects"),o=n.removeOpen(i,t);n.persistData("xsceneStoredObjects",i);var s=require("DS/PADServices/utils/GlobalModelEvents");s.getModelEvents().publish({event:"ENXViews/WelcomePanel/openedObject",data:{kind:"removeFromView",removedFromViewIds:o}}),s.publish({event:"ENXViews/Model/remove"})},onEmptyView:function(){},onCustoViewChange:function(t,n){var i=require("DS/PADServices/utils/ZipUtils").jsonZip(JSON.stringify(t));if(e.widget.setValue("xscene_custo",i),n&&e.widget.setValue("xscene_custoParams",JSON.stringify(n)),e.xnav_component&&e.xnav_component.options){var o=e.xnav_component.options.views.datagridview;o&&(o.columnOrdering=!0)}},onAuthoringCtxAvailable:function(t){var n=require("DS/PADUtils/PADSettingsMgt"),i=require("DS/PADUtils/PADCommandProxy");e.debouncePrefSynchro=!1,e._proxy=i.create({events:{onPreferenceModification:function(t){"changeControlActivation"===t.name&&(e.debouncePrefSynchro=!0,e.widget.setValue(t.name,t.value),n.setSetting(t.name,t.value))}}}),e.widget.addEvent("endEdit",function(t){if(t&&!1===t.submitted){var i="bottom-right";i=sessionStorage.getItem("changeControlPosition")?sessionStorage.getItem("changeControlPosition"):n.getSetting("changeControlPosition");var o=require("DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext");!1===e.widget.getBool("changeControlActivation")?(o.hide(),e.widget.addPreference({name:"changeControlPosition",type:"hidden",defaultValue:i})):(o.show(),e.widget.addPreference({name:"changeControlPosition",defaultValue:i,type:"list",label:"changeControlPosition_label",options:[{label:"bottom-right_label",value:"bottom-right"},{label:"bottom-left_label",value:"bottom-left"},{label:"top-right_label",value:"top-right"}]}))}});var o=n.getSetting("changeControlActivation");o=void 0!==e.widget.getValue("changeControlActivation")?e.widget.getBool("changeControlActivation"):t.isAuthoringContextVisible;var s="bottom-right";s=sessionStorage.getItem("changeControlPosition")?sessionStorage.getItem("changeControlPosition"):n.getSetting("changeControlPosition");var a=require("DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext");a.setPosition(s),e.widget.addPreference({name:"changeControlActivation",defaultValue:o,type:"boolean",label:"changeControlActivation_label",onchange:"onChangeControlUpdate"}),!0===o?(a.show(),e.widget.addPreference({name:"changeControlPosition",defaultValue:s,type:"list",label:"changeControlPosition_label",options:[{label:"bottom-right_label",value:"bottom-right"},{label:"bottom-left_label",value:"bottom-left"},{label:"top-right_label",value:"top-right"}]})):(a.hide(),e.widget.addPreference({name:"changeControlPosition",type:"hidden",defaultValue:s})),n.setSetting("changeControlActivation",o,!0),n.addEvent("onChangeControlActivation",e._onChangeControlActivation.bind(e)),a.addEvent&&a.addEvent("onAuthoringCtxVisible",function(t){n.setSetting("changeControlActivation",t.showAuthoringContext,!0),e._onChangeControlActivation(t.showAuthoringContext),n.setSetting("changeControlDlgOpen",!0)}),n.addEvent("onChangeControlPosition",function(e){require("DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext").setPosition(e),sessionStorage.setItem("changeControlPosition",e)})},onTenantChange:function(t){e.welcome.tenantChange(),require(["DS/PADUtils/PADUtilsServices","DS/PADUtils/PADWSAccess","DS/PADServices/utils/AttributesMgtV2","DS/PADServices/utils/ZipUtils"],function(n,i,o,s){i.getMyAppsTemplate({preference_name:e.widget.getValue("x3dAppId")+"-"+n.getPlatformId(),onComplete:function(e){var n=null;e.length>0&&(e=s.jsonUnzip(e),(n=JSON.parse(e)).selectedExtensions&&n.selectedTypes&&(o.updateSelectedParams({selectedExtensions:n.selectedExtensions,selectedTypes:n.selectedTypes}),delete n.selectedExtensions,delete n.selectedTypes)),t.updateTreeView(n)},onFailure:function(e){t.updateTreeView()}})})},onSaveAsTemplate:function(t){t&&t.selectedExtensions&&t.selectedTypes&&e.widget.setValue("xscene_custoParams",JSON.stringify({selectedExtensions:t.selectedExtensions,selectedTypes:t.selectedTypes}));var n=require("DS/PADServices/utils/ZipUtils").jsonZip(JSON.stringify(t));e.widget.setValue("xscene_custo",n),require(["DS/PADUtils/PADUtilsServices","DS/PADUtils/PADWSAccess"],function(e,t){t.saveMyAppsTemplate({preference_name:widget.getValue("x3dAppId")+"-"+e.getPlatformId(),value:n,onComplete:function(e){},onFailure:function(e){}})})}}}},onSearch:function(e){this.xnav_component&&this.xnav_component.onSearch({query:e})},_onChangeControlActivation:function(e){var t=require("DS/PADUtils/PADSettingsMgt"),n=require("DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext");this.debouncePrefSynchro?this.debouncePrefSynchro=!1:this._proxy.preferenceModification({name:"changeControlActivation",value:e});var i="bottom-right";i=sessionStorage.getItem("changeControlPosition")?sessionStorage.getItem("changeControlPosition"):t.getSetting("changeControlPosition"),n.setPosition(i),!0===e?(n.show(),this.widget.addPreference({name:"changeControlPosition",defaultValue:i,type:"list",label:"changeControlPosition_label",options:[{label:"top-right_label",value:"top-right"},{label:"top-left_label",value:"top-left"},{label:"bottom-right_label",value:"bottom-right"},{label:"bottom-left_label",value:"bottom-left"}]})):(n.hide(),this.widget.addPreference({name:"changeControlPosition",type:"hidden",defaultValue:i}))},_buildDOM:function(){if(!this.elements){this.elements={};var e=this.elements.mainBody=UWA.createElement("div");this.elements.mainBody.classList.add("explorer-root"),this.elements.mainBody.classList.add("enx-appMainBody"),this.elements.mainBody.style.position="absolute",this.elements.mainBody.style.height="100%",this.elements.mainBody.style.width="100%",self.widget.setBody(e)}},_setActiveView:function(e,t){var n;(this.initDiv||(this.initDiv={}),void 0===e&&(e="default-"+Date.now()),this.previousBody=this.activeBody,this.activeBody=e,!0!==this.initDiv[e])&&(this.elements[e]||(this.elements[e]=document.createElement("div"),this.elements[e].classList.add("explorer-"+e),this.elements[e].classList.add("explorer-div"),this.elements.mainBody.appendChild(this.elements[e])),"function"==typeof t.render?(n=t.render(),this.initDiv[e]=!0):n=t,this.elements[e].appendChild(n));this._showActiveView(e)},_showActiveView:function(e){for(var t=Object.keys(this.elements),n=0;n<t.length;n++)e===t[n]?this.elements[t[n]].classList.remove("explorer-hidden"):"mainBody"!==t[n]&&this.elements[t[n]].classList.add("explorer-hidden");window.dispatchEvent(new Event("resize"))}};return s.init(e),s}