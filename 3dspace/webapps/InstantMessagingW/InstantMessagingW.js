define("DS/InstantMessagingW/js/model/IMWContactModel",["UWA/Class/Model","DS/RTProxyDriver/RTLogger"],function(e,t){"use strict";return e.extend({defaults:{email:"mail@im.com",status:"Offline",login:"DefaultIM",username:"DefaultIM",tenants:"DefaultIM",avatarUrl:"./assets/avatarDefault.png",devEnv:!1},setup:function(e){this.roles={}},setRole:function(e,s){var i=this.getRole(e);i&&i!=s&&t.Widget("Replacing role "+i+" for user "+this.get("login")+" in room "+e),this.roles[e]=s},getRole:function(e){return this.roles[e]},isOwner:function(e){return"owner"==this.getRole(e)}})}),define("DS/InstantMessagingW/js/view/IMWdiscoveroom",["UWA/Class/View","DS/RTProxyDriver/RTLogger","DS/InstantMessagingW/assets/svg_icons_widget","DS/UIKIT/Input/Button","DS/UIKIT/Tooltip","i18n!DS/InstantMessagingW/assets/nls/feed"],function(e,t,s,i,n,a){"use strict";return e.extend({tagName:"div",className:"IMWdiscoveroom2",setup:function(e){this.id="disco"+this.model.get("room_id"),this.ctrl=e.ctrl,this.setRoomListeners()},setRoomListeners:function(){this.listenTo(this.model,"onChange:alreadyIn",this.updatePresence),this.listenTo(this.model,"onChange:msgqty",this.setMsgQty),this.listenTo(this.model,"onChange:userqty",this.setUserQty),this.listenTo(this.model,"onChange:lastmsgDate",this.updateLastMsg),this.listenTo(this.model,"onChange:name",this.updateName),this.listenTo(this.model,"onChange:pathImage",this.updateImage),this.listenTo(this.model,"onChange:description",this.updateDescription)},updateImage:function(){var e=this.model.get("pathImage");e?this.showRoomImg(e):this.showDefaultSvg()},updateName:function(){this.container.getElement(".card-title").innerHTML=this.model.get("name")},updateDescription:function(){this.container.getElement(".card-content").innerHTML=this.model.get("description")},setUserQty:function(){var e=this.model.get("userqty")>99?"+99":this.model.get("userqty");this.container.getElement(".discoUsersQtyTextSVG").innerHTML=e||"0"},setMsgQty:function(){this.container.getElement(".discoMsgQtyTextSVG").innerHTML=this.model.get("msgqty")||"0"},updatePresence:function(){this.model.get("alreadyIn")?(this.showLeaveBtn(),this.container.classList.add("alreadyIn"),this.dispatchEvent("showToggle")):(this.showJoinBtn(),this.container.classList.remove("alreadyIn"))},updateLastMsg:function(){if(this.model.get("lastmsgDate")){var e,t,s,i=new Date(this.model.get("lastmsgDate")),n=new Date((new Date).toISOString().replace("Z","").replace("T"," ")),o=Math.floor((n-i)/1e3);if(o<60)s="seconds",e=o;else if(o<3600)s="minuts",e=Math.floor(o/60);else if(o<86400)s="hours",e=Math.floor(o/3600);else if(o<604800)s="days",e=Math.floor(o/86400);else{if(!(o<2419200))return this.container.getElement(".card-subtitle").innerHTML=a.LastMessage+" "+i.toLocaleDateString("en-US",{month:"short",year:"numeric"});s="weeks",e=Math.floor(o/604800)}t=e>1?a[s]:a[s+"Singulier"],this.container.getElement(".card-subtitle").innerHTML=a.LastMessage+" "+e+" "+t}else this.container.getElement(".card-subtitle").innerHTML=""},joinOrLeaveFactory:function(){return e=this,function(){e.container.classList.contains("alreadyIn")?e.ctrl.leaveRoom(e.model):e.ctrl.joinPublicRoom(e.model)};var e},showRoomImg:function(e){this.container.getElement(".discoRoomImgSrc").classList.remove("hidden"),this.container.getElement(".discoRoomImgSvg").classList.add("hidden"),this.container.getElement(".discoRoomImgSrc").style.backgroundImage="url('"+e||this.model.get("pathImage")+"')"},showDefaultSvg:function(){this.container.getElement(".discoRoomImgSrc").classList.add("hidden"),this.container.getElement(".discoRoomImgSvg").classList.remove("hidden")},showLeaveBtn:function(){this.container.getElement(".card-thumbnail").classList.add("card-thumbnail-selectable"),this.container.getElement(".card-thumbnail").classList.add("card-thumbnail-selected")},showJoinBtn:function(){this.container.getElement(".card-thumbnail").classList.remove("card-thumbnail-selected")},showHover:function(){this.container.getElement(".card-thumbnail").classList.add("card-thumbnail-selectable")},hideHover:function(){this.container.classList.contains("alreadyIn")||this.container.getElement(".card-thumbnail").classList.remove("card-thumbnail-selectable")},render:function(){var e;return this.container.setContent([{id:this.model.get("name"),tag:"div",class:"card card-thumbnail",html:[{tag:"div",class:"fakeCardWidth"},{class:"card-img",tag:"div",html:[{class:"discoRoomImgSrc",tag:"div"},{class:"discoRoomImgSvg hidden",tag:"div",html:s.room_default_recropped}]},{class:"card-block card-thumbnail-title-bar",tag:"div",html:[{class:"card-title",tag:"h4",html:this.model.get("name")},{class:"card-subtitle",tag:"h4"}]},{class:"card-block card-thumbnail-content",tag:"div",html:[{class:"card-content",tag:"p",html:this.model.get("description")}]},{class:"card-footer",tag:"div",html:[{class:"badge badge-success",tag:"span",html:[{class:"fonticon fonticon-globe",tag:"span"},{class:"badge-content",tag:"span",html:a.Public}]},{class:"badge badge-primary",tag:"span",html:[{class:"fonticon fonticon-users",tag:"span"},{class:"badge-content discoUsersQtyTextSVG",tag:"span",html:"0"}]},{class:"badge badge-primary",tag:"span",html:[{class:"fonticon fonticon-chat",tag:"span"},{class:"badge-content discoMsgQtyTextSVG",tag:"span",html:"0"}]}]}]}]),this.container.addEvent("mouseover",(e=this,function(){e.showHover()})),this.container.addEvent("mouseout",function(e){return function(){e.hideHover()}}(this)),this.container.addEvent("click",this.joinOrLeaveFactory()),this.updateImage(),this.updatePresence(),this.setUserQty(),this.setMsgQty(),this.updateLastMsg(),this.tooltipDescription=new n({position:"",target:this.container.getElement(".card-content"),body:this.model.get("description")}),this.tooltipName=new n({position:"",target:this.container.getElement(".card-title"),body:this.model.get("name")}),this.container.id=this.id,this}})}),define("DS/InstantMessagingW/js/view/IMWMeInfo",["UWA/Class/View","DS/UIKIT/DropdownMenu","DS/RTColors/RTColors","DS/InstantMessagingW/assets/demo"],function(e,t,s,i){"use strict";return e.extend({className:"IMWMeInfoView",setup:function(e){this.user=e.user,this.setStatus=e.setStatus,this._createContent(),this.listenTo(this.user,"onChange:status",this.changeUserStatus.bind(this))},changeUserStatus:function(e){var t=this.user.get("status").toLowerCase(),i=s[t];this.container.getElement(".IM-user-status").style.background=i,this.container.getElement(".IM-user-status-txt").innerHTML=this.user.get("status"),this.container.getElement(".IM-me-img").style.opacity="offline"===t?"0.3":"0.9",this.setMyStatus({myStatus:this.user.get("status")})},_createContent:function(){this.setContainer({tag:"div",class:"IMWMeInfoView",styles:{width:"100%"},html:{tag:"div",class:"IM-chatpanel-global",html:[{tag:"div",class:"IMWMeView",styles:{background:"#005686",height:"100px"},html:[{tag:"div",class:"IM-me-contact",styles:{"margin-left":"45px"},html:[{tag:"img",class:"IM-me-img",draggable:"false",src:document.rtcwidget_Swym_URL+this.user.get("login")+"/format"}]},{tag:"div",class:"IM-me-infos",html:[{tag:"div",class:"IM-chat-username",styles:{"font-size":"22px"},html:this.user.get("username")},{tag:"div",class:"IM-me-details",html:[{tag:"div",class:"IM-user-status me",styles:{background:s[this.user.get("status").toLowerCase()]}},{tag:"div",class:"IM-user-status-txt",html:this.user.get("status")},{tag:"span",class:"fonticon fonticon-down-open IM-user-status-dropdown"},{tag:"div",class:"IM-me-separator",html:i[this.user.get("login")]?"|":"",styles:{"margin-left":"10px",opacity:"0.5"}},{tag:"div",class:"IM-me-place",html:i[this.user.get("login")]?i[this.user.get("login")]:"",styles:{"margin-left":"10px",opacity:"0.5"}}]}]},{tag:"div",class:"IM-me-menu",styles:{"padding-top":"10px","padding-right":"8px"}}]}]}}),this.buildDropDownMenu()},buildDropDownMenu:function(){var e=this,s=this.container.getElement(".IM-user-status-dropdown");this.dropdownMenu=new t({target:s,items:[],events:{onClick:function(t,s){e.setStatus({myStatus:s.name,statusMsg:s.name}),e.setMyStatus({myStatus:s.name,statusMsg:s.name})}}}),this.dropdownMenu.getContent().style.zIndex="3000";for(var i in{Offline:"Offline",Away:"Away",Busy:"Busy",Online:"Online"})this.dropdownMenu.addItem({text:i,name:i,icon:"Online"===i?"fonticon fonticon-check":""})},setMyStatus:function(e){var t=this;this.dropdownMenu&&this.dropdownMenu.items.forEach(function(s){"SignoutLIname"!=s.name&&(s.name===e.myStatus?t.dropdownMenu.updateItem({id:s.id,text:s.text,name:s.name,icon:"fonticon fonticon-check"}):t.dropdownMenu.updateItem({id:s.id,text:s.text,name:s.name,icon:""}),s.elements&&s.elements.container&&s.elements.container.firstChild&&!s.elements.container.firstChild.className&&s.elements.container.firstChild.destroy())})},inject:function(e){this.container.isInjected()||this.container.inject(e)}})}),define("DS/InstantMessagingW/js/model/IMWMediaModel",["UWA/Class/Model"],function(e){"use strict";return e.extend({defaults:{media_id:"noID",mime:null,name:null,path:null,icon:null,timeMedia:null,view:null},setup:function(e){try{var t=this.get("path").replace("/opt/data",document.rtcwidget_RTC_URL)}catch(e){t=document.rtcwidget_RTC_URL+"/medias/"+this.get("name")}this.set("path",t);var s=document.rtcwidget_Assets_URL+"/I_UnknownFile200x150.png";switch(this.get("mime").toLowerCase()){case"gif":case"jpg":case"png":case"svg":s=this.get("path").replace("/opt/data",document.rtcwidget_RTC_URL);break;case"pdf":s=document.rtcwidget_Assets_URL+"/I_PDFdoc200x150.png";break;case"doc":case"docx":s=document.rtcwidget_Assets_URL+"/I_TextDoc200x150.png";break;case"xls":case"xlsx":s=document.rtcwidget_Assets_URL+"/I_TableDoc200x150.png";break;case"ppt":case"pptx":s=document.rtcwidget_Assets_URL+"/I_PresDoc200x150.png";break;case"zip":case"rar":s=document.rtcwidget_Assets_URL+"/I_ZIPDoc200x150.png";break;case"3dxm":case"3dxml":s=document.rtcwidget_Assets_URL+"/I_3DXML200x150.png";break;case"stl":s=document.rtcwidget_Assets_URL+"/I_STL200x150.png";break;case"mp4":s=this.get("path").replace("/opt/data",document.rtcwidget_RTC_URL)}this.set("icon",s)}})}),define("DS/InstantMessagingW/js/view/IMW3DPlayPlayer",["UWA/Class/View","DS/UIKIT/Input/Button","DS/UIKIT/Spinner","DS/UIKIT/Alert"],function(e,t,s,i){"use strict";return e.extend({setup:function(e){this.room_id=void 0,this.uploadFile=e.uploadFile,this.launchCoreview=e.launchCoreview,this._createContent(),this.ctrl=e.ctrl},_createContent:function(){this.setContainer({tag:"div",class:"IM-3dplayer",styles:{display:"none"},html:[{tag:"div",id:"IMWActionBar",class:"IM-3dplayer-action",styles:{margin:"0px",display:"none"},html:[{tag:"div",class:"IM-3dplayer-feedback",styles:{width:"170px",height:"40px"}}]},{tag:"div",class:"IM-3dplayer-div"}]})},inject:function(e){this.container.inject(e)},startCoreview:function(){if("none"!==this.container.style.display){var e=this;this._player.setCollabMode(!0),this._player.addCollabCB(function(t,s){console.log("collab"),e.sendCoreviewAction({arg1:t,arg2:s})}),this.launchCoreview({room_id:this.room_id,path:this.path,fileName:this.fileName,mime:this.mime,start:!0})}},sendCoreviewAction:function(e){this.launchCoreview({room_id:this.room_id,path:this.path,fileName:this.fileName,mime:this.mime,actions:e})},onCoreviewAction:function(e){this._player.performAction(e.arg1,e.arg2)},send:function(){var e=this.getElement(".IM-3dplayer-feedback"),t=this.getElement(".IM-3dplayer-action");t.style.display="inline-flex";var s=this;this._player.getScreenshot({onSuccess:function(n){console.log("URL received");var a=new XMLHttpRequest;a.open("GET",n,!0),a.send(),a.onload=function(n){console.log("svg");a.responseText;s.uploadFile({room_id:s.room_id,mime:"svg",name:s.fileName,file:a.responseText}),new i({visible:!0}).inject(e).add({className:"success",message:"Model shared !"}),setTimeout(function(s){e.innerHTML="",t.style.display="none"},3e3)}}})},display3dplayer:function(e){if("none"===this.container.style.display)e&&(this.ctrl.view.chatPanelView.showShareBtn(),this.mime=e.mime,this.room_id=e.room_id,this.fileName=e.fileName,this.coreview=e.coreview,this.path!==e.path&&(this.path=e.path,this.createPlayer(e.fileName)),this.container.style.display="block",this.divTop=this.container.offsetHeight+59,this.container.style.top="59px",this._player&&this.coreview&&this._player.setCollabMode(!1));else{this.container.style.top=this.divTop+"px";var t=this;this._player&&this._player.setCollabMode&&this._player.removeCollabCB&&(this._player.setCollabMode(!1),this._player.removeCollabCB()),setTimeout(function(){t.container.style.display="none"},600)}},createPlayer:function(e){var t={container:this.container.getElement(".IM-3dplayer-div"),input:{asset:this.path},options:{loading:"autoplay",callbacks:{experience:{ExperienceReady:this.onExperienceReady.bind(this)},asset:{LoadingFinished:this.onLoadingFinished.bind(this)}}}};this._player&&this._player.dispose();var s=require("DS/3DPlayHelper/3DPlayHelper");this._player=new s(t)},onExperienceReady:function(e){this.coreview&&this._player.setCollabMode(!1)},onLoadingFinished:function(e){}})}),define("DS/InstantMessagingW/js/view/IMWPlayerVideoView",["UWA/Class/View"],function(e,t){"use strict";return e.extend({tagName:"div",className:"IMWMessageView",setup:function(e){this.path=e.path,this.intervalRef=void 0,this.originSrc=void 0,this.tabImgs=[],this.video=void 0,this.played=!1,this.isClickable=void 0===e.isClickable||e.isClickable,this._createContent(e)},_createContent:function(e){var t=this;this.video=UWA.createElement("video",{class:"IM-video-player-video",crossOrigin:"Anonymous",autoplay:!0,src:this.path,muted:!0}),this.video.oncanplay=function(){this.pause(),this.oncanplay=""},this.setContainer({tag:"div",class:"IM-video-player",html:[{tag:"div",styles:{position:"relative"},html:[{tag:"div",class:"IM-video-player-icon",html:{tag:"span",class:"fonticon fonticon-play",styles:{color:"white",margin:"auto"}}},this.video]}],events:{click:function(e){t.isClickable&&(t.intervalRef&&clearInterval(t.intervalRef),t.video.currentTime=0,this.getElementsByClassName("IM-video-player-icon")[0].style.display="none",t.video.style.display="block",t.video.play(),t.video.muted=!1,t.video.controls=!0,t.played=!0)},mouseover:function(){if(!t.played){var e=2,s=Math.floor(t.video.duration/8);s&&(t.video.currentTime=s,t.intervalRef=setInterval(function(){8===e&&(e=0),t.video.currentTime=s*e,e++},900))}},mouseout:function(){t.played||(t.intervalRef&&clearInterval(t.intervalRef),t.video.currentTime=0)}}})},grab:function(){var e=document.createElement("canvas");return e.height=this.video.videoHeight,e.width=this.video.videoWidth,e.getContext("2d").drawImage(this.video,0,0,e.width,e.height),e.toDataURL()},inject:function(e,t){t?this.container.inject(e,t):this.container.inject(e)}})}),define("DS/InstantMessagingW/js/model/IMWShareContentModel",["UWA/Class/Model"],function(e){"use strict";return e.extend({defaults:{shared:!1,name:"",data:null}})}),define("DS/InstantMessagingW/js/model/IMWMessageModel",["UWA/Class/Model"],function(e){"use strict";return e.extend({defaults:{message_id:"noID",message:"no text",html:null,isSent:"DefaultIM",read_date:"none",createDate:"none",readBy:{},devEnv:!1,user:{},fileId:null,fileName:null,data:null,origin:null,bot:!1},setup:function(e){this.get("html")&&this.set("message",this.get("html")),"noID"===this.get("message_id")&&this.set("message_id",UWA.Utils.getUUID()),""===this.get("read_date")&&this.set("read_date","none")}})}),define("DS/InstantMessagingW/js/view/IMWContactView",["UWA/Class/View","DS/RTColors/RTColors","DS/UIKIT/Tooltip","i18n!DS/InstantMessagingW/assets/nls/feed"],function(e,t,s,i){"use strict";return e.extend({tagName:"div",className:"IMWContactView",setup:function(e){this.user=e.user,this.startChat=e.startChat,this._createContent(),this.listenTo(this.user,"onChange:status",this.changeUserStatus.bind(this)),this.room_id=e.room_id,this.absent=e.absent,this.setFonticonIfNeeded()},changeUserStatus:function(e){var s=this.user.get("status"),i=t[s.toLowerCase()];this.container.getElement(".IM-user-status").style.background=i,"offline"===s.toLowerCase()?this.container.getElement(".IM-contact-img").style.opacity="0.3":this.container.getElement(".IM-contact-img").style.opacity="0.9"},setFonticonIfNeeded:function(){if(!this.room_id)return!1;var e;this.user.isOwner(this.room_id)&&((e=this.container.getElement(".IM-username-role")).classList.remove("hidden"),e.setText("Owner"),this.tooltipRole&&this.tooltipRole.destroy(),this.tooltipRole=new s({target:e,body:i.OwnerSentence,position:"left"}));this.absent&&((e=this.container.getElement(".IM-username-role")).classList.remove("hidden"),e.setText(i.hasLeft||"has left"),this.container.classList.add("absent"));return!0},setFonticon:function(e){this.container.getElement(".IM-contact-fonticon").classList.remove("hidden"),this.container.getElement(".IM-contact-fonticon").classList.add(e)},_createContent:function(){this.setContainer({tag:"div",class:"IMWContactView",html:[{tag:"div",class:"IM-contact",html:[{tag:"img",class:"IM-contact-img",draggable:"false",src:document.rtcwidget_Swym_URL+this.user.get("login")+"/format"},{tag:"div",class:"IM-user-status contact"}]},{tag:"div",class:"IM-contact-details",html:[{tag:"div",class:"IM-username",text:this.user.get("username")},{tag:"div",class:"IM-username-role hidden"}]}],events:{click:function(e){}}}),this.changeUserStatus()},inject:function(e){this.container.inject(e)}})}),define("DS/InstantMessagingW/js/view/smileycodes",[],function(){"use strict";var e=[];return e[0]=";)",e[1]=":(",e[2]=":angry:",e[3]=":)",e[4]="^^",e[5]="(y)",e[6]="<3",e[7]=":hourglass:",e[8]=":D",e[9]=":mug:",e}),define("DS/InstantMessagingW/js/view/IMWfmot",["UWA/Class/View","DS/RTProxyDriver/RTLogger","DS/InstantMessagingW/assets/svg_icons_widget","DS/UIKIT/Input/Button","DS/UIKIT/Tooltip","i18n!DS/InstantMessagingW/assets/nls/feed","DS/UIKIT/Spinner"],function(e,t,s,i,n,a,o){"use strict";return e.extend({tagName:"div",id:"FMOT",setup:function(e){this.loading()},show:function(){this._parent(),this.isHidden=!1},hide:function(){this._parent(),this.isHidden=!0},setForUser:function(e){this.render();var t=document.rtcwidget_Swym_URL+e.get("login")+"/format";this.container.children.fmotAvatar.children.fmotAvatarImg.src=t},loading:function(){this.container.setContent([{id:"spinner",tag:"div",html:[{id:"spinnerspan",tag:"span",html:"Loading"}]}]),this.spinner=(new o).inject(this.container.children.spinner).show()},render:function(){var e;this.spinner&&this.spinner.destroy(),this.container.setContent([{id:"fmotAvatar",tag:"div",html:[{class:"divider",tag:"p"},{id:"fmotAvatarImg",tag:"img"},{id:"welcome",tag:"div",html:[{id:"fmotWelcomeText",tag:"div",html:a.fmotWelcomeText},{id:"fmotStartText",tag:"div",html:a.fmotStartText}]}]},{id:"fmotCreation",tag:"div",html:[{id:"fmotChannel",class:"fmotcontainer",tag:"div",html:[{id:"fmotChannelImg",class:"fmotimg",tag:"div",html:[{id:"fmotChannelSVG",tag:"div",html:s.room_default_recropped},{id:"fmotChannelInfo",tag:"div",class:"fonticon fonticon-info "}]},{id:"fmotChannelButton",tag:"div"}]},{id:"fmotDM",class:"fmotcontainer",tag:"div",html:[{id:"fmotDMImg",class:"fmotimg",tag:"div",html:[{id:"fmotDMSVG",tag:"div",html:s.group_chat},{id:"fmotDMInfo",tag:"div",class:"fonticon fonticon-info "}]},{id:"fmotDMButton",tag:"div"}]},{id:"fmotDiscover",class:"fmotcontainer",tag:"div",html:[{id:"fmotDiscoverImg",class:"fmotimg",tag:"div",html:[{id:"fmotDiscoverSVG",tag:"div",html:s.magnifier},{id:"fmotDiscoverInfo",tag:"div",class:"fonticon fonticon-info "}]},{id:"fmotDiscoverButton",tag:"div"}]}]}]),this.channelBtn=new i({value:"Room",className:"primary"}).inject(this.container.getElement("#fmotChannelButton")),this.dmBtn=new i({value:"Direct Message",className:"primary"}).inject(this.container.getElement("#fmotDMButton")),this.discoverBtn=new i({value:"Discover",className:"primary"}).inject(this.container.getElement("#fmotDiscoverButton")),this.channelBtn.addEvent("onClick",(e=this,function(){e.dispatchEvent("startChannelCreation")})),this.dmBtn.addEvent("onClick",function(e){return function(){e.dispatchEvent("startDMCreation")}}(this)),this.discoverBtn.addEvent("onClick",function(e){return function(){e.dispatchEvent("showBigDisco")}}(this)),this.tooltiChannel=new n({position:"right",target:this.container.children.fmotCreation.children.fmotChannel.children.fmotChannelImg.children.fmotChannelInfo,body:a.ChannelCreationInfo}),this.tooltiChannel=new n({position:"right",target:this.container.children.fmotCreation.children.fmotDM.children.fmotDMImg.children.fmotDMInfo,body:a.DMCreationInfo}),this.tooltiDiscover=new n({position:"right",target:this.container.children.fmotCreation.children.fmotDiscover.children.fmotDiscoverImg.children.fmotDiscoverInfo,body:a.DiscoverInfo})}})}),define("DS/InstantMessagingW/js/view/IMWBOTMessageView",["UWA/Class/View","DS/UIKIT/Input/Select","DS/UIKIT/DropdownMenu","DS/WAFData/WAFData"],function(e,t,s,i){"use strict";return e.extend({tagName:"div",className:"IMWBOTMessageView",setup:function(e){this.searchUser=e.searchUser,this.assignTask=e.assignTask,this.listOfValues={Create:"Preliminary",Assign:"Ready",Active:"In Work",Review:"In Review",Complete:"Complete"},this.dropdowns={},this._createContent(e)},_createContent:function(e){var t=e.message.get("message");this.message=t;e.message.get("origin");var s=t.tasks,i=t.apps,n=t.projects,a=new Date(e.message.get("createDate")),o=(a.toLocaleDateString("en-US",{weekday:"long",month:"long",day:"numeric"}),a.getHours()),r=a.getMinutes(),l=(o<10?"0"+o:o)+":"+(r<10?"0"+r:r);if(this.setContainer({tag:"div",class:"IMWMessageView-global",draggable:"false",html:[{tag:"div",class:"IMWMessageView",html:[{tag:"div",class:"IM-message-contact",html:[{tag:"img",class:"IM-message-contact-img",draggable:"false",styles:{"border-radius":"0"},src:t.icon}]},{tag:"div",class:"IM-message-details",html:[{tag:"div",class:"IM-message-user",html:[{tag:"div",class:"IM-message-username",html:t.title},{tag:"div",class:"IM-message-time",html:l}]},{tag:"div",class:"IM-message-text",html:t.txt}]}]},{tag:"div",class:"IM-message-bot-tasks",styles:{"margin-left":"20px"}}]}),s&&s.length)for(var c=0;c<s.length;c++)this.addTask(s[c]);if(i&&i.length)for(c=0;c<i.length;c++)this.addApp(i[c]);if(n&&n.length)for(c=0;c<n.length;c++)this.addProjects(n[c]);"webservice"==e.message.get("origin")&&this.setContainerForWS()},setContainerForWS:function(){try{this.message.txt=this.message.txt.replace(/\\n/g,"");var e=JSON.parse(this.message.txt),t=e.type,s=e.value.content||e.value.htmlContent;e.value.link||e.enclosures&&e.enclosures.link}catch(e){return console.error(e)}var i=this.container.getElement(".IM-message-text");i.innerHTML="",i.setContent({tag:"div",html:[{tag:"div",html:s}]}),"Continuous Delivery"==t?(this.container.getElement(".IM-message-username").innerHTML="Delivery Pipeline",this.setIcon()):"Service Monitoring"==t?(this.container.getElement(".IM-message-username").innerHTML="Service Supervision",this.setIcon()):"CollaborativeTasks"==t&&(this.container.getElement(".IM-message-username").innerHTML="Collaborative Task",this.setIcon("https://devopsrioqe420211432-euw1-20dsw10517-space.3dx-staging.3ds.com/enovia/widget/images/MyApps/ENOTASK_AP_AppIcon.png"))},setIcon:function(e){var t=e||"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAANqElEQVR4XuWbCVhTVxbH/wkQEhIgBIJUC4IIKKJFQcWl2jqCS11AZKp+tmpHsNbWpdZqp45LR1udTmvrV2vd0S72q2ur1hW0UlutIhSXio5CgbqxE7KQ7c13XvIggbCIQdOZ9303Ly/vvvvu+d1zzj13CQ//5wfvscofMyEQjD5e5iVdUFZe2b5+XVxdBTpPd4+8+6WlO2Fg9uP8rmx71/exAZCPmLGmuKxsro/cBz17RyEsPBxubm4AGDAM+4nS4hIU5Bcg+0ImSktK4OEuya6qVszD2d2n7AXi0QOIjJdKfWU5Wp3Bf2xSImJHDiNpWYEZkor7bj6broHcq7/h4N79uPHbNYjEotXq9B2L7AHh0QKIjJf6BbS/5SIUeU1/ZQb8AzuCYRoKXqcFBMR0n9OKk0eOYfeXO+HuLt6jOJE6/mEhPFIAPiOSr8DJOXzZ6nchqqfuXEvXATELzmoFB8F0Pnf6DL7YvAVgeAn45Zv9DwPh0QGISZoKBtuWrVoJ/8CA2hatFdz8hTUFs9pbtr6lb6CsBOBKVnaFMn27l2MBiBn/DMB/Bgwj9ZBIBkvEQneFSlPgxOf3CY98SvzSzJRG7Zxa39TgTfsDultWXIJ3Fix6aC2wnwb0Top09xCfUlQrPf07BsBNLAZ5eB+5HAX5+bh29RqWrloJb7k328JN2XlLnCJB+vfSd6CsKFtdeSK11Q7RPgB6J0W6uQkzu3Tvxp849QX4+PjUOq76qmtyaFwLN27nlr1BY7D27/waN3J+vXn3wPrOrTUDuwDwj591XuzlHb1w6dtNdmWsuFbdnLWXbxKWDd9w9NsDOH30qK6mRvspGN6p1jhEuwBA3yTm1TfmoVd0VLP9eaN23kQM0Ngz/7l2HVeysnC7sAi3rl+HRCKuqq6uXopzuz9qqUbYDcDSVSvYfr1Z1bXRrTX7jFVQZNtBlpeUIvOnn5F28BDEEnG2srTiWWTvr2gOxIMBiIyXQugS7yYWj5IIRd3VNRo/haLag16y4B9/R2h4FzMAU2TXanXn+v1WwCJt2PLhGjjxeHnKk9s72Q9A3/FzXVwEq3Q6nWvP6CgEBHaEyE0Eb7kchfm/o//gpyFjnR8nuMnZtbRbsyesO4WF2LrmY3r1as2ppkPmFmmAcNAL6zU1mpfHjh+H2JHDWcHrx+326NbsCevnk+k4snsvwHMKwtmv8xvThOYBsENWQ97EKZMxdMRwq9Hag4Sv9rBzy/e1BNbqBW9Co1bNa8opNg+gOSP6k9+3BhAzPhUMb8pDycRjtuPs7qlsGY5eHgBrAH2TGE+JGyJDAmsZGBgGOgMlI3RGBnpzMhgZGM1OjstcUV6OiooK4NwuU7kOVt7dO3eg0Wjq6mcLwOCe4Ti1flktAEWNHsVKLUqUWpSqdChX61Cp0aNaq4dGb7RSlpNpaaBkCcCRytu6aRPy8/KaBjAwsisyPlvOClajN6JCo0OZSocytelM11UsAAO0huYBOFJ5LQIQ070LvvtoMXg8QKtnoNTq2RYnwelMibRCpTOw5mB52NIARyqvRQCiuoVhx3sLWedAAqr1BlTXGKDQkuAGVnil1gCN3mAe1tYh4AD8sGEl++PgGW/DkcprEYCnuoZg7ZL5rAaQhtcYjFDrDFBpDVDqDKzwdF2/9UlgDkB1+nYWgGTIFDhSeS0CEB7WGSsXzmE1gDSc7JwgaHQmEOT46ts+pwMcAEVaKvuT+1+mwpHKaxGAsJBgLJo7yxTDm82ABNaygjONCm+pAVUntrHPewydBkcqr0UAgoM7Yfasl00AGIDiAMu+v6kgidOAyuNb2GyesX+DI5XXIgBBQUFInpFSqwE0oqvn7BtlwAGoOLaZzSONmw5HKq9FAAKDgvBScnJTDd0sgPKjm9g8XsOS4UjltQiAUCiE3xNPtAoAFwqXHdnIPi8bngKpVIqeUVGtKi/v1i02crNXeVmZmdaheoNQ2A6Dl4lD+2HdfNNYaNYHqdh54udWCc89ZO/yYDlYawDA9FbqAfmUVn11JMHHW/bl9CXvO9uSovT7z1olnPdIk5Otf9i7vNQVb2ruFpdOWTRp+D7q1c3JKnytPx9A1xwA508PZOwIaidLGvFa3eDIstIlh9a3CoDPczNtPmfv8jI2rcTFm3e/nZMwaAL16BYAaiHYAkCt7wTA5cP9GXdGRga5d3l+ns0KF7cSgLwRAPYuL2/PWuw6d0PzZuIgHwA6AIb6WmALgBOiRg3xlvlOkHp6TL1Z+EeTs0b9I0IwoEco+ncPwYDuoTZBnbl0HT9duoEzOdfx0+UbTWqNvcsL9u9g1Or1+wsL8zcg82C6GYJNDeDU3xl9k2pao9v3D6yz+ZjvaFNk+aCHvcvDuV2uZlNgV+g4h8fVq9b2AQiX70wrSuwdLJG7ix603g6Vv0qtReqP1zQrJ8f6AdDU8wVWU2IEgGxfMPGtD3sHdYtInx3bg/yBQx++cl+oVCqoNWoYDGTiDY9NJ68ofi8semXzgil7AWgtzYCz7zr1BwQLt363PaS977hRkR0dWniq3Nix8Zg8eTISEhIgk8mg0aih1ZKMdcf5vPs4nn1z39qZ4140A6AegTUDSwDU2i4AXOdtPVw0pmegpIuf1CYAPz/SJuvj7t27DX6zla8xoraep7zNlREREcG2vF6vR3x8PBITExEdHQ2lUgm1Ws2+rkKlxbq0S5pPUkZRxcm/UY9AcYEVAFb9R897t3dA1x7pi0f3alT9p0yZyqqdZTp37mwD2SifTqdjK2frbPlbVtZFm2yoDE5AOlt+p3Lr/0bXoaGhmDRpEkawCzmmY9WhbM29P4pSvl6assfSDDjVpzNFe4K56/f8K6hDu5lJ0UGNqv/UqdMaADh7tmHIS/laCuDixUyb76MyHhSAXC5HcvJ0jBkzprbMg78W4Exuwb7tc5+3MgPLyI9V/+R1+3PH9wluF9FB5vD2TxWMi42rBdS/f38k/TUJvXr1alD32xVKrD12WfP53HFWZsABYNW/34uvhwX3GnhhdVIfh/f+nIQJCeMwdOhQJCaOa9ZfLN57QXPvdlHK9++9WmsGln2/YPCsFbExMX33zh7S9U/R+g9ayT1Zhczh81c+OLx8Oi18UFeh5/p+Vv37pSyJGzDg6W+Wj+8PlUrJ2q/RaL348aAvfdz5+Xw+XFxcIJFIsDE9BwcystacWDWTALC9Qa3zAyDqOWVBnCSg21cfT4tDz6DWTYo8boEbe3/apTzM234CXnz1x6ffn/NPANRHagmAwJzEERNmxzn7d99RUKqAp8gVHkIBxK4uELo4w8WJb976Zr13t+GuTtv3ua1x3J5fyx2iXBmWeSw3XHC7R0k47nlurpIWaI3mhVrSVlq0pYlcA/fdQL8Z2YndsHaeNS6Ke8syNy6haWslB4AGCEJaxwhLeHmYS6deW26XV/9PAujSzlOpuZU1O3ffZ8cAKMgMSANotEPJI/i56XGC0KgN9yrVbQ5gdI8ATIrpDIlIgAq1DrvO38KeCzdtbLA0b6U3D2AfRgM6yyVKZe75+fnfbyMAVWQGBEAMgP6p4On91KAeHWIn7y4qq+Y9KhOQewiROn0Ijl0uwgdHstsUQKDMTaXMPbuw6OgXBIC20KkIgLsZAgX+vhHzN/xwu1zZ5hpAkg4M9cPrcT1QqtJi2paTtVto6+8ltpcPeNJTqFJd/XHxnZPfEIByANUEgPb5SWganwCEzVmfXqxoexN4ISYEI3v44/DlInTtIIOvhwhSsRAKjQ4TP6X61W2btxcAP4mrSn01Y+n907uPAygjP0AAPC0AtAt69ZMTlSptm2nAG3ER6P6kDHweH9VaHQ7lFKJfyBMIb+/FasHdSlWD3eR2A+Ah1Jcc35qsvJGdA6DUFgDfJ2euTVPV6NsMgI9EiNeGhIPH46GHvwz3qjR4a88v2DFjKPKKFUjeRqbAdni1f5ywFwC5uxBF62ePBHDPrAFVnAmQIyQT8GmX8tEPOr2xzQCkThuIYkUNOvl6wonPw+aMXOy7mI+l8b3xdFh7zP4iAzmF1Dj2ByB1E+DexrnDABRbmgA5QbYXoNUs6YurjvKdBR5t0QvMjw1Hn06+4PH4oBB114VbGNE9AK4CZ0hErqhU08TFZaRdKWoTAGKBM8q2vv6sWf2pF2CdILU+BUIEQuo2YcVegUgU5OUmtHskuDN5EGhj2a9F5dj643XcV2jYvcW+7iL4eIhwqbC0zbpBWuF2gqGq+vNFpAHUA1AcwHaDFARRNEha4O4UOSLapdvgbc5OfJ6nSOgscObDmU8tZpo947YGmrdBW+0TMpmueTs7N+/M/QHK6n+BdRG75eZqk+XXfXCT93W/me9bmge9r/ZPGKbvFB5zoTKdDUaDnh7RF+Qs02d8ddAsfDXNEpNUJDyNBkkLCIYY3sHt0TlqAN9d1pVhDAIYjM5g9E5gGD6b2IN2ETnawTDg8QkHA56TATwnPY/P10OrKjTmnjqO4qI7pPbmcQBNkbOhMAnPToiYYXAguBCZrukel4/ychMpDkfAYhGUZn5pzE/DXhr5WSYSnu6xw2ESiFqV5gQpsXMDFqNEuqZE99hVY4tVZUfSAkuLoUkMWiQgCDQDTMJyMFjBzfcM3IwQdyYYlDgY3HcOEie8IwleXwu5ZS8OAgeCYFCiay4Z/wtxqxLY2piLyQAAAABJRU5ErkJggg==";this.container.getElement(".IM-message-contact-img").src=t},addProjects:function(e){var t=this.container.getElement(".IM-message-bot-tasks");UWA.createElement("div",{class:"IMWMessageView",styles:{"border-left":"4px solid rgb(0, 86, 134)"},html:[{class:"IM-message-details",styles:{display:"inline-grid"},html:[{tag:"div",class:"IM-message-user",html:[{tag:"div",class:"IM-bot-title",html:e["dsxplan:label"]},{tag:"div",class:"IM-message-time",html:""}]},{tag:"div",class:"IM-message-text",styles:{background:"transparent",display:"inline-flex"},html:[{tag:"div",class:"IM-BOT-tast-state",html:"ID : "+e["@id"]}]}]}]}).inject(t)},addApp:function(e){var t=this.container.getElement(".IM-message-bot-tasks");UWA.createElement("div",{class:"IMWMessageView",styles:{"border-left":"4px solid rgb(0, 86, 134)"},html:[{tag:"div",class:"IM-message-contact",styles:{"margin-left":"5px"},html:[{tag:"img",class:"IM-message-contact-img",draggable:"false",styles:{"border-radius":"0"},src:e.icon}]},{class:"IM-message-details",styles:{display:"inline-grid","margin-left":"10px"},html:[{tag:"div",class:"IM-message-user",html:[{tag:"div",class:"IM-bot-title",html:e.title},{tag:"div",class:"IM-message-time",html:e.state}]},{tag:"div",class:"IM-message-text",styles:{background:"transparent",display:"inline-flex"},html:[{tag:"div",class:"IM-BOT-tast-state",html:e.detail}]}]}]}).inject(t)},addTask:function(e){var t=new Date(e.dataelements.originated),n=this.container.getElement(".IM-message-bot-tasks");UWA.createElement("div",{class:"IMWMessageView",styles:{"border-left":"4px solid rgb(0, 86, 134)"},html:[{class:"IM-message-details",styles:{display:"inline-grid"},html:[{tag:"div",class:"IM-message-user",html:[{tag:"div",class:"IM-bot-title",html:e.dataelements.title,events:{click:function(t){if(console.log("3DIM - TASK click"),window.parent.location.href.indexOf("/app:ENOTASK_AP/content")>-1){var s=window.parent.location.href.substring(window.parent.location.href.indexOf("/app:ENOTASK_AP/content"),window.parent.location.href.length);window.parent.location.href=window.parent.location.href.replace(s,"")}window.parent.location.href+="/app:ENOTASK_AP/content:ids="+e.id}}},{tag:"div",class:"IM-message-time",html:t.toDateString()}]},{tag:"div",class:"IM-message-text",styles:{background:"transparent",display:"inline-flex"},html:[{tag:"div",class:"IM-BOT-tast-state",html:this.listOfValues[e.dataelements.state]},{tag:"span",class:"fonticon fonticon-down-open BOT-task-dropdown BOT-task-dropdown_"+e.id},{tag:"div",styles:{"margin-left":"10px",display:"inline-flex"},html:[{tag:"div",html:"Assigned: "},{tag:"div",contenteditable:"true",html:0!==e.relateddata.assignees.length&&e.relateddata.assignees[0].dataelements&&e.relateddata.assignees[0].dataelements.firstname&&e.relateddata.assignees[0].dataelements.lastname?e.relateddata.assignees[0].dataelements.firstname+" "+e.relateddata.assignees[0].dataelements.lastname:"",events:{keydown:function(t){if(console.log("3DIM - Edit Assign"),t.stopPropagation(),13===t.keyCode&&""!==this.innerHTML){var s=this.innerHTML,i=this;o.searchUser(s,function(t){var s=t.data[0].dataelements.firstname+" "+t.data[0].dataelements.lastname;o.assignTask({user:t,task:e},function(e){i.innerHTML=s})})}}},styles:{"white-space":"nowrap",width:"200px",overflow:"hidden"}}]}]}]}]}).inject(n);var a=this.container.getElement(".BOT-task-dropdown_"+e.id),o=this,r=new s({target:a,items:[],events:{onClick:function(t,s){t.stopPropagation();var n=s.name,a=document.rtcwidget_Space_URL+"/resources/v1/modeler/tasks?tenant="+document.rtcwidget_PlatformID_URL+"&SecurityContext=ctx%3A%3AVPLMProjectLeader.Company%20Name.Common%20Space&e6w-lang=en&e6w-timezone=-120&showProjectTasks=true&currentTaskFilter=all&createSampleData=true&xrequestedwith=xmlhttprequest",l=document.rtcwidget_Space_URL+"/resources/v1/modeler/tasks/"+e.id+"?tenant="+document.rtcwidget_PlatformID_URL+"&SecurityContext=ctx%3A%3AVPLMProjectLeader.Company%20Name.Common%20Space&e6w-lang=en&e6w-timezone=-120&showProjectTasks=true&currentTaskFilter=all&createSampleData=true&xrequestedwith=xmlhttprequest";i.authenticatedRequest(a,{method:"GET",type:"json",timeout:6e4,onComplete:function(t){console.log("TASKS get TOKEN Reponse : ",t);Date.now();var s={csrf:t.csrf,data:[{id:e.id,updateAction:"MODIFY",cestamp:e.cestamp,dataelements:{state:n}}]};i.authenticatedRequest(l,{method:"POST",headers:{"Content-Type":"application/json"},data:JSON.stringify(s),onComplete:function(e){console.log("TASKS Update Reponse : ",e),r.items.forEach(function(e){e.name===n?r.updateItem({id:e.id,text:e.text,name:e.name,icon:"fonticon fonticon-check"}):r.updateItem({id:e.id,text:e.text,name:e.name,icon:""})})}})}}),o.container.getElement(".IM-BOT-tast-state").innerHTML=o.listOfValues[n]}}});for(var l in r.getContent().style.zIndex="3000",this.listOfValues)r.addItem({text:this.listOfValues[l],name:l,icon:l===e.dataelements.state?"fonticon fonticon-check":""})},inject:function(e,t){t?this.container.inject(e,t):this.container.inject(e)}})}),define("DS/InstantMessagingW/js/view/IMWShareContentView",["UWA/Class/View","DS/UIKIT/Spinner"],function(e,t){"use strict";return e.extend({tagName:"div",className:"IMWShareContentView",setup:function(e){this._createContent(e),this.listenTo(this.model,"onChange:shared",this.onStateChange.bind(this))},_createContent:function(e){var s=this;this.setContainer({tag:"div",class:"IM-DnD-item",html:[{tag:"span",class:"fonticon fonticon-cloud-upload IM-DnD-item-ulpload"},{tag:"div",class:"IM-DnD-item-detail",html:this.model.get("name")},{tag:"div",class:"IM-DnD-item-state",html:[this.spinner=new t({visible:!0})]},{tag:"div",class:"IM-DnD-item-state-shared",html:"Shared"},{tag:"span",class:"fonticon fonticon-cancel IM-DnD-item-close",styles:{display:"none"},events:{click:function(e){s.remove()}}}]})},onStateChange:function(e){var t=this;this.container.getElement(".IM-DnD-item-state").style.display="none",this.container.getElement(".IM-DnD-item-state-shared").style.display="block",this.container.getElement(".IM-DnD-item-close").style.display="block",setTimeout(function(){t.remove()},1e4)},inject:function(e,t){t?this.container.inject(e,t):this.container.inject(e),new UWA.Fx(this.container,{duration:250,transition:"linear"}).start({opacity:[0,.9]})},remove:function(){var e=this;new UWA.Fx(this.container,{duration:250,transition:"linear",events:{onComplete:function(){e.destroy()}}}).start({opacity:0,height:0})}})}),define("DS/InstantMessagingW/js/model/IMWRoomModel",["UWA/Class/Model","UWA/Class/Collection","DS/InstantMessagingW/js/model/IMWMessageModel","DS/InstantMessagingW/js/model/IMWContactModel","DS/InstantMessagingW/js/model/IMWMediaModel"],function(e,t,s,i,n){"use strict";return e.extend({defaults:{name:"default conversation",room_id:"noID",devEnv:!1,nway:!1,directmessage:null,pathImage:null,description:null,security:null,type:null,date_in:null,active:!1,userqty:null,mediaqty:null,msgqty:null,alreadyIn:null,lastmsgDate:null},isChannel:function(){return!this.get("directmessage")},setup:function(e){this.messages=new t([],{model:s}),this.users=new t([],{model:i}),this.usersLeft=new t([],{model:i}),this.medias=new t([],{model:n,comparator:"timeMedia"}),this.sharedContent=new t([],{}),this.mySharedContent=new t([],{}),this.lastMessage=void 0,e.imgpath&&this.set({pathImage:e.imgpath}),this.get("pathImage")&&this.set({pathImage:this.get("pathImage").replace("/opt/data",document.rtcwidget_RTC_URL)}),this.get("directmessage")&&this.listenTo(this.users,"onAdd",this.addUser.bind(this))},addUser:function(e){1===this.users.length?this.set("name",e.get("username")):this.set("name",this.get("name")+", "+e.get("username"))},addMedia:function(e){if(0===this.medias.where({media_id:e.media_id}).length){var t=e.date||e.message.date||e.message.createDate,s=new Date(t);"Invalid Date"==s&&(s=new Date(Date.parse(t.replace(" ","T"))));var i=new n({media_id:e.media_id,mime:e.mime,name:e.name,path:e.path,icon:"",timeMedia:s.getTime()});this.medias.add(i)}},addMessage:function(e){if(0===this.messages.where({message_id:e.message_id}).length){var t=e.date||e.createDate||e.dateMsg;if(!t){var i=new Date,n=i.getUTCFullYear(),a=i.getUTCMonth()+1,o=i.getUTCDate(),r=i.getUTCHours(),l=i.getUTCMinutes(),c=i.getUTCSeconds();t=n+"-"+(a<10?"0"+a:a)+"-"+(o<10?"0"+o:o)+" "+(r<10?"0"+r:r)+":"+(l<10?"0"+l:l)+":"+(c<10?"0"+c:c)+"Z"}var d=new Date(t);"Invalid Date"==d&&(d=new Date(Date.parse(t.replace(" ","T"))));var h=this.users.where({login:e.login||e.from})[0];"BOT2"==e.login&&(h=document.bot2);var m=new s({origin:e.origin,message_id:e.message_id,message:e.message,html:e.html,isSent:e.isSent,read_date:e.read_date,fileId:e.fileId,fileName:e.fileName,data:e.data,createDate:d.getTime(),readBy:{},devEnv:!1,user:h,bot:e.bot||!1}),g=m.get("createDate");return(!this.lastMessage||this.lastMessage.get("createDate")>=g)&&(this.lastMessage=m),this.messages.add(m),"media"===e.origin&&this.addMedia({media_id:e.data.media_id,mime:e.data.mime,name:e.data.name,path:e.data.path,date:d.getTime()}),m}return{error:"Message already exist"}},cleanMedias:function(){this.medias.reset()},updateInfos:function(e){if(e.type&&this.set("type",e.type),!this.isChannel())return!0;e.name&&this.set("name",e.name),e.description&&this.set("description",e.description),e.security&&this.set("security",e.security),e.pathImage&&this.set("pathImage",e.pathImage)}})}),define("DS/InstantMessagingW/js/view/IMWMessageView",["UWA/Class/View","DS/InstantMessagingW/js/view/IMWPlayerVideoView","DS/InstantMessagingW/js/view/smileycodes"],function(e,t,s){"use strict";return e.extend({tagName:"div",className:"IMWMessageView",setup:function(e){this.message=e.message,this.isSystem="system"==e.message.get("origin"),this.display3dplayer=e.display3dplayer,this.maximizeChat=e.maximizeChat,this._createContent(e);var t=this.container.getElement(".IMWMessageView-title.unread");t&&setTimeout(function(){new UWA.Fx(t,{duration:400,transition:"linear",events:{onComplete:function(e){t.destroy()}}}).start({opacity:0})},5e3)},_createContent:function(e){var i=this,n=this.message.get("user"),a=this.message.get("fileName");a&&a.substr(a.indexOf(".")+1,a.length);var o=void 0,r=!1,l="toto";if(n&&n.get){var c=n.get("login");l=n.get("username"),o=document.rtcwidget_Swym_URL+c+"/format",r=!0}else l=document.rtcwidget_Me.get("username"),o=document.rtcwidget_Swym_URL+document.rtcwidget_Me.get("login")+"/format";var d=new Date(this.message.get("createDate")),h=d.toLocaleDateString("en-US",{weekday:"long",month:"long",day:"numeric"}),m=d.getHours(),g=d.getMinutes(),u=(m<10?"0"+m:m)+":"+(g<10?"0"+g:g);if("bot"!=e.message.get("origin")){var p=this.message.get("message"),f=s;for(var v in f)for(var I="";I!==p;)I=p,p=p.replace(f[v],'<img class="smileysIcon3DIM" src="'+document.rtcwidget_Smileys_URL+"emoji"+(parseInt(v,10)+1)+'.svg">')}else""===(p=e.message.get("message"))&&(p=e.message.get("html"));if("media"===e.message.get("origin")){var M=document.rtcwidget_Assets_URL+"/I_UnknownFile200x150.png",w="IMWMessageView-media-img",y=!1;switch(e.message.get("data").mime.toLowerCase()){case"gif":case"jpg":case"jpeg":case"png":case"svg":M=e.message.get("data").path.replace("/opt/data",document.rtcwidget_RTC_URL);break;case"pdf":M=document.rtcwidget_Assets_URL+"/I_PDFdoc200x150.png",w="IMWMessageView-media-thumb";break;case"doc":case"docx":M=document.rtcwidget_Assets_URL+"/I_TextDoc200x150.png",w="IMWMessageView-media-thumb";break;case"xls":case"xlsx":M=document.rtcwidget_Assets_URL+"/I_TableDoc200x150.png",w="IMWMessageView-media-thumb";break;case"ppt":case"pptx":M=document.rtcwidget_Assets_URL+"/I_PresDoc200x150.png",w="IMWMessageView-media-thumb";break;case"3dxm":case"3dxml":M=document.rtcwidget_Assets_URL+"/I_3DXML200x150.png",w="IMWMessageView-media-thumb";break;case"stl":M=document.rtcwidget_Assets_URL+"/I_STL200x150.png",w="IMWMessageView-media-thumb";break;case"mpg":case"mp4":y=!0,M=e.message.get("data").path.replace("/opt/data",document.rtcwidget_RTC_URL);break;case"zip":case"rar":M=document.rtcwidget_Assets_URL+"/I_ZIPDoc200x150.png",w="IMWMessageView-media-thumb";break;default:w="IMWMessageView-media-thumb"}var b=void 0;b=y?new t({path:M}):UWA.createElement("img",{draggable:"false",src:M,class:w,events:{click:function(t){console.log("click on 3D content");var s=e.message.get("data").path.replace("/opt/data",document.rtcwidget_RTC_URL);e.message.get("data").mime.toLowerCase();switch(e.message.get("data").mime.toLowerCase()){case"pdf":case"stl":case"3dxml":case"3dxm":case"svg":i.maximizeChat(),i.display3dplayer({mime:e.message.get("data").mime,path:s,fileName:e.message.get("data").name});break;default:var n=b.cloneNode();i.maximizeChat({image:n,message:e.message})}},load:function(t){e.scrollTo()}}}),p=UWA.createElement("div",{html:[{tag:"div",html:"Share this media : <b>"+e.message.get("data").name+"</b>"},b]})}var D=this.message.get("displayUnread");this.setContainer({tag:"div",class:"IMWMessageView-global",draggable:"false",styles:{},html:[D?{tag:"div",class:"IMWMessageView-title unread",html:[{tag:"div",class:"IMWMessageView-date unread",html:"UNREAD MESSAGES"}]}:{},e.displayDate?{tag:"div",class:"IMWMessageView-title",html:[{tag:"div",class:"IMWMessageView-date",html:h},{tag:"div",class:"IMWMessageView-cube-global",html:{tag:"div",class:"IMWMessageView-cube"}}]}:{},{tag:"div",class:"IMWMessageView"+(r?"":" sent"),html:[{tag:"div",class:"IM-message-contact"+(r?"":" sent"),html:[{tag:"img",class:"IM-message-contact-img",draggable:"false",src:o}]},{tag:"div",class:"IM-message-details",html:[{tag:"div",class:"IM-message-user"+(r?"":" sent"),html:[{tag:"div",class:"IM-message-username"+(r?"":" sent"),html:l},{tag:"div",class:"IM-message-time",html:u}]},{tag:"div",class:"IM-message-text"+(r?"":" sent"),html:p}]}]}]}),D&&this.message.set("displayUnread",!1),this.isSystem&&(this.container.classList.remove("sent"),this.container.getElement(".IM-message-contact").classList.add("hidden"),this.container.getElement(".IM-message-user").classList.add("hidden"),this.container.getElement(".IM-message-details").classList.add("systemMessage"))},inject:function(e,t){t?this.container.inject(e,t):this.container.inject(e)}})}),define("DS/InstantMessagingW/js/view/IMWConversationView",["UWA/Class/View","DS/RTProxyDriver/RTLogger","DS/RTColors/RTColors","DS/InstantMessagingW/js/model/IMWContactModel","i18n!DS/InstantMessagingW/assets/nls/feed","DS/InstantMessaging/js/ressources/FileSaver","DS/InstantMessagingW/assets/demo","DS/InstantMessagingW/js/view/smileycodes","DS/InstantMessagingW/assets/svg_icons_widget"],function(e,t,s,i,n,a,o,r,l){"use strict";return e.extend({tagName:"div",className:"IMWConversationView",setup:function(e){this.room=e.room,this.ctrl=e.ctrl,this.startChat=e.startChat,this.unactiveConversations=e.unactiveConversations,this.listenTo(this.room.messages,"onAdd",this.addMessage.bind(this)),this.listenTo(this.room.users,"onAdd",this.addUser.bind(this)),this.listenTo(this.room.users,"onRemove",this.removeUser.bind(this)),this.listenTo(this.room,"onChange:name",this.changeName.bind(this)),this.listenTo(this.room,"onChange:pathImage",this.changeImage.bind(this)),this._createContent(),this.nbUnread=0,this.room.isChannel()||this.updateTitle(),this.currentMsg=void 0},_createContent:function(){var e=this;if(this.setContainer({tag:"div",class:"IMWConversationView",room_id:this.room.get("room_id"),html:[{tag:"div",class:"IM-chat-state"},{tag:"div",class:"IM-chat-contact",html:[{tag:"div",class:"IM-chat-contact-img",draggable:"false"},this.room.get("directmessage")&&!this.room.get("nway")?{tag:"div",class:"IM-user-status room"}:{tag:"div",class:"IM-user-status room hidden"},{tag:"span",class:"fonticon fonticon-lock lockRoom hidden"}]},{tag:"div",class:"IM-chat-details",html:[{tag:"div",class:"IM-chat-msg-info",html:[{tag:"div",class:"IM-chat-username",text:this.room.isChannel()?this.room.get("name"):null},{tag:"div",class:"IM-chat-timer"},{tag:"div",class:"IM-nb-unread",html:{tag:"span",html:1}}]},{tag:"div",class:"IM-chat-message"}]},{tag:"div",class:"IM-chat-reply",html:[{tag:"span",class:"fonticon fonticon-reply"}]},{tag:"div",class:"IM-chat-time",html:[{tag:"div",class:"IM-chat-time-detail"}]},{tag:"div",class:"IM-chat-menu",html:[{tag:"span",class:"fonticon fonticon-open-down"}]}],events:{click:function(s){e.nbUnread=0,e.startChat(e.room),localStorage.setItem("3DIM_ROOM",e.room.get("room_id")),t.Widget("click on room "+JSON.stringify(e.room))},mouseover:function(){e.container.getElement(".IM-user-status")&&"IM-chat-state active"!==e.container.getElement(".IM-chat-state").className&&(e.container.getElement(".IM-user-status").style.border="1px solid #368ec4")},mouseout:function(){e.container.getElement(".IM-user-status")&&"IM-chat-state active"!==e.container.getElement(".IM-chat-state").className&&(e.container.getElement(".IM-user-status").style.border="1px solid #003c5a")}}}),this.room.get("directmessage"))if(this.room.get("nway"))this.displaySVGicon("group_chat");else{var s=this.room.users.first();s||(s=this.ctrl.me),this.displayIMG(document.rtcwidget_Swym_URL+s.get("login")+"/format"),this.listenTo(s,"onChange:status",this.changeUserStatus.bind(this)),this.changeUserStatus(s)}else this.room.get("pathImage")?this.displayIMG(this.room.get("pathImage")):this.displaySVGicon("room_default")},displaySVGicon:function(e){var s=l[e];if(!s)return t.error("svg_icons_widget key not found : "+e);this.container.getElement(".IM-chat-contact-img").innerHTML=s,this.container.getElement(".IM-chat-contact-img").style.opacity="1",this.container.getElement(".IM-chat-contact-img").style.backgroundImage=""},displayIMG:function(e){this.container.getElement(".IM-chat-contact-img").style.backgroundImage="url('"+e+"')",this.container.getElement(".IM-chat-contact-img").style.opacity="0.9",this.container.getElement(".IM-chat-contact-img").innerHTML=""},changeName:function(e){this.container.getElement(".IM-chat-username").setHTML(e.get("name"))},changeImage:function(){this.room.get("pathImage")?this.displayIMG(this.room.get("pathImage")):this.displaySVGicon("room_default")},removeUser:function(e){this.room.isChannel()||(this.updateTitle(),this.room.users.length<=1&&((e=this.room.users.first())||(e=this.ctrl.me),this.displayIMG(document.rtcwidget_Swym_URL+e.get("login")+"/format"),this.listenTo(e,"onChange:status",this.changeUserStatus.bind(this)),this.changeUserStatus(e),this.showUserStatus()))},addUser:function(e){this.room.isChannel()||(this.updateTitle(),this.room.users.length>1&&(this.displaySVGicon("group_chat"),this.hideUserStatus()))},showUserStatus:function(){if(!this.container.getElement(".IM-user-status"))return t.error("no user status div");this.container.getElement(".IM-user-status").classList.remove("hidden")},hideUserStatus:function(){this.container.getElement(".IM-user-status")&&this.container.getElement(".IM-user-status").classList.add("hidden")},changeUserStatus:function(e){if(this.room.get("directmessage")){var t=e.get("status"),i=(e.get("login"),s[t.toLowerCase()]);this.room.get("nway")||("offline"!==t.toLowerCase()?(this.container.getElement(".IM-chat-contact-img").style.opacity="0.9",this.container.getElement(".IM-user-status").style.background=i):this.container.getElement(".IM-chat-contact-img").style.opacity="0.3")}},SaveToDisk:function(e,t){for(var s=e.split(";"),i=s[1].split(","),n=s[0].split(":")[1],o=i[1],r=n,l=atob(o),c=[],d=0;d<l.length;d+=512){for(var h=l.slice(d,d+512),m=new Array(h.length),g=0;g<h.length;g++)m[g]=h.charCodeAt(g);var u=new Uint8Array(m);c.push(u)}var p=new Blob(c,{type:r});return a.saveAs(p,t),!0},addRobotMessage:function(e){var t=e.get("data").name;t.substr(t.lastIndexOf(".")+1,t.length);document.bot2||(document.bot2=new i({status:"Online",login:"BOT2",username:"3DSwym Bot",tenants:"DSQAL006"}));var s={message_id:e.get("message_id")+"_robotmessage",message:null,html:"<div class='robotmessage'>I can add this file in 3DDrive. Do you agree ? <a>Yes please</a><a>No. Maybe next time</a></div>",isSent:!1,fileId:"FILE_ID",fileName:t,readBy:{},devEnv:!1,user:document.bot2,login:"BOT2",data:e.get("data"),origin:"bot"};setTimeout(function(){this.room.addMessage(s)}.bind(this),300)},addMessage:function(e){if(!e.get("bot")){if(e.get("data")&&"string"==typeof e.get("data")&&0==e.get("data").indexOf("data"))return document[e.get("fileId")]=e.get("data"),console.log("loaded the file "+e.get("fileId"));if(void 0===this.currentMsg||e.get("createDate")>this.currentMsg.get("createDate")){if(this.currentMsg=e,-1!=e.get("message").indexOf("<div")||-1!=e.get("message").indexOf("<img")||"data"===e.get("origin")){var t=n.dataReceived;this.container.getElement(".IM-chat-message").setHTML(t)}else{t=e.get("message");var s=r;for(var i in s)for(var a="";a!==t;)a=t,t=t.replace(s[i],'<img class="smileysIcon3DIM" src="'+document.rtcwidget_Smileys_URL+"emoji"+(parseInt(i,10)+1)+'.svg">');"media"===e.get("origin")&&(t=e.get("data").name),this.container.getElement(".IM-chat-message").setHTML(t);var o=new Date,l=new Date(e.get("createDate")),c={weekday:"long",month:"long",day:"numeric"},d=l.toLocaleDateString("en-US",c);if(d===o.toLocaleDateString("en-US",c))d=l.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!1});else{var h=(d=l.toLocaleTimeString("en-US",{month:"short",day:"numeric"})).indexOf(",");-1!==h&&(d=d.substr(0,h))}this.container.getElement(".IM-chat-timer").setHTML(d)}var m=e.get("read_date");"IM-chat-state unread"!==this.container.getElement(".IM-chat-state").className&&"IM-chat-state"!==this.container.getElement(".IM-chat-state").className||!(Object.keys(e.get("user")).length>0)||""!==m&&"none"!==m||(this.nbUnread++,this.container.getElement(".IM-nb-unread").style.display="block",this.container.getElement(".IM-nb-unread").setHTML(this.nbUnread),this.setUnread(!0))}}},updateTitle:function(e){if(this.room.isChannel())return!1;var t=this.container.getElement(".IM-chat-username"),s=this.room.users.first();s||0!=this.room.users.length||(s=this.ctrl.me),t.innerHTML=s.get("username"),this.room.users.forEach(function(e,s){if(0==s)return!0;t.innerHTML+=", "+e.get("username")}.bind(this))},setUnread:function(e){"IM-chat-state active"!==this.container.getElement(".IM-chat-state").className&&(e?(this.container.getElement(".IM-chat-details").style.opacity="0.9",this.container.getElement(".IM-chat-state").classList.add("unread")):(this.container.getElement(".IM-chat-time").className="IM-chat-time",this.container.getElement(".IM-chat-message").className="IM-chat-message",this.container.getElement(".IM-chat-username").className="IM-chat-username",this.container.getElement(".IM-chat-state").classList.remove("unread")))},inject:function(e){this.container.inject(e)}})}),define("DS/InstantMessagingW/js/view/IMWSearchView",["UWA/Class/View","DS/UIKIT/Scroller","DS/InstantMessagingW/js/view/IMWContactView"],function(e,t,s){"use strict";return e.extend({tagName:"div",className:"IMWSearchView",setup:function(e){this.search=e.search,this.startChat=e.startChat,this.listenTo(this.search,"onAdd",this.addUser.bind(this)),this._createContent()},_createContent:function(){this.setContainer({tag:"div",class:"IMWSearchView"}),this.setContainer({tag:"div",class:"IMWSearchView",html:this.scrollerView=new t({element:UWA.createElement("div",{class:"scrollable-body",styles:{height:"100%"},html:{tag:"div",class:"IMWSearchContactsView"}})})})},addUser:function(e){var t=this.container.getElement(".IMWSearchContactsView");new s({user:e,type:"search",startChat:this.startChat}).inject(t)},inject:function(e){this.container.inject(e)}})}),define("DS/InstantMessagingW/js/view/IMWSearchAndSelectView",["UWA/Class/View","DS/RTProxyDriver/RTLogger","DS/RTColors/RTColors","DS/InstantMessagingW/js/model/IMWContactModel","DS/UIKIT/Autocomplete","i18n!DS/InstantMessagingW/assets/nls/feed"],function(e,t,s,i,n,a){"use strict";var o=!1,r={templateEngine:function(e,t,s){e.addClassName("default-template people-search-template with-sub-label"),e.setHTML('<img class="people-search-img" src="'+document.rtcwidget_Swym_URL+s.picture+'"/> <div class="item-label">'+s.value+'</div> <div class="sub-label">'+s.subLabel+"</div>")},filterEngine:function(e,t){if(!o)return this.getItems();var s=[],i=[];return t.forEach(function(e){s.indexOf(e.value)<0&&s.push(e.value)&&i.push(e)}),s}};return e.extend({tagName:"div",className:"IMWSearchAndSelectView",usersFound:{},usersSelection:{},allUsers:{},setup:function(e){this.search=e.search,this.usersFound={},this.usersSelection={},this.doSearch=e.doSearch,this.peopleSearchInput=new n({multiSelect:!0,showSuggestsOnFocus:!0}),this.initDataset(),this.peopleTextInput=this.peopleSearchInput.elements.container.getElementsByTagName("input")[0],this.peopleTextInput.addEventListener("keydown",(s=this,function(e){var t="Backspace"==e.key?this.value:this.value+e.key;return t.length>2?(o=!0,s.doSearch(t),s.unsetNeeded(),!0):(o=!1,!1)}));var t=document.createElement("span");t.id="spanTo",t.innerText=a.To;var s,i=this.peopleSearchInput.elements.container.getElementsByClassName("autocomplete-searchbox")[0];i.prepend?i.prepend(t):i.insertBefore(t,i.firstChild),this.listenTo(this.search,"onAdd",function(e){return function(t){e.addUserToDataset(t)}}(this)),this.render()},render:function(){this.peopleSearchInput.inject(this.container)},addUserToList:function(e,s){if(!e||!e instanceof i)return t.error("bad user arg");if(!s||"found"!=s&&"selected"!=s)return t.error("bad list arg");this.allUsers[e.get("login")]=e,this.usersSelection.container=this.usersSelection.container||this.container.children.IMWSelectedAndInput.children.IMWSelectedUsers,this.usersFound.container=this.usersFound.container||this.container.children.IMWUsersFound;var n="found"==s?this.usersFound:this.usersSelection,a=this.getUserLIview(e);return e.userSearchView=a,a.error?t.error(a.error):n[e.get("login")]?t.Widget("The login "+e.get("login")+" has already been added to list "+s):(n[e.get("login")]=a,n.container?(a.inject(n.container,"top"),e):t.error("can not find container of list "+s))},removeUserFromList:function(e,s){if(!e||!e instanceof i)return t.error("bad user arg");if(!s||"found"!=s&&"selected"!=s)return t.error("bad list arg");var n="found"==s?this.usersFound:this.usersSelection;if(!n[e.get("login")])return t.error("user not found in array");n[e.get("login")].remove(),n[e.get("login")]=null},removeAllUsersFromList:function(e){if(!e||"found"!=e&&"selected"!=e)return t.error("bad list arg");var s="found"==e?this.usersFound:this.usersSelection;for(var i in s)s[i]&&"container"!=i&&(s[i].remove(),s[i]=null);"selected"==e&&this.peopleSearchInput.unselectAll()},removeUserFound:function(e){return this.removeUserFromList(e,"found")},removeSelected:function(e){return this.removeUserFromList(e,"selected")},initDataset:function(){var e=[];this.search.forEach(function(t){e.push({value:t.get("username"),subLabel:t.get("status"),picture:t.get("login")})});var t={name:"Peoples",items:e,configuration:r};this.peopleSearchInput.addDataset(t)},isUserInDataset:function(e){return!!this.allUsers[e.get("login")]},addUserToDataset:function(e){if(this.isUserInDataset(e))return!1;this.allUsers[e.get("login")]=e;var t=[];t.push({value:e.get("username")+" ("+e.get("login")+")",subLabel:a[e.get("status").toLowerCase()],picture:e.get("login")});var s={name:"Peoples",items:t,configuration:{templateEngine:function(e,t,s){e.addClassName("default-template people-search-template with-sub-label"),e.setHTML('<img class="people-search-img" src="'+document.rtcwidget_Swym_URL+s.picture+'"/> <div class="item-label">'+s.value+'</div> <div class="sub-label">'+s.subLabel+"</div>")}}};this.peopleSearchInput.addDataset(s)},addUserFound:function(e){t.error("addUserFound must not be used with useUIKITautocomplete")},addUserSelected:function(e){return this.addUserToList(e,"selected")},getSelectedUsers:function(){var e,s,i,n=[],a=this.peopleSearchInput.getSelection();for(i=0;i<a.length;i++){if(e=a[i].picture,!(s=this.allUsers[e]))return t.error("the user model of "+e+" is not in allUsers");n.push(s)}return n},switchList:function(e){if(!e||!e instanceof i)return t.error("bad user arg");var s;if(this.usersFound[e.get("login")])t.Widget("switch user "+e.get("login")+" from found to selected"),s=this.removeUserFound(e),(s=this.addUserSelected(e)).error&&t.error(s);else{if(!this.usersSelection[e.get("login")])return t.error("user "+e.get("login")+" can not be switched because not found");t.Widget("switch user "+e.get("login")+" from selected to found"),s=this.removeSelected(e),(s=this.addUserFound(e)).error&&t.error(s)}},setNeeded:function(e){this.getContent().classList.add("needed")},unsetNeeded:function(e){this.getContent().classList.remove("needed")},emptySearch:function(){this.peopleTextInput.value=""},getUserLIview:function(e){return!e||!e instanceof i?t.error("bad arg"):UWA.createElement("li",{class:"IMWPeopleInfoView",id:e.get("user_id")||e.get("login"),html:{tag:"div",class:"IM-chatpanel-global",events:{click:(n=this,function(){n.switchList(e)})},html:[{tag:"div",class:"IMWConversationView",styles:{height:"60px"},html:[{tag:"div",class:"IM-chat-contact",styles:{"margin-left":"10px"},html:[{tag:"img",class:"IM-chat-contact-img",src:document.rtcwidget_Swym_URL+e.get("login")+"/format"},{tag:"div",class:"IM-user-status chat-panel",styles:{background:s[e.get("status")]}}]},{tag:"div",class:"IM-chat-details",html:[{tag:"div",class:"IM-chat-username",styles:{"font-size":"15px"},html:e.get("username")},{tag:"div",class:"IM-chat-message",html:e.get("status")}]},{tag:"div",class:"IM-chat-menu",html:[{tag:"span",class:"fonticon fonticon-close"}]}]}]}});var n}})}),define("DS/InstantMessagingW/js/view/IMWRoomCreationView",["UWA/Class/View","DS/UIKIT/Input/Toggle","DS/RTProxyDriver/RTLogger","DS/RTColors/RTColors","DS/InstantMessagingW/js/model/IMWContactModel","DS/InstantMessagingW/js/view/IMWSearchAndSelectView","DS/UIKIT/Input/Button","DS/UIKIT/Modal","i18n!DS/InstantMessagingW/assets/nls/feed","DS/UIKIT/Input/File","DS/InstantMessagingW/assets/svg_icons_widget","DS/UIKIT/Tooltip","DS/UIKIT/Alert"],function(e,t,s,i,n,a,o,r,l,c,d,h,m){"use strict";return e.extend({tagName:"div",className:"IMWRoomCreationView",setup:function(e){return this.defaultName="#",this.defaultVisibility="secret",this.defaultDescription=l.defaultDescription,this.defaultImageUrl=d.room_default_cropped,this.room=e.room,this.inviteUser=e.inviteUser,this.getRoom=e.getRoom,this.doSearch=e.doSearch,this.editRoom=e.editRoom,this.type=e.type,this.search=e.search,this.privacy="public",this.showHistoric=!0,this.setTitle(!1),this.modal=new r({className:"site-reset",closable:!0,header:'<span class="modalTitle">'+this.title+"</span>",body:"",footer:""}),this.isInvit()&&!this.inviteUser?s.error("no inviteUser method"):!this.isDM()&&!this.isChannel()||this.getRoom?this.isEdition()&&!this.editRoom?s.error("no editRoom method"):this.isEdition()&&!this.room?s.error("no room to edit"):void this.render():s.error("no getRoom method")},isChannel:function(){return"channel"==this.type},isInvit:function(){return"invitation"==this.type},isDM:function(){return"dm"==this.type},isEdition:function(){return"edition"==this.type},setTitle:function(e){if(this.isChannel())this.title=l.CreateRoom;else if(this.isDM())this.title=l.CreateDM;else if(this.isEdition())this.title=l.EditRoom;else{if(!this.isInvit())return s.error("type unknown : "+this.type);if(!this.room)return s.Widget("type is invitation|edition but no room specified");this.room.get("directmessage")?this.title=l.InviteInDM:this.title=l.InviteInRoom+" "+this.room.get("name")}e&&this.modal.setHeader('<span class="modalTitle">'+this.title+"</span>")},show:function(){this._parent(),this.IMWNameRoomInput.classList.remove("needed"),this.searchAndSelect.getContent().classList.remove("needed"),this.alert&&this.alert.destroy(),this.searchAndSelect.removeAllUsersFromList("selected"),this.IMWNameRoomInput.innerText=this.defaultName,this.IMWDescriptionInput.innerText=this.defaultDescription,this.chooseImage(),this.searchAndSelect.inject(this.container.children.IMWSearchParams.children.IMWRoomSearch),this.setVisibility(this.defaultVisibility),this.imageBin=null,this.searchAndSelect.emptySearch(),this.modal.show(),"channel"==this.type?this.IMWNameRoomInput.focus():this.searchAndSelect.peopleTextInput.focus()},checkVisibility:function(e){if(this.container.children.IMWVisibilityParam.children.IMWPrivacyInput.children.privateinput.children[0].checked=!1,this.container.children.IMWVisibilityParam.children.IMWPrivacyInput.children.secretinput.children[0].checked=!1,this.container.children.IMWVisibilityParam.children.IMWPrivacyInput.children.publicinput.children[0].checked=!1,"private"==e)this.container.children.IMWVisibilityParam.children.IMWPrivacyInput.children.privateinput.children[0].checked=!0;else if("secret"==e)this.container.children.IMWVisibilityParam.children.IMWPrivacyInput.children.secretinput.children[0].checked=!0;else{if("public"!=e)return s.error("unknown visibilty : "+e);this.container.children.IMWVisibilityParam.children.IMWPrivacyInput.children.publicinput.children[0].checked=!0}},showForRoom:function(e){if("invitation"!=this.type)return s.error("showForRoom must be used only for invitation");this.room=e,this.setTitle(!0),this.show()},hide:function(){this._parent(),this.modal.hide()},getSelectedUsers:function(){return this.searchAndSelect?this.searchAndSelect.getSelectedUsers():s.error("no IMWSearchAndSelectView instance")},getSelectedName:function(){return this.IMWNameRoomInput.innerText},getSelectedDescription:function(){return this.IMWDescriptionInput.innerText},createRoom:function(){var e=this.getSelectedName(),t=this.getSelectedUsers(),i=this.getSelectedDescription(),n=this.privacy,a=this.imageBin;if(this.isChannel()&&(!e||e==this.defaultName))return this.IMWNameRoomInput.classList.add("needed"),this.IMWNameRoomInput.focus(),this.showNameAlert(),!1;if(!this.isEdition()&&0==t.length)return this.searchAndSelect.setNeeded(),this.searchAndSelect.peopleTextInput.focus(),this.showUserAlert(),!1;if(i==this.defaultDescription&&(i=null),e==this.defaultName&&(e=null),this.IMWNameRoomInput.classList.remove("needed"),this.searchAndSelect.unsetNeeded(),this.isEdition()){if(!this.editRoom)return s.error("no editRoom method");this.editRoom(this.room,e,i,n,a),this.hide()}else{if(!this.getRoom)return s.error("no getRoom method");this.getRoom(e,t,this.type,!1,i,n,a),this.hide()}},cancel:function(){this.hide()},inviteUserClick:function(){if(!this.inviteUser)return s.error("no inviteUser method");this.inviteUser(this.room,this.getSelectedUsers()),this.hide()},setPrivacy:function(e){e&&e.target&&e.target.checked?(this.privacy="secret",this.container.children.IMWPrivacyParam.children.IMWPrivacyInfo.innerHTML="Your room will be <b>secret</b> : only invited people can join."):(this.privacy="public",this.container.children.IMWPrivacyParam.children.IMWPrivacyInfo.innerHTML="Your room will be <b>public</b> : everyone can discover and join.")},setVisibility:function(e,t){var s=e.value||e;t&&s!=this.privacy&&"public"==s&&this.showPublicAlert(),this.privacy=s,this.checkVisibility(this.privacy)},setHistoric:function(e){e&&e.target&&e.target.checked?(this.showHistoric=!0,this.container.children.IMWPrivacyParam.children.IMWHistoricInfo.innerHTML="<b>Show historic</b> to users who recently joined the room."):(this.showHistoric=!1,this.container.children.IMWPrivacyParam.children.IMWHistoricInfo.innerHTML="<b>Hide historic</b> to users who recently joined the room.")},showPublicAlert:function(){this.showAlert("alertPublicRoom","warning")},showNameAlert:function(){this.showAlert("alertName","error")},showUserAlert:function(){this.showAlert("alertUser","error")},showAlert:function(e,t){this.alert=new m({visible:!0,autoHide:!0,hideDelay:3e3}).inject(this.container.getElement("#IMWAlert")),this.alert.add({className:t,message:l[e]})},setImage:function(e,t){t?(this.IMWRoomImg.innerHTML=e,this.IMWRoomImg.classList.add("hidden"),this.IMWRoomImgSVG.classList.remove("hidden")):(this.IMWRoomImg.src=e,this.IMWRoomImgSVG.classList.add("hidden"),this.IMWRoomImg.classList.remove("hidden"))},chooseImage:function(){this.room&&this.room.get("pathImage")?this.setImage(this.room.get("pathImage")):this.setImage(this.defaultImageUrl,!0)},render:function(){var e,s,i;this.container.setContent([{id:"IMWRoomCreationTitle",tag:"span",html:this.title},{id:"IMWAlert",tag:"div"},{id:"IMWRoomImgName",tag:"span",html:[{id:"IMWRoomImage",tag:"div",html:[{id:"IMWRoomImg",tag:"img",src:""},{id:"IMWRoomImgSVG",tag:"div",html:this.defaultImageUrl},{tag:"input",type:"file",accept:"image/*",name:"IM-file-browser-file",class:"IM-roomcreation-attach-file",styles:{display:"none"},events:{change:(e=this,function(t){for(var s=t.target.files,i=0;i<s.length;i++){var n=s[i].name,a=new FileReader;a.onload=function(t){for(var s,i=new Uint8Array(t.target.result),a=0,o=i.length,r="";a<o;)s=i.subarray(a,Math.min(a+32768,o)),r+=String.fromCharCode.apply(null,s),a+=32768;var l=n.substr(n.lastIndexOf(".")+1,n.length);e.imageBin={mime:l,name:n,file:btoa(r)},e.setImage("data:image/jpeg;base64,"+e.imageBin.file)},a.readAsArrayBuffer(s[i])}})}},{tag:"span",id:"pencil",class:"fonticon fonticon-pencil IM-roomcreation-pencil interactive",events:{click:function(e){return function(t){e.getElement(".IM-roomcreation-attach-file").click()}}(this)}}]},{id:"IMWNameParam",tag:"div",html:[{id:"IMWRoomNameLabel",tag:"label",html:l.Name+"*"},{id:"IMWNameRoomInput",tag:"div",html:"",contenteditable:!0,events:{focusin:function(e){return function(){return!!e.isEdition()||(this.innerHTML!=e.defaultName||void(this.innerHTML=""))}}(this),focusout:function(e){return function(){""==this.innerHTML?this.innerHTML=e.defaultName:this.classList.remove("needed")}}(this)}}]}]},{id:"IMWDescriptionParam",tag:"div",class:"paramBlock",html:[{id:"IMWDescriptionLabel",tag:"label",html:l.Description},{id:"IMWDescriptionInput",tag:"div",html:this.defaultDescription,contenteditable:!0,events:{focusin:function(e){return function(){return!!e.isEdition()||(this.innerHTML!=e.defaultDescription||void(this.innerHTML=""))}}(this),focusout:function(e){return function(){if(e.isEdition())return!0;""==this.innerHTML&&(this.innerHTML=e.defaultDescription)}}(this)}}]},{id:"IMWPrivacyParam",tag:"div",class:"paramBlock",html:[{id:"IMWPrivacyLabel",tag:"label",html:"Privacy"},{id:"delimiter",tag:"p",html:""},{id:"IMWPrivacyInput",tag:"div",html:new t({type:"switch",value:"secret",label:""})},{id:"IMWPrivacyInfo",tag:"span",html:"Your room will be <b>public</b> : everyone can discover and join."},{id:"delimiter",tag:"p",html:""},{id:"IMWHistoricInput",tag:"div",html:new t({type:"switch",value:"historic",label:""}).check()},{id:"IMWHistoricInfo",tag:"span",html:"<b>Show historic</b> to users who recently joined the room."}]},{id:"IMWVisibilityParam",tag:"div",class:"paramBlock",html:[{id:"IMWPrivacyLabel",tag:"label",html:l.Visibility},{id:"delimiter",tag:"p",styles:{margin:"0"},html:""},{id:"IMWPrivacyInput",tag:"div",html:[{tag:"div",class:"toggle toggle-primary hidden",id:"privateinput",html:[{tag:"input",type:"radio",name:"visibility",id:"private"+this.cid,events:{click:function(e){return function(){e.setVisibility(this,!0)}}(this)},value:"private"},{tag:"label",class:"control-label",for:"private"+this.cid,html:[{tag:"span",class:"fonticon fonticon-lock"},{tag:"span",html:l.Private}]}]},{tag:"div",class:"toggle toggle-primary",id:"publicinput",html:[{tag:"input",type:"radio",name:"visibility",id:"public"+this.cid,events:{click:function(e){return function(){e.setVisibility(this,!0)}}(this)},value:"public"},{tag:"label",class:"control-label",for:"public"+this.cid,html:[{tag:"span",class:"fonticon fonticon-globe"},{tag:"span",html:l.Public}]}]},{tag:"div",class:"toggle toggle-primary",id:"secretinput",html:[{tag:"input",type:"radio",name:"visibility",id:"secret"+this.cid,events:{click:function(e){return function(){e.setVisibility(this,!0)}}(this)},value:"secret"},{tag:"label",class:"control-label",for:"secret"+this.cid,html:[{tag:"span",class:"fonticon fonticon-eye-off"},{tag:"span",html:l.Secret}]}]}]}]},{id:"IMWSearchParams",tag:"div",class:"paramBlock",html:[{id:"IMWRoomSearchLabel",tag:"label",html:l.sendInviteTo},{id:"IMWRoomSearch",tag:"div"}]},{id:"IMWSubmitRoomButton",tag:"div"}]),this.container.children.IMWPrivacyParam.children.IMWHistoricInput.addEvent("change",this.setHistoric.bind(this)),this.IMWNameParam=this.container.children.IMWRoomImgName.children.IMWNameParam,this.IMWNameRoomInput=this.container.children.IMWRoomImgName.children.IMWNameParam.children.IMWNameRoomInput,this.IMWDescriptionInput=this.container.children.IMWDescriptionParam.children.IMWDescriptionInput,this.IMWRoomImgName=this.container.children.IMWRoomImgName,this.IMWRoomImage=this.IMWRoomImgName.children.IMWRoomImage,this.IMWRoomImg=this.IMWRoomImage.children.IMWRoomImg,this.IMWRoomImgSVG=this.IMWRoomImage.children.IMWRoomImgSVG,this.pencil=this.IMWRoomImage.children.pencil,this.IMWRoomCreationTitle=this.container.children.IMWRoomCreationTitle,this.searchAndSelect=document.searchAndSelect||new a({doSearch:this.doSearch,search:this.search}),document.searchAndSelect=document.searchAndSelect||this.searchAndSelect,this.isDM()||this.isInvit()?(this.IMWRoomImgName.classList.add("hidden"),this.container.children.IMWPrivacyParam.classList.add("hidden"),this.container.children.IMWVisibilityParam.classList.add("hidden"),this.container.children.IMWDescriptionParam.classList.add("hidden")):this.isEdition()&&(this.container.children.IMWSearchParams.classList.add("hidden"),this.defaultName=this.room.get("name"),this.defaultDescription=this.room.get("description"),this.defaultVisibility=this.room.get("security"),this.IMWNameRoomInput.value=this.defaultName,this.IMWDescriptionInput.value=this.defaultDescription,this.checkVisibility(this.defaultVisibility)),this.chooseImage(),this.tooltiPencil=new h({position:"bottom",target:this.pencil,body:l.Change}),this.modal.inject(document.body),this.container.inject(this.modal.getBody()),this.container.children.IMWRoomCreationTitle.classList.add("hidden"),this.container.children.IMWPrivacyParam.classList.add("hidden"),this.isInvit()?(s=l.Invite,i=this.inviteUserClick.bind(this)):this.isDM()||this.isChannel()?(s=l.Create,i=this.createRoom.bind(this)):this.isEdition()&&(s=l.Edit,i=this.createRoom.bind(this)),this.createButton=new o({value:s,className:"primary"}).inject(this.modal.getFooter()),this.createButton.addEvent("onClick",i),this.cancelButton=new o({value:l.Cancel}).inject(this.modal.getFooter()),this.cancelButton.addEvent("onClick",this.cancel.bind(this)),this.hide()}})}),define("DS/InstantMessagingW/js/view/IMWNotification",["UWA/Class/View","DS/InstantMessagingW/assets/svg_icons_widget","DS/RTProxyDriver/RTLogger","DS/InstantMessagingW/js/view/IMWMessageView"],function(e,t,s,i){"use strict";return e.extend({className:"IMWNotification",setup:function(e){this.userView=void 0,this.notifications=e.notifications,this.listenTo(this.notifications,"onAdd",this.addNotification.bind(this)),this._createContent()},_createContent:function(){this.setContainer({tag:"div",class:"IMWNotification",html:[{tag:"div",class:"IMWNotification-title",html:[{tag:"div",class:"IMWNotification-title-icon"},{tag:"div",class:"IMWNotification-title-name"}]}]})},addNotification:function(e){this.userView&&this.userView.destroy();var n=e.get("room"),a=e.get("message");if(a.error)return s.error("addNotification failed : "+a.error);if(a=a.clone(),this.timeNotif&&clearTimeout(this.timeNotif),n.get("nway")){this.container.getElement(".IMWNotification-title").style.display="inline-flex";var o=this.container.getElement(".IMWNotification-title-name"),r=this.container.getElement(".IMWNotification-title-icon");if(r.innerHTML="",o.setText(n.get("name")),n.get("directmessage")){if(n.get("nway")||!n.users||0==n.users.length){var l=t.group_chat;r.setHTML(l)}}else if(n.get("pathImage"))UWA.createElement("img",{src:n.get("pathImage")}).inject(r);else{l=t.room_default;r.setHTML(l)}}else this.container.getElement(".IMWNotification-title").style.display="none";"media"===a.get("origin")&&(a.set("origin","chat"),a.set("message","Data received")),this.userView=new i({message:a,displayDate:!1}),this.userView.inject(this.container),this.container.style.top="0px";var c=this;this.timeNotif=setTimeout(function(){c.container.style.top="-100px",c.userView.destroy()},3e3)},inject:function(e){this.container.isInjected()||this.container.inject(e)}})}),define("DS/InstantMessagingW/js/view/IMWSectionMessages",["UWA/Class/View","UWA/Class/Collection","DS/InstantMessagingW/js/view/IMWMessageView","DS/InstantMessagingW/js/view/IMWBOTMessageView"],function(e,t,s,i){"use strict";return e.extend({tagName:"div",className:"IMWSectionMessages",setup:function(e){this.display3dplayer=e.display3dplayer,this.maximizeChat=e.maximizeChat,this.scrollTo=e.scrollTo,this.searchUser=e.searchUser,this.assignTask=e.assignTask,this.messages=new t([],{comparator:"time"}),this._createContent(e)},_createContent:function(e){this.setContainer({tag:"div",class:"IM-section",html:[{tag:"div",class:"IMWMessageView-title",html:[{tag:"div",class:"IMWMessageView-date",html:e.refDate},{tag:"div",class:"IMWMessageView-cube-global",html:{tag:"div",class:"IMWMessageView-cube"}}]},{tag:"div",class:"IM-section-messages"}]})},addMessage:function(e){var t=void 0;t=e.get("bot")?new i({message:e,scrollTo:this.scrollTo,searchUser:this.searchUser,assignTask:this.assignTask}):new s({message:e,displayDate:!1,display3dplayer:this.display3dplayer,maximizeChat:this.maximizeChat,scrollTo:this.scrollTo});var n=new Date(e.get("createDate"));this.messages.add({message_id:e.get("message_id"),time:n.getTime(),view:t}),this.messages.sort();var a=this.messages.indexOf(this.messages.where({message_id:e.get("message_id")})[0]);if(a<this.messages.size()-1&&this.messages.size()>1)t.inject(this.messages.at(a+1).get("view").container,"before");else{var o=this.container.getElement(".IM-section-messages");t.inject(o),this.scrollTo()}},inject:function(e,t){t?this.container.inject(e,t):this.container.inject(e),new UWA.Fx(this.container,{duration:250,transition:"linear"}).start({opacity:[0,.9]})}})}),define("DS/InstantMessagingW/js/view/IMWConversationsView",["UWA/Class/View","DS/InstantMessagingW/js/view/IMWConversationView","DS/InstantMessagingW/js/view/IMWRoomCreationView","DS/UIKIT/Scroller","i18n!DS/InstantMessagingW/assets/nls/feed"],function(e,t,s,i,n){"use strict";return e.extend({tagName:"div",className:"IMWConversationsView",setup:function(e){this.allRoomElements={},this.rooms=e.rooms,this.startChat=e.startChat,this.getRoom=e.getRoom,this.doSearch=e.doSearch,this.search=e.search,this.ctrl=e.ctrl,this.showChannelCreationView=e.showChannelCreationView,this.showDMCreationView=e.showDMCreationView,this.listenTo(this.rooms,"onAdd",this.updateRoomList.bind(this)),this.listenTo(this.rooms,"onRemove",this.removeRoom.bind(this)),this._createContent()},updateRoomList:function(){var e=null;this.rooms.forEach(function(t,s){(t.set("active",!1),this.allRoomElements[t.get("room_id")])&&(this.allRoomElements[t.get("room_id")].getElement(".IM-chat-state").hasClassName("active")&&(t.set("active",!0),e=t),this.removeRoom(t))},this),this.rooms.sortBy("date_in").reverse().forEach(function(e,t){this.addRoom(e)},this),this.unactiveConversations(e)},_createContent:function(){this.setContainer({tag:"div",class:"IMWConversationsMainView",html:this.scrollerView=new i({element:UWA.createElement("div",{class:"scrollable-body",styles:{height:"100%"},html:[{tag:"div",class:"IMWDiscover",html:[{tag:"div",html:n.DISCOVER},{tag:"span",class:"fonticon fonticon-globe",styles:{margin:"auto","margin-right":"17px","font-size":"20px",cursor:"pointer"}}],events:{click:function(e){return function(){e.showDiscover()}}(this)}},{tag:"div",class:"IMWChannels",styles:{color:"#A3B0B9",display:"inline-flex",width:"100%"},html:[{tag:"div",class:"IMWChannels-name",html:"ROOMS",styles:{margin:"10px","font-weight":"bold","margin-left":"20px","font-size":"16px",flex:1}},{tag:"span",class:"fonticon fonticon-plus",styles:{margin:"auto","margin-right":"40px","font-size":"16px",cursor:"pointer"},events:{click:function(e){return function(){e.showChannelCreationView()}}(this)}}]},{tag:"div",class:"IMWChannelsView"},{tag:"div",class:"IMWPeople",styles:{color:"#A3B0B9",display:"inline-flex",width:"100%"},html:[{tag:"div",class:"IMWPeople-name",html:"DIRECT MESSAGES",styles:{margin:"10px","font-weight":"bold","margin-left":"20px","font-size":"16px",flex:1}},{tag:"span",class:"fonticon fonticon-plus",styles:{margin:"auto","margin-right":"40px","font-size":"16px",cursor:"pointer"},events:{click:function(e){return function(){e.showDMCreationView()}}(this)}}]},{tag:"div",class:"IMWConversationsView"}]})})})},addRoom:function(e){var s=new t({ctrl:this.ctrl,room:e,startChat:this.startChat,unactiveConversations:this.unactiveConversations.bind(this)});!e.isChannel()?s.inject(this.container.getElement(".IMWConversationsView")):s.inject(this.container.getElement(".IMWChannelsView")),this.allRoomElements[e.get("room_id")]=s},removeRoom:function(e){("boolean"==typeof e.get("directmessage")?e.get("directmessage"):!e.get("nway"))?this.container.getElement(".IMWConversationsView").removeChild(this.allRoomElements[e.get("room_id")].getContent()):this.container.getElement(".IMWChannelsView").removeChild(this.allRoomElements[e.get("room_id")].getContent()),this.allRoomElements[e.get("room_id")]=null},inject:function(e){this.container.inject(e)},unactiveConversations:function(e,t){if(!e&&this.getElement(".IMWDiscover").hasClassName("activated"))return!0;for(var s=this.container.getElements(".IMWConversationView"),i=0;i<s.length;i++)e&&s[i].getAttribute("room_id")==e.get("room_id")?(e.set("active",!0),s[i].getElement(".IM-chat-time").className="IM-chat-time",s[i].getElement(".IM-chat-message").className="IM-chat-message",s[i].getElement(".IM-chat-username").className="IM-chat-username",s[i].getElement(".IM-chat-state").className="IM-chat-state active",s[i].getElement(".IM-chat-details").style.opacity="0.9",s[i].getElement(".IM-nb-unread").style.display="none",s[i].getElement(".IM-user-status")&&(s[i].getElement(".IM-user-status").style.border="1px solid #368ec4")):"IM-chat-state active"===s[i].getElement(".IM-chat-state").className&&(s[i].getElement(".IM-chat-time").className="IM-chat-time",s[i].getElement(".IM-chat-message").className="IM-chat-message",s[i].getElement(".IM-chat-username").className="IM-chat-username",s[i].getElement(".IM-chat-state").className="IM-chat-state",s[i].getElement(".IM-chat-details").style.opacity="0.3",s[i].getElement(".IM-chat-details").style.opacity="0.3",s[i].getElement(".IM-user-status")&&(s[i].getElement(".IM-user-status").style.border="1px solid #003c5a"));var n=this.container.getElement(".IMWDiscover");t?n.classList.add("activated"):n.classList.remove("activated")},showDiscover:function(){this.unactiveConversations(null,!0),this.ctrl.discoClick()}})}),define("DS/InstantMessagingW/js/view/IMWInfoRoomView",["UWA/Class/View","UWA/Fx","DS/UIKIT/Scroller","DS/UIKIT/Tooltip","DS/RTColors/RTColors","DS/InstantMessagingW/js/view/IMWContactView","DS/InstantMessagingW/js/view/IMWPlayerVideoView","DS/InstantMessagingW/js/view/IMWRoomCreationView","DS/InstantMessagingWebRTC/assets/svg_icons"],function(e,t,s,i,n,a,o,r,l){"use strict";return e.extend({className:"IMWInfoRoomView",setup:function(e){this.display3dplayer=e.display3dplayer,this.maximizeChat=e.maximizeChat,this.numContent=0,this.ctrl=e.ctrl,this._createContent()},_createContent:function(){var e=this;this.setContainer({tag:"div",class:"IMWInfoRoomView",html:{tag:"div",class:"IM-info-global",styles:{},html:[{tag:"div",class:"IM-room-about",html:[{tag:"div",class:"IM-room-about-title",html:"About this conversation",styles:{"font-weight":"bold"}},{tag:"div",class:"IM-room-about-icon hidden",id:"IM-room-about-icon-settings",html:{tag:"span",class:"fonticon fonticon-pencil"},styles:{"font-weight":"bold","margin-right":"20px"},events:{click:function(t){e.displayModalSettings()}}},{tag:"div",class:"IM-room-about-icon",html:{tag:"span",class:"fonticon fonticon-wrong"},styles:{"font-weight":"bold"},events:{click:function(t){e.display()}}}],styles:{"font-weight":"bold"}},{tag:"div",class:"IM-people-details",html:[{tag:"div",class:"IM-people-details-txt",html:[{tag:"div",html:{tag:"span",class:"fonticon fonticon-users",styles:{margin:"auto",color:"#b4b6ba","font-size":"18px",background:"#f4f5f6"}},styles:{height:"58px",width:"58px",display:"inline-flex",background:"#f1f1f1"}},{tag:"div",html:"PEOPLE",styles:{"font-size":"16px","font-weight":"bold",color:"#77797c","margin-left":"20px",flex:"1"}},{tag:"div",class:"IM-people-details-nb-people",html:"0",styles:{"font-size":"16px","font-weight":"bold",color:"#77797c","margin-rigth":"5px",opacity:"0.5"}},{tag:"span",class:"fonticon fonticon-user",styles:{"font-size":"16px","font-weight":"bold",color:"#77797c","margin-rigth":"20px",opacity:"0.5","margin-bottom":"3px"}}],styles:{height:"60px","font-weight":"bold",display:"inline-flex","align-items":"center",background:"#f4f5f6",width:"100%","border-top":"1px solid #d1d4d4","border-bottom":"1px solid #d1d4d4"}},this.scrollerView=new s({element:UWA.createElement("div",{class:"scrollable-body",styles:{overflow:"hidden",flex:"1",background:"white"},html:{tag:"div",class:"IM-people-details-tumb"}})})]},{tag:"div",class:"IM-shared-details",html:[{tag:"div",class:"IM-shared-details-txt",html:[{tag:"div",html:{tag:"span",class:"fonticon fonticon-forward",styles:{margin:"auto",color:"#b4b6ba","font-size":"18px",background:"#f4f5f6"}},styles:{height:"58px",width:"58px",display:"inline-flex",background:"#f4f5f6"}},{tag:"div",html:"SHARED CONTENT",styles:{"font-size":"16px","font-weight":"bold",color:"#77797c","margin-left":"20px",flex:"1"}},{tag:"div",class:"IM-shared-details-nb-content",html:"0",styles:{"font-size":"16px","font-weight":"bold",color:"#77797c","margin-rigth":"5px",opacity:"0.5"}},{tag:"span",class:"fonticon fonticon-doc",styles:{"font-size":"16px","font-weight":"bold",color:"#77797c","margin-rigth":"20px",opacity:"0.5","margin-bottom":"3px"}}],styles:{height:"60px","font-weight":"bold",display:"inline-flex","align-items":"center",background:"#f4f5f6",width:"100%","border-top":"1px solid #d1d4d4","border-bottom":"1px solid #d1d4d4"}},new s({element:UWA.createElement("div",{class:"scrollable-body shared",styles:{overflow:"hidden",background:"#ffffff",flex:"1"},html:{tag:"div",class:"IM-shared-details-tumb",styles:{display:"inline-flex","flex-wrap":"wrap",width:"100%"}}})})]},{tag:"div",class:"IM-calls-details",styles:{display:"none"},html:[{tag:"div",class:"IM-calls-details-txt",html:[{tag:"div",class:"IM-call-svg-icon",styles:{color:"#b4b6ba",width:"58px",height:"58px",padding:"12px","padding-top":"10px",background:"#f4f5f6"},html:{tag:"span",class:"IM-chatpanel-svg",html:l.RTwebrtc_icon_phone,styles:{color:"#b4b6ba"}},events:{click:function(t){e.startAudioCall()}}},{tag:"div",html:"RECENT CALLS",styles:{"font-size":"16px","font-weight":"bold",color:"#77797c","margin-left":"20px"}}],styles:{height:"60px","font-weight":"bold",display:"inline-flex","align-items":"center",background:"#f4f5f6",width:"100%","border-top":"1px solid #d1d4d4","border-bottom":"1px solid #d1d4d4"}},{tag:"div",class:"IM-calls-details-info",styles:{display:"flex","flex-direction":"row","flex-wrap":"wrap",background:"white"}}]}]}})},cleanContent:function(e){for(var t in this.numContent=0,this.tumbs)this.tumbs[t].destroy&&this.tumbs[t].destroy();this.container.getElement(".IM-shared-details").style.display="none"},addSharedContent:function(e){var t=this,s=!1,n=this.container.getElement(".IM-shared-details");if("flex"!==n.style.display&&(n.style.display="flex"),document.getElementById("tumb"+e.get("media_id")))return!1;this.numContent++,this.container.getElement(".IM-shared-details-nb-content").innerHTML=this.numContent;var a=e.get("icon");"mp4"===e.get("mime")&&(s=!0);var r=void 0;r=s?new o({path:a,isClickable:!1}):UWA.createElement("img",{class:"IM-thumb-img",draggable:"false",src:a,styles:{"max-width":"100%","max-height":"100%",width:"100%"}});var l=UWA.createElement("div",{id:"tumb-"+e.get("media_id"),class:"IM-thumb",styles:{width:"22%",height:"calc(attr(width)*3/4)",margin:"5px",cursor:"pointer",display:"flex","align-items":"center","justify-content":"center",background:"#E9E9E9",position:"relative",overflow:"hidden"},html:[{tag:"div",class:"IM-thumb-img-toolbar",html:[{tag:"span",class:"fonticon fonticon-download",styles:{"font-size":"16px",float:"right",opacity:"0.8","margin-top":"5px"},events:{click:function(s){s.stopPropagation(),t.saveFile(e.get("path"),e.get("name"))}}}]}],events:{click:function(s){switch(e.get("mime").toLowerCase()){case"pdf":case"stl":case"3dxml":case"3dxm":case"svg":t.maximizeChat(),t.display3dplayer({mime:e.get("mime"),path:e.get("path"),fileName:e.get("name")});break;case"mp4":var i=UWA.createElement("video",{src:e.get("path"),controls:!0,styles:{"max-width":"100%","max-height":"100%",margin:"auto"}});t.maximizeChat({video:i});break;default:console.log("test");var n=r.cloneNode();t.maximizeChat({image:n,message:{data:e}})}}}});return r.inject(l),this.tumbs||(this.tumbs=[]),this.tumbs.push(l),new i({target:l,body:e.get("name")}),l},saveFile:function(e,t){var s=new XMLHttpRequest;s.responseType="blob",s.onload=function(){var e=document.createElement("a");e.href=window.URL.createObjectURL(s.response),e.download=t,e.style.display="none",document.body.appendChild(e),e.click()},s.open("GET",e),s.send()},cleanPeople:function(){(e=this.container.getElement(".IM-people-details")).style.display="none";for(var e=this.container.getElement(".IM-people-details-tumb");e.firstChild;)e.removeChild(e.firstChild)},setRoom:function(e){this.setPeople(e.users,e.get("room_id"),e.usersLeft),this.room=e},setPeople:function(e,t,s){this.cleanPeople(),this.container.getElement(".IM-people-details").style.display="flex",this.container.getElement(".scrollable-body").style.height=60*e.length+"px";var i=this;e.forEach(function(e,s){new a({user:e,room_id:t}).inject(i.container.getElement(".IM-people-details-tumb"))}),this.container.getElement(".IM-people-details-nb-people").innerHTML=e.length,this.participants=e,s&&s.forEach(function(s,n){0==e.where({login:s.get("login")}).length&&new a({user:s,room_id:t,absent:!0}).inject(i.container.getElement(".IM-people-details-tumb"))})},display:function(){var e=this.container.offsetWidth,t=this.container.parentElement.getElement(".IM-chatpanel-history");this.container.isHidden()||"0px"!==this.container.style.marginRight&&""!==this.container.style.marginRight?(this.container.className="IMWInfoRoomView showMe",this.showPanel=!0,e=this.container.offsetWidth):(this.showPanel=!1,t.className="IM-chatpanel-history");var s=this;new UWA.Fx(this.container,{duration:500,transition:"linear",events:{onComplete:function(){s.showPanel?(s.container.classList.remove("hidden"),t.className="IM-chatpanel-history hideMe"):(s.container.className="IMWInfoRoomView",s.container.classList.add("hidden"))}}}).start({marginRight:this.showPanel?[-e,0]:-e})},inject:function(e){this.container.isInjected()||(this.showPanel=!0,this.container.inject(e))},displayButtonSettings:function(){this.container.getElement("#IM-room-about-icon-settings").classList.remove("hidden")},hideButtonSettings:function(){this.container.getElement("#IM-room-about-icon-settings").classList.add("hidden")},displayModalSettings:function(){this.channelEditionView=new r({type:"edition",room:this.room,editRoom:this.ctrl.editRoom.bind(this.ctrl)}),this.channelEditionView.show()}})}),define("DS/InstantMessagingW/js/view/IMWGroupView",["UWA/Class/View","DS/UIKIT/Accordion","DS/InstantMessagingW/js/view/IMWContactView"],function(e,t,s){"use strict";return e.extend({tagName:"div",className:"IMWGroupView",setup:function(e){this.group=e.group,this.listenTo(this.group.users,"onAdd",this.addUser.bind(this)),this._createContent()},_createContent:function(){var e=this;this.setContainer({tag:"div",class:"IMWGroupView",html:new t({items:[{title:'<span class="fonticon fonticon-users"></span>'+this.group.get("name"),content:{tag:"div",class:"IM-Group-contacts"}}]})}),this.group.users.forEach(function(t,s){e.addUser(t)})},addUser:function(e){var t=this.container.getElement(".IM-Group-contacts");new s({user:e}).inject(t)},inject:function(e){this.container.inject(e)}})}),define("DS/InstantMessagingW/js/model/IMWGroupModel",["UWA/Class/Model","UWA/Class/Collection","DS/InstantMessagingW/js/model/IMWContactModel"],function(e,t,s){"use strict";return e.extend({defaults:{group_id:"noID",name:"DefaultIM",isReadOnly:!1,tenant:"DefaultIM",devEnv:!1},setup:function(e){this.users=new t([],{model:s});for(var i=0;i<e.users.length;i++){var n=new s({email:e.users[i].email,login:e.users[i].login,username:e.users[i].username,status:e.users[i].presence.show});this.users.add(n)}}})}),define("DS/InstantMessagingW/js/view/IMWShareDataView",["UWA/Class/View","DS/InstantMessagingW/js/view/IMWShareContentView"],function(e,t){"use strict";return e.extend({tagName:"div",className:"IMWShareDataView",setup:function(e){this.contents=void 0,this._drop=e.drop,this.timeOut=void 0,this._createContent(e)},_createContent:function(e){this.setContainer({tag:"div",class:"IM-chatpanel-DnD",html:[{tag:"div",class:"IM-chatpanel-DnD-zone",html:[{tag:"span",class:"fonticon handler fonticon-popup IM-chatpanel-DnD-icon"},{tag:"div",class:"IM-chatpanel-DnD-txt",html:"Drop your content here."}]},{tag:"div",class:"IM-chatpanel-DnD-result"}]})},setContents:function(e){if(this.contents){this.stopListening(this.contents,"onAdd"),this.contents.reset();for(var t=this.container.getElement(".IM-chatpanel-DnD-result");t.firstChild;)t.removeChild(t.firstChild)}this.contents=e,this.listenTo(this.contents,"onAdd",this.addContent.bind(this))},addContent:function(e){new t({model:e}).inject(this.container.getElement(".IM-chatpanel-DnD-result"))},display:function(e){var t=this.container.getElement(".IM-chatpanel-DnD-zone");if(e){t.style.display="inline-flex",t.style.opacity="0.9",this.container.style.flex="100%",t.style.flex="1";this.timeOut&&clearTimeout(this.timeOut);var s=this;this.timeOut=setTimeout(function(){new UWA.Fx(t,{duration:250,transition:"linear",events:{onComplete:function(){t.style.display="none",s.container.style.flex="",s.timeOut=void 0}}}).start({opacity:0})},5e3)}else t.style.display="none",this.container.style.flex="",t.style.flex=""},inject:function(e,t){t?this.container.inject(e,t):this.container.inject(e)},domEvents:{drop:"_drop"}})}),define("DS/InstantMessagingW/js/view/IMWChatPanelView",["UWA/Class/View","UWA/Fx","DS/UIKIT/Input/Text","UWA/Class/Collection","DS/UIKIT/DropdownMenu","DS/UIKIT/Tooltip","DS/InstantMessagingW/js/view/IMWSectionMessages","DS/InstantMessaging/js/view/RTSendDataView","DS/UIKIT/Scroller","DS/InstantMessagingW/js/view/IMWInfoRoomView","DS/RTColors/RTColors","DS/InstantMessagingWebRTC/assets/svg_icons","DS/InstantMessagingW/assets/demo","DS/InstantMessagingW/js/view/smileycodes","DS/InstantMessagingW/js/view/IMWShareDataView","DS/UIKIT/Alert","i18n!DS/InstantMessagingW/assets/nls/feed","DS/InstantMessagingW/assets/svg_icons_widget","DS/RTProxyDriver/RTLogger","DS/WAFData/WAFData"],function(e,t,s,i,n,a,o,r,l,c,d,h,m,g,u,p,f,v,I,M){"use strict";var w=function(e){I.Widget(e)};return w.error=I.error,e.extend({className:"IMWChatPanelView",discoveryView:function(e){this.container.getElement(".IM-chat-contact").innerHTML="",this.container.getElement(".IM-chatpanel-topbar-icons").innerHTML="",this.container.getElement(".IM-chatpanel-global-details").innerHTML="",this.container.getElement(".IM-chatpanel-global").classList.add("noselect"),this.container.getElement(".IM-chat-message").innerHTML="",this.container.getElement(".IM-chatpanel-subtopbar").classList.remove("hidden"),this.container.getElement(".IM-chatpanel-svg-icon.backToList").classList.add("hidden"),this.isDiscoveryView=!0},startX3DPhoto:function(e){this.startX3DPhotoLauncher(e)},setup:function(e){if(e.discovery)return this._createContent(),this.discoveryView(),!0;this.unactiveConversations=e.unactiveConversations,this.room=void 0,this.textToSend="",this.sectionDate=new i([],{comparator:"time"}),this.uploadFile=e.uploadFile,this.startX3DPhotoLauncher=e.startX3DPhoto,this.sendMessage=e.sendMessage,this.sendData=e.sendData,this.startCall=e.startCall,this.display3dplayer=e.display3dplayer,this.showInvitationForRoom=e.showInvitationForRoom,this.leaveRoom=e.leaveRoom,this.maxChat=e.maximizeChat,this.miniChat=e.minimizeChat,this.share3dplayer=e.share3dplayer,this.sharex3dphoto=e.ctrl.sharex3dphoto,this.startCoreview=e.startCoreview,this.getArchives=e.getArchives,this.getMedias=e.getMedias,this.ctrl=e.ctrl,this.infoRoomView=new c({display3dplayer:this.load3DPlay.bind(this),maximizeChat:this.maximizeChat.bind(this),ctrl:this.ctrl}),this._createContent()},_createContent:function(){var e=this;this.setContainer({tag:"div",class:"IMWChatPanelView",styles:{"border-top":"1px solid #d1d4d4"},html:{tag:"div",class:"IM-chatpanel-global",html:[{tag:"div",class:"IM-chatpanel-topbar",html:[{tag:"div",class:"IM-chatpanel-user-info",html:[{tag:"div",class:"IM-chatpanel-svg-icon backToList",html:{tag:"span",class:"fonticon fonticon-down-open IM-chatpanel-topbar-icon",styles:{color:"#b4b6ba","font-size":"22px",margin:"auto","-ms-transform":"rotate(90deg)","-webkit-transform":"rotate(90deg)",transform:"rotate(90deg)"}},events:{click:function(t){e.display()}}},{tag:"div",class:"IM-chat-contact noMobile",html:[{tag:"div",class:"IM-chat-contact-img",draggable:"false"}]},{tag:"div",class:"IM-chat-details chatPanel",styles:{color:"#3d3d3d",opacity:1,position:"absolute",right:"0px",top:"0px",bottom:"0px",left:"75px"},html:[{tag:"div",class:"IM-chat-username chatPanel",styles:{"font-size":"18px",color:"#3d3d3d"},html:"nobody"},{tag:"div",class:"IM-chat-message chatPanel",styles:{display:"inline-flex"},html:[{tag:"div",class:"IM-user-status me",styles:{margin:"auto 0","margin-right":"5px"}},{tag:"div",class:"IM-me-details chatPanel",styles:{display:"inline-flex",color:"#77797c",margin:"auto 0","margin-right":"5px"},html:f.online},{tag:"div",class:"IM-me-role-txt",styles:{display:"inline-flex",color:"rgb(87, 184, 71)",margin:"auto 0","margin-right":"5px"},html:"Owner"},{tag:"div",class:"IM-me-separator chatPanel",html:"|",styles:{margin:"0px 5px"}},{tag:"span",class:"IM-me-role chatPanel fonticon"},{tag:"span",class:"IM-me-security chatPanel fonticon"},{tag:"div",class:"IM-me-place chatPanel",styles:{color:"#77797c",margin:"auto 0","margin-right":"5px",overflow:"hidden","text-overflow":"ellipsis"}}]}]},{tag:"div",class:"IM-chat-menu",html:[{tag:"span",class:"fonticon fonticon-open-down"}]}]},{tag:"div",class:"IM-chatpanel-topbar-icons",html:[{tag:"div",class:"IM-chatpanel-topbar-nnbPeople",styles:{display:"inline-flex"}},{tag:"div",class:"IM-chatpanel-svg-icon share",styles:{color:"#b4b6ba",width:"59px",height:"59px",padding:"14px",display:"none"},html:{tag:"span",class:"fonticon fonticon-forward  IM-chatpanel-topbar-icon",styles:{color:"#b4b6ba","font-size":"22px"}},events:{click:function(t){if(document.rtcwidget_x3dphoto)try{e.share3dplayer()}catch(t){e.sharex3dphoto()}else e.share3dplayer()}}},{tag:"div",class:"IM-chatpanel-svg-icon pencil hidden",styles:{color:"#b4b6ba",width:"59px",height:"59px",padding:"14px",display:"none"},html:{tag:"span",class:"fonticon fonticon-pencil  IM-chatpanel-topbar-icon",styles:{color:"#b4b6ba","font-size":"22px"}},events:{click:function(t){if(e.messageMax){var s=e.messageMax.get("data");e.startX3DPhoto({room_id:e.room.get("room_id"),fileName:s.name,url:s.path.replace("/rtc_service/",document.rtcwidget_RTC_URL)})}}}},{tag:"div",class:"IM-chatpanel-svg-icon phone",styles:{color:"#b4b6ba",width:"59px",height:"59px",padding:"12px","padding-top":"10px"},html:{tag:"span",class:"IM-chatpanel-svg",html:h.RTwebrtc_icon_phone,styles:{color:"#b4b6ba"}},events:{click:function(t){e.startAudioCall()}}},{tag:"div",class:"IM-chatpanel-svg-icon video",styles:{color:"#b4b6ba",width:"59px",height:"59px",padding:"12px","padding-top":"10px"},html:{tag:"span",class:"IM-chatpanel-svg",html:h.RTwebrtc_icon_video,styles:{color:"#b4b6ba"}},events:{click:function(t){e.startVideoCall(),e.startCoreview()}}},{tag:"div",class:"IM-chatpanel-svg-icon addUser",styles:{color:"#b4b6ba",width:"59px",height:"59px",padding:"14px"},html:{tag:"span",class:"fonticon fonticon-user-add  IM-chatpanel-topbar-icon",styles:{color:"#b4b6ba","font-size":"22px"}},events:{click:function(t){e.startInvitation()}}},{tag:"div",class:"IM-chatpanel-svg-icon deleteUser",styles:{color:"#b4b6ba",width:"59px",height:"59px",padding:"14px"},html:{tag:"span",class:"fonticon fonticon-user-delete  IM-chatpanel-topbar-icon",styles:{color:"#b4b6ba","font-size":"22px"}},events:{click:function(t){e.leaveCurrentRoom()}}},{tag:"div",class:"IM-chatpanel-svg-icon info",styles:{color:"#b4b6ba",width:"59px",height:"59px",padding:"14px",background:"#368ec4"},html:{tag:"span",class:"fonticon fonticon-info  IM-chatpanel-topbar-icon",styles:{color:"#ffffff","font-size":"22px"}},events:{click:function(t){e.infoRoomView.container.style.width="33%",e.infoRoomView.display(),e.infoRoomView.showPanel?(this.style.background="#368ec4",this.firstChild.style.color="white"):(this.style.background="#f9f9f9",this.firstChild.style.color="rgb(180, 182, 186)")}}},{tag:"div",class:"IM-chatpanel-svg-icon menu-dot",styles:{color:"#b4b6ba",width:"59px",height:"59px",padding:"14px",display:"none"},html:{tag:"span",class:"fonticon fonticon-menu-dot  IM-chatpanel-topbar-icon",styles:{color:"#b4b6ba","font-size":"22px"}},events:{click:function(e){}}},{tag:"div",class:"IM-chatpanel-svg-icon close",styles:{color:"#b4b6ba",width:"0px",height:"59px",display:"block"},html:{tag:"span",class:"fonticon fonticon-cancel  IM-chatpanel-topbar-icon",styles:{color:"#b4b6ba","font-size":"22px",margin:"14px 20px"}},events:{click:function(t){e.minimizeChat(),e.display3dplayer()}}}]}]},{tag:"div",class:"IM-chatpanel-subtopbar hidden"},{tag:"div",class:"IM-chatpanel-global-details",styles:{display:"flex","flex-direction":"row",flex:"1"},html:[{tag:"div",class:"IM-chatpanel-history",styles:{flex:"1",display:"flex","flex-direction":"column"},html:[this.scrollerView=new l({element:UWA.createElement("div",{class:"scrollable-body",styles:{flex:1,overflow:"hidden",margin:"0px 10px",background:"white"},html:{tag:"div",class:"IM-chatpanel-scroll"}})}),this.sDataView=new u({drop:e.sendDataFromDrop.bind(e)}),{tag:"div",class:"IM-chatpanel-input",html:[{tag:"input",class:"IM-chatpanel-attach-file",type:"file",name:"IM-file-browser-file",styles:{display:"none"},events:{change:function(t){for(var s=t.target.files,i=0;i<s.length;i++){var n=s[i].name,a=new FileReader;a.onload=function(t){for(var s,i=new Uint8Array(t.target.result),a=0,o=i.length,r="";a<o;)s=i.subarray(a,Math.min(a+32768,o)),r+=String.fromCharCode.apply(null,s),a+=32768;var l=n.substr(n.lastIndexOf(".")+1,n.length);e.uploadFile({room_id:e.room.get("room_id"),mime:l,name:n,file:r})},e.room.mySharedContent.add({shared:!1,name:n}),a.readAsArrayBuffer(s[i])}}}},{tag:"span",class:"fonticon fonticon-attach IM-chatpanel-attach",events:{click:function(t){e.getElement(".IM-chatpanel-attach-file").click()}}},{tag:"div",class:"IM-chatpanel-send-input",html:[{tag:"div",class:"RTSendMsg",html:[{tag:"div",class:"holderSendMsg",text:"Send message..."},{tag:"p",class:"placeHolderView",contenteditable:"true",spellcheck:"true",events:{keydown:function(t){t.stopPropagation();var s=e.container.getElement(".holderSendMsg");if(""!==this.textContent?s.style.display="none":s.style.display="block",13===t.keyCode&&""!==this.innerHTML){t.preventDefault();var i=g,n=this.innerHTML,a=unescape(this.innerText),o=a.split(" ");switch(o[0]){case"/3DMessaging":switch(o[1]){case"project":if(o[2]&&"list"===o[2]){var r="https://devopsrioqe420211432-euw1-20dsw10517-3dplan.3dx-staging.3ds.com/3DPLAN/v0/invoke/dsxplan:getAllVersions?$mask=dsplan:MVMask.WorkPackage.Basic&xrequestedwith=xmlhttprequest";M.authenticatedRequest(r,{method:"POST",headers:{"Content-Type":"application/json"},data:JSON.stringify(["dsxplan:WorkPackage",!1]),onComplete:function(t){console.log("TASKS ADD Reponse : ",t);var s=JSON.parse(t);e.room.addMessage({message:{bot:"BOT_3DMESSAGING",title:"3DMessaging",txt:"Here are your project :",icon:document.rtcwidget_Space_URL+"/widget/images/MyApps/X3DIMSG_AP_AppIcon.png",projects:s.member},room_id:e.room.get("room_id"),bot:!0})}})}break;case"room":o[2]&&"project"===o[2]?(o[3]&&"set"===o[3]&&(localStorage.setItem(e.room.get("room_id"),o[4]),e.room.addMessage({message:{bot:"BOT_3DMESSAGING",title:"3DMessaging",txt:"Project assigned to room.",icon:document.rtcwidget_Space_URL+"/widget/images/MyApps/X3DIMSG_AP_AppIcon.png"},room_id:e.room.get("room_id"),bot:!0})),o[3]&&"get"===o[3]&&e.room.addMessage({message:{bot:"BOT_3DMESSAGING",title:"3DMessaging",txt:"Project assigned : "+localStorage.getItem(e.room.get("room_id")),icon:document.rtcwidget_Space_URL+"/widget/images/MyApps/X3DIMSG_AP_AppIcon.png"},room_id:e.room.get("room_id"),bot:!0})):e.room.addMessage({message:{bot:"BOT_3DMESSAGING",title:"3DMessaging",txt:"Room URL :"+document.rtcwidget_RTC_URL+"/room/"+e.room.get("room_id"),icon:document.rtcwidget_Space_URL+"/widget/images/MyApps/X3DIMSG_AP_AppIcon.png"},room_id:e.room.get("room_id"),bot:!0});break;case"apps":o[2]&&("enable"===o[2]&&localStorage.setItem("3DIMBOT","enable"),"disable"===o[2]&&localStorage.setItem("3DIMBOT","disable"));var l=localStorage.getItem("3DIMBOT");null===l&&(l="disable");var c=[{title:"Potion",detail:"Create a Potion to manage interactions between your apps, data and events, automatically",state:l,icon:document.rtcwidget_Space_URL+"/widget/images/MyApps/NETDOFT_AP_AppIcon.png"},{title:"Collaborative Task",detail:"Create tasks and manage your project",state:l,icon:document.rtcwidget_Space_URL+"/widget/images/MyApps/ENOTASK_AP_AppIcon.png"}];e.room.addMessage({message:{bot:"BOT_3DMESSAGING",title:"3DMessaging",txt:"Here are your available apps :",icon:document.rtcwidget_Space_URL+"/widget/images/MyApps/X3DIMSG_AP_AppIcon.png",apps:c},room_id:e.room.get("room_id"),bot:!0})}break;case"/task":var d=a.replace(o[0]+" "+o[1]+" ",""),h=o[o.length-1];switch(h&&-1!=h.indexOf("@")&&(o[1]="addAndAssign",h=h.replace("@",""),d=d.replace(" "+o[o.length-1],"")),o[1]){case"list":r=document.rtcwidget_Space_URL+"/resources/v1/modeler/tasks?$terse=true&tenant="+document.rtcwidget_PlatformID_URL+"&SecurityContext=ctx%3A%3AVPLMProjectLeader%2eCompany%20Name%2eCommon%20Space&showProjectTasks=true&currentTaskFilter=all&createSampleData=true&%24language=en&%24timezone=-120&xrequestedwith=xmlhttprequest";M.authenticatedRequest(r,{method:"GET",type:"json",timeout:6e4,onComplete:function(t){console.log("TASKS Reponse : ",t),e.room.addMessage({message:{bot:"BOT_COLLAB_TASK",title:"Collaborative Task",txt:"Here are your tasks :",icon:document.rtcwidget_Space_URL+"/widget/images/MyApps/ENOTASK_AP_AppIcon.png",tasks:t.data},room_id:e.room.get("room_id"),bot:!0})}});break;case"add":null===localStorage.getItem(e.room.get("room_id"))?e.room.addMessage({message:{bot:"BOT_3DMESSAGING",title:"3DMessaging",txt:"Please assign a project : '/3DMessaging room project set ID_PROJECT'",icon:document.rtcwidget_Space_URL+"/widget/images/MyApps/X3DIMSG_AP_AppIcon.png"},room_id:e.room.get("room_id"),bot:!0}):e.addTask(d,function(t){var s={bot:"BOT_COLLAB_TASK",title:"Collaborative Task",txt:"The task '"+d+"' has been created by "+document.rtcwidget_Me.get("username")+". Have a nice day !",icon:document.rtcwidget_Space_URL+"/widget/images/MyApps/ENOTASK_AP_AppIcon.png"};e.sendData({persisted:!0,data:btoa(JSON.stringify(s)),typeData:"BOT_DATA",room_id:e.room.get("room_id"),robotName:"BOT_COLLAB_TASK"}),e.room.addMessage({message:s,room_id:e.room.get("room_id"),bot:!0})});break;case"addAndAssign":e.searchUser(h,function(t){var s=t.data[0].dataelements.firstname+" "+t.data[0].dataelements.lastname;e.addTask(d,function(i){e.assignTask({user:t,task:JSON.parse(i)},function(t){var i={bot:"BOT_COLLAB_TASK",title:"Collaborative Task",txt:"Your task '"+d+"' has been created by "+document.rtcwidget_Me.get("username")+" and assignes to "+s+". "+s+" has been notified.  Have a nice day !",icon:document.rtcwidget_Space_URL+"/widget/images/MyApps/ENOTASK_AP_AppIcon.png"};e.sendData({persisted:!0,data:btoa(JSON.stringify(i)),typeData:"BOT_DATA",room_id:e.room.get("room_id"),robotName:"BOT_COLLAB_TASK"}),e.room.addMessage({message:i,room_id:e.room.get("room_id"),bot:!0})})})})}break;default:for(var m in i)for(var u="";u!==n;)u=n,n=n.replace('<img class="smileysIcon3DIM" src="'+document.rtcwidget_Smileys_URL+"emoji"+(parseInt(m,10)+1)+'.svg">',i[m]);e.sendMessage({message:n,room_id:e.room.get("room_id")}),e.room.addMessage({message:n,room_id:e.room.get("room_id")})}this.textContent="",this.innerHTML="",e.textToSend=""}27===t.keyCode&&""!==this.textContent&&(this.textContent="",this.innerHTML="",e.textToSend="")},keyup:function(t){t.stopPropagation();var s=e.container.getElement(".holderSendMsg");""!==this.textContent?s.style.display="none":s.style.display="block",13===t.keyCode&&""===this.textContent&&(t.preventDefault(),this.textContent="",this.innerHTML="",e.textToSend="")}}}]},{tag:"img",class:"smileyIcon",draggable:"false",events:{click:function(t){var s=e.container.getElement(".smileysIconList");"block"===s.style.display?s.style.display="none":s.style.display="block"}}},{tag:"div",class:"smileysIconList",styles:{width:"166px",height:"70px",border:"1px solid #f1f1f1",position:"absolute",top:"-65px",right:"14px","box-shadow":"0px 0px 10px rgba(0,0,0,0.05)",display:"none",background:"white"}}]}]}]},this.infoRoomView]}]}}),document.rtcwidget_x3dphoto&&this.container.getElement(".IM-chatpanel-svg-icon.pencil").classList.remove("hidden"),this.scrollerView.getInnerElement().onscroll=function(){!e.scrollerView.getInnerElement().scrollTop&&e.room.messages.length>=20&&(console.log("Scroll to top !"),e.getArchives({room_id:e.room.get("room_id"),lastMessageID:e.room.lastMessage.get("message_id")}))},this.initDDView(),this.buildDropDownMenu(),this.buildTooltip()},addTask:function(e,t){var s=[{"dsxplan:usesCalendar":{"@id":"dsplan:EST.Calendar"},"dsxplan:durationIntervalMin":"PT86400S","dsxplan:durationIntervalMax":"PT86400S","@type":"dsxplan:Task","dsxplan:hasContentRepository":"Common Space","dsxplan:label":e,"dsxplan:estimatedStartDate":"2018-05-23T16:04:48.434Z","dsxplan:estimatedEndDate":"2018-05-25T16:04:48.434Z","dsxplan:comment":"","dsxplan:hasMaturity":"Open"},localStorage.getItem(this.room.get("room_id"))+"/dsxplan:hasTask"];M.authenticatedRequest("https://devopsrioqe420211432-euw1-20dsw10517-3dplan.3dx-staging.3ds.com/3DPLAN/v0/invoke/dsxplan:createItemVersion?%24mask=dsplan%3AMVMask%2eTask%2eComplex",{method:"POST",headers:{"Content-Type":"application/json"},data:JSON.stringify(s),onComplete:function(e){console.log("TASKS ADD Reponse : ",e),t(e)}})},assignTask:function(e,t){e=[[{op:"add",path:"/dsxplan:hasAssignee/-",value:{"@id":"iam:"+e.user.data[0].dataelements.name}}],e.task.value["@id"]];M.authenticatedRequest("https://devopsrioqe420211432-euw1-20dsw10517-3dplan.3dx-staging.3ds.com/3DPLAN/v0/invoke/dsxplan:modifyItemVersion?$mask=dsplan:MVMask.Task.Property&xrequestedwith=xmlhttprequest",{method:"POST",headers:{"Content-Type":"application/json"},data:JSON.stringify(e),onComplete:function(e){console.log("TASKS ADD Reponse : ",e),t(e)}})},searchUser:function(e,t){var s=document.rtcwidget_Space_URL+"/resources/v2/e6w/service/PersonSearch?searchStr="+e+"*&tenant="+document.rtcwidget_PlatformID_URL+"&SecurityContext=ctx%3A%3AVPLMProjectLeader.Company%20Name.Common%20Space&e6w-lang=en&e6w-timezone=-120&showProjectTasks=true&currentTaskFilter=all&createSampleData=true&xrequestedwith=xmlhttprequest";M.authenticatedRequest(s,{method:"GET",type:"json",timeout:6e4,onComplete:function(e){console.log("TASKS get TOKEN Reponse : ",e),t(e)}})},buildTooltip:function(){for(var e=[{target:this.container.getElement(".IM-chatpanel-svg-icon.phone"),body:"Audio call"},{target:this.container.getElement(".IM-chatpanel-svg-icon.video"),body:"Video call"},{target:this.container.getElement(".IM-chatpanel-svg-icon.addUser"),body:"Add a user"},{target:this.container.getElement(".IM-chatpanel-svg-icon.deleteUser"),body:f.leave},{target:this.container.getElement(".IM-chatpanel-svg-icon.info"),body:"More information"},{target:this.container.getElement(".IM-chatpanel-svg-icon.close"),body:"Close fullscreen"}],t=0;t<e.length;t++)new a({target:e[t].target,body:e[t].body,position:"bottom"})},buildDropDownMenu:function(){var e=this,t=this.container.getElement(".IM-chatpanel-svg-icon.menu-dot");this.dropdownMenu=new n({target:t,items:[],events:{onClick:function(t,s){switch(s.name){case"info":e.infoRoomView.display();break;case"user-delete":e.leaveCurrentRoom();break;case"user-add":e.startInvitation()}}}}),this.dropdownMenu.getContent().style.zIndex="3000";var s={"user-add":"Add user","user-delete":f.leave,info:"About"};for(var i in s)this.dropdownMenu.addItem({text:s[i],name:i,icon:"fonticon fonticon-"+i})},setupSmileys:function(){this.container.getElement(".smileyIcon").src=document.rtcwidget_Smileys_URL+"smiley.png";var e=g;for(var t in e)(function(t){UWA.createElement("img",{class:"smileysIcon3DIMLarge",draggable:"false",src:document.rtcwidget_Smileys_URL+"emoji"+(parseInt(t,10)+1)+".svg",events:{click:function(s){this.container.getElement(".smileysIconList").style.display="none";var i=e[t]||":)";this.textToSend+=i,this.container.getElement(".placeHolderView").innerHTML+='<img class="smileysIcon3DIM" src="'+document.rtcwidget_Smileys_URL+"emoji"+(parseInt(t,10)+1)+'.svg">',this.container.getElement(".holderSendMsg").style.display="none"}.bind(this)}}).inject(this.container.getElement(".smileysIconList"))}).bind(this)(t)},startInvitation:function(){this.showInvitationForRoom(this.room)},leaveCurrentRoom:function(){this.hide(),this.leaveRoom(this.room)},startVideoCall:function(){var e={type:"video",room_id:this.room.get("room_id")};this.startCall(e)},startAudioCall:function(){var e={type:"audio",room_id:this.room.get("room_id")};this.startCall(e)},addMedia:function(e){var t=this.infoRoomView.addSharedContent(e);e.set("view",t),this.room.medias.sort();var s=this.room.medias.indexOf(this.room.medias.where({media_id:e.get("media_id")})[0]);if(s>0&&this.room.medias.size()>1)t.inject(this.room.medias.at(s-1).get("view"),"before");else{var i=this.infoRoomView.container.getElement(".IM-shared-details-tumb");t.inject(i)}new UWA.Fx(t,{duration:300,transition:"linear"}).start({opacity:[0,.9]})},updatePeopleList:function(e){this.infoRoomView.setPeople(this.room.users,e.room_id||(e.room?e.room.room_id:null)||this.room.get("room_id"),this.room.usersLeft),this.updateTitle()},onJoin:function(e){return this.updatePeopleList(e)},onLeave:function(e){return this.updatePeopleList(e)},updateTitle:function(e){var t=this.container.getElement(".IM-chat-username"),s=this.room.users.first();s||(s=this.ctrl.me),t.innerHTML=s.get("username"),this.room.users.forEach(function(e,s){if(0==s)return!0;t.innerHTML+=", "+e.get("username")}.bind(this))},displaySVGicon:function(e){var t=v[e];if(!t)return w.error("svg_icons_widget key not found : "+e);this.container.getElement(".IM-chat-contact-img").innerHTML=t,this.container.getElement(".IM-chat-contact-img").style.opacity="1",this.container.getElement(".IM-chat-contact-img").style.backgroundImage=""},displayIMG:function(e){this.container.getElement(".IM-chat-contact-img").style.backgroundImage="url('"+e+"')",this.container.getElement(".IM-chat-contact-img").style.opacity="0.9",this.container.getElement(".IM-chat-contact-img").innerHTML=""},showSubTitle:function(){this.container.getElement(".IM-chat-message").classList.remove("hidden")},hideSubTitle:function(){this.container.getElement(".IM-chat-message").classList.add("hidden")},showPresence:function(){this.showSubTitle(),this.container.getElement(".IM-user-status").classList.remove("hidden"),this.container.getElement(".IM-me-details").classList.remove("hidden")},hidePresence:function(){this.container.getElement(".IM-user-status").classList.add("hidden"),this.container.getElement(".IM-me-details").classList.add("hidden"),this.hideSeparator()},showSeparator:function(){this.container.getElement(".IM-me-separator").classList.remove("hidden")},hideSeparator:function(){this.container.getElement(".IM-me-separator").classList.add("hidden")},setDescription:function(e){this.container.getElement(".IM-me-place").innerText=e,this.showDescription()},hideDescription:function(e){this.container.getElement(".IM-me-place").classList.add("hidden")},showDescription:function(e){this.container.getElement(".IM-me-place").classList.remove("hidden")},hideSecurity:function(e){this.container.getElement(".IM-me-security").classList.add("hidden")},showSecurity:function(e){this.container.getElement(".IM-me-security").classList.remove("hidden")},setSecurity:function(e){var t,s;if("private"==e)t="fonticon-lock",s=f.PrivateSentence;else if("secret"==e)t="fonticon-eye-off",s=f.SecretSentence;else{if("public"!=e)return w.error("unknown security "+e);t="fonticon-globe",s=f.PublicSentence}this.container.getElement(".IM-me-security").classList.remove("fonticon-lock"),this.container.getElement(".IM-me-security").classList.remove("fonticon-eye-off"),this.container.getElement(".IM-me-security").classList.remove("fonticon-globe"),this.container.getElement(".IM-me-security").classList.add(t),this.showSecurity(),this.tooltipSecurity&&this.tooltipSecurity.destroy(),this.tooltipSecurity=new a({target:this.container.getElement(".IM-me-security"),body:s,position:"bottom"})},hideRole:function(e){this.container.getElement(".IM-me-role-txt").classList.add("hidden"),this.hideSeparator()},showRole:function(e){this.container.getElement(".IM-me-role-txt").classList.remove("hidden")},setRole:function(e){"owner"==e?(this.tooltipRole&&this.tooltipRole.destroy(),this.tooltipRole=new a({target:this.container.getElement(".IM-me-role-txt"),body:f.IamOwnerSentence,position:"bottom"}),this.showSeparator(),this.showRole()):"member"==e||w.error("role unknown : "+e)},setRoomListeners:function(){this.listenTo(this.room,"onChange:name",this.updateName.bind(this)),this.listenTo(this.room,"onChange:pathImage",this.updateImage.bind(this)),this.listenTo(this.room,"onChange:description",this.updateDescription.bind(this)),this.listenTo(this.room,"onChange:security",this.updateSecurity.bind(this))},unsetRoomListeners:function(){this.stopListening()},updateImage:function(){var e=this.room.get("pathImage");return!!e&&(this.displayIMG(e),!0)},updateName:function(){this.container.getElement(".IM-chat-username").innerHTML=this.room.get("name")},updateDescription:function(){var e=this.room.get("description");e&&this.setDescription(e)},updateSecurity:function(){var e=this.room.get("security");e&&this.setSecurity(e)},startChat:function(e){if(!this.room||this.room.get("room_id")!==e.room.get("room_id")){this.stopListening(),this.room=e.room,this.setRoomListeners(),this.sectionDate.reset(),this.infoRoomView.cleanContent(),this.room.cleanMedias(),window.top.currentRoomId=this.room.get("room_id"),this.getMedias({room_id:this.room.get("room_id")}),this.listenTo(this.room.messages,"onAdd",this.addMessage.bind(this)),this.listenTo(this.room.users,"onAdd",this.updatePeopleList.bind(this)),this.listenTo(this.room.users,"onRemove",this.updatePeopleList.bind(this)),this.listenTo(this.room.usersLeft,"onAdd",this.updatePeopleList.bind(this)),this.listenTo(this.room.usersLeft,"onRemove",this.updatePeopleList.bind(this)),this.listenTo(this.room.medias,"onAdd",this.addMedia.bind(this));var t=this.container.getElement(".IM-chat-username");if(this.hideDescription(),this.hideSecurity(),this.hideRole(),this.infoRoomView.hideButtonSettings(),this.room.get("directmessage"))if(this.room.get("nway")){(s=this.room.users.first())||(s=this.ctrl.me),t.innerHTML=s.get("username"),this.displaySVGicon("group_chat"),this.hidePresence(),this.room.users.forEach(function(e,s){if(0==s)return!0;t.innerHTML+=", "+e.get("username")}.bind(this))}else{var s;(s=this.room.users.first())||(s=this.ctrl.me),this.showPresence(),this.container.getElement(".IM-user-status").style.background=d[s.get("status").toLowerCase()],this.container.getElement(".IM-me-details").innerHTML=s.get("status").capitalize(),this.listenTo(s,"onChange:status",function(e){var t=e.get("status"),i=d[t.toLowerCase()];this.container.getElement(".IM-user-status").style.background=i,this.container.getElement(".IM-me-details").innerHTML=s.get("status").capitalize()}.bind(this)),this.displayIMG(document.rtcwidget_Swym_URL+s.get("login")+"/format"),t.innerHTML=s.get("username")}else{t.innerHTML=this.room.get("name"),this.updateImage()||this.displaySVGicon("room_default"),this.hidePresence(),this.showSubTitle(),this.updateDescription(),this.updateSecurity();var i=document.rtcwidget_Me.getRole(this.room.get("room_id"));i&&this.setRole(i),"owner"===i&&this.infoRoomView.displayButtonSettings()}this.sDataView.setContents(this.room.mySharedContent);for(var n=this.container.getElement(".IM-chatpanel-scroll");n.firstChild;)n.removeChild(n.firstChild);var a=this,o=this.room.messages.sortBy("createDate"),r=!1;o.forEach(function(e,t){r||"none"!==e.get("read_date")||0==Object.keys(e.get("user")).length||(r=!0,e.set("displayUnread",!0)),"none"===e.get("read_date")&&e.set("read_date",Date.now()),a.addMessage(e)}),this.scrollToEnd();var l=this.container.getElement(".IM-chatpanel-topbar-nnbPeople");this.room.get("nway")?l.style.display="none":(this.infoRoomView.cleanPeople(),l.style.display="none"),this.infoRoomView.setRoom(this.room),this.getArchives({room_id:this.room.get("room_id"),lastMessageID:this.room.lastMessage?this.room.lastMessage.get("message_id"):null})}},scrollToEnd:function(){var e=this.container.getElement(".IM-chatpanel-scroll");this.scrollerView.scrollTo(0,e.scrollHeight)},load3DPlay:function(e){this._3DplayData=e,this.display3dplayer({mime:e.mime,path:e.path,fileName:e.fileName,room_id:this.room.get("room_id")})},showShareBtn:function(e){this.container.getElement(".IM-chatpanel-svg-icon.share").style.display="block"},display:function(e){if((t=this.container.offsetWidth)<800){this.showPanel=e||!this.showPanel;var t=this.container.offsetWidth;new UWA.Fx(this.container,{duration:300,transition:"sineOut"}).start({left:this.showPanel?[t,0]:t,right:this.showPanel?[-t,0]:-t})}},addMessage:function(e){var t=this.scrollerView.getInnerElement(),s=(t.scrollTop,t.scrollHeight),i=this.container.getElement(".IM-chatpanel-scroll").firstChild,n=void 0;i&&(n=i.firstChild);var a=new Date(e.get("createDate"));if("media"===e.get("origin")&&e.get("data").name)for(var o=this.room.mySharedContent.where({name:e.get("data").name}),r=0;r<o.length;r++)if(!o[r].get("shared")){o[r].set("shared",!0);break}var l=a.toLocaleDateString("en-US",{weekday:"long",month:"long",day:"numeric"}),c=this.sectionDate.where({title:l});if(0===c.length&&this.addSectionDate(a),(c=this.sectionDate.where({title:l}))[0].get("view").addMessage(e),"media"===e.get("origin")){var d=e.get("data");d.date=e.get("createDate"),this.room.addMedia(d)}var h=this.container.getElement(".IM-chatpanel-scroll").firstChild,m=void 0;h&&(m=h.firstChild),i&&n&&(h!==i||m!==n)?t.scrollTop=t.scrollHeight-s:this.scrollToEnd()},addSectionDate:function(e){var t=e.toLocaleDateString("en-US",{weekday:"long",month:"long",day:"numeric"}),s=new o({refDate:t,display3dplayer:this.load3DPlay.bind(this),maximizeChat:this.maximizeChat.bind(this),scrollTo:this.scrollToEnd.bind(this),searchUser:this.searchUser.bind(this),assignTask:this.assignTask.bind(this)});this.sectionDate.add({title:t,time:e.getTime(),view:s}),this.sectionDate.sort();var i=this.sectionDate.indexOf(this.sectionDate.where({time:e.getTime()})[0]);if(i<this.sectionDate.size()-1&&this.sectionDate.size()>1)s.inject(this.sectionDate.at(i+1).get("view").container,"before");else{var n=this.container.getElement(".IM-chatpanel-scroll");s.inject(n)}},addRobotMessage:function(e){var t=e.get("data").name,s=(t.substr(t.lastIndexOf(".")+1,t.length),UWA.createElement("div",{class:"robotmessage",html:[{tag:"div",html:"I can add this file in 3DDrive. Do you agree ? "},{tag:"a",html:"Yes please"},{tag:"a",html:"No. Maybe next time",events:{click:function(e){for(var t=this.getParents(),s=0;s<t.length;s++)if("IMWMessageView-global"===t[s].className){new UWA.Fx(t[s],{duration:300,transition:"linear"}).start({height:0});break}}}},{tag:"a",html:"Never"}]})),i={message_id:e.get("message_id")+"_robotmessage",message:null,html:s,isSent:!1,fileName:t,readBy:{},devEnv:!1,user:document.bot2,login:"BOT2",data:e.get("data"),origin:"bot",createDate:e.get("createDate")};this.room.addMessage(i)},inject:function(e){this.showPanel=!0,this.container.isInjected()?(this.container.style.display="block",this.container.style.left=0,this.container.style.right=0,this.display(this.showPanel)):(this.container.inject(e),this.container.style.left=0,this.container.style.right=0,this.display(this.showPanel))},maximizeChat:function(e){this.stateOfInfo=this.infoRoomView.showPanel;var t=this,s=(document.body.offsetWidth,document.body.offsetHeight);if(this.infoRoomView.showPanel&&this.infoRoomView.display(),this.imgMsg=void 0,e&&(e.image||e.video)){e.image&&(e.image.style.height="",e.image.style.width="",e.image.style.position="absolute",e.image.style.top="0",e.image.style.bottom="0",e.image.style.left="0",e.image.style.right="0",e.image.style["max-width"]="900px",e.image.style["max-height"]="100%",e.image.style.margin="auto",e.image.className=""),this.messageMax=e.message&&e.message.data?e.message.data:e.message,this.messageMax&&!this.messageMax.get("data")&&this.messageMax.set("data",e.message._attributes),this.imgMsg=UWA.createElement("div",{class:"IM-MAX-IMG",html:e.image||e.video}),this.imgMsg.inject(document.body);var i=this.imgMsg.getOffsets().y;new UWA.Fx(this.imgMsg,{duration:400,transition:"linear",events:{onComplete:function(){t.container.className="IMWChatPanelView fullscreen",t.imgMsg.className="IM-MAX-IMG fullscreen"}}}).start({top:[s,i]})}this.container.getElement(".IM-chatpanel-user-info");document.rtcwidget_x3dphoto&&(this.container.getElement(".IM-chatpanel-svg-icon.pencil").style.display="block",this.container.getElement(".IM-chatpanel-svg-icon.share").style.display="block");var n=this.container.getElement(".IM-chatpanel-svg-icon.close");this.container.getElement(".IM-chatpanel-svg-icon.backToList").classList.add("hidden");var a=this.container.getElement(".IM-chatpanel-svg-icon.info");a.style.background="#f9f9f9",a.firstChild.style.color="rgb(180, 182, 186)",n.style.width="59px",this.maxChat()},minimizeChat:function(){this.messageMax=void 0,this._3DplayData=void 0;var e=this,t=(document.body.offsetWidth,document.body.offsetHeight),s=this.container.getElement(".IM-chatpanel-svg-icon.backToList");this.isDiscoveryView||s.classList.remove("hidden");var i=this.container.getElement(".IM-chatpanel-user-info");document.rtcwidget_x3dphoto&&(this.container.getElement(".IM-chatpanel-svg-icon.share").style.display="none",this.container.getElement(".IM-chatpanel-svg-icon.pencil").style.display="none");var n=this.container.getElement(".IM-chatpanel-svg-icon.close");this.container.className="IMWChatPanelView";n.offsetWidth;this.imgMsg&&(this.imgMsg.className="IM-MAX-IMG",new UWA.Fx(this.imgMsg,{duration:400,transition:"linear",events:{onComplete:function(){e.imgMsg.destroy()}}}).start({top:t}));this.miniChat(),n.style.width="0px",i.style.paddingLeft="0px",this.stateOfInfo&&this.infoRoomView.display();var a=this.container.getElement(".IM-chatpanel-svg-icon.info");a.style.background="#368ec4",a.firstChild.style.color="white"},initDDView:function(){this.sendDataView=new r({panelId:"panelId",events:{ondrop:this.sendDataFromDrop.bind(this)}}),this.sendDataView&&(this.sendDataView.getView().style.bottom=0,this.sendDataView.getView().style.top="20%",this.sendDataView.getView().style.left="",this.sendDataView.getView().style.right="",this.sendDataView.getView().style.bottom="",this.sendDataView.getView().style.width="50%",this.sendDataView.getView().style.height="50%",this.container.addContent(this.sendDataView.getView())),this.container.ondragover=this.showDDView.bind(this)},showDDView:function(e){e.preventDefault(),this.sDataView.display(!0)},sendGeneratedView:function(e,t,s,i,n,a){if(!e)return w(null===e?"RTChatController - dropped widget format is not supported":!1===e?"RTChatController - can not generate html view from dropped widget":"RTChatController - unknown error about generatedStringView");var o,r=!1;try{o=btoa(unescape(encodeURIComponent(e)))}catch(e){return w("RTChatController - unable to btoa generated view")}"coreviewInvitation"==i?t=JSON.stringify(t):"fileTransferInvitation"!=i&&(r=!0);var l={data:encodeURIComponent(JSON.stringify(t)),datahtml:o,uri:s};if(l=btoa(JSON.stringify(l)),this.sendData({persisted:r,data:l,typeData:i,options:n,room_id:this.room.get("room_id")}),"fileTransferInvitation"==i){var c=this.sendDataView.files[a];c?this.sendData({data:c.data,typeData:"fileTransfer",options:c,room_id:this.room.get("room_id")}):w("can not find the file "+a)}this.room.addMessage({html:e,fileId:a,fileName:n?n.fileName:null,room_id:this.room.get("room_id")})},generateViewFromFile:function(e){var t,s=e.fileName.substr(e.fileName.indexOf(".")+1,e.fileName.length),i=e.fileName.substr(0,e.fileName.indexOf(s)-1),n="<div class='fileTransfer' id='"+e.fileId+"'  style='line-height:60px; padding-left:10px; height:"+("3dxml"===s?"216px":"60px")+"; background:"+("3dxml"===s?"#ffffff":"#f1f1f1")+"; color:black; display:flex; align-items:center; flex-wrap:nowrap; flex-direction:row; '>";switch(s){case"jpg":t="http://images.all-free-download.com/images/graphiclarge/jpg_file_37138.jpg";break;case"pdf":t="https://www.linuxvoice.com/wp-content/uploads/2016/12/adobe-pdf-icon.png";break;case"3dxml":t="https://dsqal001-euw1-20psp21115-rtc.3dx-staging.3ds.com/public/media/"+i+".png";break;default:t="https://cdn1.iconfinder.com/data/icons/education-set-3/512/text-file-512.png"}return"3dxml"===s?n+="<img height='216px' src='"+t+"'/>":(n+="<img height='32px' src='"+t+"'/>",n+="<span style='margin-left:10px'> "+i+"</span>"),n+="<span class='download' style='margin:0 auto; margin-right:10px; width:40px; display:flex; justify-content:flex-end; margin-right:30px; align-items:center; flex-direction:row'>",n+="<div class=\"fileTransDown fonticon fonticon-download\" style='color:#77797C;margin-right:0px; font-size:1.7em' onclick=\"document['download"+e.fileId+"']()\">",n+="</div>",n+="</div>",n+="</div>"},replaceProgressBar:function(e,t,s){this.container.getElementById(e).style.color=s,this.container.getElementById(e).innerHTML=t},sendDataFromDrop:function(e){this.sDataView.display(!1);var t=this;e.stopPropagation(),e.preventDefault();var s,i,n,a=e?e.dataTransfer?e.dataTransfer.files:e.target?e.target.files:null:null,o=[],r=null;if(a&&a.length>0&&(1==e.dataTransfer.types.length||e.dataTransfer.types[0]&&-1!=e.dataTransfer.types[0].indexOf("moz"))){s="fileTransfer";var l,c="";for(l=0;a[l];l++){c=a[l].name,o[c]=new FileReader,o[c].fileName=c;var d="3DIMfiletransfer"+Date.now();o[c].fileId=d,o[c].size=a[l].size,o[c].size>5e7||(o[c].onload=function(e){for(var s,i=new Uint8Array(e.target.result),n=0,a=i.length,r="";n<a;)s=i.subarray(n,Math.min(n+32768,a)),r+=String.fromCharCode.apply(null,s),n+=32768;var l=c.substr(c.lastIndexOf(".")+1,c.length);t.uploadFile({room_id:t.room.get("room_id"),mime:l,name:c,file:r}),delete o[c]},o[c].readAsArrayBuffer(a[l]),this.room.mySharedContent.add({shared:!1,name:c}))}}else{var h,m;if(s="DS3DXContent",e.dataTransfer&&e.dataTransfer.getData&&e.dataTransfer.types){if(Array.prototype.contains||(Array.prototype.includes?Array.prototype.contains=Array.prototype.includes:Array.prototype.contains=function(t){return-1!=e.dataTransfer.types.indexOf(t)}),e.dataTransfer.types.contains("text")||e.dataTransfer.types.contains("Text"))i=e.dataTransfer.getData("text");else{if(!e.dataTransfer.types.contains("text/plain"))return w("RTChatController ondrop senddata view : no data found in dataTransfer");i=e.dataTransfer.getData("text/plain")}h=e.dataTransfer.types.contains("text/plain")?e.dataTransfer.getData("text/plain"):i,n=e.dataTransfer.types.contains("text/uri-list")?e.dataTransfer.getData("text/uri-list"):e.dataTransfer.types.contains("Url")?e.dataTransfer.getData("Url"):i.url?i.url:null,m=e.dataTransfer.types.contains("text/html")?e.dataTransfer.getData("text/html"):i}else{if(!e.detail)return w("RTChatController ondrop senddata view : no data attached");h=i=e.detail,m=i,n=i.url?i.url:e.detail.data&&e.detail.data.items&&e.detail.data.items[0]?e.detail.data.items[0].urlContent:null}var g=void 0;if("object"==typeof i)g=i;else try{g=JSON.parse(i)}catch(e){w(e),g=void 0}if(g&&g.data&&g.data.items&&g.data.items[0]&&"3DDrive"!=g.data.items[0].serviceId&&("3DSwym"==g.data.items[0].serviceId||"X3DCSMA_AP"===g.source||"X3DMCTY_AP"===g.source||"X3DWNEW_AP"==g.source||"X3DDRIV_AP"==g.source||"X3PDRIV_AP"==g.source))(r=t.sendDataView.generateViewFromJson(g.data.items[0]))||(r=t.sendDataView.generateViewFromTile(g.data.items[0]));else{if(g&&g.type&&"coreview"==g.type)return g.channel?(this.initCoreview(g.channel,!0),r=null,t.sendGeneratedView("<div></div>",g,null,"coreviewInvitation",g),!0):w("RTChatController sendDataFromDrop received a coreview without channel !");m&&-1!=m.indexOf("item-title")&&(r=t.sendDataView.generateViewFromNetvibes(m))}if(!r){if(m&&"string"==typeof m){var u=m.slice(m.length-3);0===m.indexOf("<img")?(r=t.sendDataView.generateViewFromImage(h),n=t.sendDataView.getURLFromImageString(r)):0!=m.indexOf("http")||"jpg"!=u&&"png"!=u&&"gif"!=u&&"bmp"!=u?-1!=m.indexOf("<a")&&(r=t.sendDataView.generateViewFromLink(m)):r=t.sendDataView.generateViewFromImage(m)}!r&&n&&n.length>0&&(r=t.sendDataView.generateViewFromUrl(n))}if(r&&r.length>5e7)return this.displayAlertSizeLimitReached(),!1;if(!r)return!1;t.sendGeneratedView(r,i,n,s)}}})}),define("DS/InstantMessagingW/js/view/IMWGroupsView",["UWA/Class/View","DS/InstantMessagingW/js/view/IMWGroupView","DS/UIKIT/Scroller"],function(e,t,s){"use strict";return e.extend({tagName:"div",className:"IMWGroupsView",setup:function(e){this.groups=e.groups,this.listenTo(this.groups,"onAdd",this.addGroup.bind(this)),this._createContent()},_createContent:function(){this.setContainer({tag:"div",class:"IMWGroupsView",html:[{tag:"div",class:"IMWAddGroup",html:[{tag:"div",class:"IM-addGroup-name",text:"Add group"},{tag:"span",class:"fonticon fonticon-plus"}]},this.scrollerView=new s({element:UWA.createElement("div",{class:"scrollable-body",styles:{height:"100%"},html:{tag:"div",class:"IMWListGroupsView"}})})]})},addGroup:function(e){new t({group:e,startChat:this.startChat}).inject(this.container.getElement(".IMWListGroupsView"))},inject:function(e){this.container.inject(e)}})}),define("DS/InstantMessagingW/js/view/IMWdiscovery",["UWA/Class/View","DS/RTProxyDriver/RTLogger","DS/InstantMessagingW/assets/svg_icons_widget","DS/UIKIT/Input/Button","DS/UIKIT/Tooltip","i18n!DS/InstantMessagingW/assets/nls/feed","DS/UIKIT/Spinner","DS/InstantMessagingW/js/view/IMWdiscoveroom","DS/InstantMessagingW/js/view/IMWChatPanelView","DS/InstantMessagingW/js/model/IMWRoomModel","DS/UIKIT/Input/Toggle","DS/UIKIT/Input/Text","DS/UIKIT/Toggler"],function(e,t,s,i,n,a,o,r,l,c,d,h,m){"use strict";return e.extend({tagName:"div",className:"IMWDiscovery",setup:function(e){this.id=e.id,this.ctrl=e.ctrl,this.returnAction=e.returnAction,this.chatPanelView=new l({discovery:!0}),this.addRooms(this.ctrl.publicRooms),this.render(),this.listenTo(this.ctrl.publicRooms,"onAdd",this.addRoom),this.listenTo(this.ctrl.publicRooms,"onRemove",this.removeRoom)},displayEmptyMessageIfNeeded:function(){for(var e=this.browser.getElements(".IMWdiscoveroom2"),t=0;t<e.length;t++)if(!e[t].isHidden())return this.hideEmptyMessage();this.showEmptyMessage()},resetParams:function(){this.showJoinedRooms(),this.joinedRoomsBtn.setActive(),this.leftRoomsBtn.setActive(),this.showLeftRooms(),this.searchInput.setValue(""),this.search()},search:function(e){var t,s,i=this.searchInput.getValue();if(this.searchInput.setValue(i),i){t=this.ctrl.publicRooms.reject(function(e){return-1==(e.get("name")||"").indexOf(i)&&-1==(e.get("description")||"").indexOf(i)}),this.ctrl.publicRooms.forEach((s=this,function(e,t){s.browser.getElement("#disco"+e.get("room_id")).classList.add("hidden")}))}else t=this.ctrl.publicRooms;t.forEach(function(e){return function(t,s){e.browser.getElement("#disco"+t.get("room_id")).classList.remove("hidden")}}(this)),0==t.length?this.showEmptyMessage():this.hideEmptyMessage()},showEmptyMessage:function(){this.browser.getElement(".discoEmptyMessage").classList.remove("hidden")},hideEmptyMessage:function(){this.browser.getElement(".discoEmptyMessage").classList.add("hidden")},addRooms:function(e){var t;e.forEach((t=this,function(e,s){t.addRoom(e)}))},addRoom:function(e){var t=new r({model:e,ctrl:this.ctrl});this.cardCreation?t.render().inject(this.cardCreation,"after"):t.render().inject(this.browser,"top")},removeRoom:function(e){this.browser.getElement("#disco"+e.get("room_id")).destroy()},hideJoinedRooms:function(){this.container.classList.add("hideJoined")},showJoinedRooms:function(){this.container.classList.remove("hideJoined")},toggleDisplayJoinedRooms:function(){this.joinedRoomsBtn.isActive()?(this.joinedRoomsBtn.setActive(!1),this.hideJoinedRooms()):(this.joinedRoomsBtn.setActive(),this.showJoinedRooms()),this.displayEmptyMessageIfNeeded()},togglerFactory:function(){return e=this,function(){e.toggleDisplayJoinedRooms()};var e},hideLeftRooms:function(){this.container.classList.add("hideLeft")},showLeftRooms:function(){this.container.classList.remove("hideLeft")},toggleDisplayLeftRooms:function(){this.leftRoomsBtn.isActive()?(this.leftRoomsBtn.setActive(!1),this.hideLeftRooms()):(this.leftRoomsBtn.setActive(),this.showLeftRooms()),this.displayEmptyMessageIfNeeded()},togglerLeftFactory:function(){return e=this,function(){e.toggleDisplayLeftRooms()};var e},resetViewFactory:function(){return e=this,function(){e.resetParams()};var e},showParams:function(){this.chatPanelView.getElement(".IM-chatpanel-subtopbar").hasClassName("notHidden")?this.chatPanelView.getElement(".IM-chatpanel-subtopbar").classList.remove("notHidden"):this.chatPanelView.getElement(".IM-chatpanel-subtopbar").classList.add("notHidden")},showParamsFactory:function(){return e=this,function(){e.showParams()};var e},createEmptyCard:function(e){return UWA.createElement("div",{id:e,class:"IMWdiscoveroom2",html:[{tag:"div",class:"card card-thumbnail",events:{mouseover:function(){this.classList.add("card-thumbnail-selectable")},mouseout:function(){this.classList.remove("card-thumbnail-selectable")}}},{tag:"div",class:"fakeCardWidth"}]})},createAddRoomCard:function(){this.cardCreation=this.createEmptyCard("discoCreateRoom");var e=UWA.createElement("div",{class:"discoCreateRoomContent",html:[{class:"fonticon fonticon-plus",tag:"span"},{class:"",tag:"span",html:a.CreateRoom}]});this.cardCreation.inject(this.browser,"top"),this.cardCreation.addEvent("click",this.startCreationFactory()),e.inject(this.cardCreation.getElement(".card"))},startCreationFactory:function(){return e=this,function(){e.ctrl.IMWView.showChannelCreationView()};var e},render:function(){var e;return this.chatPanelView.inject(this.container),this.browser=this.chatPanelView.getElement(".IM-chatpanel-global-details"),this.browser.setStyle("flex","1"),this.createAddRoomCard(),this.returnAction&&(this.backIcon=UWA.createElement("span",{class:"fonticon fonticon-chevron-left noMobile",styles:{"font-size":"40px",color:"#003c5a",cursor:"pointer"}}).inject(this.chatPanelView.getElement(".IM-chat-contact")),this.backIcon.addEvent("click",this.returnAction),this.chatPanelView.getElement(".IM-chat-details").style.left="130px",this.tooltipBack=new n({position:"left",target:this.backIcon,body:a.backToFMOT})),this.icon=UWA.createElement("span",{class:"fonticon fonticon-globe noMobile",styles:{"font-size":"40px",color:"#003c5a"}}).inject(this.chatPanelView.getElement(".IM-chat-contact")),this.chatPanelView.getElement(".IM-chat-username").innerHTML=a.DISCOVER,this.chatPanelView.getElement(".IM-chat-message").innerHTML=a.DiscoverInfo,this.emptyMessage=UWA.createElement("span",{class:"discoEmptyMessage hidden",html:a.noRoomFound}).inject(this.browser),this.cogWheel=UWA.createElement("span",{class:"fonticon fonticon-filter"}).inject(this.chatPanelView.getElement(".IM-chatpanel-topbar-icons")),this.cogWheel.addEvent("click",this.showParamsFactory()),this.searchInput=new h({placeholder:a.Search+"..."}).inject(this.chatPanelView.getElement(".IM-chatpanel-topbar-icons"),"top"),this.searchInput.elements.container.addEventListener("keyup",(e=this,function(t){e.search(t.key)})),this.discoParams=UWA.createElement("span",{class:"discoParams"}).inject(this.chatPanelView.getElement(".IM-chatpanel-subtopbar")),this.joinedRoomsBtn=new i({value:a.alreadyIn,className:"primary"}).setActive().inject(this.container.getElement(".discoParams")),this.joinedRoomsBtn.addEvent("onClick",this.togglerFactory()),this.leftRoomsBtn=new i({value:a.notIn,className:"primary"}).setActive().inject(this.container.getElement(".discoParams")),this.leftRoomsBtn.addEvent("onClick",this.togglerLeftFactory()),this.resetBtn=new i({value:a.Reset,className:"primary"}).inject(this.container.getElement(".discoParams")),this.resetBtn.addEvent("onClick",this.resetViewFactory()),this}})}),define("DS/InstantMessagingW/js/view/IMWView",["UWA/Class/View","DS/UIKIT/Input/Text","DS/InstantMessagingW/js/view/IMWConversationsView","DS/InstantMessagingW/js/view/IMWGroupsView","DS/InstantMessagingW/js/view/IMWSearchView","DS/InstantMessagingW/js/view/IMWChatPanelView","DS/InstantMessagingW/js/view/IMWRoomCreationView","DS/InstantMessagingW/js/view/IMWMeInfo","DS/InstantMessagingW/js/view/IMWNotification","DS/InstantMessagingW/js/view/IMW3DPlayPlayer","DS/InstantMessagingW/js/view/IMWdiscovery","DS/UIKIT/Modal","css!InstantMessagingW/InstantMessagingW.css"],function(e,t,s,i,n,a,o,r,l,c,d,h){"use strict";e.extend({setup:function(e){this.ctrl=e.ctrl,this._createContent()},_createContent:function(){var e=this;this.setContainer({tag:"div",class:"IM-tab"+(this.options&&this.options.active?" active":""),html:[{tag:"span",class:"fonticon "+this.options.icon+" IM-tab-icon"+(this.options&&this.options.active?" active":"")},{tag:"div",class:"IM-tab-name"+(this.options&&this.options.active?" active":""),html:this.options&&this.options.label?this.options.label:void 0}],events:{click:function(t){if("IM-tab active"!==this.className){for(var s=this.getParent().getElements(".IM-tab"),i=0;i<s.length;i++){s[i].className="IM-tab",s[i].getElement(".IM-tab-name").className="IM-tab-name";var n=s[i].getElement(".IM-tab-icon").className;s[i].getElement(".IM-tab-icon").className=n.substr(0,n.indexOf("IM-tab-icon")+"IM-tab-icon".length)}this.className="IM-tab active",this.getElement(".IM-tab-name").className="IM-tab-name active",this.getElement(".IM-tab-icon").className="fonticon "+e.options.icon+" IM-tab-icon active",e.options.events&&e.options.events.click&&e.options.events.click(t)}},mouseover:function(){"IM-tab active"!==this.className&&(this.className="IM-tab hover",this.getElement(".IM-tab-name").className="IM-tab-name hover",this.getElement(".IM-tab-icon").className="fonticon "+e.options.icon+" IM-tab-icon hover")},mouseout:function(){"IM-tab active"!==this.className&&(this.className="IM-tab",this.getElement(".IM-tab-name").className="IM-tab-name",this.getElement(".IM-tab-icon").className="fonticon "+e.options.icon+" IM-tab-icon")}}})}});return e.extend({setup:function(e){this.ctrl=e.ctrl,this.ctrl.addMe=this.addMe.bind(this),this.ctrl.onCoreview=this.onCoreview.bind(this),this.conversationsView=new s({ctrl:this.ctrl,rooms:this.ctrl.rooms,showDMCreationView:this.showDMCreationView.bind(this),showChannelCreationView:this.showChannelCreationView.bind(this),search:this.ctrl.search,startChat:this.startChat.bind(this),getRoom:this.ctrl.getRoom.bind(this),doSearch:this.ctrl.doSearch.bind(this)}),this.channelsView=new s({ctrl:this.ctrl,rooms:this.ctrl.rooms,search:this.ctrl.search,startChat:this.startChat.bind(this),getRoom:this.ctrl.getRoom.bind(this),doSearch:this.ctrl.doSearch.bind(this)}),this.groupsView=new i({groups:this.ctrl.groups}),this.searchView=new n({search:this.ctrl.search,startChat:this.startChat.bind(this)}),this.playerView=new c({ctrl:this.ctrl,uploadFile:this.ctrl.uploadFile.bind(this.ctrl),launchCoreview:this.ctrl.launchCoreview.bind(this.ctrl)}),this.chatPanelView=new a({unactiveConversations:this.conversationsView.unactiveConversations.bind(this.conversationsView),sendMessage:this.ctrl.sendMessage,sendData:this.ctrl.sendData,startCall:this.ctrl.startCall,leaveRoom:this.ctrl.leaveRoom.bind(this.ctrl),showInvitationForRoom:this.showInvitationForRoom.bind(this),display3dplayer:this.playerView.display3dplayer.bind(this.playerView),share3dplayer:this.playerView.send.bind(this.playerView),startCoreview:this.playerView.startCoreview.bind(this.playerView),uploadFile:this.ctrl.uploadFile.bind(this.ctrl),startX3DPhoto:this.ctrl.startX3DPhoto.bind(this.ctrl),maximizeChat:this.maximizeChat.bind(this),minimizeChat:this.minimizeChat.bind(this),getArchives:this.ctrl.getArchives.bind(this.ctrl),getMedias:this.ctrl.getMedias.bind(this.ctrl),ctrl:this.ctrl}),this.channelCreationView=new o({type:"channel",search:this.ctrl.search,startChat:this.startChat.bind(this),getRoom:this.ctrl.getRoom.bind(this.ctrl),doSearch:this.ctrl.doSearch.bind(this),name:"Channel X",selectedUsers:[],foundUsers:[]}),this.dmCreationView=new o({type:"dm",search:this.ctrl.search,startChat:this.startChat.bind(this),getRoom:this.ctrl.getRoom.bind(this.ctrl),doSearch:this.ctrl.doSearch.bind(this),name:"Direct Message X",selectedUsers:[],foundUsers:[]}),this.InvitationView=new o({type:"invitation",search:this.ctrl.search,doSearch:this.ctrl.doSearch.bind(this),inviteUser:this.ctrl.inviteUser,selectedUsers:[],foundUsers:[]}),this._createContent(),this.initDiscover()},setupSmileys:function(){this.chatPanelView.setupSmileys()},onCoreview:function(e){var t=this;if(e.actions)this.playerView.onCoreviewAction(e.actions);else{var s=new h({closable:!0,header:"<h4>"+e.username+" want to start a coreview with you</h4>",body:'<div class="thumbFile"><img src="https://euw1-20psp21115-ifwe.3dx-staging.3ds.com/api/widget/proxy/external/X3DDRIV_AP/aHR0cHM6Ly9ldXcxLTIwcHNwMjExMTUtaWZ3ZS4zZHgtc3RhZ2luZy4zZHMuY29tL3Jlc291cmNlcy9lbi8xL3dlYmFwcHMvVzNERHJpdmUvVzNERHJpdmUuaHRtbA/1948f8f9801940cc22134b1bd3570af17a09b243/20171115T194511Z/resources/en/1/webapps/W3DDrive/assets/thumbnails/I_3DXML200x150.png" style="height: 64px;"><div><b>'+e.fileName+"</b></div></div>",footer:"<button type='button' id='coreviewRefuse' class='btn btn-default'>Refuse</button> <button type='button' id='coreviewAccept' class='btn btn-primary'>Accept</button>"}).inject(document.body);s.getContent().getElements("#coreviewRefuse")[0].addEvent("click",function(){s.hide()}),s.getContent().getElements("#coreviewAccept")[0].addEvent("click",function(){s.hide(),t.chatPanelView.maximizeChat(),t.playerView.display3dplayer({mime:e.mime,path:e.path,room_id:e.room_id,fileName:e.fileName,coreview:!0})}),s.show()}},showChannelCreationView:function(){this.channelsView.container.isInjected()||this.chatPanelView.inject(this.container),this.hideInvitationView(),this.hideDMCreationView(),this.channelCreationView.show()},showDMCreationView:function(){this.channelsView.container.isInjected()||this.chatPanelView.inject(this.container),this.hideInvitationView(),this.hideChannelCreationView(),this.dmCreationView.show()},showInvitationForRoom:function(e){this.hideCreationViews(),this.InvitationView.showForRoom(e)},hideDMCreationView:function(){this.dmCreationView.hide()},hideChannelCreationView:function(){this.channelCreationView.hide()},hideCreationViews:function(){this.hideDMCreationView(),this.hideChannelCreationView(),this.hideInvitationView()},hideInvitationView:function(){this.InvitationView.hide()},hideDiscover:function(){this.smallDisco.hide()},showDiscover:function(){this.chatPanelView.inject(this.container),this.smallDisco.show(),this.conversationsView.unactiveConversations(null,!0)},initDiscover:function(){this.smallDisco=new d({ctrl:this.ctrl,id:"smallDisco"}),this.smallDisco.inject(this.chatPanelView.container),this.smallDisco.hide()},addMe:function(e){e.setStatus=this.ctrl.setStatus.bind(this.ctrl),new r(e).inject(this.container.getElement(".IM-topbar"))},_createContent:function(){this.setContainer({tag:"div",class:"IM-global-view",html:[this.playerView,{tag:"div",class:"IM-main-view",html:[this.notification=new l({notifications:this.ctrl.notifications}),{tag:"div",class:"IM-topbar"},{tag:"div",class:"IM-scroll-view",html:this.conversationsView}]}]})},startChat:function(e){if(e){this.hideDiscover(),this.hideCreationViews(),this.chatPanelView.inject(this.container),this.chatPanelView.startChat({room:e}),this.ctrl.rooms.forEach(function(e,t){e.set("active",!1)}),e.set("active",!0),this.conversationsView.unactiveConversations(e);var t=this.ctrl.notifications.where({room_id:e.get("room_id")});1===t.length&&this.ctrl.notifications.remove(t[0])}},maximizeChat:function(e){var t=this.container.getElement(".IM-main-view"),s=-(t.offsetWidth+1);this.container.style.paddingTop="0px",t.style.marginLeft=s+"px"},minimizeChat:function(e){var t=this.container.getElement(".IM-main-view");t.offsetWidth;t.style.marginLeft="0px"},inject:function(e){this.container.inject(e)}})}),define("DS/InstantMessagingW/js/controller/IMWController",["UWA/Class","UWA/Class/Events","UWA/Class/Collection","DS/InstantMessagingW/js/model/IMWContactModel","DS/InstantMessagingW/js/model/IMWGroupModel","DS/InstantMessagingW/js/model/IMWRoomModel","DS/InstantMessagingW/js/model/IMWMessageModel","DS/InstantMessagingW/js/view/IMWView","DS/RTProxyDriver/RTLogger","DS/RTProxyDriver/RTProxyDriver","DS/InstantMessagingW/js/view/IMWfmot","DS/PlatformAPI/PlatformAPI","i18n!DS/InstantMessagingW/assets/nls/feed"],function(e,t,s,i,n,a,o,r,l,c,d,h,m){"use strict";var g={},u=void 0,p=!1,f=function(e){p?u.dispatchEvent("sendToServer",e):h.publish("fromwidgetim.ds.com",e)};l.addLevel("Widget","darkorange");var v=function(e){return l.Widget(e)};v.error=function(e){return l.error(e)};var I=e.extend(t,{init:function(e){this.appId=e.appId,this.container=e.container,this.swymUrl=e.swymUrl,this.rtcUrl=e.rtcUrl,this.spaceUrl=e.spaceUrl,this.passportUrl=e.passportUrl,this.platformId=e.platformId,this.username=e.username,this.login=e.login,this.devEnv=e.devEnv,this.embeddedManager=e.embeddedManager,p=e.embeddedManager,this.initLists()},initView:function(e){e.body.innerHTML="";var t=new r({ctrl:this});t.inject(e.body),this.setIMWView(t),this.view=t,this.initFMOT(t)},initFMOT:function(e){this.fmot=new d,this.fmot.inject(e.container),this.showFMOT(),this.fmot.addEvent("startChannelCreation",this.view.showChannelCreationView.bind(this.view)),this.fmot.addEvent("startDMCreation",this.view.showDMCreationView.bind(this.view)),this.fmot.addEvent("showBigDisco",this.discoClick.bind(this))},showFMOT:function(e){this.fmot.hide(),this.IMWView.showDiscover()},hideFMOT:function(e){this.fmot.hide()},setSwymUrl:function(e){document.rtcwidget_Swym_URL=e+"/api/user/getpicture/login/"},setSpaceUrl:function(e){document.rtcwidget_Space_URL=e},setPlatformID:function(e){document.rtcwidget_PlatformID_URL=e},setRtcUrl:function(e){document.rtcwidget_RTC_URL=e||"https://dsdev010-euw1-20dna10118-rtc1.3dx-staging.3ds.com",document.rtcwidget_Assets_URL=document.rtcwidget_RTC_URL+"/resources/InstantMessagingW/assets/",document.rtcwidget_Smileys_URL=document.rtcwidget_Assets_URL+"smileys/"},initLists:function(){this.groups=new s([],{model:n}),this.rooms=new s([],{model:a}),this.publicRooms=new s([],{model:a}),this.search=new s([],{model:i}),this.notifications=new s([]),this.users={},this.me=void 0,this.addMe=void 0},setup:function(){var e;this.setSwymUrl(this.swymUrl),this.setRtcUrl(this.rtcUrl),this.setSpaceUrl(this.spaceUrl),this.setPlatformID(this.platformId),this.initView(this.container),this.IMWView.setupSmileys(),this.embeddedManager||(h.subscribe("towidgetim.ds.com",(e=this,function(t){e.receiveFromServer(t)})),f({evenement:"GETLOGINOKDATA"}))},addGroup:function(e){if(0!==this.groups.where({group_id:e.group_id}).length)return{error:"Group already exist"};e=new n({name:e.name,group_id:e.group_id,users:e.users,tenant:e.tenant});this.groups.add(e)},addContact:function(e){var t=this.groups.where({group_id:e.group_id});if(1!==t.length||e.login===this.login)return{error:"Group doesn't exist"};var s=new i({status:e.status,login:e.login,username:e.username,tenants:e.tenant});t[0].users.add(s)},getOrSetUser:function(e,t){var s;return this.users||(this.users={}),e.login=e.login||e.userId,this.users[e.login]?(s=this.users[e.login],e.username&&s.set("username",e.username)):(s=new i({status:e.status,login:e.login,username:e.username||e.userName,tenants:e.tenant}),this.users[e.login]=s),t&&e.role&&this.users[e.login].setRole(t,e.role),this.users[e.login]},getRoomInfos:function(e){f({evenement:"getRoomInfos",data:e})},addRoom:function(e){var t=e.room||e,s=this.rooms.where({room_id:t.room_id});if(0===s.length){if(!e.users||!e.users.length)return this.getRoomInfos(e);for(var i,n=new a({name:t.name,room_id:t.room_id,nway:e.users&&e.users.length>2,directmessage:t.type?"dm"==t.type:null,description:t.description,security:t.security,type:t.type,pathImage:e.room.imgpath?e.room.imgpath.replace("/opt/data",document.rtcwidget_RTC_URL):null,date_in:t.date_in}),o=0;o<e.users.length;o++)e.users[o].login!=this.login?(i=this.getOrSetUser(e.users[o],t.room_id),n.users.add(i)):this.getOrSetUser(e.users[o],t.room_id);if(e.usersLeft)for(o=0;o<e.usersLeft.length;o++)e.usersLeft[o].login!=this.login&&(i=this.getOrSetUser(e.usersLeft[o],t.room_id),n.usersLeft.add(i));return this.rooms.add(n),n}if(s.length>1)return v("Room "+t.room_id+" already exist multiple !!"),{error:"Room already exist multiple"};v("Room "+t.room_id+" already exist, updating it ...");var r=s[0];return r.updateInfos({name:t.name,description:t.description,security:t.security,type:t.type,pathImage:e.room.imgpath?e.room.imgpath.replace("/opt/data",document.rtcwidget_RTC_URL):null}),r},setIMWView:function(e){v("set IMWView "),this.IMWView=e},openRoomIfExpected:function(e,t){if(!this.expectedRoom)return!1;if("firstOne"!=this.expectedRoom)if(this.expectedRoom.room_id){if(this.expectedRoom.room_id!=e.get("room_id"))return!1}else{if(this.expectedRoom.name&&this.expectedRoom.name!=e.get("name"))return!1;if("dm"==this.expectedRoom.type&&e.isChannel())return!1;if("channel"==this.expectedRoom.type&&e.get("directmessage"))return!1;if(this.expectedRoom.length!=t.length)return!1}this.IMWView.startChat(e),this.expectedRoom=null},openRoom:function(e){var t=this.getRoomFromCollection(e);t?this.IMWView.startChat(t):v.error("openRoom room not found "+e)},addRooms:function(e){for(var t in e)this.addRoom(e[t])},addMedia:function(e){var t=this.rooms.where({room_id:e.room_id});1===t.length&&t[0].addMedia(e)},addMessage:function(e,t){if((-1===window.location.href.indexOf("filtre3DIM")||"3dxml"!==e.data.mime&&"3dxm"!==e.data.mime)&&"archive_qty"!==e.type){var s,i=this.rooms.where({room_id:e.room_id});if(1!==i.length)return{error:"Room doesn't exist"};e.message=e.message,"webservice"==e.origin?(e.message={bot:e.username,title:"3DMessaging",txt:e.message,icon:document.rtcwidget_Space_URL+"/widget/images/MyApps/NETDOFT_AP_AppIcon.png"},e.bot=!0,s=i[0].addMessage(e)):s=i[0].addMessage(e),t||i[0].get("active")||!s||"chat"!=s.get("origin")||this.notifications.add({message:s,room_id:e.room_id,room:i[0]})}},addMessages:function(e){for(var t in e)this.addMessage(e[t])},addSearchResult:function(e){for(var t,s=0;s<e.users.length;s++)t=this.getOrSetUser(e.users[s]),this.search.remove(t),this.search.add(t)},sendMessage:function(e){var t={msg:e.message,uuid:e.room_id};v("sendMessage "+JSON.stringify(t)),f({evenement:"SENDMSG",data:t})},sendData:function(e){var t={data:e.html||e.data,roomId:e.room_id,persisted:e.persisted,robotName:e.robotName};e.options&&(t.fileId=e.options.fileId,t.fileName=e.options.fileName),v("sendData "+JSON.stringify(t)),f({evenement:"SENDDATA",data:t})},uploadFile:function(e){f({evenement:"uploadMedia",data:e})},setStatus:function(e){f({evenement:"SETSTATUS",data:e})},startX3DPhoto:function(e){e.url&&(e.url=e.url.replace("/opt/data",document.rtcwidget_RTC_URL)),h.publish("fromwidgetim.ds.com",{evenement:"startX3DPhoto",data:e}),v("startX3DPhoto"),v(e)},sharex3dphoto:function(e){e={rtcUrl:document.rtcwidget_RTC_URL,data:e};h.publish("tox3dphoto.ds.com",{evenement:"sharex3dphoto",data:e}),v("sharex3dphoto"),v(e)},launchCoreview:function(e){e.username=this.username,f({evenement:"coreview",data:e})},startCall:function(e){f({evenement:"startCall",data:e,action:"publish"})},getArchives:function(e){v("getArchives "+JSON.stringify(e)),f({evenement:"GETARCHIVES",data:{uuid:e.room_id,archive_qty:e.archive_qty||20,lastMessageID:e.lastMessageID}})},getMedias:function(e){v("getMedias "+JSON.stringify(e)),f({evenement:"getMedias",data:{room_id:e.room_id}})},editRoom:function(e,t,s,i,n){f({evenement:"UPDATEROOM",action:"publish",data:{room_id:e.get("room_id"),name:t,description:s,security:i,imageBin:n}})},getRoom:function(e,t,s,i,n,a,o){if(i)return this.IMWView.chatPanelView.room||this.IMWView.chatPanelView.hide(),this.IMWView.hideCreationViews();if(!t||!t.length)return!1;var r,l=[];for(var c in t)r=t[c],l.push(r.get("login"));t.error&&v.error(t.error),v("get room with "+l),f({evenement:"GETROOM",action:"publish",data:{logins:l,name:e,type:s,description:n,security:a,imageBin:o}}),this.expectedRoom={name:"#"==e?null:e,length:t.length+1,type:s}},inviteUser:function(e,t){if(!t||!t.length)return!1;var s,i=[];t.error&&v.error(t.error);var n=e.get("room_id");if(!n)return v.error("inviteUser unable to get room_id");for(var a in t)s=t[a],i.push(s.get("login")),v("invite user "+s.get("login")+" in room "+e.get("name")+e.get("room_id")),f({evenement:"JOINROOM",action:"publish",data:{login:s.get("login"),room_id:n}})},doSearch:function(e){v("search "+JSON.stringify(e)),f({evenement:"SEARCHCONTACT",data:e})},removeRoom:function(e,t){if(this.rooms.remove(e),t){var s,i=this.rooms.sortBy("date_in").reverse();if((s=0==i.indexOf(e)?i[1]:i[i.indexOf(e)-1])||(s=i[i.indexOf(e)+1]),s||(s=i[0]),s)this.IMWView.smallDisco.container.isHidden()&&this.IMWView.startChat(s);else{if(0!=this.rooms.length)return v.error("unable to find a roomToDisplay");this.IMWView.smallDisco.container.isHidden()?this.showFMOT():(this.showFMOT(),this.IMWView.showDiscover())}}},joinPublicRoom:function(e){v("joinPublicRoom "+e.get("room_id")),this.expectedRoom={room_id:e.get("room_id")},f({evenement:"JOINPUBLICROOM",data:{room_id:e.get("room_id")}})},leaveRoom:function(e){v("leaveRoom "+e.get("room_id")),f({evenement:"LEAVEROOM",data:{room_id:e.get("room_id")}})},onLeaveRoom:function(e){var t=e.room_id,s=e.user;if(!t||!s||!s.login)return v("onLeaveRoom bad args");var i=this.getRoomFromCollection(t);if(s.login==this.me.get("login"))this.removeRoom(i,!0);else{var n=i&&i.users?i.users.where({login:s.login}):null;if(!n)return v("user "+s.login+" not found in room "+t);i.users.remove(n),i.usersLeft.add(n)}},onJoinRoom:function(e){var t=e.room_id,s=e.user;if(!t||!s||!s.login)return v("onJoinRoom bad args");var i=this.getRoomFromCollection(t),n=this.getOrSetUser(s);if(n.get("login")==this.login)return!0;i.users.add(n)},getRoomFromCollection:function(e){var t=this.rooms.where({room_id:e});return 0===t.length?v("room_id "+e+" not found"):t.length>1?v("wtf many room_id "+e+" !! "):t[0]},sendDiscover:function(){f({evenement:"discover",data:{disco:"ver"}})},onDiscover:function(e){var t=e.publicRooms||e.publicRoom;for(var s in v("discovered "+t.length+" public rooms"),t)this.updatePublicRoom(new a(t[s]))},updatePublicRoom:function(e){var t=this.publicRooms.findWhere({room_id:e.get("room_id")});t?"public"!=e.get("security")?this.publicRooms.remove(t):((e.get("userqty")||0===e.get("userqty"))&&t.set({userqty:e.get("userqty")}),(e.get("mediaqty")||0===e.get("mediaqty"))&&t.set({mediaqty:e.get("mediaqty")}),e.get("name")&&t.set({name:e.get("name")}),e.get("description")&&t.set({description:e.get("description")}),e.get("pathImage")&&t.set({pathImage:e.get("pathImage").replace("/opt/data",document.rtcwidget_RTC_URL)}),e.get("lastmsgDate")&&t.set({lastmsgDate:e.get("lastmsgDate")}),"boolean"==typeof e.get("alreadyIn")&&t.set({alreadyIn:e.get("alreadyIn")})):this.publicRooms.add(e)},discoClick:function(){this.IMWView.showDiscover()},receiveData:function(e,t){if(t){try{n=JSON.parse(e.data)}catch(t){n=e.data}var s=this.getOrSetUser({login:n.login}),i=this.getOrSetUser({login:n.inviter});"hasBeenAdded"==n.NLSkey?e.message=s.get("username")+" "+m[""+n.NLSkey]+" "+i.get("username"):e.message=s.get("username")+" "+m[""+n.NLSkey]}else if(e.nbpart&&0==e.data.indexOf("data"))document[e.fileId]=e.data;else{var n;if((n=JSON.parse(atob(e.data))).bot)e.message=n,e.bot=!0;else{n.datahtml&&(e.message=atob(n.datahtml));try{e.action=JSON.parse(decodeURIComponent(n.data))}catch(e){v.error("unable to parse received data"),v.error(n.data)}}}this.addMessage(e)},receiveSystemMsg:function(e){e.data=e.message,this.receiveData(e,!0)},receiveFromServer:function(e){var t=e.evenement,s=e.data;switch(t){case"CONNECTED":this.user_id=s.user_id,this.login=s.userId,this.username=s.username,v("login success"),s.options&&(s.options.url&&this.setRtcUrl(s.options.url),s.options.swymUrl&&this.setSwymUrl(s.options.swymUrl),s.options["3dspace"]&&this.setSpaceUrl(s.options["3dspace"]),s.options.platformId&&this.setPlatformID(s.options.platformId)),localStorage.getItem("3DIM_ROOM")?this.expectedRoom={room_id:localStorage.getItem("3DIM_ROOM")}:s.data&&s.data.rooms&&s.data.rooms.length?(this.hideFMOT(),this.expectedRoom=s.data.rooms[0]):this.expectedRoom="firstOne",this.me||(this.me=new i({status:s.status,login:s.data.user.login,username:s.data.user.username,tenants:void 0}),document.rtcwidget_Me=this.me,this.users[s.data.user.login]=this.me,this.fmot.setForUser(this.me)),this.addMe&&this.addMe({user:this.me}),s.expectedRoom&&(this.expectedRoom={room_id:s.expectedRoom}),this.sendDiscover();break;case"GROUP":v(s),this.addGroup(s);break;case"ROOM":v(s);var n=this.addRoom(s);this.getArchives({room_id:s.room.room_id,archive_qty:1}),n&&this.openRoomIfExpected(n,s.users);break;case"DISPLAY_ROOM":v("DISPLAY_ROOM "+JSON.stringify(s)),this.openRoom(s.roomId||s.room_id);break;case"ONMESSAGERECEIVED":if(s.room_id=s.roomId,s.message=s.msg||s.html||s.data,"data"==s.origin)try{s.data=JSON.parse(s.message).data,this.receiveData(s)}catch(e){v.error(e)}else"system"==s.origin?this.receiveSystemMsg(s):s.data&&"string"==typeof s.data&&"media"!==s.origin?this.receiveData(s):this.addMessage(s);break;case"ONARCHIVERECEIVED":if(s.room_id=s.uuid,s.message=s.msg,"data"==s.origin)try{s.data=JSON.parse(s.message).data,this.receiveData(s)}catch(e){v.error(e)}else"system"==s.origin?this.receiveSystemMsg(s):this.addMessage(s,!0);break;case"ONPRESENCERECEIVED":v("presence received"+JSON.stringify(s)),this.getOrSetUser({login:s.userId,username:s.username,status:s.status}).set("status",s.status);break;case"RESULTOFSEARCH":v("RESULTOFSEARCH"),v(s),this.addSearchResult({users:s});break;case"COREVIEW":v("COREVIEW"),v(s),this.onCoreview(s);break;case"onLeaveRoom":v("onLeaveRoom"),v(s),this.onLeaveRoom(s);break;case"onJoinRoom":v("onJoinRoom"),v(s),this.onJoinRoom(s);break;case"mediaReceived":this.addMedia(s);break;case"discovered":this.onDiscover(s);break;default:v.error("unregistered event : "+t)}}});return g.getInstance=function(e){return u||(u=new I(e)).setup(),u},g}),define("DS/InstantMessagingW/InstantMessagingW",["UWA/Class","UWA/Class/Events","DS/RTProxyDriver/RTProxyDriver","DS/WAFData/WAFData","DS/InstantMessagingW/js/controller/IMWController","DS/MessageBus/MessageBus","DS/PlatformAPI/PlatformAPI","DS/InstantMessagingWebRTC/InstantMessagingWebRTC","DS/RTProxyDriver/RTLogger"],function(e,t,s,i,n,a,o,r,l){return e.extend(t,{init:function(e){l.addLevel("WManager","maroon"),l.WManager("InstantMessaging Embedded Manager init"),this.channelToServer="fromwidgetim.ds.com",this.channelToWidget="towidgetim.ds.com",this.params=e,this.params.embeddedManager=!0,this.appName="widget",this.devEnv="http://127.0.0.1:8176"==location.origin},setup:function(){var e;for(var t in this.getServicesInfos((e=this,function(t){e.params.swymUrl=t["3dswym"],e.params.rtcUrl||(e.params.rtcUrl=t["3dmessaging"].replace("/rest","/")),e.params.passportUrl||(e.params.passportUrl=t["3dpassport"]),e.params.spaceUrl||(e.params.spaceUrl=t["3dspace"]),e.params.platformId=window.sessionStorage.getItem("3DIMfavoriteTenant")||t.platformid,e.webrtcCtrl=new r({nwayActivated:!0,appName:e.appName,login:e.login,userName:e.user.userName,swymUrl:e.params.swymUrl,doLogRTC:!1,url:"toremove",platformId:"toremove"}),e.loadWidget(),e.connectToServer()})),this.eventsFromDriver=["CONNECTED","GROUP","ROOM","ONMESSAGERECEIVED","ONDATARECEIVED","ONARCHIVERECEIVED","ONPRESENCERECEIVED","RESULTOFSEARCH","onJoinRoom","COREVIEW","miscellaneous","onLeaveRoom","mediaReceived","discovered"],this.eventsFromDriver)!function(e,t){s.addEvent(e,function(s){t.publishToWidget(e,s)})}(this.eventsFromDriver[t],this)},getServicesInfos:function(e){if(this.devEnv)return this.params.passportUrl="none",this.params.rtcUrl="http://localhost:443",this.params.login=UWA.Utils.getQueryString(window.top.document.URL,"login3DIM"),this.user={userName:this.params.login+"name",login:this.params.login},e({platformid:UWA.Utils.getQueryString(window.top.document.URL,"tenant3DIM")||"hyper3dsy"}),!0;this.params.passportUrl=o.getApplicationConfiguration("app.urls.passport"),this.user=o.getUser(),this.login=this.user.login;var t=this.chooseTenant();require(["DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices"],function(s){s.getPlatformServices({onComplete:function(s){for(var i=0;i<s.length;i++)for(var n in s[i])s[i].hasOwnProperty(n)&&(s[i][n.toLowerCase()]=s[i][n],delete s[i][n]);if(t){for(var i in s)if(s[i].platformid===t){e(s[i]);break}}else e?e(s[0]):l.error("InstantMessagingW unable to selecte resources to connect to")}})})},chooseTenant:function(){var e=widget.getValue("x3dPlatformId");if(e)return e;if(this.user)try{var t=JSON.parse(this.user.properties.dashboards);for(var s in t)if(t[s].platformId)return t[s].platformId}catch(e){return null}return null},connectToServer:function(){var e=this.params.passportUrl,t={nameApp:"3DIM",driverName:"NODE",url:this.params.rtcUrl,domaineName:this.params.platformId,username:this.params.username,passportUrl:e,credentials:{jid:this.params.login||"noLogin",user:this.params.login,password:null}};s.dispatch(s.eventName.SETDRIVER,[t])},loadWidget:function(){var e=n.getInstance(this.params);this.IMWCtrl=e,document.IMWCtrl=e,this.IMWCtrl.addEvent("sendToServer",this.fromWidgetListener)},publishToWidget:function(e,t){if(!this.IMWCtrl)return l.error("no IMWCtrl");this.IMWCtrl.receiveFromServer({evenement:e,data:t})},fromWidgetListener:function(e){var t=e.evenement,i=e.data,n=e.action;"CONNECTED"==t||"publish"!==n&&!i||s.dispatch(t,[i])}})});