define("DS/SNUQLEditor/Adapters/PredicatesAdapter",["UWA/Core","UWA/Class","DS/SNInfraUX/Logger","text!DS/SNUQLEditor/assets/PredicatesMockUp.json","DS/SNInfraUX/SearchUtils","DS/SNInfraUX/SNVocabAccess"],function(e,t,s,i,n,r){"use strict";return t.singleton({_basicPredicates:[{uri:"ds6w:type",displayValue:"Type",value:"[ds6w:type]:",suggestionType:"predicates"},{uri:"ds6w:label",displayValue:"Title",value:"[ds6w:label]:",suggestionType:"predicates"},{uri:"ds6w:identifier",displayValue:"Name",value:"[ds6w:identifier]:",suggestionType:"predicates"},{uri:"ds6w:modified",displayValue:"Modification Date",value:"[ds6w:modified]:",suggestionType:"predicates"},{uri:"ds6w:description",displayValue:"Discription",value:"[ds6w:description]:",suggestionType:"predicates"},{uri:"ds6w:responsible",displayValue:"Owner",value:"[ds6w:responsible]:",suggestionType:"predicates"},{uri:"ds6w:created",displayValue:"Creation Date",value:"[ds6w:created]:",suggestionType:"predicates"}],_type2PredicatesPromise:{},init:function(){},getSuggestions:function(t,s,i){let o=this,a=i.types.length>0,c=n.getActiveTenant(),l=t.slice(0,s),u=/\w*$/.exec(l)[0],d=new RegExp("^"+UWA.String.escapeRegExp(u),"i");return new Promise((t,s)=>{if(!0!==i.context.isPredicate)t([]);else if(a){let s=i.types,n=[];s.forEach((t,s)=>{e.is(o._type2PredicatesPromise[t])?n.push(o._type2PredicatesPromise[t]):(o._type2PredicatesPromise[t]=new Promise((e,s)=>{let i={className:t,tenantId:c};r.loadRelevantPredicates(i,e)}),n.push(o._type2PredicatesPromise[t]))}),Promise.all(n).then(function(e){let s=o._getCommonPredicates(e);t(s.filter(function(e){return d.test(e.nlsName)}).map(e=>({displayValue:e.nlsName,value:"["+e.uri+"]:",uri:e.uri,suggestionType:"predicates"})).concat(o._basicPredicates.filter(function(e){return d.test(e.displayValue)})))})}else t(o._basicPredicates.filter(function(e){return d.test(e.displayValue)}))})},_getCommonPredicates:function(e){let t,s=e[0].vocabularyPredicateInfo;return e.forEach((e,i)=>{i>0&&(t=e.vocabularyPredicateInfo,s=s.filter(e=>t.some(t=>e.uri===t.uri)))}),s}})}),define("DS/SNUQLEditor/Adapters/PredicateValueAdapter",["UWA/Core","UWA/Class","DS/SNInfraUX/SNVocabAccess","DS/SNInfraUX/SearchUtils","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/WAFData/WAFData","DS/SNInfraUX/SearchLogin"],function(e,t,s,i,n,r,o){"use strict";return t.singleton({_interfaces:null,init:function(){},getSuggestions:function(t,s,i){let n=this,r=t.slice(0,s),o=i.currentPredicate,a=/\w*$/.exec(r)[0],c=new RegExp("^"+UWA.String.escapeRegExp(a),"i");return new Promise((s,r)=>{!0!==i.context.isTag?s([]):e.is(o)?n._getSuggestions(t,i).then(function(e){s(e.filter(function(e){return c.test(e.displayValue)}))}):s([])})},_getSuggestions:function(t,s){let i=this;return new Promise((n,r)=>{let o=function(t){let i=[];e.is(t.facets,"array")?(t.facets.forEach(e=>{e.sixw.indexOf(s.currentPredicate)>=0&&i.push({displayValue:e.object,value:e.object,suggestionType:"tag",uri:e.sixw})}),n(i)):n([])};i._fedSearch(t,s,o,o)})},_getFedSearchOptions:function(e,t){let s=t.currentPredicate,n=i.getActiveTenant(),r=o.getAvailableSources(n),a=(r=r.map(e=>e.name)).includes("swym"),c=t.types,l="";l=c[0].indexOf("ds6wg:")>=0?'(flattenedtaxonomies:"types/'+c[0].replace("ds6wg:","")+'"':'([ds6w:type]:"'+c[0]+'"',c.forEach((e,t)=>{t>0&&(e[0].indexOf("ds6wg:")>=0?l+=' OR flattenedtaxonomies:"types/'+e.replace("ds6wg:","")+'"':l+=" OR [ds6w:type]:"+e)}),l+=")";let u={label:"ExpertSearchSuggest-"+i.getUserId()+"-"+(new Date).getTime(),order_by:"desc",order_field:"relevance",query:l,select_predicate:[s],nresults:1,source:r,tenant:n,with_nls:!1};return a||(u.select_synthesis=[s]),u},_fedSearch:function(t,s,o,a){var c=this;n.getServiceUrl({serviceName:"3DSearch",platformId:i.getActiveTenant(),onComplete:function(i){if(e.is(i,"string")){let e=c._getFedSearchOptions(t,s),n={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},data:JSON.stringify(e),onComplete:function(e){let t=JSON.parse(e);o(t)},onFailure:function(e){a([])}};r.authenticatedRequest(i+"/search",n)}else a([])},onFailure:function(e){a([])}})}})}),define("DS/SNUQLEditor/Adapters/TypeAdapter",["UWA/Core","UWA/Class","DS/SNInfraUX/Logger","text!DS/SNUQLEditor/assets/TypesMockUp.json","DS/SNInfraUX/SearchUtils","DS/SNInfraUX/SNVocabAccess","DS/SNInfraUX/SearchLogin"],function(e,t,s,i,n,r,o){"use strict";return t.singleton({_types:null,init:function(){let e=this;Promise.all(this._loadVocabClassesForAllServices()).then(function(t){let s,i=[];t.forEach(e=>{i=i.concat(e.classInfos)}),e._types=i.map(e=>(s=e.uri.split(":").pop(),{displayValue:e.nlsName,value:"3DSpace"===e.service?'flattenedtaxonomies:"types/'+s+'"':'[ds6w:type]:"'+e.uri+'"',suggestionType:"class",uri:e.uri}))})},getSuggestions:function(t,s,i){let n=this,r=t.slice(0,s),o=/\w*$/.exec(r)[0],a=new RegExp("^"+UWA.String.escapeRegExp(o),"i");return new Promise((t,s)=>{!0!==i.context.isType?t([]):e.is(n._types)?t(n._types.filter(function(e){return e=e.displayValue,a.test(e)})):t([])})},_loadVocabClassesForAllServices:function(){let e=[],t=n.getActiveTenant(),s=o.getAvailableSources(t),i=n.getLanguage();return s.forEach(s=>{s.status&&e.push(new Promise((e,n)=>{r.loadVocabularyClasses({vocabId:s.service,tenantId:t,lang:i},e)}))}),e}})}),define("DS/SNUQLEditor/utils/ContextManager",["UWA/Core","UWA/Class"],function(e,t){"use strict";return t.singleton({_types:[],_interfaces:[],getContext:function(){return{context:{isType:!0,isInterface:!0,isOperator:!0,isPredicate:!0,isTag:!0},types:this._types,interfaces:this._interfaces,currentPredicate:this._selectedPreicates}},addSelectedType:function(e){this._types.push(e)},addSelectedInterface:function(e){this._interfaces.push(e)},setSelectedPredicate:function(e){this._selectedPreicates=e},resetContext:function(){this._types=[],this._interfaces=[],this._selectedPreicates=null}})}),define("DS/SNUQLEditor/Adapters/InterfacesAdapter",["UWA/Core","UWA/Class","DS/SNInfraUX/Logger","text!DS/SNUQLEditor/assets/InterfacesMockUp.json","DS/SNInfraUX/SNVocabAccess","DS/SNInfraUX/SearchUtils"],function(e,t,s,i,n,r){"use strict";return t.singleton({_interfaces:null,init:function(){},getSuggestions:function(e,t,s){let i=e.slice(0,t),o=/\w*$/.exec(i)[0],a=new RegExp("^"+UWA.String.escapeRegExp(o),"i");return new Promise((e,t)=>{if(!0!==s.context.isInterface)e([]);else if(1===s.types.length){let t=r.getActiveTenant();n.loadRelevantInterfaces({className:s.types[0],tenantId:t},function(t){e(t.interfaces.filter(function(e){return a.test(e.nlsName)}).map(e=>({displayValue:e.nlsName,value:'flattenedtaxonomies:"interfaces/'+e.name.replace("ds6wg:","")+'"',suggestionType:"interface",uri:e.name})))})}else e([])})}})}),define("DS/SNUQLEditor/utils/InContextSearchManager",["UWA/Core","UWA/Class","DS/SNInfraUX/SearchCom","UWA/Utils/InterCom"],function(e,t,s,i){"use strict";return t.singleton({_socket:null,init:function(){this._socket=new i.Socket("socket_id_#expert_query_search#",{dispacthRetryInterval:0}),this._socket.subscribeServer("SearchComServer")},search:function(e){let t=this,s=this._getInContextOptions(e);this._socket.dispatchEvent("RegisterContext",s),this._socket.addListener("RegisterContext_Response",function(){t._socket.dispatchEvent("InContextSearch",s)}),this._socket.addListener("onCloseTransient",this._cleanUpContext.bind(this))},_getInContextOptions:function(e){return{widget_id:"widget_id_#expert_query_search#",app_socket_id:"socket_id_#expert_query_search#",title:"Expert Query Results",default_search_criteria:e,search_criteria_to_display:"",precond:void 0,default_with_precond:!0}},_cleanUpContext:function(){this._socket.dispatchEvent("UnregisterContext",{widget_id:"widget_id_#expert_query_search#"}),this._socket.removeListener("RegisterContext_Response"),this._socket.removeListener("onCloseTransient")},destroy:function(){this._socket.unsubscribeServer("SearchComServer"),this._socket=null}})}),define("DS/SNUQLEditor/Adapters/OperatorAdapter",["UWA/Core","UWA/Class","DS/SNInfraUX/Logger","text!DS/SNUQLEditor/assets/OperatorsMockUp.json"],function(e,t,s,i){"use strict";return t.singleton({_operators:null,init:function(){let e=JSON.parse(i);this._operators=e.operators.map(e=>({displayValue:e.displayValue,value:e.value,suggestionType:"oparator",uri:e.value}))},getSuggestions:function(t,s,i){let n=this,r=t.slice(0,s),o=/\w*$/.exec(r)[0],a=new RegExp("^"+UWA.String.escapeRegExp(o),"i");return new Promise((t,s)=>{!0!==i.context.isOperator?t([]):e.is(n._operators)?t(n._operators.filter(function(e){return e=e.displayValue,a.test(e)})):s(n._operators)})}})}),define("DS/SNUQLEditor/UQLAutoComplete",["UWA/Core","UWA/Controls/Autocomplete"],function(e,t){"use strict";return t.extend({init:function(e){this._parent(e)},onHideSuggestions:function(){},onShowSuggestions:function(){}})}),define("DS/SNUQLEditor/DataAdaptor",["UWA/Core","UWA/Controls/AutocompleteAdaptors/Abstract","text!DS/SNUQLEditor/assets/Adaptors.json","DS/SNUQLEditor/utils/ContextManager"],function(e,t,s,i){"use strict";return t.extend({getSuggestions:function(t,s){let n=this;n._context=i.getContext();let r=t.slice(0,s),o=/\w*$/.exec(r)[0],a=this.getAdaptors();return new Promise((i,r)=>{if(e.is(a,"array")&&a.length>0){let e=[];require(a,function(){for(let i=0;i<arguments.length;i++)e.push(arguments[i].getSuggestions(t,s,n._context));Promise.all(e).then(function(){let e=[];for(let t=0;t<arguments[0].length;t++)e=e.concat(arguments[0][t]);let t=e.map(function(e){return{displayValue:e.displayValue,start:s-o.length,end:s,fullValue:e.value,lastWord:o,suggestionType:e.suggestionType,uri:e.uri}},n);i(t)})})}else i([])})},getAdaptors:function(){return JSON.parse(s).adaptors}})}),define("DS/SNUQLEditor/SNUQLEditorUX",["UWA/Core","UWA/Element","UWA/Controls/Abstract","UWA/Promise","DS/SNInfraUX/Logger","DS/SNUQLEditor/UQLAutoComplete","DS/SNUQLEditor/DataAdaptor","DS/UIKIT/Input/Button","DS/UIKIT/Modal","css!SNUQLEditor/SNUQLEditor","DS/SNUQLEditor/utils/ContextManager","DS/SNUQLEditor/utils/InContextSearchManager"],function(e,t,s,i,n,r,o,a,c,l,u,d){"use strict";return s.extend({_editorDialog:null,_autocomplete:null,init:function(e){this._parent(e),this._buildUI()},_buildUI:function(){let e=document.body,t=this;this._editorDialog=new c({header:"UQL Editor",closable:!0,escapeToClose:!1,visible:!0,body:this.getAutocomplete(),footer:this.getButtons(),events:{onHide:function(){t._cleanUp()}}}).inject(e),document.getElementsByClassName("modal-content")[0].addClassName("uql-editor-container")},getButtons:function(){let e=this,t=[];return t[0]=new a({className:"primary",value:"Search",events:{onClick:function(){console.log("InContext search invocked"),e._searchInContext()}}}),t[1]=new a({className:"primary",value:"Save",disabled:!0,events:{onClick:function(){}}}),t[2]=new a({value:"Cancel",events:{onClick:function(){console.log("Cancel button invocked"),e._cleanUp()}}}),t},getAutocomplete:function(){let e=t.create("div",{class:"div-autocomplete",id:"div-autocomplete",styles:{height:"100%",width:"100%","min-height":"inherit"}});return this._autocomplete=new r({adaptor:o,multiline:!0,floatingSuggestions:!0,typeDelay:500,inputOptions:{attributes:{placeholder:"Start writing custom UQL...",styles:{left:0,opacity:1,"font-family":"3ds"}}}}).inject(e),this._autocomplete.elements.container.style.height="inherit",this._autocomplete.elements.container.style.width="inherit",this._autocomplete.elements.container.style["min-height"]="inherit",this._autocomplete.addEvent("onSetSuggestion",this.onSetSuggestion,!1),e},_searchInContext:function(){let e=this._autocomplete.getValue();this._cleanUp(),d.search(e)},_cleanUp:function(){u.resetContext(),this._editorDialog.destroy(),this._autocomplete.destroy()},onSetSuggestion:function(e){"class"===e.suggestionType?u.addSelectedType(e.uri):"interface"===e.suggestionType?u.addSelectedInterface(e.uri):"predicates"===e.suggestionType&&u.setSelectedPredicate(e.uri)},destroy:function(){}})});