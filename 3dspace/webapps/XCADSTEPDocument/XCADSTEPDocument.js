define("DS/XCADSTEPDocument/STEPTessellatedRepresentation",["DS/XCADInputDocuments/XCADTessellatedRepresentation","DS/XCADInputDocuments/XCADRepresentation","DS/XCADInputDocuments/XCADFaceData","DS/XCADInputDocuments/XCADEdgeData","DS/Mesh/ThreeJS_Base"],function(e,t,s,n,i){"use strict";var r=/([^,]+)/g,o=/\(([^)]+)\)/g,a={COMPLEX_TRIANGULATED_FACE:e.KindOfNode.NOD_GP,TESSELLATED_SOLID:e.KindOfNode.NOD_SolidNode,TESSELLATED_SHELL:e.KindOfNode.NOD_SolidNode,TESSELLATED_WIRE:e.KindOfNode.NOD_SurfacicNode,TESSELLATED_EDGE:e.KindOfNode.NOD_GP,TRIANGULATED_FACE:e.KindOfNode.NOD_GP,TESSELLATED_CONNECTING_EDGE:e.KindOfNode.NOD_GP,TESSELLATED_GEOMETRIC_SET:e.KindOfNode.NOD_ContainerNode},c={COMPLEX_TRIANGULATED_FACE:e.KindOfGP.GP_Face,TRIANGULATED_FACE:e.KindOfGP.GP_Face,TESSELLATED_EDGE:e.KindOfGP.GP_Edge,TESSELLATED_CONNECTING_EDGE:e.KindOfGP.GP_Edge};return e.extend(function(e,s){this._associatedDocument=e,this._stepTokenizeArgs=e.stepTokenizeArgs,this._representationType=t.XCAD_TESSELLATED_REPRESENTATION,this._stepRepresentationIndex=s;var n=[];e.stepTokenizeArgs(e.stepEntities[s.substring(1)],n),this._rootNodes=[],e.stepTokenizeArgs(n[1],this._rootNodes),this._verticelist={},this._associatedDocument.CoordSystem.Coord=!1,this._associatedDocument.CoordSystem.Origin=void 0,this._associatedDocument.CoordSystem.Axis=void 0,this._associatedDocument.CoordSystem.RefDir=void 0;for(var i=0;i<this._rootNodes.length;i++){var r=[];if(this._stepTokenizeArgs(this._associatedDocument.stepEntities[this._rootNodes[i].substring(1)],r),null!=r[1]){var o=r[1].replace("(","").replace(")",""),a=this._associatedDocument._stepGetEntityType(o.substring(1));if("AXIS2_PLACEMENT_3D"===a.first){this._stepTokenizeArgs(a.second,r),this._associatedDocument.CoordSystem.Coord=!0;var c=[],u=[],d=[];if(this._stepTokenizeArgs(this._associatedDocument.stepEntities[o.substring(1)],r),null!=r[1]&&null!=r[2]&&null!=r[3]){var E=this._associatedDocument._stepGetEntityType(r[1].substring(1));if("CARTESIAN_POINT"===E.first){var l=[];this._stepTokenizeArgs(E.second,l),this._stepTokenizeArgs(l[1],c),void 0===this._associatedDocument.CoordSystem.Origin&&(this._associatedDocument.CoordSystem.Origin=c)}if("DIRECTION"===(E=this._associatedDocument._stepGetEntityType(r[2].substring(1))).first){l=[];this._stepTokenizeArgs(E.second,l),this._stepTokenizeArgs(l[1],u),void 0===this._associatedDocument.CoordSystem.Axis&&(this._associatedDocument.CoordSystem.Axis=u)}if("DIRECTION"===(E=this._associatedDocument._stepGetEntityType(r[3].substring(1))).first){l=[];this._stepTokenizeArgs(E.second,l),this._stepTokenizeArgs(l[1],d),void 0===this._associatedDocument.CoordSystem.RefDir&&(this._associatedDocument.CoordSystem.RefDir=d)}}}}}!1===this._associatedDocument.CoordSystem.Coord&&(this._associatedDocument.CoordSystem.Origin=void 0,this._associatedDocument.CoordSystem.Axis=void 0,this._associatedDocument.CoordSystem.RefDir=void 0)},{_fillVerticesList:function(e){let t=this._associatedDocument.stepEntities[e],s=t.substr(t.indexOf("((")+1,t.indexOf("))")-2).match(o);this._verticelist[e]=[];let n=[],i=s.length;for(var a=0;a<i;a++)3===(n=s[a].substr(1,s[a].length-2).match(r)).length&&this._verticelist[e].push(n[0],n[1],n[2]),n=null},_processTriangleStrips:function(e,t,s){var n=t.substr(1,t.length-2).match(o),i=1===s.length;let a=n.length;for(let t=0;t<a;t++){let o=n[t].substr(1,n[t].length-2).match(r),a=o.length;for(let t=0;t<a;t++){let n=o[t];if(n-=1,e.stripTrianglesIndices.push(n),!i){let t=s[n].substr(1,s[n].length-2).match(r);e.setNormalAt(n,t[0],t[1],t[2]),t=null}}e.nbVertexPerStripTriangle.push(o.length),o=null}n=null},_processTriangleFans:function(e,t,s){var n=t.substr(1,t.length-2).match(o);if(null!==n)for(var i=1===s.length,a=0;a<n.length;a++){for(var c=n[a].substr(1,n[a].length-2).match(r),u=0;u<c.length;u++){var d=c[u]-1;if(e.fanTrianglesIndices.push(e.getFanTrianglesVertexPosition(d)),!i){var E=s[d].substr(1,s[d].length-2).match(r);e.setNormalAt(d,E[0],E[1],E[2])}}e.nbVertexPerFanTriangle.push(c.length)}},getChildren:function(e,t){var s=[];if(t){s=this._associatedDocument.stepEntities[e.substring(1)].substring(this._associatedDocument.stepEntities[e.substring(1)].indexOf("TESSELLATED_GEOMETRIC_SET(")+27,this._associatedDocument.stepEntities[e.substring(1)].indexOf("))")).match(/([^,]+)/g)}else{var n=[];this._stepTokenizeArgs(this._associatedDocument.stepEntities[e.substring(1)],n),this._stepTokenizeArgs(n[1],s)}return s},getChild:function(e,t){var s=[];this._stepTokenizeArgs(this._associatedDocument.stepEntities[e.substring(1)],s);var n=[];return this._stepTokenizeArgs(s[1],n),n[t]},getChildCount:function(e,t){var s=[];if(t){s=this._associatedDocument.stepEntities[e.substring(1)].substring(this._associatedDocument.stepEntities[e.substring(1)].indexOf("TESSELLATED_GEOMETRIC_SET(")+27,this._associatedDocument.stepEntities[e.substring(1)].indexOf("))")).match(/([^,]+)/g)}else{var n=[];this._stepTokenizeArgs(this._associatedDocument.stepEntities[e.substring(1)],n),this._stepTokenizeArgs(n[1],s)}return s.length},getAssociatedTransfo:function(e){var t=void 0,s=[];this._stepTokenizeArgs(this._associatedDocument.stepEntities[e.substring(1)],s);var n=[];this._stepTokenizeArgs(s[1],n);let r=this._associatedDocument._stepGetEntityType(n[0].substring(1));if("AXIS2_PLACEMENT_3D"===r.first){var o=[];this._stepTokenizeArgs(r.second,o),this._associatedDocument.CoordSystem.Coord=!0;var a=[],c=[],u=[];if(this._stepTokenizeArgs(this._associatedDocument.stepEntities[n[0].substring(1)],o),null!=o[1]&&null!=o[2]&&null!=o[3]){var d=this._associatedDocument._stepGetEntityType(o[1].substring(1));if("CARTESIAN_POINT"===d.first){var E=[];this._stepTokenizeArgs(d.second,E),this._stepTokenizeArgs(E[1],a)}if("DIRECTION"===(d=this._associatedDocument._stepGetEntityType(o[2].substring(1))).first){E=[];this._stepTokenizeArgs(d.second,E),this._stepTokenizeArgs(E[1],c)}if("DIRECTION"===(d=this._associatedDocument._stepGetEntityType(o[3].substring(1))).first){E=[];this._stepTokenizeArgs(d.second,E),this._stepTokenizeArgs(E[1],u)}var l=parseFloat(a[0]),h=parseFloat(a[1]),_=parseFloat(a[2]),T=new i.Matrix3,p=new i.Vector3(u[0],u[1],u[2]),f=new i.Vector3(c[0],c[1],c[2]),g=new i.Vector3;g.crossVectors(f,p),T.set(p.x,g.x,f.x,p.y,g.y,f.y,p.z,g.z,f.z),(t=new i.Matrix4).set(T.elements[0],T.elements[3],T.elements[6],l,T.elements[1],T.elements[4],T.elements[7],h,T.elements[2],T.elements[5],T.elements[8],_,0,0,0,1)}}return t},getGeomSet:function(e){var t=[];this._stepTokenizeArgs(this._associatedDocument.stepEntities[e.substring(1)],t);var s=[];return null!=t[3]&&this._stepTokenizeArgs(t[3].substring(1,t[3].length-1),s),s},getCircleData:function(e){throw"Error: not implemented method"},getConeData:function(e){throw"Error: not implemented method"},getCoordinateSystem:function(){return this._associatedDocument.CoordSystem},getCylinderData:function(e){throw"Error: not implemented method"},getEdgeData:function(e){var t=new n;e=e.substring(1);var s=this._associatedDocument._stepGetEntityType(e);if("TESSELLATED_EDGE"===s.first||"TESSELLATED_CONNECTING_EDGE"===s.first){var i,r=[];if(this._stepTokenizeArgs(this._associatedDocument.stepEntities[e],r),null!=r[1]&&(i=r[1].substring(1)),"COORDINATES_LIST"===this._associatedDocument._stepGetEntityType(i).first){void 0===this._verticelist[i]&&this._fillVerticesList(i);for(var o=r[3].replace("(","").replace(")","").split(","),a=0;a<o.length;a++){parseInt(o[a]);for(var c=0;c<3;c++)t.vertices[3*a+c]=this._verticelist[i][3*(o[a]-1)+c]}}}return t},getFaceData:function(e){var t=new s,n=this._associatedDocument._stepGetEntityType(e.substring(1));switch(""+n.first){case"COMPLEX_TRIANGULATED_FACE":var i=[];this._stepTokenizeArgs(n.second,i);var a=i[1].substring(1);void 0===this._verticelist[a]&&this._fillVerticesList(a);var c=i[3].substr(1,i[3].length-2).match(o);if(1===c.length)for(var u=c[0].substr(1,c[0].length-2).match(r),d=0;d<i[2];d++)t.normals.push(u[0],u[1],u[2]);var E=i[5].substr(1,i[5].length-2).match(/([^,]+)/g);if(null!=E)for(d=0;d<E.length;d++)for(var l=3*(E[d]-1),h=0;h<3;h++)t.vertices[3*d+h]=this._verticelist[a][l+h];else t.vertices=this._verticelist[a];if(i[6].length>2&&this._processTriangleStrips(t,i[6],c),i[7].length>2&&this._processTriangleFans(t,i[7],c),t.vertices.length!=t.normals.length){var _=[],T=[],p=[];if(0!=t.stripTrianglesIndices.length&&(p=new Set(t.stripTrianglesIndices)),0!=t.fanTrianglesIndices.length&&(p=new Set([...p,...t.fanTrianglesIndices])),0!=t.singleTrianglesIndices.length&&(p=new Set([...p,...t.singleTrianglesIndices])),null!=p)for(l=Array.from(p),d=0;d<l.length;d++)_[3*l[d]]=t.vertices[3*l[d]],_[3*l[d]+1]=t.vertices[3*l[d]+1],_[3*l[d]+2]=t.vertices[3*l[d]+2],T[3*l[d]]=t.normals[3*l[d]],T[3*l[d]+1]=t.normals[3*l[d]+1],T[3*l[d]+2]=t.normals[3*l[d]+2];t.vertices=_,t.normals=T}}return t},getGPType:function(e){var t=this._associatedDocument._stepGetEntityType(e.substring(1));return c[t.first]},getNodeBoundingSphere:function(e){throw"Error: not implemented method"},getNodeColor:function(e){e=e.substring(1);var t=this._associatedDocument.overridingFaceColors[e];return void 0!==t?t:this._associatedDocument.bodyColors[e]},getNodeOrientationMatrix:function(e){throw"Error: not implemented method"},getNodeType:function(e){var t=this._associatedDocument._stepGetEntityType(e.substring(1));return a[t.first]},getNodeUID:function(e){throw"Error: not implemented method"},getPlaneData:function(e){throw"Error: not implemented method"},getPointData:function(e){throw"Error: not implemented method"},getPolyLineData:function(e){return e=e.substring(1),[this._associatedDocument.curveFont[e],this._associatedDocument.curveWidth[e]]},getRootNode:function(e){var t=this._rootNodes[e];if("[COMPLEX_STEP_ENTITY]"===this._associatedDocument._stepGetEntityType(t.substring(1)).first){var s=t;t=this._associatedDocument.stepGetNodeIdFromCpxEntity(s.substring(1))}return t},getRootNodesCount:function(){return this._rootNodes.length},getSAG:function(e){throw"Error: not implemented method"},getSphereData:function(e){throw"Error: not implemented method"},isIndexed:function(){return!0}})}),define("DS/XCADSTEPDocument/STEPProductInstance",["DS/XCADInputDocuments/XCADProductInstance"],function(e){"use strict";return e.extend(function(e,t){this._document=e,this._stepProductInstance=t},{getGeometricProperties:function(){throw"Error: not implemented method"},getInstanceAttributes:function(){var e=[];return e.push(this._stepProductInstance.instanceName),e},getReferenceProduct:function(){return this._document.getProductReference(this._stepProductInstance.productReferenceIdx)},getUID:function(){throw"Error: not implemented method"},getTransformation:function(){var e,t=this._stepProductInstance.transfo;if(void 0!==t){var s=t.rotation.elements,n=t.translation;e=[[[s[0],s[1],s[2]],[s[3],s[4],s[5]],[s[6],s[7],s[8]]],[n.x,n.y,n.z]]}return e}})}),define("DS/XCADSTEPDocument/STEPProductRepresentation",["DS/XCADInputDocuments/XCADProductRepresentation"],function(e){"use strict";return e.extend(function(e,t,s){this._name=s,this._associatedDocument=e,this._representationType=t,this._rootProducts=[]},{addRootProduct:function(e){this._rootProducts.push(e)}})}),define("DS/XCADSTEPDocument/STEPProduct",["exports","DS/XCADInputDocuments/XCADProduct","DS/XCADSTEPDocument/STEPProductInstance"],function(e,t,s){"use strict";var n=t.extend(function(e,t){this._document=e,this._stepProduct=t},{getDocument:function(){var e,t=this._stepProduct.geomRep;return null!=t&&"internal"===t.type&&((e=this._document)._internalRepresentationIndex=t.location),e},getFilePath:function(){var e;return void 0!==this._stepProduct.geomRep&&null!==this._stepProduct.geomRep&&"external"===this._stepProduct.geomRep.type&&(e=this._stepProduct.geomRep.location),e},getGeometricProperties:function(){throw"Error: not implemented method"},getInstanceList:function(){for(var e=[],t=this._stepProduct.childrenList.length,n=0;n<t;n++){var i=new s(this._document,this._stepProduct.childrenList[n]);null!=i&&e.push(i)}return e},getProductAttributes:function(){var e=[];return e.push(this._stepProduct.referenceName),e.push(""),e.push(""),e.push(""),e.push(""),e.push(t.SourceTypes.Unknown),e},getUID:function(){throw"Error: not implemented method"}});return e.STEPProduct=n,n}),define("DS/XCADSTEPDocument/STEPInputDocument",["DS/XCADInputDocuments/XCADInputDocument","DS/XCADInputDocuments/XCADRepresentation","DS/XCADSTEPDocument/STEPTessellatedRepresentation","DS/XCADSTEPDocument/STEPProductRepresentation","DS/XCADSTEPDocument/STEPProduct","DS/XCADInputDocuments/XCADFaceData","DS/Mesh/ThreeJS_Base","DS/XCADLoader/XCADError"],function(e,t,s,n,i,r,o,a){"use strict";t.XCAD_TESSELLATED_REPRESENTATION;var c=/\(([^)]+)\)/g,u=/([^,]+)/g;return e.extend(function(){this.bodyColors=[],this.overridingFaceColors=[],this.assyProducts=[],this.tesselatedReps=[],this.stepEntities=[],this.curveFont=[],this.curveWidth=[],this.rootProducts=[],this.nbCpxTriFace=0,this.nbWire=0,this.CoordSystem={Coord:!1,Origin:void 0,Axis:void 0,RefDir:void 0},this.nbInstPart=0},{zipped:!1,requestResponseType:"text",stepTokenizeComplexEntity:function(e,t){var s=0,n="";t.length=0;for(var i=0;i<e.length;i++)"("===e[i]?(s>=1&&(n+=e[i]),s++):")"===e[i]?--s>=1&&(n+=e[i],1===s&&(t.push(n),n="")):n+=e[i]},stepGetNodeIdFromCpxEntity:function(e){var t=this.stepEntities[e],s=[];this.stepTokenizeComplexEntity(t,s);var n=[];this.stepTokenizeArgs(s[3],n);var i=[];return this.stepTokenizeArgs(n[0],i),i},_stepGetEntityType:function(e){var t,s=this.stepEntities[e];void 0!==s&&(t="("===s[0]?-1!==s.indexOf("TESSELLATED_GEOMETRIC_SET")?"TESSELLATED_GEOMETRIC_SET":"[COMPLEX_STEP_ENTITY]":s.match(/^\w+/)[0]);return{first:t,second:s}},close:function(){void 0!==this._internalRepresentationIndex&&delete this._internalRepresentationIndex},getProductReference:function(e){return new i(this,this.assyProducts[e])},getRepresentation:function(e){var i;if(void 0!==this._internalRepresentationIndex)e===t.XCAD_TESSELLATED_REPRESENTATION&&(i=new s(this,this._internalRepresentationIndex));else if(0===Object.keys(this.assyProducts).length&&0!==this.tesselatedReps.length&&e===t.XCAD_TESSELLATED_REPRESENTATION)i=new s(this,this.tesselatedReps[0]);else if(0!==Object.keys(this.assyProducts).length&&e===t.XCAD_PRODUCT_REPRESENTATION){i=new n(this,t.XCAD_PRODUCT_REPRESENTATION,"root");var r,o=this.getRootProducts();if(o.length>0)r=o[0];else for(var a in this.assyProducts)if(this.assyProducts[a].isRoot){r=a;break}var c=this.getProductReference(r);i.addRootProduct(c)}return i},getRootProducts:function(){return this.rootProducts},stepTokenizeArgs:function(e,t){if(void 0!==e){t.length=0;e.substr(e.indexOf("(")+1,e.lastIndexOf(")")).match(/(\'[a-zA-Z0-9\s.,+-_#()~:&\\\"]*\')*(\([()]*(\([^()]*\)[^()]*)*\))*(\([a-zA-Z0-9\s.,-_#]*\))*(\.[a-zA-Z0-9\s.,-_#]*\.)*(\#?\-?[0-9]+[.-E0-9]*)*(\$)*/g).filter(function(e){return""!=e}).forEach(e=>{if("string"==typeof e&&e.startsWith("'")&&e.endsWith("'")&&(e=e.slice(1,-1)),e.indexOf("\\X2\\")>=0){var s=e.substr(e.indexOf("\\X2\\")+4,e.indexOf("\\X0\\")).match(/.{1,4}/g);s.forEach((e,t,s)=>{s[t]="0x"+e});var n=String.fromCharCode.apply(String,s);e=e.substr(0,e.indexOf("\\X2\\"))+n+e.substr(e.indexOf("\\X0\\")+4,e.length-1)}t.push(e)})}},initialize:async function(e){if(""!==e){var t;if(null===e.match(/FILE_SCHEMA\s*\(\(\'AP242/))return console.error("Only STEP AP242 file are supported"),(t=new a).setError("XCADSTEPDocument/STEPInputDoc_errors",null,"E_UNSUPPORT","error"),t;if(null===e.match(/#\d+=TESSELLATED_SHAPE_REPRESENTATION/))return console.error("Only STEP file with tessellated data are supported"),(t=new a).setError("XCADSTEPDocument/STEPInputDoc_errors",null,"NO_TESSELLATION","error"),t;var s=(e=e.replace(/\r?\n/g,"")).split(";");e="";for(var n=this,i=[],r=[],d=[],E=[],l=[],h=[],_=[],T=[],p=[],f=/^(#[0-9]+)\=(.+)$/,g=/^\w+/,D=0;D<s.length;D++){var m=s[D].match(f);if(null!==m){var A=m[2].match(g);if(null===A&&"("===m[2][0]&&(A=["[COMPLEX_STEP_ENTITY]"]),null===A)console.error("STEPInputDocument::initialize entityType is null");else{var S=m[1].substr(1);switch(this.stepEntities[S]=m[2],A[0]){case"TESSELLATED_SHAPE_REPRESENTATION":this.tesselatedReps.push(m[1]);break;case"STYLED_ITEM":i.push(S);break;case"OVER_RIDING_STYLED_ITEM":r.push(S);break;case"CONTEXT_DEPENDENT_SHAPE_REPRESENTATION":d.push(S);break;case"SHAPE_REPRESENTATION_RELATIONSHIP":E.push(S);break;case"PROPERTY_DEFINITION_REPRESENTATION":l.push(S);break;case"SHAPE_DEFINITION_REPRESENTATION":h.push(S);break;case"APPLIED_EXTERNAL_IDENTIFICATION_ASSIGNMENT":_.push(S);break;case"COMPLEX_TRIANGULATED_FACE":this.nbCpxTriFace++;break;case"TESSELLATED_WIRE":this.nbWire++}}}}s.length=0;for(D=0;D<i.length;D++)P(i[D],!0);for(D=0;D<r.length;D++)P(r[D],!1);if(d.length>0){for(D=0;D<E.length;D++)R(E[D],!1);for(D=0;D<_.length;D++)O(_[D]);for(D=0;D<l.length;D++)R(l[D],!0);for(D=0;D<d.length;D++)C(d[D])}else n.nbInstPart++}function v(e){var t,s=n.stepEntities[e];void 0!==s&&(t="("===s[0]?-1!==s.indexOf("TESSELLATED_GEOMETRIC_SET")?"TESSELLATED_GEOMETRIC_SET":"[COMPLEX_STEP_ENTITY]":s.match(/^\w+/)[0]);return{first:t,second:s}}function P(e,t){let s=n.stepEntities[e].substring(12,n.stepEntities[e].lastIndexOf(")")).match(u);var i=window.localStorage.getItem("XCAD_DebugMode"),r=s[2].substr(1);let a=s[1].substr(1,s[1].length-2).match(u);for(var d=0;d<a.length;d++){var E=a[d];if("PRESENTATION_STYLE_ASSIGNMENT"===(P=v(E.substr(1))).first){let e=P.second.substr(P.second.indexOf("((")+1,P.second.indexOf("))")-2).match(c),s=e[0].substr(1,e[0].length-2).match(u);for(var l=0;l<s.length;l++){var h=v((E=s[l]).substr(1));if("SURFACE_STYLE_USAGE"===h.first){var _=v(E=h.second.substring(h.second.indexOf("#")+1,h.second.indexOf(")")));if("SURFACE_SIDE_STYLE"===_.first){let e=_.second.substring(_.second.indexOf("#"),_.second.indexOf("))")).match(u);for(var T=0;T<e.length;T++){var p=v((E=e[T]).substr(1));if("SURFACE_STYLE_FILL_AREA"===p.first){var f=v(E=p.second.substring(p.second.indexOf("#")+1,p.second.indexOf(")")));if("FILL_AREA_STYLE"===f.first){let e=f.second.substring(f.second.indexOf("#"),f.second.indexOf("))")).match(u);for(var g=0;g<e.length;g++){var D=v((E=e[g]).substr(1));if("FILL_AREA_STYLE_COLOUR"===D.first){var m=v(E=D.second.substring(D.second.indexOf("#")+1,D.second.indexOf(")")));if("COLOUR_RGB"===m.first){let e=m.second.substring(m.second.indexOf("(")+1,m.second.indexOf(")")).match(u);t?n.bodyColors[r]=[e[1],e[2],e[3]]:n.overridingFaceColors[r]=[e[1],e[2],e[3]]}else if("DRAUGHTING_PRE_DEFINED_COLOUR"===m.first){let e=m.second.substring(m.second.indexOf("('")+2,m.second.indexOf("')"));(I=new o.Color).setStyle(e),e.startsWith("gre")&&(I.g=1),t?n.bodyColors[r]=[I.r,I.g,I.b]:n.overridingFaceColors[r]=[I.r,I.g,I.b]}}}}}else if("SURFACE_STYLE_RENDERING_WITH_PROPERTIES"===p.first){let e=p.second.substring(p.second.indexOf("(#")+2,p.second.indexOf(")"));var A=v(e);if("SURFACE_STYLE_TRANSPARENT"===A.first){let t=A.second.substring(A.second.indexOf("(")+1,A.second.indexOf(")"));if(null!=n.bodyColors[r]){if(t<=1&&t>=0)n.bodyColors[r][3]=1-t;else if(i){console.log("Warning: transparency value must be between [0-1] ("+t+") for entity: "+e);var S=window.localStorage.getItem("_XCADParserWeb_Model");window.localStorage.setItem("_XCADParserWeb_bad_transparency_value_for_"+e+"_in_Model"+S,t)}}else if(null!=n.overridingFaceColors[r])if(t<=1&&t>=0)n.overridingFaceColors[r][3]=1-t;else if(i){console.log("Warning: transparency value must be between [0-1] ("+t+") for entity: "+e);S=window.localStorage.getItem("_XCADParserWeb_Model");window.localStorage.setItem("_XCADParserWeb_bad_transparency_value_for_"+e+"_in_Model"+S,t)}}}}}}else if("CURVE_STYLE"===h.first){var P,C=[];if(n.stepTokenizeArgs(h.second,C),"COLOUR_RGB"===(P=v(E=h.second.substring(h.second.indexOf("),#")+3,h.second.lastIndexOf(")")))).first){let e=P.second.substring(P.second.indexOf("(")+1,P.second.indexOf(")")).match(u);n.bodyColors[r]=[e[1],e[2],e[3]]}else if("DRAUGHTING_PRE_DEFINED_COLOUR"===P.first){let e=P.second.substring(P.second.indexOf("('")+2,P.second.indexOf("')"));var I;(I=new o.Color).setStyle(e),e.startsWith("gre")&&(I.g=1),n.bodyColors[r]=[I.r,I.g,I.b]}var O=C[2].match(/\((.*?)\)/);if(O&&(n.curveWidth[r]=parseFloat(O[1])),"DRAUGHTING_PRE_DEFINED_CURVE_FONT"===(P=v((E=C[1]).substr(1))).first){let e=P.second.substring(P.second.indexOf("('")+2,P.second.indexOf("')"));n.curveFont[r]=e}}}}}}function C(e){var t=[];n.stepTokenizeArgs(n.stepEntities[e],t);var s,i=t[0].substr(1),r=t[1].substr(1),a=[];n.stepTokenizeComplexEntity(n.stepEntities[i],a);var c=[];n.stepTokenizeArgs(a[0],c);var u=c[2],d=c[3],E=[];n.stepTokenizeArgs(a[1],E);var l=v(E[0].substr(1));if("ITEM_DEFINED_TRANSFORMATION"===l.first){var h=[];n.stepTokenizeArgs(l.second,h);var _=h[2];s=function(e,t){var s={},i=[],r=[],a=[],c=[],u=[],d=[];n.stepTokenizeArgs(n.stepEntities[e],i),i[1]=i[1].substr(1),i[2]=i[2].substr(1),i[3]=i[3].substr(1),n.stepTokenizeArgs(n.stepEntities[i[1]],r),n.stepTokenizeArgs(r[1],a),n.stepTokenizeArgs(n.stepEntities[i[2]],r),n.stepTokenizeArgs(r[1],c),n.stepTokenizeArgs(n.stepEntities[i[3]],r),n.stepTokenizeArgs(r[1],u),n.stepTokenizeArgs(n.stepEntities[t],i),i[1]=i[1].substr(1),i[2]=i[2].substr(1),i[3]=i[3].substr(1),n.stepTokenizeArgs(n.stepEntities[i[1]],r),n.stepTokenizeArgs(r[1],d),n.stepTokenizeArgs(n.stepEntities[i[2]],r),n.stepTokenizeArgs(r[1],[]),n.stepTokenizeArgs(n.stepEntities[i[3]],r),n.stepTokenizeArgs(r[1],[]),s.rotation=new o.Matrix3;var E=new o.Vector3(c[0],c[1],c[2]),l=new o.Vector3(u[0],u[1],u[2]),h=new o.Vector3;return h.crossVectors(E,l),s.rotation.set(u[0],u[1],u[2],h.x,h.y,h.z,c[0],c[1],c[2]),s.translation=new o.Vector3(a[0]-d[0],a[1]-d[1],a[2]-d[2]),s}(h[3].substr(1),_.substr(1))}var T=[];n.stepTokenizeArgs(n.stepEntities[r],T);var f=[];n.stepTokenizeArgs(n.stepEntities[T[2].substr(1)].replaceAll("*",""),f);var g=f[0],D=I(f[3]),m=D[0],A=D[1],S=(D=I(f[4]))[0],P=D[1];if(null!==m&&null!==S){if(m in n.assyProducts||(n.assyProducts[m]={referenceName:A,isRoot:!0,childrenList:[],geomRep:p[d]},n.rootProducts.push(m)),S in n.assyProducts){n.assyProducts[S].isRoot=!1;var C=n.rootProducts.indexOf(S);-1!=C&&n.rootProducts.splice(C,1)}else n.assyProducts[S]={referenceName:P,isRoot:!1,childrenList:[],geomRep:p[u]};n.assyProducts[m].childrenList.push({instanceName:g,productReferenceIdx:S,transfo:s}),void 0!==n.assyProducts[S].geomRep&&n.nbInstPart++}}function I(e){var t=null,s=null;if(null==e)return[t,s];var i=v(e.substr(1));if("PRODUCT_DEFINITION"===i.first){var r=[];if(n.stepTokenizeArgs(i.second,r),"PRODUCT_DEFINITION_FORMATION_WITH_SPECIFIED_SOURCE"===(i=v(r[r.length-2].substr(1))).first){var o=[];if(n.stepTokenizeArgs(i.second,o),"PRODUCT"===(i=v(o[2].substr(1))).first){var a=[];n.stepTokenizeArgs(i.second,a),t=o[2],s=a[0]}}}return[t,s]}function O(e){var t=[];n.stepTokenizeArgs(n.stepEntities[e],t);var s=[];n.stepTokenizeArgs(t[3],s),"DOCUMENT_FILE"===v(s[0].substr(1)).first&&(T[s[0]]=t[0])}function R(e,t){if(t){var s=[];n.stepTokenizeArgs(n.stepEntities[e],s);var i=v(s[0].substr(1)),r=v(s[1].substr(1));if("PROPERTY_DEFINITION"===i.first&&"SHAPE_REPRESENTATION"===r.first){var o=[];n.stepTokenizeArgs(i.second,o),p[s[1]]={type:"external",location:T[o[2]]}}}else{var a=[];n.stepTokenizeArgs(n.stepEntities[e],a),p[a[2]]={type:"internal",location:a[3]}}}}})});