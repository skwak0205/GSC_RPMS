define("DS/SMAApproximationExperience/SMAApExNLS",["i18n!DS/SMAApproximationExperience/assets/SMAApExNLSJson"],function(e){"use strict";var t=function(){};return t.prototype={translate:function(t){null!=t&&0!==t.length||(t="");var r=t,o=e[t];if((null==o||o.length<1)&&(t=(t=t.replace("...","ellipsis")).replace(new RegExp(" ","g"),"_"),(null==(o=e[t])||o.length<1)&&(window.missingNLS=window.missingNLS||{},window.missingNLS[r]=r,o=r)),o=this.removeExtraValPlaceHolders(o,arguments.length-1),arguments.length>1){for(var n={},a=1;a<arguments.length;a++)n["val"+a]=arguments[a];o=e.replace(o,n)}return o},removeExtraValPlaceHolders:function(e,t){var r=e.split("{").length-1;if(r===t)return e;for(var o=t+1,n=o;n===r;n++){var a="{val"+o+"}",i=e.indexOf(a);e=" "===e.charAt(i+a.length)?e.substring(0,i)+e.substring(i+a.length+1):" "===e.charAt(i-1)?e.substring(0,i-1)+e.substring(i+a.length):e.substring(0,i)+e.substring(i+a.length)}return e}}}),define("DS/SMAApproximationExperience/SMAApExSummaryView",["UWA/Core","UWA/Utils","UWA/Class","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/Utilities/Dom","DS/DataGridView/DataGridView","DS/VENMathjs/VENMathjs","DS/SMAApproximationExperience/SMAApExNLS"],function(e,t,r,o,n,a,i,s,l){return r.extend({_renderTable:function(e,t,r){var s=new o;s.prepareUpdate();for(var l=function(e,t){var r=new n({label:e.tree,grid:e});if(void 0!==e.children)for(var o=0;o<e.children.length;o++)l(e.children[o],r);t.addChild(r)},c=0,d=e.length;c<d;c++){var u=e[c];l(u,s)}s.expandAll(),s.pushUpdate();var p=new i({identifier:"myDataGridViewId",treeDocument:s,columns:t,rowSelection:"none",defaultColumnDef:{width:"auto",typeRepresentation:"string",sortableFlag:!1},showModelChangesFlag:!0,showRowIndexFlag:!1,getCellTooltip:function(e){if(0===e.columnID&&e.rowID>=0){var t=e.nodeModel._options.grid.altRowText;if(t)return{shortHelp:t}}return p.getCellDefaultTooltip(e)}}).inject(r);p.registerReusableCellContent({id:"mainTableColumn",buildContent:function(e){return a.generateIcon("check")}}),t.forEach(function(e){console.log(e),e.onCellRequest=function(t){var r=t.nodeModel._options.grid;if(!0===r.mappingRow&&r[e.dataIndex]&&!0===r[e.dataIndex]){var o=p.reuseCellContent("mainTableColumn");t.cellView._setReusableContent(o)}else p.defaultOnCellRequest(t)}}),s.setUseChangeTransactionMode(!0)},format:function(e){return""===e||void 0===e?"":s.format(parseFloat(e),{notation:"auto",precision:4})},renderSummaryView:function(e,t){var r=this,o=e.definition,n=o.querySelector("Outputs").querySelectorAll("Parameter"),a=o.querySelector("Inputs").querySelectorAll("Parameter"),i=o.querySelector("ApproximationModel").querySelectorAll("ApproximationMethod"),s={};n.forEach(function(e){var t=e.getAttribute("name");s[t]=e});var c={};i.forEach(function(e){var t=e.getAttribute("outputs");if(null!=t){var r=t.split(","),o=e.getAttribute("type")||e.getAttribute("name");r.forEach(function(e){c[e]=o})}});l.translate("Outputs"),l.translate("Inputs");var d=[{text:"",dataIndex:"tree",editableFlag:!1}],u=[{text:"",dataIndex:"tree",editableFlag:!1}],p={tree:l.translate("Lower Bound")},f={tree:l.translate("Upper Bound")},m={tree:l.translate("Lower Bound")},h={tree:l.translate("Upper Bound")},x={tree:"Approx. Method Type"},g={tree:l.translate("R-Squared"),altRowText:l.translate("Range: [0, 1]")},v={tree:l.translate("R-Squared Adjusted"),altRowText:l.translate("Range: [0, 1]")},w={tree:l.translate("RMSE")},A={tree:l.translate("Residual / Predicted")},S={tree:l.translate("% Error Absolute Mean")},b={tree:l.translate("% Error Absolute Maximum")},y={tree:l.translate("% Error Standard Deviation")},C={tree:l.translate("Training Measures"),children:[g,v,w,A,S,b,y]},E={tree:l.translate("R-Squared"),altRowText:l.translate("Range: [0, 1]")},M={tree:l.translate("R-Squared Adjusted"),altRowText:l.translate("Range: [0, 1]")},D={tree:l.translate("RMSE")},R={tree:l.translate("Residual / Predicted")},_={tree:l.translate("% Error Absolute Mean")},I={tree:l.translate("% Error Absolute Maximum")},F={tree:l.translate("% Error Standard Deviation")},P={tree:l.translate("Validation Measures"),children:[E,M,D,R,_,I,F]},T={tree:l.translate("Generated Outputs"),children:[]},U=[p,f,x,C,P],L=[m,h,T],q=[];n.forEach(function(t){var o=decodeURIComponent(t.getAttribute("displayName")),n=t.getAttribute("name"),a=t.getAttribute("id")||n,i=t.querySelector("Interval"),s={text:o,dataIndex:a,editableFlag:!1,sortableFlag:!1};i&&(p[a]=i.getAttribute("lb"),f[a]=i.getAttribute("ub"));var l=e.errorMeasures[a];void 0!==l?(w[a]=r.format(l.fit_RMSE),g[a]=r.format(l.fit_R2),v[a]=r.format(l.fit_R2Adjusted),void 0!==l.fit_ResidualMax&&void 0!==l.fit_ResidualMin&&void 0!==l.fit_PredictedMax&&void 0!==l.fit_PredictedMin?A[a]=r.format((l.fit_ResidualMax-l.fit_ResidualMin)/(l.fit_PredictedMax-l.fit_PredictedMin)):A[a]=r.format(""),void 0!==l.fit_PercentError?(S[a]=r.format(l.fit_PercentError.mean),b[a]=r.format(l.fit_PercentError.absoluteMax),y[a]=r.format(l.fit_PercentError.stdDev)):(S[a]=r.format(""),b[a]=r.format(""),y[a]=r.format("")),D[a]=r.format(l.cv_RMSE),E[a]=r.format(l.cv_R2),M[a]=r.format(l.cv_R2Adjusted),void 0!==l.cv_ResidualMax&&void 0!==l.cv_ResidualMin&&void 0!==l.cv_PredictedMax&&void 0!==l.cv_PredictedMin?R[a]=r.format((l.cv_ResidualMax-l.cv_ResidualMin)/(l.cv_PredictedMax-l.cv_PredictedMin)):R[a]=r.format(""),void 0!==l.cv_PercentError?(_[a]=r.format(l.cv_PercentError.mean),I[a]=r.format(l.cv_PercentError.absoluteMax),F[a]=r.format(l.cv_PercentError.stdDev)):(_[a]=r.format(""),I[a]=r.format(""),F[a]=r.format(""))):(w[a]=r.format(""),g[a]=r.format(""),v[a]=r.format(""),A[a]=r.format(""),S[a]=r.format(""),b[a]=r.format(""),y[a]=r.format(""),D[a]=r.format(""),E[a]=r.format(""),M[a]=r.format(""),R[a]=r.format(""),_[a]=r.format(""),I[a]=r.format(""),F[a]=r.format("")),x[a]=c[n],d.push(s);var u={tree:o,mappingRow:!0};q.push(u)}),T.children=q,a.forEach(function(e){var t=decodeURIComponent(e.getAttribute("displayName")),r=e.getAttribute("id")||e.getAttribute("name"),o=e.querySelector("Interval"),n={text:t,dataIndex:r,editableFlag:!1};o&&(m[r]=o.getAttribute("lb"),h[r]=o.getAttribute("ub")),u.push(n),q.forEach(function(e){e[r]=!0})});var O=document.createElement("div");O.textContent="Outputs",O.style.top="0%",O.style.height="30px",O.style.position="absolute",O.style.width="100%",O.style.background="#f1f1f1",O.style.border="1px solid #777",O.style.padding="5px",t.appendChild(O);var j=document.createElement("div");j.style.top="30px",j.style.height="calc(50% - 30px)",j.style.position="absolute",j.style.width="100%",t.appendChild(j),this._renderTable(U,d,j);var k=document.createElement("div");k.textContent="Inputs",k.style.top="50%",k.style.height="30px",k.style.position="absolute",k.style.width="100%",k.style.background="#f1f1f1",k.style.border="1px solid #777",k.style.padding="5px",t.appendChild(k);var V=document.createElement("div");V.style.top="calc(50% + 30px)",V.style.height="calc(50% - 30px)",V.style.position="absolute",V.style.width="100%",t.appendChild(V),this._renderTable(L,u,V)}}).prototype}),define("DS/SMAApproximationExperience/SMAApproximationExperience",["DS/3DPlayExperienceModule/3DPlayExperience","DS/ApplicationFrame/FrameWindow","DS/3DPlay/3DPlay","DS/WAFData/WAFData","UWA/Class/Promise","DS/SMAApproximationExperience/SMAApExSummaryView","DS/PlatformAPI/PlatformAPI"],function(e,t,r,o,n,a,i){"use strict";return e.extend({serverURL:"",SERVICE_LOC:"/resources/slmservices/",ADVISE_SERVICE_LOC:"/resources/slmservices/advise/",FCS_TICKET_LOC:"/resources/slmservices/fcs/ticket",FCS_CHECKOUT_LOC:"/servlet/fcs/checkout",FCS_COMMIT_LOC:"/resources/slmservices/fcs/commit",approxData:{},init:function(e){this._parent(e),e.FrameWindow=t,e.workbenchs=[],e.workbenchs.push({name:"ApproximationExperience",module:"ApproximationExperience"});var r=window.location;if(window.widget){var o=window.widget.getUrl();this.mcsUri=o.substring(0,o.indexOf("/webapps"))}else this.mcsUri=r.protocol+"//"+r.host+r.pathname.match(/^\/\w*/).join("")+"/"},onPreCreate:function(){this.onDocumentLoadingStarted=function(){this.onModelLoadingStarted()}.bind(this),this.onDocumentLoadingProgression=function(e){this.onModelLoadingProgression(e)}.bind(this),this.onDocumentLoadingCompleted=function(e){this.onModelLoadingCompleted()}.bind(this),this.onDocumentLoadingError=function(e){var t=this.ctx;NLS.nls("3DPlay/Core","DocumentLoadingFailed",function(o){r.displayFatalError({ctx:t,msg:o,error:"DocumentLoadingFailed"},e)}),console.log("Document loading failed"),this.onModelLoadingError()}.bind(this)},onPostCreate:function(){this._parent()},loadAsset:function(e){var t=this,r=window.location;if(window.widget){var o=window.widget.getUrl();if(this.mcsUri=o.substring(0,o.indexOf("/webapps")),(void 0===this.mcsUri||null===this.mcsUri||0===this.mcsUri.length)&&i){this.mcsUri=i.getApplicationConfiguration("app.urls.myapps"),console.info("SPACE URL FROM PlatformAPI: ",this.mcsUri)}}else this.mcsUri=r.protocol+"//"+r.host+r.pathname.match(/^\/\w*/).join("")+"/";this.contextId=e.asset.contextid,this.physicalId=e.asset.physicalid,this.onDocumentLoadingStarted(),this.onDocumentLoadingCompleted();var n=this.frmWindow.getViewerFrame();this.frmWindow.getActionBar().hide();var s=function(){a.renderSummaryView(t.approxData,n)},l=function(e){console.warn("Failed to load approx data.",e)};void 0===t.contextId||null===t.contextId||0===t.contextId.length?t.getCollabSpaceName().then(function(e){return t.contextId=e,t.loadApproxDataAsync(t.physicalId)}).then(s.bind(t)).catch(l):this.loadApproxDataAsync(this.physicalId).then(s,l)},getCollabSpaceName:function(){var e=this;return new n(function(t,r){var n=function(e){console.warn("SMAApproximationExperience - Failed to fetch the 3DSpace collaborative spaces.",e),r(e)};o.authenticatedRequest(e.mcsUri+"/resources/bps/cspaces",{type:"json",onComplete:function(e){console.info("3DSpace Collab Spaces",e);try{t(e.cspaces.filter(function(e){return e.isDefault})[0].name)}catch(e){n(e)}}.bind(this),onFailure:n.bind(e)})})},loadApproxDataAsync:function(e){var t=this,r=this.getApproximationInfo(e),o=new DOMParser,a=new n.deferred;this.xmlData={};var i=0,s=function(e){e.text().then(function(e){var r=o.parseFromString(e,"application/xml");t.approxData.definition=r,console.log(t.approxData.definition),2===(i+=1)&&a.resolve()},function(){console.log("Could not load definition text."),a.reject()})},l=function(e){e.text().then(function(e){var r=JSON.parse(e);t.approxData.errorMeasures=r,console.log(t.approxData.errorMeasures),2===(i+=1)&&a.resolve()},function(){console.log("Could not load error measures text."),a.reject()})};return r.then(function(e){console.log("approx promise resolved!"),console.log(e);var r=e.querySelector("Approximation").getAttribute("id"),o=t.getFileFromFcs("approx_definition.xml","xml",r),n=t.getFileFromFcs("approx_errormeasures.json","json",r);o.then(s,function(){console.log("Failed to load definition xml.")}),n.then(l,function(){console.log("Failed to load the error measures json :("),t.approxData.errorMeasures={},2===(i+=1)&&a.resolve()})},function(e){console.log("approx promise rejected :(")}),a.promise},getFileFromFcs:function(e,t,r){var o=this,a=new n.deferred,i=this.getFCSTicket({parentOid:r,fileName:e}),s=function(e){a.resolve(e)},l=function(e){console.log("Download rejected :("),a.reject("Download rejected :(")};return i.then(function(e){console.log("Got tickets: "),console.log(e);var t=e.querySelector("FCSTicket"),r={ticket:t.querySelector("Ticket").textContent,fileExtension:".xml",fcsUrl:t.querySelector("FcsUrl").textContent};o.downloadFile(r,!0).then(s,l)},function(e){console.log("Ticket request rejected :("),a.reject("Ticket request rejected :(")}),a.promise},getApproximationInfo:function(e){var t={resource:"advise",subresource:"approximationInfo"};return t.params={approxId:e},t.contentType="xml",this.sendGetRequest(t)},downloadFile:function(e,t){var r=n.deferred();if(void 0===e.ticket||void 0===e.fileExtension)r.reject("Invalid / empty ticket for file download");else{var o=e.fcsUrl,a=new XMLHttpRequest,i="__fcs__jobTicket="+encodeURIComponent(e.ticket)+"&__fcs__attachment=false";a.onload=function(o){if(4===a.readyState)if(200===a.status){var n=new Blob([this.response],{type:"application/"+e.fileExtension}),i=window.URL||window.webkitURL;!0===t?r.resolve(n):r.resolve(i.createObjectURL(n))}else r.reject()},a.open("POST",o,!0),a.setRequestHeader("Cache-Control","no-cache"),a.setRequestHeader("Content-type","application/x-www-form-urlencoded; charset:UTF-8"),a.responseType="arraybuffer",a.send(i)}return r.promise},sendGetRequest:function(e){var t,r=e.resource||"advise";e.subresource;t=e.url?e.url:this.mcsUri+this.SERVICE_LOC+r+"/"+e.subresource;var a=e.params;void 0!==this.contextId&&null!==this.contextId&&this.contextId.length>0&&(a.SecurityContext=encodeURIComponent(this.contextId));var i,s=e.headers||{},l=e.data||{},c=e.contentType||"xml",d=e.cache||-1;e.authenticatedRequest;for(var u in void 0!==e.timeout&&(i=e.timeout),s.hasOwnProperty("Accept")||(s.Accept="*/*, application/json"),a)a.hasOwnProperty(u)&&(l[u]=a[u]);var p=o.authenticatedRequest;return new n(function(e,r){var o={type:c,method:"GET",allowCrossOriginRequest:!0,cache:d,onComplete:e,onFailure:r,requiredAuth:"passport",tenant:"OnPremise"};s&&(o.headers=s),l&&(o.data=l),i&&(o.timeout=i),p(t,o)})},getApproximationInfo:function(e){var t={resource:"advise",subresource:"approximationInfo"};return t.params={approxId:e},t.contentType="xml",this.sendGetRequest(t)},getFCSTicket:function(e){var t=e.action||"download",r=e.fileName,o={params:{oid:e.parentOid,fname:r,action:t},type:"text",url:this.mcsUri+this.FCS_TICKET_LOC};return this.sendGetRequest(o)}})});