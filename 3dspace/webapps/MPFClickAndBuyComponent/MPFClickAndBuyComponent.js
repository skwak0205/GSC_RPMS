define("DS/MPFClickAndBuyComponent/orderList/OrderListHeader",["UWA/Class/View","UWA/Core","i18n!DS/MPFClickAndBuyComponent/assets/nls/MPFClickAndBuyComponent","css!DS/MPFClickAndBuyComponent/MPFClickAndBuyComponent"],(e,t,i)=>{"use strict";return e.extend({className:"mpf-order-list-header",render(){return this.container.setContent([this._getProductTitle(),this._getPricingStructureTitle(),this._getQuantityTitle(),this._getUnitPriceTitle(),this._getTotalPriceTitle(),this._getRemoveTitle()]),this},_getRemoveTitle:()=>t.createElement("div",{class:"mpf-remove"}),_getProductTitle:()=>t.createElement("div",{class:"mpf-product",text:i.get("products")}),_getPricingStructureTitle:()=>t.createElement("div",{class:"mpf-pricing-structure",text:i.get("pricingStructure")}),_getUnitPriceTitle:()=>t.createElement("div",{class:"mpf-unit-price",text:i.get("unitPriceTaxExcl")}),_getQuantityTitle:()=>t.createElement("div",{class:"mpf-quantity",text:i.get("quantity")}),_getTotalPriceTitle:()=>t.createElement("div",{class:"mpf-total-price",text:i.get("priceTaxExcl")}),destroy(){this.stopListening(),this._parent(),this.container=null}})}),define("DS/MPFClickAndBuyComponent/ClicknbuyHeader",["UWA/Class/View","UWA/Core","DS/WebappsUtils/WebappsUtils","DS/MPFServices/ObjectService","DS/MPFPortfolioModel/PortfolioPackModel","i18n!DS/MPFClickAndBuyComponent/assets/nls/MPFClickAndBuyComponent","css!DS/MPFClickAndBuyComponent/MPFClickAndBuyComponent"],(e,t,i,n,s,r)=>{"use strict";const o=Object.freeze({ENOVIA:"#E87722",SOLIDWORKS:"#DA291C",CATIA:"#001871",DELMIA:"#FFCD00",BIOVIA:"#C8D300","3DEXCITE":"#E87722",PLATFORM:"#005685"});return e.extend({className:"mpf-clicknbuy-header",setup(e={}){this.displayCartOnly=!0===e.displayCartOnly,this._checkPrototypes(e),this._parent(e),this.portfolioPack=e.portfolioPack,this.roleInfo=e.roleInfo||{},this.title=this._createTitle(),this.icon=this._createIconRole()},render(){const e=this.displayCartOnly||this.portfolioPack.isBundle()?o.PLATFORM:this._getBorderColor();return this.container.setStyle("border-bottom","2px solid "+e),this.container.setContent([this.title,this.icon]),this},update(e,i){this.title.setContent(t.createElement("span",{text:e})),t.is(this.icon)&&(!0===i?this.icon.setStyle("display","block"):this.icon.setStyle("display","none"))},_createIconRole(e){if(!this.displayCartOnly&&!this.portfolioPack.isBundle()){const e=this.roleInfo.brand.toUpperCase(),n=t.createElement("img",{src:i.getWebappsAssetUrl("i3DXCompass","v3.1/images/role")+"/"+e+"_Role.png"});return t.createElement("div",{class:"mpf-icon-role",html:n})}},_getBorderColor(){const e=this.roleInfo.brand.toUpperCase();return o[e]},_createTitle(){return t.createElement("div",{class:"mpf-header-title",html:t.createElement("span",{text:this.displayCartOnly?r.get("myCart"):this.portfolioPack.getDisplayName()})})},_checkPrototypes(e){this.displayCartOnly||n.requiredOfPrototype(e.portfolioPack,s,"options.portfolioPack must be a PortfolioPackModel")},destroy(){this.stopListening(),this.portfolioPack=null,this.roleInfo=null,this.title=null,this._parent(),this.container=null}})}),define("DS/MPFClickAndBuyComponent/checkout/CompanyListPage",["UWA/Class/View","UWA/Core","UWA/Promise","DS/UIKIT/Scroller","DS/MPFTracker/Tracker","DS/MPFTracker/Dimension","DS/MPFTracker/Category","DS/MPFServices/ObjectService","DS/MPFServices/MarketplaceServices","DS/MPFCompanyModel/CompanyFactory","DS/MPFAddressModel/AddressFactory","DS/MPFCompanyModel/CompanyModel","DS/MPFCompanyModel/CompanyCollection","DS/MPFCountryModel/CountryCollection","DS/MPFAddressModel/AddressModel","DS/MPFCartModel/CartModel","DS/MPFCartModel/CartModelHelper","DS/MPFPspModel/PspModel","i18n!DS/MPFClickAndBuyComponent/assets/nls/MPFClickAndBuyComponent","i18n!DS/MPFAddressFormComponent/assets/nls/AddressFormComponent","css!DS/MPFClickAndBuyComponent/MPFClickAndBuyComponent"],(e,t,i,n,s,r,o,a,c,l,d,h,u,p,m,C,f,y,g,P)=>{"use strict";const I=Object.freeze({VALID:"valid",INVALID:"invalid"}),_=Object.freeze({CONTINUE_WITH_COMPANY:"ContinueWithCompany"}),S=e.extend({className:"mpf-company-list-page mpf-click-and-buy",setup(e={}){this._checkPrototypes(e),this.service=e.service||c.CLICK_AND_BUY,this.company=e.company,this.address=e.address,this.cart=e.cart,this.cartPsp=e.cartPsp,this.matchingCompanies=e.matchingCompanies,this.companyFactory=e.companyFactory,this.addressFactory=e.addressFactory,this.countries=e.countries,this.selectCompanyMessage=this._createSelectCompanyMessage(),this.companyCards=this._createMatchedCompanyCards(),this.newCompanyCard=this._createCompanyCard(this.company,this.address),this.selectedCompany=""},render(){const e=t.createElement("div",{class:"mpf-company-list",html:[this.selectCompanyMessage,this.companyCards]}),i=t.createElement("div",{class:"mpf-company-scroll",html:e}),s=t.createElement("div",{class:"mpf-new-company",html:[t.createElement("p",{text:g.get("continueWithInfoProvided")}),this.newCompanyCard]});return this.container.setContent([i,s]),new n({element:e}).inject(i),this._sendTrackingPage(),this},save(){let e;"new"===this.selectedCompany?((e=this.company).unset(h.Fields.MATCHING_COMPANIES),e.unset("address"),e.set(h.Fields.BILL_TO_ADDRESS,this.address.omit())):e=this.matchingCompanies.find(e=>e.get("DBId")===this.selectedCompany);const n=t.is(this.company.getTaxRegistrationId())&&""!==this.company.getTaxRegistrationId();return e.set(h.Fields.NO_VAT_ID,n?"FALSE":"TRUE"),this._sendTrackingEvent(_.CONTINUE_WITH_COMPANY,this.selectedCompany),e.dataProxy=this.companyFactory.getDataProxy(l.Types.ME),e.savePromise().then(this._patchCartInSubmittedState.bind(this,e)).then(this.cartPsp.fetchPromise.bind(this.cartPsp)).then(this._keepModels.bind(this,e)).catch(e=>{let t;return e.options&&e.options.request&&(t=-1!==e.options.request.xhr.response.indexOf("Error.MismatchAttribute")?"MismatchAttribute":-1!==e.options.request.xhr.response.indexOf("Error.NonRomanForbidden")?"NonRomanForbidden":""),i.reject(t)})},_keepModels(e){const t=this.addressFactory.createModel(d.Types.COMPANY,e.getBillToAddress(),{parse:!0});return this.savedModels={company:e,address:t},i.resolve()},_patchCartInSubmittedState(e){const t={};return t[C.Fields.BILL_TO]=e.getBillToAddress().id,t[C.Fields.STATE]=C.States.SUBMITTED,this.cart.savePromise(t,{patch:!0}).then(()=>{const t=e.getCountry(),n=this.countries.find(e=>e.getIso3()===t).getIso2();return window.localStorage.setItem(C.LOCAL_STORAGE_KEY_COUNTRY,n),i.resolve()})},_onCompanySelected(e){this.selectedCompany=e,this.companyCards.forEach(t=>{t.getData("company-id")===e?t.addClassName("selected"):t.removeClassName("selected")}),this.newCompanyCard.getData("company-id")===e?this.newCompanyCard.addClassName("selected"):this.newCompanyCard.removeClassName("selected");const t=""!==e;this.dispatchEvent(t?I.VALID:I.INVALID)},_createMatchedCompanyCards(){return this.matchingCompanies.map(e=>this._createCompanyCard(e,e.getBillToAddress()))},_createCompanyCard(e,i){const n=t.is(e.get("DBId"))?e.get("DBId"):"new",s=t.createElement("div",{class:"mpf-company-left",html:this._getAddress(i)}),r=t.is(e.getTaxRegistrationId())?e.getTaxRegistrationId():"",o=t.createElement("div",{class:"mpf-company-right",html:t.createElement("div",{text:g.get("taxRegistrationId")+": "+r})}),a=t.createElement("div",{class:"mpf-company-card",events:{click:this._onCompanySelected.bind(this,n)},html:[t.createElement("div",{class:"mpf-company-title",text:e.getName()}),t.createElement("div",{class:"mpf-company-content",html:[s,o]})]});return a.setData("company-id",n),a},_getAddress:e=>[m.Fields.LINE1,m.Fields.LINE2,m.Fields.LINE3,m.Fields.LINE4,m.Fields.CITY,m.Fields.COUNTY,m.Fields.STATE,m.Fields.POSTAL_CODE,m.Fields.COUNTRY].map(i=>{if(i===m.Fields.STATE){const n=P[e.getCountry()+e.getState()];return t.is(n)?n:e.get(i)}return e.get(i)}).filter(e=>e&&e.length>0).map(e=>t.createElement("div",{class:"mpf-address-line",text:e})),_createSelectCompanyMessage:()=>t.createElement("p",{text:g.get("selectMatchingCompany")}),_checkPrototypes(e){a.requiredOfPrototype(e.company,h,"options.company must be a CompanyModel"),a.requiredOfPrototype(e.address,m,"options.address must be an AddressModel"),a.requiredOfPrototype(e.cart,C,"options.cart must be a CartModel"),a.requiredOfPrototype(e.cartPsp,y,"options.cartPsp must be a PspModel"),a.requiredOfPrototype(e.matchingCompanies,u,"options.matchingCompanies must be a CompanyCollection"),a.requiredOfPrototype(e.companyFactory,l,"options.companyFactory must be a CompanyFactory"),a.requiredOfPrototype(e.addressFactory,d,"options.addressFactory must be an AddressFactory"),a.requiredOfPrototype(e.countries,p,"options.countries must be a CountryCollection")},_sendTrackingPage(){const e=s.createPageBuilder({url:"/checkout/AddressCreation/CompanyMatching"}).setTitle("Company Matching");f.addTrackerInformation(e,this.cart),e.addDimension(r.MARKETPLACE_SERVICE,this.service).addDimension(r.BUYER_TYPE,"company").send()},_sendTrackingEvent(e,t){const i=s.createEventBuilder({category:o.CHECKOUT,action:e}).setLabel(t);f.addTrackerInformation(i,this.cart),i.addDimension(r.MARKETPLACE_SERVICE,this.service).addDimension(r.BUYER_TYPE,"company").send()},destroy(){this.cart=null,this.matchingCompanies=null,this.company=null,this.address=null,this.addressFactory=null,this.companyFactory=null,this.countries=null,this._parent(),this.container=null}});return S.Events=I,S}),define("DS/MPFClickAndBuyComponent/MarketingPortfolioPage",["UWA/Class/View","UWA/Core","DS/UIKIT/Carousel","DS/UIKIT/Scroller","css!DS/MPFClickAndBuyComponent/MPFClickAndBuyComponent"],(e,t,i,n)=>{"use strict";return e.extend({className:"mpf-marketing-portfolio",setup(e={}){this._parent(e),this.portfolioInfo=e.portfolioInfo},render(){const e=this._getVideoContainer(),i=t.is(e)?[this._getTagLineContainer(),this._getVideoContainer(),this._getDescription(),this._getCarousel()]:[this._getTagLineContainer(),this._getCarousel(),this._getDescription()],s=t.createElement("div",{class:"mpf-scroll",html:t.createElement("div",{class:"mpf-marketing-content",html:i})});return this.container.setContent(s),new n({element:s}).inject(this.container),this},_getDescription(){return t.createElement("div",{class:"mpf-description",html:this.portfolioInfo.description})},_getCarousel(){const e=this.portfolioInfo.descriptionMedias.filter(e=>"png"===e.split(".").pop()).map(e=>t.createElement("img",{src:e,width:"350px",height:"200px"}));return t.createElement("div",{class:"mpf-carousel",html:new i({slides:e,slideSelector:"> img",infinite:!1,autoPlay:!1})})},_getTagLineContainer(){return t.createElement("div",{class:"mpf-tagline",html:this.portfolioInfo.tagLine})},_getVideoContainer(){const e=this.portfolioInfo.descriptionMedias,i=e=>"mp4"===e.split(".").pop();if(e.some(i)){const n=e.find(i),s=t.createElement("video",{controls:!0,width:"350",html:t.createElement("source",{src:n,type:"video/mp4"})});return t.createElement("div",{class:"mpf-video",html:s})}},destroy(){this.stopListening(),this.portfolioInfo=null,this._parent(),this.container=null}})}),define("DS/MPFClickAndBuyComponent/MaintenancePage",["UWA/Class/View","UWA/Core","DS/WebappsUtils/WebappsUtils","DS/MPFTracker/Tracker","DS/MPFTracker/Dimension","DS/MPFServices/MarketplaceServices","i18n!DS/MPFClickAndBuyComponent/assets/nls/MPFClickAndBuyComponent","css!DS/MPFClickAndBuyComponent/MPFClickAndBuyComponent"],(e,t,i,n,s,r,o)=>{"use strict";return e.extend({className:"mpf-clicknbuy-maintenance",setup(e={}){this.imgContainer=this._createImgContainer(),this.header=this._createHeader(),this.disclaimer=this._createDisclaimer(),this.tryAgain=this._createTryAgain()},render(){return this.container.setContent([this.imgContainer,this.header,this.disclaimer,this.tryAgain]),this._sendTrackerPage(),this},_sendTrackerPage(){n.createPageBuilder({url:window.location.pathname}).setTitle("MaintenancePage").addDimension(s.MARKETPLACE_SERVICE,r.CLICK_AND_BUY).send()},_createTryAgain:()=>t.createElement("div",{class:"mpf-maintenance-tryagain",text:o.get("tryAgainLater")}),_createDisclaimer:()=>t.createElement("div",{class:"mpf-maintenance-disclaimer",text:o.get("engineersPerformingMaintenance")}),_createHeader:()=>t.createElement("div",{class:"mpf-maintenance-header",text:o.get("storeUpdate").toUpperCase()}),_createImgContainer(){const e=i.getWebappsAssetUrl("MPFClickAndBuyComponent","graphics/pictures")+"/store_down.jpg";return t.createElement("img",{src:e})}})}),define("DS/MPFClickAndBuyComponent/MyCartComponent",["UWA/Class/View"],function(e){"use strict";return e.extend({setup:function(e){this.cart=e.cart},render:function(){return this},destroy:function(){this._parent()}})}),define("DS/MPFClickAndBuyComponent/PreReqMoreInfoSection",["UWA/Class/View","UWA/Core","DS/MPFCompassPlatformServices/CompassPlatformServices","i18n!DS/MPFClickAndBuyComponent/assets/nls/MPFClickAndBuyComponent","css!DS/MPFClickAndBuyComponent/MPFClickAndBuyComponent"],(e,t,i,n)=>{"use strict";return e.extend({className:"mpf-more-info-section",setup(e={}){this._parent(e),this.preReqs=e.preReqs,this.expandIcon=this._createExpandIcon(),this.title=this._createTitleContainer(),this.body=this._createBodyContainer(),this._getPreReqDescriptions()},render(){return this.container.setContent([this.title,this.body]),this},_extendMoreInformationSection(){this.body.isHidden()?(this.expandIcon.removeClassName("fonticon fonticon-expand-right"),this.expandIcon.addClassName("fonticon fonticon-expand-down"),this.body.show()):(this.expandIcon.removeClassName("fonticon fonticon-expand-down"),this.expandIcon.addClassName("fonticon fonticon-expand-right"),this.body.hide())},_createBodyContainer(){const e=t.createElement("div",{class:"mpf-more-info-section-content"});return e.hide(),e},_createTitleContainer(){return t.createElement("div",{class:"mpf-more-info-section-title",html:[this.expandIcon,n.get("moreInformation")],events:{click:this._extendMoreInformationSection.bind(this)}})},_createExpandIcon:()=>t.createElement("span",{class:"fonticon fonticon-expand-right"}),_getPreReqDescriptions(){this.preReqs.forEach(e=>{try{i.getPortolioRole(e.productTrigram.split("-")[0],this._addDescriptionInBody.bind(this,e))}catch(e){console.warn(e)}})},_addDescriptionInBody(e,i){const n=t.createElement("div",{class:"mpf-role-description",html:[t.createElement("h4",{text:e.productDisplayName}),i.description]});this.body.addContent(n)}})}),define("DS/MPFClickAndBuyComponent/TenantSelectionModal",["UWA/Class/View","UWA/Core","DS/UIKIT/Modal","DS/UIKIT/Alert","DS/UIKIT/Input/Button","DS/UIKIT/Input/Select","DS/MPFTracker/Tracker","DS/MPFTracker/Dimension","DS/MPFServices/MarketplaceServices","DS/MPFServices/ObjectService","DS/MPFFiniteStateMachine/FiniteStateMachine","DS/MPFCartModel/CartModel","DS/MPFCartModel/CartModelHelper","i18n!DS/MPFClickAndBuyComponent/assets/nls/MPFClickAndBuyComponent","css!DS/MPFClickAndBuyComponent/MPFClickAndBuyComponent"],(e,t,i,n,s,r,o,a,c,l,d,h,u,p)=>{"use strict";const m=Object.freeze({ON_HIDE:"onHide",CONTINUE:"continue"}),C=Object.freeze({ADMIN:"admin",MEMBER:"member",ADMIN_AND_MEMBER:"adminAndMember"}),f=Object.freeze({TENANT_SELECTED:"TenantSelected",CANCEL_TENANT_SELECTION:"CancelTenantSelection"}),y=e.extend({className:"mpf-tenant-modal",setup(e={}){this._parent(e),this.platforms=e.platforms,this.cart=e.cart,this.stateMachine=this._createStateMachine(),this.modal=this._createModal()},render(){return this.modal.inject(this.container),this},show(){this.modal.show(),this._sendTrackingPage()},_createModal(){return new i({header:this._createModalHeader(),body:this._createModalBody(),footer:this._createModalFooter(),events:{onHide:()=>{this._sendTrackingEvent(f.CANCEL_TENANT_SELECTION),this.dispatchEvent(m.ON_HIDE)}}})},_createModalHeader(){let e;const i=this.stateMachine.getState();return i===C.ADMIN||i===C.ADMIN_AND_MEMBER?e=p.get("orderDeploymentOptions"):i===C.MEMBER&&(e=p.get("orderDeployment")),t.createElement("h4",{text:e})},_createModalBody(){let e;const t=this.stateMachine.getState();return t===C.ADMIN?e=this._getAdminContent():t===C.MEMBER?e=this._getMemberContent():t===C.ADMIN_AND_MEMBER&&(e=this._getAdminAndMemberContent()),e},_getAdminAndMemberContent(){const e=t.createElement("ul",{html:this.platforms.filter(e=>e.isMember()).map(e=>t.createElement("li",{text:e.id}))});return this.platformSelection=this._createPlatformSelection(),[t.createElement("p",{text:p.get("adminMsgPlatform")}),this.platformSelection,t.createElement("p",{text:p.get("youAreAlsoMemberOfThesePlatforms")+":"}),e,t.createElement("p",{text:p.get("memberMsgPlatform")})]},_getMemberContent(){const e=t.createElement("ul",{html:this.platforms.filter(e=>e.isMember()).map(e=>t.createElement("li",{text:e.id}))});return[t.createElement("p",{text:p.get("deployOnNewPlatform")}),t.createElement("p",{text:p.get("youAreMemberOfThesePlatforms")+":"}),e,t.createElement("p",{text:p.get("deployOnExistingPlatform")})]},_getAdminContent(){return this.platformSelection=this._createPlatformSelection(),[t.createElement("p",{text:p.get("selectPlatform")}),this.platformSelection]},_createPlatformSelection(){const e=this.platforms.filter(e=>e.isAdmin()).map(e=>({value:e.id,label:p.get("deployOnThisPlatformOption",{platform:e.id})}));return e.push({value:"new",label:p.get("deployOnNewPlatformOption")}),new r({placeholder:p.get("selectPlatformLabel"),options:e})},_createModalFooter(){return new s({className:"primary",value:p.get("continue"),events:{onClick:this._onContinue.bind(this)}})},_onContinue(){const e=t.is(this.platformSelection)?this.platformSelection.getValue()[0]:"new",i=this._validatePreReq(e);i.isValid?(this._sendTrackingEvent(f.TENANT_SELECTED,e),this.dispatchEvent(m.CONTINUE,{selectedPlatform:e}),this.modal.hide()):new n({className:"error",messageClassName:"error",messages:i.errorMsg,closable:!0,visible:!0,autoHide:!1}).inject(this.modal.getBody(),"top")},_validatePreReq(e){const i={};if("new"===e){const e=this.cart.getItems().find(e=>"IFW-OC"===e.getProductTrigram()),n=t.is(e);i.isValid=n,i.errorMsg=p.get("businessInnovatorMissing")}else i.isValid=""!==e,i.errorMsg=p.get("selectPlatformError");return i},_createStateMachine(){return new d({state:this._getInitialState(),states:[C.ADMIN,C.MEMBER,C.ADMIN_AND_MEMBER],transitions:[]})},_getInitialState(){const e=this.platforms.some(e=>e.isMember()),t=this.platforms.some(e=>e.isAdmin());return e&&t?C.ADMIN_AND_MEMBER:e?C.MEMBER:t?C.ADMIN:void 0},_checkPrototypes(e){l.requiredOfPrototype(e.cart,h,"options.cart must be a CartModel")},destroy(){this.modal.destroy(),this._parent(),this.container=null},_sendTrackingPage(){const e=o.createPageBuilder({url:"/cart/tenantconfiguration"}).setTitle("Tenant Configuration");u.addTrackerInformation(e,this.cart),this._addTrackerDimensions(e),e.send()},_sendTrackingEvent(e,t){const i=o.createEventBuilder({category:"Cart",action:e}).setLabel(t);u.addTrackerInformation(i,this.cart),this._addTrackerDimensions(i),i.send()},_addTrackerDimensions(e){const t=this.platforms.map(e=>e.getShortDescription()).join(",");e.addDimension(a.MARKETPLACE_SERVICE,c.CLICK_AND_BUY).addDimension(a.BUYER_TYPE,"company").addDimension(a.PLATFORMS,t)}});return y.Events=m,y}),define("DS/MPFClickAndBuyComponent/checkout/LegalAgreementsSection",["UWA/Core","UWA/Class/View","UWA/Promise","DS/MPFServices/ObjectService","DS/UIKIT/Input/Toggle","DS/UIKIT/Alert","DS/MPFTCContractModel/TCContractFactory","DS/MPFTcDocumentModel/TCDocumentFactory","DS/MPFCartModel/CartModel","DS/MPFTCContractModel/TCContractModel","DS/MPFTCContractModel/SoftwareAgreementModel","DS/MPFCompanyModel/CompanyModel","DS/MPFPersonModel/PersonModel","DS/MPFBuyer/BuyerType","i18n!DS/MPFClickAndBuyComponent/assets/nls/MPFClickAndBuyComponent"],function(e,t,i,n,s,r,o,a,c,l,d,h,u,p,m){"use strict";var C,f={};return f.ON_RENDER="onRender",f.VALID_SECTION="validSection",f.INVALID_SECTION="invalidSection",(C=t.extend({className:"mpf-legal-section",setup:function(e){e||(e={}),this._parent(e),this._checkPrototypes(e),this.cart=e.cart,this.buyer=e.buyer,this.tcContractFactory=e.tcContractFactory,this.tcDocumentFactory=e.tcDocumentFactory,this.softwareAgreement=e.softwareAgreement,this.tcContracts=this.tcContractFactory.createCollection(o.Types.TERMS_AND_CONDITIONS),this.tcDocument=this.tcDocumentFactory.createModel(a.Types.CLICKNBUY_TC),this.checkbox=this._createToggle()},render:function(){var e=this;return this._getDocuments().then(function(){e.container.setContent([e.checkbox,e._getLabel()]),e.dispatchEvent(f.ON_RENDER)}).catch(this._displayAlert.bind(this)),this},save:function(){return i.all([this._saveClosaContract(),this._saveTermsOfUseContract()])},isChecked:function(){return this.checkbox.isChecked()},_saveTermsOfUseContract:function(){var e,t={};return e=this._findContract(),t[l.FIELDS.CURRENT_STATE]=l.STATUS.inEffect,e.getCurrentState()===l.STATUS.draft?e.savePromise(t,{patch:!0}):i.resolve()},_saveClosaContract:function(){return this.tcContractFactory.createModel(o.Types.EXISTING_DOCUMENT,{documentID:this.softwareAgreement.get("id"),currentState:l.STATUS.inEffect,consumerID:this.buyer.get("id"),cartItemID:this.cart.getItems()[0].get("id")}).savePromise()},_getDocuments:function(){return i.all([this._fetchTermsAndConditions(),this._fetchClosa()])},_fetchTermsAndConditions:function(){return i.all([this.tcDocument.fetchPromise(),this.tcContracts.fetchPromise({type:[l.TcTypes.CLICKNBUY_TC]})])},_fetchClosa:function(){return this.softwareAgreement.fetchPromise({cartId:this.cart.get("id")})},_getLabel:function(){const e=[{tag:"li",text:m.get("allBillingInformationIsCorrect")},{tag:"li",text:h.prototype.isPrototypeOf(this.buyer)?m.get("authorizedToRepresentCompany"):m.get("consentAccess")},{tag:"li",html:m.get("agreeTermsAndConditions",{termsAndConditions:this._getTermsAndConditionsLink().outerHTML})},{tag:"li",html:m.get("agreeClosa",{closa:this._getClosaLink().outerHTML})}];return this.cart.hasMakerItems()&&e.splice(1,0,{tag:"li",text:m.get("iAmAMakerOrHobbyist")}),{tag:"div",class:"mpf-switch-label",html:[m.get("acknowledgeThat"),{tag:"ul",html:e}]}},_getClosaLink:function(){return e.createElement("a",{target:"_blank",href:this.softwareAgreement.getUrl(),text:m.get("closaLabel")})},_getTermsAndConditionsLink:function(){return e.createElement("a",{target:"_blank",href:this.tcDocument.getDocUrl(),text:m.get("termsAndConditionsLabel")})},_findContract:function(){var e,t=this;return(e=this.tcContracts.filter(function(e){return e.getConsumerID()===t.buyer.get("id")&&e.getDocumentType()===l.DOCUMENT_TYPES.CLICKNBUY_TC&&e.getCurrentState()!==l.STATUS.archived&&e.getSigningRevision()===e.getActiveRevision()}).shift()).dataProxy=t.tcContractFactory.getDataProxy(o.Types.CONTRACTS),e},_displayAlert:function(){new r({className:"error",icon:!0,closable:!0,visible:!0,messages:{className:"error",message:m.get("errorLoadingDocuments")}}).inject(document.body.getElementsByClassName("mpf-order-confirmation-page")[0],"top")},_createToggle:function(){var e=this;return new s({type:"switch",className:"primary",value:"",events:{onChange:function(){this.isChecked()?e.dispatchEvent(f.VALID_SECTION):e.dispatchEvent(f.INVALID_SECTION)}}})},_checkPrototypes:function(e){n.requiredAsOneOf(e.buyer,[h,u],"options.buyer must either be a CompanyModel or a PersonModel"),n.requiredOfPrototype(e.cart,c,"options.cart must be a CartModel"),n.requiredOfPrototype(e.tcContractFactory,o,"options.tcContractFactory must be a TcContractFactory"),n.requiredOfPrototype(e.tcDocumentFactory,a,"options.tcDocumentFactory must be a TcDocumentFactory"),n.requiredOfPrototype(e.softwareAgreement,d,"options.softwareAgreement must be a SoftwareAgreementModel")}})).Events=Object.freeze(f),C}),define("DS/MPFClickAndBuyComponent/offerList/OfferTile",["UWA/Class/View","UWA/Core","DS/UIKIT/Input/Button","DS/UIKIT/Input/Number","DS/UIKIT/Popover","DS/MPFServices/ObjectService","DS/MPFPortfolioModel/PortfolioModel","DS/MPFPortfolioModel/PortfolioHelper","DS/MPFTracker/Tracker","DS/MPFTracker/Dimension","DS/MPFTracker/Value","DS/MPFTracker/Category","DS/MPFServices/MarketplaceServices","i18n!DS/MPFClickAndBuyComponent/assets/nls/MPFClickAndBuyComponent","css!DS/MPFClickAndBuyComponent/MPFClickAndBuyComponent"],(e,t,i,n,s,r,o,a,c,l,d,h,u,p)=>{"use strict";const m=Object.freeze({SELECTED:"selected",ADD_TO_CART:"addToCart"}),C=e.extend({className:"mpf-offer-tile",domEvents:{click:"_onSelectOffer"},setup(e={}){this._checkPrototypes(e),this.portfolio=e.portfolio,this.locale=e.locale||"en-US",this.selected=!0===e.selected,this.disabled=!0===e.disabled,this.isStudentPortfolio=this._isEduPortfolio(),this.isMakerPortfolio=this._isMakerPortfolio(),this.periodicityContainer=this._createPeriodicityContainer(),this.priceContainer=this._createPriceContainer(),this.addToCartButton=this._createAddToCartButton(),this.quantityInput=this._createQuantityInput(),this.quantityContainer=this._createQuantityContainer(),this.totalPriceContainer=this._createTotalPriceContainer(),this.secureTransactionContainer=this._createSecureTransactionContainer()},render(){const e=[this.periodicityContainer,this.priceContainer];return this.selected?(this.container.addClassName("selected"),this.periodicityContainer.getElement(".fonticon").removeClassName("fonticon fonticon-radiobutton-on").addClassName("fonticon fonticon-status-ok"),this.isStudentPortfolio||(e.push(this.quantityContainer),e.push(this.totalPriceContainer)),e.push(t.createElement("div",{class:"mpf-button",html:this.addToCartButton})),e.push(this.secureTransactionContainer)):(this.container.removeClassName("selected"),this.periodicityContainer.getElement(".fonticon").removeClassName("fonticon fonticon-status-ok").addClassName("fonticon fonticon-radiobutton-on")),this.portfolio.has("fullPrice")?this.container.addClassName("full-price"):this.container.removeClassName("full-price"),this.disabled?this.container.addClassName("disabled"):this.container.removeClassName("disabled"),this.container.setContent(e),this},isDisabled(){return!0===this.disabled},isSelected(){return!0===this.selected},select(){this.selected=!0,this.render()},deselect(){this.selected=!1,this.render()},_createSecureTransactionContainer(){const e=t.createElement("span",{class:"fonticon fonticon-lock"}),n=new i({className:"link",value:p.get("secureTransaction")}),r=t.createElement("div",{class:"mpf-popoverContent",html:[t.createElement("div",{class:"mpf-secureTransactionPopover",text:p.get("secureTransactionPopover")}),new i({className:"link",value:p.get("moreInformation"),events:{onClick:()=>{window.open("https://www.3ds.com/privacy-policy","_blank")}}})]}),o=t.createElement("div",{class:"mpf-secure-transaction",html:[e,n]});return new s({target:n.getContent(),position:"right",trigger:"touch",title:p.get("secureTransaction"),body:r}),o},_isEduPortfolio(){return a.isEduOffer(this.portfolio)},_isMakerPortfolio(){return a.isMakerOffer(this.portfolio)},_createQuantityContainer(){return t.createElement("div",{class:"mpf-offer-quantity",html:[t.createElement("div",{class:"mpf-offer-quantity-label",text:p.get("quantity")}),this.quantityInput]})},_createQuantityInput(){return new n({min:this.portfolio.isCreditOffer()?2500:1,step:1,max:this.isMakerPortfolio?5:99999,decimalPrecision:1,events:{onChange:this._updateTotalPrice.bind(this)}})},_updateTotalPrice(){if(t.is(this.quantityInput)){const e=parseInt(this.quantityInput.getValue());Number.isNaN(e)?this.quantityInput.setValue(1):(this.totalPriceContainer=this._createTotalPriceContainer(),this.render())}},_createAddToCartButton(){return new i({className:"primary",value:p.get("addToCart"),events:{onClick:this._onAddToCart.bind(this)}})},_onAddToCart(){const e=parseInt(this.quantityInput.getValue(),10);this.dispatchEvent(m.ADD_TO_CART,{portfolio:this.portfolio,quantity:e});const t=c.createEventBuilder({category:h.OFFER,action:m.ADD_TO_CART}).addDimension(l.MARKETPLACE_SERVICE,u.CLICK_AND_BUY).addPersonalValue(d.QUANTITY,e);a.addTrackerInformation(t,this.portfolio),t.send()},_onSelectOffer(){if(!this.disabled&&!this.selected){this.dispatchEvent(m.SELECTED,this);const e=c.createEventBuilder({category:h.OFFER,action:m.SELECTED}).addDimension(l.MARKETPLACE_SERVICE,u.CLICK_AND_BUY);a.addTrackerInformation(e,this.portfolio),e.send()}},_createTotalPriceContainer(){const e=(t.is(this.quantityInput)?this.portfolio.getPricelistPrice()*parseInt(this.quantityInput.getValue()):this.portfolio.getPricelistPrice()).toLocaleString(this.locale,{style:"currency",currency:this.portfolio.getPricelistCurrency()}),i=this.portfolio.get("licensingScheme");let n="";return i===o.RevTypes.YSC?n=p.get("paidYearly"):i===o.RevTypes.MSC?n=p.get("paidMonthly"):i!==o.RevTypes.QSC&&i!==o.RevTypes.QRC||(n=p.get("paidQuarterly")),t.createElement("div",{class:"mpf-total-price",html:[t.createElement("div",{class:"mpf-total-price-value",text:p.get("totalPrice")+": "+e}),t.createElement("div",{class:"mpf-total-price-tax",text:p.get("excludingTax")+". "+n})]})},_createPeriodicityContainer(){let e,i;if(this.portfolio.isCreditOffer())i=p.get("yearlyCredits");else{const n=this.portfolio.get("licensingScheme");n===o.RevTypes.YSC?e=this.isStudentPortfolio?p.get("oneYear"):p.get("yearly"):n===o.RevTypes.MSC?e=p.get("monthly"):n!==o.RevTypes.QSC&&n!==o.RevTypes.QRC||(e=p.get("quarterly")),i=this.isStudentPortfolio?e:p.get("typeOfSubscription",{period:t.createElement("span",{text:e}).outerHTML})}return t.createElement("div",{class:"mpf-type-name",html:[this._createFonticon(),i]})},_createFonticon(){let e;return e=this.selected?"fonticon fonticon-status-ok":"fonticon fonticon-radiobutton-on",t.createElement("span",{class:e})},_createPriceContainer(){const e=this.portfolio.getPricelistPrice().toLocaleString(this.locale,{style:"currency",currency:this.portfolio.getPricelistCurrency()}),i=this.portfolio.has("fullPrice"),n=[t.createElement("div",{class:"mpf-price-value",text:e})],s=this.portfolio.isDisplayingPrice();if(i&&s){const e=this.portfolio.get("fullPrice").toLocaleString(this.locale,{style:"currency",currency:this.portfolio.getPricelistCurrency()}),i=t.createElement("div",{class:"mpf-full-price",text:e});n.unshift(i)}return t.createElement("div",{class:"mpf-price",html:n})},_checkPrototypes(e){r.requiredOfPrototype(e.portfolio,o,"options.portfolio must be a PortfolioModel")},destroy(){this.stopListening(),this.portfolio=null,this._parent(),this.container=null}});return C.Events=m,C}),define("DS/MPFClickAndBuyComponent/discoverBundle/DiscoverBundleSection",["UWA/Class/View","UWA/Core","DS/UIKIT/Input/Button","DS/MPFServices/ObjectService","DS/MPFPortfolioModel/PortfolioPackModel","DS/MPFPortfolioModel/PortfolioHelper","i18n!DS/MPFClickAndBuyComponent/assets/nls/MPFClickAndBuyComponent","css!DS/MPFClickAndBuyComponent/MPFClickAndBuyComponent"],(e,t,i,n,s,r,o)=>{"use strict";const a=Object.freeze({DISCOVER_BUNDLE:"discoverBundle"}),c=e.extend({className:"mpf-discover-bundle-section",setup(e={}){this._parent(e),this.locale=e.locale,this.bundle=e.bundle,this.bundleItems=Object.keys(this.bundle.getOffers().first().getProducts()),this.bundleItemsInfo={},this.title=this._createTitle(),this.subtitle=this._createSubtitle(),this.priceInfo=this._createPriceInfo(),this.discoverButton=this._createDiscoverButton(),this._getBundleItemsInfo()},render(){const e=t.createElement("div",{class:"mpf-left",html:[this.title,this.subtitle]}),i=t.createElement("div",{class:"mpf-left-in-right",html:[t.createElement("span",{class:"mpf-price-start",text:o.get("startingFrom")}),this.priceInfo,t.createElement("div",{class:"mpf-price-month",text:o.get("perMonth")}),this.discoverButton]}),n=t.createElement("div",{class:"mpf-right-in-right",html:this.discoverButton}),s=t.createElement("div",{class:"mpf-right",html:[i,n]});return this.container.setContent([e,s]),this},_displayBundleItemInfo(e){this.bundleItemsInfo[e.acronym]=e,this.subtitle=this._createSubtitle(),this.render()},_getBundleItemsInfo(){this.bundleItems.forEach(e=>{r.getPortfolioRoleFromCompass(e.split("-")[0]).then(e=>this._displayBundleItemInfo(e)).catch(e=>{console.warn(e)})})},_createPriceInfo(){let e;return this.bundle.getOffers().forEach(i=>{var n=i.getPriceList()[0].monthlyDisplay;(!t.is(e)||n<e)&&(e=n)}),t.createElement("span",{class:"mpf-price",text:e.toLocaleString(this.locale,{style:"currency",currency:this.bundle.getOffers().first().getPricelistCurrency()})})},_createDiscoverButton(){return new i({className:"primary",value:o.get("discover"),events:{onClick:()=>{this.dispatchEvent(a.DISCOVER_BUNDLE,{bundle:this.bundle,bundleItemsInfo:this.bundleItemsInfo})}}})},_createTitle(){return t.createElement("div",{class:"mpf-title",text:this.bundle.getDisplayName()})},_createSubtitle(){const e=Object.values(this.bundleItemsInfo).reduce((e,t,i)=>0===i?t.title:e+" | "+t.title,"");return t.createElement("div",{class:"mpf-subtitle",text:e})},_checkPrototypes(e){n.requiredOfPrototype(e.bundle,s,"options.bundle must be a PortfolioPackModel")},destroy(){this.stopListening(),this._parent(),this.container=null}});return c.Events=Object.freeze(a),c}),define("DS/MPFClickAndBuyComponent/ClickAndBuyCartHelper",["UWA/Promise","UWA/Core","DS/PlatformAPI/PlatformAPI","DS/MPFDataProxy/NoDataProxy","DS/MPFCartModel/CartPatchArray","DS/MPFCartModel/CartPatchOperation","DS/MPFCartModel/CartFactory","DS/MPFCartModel/CartModel","DS/MPFCartModel/CartItemModel","DS/MPFPortfolioModel/PortfolioHelper","DS/MPFUtils/MPFUtils"],(e,t,i,n,s,r,o,a,c,l,d)=>{"use strict";const h={},u=Object.freeze({EDU_NON_EDU:"eduNonEduProducts",MAKERS_NON_MAKERS:"makersNonMakersProducts",EDU_IN_CART:"eduProductAlreadyInCart"}),p=Object.freeze({MpfCartUpdated:"MpfCartUpdated"});function m(e){const t=[],n=e.getItems().filter(e=>{let i=!0;const n=e.getOfferId();return n&&(t.includes(n)?i=!1:t.push(n)),i}).reduce((e,t)=>e+=parseInt(t.getQuantity()),0);i.publish(p.MpfCartUpdated,{nbItems:n})}return h.saveSubscriptionAndPreReq=function(i,n,s,r){const o=i.getItems(),a=d.findInArray(o,e=>""===e.getOfferId()&&e.getSkuId()===n.get("skuid"));return t.is(a)?a.setQuantity(parseInt(a.getQuantity())+parseInt(s)):o.push(h.getSubscriptionOp(i,n,s)),r.forEach(e=>{const s=d.findInArray(o,t=>""===t.getOfferId()&&t.getSkuId()===e.skuid);t.is(s)?s.setQuantity(parseInt(e.quantity)):o.push(h.getPreReqOp(i,n,e))}),i.setItems(o),m(i),e.resolve(i)},h.getSubscriptionOp=function(e,t,i){const s={[c.Fields.OFFER_ID]:"",[c.Fields.SKU_ID]:t.get("skuid"),[c.Fields.LICENSING]:t.get("licensing"),[c.Fields.LICENSING_SCHEME]:t.get("licensingScheme"),[c.Fields.PRODUCT_DISPLAY_NAME]:t.getProductDisplayName(),[c.Fields.PRODUCT_TRIGRAM]:t.get("productTrigram"),[c.Fields.PRODUCT_NUMBER]:t.get("productNumber"),[c.Fields.ACTION]:e.getActionType()||a.ActionTypes.START,[c.Fields.UNIT_NET_AMOUNT]:t.getPricelistPrice().toString(),[c.Fields.TYPE]:e.get(a.Fields.TYPE)||a.Types.SOFTWARE_REQUEST,[c.Fields.QUANTITY]:parseInt(i),[c.Fields.TEMP_UUID]:d.generateUUID()};return new c(s,{dataProxy:n.getInstance(),parse:!0})},h.getPreReqOp=function(e,t,i){const s={[c.Fields.OFFER_ID]:"",[c.Fields.SKU_ID]:i.skuid,[c.Fields.LICENSING]:i.licensing,[c.Fields.LICENSING_SCHEME]:i.licensingScheme,[c.Fields.PRODUCT_DISPLAY_NAME]:i.productDisplayName,[c.Fields.PRODUCT_TRIGRAM]:i.productTrigram,[c.Fields.PRODUCT_NUMBER]:i.productNumber,[c.Fields.ACTION]:e.getActionType()||a.ActionTypes.START,[c.Fields.UNIT_NET_AMOUNT]:i.pricelist[0].price.toString(),[c.Fields.TYPE]:e.get(a.Fields.TYPE)||a.Types.SOFTWARE_REQUEST,[c.Fields.QUANTITY]:parseInt(i.quantity),[c.Fields.TEMP_UUID]:d.generateUUID()};return new c(s,{dataProxy:n.getInstance(),parse:!0})},h.updateQuantityItems=function(t,i){if(t.isNew()){const n=t.getItems().map(e=>{const t=d.findInArray(i,t=>e.getOfferId()===t.offerId);return t&&(e.setQuantity(parseInt(t.quantity,10)),t.quantityOffer&&e.set(c.Fields.OFFER_QUANTITY,t.quantityOffer)),e});return t.setItems(n),m(t),e.resolve(t)}{const n=new s;return i.forEach(e=>{const t=new r(r.Operations.MODIFY,"/cart-items/"+e.id,{Quantity:parseInt(e.quantity)});n.add(t)}),0===n.getOperations().length?e.resolve():t.megaPatch(n).then(m.bind(this,t))}},h.removeItem=function(t,i){if(t.isNew()){const n=t.getItems().filter(e=>e.getProductTrigram()!==i.getProductTrigram());return t.setItems(n),m(t),e.resolve(t)}{const e=new s,n=new r(r.Operations.REMOVE,"/cart-items/"+i.get("id"));return e.add(n),t.megaPatch(e).then(m.bind(this,t))}},h.addOffer=function(i,s,r){const o=i.getItems().filter(e=>e.getOfferId()!==s.getId());return s.getSoftwareOfferDetails().forEach((e,l)=>{const h=d.findInArray(i.getItems(),t=>t.getOfferId()===s.getId()&&t.getProductTrigram()===e.productTrigram);if(t.is(h)){const t=h.get(c.Fields.OFFER_QUANTITY)+parseInt(r);h.set(c.Fields.OFFER_QUANTITY,t),h.setQuantity(parseInt(e.quantity)*parseInt(t)),o.push(h)}else{const t={[c.Fields.TITLE]:s.getProductDisplayName(),[c.Fields.EXTERNAL_OFFER_ID]:s.get("externalOfferId"),[c.Fields.OFFER_ID]:s.getId(),[c.Fields.LICENSING]:s.get("licensing"),[c.Fields.LICENSING_SCHEME]:s.get("licensingScheme"),[c.Fields.PRODUCT_DISPLAY_NAME]:e.productDisplayName,[c.Fields.PRODUCT_TRIGRAM]:e.productTrigram,[c.Fields.PRODUCT_NUMBER]:e.productNumber,[c.Fields.ACTION]:i.getActionType()||a.ActionTypes.START,[c.Fields.UNIT_NET_AMOUNT]:0===l?s.getPricelistPrice():0,[c.Fields.TOTAL_NET_AMOUNT]:0===l?s.getPricelistPrice()*parseInt(r):0,[c.Fields.DISPLAY_PRICE]:!1,[c.Fields.TYPE]:i.get(a.Fields.TYPE)||a.Types.SOFTWARE_REQUEST,[c.Fields.OFFER_QUANTITY]:parseInt(r),[c.Fields.QUANTITY]:parseInt(e.quantity)*parseInt(r),[c.Fields.TEMP_UUID]:d.generateUUID()};o.push(new c(t,{dataProxy:n.getInstance(),parse:!0}))}}),i.setItems(o),m(i),e.resolve(i)},h.removeItems=function(i,n,s){if(s&&!i.isNew())return h.removeItem(i,n[0]);{const s=i.getItems().filter(e=>{const i=d.findInArray(n,t=>e.getOfferId()===t.getOfferId()&&e.getExternalOfferId()===t.getExternalOfferId());return!t.is(i)});return i.setItems(s),m(i),e.resolve(i)}},h.getConflictingItems=function(e,t){const i=l.isEduOffer(t),n=l.isMakerOffer(t);let s,r=[];const o=e.getItems(),a=o.filter(e=>e.isEduItem()!==i),c=o.filter(e=>e.isMakerItem()!==n);if(a.length>0)s=n?u.MAKERS_NON_MAKERS:u.EDU_NON_EDU,r=a;else if(c.length>0)s=i?u.EDU_NON_EDU:u.MAKERS_NON_MAKERS,r=c;else if(i){const e=t.getId(),i=t.get("externalOfferId");(r=o.filter(t=>t.getOfferId()===e&&t.getExternalOfferId()===i)).length>0&&(s=u.EDU_IN_CART)}return{conflictingItems:r,conflictType:s}},h.saveCartAndItems=function(e){const t=[],i=new s,n=e.getItems().filter(e=>{const i=e.getOfferId();return(""===i||t.indexOf(i)<0)&&(t.push(i),!0)}).map(e=>{const t={},i=r.Operations.ADD;return t[c.Fields.OFFER_ID]=e.get(c.Fields.OFFER_ID),t[c.Fields.SKU_ID]=e.get(c.Fields.SKU_ID),t[c.Fields.LICENSING]=e.get(c.Fields.LICENSING),t[c.Fields.LICENSING_SCHEME]=e.get(c.Fields.LICENSING_SCHEME),t[c.Fields.PRODUCT_DISPLAY_NAME]=e.get(c.Fields.PRODUCT_DISPLAY_NAME),t[c.Fields.PRODUCT_TRIGRAM]=e.get(c.Fields.PRODUCT_TRIGRAM),t[c.Fields.PRODUCT_NUMBER]=e.get(c.Fields.PRODUCT_NUMBER),t[c.Fields.ACTION]=a.ActionTypes.START,t[c.Fields.UNIT_NET_AMOUNT]=e.get(c.Fields.UNIT_NET_AMOUNT).toString(),t[c.Fields.TYPE]=a.Types.SOFTWARE_REQUEST,t[c.Fields.QUANTITY]=parseInt(e.getQuantity(),10),t[c.Fields.TEMP_UUID]=d.generateUUID(),new r(i,"/cart-items",t)});return i.addAll(n),e.savePromise().then(t=>{const n=new o(e.dataProxy.connector);return e.dataProxy=n.getDataProxy(o.Types.CART),e.id=e.get("id"),e.megaPatch(i)}).then(m.bind(this,e))},h.ConflictTypes=u,h.Events=p,h}),define("DS/MPFClickAndBuyComponent/checkout/BillingInfoSection",["UWA/Core","DS/UIKIT/Alert","DS/UIKIT/Input/Toggle","DS/MPFTracker/Tracker","DS/MPFTracker/Dimension","DS/MPFTracker/Category","DS/MPFServices/ObjectService","DS/MPFCartModel/CartModel","DS/MPFCartModel/CartModelHelper","DS/MPFCompanyModel/CompanyFactory","DS/MPFCompanyModel/CompanyModel","DS/MPFCountryModel/CountryCollection","DS/MPFOrderComponent/OrderConfirmationSection","DS/MPFCompanyComponent/CompanyNameInput","DS/MPFCompanyComponent/CompanyTaxRegistrationIdInput","DS/MPFView/FieldTextInputV2","DS/MPFView/FieldSelectInputV2","i18n!DS/MPFClickAndBuyComponent/assets/nls/MPFClickAndBuyComponent","css!DS/MPFClickAndBuyComponent/MPFClickAndBuyComponent"],function(e,t,i,n,s,r,o,a,c,l,d,h,u,p,m,C,f,y){"use strict";const g=Object.freeze({VALID_SECTION:"validSection",INVALID_SECTION:"invalidSection"}),P=Object.freeze({FORM_ERROR:"FormError"}),I=u.extend({className:"mpf-section mpf-horizontal mpf-bill-info",setup:function(e){e||(e={}),this._checkPrototypes(e),this._parent(e),this.service=e.service,this.cart=e.cart,this.companyFactory=e.companyFactory,this.company=e.company,this.countries=e.countries,this.companyNameInput=this._createCompanyNameInput(),this.countrySelectInput=this._createCountrySelectInput(),this.taxRegistrationIdInput=this._createTaxRegistrationIdInput(),this.noTaxIdCheckbox=this._createNoTaxIdCheckbox(),this.taxIdCheckboxContainer=this._createTaxIdCheckboxContainer(),this.listenTo(this.countrySelectInput,f.Events.UPDATE,this._onCountryChange.bind(this)),this.listenTo(this.taxRegistrationIdInput,C.Events.UPDATE,this._checkVatId.bind(this))},render:function(){return this.body=[this.companyNameInput.render(),this.countrySelectInput.render(),this.taxRegistrationIdInput.render(),this.taxIdCheckboxContainer],this.taxIdCheckboxContainer.hide(),this._onCountryChange({resetTaxId:!1}),this._parent(),this},validate:function(){const e=this.companyNameInput.validate(),t=this.countrySelectInput.validate();return e.isValid&&t.isValid},isNoVatIdChecked:function(){return this.noTaxIdCheckbox.isChecked()},_checkVatId:function(){const e=this,t={},i=this.company.getCountry(),n=this.taxRegistrationIdInput.getTaxRegistrationId();if(this.taxRegistrationIdInput._removeErrorMessage(),""!==n.trim()){t[d.Fields.NAME]="VAT IT test",t[d.Fields.COUNTRY]=i,t[d.Fields.VAT_ID]=n;const s=this.companyFactory.createModel(l.Types.CHECK_VAT,t);return s.savePromise(t).then(function(){!0===s.get("valid")?(e.company.setTaxRegistrationId(n),e.dispatchEvent(g.VALID_SECTION)):(e.taxRegistrationIdInput._displayErrorMessage({isValid:!1,errors:[{field:d.Fields.TAX_REGISTRATION_ID,message:s.get("message")||y.get("taxRegIdInvalid")}]}),e._sendTrackingEvent(P.FORM_ERROR,"Error label"),e.dispatchEvent(g.INVALID_SECTION))}).catch(function(){e._displayAlert(y.get("taxRegIdBackendValidation")),e.dispatchEvent(g.INVALID_SECTION)})}"USA"===i||"CAN"===i||"JPN"===i?this.dispatchEvent(g.VALID_SECTION):this.dispatchEvent(g.INVALID_SECTION)},_onCountryChange:function(t){const i=this.countrySelectInput.getValue(),n=""!==i&&this.countries.find(e=>e.getIso3()===i).isEuropean();this.noTaxIdCheckbox.uncheck(),e.is(t)&&!1!==t.resetTaxId&&(this.taxRegistrationIdInput.resetValue({silent:!0}),this.taxRegistrationIdInput._removeErrorMessage()),this.taxRegistrationIdInput.setDisabled(""===i),"DZA"===i?(this.taxRegistrationIdInput.setFieldLabel(y.get("nifNumber")),this.taxRegistrationIdInput.setRequired(!0),this.taxRegistrationIdInput.show(),this.taxIdCheckboxContainer.hide()):"MAR"===i?(this.taxRegistrationIdInput.setFieldLabel(y.get("iceNumber")),this.taxRegistrationIdInput.setRequired(!0),this.taxRegistrationIdInput.show(),this.taxIdCheckboxContainer.hide()):n?(this.taxRegistrationIdInput.setFieldLabel(y.get("vatRegistrationId")),this.taxRegistrationIdInput.setRequired(!1),this.taxRegistrationIdInput.show(),this.noTaxIdCheckbox.setValue(y.get("noVatIdNoUk")),this.taxIdCheckboxContainer.show()):"USA"===i?(this.taxRegistrationIdInput.setFieldLabel(y.get("employerIdentificationNumber")),this.taxRegistrationIdInput.setRequired(!1),this.taxRegistrationIdInput.show(),this.taxIdCheckboxContainer.hide()):"CAN"===i?(this.taxRegistrationIdInput.setFieldLabel(y.get("businessNumber")),this.taxRegistrationIdInput.setRequired(!1),this.taxRegistrationIdInput.show(),this.taxIdCheckboxContainer.hide()):"JPN"===i?(this.taxRegistrationIdInput.setRequired(!1),this.taxRegistrationIdInput.hide(),this.taxIdCheckboxContainer.hide()):"AUS"===i?(this.taxRegistrationIdInput.setFieldLabel(y.get("businessNumber")),this.taxRegistrationIdInput.setRequired(!1),this.taxRegistrationIdInput.show(),this.noTaxIdCheckbox.setValue(y.get("noBusinessNumber")),this.taxIdCheckboxContainer.show()):(this.taxRegistrationIdInput.setFieldLabel(),this.taxRegistrationIdInput.setRequired(!0),this.taxRegistrationIdInput.show(),this.taxIdCheckboxContainer.hide()),this.taxRegistrationIdInput.render(),""!==i&&this._checkVatId()},_displayAlert:function(e){new t({className:"error",messageClassName:"error",messages:e,closable:!0,visible:!0,closeOnClick:!0}).inject(this.container,"top")},_createTaxIdCheckboxContainer:function(){return e.createElement("div",{class:"mpf-tax-id",html:this.noTaxIdCheckbox})},_onChangeValueCheckbox:function(){const e=this.noTaxIdCheckbox.isChecked(),t=e?g.VALID_SECTION:g.INVALID_SECTION;this.taxRegistrationIdInput.resetValue({silent:!0}),this.taxRegistrationIdInput.setDisabled(e),this.company.set(d.Fields.TAX_REGISTRATION_ID,null),this.dispatchEvent(t)},_createNoTaxIdCheckbox:function(){return new i({className:"primary",type:"checkbox",value:y.get("noVatIdNoUk"),events:{onChange:this._onChangeValueCheckbox.bind(this)}})},_createTaxRegistrationIdInput:function(){return new m({model:this.company,readOnly:!0,required:!0,dynamicValidation:!1})},_createCountrySelectInput:function(){const t=this.company.getCountry();return new f({model:this.company,required:!0,dynamicValidation:!0,silent:!1,fieldName:d.Fields.COUNTRY,fieldLabel:y.get("country"),readOnly:e.is(t)&&""!==t,placeholder:y.get("selectCountry"),selectableOptions:this._getCountriesOptions()})},_getCountriesOptions:function(){const e=this;return this.countries.map(function(t){return{value:t.getIso3(),label:t.getName(),selected:t.getIso3()===e.company.getCountry()}})},_createCompanyNameInput:function(){return new p({model:this.company,dynamicValidation:!0,readOnly:!this.company.isNew(),required:!0})},_checkPrototypes:function(e){o.requiredOfPrototype(e.cart,a,"options.cart must be a CartModel"),o.requiredOfPrototype(e.companyFactory,l,"options.companyFactory must be a CompanyFactory"),o.requiredOfPrototype(e.company,d,"options.company must be a CompanyModel"),o.requiredOfPrototype(e.countries,h,"options.countries must be a CountryCollection")},_sendTrackingEvent:function(e,t){const i=n.createEventBuilder({category:r.CHECKOUT,action:e}).setLabel(t);c.addTrackerInformation(i,this.cart),i.addDimension(s.MARKETPLACE_SERVICE,this.service).addDimension(s.BUYER_TYPE,"company").send()},destroy:function(){this.cart=null,this.countries=null,this.company=null,this.companyFactory=null,this._parent(),this.container=null}});return I.Events=Object.freeze(g),I}),define("DS/MPFClickAndBuyComponent/offerList/AvailableCountriesComponent",["UWA/Class/View","DS/UIKIT/Input/Select","DS/MPFServices/ObjectService","DS/MPFCountryModel/CountryCollection","DS/MPFCartModel/CartModel","i18n!DS/MPFClickAndBuyComponent/assets/nls/AvailableCountries","css!DS/MPFClickAndBuyComponent/MPFClickAndBuyComponent"],(e,t,i,n,s,r)=>{"use strict";const o=Object.freeze({ON_CHANGE_COUNTRY:"onChangeCountry"}),a=e.extend({className:"mpf-offer-list-available-countries",setup(e={}){i.requiredOfPrototype(e.countries,n,"options.countries must be a CountryCollection"),i.requiredOfPrototype(e.cart,s,"options.cart must be a CartModel"),this.countries=e.countries,this.selectedCountry=e.selectedCountry||"US",this.cart=e.cart,this.isEduOffer=!0===e.isEduOffer,this.isMakerOffer=!0===e.isMakerOffer,this.select=this._createSelect()},render(){return this.container.setContent(this.select),this},getSelectedCountry(){return this.select.getValue()[0]},_createSelect(){const e=this.isMakerOffer&&this.cart.hasMakerItems(),i=this.isEduOffer&&this.cart.hasEduItems(),n=!this.isMakerOffer&&!this.isEduOffer&&this.cart.getItems().length>0&&!this.cart.hasMakerItems()&&!this.cart.hasEduItems();return new t({placeholder:!1,disabled:e||i||n,options:this._getOptions(),events:{onChange:()=>{this.dispatchEvent(o.ON_CHANGE_COUNTRY,this.select.getValue()[0])}}})},_getOptions(){return this.countries.map(e=>{const t=e.getIso2();return{value:t,label:r.get(t),selected:t===this.selectedCountry}}).sort((e,t)=>e.label<t.label?-1:e.label>t.label?1:0)},destroy(){this.stopListening(),this.countries=null,this._parent(),this.container=null}});return a.Events=o,a}),define("DS/MPFClickAndBuyComponent/SubscriptionInformationComponent",["UWA/Core","UWA/Class/View","DS/MPFServices/ObjectService","DS/MPFPortfolioModel/PortfolioModel","DS/MPFPortfolioModel/PortfolioPackModel","DS/MPFPortfolioModel/PortfolioHelper","i18n!DS/MPFClickAndBuyComponent/assets/nls/SubscriptionInformation"],function(e,t,i,n,s,r,o){"use strict";return t.extend({className:"mpf-subscription-information",setup(){},render({portfolioPack:e}){i.requiredOfPrototype(e,s,"options.portfolioPack must be a PortfolioPackModel");const t=e.getOffers().first(),n=[{tag:"div",class:"mpf-title",text:o.get("subscriptionInformation")},{tag:"div",class:"mpf-subsection-container",html:[this._renderOfferDetailsSection({portfolio:t}),this._renderWhoIsEligibleSection({portfolio:t}),this._renderGettingStartedSection(),this._renderSubscrpitionAndRenewalsSection({portfolio:t}),this._renderNeedMoreInfoSection()]}];return this.container.setContent(n),this},_renderOfferDetailsSection({portfolio:e}){return this._renderSubSectionIfPortfolioContains({portfolio:e,attribute:n.Fields.OFFER_DETAILS,title:o.get("offerDetails")})},_renderWhoIsEligibleSection({portfolio:e}){return this._renderSubSectionIfPortfolioContains({portfolio:e,attribute:n.Fields.WHO_IS_ELIGIBLE,title:o.get("whoIsEligible")})},_renderGettingStartedSection(){const e=[];for(var t=1;t<=3;t++)e.push({tag:"li",text:o.get("gettingStarted_part"+t)});return this._renderSubSection(o.get("gettingStarted"),[{tag:"div",class:"mpf-intro",text:o.get("gettingStarted_intro")},{tag:"ul",html:e}])},_renderSubscrpitionAndRenewalsSection({portfolio:e}){return this._renderSubSection(o.get("subscriptionsAndRenewals"),r.isRenewableOffer(e)?o.get("subscriptionsAndRenewals_text_renewable"):o.get("subscriptionsAndRenewals_text_non_renewable"))},_renderNeedMoreInfoSection(){return this._renderSubSection(o.get("needMoreInfo"),o.get("needMoreInfo_text",{faq:this._createLink(o.get("faq"),"https://www.3ds.com/support/3dexperience-platform-on-cloud-support/support-for-online-purchase")}))},_createLink:(t,i)=>e.createElement("a",{text:t,href:i,target:"_blank"}).outerHTML,_renderSubSectionIfPortfolioContains({portfolio:e,attribute:t,title:i}){const n=e.get(t);if(n)return this._renderSubSection(i,n)},_renderSubSection:(e,t)=>({tag:"div",class:"mpf-sub-section",html:[{tag:"div",class:"mpf-sub-section-title",text:e},{tag:"div",class:"mpf-sub-section-content",html:t}]}),destroy(){this._parent(),this.container=null}})}),define("DS/MPFClickAndBuyComponent/offerList/OfferDescriptionComponent",["UWA/Class/View","UWA/Core","DS/MPFServices/ObjectService","DS/MPFPortfolioModel/PortfolioPackModel","i18n!DS/MPFClickAndBuyComponent/assets/nls/MPFClickAndBuyComponent","css!DS/MPFClickAndBuyComponent/MPFClickAndBuyComponent"],(e,t,i,n,s)=>{"use strict";return e.extend({className:"mpf-description-offer",setup(e={}){this._checkPrototypes(e),this.portfolioPack=e.portfolioPack,this.roleInfo=e.roleInfo||{},this.descriptionContainer=this._createDescriptionContainer()},render(){return this.container.setContent(this.descriptionContainer),""===this.descriptionContainer.getText()&&this.container.setStyle("display","none"),this},_createDescriptionContainer(e){let i;if(this.portfolioPack.isBundle()){const e=this.portfolioPack.getOffers().find(e=>e.getDescription()&&""!==e.getDescription());i=t.is(e)&&e.getDescription()}else i=this.roleInfo.tagLine;return t.createElement("div",{class:"mpf-product-info",html:i||""})},_checkPrototypes(e){i.requiredOfPrototype(e.portfolioPack,n,"options.portfolioPack must be a PortfolioPackModel")},destroy(){this.stopListening(),this.portfolioPack=null,this._parent(),this.container=null}})}),define("DS/MPFClickAndBuyComponent/PreReqTableLineComponent",["UWA/Class/View","UWA/Core","DS/UIKIT/Input/Number","i18n!DS/MPFClickAndBuyComponent/assets/nls/MPFClickAndBuyComponent","css!DS/MPFClickAndBuyComponent/MPFClickAndBuyComponent"],(e,t,i,n)=>{"use strict";return e.extend({tagName:"tr",className:"mpf-item-order",setup(e={}){this._parent(e),this.locale=e.locale||"en-US",this.preReq=e.preReq,this.initialQuantity=e.initialQuantity,this.isQuantityInputDisabled=!0===e.isQuantityInputDisabled,this.preReq.quantity=this.initialQuantity,this.productNameCell=this._createProductNameCell(),this.monthlyPriceCell=this._createMonthlyPriceCell(),this.quantityInput=this._createQuantityInput(),this.quantityCell=this._createQuantityCell(),this.totalPriceCell=this._createTotalPriceCell()},render(){return this.container.setContent([this.productNameCell,this.monthlyPriceCell,this.quantityCell,this.totalPriceCell]),this},_createProductNameCell(){return t.createElement("td",{class:"mpf-product-name",text:this.preReq.productDisplayName})},_createMonthlyPriceCell(){const e=parseFloat(this.preReq.pricelist[0].monthlyDisplay).toLocaleString(this.locale,{style:"currency",currency:this.preReq.pricelist[0].currency});return t.createElement("td",{class:"mpf-order-price",text:e+" user / month"})},_createQuantityInput(){return new i({value:this.initialQuantity,min:1,max:99999,step:1,decimalPrecision:1,disabled:this.isQuantityInputDisabled,events:{onChange:this._onQuantityChanged.bind(this)}})},_createQuantityCell(){return t.createElement("td",{class:"mpf-order-quantity",html:this.quantityInput})},_createTotalPriceCell(){let e=parseFloat(this.preReq.pricelist[0].monthlyDisplay);const i=(e=this.initialQuantity*e).toLocaleString(this.locale,{style:"currency",currency:this.preReq.pricelist[0].currency});return t.createElement("td",{class:"mpf-price",text:i+" / month"})},_onQuantityChanged(){if(t.is(this.quantityInput)&&t.is(this.totalPriceCell)){const e=parseInt(this.quantityInput.getValue());if(Number.isNaN(e))this.quantityInput.setValue(this.initialQuantity);else{this.preReq.quantity=e;let t=parseFloat(this.preReq.pricelist[0].monthlyDisplay);const i=(t*=e).toLocaleString(this.locale,{style:"currency",currency:this.preReq.pricelist[0].currency});this.totalPriceCell.setText(n.get("unitPricePerMonth",{price:i})),this.render()}}}})}),define("DS/MPFClickAndBuyComponent/checkout/BillingInfoPage",["UWA/Class/View","UWA/Core","UWA/Promise","UWA/Utils","DS/MPFTracker/Tracker","DS/MPFTracker/Dimension","DS/MPFTracker/Category","DS/MPFError/ValidationError","DS/MPFServices/ObjectService","DS/MPFCompanyModel/CompanyFactory","DS/MPFCompanyModel/CompanyModel","DS/MPFCountryModel/CountryCollection","DS/MPFBuyer/BuyerType","DS/MPFCartModel/CartModel","DS/MPFCartModel/CartModelHelper","DS/MPFCartModel/CartPatchOperation","DS/MPFCartModel/CartPatchArray","DS/MPFPspModel/PspModel","DS/MPFClickAndBuyComponent/checkout/BillingInfoSection","DS/MPFModalConfiguratorComponent/BillingAddressFormSection","i18n!DS/MPFClickAndBuyComponent/assets/nls/MPFClickAndBuyComponent","css!DS/MPFClickAndBuyComponent/MPFClickAndBuyComponent"],function(e,t,i,n,s,r,o,a,c,l,d,h,u,p,m,C,f,y,g,P,I){"use strict";const _=Object.freeze({VALID:"valid",INVALID:"invalid"}),S=Object.freeze({FORM_ERROR:"FormError",NEXT:"Next"}),E=e.extend({className:"mpf-billing-info-page mpf-click-and-buy",setup:function(e){e||(e={}),this._checkPrototypes(e),this._parent(e),this.service=e.service,this.cart=e.cart,this.companyFactory=e.companyFactory,this.company=e.company,this.countries=e.countries,this.addresses=e.addresses,this.addressFactory=e.addressFactory,this.cartPsp=e.cartPsp,this.billingInfoSection=this._createBillingInfoSection(),this.billingAddressSection=this._createBillingAddressSection()},render:function(){return this.container.setContent([this._displayInfoMsgForJapaneseUsers(),this.billingInfoSection.render(),this.billingAddressSection.render()]),this._sendTrackingPage(),this},getBillingAddressModel:function(){return this.billingAddressSection.getBillingAddressModel()},validate:function(){const e=this.billingInfoSection.validate(),t=this.billingAddressSection.validate();return e&&t},save:function(){const e={};return this.validate()?(this._sendTrackingEvent(S.NEXT),this.company.set("address",this.billingAddressSection.getBillingAddressModel().omit()),this.company.savePromise(null,e).catch(e=>{let t="";if(400===e.options.request.xhr.status)try{t=JSON.parse(e.options.request.xhr.responseText)}catch(e){console.warn(e)}return i.reject(t)})):(this._sendTrackingEvent(S.FORM_ERROR,"Error label"),i.reject(new a(I.get("errorFieldsInfo"))))},_displayInfoMsgForJapaneseUsers:function(){const e=n.Client.Locale.lang,i=this._getCurrentLanguageFromCookie();if("ja"===e||t.is(i)&&"ja"===i.value)return t.createElement("div",{class:"alert-message alert-warning alert-has-icon",html:[t.createElement("span",{class:"icon fonticon"}),t.createElement("span",{text:""})]})},_getCurrentLanguageFromCookie:function(){return document.cookie.split(/\s*;\s*/).map(function(e){const t=e.split("=");return{key:t.length>=1?t[0]:null,value:t.length>=2?t[1]:null}}).find(function(e){return e.key===encodeURIComponent("swymlang")})},_updateCartBillingAddress:function(e){const t={[p.Fields.BILL_TO]:e.get("id")},i=new f,n=new C(C.Operations.modify,"/",t);return i.add(n),this.cart.megaPatch(i).then(function(){return e})},_createBillingAddressSection:function(){return new P({title:I.get("billingAddress"),buyer:this.company,buyerType:u.COMPANY,countries:this.countries,addresses:this.addresses,addressFactory:this.addressFactory})},_createBillingInfoSection:function(){const e=new g({service:this.service,title:I.get("billingInformation"),cart:this.cart,companyFactory:this.companyFactory,company:this.company,countries:this.countries});return this.listenTo(e,g.Events.VALID_SECTION,this.dispatchEvent.bind(this,_.VALID)),this.listenTo(e,g.Events.INVALID_SECTION,this.dispatchEvent.bind(this,_.INVALID)),e},_checkPrototypes:function(e){c.requiredOfPrototype(e.companyFactory,l,"options.companyFactory must be a CompanyFactory"),c.requiredOfPrototype(e.company,d,"options.company must be a CompanyModel"),c.requiredOfPrototype(e.countries,h,"options.countries must be a CountryCollection"),c.requiredOfPrototype(e.cart,p,"options.cart must be a CartModel"),c.requiredOfPrototype(e.cartPsp,y,"options.cartPsp must be a PspModel")},_sendTrackingPage:function(){const e=s.createPageBuilder({url:"/checkout/AddressCreation/PreCreation"}).setTitle("Address Information");m.addTrackerInformation(e,this.cart),e.addDimension(r.MARKETPLACE_SERVICE,this.service).addDimension(r.BUYER_TYPE,"company").send()},_sendTrackingEvent:function(e,t){const i=s.createEventBuilder({category:o.CHECKOUT,action:e}).setLabel(t);m.addTrackerInformation(i,this.cart),i.addDimension(r.MARKETPLACE_SERVICE,this.service).addDimension(r.BUYER_TYPE,"company").send()}});return E.Events=Object.freeze(_),E}),define("DS/MPFClickAndBuyComponent/MyCartWidget",["UWA/Class","DS/MPFConnector/MarketplaceConnector","DS/MPFServices/MarketplaceServices","DS/MPFModelFactory/MPFFactoriesV2","DS/MPFCartModel/CartFactory","DS/MPFClickAndBuyComponent/MyCartComponent"],function(e,t,i,n,s,r){"use strict";return e.extend({init:function(e){this.options=e,this.widget=e.widget},run:function(){this.widget.addEvent("onLoad",this._build.bind(this)),this.widget.addEvent("onRefresh",this._refresh.bind(this))},_build:function(){var e=this;return this._fetchData().then(this._createMyCartComponent.bind(this)).then(function(){e.widget.setBody(e.myCartComponent.render())})},_refresh:function(){var e=this;this.cart.fetchPromise().then(function(){e.myCartComponent.render()})},_fetchData:function(){return t.fetchPromise({service:i.CLICK_AND_BUY}).then(this._getFactories.bind(this)).then(this._getCart.bind(this))},_getFactories:function(e){return this.connector=e,n.getFactories([n.Types.CART]).then(function(e){this.cartFactory=e[0]})},_getCart:function(){return this.cart=this.cartFactory.createModel(s.Types.ME_V2),this.cart.fetchPromise()},_createMyCartComponent:function(){this.myCartComponent=new r({cart:this.cart})}})}),define("DS/MPFClickAndBuyComponent/orderList/BodySimpleOffer",["UWA/Class/View","UWA/Core","DS/UIKIT/Input/Number","DS/UIKIT/Input/Button","DS/UIKIT/Mask","DS/UIKIT/Modal","DS/MPFTracker/Tracker","DS/MPFTracker/Dimension","DS/MPFTracker/Category","DS/MPFCompassPlatformServices/CompassPlatformServices","DS/MPFServices/MarketplaceServices","DS/MPFServices/ObjectService","DS/MPFCartModel/CartModel","DS/MPFCartModel/CartItemModel","DS/MPFCartModel/CartModelHelper","DS/MPFClickAndBuyComponent/MarketingPortfolioPage","DS/MPFClickAndBuyComponent/ClickAndBuyCartHelper","DS/MPFPortfolioModel/LicensingHelper","i18n!DS/MPFClickAndBuyComponent/assets/nls/MPFClickAndBuyComponent","css!DS/MPFClickAndBuyComponent/MPFClickAndBuyComponent"],(e,t,i,n,s,r,o,a,c,l,d,h,u,p,m,C,f,y,g)=>{"use strict";const P=Object.freeze({VALUES_CHANGED:"valuesChanged",ITEM_REMOVED:"itemRemoved"}),I=Object.freeze({ITEM_REMOVED:"ItemRemoved",QUANTITY_CHANGED:"QuantityChanged"}),_=e.extend({className:"mpf-simple-offer",setup(e={}){this._checkPrototypes(e),this.locale=e.locale||"en-US",this.cart=e.cart,this.cartItem=e.cartItem,this.removeButton=this._createRemoveButton(),this.quantityInput=this._createQuantityInput(),this.totalPriceContainer=this._getTotalPrice(),this.title=this._createTitle(),this.body=this._createBody()},render(){return this.container.setContent([this.title,this.body]),this},getNewQuantityOffer(){const e=parseInt(this.quantityInput.getValue()),t=parseInt(this.cartItem.getQuantity()),i=this.cartItem.getOfferId();if(e!==t)return{id:this.cartItem.get("id"),quantity:e,offerId:i}},getTotalPrice(){return this.totalPrice},_createQuantityInput(){return new i({value:parseInt(this.cartItem.getQuantity()),min:y.isCredit(this.cartItem.getLicensing())?2500:1,max:this.cartItem.isMakerItem()?5:99999,step:1,decimalPrecision:1,disabled:this.cartItem.isEduItem(),events:{onChange:this._onValuesChanged.bind(this)}})},_onValuesChanged(){if(t.is(this.quantityInput)){const e=parseInt(this.quantityInput.getValue());if(Number.isNaN(e))this.quantityInput.setValue(this.cartItem.getQuantity());else{const t=this.cartItem.getUnitNetAmount(),i=e-parseInt(this.cartItem.getQuantity())>0?"added":"removed",n=e*t;this.totalPriceContainer=this._getTotalPrice(n),this.body=this._createBody(),this.render(),this._sendTrackingEvent(I.QUANTITY_CHANGED,i,parseInt(e)),this.dispatchEvent(P.VALUES_CHANGED)}}},_displayMarketingModal(){const e=t.is(document.body.getElement(".mpf-click-and-buy"))?document.body.getElement(".mpf-click-and-buy"):document.body,i=this._createMarketingModal();i.inject(e,"top"),i.show(),s.mask(i.getBody());try{l.getPortolioRole(this.cartItem.getProductTrigram().split("-")[0],e=>{const t=new C({portfolioInfo:e});s.unmask(i.getBody()),i.setBody(t.render())})}catch(e){s.unmask(i.getBody()),i.setBody("404 Not Found"),console.warn(e)}},_createMarketingModal(){const e=new r({className:"mpf-marketing-offer",header:t.createElement("h4",{text:this.cartItem.getProductDisplayName()})});return this.listenTo(e,"onHide",e.destroy.bind(e)),e},_removeItemFromQuote(){return this.removeButton.load(!0," "),f.removeItem(this.cart,this.cartItem).then(this._sendTrackingEvent.bind(this,I.ITEM_REMOVED,this.cartItem.getProductTrigram())).then(this.dispatchEvent.bind(this,P.ITEM_REMOVED)).finally(this.removeButton.load.bind(this.removeButton,!1))},_getIdProduct(){return t.createElement("div",{class:"mpf-product",html:this.cartItem.getProductNumber()})},_getPricingStructure(){let e,i=this.cartItem.getLicensingScheme();return i===p.RevTypes.QRC&&(i=p.RevTypes.QSC),i===p.RevTypes.YSC?e=g.get("yearly"):i===p.RevTypes.QSC?e=g.get("quarterly"):i===p.RevTypes.MSC&&(e=g.get("monthly")),t.createElement("div",{class:"mpf-pricing-structure",html:[t.createElement("div",{text:e}),t.createElement("div",{text:"("+i+")"})]})},_getQuantityInput(){return t.createElement("div",{class:"mpf-quantity",html:this.quantityInput})},_getTotalPrice(e){if(t.is(e))this.totalPrice=e;else{const e=parseInt(this.quantityInput.getValue()),t=this.cartItem.getUnitNetAmount();this.totalPrice=Number.isNaN(e)?t:e*t}const i=this._getFormattedPrice(this.totalPrice),n=this.cartItem.getLicensingScheme();let s;return n===p.RevTypes.YSC?s=g.get("yearlyPrice",{price:i}):n===p.RevTypes.MSC?s=g.get("monthlyPrice",{price:i}):n!==p.RevTypes.QSC&&n!==p.RevTypes.QRC||(s=g.get("quarterlyPrice",{price:i})),t.createElement("div",{class:"mpf-total-price",text:s})},_getUnitPrice(){const e=parseFloat(this.cartItem.getUnitNetAmount()),i=this._getFormattedPrice(e),n=this.cartItem.getLicensingScheme();let s;return y.isCredit(this.cartItem.getLicensing())?s=g.get("yearlyCreditPrice",{price:i}):n===p.RevTypes.YSC?s=g.get("yearlyPrice",{price:i}):n===p.RevTypes.MSC?s=g.get("monthlyPrice",{price:i}):n!==p.RevTypes.QSC&&n!==p.RevTypes.QRC||(s=g.get("quarterlyPrice",{price:i})),t.createElement("div",{class:"mpf-unit-price",text:s})},_getFormattedPrice(e){return e.toLocaleString(this.locale,{style:"currency",currency:this.cart.getCurrency(),minimumFractionDigits:e%1==0?0:2,maximumFractionDigits:e%1==0?0:2})},_createRemoveButton(){return new n({className:"error",icon:"trash",events:{onClick:this._removeItemFromQuote.bind(this)}})},_getRemoveButton(){return t.createElement("div",{class:"mpf-remove",html:this.removeButton})},_createBody(){return t.createElement("div",{class:"body",html:[this._getIdProduct(),this._getPricingStructure(),this._getQuantityInput(),this._getUnitPrice(),this.totalPriceContainer,this._getRemoveButton()]})},_createTitle(){const e=t.createElement("span",{class:"fonticon fonticon-info",events:{click:this._displayMarketingModal.bind(this)}});return t.createElement("div",{class:"title",html:t.createElement("div",{class:"mpf-title",html:[this.cartItem.getProductDisplayName(),e]})})},_checkPrototypes(e){h.requiredOfPrototype(e.cart,u,"options.cart must be a CartModel"),h.requiredOfPrototype(e.cartItem,p,"options.cartItem must be a CartItemModel")},destroy(){this.stopListening(),this.cartItem=null,this._parent(),this.container=null},_sendTrackingEvent(e,t,i){const n=o.createEventBuilder({category:c.CART,action:e}).setLabel(t).setValue(i);m.addTrackerInformation(n,this.cart),n.addDimension(a.MARKETPLACE_SERVICE,d.CLICK_AND_BUY).addDimension(a.BUYER_TYPE,"company").send()}});return _.Events=P,_}),define("DS/MPFClickAndBuyComponent/orderList/BodyBundleDetailsOffer",["UWA/Class/View","UWA/Core","DS/UIKIT/Modal","DS/UIKIT/Mask","DS/MPFCompassPlatformServices/CompassPlatformServices","DS/MPFCartModel/CartItemModel","DS/MPFClickAndBuyComponent/MarketingPortfolioPage","DS/MPFPortfolioModel/LicensingHelper","i18n!DS/MPFClickAndBuyComponent/assets/nls/MPFClickAndBuyComponent","css!DS/MPFClickAndBuyComponent/MPFClickAndBuyComponent"],(e,t,i,n,s,r,o,a,c)=>{"use strict";return e.extend({className:"mpf-bundle-offer-details",setup(e={}){this.locale=e.locale||"en-US",this.cartItems=e.cartItems,this.currency=e.currency,this.title=this._createTitle(),this.bundleItems=this._createBundleItems()},render(){return this.container.setContent([this.title,this.bundleItems]),this},updateQuantitesAndPrices(e){this.bundleItems.forEach(t=>{const i=t.getData("unitPrice")*e,n=this._getFormattedPrice(i),s=t.getData("periodicity")===r.RevTypes.YSC?c.get("yearlyPrice",{price:n}):c.get("quarterlyPrice",{price:n});t.getElement(".mpf-quantity").setText(e),!0===t.getData("isPriceDisplayable")&&t.getElement(".mpf-total-price").setText(s)})},_displayMarketingModal(e){const i=t.is(document.body.getElement(".mpf-click-and-buy"))?document.body.getElement(".mpf-click-and-buy"):document.body,r=this._createMarketingModal(e);r.inject(i,"top"),r.show(),n.mask(r.getBody());try{s.getPortolioRole(e.getProductTrigram().split("-")[0],e=>{const t=new o({portfolioInfo:e});n.unmask(r.getBody()),r.setBody(t.render())})}catch(e){n.unmask(r.getBody()),r.setBody("404 Not Found"),console.warn(e)}},_createMarketingModal(e){const n=new i({className:"mpf-marketing-offer",header:t.createElement("h4",{text:e.getProductDisplayName()})});return this.listenTo(n,"onHide",n.destroy.bind(n)),n},_createBundleItems(){return this.cartItems.map(e=>{const i=t.createElement("div",{class:"mpf-bundle-item",html:[this._getProductName(e),t.createElement("div",{class:"mpf-pricing-structure"}),this._getQuantity(e),this._getUnitPrice(e),this._getTotalPrice(e)]});return i.setData("unitPrice",e.getUnitNetAmount()),i.setData("periodicity",e.getLicensingScheme()),i.setData("isPriceDisplayable",e.isPriceDisplayable()),i})},_createTitle:()=>t.createElement("div",{class:"title",text:c.get("offerInclude")+":"}),_getProductName(e){const i=t.createElement("span",{class:"fonticon fonticon-info",events:{click:this._displayMarketingModal.bind(this,e)}});return t.createElement("div",{class:"mpf-product",html:[t.createElement("div",{class:"mpf-product-label",html:[e.getProductDisplayName(),i]}),t.createElement("div",{class:"mpf-product-number",text:e.getProductNumber()})]})},_getQuantity:e=>t.createElement("div",{class:"mpf-quantity",text:parseInt(e.getQuantity())}),_getTotalPrice(e){const i=parseFloat(e.getTotalNetAmount()),n=this._getFormattedPrice(i),s=e.getLicensingScheme();let o;return s===r.RevTypes.YSC?o=c.get("yearlyPrice",{price:n}):s===r.RevTypes.MSC?o=c.get("monthlyPrice",{price:n}):s!==r.RevTypes.QSC&&s!==r.RevTypes.QRC||(o=c.get("quarterlyPrice",{price:n})),t.createElement("div",{class:"mpf-total-price",text:e.isPriceDisplayable()?o:"-"})},_getUnitPrice(e){const i=parseFloat(e.getUnitNetAmount()),n=this._getFormattedPrice(i),s=e.getLicensingScheme();let o;return a.isCredit(e.getLicensing())?o=c.get("yearlyCreditPrice",{price:n}):s===r.RevTypes.YSC?o=c.get("yearlyPrice",{price:n}):s===r.RevTypes.MSC?o=c.get("monthlyPrice",{price:n}):s!==r.RevTypes.QSC&&s!==r.RevTypes.QRC||(o=c.get("quarterlyPrice",{price:n})),t.createElement("div",{class:"mpf-unit-price",text:e.isPriceDisplayable()?o:"-"})},_getFormattedPrice(e){return e.toLocaleString(this.locale,{style:"currency",currency:this.currency,minimumFractionDigits:e%1==0?0:2,maximumFractionDigits:e%1==0?0:2})},destroy(){this.stopListening(),this.cartItems=null,this._parent(),this.container=null}})}),define("DS/MPFClickAndBuyComponent/offerList/OfferListSection",["UWA/Core","UWA/Class/View","DS/MPFServices/ObjectService","DS/MPFUtils/MPFUtils","DS/MPFCartModel/CartModel","DS/MPFPortfolioModel/PortfolioPackModel","DS/MPFPortfolioModel/PortfolioModel","DS/MPFClickAndBuyComponent/offerList/OfferTile","DS/MPFClickAndBuyComponent/ClickAndBuyCartHelper","DS/MPFPortfolioModel/LicensingHelper","css!DS/MPFClickAndBuyComponent/MPFClickAndBuyComponent"],(e,t,i,n,s,r,o,a,c,l)=>{"use strict";const d=Object.freeze({ADD_TO_CART:"addToCart"}),h=t.extend({className:"mpf-offer-list-section",setup(e={}){this._checkPrototypes(e),this.cart=e.cart,this.portfolioPack=e.portfolioPack,this.locale=e.locale||"en-US",this.isOfferSelectedByDefault=!0===e.isOfferSelectedByDefault,this.portfolios=this.portfolioPack.getOffers(),this.tiles=this._createTiles()},render(){return this.container.setContent(this._renderTileContainer()),this},_renderTileContainer(){return e.createElement("div",{class:"mpf-product-tiles",html:this.tiles.map(e=>e.render())})},_onSelectedTile(e){return this.tiles.forEach(t=>{t===e?!t.isDisabled()&&t.isSelected()?t.deselect():t.select():t.deselect()})},_createTiles(){const e=this.cart.getItems(),t=n.findInArray(e,e=>!l.isCredit(e.getLicensing())),i=t&&t.getLicensingScheme();return this.portfolios.sortBy(e=>-o.NumberMonths[e.getLicensingScheme()]).map(e=>{const t=c.getConflictingItems(this.cart,e).conflictingItems.length>0,n=!e.isCreditOffer()&&!t&&i&&i!==e.getLicensingScheme(),s=i&&!t?i===e.getLicensingScheme():1===this.portfolios.length||e.getLicensingScheme()===o.RevTypes.YSC,r=new a({locale:this.locale,portfolio:e,disabled:n,selected:s&&this.isOfferSelectedByDefault});return this.listenTo(r,a.Events.SELECTED,this._onSelectedTile.bind(this,r)),this.listenTo(r,a.Events.ADD_TO_CART,this.dispatchEvent.bind(this,d.ADD_TO_CART)),r})},_checkPrototypes(e){i.requiredOfPrototype(e.cart,s,"options.cart must be a CartModel"),i.requiredOfPrototype(e.portfolioPack,r,"options.portfolioPack must be a PortfolioPackModel")},destroy(){this.stopListening(),this.cart=null,this.portfolioPack=null,this._parent(),this.container=null}});return h.Events=d,h}),define("DS/MPFClickAndBuyComponent/discoverBundle/DiscoverBundleComponent",["UWA/Class/View","UWA/Core","DS/MPFClickAndBuyComponent/discoverBundle/DiscoverBundleSection","i18n!DS/MPFClickAndBuyComponent/assets/nls/MPFClickAndBuyComponent","css!DS/MPFClickAndBuyComponent/MPFClickAndBuyComponent"],(e,t,i,n)=>{"use strict";const s=Object.freeze({DISPLAY_INFO_BUNDLE:"displayInfoBundle"}),r=e.extend({className:"mpf-discover-bundle",setup(e={}){this._parent(e),this.locale=e.locale,this.bundles=e.bundles,this.intro=this._createIntro(),this.sections=this._createSections()},render(){const e=this.sections.map(e=>e.render());return e.unshift(this.intro),this.container.setContent(e),this},_createSections(){return this.bundles.map(e=>{const t=new i({locale:this.locale,bundle:e});return this.listenTo(t,i.Events.DISCOVER_BUNDLE,this.dispatchEvent.bind(this,s.DISPLAY_INFO_BUNDLE)),t})},_createIntro:()=>t.createElement("div",{class:"mpf-intro",text:n.get("interestingOffers")}),destroy(){this.stopListening(),this._parent(),this.container=null}});return r.Events=s,r}),define("DS/MPFClickAndBuyComponent/orderList/BodyBundleOffer",["UWA/Class/View","UWA/Core","DS/MPFTracker/Tracker","DS/MPFTracker/Dimension","DS/MPFTracker/Category","DS/MPFServices/MarketplaceServices","DS/UIKIT/Input/Number","DS/UIKIT/Input/Button","DS/MPFCartModel/CartItemModel","DS/MPFCartModel/CartModelHelper","DS/MPFClickAndBuyComponent/ClickAndBuyCartHelper","DS/MPFClickAndBuyComponent/orderList/BodyBundleDetailsOffer","i18n!DS/MPFClickAndBuyComponent/assets/nls/MPFClickAndBuyComponent","css!DS/MPFClickAndBuyComponent/MPFClickAndBuyComponent"],(e,t,i,n,s,r,o,a,c,l,d,h,u)=>{"use strict";const p=Object.freeze({VALUES_CHANGED:"valuesChanged",ITEM_REMOVED:"itemRemoved"}),m=Object.freeze({ITEM_REMOVED:"ItemRemoved",QUANTITY_CHANGED:"QuantityChanged"}),C=e.extend({className:"mpf-bundle-offer",setup(e){e||(e={}),this.locale=e.locale||"en-US",this.cart=e.cart,this.cartItems=e.cartItems,this.removeButton=this._createRemoveButton(),this.quantityInput=this._createQuantityInput(),this.totalPriceContainer=this._getTotalPrice(),this.bundleDetailsView=this._createBundleDetailsView(),this.title=this._createTitle(),this.body=this._createBody(),this.eachRoleQuantityByBundle=this._getEachRoleQuantityByBundle()},render(){return this.bundleDetailsView.render(),this.container.setContent([this.title,this.body]),this},getNewQuantityOffer(){const e=parseInt(this.quantityInput.getValue()),t=parseInt(this.cartItems[0].getOfferQuantity()),i=this.cartItems[0].getOfferId();if(e!==t)return{id:this.cartItems[0].id,quantityOffer:e,quantity:e*this.eachRoleQuantityByBundle,offerId:i}},getTotalPrice(){return this.totalPriceBundle},_createQuantityInput(){return new o({value:parseInt(this.cartItems[0].getOfferQuantity()),min:1,max:this.cartItems[0].isMakerItem()?5:99999,step:1,decimalPrecision:1,disabled:this.cartItems[0].isEduItem(),events:{onChange:this._onValuesChanged.bind(this)}})},_onValuesChanged(){if(t.is(this.quantityInput)){const e=parseInt(this.quantityInput.getValue());if(Number.isNaN(e))this.quantityInput.setValue(this.cartItems[0].getOfferQuantity());else{const t=parseInt(e*this.eachRoleQuantityByBundle),i=e-parseInt(this.cartItems[0].getOfferQuantity())>0?"added":"removed",n=e*this.cartItems.reduce((e,t)=>e+=parseFloat(t.getUnitNetAmount()*this.eachRoleQuantityByBundle),0);this.bundleDetailsView.updateQuantitesAndPrices(t),this.totalPriceContainer=this._getTotalPrice(n),this.title=this._createTitle(),this.render(),this._sendTrackingEvent(m.QUANTITY_CHANGED,i,parseInt(e)),this.dispatchEvent(p.VALUES_CHANGED)}}},_createRemoveButton(){return new a({className:"error",icon:"trash",events:{onClick:this._removeItemFromQuote.bind(this)}})},_removeItemFromQuote(){return this.removeButton.load(!0," "),d.removeItems(this.cart,this.cartItems,!0).then(this._sendTrackingEvent.bind(this,m.ITEM_REMOVED,this.cartItems[0].getProductTrigram())).then(this.dispatchEvent.bind(this,p.ITEM_REMOVED)).finally(this.removeButton.load.bind(this.removeButton,!1))},_createBundleDetailsView(){return new h({locale:this.locale,cartItems:this.cartItems,currency:this.cart.getCurrency()})},_getPricingStructure(){let e,i=this.cartItems[0].getLicensingScheme();return i===c.RevTypes.QRC&&(i=c.RevTypes.QSC),i===c.RevTypes.YSC?e=u.get("yearly"):i===c.RevTypes.QSC?e=u.get("quarterly"):i===c.RevTypes.MSC&&(e=u.get("monthly")),t.createElement("div",{class:"mpf-pricing-structure",html:[t.createElement("div",{text:e}),t.createElement("div",{text:"("+i+")"})]})},_getQuantityInput(){return t.createElement("div",{class:"mpf-quantity",html:this.quantityInput})},_getRemoveButton(){return t.createElement("div",{class:"mpf-remove",html:this.removeButton})},_getTotalPrice(e){this.totalPriceBundle=t.is(e)?e:this.cartItems.reduce((e,t)=>e+=parseFloat(t.getTotalNetAmount()),0);const i=this._getFormattedPrice(this.totalPriceBundle),n=this.cartItems[0].getLicensingScheme();let s;return n===c.RevTypes.YSC?s=u.get("yearlyPrice",{price:i}):n===c.RevTypes.MSC?s=u.get("monthlyPrice",{price:i}):n!==c.RevTypes.QSC&&n!==c.RevTypes.QRC||(s=u.get("quarterlyPrice",{price:i})),t.createElement("div",{class:"mpf-total-price",text:s})},_getUnitPrice(){const e=this.cartItems.reduce((e,t)=>e+=parseFloat(t.getUnitNetAmount()),0),i=this._getFormattedPrice(e),n=this.cartItems[0].getLicensingScheme();let s;return n===c.RevTypes.YSC?s=u.get("yearlyPrice",{price:i}):n===c.RevTypes.MSC?s=u.get("monthlyPrice",{price:i}):n!==c.RevTypes.QSC&&n!==c.RevTypes.QRC||(s=u.get("quarterlyPrice",{price:i})),t.createElement("div",{class:"mpf-unit-price",text:s})},_getBundleTitle(){return t.createElement("div",{class:"mpf-product",html:[t.createElement("div",{class:"mpf-product-title",text:this.cartItems[0].get("title")}),t.createElement("div",{class:"mpf-product-offer-id",text:this.cartItems[0].getExternalOfferId()})]})},_getEachRoleQuantityByBundle(){const e=this.cartItems[0];return parseInt(e.getQuantity())/parseInt(e.getOfferQuantity())},_getFormattedPrice(e){return e.toLocaleString(this.locale,{style:"currency",currency:this.cart.getCurrency(),minimumFractionDigits:e%1==0?0:2,maximumFractionDigits:e%1==0?0:2})},_createBody(){return t.createElement("div",{class:"body",html:this.bundleDetailsView})},_createTitle(){return t.createElement("div",{class:"title",html:[this._getBundleTitle(),this._getPricingStructure(),this._getQuantityInput(),this._getUnitPrice(),this.totalPriceContainer,this._getRemoveButton()]})},destroy(){this.stopListening(),this.cartItems=null,this._parent(),this.container=null},_sendTrackingEvent(e,t,o){const a=i.createEventBuilder({category:s.CART,action:e}).setLabel(t).setValue(o);l.addTrackerInformation(a,this.cart),a.addDimension(n.MARKETPLACE_SERVICE,r.CLICK_AND_BUY).addDimension(n.BUYER_TYPE,"company").send()}});return C.Events=p,C}),define("DS/MPFClickAndBuyComponent/offerList/IconRoleSection",["UWA/Class/View","UWA/Core","DS/UIKIT/Modal","DS/UIKIT/Mask","DS/WebappsUtils/WebappsUtils","DS/MPFServices/ObjectService","DS/MPFPortfolioModel/PortfolioPackModel","DS/MPFClickAndBuyComponent/MarketingPortfolioPage","i18n!DS/MPFClickAndBuyComponent/assets/nls/MPFClickAndBuyComponent","css!DS/MPFClickAndBuyComponent/MPFClickAndBuyComponent"],(e,t,i,n,s,r,o,a,c)=>{"use strict";return e.extend({className:"mpf-icon-role-section",setup(e={}){this._checkPrototypes(e),this.portfolioPack=e.portfolioPack,this.bundleItemsInfo=e.bundleItemsInfo||{},this.title=this._createTitle(),this.bundleItems=Object.keys(this.portfolioPack.getOffers().first().getProducts()),this.icons=this._createIcons()},render(){const e=t.createElement("div",{class:"mpf-icon-list",html:Object.values(this.icons)}),i=[this.title,e];return this.container.setContent(i),this},_displayMarketingModal(e){const i=t.is(document.body.getElement(".mpf-click-and-buy"))?document.body.getElement(".mpf-click-and-buy"):document.body,s=this._createMarketingModal(e);s.inject(i,"top"),s.show(),n.mask(s.getBody());const r=new a({portfolioInfo:e});n.unmask(s.getBody()),s.setBody(r.render())},_createMarketingModal(e){const n=new i({className:"mpf-marketing-offer",header:t.createElement("h4",{text:e.title})});return this.listenTo(n,"onHide",n.destroy.bind(n)),n},_createIconRoleContainer:e=>t.createElement("img",{src:s.getWebappsAssetUrl("i3DXCompass","v3.1/images/role")+"/"+e+"_Role.png"}),_createIcons(){return this.bundleItems.map(e=>{const i=this.bundleItemsInfo[e.split("-")[0]];return t.is(i)?t.createElement("div",{class:"mpf-role-icon",events:{click:this._displayMarketingModal.bind(this,i)},html:[this._createIconRoleContainer(i.brand.toUpperCase()),t.createElement("span",{text:i.title}),t.createElement("div",{class:"mpf-overlay",html:t.createElement("div",{class:"fonticon fonticon-2x fonticon-play"})})]}):""})},_createTitle:()=>t.createElement("div",{class:"mpf-role-title",text:c.get("includedRoles").toUpperCase()}),_checkPrototypes(e){r.requiredOfPrototype(e.portfolioPack,o,"options.portfolioPack must be a PortfolioPackModel")},destroy(){this.stopListening(),this.portfolioPack=null,this._parent(),this.container=null}})}),define("DS/MPFClickAndBuyComponent/orderList/OrderListBodySection",["UWA/Class/View","DS/MPFClickAndBuyComponent/orderList/BodySimpleOffer","DS/MPFClickAndBuyComponent/orderList/BodyBundleOffer","i18n!DS/MPFClickAndBuyComponent/assets/nls/MPFClickAndBuyComponent","css!DS/MPFClickAndBuyComponent/MPFClickAndBuyComponent"],(e,t,i,n)=>{"use strict";const s=Object.freeze({VALUES_CHANGED:"valuesChanged",ITEM_REMOVED:"itemRemoved"}),r=e.extend({className:"mpf-order-list-body-section",setup(e={}){this.locale=e.locale||"en-US",this.offerId=e.offerId,this.cart=e.cart,this.cartItems=e.cartItems,this.offerContainer=this._createOfferContainer()},render(){return this.container.setContent([this.offerContainer.render()]),this},getNewQuantityOffer(){return this.offerContainer.getNewQuantityOffer()},getTotalPrice(){return this.offerContainer.getTotalPrice()},_createOfferContainer(){let e;return 1===this.cartItems.length?(e=new t({locale:this.locale,cart:this.cart,cartItem:this.cartItems[0]}),this.listenTo(e,t.Events.ITEM_REMOVED,this.dispatchEvent.bind(this,s.ITEM_REMOVED)),this.listenTo(e,t.Events.VALUES_CHANGED,this.dispatchEvent.bind(this,s.VALUES_CHANGED))):(e=new i({locale:this.locale,cart:this.cart,cartItems:this.cartItems}),this.listenTo(e,i.Events.ITEM_REMOVED,this.dispatchEvent.bind(this,s.ITEM_REMOVED)),this.listenTo(e,i.Events.VALUES_CHANGED,this.dispatchEvent.bind(this,s.VALUES_CHANGED))),e},destroy(){this.stopListening(),this.cartItems=null,this._parent(),this.container=null}});return r.Events=s,r}),define("DS/MPFClickAndBuyComponent/offerList/OfferListComponent",["UWA/Class/View","DS/MPFView/EmptyView","UWA/Core","DS/UIKIT/Input/Button","DS/UIKIT/Badge","DS/UIKIT/Popover","DS/MPFServices/MarketplaceServices","DS/MPFServices/ObjectService","DS/MPFCountryModel/CountryCollection","DS/MPFCartModel/CartModel","DS/MPFPortfolioModel/PortfolioPackModel","DS/MPFClickAndBuyComponent/offerList/AvailableCountriesComponent","DS/MPFClickAndBuyComponent/offerList/OfferDescriptionComponent","DS/MPFClickAndBuyComponent/offerList/IconRoleSection","DS/MPFClickAndBuyComponent/offerList/OfferListSection","DS/MPFPortfolioModel/PortfolioHelper","i18n!DS/MPFClickAndBuyComponent/assets/nls/MPFClickAndBuyComponent","css!DS/MPFClickAndBuyComponent/MPFClickAndBuyComponent"],(e,t,i,n,s,r,o,a,c,l,d,h,u,p,m,C,f)=>{"use strict";const y=Object.freeze({ADD_TO_CART:"addToCart",BACK:"back",ON_CHANGE_COUNTRY:"onChangeCountry"}),g=e.extend({className:"mpf-offer-list-component",setup(e={}){this._checkPrototypes(e),this.displayBundleViewOnly=!0===e.displayBundleViewOnly,this.portfolioPack=e.portfolioPack,this.cart=e.cart,this.countries=e.countries,this.locale=e.locale||"en-US",this.service=e.service||o.CLICK_AND_BUY,this.roleInfo=e.roleInfo||{},this.bundleItemsInfo=e.bundleItemsInfo||{},this.selectedCountry=e.selectedCountry||"US",this.availableCountriesComponent=this._createAvailableCountriesComponent(),this.needHelpSection=this._createNeedHelpSection(),this.descriptionSection=this._createDescriptionComponent(),this.iconRoleSection=this._createIconRoleSection(),this.offerSection=this._createOfferSection(),this.backButton=this._createBackButton()},render(){const e=[this.availableCountriesComponent.render(),this.needHelpSection,this.descriptionSection.render()];if(this.portfolioPack.isBundle()){const t=this._createEduOrMakersProductMessage();e.push(t),this._createPopover(t)}return e.push(this.iconRoleSection.render()),this.portfolioPack.getOffers().size()>1&&e.push(i.createElement("div",{class:"mpf-select-subs-label",text:f.get("selectSubscriptionPlan").toUpperCase()})),e.push(this.offerSection.render()),e.push(this._createButtonContainer()),this.container.setContent(e),this},_createAvailableCountriesComponent(){const e=this.portfolioPack.getOffers().first(),t=new h({countries:this.countries,selectedCountry:this.selectedCountry,cart:this.cart,isEduOffer:C.isEduOffer(e),isMakerOffer:C.isMakerOffer(e)});return this.listenTo(t,h.Events.ON_CHANGE_COUNTRY,e=>{this.dispatchEvent(y.ON_CHANGE_COUNTRY,{portfolioPack:this.portfolioPack,bundleItemsInfo:this.bundleItemsInfo,selectedCountry:e})}),t},_createNeedHelpSection:()=>i.createElement("div",{class:"mpf-help",html:new n({className:"link",value:f.get("needHelp"),events:{onClick:()=>{window.open("https://www.3ds.com/support/3dexperience-platform-on-cloud-support/support-for-online-purchase/","_blank")}}})}),_createPopover(e){const t=this.portfolioPack.getOffers().first();if(t.get("eligibility")&&t.get("eligibilityToolTip"))return new r({target:e.elements.icon,trigger:"hover",body:t.get("eligibilityToolTip")})},_createIconRoleSection(){return this.portfolioPack.isBundle()?new p({portfolioPack:this.portfolioPack,bundleItemsInfo:this.bundleItemsInfo}):t.getInstance()},_createDescriptionComponent(){return new u({portfolioPack:this.portfolioPack,roleInfo:this.roleInfo})},_createButtonContainer(){return i.createElement("div",{class:"mpf-buttons",html:this.backButton})},_getPortfolioSelection(){return this.offerSection.getSelectedPortfolio()},_createEduOrMakersProductMessage(){let e;const t=this.portfolioPack.getOffers().first();return e=t.get("eligibility")?t.get("eligibility"):C.isEduOffer(t)?f.get("eduIndividualUseMessage"):f.get("makersConsumersUseMessage"),new s({className:"primary mpf-edu-notice",content:e,closable:!1,selectable:!1,icon:t.get("eligibility")&&"info"})},_createOfferSection(){const e=new m({locale:this.locale,isOfferSelectedByDefault:!0,cart:this.cart,portfolioPack:this.portfolioPack});return this.listenTo(e,m.Events.ADD_TO_CART,e=>{this.dispatchEvent(y.ADD_TO_CART,{selectedOffer:e,selectedCountry:this.availableCountriesComponent.getSelectedCountry()})}),e},_createBackButton(){if(this.portfolioPack.isBundle()&&!this.displayBundleViewOnly)return new n({value:f.get("back"),events:{onClick:this.dispatchEvent.bind(this,y.BACK)}})},_checkPrototypes(e){a.requiredOfPrototype(e.portfolioPack,d,"options.portfolioPack must be a PortfolioPackModel"),a.requiredOfPrototype(e.cart,l,"options.cart must be a CartModel"),a.requiredOfPrototype(e.countries,c,"options.countries must be a CountryCollection")},destroy(){this.stopListening(),this.portfolioPack=null,this.cart=null,this.countries=null,this.locale=null,this.service=null,this.offerSection=null,this.backButton=null,this._parent(),this.container=null}});return g.Events=y,g}),define("DS/MPFClickAndBuyComponent/orderList/OrderListBody",["UWA/Class/View","UWA/Core","DS/MPFUtils/MPFUtils","DS/MPFServices/ObjectService","DS/MPFCartModel/CartModel","DS/MPFClickAndBuyComponent/orderList/OrderListBodySection","i18n!DS/MPFClickAndBuyComponent/assets/nls/MPFClickAndBuyComponent","css!DS/MPFClickAndBuyComponent/MPFClickAndBuyComponent"],(e,t,i,n,s,r,o)=>{"use strict";const a=Object.freeze({ORDER_CHANGED:"orderChanged"}),c=e.extend({className:"mpf-order-list-body",setup(e={}){this._checkPrototypes(e),this.cart=e.cart,this.locale=e.locale||"en-US",this.offers=this._groupItemsByOfferId(),this.sections=this._createSections()},render(){const e=this.sections.map(e=>e.render());return this.container.setContent(e),this},getNewQuantityOffers(){var e=[];return this.sections.forEach(i=>{const n=i.getNewQuantityOffer();t.is(n)&&e.push(n)}),e},_deleteSection(e){const t=this.sections.findIndex(t=>t===e);this.sections.splice(t,1),e.destroy()},_computeTotalOrder(){const e=this.sections.reduce((e,t)=>e+=t.getTotalPrice(),0);this.dispatchEvent(a.ORDER_CHANGED,{totalOrder:e})},_groupItemsByOfferId(){var e=[];return this.cart.getItems().forEach(n=>{const s=n.getOfferId();if(""===s)e.push({offerId:s,items:[n]});else{const r=i.findInArray(e,e=>e.offerId===s);t.is(r)?r.items.push(n):e.push({offerId:s,items:[n]})}}),e},_createSections(){return this.offers.map(e=>{const t=new r({locale:this.locale,offerId:e.offerId,cart:this.cart,cartItems:e.items});return this.listenTo(t,r.Events.ITEM_REMOVED,this._deleteSection.bind(this,t)),this.listenTo(t,r.Events.VALUES_CHANGED,this._computeTotalOrder.bind(this)),t})},_checkPrototypes(e){n.requiredOfPrototype(e.cart,s,"options.cart must be a CartModel")},destroy(){this.stopListening(),this.cart=null,this._parent(),this.container=null}});return c.Events=a,c}),define("DS/MPFClickAndBuyComponent/PreReqTableComponent",["UWA/Class/View","UWA/Core","DS/MPFServices/ObjectService","DS/MPFUtils/MPFUtils","DS/MPFCartModel/CartModel","DS/MPFPortfolioModel/PortfolioModel","DS/MPFPortfolioModel/PortfolioHelper","DS/MPFPortfolioModel/LicensingHelper","DS/MPFClickAndBuyComponent/PreReqTableLineComponent","i18n!DS/MPFClickAndBuyComponent/assets/nls/MPFClickAndBuyComponent","css!DS/MPFClickAndBuyComponent/MPFClickAndBuyComponent"],(e,t,i,n,s,r,o,a,c,l)=>{"use strict";return e.extend({tagName:"table",className:"table table-striped mpf-order-table",setup(e={}){this._checkPrototypes(e),this._parent(e),this.locale=e.locale||"en-US",this.selectedPortfolio=e.selectedPortfolio,this.productQuantityAddedToCart=e.productQuantityAddedToCart,this.cart=e.cart,this.preReqs=e.preReqs,this.header=this._createHeader(),this.body=this._createBody()},render(){return this.container.setContent([this.header,this.body]),this},_createHeader(){const e=t.createElement("th"),i=t.createElement("th",{class:"mpf-order-right",text:l.get("unitPriceTaxExcl")}),n=t.createElement("th",{class:"mpf-order-center",text:l.get("quantity")}),s=t.createElement("th",{class:"mpf-order-right",text:l.get("priceTaxExcl")});return t.createElement("thead",{html:t.createElement("tr",{html:[e,i,n,s]})})},_createBody(){const e=this._computeInitialValuePreReq(),i=this.preReqs.map(t=>new c({preReq:t,locale:this.locale,initialQuantity:e,isQuantityInputDisabled:o.isEdu(this.selectedPortfolio.getProductTrigram())}).render());return t.createElement("tbody",{html:i})},_getPreReqListLine(e){return t.createElement("tr",{class:"mpf-item-order",html:this._getPreReqListLineContent(e)})},_computeInitialValuePreReq(){const e=this.cart.getItems(),i=e.filter(e=>!a.isCredit(e.getLicensing())).map(e=>e.getQuantity()),s=0===i.length?0:i.reduce((e,t)=>Math.max(e,t)),r=n.findInArray(e,e=>e.getProductTrigram()===this.selectedPortfolio.getProductTrigram()&&e.getSkuId()===this.selectedPortfolio.get("skuid")),o=t.is(r)?parseInt(r.getQuantity())+this.productQuantityAddedToCart:this.productQuantityAddedToCart;return Math.max(s,o)},_checkPrototypes(e){i.requiredOfPrototype(e.cart,s,"options.cart must be a CartModel"),i.requiredOfPrototype(e.selectedPortfolio,r,"options.selectedPortfolio must be a PortfolioModel")},destroy(){this._parent(),this.container=null}})}),define("DS/MPFClickAndBuyComponent/orderList/OrderList",["UWA/Class/View","UWA/Core","DS/UIKIT/Alert","DS/UIKIT/Input/Button","DS/UIKIT/Mask","DS/MPFTracker/Tracker","DS/MPFTracker/Dimension","DS/MPFTracker/Category","DS/MPFUrl/UrlUtils","DS/MPFServices/ObjectService","DS/MPFServices/MarketplaceServices","DS/MPFCartModel/CartModel","DS/MPFCartModel/CartItemModel","DS/MPFCartModel/CartModelHelper","DS/MPFClickAndBuyComponent/ClickAndBuyCartHelper","DS/MPFClickAndBuyComponent/orderList/OrderListHeader","DS/MPFClickAndBuyComponent/orderList/OrderListBody","DS/MPFModalConfiguratorComponent/CheckoutLauncherFactory","DS/MPFPortfolioModel/LicensingHelper","i18n!DS/MPFClickAndBuyComponent/assets/nls/MPFClickAndBuyComponent","css!DS/MPFClickAndBuyComponent/MPFClickAndBuyComponent"],(e,t,i,n,s,r,o,a,c,l,d,h,u,p,m,C,f,y,g,P)=>{"use strict";const I=Object.freeze({BUY:"buy",ORDER:"order",CHECKOUT:"checkout"}),_=Object.freeze({ADD_ADDITIONAL_ITEMS:"addAdditionalItems",GO_TO_PAYMENT:"goToPayment",REDIRECT_TO_COMPASS:"compassRedirection",CHECKOUT_CLOSED:"checkoutClosed"}),S=Object.freeze({ADD_OTHER_ITEMS:"AddOtherItems",GO_TO_PAYMENT:"GoToPayment"}),E=e.extend({className:"mpf-order-list",setup(e={}){this._checkPrototypes(e),this.service=e.service||d.CLICK_AND_BUY,this.cart=e.cart,this.selectedOffer=e.selectedOffer,this.alert=this._createAlert(),this.title=this._createTitle(),this.header=this._createHeader(),this.body=this._createBody(),this.addItemsButton=this._createAddItemsButton(),this.paymentButton=this._createPaymentButton(),this.total=this._createTotalPrice(),this.listenTo(this.cart,"onChange",this._onOrderChanged.bind(this))},render(){const e=new c(window.location.href),i=t.createElement("div",{class:"mpf-order-list-content",html:[this.header.render(),this.body.render()]}),n=[this.alert,i,this.total];if(this.service===d.SUBSCRIPTIONS&&n.unshift(this.title),this.service===d.CLICK_AND_BUY){const i=t.createElement("div",{class:"mpf-buttons",html:this.cart.hasMakerItems()||e.hasParameter("cartId")?this.paymentButton:[this.paymentButton,this.addItemsButton]});n.push(i)}return this.container.setContent(n),this},getNewQuantities(){return this.body.getNewQuantityOffers()},openCheckout(){const e=document.getElementsByClassName("check-out")[0]||this.container,t=new y({serviceRequest:d.CLICK_AND_BUY,idCart:this.cart.id,container:this.container});return this.listenTo(t,y.Events.PAYMENT_COMPLETED,()=>{window.localStorage.removeItem(h.LOCAL_STORAGE_KEY_COUNTRY),window.localStorage.removeItem(h.LOCAL_STORAGE_KEY),this.dispatchEvent(_.REDIRECT_TO_COMPASS)}),this.listenTo(t,y.Events.PAYMENT_DECLINED,this.dispatchEvent.bind(this,_.CHECKOUT_CLOSED)),this.listenTo(t,y.Events.MODAL_CLOSED,this.dispatchEvent.bind(this,_.CHECKOUT_CLOSED)),s.mask(e),this._patchCartToSubmittedForEduAndMaker().then(t.whenReady.bind(t)).then(()=>{const i=window.location.pathname.split("/"),n=i.filter((e,t)=>i.indexOf(e)===t);if(n[n.length-1]!==I.CHECKOUT){const e=new c(window.location.href).setPath(window.location.pathname+"/"+I.CHECKOUT).deleteParameter("goToPayment").getUrl();try{window.history.pushState(null,null,e)}catch(e){console.warn(e)}}s.unmask(e),t.show()}).catch(t=>{const i=t&&t.response;"Error.EduLicenceLimited"===i.errorCode?this.alert.add({className:"error",message:P.get("eduLicenceAlreadyPurchased")}).show():"Error.EduCartProcessing"===i.errorCode?this.alert.add({className:"error",message:P.get("cartModificationsInProgress")}).show():"Error.PrereqMandatory"===i.errorCode?this.alert.add({className:"error",message:P.get("ifwIsMandatory")}).show():"Error.MakersLicenceLimited"===i.errorCode&&this.alert.add({className:"error",message:P.get("makersLicenceLimited")}).show(),s.unmask(e)})},refreshView(){this.body=this._createBody(),this.total=this._createTotalPrice(),this.render()},_patchCartToSubmittedForEduAndMaker(){return this.cart.hasEduItems()||this.cart.hasMakerItems()?this.cart.savePromise({[h.Fields.STATE]:h.States.SUBMITTED},{patch:!0}):Promise.resolve()},_onOrderChanged(e){this.total=this._createTotalPrice(e.totalOrder),this.render(),0===this.cart.getItems().length&&(this.paymentButton.disable(),window.localStorage.removeItem(h.LOCAL_STORAGE_KEY_COUNTRY),window.localStorage.removeItem(h.LOCAL_STORAGE_KEY),this.dispatchEvent(_.ADD_ADDITIONAL_ITEMS))},_createAddItemsButton(){return new n({value:P.get("addAdditionalItems"),events:{onClick:this._onAddItems.bind(this)}})},_onAddItems(){m.updateQuantityItems(this.cart,this.body.getNewQuantityOffers()),window.localStorage.setItem(h.LOCAL_STORAGE_KEY,JSON.stringify(this.cart.toJSON())),this._sendTrackingEvent(S.ADD_OTHER_ITEMS),this.dispatchEvent(_.ADD_ADDITIONAL_ITEMS)},_createPaymentButton(){return new n({className:"primary",value:P.get("goToPayment"),events:{onClick:this.goToPaymentHandler.bind(this)}})},goToPaymentHandler(){const e=document.getElementsByClassName("check-out")[0]||this.container;return s.mask(e),this.cart.getItems().length>0&&(this.cart.isNew()&&m.updateQuantityItems(this.cart,this.body.getNewQuantityOffers()),window.localStorage.setItem(h.LOCAL_STORAGE_KEY,JSON.stringify(this.cart.toJSON()))),(this.cart.isNew()?m.saveCartAndItems(this.cart):m.updateQuantityItems(this.cart,this.body.getNewQuantityOffers())).then(this.refreshView.bind(this)).then(this._sendTrackingEvent.bind(this,S.GO_TO_PAYMENT)).then(s.unmask.bind(s,e)).then(this.dispatchEvent.bind(this,_.GO_TO_PAYMENT)).catch(s.unmask.bind(s,e))},_createTotalPrice(e){if(this.cart.getCurrency()){const i=this.cart.getItems(),n=i.some(g.isCredit),s=i.length>0?i[0].getLicensingScheme():u.RevTypes.YSC,r=t.is(e)?e:i.reduce((e,t)=>e+=t.getQuantity()*t.getUnitNetAmount(),0),o=r.toLocaleString(this._getLocale(),{style:"currency",currency:this.cart.getCurrency(),minimumFractionDigits:r%1==0?0:2,maximumFractionDigits:r%1==0?0:2}),a=t.createElement("div",{text:P.get("totalSubs")}),c=t.createElement("div",{class:"mpf-total-subsection",html:[t.createElement("div",{class:"mpf-price",text:n?o:s===u.RevTypes.YSC?P.get("yearlyPrice",{price:o}):s===u.RevTypes.MSC?P.get("monthlyPrice",{price:o}):P.get("quarterlyPrice",{price:o})}),t.createElement("div",{text:P.get("exclTax")})]});return t.createElement("div",{class:"mpf-total",html:[a,c]})}},_createAlert:()=>new i({visible:!1,autoHide:!1}),_createTitle:()=>t.createElement("div",{class:"mpf-my-order-title",text:P.get("myOrder")}),_createBody(){const e=new f({locale:this._getLocale(),cart:this.cart});return this.listenTo(e,f.Events.ORDER_CHANGED,this._onOrderChanged.bind(this)),e},_createHeader:()=>new C,_getLocale(){return"EUR"===this.cart.getCurrency()?"fr-FR":"en-US"},_checkPrototypes(e){l.requiredOfPrototype(e.cart,h,"options.cart must be a CartModel")},destroy(){this.stopListening(),this.cart=null,this._parent(),this.container=null},_sendTrackingPage(){const e=r.createPageBuilder({url:"/cart"}).setTitle("Cart");p.addTrackerInformation(e,this.cart),e.addDimension(o.MARKETPLACE_SERVICE,this.service).addDimension(o.BUYER_TYPE,"company").send()},_sendTrackingEvent(e){const t=r.createEventBuilder({category:a.CART,action:e});p.addTrackerInformation(t,this.cart),t.addDimension(o.MARKETPLACE_SERVICE,d.CLICK_AND_BUY).addDimension(o.BUYER_TYPE,"company").send()}});return E.Events=_,E}),define("DS/MPFClickAndBuyComponent/PreReqModal",["UWA/Class/View","UWA/Core","DS/UIKIT/Modal","DS/UIKIT/Input/Button","DS/UIKIT/Mask","DS/MPFTracker/Tracker","DS/MPFTracker/Dimension","DS/MPFServices/ObjectService","DS/MPFCartModel/CartModel","DS/MPFCartModel/CartModelHelper","DS/MPFPortfolioModel/PortfolioModel","DS/MPFPortfolioModel/PortfolioCollection","DS/MPFClickAndBuyComponent/ClickAndBuyCartHelper","DS/MPFClickAndBuyComponent/PreReqMoreInfoSection","DS/MPFClickAndBuyComponent/PreReqTableComponent","DS/MPFServices/MarketplaceServices","i18n!DS/MPFClickAndBuyComponent/assets/nls/MPFClickAndBuyComponent","css!DS/MPFClickAndBuyComponent/MPFClickAndBuyComponent"],(e,t,i,n,s,r,o,a,c,l,d,h,u,p,m,C,f)=>{"use strict";const y=Object.freeze({ON_HIDE:"onHide",PRE_REQ_ADDED:"preReqAdded"}),g=Object.freeze({PREREQUISITE_ADDED:"PrerequisiteAdded"}),P=e.extend({className:"mpf-pre-req-modal",setup(e={}){this._checkPrototypes(e),this._parent(e),this.locale=e.locale||"en-US",this.selectedPortfolio=e.selectedPortfolio,this.productQuantityAddedToCart=t.is(e.productQuantityAddedToCart)?e.productQuantityAddedToCart:1,this.cart=e.cart,this.portfolioDependencies=e.portfolioDependencies,this.selectedCountry=e.selectedCountry,this.preReqs=this._getPreReqs(),this.moreInfoSection=new p({preReqs:this.preReqs}),this.preReqTable=new m({locale:this.locale,selectedPortfolio:this.selectedPortfolio,productQuantityAddedToCart:this.productQuantityAddedToCart,cart:this.cart,preReqs:this.preReqs}),this.modal=this._createModal()},render(){return this.modal.inject(this.container),this},show(){this.modal.show(),this._sendTrackingPage()},_getPreReqs(){return this.portfolioDependencies.map(e=>e.get("productOffers")).flat().filter(e=>e.licensingScheme===this.selectedPortfolio.get("licensingScheme"))},_createModal(){return new i({header:t.createElement("h4",{text:f.get("preReqTitle")}),body:this._createModalBody(),footer:this._createModalFooter(),events:{onHide:()=>{this.dispatchEvent(y.ON_HIDE)}}})},_createModalBody(){return t.createElement("div",{class:"mpf-pre-req-list",html:[t.createElement("div",{class:"table-responsive",html:this.preReqTable.render()}),this.moreInfoSection.render()]})},_createModalFooter(){return new n({className:"primary",value:f.get("ok"),events:{onClick:this._patchCart.bind(this)}})},_patchCart(){let e;if(this.cart.hasEduItems()){const t=this.cart.getItems().map(e=>e.getProductTrigram());e=this.preReqs.filter(e=>-1===t.indexOf(e.productTrigram))}return s.mask(this.modal.getBody()),u.saveSubscriptionAndPreReq(this.cart,this.selectedPortfolio,this.productQuantityAddedToCart,this.cart.hasEduItems()?e:this.preReqs).then(()=>{window.localStorage.setItem(c.LOCAL_STORAGE_KEY_COUNTRY,this.selectedCountry),window.localStorage.setItem(c.LOCAL_STORAGE_KEY,JSON.stringify(this.cart.toJSON()))}).then(this.dispatchEvent.bind(this,y.PRE_REQ_ADDED)).then(this._sendTrackingEvent.bind(this,g.PREREQUISITE_ADDED)).then(this.modal.hide.bind(this.modal)).finally(s.unmask.bind(s,this.modal.getBody()))},_checkPrototypes(e){a.requiredOfPrototype(e.cart,c,"options.cart must be a CartModel"),a.requiredOfPrototype(e.portfolioDependencies,h,"options.portfolioDependencies must be a PortfolioCollection"),a.requiredOfPrototype(e.selectedPortfolio,d,"options.selectedPortfolio must be a PortfolioModel")},destroy(){this.modal.destroy(),this._parent(),this.container=null},_sendTrackingPage(){const e=r.createPageBuilder({url:"/configurator/prerequisite"}).setTitle("Prerequisite").addDimension(o.MARKETPLACE_SERVICE,C.CLICK_AND_BUY);l.addTrackerInformation(e,this.cart),e.addDimension(o.BUYER_TYPE,"company").send()},_sendTrackingEvent(e){const t=r.createEventBuilder({category:"Cart",action:e}).addDimension(o.MARKETPLACE_SERVICE,C.CLICK_AND_BUY);l.addTrackerInformation(t,this.cart),t.addDimension(o.BUYER_TYPE,"company").send()}});return P.Events=y,P}),define("DS/MPFClickAndBuyComponent/ClearCartModal",["UWA/Core","UWA/Class/View","DS/UIKIT/Modal","DS/UIKIT/Input/Button","DS/UIKIT/Alert","DS/MPFServices/ObjectService","DS/MPFCartModel/CartModel","DS/MPFClickAndBuyComponent/ClickAndBuyCartHelper","i18n!DS/MPFClickAndBuyComponent/assets/nls/MPFClickAndBuyComponent"],(e,t,i,n,s,r,o,a,c)=>{"use strict";const l=Object.freeze({ON_CANCEL:"onCancel",ON_ITEMS_DELETED:"onItemsDeleted",ON_HIDE:"onHide"}),d=t.extend({className:"mpf-clear-cart-modal",setup(e={}){r.requiredOfPrototype(e.cart,o,"options.cart must be a CartModel"),this.cart=e.cart,this.submitButton=this._createSubmitButton(),this.cancelButton=this._createCancelButton(),this.alert=this._createAlert(),this.modal=this._createModal(this.submitButton,this.cancelButton)},render(){return this.container.setContent(this.modal),this},show({conflictingItems:e,conflictType:t}){let i,n,s,o;if(r.requiredOfType(e,"array","Expected array of conflicting items as argument"),r.requiredOfType(t,"string","options.conflictType must be a string"),this.conflictingItems=e,t===a.ConflictTypes.EDU_NON_EDU){const e=this._isItemAcOffer(this.conflictingItems[0]);s=c.get(e?"educational":"nonEducational"),o=c.get(e?"nonEducational":"educational"),i=c.get("eduCartConflictMessage",{existingType:s,newType:o}),n=c.get("eduConflictButtonLabel",{existingType:s})}else if(t===a.ConflictTypes.EDU_IN_CART)i=c.get("eduProdAlreadyInCartMsg"),n=c.get("deleteDuplicates");else if(t===a.ConflictTypes.MAKERS_NON_MAKERS){const e=this.conflictingItems[0].isMakerItem();s=c.get(e?"makers":"nonMakers"),o=c.get(e?"nonMakers":"makers"),i=c.get("makersCartConflictMessage",{existingType:s,newType:o}),n=c.get("eduConflictButtonLabel",{existingType:s})}return this.submitButton.setValue(n),this.modal.setBody([this.alert,i]),this.modal.show(),this},hide(){return this.modal.hide(),this},destroy(){this.modal.destroy(),this.cart=null,this._parent(),this.container=null},_setLoading(e=!0){this.submitButton.load(e),this.cancelButton.setDisabled(e)},_isItemAcOffer(e){const t=e.getProductTrigram();return t&&t.endsWith("AC")},_deleteItems(){return this._setLoading(!0),a.removeItems(this.cart,this._getAllItemsFromOffer(this.conflictingItems)).then(()=>{this._setLoading(!1),this.dispatchEvent(l.ON_ITEMS_DELETED),this.hide()}).catch(e=>{this._setLoading(!1),this.alert.add({className:"error",message:c.get("itemDeletionError")}).show()})},_getAllItemsFromOffer(e){const t=[],i=e.map(e=>e.getOfferId());return this.cart.getItems().forEach(e=>{-1!==i.indexOf(e.getOfferId())&&t.push(e)}),t},_createModal(e,t){return new i({header:c.get("eduCartConflictHeader"),footer:[e,t],events:{onHide:this.dispatchEvent.bind(this,l.ON_HIDE)}})},_createAlert:()=>new s({autoHide:!0,visible:!1}),_createSubmitButton(){return new n({className:"primary",events:{onClick:this._deleteItems.bind(this)}})},_createCancelButton(){return new n({value:c.get("cancel"),events:{onClick:()=>{this.dispatchEvent(l.ON_CANCEL),this.hide()}}})}});return d.Events=l,d}),define("DS/MPFClickAndBuyComponent/ClickAndBuyComponent",["UWA/Core","UWA/Class/View","UWA/Promise","DS/MPFView/EmptyView","DS/UIKIT/Mask","DS/UIKIT/Alert","DS/MPFConnector/MarketplaceConnector","DS/MPFServices/MarketplaceServices","DS/MPFServices/ObjectService","DS/MPFModelFactory/MPFFactoriesV2","DS/MPFCountryModel/CountryCollection","DS/MPFCartModel/CartModel","DS/MPFCartModel/CartModelHelper","DS/MPFCartModel/CartPatchArray","DS/MPFCartModel/CartPatchOperation","DS/MPFCartModel/CartFilters","DS/MPFPortfolioModel/PortfolioFactory","DS/MPFPortfolioModel/PortfolioCollection","DS/MPFPortfolioModel/PortfolioPackCollection","DS/MPFPortfolioModel/PortfolioHelper","DS/MPFTenantModel/TenantFactory","DS/MPFFiniteStateMachine/FiniteStateMachine","DS/MPFClickAndBuyComponent/ClicknbuyHeader","DS/MPFClickAndBuyComponent/offerList/OfferListComponent","DS/MPFClickAndBuyComponent/discoverBundle/DiscoverBundleComponent","DS/MPFClickAndBuyComponent/orderList/OrderList","DS/MPFClickAndBuyComponent/ClearCartModal","DS/MPFClickAndBuyComponent/PreReqModal","DS/MPFClickAndBuyComponent/TenantSelectionModal","DS/MPFClickAndBuyComponent/ClickAndBuyCartHelper","DS/MPFClickAndBuyComponent/SubscriptionInformationComponent","DS/MPFUserVerificationComponent/VerificationHandler","DS/MPFSupportChat/SupportChat","DS/MPFTracker/Tracker","DS/MPFTracker/Dimension","DS/MPFTracker/Value","i18n!DS/MPFClickAndBuyComponent/assets/nls/MPFClickAndBuyComponent"],(e,t,i,n,s,r,o,a,c,l,d,h,u,p,m,C,f,y,g,P,I,_,S,E,M,T,D,A,F,O,k,v,b,N,R,B,U)=>{"use strict";const w=Object.freeze({BUY:"buy",ORDER:"order",CHECKOUT:"checkout",CART:"cart"}),L=Object.freeze({SUBSCRIPTION_CHOICE:"subscriptionChoice",QUOTE:"quote",CHECKOUT:"checkout",BUNDLE_OFFER:"bundleOffer"}),x=Object.freeze({ADD_ADDITIONAL_ITEMS:"addAdditionalItems"}),V=Object.freeze({USER_VERIFICATION:"userVerification"}),q=Object.freeze({STUDENT_STATUS_VERIFIED:"studentStatusVerified"}),Q=t.extend({className:"mpf-click-and-buy",setup(e={}){this.displayCartOnly=!0===e.displayCartOnly,this.displayBundleViewOnly=!0===e.displayBundleViewOnly,this._checkPrototypes(e),this._parent(e),this.service=e.service,this.cart=e.cart,this.portfolioPacks=e.portfolioPacks,this.portfolioDependencies=e.portfolioDependencies,this.roleInfo=e.roleInfo||{},this.bundleItemsInfo=e.bundleItemsInfo||{},this.tenantFactory=e.tenantFactory,this.countries=e.countries,this.selectedCountry=e.selectedCountry,this.stateMachine=this._createStateMachine(),this.header=this._createHeader(),this.subscriptionInfo=this._createSubscriptionInfo(),this.displayCartOnly||this.displayBundleViewOnly||(this.subscriptionsComponent=this._createSubscriptionComponent(),this.bundleComponent=this._createBundleComponent()),this.stateMachine.getState()!==L.QUOTE&&this.stateMachine.getState()!==L.CHECKOUT||(this.myOrderComponent=this._createMyOrderComponent()),b.run({authorizedPaths:[/\/compass-world\/3dexperience-collaborative-innovation\/collaborative-business-innovator/,/\/compass-world\/3dexperience-collaborative-innovation\/project-planner/,/\/compass-world\/3dexperience-collaborative-innovation\/3d-creator/,/\/compass-world\/3dexperience-collaborative-innovation\/3d-sculptor/,/\/compass-world\/3dexperience-collaborative-innovation\/3d-innovator/],deniedPaths:[/\/offers\//]})},render(){const e=this.stateMachine.getState();return e===L.SUBSCRIPTION_CHOICE?this.container.setContent([this.header.render(),{tag:"div",class:"mpf-cab-main-panel",html:[this.subscriptionsComponent.render(),this.bundleComponent.render()]},this.subscriptionInfo.render({portfolioPack:this.portfolioPacks.getStandardOffer()})]):e===L.QUOTE||e===L.CHECKOUT?(this.header.update(U.get("myCart"),!1),this.container.setContent([this.header.render(),this.myOrderComponent.render()]),window.location.href.contains("goToPayment=true")&&this.myOrderComponent.goToPaymentHandler()):e===L.BUNDLE_OFFER&&this._displayBundleView({bundle:this.portfolioPacks.first(),bundleItemsInfo:this.bundleItemsInfo}),this._scrollToTheTop(),this},_scrollToTheTop(){const t=document.getElementsByClassName("check-out")[0];if(e.is(t)){const i=t.closest(".scroller-content");e.is(i)&&i.scrollTo({top:0,left:0,behavior:"smooth"})}},_createHeader(){const e=this.displayCartOnly?{displayCartOnly:this.displayCartOnly}:{portfolioPack:this.portfolioPacks.getStandardOffer()||this.portfolioPacks.first(),roleInfo:this.roleInfo};return new S(e)},destroy(){this.stopListening(),this.subscriptionsComponent.destroy(),this.cart=null,this.portfolioPacks=null,this.portfolioDependencies=null,this._parent(),this.container=null},_checkCartReliability({selectedOffer:e,selectedCountry:t}){const{conflictingItems:i,conflictType:n}=O.getConflictingItems(this.cart,e.portfolio);if(i.length>0){const e=new D({cart:this.cart});this.listenTo(e,D.Events.ON_ITEMS_DELETED,()=>{this._displayPreReqModal(...arguments)}),this.listenTo(e,D.Events.ON_CANCEL,()=>{this.dispatchEvent(x.ADD_ADDITIONAL_ITEMS)}),this.listenTo(e,D.Events.ON_HIDE,()=>{this.stopListening(e),e.destroy()}),e.render().inject(this.container).show({conflictingItems:i,conflictType:n})}else if(this._hasMakerItemsExceededLimit(e)){const e=U.get("makerItemLimit",{nb:parseInt(this.cart.getItems()[0].getOfferQuantity())});this._displayUikitAlert(e,document.getElementsByClassName("mpf-offer-list-section")[0])}else this._displayPreReqModal(...arguments)},_hasMakerItemsExceededLimit(e){return!!this.cart.hasMakerItems()&&e.quantity+parseInt(this.cart.getItems()[0].getOfferQuantity())>5},_displayPreReqModal({selectedOffer:e,selectedCountry:t}){if(0===this.portfolioDependencies.length||e.portfolio.isBundleOffer()){const i=document.body.getElementsByClassName("check-out")[0],n=e.portfolio.isBundleOffer()?O.addOffer(this.cart,e.portfolio,e.quantity):O.saveSubscriptionAndPreReq(this.cart,e.portfolio,e.quantity,[]);return s.mask(i),n.then(()=>{window.localStorage.setItem(h.LOCAL_STORAGE_KEY_COUNTRY,t),window.localStorage.setItem(h.LOCAL_STORAGE_KEY,JSON.stringify(this.cart.toJSON()))}).then(this._displayQuoteView.bind(this,e)).finally(s.unmask.bind(s,i))}{const i=new A({locale:this._getLocale(),cart:this.cart,selectedPortfolio:e.portfolio,portfolioDependencies:this.portfolioDependencies,productQuantityAddedToCart:e.quantity,selectedCountry:t});return i.render().inject(this.container),i.show(),this.listenTo(i,A.Events.ON_HIDE,i.destroy.bind(i)),this.listenTo(i,A.Events.PRE_REQ_ADDED,this._displayQuoteView.bind(this,e)),i}},_displayTenantSelectionModal(e){const t=new F({platforms:e,cart:this.cart});return t.render().inject(this.container),t.show(),this.listenTo(t,F.Events.ON_HIDE,()=>{this.myOrderComponent.refreshView(),t.destroy()}),this.listenTo(t,F.Events.CONTINUE,this._selectPlatform.bind(this)),t},_selectPlatform(t){const i={};if(e.is(t.selectedPlatform)&&"new"!==t.selectedPlatform){i[h.Fields.ONLINE_INSTANCE]=t.selectedPlatform,i[h.Fields.STATE]=h.States.SUBMITTED;const e=new m(m.Operations.MODIFY,"/",i),n=new p;n.add(e),this.cart.megaPatch(n).then(()=>{this.myOrderComponent.openCheckout(),this.stateMachine.changeState(L.CHECKOUT),this._sendTrackerPage(window.location.pathname,L.CHECKOUT)}).catch(e=>{console.log(e)})}else this.myOrderComponent.openCheckout(),this.stateMachine.changeState(L.CHECKOUT),this._sendTrackerPage(window.location.pathname,L.CHECKOUT)},_displayQuoteView(e){this.stateMachine.changeState(L.QUOTE),this.myOrderComponent=this._createMyOrderComponent(e);try{window.history.pushState(null,null,window.location.pathname+"/"+w.ORDER+window.location.search)}catch(e){console.warn(e)}this._sendTrackerPage(window.location.pathname,L.QUOTE),this.render()},_goToPayment(){const e=this;this.cart.hasEduItems()?this._verifyStudentStatus({onComplete:()=>{const t=N.createEventBuilder({category:V.USER_VERIFICATION,action:q.STUDENT_STATUS_VERIFIED}).addDimension(R.MARKETPLACE_SERVICE,this.service);u.addTrackerInformation(t,this.cart),t.send(),e.myOrderComponent.openCheckout(),e.stateMachine.changeState(L.CHECKOUT),e._sendTrackerPage(window.location.pathname,L.CHECKOUT)}}):this.cart.hasMakerItems()?(this.myOrderComponent.openCheckout(),this.stateMachine.changeState(L.CHECKOUT),this._sendTrackerPage(window.location.pathname,L.CHECKOUT)):this._getUserDataAndDisplayTenantSelectionModal()},_verifyStudentStatus({onComplete:e}){v.verifyUser({onComplete:e,container:this.container})},_getUserDataAndDisplayTenantSelectionModal(){const e=document.getElementsByClassName("check-out")[0]||this.container;return s.mask(e),this.tenants=this.tenantFactory.createCollection(I.Types.TENANTS),this.tenants.setParentResourceId(this.cart.id),this.tenants.fetchPromise().then(()=>{const e=this.tenants.filter(e=>!e.isPublic());e.length>0?this._displayTenantSelectionModal(e):this._isIFWInCart()?(this.myOrderComponent.openCheckout(),this.stateMachine.changeState(L.CHECKOUT),this._sendTrackerPage(window.location.pathname,L.CHECKOUT)):this._displayUikitAlert(U.get("noIfwInCart"),this.container)}).catch(this._displayUikitAlert.bind(this,U.get("errorGettingPlatforms"),this.container)).finally(s.unmask.bind(s,e))},_displayUikitAlert(e,t){new r({className:"error",messageClassName:"error",messages:e,closable:!0,visible:!0,closeOnClick:!0}).inject(t,"top")},_isIFWInCart(){return this.cart.getItems().some(e=>e.getProductTrigram().startsWith("IFW-"))},_createMyOrderComponent(e){const t=new T({cart:this.cart,selectedOffer:e});return this.listenTo(t,T.Events.ADD_ADDITIONAL_ITEMS,()=>{try{window.history.pushState(null,null,window.location.href.replace(/\/order/,""))}catch(e){console.warn(e)}this.dispatchEvent(x.ADD_ADDITIONAL_ITEMS)}),this.listenTo(t,T.Events.GO_TO_PAYMENT,this._goToPayment.bind(this)),this.listenTo(t,T.Events.REDIRECT_TO_COMPASS,()=>{try{window.history.pushState(null,null,window.location.href.replace(/\/order\/checkout/,""))}catch(e){console.warn(e)}this.dispatchEvent(x.ADD_ADDITIONAL_ITEMS)}),this.listenTo(t,T.Events.CHECKOUT_CLOSED,()=>{const e=document.getElementsByClassName("check-out")[0]||this.container;s.mask(e),this.cart.fetchPromise({expand:[h.Expands.CART_ITEMS]}).then(this.myOrderComponent.refreshView.bind(this.myOrderComponent)).finally(s.unmask.bind(s,e)),this.stateMachine.changeState(L.QUOTE),this._sendTrackerPage(window.location.pathname,L.QUOTE);try{window.history.pushState(null,null,window.location.href.replace(/\/checkout/,""))}catch(e){console.warn(e)}}),t},_updateOffersWithNewCountry({portfolioPack:e,bundleItemsInfo:t,selectedCountry:n}){const r=document.getElementsByClassName("check-out")[0]||this.container,o=[this.portfolioPacks.fetchPromise({country:n}),0===this.portfolioDependencies.size()?i.resolve(this.portfolioDependencies):this.portfolioDependencies.fetchPromise({country:n})];return s.mask(r),i.all(o).then(()=>{window.localStorage.setItem("mpOfferCountry",n),this.selectedCountry=n;const i=this.portfolioPacks.first(),s=i.getOffers().first();if(this.cart.set(h.Fields.CURRENCY,s.getPricelistCurrency()),this.cart.set("licensorId",s.getLicensorId()||i.getLicensorId()),this.displayCartOnly||this.displayBundleViewOnly)this.render();else if(this.subscriptionsComponent=this._createSubscriptionComponent(),this.bundleComponent=this._createBundleComponent(),this.stateMachine.getState()===L.BUNDLE_OFFER){const i=this.portfolioPacks.find(t=>t.getDisplayName()===e.getDisplayName());this._displayBundleView({bundle:i,bundleItemsInfo:t})}else this.render()}).finally(s.unmask.bind(s,r))},_displayBundleView({bundle:e,bundleItemsInfo:t}){const i=new S({portfolioPack:e,roleInfo:this.roleInfo}),n=new E({displayBundleViewOnly:this.displayBundleViewOnly,locale:this._getLocale(),cart:this.cart,countries:this.countries,portfolioPack:e,bundleItemsInfo:t,selectedCountry:this.selectedCountry});this.listenTo(n,E.Events.ADD_TO_CART,this._checkCartReliability.bind(this)),this.listenTo(n,E.Events.ON_CHANGE_COUNTRY,this._updateOffersWithNewCountry.bind(this)),this.listenTo(n,E.Events.BACK,()=>{this.stateMachine.changeState(L.SUBSCRIPTION_CHOICE),this.render(),n.destroy(),i.destroy()});const s=[i.render(),{tag:"div",class:"mpf-cab-main-panel",html:n.render()},this.subscriptionInfo.render({portfolioPack:e})];this.container.setContent(s),this._scrollToTheTop()},_createSubscriptionComponent(){const e=new E({locale:this._getLocale(),cart:this.cart,countries:this.countries,portfolioPack:this.portfolioPacks.getStandardOffer(),roleInfo:this.roleInfo,selectedCountry:this.selectedCountry});return this.listenTo(e,E.Events.ADD_TO_CART,this._checkCartReliability.bind(this)),this.listenTo(e,E.Events.ON_CHANGE_COUNTRY,this._updateOffersWithNewCountry.bind(this)),e},_createBundleComponent(){let e;return this.portfolioPacks.hasBundles()?(e=new M({locale:this._getLocale(),bundles:this.portfolioPacks.getBundles()}),this.listenTo(e,M.Events.DISPLAY_INFO_BUNDLE,e=>{this.stateMachine.changeState(L.BUNDLE_OFFER),this._displayBundleView(e)})):e=n.getInstance(),e},_createSubscriptionInfo:()=>new k,_getLocale(){if(this.displayCartOnly)return"EUR"===this.cart.getCurrency()?"fr-FR":"en-US";return"EUR"===this.portfolioPacks.first().getOffers().first().getPricelistCurrency()?"fr-FR":"en-US"},_createStateMachine(){let e;const t=window.location.pathname.split("/"),i=t.filter((e,i)=>t.indexOf(e)===i),n=i[i.length-1>=0?i.length-1:0];return e=this.displayCartOnly||n===w.ORDER||n===w.CART?L.QUOTE:n===w.CHECKOUT?L.CHECKOUT:this.displayBundleViewOnly?L.BUNDLE_OFFER:L.SUBSCRIPTION_CHOICE,this._sendTrackerPage(window.location.pathname,e),new _({state:e,states:[L.SUBSCRIPTION_CHOICE,L.QUOTE,L.CHECKOUT,L.BUNDLE_OFFER],transitions:[{from:L.SUBSCRIPTION_CHOICE,to:L.QUOTE},{from:L.SUBSCRIPTION_CHOICE,to:L.BUNDLE_OFFER},{from:L.BUNDLE_OFFER,to:L.SUBSCRIPTION_CHOICE},{from:L.QUOTE,to:L.CHECKOUT},{from:L.CHECKOUT,to:L.QUOTE},{from:L.BUNDLE_OFFER,to:L.QUOTE}]})},_sendTrackerPage(e,t){const i=N.createPageBuilder({url:e}).setTitle(t).addDimension(R.MARKETPLACE_SERVICE,this.service);u.addTrackerInformation(i,this.cart),i.send()},_checkPrototypes(e){c.requiredOfPrototype(e.cart,h,"options.cart must be a CartModel"),c.requiredOfPrototype(e.tenantFactory,I,"options.tenantFactory must be a TenantFactory"),c.requiredOfPrototype(e.countries,d,"options.countries must be a CountryCollection"),this.displayCartOnly||(c.requiredOfPrototype(e.portfolioDependencies,y,"options.portfolioDependencies must be a PortfolioCollection"),c.requiredOfPrototype(e.portfolioPacks,g,"options.portfolioPacks must be a PortfolioPackCollection"))}});return Q.isAuthorizedToBuy=function(e){return o.fetchPromise({service:a.CLICK_AND_BUY}).then(function(e){return l.getInstance(e).getFactory(l.Types.PORTFOLIO)}).then(function(t){const i=t.createModel(f.Types.PRODUCT);return i.productTrigram=e,i.fetchPromise()}).then(function(e){return e.isBuyable()})},Q.Events=x,Q.LOCAL_STORAGE_KEY_MP_OFFER_COUNTRY="mpOfferCountry",Q}),define("DS/MPFClickAndBuyComponent/ClickAndBuyWrapper",["UWA/Core","UWA/Class","UWA/Promise","DS/MPFCompassPlatformServices/CompassPlatformServices","DS/MPFUtils/MPFUtils","DS/MPFUrl/UrlUtils","DS/MPFServices/MarketplaceServices","DS/MPFConnector/MarketplaceConnector","DS/MPFModelFactory/MPFFactoriesV2","DS/MPFCartModel/CartFactory","DS/MPFCountryModel/CountryFactory","DS/MPFPersonModel/PersonFactory","DS/MPFPortfolioModel/PortfolioFactory","DS/MPFCartModel/CartModel","DS/MPFCartModel/CartFilters","DS/MPFClickAndBuyComponent/ClickAndBuyComponent","DS/MPFClickAndBuyComponent/MaintenancePage","DS/MPFPortfolioModel/PortfolioHelper"],(e,t,i,n,s,r,o,a,c,l,d,h,u,p,m,C,f,y)=>{"use strict";const g=Object.freeze({PRODUCTS_NOT_AUTHORIZED:"productNotAuthorized"}),P=t.extend({init(e={}){this.productTrigram=Array.isArray(e.product)?y.findTrigramInArray(e.product):e.product,this.isProductSearchByUrl=this._isProductSearchByUrl(),this.isCartSearchByUrl=this._isCartSearchByUrl(),this._removeMyAppsHeader()},_isCartSearchByUrl:()=>new r(window.location.href).hasParameter("cartId"),_isProductSearchByUrl(){const e=new r(window.location.href).getPath().split("/"),t=e.filter((t,i)=>e.indexOf(t)===i),i=t.includes("offers"),n=t.findIndex(e=>"offers"===e);return this.currentBundleOfferName=i?t[n+1]:"",i},_isBundleOnly(){return this.portfolioPacks.constainsOnlyBundleOffers()},_removeMyAppsHeader(){const e=document.body.getElementsByClassName("check-out-header"),t=document.body.getElementsByClassName("content-overlay");if(e.length>0&&e[0].setStyle("display","none"),t.forEach(e=>{e.addClassName("mpf-expand")}),this.isProductSearchByUrl||this.isCartSearchByUrl){const e=document.getElementById("container-scroll");if(t.length>0){const e=t[t.length-1].getElementsByClassName("content-overlay-header");e[0]&&e[0].setStyle("display","none")}e&&e.addClassName("mpf-expand")}},createComponent(){return a.fetchPromise({service:o.CLICK_AND_BUY}).then(this._getFactories.bind(this)).then(()=>i.all([this._getMe(),this._getOpenedCountries()])).then(()=>{window.localStorage.getItem(p.LOCAL_STORAGE_KEY_COUNTRY)?this.selectedCountry=window.localStorage.getItem(p.LOCAL_STORAGE_KEY_COUNTRY):window.localStorage.getItem(C.LOCAL_STORAGE_KEY_MP_OFFER_COUNTRY)?this.selectedCountry=window.localStorage.getItem(C.LOCAL_STORAGE_KEY_MP_OFFER_COUNTRY):this.me.hasCountry()&&this.countries.some(e=>e.getIso2()===this.me.getCountry())?this.selectedCountry=this.me.getCountry():this.selectedCountry="US",window.localStorage.setItem(C.LOCAL_STORAGE_KEY_MP_OFFER_COUNTRY,this.selectedCountry)}).then(()=>Promise.all([this._getPortfolioPacks(),this._getPortfolioDependencies()])).then(this._createCart.bind(this)).then(this._getRoleDescription.bind(this)).then(this._createClickAndBuyComponent.bind(this)).catch(e=>(console.error(e),new f))},_getMe(){const e=i.deferred();return this.me=this.personFactory.createModel(h.Types.ME),this.me.fetch({onComplete:e.resolve,onFailure:e.reject,onPassportError:(t,i)=>{console.error(t),e.resolve()}}),e.promise},_getRoleDescription(){if(this.isProductSearchByUrl||this._isBundleOnly()){return this.portfolioPacks.first().fetchBundleItemsInfo().then(e=>{this.bundleItemsInfo=e}).catch(e=>{console.warn(e)})}{const e=this.portfolioPacks.getStandardOffer().getOffers().first().getProductTrigram();return y.getPortfolioRoleFromCompass(e.split("-")[0]).then(e=>{this.roleInfo=e})}},_getFactories(e){const t=c.getInstance(e);return i.all([t.getFactory(c.Types.CART),t.getFactory(c.Types.PORTFOLIO),t.getFactory(c.Types.TENANT),t.getFactory(c.Types.COUNTRY),t.getFactory(c.Types.PERSON)]).then(e=>{this.cartFactory=e[0],this.portfolioFactory=e[1],this.tenantFactory=e[2],this.countryFactory=e[3],this.personFactory=e[4]})},_getPortfolioPacks(){const e=this.isProductSearchByUrl?u.Types.BY_NAME:u.Types.BY_TRIGRAM_V2;return this.portfolioPacks=this.portfolioFactory.createPackCollection(e),this.isProductSearchByUrl?this.portfolioPacks.searchName=this.currentBundleOfferName:this.portfolioPacks.productTrigram=y.addProductSuffix(this.productTrigram),this.portfolioPacks.fetchPromise({country:this.selectedCountry,onPassportError:function(e,t){const i=window.location.origin+window.location.pathname+window.location.hash;console.error(e),window.location.href=t.replace("/logout","")+"/login?service="+encodeURIComponent(i)}}).catch(e=>(403===e.options.request.xhr.status&&this.dispatchEvent(g.PRODUCTS_NOT_AUTHORIZED),i.reject()))},_getOpenedCountries(){return this.countries=this.countryFactory.createCollection(d.Types.SP_PUBLIC_OPENED_COUNTRIES),this.countries.fetchPromise()},_getPortfolioDependencies(){return this.portfolioDependencies=this.portfolioFactory.createCollection(u.Types.PRODUCT_DEPENDENCIES),this.isProductSearchByUrl?i.resolve(this.portfolioDependencies):(this.portfolioDependencies.productTrigram=y.addProductSuffix(this.productTrigram),this.portfolioDependencies.fetchPromise({country:this.selectedCountry}))},_createCart(){const e=new r(window.location.href);if(e.hasParameter("cartId"))return this.cart=this.cartFactory.createModel(l.Types.CART,{id:e.getValueParameter("cartId")}),this.cart.fetchPromise({expand:[p.Expands.CART_ITEMS]});{const e=this.portfolioPacks.first(),t=e.getOffers().first();if(this.cart=this.cartFactory.createModel(l.Types.ME),window.localStorage.getItem(p.LOCAL_STORAGE_KEY)){const e=this.cart.parse(JSON.parse(window.localStorage.getItem(p.LOCAL_STORAGE_KEY)));this.cart.set(e)}else this.cart.set(p.Fields.ONLINE_INSTANCE,""),this.cart.set(p.Fields.CURRENCY,t.getPricelistCurrency()),this.cart.set("legalEntityId",t.getCompanyId()),this.cart.set(p.Fields.STATE,p.States.DRAFT),this.cart.set("type",p.Types.SOFTWARE_REQUEST),this.cart.set("licensorId",t.getLicensorId()||e.getLicensorId()),this.cart.set("isSelfOrder",!0);return this.cart.unset("id"),i.resolve(this.cart)}},_createClickAndBuyComponent(){const e={};return e.service=o.CLICK_AND_BUY,e.displayBundleViewOnly=this.isProductSearchByUrl||this._isBundleOnly(),e.cart=this.cart,e.portfolioDependencies=this.portfolioDependencies,e.portfolioPacks=this.portfolioPacks,e.roleInfo=this.roleInfo,e.bundleItemsInfo=this.bundleItemsInfo,e.tenantFactory=this.tenantFactory,e.countries=this.countries,e.selectedCountry=this.selectedCountry,new C(e)}});return P.Events=g,P.getClickAndBuyComponent=function(e){return new P(e).createComponent()},P.isAuthorizedToBuy=C.isAuthorizedToBuy,P});