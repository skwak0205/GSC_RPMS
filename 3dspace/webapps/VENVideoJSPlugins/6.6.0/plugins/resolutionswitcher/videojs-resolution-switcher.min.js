/*! videojs-resolution-switcher - 2015-7-26
 * Copyright (c) 2016 Kasper Moskwiak
 * Modified by Pierre Kraft and Derk-Jan Hartman
 * Licensed under the Apache-2.0 license. */
!function(){"use strict";var e=null;e=void 0===window.videojs&&"function"==typeof require?require("video.js"):window.videojs,function(e,t){var r,l={ui:!0},n=t.getComponent("MenuItem"),s=t.extend(n,{constructor:function(e,r){r.selectable=!0,n.call(this,e,r),this.src=r.src,e.on("resolutionchange",t.bind(this,this.update))}});s.prototype.handleClick=function(e){n.prototype.handleClick.call(this,e),this.player_.currentResolution(this.options_.label)},s.prototype.update=function(){var e=this.player_.currentResolution();this.selected(this.options_.label===e.label)},n.registerComponent("ResolutionMenuItem",s);var o=t.getComponent("MenuButton"),i=t.extend(o,{constructor:function(e,r){if(this.label=document.createElement("span"),r.label="Quality",o.call(this,e,r),this.el().setAttribute("aria-label","Quality"),this.controlText("Quality"),r.dynamicLabel)t.addClass(this.label,"vjs-resolution-button-label"),t.addClass(this.el(),"vjs-resolution-dynamicLabel"),this.el().appendChild(this.label);else{var l=document.createElement("span");t.addClass(l,"vjs-menu-icon"),this.el().appendChild(l)}e.on("updateSources",t.bind(this,this.update))}});i.prototype.createMenu=function(){return this.options_.title="Quality",o.prototype.createMenu.call(this)},i.prototype.createItems=function(){var e=[],t=this.sources&&this.sources.label||{};for(var r in t)t.hasOwnProperty(r)&&e.push(new s(this.player_,{label:r,src:t[r],selected:r===(!!this.currentSelection&&this.currentSelection.label)}));return e},i.prototype.update=function(){return this.sources=this.player_.getGroupedSrc(),this.currentSelection=this.player_.currentResolution(),this.label.innerHTML=this.currentSelection?this.currentSelection.label:"",o.prototype.update.call(this)},i.prototype.buildCSSClass=function(){return o.prototype.buildCSSClass.call(this)+" vjs-resolution-button"},o.registerComponent("ResolutionMenuButton",i),r=function(e){var r=t.mergeOptions(l,e),n=this;function s(e,t){return e.res&&t.res?+t.res-+e.res:0}function o(e){var t={label:{},res:{},type:{}};return e.map(function(e){u(t,"label",e),u(t,"res",e),u(t,"type",e),a(t,"label",e),a(t,"res",e),a(t,"type",e)}),t}function u(e,t,r){null==e[t][r[t]]&&(e[t][r[t]]=[])}function a(e,t,r){e[t][r[t]].push(r)}n.updateSrc=function(e){if(!e)return n.src();e=e.filter(function(e){try{return""!==n.canPlayType(e.type)}catch(e){return!0}}),this.currentSources=e.sort(s),this.groupedSrc=o(this.currentSources);var t=function(e,t){var l=r.default,n="";"high"===l?(l=t[0].res,n=t[0].label):"low"!==l&&null!=l&&e.res[l]?e.res[l]&&(n=e.res[l][0].label):(l=t[t.length-1].res,n=t[t.length-1].label);return{res:l,label:n,sources:e.res[l]}}(this.groupedSrc,this.currentSources);return this.currentResolutionState={label:t.label,sources:t.sources},n.trigger("updateSources"),n.setSourcesSanitized(t.sources,t.label),n.trigger("resolutionchange"),n},n.currentResolution=function(t,l){if(null==t)return this.currentResolutionState;if(this.groupedSrc&&this.groupedSrc.label&&this.groupedSrc.label[t]){var s=this.groupedSrc.label[t],o=n.currentTime(),i=n.paused();if(!i&&this.player_.options_.bigPlayButton&&this.player_.bigPlayButton.hide(),e.dynamicLabel){var u=this.player_.el_.getElementsByClassName("vjs-resolution-button-label");u&&u[0]&&(u[0].innerHTML=t)}var a="loadeddata";return"Youtube"!==this.player_.techName_&&"none"===this.player_.preload()&&"Flash"!==this.player_.techName_&&(a="timeupdate"),n.setSourcesSanitized(s,t,l||r.customSourcePicker).one(a,function(){n.currentTime(o),n.handleTechSeeked_(),i||n.play()&&n.play().then(function(){n.handleTechSeeked_()}),n.trigger("resolutionchange")}),n}},n.getGroupedSrc=function(){return this.groupedSrc},n.setSourcesSanitized=function(e,t,r){return this.currentResolutionState={label:t,sources:e},"function"==typeof r?r(n,e,t):(n.src(e.map(function(e){return{src:e.src,type:e.type,res:e.res}})),n)},n.ready(function(){if(r.ui){var e=new i(n,r);n.controlBar.resolutionSwitcher=n.controlBar.el_.insertBefore(e.el_,n.controlBar.getChild("fullscreenToggle").el_),n.controlBar.resolutionSwitcher.dispose=function(){this.parentNode.removeChild(this)}}var t,l,s;n.options_.sources.length>1&&n.updateSrc(n.options_.sources),"Youtube"===n.techName_&&(t=n,l={highres:{res:1080,label:"1080",yt:"highres"},hd1080:{res:1080,label:"1080",yt:"hd1080"},hd720:{res:720,label:"720",yt:"hd720"},large:{res:480,label:"480",yt:"large"},medium:{res:360,label:"360",yt:"medium"},small:{res:240,label:"240",yt:"small"},tiny:{res:144,label:"144",yt:"tiny"},auto:{res:0,label:"auto",yt:"auto"}},s=function(e,r,l){return t.tech_.ytPlayer.setPlaybackQuality(r[0]._yt),t.trigger("updateSources"),t},r.customSourcePicker=s,t.tech_.ytPlayer.setPlaybackQuality("auto"),t.tech_.ytPlayer.addEventListener("onPlaybackQualityChange",function(e){for(var r in l)if(r.yt===e.data)return void t.currentResolution(r.label,s)}),t.one("play",function(){var e=[];t.tech_.ytPlayer.getAvailableQualityLevels().map(function(r){e.push({src:t.src().src,type:t.src().type,label:l[r].label,res:l[r].res,_yt:l[r].yt})}),t.groupedSrc=o(e);var r={label:"auto",res:0,sources:t.groupedSrc.label.auto};this.currentResolutionState={label:r.label,sources:r.sources},t.trigger("updateSources"),t.setSourcesSanitized(r.sources,r.label,s)}))})},t.plugin("videoJsResolutionSwitcher",r)}(window,e)}();
