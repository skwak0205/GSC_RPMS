define("DS/DocumentCommands/V2/Actions/Maturity",["UWA/Core","UWA/Promise","i18n!DS/DocumentCommands/assets/nls/DocumentCommands"],function(e,t,n){"use strict";var o=function(e){return{id:"Maturity",dataElements:{docV2Public:!0,typeRepresentation:"functionIcon",icon:{iconName:"collaborative-lifecycle-management",fontIconFamily:1},tooltip:n.get("Maturity"),label:n.get("Maturity"),position:"far",category:"lifecycle",value:function(t){t.options=e,o.execute(t)},visibleFlag:!1},execute:function(){o.execute({options:e})},updateForSelection:function(n,o){return new t(function(t){n({visibleFlag:e.getSelectedNodes().length>0}),t(!0)})}}};return o.execute=function(t){var n=t.options.getSelectedNodes(),o={securitycontext:t.options.fetchSecurityContext(),context:{getUUID:function(){return t.options.getOrigin?JSON.stringify(e.extend(t.options.getOrigin(),{action:"maturity"})):"docv2.maturity."+Date.now()}}};require(["DS/LifecycleCmd/MaturityCmd"],function(e){new e(o).executeAsync(n.map(function(e){var n=t.options.getDocumentFromNodeModel(e),o=void 0;n.collabSpaceTitle?o=n.collabSpaceTitle:n.dataelements&&(o=n.dataelements.collabSpaceTitle);var i=void 0;return n.organizationTitle?i=n.organizationTitle:n.dataelements&&(i=n.dataelements.organizationTitle),{physicalid:n.id,organizationTitle:i,collabSpaceTitle:o,serviceurl:t.options.platformUrls["3DSpace"]+"/resources/lifecycle/maturity/"}})).then(function(e,o,i){n.forEach(function(e){t.options.events.publish({event:"docv2-maturity-complete",data:{nodeModel:e}})})})})},o}),define("DS/DocumentCommands/DOCMClipboard",["UWA/Core","UWA/Promise","DS/WAFData/WAFData","DS/Core/ModelEvents","DS/Notifications/NotificationsManagerUXMessages","DS/Notifications/NotificationsManagerViewOnScreen"],function(e,t,n,o,i,a){"use strict";return{events:new o,contentCopied:!1,copy:function(e){window.docmClipboard=e,this.contentCopied=!0,this.events.publish({event:"x3dcontent-copied",data:{cancelled:!1,data:this.contentCopied}})},paste:function(e){window.docmClipboard&&e&&e({action:"Paste",data:window.docmClipboard})}}}),define("DS/DocumentCommands/V2/Actions/Revisions",["UWA/Promise","i18n!DS/DocumentCommands/assets/nls/DocumentCommands"],function(e,t){"use strict";var n=function(o){return{id:"Revisions",dataElements:{docV2Public:!0,typeRepresentation:"functionIcon",icon:{iconName:"flow-branch-list",fontIconFamily:1},label:t.get("Revisions"),tooltip:t.get("Revisions"),position:"far",category:"lifecycle",value:function(e){e.options=o,n.execute(e)},visibleFlag:!1},execute:function(){n.execute({options:o})},updateForSelection:function(t,n){return new e(function(e){t({visibleFlag:1==o.getSelectedNodes().length}),e(!0)})}}};return n.execute=function(e){require(["DS/LifecycleCmd/HistoryCmd"],function(t){var n=e.options.getSelectedNodes().map(function(e){var t=e;return t.options.physicalid&&0!=t.options.physicalid.length||(t.options.physicalid=t.options.data.id),t.getID||(t.getID=function(){return t.options.physicalid}),t});(t=new t({ID:"revisions_cmd_ID",context:{getSelectedNodes:()=>n}})).begin()})},n}),define("DS/DocumentCommands/TypeDerivativesCache",["UWA/Core","UWA/Promise","DS/WAFData/WAFData"],function(e,t,n){"use strict";return{csrfs:{},ready:{},types:{},platformUrls:void 0,setup:function(t){this.ready[t]=e.Promise.deferred(),this.ready[t].resolve(!0)},getTypeDerivatives:function(e,t,n){var o=this,i={};e.every(e=>null!=o.types[e])?(e.forEach(e=>{i[e]=o.types[e]}),t&&t(i)):o.fetchTypeDerivatives(e,t,n)},fetchTypeDerivatives:function(e,t,o){var i=this,a=o+"/resources/v1/modeler/documents/typeDerivatives";n.authenticatedRequest(a,{method:"post",type:"json",onComplete:function(e){if(e.success){var n={};e.data.forEach(e=>{i.types[e.type]=e.children.map(e=>e.type),i.types[e.type]=i.types[e.type].filter(function(e){return e}),0==i.types[e.type].length&&i.types[e.type].push(e.type),n[e.type]=i.types[e.type]}),t&&t(n)}},data:JSON.stringify({data:e.map(function(e){return{type:e}})}),headers:{"content-type":"application/json"}})}}}),define("DS/DocumentCommands/V2/Actions/Subscription/UnSubscribe",["i18n!DS/DocumentCommands/assets/nls/DocumentCommands"],function(e){"use strict";var t=function(n){return{id:"UnSubscribe",type:"PushItem",title:e.get("UnSubscribe"),dataElements:{docV2Public:!0,typeRepresentation:"functionIcon",icon:{iconName:"bell-delete",fontIconFamily:1},label:e.get("UnSubscribe"),tooltip:e.get("UnSubscribe"),position:"far",category:"information",value:function(e){e.options=n,t.execute(e)},visibleFlag:!1},execute:function(){t.execute({options:n})},updateForSelection:function(e,t){e({visibleFlag:n.getSelectedNodes().length>=1})}}};return t.execute=function(e){require(["DS/ENOSubscriptionMgmt/Commands/UnSubscribe"],function(t){var n=e.options.getSelectedNodes().map(function(t){var n=e.options.getDocumentFromNodeModel(t);return{physicalid:n.id,type:n.type,getID:function(){return n.id},getType:function(){return n.type}}});new t({ID:"UnSubscribeCmdHdr",context:{getSelectedNodes:()=>n},objIDType:"modelID"}).execute(e)})},t}),define("DS/DocumentCommands/V2/Actions/Subscription/EditSubscriptions",["i18n!DS/DocumentCommands/assets/nls/DocumentCommands"],function(e){"use strict";var t=function(n){return{id:"EditSubscriptions",type:"PushItem",title:e.get("EditSubscriptions"),dataElements:{docV2Public:!0,typeRepresentation:"functionIcon",icon:{iconName:"bell-pencil",fontIconFamily:1},label:e.get("EditSubscriptions"),tooltip:e.get("EditSubscriptions"),position:"far",category:"information",value:function(e){e.options=n,t.execute(e)},visibleFlag:!1},execute:function(){t.execute({options:n})},updateForSelection:function(e,t){e({visibleFlag:n.getSelectedNodes().length>=1})}}};return t.execute=function(e){require(["DS/ENOSubscriptionMgmt/Commands/EditSubscribe"],function(t){var n=e.options.getSelectedNodes().map(function(t){var n=e.options.getDocumentFromNodeModel(t);return{physicalid:n.id,type:n.type,getID:function(){return n.id},getType:function(){return n.type}}});new t({ID:"EditSubscriptionCmdHdr",context:{getSelectedNodes:()=>n},objIDType:"modelID"}).execute(e)})},t}),define("DS/DocumentCommands/V2/Actions/Subscription/Subscribe",["i18n!DS/DocumentCommands/assets/nls/DocumentCommands"],function(e){"use strict";var t=function(n){return{id:"Subscribe",type:"PushItem",title:e.get("Subscribe"),dataElements:{docV2Public:!0,typeRepresentation:"functionIcon",icon:{iconName:"bell-add",fontIconFamily:1},label:e.get("Subscribe"),tooltip:e.get("Subscribe"),position:"far",category:"information",value:function(e){e.options=n,t.execute(e)},visibleFlag:!1},execute:function(){t.execute({options:n})},updateForSelection:function(e,t){e({visibleFlag:n.getSelectedNodes().length>=1})}}};return t.execute=function(e){require(["DS/ENOSubscriptionMgmt/Commands/Subscribe"],function(t){var n=e.options.getSelectedNodes().map(function(t){var n=e.options.getDocumentFromNodeModel(t);return{physicalid:n.id,type:n.type,getID:function(){return n.id},getType:function(){return n.type}}});new t({ID:"SubscribeCmdHdr",context:{getSelectedNodes:()=>n},objIDType:"modelID"}).execute(e)})},t}),define("DS/DocumentCommands/V2/Actions/Move",["UWA/Promise","i18n!DS/DocumentCommands/assets/nls/DocumentCommands"],function(e,t){"use strict";var n=function(o){return{id:"Move",dataElements:{docV2Public:!0,typeRepresentation:"functionIcon",icon:{iconName:"move-to",fontIconFamily:1},label:t.get("Move"),tooltip:t.get("Move"),position:"far",category:"colllaboration",value:function(e){e.options=o,n.execute(e)},visibleFlag:!1},execute:function(){n.execute({options:o})},updateForSelection:function(t,n){return new e(function(e){t({visibleFlag:o.getSelectedNodes().length>=1}),e(!0)})}}};return n.execute=function(e){require(["DS/ENOCollabSharingCmds/commands/TransferOwnershipCmd/ActionBar_ChangeOwnerCmd"],function(t){var n=e.options.getSelectedNodes().map(function(e){var t=e;return t.options.physicalid&&0!=t.options.physicalid.length||(t.options.physicalid=t.options.data.id),t.getID||(t.getID=function(){return t.options.physicalid}),t});(t=new t({ID:"changeOwner_cmd_id",context:{getSelectedNodes:()=>n}})).begin()})},n}),define("DS/DocumentCommands/V2/Actions/Preview",["UWA/Core","UWA/Promise","i18n!DS/DocumentCommands/assets/nls/DocumentCommands"],function(e,t,n){"use strict";var o=void 0,i=void 0,a=function(e){return{id:"Preview",dataElements:{docV2Public:!0,typeRepresentation:"functionIcon",icon:{iconName:"eye",fontIconFamily:1},label:n.get("Preview"),tooltip:n.get("Preview"),position:"far",category:"view",value:function(t){t.options=e,a.execute(t)},visibleFlag:!1},execute:function(){a.execute({options:e})},updateForSelection:function(n,o){return new t(function(t){n({visibleFlag:1==e.getSelectedNodes().length}),t(!0)})}}};return a.execute=function(e){var t=e.options.getSelectedNodes()[0];if(!e.options.getDocumentFromNodeModel(t))throw"e6wDocument cannot be loaded from nodeModel";!function(t){require(["DS/DocumentPreview/PreviewComponent2"],function(n){o&&(e.options.events.unsubscribe(o),o=void 0),o=e.options.events.subscribe({event:"docv2-preview-reload-viewer"},function(t){if(widget.previewComponent2&&1==e.options.getSelectedNodes().length&&null!=t.nodeModel){var n=e.options.getSelectedNodes()[0],o=e.options.getDocumentFromNodeModel(n);e.options.getDocumentFromNodeModel(t.nodeModel).id==o.id&&widget.previewComponent2.updateDocument(o,!0)}}),i&&(e.options.events.unsubscribe(i),i=void 0),i=e.options.events.subscribe({event:"docv2-preview-reload-toolbar"},function(t){if(widget.previewComponent2&&1==e.options.getSelectedNodes().length&&null!=t.nodeModel){var n=e.options.getSelectedNodes()[0],o=e.options.getDocumentFromNodeModel(n);e.options.getDocumentFromNodeModel(t.nodeModel).id==o.id&&widget.previewComponent2.updateDocument(o,!1)}}),widget.previewComponent2?(widget.previewComponent2.setOptions({platformUrls:e.options.platformUrls,modelEvents:e.options.events,tenant:e.options.platformUrls.platformId,securityContext:e.options.fetchSecurityContext(),nodeModel:t,hideNextPrev:!0,enableFavoriteToggle:!1}),widget.previewComponent2.updateDocument(e.options.getDocumentFromNodeModel(t),!0)):(widget.previewComponent2=new n({document:e.options.getDocumentFromNodeModel(t),platformUrls:e.options.platformUrls,modelEvents:e.options.events,tenant:e.options.platformUrls.platformId,securityContext:e.options.fetchSecurityContext(),nodeModel:t,hideNextPrev:!0,enableFavoriteToggle:!1}),widget.previewComponent2.loaded=function(e){},widget.previewComponent2.elements.container.setStyles({background:"white",width:"100%",height:"100%"}),widget.previewComponent2.close=function(){widget.previewComponent2.destroy(),widget.previewComponent2=void 0},widget.previewComponent2.inject(widget.body))})}(t)},a}),define("DS/DocumentCommands/V2/ConvertCmdToWebUX",[],function(){"use strict";return function(e){return e.map(e=>{var t=void 0;UWA.is(e.dataElements.value,"function")&&(t={callback:e.dataElements.value||function(e,t,n){console.error("This command doesnt have value")}});var n=void 0;return UWA.is(e.dataElements.value.menu,"array")&&(n=e.dataElements.value.menu),{rawItem:e,type:"PushItem",title:e.dataElements.label,fonticon:{content:"wux-ui-3ds wux-ui-3ds-"+e.dataElements.icon.iconName},action:t,submenu:n,recId:e.id,category:e.dataElements.category}})}}),define("DS/DocumentCommands/Helper",["UWA/Core","UWA/Promise"],function(e,t){"use strict";var n={formatBytes:function(e,t){if(0===e)return"0 Byte";var n=t+1||3,o=Math.floor(Math.log(e)/Math.log(1024));return(e/Math.pow(1024,o)).toPrecision(n)+" "+["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"][o]},IsWebEditionAvailable:function(){let e=widget.getValue("x3dPlatformId")?widget.getValue("x3dPlatformId"):"OnPremise",n="OnPremise"!=e;return null==this.isODEGrantedPromise&&(this.isODEGrantedPromise=new t(function(t){require(["DS/OfficeDocumentEditorClient/Editor"],function(o){n?o.isGranted({platformId:e}).then(()=>{t(!0)}).catch(e=>{t(!1)}):t(!1)},function(e){t(!1)})})),this.isODEGrantedPromise},IsWebEditionDocumentSessionActive:function(e,n){return new t(function(t,o){require(["DS/OfficeDocumentEditorClient/Editor"],function(i){i.state({platformId:e,key:n}).then(e=>{t(e)}).catch(e=>{o(e)})},function(e){o(e)})})},IsFileFormatSupported:function(e){return new t(function(t,n){require(["DS/OfficeDocumentEditorClient/Editor"],function(o){o.isFileFormatSupported({format:e}).then(e=>{t(e)}).catch(e=>{n(e)})},function(e){n(e)})})},CalculateDocumentModificationCommandsVisibility:function(e,o){var i=this.IsWebEditionAvailable();return new t(function(t){var a=/(android|iPhone|iPod|iPad)/i.test(navigator.userAgent),s={Edit:!1,OfficeWebEdition:!1,LockAndDownload:!1,UndoEdit:!1,Unlock:!1,UpdateAndUnlock:!1,Update:!1},l=e.getSelectedNodes();if(1==e.getSelectedNodes().length){var c=e.getDocumentFromNodeModel(l[0]),r="TRUE"==c.dataelements.hasModifyAccess,d=[];if(c.relateddata&&c.relateddata.files?d=c.relateddata.files:c.files&&(d=c.files),1==d.length)if(""!=d[0].dataelements.locker){"OnPremise"==e.platformUrls.platformId?(s.UndoEdit=!0,s.Update=!0,t(s)):i.then(function(e){if(e){s.Unlock=!0,s.UpdateAndUnlock=!0;let e=d[0].dataelements.title,i=e.lastIndexOf("."),l=e.substring(i+1,e.length);"OfficeWebEdition"!=o?t(s):r&&!a?n.IsFileFormatSupported(l).then(e=>{e?(s.OfficeWebEdition=!0,t(s)):t(s)}).catch(function(e){t(s)}):t(s)}else s.UndoEdit=!0,s.Update=!0,t(s)})}else{"OnPremise"==e.platformUrls.platformId?(s.Edit=!0,s.Update=!0,t(s)):i.then(function(e){if(e){s.LockAndDownload=!0,s.Update=!0;let e=d[0].dataelements.title,i=e.lastIndexOf("."),l=e.substring(i+1,e.length);"OfficeWebEdition"!=o?t(s):r&&!a?n.IsFileFormatSupported(l).then(e=>{e?(s.OfficeWebEdition=!0,t(s)):t(s)}).catch(function(e){t(s)}):t(s)}else s.Edit=!0,s.Update=!0,t(s)})}else t(s)}else t(s)})}};return n}),define("DS/DocumentCommands/V2/Actions/Compare",["UWA/Promise","i18n!DS/DocumentCommands/assets/nls/DocumentCommands"],function(e,t){"use strict";var n=function(o){return{id:"Compare",dataElements:{docV2Public:!0,typeRepresentation:"functionIcon",icon:{iconName:"part-compare",fontIconFamily:1},label:t.get("Compare"),tooltip:t.get("Compare"),position:"far",category:"lifecycle",value:function(e){e.options=o,n.execute(e)},visibleFlag:!1},execute:function(){n.execute({options:o})},updateForSelection:function(t,n){return new e(function(e){t({visibleFlag:o.getSelectedNodes().length>=1}),e(!0)})}}};return n.execute=function(e){require(["DS/CompareCmd/CompareCmd"],function(t){var n=e.options.platformUrls.platformId,o=e.options.getSelectedNodes().map(function(t){return{contextId:e.options.fetchSecurityContext(),id:t.options.data.id,objIDType:"modelID",objTenant:n}});(t=new t({ID:"CompareHdr"})).launchCompare(n,o,void 0,void 0)})},n}),define("DS/DocumentCommands/V2/Actions/Share",["UWA/Core","UWA/Promise","i18n!DS/DocumentCommands/assets/nls/DocumentCommands"],function(e,t,n){"use strict";var o=function(e){return{id:"Share",dataElements:{docV2Public:!0,typeRepresentation:"functionIcon",icon:{iconName:"forward",fontIconFamily:1},label:n.get("Share"),tooltip:n.get("Share"),position:"far",category:"colllaboration",value:function(t){t.options=e,o.execute(t)},visibleFlag:!1},execute:function(){o.execute({options:e})},updateForSelection:function(n,o){return new t(function(t){n({visibleFlag:e.getSelectedNodes().length>=1}),t(!0)})}}};return o.execute=function(t){var n=t.options.getSelectedNodes();require(["DS/ENOCollabSharingCmds/BaseModels/ResultElement","DS/SharePopup/SharePopup"],function(o,i){var a=n.map(function(n){var i=t.options.getDocumentFromNodeModel(n),a=void 0;i&&null==(a=i.title||i.name)&&i.dataelements&&(a=i.dataelements.title||i.dataelements.name);var s=void 0;i.revision?s=i.revision:i.dataelements&&(s=i.dataelements.revision);var l=void 0;i.typeNLS?l=i.typeNLS:i.dataelements&&(l=i.dataelements.typeNLS);var c=void 0;i.collabSpaceTitle?c=i.collabSpaceTitle:i.dataelements&&(c=i.dataelements.collabSpaceTitle);var r=void 0;i.organizationTitle?r=i.organizationTitle:i.dataelements&&(r=i.dataelements.organizationTitle);var d=void 0;return e.is(i.firstname,"string")?d=i.firstname+" "+i.lastname:i.relateddata&&i.relateddata.ownerInfo&&i.relateddata.ownerInfo[0]&&i.relateddata.ownerInfo[0].dataelements&&e.is(i.relateddata.ownerInfo[0].dataelements.firstname,"string")&&(d=i.relateddata.ownerInfo[0].dataelements.firstname+" "+i.relateddata.ownerInfo[0].dataelements.lastname),new o({physicalId:i.id,Revision:s,typeDisplayName:l,name:a,organizationTitle:r,collabSpaceTitle:c,responsibleName:d})});t.options.sharePanel?(t.options.sharePanel.show(a),t.options.sharePanel.container.centerIt()):(t.options.sharePanel=new i(widget,widget.body,{removeAtClose:!0,events:{onClose:function(){t.options.sharePanel=null}}}),t.options.sharePanel.show(a))})},o}),define("DS/DocumentCommands/V2/Actions/Subscription/MySubscriptions",["i18n!DS/DocumentCommands/assets/nls/DocumentCommands"],function(e){"use strict";var t=function(n){return{id:"MySubscriptions",type:"PushItem",title:e.get("MySubscriptions"),dataElements:{docV2Public:!0,typeRepresentation:"functionIcon",icon:{iconName:"bell",fontIconFamily:1},label:e.get("MySubscriptions"),tooltip:e.get("MySubscriptions"),position:"far",category:"information",value:function(e){e.options=n,t.execute(e)},visibleFlag:!0},execute:function(){t.execute({options:n})},updateForSelection:function(e,t){e({visibleFlag:0==n.getSelectedNodes().length})}}};return t.execute=function(e){require(["DS/ENOSubscriptionMgmt/Commands/MySubscriptions"],function(t){var n=e.options.getSelectedNodes().map(function(t){var n=e.options.getDocumentFromNodeModel(t);return{physicalid:n.id,type:n.type,getID:function(){return n.id},getType:function(){return n.type}}});new t({ID:"MySubscriptionsCmdHdr",context:{getSelectedNodes:()=>n},objIDType:"modelID"}).execute(e)})},t}),define("DS/DocumentCommands/V2/Actions/Relations",["UWA/Promise","UWA/Utils/InterCom","i18n!DS/DocumentCommands/assets/nls/DocumentCommands"],function(e,t,n){"use strict";var o=function(t){return{id:"Relations",dataElements:{docV2Public:!0,typeRepresentation:"functionIcon",icon:{iconName:"object-related",fontIconFamily:1},label:n.get("Relations"),tooltip:n.get("Relations"),position:"far",category:"information",value:function(e){e.options=t,o.execute(e)},visibleFlag:!1},execute:function(){o.execute({options:t})},updateForSelection:function(n,o){return new e(function(e){n({visibleFlag:t.getSelectedNodes().length>0}),e(!0)})}}};return o.execute=function(e){var n=function(e,t){var n={protocol:"3DXContent",version:"2.0",source:"ENOXATTACHMENTS",widgetId:widget.id,data:{items:[]}};return e.forEach(function(e){var o={envId:t.platformUrls.platformId,serviceId:"3DSpace",contextId:t.fetchSecurityContext(),objectId:t.getDocumentFromNodeModel(e).id,objectType:t.getDocumentFromNodeModel(e).type};t&&t.includeObjectTaxonomies&&(o.objectTaxonomies=e.options.taxonomies),n.data.items.push(o)}),n}(e.options.getSelectedNodes(),e.options);n.appId="ENORIPE_AP";var o=new t.Socket("compassPageSocket");o.subscribeServer("com.ds.compass",window.parent),o.dispatchEvent("onSetX3DContent",n,"compassPageSocket"),o.addListener("launchApp",function(e,t,n){o.unsubscribeServer("com.ds.compass"),o.disconnect()}),o.dispatchEvent("onLaunchApp",n,"compassPageSocket")},o}),define("DS/DocumentCommands/V2/Actions/CopyLink",["UWA/Core","UWA/Promise","DS/UIKIT/Input/Button","DS/UIKIT/Input/Text","DS/UIKIT/Dropdown","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","i18n!DS/DocumentCommands/assets/nls/DocumentCommands"],function(e,t,n,o,i,a,s){"use strict";var l=function(e){return{id:"CopyLink",dataElements:{docV2Public:!0,typeRepresentation:"functionIcon",icon:{iconName:"link",fontIconFamily:1},tooltip:s.get("CopyLink"),label:s.get("CopyLink"),position:"far",category:"colllaboration",value:function(t){t.options=e,l.execute(t)},visibleFlag:!1},execute:function(){l.execute({options:e})},updateForSelection:function(n,o){return new t(function(t){n({visibleFlag:1==e.getSelectedNodes().length}),t(!0)})}}};return l.execute=function(t){var a=t.options.getSelectedNodes()[0],l=t.options.getDocumentFromNodeModel(a),c=t.options.container,r=void 0;l&&null==(r=l.title||l.name)&&l.dataelements&&(r=l.dataelements.title||l.dataelements.name);var d={objectId:l.id,envId:t.options.platformUrls.platformId};e.is(t.options.getSelectedFile,"function")&&null!=t.options.getSelectedFile()&&(d.fileid=t.options.getSelectedFile().id,r=t.options.getSelectedFile().dataelements.title);var u=function(e){var t={protocol:"3DXContent",data:{items:[]}};t.data.items.push({envId:e.envId,objectId:e.objectId,openLink:!0}),e.fileid&&(t.data.items[0].fileid=e.fileid,t.data.items[0].openFile=!0);return t}(d),m=e.createElement("div",{styles:{display:"flex"}}),p=new o("input",{attributes:{readonly:"readonly"}});p.getContent().setStyles({display:"inline-block","border-top-right-radius":0,"border-bottom-right-radius":0}),p.inject(m);var f=new n({value:s.get("CopyLink"),className:"block",events:{onClick:function(n){p.setFocus(),p.elements.input.select(),p.elements.input.setSelectionRange(0,99999),document.execCommand("cut"),g.hide(),r&&""!==r?t.options.events.publish({event:"docv2-show-notification",data:{level:"success",title:s.get("LinkCopiedTitle"),subtitle:e.String.format(s.get("LinkCopiedMsg"),r),message:"",sticky:!1,allowUnsafeHTML:!1}}):t.options.events.publish({event:"docv2-show-notification",data:{level:"success",title:s.get("LinkCopiedTitle"),subtitle:s.get("LinkCopied"),message:"",sticky:!1,allowUnsafeHTML:!1}})}}});f.getContent().setStyles({display:"inline-block","border-top-left-radius":0,"border-bottom-left-radius":0,padding:"0 10px"}),f.inject(m);var g=new i({body:m,closeOnClick:!1,events:{onClickOutside:function(e){console.log("DDClickOutside")}}});g.options.target=c;var v=widget.widgetDomain;if(null==v&&(v=platformUrls["3DDashboard"]),console.log(v),null==v)throw"url is undefined.";g.hide(),g.show(),p.setFocus(),p.setValue(v+"#app:ENXWDOC_AP/content:X3DContentId="+encodeURIComponent(JSON.stringify(u))),p.elements.input.select(),p.elements.input.setSelectionRange(0,99999,"backward"),f.getContent().click()},l}),define("DS/DocumentCommands/V2/Actions/Download",["UWA/Core","UWA/Promise","DS/DocumentManagement/DocumentManagement","i18n!DS/DocumentCommands/assets/nls/DocumentCommands"],function(e,t,n,o){"use strict";var i=e.createElement("iframe",{name:"multidocdownloaderFrame",styles:{display:"none"}}),a=e.createElement("form",{method:"POST",enctype:"application/x-www-form-urlencoded",target:"multidocdownloaderFrame",html:[{tag:"input",value:"true",name:"attachment"}],styles:{display:"none"}}),s=function(e){return{id:"Download",dataElements:{docV2Public:!0,typeRepresentation:"functionIcon",icon:{iconName:"download",fontIconFamily:1},label:o.get("Download"),tooltip:o.get("Download"),position:"far",category:"information",value:function(t){t.options=e,s.execute(t)},visibleFlag:!1},execute:function(){s.execute({options:e})},updateForSelection:function(n,o){return new t(function(t){n({visibleFlag:e.getSelectedNodes().length>0}),t(!0)})}}};return s.execute=function(t){if(1==t.options.getSelectedNodes().length){var s=t.options.getSelectedNodes()[0],l=t.options.getDocumentFromNodeModel(s),c=void 0;l&&null==(c=l.title||l.name)&&l.dataelements&&(c=l.dataelements.title||l.dataelements.name);var r=void 0;e.is(t.options.getSelectedFile,"function")&&null!=t.options.getSelectedFile()&&(r=t.options.getSelectedFile().id,c=t.options.getSelectedFile().dataelements.title),(f={asZip:!0,autoDownload:!0}).tenant=t.options.platformUrls.platformId,f.securityContext=t.options.fetchSecurityContext(),f.tenantUrl=t.options.platformUrls["3DSpace"],f.onComplete=function(n){if(c&&""!==c){var i={subtitle:e.String.format(o.DOWNLOAD_FILES_INITIATED,c)};t.options.events.publish({event:"docv2-show-notification",data:{level:"info",title:i.title||"",subtitle:i.subtitle||"",message:"",sticky:!1,allowUnsafeHTML:!1}})}else t.options.events.publish({event:"docv2-show-notification",data:{level:"info",title:o.Download_Initiated,subtitle:"",message:"",sticky:!1,allowUnsafeHTML:!1}})},f.onFailure=function(e){t.options.events.publish({event:"docv2-show-notification",data:{level:"error",title:e.data[0].updateMessage,subtitle:"",message:"",sticky:!1,allowUnsafeHTML:!1}})},widget&&widget.MSFDocumentClient&&null===n.MSFDocumentClient?n.MSFDocumentClient=widget.MSFDocumentClient:t.options.MSFDocumentClient&&null===n.MSFDocumentClient&&(n.MSFDocumentClient=t.options.MSFDocumentClient),n.downloadDocument(l.id,r,!1,f)}else if(t.options.getSelectedNodes().length>1){var d=t.options.getSelectedNodes().map(function(e){return t.options.getDocumentFromNodeModel(e)}).map(function(e){var t=[];e.files?t=e.files:e.relateddata&&e.relateddata.files&&(t=e.relateddata.files);var n=e.title||e.name;return null==n&&e.dataelements&&(n=e.dataelements.title||e.dataelements.name),{title:n,count:t.length}}),u=[],m=[];for(var p of d)p.count>1&&u.push(p.title),0==p.count&&m.push(p.title);if(m.length>0)return void t.options.events.publish({event:"docv2-show-notification",data:{level:"error",title:o.get("DownloadFailed"),subtitle:"",message:o.get("DocumentHasNoFile",{documents:m.join(", ")}),sticky:!1,allowUnsafeHTML:!1}});if(u.length>0)t.options.events.publish({event:"docv2-show-notification",data:{level:"error",title:o.get("DownloadFailed"),subtitle:"",message:o.get("MoreThanOneFileInMultipleDocuments",{documents:u.join(", ")}),sticky:!1,allowUnsafeHTML:!1}});else{var f,g=t.options.getSelectedNodes().map(function(e){return t.options.getDocumentFromNodeModel(e).id});(f={asZip:!0,autoDownload:!0}).tenant=t.options.platformUrls.platformId,f.securityContext=t.options.fetchSecurityContext(),f.tenantUrl=t.options.platformUrls["3DSpace"],f.onComplete=function(n){var s=n;e.is(s,"array")&&s.forEach(function(n){if(n.downloadUrl){var s=new URL(n.downloadUrl),l=(i.isInjected()||i.inject(document.body),a.isInjected()||a.inject(document.body),a.empty(),e.createElement("input",{name:"attachment",value:"true"}).inject(a),a);for(var c of s.searchParams)e.createElement("input",{name:c[0],value:c[1]}).inject(l);s.search="",l.action=s.href,console.log(s),l.submit(),t.options.events.publish({event:"docv2-show-notification",data:{level:"info",title:o.get("DownloadHasStarted"),subtitle:"",message:o.get("DownloadHasStarted"),sticky:!1,allowUnsafeHTML:!1}})}else t.options.events.publish({event:"docv2-show-notification",data:{level:"error",title:o.get("DownloadNotInitiated"),subtitle:"",message:"",sticky:!1,allowUnsafeHTML:!1}})})},f.onFailure=function(e){t.options.events.publish({event:"docv2-show-notification",data:{level:"error",title:o.get("DownloadFailed"),subtitle:e[0].errorMessage,message:"",sticky:!1,allowUnsafeHTML:!1}})},widget&&widget.MSFDocumentClient&&null===n.MSFDocumentClient?n.MSFDocumentClient=widget.MSFDocumentClient:t.options.MSFDocumentClient&&null===n.MSFDocumentClient&&(n.MSFDocumentClient=t.options.MSFDocumentClient),n.downloadDocuments(g,f)}}},s}),define("DS/DocumentCommands/Constants",[],function(){"use strict";return{PREVIEW:"Preview",PREVIEW2:"Preview2",REPLACE_BY_REVISION:"ReplaceBy",DOWNLOAD:"Download",NEW_REVISION:"NEW REVISION",DELETE:"Delete",COPY_LINK:"CopyLink",RELATION:"Relation",REMOVE:"Remove",MATURITY:"Maturity",UPDATE:"Update",UPDATE_AND_UNLOCK:"UpdateAndUnlock",UNLOCK:"Unlock",LOCK_AND_DOWNLOAD:"LockAndDownload",EDIT:"Edit",UNDO_EDIT:"UndoEdit",COPY:"Copy",PASTE:"Paste",SHARE:"Share",PROPERTIES:"Properties",OFFICE_WEB_EDITION:"OfficeWebEdition"}}),define("DS/DocumentCommands/V2/Actions/Duplicate",["UWA/Promise","i18n!DS/DocumentCommands/assets/nls/DocumentCommands"],function(e,t){"use strict";var n=function(o){return{id:"Duplicate",dataElements:{docV2Public:!0,typeRepresentation:"functionIcon",icon:{iconName:"duplicate",fontIconFamily:1},label:t.get("Duplicate"),tooltip:t.get("Duplicate"),position:"far",category:"lifecycle",value:function(e){e.options=o,n.execute(e)},visibleFlag:!1},execute:function(){n.execute({options:o})},updateForSelection:function(t,n){return new e(function(e){t({visibleFlag:o.getSelectedNodes().length>=1}),e(!0)})}}};return n.execute=function(e){require(["DS/LifecycleCmd/DuplicateCmd"],function(t){var n=e.options.getSelectedNodes().map(function(t){var n=e.options.getDocumentFromNodeModel(t),o=void 0;n&&null==(o=n.title||n.name)&&n.dataelements&&(o=n.dataelements.title||n.dataelements.name);var i=void 0;return n.revision?i=n.revision:n.dataelements&&(i=n.dataelements.revision),{physicalid:n.id,displayName:o,revision:i,icon:n.dataelements.indexedTypeicon||n.dataelements.typeicon,type:n.type,typeDisplayName:n.dataelements.typeNLS,current:n.dataelements.state,currentDisplayName:n.dataelements.stateNLS,getID:function(){return n.id},getLabel:function(){return o},getType:function(){return n.type},getAttribute:function(e){return e.contains("revision")?i:e.contains("type")?n.type:e.contains("status")?n.dataelements.state:void 0}}});(t=new t({ID:"duplicate_cmd_id",context:{getSelectedNodes:()=>n,getUUID:function(){return e.options.getOrigin?JSON.stringify(UWA.extend(e.options.getOrigin(),{action:"duplicate"})):"docv2.duplicate."+Date.now()}}})).begin()})},n}),define("DS/DocumentCommands/V2/Actions/ChangeOwner",["UWA/Promise","i18n!DS/DocumentCommands/assets/nls/DocumentCommands"],function(e,t){"use strict";var n=function(o){return{id:"ChangeOwner",dataElements:{docV2Public:!0,typeRepresentation:"functionIcon",icon:{iconName:"user-change",fontIconFamily:1},label:t.get("ChangeOwner"),tooltip:t.get("ChangeOwner"),position:"far",category:"colllaboration",value:function(e){e.options=o,n.execute(e)},visibleFlag:!1},execute:function(){n.execute({options:o})},updateForSelection:function(t,n){return new e(function(e){t({visibleFlag:o.getSelectedNodes().length>=1}),e(!0)})}}};return n.execute=function(e){require(["DS/ENOCollabSharingCmds/commands/TransferOwnershipCmd/ActionBar_TransferOwnershipCmd"],function(t){var n=e.options.getSelectedNodes().map(function(e){var t=e;return t.options.physicalid&&0!=t.options.physicalid.length||(t.options.physicalid=t.options.data.id),t.getID||(t.getID=function(){return t.options.physicalid}),t});(t=new t({ID:"transferOwnership_cmd_id",context:{getSelectedNodes:()=>n}})).begin()})},n}),define("DS/DocumentCommands/Jobs",["UWA/Core"],function(e){"use strict";return function(e){var t={name:"doco-jobs",MAX_PARALLEL_JOBS:3,jobs:[],states:{WAIT:1,PROCESSING:2,FINISHED:3},init:function(e){this.app=e},latestJobId:0,process:function(){var e=this.jobs.filter(function(e){return e.processing==t.states.PROCESSING});if(e.length<this.MAX_PARALLEL_JOBS)for(var n=this.MAX_PARALLEL_JOBS-e.length,o=this.jobs.filter(function(e){return e.processing==t.states.WAIT}),i=0;i<o.length&&i<n;i++){var a=o[i];a.processing=t.states.PROCESSING,a.process()}},addJob:function(e){e.id=this.latestJobId++,e.processing=t.states.WAIT,e.ui&&(this.app.progressPane.addProgress(e),e.update=function(t){e.progress.update(e.title,.99*t.loaded,t.total)}),this.jobs.push(e),this.process()},finishJob:function(e,n){e.processing=t.states.FINISHED;var o=this.jobs.indexOf(e);-1!=o?this.jobs.splice(o,1):console.error("This wasn't supposed to happen, Unable to splice Q"),this.process(),e.ui&&(e.progress.update(e.title,100,100,n),setTimeout(function(){e.progress.destroy(),0==t.jobs.length&&t.app.progressPane.hide()},2e3))},cancelAll:function(){for(var e=this.jobs.length-1;e>=0;e--)this.jobs[e].cancel&&this.jobs[e].cancel()}};return t.init(e),t}}),define("DS/DocumentCommands/Resources",[],function(){"use strict";return{REPLACE_BY_REVISION:"/resources/v1/modeler/commondocuments/documentaction/replacebyrevision",LATEST_REVISION:"/resources/v1/dslc/getlastversions",NEW_REVISION:"/resources/lifecycle/revise/major"}}),define("DS/DocumentCommands/V2/Actions/AddTo/Libraries",["i18n!DS/DocumentCommands/assets/nls/DocumentCommands"],function(e){"use strict";var t=function(n){return{id:"Libraries",type:"PushItem",title:e.get("Libraries"),dataElements:{docV2Public:!0,typeRepresentation:"functionIcon",icon:{iconName:"library-add",fontIconFamily:1},label:e.get("Libraries"),tooltip:e.get("Libraries"),position:"far",category:"edit",value:function(e){e.options=n,t.execute(e)},visibleFlag:!1},execute:function(){t.execute({options:n})},updateForSelection:function(e,t){e({visibleFlag:n.getSelectedNodes().length>=1})}}};return t.execute=function(e){require(["DS/LibraryActive/commands/ActionBar_MultipleClassificationCmd"],function(t){var n=e.options.getSelectedNodes().map(function(t){return e.options.getDocumentFromNodeModel(t).id});(new t).execute({id:"Classfy_cmd_id",securityContext:e.options.fetchSecurityContext(),tenantId:e.options.platformUrls.platformId,objects:n},{launchMode:"Classify",selectionMode:"DefaultSingle",ComponentTitle:"Libraries",OKButtonLabel:"Add"})})},t}),define("DS/DocumentCommands/V2/Actions/Delete",["UWA/Core","UWA/Promise","DS/UIKIT/Modal","DS/DocumentManagement/DocumentManagement","i18n!DS/DocumentCommands/assets/nls/DocumentCommands"],function(e,t,n,o,i){"use strict";var a=function(e){return{id:"Delete",dataElements:{docV2Public:!0,typeRepresentation:"functionIcon",icon:{iconName:"trash",fontIconFamily:1},label:i.get("Delete"),tooltip:i.get("Delete"),position:"far",category:"destructive",value:function(t){t.options=e,a.execute(t)},visibleFlag:!1},execute:function(){a.execute({options:e})},updateForSelection:function(n,o){return new t(function(t){n({visibleFlag:e.getSelectedNodes().length>0}),t(!0)})}}};return a.execute=function(t){if(t.options.getSelectedNodes().length>0){var n=t.options.getSelectedNodes();require(["DS/LifecycleCmd/DeleteCmd"],function(o){new o({securitycontext:t.options.fetchSecurityContext(),context:{displayNotification:function(o){if("primary"==o.eventID)if(1==n.length){var a=t.options.getSelectedNodes()[0],s=t.options.getDocumentFromNodeModel(a),l=void 0;s&&null==(l=s.title||s.name)&&s.dataelements&&(l=s.dataelements.title||s.dataelements.name),t.options.events.publish({event:"docv2-show-notification",data:{level:"success",title:i.get("DeletionSuccessful"),subtitle:e.String.format(i.get("DeletionSuccessfulMsg"),l),message:"",sticky:!1,allowUnsafeHTML:!1}})}else n.length>1&&t.options.events.publish({event:"docv2-show-notification",data:{level:"success",title:i.get("DeletionSuccessful"),subtitle:i.get("MultipleDeletionSuccessfulMsg",{count:n.length}),message:"",sticky:!1,allowUnsafeHTML:!1}})},getUUID:function(){return t.options.getOrigin?JSON.stringify(e.extend(t.options.getOrigin(),{action:"delete"})):"docv2.delete."+Date.now()}}}).execute(n.map(function(e){var n=t.options.getDocumentFromNodeModel(e),o=void 0;n&&null==(o=n.title||n.name)&&n.dataelements&&(o=n.dataelements.title||n.dataelements.name);var i=void 0;return n.revision?i=n.revision:n.dataelements&&(i=n.dataelements.revision),{physicalid:n.id,displayName:o,revision:i,icon:n.dataelements.indexedTypeicon||n.dataelements.typeicon,type:n.type,typeDisplayName:n.dataelements.typeNLS,current:n.dataelements.state,currentDisplayName:n.dataelements.stateNLS}}))})}},a}),define("DS/DocumentCommands/ProgressPane",["UWA/Core","UWA/Controls/Abstract","DS/DocumentCommands/Helper","i18n!DS/DocumentCommands/assets/nls/DocumentCommands","css!DS/DocumentCommands/DocumentCommands.css"],function(e,t,n,o){"use strict";return e.Controls.Abstract.extend({name:"doco-progress",options:{className:""},init:function(e){this.app=e,this._parent(e.options),this.buildSkeleton()},buildSkeleton:function(){var t=this;this.container=e.createElement("div",{class:t.getClassNames("-progresspane popover")});var n=e.createElement("div",{class:"progresspane-titlebar popover-title"});n.inject(this.container),(t.titleElement=e.createElement("div",{class:"progresspane-title",text:o.get("PROGRESS")})).inject(n),t.titlebarCancelAll=e.createElement("div",{class:"progresspane-title-cancelall fonticon-clickable",text:o.get("CancelAll")}),t.titlebarCancelAll.addEvent("click",function(){t.app.jobs.cancelAll()}),t.titlebarCancelAll.inject(n),t.titlebarCancelAll.hide();var i=e.createElement("button",{class:"close fonticon fonticon-chevron-down",type:"button"});i.inject(n),i.addEvent("click",function(){i.classList.contains("fonticon-chevron-down")?(i.classList.remove("fonticon-chevron-down"),i.classList.add("fonticon-chevron-up"),t.content.hide()):(i.classList.remove("fonticon-chevron-up"),i.classList.add("fonticon-chevron-down"),t.content.show())}),this.content=e.createElement("div",{class:"progresspane-content popover-content"}),this.content.inject(this.container),this.hide()},show:function(){this.container.show()},hide:function(){this.container.hide(),this.totalSize=0,this.completedSize=0,this.ongoingSizes={},this.titlebarCancelAll.hide(),this.titleElement.setText(o.get("PROGRESS"))},addPendingSize:function(e){this.totalSize+=e},totalSize:0,completedSize:0,ongoingSizes:{},addProgress:function(t){var i=this;i.show();var a=e.createElement("div",{class:"progresspane-job"}),s=e.createElement("div",{class:"progresspane-jobtitle",text:t.title,title:t.tooltip||t.title});s.inject(a);var l=e.createElement("progress",{class:"progress progresspane-jobprogress",value:0,max:100}).hide();l.inject(a);var c=e.createElement("div",{class:"progresspane-jobstatus",text:o.get("Pending")}).inject(a);if(t.cancel){var r=e.createElement("span",{class:"progresspane-jobcancel fonticon fonticon-close fonticon-clickable",title:o.get("Cancel")}).inject(a);r.addEvent("click",function(){t.cancel()}),this.titlebarCancelAll.show()}a.inject(i.content),t.progress=a,t.progress.update=function(e,a,d,u){s.setText(e),l.setAttributes({value:100*a/d,max:100,title:e}),0!=a&&(c.hide(),l.show()),a==d&&(r&&r.hide(),u&&"failed"==u?c.setText(o.get("Failed")):u&&"cancelled"==u?c.setText(o.get("Cancelled")):(c.setText(o.get("Completed")),t.size&&i.titleElement.setText(o.get("PROGRESSOF",{current:n.formatBytes(i.completedSize,2),max:n.formatBytes(i.totalSize,2)}))),l.addClassName("progress-success"),c.show(),l.hide())}}})}),define("DS/DocumentCommands/ENOXDocumentCommands",["UWA/Core","UWA/Promise","DS/UIKIT/Input/Button","DS/UIKIT/Input/Text","DS/UIKIT/Modal","DS/UIKIT/Form","DS/UIKIT/Input/File","UWA/Utils/InterCom","DS/Core/ModelEvents","DS/UIKIT/DropdownMenu","DS/UIKIT/Dropdown","DS/WAFData/WAFData","DS/LifecycleCmd/MaturityCmd","DS/ENOXVersionExplorerController/VersionExplorerController","DS/ENOXVersionExplorerUtils/VersionExplorerSettings","DS/ENOXVersionExplorerUtils/VersionExplorerEnums","DS/ENOXVersionExplorerViews/VersionExplorerModal","DS/Notifications/NotificationsManagerUXMessages","DS/Notifications/NotificationsManagerViewOnScreen","DS/DocumentManagement/DocumentManagement","DS/DocumentCommands/Resources","DS/DocumentCommands/Constants","DS/DocumentCommands/TypeDerivativesCache","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/DocumentCommands/DOCMClipboard","DS/Controls/Loader","DS/Controls/ModalContainer","i18n!DS/DocumentCommands/assets/nls/DocumentCommands"],function(e,t,n,o,i,a,s,l,c,r,d,u,m,p,f,g,v,D,S,b,h,y,C,w,E,I,N,U){"use strict";var x={},F={},A=function(e){this._name="ENOXDocCommands",F=e||window.widget};function M(){this._myVersionExplorer.unsubscribeAll()}function P(e,t,n,o,i,a,s){var l={level:e,title:t,subtitle:n,message:o,sticky:i,allowUnsafeHTML:s||!1};window.notifs||(window.notifs=D,S.setNotificationManager(window.notifs)),a?S.inject(a):S.elements.container.isInjected()||S.inject(),window.notifs.addNotif(l)}function T(t){var n={protocol:"3DXContent",version:"2.0",source:e.is(F.data.appId)?F.data.appId:F.environment.data._data._x_appId,widgetId:F.id,data:{items:[]}};return n.data.items.push({envId:t.document.envId,serviceId:t.document.serviceId||"3DSpace",contextId:t.document.contextId,objectId:t.document.id}),n}function R(a,s,c){var r=a.options.document.index||1,D={};D.index=r;var S={title:U.get("Preview"),name:"Preview",text:U.get("Preview"),fonticon:"eye",handler:function(){var e=T(a.options);require(["DS/ENOFloatingPanel/ENOFloatingPanel","DS/DocumentPreview/PreviewComponent"],function(t,n){var o=new n({x3dcontent:e,options:a.options});o.loaded=function(e){},o.elements.container.setStyles({background:"white",width:"100%",height:"100%"}),o.close=function(){i.destroy()};var i=new t({header:o.topBar.container,body:o.elements.container,overlay:!0,closable:!1,resizable:!0,animate:!0,visible:!0,limitParent:!0,autocenter:!0});i.inject(F.body),o.topBar.container.getParent().setStyle("padding","5px"),o.elements.container.getParent().setStyle("padding","5px"),i._maximize()})}},C={title:U.get("Preview"),name:"Preview2",text:U.get("Preview"),fonticon:"eye",handler:function(){function n(e){require(["DS/DocumentPreview/PreviewComponent2"],function(t){F.previewComponent2?(F.previewComponent2.setOptions({platformUrls:s,modelEvents:x.modelEvents,tenant:a.options.document.envId,securityContext:a.options.document.contextId,nodeModel:void 0,hideNextPrev:!0,enableFavoriteToggle:!1}),F.previewComponent2.updateDocument(e,!0)):(F.previewComponent2=new t({document:e,platformUrls:s,modelEvents:x.modelEvents,tenant:a.options.document.envId,securityContext:a.options.document.contextId,nodeModel:void 0,hideNextPrev:!0,enableFavoriteToggle:!1}),F.previewComponent2.loaded=function(e){},F.previewComponent2.elements.container.setStyles({background:"white",width:"100%",height:"100%"}),F.previewComponent2.close=function(){F.previewComponent2.destroy(),F.previewComponent2=void 0},F.previewComponent2.inject(F.body))})}if(a.options.document.data)n(a.options.document.data);else{var o=new I({text:U.get("LOADINGPREVIEW"),showButtonFlag:!0});o.canceller=t.deferred(),o.elements.stopButton.addEventListener("buttonclick",function(e){o.canceller.reject("usercancelled")}),N.createModal(F.body,o.elements.container),o.on(U.get("LOADINGPREVIEW"));var i=new e.Promise(function(e,t){b.getDocuments([a.options.document.id],{tenant:a.options.document.envId,securityContext:a.options.document.contextId,tenantUrl:a.options.platformUrls["3DSpace"],additionalURLParams:"$fields=indexedTypeicon",onComplete:function(n){n.success&&Array.isArray(n.data)?e(n.data[0]):t({error:"BAD_RESPONSE"})},onFailure:function(e){t({error:"GETDOCUMENT_FAILED",reason:e})}})}),l=o.canceller.promise;e.Promise.race([i,l]).then(function(e){o.on(U.get("LOADINGPREVIEW")),N.removeModal(F.body),n(e)},function(e){"usercancelled"!=e&&(e.reason?P("error",U.get("CannotPreviewDocument"),U.get("CannotAccessDocument"),e.reason.error,!1):P("error",U.get("CannotPreviewDocument"),U.get("CannotAccessDocument"),"",!1)),N.removeModal(F.body)})}}},A={title:U.get("Download"),name:"Download",text:U.get("Download"),fonticon:"download",handler:function(){var t=void 0;a.options.document.data&&null==(t=a.options.document.data.title||a.options.document.data.name)&&a.options.document.data.dataelements&&(t=a.options.document.data.dataelements.title||a.options.document.data.dataelements.name);var n={asZip:!0,autoDownload:!0};n.tenant=a.options.document.envId,n.securityContext=a.options.document.contextId,n.tenantUrl=a.options.platformUrls["3DSpace"],n.onComplete=function(n){if(t&&""!==t){var o={subtitle:e.String.format(U.DOWNLOAD_FILES_INITIATED,t)};P("info",o.title||"",o.subtitle||"","",!1)}else P("info",U.Download_Initiated,"",!1)},n.onFailure=function(e){P("error",e.data[0].updateMessage,"","",!1)},F.MSFDocumentClient&&null===b.MSFDocumentClient&&(b.MSFDocumentClient=F.MSFDocumentClient),b.downloadDocument(a.options.document.id,a.options.document.fileid,!1,n)}},R={title:U.get("Edit"),name:"Edit",text:U.get("Edit"),fonticon:"pencil",handler:function(){var t=void 0;if(a.options.document.data&&null==(t=a.options.document.data.title||a.options.document.data.name)&&a.options.document.data.dataelements&&(t=a.options.document.data.dataelements.title||a.options.document.data.dataelements.name),1==a.options.document.data.files.length){var n={asZip:!0,autoDownload:!0};n.tenant=a.options.document.envId,n.securityContext=a.options.document.contextId,n.tenantUrl=a.options.platformUrls["3DSpace"],n.onComplete=function(n){if(t&&""!==t){var o={title:U.get("Download_Initiated"),subtitle:e.String.format(U.get("Filedownloadstartedforedit"),t)};P("info",o.title||"",o.subtitle||"","",!1)}else P("info",U.get("checkout_initiated"),"",!1);a.options.onComplete&&b.getDocuments([a.options.document.id],{tenant:a.options.document.envId,securityContext:a.options.document.contextId,tenantUrl:a.options.platformUrls["3DSpace"],onComplete:function(e){if(e.success){if(!Array.isArray(e.data))return;a.options.onComplete({action:"Edit",data:e.data})}}})},n.onFailure=function(e){var t="Document";a.options.document&&a.options.document.data&&a.options.document.data.dataelements?t=a.options.document.data.dataelements.typeNLS||a.options.document.data.dataelements.type:a.options.document.type&&(t=a.options.document.type),e&&e.length>0&&e[0].updateMessage?P("error",U.get("YouCannotEditX",{typeNLS:t}),U.get("VerifyCredentials"),U.get("NotHaveRequiredAccessRole")):P("error",U.get("YouCannotEditX",{typeNLS:t}),e),console.error("Document Edit Failed Due to:")},F.MSFDocumentClient&&null===b.MSFDocumentClient&&(b.MSFDocumentClient=F.MSFDocumentClient),b.downloadDocument(a.options.document.id,a.options.document.fileid,!0,n)}else 0==a.options.document.data.files.length?P("error","",U.get("objectcontainsnofile"),"",!1):P("error","",U.get("Nomultifilesupport"),"",!1)}},O={title:U.get("Copy"),name:"Copy",text:U.get("Copy"),fonticon:"copy",handler:function(){var e=T(a.options);E.copy(e),a.options.onComplete({action:"Copy"})}},L={title:U.get("Paste"),name:"Paste",text:U.get("Paste"),fonticon:"paste",handler:function(){E.paste(a.options.onComplete)}},V={title:U.get("Relations"),name:"Relations",text:U.get("Relations"),fonticon:"object-related",handler:function(){var e=T(a.options);e.appId="ENORIPE_AP";var t=new l.Socket("compassPageSocket");t.subscribeServer("com.ds.compass",window.parent),t.dispatchEvent("onSetX3DContent",e,"compassPageSocket"),t.addListener("launchApp",function(e,n,o){t.unsubscribeServer("com.ds.compass"),t.disconnect()}),t.dispatchEvent("onLaunchApp",e,"compassPageSocket")}},k={title:U.get("CopyLink"),name:"CopyLink",text:U.get("CopyLink"),fonticon:"link",handler:function(){var t=void 0;a.options.document.data&&null==(t=a.options.document.data.title||a.options.document.data.name)&&a.options.document.data.dataelements&&(t=a.options.document.data.dataelements.title||a.options.document.data.dataelements.name);var i,l,c=(i=a.options,(l={protocol:"3DXContent",data:{items:[]}}).data.items.push({envId:i.document.envId,objectId:i.document.id,openLink:!0}),i.document.fileid&&(l.data.items[0].fileid=i.document.fileid,l.data.items[0].openFile=!0),l),r=e.createElement("div",{styles:{display:"flex"}}),u=new o("input",{attributes:{readonly:"readonly"}});u.getContent().setStyles({display:"inline-block","border-top-right-radius":0,"border-bottom-right-radius":0}),u.inject(r);var m=new n({value:U.get("CopyLink"),className:"block",events:{onClick:function(n){u.setFocus(),u.elements.input.select(),u.elements.input.setSelectionRange(0,99999),document.execCommand("cut"),p.hide(),P("success",U.get("LinkCopiedTitle"),t&&""!==t?e.String.format(U.get("LinkCopiedMsg"),t):U.get("LinkCopied"),"",!1,a.options.notificationTarget)}}});m.getContent().setStyles({display:"inline-block","border-top-left-radius":0,"border-bottom-left-radius":0,padding:"0 10px"}),m.inject(r);var p=new d({body:r,closeOnClick:!1,events:{onClickOutside:function(e){console.log("DDClickOutside")}}});p.options.target=this.options.target;var f=F.widgetDomain;null==f&&(f=s["3DDashboard"]),console.log(f),null==f?w.getPlatformServices({platformId:a.options.document.envId,onComplete:function(e){p.hide(),p.show(),u.setFocus(),u.setValue(e["3DDashboard"]+"#app:ENXWDOC_AP/content:X3DContentId="+encodeURIComponent(JSON.stringify(c))),u.elements.input.select(),u.elements.input.setSelectionRange(0,99999,"backward"),m.getContent().click()}}):(p.hide(),p.show(),u.setFocus(),u.setValue(f+"#app:ENXWDOC_AP/content:X3DContentId="+encodeURIComponent(JSON.stringify(c))),u.elements.input.select(),u.elements.input.setSelectionRange(0,99999,"backward"),m.getContent().click())}},W={title:U.get("ReplaceBy"),name:"ReplaceBy",text:U.get("ReplaceBy"),fonticon:"replace-by-revision",items:[{text:U.get("ReplacebyRevision"),title:U.get("ReplacebyRevision"),name:"ReplacebyRevision",fonticon:"replace-by-revision",handler:function(){this.platformUrls=a.options.platformUrls,this.securityContext=a.options.document.contextId,this.parentId=a.options.document.data.parentId,this.relName=a.options.document.data.relName,this.oldDocumentId=a.options.document.id,this.parentDirection=a.options.document.data.parentDirection,this.tenant=a.options.document.envId,this.tenantUrl=a.options.platformUrls["3DSpace"];var t=this;this.that=a;var n=e.createElement("div",{class:"revisionUpdate-dialog"}).inject(document.body);this._myVersionExplorer=new p({versionGraphContainer:null,selectionMode:g.SELECTION_MODES.SINGLE_SELECT_ONLY,widget:F}),this._myVersionExplorer.disableDrag(),this._myVersionExplorer.showDialog({x:100,y:100},n,!0),f.loadUserSettingsPromise({displayMode:g.DISPLAY_MODES.SUBWAY_VIEW,displayLegend:!0},!0),this._myVersionExplorer.publishEvent("ENOXVersionExplorerLoadVersionModel",{id:this.oldDocumentId,tenantId:a.options.document.envId,securityContext:this.securityContext,onComplete:function(){},dataModelType:g.DATA_MODEL_TYPES.MODEL_HISTORY}),this._myVersionExplorer.subscribeEvent("ENOXVersionExplorerModalOK",function(){var t=this.that,n=this;this._myVersionExplorer.unsubscribeAll();var o=this._myVersionExplorer.getSelectedNodes().shift(),i=o.getAttribute("id");if(i===n.oldDocumentId){console.log("selected revison and current revison is same.");var a={result:{message:U.SameRevision},action:"ReplacebyRevision",targetDocumentId:i};t.options.onComplete(a)}else if(""!==i&&null!=i){null==n.relName&&(n.relName="Reference Document");var s={onComplete:function(e){(e=e||{}).message=U.ReplacedRevision+" "+o.options.data.revision;var n={result:e,action:"ReplacebyRevision",targetDocumentId:i};t.options.onComplete(n)},onFailure:function(e,t){P("error","",t.error,"",!1)}};u.authenticatedRequest(n.platformUrls["3DSpace"]+"/resources/v1/application/E6WFoundation/CSRF",e.extend({},{method:"GET",url_temp:n.platformUrls["3DSpace"],onComplete:function(o){s.onComplete,s.onFailure;var a=n.platformUrls["3DSpace"]+"/resources/v1/modeler/documents/?parentRelName="+n.relName+"&parentDirection="+n.parentDirection+"&tenant="+n.platformUrls.platformId;s.type="json",s.url=encodeURI(a);var l=JSON.parse(o).csrf;s.data=JSON.stringify({csrf:l,data:[{id:n.oldDocumentId,updateAction:"NONE",relateddata:{parents:[{id:n.parentId,updateAction:"DELETE"}]}},{id:i,updateAction:"NONE",relateddata:{parents:[{id:n.parentId,updateAction:"CREATE"}]}}]}),s.headers={Accept:"application/json","Content-Type":"application/json",SecurityContext:n.securityContext},s.method="PUT",s.SecurityContext=n.securityContext,s.headers=e.merge(s.headers,e.is(t.options.getWorkUnderHeaders,"function")?t.options.getWorkUnderHeaders():{}),u.authenticatedRequest(s.url,s)}}))}}.bind(this)),this._myVersionExplorer.subscribeEvent("ENOXVersionExplorerModalCancel",M.bind(this)),this._dlgVersionExplorer=v._dlg,v._dlg&&v._dlg.rightButtons&&v._dlg.rightButtons.addEventListener("click",M.bind(this)),this._dlgVersionExplorer.getFooter().getChildren()[0].disabled=!0,this._myVersionExplorer.subscribeEvent("select",function(e){t._dlgVersionExplorer.isVisible&&(t._dlgVersionExplorer.getFooter().getChildren()[0].disabled=!1)}),this._myVersionExplorer.subscribeEvent("unselect",function(e){t._dlgVersionExplorer.isVisible&&(t._dlgVersionExplorer.getFooter().getChildren()[0].disabled=!0)})}},{text:U.get("ReplacebyLatestRevision"),title:U.get("ReplacebyLatestRevision"),name:"ReplacebyLatestRevision",fonticon:"replace-by-latest-version",handler:function(){var t=a.options.platformUrls,n=a.options.document.contextId,o=a.options.document.data.parentId,i=a.options.document.data.relName,s=a.options.document.id,l=a.options.document.data.parentDirection,c={};c.data=JSON.stringify({lastVersionRequests:[{id:s}]}),c.onComplete=function(c){if((c=JSON.parse(c)).lastVersionRequests[0].islast){console.log("Existing document is in latest revision.");var r={result:c={message:U.WarningLatestRevision},action:"ReplacebyLatestRevision",targetDocumentId:s};a.options.onComplete(r)}else{var d=c.lastVersionRequests[0].candidates[0],m={onComplete:function(e){(e={}).message=U.get("ReplacedByLatest");var t={result:e,action:"ReplacebyLatestRevision",targetDocumentId:d};a.options.onComplete(t)},onFailure:function(e,t){P("error","",t.error,"",!1)}};u.authenticatedRequest(t["3DSpace"]+"/resources/v1/application/E6WFoundation/CSRF",e.extend({},{method:"GET",url_temp:t["3DSpace"],onComplete:function(c){m.onComplete,m.onFailure;var r=t["3DSpace"]+"/resources/v1/modeler/documents/?parentRelName="+i+"&parentDirection="+l+"&tenant=OnPremise";m.type="json",m.url=encodeURI(r);var p=JSON.parse(c).csrf;m.data=JSON.stringify({csrf:p,data:[{id:s,updateAction:"NONE",relateddata:{parents:[{id:o,updateAction:"DELETE"}]}},{id:d,updateAction:"NONE",relateddata:{parents:[{id:o,updateAction:"CREATE"}]}}]}),m.headers={Accept:"application/json","Content-Type":"application/json",SecurityContext:n},m.headers=e.merge(m.headers,e.is(a.options.getWorkUnderHeaders,"function")?a.options.getWorkUnderHeaders():{}),m.method="PUT",m.SecurityContext=n,u.authenticatedRequest(m.url,m)}}))}},c.onFailure=function(e){console.log("Get Latest version failed."+e),P("error",e.data[0].updateMessage,"","",!1)},c.method="POST",c.headers={Accept:"application/json","Content-Type":"application/json",securitycontext:n},c.proxy="passport",c.url=t["3DSpace"]+h.LATEST_REVISION,u.authenticatedRequest(c.url,c)}}]},j={title:U.get("Remove"),name:"Remove",text:U.get("Remove"),fonticon:"remove",handler:function(){var e={relInfo:{parentId:a.options.document.data.parentId,parentRelName:a.options.document.data.relName,parentDirection:a.options.document.data.parentDirection},tenant:a.options.document.envId,securityContext:a.options.document.contextId,tenantUrl:a.options.platformUrls["3DSpace"],onFailure:function(e){(e=JSON.parse(e)).message=U.DocumentDisconnectFailed;y.REMOVE,a.options.document.id},onComplete:function(e){console.log("Disconnect document completed.");var t={result:{message:U.DocumentDisconnect},action:y.REMOVE,targetDocumentId:a.options.document.id};a.options.onComplete(t)}};b.disconnectDocumentFromParent(a.options.document.id,e)}},_={title:U.get("NewRevision"),name:"New Revision",text:U.get("NewRevision"),fonticon:"flow-line-add",handler:function(){var t=void 0;a.options.document.data&&null==(t=a.options.document.data.title||a.options.document.data.name)&&a.options.document.data.dataelements&&(t=a.options.document.data.dataelements.title||a.options.document.data.dataelements.name);var n=a.options.platformUrls,o=a.options.document.contextId,i=(a.options.document.data.parentId,a.options.document.data.relName,a.options.document.id),s=a.options.document.envId,l=(a.options.document.data.parentDirection,{});l.data=JSON.stringify({data:[{physicalid:i,folderid:null}]}),l.onComplete=function(i){"success"==(i=JSON.parse(i)).status?(P("success","",e.String.format(U.get("NewRevisionSuccessfulMsg"),t),"",!1),a.options.onComplete&&b.getDocuments([i.results[0].physicalid],{tenant:s,securityContext:o,tenantUrl:n["3DSpace"],onComplete:function(e){if(e.success){if(!Array.isArray(e.data))return;a.options.onComplete({action:"New Revision",data:e.data})}}})):"failure"==i.status&&(console.log(i.status+" : "+i.report[0].error),P("error","",i.report[0].error,"",!1))},l.onFailure=function(e){console.log("Get Latest version failed."+e),P("error",e.data[0].updateMessage,"","",!1)},l.method="POST",l.headers={Accept:"application/json","Content-Type":"application/json",securitycontext:o},l.headers=e.merge(l.headers,e.is(a.options.getWorkUnderHeaders,"function")?a.options.getWorkUnderHeaders():{}),l.proxy="passport",l.url=n["3DSpace"]+h.NEW_REVISION+"?tenant="+s,u.authenticatedRequest(l.url,l)}},H={title:U.get("UndoEdit"),name:y.UNDO_EDIT,text:U.get("UndoEdit"),fonticon:"undo",handler:function(){var t=void 0;a.options.document.data&&null==(t=a.options.document.data.title||a.options.document.data.name)&&a.options.document.data.dataelements&&(t=a.options.document.data.dataelements.title||a.options.document.data.dataelements.name),1==a.options.document.data.files.length?u.authenticatedRequest(s["3DSpace"]+"/resources/v1/application/E6WFoundation/CSRF",{method:"GET",url_temp:s["3DSpace"],onComplete:function(n){var o={};o.tenant=a.options.document.envId,o.securityContext=a.options.document.contextId,o.tenantUrl=a.options.platformUrls["3DSpace"],o.onComplete=function(n){P("success","",e.String.format(U.get("Editoperationcancelled"),t),!1),a.options.onComplete&&b.getDocuments([a.options.document.id],{tenant:a.options.document.envId,securityContext:a.options.document.contextId,tenantUrl:a.options.platformUrls["3DSpace"],onComplete:function(e){if(e.success){if(!Array.isArray(e.data))return;a.options.onComplete({action:"UndoEdit",data:e.data})}}})},o.onFailure=function(e,t){P("error","",t.error,"",!1)};var i=o.tenantUrl+"/resources/v1/modeler/documents/"+a.options.document.id+"/unlock";o.type="json",o.url=i,o.data=JSON.stringify({csrf:JSON.parse(n).csrf}),o.headers=o.headers||{Accept:"*/*","Content-Type":"application/ds-json"},o.method="POST",u.authenticatedRequest(i,o)}}):0==a.options.document.data.files.length?P("error","",U.get("objectcontainsnofile"),"",!1):P("error","",U.get("Nomultifilesupport"),"",!1)}},X={title:U.get("Update"),name:"Update",text:U.get("Update"),fonticon:"update",handler:function(){var t=void 0;a.options.document.data&&null==(t=a.options.document.data.title||a.options.document.data.name)&&a.options.document.data.dataelements&&(t=a.options.document.data.dataelements.title||a.options.document.data.dataelements.name);var n=void 0;if(a.options.document.data.revision?n=a.options.document.data.revision:a.options.document.data.dataelements&&(n=a.options.document.data.dataelements.revision),n&&(t=t+" "+n),1==a.options.document.data.files.length){var o=e.createElement("input",{attributes:{id:"btnUpload_chooser",type:"file",multiple:!1},styles:{display:"none"},events:{change:function(e){if(e.target&&e.target.files&&e.target.files.length>0||e.dataTransfer&&e.dataTransfer.files){var n=e.target&&e.target.files&&e.target.files.length>0?e.target.files:e.dataTransfer.files;if(0==n.length&&(n=e.detail.files),n.length>1)throw U.get("Cannotselectmorethanonefile");1==n.length?a.file=n[0]:a.file=null}else a.file=null;if(a.options.document.data.files&&a.file)if(a.options.document.data.files[0].dataelements.title!=a.file.name){var s='<div style="display: flex;"><span class="fonticon fonticon-attention text-warning fonticon-2x"></span><p style="margin-left: 10px; white-space: pre-line">'+U.get("UpdateConfirmationMsg",{newFileName:a.file.name,oldFileName:a.options.document.data.files[0].dataelements.title})+"</p></div>",l=new i({className:"site-reset",header:U.get("UpdateConfirmation",{documentTitle:t}),body:s,footer:'<button type="button" class="btn btn-primary">'+U.get("Update")+'</button> <button type="button" class="btn btn-default">'+U.get("Cancel")+"</button>",animate:!0,resizable:!0,autocenter:!0,visible:!0,limitParent:!0,overlay:!0,closable:!1});l.show(),l.elements.container.setStyle("z-index","50000"),l.inject(F.body),l.getContent().getElements(".btn.btn-primary").forEach(function(e){e.addEvent("click",function(){X.sendFile(a.file,t),l.hide(),l.destroy()})}),l.getContent().getElements(".btn.btn-default").forEach(function(e){e.addEvent("click",function(){l.hide(),l.destroy()})})}else X.sendFile(a.file,t);o.destroy()}}}).inject(F.body);o.click()}else 0==a.options.document.data.files.length?P("error","",U.get("objectcontainsnofile"),"",!1):P("error","",U.get("Nomultifilesupport"),"",!1)},sendFile:function(t,n){var o={tenant:a.options.document.envId,securityContext:a.options.document.contextId,tenantUrl:a.options.platformUrls["3DSpace"],onFailure:function(e){x.jobs.finishJob(l,"failed");var t="Document";if(a.options.document&&a.options.document.data&&a.options.document.data.dataelements?t=a.options.document.data.dataelements.typeNLS||a.options.document.data.dataelements.type:a.options.document.type&&(t=a.options.document.type),e&&e.length>0&&e[0].updateMessage)P("error",U.get("YouCannotUpdateX",{typeNLS:t}),U.get("VerifyCredentials"),U.get("NotHaveRequiredAccessRole"));else if(e&&e.error)if((e.error.match(/\n/g)||[]).length>=2){for(var n=e.error.split("\n"),o=[],i=2;i<n.length;i++)o.push(n[i]);o=o.join("<br/>"),P("error",n[0],n[1],o,void 0,void 0,!0)}else P("error",U.get("YouCannotUpdateX",{typeNLS:t}),e.error);else P("error",U.get("YouCannotUpdateX",{typeNLS:t}),e);console.error("Document Update Failed Due to:"),console.error(e)},onProgress:function(e){l.update(e)},onComplete:function(t){x.jobs.finishJob(l),P("success",U.get("Fileuploadsuccessful"),e.String.format(U.get("FileuploadsuccessfulMsg"),n),"",!1),a.options.onComplete&&a.options.onComplete({action:"Update",data:t.data})}},i={file:t};t.name&&(i.fileName=t.name);var s={id:a.options.document.id,fileInfo:i},l={title:U.get("UPLOADING_X",{title:a.file.name}),ui:!!s.fileInfo,process:function(){l.xhr=b.modifyDocument(s,o)}};x.jobs.addJob(l)}},J={title:U.get("Delete"),name:"Delete",text:U.get("Delete"),fonticon:"trash",handler:function(){var t=void 0;a.options.document.data&&null==(t=a.options.document.data.title||a.options.document.data.name)&&a.options.document.data.dataelements&&(t=a.options.document.data.dataelements.title||a.options.document.data.dataelements.name);var n=void 0;a.options.document.data.revision?n=a.options.document.data.revision:a.options.document.data.dataelements&&(n=a.options.document.data.dataelements.revision),n&&(t=t+" "+n);var o=e.createElement("div",{styles:{display:"flex"}});e.createElement("span",{styles:{color:"red"},class:"fonticon fonticon-attention fonticon-2x"}).inject(o);var s=e.createElement("p");s.innerText=e.String.format(U.get("DeleteConfirmation"),t),s.inject(o);var l=o,c=new i({className:"site-reset",closable:!0,header:U.get("Delete"),body:l,footer:'<button type="button" class="btn btn-primary">'+U.get("Ok")+'</button> <button type="button" class="btn btn-default">'+U.get("Cancel")+"</button>",animate:!0,resizable:!0,autocenter:!0,visible:!0,limitParent:!0,overlay:!0});c.show(),c.inject(F.body);var r={onComplete:function(n){P("success",U.get("DeletionSuccessful"),e.String.format(U.get("DeletionSuccessfulMsg"),t),"",!1),a.options.onComplete&&a.options.onComplete({action:"Delete"})},onFailure:function(e){P("error","",e.error,"",!1)}};r.tenant=a.options.document.envId,r.securityContext=a.options.document.contextId,r.tenantUrl=a.options.platformUrls["3DSpace"],c.getContent().getElements(".btn.btn-primary").forEach(function(e){e.addEvent("click",function(){b.deleteDocument(a.options.document.id,r),c.hide(),c.destroy()})}),c.getContent().getElements(".btn.btn-default").forEach(function(e){e.addEvent("click",function(){c.hide(),c.destroy()})})}},q={title:U.get("Maturity"),name:"Maturity",text:U.get("Maturity"),fonticon:"collaborative-lifecycle-management",handler:function(){a.options.document.contextId,a.options.document.envId;(new m).executeAsync([{physicalId:a.options.document.id}]).then(function(e,t,n){console.log("Maturity view.");var o={result:{message:"Maturity View."},action:"maturity",targetDocumentId:a.options.document.id};a.options.onComplete(o)})}},B={title:U.get("Share"),name:"Share",text:U.get("Share"),fonticon:"share",handler:function(){var e=void 0;a.options.document.data&&null==(e=a.options.document.data.title||a.options.document.data.name)&&a.options.document.data.dataelements&&(e=a.options.document.data.dataelements.title||a.options.document.data.dataelements.name),require(["DS/ENOCollabSharingCmds/BaseModels/ResultElement","DS/SharePopup/SharePopup"],function(t,n){var o=[new t({physicalId:a.options.document.id,name:e})];a.sharePanel?(a.sharePanel.show(o),a.sharePanel.container.centerIt()):(a.sharePanel=new n(F,F.body,{removeAtClose:!0,events:{onClose:function(){a.sharePanel=null}}}),a.sharePanel.show(o))})}},Y=!1,z=!1;if(a.options.document.data&&a.options.document.data.files&&a.options.document.data.files.length>1&&(z=!0),a.options.document.data&&a.options.document.data.files&&0!=a.options.document.data.files.length&&(Y=""!=a.options.document.data.files[0].dataelements.locker),void 0===c){var G={};return a.options.document.type?a.supportedTypes.includes(a.options.document.type)?(G[y.PREVIEW]=S,G[y.PREVIEW2]=C,G[y.REPLACE_BY_REVISION]=W,G[y.MATURITY]=q,G[y.DOWNLOAD]=A,G[y.SHARE]=B,G[y.COPY_LINK]=k,G[y.RELATION]=V,G[y.REMOVE]=j,G[y.NEW_REVISION]=_,G[y.DELETE]=J,G[y.COPY]=O,E.contentCopied&&(G[y.PASTE]=L),(a.options.document.filesCallback||a.options.document.data&&a.options.document.data.files)&&(G[y.UPDATE]=X,!Y||z?G[y.EDIT]=R:G[y.UNDO_EDIT]=H)):(G[y.MATURITY]=q,G[y.RELATION]=V,G[y.REMOVE]=j):(G[y.PREVIEW]=S,G[y.PREVIEW2]=C,G[y.REPLACE_BY_REVISION]=W,G[y.MATURITY]=q,G[y.DOWNLOAD]=A,G[y.SHARE]=B,G[y.COPY_LINK]=k,G[y.RELATION]=V,G[y.REMOVE]=j,G[y.NEW_REVISION]=_,G[y.DELETE]=J,G[y.COPY]=O,E.contentCopied&&(G[y.PASTE]=L),(a.options.document.filesCallback||a.options.document.data&&a.options.document.data.files)&&(G[y.UPDATE]=X,!Y||z?G[y.EDIT]=R:G[y.UNDO_EDIT]=H)),a.options.renderToArray?Object.values(G):G}D={index:r},c.addItem(e.merge(D,S)),D={index:r+=1},c.addItem(e.merge(D,W)),D={index:r+=1},c.addItem(e.merge(D,q)),D={index:r+=1},c.addItem(e.merge(D,A)),D={index:r+=1},c.addItem(e.merge(D,B)),D={index:r+=1},c.addItem(e.merge(D,k)),D={index:r+=1},c.addItem(e.merge(D,V)),D={index:r+=1},c.addItem(e.merge(D,j)),D={index:r+=1},c.addItem(e.merge(D,_)),D={index:r+=1},c.addItem(e.merge(D,J)),D={index:r+=1},c.addItem(e.merge(D,X)),D={index:r+=1},!Y||z?c.addItem(e.merge(D,R)):c.addItem(e.merge(D,H))}return A.prototype.init=function(e){var n=this;this.options=e,this.supportedTypes=["Document","Quality System Document","Technical Document"],C.setup(n.options.platformUrls);var o=new t(function(e,t){C.getTypeDerivatives(n.supportedTypes,function(t){var o=[];n.supportedTypes.length>0&&(n.supportedTypes.forEach(e=>{o.push(...t[e])}),n.supportedTypes=o),e(!0)},n.options.platformUrls["3DSpace"])});return F&&F.app&&F.app.jobs&&"doco-jobs"==F.app.jobs.name&&F.app.progressPane&&"doco-progress"==F.app.progressPane.name?x=F.app:(null==x.jobs&&require(["DS/DocumentCommands/Jobs"],function(e){null==x.jobs&&(x.jobs=new e(x))}),null==x.progressPane&&require(["DS/DocumentCommands/ProgressPane"],function(e){null==x.progressPane&&(x.progressPane=new e(x),x.progressPane.inject(F.body))}),null==x.modelEvents&&(x.modelEvents=new c,x.modelEvents.ownedBy="ENOXDocumentCommands")),o},A.prototype.render=function(){var e=this,n=e.options.contextmenu,o=e.options.platformUrls,i={};if(e.options.document.data&&e.options.document.data.relateddata&&e.options.document.data.relateddata.files&&(e.options.document.data.files=e.options.document.data.relateddata.files),null!=e.options.document.data&&null!=e.options.document.data.files||!n&&!e.options.document.filesCallback){if(void 0===n)return i=R(e,o);R(e,o,n)}else{null==e.options.document.data&&(e.options.document.data={files:{}});var a={tenant:o.platformId,securityContext:e.options.document.contextId,tenantUrl:e.options.platformUrls["3DSpace"],additionalURLParams:"$include=none,files"};new t(function(t,n){a.onComplete=t,a.onFailure=n,b.getDocuments([e.options.document.id],a)}).then(function(t){e.options.document.data.files=t.data[0].relateddata.files,null==e.options.document.data&&(e.options.document.data={}),null==e.options.document.data.relateddata&&(e.options.document.data.relateddata={}),e.options.document.data.relateddata.files=t.data[0].relateddata.files,void 0!==n?R(e,o,n):(i=R(e,o),e.options.document.filesCallback(i))},function(e){console.error("Failed to get file Info",e)})}},A}),define("DS/DocumentCommands/V2/Actions/Unlock",["UWA/Core","DS/WAFData/WAFData","DS/DocumentCommands/Helper","UWA/Promise","i18n!DS/DocumentCommands/assets/nls/DocumentCommands","css!DS/DocumentCommands/DocumentCommands.css"],function(e,t,n,o,i){"use strict";var a=function(e){return{id:"Unlock",dataElements:{docV2Public:!0,typeRepresentation:"functionIcon",icon:{iconName:"lock-open",fontIconFamily:1},label:i.get("Unlock"),tooltip:i.get("Unlock"),position:"far",category:"edit",value:function(t){t.options=e,a.execute(t)},visibleFlag:!1},execute:function(){a.execute({options:e})},updateForSelection:function(t,i){return new o(function(o){n.CalculateDocumentModificationCommandsVisibility(e).then(function(e){t({visibleFlag:e.Unlock})}),o(!0)})}}};return a.execute=function(n){var o=n.options.getSelectedNodes()[0],a=n.options.getDocumentFromNodeModel(o),s=[];a.files?s=a.files:a.relateddata&&a.relateddata.files&&(s=a.relateddata.files);var l=void 0;a&&null==(l=a.title||a.name)&&a.dataelements&&(l=a.dataelements.title||a.dataelements.name),1==s.length&&t.authenticatedRequest(n.options.platformUrls["3DSpace"]+"/resources/v1/application/E6WFoundation/CSRF",{method:"GET",url_temp:n.options.platformUrls["3DSpace"],onComplete:function(s){var c={};c.tenant=n.options.platformUrls.platformId,c.securityContext=n.options.fetchSecurityContext(),c.tenantUrl=n.options.platformUrls["3DSpace"],c.onComplete=function(t){n.options.events.publish({event:"docv2-show-notification",data:{level:"success",title:"",subtitle:e.String.format(i.get("Editoperationcancelled"),l),message:"",sticky:!1,allowUnsafeHTML:!1}}),n.options.events&&n.options.events.publish({event:"docv2-undoedit-complete",data:{nodeModel:o}})},c.onFailure=function(e,t){n.options.events.publish({event:"docv2-show-notification",data:{level:"error",title:"",subtitle:t.error,message:"",sticky:!1,allowUnsafeHTML:!1}})};var r=c.tenantUrl+"/resources/v1/modeler/documents/"+a.id+"/unlock";c.type="json",c.url=r,c.data=JSON.stringify({csrf:JSON.parse(s).csrf}),c.headers=c.headers||{Accept:"*/*","Content-Type":"application/ds-json"},c.method="POST",t.authenticatedRequest(r,c)}})},a}),define("DS/DocumentCommands/V2/Actions/Subscription",["DS/DocumentCommands/V2/Actions/Subscription/Subscribe","DS/DocumentCommands/V2/Actions/Subscription/UnSubscribe","DS/DocumentCommands/V2/Actions/Subscription/EditSubscriptions","DS/DocumentCommands/V2/Actions/Subscription/MySubscriptions","DS/DocumentCommands/V2/ConvertCmdToWebUX","UWA/Promise","i18n!DS/DocumentCommands/assets/nls/DocumentCommands"],function(e,t,n,o,i,a,s){"use strict";return function(l){var c=new e(l),r=new t(l),d=new n(l),u=new o(l);return{id:"Subscription",dataElements:{docV2Public:!0,typeRepresentation:"functionMenuIcon",icon:{iconName:"bell-add",fontIconFamily:1},label:s.get("Subscription"),tooltip:s.get("Subscription"),position:"far",category:"information",value:{menu:i([c,r,d,u])},visibleFlag:!1},updateForSelection:function(e,t){return new a(function(t){e({visibleFlag:l.getSelectedNodes().length>=1}),t(!0)})}}}}),define("DS/DocumentCommands/V2/Actions/Update",["UWA/Core","UWA/Promise","DS/UIKIT/Modal","DS/DocumentManagement/DocumentManagement","DS/DocumentCommands/Helper","i18n!DS/DocumentCommands/assets/nls/DocumentCommands"],function(e,t,n,o,i,a){"use strict";var s=function(e){return{id:"Update",dataElements:{docV2Public:!0,typeRepresentation:"functionIcon",icon:{iconName:"update",fontIconFamily:1},label:a.get("Update"),tooltip:a.get("Update"),position:"far",category:"edit",value:function(t){t.options=e,s.execute(t)},visibleFlag:!1},execute:function(){s.execute({options:e})},updateForSelection:function(n,o){return new t(function(t){i.CalculateDocumentModificationCommandsVisibility(e).then(function(e){n({visibleFlag:e.Update}),t(!0)})})}}};function l(t,n,i,s){var l={},c=i.options.getDocumentFromNodeModel(t);l.tenant=i.options.platformUrls.platformId,l.securityContext=i.options.fetchSecurityContext(),l.tenantUrl=i.options.platformUrls["3DSpace"],l.onFailure=function(e){i.options.getJobsProcessorPromise.then(function(e){e.finishJob(u,"failed")});var n="Document";if(c&&c.dataelements?n=c.dataelements.typeNLS||c.dataelements.type:t.options.type&&(n=t.options.type),e&&e.length>0&&e[0].updateMessage)i.options.events.publish({event:"docv2-show-notification",data:{level:"error",title:a.get("YouCannotUpdateX",{typeNLS:n}),subtitle:a.get("VerifyCredentials"),message:a.get("NotHaveRequiredAccessRole"),sticky:!1,allowUnsafeHTML:!1}});else if(e&&e.error)if((e.error.match(/\n/g)||[]).length>=2){for(var o=e.error.split("\n"),s=[],l=2;l<o.length;l++)s.push(o[l]);s=s.join("<br/>"),i.options.events.publish({event:"docv2-show-notification",data:{level:"error",title:o[0],subtitle:o[1],message:s,sticky:!1,allowUnsafeHTML:!0}})}else i.options.events.publish({event:"docv2-show-notification",data:{level:"error",title:a.get("YouCannotUpdateX",{typeNLS:n}),subtitle:e.error,message:"",sticky:!1,allowUnsafeHTML:!1}});else i.options.events.publish({event:"docv2-show-notification",data:{level:"error",title:a.get("YouCannotUpdateX",{typeNLS:n}),subtitle:e,message:"",sticky:!1,allowUnsafeHTML:!1}});console.error("Document Update Failed Due to:"),console.error(e)},l.onProgress=function(e){u.update(e)},l.onComplete=function(n){i.options.getJobsProcessorPromise.then(function(e){e.finishJob(u)}),i.options.events.publish({event:"docv2-show-notification",data:{level:"success",title:a.get("Fileuploadsuccessful"),subtitle:e.String.format(a.get("FileuploadsuccessfulMsg"),s),message:"",sticky:!1,allowUnsafeHTML:!1}}),i.options.events.publish({event:"docv2-update-complete",data:{nodeModel:t,data:n.data}})};var r={file:n};n.name&&(r.fileName=n.name);var d={id:c.id,fileInfo:r},u={title:a.get("UPLOADING_X",{title:n.name}),ui:!!d.fileInfo,process:function(){u.xhr=o.modifyDocument(d,l)}};i.options.getJobsProcessorPromise.then(function(e){e.addJob(u)})}return s.execute=function(e){let t=e.options.platformUrls.platformId;var n=e.options.getSelectedNodes()[0],o=e.options.getDocumentFromNodeModel(n),l=[];(o.files?l=o.files:o.relateddata&&o.relateddata.files&&(l=o.relateddata.files),"OnPremise"!=t&&1==l.length)?i.IsWebEditionDocumentSessionActive(e.options.platformUrls.platformId,o.id).then(t=>{t&&t.opened?e.options.events.publish({event:"docv2-show-notification",data:{level:"warning",title:"",subtitle:a.get("UpdateErrorMessageAsWebEditionSessionActive"),message:"",sticky:!1,allowUnsafeHTML:!0}}):s.executeUpdate(e)}).catch(t=>{s.executeUpdate(e)}):s.executeUpdate(e)},s.executeUpdate=function(t){var o=t.options.getSelectedNodes()[0],i=t.options.getDocumentFromNodeModel(o),s=[];i.files?s=i.files:i.relateddata&&i.relateddata.files&&(s=i.relateddata.files);var c=void 0;i&&null==(c=i.title||i.name)&&i.dataelements&&(c=i.dataelements.title||i.dataelements.name);var r=void 0;if(i.revision?r=i.revision:i.dataelements&&(r=i.dataelements.revision),r&&(c=c+" "+r),1==s.length){var d=e.createElement("input",{attributes:{id:"btnUpload_chooser",type:"file",multiple:!1},styles:{display:"none"},events:{change:function(e){var i;if(e.target&&e.target.files&&e.target.files.length>0||e.dataTransfer&&e.dataTransfer.files){var r=e.target&&e.target.files&&e.target.files.length>0?e.target.files:e.dataTransfer.files;if(0==r.length&&(r=e.detail.files),r.length>1)throw a.get("Cannotselectmorethanonefile");i=1==r.length?r[0]:null}else i=null;if(r&&i)if(s[0].dataelements.title!=i.name){var u='<div style="display: flex;"><span class="fonticon fonticon-attention text-warning fonticon-2x"></span><p style="margin-left: 10px; white-space: pre-line">'+a.get("UpdateConfirmationMsg",{newFileName:i.name,oldFileName:s[0].dataelements.title})+"</p></div>",m=new n({className:"site-reset",header:a.get("UpdateConfirmation",{documentTitle:c}),body:u,footer:'<button type="button" class="btn btn-primary">'+a.get("Update")+'</button> <button type="button" class="btn btn-default">'+a.get("Cancel")+"</button>",animate:!0,resizable:!0,autocenter:!0,visible:!0,limitParent:!0,overlay:!0,closable:!1});m.show(),m.elements.container.setStyle("z-index","50000"),m.inject(widget.body),m.getContent().getElements(".btn.btn-primary").forEach(function(e){e.addEvent("click",function(){l(o,i,t,c),m.hide(),m.destroy()})}),m.getContent().getElements(".btn.btn-default").forEach(function(e){e.addEvent("click",function(){m.hide(),m.destroy()})})}else l(o,i,t,c);d.destroy()}}}).inject(widget.body);d.click()}else 0==s.length?t.options.events.publish({event:"docv2-show-notification",data:{level:"error",title:"",subtitle:a.get("objectcontainsnofile"),message:"",sticky:!1,allowUnsafeHTML:!1}}):t.options.events.publish({event:"docv2-show-notification",data:{level:"error",title:"",subtitle:a.get("Nomultifilesupport"),message:"",sticky:!1,allowUnsafeHTML:!1}})},s}),define("DS/DocumentCommands/V2/Actions/UpdateAndUnlock",["UWA/Core","DS/UIKIT/Modal","DS/DocumentManagement/DocumentManagement","DS/DocumentCommands/Helper","UWA/Promise","i18n!DS/DocumentCommands/assets/nls/DocumentCommands"],function(e,t,n,o,i,a){"use strict";var s=function(e){return{id:"UpdateAndUnlock",dataElements:{docV2Public:!0,typeRepresentation:"functionIcon",icon:{iconName:"update",fontIconFamily:1},label:a.get("UpdateAndUnlock"),tooltip:a.get("UpdateAndUnlock"),position:"far",category:"edit",value:function(t){t.options=e,s.execute(t)},visibleFlag:!1},execute:function(){s.execute({options:e})},updateForSelection:function(t,n){return new i(function(n){o.CalculateDocumentModificationCommandsVisibility(e).then(function(e){t({visibleFlag:e.UpdateAndUnlock}),n(!0)})})}}};function l(t,o,i,s){var l={},c=i.options.getDocumentFromNodeModel(t);l.tenant=i.options.platformUrls.platformId,l.securityContext=i.options.fetchSecurityContext(),l.tenantUrl=i.options.platformUrls["3DSpace"],l.onFailure=function(e){i.options.getJobsProcessorPromise.then(function(e){e.finishJob(u,"failed")});var n="Document";if(c&&c.dataelements?n=c.dataelements.typeNLS||c.dataelements.type:t.options.type&&(n=t.options.type),e&&e.length>0&&e[0].updateMessage)i.options.events.publish({event:"docv2-show-notification",data:{level:"error",title:a.get("YouCannotUpdateX",{typeNLS:n}),subtitle:a.get("VerifyCredentials"),message:a.get("NotHaveRequiredAccessRole"),sticky:!1,allowUnsafeHTML:!1}});else if(e&&e.error)if((e.error.match(/\n/g)||[]).length>=2){for(var o=e.error.split("\n"),s=[],l=2;l<o.length;l++)s.push(o[l]);s=s.join("<br/>"),i.options.events.publish({event:"docv2-show-notification",data:{level:"error",title:o[0],subtitle:o[1],message:s,sticky:!1,allowUnsafeHTML:!0}})}else i.options.events.publish({event:"docv2-show-notification",data:{level:"error",title:a.get("YouCannotUpdateX",{typeNLS:n}),subtitle:e.error,message:"",sticky:!1,allowUnsafeHTML:!1}});else i.options.events.publish({event:"docv2-show-notification",data:{level:"error",title:a.get("YouCannotUpdateX",{typeNLS:n}),subtitle:e,message:"",sticky:!1,allowUnsafeHTML:!1}});console.error("Document Update Failed Due to:"),console.error(e)},l.onProgress=function(e){u.update(e)},l.onComplete=function(n){i.options.getJobsProcessorPromise.then(function(e){e.finishJob(u)}),i.options.events.publish({event:"docv2-show-notification",data:{level:"success",title:a.get("Fileuploadsuccessful"),subtitle:e.String.format(a.get("FileuploadsuccessfulMsg"),s),message:"",sticky:!1,allowUnsafeHTML:!1}}),i.options.events.publish({event:"docv2-update-complete",data:{nodeModel:t,data:n.data}})};var r={file:o};o.name&&(r.fileName=o.name);var d={id:c.id,fileInfo:r},u={title:a.get("UPLOADING_X",{title:o.name}),ui:!!d.fileInfo,process:function(){u.xhr=n.modifyDocument(d,l)}};i.options.getJobsProcessorPromise.then(function(e){e.addJob(u)})}return s.execute=function(e){let t=e.options.platformUrls.platformId;var n=e.options.getSelectedNodes()[0],o=e.options.getDocumentFromNodeModel(n),i=[];o.files?i=o.files:o.relateddata&&o.relateddata.files&&(i=o.relateddata.files),"OnPremise"!=t&&1==i.length?require(["DS/OfficeDocumentEditorClient/Editor"],function(t){t.state({key:o.id}).then(t=>{t&&t.opened?widget.app.events.publish({event:"docv2-show-notification",data:{level:"warning",title:"",subtitle:a.get("UpdateErrorMessageAsWebEditionSessionActive"),message:"",sticky:!1,allowUnsafeHTML:!0}}):s.executeUpdate(e)}).catch(t=>{s.executeUpdate(e)})}):s.executeUpdate(e)},s.executeUpdate=function(n){var o=n.options.getSelectedNodes()[0],i=n.options.getDocumentFromNodeModel(o),s=[];i.files?s=i.files:i.relateddata&&i.relateddata.files&&(s=i.relateddata.files);var c=void 0;i&&null==(c=i.title||i.name)&&i.dataelements&&(c=i.dataelements.title||i.dataelements.name);var r=void 0;if(i.revision?r=i.revision:i.dataelements&&(r=i.dataelements.revision),r&&(c=c+" "+r),1==s.length){var d=e.createElement("input",{attributes:{id:"btnUpload_chooser",type:"file",multiple:!1},styles:{display:"none"},events:{change:function(e){var i;if(e.target&&e.target.files&&e.target.files.length>0||e.dataTransfer&&e.dataTransfer.files){var r=e.target&&e.target.files&&e.target.files.length>0?e.target.files:e.dataTransfer.files;if(0==r.length&&(r=e.detail.files),r.length>1)throw a.get("Cannotselectmorethanonefile");i=1==r.length?r[0]:null}else i=null;if(r&&i)if(s[0].dataelements.title!=i.name){var u='<div style="display: flex;"><span class="fonticon fonticon-attention text-warning fonticon-2x"></span><p style="margin-left: 10px; white-space: pre-line">'+a.get("UpdateConfirmationMsg",{newFileName:i.name,oldFileName:s[0].dataelements.title})+"</p></div>",m=new t({className:"site-reset",header:a.get("UpdateConfirmation",{documentTitle:c}),body:u,footer:'<button type="button" class="btn btn-primary">'+a.get("Update")+'</button> <button type="button" class="btn btn-default">'+a.get("Cancel")+"</button>",animate:!0,resizable:!0,autocenter:!0,visible:!0,limitParent:!0,overlay:!0,closable:!1});m.show(),m.elements.container.setStyle("z-index","50000"),m.inject(widget.body),m.getContent().getElements(".btn.btn-primary").forEach(function(e){e.addEvent("click",function(){l(o,i,n,c),m.hide(),m.destroy()})}),m.getContent().getElements(".btn.btn-default").forEach(function(e){e.addEvent("click",function(){m.hide(),m.destroy()})})}else l(o,i,n,c);d.destroy()}}}).inject(widget.body);d.click()}},s}),define("DS/DocumentCommands/V2/Actions/UndoEdit",["UWA/Core","DS/WAFData/WAFData","DS/DocumentCommands/Helper","UWA/Promise","i18n!DS/DocumentCommands/assets/nls/DocumentCommands","css!DS/DocumentCommands/DocumentCommands.css"],function(e,t,n,o,i){"use strict";var a=function(e){return{id:"UndoEdit",dataElements:{docV2Public:!0,typeRepresentation:"functionIcon",icon:{iconName:"pencil-block",fontIconFamily:1},label:i.get("UndoEdit"),tooltip:i.get("UndoEdit"),position:"far",category:"edit",value:function(t){t.options=e,a.execute(t)},visibleFlag:!1},execute:function(){a.execute({options:e})},updateForSelection:function(t,i){return new o(function(o){n.CalculateDocumentModificationCommandsVisibility(e).then(function(e){t({visibleFlag:e.UndoEdit})}),o(!0)})}}};return a.execute=function(n){var o=n.options.getSelectedNodes()[0],a=n.options.getDocumentFromNodeModel(o),s=[];a.files?s=a.files:a.relateddata&&a.relateddata.files&&(s=a.relateddata.files);var l=void 0;a&&null==(l=a.title||a.name)&&a.dataelements&&(l=a.dataelements.title||a.dataelements.name),1==s.length?t.authenticatedRequest(n.options.platformUrls["3DSpace"]+"/resources/v1/application/E6WFoundation/CSRF",{method:"GET",url_temp:n.options.platformUrls["3DSpace"],onComplete:function(s){var c={};c.tenant=n.options.platformUrls.platformId,c.securityContext=n.options.fetchSecurityContext(),c.tenantUrl=n.options.platformUrls["3DSpace"],c.onComplete=function(t){n.options.events.publish({event:"docv2-show-notification",data:{level:"success",title:"",subtitle:e.String.format(i.get("Editoperationcancelled"),l),message:"",sticky:!1,allowUnsafeHTML:!1}}),n.options.events&&n.options.events.publish({event:"docv2-undoedit-complete",data:{nodeModel:o}})},c.onFailure=function(e,t){n.options.events.publish({event:"docv2-show-notification",data:{level:"error",title:"",subtitle:t.error,message:"",sticky:!1,allowUnsafeHTML:!1}})};var r=c.tenantUrl+"/resources/v1/modeler/documents/"+a.id+"/unlock";c.type="json",c.url=r,c.data=JSON.stringify({csrf:JSON.parse(s).csrf}),c.headers=c.headers||{Accept:"*/*","Content-Type":"application/ds-json"},c.method="POST",t.authenticatedRequest(r,c)}}):0==s.length?n.options.events.publish({event:"docv2-show-notification",data:{level:"error",title:"",subtitle:i.get("objectcontainsnofile"),message:"",sticky:!1,allowUnsafeHTML:!1}}):n.options.events.publish({event:"docv2-show-notification",data:{level:"error",title:"",subtitle:i.get("Nomultifilesupport"),message:"",sticky:!1,allowUnsafeHTML:!1}})},a}),define("DS/DocumentCommands/V2/Actions/OfficeWebEdition",["DS/PlatformAPI/PlatformAPI","DS/DocumentManagement/DocumentManagement","DS/DocumentCommands/Helper","UWA/Promise","i18n!DS/DocumentCommands/assets/nls/DocumentCommands"],function(e,t,n,o,i){"use strict";var a=function(e){return{id:"OfficeWebEdition",dataElements:{docV2Public:!0,typeRepresentation:"functionIcon",icon:{iconName:"pencil",fontIconFamily:1},label:i.get("OfficeWebEdition"),tooltip:i.get("OfficeWebEdition"),position:"far",category:"edit",value:function(t){t.options=e,a.execute(t)},visibleFlag:!1,priority:10},execute:function(){a.execute({options:e})},updateForSelection:function(t,i){var a=this;return new o(function(o){n.CalculateDocumentModificationCommandsVisibility(e,a.id).then(function(e){t({visibleFlag:e.OfficeWebEdition}),o(!0)})})}}};return a.execute=function(n){var o=n.options.getSelectedNodes()[0],a=n.options.getDocumentFromNodeModel(o);t.getDocuments([a.id],{tenant:n.options.platformUrls.platformId,securityContext:n.options.securityContext,tenantUrl:n.options.platformUrls["3DSpace"],onComplete:function(t){if(t.success){if(!Array.isArray(t.data))return void console.error("no data received in DocumentManagement.getDocuments");var s=[];if((a=t.data[0]).relateddata&&a.relateddata.files?s=a.relateddata.files:a.files&&(s=a.files),1==s.length){let t=e.getUser().login;var l;if(""!=s[0].dataelements.locker&&s[0].dataelements.locker!=t)s[0].relateddata.lockerInfo&&s[0].relateddata.lockerInfo.length>0&&(l=s[0].relateddata.lockerInfo[0].dataelements.firstname+" "+s[0].relateddata.lockerInfo[0].dataelements.lastname),n.options.events.publish({event:"docv2-show-notification",data:{level:"error",title:i.get("DocumentEditNotAllowed"),subtitle:l+" "+i.get("DocumentLockedBySomeone"),message:"",sticky:!1,allowUnsafeHTML:!1}});else{if(!n.options.getDocumentFromNodeModel(o))throw"e6wDocument cannot be loaded from nodeModel";!function(e){require(["DS/DocumentWebEdition/OfficeWebEditorComponent"],function(t){widget.officeWebEditorComponent=new t({document:n.options.getDocumentFromNodeModel(e),platformUrls:n.options.platformUrls,modelEvents:n.options.events,tenant:n.options.platformUrls.platformId,securityContext:n.options.fetchSecurityContext(),nodeModel:e}),widget.officeWebEditorComponent.loaded=function(e){},widget.officeWebEditorComponent.elements.container.setStyles({background:"white",width:"100%",height:"100%"}),widget.officeWebEditorComponent.close=function(){widget.officeWebEditorComponent&&(widget.officeWebEditorComponent.destroy(),widget.officeWebEditorComponent=void 0)},widget.officeWebEditorComponent.inject(widget.body)})}(o)}}}}})},a}),define("DS/DocumentCommands/V2/Actions/NewRevision",["UWA/Core","UWA/Promise","DS/DocumentManagement/DocumentManagement","DS/WAFData/WAFData","DS/DocumentCommands/Resources","i18n!DS/DocumentCommands/assets/nls/DocumentCommands"],function(e,t,n,o,i,a){"use strict";var s=function(e){return{id:"NewRevision",dataElements:{docV2Public:!0,typeRepresentation:"functionIcon",icon:{iconName:"flow-line-add",fontIconFamily:1},label:a.get("NewRevision"),tooltip:a.get("NewRevision"),position:"far",category:"lifecycle",value:function(t){t.options=e,s.execute(t)},visibleFlag:!1},execute:function(){s.execute({options:e})},updateForSelection:function(n,o){return new t(function(t){n({visibleFlag:e.getSelectedNodes().length>=1}),t(!0)})}}};return s.execute=function(t){if(t.options.getSelectedNodes().length>0){var n=t.options.getSelectedNodes();require(["DS/LifecycleCmd/ReviseCmd"],function(o){new o({securitycontext:t.options.fetchSecurityContext(),context:{displayNotification:function(o){if("primary"==o.eventID)if(1==n.length){var i=t.options.getSelectedNodes()[0],s=t.options.getDocumentFromNodeModel(i),l=void 0;s&&null==(l=s.title||s.name)&&s.dataelements&&(l=s.dataelements.title||s.dataelements.name),t.options.events.publish({event:"docv2-show-notification",data:{level:"success",title:a.get("RevisionSuccessful"),subtitle:e.String.format(a.get("RevisionSuccessfulMsg"),l),message:"",sticky:!1,allowUnsafeHTML:!1}})}else n.length>1&&t.options.events.publish({event:"docv2-show-notification",data:{level:"success",title:a.get("RevisionSuccessful"),subtitle:a.get("MultipleRevisionSuccessfulMsg",{count:n.length}),message:"",sticky:!1,allowUnsafeHTML:!1}})},getUUID:function(){return t.options.getOrigin?JSON.stringify(e.extend(t.options.getOrigin(),{action:"new-revision"})):"docv2.new-revision."+Date.now()}}}).execute(n.map(function(e){var n=t.options.getDocumentFromNodeModel(e),o=void 0;n&&null==(o=n.title||n.name)&&n.dataelements&&(o=n.dataelements.title||n.dataelements.name);var i=void 0;return n.revision?i=n.revision:n.dataelements&&(i=n.dataelements.revision),{physicalid:n.id,displayName:o,revision:i,icon:n.dataelements.indexedTypeicon||n.dataelements.typeicon,type:n.type,typeDisplayName:n.dataelements.typeNLS,current:n.dataelements.state,currentDisplayName:n.dataelements.stateNLS}}))})}},s}),define("DS/DocumentCommands/V2/Actions/Edit",["UWA/Core","UWA/Promise","DS/DocumentManagement/DocumentManagement","DS/DocumentCommands/Helper","i18n!DS/DocumentCommands/assets/nls/DocumentCommands"],function(e,t,n,o,i){"use strict";var a=function(e){return{id:"Edit",dataElements:{docV2Public:!0,typeRepresentation:"functionIcon",icon:{iconName:"pencil",fontIconFamily:1},label:i.get("Edit"),tooltip:i.get("Edit"),position:"far",category:"edit",value:function(t){t.options=e,a.execute(t)},visibleFlag:!1},execute:function(){a.execute({options:e})},updateForSelection:function(n,i){var a=this;return new t(function(t){o.CalculateDocumentModificationCommandsVisibility(e,a.id).then(function(e){n({visibleFlag:e.Edit}),t(!0)})})}}};return a.execute=function(t){var o=t.options.getSelectedNodes()[0],s=t.options.getDocumentFromNodeModel(o),l=[];s.files?l=s.files:s.relateddata&&s.relateddata.files&&(l=s.relateddata.files);var c=void 0;if(s&&null==(c=s.title||s.name)&&s.dataelements&&(c=s.dataelements.title||s.dataelements.name),1==l.length){var r={asZip:!0,autoDownload:!0};r.tenant=t.options.platformUrls.platformId,r.securityContext=t.options.fetchSecurityContext(),r.tenantUrl=t.options.platformUrls["3DSpace"],r.onComplete=function(n){if(c&&""!==c){var s={title:i.get("Download_Initiated"),subtitle:e.String.format(i.get("Filedownloadstartedforedit"),c)};a.showNotification(t,"info",s.title||"",s.subtitle||"","",!1,!1)}else a.showNotification(t,"info",i.get("checkout_initiated"),"","",!1,!1);t.options.events&&t.options.events.publish({event:"docv2-edit-complete",data:{nodeModel:o}})},r.onFailure=function(e){var n="Document";s&&s.dataelements?n=s.dataelements.typeNLS||s.dataelements.type:s.type&&(n=s.type),e&&e.length>0&&e[0].updateMessage?a.showNotification(t,"error",i.get("checkout_initiated"),i.get("YouCannotEditX",{typeNLS:n}),i.get("VerifyCredentials"),i.get("NotHaveRequiredAccessRole"),!1,!1):a.showNotification(t,"error",i.get("YouCannotEditX",{typeNLS:n}),e,"",!1,!1),console.error("Document Edit Failed Due to:")},widget&&widget.MSFDocumentClient&&null===n.MSFDocumentClient?n.MSFDocumentClient=widget.MSFDocumentClient:t.options.MSFDocumentClient&&null===n.MSFDocumentClient&&(n.MSFDocumentClient=t.options.MSFDocumentClient),n.downloadDocument(s.id,s.fileid,!0,r)}else 0==l.length?a.showNotification(t,"error","",i.get("objectcontainsnofile"),"",!1,!1):a.showNotification(t,"error","",i.get("Nomultifilesupport"),"",!1,!1)},a.showNotification=function(e,t,n,o,i,a,s){e.options.events.publish({event:"docv2-show-notification",data:{level:t,title:n,subtitle:o,message:i,sticky:a,allowUnsafeHTML:s}})},a}),define("DS/DocumentCommands/V2/Actions/LockAndDownload",["UWA/Core","DS/DocumentManagement/DocumentManagement","DS/DocumentCommands/Helper","UWA/Promise","i18n!DS/DocumentCommands/assets/nls/DocumentCommands"],function(e,t,n,o,i){"use strict";var a=function(e){return{id:"LockAndDownload",dataElements:{docV2Public:!0,typeRepresentation:"functionIcon",icon:{iconName:"lock",fontIconFamily:1},label:i.get("LockAndDownload"),tooltip:i.get("LockAndDownload"),position:"far",category:"edit",value:function(t){t.options=e,a.execute(t)},visibleFlag:!1},execute:function(){a.execute({options:e})},updateForSelection:function(t,i){return new o(function(o){n.CalculateDocumentModificationCommandsVisibility(e).then(function(e){t({visibleFlag:e.LockAndDownload}),o(!0)})})}}};return a.execute=function(e){let t=e.options.platformUrls.platformId;var o=e.options.getSelectedNodes()[0],s=e.options.getDocumentFromNodeModel(o),l=[];(s.files?l=s.files:s.relateddata&&s.relateddata.files&&(l=s.relateddata.files),"OnPremise"!=t&&1==l.length)?n.IsWebEditionDocumentSessionActive(e.options.platformUrls.platformId,s.id).then(t=>{t&&t.opened?a.showNotification(e,"warning","",i.get("EditErrorMessageWebEditionSessionActive"),"",!0,!0):a.executeEdit(e)}).catch(t=>{a.executeEdit(e)}):a.executeEdit(e)},a.executeEdit=function(n){var o=n.options.getSelectedNodes()[0],s=n.options.getDocumentFromNodeModel(o),l=[];s.files?l=s.files:s.relateddata&&s.relateddata.files&&(l=s.relateddata.files);var c=void 0;if(s&&null==(c=s.title||s.name)&&s.dataelements&&(c=s.dataelements.title||s.dataelements.name),1==l.length){var r={asZip:!0,autoDownload:!0};r.tenant=n.options.platformUrls.platformId,r.securityContext=n.options.fetchSecurityContext(),r.tenantUrl=n.options.platformUrls["3DSpace"],r.onComplete=function(t){if(c&&""!==c){var s={title:i.get("Download_Initiated"),subtitle:e.String.format(i.get("Filedownloadstartedforedit"),c)};a.showNotification(n,"info",s.title||"",s.subtitle||"","",!1,!1)}else a.showNotification(n,"info",i.get("checkout_initiated"),"","",!1,!1);n.options.events&&n.options.events.publish({event:"docv2-edit-complete",data:{nodeModel:o}})},r.onFailure=function(e){var t="Document";s&&s.dataelements?t=s.dataelements.typeNLS||s.dataelements.type:s.type&&(t=s.type),e&&e.length>0&&e[0].updateMessage?a.showNotification(n,"error",i.get("checkout_initiated"),i.get("YouCannotEditX",{typeNLS:t}),i.get("VerifyCredentials"),i.get("NotHaveRequiredAccessRole"),!1,!1):a.showNotification(n,"error",i.get("YouCannotEditX",{typeNLS:t}),e,"",!1,!1),console.error("Document Edit Failed Due to:")},widget&&widget.MSFDocumentClient&&null===t.MSFDocumentClient?t.MSFDocumentClient=widget.MSFDocumentClient:n.options.MSFDocumentClient&&null===t.MSFDocumentClient&&(t.MSFDocumentClient=n.options.MSFDocumentClient),t.downloadDocument(s.id,s.fileid,!0,r)}},a.showNotification=function(e,t,n,o,i,a,s){e.options.events.publish({event:"docv2-show-notification",data:{level:t,title:n,subtitle:o,message:i,sticky:a,allowUnsafeHTML:s}})},a}),define("DS/DocumentCommands/V2/Actions/AddTo",["DS/DocumentCommands/V2/Actions/AddTo/Libraries","DS/DocumentCommands/V2/ConvertCmdToWebUX","UWA/Promise","i18n!DS/DocumentCommands/assets/nls/DocumentCommands"],function(e,t,n,o){"use strict";return function(i){var a=new e(i);return{id:"AddTo",dataElements:{docV2Public:!0,typeRepresentation:"functionMenuIcon",icon:{iconName:"plus",fontIconFamily:1},label:o.get("AddTo"),tooltip:o.get("AddTo"),position:"far",category:"edit",value:{menu:t([a])},visibleFlag:!1},updateForSelection:function(e,t){return new n(function(t){e({visibleFlag:i.getSelectedNodes().length>=1}),t(!0)})}}}}),define("DS/DocumentCommands/DocumentCommandsV2",["UWA/Core","UWA/Promise","DS/DocumentCommands/V2/Actions/Preview","DS/DocumentCommands/V2/Actions/Edit","DS/DocumentCommands/V2/Actions/LockAndDownload","DS/DocumentCommands/V2/Actions/UndoEdit","DS/DocumentCommands/V2/Actions/Unlock","DS/DocumentCommands/V2/Actions/Share","DS/DocumentCommands/V2/Actions/CopyLink","DS/DocumentCommands/V2/Actions/Download","DS/DocumentCommands/V2/Actions/Relations","DS/DocumentCommands/V2/Actions/Maturity","DS/DocumentCommands/V2/Actions/NewRevision","DS/DocumentCommands/V2/Actions/Update","DS/DocumentCommands/V2/Actions/UpdateAndUnlock","DS/DocumentCommands/V2/Actions/Delete","DS/DocumentCommands/V2/Actions/Revisions","DS/DocumentCommands/V2/Actions/Duplicate","DS/DocumentCommands/V2/Actions/Compare","DS/DocumentCommands/V2/Actions/Move","DS/DocumentCommands/V2/Actions/ChangeOwner","DS/DocumentCommands/V2/Actions/AddTo/Libraries","DS/DocumentCommands/V2/Actions/AddTo","DS/DocumentCommands/V2/ConvertCmdToWebUX","DS/DocumentCommands/V2/Actions/Subscription/Subscribe","DS/DocumentCommands/V2/Actions/Subscription/UnSubscribe","DS/DocumentCommands/V2/Actions/Subscription/EditSubscriptions","DS/DocumentCommands/V2/Actions/Subscription/MySubscriptions","DS/DocumentCommands/V2/Actions/Subscription","DS/DocumentCommands/V2/Actions/OfficeWebEdition"],function(e,t,n,o,i,a,s,l,c,r,d,u,m,p,f,g,v,D,S,b,h,y,C,w,E,I,N,U,x,F){"use strict";return e.Class.extend({init:function(t){t.getJobsProcessorPromise=t.getJobsProcessorPromise||new e.Promise(function(e,t){var n={};window.widget&&window.widget.app&&window.widget.app.jobs&&"doco-jobs"==window.widget.app.jobs.name&&window.widget.app.progressPane&&"doco-progress"==window.widget.app.progressPane.name?(n=window.widget.app,e(n.jobs)):(console.warn("DocumentCommandsV2 had to initialize jobs and progressPane"),require(["DS/DocumentCommands/Jobs","DS/DocumentCommands/ProgressPane"],function(t,o){null==n.jobs&&(n.jobs=new t(n)),null==n.progressPane&&(n.progressPane=new o(n),window.widget&&window.widget.body?n.progressPane.inject(window.widget.body):n.progressPane.inject(document.body)),e(n.jobs)}))}),this._parent(t),this.commands={Preview:new n(t),Edit:new o(t),LockAndDownload:new i(t),UndoEdit:new a(t),Unlock:new s(t),Download:new r(t),Share:new l(t),CopyLink:new c(t),Relations:new d(t),Maturity:new u(t),NewRevision:new m(t),Update:new p(t),UpdateAndUnlock:new f(t),Delete:new g(t),Revisions:new v(t),Duplicate:new D(t),Compare:new S(t),Move:new b(t),ChangeOwner:new h(t),Libraries:new y(t),AddTo:new C(t),Subscribe:new E(t),UnSubscribe:new I(t),EditSubscriptions:new N(t),MySubscriptions:new U(t),Subscription:new x(t),OfficeWebEdition:new F(t)}},commands:[],connectToWebUXToolbar:function(e){e.items.getRoots().forEach(e=>{e.options.docV2Public&&e.options.extend&&e.options.extend(e)})},selectionChangedForWebUXToolbar:function(e){e.items.getRoots().forEach(e=>{e.options.docV2Public&&(e.options.grid.action=e,e.options.updateForSelection&&e.options.updateForSelection(function(t){e.updateOptions(t)}))})},getWebUXContextMenuItemsForCurrentSelection:function(n,o){return new e.Promise(function(i,a){var s=[],l=n[0].dataElements.category,c=[!0];n.forEach(t=>{if(t.updateForSelection){var n=t.updateForSelection(function(n){t.dataElements=e.extend(t.dataElements,n,!0)});c.push(n)}else c.push(!0)}),t.all(c).then(function(e){n.forEach(e=>{e.dataElements.visibleFlag&&(o&&l!=e.dataElements.category&&s.push({type:"SeparatorItem"}),s.push(w([e])[0]),l=e.dataElements.category)}),i(s)})})},getUIKitItemsForCurrentSelection:function(n,o){var i=[!0],a=n[0].dataElements.category,s=[];return new e.Promise(function(l,c){n.forEach(t=>{if(t.updateForSelection){var n=t.updateForSelection(function(n){t.dataElements=e.extend(t.dataElements,n,!0)});i.push(n)}else i.push(!0)}),t.all(i).then(function(){n.forEach(e=>{e.dataElements.visibleFlag&&(o&&a!=e.dataElements.category&&s.push({className:"divider"}),s.push({rawItem:e,title:e.dataElements.label,name:e.id,text:e.dataElements.label,fonticon:e.dataElements.icon.iconName,handler:e.execute||function(e,t,n){console.error("This command doesnt have value")},category:e.dataElements.category}),a=e.dataElements.category)}),l(s)})})}})});