define("DS/CompareWidget/CompareWidgetInit",[],function(){"use strict";function e(e,t){var i="2",r=new URLSearchParams(window.location.search);if(r&&r.has("widgetDomain")){var a=r.get("widgetDomain"),n=new URLSearchParams(a.substring(a.indexOf("?")));n&&n.has(e)&&n.get(e).indexOf("true")>=0&&(i=t)}return i}return function(){setTimeout(function(){var t="2";try{var i=widget.data.X3DContentId,r=JSON.parse(i).runOptions.version;null!=r&&(t=r)}catch(e){console.log("Something went wrong getting widget environment... continuing")}require(["DS/CompareCommon/Utils","DS/LifecycleServices/LifecycleServices","DS/LifecycleServices/LifecycleServicesSettings"],function(i,r,a){var n=widget.getValue("x3dPlatformId");a.app_initialization(function(){r.getSecurityContextPromise(n,null).then(function(r){var o={url3DSpace:a.get3DSpaceBaseUrl(n),tenant:n,securityContext:r};i.getExpressionPromise("CompareWidgetUseCompareV1",o).then(i=>{null!=i&&!0===i.available&&"true"===i.expressionValue?t="1":"1"!==t&&(t=e("CompareV1","1"));var r="DS/CompareWidget2/CompareWidget2";"1"===t&&(r="DS/CompareWidget/CompareWidget",widget.compareV1=!0),widget.recordForODT=e("recordForODT","true"),require([r],function(e){widget.addEvents({onLoad:function(t){e.onLoad.call(null)},onViewChange:function(t){e.onViewChange.call(null,t)},onRefresh:function(t){e.onRefresh.call(null,t)},onResize:function(t){e.onResize.call(null,arguments)},onEdit:function(t){e.onEdit.apply(null,arguments)},endEdit:function(t){t.submitted&&e.endEdit.apply(null,arguments)}})})})})})})},500)}}),define("DS/CompareWidget/Ecosystem",["UWA/Class","DS/LifecycleServices/LifecycleServicesSettings","DS/WAFData/WAFData","i18n!DS/CompareWidget/assets/nls/CompareWidget"],function(e,t,i,r){var a=e.extend({init:function(e){this._parent({}),this.rels=e,this.idObjMap=this.buildIdObjMap(e),this.formated=this.format(e)},addTo:function(e){for(var t=this.newAsm(e),i=Object.keys(this.formated),r=0;r<i.length;r++)this.addSourceToAsm(i[r],t)},addRootSourceToAttributes:function(e){for(var t=this.rels.New.Objects,i=0;i<t.length;i++){var r=t[i],a=e[r.id];null!=a&&(r.rootSource=a.rootSource)}},getLinkedObjectIds:function(){for(var e=[],t=(this.rels.New.Objects,this.rels.New.Links),i=0;i<t.length;i++){var r=t[i].target;-1==e.indexOf(r)&&e.push(r)}return e},format:function(e){for(var t={},i=0;i<e.New.Links.length;i++){var r=e.New.Links[i];null==t[r.source]&&(t[r.source]={});var a=t[r.source],n=r.type+"."+r.name;null==a[n]&&(a[n]=[]),a[n].push(r.target)}return t},buildIdObjMap:function(e){for(var t={},i=e.New.Objects,r=0;r<i.length;r++){var a=i[r];t[a.id]=a}return t},addSourceToAsm:function(e,t){for(var i=t.getOccs(e),r=0;r<i.length;r++)this.addSourceToOcc(e,i[r],t)},addSourceToOcc:function(e,t,i){for(var r=this.formated[e],a=Object.keys(r),n=0;n<a.length;n++){var o=a[n];this.addCategoryToSourceOcc(r,o,t,i)}},addCategoryToSourceOcc:function(e,t,i,r){var n=a.relationLabels[t];if(null!=n)for(var o=this.addToOcc(t,{Title:n.label,icon:n.icon,physicalid:t,attributes:{revision:" "}},i,r),s=e[t],l=0;l<s.length;l++){var c=s[l],d=this.idObjMap[c],u={Title:d["ds6w:label"],icon:d.icon_url,physicalid:d.id,type:d["ds6w:type"],attributes:{revision:d.revision,name:d["ds6w:identifier"],"revision-physicalid":d.id,"PLMReference.V_DerivedFrom":d.rootSource}};this.addToOcc(c,u,o,r)}},addToOcc:function(e,t,i,r){var a=r.addNode(e,t),n=r.addOcc(a.nodeid);return r.addRel(i.occurrenceid,n.occurrenceid),n},newAsm:function(e){return{asm:e,getOccs:function(e){if(this.pidOccsMap=this.pidOccsMap||{},void 0===this.pidOccsMap[e]){this.pidOccsMap[e]=[];for(var t=0;t<this.asm.occurrences.length;t++){var i=this.asm.occurrences[t];e==this.asm.nodes[i.nodeid].physicalid&&this.pidOccsMap[e].push(i)}}return this.pidOccsMap[e]},getChildOcc:function(e,t){for(var i=0;i<this.asm.occurrencerelationships.length;i++){var r=this.asm.occurrencerelationships[i];if(r.parent==e){var a=this.asm.occurrences[r.child];if(this.asm.nodes[a.nodeNdx].physicalid==t)return a}}return null},getNode:function(e){if(this.pidNodeMap=this.pidNodeMap||{},void 0===this.pidNodeMap[e]){for(var t=0;t<this.asm.nodes.length;t++){var i=this.asm.nodes[t];i.physicalid==e&&(this.pidNodeMap[e]=i)}void 0===this.pidNodeMap[e]&&(this.pidNodeMap[e]=null)}return this.pidNodeMap[e]},addNode:function(e,t){var i=this.getNode(e);return null!=i?i:((i=t).nodeid=this.asm.nodes.length,this.asm.nodes.push(i),this.pidNodeMap[e]=i,i)},addOcc:function(e){var t={occurrenceid:this.asm.occurrences.length,nodeid:e,xform:["n/a"]};return this.asm.occurrences.push(t),t},addRel:function(e,t){var i={parent:e,child:t};this.asm.occurrencerelationships.push(i)}}}});function n(e,r,a,n){var o=widget.getValue("x3dPlatformId"),s=t.get3DSpaceWSUrl(o,e);i.authenticatedRequest(s,{method:"POST",type:"json",timeout:12e4,data:JSON.stringify(r),headers:{Accept:"application/json","Content-Type":"application/json"},onComplete:a,onFailure:n})}return a.docRels=["v6_specdoc_to","v6_annexdoc_to"],a.otherRels=["SpaceAssignment_to","RFL_implementScope_from","RFL_implementScope_to","ProposedSolution_to"],a.relationLabels={"SpaceAssignment_to.472":{label:r.spaceAssignment,icon:" "},"RFL_implementScope_from.52":{label:r.implementedBy,icon:" "},"RFL_implementScope_to.51":{label:r.implementing,icon:""},"ProposedSolution_to.ProposedSolution":{label:r.proposedSolutions,icon:""},"v6_specdoc_to.87":{label:r.attachedDocuments,icon:""},"v6_annexdoc_to.Reference Document":{label:r.attachedDocuments,icon:""},"v6_specdoc_to.SpecificationDocument":{label:r.specificationDocuments,icon:""}},a.get=function(e,i,r){if(null!=e){var o=[];if(widget.getBool("showDocs")&&o.push.apply(o,a.docRels),widget.getBool("showOtherRels")&&o.push.apply(o,a.otherRels),o.length>0)!function(e,t,i,r){var o={relations:t,countmanagement:!1,debug:!1,trueREST:!0,widgetId:widget.id,timeout:"6000",ids:e};"compareWidgetOdtId"==widget.id&&(o=null),n("/resources/enorelnav/navigate/getecosystem",o,function(e){var t=new a(e);i(t)}.bind(this),r)}(function(e){for(var t=[],i=e.nodes,r=0;r<i.length;r++)t.push(i[r].physicalid);return t}(e),o,function(e){var a=e.getLinkedObjectIds();a.length>0?function(e,i,r){t.get3DSpaceBaseUrl(widget.getValue("x3dPlatformId"));for(var a=[],o=0;o<e.length;o++)a.push({id:e[o]});n("/resources/compare/index/fetchRootSource",{data:a},i,r)}(a,function(t){e.addRootSourceToAttributes(t),i(e)},r):i(e)},r);else i(null)}else i(null)},a}),define("DS/CompareWidget/CompareViewerFocusOnCmd",["UWA/Core","DS/ApplicationFrame/Command","DS/ApplicationFrame/CommandsManager","DS/PADUtils/PADContext"],function(e,t,i,r){"use strict";var a=t.extend({name:"CompareViewerFocusOnCmd",init:function(e){this._parent(e,{mode:"shared",isAsynchronous:!0}),this._context=r.get(this.options.context)},execute:function(){var e=this;require(["DS/Selection/CSOManager"],function(t){var r=[],a=t.get();if(a.length&&a.forEach(function(t){var i=t.pathElement,a=e._context.streamPath(i);r.push(a)}),0==r.length)console.error("No path to focus on or call from another 3D widget reference");else{var n=i.getCommand("PAD3DViewerNavigateOnSelectionHdr",null);null!=n&&n.execute(r),jQuery("#compare-content").trigger("updateWidgetViewStateEvent",{buttonUpdateOnly:!1,forceGetSelections:!0,autoScrollToActive:!0})}e.end()})}});return e.namespace("DS/CompareWidget/CompareViewerFocusOnCmd",a)}),define("DS/CompareWidget/CompareViewer",["i18n!DS/CompareWidget/assets/nls/CompareViewer","DS/CompareCommon/DBG_Stopwatch","DS/UIKIT/Mask","DS/Selection/CSOManager","DS/Selection/HSOManager","DS/Visualization/WorldOrientation"],function(e,t,i,r,a,n){"use strict";var o=null,s=!1,l=null,c=null,d=!1,u=!1,p=!1,h=null,f=null,m=function(e){var t=null!=e?e.split("/"):[],i=null;return t.length>0&&(1==t.length&&""===t[0]||(i=o.viewer3D.unstreamPath(t))),i};function g(e,t){for(var i=[],r=t.mapOccurrenceToPath,a=0;a<r.length;a++){if(r[a][r[a].length-1]==e){var n=o.viewer3D.unstreamPath(r[a]);i.push(n)}}return i}var v=function(e,t,i){if(null!=this.options&&(e instanceof Array||(e=[e]),t instanceof Array||(t=[t]),this.options.properties.Old.name=null==e[0]||null==e[0].title?"  ":e[0].title,this.options.properties.New.name=null==t[0]||null==t[0].title?"  ":t[0].title,0!=s&&null!=o)){for(var r=[],a=[],n=o.viewer3D.getHideShowController(),l=0;l<e.length;l++){var c=e[l];if(null!=c.IDPath&&""!=c.IDPath){var d=null;if(u)d=g(c.IDPath,this.options.leftViewerJSON);else null!=(f=m(c.IDPath))&&(d=[f]);if(null!=d)if(null!=n._sceneGraphOverrideSet)null!=n._sceneGraphOverrideSet.createOverride(d)&&d.forEach(function(e,t){r.push(e)})}}for(var p=0;p<t.length;p++){var h=t[p];if(null!=h.IDPath&&""!=h.IDPath){var f;d=null;if(u)d=g(h.IDPath,this.options.rightViewerJSON);else null!=(f=m(h.IDPath))&&(d=[f]);if(null!=d)if(null!=n._sceneGraphOverrideSet)null!=n._sceneGraphOverrideSet.createOverride(d)&&d.forEach(function(e,t){a.push(e)})}}this.options.properties.Old.pathElements=r,this.options.properties.New.pathElements=a;var v={};for(var y in this.options.properties)this.options.properties.hasOwnProperty(y)&&("New"==y?v.New={color:this.options.properties.New.color,name:this.options.properties.New.name,nls:this.options.properties.New.nls,pathElements:this.options.properties.New.pathElements}:"Old"==y?v.Old={color:this.options.properties.Old.color,name:this.options.properties.Old.name,nls:this.options.properties.Old.nls,pathElements:this.options.properties.Old.pathElements}:v[y]=this.options.properties[y]);var b=[];r.length>0?r.forEach(function(e,t){b.push(e)}):v.Old=null,a.length>0?a.forEach(function(e,t){b.push(e)}):v.New=null;var C=null,w="",S=i.toLowerCase();"hide"==S?(C=n.hide,w="onHide"):"show"==S?(C=n.show,w="onShow"):"update"==S&&(C=n.exclusiveShow,w="onExclusiveShow");var D=n.subscribe({event:w},function(){try{o&&o.compareAPI3D&&o.compareAPI3D.updateCompareModel(v)}catch(e){console.log(e)}n.unsubscribe(D)});C.call(n,{paths:b}),widget.dispatchEvent("onUpdateViewerLegend")}},y=function(e){this.targetElement=e,this.options=null,this.viewerLoaded=!1,this.rootLoadReqCount=0,null==o&&(o=function(e){function t(e){e.viewer3D.subscribe({event:"onReady"},function(){try{i.unmask(e.targetElement),e.viewer3D.render().inject(e.targetElement),d=!0,e.widget.dispatchEvent("onViewer3D_ready2LoadViewerJSON")}catch(e){console.log('Can not dispatch "onViewer3D_ready2LoadViewerJSON", exception: '+e)}}),e.viewer3D.subscribe({event:"onLoadingComplete"},function(){try{e.widget.dispatchEvent("onViewer3D_viewerJSONLoadOK")}catch(e){console.log('Can not dispatch "onViewer3D_viewerJSONLoadOK", exception: '+e)}}),e.viewer3D.subscribe({event:"onLoadingFailure"},function(){try{e.widget.dispatchEvent("onViewer3D_objLoadFail")}catch(e){console.log('Can not dispatch "onViewer3D_objLoadFail", exception:'+e)}})}var r={widget:e.widget,targetElement:e.targetElement,viewer3D:null,compareAPI3D:null,css_view_class:"windowed",onWidget_updateViewerLegend:function(){if(null!=o&&null!=o.compareAPI3D&&"function"==typeof o.compareAPI3D.setLegendVisibleFlag)try{var e=0==("none"!=jQuery("#compare-region-left").css("display"));o.compareAPI3D.setLegendVisibleFlag(e)}catch(e){console.log("setLegendVisibleFlag support not as expected")}},onWidget_loadComplete:function(){try{var e=this;null===e.viewer3D&&(p?(e.viewer3D=h,t(e),h.ODT_init(widget)):require(["DS/ENOPAD3DViewer/PAD3DViewer","UWA/Core"],function(i,r){var a={widget:e.widget,css_view_class:e.css_view_class,actionbar_corrected:!0,interwidgetComAvailability:!1,windowOptions:{workbench:"CompareViewerCmd.xml",workbenchModule:"CompareWidget",robotVisibility:!1,allowDnD:!1,defaultStatusBarVisibility:!1,contextualMenuContent:{workbenchName:"CompareViewerContextualBar",module:"CompareWidget",fileName:"CompareViewerContextualBar.xml",geometry:{firstLevel:["CompareViewerFocusOnHdr","ReframeOnHdr"],toggleVisu:null}}}};e.viewer3D=new i(a);var n=require("DS/PADUtils/PADUtilsServices").isCloud()?window.__mouseProfile:"CATIA";e.viewer3D.getViewpoint().setDefaultController(!0,n),t(e)}))}catch(e){console.log("Error loading PAD3DViewer")}},onWidget_viewChanged:function(e){"fullscreen"===e.type||"maximized"===e.type?e.height&&this._setBodyHeight(e.height):this._setBodyHeight("auto"),widget.dispatchEvent("onUpdateViewerLegend"),this.css_view_class=e.type,this.widget.dispatchEvent("onViewChangePAD",e)},_setBodyHeight:function(e){e&&("auto"!==e&&(e+="px"),this.widget.body.setStyle("height",e))}};return r.widget.addEvent("onLoad",r.onWidget_loadComplete.bind(r)),r.widget.addEvent("onViewChange",r.onWidget_viewChanged.bind(r)),r.widget.addEvent("onUpdateViewerLegend",r.onWidget_updateViewerLegend.bind(r)),r}({widget:widget,targetElement:this.targetElement})),jQuery("#compare-content").on("loadNewModelEvent",this.load3DComparison.bind(this)),jQuery("#compare-content").on("loadNewModelJSONEvent",this.compareViewerJSONReady.bind(this)),jQuery("#compare-content").on("loadNewSnapshotEvent",this.load3DComparison.bind(this)),jQuery("#compare-content").on("newRowSelectedEvent_3Dviewer",this.newRowSelected.bind(this)),jQuery("#compare-content").on("geometryHideShowEvent",this.geometryHideShow.bind(this)),jQuery("#compare-content").on("compareStructureLegendCheckedChangeEvent",this.compareStructureLegendCheckedChange.bind(this)),i.mask(this.targetElement)};y.prototype.compareViewerJSONReady=function(e,t){null!=this.options&&(this.options.leftViewerJSON=t.left.viewerJSON,this.options.rightViewerJSON=t.right.viewerJSON,this.options.vWorldOrientation=t.vWorldOrientation,this.options.isSwapped=t.isSwapped,d&&o.widget.dispatchEvent("onViewer3D_ready2LoadViewerJSON"))};var b=function(e){return(e=e.match(/^rgba?[\s+]?\([\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?/i))&&4===e.length?"#"+("0"+parseInt(e[1],10).toString(16)).slice(-2)+("0"+parseInt(e[2],10).toString(16)).slice(-2)+("0"+parseInt(e[3],10).toString(16)).slice(-2):""};y.prototype.load3DComparison=function(r,a){if(null!=r&&void 0!==r&&null!=r.type&&void 0!==r.type){t.mark({id:"Viewer_mark",str:"[BEGIN] ENTIRE PROCESS of Visual Compare"}),t.mark({id:"ViewerSetup_mark",str:"[BEGIN] Visual Compare setup"});var n=null,s=null;l=null,c=null;var d=a.left.title?a.left.title+" ":"";d+=a.left.revision?a.left.revision:"";var p=a.right.title?a.right.title+" ":"";if(p+=a.right.revision?a.right.revision:"",u=a.isListView,"loadNewModelEvent"===r.type)this._leftRequiresIDSubscript=a.left.isFilter,this._rightRequiresIDSubscript=a.right.isFilter,this._isSwapped=!1,a.left.physicalId==a.right.physicalId&&(this._leftRequiresIDSubscript=!0,this._rightRequiresIDSubscript=!0),n=null,s=null,l=a.left.physicalId,c=a.right.physicalId,this._leftRequiresIDSubscript&&(l+="_LEFT"),this._rightRequiresIDSubscript&&(c+="_RIGHT");else{if("loadNewSnapshotEvent"!==r.type)return;n=a.left.viewerJSON,s=a.right.viewerJSON,this._leftRequiresIDSubscript=!0,this._rightRequiresIDSubscript=!0,l=a.left.physicalId+"_LEFT",c=a.right.physicalId+"_RIGHT"}this.options=function(t,i,r,a,n,o){var s=jQuery("#model-color-left").css("background-color");null==s&&(s="rgb(0, 0, 230)");var l=jQuery("#model-color-right").css("background-color");return null==l&&(l="rgb(255,0,255)"),{properties:{panel:"reduce",TitleNls:e.Title,New:{nls:e.RightTitle,color:b(l),name:null!=o?o:"  "},Old:{nls:e.LeftTitle,color:b(s),name:null!=n?n:"  "},Common:{nls:e.CommonTitle,color:"#EEEEEE"}},leftViewerJSON:t,rightViewerJSON:i,leftId:r,rightId:a}}(n,s,l,c,d,p),this._attachWidgetEventHandlers.call(this),null!=o&&null!=o.viewer3D&&(i.unmask(this.targetElement),o.targetElement=this.targetElement,o.viewer3D.render().inject(o.targetElement),o.widget.dispatchEvent("onViewer3D_ready2LoadViewerJSON")),t.mark({id:"ViewerSetup_mark",str:"  [END] Visual Compare setup"})}};var C=function(e,t){for(var i=e?e.split("/"):[],r="",a=0;a<i.length;a++)r+=a%2==1?"/"+i[a]+t+"/":i[a]+t;return r},w=function(e){var t="";if(null!==e.data&&null!==e.data.compareData)if(e.parent.isRoot())t=e.data.compareData.physicalid;else{var i=e.data.compareData["physicalid[connection]"],r=e.data.compareData.physicalid;t=w(e.parent)+"/"+i+"/"+r}return t};function S(e){var t=null,i="";if(null!=e&&(""==(t=w(e))&&(t=null),null!=e.data&&null!=e.data.compareData)){var r=e.data.compareData;i=r.title+" "+r.revision}return{IDPath:t,title:i}}function D(e,t,i,r){if(null!==e.data&&null!==e.data.compareData){var a=e.data.compareData.physicalid,n={};if(n.type=e.data.compareData.type,n.label=e.data.compareData.title,e.parent.isRoot()){i[o=i.length]=a+t,r[a+t]=n}else{var o,s=e.data.compareData["physicalid[connection]"];D(e.parent,t,i,r),i[o=i.length]=s+t,i[o+1]=a+t,r[a+t]=n}}}function _(e,t,i,r,a){if(null!==e.data&&null!==e.data.compareData)for(var n=t.mapOccurrenceToPath.length,o=0;o<n;++o){var s=t.mapOccurrenceToPath[o];s[s.length-1]===e.data.compareData.physicalid+i&&r.push(s)}}return y.prototype.newRowSelected=function(e,t){if(null!=this.options){for(var i=function(e,t){var i=function(e,r,a,n){var o=null;null!=e.data.compareData&&(o=e.data.compareData.compareStatus),null!=o&&o.matched||null!=e.data.matchRow&&null!=e.data.matchRow.compareStatus&&(o=e.data.matchRow.compareStatus),null!=o&&o.matched||null!=e.data.compareStatus&&(o=e.data.compareStatus);var s=!o.toShow(t.compareStructureLegend.checkedDiffIds),l=e.data.isRoot;if(!s||l)if(u||e.data.isLeaf)if(u&&l){e.data.compareData.physicalid;for(var c=n.rootNode.children,d=0;d<c.length;d++){var p=c[d],h=p.tr;if("true"==h.getAttribute("isleaf")&&"none"!=h.style.display){var f=p.data.compareData.title,m=p.data.compareData.physicalid;a.push({IDPath:m,title:f})}}}else{var g=S(e);""!==r&&(g.IDPath=C(g.IDPath,r)),a.push(g)}else if(void 0!==e.children&&null!==e.children)for(var v=0;v<e.children.length;++v){var y=e.children[v];i(y,r,a)}},r=function(e,t,i){for(var r=[],a=[],n=0;n<e.mapOccurrenceToPath.length;++n){var o=e.mapOccurrenceToPath[n],s=(o.length,o[o.length-1]);if(!a.includes(s)){for(var l=!1,c=0;c<e.mapOccurrenceToPath.length&&!l;++c)if(n!=c)for(var d=0;d<e.mapOccurrenceToPath[c].length-1&&!l;++d)s===e.mapOccurrenceToPath[c][d]&&(l=!0);l||a.push(s)}}for(n=0;n<t.children.length;++n){var u=t.children[n];if(null!=u.data&&null!=u.data.compareData){var p=u.data.compareData.physicalid;""!=i&&(p+=i);for(l=!1,c=0;c<a.length&&!l;++c)a[c]==p&&(l=!0,r.push(u))}}return r},a=[],n=[],o=widget.getValue("viewer_display_mode"),s="";if(this._leftRequiresIDSubscript&&(s=this._isSwapped?"_RIGHT":"_LEFT"),"select"==o)if(u)for(var l=r(this.options.leftViewerJSON,e.leftTree.rootNode,s),c=0;c<l.length;++c)i(l[c],s,a,e.leftTree);else{var d=e.leftTree.getNodeByKey(jQuery("#structure-treetable-left")[0].tBodies[0].rows[0].cells[2].id);i(d,s,a)}else for(c=0;c<e.left.length;++c){d=e.left[c];i(d,s,a,e.leftTree)}if(s="",this._rightRequiresIDSubscript&&(s=this._isSwapped?"_LEFT":"_RIGHT"),"select"==o)if(u)for(l=r(this.options.rightViewerJSON,e.rightTree[0].rootNode,s),c=0;c<l.length;++c)i(l[c],s,n,e.rightTree[0]);else{d=e.rightTree[0].getNodeByKey(jQuery("#structure-treetable-right")[0].tBodies[0].rows[0].cells[3].id);i(d,s,n)}else for(c=0;c<e.right.length;++c){d=e.right[c];i(d,s,n,e.rightTree[0])}v.call(this,a,n,"update")}.bind(this),n=this.compareStructureLegend.legendCount==this.compareStructureLegend.checkedDiffIds.length,s=!1,l=0;l<t.left.length;++l)1==t.left[l].data.isRoot&&(s=!0);for(l=0;l<t.right.length;++l)1==t.right[l].data.isRoot&&(s=!0);var c=[],d=[],p=widget.getValue("viewer_display_mode");if("select"==p){var h=t.leftTree.getNodeByKey(jQuery("#structure-treetable-left")[0].tBodies[0].rows[0].cells[2].id);c[0]=S(h);var f=null,m=jQuery("#structure-treetable-right")[0].tBodies[0].rows.length;for(l=0;l<m&&null==f;++l)f=t.rightTree[0].getNodeByKey(jQuery("#structure-treetable-right")[0].tBodies[0].rows[l].cells[3].id);d[0]=S(f),this._leftRequiresIDSubscript&&(c[0].IDPath=C(c[0].IDPath,this._isSwapped?"_RIGHT":"_LEFT")),this._rightRequiresIDSubscript&&(d[0].IDPath=C(d[0].IDPath,this._isSwapped?"_LEFT":"_RIGHT"))}else{if(n&&s||!s){for(l=0;l<t.left.length;++l)c[l]=S(t.left[l]);for(l=0;l<t.right.length;++l)d[l]=S(t.right[l])}if(n){for(l=0;l<t.left.length;++l)this._leftRequiresIDSubscript&&(c[l].IDPath=C(c[l].IDPath,this._isSwapped?"_RIGHT":"_LEFT"));for(l=0;l<t.right.length;++l)this._rightRequiresIDSubscript&&(d[l].IDPath=C(d[l].IDPath,this._isSwapped?"_LEFT":"_RIGHT"))}}if("select"==p){var g=[],y={},b=t.left.length;for(l=0;l<b;++l){var w=t.left[l],T=t.right[l];if(u)_(w,this.options.leftViewerJSON,this._leftRequiresIDSubscript?"_LEFT":"",g);else{var E=[];D(w,this._leftRequiresIDSubscript?"_LEFT":"",E,y),E.length>0&&g.push(E)}if(u)_(T,this.options.rightViewerJSON,this._rightRequiresIDSubscript?"_RIGHT":"",g);else{E=[];D(T,this._rightRequiresIDSubscript?"_RIGHT":"",E,y),E.length>0&&g.push(E)}}if(g.length>0&&null!==y){var A=[];g.forEach(function(e){if(e.length>0){var t=o.viewer3D.unstreamPath(e);null!==t&&A.push({pathElement:t})}}),A.length>0&&(r.empty(),a.empty(),r.add(A),a.add(A))}}n?v.call(this,c,d,"update"):i(t,this)}},y.prototype.geometryHideShow=function(e,t){if(null!=this.options){t.left=[],t.right=[];for(var i=jQuery("#structure-treetable-left")[0].tBodies[0].getElementsByClassName("fancytree-active"),r=0;r<i.length;++r){var a=i[r].ftnode;t.left.push(a)}var n=jQuery("#structure-treetable-right")[0].tBodies[0].getElementsByClassName("fancytree-active");for(r=0;r<n.length;++r){a=n[r].ftnode;t.right.push(a)}this.newRowSelected(e,t)}},y.prototype.compareStructureLegendCheckedChange=function(e,t){this.compareStructureLegend=t},y.prototype._viewerJSONsAreReady=function(){return null!=this.options.leftViewerJSON&&null!=this.options.rightViewerJSON},y.prototype._attachWidgetEventHandlers=function(){var e=this;widget.onViewer3D_ready2LoadViewerJSON=function(){o&&o.viewer3D&&0==e.rootLoadReqCount&&(0==e._viewerJSONsAreReady()||(e.rootLoadReqCount++,e._loadViewerJSON(0)))},widget.onViewer3D_viewerJSONLoadOK=function(){var i="3DViewerModelLoad"+(e.rootLoadReqCount-1),r="  [END] Load viewer JSON #"+(e.rootLoadReqCount-1);t.mark({id:i,str:r});try{if(1==e.rootLoadReqCount)e.rootLoadReqCount++,e._loadViewerJSON(1);else if(2==e.rootLoadReqCount){t.mark({id:"VIEWER_postloadJSONs",str:"[BEGIN] Post JSONS loaded computation"});var a=o.viewer3D.getRoots();a.length;e.options.properties.Old.occurrence=a[0],e.options.properties.Old.pathElement=m(l),e.options.properties.New.occurrence=a[1],e.options.properties.New.pathElement=m(c),o.viewer3D._frmWindow.getActionBar()._checkWidth(),t.mark({id:"VIEWER_postloadJSONs",str:"  [END] Post JSONS loaded computation"}),t.mark({id:"LOAD_DMU",str:"[BEGIN] LOAD DMUCompare"});require(["DS/DMU3DCompareAPI/DMU3DCompareAPI"],function(i){t.mark({id:"LOAD_DMU",str:"  [END] LOAD DMUCompare            ",comment:"**** MODULE DMU3DCompareAPI is now loaded"});try{var r=o.viewer3D._frmWindow;if(t.mark({id:"DMU3DCompareAPI_CREATE",str:"[BEGIN] Create DMU3DCompareAPI"}),!o.compareAPI3D){var a={activateXHighlight:!0,ctxViewer:o.viewer3D};o.compareAPI3D=p?f:new i(r,a)}t.mark({id:"DMU3DCompareAPI_CREATE",str:"  [END] DMU3DCompareAPI created"}),t.mark({id:"DMU3DCompareAPI_DOIT",str:"[BEGIN] DMU3DCompareAPI compare"}),o.compareAPI3D.compare(e.options.properties),s=!0,t.mark({id:"DMU3DCompareAPI_DOIT",str:"  [END] DMU3DCompareAPI compare    ",comment:"**** DMUCompareAPI computation done"}),t.mark({id:"Viewer_mark",str:"  [END] ENTIRE PROCESS of Vis Cmpr ",comment:"    *** models should be visible in viewer now ***"}),widget.dispatchEvent("ENOLCM/CompareWidget/compareViewerDoneEvent_forODTs","3DViewer"),widget.dispatchEvent("ENOLCM/CompareWidget/entireCompareDone")}catch(e){console.log("--\x3e COMPARE VIEWER / 3D Comparison unavailable: Error loading compareAPI3D: "+e)}widget.dispatchEvent("onUpdateViewerLegend")},function(e){console.log("--\x3e COMPARE VIEWER / Error loading compareAPI3D")})}else console.log("COMPARE WIDGET: Unexpected event/aborting compare")}catch(e){console.log("--\x3e COMPARE VIEWER / Error loading compareAPI3D: "+e)}},widget.onViewer3D_objLoadFail=function(e){console.log("--\x3e COMPARE VIEWER / Error loading:"+e)}},y.prototype._adjustViewerJSON_makeIDsUnique=function(e,t,i){for(var r=0;r<e.results.length;r++){if(null!=e.results[r].attributes)for(var a=0;a<e.results[r].attributes.length;a++){var n=e.results[r].attributes[a];if(n.hasOwnProperty("name")){n.value;"resourceid"===n.name&&(e.results[r].attributes[a].value+=i)}}}var o=e.mapPathToOccurrence,s={};Object.keys(o).forEach(function(e,t){var r=e.replace(/",/g,i+'",');r=r.replace(/"]/g,i+'"]'),s[r]=t}),e.mapPathToOccurrence=s;for(var l=e.mapOccurrenceToPath,c=[],d=0;d<l.length;d++){c[d]=[];for(var u=l[d],p=0;p<u.length;p++)c[d].push(u[p]+i)}e.mapOccurrenceToPath=c},y.prototype._loadViewerJSON=function(e){var i="",r=0,a=null;if(0==e)i=this.options.leftViewerJSON,r=this.options.leftId,this._leftRequiresIDSubscript&&(a="_LEFT");else{if(1!=e)return void console.log("--\x3e COMPARE WIDGET / attempted to load > 2 models... currently unsupported... ignoring");i=this.options.rightViewerJSON,r=this.options.rightId,this._rightRequiresIDSubscript&&(a="_RIGHT")}null!=a&&this._adjustViewerJSON_makeIDsUnique(i,r,a);var s="3DViewerModelLoad"+e,l="[BEGIN] load viewer JSON #"+e;return t.mark({id:s,str:l}),void 0!==o.viewer3D._viewer&&null!==o.viewer3D._viewer&&(1==this.options.vWorldOrientation?o.viewer3D._viewer.setWorldOrientation(n.YUpXRight):o.viewer3D._viewer.setWorldOrientation(n.ZUpYRight)),o.viewer3D.loadJSON({data:[{rootID:r,structure:i}]}),!0},y.prototype.do3DCompare_4_Swap=function(){if(void 0!==this.options&&null!==this.options){var e=this._rightRequiresIDSubscript;this._rightRequiresIDSubscript=this._leftRequiresIDSubscript,this._leftRequiresIDSubscript=e,this._isSwapped=!this._isSwapped;var i=this.options.leftId;this.options.leftId=this.options.rightId,this.options.rightId=i;var r=this.options.leftViewerJSON;this.options.leftViewerJSON=this.options.rightViewerJSON,this.options.rightViewerJSON=r;var a=this.options.properties.New.name;if(this.options.properties.New.name=this.options.properties.Old.name,this.options.properties.Old.name=a,void 0!==this.options.properties.New.occurrence&&void 0!==this.options.properties.Old.occurrence){var n=this.options.properties.New.occurrence;this.options.properties.New.occurrence=this.options.properties.Old.occurrence,this.options.properties.Old.occurrence=n}if(void 0!==this.options.properties.New.pathElement&&void 0!==this.options.properties.Old.pathElement){var s=this.options.properties.New.pathElement;this.options.properties.New.pathElement=this.options.properties.Old.pathElement,this.options.properties.Old.pathElement=s}else{var l=o.viewer3D.getRoots();l.length;this.options.properties.Old.occurrence=l[1],this.options.properties.Old.pathElement=m(this.options.leftId),this.options.properties.New.occurrence=l[0],this.options.properties.New.pathElement=m(this.options.rightId)}if(void 0!==this.options.properties.New.pathElements&&void 0!==this.options.properties.Old.pathElements){var c=this.options.properties.New.pathElements;this.options.properties.New.pathElements=this.options.properties.Old.pathElements,this.options.properties.Old.pathElements=c}if(o&&o.compareAPI3D)try{t.mark({id:"DMU3DCompareAPI_DOIT2",str:"[BEGIN] DMU3DCompareAPI compare"}),o.compareAPI3D.compare(this.options.properties),jQuery("#compare-content").on("loadNewModelEvent",this.load3DComparison.bind(this)),jQuery("#compare-content").on("loadNewModelJSONEvent",this.compareViewerJSONReady.bind(this)),jQuery("#compare-content").on("loadNewSnapshotEvent",this.load3DComparison.bind(this)),jQuery("#compare-content").on("newRowSelectedEvent_3Dviewer",this.newRowSelected.bind(this)),jQuery("#compare-content").on("geometryHideShowEvent",this.geometryHideShow.bind(this)),jQuery("#compare-content").on("compareStructureLegendCheckedChangeEvent",this.compareStructureLegendCheckedChange.bind(this)),t.mark({id:"DMU3DCompareAPI_DOIT2",str:"  [END] DMU3DCompareAPI compare    ",comment:"**** DMUCompareAPI computation done"}),widget.dispatchEvent("onUpdateViewerLegend")}catch(e){console.log("--\x3e COMPARE VIEWER / Swap and Recompare failure "+e)}}},y.prototype.releaseResources=function(e){if(o&&o.viewer3D){var t=o.viewer3D.subscribe({event:"onEndRootRemoved"},function(){if(o&&o.compareAPI3D){try{o.compareAPI3D.clean()}catch(e){}o.compareAPI3D=null,o.viewer3D.unsubscribe(t)}});s=!1,null!==o.viewer3D.getController()&&o.viewer3D.empty(),this._rootLoadReqCount=0}},y.prototype.refresh_4_swap=function(){if(o&&o.compareAPI3D)try{o.compareAPI3D.clean()}catch(e){console.log("--\x3e COMPARE VIEWER / Setup for Swap and Recompare failure "+e)}},y.prototype._forODT_viewChange=function(e){null!=o&&void 0!==o&&o.onWidget_viewChanged(e)},y._forODT_configForODT=function(){null!=widget&&widget.addEventOnce("ENOLCM/CompareWidget/isODT",function(e){console.log("Recieving ODT viewer objects for ODT run..."),p=!0,h=e.ODT_cwObjects,f=e.ODT_DMU3D})},y}),define("DS/CompareWidget/AssemblyEditor",[],function(){var e=function(e){console.log("COMPARE>> "+e)};function t(e,t){for(var i=[],r=t.length,a=0;a<r;a++){var n=t[a];n.parent==e&&i.push(n.child)}return i}function i(e,i){var r=[],a=[];for(r.push(e);r.length>0;){var n=r.pop(),o=t(n,i);a.push(n),r=r.concat(o)}return a=a.sort()}function r(e,t){for(var i=t.length,r=new Array(i),a=0;a<i;a++)r[a]=0;for(a=0;a<e.length;a++)for(var n=e[a];n<i;n++)r[n]++;return r}function a(e,t,i){for(var r=[],a=0;a<t.length;a++){var n=t[a].child;if(-1==e.indexOf(n)){var o=t[a];o.parent=o.parent-i[o.parent],o.child=o.child-i[o.child],r.push(o)}}return r}function n(e,t,i){for(var r=[],a=0;a<t.length;a++){var n=t[a].occurrenceid;if(-1==e.indexOf(n)){var o=t[a];o.occurrenceid=o.occurrenceid-i[o.occurrenceid],-1!=o.parentOccNdx&&(o.parentOccNdx=o.parentOccNdx-i[o.parentOccNdx]),r.push(o)}}return r}function o(t,i,r,a){for(var n=i.length,o=0;o<n;o++){var d=i[o],u=d.op,p=d.parent,h=d.inNode,f=d.rmNode,m=null;if(null!=h)m=r[a.indexOf(h)];if("INSERT"==u)e("Applying operation INSERT on: "+p+", Inserting ID: "+h),s(t,p,m);else if("REMOVE"==u)e("Applying operation REMOVE on: "+p+", Removing ID: "+f),l(t,p,f);else{if("REPLACE"!=u)throw new Error("Unsupported Operation: "+u);e("Applying operation REPLACE on: "+p+", Replacing ID: "+f+" with "+h),c(t,p,m,f)}}}function s(e,t,i,r){var a=e.occurrences,n=e.nodes;e=function(e,t,i,r){for(var a=i.length,n=0;n<a;n++){coccur=i[n],coccur.isLeaf=!1;for(var o=r.nodes,s=o.length,l=e.nodes,c=l.length,d=0;d<c;d++){var u=l[d],p=JSON.parse(JSON.stringify(u));p.nodeid_orig=p.nodeid,p.nodeid+=s,o.push(p)}for(var h=-1,f=-1,m=r.occurrences,g=m.length,v=e.occurrences,y=v.length,d=0;d<y;d++){var b=v[d],C=b.parentPhysicalId,w=b.ConnectionId;-1==b.parentOccNdx&&(h=coccur.occurrenceid,f=b.occurrenceid+g,C=t,w="12345");for(var S=b.nodeNdx+s,D=String(S),_={ConnectionId:w,isLeaf:b.isLeaf,level:b.level+coccur.level+1,nodeNdx:S,nodeid:D,occurrenceid:b.occurrenceid+g,parentNodeNdx:-1==b.parentNodeNdx?coccur.nodeNdx:b.parentNodeNdx+s,parentOccNdx:-1==b.parentOccNdx?coccur.occurrenceid:b.parentOccNdx+g,parentPhysicalId:C,pathWithout:[],pathWith:[],xform:b.xform},T=b.pathWithout,E=T.length-1;E>=0;E--)_.pathWithout.unshift(T[E]);for(var A=coccur.pathWithout,E=A.length-1;E>=0;E--)_.pathWithout.unshift(A[E]);for(var T=b.pathWith,E=T.length-1;E>=0;E--)_.pathWith.unshift(T[E]);for(var I=coccur.pathWith,E=I.length-1;E>=0;E--)_.pathWith.unshift(I[E]);m.push(_)}var x=r.occurrencerelationships,O=e.occurrencerelationships,N=O.length,P={parent:h,child:f,physicalid:"12345",treeOrder:"",PLM_ExternalID:"INSERTED_BY_ASSEM_EDITOR"};x.push(P);for(var d=0;d<N;d++){var R=O[d],L={parent:0==R.parent?f:R.parent+g,child:R.child+g,physicalid:R.physicalid,treeOrder:R.treeOrder,PLM_ExternalID:R.PLM_ExternalID};x.push(L)}}return r}(i,t,null==r?function(e,t,i){for(var r=[],a=0;a<i.length;a++){var n=i[a];t[n.nodeNdx].physicalid==e&&r.push(n)}return r}(t,n,a):r,e)}function l(e,t,o){for(var s=(m=e.occurrences).length,l=function(e,t,i){for(var r=[],a=0;a<e.length;a++){var n=e[a],o=n.parentPhysicalId;n.ConnectionId==i&&o==t&&r.push(n)}return r}(m,t,o),c=l.length,d=[],u=[],p=0;p<s;p++){u[(f=m[p]).occurrenceid]=f}for(p=0;p<c;p++){var h=u[(f=l[p]).parentOccNdx];d.push(h)}for(k=0;k<c;k++){var f,m=e.occurrences;if(null!=(f=l[k])){var g=e.occurrencerelationships,v=i(f.occurrenceid,g),y=r(v,m);e.occurrences=n(v,m,y),e.occurrencerelationships=a(v,g,y)}}return d}function c(e,t,i,r){s(e,t,i,l(e,t,r))}return{doEdits:function(t,i){var r=[];try{for(var a=i.length,n=new Array(a),s=0;s<a;s++){var l=(g=i[s]).rootoccurrence,c=g.occurrences[l],d=g.nodes[c.nodeNdx].physicalid;n[s]=d}for(var u=t.items.length,p=0;p<u;p++){var h=t.items[p],f=h.objectId,m=h.commands,g=i[p];if(null!=m){e("APPLYING EDITS to assembly with root: "+f);var v=g.rootoccurrence,y=g.occurrences[v],b=g.nodes[y.nodeNdx];if(b.physicalid!=f)throw new Error("Failure in edit id #:"+p+", "+b.physicalid+" expected to be equal to "+cObjectId);o(g,m,i,n)}r.push(g)}}catch(e){return console.error("COMPARE>> exception in AssemblyEdit.doEdits() : "+e),!1}return r}}}),define("DS/CompareWidget/PickDialogView",["UWA/Core","UWA/Class/View","UWA/Class/Model","UWA/Class/Collection","UWA/Drivers/Alone","DS/UIKIT/Input/Button","DS/WAFData/WAFData","DS/W3DXComponents/Skeleton","DS/CompareCommon/CompareImgSrc","DS/ENOXVersionExplorerController/VersionExplorerController","DS/ENOXVersionExplorerUtils/VersionExplorerEnums","DS/ENOXVersionExplorerUtils/VersionExplorerSettings","DS/LifecycleServices/LifecycleServices","i18n!DS/CompareWidget/assets/nls/CompareWidget","css!DS/CompareWidget/CompareWidget.css"],function(e,t,i,r,a,n,o,s,l,c,d,u,p,h){"use strict";var f=null,m=l.defaultThumbnailPath,g=l.getObjTypeIconPath("Default"),v=l.thumbnailUrlPath,y=l.iconUrlPath,b="revisionsFacet",C="alternateDesignsFacet",w="historyGraphFacet",S="filtersFacet",D="",_="",T=-1,E="",A="",I="",x="",O=null,N=null;function P(e,t,i,r,a,n){if("3DSpace"===i.serviceId){var s=i.physicalid,c="undefined"!=typeof widget&&widget?widget.getValue("x3dPlatformId"):null;null!=c&&""!=c||(c="OnPremise");var d=e+v+s+"/?tenant="+c+"&root3DSpaceUrl="+e,u=e+m;o.authenticatedRequest(d,{ndx:0,proxy:t,onComplete:function(t){if(t.endsWith("iconLargeDefault.png")){var i=l.getObjTypeLargeIconPath(n);null!=i&&(t=e+"/"+i)}jQuery(a).find(r).attr("src",t)},onFailure:function(){jQuery(a).find(r).attr("src",u)}})}else jQuery(a).find(r).attr("src",i.preview_url)}function R(e,t,i,r,a,n){if("3DSpace"===i.serviceId){var s=i.physicalid,c="undefined"!=typeof widget&&widget?widget.getValue("x3dPlatformId"):null;null!=c&&""!=c||(c="OnPremise");var d=e+y+s+"/?tenant="+c+"&root3DSpaceUrl="+e,u=e+g;o.authenticatedRequest(d,{ndx:0,proxy:t,onComplete:function(t){if(t.endsWith("iconLargeDefault.png")){var i=l.getObjTypeIconPath(n);null!=i&&(t=e+"/"+i)}jQuery(a).find(r).attr("src",t)},onFailure:function(){jQuery(a).find(r).attr("src",u)}})}else jQuery(a).find(r).attr("src",i.type_icon_url)}function L(e,t,i,r){if(t.physicalid!=E||null===e.getElement(".picked-tile-sub-container")){var a=i+m,n=i+g,o="#"+e.id,s=t["PLMEntity.V_Name"];null!=s&&""!=s||(s=t.Title),null!=s&&""!=s||(s=t.name),e.setContent(jQuery('<div class="picked-tile-sub-container" id="'+t.physicalid+'"><div class = "picked-tile-header"><img class = "picked-tile-image"  alt="[img missing]" id="picked-thumb" src="'+a+'" draggable="false"></div><div class = "picked-tile-body"><img class = "picked-tile-icon" id="picked-icon"  src="'+n+'" draggable="false" onError="this.onerror=null;this.src=\''+n+'\';"><div class = "picked-tile-title">'+s+'</div><div class = "picked-tile-subtitle">'+t.type+'</div><div class = "picked-tile-content">'+t.revision+"</div></div></div>")),P(i,r,t,"#picked-thumb",o,t.internalType),R(i,r,t,"#picked-icon",o,t.internalType),E=t.physicalid,A=t.isFilter?t.revision:t.name+" "+t.revision,I=t.type,x=t.internalType}}var W=i.extend({idAttribute:"physicalid",sync:function(t,i,r){return this._parent(t,i,e.merge({ajax:o.authenticatedRequest,headers:{Accept:"application/json","Content-Type":"application/json",SecurityContext:encodeURIComponent(this.securityContext)},onFailure:r.onComplete,type:"json",proxy:i.proxyType,timeout:12e4},r))}}),j=i.extend({sync:function(t,i,r){return this._parent(t,i,e.merge({ajax:o.authenticatedRequest,headers:{Accept:"application/json","Content-Type":"application/json",SecurityContext:encodeURIComponent(this.securityContext)},onFailure:r.onComplete,type:"json",proxy:i.proxyType,timeout:12e4},r))}}),V=i.extend({sync:function(t,i,r){return this._parent(t,i,e.merge({ajax:o.authenticatedRequest,headers:{Accept:"application/json","Content-Type":"application/json",SecurityContext:encodeURIComponent(this.securityContext)},onFailure:r.onComplete,type:"json",proxy:i.proxyType,timeout:12e4},r))}}),F=i.extend({sync:function(t,i,r){return this._parent(t,i,e.merge({ajax:o.authenticatedRequest,headers:{Accept:"application/json","Content-Type":"application/json",SecurityContext:encodeURIComponent(this.securityContext)},method:"POST",onFailure:r.onComplete,type:"json",data:JSON.stringify([i.droppedId]),proxy:i.proxyType,timeout:12e4},r))}});function M(e,t,i){for(var r=!1,a=0;a<i.length&&!r;a++){var n=i[a];n.trg===e&&(r=t.indexOf(n.src)>=0||M(n.src,t,i))}return r}function k(e,t,i,r){for(var a=0;a<t.length;a++){var n=t[a];n.typ.contains("revision")&&("earlier"!==i&&n.src===e&&(r.push(n.trg),k(n.trg,t,"later",r)),"later"!==i&&n.trg===e&&(r.push(n.src),k(n.src,t,"earlier",r)))}}function B(t){return r.extend({nameSelFacet:t,setup:function(e,i){this.url=i.baseURL,this.tenant="undefined"!=typeof widget&&widget?widget.getValue("x3dPlatformId"):null,null!=this.tenant&&""!=this.tenant||(this.tenant="OnPremise"),this.errorMngt=i.errorMngt,this.oId=i.rootObj.physicalid,this.objType=i.rootObj.internalType,this.droppedId=i.droppedObj.physicalid,this.isFilter=i.droppedObj.isFilter,this.securityContext=i.securityContext,this.proxyType=i.proxyType,this.container=i.container,this.baseContainer=i.baseContainer,this.callbackFn=i.callbackFn,this.dataSetRev=i.dataSetRev,this.dataSetAlt=i.dataSetAlt,this.isOdt=i.isOdt,this.isHistoryEmbedded=i.isHistoryEmbedded,this.isCompare=i.isCompare;var r=this.container.getElements(".facetviews > .set-container");r.length;t===b?this.model=W:t===C?(this.model=j,void 0===i.dupFiltering||null===i.dupFiltering?this.dupFiltering="all":this.dupFiltering=i.dupFiltering,void 0===i.dupRevsFiltering||null===i.dupRevsFiltering?this.dupRevsFiltering="all":this.dupRevsFiltering=i.dupRevsFiltering,T=r.length):this.model=t===w?V:F},parse:function(e){var i,r=this,a=[];if(!0===this.isOdt()&&(e=t===b?this.dataSetRev:this.dataSetAlt),t===b)if("SoftwareLogicalItem"===x){var o=0;if(e.graphs.length>0){o=e.graphs[0].versions.length;var s="";for(z=0;z<o;++z){e.graphs[0].versions[z].codeForThisBranch="";var l=e.graphs[0].versions[z].code.lastIndexOf("_");l>-1&&(e.graphs[0].versions[z].id===this.oId?s=e.graphs[0].versions[z].code.slice(0,l):e.graphs[0].versions[z].codeForThisBranch=e.graphs[0].versions[z].code.slice(0,l))}for(z=0;z<o;++z)e.graphs[0].versions[z].id!=this.oId&&e.graphs[0].versions[z].codeForThisBranch===s&&(e.graphs[0].versions[z].physicalid=e.graphs[0].versions[z].id,e.graphs[0].versions[z].internalType=e.graphs[0].versions[z].type,e.graphs[0].versions[z].name=e.graphs[0].versions[z].label,e.graphs[0].versions[z].revision=e.graphs[0].versions[z].code,""!==I&&(e.graphs[0].versions[z].type=I),a.push(e.graphs[0].versions[z]))}}else{for(var c=e.results,d=(o=c?c.length:0,0);d<o;d++){var u=(R=c[d])["PLMEntity.V_Name"];u||(u=R.Title)||(u=R.name),R.name=u}if(e.results)for(i=0;i<e.results.length;i++)(e.results[i].physicalid!=this.oId||this.isFilter)&&a.push(e.results[i])}else if(t===C){var p=this.container.getElements(".facetviews > .set-container"),f=p.length;if(T>=0&&T<f){var m=p[T];if(""==m.style.display){var g=m.getElement(".set-header");g.style.display="flex",m.getElement(".set-contents").style.height="calc(100% - 52px)",g.getElement(".set-switcher").hide();var v=g.getElement(".set-actions");if(null===v.getElement("#selDuplicate")){D=r.dupFiltering;var y="";y="direct"===r.dupFiltering?h.get("displayAlternateDepthDirect"):"origin"===r.dupFiltering?h.get("displayAlternateDepthOrigin"):h.get("displayAlternateDepthAll");var S=new n({value:y,id:"selDuplicate",icon:"fonticon-doc-text",attributes:{title:y},dropdown:{items:[{text:h.get("displayAlternateDepthDirect"),value:"DUP_IMM"},{text:h.get("displayAlternateDepthOrigin"),value:"DUP_DESC"},{text:h.get("displayAlternateDepthAll"),value:"DUP_ALL"}]}}).inject(v);S.elements.container.style.marginRight="4px",S.elements.container.style.maxWidth="48%",S.addEvent("onDropdownClick",function(e,t){var i=t.value;if(""!==i&&i!==r.dupFiltering){var a="";"DUP_IMM"===i?(r.dupFiltering="direct",a=h.get("displayAlternateDepthDirect")):"DUP_DESC"===i?(r.dupFiltering="origin",a=h.get("displayAlternateDepthOrigin")):"DUP_ALL"===i&&(r.dupFiltering="all",a=h.get("displayAlternateDepthAll")),this.setValue(a),this.elements.container.title=a,D=r.dupFiltering,require(["DS/UIKIT/Mask"],function(e){var t=r.container.getElement(".facetviews");e.mask(t)}),r.fetch()}})}if(null===v.getElement("#selRevOfDuplicate")){_=r.dupRevsFiltering;var E="";E="top"===r.dupRevsFiltering?h.get("displayAlternateRevisionTop"):"latest"===r.dupRevsFiltering?h.get("displayAlternateRevisionLatest"):"latestPublished"===r.dupRevsFiltering?h.get("displayAlternateRevisionLatestPublished"):h.get("displayAlternateRevisionAll");var O=new n({value:E,id:"selRevOfDuplicate",icon:"fonticon-picture",attributes:{title:E},dropdown:{items:[{text:h.get("displayAlternateRevisionTop"),value:"REV_FIRST"},{text:h.get("displayAlternateRevisionLatest"),value:"REV_LAST"},{text:h.get("displayAlternateRevisionLatestPublished"),value:"REV_LAST_PUB"},{text:h.get("displayAlternateRevisionAll"),value:"REV_ALL"}]}}).inject(v);O.elements.container.style.marginLeft="4px",O.elements.container.style.maxWidth="48%",O.addEvent("onDropdownClick",function(e,t){var i=t.value;if(""!==i&&i!==r.dupRevsFiltering){var a="";"REV_FIRST"===i?(r.dupRevsFiltering="top",a=h.get("displayAlternateRevisionTop")):"REV_LAST"===i?(r.dupRevsFiltering="latest",a=h.get("displayAlternateRevisionLatest")):"REV_LAST_PUB"===i?(r.dupRevsFiltering="latestPublished",a=h.get("displayAlternateRevisionLatestPublished")):"REV_ALL"===i&&(r.dupRevsFiltering="all",a=h.get("displayAlternateRevisionAll")),this.setValue(a),this.elements.container.title=a,_=r.dupRevsFiltering,require(["DS/UIKIT/Mask"],function(e){var t=r.container.getElement(".facetviews");e.mask(t)}),r.fetch()}})}}}if(e.nodes){var N=-1;for(i=0;i<e.nodes.length;i++)if(e.nodes[i].id===this.oId){N=e.nodes[i].nId;break}var P=new Array;for(P.push(N),k(N,e.connections,"both",P),i=0;i<e.nodes.length;i++){var R;if((R=e.nodes[i]).physicalid=R.id,R.name=R.displayName,R.physicalid===this.oId);else if(P.indexOf(R.nId)>=0);else{var L=!1;if("top"===r.dupRevsFiltering){for(var W=!1,j=0;j<e.connections.length;j++){if((H=e.connections[j]).typ.contains("revision")&&H.trg===R.nId){W=!0;break}}0==W&&(L=!0)}else if("latest"===r.dupRevsFiltering||"latestPublished"===r.dupRevsFiltering&&!0===e.nodes[i].ispublished){var V=!1;for(j=0;j<e.connections.length;j++){if((H=e.connections[j]).typ.contains("revision")&&H.src===R.nId){if("latest"===r.dupRevsFiltering){V=!0;break}for(var F=0;F<e.nodes.length;F++)if(e.nodes[F].nId===H.trg&&!0===e.nodes[F].ispublished){V=!0;break}if(1==V)break}}0==V&&(L=!0)}else L=!0;if(L){var B=!1;if("direct"===r.dupFiltering){var U=new Array;U.push(R.nId),k(R.nId,e.connections,"both",U);for(j=0;j<e.connections.length;j++){var H;"duplicate"===(H=e.connections[j]).typ&&H.src===N&&U.indexOf(H.trg)>=0&&(B=!0)}}else if("origin"===r.dupFiltering){var G=new Array;G.push(N),B=M(R.nId,G,e.connections)}else B=!0;B&&a.push(R)}}}}}else if(t===w)this.isHistoryEmbedded&&r.container.getElement(".versionexplorer-toolbar")&&null!=r.container.getElements(".root-skeleton-container")&&(null!=r.container.getElements(".root-skeleton-container")[0]&&r.container.getElements(".root-skeleton-container")[0].setStyle("display","none"),null!=r.container.getElements(".root-skeleton-container")[1]&&r.container.getElements(".root-skeleton-container")[1].setStyle("display","none"));else{var Q=[],J=e.success;if(J)for(var q=J.length,z=0;z<q;z++){J[z][this.oId].forEach(function(e){Q.push(e)})}for(z=0;z<Q.length;z++){var K=Q[z],X=K.filterId,Y={physicalid:X,id:X,name:K.filterTitle,internalType:"ENOStrRefinementSpecification",type:h.get("filterType"),revision:A,isFilter:!0,filter:K};Y.physicalid!=this.droppedId&&a.push(Y)}}require(["DS/UIKIT/Mask"],function(e){var t=r.container.getElement(".facetviews");e.unmask(t)}),jQuery('*[data-name="Refresh"]').removeClass("wux-ui-state-disabled"),jQuery('*[data-name="RemoveAll"]').removeClass("wux-ui-state-disabled");var Z=this.container.getElement(".facets-list > .facet.interactive.tab-behavior.selected");if(this.nameSelFacet===Z.dataset.name&&(ae(),0===a.length)){var $="";if($=this.nameSelFacet===b?h.get("noRevision"):this.nameSelFacet===C?h.get("noAlternateDesign"):h.get("noFilters"),!this.isHistoryEmbedded){var ee=this.container.getElement(".facetviews"),te=UWA.createElement("div",{id:"empty-msg",html:$});ee.appendChild(te)}var ie=r.container.getElements(".facets-list > .facet.interactive.tab-behavior");for(z=0;z<ie.length;++z){var re=ie[z];re.hasClassName("selected")||re.addEventListener("click",ae)}}function ae(){for(var e=r.container.getElements(".facets-list > .facet.interactive.tab-behavior"),t=0;t<e.length;++t){var i=e[t];i.hasClassName("selected")||i.removeEventListener("click",ae)}r.container.getElement("#empty-msg")&&r.container.getElement("#empty-msg").remove()}return a.sort(function(e,t){return e.nId-t.nId}),require(["DS/UIKIT/Mask"],function(e){e.unmask(r.container)}),a},sync:function(){return this.model.prototype.sync.apply(this,arguments)},fetch:function(){var t;this.isHistoryEmbedded?null!=(t=this.container.getElement(".version-global-div"))&&t.setStyle("display","none"):(t=jQuery('*[data-name="'+this.nameSelFacet+'"]'))[0].hasClassName("selected")&&this.closeHistoryGraphDialog();var i="";if(this.nameSelFacet===b)r="SoftwareLogicalItem"===x?"/resources/v1/dslc/versiongraph/"+this.oId+"?withAttributes=1":"/resources/compare/revisions2?tenant="+this.tenant+"&objectId="+this.oId,i=this.url+r;else if(this.nameSelFacet===C){r="/resources/lifecycle/history/links?tenant="+this.tenant+"&physicalid="+this.oId+"&depth=100&type=all",i=this.url+r}else if(this.nameSelFacet===w)O=this,this.displayHistoryGraph(),O.isHistoryEmbedded&&(i=this.url);else{var r="/resources/FilterBIAPI/Filter/retrieveFiltersForRoots?tenant="+this.tenant;i=this.url+r}return""!=i?this._parent(e.merge({url:i})):i},displayHistoryGraph:function(){var e=this,t=null;e.isHistoryEmbedded&&(t=e.container.getChildren()[0].getChildren()[0].getChildren()[1].getChildren()[1]),e.versionExplorer=new c({versionGraphContainer:t,widget:widget,autoUpdate:!1,useGlobalStorage:e.isCompare,globalStorageName:"historyUserSettings"}),e.versionExplorer.setSingleSelectionMode(),e.versionExplorer.disableCommands(),e.isHistoryEmbedded||e.versionExplorer.showDialog({className:"VEPickDialogModal"},void 0,!0),N=e.versionExplorer;var i={displayLegend:!1};if(p.getHistoryConfigPromise().then(function(e){u.historyConfig=e,u.historyConfig&&u.historyConfig.settings&&(u.historyConfig.settings.defaultView&&(i.displayMode=d.DISPLAY_MODES[u.historyConfig.settings.defaultView]),u.historyConfig.settings.thumbnailGraph&&(u.historyConfig.settings.thumbnailGraph.thumbnailGraphLayout&&(i.thumbnailGraphLayout=u.historyConfig.settings.thumbnailGraph.thumbnailGraphLayout),u.historyConfig.settings.thumbnailGraph.displayThumbnailOverview&&(i.displayThumbnailOverview="true"===u.historyConfig.settings.thumbnailGraph.displayThumbnailOverview)),u.historyConfig.settings.subwayGraph&&(u.historyConfig.settings.subwayGraph.subwaySort&&(i.subwaySortAscending="asc"===u.historyConfig.settings.subwayGraph.subwaySort),"SUBWAY_COMPACT_VIEW"!==u.historyConfig.settings.subwayGraph.viewMode&&"SUBWAY_COMFORTABLE_VIEW"!==u.historyConfig.settings.subwayGraph.viewMode||(i.subwayViewMode=u.historyConfig.settings.subwayGraph.viewMode)))},function(){}).finally(function(){u.loadUserSettingsPromise(i,!1,e.isCompare,"historyUserSettings").then(function(){e.versionExplorer.publishEvent("ENOXVersionExplorerLoadVersionModel",{id:O.oId,type:O.objType,tenantId:O.tenant,securityContext:O.securityContext,onComplete:function(){e.versionExplorer.applyFilter(function(e){return O.oId!==e._options.id})},dataModelType:d.DATA_MODEL_TYPES.MODEL_HISTORY})})}),O.container.getElement("#empty-msg")&&O.container.getElement("#empty-msg").remove(),!e.isHistoryEmbedded){var r=jQuery('*[data-name="historyGraphFacet"]');null!=r&&r.length>0&&r[0].removeEventListener("click",O.displayHistoryGraph)}e.versionExplorer.subscribeEvent("ENOXVersionExplorerModalCancel",function(t){N=null,O.processEmptyHistoryGraphResults(h.get("noHistoryGraphSelection")),e.versionExplorer.cleanup()},!1),e.versionExplorer.subscribeEvent("ENOXVersionExplorerModalOK",function(t){N=null;var i=e.versionExplorer.getSelectedNodes(),r=i.length;if(r>0){for(var a,n=0;n<r;++n)i[n].options.data.physicalid!==O.oId&&void 0===a&&(a=i[n].options.data);void 0!==a?O.callbackFn(a):O.processEmptyHistoryGraphResults(h.get("rootHistoryGraphSelection"))}else O.processEmptyHistoryGraphResults(h.get("noHistoryGraphSelection"));e.versionExplorer.cleanup()},!1),e.versionExplorer.subscribeEvent("select",function(t){if(e.isHistoryEmbedded){N=null;var i=e.versionExplorer.getSelectedNodes(),r=i.length;if(r>0){for(var a,n=0;n<r;++n)i[n].options.data.physicalid!==O.oId&&void 0===a&&(a=i[n].options.data);void 0!==a?O.callbackFn(a):O.processEmptyHistoryGraphResults(h.get("rootHistoryGraphSelection"))}else O.processEmptyHistoryGraphResults(h.get("noHistoryGraphSelection"))}},!1)},processEmptyHistoryGraphResults:function(e){var t=O.container.getElement(".facetviews"),i=UWA.createElement("div",{id:"empty-msg",html:e});t.appendChild(i);var r=jQuery('*[data-name="historyGraphFacet"]');null!=r&&r.length>0&&r[0].addEventListener("click",O.displayHistoryGraph)},closeHistoryGraphDialog:function(){null!==N&&N.hideDialog(),N=null},refreshOptions:function(e,t){this.oId=e.physicalid,this.droppedId=t.physicalid,this.isFilter=t.isFilter}})}function U(e){return{baseURL:e.revServiceURL,droppedObj:e.droppedObj,rootObj:e.rootObj,securityContext:e.securityContext,container:e.listContainer,baseContainer:e.baseContainer,proxyType:e.proxyType,callbackFn:e.callbackFn,dataSetRev:e.dataSetRev,dataSetAlt:e.dataSetAlt,isOdt:function(){return"object"==typeof e.dataSetRev},duplicateOnly:e.duplicateOnly,dupFiltering:e.dupFiltering,dupRevsFiltering:e.dupRevsFiltering,bHistoryGraphSelector:e.bHistoryGraphSelector,isHistoryEmbedded:e.isHistoryEmbedded,isCompare:e.isCompare}}function H(e,t,r,a){var n=1==a?{selectedFacet:t,facets:[{name:w,text:h.get("revisions"),icon:"flow-branch-list",handler:s.getRendererHandler("historyGraph")}]}:{selectedFacet:t,facets:[{name:b,text:h.get("revisions"),icon:"picture",handler:s.getRendererHandler("revisions")},{name:C,text:h.get("alternateDesigns"),icon:"doc-text",handler:s.getRendererHandler("alternateDesigns")}]};return widget.getBool("useIndex")&&n.facets.push({name:S,text:h.get("filters"),icon:"filter",handler:s.getRendererHandler("filters")}),null!=r&&1==r&&n.facets.splice(0,1),n.model=new i,n}return t.extend({setup:function(t){var i={useInfiniteScroll:!1,usePullToRefresh:!1},r={useInfiniteScroll:!1,usePullToRefresh:!1,itemViewOptions:{mapping:{subtitle:"type",image:function(){P(this.model.collection.url,this.model.collection.proxyType,this.model._attributes.physicalid,".tile-image",this.container,this.model._attributes.internalType);return this.model.collection.url+m},content:"revision",title:"name",icon:function(){var e;R(this.model.collection.url,this.model.collection.proxyType,this.model._attributes.physicalid,".tile-icon",this.container,this.model._attributes.internalType);return e=this.model._attributes.internalType,this.model.collection.url+"/"+l.getObjTypeIconPath(e)},Nodeid:"physicalid"}},events:{onItemViewSelect:function(e){var t=arguments[arguments.length-1],i=t.model||t;e.collection.callbackFn(i._attributes)},onItemViewDrag:function(e,t,i){var r="undefined"!=typeof widget&&widget?widget.getValue("x3dPlatformId"):null;null!=r&&""!=r||(r="OnPremise");var a=t.model._attributes.internalType;null!=a&&""!=a||(a=t.model._attributes.typeUntranslated);var n={protocol:"3DXContent",version:"0.1",source:"FBS_BIP_LIST",data:{items:[{envId:r,serviceId:"3DSpace",subtitle:t.model._attributes.type,content:t.model._attributes.revision,contextId:"_Local",objectId:t.model._attributes.physicalid,objectType:a,displayType:t.model._attributes.type,displayName:t.model._attributes.name}]}};i.dataTransfer.setData("text",JSON.stringify(n))}}};i.contents=e.clone(r);var a={revisions:{collection:B(b),collectionOptions:U(t),view:null,viewOptions:i,idCardOptions:H(0,b,t.duplicateOnly,t.bHistoryGraphSelector)},alternateDesigns:{collection:B(C),collectionOptions:U(t),view:null,viewOptions:i,idCardOptions:H(0,C,t.duplicateOnly,t.bHistoryGraphSelector)},historyGraph:{collection:B(w),collectionOptions:U(t),view:null,viewOptions:i,idCardOptions:H(0,w,t.duplicateOnly,t.bHistoryGraphSelector)},filters:{collection:B(S),collectionOptions:U(t),view:null,viewOptions:i,idCardOptions:H(0,S,t.duplicateOnly,t.bHistoryGraphSelector)}};if(null!=t.duplicateOnly&&1==t.duplicateOnly){t={rootIdCardOptions:H(0,C,t.duplicateOnly,t.bHistoryGraphSelector)};delete a.revisions,delete a.historyGraph,delete a.filters}else t={rootIdCardOptions:H(0,b,t.duplicateOnly,t.bHistoryGraphSelector)};f=new s(a,t),T=-1;var n=this;f.addEvent("onRouteChange",function(){void 0!==n.options.facetToSelect&&null!==n.options.facetToSelect&&""!==n.options.facetToSelect&&(jQuery('*[data-name="'+n.options.facetToSelect+'"]').trigger("click"),n.options.facetToSelect=null),n.dispatchEvent("onRouteChange")})},render:function(){var e;return(e=a.extendElement(this.container)).empty(),L(this.options.baseContainer,this.options.droppedObj,this.options.revServiceURL,this.options.proxyType),f.render().inject(e),this},refresh:function(e,t,i,r){L(this.options.baseContainer,e,this.options.revServiceURL,this.options.proxyType);for(var a,n,o=0,s=f.getNodeAt(o);s;){for(a=0;a<s.get("facets").length;a++)(n=s.get("facets")[a]).collection&&(n.collection.nameSelFacet===C&&(void 0!==i&&(n.collection.dupFiltering=i),void 0!==r&&(n.collection.dupRevsFiltering=r)),n.collection.refreshOptions(t,e),n.reference==s._changed.activeFacet.reference&&n.collection.fetch());o++,s=f.getNodeAt(o)}},getDupFilteringValues:function(){return{duplicates:D,revsOfDuplicates:_}},closeHistoryGraphDialog:function(){null!==O&&O.closeHistoryGraphDialog()}})}),define("DS/CompareWidget/ViewStateMgr",["i18n!DS/CompareWidget/assets/nls/CompareContent"],function(e){var t=function(e,t,i){var r=e.rootElement.getElement("#"+t);null!=r&&(i?r.show():r.hide())},i=function(e,t,i,r,a){null!=e&&(t?(e.removeClass("wux-ui-state-disabled"),i?(e.addClass("wux-ui-state-active"),e.attr("data-command",r)):(e.removeClass("wux-ui-state-active"),e.attr("data-command",a))):e.addClass("wux-ui-state-disabled"))},r=function(e){this.ccontent=e};return r.prototype.updateWidgetViewState=function(t,r,a){var n=null!=t.idDataList?t.idDataList.get_nonNullCount():0,o=0,s=document.getElementById("compare-tree-base");if(null!==s){var l=s.getElementsByClassName("fancytree-active");null!==l&&(o=l.length)}var c=0,d=document.getElementById("compare-tree-to-1");if(null!==d){var u=d.getElementsByClassName("fancytree-active");null!==u&&(c=u.length)}var p=!1;(0==o&&0==c||o>1||c>1)&&(p=!0),1!=a&&function(e,t,i){var r=function(e){var t=e.getPanelParameters();//!(UWA.Utils.Client.Platform.ios || UWA.Utils.Client.Platform.android);
return{uPrefs:{pref_vizStructPanel:t.vizStructPanel,pref_vizOverview:t.vizOverview,pref_vizLegend:t.vizLegend,pref_vizAttrTable:t.vizAttrTable,pref_vizViewerPanel:t.vizViewerPanel},wState:{state_viewerSupported:e.supportedForViewer&&!0,state_isListView:e.isListView}}}(e),a=r.uPrefs,n=r.wState,o=!1,s=!1,l=!1,c=!1,d=!1,u=!1,p=!1,h=!1,f=!1;t<=1?(o=!0,s=!0):t>2?(d=!0,u=!0):e.bGenericCompare?(d=!0,u=!0):(f=!0,(o=!0)&&a.pref_vizStructPanel&&(s=!0),c=a.pref_vizOverview,l=a.pref_vizLegend,(d=1!=i)&&a.pref_vizAttrTable&&(u=!0),(p=n.state_viewerSupported)&&a.pref_vizViewerPanel&&(h=!0)),function(e,t){if(e.displayFlags.showLeft!==t.showLeft){let i=e.leftPanel;t.showLeft?(e.layout.showPanel(i),i.hider.displayState=!0,i.splitter.displayState=!0,i.expander.displayState=!1):(e.layout.hidePanel(i),i.hider.displayState=!1,i.splitter.displayState=!1,i.expander.displayState=!0)}if(e.displayFlags.expandLeft!==t.expandLeft){let i=e.leftPanel;t.expandLeft?(e.layout.expand(i),i.hider.displayState=!0,i.splitter.displayState=!0,i.expander.displayState=!1):(e.layout.collapse(i),i.hider.displayState=!1,i.splitter.displayState=!1,i.expander.displayState=!0)}if(e.displayFlags.showLegend!==t.showLegend){var i=e.rootElement.getElement("#compare-legend");null!=i&&(t.showLegend?i.show():i.hide())}if(e.displayFlags.showOverview!==t.showOverview){var r=e.rootElement.getElement("#overview-container");null!=r&&(t.showOverview?r.show():r.hide())}if(e.displayFlags.expandMid!==t.expandMid){let i=e.midPanel;t.expandMid?(e.layout.expand(i),i.hider.displayState=!0,i.splitter.displayState=!0,i.expander.displayState=!1):(e.layout.collapse(i),i.hider.displayState=!1,i.splitter.displayState=!1,i.expander.displayState=!1),t.showMid?e.layout.showPanel(i):e.layout.hidePanel(i)}if(e.displayFlags.expandRight!==t.expandRight){let i=e.rightPanel;t.expandRight?(e.layout.expand(i),i.hider.displayState=!0,i.expander.displayState=!1):(e.layout.collapse(i),i.hider.displayState=!1,i.expander.displayState=!0)}if(e.displayFlags.showRight!==t.showRight){let i=e.rightPanel;t.showRight?e.layout.showPanel(i):e.layout.hidePanel(i)}t.showControllers?(e.layout.hideControllers(!1,!0),e.layout.showControllers()):e.layout.hideControllers(!0,!1),e.displayFlags=t}(e,{showControllers:f,showLeft:o,expandLeft:s,showOverview:c,showLegend:l,showMid:d,expandMid:u,showRight:p,expandRight:h})}(t,n,p),function(t,r,a){function n(e){return jQuery('.wux-afr-cmdContainer > div.wux-afr-cmdstarter[data-name="'+e+'"]')}var o=t.getPanelParameters();i(n("ToggleListView"),2==r&&!t.bGenericCompare,t.isListView,e.ListViewDeactivate,e.ListViewActivate),i(n("ToggleOverview"),2==r&&!t.bGenericCompare,o.vizOverview,e.OverviewHide,e.OverviewShow),i(n("ToggleLegend"),2==r&&!t.bGenericCompare,o.vizLegend,e.LegendHide,e.LegendShow);var s=r>=2&&0==a;s&&t.leftPanel.isHidden()&&!t.midPanel.isHidden()&&t.rightPanel.isHidden()&&t.layout.controllersHidden&&(s=!1);i(n("ToggleAttr"),s,o.vizAttrTable,e.AttrHide,e.AttrShow),i(n("CustomizeRows"),!t.midPanel.isHidden(),!1,e.customizeRows,e.customizeRows),i(n("SwapColumns"),2==r,!1,"","");var l=!t.bGenericCompare;//!(UWA.Utils.Client.Platform.ios || UWA.Utils.Client.Platform.android);
i(n("CompareExport"),2==r&&l&&!0,!1,"",""),i(n("Refresh"),r>=1,!1,"",""),i(n("RemoveAll"),r>=1,!1,"","")}(t,n,p)},r.prototype.showElement=function(e,i,r){t(e,i,r)},r}),define("DS/CompareWidget/CompareActionBar",["DS/ApplicationFrame/ActionBar","UWA/Utils/Client"],function(e,t){"use strict";var i=t.getScrollbarWidth();var r=e.extend({_checkWidth:function(){if(0!=this._afr.getNumberOfSections()){var e=this._preferences.getIsCollapsedPreference();null!==e&&e?this.close(!1):null===e||e||this.open(!1);var t=this._afr.getCurrentSection();void 0!==t&&void 0===t._minimumWidthValue&&(t._minimumWidthValue=t.getContent().getDimensions().width);var r=void 0===this.elements.chevron?0:this.elements.chevron.getDimensions().width,a=this.elements.container.getDimensions().width-r,n=0;if(this._tabBar.visibleFlag&&(n=Math.min(this._tabBar.getWidthWithoutScroll(),a)),this._tabBar.minWidth=n,this.elements.container.getParent()&&t){var o,s=this;o=t.getContent();var l=this.elements.container.getParent().getDimensions();this._afr.elements.borderContainer.setStyles({minWidth:this._tabBar.minWidth+r});l.width;var c=document.getElementById("compare-region-left");if(null==c)return;var d=document.getElementById("compare-region-mid"),u=c.offsetWidth+d.offsetWidth,p=o.getDimensions().width;0===u?jQuery("#compare-actionbar").hide():(jQuery("#compare-actionbar").show(),p>u?(s._afr.elements.container.addClassName("wux-ui-scrollbuttons-h"),s._afr.elements.container.setStyles({display:"block",minWidth:""}),s._afr.getWorkbench()["@view"].style.marginBottom=-i-3+"px"):(s._afr.elements.container.removeClassName("wux-ui-scrollbuttons-h"),s._afr.elements.container.setStyles({display:"inline-block",verticalAlign:"top"}),s._afr.getWorkbench()["@view"].style.marginBottom=""))}this.getNumberOfSections()<=1?this._tabBar.hide():"true"===this.elements.container.getAttribute("data-open")&&this._tabBar.show(),function(e){if(!e)throw new Error("Action Bar not defined");if(e._afr){var t=e._afr.getWorkbench()["@view"];if(t&&t.getParent()){var i=e._afr.getWorkbench()["@view"].getParent().getDimensions();e._modelEvents.publish({event:"ACTIONBAR_WIDTH_CHANGE",data:i.width})}}}(this)}}});return r.getCmd=function(e){return{button:jQuery('*[data-name="'+e+'"]'),onExecute:function(e){this.button.click(()=>{this.isEnabled()&&e()})},enable:function(){this.button.removeClass("wux-ui-state-disabled")},disable:function(){this.button.addClass("wux-ui-state-disabled")},isEnabled:function(){return!this.button.hasClass("wux-ui-state-disabled")}}},r}),define("DS/CompareWidget/ColumnPanelLayout",["UWA/Controls/Abstract","DS/WAFData/WAFData","DS/WidgetServices/WidgetServices","DS/CompareCommon/Utils"],function(e,t,i,r){return e.extend({init:function(e){this._parent({}),that=this,this.panels=this.getPanelsFromOptions(e),this.onExpand=e.onExpand,this.onCollapse=e.onCollapse,this.onResize=e.onResize,this.elements.container=UWA.createElement("div",{id:"compare-region"}),this.elements.container.setStyles({width:"100%",height:"100%",position:"relative"}),this.layout=this.elements.container,e.parentElement.appendChild(this.layout),this.controllers=[],this.controllersHidden=!1,this.getPanelParametersToWidget(),this.buildSkeleton(that.panels)},showControllers:function(e){for(var t=0;t<this.controllers.length;t++){var i=this.controllers[t];(i.isHidden()&&!0===i.displayState||e)&&i.show()}this.controllersHidden=!1,this.updatePanelSizes()},hideControllers:function(e,t){for(var i=0;i<this.controllers.length;i++){var r=this.controllers[i];(!r.isHidden()&&!1===r.displayState||e)&&r.hide()}t||(this.controllersHidden=!0,this.updatePanelSizes())},showPanel:function(e,t){(null!=e&&!e.displayState||null!=e&&!0===t)&&(e.isCollapsed?e.expander.show():(e.show(),e.hider.show()),this.updatePanelSizes(),e.displayState=!0)},hidePanel:function(e,t){(null!=e&&!0===e.displayState||null!=e&&!0===t)&&(e.isCollapsed?e.expander.hide():(e.hide(),e.hider.hide()),this.updatePanelSizes())},collapse:function(e,t){null==e||e.isCollapsed||(e.hider.hide(),e.hide(),null!=e.splitter&&e.splitter.hide(),e.expander.show(),t&&("compare-region-left"==e.id?this.setPanelVizParameter("vizStructPanel",!1):"compare-region-mid"==e.id?this.setPanelVizParameter("vizAttrTable",!1):"compare-viewer"==e.id&&this.setPanelVizParameter("vizViewerPanel",!1)),this.updateSplitterVisibilities(),this.updatePanelSizes(),null!=this.onCollapse&&this.onCollapse(e,t),e.isCollapsed=!0,widget.dispatchEvent("onUpdateViewerLegend"))},expand:function(e,t){if(null!=e&&e.isCollapsed){if(e.show(),e.expander.hide(),e.hider.show(),t&&("compare-region-left"==e.id?this.setPanelVizParameter("vizStructPanel",!0):"compare-region-mid"==e.id?this.setPanelVizParameter("vizAttrTable",!0):"compare-viewer"==e.id&&this.setPanelVizParameter("vizViewerPanel",!0)),this.updateSplitterVisibilities(),this.updatePanelSizes(),null!=this.onExpand&&this.onExpand(e,t),e.isCollapsed=!1,"compare-region-mid"===e.id){const e=document.getElementById("attributes-container"),t=document.getElementById("show-diff-only"),i=t.offsetTop+t.offsetHeight;e.setStyles({height:"calc(100% - "+i+"px)","overflow-y":"auto"})}widget.dispatchEvent("onUpdateViewerLegend")}},getPanelsFromOptions:function(e){for(var t=[],i=0;i<e.panels.length;i++){var r=e.panels[i],a=r.panel;a.hiderTitle=r.hiderTitle,a.expanderTitle=r.expanderTitle,t.push(a)}return t},updateSplitterVisibilities:function(){for(var e=this.panels,t=0;t<e.length;t++){var i=e[t];if(i.isHidden())null!=i.splitter&&i.splitter.hide();else null!=this.getNextVisiblePanel(i)?i.splitter.show():null!=i.splitter&&i.splitter.hide()}},updatePanelSizes:function(){var e=this.panels,t=e.length,i=this.getVisiblePanels().length,r=i-1,a=this.getVisibleExpanders().length;this.controllersHidden&&(r=0,a=0);var n=this.layout.offsetWidth;if(0!==n){var o=n-r*this.splitterWidth-a*this.expanderWidth,s=o/n,l=o/i,c=[],d=[],u=this.getPanelParameters();if(u.ratioStructPanel>0){if(3==i)d[0]=u.ratioStructPanel*s,d[1]=u.ratioAttrTable*s,d[2]=u.ratioViewerPanel*s;else if(2==i)if(e[0].isHidden()){var p=u.ratioStructPanel*s;d[0]=u.ratioAttrTable*s+p/2,d[1]=u.ratioViewerPanel*s+p/2}else if(e[1].isHidden()){p=u.ratioAttrTable*s;d[0]=u.ratioStructPanel*s+p/2,d[1]=u.ratioViewerPanel*s+p/2}else{p=u.ratioViewerPanel*s;d[0]=u.ratioStructPanel*s+p/2,d[1]=u.ratioAttrTable*s+p/2}}else 3==i?(c[0]=.49*o,c[1]=.22*o,c[2]=.29*o):2==i?e[0].isHidden()?(c[0]=.3*o,c[1]=.7*o):e[1].isHidden()?(c[0]=.5*o,c[1]=.5*o):(c[0]=.7*o,c[1]=.3*o):1==i&&(c[0]=o);for(var h=0,f=0;f<t;f++){var m=e[f];m.isHidden()||(u.ratioStructPanel>0?m.style.width=1==i?100*Math.floor(l)/n+"%":100*d[h]+"%":c.length===i?m.style.width=100*Math.floor(c[h])/n+"%":m.style.width=100*Math.floor(l)/n+"%",this.onResize&&this.onResize(m),++h)}}},getVisiblePanels:function(){for(var e=[],t=0;t<this.panels.length;t++){var i=this.panels[t];i.isHidden()||e.push(i)}return e},getVisibleExpanders:function(){for(var e=[],t=0;t<this.panels.length;t++){var i=this.panels[t];i.expander.isHidden()||e.push(i.expander)}return e},buildSkeleton:function(e){var t=e.length,i=null;this.panelMinWidth=100,this.splitterWidth=10,this.expanderWidth=20;for(var r=0;r<t;r++){var a=e[r];a.style.cssText="float:left; height:100%; width: 0px;",null!=i&&(i.next=a),i=a;var n=this.createSplitter(a),o=this.createHider(a),s=this.createExpander(a);n.displayState=!1,o.displayState=!1,s.displayState=!1,this.controllers.push(n),this.controllers.push(o),this.controllers.push(s),s.hide(),n.hide(),o.hide(),a.hider=o,a.splitter=n,a.expander=s,r==t-1&&(n.hide(),a.splitter=null),this.layout.appendChild(a),this.layout.appendChild(o),this.layout.appendChild(n),this.layout.appendChild(s)}window.addEventListener("resize",this.updatePanelSizes.bind(this))},createSplitter:function(e){var t=UWA.createElement("div");return t.className="splitter",t.style.cssText="width:"+this.splitterWidth+"px; background-color:#f0f0f0; height:100%; float:left",t.panel=e,t.style.cursor="col-resize",t.addEventListener("mousedown",this.splitterMouseDown.bind(this)),t.addEventListener("touchstart",this.splitterMouseDown.bind(this)),t},createHider:function(e){var t=UWA.createElement("span");return t.title=e.hiderTitle,t.className="hider-icon fonticon-2x fonticon fonticon-left-open",t.style.cssText="margin-left:-26px; float:left; z-index:10000; position: relative",t.panel=e,t.addEventListener("click",this.hiderClick.bind(this)),t},createExpander:function(e){var t=UWA.createElement("span");t.title=e.expanderTitle,t.className="expander-icon fonticon-2x fonticon fonticon-right-open",t.style.cssText="margin-left:-10px";var i=UWA.createElement("div");return i.title=e.expanderTitle,i.className="expander",i.style.cssText="width:"+this.expanderWidth+"px; background-color:#f0f0f0; height:100%; float:left",i.panel=e,i.hide(),i.addEventListener("click",this.expanderClick.bind(this)),i.appendChild(t),i},hiderClick:function(e){var t=e.currentTarget.panel;this.collapse(t,!0)},expanderClick:function(e){var t=e.currentTarget.panel;this.expand(t,!0)},getNextVisiblePanel:function(e){var t=e.next;return null==t?null:t.isHidden()?this.getNextVisiblePanel(t):t},windowMouseMove:function(e){if(0==e.buttons&&(this.movingSplitter=null),null==this.movingSplitter)window.removeEventListener("mousemove",this.windowMouseMoveListener),window.removeEventListener("touchmove",this.windowMouseMoveListener);else{var t=this.movingSplitter.panel,i=e.pageX;"touchmove"==e.type&&(i=Math.round(e.touches[0].pageX));var r=t.offsetLeft,a=t.offsetWidth,n=this.layout.offsetWidth,o=n,s=i-r-a-this.movingSplitter.clickDeltaToLeft,l=this.getNextVisiblePanel(t);if(null!=l&&(o=l.offsetLeft+l.offsetWidth),i>r+this.panelMinWidth&&i<o-this.panelMinWidth){var c=Number(t.style.width.substr(0,t.style.width.length-1));t.style.width=100*(a+s)/n+"%";var d=Number(t.style.width.substr(0,t.style.width.length-1)),u=d-c;0!==u&&(this.onResize&&this.onResize(t),null!=l&&(d=(c=Number(l.style.width.substr(0,l.style.width.length-1)))-u,l.style.width=d+"%",this.onResize&&this.onResize(l)))}}},splitterMouseDown:function(e){if(e.stopPropagation(),e.preventDefault(),e.currentTarget==e.target){var t=this;t.movingSplitter=e.currentTarget;var i=e.pageX;"touchstart"==e.type&&(i=Math.round(e.touches[0].pageX)),t.movingSplitter.clickDeltaToLeft=i-t.movingSplitter.offsetLeft,t.windowMouseMoveListener=t.windowMouseMove.bind(t),window.addEventListener("mousemove",t.windowMouseMoveListener),window.addEventListener("touchmove",t.windowMouseMoveListener),t.windowMouseMoveListener=t.windowMouseMove.bind(t),window.addEventListener("mouseup",function(e){if(null!=t.movingSplitter){t.movingSplitter=null;var i=t.panels,r=(i.length,t.getVisiblePanels().length),a=r-1,n=t.getVisibleExpanders().length;t.controllersHidden&&(a=0,n=0);var o=t.layout.offsetWidth,s=(o-a*t.splitterWidth-n*t.expanderWidth)/o,l=t.getPanelParameters();-1==l.ratioStructPanel&&(l.ratioStructPanel=.49,l.ratioAttrTable=.22,l.ratioViewerPanel=.29);var c=[],d=t.panels[0].style.width;if(c[0]=Number(d.substr(0,d.length-1))/100,d=t.panels[1].style.width,c[1]=Number(d.substr(0,d.length-1))/100,d=t.panels[2].style.width,c[2]=Number(d.substr(0,d.length-1))/100,r>1){var u=c[0]/s,p=c[1]/s,h=c[2]/s;2==r&&(i[0].isHidden()?(p=(c[1]-c[0]/2)/s,h=(c[2]-c[0]/2)/s):i[1].isHidden()?(u=(c[0]-c[1]/2)/s,h=(c[2]-c[1]/2)/s):(u=(c[0]-c[2]/2)/s,p=(c[1]-c[2]/2)/s)),t.setPanelRatioParameters(u,p,h)}}})}},getPanelParameters:function(){var e={};return e.vizStructPanel=widget.getBool("vizStructPanel"),e.ratioStructPanel=widget.getValue("ratioStructPanel"),e.vizAttrTable=widget.getBool("vizAttrTable"),e.ratioAttrTable=widget.getValue("ratioAttrTable"),e.vizViewerPanel=widget.getBool("vizViewerPanel"),e.ratioViewerPanel=widget.getValue("ratioViewerPanel"),e.vizOverview=widget.getBool("vizOverview"),e.vizLegend=widget.getBool("vizLegend"),e},getPanelParametersToWidget:function(){r.setPreferencesToWidget("compare_vizStructPanel","vizStructPanel"),r.setPreferencesToWidget("compare_vizAttrTable","vizAttrTable"),r.setPreferencesToWidget("compare_vizViewerPanel","vizViewerPanel"),r.setPreferencesToWidget("compare_panel_ratios",null,function(e){if(null!=e&&""!=e){var t=e,i=t.split("_");1==i.length&&-1!==t.indexOf("|")&&(i=t.split("|"));for(var r=0;r<i.length;++r){var a=i[r];0==r?widget.setValue("ratioStructPanel",a):1==r?widget.setValue("ratioAttrTable",a):2==r&&widget.setValue("ratioViewerPanel",a)}}})},setPanelVizParameter:function(e,t){widget.setValue(e,t),r.saveUserPreferencesPromise("compare_"+e,t).then(()=>{console.log("COMPARE PANEL LAYOUT: success setting "+e+" preference")},()=>{console.warn("COMPARE PANEL LAYOUT: failed setting "+e+" preference")})},setPanelRatioParameters:function(e,t,i){e+t+i>1?console.log("COMPARE PANEL LAYOUT: panels are too wide"):(widget.setValue("ratioStructPanel",e),widget.setValue("ratioAttrTable",t),widget.setValue("ratioViewerPanel",i),r.saveUserPreferencesPromise("compare_panel_ratios",e+"_"+t+"_"+i).then(()=>{},()=>{console.warn("COMPARE PANEL LAYOUT: failed setting compare_panel_ratios preference")}))}})}),define("DS/CompareWidget/CompareOverview",["css!DS/CompareWidget/CompareWidget.css"],function(){"use strict";var e=10,t=6,i=1,r="butt",a="1px solid rgb( 128, 128, 128)",n="3px solid rgb(   0,   0,   0)",o=!1;function s(e,t){this.objKey=e,this.compareStatus=t}var l=null,c="NONE",d=[],u=30,p=10,h=5,f=100,m=0,g=0,v=0,y=0;function b(e){if(null==l)return!1;var t=jQuery("#structure-treetable-left")[0].tBodies[0].rows.length;return e>=0&&e<t}function C(e){if(null!=l&&null!=e)for(var t=0;t<l.length;t++)if(l[t].objKey==e)return t;return-1}function w(){var e=-1;try{var t=jQuery("#structure-treetable-right");if(null!=t&&null!=t){var i=t.fancytree("getTree").getActiveNode();null!=i&&(e=C(i.key))}}catch(e){}return e}function S(e){var t=jQuery("#structure-treetable-right")[0].tBodies[0].rows;if(e){l=[],d=[];for(var i=0;i<t.length;i++){var r=t[i],a=new s(r.ftnode.key,r.ftnode.data.compareStatus);a.fancyTreeNode=r.ftnode,d.push(a),!0===r.ftnode.displayState&&l.push(a)}}else l=d.filter(function(e){return!0===e.fancyTreeNode.displayState})}function D(){!function(){if(null!=l){w();var e=l.length,t=jQuery("#structure-treetable-left")[0].clientHeight,i=(jQuery("#compare-trees").scrollTop(),jQuery("div#compare-tree")[0].clientHeight),r=jQuery("#compare-structure-tree").scrollTop();g=(m=e*(r/t))+i/u-1}}(),function(e,i){if(null!=l&&Math.floor(i-e+.5)<l.length){var r=t-4,a=Math.floor(.5*h+h*e),n=f+8,o=Math.floor(h*(i-e+1));jQuery("div#obox").css("top",a).css("left",r).css("width",n).css("height",o),jQuery("div#obox").css("visibility","visible")}else jQuery("div#obox").css("visibility","hidden")}(m,g)}function _(e,t){t?e.removeClass("wux-ui-state-disabled"):e.addClass("wux-ui-state-disabled")}function T(e){var t=Math.floor(e);t<0?t=0:t>=l.length&&(t=l.length-1);var i=t*u;jQuery("#compare-structure-tree").scrollTop(i)}function E(e,t,i,r,a){!function(e,t,i,r,a){for(var n=r-i,o=t.length,s=n/o,l=0;l<o;l++){var c=i+l*s,d=c+s,u=t[l].color;A(e,u,c,d,a)}}(e,t.differences,i,r,a.y),a.y+=h}function A(e,t,i,r,a){e.strokeStyle=t,e.beginPath(),e.moveTo(i,a),e.lineTo(r,a),e.stroke()}function I(a,n,o){if("NONE"==a)jQuery("div#currbox").css("visibility","hidden"),c="NONE";else{var s=document.getElementById("canvas-buffer");if(null==s)return;var d=[],u="undefined"==typeof event;if(1==n||!u&&null!=event.ctrlKey&&event.ctrlKey){var v=document.getElementById("compare-tree-base");if(null!==v){var y=v.getElementsByClassName("fancytree-active");if(null!==y)if(y.length>0)for(var C=0;C<l.length;C++)for(var w=0;w<y.length;w++)l[C].objKey===y[w].ftnode.key&&d.push(C);else d.push(a)}}else d.push(a);for(var S=s.querySelectorAll('[class = "currBoxStyle"]'),D=S.length,_=0;_<D;_++){var A=S[_];"visible"==A.getStyle("visibility")&&A.setStyle("visibility","")}var I=a;for(w=0;w<d.length;w++){a=d[w];var x=Math.floor(a);if(b(x)){try{var O=jQuery("#structure-treetable-right").fancytree("getTree");I==a&&O.activateKey(l[x].objKey)}catch(e){console.log("Failure in update of tree... continuing...")}0!=o&&(x<m?T(x):x>g-1&&T(x-p+2));var N=t-2,P=Math.floor(e+h*(x+.5)-4),R=f+4;if(null===s.getElement("#currbox"+a)){var L=UWA.createElement("div");L.id="currbox"+a,L.className="currBoxStyle",L.inject(jQuery("#canvas-buffer")[0])}jQuery("div#currbox"+a).css("top",P).css("left",N).css("width",R).css("height",8),jQuery("div#currbox"+a).css("visibility","visible")}c=x}}!function(){if(null==l)console.log("===>> CompareOverview: DrawLines request prior to having a keylist");else{var a=l.length,n=t,o=n+f,s=Math.floor(e+.5*h),c=document.getElementById("OverviewCanvas");if(null==c)return;var d=c.getContext("2d");d.clearRect(0,0,c.width,c.height),d.lineWidth=i,d.lineCap=r;for(var u={y:s},p=0;p<a;p++)E(d,l[p].compareStatus,n,o,u)}}()}function x(i,r,a,n){1==i&&function(){var i=jQuery("div#compare-tree")[0].clientHeight,r=jQuery(".fancytree-folder").not(".fancytree-focused")[0];if(null==(u=null!=r?r.offsetHeight:null)||0==u){var a=jQuery(".fancytree-exp-nl")[0];null!=a&&(u=a.offsetHeight)}null!=u&&0!=u||(u=39),p=Math.floor(i/u);var n=jQuery("div#compare-tree")[0].clientHeight,o=(jQuery("div#compare-overview"),jQuery("#OverviewCanvas")[0]);null!=o&&(o.width=50,o.height=n-5,f=o.width-2*t,null==l||null==l||(Math.floor(l.length-p),h=(n-2*e)/l.length))}(),I(r,a,n),function(e){if(null!=l){var t,i=!1,r=!1;if(t=0!=e,"NONE"!=e){for(var a=e-1;a>=0;a--)if(0!=l[a].compareStatus.differences.length){i=!0;break}for(var n=e+1;n<l.length;n++)if(0!=l[n].compareStatus.differences.length){r=!0;break}}var s=jQuery('*[data-name="OverviewUp"]'),c=jQuery('*[data-name="OverviewDown"]'),d=jQuery('*[data-name="OverviewHome"]');o?(_(s,!1),_(c,!1),_(d,!1)):("undefined"==typeof event||!event.ctrlKey||event.isListView?(_(s,i),_(c,r)):(_(s,!1),_(c,!1)),_(d,t))}}(r),D()}function O(e){var t=e;S(!0),"NONE"!=e&&"string"==typeof e&&(t=C(e)),x(!0,t),jQuery("div#obox").css({border:a})}function N(e){for(var t=w(),i=t+e,r=t;i<l.length&&i>=0;){if(0!=l[i].compareStatus.differences.length){r=i;break}i+=e}r!=t&&x(!1,r)}var P=function(i,r){this.targetElement=i,this.rootElement=UWA.createElement("div",{id:"compare-overview-toplevel",html:[{tag:"div",id:"compare-overview",html:[{tag:"div",id:"canvas-buffer",html:[{tag:"canvas",id:"OverviewCanvas"},{tag:"div",id:"obox"},{tag:"div",id:"currbox"}]}]}]}),this.rootElement.inject(this.targetElement);this.isListView=r,jQuery(document).ready(function(){var e=null,t=!1,i=300;function r(){new Date-e<i?setTimeout(r,i):(t=!1,"none"!==jQuery("#overview-container").css("display")&&x(!0,c))}jQuery(window).resize(function(){e=new Date,!1===t&&(t=!0,setTimeout(r,i))})});var o=function(){console.log("DRAGDONE"),jQuery("div#compare-content").off("mousemove",s),jQuery("div#compare-content").off("mouseup",p),jQuery("div#obox").css({border:a})};function s(e){if(1==e.buttons){var t=e.pageY,i=y+(t-v)/h;i<0&&(i=0),i>l.length&&(i=l.length),jQuery("#compare-structure-tree").scrollTop(i*u),e.stopImmediatePropagation()}else o()}var d=!1;function p(e){d=!0,e.stopImmediatePropagation(),o()}jQuery("div#obox").mousedown(function(e){1==e.buttons&&(v=e.pageY,y=m,jQuery("div#compare-content").on("mousemove",s),jQuery("div#compare-content").on("mouseup",p),jQuery("div#obox").css({border:n}),e.stopImmediatePropagation())});var g={isListView:this.isListView};jQuery("#compare-structure-tree").on("click",g,function(e){var t=!1;return"fancytree-expander"==e.target.className&&(S(),t=!0),null!==e.data&&null!==e.data.isListView&&void 0!==e.data.isListView&&null!==e.originalEvent&&void 0!==e.originalEvent&&(e.originalEvent.isListView=e.data.isListView),x(t,w()),!0}),jQuery("#compare-legend").click(function(e,t){S(),x(!0,w());var i=jQuery("#structure-treetable-left").height(),r=jQuery("#structure-treetable-right").height();r<i&&(r=i);var a=jQuery("#compare-tree-column-separator");return a.height()!==r&&a.height(r),!0}),jQuery("#compare-structure-tree").keydown(function(e,t){return(w()!=c||"187"==e.which||"189"==e.which||"107"==e.which||"109"==e.which||"37"==e.which||"39"==e.which)&&(S(),x(!1,w()),!0)}),jQuery("div#overview-container").click(function(i){if(d)d=!1;else{var r=i.pageX,a=i.pageY;if(r>t&&r<t+f){var n=Math.floor(jQuery("div#compare-legend").innerHeight()+e+.5*h),o=Math.floor((a-n)/h)*u;jQuery("#compare-structure-tree").scrollTop(o)}}})};return P.prototype.init=function(e,t){o=1==t,O(e)},P.prototype.refresh=function(e){this.rootElement&&(this.rootElement.destroy(),this.rootElement=null,d=[])},P.prototype.scrollTree=function(e,t){l.length;D()},P.prototype.goHome=function(){O(0)},P.prototype.goUp=function(){N(-1)},P.prototype.goDown=function(){N(1)},P.prototype.sync=function(e,t,i){t&&(S(),e=!0),x(e,w(),t,i)},P.prototype.forODT_getKeyListSize=function(){return l.length},P}),define("DS/CompareWidget/CompareStatusDiffs",["UWA/Class","i18n!DS/CompareWidget/assets/nls/CompareStructure"],function(e,t){return e.singleton({init:function(){this._parent({})},ignore:{id:"ign",label:"",color:"#FFF",description:"ignored status will not been shown in legend"},nodeAttrDiff:{id:"nodeAttrDiff",label:t.DIFF_NODE_ATTRS,color:"#acccca",description:"different values of configured object attributes"},instAttrDiff:{id:"instAttrDiff",label:t.DIFF_INST_ATTRS,color:"#faabaf",description:"different values of configured instance attributes"},same:{id:"same",label:t.SM,color:"#FFFAFA",description:""},simi:{id:"simi",label:t.SIMILAR,color:"#ADADAD",description:""},lo:{id:"lo",label:t.LO,color:"#EA4F37",description:""},ro:{id:"ro",label:t.RO,color:"#57B847",description:""},rev:{id:"rev",label:t.REV,color:"#9B2C98",description:""},mov:{id:"mov",label:t.MOVED,color:"#FFCC00",description:""},qty:{id:"qty",label:t.QTY,color:"#1494DE",description:""},diff:{id:"diff",label:t.DIFF,color:"#D2B48C",description:""},repl:{id:"repl",label:t.REPL,color:"#F564A3",description:""}})}),define("DS/CompareWidget/AttributeTable",["UWA/Controls/Abstract","DS/Controls/Toggle","DS/Controls/TabBar","DS/UIKIT/Mask","DS/CompareCommon/Utils","i18n!DS/CompareWidget/assets/nls/CompareWidget"],function(e,t,i,r,a,n){return e.extend({init:function(e,t){this._parent({}),this.container=e,this.compareTable=t,this.buildSkeleton(),this.thumbnailElementsCreated=!1,this.bHorizontal=!1},showErrorInfo:function(e){this.errorInfoPanel.style.display="",this.errorInfo.innerHTML=e},hideErrorInfo:function(){this.errorInfoPanel.style.display="none"},setHorizontalLayout:function(e){this.bHorizontal=e},showThumbnails:function(){this.leftThumnailElem.show();for(var e=0;e<this.rightThumnailElems.length;++e)this.rightThumnailElems[e].show()},hideThumbnails:function(){this.leftThumnailElem.hide();for(var e=0;e<this.rightThumnailElems.length;++e)this.rightThumnailElems[e].hide()},updateLeftThumbnail:function(e){this.updateThumbnail(this.leftThumnailElem,e)},updateRightThumbnail:function(e,t){this.updateThumbnail(this.rightThumnailElems[e],t)},updateThumbnail:function(e,t){e.setHTML('<img src="'+t+'" width="144px" height="108px" />'),""==t&&e.setHTML("")},update:function(e){this.clearAttributeElements();for(var t=e.length,i=!1,a=!1,n=0;n<t&&!i&&!a;n++){null!==(l=e[n])&&(null!==l.valueLeft&&(i=!0),null!==l.valuesRight&&l.valuesRight.length>0&&(a=!0))}var o=document.getElementById("show-diff-only");null!=o&&i&&a?o.show():o.hide();var s=2;for(n=0;n<t;n++){null!=(l=e[n])&&Array.isArray(l.valuesRight)&&l.valuesRight.length+1>s&&(s=l.valuesRight.length+1)}this.bHorizontal=this.bHorizontal||s>2,this.addThumbnailElements(s);for(n=0;n<t;n++){var l=e[n];this.addAttributeElement(l,s).toShow=l.visible}this.updateVisibilities(),r.unmask(this.container)},hideAllAttributesBut:function(e){this.visibleAttrElements=[];for(var t=this.attrListElem.children,i=0;i<t.length;i++){var r=t[i];r.toShow=!1,-1!=e.indexOf(r.attrName)&&(r.toShow=!0)}this.updateVisibilities()},hideAttributes:function(e){this.visibleAttrElements=[];for(var t=this.attrListElem.children,i=0;i<t.length;i++){var r=t[i];r.toShow=!1,-1==e.indexOf(r.attrName)&&(r.toShow=!0)}this.updateVisibilities()},showAllAttributes:function(){this.visibleAttrElements=[];for(var e=this.attrListElem.children,t=0;t<e.length;t++){e[t].toShow=!0}this.updateVisibilities()},updateVisibilities:function(){for(var e=this.showDiffOnlyToggle.checkFlag,t=this.attrListElem.children,i=0;i<t.length;i++){var r=t[i];r.toShow?e&&r.same?r.hide():r.show():r.hide()}},buildSkeleton:function(){var e=this;this.elements.container=this.container,this.container.setStyles({"padding-left":"8px",position:"relative"});var a=n.get("attributes"),o=UWA.createElement("div",{html:"<b>"+a+"</b>"});"CompareWidgetSimuliaWebInWin"!=widget.appId&&o.inject(this.container),this.errorInfoPanel=UWA.createElement("div",{styles:{display:"none","z-index":"1",background:"white",position:"absolute",width:"100%",height:"100%"},html:"<p>"}).inject(this.container),this.errorInfo=UWA.createElement("div").inject(this.errorInfoPanel);var s=n.get("attrShowDiffOnly");this.showDiffOnlyToggle=new t({label:s,checkFlag:!1}),this.showDiffOnlyToggle.elements.container.id="show-diff-only",this.showDiffOnlyToggle.inject(this.container),this.showDiffOnlyToggle.addEventListener("buttonclick",this.showDiffOnlyClicked.bind(this)),r.mask(this.container),this.scrollContent=UWA.createElement("div"),this.scrollContent.id="attributes-container",this.scrollContent.inject(this.container),this.attrThumbnailsElem=UWA.createElement("div"),this.attrThumbnailsElem.className="attribute-table-thumbnails",this.attrThumbnailsElem.inject(this.scrollContent),this.tabBar=new i({displayStyle:"strip"}),this.tabBar.add({label:n.attributes,icon:{iconName:"attributes",fontIconFamily:WUXManagedFontIcons.Font3DS},isSelected:!0}),this.tabBar.add({label:n._INST,icon:{iconName:"attributes",fontIconFamily:WUXManagedFontIcons.Font3DS}}),this.tabBar.add({label:n._EFF,icon:{iconName:"survey",fontIconFamily:WUXManagedFontIcons.Font3DS}}),this.tabBar.inject(this.scrollContent),this.tabBar.elements.container.setStyles({"margin-top":"10px"}),this.attrListElem=UWA.createElement("div"),this.attrListElem.className="attribute-table-attribute-list",this.attrListElem.inject(this.scrollContent),this.tabBar.addEventListener("tabButtonClick",function(t){e.compareTable.updateTableFromCache(t.options.value,!0,!0)})},displayComparisonTabs:function(e){if(Array.isArray(e)&&e.length>1){this.tabBar.show();for(var t=this.tabBar.buttonGroup._getButtonList(),i=0;i<3;i++){var r=-1!==e.indexOf(i);this.tabBar.togglesTab[i].visibleFlag=r,t[i][r?"show":"hide"](),this.tabBar.togglesTab[i].checkFlag=r&&this.currentFacet===i}}else this.tabBar.hide()},showDiffOnlyClicked:function(e){this.updateVisibilities()},clearAttributeElements:function(){for(;this.attrThumbnailsElem.firstChild;)this.attrThumbnailsElem.removeChild(this.attrThumbnailsElem.firstChild);for(;this.attrListElem.firstChild;)this.attrListElem.removeChild(this.attrListElem.firstChild)},addThumbnailElements:function(e){this.bHorizontal?this.attrThumbnailsElem.setStyle("display","flex"):this.attrThumbnailsElem.setStyle("display","inline");var t=(100/(e+1)).toString()+"%";if(this.bHorizontal){this.titleThumnailElem=UWA.createElement("div"),this.titleThumnailElem.inject(this.attrThumbnailsElem),this.titleThumnailElem.setStyle("width",t),this.leftThumnailElem=UWA.createElement("div"),this.leftThumnailElem.inject(this.attrThumbnailsElem),this.leftThumnailElem.setStyle("width",t),this.rightThumnailElems=[];for(var i=0;i<e-1;++i)this.rightThumnailElems[i]=UWA.createElement("div"),this.rightThumnailElems[i].inject(this.attrThumbnailsElem),this.rightThumnailElems[i].setStyle("width",t)}else{this.leftThumnailElem=UWA.createElement("div"),this.leftThumnailElem.className="attribute-table-left-thumbnail",this.leftThumnailElem.inject(this.attrThumbnailsElem),this.rightThumnailElems=[];for(i=0;i<e-1;++i)this.rightThumnailElems[i]=UWA.createElement("div"),this.rightThumnailElems[i].className="attribute-table-right-thumbnail",this.rightThumnailElems[i].inject(this.attrThumbnailsElem)}},addAttributeElement:function(e,t){var i=(100/(t+1)).toString()+"%",r=UWA.createElement("div");r.className="attribute-table-attribute",this.bHorizontal?r.className+=" attribute-table-attribute-horz":r.setStyle("margin-top","4px"),r.attrName=e.name,a.isTitleAttr(e)?r.inject(this.attrListElem,"top"):r.inject(this.attrListElem),e.visible||r.hide();var n=UWA.createElement("div",{html:"<b>"+e.displayName+"</b>"});if(n.inject(r),this.bHorizontal&&(n.setStyle("width",i),n.setStyle("backgroundColor","#f4f5f6"),n.setStyle("padding","4px")),e.valueLeft!=e.valuesRight[0]||this.bHorizontal){r.same=!0;var o=e.valueLeft;null==o&&(o="");var s=UWA.createElement("div",{html:o});if(this.bHorizontal||(s.className="attribute-table-attribute-value-left"),s.inject(r),this.bHorizontal&&(s.setStyle("width",i),s.setStyle("padding","4px")),1===t)r.same=!1;else for(var l=0;l<t-1;++l){var c=e.valuesRight[l];null==c&&(c="");var d=UWA.createElement("div",{html:c});this.bHorizontal||(d.className="attribute-table-attribute-value-right"),d.inject(r),this.bHorizontal&&(d.setStyle("width",i),d.setStyle("padding","4px")),o!=c&&(r.same=!1,this.bHorizontal?d.setStyle("color","#ff0000"):d.setStyle("color","#009ddb"))}}else{var u=e.valueLeft;null==u&&(u=""),UWA.createElement("div",{html:u}).inject(r),r.same=!0}return r},getActiveTab:function(){return this.tabBar.visibleFlag?(this.currentFacet=this.tabBar.value[0],this.currentFacet):0}})}),define("DS/CompareWidget/FilterAttributesWidget",["css!DS/CompareWidget/CompareWidget.css","UWA/Controls/Abstract","DS/UIKIT/Input/Button","DS/Controls/Toggle","DS/CompareCommon/Utils","i18n!DS/CompareWidget/assets/nls/CompareWidget"],function(e,t,i,r,a,n){return t.extend({init:function(e,t,i,r){this.callback=null,this.context=null,this.attributesList="",this.attributeDisplayOption=void 0,this.defaultShowAttributes=void 0,this.dontShowAttributes=void 0,this.displayAllCheckbox=null,this.attributeCheckboxes=[],this.resetButton=null,this.saveButton=null,this.cancelButton=null,this.modal=null,this._parent(r),this.tableCompare=r.tableCompare,this.elements.container=UWA.createElement("div"),this.elements.container.className="filter-attributes-container",e.appendChild(this.elements.container),this.elements.footer=t,this.attributesList=i,null!=r&&(void 0!==r.callback&&null!==r.callback&&(this.callback=r.callback),void 0!==r.context&&null!=r.context&&(this.context=r.context),this.attributeDisplayOption=r.tableCompare.getAttributeDisplayOption(),this.defaultShowAttributes=r.tableCompare.getDefaultShowAttributes(),this.dontShowAttributes=r.tableCompare.getDontShowAttributes(),this.setAttributeDisplayOptions=r.tableCompare.setAttributeDisplayOptions,this.showAllAttributesAsDefault=r.tableCompare.showAllAttributesAsDefault),this.initUI()},initUI:function(){var e=this,t=UWA.createElement("div");t.className="attribute-list-container",this.elements.container.appendChild(t);var o=UWA.createElement("div");o.className="attribute-displayoptions",this.displayAllCheckbox=new r({label:n.displayAll,value:"__showall__",visibleFlag:!0}),this.displayAllCheckbox.inject(o),this.displayAllCheckbox.addEventListener("buttonclick",function(t){e.saveButton&&e.saveButton.setDisabled(!1);for(var i=0;i<e.attributeCheckboxes.length;++i)e.attributeCheckboxes[i].disabled||(e.attributeCheckboxes[i].checkFlag=e.displayAllCheckbox.checkFlag);e.attributeDisplayOption=e.displayAllCheckbox.checkFlag?"__showall__":"selected"}),t.appendChild(o);var s=!0;a._PROP_COMP_FACETS.forEach(i=>{!function(i){var o=e.attributesList[i];if(o.length){var l=UWA.createElement("label",{class:"wux-label",tabindex:-1,html:"<br>"+(i?n[i]:n.attributes)});l.inject(t);for(var c=0;c<o.length;++c){var d=a.isTitleAttr(o[c]),u=UWA.createElement("div");u.className="attribute-onestring";var p=e.tableCompare.isAttributeShownInTable(o[c].name,i);p||(s=!1);var h=new r({label:o[c].displayName,value:o[c].name,checkFlag:!!d||p,disabled:d,visibleFlag:!0});h.attrType=i,e.attributeCheckboxes.push(h),e.attributeCheckboxes[e.attributeCheckboxes.length-1].inject(u),e.attributeCheckboxes[e.attributeCheckboxes.length-1].addEventListener("buttonclick",function(t){e.saveButton&&e.saveButton.setDisabled(!1),e.attributeDisplayOption="selected";for(var i=!0,r=0;r<e.attributeCheckboxes.length;++r)e.attributeCheckboxes[r].checkFlag||(i=!1);e.displayAllCheckbox.checkFlag=i}),d?t.insertBefore(u,l.nextSibling):t.appendChild(u)}}}(i)}),this.displayAllCheckbox.checkFlag=s;var l=UWA.createElement("div");l.className="filterattributes-OkCancel",this.resetButton=new i({value:n.reset,className:"default attrlist-reset",visibleFlag:!0}),this.saveButton=new i({value:n.save,className:"primary",visibleFlag:!0,disabled:!0}),this.cancelButton=new i({value:n.cancel,className:"default",visibleFlag:!0}),this.resetButton.inject(l),this.saveButton.inject(l),this.cancelButton.inject(l),this.elements.footer.appendChild(l),this.resetButton.addEvent("onClick",function(){e.saveButton&&e.saveButton.setDisabled(!1),a._PROP_COMP_FACETS.forEach(t=>{!function(t){var i=e.attributesList[t],r=e.defaultShowAttributes[t],a=e.attributeCheckboxes.filter(e=>e.attrType===t);if(i.length)for(var n=0;n<i.length;++n)a[n].checkFlag=e.showAllAttributesAsDefault||Array.isArray(r)&&r.length&&r.indexOf(i[n].name)>=0||"__showall__"===r}(t)}),e.displayAllCheckbox.checkFlag=e.showAllAttributesAsDefault,e.attributeDisplayOption="default"}),this.saveButton.addEvent("onClick",function(){e.setAttributeDisplayOptions(e.attributeDisplayOption,a.compPropFacetsReduceFn(function(t){var i=e.attributesList[t],r="";if("selected"===e.attributeDisplayOption)for(var a=e.attributeCheckboxes.filter(e=>e.attrType===t),n=0;n<i.length;++n)!1===a[n].checkFlag&&(""!==r&&(r+="|"),r+=i[n].name);return r})),e.saveButton.disabled=!0,e.saveButton.setDisabled(!0),e.cancelButton.setDisabled(!0),e.resetButton.setDisabled(!0),e.tableCompare.updateTableRowVisibility();e.dispatchEvent("onClose",{})}),e.cancelButton.addEvent("onClick",function(){e.dispatchEvent("onClose",{})});this.dispatchEvent("onReady",{})}})}),define("DS/CompareWidget/CompareStatus",["UWA/Class","DS/CompareWidget/CompareStatusDiffs","i18n!DS/CompareWidget/assets/nls/CompareStructure"],function(e,t,i){return e.extend({init:function(e){this._parent({}),this.matched=!1,this.differences=[],null!=e&&(null!=e.differences&&(this.differences=e.differences),null!=e.matched&&(this.matched=e.matched))},toShow:function(e){var i=!1;if(0==this.differences.length)i=-1!=e.indexOf(t.same.id);else for(var r=0;r<this.differences.length;r++){var a=this.differences[r];if(-1!=e.indexOf(a.id)){i=!0;break}}return i}})}),define("DS/CompareWidget/BOMTitleCompareStructEnginePlugin",["UWA/Class","DS/CompareCommon/Utils","DS/CompareWidget/CompareStatus","DS/CompareWidget/CompareStatusDiffs"],function(e,t,i,r){return e.extend({init:function(e){this._parent({}),this.defaultPlugin=e},getTypes:function(e){for(var t={},i=0;i<e.length;i++)for(var r=e[i],a=0;a<r.length;a++){t[r[a].type]=!0}return Object.keys(t)},prioritize:function(e,t){return this.defaultPlugin.prioritize(e,t)},compareMatchingAttributes:function(e,t,i,r){var a=t[r],n=i[r],o=Object.keys(a),s=Object.keys(n),l=o.length;if(l!=s.length)return!1;for(var c=0;c<l;c++){var d=o[c];if(a[d]!=n[d])return!1}return!0},compare:function(e,t,a,n){var o=new i;if(!e&&t.level!=a.level)return o;if(t.isRoot&&a.isRoot)return o.matched=!0,o.differences.push(r.ignore),o;if(t.title==a.title){if(o.matched=!0,t.revision==a.revision){var s=this.compareMatchingAttributes(e,t,a,"node_matching_attributes"),l=this.compareMatchingAttributes(e,t,a,"inst_matching_attributes");s&&l?!0:(s||o.differences.push(r.nodeAttrDiff),l||o.differences.push(r.instAttrDiff))}else o.differences.push(r.rev);e&&t.Qty!=a.Qty&&o.differences.push(r.qty)}return o}})}),define("DS/CompareWidget/CompareTable",["DS/ENO6WPlugins/jQuery","DS/WidgetServices/WidgetServices","DS/LifecycleServices/LifecycleServicesSettings","DS/WAFData/WAFData","DS/CompareWidget/AttributeTable","DS/CompareCommon/CompareImgSrc","DS/CompareCommon/CompareMetaData","DS/CompareCommon/Utils","i18n!DS/CompareWidget/assets/nls/CompareWidget"],function(e,t,i,r,a,n,o,s,l){"use strict";var c="",d=[],u="",p=[],h=void 0,f=void 0,m="",g=[];function v(){return null!=o.typeInfo["3dportfolio"]}function y(e){var i=t.formatDate(e,!0);if(0==i.localeCompare(e)){var r=new Date(e);i=t.formatDate(r,!0)}return i}function b(e,t){var i="";if(null!=e&&null!=e.value){if(e.value.constructor==Array)if(!0===e.multivalue)for(var r=0;r<e.value.length;++r){i+=t?y(e.value[r]):e.value[r],r!==e.value.length-1&&(i+=", ")}else i=t?y(e.value[0]):e.value[0];else i=t?y(e.value):e.value;var a=e.dimension;null!=a&&(i+=" "+a)}return i}var C=function(e,t,r){this.attrTable=new a(e,this),this._attributeCompareData=void 0,h=this._attributeData=s.compPropFacetsReduceFn(()=>({})),f=this._attributeKeyDefs=s.compPropFacetsReduceFn(()=>[]),this.proxyType=t,this.securityContext=r,this.savedThumbnailData=[],i.app_initialization(function(){}),jQuery("#compare-content").on("newRowSelectedEvent",this.updateTable.bind(this)),this.setAttributeDisplayPreferencesToWidget()};function w(e){return null!=e&&null==e.type}return C.prototype.reInit=function(e){this.attrTable=new a(e,this)},C.prototype.setGenericCompare=function(e){this.bHorizontal=e,this.attrTable.setHorizontalLayout(e)},C.prototype.updateTable=function(e,t){if(this._attributeCompareData=s.compPropFacetsReduceFn(()=>void 0),w(t.left.data.compareData)||w(t.right[0].data.compareData)){var r=l.extRelCatSelected;this.attrTable.showErrorInfo(r)}else{this.attrTable.hideErrorInfo();var a=this,n=!1,o=widget.getValue("x3dPlatformId");if(null!=t){if(void 0!==t.right&&t.right.length>=2){if(!(t.rightTree.length>=2))return;n=!0}}else if(void 0!==this.data&&null!==this.data&&void 0!==this.data.right&&this.data.right.length>=2){if(!(this.data.rightTree.length>=2))return;n=!0}if(null!=(t=null==t?this.data:t)){if(c="",u="",m="",d=[],p=[],g=[],void 0!==t.left&&null!==t.left&&null!==t.left.data&&null!==t.left.data.compareData&&null!==t.left.data.compareData.publicAttr&&(c=t.left.data.compareData.physicalid,u=t.left.data.compareData.serviceId,!n&&t.left.data.compareData.parentOccNdx>=0&&(m=t.left.data.compareData["physicalid[connection]"])),void 0!==t.right&&null!==t.right)for(var h=0;h<t.right.length;++h)void 0!==t.right[h]&&null!==t.right[h]&&null!==t.right[h].data&&null!==t.right[h].data.compareData&&null!==t.right[h].data.compareData.publicAttr&&(d.push(t.right[h].data.compareData.physicalid),p.push(t.right[h].data.compareData.serviceId),!n&&t.right[h].data.compareData.parentOccNdx>=0&&g.push(t.right[h].data.compareData["physicalid[connection]"]));if(""===c){var f=!0;for(h=0;h<d.length;++h)""!==d[h]&&(f=!1);if(f)return}!n&&m||g.length?s.getPropertiesTabsToDisplayPromise([m].concat(g),{tenant:o,securityContext:a.securityContext,url3DSpace:i.get3DSpaceBaseUrl(o)}).then(function(e){a.attrTable.displayComparisonTabs(e),a._facetsToCompute=e,v.bind(a)()},function(){a.attrTable.displayComparisonTabs(),a._facetsToCompute=[0],v.bind(a)()}):(this.attrTable.displayComparisonTabs(),a._facetsToCompute=[0],v.bind(a)())}}function v(){var e=[c].concat(d).some(e=>e&&!a.findIdInCache(e)),t=[m].concat(g).some(e=>e&&!a.findIdInCache(e));if(e||t){var i=[],r=[],o=[];""!==c&&(i.push(c),o.push(u)),""!==m&&r.push(m);for(var l=0;l<d.length;++l)""!==d[l]&&(i.push(d[l]),o.push(p[l]));for(l=0;l<g.length;++l)""!==g[l]&&(r.push(g[l]),o.push(p[l]));var h=[],f=[],v=[];e&&(h=i,f=o),t&&(v=r),s.loadAttrs(h,f,v,this._facetsToCompute,function(e){a.updateAttrCacheFromAttrData(e);for(var t=a._facetsToCompute.length,i=0;i<t;i++){var r=a._facetsToCompute[i];a.updateTableFromCache(r,a.attrTable.getActiveTab()===r),0==r&&a.loadThumbnailsIntoTable(n)}})}else a.updateTableFromCache(this.attrTable.getActiveTab(),!0),a.loadThumbnailsIntoTable()}},C.prototype.loadThumbnailsIntoTable=function(){var e=this;if(this.isAttributeShownInTable("thumbnailimage",s._PROP_COMP_FACETS[0])){e.attrTable.showThumbnails();var t="undefined"!=typeof widget&&widget?widget.getValue("x3dPlatformId"):null;null!=t&&""!=t||(t="OnPremise");var a=i.get3DSpaceBaseUrl(t),o=a+n.thumbnailUrlPath;[c].concat(d).forEach(function(i,n){if(i&&i.length){var s=e.savedThumbnailData[i];void 0!==s?0===n?e.attrTable.updateLeftThumbnail(s):e.attrTable.updateRightThumbnail(n-1,s):function(i,n){try{var s=o+i+"/?tenant="+t+"&root3DSpaceUrl="+a;r.authenticatedRequest(s,{proxy:e.proxyType,onComplete:function(t){e.savedThumbnailData[i]=t,0===n?e.attrTable.updateLeftThumbnail(t):e.attrTable.updateRightThumbnail(n-1,t)},onFailure:function(t){0===n?e.attrTable.updateLeftThumbnail(""):e.attrTable.updateRightThumbnail(n-1,"")}})}catch(t){0===n?e.attrTable.updateLeftThumbnail(""):e.attrTable.updateRightThumbnail(n-1,"")}}(i,n)}else 0===n?e.attrTable.updateLeftThumbnail(""):e.attrTable.updateRightThumbnail(n-1,"")})}else e.attrTable.hideThumbnails()},C.prototype.getDefaultShowAttributes=function(){var e=["thumbnailimage","owner","current","modified","type","originated","revision"];return e=e.concat(s.getTitleAttrNames()),s.compPropFacetsReduceFn(t=>t?"__showall__":e)},C.prototype.getDontShowAttributes=function(){return s.compPropFacetsReduceFn(e=>{var t=widget.getValue("attributes_not_shown"+e),i=[];return t&&"all"!==t&&"__showall__"!==t&&(i=-1!==t.indexOf("|")?t.split("|"):[t]),i})},C.prototype.getAttributeDisplayOption=function(){var e=widget.getValue("attributes_display_option");if(null==e||""===e){var t=widget.getValue("attributes_not_shown");return"__showall__"===t?"__showall__":""===t?"default":"selected"}return e},C.prototype.isAttributeShownInTable=function(e,t){var i=this.getAttributeDisplayOption(),r=!0;if("none"===i)r=!0;else if("__showall__"===i)r=!1;else if("default"===i)if(v())r=!1;else{r=!0;var a=this.getDefaultShowAttributes()[t];if(Array.isArray(a)&&a.length){for(var n=0;n<a.length;++n)if(a[n]===e){r=!1;break}}else"__showall__"===a&&(r=!1)}else{r=!1;var o=this.getDontShowAttributes()[t];for(n=0;n<o.length;++n)o[n]===e&&(r=!0)}return!r},C.prototype.setAttributeDisplayOptions=function(e,t){widget.setValue("attributes_display_option",e);var i=[];"selected"===e&&(i=s._PROP_COMP_FACETS.map(function(e){return widget.setValue("attributes_not_shown"+e,t[e]),s.saveUserPreferencesPromise("compare_attributes_not_shown"+e,t[e])})),i.push(s.saveUserPreferencesPromise("compare_attributes_display_option",e)),Promise.allSettled(i).then(e=>{for(var t=0,i=e.length;t<i;t++)"rejected"===e[t].status&&console.warn(t<i-1?"COMPARE TABLE: failed setting compare_attributes_not_shown preference "+s._PROP_COMP_FACETS[t]:"COMPARE TABLE: failed setting compare_attributes_display_option preference")})},C.prototype.setAttributeDisplayPreferencesToWidget=function(){s.setPreferencesToWidget("compare_attributes_display_option","attributes_display_option",e=>{"selected"===e&&s._PROP_COMP_FACETS.forEach(e=>{s.setPreferencesToWidget("compare_attributes_not_shown"+e,"attributes_not_shown"+e)})})},C.prototype.findIdInCache=function(e,t){return t=t||0,null!=h[s._PROP_COMP_FACETS[t]][e]},C.prototype.updateTableRowVisibility=function(){if(null!=this.attrTable){var e=s._PROP_COMP_FACETS[this.attrTable.getActiveTab()],t=this.getAttributeDisplayOption();if("default"===t)if(v())this.attrTable.showAllAttributes();else{var i=this.getDefaultShowAttributes()[e];Array.isArray(i)?this.attrTable.hideAllAttributesBut(i):this.attrTable.showAllAttributes()}else if("selected"===t){var r=this.getDontShowAttributes()[e];this.attrTable.hideAttributes(r)}else this.attrTable.showAllAttributes()}},C.prototype.updateAttrCacheFromAttrData=function(e){function t(e,t){var i={};if(null!=e.basicData&&null!=e.basicData)for(var r=0;r<e.basicData.length;++r){i[a=e.basicData[r].nls||e.basicData[r].name]=e.basicData[r],-1===f[t].findIndex(e=>e.attrKey===a)&&f[t].push({attrNLS:i[a].nls||i[a].displayName,attrType:i[a].type,attrKey:a,attrName:e.basicData[r].selectable||e.basicData[r].name})}if(null!=e.data&&null!=e.data)for(r=0;r<e.data.length;++r){var a;i[a=e.data[r].nls||e.data[r].name]=e.data[r],-1===f[t].findIndex(e=>e.attrKey===a)&&f[t].push({attrNLS:i[a].nls||i[a].displayName,attrType:i[a].type,attrKey:a,attrName:e.data[r].selectable||e.data[r].name})}return i}for(var i,r=0;r<e.length;++r)if(e[r].metatype&&"bus"!==e[r].metatype?"connection"===e[r].metatype?i=1:"effectivity"===e[r].metatype&&(i=2):i=0,!this.findIdInCache(e[r].physicalID,i)){if(!i)if(e[r].hasOwnProperty("preview_url")&&e[r].preview_url)this.savedThumbnailData[e[r].physicalID]=e[r].preview_url;else if(void 0!==e[r].data&&null!==e[r].data){var a=e[r].data.findIndex(function(e){return"preview_url"===e.name});a>=0&&null!=(a=e[r].data.splice(a,1))[0].value&&(this.savedThumbnailData[e[r].physicalID]=a[0].value)}h[s._PROP_COMP_FACETS[i]][e[r].physicalID]=t(e[r],s._PROP_COMP_FACETS[i])}},C.prototype.updateAttrCacheFromAllIds=function(e,t,i,r){var a=this;try{var n=[],o=[],l=[];function c(e){var t=e.data.compareData.physicalid,i=e.data.compareData;a.findIdInCache(t)||-1!==n.indexOf(t)||(n.push(t),o.push(i.serviceId));var r=i["physicalid[connection]"];null==r||a.findIdInCache(r,1)||-1!==l.indexOf(r)||l.push(r)}function d(e){void 0===e.data.compareData||null===e.data.compareData||w(e.data.compareData)||c(e);var t=e.data.matchRow.fancyTreeNode;if(void 0===t.data.compareData||null===t.data.compareData||w(t.data.compareData)||c(t),Array.isArray(e.children)&&e.children.length)for(var i=0;i<e.children.length;++i)d(e.children[i])}for(var u=0,p=e.length;u<p;u++)d(e[u].fancyTreeNode);if(n.length>0||l.length>0){if(!a._loadingAllAttributes){a._loadingAllAttributes=!0;s.loadAttrs(n,o,l,[0,1],function(n){a.updateAttrCacheFromAttrData(n),a._loadingAllAttributes=!1,r(e,t,i)})}}else r(e,t,i)}catch(e){console.log("Error loading object attribute data from server")}},C.prototype.updateTableFromCache=function(e,t,i){var r=this;var a=0===e?c:m,n=0===e?d:g;this._attributeCompareData[s._PROP_COMP_FACETS[e]]=function(e,t,i){for(var a=r.getAttributeDisplayOption(),n="default"==a?r.getDefaultShowAttributes():"",o="selected"==a?r.getDontShowAttributes():"",l=[],c=[],d=s._PROP_COMP_FACETS[i],u=0,p=(l=f[d]).length;u<p;u++){var m=l[u].attrNLS,g=l[u].attrType,y=l[u].attrKey,C=l[u].attrName,w=!1,S=null,D=[];if(e&&null!=h[d][e]&&h[d][e].hasOwnProperty(y)&&(S=h[d][e][y],w=!0),Array.isArray(t)&&t.length)for(var _=0,T=t.length;_<T;_++)t[_]&&null!=h[d][t[_]]&&h[d][t[_]].hasOwnProperty(y)&&(D.push(h[d][t[_]][y]),w=!0);if(w&&""!=C){for(var E="timestamp"===g||"modified"===C||"originated"===C||-1!==C.indexOf("ds6w:created")||-1!==C.indexOf("ds6w:modified"),A=b(S,E),I=[],x=0;x<D.length;++x)if(S&&!0===S.multivalue&&D[x]&&!0===D[x].multivalue){var O=s.intersectionDifference(S.value,D[x].value,function(e,t){return e===t});I[x]=O[0].difference.length||O[1].difference.length?b(D[x],E):A}else I[x]=b(D[x],E);var N="hidden";if("default"===a)if(v())N="";else{N="hidden";var P=n[s._PROP_COMP_FACETS[i]];if(Array.isArray(P)&&P.length){for(_=0;_<P.length;++_)if(C===P[_]){N="";break}}else"__showall__"===P&&(N="")}else if("selected"===a){N="";var R=o[s._PROP_COMP_FACETS[i]];if(Array.isArray(R)&&R.length)for(_=0;_<R.length;++_)if(C===R[_]){N="hidden";break}}else"__showall__"!==a&&"all"!==a||(N="");var L=!0;"hidden"==N&&(L=!1),null==S&&(A=null),c.push({name:C,displayName:m,valueLeft:A,valuesRight:I,visible:L})}}return c}(a,n,e),t&&this.attrTable.update(this._attributeCompareData[s._PROP_COMP_FACETS[e]]),i&&this.loadThumbnailsIntoTable(),widget.dispatchEvent("ENOLCM/CompareWidget/attrTableUpdatedEvent_forODTs","attr table updated")},C.prototype.getAttributeListFromTable=function(e){var t=this._attributeCompareData[e]&&this._attributeCompareData[e].length?this._attributeCompareData[e]:[];return""===e?t.concat([{name:"thumbnailimage",displayName:l.thumbnailimage}]):t},C.prototype.swapAttributes=function(){var e=this;if(null!=this.data){s.forEach(t=>{var i=e._attributeCompareData[t];if(i)for(var r=0;r<i.length;++r){var a=i[r];if(null!==a){var n=a.valueLeft;a.valueLeft=a.valueRight,a.valueRight=n}}});var t=this.data.left;this.data.left=this.data.right[0],this.data.right[0]=t}},C.prototype.refresh=function(e){this.rootElement&&(this.rootElement.destroy(),this.rootElement=null),this._attributeData=s.compPropFacetsReduceFn(()=>({})),this._attributeKeyDefs=s.compPropFacetsReduceFn(()=>[]),this.data=[],this.savedThumbnailData=[]},C.prototype.getAttrValue=function(e){var t=void 0!==e.selectable?e.selectable:e.name;return b(e,"timestamp"===e.type||"modified"===t||"originated"===t||-1!==t.indexOf("ds6w:created")||-1!==t.indexOf("ds6w:modified"))},C.prototype.getAttributeData=function(){return this._attributeData},C.prototype.getAttributeKeyDefs=function(){return this._attributeKeyDefs},C}),define("DS/CompareWidget/SimuliaCompareStructEnginePlugin",["UWA/Class","DS/CompareWidget/CompareStatus","DS/CompareWidget/CompareStatusDiffs"],function(e,t,i){return e.extend({init:function(e){this._parent({}),this.defaultPlugin=e},prioritize:function(e,t){return this.defaultPlugin.prioritize(e,t)},compare:function(e,t,i,r){var a=this.defaultPlugin.compare(e,t,i,r);if(a.matched&&null!=widget.SimuliaCompareUtils)for(var n=widget.SimuliaCompareUtils.getCustomDifferences({left:t.pid,right:i.pid}),o=0;o<n.length;o++)a.differences.push(n[o]);return a}})}),define("DS/CompareWidget/DefaultCompareStructEnginePlugin",["UWA/Class","DS/CompareCommon/Utils","DS/CompareWidget/CompareStatus","DS/CompareWidget/CompareStatusDiffs","i18n!DS/CompareWidget/assets/nls/CompareStructure"],function(e,t,i,r,a){return e.extend({init:function(){this._parent({})},prioritize:function(e,t){return null!=e.priority&&null!=t.priority?e.priority>t.priority:!(!e.matched&&t.matched)&&(!e.matched||!t.matched||(e.matchType!=t.matchType?0==e.differences.length:e.differences.length<t.differences.length))},revisionSpecified:function(e,t){return"NOVAL_REV"!=e.revision.substring(0,9)||"NOVAL_REV"!=t.revision.substring(0,9)},xformSpecified:function(e,t){return"NOVAL_XFORM"!=e.xform.substring(0,11)||"NOVAL_XFORM"!=t.xform.substring(0,11)},compare:function(e,a,n,o){var s=new i;if(!e&&a.level!=n.level)return s.matched=!1,s;var l=!1,c=!1,d=!1;null!=o&&(void 0!==o.ignoreDup&&null!==o.ignoreDup&&(l=o.ignoreDup),void 0!==o.ignoreRev&&null!==o.ignoreRev&&(c=o.ignoreRev),void 0!==o.similarCanBeRevisioned&&null!==o.similarCanBeRevisioned&&(d=o.similarCanBeRevisioned));var u=!1;a.src_obj!=n.src_obj&&a.src_obj_root!=n.src_obj_root||(u=!0);var p=!1,h=u,f=!1;if((a.pid==n.pid||a.rlv_V5==n.rlv_V5||a.type==n.type&&a.name==n.name)&&(u=!1,p=!0,h=!1,this.revisionSpecified(a,n))){var m=a.revision,g=n.revision,v={},y={},b=t.isRevBranchRevPattern(m,v),C=t.isRevBranchRevPattern(g,y);(b||C)&&"branch"===t.compareRevBranchRev(v,y)&&(u=!0,p=!1,h=!0)}u&&l&&(u=!1,p=!0),u||p?s.matched=!0:void 0!==a.inst_logicalid&&null!==a.inst_logicalid&&""!==a.inst_logicalid&&a.inst_logicalid===n.inst_logicalid&&(f=!0,s.matched=!0);var w=!1,S=!1,D=!1;s.matched&&(f?s.differences.push(r.repl):c||a.revision==n.revision||this.revisionSpecified(a,n)&&(d||p&&!h)&&(s.differences.push(r.rev),S=!0),e||a.xform==n.xform||this.xformSpecified(a,n)&&(s.differences.push(r.mov),D=!0),e&&a.Qty!=n.Qty&&(s.differences.push(r.qty),w=!0),u&&s.differences.push(r.simi));var _=14;p?_=2:u?_=8:f&&(_=8);var T=0;return!w||S||D?w||!S||D?w||S||!D?!w&&S&&D?T=4:w&&S&&!D&&(T=5):T=3:T=2:T=1,s.priority=14-(_+T),s}})}),define("DS/CompareWidget/AttributesForStructureCompare",["UWA/Class","DS/LifecycleServices/LifecycleServicesSettings","DS/WAFData/WAFData","UWA/Promise","DS/CompareCommon/Utils","DS/LifecycleServices/AssemblyJson","DS/CompareWidget/BOMTitleCompareStructEnginePlugin"],function(e,t,i,r,a,n,o){var s=e.extend({init:function(e,t,i){this._parent({}),this.typeParentTypeMap=this.formatGetTypesHierachyResult(t),this.idAttrsMap=this.formatFetchResult(i)},formatGetTypesHierachyResult:function(e){for(var t={},i=e.types_hierarchies,r=i.length,a=0;a<r;a++){for(var n=i[a],o=n.type,s=n.hierarchy,l=0;l<s.length;l++)t[o]=s[l],o=s[l];t[o]=null}return t},addTo:function(e){for(var t=0;t<e.length;t++)this.addToAsm(e[t])},addToAsm:function(e){this.addToAsmNodes(e.nodes),this.addToAsmRels(e,e.occurrencerelationships)},addToAsmRels:function(e,t){for(var i=n.AssemblyHelper(e),r=0;r<t.length;r++)for(var a=t[r],o=i.getOccurence(a.child),s=parseInt(o.nodeid),l=i.getNode(s),c=this.getMatchingCriteriaAttrs(l.type).instance_attributes,d=0;d<c.length;d++){var u=this.idAttrsMap[a.physicalid];if(null!=u){var p={};a.matching_attributes=p;for(d=0;d<c.length;d++){var h=c[d];value=u[h],p[h]=value}}}},addToAsmNodes:function(e){for(var t=0;t<e.length;t++){var i=e[t],r={};i.matching_attributes=r,i.typeParentTypeMap=this.typeParentTypeMap;var a=this.idAttrsMap[i.physicalid];if(null!=a)for(var n=i.type,o=this.getMatchingCriteriaAttrs(n).reference_attributes,s=0;s<o.length;s++){var l=o[s];value=a[l],r[l]=value}}},getMatchingCriteriaAttrs:function(e){for(var t=widget.CompareWidgetUseTitleRevToMatchCriteria,i=t[e];null==i&&null!=(e=this.typeParentTypeMap[e]);)i=t[e];return null==i&&(i={reference_attributes:[],instance_attributes:[]}),i},formatFetchResult:function(e){var t=e.results;if(null==t)return{};for(var i={},r=0;r<t.length;r++){for(var a=t[r].attributes,n=null,o=[],s=0;s<a.length;s++){var l=a[s],c=l.name,d=l.value;"resourceid"==c?n=d:"attribute"==l.format&&(o[c]=d)}i[n]=o}return i}});function l(e){var t=function(e){for(var t=[],i=0;i<e.length;i++){var r=e[i].physicalid;null!=r&&t.push(r)}return t}(e.occurrencerelationships),i=function(e){for(var t=[],i=0;i<e.length;i++){var r=e[i];null!=r.type&&t.push(r.physicalid)}return t}(e.nodes);return t.concat(i)}function c(e){for(var t={},i=0;i<e.length;i++){var r=e[i].type;null!=r&&(t[r]=!0)}return Object.keys(t)}function d(){var e=function(){for(var e=widget.CompareWidgetUseTitleRevToMatchCriteria,t=Object.keys(e),i=[],r=[],n=0;n<t.length;n++){var o=e[t[n]];i.push(o.reference_attributes),r.push(o.instance_attributes)}return{reference_attributes:a.mergeArrays(i),instance_attributes:a.mergeArrays(r)}}();return a.mergeArrays([e.reference_attributes,e.instance_attributes])}function u(e,r,a,n){var o=widget.getValue("x3dPlatformId"),s=t.get3DSpaceWSUrl(o,e);i.authenticatedRequest(s,{method:"POST",type:"json",timeout:12e4,data:JSON.stringify(r),headers:{Accept:"application/json","Content-Type":"application/json"},onComplete:a,onFailure:n})}return s.get=function(e,t,i){var n=function(e){for(var t=[],i=0;i<e.length;i++){var r=c(e[i].nodes);t.push(r)}return a.mergeArrays(t)}(e),o=function(e){for(var t=[],i=0;i<e.length;i++){var r=l(e[i]);t.push(r)}return a.mergeArrays(t)}(e),p=d();UWA.Promise.all([function(e){return new r(function(t,i){u("/resources/enong/dico/gettypeshierarchy",{types:e},t,i)})}(n),function(e,t,i,a){return new r(function(i,r){u("/cvservlet/fetch/v2",{label:"CompareWidget_AttributesForStructureCompare_"+(new Date).getTime().toString(),physicalid:e,select_predicate:t},i,r)})}(o,p)]).then(function(e){var i=e[0],r=e[1],a=new s(n,i,r);t(a)},i)},s}),define("DS/CompareWidget/CompareStructEnginePlugins",["UWA/Class","DS/CompareWidget/SimuliaCompareStructEnginePlugin","DS/CompareWidget/BOMTitleCompareStructEnginePlugin","DS/CompareWidget/DefaultCompareStructEnginePlugin"],function(e,t,i,r){return e.extend({init:function(){this._parent({})},getRoot:function(e){for(var t=e[0],i=0;i<e.length;i++){var r=e[i];if(r.isRoot){t=r;break}}return t},getPlugin:function(e,a){var n=this.getRoot(e).type,o=this.getRoot(a).type,s=new r;if("CompareWidgetSimuliaWebInWin"==widget.appId&&"VPMReference"==n&&"VPMReference"==o)return new t(s);if(widget.CompareWidgetUseTitleRevToMatch){var l=this.getRoot(e).typeParentTypeMap||(t=>({e:this.getRoot(e).type}))(),c=this.getRoot(a).typeParentTypeMap||(e=>({e:this.getRoot(a).type}))();if(["VPMReference","CreateAssembly"].some(e=>e in l&&e in c))return new i(s)}return s}})}),define("DS/CompareWidget/CompareObjMgr",["DS/WAFData/WAFData","i18n!DS/CompareWidget/assets/nls/CompareStructure","DS/CompareCommon/CompareAlert","DS/LifecycleServices/AssemblyJson","DS/LifecycleServices/LifecycleServicesSettings","DS/LifecycleServices/LifecycleServices","DS/CompareCommon/CompareMetaData","DS/CompareCommon/Utils","UWA/Promise","DS/CompareWidget/Ecosystem","DS/CompareWidget/AttributesForStructureCompare","DS/CompareCommon/DBG_Stopwatch"],function(e,t,i,r,a,n,o,s,l,c,d,u){var p=36e5;function h(e,t){var i=e.occurrencerelationships[t].child;e.occurrencerelationships.splice(t),e.occurrences.splice(i);for(var r=0;r<e.occurrencerelationships.length;r++){var a=e.occurrencerelationships[r];a.parent>t&&oOccurRel.parent--,a.child>t&&oOccurRel.child--}}function f(e){for(var t=e,i=0;i<e.occurrencerelationships.length;){var r=e.occurrencerelationships[i];"CatAnalysis"==r.relationship&&r.parent!=e.rootoccurrence?h(e,i):i++}return t}function m(e,t,i,r){"snapshotID"==t?a.app_initialization(function(){require(["DS/ListSnapshots/WebServices"],function(t){t?t.getSnapshotAssembly(null,e,i,r):r("invalid prereq on DS/ListSnapshots/WebServices")})}):"modelID"==t?a.app_initialization(function(){n.expandAssembly(null,e,i,r)}):console.log("BAD JSON type... fetch aborted")}function g(e,t,i){for(var r={},a=e.length,n=0;n<a;n++){r[e[n].nodeid]=n}var o={},s=t.length;for(n=0;n<s;n++){o[t[n].occurrenceid]=n}var l={},c=i.length;for(n=0;n<c;n++){l[i[n].child]=n}for(var d=0;d<s;d++){var u=t[d],p=u.nodeid;if(u.nodeNdx=r[p],0==d)u.parentNodeNdx=-1,u.parentOccNdx=-1;else{var h=i[l[u.occurrenceid]],f=h.parent;null!=h["IEF-UUID"]&&(u.IEF_UUID=h["IEF-UUID"]),u.parentOccNdx=o[f];var m=t[u.parentOccNdx].nodeid;u.parentNodeNdx=r[m]}}}function v(e){for(var t=e.length,i=0;i<t;i++){for(var r=e[i],a=r,n=0;-1!=a.parentOccNdx&&n<8096;)n++,a=e[a.parentOccNdx];n>=8096&&(console.log("Problem calculating levels for object; Failsafe level reached"),n=0),r.level=n}}var y=["CATProduct","CATPart","CATDrawing","CATAnalysis","CATProcess","CATShape","CATIA CGR","CATIA Embedded Component","VPMReference","VPMRepReference","3DShape","Part"];function b(e,t){for(var i,r=e.length,a=0;a<r;a++){var n=e[a],o=n.attributes;if(null==o.isViewerSupported)(i=n.type,-1!=y.indexOf(i))&&(o.isViewerSupported=!0);null==o.Title&&(o.Title=n.Title);for(var s=["PLMEntity.V_Name","Title","name"],l=s.length,c="",d=0;d<l;d++){var u=o[s[d]];if(null!=typeof u&&null!=u&&""!=u){c=u;break}}o.titleToUse=c}for(var p=t.length,h=0;h<p;h++){var f=t[h];if(-1!=f.parentNodeNdx){var m=e[f.parentNodeNdx];f.parentPhysicalId=m.physicalid}}}function C(e){for(var t=e.length,i=0;i<t;i++){e[i].isLeaf=!0}for(i=0;i<t;i++){var r=e[i].parentOccNdx;if(-1!=r)e[r].isLeaf=!1}}function w(e,t){for(var i=e.length,r=!1,a=1;a<i;a++)if(null==e[a].ConnectionId||""==e[a].ConnectionId){r=!0;break}if(0!=r){var n=[];for(a=0;a<e.length;a++){n[e[a].occurrenceid]=a}var o=t.length;for(a=0;a<o;a++){var s=t[a],l=s.child,c=s.physicalid;e[n[l]].ConnectionId=c}n=null}}function S(e,t,i){for(var r=t.length,a=0;a<r;a++){var n=[],o=[],s=a;do{var l=t[s],c=e[l.nodeNdx].physicalid;if(o.unshift(c),n.unshift(c),-1!=l.parentOccNdx){var d=i[s-1].physicalid;n.unshift(d)}s=l.parentOccNdx}while(-1!=s);t[a].pathWith=n,t[a].pathWithout=o}}function D(e){for(var t=e.length,i=0;i<t;i++)for(var r=0;r<e[i].occurrences.length;++r){var a=e[i].occurrences[r];null==a.occurrenceid&&(a.occurrenceid=a.occurenceid)}for(i=0;i<t;i++){var n=e[i],o=n.nodes,s=n.occurrences,l=n.occurrencerelationships;g(o,s,l),v(s),b(o,s),C(s),w(s,l),S(o,s,l)}}function _(t,i,r,n){var o=[];m(t[1],i[1],function(s){o.push(s),m(t[0],i[0],function(t){o.push(t),function(e){for(var t=0;t<e.length;t++)for(var i=e[t].nodes,r=0;r<i.length;r++){var a=i[r].attributes,n=a.revision,o=n.indexOf(".");-1!=o&&(a.revision=n.substring(0,o))}}(o),D(o),function(t,i){for(var r=t[0],n=r.nodes,o=(r.occurrencerelationships,t[1]),s=o.nodes,l=(o.occurrencerelationships,function(e){return null==e||null==e||""==e}),c=[],d=0;d<2;d++)for(var p=0==d?n:s,h=p.length,f=0;f<h;f++){var m=p[f];(l(m.attributes["revision-latest-version"])||l(m.attributes["MCADInteg-SourceObj"])||l(m.attributes["revision-physicalid"])||l(m.attributes.name))&&c.push(m.physicalid)}if(c.length>0){var g=c.join(),v=widget.getValue("x3dPlatformId"),y=a.get3DSpaceWSUrl(v,"/resources/compare/postInfo/");u.mark({id:"infoSvcCall",str:"[BEGIN] http req: postInfo "}),e.authenticatedRequest(y,{method:"POST",type:"json",timeout:12e4,data:g,headers:{Accept:"application/json","Content-Type":"application/json"},onComplete:function(e){u.mark({id:"infoSvcCall",str:"  [END] http req: postInfo"});for(var t=e.results,r=t.length,a=0;a<r;a++)for(var o=t[a],l=o.physicalid,c=o["revision-latest-version"],d=o["MCADInteg-SourceObj"],p=o["revision-physicalid"],h=o.isViewerSupported,f=o.name,m=0;m<2;m++)for(var g=0==m?n:s,v=g.length,y=0;y<v;y++){var b=g[y];if(b.physicalid==l){b.attributes["MCADInteg-SourceObj"]=d,b.attributes["revision-physicalid"]=p,b.attributes.name=f,b.attributes["revision-latest-version"]=c,b.attributes.isViewerSupported=h;break}}i()}})}}(o,function(){r(o)})},n)},n)}var T={};function E(e){var t=e,i=e.occurrences,r=e.occurrencerelationships;if(0==r.length||null==r[0].treeOrder);else{for(var a=r[0].treeOrder,n=!0,o=1;o<r.length;o++)r[o].treeOrder!=a&&(n=!1);if(1==n)console.log("Compare Widget: Unable to sort structure / no useful tree order information in data.");else{!function(e){lut_occurNdxForOccurID={};for(var t=0;t<e.length;t++){var i=e[t];T[i.occurrenceid]=e[t]}}(i);var s=function e(t,i){for(var r=[],a=[],n=0;n<i.length;n++)i[n].parent==t&&r.push({parentOccID:t,childOccID:i[n].child,treeOrder:i[n].treeOrder,PLM_ExternalID:i[n].PLM_ExternalID});if(r.length>0){r.sort(function(e,t){return e.treeOrder-t.treeOrder});for(var o=0;o<r.length;o++){a.push(r[o]);for(var s=e(r[o].childOccID,i),l=0;l<s.length;l++)a.push(s[l])}}return a}(0,r);s.splice(0,0,{parentOccID:null,childOccID:e.rootoccurrence,treeOrder:"0",PLM_ExternalID:"(none)"});var l=new Array(i.length);for(o=0;o<s.length;o++)l[o]=T[s[o].childOccID];t.occurrences=l}}return t}function A(e,t,i){!function(e,t){for(var i=0;i<t.length;i++){for(var r=t[i],a=[],n=r.nodes,o=n.length-1;o>=0;o--)(l=n[o]).type==e&&(n.splice(o,1),a.push(l.nodeid.toString()));var s={};for(o=0;o<n.length;o++){var l;s[(l=n[o]).nodeid.toString()]=o,l.nodeid=o}var c=r.occurrences,d=[];for(o=c.length-1;o>=0;o--){var u=c[o];-1!=a.indexOf(u.nodeid.toString())&&(c.splice(o,1),d.push(u.occurrenceid))}var p={};for(o=0;o<c.length;o++)p[(u=c[o]).occurrenceid]=o,u.occurrenceid=o,u.nodeid=s[u.nodeid.toString()];var h=r.occurrencerelationships;for(o=h.length-1;o>=0;o--){var f=h[o];-1!=d.indexOf(f.child)?h.splice(o,1):(f.parent=p[f.parent],f.child=p[f.child])}}}("PlmParameter",t),D(t);var r=E(t[0]),a=E(t[1]);f(r),f(a);i(t)}function I(e,t,i,r,n){var s="",l=widget.getValue("x3dPlatformId");if(null!=n&&o.typeInfo[n])s=o.typeInfo[n].url+"/"+o.typeInfo[n].structure.expandURL+"?tenant="+l+"&objectIds="+r.join(",");else{var c=e?"/resources/compare/index/postFetchModelsFromIndex":"/resources/compare/fetchModels",d=[];if(d.push("objectIds="+r.join(",")),s=a.get3DSpaceWSUrl(l,c,d),null!=t&&0!=t.length&&(s+="&compareOption="+t),null!=i&&""!==i&&"-1"!==i&&(s+="&fetchDepth="+i),e)s+="&root3DSpaceUrl="+a.get3DSpaceBaseUrl(l)}return s}function x(e,t){var i,r=[];r.push((i=e[0],new l(function(e,t){c.get(i,function(t){null!=t&&t.addTo(i),e()},t)}))),widget.CompareWidgetUseTitleRevToMatch&&r.push(function(e){return new l(function(t,i){d.get(e,function(i){null!=i&&i.addTo(e),t()},i)})}(e)),UWA.Promise.all(r).then(t,function(e){console.error(e),t()})}function O(t,i,r,a,n){try{var o="GET"==t?null:null==r?"":JSON.stringify(r);e.authenticatedRequest(i,{method:t,type:"json",proxy:"passport",timeout:p,data:o,headers:{Accept:"application/json","Content-Type":"application/json"},onComplete:a,onFailure:n})}catch(e){console.log("Error loading tree data from server"),n()}}var N,P=[null,null],R=0,L=-1;function W(){}return W.prototype.fetchObjsByRootIDs=function(e,r,a,n,l,c,d,u){(N=N||this,null!=r)?A(0,r,d):function e(r,a,n,l,c,d,u,p){function h(e,t,i,r){x(t,function(){f(e,t,i)})}function f(e,t,i){if(-2!==e&&-3!==e){var r=t.length;"DEBUG"==t[r-1].type&&(console.log("SERVER DEBUG TIME: "+t[r-1].TIME_INFO),t.splice(r-1,1),r--),null!=t[r-1].TIME_INFO&&console.log("COMPARE SERVER TIMING [DB] >>  "+t[r-1].TIME_INFO);var n=0==r?null:null!=t[0].Failed_idlist?t[0].Failed_idlist:null;if(null!=n)p(n);else if(0==e||1==e)P[e]=t[0];else if(-1==e){++L;for(var l=0;l<t.length;++l){var c=t[l];if(null!=c)for(var d=c.rootoccurrence,f=parseInt(c.occurrences[d].nodeid),m=c.nodes[f].physicalid,v=0;v<P.length;++v)for(var y=0;y<P[v].nodes.length;++y)P[v].nodes[y].physicalid==m&&(P[v].nodes[y].Title=c.nodes[f].Title,P[v].nodes[y].icon=c.nodes[f].icon,P[v].nodes[y].mod=c.nodes[f].mod,P[v].nodes[y].revision=c.nodes[f].revision,P[v].nodes[y].attributes=c.nodes[f].attributes)}}}else if(t&&t.results&&t.results.length)for(v=0;v<P.length;++v)for(y=0;y<P[v].nodes.length;++y)for(var b=0,C=t.results.length;b<C;b++){var w=t.results[b];P[v].nodes[y].physicalid===w.physicalID&&(P[v].nodes[y].icon=w.type_icon_url,o.typeInfo[P[v].nodes[y].type]&&o.typeInfo[P[v].nodes[y].type.icon]||(o.typeInfo[P[v].nodes[y].type]=o.typeInfo[P[v].nodes[y].type]||{},o.typeInfo[P[v].nodes[y].type].icon=w.type_icon_url,null==o.typeInfo[P[v].nodes[y].type].serviceId&&void 0!==w.sourceID&&null!==w.sourceID&&(o.typeInfo[P[v].nodes[y].type].serviceId=w.sourceID.split(":")[0])))}if(null!=P[0]&&null!=P[1]&&-1===L){function S(e){if(null!=e)for(var t=0;t<e.nodes.length;++t)if(t!==e.rootoccurrence){var i=e.nodes[t];void 0!==i.proxySpec&&null!==i.proxySpec&&(i.proxySpec.serviceURL,-1!==i.proxySpec.serviceURL.search(/^3DSpace/i)?D.objectIds.push(i.physicalid):o.typeInfo[i.type]&&o.typeInfo[i.type].icon?i.icon=o.typeInfo[i.type].icon:(_.objectIds.push(i.physicalid),_.serviceIds.push(i.proxySpec.serviceURL)))}}var D={objectIds:[]},_={objectIds:[],serviceIds:[],tenant:widget.getValue("x3dPlatformId"),securityContext:N.securityContext};if(S(P[0]),S(P[1]),R=0,L=0,_.objectIds.length&&(++R,s.getFederatedAttributesPromise(_).then(function(e){++L,h(-2,e)})),D.objectIds.length){for(v=0,v=0;v<D.objectIds.length;v+=25)++R;for(v=0;v<D.objectIds.length;v+=25){var T=D.objectIds.slice(v,v+25);O("GET",I(i,a,"0",T,null),null,function(e){h(-1,e)},function(){++L,console.log("COMPARE FAILURE retrieving index data when expanding root children"),h(-3,[],i)})}}}null!=P[0]&&null!=P[1]&&L==R&&(i&&-3==e?(P=[null,null],R=0,L=-1,g()):(P[0].options,A(0,P,u),P=[null,null],R=0,L=-1))}function m(e,t){t?g():v()}function g(r){if(-1!=a.indexOf("requiresIndex")){var o=t.not_found_in_index;i.doAlert({msg:o,alertStyle:"compare-alert-warning"}),p()}else o=t.disabling_index_object_not_found,i.doAlert({msg:o,alertStyle:"compare-alert-warning"}),y||(y=!0,e(!1,a,n,l,c,d,u,p))}function v(e){var r=t.OBJ_NOT_FOUND;console.log("Compare Widget:: "+r),i.doAlert({msg:r,alertStyle:"compare-alert-error"}),p()}for(var y=!1,b=[],C=null,w=0;w<l.length;++w)null!=d&&void 0!==d[w]&&null!==d[w]?((C=void 0!==d[w].CVQuery3D&&null!==d[w].CVQuery3D?JSON.stringify(d[w].CVQuery3D):JSON.stringify(d[w].CVQuery)).includes("config_filter")&&void 0!==d[w].CVQuery&&null!==d[w].CVQuery&&(C=JSON.stringify(d[w].CVQuery)),b.push({type:"CVQUERY",spec:C})):b.push({type:"IDSPEC",spec:l[w]});if(2==l.length){var S="-1",D={objSpecList:[b[0]],depth:S},_={objSpecList:[b[1]],depth:S},T=I(r,a,S,[l[0]],Array.isArray(c)&&2===c.length?c[0]:null),E=I(r,a,S,[l[1]],Array.isArray(c)&&2===c.length?c[1]:null);O(r?"POST":"GET",T,D,function(e){h(0,e,r)},function(){m(0,r)}),O(r?"POST":"GET",E,_,function(e){h(1,e,r)},function(){m(1,r)})}else{var W={objSpecList:b,depth:S=n?"0":"-1"},j=I(r,a,S,l,Array.isArray(c)&&c.length>0?c[0]:null);O(r?"POST":"GET",j,W,function(e){var t=0==e.length?null:null!=e[0].Failed_idlist?e[0].Failed_idlist:null;if(null!=t)p(t);else{e[0].options;var i=e.length;"DEBUG"==e[i-1].type&&e.splice(i-1,1),A(0,e,u),e=[null,null]}},function(){m(-1,r)})}}(-1!=a.indexOf("use_index"),a,n,e,l,c,d,u)},W.prototype.fetchSnapshotObjsByID=function(e,t,i,r){_(e,t,i,r)},W.prototype.createJSONViewerObj=function(e){var t=null;try{t=r.convertToViewerFormat(e)}catch(e){console.error("Exception creating JSAONObjViewer...")}return t},W}),define("DS/CompareWidget/CompareStructEngine",["DS/CompareWidget/CompareStructEnginePlugins","DS/CompareWidget/CompareStatusDiffs","DS/CompareWidget/CompareStatus"],function(e,t,i){var r=function(e,t,i,r){var o=n.call(this,e,t,i,r);return o&&a.call(this,e,t,i,r),o},a=function(e,r,n,o){if(-1!=r){var s=n[e],l=o[r];-1==s.matchNdx&&(s.matchNdx=l.idx,l.matchNdx=s.idx,l.relType=new i({matched:!0,differences:[t.diff]}),a.call(this,s.parentIdx,l.parentIdx,n,o))}},n=function(e,r,a,o){if(-1==r)return!0;var s=!1,l=a[e],c=o[r];s=-1!=l.matchNdx?l.matchNdx==c.idx:-1==c.matchNdx||l.idx==c.matchNdx;var d=new i({matched:!0,differences:[t.diff]});return s&&JSON.stringify(c.relType)!=JSON.stringify(d)&&(s=n.call(this,l.parentIdx,c.parentIdx,a,o)),s};function o(e){for(var t=new Array(e.length),i=0;i<e.length;i++)t[i]=-1;for(i=0;i<e.length;i++){t[n=e[i].objID]=i}for(var r=0;r<e.length;r++){var a=e[r].parentID;e[r].parentIdx=-1==a?-1:t[a];var n=e[r].objID;e[r].idx=-1==n?-1:t[n]}}function s(e,t){return null==e||null==e||e.constructor==String&&""==e?t:e}return{MATCH_NONE:-1,createSCO:function(e,t,i,r,a,n,o,l,c,d,u,p,h,f,m,g,v,y,b,C){var w=s(d,"NOVAL_REVID"+e),S=s(m,w),D=s(u,null);null==D&&(D=s(g,w));var _=null;null!=c&&c.constructor==Array&&(_=c.toString());var T=s(p,h);return T=s(T,"NOVAL_OK"),{coType:"SCO",title:v,objID:t,parentID:i,name:s(r,"NOVAL_NAME"+e),type:s(a,"NOVAL_TYPE"+e),level:n,pid:s(o,"NOVAL_PID"+e),revision:s(l,"NOVAL_REV"+e),xform:s(_,"NOVAL_XFORM"+e),inst_comp:T,rlv_V5:s(f,"NOVAL_ILRV5"+e),src_obj:S,src_obj_root:D,isRoot:y,isLeaf:b,inst_logicalid:C}},createLCO:function(e,t,i,r,a,n,o,s,l,c,d,u,p,h,f){var m=this.createSCO(e,t,"NOVAL_LIST"+e,i,r,"NOVAL_LIST"+e,a,n,"NOVAL_LIST"+e,o,s,"NOVAL_LIST"+e,"NOVAL_LIST"+e,l,c,d,u,p,h,f);return m.coType="LCO",m.Qty=1,m},evalAssemblies:function(t,a,n,s){var l=new e;this.plugin=l.getPlugin(a,n);var c={};c.ignoreRev=-1!=s.indexOf("ignore_revision"),c.ignoreDup=-1!=s.indexOf("ignore_dupe"),c.similarCanBeRevisioned=-1!=s.indexOf("similar_can_be_revisioned"),o(a),o(n);try{for(var d=0;d<a.length;d++)a[d].matchNdx=this.MATCH_NONE,a[d].matchSet=[];var u=[];for(d=0;d<n.length;d++)u[d]=d,n[d].matchNdx=this.MATCH_NONE,n[d].relType=new i;for(var p=0;p<a.length;p++){(S=a[p]).matchSet=[];for(var h=0;h<u.length;h++){var f=u[h],m=n[f],g=this.plugin.compare(t,S,m,c),v=!1;if(g.matched){if(S.inst_comp==m.inst_comp){var y=S.parentIdx;if(-1!=y)if(0==y&&0==m.parentIdx)v=!0;else a[y].matchNdx==m.parentIdx&&(v=!0)}if(v){S.matchNdx=f,S.matchSet=[],m.matchNdx=p,m.relType=g,u.splice(h,1);break}S.matchSet.push({relndx:u[h],reltype:g})}}}for(var b=2,C=2;C<=b;++C)for(var w=0;w<a.length;w++){var S=a[w],D=!1;if(S.matchNdx!=this.MATCH_NONE);else{for(var _=S.matchSet,T=-1,E=new i,A=0;A<_.length;A++){var I=_[A],x=I.reltype,O=I.relndx,N=!1;if(!t){var P=S.parentIdx,R=n[O].parentIdx,L=n[R];N=-1==P&&-1==R||L.matchNdx==P}if(n[O].matchNdx!=this.MATCH_NONE)N&&(D=!0);else{var W=!1;if(t)this.plugin.prioritize(x,E)&&(W=!0);else 0==D&&1==N&&(W=!0,D=!0),0==W&&D==N&&(2==C?b=3:this.plugin.prioritize(x,E)&&(W=!0));1==W&&(" ---\x3e>> BEST SO FAR!!",T=O,E=x)}}if(E.matched){var j=n[V=T];S.matchNdx=V,j.matchNdx=w,j.relType=E}else;}if(!t&&S.matchNdx!=this.MATCH_NONE){var V;j=n[V=S.matchNdx];r.call(this,S.parentIdx,j.parentIdx,a,n)||(S.matchNdx=-1,j.matchNdx=-1,j.relType=new i)}}}catch(e){console.log("Exception evaluating assemblies:"+e+" continuing...")}}}}),define("DS/CompareWidget/SimuliaComparePlugin",["UWA/Class","DS/Controls/Tab","DS/UIKIT/Mask","DS/CompareWidget/CompareStatusDiffs","i18n!DS/CompareWidget/assets/nls/CompareWidget"],function(e,t,i,r,a){function n(e,t,i){var r=[],a=e.compareData;if(null!=a&&null!=a){for(var o=0;o<t.length;++o)r[o]=t[o];var s=a["physicalid[connection]"];null!=s&&r.push(s),r.push(a.physicalid)}if(0==r.length&&(r=null),i[e.key]=r,void 0!==e.children&&null!==e.children)for(o=0;o<e.children.length;++o)n(e.children[o],r,i)}function o(e){for(var t=[];null!=e&&null!=e.data;){var i=e.data.compareData;if(null==i)break;t.unshift(i.physicalid);var r=i["physicalid[connection]"];null!=r&&t.unshift(r),e=e.parent}return 0==t.length&&(t=null),t}return e.extend({init:function(e){this._parent({}),this.compareContent=e},initCustomCompare:function(e,t){this.compareResult=e,this.onInitCustomCompareDone=t,this.clearMergeUI(),2==this.compareInput.rootCount?this.buildMergeUI():t()},setCompareInput:function(e){this.compareInput=e},clearMergeUI:function(){this.compareContent.attrTableContainer.inject(this.compareContent.midPanel),null!=this.midContent&&this.midContent.destroy()},buildMergeUI:function(){this.midContent=UWA.createElement("div",{styles:{overflow:"auto",width:"100%",height:"100%"}}),this.midContent.inject(this.compareContent.midPanel);var e=new t({displayStyle:"strip"});e.inject(this.midContent);var i=UWA.createElement("div");this.compareContent.attrTableContainer.inject(i);var r=UWA.createElement("div");widget.isMergeTabActive=widget.isMergeTabActive||!1,e.addEventListener("change",function(e){1==e.dsModel.value.length&&(widget.isMergeTabActive=1==e.dsModel.value[0])}),e.add({label:a.get("attributes"),isSelected:!widget.isMergeTabActive,content:i,icon:{iconName:"",fontIconFamily:""}}),e.add({label:a.get("merge"),isSelected:widget.isMergeTabActive,content:r,icon:{iconName:"",fontIconFamily:""}}),this.listenCompareRowSelectEvent(),this.buildMergePanel(r)},onInitComplete:function(){for(var e=this.compareResult.right,t=0;t<e.length;t++)this.getCustomDifferences(e[t]);this.onInitCustomCompareDone()},buildMergePanel:function(e){require(["DS/SMASdmAssociativityWebUI/Merge"],function(t){var i={roots:this.compareInput.roots,treeView:!this.compareContent.isListView,appliedFilter:this.compareInput.appliedFilter,structures:this.compareResult,refresh:this.compareContent.currentCmdContext===this.compareContent.CmdContexts.Load||this.compareContent.currentCmdContext===this.compareContent.CmdContexts.Refresh||this.compareContent.currentCmdContext===this.compareContent.CmdContexts.RemoveAll,onInitComplete:this.onInitComplete.bind(this),startWait:this.startWait.bind(this),stopWait:this.stopWait.bind(this)};this.mergePanel=new t(i),this.mergePanel.inject(e),this.lastSelection=""}.bind(this))},getCustomDifferences:function(e){var t=[];n(this.compareContent.structureCompare.fTreeData_left[0],[],t);var i=[];n(this.compareContent.structureCompare.fTreeData_right[0][0],[],i),this._getCustomDifferences(e,t,i),t=[],i=[]},_getCustomDifferences:function(e,t,i){if(null!=e.compareData){var r=e.matchRow;if(null!=r.compareData){for(var a=this.mergePanel.getCustomDifferences({left:r.compareData.physicalid,right:e.compareData.physicalid,leftPath:t[r.key],rightPath:i[e.key]}),n=0;n<a.length;n++)e.compareStatus.differences.push(a[n]);var o=e.children;if(null!=o)for(n=0;n<o.length;n++)this._getCustomDifferences(o[n],t,i)}}},listenCompareRowSelectEvent:function(){jQuery("#compare-content").on("newRowSelectedEvent",function(e,t){var i=this.compareContent.structureCompare.fTree_left.activeNode,r=this.compareContent.structureCompare.fTree_right[0].activeNode,a={selectedItems:{left:o(i),right:o(r)}},n=JSON.stringify(a);this.lastSelection!=n&&(this.mergePanel.render(a),this.lastSelection=n)}.bind(this))},startWait:function(e){i.mask(widget.body,e)},stopWait:function(e){if(i.unmask(widget.body),void 0!==e.operations&&null!==e.operations&&e.operations.length>0){for(var t=!0,r=0;r<e.operations.length;++r){var a=e.operations[r],n=!1;"REMOVE_ITEM"===a.type?n=this.compareContent.modifyCachedTablesForRemovedItems(a.itemInstanceID):"ADD_ITEM"===a.type&&(n=this.compareContent.modifyCachedTablesForAddedInstanceItems(a.itemInstanceID,a.newItemInstanceID)),n||(t=!1)}t?this.compareContent.refresh(null,{cmdContext:this.compareContent.CmdContexts.Refresh_noFetch}):this.compareContent.refresh(null,{newLeftRoot:e.newLeftRoot})}else{if(e.refresh)this.compareContent.refresh(null,{newLeftRoot:e.newLeftRoot});else-1==(n=this.compareContent.modifyCachedTablesForMovedItems(e.structures))?this.compareContent.refresh(null,{cmdContext:this.compareContent.CmdContexts.Refresh_noFetch}):0==n&&this.compareContent.refresh(null,{newLeftRoot:e.newLeftRoot})}}})}),define("DS/CompareWidget/PickDialog",["DS/ENO6WPlugins/jQuery","DS/CompareWidget/PickDialogView","DS/LifecycleServices/LifecycleServicesSettings","DS/LifecycleServices/LifecycleServices","DS/CompareCommon/Utils","i18n!DS/CompareWidget/assets/nls/CompareWidget","css!DS/CompareWidget/CompareWidget.css"],function(e,t,i,r,a,n){"use strict";var o=null,s=null,l=null,c=null,d=null,u=null,p=null,h=null,f=function(e,t,i,r,a){s=t,l=i,c=r,(u=UWA.createElement("div",{id:"pick-dialog-container",html:[{tag:"div",id:"pick-dialog-header"},{tag:"div",id:"pick-dialog-content"}]})).inject(e),(o=e.getElement("#pick-dialog-content")).style.height="calc(100% - 29px)",require(["DS/UIKIT/Mask"],function(e){e.mask(o)}),a&&e.getElement("#pick-dialog-header").hide()};return f.prototype.load=function(f,m,g,v,y,b,C,w,S,D,_,T,E){h=null==w?null:w;var A=null==C?null:C;i.app_initialization(function(){r.getSecurityContextPromise(w,A).then(function(i){d=i,u.getElement("#pick-dialog-header").setContent(e('<span id="pick-header">'+n.chooseObject+"</span>")),a.augDroppedObject(f,{tenant:w,securityContext:d,url3DSpace:l},function(e){(p=new t({container:o,listContainer:o,baseContainer:s,revServiceURL:l,droppedObj:f,rootObj:e,proxyType:c,callbackFn:m,dataSetRev:T,dataSetAlt:E,duplicateOnly:v||!1,dupFiltering:y,dupRevsFiltering:b,bHistoryGraphSelector:S,isHistoryEmbedded:D,isCompare:_,facetToSelect:g,securityContext:i})).render()},function(e){console.log("augDroppedObject error: "+e)})})})},f.prototype.refresh=function(e){a.augDroppedObject(e,{tenant:h,securityContext:d,url3DSpace:l},function(t){p.refresh(e,t)})},f.prototype.getDupFilteringValues=function(){return null!==p?p.getDupFilteringValues():void 0},f.prototype.closeHistoryGraphDialog=function(){null!==p&&p.closeHistoryGraphDialog()},f}),define("DS/CompareWidget/CompareStructure",["UWA/Core","DS/ENO6WPlugins/jQuery","WebappsUtils/WebappsUtils","DS/LifecycleServices/LifecycleServicesSettings","DS/CompareCommon/CompareImgSrc","DS/CompareCommon/launchTree","i18n!DS/CompareWidget/assets/nls/CompareStructure","DS/CompareCommon/DragAndDrop","DS/CompareCommon/Utils","DS/CompareWidget/CompareStructEngine","DS/CompareWidget/CompareStatus","DS/CompareWidget/CompareStatusDiffs","DS/CompareCommon/DBG_Stopwatch","DS/i3DXCompassPlatformServices/OpenWith","DS/CompareCommon/CompareStructOpenWith","DS/Menu/Menu","DS/i3DXCompassServices/i3DXCompassPubSub","DS/Selection/CSOManager","DS/CompareCommon/CompareMetaData","DS/CompareWidgetUtils/Fancytree","DS/CompareWidgetUtils/Fancytree_table","css!DS/VENCompareWidgetUtils/plugins/fancytree/v2.9.0/fancytree.css","css!DS/CompareWidget/CompareWidget.css"],function(e,t,i,r,a,n,o,s,l,c,d,u,p,h,f,m,g,v,y,b,C){"use strict";var w=0,S=0,D=0,_=0,T=0,E=0,A=0,I=0,x=0,O=!1,N=!1,P=null,R=null,L=null,W=null,j={x:0,y:0},V=function(e,t,i,r,a){i,this.targetElement=e,this.legendElement=t,this.fTree_left=null,this.fTreeData_left=[],this.fTree_right=[],this.fTreeData_right=[],this.loadingGif=null,this.securityContext=r,this.compareContent=a,this.listSelectedNodes=[];var n=this;null!=L&&v.unsubscribe(L),L=v.onPostAdd(function(e){var t=v.get();t.length>1&&require(["DS/ApplicationFrame/CommandsManager"],function(e){var t=e.getCommand("LevelSelectorHdr",null);null!=t&&t.endExecute()}),n._onViewerSelection(e,t)}),null!=W&&v.unsubscribe(W),W=v.onPostRemove(function(e){var t=v.get();n._onViewerSelection(e,t)})};function F(e,t,i,r){for(var a={},n=0;n<r.length;n++){a[r[n].child]=n}var o=new Array(i.length);for(n=0;n<i.length;n++)o[n]=null;for(var s=0;s<i.length;s++){var l=i[s],d=l.occurrenceid,u=t[l.nodeid],p=u.attributes,h=u.matching_attributes,f=-1==l.parentNodeNdx,m=l.isLeaf,g=-1,v=null,y=null,b=null,C=null,w=a[d];null!=w&&(v=r[w]["IEF-UUID"],y=r[w].PLM_ExternalID,g=r[w].parent,b=r[w].matching_attributes,C=r[w].inst_logicalid);var S=p["MCADInteg-SourceObj"],D=null;if("undefined"!=S&&null!=S&&""!=S)D=S.split("|")[0];o[s]=c.createSCO(e,d,g,p.name,u.type,l.level,u.physicalid,p.revision,l.xform,p["revision-physicalid"],null!=p["PLMReference.V_DerivedFrom"]?p["PLMReference.V_DerivedFrom"]:p.derivedFromId,y,v,p["revision-latest-version"],D,p["MCADInteg-SourceObj-root"],p.titleToUse,f,m,C),o[s].node_matching_attributes=h||[],o[s].inst_matching_attributes=b||[],o[s].typeParentTypeMap=u.typeParentTypeMap}return o}function M(e,t,i,r){for(var a={},n=0;n<r.length;n++){a[r[n].child]=n}var o=new Array(t.length);for(n=0;n<t.length;n++)o[n]=null;for(var s=0;s<i.length;s++){var l=i[s],d=l.nodeid;if(null!=o[d])o[d].Qty++;else{var u=t[d],p=u.attributes,h=-1==l.parentNodeNdx,f=l.isLeaf,m=a[l.occurrenceid],g=null;null!=m&&(g=r[m].inst_logicalid);var v=p["MCADInteg-SourceObj"],y=null;if("undefined"!=v&&null!=v&&""!=v)y=v.split("|")[0];o[d]=c.createLCO(e,s,p.name,u.type,u.physicalid,p.revision,p["revision-physicalid"],p["PLMReference.V_DerivedFrom"],p["revision-latest-version"],y,p["MCADInteg-SourceObj-root"],p.titleToUse,h,f,g)}}return o}function k(e,t,i,r,a,n,o,s){var l=null;return null!=r&&(l={compareStatus:e,quantity:i,physicalid:r.physicalid,type:r.type,relationship:r.relationship,cgrurl:r.cgrurl,icon:r.icon,"attribute[Spatial Location]":null==o?null:o.xform,level:null==o?null:o.level+"",matchresult:t,title:r.attributes.titleToUse,name:r.attributes.name,revision:r.attributes.revision,occNdx:null==o?null:o.occurrenceid,parentOccNdx:n,isLeaf:a,isRoot:s,isTypeOf3DShape:r.attributes.isTypeOf3DShape},void 0!==y.typeInfo[r.type]&&null!==y.typeInfo[r.type]&&""!==y.typeInfo[r.type]?l.serviceId=y.typeInfo[r.type].serviceId:void 0!==r.serviceId&&null!==r.serviceId&&""!==r.serviceId?l.serviceId=r.serviceId:l.serviceId="3DSpace",null!=o&&(null!=o.parentPhysicalId&&(l["from.physicalid"]=o.parentPhysicalId),null!=o.ConnectionId&&(l["physicalid[connection]"]=o.ConnectionId))),l}function B(e,t,i,r,a,n){for(var o=[],s=[null,null],l=0;l<2;l++)for(var u=0==l?e:r,p=0==l?t:a,h=0==l?i:n,f=1==l?e:r,m=1==l?t:a,g=1==l?i:n,v=u.length,y=0;y<v;y++){var b=u[y];if(1!=l||!b.relType.matched){var C=b.isLeaf,w=b.Qty,S=b.matchNdx,D=b.parentID,_=-1==S?null:f[S],T=!1,E=c.MATCH_NONE,A=new d,I=0,x=null==_?null:_.parentID;null!=_?(E="MATCH_OK",A=0==l?_.relType:b.relType,T=_.isLeaf,I=_.Qty):E="MATCH_ONLY_"+l;var O=null,N=null,P=null,R=null,L="unknown";"LCO"==b.coType?(O=p[y],L=b.isRoot,A.matched&&(N=a[S])):(O=p[(P=h[y]).nodeNdx],A.matched&&(N=m[(R=g[S]).nodeNdx]));var W=k(A,E,w,O,C,D,P,L);null!=W&&(W.obj2=k(A,E,I,N,T,x,R,L),1==L?null!=s[l]?Console.error("Object "+l+" has more than one root..."):s[l]=W:o.push(W))}}return null!=s[1]&&o.unshift(s[1]),null!=s[0]&&o.unshift(s[0]),o}V.prototype._getOtherTree=function(e){return e._id===this.fTree_left._id?this.fTree_right[0]:this.fTree_left},V.prototype._getOtherTrees=function(e){return e._id===this.fTree_left._id?this.fTree_right:null};function U(e){if(e.widgetId===widget.id){for(var t=[],i=0;i<e.data.items.length;i++)t.push(e.data.items[i].path);var r=null;for(i=0;null==r&&i<R.length;)r=R[i].buildLaunchJSON(t),i++;if(null==r)return void console.error("Cannot find selection in either tree (this should not happen)");var a={appId:e.appId,widgetId:e.widgetId,fileName:"-file",fileContent:r};g.publish("launchApp",a)}}function H(e,t,i,r,a,n){var s=[];if(t.length>0){var l={type:"PushItem",icon:"url("+n+")",title:o.OpenWith,submenu:t};s.push(l),s.push({type:"SeparatorItem"})}if(i.length>0){let t=o.ExpandAll,r="wux-ui-3ds wux-ui-3ds-lg wux-ui-3ds-flow-tree-expand-down";1===e.compareContent.currentExpandState?(t=o.ExpandNLevels,r="wux-ui-3ds wux-ui-3ds-lg wux-ui-3ds-flow-tree-expand-down-cog"):2===e.compareContent.currentExpandState&&(t=o.CollapseAll,r="wux-ui-3ds wux-ui-3ds-lg wux-ui-3ds-flow-tree-expand-up");var c={type:"PushItem",title:t,fonticon:{content:r},submenu:i,family:WUXManagedFontIcons.Font3DS};s.push(c)}if(s.length>0){var d={input:window.location.search.indexOf("touch")>=0?"touch":"mouse",position:{x:r,y:a},submenu:t};j={x:r,y:a},m.show(s,d)}}function G(e,t,i){!function e(r){var a=i?r:r.children;if(Array.isArray(a)&&a.length)for(var n=0,o=a.length;n<o;n++){var s=a[n],l=a[n].matchRow.fancyTreeNode.data,c=l.compareData||s.compareData;if(null!=c.type){s.displayState=s.compareStatus.toShow(t)&&(!0===i||!i&&r.fancyTreeNode.expanded&&r.displayState),s.fancyTreeNode.displayState=s.displayState,l.displayState=s.displayState,l.fancyTreeNode.displayState=l.displayState;var d=!0===s.displayState?"":"none";s.fancyTreeNode.tr.style.display=d,l.fancyTreeNode.tr.style.display=d,i||e(s)}}}(e)}function Q(e){var i=t(e);return{mousedown:function(e){i.mousedown(e),i.on("touchstart",function(t){t.pageX=t.originalEvent.touches[0].pageX,e(t)})},bind:function(e,t){"mousemove"==e?(i.bind(e,t),i.bind("touchmove",function(e){e.pageX=e.originalEvent.touches[0].pageX,t(e)})):alert(e+"is not supported in _jQueryEx")},unbind:function(e,t){"mousemove"==e?(i.unbind(e,t),i.unbind("touchmove",t)):alert(e+"is not supported in _jQueryEx")}}}function J(e){for(var t=e.length,i=0;i<t;i++){var r=e[i];if(("3DShape"===r.compareData.type||r.compareData.isTypeOf3DShape)&&null!=r.parent){var a=e[r.parent];if(!0===a.expanded&&void 0!==a.children&&null!==a.children&&1===a.children.length)a.expanded=!1,a.matchRow.expanded=!1}}}function q(e,t){var i=function(e){for(var t=e.rootNode.children,i=0;i<t.length;i++){var r=t[i];if(null!=r.data.compareData)return r}return null}(e).tr.getElementsByClassName("fancytree-node")[0],r=document.createElement("div");r.title=t,r.className="wux-layouts-treeview-badge wux-ui-3ds wux-ui-3ds-filter wux-ui-3ds-lg",r.style="visibility: visible; top: 15px; left:45px",i.appendChild(r)}function z(e,t,i){if(null==e.parent||e.parent.toString().startsWith("NOVAL_LIST"))e.parent=null,t.push(e);else{var r=i[e.parent];null==r?(console.error("FTree>>  ****** FAILED TO FIND PARENT ("+e.parent+") WHILE BUILDING FANCYTREE *****"),console.error("FTree>>  ****           THIS SHOULD NEVER HAPPEN                ****")):("children"in r||(r.children=[],r.folder=!0,r.expanded=!0),r.children.push(e))}}function K(e,i){var r=i.node,a=4==r.tree.columnCount,n=0,o=r.data.isLeaf;if(r.displayState=r.parent&&(null==r.parent.expanded||null!=r.parent.expanded&&!0===r.parent.expanded)&&r.data.displayState,r.data.fancyTreeNode=r,r.data.matchRow.matchRow.fancyTreeNode=r,r.data.matchRow.matchRow.displayState=r.displayState,r.previousExpandState=r.expanded,o?t(r.tr).attr("isLeaf",!0):t(r.tr).attr("isLeaf",!1),a)var s=n++;var l=n++,c=n++,d=n++,p=t(r.tr).find(">td");if(a){s=0;for(var h="",f=r.data.compareStatus.differences,m=0;m<f.length;m++){var g=f[m];h+='<span class="compare-status-flag" diff-id="'+g.id+'" style="background-color:'+g.color+'"></span>'}if(0==f.length)h+='<span class="compare-status-flag" diff-id="same" style="background-color:'+u.same.color+'"></span>';p.eq(s).html(h);var v=5*i.options.source.maxFlagsPerRow+1;t(p.eq(s)).width(v+"px"),t(p.eq(s)).addClass("compare-status-flags")}if(t(p.eq(c)).addClass("title-field"),t(p.eq(d)).addClass("revision-field"),null!=r.data.compareData){var y=r.data.compareData.title,b=r.data.compareData.revision,C=(r.data.compareData.physicalid,r.data.compareData.name),w=r.key;if(N){var S=r.data.compareData.quantity;p.eq(l).html("<span>"+S+"</span>"),t(p.eq(l)).addClass("quantity-field")}else p.eq(l).html("<span>&nbsp;</span>"),t(p.eq(l)).addClass("quantity-field-hidden");null!=b&&(p.eq(d).html("<span>"+b+"</span>"),t(p.eq(d)).addClass("revision-field"),t(p.eq(d)).attr("id",w)),null!=y&&(null!=C&&t(p.eq(c)).attr("id",C),t(p.eq(c)).attr("title",y),t(p.eq(c)).addClass("title-field"))}else p.eq(c).html('<span class="fancytree-node"       style="padding-left: 20px;"><span class="fancytree-expander" style="display:none;"></span><span class="fancytree-title"    style="display:inline;">&nbsp;</span></span>'),p.eq(d).html("<span>&nbsp;</span>"),p.eq(l).html("<span>&nbsp;</span>"),N?t(p.eq(l)).addClass("quantity-field"):t(p.eq(l)).addClass("quantity-field-hidden")}function X(){t("#structure-treetable-right.fancytree-ext-table tr:visible:odd").removeClass("compare_row_even").addClass("compare_row_odd"),t("#structure-treetable-right.fancytree-ext-table tr:visible:even").removeClass("compare_row_odd").addClass("compare_row_even"),t("#structure-treetable-left.fancytree-ext-table tr:visible:odd").removeClass("compare_row_even").addClass("compare_row_odd"),t("#structure-treetable-left.fancytree-ext-table tr:visible:even").removeClass("compare_row_odd").addClass("compare_row_even")}function Y(e){for(var t={},i=0;i<e.length;i++){Z(e[i],t)}return t}function Z(e,t){if(t[e.key]=e,null!=e.children)for(var i=0;i<e.children.length;i++)Z(e.children[i],t)}function $(e){for(var t=[],i=0;i<e.length;i++)t.push(e[i].id);return t}function ee(e,t,i){for(var r=0;r<t.length;r++){var a=t[r];-1==e.indexOf(a)&&i.push(a)}}function te(e,t){var i=$(e),r=($(t),[]);return ee(i,t,r),ee(t,i,r),r}function ie(e,t){for(var i={},r=Y(e),a=Y(t),n=Object.keys(r),o=0;o<n.length;o++){var s=n[o],l=r[s],c=a[s];if(null!=c.compareData&&null!=l.data.compareData){for(var d=l.data.compareData.compareStatus.differences,u=c.compareData.compareStatus.differences,p=te(d,u),h=0;h<p.length;h++){var f=p[h];i[f]=i[f]||[],i[f].push(l)}l.data.compareData.compareStatus.differences=[],l.data.compareData.compareStatus.differences.push.apply(l.data.compareData.compareStatus.differences,u)}}return i}return V.prototype._crNode2treeRowNode=function(e,t,i,r,n){var o={key:"index_"+e},s={key:"index_"+e},l=P+a.getObjTypeIconPath("Missing");switch(t.matchresult){case"MATCH_ONLY_0":o.title=t.title,o.name=t.name,o.objectId=null!=t.occNdx?t.occNdx:e,o.parent=-1==t.parentOccNdx?void 0:t.parentOccNdx,o.icon=null!=t.icon?t.icon.contains("://")?t.icon:t.icon.substring(1):a.getObjTypeIconPath(t.type),o.thumbnail=t.thumbnail,o.compareData=t,o.isRoot=n?t.isRoot:-1==t.parentOccNdx,o.isLeaf=t.isLeaf,s.title="",s.name="",s.objectId="dummy_"+e,s.icon="",s.thumbnail=l,s.parent=i[o.parent],s.compareData=null,s.isRoot=!1,s.isLeaf=!1,s.compareStatus=new d({matched:!1,differences:[u.lo]});break;case"MATCH_ONLY_1":s.title=t.title,s.name=t.name,s.objectId=null!=t.occNdx?t.occNdx:e,s.parent=-1==t.parentOccNdx?void 0:t.parentOccNdx,s.icon=null!=t.icon?t.icon.contains("://")?t.icon:t.icon.substring(1):a.getObjTypeIconPath(t.type),s.thumbnail=t.thumbnail,s.compareData=t,s.isRoot=n?t.isRoot:-1==t.parentOccNdx,s.isLeaf=t.isLeaf,o.title="",o.name="",o.objectId="dummy_"+e,o.icon="",o.thumbnail=l,o.parent=r[s.parent],o.compareData=null,o.isRoot=!1,o.isLeaf=!1,s.compareStatus=new d({matched:!1,differences:[u.ro]});break;default:o.title=t.title,o.name=t.name,o.objectId=null!=t.occNdx?t.occNdx:e,o.parent=-1==t.parentOccNdx?void 0:t.parentOccNdx,o.icon=null!=t.icon?t.icon.contains("://")?t.icon:t.icon.substring(1):a.getObjTypeIconPath(t.type),o.thumbnail=t.thumbnail,o.compareData=t,o.isRoot=n?t.isRoot:-1==t.parentOccNdx,o.isLeaf=t.isLeaf,s.title=t.obj2.title,s.name=t.obj2.name,s.objectId=null!=t.obj2.occNdx?t.obj2.occNdx:e,s.parent=-1==t.obj2.parentOccNdx?void 0:t.obj2.parentOccNdx,s.icon=null!=t.obj2.icon?t.obj2.icon.contains("://")?t.obj2.icon:t.icon.substring(1):a.getObjTypeIconPath(t.obj2.type),s.thumbnail=t.obj2.thumbnail,s.compareData=t.obj2,s.isRoot=n?t.isRoot:-1==t.parentOccNdx,s.isLeaf=t.obj2.isLeaf,s.compareStatus=t.obj2.compareStatus}return s.displayState=!0,o.displayState=!0,o.matchRow=s,s.matchRow=o,{left:o,right:s}},V.prototype._countMaxFlagsPerRow=function(e){for(var t=0,i=0;i<e.length;i++){var r=e[i];if(null!=r){var a=r.compareStatus.differences.length;a>t&&(t=a)}}return t},V.prototype._getCheckedCompareStatusLegendIds=function(){for(var e=[],t=0;t<this.legendCheckboxes.length;t++){var i=this.legendCheckboxes[t],r=i.data;i.checked&&e.push(r.id)}return e},V.prototype._allStatusesChecked=function(){var e=!0;if(void 0!==this.legendCheckboxes&&null!==this.legendCheckboxes)for(var t of this.legendCheckboxes)t.checked||(e=!1);return e},V.prototype._filterRowsByCompareStatus=function(e){var t=this._getCheckedCompareStatusLegendIds();if(e)G(e,t,!1);else if(this._isListView)G(this.fTreeData_right[0],t,this._isListView);else for(var i=0;i<this.fTreeData_right[0].length;i++){var r=this.fTreeData_right[0][i],a=r.matchRow.fancyTreeNode.data;r.displayState=!0,a.displayState=r.displayState,r.fancyTreeNode.displayState=r.displayState,a.fancyTreeNode.displayState=a.displayState,r.fancyTreeNode.tr.style.display="",a.fancyTreeNode.tr.style.display="",G(r,t)}},V.prototype._buildLegend=function(){var i=this.legendElement,r=this.trNodeArray_right;this.legendCheckboxes=[];var a={};for(var n in r){for(var s=r[n].compareStatus,l=0;l<s.differences.length;l++){"ign"!=(h=s.differences[l]).id&&(a[h.id]=h)}if(0==s.differences.length){var c=u.same;a[c.id]=c}}i.innerHTML="";var d=e.createElement("div",{class:"legend"});d.inject(i),e.createElement("div",{styles:{"padding-left":"10px","padding-right":"10px"},html:"<b>"+o.CompareStatus+"</b>"}).inject(d);var p=this;for(var l in a){var h=a[l],f=e.createElement("label",{class:"status-legend-item"});f.inject(d);var m=e.createElement("input",{type:"checkbox",checked:"checked",id:"checkBoxID_"+h.id.toUpperCase()});m.data=h,this.legendCheckboxes.push(m),m.addEventListener("click",function(e){p._filterRowsByCompareStatus(),X(),t("#compare-content").trigger("compareStructureLegendCheckedChangeEvent",{legendCount:p.legendCheckboxes.length,checkedDiffIds:p._getCheckedCompareStatusLegendIds()}),t("#compare-content").trigger("geometryHideShowEvent",{leftTree:p.fTree_left,rightTree:p.fTree_right})});var g=e.createElement("span",{class:"diff-type-legend",styles:{"background-color":h.color}}),v=e.createElement("div",{class:"status-legend-itemtext",html:h.label});m.inject(f),g.inject(f),v.inject(f)}t("#compare-content").trigger("compareStructureLegendCheckedChangeEvent",{legendCount:p.legendCheckboxes.length,checkedDiffIds:p._getCheckedCompareStatusLegendIds()})},V.prototype._showCompareResults=function(r,a,n,l,c){for(var d,u=0,h=1;h<r.length;++h)r[h].length>u&&(u=r[h].length);this.fTreeData_left=[],this.fTreeData_right=[];for(h=1;h<r.length;++h){var m=r[h],v=[],y=[],b=[],C=[];this.trNodeArray_right=C,this.fTreeData_right[h-1]=[];for(var N=0;N<u;N+=1){var P=m[N],R=this._crNode2treeRowNode(N,P,v,y,l),L=R.left.objectId,W=R.right.objectId;v[L]=W,y[W]=L,b[L]=R.left,C[W]=R.right,1===h&&z(R.left,this.fTreeData_left,b),z(R.right,this.fTreeData_right[h-1],C)}}null!==this.loadingGif&&void 0!==this.loadingGif&&this.loadingGif.hide(),!1===l&&"CompareWidgetSimuliaWebInWin"!==widget.appId&&(J(b),J(C)),d=this,this.targetElement.setContent(t(' <div id="compare-tree-base">  <table class="table table-striped table-condensed" id="structure-treetable-left" >   <thead class="hidden"><tr><th></th><th></th><th></th></tr></thead>   <tbody>    <tr><td></td></tr>   </tbody>  </table> </div> <div id="compare-tree-column-separator"> </div> <div id="compare-tree-to-1">  <table class="table table-condensed table-striped" id="structure-treetable-right" >   <thead class="hidden"><tr><th></th><th></th><th></th><th></th></tr></thead>   <tbody>    <tr><td></td><td></td></tr>   </tbody>  </table> </div> <div id="compare-tree-to-2">  <table class="table table-condensed table-striped hidden" id="structure-treetable-right-2" >   <thead class="hidden"><tr><th></th><th></th><th></th><th></th></tr></thead>   <tbody>    <tr><td></td><td></td></tr>   </tbody>  </table> </div> <div id="compare-tree-to-3">  <table class="table table-condensed table-striped hidden" id="structure-treetable-right-3" >   <thead class="hidden"><tr><th></th><th></th><th></th><th></th></tr></thead>   <tbody>    <tr><td></td><td></td></tr>   </tbody>  </table> </div> <div id="compare-tree-to-4">  <table class="table table-condensed table-striped hidden" id="structure-treetable-right-4" >   <thead class="hidden"><tr><th></th><th></th><th></th><th></th></tr></thead>   <tbody>    <tr><td></td><td></td></tr>   </tbody>  </table> </div> <div id="compare-tree-to-5">  <table class="table table-condensed table-striped hidden" id="structure-treetable-right-5" >   <thead class="hidden"><tr><th></th><th></th><th></th><th></th></tr></thead>   <tbody>    <tr><td></td><td></td></tr>   </tbody>  </table> </div>')),0==O&&(s.attachObject("compare-tree-base",d.compareContent,function(){t("#structure-treetable-left").addClass("ft-drop-cue-on"),t("#model-color-left").addClass("ft-drop-cue-on")},function(){t("#structure-treetable-left").removeClass("ft-drop-cue-on"),t("#model-color-left").removeClass("ft-drop-cue-on")},d.compareContent.dropHandler2),s.attachObject("compare-tree-to-1",d.compareContent,function(){t("#structure-treetable-right").addClass("ft-drop-cue-on"),t("#model-color-right").addClass("ft-drop-cue-on")},function(){t("#structure-treetable-right").removeClass("ft-drop-cue-on"),t("#model-color-right").removeClass("ft-drop-cue-on")},d.compareContent.dropHandler2)),Q("div#compare-tree-column-separator").mousedown(function(e){w=e.pageX,S=document.getElementById("compare-tree-base").clientWidth,D=document.getElementById("compare-tree-column-separator").clientWidth,_=document.getElementById("compare-tree-to-1").clientWidth,T=S+D+_,null!==document.getElementById("meta-datacell-base")&&(E=document.getElementById("meta-datacell-base").clientWidth,A=document.getElementById("meta-datacell-rowlabel").clientWidth,I=document.getElementById("meta-datacell-to-1").clientWidth,x=E+A+I),e.stopPropagation(),e.preventDefault(),Q("div#compare-region-left").bind("mousemove",function(e){if(0==e.buttons)Q("div#compare-region-left").unbind("mousemove");else{var t=e.pageX-w,i=(S+t)/T*100,r=(_-t)/T*100;if(i>4&&i<96&&(document.getElementById("compare-tree-base").style.width=i+"%",document.getElementById("compare-tree-to-1").style.width=r+"%"),null!==document.getElementById("meta-datacell-base")){var a=E+t,n=I-t,o=a/x*100,s=n/x*100;a>144&&n>148&&(document.getElementById("meta-datacell-base").style.width=o+"%",document.getElementById("meta-datacell-to-1").style.width=s+"%")}var l=document.getElementById("compare-tree-base").style.width,c=document.getElementById("compare-tree-to-1").style.width;document.getElementById("model-color-left").style.width=l,document.getElementById("model-color-right").style.width=c}}),t(window).bind("mouseup",function(e){Q("div#compare-region-left").unbind("mousemove"),t(window).unbind("mouseup")})}),this.JSONObjViewerArray=c,this._isListView=l;var j=this,V={left:j.fTreeData_left,right:j.fTreeData_right[0]};function F(){j._buildLegend(),j.fTreeData_right[0].maxFlagsPerRow=j._countMaxFlagsPerRow(C);var s=t("#model-color-window");null!=s&&s.show(),j.fTree_left=j._createFancyTree("#structure-treetable-left",j.fTreeData_left,1,K).fancytree("getTree");for(var l=1;l<r.length;++l){var c="#structure-treetable-right";l>1&&(c+="-"+l),j.fTree_right[l-1]=j._createFancyTree(c,j.fTreeData_right[l-1],l+1,K).fancytree("getTree")}null!=a[0]&&q(j.fTree_left,a[0]),null!=a[1]&&q(j.fTree_right[0],a[1]);var d=t("#structure-treetable-right").height(),u=t("#structure-treetable-left").height();d<u&&(d=u),t("#compare-tree-column-separator").height(d),X();var h=r[1];j.fTree_left,j.fTree_right;j.tenant="undefined"!=typeof widget&&widget?widget.getValue("x3dPlatformId"):null,null!=j.tenant&&""!=j.tenant||(j.tenant="OnPremise"),j.crnArray=h,j.url=i.getWebappsAssetUrl("ENXNav","icons/32/I_OpenWith.png"),g.subscribe("setTypesCallback",U);var m={securityContext:j.securityContext,crnArray:j.crnArray,tenant:j.tenant,url:j.url,me:j};t(".title-field").on("contextmenu",m,function(i){console.log("right click on right tree"),i.data.me._isListView||null!=i.currentTarget&&null!=i.currentTarget.getParent()&&null!=i.currentTarget.getParent().className&&(i.currentTarget.getParent().className.contains("fancytree-active")||t(i.currentTarget).trigger("click"),function(t){t.isRightTreeClicked=t.currentTarget.offsetParent.id.contains("right");for(var i=function(e){var t=[];if(e.data.me.listSelectedNodes.length>0){var i=e.data.me.listSelectedNodes[0].orgTargetRight;for(const n of e.data.me.listSelectedNodes){var r=n.node,a=e.isRightTreeClicked!==i?r.data.matchRow.compareData:r.data.compareData;null!=a&&t.push(a)}}return t}(t),r=t.isRightTreeClicked?t.data.me.JSONObjViewerArray[1].mapOccurrenceToPath:t.data.me.JSONObjViewerArray[0].mapOccurrenceToPath,a=t.isRightTreeClicked?t.data.me.JSONObjsArray[1].occurrences:t.data.me.JSONObjsArray[0].occurrences,n=function(e){for(var t=e.isRightTreeClicked?e.data.me.JSONObjsArray[1]:e.data.me.JSONObjsArray[0],i={},r=0;r<t.nodes.length;r++){var a=t.nodes[r];i[a.physicalid]=a.type}return i}(t),o=[],s=[],l=0;l<i.length;l++){var c=i[l];s.push(c.type);for(var d=r[a.findIndex(e=>e.occurrenceid===c.occNdx)],u=[],p=0;p<d.length;p++){var h=d[p],f={resourceid:h,type:n[h]||"VPMInstance"};u.push(f)}var m={objectId:c.physicalid,objectType:c.type,displayName:c.title,path:u};o.push(m)}return new e.Class.Promise(function(e,i){require(["DS/PADUtils/PADTypesMgt"],function(i){i.retrieveHierarchy(s,function(i){var r=function(e,i){var r=s;return i&&i[s[0]]&&(r=i[s[0]]),{envId:t.data.tenant,serviceId:"3DSpace",contextId:t.data.securityContext,objectId:e.objectId,objectType:e.objectType,objectTaxonomies:r,displayName:e.displayName,path:e.path}},a={protocol:"3DXContent",version:"1.1",source:"ENOCOMP_AP",widgetId:widget.id,data:{items:[]}};o.forEach(function(e){a.data.items.push(r(e,i))}),e(a)})})})}(i).then(function(t){let r=!1;null!=i.currentTarget&&null!=i.currentTarget.getParent()&&null!=i.currentTarget.getParent().className&&(r=!i.currentTarget.getParent().className.contains("fancytree-has-children")),function(t,i,r,a,n,s){if(!(void 0===i.data.items||null===i.data.items||i.data.items.length<1)){var l="3DShape"==i.data.items[0].path[0].type,c="3dportfolio"===i.data.items[0].path[0].type,d=[];if(s||(d.push({type:"CheckItem",title:o.ExpandAll,tooltip:o.ExpandAllTip,fonticon:{content:"wux-ui-3ds wux-ui-3ds-lg wux-ui-3ds-flow-tree-expand-down"},action:{callback:t.expandNodeAll,context:t.compareContent}}),d.push({type:"CheckItem",title:o.ExpandNLevels,tooltip:o.ExpandNLevelsTip,fonticon:{content:"wux-ui-3ds wux-ui-3ds-lg wux-ui-3ds-flow-tree-expand-down-cog"},action:{callback:t.expandNodeLevels,context:t.compareContent}}),d.push({type:"CheckItem",title:o.CollapseAll,tooltip:o.CollapseAllTip,fonticon:{content:"wux-ui-3ds wux-ui-3ds-lg wux-ui-3ds-flow-tree-expand-up"},action:{callback:t.collapseNodeAll,context:t.compareContent}}),d[t.compareContent.currentExpandState].state="selected"),l||c||widget.isWebInWin)H(t,[],d,r,a,n);else{var u=new f;if(u.set3DXContent(i,!0),e.is(u.retrieveCompatibleApps,"function")){var p=[];u.retrieveCompatibleApps(function(e){e.forEach(function(e){e.text.contains("CATIA V5")&&p.push({type:"PushItem",title:e.text,fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-"+e.fonticon},action:{callback:e.handler}})}),H(t,p,d,r,a,n)})}else H(t,[],d,r,a,n)}}}(j,t,i.clientX,i.clientY,i.data.url,r)}))});n(!0),widget.dispatchEvent("ENOLCM/CompareWidget/structCompareDoneEvent_forODTs","Struct Compare"),p.mark({id:"Compare_Struct",str:"  [END] Compare Structure",comment:"*** struct compare should be fully displayed ***"}),j.compareContent.unmaskStructure()}"CompareWidgetSimuliaWebInWin"==widget.appId?this.compareContent.simuliaComparePlugin.initCustomCompare(V,F):F()},V.prototype._createFancyTree=function(e,i,r,a){return t(e).fancytree({extensions:["table"],checkbox:!1,table:{indentation:20,nodeColumnIdx:r},imagePath:P+"/",source:i,deep:!0,renderColumns:a,activate:this.onActivate.bind(this),expand:this.onExpand.bind(this),collapse:this.onCollapse.bind(this)})},V.prototype._setExpanded=function(e,i){if(e.node.previousExpandState!==i){null!=e.originalEvent&&e.node.data.matchRow.fancyTreeNode.setExpanded(i);var r=t("#structure-treetable-right").height(),a=t("#structure-treetable-left").height();r<a&&(r=a),t("#compare-tree-column-separator").height()!==r&&t("#compare-tree-column-separator").height(r),null!=this.tenant&&""!=this.tenant||(this.tenant="OnPremise"),e.node.previousExpandState=i,void 0===e.originalEvent&&(e.node.data.compareStatus&&Array.isArray(e.node.data.compareStatus.differences)&&e.node.data.compareStatus.differences.length?this._filterRowsByCompareStatus(e.node.data.matchRow.matchRow):e.node.data.matchRow.compareStatus&&Array.isArray(e.node.data.matchRow.compareStatus.differences)&&e.node.data.matchRow.compareStatus.differences.length&&this._filterRowsByCompareStatus(e.node.data.matchRow),X())}},V.prototype._doActivate=function(e){var i=this._getOtherTree(e.tree).getNodeByKey(e.node.key);if(null!=e.isListView&&e.isListView&&(e.ctrlKey=!1,e.node.multiSelect=!1),e.ctrlKey||e.node.multiSelect){if(null!=e&&(null==e.node.otherNode||0==e.node.otherNode)&&!e.node.multiSelect){for(var r=e.node.key,a=!1,n=0;n<this.listSelectedNodes.length;n++){r==this.listSelectedNodes[n].node.key&&(a=!0,t(e.node.tr).hasClass("fancytree-active")&&(this.listSelectedNodes.splice(n,1),--n))}t(e.node.tr).hasClass("fancytree-active")&&(t(e.node.tr).removeClass("fancytree-active"),t(i.tr).hasClass("fancytree-active")&&t(i.tr).removeClass("fancytree-active")),a||this.listSelectedNodes.push(e)}}else{if(null==e.node.otherNode||0==e.node.otherNode)switch(e.ctrlKey){case!0:break;case!1:if(void 0!==e.node.multiSelect){if(!e.node.multiSelect&&this.listSelectedNodes.length>0)for(n=0;n<this.listSelectedNodes.length;n++){var o=this.listSelectedNodes[n],s=this._getOtherTree(o.tree).getNodeByKey(o.node.key);t(o.node.tr).removeClass("fancytree-active"),t(s.tr).removeClass("fancytree-active")}}else if(this.listSelectedNodes.length>0)for(n=0;n<this.listSelectedNodes.length;n++){o=this.listSelectedNodes[n],s=this._getOtherTree(o.tree).getNodeByKey(o.node.key);t(o.node.tr).removeClass("fancytree-active"),t(s.tr).removeClass("fancytree-active")}break;case void 0:if(void 0!==e.node.multiSelect&&!e.node.multiSelect&&this.listSelectedNodes.length>0)for(n=0;n<this.listSelectedNodes.length;n++){o=this.listSelectedNodes[n],s=this._getOtherTree(o.tree).getNodeByKey(o.node.key);t(o.node.tr).removeClass("fancytree-active"),t(s.tr).removeClass("fancytree-active")}}null!=e.node.multiSelect&&0!=e.node.multiSelect||null!=e.node.otherNode&&0!=e.node.otherNode||(this.listSelectedNodes=[],null!=e&&(e.orgTargetRight=!1,void 0!==e.originalEvent&&null!==e.originalEvent&&(e.orgTargetRight=e.originalEvent.currentTarget.id.contains("-right")),this.listSelectedNodes.push(e),t(e.node.tr).addClass("fancytree-active"),t(i.tr).addClass("fancytree-active")))}if(e.ctrlKey||e.node.multiSelect){if(e.node.multiSelect){var c=document.getElementById("compare-tree-base");if(null!==c){var d=c.getElementsByClassName("fancytree-active");if(null!==d)for(n=0;n<d.length;n++)t(d[n].ftnode.tr).removeClass("fancytree-active")}var u=document.getElementById("compare-tree-to-1");if(null!==u){var p=u.getElementsByClassName("fancytree-active");if(null!==p)for(n=0;n<p.length;n++)t(p[n].ftnode.tr).removeClass("fancytree-active")}}for(n=0;n<this.listSelectedNodes.length;n++){o=this.listSelectedNodes[n],s=this._getOtherTree(o.tree).getNodeByKey(o.node.key);t(o.node.tr).addClass("fancytree-active"),t(s.tr).addClass("fancytree-active")}}if(t(e.node.tr).addClass("info"),e.tree._id===this.fTree_left._id?t(e.node.tr).addClass("leftActive"):t(e.node.tr).addClass("rightActive"),e.ctrlKey||e.node.multiSelect?i.multiSelect=!0:i.multiSelect=!1,i.otherNode=!0,i.setActive(),i.multiSelect=!1,i.otherNode=!1,!0,e.tree._id===this.fTree_left._id){var h=[];for(n=0;n<this.listSelectedNodes.length;++n){var f=this.listSelectedNodes[n].node.key;h[n]=e.tree.getNodeByKey(f)}var m=this._getOtherTrees(e.tree),g=[],v=0;for(n=0;n<m.length;++n){v=n*this.listSelectedNodes.length;for(var y=0;y<this.listSelectedNodes.length;++y){f=this.listSelectedNodes[y].node.key;g[v]=m[n].getNodeByKey(f),++v}}l.jQueryTriggerAsync("#compare-content","updateWidgetViewStateEvent",{buttonUpdateOnly:!1}),l.jQueryTriggerAsync("#compare-content","newRowSelectedEvent",{left:e.node,right:g,leftTree:e.tree,rightTree:m}),l.jQueryTriggerAsync("#compare-content","newRowSelectedEvent_3Dviewer",{left:h,right:g,leftTree:e.tree,rightTree:m})}},V.prototype.onActivate=function(e,t){t.ctrlKey=e.ctrlKey,t.isListView=this._isListView,this._doActivate(t)},V.prototype.onExpand=function(e,t){this._setExpanded(t,!0)},V.prototype.onCollapse=function(e,t){this._setExpanded(t,!1)},V.prototype.compareUsingJSONObjs=function(e,t,i,a,o,s){this.JSONObjsArray=a,p.mark({id:"ENTIRE_Compare_Struct",str:"[BEGIN] ENTIRE PROCESS FOR Structure Compare"});var l;N=e,l=widget.getValue("x3dPlatformId"),P=r.get3DSpaceBaseUrl(l),!1;for(var h=[],f=[],m=[],g=0;g<a.length;++g)h[g]=a[g].nodes,f[g]=a[g].occurrences,m[g]=a[g].occurrencerelationships;p.mark({id:"structCompCalc",str:"[BEGIN] Struct Compare Compute "});var v=[];for(g=0;g<a.length;++g)v[g]=e?M(g,h[g],f[g],m[g]):F(g,h[g],f[g],m[g]);var y=[],b=!1;(a.length>2||t)&&(b=!0);for(g=1;g<a.length;++g){if(b){var C=v[0];C[0].matchNdx=0,C[0].matchSet=[];for(var w=v[g],S=0;S<w.length;S++)w[S].matchNdx=S,w[S].relType=new d({matched:!0,differences:[u.simi]})}else c.evalAssemblies(e,v[0],v[g],i);y[g]=B(v[0],h[0],f[0],v[g],h[g],f[g])}p.mark({id:"structCompCalc",str:"  [END] Struct Compare Compute     ",comment:"*** Struct Compare fully computed ***"}),p.mark({id:"structCompShow",str:"[BEGIN] Struct Compare Display"});var D=[null,null];for(g=0;g<2;g++)1==a[g].isFilter&&(D[g]=a[g].filterName);this._showCompareResults(y,D,s,N,o),R=[];for(g=0;g<f.length;g++)R[g]=new n(f[g]);p.mark({id:"structCompShow",str:"  [END] Struct Compare Display     ",comment:"*** Struct Compare should now be fully displayed ***"}),p.mark({id:"ENTIRE_Compare_Struct",str:"  [END] ENTIRE PROCESS FOR Structure Compare"})},V.prototype.refresh=function(e){e&&!1,this.targetElement&&(this.targetElement=null),this.legendElement&&(this.legendElement.destroy(),this.legendElement=null)},V.prototype._onViewerSelection=function(e,i){if("select"===widget.getValue("viewer_display_mode")){var r=i.length;if(r>0){var a=this.fTreeData_left.length;if(0==a)return;for(var n=0;n<r;++n){var o=w(i[n].pathElement.externalPath),s=o.path.length,l=null,c=null,d=null,u=!1;if(this._isListView)for(var p=0;p<a;++p)o.searchLeft&&null!=this.fTreeData_left[p].compareData&&o.path[s-1]==this.fTreeData_left[p].compareData.physicalid?(l=this.fTree_left,c=this.fTreeData_left[p],d=this.fTree_right[0]):o.searchRight&&null!=this.fTreeData_right[0][p].compareData&&o.path[s-1]==this.fTreeData_right[0][p].compareData.physicalid&&(l=this.fTree_right[0],c=this.fTreeData_right[0][p],d=this.fTree_left,u=!0);else if(o.searchLeft&&o.path[0]==this.fTreeData_left[0].compareData.physicalid)l=this.fTree_left,c=this.fTreeData_left[0],d=this.fTree_right[0];else if(o.searchRight){var h=0;null!==this.fTreeData_right[0][h].compareData||this.fTreeData_right[0][h].compareStatus.matched||(h=1),o.path[0]==this.fTreeData_right[0][h].compareData.physicalid&&(l=this.fTree_right[0],c=this.fTreeData_right[0][h],d=this.fTree_left,u=!0)}var f,m,g={foundOne:"",foundOther:""};if(1==s||this._isListView)g.foundOne=c.key,g.foundOther=c.matchRow.key;else{g=S(o.path,1,c)}if(null!=l&&""!==g.foundOne&&(f=l.getNodeByKey(g.foundOne),null!=e[0].event&&null!=e[0].event&&"Mouse"==e[0].event.type))for(;null!=f&&!f.isVisible();)f=f.getParent();if(null==f)return;if(null!=d&&""!==g.foundOther&&(m=d.getNodeByKey(g.foundOther),null!=e[0].event&&null!=e[0].event&&"Mouse"==e[0].event.type))for(;null!=m&&!m.isVisible();)m=m.getParent();if(0==n){D(this);var v={noEvents:!0};f.setActive(!0,v),m.setActive(!0,v);var y=u?m:f,b=[];b.push(u?f:m),t("#compare-content").trigger("newRowSelectedEvent",{left:y,right:b,leftTree:this.fTree_left,rightTree:this.fTree_right})}else t(f.tr).addClass("fancytree-active"),t(m.tr).addClass("fancytree-active");var C={node:f,tree:f.tree,orgTargetRight:u};this.listSelectedNodes.push(C)}}else D(this);t("#compare-content").trigger("updateWidgetViewStateEvent",{buttonUpdateOnly:!1,forceGetSelections:r>0,autoScrollToActive:!1})}function w(e){for(var t={path:[],searchLeft:!0,searchRight:!0},i=e.length,r=1;r<i;++r){var a=e[r];""===a.name&&void 0!==a._id&&(a._id.endsWith("_RIGHT")?(t.searchLeft=!1,t.path.push(a._id.substring(0,a._id.length-6))):a._id.endsWith("_LEFT")?(t.searchRight=!1,t.path.push(a._id.substring(0,a._id.length-5))):t.path.push(a._id))}return t}function S(e,t,i){++t;for(var r={},a=i.children.length,n=0;n<a;++n){var o=i.children[n];if(null!=o&&null!=o.compareData&&e[2*t-3]==o.compareData["physicalid[connection]"]&&e[2*t-2]==o.compareData.physicalid){var s=e.length;s==2*t-1?(r.foundOne=o.key,r.foundOther=o.matchRow.key):s>2*t-1&&(r=S(e,t,o))}}return--t,r}function D(e){var i=e.fTree_left,r=e.fTree_right[0],a=null!=i?i.activeNode:null,n=null!=r?r.activeNode:null,o={noEvents:!0};for(null!=a&&a.setActive(!1,o),null!=n&&n.setActive(!1,o);e.listSelectedNodes.length>0;){var s=e.listSelectedNodes.pop(),l=i.getNodeByKey(s.node.key),c=r.getNodeByKey(s.node.key);t(l.tr).removeClass("fancytree-active"),t(c.tr).removeClass("fancytree-active")}}},V.prototype.setViewerSelectionOptions=function(e){this.onlySelectVisible=e.onlySelectVisible},V.prototype.expandNodeAll=function(e){e.context.expandNodeAll()},V.prototype.expandNodeLevels=function(e){e.context.expandNodeLevels({position:j})},V.prototype.collapseNodeAll=function(e){e.context.collapseNodeAll()},V.prototype.updateLegends=function(){this._buildLegend()},V.prototype.updateDiffFlags=function(){for(var e=[],i=t("#structure-treetable-right")[0].tBodies[0].rows,r=0;r<i.length;r++){var a=i[r];this.updateDiffTagsForRow(a)&&e.push(a.ftnode.key)}return e},V.prototype.updateDiffTagsForRow=function(e){var i=t(e).find(">td"),r=t(e).find(".compare-status-flag"),a="";void 0!==r&&null!=r&&1==r.length&&(a=r[0].getAttribute("diff-id")),i.eq(0).html("");for(var n=e.ftnode.data.compareStatus.differences,o="",s=0;s<n.length;s++){var l=n[s];o+='<span class="compare-status-flag" diff-id="'+l.id+'" style="background-color:'+l.color+'"></span>'}0==n.length&&(o+='<span class="compare-status-flag" diff-id="same" style="background-color:'+u.same.color+'"></span>');i.eq(0).html(o);var c="";return void 0!==(r=t(e).find(".compare-status-flag"))&&null!=r&&1==r.length&&(c=r[0].getAttribute("diff-id")),a!==c},V.prototype.updateCompareResultData=function(e){var i=t("#structure-treetable-left").fancytree("getTree"),r=ie(t("#structure-treetable-left").fancytree("getTree").rootNode.children,e.right);return ie(i.rootNode.children,e.left),r},V.prototype.updateCompareResultUI=function(){return this.updateLegends(),this.updateDiffFlags()},V}),define("DS/CompareWidget/CompareReport",["UWA/Class","DS/CompareCommon/Utils","DS/CompareWidgetUtils/CompareExporter","DS/LifecycleServices/LifecycleServicesSettings","DS/CompareCommon/CompareAlert","DS/CompareWidget/CompareStatusDiffs","i18n!DS/CompareWidgetUtils/assets/nls/CompareExport"],function(e,t,i,r,a,n,o){var s=e.extend({init:function(e,t,i,r){this._parent({}),this.loadingAllAttributes=!1,this.tableCompare=e,this.leftTree=t,this.rightTree=i,this.attrNotAvlSym=r.attrNotAvlSym,null==this.attrNotAvlSym&&(this.attrNotAvlSym="n/a"),this.attrGroupBySide=r.attrGroupBySide},doExport:function(e,i){var r=this.formatCompareResult(),a=this.getAllIds(r);if(e)t.loadAttrs(a.refids,a.svcids,a.insids,[0],function(e){var t=this.formatAttrs(e);this.exportListView(r,t),i()}.bind(this));else{var n=[0,1];widget.propertiesCompareDisplayEffectivity&&n.push(2),t.loadAttrs(a.refids,a.svcids,a.insids,n,function(e){var t=this.formatAttrs(e);this.exportTreeView(r,t),i()}.bind(this))}},getAttrVals:function(e,t,i,r,a){for(var n=[],o=i.length,s=0;s<o;s++){var l=e?"":this.attrNotAvlSym;n.push(l)}if(null!=t){var c=r[a][t];if(null!=c)for(s=0;s<o;s++){null==(l=c[i[s]])&&(l=this.attrNotAvlSym),n[s]=l}}return n},addGroupByPairAttrValsToCsvRow:function(e,t,i){for(var r=e.length,a=0;a<r;a++){var n=e[a],o=t[a];i.push(n),i.push(o)}},exportTreeViewRow:function(e,t,i,r,a){var n=[e.status,e.level],o=null==e.right.reference.id,s=null==e.left.reference.id,l=t.idAttrsMap,c=this.getAttrVals(s,e.left.reference.id,i,l,"bus"),d=this.getAttrVals(o,e.right.reference.id,i,l,"bus"),u=this.getAttrVals(s,e.left.instance.id,r,l,"connection"),p=this.getAttrVals(o,e.right.instance.id,r,l,"connection"),h=this.getAttrVals(s,e.left.instance.id,a,l,"effectivity"),f=this.getAttrVals(o,e.right.instance.id,a,l,"effectivity");return this.attrGroupBySide?n=(n=(n=(n=(n=(n=n.concat(c)).concat(u)).concat(h)).concat(d)).concat(p)).concat(f):(this.addGroupByPairAttrValsToCsvRow(c,d,n),this.addGroupByPairAttrValsToCsvRow(u,p,n),this.addGroupByPairAttrValsToCsvRow(h,f,n)),n},exportListViewRow:function(e,t,i){var r=[e.status],a=null==e.right.reference.id,n=null==e.left.reference.id,o=this.getAttrVals(n,e.left.reference.id,i,t.idAttrsMap,"bus"),s=this.getAttrVals(a,e.right.reference.id,i,t.idAttrsMap,"bus");return this.attrGroupBySide?((r=r.concat(o)).push(e.left.quantity),(r=r.concat(s)).push(e.right.quantity)):(this.addGroupByPairAttrValsToCsvRow(o,s,r),r.push(e.left.quantity),r.push(e.right.quantity)),r},getOutputGroupByPairAttrDisplayNames:function(e,t){for(var i=[],r=e.length,a=t?o.InstanceAttrDiapNamePostfix:"",n=0;n<r;n++){var s=e[n]+a;i.push(s+" 1"),i.push(s+" 2")}return i},getOutputGroupBySideAttrDisplayNames:function(e,t,i){for(var r=[],a=e.length,n=t?o.InstanceAttrDiapNamePostfix:"",s=i?" 1":" 2",l=0;l<a;l++){var c=e[l]+n;r.push(c+s)}return r},exportListView:function(e,r){for(var a=[],n=this.getUserSelAttrDispNames(r.refAttrDefs,t._PROP_COMP_FACETS[0]),s=e.length,l=0;l<s;l++){var c=this.exportListViewRow(e[l],r,n);a.push(c)}var d=[o.ComparisonStatus];n.push(o.Quantity);var u={columns:d=this.attrGroupBySide?(d=d.concat(this.getOutputGroupBySideAttrDisplayNames(n,!1,!0))).concat(this.getOutputGroupBySideAttrDisplayNames(n,!1,!1)):d.concat(this.getOutputGroupByPairAttrDisplayNames(n,!1)),tables:[{rows:a}]};i.generateCsv(u,{csv_base_file_name:o.BaseFilenameExport})},exportTreeView:function(e,r){for(var a=[],n=this.getUserSelAttrDispNames(r.refAttrDefs,t._PROP_COMP_FACETS[0]),s=this.getUserSelAttrDispNames(r.insAttrDefs,t._PROP_COMP_FACETS[1]),l=this.getUserSelAttrDispNames(r.effAttrDefs,t._PROP_COMP_FACETS[2]),c=e.length,d=0;d<c;d++){var u=this.exportTreeViewRow(e[d],r,n,s,l);a.push(u)}var p=[o.ComparisonStatus,o.Level],h={columns:p=this.attrGroupBySide?(p=(p=(p=(p=(p=p.concat(this.getOutputGroupBySideAttrDisplayNames(n,!1,!0))).concat(this.getOutputGroupBySideAttrDisplayNames(s,!0,!0))).concat(this.getOutputGroupBySideAttrDisplayNames(l,!1,!0))).concat(this.getOutputGroupBySideAttrDisplayNames(n,!1,!1))).concat(this.getOutputGroupBySideAttrDisplayNames(s,!0,!1))).concat(this.getOutputGroupBySideAttrDisplayNames(l,!1,!1)):(p=(p=p.concat(this.getOutputGroupByPairAttrDisplayNames(n,!1))).concat(this.getOutputGroupByPairAttrDisplayNames(s,!0))).concat(this.getOutputGroupByPairAttrDisplayNames(l,!1)),tables:[{rows:a}]};i.generateCsv(h,{csv_base_file_name:o.BaseFilenameExport})},getUserSelAttrDispNames:function(e,t){for(var i=[],r=e.length,a=0;a<r;a++){var n=e[a];if(this.isTitleAttr(n))i.unshift(n.displayName);else{for(var o=n.names,s=o.length,l=!0,c=0;c<s;c++){var d=o[c];if(!this.tableCompare.isAttributeShownInTable(d,t)){l=!1;break}}l&&i.push(n.displayName)}}return i},isTitleAttr:function(e){var t=e.names[0];return"attribute[PLMEntity.V_Name]"==t||"V_Name"==t||"attribute[PLMInstance.PLM_ExternalID]"==t},formatCompareResult:function(){return formatted=[],this.formatCompareResultArray(0,this.rightTree,formatted),formatted},getAllIds:function(e){var t=[],i=[],r=[],a={};function n(e,t){null!=e&&-1==t.indexOf(e)&&t.push(e)}for(var o=e.length,s=0;s<o;s++){var l=e[s],c=l.left.reference,d=l.right.reference,u=c.id,p=d.id;n(u,t),n(l.left.instance.id,r),n(p,t),n(l.right.instance.id,r),a[u]=c.serviceId,a[p]=d.serviceId}var h=t.length;for(s=0;s<h;s++){var f=t[s];i.push(a[f])}return{refids:t,svcids:i,insids:r}},formatAttr:function(e){return{name:void 0!==e.selectable?e.selectable:e.name,displayName:void 0!==e.nls?e.nls:e.displayName,val:this.tableCompare.getAttrValue(e)}},formatAttrs:function(e){for(var t=e.length,i=[],r=[],a=[],n={bus:{},connection:{},effectivity:{}},o=(t=e.length,0);o<t;o++){var s=e[o],l=s.physicalID,c=s.metatype,d=[],u=s.basicData,p=s.data;null!=u&&(d=d.concat(u)),null!=p&&(d=d.concat(p));for(var h={},f=d.length,m=0;m<f;m++){var g=this.formatAttr(d[m]);"bus"==c?this.collectAttrDefs(g,i):"connection"==c?this.collectAttrDefs(g,r):"effectivity"==c&&this.collectAttrDefs(g,a),h[g.displayName]=g.val}n[c][l]=h}return{refAttrDefs:i,insAttrDefs:r,effAttrDefs:a,idAttrsMap:n}},findAttrDefByDisplayName(e,t){for(var i=t.length,r=0;r<i;r++){var a=t[r];if(e==a.displayName)return a}return null},collectAttrDefs:function(e,t){var i=e.displayName,r=e.name,a=this.findAttrDefByDisplayName(i,t);if(null==a)a={displayName:i,names:[r]},t.push(a);else{r=e.name;var n=a.names;-1==n.indexOf(r)&&n.push(r)}},formatCompareResultArray:function(e,t,i){if(null!=t)for(var r=t.length,a=0;a<r;a++){var n=t[a];this.formatCompareResultNode(e,n,i)}},formatCompareResultNode:function(e,t,i){var r=t.matchRow.compareData,a=t.compareData;if(!(null!=r&&null==r.type||null!=a&&null==a.type)){null==r&&(r={physicalid:null,"physicalid[connection]":null,quantity:""}),null==a&&(a={physicalid:null,"physicalid[connection]":null,quantity:""});var n={status:this.getCompareStatus(t),level:e,left:{reference:{id:r.physicalid,serviceId:r.serviceId},instance:{id:r["physicalid[connection]"]},quantity:r.quantity},right:{reference:{id:a.physicalid,serviceId:a.serviceId},instance:{id:a["physicalid[connection]"]},quantity:a.quantity}};i.push(n),this.formatCompareResultArray(e+1,t.children,i)}},getCompareStatus:function(e){var t=e.compareStatus.differences,i="";if(0==t.length)i=n.same.label;else{for(var r=0;r<t.length;r++){i+=t[r].label+", "}i=i.substring(0,i.length-2)}return i}});return s.loadOptions=function(e){var i=widget.getValue("x3dPlatformId"),a={url3DSpace:r.get3DSpaceBaseUrl(i),tenant:i,securityContext:widget.securityContext},n=t.getExpressionPromise("CompareWidgetExportUseNewFormat",a),o=t.getExpressionPromise("CompareWidgetAttributeNotAvailableSymbol",a),s=t.getExpressionPromise("CompareWidgetAttributeGroupBySide",a);UWA.Promise.all([n,o,s]).then(function(t){var i={useNewFormat:"true"===t[0].expressionValue,attrNotAvlSym:t[1].expressionValue,attrGroupBySide:t[2].expressionValue};e(i)},function(t){e({useNewFormat:!1})})},s}),define("DS/CompareWidget/CompareContent",["DS/WAFData/WAFData","DS/Controls/Loader","DS/UIKIT/Mask","DS/ENOFloatingPanel/ENOFloatingPanel","DS/ApplicationFrame/ActionBar","DS/ApplicationFrame/CommandsManager","DS/WidgetServices/WidgetServices","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/LifecycleServices/LifecycleServicesSettings","DS/LifecycleServices/LifecycleServices","DS/CompareWidget/CompareTable","DS/CompareWidget/CompareStructure","DS/CompareWidget/CompareViewer","DS/CompareWidget/PickDialog","DS/CompareWidget/CompareOverview","DS/CompareWidget/FilterAttributesWidget","DS/CompareWidget/ViewStateMgr","DS/CompareCommon/DragAndDrop","DS/CompareCommon/Utils","DS/CompareWidget/CompareObjMgr","DS/CompareWidget/ColumnPanelLayout","DS/CompareCommon/WidgetPreferences","DS/CompareWidget/CompareStatusDiffs","DS/CompareWidget/CompareActionBar","DS/CompareWidgetUtils/CompareExporter","DS/CompareWidget/CompareReport","DS/CompareWidget/SimuliaComparePlugin","DS/CompareCommon/CompareMetaData","DS/CompareCommon/CompareInput","DS/CompareCommon/CompareIdData","DS/CompareCommon/CompareIdDataListItem","css!DS/CompareWidget/CompareWidget.css","i18n!DS/CompareWidget/assets/nls/CompareContent","i18n!DS/CompareWidget/assets/nls/CompareStructure","i18n!DS/CompareWidgetUtils/assets/nls/CompareExport","i18n!DS/CompareWidget/assets/nls/CompareWidget","DS/CompareCommon/DBG_Stopwatch"],function(e,t,i,r,a,n,o,s,l,c,d,u,p,h,f,m,g,v,y,b,C,w,S,D,_,T,E,A,I,x,O,N,P,R,L,W,j){"use strict";"undefined"!=typeof widget&&null!=widget.uwaUrl&&widget.uwaUrl.search("CW_TIMING");var V=!0,F=function(e){};var M=function(e){e=e||{},this.displayFlags={},this.proxyType=e.proxyType||"passport",this.rootServiceURL=e.rootServiceURL||"",this.objMgr=new b,this.compareInput=new I(e),this.tenant="undefined"!=typeof widget&&widget?widget.getValue("x3dPlatformId"):null,null!=this.tenant&&""!=this.tenant||(this.tenant="OnPremise"),F("CompareContent is loading using tenant (from x3dPlatformId) '"+this.tenant+"'"),this.CmdContexts={Load:0,Refresh:1,RemoveAll:2,Replace:3,SwapColumns:4,Load_4_swap:5,Refresh_noFetch:6},this.currentCmdContext=this.CmdContexts.Load,this.loadFromCompassOK=!0,this.securityContext="uninitialized",this.structureCompare=null,this.tableCompare=null,this.viewerCompare=null,this.compareOverview=null,this.actionBar=null,this.trees=[],this.rootElement=null,this.tableShown=!1,this.isListView=!1,this.validateObj_stateData={},this.idDataList=null,this.supportedForViewer=!0,this.pickDialog=null,this.facetToSelect=null,this.viewStateMgr=new g(this),this.simuliaComparePlugin=new E(this),this._scTopCurrent=0,this._scLeftCurrent=0,this._leftCachedFetchedTable=null,this._rightCachedFetchedTable=null,this.swapActivePID_l="NONE",this.swapActivePID_r="NONE",this._mergeActivePID="NONE",this.savedDupFiltering="",this.savedDupRevsFiltering="",this.bGenericCompare=!1,this._autoScrollToActive=!0,this.bRequiresIndex=!1,this.currentExpandState=0,this._reuseViewerInSwap=!0;var t=this;this._filterProxy=null,require(["DS/ENOFilterBIUX/FilterBIComponentProxy"],function(e){t._filterProxy=new e({appId:widget.getValue("appId"),widgetId:widget.id,NGFUXId:"CompareStructure",tenant:widget.getValue("x3dPlatformId"),ExpandSynthesisON:!0,selectionFilterAvailable:!1,volumeFilterAvailable:!1,shareFilterSpec:!0}),t._filterProxy&&t._filterProxy.setNGFilterOptions({appID:widget.getValue("appId")})},function(e){console.log("CompareContent: failure loading Filter module")})};M.prototype.dragEnterHighlight=function(e){var t=UWA.Event.getElement(e).id;t.startsWith("drop-target-left")?jQuery("#drop-target-left").addClass("drop-cue-on"):t.startsWith("drop-target-right")&&jQuery("#drop-target-right").addClass("drop-cue-on")},M.prototype.dragLeaveDeHighlight=function(e){if(null==e);else{var t=UWA.Event.getElement(e).id;t.startsWith("drop-target-left")?jQuery("#drop-target-left").removeClass("drop-cue-on"):t.startsWith("drop-target-right")&&jQuery("#drop-target-right").removeClass("drop-cue-on")}},M.prototype.updateValidatedObj_StateData=function(e){var t=e.physID||e.physicalid;if(e.physicalid=t,null==this.validateObj_stateData[t])this.validateObj_stateData[t]=e;else for(var i in e)this.validateObj_stateData[t][i]=e[i]},M.prototype.validateIdsThenCall=function(t,i,r){var a,n,o=this;if(t.length>0)if(null!=i&&i.length>0&&(a=i[0],n=!0,null==a||void 0===a.serviceId||null===a.serviceId||""===a.serviceId||"3dspace"===a.serviceId.toLowerCase()||a.serviceId.toLowerCase().startsWith("3dspace:")||(n=!1),!n)){if(o.bGenericCompare=!1,o.bRequiresIndex=!1,void 0===A.typeInfo||null===A.typeInfo||void 0===A.typeInfo[i[0].objectType]||null===A.typeInfo[i[0].objectType])s.getPlatformServices({onComplete:function(t){for(var a=-1,n=0;n<t.length&&-1==a;++n)t[n].platformId==i[0].envId&&(a=n);if(a>-1){var s=t[a][i[0].serviceId]+"/"+i[0].serviceId,l=s+"/compareMetaData/"+i[0].objectType;A.typeInfo[i[0].objectType]={serviceId:i[0].serviceId,url:s,b3DViewerSupported:!1};try{e.authenticatedRequest(l,{proxy:o.proxyType,method:"GET",onComplete:function(e){try{var t=JSON.parse(e);A.typeInfo[i[0].objectType].structure=t.structure,A.typeInfo[i[0].objectType].attributes=t.attributes;for(var a=0;a<i.length;++a){var n={physicalid:i[a].objectId,objectId:i[a].objectId,objectType:i[a].objectType,serviceId:i[a].serviceId,attributesUrl:{url:A.typeInfo[i[a].objectType].url,attributes:A.typeInfo[i[a].objectType].attributes}};o.updateValidatedObj_StateData(n)}r()}catch(e){console.log("COMPARE compareMetaData invalid syntax"),r()}},onFailure:function(e){console.log("COMPARE CONTENT: failed getting compare metadata")}})}catch(e){console.log("COMPARE failure calling compareMetaData service '"+l+"'")}}else console.log("COMPARE failure identifying compareMetaData service URL for "+i[0].envId+" "+i[0].serviceId)},onFailure:function(){console.log("COMPARE failure retrieving compareMetaData service URL for "+i[0].envId+" "+i[0].serviceId)}});else{for(var c=0;c<i.length;++c){var d={physicalid:i[c].objectId,objectId:i[c].objectId,objectType:i[c].objectType,serviceId:i[c].serviceId,attributesUrl:{url:A.typeInfo[i[c].objectType].url,attributes:A.typeInfo[i[c].objectType].attributes}};o.updateValidatedObj_StateData(d)}r()}}else{var u=t.join(","),p=l.get3DSpaceWSUrl(this.tenant,"/resources/compare/getObjState","objectIds="+u);try{return void e.authenticatedRequest(p,{proxy:this.proxyType,method:"GET",onComplete:function(e){var t=JSON.parse(e).results;null==t||"number"!=typeof t.length?o.NLS_showMessage("BAD_DROP","compare-alert-error"):y.accessRightsPromise(t,o.tenant,o.securityContext,function(e){o.bGenericCompare=!1,o.bRequiresIndex=!1;var i=!1,a=0;for(a=0;a<t.length;++a){0==(n=t[a]).exists&&(i=!0),e||(n.notAccessible=!0,i=!0)}if(!i)for(a=0;a<t.length;++a){if(0==(n=t[a]).isSupportedType&&(o.bGenericCompare=!0),n.requiresIndex)o.bRequiresIndex=!0,widget.getBool("useIndex")||(o.NLS_showMessage("INDEX_REQ_ENABLING","compare-alert-warning"),widget.setValue("useIndex",!0));n.serviceId="3DSpace",o.updateValidatedObj_StateData(n)}for(a=0;a<t.length;++a){var n;if(0==(n=t[a]).exists){o.NLS_showMessage("OBJ_NOT_FOUND","compare-alert-error");break}if(1==n.notAccessible){o.NLS_showMessage("OBJ_INACCESSIBLE","compare-alert-error");break}}i||r()})}})}catch(e){console.log("Exception on '"+p+"'")}}},M.prototype.processValidatedIDsAndCommands=function(e){y.persistIDs(this.idDataList),this.doCompareForIDsAndCommands(e)},M.prototype.processValidatedIDs=function(){var e=this,t=0;if(null!=e.idDataList&&(t=e.idDataList.get_nonNullCount()),0!=e.idDataList.get_nonNullCount())if(y.persistIDs(this.idDataList),t>=2){e.doCompareForModels(),jQuery('*[data-name="Refresh"]').removeClass("wux-ui-state-disabled"),jQuery('*[data-name="RemoveAll"]').removeClass("wux-ui-state-disabled"),jQuery(".AfrActionBar",jQuery("div#compare-region-left")).show()}else{var i=this.idDataList.getLeftID();if(null==i&&(i=this.idDataList.getRightID()),null==e.pickDialog){var r=null,a=null;null!=this.idDataList.items[0]?(r="drop-target-left",a="right-rev-list"):(r="drop-target-right",a="left-rev-list");var n=this.idDataList.get_objServices(),o=document.getElementById(a),s=l.get3DSpaceBaseUrl(this.tenant),c=new h(o,document.getElementById(r),s,this.proxyType);null!=n&&null!=n&&0!=n.length&&"3DSpace"!=n[0].serviceId||jQuery(o).removeAttr("hidden");var d=""!==this.savedDupFiltering?this.savedDupFiltering:widget.getValue("display_alternate_depth"),u=""!==this.savedDupRevsFiltering?this.savedDupRevsFiltering:widget.getValue("display_alternate_revision_type");this.savedDupFiltering="",this.savedDupRevsFiltering="";c.load(this.validateObj_stateData[i],function(t){e.updateValidatedObj_StateData(t);var i=null==e.idDataList.getLeftID()?0:1,r=new O(t.physicalid);e.idDataList.items[i]=r,jQuery(o).attr("hidden"),y.persistIDs(e.idDataList),e.doCompareForModels()},e.facetToSelect,!1,d,u,null,null,!0,!0,!0),e.pickDialog=c}else{var p=this.validateObj_stateData[i];e.pickDialog.refresh(p)}jQuery(".AfrActionBar",jQuery("div#compare-region-left")).show()}else console.error("COMPARE>> failed sanity check in processValidatedIDs")},M.prototype.NLS_showMessage=function(e,t){require(["DS/CompareCommon/CompareAlert","i18n!DS/CompareWidget/assets/nls/CompareContent"],function(i,r){var a=null==e?r["MISSING ALERT MESSAGE"]:null!=r[e]?r[e]:e;i.doAlert({msg:a,alertStyle:t})},function(i){console.log("%%%% CompareWidget:: Failed to show "+t+": '"+e+"', error:"+i)})},M.prototype.IsCompareContentParentADialog=function(){return jQuery(this.rootElement).closest(".compare_popup").length>0};var k=function(e,t){for(var i=t.length,r=0;r<i;r++){var a=t[r];if(a.physicalid==e)return{physicalId:e,title:a.attributes.name,revision:a.attributes.revision,type:a.type,isViewerSupported:a.attributes.isViewerSupported,vWorldOrientation:a.attributes.vWorldOrientation}}};M.prototype.triggerViewerForModels=function(e,t){this.JSONObjTableArray=e,this.JSONObjViewerArray=t;var i=this.idDataList.getLeftID(),r=this.validateObj_stateData[i],a=e[0].nodes,n=!1;r&&r.isFilter&&(n=!0,i=r.filter.rootPhysicalId);var o=k(i,a);o.isFilter=n;var s=this.idDataList.getRightID(),l=this.validateObj_stateData[s],c=e[1].nodes;n=!1;l&&l.isFilter&&(n=!0,s=l.filter.rootPhysicalId);var d=k(s,c);if(d.isFilter=n,o&&d&&o.isViewerSupported&&d.isViewerSupported)this.supportedForViewer=!0,jQuery("#compare-content").trigger("loadNewModelEvent",{left:o,right:d,isListView:this.isListView}),jQuery("#compare-content").trigger("loadNewModelJSONEvent",{left:{viewerJSON:t[0]},right:{viewerJSON:t[1]},vWorldOrientation:o.vWorldOrientation});else{this.supportedForViewer=!1;var u="";o&&0==o.isViewerSupported&&(u=P.replace(P.get("UnsupportedTypeObject"),{type:o.type,name:o.title+" "+o.revision})),d&&0==d.isViewerSupported&&(u.length>0&&(u+=", "),u+=P.replace(P.get("UnsupportedTypeObject"),{type:d.type,name:d.title+" "+d.revision}));P.replace(P.get("ViewerNotSupported"),{UnsupportedTypeObject:u});console.log("Viewer not supported for requested objects: "+u)}};var B=function(e,t,i,r){var a=null,n=null;if(e.constructor==Array){if(1==e.length)return B(e[0],t,i,r);n=e}else n=[e];for(var o=0;o<n.length;o++){var s=n[o];if(null!=s&&void 0!==s.compareData&&null!==s.compareData&&((!t&&s.compareData.physicalid===i||t&&s.compareData["physicalid[connection]"]===i)&&("NONE"===r?a=s.key:void 0!==s.compareData.obj2&&null!==s.compareData.obj2&&(!t&&s.compareData.obj2.physicalid===r||t&&s.compareData.obj2["physicalid[connection]"]===r)&&(a=s.key)),void 0!==s.children&&null!==s.children))for(var l=0;null==a&&l<s.children.length;l++)a=B(s.children[l],t,i,r)}return a};function U(){return[{tag:"div",id:"compare-region-header",html:[{tag:"div",id:"compare-legend",html:[]}]},{tag:"div",id:"compare-region-upperleft",html:[{tag:"div",id:"overview-container"},{tag:"div",id:"compare-tree",html:[{tag:"div",id:"model-color-window",html:[{tag:"div",id:"model-color-panel",display:"flex","flex-direction":"row",html:[{tag:"div",id:"model-color-left",html:[]},{tag:"div",id:"model-color-spacer",html:[]},{tag:"div",id:"model-color-right",html:[]},{tag:"div",id:"model-color-spacer2",html:[]}]}]},{tag:"div",id:"compare-trees",html:[{tag:"div",id:"compare-structure-tree",html:[{tag:"div",id:"initial-drop",html:[{tag:"div",class:"drop-label",html:[{tag:"span",text:""}]},{tag:"div",id:"drop-targets",html:[{tag:"div",id:"left-container",html:[{tag:"div",id:"left-rev-list",class:"rev-list",hidden:"true"},{tag:"div",id:"drop-target-left",class:"drop-target",html:'<div id="drop-target-left-iconlabel" class="drop-icon-label"><span id="drop-target-left-icon" class="fonticon fonticon-2x fonticon-download"></span><br/>'+P.get("dropHere")+"</div>"}]},{tag:"div",id:"right-container",html:[{tag:"div",id:"right-rev-list",class:"rev-list",hidden:"true"},{tag:"div",id:"drop-target-right",class:"drop-target",html:'<div id="drop-target-right-iconlabel" class="drop-icon-label"><span id="drop-target-right-icon" class="fonticon fonticon-2x fonticon-download"></span><br/>'+P.get("dropHere")+"</div>"}]}]}]}]}]}]}]}]}function H(){var e=!widget.isWebInWin;if(e){var t=widget.getValue("compareInputVersion");null!=t&&1==t&&(e=!1)}return e}function G(){return!!H()&&V}function Q(e){H()&&(V=e)}function J(e,t,i){let r=e.getLevel();if(t){var a="CompareWidgetSimuliaWebInWin"!==widget.appId;function n(e){return null!=e&&("3DShape"===e.type||e.isTypeOf3DShape)}var o=!0;a&&void 0!==e.children&&null!==e.children&&1===e.children.length&&n(e.children[0].data.compareData)&&(o=!1),e.setExpanded(o),e.visit(function(e){if(!0===e.folder){let t=e.getLevel();(null==i||i<0||t<r+i)&&(void 0!==e.data.compareData&&null!==e.data.compareData?(o=!0,a&&void 0!==e.children&&null!==e.children&&1===e.children.length&&n(e.children[0].data.compareData)&&(o=!1),e.setExpanded(o)):void 0!==e.data.matchRow.compareData&&null!==e.data.matchRow.compareData&&(o=!0,a&&void 0!==e.data.matchRow.children&&null!==e.data.matchRow.children&&1===e.data.matchRow.children.length&&n(e.data.matchRow.children[0].compareData)&&(o=!1),e.setExpanded(o)))}})}else e.setExpanded(!1),e.visit(function(e){e.setExpanded(!1)})}function q(e){var t="NONE";if(null!=e&&null!=e&&void 0!==e.fancytree){var i=e.fancytree("getTree"),r=null;try{null!=(r=i.getActiveNode())&&null!=r&&null!=r.data&&null!=r.data&&null!=r.data.compareData&&null!=r.data.compareData&&(t=r.data.compareData.physicalid)}catch(e){}}return t}function z(e,t,i){for(var r="",a="",n=0;n<t.length&&""===a;++n)t[n].ConnectionId===i&&(a=t[n].parentPhysicalId);""!==a&&(r=function e(t,i){var r="";void 0!==t.compareData&&null!==t.compareData&&t.compareData.physicalid===i&&void 0!==t.matchRow&&null!==t.matchRow&&void 0!==t.matchRow.compareData&&null!==t.matchRow.compareData&&(r=t.matchRow.compareData.physicalid);if(""===r&&void 0!==t.children&&null!==t.children)for(var a=0;a<t.children.length&&""===r;++a)r=e(t.children[a],i);return r}(e.structureCompare.fTreeData_right[0][0],a));return r}return M.prototype.doCompareStructure=function(e,t){try{var i=this,r=i.getCompareOptions();this.structureCompare.compareUsingJSONObjs.call(i.structureCompare,i.isListView,i.bGenericCompare,r,e,t,function(e){var t="NONE"!=i.swapActivePID_l||"NONE"!=i.swapActivePID_r,r=e||t;i.updateWidgetViewState(!r);var a=1==r?"index_0":"NONE";if(i.currentCmdContext===i.CmdContexts.Load_4_swap||i.currentCmdContext===i.CmdContexts.SwapColumns){null!=i.viewerCompare&&i.viewerCompare.do3DCompare_4_Swap();var n=i.swapActivePID_r,o=i.swapActivePID_l,s=null;"NONE"===n?"NONE"===o?a="NONE":s=B(i.structureCompare.fTreeData_right,!1,o,n):s=B(i.structureCompare.fTreeData_left,!1,n,o),null!=s?a=s:console.log("Cannot find selected child to re-establish as active... defaulting to first element")}else i.currentCmdContext===i.CmdContexts.Refresh_noFetch?a=B(i.structureCompare.fTreeData_right,!0,i._mergeActivePID,"NONE"):i.currentCmdContext===i.CmdContexts.Refresh&&(a=i.refreshLastActiveKey);var l=jQuery("#structure-treetable-left");if(null!=l){var c=l.fancytree("getTree");if(null!=c){var d=c.getNodeByKey(a);null!=d&&d.setActive()}}var u=i.rootElement.getElement("#overview-container"),p=i.idDataList.get_nonNullCount()>2;i.compareOverview=function(e,t,i,r){jQuery("#compare-overview-toplevel").remove();var a=new f(e,i);return a.init(t,r),a}(u,a,i.isListView,p),jQuery("#compare-actionbar").show()})}catch(e){this.idDataList=null,i.updateWidgetViewState(!1),this.NLS_showMessage("BadStructData","compare-alert-error"),console.log("BAD STRUCT DATA // EXPECTION"),console.log(e.stack)}},M.prototype._loadFiltersAndContinue=function(e,t){for(var i=e.items.length,r=[],a=0;a<i;a++){var n=e.items[a].objectId;null!=(d=this.validateObj_stateData[n])&&d.isFilter&&(null!=d.filter&&null!=d.filter.rootPhysicalId||r.push(d))}var o=r.length;if(0==o)t(void 0);else{var s=0,c=l.get3DSpaceBaseUrl(this.tenant);for(a=0;a<o;a++){var d=r[a];y.loadFilter(d,{tenant:this.tenant,securityContext:this.securityContext,url3DSpace:c},function(){++s==o&&t(void 0)})}}},M.prototype.doCompareForSnapshots=function(e){var t=this,i=e.get_objIDList();t.objMgr.fetchSnapshotObjsByID(i,function(e){var i=e.JSONObjTableArray,r=[];r[0]=t.objMgr.createJSONViewerObj(i[0]),r[1]=t.objMgr.createJSONViewerObj(i[1]),function(e,t){for(var i=[],r=0;r<e.length;r++){for(var a=e[r],n=a.rootoccurrence,o=-1,s=0;s<a.occurrences.length;s++){var l=a.occurrences[s];if(l.occurrenceid==n){o=l.nodeid;break}}if(-1==o)return void console.error("ERROR: Cannot find root node in JSON snapshot table for model #"+r);for(s=0;s<a.nodes.length;s++){var c=a.nodes[s];if(c.nodeid==o){var d={physicalId:c.physicalid,title:c.attributes.name,revision:c.attributes.revision,viewerJSON:t[r]};i.push(d);break}}}jQuery("#compare-content").trigger("loadNewSnapshotEvent",{left:i[0],right:i[1],isListView:this.isListView})}(i,r),t.doCompareStructure.call(t,i)},function(e){console.log("CompareContents :: Error attempting to fetch JSON Objects from server"),console.log("  Error Message :: "+e),t.NLS_showMessage(e.message,"compare-alert-error"),t.removeAll()})},M.prototype.doCompareForIDsAndCommands=function(e){var t=this,i=this.getCompareOptions(),r=t.idDataList;t.objMgr.fetchObjsByRootIDs(e,null,i,!1,null,null,function(e){require(["DS/CompareWidget/AssemblyEditor"],function(i){var a=i.doEdits(r,e),n=[];n[0]=t.objMgr.createJSONViewerObj(a[0]),n[1]=t.objMgr.createJSONViewerObj(a[1]),t.doCompareStructure.call(t,a,n),t.triggerViewerForModels.call(t,a,n)})})},M.prototype.getCompareInput=function(){var e=this.idDataList.get_objIDList().length,t={rootCount:e};if(2==e){t={rootCount:e,roots:{left:"",right:""},appliedFilter:{left:"",right:""}};var i=this.validateObj_stateData[this.idDataList.getLeftID()],r=this.validateObj_stateData[this.idDataList.getRightID()];null!=i&&(null!=i.filter?(t.roots.left=i.filter.rootPhysicalId,t.appliedFilter.left=i.physicalid):t.roots.left=i.physicalid),null!=r&&(null!=r.filter?(t.roots.right=r.filter.rootPhysicalId,t.appliedFilter.right=r.physicalid):t.roots.right=r.physicalid)}return t},M.prototype.unmaskStructure=function(){var e=this.rootElement.getElement("#compare-region-left");i.unmask(e)},M.prototype.getReuseViewerInSwap=function(){return this._reuseViewerInSwap},M.prototype.setReuseViewerInSwap=function(){return this._reuseViewerInSwap=!0,void 0!==this.structureCompare&&null!==this.structureCompare&&(this._reuseViewerInSwap=this.structureCompare._allStatusesChecked()),this._reuseViewerInSwap},M.prototype.doCompareForModels=function(){j.iterStart("Initial Load");var e=this,t=e.rootElement.getElement("#compare-region-left");i.mask(t);var r=void 0;if(e.currentCmdContext===e.CmdContexts.Refresh_noFetch)(r=[]).push(JSON.parse(JSON.stringify(e._leftCachedFetchedTable))),r.push(JSON.parse(JSON.stringify(e._rightCachedFetchedTable)));else if(e.currentCmdContext===e.CmdContexts.Load_4_swap||e.currentCmdContext===e.CmdContexts.SwapColumns){var a=e._leftCachedFetchedTable;e._leftCachedFetchedTable=e._rightCachedFetchedTable,e._rightCachedFetchedTable=a}else e._leftCachedFetchedTable=null,e._rightCachedFetchedTable=null;var n=this.getCompareOptions(),o=e.idDataList.get_objIDList(),s=e.idDataList.get_objServices().map(function(e){return e.objectType}),l=e.idDataList.get_objFilterData();j.mark({id:"retrieveObjbyID",str:"[BEGIN] Fetch Objects from Server "}),e.objMgr.fetchObjsByRootIDs(o,r,n,!0,s,l,function(t){j.mark({id:"retrieveObjbyID",str:"  [END] Fetch Objects from Server  ",comment:"**** objects now fully loaded from DB ***"}),j.mark({id:"retrieveFilters",str:"[BEGIN] Fetch filters"}),e._loadFiltersAndContinue(e.idDataList,function(){j.mark({id:"retrieveFilters",str:"  [END] Fetch filters              ",comment:"**** Filters now loaded ****"}),"CompareWidgetSimuliaWebInWin"==widget.appId&&e.simuliaComparePlugin.setCompareInput(e.getCompareInput());var i=[];if(j.mark({id:"CreateViewerJSONs",str:"[BEGIN] Create Viewer JSONS"}),i[0]=e.objMgr.createJSONViewerObj(t[0]),i[1]=e.objMgr.createJSONViewerObj(t[1]),j.mark({id:"CreateViewerJSONs",str:"  [END] Create Viewer JSONS        ",comment:"**** Viewer JSONs fully created ****"}),e.currentCmdContext!==e.CmdContexts.Load_4_swap||e.getReuseViewerInSwap()||(e.currentCmdContext=e.CmdContexts.Refresh),e.currentCmdContext!==e.CmdContexts.Load_4_swap){var r=!1;"CompareWidgetSimuliaWebInWin"==widget.appId&&(r=!0),r&&e.currentCmdContext!==e.CmdContexts.Refresh_noFetch&&(e._leftCachedFetchedTable=null,e._leftCachedFetchedTable=JSON.parse(JSON.stringify(t[0])),null===e._rightCachedFetchedTable&&(e._rightCachedFetchedTable=JSON.parse(JSON.stringify(t[1]))));var a=e.idDataList.items.length<=2;if(e.bGenericCompare&&(a=!1),Array.isArray(s)&&s.length)for(var n=0;n<s.length;n++)A.typeInfo[s[n]]&&"boolean"==typeof A.typeInfo[s[n]].b3DViewerSupported&&(e.supportedForViewer=a&=A.typeInfo[s[n]].b3DViewerSupported);//!(UWA.Utils.Client.Platform.ios || UWA.Utils.Client.Platform.android);
a&&e.triggerViewerForModels.call(e,t,i)}e.tableCompare.setGenericCompare(e.bGenericCompare),e.doCompareStructure.call(e,t,i)})},function(r){null!=r&&r.length>0&&e.NLS_showMessage(r[0].error,"compare-alert-error"),e.removeAll(),i.unmask(t)})},M.prototype.render=function(e,t,i){var r=this;this.rootElement=UWA.createElement("div",{id:"compare-content",html:[]}),this.rootElement.inject(e,t),this.leftPanel=UWA.createElement("div",{id:"compare-region-left",html:U()}),this.midPanel=UWA.createElement("div",{id:"compare-region-mid",html:[]}),this.attrTableContainer=UWA.createElement("div",{id:"attribute-table",styles:{width:"100%",height:"100%"},html:[]}),this.attrTableContainer.inject(this.midPanel),this.currentCmdContext===this.CmdContexts.SwapColumns?this.rightPanel=i:this.rightPanel=UWA.createElement("div",{id:"compare-viewer",html:[]}),this.layout=new C({parentElement:this.rootElement,panels:[{panel:this.leftPanel,hiderTitle:P.HideTreeStructure,expanderTitle:P.ShowTreeStructure},{panel:this.midPanel,hiderTitle:P.HideAttributeTable,expanderTitle:P.ShowAttributeTable},{panel:this.rightPanel,hiderTitle:P.Hide3DCompare,expanderTitle:P.Show3DCompare}],onCollapse:function(e,t){e==r.midPanel&&(r.updateWidgetViewState(!1,!0),jQuery('*[data-name="CustomizeRows"]').addClass("wux-ui-state-disabled"))},onExpand:function(e,t){e==r.midPanel&&(r.updateWidgetViewState(!1,!0),jQuery('*[data-name="CustomizeRows"]').removeClass("wux-ui-state-disabled"))},onResize:function(e){r.updateActionbarPosition()}});var a=UWA.createElement("div",{id:"compare-actionbar",html:[]});return a.inject(this.rootElement),this.createActionBar(a),G()&&(jQuery("#compare-region").hide(),jQuery("#compare-actionbar").hide()),this.rootElement},M.prototype.createActionBar=function(e){var t=this,i="CompareActionBar.xml";widget.isWebInWin&&(i="CompareActionBarWebInWin.xml"),this.actionBar=new D({context:t,file:i,module:"CompareWidget"}),this.actionBar.inject(e),this.actionBar.onActionBarReady(function(){function e(e,t,i){var r=jQuery('*[data-name="'+e+'"]');return jQuery(r).click(function(){jQuery('*[data-name="'+e+'"]')[0].className.contains("wux-ui-state-disabled")||i()}),t||r.addClass("wux-ui-state-disabled"),r}this.elements.container.id="compare-actionBar";var i=t.currentCmdContext!==t.CmdContexts.Load_4_swap,r=(e("OverviewUp",i,function(){t.compareOverview.goUp()}),e("OverviewDown",i,function(){t.compareOverview.goDown()}),e("OverviewHome",i,function(){var e=!t.hasActiveNode();t.compareOverview.goHome(),e&&t.updateWidgetViewState(!1)}),e("ToggleListView",!0,function(){t.swapActivePID_l="NONE",t.swapActivePID_r="NONE",t._mergeActivePID="NONE",t.doToggleListView(),t.refresh()}),e("ToggleAttr",!0,function(){t.doToggleAttr()}),e("ToggleOverview",!0,function(){t.doToggleOverview()}),e("ToggleLegend",!0,function(){t.doToggleLegend()}),e("CustomizeRows",!1,function(){t.filterAttributes()}),D.getCmd("CompareExport"));r.onExecute(()=>{r.disable(),t.NLS_showMessage("CompareExportRunning","compare-alert-warning"),T.loadOptions(function(e){t.compareExport(e,()=>{t.NLS_showMessage("CompareExportComplete","compare-alert-success"),r.enable()})})});e("SwapColumns",!0,function(){t.swapColumns()}),e("Refresh",!0,function(){t.refresh()}),e("RemoveAll",!0,function(){y.clear_persistedIDs(),t.idDataList=null,t.swapActivePID_l="NONE",t.swapActivePID_r="NONE",t._mergeActivePID="NONE",void 0!==A.typeInfo&&null!==A.typeInfo&&(A.typeInfo={}),t.removeAll(),t.updateWidgetViewState(!1)});var a=jQuery('*[data-name="Preference"]');jQuery(a).click(function(){t.editPref()}),t.updateWidgetViewState(!1),widget.dispatchEvent("ENOLCM/CompareWidget/endActionBarLoad","Action Bar has Loaded")})},M.prototype.doToggleListView=function(){1==this.isListView?this.isListView=!1:this.isListView=!0,this.updateWidgetViewState()},M.prototype.getSelectedNodes=function(e){var t=[];if(null!==this.structureCompare){var i=this.structureCompare;null!=(t=i.listSelectedNodes)&&t.length>0&&t.forEach(function(t){var r=i._getOtherTree(t.node.tree).getNodeByKey(t.node.key);e.push(r)})}return t},M.prototype.expandCollapse=function(e,t){var i=[],r=this.getSelectedNodes(i);null!=r&&r.length>0?(r.forEach(function(i){J(i.node,e,t)}),i.forEach(function(i){J(i,e,t)})):null!==this.structureCompare&&(J(this.structureCompare.fTree_left.rootNode,e,t),J(this.structureCompare.fTree_right.rootNode,e,t))},M.prototype.expandNodeAll=function(){this.currentExpandState=0,this.expandCollapse(!0),null!==this.compareOverview&&this.compareOverview.sync(!0,!0)},M.prototype.expandNodeLevels=function(e){var t=this;null!=e&&void 0!==e.value&&null!==e.value&&e.value>0?this.expandNodeNLevels(e.value):require(["DS/PADUtils/views/PADLevelSel"],function(i){var r=1;null!=e&&void 0!==e.value&&null!==e.value&&e.initialValue>0&&(r=e.initialValue);new i({current_level:r,events:{onApply:function(e){t.expandNodeNLevels(parseInt(e))}}});if(null!=e&&void 0!==e.position&&null!==e.position&&e.position.x>0&&e.position.y>0){var a=jQuery(".pad_level_sel_modal > .modal-wrap");null!=a&&a.length>0&&(a[0].setStyle("padding-top","0px"),a[0].setStyle("margin-top",e.position.y+"px"),a[0].setStyle("margin-left",e.position.x+"px"))}})},M.prototype.expandNodeNLevels=function(e){this.currentExpandState=1,this.expandCollapse(!1),this.expandCollapse(!0,e),null!==this.compareOverview&&this.compareOverview.sync(!0,!0)},M.prototype.collapseNodeAll=function(){this.currentExpandState=2,this.expandCollapse(!1),null!==this.compareOverview&&this.compareOverview.sync(!0,!0)},M.prototype.doToggleAttr=function(){null!==this.midPanel&&null!==this.layout&&(this.midPanel.isCollapsed?this.layout.expand(this.midPanel,!0):this.layout.collapse(this.midPanel,!0)),this.updateWidgetViewState(!1,!1)},M.prototype.doToggleOverview=function(){this.doToggle("vizOverview",!1)},M.prototype.doToggleLegend=function(){this.doToggle("vizLegend",!1)},M.prototype.hasActiveNode=function(){return null!==function(e){var t=null,i="right"===e?jQuery("#structure-treetable-right"):jQuery("#structure-treetable-left");if(void 0!==i.fancytree){var r=i.fancytree("getTree");void 0!==r.getActiveNode&&null==(t=r.getActiveNode())&&(t=(r=(i=jQuery("#structure-treetable-right")).fancytree("getTree")).getActiveNode())}return t}()},M.prototype.doToggle=function(e,t){var i=!widget.getBool(e);widget.setValue(e,i);var r=!this.hasActiveNode();return this.updateWidgetViewState(r,t),i},M.prototype.loadAdminPrefs=function(e){var t={url3DSpace:l.get3DSpaceBaseUrl(this.tenant),tenant:this.tenant,securityContext:widget.securityContext},i=y.getExpressionPromise("CompareWidgetUseTitleRevToMatch",t),r=y.getExpressionPromise("CompareWidgetPropertiesShowEffectivity",t),a=y.getExpressionPromise("CompareWidgetUseTitleRevToMatchCriteria",t);UWA.Promise.all([i,r,a]).then(function(t){if(widget.CompareWidgetUseTitleRevToMatch="true"===t[0].expressionValue,widget.propertiesCompareDisplayEffectivity="true"===t[1].expressionValue,widget.CompareWidgetUseTitleRevToMatch&&(widget.CompareWidgetUseTitleRevToMatchCriteria=[],t[2].available))try{widget.CompareWidgetUseTitleRevToMatchCriteria=JSON.parse(t[2].expressionValue)}catch(e){console.error(e)}e()},function(t){widget.CompareWidgetUseTitleRevToMatch=!1,widget.propertiesCompareDisplayEffectivity=!1,widget.CompareWidgetUseTitleRevToMatchCriteria="[]",e()})},M.prototype.init=function(e){var t=this;l.app_initialization(function(){c.getSecurityContextPromise(widget.getValue("x3dPlatformId")).then(function(i){widget.securityContext=i,y.setCredentialsToWidget(i),t.loadAdminPrefs(()=>{t.initWithSecurityContext(i,e)})})})},M.prototype.initWithSecurityContext=function(e,t){var i=this;if(i.securityContext=e,i.initUI.call(i),G()){jQuery("#compare-region").hide();var r={noCompassContent:!this.loadFromCompassOK};this.compareInput.doInput(this.rootElement,r,function(e){console.log("Handling Compare Structures button"),jQuery("#compare-input-root").hide(),jQuery("#compare-region").show(),i.idDataList=e.idDataList,i.validateObj_stateData=e.validateObj_stateData,i.bGenericCompare=!1;for(let t of e.idDataList.items)0==i.validateObj_stateData[t.objectId].isSupportedType&&(i.bGenericCompare=!0);for(let t of e.idDataList.items)i.validateObj_stateData[t.objectId].requiresIndex&&(i.bRequiresIndex=!0);if(i.updateWidgetViewState(),Q(!1),!widget.getBool("useIndex")&&widget.CompareWidgetUseTitleRevToMatch&&i.NLS_showMessage("UseTitleRevToMatchIndexWarning","compare-alert-warning"),"IDPlusCommandsList"===e.idDataList.listType){let t=[],r=[];e.idDataList.items.forEach(function(e){if(null!=e){t.push(e.objectId);var i=e.commands;if(null!=i)for(var a=i.length,n=0;n<a;n++){var o=i[n].inNode;null!=o&&r.push(o)}}}),r.forEach(function(e){t.push(e)}),i.doCompareForIDsAndCommands(t)}else i.doCompareForModels()})}else i.initData.call(i);i.objMgr.securityContext=e,"function"==typeof t&&t()},M.prototype.checkAdjustTenant=function(e,t,i,r){if(i==r)F("Tenant info for dropped ID same as current tenant / no change ("+i+", "+r+")");else{if(1==e&&(null!=this.idDataList.getLeftID()&&"drop-right"==t||null!=this.idDataList.getRightID()&&"drop-left"==t))return this.NLS_showMessage("TenantMismatch","compare-alert-error"),void F("Both objects' tenants must match // "+i+" != "+r+"... rejecting dropped object");F("Changing tenant, based upon dropped ID, from '"+i+"' to '"+r+"'"),widget.setValue("x3dPlatformId",r),this.tenant=r}},M.prototype.dropHandler=function(e,t){var i={objArray:e};this.dropHandler2(null,i,t)},M.prototype.dropHandler2=function(e,t,i){var r=this;j.reset(),widget.addEventOnce("ENOLCM/CompareWidget/entireCompareDone",function(){j.dump()});var a=t.objArray.map(function(e){return e.objectId}),n=a.length;if(n>5)this.NLS_showMessage("selectFiveOrFewer","compare-alert-error");else if(n<1)console.warn("WARNING: unexpected drop count... no processing to be done");else{var o=t.filterProxy;if(null!=o){var s=this._filterProxy;null==s?console.log("CompareContent: filter proxy not initialized"):(s.activate(),s.areRootsSharable(a,o).then(function(e){if(null!=e){t.filterData=[];var a=0;e.forEach(function(e){e.hasFilter&&++a});var n=0;e.forEach(function(e){!0===e.hasFilter&&s.shareFilterSpec({fromRootId:e.rootId,fromSourceCtx:o,fromDropOnFilter:!1,callback:function(e){++n;var o=e.success;t.filterData.push(o[0]),n===a&&r.validateAndProcessDrop(t,i)}})})}else r.validateAndProcessDrop(t,i)}))}else this.validateAndProcessDrop(t,i)}},M.prototype.validateAndProcessDrop=function(e,t){var i=e.objArray,r=i.map(function(e){return e.objectId}),a=r.length,n=e.filterData,o=this._filterProxy;if(null!=o)for(var s=0;s<a;++s)o.removeRoot(r[s]);var l=i[0].envId;null!=l&&0!=l.length||(l=null);var c=widget.getValue("x3dPlatformId");null!=l?this.checkAdjustTenant(a,t,c,l):F("Dropped ID has no tenant info / value not changed, value remains "+c);var d=i.map(function(e){var t={};for(var i in e)t[i]=e[i];return t}),u=this;u.validateIdsThenCall.call(u,r,d,function(){null==u.idDataList&&(u.idDataList=new x("modelIDList"));for(var e=!1,i=0;i<r.length;i++){var a=new O(r[i],d[i]);if(null!=n)for(var o=0;o<n.length;++o)n[o].rootId===r[i]&&(a.filterData=n[o].filter);if(1==r.length){if("drop-left"==t){if(null!=u.idDataList.getLeftID()&&(e=!0),u.idDataList.areItemsIdentical(a,1))return void u.NLS_showMessage("AlreadyLoaded","compare-alert-warning");u.idDataList.items[0]=a}else if("drop-right"==t){if(null!=u.idDataList.getRightID()&&(e=!0),u.idDataList.areItemsIdentical(0,a))return void u.NLS_showMessage("AlreadyLoaded","compare-alert-warning");u.idDataList.items[1]=a}}else u.idDataList.items.push(a)}e&&u.viewerCompare&&(u.viewerCompare.releaseResources(),u.viewerCompare=new p(u.rootElement.getElement("#compare-viewer"))),u.processValidatedIDs()})},M.prototype.initUI=function(e){var t=this;this.displayFlags={showControllers:void 0,showLeft:void 0,expandLeft:void 0,showOverview:void 0,showLegend:void 0,showMid:void 0,expandMid:void 0,showRight:void 0,expandRight:void 0},v.setProcessingCB(this,this.dropHandler),v.attachObject("drop-target-left",this,this.dragEnterHighlight,this.dragLeaveDeHighlight),v.attachObject("drop-target-right",this,this.dragEnterHighlight,this.dragLeaveDeHighlight);try{this.currentCmdContext===this.CmdContexts.SwapColumns?(this.tableCompare.reInit(this.rootElement.getElement("#attribute-table")),jQuery("#compare-content").on("newRowSelectedEvent",this.tableCompare.updateTable.bind(this.tableCompare)),this.currentCmdContext===this.CmdContexts.SwapColumns&&this.tableCompare.swapAttributes()):this.currentCmdContext===this.CmdContexts.Refresh_noFetch?(this.tableCompare.reInit(this.rootElement.getElement("#attribute-table")),jQuery("#compare-content").on("newRowSelectedEvent",this.tableCompare.updateTable.bind(this.tableCompare))):this.tableCompare=new d(this.rootElement.getElement("#attribute-table"),this.proxyType,this.securityContext)}catch(e){console.log("Exception in create/init compare table: "+e)}this.rootElement.getElement("#overview-container")&&this.rootElement.getElement("#overview-container").hide(),this.structureCompare=new u(this.rootElement.getElement("#compare-structure-tree"),this.rootElement.getElement("#compare-legend"),this.proxyType,this.securityContext,this),this.currentCmdContext!==this.CmdContexts.SwapColumns?this.viewerCompare=new p(this.rootElement.getElement("#compare-viewer")):void 0!==this.viewerCompare&&null!==this.viewerCompare||(this.viewerCompare=new p(this.rootElement.getElement("#compare-viewer"))),jQuery("#compare-content").on("updateWidgetViewStateEvent",this.updateWidgetViewStateEventHandler.bind(this)),jQuery("#compare-structure-tree").scroll(function(e){var i=(n=jQuery("#compare-structure-tree"))[0].scrollTop,r=n[0].scrollLeft;if(i!=t._scTopCurrent){if(null!=t.compareOverview){var a=n[0].scrollHeight;t.compareOverview.scrollTree(i,a)}t._scTopCurrent=i}else if(r!=t._scLeftCurrent){var n;if(null!=(n=jQuery("div#model-color-panel"))){n[0].style.marginLeft=-r+"px";var o=jQuery("div#model-color-spacer2");null!=o&&o[0].hide()}t._scLeftCurrent=r}})},M.prototype.updateActionbarPosition=function(){var e=jQuery("div#compare-actionBar"),t=document.getElementById("compare-region-left"),i=document.getElementById("compare-region-mid"),r=document.getElementById("compare-content");if(null!=t&&null!=i&&null!=r){var a=100*(t.offsetWidth+i.offsetWidth)/r.offsetWidth;e.css("width",a+"%"),null!=this.actionBar&&this.actionBar._checkWidth()}},M.prototype.updateActionbarVisibility=function(){var e=jQuery("div#compare-actionBar");this.leftPanel.isHidden()&&this.midPanel.isHidden()?e.css("display","none"):e.css("display","")},M.prototype.initData=function(){widget.addEventOnce("ENOLCM/CompareWidget/entireCompareDone",function(){j.dump()});var e=null;if(this.currentCmdContext==this.CmdContexts.Refresh||this.currentCmdContext==this.CmdContexts.Replace||this.currentCmdContext==this.CmdContexts.SwapColumns||this.currentCmdContext==this.CmdContexts.Refresh_noFetch){if(this.currentCmdContext==this.CmdContexts.SwapColumns){var i=this.idDataList.items[0];this.idDataList.items[0]=this.idDataList.items[1],this.idDataList.items[1]=i}e=this.idDataList}if(this.idDataList=null,this.currentCmdContext!=this.CmdContexts.RemoveAll&&1==this.loadFromCompassOK&&(null==e&&(e=y.fetchPersistedIDs()),null==e)){var r=y.fetchContentFromCompass();if(null!=r){null!=r.useIndex&&widget.setValue("useIndex",r.useIndex);var a=r.envId;if(null==a&&null!=r.data&&null!=r.data.items&&r.data.items.length>0&&(a=r.data.items[0].envId),null!=a&&0!=a.length&&(this.tenant=a,widget.setValue("x3dPlatformId",this.tenant),F("CompareContents: compass data indicates tenant is now '"+this.tenant+"'")),null!=r.data)if(r.data.items.length>5)this.NLS_showMessage("selectFiveOrFewer","compare-alert-error");else{var n=r.listType;null==n&&(n=y.determineListType(r.data));for(var o=r.data.items.length,s=!1,l=0;l<o&&!s;++l){void 0!==(d=r.data.items[l]).objectServices&&null!==d.objectServices||void 0===d.serviceId||null===d.serviceId||void 0===d.envId||null===d.envId||void 0===d.objectId||null===d.objectId||void 0===d.objectType||null===d.objectType||(s=!0)}if(s){var c=[];for(l=0;l<o;l++){var d,u={serviceId:(d=r.data.items[l]).serviceId,envId:d.envId,objectId:d.objectId,objectType:d.objectType},p=new O(d.objectId,u);c.push(p)}e=new x(n,c)}else e=new x(n,r.data.items)}}}var h=this;if(null!=e)if("IDPlusCommandsList"==e.listType){var f=e.get_allIDList(),m=e.get_objServices();h.validateIdsThenCall.call(h,f,m,function(t){h.idDataList=e,h.processValidatedIDsAndCommands(f)})}else if("modelIDList"==e.listType){var g=e.get_objIDList();m=e.get_objServices();h.validateIdsThenCall.call(h,g,m,function(t){h.idDataList=e,h.processValidatedIDs()})}else if("snapshotIDList"==e.listType){new t({text:"Loading...",showButtonFlag:!0}).inject(widget.body.getElement("#drop-target-left")).on(),h.doCompareForSnapshots(e)}this.currentCmdContext===this.CmdContexts.SwapColumns&&(this.currentCmdContext=this.CmdContexts.Load_4_swap)},M.prototype.compareExport=function(e,t){if(e.useNewFormat){var i=this.structureCompare.fTreeData_left,r=this.structureCompare.fTreeData_right[0];new T(this.tableCompare,i,r,e).doExport(this.isListView,t)}else{var a=this;if(this.structureCompare){e.outputAttributeDifferences=!0,e.showCompressedNodes=!0,e.showFilteredNodes=!0,e.csv_base_file_name=L.BaseFilenameExport,e.outputAttributeDifferences&&this.tableCompare&&(e.attributeData=this.tableCompare.getAttributeData(),e.attributeKeyDefs=this.tableCompare.getAttributeKeyDefs()),e.structDisplayStyle=this.isListView?"list":"tree";var n=this.structureCompare.fTreeData_left,s=this.structureCompare.fTreeData_right[0];e.outputAttributeDifferences?this.tableCompare.updateAttrCacheFromAllIds(n,s,e,function(e,t,i){p(e,t,i),setTimeout(function(){var e=jQuery(".wux-notification-close"),t=document.createEvent("Event");t.initEvent("DSpointerup",!0,!0);for(var i=0;i<e.length;++i)e[i].dispatchEvent(t)},0)}):p(n,s,e)}}function l(e,t){var i;if(null!=e&&null!=e.value)if(e.value.constructor==Array)if(!0===e.multivalue)for(var r=0;r<e.value.length;++r){var a;if(t){var n=new Date(e.value[r]);a=o.formatDate(n,!0)}else a=e.value[r];i+=a,r!==e.value.length-1&&(i+=", ")}else if(t){n=new Date(e.value[0]);i=o.formatDate(n,!0)}else i=e.value[0];else if(t){n=new Date(e.value);i=o.formatDate(n,!0)}else i=e.value;return i}function c(e,t,i,r,n){var o="",s=t.attributeData[n],c=t.attributeKeyDefs[n];if(void 0!==s){var d=s[i],u=s[r];if(null!=d&&null!=u){for(var p=[],h=0,f=c.length;h<f;++h){var m=c[h].attrKey;if(a.tableCompare.isAttributeShownInTable(m,n)&&"object"==typeof d[m]&&null!=d[m]&&"object"==typeof d[m]&&null!=d[m]){var g="";if(void 0!==d[m].value&&null!==d[m].value){var v="timestamp"===d[m].type||"modified"===d[m].name||"originated"===d[m].name;g=l(d[m],v)}var y="";if(void 0!==u[m].value&&null!==u[m].value){v="timestamp"===u[m].type||"modified"===u[m].name||"originated"===u[m].name;y=l(u[m],v)}g!==y&&p.push({name:d[m].name,displayName:void 0!==d[m].nls?d[m].nls:d[m].displayName,valueLeft:g,valueRight:y})}}if(p.length>0)for(h=0;h<p.length;++h){0!==h&&(o+="\r\n"),o+=L.replace(L.get("ReferenceAttribute"),{attributeName:p[h].displayName,attributeValue:p[h].valueLeft})+", "+L.replace(L.get("ComparedAttribute"),{attributeName:p[h].displayName,attributeValue:p[h].valueRight})}}}e.push(o)}function d(e,t){var i=t.attributeData[""],r=t.attributeKeyDefs,a=void 0;for(var n in r)if("type"===r[n].attrName){a=n;break}var o="";return null!=a&&""!==a&&null!=(o=i[e][a])&&o.value&&(o=o.value,Array.isArray(o)?o=o[0]:"string"==typeof o&&o.length||(o="")),o}function u(e,t,i,r,a){var n=[],o="",s="",l="",p="";if("list"===t.structDisplayStyle?void 0!==i.compareData&&null!==i.compareData?n.push(i.compareData.quantity):n.push(""):n.push(e),void 0!==i.compareData&&null!==i.compareData?(n.push(i.compareData.title+" "+i.compareData.revision),o=i.compareData.physicalid,l=i.compareData["physicalid[connection]"]):n.push(""),"list"===t.structDisplayStyle&&(void 0!==r.compareData&&null!==r.compareData?n.push(r.compareData.quantity):n.push("")),void 0!==r.compareData&&null!==r.compareData?(n.push(r.compareData.title+" "+r.compareData.revision),s=r.compareData.physicalid,p=r.compareData["physicalid[connection]"]):n.push(""),void 0!==i.compareData&&null!==i.compareData){let e=d(i.compareData.physicalid,t);n.push(null!=e&&""!==e?e:i.compareData.type)}else if(void 0!==r.compareData&&null!==r.compareData){let e=d(r.compareData.physicalid,t);n.push(null!=e&&""!==e?e:r.compareData.type)}else n.push("");var h=r.compareStatus.differences,f="";if(0==h.length)f=S.same.label;else{for(var m=0;m<h.length;m++){f+=h[m].label+","}f=f.substring(0,f.length-1)}n.push(f),t.outputAttributeDifferences&&c(n,t,o,s,y._PROP_COMP_FACETS[0]),t.outputAttributeDifferences&&"list"!=t.structDisplayStyle&&c(n,t,l,p,y._PROP_COMP_FACETS[1]),a.rows.push(n);var g=i.children,v=0,b=r.children,C=0;null!=g&&(v=i.children.length),null!=b&&(C=r.children.length);var w=v>=C?v:C;for(m=0;m<w;m++){u(e+"."+(m+1),t,i.children[m],r.children[m],a)}}function p(e,i,r){var a={columns:[],tables:[]};_.outHeader(r,a.columns);for(var n=e.length,o=i.length,s=n>=o?n:o,l=0;l<s;++l){var c=l+1,d={rows:[]};a.tables.push(d),u(c,r,e[l],i[l],d)}!1!==r.outputCsv&&_.generateCsv(a,r),!0===r.outputHtml&&_.printHtml(a,r),!0===r.outputToConsole&&_.consoleOutput(a,r),t()}},M.prototype.swapColumns=function(e){this.currentCmdContext=this.CmdContexts.SwapColumns;var t=jQuery("#structure-treetable-left");if(this.swapActivePID_l=q(t),t=jQuery("#structure-treetable-right"),this.swapActivePID_r=q(t),this.setReuseViewerInSwap(),!this.getReuseViewerInSwap()&&this.hasActiveNode()){this.refreshLastActiveKey="index_0";var i=jQuery("#structure-treetable-left").fancytree("getTree").getActiveNode();null!=i&&(this.refreshLastActiveKey=i.key)}this.clean()},M.prototype.refresh=function(e,t){if(null!=t&&null!=t.newLeftRoot&&(this.idDataList.items[0].objectId=t.newLeftRoot),this.hasActiveNode()){this.refreshLastActiveKey="index_0";var i=jQuery("#structure-treetable-left").fancytree("getTree").getActiveNode();null!=i&&(this.refreshLastActiveKey=i.key)}null!=t&&void 0!==t.cmdContext&&null!==t.cmdContext?this.currentCmdContext=t.cmdContext:this.currentCmdContext=this.CmdContexts.Refresh;var r=this.rootElement.getElements(".facets-list > .facet.selected");if(r.length>0&&(this.facetToSelect=r[0].dataset.name),void 0!==t&&void 0!==t.useWidgetPreferences&&!0===t.useWidgetPreferences)this.savedDupFiltering="",this.savedDupRevsFiltering="";else if(null!==this.pickDialog){var a=this.pickDialog.getDupFilteringValues();""!==a.duplicates&&(this.savedDupFiltering=a.duplicates),""!==a.revsOfDuplicates&&(this.savedDupRevsFiltering=a.revsOfDuplicates)}this.closeHistoryGraphDialog(),this.clean()},M.prototype.removeAll=function(e){if(this.currentCmdContext=this.CmdContexts.RemoveAll,y.clear_persistedIDs(),this.idDataList=null,this.loadFromCompassOK=!1,null!==this.pickDialog){var t=this.pickDialog.getDupFilteringValues();null!=t&&(""!==t.duplicates&&(this.savedDupFiltering=t.duplicates),""!==t.revsOfDuplicates&&(this.savedDupRevsFiltering=t.revsOfDuplicates))}this.closeHistoryGraphDialog(),Q(!0),this.clean()},M.prototype.editPref=function(){var e=this;w.edit(function(){e.refresh()})},M.prototype.refreshViewer=function(e){if(this.viewerCompare){var t=jQuery("#structure-treetable-left").fancytree("getTree").getActiveNode();this.viewerCompare.releaseResources(),this.viewerCompare=new p(this.rootElement.getElement("#compare-viewer")),this.triggerViewerForModels(this.JSONObjTableArray,e),null!=t&&setTimeout(function(){t.setActive()},0)}},M.prototype.clean=function(e){if(this.currentCmdContext!==this.CmdContexts.SwapColumns&&this.tableCompare&&this.tableCompare.refresh(),this.pickDialog&&(this.pickDialog=null),this.compareOverview&&(this.compareOverview.refresh(),this.compareOverview=null),this.structureCompare){var t=this.currentCmdContext!=this.CmdContexts.SwapColumns;this.structureCompare.refresh(t)}delete this.actionBar,this.viewerCompare&&(this.currentCmdContext===this.CmdContexts.SwapColumns&&this.getReuseViewerInSwap()?this.viewerCompare.refresh_4_swap():(this.viewerCompare.releaseResources(),this.viewerCompare=null));var i=null;i=this.IsCompareContentParentADialog()?document.getElementsByClassName("compare_popup")[0]:widget.body.getElement("#widget-content"),void 0!==this.filterAttributesWidget&&null!==this.filterAttributesWidget&&this.doCloseCustomizeRows();var r=this.rightPanel;jQuery("div#compare-content").remove(),this.render(i,"bottom",r),this.init(),this.tableShown=!1},M.prototype.getCompareOptions=function(){var e=[];return!0===widget.getBool("compare_option_leaf")&&e.push("leaf"),!0===widget.getBool("compare_option_reference")&&e.push("display_quantity"),e.push("similar"),this.bRequiresIndex&&e.push("requiresIndex"),1==widget.getBool("openness_revisions")&&e.push("ignore_revision"),1==widget.getBool("openness_duplicates")&&e.push("ignore_dupe"),1==widget.getBool("useIndex")&&e.push("use_index"),1==widget.getBool("serverTimingVerbose")&&e.push("CW_SERVER_TIMING"),e},M.prototype.filterAttributes=function(){var e=this;if(void 0===this.filterAttributesWidget){var t=document.createElement("div");t.className="filter-attributes-popup";var i=document.createElement("div"),a=new r({className:"filter-attributes-modal",title:W.customizeRows,body:t,footer:i,overlay:!1,closable:!0,animate:!0,resizable:!0,autocenter:!0,visible:!0,minWidth:300,minHeight:250,events:{onResizeFloating:function(){null!=e.filterAttributesWidget&&null!=e.filterAttributesWidget.modal&&null!=e.filterAttributesWidget.modal.elements&&e.filterAttributesWidget.modal.centerIt()},onShow:function(){e.updateCustomizeAttributesActionBarButtonState(!1)},onHide:function(){e.updateCustomizeAttributesActionBarButtonState(!0)},onClose:function(){e.doCloseCustomizeRows()}}});this.filterAttributesWidget=new m(t,i,y.compPropFacetsReduceFn(e.tableCompare.getAttributeListFromTable.bind(e.tableCompare)),{context:e.context,tableCompare:e.tableCompare,showAllAttributesAsDefault:null!=A.typeInfo["3dportfolio"],events:{onReady:function(e){a.inject(document.body);a.setNewSizeWithDiff({x:4})},onClose:function(t){e.doCloseCustomizeRows()}}}).inject(t),this.filterAttributesWidget.modal=a}else this.filterAttributesWidget.modal.show()},M.prototype.doCloseCustomizeRows=function(){void 0!==this.filterAttributesWidget.modal&&null!==this.filterAttributesWidget.modal&&(this.filterAttributesWidget.modal.destroy(),this.updateCustomizeAttributesActionBarButtonState(!0),delete this.filterAttributesWidget)},M.prototype.updateCustomizeAttributesActionBarButtonState=function(e){var t=jQuery('*[data-name="CustomizeRows"]');e?t.removeClass("wux-ui-state-disabled"):t.addClass("wux-ui-state-disabled")},M.prototype.resizeModelColorPanel=function(){var e=jQuery("div#compare-structure-tree"),t=jQuery("div#compare-trees"),i=jQuery("div#model-color-spacer2");1==e.length&&1==t.length&&1==i.length&&(e[0].clientHeight>t[0].clientHeight&&!(e[0].clientWidth>t[0].clientWidth)?i[0].show():i[0].hide())},M.prototype.updateWidgetViewStateEventHandler=function(e,t){var i=this._autoScrollToActive;void 0!==t.autoScrollToActive&&(this._autoScrollToActive=t.autoScrollToActive),this.updateWidgetViewState(!1,t.buttonUpdateOnly,t.forceGetSelections),void 0!==t.autoScrollToActive&&(this._autoScrollToActive=i)},M.prototype.updateWidgetViewState=function(e,t,i){this.viewStateMgr.updateWidgetViewState(this,e,t),null!==this.compareOverview&&this.compareOverview.sync(!1,i,this._autoScrollToActive)},M.prototype.updateTenant=function(e,t){var i,r,a,n,o,s=this;null!==s.compareInput?G()?s.compareInput.updateTenant(e,function(i){i&&(s.tenant=e),t(i)}):null!=this.idDataList&&this.idDataList.get_nonNullCount()>0?(i=P.get("PlatformChange"),r=P.get("ChangeButton"),a=P.get("CancelButton"),n=function(){s.tenant=e,s.NLS_showMessage("tenantChanged","compare-alert-success"),s.removeAll({noClean:!0}),t(!0)},o=function(){t(!1)},require(["DS/UIKIT/SuperModal"],function(e){var t=new e({events:{onHide:function(){}},renderTo:document.body}),s=document.createElement("div");s.innerHTML=i;var l=document.createElement("div");l.className="compare_popup_warning";var c=UWA.createElement("span",{class:"compare_warning_icon fonticon fonticon-attention fonticon-2x"});l.appendChild(c);var d=document.createElement("div");d.appendChild(l),d.appendChild(s),t.dialog({title:P.get("CompareDialogHeader"),body:d,buttons:[{className:"primary",value:null!==r&&""!==r?r:null,action:function(e){e.hide(),null!=n&&"function"==typeof n&&n()}},{className:"default",value:null!==a&&""!==a?a:null,action:function(e){e.hide(),null!=o&&"function"==typeof o&&o()}}]})})):(this.tenant=e,this.NLS_showMessage("tenantChanged","compare-alert-success"),this.removeAll({noClean:!0}),t(!0)):(s.tenant=e,t(!0))},M.prototype.closeHistoryGraphDialog=function(){null!==this.pickDialog&&this.pickDialog.closeHistoryGraphDialog()},M.prototype.getPanelParameters=function(){return null!==this.layout?this.layout.getPanelParameters():null},M.prototype.checkUseIndexRequired=function(e){var t=this,i=!1;function r(i){for(let r of i.items)if(r.requiresIndex)return e||t.NLS_showMessage("INDEX_CANT_DISABLE","compare-alert-warning"),widget.setValue("useIndex",!0),!0;return!1}void 0!==this.idDataList&&null!==this.idDataList&&(i=r(this.idDataList)),i||void 0===this.compareInput||null===this.compareInput||void 0===this.compareInput.idDataList||null===this.compareInput.idDataList||(i=r(this.compareInput.idDataList))},M.prototype.modifyCachedTablesForMovedItems=function(e){var t=0;function i(e){for(var t={},i=e.results,r=0;r<i.length;r++){var a=i[r].attributes;if(null!=a){for(var n=null,o=null,s=0;s<a.length;s++){var l=a[s];"resourceid"==l.name?n=l.value:"matrixtxt"==l.name&&(o=l)}null!=o&&(t[n]=o)}}return t}var r=this.structureCompare.updateCompareResultData(e),a=this.structureCompare.updateCompareResultUI(),n=r.mov;if(null!=n){for(var o={},s=[],l=!1,c=0;c<n.length;c++){for(var d=n[c],u=!1,p=0;p<a.length&&!u;++p)d.key===a[p]&&(u=!0);if(u){var h=d.data.compareData["physicalid[connection]"],f=d.data.matchRow.compareData["physicalid[connection]"],m=!1;for(p=0;p<s.length&&!m;++p)s[p]===h&&(m=!0);m?(l=!0,this._mergeActivePID=f):(o[h]={id:f,xform:d.data.matchRow.compareData["attribute[Spatial Location]"]},s.push(h))}}if(l){var g=this._leftCachedFetchedTable.occurrences;for(c=0;c<s.length;++c){if(null!=(_=o[D=s[c]].id))for(p=0;p<g.length;++p){var v=g[p];if(v.ConnectionId===D)for(var y=0;y<o[D].xform.length;++y)v.xform[y]=o[D].xform[y]}}t=-1}else{var b=this.viewerCompare.options.leftViewerJSON,C=this.viewerCompare.options.rightViewerJSON,w=i(b),S=i(C);for(c=0;c<s.length;c++){var D,_;null!=(_=o[D=s[c]].id)&&(w[D].value=S[_].value)}this.refreshViewer([b,C]),t=1}}return t},M.prototype.modifyCachedTablesForRemovedItems=function(e){this._mergeActivePID="";for(var t=this._leftCachedFetchedTable.nodes,i=this._leftCachedFetchedTable.occurrences,r=this._leftCachedFetchedTable.occurrencerelationships,a=[],n=0;n<i.length;++n)a.push({removed:!1,newIndex:n});var o=[];for(n=0;n<r.length;++n)o.push({removed:!1,newIndex:n});var s=[];for(n=0;n<t.length;++n)s.push({removed:!0,newIndex:-1});for(n=0;n<i.length;++n){if(null!=(y=i[n])&&void 0!==y.pathWith&&null!==y.pathWith)for(var l=0;l<y.pathWith.length;++l)if(y.pathWith[l]===e){a[n].removed=!0,a[n].newIndex=-1;for(var c=0;c<r.length;++c){r[c].child===y.occurrenceid&&(o[c].removed=!0,o[c].newIndex=-1)}}}var d=[],u=[],p=[],h=0;for(l=0;l<r.length;++l){var f=r[l];if(null!=f)if(!0!==o[l].removed){var m=JSON.parse(JSON.stringify(f));d.push(m),o[l].newIndex-=h}else++h}var g=[],v=[];h=0;for(l=0;l<i.length;++l){var y;if(null!=(y=i[l]))if(!0!==a[l].removed){var b=JSON.parse(JSON.stringify(y));u.push(b),a[l].newIndex-=h,v.push(b.occurrenceid);var C=!1;for(c=0;c<g.length;++c)g[c]===y.nodeid&&(C=!0);C||g.push(y.nodeid)}else++h}if(g.length!==t.length){for(n=0;n<g.length;++n)s[g[n]].removed=!1,s[g[n]].newIndex=g[n];h=0;for(n=0;n<s.length;++n)!0===s[n].removed?++h:s[n].newIndex-=h;for(l=0;l<t.length;++l){var w=t[l];if(!0!==s[l].removed){var S=JSON.parse(JSON.stringify(w));S.nodeid=s[l].newIndex,p.push(S)}}}for(l=0;l<u.length;++l){var D=u[l];g.length!==t.length&&(D.nodeid=s[D.nodeid].newIndex)}for(l=0;l<u.length;++l){D=u[l];var _=!1;for(n=0;n<v.length&&!_;++n)D.occurrenceid===v[n]&&(D.occurrenceid=n,_=!0)}for(l=0;l<d.length;++l){var T=d[l],E=!1,A=!1;for(n=0;n<v.length&&(!E||!A);++n)E||T.parent!==v[n]||(T.parent=n,E=!0),A||T.child!==v[n]||(T.child=n,A=!0)}return this._leftCachedFetchedTable.occurrences=[],this._leftCachedFetchedTable.occurrencerelationships=[],this._leftCachedFetchedTable.occurrences=u,this._leftCachedFetchedTable.occurrencerelationships=d,g.length!==t.length&&(this._leftCachedFetchedTable.nodes=[],this._leftCachedFetchedTable.nodes=p),!0},M.prototype.modifyCachedTablesForAddedInstanceItems=function(e,t){this._mergeActivePID=e;var i=this._rightCachedFetchedTable.nodes,r=this._rightCachedFetchedTable.occurrences,a=this._rightCachedFetchedTable.occurrencerelationships,n=[],o=[],s=[],l=[],c=[],d=[];function u(e,t){var r=JSON.parse(JSON.stringify(e));n.push(r),o.push(t);for(var u=0;u<a.length;++u){var p=a[u];if(p.child===e.occurrenceid){var h=JSON.parse(JSON.stringify(p));s.push(h),l.push(u)}}var f=JSON.parse(JSON.stringify(i[e.nodeNdx]));c.push(f),d.push(e.nodeNdx)}for(var p=z(this,r,e),h=-1,f=-1,m=0;m<r.length&&-1==h;++m){if(null!=(T=r[m])&&void 0!==T.pathWith&&null!==T.pathWith)for(var g=0;g<T.pathWith.length&&-1==h;++g)T.pathWith[g]===e&&(h=m,f=T.level,u(T,m))}if(h>=0){var v=!1;for(m=h+1;m<r.length&&!v;++m){(T=r[m]).level>f?u(T,m):v=!0}}this._leftCachedFetchedTable.occurrencerelationships.length;var y=this._leftCachedFetchedTable.occurrences.length,b=this._leftCachedFetchedTable.nodes.length,C=-1;for(m=0;m<b;++m){C<=(D=this._leftCachedFetchedTable.nodes[m]).nodeid&&(C=D.nodeid+1)}var w=-1;for(m=0;m<y;++m){w<=(T=this._leftCachedFetchedTable.occurrences[m]).occurrenceid&&(w=T.occurrenceid+1)}var S=-1;for(m=0;m<b&&-1===S;++m){var D;(D=this._leftCachedFetchedTable.nodes[m]).physicalid===p&&(S=D.nodeid)}for(var _=0;_<y;++_){var T;if((T=this._leftCachedFetchedTable.occurrences[_]).nodeid===S){var E=JSON.parse(JSON.stringify(c)),A=JSON.parse(JSON.stringify(n)),I=JSON.parse(JSON.stringify(s)),x=[];for(m=0;m<E.length;++m)x.push({org:E[m].nodeid,now:C}),E[m].nodeid=C,++C;var O=[];for(m=0;m<A.length;++m)O.push({org:A[m].occurrenceid,now:w}),A[m].occurrenceid=w,++w;for(m=0;m<I.length;++m){var N=!1,P=!1;for(g=0;g<O.length&&(!N||!P);++g)N||I[m].parent!==O[g].org||(I[m].parent=O[g].now,N=!0),P||I[m].child!==O[g].org||(I[m].child=O[g].now,P=!0);N||(I[m].parent=T.occurrenceid)}for(m=0;m<A.length;++m){var R=!1;for(g=0;g<x.length&&!R;++g)R||A[m].nodeid!==x[g].org||(A[m].nodeid=x[g].now,R=!0)}for(m=0;m<E.length;++m){null!=t&&""!==t&&E[m]["physicalid[connection]"]===e&&(E[m]["physicalid[connection]"]=t);var L=-1;for(g=0;g<this._leftCachedFetchedTable.nodes.length&&-1===L;++g)E[m].physicalid===this._leftCachedFetchedTable.nodes[g].physicalid&&(L=g);if(-1===L)this._leftCachedFetchedTable.nodes.push(E[m]);else for(g=0;g<A.length;++g)A[g].nodeid===E[m].nodeid&&(A[g].nodeid=this._leftCachedFetchedTable.nodes[L].nodeid)}for(m=0;m<A.length;++m)null!=t&&""!==t&&A[m].ConnectionId===e&&(A[m].ConnectionId=t),this._leftCachedFetchedTable.occurrences.push(A[m]);for(m=0;m<I.length;++m)null!=t&&""!==t&&I[m].physicalid===e&&(I[m].physicalid=t),this._leftCachedFetchedTable.occurrencerelationships.push(I[m])}}return!0},M}),define("DS/CompareWidget/CompareWidget",["DS/CompareWidget/CompareContent","DS/LifecycleServices/LifecycleServicesSettings","DS/CompareCommon/DBG_Stopwatch","DS/CompareCommon/WidgetPreferences","i18n!DS/CompareWidget/assets/nls/CompareWidget","DS/RuntimeView/NLSManager","DS/LifecycleServices/LifecycleServices","DS/CompareCommon/Utils"],function(e,t,i,r,a,n,o,s){"use strict";i.dbglog("compareWidget module is loading");var l,c=function(e){},d=!1,u=null,p=!1,h=!1;var f="";function m(){widget.setTitle(a.enoviaCompareTitle),i.dbglog("compareWidget init() is starting"),r.addWidgetPrefs("V1"),widget.isWebInWin||s.setPreferencesToWidget("compare_viewer_selectmode","viewer_display_mode"),require(["DS/ENOPAD3DViewer/PAD3DViewer"],function(e){widget.data.addPlatformPref=!1,r.loadDefaults("compare_widget_default_prefs",g)},function(e){g()})}function g(){n.DEFAULT_LANGUAGE=widget.getValue("lang"),i.dbglog("compareWidget complete_init() is starting"),t.app_initialization(function(){var i=null!=widget?widget.getValue("X3DContentId"):null,r=null!=i?JSON.parse(i):null,a=null!=r?r.envId:null,n=widget.getValue("x3dPlatformId");if(c("CompareWidget starting... x3dPlatformId (should be value from compass menu) is: '"+n+"'"),c(null!=a?"CompareWidget Starting... X3DContentId (should be tenant for data itself) is '"+a+"'":"CompareWidget launched w/o any content... using platform tenant for now"),null!=a&&a.length>0)a==n?c("CompareWidget: platform tenant and content tenant match... no need to change"):(c("CompareWidget: platform tenant and content tenant DO NOT MATCH / changing platform's Tenant to "+a+"'"),widget.setValue("x3dPlatformId",a));else{var s=widget.getValue("x3dPlatformId");null!=s&&0!=s.length||(c("CompareWidget launched, but X3DContentId is *unset*, so pushing 'OnPremise' to x3dPlatformId"),widget.setValue("x3dPlatformId","OnPremise"))}var l=t.getOption("platform_services",null);null!=l&&l.length>0&&Array.isArray(l)&&l.forEach(function(e){null!=e&&e.hasOwnProperty("platformId")&&o.getSecurityContextList(e.platformId,function(){o.getSecurityContextForCollaborativeSharingCommands})}),u=new e({proxyType:"passport"});var d=widget.body.getElement("#widget-content");u.render(d,"bottom"),u.init(function(){widget.dispatchEvent("ENOLCM/CompareWidget/endLoadingWidget")})})}return"undefined"!=typeof widget&&null!=widget.uwaUrl&&(-1!=widget.uwaUrl.search("CW_TIMING")&&i.enable(),-1!=widget.uwaUrl.search("CW_SERVER_TIMING")&&!0),l={getContent:function(){return u},onLoad_forODT:function(){!0,widget.setBody([{tag:"div",id:"widget-content"}]),widget.addEventOnce("KILL_COMPARE_forODT",function(){u&&(u.removeAll(),u=null)}),t.app_initialization=function(e){e()},t.get3DSpaceBaseUrl=function(e){return"http:"},t.getTenant=function(){return"OnPremis"},o.getSecurityContextPromise=function(e){return{then:function(e){e("dummyContext")}}},t.get3DSpaceWSUrl=function(e,t,i){var r=t;return null!=i&&(r+="?"+i),r},m()},onLoad:function(){widget.setBody([{tag:"div",id:"widget-content"}]),m()},onResize:function(){jQuery("#widget-content").height(window.innerHeight)},onViewChange:function(e){null!=u&&u.updateWidgetViewState()},onRefresh:function(e){function t(e,t){null!=u&&(u.refresh(e,t),u.updateWidgetViewState()),f=""}if(null!=u){var i={useWidgetPreferences:!0};if(""!==f&&widget.hasPreference("xPref_3DEXPERIENCE_PLATFORM")){const r=widget.getValue("xPref_3DEXPERIENCE_PLATFORM");r!==f?u.updateTenant(r,function(r){r||widget.setValue("x3dPlatformId",f),t(e,i)}):t(e,i)}else t(e,i)}},onEdit:function(){var e=window.parent.document.getElementById("m_"+widget.id).getElementsByClassName("moduleEdit__footer")[0],t=e.getElementsByClassName("btn-primary")[0];t.innerHTML=a.saveToCurrentApp,t.className="btn-default btn btn-root";var i=UWA.createElement("button",{class:"btn-primary btn btn-root",html:a.saveAsDefault});e.insertBefore(i,t),i.onclick=function(){r.saveAsDefaults("compare_widget_default_prefs",function(){}),t.click()},p=widget.getValue("viewer_display_mode"),h=widget.getBool("useIndex"),widget.hasPreference("xPref_3DEXPERIENCE_PLATFORM")&&(f=widget.getValue("x3dPlatformId"))},endEdit:function(){var e=[],t=[],i=widget.getValue("viewer_display_mode");i!=p&&(e[0]="compare_viewer_selectmode",t[0]=i,null!=u&&u.updateViewerDisplayMode(i));var r=widget.getBool("useIndex");r||r==h||null!=u&&u.checkUseIndexRequired(!1),e.length>0&&Promise.allSettled(e.map((e,i)=>s.saveUserPreferencesPromise(e,t[i]))).then(function(t){for(var i=0,r=t.length;i<r;i++)"rejected"===t[i].status&&console.log("COMPARE WIDGET: failed setting "+e[i]+" preference")}),null!=u&&u.updateWidgetViewState()}},function(){if(!d){if(!widget)throw new Error(a.needwidgetenv);d=!0}}(),l});