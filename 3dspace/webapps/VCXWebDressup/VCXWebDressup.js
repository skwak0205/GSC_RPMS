define("DS/VCXWebDressup/VCXDressupModelNavigable",["UWA/Class","DS/WebApplicationBase/VCXAModelNavigable"],function(e,t){"use strict";return t.extend({isSelfOrganized:function(){return!0}})}),define("DS/VCXWebDressup/VCXDressupOrganisationShape",["UWA/Class","DS/Visualization/ThreeJS_DS","DS/VCXWebKernelTools/VCXMathTools"],function(e,t,i){"use strict";return e.extend({init:function(e){this.sizeView=e,this.fHalfSizeX=.5*this.sizeView.x,this.fHalfSizeY=.5*this.sizeView.y,this.iCurrent=0},next:function(){return this.iCurrent++,this.iCurrent>=this.iNbPt&&(this.iCurrent=this.iNbPt-1),!1},rewind:function(){this.iCurrent=0,this.iNbPt=(Math.floor(this.sizeView.x/this.fCellSize)+1)*(Math.floor(this.sizeView.y/this.fCellSize)+1)},getPoint:function(){}})}),define("DS/VCXWebDressup/CXPDressupVCXCXPConvertor",["DS/CAT3DExpModel/extensions/CATE3DExpVCXObjectConvertor","DS/Visualization/ThreeJS_DS"],function(e,t){"use strict";var i=e.extend({init:function(){},_variablesToProperties:function(e){var t=this.QueryInterface("VCXIModifiable");for(var i in e._map)e._map.hasOwnProperty(i)&&t.OnChangeProperty(i,e._map[i].GetPropertyValue())},GetNeutralsFromVariables:function(e){this._tab&&this._tab.forEach(function(t){var i;(i="Vector3"===t.type?this.variableToPropertyVector3(t.variableName,e,t.propertyName,t.NFVFunction):this.variableToProperty(t.variableName,e,t.propertyName,t.NFVFunction))&&e.AddOrModifyProperty(i)}.bind(this)),this._variablesToProperties(e)},UpdateVariablesFromNeutrals:function(e,t){this._tab&&this._tab.forEach(function(i){"Vector3"===i.type?this.propertyToVariableVector3(e,i.propertyName,t,i.variableName,i.VFNFunction):this.propertyToVariable(e,i.propertyName,t,i.variableName,i.VFNFunction)}.bind(this))},variableToPropertyVector3:function(e,i,r,a){var o=this.QueryInterface("CATI3DExperienceObject");if(o&&o.HasVariable(e+" X")&&o.HasVariable(e+" Y")&&o.HasVariable(e+" Z")){var s,n=new t.Vector3(o.GetValueByName(e+" X"),o.GetValueByName(e+" Y"),o.GetValueByName(e+" Z"));s=a?a(n):n;var l=this.QueryInterface("VCXIModifiable").GetProperty(r);if(l){var p=l.Clone();if(null!=s)return p.GetPropertyValue().SetValue(s),p}}},propertyToVariableVector3:function(e,t,i,r,a){var o=this.QueryInterface("CATI3DExperienceObject");if(o&&o.HasVariable(r+" X")&&o.HasVariable(r+" Y")&&o.HasVariable(r+" Z")){var s=this.GetObject(),n=e._map[t];if(n){var l,p=n.GetPropertyValue().Value;l=a?a(p):p,i.push({object:s,variableName:r+" X",variableValues:l.x}),i.push({object:s,variableName:r+" Y",variableValues:l.y}),i.push({object:s,variableName:r+" Z",variableValues:l.z}),e.RemoveProperty(t)}}},variableToProperty:function(e,t,i,r){var a=this.QueryInterface("CATI3DExperienceObject");if(a&&a.HasVariable(e)){var o,s=a.GetValueByName(e);o=r?r(s):s;var n=this.QueryInterface("VCXIModifiable").GetProperty(i);if(n){var l=n.Clone();if(null!=o)return l.GetPropertyValue().SetValue(o),l}}},propertyToVariable:function(e,t,i,r,a){var o=this.QueryInterface("CATI3DExperienceObject");if(o&&o.HasVariable(r)){var s=this.GetObject(),n=e._map[t];if(n){var l,p=n.GetPropertyValue().Value;l=a?a(p):p,i.push({object:s,variableName:r,variableValues:l}),e.RemoveProperty(t)}}}});return Object.defineProperty(i.prototype,"componentType",{enumerable:!0,get:function(){return"CXPDressupVCXCXPConvertor"}}),i}),define("DS/VCXWebDressup/VCXCmdChangeDressup",["DS/VCXWebKernelCommands/VCXCommand","DS/VCXWebKernelCommands/VCXCmdChangeModifiable","DS/VCXWebKernelCommands/VCXCmdChangeComponent","DS/VCXWebKernelCommands/VCXCmdChangeVisibility","DS/VCXWebVisibility/VCXIVisibility"],function(e,t,i,r,a){"use strict";return e.extend({init:function(e,t,i,r){this._parent(),this._commandManager=e,this._dressupManager=t,this._scenarioManager=i,this._ComponentsMap=r,this._dressupsToAdd=[],this._dressupsToRemove=[],this._bLockEvents=!1},GetType:function(){return"VCXCmdChangeDressup"},GetTitle:function(){return"Change Dressup"},RemoveDressups:function(e){this._dressupsToRemove=this._dressupsToRemove.concat(e)},AddDressups:function(e){this._dressupsToAdd=this._dressupsToAdd.concat(e)},Do:function(){var e=new i(this._commandManager,this._ComponentsMap);e.AddComponents(this._dressupsToAdd),this._commandManager.Push(e);var r=new t(this._scenarioManager);r.SetLockEvents(this._bLockEvents),this._dressupsToAdd.forEach(function(e){r.AddModifiables(e.QueryInterface("VCXIModifiable"))}),this._dressupsToRemove.forEach(function(e){r.RemoveModifiables(e.QueryInterface("VCXIModifiable"))}),this._commandManager.Push(r),0!==this._dressupsToAdd.length&&this._dressupManager.AddDressups(this._dressupsToAdd),this._removeDressup();var a=new i(this._commandManager,this._ComponentsMap);a.RemoveComponents(this._dressupsToRemove),this._commandManager.Push(a);var o=this._scenarioManager.GetCurrentScenario(),s=this._scenarioManager._experienceBase.ComponentsMap.GetComponentFromID(o);s&&this._scenarioManager._experienceBase.getManager("VCXExperience")&&this._scenarioManager._experienceBase.getManager("VCXExperience").UpdateScenarioThumbnail(s)},_removeDressup:function(){0!==this._dressupsToRemove.length&&this._dressupManager.RemoveDressups(this._dressupsToRemove),this._bLockEvents||this._dressupManager.RefreshVisuAfterDressupChange()},Undo:function(){0!==this._dressupsToAdd.length&&this._dressupManager.RemoveDressups(this._dressupsToAdd),0!==this._dressupsToRemove.length&&this._dressupManager.AddDressups(this._dressupsToRemove),this._bLockEvents||this._dressupManager.RefreshVisuAfterDressupChange();var e=this._scenarioManager.GetCurrentScenario(),t=this._scenarioManager._experienceBase.ComponentsMap.GetComponentFromID(e);t&&this._scenarioManager._experienceBase.getManager("VCXExperience")&&this._scenarioManager._experienceBase.getManager("VCXExperience").UpdateScenarioThumbnail(t)},Redo:function(){0!==this._dressupsToAdd.length&&this._dressupManager.AddDressups(this._dressupsToAdd),0!==this._dressupsToRemove.length&&this._dressupManager.RemoveDressups(this._dressupsToRemove),this._bLockEvents||this._dressupManager.RefreshVisuAfterDressupChange();var e=this._scenarioManager.GetCurrentScenario(),t=this._scenarioManager._experienceBase.ComponentsMap.GetComponentFromID(e);t&&this._scenarioManager._experienceBase.getManager("VCXExperience")&&this._scenarioManager._experienceBase.getManager("VCXExperience").UpdateScenarioThumbnail(t)},SetLockEvents:function(e){this._bLockEvents=e}})}),define("DS/VCXWebDressup/VCXSectionManager",["UWA/Class","DS/Visualization/ClippingContext","DS/SceneGraphOverrides/SceneGraphOverrideSet","DS/VCXWebModifiables/VCXModelChangeListener","DS/CoreEvents/Events"],function(e,t,i,r,a){"use strict";var o=e.extend({init:function(){},postInitialize:function(){this._clippingContext=null,this._activeSections={};var e=this;this.event_VCX_VIEWER_ADDED=a.subscribe({event:"VCX_VIEWER_ADDED"},function(){e.Dirty=!0,e._cappingActive=null}),this.VCX_DRESSUPS_ADDED=a.subscribe({event:"VCX_DRESSUPS_ADDED"},function(t){e.registerSections(t)}),this.VCX_DRESSUPS_PREREMOVED=a.subscribe({event:"VCX_DRESSUPS_PREREMOVED"},function(t){e.unregisterSections(t)})},getUpdatePriority:function(){return 3},unInitialize:function(){if(a.unsubscribe(this.VCX_DRESSUPS_ADDED),delete this.VCX_DRESSUPS_ADDED,a.unsubscribe(this.VCX_DRESSUPS_PREREMOVED),delete this.VCX_DRESSUPS_PREREMOVED,a.unsubscribe(this.event_VCX_VIEWER_ADDED),delete this.event_VCX_VIEWER_ADDED,this._overrideSet){var e=this._overrideSet;this._clippingOverride&&this._overrideSet.deleteOverride(this._clippingOverride),this._experienceBase.getManager("VCXContextManager").applyToViewers(function(t){t.getSceneGraphOverrideSetManager().removeSceneGraphOverrideSet(e)}),delete this._overrideSet}this._clippingOverride&&(this._clippingOverride.setClippingContext(null),delete this._clippingOverride),this._activeSections&&delete this._activeSections,this._clippingContext&&delete this._clippingContext,this._cutObjects&&delete this._cutObjects},update:function(e){if(this.Dirty){a.publish({event:"VCX_SECTION_LIST_CHANGED",data:this._activeSections}),this.Dirty=!1;var r=[];if(this._overrideSet){var o=this._overrideSet;this._experienceBase.getManager("VCXContextManager").applyToViewers(function(e){e.getSceneGraphOverrideSetManager().removeSceneGraphOverrideSet(o)}),this._overrideSet=null}var s=1,n=0,l=!1;for(var p in this._activeSections){var u=this._activeSections[p];r.push(u._plane);var h=u.QueryInterface("VCXIModifiable");h.GetPropertyValue("Section.SpaceBackAlpha")<h.GetPropertyValue("Section.SpaceFrontAlpha")&&(s=0,n=1),h.GetPropertyValue("Section.Capping")&&(l=!0)}if(this._cappingActive!==l&&(this._cappingActive=l,this._experienceBase.getManager("VCXContextManager").applyToViewers(function(e){l?(e.setRenderPriority(!1),e.setSectionCapping(!0)):e.setSectionCapping(!1)})),0===r.length)return;for(var p in this._clippingContext=new t,this._clippingContext.setPlanes(r),this._clippingContext.setFrontAndBackOpacity(s,n),this._activeSections){u=this._activeSections[p];this._clippingContext.setSectionCappingMaterial(u._cappingMaterial,u._plane)}for(var p in this._cutObjects=[],this._activeSections){var d=!1,c=(u=this._activeSections[p]).QueryInterface("VCXIModifiable").GetProperty("Actor.ListActors");if(c){var y=c.GetPropertyValue().GetValue();if(y&&y.length)for(var m=0;m<y.length;m++){var C=this._experienceBase.ComponentsMap.GetComponentFromID(y[m].GetValue());if(C&&!C.IsKindOf("VCXDressup_Spec")){var f=C.QueryInterface("W3AISGNodeHolder").getPathElement();-1===this._cutObjects.indexOf(f)&&this._cutObjects.push(f),d=!0}}}if(!d){var V=this._experienceBase.getManager("VCXContextManager").getRootPathElement();this._cutObjects.push(V)}}if(!this._overrideSet){var b=this._experienceBase.getManager("VCXContextManager").getRootNode();this._overrideSet=new i(b);o=this._overrideSet;this._experienceBase.getManager("VCXContextManager").applyToViewers(function(e){e.getSceneGraphOverrideSetManager().pushSceneGraphOverrideSet(o)})}this._clippingOverride=this._overrideSet.createOverride(this._cutObjects),this._clippingOverride.setClippingContext(this._clippingContext)}},registerSections:function(e){var t=this;e&&e.forEach(function(e){e.IsKindOf("VCXSection_Spec")&&e.isActive()&&t.registerSection(e)})},unregisterSections:function(e){var t=this;e&&e.forEach(function(e){e.IsKindOf("VCXSection_Spec")&&t.unregisterSection(e)})},registerSection:function(e){this._activeSections[e.GetID()]=e,this.Dirty=!0},unregisterSection:function(e){var t=e.GetID();this._activeSections&&this._activeSections[t]&&(delete this._activeSections[t],this.Dirty=!0)},getActiveSections:function(){return this._activeSections},postUpdate:function(e){this._parent(e)},isCut:function(e,t){for(var i in this._activeSections){if(this._activeSections[i].isCut(e,t))return!0}return!1},preRender:function(e){},postRender:function(e){},getVersion:function(){return"1.0.1"}});return Object.defineProperty(o.prototype,"Dirty",{enumerable:!0,get:function(){return this._Dirty},set:function(e){this._Dirty=e}}),Object.defineProperty(o.prototype,"componentType",{enumerable:!0,get:function(){return"VCXSectionManager"}}),o}),define("DS/VCXWebDressup/VCXComponentDressupGrp",["UWA/Class","i18n!DS/VCXWebDressup/assets/nls/VCXWebDressup"],function(e,t){"use strict";var i=e.extend({init:function(){this._parent(),this._name="Others"},GetType:function(){return this.componentType},setName:function(e){this._name=e},getName:function(){return this._name},getNLSName:function(){return t["TreeNode."+this.getName()]},descriptionDump:function(){return{name:this.getName(),type:this.componentType}}});return Object.defineProperty(i.prototype,"componentType",{enumerable:!0,get:function(){return"VCXComponentDressupGrp"}}),i}),define("DS/VCXWebDressup/VCXDressup_Spec",["DS/VCXWebExperienceBase/VCXComponentOccurrenceExperience","DS/VCXWebKernelTools/VCXMathTools"],function(e,t){"use strict";var i=e.extend({init:function(){this._parent(),this.componentType.startsWith("VCXComponent")&&(this._name=this.componentType.slice(12)),this._IsDressupPropertiesChangeIndependent=!1,this._IsViewPointDependent=!1,this._IsAnchorDependent=!1,this._dirty=!1,this._postUpdateShouldBeDone=!1},GetType:function(){return this.componentType},hasPointedObjectMoved:function(e){var i=this.QueryInterface("VCXIModifiable"),r=i&&i._Anchors;if(!(r&&Object.keys(r).length>0))return!1;if(this._previousAnchors||(this._previousAnchors=[]),null===this._pointedObjectMoved){this._pointedObjectMoved=!1;var a=this;i.processAnchorsIDs(function(r){var o=i.GetAnchorWorldMatrix(r,e);if(!t.IsMat1EqualsToMat2(a._previousAnchors[r],o))return a._previousAnchors[r]=o,a._pointedObjectMoved=!0,!1})}return this._pointedObjectMoved},getWorkingRootComponent:function(){var e=this.QueryInterface("VCXIModelNavigable");if(e){var t=e.getWorkingRoot();return t?t.GetObject():(console.error("No working root for modifiable ??"),null)}console.warn("Not a navigable ??")},getWorkingRootPathElement:function(){var e=this.getWorkingRootComponent();if(e)return e.QueryInterface("W3AISGNodeHolder").getPathElement()},setDirty:function(e){this._dirty=void 0===e||e;var t=this.QueryInterface("W3AISGNodeHolder");t&&t.setSGNodeDirty(this._dirty),this._dirty&&this._experienceBase.getManager("VCXDressupManager").SetDirty()},isDirty:function(){return this._dirty},update:function(e){this._postUpdateShouldBeDone=!0;var t=this.QueryInterface("W3AISGNodeHolder");t&&t.update&&t.update(e)&&this._experienceBase.getManager("VCXContextManager").renderAll()},postUpdate:function(e){if(this._pointedObjectMoved=null,this._postUpdateShouldBeDone){this._postUpdateShouldBeDone=!1;var t=this.QueryInterface("W3AISGNodeHolder");t&&t.postUpdate&&t.postUpdate(e),this.isDirty()&&this.setDirty(!1),this._dirtyMask=0}},preRender:function(e){var t=this.QueryInterface("W3AISGNodeHolder");t&&t.preRender&&t.preRender(e)},postRender:function(e){var t=this.QueryInterface("W3AISGNodeHolder");t&&t.postRender&&t.postRender(e)},descriptionDump:function(){return{name:this._name,type:this.componentType}}});return i.EFreeze={NoFreeze:0,Freeze:1,FreezeInPlay:2},Object.defineProperty(i.prototype,"IsDressupPropertiesChangeIndependent",{enumerable:!0,configurable:!0,get:function(){return this._IsDressupPropertiesChangeIndependent},set:function(e){this._IsDressupPropertiesChangeIndependent=e}}),Object.defineProperty(i.prototype,"IsViewPointDependent",{enumerable:!0,get:function(){return this._IsViewPointDependent},set:function(e){this._IsViewPointDependent=e}}),Object.defineProperty(i.prototype,"IsAnchorDependent",{enumerable:!0,get:function(){return this._IsAnchorDependent},set:function(e){this._IsAnchorDependent=e}}),Object.defineProperty(i.prototype,"IsDressup",{enumerable:!0,writable:!1,value:!0}),Object.defineProperty(i.prototype,"componentType",{enumerable:!0,get:function(){return"VCXDressup_Spec"}}),i.prototype.dressupGroupName="",i.prototype.getDefaultName=function(){return"Dressup"},i}),define("DS/VCXWebDressup/VCXPropertyValueHTMLFormater",["UWA/Class"],function(e){"use strict";var t=e.extend({init:function(){}});return t.dumpDate=function(e,t){return t?"%"===t[0]?e.strftime(t):e.toLocaleDateString(t):e.toUTCString()},t.format=function(e){var i,r,a=e.GetPropertyValue(),o="left";switch(a.GetType()){case"VCXPropertyValueColor":r="border:1px solid #000;background:#"+a.GetThreeColor().getHexString()+";";break;case"VCXPropertyValueFloat":o="right",i=a.Value.toFixed(2);break;case"VCXPropertyValueDate":o="right",i=t.dumpDate(a.Value,"%d/%m/%Y");break;case"VCXPropertyValueInt":o="right",i=a.ToString();break;default:i=a.ToString()}var s="<div style='width:100%;height:100%;text-align:"+o+";";return r&&(s+=r),s+="'>",i&&(s+=i),s+="</div>"},t}),define("DS/VCXWebDressup/VCXPropertyValueUnitFormater",["UWA/Class","i18n!DS/VCXWebDressup/assets/nls/VCXWebDressup"],function(e,t){"use strict";var i=e.extend({init:function(){}});return i.format=function(e,i){var r,a=e.GetPropertyValue(),o=e.GetPropertyInfo();switch(a.GetType()){case"VCXPropertyValueFloat":var s=o.GetUnitType();if(s){var n=i.getManager("VCXUnitManager");if(n)return n.getString(a.Value,s)}return a.Value.toFixed(2);case"VCXPropertyValueEnum":r=a.ToString();var l=o.GetMapChoiceEnum();if(l){r=l[a.Value];var p=t[r];r=void 0===p?"":p}break;default:r=a.ToString()}return r},i}),define("DS/VCXWebDressup/VCXWebDressupDictionary",[],function(){"use strict";var e={VCXDressup_Spec:{VCXIVisibility:"DS/VCXWebDressup/VCXVisibilityDressup",VCXISensible:"DS/VCXWebComposer/VCXASensible",VCXIModelNavigable:"DS/VCXWebDressup/VCXDressupModelNavigable",VCXITreeNode:"DS/VCXWebTreeExtensions/VCXTreeNodeDressup"},CXPCameraActor_Spec:{VCXIModifiable:"DS/VCXWebDressup/VCXCameraModifiable",VCXIModifiableView:"DS/VCXWebDressup/VCXCameraModifiableView",W3AISGNodeHolder:"DS/VCXWebDressup/VCXCameraSGNodeHolder",VCXIViewpointController:"DS/VCXWebDressup/VCXAViewpointController"},VCXViewport_Spec:{VCXIVisibility:"DS/VCXWebVisibilityImpl/VCXVisibilityHidden",VCXIModifiable:"DS/VCXWebDressup/VCXViewportModifiable",VCXIModifiableView:"DS/VCXWebDressup/VCXViewportModifiableView",VCXIModifiableFormatPainter:"DS/VCXWebDressup/VCXViewportModifiable",W3AISGNodeHolder:"DS/VCXWebDressup/VCXViewportSGNodeHolder",VCXIViewpointController:"DS/VCXWebDressup/VCXAViewpointController"},AmbienceModel_Spec:{VCXIModifiable:"DS/VCXWebDressup/VCXAmbienceModifiable",VCXIModifiableView:"DS/VCXWebDressup/VCXAmbienceModifiableView",VCXIModifiableFormatPainter:"DS/VCXWebDressup/VCXAmbienceModifiable",W3AISGNodeHolder:"DS/VCXWebDressup/VCXAmbienceSGNodeHolder",VCXITreeNode:"DS/VCXWebTreeExtensions/VCXTreeNodeAmbience",VCXIReadiness:"DS/WebApplicationBase/VCXAReadiness"},VCXLinearArrow_Spec:{VCXIModifiable:"DS/VCXWebDressup/VCXArrowLinearModifiable",VCXIModifiableView:"DS/VCXWebDressup/VCXArrowLinearModifiableView",VCXIModifiableFormatPainter:"DS/VCXWebDressup/VCXArrowLinearModifiable",W3AISGNodeHolder:"DS/VCXWebDressup/VCXArrowLinearSGNodeHolder"},VCXCircularArrow_Spec:{VCXIModifiable:"DS/VCXWebDressup/VCXArrowCircularModifiable",VCXIModifiableView:"DS/VCXWebDressup/VCXArrowCircularModifiableView",VCXIModifiableFormatPainter:"DS/VCXWebDressup/VCXArrowCircularModifiable",W3AISGNodeHolder:"DS/VCXWebDressup/VCXArrowCircularSGNodeHolder"},VCXCornerArrow_Spec:{VCXIModifiable:"DS/VCXWebDressup/VCXArrowCornerModifiable",VCXIModifiableView:"DS/VCXWebDressup/VCXArrowModifiableView",VCXIModifiableFormatPainter:"DS/VCXWebDressup/VCXArrowCornerModifiable",W3AISGNodeHolder:"DS/VCXWebDressup/VCXArrowCornerSGNodeHolder"},VCXCircle_Spec:{VCXIModifiable:"DS/VCXWebDressup/VCXCircleModifiable",VCXIModifiableView:"DS/VCXWebDressup/VCXCircleModifiableView",VCXIModifiableFormatPainter:"DS/VCXWebDressup/VCXCircleModifiable",W3AISGNodeHolder:"DS/VCXWebDressup/VCXCircleSGNodeHolder"},VCXRedLine_Spec:{VCXIModifiable:"DS/VCXWebDressup/VCXRedLineModifiable",VCXIModifiableView:"DS/VCXWebDressup/VCXRedLineModifiableView",VCXIModifiableFormatPainter:"DS/VCXWebDressup/VCXRedLineModifiable",W3AISGNodeHolder:"DS/VCXWebDressup/VCXRedLineSGNodeHolder"},VCXCompass_Spec:{VCXIModifiable:"DS/VCXWebDressup/VCXCompassModifiable",VCXIModifiableView:"DS/VCXWebDressup/VCXCompassModifiableView",W3AISGNodeHolder:"DS/VCXWebDressup/VCXCompassSGNodeHolder"},VCXPanel_Spec:{VCXIModifiable:"DS/VCXWebDressup/VCXPanelModifiable",VCXIModifiableView:"DS/VCXWebDressup/VCXPanelModifiableView",VCXIModifiableFormatPainter:"DS/VCXWebDressup/VCXPanelModifiable",W3AISGNodeHolder:"DS/VCXWebDressup/VCXPanelSGNodeHolder",VCXIPulseBehavior:"DS/VCXWebPulseManager/VCXPulseBehaviorDressupPanel",VCXIReadiness:"DS/WebApplicationBase/VCXAReadiness"},VCXDiggerPanel_Spec:{VCXIModifiable:"DS/VCXWebDressup/VCXDiggerPanelModifiable",VCXIModifiableView:"DS/VCXWebDressup/VCXPanelModifiableView",W3AISGNodeHolder:"DS/VCXWebDressup/VCXDiggerPanelSGNodeHolder",VCXIPulseBehavior:"DS/VCXWebPulseManager/VCXPulseBehaviorDressupPanel",VCXIReadiness:"DS/WebApplicationBase/VCXAReadiness"},VCXLabel_Spec:{VCXIModifiable:"DS/VCXWebDressup/VCXLabelModifiable",VCXIModifiableView:"DS/VCXWebDressup/VCXLabelModifiableView",VCXIModifiableFormatPainter:"DS/VCXWebDressup/VCXLabelModifiable",W3AISGNodeHolder:"DS/VCXWebDressup/VCXLabelSGNodeHolder",VCXIPulseBehavior:"DS/VCXWebPulseManager/VCXPulseBehaviorDressupPanel"},VCXMeasurement_Spec:{VCXIModifiable:"DS/VCXWebDressup/VCXMeasurementModifiable",VCXIModifiableView:"DS/VCXWebDressup/VCXMeasurementModifiableView",VCXIModifiableFormatPainter:"DS/VCXWebDressup/VCXMeasurementModifiable",W3AISGNodeHolder:"DS/VCXWebDressup/VCXMeasurementSGNodeHolder"},VCXSection_Spec:{VCXIModifiable:"DS/VCXWebDressup/VCXSectionModifiable",VCXIModifiableView:"DS/VCXWebDressup/VCXSectionModifiableView",W3AISGNodeHolder:"DS/VCXWebDressup/VCXSectionSGNodeHolder"},VCXCallout_Spec:{VCXIModifiable:"DS/VCXWebDressup/VCXCalloutModifiable",VCXIModifiableView:"DS/VCXWebDressup/VCXCalloutModifiableView",VCXIModifiableFormatPainter:"DS/VCXWebDressup/VCXCalloutModifiable",W3AISGNodeHolder:"DS/VCXWebDressup/VCXCalloutSGNodeHolder"},VCXPolyline_Spec:{VCXIModifiable:"DS/VCXWebDressup/VCXPolylineModifiable",VCXIModifiableView:"DS/VCXWebDressup/VCXPolylineModifiableView",VCXIModifiableFormatPainter:"DS/VCXWebDressup/VCXPolylineModifiable",W3AISGNodeHolder:"DS/VCXWebDressup/VCXPolylineSGNodeHolder"},VCXComponentDressupGrp:{VCXISensible:"DS/VCXWebComposer/VCXASensible",VCXITreeNode:"DS/VCXWebTreeExtensions/VCXTreeNodeDressupGrp",W3AISGNodeHolder:"DS/VCXWebDressup/VCXDressupGrpSGNodeHolder",VCXIModelNavigable:"DS/VCXWebDressup/VCXDressupModelNavigable"},VCXDressupManager:{W3AISGNodeHolder:"DS/VCXWebDressup/VCXDressupManagerSGNodeHolder",W3AIManager:"DS/WebApplicationBase/W3AAManager",VCXISensible:"DS/VCXWebComposer/VCXASensible",VCXIModelNavigable:"DS/VCXWebDressup/VCXDressupModelNavigable"},VCXSectionManager:{W3AIManager:"DS/WebApplicationBase/W3AAManager"}},t={},i={VCXViewport_Spec:"DS/VCXWebDressup/VCXViewport_Spec",VCXComponentViewport:"DS/VCXWebDressup/VCXViewport_Spec",AmbienceModel_Spec:"DS/VCXWebDressup/AmbienceModel_Spec",VCXLinearArrow_Spec:"DS/VCXWebDressup/VCXLinearArrow_Spec",VCXComponentArrowLinear:"DS/VCXWebDressup/VCXLinearArrow_Spec",VCXCircularArrow_Spec:"DS/VCXWebDressup/VCXCircularArrow_Spec",VCXComponentArrowCircular:"DS/VCXWebDressup/VCXCircularArrow_Spec",VCXCornerArrow_Spec:"DS/VCXWebDressup/VCXCornerArrow_Spec",VCXComponentArrowCorner:"DS/VCXWebDressup/VCXCornerArrow_Spec",VCXCircle_Spec:"DS/VCXWebDressup/VCXCircle_Spec",VCXComponentCircle:"DS/VCXWebDressup/VCXCircle_Spec",VCXPolyline_Spec:"DS/VCXWebDressup/VCXPolyline_Spec",VCXComponentPolyline:"DS/VCXWebDressup/VCXPolyline_Spec",VCXPanel_Spec:"DS/VCXWebDressup/VCXPanel_Spec",VCXComponentPanel:"DS/VCXWebDressup/VCXPanel_Spec",VCXDiggerPanel_Spec:"DS/VCXWebDressup/VCXDiggerPanel_Spec",VCXComponentDiggerPanel:"DS/VCXWebDressup/VCXDiggerPanel_Spec",VCXLabel_Spec:"DS/VCXWebDressup/VCXLabel_Spec",VCXComponentLabel:"DS/VCXWebDressup/VCXLabel_Spec",VCXMeasurement_Spec:"DS/VCXWebDressup/VCXMeasurement_Spec",VCXComponentMeasurement:"DS/VCXWebDressup/VCXMeasurement_Spec",VCXSection_Spec:"DS/VCXWebDressup/VCXSection_Spec",VCXComponentSection:"DS/VCXWebDressup/VCXSection_Spec",VCXCallout_Spec:"DS/VCXWebDressup/VCXCallout_Spec",VCXComponentCallout:"DS/VCXWebDressup/VCXCallout_Spec",VCXComponentDressupGrp:"DS/VCXWebDressup/VCXComponentDressupGrp",VCXRedLine_Spec:"DS/VCXWebDressup/VCXRedLine_Spec",VCXComponentRedLine:"DS/VCXWebDressup/VCXRedLine_Spec",VCXCompass_Spec:"DS/VCXWebDressup/VCXCompass_Spec",VCXComponentCompass:"DS/VCXWebDressup/VCXCompass_Spec",CXPCameraActor_Spec:"DS/VCXWebDressup/CXPCameraActor_Spec",VCXComponentCamera:"DS/VCXWebDressup/CXPCameraActor_Spec",VCXExperience:"DS/VCXWebComposer/VCXExperience",VCXDressupManager:"DS/VCXWebDressup/VCXDressupManager",VCXSectionManager:"DS/VCXWebDressup/VCXSectionManager"},r=["VCXWebDressup/VCXWebDressup"];return{GetDictionary:function(){return{interfaces:t,components:i,extensions:e}},getNLSModules:function(){return r}}}),define("DS/VCXWebDressup/VCXVisibilityDressup",["DS/VCXWebVisibility/VCXVisibility"],function(e){"use strict";return e.extend({init:function(){this._parent(),this._visible=0},GetType:function(){return"VCXVisibilityDressup"},SetVisibility:function(e){var t=e;if("boolean"==typeof e)console.warn("Method SetVisibility use only a number as unique parameter"),t="number"!=typeof e||1!==e&&0!==e?!0===e?1:!1===e?0:-1:e;else if("number"!=typeof e)return void console.warn("Method SetVisibility use only a number as unique parameter");this._parent(t),this.GetObject().setDirty()}})}),define("DS/VCXWebDressup/VCXPropertiesObserver",["UWA/Class"],function(e){"use strict";return e.extend({init:function(e){this._observedProperties=[],this._dirtyProperties=0},add:function(e,t){var i=e.QueryInterface("VCXIModifiable");if(i&&t){var r=i.GetProperty(t),a=null;r&&(a=r.GetPropertyValue()),this._observedProperties.push({modifiable:i,propertyName:t,previousPropertyValue:null,currentPropertyValue:a,dirty:!0}),this._dirtyProperties++}},update:function(){for(var e=0;e<this._observedProperties.length;e++){var t=!1,i=this._observedProperties[e].modifiable.GetProperty(this._observedProperties[e].propertyName),r=null;i&&(r=i.GetPropertyValue());var a=this._observedProperties[e].currentPropertyValue;a?a.IsEqualTo(r)||(t=!0):r&&(t=!0),t&&(this._observedProperties[e].previousPropertyValue=a,this._observedProperties[e].currentPropertyValue=r,this._dirtyProperties++)}},dirtify:function(){this._dirtyProperties++},postUpdate:function(){this._dirtyProperties=0;for(var e=0;e<this._observedProperties.length;e++)this._observedProperties[e].dirty=!1},isDirty:function(){return this._dirtyProperties>0}})}),define("DS/VCXWebDressup/CXPCameraActorVCXCXPConvertor",["DS/VCXWebDressup/CXPDressupVCXCXPConvertor"],function(e){"use strict";var t=e.extend({init:function(){this._tab=[{variableName:"_varName",propertyName:"Actor.Name"},{variableName:"viewAngle",propertyName:"Ambience.Background.Radius"},{variableName:"projectionType",propertyName:"Ambience.Background.Position",NFVFunction:function(e){return 0!==e},VFNFunction:function(e){return e?1:0}},{variableName:"focusDistance",propertyName:"Ambience.Background.Rotation"}]}});return Object.defineProperty(t.prototype,"componentType",{enumerable:!0,get:function(){return"CXPCameraActorVCXCXPConvertor"}}),t}),define("DS/VCXWebDressup/VCXRedLine_Spec",["DS/VCXWebDressup/VCXDressup_Spec"],function(e){"use strict";var t=e.extend({init:function(){this._parent(),this.IsAnchorDependent=!0}});return t.prototype.getDefaultName=function(){return"Redline"},Object.defineProperty(t.prototype,"componentType",{enumerable:!0,get:function(){return"VCXRedLine_Spec"}}),t.prototype.dressupGroupName="Markups",t}),define("DS/VCXWebDressup/VCXSection_Spec",["DS/VCXWebDressup/VCXDressup_Spec","DS/Visualization/ThreeJS_DS","DS/VCXWebProperties/VCXColor","DS/VCXWebDressup/VCXPropertiesObserver","DS/VCXWebVisibility/VCXIVisibility"],function(e,t,i,r,a){"use strict";var o=e.extend({init:function(){this._parent(),this.IsAnchorDependent=!0,this._keyValues={},this._plane=null,this._planeClipped=!1,this._cappingMaterial=null,this._previousSectionActive=!1,this.alpha=.15},isCut:function(e,i){var r=!1,a=this;return this._plane&&this.sectionActive&&e.GetPropertyValue("Collab.Attach.3DAttach")&&e.GetPropertyGroupVisibility("Group.Attach")?(r=!0,e.processAnchorsIDs(function(o){var s=e._Anchors[o];if(s){var n=e.GetAnchorWorldMatrix(o,i).clone();if(a._plane.distanceToPoint((new t.Vector3).getPositionFromMatrix(n))>0)return r=!1,!1;var l=s.GetValueLink();if(l&&l.Value&&!a.isInCuttedObjectList(l.Value))return r=!1,!1}}),r):r},isInCuttedObjectList:function(e){var t=!1,i=this.QueryInterface("VCXIModifiable").GetProperty("Actor.ListActors");if(i){var r=i.GetPropertyValue().GetValue();if(r&&r.length)for(var a=0;a<r.length;a++)if(t=!0,r[0].GetValue()===e)return!0}return!t},preRender:function(e){if(this._plane){var i=this.QueryInterface("VCXIModifiable"),r=this.QueryInterface("W3AISGNodeHolder").getWorldMatrix(e.viewer);this._plane.set(new t.Vector3(0,0,1),0).applyMatrix4(r),i.GetPropertyValue("Section.AutoFlip")&&e.viewpoint.getSightDirection().dot(this._plane.normal)<0&&this._plane.negate()}this._parent(e)},isActive:function(){var e=this.QueryInterface("VCXIVisibility");if(e&&e.GetVisibility()!==a.EVisState.Hidden){var t=this.QueryInterface("VCXIModifiable");if(t&&t.GetPropertyValue("Section.Enable")&&t.GetPropertyValue("Actor.Visibility.Opacity")>.5)return!0}return!1},update:function(e){if(this.recomputeSectionManager&&(this.recomputeSectionManager.update(),this.recomputeSectionManager.isDirty()&&this._experienceBase.getManager("VCXSectionManager")&&(this._experienceBase.getManager("VCXSectionManager").Dirty=!0)),this.sectionActive=this.isActive(),this._previousSectionActive!==this.sectionActive&&(this._previousSectionActive=this.sectionActive,this.sectionActive?this._experienceBase.getManager("VCXSectionManager").registerSection(this):this._experienceBase.getManager("VCXSectionManager").unregisterSection(this)),this._plane||(this._plane=new t.Plane(new t.Vector3(0,0,-1),0)),this.sectionActive){if(!this.recomputeSectionManager){this.recomputeSectionManager=new r;var a=this.QueryInterface("VCXIModifiable");this.recomputeSectionManager.add(a,"Section.Enable"),this.recomputeSectionManager.add(a,"Section.SpaceBackAlpha"),this.recomputeSectionManager.add(a,"Section.Capping"),this.recomputeSectionManager.add(a,"Section.Capping.ActorColor")}if(!this._cappingMaterial){a=this.QueryInterface("VCXIModifiable");this._experienceBase.getManager("VCXContextManager").getMainViewer().setClippingPlaneUpVector(this._plane,new t.Vector3(0,0,1));var o=Math.cos(a.GetPropertyValue("Section.Hatching.Angle")*Math.PI/180),s=Math.sin(a.GetPropertyValue("Section.Hatching.Angle")*Math.PI/180),n=a.GetColorPropertyValue("Section.Capping");a.GetColorPropertyValue("Section.Hatching");this._cappingMaterial=new t.HatchingMeshMaterial({stripesDirection:new t.Vector2(o+s,s-o),spaceWidth:10,stripesWidth:1.5,spaceColor:n.GetThreeColor(),stripesColor:(new i).FromRGBA(1,0,0).GetThreeColor()})}}return this._parent(e)},postUpdate:function(e){this._parent(),this.sectionActive&&this.recomputeSectionManager&&this.recomputeSectionManager.postUpdate()},Dispose:function(){this._experienceBase.getManager("VCXSectionManager").unregisterSection(this)}});return o.prototype.getDefaultName=function(){return"Section"},Object.defineProperty(o.prototype,"componentType",{enumerable:!0,get:function(){return"VCXSection_Spec"}}),o.prototype.dressupGroupName="Sections",o}),define("DS/VCXWebDressup/VCXCompass_Spec",["DS/VCXWebDressup/VCXDressup_Spec"],function(e){"use strict";var t=e.extend({init:function(){this._parent()}});return t.prototype.getDefaultName=function(){return"Compass"},Object.defineProperty(t.prototype,"componentType",{enumerable:!0,get:function(){return"VCXCompass_Spec"}}),t.prototype.dressupGroupName="Environment",t}),define("DS/VCXWebDressup/AmbienceModelVCXCXPConvertor",["DS/VCXWebDressup/CXPDressupVCXCXPConvertor"],function(e){"use strict";var t=e.extend({init:function(){this._tab=[{variableName:"_varName",propertyName:"Actor.Name"},{variableName:"Dome Origin",propertyName:"Ambience.Background.Position",type:"Vector3"},{variableName:"Dome Radius",propertyName:"Ambience.Background.Radius"},{variableName:"Dome Rotation Z",propertyName:"Ambience.Background.Rotation"},{variableName:"Exposure",propertyName:"Ambience.Background.Exposure"},{variableName:"Finite Dome",propertyName:"Ambience.Background.Finite"},{variableName:"Ground Glossiness",propertyName:"Ambience.Ground.Glossiness"},{variableName:"Ground Offset",propertyName:"Ambience.Ground.Offset"},{variableName:"Ground Reflectivity",propertyName:"Ambience.Ground.Reflectivity"},{variableName:"Ground Scale Ratio",propertyName:"Ambience.Ground.Scaleratio"}]}});return Object.defineProperty(t.prototype,"componentType",{enumerable:!0,get:function(){return"AmbienceModelVCXCXPConvertor"}}),t}),define("DS/VCXWebDressup/AmbienceModel_Spec",["DS/VCXWebDressup/VCXDressup_Spec","DS/VCXWebVisibility/VCXIVisibility","DS/Visualization/ThreeJS_DS"],function(e,t,i){"use strict";var r=e.extend({init:function(){this._parent()},updatePosition:function(){if(!this._ambience)return!1;var e=this.QueryInterface("VCXIVisibility");if(e&&e.GetVisibility()!==t.EVisState.Hidden){var r=this.QueryInterface("VCXIModifiable");if(r)this._experienceBase.getManager("VCXVisuManager").updateGroundPosition({radius:r.GetPropertyValue("Ambience.Background.Radius.Auto")?-1:r.GetPropertyValue("Ambience.Background.Radius"),position:r.GetPropertyValue("Ambience.Background.Position.Auto")?null:r.GetPropertyValue("Ambience.Background.Position"),ambience:this._ambience}),this._ambience.setAutoGroundOffset(!1),this._ambience.setGroundHeight(new i.Vector3(0,0,r.GetPropertyValue("Ambience.Ground.Scaleratio")/6)),this._ambience.setGroundOffset(r.GetPropertyValue("Ambience.Ground.Offset")),this._ambience.getTransform().makeRotationZ(r.GetPropertyValue("Ambience.Background.Rotation")*Math.PI/180),this._ambience.updateMatrix(),this._ambience.setFiniteMode(r.GetPropertyValue("Ambience.Background.Finite"))}}});return r.prototype.getDefaultName=function(){return"Ambience"},Object.defineProperty(r.prototype,"componentType",{enumerable:!0,get:function(){return"AmbienceModel_Spec"}}),r.prototype.dressupGroupName="Environment",r}),define("DS/VCXWebDressup/VCXPolyline_Spec",["DS/VCXWebDressup/VCXDressup_Spec"],function(e){"use strict";var t=e.extend({init:function(){this._parent(),this.IsAnchorDependent=!0}});return t.prototype.getDefaultName=function(){return"Polyline"},Object.defineProperty(t.prototype,"componentType",{enumerable:!0,get:function(){return"VCXPolyline_Spec"}}),t.prototype.dressupGroupName="Markups",t}),define("DS/VCXWebDressup/CXPCameraActor_Spec",["DS/VCXWebDressup/VCXDressup_Spec"],function(e){"use strict";var t=e.extend({init:function(){this._parent(),this.IsViewPointDependent=!1,this.IsAnchorDependent=!0,this._tooltip=""},updatePosition:function(){var e=this.GetObject()._experienceBase.getManager("VCXVisuManager");(t=this.QueryInterface("VCXIViewpointController"))&&(t.resetMatrixAndDOI(),e.CameraControlsViewpoint&&this.QueryInterface("VCXIModifiable").GetProperty("Actor.IsActive").GetPropertyValue().Value&&t.toViewpoint());var t,i=e.getActiveViewport();i&&((t=i.QueryInterface("VCXIViewpointController"))&&t.fromViewpoint())}});return t.prototype.getDefaultName=function(){return"Camera"},Object.defineProperty(t.prototype,"componentType",{enumerable:!0,get:function(){return"CXPCameraActor_Spec"}}),t.prototype.dressupGroupName="Cameras",t}),define("DS/VCXWebDressup/VCXMarkup_Spec",["UWA/Class","DS/VCXWebDressup/VCXDressup_Spec","DS/VCXWebDressup/VCXPropertyValueUnitFormater"],function(e,t,i){"use strict";var r=t.extend({init:function(e){this._parent(e),this.fontHeight=12},isDirty:function(){var e=this.QueryInterface("VCXIModifiable");if(e.GetPropertyGroupVisibility("Group.Text")){var t=e.GetComputedStringProperty("Collab.Text",i.format);if(t||(t=""),this._currentText!==t)return this._currentText=t,!0}return this._parent()},clearImage:function(){delete this.backgroundImage,delete this.imagePromise,this._imageType=-1,this._docID=-10},getImage:function(e){this._imageType=e;var t=this,i=this.QueryInterface("VCXIModifiable");if(i){var r=i.GetPropertyValue("Collab.Image.Doc.ID");if(null!=r&&i.GetPropertyGroupVisibility("Group.Image")||(r=-1),this._imageType===e&&this._docID===r){if(this.imagePromise)return this.imagePromise}else this.clearImage();return this._imageType,this._docID,r>=0?this.imagePromise=this._experienceBase.getManager("VCXImageManager").GetImageFromDocID(r,e).then(function(e){return t.backgroundImage=e,e}):(this.backgroundImage=null,this.imagePromise?this.imagePromise.resolve(null):this.imagePromise=UWA.Promise.resolve(null)),this.imagePromise}this.imagePromise.reject(new Error("Component does not implement modifiable"))}});return r.EHAlignment={Left:0,Center:1,Right:2},r.EVAlignment={Top:0,Middle:1,Bottom:2},r.EHTextAlignment={Left:0,Centered:1,Justified:3,Right:2},r.EVTextAlignment={Top:0,Middle:1,Bottom:2},r.EBodyShape={None:0,Rectangle:10,RoundedRectangle:1,Square:20,RoundedSquare:2,Ellipse:4,Circle:3,Rhombus:5,RemoveBorder:6,User:7,CircumscribedCircle:8},r.ESizeControlType={None:0,Paper:1},r.EBillboardType={None:0,Spherical:2,AlongX_yInCamUp:4},r.EPositionType={Perimetric:0,Circle:1,Rectangle:2,Bottom:3,BottomAndLeft:4,BottomAndRight:5,BottomAndTop:6,Top:7,TopAndLeft:8,TopAndRight:9,Left:10,LeftAndRight:11,Right:12,EndOfAutomaticPositionning:13,RelativeToReferential:101,Free2D:1e3,Free3D:1001},r.EAttachType={None:0,Model:1,Vertex:2,GradientTooltip:3,TooltipStyle:4,Line:5,User:6,Simple:7,ArcTooltip:8,Arrow:9,Basic:30,Modern:100,Custom:101},r.EExtremityType={None:0,Sphere:1,FullArrow_1:2,FullArrow_2:3,HalfArrow_B1:4,HalfArrow_T1:5,HalfArrow_T2:6,HalfArrow_B2:7,Dot:20,Yellow:10,Red:40,Line:45,SmallRed:50},r.ELeadType={None:0,Middle:10,Bent:20,Line:30,Mustache:40},Object.defineProperty(r.prototype,"componentType",{enumerable:!0,get:function(){return"VCXMarkup_Spec"}}),Object.defineProperty(r.prototype,"IsDressupPropertiesChangeIndependent",{enumerable:!0,get:function(){if(this._IsDressupPropertiesChangeIndependent)return!0;var e=this.QueryInterface("VCXIModifiable");return!!(e&&e.GetPropertyValue("Collab.3D.Paper.Positioning.Type")<r.EPositionType.EndOfAutomaticPositionning)||this._IsDressupPropertiesChangeIndependent}}),r}),define("DS/VCXWebDressup/VCXCallout_Spec",["DS/VCXWebDressup/VCXMarkup_Spec"],function(e){"use strict";var t=e.extend({init:function(){this._parent(),this._IsAnchorDependent=!0},isDirty:function(){return!(!this.QueryInterface("VCXIVisibility").GetVisibility()||!this.QueryInterface("VCXIModifiable").GetPropertyValue("Collab.Body.ContributeToEqualSize"))||this._dirty}});return t.prototype.getDefaultName=function(){return"Callout"},Object.defineProperty(t.prototype,"componentType",{enumerable:!0,get:function(){return"VCXCallout_Spec"}}),t.prototype.dressupGroupName="Callouts",t}),define("DS/VCXWebDressup/VCXDressupNode",["DS/Visualization/Node3D","DS/VCXWebDressup/VCXMarkup_Spec","DS/VCXWebDressup/VCXPropertiesObserver","DS/VCXWebModifiables/VCXModelChangeListener"],function(e,t,i,r){"use strict";var a=e.extend({init:function(e){this._parent(e.name),this._globalOpacity=null;return this._Modifiable=e.modifiable,this._Modifiable?this._ExperienceBase=this._Modifiable.ExperienceBase:this._ExperienceBase=e.experience,this.Dirty=!0,this.Modifiable&&(this.layerObserver=new i,this.layerObserver.add(this.Modifiable,"Actor.IsAlwaysOnTop"),this.layerObserver.add(this.Modifiable,"Collab.3D.Paper.Positioning.Type"),this.layerObserver.add(this.Modifiable,"Collab.3D.Paper.Is.Background")),this._handles={},this},dispose:function(){delete this._ExperienceBase,delete this._Modifiable,delete this.layerObserver,delete this._overrides,this._parent()},GetPropertyValue:function(e,t){return this.Modifiable.GetPropertyValue(e,t)},GetFontPropertyValue:function(e){return this.Modifiable.GetFontPropertyValue(e)},GetColorPropertyValue:function(e){return this.Modifiable.GetColorPropertyValue(e)},GetFramePropertyValue:function(e){return this.Modifiable.GetFramePropertyValue(e)},GetAnchorValue:function(e){return this.Modifiable.GetAnchorValue(e)},GetAnchorWorldMatrix:function(e,t){return this.Modifiable.GetAnchorWorldMatrix(e,t)},GetPropertyGroupVisibility:function(e){return this.Modifiable.GetPropertyGroupVisibility(e)},GetOpacity:function(){return this.Modifiable.GetOpacity()},RecursiveSetRenderDepth:function(e){this.traverse(function(e,t){e.setRenderDepth&&void 0!==t?e.setRenderDepth(t):e.renderDepth=t},e)},RecursiveSetRenderPasses:function(e){this.traverse(function(e,t){e.setRenderPasses&&(e.noAA&&t.noAA?e.setRenderPasses(t.noAA):e.setRenderPasses(t.AA))},e)},onAddChildNode:function(e,t){var i={noTreatment:!1,setFrustumCulled:!1,setShadow:!1,setMirror:!1,exludeFromBounding:!0,setPickParent:!0,setSSAO:!1};if(UWA.extend(i,t,!0),!(this.isDressupGrp||e&&e.isDressupGrp||i.noTreatment)){e.traverse(function(e){e.setFrustumCulled&&e.setFrustumCulled(i.setFrustumCulled),e.setShadow&&e.setShadow(i.setShadow,i.setShadow),e.setMirror&&e.setMirror(i.setMirror),e.exludeFromBounding&&e.exludeFromBounding(i.exludeFromBounding),e.setPickParent&&e.setPickParent(i.setPickParent)});var r=this.getParents()&&this.getParents()[0];r?r&&r.isDressupGrp&&this.setPickParent(!1):this.setPickParent(!1)}},add:function(e,t){var i=this._parent(e);return this.onAddChildNode(e,t),i},addChild:function(e,t){var i=this._parent(e);return this.onAddChildNode(e,t),i},getOverride:function(e){this._overrides||(this._overrides={});var t=this._overrides[e.viewerID];return t||(t=this.ExperienceBase.getManager("VCXDressupManager").getDressupDressupNodeOverride(e,this),this._overrides[e.viewerID]=t),t},update:function(e){var t=this.GlobalOpacity;t<=0&&(this.lastAlwaysOnTop=null);var i=!1;if(this._previousOpacity!==t&&(0===this._previousOpacity||0===t)){var a=this._ExperienceBase.getManager("VCXModelChangeListener");a&&(a.hasChanged(r.FChangeFlag.DressupVisibility,!0),a.hasChanged(r.FChangeFlag.Visibility,!0)),this._previousOpacity=t,i=!0}(t||i)&&this.layerObserver&&(this.layerObserver.update(),this.layerObserver.isDirty()&&(this.needToChangeLayer=!0))},postUpdate:function(e){this.layerObserver&&this.layerObserver.postUpdate(e)},preRender:function(e){if(!(e&&e.viewer&&e.viewer._isDigger)){var t=this.Modifiable.ExperienceBase;if(this.viewpointVisibility=!0,this.GlobalOpacity){var i=t.getManager("VCXVisuManager"),r=t.getManager("VCXIVManager");if(i.isInFrustum(e,this.Modifiable)||r&&r.scenario){var a=t.getManager("VCXSectionManager");a&&(this.viewpointVisibility=!a.isCut(this.Modifiable,e))}else this.viewpointVisibility=!1}}},handleLayers:function(e){this.alwaysOnTop=this.GetPropertyValue("Actor.IsAlwaysOnTop");var i=this.ExperienceBase.getManager("VCXIVManager");if(i&&i.scenario)this.RecursiveSetRenderPasses(["main"]);else{if(this.lastAlwaysOnTop!==this.alwaysOnTop||e||this.needToChangeLayer){this.needToChangeLayer=!1;var r=this.ExperienceBase.getManager("VCXVisuManager");this.Modifiable.QueryInterface("W3AISGNodeHolder").giveSGNode();this.GetPropertyValue("Collab.3D.Paper.Positioning.Type")<=t.EPositionType.Free2D?this.GetPropertyValue("Collab.3D.Paper.Is.Background")?this.RecursiveSetRenderPasses({AA:[r.getRenderList("VCXBackground2DDressups")]}):this.GetPropertyValue("Collab.3D.Paper.Positioning.Type")<t.EPositionType.EndOfAutomaticPositionning?this.RecursiveSetRenderPasses({AA:[r.getRenderList("VCXPre2DDressups"),r.getRenderList("VCX2DDressups")],noAA:[r.getRenderList("VCXPre2DDressups"),r.getRenderList("VCXNoAADressups")]}):this.RecursiveSetRenderPasses({AA:[r.getRenderList("VCXPre2DDressups"),r.getRenderList("VCX2DDressups2"),"PassToCheckAvailableSpace"],noAA:[r.getRenderList("VCXPre2DDressups"),r.getRenderList("VCXNoAADressups"),"PassToCheckAvailableSpace"]}):this.alwaysOnTop?this.RecursiveSetRenderPasses({AA:[r.getRenderList("VCXNOc3DDressups")],noAA:[r.getRenderList("VCXPre2DDressups"),r.getRenderList("VCXNoAADressups")]}):this.RecursiveSetRenderPasses({AA:["main"]})}this.lastAlwaysOnTop=this.alwaysOnTop}},isNodeBuilt:function(){var e=this.Modifiable.QueryInterface("W3AISGNodeHolder").giveSGNode();return Boolean(e)}});return Object.defineProperty(a.prototype,"ExperienceBase",{enumerable:!0,get:function(){return this._ExperienceBase?this._ExperienceBase:this._Modifiable?this._Modifiable.ExperienceBase:void 0}}),Object.defineProperty(a.prototype,"Modifiable",{enumerable:!0,get:function(){return this._Modifiable}}),Object.defineProperty(a.prototype,"Anchors",{enumerable:!0,get:function(){return this.Modifiable._Anchors}}),Object.defineProperty(a.prototype,"GlobalOpacity",{enumerable:!0,get:function(){return this.GetOpacity()}}),a}),define("DS/VCXWebDressup/VCXDressupManagerSGNodeHolder",["DS/WebApplicationBase/W3AASGNodeHolder","DS/Visualization/PathElement","DS/VCXWebDressup/VCXDressupNode"],function(e,t,i){"use strict";return e.extend({init:function(){},buildSGNode:function(){if(!this._sgNode){this._sgNode=new i({name:"Design"}),this._sgNode.setIcon("../VCXWebDressup/assets/icons/32/I_VCX_Panel_Tree_DressupManagerLeaf.png")}return this.GetObject()._experienceBase.getManager("VCXContextManager").getMainViewer().addNode(this._sgNode),this._pathElement=new t,this._pathElement.setFromArray([this._sgNode]),this._sgNode},isSelfManagedPathElement:function(){return!0}})}),define("DS/VCXWebDressup/VCXDressupGrpSGNodeHolder",["DS/WebApplicationBase/W3AASGNodeHolder","DS/VCXWebDressup/VCXDressupNode"],function(e,t){"use strict";return e.extend({init:function(){},buildSGNode:function(){if(!this._sgNode){var e=this.GetObject().QueryInterface("VCXIModifiable"),i={name:this.GetObject().getName(),modifiable:e};this._sgNode=new t(i),this._sgNode.isDressupGrp=!0}this._sgNode.setVisibilityInTree(!1);var r=this.QueryInterface("VCXIModelNavigable");if(r){var a=r.getParent().QueryInterface("W3AISGNodeHolder");a&&(a.getSGNode().addChild(this._sgNode,{noTreatment:!0}),this._pathElement=a.getPathElement().clone(),this._pathElement.addElement(this._sgNode))}return this._sgNode},isSelfManagedPathElement:function(){return!0}})}),define("DS/VCXWebDressup/VCXDressupSGNodeHolder",["DS/WebApplicationBase/W3AASGNodeHolder","DS/Visualization/ThreeJS_DS","DS/VCXWebDressup/VCXMarkup_Spec"],function(e,t,i){"use strict";return e.extend({init:function(){},buildSGNode:function(){return this._sgNode&&(this._sgNode.setVisibilityInTree(!0),this._sgNode._isDressupNode=!0),this._sgNode},getWorldMatrix:function(e,t){return this.getAnchorReferential(t)},getAnchorReferential:function(e){var r=new t.Matrix4,a=this.QueryInterface("VCXIModifiable");if(a){var o=this.GetObject()._experienceBase.getManager("VCXContextManager"),s=e;if(!s){var n=o.getMainViewer();s={viewer:n,viewpoint:n.currentViewpoint}}var l=a.getAnchorsCount();if(0===l)return this.computePointAtOptimalDistance(s);a.GetPropertyValue("Collab.3D.Paper.UsesBarycenter")||(l=1);var p=new t.Vector3,u=this;a.processAnchorsIDs(function(e){if(a.GetPropertyValue("Collab.3D.Paper.Referential.In.World")||1!==l){var n=a.GetAnchorWorldMatrix(e,s),h=(new t.Vector3).getPositionFromMatrix(n);h.divideScalar(l),p.add(h);var d=u.GetObject().getWorkingRootPathElement();r.makeTranslation(p.x,p.y,p.z).extractRotation(d.getWorldMatrix(o.getMainViewer()))}else r=a.GetAnchorWorldMatrix(e,s);var c=a.GetPropertyValue("Collab.3D.Paper.Positioning.Type"),y=c<=i.EPositionType.Free2D,m=c===i.EPositionType.RelativeToReferential;if(a.GetProperty("Collab.Attach.Show")&&a.GetPropertyGroupVisibility("Group.Attach")&&(a.GetPropertyValue("Collab.Attach.LeadType")||a.GetPropertyValue("Collab.Measurement.Attach.Type"))||!y||m||(r=u.computePointAtOptimalDistance(s)),!a.GetPropertyValue("Collab.3D.Paper.UsesBarycenter"))return!1},{sort:!0})}return r},getCenterSceneBoundingSphereMat:function(e,i){var r=i instanceof t.Matrix4?i:new t.Matrix4,a=this.GetObject()._experienceBase.getManager("VCXPaperManager");if(!a)return console.warn("Couldn't find the PaperManager, return input matrix"),r;var o=e.viewer.getSceneBoundingSphere().center.clone(),s=a.ModelToMM2(e,o),n=(new t.Vector3).getPositionFromMatrix(r);return a.ModelToMM2(e,n).z=s.z,n=a.MMToModel2(e,s),(new t.Matrix4).setPosition(n)},computePointAtOptimalDistance:function(e){var i=e.viewpoint.camera.fov,r=e.viewer.getSceneBoundingSphere().radius;null===!this.tanFov&&this.oldFov===i||(this.oldFov=i,this.tanFov=Math.tan(i*Math.PI/180));var a=r/this.tanFov,o=e.viewpoint.camera.position.clone();return o.add(e.viewpoint.getSightDirection().clone().multiplyScalar(a)),(new t.Matrix4).setPosition(o)},getPathElement:function(){return this._pathElement?this._pathElement:this._sgNode?(console.warn("???? Ask ITY"),this._pathElement):null},unreferenceSGNode:function(){this._sgNode&&(this._sgNode.dispose&&this._sgNode.dispose(),delete this._sgNode)},isSelfManagedPathElement:function(){return!0}})}),define("DS/VCXWebDressup/VCXSmart3DPaperNode",["DS/VCXWebDressup/VCXDressupNode","DS/VCXWebDressup/VCXMarkup_Spec","DS/Visualization/ThreeJS_DS","DS/VCXWebKernelTools/VCXMathTools","DS/CoreEvents/Events"],function(e,t,i,r,a){"use strict";var o=e.extend({init:function(e){return this._parent(e),this._Depth=0,this._VerticalToUse=o.VerticalToUseEnum.CAMERA,this._BillboardDirectionType=o.BillboardDirectionTypeEnum.CAMERA_DIRECTION,this._Position2D=new i.Vector2,this._Position=new i.Vector3,this._PositioningType=t.EPositionType.Free3D,this._PositionRadius=0,this._ScalingFactor=1,this._SizeControlType=0,this._BillboardType=o.BillboardTypeEnum.NO_BILLBOARD,this._Opacity=1,this._ModifiableProperties=!0,this._posDirty=!0,this},_ComputeBillboardMatrix:function(e,t,a){var s=(new i.Matrix4).extractRotation(this.GetReferential(e)),n=e.viewpoint.getEyePosition(),l=e.viewpoint.getSightDirection().clone();l.normalize();var p,u=this.ExperienceBase.getManager("VCXIVManager")&&this.ExperienceBase.getManager("VCXIVManager").scenario;p=this.VerticalToUse!==o.VerticalToUseEnum.CAMERA||u?new i.Vector3(0,0,1):e.viewpoint.getUpDirection();var h;new i.Matrix4;if(this.BillboardDirectionType===o.BillboardDirectionTypeEnum.CAMERA_DIRECTION?h=(new i.Vector3).subVectors(t,l):this.BillboardDirectionType===o.BillboardDirectionTypeEnum.CAMERA_POSITION&&(h=n.clone()),this.BillboardType===o.BillboardTypeEnum.CYLINDRICAL);else if(this.BillboardType===o.BillboardTypeEnum.SPHERICAL)s=(new i.Matrix4).lookAt(h,t,p);else if(this.BillboardType===o.BillboardTypeEnum.PRESERVE_X_AXIS_Y_IN_CAM_PLANE||this.BillboardType===o.BillboardTypeEnum.PRESERVE_X_AXIS_Y_IN_CAM_PLANE_Y_ALWAYS_UP){var d;d=this.BillboardXAxis?this.BillboardXAxis:r.getVxFromMatrix(a).normalize();var c=e.viewpoint.getSightDirection(),y=(new i.Vector3).crossVectors(p,c).normalize();s=(new i.Matrix4).lookAt(h,t,p);var m=this.ExperienceBase.getManager("VCXPaperManager");if(m){var C=m.ModelToMM2(e,t),f=m.ModelToMM2(e,(new i.Vector3).addVectors(t,d)).sub(C).normalize(),V=m.ModelToMM2(e,(new i.Vector3).addVectors(t,y)).sub(C).normalize(),b=(new i.Vector3).crossVectors(f,V),P=new i.Quaternion(0,0,b.z,1+f.dot(V));P.normalize(),s.multiply((new i.Matrix4).makeRotationFromQuaternion(P)),this.BillboardType===o.BillboardTypeEnum.PRESERVE_X_AXIS_Y_IN_CAM_PLANE_Y_ALWAYS_UP&&V.dot(f)<.001&&s.multiply((new i.Matrix4).makeRotationZ(Math.PI))}}return s},_Build:function(){},is2D:function(){return this.PositioningType==t.EPositionType.Free2D||this.PositioningType<t.EPositionType.EndOfAutomaticPositionning},GetReferential:function(e){if(this._referential)return this._referential;if(this.Modifiable&&this.ExperienceBase){var t=this.Modifiable.QueryInterface("W3AISGNodeHolder"),r=e.viewer||this.ExperienceBase.getManager("VCXContextManager").getMainViewer();return t.getWorldMatrix(r,e)}return new i.Matrix4},SetReferential:function(e){this._referential=e},_computeMatrix:function(e,a){var o=this.Position.clone();if(this.PositioningType===t.EPositionType.Free3D)o.applyMatrix4(this.GetReferential(e));else if(this.PositioningType===t.EPositionType.RelativeToReferential){var s=this.ExperienceBase.getManager("VCXPaperManager"),n=(new i.Vector3).getPositionFromMatrix(this.GetReferential(e));o=s.GetModelPointFromModelPointAndPaperPosition(e,n,this.Position2D,this.PositionRadius)}else if(this.PositioningType<=t.EPositionType.Free2D){n=(new i.Vector3).getPositionFromMatrix(this.GetReferential(e));var l=this.ExperienceBase.getManager("VCXPaperManager").ModelToMM2(e,n),p=r.clamp(l.z,-.99,.99);(C=new i.Vector3).x=this.Position2D.x,C.y=this.Position2D.y,C.z=p,o=this.ExperienceBase.getManager("VCXPaperManager").MMToModel2(e,C)}var u=1;if(1===this.SizeControlType)u=this.ExperienceBase.getManager("VCXPaperManager").GetPaperRatio(e,o);else if(2===this.SizeControlType){var h=e.viewpoint.getEyePosition().distanceTo(o);h||(h=1);var d=.5*e.viewer.div.clientHeight*Math.abs(1/(Math.tan(Math.PI*e.viewpoint.getAngle()/360)*h));(u=0!==(d*=this.ExperienceBase.getManager("VCXPaperManager").Zoom)?1/d:1)||(u=1)}u*=this.ScalingFactor;s=this.ExperienceBase.getManager("VCXPaperManager");var c=new i.Matrix4,y=new i.Matrix4,m=new i.Matrix4;if(m.makeScale(u,u,u),this.is2D()&&s.shouldUsePaperReferential()){var C;(C=new i.Vector3).x=this.Position2D.x,C.y=-this.Position2D.y,C.z=0,y.setPosition(C);var f=s.getPaperReferential();c.copy(f),c.multiply(y)}else{y.setPosition(o);var V=this._ComputeBillboardMatrix(e,o,this.GetReferential(e));c.multiply(y),c.multiply(V),c.multiply(m)}return a&&this.setMatrix(c),c},updateMatrix:function(){var e=this.ExperienceBase.getManager("VCXContextManager"),t=e.getMainViewer(),i={viewer:t,viewpoint:t.currentViewpoint};this.setMatrix(this._computeMatrix(i,!1))},_onLinkedToSceneGraph:function(){this._parent();var e=this;this.tokenChange=a.subscribe({event:"/VISU/"},function(t){"@onViewpointChange"===t.eventType&&(e._posDirty=!0)})},_onUnlinkedToSceneGraph:function(){this._parent(),a.unsubscribe(this.tokenChange)},preRender:function(e){if(this._posDirty&&(this._posDirty=!1,this.updateMatrix(),this.AttachedDiv&&this.ExperienceBase.getManager("VCXContextManager").getMainViewer()===e.viewer)){var t=this.ExperienceBase.getManager("VCXPaperManager");if(t){var r=(new i.Vector3).getPositionFromMatrix(this.getMatrix()),a=t.ModelToMM2(e,r),o=t.MMToPixel2(e,a),s=t.GetMmToPxRatio();if(s*=.3527,this._previousRatio!==s){this._previousRatio=s,this.AttachedDiv.style.transform="scale("+s+")"}this._previousLeft===o.x&&this._previousTop===o.y||(this._previousLeft=o.x,this._previousTop=o.y,this.AttachedDiv.style.left=o.x+"px",this.AttachedDiv.style.top=o.y+"px")}}},update:function(e){if(this._parent(),!(this.GlobalOpacity<=0)){if(this._ModifiableProperties){if(void 0!==this.GetPropertyValue("Collab.3D.Paper.Billboard.Type")&&(this.BillboardType=this.GetPropertyValue("Collab.3D.Paper.Billboard.Type")),void 0!==this.GetPropertyValue("Collab.3D.Paper.3D.Text.Position")&&(this.Position=this.GetPropertyValue("Collab.3D.Paper.3D.Text.Position")),void 0!==this.GetPropertyValue("Collab.3D.Paper.Positioning.Type")){if(this.PositioningType=this.GetPropertyValue("Collab.3D.Paper.Positioning.Type"),this.lastPositioningType!==this.PositioningType){var i=this.PositioningType<=t.EPositionType.Free2D,r=this.Modifiable.QueryInterface("W3AISGNodeHolder").giveSGNode();r.exludeFromBounding&&r.exludeFromBounding(i)}this.lastPositioningType=this.PositioningType}void 0!==this.GetPropertyValue("Collab.3D.Paper.Size.Control.Type")&&(this.SizeControlType=this.GetPropertyValue("Collab.3D.Paper.Size.Control.Type")),void 0!==this.GetPropertyValue("Collab.3D.Paper.Scaling.Factor")&&(this.ScalingFactor=this.GetPropertyValue("Collab.3D.Paper.Scaling.Factor")),void 0!==this.GetPropertyValue("Collab.3D.Paper.Paper.Position")?this.Position2D=this.GetPropertyValue("Collab.3D.Paper.Paper.Position"):(void 0!==this.GetPropertyValue("Collab.3D.Paper.Paper.Position.X")&&(this.Position2D.x=this.GetPropertyValue("Collab.3D.Paper.Paper.Position.X")),void 0!==this.GetPropertyValue("Collab.3D.Paper.Paper.Position.Y")&&(this.Position2D.y=this.GetPropertyValue("Collab.3D.Paper.Paper.Position.Y"))),void 0!==this.GetPropertyValue("Collab.3D.Paper.3D.Text.Radius")&&(this.PositionRadius=this.GetPropertyValue("Collab.3D.Paper.3D.Text.Radius"))}this._posDirty=!0,this.handleLayers()}}});return Object.defineProperty(o.prototype,"ModifiableProperties",{enumerable:!0,get:function(){return this._ModifiableProperties},set:function(e){this._ModifiableProperties=e}}),Object.defineProperty(o.prototype,"Opacity",{enumerable:!0,get:function(){return this._Opacity},set:function(e){this._Opacity=e}}),o.BillboardTypeEnum={NO_BILLBOARD:0,CYLINDRICAL:1,SPHERICAL:2,PRESERVE_X_AXIS_Y_IN_CAM_PLANE:3,PRESERVE_X_AXIS_Y_IN_CAM_PLANE_Y_ALWAYS_UP:4},Object.defineProperty(o.prototype,"BillboardType",{enumerable:!0,get:function(){return this._BillboardType},set:function(e){this._BillboardType=e}}),Object.defineProperty(o.prototype,"BillboardXAxis",{enumerable:!0,get:function(){return this._BillboardXAxis},set:function(e){this._BillboardXAxis=e}}),Object.defineProperty(o.prototype,"SizeControlType",{enumerable:!0,get:function(){return this._SizeControlType},set:function(e){this._SizeControlType=e}}),Object.defineProperty(o.prototype,"ScalingFactor",{enumerable:!0,get:function(){return this._ScalingFactor},set:function(e){this._ScalingFactor=e}}),Object.defineProperty(o.prototype,"PositioningType",{enumerable:!0,get:function(){return this._PositioningType},set:function(e){this._PositioningType=e}}),Object.defineProperty(o.prototype,"Position",{enumerable:!0,get:function(){return this._Position},set:function(e){this._Position=e}}),Object.defineProperty(o.prototype,"Position2D",{enumerable:!0,get:function(){return this._Position2D},set:function(e){this._Position2D=e}}),Object.defineProperty(o.prototype,"PositionRadius",{enumerable:!0,get:function(){return this._PositionRadius},set:function(e){this._PositionRadius=e}}),Object.defineProperty(o.prototype,"Referential",{get:function(){if(this._referential)return this._referential;if(this.Modifiable&&this.ExperienceBase){var e=this.Modifiable.QueryInterface("W3AISGNodeHolder"),t=this.ExperienceBase.getManager("VCXContextManager");return e.getWorldMatrix(t.getMainViewer())}return new i.Matrix4},set:function(e){this._referential=e},enumerable:!0}),Object.defineProperty(o.prototype,"Depth",{enumerable:!0,get:function(){return this._Depth},set:function(e){this._Depth=e}}),o.VerticalToUseEnum={WORLD:0,CAMERA:1},Object.defineProperty(o.prototype,"VerticalToUse",{enumerable:!0,get:function(){return this._VerticalToUse},set:function(e){this._VerticalToUse=e}}),o.BillboardDirectionTypeEnum={CAMERA_DIRECTION:0,CAMERA_POSITION:1},Object.defineProperty(o.prototype,"BillboardDirectionType",{enumerable:!0,get:function(){return this._BillboardDirectionType},set:function(e){this._BillboardDirectionType=e}}),Object.defineProperty(o.prototype,"AttachedDiv",{enumerable:!0,get:function(){return this._AttachedDiv},set:function(e){this._AttachedDiv=e}}),o}),define("DS/VCXWebDressup/VCXSimplePanelNode",["DS/VCXWebDressup/VCXDressupNode","DS/Visualization/ThreeJS_DS","DS/VCXWebVisualization/VCXImageManager","DS/Visualization/SceneGraphFactory","DS/Mesh/MeshUtils","DS/VCXWebDressup/VCXSmart3DPaperNode","DS/VCXWebProperties/VCXColor"],function(e,t,i,r,a,o,s){"use strict";return e.extend({init:function(e){return this._parent(e),this._previousBackgroundDocID=null,this._Smart3DPaperNode=null,this},setMaterial:function(e){this._bodyMat=new t.PhysicalMaterial({side:t.FrontSide,forceSide:!0,vertexColors:t.VertexColors,color:"#ffffff",transparent:!0,useLighting:!1,opacity:1,force:!0}),e&&(this._bodyMat.map=e),this._MeshNode&&this._MeshNode.setMaterial(this._bodyMat)},_ComputeColorBuffer:function(e,t){var i=0;return e[i++]=t.head.r,e[i++]=t.head.g,e[i++]=t.head.b,e[i++]=t.head.a,e[i++]=t.head.r,e[i++]=t.head.g,e[i++]=t.head.b,e[i++]=t.head.a,e[i++]=t.foot.r,e[i++]=t.foot.g,e[i++]=t.foot.b,e[i++]=t.foot.a,e[i++]=t.foot.r,e[i++]=t.foot.g,e[i++]=t.foot.b,e[i++]=t.foot.a,4},dispose:function(){this._Smart3DPaperNode&&(this._Smart3DPaperNode.dispose(),this._Smart3DPaperNode=null),this._parent()},_Build:function(e){this._PrimitiveGroup=new a.PrimitiveGroup,this._PrimitiveGroup.editable=!0;var t=new a.Buffer({component:a.VertexComponentEnum.POSITION,data:new Float32Array(12)});t.dimension=3,this._PrimitiveGroup.addBuffer(0,t);var i=new a.Buffer({component:a.VertexComponentEnum.TEX_COORD_0,data:new Float32Array(16)});i.dimension=3,this._PrimitiveGroup.addBuffer(1,i);var n=new a.Buffer({component:a.VertexComponentEnum.DIFFUSE_COLOR,data:new Float32Array(16)});n.dimension=4,this._PrimitiveGroup.addBuffer(2,n);var l,p=new a.Buffer({indexBuffer:!0,data:new Uint16Array(6)});this._PrimitiveGroup.addBuffer(3,p);var u=0;(l=t.data)[u++]=0,l[u++]=0,l[u++]=0,l[u++]=1,l[u++]=0,l[u++]=0,l[u++]=1,l[u++]=-1,l[u++]=0,l[u++]=0,l[u++]=-1,l[u++]=0;u=0;(l=i.data)[u++]=0,l[u++]=1,l[u++]=0,l[u++]=1,l[u++]=1,l[u++]=0,l[u++]=1,l[u++]=0,l[u++]=0,l[u++]=0,l[u++]=0,l[u++]=0,u=0,(l=p.data)[u++]=0,l[u++]=2,l[u++]=1,l[u++]=0,l[u++]=3,l[u++]=2,this._ComputeColorBuffer(n.data,{head:new s,foot:new s});var h=new a.Primitive({nbIndices:6,connectivity:a.ConnectivityTypeEnum.TRIANGLES,fillGAS:new a.FillAttributes}),d=new a.VertexComponent({nbVertices:4,bufferId:0,indices:new a.IndexArray({bufferId:3,offset:0})}),c=new a.VertexComponent({nbVertices:4,bufferId:1,indices:new a.IndexArray({bufferId:3,offset:0})}),y=new a.VertexComponent({nbVertices:4,bufferId:2,indices:new a.IndexArray({bufferId:3,offset:0})});h.addVertexComponent(d),h.addVertexComponent(c),h.addVertexComponent(y),this._PrimitiveGroup.addPrimitive(h),this._MeshNode=r.createMeshNode(this._PrimitiveGroup),this.setMaterial(),this._MeshNode.setVisibilityInTree(!1);var m={name:"PanelSmartNode",modifiable:this.Modifiable};this._Smart3DPaperNode=new o(m),this._Smart3DPaperNode.add(this._MeshNode),this.add(this._Smart3DPaperNode),this.setPickParent(!1),this.handleLayers(!0)},preRender:function(e){var t=!1;return this._Smart3DPaperNode&&(t|=this._Smart3DPaperNode.preRender(e)),this._AttachesNode&&(t|=this._AttachesNode.preRender(e)),t},postUpdate:function(e){this._parent()},update:function(e){if(this._parent(),this._globalOpacity!==this.GlobalOpacity){this._globalOpacity=this.GlobalOpacity;var r=this._globalOpacity>0;r&&(this._Smart3DPaperNode||this._Build()),this._Smart3DPaperNode&&this._Smart3DPaperNode.setVisibility(r),this._AttachesNode&&this._AttachesNode.setVisibility(r)}if(!(this._globalOpacity<=0)){if(this._Smart3DPaperNode&&this._Smart3DPaperNode.update(e),this._AttachesNode&&this._AttachesNode.update(e),void 0!==this.GetPropertyValue("Collab.3D.Paper.Depth")){var a=this.GetPropertyValue("Collab.3D.Paper.Depth");this.RecursiveSetRenderDepth(a)}var o=this.GetPropertyValue("Collab.Image.Doc.ID");if(null!=o&&this.GetPropertyGroupVisibility("Group.Image")||(o=-1),this._previousBackgroundDocID!==o)if(this._previousBackgroundDocID=o,-1!==o){var s=this,n=i.Effect.None;this._currentShape=this.GetPropertyValue("Collab.Body.Shape"),6===this._currentShape&&(n=i.Effect.RemoveBorder),this.ExperienceBase.getManager("VCXImageManager").GetImageFromDocID(o,n).then(function(e){t.ImageUtils.loadTexture(e.toDataURL(),{},function(t){s.GetObject().backgroundImage=e,s.setMaterial(t),s.update(),s=null})})}else this.setMaterial();if(this._AttachesNode){var l={shape:this._currentShape,center:this._center,size:this._internalSize};this._AttachesNode.SetShapeInfo(l)}if(this._MeshNode){var p=this.GetPropertyValue("Collab.Body.Width"),u=this.GetPropertyValue("Collab.Body.Height");this._previousBackgroundDocID&&(this.GetObject().backgroundImage?this.GetPropertyValue("Collab.Body.KeepAspectRatio")&&(u=p*this.GetObject().backgroundImage.height/this.GetObject().backgroundImage.width):(p=0,u=0)),this._MeshNode.setMatrix((new t.Matrix4).makeScale(p,u,1))}this.handleLayers()}}})}),define("DS/VCXWebDressup/VCXPanel_Spec",["DS/VCXWebDressup/VCXMarkup_Spec"],function(e){"use strict";var t=e.extend({init:function(){this._parent()}});return t.ESubType={None:0,Image:1,Text:2},t.prototype.getDefaultName=function(){return"Panel"},Object.defineProperty(t.prototype,"componentType",{enumerable:!0,get:function(){return"VCXPanel_Spec"}}),t.prototype.dressupGroupName="Panels",t}),define("DS/VCXWebDressup/VCXDiggerPanel_Spec",["DS/VCXWebDressup/VCXPanel_Spec"],function(e){"use strict";var t=e.extend({init:function(){this._parent()}});return t.prototype.getDefaultName=function(){return"DiggerPanel"},Object.defineProperty(t.prototype,"componentType",{enumerable:!0,get:function(){return"VCXDiggerPanel_Spec"}}),t.prototype.dressupGroupName="Panels",t}),define("DS/VCXWebDressup/VCXAnchorServices",["UWA/Class","DS/Visualization/ThreeJS_DS","DS/VCXWebKernelTools/VCXMathTools","DS/VCXWebProperties/VCXProperty","DS/VCXWebProperties/VCXPropertySet","DS/VCXWebProperties/VCXPropertyInfo","DS/VCXWebProperties/VCXPropertyValueAnchor","DS/VCXWebProperties/VCXPropertyValueFrame","DS/VCXWebProperties/VCXPropertyValueVector","DS/VCXWebModifiablesServices/VCXModifiablesAccess","DS/VCXWebDressup/VCXMarkup_Spec"],function(e,t,i,r,a,o,s,n,l,p,u){"use strict";var h=e.extend({init:function(){}});return h.GetNewPropertyAnchorFromMatrix=function(e,t,i){var r="Actor.Anchor."+t,a=e.QueryInterface("VCXIModifiable").GetProperty(r).Clone(),o=a.GetPropertyValue(),s=o.GetValueLink(),n=e._experienceBase.ComponentsMap.GetComponentFromLink(s);n||(n=e.getWorkingRootComponent());var l=n.QueryInterface("W3AISGNodeHolder").getMatrixInLCS(e._experienceBase.getManager("VCXContextManager").getMainViewer(),i),p=a.GetPropertyValue().GetValueFrame();return p.Value=l,o.SetValueFrame(p),a.SetPropertyValue(o),a},h.GetNewPropertyValueAnchor=function(e,i){var r=new s,a=new n(e||new t.Matrix4);return r.SetValueFrame(a),r.SetValueLinkFromComponent(i),r},h.GetNewPropertyValueAnchorFromPickinfo=function(e){return h.GetNewPropertyValueAnchor(e&&e.localMatrix,e&&e.modifiable&&e.modifiable.GetObject())},h.GetComponentToAttachTo=function(e,t){if(e){var i=null;if(t){var r=p.BuildCleanedPathElement(t),a=e._experienceBase.ComponentsMap.GetComponentFromPathElement(r);a&&(i=a)}return i||(i=e.getWorkingRootComponent()),i}},h.BuildNewPropertyValueAnchor=function(e,i,r){if(e instanceof t.Matrix4){var a=this.GetComponentToAttachTo(i,r);if(a){var o=a.QueryInterface("W3AISGNodeHolder").getMatrixInLCS(i._experienceBase.getManager("VCXContextManager").getMainViewer(),e),l=new s,p=new n;return l.SetValueFrame(p),p.Value=o,r?l.SetValueLinkFromComponent(a):l.SetValueLinkFromComponent(null),l}console.warn("Creation of Anchor Property Value aborted: No object has been found to link the anchor.")}else console.warn("BuildNewPropertyValueAnchor Usage: BuildNewPropertyValueAnchor(iAnchorFrameInWorld <THREE.Matrix4>, iAnchorHolderComponent <VCXComponentOccurrence>, iPathObjectToLink <WebVizu.PathElement>) !")},h.getWorldMatrix=function(e,r,a){if(!e)return null;var o=e.GetValueFrame().Value,s=r._experienceBase.ComponentsMap.GetComponentFromLink(e.GetValueLink());if(s||(s=r.getWorkingRootComponent()),!s)return o;var n=s.QueryInterface("W3AISGNodeHolder"),l=u.EPositionType.Free3D,p=s.QueryInterface("VCXIModifiable");if(p){var h=p.GetProperty("Collab.3D.Paper.Positioning.Type");h&&(l=h.GetPropertyValue().Value)}if(!(e.is2DAnchor&&n&&n.getSGNode()&&n.getSGNode().GetShapeInfo&&a&&l===u.EPositionType.Free2D))return n&&l===u.EPositionType.Free3D&&n.getPathElement()?n.getMatrixInWCS(s._experienceBase.getManager("VCXContextManager").getMainViewer(),o):o;if(r){var d=n.getSGNode().GetShapeInfo();if(d){var c=i.getOFromMatrix(o),y=r._experienceBase.getManager("VCXPaperManager");if(y){var m=y.ModelToMM2(a,i.getOFromMatrix(d.smartNode.getMatrix(a))),C=new t.Vector3(d.smartNode.Position2D.x+d.size.x*c.x,d.smartNode.Position2D.y+d.size.y*c.y,.9999*m.z),f=y.MMToModel2(a,C);return(new t.Matrix4).setPosition(f)}}}},h.requestNewAnchor=function(e,t,i){var s=e.GetPropertyValue("Collab.ListAnchorsIDs").slice(0),n=null,p="Actor.Anchor."+(n="number"==typeof i||"string"==typeof i?i:e.getNewAnchorID()),u=h.GetNewPropertyValueAnchorFromPickinfo(t);s.push(n);var d=new l(s),c=new o(p,0),y=new o("Collab.ListAnchorsIDs",0),m=new a;return m.AddOrModifyProperty(new r(c,u)),m.AddOrModifyProperty(new r(y,d)),{anchorPropName:p,propertySet:m}},h}),define("DS/VCXWebDressup/VCXPickerCmd",["UWA/Core","DS/Core/Core","DS/CoreEvents/Events","DS/ApplicationFrame/Command","DS/VisuEvents/EventsManager","DS/Visualization/ThreeJS_DS","DS/Visualization/SceneGraphFactory","DS/Visualization/Node3D","DS/SceneGraphNodes/FixedSizeNode3D","DS/VCXWebKernelTools/VCXMathTools","DS/Mesh/MeshUtils","DS/VCXWebDressup/VCXAnchorServices","DS/VCXWebVisualization/VCXPickerTools","DS/Robot/LineTranslationNode","DS/Core/PointerEvents","DS/VCXWebExperienceBase/VCXPathElementTools","DS/VCXWebVisibility/VCXIVisibility","DS/VCXWebDressup/VCXCmdChangeDressup","DS/VCXWebKernel/VCXCmdChangeSelection","DS/VCXWebKernelCommands/VCXCmdChangeNeutralProperties","DS/VCXWebProperties/VCXPropertyValueString","DS/VCXWebKernelCommands/VCXCmdChangeVisibility","DS/VCXWebVisualization/VCXInteractor","DS/VCXWebKernel/VCXNotificationManager"],function(e,t,i,r,a,o,s,n,l,p,u,h,d,c,y,m,C,f,V,b,P,_,g,S){"use strict";var M=r.extend({init:function(e){this._parent(e,{isAsynchronous:!0,odtCmd:!0}),this.quickUse=!0,this.reset(),e&&e.experienceBase&&(this._experienceBase=e.experienceBase),this._ODT_BEGIN_=i.subscribe({event:"/ODT/CreateDressup/BeginExecute/"+this._id},function(e){this._mousePosition=e&&e.mousePosition,this.beginExecute(),e.creationPromise=this.creationPromise}.bind(this)),this._ODT_END_=i.subscribe({event:"/ODT/CreateDressup/EndExecute/"+this._id},function(){this.endExecute()}.bind(this))},_clearFeedbackUnitGeoms:function(){var e=this._experienceBase?this._experienceBase.getManager("VCXContextManager").getMainViewer():null;e&&(e.removeNode(this._torusNode),e.removeNode(this._redXNode),e.removeNode(this._smartNodeArrow)),this._torusNode=null,this._redXNode=null,this._arrowNode=null,this._smartNodeArrow=null},reset:function(){this._clearFeedbackUnitGeoms(),this._experienceBase=null,this.pickerTools&&(this.pickerTools.clear(),this.pickerTools=null),this._startToDrag=!1,this.Acquisitions=[],this._infinite=!1,this.Acquired=[],this.AcquisitionsEnable=!0,this._Modifiable=null},_preRender:function(e,t){e&&(e.preRender&&e.preRender(t),e.cbChange&&e.cbChange())},preRender:function(e){this._preRender(this._smartNodeArrow),this._preRender(this._smartNodeTorus),this._preRender(this._smartNodeRedX),this._preRender(this._redXNode)},BuildDressup:function(i){this.AcquisitionsEnable=!1;var r=this._experienceBase.getManager("VCXDressupManager").FindBestName(this.getDressupGroup(),this.getComponentNameToCreate()),a=null;if(this._experienceBase.getManager("VCXCAT3DXModelManager")){var o=this._experienceBase.getManager("VCXContextManager").getRootComponent();a=o?this._experienceBase.getManager("VCXCAT3DXModelManager").CreateActor(this.getComponentTypeToCreate(),r,o):new e.Promise.reject(new Error("Dressup creation : Missing father experience!"))}else a=new e.Promise.resolve(this._experienceBase.Factory.BuildComponent(this.getComponentTypeToCreate()));return this.creationPromise=a.then(t=>t?(this._Modifiable=t.QueryInterface("VCXIModifiable"),this._Modifiable?(this._Modifiable.OnChangeProperty("Actor.Name",new P(r)),this._createDressup(i||{},t)):new e.Promise.reject(new Error("Actor dressup not built !"))):new e.Promise.reject(new Error("Actor dressup not built !"))).then(e=>(this.AcquisitionsEnable=!0,this.pickerTools&&this.pickerTools.setCurrentComponent(this._Modifiable.GetObject()),this._Modifiable)).then(e=>{this.SetDressupVisible(!0);var i=this._Modifiable.ExperienceBase.getManager("VCXContextManager").getMainViewer();this._Modifiable.GetObject().update({viewer:i,viewpoint:i.currentViewpoint});var r=[],a=this._Modifiable.GetObject();r.push(a);var o=this._Modifiable.QueryInterface("VCXIManipulable");o&&o.setManipulated(!0),"record"===this._Modifiable.ExperienceBase.odt&&(this._Modifiable.ExperienceBase.getManager("VCXODTManager").lockLogAPI=!0);var s=new V(this._Modifiable.ExperienceBase.getManager("VCXSelectionManager"));return s.SetComponentsSelection(r),this._Modifiable.ExperienceBase.getManager("VCXCommandManager").Do(s),"record"===this._Modifiable.ExperienceBase.odt&&(this._Modifiable.ExperienceBase.getManager("VCXODTManager").lockLogAPI=!1),t.Selection.HSOManager.empty(!1),t.Selection.PSOManager.empty(!1),this._Modifiable}).catch(t=>(this.cancelExecute(),this.end(),e.Promise.reject(t))),this._experienceBase.getManager("VCXNotificationManager").addProgressNotification({strAction:"Creation",strObjectName:this.getComponentNameToCreate(),iPromise:this.creationPromise,maskDisplayAdd:S.FDisplayMode.CONSOLE}),this.creationPromise},getNextDistributionPickingPoint:function(){var e=this._Modifiable.ExperienceBase.getManager("VCXContextManager").getMainViewer().canvas.getBoundingClientRect();this._currentDistribution||(this._currentDistribution=0);var t=.01*e.width,i=(2-.5*(Math.sqrt(5)+1))*(2*Math.PI),r=Math.sqrt(this._currentDistribution)*t,a=i*this._currentDistribution,o=Math.cos(a)*r,s=Math.sin(a)*r;return this._currentDistribution++,{x:.5*(e.x+e.width)+o,y:.5*(e.y+e.height)+s}},Start:function(){for(var e=this._Modifiable.ExperienceBase.getManager("VCXGUIManager"),t=0;t<this.Acquisitions.length;t++)if(this.Acquisitions[t].automaticLongHoldOnTouch){var i=this._mousePosition||this.getNextDistributionPickingPoint();e.isTouchActivated()||this._mousePosition?this.callerOfTheAgentTreatment({type:"DSlonghold",pageX:i.x,pageY:i.y,target:{tagName:"CANVAS"}}):this.callerOfTheAgentTreatment({type:"DSpointermove",pageX:i.x,pageY:i.y,target:{tagName:"CANVAS"}})}if(!this.Acquisitions.length&&!this._infinite)return this._finalizeDressupCB(),void this.end();document.addEventListener(y.POINTERDOWN,this.callerOfTheAgentTreatment),document.addEventListener(y.POINTERMOVE,this.callerOfTheAgentTreatment),document.addEventListener(y.POINTERUP,this.callerOfTheAgentTreatment),document.addEventListener(y.LONGHOLD,this.callerOfTheAgentTreatment)},SetDressupVisible:function(e){if(this._Modifiable&&!this._Modifiable.deleteRequested){var t=this._Modifiable.QueryInterface("VCXIVisibility");if(t&&(e&&t.GetVisibility()!==C.EVisState.Visible||!e&&t.GetVisibility()!==C.EVisState.Hidden)){var i=new _(this._Modifiable.ExperienceBase.getManager("VCXScenarioManager"),this._Modifiable.ExperienceBase.ComponentsMap,this._Modifiable.ExperienceBase.getManager("VCXCommandManager"));i.ChangeVisibility([this._Modifiable.GetObject()],e?C.EVisState.Visible:C.EVisState.Hidden),this._Modifiable.ExperienceBase.getManager("VCXCommandManager").Push(i)}this._Modifiable.OnChangePropertiesEnd()}},_addAnchor:function(e,t,i,r){var a=h.requestNewAnchor(e,t,i);r?a.propertySet.onEachProperty(r):a.propertySet.onEachProperty(function(t,i){var r=i.GetPropertyValue();e.OnChangeProperty(t,r)})},_getOnFinalizeDressupParams:function(){var e={id:this._id,styleID:this._styleID,acquired:[],modifiableID:this._Modifiable.GetObject().GetID()};return this.Acquired&&this.Acquired.every(function(t){e.acquired.push(t.mouse)}),e},_finalizeDressupCB:function(e){if(this._Modifiable&&!this._Modifiable.deleteRequested){var t=this._getOnFinalizeDressupParams();"record"===this._experienceBase.odt&&this._experienceBase.getManager("VCXODTManager").LogAPI("VCXCreateDressupCmd",t);var r=this._Modifiable.QueryInterface("VCXIManipulable");r&&r.setManipulated(!1),this.SetDressupVisible(!0);var a=new b(this._Modifiable.ExperienceBase.getManager("VCXScenarioManager"));if(a.CaptureNeutralProperties(this._Modifiable),this._Modifiable.ExperienceBase.getManager("VCXCommandManager").Push(a),this._Modifiable.ExperienceBase.getManager("VCXScenarioManager").GetAutoKey()){var o=this._Modifiable.ExperienceBase.getManager("VCXScenarioManager").GetCurrentScenario(),s=this._Modifiable.ExperienceBase.getManager("VCXScenarioManager")._Scenarios[o];this._Modifiable.ExperienceBase.getManager("VCXExperience")&&this._Modifiable.ExperienceBase.getManager("VCXExperience").UpdateScenarioThumbnail(s)}var n=this._Modifiable.ExperienceBase.getManager("VCXSelectionManager");n&&n.RefreshXSO(),i.publish({event:"FinalizeDressup",data:t})}},openEditor:function(){if(this._Modifiable&&!this._Modifiable.deleteRequested){var e=this._Modifiable,t=this._Modifiable.QueryInterface("W3AISGNodeHolder").getSGNode().FirstDrawDeferred;return t&&t.promise?t.promise.then(function(){e&&e.QueryInterface("VCXIManipulable").startEditInPlace()}):void 0}},beginExecute:function(){var e=this._experienceBase;this.reset(),i.publish({event:"/VCX/Picker/Query/Start"}),this._experienceBase=e||this.getFrameWindow()._experienceBase,this._experienceBase.getManager("VCXContextManager").cmdIsRunning=!0,this._debugTools=this._experienceBase.getManager("VCXExperience").debugTools,this._experienceBase.getManager("VCXMultiUserInputManager")&&this._experienceBase.getManager("VCXMultiUserInputManager").registerCommand(this);var t=this._experienceBase.getManager("VCXContextManager"),r=t.getMainViewer();this.pickerTools||(this.pickerTools=new d(this._experienceBase)),this._experienceBase.getManager("VCXGUIManager")&&this._experienceBase.getManager("VCXGUIManager").isTouchActivated(),this._blockViewpoint&&t.setAllViewerSensitive(!1),this._experienceBase.getManager("VCXSelectionManager").setTrapSelection(!1),t.getMainViewer().setPicking({activated:!1}),t.getMainViewer().setPrePicking({activated:!1});var s=this._experienceBase.getManager("VCXDressupManager");s&&s.changeDressupsPickability(!1),this._transactionName=this.getComponentNameToCreate()+" Creation",this._experienceBase.getManager("VCXCommandManager").StartTransaction(this._transactionName),this.Acquired=[],this.Acquisitions=[];var n=-1;this.callerOfTheAgentTreatment=(e=>{if(("CANVAS"===(e.target||e.srcElement).tagName||this._isDraggin)&&this.pickerTools){var t,i=this.GetNextAcquisitionIndice();this.Acquisitions[i]&&(t=this.Acquisitions[i].constraintPointIndex),void 0!==t?(this.pickerTools.usePointConstraint(!0,this.Acquired[t].pickInfo.globalPosition),this.Acquisitions[i].constraint===g.EConstraint.ZAxis?this.pickerTools.useNormalConstraint(!0,this.Acquired[t].pickInfo.globalNormal):this.Acquisitions[i].constraint===g.EConstraint.XAxis?this.pickerTools.useNormalConstraint(!0,p.getVzFromMatrix(p.getMatrixFromOVx(this.Acquired[t].pickInfo.globalPosition,this.Acquired[t].pickInfo.globalNormal))):this.Acquisitions[i].constraint===g.EConstraint.YAxis?this.pickerTools.useNormalConstraint(!0,p.getVzFromMatrix(p.getMatrixFromOVy(this.Acquired[t].pickInfo.globalPosition,this.Acquired[t].pickInfo.globalNormal))):this.Acquisitions[i].constraint===g.EConstraint.CustomAxis?(this.Acquired[t].pickInfo.globalNormal&&this.pickerTools.useNormalConstraint(!0,this.Acquired[t].pickInfo.globalNormal),this.Acquired[t].pickInfo.globalPosition&&this.pickerTools.usePointConstraint(!0,this.Acquired[t].pickInfo.globalPosition)):this.pickerTools.useNormalConstraint(!1)):(this.pickerTools.usePointConstraint(!1),this.pickerTools.useNormalConstraint(!1)),(this.Acquisitions[this._infinite?0:i]?this.Acquisitions[this._infinite?0:i].constraint:g.EConstraint.Screen)===g.EConstraint.Screen?this.pickerTools.useNormalConstraintToCamera(!0):this.pickerTools.useNormalConstraintToCamera(!1);var a=this.pickerTools.pick(r,e,i<this.Acquisitions.length&&!this._infinite?this.Acquisitions[i]&&this.Acquisitions[i].interactorID:this.Acquisitions[0]&&this.Acquisitions[0].interactorID);this.Acquired[i]=a;var s=!1;if("DSlonghold"===e.type&&1!==e.button)s=!0;else if("DSpointerdown"===e.type&&2===e.button&&this.AcquisitionsEnable)s=!0;else if("DSpointerdown"===e.type&&this.AcquisitionsEnable&&1!==e.button)this._beginDrag(a.mouse.xPix,a.mouse.yPix),this.CurrentAcquisitionCB&&this.CurrentAcquisitionCB(this.Acquired);else if("DSpointermove"===e.type)this._onDrag(a.mouse.xPix,a.mouse.yPix),!this._blockViewpoint&&this._isDraggin||!this.CurrentAcquisitionCB||this.CurrentAcquisitionCB(this.Acquired),a.pickInfo.globalPosition&&a.pickInfo.globalNormal&&this._RefreshVisuFeedback(a.pickInfo);else if("DSpointerup"===e.type&&this.AcquisitionsEnable&&1!==e.button){if(this._infinite&&!this._isDraggin)for(var l=this.Acquired[i],u=this.Acquired.length-1;u>=0;--u){var h=this.Acquired[u];if(h.accepted){var d=new o.Vector2(l.mouse.xPix,l.mouse.yPix),c=new o.Vector2(h.mouse.xPix,h.mouse.yPix);d.distanceTo(c)<5&&(s=!0);break}}!this._blockViewpoint&&this._isDraggin||s||(this.Acquired[i].accepted=!0,this.PointAcquiredCB&&this.PointAcquiredCB(this.Acquired)),this._endDrag()}if(n!==i&&(n=i,this.pickerTools&&this.Acquisitions)){var y=this.Acquisitions[this.Acquisitions.length>i?i:0].canonicMode;this.pickerTools.setCanonicMode(y,this._Modifiable.GetObject())}(this.areAllAcquisitionsValid()||s)&&(s&&(this.CurrentAcquisitionCB&&this.CurrentAcquisitionCB(this.Acquired),this.PointAcquiredCB&&this.PointAcquiredCB(this.Acquired)),this._finalizeDressupCB(),this.end()),this._loadingOption&&this._loadingOption.isShowPickerDebug()&&this._debugTools&&this._debugHTMLAcquired()}}),a._isInit||a.init()},endExecute:function(){if("boolean"==typeof this._dressupFinalized&&!1===this._dressupFinalized&&this.ForceFinalize&&this.ForceFinalize(this.Acquired),this._Modifiable&&!this._Modifiable.deleteRequested){var e=this._Modifiable.GetObject().QueryInterface("W3AISGNodeHolder");e&&e.giveSGNode()&&e.giveSGNode().setPickable(u.PICKABLE)}var t=this._experienceBase.getManager("VCXCanonicsManager");t&&t.clear(),this._transactionName&&(this._experienceBase.getManager("VCXCommandManager").EndTransaction(this._transactionName),this._transactionName=null);var r=this._experienceBase.getManager("VCXContextManager");this._blockViewpoint&&r.setAllViewerSensitive(!0);var a=r.getTrapSelectionRequirements();this._experienceBase.getManager("VCXSelectionManager").setTrapSelection(a.pick,a.prePick),r.getMainViewer().setPicking({activated:!0}),r.getMainViewer().setPrePicking({activated:!0});var o=this._experienceBase.getManager("VCXDressupManager");o&&o.changeDressupsPickability(!0),this._experienceBase.getManager("VCXGUIManager").SetCursor("auto"),this._clearFeedbackUnitGeoms(),document.removeEventListener(y.POINTERDOWN,this.callerOfTheAgentTreatment,!1),document.removeEventListener(y.POINTERMOVE,this.callerOfTheAgentTreatment,!1),document.removeEventListener(y.POINTERUP,this.callerOfTheAgentTreatment,!1),document.removeEventListener(y.LONGHOLD,this.callerOfTheAgentTreatment,!1),this._experienceBase.getManager("VCXContextManager").renderAll({updateInfinitePlane:!0}),this._experienceBase.getManager("VCXMultiUserInputManager")&&this._experienceBase.getManager("VCXMultiUserInputManager").unRegisterCommand(this),i.publish({event:"/VCX/Picker/Query/End"}),this.reset(),this._mousePosition=null,r.cmdIsRunning=!1},cancelExecute:function(){var e=this._experienceBase.getManager("VCXContextManager");if(this._blockViewpoint&&e.setAllViewerSensitive(!0),document.removeEventListener(y.POINTERDOWN,this.callerOfTheAgentTreatment,!1),document.removeEventListener(y.POINTERMOVE,this.callerOfTheAgentTreatment,!1),document.removeEventListener(y.POINTERUP,this.callerOfTheAgentTreatment,!1),document.removeEventListener(y.LONGHOLD,this.callerOfTheAgentTreatment,!1),this._Modifiable&&!this._Modifiable.deleteRequested){var t=this._Modifiable.GetObject();if(t.IsKindOf("VCXDressup_Spec")){var i=[t],r=this._Modifiable.ExperienceBase.getManager("VCXSelectionManager");if(r.isIn(t)){var a=new V(r);a.RemoveComponentsFromSelection(i),this._Modifiable.ExperienceBase.getManager("VCXCommandManager").Do(a)}var o=new f(this._Modifiable.ExperienceBase.getManager("VCXCommandManager"),this._Modifiable.ExperienceBase.getManager("VCXDressupManager"),this._Modifiable.ExperienceBase.getManager("VCXScenarioManager"),this._Modifiable.ExperienceBase.ComponentsMap);i.forEach(function(e){o.RemoveDressups(e)}),this._Modifiable.ExperienceBase.getManager("VCXCommandManager").Push(o),this._Modifiable.deleteRequested=!0}}},areAllAcquisitionsValid:function(){if(this._infinite||this.Acquisitions.length!==this.Acquired.length)return!1;for(var e=0;e<this.Acquired.length;e++)if(!this.Acquired[e].accepted)return!1;return!0},GetNextAcquisitionIndice:function(){var e=this.Acquired.length;if(e<=0)return 0;for(var t=0;t<e;t++)if(!this.Acquired[t].accepted)return t;return this._infinite?this.Acquired.length:e>=this.Acquisitions.length?e-1:e},GetNextAcquisitionFeedbackMode:function(){if(this._infinite)return this.Acquisitions[0].displayFeedback;var e=this.GetNextAcquisitionIndice();return e<0?M.FEEDBACKMODE.NONE:this.Acquisitions[e]&&this.Acquisitions[e].displayFeedback},useNormalConstraint:function(e,t){this.pickerTools.useNormalConstraint(e,t)},usePointConstraint:function(e,t){this.pickerTools.usePointConstraint(e,t)},_RefreshVisuFeedback:function(e){var t=e.globalPosition,i=e.globalNormal,r=e.modifiable,a=p.getMatrixFromOVz(t,i),o=this.GetNextAcquisitionFeedbackMode();if(o&M.FEEDBACKMODE.NONE)return this._hideTorusFeedback(),this._hideRedXFeedback(),this._hideArrowFeedback(),void this._experienceBase.getManager("VCXGUIManager").SetCursor("crosshair");o&M.FEEDBACKMODE.NORMAL&&(this._showArrowFeedback(),this._updateArrowFeedback(a)),o&M.FEEDBACKMODE.NORMAL_ONLY_ON_PART&&(r?(this._showArrowFeedback(),this._updateArrowFeedback(a)):this._hideArrowFeedback()),o&M.FEEDBACKMODE.POINT&&(this._showTorusFeedback(),this._updateTorusFeedback(a)),o&M.FEEDBACKMODE.POINT_ONLY_ON_PART&&(r?(this._showTorusFeedback(),this._updateTorusFeedback(a)):this._hideTorusFeedback()),this._experienceBase.getManager("VCXContextManager").renderAll()},_showArrowFeedback:function(){if(!this._smartNodeArrow){var e={viewer:this._experienceBase.getManager("VCXContextManager").getMainViewer(),position:new o.Vector3};this._arrowNode=new c(e),this._arrowNode.setMatrix(new o.Matrix4);var t={name:"PickerArrowSmartNode",experience:this._experienceBase,ratio:1};this._smartNodeArrow=new l(t),this._smartNodeArrow.add(this._arrowNode);var i=this._experienceBase.getManager("VCXVisuManager");this._smartNodeArrow.setRenderPasses([i.getRenderList("VCXPreManipulators"),i.getRenderList("VCXManipulators")]),this._experienceBase.getManager("VCXContextManager").getMainViewer().addNode(this._smartNodeArrow)}this._smartNodeArrow.setVisibility(!0)},_updateArrowFeedback:function(e){this._smartNodeArrow&&(this._smartNodeArrow.setMatrix(e),this._arrowNode.setVisibility(!0),this._smartNodeArrow.setVisibility(!0))},_hideArrowFeedback:function(){this._smartNodeArrow&&this._smartNodeArrow.setVisibility(!1)},_showTorusFeedback:function(){if(!this._torusNode){this._torus=s.createTorusNode({majorRadius:10,minorRadius:3,majorStartAngle:0,majorEndAngle:2*Math.PI,sag:40,color:new u.Color(.0666666666666667,.596078431372549,.8980392156862745,.5)}),this._torusNode=new n;var e={name:"PickerTorusSmartNode",experience:this._experienceBase,ratio:1};this._smartNodeTorus=new l(e),this._smartNodeTorus.add(this._torus),this._torusNode.add(this._smartNodeTorus),this._torusNode.setPickable(u.PICKTHROUGH);var t=this._experienceBase.getManager("VCXVisuManager");this._torusNode.setRenderPasses([t.getRenderList("VCXPreManipulators"),t.getRenderList("VCXManipulators")]),this._experienceBase.getManager("VCXContextManager").getMainViewer().addNode(this._torusNode)}this._torusNode.setVisibility(!0)},_updateTorusFeedback:function(e){this._torusNode&&(this._torusNode.setMatrix(e),this._torusNode.setVisibility(!0))},_hideTorusFeedback:function(){this._torusNode&&this._torusNode.setVisibility(!1)},_showRedXFeedback:function(){if(!this._redXNode){this._redX=s.createRedXNode({majorRadius:10,minorRadius:3,majorStartAngle:0,majorEndAngle:2*Math.PI,sag:40,color:new u.Color(.0666666666666667,.596078431372549,.8980392156862745,.5)}),this._redXNode=new n;var e={name:"PickerRedXSmartNode",experience:this._experienceBase,ratio:1};this._smartNodeRedX=new l(e),this._smartNodeRedX.add(this._redX),this._redXNode.add(this._smartNodeRedX),this._redXNode.setPickable(u.PICKTHROUGH);var t=this._experienceBase.getManager("VCXVisuManager");this._redXNode.setRenderPasses([t.getRenderList("VCXPreManipulators"),t.getRenderList("VCXManipulators")]);e={name:"PickerRedXSmartNode",experience:this._experienceBase,ratio:1};this._redXNode=new l(e),this._redXNode.setRenderPasses([t.getRenderList("VCXPreManipulators"),t.getRenderList("VCXManipulators")]),this._experienceBase.getManager("VCXContextManager").getMainViewer().addNode(this._redXNode)}this._redXNode.setVisibility(!0)},_updateRedXFeedback:function(e){this._redXNode&&(this._redXNode.setMatrix(e),this._redXNode.setVisibility(!0))},_hideRedXFeedback:function(){this._redXNode&&this._redXNode.setVisibility(!1)},_beginDrag:function(e,t){this._startToDrag=!0,this._isDraggin=!1,this._pos2DduringDragX=e,this._pos2DduringDragY=t;this._experienceBase.getManager("VCXContextManager")},_onDrag:function(e,t){if(this._startToDrag&&!this._isDraggin){var i=e-this._pos2DduringDragX,r=t-this._pos2DduringDragY;if(i*i+r*r>4){if(this._isDraggin=!0,!this._blockViewpoint)return;this.Acquired[this.GetNextAcquisitionIndice()].accepted=!0,this.PointAcquiredCB&&this.PointAcquiredCB(this.Acquired)}}},_endDrag:function(){this._experienceBase.getManager("VCXContextManager");this._startToDrag=!1,this._isDraggin=!1},_debugHTMLAcquired:function(){if(this._debugTools){var e='<div style="width:220px;padding:5px;"><div style="margin:5px;width:210px" align="center"><b>Current Acquisition</b></div>';this._experienceBase.getManager("VCXContextManager").isTouchCompliantDevice()&&(e+='<div style="margin:5px;" align="left">Touch compliante: vertical decay added</div>');for(var t=0;t<this.Acquired.length;t++)e+='<div style="width:200px;border:1px solid black; margin:5px;padding:5px;">',e+='<div align="right" style="width:100%;">'+t+"</div>",e+=this._debugHTMLPos2D(t),e+=this._debugHTMLPos3D(t),e+=this._debugHTMLNormal(t),e+=this._debugHTMLModifiable(t),e+=this._debugHTMLState(t),e+="</div>";e+="</div>",this._debugTools.updateImmersiveConsole(e)}},_debugHTMLPos2D:function(e){if(this._debugTools){var t=this._debugTools.getImgCursor(),i=e;this._infinite&&(i=0);var r=this.Acquisitions[i].displayFeedback,a=r&M.FEEDBACKMODE.POINT||r&M.FEEDBACKMODE.POINT_ONLY_ON_PART,o=this.Acquisitions[i].is2D,s="";return s+=a&&o?"<div>":'<div style="opacity:0.4;">',s+=t+this.Acquired[e].mouse.xPix+"/"+this.Acquired[e].mouse.yPix,s+="</div>"}},_debugHTMLPos3D:function(e){if(this._debugTools){var t=this._debugTools.getImgCoord(),i=e;this._infinite&&(i=0);var r=this.Acquisitions[i].displayFeedback,a=r&M.FEEDBACKMODE.POINT||r&M.FEEDBACKMODE.POINT_ONLY_ON_PART,o=this.Acquisitions[i].is2D,s="";return s+=a&&!o?"<div>":'<div style="opacity:0.4;">',s+=t+this.Acquired[e].pickInfo.globalPosition.x.toFixed(2)+"/"+this.Acquired[e].pickInfo.globalPosition.y.toFixed(2)+"/"+this.Acquired[e].pickInfo.globalPosition.z.toFixed(2),s+="</div>"}},_debugHTMLNormal:function(e){if(this._debugTools){var t=this._debugTools.getImgArrow(),i=e;this._infinite&&(i=0);var r=this.Acquisitions[i].displayFeedback,a="";return a+=r&M.FEEDBACKMODE.NORMAL||r&M.FEEDBACKMODE.NORMAL_ONLY_ON_PART?"<div>":'<div style="opacity:0.4;">',a+=t+this.Acquired[e].pickInfo.globalNormal.x.toFixed(2)+"/"+this.Acquired[e].pickInfo.globalNormal.y.toFixed(2)+"/"+this.Acquired[e].pickInfo.globalNormal.z.toFixed(2),a+="</div>"}},_debugHTMLState:function(e){if(this._debugTools){var t=this._debugTools.getImgValid(),i=this._debugTools.getImgInvalid(),r='<div style="padding-top:5px">';return this.Acquired[e].accepted?(r+=t,r+="Accepted"):(r+=i,r+="Current acquisition"),r+="</div>"}},_debugHTMLModifiable:function(e){if(this._debugTools){var t=this._debugTools.getImgCube(),i="";return i=this.Acquired[e].pickInfo.modifiable?"<div>":'<div style="opacity:0.4;">',i+=t,i+=m.getLeafNameOfPathElement(this.Acquired[e].pickInfo.pathElement),i+="</div>"}}});return M.FEEDBACKMODE={NONE:1,POINT:2,POINT_ONLY_ON_PART:4,NORMAL:8,NORMAL_ONLY_ON_PART:16},M}),define("DS/VCXWebDressup/VCXManipulableDressup",["DS/Mesh/MeshUtils","DS/VCXWebVisualization/VCXAManipulable","DS/VCXWebDressup/VCXAnchorServices","DS/VCXWebDressup/VCXMarkup_Spec","DS/VCXWebProperties/VCXPropertySet","DS/VCXWebProperties/VCXPropertyValueFrame","DS/VCXWebCanonics/VCXCanonicsManagerEnum","DS/Visualization/ThreeJS_DS","DS/VCXWebVisualization/VCXInteractor"],function(e,t,i,r,a,o,s,n,l){"use strict";return t.extend({init:function(){this._parent(),this._automaticAnchorCreation=!0},interact:function(e){if(e){this._parent(e);var t=e&&e.manipulator&&e.manipulator.interactor;if(t&&t.data&&void 0!==t.data.anchorID&&e.eventChannel&&e.eventChannel.indexOf("Manipulate")>-1){var i,r,a;if(t.data.is2DAnchor){if(i="Anchor2D",!(r=this.GetObject()._experienceBase.getManager("VCXPaperManager")))return;var o=this.GetObject()._experienceBase.getManager("VCXContextManager").getMainViewer();a={viewer:o,viewpoint:o.currentViewpoint}}else i="Anchor3D";var s=e.eventChannel.replace("Manipulate","Manip"),n=s.charAt(0).toLowerCase()+s.slice(1)+i;this[n]&&this[n](e,r,a)}}},getAllInteractors:function(){if(this._automaticAnchorCreation){var e=this.QueryInterface("VCXIModifiable"),t=this;e.processAnchorsIDs(function(e){var i="Interactor Anchor."+e,r=t.getInteractor(i);r||(r=t._createAnchorHandleInteractor(i,e),t.addInteractor(i,r))})}return this._parent()},getNode:function(){var e=this.QueryInterface("W3AISGNodeHolder");if(e)return e.giveSGNode()},updateInteractors:function(e){var t=this.QueryInterface("VCXIModifiable"),i=this;t.GetOpacity()?t.processAnchorsIDs(function(a){var o="Interactor Anchor."+a,s=i.getInteractor(o);if(s){if(t.GetProperty("Collab.Attach.Availability")){s.active=t.GetPropertyGroupVisibility("Group.Attach");var n=t.GetPropertyValue("Collab.Attach.LeadType");"number"==typeof n&&(s.active=s.active&&n!==r.ELeadType.None)}if(s.active){var l=t.GetAnchorWorldMatrix(a,e);s.matrix&&s.matrix.equals(l)||(s.matrix=l)}}}):this.removeAnchorsInteractors()},_createAnchorHandleInteractor:function(e,t){var i=this.QueryInterface("VCXIModifiable"),r=new l(i.GetObject());return r.id=e,"boolean"!=typeof i._Anchors[t].is2DAnchor&&i.updateAnchorsType(),r.data={anchorID:t,is2DAnchor:i._Anchors[t].is2DAnchor},i._Anchors[t].is2DAnchor||(r.tag={Canonic:1}),r.manipulatorType=l.EManipulatorType.Handle,r.type=l.EType.Pick,r.visibility=l.EVisibility.OnObjectOver|l.EVisibility.OnObjectSelected|l.EVisibility.OnInteractorOver,r.application=l.EApplication["3DIllustration"]|l.EApplication.CityIllustration,r.cursorPreactivate="grab",r.cursorManipulate="grabbing",r.canonicsDetection=s.Canonic.Point|s.Canonic.Line|s.Canonic.Center|s.Canonic.Axis|s.Canonic.Circle|s.Canonic.Plane,r},removeAnchorsInteractors:function(){var e=this.getAllInteractors();for(var t in e)if(e.hasOwnProperty(t)){var i=e[t];i&&i.handle&&(i.handle.remove(),i.handle=null)}},beginManipAnchor2D:function(t,i,a){var o=t&&t.manipulator&&t.manipulator.interactor,s=this.QueryInterface("W3AISGNodeHolder");s&&s.giveSGNode()&&s.giveSGNode().setPickable(e.PICKTHROUGH);var n="Actor.Anchor."+o.data.anchorID,l=this.QueryInterface("VCXIModifiable");if(l.GetPropertyValue("Collab.3D.Paper.Positioning.Type")!==r.EPositionType.Free3D){var p=l.GetProperty(n).GetPropertyValue().Clone(),u=this.GetObject()._experienceBase.ComponentsMap.GetComponentFromLink(p.GetValueLink());if(u){var h=this._getShapeInfoFromComponent(u);h?this._initManipInfos={smartNodePos2D:h.smartNode.Position2D.clone(),smartNodeSize:h.size.clone()}:console.warn("No shapeInfo has been found for the dressup manipulated..")}else console.log("Shouldn't be available.. 2D anchors always have a link on a 2D panel..")}else console.warn("Something's wrong, we shouldn't have an anchor2D on a Free3D-positioned panel..")},manipAnchor2D:function(e,t,i){var r=e&&e.manipulator&&e.manipulator.interactor;if(this._initManipInfos&&r){var o=this.QueryInterface("VCXIModifiable");if(o&&void 0!==r.data.anchorID){var s="Actor.Anchor."+r.data.anchorID,n=o.GetProperty(s),l=this._getMovedAnchor2DProperty(t,i,r.requestedMatrix,this._initManipInfos.smartNodePos2D,this._initManipInfos.smartNodeSize,n),p=r.requestedPropertySet||new a;p.AddOrModifyProperty(l),r.requestedPropertySet=p}}},endManipAnchor2D:function(t,o,s){var n=t&&t.manipulator&&t.manipulator.interactor;if(this._initManipInfos&&n){if(t.intersection.path[0]){var l=i.GetComponentToAttachTo(this.GetObject(),t.intersection.path[0]),p=l.QueryInterface("VCXIModifiable");if(l.IsKindOf("VCXMarkup_Spec")&&p.GetPropertyValue("Collab.3D.Paper.Positioning.Type")===r.EPositionType.Free2D){var u=this.QueryInterface("VCXIModifiable"),h="Actor.Anchor."+n.data.anchorID,d=u.GetProperty(h);d.GetPropertyValue().SetValueLinkFromComponent(l);var c=this._getShapeInfoFromComponent(l);if(!c)return;var y=c.smartNode.Position2D.clone(),m=c.size.clone(),C=this._getMovedAnchor2DProperty(o,s,n.requestedMatrix,y,m,d);if(C){var f=n.requestedPropertySet||new a;f.AddOrModifyProperty(C),n.requestedPropertySet=f}}}var V=this.QueryInterface("W3AISGNodeHolder");V&&V.giveSGNode()&&(this._initManipInfos=null,V.giveSGNode().setPickable(e.PICKABLE))}},_getShapeInfoFromComponent:function(e){var t=e.QueryInterface("W3AISGNodeHolder"),i=t&&t.getSGNode(),r=i&&i.GetShapeInfo();if(r&&0!==r.size.x&&0!==r.size.y)return r},_getMovedAnchor2DProperty:function(e,t,i,r,a,s){var l=(new n.Vector3).getPositionFromMatrix(i),p=e.ModelToMM2(t,l),u=new n.Vector3((p.x-r.x)/a.x,(p.y-r.y)/a.y,0),h=(new o).SetValueFromVector(u),d=s.Clone();return d.GetPropertyValue().SetValueFrame(h),d},beginManipAnchor3D:function(t){var i=this.QueryInterface("W3AISGNodeHolder");i&&i.giveSGNode()&&i.giveSGNode().setPickable(e.PICKTHROUGH)},manipAnchor3D:function(e){var t=e&&e.manipulator&&e.manipulator.interactor,o=this.QueryInterface("VCXIModifiable");if(o&&t&&void 0!==t.data.anchorID){this.GetObject()._experienceBase;var s,n="Actor.Anchor."+t.data.anchorID,l=(m=o.GetProperty(n).Clone()).GetPropertyValue().GetValueLink(),p=this.GetObject()._experienceBase.ComponentsMap.GetComponentFromLink(l);p||(p=this.GetObject().getWorkingRootComponent());var u=e.intersection.path&&e.intersection.path[0],h=i.GetComponentToAttachTo(this.GetObject(),u);if(u){var d=h.QueryInterface("VCXIModifiable");if(p!==h&&(h.IsKindOf("VCXComponentOccurrenceExt")||h.IsKindOf("VCXMarkup_Spec")&&d.GetPropertyValue("Collab.3D.Paper.Positioning.Type")===r.EPositionType.Free3D&&0===d.GetPropertyValue("Collab.3D.Paper.Size.Control.Type")))s=i.BuildNewPropertyValueAnchor(t.requestedMatrix,this.GetObject(),u);else{var c=p.QueryInterface("W3AISGNodeHolder").getMatrixInLCS(this.GetObject()._experienceBase.getManager("VCXContextManager").getMainViewer(),t.requestedMatrix);(y=m.GetPropertyValue().GetValueFrame()).Value=c,(s=m.GetPropertyValue()).SetValueFrame(y)}}else if(p!==h)s=i.BuildNewPropertyValueAnchor(t.requestedMatrix,this.GetObject(),u);else{var y;c=p.QueryInterface("W3AISGNodeHolder").getMatrixInLCS(this.GetObject()._experienceBase.getManager("VCXContextManager").getMainViewer(),t.requestedMatrix);(y=m.GetPropertyValue().GetValueFrame()).Value=c,(s=m.GetPropertyValue()).SetValueFrame(y)}var m;n="Actor.Anchor."+t.data.anchorID;(m=o.GetProperty(n).Clone()).SetPropertyValue(s);var C=t.requestedPropertySet||new a;C.AddOrModifyProperty(m),t.requestedPropertySet=C}},endManipAnchor3D:function(t){this.manipAnchor3D(t);var i=this.QueryInterface("W3AISGNodeHolder");i&&i.giveSGNode()&&i.giveSGNode().setPickable(e.PICKABLE)}})}),define("DS/VCXWebDressup/VCXAViewpointController",["UWA/Class","DS/Visualization/ThreeJS_DS","DS/Visualization/Viewpoint","DS/VCXWebTracks/VCXInterpolator","DS/VCXWebProperties/VCXPropertyValueFrame","DS/VCXWebTracks/VCXInterpolatorLinear","DS/VCXWebTracks/VCXInterpolatorCubic","DS/VCXWebTracks/VCXInterpolatorSpherical","DS/VCXWebKernelTools/VCXMathTools","DS/VCXWebKernelCommands/VCXCmdChangePropertiesWithAnimation","DS/VCXWebProperties/VCXProperty","DS/VCXWebDressup/VCXAnchorServices"],function(e,t,i,r,a,o,s,n,l,p,u,h){"use strict";return e.extend({init:function(){this._parent()},GetInterpolator:function(e){if("Camera.Position"===e){if(this.shouldUseSphericalInterpolator()){var t=new n;return t.setPositionPropertyName("Actor.Anchor.1"),t.setTargetPropertyName("Actor.Anchor.2"),t.setHeightPropertyName("Camera.Height"),t.setAnglePropertyName("Camera.Angle"),t.setOrthoPropertyName("Camera.Ortho"),t}return null}if("Actor.Anchor.1"===e||"Actor.Anchor.2"===e){var i=this.GetObject()._experienceBase.getManager("VCXVisuManager"),a=this.QueryInterface("VCXIModifiable");return"Actor.Anchor.1"===e&&(i.isInTransitionMode()||a.GetPropertyValue("Camera.Arcball")&&a.GetPropertyValue("Actor.Interpolation.Type")===r.EInterpolationType.Linear)?new o:a.GetPropertyValue("Actor.Interpolation.Type")===r.EInterpolationType.Linear?new o:new s}return null},toViewpoint:function(){if(this.GetObject()._experienceBase.getManager("VCXVisuManager").getUpdateViewport()){var e=this.GetObject()._experienceBase.getManager("VCXContextManager"),r=this.QueryInterface("VCXIModifiable");if(e&&r){var a=e.getMainViewer().currentViewpoint;if(a){this.__translation||(this.__translation=new t.Vector3),this.__quaternion||(this.__quaternion=new t.Quaternion);var o=this.getMatrixAndDOI();o.matrix.decompose(this.__translation,this.__quaternion,void 0),a.moveTo({eyePosition:this.__translation,orientation:this.__quaternion,distanceToTarget:o.doi});var s=a.camera.pixelCulling;a.setProjectionType(r.GetPropertyValue("Camera.Ortho")?i.ORTHOGRAPHIC:i.PERSPECTIVE),a.setPixelCulling(s);var n=45;r.GetPropertyValue("Camera.Ortho")?o.doi&&(n=360*Math.atan(.5*r.GetPropertyValue("Camera.Height")/o.doi)/Math.PI):r.GetPropertyValue("Camera.Angle")>0&&(n=r.GetPropertyValue("Camera.Angle")),n=Math.max(.001,Math.min(n,179)),a.setAngle(n);var p=this.GetObject()._experienceBase.getManager("VCXIVManager");if(p&&p.scenario){var u=new t.Vector3(0,0,1),h=(new t.Vector3).crossVectors(u,a.getSightDirection()),d=(new t.Vector3).crossVectors(u,h),c=l.getMatrixFromOVxVy(new t.Vector3,h,d),y=e.getRootNode().getMatrix().clone().multiply(p.scenario.getInverseTranslationToCenterModelOnTable()),m=(new t.Matrix4).getInverse(y,!1);c.multiply(m),p.scenario.setTurnTableBasis(c)}}}}},fromViewpoint:function(e){var r=this.GetObject()._experienceBase.getManager("VCXContextManager"),o=this.QueryInterface("VCXIModifiable");if(r&&o){var s=r.getMainViewer().currentViewpoint;if(s){var n=s.getEyePosition(),l=s.getTarget(),p=s.getSightDirection();p.negate();var u,h=s.getUpDirection(),d=(new t.Vector3).crossVectors(h,p),c=(new t.Matrix4).makeBasis(d,h,p).setPosition(n),y=o.GetProperty("Actor.Anchor.1"),m=this.GetObject()._experienceBase.ComponentsMap.GetComponentFromLink(y.GetPropertyValue().GetValueLink());m||(m=this.GetObject().getWorkingRootComponent()),m&&(u=m.QueryInterface("W3AISGNodeHolder").getWorldMatrix(r.getMainViewer())),u||(u=new t.Matrix4);var C=(new t.Matrix4).getInverse(u),f=(new t.Matrix4).multiplyMatrices(C,c),V=o.GetProperty("Camera.Position"),b=new a(f);V.SetPropertyValue(b),e?e.AddOrModifyProperty(V):o.OnChangeProperty("Camera.Position",b),(b=(V=o.GetProperty("Actor.Anchor.1")).GetPropertyValue()).SetValueFrame(new a(f)),V.SetPropertyValue(b),e?e.AddOrModifyProperty(V):o.OnChangeProperty("Actor.Anchor.1",b);var P=(new t.Matrix4).makeBasis(d,h,p).setPosition(l),_=(new t.Matrix4).multiplyMatrices(C,P);(b=(V=o.GetProperty("Actor.Anchor.2")).GetPropertyValue()).SetValueFrame(new a(_)),V.SetPropertyValue(b),e?e.AddOrModifyProperty(V):o.OnChangeProperty("Actor.Anchor.2",b),(b=(V=o.GetProperty("Camera.Ortho")).GetPropertyValue()).SetValue(s.getProjectionType()===i.ORTHOGRAPHIC),V.SetPropertyValue(b),e?e.AddOrModifyProperty(V):o.OnChangeProperty("Camera.Ortho",b);var g=s.getAngle();(b=(V=o.GetProperty("Camera.Angle")).GetPropertyValue()).SetValue(g),V.SetPropertyValue(b),e?e.AddOrModifyProperty(V):o.OnChangeProperty("Camera.Angle",b),g/=360/Math.PI;var S=Math.tan(g)*s.getTargetDistance();S*=2,(b=(V=o.GetProperty("Camera.Height")).GetPropertyValue()).SetValue(S),V.SetPropertyValue(b),e?e.AddOrModifyProperty(V):o.OnChangeProperty("Camera.Height",b)}}},resetMatrixAndDOI:function(){this._matrixAndDOI=null},shouldUseSphericalInterpolator:function(){var e=this.QueryInterface("VCXIModifiable");return this.GetObject()._experienceBase.getManager("VCXVisuManager").isInTransitionMode()||
/*!cameraModifiable.GetPropertyValue("Camera.Ortho") && */e.GetPropertyValue("Camera.Arcball")&&e.GetPropertyValue("Actor.Interpolation.Type")===r.EInterpolationType.Linear},getMatrixAndDOI:function(){if(this._matrixAndDOI)return this._matrixAndDOI;var e=this.QueryInterface("VCXIModifiable");if(e){var i,r=this.shouldUseSphericalInterpolator();if(r){var a=this.GetObject()._experienceBase.getManager("VCXContextManager"),o=e.GetProperty("Actor.Anchor.1"),s=this.GetObject()._experienceBase.ComponentsMap.GetComponentFromLink(o.GetPropertyValue().GetValueLink());if(s||(s=this.GetObject().getWorkingRootComponent()),s){var n=s.QueryInterface("W3AISGNodeHolder").getWorldMatrix(a.getMainViewer());n||(n=new t.Matrix4),i=n.multiply(e.GetPropertyValue("Camera.Position"))}else i=e.GetPropertyValue("Camera.Position")}else i=e.GetAnchorWorldMatrix(1,null);var p=e.GetAnchorWorldMatrix(2,null),u=(new t.Vector3).getPositionFromMatrix(p),h=(new t.Vector3).getPositionFromMatrix(i);if(e.GetPropertyValue("Camera.Ortho")){var d=e.GetPropertyValue("Camera.Height");h=new t.Vector3(0,0,d).applyMatrix4(p),i.setPosition(h)}if(!r){if(!e.GetPropertyValue("Camera.Pitch")&&!e.GetPropertyValue("Camera.Yaw")&&e.GetPropertyValue("Camera.LockDistCOI")){var c=new t.Vector3,y=new t.Vector3,m=new t.Vector3;i.extractBasis(c,y,m),i.setPosition((new t.Vector3).addVectors(u,m.multiplyScalar(Math.abs(e.GetPropertyValue("Camera.DistCOI")))))}if(!e.GetPropertyValue("Camera.Pitch")){var C=(new t.Matrix3).copy(i),f=(new t.Matrix3).getInverse(i);h=(new t.Vector3).getPositionFromMatrix(i);(V=(new t.Vector3).subVectors(u,h)).applyMatrix3(f),V.y=0,V.applyMatrix3(C),i.setPosition((new t.Vector3).subVectors(u,V))}if(!e.GetPropertyValue("Camera.Yaw")){var V;C=(new t.Matrix3).copy(i),f=(new t.Matrix3).getInverse(i),h=(new t.Vector3).getPositionFromMatrix(i);(V=(new t.Vector3).subVectors(u,h)).applyMatrix3(f),V.x=0,V.applyMatrix3(C),i.setPosition((new t.Vector3).subVectors(u,V))}h=(new t.Vector3).getPositionFromMatrix(i);if(e.GetPropertyValue("Camera.Roll")){c=new t.Vector3,y=new t.Vector3,m=new t.Vector3;if(i.extractBasis(c,y,m),(S=(new t.Vector3).subVectors(h,u)).length()){S.normalize();var b=(new t.Vector3).crossVectors(y,S).normalize(),P=(new t.Vector3).crossVectors(S,b).normalize(),_=(new t.Vector3).crossVectors(b,P).normalize(),g=(new t.Vector3).crossVectors(_,b);i.makeBasis(b,g,_).setPosition(h)}}else{var S=(new t.Vector3).subVectors(h,u);b=(new t.Vector3).crossVectors(new t.Vector3(0,0,1),S),P=new t.Vector3;0===b.length()?(b=new t.Vector3(1,0,0),P=new t.Vector3(0,1,0)):P.crossVectors(S,b);_=(new t.Vector3).crossVectors(b,P).normalize();b.normalize();g=(new t.Vector3).crossVectors(_,b);i.makeBasis(b,g,_),i.setPosition(h)}if(e.GetPropertyValue("Camera.LockDistCOI")){c=new t.Vector3,y=new t.Vector3,m=new t.Vector3;i.extractBasis(c,y,m),i.setPosition((new t.Vector3).addVectors(u,m.multiplyScalar(Math.abs(e.GetPropertyValue("Camera.DistCOI")))))}}h.getPositionFromMatrix(i);var M=h.distanceTo(u),D=l.getVzFromMatrix(i),G=(new t.Vector3).crossVectors(new t.Vector3(0,0,1),D),v=l.getVxFromMatrix(i),A=G.angleTo(v);G.cross(v).dot(D)<=0&&(A=-A);var x=45;d=100;if(e.GetPropertyValue("Camera.Ortho"))M&&(d=e.GetPropertyValue("Camera.Height"),x=360*Math.atan(.5*e.GetPropertyValue("Camera.Height")/M)/Math.PI);else x=e.GetPropertyValue("Camera.Angle"),d=Math.tan(.5*x*Math.PI/180)*M*2;return x=Math.max(.001,Math.min(x,179)),e._matrixAndDOI={matrix:i,target:u,doi:M,angle:x,height:d,roll:A},e._matrixAndDOI}},alignToObject:function(e){var i=this.GetObject()._experienceBase,r=i.getManager("VCXContextManager").getMainViewer(),a=e.QueryInterface("W3AISGNodeHolder");if(a){var o=this.QueryInterface("VCXIModifiable");if(o){var s=a.getWorldMatrix(r).multiply((new t.Matrix4).makeRotationY(Math.PI)),n=i.ComponentsMap.GetComponentFromLink(o.GetProperty("Actor.Anchor.2").GetPropertyValue().GetValueLink());n||(n=this.GetObject().getWorkingRootComponent());var d=n.QueryInterface("W3AISGNodeHolder");if(d){var c=h.GetNewPropertyValueAnchor(d.getMatrixInLCS(r,s),n),y=.5*o.GetPropertyValue("Camera.Angle"),m=a.getPathElement().getBoundingSphere(r).radius/Math.tan(y);s.setPosition(a.getPathElement().getBoundingSphere(r).center);var C=l.getOFromMatrix(s).add(l.getVzFromMatrix(s).normalize().multiplyScalar(m)),f=s.clone().setPosition(C),V=i.ComponentsMap.GetComponentFromLink(o.GetProperty("Actor.Anchor.1").GetPropertyValue().GetValueLink());V||(V=this.GetObject().getWorkingRootComponent());var b=V.QueryInterface("W3AISGNodeHolder");if(b){var P=h.GetNewPropertyValueAnchor(b.getMatrixInLCS(r,f),V),_=new p(i.getManager("VCXScenarioManager"),i.ComponentsMap,i.getManager("VCXCommandManager"));_.SetTransitionTime(1e3);var g=new u(o.GetProperty("Actor.Anchor.1").GetPropertyInfo(),P);_.ChangeProperty(o,g);g=new u(o.GetProperty("Actor.Anchor.2").GetPropertyInfo(),c);_.ChangeProperty(o,g),i.getManager("VCXCommandManager").Push(_)}}}}}})}),define("DS/VCXWebDressup/VCXDressupModifiable",["DS/VCXWebExperienceBase/VCXModifiableOccurrenceExperience","DS/VCXWebComponents/VCXWebComponentOccurrence","DS/VCXWebDressup/VCXAnchorServices","DS/VCXWebModifiablesServices/VCXModifiablesAccess","DS/VCXWebVisibility/VCXIVisibility","DS/VCXWebTracks/VCXInterpolator","DS/VCXWebProperties/VCXColor","DS/VCXWebProperties/VCXPropertyGroup","DS/VCXWebProperties/VCXProperty","DS/VCXWebProperties/VCXPropertyInfo","DS/VCXWebProperties/VCXPropertyInfoEnum","DS/VCXWebProperties/VCXPropertyValueBoolean","DS/VCXWebProperties/VCXPropertyValueString","DS/VCXWebProperties/VCXPropertyValueColor","DS/VCXWebProperties/VCXPropertyValueLocation","DS/VCXWebProperties/VCXPropertyValueEnum","DS/VCXWebProperties/VCXPropertyValueVector","DS/Visualization/ThreeJS_DS","i18n!DS/VCXWebModifiables/assets/nls/VCXWebModifiables","i18n!DS/VCXWebDressup/assets/nls/VCXWebDressup"],function(e,t,i,r,a,o,s,n,l,p,u,h,d,c,y,m,C,f,V,b){"use strict";var P=e.extend({init:function(){this._parent(),this._Properties=[],this._PropertiesFormatPainter=[],this._PropertyGroups=[],this._Anchors={}},Build:function(){this._parent();var e=[{Name:"Actor.Color",Type:c,i18n:V,visibleInPropertyGroups:!1,FormatPainter:!0},{Name:"Actor.Color.Defined",Type:h,DefaultValue:!0,i18n:V,visibleInPropertyGroups:!1,FormatPainter:!0},{Name:"Actor.Position",Type:y,DefaultValue:(new y).GetValue(),i18n:V,visibleInPropertyGroups:!1},{Name:"Collab.HideIfOutsideAnchorFrustrum",Type:h,DefaultValue:!1},{Name:"Actor.Interpolation.Type",Type:m,DefaultValue:o.EInterpolationType.Linear,i18n:V,MapChoice:this._generateMapChoiceFromEnumAndId(o.EInterpolationType,"Interpolation",["Custom","Smooth"]),visibleInPropertyGroups:!1},{Name:"Actor.IsAlwaysOnTop",Type:h,DefaultValue:!0}];this._BuildPropertyValues(e)},_BuildPropertyValues:function(e){for(var t=this.QueryInterface("VCXIModifiableView"),i=t&&t.getGroupPropertiesOrders(),r=0;r<e.length;++r){var a=e[r].Name,o=this._Properties[a],s=null,h=null;if(o&&(s=o.GetPropertyInfo(),h=o.GetPropertyValue()),!s){var d=0;void 0!==e[r].BehaviorType&&(d=e[r].BehaviorType);let t=b;void 0!==e[r].i18n&&(t=e[r].i18n);var c=!0;void 0!==e[r].Persistent&&(c=e[r].Persistent),e[r].ControlsGroupAvailability?(s=new u(a,d=2,c,t)).SetMapChoiceEnum(this._generateMapChoiceFromEnumAndId(P.EAvailability,"Group.Availability")):void 0!==e[r].MapChoice?(s=new u(a,d,c,t),void 0!==e[r].MapChoice&&s.SetMapChoiceEnum(e[r].MapChoice)):s=new p(a,d,c,t)}void 0!==e[r].Bounds&&s.SetBounds(e[r].Bounds.Min,e[r].Bounds.Max,e[r].Bounds.Step),e[r].UnitType&&s.SetUnitType(e[r].UnitType),e[r].GroupId?s.SetGroupId(e[r].GroupId):s.GetGroupId()?e[r].GroupId=s.GetGroupId():(e[r].GroupId="Group.Essentials",s.SetGroupId(e[r].GroupId));var y=e[r].GroupId;this._PropertyGroups[y]||(this._PropertyGroups[y]=new n({groupID:y})),this._PropertyGroups[y].i18nGroup||("Group.Essentials"===y?this._PropertyGroups[y].i18nGroup=V:t&&(this._PropertyGroups[y].i18nGroup=t.getPropertyGroupsi18n()));var m=e[r].ControlsGroupAvailability||this._PropertyGroups[y].PropertyControlingGroupAvailability===a,C=e[r].ControlsGroupVisibility||this._PropertyGroups[y].PropertyControlingGroupVisibility===a;if(i&&i[y])this._PropertyGroups[y].setPropertiesOrder(i[y]);else{var f=this.ExperienceBase.getManager("VCXContextManager");f&&void 0!==f.getUrlVars().debug&&console.warn("PropertiesOrder missing for "+y+" !! (component "+this.GetObject().GetType()+")")}if(m){var _=e[r].DefaultValue;void 0!==_&&(_===P.EAvailability.AppForceAvailable?this._PropertyGroups[y].availability=!0:_===P.EAvailability.AppForceNotAvailable?this._PropertyGroups[y].availability=!1:this._PropertyGroups[y].availability=void 0),this._PropertyGroups[y].PropertyControlingGroupAvailability=a}if(C){var g=e[r].DefaultValue;void 0!==g&&(this._PropertyGroups[y].visibility=g),this._PropertyGroups[y].PropertyControlingGroupVisibility=a,s.SetControlsGroupVisibility(!0)}var S={propertyName:a,i18n:s.Geti18n()};e[r].hiddenFields&&(S.hiddenFields=e[r].hiddenFields);for(var M=Object.keys(this._PropertyGroups),D=0;D<M.length;D++){var G=M[D],v=this._PropertyGroups[G];v.isIn(a)&&(this._PropertyGroups[y].addPropertyFromPropertyGroup(v,a),v.removeProperty(a))}this._PropertyGroups[y].addProperty(S),"boolean"==typeof e[r].visibleInPropertyGroups&&this._PropertyGroups[y].setVisible(a,e[r].visibleInPropertyGroups),!h&&e[r].Type&&(h=new e[r].Type),h?(h&&void 0!==e[r].DefaultValue&&h.SetValue(e[r].DefaultValue),o||(this._Properties[a]=new l(s,h)),void 0!==e[r].DefaultValue&&this.OnChangeProperty(a,h),!o&&e[r].FormatPainter&&this._PropertiesFormatPainter.push(a)):console.warn("No propertyValue found for "+a+".")}this.SetPropertiesInfo(),t&&t.SetPropertiesViewInfo()},SetPropertiesInfo:function(){this.SetPropertyInvisible("Actor.Interpolation.Type",!0),this.SetPropertyInvisible("Actor.Color",!0),this.SetPropertyInvisible("Actor.Color.Defined",!0),this.SetPropertyInvisible("Actor.Opacity.Defined",!0),this.SetPropertyInvisible("Actor.Visibility.Opacity",!0),this.SetPropertyInvisible("Actor.Position",!0),this.SetPropertyInvisible("Collab.HideIfOutsideAnchorFrustrum",!0)},GetPropertyValue:function(e,t){var i;if(t?i=this.GetProperty(e):(i=this._Properties[e])||(i=this.GetProperty(e)),i&&i.GetPropertyValue())return i.GetPropertyValue().Value},GetNewProperty:function(e,t){var i=null;if(this._Properties[e]){var r=this._Properties[e].GetPropertyValue().Clone();r.SetValue(t),i=new l(this._Properties[e].GetPropertyInfo(),r)}return i},GetNewEnumProperty:function(e,t){if(this._Properties[e]){var i=this._Properties[e].GetPropertyInfo().GetMapChoiceEnum();for(var r in i)if(i.hasOwnProperty(r)&&i[r]===t)return this.GetNewProperty(e,parseInt(r))}return null},GetAttachedOccurence:function(e){var t=this._Anchors&&this._Anchors[e],i=t&&t.GetValueLink().Value;if(i)return this.ExperienceBase.ComponentsMap.GetComponentFromID(i)},GetAttachedOccurences:function(){var e=[];return this.processAnchorsIDs(t=>{var i=this.GetAttachedOccurence(t);i&&e.push(i)}),e},GetComputedStringProperty:function(e,t){var i,a=this.GetProperty(e);if(a&&(i=a.GetPropertyValue().ToString())){var o="",s=this._Anchors[0];return s&&(o=s.GetValueLink().Value),r.ValuateLinkedProperties(i,this.ExperienceBase,o,this.GetObject().GetID(),t)}},getAnchorsCount:function(){var e=0,t=this.GetPropertyValue("Collab.ListAnchorsIDs");return t&&(e+=t.length),(t=this.GetPropertyValue("Collab.List2DAnchorsIDs"))&&(e+=t.length),e},getNewAnchorID:function(){for(var e=this.getAnchorsCount();this._Anchors[e];)++e;return e},GetAnchorValue:function(e){return this._Anchors[e]?this._Anchors[e].GetValueFrame().Value:null},GetAnchorWorldMatrix:function(e,t){var r=this._Anchors[e];return r?i.getWorldMatrix(r,this.GetObject(),t):null},GetFontPropertyValue:function(e){var t=this.GetProperty(e);if(t){var i=t.GetPropertyValue();if(i)return i.GetFont()}return null},GetColorPropertyValue:function(e){var t=this.GetPropertyValue(e+".Color"),i=this.GetPropertyValue(e+".Color.Opacity");void 0===i&&(i=this.GetPropertyValue(e+".Opacity"));var r=new s;return"object"==typeof t&&(r=t.Clone()),void 0===i&&(i=1),"number"==typeof i&&i>=0&&i<=1?r.a=i:console.warn("Opacity range [0.0,1.0]"),r},GetFramePropertyValue:function(e){var t=this.GetProperty(e);return t?t.GetPropertyValue().GetFrame().Value:null},_SetProperty:function(e,t){if(void 0===this._Properties[e]&&t){var i;if("Actor.Anchor."!==e.substring(0,13))return!1;(i=new p(e,0)).SetVisible(!1),i&&(this._Properties[e]=new l(i,t.Clone())),!0}var r=this._Properties[e];if(t){if(!t.IsEqualTo(r.GetPropertyValue()))if(void 0!==r.GetPropertyValue()&&void 0!==t){r.SetPropertyValue(t.Clone()),!0;var a=r.GetPropertyInfo().GetGroupId(),o=this._PropertyGroups[a];if(o&&e===o.PropertyControlingGroupVisibility&&(this._PropertyGroups[a].visibility=t.GetValue()),o&&e===o.PropertyControlingGroupAvailability){var s=t.GetValue();s===P.EAvailability.AppForceAvailable?this._PropertyGroups[a].availability=!0:s===P.EAvailability.AppForceNotAvailable?this._PropertyGroups[a].availability=!1:this._PropertyGroups[a].availability=void 0}}else console.warn("WTF !!!")}else!0,delete this._Properties[e];if("Actor.Anchor."===e.substring(0,13)){var n=e.substring(13,30);if(t){if(!t.IsEqualTo(this._Anchors[n])){!0;var u=null;this._Anchors[n]&&(u=this._Anchors[n].is2DAnchor),this._Anchors[n]=t.Clone(),null!==u&&(this._Anchors[n].is2DAnchor=u)}}else{!0,delete this._Anchors[n];var h=this.GetPropertyValue("Collab.ListAnchorsIDs"),d=h.indexOf(n);if(d>=0){h.splice(d,1);var c=new C(h);this.OnChangeProperty("Collab.ListAnchorsIDs",c)}}}if("Actor.Name"===e){var y=t.Value,m=this.QueryInterface("W3AISGNodeHolder");if(m){var f=m.giveSGNode();f&&f.setName(y)}}return!0},OnChangeProperty:function(e,t,i){if(i||(i={}),i.fromChildClass);else if(this.OnChangePropertyBegin(e,t))return!0;if("Collab.ListAnchorsIDs"!==e&&"Collab.List2DAnchorsIDs"!==e||(this._needToUpdateAnchors=!0),!this._SetProperty(e,t)){var r=!1;if(!r&&(i.fromChildClass=!0,r=this._parent(e,t,i))){var a=this.QueryInterface("W3AISGNodeHolder");a&&a.setSGNodeDirty(!0)}return r||console.warn("Unknown property on "+this.GetPropertyValue("Actor.Name")+" : "+e),r}return!0},OnChangePropertiesEnd:function(){this._needToUpdateAnchors&&(this.updateAnchorsType(),this._needToUpdateAnchors=!1),this._parent(),this.GetObject().setDirty()},GetProperty:function(e){var t=null,i=this._Properties[e];if(i)t=new l(i.GetPropertyInfo(),i.GetPropertyValue().Clone());else{if(e.endsWith("._ComputedText")){var r=e.substring(0,e.length-"._ComputedText".length),a=this.GetComputedStringProperty(r),o=new d(a),s=new p(r,1,!1);t=new l(s,o)}t||(t=this._parent(e))}return t},GetProperties:function(e){this.SetPropertiesInfo();var t,i=this._parent(),r=this;for(t in this._Anchors&&Object.keys(this._Anchors).length>0&&this.processAnchorsIDs(function(e){i.AddOrModifyProperty(r.GetProperty("Actor.Anchor."+e))}),this._Properties)if(this._Properties.hasOwnProperty(t)){var a=!0,o=!0,s=this._Properties[t].GetPropertyInfo(),n=s.GetGroupId();if(n){var l=this._PropertyGroups[n];if(l){var p=l.PropertyControlingGroupAvailability&&t===l.PropertyControlingGroupAvailability,u=l.PropertyControlingGroupVisibility&&t===l.PropertyControlingGroupVisibility;!1!==l.availability||p||(a=!1),a&&(u?!0===l.availability&&(o=!1):!1===l.visibility&&(o=!1))}}s.IsVisible()!==(o&&!this._Properties[t].Invisible)&&s.SetVisible(o&&!this._Properties[t].Invisible),a&&i.AddOrModifyProperty(this.GetProperty(t))}return i},getPropertiesFormatPainter:function(){return this._PropertiesFormatPainter},getPropertyGroups:function(e){var t=this.QueryInterface("VCXIModifiableView");if(t)return t.getPropertyGroups(iGroupName)},GetPropertyGroupVisibility:function(e){var t=this.QueryInterface("VCXIModifiableView");return!t||t.GetPropertyGroupVisibility(e)},SetPropertyInvisible:function(e,t){var i=this.QueryInterface("VCXIModifiableView");i&&i.SetPropertyInvisible(e,t)},ChangeGroupAvailability:function(e,t){var i=this.QueryInterface("VCXIModifiableView");i&&i.ChangeGroupAvailability(e,t)},changeMapChoice:function(e,t){this._Properties[e]&&this._Properties[e].GetPropertyInfo().SetMapChoiceEnum(t)},Dispose:function(){},processAnchorsIDs:function(e,t){var i,r=[];t&&t.no3DAnchors||(i=this.GetPropertyValue("Collab.ListAnchorsIDs"))&&(r=r.concat(i));t&&t.no2DAnchors||(i=this.GetPropertyValue("Collab.List2DAnchorsIDs"))&&(r=r.concat(i));if(t&&t.sort&&r.sort(),Array.isArray(r)&&r.length>0)for(var a=0;a<r.length;++a){if(!1===e(r[a]))return}},updateAnchorsType:function(){var e=this.GetPropertyValue("Collab.ListAnchorsIDs");if(Array.isArray(e)&&e.length>0)for(var t=0;t<e.length;++t){var i=e[t];this._Anchors[i]?this._Anchors[i].is2DAnchor=!1:console.warn("Can't find refered anchor:"+i)}if(e=this.GetPropertyValue("Collab.List2DAnchorsIDs"),Array.isArray(e)&&e.length>0)for(t=0;t<e.length;++t){i=e[t];this._Anchors[i]?this._Anchors[i].is2DAnchor=!0:console.warn("Can't find refered anchor:"+i)}},getPositionOfFirstAnchor:function(){var e=this.GetPropertyValue("Collab.ListAnchorsIDs")[0],t=this.GetAnchorWorldMatrix(e);return(new f.Vector3).getPositionFromMatrix(t)},getPositionOfLastAnchor:function(){var e=this.GetPropertyValue("Collab.ListAnchorsIDs"),t=e[e.length-1],i=this.GetAnchorWorldMatrix(t);return(new f.Vector3).getPositionFromMatrix(i)},getLineMaterialParams:function(e,i,r,a){"number"!=typeof a&&(a=1);var o={},s=this.GetPropertyValue(e+".Type"),n=this.GetPropertyValue(e+".Width"),l=this.GetColorPropertyValue(e),p=l.GetThreeColor(),u=l.a,h=this.GetProperty(e+".2.Color");if(!i||r!==s)if(s===t.ELineType.UserDefined){var d=this.GetPropertyValue(e+".StipplingMotif");if(d){var c=d.split(" ");o.dashPattern=c.map(function(e){return 4*parseInt(e)})}}else o.type=s;if(i&&i.lineWidth===n&&(1!==i.lineWidth||i.visible)||(o.lineWidth=n),h)i&&i.vertexColors===f.VertexColors||(o.vertexColors=f.VertexColors),i&&i.opacity===a||(o.opacity=a);else{i&&i.color.equals(p)||(o.color=p);var y=u*a;i&&i.opacity===y||(o.opacity=y)}return o},GetOpacity:function(){var e=this.GetPropertyValue("Actor.Opacity");if((e*=this.GetPropertyValue("Actor.Visibility.Opacity"))>0){var t=this.QueryInterface("VCXIVisibility");t&&t.GetVisibility()===a.EVisState.Hidden&&(e=0)}return e}});return P.EAvailability={NoControl:0,AppForceAvailable:1,AppForceNotAvailable:2,AppNotVisible:3},Object.defineProperty(P.prototype,"ExperienceBase",{enumerable:!0,get:function(){return this.GetObject()._experienceBase}}),P}),define("DS/VCXWebDressup/VCXRedLineModifiable",["DS/Visualization/ThreeJS_DS","DS/VCXWebDressup/VCXDressupModifiable","DS/VCXWebProperties/VCXColor","DS/VCXWebProperties/VCXPropertyValueInt","DS/VCXWebProperties/VCXPropertyValueFloat","DS/VCXWebProperties/VCXPropertyValueFrame","DS/VCXWebProperties/VCXPropertyValueAnchor","DS/VCXWebProperties/VCXPropertyValueVector","DS/VCXWebProperties/VCXPropertyValueMap"],function(e,t,i,r,a,o,s,n,l){"use strict";return t.extend({init:function(){this._parent()},Build:function(){this._parent();var t=[{Name:"Actor.Color",DefaultValue:(new i).FromRGBA(1,0,0,1),GroupId:"Group.Line",FormatPainter:!0},{Name:"Collab.Body.Line.Width",Type:a,DefaultValue:2,GroupId:"Group.Line",FormatPainter:!0},{Name:"Actor.Anchor.0",Type:s,DefaultValue:(new s).SetValueFrame((new o).SetValueFromVector(new e.Vector3(0,0,0))).GetValue()},{Name:"Collab.ListAnchorsIDs",Type:n,DefaultValue:[0]},{Name:"Collab.VertexBuffers",Type:l,BehaviorType:2,DefaultValue:new l}];this._BuildPropertyValues(t)},SetPropertiesInfo:function(){this._parent(),this.SetPropertyInvisible("Actor.Color",!1),this.SetPropertyInvisible("Collab.ListAnchorsIDs",!0),this.SetPropertyInvisible("Collab.VertexBuffers",!0),this.SetPropertyInvisible("Actor.Color",!1),this.SetPropertyInvisible("Actor.Anchor.0",!0)}})}),define("DS/VCXWebDressup/VCXCameraModifiable",["DS/Visualization/ThreeJS_DS","DS/VCXWebDressup/VCXDressupModifiable","DS/VCXWebTracks/VCXInterpolator","DS/VCXWebProperties/VCXColor","DS/VCXWebProperties/VCXPropertyValueAnchor","DS/VCXWebProperties/VCXPropertyValueFrame","DS/VCXWebProperties/VCXPropertyValueBoolean","DS/VCXWebProperties/VCXPropertyValueFloat","DS/VCXWebProperties/VCXPropertyValueEnum","DS/VCXWebProperties/VCXPropertyValueColor","DS/VCXWebProperties/VCXPropertyValueVector","DS/VCXWebProperties/VCXProperty"],function(e,t,i,r,a,o,s,n,l,p,u,h){"use strict";return t.extend({init:function(){this._parent(),this._bIsCamera=!0},Build:function(){this._parent();var t=[{Name:"Camera.Position",Type:o,DefaultValue:new e.Matrix4,Persistent:!1,visibleInPropertyGroups:!1},{Name:"Actor.IsActive",Type:s,DefaultValue:!1,Persistent:!1,BehaviorType:1},{Name:"Actor.Anchor.1",Type:a,DefaultValue:(new a).SetValueFrame((new o).SetValueFromVector(new e.Vector3(0,0,0))).GetValue()},{Name:"Actor.Anchor.2",Type:a,DefaultValue:(new a).SetValueFrame((new o).SetValueFromVector(new e.Vector3(0,0,0))).GetValue()},{Name:"Camera.Angle",Type:n,DefaultValue:45,GroupId:"Group.Camera"},{Name:"Camera.Height",Type:n,DefaultValue:400,GroupId:"Group.Camera"},{Name:"Camera.Ortho",Type:s,DefaultValue:!1,GroupId:"Group.Camera"},{Name:"Camera.Arcball",Type:s,DefaultValue:!0,GroupId:"Group.Camera"},{Name:"Camera.Pitch",Type:s,DefaultValue:!0,GroupId:"Group.Camera"},{Name:"Camera.Roll",Type:s,DefaultValue:!0,GroupId:"Group.Camera"},{Name:"Camera.Roll.Angle",Type:n,DefaultValue:0,GroupId:"Group.Camera",Bounds:{Min:-180,Max:180,Step:1}},{Name:"Camera.Yaw",Type:s,DefaultValue:!0,GroupId:"Group.Camera"},{Name:"Camera.LockDistCOI",Type:s,DefaultValue:!1,GroupId:"Group.Camera"},{Name:"Camera.DistCOI",Type:n,DefaultValue:500,GroupId:"Group.Camera"},{Name:"Collab.Gizmo.Show",Type:s,DefaultValue:!0,ControlsGroupVisibility:!0,GroupId:"Group.Collab.Gizmo"},{Name:"Collab.Gizmo.Line.Color",Type:p,DefaultValue:(new r).FromRGBA(1,1,1,1),GroupId:"Group.Collab.Gizmo"},{Name:"Collab.Gizmo.Line.Color.Opacity",Type:n,DefaultValue:1,Bounds:{Min:0,Max:1,Step:.01},GroupId:"Group.Collab.Gizmo"},{Name:"Collab.Gizmo.Line.Width",Type:n,DefaultValue:1,GroupId:"Group.Collab.Gizmo"},{Name:"Collab.ListAnchorsIDs",Type:u,DefaultValue:[1,2],visibleInPropertyGroups:!1}];this._BuildPropertyValues(t)},GetVirtualProperties:function(){var e={"Camera.Position":!0};return e},GetRequiredPropertiesForTransition:function(){var e={"Camera.Position":!0,"Actor.Anchor.1":!0,"Actor.Anchor.2":!0,"Camera.Angle":!0,"Camera.Height":!0,"Camera.Ortho":!0,"Camera.Arcball":!0,"Camera.Pitch":!0,"Camera.Roll":!0,"Camera.Roll.Angle":!0,"Camera.Yaw":!0,"Camera.LockDistCOI":!0,"Camera.DistCOI":!0};return e},GetProperty:function(e){if("Actor.IsActive"===e){var t=null;if(void 0!==this._Properties[e]){var i=this._Properties[e].GetPropertyValue().Clone(),r=this.ExperienceBase.getManager("VCXContextManager").getActiveCamera();i.SetValue(r.GetID()===this.GetObject().GetID()),t=new h(this._Properties[e].GetPropertyInfo(),i)}return t}return this._parent(e)},OnChangeProperty:function(e,t,i){if(i||(i={}),i.fromChildClass);else if(this.OnChangePropertyBegin(e,t))return!0;this._parent(e,t,i);this.ExperienceBase.getManager("VCXVisuManager");"Actor.IsActive"===e&&!0===t.Value&&this.ExperienceBase.getManager("VCXContextManager").setActiveCamera(this.GetObject())},SetPropertiesInfo:function(){this._parent(),this.SetPropertyInvisible("Collab.ListAnchorsIDs",!0),this.SetPropertyInvisible("Camera.Position",!0),this.SetPropertyInvisible("Actor.Interpolation.Type",!1),this.SetPropertyInvisible("Camera.Angle",this.GetPropertyValue("Camera.Ortho")),this.SetPropertyInvisible("Camera.Height",!this.GetPropertyValue("Camera.Ortho")),this.SetPropertyInvisible("Camera.Pitch",this.GetPropertyValue("Camera.Arcball")),this.SetPropertyInvisible("Camera.Roll",this.GetPropertyValue("Camera.Arcball")),this.SetPropertyInvisible("Camera.Yaw",this.GetPropertyValue("Camera.Arcball")),this.SetPropertyInvisible("Camera.LockDistCOI",this.GetPropertyValue("Camera.Arcball")),this.SetPropertyInvisible("Camera.DistCOI",this.GetPropertyValue("Camera.Arcball")||!this.GetPropertyValue("Camera.LockDistCOI")),this.SetPropertyInvisible("Camera.Roll.Angle",this.GetPropertyValue("Camera.Arcball")||this.GetPropertyValue("Camera.Roll"))},OnChangePropertiesEnd:function(){this._parent(),this.GetObject().updatePosition()},GetInterpolator:function(e){var t=this.QueryInterface("VCXIViewpointController");if(t)return t.GetInterpolator(e)}})}),define("DS/VCXWebDressup/VCXPolylineModifiable",["DS/VCXWebComponents/VCXWebComponentOccurrence","DS/VCXWebDressup/VCXDressup_Spec","DS/VCXWebDressup/VCXDressupModifiable","DS/VCXWebProperties/VCXPropertySet","DS/VCXWebProperties/VCXColor","DS/VCXWebProperties/VCXPropertyValueBoolean","DS/VCXWebProperties/VCXPropertyValueInt","DS/VCXWebProperties/VCXPropertyValueFloat","DS/VCXWebProperties/VCXPropertyValueColor","DS/VCXWebProperties/VCXPropertyValueEnum","DS/VCXWebProperties/VCXPropertyValueString","DS/VCXWebProperties/VCXPropertyValueVector"],function(e,t,i,r,a,o,s,n,l,p,u,h){"use strict";return i.extend({init:function(){this._bIsPolyline=!0,this._parent()},Build:function(){this._parent();var t=this._generateMapChoiceFromEnumAndId(e.ELineType,"Collab.DashType"),i=[{Name:"Polyline.Is.Closed",Type:o,DefaultValue:!1},{Name:"Collab.Body.Line.UseHiddenStyle",Type:o,DefaultValue:!1,visibleInPropertyGroups:!1},{Name:"Collab.Body.Line.Color",Type:l,DefaultValue:(new a).FromRGBA(0,0,0,1),GroupId:"Group.FrontLine",FormatPainter:!0},{Name:"Collab.Body.Line.Color.Opacity",Type:n,DefaultValue:1,Bounds:{Min:0,Max:1,Step:.01},GroupId:"Group.FrontLine",FormatPainter:!0},{Name:"Collab.Body.Line.Width",Type:n,DefaultValue:2,GroupId:"Group.FrontLine",FormatPainter:!0},{Name:"Collab.Body.Line.Type",Type:p,DefaultValue:e.ELineType.Plain,GroupId:"Group.FrontLine",MapChoice:t,FormatPainter:!0},{Name:"Collab.Body.Line.StipplingMotif",Type:u,DefaultValue:"0",GroupId:"Group.FrontLine",FormatPainter:!0},{Name:"Collab.Body.Line.Back.Color",Type:l,DefaultValue:(new a).FromRGBA(.5,.5,.5,1),GroupId:"Group.BackLine",FormatPainter:!0},{Name:"Collab.Body.Line.Back.Color.Opacity",Type:n,DefaultValue:.5,Bounds:{Min:0,Max:1,Step:.01},GroupId:"Group.BackLine",FormatPainter:!0},{Name:"Collab.Body.Line.Back.Type",Type:p,DefaultValue:e.ELineType.SmallDash,GroupId:"Group.BackLine",MapChoice:t,FormatPainter:!0},{Name:"Collab.Body.Line.Back.Width",Type:n,DefaultValue:1.5,GroupId:"Group.BackLine",FormatPainter:!0},{Name:"Collab.Body.Line.Back.StipplingMotif",Type:u,DefaultValue:"0",GroupId:"Group.BackLine",FormatPainter:!0},{Name:"Collab.ListAnchorsIDs",Type:h,DefaultValue:[],visibleInPropertyGroups:!1}];this._BuildPropertyValues(i)},SetPropertiesInfo:function(){this._parent(),this.SetPropertyInvisible("Actor.Color",!0),this.GetProperty("Actor.Color").GetPropertyInfo()._bPersistent=!1,this.SetPropertyInvisible("Collab.Body.Line.UseHiddenStyle",!0),this.SetPropertyInvisible("Collab.Body.Line.StipplingMotif",this.GetPropertyValue("Collab.Body.Line.Type")!==e.ELineType.UserDefined),this.SetPropertyInvisible("Collab.Body.Line.Back.StipplingMotif",this.GetPropertyValue("Collab.Body.Line.Back.Type")!==e.ELineType.UserDefined),this.SetPropertyInvisible("Collab.ListAnchorsIDs",!0)},GetProperty:function(e){return"Actor.Color"===e?this.GetNewProperty(e,this.GetPropertyValue("Collab.Body.Line.Color")):this._parent(e)},RequestModification:function(e){if(e&&"Actor.Color"===e.GetPropertyInfo().GetPropertyName()){var t=e.GetPropertyValue().Value.getAssociatedColors(),i=new r;return i.AddOrModifyProperty(this.GetNewProperty("Collab.Body.Line.Color",t.body)),i.AddOrModifyProperty(this.GetNewProperty("Collab.Body.Line.Back.Color",t.border)),i}return this._parent(e)}})}),define("DS/VCXWebDressup/VCXCompassModifiable",["DS/Visualization/ThreeJS_DS","DS/VCXWebDressup/VCXDressupModifiable","DS/VCXWebProperties/VCXProperty","DS/VCXWebProperties/VCXPropertyValueString","DS/VCXWebProperties/VCXPropertyValueBoolean","DS/VCXWebProperties/VCXPropertyValueInt","DS/VCXWebProperties/VCXPropertyValueFloat","DS/VCXWebProperties/VCXPropertyValuePoint","DS/VCXWebProperties/VCXPropertyValuePoint2D","DS/VCXWebProperties/VCXPropertyValueDocId","DS/VCXWebProperties/VCXPropertyValueFrame","i18n!DS/VCXWebModifiables/assets/nls/VCXWebModifiables"],function(e,t,i,r,a,o,s,n,l,p,u,h){"use strict";return t.extend({init:function(){this._parent()},Build:function(){this._parent();var t=this.GetProperties();if(t)for(var i in t._map){var l=this.GetProperty(i);l&&l.GetPropertyInfo()&&l.GetPropertyInfo().SetVisible(!1)}var d=[{Name:"Actor.Name",Type:r,DefaultValue:"Compass",i18n:h},{Name:"Actor.Visibility.Opacity",Type:s,DefaultValue:1,i18n:h},{Name:"Compass.GeomPath",Type:p,DefaultValue:-1,GroupId:"Group.Compass.General",BehaviorType:1},{Name:"Compass.AbsoluteSize",Type:a,DefaultValue:!1,GroupId:"Group.Compass.Size",BehaviorType:1},{Name:"Compass.Size",Type:s,DefaultValue:.1,Bounds:{Min:0,Max:1,Step:.1},GroupId:"Group.Compass.Size",BehaviorType:1},{Name:"Compass.SizePixel",Type:o,DefaultValue:300,GroupId:"Group.Compass.Size",BehaviorType:1},{Name:"Compass.Translation",Type:n,DefaultValue:new e.Vector3(0,0,0),BehaviorType:1},{Name:"Compass.Alignment",Type:u,DefaultValue:new e.Matrix4,BehaviorType:1}];if(void 0!==this.GetObject()._experienceBase.odt){var c={Name:"Compass.ODT.CustomRobotState",Type:a,DefaultValue:!1,GroupId:"Group.Compass.General",BehaviorType:1},y={Name:"Compass.ODT.CustomRobotGeomNodesNumber",Type:o,DefaultValue:0,GroupId:"Group.Compass.General",BehaviorType:1};d.push(c),d.push(y)}this._BuildPropertyValues(d),this.GetProperty("Compass.Translation").GetPropertyInfo().SetVisible(!1),this.GetProperty("Compass.Alignment").GetPropertyInfo().SetVisible(!1)},GetProperty:function(e){if(void 0!==this.GetObject()._experienceBase.odt){var t=null,r=this._Properties[e],s=this.ExperienceBase.getManager("VCXContextManager").getMainViewer().getCustomReferenceAxisSystem();switch(e){case"Compass.ODT.CustomRobotState":var n=new a;n.SetValue(null!==s),t=new i(r.GetPropertyInfo(),n);break;case"Compass.ODT.CustomRobotGeomNodesNumber":var l=new o;if(l.SetValue(0),t=new i(r.GetPropertyInfo(),l),s){var p=s.node,u=p&&p.children?p.children[0]:null;l.SetValue(u&&u.children?u.children.length:0)}}if(t)return t}return this._parent(e)}})}),define("DS/VCXWebDressup/VCXSectionModifiable",["DS/VCXWebDressup/VCXDressupModifiable","DS/Visualization/ThreeJS_DS","DS/VCXWebKernelTools/VCXMathTools","DS/VCXWebProperties/VCXColor","DS/VCXWebProperties/VCXPropertyValueBoolean","DS/VCXWebProperties/VCXPropertyValueInt","DS/VCXWebProperties/VCXPropertyValueFloat","DS/VCXWebProperties/VCXPropertyValueFrame","DS/VCXWebProperties/VCXPropertyValueColor","DS/VCXWebProperties/VCXPropertyValueAnchor","DS/VCXWebProperties/VCXPropertyValueMap","DS/VCXWebProperties/VCXPropertyValueVector","DS/VCXWebProperties/VCXPropertyValueLocation","DS/VCXWebProperties/VCXPropertySet"],function(e,t,i,r,a,o,s,n,l,p,u,h,d,c){"use strict";return e.extend({init:function(){this._parent(),this._bIsSection=!0},Build:function(){this._parent();var e=[{Name:"Actor.Anchor.0",Type:p,Visibility:!1,DefaultValue:(new p).SetValueFrame((new n).SetValueFromVector(new t.Vector3(0,0,0))).GetValue(),visibleInPropertyGroups:!1},{Name:"Actor.Color",DefaultValue:(new r).FromRGBA(0,.337,.525,1),GroupId:"Group.Section.Plane"},{Name:"Actor.Opacity",DefaultValue:.075,GroupId:"Group.Section.Plane"},{Name:"Actor.IsAlwaysOnTop",DefaultValue:!1,GroupId:"Group.Section.Plane"},{Name:"Section.Plane.Enable",Type:a,DefaultValue:!0,ControlsGroupVisibility:!0,GroupId:"Group.Section.Plane"},{Name:"Section.Enable",Type:a,DefaultValue:!0,ControlsGroupVisibility:!0,GroupId:"Group.Section"},{Name:"Section.AutoFlip",Type:a,DefaultValue:!1,GroupId:"Group.Section"},{Name:"Section.SpaceBackAlpha",Type:s,DefaultValue:1,GroupId:"Group.Section",Bounds:{Min:0,Max:1,Step:1},visibleInPropertyGroups:!1},{Name:"Section.SpaceFrontAlpha",Type:s,DefaultValue:0,GroupId:"Group.Section",Bounds:{Min:0,Max:1,Step:1},visibleInPropertyGroups:!1},{Name:"Actor.ListActors",Type:u,GroupId:"Group.Section",visibleInPropertyGroups:!1},{Name:"Section.Capping",Type:a,DefaultValue:!0,ControlsGroupVisibility:!0,GroupId:"Group.Section.Capping"},{Name:"Section.Capping.Color",Type:l,DefaultValue:(new r).FromRGBA(.0706,.7451,.9804,1),GroupId:"Group.Section.Capping"},{Name:"Section.Capping.ActorColor",Type:a,DefaultValue:!0,GroupId:"Group.Section.Capping"},{Name:"Section.Hatching.Color",Type:l,DefaultValue:(new r).FromRGBA(0,0,0,1),GroupId:"Group.Section.Hatching"},{Name:"Section.Hatching.Frequency",Type:o,DefaultValue:80,GroupId:"Group.Section.Hatching",Bounds:{Min:0,Max:300,Step:1}},{Name:"Section.Hatching.Angle",Type:s,DefaultValue:0,GroupId:"Group.Section.Hatching",Bounds:{Min:-90,Max:90,Step:1}},{Name:"Collab.ListAnchorsIDs",Type:h,DefaultValue:[0],visibleInPropertyGroups:!1}];this._BuildPropertyValues(e),this.SetPropertyInvisible("Collab.ListAnchorsIDs",!0)},SetPropertiesInfo:function(){this._parent(),this.SetPropertyInvisible("Actor.Color",!1),this.ChangeGroupAvailability("Group.Section.Hatching",this.GetPropertyValue("Section.Capping")?e.EAvailability.NoControl:e.EAvailability.AppForceNotAvailable)}})}),define("DS/VCXWebDressup/VCXDressupModifiableView",["DS/VCXWebDressup/VCXDressupModifiable","DS/VCXWebExperienceBase/VCXModifiableViewOccurrenceExperience","DS/VCXWebProperties/VCXPropertyGroup","i18n!DS/VCXWebModifiables/assets/nls/VCXWebModifiables","i18n!DS/VCXWebDressup/assets/nls/VCXWebDressup"],function(e,t,i,r,a){"use strict";var o=t.extend({init:function(){this._parent()},SetPropertiesViewInfo:function(){},getPropertyGroupsi18n:function(){return a},GetPropertyGroupVisibility:function(e){var t=this.QueryInterface("VCXIModifiable")._PropertyGroups[e];if(t){if(!1===t.availability||!1===t.visibility)return!1}else console.warn("Does the property group "+e+" exists ?");return!0},getPropertyGroups:function(e){e||(e={});var t=this.QueryInterface("VCXIModifiable");t.SetPropertiesInfo(),this._parent(e);var a=this.getGroupPropertiesOrders();for(var o in e["Group.Essentials"]||(e["Group.Essentials"]=new i({groupID:"Group.Essentials"}),e["Group.Essentials"].i18nGroup=r),e["Group.Essentials"].setPropertiesOrder(a["Group.Essentials"]),e["Group.Essentials"].priority=0,e["Group.Essentials"].addProperties([{propertyName:"Actor.Color",i18n:r}]),t._PropertyGroups)if(t._PropertyGroups.hasOwnProperty(o))if(!1!==t._PropertyGroups[o].availability)if(e.hasOwnProperty(o)){var s=t._PropertyGroups[o].PropertyControlingGroupAvailability||e[o].PropertyControlingGroupAvailability,n=t._PropertyGroups[o].PropertyControlingGroupVisibility||e[o].PropertyControlingGroupVisibility;UWA.extend(e[o],t._PropertyGroups[o],!0),e[o].PropertyControlingGroupAvailability=s,e[o].PropertyControlingGroupVisibility=n}else e[o]=t._PropertyGroups[o];else delete e[o];var l=null;if(this._getGroupsPriorities?l=this._getGroupsPriorities():console.warn("Missing _getGroupsPriorities method for component "+this.GetObject().GetType()+" !!"),l)for(var o in e)e.hasOwnProperty(o)&&l&&"number"==typeof l[o]&&(e[o].priority=l[o]);return e},getGroupPropertiesOrders:function(){var e=this._parent()||{};return UWA.extend(e,{"Group.Essentials":["Actor.Name","Modifiable.Style","Actor.Color","Actor.Opacity"]}),e},SetPropertyInvisible:function(e,t){var i=this._getPropertyGroupFromPropertyName(e);i&&i.setVisible(e,!t)},SetPropertyLocked:function(e,t){var i=this._getPropertyGroupFromPropertyName(e);i&&i.setLocked(e,t)},IsPropertyLocked:function(e){var t=this._getPropertyGroupFromPropertyName(e);return t&&t.isLocked(e)},_getPropertyGroupFromPropertyName:function(e){var t=this.QueryInterface("VCXIModifiable"),r=t.GetProperty(e);if(r){var a=r.GetPropertyInfo().GetGroupId();return a||(a="Group.Essentials"),t._PropertyGroups[a]||(t._PropertyGroups[a]=new i({groupID:a})),t._PropertyGroups[a]}},ChangeGroupAvailability:function(t,r){if(Object.values(e.EAvailability).includes(r)){var a=this.QueryInterface("VCXIModifiable"),o=a._PropertyGroups[t];o||(a._PropertyGroups[t]=new i({groupID:t}),o=a._PropertyGroups[t]);var s=o.PropertyControlingGroupAvailability,n=a._Properties[s];n&&n.GetPropertyValue().SetValue(r),r===e.EAvailability.AppForceAvailable?o.availability=!0:r===e.EAvailability.AppForceNotAvailable?o.availability=!1:o.availability=void 0}},getCollapsedGroupsNames:function(){return["Group.Actions"]}});return o.prototype._getGroupsPriorities=function(){return{"Group.Essentials":0}},o}),define("DS/VCXWebDressup/VCXCompassModifiableView",["DS/VCXWebDressup/VCXDressupModifiableView"],function(e){"use strict";return e.extend({init:function(){this._parent()},getGroupPropertiesOrders:function(){var e=this._parent()||{};return UWA.extend(e,{"Group.Compass.General":["Compass.GeomPath","Compass.ODT.CustomRobotState","Compass.ODT.CustomRobotGeomNodesNumber"],"Group.Compass.Size":["Compass.AbsoluteSize","Compass.Size","Compass.SizePixel"]}),e}})}),define("DS/VCXWebDressup/VCXCircleModifiableView",["DS/VCXWebDressup/VCXDressupModifiableView"],function(e){"use strict";var t=e.extend({init:function(){this._parent()},getGroupPropertiesOrders:function(){var e=this._parent()||{};return UWA.extend(e,{"Group.Circle":["Circle.Radius","Collab.Background.Color","Collab.Background.Color.Opacity","Circle.Background.Type","Circle.Thickness","Collab.3D.Paper.Billboard.Type"],"Group.CircleBorder":["Collab.Body.Line.Color","Collab.Body.Line.Color.Opacity","Collab.Body.Line.Width","Collab.Body.Line.Type"]}),e}});return t.prototype._getGroupsPriorities=function(t){var i=e.prototype._getGroupsPriorities();return UWA.extend(i,{"Group.Essentials":0,"Group.Circle":10,"Group.CircleBorder":20,"Group.Actions":30}),i},t}),define("DS/VCXWebDressup/VCXPolylineModifiableView",["DS/VCXWebDressup/VCXDressupModifiableView"],function(e){"use strict";var t=e.extend({init:function(){this._parent()},getGroupPropertiesOrders:function(){var e=this._parent()||{};return UWA.extend(e,{"Group.Essentials":["Actor.Name","Modifiable.Style","Actor.Color","Actor.Opacity","Polyline.Is.Closed","Collab.Body.Line.UseHiddenStyle"],"Group.FrontLine":["Collab.Body.Line.Color","Collab.Body.Line.Width","Collab.Body.Line.Color.Opacity","Collab.Body.Line.Type","Collab.Body.Line.StipplingMotif"],"Group.BackLine":["Collab.Body.Line.Back.Color","Collab.Body.Line.Back.Width","Collab.Body.Line.Back.Color.Opacity","Collab.Body.Line.Back.Type","Collab.Body.Line.Back.StipplingMotif"]}),e}});return t.prototype._getGroupsPriorities=function(t){var i=e.prototype._getGroupsPriorities();return UWA.extend(i,{"Group.Essentials":0,"Group.FrontLine":10,"Group.BackLine":20,"Group.Actions":30}),i},t}),define("DS/VCXWebDressup/VCXAmbienceModifiableView",["DS/VCXWebDressup/VCXDressupModifiableView"],function(e){"use strict";var t=e.extend({init:function(){this._parent()},getGroupPropertiesOrders:function(){var e=this._parent()||{};return UWA.extend(e,{"Group.Ambience.Lighting":["Ambience.Lighting.Exposure","Ambience.Lighting.Rotation"],"Group.Ambience.Background":["Ambience.Background.Show","Ambience.Background.Finite","Ambience.Background.Radius.Auto","Ambience.Background.Radius","Ambience.Background.Position.Auto","Ambience.Background.Position"],"Group.Ambience.Ground":["Ambience.Ground.Scaleratio","Ambience.Ground.Offset","Ambience.Ground.Reflectivity","Ambience.Ground.Glossiness","Ambience.Ground.ShadowIntensity"]}),e}});return t.prototype._getGroupsPriorities=function(t){var i=e.prototype._getGroupsPriorities();return UWA.extend(i,{"Group.Essentials":0,"Group.Ambience.Lighting":10,"Group.Ambience.Background":20,"Group.Ambience.Ground":30}),i},t}),define("DS/VCXWebDressup/VCXViewportModifiableView",["DS/VCXWebDressup/VCXDressupModifiableView"],function(e){"use strict";return e.extend({init:function(){this._parent()},getGroupPropertiesOrders:function(){var e=this._parent()||{};return UWA.extend(e,{"Group.Camera":["Camera.Ortho","Camera.Height","Camera.Focal.Length","Camera.Angle","Camera.Dolly","Camera.Position.Frame","Camera.Target.Frame","Camera.Arcball","Camera.Pitch","Camera.Roll","Camera.Roll.Angle","Camera.Yaw","Camera.LockDistCOI","Camera.DistCOI"],"Group.Paper":["Paper.Width","Paper.Height","Paper.Orientation"],"Group.Environment":["Viewport.ActiveAmbience","Viewport.ActiveAmbience.IDX","Viewport.ActiveCamera","Environment.Vertical"],"Group.Environment.Background":["Environment.Background.Color","Environment.Background.Color.Opacity","Environment.Background.Image","Environment.Background.Gradient","Environment.Background.Foot.Color"],"Group.Environment.Effects":["Environment.Shadow","Environment.AA","Environment.SSAO","Environment.Vignetting","Environment.DOF","Environment.Bloom","Environment.Flare","Environment.BackFaceCulling"],"Group.Render":["Render.Mode","Render.OutlineType","Render.ShowConstructions"],"Group.Render.Lighting":["Render.Lighting.Intensity","Render.Lighting.Mode"],"Group.Environment.Debug":["Environment.Debug.Availability","Environment.Debug.Show","Environment.Debug.ShadowLight","Environment.Debug.BSphere","Environment.Debug.PrimitiveBSphere","Environment.Debug.RepBBox","Environment.Debug.Picking","Environment.Debug.Normals","Environment.Debug.PickHybrid","Environment.Debug.PostProcessing","Environment.Debug.ShadowMaps","Environment.Debug.FPS","Render.PixelCulling"]}),e}})}),define("DS/VCXWebDressup/VCXRedLineModifiableView",["DS/VCXWebDressup/VCXDressupModifiableView"],function(e){"use strict";var t=e.extend({init:function(){this._parent()},getGroupPropertiesOrders:function(){var e=this._parent()||{};return UWA.extend(e,{"Group.Line":["Collab.Body.Line.Width","Actor.Color"]}),e}});return t.prototype._getGroupsPriorities=function(t){var i=e.prototype._getGroupsPriorities();return UWA.extend(i,{"Group.Essentials":0,"Group.Line":10}),i},t}),define("DS/VCXWebDressup/VCXSectionModifiableView",["DS/VCXWebDressup/VCXDressupModifiableView"],function(e){"use strict";var t=e.extend({init:function(){this._parent(),this._bIsSection=!0},getGroupPropertiesOrders:function(){var e=this._parent()||{};return UWA.extend(e,{"Group.Section":["Section.AutoFlip","Section.SpaceBackAlpha","Section.SpaceFrontAlpha"],"Group.Section.Capping":["Section.Capping.Color","Section.Capping.ActorColor"],"Group.Section.Hatching":["Section.Hatching.Color","Section.Hatching.Frequency","Section.Hatching.Angle"],"Group.Section.Plane":["Section.Plane.Enable","Actor.Color","Actor.Opacity","Actor.IsAlwaysOnTop"]}),e}});return t.prototype._getGroupsPriorities=function(t){var i=e.prototype._getGroupsPriorities();return UWA.extend(i,{"Group.Essentials":0,"Group.Section.Plane":10,"Group.Section":20,"Group.Section.Capping":30,"Group.Section.Hatching":40,"Group.Actions":100}),i},t}),define("DS/VCXWebDressup/VCXCameraModifiableView",["DS/VCXWebDressup/VCXDressupModifiableView"],function(e){"use strict";return e.extend({init:function(){this._parent()},getGroupPropertiesOrders:function(){var e=this._parent()||{};return UWA.extend(e,{"Group.Camera":["Camera.Angle","Camera.Height","Camera.Ortho","Camera.Arcball","Camera.Pitch","Camera.Roll","Camera.Roll.Angle","Camera.Yaw","Camera.LockDistCOI","Camera.DistCOI"],"Group.Collab.Gizmo":["Collab.Gizmo.Line.Color","Collab.Gizmo.Line.Color.Opacity","Collab.Gizmo.Line.Width"]}),e}})}),define("DS/VCXWebDressup/VCXMarkupModifiable",["DS/VCXWebComponents/VCXWebComponentOccurrence","DS/VCXWebDressup/VCXDressup_Spec","DS/VCXWebDressup/VCXMarkup_Spec","DS/VCXWebDressup/VCXPanel_Spec","DS/VCXWebDressup/VCXDressupModifiable","DS/Visualization/ThreeJS_DS","DS/VCXWebKernelTools/VCXMathTools","DS/VCXWebProperties/VCXColor","DS/VCXWebProperties/VCXProperty","DS/VCXWebProperties/VCXPropertyInfo","DS/VCXWebProperties/VCXPropertySet","DS/VCXWebProperties/VCXPropertyValueBoolean","DS/VCXWebProperties/VCXPropertyValueInt","DS/VCXWebProperties/VCXPropertyValueFloat","DS/VCXWebProperties/VCXPropertyValueEnum","DS/VCXWebProperties/VCXPropertyValueFont","DS/VCXWebProperties/VCXPropertyValueColor","DS/VCXWebProperties/VCXPropertyValueString","DS/VCXWebProperties/VCXPropertyValuePoint","DS/VCXWebProperties/VCXPropertyValueVector","DS/VCXWebProperties/VCXPropertyValueDocId","DS/VCXWebKernelTools/VCXTextTools","DS/VCXWebExperienceBase/VCXPathElementTools"],function(e,t,i,r,a,o,s,n,l,p,u,h,d,c,y,m,C,f,V,b,P,_,g){"use strict";var S=a.extend({init:function(){this._bIsMarkup=!0,this._parent()},Build:function(){this._parent();var t=[{Name:"Collab.Text.Availability",Type:y,DefaultValue:0,ControlsGroupAvailability:!0,GroupId:"Group.Text"},{Name:"Collab.Text.Show",Type:h,DefaultValue:!0,ControlsGroupVisibility:!0,GroupId:"Group.Text"},{Name:"Collab.Text",Type:f,DefaultValue:""},{Name:"Collab.Text.html",Type:f,DefaultValue:"",GroupId:"Group.Text",Persistent:!1},{Name:"Collab.Text.LinkedProperty",Type:f,DefaultValue:"Actor.ToolTip",GroupId:"Group.Text",Persistent:!1,visibleInPropertyGroups:!1},{Name:"Collab.Text.Color",Type:C,DefaultValue:(new n).FromRGBA(0,0,0,1),GroupId:"Group.Text",FormatPainter:!0},{Name:"Collab.Text.Color.Opacity",Type:c,DefaultValue:1,Bounds:{Min:0,Max:1,Step:.01},GroupId:"Group.Text",FormatPainter:!0},{Name:"Collab.Text.Font",Type:m,GroupId:"Group.Text",FormatPainter:!0},{Name:"Collab.Text.SizeToFit",Type:h,DefaultValue:!1,GroupId:"Group.Text"},{Name:"Collab.Text.Wordwrap",Type:h,DefaultValue:!1,GroupId:"Group.Paragraph",visibleInPropertyGroups:!1},{Name:"Collab.Text.LineSpacing",Type:c,DefaultValue:1.2,GroupId:"Group.Paragraph",visibleInPropertyGroups:!1,FormatPainter:!0},{Name:"Collab.Text.ParagraphSpacing",Type:c,DefaultValue:1.4,GroupId:"Group.Paragraph",FormatPainter:!0},{Name:"Collab.Text.HAlignment",Type:y,DefaultValue:i.EHTextAlignment.Centered,GroupId:"Group.Paragraph",MapChoice:this._generateMapChoiceFromEnumAndId(i.EHTextAlignment,"Collab.Text.HAlignment"),FormatPainter:!0},{Name:"Collab.Text.VAlignment",Type:y,DefaultValue:i.EVTextAlignment.Middle,GroupId:"Group.Paragraph",MapChoice:this._generateMapChoiceFromEnumAndId(i.EVTextAlignment,"Collab.Text.VAlignment"),FormatPainter:!0},{Name:"Collab.Body.Shape",Type:y,DefaultValue:i.EBodyShape.RoundedRectangle,GroupId:"Group.Body",MapChoice:this._generateMapChoiceFromEnumAndId(i.EBodyShape,"Collab.Body.Shape",["User","CircumscribedCircle"]),FormatPainter:!0},{Name:"Collab.Body.FitToText",Type:h,DefaultValue:!0,GroupId:"Group.Body",visibleInPropertyGroups:!1},{Name:"Collab.Body.KeepAspectRatio",Type:h,DefaultValue:!1,GroupId:"Group.Body"},{Name:"Collab.Body.Width",Type:c,DefaultValue:50,GroupId:"Group.Body"},{Name:"Collab.Body.Height",Type:c,DefaultValue:50,GroupId:"Group.Body"},{Name:"Collab.Body.InnerMargin",Type:c,DefaultValue:2,GroupId:"Group.Background",FormatPainter:!0},{Name:"Collab.Body.HAlignment",Type:y,DefaultValue:i.EHAlignment.Left,GroupId:"Group.Body",MapChoice:this._generateMapChoiceFromEnumAndId(i.EHAlignment,"Collab.Body.HAlignment"),visibleInPropertyGroups:!1},{Name:"Collab.Body.VAlignment",Type:y,DefaultValue:i.EVAlignment.Top,GroupId:"Group.Body",MapChoice:this._generateMapChoiceFromEnumAndId(i.EVAlignment,"Collab.Body.VAlignment"),visibleInPropertyGroups:!1},{Name:"Collab.Body.ContributeToEqualSize",Type:h,DefaultValue:!1,GroupId:"Group.Body",visibleInPropertyGroups:!1},{Name:"Collab.Background.Availability",Type:y,DefaultValue:0,ControlsGroupAvailability:!0,GroupId:"Group.Background",FormatPainter:!0},{Name:"Collab.Background.Show",Type:h,DefaultValue:!0,ControlsGroupVisibility:!0,GroupId:"Group.Background",FormatPainter:!0},{Name:"Collab.Background.Color",Type:C,DefaultValue:(new n).FromRGBA(1,1,1,1),GroupId:"Group.Background",FormatPainter:!0},{Name:"Collab.Background.Color.Opacity",Type:c,DefaultValue:1,Bounds:{Min:0,Max:1,Step:.01},GroupId:"Group.Background",FormatPainter:!0},{Name:"Collab.Image.Availability",Type:y,DefaultValue:0,ControlsGroupAvailability:!0,GroupId:"Group.Image",FormatPainter:!0},{Name:"Collab.Image.Show",Type:h,DefaultValue:!1,ControlsGroupVisibility:!0,GroupId:"Group.Image"},{Name:"Collab.Image.DPI",Type:c,DefaultValue:-1,GroupId:"Group.Image",Persistent:!1},{Name:"Collab.Image.Doc.ID",Type:P,DefaultValue:-1,GroupId:"Group.Image"},{Name:"Collab.Image.Color",Type:C,DefaultValue:(new n).FromRGBA(1,1,1,1),GroupId:"Group.Image",FormatPainter:!0},{Name:"Collab.Image.Color.Opacity",Type:c,DefaultValue:1,Bounds:{Min:0,Max:1,Step:.01},GroupId:"Group.Image",FormatPainter:!0},{Name:"Collab.Image.Scale",Type:c,DefaultValue:1,Bounds:{Min:0,Max:1,Step:.01},GroupId:"Group.Image",FormatPainter:!0},{Name:"Collab.Border.Availability",Type:y,DefaultValue:0,ControlsGroupAvailability:!0,GroupId:"Group.Border",FormatPainter:!0},{Name:"Collab.Border.Show",Type:h,DefaultValue:!0,ControlsGroupVisibility:!0,GroupId:"Group.Border",FormatPainter:!0},{Name:"Collab.Border.Line.Width",Type:c,DefaultValue:2,GroupId:"Group.Border",FormatPainter:!0},{Name:"Collab.Border.Line.Color",Type:C,DefaultValue:(new n).FromRGBA(0,0,0,1),GroupId:"Group.Border",FormatPainter:!0},{Name:"Collab.Border.Line.Color.Opacity",Type:c,DefaultValue:1,Bounds:{Min:0,Max:1,Step:.01},GroupId:"Group.Border",FormatPainter:!0},{Name:"Collab.Body.Shadow.Availability",Type:y,DefaultValue:0,ControlsGroupAvailability:!0,GroupId:"Group.Shadow",FormatPainter:!0},{Name:"Collab.Body.Shadow.Show",Type:h,DefaultValue:!1,ControlsGroupVisibility:!0,GroupId:"Group.Shadow",FormatPainter:!0},{Name:"Collab.Body.Shadow.Opacity",Type:c,DefaultValue:.55,GroupId:"Group.Shadow",FormatPainter:!0,Bounds:{Min:0,Max:1,Step:.1}},{Name:"Collab.Body.Shadow.Distance",Type:c,DefaultValue:3,GroupId:"Group.Shadow",FormatPainter:!0,Bounds:{Min:0,Max:20,Step:.1}},{Name:"Collab.Body.Shadow.Orientation",Type:c,DefaultValue:45,GroupId:"Group.Shadow",FormatPainter:!0,Bounds:{Min:0,Max:360,Step:.1}},{Name:"Collab.Body.Shadow.Blur",Type:c,DefaultValue:12,GroupId:"Group.Shadow",FormatPainter:!0,Bounds:{Min:0,Max:20,Step:.1}},{Name:"Collab.3D.Paper.Positioning.Type",Type:y,DefaultValue:i.EPositionType.Free3D,GroupId:"Group.Position",MapChoice:this._generateMapChoiceFromEnumAndId(i.EPositionType,"Positioning.Type",["EndOfAutomaticPositionning"])},{Name:"Collab.3D.Paper.3D.Text.Position",Type:V,DefaultValue:new o.Vector3,GroupId:"Group.Position"},{Name:"Collab.3D.Paper.Size.Control.Type",Type:y,DefaultValue:i.ESizeControlType.Paper,GroupId:"Group.Position",MapChoice:this._generateMapChoiceFromEnumAndId(i.ESizeControlType,"Size.Control.Type"),visibleInPropertyGroups:!1},{Name:"Collab.3D.Paper.Scaling.Factor",Type:c,DefaultValue:1,GroupId:"Group.Body",visibleInPropertyGroups:!1},{Name:"Collab.3D.Paper.Paper.Position.X",Type:c,DefaultValue:0,GroupId:"Group.Position"},{Name:"Collab.3D.Paper.Paper.Position.Y",Type:c,DefaultValue:0,GroupId:"Group.Position"},{Name:"Collab.3D.Paper.Is.Background",Type:h,DefaultValue:!1,GroupId:"Group.Body",FormatPainter:!0},{Name:"Collab.3D.Paper.Depth",Type:c,DefaultValue:0,GroupId:"Group.Position"},{Name:"Collab.3D.Paper.Billboard.Type",Type:y,DefaultValue:i.EBillboardType.Spherical,GroupId:"Group.Position",MapChoice:this._generateMapChoiceFromEnumAndId(i.EBillboardType,"Billboard.Type",["AlongX_yInCamUp"])},{Name:"Collab.3D.Paper.3D.Text.Radius",Type:c,DefaultValue:0,GroupId:"Group.Position",visibleInPropertyGroups:!1},{Name:"Collab.3D.Paper.UsesBarycenter",Type:h,DefaultValue:!1,GroupId:"Group.Position",visibleInPropertyGroups:!1},{Name:"Collab.3D.Paper.Referential.In.World",Type:h,DefaultValue:!0,GroupId:"Group.Position",visibleInPropertyGroups:!1},{Name:"Collab.Attach.Availability",Type:y,DefaultValue:0,ControlsGroupAvailability:!0,GroupId:"Group.Attach",FormatPainter:!0},{Name:"Collab.Attach.Show",Type:h,DefaultValue:!0,ControlsGroupVisibility:!0,GroupId:"Group.Attach",FormatPainter:!0},{Name:"Collab.Attach.3DAttach",Type:h,DefaultValue:!0,GroupId:"Group.Attach",visibleInPropertyGroups:!1,FormatPainter:!0},{Name:"Collab.Attach.Preset",Type:y,DefaultValue:i.EAttachType.Line,GroupId:"Group.Attach",MapChoice:this._generateMapChoiceFromEnumAndId(i.EAttachType,"Collab.Attach.Type"),Persistent:!1,visibleInPropertyGroups:!1,FormatPainter:!0},{Name:"Collab.Attach.LeadType",Type:y,DefaultValue:i.ELeadType.Bent,GroupId:"Group.Attach",MapChoice:this._generateMapChoiceFromEnumAndId(i.ELeadType,"Collab.Attach.LeadType"),FormatPainter:!0},{Name:"Collab.Attach.ExtremityType",Type:y,DefaultValue:i.EExtremityType.Yellow,GroupId:"Group.Attach",FormatPainter:!0,MapChoice:this._generateMapChoiceFromEnumAndId(i.EExtremityType,"Collab.Attach.ExtremityType",["FullArrow_1","FullArrow_2","HalfArrow_B1","HalfArrow_T1","HalfArrow_T2","HalfArrow_B2"])},{Name:"Collab.Attach.BentDot",Type:h,DefaultValue:!1,GroupId:"Group.Attach",FormatPainter:!0},{Name:"Collab.Attach.Background.Gradient",Type:h,DefaultValue:!1,GroupId:"Group.Attach",visibleInPropertyGroups:!1,FormatPainter:!0},{Name:"Collab.Attach.Border.Gradient",Type:h,DefaultValue:!1,GroupId:"Group.Attach",visibleInPropertyGroups:!1,FormatPainter:!0},{Name:"Collab.Attach.Curvature",Type:c,DefaultValue:40,Bounds:{Min:-100,Max:100,Step:.01},GroupId:"Group.Attach",visibleInPropertyGroups:!1,FormatPainter:!0},{Name:"Collab.Attach.Origin",Type:V,DefaultValue:new o.Vector3,GroupId:"Group.Attach",visibleInPropertyGroups:!1},{Name:"Collab.Attach.CenteredOrigin",Type:h,DefaultValue:!0,GroupId:"Group.Attach",visibleInPropertyGroups:!1},{Name:"Collab.Attach.Line.Color",Type:C,DefaultValue:(new n).FromRGBA(0,0,0,1),GroupId:"Group.Attach",FormatPainter:!0},{Name:"Collab.Attach.Line.Color.Opacity",Type:c,DefaultValue:1,Bounds:{Min:0,Max:1,Step:.01},GroupId:"Group.Attach",FormatPainter:!0},{Name:"Collab.Attach.Line.Width",Type:c,DefaultValue:2,GroupId:"Group.Attach",FormatPainter:!0},{Name:"Collab.Attach.Line.Type",Type:y,DefaultValue:e.ELineType.Plain,GroupId:"Group.Attach",MapChoice:this._generateMapChoiceFromEnumAndId(e.ELineType,"Collab.DashType",["UserDefined","Advanced"]),FormatPainter:!0},{Name:"Collab.ListAnchorsIDs",Type:b,DefaultValue:[],visibleInPropertyGroups:!1},{Name:"Collab.List2DAnchorsIDs",Type:b,DefaultValue:[],visibleInPropertyGroups:!1},{Name:"Collab.Markup.SubType",Type:y,DefaultValue:r.ESubType.None,visibleInPropertyGroups:!1}];this._BuildPropertyValues(t),this._Properties["Collab.Text.Font"].GetPropertyValue().SetFamily(new f("Arial")),this._Properties["Collab.Text.Font"].GetPropertyValue().SetHeight(new c(11))},SetPropertiesInfo:function(){this._parent();var e=this.ExperienceBase.getManager("VCXContextManager").getCityMode();this.GetProperty("Actor.Color").GetPropertyInfo()._bPersistent=!1,this.SetPropertyInvisible("Collab.3D.Paper.UsesBarycenter",!0),this.SetPropertyInvisible("Collab.3D.Paper.Scaling.Factor",!0),this.SetPropertyInvisible("Collab.Text.html","1"!==this.ExperienceBase.getManager("VCXContextManager").getUrlVars().debug),this.SetPropertyInvisible("Collab.Text.SizeToFit",!this.GetPropertyValue("Collab.Text.Show")||this.GetPropertyValue("Collab.Body.FitToText")),this.SetPropertyInvisible("Collab.Body.KeepAspectRatio",!this.ExperienceBase.getManager("VCXContextManager").getPlayerMode()),this.SetPropertyInvisible("Collab.Body.Width",this.GetPropertyValue("Collab.Body.FitToText")&&this.GetPropertyValue("Collab.Text.Show")),this.SetPropertyInvisible("Collab.Body.Height",this.GetPropertyValue("Collab.Body.FitToText")&&this.GetPropertyValue("Collab.Text.Show")||this.GetPropertyValue("Collab.Body.KeepAspectRatio")&&this.GetPropertyValue("Collab.Image.Show")),this.SetPropertyInvisible("Collab.Background.Show",this.GetPropertyValue("Collab.Body.Shape")===i.EBodyShape.None),this.SetPropertyInvisible("Collab.Background.Color",!this.GetPropertyValue("Collab.Background.Show")||this.GetPropertyValue("Collab.Body.Shape")===i.EBodyShape.None),this.SetPropertyInvisible("Collab.Background.Color.Opacity",!this.GetPropertyValue("Collab.Background.Show")||this.GetPropertyValue("Collab.Body.Shape")===i.EBodyShape.None),this.SetPropertyInvisible("Actor.IsAlwaysOnTop",this.GetPropertyValue("Collab.3D.Paper.Positioning.Type")<=i.EPositionType.Free2D);var t=this.GetPropertyValue("Collab.3D.Paper.Positioning.Type")<=i.EPositionType.Free2D||this.GetPropertyValue("Collab.3D.Paper.Positioning.Type")===i.EPositionType.Free3D&&this.GetPropertyValue("Collab.3D.Paper.Billboard.Type")!==i.EBillboardType.Spherical;this.SetPropertyInvisible("Collab.3D.Paper.Size.Control.Type",t),this.SetPropertyInvisible("Collab.3D.Paper.3D.Text.Position",this.GetPropertyValue("Collab.3D.Paper.Positioning.Type")<=i.EPositionType.Free2D),this.SetPropertyInvisible("Collab.3D.Paper.Billboard.Type",this.GetPropertyValue("Collab.3D.Paper.Positioning.Type")<=i.EPositionType.Free2D),this.SetPropertyInvisible("Collab.3D.Paper.Referential.In.World",this.GetPropertyValue("Collab.3D.Paper.Positioning.Type")<=i.EPositionType.Free2D);var r=this.GetPropertyValue("Collab.3D.Paper.Positioning.Type")!==i.EPositionType.Free2D&&this.GetPropertyValue("Collab.3D.Paper.Positioning.Type")!==i.EPositionType.RelativeToReferential;this.SetPropertyInvisible("Collab.3D.Paper.Paper.Position.X",r),this.SetPropertyInvisible("Collab.3D.Paper.Paper.Position.Y",r),this.SetPropertyInvisible("Collab.3D.Paper.Depth",this.GetPropertyValue("Collab.3D.Paper.Positioning.Type")>i.EPositionType.Free2D),this.SetPropertyInvisible("Collab.3D.Paper.Is.Background",e||this.GetPropertyValue("Collab.3D.Paper.Positioning.Type")>i.EPositionType.Free2D),this.SetPropertyInvisible("Collab.Attach.CenteredOrigin",this.GetPropertyValue("Collab.Attach.LeadType")!==i.ELeadType.Mustache),this.SetPropertyInvisible("Collab.Attach.BentDot",this.GetPropertyValue("Collab.Attach.LeadType")!==i.ELeadType.Bent&&this.GetPropertyValue("Collab.Attach.LeadType")!==i.ELeadType.Line),this.SetPropertyInvisible("Collab.Attach.Origin",this.GetPropertyValue("Collab.Attach.CenteredOrigin")||this.GetPropertyValue("Collab.Attach.LeadType")===i.ELeadType.Mustache),this.SetPropertyInvisible("Collab.Attach.3DAttach",!0),this.SetPropertyInvisible("Collab.Attach.Line.Type",this.GetPropertyValue("Collab.Attach.LeadType")===i.ELeadType.Mustache),this.SetPropertyInvisible("Collab.Attach.Curvature",this.GetPropertyValue("Collab.Attach.LeadType")!==i.ELeadType.Mustache),this.SetPropertyInvisible("Collab.Attach.Background.Gradient",this.GetPropertyValue("Collab.Attach.LeadType")!==i.ELeadType.Mustache),this.SetPropertyInvisible("Collab.Attach.Border.Gradient",this.GetPropertyValue("Collab.Attach.LeadType")!==i.ELeadType.Mustache),this.SetPropertyInvisible("Collab.Body.ContributeToEqualSize",!0),this.SetPropertyInvisible("Collab.ListAnchorsIDs",!0),this.SetPropertyInvisible("Collab.List2DAnchorsIDs",!0),this.SetPropertyInvisible("Collab.Markup.SubType",!0),this.ChangeGroupAvailability("Group.Image",a.EAvailability.AppForceNotAvailable),this.ChangeGroupAvailability("Group.Paragraph",this.GetPropertyValue("Collab.Text.Show")?a.EAvailability.NoControl:a.EAvailability.AppForceNotAvailable),this.GetPropertyValue("Collab.Image.Doc.ID")>0?this.changeMapChoice("Collab.Body.Shape",this._generateMapChoiceFromEnumAndId(i.EBodyShape,"Collab.Body.Shape",["User","CircumscribedCircle"])):this.changeMapChoice("Collab.Body.Shape",this._generateMapChoiceFromEnumAndId(i.EBodyShape,"Collab.Body.Shape",["User","CircumscribedCircle","RemoveBorder"]))},GetDepthFromAttachedAnchors:function(){for(var e=0,t=this.GetAttachedOccurences(),i=0;i<t.length;i++){var r=t[i];if(r){var a=r.QueryInterface("VCXIModifiable");if(a){var o=a.GetProperty("Collab.3D.Paper.Depth");if(o){var s=o.GetPropertyValue().Value;s>e&&(e=s)}}}}return e},GetProperty:function(e){var t,r;if("Actor.Color"===e)return this.GetNewProperty(e,this.GetPropertyValue("Collab.Background.Color"));if("Collab.3D.Paper.Paper.Position.X"===e){if(this.GetPropertyValue("Collab.3D.Paper.Positioning.Type")<i.EPositionType.EndOfAutomaticPositionning&&(t=this.QueryInterface("W3AISGNodeHolder"))&&(r=t.getSGNode())&&r._Smart3DPaperNode)return this.GetNewProperty(e,r._Smart3DPaperNode.Position2D.x)}else if("Collab.3D.Paper.Paper.Position.Y"===e){if(this.GetPropertyValue("Collab.3D.Paper.Positioning.Type")<i.EPositionType.EndOfAutomaticPositionning&&(t=this.QueryInterface("W3AISGNodeHolder"))&&(r=t.getSGNode())&&r._Smart3DPaperNode)return this.GetNewProperty(e,r._Smart3DPaperNode.Position2D.y)}else{if("Collab.Image.DPI"===e){if(this.GetObject().backgroundImage){var a=25.4*this.GetObject().backgroundImage.width/this.GetPropertyValue("Collab.Body.Width"),o=25.4*this.GetObject().backgroundImage.height/this.GetPropertyValue("Collab.Body.Height");if(o>5&&a>5&&a/o>.999&&a/o<1.001)return this.GetNewProperty(e,a)}return this.GetNewProperty(e,-1)}if("Collab.Attach.Preset"===e){for(var s in i.EAttachType)if(i.EAttachType.hasOwnProperty(s)){var n=S.GetAttachPresets(i.EAttachType[s]),l=!0;for(var p in n)if(n.hasOwnProperty(p)&&this.GetProperty(p)&&this.GetProperty(p).GetPropertyInfo().IsVisible()&&n[p]!==this.GetPropertyValue(p)){l=!1;break}if(l)return this.GetNewProperty(e,i.EAttachType[s])}}else if("Collab.3D.Paper.Depth"===e&&this.GetPropertyValue("Collab.UseDepthFromAnchor")){var u=this.GetDepthFromAttachedAnchors();return 0<u&&(u+=1),this.GetNewProperty(e,u)}}return this._parent(e)},RequestModification:function(e){if(e){if("Collab.Attach.Preset"===e.GetPropertyInfo().GetPropertyName()){var t=new u,r=S.GetAttachPresets(e.GetPropertyValue().Value);for(var a in r)r.hasOwnProperty(a)&&t.AddOrModifyProperty(this.GetNewProperty(a,r[a]));return t}if("Collab.Image.DPI"===e.GetPropertyInfo().GetPropertyName()){t=new u;return e.GetPropertyValue().Value>5?this.GetObject().backgroundImage&&(t.AddOrModifyProperty(this.GetNewProperty("Collab.Body.Width",25.4*this.GetObject().backgroundImage.width/e.GetPropertyValue().Value)),t.AddOrModifyProperty(this.GetNewProperty("Collab.Body.Height",25.4*this.GetObject().backgroundImage.height/e.GetPropertyValue().Value))):t.AddOrModifyProperty(this.GetNewProperty("Collab.Image.DPI",-1)),t}if("Collab.Text"===e.GetPropertyInfo().GetPropertyName())return(t=this._parent(e)).AddOrModifyProperty(this.GetNewProperty("Collab.Text.html",_.htmlEncode(e.GetPropertyValue().Value))),t;if("Collab.Text.html"===e.GetPropertyInfo().GetPropertyName())return(t=this._parent(e)).AddOrModifyProperty(this.GetNewProperty("Collab.Text",_.htmlDecode(e.GetPropertyValue().Value))),t;if("Collab.Image.Doc.ID"===e.GetPropertyInfo().GetPropertyName()){var o=this;t=this._parent(e);return this.ExperienceBase.getManager("VCXImageManager").GetImageFromDocID(e.GetPropertyValue().Value).then(function(e){var i=25.4*e.width/o.GetPropertyValue("Collab.Body.Width"),r=25.4*e.height/i;return t.AddOrModifyProperty(o.GetNewProperty("Collab.Body.Height",r)),t})}if("Actor.Color"===e.GetPropertyInfo().GetPropertyName()){t=new u;var n=e.GetPropertyValue().Value.getAssociatedColors();return t.AddOrModifyProperty(this.GetNewProperty("Collab.Background.Color",n.body)),t.AddOrModifyProperty(this.GetNewProperty("Collab.Text.Color",n.text)),t.AddOrModifyProperty(this.GetNewProperty("Collab.Image.Color",n.image)),t.AddOrModifyProperty(this.GetNewProperty("Collab.Border.Line.Color",n.border)),t.AddOrModifyProperty(this.GetNewProperty("Collab.Attach.Line.Color",n.attach)),t}if("Collab.3D.Paper.Positioning.Type"===e.GetPropertyInfo().GetPropertyName()){t=this._parent(e);this.ExperienceBase.getManager("VCXDressupManager").alignmentDirty=2;var l=this.ExperienceBase.getManager("VCXContextManager").getMainViewer(),p=this.ExperienceBase.getManager("VCXPaperManager"),h=this.QueryInterface("W3AISGNodeHolder"),d={viewer:l,viewpoint:l.currentViewpoint};if(l&&p&&h){var c=h.getSGNode()&&h.getSGNode(),y=c&&c.GetShapeInfo(),m=y&&y.smartNode&&g.buildPathElement(h.getPathElement(),y.smartNode),C=m&&s.getOFromMatrix(m.getWorldMatrix(l));C||(C=s.getOFromMatrix(h.getWorldMatrix(l)));var f=p.ModelToMM2(d,C);if(e.GetPropertyValue().Value<=i.EPositionType.Free2D){if(e.GetPropertyValue().Value===i.EPositionType.RelativeToReferential){var V=s.getOFromMatrix(y.smartNode.GetReferential(d)),b=p.ModelToMM2(d,V);f.x-=b.x,f.y-=b.y,t.AddOrModifyProperty(this.GetNewProperty("Collab.3D.Paper.3D.Text.Radius",0))}t.AddOrModifyProperty(this.GetNewProperty("Collab.3D.Paper.Paper.Position.X",f.x)),t.AddOrModifyProperty(this.GetNewProperty("Collab.3D.Paper.Paper.Position.Y",f.y)),t.AddOrModifyProperty(this.GetNewProperty("Collab.3D.Paper.Billboard.Type",i.EBillboardType.Spherical)),t.AddOrModifyProperty(this.GetNewProperty("Collab.3D.Paper.Size.Control.Type",i.ESizeControlType.Paper))}else{V=s.getOFromMatrix(y.smartNode.GetReferential(d)),b=p.ModelToMM2(d,V);f.z=b.z;var P=p.MMToModel2(d,f);t.AddOrModifyProperty(this.GetNewProperty("Collab.3D.Paper.3D.Text.Position",h.getPositionInLCS(l,P)))}}return t}}return this._parent(e)}});return S.GetAttachPresets=function(e){var t={};switch(e){case i.EAttachType.None:t["Collab.Attach.LeadType"]=i.ELeadType.None,t["Collab.Attach.ExtremityType"]=i.EExtremityType.None,t["Collab.Attach.Curvature"]=0,t["Collab.Attach.Background.Gradient"]=!1,t["Collab.Attach.Border.Gradient"]=!1,t["Collab.Attach.BentDot"]=!1;break;case i.EAttachType.Model:t["Collab.Attach.LeadType"]=i.ELeadType.Bent,t["Collab.Attach.ExtremityType"]=i.EExtremityType.Yellow,t["Collab.Attach.Curvature"]=0,t["Collab.Attach.Background.Gradient"]=!1,t["Collab.Attach.Border.Gradient"]=!1,t["Collab.Attach.BentDot"]=!1;break;case i.EAttachType.Vertex:t["Collab.Attach.LeadType"]=i.ELeadType.Bent,t["Collab.Attach.ExtremityType"]=i.EExtremityType.Red,t["Collab.Attach.Curvature"]=0,t["Collab.Attach.Background.Gradient"]=!1,t["Collab.Attach.Border.Gradient"]=!1,t["Collab.Attach.BentDot"]=!1;break;case i.EAttachType.GradientTooltip:t["Collab.Attach.LeadType"]=i.ELeadType.Mustache,t["Collab.Attach.ExtremityType"]=i.EExtremityType.Red,t["Collab.Attach.Curvature"]=0,t["Collab.Attach.Background.Gradient"]=!0,t["Collab.Attach.Border.Gradient"]=!0,t["Collab.Attach.BentDot"]=!1;break;case i.EAttachType.TooltipStyle:t["Collab.Attach.LeadType"]=i.ELeadType.Mustache,t["Collab.Attach.ExtremityType"]=i.EExtremityType.Red,t["Collab.Attach.Curvature"]=0,t["Collab.Attach.Background.Gradient"]=!1,t["Collab.Attach.Border.Gradient"]=!0,t["Collab.Attach.BentDot"]=!1;break;case i.EAttachType.Line:case i.EAttachType.User:t["Collab.Attach.LeadType"]=i.ELeadType.Bent,t["Collab.Attach.ExtremityType"]=i.EExtremityType.SmallRed,t["Collab.Attach.Curvature"]=0,t["Collab.Attach.Background.Gradient"]=!1,t["Collab.Attach.Border.Gradient"]=!1,t["Collab.Attach.BentDot"]=!1;break;case i.EAttachType.Simple:t["Collab.Attach.LeadType"]=i.ELeadType.Middle,t["Collab.Attach.ExtremityType"]=i.EExtremityType.SmallRed,t["Collab.Attach.Curvature"]=0,t["Collab.Attach.Background.Gradient"]=!1,t["Collab.Attach.Border.Gradient"]=!1,t["Collab.Attach.BentDot"]=!1;break;case i.EAttachType.ArcTooltip:t["Collab.Attach.LeadType"]=i.ELeadType.Mustache,t["Collab.Attach.ExtremityType"]=i.EExtremityType.Red,t["Collab.Attach.Curvature"]=40,t["Collab.Attach.Background.Gradient"]=!1,t["Collab.Attach.Border.Gradient"]=!1,t["Collab.Attach.BentDot"]=!1;break;case i.EAttachType.Arrow:t["Collab.Attach.LeadType"]=i.ELeadType.Bent,t["Collab.Attach.ExtremityType"]=i.EExtremityType.FullArrow_1,t["Collab.Attach.Curvature"]=0,t["Collab.Attach.Background.Gradient"]=!1,t["Collab.Attach.Border.Gradient"]=!1,t["Collab.Attach.BentDot"]=!1;break;case i.EAttachType.Basic:t["Collab.Attach.LeadType"]=i.ELeadType.Line,t["Collab.Attach.ExtremityType"]=i.EExtremityType.SmallRed,t["Collab.Attach.Curvature"]=0,t["Collab.Attach.Background.Gradient"]=!1,t["Collab.Attach.Border.Gradient"]=!1,t["Collab.Attach.BentDot"]=!1;break;case i.EAttachType.Modern:t["Collab.Attach.LeadType"]=i.ELeadType.Line,t["Collab.Attach.ExtremityType"]=i.EExtremityType.Line,t["Collab.Attach.Curvature"]=0,t["Collab.Attach.Background.Gradient"]=!1,t["Collab.Attach.Border.Gradient"]=!1,t["Collab.Attach.BentDot"]=!0}return t},S}),define("DS/VCXWebDressup/VCXCalloutModifiable",["DS/VCXWebDressup/VCXMarkupModifiable","DS/VCXWebDressup/VCXDressupModifiable","DS/VCXWebDressup/VCXMarkup_Spec","DS/VCXWebProperties/VCXColor","DS/VCXWebProperties/VCXPropertyValueString","DS/VCXWebProperties/VCXPropertySet"],function(e,t,i,r,a,o){"use strict";return e.extend({init:function(){this._bIsCallout=!0,this._parent()},Build:function(){this._parent();var e=[{Name:"Collab.Text.Availability",DefaultValue:t.EAvailability.AppForceAvailable},{Name:"Collab.Text",DefaultValue:"$(##Actor.BomId)"},{Name:"Collab.Text.ComputedText",Type:a,DefaultValue:"",visibleInPropertyGroups:!1},{Name:"Collab.Text.Color",DefaultValue:(new r).FromRGBA(0,0,0,1),FormatPainter:!0},{Name:"Collab.Body.InnerMargin",DefaultValue:1.5,FormatPainter:!0},{Name:"Collab.Background.Color",DefaultValue:(new r).FromRGBA(1,1,1,1),FormatPainter:!0},{Name:"Collab.Body.Shape",DefaultValue:i.EBodyShape.Circle,FormatPainter:!0},{Name:"Collab.Body.HAlignment",DefaultValue:i.EHAlignment.Center},{Name:"Collab.Body.VAlignment",DefaultValue:i.EVAlignment.Bottom},{Name:"Collab.HideIfOutsideAnchorFrustrum",DefaultValue:!0},{Name:"Collab.Image.Availability",DefaultValue:t.EAvailability.AppForceNotAvailable},{Name:"Collab.Body.ContributeToEqualSize",DefaultValue:!0},{Name:"Collab.Body.Width",DefaultValue:5},{Name:"Collab.Body.Height",DefaultValue:5}];this._BuildPropertyValues(e),this.SetPropertyInvisible("Collab.HideIfOutsideAnchorFrustrum",!1)},SetPropertiesInfo:function(){this._parent(),this.SetPropertyInvisible("Collab.3D.Paper.Is.Background",!0),this.ChangeGroupAvailability("Group.Paragraph",t.EAvailability.AppForceNotAvailable)},GetProperty:function(e){return"Collab.Text.ComputedText"===e?this.GetNewProperty(e,this.GetPropertyValue("Collab.Text._ComputedText")):this._parent(e)},RequestModification:function(e){if(e&&"Collab.Text.ComputedText"===e.GetPropertyInfo().GetPropertyName()){var t=new o;return t.AddOrModifyProperty(this.GetNewProperty("Collab.Text",e.GetPropertyValue().Value)),t}return this._parent(e)}})}),define("DS/VCXWebDressup/VCXLabelModifiable",["DS/VCXWebDressup/VCXMarkupModifiable","DS/VCXWebDressup/VCXDressupModifiable","DS/VCXWebDressup/VCXMarkup_Spec","DS/VCXWebProperties/VCXColor"],function(e,t,i,r){"use strict";return e.extend({init:function(){this._bIsLabel=!0,this._parent()},Build:function(){this._parent();var e=[{Name:"Collab.Text.Availability",DefaultValue:t.EAvailability.AppForceAvailable},{Name:"Collab.Text",DefaultValue:"$(##Actor.Name)"},{Name:"Collab.Text.Color",DefaultValue:(new r).FromRGBA(1,1,1,1),FormatPainter:!0},{Name:"Collab.Background.Color",DefaultValue:(new r).FromRGBA(.0666666666666667,.596078431372549,.8980392156862745,1),FormatPainter:!0},{Name:"Collab.Body.Shape",DefaultValue:i.EBodyShape.RoundedRectangle,FormatPainter:!0},{Name:"Collab.HideIfOutsideAnchorFrustrum",DefaultValue:!0,visibleInPropertyGroups:!0},{Name:"Collab.Image.Availability",DefaultValue:t.EAvailability.AppForceNotAvailable},{Name:"Collab.Body.HAlignment",DefaultValue:i.EHAlignment.Center},{Name:"Collab.Body.VAlignment",DefaultValue:i.EVAlignment.Middle},{Name:"Collab.3D.Paper.Billboard.Type",visibleInPropertyGroups:!1}];this._BuildPropertyValues(e),this.SetPropertyInvisible("Collab.HideIfOutsideAnchorFrustrum",!1),this.SetPropertyInvisible("Collab.3D.Paper.Is.Background",!0)}})}),define("DS/VCXWebDressup/VCXArrow_Spec",["DS/VCXWebDressup/VCXDressup_Spec"],function(e){"use strict";var t=e.extend({init:function(){this._parent(),this._IsAnchorDependent=!0}});return Object.defineProperty(t.prototype,"componentType",{enumerable:!0,get:function(){return"VCXArrow_Spec"}}),t.prototype.dressupGroupName="Markups",t}),define("DS/VCXWebDressup/VCXLinearArrow_Spec",["DS/VCXWebDressup/VCXArrow_Spec"],function(e){"use strict";var t=e.extend({init:function(){this._parent()}});return t.prototype.getDefaultName=function(){return"Arrow"},Object.defineProperty(t.prototype,"componentType",{enumerable:!0,get:function(){return"VCXLinearArrow_Spec"}}),t.prototype.dressupGroupName="Markups",t}),define("DS/VCXWebDressup/VCXCornerArrow_Spec",["DS/VCXWebDressup/VCXArrow_Spec"],function(e){"use strict";var t=e.extend({init:function(){this._parent(),this.IsAnchorDependent=!0}});return t.prototype.getDefaultName=function(){return"CornerArrow"},Object.defineProperty(t.prototype,"componentType",{enumerable:!0,get:function(){return"VCXCornerArrow_Spec"}}),t.prototype.dressupGroupName="Markups",t}),define("DS/VCXWebDressup/VCXExtremityNode",["DS/VCXWebDressup/VCXDressupNode","DS/VCXWebDressup/VCXMarkup_Spec","DS/Visualization/Node3D","DS/VCXWebComponents/VCXWebComponentOccurrence","DS/Visualization/ThreeJS_DS","DS/VCXWebDressup/VCXSmart3DPaperNode","DS/Mesh/MeshUtils","DS/Visualization/SceneGraphFactory"],function(e,t,i,r,a,o,s,n){"use strict";var l=e.extend({init:function(e){return this._parent(e),this.anchorID=e.anchorID,this._Type=1,this._ArrowTail=!0,e&&"number"==typeof e.type&&(this.Type=e.type),this},_getExtremityNode:function(){var e="#00ff00",o=1;switch(this._lineWidth=null,this.Type){case void 0:case t.EExtremityType.None:return null;case t.EExtremityType.Sphere:return n.createSphereNode({radius:o});case t.EExtremityType.FullArrow_1:case t.EExtremityType.FullArrow_2:case t.EExtremityType.HalfArrow_B1:case t.EExtremityType.HalfArrow_T1:case t.EExtremityType.HalfArrow_T2:case t.EExtremityType.HalfArrow_B2:var l=new s.PrimitiveGroup;l.editable=!0,l.fillAttr=new s.FillAttributes,l.lineAttr=new s.LineAttributes(this.GetColorPropertyValue("Collab.Attach.Line").GetThreeColor(),this.GetPropertyValue("Collab.Attach.Line.Width")),l.pointAttr=new s.PointAttributes;var p=new s.Buffer;p.size=9,p.component=s.VertexComponentEnum.POSITION,p.format=s.DataTypeEnum.FLOAT,p.dimension=3,p.data=new Float32Array(p.size),p.data[0]=0,p.data[1]=0,p.data[2]=0,p.data[3]=3.5,4===this.Type||7===this.Type?p.data[4]=0:p.data[4]=-1.5,p.data[5]=0,p.data[6]=3.5,5===this.Type||6===this.Type?p.data[7]=0:p.data[7]=1.5,p.data[8]=0,l.addBuffer(0,p);var u=new s.Buffer;u.indexBuffer=!0,u.size=3,u.format=s.DataTypeEnum.UINT,u.dimension=1,u.data=new Uint16Array(u.size);var h=u.data;h[0]=0,h[1]=1,h[2]=2,l.addBuffer(1,u);var d=new s.Primitive;d.nbIndices=3,d.connectivity=s.ConnectivityTypeEnum.TRIANGLES;var c=new s.VertexComponent;if(c.component=s.VertexComponentEnum.POSITION,c.nbVertices=3,c.nbValuesPerVertex=3,c.format=s.DataTypeEnum.FLOAT,c.cardinality=0,c.bufferId=0,c.indices=new s.IndexArray,c.indices.bufferId=1,c.indices.format=s.DataTypeEnum.UINT,c.indices.offset=0,d.addVertexComponent(c),l.addPrimitive(d),(f=new i).add(n.createMeshNode(l)),this._ArrowTail){var y={type:r.ELineType.Plain,lineWidth:this.LineWidth,color:this.GetColorPropertyValue("Collab.Attach.Line").GetThreeColor()},m=this.ExperienceBase.getManager("VCXMaterialManager").getLineMaterialFromParams(y),C=n.createLineNode({points:[new a.Vector3(0,0,0),new a.Vector3(7,0,0)],material:m});f.add(C)}return this.handleLayers(!0),f;case t.EExtremityType.SmallRed:case t.EExtremityType.Yellow:case t.EExtremityType.Dot:case t.EExtremityType.Red:case t.EExtremityType.Line:switch(this.Type){case t.EExtremityType.Yellow:e="#ffff00";break;case t.EExtremityType.Dot:o*=.5;break;case t.EExtremityType.Red:e="#ff0000";break;case t.EExtremityType.SmallRed:e="#ff0000",o*=.5;break;case t.EExtremityType.Line:}var f;return this._Material=new a.MeshBasicMaterial({side:a.DoubleSide,transparent:!1,opacity:1,color:e,force:!0,polygonOffset:!0,polygonOffsetFactor:1,polygonOffsetUnits:-10}),this._lineWidth=1,this._Material.line=new a.LineBasicMaterial({side:a.DoubleSide,transparent:!1,color:"#000000",opacity:1,force:!0,polygonBorderMode:!0,lineWidth:this._lineWidth,polygonOffset:!0,polygonOffsetFactor:1,polygonOffsetUnits:-20,linecap:"round"}),this.Type!==t.EExtremityType.Dot&&this.Type!==t.EExtremityType.SmallRed||(this._Material.line.visible=!1),f=n.createCircleNode({radius:.7*o,material:this._Material,fill:!0});default:console.warn("Extremity "+this.Type+" not defined")}},dispose:function(){this._Smart3DPaperNode&&(this._Smart3DPaperNode.dispose(),this._Smart3DPaperNode=null),this._parent()},_Build:function(){var e={name:"AttachExtremitySmartNode",modifiable:this.Modifiable,type:this._type};this._Smart3DPaperNode=new o(e),this._referential&&this._Smart3DPaperNode.SetReferential(this._referential),this._Smart3DPaperNode.ModifiableProperties=!1,this._Smart3DPaperNode.SizeControlType=1,this._Smart3DPaperNode.BillboardType=3,this.add(this._Smart3DPaperNode),this.handleLayers(!0)},preRender:function(e){if(this._parent(e),this._Material&&this._Material.line){this._Material.line.handleByPrerender=!0;let e=this.ExperienceBase.getManager("VCXPaperManager").UnitValueToPixel(null!==this._lineWidth?this._lineWidth:this.LineWidth);e>=1?(this._Material.line.setLineWidth(e),this._Material.line.visible=!0):this._Material.line.visible=!1}this._Smart3DPaperNode&&this._Smart3DPaperNode.preRender(e)},update:function(e){if(this._parent(),this._globalOpacity!==this.GlobalOpacity){this._globalOpacity=this.GlobalOpacity;var i=this._globalOpacity>0;i&&(this._Smart3DPaperNode||this._Build()),this.setVisibility(i)}if(!(this._globalOpacity<=0)&&(this.LineWidth=this.Modifiable.GetPropertyValue("Collab.Attach.Line.Width"),this._previousType===this.Type&&this._previousLineWidth===this.LineWidth||(this._previousType=this.Type,this._previousLineWidth=this.LineWidth,this._Node&&(this._Smart3DPaperNode.remove(this._Node),this._Material=null,this._Node=null)),!this._Node&&this._Smart3DPaperNode&&(this._Node=this._getExtremityNode(0),this._Node&&this._Smart3DPaperNode.add(this._Node)),this._Smart3DPaperNode&&this._Smart3DPaperNode.update(e),this._Node)){var r=this.GetColorPropertyValue("Collab.Attach.Line");this._Material||(this._Material=new a.MeshBasicMaterial({}),this._lineWidth=1,this._Material.line=new a.LineBasicMaterial({side:a.DoubleSide,transparent:!1,color:"#000000",opacity:1,force:!0,polygonBorderMode:!0,lineWidth:this._lineWidth,polygonOffset:!0,polygonOffsetFactor:1,polygonOffsetUnits:-20,linecap:"round"}),this._Node.setMaterial(this._Material)),this._Material.opacity=r.a*this._globalOpacity,this.Type!==t.EExtremityType.Yellow&&this.Type!==t.EExtremityType.Red&&this.Type!==t.EExtremityType.SmallRed&&(this._Material.color=r.GetThreeColor(),this._Material.line&&(this._Material.color=r.GetThreeColor())),this._Material.line&&(this._Material.line.opacity=this._Material.opacity),this._Material.force=!0,this.handleLayers()}},SetReferential:function(e){this._referential=e.clone(),this._Smart3DPaperNode&&(this._Smart3DPaperNode.Referential=this._referential)},GetReferential:function(e){return this._Smart3DPaperNode?this._Smart3DPaperNode.GetReferential(e):null}});return Object.defineProperty(l.prototype,"Type",{enumerable:!0,get:function(){return this._Type},set:function(e){this._Type=e}}),Object.defineProperty(l.prototype,"LineWidth",{enumerable:!0,get:function(){return this._LineWidth},set:function(e){this._LineWidth=e}}),l}),define("DS/VCXWebDressup/VCXMarkupModifiableView",["DS/VCXWebDressup/VCXDressupModifiableView"],function(e){"use strict";return e.extend({init:function(){this._parent()},SetPropertiesViewInfo:function(){this._parent()},getGroupPropertiesOrders:function(){var e=this._parent()||{};return UWA.extend(e,{"Group.Essentials":["Actor.Name","Modifiable.Style","Actor.Color","Actor.Opacity","Collab.Text"],"Group.Text":["Collab.Text.Color","Collab.Text.Color.Opacity","Collab.Text.Font","Collab.Text.SizeToFit","Collab.Text.html"],"Group.Paragraph":["Collab.Text.ParagraphSpacing","Collab.Text.HAlignment","Collab.Text.VAlignment"],"Group.Body":["Collab.Body.Shape","Collab.Body.Width","Collab.Body.Height","Collab.3D.Paper.Is.Background","Collab.Body.HAlignment","Collab.Body.VAlignment"],"Group.Background":["Collab.Background.Color","Collab.Background.Color.Opacity","Collab.Body.InnerMargin"],"Group.Image":["Collab.Image.Doc.ID","Collab.Image.DPI","Collab.Image.Transparency"],"Group.Position":["Collab.3D.Paper.Positioning.Type","Collab.3D.Paper.Paper.Position.X","Collab.3D.Paper.Paper.Position.Y","Collab.3D.Paper.3D.Text.Position","Collab.3D.Paper.Depth"],"Group.Border":["Collab.Border.Line.Color","Collab.Border.Line.Color.Opacity","Collab.Border.Line.Width"],"Group.Attach":["Collab.Attach.Line.Color","Collab.Attach.Line.Color.Opacity","Collab.Attach.LeadType","Collab.Attach.ExtremityType","Collab.Attach.BentDot","Collab.Attach.Line.Width","Collab.Attach.Line.Type"],"Group.Shadow":["Collab.Body.Shadow.Opacity","Collab.Body.Shadow.Distance","Collab.Body.Shadow.Orientation","Collab.Body.Shadow.Blur"],"Group.BOM":["Collab.BOM.FilterOnVisibleCallouts","Collab.BOM.Header.Text.Color","Collab.BOM.Header.Background.Color","Collab.BOM.OddRow.Background.Color","Collab.BOM.EvenRow.Background.Color"],"Group.Measurement":["Collab.Measurement.DisplayValue","Collab.Measurement.PreSymbol","Collab.Measurement.PreString","Collab.Measurement.MiddleSymbol","Collab.Measurement.MiddleString","Collab.Measurement.PostSymbol","Collab.Measurement.PostString","Collab.Measurement.Value","Collab.Measurement.Length","Collab.Measurement.Length1","Collab.Measurement.Length2","Collab.Measurement.Radius","Collab.Measurement.Radius1","Collab.Measurement.Radius2","Collab.Measurement.Area","Collab.Measurement.Volume","Collab.Measurement.ShowConstructionLines","Collab.Measurement.ShowRedlines","Collab.Measurement.ShowPlanes","Collab.Measurement.ShowEndPoints","Collab.Measurement.Type"]}),e},getAdditionalPropertySettings:function(){var e=this._parent()||{};return e["Collab.Text"]={displayStyle:"editorInline"},e}})}),define("DS/VCXWebDressup/VCXLabelModifiableView",["DS/VCXWebDressup/VCXMarkupModifiableView"],function(e){"use strict";var t=e.extend({init:function(){this._parent()},getCollapsedGroupsNames:function(){return this._parent().concat(["Group.Paragraph","Group.Position","Group.Border","Group.Attach","Group.Shadow","Group.Effect"])}});return t.prototype._getGroupsPriorities=function(t){var i=e.prototype._getGroupsPriorities();return UWA.extend(i,{"Group.Essentials":0,"Group.Text":10,"Group.Background":20,"Group.Body":25,"Group.Paragraph":30,"Group.Position":40,"Group.Border":50,"Group.Attach":60,"Group.Shadow":70,"Group.Effect":80,"Group.Actions":100}),i},t}),define("DS/VCXWebDressup/VCXPanelModifiableView",["DS/VCXWebDressup/VCXMarkupModifiableView","DS/VCXWebDressup/VCXPanel_Spec"],function(e,t){"use strict";var i=e.extend({init:function(){this._parent()},getCollapsedGroupsNames:function(){return this._parent().concat(["Group.Position","Group.Border","Group.Attach","Group.Shadow","Group.Effect"])}});return i.prototype._getGroupsPriorities=function(i){var r=this.QueryInterface("VCXIModifiable"),a=e.prototype._getGroupsPriorities();return r.GetPropertyValue("Collab.Markup.SubType")===t.ESubType.Image?UWA.extend(a,{"Group.Essentials":0,"Group.Image":10,"Group.Body":15,"Group.Border":20,"Group.Position":30,"Group.Shadow":40,"Group.Effect":80,"Group.Actions":100}):r.GetPropertyValue("Collab.Markup.SubType")===t.ESubType.Text?UWA.extend(a,{"Group.Essentials":0,"Group.Text":10,"Group.Paragraph":15,"Group.Background":20,"Group.Body":30,"Group.Border":40,"Group.Position":50,"Group.Shadow":60,"Group.Actions":100,"Group.Effect":110}):UWA.extend(a,{"Group.Essentials":0,"Group.Text":10,"Group.Paragraph":15,"Group.Image":18,"Group.Background":20,"Group.Body":30,"Group.Border":40,"Group.Position":50,"Group.Attach":60,"Group.Shadow":70,"Group.Actions":100,"Group.Effect":110}),a},i}),define("DS/VCXWebDressup/VCXCalloutModifiableView",["DS/VCXWebDressup/VCXMarkupModifiableView"],function(e){"use strict";var t=e.extend({init:function(){this._parent()},getCollapsedGroupsNames:function(){return this._parent().concat(["Group.Position","Group.Border","Group.Attach","Group.Shadow"])}});return t.prototype._getGroupsPriorities=function(t){var i=e.prototype._getGroupsPriorities();return UWA.extend(i,{"Group.Essentials":0,"Group.Text":10,"Group.Background":20,"Group.Body":30,"Group.Actions":40,"Group.Position":50,"Group.Border":60,"Group.Attach":70,"Group.Shadow":80,"Group.Effect":90}),i},t}),define("DS/VCXWebDressup/VCXMeasurementModifiableView",["DS/VCXWebDressup/VCXMarkupModifiableView"],function(e){"use strict";var t=e.extend({init:function(){this._parent()},getGroupPropertiesOrders:function(){var e=this._parent()||{};return UWA.extend(e,{"Group.Measurement":["Collab.Measurement.DisplayValue","Collab.Measurement.Value","Collab.Measurement.PreSymbol","Collab.Measurement.PreString","Collab.Measurement.MiddleSymbol","Collab.Measurement.MiddleString","Collab.Measurement.PostSymbol","Collab.Measurement.PostString"]}),e},getCollapsedGroupsNames:function(){return this._parent().concat(["Group.Position","Group.Border","Group.Attach","Group.Shadow","Group.Effect"])}});return t.prototype._getGroupsPriorities=function(){var t=e.prototype._getGroupsPriorities();return UWA.extend(t,{"Group.Essentials":0,"Group.Text":10,"Group.Background":20,"Group.Body":30,"Group.Measurement":40,"Group.Actions":50,"Group.Position":60,"Group.Border":70,"Group.Attach":80,"Group.Shadow":90}),t},t}),define("DS/VCXWebDressup/VCXArrowNode",["DS/VCXWebDressup/VCXDressupNode","DS/Visualization/ThreeJS_DS","DS/Mesh/MeshUtils","DS/Visualization/SceneGraphFactory","DS/Visualization/Node3D"],function(e,t,i,r,a){"use strict";return e.extend({init:function(e){return this._parent(e),this._Node=null,this._verticesNb=null,this._trianglesIndicesNb=null,this._lineIndicesNb=null,this},_Build:function(){var e=0,o=0,s=0,n=0;this._verticesNb=2*this._step+8,this._lineIndicesNb=2*this._verticesNb;var l=2*this._step+6;this._trianglesIndicesNb=3*l,this._bkGrndPrimGrp=new i.PrimitiveGroup({editable:!0}),this._borderPrimGrp=new i.PrimitiveGroup({editable:!0});var p=new i.Buffer({component:i.VertexComponentEnum.POSITION,data:new Float32Array(3*this._verticesNb),dimension:3}),u=new i.Buffer({component:i.VertexComponentEnum.DIFFUSE_COLOR,data:new Float32Array(4*this._verticesNb),dimension:4}),h=new i.Buffer({indexBuffer:!0,data:new Uint16Array(this._trianglesIndicesNb)}),d=new i.Buffer({component:i.VertexComponentEnum.POSITION,data:new Float32Array(3*this._verticesNb),dimension:3}),c=new i.Buffer({component:i.VertexComponentEnum.DIFFUSE_COLOR,data:new Float32Array(4*this._verticesNb),dimension:4}),y=new i.Buffer({indexBuffer:!0,data:new Uint16Array(this._lineIndicesNb)});this._bkGrndPrimGrp.addBuffer(0,p),this._bkGrndPrimGrp.addBuffer(1,u),this._bkGrndPrimGrp.addBuffer(2,h),this._borderPrimGrp.addBuffer(0,d),this._borderPrimGrp.addBuffer(1,c),this._borderPrimGrp.addBuffer(2,y);var m=h.data;for(m[e++]=0,m[e++]=1,m[e++]=2,m[e++]=0,m[e++]=2,m[e++]=2*this._step+6,m[e++]=0,m[e++]=2*this._step+6,m[e++]=2*this._step+7,o=2;o<this._step+2;++o)s=o+1,n=this._verticesNb-o,m[e++]=o,m[e++]=s,m[e++]=n,m[e++]=n,m[e++]=s,m[e++]=n-1;for(m[e++]=this._step+2,m[e++]=this._step+3,m[e++]=this._step+4,m[e++]=this._step+2,m[e++]=this._step+4,m[e++]=this._step+6,m[e++]=this._step+6,m[e++]=this._step+4,m[e++]=this._step+5,m=y.data,e=0,o=0;o<this._verticesNb;o++)m[e++]=o,m[e++]=o===this._verticesNb-1?0:o+1;var C=new i.Primitive({nbIndices:this._trianglesIndicesNb,connectivity:i.ConnectivityTypeEnum.TRIANGLES}),f=new i.VertexComponent({nbVertices:this._verticesNb,bufferId:0,indices:new i.IndexArray({bufferId:2,offset:0})}),V=new i.VertexComponent({nbVertices:this._verticesNb,bufferId:1,indices:new i.IndexArray({bufferId:2,offset:0})});C.addVertexComponent(f),C.addVertexComponent(V),this._bkGrndPrimGrp.addPrimitive(C);var b=new i.Primitive({nbIndices:this._lineIndicesNb,connectivity:i.ConnectivityTypeEnum.LINES}),P=new i.VertexComponent({nbVertices:this._verticesNb,bufferId:0,indices:new i.IndexArray({bufferId:2,offset:0})}),_=new i.VertexComponent({nbVertices:this._verticesNb,bufferId:1,indices:new i.IndexArray({bufferId:2,offset:0})});b.addVertexComponent(P),b.addVertexComponent(_),this._borderPrimGrp.addPrimitive(b),this._bodyMat=new t.PhysicalMaterial({side:t.DoubleSide,vertexColors:t.VertexColors,color:"#ffffff",transparent:!0,useLighting:!1,opacity:1,force:!0,polygonOffset:!0,polygonOffsetFactor:-1,polygonOffsetUnits:-10});var g=this.Modifiable.getLineMaterialParams("Collab.Border.Line",this._lineMat,this._lastFrontLineType);Object.keys(g).length>0&&("number"==typeof g.type&&g.type!==this._lastFrontLineType&&(this._lastFrontLineType=g.type),g.polygonBorderMode=!0,this._lineMat=this.ExperienceBase.getManager("VCXMaterialManager").getLineMaterialFromParams(g,this._lineMat)),this._NodeBkGrnd=r.createMeshNode(this._bkGrndPrimGrp),this._NodeBkGrnd.setMaterial(this._bodyMat),this._NodeBkGrnd.setVisibilityInTree(!1),this._NodeBorder=r.createMeshNode(this._borderPrimGrp),this._NodeBorder.setMaterial(this._lineMat),this._NodeBorder.setVisibilityInTree(!1),this._Node=new a,this._Node.setVisibilityInTree(!0),this._Node.addChild(this._NodeBkGrnd),this._Node.addChild(this._NodeBorder),this.addChild(this._Node,{exludeFromBounding:!1})},preRender:function(e){if(this._parent(e),this._lineMat){this._lineMat.handleByPrerender=!0;let e=this.ExperienceBase.getManager("VCXPaperManager").UnitValueToPixel(this.Modifiable.GetPropertyValue("Collab.Border.Line.Width"));e>=1?(this._lineMat.setLineWidth(e),this._lineMat.visible=!0):this._lineMat.visible=!1}this._updateNodeBuffers(e,!0)},update:function(){this._parent(),this.handleLayers()},_updateArrowMaterialsParameters:function(){if(this._Node)if(this._bodyMat&&(this._bodyMat.opacity=this._globalOpacity),this.GetPropertyGroupVisibility("Group.Border")){var e=this.Modifiable.getLineMaterialParams("Collab.Border.Line",this._lineMat,this._lastFrontLineType,this._globalOpacity);Object.keys(e).length>0&&("number"==typeof e.type&&e.type!==this._lastFrontLineType&&(this._lastFrontLineType=e.type),e.polygonBorderMode=!0,this._lineMat=this.ExperienceBase.getManager("VCXMaterialManager").getLineMaterialFromParams(e,this._lineMat)),(!this._NodeBorder.material||this._lineMat&&this._NodeBorder.material.id!==this._lineMat.id)&&this._NodeBorder.setMaterial(this._lineMat)}else this._lineMat.opacity=0,this._lineMat.setLineWidth(0)},_updateNodeBuffers:function(e,t){var r=this.Modifiable.GetObject().IsKindOf("VCXLinearArrow_Spec")||!0===this.Modifiable.GetPropertyValue("Collab.Is.Paper")||2===this.Modifiable.GetPropertyValue("Arrow.Circular.Flat");if((t&&r||!t&&!r)&&this._NodeBkGrnd&&this._NodeBorder){var a=this._NodeBkGrnd.getBuffer(i.VertexComponentEnum.POSITION),o=this._NodeBkGrnd.getBuffer(i.VertexComponentEnum.DIFFUSE_COLOR),s=this._NodeBorder.getBuffer(i.VertexComponentEnum.POSITION),n=this._NodeBorder.getBuffer(i.VertexComponentEnum.DIFFUSE_COLOR);if(void 0!==a&&void 0!==o&&void 0!==s&&void 0!==n){var l=this._ComputePosBuffer(e,a,o,s,n);this._NodeBkGrnd.updateBuffer(i.VertexComponentEnum.POSITION,0,l),this._NodeBkGrnd.updateBuffer(i.VertexComponentEnum.DIFFUSE_COLOR,0,l),this._NodeBkGrnd.computeBoundingElements(),this._NodeBorder.updateBuffer(i.VertexComponentEnum.POSITION,0,l),this._NodeBorder.updateBuffer(i.VertexComponentEnum.DIFFUSE_COLOR,0,l),this._NodeBorder.computeBoundingElements()}}},_updateNodePositionFromAnchor:function(e){if(this.GetAnchorWorldMatrix(1,null))console.log("This arrow has another anchor.. may be the one determining the position");else{var i=this.GetAnchorWorldMatrix(0,null);i||(console.warn("No matrix has been found for arrow's anchor.0 position..."),i=new t.Matrix4),e&&i.multiply(e),this.setMatrix(i)}},_fillColorBuffer:function(e,t){var i=0,r=0,a=this.GetColorPropertyValue("Arrow.Body"),o=this.GetColorPropertyValue("Arrow.Body.2"),s=a.GetRGBA(),n=o.GetRGBA(),l=this.GetColorPropertyValue("Collab.Border.Line"),p=this.GetColorPropertyValue("Collab.Border.Line.2"),u=l.GetRGBA(),h=p.GetRGBA(),d=0;for(r=this._verticesNb-2;3!==r;r=++r%this._verticesNb)for(i=4*r,d=0;d<4;i++,d++)e[i]=n[d],t[i]=h[d];for(r=3;r<this._step+2;++r){var c=o.Clone().Lerp(a,(r-2)/this._step),y=p.Clone().Lerp(l,(r-2)/this._step);e[(i=4*r)+0]=c.r,e[i+1]=c.g,e[i+2]=c.b,e[i+3]=c.a,t[i+0]=y.r,t[i+1]=y.g,t[i+2]=y.b,t[i+3]=y.a,e[(i=4*(this._verticesNb-r))+0]=c.r,e[i+1]=c.g,e[i+2]=c.b,e[i+3]=c.a,t[i+0]=y.r,t[i+1]=y.g,t[i+2]=y.b,t[i+3]=y.a}for(r=this._step+2;r<=this._step+6;++r)for(i=4*r,d=0;d<4;i++,d++)e[i]=s[d],t[i]=u[d]}})}),define("DS/VCXWebDressup/VCXArrowSGNodeHolder",["DS/VCXWebDressup/VCXDressupSGNodeHolder"],function(e){"use strict";return e.extend({init:function(){}})}),define("DS/VCXWebDressup/VCXViewport_Spec",["DS/VCXWebDressup/VCXDressup_Spec","DS/Visualization/ThreeJS_DS","DS/VCXWebKernelTools/VCXMathTools"],function(e,t,i){"use strict";var r=e.extend({init:function(){this._parent(),this.IsViewPointDependent=!0,this.IsAnchorDependent=!1,this._hdrUrl=null,this._originLight1Intensity=null,this._originLight2Intensity=null,this._originLight3Intensity=null,this._originAmbientLightIntensity=null},Build:function(){this._experienceBase.getManager("VCXVisuManager").setActiveViewport(this)},getActiveAmbienceID:function(){var e=this.QueryInterface("VCXIModifiable");if(e){var t=e.GetPropertyValue("Viewport.ActiveAmbience");if(t&&t.length)return t}return null},setLightingMode:function(e,i,a,o){var s=this.GetObject()._experienceBase.getManager("VCXContextManager");s.getMainViewer().planeV2=e;var n=!1,l=16777215,p=1,u=null,h=!1,d=16777215,c=1,y=null,m=!1,C=1,f=null;switch(i){case r.ERenderLightingMode.Custom:case r.ERenderLightingMode.Soft:n=!0,p=.8*a,u=new t.Vector3(0,0,1);break;case r.ERenderLightingMode.Medium:.25;var V=.5;n=!0,p=.8*a,u=new t.Vector3(V,V,1),h=!0,c=.8*a,y=new t.Vector3(-V,-V,-1);break;case r.ERenderLightingMode.Metal:.2;V=.7;n=!0,p=a,u=new t.Vector3(V,V,1),h=!0,c=.6*a,y=new t.Vector3(-V,-V,1),m=!0,C=.5*a,f=new t.Vector3(-1,1,-.5);break;case r.ERenderLightingMode.HeavyMetal:.2;V=.7;n=!0,l=15461375,p=.8*a,u=new t.Vector3(2*V,V,1),h=!0,d=15268095,c=.8*a,y=new t.Vector3(-V,-2*V,1),m=!0,C=.5*a,f=new t.Vector3(-1,1,-.5);break;case r.ERenderLightingMode.HighContrast:.2;V=-.7;n=!0,l=16772075,p=.9*a,u=new t.Vector3(2*V,V,1),h=!0,d=15268095,c=.9*a,y=new t.Vector3(-V,-2*V,1),m=!0,C=.5*a,f=new t.Vector3(1,-1,-1);break;case r.ERenderLightingMode.ShadedIllustration:V=.2;n=!0,l=13158455,p=.9*a,u=new t.Vector3(V,0,1),h=!0,d=3618760,c=.9*a,y=new t.Vector3(-V,0,1);break;case r.ERenderLightingMode.Archi:n=!0,p=1,u=new t.Vector3(-1,1,1);break;case r.ERenderLightingMode.DefaultComposer:n=!0,u=new t.Vector3(-.25,.25,.5),h=!0,c=.6,y=new t.Vector3(.25,-.75,0)}e||(p=0,c=0,C=0),s.applyToViewers(function(i){i.setVisuAppearanceMode(e?t.DefaultAppearanceMode.BASIC:t.DefaultAppearanceMode.GASLOOK),n?i.setLightParameters({isPhysical:!1,lightIndex:0,intensity:p,color:l,direction:u.normalize(),directionType:"camera"}):i.setLightParameters({lightIndex:0,intensity:0,color:0,direction:new t.Vector3(0,0,1),directionType:"camera"}),h?i.setLightParameters({isPhysical:!1,lightIndex:1,intensity:c,color:d,direction:y.normalize(),directionType:"camera"}):i.setLightParameters({lightIndex:1,intensity:0,color:0,direction:new t.Vector3(0,0,1),directionType:"camera"}),m?i.setLightParameters({isPhysical:!1,lightIndex:2,intensity:C,color:16777215,direction:f.normalize(),directionType:"camera"}):i.setLightParameters({lightIndex:2,intensity:0,color:0,direction:new t.Vector3(0,0,1),directionType:"camera"})})}});return r.EPaperOrientation={Portrait:0,Landscape:1},r.EVertical={"X+":0,"Y+":1,"Z+":2,"X-":3,"Y-":4,"Z-":5},r.EAA={NoAA:0,SMAA:1,MLAA:2,FXAA:3,FSAA:4,SSAA:6,TAA:8},r.ESSAO={NoSSAO:1,OnIdle:2,Always:3},r.EEnvironment={None:0,exterior_parking:1,arches_pinetree:2,barcelona_rooftop:3,exterior_plaza_4:4,exterior_scenic_5:5,exterior_sky:6,interior_apartment_1:7,studio_panel_3:8,studio_spot_1:9,studio_spot_2:10,PLM:100},r.ERenderLightingMode={Custom:0,Soft:1,Medium:2,Metal:3,HeavyMetal:4,HighContrast:5,ShadedIllustration:6,Archi:7,DefaultComposer:8},r.prototype.getDefaultName=function(){return"Viewport"},Object.defineProperty(r.prototype,"componentType",{enumerable:!0,get:function(){return"VCXViewport_Spec"}}),r.prototype.dressupGroupName="Environment",Object.defineProperty(r.prototype,"renderMode",{enumerable:!0,set:function(e){this._renderMode=e},get:function(){return this._renderMode}}),Object.defineProperty(r.prototype,"outlineType",{enumerable:!0,set:function(e){this._outlineType=e},get:function(){return this._outlineType}}),r}),define("DS/VCXWebDressup/VCXViewportModifiable",["DS/VCXWebDressup/VCXViewport_Spec","DS/CoreEvents/Events","DS/VCXWebDressup/VCXDressupModifiable","DS/Visualization/ThreeJS_DS","DS/VCXWebKernelCommands/VCXCmdChangePropertiesVolatile","DS/VCXWebKernelTools/VCXMathTools","DS/VCXWebProperties/VCXPropertySet","DS/VCXWebProperties/VCXProperty","DS/VCXWebProperties/VCXPropertyInfo","DS/VCXWebProperties/VCXPropertyValueInt","DS/VCXWebProperties/VCXPropertyValueBoolean","DS/VCXWebProperties/VCXPropertyValueFloat","DS/VCXWebProperties/VCXPropertyValueEnum","DS/VCXWebProperties/VCXPropertyValueColor","DS/VCXWebProperties/VCXPropertyValueFrame","DS/VCXWebProperties/VCXPropertyValueAnchor","DS/VCXWebProperties/VCXPropertyValueString","DS/VCXWebProperties/VCXPropertyValueVector","DS/VCXWebProperties/VCXPropertyValuePoint","DS/VCXWebProperties/VCXPropertyValueLink","DS/VCXWebProperties/VCXColor","DS/VCXWebProperties/VCXPropertyValueDocId","DS/VCXWebComponents/VCXWebComponentOccurrence","DS/VCXWebVisualization/VCXVisuManager","i18n!DS/VCXWebModifiables/assets/nls/VCXWebModifiables"],function(e,t,i,r,a,o,s,n,l,p,u,h,d,c,y,m,C,f,V,b,P,_,g,S,M){"use strict";return i.extend({init:function(){this._parent(),this._bIsViewport=!0,this._envMapNeverLoaded=!1,this._forceRefresh=!1,this._fullFrameSize=36},Dispose:function(){this._parent(),delete this._currentAmbienceIDXs},Build:function(){this._parent();var t=[{Name:"Actor.Name",Type:C,DefaultValue:"Viewport",i18n:M,visibleInPropertyGroups:!1},{Name:"Camera.Position",Type:y,DefaultValue:new r.Matrix4,Persistent:!1,hiddenFields:["Orientation","Scale"],GroupId:"Group.Camera",visibleInPropertyGroups:!1},{Name:"Camera.Position.Frame",Type:V,Persistent:!1,GroupId:"Group.Camera"},{Name:"Camera.Target.Frame",Type:V,Persistent:!1,GroupId:"Group.Camera"},{Name:"Camera.Dolly",Type:u,Persistent:!0,GroupId:"Group.Camera"},{Name:"Actor.Anchor.1",Type:m,DefaultValue:(new m).SetValueFrame((new y).SetValueFromVector(new r.Vector3(0,0,0))).GetValue(),Persistent:!1},{Name:"Actor.Anchor.2",Type:m,DefaultValue:(new m).SetValueFrame((new y).SetValueFromVector(new r.Vector3(0,0,0))).GetValue(),Persistent:!1},{Name:"Collab.ListAnchorsIDs",Type:f,DefaultValue:[1,2],visibleInPropertyGroups:!1},{Name:"Camera.Focal.Length",Type:h,GroupId:"Group.Camera",Persistent:!1,Bounds:{Min:10,Max:600,Step:1}},{Name:"Camera.Angle",Type:h,DefaultValue:45,GroupId:"Group.Camera",Persistent:!1,visibleInPropertyGroups:!1},{Name:"Camera.Height",Type:h,DefaultValue:400,GroupId:"Group.Camera",Persistent:!1},{Name:"Camera.Ortho",Type:u,DefaultValue:!1,GroupId:"Group.Camera",Persistent:!1},{Name:"Camera.Arcball",Type:u,DefaultValue:!0,GroupId:"Group.Camera",Persistent:!1,visibleInPropertyGroups:!1},{Name:"Camera.Pitch",Type:u,DefaultValue:!0,GroupId:"Group.Camera",Persistent:!1,visibleInPropertyGroups:!1},{Name:"Camera.Roll",Type:u,DefaultValue:!1,GroupId:"Group.Camera",Persistent:!1,visibleInPropertyGroups:!1},{Name:"Camera.Roll.Angle",Type:h,DefaultValue:0,GroupId:"Group.Camera",Persistent:!1,Bounds:{Min:-179,Max:180,Step:1}},{Name:"Camera.Yaw",Type:u,DefaultValue:!0,GroupId:"Group.Camera",Persistent:!1,visibleInPropertyGroups:!1},{Name:"Camera.LockDistCOI",Type:u,DefaultValue:!1,GroupId:"Group.Camera",Persistent:!1,visibleInPropertyGroups:!1},{Name:"Camera.DistCOI",Type:h,DefaultValue:500,GroupId:"Group.Camera",Persistent:!1,visibleInPropertyGroups:!1},{Name:"Camera.Mouse.Controls.Profile",Type:d,GroupId:"Group.Camera",Persistent:!1,BehaviorType:1,MapChoice:{10:"SIMPLE",20:"COMBINED",30:"CATIA",40:"SWX"},visibleInPropertyGroups:!1},{Name:"Paper.Width",Type:h,GroupId:"Group.Paper",DefaultValue:300},{Name:"Paper.Height",Type:h,GroupId:"Group.Paper",DefaultValue:168.75},{Name:"Paper.Orientation",Type:d,GroupId:"Group.Paper",MapChoice:this._generateMapChoiceFromEnumAndId(e.EPaperOrientation,"Paper.Orientation"),Persistent:!1},{Name:"Viewport.ActiveAmbience",Type:b,DefaultValue:"",GroupId:"Group.Environment",BehaviorType:1,visibleInPropertyGroups:!1,FormatPainter:!0},{Name:"Viewport.ActiveAmbience.IDX",Type:d,GroupId:"Group.Environment",Persistent:!1,BehaviorType:1,MapChoice:{0:"None"},returnedOnGetProperties:!1,FormatPainter:!0},{Name:"Viewport.ActiveCamera",Type:p,DefaultValue:0,GroupId:"Group.Environment",Persistent:!1,BehaviorType:1,visibleInPropertyGroups:!1},{Name:"Environment.Vertical",Type:d,DefaultValue:e.EVertical["Z+"],GroupId:"Group.Environment",MapChoice:this._generateMapChoiceFromEnumAndId(e.EVertical),FormatPainter:!0},{Name:"Environment.Background.Override",Type:u,ControlsGroupVisibility:!0,DefaultValue:!1,GroupId:"Group.Environment.Background"},{Name:"Environment.Background.Color",Type:c,DefaultValue:(new P).FromRGBA(236/255,236/255,236/255),GroupId:"Group.Environment.Background",FormatPainter:!0},{Name:"Environment.Background.Color.Opacity",Type:h,DefaultValue:1,GroupId:"Group.Environment.Background",FormatPainter:!0},{Name:"Environment.Background.Image",Type:_,DefaultValue:-1,GroupId:"Group.Environment.Background",FormatPainter:!0},{Name:"Environment.Background.Gradient",Type:u,DefaultValue:!1,GroupId:"Group.Environment.Background",FormatPainter:!0},{Name:"Environment.Background.Foot.Color",Type:c,DefaultValue:(new P).FromRGBA(236/255,236/255,236/255),GroupId:"Group.Environment.Background",FormatPainter:!0},{Name:"Environment.Shadow",Type:u,DefaultValue:!1,Persistent:!1,GroupId:"Group.Environment.Effects",FormatPainter:!0},{Name:"Environment.AA",Type:d,DefaultValue:e.EAA.SMAA,GroupId:"Group.Environment.Effects",MapChoice:this._generateMapChoiceFromEnumAndId(e.EAA,"Environment.AA"),FormatPainter:!0},{Name:"Environment.SSAO",Type:d,DefaultValue:e.ESSAO.OnIdle,GroupId:"Group.Environment.Effects",MapChoice:this._generateMapChoiceFromEnumAndId(e.ESSAO,"Environment.SSAO"),FormatPainter:!0},{Name:"Environment.Vignetting",Type:u,DefaultValue:!1,GroupId:"Group.Environment.Effects",FormatPainter:!0},{Name:"Environment.DOF",Type:u,DefaultValue:!1,GroupId:"Group.Environment.Effects",FormatPainter:!0},{Name:"Environment.Bloom",Type:u,DefaultValue:!1,GroupId:"Group.Environment.Effects",FormatPainter:!0},{Name:"Environment.Flare",Type:u,DefaultValue:!1,GroupId:"Group.Environment.Effects",FormatPainter:!0},{Name:"Environment.BackFaceCulling",Type:u,DefaultValue:!0,GroupId:"Group.Environment.Effects",FormatPainter:!0},{Name:"Render.Mode",Type:d,DefaultValue:g.ERenderingMode.Smooth,GroupId:"Group.Render",MapChoice:this._generateMapChoiceFromEnumAndId(g.ERenderingMode,"Render"),FormatPainter:!0},{Name:"Render.OutlineType",Type:d,DefaultValue:g.EOutlineType.Construction,GroupId:"Group.Render",MapChoice:this._generateMapChoiceFromEnumAndId(g.EOutlineType,"Render.OutlineType"),FormatPainter:!0},{Name:"Render.Lighting.Availability",Type:d,DefaultValue:i.EAvailability.AppForceAvailable,ControlsGroupAvailability:!0,GroupId:"Group.Render.Lighting"},{Name:"Render.Lighting.Override",Type:u,ControlsGroupVisibility:!0,DefaultValue:!1,GroupId:"Group.Render.Lighting"},{Name:"Render.Lighting.Intensity",Type:h,DefaultValue:.9,GroupId:"Group.Render.Lighting",FormatPainter:!0},{Name:"Render.Lighting.Mode",Type:d,DefaultValue:e.ERenderLightingMode.DefaultComposer,GroupId:"Group.Render.Lighting",MapChoice:this._generateMapChoiceFromEnumAndId(e.ERenderLightingMode,"Render.Lighting.Mode"),FormatPainter:!0},{Name:"Render.ShowConstructions",Type:u,DefaultValue:!1,GroupId:"Group.Render",FormatPainter:!0},{Name:"Render.ChildrenStronger",Type:u,DefaultValue:!1,GroupId:"Group.Render",FormatPainter:!0},{Name:"Environment.Debug.Availability",Type:d,DefaultValue:i.EAvailability.AppForceNotAvailable,ControlsGroupAvailability:!0,GroupId:"Group.Environment.Debug"},{Name:"Environment.Debug.Show",Type:u,DefaultValue:!1,ControlsGroupVisibility:!0,GroupId:"Group.Environment.Debug"},{Name:"Environment.Debug.ShadowLight",Type:u,DefaultValue:!1,GroupId:"Group.Environment.Debug"},{Name:"Environment.Debug.BSphere",Type:u,DefaultValue:!1,GroupId:"Group.Environment.Debug"},{Name:"Environment.Debug.PrimitiveBSphere",Type:u,DefaultValue:!1,GroupId:"Group.Environment.Debug"},{Name:"Environment.Debug.RepBBox",Type:u,DefaultValue:!1,GroupId:"Group.Environment.Debug"},{Name:"Environment.Debug.Picking",Type:u,DefaultValue:!1,GroupId:"Group.Environment.Debug"},{Name:"Environment.Debug.Normals",Type:u,DefaultValue:!1,GroupId:"Group.Environment.Debug"},{Name:"Environment.Debug.PickHybrid",Type:u,DefaultValue:!1,GroupId:"Group.Environment.Debug"},{Name:"Environment.Debug.PostProcessing",Type:u,DefaultValue:!1,GroupId:"Group.Environment.Debug"},{Name:"Environment.Debug.ShadowMaps",Type:u,DefaultValue:!1,GroupId:"Group.Environment.Debug"},{Name:"Environment.Debug.FPS",Type:u,DefaultValue:!1,GroupId:"Group.Environment.Debug"},{Name:"Render.PixelCulling",Type:h,DefaultValue:1,GroupId:"Group.Environment.Debug"},{Name:"Environment.Debug.Render.DefaultAppearanceMode",Type:d,DefaultValue:0,GroupId:"Group.Environment.Debug",MapChoice:this._generateMapChoiceFromEnumAndId(r.DefaultAppearanceMode,"")},{Name:"Viewport.DefaultAmbience",Type:d,GroupId:"Group.Environment.Debug",DefaultValue:1e4,Persistent:!0,BehaviorType:1,MapChoice:this._generateMapChoiceFromEnumAndId(S.EDefaultAmbience,""),FormatPainter:!0},{Name:"Actor.Color",visibleInPropertyGroups:!1},{Name:"Actor.Opacity",visibleInPropertyGroups:!1},{Name:"Actor.IsAlwaysOnTop",visibleInPropertyGroups:!1}];this._BuildPropertyValues(t),this.SetPropertyInvisible("Collab.ListAnchorsIDs",!0)},GetVirtualProperties:function(){var e={"Camera.Position":!0};return e},GetRequiredPropertiesForTransition:function(){var e=this.QueryInterface("VCXIViewpointController");e&&e.fromViewpoint();var t={"Camera.Position":!0,"Actor.Anchor.1":!0,"Actor.Anchor.2":!0,"Camera.Angle":!0,"Camera.Height":!0,"Camera.Ortho":!0,"Camera.Arcball":!0,"Actor.Interpolation.Type":!0,"Camera.Pitch":!0,"Camera.Roll":!0,"Camera.Roll.Angle":!0,"Camera.Yaw":!0,"Camera.LockDistCOI":!0,"Camera.DistCOI":!0};return t},SetPropertiesInfo:function(){this._parent(),this.SetPropertyInvisible("Environment.Background.Color.Opacity",-1===this.GetPropertyValue("Environment.Background.Image")),this.SetPropertyInvisible("Environment.Background.Color",!this.GetPropertyValue("Environment.Background.Override")),this.SetPropertyInvisible("Environment.Background.Color.Opacity",!this.GetPropertyValue("Environment.Background.Override")),this.SetPropertyInvisible("Environment.Background.Gradient",!this.GetPropertyValue("Environment.Background.Override")),this.SetPropertyInvisible("Environment.Background.Image",!this.GetPropertyValue("Environment.Background.Override")),this.SetPropertyInvisible("Environment.Background.Foot.Color",!this.GetPropertyValue("Environment.Background.Override")||!this.GetPropertyValue("Environment.Background.Gradient")),this.SetPropertyInvisible("Viewport.ActiveAmbience",!0);var e=this.GetObject()._experienceBase.getManager("VCXContextManager");e.isSupported("3DSync")||(this.SetPropertyInvisible("Render.ShowConstructions",!0),this.ChangeGroupAvailability("Group.Render.Lighting",i.EAvailability.AppForceAvailable)),this.SetPropertyInvisible("Render.Lighting.Intensity",!this.GetPropertyValue("Render.Lighting.Override")),this.SetPropertyInvisible("Render.Lighting.Mode",!this.GetPropertyValue("Render.Lighting.Override")),this.SetPropertyInvisible("Camera.Focal.Length",this.GetPropertyValue("Camera.Ortho")),this.SetPropertyInvisible("Camera.Height",!this.GetPropertyValue("Camera.Ortho")),e.isSupported("ViewportDebug")?(this.ChangeGroupAvailability("Group.Environment.Debug",i.EAvailability.AppForceAvailable),this.SetPropertyInvisible("Camera.Mouse.Controls.Profile",!1),this.ChangeGroupAvailability("Group.Render.Lighting",i.EAvailability.AppForceAvailable)):(this.changeMapChoice("Render.Mode",this._generateMapChoiceFromEnumAndId(g.ERenderingMode,"Render",["FlatTechnical"])),this.changeMapChoice("Render.OutlineType",this._generateMapChoiceFromEnumAndId(g.EOutlineType,"Render.OutlineType",["Smart"])),this.SetPropertyInvisible("Render.ChildrenStronger",!0),this.SetPropertyInvisible("Environment.Vignetting",!0),this.SetPropertyInvisible("Environment.Flare",!0),this.SetPropertyInvisible("Environment.DOF",!0),this.SetPropertyInvisible("Environment.Bloom",!0)),this.ChangeGroupAvailability("Group.Actions",i.EAvailability.AppForceNotAvailable)},GetProperties:function(e){var t=this.QueryInterface("VCXIViewpointController");return t&&t.fromViewpoint(),this._parent(e)},GetProperty:function(e){if("Camera.Roll.Angle"===e){if(i=this.QueryInterface("VCXIViewpointController")){var t=i.getMatrixAndDOI();return this.GetNewProperty(e,180*t.roll/Math.PI)}}else if("Camera.Position.Frame"===e||"Camera.Target.Frame"===e){var i;if(i=this.QueryInterface("VCXIViewpointController")){t=i.getMatrixAndDOI();if("Camera.Position.Frame"===e)return this.GetNewProperty(e,o.getOFromMatrix(t.matrix));if("Camera.Target.Frame"===e)return this.GetNewProperty(e,t.target)}}else{if("Camera.Focal.Length"===e){var r=this.GetPropertyValue("Camera.Angle");r/=360/Math.PI;var a=Math.tan(r),s=.5*this._fullFrameSize/a;return this.GetNewProperty(e,s)}if("Camera.Mouse.Controls.Profile"===e){var l={SIMPLE:10,COMBINED:20,CATIA:30,SWX:40},p=l[localStorage.getItem("DS_VCX_MOUSE_CONTROLS_PROFILE")];return p||(p=l.SIMPLE),this.GetNewProperty(e,p)}if("Paper.Width"===e){if(u=this.ExperienceBase.getManager("VCXPaperManager"))return this.GetNewProperty(e,u.GetWidth())}else if("Paper.Height"===e){if(u=this.ExperienceBase.getManager("VCXPaperManager"))return this.GetNewProperty(e,u.GetHeight())}else if("Paper.Orientation"===e){var u;if(u=this.GetObject()._experienceBase.getManager("VCXPaperManager"))return this.GetNewProperty(e,u.GetWidth()<u.GetHeight()?0:1)}else if("Environment.AA"===e){if(_=this.ExperienceBase.getManager("VCXContextManager").getMainViewer())return this.GetNewEnumProperty(e,e+"."+_.antiAliasing)}else if("Environment.Shadow"===e){if(_=this.ExperienceBase.getManager("VCXContextManager").getMainViewer())return this.GetNewProperty(e,_.useShadowMap)}else if("Environment.Vignetting"===e){if(_=this.ExperienceBase.getManager("VCXContextManager").getMainViewer())return this.GetNewProperty(e,_.useVignetting)}else if("Environment.DOF"===e){if(_=this.ExperienceBase.getManager("VCXContextManager").getMainViewer())return this.GetNewProperty(e,_.useDOF)}else if("Environment.Bloom"===e){if(_=this.ExperienceBase.getManager("VCXContextManager").getMainViewer())return this.GetNewProperty(e,_.useBloom)}else if("Environment.Flare"===e){if(_=this.ExperienceBase.getManager("VCXContextManager").getMainViewer())return this.GetNewProperty(e,_.useFlare)}else if("Environment.BackFaceCulling"===e){if(_=this.ExperienceBase.getManager("VCXContextManager").getMainViewer())return this.GetNewProperty(e,!1===_.renderer.disableBackFaceCulling)}else{if("Render.PixelCulling"!==e){if("Render.ShowConstructions"===e)return this.GetNewProperty(e,this.GetObject().showConstructions);if("Viewport.ActiveAmbience.IDX"===e){var h=this._Properties["Viewport.ActiveAmbience.IDX"]._propertyInfo;this._currentAmbienceIDXs=[];var c=this.ExperienceBase.ComponentsMap.GetComponentFromType("AmbienceModel_Spec");h.AddOrModifyChoice(0,"None");for(var y=0,m=0;m<c.length;m++){var C=c[m].GetID();this._currentAmbienceIDXs[m]=C,C===this.GetPropertyValue("Viewport.ActiveAmbience")&&(y=m+1);var f=C,V=c[m].QueryInterface("VCXIModifiable");if(V){var b=V.GetProperty("Actor.Name");b&&(f=b.GetPropertyValue().Value)}h.AddOrModifyChoice(m+1,f)}var P=new d(y);return new n(h,P)}return this._parent(e)}var _;if(_=this.ExperienceBase.getManager("VCXContextManager").getMainViewer())return this.GetNewProperty(e,_.currentViewpoint.camera.pixelCulling)}}},RequestModification:function(e){if(e){var t=e.GetPropertyInfo().GetPropertyName();if("Camera.Position.Frame"===t||"Camera.Target.Frame"===t){this._needToUpdateViewpoint=!0;var i=new s;if(f=this.QueryInterface("VCXIViewpointController")){var a,n,l=this.ExperienceBase.getManager("VCXVisuManager"),p=f.getMatrixAndDOI(),u=new r.Vector3(0,0,1);a="Camera.Position.Frame"===t?e.GetPropertyValue().Value:o.getOFromMatrix(p.matrix),n="Camera.Target.Frame"===t?e.GetPropertyValue().Value:p.target;var h=(new r.Vector3).subVectors(a,n),d=h.length(),c=l.getMatrixToAdjustVertical().clone().multiply(o.rotateMatrixAroundZ(o.getMatrixFromOVzVy(a,h,u),p.roll)),y=l.getMatrixToAdjustVertical().clone().multiply(o.rotateMatrixAroundZ(o.getMatrixFromOVzVy(n,h,u),p.roll));if((V=this.GetProperty("Camera.Position").Clone()).GetPropertyValue().SetValue(c),i.AddOrModifyProperty(V),(V=this.GetProperty("Actor.Anchor.2").Clone()).GetPropertyValue().GetValueFrame().SetValue(y),i.AddOrModifyProperty(V),this.GetPropertyValue("Camera.Dolly")&&!this.GetPropertyValue("Camera.Ortho")){var m=360*Math.atan(.5*p.height/d)/Math.PI;i.AddOrModifyProperty(this.GetNewProperty("Camera.Angle",m))}}return i}if("Camera.Focal.Length"===t){m=360*Math.atan(.5*this._fullFrameSize/e.GetPropertyValue().Value)/Math.PI;if((i=new s).AddOrModifyProperty(this.GetNewProperty("Camera.Angle",m)),this.GetPropertyValue("Camera.Dolly")&&!this.GetPropertyValue("Camera.Ortho")){l=this.ExperienceBase.getManager("VCXVisuManager");if(f=this.QueryInterface("VCXIViewpointController")){d=.5*(p=f.getMatrixAndDOI()).height/Math.tan(.5*m*Math.PI/180);var C=p.target.add(o.getVzFromMatrix(p.matrix).normalize().multiplyScalar(d));c=l.getMatrixToAdjustVertical().clone().multiply(p.matrix.setPosition(C));(V=this.GetProperty("Camera.Position").Clone()).GetPropertyValue().SetValue(c),i.AddOrModifyProperty(V)}}return i}if("Camera.Roll.Angle"===t){i=new s,l=this.ExperienceBase.getManager("VCXVisuManager");var f=this.QueryInterface("VCXIViewpointController");if(l&&f){p=f.getMatrixAndDOI();var V,b=o.getMatrixFromOVzVy(o.getOFromMatrix(p.matrix),o.getVzFromMatrix(p.matrix),new r.Vector3(0,0,1));c=l.getMatrixToAdjustVertical().clone().multiply(o.rotateMatrixAroundZ(b,e.GetPropertyValue().Value*Math.PI/180));(V=this.GetProperty("Camera.Position").Clone()).GetPropertyValue().SetValue(c),i.AddOrModifyProperty(V)}return i}if("Viewport.ActiveAmbience.IDX"===t){i=new s;var P=e.GetPropertyValue().Value-1;if(this._currentAmbienceIDXs&&P>=0){var _=this._currentAmbienceIDXs[P];i.AddOrModifyProperty(this.GetNewProperty("Viewport.ActiveAmbience",_))}else i.AddOrModifyProperty(this.GetNewProperty("Viewport.ActiveAmbience",""));return i}if("Paper.Orientation"===t){i=this._parent(e);var g=(M=this.GetObject()._experienceBase.getManager("VCXPaperManager")).GetWidth(),S=M.GetHeight();return(0===e.GetPropertyValue().Value&&S<g||1===e.GetPropertyValue().Value&&S>g)&&(i.AddOrModifyProperty(this.GetNewProperty("Paper.Width",S)),i.AddOrModifyProperty(this.GetNewProperty("Paper.Height",g))),i}if("Paper.Width"===t||"Paper.Height"===t){var M;i=this._parent(e),g=(M=this.GetObject()._experienceBase.getManager("VCXPaperManager")).GetWidth(),S=M.GetHeight();if("Paper.Width"===t?(g=e.GetPropertyValue().Value,i.AddOrModifyProperty(this.GetNewProperty("Paper.Height",S))):(S=e.GetPropertyValue().Value,i.AddOrModifyProperty(this.GetNewProperty("Paper.Width",g))),S<g&&0===this.GetProperty("Paper.Orientation").GetPropertyValue().Value||S>g&&1===this.GetProperty("Paper.Orientation").GetPropertyValue().Value){var D=this.GetProperty("Paper.Orientation").GetPropertyValue().Value?0:1;i.AddOrModifyProperty(this.GetNewProperty("Paper.Orientation",D))}return i}}return this._parent(e)},OnChangeProperty:function(e,t,i){if(i||(i={}),i.fromChildClass);else if(this.OnChangePropertyBegin(e,t))return!0;i.fromChildClass=!0,this._parent(e,t,i);var r=this.ExperienceBase.getManager("VCXContextManager");if("Camera.Mouse.Controls.Profile"===e){var a={10:"SIMPLE",20:"COMBINED",30:"CATIA",40:"SWX"};localStorage.setItem("DS_VCX_MOUSE_CONTROLS_PROFILE",a[t.Value]),this.ExperienceBase.getManager("VCXVisuManager").SetController(a[t.Value])}else if("Paper.Width"===e)this._paperRequestedWidth=t;else if("Paper.Height"===e)this._paperRequestedHeight=t;else if("Environment.AA"===e){var o=this.GetProperty(e).GetPropertyInfo().GetMapChoiceEnum()[t.Value];o&&(this._requestedAA=o.split(".").pop())}else"Environment.SSAO"===e?this._requestedSSAO=t.Value:"Environment.Mirror"===e?r.applyToViewers(function(e){e.setMirror(t.Value)}):"Environment.Shadow"===e?r.applyToViewers(function(e){e.setShadow(t.Value)}):"Environment.Vignetting"===e?r.applyToViewers(function(e){e.setVignetting(t.Value)}):"Environment.DOF"===e?r.applyToViewers(function(e){e.setDOF(t.Value)}):"Environment.Bloom"===e?r.applyToViewers(function(e){e.setBloom(t.Value)}):"Environment.Flare"===e?r.applyToViewers(function(e){e.setFlare(t.Value)}):"Environment.BackFaceCulling"===e?r.applyToViewers(function(e){e.setDisableBackFaceCulling(!1===t.Value)}):"Render.PixelCulling"===e?r.applyToViewers(function(e){e.currentViewpoint.setPixelCulling(t.Value)}):"Render.ShowConstructions"===e?this._requestedShowConstructions=t.Value:"Environment.Debug.ShadowLight"===e?r.applyToViewers(function(e){e.debugShadowLight=t.Value}):"Environment.Debug.BSphere"===e?r.applyToViewers(function(e){e.debugBSphere=t.Value}):"Environment.Debug.PrimitiveBSphere"===e?r.applyToViewers(function(e){e.debugPrimitiveBSphere=t.Value}):"Environment.Debug.RepBBox"===e?r.applyToViewers(function(e){e.debugRepBBox=t.Value}):"Environment.Debug.Picking"===e?r.applyToViewers(function(e){e.debugPicking=t.Value}):"Environment.Debug.Normals"===e?r.applyToViewers(function(e){e.debugNormals=t.Value}):"Environment.Debug.BackfaceCulling"===e?r.applyToViewers(function(e){e.debugBackfaceCulling=t.Value}):"Environment.Debug.PickHybrid"===e?r.applyToViewers(function(e){e.debugPickHybrid=t.Value}):"Environment.Debug.PostProcessing"===e?r.applyToViewers(function(e){e.setDebugPostProcessing(t.Value)}):"Environment.Debug.ShadowMaps"===e?r.applyToViewers(function(e){e.setDebugShadowMaps(t.Value)}):"Environment.Debug.Render.DefaultAppearanceMode"===e?r.applyToViewers(function(e){e.setVisuAppearanceMode(t.Value)}):"Environment.Debug.FPS"===e||("Render.Mode"===e?this._requestedRenderMode=t.Value:"Render.OutlineType"===e&&(this._requestedOutlineType=t.Value))},OnChangePropertiesEnd:function(){if(this._parent(),this._requestedAA||this._requestedSSAO){var i=this._requestedAA||this.GetPropertyValue("Environment.AA"),r=this._requestedSSAO||this.GetPropertyValue("Environment.SSAO"),o=r!==e.ESSAO.NoSSAO,s=o&&"MSAA"===i,p=r===e.ESSAO.Always;(V=this.ExperienceBase.getManager("VCXContextManager")).applyToViewers(function(e){e.setAntiAliasing(i),e.setSSAO(o,"static"),e.setIterativeSSAO(s),e.setSSAO(p,"dynamic")})}if(this._requestedRenderMode!==this.GetObject().renderMode||this._requestedOutlineType!==this.GetObject().outlineType||this._requestedShowConstructions!==this.GetObject().showConstructions||this._forceRefresh){this.GetObject().renderMode=this._requestedRenderMode,this.GetObject().outlineType=this._requestedOutlineType,this.GetObject().showConstructions=this._requestedShowConstructions;var h=this.GetObject().renderMode,d=this.GetObject().outlineType,c=this.GetObject().showConstructions;(V=this.ExperienceBase.getManager("VCXContextManager")).getRootComponent().setDirtyFlag&&V.getRootComponent().setDirtyFlag(g.FDirty.RenderingMode),V.traverseGraphMustBePerformed=!0;var y=this.ExperienceBase.getManager("VCXVisuManager"),m=this.ExperienceBase.ComponentsMap.GetComponentFromType("VCXWebComponentOccurrence"),C=this.ExperienceBase.getManager("VCXMaterialManager").getRenderStyle(h,d,c);V.applyToViewers(function(e){switch(e.setRenderStyle(C),h){case g.ERenderingMode.Smooth:case g.ERenderingMode.SmoothOutline:e.setRenderPriority&&e.setRenderPriority(!1),e.setRenderPriority&&e.setRenderPriorityDefaultOpacity(1);break;case g.ERenderingMode.Custom:y&&y.dirtifyRenderPriority()}if(!V.useTraverseGraph)for(var t=0;t<m.length;++t){var i=m[t],r=i.QueryInterface("VCXIModifiable");r&&(i.setDirtyFlag(g.FDirty.RenderingMode,!0),r.applyChanges&&r.applyChanges())}}),t.publish({event:"VCX_ENVIRONNEMENT_PROPERTY_CHANGED"})}if(this._paperRequestedWidth||this._paperRequestedHeight||this._paperRequestedVisibility){var f=this.ExperienceBase.getManager("VCXPaperManager");f&&(this._paperRequestedWidth&&(this._paperRequestedWidth.Value!==f.GetWidth()||this._forceRefresh)&&(f.SetWidth(this._paperRequestedWidth.Value),this._paperRequestedWidth=null),this._paperRequestedHeight&&(this._paperRequestedHeight.Value!==f.GetHeight()||this._forceRefresh)&&(f.SetHeight(this._paperRequestedHeight.Value),this._paperRequestedHeight=null),f.updatePaper({propagateEvent:!0}))}var V;if((V=this.ExperienceBase.getManager("VCXContextManager"))&&(this._previousEnvMapStr=this._envMapStr,this._previousShowEnv=this._showEnv),this._previousVertical!==this.GetPropertyValue("Environment.Vertical")||this._forceRefresh){this._previousVertical=this.GetPropertyValue("Environment.Vertical"),this.ExperienceBase.getManager("VCXVisuManager").setVertical(this.GetPropertyValue("Environment.Vertical"));var b=this.ExperienceBase.getManager("VCXVisuManager").getInverseMatrixToAdjustVertical();this.ExperienceBase.getManager("VCXContextManager").getRootNode().setMatrix(b);var P=this.ExperienceBase.ComponentsMap.GetComponentFromType("CXPCameraActor_Spec")[this.GetPropertyValue("Viewport.ActiveCamera")];P&&P.updatePosition()}if(this._previousActiveAmbience!==this.GetPropertyValue("Viewport.ActiveAmbience")||this._previousDefaultAmbience!==this.GetPropertyValue("Viewport.DefaultAmbience")){var _=this.ExperienceBase.ComponentsMap.GetComponentFromID(this._previousActiveAmbience);if(_&&"AmbienceModel_Spec"===_.GetType()&&_.update(),(_=this.ExperienceBase.ComponentsMap.GetComponentFromID(this.GetPropertyValue("Viewport.ActiveAmbience")))&&"AmbienceModel_Spec"===_.GetType()&&_.update(),this._previousActiveAmbience=this.GetPropertyValue("Viewport.ActiveAmbience"),this._previousDefaultAmbience=this.GetPropertyValue("Viewport.DefaultAmbience"),!_)(y=this.ExperienceBase.getManager("VCXVisuManager")).activateDefaultAmbience(this.GetPropertyValue("Viewport.DefaultAmbience"))}if(this._previousActiveCam!==this.GetPropertyValue("Viewport.ActiveCamera")||this._forceRefresh){this._previousActiveCam=this.GetPropertyValue("Viewport.ActiveCamera");var S=this.ExperienceBase.ComponentsMap.GetComponentFromType("CXPCameraActor_Spec")[this.GetPropertyValue("Viewport.ActiveCamera")];if(S){var M=S.QueryInterface("VCXIModifiable"),D=new a,G=new n(new l("Actor.IsActive",2),new u(!0));D.ChangeProperty(M,G),this.ExperienceBase.getManager("VCXCommandManager").Do(D),S.updatePosition()}}var v=this.QueryInterface("VCXIViewpointController");this._needToUpdateViewpoint&&(this._needToUpdateViewpoint=!1,v.toViewpoint()),v&&!this.ExperienceBase.getManager("VCXVisuManager").CameraControlsViewpoint&&(v.resetMatrixAndDOI(),v.toViewpoint())},GetInterpolator:function(e){var t=this.QueryInterface("VCXIViewpointController");if(t)return t.GetInterpolator(e)}})}),define("DS/VCXWebDressup/VCXAmbienceModifiable",["DS/VCXWebDressup/VCXDressupModifiable","DS/CoreEvents/Events","DS/VCXWebDressup/VCXViewport_Spec","DS/VCXWebKernelCommands/VCXCmdChangePropertiesAutokey","DS/VCXWebProperties/VCXPropertySet","DS/VCXWebProperties/VCXProperty","DS/VCXWebProperties/VCXPropertyInfo","DS/VCXWebProperties/VCXPropertyValueString","DS/VCXWebProperties/VCXPropertyValueBoolean","DS/VCXWebProperties/VCXPropertyValueFloat","DS/VCXWebProperties/VCXPropertyValueColor","DS/VCXWebProperties/VCXPropertyValuePoint","DS/VCXWebProperties/VCXPropertyValueEnum","DS/VCXWebProperties/VCXColor","DS/Visualization/ThreeJS_DS"],function(e,t,i,r,a,o,s,n,l,p,u,h,d,c,y){"use strict";return e.extend({init:function(){this._parent(),this._bIsGround=!0,this._envMapNeverLoaded=!1},Build:function(){this._parent();var e=[{Name:"Actor.Opacity",visibleInPropertyGroups:!1},{Name:"Ambience.Lighting.Exposure",Type:p,DefaultValue:0,Bounds:{Min:-9,Max:9,Step:.1},GroupId:"Group.Ambience.Lighting",FormatPainter:!0},{Name:"Ambience.Lighting.Rotation",Type:p,DefaultValue:0,Bounds:{Min:-180,Max:180,Step:1},GroupId:"Group.Ambience.Lighting",FormatPainter:!0},{Name:"Ambience.Background.Show",Type:l,DefaultValue:!0,ControlsGroupVisibility:!0,GroupId:"Group.Ambience.Background",FormatPainter:!0},{Name:"Ambience.Background.Finite",Type:l,DefaultValue:!0,GroupId:"Group.Ambience.Background",FormatPainter:!0},{Name:"Ambience.Background.Radius.Auto",Type:l,DefaultValue:!0,GroupId:"Group.Ambience.Background",FormatPainter:!0},{Name:"Ambience.Background.Radius",Type:p,DefaultValue:15e3,GroupId:"Group.Ambience.Background",FormatPainter:!0},{Name:"Ambience.Background.Rotation",Type:p,DefaultValue:0,Bounds:{Min:-180,Max:180,Step:1},GroupId:"Group.Ambience.Background",FormatPainter:!0,visibleInPropertyGroups:!1},{Name:"Ambience.Background.Position.Auto",Type:l,DefaultValue:!0,GroupId:"Group.Ambience.Background",FormatPainter:!0},{Name:"Ambience.Background.Position",Type:h,DefaultValue:new y.Vector3,GroupId:"Group.Ambience.Background",FormatPainter:!0},{Name:"Ambience.Background.Exposure",Type:p,DefaultValue:0,Bounds:{Min:-9,Max:9,Step:.1},GroupId:"Group.Ambience.Background",FormatPainter:!0,visibleInPropertyGroups:!1},{Name:"Ambience.Ground.Scaleratio",Type:p,DefaultValue:.8,Bounds:{Min:.01,Max:6,Step:.1},GroupId:"Group.Ambience.Ground",FormatPainter:!0},{Name:"Ambience.Ground.Offset",Type:p,DefaultValue:0,GroupId:"Group.Ambience.Ground",FormatPainter:!0},{Name:"Ambience.Ground.Reflectivity",Type:p,DefaultValue:0,Bounds:{Min:0,Max:100,Step:.1},GroupId:"Group.Ambience.Ground",FormatPainter:!0},{Name:"Ambience.Ground.Glossiness",Type:p,DefaultValue:0,Bounds:{Min:0,Max:100,Step:.1},GroupId:"Group.Ambience.Ground",FormatPainter:!0},{Name:"Ambience.Ground.ShadowIntensity",Type:p,DefaultValue:0,Bounds:{Min:0,Max:100,Step:.1},GroupId:"Group.Ambience.Ground",FormatPainter:!0}];this._BuildPropertyValues(e)},OnChangePropertiesEnd:function(){t.publish({event:"VCX_ENVIRONNEMENT_PROPERTY_CHANGED"}),this._parent()},SetPropertiesInfo:function(){this._parent(),this.SetPropertyInvisible("Actor.Color",!0),this.GetProperty("Actor.Color").GetPropertyInfo()._bPersistent=!1,this.SetPropertyInvisible("Actor.Color.Defined",!0),this.GetProperty("Actor.Color.Defined").GetPropertyInfo()._bPersistent=!1,this.SetPropertyInvisible("Actor.Opacity",!0),this.GetProperty("Actor.Opacity").GetPropertyInfo()._bPersistent=!1,this.SetPropertyInvisible("Actor.IsAlwaysOnTop",!0),this.GetProperty("Actor.IsAlwaysOnTop").GetPropertyInfo()._bPersistent=!1,this.GetPropertyValue("Ambience.Background.Finite")?(this.SetPropertyInvisible("Ambience.Background.Position.Auto",!1),this.SetPropertyInvisible("Ambience.Background.Radius.Auto",!1),this.SetPropertyInvisible("Ambience.Background.Position",this.GetPropertyValue("Ambience.Background.Position.Auto")),this.SetPropertyInvisible("Ambience.Background.Radius",this.GetPropertyValue("Ambience.Background.Radius.Auto"))):(this.SetPropertyInvisible("Ambience.Background.Position.Auto",!0),this.SetPropertyInvisible("Ambience.Background.Radius.Auto",!0),this.SetPropertyInvisible("Ambience.Background.Position",!0),this.SetPropertyInvisible("Ambience.Background.Radius",!0)),this.ChangeGroupAvailability("Group.Actions",e.EAvailability.AppForceNotAvailable)},RequestModification:function(e){if(e){var t,i=e.GetPropertyInfo().GetPropertyName();if("Ambience.Lighting.Exposure"===i)return(t=this._parent(e)).AddOrModifyProperty(this.GetNewProperty("Ambience.Background.Exposure",e.GetPropertyValue().Value)),t;if("Ambience.Background.Exposure"===i)return(t=this._parent(e)).AddOrModifyProperty(this.GetNewProperty("Ambience.Lighting.Exposure",e.GetPropertyValue().Value)),t;if("Ambience.Lighting.Rotation"===i)return(t=this._parent(e)).AddOrModifyProperty(this.GetNewProperty("Ambience.Background.Rotation",e.GetPropertyValue().Value)),t;if("Ambience.Background.Rotation"===i)return(t=this._parent(e)).AddOrModifyProperty(this.GetNewProperty("Ambience.Lighting.Rotation",e.GetPropertyValue().Value)),t}return this._parent(e)}})}),define("DS/VCXWebDressup/VCXArrowModifiable",["DS/VCXWebDressup/VCXDressupModifiable","DS/VCXWebComponents/VCXWebComponentOccurrence","DS/VCXWebDressup/VCXArrow_Spec","DS/VCXWebKernelTools/VCXMathTools","DS/VCXWebProperties/VCXColor","DS/VCXWebProperties/VCXProperty","DS/VCXWebProperties/VCXPropertySet","DS/VCXWebProperties/VCXPropertyValueBoolean","DS/VCXWebProperties/VCXPropertyValueEnum","DS/VCXWebProperties/VCXPropertyValueFloat","DS/VCXWebProperties/VCXPropertyValueColor","DS/VCXWebProperties/VCXPropertyValueVector","i18n!DS/VCXWebDressup/assets/nls/VCXWebDressup","i18n!DS/VCXWebModifiables/assets/nls/VCXWebModifiables"],function(e,t,i,r,a,o,s,n,l,p,u,h,d,c){"use strict";return e.extend({init:function(){this._bIsArrow=!0,this._parent()},Build:function(){this._parent();var e=[{Name:"Collab.Is.Paper",Type:n,DefaultValue:!0,GroupId:"Group.Arrow"},{Name:"Arrow.Scale",Type:p,DefaultValue:1,GroupId:"Group.Arrow",visibleInPropertyGroups:!1},{Name:"Collab.Border.Show",Type:n,DefaultValue:!0,ControlsGroupVisibility:!0,GroupId:"Group.Border",visibleInPropertyGroups:!1,FormatPainter:!0},{Name:"Collab.Border.Line.Width",Type:p,DefaultValue:1,GroupId:"Group.Border",FormatPainter:!0},{Name:"Collab.Border.Line.Type",Type:l,DefaultValue:t.ELineType.Plain,GroupId:"Group.Border",MapChoice:this._generateMapChoiceFromEnumAndId(t.ELineType,"Collab.DashType",["UserDefined","Advanced"]),FormatPainter:!0},{Name:"Arrow.Body.Color",Type:u,DefaultValue:(new a).FromRGBA(.9294117647058824,.3176470588235294,.3176470588235294,1),GroupId:"Group.Arrow.Head",FormatPainter:!0},{Name:"Arrow.Body.Color.Opacity",Type:p,DefaultValue:1,Bounds:{Min:0,Max:1,Step:.01},GroupId:"Group.Arrow.Head",FormatPainter:!0},{Name:"Arrow.Width.1",Type:p,DefaultValue:5,GroupId:"Group.Arrow.Head"},{Name:"Arrow.Head.ShowMode",Type:n,DefaultValue:!0,GroupId:"Group.Arrow.Head",FormatPainter:!0},{Name:"Arrow.Head.Length",Type:p,DefaultValue:10,GroupId:"Group.Arrow.Head",FormatPainter:!0},{Name:"Arrow.Head.Size",Type:p,DefaultValue:4,GroupId:"Group.Arrow.Head",FormatPainter:!0},{Name:"Arrow.Head.Shape",Type:p,DefaultValue:0,GroupId:"Group.Arrow.Head",FormatPainter:!0},{Name:"Collab.Border.Line.Color",Type:u,DefaultValue:(new a).FromRGBA(.6431372549019608,.1686274509803922,.1568627450980392,1),GroupId:"Group.Border",FormatPainter:!0},{Name:"Collab.Border.Line.Color.Opacity",Type:p,DefaultValue:1,Bounds:{Min:0,Max:1,Step:.01},GroupId:"Group.Border",FormatPainter:!0},{Name:"Arrow.Body.2.Color",Type:u,DefaultValue:(new a).FromRGBA(.9294117647058824,.3176470588235294,.3176470588235294,.5),GroupId:"Group.Arrow.Head.2",FormatPainter:!0},{Name:"Arrow.Body.2.Color.Opacity",Type:p,DefaultValue:1,Bounds:{Min:0,Max:1,Step:.01},GroupId:"Group.Arrow.Head.2",FormatPainter:!0},{Name:"Arrow.Width.2",Type:p,DefaultValue:5,GroupId:"Group.Arrow.Head.2"},{Name:"Arrow.Head.2.ShowMode",Type:n,DefaultValue:!1,GroupId:"Group.Arrow.Head.2",FormatPainter:!0},{Name:"Arrow.Head.2.Length",Type:p,DefaultValue:10,GroupId:"Group.Arrow.Head.2",FormatPainter:!0},{Name:"Arrow.Head.2.Size",Type:p,DefaultValue:4,GroupId:"Group.Arrow.Head.2",FormatPainter:!0},{Name:"Arrow.Head.2.Shape",Type:p,DefaultValue:0,GroupId:"Group.Arrow.Head.2",FormatPainter:!0},{Name:"Collab.Border.Line.2.Color",Type:u,DefaultValue:(new a).FromRGBA(.6431372549019608,.1686274509803922,.1568627450980392,1),GroupId:"Group.Border",FormatPainter:!0},{Name:"Collab.Border.Line.2.Color.Opacity",Type:p,DefaultValue:1,Bounds:{Min:0,Max:1,Step:.01},GroupId:"Group.Border",FormatPainter:!0},{Name:"Collab.ListAnchorsIDs",Type:h,DefaultValue:[],visibleInPropertyGroups:!1}];this._BuildPropertyValues(e)},SetPropertiesInfo:function(){this._parent(),this.GetProperty("Actor.Color").GetPropertyInfo()._bPersistent=!1,this.GetProperty("Actor.Color").GetPropertyInfo().Seti18nGroup(d),this.GetProperty("Actor.Color").GetPropertyInfo().Seti18n(c),this.SetPropertyInvisible("Actor.Color",!1),this.SetPropertyInvisible("Arrow.Head.Length",!1===this.GetPropertyValue("Arrow.Head.ShowMode")),this.SetPropertyInvisible("Arrow.Head.Size",!1===this.GetPropertyValue("Arrow.Head.ShowMode")),this.SetPropertyInvisible("Arrow.Head.Shape",!1===this.GetPropertyValue("Arrow.Head.ShowMode")),this.SetPropertyInvisible("Arrow.Head.2.Length",!1===this.GetPropertyValue("Arrow.Head.2.ShowMode")),this.SetPropertyInvisible("Arrow.Head.2.Size",!1===this.GetPropertyValue("Arrow.Head.2.ShowMode")),this.SetPropertyInvisible("Arrow.Head.2.Shape",!1===this.GetPropertyValue("Arrow.Head.2.ShowMode")),this.SetPropertyInvisible("Arrow.Head.2.Shape",!1===this.GetPropertyValue("Arrow.Head.2.ShowMode")),this.SetPropertyInvisible("Arrow.Head.2.Shape",!1===this.GetPropertyValue("Arrow.Head.2.ShowMode")),this.SetPropertyInvisible("Collab.Border.Line.Color",!1===this.GetPropertyValue("Collab.Border.Show")),this.SetPropertyInvisible("Collab.Border.Line.Color.Opacity",!1===this.GetPropertyValue("Collab.Border.Show")),this.SetPropertyInvisible("Collab.Border.Line.2.Color",!1===this.GetPropertyValue("Collab.Border.Show")),this.SetPropertyInvisible("Collab.Border.Line.2.Color.Opacity",!1===this.GetPropertyValue("Collab.Border.Show")),this.SetPropertyInvisible("Collab.ListAnchorsIDs",!0)},GetProperty:function(e){return"Actor.Color"===e?this.GetNewProperty(e,this.GetPropertyValue("Arrow.Body.Color")):this._parent(e)},getScaledDimensions:function(e){var t=this.ExperienceBase.getManager("VCXPaperManager"),i=[{idx:0},{idx:this.GetPropertyValue("Arrow.Head.2.Position.Is.Paper")?0:1}];i.forEach(i=>{if(this.GetPropertyValue("Collab.Is.Paper")===e)i.scaleToApply=1;else{var a=r.getOFromMatrix(this.GetAnchorWorldMatrix(i.idx)),o=t.GetPaperRatio(null,a),s=1;e?s/=o:s*=o,i.scaleToApply=s}});var a={};return[{idx:0,propertyName:"Arrow.Length"},{idx:0,propertyName:"Arrow.Width.1"},{idx:0,propertyName:"Arrow.Head.Length"},{idx:0,propertyName:"Arrow.Head.Size"},{idx:0,propertyName:"Arrow.Head.Shape"},{idx:1,propertyName:"Arrow.Width.2"},{idx:1,propertyName:"Arrow.Head.2.Length"},{idx:1,propertyName:"Arrow.Head.2.Size"},{idx:1,propertyName:"Arrow.Head.2.Shape"}].forEach(e=>{var t=this.GetPropertyValue(e.propertyName);t*=i[e.idx].scaleToApply,a[e.propertyName]=t}),a},RequestModification:function(e){if(e){var t=e.GetPropertyInfo().GetPropertyName();if("Actor.Color"===t){var i=new s,r=e.GetPropertyValue().Value.getAssociatedColors();return i.AddOrModifyProperty(this.GetNewProperty("Arrow.Body.Color",r.body)),i.AddOrModifyProperty(this.GetNewProperty("Arrow.Body.2.Color",r.body)),i.AddOrModifyProperty(this.GetNewProperty("Collab.Border.Line.Color",r.border)),i.AddOrModifyProperty(this.GetNewProperty("Collab.Border.Line.2.Color",r.border)),i}if(t.includes("Collab.Border.Line")&&t.includes("Color")){i=new s;var a="Collab.Border.Line"+(t.includes("2")?"":".2")+".Color"+(t.includes(".Opacity")?".Opacity":"");return i.AddOrModifyProperty(this.GetNewProperty(t,e.GetPropertyValue().Value)),i.AddOrModifyProperty(this.GetNewProperty(a,e.GetPropertyValue().Value)),i}if("Collab.Is.Paper"===t){i=this._parent(e);var o=this.getScaledDimensions(e.GetPropertyValue().Value);for(let e in o)i.AddOrModifyProperty(this.GetNewProperty(e,o[e]));return i}return this._parent(e)}}})}),define("DS/VCXWebDressup/VCXArrowCornerModifiable",["DS/VCXWebDressup/VCXArrowModifiable","DS/Visualization/ThreeJS_DS","DS/VCXWebProperties/VCXPropertyValueFloat","DS/VCXWebProperties/VCXPropertyValueFrame","DS/VCXWebProperties/VCXPropertyValueAnchor","DS/VCXWebProperties/VCXPropertyValueVector"],function(e,t,i,r,a,o){"use strict";return e.extend({init:function(){this._parent(),this._handleAnchor=null},Build:function(){this._parent();var e=[{Name:"Arrow.Corner.Length.1",Type:i,DefaultValue:50,GroupId:"Group.Arrow"},{Name:"Arrow.Corner.Length.2",Type:i,DefaultValue:50,GroupId:"Group.Arrow"},{Name:"Actor.Anchor.0",Type:a,DefaultValue:(new a).SetValueFrame((new r).SetValueFromVector(new t.Vector3(0,0,0))).GetValue(),GroupId:"Group.Arrow"},{Name:"Collab.ListAnchorsIDs",Type:o,DefaultValue:[0]}];this._BuildPropertyValues(e)}})}),define("DS/VCXWebDressup/VCXArrowLinearModifiable",["DS/VCXWebDressup/VCXArrowModifiable","DS/Visualization/ThreeJS_DS","DS/VCXWebProperties/VCXPropertyValueBoolean","DS/VCXWebProperties/VCXPropertyValueFloat","DS/VCXWebProperties/VCXPropertyValueFrame","DS/VCXWebProperties/VCXPropertyValueAnchor","DS/VCXWebProperties/VCXPropertyValueVector"],function(e,t,i,r,a,o,s){"use strict";return e.extend({init:function(){this._parent()},Build:function(){this._parent();var e=[{Name:"Arrow.Fixed.Length",Type:i,DefaultValue:!1,GroupId:"Group.Arrow"},{Name:"Arrow.Length",Type:r,DefaultValue:20,GroupId:"Group.Arrow"},{Name:"Arrow.Billboarded",Type:i,DefaultValue:!0,GroupId:"Group.Arrow",FormatPainter:!0},{Name:"Arrow.ZRotation",Type:r,DefaultValue:90,Bounds:{Min:0,Max:180,Step:1},GroupId:"Group.Arrow",visibleInPropertyGroups:!1},{Name:"Actor.Anchor.0",Type:o,DefaultValue:(new o).SetValueFrame((new a).SetValueFromVector(new t.Vector3(0,0,0))).GetValue(),GroupId:"Group.Arrow.Head",visibleInPropertyGroups:!1},{Name:"Actor.Anchor.1",Type:o,DefaultValue:(new o).SetValueFrame((new a).SetValueFromVector(new t.Vector3(1,1,1))).GetValue(),GroupId:"Group.Arrow.Head.2",visibleInPropertyGroups:!1},{Name:"Arrow.Head.2.Position.Is.Paper",Type:i,DefaultValue:!1,GroupId:"Group.Arrow.Head.2",visibleInPropertyGroups:!1},{Name:"Arrow.Head.2.Position.X",Type:r,DefaultValue:0,GroupId:"Group.Arrow.Head.2",visibleInPropertyGroups:!1},{Name:"Arrow.Head.2.Position.Y",Type:r,DefaultValue:0,GroupId:"Group.Arrow.Head.2",visibleInPropertyGroups:!1},{Name:"Collab.ListAnchorsIDs",Type:s,DefaultValue:[0,1]}];this._BuildPropertyValues(e)},SetPropertiesInfo:function(){this._parent(),this.SetPropertyInvisible("Arrow.Length",!this.GetPropertyValue("Arrow.Fixed.Length")),this.SetPropertyInvisible("Arrow.Head.2.Position.Is.Paper",!0),this.SetPropertyInvisible("Arrow.Head.2.Position.X",!0),this.SetPropertyInvisible("Arrow.Head.2.Position.Y",!0);var e=this.GetProperty("Actor.Anchor.1")&&this.GetProperty("Actor.Anchor.1").GetPropertyValue()&&this.GetProperty("Actor.Anchor.1").GetPropertyValue().GetValueLink()&&this.GetProperty("Actor.Anchor.1").GetPropertyValue().GetValueLink().Value;this.SetPropertyInvisible("Arrow.Billboarded",!e),this.SetPropertyInvisible("Arrow.ZRotation",!(e&&!this.GetPropertyValue("Arrow.Billboarded")))}})}),define("DS/VCXWebDressup/VCXAttachSegmentNode",["DS/Mesh/MeshUtils","DS/VCXWebDressup/VCXMarkup_Spec","DS/VCXWebComponents/VCXWebComponentOccurrence","DS/VCXWebDressup/VCXDressup_Spec","DS/VCXWebDressup/VCXDressupNode","DS/VCXWebDressup/VCXExtremityNode","DS/VCXWebKernelTools/VCXMathTools","DS/Visualization/SceneGraphFactory","DS/Visualization/ThreeJS_DS"],function(e,t,i,r,a,o,s,n,l){"use strict";var p=a.extend({init:function(e){return this._parent(e),this.anchorID=e.anchorID,this._StartExtremity=new l.Vector3,this._BreakExtremity=new l.Vector3,this._EndExtremity=new l.Vector3,this._EndExtremityType=t.EExtremityType.Dot,e&&"number"==typeof e.endExtremityType&&(this._EndExtremityType=e.endExtremityType),this},_ComputePosBuffer:function(e){return e[0]=this.StartExtremity.x,e[1]=this.StartExtremity.y,e[2]=this.StartExtremity.z,e[3]=this.BreakExtremity.x,e[4]=this.BreakExtremity.y,e[5]=this.BreakExtremity.z,e[6]=this.EndExtremity.x,e[7]=this.EndExtremity.y,e[8]=this.EndExtremity.z,3},dispose:function(){this._Node&&this.removeChild(this._Node),this._ExtremityNode&&(this._ExtremityNode.dispose(),this.removeChild(this._ExtremityNode)),this._ExtremityStart&&(this._ExtremityStart.dispose(),this.removeChild(this._ExtremityStart)),this._ExtremityBreak&&(this._ExtremityBreak.dispose(),this.removeChild(this._ExtremityBreak)),this._parent()},_Build:function(){this._PrimitiveGroup=new e.PrimitiveGroup({editable:!0,lineGAS:new e.LineAttributes(this.GetColorPropertyValue("Collab.Attach.Line").GetThreeColor(),this.GetPropertyValue("Collab.Attach.Line.Width"))});var i=new e.Buffer({component:e.VertexComponentEnum.POSITION,data:new Float32Array(9),dimension:3}),r=new e.Buffer({indexBuffer:!0,data:new Uint16Array(4)});this._PrimitiveGroup.addBuffer(0,i),this._PrimitiveGroup.addBuffer(1,r),this._ComputePosBuffer(i.data);var a=r.data;a[0]=0,a[1]=1,a[2]=1,a[3]=2;var s=new e.VertexComponent({bufferId:0,indices:new e.IndexArray({bufferId:1,offset:0})}),l=new e.Primitive({nbIndices:4,connectivity:e.ConnectivityTypeEnum.LINES,fillGAS:new e.FillAttributes(this.GetColorPropertyValue("Collab.Attach.Line").GetThreeColor()),lineGAS:new e.LineAttributes(this.GetColorPropertyValue("Collab.Attach.Line").GetThreeColor(),this.GetPropertyValue("Collab.Attach.Line.Width"))});l.addVertexComponent(s),this._PrimitiveGroup.addPrimitive(l);var p=this.Modifiable.getLineMaterialParams("Collab.Attach.Line",this._lineMaterial,this._lastFrontLineType);if(Object.keys(p).length>0&&("number"==typeof p.type&&p.type!==this._lastFrontLineType&&(this._lastFrontLineType=p.type),this._lineMaterial=this.ExperienceBase.getManager("VCXMaterialManager").getLineMaterialFromParams(p,this._lineMaterial)),this._Node=n.createMeshNode(this._PrimitiveGroup,this._lineMaterial),this.add(this._Node),this.GetPropertyValue("Collab.Attach.BentDot")){var u={name:this.name+" ExtremityBreak",experience:this.ExperienceBase,modifiable:this.Modifiable,anchorID:this.anchorID,type:t.EExtremityType.Dot};this._ExtremityBreak=new o(u),this.add(this._ExtremityBreak)}this.handleLayers(!0)},preRender:function(t){if(this._parent(t),this._lineMaterial){this._lineMaterial.handleByPrerender=!0;let e=this.ExperienceBase.getManager("VCXPaperManager").UnitValueToPixel(this.Modifiable.GetPropertyValue("Collab.Attach.Line.Width"));e>=1?(this._lineMaterial.setLineWidth(e),this._lineMaterial.visible=!0):this._lineMaterial.visible=!1}if(this._Node){var i=this._Node.getBuffer(e.VertexComponentEnum.POSITION);if(void 0!==i){var r=this._ComputePosBuffer(i);this._Node.updateBuffer(e.VertexComponentEnum.POSITION,0,r),this._Node.computeBoundingElements()}}if(this._ExtremityNode){var a=(new l.Vector3).subVectors(this.EndExtremity,this.BreakExtremity);this._ExtremityNode.SetReferential(s.getMatrixFromOVx(this.EndExtremity,a)),this._ExtremityNode.preRender(t)}if(this._ExtremityStart){a=(new l.Vector3).subVectors(this.BreakExtremity,this.StartExtremity);this._ExtremityStart.SetReferential(s.getMatrixFromOVx(this.StartExtremity,a)),this._ExtremityStart.preRender(t)}if(this._ExtremityBreak){a=(new l.Vector3).subVectors(this.BreakExtremity,this.StartExtremity);this._ExtremityBreak.SetReferential(s.getMatrixFromOVx(this.BreakExtremity,a)),this._ExtremityBreak.preRender(t)}},update:function(e){if(this._parent(),this._globalOpacity!==this.GlobalOpacity){this._globalOpacity=this.GlobalOpacity;var t=this._globalOpacity>0;t&&(this._Node||this._Build()),this._Node&&this._Node.setVisibility(t),this._ExtremityNode&&this._ExtremityNode.setVisibility(t),this._ExtremityBreak&&this._ExtremityBreak.setVisibility(t),this._ExtremityEnd&&this._ExtremityEnd.setVisibility(t)}if(!(this._globalOpacity<=0)){if(this._EndExtremityType=this.GetPropertyValue("Collab.Attach.ExtremityType"),this._previousEndExtremityType!==this._EndExtremityType&&(this._previousEndExtremityType=this._EndExtremityType,this.remove(this._ExtremityNode),this._ExtremityNode=null,this._EndExtremityType)){var i={name:this.name+" Extremity",modifiable:this.Modifiable,anchorID:this.anchorID,type:this._EndExtremityType};this._ExtremityNode=new o(i),this.add(this._ExtremityNode),this.handleLayers(!0)}if(this._ExtremityNode&&this._ExtremityNode.update(e),this._ExtremityStart&&this._ExtremityStart.update(e),this._ExtremityBreak&&this._ExtremityBreak.update(e),this._Node){var r=this.Modifiable.getLineMaterialParams("Collab.Attach.Line",this._lineMaterial,this._lastFrontLineType,this._globalOpacity);Object.keys(r).length>0&&("number"==typeof r.type&&r.type!==this._lastFrontLineType&&(this._lastFrontLineType=r.type),this._lineMaterial=this.ExperienceBase.getManager("VCXMaterialManager").getLineMaterialFromParams(r,this._lineMaterial)),(!this._Node.material||this._lineMaterial&&this._Node.material.id!==this._lineMaterial.id)&&this._Node.setMaterial(this._lineMaterial),this.handleLayers()}}},postUpdate:function(e){this._parent(),this._ExtremityNode&&this._ExtremityNode.postUpdate(e),this._ExtremityStart&&this._ExtremityStart.postUpdate(e),this._ExtremityBreak&&this._ExtremityBreak.postUpdate(e)}});return Object.defineProperty(p.prototype,"StartExtremity",{enumerable:!0,get:function(){return this._StartExtremity},set:function(e){this._StartExtremity=e}}),Object.defineProperty(p.prototype,"BreakExtremity",{enumerable:!0,get:function(){return this._BreakExtremity},set:function(e){this._BreakExtremity=e}}),Object.defineProperty(p.prototype,"EndExtremity",{enumerable:!0,get:function(){return this._EndExtremity},set:function(e){this._EndExtremity=e}}),Object.defineProperty(p.prototype,"EndExtremityType",{enumerable:!0,get:function(){return this._EndExtremityType},set:function(e){this._EndExtremityType=e}}),p}),define("DS/VCXWebDressup/VCXArrowModifiableView",["DS/VCXWebDressup/VCXDressupModifiableView"],function(e){"use strict";var t=e.extend({init:function(){this._parent()},getGroupPropertiesOrders:function(){var e=this._parent()||{};return UWA.extend(e,{"Group.Arrow.Head":["Arrow.Body.Color","Arrow.Body.Color.Opacity","Arrow.Width.1","Arrow.Head.ShowMode","Arrow.Head.Length","Arrow.Head.Size","Arrow.Head.Shape"],"Group.Arrow.Head.2":["Arrow.Body.2.Color","Arrow.Body.2.Color.Opacity","Arrow.Width.2","Arrow.Head.2.ShowMode","Arrow.Head.2.Length","Arrow.Head.2.Size","Arrow.Head.2.Shape"],"Group.Border":["Collab.Border.Line.Color","Collab.Border.Line.Color.Opacity","Collab.Border.Line.Width","Collab.Border.Line.Type","Collab.Border.Line.2.Color","Collab.Border.Line.2.Color.Opacity"]}),e}});return t.prototype._getGroupsPriorities=function(t){var i=e.prototype._getGroupsPriorities();return UWA.extend(i,{"Group.Essentials":0,"Group.Arrow":10,"Group.Arrow.Head":20,"Group.Arrow.Head.2":30,"Group.Border":35,"Group.Actions":100}),i},t}),define("DS/VCXWebDressup/VCXArrowCircularModifiableView",["DS/VCXWebDressup/VCXArrowModifiableView"],function(e){"use strict";var t=e.extend({init:function(){this._parent()},getGroupPropertiesOrders:function(){var e=this._parent()||{};return UWA.extend(e,{"Group.Arrow":["Arrow.Circular.Radius","Arrow.Circular.Angle","Arrow.Circular.Step","Arrow.Circular.Flat","Arrow.Scale","Collab.Is.Paper"]}),e}});return t.prototype._getGroupsPriorities=function(t){return e.prototype._getGroupsPriorities()},t}),define("DS/VCXWebDressup/VCXArrowLinearModifiableView",["DS/VCXWebDressup/VCXArrowModifiableView"],function(e){"use strict";return e.extend({init:function(){this._parent()},getGroupPropertiesOrders:function(){var e=this._parent()||{};return UWA.extend(e,{"Group.Arrow":["Arrow.Fixed.Length","Arrow.Length","Arrow.Scale","Collab.Is.Paper","Arrow.Billboarded","Arrow.ZRotation"]}),e}})}),define("DS/VCXWebDressup/VCXArrowCornerNode",["DS/VCXWebDressup/VCXArrowNode","DS/Visualization/ThreeJS_DS"],function(e,t){"use strict";return e.extend({init:function(e){this._parent(e)},_ComputePosBuffer:function(e,i,r,a,o){var s=this.GetAnchorWorldMatrix(0,e);if(null!=s){var n=(new t.Vector3).getPositionFromMatrix(s),l=1;this.GetPropertyValue("Collab.Is.Paper")&&(l=this.ExperienceBase.getManager("VCXPaperManager").GetPaperRatio(e,n),l*=this.GetPropertyValue("Arrow.Scale"));var p=this.GetPropertyValue("Arrow.Width.1")*l,u=0,h=0,d=0;this.GetPropertyValue("Arrow.Head.ShowMode")&&(u=this.GetPropertyValue("Arrow.Head.Length")*l,h=this.GetPropertyValue("Arrow.Head.Size")*l,d=this.GetPropertyValue("Arrow.Head.Shape")*l);var c=this.GetPropertyValue("Arrow.Width.2")*l,y=0,m=0,C=0;this.GetPropertyValue("Arrow.Head.2.ShowMode")&&(y=this.GetPropertyValue("Arrow.Head.2.Length")*l,m=this.GetPropertyValue("Arrow.Head.2.Size")*l,C=this.GetPropertyValue("Arrow.Head.2.Shape")*l);var f=this.GetPropertyValue("Arrow.Corner.Length.1")*l,V=this.GetPropertyValue("Arrow.Corner.Length.2")*l,b=p/2,P=c/2,_=[],g=0;_[2*g+0]=y,_[2*g+1]=0,_[2*++g+0]=0,_[2*g+1]=-(c/2+m),_[2*++g+0]=-C,_[2*g+1]=-c/2,_[2*++g+0]=-b,_[2*g+1]=-P,_[2*++g+0]=-p/2,_[2*g+1]=-d,_[2*++g+0]=-(p/2+h),_[2*g+1]=0,_[2*++g+0]=0,_[2*g+1]=u,_[2*++g+0]=-_[10],_[2*g+1]=_[11],_[2*++g+0]=-_[8],_[2*g+1]=_[9],_[2*++g+0]=-_[6],_[2*g+1]=-_[7],_[2*++g+0]=_[4],_[2*g+1]=-_[5],_[2*++g+0]=_[2],_[2*g+1]=-_[3],++g;var S=new t.Vector3;for(g=0;g<this._verticesNb;g++){var M=(g+2)%this._verticesNb;M<5?S.set(V,0,0):M>5&&M<11?S.set(0,f,0):S.set(0,0,0),i[3*g+0]=S.x+_[2*g+0],i[3*g+1]=S.y+_[2*g+1],i[3*g+2]=S.z,a[3*g+0]=S.x+_[2*g+0],a[3*g+1]=S.y+_[2*g+1],a[3*g+2]=S.z}return this._fillColorBuffer(r,o),this._verticesNb}console.error("anchorMatrix is null or undefined for circular arrow: ",this.Modifiable.GetObject())},preRender:function(e){this._parent(e)},update:function(e){this._parent(),this._step||(this._step=2),this._updateNodePresence(),this._updateNodeBuffers(e,!1),this._updateNodePositionFromAnchor(),this._globalOpacity<=0||this._Node&&(this._updateArrowMaterialsParameters(),this.handleLayers())},_updateNodePresence:function(){if(!this._Node&&this.GlobalOpacity>0||this._globalOpacity!==this.GlobalOpacity){this._globalOpacity=this.GlobalOpacity;var e=this._globalOpacity>0;e&&!this._Node&&this._Build(),this._Node&&this._Node.setVisibility(e)}}})}),define("DS/VCXWebDressup/VCXArrowCornerSGNodeHolder",["DS/VCXWebDressup/VCXArrowSGNodeHolder","DS/VCXWebDressup/VCXArrowCornerNode"],function(e,t){"use strict";return e.extend({init:function(){},buildSGNode:function(){if(!this._sgNode){var e={name:"Arrow Corner",modifiable:this.GetObject().QueryInterface("VCXIModifiable")};this._sgNode=new t(e),this._sgNode.setIcon("../VCXWebDressup/assets/icons/32/I_VCX_Panel_Tree_ArrowCircular.png")}return this._parent()}})}),define("DS/VCXWebDressup/VCXArrowCircularNode",["DS/VCXWebDressup/VCXArrowNode","DS/Visualization/ThreeJS_DS","DS/SceneGraphNodes/AxisSystemNode","DS/Mesh/MeshUtils","DS/Visualization/Node3D","DS/VCXWebKernelTools/VCXMathTools"],function(e,t,i,r,a,o){"use strict";return e.extend({init:function(e){this._parent(e)},_ComputePosBuffer:function(e,i,r,a,o){var s=this.GetAnchorWorldMatrix(0,e);if(s){var n=(new t.Vector3).getPositionFromMatrix(s),l=1;this.GetPropertyValue("Collab.Is.Paper")&&(l=this.ExperienceBase.getManager("VCXPaperManager").GetPaperRatio(e,n),l*=this.GetPropertyValue("Arrow.Scale"));var p=this.GetPropertyValue("Arrow.Width.1")*l,u=0,h=0,d=0;this.GetPropertyValue("Arrow.Head.ShowMode")&&(u=this.GetPropertyValue("Arrow.Head.Length")*l,h=this.GetPropertyValue("Arrow.Head.Size")*l,d=this.GetPropertyValue("Arrow.Head.Shape")*l);var c=this.GetPropertyValue("Arrow.Width.2")*l,y=0,m=0,C=0;this.GetPropertyValue("Arrow.Head.2.ShowMode")&&(y=this.GetPropertyValue("Arrow.Head.2.Length")*l,m=this.GetPropertyValue("Arrow.Head.2.Size")*l,C=this.GetPropertyValue("Arrow.Head.2.Shape")*l);var f=this.GetPropertyValue("Arrow.Circular.Flat");"number"!=typeof f&&(f=1);var V=this.GetPropertyValue("Arrow.Circular.Angle"),b={width1:p,head1Length:u,head1Size:h,head1Shape:d,width2:c,head2Length:y,head2Size:m,head2Shape:C,arcAngleRad:2*Math.PI*V/360,arrowRadius:this.GetPropertyValue("Arrow.Circular.Radius"),flatnessMode:f};return this._fillPosBuffer(i,a,b),this._fillColorBuffer(r,o),this._verticesNb}console.error("anchorMatrix is null or undefined for circular arrow: ",this.Modifiable.GetObject())},_addCoupleVerticesConsideredMainTransfMatrix:function(e,i,r,a,o){var s=((this._step-a)*r.width2+a*r.width1)/(2*this._step),n=new t.Vector3(-s,0,0).applyMatrix4(o),l=new t.Vector3(+s,0,0).applyMatrix4(o),p=a+2,u=3*p,h=3*(this._verticesNb-p);e[u]=n.x,e[u+1]=n.y,e[u+2]=n.z,e[h]=l.x,e[h+1]=l.y,e[h+2]=l.z,i[u]=n.x,i[u+1]=n.y,i[u+2]=n.z,i[h]=l.x,i[h+1]=l.y,i[h+2]=l.z},_addHeadPosInBuffer:function(e,i,r,a,s){var n,l,p,u,h,d=new t.Matrix4;if(1===a)n=3*(this._step+3),l=r.width1,p=r.head1Size,u=r.head1Length,h=r.head1Shape;else{if(2!==a)throw new Error("Arguments for _addHeadPosInBuffer method not valid.");n=3*(2*this._step+7),l=r.width2,p=r.head2Size,u=r.head2Length,h=r.head2Shape,d.makeRotationZ(Math.PI)}s.multiply(d);var c=new t.Vector3(-(l/2+p),h,0),y=new t.Vector3(0,u,0),m=new t.Vector3(-c.x,c.y,c.z);c.applyMatrix4(s),y.applyMatrix4(s),m.applyMatrix4(s),this._headRootNodes&&this._headRootNodes[a-1]&&this._headRootNodes[a-1].node.setMatrix(o.rotateMatrixAroundZ(s,.5*Math.PI)),e[n]=c.x,i[n]=c.x,e[++n]=c.y,i[n]=c.y,e[++n]=c.z,i[n]=c.z,n++,e[n%=3*this._verticesNb]=y.x,i[n]=y.x,e[++n]=y.y,i[n]=y.y,e[++n]=y.z,i[n]=y.z,e[++n]=m.x,i[n]=m.x,e[++n]=m.y,i[n]=m.y,e[++n]=m.z,i[n]=m.z,n++},_fillPosBuffer:function(e,i,r){var a=new t.Matrix4,s=new t.Matrix4,n=new t.Matrix4,l=new t.Matrix4,p=new t.Matrix4;0===r.flatnessMode&&a.makeRotationY(Math.PI/2),s.makeTranslation(r.arrowRadius,0,0),l.multiply(s).multiply(a),this._addHeadPosInBuffer(e,i,r,2,l.clone());for(var u=0;u<=this._step;++u)n.makeRotationZ(r.arcAngleRad*u/this._step),p.copy(n).multiply(l),u===Math.round(.5*this._step)&&this._headRootNodes&&this._headRootNodes[2]&&this._headRootNodes[2].node.setMatrix(o.rotateMatrixAroundZ(p,.5*Math.PI)),this._addCoupleVerticesConsideredMainTransfMatrix(e,i,r,u,p.clone());n.makeRotationZ(r.arcAngleRad),p.copy(n).multiply(l),this._addHeadPosInBuffer(e,i,r,1,p.clone())},preRender:function(e){this._parent(e)},update:function(e){this._parent(),this._updateNodePositionFromAnchor(),this._step=this.GetPropertyValue("Arrow.Circular.Step"),this._updateNodePresence(),this._updateNodeBuffers(e,!1),this._globalOpacity<=0||this._Node&&(this._updateArrowMaterialsParameters(),this.handleLayers())},_Build:function(){this._parent(),this._Node&&(this._headRootNodes||(this._headRootNodes=[{id:1},{id:2},{id:3}],this._headRootNodes.forEach(function(e){e.node=new a,this._Node.add(e.node)}.bind(this))))},_updateNodePresence:function(){if(this._lastStep!==this._step&&(this.removeChild(this._Node),this._Node=null),!this._Node&&this.GlobalOpacity>0||this._globalOpacity!==this.GlobalOpacity){this._globalOpacity=this.GlobalOpacity;var e=this._globalOpacity>0;e&&!this._Node&&(this._Build(),this._lastStep=this._step),this._Node&&this._Node.setVisibility(e)}}})}),define("DS/VCXWebDressup/VCXArrowCircularSGNodeHolder",["DS/VCXWebDressup/VCXArrowSGNodeHolder","DS/VCXWebDressup/VCXArrowCircularNode"],function(e,t){"use strict";return e.extend({init:function(){},buildSGNode:function(){if(!this._sgNode){var e={name:"Circular Arrow",modifiable:this.GetObject().QueryInterface("VCXIModifiable")};this._sgNode=new t(e),this._sgNode.setIcon("../VCXWebDressup/assets/icons/32/I_VCX_Panel_Tree_ArrowCircular.png")}return this._parent()}})}),define("DS/VCXWebDressup/VCXDressupOrganisationShapeRectangle",["DS/VCXWebDressup/VCXDressupOrganisationShape","DS/Visualization/ThreeJS_DS"],function(e,t){"use strict";return e.extend({rewind:function(){this._parent(),this.iSwap=0,this.iPariteX=0,this.iPariteY=0,this.fX=0,this.dx=0,this.fY=this.fHalfSizeY-this.fCellSize,this.fY<0&&(this.fY=0),this.maxfx=this.fHalfSizeX-this.fCellSize-this.fCellSize,this.LRiPariteX=0,this.LRiPariteY=0,this.LRfX=this.fHalfSizeX-this.fCellSize,this.LRfX<0&&(this.LRfX=0),this.LRdy=0,this.LRfY=0,this.LRmaxfy=this.fHalfSizeY-this.fCellSize},next:function(){if(this._parent(),this.iSwap++,1===this.iSwap)return!1;if(1&this.iSwap){if(this.LRiPariteX++,2===this.LRiPariteX&&(this.LRiPariteX=0,0===this.LRfY&&this.LRiPariteY++,this.LRiPariteY++,2===this.LRiPariteY&&(this.LRiPariteY=0,this.LRfY+=this.fCellSize,this.LRfY>this.fHalfSizeY-this.fCellSize&&(0===this.LRdy?this.LRdy=.5*this.fCellSize:this.LRdy=0,this.LRfY=0,this.LRfX-=this.fCellSize,this.LRfX<this.fCellSize))))return this.rewind(),!0}else if(this.iPariteY++,2===this.iPariteY&&(this.iPariteY=0,0==this.fX&&this.iPariteX++,this.iPariteX++,2===this.iPariteX&&(this.iPariteX=0,this.fX+=this.fCellSize,this.fX>this.maxfx&&(this.maxfx-=this.fCellSize,this.maxfx<this.fCellSize&&(this.maxfx=this.fCellSize),0===this.dx?this.dx=.5*this.fCellSize:this.dx=0,this.fX=0,this.fY-=this.fCellSize,this.fY<this.fCellSize))))return this.rewind(),!0;return!1},getPoint:function(){var e=new t.Vector2;return 1&this.iSwap?(1&this.LRiPariteX?e.x=this.fHalfSizeX-this.LRfX:e.x=this.fHalfSizeX+this.LRfX,1&this.LRiPariteY?e.y=this.fHalfSizeY-this.LRfY+this.LRdy:e.y=this.fHalfSizeY+this.LRfY+this.LRdy):(1&this.iPariteX?e.x=this.fHalfSizeX-this.fX+this.dx:e.x=this.fHalfSizeX+this.fX+this.dx,1&this.iPariteY?e.y=this.fHalfSizeY-this.fY:e.y=this.fHalfSizeY+this.fY),e}})}),define("DS/VCXWebDressup/VCXDressupOrganisationShapeLeft",["DS/VCXWebDressup/VCXDressupOrganisationShape","DS/Visualization/ThreeJS_DS","DS/VCXWebKernelTools/VCXMathTools"],function(e,t,i){"use strict";return e.extend({rewind:function(){this._parent(),this.iPariteY=0,this.fX=this.fHalfSizeX-this.fCellSize,this.fX<0&&(this.fX=0),this.dy=0,this.fY=0},next:function(){return this._parent(),0===this.fY&&this.iPariteY++,this.iPariteY++,2===this.iPariteY&&(this.iPariteY=0,this.fY+=this.fCellSize,this.fY>this.fHalfSizeY-this.fCellSize&&(0===this.dy?this.dy=.5*this.fCellSize:this.dy=0,this.fY=0,this.fX-=this.fCellSize,this.fX<-this.fHalfSizeX+this.fCellSize))&&(this.rewind(),!0)},getPoint:function(){var e=new t.Vector2;return e.x=this.fHalfSizeX-this.fX,1&this.iPariteY?e.y=this.fHalfSizeY-this.fY+this.dy:e.y=this.fHalfSizeY+this.fY+this.dy,e}})}),define("DS/VCXWebDressup/VCXForegroundNode",["DS/VCXWebDressup/VCXDressupNode","DS/WebappsUtils/WebappsUtils","DS/Visualization/ThreeJS_DS","DS/VCXWebVisualization/VCXImageManager","DS/Mesh/MeshUtils","DS/Visualization/SceneGraphFactory","DS/VCXWebDressup/VCXSmart3DPaperNode"],function(e,t,i,r,a,o,s){"use strict";return e.extend({init:function(e){return this._parent(e),this},dispose:function(){this._Smart3DPaperNode&&(this._Smart3DPaperNode.dispose(),this._Smart3DPaperNode=null),this._parent()},_Build:function(e){var r=this.Modifiable.ExperienceBase.getManager("VCXVisuManager");this.setRenderPasses([r.getRenderList("VCXPreForeground"),r.getRenderList("VCXForeground")]),this._currentTime=0;var n=i.ImageUtils.loadTexture(t.getWebappsBaseUrl()+"VCXWebDressup/assets/textures/fgTextureA.png");n.wrapS=i.RepeatWrapping,n.wrapT=i.RepeatWrapping,n.repeat.set(500,500),this._bodyMat=new i.MeshLambertMaterial({color:"#ffffff",map:n,side:i.DoubleSide}),this._bodyMat.force=!0,this._MeshNode=o.createRectangleNode({width:1,height:1,fill:!0,material:this._bodyMat});var l=new i.Vector2(1e3,1e3,1),p=this.Modifiable.ExperienceBase.getManager("VCXPaperManager");p&&(l=p.Size,this._MeshNode.setMatrix((new i.Matrix4).makeScale(l.x,l.y,1)));var u=new i.Matrix4;u.multiply((new i.Matrix4).makeScale(100*l.x,100*l.y,1)),u.multiply((new i.Matrix4).makeRotationAxis(new i.Vector3(0,0,1),.3*Math.PI)),u.multiply((new i.Matrix4).makeTranslation(-.5,-.5,0)),this._MeshNode.setMatrix(u),this._MeshNode.setVisibilityInTree(!1);var h={name:"ForegroundSmartNode",experience:this.ExperienceBase};this._Smart3DPaperNode=new s(h),this._Smart3DPaperNode.Position2D.x=.5*l.x,this._Smart3DPaperNode.Position2D.y=.5*l.y,this._Smart3DPaperNode.BillboardType=2,this._Smart3DPaperNode.SizeControlType=1,this._Smart3DPaperNode.PositioningType=1e3,this._Smart3DPaperNode.Depth=0,this._Smart3DPaperNode.add(this._MeshNode),this.add(this._Smart3DPaperNode),this.traverse(function(e,t){e.setPickable(a.PICKTHROUGH),e.excludeFromHighlight(t,t)},!0)},preRender:function(e){this._bodyMat&&(this._currentTime+=.01,this._bodyMat.opacity=this._globalOpacity*(.4*Math.cos(this._currentTime)+.6)),this._Smart3DPaperNode&&this._Smart3DPaperNode.preRender(e)},update:function(e){var t=0;if(this.Modifiable.ExperienceBase.getManager("VCXDRMManager").GetDisplayWatermark()&&(t=1),this._globalOpacity!==t){this._globalOpacity=t;var i=this._globalOpacity>0;i&&(this._Smart3DPaperNode||this._Build()),this._Smart3DPaperNode&&this._Smart3DPaperNode.setVisibility(i)}}})}),define("DS/VCXWebDressup/VCXCircularArrow_Spec",["DS/VCXWebDressup/VCXArrow_Spec"],function(e){"use strict";var t=e.extend({init:function(){this._parent(),this.IsAnchorDependent=!0}});return t.EFlatMode={Cylindrical:0,Flat:1,Hybrid:2},t.prototype.getDefaultName=function(){return"CircularArrow"},Object.defineProperty(t.prototype,"componentType",{enumerable:!0,get:function(){return"VCXCircularArrow_Spec"}}),t.prototype.dressupGroupName="Markups",t}),define("DS/VCXWebDressup/VCXArrowCircularModifiable",["DS/VCXWebDressup/VCXArrowModifiable","DS/VCXWebDressup/VCXCircularArrow_Spec","DS/Visualization/ThreeJS_DS","DS/VCXWebProperties/VCXPropertyValueEnum","DS/VCXWebProperties/VCXPropertyValueFloat","DS/VCXWebProperties/VCXPropertyValueInt","DS/VCXWebProperties/VCXPropertyValueFrame","DS/VCXWebProperties/VCXPropertyValueAnchor","DS/VCXWebProperties/VCXPropertyValueVector"],function(e,t,i,r,a,o,s,n,l){"use strict";return e.extend({init:function(){this._parent(),this._handleAnchor=null},Build:function(){this._parent();var e=[{Name:"Actor.Anchor.0",Type:n,DefaultValue:(new n).SetValueFrame((new s).SetValueFromVector(new i.Vector3(0,0,0))).GetValue(),GroupId:"Group.Arrow",visibleInPropertyGroups:!1},{Name:"Arrow.Circular.Flat",Type:r,DefaultValue:t.EFlatMode.Flat,GroupId:"Group.Arrow",MapChoice:this._generateMapChoiceFromEnumAndId(t.EFlatMode,"Flatness.Type",["Hybrid"])},{Name:"Arrow.Circular.Angle",Type:a,DefaultValue:270,Bounds:{Min:0,Max:360,Step:1},GroupId:"Group.Arrow"},{Name:"Arrow.Circular.Radius",Type:a,DefaultValue:100,GroupId:"Group.Arrow"},{Name:"Arrow.Circular.Step",Type:o,DefaultValue:64,Bounds:{Min:2,Max:100,Step:1},GroupId:"Group.Arrow",visibleInPropertyGroups:!1},{Name:"Actor.Position.Frame",Type:s,Persistent:!1,GroupId:"Group.Position",hiddenFields:["Orientation","Scale"]},{Name:"Collab.ListAnchorsIDs",Type:l,DefaultValue:[0]}];this._BuildPropertyValues(e)},GetProperty:function(e){if("Actor.Position.Frame"===e){var t=this.GetProperty("Actor.Anchor.0");return this.GetNewProperty(e,t.GetPropertyValue().GetValueFrame().Value)}return this._parent(e)},RequestModification:function(e){if(e&&"Actor.Position.Frame"===e.GetPropertyInfo().GetPropertyName()){var t=this.GetProperty("Actor.Anchor.0").Clone();t.GetPropertyValue().SetValueFrame(e.GetPropertyValue());var i=this._parent(e);return i.AddOrModifyProperty(t),i}return this._parent(e)}})}),define("DS/VCXWebDressup/VCXAmbienceNode",["DS/CoreEvents/Events","DS/VCXWebDressup/VCXDressupNode","DS/VCXWebDressup/VCXViewport_Spec","DS/VCXWebDressup/VCXPropertiesObserver","DS/Visualization/Node3D","DS/Visualization/Ambience","DS/WebappsUtils/WebappsUtils","DS/Visualization/ThreeJS_DS"],function(e,t,i,r,a,o,s,n){"use strict";return t.extend({init:function(e){return this._parent(e),this},preRender:function(e){this._parent(e)},_buildFromLocal:function(){var e=this.Modifiable.GetProperty("Environment.Background.Map").GetPropertyInfo().GetMapChoiceEnum()[this.Modifiable.GetPropertyValue("Environment.Background.Map")].split(".").pop();if(this._envMapStr!==e){this._envMapStr=e;var t=this.Modifiable.ExperienceBase.getManager("VCXContextManager"),i=new o({viewer:t.getMainViewer()}),r="",a=(r=this.Modifiable.GetPropertyValue("Environment.Background.Map")>1?s.getWebappsAssetUrl("debug_visu","models/textures/hdr_physical/"):s.getWebappsAssetUrl("VCXWebVisualization","ambiences/"))+e+"/"+e+".hdr",l=r+e+"/"+e+".hdr",p=r+e+"/"+e+"_rmips.hdr",u=n.ImageUtils.loadHDRTexture(a,new n.LatLongEnvMapping),h=n.ImageUtils.loadHDRTexture(l,new n.LatLongReflectionMapping),d=n.ImageUtils.loadHDRTexture(p,new n.LatLongReflectionMapping),c=UWA.Promise.deferred(),y=UWA.Promise.deferred(),m=UWA.Promise.deferred();return i.setIblMap({texture:h,doneCallback:function(){c.resolve()}}),i.setRoughnessMap({texture:d,doneCallback:function(){y.resolve()}}),i.setBackGroundMap({texture:u,mapping:new n.LatLongEnvMapping,hdr:!0,doneCallback:function(){m.resolve()}}),UWA.Promise.all([c.promise,y.promise,m.promise]).then(function(){return i})}},_Build:function(e){var t=this.Modifiable.ExperienceBase.getManager("VCXContextManager"),i=this.Modifiable.GetObject();if(!i._ambienceLoading){var r=this,a=this.Modifiable.ExperienceBase.getManager("VCXContextManager").getRootPathElement().getBoundingSphere(t.getMainViewer()).radius;return a&&(this.deferredIBL=UWA.Promise.deferred()),i._ambienceLoading=UWA.Promise.resolve().then(function(){i._ambience=null,r._envMapStr="PLM";var e=i.QueryInterface("CATI3DXAmbienceAsset").getAmbience();return e?e.then(function(e){return UWA.Promise.resolve(e)}.bind(this)).catch(function(e){return r.deferredIBL.resolve(),r.invalidLink=!0,UWA.Promise.resolve(null)}):(r.deferredIBL.resolve(),r.invalidLink=!0,UWA.Promise.resolve(null))}).then(function(t){return i._experienceBase.isValid?(i._ambience=t,delete i._ambienceLoading,i.setDirty(!0),a&&(r.iblRequiredToComplete=!0),r.update(e),a?r.deferredIBL.promise:void 0):UWA.Promise.reject("Experience not valid anymore")}),i._experienceBase.getManager("VCXNotificationManager").addProgressNotification({strObjectType:"Ambience",strObjectName:i.QueryInterface("VCXIModifiable").GetPropertyValue("Actor.Name"),iPromise:i._ambienceLoading}),i.QueryInterface("VCXIReadiness").registerPromise(i._ambienceLoading),i._ambienceLoading}},update:function(t){if(this._parent(),!this.Modifiable.GetObject()._ambienceLoading){var i=!1,r=this.Modifiable.ExperienceBase.getManager("VCXContextManager"),a=r.getActiveViewport(),o=r.getMainViewer(),s=a.getActiveAmbienceID();s===this.Modifiable.GetObject().GetID()&&(i=!0);var n=this.Modifiable.GetObject()._ambience;if(o&&(o.ambience,i)){if(!n)return void(this.invalidLink||this._Build());if(n!==o.ambience){delete this.iblRequiredToComplete;var l=setTimeout(()=>{e.unsubscribe(this._onIBLComputed),this._onIBLComputed=null,this.deferredIBL&&this.deferredIBL.resolve()},5e3);this._onIBLComputed=e.subscribe({event:"/VISU/IBLComputed"},t=>{t&&"@onIBLComputed"===t.eventType&&(clearTimeout(l),e.unsubscribe(this._onIBLComputed),this._onIBLComputed=null,this.deferredIBL&&this.deferredIBL.resolve())}),o.setAmbience(n,!0),o.render(),e.publish({event:"VCX_ENVIRONNEMENT_PROPERTY_CHANGED"}),e.publish({event:"VCX_AMBIENCE_CHANGED"})}}if(i){if(n){n.getEnvironmentLight().setIntensity(Math.pow(2,this.Modifiable.GetPropertyValue("Ambience.Lighting.Exposure")));var p=n.getEnvironmentLightMatrix();p.makeRotationZ(this.Modifiable.GetPropertyValue("Ambience.Lighting.Rotation")*Math.PI/180),n.setEnvironmentLightMatrix(p);var u=r.getActiveViewport(),h=u&&u.QueryInterface("VCXIModifiable");h&&h.QueryInterface("VCXIModifiable").GetPropertyValue("Environment.Background.Override")||(n.getBackground().setActivated(this.Modifiable.GetPropertyValue("Ambience.Background.Show")),n.getBackground().setIntensity(Math.pow(2,this.Modifiable.GetPropertyValue("Ambience.Background.Exposure")))),n.setGroundGlossiness(this.Modifiable.GetPropertyValue("Ambience.Ground.Glossiness")/100),n.setGroundReflectivitiy(this.Modifiable.GetPropertyValue("Ambience.Ground.Reflectivity")/100),n.setGroundShadowIntensity&&n.setGroundShadowIntensity(this.Modifiable.GetPropertyValue("Ambience.Ground.ShadowIntensity")/100),this.Modifiable.GetObject().updatePosition()}}else this.iblRequiredToComplete&&this.deferredIBL&&(e.unsubscribe(this._onIBLComputed),this._onIBLComputed=null,this.deferredIBL.resolve())}},postUpdate:function(e){this._parent()},dispose:function(){this.Modifiable.ExperienceBase.getManager("VCXContextManager").applyToViewers(function(e){e.removeAmbience()}),this._parent()}})}),define("DS/VCXWebDressup/VCXAmbienceSGNodeHolder",["DS/VCXWebDressup/VCXDressupSGNodeHolder","DS/VCXWebDressup/VCXAmbienceNode"],function(e,t){"use strict";return e.extend({init:function(){},getWorldMatrix:function(e){var t=this.QueryInterface("VCXIModifiable");if(t)return t.GetFramePropertyValue("Actor.Position")},buildSGNode:function(){if(!this._sgNode){var e={name:"Ambience",modifiable:this.GetObject().QueryInterface("VCXIModifiable")};this._sgNode=new t(e),this._sgNode.setIcon("../VCXWebDressup/assets/icons/32/I_VCX_Panel_Tree_AmbienceLeaf.png")}return this._parent()}})}),define("DS/VCXWebDressup/VCXCircleNode",["DS/VCXWebDressup/VCXAnchorServices","DS/VCXWebDressup/VCXDressupNode","DS/VCXWebDressup/VCXSmart3DPaperNode","DS/Visualization/ThreeJS_DS","DS/Mesh/MeshUtils","DS/Visualization/SceneGraphFactory","DS/Visualization/Node3D","DS/SceneGraphNodes/AxisSystemNode","DS/VCXWebKernelTools/VCXMathTools"],function(e,t,i,r,a,o,s,n,l){"use strict";return t.extend({_circleSubdivision:64,init:function(e){this._parent(e),this._verticesNb=2*this._circleSubdivision;var t=2*this._circleSubdivision;return this._trianglesIndicesNb=3*t,this._lineIndicesNb=2*this._circleSubdivision,this},_getPosVectArray:function(){for(var e=[],t=2*Math.PI/this._circleSubdivision,i=0;i<this._circleSubdivision;++i){var a=i*t,o=new r.Vector3(Math.cos(a),Math.sin(a),0);e.push(o)}if(2===this.GetPropertyValue("Circle.Background.Type"))for(i=this._circleSubdivision;i<this._verticesNb;++i)e.push(new r.Vector3(0,0,0));else if(1===this.GetPropertyValue("Circle.Background.Type")){var s=(100-this.GetPropertyValue("Circle.Thickness"))/100;for(i=this._circleSubdivision;i<this._verticesNb;++i){a=i*t;var n=new r.Vector3(s*Math.cos(a),s*Math.sin(a),0);e.push(n)}}return e},_computePosBuffer:function(e){for(var t=this._getPosVectArray(),i=0;i<t.length;++i)e[3*i+0]=t[i].x,e[3*i+1]=t[i].y,e[3*i+2]=t[i].z},_computeColorBuffers:function(e){var t=0,i=this.GetColorPropertyValue("Collab.Background");0===this.GetPropertyValue("Circle.Background.Type")&&(i.a=0);var r=i.Clone();2!==this.GetPropertyValue("Circle.Background.Type")&&(r.a=0);var a=i.GetRGBA(),o=r.GetRGBA();for(t=0;t<this._circleSubdivision;++t)e[4*t+0]=a[0],e[4*t+1]=a[1],e[4*t+2]=a[2],e[4*t+3]=a[3];for(t=this._verticesNb/2;t<this._verticesNb;++t)e[4*t+0]=o[0],e[4*t+1]=o[1],e[4*t+2]=o[2],e[4*t+3]=o[3]},_ComputeBuffers:function(e,t){return this._computePosBuffer(e),this._computeColorBuffers(t),this._verticesNb},dispose:function(){this._Smart3DPaperNode&&(this._Smart3DPaperNode.dispose(),this._Smart3DPaperNode=null),this._parent()},_Build:function(){this._PrimitiveGroup=new a.PrimitiveGroup({editable:!0});var e=new a.Buffer({component:a.VertexComponentEnum.POSITION,data:new Float32Array(3*this._verticesNb),dimension:3}),t=new a.Buffer({component:a.VertexComponentEnum.DIFFUSE_COLOR,data:new Float32Array(4*this._verticesNb),dimension:4}),n=new a.Buffer({indexBuffer:!0,data:new Uint16Array(this._trianglesIndicesNb+this._lineIndicesNb)});this._PrimitiveGroup.addBuffer(0,e),this._PrimitiveGroup.addBuffer(1,t),this._PrimitiveGroup.addBuffer(2,n);var l=n.data,p=0,u=0,h=0;for(p=0,u=1;p<this._circleSubdivision;++p,++u)u===this._circleSubdivision&&(u=0),l[h++]=p,l[h++]=u,l[h++]=this._circleSubdivision+p,l[h++]=this._circleSubdivision+p,l[h++]=u,l[h++]=this._circleSubdivision+u;for(p=0;p<this._circleSubdivision;++p)l[h++]=p,l[h++]=p===this._circleSubdivision-1?0:p+1;var d=new a.Primitive({nbIndices:this._trianglesIndicesNb,connectivity:a.ConnectivityTypeEnum.TRIANGLES}),c=new a.VertexComponent({bufferId:0,indices:new a.IndexArray({bufferId:2,offset:0})}),y=new a.VertexComponent({bufferId:1,indices:new a.IndexArray({bufferId:2,offset:0})});d.addVertexComponent(c),d.addVertexComponent(y),this._PrimitiveGroup.addPrimitive(d);var m=new a.Primitive({nbIndices:this._lineIndicesNb,connectivity:a.ConnectivityTypeEnum.LINES}),C=new a.VertexComponent({bufferId:0,indices:new a.IndexArray({bufferId:2,offset:this._trianglesIndicesNb})});m.addVertexComponent(C),this._PrimitiveGroup.addPrimitive(m),this._bodyMat=new r.PhysicalMaterial({side:r.DoubleSide,vertexColors:r.VertexColors,color:"#ffffff",transparent:!0,useLighting:!1,opacity:1,polygonOffset:!0,polygonOffsetFactor:-1,polygonOffsetUnits:-10,force:!0});var f=this.Modifiable.getLineMaterialParams("Collab.Body.Line",this._bodyMat.line,this._lastFrontLineType);f.polygonOffset=!0,f.polygonOffsetFactor=1,f.polygonOffsetUnits=-2,Object.keys(f).length>0&&("number"==typeof f.type&&f.type!==this._lastFrontLineType&&(this._lastFrontLineType=f.type),f.polygonBorderMode=!0,this._bodyMat.line=this.ExperienceBase.getManager("VCXMaterialManager").getLineMaterialFromParams(f,this._bodyMat.line));var V=new r.Vector3(0,0,0),b=this.GetAnchorWorldMatrix(0,null);b?V.getPositionFromMatrix(b):console.log("centerMatrix is null or undefined...");var P=(new r.Quaternion).setFromRotationMatrix(b),_=(new r.Matrix4).compose(V,P,new r.Vector3(1,1,1));this._MeshNode=o.createMeshNode(this._PrimitiveGroup),this._MeshNode.setMaterial(this._bodyMat),this._MeshNode.setVisibilityInTree(!1),this._MeshNode.setMatrix(_),this._MeshNode.excludeFromHighlight(!0,!0),this._hlMeshNode=o.createCircleNode({radius:1,segments:this._circleSubdivision,fill:!0,color:new a.Color(0,0,0,0),noEdge:!0}),this._hlMeshNode.setVisibilityInTree(!1),this._hlMeshNode.setMatrix(_),this._hlMeshNode.setPickable(a.PICKABLE);var g={name:"CircleSmartNode",modifiable:this.Modifiable};if(this._Smart3DPaperNode=new i(g),this._Smart3DPaperNode.add(this._MeshNode),this._Smart3DPaperNode.add(this._hlMeshNode),this.add(this._Smart3DPaperNode),this._Smart3DPaperNode&&!this._radiusHandleNodes){this._radiusHandleNodes=[{id:1}];var S=0;this._radiusHandleNodes.forEach(function(e){var t=(new r.Matrix4).makeRotationZ(S+Math.PI/2),i=(new r.Matrix4).setPosition({x:Math.cos(S),y:Math.sin(S),z:0});S+=Math.PI/2,e.matrixLocal=(new r.Matrix4).multiplyMatrices(i,t),e.node=new s,this._Smart3DPaperNode.add(e.node)}.bind(this))}},preRender:function(e){if(this._parent(e),this._bodyMat&&this._bodyMat.line){this._bodyMat.line.handleByPrerender=!0;let e=this.ExperienceBase.getManager("VCXPaperManager").UnitValueToPixel(this.Modifiable.GetPropertyValue("Collab.Body.Line.Width"));e>=1?(this._bodyMat.line.setLineWidth(e),this._bodyMat.line.visible=!0):this._bodyMat.line.visible=!1}this._Smart3DPaperNode&&this._Smart3DPaperNode.preRender(e)},update:function(e){if(this._parent(),this._globalOpacity!==this.GlobalOpacity){this._globalOpacity=this.GlobalOpacity;var t=this._globalOpacity>0;t&&(this._Smart3DPaperNode||this._Build()),this._Smart3DPaperNode&&this._Smart3DPaperNode.setVisibility(t)}if(!(this._globalOpacity<=0)&&this._Smart3DPaperNode){this._Smart3DPaperNode.SizeControlType=this.GetPropertyValue("Collab.Is.Paper")?1:0,this._Smart3DPaperNode.update(e);var i=this._MeshNode.getBuffer(a.VertexComponentEnum.POSITION),o=this._MeshNode.getBuffer(a.VertexComponentEnum.DIFFUSE_COLOR);if(i&&o){var s=this._ComputeBuffers(i,o);this._MeshNode.updateBuffer(a.VertexComponentEnum.POSITION,0,s),this._MeshNode.updateBuffer(a.VertexComponentEnum.DIFFUSE_COLOR,0,s),this._MeshNode.computeBoundingElements()}this._Smart3DPaperNode&&this._bodyMat&&(this._bodyMat.opacity=this._globalOpacity);var n=this.GetPropertyValue("Circle.Radius");n*=this.GetPropertyValue("Circle.Scale");var p=(new r.Matrix4).makeScale(n,n,1);this._MeshNode.setMatrix(p),this._hlMeshNode.setMatrix(p),this._radiusHandleNodes.forEach(function(e){var t=(new r.Matrix4).multiplyMatrices(p,e.matrixLocal),i=l.normalizeMatrix(t);i.setPosition(l.getOFromMatrix(t)),e.node.setMatrix(i)});var u=this.Modifiable.getLineMaterialParams("Collab.Body.Line",this._bodyMat.line,this._lastFrontLineType,this._globalOpacity);Object.keys(u).length>0&&("number"==typeof u.type&&u.type!==this._lastFrontLineType&&(this._lastFrontLineType=u.type),u.polygonBorderMode=!0,this._bodyMat.line=this.ExperienceBase.getManager("VCXMaterialManager").getLineMaterialFromParams(u,this._bodyMat.line)),this.handleLayers()}}})}),define("DS/VCXWebDressup/VCXCircleSGNodeHolder",["DS/VCXWebDressup/VCXDressupSGNodeHolder","DS/VCXWebDressup/VCXCircleNode"],function(e,t){"use strict";return e.extend({init:function(){},buildSGNode:function(){if(!this._sgNode){var e={name:"Circle",modifiable:this.GetObject().QueryInterface("VCXIModifiable")};this._sgNode=new t(e),this._sgNode.setIcon("../VCXWebDressup/assets/icons/32/I_VCX_Panel_Tree_Circle.png")}return this._parent()}})}),define("DS/VCXWebDressup/VCXDressupOrganisationShapePerimetric",["DS/VCXWebDressup/VCXDressupOrganisationShape","DS/Visualization/ThreeJS_DS"],function(e,t){"use strict";return e.extend({rewind:function(){this._parent(),this.iCurrent=0,this.rMax=Math.min(this.sizeView.x,this.sizeView.y),this.rMax<this.fCellSize&&(this.rMax=this.fCellSize),this.r=this.fCellSize,this.nbPerCircle=Math.floor(2*Math.PI*this.r/this.fCellSize+.5),this.iT=0,this.dt=0,this.iParite=0},next:function(){if(this._parent(),this.iT++,this.iT>=this.nbPerCircle){if(this.r+=this.fCellSize,this.r>this.rMax)return this.rewind(),!0;this.iT=0,this.nbPerCircle=Math.floor(2*Math.PI*this.r/this.fCellSize+.5),1&this.iParite?this.dt=Math.PI/this.nbPerCircle:this.dt=0,this.iParite++}return!1},getPoint:function(e){var i=new t.Vector2,r=this.dt+2*Math.PI*this.iT/this.nbPerCircle;return i.x=Math.cos(r)*this.r+e.x,i.y=Math.sin(r)*this.r+e.y,i}})}),define("DS/VCXWebDressup/VCXSectionNode",["DS/VCXWebDressup/VCXDressupNode","DS/Visualization/ThreeJS_DS","DS/Mesh/MeshUtils","DS/Visualization/SceneGraphFactory","DS/Visualization/Node3D","DS/VCXWebKernelTools/VCXMathTools","DS/SceneGraphNodes/AxisSystemNode","DS/VCXWebComponents/VCXWebComponentOccurrence","DS/VCXWebProperties/VCXColor","DS/Visualization/SceneGraphUtils"],function(e,t,i,r,a,o,s,n,l,p){"use strict";return e.extend({init:function(e){return this._parent(e),this},_Build:function(e){this._bodyMat=new t.MeshBasicMaterial({side:t.DoubleSide,opacity:1,force:!0}),this._bodyMat.line=new t.LineBasicMaterial({side:t.DoubleSide,opacity:1,force:!0,polygonBorderMode:!0,lineWidth:2}),this._borderMat=new t.MeshBasicMaterial({side:t.DoubleSide,color:(new l).SetRGB(255,255,255).GetThreeColor(),opacity:1,force:!0}),this._borderMat.line=this.ExperienceBase.getManager("VCXMaterialManager").getLineMaterialFromParams({lineWidth:2,color:(new l).SetRGB(0,0,0).GetThreeColor(),opacity:1}),this._borderMat.line.polygonOffset=!0,this._borderMat.line.polygonOffsetFactor=1,this._borderMat.line.polygonOffsetUnits=-200,this._borderMat.line.linecap="round";this._rightLineNode=new a("rightLine"),this._rightLineNode.setMatrix((new t.Matrix4).makeRotationZ(.5*Math.PI)),this._leftLineNode=new a("leftLine"),this._leftLineNode.setMatrix((new t.Matrix4).makeRotationZ(.5*-Math.PI)),this._bottomLineNode=new a("bottomLine"),this._topLineNode=new a("topLine"),this._axisSystemNode=new s({name:"AxisSystem",headLength:10,arrowLength:50,arrowWidth:2,colors:{colorX:new i.Color(255,0,0,0),colorY:new i.Color(0,255,0,0),colorZ:new i.Color(0,0,255,0)},head:s.types.ARROW}),this._axisSystemNode.setVisibility(!0),this._MeshNode=r.createRectangleNode({width:1,height:1,cornerPoint:new t.Vector2(-.5,-.5),fill:!0,material:this._bodyMat}),this._MeshNode.setVisibilityInTree(!1),this._MeshNodeHolder=new a("mesh"),this._MeshNodeHolder.add(this._MeshNode),this._ScalingNode=new a("scaling"),this._ScalingNode.add(this._MeshNodeHolder),this._CenteringNode=new a("centering"),this._CenteringNode.add(this._ScalingNode),this._CenteringNode.add(this._topLineNode),this._CenteringNode.add(this._leftLineNode),this._CenteringNode.add(this._rightLineNode),this._CenteringNode.add(this._bottomLineNode),this.add(this._CenteringNode,{exludeFromBounding:!1}),this._axisMat=this.ExperienceBase.getManager("VCXMaterialManager").getLineMaterialFromParams({type:n.ELineType.Dot,lineWidth:1,color:(new l).SetRGB(255,255,255).GetThreeColor(),opacity:1});var o=this.ExperienceBase.getManager("VCXVisuManager");this._rightAxisNode=r.createLineNode({points:[new t.Vector3(0,0,0),new t.Vector3(1,0,0)],material:this._axisMat}),this._leftAxisNode=r.createLineNode({points:[new t.Vector3(0,0,0),new t.Vector3(-1,0,0)],material:this._axisMat}),this._bottomAxisNode=r.createLineNode({points:[new t.Vector3(0,0,0),new t.Vector3(0,-1,0)],material:this._axisMat}),this._topAxisNode=r.createLineNode({points:[new t.Vector3(0,0,0),new t.Vector3(0,1,0)],material:this._axisMat});var p=this;[this._rightAxisNode,this._leftAxisNode,this._bottomAxisNode,this._topAxisNode].forEach(function(e){e.setVisibility(!1),e.setRenderPasses([o.getRenderList("VCXPreManipulators"),o.getRenderList("VCXManipulators")]),e.excludeFromCSO(!0),e.excludeFromHighlight(!0,!0),e.setNoHighlightNoZ(!0),p.add(e)}),this._MeshNodeHolder.setPickingPriorityId("VCXSection"),this._MeshNode.setPickingPriorityId("VCXSection")},preRender:function(e){if(this._globalOpacity>0&&this._MeshNodeHolder&&(this.Modifiable.GetObject()._plane&&this.Modifiable.ExperienceBase.getManager("VCXContextManager"))){var i=this.Modifiable.GetObject().getWorkingRootPathElement();if(i){var r=(u=this.Modifiable.QueryInterface("W3AISGNodeHolder")).getWorldMatrix(e.viewer),a=(new t.Matrix4).getInverse(r),s=this.Modifiable.GetPropertyValue("Actor.ListActors"),n=[];if(s.length)for(var l=0;l<s.length;l++){var u,h=this.Modifiable.GetObject()._experienceBase.ComponentsMap.GetComponentFromID(s[l].Value);if(h)if(u=h.QueryInterface("W3AISGNodeHolder")){var d=u.getPathElement();d&&n.push(d)}}n.length||n.push(i);var c=p.getOrientedBoundingBoxFromPathElements(n,r,e.viewer);c.localBBox.expandByPoint(o.getOFromMatrix(r).applyMatrix4(a));var y=c.localBBox.min,m=c.localBBox.max,C=this.ExperienceBase.getManager("VCXPaperManager");if(this.compactMode){var f=10*C.GetPaperRatio(e,o.getOFromMatrix(r));c.localBBox.min.set(-f,-f),c.localBBox.max.set(f,f)}var V=(new t.Vector3).addVectors(y,m).multiplyScalar(.5);y.clone().applyMatrix4(r),m.clone().applyMatrix4(r),V.clone().applyMatrix4(r);this.setMatrix(r),this._MeshNodeHolder.setMatrix((new t.Matrix4).setPosition(new t.Vector3(0,0,.001*-m.length()))),this._CenteringNode.setMatrix((new t.Matrix4).setPosition(new t.Vector3(V.x,V.y,0)));var b=r.clone().multiply(this._CenteringNode.getMatrix()),P=10*C.GetPaperRatio(e,o.getOFromMatrix(r)),_=1e3*P,g=Math.min(Math.max(P,Math.abs(m.x-y.x)),_),S=Math.min(Math.max(P,Math.abs(m.y-y.y)),_);this._ScalingNode.setMatrix((new t.Matrix4).makeScale(1.1*g,1.1*S,1));var M=new t.Vector3(1.1*-g*.5,0,0),D=4*C.GetPaperRatio(e,M.clone().applyMatrix4(b));this._rightLineNode.setMatrix(this._rightLineNode.getMatrix().setPosition(M));var G=new t.Vector3(1.1*g*.5,0,0),v=4*C.GetPaperRatio(e,G.clone().applyMatrix4(b));this._leftLineNode.setMatrix(this._leftLineNode.getMatrix().setPosition(G));var A=new t.Vector3(0,1.1*-S*.5,0),x=4*C.GetPaperRatio(e,A.clone().applyMatrix4(b));this._bottomLineNode.setMatrix(this._bottomLineNode.getMatrix().setPosition(A));var X=new t.Vector3(0,1.1*S*.5,0),I=4*C.GetPaperRatio(e,X.clone().applyMatrix4(b));this._topLineNode.setMatrix(this._topLineNode.getMatrix().setPosition(X)),this._rightAxisNode.setMatrix((new t.Matrix4).makeScale(m.x+.05*g+2*D,1,1)),this._leftAxisNode.setMatrix((new t.Matrix4).makeScale(-y.x+.05*g+2*v,1,1)),this._topAxisNode.setMatrix((new t.Matrix4).makeScale(1,m.y+.05*S+2*I,1)),this._bottomAxisNode.setMatrix((new t.Matrix4).makeScale(1,-y.y+.05*S+2*x,1))}}},update:function(e){this._parent();var i=!1,r=this.Modifiable.QueryInterface("VCXIVisibility");r&&(i=r.GetVisibility());var a=this.GetPropertyValue("Section.Plane.Enable")?this.GlobalOpacity:0;if(this._globalOpacity!==a){this._globalOpacity=a;var o=this._globalOpacity>0;o&&(this._MeshNode||this._Build()),this.setVisibility(o)}var s=this.Modifiable.GetObject()._cappingMaterial;if(s&&i){var n=Math.cos(this.GetPropertyValue("Section.Hatching.Angle")*Math.PI/180),l=Math.sin(this.GetPropertyValue("Section.Hatching.Angle")*Math.PI/180),p=this.GetColorPropertyValue("Section.Capping"),u=this.GetColorPropertyValue("Section.Hatching"),h=this.GetPropertyValue("Section.Hatching.Frequency");s.stripesDirection=new t.Vector2(n+l,l-n),s.spaceWidth=500/(h+1),s.stripesWidth=Boolean(h)?1.5:0,s.spaceColor=p.GetThreeColor(),s.stripesColor=u.GetThreeColor(),s.autoSpaceColor!==this.GetPropertyValue("Section.Capping.ActorColor")&&(s.autoSpaceColor=this.GetPropertyValue("Section.Capping.ActorColor"))}if(!(this._globalOpacity<=0)){this._bodyMat&&(this._bodyMat.opacity=this._globalOpacity);var d=this.GetColorPropertyValue("Actor");this._bodyMat&&this._bodyMat.line&&(this._bodyMat.line.color=d.GetThreeColor(),this._bodyMat.line.opacity=1,this._bodyMat.color=d.GetThreeColor(),this._axisMat.color=d.GetThreeColor()),this.handleLayers()}}})}),define("DS/VCXWebDressup/VCXSectionSGNodeHolder",["DS/VCXWebDressup/VCXDressupSGNodeHolder","DS/VCXWebDressup/VCXSectionNode"],function(e,t){"use strict";return e.extend({init:function(){},getWorldMatrix:function(e){var t=this.getAnchorReferential(),i=this.QueryInterface("VCXIModifiable");return i&&(this._actorPosition=i.GetFramePropertyValue("Actor.Position"),this._actorPosition&&t.multiply(this._actorPosition)),t},buildSGNode:function(){if(!this._sgNode){var e={name:"Section",modifiable:this.GetObject().QueryInterface("VCXIModifiable")};this._sgNode=new t(e),this._sgNode.setIcon("../VCXWebDressup/assets/icons/32/I_VCX_Panel_Tree_Section.png")}return this._parent()}})}),define("DS/VCXWebDressup/VCXArrowLinearNode",["DS/VCXWebDressup/VCXArrowNode","DS/Visualization/ThreeJS_DS","DS/VCXWebKernelTools/VCXMathTools"],function(e,t,i){"use strict";return e.extend({init:function(e){this._parent(e)},_ComputePosBuffer:function(e,r,a,o,s){var n,l=this.GetAnchorWorldMatrix(0,e),p=(new t.Vector3).getPositionFromMatrix(l);if(this.GetPropertyValue("Arrow.Head.2.Position.Is.Paper")){var u=new t.Vector2(this.GetPropertyValue("Arrow.Head.2.Position.X"),this.GetPropertyValue("Arrow.Head.2.Position.Y")),h=0;this.GetPropertyValue("Arrow.Fixed.Length")&&(h=this.GetPropertyValue("Arrow.Length")),n=this.ExperienceBase.getManager("VCXPaperManager").GetModelPointFromModelPointAndPaperPosition(e,p,u,h)}else{var d=this.GetAnchorWorldMatrix(1,e);n=(new t.Vector3).getPositionFromMatrix(d)}var c=e.viewpoint.getEyePosition(),y=new t.Vector3(1,0,0);y.subVectors(n,p);var m,C=y.length();if(y.normalize(),!(this.Modifiable.GetProperty("Actor.Anchor.1")&&this.Modifiable.GetProperty("Actor.Anchor.1").GetPropertyValue()&&this.Modifiable.GetProperty("Actor.Anchor.1").GetPropertyValue().GetValueLink()&&this.Modifiable.GetProperty("Actor.Anchor.1").GetPropertyValue().GetValueLink().Value)||this.GetPropertyValue("Arrow.Billboarded"))m=(new t.Vector3).subVectors(c,p);else{let e=this.GetPropertyValue("Arrow.ZRotation"),t=Math.PI*e/180;m=i.getVxFromMatrix(l).applyAxisAngle(y,t)}var f=new t.Vector3(0,1,0);1===m.normalize().dot(y.normalize())||(f.crossVectors(m,y),f.normalize()),this.GetPropertyValue("Arrow.Fixed.Length")&&(C=this.GetPropertyValue("Arrow.Length"));var V=1,b=1;this.GetPropertyValue("Collab.Is.Paper")&&(V=this.ExperienceBase.getManager("VCXPaperManager").GetPaperRatio(e,p),b=this.ExperienceBase.getManager("VCXPaperManager").GetPaperRatio(e,n),V*=this.GetPropertyValue("Arrow.Scale"),b*=this.GetPropertyValue("Arrow.Scale"),this.GetPropertyValue("Arrow.Fixed.Length")&&(C*=V));var P=this.GetPropertyValue("Arrow.Width.1")*V,_=0,g=0,S=0;this.GetPropertyValue("Arrow.Head.ShowMode")&&(_=this.GetPropertyValue("Arrow.Head.Length")*V,g=this.GetPropertyValue("Arrow.Head.Size")*V,S=this.GetPropertyValue("Arrow.Head.Shape")*V);var M=this.GetPropertyValue("Arrow.Width.2")*b,D=0,G=0,v=0;this.GetPropertyValue("Arrow.Head.2.ShowMode")&&(D=this.GetPropertyValue("Arrow.Head.2.Length")*b,G=this.GetPropertyValue("Arrow.Head.2.Size")*b,v=this.GetPropertyValue("Arrow.Head.2.Shape")*b);var A=0,x=[];for(x[2*A+0]=C,x[2*A+1]=0,x[2*++A+0]=C-D,x[2*A+1]=.5*M+G,x[2*++A+0]=C-(D+v),x[2*A+1]=.5*M,x[2*++A+0]=_+S,x[2*A+1]=.5*P,x[2*++A+0]=_,x[2*A+1]=.5*P+g,x[2*++A+0]=0,x[2*A+1]=0,x[2*++A+0]=x[8],x[2*A+1]=-x[9],x[2*++A+0]=x[6],x[2*A+1]=-x[7],x[2*++A+0]=x[4],x[2*A+1]=-x[5],x[2*++A+0]=x[2],x[2*A+1]=-x[3],A++,A=0;A<this._verticesNb;A++)r[3*A+0]=p.x+x[2*A+0]*y.x+x[2*A+1]*f.x,r[3*A+1]=p.y+x[2*A+0]*y.y+x[2*A+1]*f.y,r[3*A+2]=p.z+x[2*A+0]*y.z+x[2*A+1]*f.z,o[3*A+0]=p.x+x[2*A+0]*y.x+x[2*A+1]*f.x,o[3*A+1]=p.y+x[2*A+0]*y.y+x[2*A+1]*f.y,o[3*A+2]=p.z+x[2*A+0]*y.z+x[2*A+1]*f.z;return this._fillColorBuffer(a,s),A},preRender:function(e){this._parent(e)},update:function(){this._parent(),this._step||(this._step=this._getArrowStep()),this._updateNodePresence(),this._globalOpacity<=0||this._Node&&(this._updateArrowMaterialsParameters(),this.handleLayers())},_updateNodePresence:function(){if(!this._Node&&this.GlobalOpacity>0||this._globalOpacity!==this.GlobalOpacity){this._globalOpacity=this.GlobalOpacity;var e=this._globalOpacity>0;e&&!this._Node&&this._Build(),this._Node&&this._Node.setVisibility(e)}},_getArrowStep:function(){return 1}})}),define("DS/VCXWebDressup/VCXArrowLinearSGNodeHolder",["DS/VCXWebDressup/VCXArrowSGNodeHolder","DS/VCXWebDressup/VCXArrowLinearNode"],function(e,t){"use strict";return e.extend({init:function(){},buildSGNode:function(){if(!this._sgNode){var e={name:"Linear Arrow",modifiable:this.GetObject().QueryInterface("VCXIModifiable")};this._sgNode=new t(e),this._sgNode.setIcon("../VCXWebDressup/assets/icons/32/I_VCX_Panel_Tree_Arrow.png")}return this._parent()}})}),define("DS/VCXWebDressup/VCXDressupOrganisationShapeCircle",["DS/VCXWebDressup/VCXDressupOrganisationShape","DS/Visualization/ThreeJS_DS"],function(e,t){"use strict";return e.extend({rewind:function(){this._parent(),this.iCurrent=0,this.rMax=Math.min(this.sizeView.x,this.sizeView.y),this.rMax=.5*this.rMax-this.fCellSize,this.rMax<this.fCellSize&&(this.rMax=this.fCellSize),this.r=this.rMax,this.nbPerCircle=Math.floor(2*Math.PI*this.r/this.fCellSize+.5),this.iT=0,this.dt=0,this.iParite=0},next:function(){if(this._parent(),this.iT++,this.iT>=this.nbPerCircle){if(this.r-=this.fCellSize,this.r<this.fCellSize)return this.rewind(),!0;this.iT=0,this.nbPerCircle=Math.floor(2*Math.PI*this.r/this.fCellSize+.5),1&this.iParite?this.dt=Math.PI/this.nbPerCircle:this.dt=0,this.iParite++}return!1},getPoint:function(){var e=new t.Vector2,i=this.dt+2*Math.PI*this.iT/this.nbPerCircle;return e.x=Math.cos(i)*this.r+.5*this.sizeView.x,e.y=Math.sin(i)*this.r+.5*this.sizeView.y,e}})}),define("DS/VCXWebDressup/VCXDressupOrganisationShapeTopAndRight",["DS/VCXWebDressup/VCXDressupOrganisationShape","DS/Visualization/ThreeJS_DS","DS/VCXWebKernelTools/VCXMathTools"],function(e,t,i){"use strict";return e.extend({rewind:function(){this._parent(),this.iSwap=0,this.iPariteX=0,this.iPariteY=0,this.fX=0,this.dx=0,this.fY=this.fHalfSizeY-this.fCellSize,this.fY<0&&(this.fY=0),this.maxfx=this.fHalfSizeX-this.fCellSize-this.fCellSize,this.LRiPariteX=0,this.LRiPariteY=0,this.LRfX=this.fHalfSizeX-this.fCellSize,this.LRfX<0&&(this.LRfX=0),this.LRdy=0,this.LRfY=0,this.LRmaxfy=this.fHalfSizeY-this.fCellSize},next:function(){if(this._parent(),this.iSwap++,1&this.iSwap){if(this.LRiPariteY++,2===this.LRiPariteY&&(this.LRiPariteY=0,this.LRfY+=this.fCellSize,this.LRfY>this.fHalfSizeY-this.fCellSize&&(0===this.LRdy?this.LRdy=.5*this.fCellSize:this.LRdy=0,this.LRfY=0,this.LRfX-=this.fCellSize,this.LRfX<this.fCellSize)))return this.rewind(),!0}else if(0==this.fX&&this.iPariteX++,this.iPariteX++,2===this.iPariteX&&(this.iPariteX=0,this.fX+=this.fCellSize,this.fX>this.maxfx&&(this.maxfx-=this.fCellSize,this.maxfx<this.fCellSize&&(this.maxfx=this.fCellSize),0===this.dx?this.dx=.5*this.fCellSize:this.dx=0,this.fX=0,this.fY-=this.fCellSize,this.fY<this.fCellSize)))return this.rewind(),!0;return!1},getPoint:function(){var e=new t.Vector2;return 1&this.iSwap?(e.x=this.fHalfSizeX+this.LRfX,1&this.LRiPariteY?e.y=this.fHalfSizeY-this.LRfY+this.LRdy:e.y=this.fHalfSizeY+this.LRfY+this.LRdy):(1&this.iPariteX?e.x=this.fHalfSizeX-this.fX+this.dx:e.x=this.fHalfSizeX+this.fX+this.dx,e.y=this.fHalfSizeY-this.fY),e}})}),define("DS/VCXWebDressup/VCXPolylineNode",["DS/VCXWebComponents/VCXWebComponentOccurrence","DS/VCXWebDressup/VCXDressup_Spec","DS/VCXWebDressup/VCXDressupNode","DS/Visualization/ThreeJS_DS","DS/Mesh/MeshUtils","DS/Visualization/SceneGraphFactory"],function(e,t,i,r,a,o){"use strict";return i.extend({init:function(e){return this._parent(e),this},_getPosVectArray:function(){var e=[],t=0,i=this;if(this.Modifiable._Anchors&&Object.keys(this.Modifiable._Anchors).length>0){this.Modifiable.processAnchorsIDs(function(a){var o=i.GetAnchorWorldMatrix(a);if(o){var s=new r.Vector3(0,0,0);s.getPositionFromMatrix(o),e[t++]=s}});var a=t+1;return this._currentPointsNumber!==a?-1:(this.GetPropertyValue("Polyline.Is.Closed")?e[a-1]=e[0].clone():e[a-1]=e[a-2].clone(),e)}console.log("No point")},_ComputePosBuffer:function(e){if(this._currentPointsNumber!==this._getCurrentPointsNumber())return-1;var t=this._getPosVectArray();if(!(Array.isArray(t)&&t.length>0))return t;for(var i=t.length,r=0;r<i;r++)e[3*r+0]=t[r].x,e[3*r+1]=t[r].y,e[3*r+2]=t[r].z;return i},_Build:function(){if(0!==this.Modifiable.getAnchorsCount()){this._currentPointsNumber=this._getCurrentPointsNumber();var e=this._getPosVectArray();if(!Array.isArray(e)||e.length<2)console.log("Can't build the polyline");else{for(var t=this._currentPointsNumber-1,i=new Uint16Array(2*t),r=0;r<t;++r)i[2*r+0]=r,i[2*r+1]=r+1;if(!this.Modifiable.GetPropertyValue("Actor.IsAlwaysOnTop")&&this.Modifiable.GetPropertyValue("Collab.Body.Line.UseHiddenStyle")){var s=this.Modifiable.getLineMaterialParams("Collab.Body.Line.Back",this._lineBackMaterial,this._lastBackLineType);Object.keys(s).length>0&&("number"==typeof s.type&&s.type!==this._lastBackLineType&&(this._lastBackLineType=s.type),this._lineBackMaterial=this.ExperienceBase.getManager("VCXMaterialManager").getLineMaterialFromParams(s,this._lineBackMaterial),s.backMaterial=this._lineBackMaterial)}else if(this._lineBackMaterial&&0!==this._lineBackMaterial.opacity){var n=this.ExperienceBase.getManager("VCXMaterialManager");this._lineBackMaterial=n.getLineMaterialFromParams({opacity:0},this._lineBackMaterial)}var l=this.Modifiable.getLineMaterialParams("Collab.Body.Line",this._lineMaterial,this._lastFrontLineType);Object.keys(l).length>0&&("number"==typeof l.type&&l.type!==this._lastFrontLineType&&(this._lastFrontLineType=l.type),this._lineBackMaterial&&(l.backMaterial=this._lineBackMaterial),this._lineMaterial=this.ExperienceBase.getManager("VCXMaterialManager").getLineMaterialFromParams(l,this._lineMaterial));var p={points:e,idx:i,editable:!0,drawMode:a.ConnectivityTypeEnum.LINES,material:this._lineMaterial};this._Node=o.createLineNode(p),this._Node.setVisibilityInTree(!1),this.add(this._Node)}}else console.log("No point")},preRender:function(e){this._parent(e);var t=this.ExperienceBase.getManager("VCXPaperManager");if(this._lineBackMaterial){this._lineBackMaterial.handleByPrerender=!0;let e=t.UnitValueToPixel(this.Modifiable.GetPropertyValue("Collab.Body.Line.Back.Width"));e>=1?(this._lineBackMaterial.setLineWidth(e),this._lineBackMaterial.visible=!0):this._lineBackMaterial.visible=!1}if(this._lineMaterial){this._lineMaterial.handleByPrerender=!0;let e=t.UnitValueToPixel(this.Modifiable.GetPropertyValue("Collab.Body.Line.Width"));e>=1?(this._lineMaterial.setLineWidth(e),this._lineMaterial.visible=!0):this._lineMaterial.visible=!1}return!0},update:function(e){if(this._parent(),this._globalOpacity!==this.GlobalOpacity){this._globalOpacity=this.GlobalOpacity;var t=this._globalOpacity>0;t&&(this._Node||this._Build()),this._Node&&this._Node.setVisibility(t)}if(!(this._globalOpacity<=0)&&this._Node){var i=this._Node.getBuffer(a.VertexComponentEnum.POSITION);if(void 0!==i){var r=this._ComputePosBuffer(i);-1===r?(this.remove(this._Node),this._Node=null,this._Build()):"number"==typeof r&&(this._Node.updateBuffer(a.VertexComponentEnum.POSITION,0,r),this._Node.computeBoundingElements())}var o=this.ExperienceBase.getManager("VCXMaterialManager");if(!this.Modifiable.GetPropertyValue("Actor.IsAlwaysOnTop")&&this.Modifiable.GetPropertyValue("Collab.Body.Line.UseHiddenStyle")){var s=this.Modifiable.getLineMaterialParams("Collab.Body.Line.Back",this._lineBackMaterial,this._lastBackLineType,this._globalOpacity);Object.keys(s).length>0&&("number"==typeof s.type&&s.type!==this._lastBackLineType&&(this._lastBackLineType=s.type),this._lineBackMaterial=o.getLineMaterialFromParams(s,this._lineBackMaterial),s.backMaterial=this._lineBackMaterial)}else this._lineBackMaterial&&0!==this._lineBackMaterial.opacity&&(this._lineBackMaterial=o.getLineMaterialFromParams({opacity:0},this._lineBackMaterial));var n=this.Modifiable.getLineMaterialParams("Collab.Body.Line",this._lineMaterial,this._lastFrontLineType,this._globalOpacity);n&&n.type&&"number"==typeof n.type&&n.type!==this._lastFrontLineType&&(this._lastFrontLineType=n.type),!this._lineBackMaterial||this._lineMaterial&&this._lineMaterial.backMaterial===this._lineBackMaterial||(n.backMaterial=this._lineBackMaterial),Object.keys(n).length>0&&(this._lineMaterial=o.getLineMaterialFromParams(n,this._lineMaterial)),this._Node&&(!this._Node.material||this._lineMaterial&&this._Node.material.id!==this._lineMaterial.id)&&this._Node.setMaterial(this._lineMaterial),this.handleLayers()}},isNodeBuilt:function(){return Boolean(this._Node)},_getCurrentPointsNumber:function(){return this.Modifiable.getAnchorsCount()+1}})}),define("DS/VCXWebDressup/VCXPolylineSGNodeHolder",["DS/VCXWebDressup/VCXDressupSGNodeHolder","DS/VCXWebDressup/VCXPolylineNode"],function(e,t){"use strict";return e.extend({init:function(){},getWorldMatrix:function(e){var t=this.GetObject()._experienceBase.getManager("VCXContextManager"),i=this.GetObject().getWorkingRootPathElement().getWorldMatrix(t.getMainViewer()),r=this.QueryInterface("VCXIModifiable");if(r)return this._actorPosition=r.GetFramePropertyValue("Actor.Position"),this._actorPosition&&i.multiply(this._actorPosition),i},buildSGNode:function(){if(!this._sgNode){var e={name:"Polyline",modifiable:this.GetObject().QueryInterface("VCXIModifiable")};this._sgNode=new t(e),this._sgNode.setIcon("../VCXWebDressup/assets/icons/32/I_VCX_Panel_Tree_PolylineLeaf.png")}return this._parent()}})}),define("DS/VCXWebDressup/VCXDressupOrganisationShapeBottomAndRight",["DS/VCXWebDressup/VCXDressupOrganisationShape","DS/Visualization/ThreeJS_DS","DS/VCXWebKernelTools/VCXMathTools"],function(e,t,i){"use strict";return e.extend({rewind:function(){this._parent(),this.iSwap=0,this.iPariteX=0,this.iPariteY=0,this.fX=0,this.dx=0,this.fY=this.fHalfSizeY-this.fCellSize,this.fY<0&&(this.fY=0),this.maxfx=this.fHalfSizeX-this.fCellSize-this.fCellSize,this.LRiPariteX=0,this.LRiPariteY=0,this.LRfX=this.fHalfSizeX-this.fCellSize,this.LRfX<0&&(this.LRfX=0),this.LRdy=0,this.LRfY=0,this.LRmaxfy=this.fHalfSizeY-this.fCellSize},next:function(){if(this._parent(),this.iSwap++,1&this.iSwap){if(this.LRiPariteY++,2===this.LRiPariteY&&(this.LRiPariteY=0,this.LRfY+=this.fCellSize,this.LRfY>this.fHalfSizeY-this.fCellSize&&(0===this.LRdy?this.LRdy=.5*this.fCellSize:this.LRdy=0,this.LRfY=0,this.LRfX-=this.fCellSize,this.LRfX<this.fCellSize)))return this.rewind(),!0}else if(0===this.fX&&this.iPariteX++,this.iPariteX++,2===this.iPariteX&&(this.iPariteX=0,this.fX+=this.fCellSize,this.fX>this.maxfx&&(this.maxfx-=this.fCellSize,this.maxfx<this.fCellSize&&(this.maxfx=this.fCellSize),0===this.dx?this.dx=.5*this.fCellSize:this.dx=0,this.fX=0,this.fY-=this.fCellSize,this.fY<this.fCellSize)))return this.rewind(),!0;return!1},getPoint:function(){var e=new t.Vector2;return 1&this.iSwap?(e.x=this.fHalfSizeX+this.LRfX,1&this.LRiPariteY?e.y=this.fHalfSizeY-this.LRfY+this.LRdy:e.y=this.fHalfSizeY+this.LRfY+this.LRdy):(1&this.iPariteX?e.x=this.fHalfSizeX-this.fX+this.dx:e.x=this.fHalfSizeX+this.fX+this.dx,e.y=this.fHalfSizeY+this.fY),e}})}),define("DS/VCXWebDressup/VCXCircle_Spec",["DS/VCXWebDressup/VCXDressup_Spec"],function(e){"use strict";var t=e.extend({init:function(){this._parent()}});return t.EBackgroundType={Empty:0,Gradient:1,Plain:2},t.prototype.getDefaultName=function(){return"Circle"},Object.defineProperty(t.prototype,"componentType",{enumerable:!0,get:function(){return"VCXCircle_Spec"}}),t.prototype.dressupGroupName="Markups",t}),define("DS/VCXWebDressup/VCXCircleModifiable",["DS/VCXWebComponents/VCXWebComponentOccurrence","DS/VCXWebDressup/VCXCircle_Spec","DS/VCXWebDressup/VCXMarkup_Spec","DS/VCXWebDressup/VCXDressupModifiable","DS/Visualization/ThreeJS_DS","DS/VCXWebProperties/VCXPropertySet","DS/VCXWebProperties/VCXColor","DS/VCXWebProperties/VCXPropertyValueBoolean","DS/VCXWebProperties/VCXPropertyValueFloat","DS/VCXWebProperties/VCXPropertyValueFrame","DS/VCXWebProperties/VCXPropertyValueColor","DS/VCXWebProperties/VCXPropertyValueAnchor","DS/VCXWebProperties/VCXPropertyValueEnum","DS/VCXWebProperties/VCXPropertyValueVector","DS/VCXWebKernelTools/VCXMathTools"],function(e,t,i,r,a,o,s,n,l,p,u,h,d,c,y){"use strict";return r.extend({init:function(){this._parent(),this._bIsCircle=!0},Build:function(){this._parent();var r=[{Name:"Actor.Anchor.0",Type:h,DefaultValue:(new h).SetValueFrame((new p).SetValueFromVector(new a.Vector3(0,0,0))).GetValue(),visibleInPropertyGroups:!1},{Name:"Circle.Radius",Type:l,DefaultValue:1,GroupId:"Group.Circle"},{Name:"Circle.Scale",Type:l,DefaultValue:1,GroupId:"Group.Circle"},{Name:"Circle.Thickness",Type:l,DefaultValue:20,Bounds:{Min:0,Max:100,Step:.1},GroupId:"Group.Circle",FormatPainter:!0},{Name:"Collab.3D.Paper.Billboard.Type",Type:d,DefaultValue:i.EBillboardType.Spherical,GroupId:"Group.Circle",MapChoice:this._generateMapChoiceFromEnumAndId(i.EBillboardType,"Billboard.Type",["AlongX_yInCam","AlongX_yInCamUp"]),FormatPainter:!0},{Name:"Collab.Is.Paper",Type:n,DefaultValue:!0,GroupId:"Group.Circle"},{Name:"Circle.Background.Type",Type:d,DefaultValue:t.EBackgroundType.Gradient,GroupId:"Group.Circle",MapChoice:this._generateMapChoiceFromEnumAndId(t.EBackgroundType,"Circle.BackgroundType"),FormatPainter:!0},{Name:"Collab.Background.Color",Type:u,DefaultValue:(new s).FromRGBA(.9294117647058824,.3176470588235294,.3176470588235294,.5),GroupId:"Group.Circle",FormatPainter:!0},{Name:"Collab.Background.Color.Opacity",Type:l,DefaultValue:1,Bounds:{Min:0,Max:1,Step:.01},GroupId:"Group.Circle",FormatPainter:!0},{Name:"Collab.Body.Line.Width",Type:l,DefaultValue:1,GroupId:"Group.CircleBorder",FormatPainter:!0},{Name:"Collab.Body.Line.Color",Type:u,DefaultValue:(new s).FromRGBA(.6431372549019608,.1686274509803922,.1568627450980392,1),GroupId:"Group.CircleBorder",FormatPainter:!0},{Name:"Collab.Body.Line.Color.Opacity",Type:l,DefaultValue:1,Bounds:{Min:0,Max:1,Step:.01},GroupId:"Group.CircleBorder",FormatPainter:!0},{Name:"Collab.Body.Line.Type",Type:d,DefaultValue:e.ELineType.Plain,GroupId:"Group.CircleBorder",MapChoice:this._generateMapChoiceFromEnumAndId(e.ELineType,"Collab.DashType",["UserDefined","Advanced"]),FormatPainter:!0},{Name:"Collab.ListAnchorsIDs",Type:c,DefaultValue:[0]}];this._BuildPropertyValues(r),this.SetPropertyInvisible("Collab.ListAnchorsIDs",!0)},SetPropertiesInfo:function(){this._parent(),this.SetPropertyInvisible("Actor.Color",!0),this.GetProperty("Actor.Color").GetPropertyInfo()._bPersistent=!1,this.SetPropertyInvisible("Collab.Background.Color",0===this.GetPropertyValue("Circle.Background.Type")),this.SetPropertyInvisible("Collab.Background.Color.Opacity",0===this.GetPropertyValue("Circle.Background.Type")),this.SetPropertyInvisible("Circle.Thickness",1!==this.GetPropertyValue("Circle.Background.Type")),this.SetPropertyInvisible("Circle.Scale",!0)},GetProperty:function(e){return"Actor.Color"===e?this.GetNewProperty(e,this.GetPropertyValue("Collab.Background.Color")):this._parent(e)},RequestModification:function(e){if(e){var t=e.GetPropertyInfo().GetPropertyName();if("Actor.Color"===t){var i=new o,r=e.GetPropertyValue().Value.getAssociatedColors();return i.AddOrModifyProperty(this.GetNewProperty("Collab.Background.Color",r.body)),i.AddOrModifyProperty(this.GetNewProperty("Collab.Body.Line.Color",r.border)),i}if("Collab.Is.Paper"===t){var a=this.ExperienceBase.getManager("VCXPaperManager"),s=this,n=[{idx:0}];n.forEach(function(t){var i=y.getOFromMatrix(s.GetAnchorWorldMatrix(t.idx)),r=a.GetPaperRatio(null,i),o=1;e.GetPropertyValue().Value?o/=r:o*=r,t.scaleToApply=o});i=this._parent(e);return[{idx:0,propertyName:"Circle.Radius"}].forEach(function(e){var t=s.GetPropertyValue(e.propertyName);t*=n[e.idx].scaleToApply,i.AddOrModifyProperty(s.GetNewProperty(e.propertyName,t))}),i}}return this._parent(e)}})}),define("DS/VCXWebDressup/VCXDressupOrganisationShapeBottomAndLeft",["DS/VCXWebDressup/VCXDressupOrganisationShape","DS/Visualization/ThreeJS_DS","DS/VCXWebKernelTools/VCXMathTools"],function(e,t,i){"use strict";return e.extend({rewind:function(){this._parent(),this.iSwap=0,this.iPariteX=0,this.iPariteY=0,this.fX=0,this.dx=0,this.fY=this.fHalfSizeY-this.fCellSize,this.fY<0&&(this.fY=0),this.maxfx=this.fHalfSizeX-this.fCellSize-this.fCellSize,this.LRiPariteX=0,this.LRiPariteY=0,this.LRfX=this.fHalfSizeX-this.fCellSize,this.LRfX<0&&(this.LRfX=0),this.LRdy=0,this.LRfY=0,this.LRmaxfy=this.fHalfSizeY-this.fCellSize},next:function(){if(this._parent(),this.iSwap++,1&this.iSwap){if(this.LRiPariteY++,2===this.LRiPariteY&&(this.LRiPariteY=0,this.LRfY+=this.fCellSize,this.LRfY>this.fHalfSizeY-this.fCellSize&&(0===this.LRdy?this.LRdy=.5*this.fCellSize:this.LRdy=0,this.LRfY=0,this.LRfX-=this.fCellSize,this.LRfX<this.fCellSize)))return this.rewind(),!0}else if(0==this.fX&&this.iPariteX++,this.iPariteX++,2===this.iPariteX&&(this.iPariteX=0,this.fX+=this.fCellSize,this.fX>this.maxfx&&(this.maxfx-=this.fCellSize,this.maxfx<this.fCellSize&&(this.maxfx=this.fCellSize),0===this.dx?this.dx=.5*this.fCellSize:this.dx=0,this.fX=0,this.fY-=this.fCellSize,this.fY<this.fCellSize)))return this.rewind(),!0;return!1},getPoint:function(){var e=new t.Vector2;return 1&this.iSwap?(e.x=this.fHalfSizeX-this.LRfX,1&this.LRiPariteY?e.y=this.fHalfSizeY-this.LRfY+this.LRdy:e.y=this.fHalfSizeY+this.LRfY+this.LRdy):(1&this.iPariteX?e.x=this.fHalfSizeX-this.fX+this.dx:e.x=this.fHalfSizeX+this.fX+this.dx,e.y=this.fHalfSizeY+this.fY),e}})}),define("DS/VCXWebDressup/VCXDressupOrganisationShapeTop",["DS/VCXWebDressup/VCXDressupOrganisationShape","DS/Visualization/ThreeJS_DS"],function(e,t){"use strict";return e.extend({rewind:function(){this._parent(),this.iPariteX=0,this.fX=0,this.dx=0,this.fY=this.fHalfSizeY-this.fCellSize,this.fY<0&&(this.fY=0)},next:function(){return this._parent(),0===this.fX&&this.iPariteX++,this.iPariteX++,2===this.iPariteX&&(this.iPariteX=0,this.fX+=this.fCellSize,this.fX>this.fHalfSizeX-this.fCellSize&&(0===this.dx?this.dx=.5*this.fCellSize:this.dx=0,this.fX=0,this.fY-=this.fCellSize,this.fY<-this.fHalfSizeY+this.fCellSize))&&(this.rewind(),!0)},getPoint:function(){var e=new t.Vector2;return 1&this.iPariteX?e.x=this.fHalfSizeX-this.fX+this.dx:e.x=this.fHalfSizeX+this.fX+this.dx,e.y=this.fHalfSizeY-this.fY,e}})}),define("DS/VCXWebDressup/VCXBackgroundNode",["DS/VCXWebDressup/VCXDressupNode","DS/Visualization/ThreeJS_DS","DS/VCXWebVisualization/VCXImageManager","DS/Mesh/MeshUtils","DS/Visualization/SceneGraphFactory","DS/VCXWebDressup/VCXSmart3DPaperNode","DS/VCXWebProperties/VCXColor"],function(e,t,i,r,a,o,s){"use strict";return e.extend({init:function(e){return this._parent(e),this._previousBackgroundDocID=null,this},dispose:function(){this._Smart3DPaperNode&&(this._Smart3DPaperNode.dispose(),this._Smart3DPaperNode=null),this._parent()},_Build:function(e){var t=this.Modifiable.ExperienceBase.getManager("VCXVisuManager");this.setRenderPasses([t.getRenderList("VCXBackground")]),this._PrimitiveGroup=new r.PrimitiveGroup;var i=new r.Buffer({component:r.VertexComponentEnum.POSITION,data:new Float32Array(12)});i.dimension=3,this._PrimitiveGroup.addBuffer(0,i);var s=new r.Buffer({component:r.VertexComponentEnum.TEX_COORD_0,data:new Float32Array(16)});s.dimension=3,this._PrimitiveGroup.addBuffer(1,s);var n,l=new r.Buffer({indexBuffer:!0,data:new Uint16Array(6)});this._PrimitiveGroup.addBuffer(2,l);var p=0;(n=i.data)[p++]=0,n[p++]=0,n[p++]=0,n[p++]=1,n[p++]=0,n[p++]=0,n[p++]=1,n[p++]=-1,n[p++]=0,n[p++]=0,n[p++]=-1,n[p++]=0;p=0;(n=s.data)[p++]=0,n[p++]=1,n[p++]=0,n[p++]=1,n[p++]=1,n[p++]=0,n[p++]=1,n[p++]=0,n[p++]=0,n[p++]=0,n[p++]=0,n[p++]=0,p=0,(n=l.data)[p++]=0,n[p++]=2,n[p++]=1,n[p++]=0,n[p++]=3,n[p++]=2;var u=new r.Primitive({nbIndices:6,connectivity:r.ConnectivityTypeEnum.TRIANGLES,fillGAS:new r.FillAttributes}),h=new r.VertexComponent({nbVertices:4,bufferId:0,indices:new r.IndexArray({bufferId:2,offset:0})}),d=new r.VertexComponent({nbVertices:4,bufferId:1,indices:new r.IndexArray({bufferId:2,offset:0})});u.addVertexComponent(h),u.addVertexComponent(d),this._PrimitiveGroup.addPrimitive(u),this._MeshNode=a.createMeshNode(this._PrimitiveGroup),this.setMaterial(),this._MeshNode.setVisibilityInTree(!1);var c={name:"BackgroundSmartNode",experience:this.ExperienceBase};this._Smart3DPaperNode=new o(c),this._Smart3DPaperNode.BillboardType=2,this._Smart3DPaperNode.SizeControlType=1,this._Smart3DPaperNode.PositioningType=1e3,this._Smart3DPaperNode.Depth=0,this._Smart3DPaperNode.add(this._MeshNode),this.add(this._Smart3DPaperNode),this.traverse(function(e,t){return e.setPickable(r.PICKTHROUGH),e.excludeFromHighlight(t,t),!1},!0)},preRender:function(e){this._Smart3DPaperNode&&this._Smart3DPaperNode.preRender(e)},setMaterial:function(e){this._bodyMat||(this._bodyMat=new t.MeshBasicMaterial({side:t.FrontSide,forceSide:!0,color:"#ffffff",opacity:this.backgroundOpacity,force:!0,depthWrite:!1}),this._MeshNode&&this._MeshNode.setMaterial(this._bodyMat)),e?(this._bodyMat.map=e,this._bodyMat.needsUpdate=!0):(this._bodyMat.map=null,this._bodyMat.needsUpdate=!0)},update:function(e){this._parent();var r=this.ExperienceBase.getManager("VCXIVManager");if(r&&r.scenario&&r.scenario.transparentBackground){var a=this.ExperienceBase.getManager("VCXVisuManager");a&&a.setTransparentBackground(!0)}else{var o=this.GetColorPropertyValue("Environment.Background"),n=this.GetColorPropertyValue("Environment.Background.Foot"),l=this.GlobalOpacity,p=this.GetPropertyValue("Environment.Background.Override"),u=this.GetPropertyValue("Environment.Background.Gradient"),h=this.GetPropertyValue("Environment.Background.Image");null==h&&(h=-1);l=1;if(h>=0&&p?(l=this.GlobalOpacity,o=(new s).SetRGBA(1,1,1,1),n=(new s).SetRGBA(1,1,1,1)):l=0,this.backgroundOpacity=this.GlobalOpacity,this.backgroundOpacity=o.a,this._globalOpacity!==l){this._globalOpacity=l;var d=this._globalOpacity>0;d&&(this._Smart3DPaperNode||this._Build()),this._Smart3DPaperNode&&this._Smart3DPaperNode.setVisibility(d)}if((!this._hasBeenActivated&&p||this._hasBeenActivated)&&(u!==this._previousGradient||p!==this._previousBackgroundVisible||o&&!o.IsEqualTo(this._previousColor)||n&&!n.IsEqualTo(this._previousFootColor)||e&&e.force)){this._hasBeenActivated=!0,this._previousGradient=u,this._previousColor=o.Clone(),this._previousFootColor=n.Clone(),this._previousBackgroundVisible=p;var c=o.Clone();u&&c.Lerp(n,.5);var y=this.Modifiable.ExperienceBase.getManager("VCXContextManager"),m=this;y.applyToViewers(function(e){var t=e.ambience&&e.ambience.getBackground();t&&!t._initialType&&(t._initialType=t.getType()),p?(t&&t.setActivated(!1),e.setBackgroundColor(c.GetHex(),m.backgroundOpacity),u&&-1===h?e.setGradientBackground([o.GetHex(),c.GetHex(),n.GetHex()]):e.setGradientBackground(null)):t&&(t.setActivated(!0),t.setType(t._initialType))})}if(!(l<=0)&&this._MeshNode){if(this._previousBackgroundDocID!==h)if(this._previousBackgroundDocID=h,-1!==h){m=this;this.ExperienceBase.getManager("VCXImageManager").GetImageFromDocID(h,i.Effect.None).then(function(e){t.ImageUtils.loadTexture(e.toDataURL(),{},function(e){m.setMaterial(e),m=null})})}else this.setMaterial();this._Smart3DPaperNode&&this._bodyMat&&(this._bodyMat.opacity=this.backgroundOpacity);var C=this.Modifiable.ExperienceBase.getManager("VCXPaperManager");if(C){var f=C.Size;this._MeshNode.setMatrix((new t.Matrix4).makeScale(f.x,f.y,1))}}}}})}),define("DS/VCXWebDressup/VCXDressupOrganisationShapeBottom",["DS/VCXWebDressup/VCXDressupOrganisationShape","DS/Visualization/ThreeJS_DS","DS/VCXWebKernelTools/VCXMathTools"],function(e,t,i){"use strict";return e.extend({rewind:function(){this._parent(),this.iPariteX=0,this.fX=0,this.dx=0,this.fY=this.fHalfSizeY-this.fCellSize,this.fY<0&&(this.fY=0)},next:function(){return this._parent(),0===this.fX&&this.iPariteX++,this.iPariteX++,2===this.iPariteX&&(this.iPariteX=0,this.fX+=this.fCellSize,this.fX>this.fHalfSizeX-this.fCellSize&&(0===this.dx?this.dx=.5*this.fCellSize:this.dx=0,this.fX=0,this.fY-=this.fCellSize,this.fY<-this.fHalfSizeY+this.fCellSize))&&(this.rewind(),!0)},getPoint:function(){var e=new t.Vector2;return 1&this.iPariteX?e.x=this.fHalfSizeX-this.fX+this.dx:e.x=this.fHalfSizeX+this.fX+this.dx,e.y=this.fHalfSizeY+this.fY,e}})}),define("DS/VCXWebDressup/VCXAttachTooltipNode",["DS/Mesh/MeshUtils","DS/VCXWebDressup/VCXMarkup_Spec","DS/VCXWebDressup/VCXDressupNode","DS/VCXWebDressup/VCXExtremityNode","DS/VCXWebKernelTools/VCXMathTools","DS/Visualization/SceneGraphFactory","DS/Visualization/ThreeJS_DS","DS/Visualization/Node3D"],function(e,t,i,r,a,o,s,n){"use strict";var l=i.extend({init:function(e){return this._parent(e),this.anchorID=e.anchorID,this._bConsiderCurvature="boolean"!=typeof e.bConsiderCurvature||e.bConsiderCurvature,this.updateParams(),this._StartExtremity=new s.Vector3,this._EndExtremity=new s.Vector3,this._zValue=new s.Vector3,this},updateParams:function(){this._bConsiderCurvature||console.log("Shouldn't we consider a curvature at anytime, to be sure ?"),this._bGradientBackGround=this.GetPropertyValue("Collab.Attach.Background.Gradient"),this._bGradientBorder=this.GetPropertyValue("Collab.Attach.Border.Gradient"),this._step=this._bConsiderCurvature?32:1,this._verticesNb=2*this._step+1,this._lineIndicesNb=2*this._verticesNb;var e=2*this._step-1;this._trianglesIndicesNb=3*e},dispose:function(){this._Node&&this.removeChild(this._Node)},_getAngleBetweenXAxisAndVector:function(e){var t=new s.Vector3(1,0,0),i=new s.Vector3(0,1,0),r=Math.acos(t.dot(e));return i.dot(e)<0&&(r=2*Math.PI-r),r},_getArcVerticesPosFromStartEndPosRadDiffAndCurvSign:function(e,t,i,r,a){var o=[],n=new s.Vector3(0,0,1),l=a?1:-1,p=(new s.Vector3).addVectors(e,t).multiplyScalar(.5),u=(new s.Vector3).subVectors(e,t);u.cross(n),u.normalize(),p.x+=u.x*i,p.y+=u.y*i;var h,d,c,y=(new s.Vector3).subVectors(e,p),m=(new s.Vector3).subVectors(t,p);a?(h=y.length(),d=this._getAngleBetweenXAxisAndVector(y.normalize()),c=this._getAngleBetweenXAxisAndVector(m.normalize())):(h=m.length(),d=this._getAngleBetweenXAxisAndVector(m.normalize()),c=this._getAngleBetweenXAxisAndVector(y.normalize())),c-d<0&&r*l==1?d-=2*Math.PI:c-d>0&&r*l==-1&&(c-=2*Math.PI);for(var C,f=0,V=Math.abs((c-d)%(2*Math.PI)),b=0;b<=this._step;++b){var P=b/this._step;f=d+r*l*V*P,C=a?e.z*(1-P)+t.z*P:e.z*P+t.z*(1-P);var _=new s.Vector3(p.x+h*Math.cos(f),p.y+h*Math.sin(f),C);o.push(_)}return o},_getAttachShapeVerticesPositionsWithCurvature:function(e,t,i,r){var a=new s.Vector3(0,0,1),o=(new s.Vector3).subVectors(e,t),n=.5*o.length(),l=n;0===r&&(r=.001),l=Math.abs(100*l/r);var p=r>0?-1:1,u=(new s.Vector3).addVectors(e,t).multiplyScalar(.5),h=(l-n)*p;o.z=0,o.cross(a),o.normalize();var d=o.clone().multiplyScalar(h);u.add(d),u.z=0;var c=(new s.Vector3).subVectors(e,u);c.z=0,c.normalize();var y=(new s.Vector3).copy(c).multiplyScalar(2.5*i).add(e),m=(new s.Vector3).copy(c).multiplyScalar(-2.5*i).add(e),C=this._getArcVerticesPosFromStartEndPosRadDiffAndCurvSign(y,t,h,p,!0);C.pop();var f=this._getArcVerticesPosFromStartEndPosRadDiffAndCurvSign(m,t,h,p,!1);return C.concat(f)},_getAttachShapeVerticesPositionsWithoutCurvature:function(e,t,i){var r=[],a=new s.Vector3(0,0,1),o=(new s.Vector3).subVectors(e,t),n=(new s.Vector3).crossVectors(o,a).normalize(),l=(new s.Vector3).copy(n).multiplyScalar(2.5*i).add(e),p=(new s.Vector3).copy(n).multiplyScalar(-2.5*i).add(e);return r.push(l),r.push(t),r.push(p),r},_computePosBuffers:function(e,t,i){var r,a=this.ExperienceBase.getManager("VCXPaperManager"),o=this.StartExtremity.clone(),s=this.EndExtremity.clone(),n=a.ModelToMM2(e,o),l=a.ModelToMM2(e,s),p=this.GetPropertyValue("Collab.Attach.Line.Width");if(this._bConsiderCurvature){var u=this.GetPropertyValue("Collab.Attach.Curvature");r=this._getAttachShapeVerticesPositionsWithCurvature(n,l,p,u)}else r=this._getAttachShapeVerticesPositionsWithoutCurvature(n,l,p);for(var h=[],d=0;d<r.length;++d){var c=r[d],y=a.MMToModel2(e,c);h.push(y)}for(var m=h.length,C=0;C<m;++C)t[3*C+0]=h[C].x,t[3*C+1]=h[C].y,t[3*C+2]=h[C].z,i[3*C+0]=h[C].x,i[3*C+1]=h[C].y,i[3*C+2]=h[C].z},_computeColorBuffers:function(e,t){for(var i=this.GetColorPropertyValue("Collab.Attach.Line").GetRGBA(),r=0;r<=this._step;++r){var a=4*r,o=4*(this._verticesNb-1-r),s=this._bGradientBackGround?r*i[3]/this._step:i[3];e[a+0]=i[0],e[a+1]=i[1],e[a+2]=i[2],e[a+3]=s,e[o+0]=i[0],e[o+1]=i[1],e[o+2]=i[2],e[o+3]=s;var n=this._bGradientBorder?r*i[3]/this._step:i[3];t[a+0]=0,t[a+1]=0,t[a+2]=0,t[a+3]=n,t[o+0]=0,t[o+1]=0,t[o+2]=0,t[o+3]=n}},_computeBuffers:function(e,t,i,r,a){this._computePosBuffers(e,t,r),this._computeColorBuffers(i,a)},_Build:function(){this._bkGrndPrimGrp=new e.PrimitiveGroup({editable:!0}),this._borderPrimGrp=new e.PrimitiveGroup({editable:!0});var t=new e.Buffer({component:e.VertexComponentEnum.POSITION,data:new Float32Array(3*this._verticesNb),dimension:3}),i=new e.Buffer({component:e.VertexComponentEnum.DIFFUSE_COLOR,data:new Float32Array(4*this._verticesNb),dimension:4}),r=new e.Buffer({indexBuffer:!0,data:new Uint16Array(this._trianglesIndicesNb)}),a=new e.Buffer({component:e.VertexComponentEnum.POSITION,data:new Float32Array(3*this._verticesNb),dimension:3}),l=new e.Buffer({component:e.VertexComponentEnum.DIFFUSE_COLOR,data:new Float32Array(4*this._verticesNb),dimension:4}),p=new e.Buffer({indexBuffer:!0,data:new Uint16Array(this._lineIndicesNb)});this._bkGrndPrimGrp.addBuffer(0,t),this._bkGrndPrimGrp.addBuffer(1,i),this._bkGrndPrimGrp.addBuffer(2,r),this._borderPrimGrp.addBuffer(0,a),this._borderPrimGrp.addBuffer(1,l),this._borderPrimGrp.addBuffer(2,p);var u=0,h=0,d=r.data,c=this._verticesNb-1;for(h=0;h<this._step-1;++h)d[u++]=h,d[u++]=c-h,d[u++]=c-(h+1),d[u++]=h,d[u++]=c-(h+1),d[u++]=h+1;for(d[u++]=this._step-1,d[u++]=this._step+1,d[u++]=this._step,d=p.data,u=0,h=0;h<this._verticesNb;++h)d[u++]=h,d[u++]=h!==this._verticesNb-1?h+1:0;var y=new e.Primitive({nbIndices:this._trianglesIndicesNb,connectivity:e.ConnectivityTypeEnum.TRIANGLES}),m=new e.VertexComponent({nbVertices:this._verticesNb,bufferId:0,indices:new e.IndexArray({bufferId:2,offset:0})}),C=new e.VertexComponent({nbVertices:this._verticesNb,bufferId:1,indices:new e.IndexArray({bufferId:2,offset:0})});y.addVertexComponent(m),y.addVertexComponent(C),this._bkGrndPrimGrp.addPrimitive(y);var f=new e.Primitive({nbIndices:this._lineIndicesNb,connectivity:e.ConnectivityTypeEnum.LINES}),V=new e.VertexComponent({nbVertices:this._verticesNb,bufferId:0,indices:new e.IndexArray({bufferId:2,offset:0})}),b=new e.VertexComponent({nbVertices:this._verticesNb,bufferId:1,indices:new e.IndexArray({bufferId:2,offset:0})});f.addVertexComponent(V),f.addVertexComponent(b),this._borderPrimGrp.addPrimitive(f);this._bodyMat=new s.PhysicalMaterial({side:s.DoubleSide,vertexColors:s.VertexColors,color:"#ffffff",transparent:!0,useLighting:!1,opacity:1,force:!0,depthTest:!0,depthWrite:!1}),this._lineMat=new s.LineBasicMaterial({side:s.DoubleSide,vertexColors:s.VertexColors,color:"#ffffff",transparent:!0,opacity:1,polygonBorderMode:!1,force:!0,depthTest:!0,depthWrite:!1}),this._NodeBkGrnd=o.createMeshNode(this._bkGrndPrimGrp),this._NodeBkGrnd.setMaterial(this._bodyMat),this._NodeBkGrnd.setVisibilityInTree(!1),this._NodeBorder=o.createMeshNode(this._borderPrimGrp),this._NodeBorder.setMaterial(this._lineMat),this._NodeBorder.setVisibilityInTree(!1),this._Node=new n,this._Node.addChild(this._NodeBkGrnd),this._Node.addChild(this._NodeBorder),this.addChild(this._Node),this.handleLayers(!0)},preRender:function(t){var i=this._NodeBkGrnd.getBuffer(e.VertexComponentEnum.POSITION),r=this._NodeBkGrnd.getBuffer(e.VertexComponentEnum.DIFFUSE_COLOR),a=this._NodeBorder.getBuffer(e.VertexComponentEnum.POSITION),o=this._NodeBorder.getBuffer(e.VertexComponentEnum.DIFFUSE_COLOR);void 0!==i&&void 0!==r&&void 0!==a&&void 0!==o&&(this._computeBuffers(t,i,r,a,o),this._NodeBkGrnd.updateBuffer(e.VertexComponentEnum.POSITION,0,this._verticesNb),this._NodeBkGrnd.updateBuffer(e.VertexComponentEnum.DIFFUSE_COLOR,0,this._verticesNb),this._NodeBkGrnd.computeBoundingElements(),this._NodeBorder.updateBuffer(e.VertexComponentEnum.POSITION,0,this._verticesNb),this._NodeBorder.updateBuffer(e.VertexComponentEnum.DIFFUSE_COLOR,0,this._verticesNb),this._NodeBorder.computeBoundingElements())},update:function(e){if(this._parent(),this._globalOpacity!==this.GlobalOpacity){this._globalOpacity=this.GlobalOpacity;var t=this._globalOpacity>0;t&&(this._Node||this._Build()),this._Node&&(this._lineMat.setLineWidth(2),this._Node.setVisibility(t)),this._ExtremityNode&&this._ExtremityNode.setVisibility(t)}this._globalOpacity<=0||(this._ExtremityNode&&this._ExtremityNode.update(e),this._Node&&(this.updateParams(),this._bodyMat&&(this._bodyMat.opacity=this._globalOpacity),this._lineMat&&(this._lineMat.opacity=this._globalOpacity),this.handleLayers()))},postUpdate:function(e){this._parent(),this._ExtremityNode&&this._ExtremityNode.postUpdate(e)}});return Object.defineProperty(l.prototype,"StartExtremity",{enumerable:!0,get:function(){return this._StartExtremity},set:function(e){this._StartExtremity=e}}),Object.defineProperty(l.prototype,"EndExtremity",{enumerable:!0,get:function(){return this._EndExtremity},set:function(e){this._EndExtremity=e}}),l}),define("DS/VCXWebDressup/VCXPanelModifiable",["DS/VCXWebDressup/VCXDressupModifiable","DS/VCXWebDressup/VCXMarkupModifiable","DS/VCXWebDressup/VCXMarkup_Spec","DS/VCXWebDressup/VCXPanel_Spec","DS/VCXWebProperties/VCXPropertyValueEnum","DS/VCXWebProperties/VCXPropertyValueFloat","DS/VCXWebProperties/VCXPropertyValueBoolean","DS/VCXWebProperties/VCXPropertyValueString"],function(e,t,i,r,a,o,s,n){"use strict";return t.extend({init:function(){this._bIsPanel=!0,this._parent()},Build:function(){this._parent();var e=[{Name:"Collab.Markup.SubType",DefaultValue:r.ESubType.None},{Name:"Collab.Text.Show",DefaultValue:!1,FormatPainter:!0},{Name:"Collab.Text.Wordwrap",DefaultValue:!0},{Name:"Collab.Text.HAlignment",DefaultValue:i.EHTextAlignment.Justified,FormatPainter:!0},{Name:"Collab.Text.VAlignment",DefaultValue:i.EVTextAlignment.Top,FormatPainter:!0},{Name:"Collab.Body.InnerMargin",DefaultValue:0,FormatPainter:!0},{Name:"Collab.Body.Shape",DefaultValue:i.EBodyShape.Rectangle,FormatPainter:!0},{Name:"Collab.Body.Width",DefaultValue:100},{Name:"Collab.Body.Height",DefaultValue:100},{Name:"Collab.Border.Show",DefaultValue:!1,FormatPainter:!0},{Name:"Collab.Background.Show",DefaultValue:!1,FormatPainter:!0},{Name:"Collab.Image.Show",DefaultValue:!0},{Name:"Collab.Attach.Show",DefaultValue:!0,FormatPainter:!0},{Name:"Collab.3D.Paper.Billboard.Type",DefaultValue:2},{Name:"Collab.3D.Paper.Referential.In.World",DefaultValue:!1},{Name:"Collab.3D.Paper.Size.Control.Type",DefaultValue:1},{Name:"Actor.IsAlwaysOnTop",DefaultValue:!0,FormatPainter:!0},{Name:"Collab.Body.VAlignment",DefaultValue:i.EVAlignment.Bottom,visibleInPropertyGroups:!1},{Name:"Collab.3D.Paper.Positioning.Type",DefaultValue:i.EPositionType.Free2D},{Name:"Collab.UseDepthFromAnchor",Type:s,DefaultValue:!1,visibleInPropertyGroups:!1,Persistent:!1}];this._BuildPropertyValues(e)},SetPropertiesInfo:function(){this._parent(),this.SetPropertyInvisible("Collab.3D.Paper.Positioning.Type",!0),this.GetPropertyValue("Collab.Markup.SubType")===r.ESubType.Image||this.GetPropertyValue("Collab.Markup.SubType")===r.ESubType.Text?(this.SetPropertyInvisible("Collab.Image.Color",!0),this.SetPropertyInvisible("Collab.Image.Color.Opacity",!0),this.SetPropertyInvisible("Collab.Image.Scale",!0),this.ChangeGroupAvailability("Group.Attach",e.EAvailability.AppForceNotAvailable),this.GetPropertyValue("Collab.Markup.SubType")===r.ESubType.Image&&(this.SetPropertyInvisible("Collab.Text",!0),this.ChangeGroupAvailability("Group.Text",e.EAvailability.AppForceNotAvailable),this.ChangeGroupAvailability("Group.Background",e.EAvailability.AppForceNotAvailable),this.ChangeGroupAvailability("Group.Image",e.EAvailability.NoControl))):(this.ChangeGroupAvailability("Group.Image",e.EAvailability.NoControl),this.ChangeGroupAvailability("Group.Attach",e.EAvailability.NoControl))},Set2DPanelProperties:function(e,t,i){var r=new a(e);this.OnChangeProperty("Collab.Markup.SubType",r);var l=new s(!1);if(this.OnChangeProperty("Collab.Body.FitToText",l),this._Properties["Collab.Text.Font"].GetPropertyValue().SetHeight(new o(30)),this.OnChangeProperty("Collab.Border.Show",new s(!0)),this.OnChangeProperty("Collab.Border.Line.Color.Opacity",new o(0)),this.OnChangeProperty("Collab.Background.Show",new s(!0)),this.OnChangeProperty("Collab.Background.Color.Opacity",new o(.5)),this.OnChangeProperty("Collab.Image.Show",new s(Boolean(t))),this.OnChangeProperty("Collab.Text.Show",new s(!t)),t&&this.OnChangeProperty("Collab.Image.Doc.ID",t),i){var p=new s(!0);this.OnChangeProperty("Collab.Text.Show",p);var u=new n(i);this.OnChangeProperty("Collab.Text",u);var h=new o(2);this.OnChangeProperty("Collab.Body.InnerMargin",h)}this.OnChangeProperty("Collab.Body.KeepAspectRatio",new s(!1));var d=new s(!1);this.OnChangeProperty("Collab.Attach.Show",d);var c=new a(2);this.OnChangeProperty("Collab.3D.Paper.Billboard.Type",c);var y=new a(1);this.OnChangeProperty("Collab.3D.Paper.Size.Control.Type",y);var m=new a(1e3);this.OnChangeProperty("Collab.3D.Paper.Positioning.Type",m);var C=new o(this.GetObject()._experienceBase.getManager("VCXDressupManager").GetDepthInformation().highest+1);this.OnChangeProperty("Collab.3D.Paper.Depth",C),this.OnChangeProperty("Collab.Body.Width",new o(40)),this.OnChangeProperty("Collab.Body.Height",new o(30)),this.OnChangeProperty("Collab.Body.Shadow.Show",new s(!0))}})}),define("DS/VCXWebDressup/VCXDiggerPanelModifiable",["DS/VCXWebDressup/VCXDressupModifiable","DS/VCXWebDressup/VCXPanelModifiable","DS/VCXWebProperties/VCXPropertyValueString","DS/VCXWebDressup/VCXPanel_Spec"],function(e,t,i,r){"use strict";return t.extend({init:function(){this._parent()},Build:function(){this._parent();var t=[{Name:"Collab.AssociatedObjectID",Type:i,DefaultValue:""},{Name:"Collab.Attach.Availability",DefaultValue:e.EAvailability.NoControl},{Name:"Collab.Markup.SubType",DefaultValue:r.ESubType.Image}];this._BuildPropertyValues(t),this.SetPropertyInvisible("Collab.AssociatedObjectID",!0)},SetPropertiesInfo:function(){this._parent(),this.ChangeGroupAvailability("Group.Attach",e.EAvailability.NoControl),this.SetPropertyInvisible("Collab.Image.Color",!1),this.SetPropertyInvisible("Collab.Image.Color.Opacity",!1)}})}),define("DS/VCXWebDressup/VCXLabel_Spec",["DS/VCXWebDressup/VCXMarkup_Spec"],function(e){"use strict";var t=e.extend({init:function(){this._parent(),this._IsAnchorDependent=!0}});return t.prototype.getDefaultName=function(){return"Label"},Object.defineProperty(t.prototype,"componentType",{enumerable:!0,get:function(){return"VCXLabel_Spec"}}),t.prototype.dressupGroupName="Annotations",t}),define("DS/VCXWebDressup/VCXMeasurement_Spec",["DS/VCXWebDressup/VCXLabel_Spec","DS/VCXWebDressup/VCXMarkup_Spec","DS/Visualization/ThreeJS_DS","DS/VCXWebKernelTools/VCXMathTools"],function(e,t,i,r){"use strict";var a=e.extend({init:function(){this._parent(),this.IsAnchorDependent=!0,this._keyValues={}},getAttachType:function(){var e=this.QueryInterface("VCXIModifiable");if(e)switch(e.GetPropertyValue("Collab.Measurement.Type")){case a.EType.Arc:case a.EType.GDT:case a.EType.Area:case a.EType.Volume:case a.EType.PipeLength:case a.EType.AreaMultiplePoints:case a.EType.VolumeMultiplePoints:case a.EType.PipeLengthMultiplePoints:case a.EType.Coord:case a.EType.Projected:return a.EAttachType.Simple;case a.EType.Angle:return a.EAttachType.Double;case a.EType.BetweenAxis:case a.EType.BetweenLines:case a.EType.BetweenPlanes:case a.EType.PlanePoint:case a.EType.LinePoint:case a.EType.BetweenPoints:case a.EType.Linear:case a.EType.BetweenCentres:return a.EAttachType.Double;case a.EType.Diameter:case a.EType.Radius:return e.GetPropertyValue("Collab.Measurement.Attach.Type")}},getKeyPoints:function(e,o){var s=this.QueryInterface("VCXIModifiable");if(s){switch(this._keyValues.labelLineExtremity0=r.getOFromMatrix(o.getMatrix()),this.newLabel0Position=this._keyValues.labelLineExtremity0,s.GetPropertyValue("Collab.Measurement.Type")){case a.EType.Arc:case a.EType.GDT:case a.EType.QuotationArc:case a.EType.Area:case a.EType.Volume:case a.EType.PipeLength:case a.EType.AreaMultiplePoints:case a.EType.VolumeMultiplePoints:case a.EType.PipeLengthMultiplePoints:case a.EType.BetweenAxis:case a.EType.BetweenCentres:case a.EType.Coord:case a.EType.Projected:break;case a.EType.Angle:this._keyValues.angle=!0,this._keyValues.measurementExtremity1||this.getValue(e,o);break;case a.EType.BetweenLines:case a.EType.BetweenPlanes:case a.EType.PlanePoint:case a.EType.LinePoint:this._keyValues.measurementExtremity1||this.getValue(e,o);break;case a.EType.Linear:this._getMeasurementExtremity1(),this._keyValues.measurementExtremity2=new i.Vector3(this.getValue(e,o),0,0).applyMatrix4(this._keyValues.measurementExtremity1Frame);break;case a.EType.BetweenPoints:var n=(new i.Vector3).subVectors(this._getMeasurementExtremity2(),this._getMeasurementExtremity1()).normalize();this._keyValues.measurementExtremity1Frame=r.getMatrixFromOVxVy(this._keyValues.measurementExtremity1,n,this.newLabel0Position);break;case a.EType.Radius:case a.EType.Diameter:if(!this._keyValues.labelLineExtremity1||!this._keyValues.labelLineExtremity2){this._keyValues.measurementExtremity0Frame=s.GetAnchorWorldMatrix(0,e),this._keyValues.measurementExtremity0=r.getOFromMatrix(this._keyValues.measurementExtremity0Frame),this._keyValues.value=s.GetPropertyValue("Collab.Measurement.Radius");var l=(new i.Vector3).subVectors(this.newLabel0Position,this._keyValues.measurementExtremity0),p=r.getVzFromMatrix(this._keyValues.measurementExtremity0Frame);p.normalize();n=(new i.Vector3).crossVectors(p,l).normalize();s.GetPropertyValue("Collab.Measurement.Type")===a.EType.Radius?(n.multiplyScalar(this._keyValues.value),this._keyValues.measurementExtremity1=this._keyValues.measurementExtremity0.clone()):(n.multiplyScalar(.5*this._keyValues.value),this._keyValues.measurementExtremity1=this._keyValues.measurementExtremity0.clone().add(n)),this._keyValues.measurementExtremity2=this._keyValues.measurementExtremity0.clone().sub(n),n.negate().normalize(),this._keyValues.measurementExtremity1Frame=r.getMatrixFromOVxVy(this._keyValues.measurementExtremity1,n,p),this._keyValues.labelLineExtremity1=this._keyValues.measurementExtremity1.clone().add(l),this._keyValues.labelLineExtremity2=this._keyValues.measurementExtremity2.clone().add(l),this._keyValues.arrowLineExtremity1=this._keyValues.labelLineExtremity1,this._keyValues.arrowLineExtremity2=this._keyValues.labelLineExtremity2}}switch(s.GetPropertyValue("Collab.Measurement.Type")){case a.EType.Arc:case a.EType.Area:case a.EType.Volume:case a.EType.PipeLength:case a.EType.AreaMultiplePoints:case a.EType.VolumeMultiplePoints:case a.EType.PipeLengthMultiplePoints:case a.EType.Radius:case a.EType.Diameter:case a.EType.GDT:case a.EType.Coord:case a.EType.Projected:break;case a.EType.Angle:case a.EType.BetweenLines:case a.EType.BetweenPlanes:case a.EType.LinePoint:case a.EType.BetweenPoints:case a.EType.PlanePoint:case a.EType.BetweenAxis:case a.EType.BetweenCentres:if(o.PositioningType<=t.EPositionType.Free2D){n=(new i.Vector3).subVectors(this._getMeasurementExtremity2(),this._getMeasurementExtremity1()).normalize();var u=(new i.Vector3).subVectors(this.newLabel0Position,e.viewpoint.getEyePosition()).normalize(),h=r.getNearestDistanceBetween2Lines(this.newLabel0Position,u,this._getMeasurementExtremity1(),n);this.newLabel0Position=h.p1}}switch(s.GetPropertyValue("Collab.Measurement.Type")){case a.EType.Arc:case a.EType.Area:case a.EType.Volume:case a.EType.PipeLength:case a.EType.AreaMultiplePoints:case a.EType.VolumeMultiplePoints:case a.EType.PipeLengthMultiplePoints:case a.EType.Radius:case a.EType.Diameter:case a.EType.GDT:case a.EType.Coord:case a.EType.Projected:break;case a.EType.Angle:case a.EType.BetweenLines:case a.EType.BetweenPlanes:case a.EType.LinePoint:case a.EType.BetweenPoints:case a.EType.PlanePoint:case a.EType.BetweenAxis:case a.EType.Linear:case a.EType.BetweenCentres:if(!this._keyValues.labelLineExtremity1||!this._keyValues.labelLineExtremity2)if(this._keyValues.angle){var d=(new i.Plane).setFromNormalAndCoplanarPoint(r.getVzFromMatrix(this._keyValues.measurementExtremity0Frame),this._keyValues.measurementExtremity0);this._keyValues.projectedPoint=d.projectPoint(this.newLabel0Position),this._keyValues.radius=this._keyValues.projectedPoint.distanceTo(this._keyValues.measurementExtremity1);var c=Math.max(this._keyValues.radius,this._keyValues.measurementAnglePoint1.distanceTo(this._keyValues.measurementExtremity0)),y=(new i.Vector3).subVectors(this._keyValues.measurementExtremity5,this._keyValues.measurementExtremity1).normalize();this._keyValues.labelLineExtremity1=this._keyValues.measurementExtremity1.clone().add(y.clone().multiplyScalar(c)),this._keyValues.labelLineExtremity1Frame=this._keyValues.measurementExtremity1Frame.clone().setPosition(this._keyValues.labelLineExtremity1),this._keyValues.arrowLineExtremity1=this._keyValues.measurementExtremity1.clone().add(y.clone().multiplyScalar(this._keyValues.radius));c=Math.max(this._keyValues.radius,this._keyValues.measurementAnglePoint2.distanceTo(this._keyValues.measurementExtremity0));s.GetPropertyValue("Collab.Measurement.Type")===a.EType.BetweenLines&&(c=Math.max(this._keyValues.radius,s.GetPropertyValue("Collab.Measurement.Length2")));var m=(new i.Vector3).subVectors(this._keyValues.measurementExtremity6,this._keyValues.measurementExtremity2).normalize();this._keyValues.labelLineExtremity2=this._keyValues.measurementExtremity2.clone().add(m.clone().multiplyScalar(c)),this._keyValues.labelLineExtremity2Frame=this._keyValues.measurementExtremity1Frame.clone().setPosition(this._keyValues.labelLineExtremity2),this._keyValues.arrowLineExtremity2=this._keyValues.measurementExtremity2.clone().add(m.clone().multiplyScalar(this._keyValues.radius))}else{n=(new i.Vector3).subVectors(this._getMeasurementExtremity2(),this._getMeasurementExtremity1());var C=(new i.Vector3).subVectors(this.newLabel0Position,this._getMeasurementExtremity1()),f=(new i.Vector3).crossVectors(n,C).normalize(),V=(new i.Vector3).crossVectors(f,n).normalize(),b=C.dot(V);V.multiplyScalar(b),this._keyValues.labelLineExtremity1=V.clone().add(this._getMeasurementExtremity1()),this._keyValues.labelLineExtremity2=V.clone().add(this._getMeasurementExtremity1()).add(n),this._keyValues.arrowLineExtremity1=this._keyValues.labelLineExtremity1,this._keyValues.arrowLineExtremity2=this._keyValues.labelLineExtremity2}}}return this._keyValues},_getMeasurementExtremity1:function(){if(!this._keyValues.measurementExtremity1){var e=this.QueryInterface("VCXIModifiable");e&&(this._keyValues.measurementExtremity1Frame=e.GetAnchorWorldMatrix(0,null),this._keyValues.measurementExtremity1=r.getOFromMatrix(this._keyValues.measurementExtremity1Frame))}return this._keyValues.measurementExtremity1},_getMeasurementExtremity2:function(){if(!this._keyValues.measurementExtremity2){var e=this.QueryInterface("VCXIModifiable");e&&(this._keyValues.measurementExtremity2Frame=e.GetAnchorWorldMatrix(1,null),this._keyValues.measurementExtremity2=r.getOFromMatrix(this._keyValues.measurementExtremity2Frame))}return this._keyValues.measurementExtremity2},_getMeasurementExtremity3:function(){if(!this._keyValues.measurementExtremity3){var e=this.QueryInterface("VCXIModifiable");e&&(this._keyValues.measurementExtremity3Frame=e.GetAnchorWorldMatrix(2,null),this._keyValues.measurementExtremity3=r.getOFromMatrix(this._keyValues.measurementExtremity3Frame))}return this._keyValues.measurementExtremity3},getValue:function(e,t){if(void 0===this._keyValues.value){this.newLabel0Position||(this.newLabel0Position=r.getOFromMatrix(this.getReferential()));var o=this.QueryInterface("VCXIModifiable");if(o)switch(o.GetPropertyValue("Collab.Measurement.Type")){case a.EType.GDT:case a.EType.Projected:this._keyValues.value=o._Properties["Collab.Measurement.Value"].GetPropertyValue().Value;break;case a.EType.Radius:case a.EType.Diameter:this._keyValues.value=o.GetPropertyValue("Collab.Measurement.Radius");break;case a.EType.Arc:case a.EType.PipeLength:case a.EType.PipeLengthMultiplePoints:case a.EType.Linear:this._keyValues.value=o.GetPropertyValue("Collab.Measurement.Length");break;case a.EType.Coord:this._keyValues.value=0;break;case a.EType.Area:case a.EType.AreaMultiplePoints:this._keyValues.value=o.GetPropertyValue("Collab.Measurement.Area");break;case a.EType.Volume:case a.EType.VolumeMultiplePoints:this._keyValues.value=o.GetPropertyValue("Collab.Measurement.Volume");break;case a.EType.BetweenAxis:case a.EType.BetweenPoints:case a.EType.BetweenCentres:this._keyValues.value=this._getMeasurementExtremity1().distanceTo(this._getMeasurementExtremity2());break;case a.EType.Angle:this._keyValues.angle=!0,this._getMeasurementExtremity1(),this._getMeasurementExtremity2(),this._getMeasurementExtremity3(),this._keyValues.measurementAnglePoint1=this._keyValues.measurementExtremity3.clone(),this._keyValues.measurementAnglePoint2=this._keyValues.measurementExtremity2.clone(),this._keyValues.measurementExtremity4=this._keyValues.measurementExtremity2.clone(),this._keyValues.measurementExtremity4Frame=this._keyValues.measurementExtremity2Frame.clone().setPosition(this._keyValues.measurementExtremity4),this._keyValues.measurementExtremity2=this._keyValues.measurementExtremity1.clone(),this._keyValues.measurementExtremity2Frame=this._keyValues.measurementExtremity1Frame.clone().setPosition(this._keyValues.measurementExtremity2),this._keyValues.measurementExtremity5=this._keyValues.measurementExtremity3.clone(),this._keyValues.measurementExtremity5Frame=this._keyValues.measurementExtremity3Frame.clone().setPosition(this._keyValues.measurementExtremity5),this._keyValues.measurementExtremity6=this._keyValues.measurementExtremity4.clone(),this._keyValues.measurementExtremity6Frame=this._keyValues.measurementExtremity4Frame.clone().setPosition(this._keyValues.measurementExtremity6);var s=(new i.Vector3).subVectors(this._keyValues.measurementExtremity3,this._keyValues.measurementExtremity1).normalize(),n=(new i.Vector3).subVectors(this._keyValues.measurementExtremity4,this._keyValues.measurementExtremity2).normalize();this._keyValues.value=s.angleTo(n),this._keyValues.measurementExtremity0=this._keyValues.measurementExtremity1,this._keyValues.measurementExtremity0Frame=r.getMatrixFromOVxVy(this._keyValues.measurementExtremity1,s,n);break;case a.EType.BetweenLines:if(this._getMeasurementExtremity1(),this._getMeasurementExtremity2(),V=r.getNearestDistanceBetween2Lines(this._getMeasurementExtremity1(),r.getVxFromMatrix(this._keyValues.measurementExtremity1Frame),this._getMeasurementExtremity2(),r.getVxFromMatrix(this._keyValues.measurementExtremity2Frame)))if(this._keyValues.measurementExtremity3Frame=this._keyValues.measurementExtremity1Frame.clone(),this._keyValues.measurementExtremity3=this._keyValues.measurementExtremity1.clone(),this._keyValues.measurementExtremity4Frame=this._keyValues.measurementExtremity2Frame.clone(),this._keyValues.measurementExtremity4=this._keyValues.measurementExtremity2.clone(),Math.abs(V.d)<=.001){this._keyValues.angle=!0,"Angle"!==o._Properties["Collab.Measurement.Value"].GetPropertyInfo().GetUnitType()&&o._Properties["Collab.Measurement.Value"].GetPropertyInfo().SetUnitType("Angle");var l=r.getVxFromMatrix(this._keyValues.measurementExtremity1Frame).normalize(),p=r.getVxFromMatrix(this._keyValues.measurementExtremity2Frame).normalize();if(this.newLabel0Position){var u=(new i.Vector3).crossVectors(l,p).normalize(),h=(new i.Plane).setFromNormalAndCoplanarPoint(u,V.p1);this._keyValues.projectedPoint=h.projectPoint(this.newLabel0Position),this._keyValues.radius=this._keyValues.projectedPoint.distanceTo(V.p1);var d=this._keyValues.projectedPoint.clone().sub(V.p1).normalize(),c=(new i.Vector3).crossVectors(l,d).normalize();u.dot(c)<0&&p.negate();u=(new i.Vector3).crossVectors(p,l).normalize();var y=this._keyValues.projectedPoint.clone().sub(V.p2).normalize();c=(new i.Vector3).crossVectors(p,y).normalize();u.dot(c)<0&&l.negate()}this._keyValues.measurementExtremity5=V.p1.clone().add(l.clone().multiplyScalar(this._keyValues.radius)),this._keyValues.measurementExtremity5Frame=this._keyValues.measurementExtremity1Frame.clone().setPosition(this._keyValues.measurementExtremity5),this._keyValues.measurementExtremity6=V.p2.clone().add(p.clone().multiplyScalar(this._keyValues.radius)),this._keyValues.measurementExtremity6Frame=this._keyValues.measurementExtremity2Frame.clone().setPosition(this._keyValues.measurementExtremity6),this._keyValues.measurementAnglePoint1=V.p1.clone().add(l.clone().multiplyScalar(o.GetPropertyValue("Collab.Measurement.Length1"))),this._keyValues.measurementAnglePoint2=V.p2.clone().add(p.clone().multiplyScalar(o.GetPropertyValue("Collab.Measurement.Length2"))),this._keyValues.value=l.angleTo(p),this._keyValues.measurementExtremity1=V.p1,this._keyValues.measurementExtremity2=V.p2,this._keyValues.measurementExtremity0=V.p1,this._keyValues.measurementExtremity0Frame=r.getMatrixFromOVxVy(V.p1,l,p)}else this._keyValues.angle=!1,"Length"!==o._Properties["Collab.Measurement.Value"].GetPropertyInfo().GetUnitType()&&o._Properties["Collab.Measurement.Value"].GetPropertyInfo().SetUnitType("Length"),this._keyValues.measurementExtremity1=V.p1,this._keyValues.measurementExtremity2=V.p2,this._keyValues.value=V.d;break;case a.EType.LinePoint:this._getMeasurementExtremity1(),this._getMeasurementExtremity2(),this._keyValues.measurementExtremity3Frame=this._keyValues.measurementExtremity1Frame.clone(),this._keyValues.measurementExtremity3=this._keyValues.measurementExtremity1.clone(),new i.Ray(this._keyValues.measurementExtremity3,r.getVxFromMatrix(this._keyValues.measurementExtremity3Frame)).closestPointToPoint(this._keyValues.measurementExtremity2,this._keyValues.measurementExtremity1),this._keyValues.value=this._keyValues.measurementExtremity2.distanceTo(this._keyValues.measurementExtremity1);break;case a.EType.PlanePoint:if(!this._keyValues.measurementExtremity1){this._getMeasurementExtremity1();var m=(new i.Plane).setFromNormalAndCoplanarPoint(r.getVzFromMatrix(this._keyValues.measurementExtremity1Frame),this._getMeasurementExtremity1());this._keyValues.measurementExtremity3Frame=this._keyValues.measurementExtremity1Frame.clone(),this._keyValues.measurementExtremity3=r.getOFromMatrix(this._keyValues.measurementExtremity3Frame),this._keyValues.measurementExtremity4Frame=this._keyValues.measurementExtremity1Frame.clone(),this._getMeasurementExtremity2(),this._keyValues.value=Math.abs(m.distanceToPoint(this._keyValues.measurementExtremity2)),this._keyValues.measurementExtremity1=m.projectPoint(this._keyValues.measurementExtremity2),this._keyValues.measurementExtremity1Frame.setPosition(this._keyValues.measurementExtremity1);var C=(new i.Plane).setFromNormalAndCoplanarPoint(r.getVzFromMatrix(this._keyValues.measurementExtremity1Frame),this._getMeasurementExtremity2());this._keyValues.measurementExtremity4=C.projectPoint(this._keyValues.measurementExtremity3),this._keyValues.measurementExtremity4Frame.setPosition(this._keyValues.measurementExtremity4)}break;case a.EType.BetweenPlanes:if(!this._keyValues.measurementExtremity1){this._getMeasurementExtremity1();m=(new i.Plane).setFromNormalAndCoplanarPoint(r.getVzFromMatrix(this._keyValues.measurementExtremity1Frame),this._getMeasurementExtremity1());this._getMeasurementExtremity2();C=(new i.Plane).setFromNormalAndCoplanarPoint(r.getVzFromMatrix(this._keyValues.measurementExtremity2Frame),this._getMeasurementExtremity2());this._keyValues.measurementExtremity3=this._keyValues.measurementExtremity1.clone(),this._keyValues.measurementExtremity3Frame=this._keyValues.measurementExtremity1Frame.clone();var f=r.getVzFromMatrix(this._keyValues.measurementExtremity2Frame).normalize().dot(r.getVzFromMatrix(this._keyValues.measurementExtremity1Frame).normalize());if(Math.abs(f)>=.999)this._keyValues.measurementExtremity4=C.projectPoint(this._keyValues.measurementExtremity1),this._keyValues.measurementExtremity4Frame=this._keyValues.measurementExtremity2Frame.clone().setPosition(this._keyValues.measurementExtremity4),this._keyValues.measurementExtremity5=m.projectPoint(this._keyValues.measurementExtremity2),this._keyValues.measurementExtremity5Frame=this._keyValues.measurementExtremity1Frame.clone().setPosition(this._keyValues.measurementExtremity5),this._keyValues.measurementExtremity6=this._keyValues.measurementExtremity2.clone(),this._keyValues.measurementExtremity6Frame=this._keyValues.measurementExtremity2Frame.clone(),this._keyValues.value=Math.abs(m.distanceToPoint(this._keyValues.measurementExtremity2)),this._keyValues.angle=!1,"Length"!==o._Properties["Collab.Measurement.Value"].GetPropertyInfo().GetUnitType()&&o._Properties["Collab.Measurement.Value"].GetPropertyInfo().SetUnitType("Length"),this._keyValues.measurementExtremity1=(new i.Vector3).addVectors(this._keyValues.measurementExtremity3,this._keyValues.measurementExtremity5).multiplyScalar(.5),this._keyValues.measurementExtremity1Frame.setPosition(this._keyValues.measurementExtremity1),this._keyValues.measurementExtremity2=(new i.Vector3).addVectors(this._keyValues.measurementExtremity4,this._keyValues.measurementExtremity6).multiplyScalar(.5),this._keyValues.measurementExtremity2Frame.setPosition(this._keyValues.measurementExtremity2);else{this._keyValues.angle=!0,this._keyValues.measurementAnglePoint2=this._keyValues.measurementExtremity2.clone(),"Angle"!==o._Properties["Collab.Measurement.Value"].GetPropertyInfo().GetUnitType()&&o._Properties["Collab.Measurement.Value"].GetPropertyInfo().SetUnitType("Angle");var V,b=r.getVzFromMatrix(this._keyValues.measurementExtremity1Frame).normalize(),P=r.getVzFromMatrix(this._keyValues.measurementExtremity2Frame).normalize(),_=(u=(new i.Vector3).crossVectors(b,P).normalize(),(new i.Vector3).crossVectors(b,u).normalize()),g=(new i.Vector3).crossVectors(P,u).normalize();if((V=r.getNearestDistanceBetween2Lines(this._getMeasurementExtremity1(),_,this._getMeasurementExtremity2(),g)).p2){var S=V.p2,M=this._keyValues.measurementExtremity1.clone().add(V.p2).sub(V.p1),D=this._keyValues.measurementExtremity2.clone();l=(new i.Vector3).subVectors(M,S),p=(new i.Vector3).subVectors(D,S);if(this.newLabel0Position){h=(new i.Plane).setFromNormalAndCoplanarPoint(u,S);this._keyValues.projectedPoint=h.projectPoint(this.newLabel0Position),this._keyValues.radius=this._keyValues.projectedPoint.distanceTo(S),this._keyValues.measurementAnglePoint1=h.projectPoint(this._keyValues.measurementExtremity1)}this._keyValues.measurementExtremity0=S.clone(),this._keyValues.measurementExtremity0Frame=r.getMatrixFromOVxVy(S,l,p),this._keyValues.measurementExtremity4=this._keyValues.measurementExtremity2.clone(),this._keyValues.measurementExtremity4Frame=this._keyValues.measurementExtremity2Frame.clone(),this._keyValues.measurementExtremity5=S.clone().add(l.clone().multiplyScalar(this._keyValues.radius)),this._keyValues.measurementExtremity5Frame=r.getMatrixFromOVxVz(S,l,r.getVzFromMatrix(this._keyValues.measurementExtremity1Frame)),this._keyValues.measurementExtremity6=S.clone().add(p.clone().multiplyScalar(this._keyValues.radius)),this._keyValues.measurementExtremity6Frame=r.getMatrixFromOVxVz(S,p,r.getVzFromMatrix(this._keyValues.measurementExtremity2Frame)),this._keyValues.value=l.angleTo(p),this._keyValues.measurementExtremity1=S.clone(),this._keyValues.measurementExtremity2=S.clone()}}}}}return this._keyValues.value},getReferential:function(){if(this._keyValues.referential)return this._keyValues.referential;var e=this.QueryInterface("VCXIModifiable");if(e)switch(e.GetPropertyValue("Collab.Measurement.Type")){case a.EType.LinePoint:case a.EType.BetweenLines:var t=e.GetAnchorWorldMatrix(0,null),o=r.getOFromMatrix(t),s=e.GetAnchorWorldMatrix(1,null),n=r.getOFromMatrix(s),l=(new i.Vector3).addVectors(n,o).multiplyScalar(.5),p=this.QueryInterface("W3AISGNodeHolder");return this._keyValues.referential=p.getAnchorReferential(),this._keyValues.referential.setPosition(l),this._keyValues.referential;case a.EType.Angle:t=e.GetAnchorWorldMatrix(0,null),o=r.getOFromMatrix(t),s=e.GetAnchorWorldMatrix(1,null),n=r.getOFromMatrix(s);var u=e.GetAnchorWorldMatrix(2,null),h=r.getOFromMatrix(u),d=(new i.Vector3).subVectors(n,o),c=(new i.Vector3).subVectors(h,o);return d.lengthSq()<1e-4&&(d=new i.Vector3(1,0,0)),this._keyValues.referential=r.getMatrixFromOVxVy(o,d,c),this._keyValues.referential;case a.EType.PlanePoint:case a.EType.BetweenPlanes:case a.EType.BetweenPoints:t=e.GetAnchorWorldMatrix(0,null),o=r.getOFromMatrix(t),s=e.GetAnchorWorldMatrix(1,null),n=r.getOFromMatrix(s);var y=(new i.Vector3).subVectors(n,o);return y.lengthSq()<1e-4&&(y=new i.Vector3(1,0,0)),this._keyValues.referential=r.getMatrixFromOVx(o,y),this._keyValues.referential}p=this.QueryInterface("W3AISGNodeHolder");return this._keyValues.referential=p.getAnchorReferential(),this._keyValues.referential},postUpdate:function(e){this._parent(e),this._keyValues={}}});return a.ESymbol={None:0,Straightness:1,Flatness:2,Circularity:3,Cylindricity:4,LineProfile:5,SurfaceProfile:6,Angularity:7,Perpendicularity:8,Parallelism:9,Position:10,Concentricity:11,Symmetry:12,CircularRunout:13,TotalRunout:14,ProjectedToleranceZone:15,MaxMaterialCondition:16,MinMaterialCondition:17,FreeStateVariations:18,Diameter:20,PlusMinus:21,Plus:22,Minus:23,Equal:24,ToBeDefined:25},a.EAttachType={Simple:0,Double:1},a.EType={Arc:110,Angle:120,Linear:130,Diameter:140,GDT:150,BetweenAxis:160,BetweenCentres:170,BetweenPlanes:180,PlanePoint:190,BetweenPoints:200,Area:220,Volume:230,PipeLength:240,AreaMultiplePoints:250,VolumeMultiplePoints:260,PipeLengthMultiplePoints:270,BetweenLines:280,LinePoint:290,Radius:300,Coord:310,Projected:320},a.prototype.getDefaultName=function(){return"Measurement"},Object.defineProperty(a.prototype,"componentType",{enumerable:!0,get:function(){return"VCXMeasurement_Spec"}}),a.prototype.dressupGroupName="Measurements",a}),define("DS/VCXWebDressup/VCXMeasurementModifiable",["DS/VCXWebDressup/VCXDressupModifiable","DS/VCXWebDressup/VCXMeasurement_Spec","DS/VCXWebDressup/VCXMarkupModifiable","DS/VCXWebDressup/VCXMarkup_Spec","DS/VCXWebKernelTools/VCXMathTools","DS/VCXWebDressup/VCXPropertyValueUnitFormater","DS/VCXWebUnits/VCXUnitType","DS/VCXWebProperties/VCXColor","DS/VCXWebProperties/VCXPropertyValueFloat","DS/VCXWebProperties/VCXPropertyValueString","DS/VCXWebProperties/VCXPropertyValueBoolean","DS/VCXWebProperties/VCXPropertyValueEnum"],function(e,t,i,r,a,o,s,n,l,p,u,h){"use strict";return i.extend({init:function(){this._bIsMeasurement=!0,this._parent()},Build:function(){this._parent();var e=this._generateMapChoiceFromEnumAndId(t.ESymbol,"Collab.Measurement.Symbol"),i=[{Name:"Collab.Measurement.DisplayValue",Type:u,DefaultValue:!0,GroupId:"Group.Measurement"},{Name:"Collab.Measurement.PreSymbol",Type:h,DefaultValue:t.ESymbol.None,GroupId:"Group.Measurement",MapChoice:e},{Name:"Collab.Measurement.PreString",Type:p,DefaultValue:"",GroupId:"Group.Measurement"},{Name:"Collab.Measurement.MiddleSymbol",Type:h,DefaultValue:t.ESymbol.None,GroupId:"Group.Measurement",MapChoice:e},{Name:"Collab.Measurement.MiddleString",Type:p,DefaultValue:"",GroupId:"Group.Measurement"},{Name:"Collab.Measurement.PostSymbol",Type:h,DefaultValue:t.ESymbol.None,GroupId:"Group.Measurement",MapChoice:e},{Name:"Collab.Measurement.PostString",Type:p,DefaultValue:"",GroupId:"Group.Measurement"},{Name:"Collab.Measurement.Attach.Type",Type:h,DefaultValue:t.EAttachType.Double,GroupId:"Group.Attach",MapChoice:this._generateMapChoiceFromEnumAndId(t.EAttachType,"Collab.Measurement.Attach.Type")},{Name:"Collab.Measurement.Value",Type:l,DefaultValue:0,GroupId:"Group.Measurement"},{Name:"Collab.Measurement.Length",Type:l,DefaultValue:0,GroupId:"Group.Measurement",UnitType:"Length",visibleInPropertyGroups:!1},{Name:"Collab.Measurement.Length1",Type:l,DefaultValue:0,GroupId:"Group.Measurement",UnitType:"Length",visibleInPropertyGroups:!1},{Name:"Collab.Measurement.Length2",Type:l,DefaultValue:0,GroupId:"Group.Measurement",UnitType:"Length",visibleInPropertyGroups:!1},{Name:"Collab.Measurement.Radius",Type:l,DefaultValue:0,GroupId:"Group.Measurement",UnitType:"Length",visibleInPropertyGroups:!1},{Name:"Collab.Measurement.Radius1",Type:l,DefaultValue:0,GroupId:"Group.Measurement",UnitType:"Length",visibleInPropertyGroups:!1},{Name:"Collab.Measurement.Radius2",Type:l,DefaultValue:0,GroupId:"Group.Measurement",UnitType:"Length",visibleInPropertyGroups:!1},{Name:"Collab.Measurement.Area",Type:l,DefaultValue:0,GroupId:"Group.Measurement",UnitType:"Area",visibleInPropertyGroups:!1},{Name:"Collab.Measurement.Volume",Type:l,DefaultValue:0,GroupId:"Group.Measurement",UnitType:"Volume",visibleInPropertyGroups:!1},{Name:"Collab.Measurement.ShowConstructionLines",Type:u,DefaultValue:!0,GroupId:"Group.Measurement"},{Name:"Collab.Measurement.ShowRedlines",Type:u,DefaultValue:!0,GroupId:"Group.Measurement"},{Name:"Collab.Measurement.ShowPlanes",Type:u,DefaultValue:!0,GroupId:"Group.Measurement"},{Name:"Collab.Measurement.ShowEndPoints",Type:u,DefaultValue:!0,GroupId:"Group.Measurement",visibleInPropertyGroups:!1},{Name:"Collab.3D.Paper.Billboard.Type",DefaultValue:2,FormatPainter:!0},{Name:"Collab.Text",DefaultValue:""},{Name:"Collab.Text.Color",DefaultValue:(new n).FromRGBA(1,1,1,1),FormatPainter:!0},{Name:"Collab.Background.Color",DefaultValue:(new n).FromRGBA(.0666666666666667,.596078431372549,.8980392156862745,1),FormatPainter:!0},{Name:"Collab.Body.Shape",DefaultValue:r.EBodyShape.RoundedRectangle,FormatPainter:!0},{Name:"Collab.3D.Paper.Referential.In.World",DefaultValue:!1},{Name:"Collab.Body.HAlignment",DefaultValue:r.EHAlignment.Center},{Name:"Collab.Body.VAlignment",DefaultValue:r.EVAlignment.Bottom},{Name:"Collab.3D.Paper.UsesBarycenter",DefaultValue:!1},{Name:"Collab.Body.InnerMargin",DefaultValue:1,FormatPainter:!0},{Name:"Collab.HideIfOutsideAnchorFrustrum",DefaultValue:!0},{Name:"Collab.Measurement.Type",Type:h,DefaultValue:t.EType.BetweenPoints,GroupId:"Group.Measurement",MapChoice:this._generateMapChoiceFromEnumAndId(t.EType,"Collab.Measurement.Type"),visibleInPropertyGroups:!0}];this._BuildPropertyValues(i),this.SetPropertyInvisible("Collab.HideIfOutsideAnchorFrustrum",!1),this.SetPropertyInvisible("Collab.Text",!0)},SetPropertiesInfo:function(){switch(this._parent(),this.GetPropertyValue("Collab.Measurement.Type")){case t.EType.BetweenPlanes:case t.EType.PlanePoint:this.SetPropertyInvisible("Collab.Measurement.ShowPlanes",!1);break;case t.EType.Arc:case t.EType.Angle:case t.EType.Volume:case t.EType.Area:case t.EType.AreaMultiplePoints:case t.EType.VolumeMultiplePoints:case t.EType.Coord:this.SetPropertyInvisible("Collab.Measurement.ShowConstructionLines",!0),this.SetPropertyInvisible("Collab.Measurement.ShowRedlines",!0);break;case t.EType.BetweenPoints:this.SetPropertyInvisible("Collab.Measurement.ShowRedlines",!0);break;default:this.SetPropertyInvisible("Collab.Measurement.ShowConstructionLines",!1),this.SetPropertyInvisible("Collab.Measurement.ShowRedlines",!1),this.SetPropertyInvisible("Collab.Measurement.ShowPlanes",!0)}this.SetPropertyInvisible("Collab.Measurement.Type",!0),this.SetPropertyInvisible("Collab.Measurement.Length",!0),this.SetPropertyInvisible("Collab.Measurement.Length1",!0),this.SetPropertyInvisible("Collab.Measurement.Length2",!0),this.SetPropertyInvisible("Collab.Measurement.Radius",!0),this.SetPropertyInvisible("Collab.Measurement.Radius1",!0),this.SetPropertyInvisible("Collab.Measurement.Radius2",!0),this.SetPropertyInvisible("Collab.Measurement.Area",!0),this.SetPropertyInvisible("Collab.Measurement.Volume",!0),this.SetPropertyInvisible("Collab.Body.KeepAspectRatio",!0),this.ChangeGroupAvailability("Group.Paragraph",e.EAvailability.AppForceNotAvailable)},GetProperty:function(e){if("Collab.Measurement.Value"===e){if(this._Properties["Collab.Measurement.Value"])switch(this.GetPropertyValue("Collab.Measurement.Type")){case t.EType.Angle:this._Properties["Collab.Measurement.Value"].GetPropertyInfo().SetUnitType("Angle");break;case t.EType.AreaMultiplePoints:case t.EType.Area:this._Properties["Collab.Measurement.Value"].GetPropertyInfo().SetUnitType("Area");break;case t.EType.VolumeMultiplePoints:case t.EType.Volume:this._Properties["Collab.Measurement.Value"].GetPropertyInfo().SetUnitType("Volume");break;case t.EType.BetweenPlanes:case t.EType.BetweenLines:break;default:this._Properties["Collab.Measurement.Value"].GetPropertyInfo().SetUnitType("Length")}var i=this.GetObject().getValue();return this.GetNewProperty(e,i)}return this._parent(e)},GetComputedStringProperty:function(e,i){switch(this.GetPropertyValue("Collab.Measurement.Type")){case t.EType.Coord:var r=this.ExperienceBase.getManager("VCXUnitManager"),n=this.GetAnchorWorldMatrix(0,null),l=a.getOFromMatrix(n),p="",u=r.getUnitType("Length"),h=u.SymbolDisplay;return u.SymbolDisplay=s.ESymbolDisplay.None,p+="x = "+u.getString(l.x)+"\n",p+="y = "+u.getString(l.y)+"\n",p+="z = "+u.getString(l.z),u.SymbolDisplay=h,p;default:p="";return p+=o.format(this.GetProperty("Collab.Measurement.PreSymbol"),this.ExperienceBase),(p+=this.GetPropertyValue("Collab.Measurement.PreString")).length>0&&(p+=" "),this.GetPropertyValue("Collab.Measurement.DisplayValue")&&(p+=o.format(this.GetProperty("Collab.Measurement.Value"),this.ExperienceBase)),p+=o.format(this.GetProperty("Collab.Measurement.MiddleSymbol"),this.ExperienceBase),p+=this.GetPropertyValue("Collab.Measurement.MiddleString"),p+=o.format(this.GetProperty("Collab.Measurement.PostSymbol"),this.ExperienceBase),p+=this.GetPropertyValue("Collab.Measurement.PostString")}return this._parent(i)}})}),define("DS/VCXWebDressup/VCXViewportNode",["DS/Visualization/Node3D","DS/VCXWebDressup/VCXDressupNode","DS/Visualization/ThreeJS_DS","DS/VCXWebDressup/VCXForegroundNode","DS/VCXWebDressup/VCXBackgroundNode","DS/VCXWebDressup/VCXPropertiesObserver","DS/VCXWebKernelTools/VCXMathTools"],function(e,t,i,r,a,o,s){"use strict";return t.extend({init:function(t){return this._parent(t),this._foreground=new r(t),this.add(this._foreground),this._background=new a(t),this.add(this._background),this._viewpointNode=new e,this.add(this._viewpointNode),this.lightingModeObserver=new o,this.lightingModeObserver.add(this.Modifiable,"Render.Lighting.Override"),this.lightingModeObserver.add(this.Modifiable,"Render.Lighting.Intensity"),this.lightingModeObserver.add(this.Modifiable,"Render.Lighting.Mode"),this.lightingModeObserver.add(this.Modifiable,"Render.Lighting.Static"),this},dispose:function(){this._foreground&&(this._foreground.dispose(),this._foreground=null),this._background&&(this._background.dispose(),this._background=null),this.lightingModeObserver=null,this._parent()},preRender:function(e){this._foreground.preRender(e),this._background.preRender(e),e&&e.viewpoint&&this._viewpointNode.setMatrix(e.viewpoint.camera.matrix.clone().setPosition(new i.Vector3(0,0,0)))},update:function(e){this._parent(),this.lightingModeObserver&&(this.lightingModeObserver.update(),(this.lightingModeObserver.isDirty()||e&&e.force)&&this.Modifiable.GetObject().setLightingMode(this.GetPropertyValue("Render.Lighting.Override"),this.GetPropertyValue("Render.Lighting.Mode"),this.GetPropertyValue("Render.Lighting.Intensity"),this.GetPropertyValue("Render.Lighting.Static"))),this._foreground.update(e),this._background.update(e)},postUpdate:function(e){this._parent(),this.lightingModeObserver&&this.lightingModeObserver.postUpdate()},getViewpointNode:function(){return this._viewpointNode}})}),define("DS/VCXWebDressup/VCXViewportSGNodeHolder",["DS/VCXWebDressup/VCXDressupSGNodeHolder","DS/VCXWebDressup/VCXViewportNode"],function(e,t){"use strict";return e.extend({init:function(){},buildSGNode:function(){if(!this._sgNode){var e={name:"Viewport",modifiable:this.GetObject().QueryInterface("VCXIModifiable")};this._sgNode=new t(e),this._sgNode.setIcon("../VCXWebDressup/assets/icons/32/I_VCX_Panel_Tree_ViewportLeaf.png")}return this._parent()}})}),define("DS/VCXWebDressup/VCXAttachesNode",["DS/VCXWebDressup/VCXMarkup_Spec","DS/VCXWebDressup/VCXDressupNode","DS/VCXWebDressup/VCXAttachSegmentNode","DS/VCXWebDressup/VCXAttachTooltipNode","DS/Visualization/ThreeJS_DS"],function(e,t,i,r,a){"use strict";var o="warning",s={unsupportedAttach:{level:o,title:"Issue handling attach nodes",message:"Type of attach required for dressup not supported."},noPaperManager:{level:o,title:"Paper manager not found",message:"The paper manager couldn't be fetch."}};return t.extend({init:function(t){return this._parent(t),this._PanelNode=t.panelNode,this._BentLineSize=2,this._MinAngleAllowed=5,this._MinAngleAllowedRad=this._MinAngleAllowed*Math.PI/180,this._horizontalLineMargin=1,this._AttachType=e.ELeadType.Middle,this._AttachNodes={},this._smartNodeCenter=new a.Vector3,this._xAxis=new a.Vector3,this._yAxis=new a.Vector3,this._zAxis=new a.Vector3,this},_getBentLineVerticesPosInPaper:function(e,t){var i=t?-1:1,r=e.clone();r.x=r.x+i*this._PanelNode.GetShapeInfo().size.x*.5;var a=r.clone();return a.x=a.x+i*this._BentLineSize,{start:r,end:a}},_getHorizontalLineVerticesPosInPaper:function(e,t,i){var r=t?-1:1,a=i?-1:1,o=e.clone();o.x=o.x-r*this._PanelNode.GetShapeInfo().size.x*.5,o.y=o.y+a*(.5*this._PanelNode.GetShapeInfo().size.y+this._horizontalLineMargin);var s=o.clone();return s.x=s.x+r*this._PanelNode.GetShapeInfo().size.x,{start:o,end:s}},_checkBreakStillToBeUsedFromBentEndPos:function(e,t,i){var r=new a.Vector3(e.EndExtremityPaper.x-t.x,e.EndExtremityPaper.y-t.y,e.EndExtremityPaper.z);return i.angleTo(r)*(180/Math.PI)>=90+this._MinAngleAllowed},_findBestCorner:function(e,t){return{left:e.x>t.EndExtremityPaper.x,top:e.y>t.EndExtremityPaper.y}},_ComputePosLinesAttaches:function(t,i){var r,o,s=null,n=null,l=!0,p=!0,u=(new a.Vector3).getPositionFromMatrix(this._PanelNode.GetShapeInfo().smartNode.getMatrix(t)),h=i.ModelToMM2(t,u);if(h.x+=this._PanelNode.GetShapeInfo().center.x,h.y+=this._PanelNode.GetShapeInfo().center.y,this._AttachType===e.ELeadType.Middle)l=!1,p=!1;else if(this._AttachType===e.ELeadType.Line){var d=0,c=0;for(s in this._AttachNodes)if(this._AttachNodes.hasOwnProperty(s)){n=this._AttachNodes[s];var y=this._findBestCorner(h,n);y.top?d++:d--,y.left?c++:c--}var m=this._getHorizontalLineVerticesPosInPaper(h,c>0,d>0),C=this._getHorizontalLineVerticesPosInPaper(h,c<0,d>0);r=i.MMToModel2(t,m.start),o=i.MMToModel2(t,m.end)}else{m=this._getBentLineVerticesPosInPaper(h,!0),C=this._getBentLineVerticesPosInPaper(h,!1);var f=new a.Vector3(h.x-m.end.x,h.y-m.end.y,h.z),V=new a.Vector3(h.x-C.end.x,h.y-C.end.y,h.z);for(s in this._AttachNodes)if(this._AttachNodes.hasOwnProperty(s)){if(!l&&!p)break;n=this._AttachNodes[s],l=l&&this._checkBreakStillToBeUsedFromBentEndPos(n,m.end,f),p=p&&this._checkBreakStillToBeUsedFromBentEndPos(n,C.end,V)}l?(r=i.MMToModel2(t,m.start),o=i.MMToModel2(t,m.end)):p&&(r=i.MMToModel2(t,C.start),o=i.MMToModel2(t,C.end))}for(s in this._AttachNodes)if(this._AttachNodes.hasOwnProperty(s)){if(n=this._AttachNodes[s],this._AttachType===e.ELeadType.Line)n.StartExtremity=r,n.BreakExtremity=o;else if(l||p)n.StartExtremity=r,n.BreakExtremity=o;else{var b=h.clone(),P=new a.Vector3;n.EndExtremityPaper.sub(new a.Vector3(b.x,b.y,0));var _=.5*this._PanelNode.GetShapeInfo().size.x,g=.5*this._PanelNode.GetShapeInfo().size.y,S=this._PanelNode.GetShapeInfo().shape;(S!==e.EBodyShape.None&&S!==e.EBodyShape.RoundedRectangle&&S!==e.EBodyShape.Rectangle&&S!==e.EBodyShape.RoundedSquare&&S!==e.EBodyShape.Square||!this.SegmentIntersectRectangle(n.EndExtremityPaper,-_,-g,_,g,P))&&(S!==e.EBodyShape.Circle&&S!==e.EBodyShape.Ellipse||!this.SegmentIntersectEllipse(n.EndExtremityPaper,_,g,!1,P))||b.add(new a.Vector3(P.x,P.y,0)),n.StartExtremity=i.MMToModel2(t,b),n.BreakExtremity=n.StartExtremity.clone()}n.preRender(t)}},_ComputePosTooltipAttaches:function(e,t){var i,r,o=this.getBodyCenterPosInPaper(e,t);if(this.Modifiable.GetPropertyValue("Collab.Attach.CenteredOrigin"))r=o;else{var s=this.Modifiable.GetPropertyValue("Collab.Attach.Origin");if(s.equals(new a.Vector3)){var n=this.Modifiable.GetProperty("Collab.Attach.Origin").GetPropertyValue().Clone();n.SetValue(o.clone()),this.Modifiable.OnChangeProperty("Collab.Attach.Origin",n),r=this.Modifiable.GetPropertyValue("Collab.Attach.Origin")}else{r=(new a.Vector3).copy(s).setZ(o.z)}}for(var l in i=t.MMToModel2(e,r),this._AttachNodes)if(this._AttachNodes.hasOwnProperty(l)){var p=this._AttachNodes[l];p.StartExtremity=i,p.preRender(e)}},getBodyCenterPosInPaper:function(e,t){var i=(new a.Vector3).getPositionFromMatrix(this._PanelNode.GetShapeInfo().smartNode.getMatrix(e)),r=t.ModelToMM2(e,i);return r.x+=this._PanelNode.GetShapeInfo().center.x,r.y+=this._PanelNode.GetShapeInfo().center.y,r},_ComputePosAttaches:function(t){var i=this.ExperienceBase.getManager("VCXPaperManager");if(i){if(this._AttachType!==e.ELeadType.None&&0!==Object.keys(this._AttachNodes).length){for(var r in this._AttachNodes)if(this._AttachNodes.hasOwnProperty(r)){var a=this.GetAnchorWorldMatrix(r,t);if(a){var o=this._AttachNodes[r];o.EndExtremity.getPositionFromMatrix(a),o.EndExtremityPaper=i.ModelToMM2(t,o.EndExtremity)}}switch(this._AttachType){case e.ELeadType.Mustache:this._ComputePosTooltipAttaches(t,i);break;default:this._ComputePosLinesAttaches(t,i)}}}else this.ExperienceBase.getManager("VCXNotificationManager").addNotification(s.noPaperManager)},dispose:function(){for(var e in this._AttachNodes)this._AttachNodes.hasOwnProperty(e)&&this._AttachNodes[e].dispose();this._AttachNodes={},this._parent()},_Build:function(){},preRender:function(e){this._parent(e),this._ComputePosAttachesSmartNode(e)},update:function(t){this._parent();var a=this.GlobalOpacity,o=this.GetPropertyValue("Collab.Attach.LeadType");if(this._AttachType!==o){for(var s in this._AttachNodes)this._AttachNodes.hasOwnProperty(s)&&this._AttachNodes[s].dispose();this._AttachNodes={},this._AttachType=o}var n=!1,l=this,p=this.Modifiable&&this.Modifiable._Anchors;if(p&&Object.keys(p).length>0)for(var u in this.Modifiable.processAnchorsIDs(function(t){if("Location"!==t)if(l.GetPropertyGroupVisibility("Group.Attach")&&l._AttachType!==e.ELeadType.None&&a>0){if(!l._AttachNodes.hasOwnProperty(t)){var o={name:"AttachNode "+t,modifiable:l.Modifiable,type:l._type,anchorID:t};l._AttachType===e.ELeadType.Mustache?(o.bConsiderCurvature=!0,o.gradientBackGround=l.GetPropertyValue("Collab.Attach.Background.Gradient"),o.gradientBorder=l.GetPropertyValue("Collab.Attach.Border.Gradient"),l._AttachNodes[t]=new r(o)):(o.endExtremityType=l.GetPropertyValue("Collab.Attach.ExtremityType"),l._AttachNodes[t]=new i(o)),l._AttachNodes[t].exludeFromBounding(!0),l.add(l._AttachNodes[t]),n=!0,l.handleLayers(!0)}}else l._AttachNodes.hasOwnProperty(t)&&(l.remove(l._AttachNodes[t]),delete l._AttachNodes[t],n=!0)}),this._AttachNodes)this._AttachNodes.hasOwnProperty(u)&&this._AttachNodes[u].update(t);this.handleLayers(n)},postUpdate:function(e){for(var t in this._parent(),this._AttachNodes)this._AttachNodes.hasOwnProperty(t)&&this._AttachNodes[t].postUpdate(e)},_ComputePosAttachesSmartNode:function(t){var i=this.ExperienceBase.getManager("VCXPaperManager");if(i){if(this._AttachType!==e.ELeadType.None&&0!==Object.keys(this._AttachNodes).length){var r=this._PanelNode.GetShapeInfo().smartNode.getMatrix(t);if(r){this._smartNodeCenter.getPositionFromMatrix(r),r.extractBasis(this._xAxis,this._yAxis,this._zAxis);var o=this._xAxis.clone().multiplyScalar(this._PanelNode.GetShapeInfo().center.x),n=this._yAxis.clone().multiplyScalar(-this._PanelNode.GetShapeInfo().center.y);this._smartNodeCenter.add(o).add(n);var l=(new a.Plane).setFromNormalAndCoplanarPoint(this._zAxis,this._smartNodeCenter),p=t.viewpoint.getEyePosition();for(var u in this._AttachNodes)if(this._AttachNodes.hasOwnProperty(u)){var h=this.GetAnchorWorldMatrix(u,t);if(h){var d=this._AttachNodes[u];d.EndExtremity.getPositionFromMatrix(h);var c=new a.Ray(p,d.EndExtremity.clone().sub(p));d.EndExtremityInSmartNodePlane=c.intersectPlane(l)}}switch(this._AttachType){case e.ELeadType.Mustache:this._ComputePosTooltipAttachesSmartNode(t,i);break;default:this._ComputePosLinesAttachesSmartNode(t)}}}}else this.ExperienceBase.getManager("VCXNotificationManager").addNotification(s.noPaperManager)},_ComputePosTooltipAttachesSmartNode:function(e){var t;if(this.Modifiable.GetPropertyValue("Collab.Attach.CenteredOrigin")||!this._PanelNode.GetShapeInfo().smartNode.is2D())t=this._smartNodeCenter.clone();else{var i=this.Modifiable.GetPropertyValue("Collab.Attach.Origin");if(i.equals(new a.Vector3)){var r=this.Modifiable.GetProperty("Collab.Attach.Origin").GetPropertyValue().Clone();r.SetValue(this._smartNodeCenter),this.Modifiable.OnChangeProperty("Collab.Attach.Origin",r),t=this._smartNodeCenter.clone()}else{var o=this._PanelNode.GetShapeInfo().smartNode.Position2D,s=i.x-o.x,n=-(i.y-o.y),l=this.Modifiable.GetPropertyValue("Collab.Body.HAlignment")-1,p=this.Modifiable.GetPropertyValue("Collab.Body.VAlignment")-1;s+=l*this._PanelNode.GetShapeInfo().size.x*.5,n-=p*this._PanelNode.GetShapeInfo().size.y*.5;var u=this._xAxis.clone().multiplyScalar(s),h=this._yAxis.clone().multiplyScalar(n);t=this._smartNodeCenter.clone().add(u).add(h)}}for(var d in this._AttachNodes)if(this._AttachNodes.hasOwnProperty(d)){var c=this._AttachNodes[d];c.StartExtremity=t,c.preRender(e)}},_ComputePosLinesAttachesSmartNode:function(t){var i,r,o=null,s=null,n=!0,l=!0;if(this._AttachType===e.ELeadType.Middle)n=!1,l=!1;else if(this._AttachType===e.ELeadType.Line){var p=0,u=0;for(o in this._AttachNodes)if(this._AttachNodes.hasOwnProperty(o)){s=this._AttachNodes[o];var h=this._findBestCornerSmartNode(s);h.top?p++:p--,h.left?u++:u--}var d=this._getHorizontalLineVerticesSmartNode(u>0,p>0);i=d.start,r=d.end}else{var c=this._getBentLineVerticesSmartNode(!0),y=this._getBentLineVerticesSmartNode(!1);for(o in this._AttachNodes)if(this._AttachNodes.hasOwnProperty(o)){if(!n&&!l)break;s=this._AttachNodes[o],n=n&&this._checkBreakStillToBeUsed(s,c),l=l&&this._checkBreakStillToBeUsed(s,y)}n?(i=c.start,r=c.end):l&&(i=y.start,r=y.end)}for(o in this._AttachNodes)if(this._AttachNodes.hasOwnProperty(o)){if(s=this._AttachNodes[o],this._AttachType===e.ELeadType.Line)s.StartExtremity=i,s.BreakExtremity=r;else if(n||l)s.StartExtremity=i,s.BreakExtremity=r;else{var m=this._smartNodeCenter.clone(),C=new a.Vector3,f=s.EndExtremityInSmartNodePlane.clone().sub(this._smartNodeCenter),V=this._xAxis.dot(f)/this._xAxis.length()*this._PanelNode.GetShapeInfo().size.x,b=this._yAxis.dot(f)/this._yAxis.length()*this._PanelNode.GetShapeInfo().size.y,P=new a.Vector2(V,b),_=.5*this._PanelNode.GetShapeInfo().size.x,g=.5*this._PanelNode.GetShapeInfo().size.y,S=this._PanelNode.GetShapeInfo().shape;(S!==e.EBodyShape.None&&S!==e.EBodyShape.RoundedRectangle&&S!==e.EBodyShape.Rectangle&&S!==e.EBodyShape.RoundedSquare&&S!==e.EBodyShape.Square||!this.SegmentIntersectRectangle(P,-_,-g,_,g,C))&&(S!==e.EBodyShape.Circle&&S!==e.EBodyShape.Ellipse||!this.SegmentIntersectEllipse(P,_,g,!1,C))||m.add(this._xAxis.clone().multiplyScalar(C.x)).add(this._yAxis.clone().multiplyScalar(C.y)),s.StartExtremity=m,s.BreakExtremity=s.StartExtremity.clone()}s.preRender(t)}},_getBentLineVerticesSmartNode:function(e){var t=e?-1:1,i=this._xAxis.clone().multiplyScalar(.5*t*this._PanelNode.GetShapeInfo().size.x),r=this._xAxis.clone().multiplyScalar(t*this._BentLineSize),a=this._smartNodeCenter.clone().add(i),o=a.clone().add(r);return{start:a,end:o}},_getHorizontalLineVerticesSmartNode:function(e,t){var i=e?1:-1,r=t?-1:1,a=this._xAxis.clone().multiplyScalar(.5*i*this._PanelNode.GetShapeInfo().size.x),o=this._yAxis.clone().multiplyScalar(.5*r*this._PanelNode.GetShapeInfo().size.y+this._horizontalLineMargin),s=this._smartNodeCenter.clone().add(a).add(o),n=s.clone().sub(a.clone().multiplyScalar(2));return{start:s,end:n}},_checkBreakStillToBeUsed:function(e,t){var i=e.EndExtremityInSmartNodePlane.clone().sub(t.end);return t.start.clone().sub(t.end).angleTo(i)>=.5*Math.PI+this._MinAngleAllowedRad},_findBestCornerSmartNode:function(e){var t=e.EndExtremityInSmartNodePlane.clone().sub(this._smartNodeCenter);return{left:this._xAxis.dot(t)<0,top:this._yAxis.dot(t)<0}},SegmentIntersectRectangle:function(e,t,i,r,o,s){if(e.x>t&&e.x<r&&e.y>i&&e.y<o)return!1;var n=new a.Vector2(r,o),l=new a.Vector2(t,o);if(this.IntersectSegment(e,n,l,s))return!0;var p=new a.Vector2(t,i);if(this.IntersectSegment(e,l,p,s))return!0;var u=new a.Vector2(r,i);return!!this.IntersectSegment(e,u,n,s)||(!!this.IntersectSegment(e,u,p,s)||(s=e.clone(),!1))},SegmentIntersectEllipse:function(e,t,i,r,o){var s,n;o.x=e.x,o.y=e.y,o.z=e.z;var l,p,u=new a.Vector2(e.x,e.y),h=new a.Vector2(e.x,e.y),d=!1,c=0,y=0,m=0,C=0,f=0;l=t*t,p=i*i,Math.abs(h.y)>Math.abs(h.x)?(d=!0,m=1/p+(c=h.x/h.y)*c/l,C=2*c*(y=u.x-c*u.y)/l,f=y*y/l-1):(m=1/l+(c=h.y/h.x)*c/p,C=2*c*(y=u.y-c*u.x)/p,f=y*y/p-1);var V=C*C-4*m*f;if(V<0)return!1;var b=!1;if(0===V)d?(n=-C/2*m,u.x=c*n+y,u.y=n):(s=-C/2*m,u.x=s,u.y=c*s+y),(b=!!r||this.IsPointInSegment(e,u))&&(o.x=u.x,o.y=u.y);else{var P=Math.sqrt(V);d?s=c*(n=(-C+P)/(2*m))+y:n=c*(s=(-C+P)/(2*m))+y;var _,g=new a.Vector2(s,n);_=!!r||this.IsPointInSegment(e,g),d?s=c*(n=(-C-P)/(2*m))+y:n=c*(s=(-C-P)/(2*m))+y;var S=new a.Vector2(s,n),M=!1;if(M=!!r||this.IsPointInSegment(e,S),_&&M){var D=g.x-S.x,G=g.y-S.y,v=D*D+G*G,A=.1*Math.min(t,i);if(v<A*A)return!1;v=(D=g.x-o.x)*D+(G=g.y-o.y)*G,(D=S.x-o.x)*D+(G=S.y-o.y)*G<v?(o.x=S.x,o.y=S.y):(o.x=g.x,o.y=g.y),b=!0}else _?(o.x=g.x,o.y=g.y,b=!0):M&&(o.x=S.x,o.y=S.y,b=!0)}return b},IsPointInSegment:function(e,t){var i=e.x,r=e.y,a=i*i+r*r,o=i*t.x+r*t.y;return!(o<0||o>a)},IntersectSegment:function(e,t,i,r){var a=-e.x*(t.y-e.y)- -e.y*(t.x-e.x),o=(i.x-t.x)*(t.y-e.y)-(i.y-t.y)*(t.x-e.x),s=-e.y*(i.x-t.x)- -e.x*(i.y-t.y);if(0===s)return!1;var n=a/s,l=o/s;return r.x=t.x+n*(i.x-t.x),r.y=t.y+n*(i.y-t.y),n>=0&&n<=1&&l>=0&&l<=1}})}),define("DS/VCXWebDressup/VCXMeasurementAttachesNode",["DS/VCXWebComponents/VCXWebComponentOccurrence","DS/VCXWebDressup/VCXAttachSegmentNode","DS/VCXWebDressup/VCXDressup_Spec","DS/VCXWebDressup/VCXMarkup_Spec","DS/VCXWebDressup/VCXMeasurement_Spec","DS/VCXWebDressup/VCXDressupNode","DS/VCXWebDressup/VCXExtremityNode","DS/VCXWebDressup/VCXSmart3DPaperNode","DS/VCXWebDressup/VCXPropertiesObserver","DS/VCXWebKernelTools/VCXMathTools","DS/VCXWebProperties/VCXColor","DS/Mesh/MeshUtils","DS/Visualization/Node3D","DS/Visualization/SceneGraphFactory","DS/Visualization/ThreeJS_DS"],function(e,t,i,r,a,o,s,n,l,p,u,h,d,c,y){"use strict";return o.extend({init:function(e){return this._parent(e),this._PanelNode=e.panelNode,this._BentLineSize=2,this._MinAngleAllowed=5,this._AttachType=r.EAttachType.Line,this._AttachNodes={},this.additionalGeometryRebuildObserver=new l,this.additionalGeometryRebuildObserver.add(this.Modifiable,"Collab.Measurement.Value"),this.additionalGeometryRebuildObserver.add(this.Modifiable,"Collab.Measurement.Area"),this.additionalGeometryRebuildObserver.add(this.Modifiable,"Collab.Measurement.Volume"),this.additionalGeometryRebuildObserver.add(this.Modifiable,"Collab.Measurement.Type"),this.additionalGeometryRebuildObserver.add(this.Modifiable,"Collab.Measurement.Radius"),this.additionalGeometryRebuildObserver.add(this.Modifiable,"Collab.Measurement.Radius1"),this.additionalGeometryRebuildObserver.add(this.Modifiable,"Collab.Measurement.Radius2"),this.additionalGeometryRebuildObserver.add(this.Modifiable,"Collab.Measurement.Length"),this.additionalGeometryRebuildObserver.add(this.Modifiable,"Collab.Measurement.ShowConstructionLines"),this.additionalGeometryRebuildObserver.add(this.Modifiable,"Collab.Measurement.ShowEndPoints"),this.additionalGeometryRebuildObserver.add(this.Modifiable,"Collab.Measurement.ShowRedlines"),this.additionalGeometryRebuildObserver.add(this.Modifiable,"Collab.Measurement.ShowPlanes"),this.additionalGeometryRebuildObserver.add(this.Modifiable,"Collab.Measurement.Length1"),this.additionalGeometryRebuildObserver.add(this.Modifiable,"Collab.Measurement.Length2"),this},_computePosBuffer:function(e,t,i){return e[0]=t.x,e[1]=t.y,e[2]=t.z,e[3]=i.x,e[4]=i.y,e[5]=i.z,2},_getLineNode:function(){var t=[new y.Vector3,new y.Vector3],i=new Uint16Array([0,1]),r=this.GetPropertyValue("Collab.Attach.Line.Type"),a=this.GetColorPropertyValue("Collab.Attach.Line"),o=1;if(r!==e.ELineType.Plain){var s=1;0===s&&(s=1),o=1/s}var n={type:this.GetPropertyValue("Collab.Attach.Line.Type"),lineWidth:this.GetPropertyValue("Collab.Attach.Line.Width"),color:a.GetThreeColor(),opacity:a.a,scale:o};this._LineMaterial=this.ExperienceBase.getManager("VCXMaterialManager").getLineMaterialFromParams(n,this._LineMaterial);var l={points:t,idx:i,editable:!0,drawMode:h.ConnectivityTypeEnum.LINES,material:this._LineMaterial};return c.createLineNode(l)},dispose:function(){this._attachMeasurementLabelLine1&&(this._attachMeasurementLabelLine1.dispose(),this._attachMeasurementLabelLine1=null),this._attachMeasurementLabelLine2&&(this._attachMeasurementLabelLine2.dispose(),this._attachMeasurementLabelLine2=null),this._attachMeasurementExtremity1&&(this._attachMeasurementExtremity1.dispose(),this._attachMeasurementExtremity1=null),this._attachMeasurementExtremity2&&(this._attachMeasurementExtremity2.dispose(),this._attachMeasurementExtremity2=null),this.additionalGeometryRebuildObserver=null,this._parent()},_ComputePosAttaches:function(e){var t=this.Modifiable.GetObject().getKeyPoints(e,this._PanelNode.GetShapeInfo().smartNode);this._PanelNode.GetShapeInfo().smartNode.BillboardXAxis=(new y.Vector3).subVectors(t.labelLineExtremity2,t.labelLineExtremity1);var i,a=(new y.Vector3).addVectors(t.labelLineExtremity1,t.labelLineExtremity2).multiplyScalar(.5);i=t.angle&&t.projectedPoint?t.projectedPoint:t.labelLineExtremity0;var o,s=(new y.Vector3).subVectors(i,t.labelLineExtremity1),n=(new y.Vector3).subVectors(i,t.labelLineExtremity2),l=s.dot(n)>0;if(this.extremityType=r.EExtremityType.FullArrow_1,t.labelLineExtremity0&&t.labelLineExtremity1&&t.measurementExtremity1){if(t.angle){this._attachMeasurementExtremity1._ArrowTail=!1;var u=t.labelLineExtremity0.distanceTo(t.labelLineExtremity1);this._attachMeasurementLabelLine1.StartExtremity=p.getVxFromMatrix(t.measurementExtremity0Frame).multiplyScalar(.1*u).add(t.labelLineExtremity1)}else this._attachMeasurementLabelLine1._ArrowTail=!0,this._attachMeasurementLabelLine1.StartExtremity=a;this._attachMeasurementLabelLine1.BreakExtremity=t.labelLineExtremity1,this._attachMeasurementLabelLine1.EndExtremity=t.measurementExtremity1,this._attachMeasurementLabelLine1.preRender(e),this._attachMeasurementExtremity1&&(this._attachMeasurementExtremity1.Type=this.extremityType,o=t.angle?p.getVyFromMatrix(t.measurementExtremity0Frame).negate():(new y.Vector3).subVectors(this._attachMeasurementLabelLine1.BreakExtremity,this._attachMeasurementLabelLine1.StartExtremity),l&&(this._attachMeasurementExtremity1.Type=this.extremityType+1,o.negate()),this._attachMeasurementExtremity1.SetReferential(p.getMatrixFromOVx(t.arrowLineExtremity1,o)),this._attachMeasurementExtremity1.preRender(e))}if(t.labelLineExtremity0&&t.labelLineExtremity2&&t.measurementExtremity2){if(t.angle){this._attachMeasurementExtremity2._ArrowTail=!1;u=t.labelLineExtremity0.distanceTo(t.labelLineExtremity2);this._attachMeasurementLabelLine2.StartExtremity=p.getVxFromMatrix(t.measurementExtremity0Frame).applyAxisAngle(p.getVzFromMatrix(t.measurementExtremity0Frame),Math.PI+t.value).multiplyScalar(-.1*u).add(t.labelLineExtremity2)}else this._attachMeasurementExtremity2._ArrowTail=!0,this._attachMeasurementLabelLine2.StartExtremity=a;this._attachMeasurementLabelLine2.BreakExtremity=t.labelLineExtremity2,this._attachMeasurementLabelLine2.EndExtremity=t.measurementExtremity2,this._attachMeasurementLabelLine2.preRender(e),this._attachMeasurementExtremity2&&(this._attachMeasurementExtremity2.Type=this.extremityType+1,o=t.angle?p.getVyFromMatrix(t.measurementExtremity0Frame).applyAxisAngle(p.getVzFromMatrix(t.measurementExtremity0Frame),t.value):(new y.Vector3).subVectors(this._attachMeasurementLabelLine2.BreakExtremity,this._attachMeasurementLabelLine2.StartExtremity),l&&(this._attachMeasurementExtremity2.Type=this.extremityType,o.negate()),this._attachMeasurementExtremity2.SetReferential(p.getMatrixFromOVx(t.arrowLineExtremity2,o)),this._attachMeasurementExtremity2.preRender(e))}if(this._lineNode){var d,m=this._lineNode.getBuffer(h.VertexComponentEnum.POSITION);if(m)d=t.angle&&t.projectedPoint?this._computePosBuffer(m,t.projectedPoint,t.labelLineExtremity0):l?t.labelLineExtremity0.distanceToSquared(t.labelLineExtremity1)<t.labelLineExtremity0.distanceToSquared(t.labelLineExtremity2)?this._computePosBuffer(m,t.labelLineExtremity1,t.labelLineExtremity0):this._computePosBuffer(m,t.labelLineExtremity2,t.labelLineExtremity0):this._computePosBuffer(m,t.labelLineExtremity0,t.labelLineExtremity0),this._lineNode.updateBuffer(h.VertexComponentEnum.POSITION,0,d),this._lineNode.computeBoundingElements()}if(this._additionalGeometryBasedOnAttach0&&t.measurementExtremity0Frame&&this._additionalGeometryBasedOnAttach0.setMatrix(t.measurementExtremity0Frame),this._additionalGeometryBasedOnAttach1&&t.measurementExtremity1Frame&&this._additionalGeometryBasedOnAttach1.setMatrix(t.measurementExtremity1Frame),this._additionalGeometryBasedOnAttach2&&t.measurementExtremity2Frame&&this._additionalGeometryBasedOnAttach2.setMatrix(t.measurementExtremity2Frame),this._additionalGeometryBasedOnAttach3&&t.measurementExtremity3Frame&&this._additionalGeometryBasedOnAttach3.setMatrix(t.measurementExtremity3Frame),this._additionalGeometryBasedOnAttach4&&t.measurementExtremity4Frame&&this._additionalGeometryBasedOnAttach4.setMatrix(t.measurementExtremity4Frame),t.angle){var C=0,f=t.value;if(t.projectedPoint){var V=(new y.Vector3).subVectors(t.projectedPoint,t.measurementExtremity0),b=(new y.Vector3).crossVectors(p.getVxFromMatrix(t.measurementExtremity0Frame),V),P=p.getVxFromMatrix(t.measurementExtremity0Frame).angleTo(V);p.getVzFromMatrix(t.measurementExtremity0Frame).dot(b)<0?(C=-P,f+=.05*Math.PI):P>f&&(f=P,C-=.05*Math.PI)}this._arcNode&&(this._additionalGeometryBasedOnAttach0.remove(this._arcNode),this._arcNode=null),this._arcNode=c.createCircleNode({radius:t.radius,startAngle:C,endAngle:f,material:this._attachMeasurementLabelLine1._lineMaterial}),this._additionalGeometryBasedOnAttach0.add(this._arcNode),this._geometryAdded=!0}return 2},postUpdate:function(e){this._parent(),this.additionalGeometryRebuildObserver&&this.additionalGeometryRebuildObserver.postUpdate()},preRender:function(e){this._parent(e);var t=this.ExperienceBase.getManager("VCXPaperManager");if(this._lineMaterial){this._lineMaterial.handleByPrerender=!0;let e=t.UnitValueToPixel(this.Modifiable.GetPropertyValue("Collab.Attach.Line.Width"));e>=1?(this._lineMaterial.setLineWidth(e),this._lineMaterial.visible=!0):this._lineMaterial.visible=!1}if(this._primaryAdditionalGeometryMaterial){this._primaryAdditionalGeometryMaterial.handleByPrerender=!0;let e=t.UnitValueToPixel(2);e>=1?(this._primaryAdditionalGeometryMaterial.setLineWidth(e),this._primaryAdditionalGeometryMaterial.visible=!0):this._primaryAdditionalGeometryMaterial.visible=!1}if(this._secondaryAdditionalGeometryMaterial){this._secondaryAdditionalGeometryMaterial.handleByPrerender=!0;let e=t.UnitValueToPixel(1);e>=1?(this._secondaryAdditionalGeometryMaterial.setLineWidth(e),this._secondaryAdditionalGeometryMaterial.visible=!0):this._secondaryAdditionalGeometryMaterial.visible=!1}if(this._thirdAdditionalGeometryMaterial){this._thirdAdditionalGeometryMaterial.handleByPrerender=!0;let e=t.UnitValueToPixel(1);e>=1?(this._thirdAdditionalGeometryMaterial.setLineWidth(e),this._thirdAdditionalGeometryMaterial.visible=!0):this._thirdAdditionalGeometryMaterial.visible=!1}if(this._fourthAdditionalGeometryMaterial){this._fourthAdditionalGeometryMaterial.handleByPrerender=!0;let e=t.UnitValueToPixel(1);e>=1?(this._fourthAdditionalGeometryMaterial.setLineWidth(e),this._fourthAdditionalGeometryMaterial.visible=!0):this._fourthAdditionalGeometryMaterial.visible=!1}this._ComputePosAttaches(e);for(var i=0;i<this._preRenderGeometries.length;i++)this._preRenderGeometries[i].preRender(e)},getPlaneNode:function(e){var t=new y.MeshBasicMaterial({side:y.DoubleSide,opacity:.3,color:"#888888",force:!0});t.line=new y.LineBasicMaterial({side:y.DoubleSide,transparent:!1,color:"#000000",opacity:1,force:!0,polygonBorderMode:!0,lineWidth:2});var i=c.createRectangleNode({width:1,height:1,fill:!0,material:t}),r=new o({name:"plane"});r.setMatrix((new y.Matrix4).setPosition(new y.Vector3(-.5,-.5,0))),r.add(i);var a=new n(e);return a.ModifiableProperties=!1,a.SizeControlType=1,a.ScalingFactor=10,a.add(r),a},update:function(i){this._parent();var n=this.GlobalOpacity,l=this.GetPropertyValue("Collab.Attach.LeadType");this._AttachType!==l&&(this._AttachType=l);this._AttachType!==r.ELeadType.None&&n>0&&(this._AxisSystemNode,this._AxisSystemNode&&this._AxisSystemNode.setMatrix(this.Modifiable.GetObject().getReferential()),this._attachMeasurementLabelLine1||(G={name:"AttachMeasurementLabelLine1",modifiable:this.Modifiable,endExtremityType:r.EExtremityType.Yellow},this._attachMeasurementLabelLine1=new t(G),this.add(this._attachMeasurementLabelLine1),this._geometryAdded=!0),this._attachMeasurementLabelLine2||(G={name:"AttachMeasurementLabelLine2",modifiable:this.Modifiable,endExtremityType:r.EExtremityType.Yellow},this._attachMeasurementLabelLine2=new t(G),this.add(this._attachMeasurementLabelLine2),this._geometryAdded=!0),this._lineNode||(this._lineNode=this._getLineNode(),this.add(this._lineNode),this._geometryAdded=!0),this._attachMeasurementExtremity1||(G={name:"AttachMeasurementExtremity1",modifiable:this.Modifiable,type:r.EExtremityType.Dot},this._attachMeasurementExtremity1=new s(G),this.add(this._attachMeasurementExtremity1),this._geometryAdded=!0),this._attachMeasurementExtremity2||(G={name:"AttachMeasurementExtremity2",modifiable:this.Modifiable,type:r.EExtremityType.Dot},this._attachMeasurementExtremity2=new s(G),this.add(this._attachMeasurementExtremity2),this._geometryAdded=!0));this.additionalGeometryRebuildObserver&&this.additionalGeometryRebuildObserver.update();var p=this.ExperienceBase.getManager("VCXMaterialManager");if(!this._primaryAdditionalGeometryMaterial){var h={type:e.ELineType.Plain,lineWidth:3,color:(new u).SetRGB(255,0,0).GetThreeColor(),opacity:n};this._primaryAdditionalGeometryMaterial=p.getLineMaterialFromParams(h)}if(!this._secondaryAdditionalGeometryMaterial){var d={type:e.ELineType.Dot,lineWidth:1,color:(new u).SetRGB(0,0,0).GetThreeColor(),opacity:n};this._secondaryAdditionalGeometryMaterial=p.getLineMaterialFromParams(d)}if(!this._thirdAdditionalGeometryMaterial){var m={type:e.ELineType.Plain,lineWidth:1,color:(new u).SetRGB(200,100,0).GetThreeColor(),opacity:n};this._thirdAdditionalGeometryMaterial=p.getLineMaterialFromParams(m)}if(!this._fourthAdditionalGeometryMaterial){var C={type:e.ELineType.Dot,lineWidth:1,color:(new u).SetRGB(255,0,0).GetThreeColor(),opacity:n};this._fourthAdditionalGeometryMaterial=p.getLineMaterialFromParams(C)}(this.additionalGeometryRebuildObserver&&this.additionalGeometryRebuildObserver.isDirty()||this.Modifiable.GetObject().hasPointedObjectMoved(i))&&(this._preRenderGeometries=[],this._additionalGeometryToUpdate&&(this.remove(this._additionalGeometryToUpdate),this._additionalGeometryToUpdate=null),this._additionalGeometryBasedOnAttach0&&(this.remove(this._additionalGeometryBasedOnAttach0),this._additionalGeometryBasedOnAttach0=null),this._additionalGeometryBasedOnAttach1&&(this.remove(this._additionalGeometryBasedOnAttach1),this._additionalGeometryBasedOnAttach1=null),this._additionalGeometryBasedOnAttach2&&(this.remove(this._additionalGeometryBasedOnAttach2),this._additionalGeometryBasedOnAttach2=null),this._additionalGeometryBasedOnAttach3&&(this.remove(this._additionalGeometryBasedOnAttach3),this._additionalGeometryBasedOnAttach3=null),this._additionalGeometryBasedOnAttach4&&(this.remove(this._additionalGeometryBasedOnAttach4),this._additionalGeometryBasedOnAttach4=null)),this._PanelNode.GetShapeInfo().smartNode.update(i),this._PanelNode.GetShapeInfo().smartNode.preRender(i);var f,V,b,P,_=this.Modifiable.GetObject().getKeyPoints(i,this._PanelNode.GetShapeInfo().smartNode);if(_.angle&&this.GetPropertyValue("Collab.Measurement.Type")===a.EType.BetweenLines){var g=(new y.Matrix4).getInverse(this._PanelNode.GetShapeInfo().smartNode.GetReferential(i));this._PanelNode.GetShapeInfo().smartNode.Position=_.projectedPoint.clone().applyMatrix4(g)}if(!this._additionalGeometryToUpdate){if(this._additionalGeometryToUpdate=new o({name:"additionalGeometryA"}),this.add(this._additionalGeometryToUpdate),this._geometryAdded=!0,this.GetPropertyValue("Collab.Measurement.ShowConstructionLines"))switch(this.GetPropertyValue("Collab.Measurement.Type")){case a.EType.BetweenCentres:case a.EType.BetweenPoints:case a.EType.LinePoint:case a.EType.BetweenLines:case a.EType.PlanePoint:case a.EType.BetweenPlanes:if(!_.angle){var S=c.createLineNode({points:[_.measurementExtremity1,_.measurementExtremity2],material:this._secondaryAdditionalGeometryMaterial});this._additionalGeometryToUpdate.add(S)}}if(_.angle&&this.GetPropertyValue("Collab.Measurement.ShowEndPoints")){var M;if(_.measurementAnglePoint1)G={name:"MeasurementAnglePoint1",modifiable:this.Modifiable,type:r.EExtremityType.Yellow},(M=new s(G)).SetReferential((new y.Matrix4).setPosition(_.measurementAnglePoint1)),this._additionalGeometryToUpdate.add(M),this._preRenderGeometries.push(M);if(_.measurementAnglePoint2)G={name:"MeasurementAnglePoint2",modifiable:this.Modifiable,type:r.EExtremityType.Yellow},(M=new s(G)).SetReferential((new y.Matrix4).setPosition(_.measurementAnglePoint2)),this._additionalGeometryToUpdate.add(M),this._preRenderGeometries.push(M)}switch(this.GetPropertyValue("Collab.Measurement.Type")){case a.EType.BetweenLines:S=c.createLineNode({points:[_.measurementExtremity2,_.measurementExtremity4],material:this._fourthAdditionalGeometryMaterial}),this._additionalGeometryToUpdate.add(S),this._geometryAdded=!0;break;case a.EType.LinePoint:S=c.createLineNode({points:[_.measurementExtremity1,_.measurementExtremity3],material:this._fourthAdditionalGeometryMaterial}),this._additionalGeometryToUpdate.add(S),this._geometryAdded=!0;break;case a.EType.PlanePoint:case a.EType.BetweenPlanes:if(this.GetPropertyValue("Collab.Measurement.ShowPlanes")){this._geometryAdded=!0;var D,G={name:"planeSmartNode",modifiable:this.Modifiable,type:this._type};if(_.measurementExtremity3Frame)G.name="planeSmartNode1",(D=this.getPlaneNode(G)).SetReferential(_.measurementExtremity3Frame),this._preRenderGeometries.push(D),this._additionalGeometryToUpdate.add(D);if(_.angle){if(_.measurementExtremity4Frame)G.name="planeSmartNode2",(D=this.getPlaneNode(G)).SetReferential(_.measurementExtremity4Frame),this._preRenderGeometries.push(D),this._additionalGeometryToUpdate.add(D)}else if(_.measurementExtremity6Frame)G.name="planeSmartNode2",(D=this.getPlaneNode(G)).SetReferential(_.measurementExtremity6Frame),this._preRenderGeometries.push(D),this._additionalGeometryToUpdate.add(D)}this.GetPropertyValue("Collab.Measurement.ShowConstructionLines")&&(!_.angle&&_.measurementExtremity4&&(S=c.createLineNode({points:[_.measurementExtremity4,_.measurementExtremity3],material:this._secondaryAdditionalGeometryMaterial}),this._additionalGeometryToUpdate.add(S)),!_.angle&&_.measurementExtremity6&&(S=c.createLineNode({points:[_.measurementExtremity6,_.measurementExtremity5],material:this._secondaryAdditionalGeometryMaterial}),this._additionalGeometryToUpdate.add(S)),_.angle&&(S=c.createLineNode({points:[_.measurementExtremity1,_.measurementExtremity3],material:this._secondaryAdditionalGeometryMaterial}),this._additionalGeometryToUpdate.add(S))),!_.angle&&this.GetPropertyValue("Collab.Measurement.ShowRedlines")&&(S=c.createLineNode({points:[_.measurementExtremity1,_.measurementExtremity3],material:this._thirdAdditionalGeometryMaterial}),this._additionalGeometryToUpdate.add(S),S=c.createLineNode({points:[_.measurementExtremity2,_.measurementExtremity4],material:this._thirdAdditionalGeometryMaterial}),this._additionalGeometryToUpdate.add(S),_.measurementExtremity5&&(S=c.createLineNode({points:[_.measurementExtremity1,_.measurementExtremity5],material:this._thirdAdditionalGeometryMaterial}),this._additionalGeometryToUpdate.add(S)),_.measurementExtremity6&&(S=c.createLineNode({points:[_.measurementExtremity2,_.measurementExtremity6],material:this._thirdAdditionalGeometryMaterial}),this._additionalGeometryToUpdate.add(S)))}}if(!this._additionalGeometryBasedOnAttach0)switch(this._additionalGeometryBasedOnAttach0=new o({name:"additionalGeometryB"}),this.add(this._additionalGeometryBasedOnAttach0),this._geometryAdded=!0,this.GetPropertyValue("Collab.Measurement.Type")){case a.EType.Radius:case a.EType.Diameter:f=this.GetPropertyValue("Collab.Measurement.Radius"),this.GetPropertyValue("Collab.Measurement.Type")===a.EType.Diameter&&(f*=.5),this.GetPropertyValue("Collab.Measurement.ShowRedlines")&&(V=c.createCircleNode({radius:f,material:this._primaryAdditionalGeometryMaterial}),this._additionalGeometryBasedOnAttach0.add(V),b=c.createLineNode({points:[new y.Vector3(.2*-f,.2*-f,0),new y.Vector3(.2*f,.2*f,0)],material:this._primaryAdditionalGeometryMaterial}),this._additionalGeometryBasedOnAttach0.add(b),P=c.createLineNode({points:[new y.Vector3(.2*-f,.2*f,0),new y.Vector3(.2*f,.2*-f,0)],material:this._primaryAdditionalGeometryMaterial}),this._additionalGeometryBasedOnAttach0.add(P))}if(!this._additionalGeometryBasedOnAttach1)switch(this._additionalGeometryBasedOnAttach1=new o({name:"additionalGeometryB1"}),this.add(this._additionalGeometryBasedOnAttach1),this._geometryAdded=!0,this.GetPropertyValue("Collab.Measurement.Type")){case a.EType.LinePoint:case a.EType.BetweenLines:this.GetPropertyValue("Collab.Measurement.ShowRedlines")&&(S=c.createLineNode({points:[new y.Vector3(0,0,0),new y.Vector3(this.GetPropertyValue("Collab.Measurement.Length1"),0,0)],material:this._primaryAdditionalGeometryMaterial}),this._additionalGeometryBasedOnAttach1.add(S));break;case a.EType.Linear:this.GetPropertyValue("Collab.Measurement.ShowRedlines")&&(S=c.createLineNode({points:[new y.Vector3(0,0,0),new y.Vector3(_.value,0,0)],material:this._primaryAdditionalGeometryMaterial}),this._additionalGeometryBasedOnAttach1.add(S));break;case a.EType.BetweenCentres:f=this.GetPropertyValue("Collab.Measurement.Radius1"),this.GetPropertyValue("Collab.Measurement.ShowRedlines")&&(V=c.createCircleNode({radius:f,material:this._primaryAdditionalGeometryMaterial}),this._additionalGeometryBasedOnAttach1.add(V),b=c.createLineNode({points:[new y.Vector3(.2*-f,.2*-f,0),new y.Vector3(.2*f,.2*f,0)],material:this._primaryAdditionalGeometryMaterial}),this._additionalGeometryBasedOnAttach1.add(b),P=c.createLineNode({points:[new y.Vector3(.2*-f,.2*f,0),new y.Vector3(.2*f,.2*-f,0)],material:this._primaryAdditionalGeometryMaterial}),this._additionalGeometryBasedOnAttach1.add(P));break;case a.EType.Radius:case a.EType.Diameter:this.GetPropertyValue("Collab.Measurement.ShowConstructionLines")&&(S=c.createLineNode({points:[new y.Vector3(0,0,0),new y.Vector3(_.value,0,0)],material:this._secondaryAdditionalGeometryMaterial}),this._additionalGeometryBasedOnAttach1.add(S))}if(!this._additionalGeometryBasedOnAttach2)switch(this._additionalGeometryBasedOnAttach2=new o({name:"additionalGeometryB2"}),this.add(this._additionalGeometryBasedOnAttach2),this._geometryAdded=!0,this.GetPropertyValue("Collab.Measurement.Type")){case a.EType.BetweenLines:this.GetPropertyValue("Collab.Measurement.ShowRedlines")&&(S=c.createLineNode({points:[new y.Vector3(0,0,0),new y.Vector3(this.GetPropertyValue("Collab.Measurement.Length2"),0,0)],material:this._primaryAdditionalGeometryMaterial}),this._additionalGeometryBasedOnAttach2.add(S));break;case a.EType.BetweenCentres:f=this.GetPropertyValue("Collab.Measurement.Radius2"),this.GetPropertyValue("Collab.Measurement.ShowRedlines")&&(V=c.createCircleNode({radius:f,material:this._primaryAdditionalGeometryMaterial}),this._additionalGeometryBasedOnAttach2.add(V),b=c.createLineNode({points:[new y.Vector3(.2*-f,.2*-f,0),new y.Vector3(.2*f,.2*f,0)],material:this._primaryAdditionalGeometryMaterial}),this._additionalGeometryBasedOnAttach2.add(b),P=c.createLineNode({points:[new y.Vector3(.2*-f,.2*f,0),new y.Vector3(.2*f,.2*-f,0)],material:this._primaryAdditionalGeometryMaterial}),this._additionalGeometryBasedOnAttach2.add(P))}this._additionalGeometryBasedOnAttach3||(this._additionalGeometryBasedOnAttach3=new o({name:"additionalGeometryB3"}),this.add(this._additionalGeometryBasedOnAttach3),this._geometryAdded=!0,this.GetPropertyValue("Collab.Measurement.Type")),this._additionalGeometryBasedOnAttach4||(this._additionalGeometryBasedOnAttach4=new o({name:"additionalGeometryB4"}),this.add(this._additionalGeometryBasedOnAttach4),this._geometryAdded=!0,this.GetPropertyValue("Collab.Measurement.Type"));for(var v=0;v<this._preRenderGeometries.length;v++)this._preRenderGeometries[v].update(i);this.GetPropertyValue("Collab.Measurement.ShowEndPoints")?(this._attachMeasurementLabelLine1.EndExtremityType=r.EExtremityType.Yellow,this._attachMeasurementLabelLine2.EndExtremityType=r.EExtremityType.Yellow):(this._attachMeasurementLabelLine1.EndExtremityType=r.EExtremityType.None,this._attachMeasurementLabelLine2.EndExtremityType=r.EExtremityType.None),this._attachMeasurementLabelLine1.update(i),this._attachMeasurementLabelLine2.update(i),this._attachMeasurementExtremity1.update(i),this._attachMeasurementExtremity2.update(i);var A=this.Modifiable.getLineMaterialParams("Collab.Attach.Line",this._LineMaterial,this._lastFrontLineType,n);Object.keys(A).length>0&&("number"==typeof A.type&&A.type!==this._lastFrontLineType&&(this._lastFrontLineType=A.type),this._LineMaterial=this.ExperienceBase.getManager("VCXMaterialManager").getLineMaterialFromParams(A,this._LineMaterial)),this._primaryAdditionalGeometryMaterial.opacity=n,this._secondaryAdditionalGeometryMaterial.opacity=n,this._thirdAdditionalGeometryMaterial.opacity=n,this._fourthAdditionalGeometryMaterial.opacity=n,this.handleLayers(!1)}})}),define("DS/VCXWebDressup/VCXPanelNode",["DS/Mesh/MeshUtils","DS/SceneGraphNodes/CanvasNode","DS/SceneGraphNodes/CanvasNodeTexture","DS/VCXWebDressup/VCXAttachesNode","DS/VCXWebDressup/VCXMarkup_Spec","DS/VCXWebDressup/VCXDressupNode","DS/VCXWebDressup/VCXMeasurementAttachesNode","DS/VCXWebDressup/VCXPropertiesObserver","DS/VCXWebDressup/VCXPropertyValueUnitFormater","DS/VCXWebDressup/VCXSmart3DPaperNode","DS/VCXWebVisualization/VCXImageManager","DS/Visualization/SceneGraphFactory","DS/Visualization/ThreeJS_DS","DS/VCXWebDressup/VCXPanel_Spec","DS/VCXWebKernelTools/VCXTextTools"],function(e,t,i,r,a,o,s,n,l,p,u,h,d,c,y){"use strict";return o.extend({init:function(e){return this._parent(e),this._previousBackgroundDocID=null,this._CanvasNode=null,this._CanvasNodeTexture=null,this._HighlightCanvasNode=null,this._HighlightCanvasNodeTexture=null,this._Smart3DPaperNode=null,this._externalMargin=0,this._lineWidth=0,this._editingState=null,this._TextSize=new d.Vector2,this._currentText=null,this._analysedText=null,this._requestedFontRatio=1,this.visible=!1,this.FirstDrawDeferred=UWA.Promise.deferred(),this},_SetShadow:function(e,t,i){e.shadowColor="transparent",e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0,t&&this.GetPropertyGroupVisibility("Group.Shadow")&&(e.shadowColor="rgba(0, 0, 0, "+this.GetPropertyValue("Collab.Body.Shadow.Opacity")+")",e.shadowBlur=i*this.GetPropertyValue("Collab.Body.Shadow.Blur")/4,e.shadowOffsetX=i*Math.cos(this.GetPropertyValue("Collab.Body.Shadow.Orientation")/180*Math.PI)*this.GetPropertyValue("Collab.Body.Shadow.Distance"),e.shadowOffsetY=i*Math.sin(this.GetPropertyValue("Collab.Body.Shadow.Orientation")/180*Math.PI)*this.GetPropertyValue("Collab.Body.Shadow.Distance"))},_DrawShape:function(e,t,i,r,o){var s=t.shape;this._SetShadow(e,i,o),s===a.EBodyShape.Circle||s===a.EBodyShape.Ellipse?(e.beginPath(),e.save(),e.translate(t.x+.5*t.width,t.y+.5*t.height),e.translate(.5*-t.width,.5*-t.height),e.scale(.5*t.width,.5*t.height),e.arc(1,1,1,0,2*Math.PI,!1),e.restore(),e.closePath(),r&&"stroke"!==t.type&&e.clip()):s===a.EBodyShape.Rhombus?(e.beginPath(),e.moveTo(t.x+.5*t.width,t.y),e.lineTo(t.x+t.width,t.y+.5*t.height),e.lineTo(t.x+.5*t.width,t.y+t.height),e.lineTo(t.x,t.y+.5*t.height),e.closePath(),r&&"stroke"!==t.type&&e.clip()):s===a.EBodyShape.Rectangle||s===a.EBodyShape.Square?(e.beginPath(),e.rect(t.x,t.y,t.width,t.height),e.closePath()):(e.beginPath(),e.moveTo(t.x+t.cornerRadius,t.y),e.lineTo(t.x+t.width-t.cornerRadius,t.y),e.quadraticCurveTo(t.x+t.width,t.y,t.x+t.width,t.y+t.cornerRadius),e.lineTo(t.x+t.width,t.y+t.height-t.cornerRadius),e.quadraticCurveTo(t.x+t.width,t.y+t.height,t.x+t.width-t.cornerRadius,t.y+t.height),e.lineTo(t.x+t.cornerRadius,t.y+t.height),e.quadraticCurveTo(t.x,t.y+t.height,t.x,t.y+t.height-t.cornerRadius),e.lineTo(t.x,t.y+t.cornerRadius),e.quadraticCurveTo(t.x,t.y,t.x+t.cornerRadius,t.y),e.closePath()),"fill"===t.type?e.fill():"stroke"===t.type?(this._SetShadow(e,!1,o),e.stroke()):"clip"===t.type&&e.clip()},_DrawRegularCanvas:function(e,t,i,r){e.VCXNode._DrawCanvas(e,t,i,r,!1),e.VCXNode.FirstDrawDeferred.resolve()},_DrawHighlightCanvas:function(e,t,i,r){e.VCXNode._DrawCanvas(e,t,i,r,!0)},_DrawCanvas:function(e,t,i,r,o){var s=e.VCXNode;if(s.Modifiable){var n=this.Modifiable.GetProperty("Collab.Attach.Preset");if(n)if(30===n.GetPropertyValue()._value)(C=s.GetShapeInfo())&&C.shape&&(C.shape=a.EBodyShape.None)}var l=s.GetShapeInfo().externalSize.x-2*s._externalMargin,p=s.GetShapeInfo().externalSize.y-2*s._externalMargin,u=0;void 0!==s.GetPropertyValue("Collab.Body.InnerMargin")&&(u=s.GetPropertyValue("Collab.Body.InnerMargin"));var h=u,d=s._externalMargin,c=s._externalMargin;if(this.GetShapeInfo().shape===a.EBodyShape.Square||this.GetShapeInfo().shape===a.EBodyShape.RoundedSquare||this.GetShapeInfo().shape===a.EBodyShape.Circle){var m=Math.max(l,p);l=m,p=m}var C={shape:this.GetShapeInfo().shape,x:d,y:c,width:l,height:p,cornerRadius:h,type:"fill",border:this.GetShapeInfo().border},f=s.GetColorPropertyValue("Collab.Background"),V=f.Clone();V.a=0;var b=V.GetStyle();t.save(),t.globalCompositeOperation="copy",t.fillStyle=b,t.globalAlpha=1,t.fillRect(0,0,e.width,e.height),t.restore();var P=!1;if(this.GetShapeInfo().shape===a.EBodyShape.None||this.GetShapeInfo().shape===a.EBodyShape.RemoveBorder||(t.save(),o?(t.globalCompositeOperation="copy",V.a=2/255,t.fillStyle=V.GetStyle(),t.globalAlpha=1):(t.globalCompositeOperation="source-over",t.fillStyle=f.GetStyle(),f.a>100/255&&s.GetPropertyGroupVisibility("Group.Background")&&(P=!0)),o||s.GetPropertyGroupVisibility("Group.Background")||(C.type="none"),s._DrawShape(t,C,P,!1,r),t.restore(),!o)){var _=s.GetPropertyValue("Collab.Image.Scale"),g=u+s._externalMargin,S=u+s._externalMargin,M=l-2*u,D=p-2*u,G=M*_,v=D*_;if(g+=.5*(M-G),S+=.5*(D-v),!o&&s.Modifiable.GetObject().backgroundImage&&s.Modifiable.GetObject().backgroundImage._IsReadyToUse){t.save(),t.globalCompositeOperation="source-over";var A=s.GetColorPropertyValue("Collab.Image"),x=A.a;A.a=1,t.fillStyle=A.GetStyle(),t.globalAlpha=x,this.ExperienceBase.getManager("VCXContextManager").isIE11()||1===A.r&&1===A.g&&1===A.b?(C.type="none",s._DrawShape(t,C,!1,!0,r),t.globalCompositeOperation="source-over",s._SetShadow(t,!P,r),P=!0,t.drawImage(s.Modifiable.GetObject().backgroundImage,g,S,G,v)):(C.type="fill",s._DrawShape(t,C,!1,!0,r),t.globalCompositeOperation="destination-in",s._SetShadow(t,!1,r),t.drawImage(s.Modifiable.GetObject().backgroundImage,g,S,G,v),t.globalCompositeOperation="multiply",s._SetShadow(t,!P,r),P=!0,t.drawImage(s.Modifiable.GetObject().backgroundImage,g,S,G,v)),t.restore()}if(o&&s.Modifiable.GetObject().backgroundImage&&s.Modifiable.GetObject().backgroundImage._IsReadyToUse){t.save(),t.globalCompositeOperation="source-over",t.globalAlpha=1;var X=f.Clone();return X.a=1,t.fillStyle=X.GetStyle(),s._SetShadow(t,!1,r),C.type="fill",s._DrawShape(t,C,!1,!0,r),t.globalCompositeOperation="destination-in",t.drawImage(s.Modifiable.GetObject().backgroundImage,g,S,G,v),void t.restore()}if(!o&&this._lineWidth&&this.GetShapeInfo().shape>0){t.save(),t.globalCompositeOperation="source-over";var I=s.GetColorPropertyValue("Collab.Border.Line");t.strokeStyle=I.GetStyle(),t.lineWidth=s._lineWidth,t.globalAlpha=I.a,C.type="stroke",s._DrawShape(t,C,!1,!1,r),t.restore()}if((!o||this.GetShapeInfo().shape===a.EBodyShape.None)&&s._analysedText){t.save(),C.type="clip",s._DrawShape(t,C,!1,!0,r),t.globalCompositeOperation="source-over",s._SetShadow(t,!P,r),P=!0;var T=d+u;T/=.3527;var N=c+u;s.GetPropertyValue("Collab.Text.VAlignment")===a.EVTextAlignment.Middle?N+=.5*(D-s._TextSize.y):s.GetPropertyValue("Collab.Text.VAlignment")===a.EVTextAlignment.Bottom&&(N+=D-s._TextSize.y),N/=.3527,t.scale(.3527,.3527),s._SetContextToDrawText(t),y.drawText(this._analysedText,t,T,N,M/.3527,this.GetPropertyValue("Collab.Text.HAlignment")),t.restore()}o&&(t.save(),t.globalCompositeOperation="source-over",t.fillStyle=b,t.globalAlpha=1,C.shape=a.EBodyShape.Rectangle,C.type="fill",s._DrawShape(t,C,!1,!0,r),t.restore())}},_SetContextToDrawText:function(e){var t=this.GetColorPropertyValue("Collab.Text");e.fillStyle=t.GetStyle(),this.Modifiable._panelDiv&&this.Modifiable._panelDiv.ckEditor&&this.Modifiable._panelDiv.ckEditor.isEditing?e.globalAlpha=0:e.globalAlpha=t.a;var i=this.GetFontPropertyValue("Collab.Text.Font");if(i){this.Modifiable.GetObject().fontHeight=this._requestedFontRatio*i.Height;var r="";r+=" "+(i.Italic?"italic":"normal"),r+=" "+(i.Weight||400),r+=" "+(this.Modifiable.GetObject().fontHeight||22)+"px",r+=" "+(i.Family||"Arial"),e.font=r}},GetShapeInfo:function(){return this.Modifiable.GetObject().shapeInfo||(this.Modifiable.GetObject().shapeInfo={},this.Modifiable.GetObject().shapeInfo.border={top:!1,bottom:!0,left:!1,right:!1}),this.Modifiable.GetObject().shapeInfo},_ComputeShapeInfo:function(){this._ComputeSize(),this._ComputeCenter()},_ComputeCenter:function(){var e={};switch(e.hPosition=-this._externalMargin,e.vPosition=-this._externalMargin,this.GetPropertyValue("Collab.Body.HAlignment")){case a.EHAlignment.Left:this.GetShapeInfo().center.x=.5*this.GetShapeInfo().size.x,e.hPosition-=0;break;case a.EHAlignment.Center:this.GetShapeInfo().center.x=0,e.hPosition-=.5*this.GetShapeInfo().size.x;break;case a.EHAlignment.Right:this.GetShapeInfo().center.x=.5*-this.GetShapeInfo().size.x,e.hPosition-=1*this.GetShapeInfo().size.x}switch(this.GetPropertyValue("Collab.Body.VAlignment")){case a.EVAlignment.Top:this.GetShapeInfo().center.y=.5*this.GetShapeInfo().size.y,e.vPosition-=1*this.GetShapeInfo().size.y;break;case a.EVAlignment.Middle:this.GetShapeInfo().center.y=0,e.vPosition-=.5*this.GetShapeInfo().size.y;break;case a.EVAlignment.Bottom:this.GetShapeInfo().center.y=.5*-this.GetShapeInfo().size.y,e.vPosition-=0}return e},_ComputeSize:function(){this.GetShapeInfo().size.set(this.GetPropertyValue("Collab.Body.Width"),this.GetPropertyValue("Collab.Body.Height"));var e=0;if(void 0!==this.GetPropertyValue("Collab.Body.InnerMargin")&&(e=this.GetPropertyValue("Collab.Body.InnerMargin")),this._currentText&&this.GetPropertyValue("Collab.Body.FitToText")&&(this.GetPropertyValue("Collab.Text.Wordwrap")?this.GetShapeInfo().size.y=this._TextSize.y:this.GetShapeInfo().size.copy(this._TextSize),this.GetShapeInfo().size.x+=2*e,this.GetShapeInfo().size.y+=2*e),this.GetShapeInfo().keepAspectRatio=!1,this.GetPropertyValue("Collab.Body.KeepAspectRatio")&&(this.GetShapeInfo().keepAspectRatio=!0,this.Modifiable.GetObject().backgroundImage?this.GetShapeInfo().size.y=this.GetShapeInfo().size.x*this.Modifiable.GetObject().backgroundImage.height/this.Modifiable.GetObject().backgroundImage.width:this._TextSize.x>0&&(this.GetShapeInfo().size.y=this.GetShapeInfo().size.x*this._TextSize.y/this._TextSize.x)),this._TextSize&&this._TextSize.x>0?this.GetShapeInfo().sizeBeforeEqualization=this.GetShapeInfo().size.clone():delete this.GetShapeInfo().sizeBeforeEqualization,this.GetPropertyValue("Collab.Body.ContributeToEqualSize")&&(this.GetShapeInfo().size.x=this.ExperienceBase.getManager("VCXDressupManager").GetCalloutMaxWidth()),this.GetShapeInfo().shape===a.EBodyShape.Square||this.GetShapeInfo().shape===a.EBodyShape.RoundedSquare||this.GetShapeInfo().shape===a.EBodyShape.Circle){this.GetShapeInfo().keepAspectRatio=!0;var t=Math.max(this.GetShapeInfo().size.x,this.GetShapeInfo().size.y);this.GetShapeInfo().size.x=t,this.GetShapeInfo().size.y=t}this.GetShapeInfo().internalSize.copy(this.GetShapeInfo().size),this.GetShapeInfo().internalSize.x-=2*e,this.GetShapeInfo().internalSize.y-=2*e,this.GetShapeInfo().externalSize.copy(this.GetShapeInfo().size),this.GetPropertyGroupVisibility("Group.Shadow")?this._externalMargin=this.GetPropertyValue("Collab.Body.Shadow.Distance")+1:this._externalMargin=.5,this._externalMargin+=.5*this._lineWidth,this.GetShapeInfo().externalSize.x+=2*this._externalMargin,this.GetShapeInfo().externalSize.y+=2*this._externalMargin},_ReBuildCanvasNodeTexture:function(r){if(this._ComputeSize(),!this._CanvasNode||!this._CanvasNodeTexture||Math.abs(this._CanvasNodeTexture.width-this.GetShapeInfo().externalSize.x)>.1||Math.abs(this._CanvasNodeTexture.height-this.GetShapeInfo().externalSize.y)>.1||this.realignCanvasObserver.isDirty()){if(this._CanvasNode&&this._Smart3DPaperNode&&(this._Smart3DPaperNode.remove(this._CanvasNode),this._CanvasNode=null,this._CanvasNodeTexture=null,this._Smart3DPaperNode.remove(this._HighlightCanvasNode),this._HighlightCanvasNode=null,this._HighlightCanvasNodeTexture=null),this.GetShapeInfo().externalSize.x*this.GetShapeInfo().externalSize.y>0){var o=this._ComputeCenter(),s=this._computePanelCenterMM(r);s&&(this.GetShapeInfo().centerInPaper=s);var n=new d.Vector3(o.hPosition,o.vPosition,0),l=!0;this.GetPropertyValue("Collab.3D.Paper.Positioning.Type")<=a.EPositionType.Free2D&&!this.GetPropertyValue("Collab.3D.Paper.Is.Background")&&(l=!1);var p=new d.Vector3(this.GetShapeInfo().externalSize.x,0,0),u=new d.Vector3(0,this.GetShapeInfo().externalSize.y,0);if(!this._HighlightCanvasNodeTexture){var c=this.GetShapeInfo().externalSize.x,y=this.GetShapeInfo().externalSize.y,m=!0,C=1024;this._HighlightCanvasNodeTexture=new i({width:c,height:y,rectangleTexture:m,maxZoom:C,drawCB:this._DrawHighlightCanvas,alphaTest:.005,materialParams:{opacity:0,depthTest:l,depthWrite:!1}}),this._HighlightCanvasNodeTexture.VCXNode=this}if(this._HighlightCanvasNode=new t({name:"highlightCanvas",bottomLeftcorner:n,widthVector:p,heightVector:u,canvasNodeTexture:this._HighlightCanvasNodeTexture},h),this._Smart3DPaperNode&&(this._Smart3DPaperNode.add(this._HighlightCanvasNode),this.handleLayers(!0)),!this._CanvasNodeTexture){c=this.GetShapeInfo().externalSize.x,y=this.GetShapeInfo().externalSize.y,m=!0,C=1024;this._CanvasNodeTexture=new i({width:c,height:y,rectangleTexture:m,maxZoom:C,drawCB:this._DrawRegularCanvas,alphaTest:0,materialParams:{opacity:this._globalOpacity,depthTest:l,depthWrite:!1}}),this._CanvasNodeTexture.VCXNode=this}this._CanvasNode=new t({name:"regularCanvas",bottomLeftcorner:n,widthVector:p,heightVector:u,canvasNodeTexture:this._CanvasNodeTexture},h),this._CanvasNode.setPickable(e.PICKTHROUGH),this._CanvasNode.rectangle.excludeFromHighlight(!0,!0),this._CanvasNode.traverse(function(e,t){return e.noAA=!0,!1},!0),this._Smart3DPaperNode&&this._Smart3DPaperNode.add(this._CanvasNode),this._AttachesNodeContainer&&this._AttachesNodeContainer.RecursiveSetRenderDepth(this.renderDepth),this._Smart3DPaperNode&&this._Smart3DPaperNode.RecursiveSetRenderDepth(this.renderDepth+.1),this.handleLayers(!0),this._CanvasNodeTexture._requestRedraw(),this._HighlightCanvasNodeTexture._requestRedraw()}}else this._CanvasNodeTexture._requestRedraw(),this._HighlightCanvasNodeTexture._requestRedraw();return this.ExperienceBase.getManager("VCXContextManager").renderAll(),this._CanvasNode},isNodeBuilt:function(){return Boolean(this._Smart3DPaperNode)},dispose:function(){this._Smart3DPaperNode&&(this._Smart3DPaperNode.dispose(),this._Smart3DPaperNode=null,this.GetShapeInfo().smartNode=null),this._AttachesNode&&(this._AttachesNode.dispose(),this._AttachesNode=null),delete this.realignCanvasObserver,delete this.rebuildAttachesObserver,delete this.rebuildCanvasObserver,delete this.textChangeObserver,delete this.textFontObserver,delete this.htmlChangeObserver,delete this.redrawCanvasObserver,delete this.otherOptionsObserver,delete this.observers,this._parent()},_Build:function(){this.GetShapeInfo().shape=1,this.GetShapeInfo().externalSize=new d.Vector2,this.GetShapeInfo().internalSize=new d.Vector2,this.GetShapeInfo().center=new d.Vector2,this.GetShapeInfo().centerInPaper=new d.Vector2,this.GetShapeInfo().size=new d.Vector2,this.GetShapeInfo().keepAspectRatio=null;var e={name:"AttachContainerNode",modifiable:this.Modifiable};this._AttachesNodeContainer=new o(e),this.add(this._AttachesNodeContainer);e={name:"PanelSmartNode",modifiable:this.Modifiable};this._Smart3DPaperNode=new p(e),this.GetShapeInfo().smartNode=this._Smart3DPaperNode,this.add(this._Smart3DPaperNode),this.handleLayers(!0),this.observers=[],this.realignCanvasObserver=new n,this.observers.push(this.realignCanvasObserver),this.realignCanvasObserver.add(this.Modifiable,"Collab.Body.HAlignment"),this.realignCanvasObserver.add(this.Modifiable,"Collab.Body.VAlignment"),this.rebuildAttachesObserver=new n,this.observers.push(this.rebuildAttachesObserver),this.rebuildAttachesObserver.add(this.Modifiable,"Collab.Measurement.Type"),this.rebuildAttachesObserver.add(this.Modifiable,"Collab.Measurement.Attach.Type"),this.rebuildAttachesObserver.add(this.Modifiable,"Collab.Attach.BentDot"),this.rebuildAttachesObserver.add(this.Modifiable,"Collab.Attach.LeadType"),this.rebuildAttachesObserver.add(this.Modifiable,"Collab.Attach.Origin"),this.rebuildCanvasObserver=new n,this.observers.push(this.rebuildCanvasObserver),this.rebuildCanvasObserver.add(this.Modifiable,"Collab.Body.Shape"),this.rebuildCanvasObserver.add(this.Modifiable,"Collab.Body.Width"),this.rebuildCanvasObserver.add(this.Modifiable,"Collab.Body.Height"),this.rebuildCanvasObserver.add(this.Modifiable,"Collab.Body.InnerMargin"),this.rebuildCanvasObserver.add(this.Modifiable,"Collab.Body.KeepAspectRatio"),this.rebuildCanvasObserver.add(this.Modifiable,"Collab.Border.Show"),this.rebuildCanvasObserver.add(this.Modifiable,"Collab.Border.Line.Width"),this.rebuildCanvasObserver.add(this.Modifiable,"Collab.Image.Show"),this.rebuildCanvasObserver.add(this.Modifiable,"Collab.Image.Doc.ID"),this.rebuildCanvasObserver.add(this.Modifiable,"Collab.Image.Scale"),this.rebuildCanvasObserver.add(this.Modifiable,"Collab.Body.Shadow.Show"),this.rebuildCanvasObserver.add(this.Modifiable,"Collab.Body.Shadow.Distance"),this.textChangeObserver=new n,this.observers.push(this.textChangeObserver),this.textChangeObserver.add(this.Modifiable,"Collab.Text"),this.textChangeObserver.add(this.Modifiable,"Collab.Text.Show"),this.textChangeObserver.add(this.Modifiable,"Collab.Body.FitToText"),this.textChangeObserver.add(this.Modifiable,"Collab.Text.Wordwrap"),this.textChangeObserver.add(this.Modifiable,"Collab.Text.Font"),this.textChangeObserver.add(this.Modifiable,"Collab.Text.LineSpacing"),this.textChangeObserver.add(this.Modifiable,"Collab.Text.ParagraphSpacing"),this.textChangeObserver.add(this.Modifiable,"Collab.Text.SizeToFit"),this.textChangeObserver.add(this.Modifiable,"Collab.Body.Width"),this.textChangeObserver.add(this.Modifiable,"Collab.Body.InnerMargin"),this.textFontObserver=new n,this.observers.push(this.textFontObserver),this.textFontObserver.add(this.Modifiable,"Collab.Text.Font"),this.textFontObserver.add(this.Modifiable,"Collab.Text.SizeToFit"),this.htmlChangeObserver=new n,this.observers.push(this.htmlChangeObserver),this.htmlChangeObserver.add(this.Modifiable,"Collab.Body.Width"),this.htmlChangeObserver.add(this.Modifiable,"Collab.Body.Height"),this.htmlChangeObserver.add(this.Modifiable,"Collab.Text.html"),this.redrawCanvasObserver=new n,this.observers.push(this.redrawCanvasObserver),this.redrawCanvasObserver.add(this.Modifiable,"Collab.Background.Color"),this.redrawCanvasObserver.add(this.Modifiable,"Collab.Background.Color.Opacity"),this.redrawCanvasObserver.add(this.Modifiable,"Collab.Background.Show"),this.redrawCanvasObserver.add(this.Modifiable,"Collab.Border.Line.Color"),this.redrawCanvasObserver.add(this.Modifiable,"Collab.Border.Line.Color.Opacity"),this.redrawCanvasObserver.add(this.Modifiable,"Collab.Text.Color"),this.redrawCanvasObserver.add(this.Modifiable,"Collab.Text.Color.Opacity"),this.redrawCanvasObserver.add(this.Modifiable,"Collab.Image.Color"),this.redrawCanvasObserver.add(this.Modifiable,"Collab.Image.Color.Opacity"),this.redrawCanvasObserver.add(this.Modifiable,"Collab.Body.Shadow.Orientation"),this.redrawCanvasObserver.add(this.Modifiable,"Collab.Body.Shadow.Opacity"),this.redrawCanvasObserver.add(this.Modifiable,"Collab.Body.Shadow.Blur"),this.otherOptionsObserver=new n,this.observers.push(this.otherOptionsObserver),this.otherOptionsObserver.add(this.Modifiable,"Collab.3D.Paper.Depth"),this.otherOptionsObserver.add(this.Modifiable,"Actor.IsAlwaysOnTop"),this.otherOptionsObserver.add(this.Modifiable,"Collab.3D.Paper.Billboard.Type")},preRender:function(e){var t=!1;return this.isVisible&&(this._parent(e),this.setVisibility(this.viewpointVisibility),this._Smart3DPaperNode&&(t|=this._Smart3DPaperNode.preRender(e)),this._AttachesNode&&(t|=this._AttachesNode.preRender(e))),t},postUpdate:function(e){this._parent(),this.Modifiable._panelDiv&&this.Modifiable._panelDiv.ckEditor&&this.Modifiable._panelDiv.ckEditor.checkForNecessaryRessources()&&(this.Modifiable._panelDiv.ckEditor.updateDivPosition(),this.Modifiable._panelDiv.ckEditor.updateDivSize()),this._Smart3DPaperNode&&this._Smart3DPaperNode.postUpdate(e),this._AttachesNode&&this._AttachesNode.postUpdate(e),this.observers&&this.observers.every(function(e){return e.postUpdate(),!0})},update:function(e){if(this._parent(),this._globalOpacity!==this.GlobalOpacity&&(this._globalOpacity=this.GlobalOpacity,this.isVisible=this._globalOpacity>0,this.isVisible?this._Smart3DPaperNode||this._Build():null!==this._Smart3DPaperNode&&(this._CanvasNode&&(this._Smart3DPaperNode.remove(this._CanvasNode),this._CanvasNodeTexture=null,this._CanvasNode=null),this._HighlightCanvasNode&&(this._Smart3DPaperNode.remove(this._HighlightCanvasNode),this._HighlightCanvasNode=null,this._HighlightCanvasNodeTexture=null)),this.setVisibility(this.isVisible),this._myDiv&&this._myDiv.style.opacity!==this._globalOpacity&&(this._myDiv.style.opacity=this._globalOpacity)),!(this._globalOpacity<=0)){var t=!1;if(this._Smart3DPaperNode&&this._Smart3DPaperNode.update(e),this.observers&&this.observers.every(function(e){return e.update(),!0}),!this._AttachesNode||this.rebuildAttachesObserver.isDirty()){this.rebuildAttachesObserver.isDirty()&&(this._AttachesNodeContainer.remove(this._AttachesNode),this._AttachesNode=null);var i={name:"AttachesNode",modifiable:this.Modifiable,panelNode:this};this.Modifiable.GetPropertyGroupVisibility("Group.Attach")&&(this.Modifiable.GetObject().getAttachType&&this.Modifiable.GetObject().getAttachType()?this._AttachesNode=new s(i):this._AttachesNode=new r(i),this._AttachesNodeContainer&&this._AttachesNodeContainer.add(this._AttachesNode))}this._AttachesNode&&this._AttachesNode.update(e);var o=!0;this.GetPropertyValue("Collab.3D.Paper.Positioning.Type")<=a.EPositionType.Free2D&&!this.GetPropertyValue("Collab.3D.Paper.Is.Background")&&(o=!1);var n=this._computePanelCenterMM(e);this.GetShapeInfo().centerInPaper=n,this._CanvasNodeTexture&&this._CanvasNodeTexture.setMaterialParams&&this._CanvasNodeTexture.setMaterialParams({opacity:this._globalOpacity,depthTest:o,depthWrite:!1}),this._HighlightCanvasNodeTexture&&this._HighlightCanvasNodeTexture.setMaterialParams&&this._HighlightCanvasNodeTexture.setMaterialParams({opacity:0,depthTest:o,depthWrite:!1});var p=this.textFontObserver.isDirty(),h=this.redrawCanvasObserver.isDirty();h||(this.Modifiable._panelDiv&&!this._editingState?(this._editingState=!0,h=!0):!this.Modifiable._panelDiv&&this._editingState&&(this._editingState=!1,h=!0));var d=this.textChangeObserver.isDirty(),c=null===this._HighlightCanvasNode||null===this._CanvasNode||d||this.rebuildCanvasObserver.isDirty()||this.realignCanvasObserver.isDirty(),m="";if(this.GetPropertyGroupVisibility("Group.Text")&&((m=this.Modifiable.GetComputedStringProperty("Collab.Text",l.format))||(m=" ")),m||(m=""),this._currentText!==m&&(p=!0,this._currentText=m,c=!0,d=!0),this.GetPropertyValue("Collab.Text.SizeToFit")&&c&&(d=!0),this.GetPropertyValue("Collab.Body.ContributeToEqualSize")&&this._calloutMaxWidth!==this.ExperienceBase.getManager("VCXDressupManager").GetCalloutMaxWidth()&&(this._calloutMaxWidth=this.ExperienceBase.getManager("VCXDressupManager").GetCalloutMaxWidth(),c=!0),this.otherOptionsObserver.isDirty()||c||h||d||p){if(this._CanvasNodeTexture&&this._CanvasNodeTexture.setMaterialParams&&this._CanvasNodeTexture.setMaterialParams({opacity:this._globalOpacity,depthTest:o,depthWrite:!1}),this._HighlightCanvasNodeTexture&&this._HighlightCanvasNodeTexture.setMaterialParams&&this._HighlightCanvasNodeTexture.setMaterialParams({opacity:0,depthTest:o,depthWrite:!1}),this.GetShapeInfo().shape=this.GetPropertyValue("Collab.Body.Shape"),this._lineWidth=this.GetPropertyValue("Collab.Border.Line.Width"),this.GetPropertyGroupVisibility("Group.Border")?this._lineWidth*=.3527:this._lineWidth=0,void 0!==this.GetPropertyValue("Collab.3D.Paper.Depth")&&(this.renderDepth=this.GetPropertyValue("Collab.3D.Paper.Depth",!0),this._AttachesNodeContainer&&this._AttachesNodeContainer.RecursiveSetRenderDepth(this.renderDepth),this._Smart3DPaperNode&&this._Smart3DPaperNode.RecursiveSetRenderDepth(this.renderDepth+.1)),d)if(this._currentText&&""!==this._currentText){var C=document.createElement("canvas");C.width=0,C.height=0;var f=C.getContext("2d"),V=-1;if(this.Modifiable.GetPropertyValue("Collab.Text.SizeToFit")){this._ComputeSize(),this._requestedFontRatio=1,this._SetContextToDrawText(f),this._analysedText=y.analyseText(this._currentText,null,f,V,this.Modifiable.GetObject().fontHeight,this.GetPropertyValue("Collab.Text.LineSpacing"),this.GetPropertyValue("Collab.Text.ParagraphSpacing")),this._TextSize.x=.3527*this._analysedText.maxWidth,this._TextSize.y=.3527*this._analysedText.maxHeight;var b=this.GetShapeInfo().internalSize.x/this._TextSize.x,P=this.GetShapeInfo().internalSize.y/this._TextSize.y;this._requestedFontRatio=Math.min(b,P),p=!0}else this._requestedFontRatio=1,this.GetPropertyValue("Collab.Text.Wordwrap")&&(this._ComputeSize(),V=this.GetShapeInfo().internalSize.x/.3527);this._SetContextToDrawText(f),this._analysedText=y.analyseText(this._currentText,p?null:this._analysedText,f,V,this.Modifiable.GetObject().fontHeight,this.GetPropertyValue("Collab.Text.LineSpacing"),this.GetPropertyValue("Collab.Text.ParagraphSpacing")),this._TextSize.x=.3527*this._analysedText.maxWidth,this._TextSize.y=.3527*this._analysedText.maxHeight}else this._TextSize.x=0,this._TextSize.y=0,this._analysedText=null;var _=!1,g=this.GetPropertyValue("Collab.Image.Doc.ID");if(null!=g&&this.GetPropertyGroupVisibility("Group.Image")||(g=-1),this._previousBackgroundDocID!==g||this._previousShape!==this.GetShapeInfo().shape)if(this._previousShape=this.GetShapeInfo().shape,this._previousBackgroundDocID=g,-1!==g){var S=this,M=u.Effect.None;if(this.GetShapeInfo().shape===a.EBodyShape.RemoveBorder&&(M=u.Effect.RemoveBorder),this.Modifiable){var D=this.Modifiable.GetObject().getImage(M).then(function(i){S._ReBuildCanvasNodeTexture(e),t=!0});this.Modifiable.GetObject().QueryInterface("VCXIReadiness").registerPromise(D)}_=!0}else this.Modifiable.GetObject().backgroundImage&&(this.Modifiable&&this.Modifiable.GetObject().clearImage(),c=!0);_||(!this._CanvasNode||c?(this._ReBuildCanvasNodeTexture(e),t=!0):h&&(this._CanvasNodeTexture._requestRedraw(),this._HighlightCanvasNodeTexture._requestRedraw(),this.ExperienceBase.getManager("VCXContextManager").renderAll())),this.handleLayers(t)}}},_computePanelCenterMM:function(e){var t=this.Modifiable,i=null,r=this.GetShapeInfo().smartNode.BillboardType===a.EBillboardType.Spherical;switch(this.GetShapeInfo().smartNode.PositioningType){case a.EPositionType.Free3D:if(!r)return;var o=this._ExperienceBase.getManager("VCXContextManager").getMainViewer(),s=this.GetShapeInfo().smartNode.Position,n=t.QueryInterface("W3AISGNodeHolder").getPositionInWCS(o,s),l=this._ExperienceBase.getManager("VCXPaperManager"),p={viewer:o,viewpoint:o.currentViewpoint},u=l.ModelToMM2(p,n);i=new d.Vector2(u.x,u.y);break;case a.EPositionType.RelativeToReferential:l=this.ExperienceBase.getManager("VCXPaperManager");var h=(new d.Vector3).getPositionFromMatrix(this.GetShapeInfo().smartNode.GetReferential(e)),c=l.GetModelPointFromModelPointAndPaperPosition(e,h,this.GetShapeInfo().smartNode.Position2D,this.GetShapeInfo().smartNode.PositionRadius);i=l.ModelToMM2(e,c);break;default:var y=t.GetPropertyValue("Collab.3D.Paper.Paper.Position.X"),m=t.GetPropertyValue("Collab.3D.Paper.Paper.Position.Y");i=new d.Vector2(y,m)}return i.x+=this.GetShapeInfo().center.x,i.y+=this.GetShapeInfo().center.y,i},_getPanelBoundsMM:function(e){var t=this._computePanelCenterMM(e);if(t){this.GetShapeInfo().centerInPaper=t;var i=this.GetShapeInfo().size.x,r=this.GetShapeInfo().size.y;return{center:t,left:t.x-.5*i,right:t.x+.5*i,top:t.y-.5*r,bottom:t.y+.5*r}}}})}),define("DS/VCXWebDressup/VCXLabelSGNodeHolder",["DS/VCXWebDressup/VCXDressupSGNodeHolder","DS/VCXWebDressup/VCXPanelNode"],function(e,t){"use strict";return e.extend({init:function(){},buildSGNode:function(){if(!this._sgNode){var e={name:"Label",modifiable:this.GetObject().QueryInterface("VCXIModifiable")};this._sgNode=new t(e),this._sgNode.setIcon("../VCXWebDressup/assets/icons/32/I_VCX_Panel_Tree_LabelLeaf.png")}return this._parent()}})}),define("DS/VCXWebDressup/VCXMeasurementSGNodeHolder",["DS/VCXWebDressup/VCXDressupSGNodeHolder","DS/VCXWebDressup/VCXPanelNode"],function(e,t){"use strict";return e.extend({init:function(){},buildSGNode:function(){if(!this._sgNode){var e={name:"Measurement",modifiable:this.GetObject().QueryInterface("VCXIModifiable")};this._sgNode=new t(e),this._sgNode.setIcon("../VCXWebDressup/assets/icons/32/I_VCX_Panel_Tree_LabelLeaf.png")}return this._parent()},getWorldMatrix:function(e){return this.GetObject().getReferential()}})}),define("DS/VCXWebDressup/VCXCalloutSGNodeHolder",["DS/VCXWebDressup/VCXDressupSGNodeHolder","DS/VCXWebDressup/VCXPanelNode"],function(e,t){"use strict";return e.extend({init:function(){},buildSGNode:function(){if(!this._sgNode){var e={name:"Callout",modifiable:this.GetObject().QueryInterface("VCXIModifiable")};this._sgNode=new t(e),this._sgNode.setIcon("../VCXWebDressup/assets/icons/32/I_VCX_Panel_Tree_CalloutLeaf.png")}return this._parent()}})}),define("DS/VCXWebDressup/VCXPanelSGNodeHolder",["DS/VCXWebDressup/VCXDressupSGNodeHolder","DS/VCXWebDressup/VCXPanelNode"],function(e,t){"use strict";return e.extend({init:function(){},buildSGNode:function(){if(!this._sgNode){var e={name:"Panel",modifiable:this.GetObject().QueryInterface("VCXIModifiable")};this._sgNode=new t(e),this._sgNode.setIcon("../VCXWebDressup/assets/icons/32/I_VCX_Panel_Tree_Image2DLeaf.png")}return this._parent()}})}),define("DS/VCXWebDressup/VCXDressupOrganisationShapeLeftAndRight",["DS/VCXWebDressup/VCXDressupOrganisationShape","DS/Visualization/ThreeJS_DS","DS/VCXWebKernelTools/VCXMathTools"],function(e,t,i){"use strict";return e.extend({rewind:function(){this._parent(),this.iPariteX=0,this.iPariteY=0,this.fX=this.fHalfSizeX-this.fCellSize,this.dy=0,this.fY=0,this.fX<0&&(this.fX=0)},next:function(){return this._parent(),this.iPariteX++,2===this.iPariteX&&(this.iPariteX=0,0===this.fY&&this.iPariteY++,this.iPariteY++,2===this.iPariteY&&(this.iPariteY=0,this.fY+=this.fCellSize,this.fY>this.fHalfSizeY-this.fCellSize&&(0===this.dy?this.dy=.5*this.fCellSize:this.dy=0,this.fY=0,this.fX-=this.fCellSize,this.fX<this.fCellSize)))&&(this.rewind(),!0)},getPoint:function(){var e=new t.Vector2;return 1&this.iPariteX?e.x=this.fHalfSizeX-this.fX:e.x=this.fHalfSizeX+this.fX,1&this.iPariteY?e.y=this.fHalfSizeY-this.fY+this.dy:e.y=this.fHalfSizeY+this.fY+this.dy,e}})}),define("DS/VCXWebDressup/VCXDressupOrganisationShapeTopAndLeft",["DS/VCXWebDressup/VCXDressupOrganisationShape","DS/Visualization/ThreeJS_DS"],function(e,t){"use strict";return e.extend({rewind:function(){this._parent(),this.iSwap=0,this.iPariteX=0,this.iPariteY=0,this.fX=0,this.dx=0,this.fY=this.fHalfSizeY-this.fCellSize,this.fY<0&&(this.fY=0),this.maxfx=this.fHalfSizeX-this.fCellSize-this.fCellSize,this.LRiPariteX=0,this.LRiPariteY=0,this.LRfX=this.fHalfSizeX-this.fCellSize,this.LRfX<0&&(this.LRfX=0),this.LRdy=0,this.LRfY=0,this.LRmaxfy=this.fHalfSizeY-this.fCellSize},next:function(){if(this._parent(),this.iSwap++,1&this.iSwap){if(this.LRiPariteY++,2===this.LRiPariteY&&(this.LRiPariteY=0,this.LRfY+=this.fCellSize,this.LRfY>this.fHalfSizeY-this.fCellSize&&(0===this.LRdy?this.LRdy=.5*this.fCellSize:this.LRdy=0,this.LRfY=0,this.LRfX-=this.fCellSize,this.LRfX<this.fCellSize)))return this.rewind(),!0}else if(0==this.fX&&this.iPariteX++,this.iPariteX++,2===this.iPariteX&&(this.iPariteX=0,this.fX+=this.fCellSize,this.fX>this.maxfx&&(this.maxfx-=this.fCellSize,this.maxfx<this.fCellSize&&(this.maxfx=this.fCellSize),0===this.dx?this.dx=.5*this.fCellSize:this.dx=0,this.fX=0,this.fY-=this.fCellSize,this.fY<this.fCellSize)))return this.rewind(),!0;return!1},getPoint:function(){var e=new t.Vector2;return 1&this.iSwap?(e.x=this.fHalfSizeX-this.LRfX,1&this.LRiPariteY?e.y=this.fHalfSizeY-this.LRfY+this.LRdy:e.y=this.fHalfSizeY+this.LRfY+this.LRdy):(1&this.iPariteX?e.x=this.fHalfSizeX-this.fX+this.dx:e.x=this.fHalfSizeX+this.fX+this.dx,e.y=this.fHalfSizeY-this.fY),e}})}),define("DS/VCXWebDressup/VCXDressupOrganisationShapeBottomAndTop",["DS/VCXWebDressup/VCXDressupOrganisationShape","DS/Visualization/ThreeJS_DS","DS/VCXWebKernelTools/VCXMathTools"],function(e,t,i){"use strict";return e.extend({rewind:function(){this._parent(),this.iPariteX=0,this.iPariteY=0,this.fX=0,this.dx=0,this.fY=this.fHalfSizeY-this.fCellSize,this.fY<0&&(this.fY=0)},next:function(){return this._parent(),this.iPariteY++,2===this.iPariteY&&(this.iPariteY=0,0===this.fX&&this.iPariteX++,this.iPariteX++,2===this.iPariteX&&(this.iPariteX=0,this.fX+=this.fCellSize,this.fX>this.fHalfSizeX-this.fCellSize&&(0===this.dx?this.dx=.5*this.fCellSize:this.dx=0,this.fX=0,this.fY-=this.fCellSize,this.fY<this.fCellSize)))&&(this.rewind(),!0)},getPoint:function(){var e=new t.Vector2;return 1&this.iPariteX?e.x=this.fHalfSizeX-this.fX+this.dx:e.x=this.fHalfSizeX+this.fX+this.dx,1&this.iPariteY?e.y=this.fHalfSizeY-this.fY:e.y=this.fHalfSizeY+this.fY,e}})}),define("DS/VCXWebDressup/VCXDiggerPanelNode",["DS/CoreEvents/Events","DS/VCXWebDressup/VCXMarkup_Spec","DS/VCXWebDressup/VCXPanelNode","DS/VCXWebGUIInfra/VCXArcBar","DS/VCXWebVisibility/VCXIVisibility","DS/VCXWebKernel/VCXCmdChangeSelection","DS/WebappsUtils/WebappsUtils","i18n!DS/VCXWebDressup/assets/nls/VCXWebDressup"],function(e,t,i,r,a,o,s,n){"use strict";return i.extend({init:function(e){return this._parent(e),this},dispose:function(){this.deleteDiggerPanelToolbar()},isDiggerPanel:function(e){return!!(void 0===e?this.Modifiable:e.QueryInterface("VCXIModifiable")).GetPropertyValue("Collab.AssociatedObjectID")},_Build:function(){this._parent(),this.isDiggerPanel()&&this.createDiggerPanelToolbar()},preRender:function(e){if(this.isVisible&&(this._parent(e),this.isDiggerPanel()&&this._toolbar&&this._toolbar.isVisible())){var t=this.Modifiable.QueryInterface("VCXIManipulable");t&&this._toolbar.setInManipulation(t.isManipulated());var i=this.calcToolbarInfo();this._toolbar.updateLayout(i.centerPx,i.radiusPx),this._toolbar.updateVisibilityStyle()}return!1},update:function(e){var t=this.isVisible;this._parent(e),t!==this.isVisible&&this.isDiggerPanel()&&this._toolbar&&(this._toolbar.setVisible(this.isVisible),this._toolbar.updateVisibilityStyle())},addDiggerPanelEvents:function(){this._WUXEventTokens={};var t=this,i=function(e,i){if(t._toolbar&&t.isVisible)for(var r=0;r<i.length;++r){if(i[r]===t.Modifiable.GetObject()){t._toolbar.setSelected(e),t._toolbar.updateVisibilityStyle();break}}};this._WUXEventTokens.VCX_SELECTION_ADD=e.subscribe({event:"VCX_SELECTION_COMPONENTSLIST_ADD"},function(e){i(!0,e)}),this._WUXEventTokens.VCX_SELECTION_REMOVE=e.subscribe({event:"VCX_SELECTION_COMPONENTSLIST_REMOVE"},function(e){i(!1,e)})},removeDiggerPanelEvents:function(){for(var t in this._WUXEventTokens)this._WUXEventTokens.hasOwnProperty(t)&&this._WUXEventTokens[t]&&(e.unsubscribe(this._WUXEventTokens[t]),this._WUXEventTokens[t]=null)},calcToolbarInfo:function(){var e={},t=this.ExperienceBase.getManager("VCXPaperManager"),i=t.GetMmToPxRatio();e.radiusPx=(i*this.GetShapeInfo().size.x+32)/2+5;var r=this.GetShapeInfo().centerInPaper;e.centerPx={x:i*r.x,y:i*r.y};var a=t._ViewBoxPx;return e.centerPx.x+=a.x,e.centerPx.y+=a.y,e},createDiggerPanelToolbar:function(){if(!this._toolbar){var e=this._ExperienceBase.getManager("VCXContextManager"),t=this.calcToolbarInfo(),i=this;this._toolbar=new r({experienceBase:this._ExperienceBase,body:e.getUIFrame(),frmWindow:e.getFrameWindow(),title:"Digger Panel",actionBar:e.getActionBar(),heightElem:22,widthElem:22,padding:2,updateOpacity:!1,startAngle:50,clockwise:!1,center:t.centerPx,radius:t.radiusPx,lJsonElement:[{i18n:n["DiggerPanel.Update"],url:s.getWebappsAssetUrl("VCXWebDressup","icons/I_VCX_DiggerPanel_Update.png"),id:"id_1",type:"element",callback:function(e){i.reliveDiggers(!0)}},{i18n:n["DiggerPanel.Relive"],url:s.getWebappsAssetUrl("VCXWebDressup","icons/I_VCX_DiggerPanel_Relive.png"),id:"id_2",type:"element",callback:function(e){i.reliveDiggers(!1)}}]}),this.addDiggerPanelEvents()}},deleteDiggerPanelToolbar:function(){this.removeDiggerPanelEvents(),this._toolbar&&(this._toolbar.clear(),this._toolbar=null)},reliveDiggers:function(e){var t=this._ExperienceBase.getManager("VCXSelectionManager").GetComponentsFromSelection("CSO"),i=this.Modifiable.GetObject();t.includes(i)||t.push(i);for(var r=0;r<t.length;++r){i=t[r];if(this.isDiggerPanel(i)){var a=i.QueryInterface("W3AISGNodeHolder");if(a){var o=a.getSGNode();o&&o.reliveDigger(e,i)}}}},reliveDigger:function(e,i){var r,s=(r=void 0===i?this.Modifiable:i.QueryInterface("VCXIModifiable")).GetPropertyValue("Collab.AssociatedObjectID");if(s){var n=this._ExperienceBase.ComponentsMap.GetComponentFromID(s);if(n){var l=r.GetObject().QueryInterface("VCXIVisibility");l&&l.SetVisibility(a.EVisState.Hidden),!e&&this._toolbar&&this._toolbar.setVisible(!1);var p=n.QueryInterface("W3AISGNodeHolder");if(p){var u=p.getSGNode();if(u){var h=this.GetShapeInfo(),d=this.Modifiable.GetPropertyValue("Collab.Attach.Show")&&this.Modifiable.GetPropertyValue("Collab.Attach.LeadType")!==t.ELeadType.None,c=Object.keys(this.Anchors)[0],y=this.Modifiable.GetAnchorWorldMatrix(c,null);if(u.SetPropertiesFromPanel(h,d,y),e)(m=n.QueryInterface("VCXIVisibility"))&&m.SetVisibility(a.EVisState.Visible),this.ExperienceBase.webApplication.runloop.func.apply(this.ExperienceBase.webApplication.runloop.data,[{time:1,deltaTime:1}]),u.createSnapshot2D(!1),m&&m.SetVisibility(a.EVisState.Hidden)}}if(!e){var m;(m=n.QueryInterface("VCXIVisibility"))&&m.SetVisibility(a.EVisState.Visible);var C=new o(this.ExperienceBase.getManager("VCXSelectionManager"));C.SetSelection(n),this.ExperienceBase.getManager("VCXCommandManager").Do(C)}}}},onDoubleClick:function(){this.isDiggerPanel()&&this.reliveDigger(!1)}})}),define("DS/VCXWebDressup/VCXDiggerPanelSGNodeHolder",["DS/VCXWebDressup/VCXPanelSGNodeHolder","DS/VCXWebDressup/VCXDiggerPanelNode"],function(e,t){"use strict";return e.extend({init:function(){},unreferenceSGNode:function(){this._sgNode&&(this._sgNode.dispose(),delete this._sgNode)},buildSGNode:function(){if(!this._sgNode){var e={name:"Panel",modifiable:this.GetObject().QueryInterface("VCXIModifiable")};this._sgNode=new t(e),this._sgNode.setIcon("../VCXWebDressup/assets/icons/32/I_VCX_Panel_Tree_Image2DLeaf.png")}return this._parent()}})}),define("DS/VCXWebDressup/VCXCameraNode",["DS/Mesh/MeshUtils","DS/VCXWebComponents/VCXWebComponentOccurrence","DS/VCXWebDressup/VCXDressupNode","DS/VCXWebDressup/VCXExtremityNode","DS/VCXWebDressup/VCXSmart3DPaperNode","DS/VCXWebKernelTools/VCXMathTools","DS/Visualization/ThreeJS_DS","DS/Visualization/Node3D","DS/Visualization/SceneGraphFactory","DS/VCXWebDressup/VCXMarkup_Spec"],function(e,t,i,r,a,o,s,n,l,p){"use strict";return i.extend({init:function(e){return this._parent(e),this._Node=null,this},_getPosVectArray:function(){if(!this.matrixAndDOI){var e=this.Modifiable.QueryInterface("VCXIViewpointController");if(!e)return;this.matrixAndDOI=e.getMatrixAndDOI()}var t=[],i=-this.matrixAndDOI.doi,r=Math.abs(Math.tan(Math.PI*this.GetPropertyValue("Camera.Angle")/360)*i),a=1,o=this.Modifiable.ExperienceBase.getManager("VCXPaperManager");o&&(a=o.Ratio);var n=r/a,l=new s.Vector3(0,0,0);t.push(l);var p=new s.Vector3(0,0,-this.matrixAndDOI.doi);t.push(p);var u=new s.Vector3(-n,r,i);t.push(u);var h=new s.Vector3(n,r,i);t.push(h);var d=new s.Vector3(-n,-r,i);t.push(d);var c=new s.Vector3(n,-r,i);return t.push(c),t},_ComputePosBuffer:function(e){var t=this._getPosVectArray();if(!(Array.isArray(t)&&t.length>0))return t;for(var i=t.length,r=0;r<i;r++)e[3*r+0]=t[r].x,e[3*r+1]=t[r].y,e[3*r+2]=t[r].z;return i},dispose:function(){this._CameraBodyNode&&(this._CameraBodyNode.dispose(),this._CameraBodyNode=null),this._targetExtremityNode&&(this._targetExtremityNode.dispose(),this._targetExtremityNode=null),this._parent()},_Build:function(i){if(this._Node||(this._Node=new n,this.add(this._Node)),!this._FrustrumNode&&this.GetPropertyGroupVisibility("Group.Collab.Gizmo")){var o=this._getPosVectArray(),u=new Uint16Array([0,1,0,2,0,3,0,4,0,5,2,3,3,5,5,4,4,2]),h={type:t.ELineType.Plain,lineWidth:1,color:(new s.Color).setRGB(1,1,1)};this._lineMaterial=this.ExperienceBase.getManager("VCXMaterialManager").getLineMaterialFromParams(h,this._lineMaterial);var d={points:o,idx:u,editable:!0,drawMode:e.ConnectivityTypeEnum.LINES,material:this._lineMaterial};this._FrustrumNode=l.createLineNode(d),this._FrustrumNode.setVisibilityInTree(!1),this._FrustrumNode.setPickParent(!0),this._Node.addChild(this._FrustrumNode)}if(!this._targetExtremityNode&&this.GetPropertyGroupVisibility("Group.Collab.Gizmo")){var c={name:"TargetExtremity",modifiable:this.Modifiable,type:p.EExtremityType.Dot};this._targetExtremityNode=new r(c),this.add(this._targetExtremityNode)}if(!this._CameraBodyNode){this._bodyMat=new s.MeshLambertMaterial({side:s.DoubleSide}),this._bodyMat.force=!0;var y=l.createCuboidNode({cornerPoint:new s.Vector3(-8,-10,0),firstAxis:new s.Vector3(16,0,0),secondAxis:new s.Vector3(0,20,0),thirdAxis:new s.Vector3(0,0,40)}),m=l.createCuboidNode({cornerPoint:new s.Vector3(-8.1,-8,5),firstAxis:new s.Vector3(16.2,0,0),secondAxis:new s.Vector3(0,16,0),thirdAxis:new s.Vector3(0,0,30),material:this._bodyMat}),C=l.createCuboidNode({cornerPoint:new s.Vector3(-5,-5,-10),firstAxis:new s.Vector3(10,0,0),secondAxis:new s.Vector3(0,10,0),thirdAxis:new s.Vector3(0,0,20)}),f=l.createCylinderNode({bottomCenterPoint:new s.Vector3(-4,20,30),topCenterPoint:new s.Vector3(4,20,30),radius:9,sag:16,material:this._bodyMat}),V=l.createCylinderNode({bottomCenterPoint:new s.Vector3(-4,20,10),topCenterPoint:new s.Vector3(4,20,10),radius:9,sag:16,material:this._bodyMat});c={name:"CameraBodyNode",experience:this.ExperienceBase,type:this._type};this._CameraBodyNode=new a(c),this._CameraBodyNode.SizeControlType=1,this._CameraBodyNode.ScalingFactor=.2,this._CameraBodyNode.addChild(y),this._CameraBodyNode.addChild(m),this._CameraBodyNode.addChild(C),this._CameraBodyNode.addChild(f),this._CameraBodyNode.addChild(V),this.add(this._CameraBodyNode),this._CameraBodyNode.SetReferential(new s.Matrix4)}},preRender:function(e){var t=!1;if(this._Node){var i=o.getOFromMatrix(this._Node.getMatrix()).sub(e.viewpoint.getEyePosition());t=100*i.length()>this.matrixAndDOI.doi&&i.dot(e.viewpoint.getSightDirection())>0&&this._visible,this._Node.setVisibility(t)}this.setVisibility(t),t&&(this._CameraBodyNode&&this._CameraBodyNode.preRender(e),this._targetExtremityNode&&this._targetExtremityNode.preRender(e))},update:function(t){this._parent();var i=this.ExperienceBase.getManager("VCXContextManager"),r=i&&i.isSupported("3DSync");if(!this._Node&&r){var a=this.Modifiable.QueryInterface("W3AISGNodeHolder");if(a){var n=a.getPathElement();n&&(this._Node=n.getLastElement())}}var l=this.GlobalOpacity;if(this._globalOpacity!==l&&(this._globalOpacity=l,this._visible=this._globalOpacity>0,this._visible&&(this._Node||this._Build()),this.setVisibility(this._visible),this._Node&&this._Node.setVisibility(this._visible)),!(this._globalOpacity<=0)){this._Node||this._Build();var p=this.Modifiable.QueryInterface("VCXIViewpointController");if(p){if(this.matrixAndDOI=p.getMatrixAndDOI(),this._FrustrumNode&&this.GetPropertyGroupVisibility("Group.Collab.Gizmo")){var u=this._FrustrumNode.getBuffer(e.VertexComponentEnum.POSITION);if(void 0!==u){var h=this._ComputePosBuffer(u);this._FrustrumNode.updateBuffer(e.VertexComponentEnum.POSITION,0,h),this._FrustrumNode.computeBoundingElements()}}else this._targetAxisSystemNode&&(this._Node.remove(this._targetAxisSystemNode),this._targetAxisSystemNode=null),this._positionAxisSystemNode&&(this._Node.remove(this._positionAxisSystemNode),this._positionAxisSystemNode=null);this._FrustrumNode&&this._FrustrumNode.setVisibility(this.GetPropertyGroupVisibility("Group.Collab.Gizmo")),this._targetExtremityNode&&this._targetExtremityNode.setVisibility(this.GetPropertyGroupVisibility("Group.Collab.Gizmo"));var d=this.matrixAndDOI.matrix;if(r&&(d=(new s.Matrix4).multiplyMatrices(d,(new s.Matrix4).makeRotationY(.5*-Math.PI))),this._Node.setMatrix(d),this._CameraBodyNode&&this._CameraBodyNode.SetReferential(this.matrixAndDOI.matrix),this._targetExtremityNode&&this._targetExtremityNode.update(t),this._positionAxisSystemNode){var c=(new s.Matrix4).getInverse(this.matrixAndDOI.matrix),y=(new s.Matrix4).multiplyMatrices(c,this.GetAnchorWorldMatrix(1,null));this._positionAxisSystemNode.setMatrix(y),this._positionAxisSystemNode.setNoZ(this.GetPropertyValue("Actor.IsAlwaysOnTop"))}if(this._targetAxisSystemNode){c=(new s.Matrix4).getInverse(this.matrixAndDOI.matrix),y=(new s.Matrix4).multiplyMatrices(c,this.GetAnchorWorldMatrix(2,null));this._targetAxisSystemNode.setMatrix(y),this._targetAxisSystemNode.setNoZ(this.GetPropertyValue("Actor.IsAlwaysOnTop"))}if(this._targetExtremityNode&&this._targetExtremityNode.SetReferential(o.getMatrixFromOVx(this.matrixAndDOI.target,o.getVzFromMatrix(this.matrixAndDOI.matrix))),this._bodyMat){var m=this.GetColorPropertyValue("Actor");this._bodyMat.color=m.GetThreeColor(),this._bodyMat.opacity=this._globalOpacity,this._bodyMat.opacity*=m.a}if(this._lineMaterial){var C=this.GetColorPropertyValue("Collab.Gizmo.Line");this._lineMaterial.color=C.GetThreeColor(),this._lineMaterial.opacity=this._globalOpacity*C.a,this._lineMaterial.setLineWidth(this.GetPropertyValue("Collab.Gizmo.Line.Width"))}this.handleLayers()}}}})}),define("DS/VCXWebDressup/VCXCameraSGNodeHolder",["DS/VCXWebDressup/VCXDressupSGNodeHolder","DS/VCXWebDressup/VCXCameraNode"],function(e,t){"use strict";return e.extend({init:function(){},buildSGNode:function(){if(!this._sgNode){var e={name:"Camera",modifiable:this.GetObject().QueryInterface("VCXIModifiable")};this._sgNode=new t(e),this._sgNode.setIcon("../VCXWebDressup/assets/icons/32/I_VCX_Panel_Tree_Camera.png")}return this._parent()}})}),define("DS/VCXWebDressup/VCXRedLineNode",["DS/Visualization/ThreeJS_DS","DS/Visualization/Node3D","DS/Mesh/MeshUtils","DS/VCXWebDressup/VCXDressupNode","DS/VCXWebKernelTools/VCXMeshServices"],function(e,t,i,r,a){"use strict";return r.extend({init:function(t){return this._parent(t),this._localMaterial=new e.LineBasicMaterial({color:(new e.Color).setRGB(1,0,0),opacity:1,dashSize:0,gapSize:0}),this},_Build:function(){this._Node||(this._Node=new t,this.add(this._Node));for(var e=this._Node.getChildren(),r=e.length-1;r>=0;--r)this._Node.removeChild(e[r]);var o=this.Modifiable.GetPropertyValue("Collab.VertexBuffers");if(o)for(var s=0;s<o.length;++s){var n=o[s].GetValue(),l=this._BuildFloat32arrayFromBase64(n);if(l){var p=a.buildLine(l,new i.Color(1,0,0,1),1,null,null);p.setPickParent(!0),this._updateGeom(p,1)}}},_BuildFloat32arrayFromBase64:function(e){if(!e||!e.length)return null;for(var t=window.atob(e),i=new Uint8Array(t.length),r="",a=0,o=0;o<t.length;++o)","!==t[o]?r+=t[o]:(i[a++]=parseInt(r),r="");i[a++]=parseInt(r);var s=new ArrayBuffer(a),n=new Uint8Array(s);for(o=0;o<n.length;++o)n[o]=i[o];return s.byteLength%4?null:new Float32Array(s)},_updateGeom:function(e,t){if(this._Node){if(t)this._Node.addChild(e);else{var i=this._Node.getChildren();i.length&&this._Node.removeChild(i[i.length-1]),this._Node.addChild(e)}e.setMaterial(this._localMaterial),this._localMaterial.force=!0,this.update()}},update:function(e){if(this._Node||this._Build(),this._parent(),this._globalOpacity!==this.GlobalOpacity){this._globalOpacity=this.GlobalOpacity;var t=this._globalOpacity>0;t&&(this._Node&&this._Node.getChildren().length||this._Build()),this._Node&&this._Node.setVisibility(t)}if(!(this._globalOpacity<=0)&&this._Node){var i=this.GetAnchorWorldMatrix(0,e);i&&this.setMatrix(i);var r=this.GetColorPropertyValue("Actor");this._localMaterial.color=r.GetThreeColor(),this._localMaterial.force=!0;var a=this.GetPropertyValue("Collab.Body.Line.Width");this._localMaterial.setLineWidth(a),this._localMaterial.opacity=this._globalOpacity,this.handleLayers()}}})}),define("DS/VCXWebDressup/VCXRedLineSGNodeHolder",["DS/VCXWebDressup/VCXDressupSGNodeHolder","DS/VCXWebDressup/VCXRedLineNode"],function(e,t){"use strict";return e.extend({init:function(){},buildSGNode:function(){if(!this._sgNode||void 0===this._sgNode){var e={name:"RedLine",modifiable:this.GetObject().QueryInterface("VCXIModifiable")};this._sgNode=new t(e),this._sgNode.setIcon("../VCXWebDressup/assets/icons/32/I_VCX_Panel_Tree_RedLineLeaf.png")}return this._parent()}})}),define("DS/VCXWebDressup/VCXCompassNode",["DS/Visualization/ThreeJS_DS","DS/Visualization/Node3D","DS/Visualization/SceneGraphFactory","DS/VCXWebDressup/VCXDressupNode","DS/VCXWebVisibility/VCXIVisibility"],function(e,t,i,r,a){"use strict";return r.extend({init:function(e){return this._convertFunc=null,this._currentGeomId=-1,this._nodeGeom=null,this._geomBSphereRadius=-1,this._compassMaterial=null,this._currentViewportWidth=0,this._currentViewportHeight=0,this._parent(e),this},_Build:function(){this._Node=null},setGeomConverter:function(e){this._convertFunc=e},preRender:function(e){},_showDefaultRobot:function(e){if(this.ExperienceBase.getManager("VCXContextManager").getPlayerMode()){var t=this.ExperienceBase.getManager("VCXContextManager").getMainViewer();if(t){var i=t.getRobot();i&&(e?(i.setVisibility(!1),t.setReferenceAxisSystem(!0)):(this._defaultRobotState={isConnected:i.isConnected,matrix:i.getMatrix(),visibility:!0,ratio:7},i.setVisibility(!1),t.setReferenceAxisSystem(!1)))}}},_updateCompassAspect:function(){var e=this.ExperienceBase.getManager("VCXContextManager").getMainViewer(),t=e.getRobot(),i=t._isEnabled();this._showDefaultRobot(!1);var r=0;r=!0===this.GetPropertyValue("Compass.AbsoluteSize")?this.GetPropertyValue("Compass.SizePixel"):this.GetPropertyValue("Compass.Size")*e.canvas.width;var a=-this.GetPropertyValue("Compass.Translation").x*e.canvas.width,o=+this.GetPropertyValue("Compass.Translation").y*e.canvas.height,s=2*this._geomBSphereRadius;e.setCustomReferenceAxisSystem(null),e.setCustomReferenceAxisSystem({node:this._nodeGeom,getPosition:function(e,t){return{x:2*((e-a-.5*r)/e)-1,y:2*((t-o-.5*r)/t)-1}},ratio:r/s}),t._setEnabled(i)},update:function(i){this._parent();var r=this.GetPropertyValue("Compass.GeomPath"),o=this.ExperienceBase.getManager("VCXContextManager").getMainViewer();if(-1===r)return o.setCustomReferenceAxisSystem(null),this._showDefaultRobot(!0),o.render(),this._currentGeomId=-1,this._nodeGeom=null,void(this._geomBSphereRadius=-1);if(this.Modifiable.QueryInterface("VCXIVisibility")._visible===a.EVisState.Visible){if(r!==this._currentGeomId&&this._convertFunc){var s=this,n=s.ExperienceBase.getManager("VCXDocManager").GetPropPath(r).GetValueURL().GetValue();this._convertFunc(n,function(i){if(r===s._currentGeomId){var a=new t;s._nodeGeom=a;var n=new t;a.addChild(n),s._compassMaterial||(s._compassMaterial=new e.MeshPhongMaterial({color:(new e.Color).setRGB(.5,.5,.5),opacity:1}),s._compassMaterial.force=!0),n.material=s._compassMaterial,i.forEach(function(e,t){n.add(e.geode)}),o.setCustomReferenceAxisSystem(a?{node:a,getPosition:function(e,t){return{x:0,y:0}},ratio:1}:null),s._geomBSphereRadius=1.1*a.bSphere.radius;var l=new e.Vector3(-a.bSphere.center.x,-a.bSphere.center.y,-a.bSphere.center.z),p=(new e.Matrix4).setPosition(l);a.setMatrix(p),n.setMatrix(s.GetPropertyValue("Compass.Alignment")),s._updateCompassAspect()}})}else this._updateCompassAspect();this._currentGeomId=r}else o.getCustomReferenceAxisSystem()&&(o.setCustomReferenceAxisSystem(null),this._showDefaultRobot(!0),o.render(),this._currentGeomId=-1,this._nodeGeom=null,this._geomBSphereRadius=-1)}})}),define("DS/VCXWebDressup/VCXCompassSGNodeHolder",["DS/VCXWebDressup/VCXDressupSGNodeHolder","DS/VCXWebDressup/VCXCompassNode"],function(e,t){"use strict";return e.extend({init:function(){},buildSGNode:function(){if(!this._sgNode){var e={name:"Compass",modifiable:this.GetObject().QueryInterface("VCXIModifiable")};this._sgNode=new t(e),this._sgNode.setIcon("../VCXWebDressup/assets/icons/32/I_VCX_Panel_Tree_CompassLeaf.png")}return this._parent()}})}),define("DS/VCXWebDressup/VCXDressupOrganisationShapeRight",["DS/VCXWebDressup/VCXDressupOrganisationShape","DS/Visualization/ThreeJS_DS","DS/VCXWebKernelTools/VCXMathTools"],function(e,t,i){"use strict";return e.extend({rewind:function(){this._parent(),this.iPariteY=0,this.fX=this.fHalfSizeX-this.fCellSize,this.fX<0&&(this.fX=0),this.dy=0,this.fY=0},next:function(){return this._parent(),0===this.fY&&this.iPariteY++,this.iPariteY++,2===this.iPariteY&&(this.iPariteY=0,this.fY+=this.fCellSize,this.fY>this.fHalfSizeY-this.fCellSize&&(0===this.dy?this.dy=.5*this.fCellSize:this.dy=0,this.fY=0,this.fX-=this.fCellSize,this.fX<-this.fHalfSizeX+this.fCellSize))&&(this.rewind(),!0)},getPoint:function(){var e=new t.Vector2;return e.x=this.fHalfSizeX+this.fX,1&this.iPariteY?e.y=this.fHalfSizeY-this.fY+this.dy:e.y=this.fHalfSizeY+this.fY+this.dy,e}})}),define("DS/VCXWebDressup/VCXDressupOrganisationManager",["UWA/Class","DS/VCXWebDressup/VCXMarkup_Spec","DS/Visualization/ThreeJS_DS","DS/VCXWebKernelTools/VCXMathTools","DS/VCXWebDressup/VCXDressupOrganisationShapePerimetric","DS/VCXWebDressup/VCXDressupOrganisationShapeCircle","DS/VCXWebDressup/VCXDressupOrganisationShapeRectangle","DS/VCXWebDressup/VCXDressupOrganisationShapeBottom","DS/VCXWebDressup/VCXDressupOrganisationShapeBottomAndLeft","DS/VCXWebDressup/VCXDressupOrganisationShapeBottomAndRight","DS/VCXWebDressup/VCXDressupOrganisationShapeBottomAndTop","DS/VCXWebDressup/VCXDressupOrganisationShapeTop","DS/VCXWebDressup/VCXDressupOrganisationShapeTopAndLeft","DS/VCXWebDressup/VCXDressupOrganisationShapeTopAndRight","DS/VCXWebDressup/VCXDressupOrganisationShapeLeft","DS/VCXWebDressup/VCXDressupOrganisationShapeLeftAndRight","DS/VCXWebDressup/VCXDressupOrganisationShapeRight","DS/VCXWebProperties/VCXPropertyValueFloat","DS/VCXWebProperties/VCXPropertyValueColor","DS/VCXWebProperties/VCXColor","DS/VCXWebVisibility/VCXIVisibility"],function(e,t,i,r,a,o,s,n,l,p,u,h,d,c,y,m,C,f,V,b,P){"use strict";var _=e.extend({setExperienceBase:function(e){this._experienceBase=e},_checkIfCellFree:function(e,t,i,r){for(var a=t-r-1;a<t+r;a++)for(var o=i-r-1;o<i+r;o++){if(!(o>0&&o<e.height&&a>0&&a<e.width))return!1;var s=(e.height-o)*e.width+a;if(s*=4,0!==e.data[s+0]||0!==e.data[s+1]||0!==e.data[s+2]||255!==e.data[s+3])return!1}return!0},_flagCellBusy:function(e,t,i,r){for(var a=t-r-1;a<t+r;a++)for(var o=i-r-1;o<i+r;o++)if(o>0&&o<e.height&&a>0&&a<e.width){var s=(e.height-o)*e.width+a;s*=4,e.data[s+0]=1,e.data[s+1]=1,e.data[s+2]=1,e.data[s+3]=1}},_findFirstCellCandidatePerimetric:function(e,t){for(var i=this._experienceBase.getManager("VCXPaperManager").Size,r=Math.floor(t.leadGridPositionInMM.x*e.width/i.x),a=Math.floor(t.leadGridPositionInMM.y*e.height/i.y),o=0,s=0,n=1;n<Math.max(e.width,e.height);n++){for(o=Math.max(0,r-n);o<Math.min(e.width,r+n);o++){s=Math.max(0,a-n);if(this._checkIfCellFree(e,o,s))return{col:o,row:s};if(s=Math.min(e.height,a+n),this._checkIfCellFree(e,o,s))return{col:o,row:s}}for(s=Math.max(0,a-n-1);s<Math.min(e.height,a+n-1);s++){o=Math.max(0,r-n);if(this._checkIfCellFree(e,o,s))return{col:o,row:s};if(o=Math.min(e.width,r+n),this._checkIfCellFree(e,o,s))return{col:o,row:s}}}},autoAlignDressups:function(e){var f=this._experienceBase.getManager("VCXDressupManager");if(this._dressupsToAlign=f._automaticAlignmentDressups,this._dressupsToAlign&&0!==this._dressupsToAlign.length){var V=this._experienceBase.getManager("VCXVisuManager"),b=this._experienceBase.getManager("VCXPaperManager"),_=b.Size,g=Math.round(256/_.x*_.y),S=V.getOccupationGrid(256,g,e.viewer);for(var M in this.organisationShapes||(this.organisationShapes={}),this.organisationShapes)this.organisationShapes.hasOwnProperty(M)&&(this.organisationShapes[M]._dressups=[],this.organisationShapes[M].rewind());if(S){var D,G=this._experienceBase.getManager("VCXContextManager").getActiveBOM();if(G){var v=G.QueryInterface("VCXIVisibility");if(v&&v.GetVisibility()!==P.EVisState.Hidden){var A=G.QueryInterface("VCXIModifiable");if(A.GetPropertyValue("Actor.Opacity"))for(var x=A.GetPropertyValue("Collab.3D.Paper.Paper.Position.X"),X=A.GetPropertyValue("Collab.3D.Paper.Paper.Position.Y"),I=A.GetPropertyValue("Collab.Body.Width"),T=A.GetPropertyValue("Collab.Body.Height"),N=Math.floor(x*S.width/_.x),E=Math.ceil((x+I)*S.width/_.x),w=Math.floor(X*S.height/_.y),B=Math.ceil((X+T)*S.height/_.y),O=N;O<=E;O++)for(var L=w;L<=B;L++){var W=(S.height-L)*S.width+O;W*=4,S.data[W+0]=1,S.data[W+1]=1,S.data[W+2]=1,S.data[W+3]=1}}}for(var k=0;k<this._dressupsToAlign.length;k++){var R=this._dressupsToAlign[k];R.leadAutoPosLock=!1,R.textAutoPosLock=!1;var F=R.shapeInfo&&R.shapeInfo.size&&R.shapeInfo.size.x||1;F/b.Size.x<.001&&(F=.01*b.Size.x);var z=R.QueryInterface("VCXIModifiable"),H=z.GetPropertyValue("Collab.3D.Paper.Positioning.Type");if(!(D=this.organisationShapes[H])){switch(H){case t.EPositionType.Perimetric:D=new a(_);break;case t.EPositionType.Circle:D=new o(_);break;case t.EPositionType.Rectangle:D=new s(_);break;case t.EPositionType.Bottom:D=new n(_);break;case t.EPositionType.BottomAndLeft:D=new l(_);break;case t.EPositionType.BottomAndRight:D=new p(_);break;case t.EPositionType.BottomAndTop:D=new u(_);break;case t.EPositionType.Top:D=new h(_);break;case t.EPositionType.TopAndLeft:D=new d(_);break;case t.EPositionType.TopAndRight:D=new c(_);break;case t.EPositionType.Left:D=new y(_);break;case t.EPositionType.LeftAndRight:D=new m(_);break;case t.EPositionType.Right:D=new C(_)}this.organisationShapes[H]=D,D&&(D.fCellSize=1.5*F,D.rewind())}if(D&&(D.fCellSize=1.5*F,H===t.EPositionType.Perimetric&&D.rewind(),D._dressups||(D._dressups=[]),D._dressups.push(R)),z.processAnchorsIDs(function(t){if("Location"!==t){var a=r.getOFromMatrix(z.GetAnchorWorldMatrix(t,e)),o=b.ModelToMM2(e,a);R.leadGridPositionInMM=new i.Vector2(o.x,o.y);var s=Math.floor(R.leadGridPositionInMM.x*S.width/_.x),n=Math.floor(R.leadGridPositionInMM.y*S.height/_.y),l=(S.height-n)*S.width+s;l*=4,S.data[l+0]=1,S.data[l+1]=1,S.data[l+2]=1,S.data[l+3]=1}}),D){for(var U,j=!1,Y=!1;!j;){U=D.getPoint(R.leadGridPositionInMM);var q=Math.floor(U.x*S.width/_.x),Q=Math.floor(U.y*S.height/_.y),K=Math.floor(.5*F*_.x/S.width);(j=Y||this._checkIfCellFree(S,q,Q,K))&&this._flagCellBusy(S,q,Q,K),D.next()&&(Y=!0)}R.textGridPositionInMM=U}}}for(var M in this.organisationShapes)this.organisationShapes.hasOwnProperty(M)&&(this.organisationShapes[M]&&0!==this.organisationShapes[M]._dressups.length||delete this.organisationShapes[M]);this._uncrossLinks(e)}},_locateCallout:function(e,t,i){var r=e.QueryInterface("W3AISGNodeHolder");if(r){var a=r.getSGNode();a&&a._Smart3DPaperNode&&a._Smart3DPaperNode.Position2D.copy(t)}var o=e.QueryInterface("VCXIModifiable");if(o){var s=!1;if(t.x!==o.GetPropertyValue("Collab.3D.Paper.Paper.Position.X")){s=!0;var n=new f(t.x);o.OnChangeProperty("Collab.3D.Paper.Paper.Position.X",n)}if(t.y!==o.GetPropertyValue("Collab.3D.Paper.Paper.Position.Y")){s=!0;var l=new f(t.y);o.OnChangeProperty("Collab.3D.Paper.Paper.Position.Y",l)}s&&(o.OnChangePropertiesEnd(),a.update(i))}},_uncrossLinks:function(e){for(var t in this.organisationShapes)if(this.organisationShapes.hasOwnProperty(t)){var i=this.organisationShapes[t],r=i._dressups.length;i._squareDistances&&i._squareDistances.length===r*r||(i._squareDistances=new Array(r*r));for(var a=0;a<r;a++){var o=i._dressups[a];o.leadSector=0,o.textSector=0;for(var s=0;s<r;s++){var n=i._dressups[s];if(n&&n.leadGridPositionInMM){n.leadSector=0,n.textSector=0;var l=a*r+s,p=n.leadGridPositionInMM.distanceToSquared(o.textGridPositionInMM);i._squareDistances[l]={textComponent:o,textSector:0,leadComponent:n,leadSector:0,squareDistance:p}}}}i._squareDistances.sort(function(e,t){return e.squareDistance-t.squareDistance}),this._splitSectorInto2Sectors(0,0,i,e)}},_splitSectorInto2Sectors:function(e,t,r,a){for(var o=0,s=0;s<e;s++)o|=1<<s;for(var n=r._squareDistances.length,l=new i.Vector2,p=new i.Vector2,u=!1,h=0;h<n&&!u;h++){var d=r._squareDistances[h];if(d&&!d.leadComponent.leadAutoPosLock&&!d.textComponent.textAutoPosLock&&t===(d.leadComponent.leadSector&o)&&t===(d.textComponent.textSector&o)){d.leadComponent.leadAutoPosLock=!0,d.textComponent.textAutoPosLock=!0,l.copy(d.leadComponent.leadGridPositionInMM).sub(d.textComponent.textGridPositionInMM);for(var c,y,m,C,f=0,V=0,b=0,P=1<<e,_=~P,g=r._dressups.length,S=0;S<g;S++){var M=r._dressups[S];M.leadAutoPosLock||t!==(M.leadSector&o)||(p.copy(M.leadGridPositionInMM).sub(d.textComponent.textGridPositionInMM),l.x*p.y>l.y*p.x?(f++,c=M,M.leadSector|=P):(b++,y=M,M.leadSector&=_)),M.textAutoPosLock||t!==(M.textSector&o)||(p.copy(M.textGridPositionInMM).sub(d.textComponent.textGridPositionInMM),l.x*p.y>l.y*p.x?(V++,m=M,M.textSector|=P):(0,C=M,M.textSector&=_))}f===V?(u=!0,this._locateCallout(d.leadComponent,d.textComponent.textGridPositionInMM,a),f>1?this._splitSectorInto2Sectors(e+1,t|P,r,a):1===f&&m&&c&&this._locateCallout(c,m.textGridPositionInMM,a),b>1?this._splitSectorInto2Sectors(e+1,t,r,a):1===b&&C&&y&&this._locateCallout(y,C.textGridPositionInMM,a)):(d.leadComponent.leadAutoPosLock=!1,d.textComponent.textAutoPosLock=!1,d=null)}}u||console.warn("No candidate found")}});return Object.defineProperty(_.prototype,"componentType",{enumerable:!0,get:function(){return"VCXDressupOrganisationManager"}}),_}),define("DS/VCXWebDressup/VCXDressupManager",["DS/CoreEvents/Events","DS/VisuEvents/EventsManager","UWA/Class","DS/VCXWebDressup/VCXDressupOrganisationManager","DS/VCXWebVisibility/VCXIVisibility","DS/VCXWebModifiables/VCXModelChangeListener","DS/Visualization/ThreeJS_DS","DS/VCXWebKernelTools/VCXMathTools","DS/VCXWebDressup/VCXMarkup_Spec","DS/VCXWebModifiablesServices/VCXModifiablesAccess","DS/VCXWebProperties/VCXPropertyValueString","DS/Mesh/MeshUtils","DS/VCXWebExperienceBase/VCXPathElementTools","DS/SceneGraphOverrides/SceneGraphOverrideSet","i18n!DS/VCXWebDressup/assets/nls/VCXWebDressup"],function(e,t,i,r,a,o,s,n,l,p,u,h,d,c,y){"use strict";var m=i.extend({initialize:function(){this._calloutMaxWidth=0,this._DressupRoot=null,this._DressupComponents={},this._DressupGrpsComponents=null,this._DressupComponentsToPreRender={},this._DressupSectionsToPreRender={},this._DressupComponentsToPostRender={},this.event_VCX_ROOT_COMPONENT_CREATED=e.subscribe({event:"VCX_ROOT_COMPONENT_CREATED"},function(){this.createDressupsBaseSGNodes()}.bind(this)),this.event_VCX_PROPERTIES_CHANGED=e.subscribe({event:"VCX_PROPERTIES_CHANGED"},function(){this.SetDirty()}.bind(this))},postInitialize:function(){this._currentWorkingRootMatrix=new s.Matrix4,this._experienceBase.getManager("VCXContextManager").loadCssFile("VCXWebDressup/VCXWebDressup.css",1);var e=this;this._doublePointerClickCB=function(t){var i=p.GetModifiableFromEvent(t,e._experienceBase);if(i){var r=i.GetObject();if(r){var a=r.QueryInterface("W3AISGNodeHolder");if(a){var o=a.getSGNode();o&&o.onDoubleClick&&o.onDoubleClick()}}}},t.addEvent(this._experienceBase.getManager("VCXContextManager").getMainViewer().canvas,"onPrimaryPointerDoubleClick",this._doublePointerClickCB)},getDressupGroups:function(){return this._DressupGrpsComponents||(this._DressupGrpsComponents={},this._DressupGrpsComponents.Annotations=null,this._DressupGrpsComponents.Callouts=null,this._experienceBase.getManager("VCXContextManager").isSupported("CameraDisplay")&&(this._DressupGrpsComponents.Cameras=null),this._experienceBase.getManager("VCXContextManager").isSupported("Section")&&(this._DressupGrpsComponents.Sections=null),this._DressupGrpsComponents.Diggers=null,this._experienceBase.getManager("VCXContextManager").isSupported("EnvironmentDisplay")&&(this._DressupGrpsComponents.Environment=null),this._DressupGrpsComponents.Markups=null,this._DressupGrpsComponents.Measurements=null,this._DressupGrpsComponents.Panels=null,this._experienceBase.getManager("VCXContextManager").isSupported("Paths")&&(this._DressupGrpsComponents.Paths=null)),this._DressupGrpsComponents},SetDirty:function(){this.needUpdate=2},getUpdatePriority:function(){return-5},getInitPhase:function(){return 4},unInitialize:function(){this._DressupOrganisationManager=null,e.unsubscribe(this.event_VCX_ROOT_COMPONENT_CREATED),this.event_VCX_ROOT_COMPONENT_CREATED=null,e.unsubscribe(this.event_VCX_PROPERTIES_CHANGED),this.event_VCX_PROPERTIES_CHANGED=null;var i=this._experienceBase.getManager("VCXContextManager");for(var r in i.applyToViewers(function(e){delete e.dressupSGOS}),t.removeEvent(i.getMainViewer().canvas,"onPrimaryPointerDoubleClick",this._doublePointerClickCB),this._doublePointerClickCB=null,i.unloadCssFile("VCXWebDressup/VCXWebDressup.css",1),this.RemoveDressups(this._DressupComponents),this._DressupRoot&&(i.getMainViewer().removeNode(this._DressupRoot),this._DressupRoot=null),this._DressupComponents)this._DressupComponents[r].CallDispose();this._DressupComponents=null,this._DressupGrpsComponents=null,this._DressupComponentsToPreRender=null,this._DressupSectionsToPreRender=null,this._DressupComponentsToPostRender=null,this._automaticAlignmentDressups=null},createDressupsBaseSGNodes:function(){var e=this.QueryInterface("W3AISGNodeHolder");if(this._DressupRoot=e.getSGNode(),this._experienceBase.getManager("VCXContextManager").getRootComponent()){var t=this._experienceBase.getManager("VCXContextManager").getRootComponent().QueryInterface("VCXIModelNavigable"),i=this.QueryInterface("VCXIModelNavigable");if(i)for(var r in i.setParent(t),this.getDressupGroups())if(this.getDressupGroups().hasOwnProperty(r)){if(this.getDressupGroups().dressupGrpType)continue;this.GetDressupGroup(r,!0)}}},GetDepthInformation:function(){var e={highest:0,lowest:0};for(var t in this._DressupComponents)if(this._DressupComponents.hasOwnProperty(t)){var i=this._DressupComponents[t];if(i.IsKindOf("VCXMarkup_Spec")){var r=i.QueryInterface("VCXIModifiable");if(r){var a=r.GetPropertyValue("Collab.3D.Paper.Depth");e.highest<a&&(e.highest=a),e.lowest>a&&(e.lowest=a)}}}return e},getDressupDressupNodeOverride:function(e,t){var i=this.QueryInterface("W3AISGNodeHolder"),r=i.giveSGNode();if(!e.dressupSGOS){var a=e.getSceneGraphOverrideSetManager();e.dressupSGOS=new c(r),a.pushSceneGraphOverrideSet(e.dressupSGOS)}var o=d.buildPathElement(i.getPathElement(),t);return e.dressupSGOS.createOverride(o)},FindBestName:function(e,t,i){var r=this.GetDressupGroup(e),a=y["DefaultComponentName."+t]||i&&i["DefaultComponentName."+t];if(a||(a="Dressup"),!r)return a;if(!r.highestValue){var o=r.QueryInterface("VCXIModelNavigable");r.highestValue=0;for(var s=o.getChildren(),n=s.length,l=0;l<n;++l){var p=s[l].QueryInterface("VCXIModifiable");if(p){var u=p.GetPropertyValue("Actor.Name"),h=RegExp(a+"_(\\d*)$"),d=u.match(h);d&&parseInt(d[1])>r.highestValue&&(r.highestValue=d[1])}}}return r.highestValue++,a+"_"+(r.highestValue+"").padStart(3,"0")},GetDressupGroup:function(e,t){e||console.warn("?? Check with ITY");var i=this.getDressupGroups()[e];if(!i&&t){(i=this._experienceBase.Factory.BuildComponent("VCXComponentDressupGrp")).SetID(e+"ID"),i.setName(e),i.SetPersistency(2),this._experienceBase.ComponentsMap.AddComponent(i),this.getDressupGroups()[e]=i;var r=this.QueryInterface("VCXIModelNavigable"),a=i.QueryInterface("VCXIModelNavigable");a&&r&&a.setParent(r)}return i},AddDressups:function(t){for(var i=0;i<t.length;++i)this._addDressup(t[i]);0!==t.length&&e.publish({event:"VCX_DRESSUPS_ADDED",data:t})},_addDressup:function(e){var t=e.QueryInterface("VCXIModifiable");if(t){if(""===t.GetPropertyValue("Actor.Name")){var i=this.FindBestName(e.dressupGroupName,e.getDefaultName());t.OnChangeProperty("Actor.Name",new u(i))}var r=e.GetID();if(r){if(this._DressupComponents[r])return;this._DressupComponents[r]=e,e.preRender&&(e.IsKindOf("VCXSection_Spec")?this._DressupSectionsToPreRender[r]=e:this._DressupComponentsToPreRender[r]=e),e.postRender&&(this._DressupComponentsToPostRender[r]=e);var a=this.GetDressupGroup(e.dressupGroupName,!0).QueryInterface("VCXIModelNavigable"),o=e.QueryInterface("VCXIModelNavigable");o&&a&&o.setParent(a);var s=e.QueryInterface("W3AISGNodeHolder");if(s){var n=s.getSGNode();if(n){var l=e.QueryInterface("VCXIModelNavigable");if(l){var p=l.getParent().QueryInterface("W3AISGNodeHolder");p&&(n.getParents()&&0!==n.getParents().length||p.getSGNode().addChild(n),s._pathElement||(s._pathElement=p.getPathElement().clone(),s._pathElement.addElement(n)))}n.setVisibility(!0)}}}}},RemoveDressups:function(t){if(0!==Object.keys(t).length){for(var i in e.publish({event:"VCX_DRESSUPS_PREREMOVED",data:t}),t)t.hasOwnProperty(i)&&this._removeDressup(t[i]);for(i=0;i<t.length;++i){var r=t[i].GetID();delete this._DressupComponents[r],delete this._DressupComponentsToPreRender[r],delete this._DressupSectionsToPreRender[r],delete this._DressupComponentsToPostRender[r]}e.publish({event:"VCX_DRESSUPS_REMOVED",data:t})}},_removeDressup:function(e){var t;this.getDressupGroups()[e.dressupGroupName]&&(t=this.getDressupGroups()[e.dressupGroupName].QueryInterface("VCXIModelNavigable"))&&t.removeChild(e);var i=e.QueryInterface("W3AISGNodeHolder");if(i){var r=i.giveSGNode();if(r){r.setVisibility(!1);var a=r.getParents()[0];if(a)a.removeChild(r),0===a.getChildren().length&&a.setVisibilityInTree(!1)}}},_deleteDressup:function(e){var t=this._experienceBase.getManager("VCXCAT3DXModelManager");return t?t.DeleteActor(e):UWA.Promise.resolve(e.CallDispose())},DeleteDressups:function(e){if(this.RemoveDressups(e),!e||!e.length)return UWA.Promise.resolve();var t=this,i=[];return e.forEach(function(e){e.IsDressup&&i.push(t._deleteDressup(e))}),UWA.Promise.all(i)},RefreshVisuAfterDressupChange:function(){this.SetDirty(),this.UpdateDressupList();var e=this._experienceBase.getManager("VCXModelChangeListener");e&&(e.hasChanged(o.FChangeFlag.BomID,!0),e.hasChanged(o.FChangeFlag.Visibility,!0),e.hasChanged(o.FChangeFlag.DressupVisibility,!0)),this._experienceBase.getManager("VCXContextManager").renderAll()},changeDressupsPickability:function(e){for(var t in this._DressupComponents)if(this._DressupComponents.hasOwnProperty(t)){var i=this._DressupComponents[t].QueryInterface("W3AISGNodeHolder");i&&i.giveSGNode()&&i.giveSGNode().setPickable(e?h.PICKABLE:h.PICKTHROUGH)}},getDressups:function(){return this._DressupComponents},getDressupsFromGroup:function(e){var t=[],i=this.GetDressupGroup(e);if(i){var r=i.QueryInterface("VCXIModelNavigable");if(r)for(var a=r.getChildren(),o=a.length,s=0;s<o;++s)t.push(a[s].GetObject())}return t},GetDressupCount:function(){var e=0;for(var t in this._DressupComponents)this._DressupComponents.hasOwnProperty(t)&&e++;return e},shouldComponentBeDisplayedInTree:function(e){if(this._experienceBase)return e.IsKindOf("VCXWebComponentCamera")||e.IsKindOf("CXPCameraActor_Spec")||e.IsKindOf("VCXComponentDressupGrp")&&"Cameras"===e.getName()?this._experienceBase.getManager("VCXContextManager").isSupported("CameraDisplay"):e.IsKindOf("VCXViewport_Spec")||e.IsKindOf("VCXComponentDressupGrp")&&"Environment"===e.getName()?this._experienceBase.getManager("VCXContextManager").isSupported("EnvironmentDisplay"):e.IsKindOf("VCXSection_Spec")||e.IsKindOf("VCXComponentDressupGrp")&&"Sections"===e.getName()?this._experienceBase.getManager("VCXContextManager").isSupported("Section"):e.IsKindOf("VCXComponentPath")||e.IsKindOf("VCXComponentDressupGrp")&&"Paths"===e.getName()?this._experienceBase.getManager("VCXContextManager").isSupported("Paths"):e.IsKindOf("VCXComponentDressupGrp")||e.IsKindOf("VCXDressup_Spec")},update:function(e){this._parent(e);var t=this._experienceBase.getManager("VCXContextManager");if(t){var i=this.QueryInterface("VCXIModelNavigable").getWorkingRoot();if(i){var o=i.QueryInterface("W3AISGNodeHolder");if(o){var s=o.getWorldMatrix(t.getMainViewer());s&&!n.IsMat1EqualsToMat2(s,this._currentWorkingRootMatrix)&&(this._currentWorkingRootMatrix=s.clone(),this.SetDirty())}}if(t.partHasMoved&&(this.groundDirty=2),this.groundDirty>0){if(1===this.groundDirty){var p=-1,u=t.getActiveGround();if(u){var h=u.QueryInterface("VCXIModifiable");h&&!h.GetPropertyValue("Environment.Ground.Diameter.Auto")&&(p=h.GetPropertyValue("Environment.Ground.Diameter")/2),this._experienceBase.getManager("VCXVisuManager").updateGroundPosition({radius:p})}else if(t.getActiveViewport()){var d=t.getActiveViewport().getActiveAmbienceID(),c=d&&this._experienceBase.ComponentsMap.GetComponentFromID(d);c?c.updatePosition():this._experienceBase.getManager("VCXVisuManager").updateGroundPosition({radius:-1})}}this.groundDirty--}var y=this._experienceBase.getManager("VCXVisuManager");for(var m in this._automaticAlignmentDressups&&this._automaticAlignmentDressups.length?(y.HasViewpointMoved||t.partHasMoved)&&(this.alignmentDirty=2,this._DressupOrganisationManager||(this._DressupOrganisationManager=new r,this._DressupOrganisationManager.setExperienceBase(this._experienceBase)),this._DressupOrganisationManager.autoAlignDressups(e)):this.alignmentDirty=0,this._dressupsHaveBeenAligned=!1,this._automaticAlignmentDressups=[],this._DressupComponents)if(this._DressupComponents.hasOwnProperty(m)){var C=this._DressupComponents[m];if(this.needUpdate||C.IsDressupPropertiesChangeIndependent){var f=!1,V=C.QueryInterface("VCXIVisibility");if(V&&V.GetVisibility()!==a.EVisState.Hidden){f=!0;var b=C.QueryInterface("VCXIModifiable");b&&b.GetPropertyValue("Collab.3D.Paper.Positioning.Type")<l.EPositionType.EndOfAutomaticPositionning&&this._automaticAlignmentDressups.push(C)}var P=C.isDirty();!P&&f&&(C.IsAnchorDependent&&C.hasPointedObjectMoved(e)||C.IsViewPointDependent&&y.HasViewpointMoved)&&(P=!0),(P||e&&e.force)&&C.update&&C.update(e)}}}},postUpdate:function(e){this._parent(e);var t=0;for(var i in this._DressupComponents)if(this._DressupComponents.hasOwnProperty(i)){var r=this._DressupComponents[i];r.postUpdate&&r.postUpdate(e);var a=r.QueryInterface("VCXIModifiable");a&&r.shapeInfo&&r.shapeInfo.sizeBeforeEqualization&&a.GetOpacity()&&a.GetPropertyValue("Collab.Body.ContributeToEqualSize")&&(t=Math.max(t,r.shapeInfo.sizeBeforeEqualization.x))}this._calloutMaxWidth!==t&&(this._calloutMaxWidth=t,this.SetDirty()),this.needUpdate&&this.needUpdate--},preRender:function(e){if(this._parent(e),this._preRenderDone=!1,!e.onlyPostProcess){var t=this._experienceBase.getManager("VCXContextManager");if(t.getMainViewer()===e.viewer){for(var i in t.applyToViewers(function(e){e.lockRenderIteration&&e.lockRenderIteration()}),this._DressupSectionsToPreRender)if(this._DressupSectionsToPreRender.hasOwnProperty(i)){if((o=(r=this._DressupSectionsToPreRender[i]).QueryInterface("VCXIVisibility"))&&o.GetVisibility()===a.EVisState.Hidden)continue;r.preRender&&r.preRender(e)}for(var i in this._DressupComponentsToPreRender)if(this._DressupComponentsToPreRender.hasOwnProperty(i)){var r,o;if((o=(r=this._DressupComponentsToPreRender[i]).QueryInterface("VCXIVisibility"))&&o.GetVisibility()===a.EVisState.Hidden)continue;r.preRender&&r.preRender(e)}this._preRenderDone=!0,t.applyToViewers(function(e){e.unlockRenderIteration&&e.unlockRenderIteration()})}}},postRender:function(e){if(this._parent(e),this._preRenderDone)for(var t in this._DressupComponentsToPostRender)if(this._DressupComponentsToPostRender.hasOwnProperty(t)){var i=this._DressupComponentsToPostRender[t],r=i.QueryInterface("VCXIVisibility");r&&r.GetVisibility()!==a.EVisState.Hidden&&i.postRender&&i.postRender(e)}},ChangeVisuProperties:function(e,t,i,r){},UpdateDressupList:function(){for(var e in this._DressupComponents)if(this._DressupComponents.hasOwnProperty(e)){var t=this._DressupComponents[e];if(t.update){var i={deltaTime:0,viewer:this._experienceBase.getManager("VCXContextManager").getMainViewer(),viewpoint:this._experienceBase.getManager("VCXContextManager").getMainViewer().currentViewpoint};t.update(i)}}},GetCalloutMaxWidth:function(){return this._calloutMaxWidth},getVersion:function(){return"1.0.6"}});return Object.defineProperty(m.prototype,"componentType",{enumerable:!0,get:function(){return"VCXDressupManager"}}),m});