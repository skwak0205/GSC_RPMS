define("DS/DMUSection/DMUSectionProperties",["UWA/Class","DS/Controls/Toggle","i18n!DS/DMUSection/assets/nls/DMUSection"],function(e,t,i){"use strict";return e.extend({init:function(){var e,n=null,o=null;this.getPropertiesDisplay=function(r,a){if(n=null,r){for(e=0;e<r.length;e++){var s=r[e].getAttribute("bSectionCurvesVisible");null===n?n=s:s!==n&&(n=void 0)}var l=!1,c=!1;void 0===n?c=!0:l=n,o=new t({label:i.properties.computeContour,value:"DMUComputeSectionContour",type:"checkbox",checkFlag:l,mixedState:c}).inject(a)}this.getPropertiesToSet=function(){var e=[],t=o.checkFlag;return t!==n&&(e.push({name:"bSectionCurvesVisible",value:t}),n=t),e},this.afterSetProperties=function(t,i){if(t&&i)for(e=0;e<t.length;e++){for(var n=0;n<i.length;n++){var o=i[n];o&&"bSectionCurvesVisible"===o.name&&!1===o.value&&t[e].removeSectionCurve()}t[e].refreshNode()}}}}})}),define("DS/DMUSection/DMUSectionContextualBar",["DS/DMUBaseUI/DMUContextualBarAdapter","DS/DMUBaseExperience/EXPUtils","DS/Selection/CSOManager"],function(e,t,i){"use strict";var n=!0;return e.extend({getSharedContextualMenuCommandList:function(e){var t=[];return e&&e.length&&e.forEach(function(e){-1===t.indexOf(e.getType())&&t.push(e.getType())}),1===t.length&&-1!==t[0].indexOf("DMUSection")?this.getContextualMenuCommandList():[]},getContextualMenuCommandList:function(){var e=null;return"DMUTemporaryBag"===this.getParent().getType()?e=[{line:1,name:"DMUPropertiesStr",hdr_list:["DMUPropertiesHdr"]}]:!this.isReadOnly()&&this.isEditable()?e=[{line:1,name:"DMUPropertiesStr",hdr_list:["DMUPropertiesHdr"]},{line:1,name:"DMUCutStr",hdr_list:["DMUCutHdr"]},{line:1,name:"DMUCopyStr",hdr_list:["DMUCopyHdr"]},{line:1,name:"DMUHideShowStr",hdr_list:["DMUHideShowHdr"]},{line:1,name:"DMUDeleteStr",hdr_list:["DMUDeleteHdr"]}]:this.isReadOnly()||this.isEditable()||(e=[{line:1,name:"DMUDeleteStr",hdr_list:["DMUDeleteHdr"]}]),e},getSharedContextualCommandList:function(e){n=!0;var t=[];return e&&e.length&&e.forEach(function(e){-1===t.indexOf(e.getType())&&t.push(e.getType()),!1===e.getAttribute("bSectionCurvesVisible")&&(n=!1)}),t.length>=1&&t.includes("DMUSection")?this.getContextualCommandList():[]},getContextualCommandList:function(){var e=null;return!this.isReadOnly()&&this.isEditable()&&(1===i.get().length?e="3dPlay"===this._typeApps||"Geovia"===this._typeApps||"ProgressiveVisuLoading"===this._sectionObjectMode||"DMUTemporaryBag"===this.getParent().getType()?[{name:"Flip",line:1,hdr_list:["DMUSectionFlipHdr"]},{name:"Dropdown_switchXYZ",line:1,hdr_list:["DMUSectionNormalToXHdr","DMUSectionNormalToYHdr","DMUSectionNormalToZHdr","DMUSectionPrecisePosHdr"]},{name:"NormalToView",line:1,hdr_list:["DMUSectionMoveHdr"]},{name:"Delete",line:1,hdr_list:["DMUSectionDeleteSectionHdr"]}]:"3dReview"===this._typeApps&&t.isEnvActivated("psection",!0)?n?[{name:"Dropdown_Cut",line:1,hdr_list:["DMUSectionCutHdr","DMUSectionNoCutHdr"]},{name:"Grid",line:1,hdr_list:["DMUSectionGridHdr"]},{name:"Flip",line:1,hdr_list:["DMUSectionFlipHdr"]},{name:"Dropdown_switchXYZ",line:1,hdr_list:["DMUSectionNormalToXHdr","DMUSectionNormalToYHdr","DMUSectionNormalToZHdr","DMUSectionPrecisePosHdr"]},{name:"NormalToView",line:1,hdr_list:["DMUSectionMoveHdr"]},{name:"secondaryViewer",line:1,hdr_list:["DMUSectionSecondaryViewerHdr"]},{name:"SectiveSection",line:1,hdr_list:["DMUSelectiveSectionContextCmdHdr"]},{name:"FillColor",line:1,hdr_list:["DMUGraphicPropertiesPanelHdr"]}]:[{name:"Dropdown_Cut",line:1,hdr_list:["DMUSectionCutHdr","DMUSectionNoCutHdr"]},{name:"Grid",line:1,hdr_list:["DMUSectionGridHdr"]},{name:"Flip",line:1,hdr_list:["DMUSectionFlipHdr"]},{name:"Dropdown_switchXYZ",line:1,hdr_list:["DMUSectionNormalToXHdr","DMUSectionNormalToYHdr","DMUSectionNormalToZHdr","DMUSectionPrecisePosHdr"]},{name:"NormalToView",line:1,hdr_list:["DMUSectionMoveHdr"]},{name:"SectiveSection",line:1,hdr_list:["DMUSelectiveSectionContextCmdHdr"]},{name:"FillColor",line:1,hdr_list:["DMUGraphicPropertiesPanelHdr"]}]:n?[{name:"Flip",line:1,hdr_list:["DMUSectionFlipHdr"]},{name:"Dropdown_switchXYZ",line:1,hdr_list:["DMUSectionNormalToXHdr","DMUSectionNormalToYHdr","DMUSectionNormalToZHdr","DMUSectionPrecisePosHdr"]},{name:"NormalToView",line:1,hdr_list:["DMUSectionMoveHdr"]},{name:"secondaryViewer",line:1,hdr_list:["DMUSectionSecondaryViewerHdr"]},{name:"FillColor",line:1,hdr_list:["DMUGraphicPropertiesPanelHdr"]}]:[{name:"Flip",line:1,hdr_list:["DMUSectionFlipHdr"]},{name:"Dropdown_switchXYZ",line:1,hdr_list:["DMUSectionNormalToXHdr","DMUSectionNormalToYHdr","DMUSectionNormalToZHdr","DMUSectionPrecisePosHdr"]},{name:"NormalToView",line:1,hdr_list:["DMUSectionMoveHdr"]},{name:"FillColor",line:1,hdr_list:["DMUGraphicPropertiesPanelHdr"]}]:"3dPlay"!==this._typeApps&&"3dAuthoring"!==this._typeApps&&"Geovia"!==this._typeApps&&(e=n?[{name:"Flip",line:1,hdr_list:["DMUSectionFlipHdr"]},{name:"Dropdown_switchXYZ",line:1,hdr_list:["DMUSectionNormalToXHdr","DMUSectionNormalToYHdr","DMUSectionNormalToZHdr","DMUSectionPrecisePosHdr"]},{name:"NormalToView",line:1,hdr_list:["DMUSectionMoveHdr"]},{name:"secondaryViewer",line:1,hdr_list:["DMUSectionSecondaryViewerHdr"]},{name:"FillColor",line:1,hdr_list:["DMUGraphicPropertiesPanelHdr"]}]:[{name:"Flip",line:1,hdr_list:["DMUSectionFlipHdr"]},{name:"Dropdown_switchXYZ",line:1,hdr_list:["DMUSectionNormalToXHdr","DMUSectionNormalToYHdr","DMUSectionNormalToZHdr","DMUSectionPrecisePosHdr"]},{name:"NormalToView",line:1,hdr_list:["DMUSectionMoveHdr"]},{name:"FillColor",line:1,hdr_list:["DMUGraphicPropertiesPanelHdr"]}])),e},getSharedHeaderTypes:function(){return{}},register:function(e){this._parent({frmWindow:e.frmWindow,contextualBar:{type:"DMUSection",module:"DMUSection",workbenchName:"DMUSection"},contextualMenu:{type:"DMUSection",module:"DMUBaseCtxCommands",workbenchName:"DMUBaseCtxCommands"}})},unregister:function(e){this._parent({frmWindow:e.frmWindow,contextualBar:{type:"DMUSection",module:"DMUSection",workbenchName:"DMUSection"},contextualMenu:{type:"DMUSection",module:"DMUBaseCtxCommands",workbenchName:"DMUBaseCtxCommands"}})}})}),define("DS/DMUSection/DMUSectionEditCmd",["DS/ApplicationFrame/Command","DS/DMUBaseExperience/DMUContextManager","DS/DMUPlaySection/DMUSectionRobotWithRuler","DS/DMUBaseExperience/EXPUtils"],function(e,t,i,n){"use strict";return e.extend({init:function(e){var o,r=e.viewer;this._parent(e);var a,s,l,c,d,u=n,h=t.getContextViewer({viewer:this.getFrameWindow().getViewer()}),m=i;return this.makeRobot=function(e){a=new m(e,c),s=e},this.beginExecute=function(){h&&h.setRobotVisibility&&(o=h.isRobotVisible())&&h.setRobotVisibility(!1),s&&s.setPickingInManipulationModeForLineTraslation(!1),r.currentViewpoint.setDefaultController(!1,"FLY_WALK"),a&&a.buildRobot()},this.endExecute=function(){void 0!==o&&h&&h.setRobotVisibility&&h.setRobotVisibility(o),s&&s.setPickingInManipulationModeForLineTraslation(!0),r.currentViewpoint.setDefaultController(!0,"FLY_WALK"),o=void 0,null!=d&&(d.clean(),d=null),a&&(a.clean(),a=null)},this.resumeExecute=function(){if(s&&void 0!==l&&l===r.getVisibleSpace()){this.makeRobot(s),this.beginExecute();var e=this.getRobot();s&&e&&s.setRobot(e)}else this.end();c=void 0},this.pauseExecute=function(){a&&(c=a._getRulerOriginPos()),this.endExecute(),s&&s.setRobot(null),l=r.getVisibleSpace();var e=u.getCurrentCommand(r);e&&"VisuVisibleSpace"===e&&(s=null)},this.getRequestedCommandMode=function(e){return"Measure"===e.cmd||"Section"===e.cmd?"shared":void 0},this.allowManipulation=function(e){return"Measure"===e.object||"Section"===e.object||void 0},this.getRobot=function(){return a||null},this.getRobotOrigin=function(){return c||null},this._destroy=function(){a&&(a.clean(),Object.getPrototypeOf(this)._destroy.apply(this,arguments))},this.setSlider=function(e){null!=e&&(d=e)},this}})}),define("DS/DMUSection/DMULockUnlockSection",["DS/ApplicationFrame/CommandCheckHeader","DS/DMUBaseExperience/DMUContextManager","DS/ApplicationFrame/CommandsManager"],function(e,t,i){"use strict";return e.extend({init:function(e){this._parent(e);var n=this.getFrameWindow().getViewer();n._lockUnlockCmd=this;var o=this;this.onStateChange(function(){var e=!1,r=i.getCommand("Explode",o._context);if(r&&(e=r.isRunning()),!1===e){var a=t.getReviewContext({viewer:n}),s=a?a.getCurrentSessionMarkup():null;if((!s||s&&!s.isVisible())&&(s=a?a.getTransientReviewBag():null),s){var l=[];if(s.getCurrentSlide&&s.getCurrentSlide()){var c=s.getCurrentSlide();if(!s.isReadOnly()){var d=c.getEnvironmentOverload();d&&d.state&&d.state.bLockUnlockSection!==o.getState()&&(d.state.bLockUnlockSection=o.getState(),c.updateEnvironmentOverload(d),c.fireEvent("onDMUSlideSessionInfoChanged",{dmuObject:c,info:"lockUnlockSection"}))}if(l=c.getDMUObjects("DMUSection"),c.getPointedFormats){var u=c.getPointedFormats();if(u&&u.length)for(var h=0;h<u.length;h++)l=l.concat(u[h].getDMUObjects("DMUSection"))}}else s.getDMUObjects&&(l=s.getDMUObjects("DMUSection"));for(var m=0;m<l.length;m++)l[m].manageLock(o.getState());o.getFrameWindow().getViewer().render()}}});var r=!0,a=t.getReviewContext({viewer:n});if(a){var s=a.getCurrentSessionMarkup();if(s){var l=s.getCurrentSlide();if(l){var c=l.getEnvironmentOverload();r="boolean"!=typeof c.state.bLockUnlockSection||c.state.bLockUnlockSection}}}this.setState(r)}})}),define("DS/DMUSection/DMUSelectiveSectionContextCmd",["DS/DMUBaseCommands/EXPStateCommand","DS/DMUMeasurable/DMUToolsSceneGraph","DS/DMUMeasurable/DMUMeasurableElementAgent","DS/DMUBaseCommands/EXPToolsWUX","DS/DMUControls/EXPLevelSelector","DS/Selection/CSOManager","DS/DMUBaseExperience/DMUContextManager","i18n!DS/DMUSection/assets/nls/DMUSection"],function(e,t,i,n,o,r,a,s){"use strict";return e.extend({init:function(e){this._parent(e,"exclusive",!0)},beginExecute:function(){var e=a.getReviewContext({viewer:this.getFrameWindow().getViewer()});e&&(this._section=e.getDMUObjectFromPathElement(r._items[0].pathElement),this._pathElementAgentForSection=null,this._firstSelectedPathElement=null,this._selectedPathElement=null,this._pathElementAgentForSection=new i({agentId:"_pathElementAgentForSection",frameWindow:this._frmWindow,pickingMode:"primHybrid",prePickingMode:"primHybrid",valuedFromCSO:!0,saveToCSO:!1,multiAcquisition:!0,multiAcquisitionCtrl:!0,acceptedGeometries:[]})),this._parent()},endExecute:function(){this._parent(),this._pathElementAgentForSection=null,this._levelSelector&&this._levelSelector.clean(),this._firstSelectedPathElement=null,this._selectedPathElement=null,this._section=null,this._viewer.render()},buildGraph:function(){var e=this.createInitialState("initialState"),i=this.getFinalState(),r=this;this.setEnterStateAction(e,function(){this.sendNotify("info",s.notifyobjectselection)}),this.setExitStateAction(e,function(){this.cleanNotify()});var a={iEvent:this._pathElementAgentForSection,iInitialState:e,iFinalState:e,iCondition:function(e){var i=!1;if(e&&void 0!==e[0].pathElement.getLastElement().sgNode){var n=e[0].pathElement;if(void 0!==n){var o=t.getLastReference(n);if(o){var r=o.getLastElement();t.isReference(r)&&(i=!0)}}}return i},iAction:function(e,i){r._levelSelector&&r._levelSelector.clean(),r._firstSelectedPathElement=i[0].pathElement.clone(),r._selectedPathElement=i[0].pathElement.clone();var a=function(){var e,t=[];t.push(r._selectedPathElement),(e=t)&&r._section&&(r._section.setObjects(e),n.addInCSO(r._section,!1),r._section._viewer.render())};r._levelSelector=new o({iFrameWindow:this._frmWindow,iGetPathElementCB:function(){return t.getLastReference(r._firstSelectedPathElement)},iFilterNodeCB:function(e){return t.isReference(e)},iGet3DPositionCB:function(){var e=r._selectedPathElement.getBoundingSphere(r._viewer).center;return e.x=e.x-60,e.y=e.y-60,e},iOnLevelSelectCB:function(e){r._selectedPathElement=e.pathElement.clone(),a()}}),a(),e&&e()}};this.addTransition(a),this.addEmptySelectionTransition(e,i,function(e){this._section._itfContextbar&&this._section._itfContextbar.clear(),e&&e()})}})}),define("DS/DMUSection/DMUSectionPrecisePosCmd",["DS/DMUBaseCommands/EXPStateCommand","DS/Selection/CSOManager","DS/Selection/HSOManager","DS/CATWebUXComponents/CATWebUXNotifBar","DS/DMUBaseExperience/DMUContextManager","DS/DMUMeasurable/DMUMeasurableElementAgent","DS/ApplicationFrame/CommandsManager","DS/DMUMeasurable/DMUToolsSceneGraph","DS/Visualization/PathElement","DS/DMUMeasurable/DMUSectionPosService","DS/DMUBaseExperience/EXPToolsVisualization","DS/DMUMeasurable/DMUSwitchRepService","DS/DMUMeasurable/DMUGeometryEnums","DS/DMUPlaySection/DMUSectionPosPreVisuNode3D","DS/Visualization/ThreeJS_DS","DS/Mesh/MeshUtils","DS/Visualization/Node3D","DS/DMUMeasurable/DMUMathsInfiniteGeometry","i18n!DS/DMUSection/assets/nls/DMUSection"],function(e,t,i,n,o,r,a,s,l,c,d,u,h,m,S,g,p,v,D){"use strict";return e.extend({init:function(e){this._parent(e,"shared",!0),"DMUSectionPreSelectPrecisePosHdr"===e.ID&&(this.objectAction=!0)},_destroy:function(){},_initPref:function(){},allowManipulation:function(e){return"Measure"===e.object||"Section"===e.object||void 0},setButtonEnableFlag:function(e){var t=document.getElementsByClassName("CATWebUXNotifBar"),i=e.btnId,n=e.enableFlag,o=null;"Ok"===i?o=t[0].getElementsByClassName("btn-primary"):"Cancel"===i&&(o=t[0].getElementsByClassName("btn-default")),o&&o[0]&&(!0===n?o[0].disabled=!1:!1===n&&(o[0].disabled=!0))},setText:function(e){var t=document.getElementsByClassName("CATWebUXNotifBar"),i=null;t&&t.length&&t[0].getElementsByClassName&&(i=t[0].getElementsByClassName("msg"))&&i[0]&&i[0].textContent&&e&&(i[0].textContent=e)},beginExecute:function(){this.isFinalStateExecuted=void 0;var e=o.getContextViewer({viewer:this.getFrameWindow().getViewer()});if(e.getController&&(this._viewerController=e.getController()),this._sectionInEditCmd||(this._sectionInEditCmd=a.getCommand("DMUSectionInEditModeHdr",this._ctx)),this._sectionInEditCmd&&this._sectionInEditCmd.isRunning()&&this._sectionInEditCmd.pauseExecute(),this.section=this.sectionForObjectAction,!this.section){var i=t.get();if(1===i.length&&this.getFrameWindow){var n=o.getReviewContext({viewer:this.getFrameWindow().getViewer()});n&&(this.section=n.getDMUObjectFromPathElement(i[0].pathElement))}}if(this.section){var s=this.section.getNode();if(s){var l=s._getManpForRobot();s.enableClipping(!1),this.section.setAttribute("bVisible",!1),this.section._viewer.setSectionCapping(!1),this.section.refreshNode(),l._setPlaneVisibility(!1),this.section.removeCurves(),this.section.setSectionCurveUpdateStatus(!1)}}t.empty(),this.objListObjectAction&&this.objListObjectAction.length&&(this.objectAction||(this.objectAction=!0),this.objListObjectAction.forEach(function(e){t.add(e)}));this._pathElementAgentWithCSO=new r({agentId:"_pathElementAgentWithCSO",frameWindow:this._frmWindow,engWithPSOHSO:!0,multiAcquisition:!1,multiAcquisitionCtrl:!1,pickingMode:"primHybrid",prePickingMode:"primHybrid",valuedFromCSO:!0,saveToCSO:!1,activatePrePicking:!0,acceptedGeometries:[],appli:this,checkAppli:this._checkPicking,displayAppli:this._previsualize,switchRepOnPreSelection:!0,viewerController:this._viewerController,timeoutDurationForRepLoading:1e3}),this._pathElementAgentWithoutCSO=new r({agentId:"_pathElementAgentWithoutCSO",frameWindow:this._frmWindow,engWithPSOHSO:!0,multiAcquisition:!1,multiAcquisitionCtrl:!1,pickingMode:"primHybrid",prePickingMode:"primHybrid",valuedFromCSO:!1,saveToCSO:!1,activatePrePicking:!0,acceptedGeometries:[],appli:this,checkAppli:this._checkPicking,displayAppli:this._previsualize,switchRepOnPreSelection:!0,viewerController:this._viewerController,timeoutDurationForRepLoading:1e3}),this._measurable=[],this._selectedObject=[],this._parent()},pauseExecute:function(){this._pathElementAgentWithCSO.deactivate(),this._pathElementAgentWithoutCSO.deactivate(),this._dlgBar.hide(),this._preVisuNode&&this._removePreVisuNode(),this.highlightNode&&this.highlightNode.setVisibility(!this._viewer.getVisibleSpace())},resumeExecute:function(){this._pathElementAgentWithCSO.activate(),this._pathElementAgentWithoutCSO.activate(),this._dlgBar.show(),this.highlightNode&&this.highlightNode.setVisibility(this._viewer.getVisibleSpace())},endExecute:function(){if(this._pathElementAgentWithCSO.deactivate(),this._pathElementAgentWithoutCSO.deactivate(),this._pathElementAgentWithCSO=null,this._pathElementAgentWithoutCSO=null,this.sectionForObjectAction=void 0,this.objListObjectAction=void 0,this.OnlyPlaneTreated=void 0,this.objectAction=void 0,this._removePreVisuNode(),this._removehiglightVisuNode(),this._dlgBar&&this._dlgBar.destroy(),this.section)if(this.cancelObjActionCmd){this.cancelObjActionCmd=void 0;var e=this.section;e.getParent().removeDMUObjects?e.getParent().removeDMUObjects([e]):e.getParent().getCurrentSlide().removeDMUObject(e)}else{var i=this._sectionInEditCmd;i||(i=a.getCommand("DMUSectionInEditModeHdr",this._ctx));var n=this.section.getNode();if(this.section.setAttribute("bVisible",!0),i&&!i.isRunning()&&n){var o=n._getManpForRobot();if(o){if(this.isFinalStateExecuted){this.isFinalStateExecuted=void 0;var r={pathElement:s.buildPathElement(n)};t.empty(),t.add(r)}o._setPlaneVisibility(!0),n.enableClipping(!0),this.section.setSectionCurveUpdateStatus(!0),n.update(),this.section._viewer.setSectionCapping(!0)}}}this._PlanePos=void 0},getPlanePos:function(){return this._PlanePos},computePlanePos:function(e){var t=this,i=t._viewer;t.OnlyPlaneTreated=void 0,t._bBox=void 0;var n,o=e&&e.inProgressSelList&&e.inProgressSelList.length?e.inProgressSelList:t._selectedObject,r=d.getViewpointInfo(i.currentViewpoint),a=e&&e.inProgressMeasurableList&&e.inProgressMeasurableList.length?e.inProgressMeasurableList:void 0;t._bBox=s.computeBoundingBox(t._viewer);var l=function(){var e;if(t._bBox&&t._bBox.center)e=t._bBox.center();else{var i=s.computeBoundingSphereofObjects(t._viewer);i&&i.center&&(e=i.center)}return e},u=function(e){return!!t._bBox&&t._bBox.containsPoint(e)};if(o&&o.length){var h,m="",S=o.length;if(n=void 0,1===S){var g=a?a[0]:void 0,p=o[0];m="SingleSel",n=c.sectionPosMap[m].getPos({selectedObject:p,measurable:g||(t._measurable&&t._measurable.length?t._measurable[0]:void 0),info:r,viewer:i,boxCenterCB:l,isInBox:u})}else{var v,D=[],_=[],f=[],b=-1;for(h=0;h<S;h++){var M=o[h].pathElement,C=s.isOOCTileSetNodeInPath(M),P=M.getLastElement().sgNode;if(M&&(P||C)){var U=a?a[h]:t._measurable&&t._measurable.length&&t._measurable[h]?t._measurable[h]:c.getMeasurable({primitive:M.getLastElement().sgNode,pathElement:M,position:o[h].position,normal:o[h].normal,isOOCTileSetNodeInPath:C});if(D.push(U),_.push(o[h].pathElement),f.push(o[h]),m+=c.getSelMapName(U.getType()),(v=c.sectionPosMap[m])&&v.getPos){b=h+1;break}}}if(-1!==b){var w=v.getPos({measurables:D,selectedObjectList:f,info:r,boxCenterCB:l,isInBox:u,objectAction:t.objectAction?t.objectAction:void 0});w&&w.planeDef&&(t.OnlyPlaneTreated=w.treatOnlyPlane,n=w.planeDef)}}}return t._PlanePos=n,n},computeAndUpdatePlanePos:function(){if(this.computePlanePos(),this._PlanePos&&this.section){this._bBox||(this._bBox=s.computeBoundingBox(_this._viewer));var e=this._PlanePos,t=c.computePlaneDim(this._bBox,e,this.modifyOrigin);t&&(t.fPlaneSizeV&&t.fPlaneSizeU&&(this.section.setAttribute("fYDirSize",t.fPlaneSizeV),this.section.setAttribute("fXDirSize",t.fPlaneSizeU),this.section.setAttribute("fYDirGridStep",t.fPlaneSizeV/20),this.section.setAttribute("fXDirGridStep",t.fPlaneSizeU/20)),t.plane&&(this._PlanePos=t.plane)),this.section.setAttribute("mPlaneReferential",this._PlanePos)}},setSectionObject:function(e){this.sectionForObjectAction=e},setObjectToTreat:function(e){this.objListObjectAction=e},buildGraph:function(){var e=this;function o(e,t){t.setPickParent(!0),t.setVisibilityInTree(!1),e.addChild(t)}function r(){e.highlightNode=new p,e.highlightNode.setNoZ(!0),e.highlightNode.setPickable(g.PICKTHROUGH),e._viewer&&(s.getSceneRoot(e._viewer).add(e.highlightNode),e._viewer.render())}function a(t){if(t){var i,n=new l,o=[];i=t.getPathElement();var r=t.getPrimitive();if(r)for(var a=THREEDS.SubElement.getFromSGNode(r);null!==a;)o.unshift(a),a=a.getParent();n.setFromArray(i.externalPath,o),e.addInHSO({path:n},!0)}}function d(t){if(t){var i,n=t.getType();switch(c.getSelMapName(n)){case"Point":case"Line":n===h.GeometryType.SPHERE?(!function(t){if(t){var i=t.getType();e.highlightNode||r(),e._preVisuNode||(e._preVisuNode=new m(e._viewer));var n=i===h.GeometryType.SPHERE?t.getCenter():t.getSelPoint();o(e.highlightNode,e._preVisuNode.getPointNode(n))}}(t),e.highlightNode&&(i={pathElement:s.buildPathElement(e.highlightNode)},e.addInHSO({path:i.pathElement},!0))):a(t);break;case"Axis":!function(t){t&&(e.highlightNode||r(),e._preVisuNode||(e._preVisuNode=new m(e._viewer)),o(e.highlightNode,e._preVisuNode.getAxisNode(t)))}(t),e.highlightNode&&(i={pathElement:s.buildPathElement(e.highlightNode)},e.addInHSO({path:i.pathElement},!0));break;default:return}e.highlightNode&&(e.highlightNode.setVisibility(e._viewer.getVisibleSpace()),e._viewer.render())}}e._dlgBar&&(e._dlgBar.removeAll(),e._dlgBar.destroy()),e._dlgBar=new n({className:"DMUSectionPosCommand"}).inject(e.getFrameWindow().getUIFrame()),e._dlgBar.add({msgType:"primary",message:D.firstSelection,closable:!1,buttons:[{className:"primary",label:D.ok,onClick:function(){e.publish({event:"DMUSectionPosCmdValidated"})}},{className:"default",label:D.cancel,onClick:function(){e.publish({event:"DMUSectionPosCmdCancelled"})}}]});var u=e.createInitialState("initialState");e.setEnterStateAction(u,function(){e._dlgBar.show(),e.getFrameWindow().getViewer().render(),e.setButtonEnableFlag({btnId:"Ok",enableFlag:!1})});var S=e.getFinalState(),v=e.createState("firstSelDoneState"),_=e.createState("secondSelDoneState"),f=e.createState("thirdSelDoneState"),b=function(n){"DMUSectionPreSelectPrecisePosHdr"===e.options.ID?e.cancelObjActionCmd=!0:e.cancelObjActionCmd=!1,e.isFinalStateExecuted=!0,e._removePreVisuNode(),e._removehiglightVisuNode(),t.empty(),i.empty(),n(),e._PlanePos=void 0},M=function(t){e.isFinalStateExecuted=!0;var i=e.OnlyPlaneTreated;e._removePreVisuNode(),e._removehiglightVisuNode(),e.computeAndUpdatePlanePos(),t(),e._measurable&&e._measurable.length&&e._measurable.forEach(function(e){i&&e.getType()!==h.GeometryType.PLANE||a(e)}),e.OnlyPlaneTreated=void 0,e._PlanePos=void 0};function C(){d(e._measurable[0]),e.setText(D.secondSelection),e.setButtonEnableFlag({btnId:"Ok",enableFlag:!0})}function P(){if(e.modifyOrigin=!0,e._measurable&&e._measurable.length){var t=e._measurable[0].getType();t!==h.GeometryType.POINT&&t!==h.GeometryType.LINE&&t!==h.GeometryType.CIRCLE||(e.modifyOrigin=!1),t===h.GeometryType.PLANE||t===h.GeometryType.SURFACE||t===h.GeometryType.CURVE||e.objectActionValidSelDone?(e.objectActionValidSelDone&&e._selectedObject&&e._selectedObject.length>1&&(e.modifyOrigin=!1),e.publish({event:"DMUSectionPosCmdValidated"})):C()}}function U(){e.modifyOrigin=!1,e.goForthirdSel?(e.setText(D.thirdSelection),e.setButtonEnableFlag({btnId:"Ok",enableFlag:!1}),e._measurable&&e._measurable.length>1&&(d(e._measurable[0]),d(e._measurable[1])),e.goForthirdSel=!1):e.publish({event:"DMUSectionPosCmdValidated"})}function w(e){for(var t=0;t<e.length;t++)if(e[t].getType()===h.GeometryType.PLANE)return{index:t}}e.addTransition({iSender:e,iEvent:"DMUSectionPosCmdCancelled",iInitialState:u,iFinalState:S,iAction:b}),e.addTransition({iSender:e,iEvent:"DMUSectionPosCmdCancelled",iInitialState:v,iFinalState:S,iAction:b}),e.addTransition({iSender:e,iEvent:"DMUSectionPosCmdCancelled",iInitialState:_,iFinalState:S,iAction:b}),e.addTransition({iSender:e,iEvent:"DMUSectionPosCmdCancelled",iInitialState:f,iFinalState:S,iAction:b}),e.addTransition({iSender:e,iEvent:"DMUSectionPosCmdValidated",iInitialState:v,iFinalState:S,iAction:M}),e.addTransition({iSender:e,iEvent:"DMUSectionPosCmdValidated",iInitialState:_,iFinalState:S,iAction:M}),e.addTransition({iSender:e,iEvent:"DMUSectionPosCmdValidated",iInitialState:f,iFinalState:S,iAction:M}),e.addTransition({iSender:e,iEvent:"GoToSecondSelDoneState",iInitialState:v,iFinalState:_,iAction:function(t){t(),e._measurable&&e._measurable.length>1&&(d(e._measurable[0]),d(e._measurable[1]))}}),document.addEventListener("keydown",function(t){if(t&&("Enter"===t.key||13===t.keyCode)&&!1===t.ctrlKey&&!1===t.altKey&&!1===t.shiftKey&&!1===t.metaKey){var i,n=document.getElementsByClassName("CATWebUXNotifBar");if(n&&n.length)(i=n[0].getElementsByClassName("btn-primary"))&&i[0]&&!1===i[0].disabled&&e.publish({event:"DMUSectionPosCmdValidated"})}}),e.addTransition({iEvent:e._pathElementAgentWithCSO,iInitialState:u,iFinalState:v,iCondition:function(n){e.onlyOneInSelList=!1,e.goForthirdSel=!1,e.objectActionValidSelDone=!1;var o=!1;if(e._measurable=[],e._selectedObject=[],e.objectAction&&(t.empty(),i.empty()),e.objectAction&&1!==n.length){var r=[],a=[];if(n.forEach(function(e){var t=c.getMeasurable(e);t&&(a.push(t),r.push(e))}),2===r.length)o=!0,function(t,i){if(!(!t||!i||t.length<2||i.length<2)){var n=t[0].getType(),o=t[1].getType(),r=e._checkfor2PointSel(n,o);if(r||e.computePlanePos({inProgressSelList:i,inProgressMeasurableList:t}))t&&t.forEach(function(t){e._measurable.push(t)}),i.forEach(function(t){e._selectedObject.push(t)}),r?(d(t[0]),d(t[1]),e.goForthirdSel=!0):e.objectActionValidSelDone=!0;else{var a=w(t);a&&void 0!==a.index?(e._measurable.push(t[a.index]),e._selectedObject.push(i[a.index]),d(t[a.index]),e.objectActionValidSelDone=!0):(e._measurable.push(t[0]),e._selectedObject.push(i[0]),d(t[0]))}}}(a,r);else if(3===r.length)o=!0,function(t,i){if(!(!t||!i||t.length<3||i.length<3))if(e.modifyOrigin=!1,e.computePlanePos({inProgressSelList:i,inProgressMeasurableList:t}))t&&t.forEach(function(t){e._measurable.push(t)}),i.forEach(function(t){e._selectedObject.push(t)}),e.objectActionValidSelDone=!0;else if(e.computePlanePos({inProgressSelList:[i[0],i[1]],inProgressMeasurableList:[t[0],t[1]]}))e._measurable.push(t[0]),e._measurable.push(t[1]),e._selectedObject.push(i[0]),e._selectedObject.push(i[1]),e.objectActionValidSelDone=!0;else if(e.computePlanePos({inProgressSelList:[i[0],i[2]],inProgressMeasurableList:[t[0],t[2]]}))e._measurable.push(t[0]),e._measurable.push(t[2]),e._selectedObject.push(i[0]),e._selectedObject.push(i[2]),e.objectActionValidSelDone=!0;else if(e.computePlanePos({inProgressSelList:[i[1],i[2]],inProgressMeasurableList:[t[1],t[2]]}))e._measurable.push(t[1]),e._measurable.push(t[2]),e._selectedObject.push(i[1]),e._selectedObject.push(i[2]),e.objectActionValidSelDone=!0;else{var n=w(t);n&&n.index?(e._measurable.push(t[n.index]),e._selectedObject.push(i[n.index]),d(t[n.index]),e.objectActionValidSelDone=!0):(e._measurable.push(t[0]),e._selectedObject.push(i[0]),d(t[0]))}}(a,r);else{o=!0;var s=w(a);s&&s.index?(e._measurable.push(a[s.index]),e._selectedObject.push(r[s.index]),d(a[s.index]),e.objectActionValidSelDone=!0):(e._measurable.push(a[0]),e._selectedObject.push(r[0]),d(a[0]))}}else{var l=c.getMeasurable(n[0]);l&&l.getType()!==h.GeometryType.PRODUCT&&(e._measurable.push(l),e._selectedObject.push(n[0]),d(l),e.onlyOneInSelList=!0,o=!0)}return o},iAction:function(t){t(),!e.objectAction||e.objectActionValidSelDone?P():e.onlyOneInSelList?(e.onlyOneInSelList=!1,P()):e.goForthirdSel?(U(),e.publish({event:"GoToSecondSelDoneState"})):e._measurable&&1===e._measurable.length&&C(),e.objectAction=void 0}}),e.addTransition({iEvent:e._pathElementAgentWithoutCSO,iInitialState:v,iFinalState:_,iCondition:function(t){var i=c.getMeasurable(t[0]);if(i){if(i.getType()!==h.GeometryType.PRODUCT&&e._measurable.push(i),e._selectedObject.push(t[0]),d(i),!e.goForthirdSel&&2===e._measurable.length){var n=e._measurable[0].getType(),o=e._measurable[1].getType();e._checkfor2PointSel(n,o)&&(e.goForthirdSel=!0)}return!0}return!1},iAction:function(e){e(),U()}}),e.addTransition({iEvent:e._pathElementAgentWithoutCSO,iInitialState:_,iFinalState:f,iCondition:function(t){var i=c.getMeasurable(t[0]);return!!i&&(i.getType()!==h.GeometryType.PRODUCT&&e._measurable.push(i),e._selectedObject.push(t[0]),d(i),e.modifyOrigin=!1,!0)},iAction:function(t){t(),e.publish({event:"DMUSectionPosCmdValidated"})}})},_isLoaded:function(e){this._switchService||(this._switchService=new u({viewer:this._viewer}));var t,i=[],n=e;if(this._switchService.retriveNodesFromPath(n,i),i&&i.length)for(var o=0;o<i.length;o++)if(t=i[o],this._viewerController.hasMeshInRAM(s.getNodeID(t))&&"cgr"===this._viewerController.getLoadedStream(t))return!0;return!1},_checkfor2PointSel:function(e,t){var i=!1;return"Point"===c.getSelMapName(e)&&"Point"===c.getSelMapName(t)&&(i=!0),i},_checkPicking:function(e,t){if(!e)return!1;if(!t._isLoaded(e))return!0;var i=c.getMeasurable({pathElement:e});if(i){if(t._measurable&&!t._measurable.length)return!0;var n=[],o=[];t._measurable.forEach(function(e){n.push(e)}),n.push(i),t._selectedObject.forEach(function(e){o.push(e)}),o.push({pathElement:e});var r="",a=function(){return n.forEach(function(e){r+=c.getSelMapName(e.getType())}),!(!c.sectionPosMap[r]||!t.computePlanePos({inProgressSelList:o,inProgressMeasurableList:n}))};if(t._measurable&&1===t._measurable.length){t.goForthirdSel=!1;var s=n[0].getType(),l=n[1].getType();return t._checkfor2PointSel(s,l)?(t.goForthirdSel=!0,!0):a()}if(t._measurable&&2===t._measurable.length)return a()}return!1},_removePreVisuNode:function(){this._preVisuNode&&(s.getSceneRoot(this._viewer).remove(this._preVisuNode),this._viewer.render(),this._preVisuNode.removeChildren(),this._preVisuNode.remove(),this._preVisuNode=void 0)},_removehiglightVisuNode:function(){this.highlightNode&&(s.getSceneRoot(this._viewer).remove(this.highlightNode),this._viewer.render(),this.highlightNode.removeChildren(),this.highlightNode.remove(),this.highlightNode=void 0)},_previsualize:function(e,t){if(e&&e.pathElement){var i,n,o,r,a=t._viewer,l=new S.Vector3,u=new S.Vector3,p=new S.Vector3,D=function(){return r&&"Axis"===c.getSelMapName(r.getType())};if(t._PlanePos)if(r=c.getMeasurable(e),(n=t._PlanePos).extractBasis(l,u,p),D())if(r.getType()===h.GeometryType.CIRCLE)o=r.getCenter();else{var _=e.position?e.position:r.getSelPoint(),f=r.getPoints(),b=r.getAxis().clone().toArray(),M=_.clone().toArray(),C=f.beginPoint.toArray(),P=p.clone().toArray(),U=v.computeTwoLinesDistance(M,P,C,b).aPosition2;o=new S.Vector3(U[0],U[1],U[2])}else o=e.position?e.position:(new S.Vector3).getPositionFromMatrix(n);else{var w=d.getViewpointInfo(a.currentViewpoint);i=c.sectionPosMap.SingleSel.getPos({selectedObject:e,info:w,viewer:a,retriveMeasureble:!0}),r=i&&i.measurable?i.measurable:c.getMeasurable(e),i.plane&&((n=i.plane).extractBasis(l,u,p),o=(new S.Vector3).getPositionFromMatrix(n))}return n&&(r||(r=c.getMeasurable(e)),t._preVisuNode?t._preVisuNode.buildPreVisuNode({data:{point:o,normal:p.negate(),measurable:r,toShowAxisVisu:D}}):(t._preVisuNode=new m(a),t._preVisuNode.buildPreVisuNode({data:{point:o,normal:p.negate(),measurable:r,toShowAxisVisu:D}}),t._preVisuNode.setNoZ(!0),t._preVisuNode.setPickable(g.PICKTHROUGH),a&&(s.getSceneRoot(a).add(t._preVisuNode),a.render())),t._preVisuNode.setVisibility(a.getVisibleSpace())),!0}t._preVisuNode&&t._removePreVisuNode()}})}),define("DS/DMUSection/DMUSectionSecondaryViewer",["DS/DMUControls/EXPSecondaryViewer","DS/Visualization/ThreeJS_DS","DS/Visualization/Viewpoint","DS/DMUBaseExperience/EXPToolsVisualization","DS/WebappsUtils/WebappsUtils","i18n!DS/DMUControls/assets/nls/DMUControls"],function(e,t,i,n,o,r){"use strict";return e.extend({init:function(e){var t=this._setupOptions(e);this._sectionObj=e,this._parent(t),this._setupViewer(e),this.addCommands(),this.show()},_setupOptions:function(e){return{body:e._frmWindow.getUIFrame(),height:"378",width:"360",title:r.sectionsecondaryviewer,position:{top:"50",left:"50"}}},_setupViewer:function(e){var o=e._viewer.backgroundColor;this._viewerSecondary.setBackgroundColor(o),this._bgColorDefault=!0;var r=e.getSectionCurvesFor2DViwer();this._viewerSecondary.addNode(r);var a={viewer:this._viewerSecondary};this._viewpointSec=new i(a),this._viewpointSec.onMove(this._viewerSecondary.render),this._viewerSecondary.addViewpoint(this._viewpointSec),this._viewpointSec.setDefaultController(!0,"CATIA"),this._viewpointSec.control.setRotationActive(!1);var s=this._viewpointSec.getAngle(),l=r.bSphere,c=l.center,d=1.5*l.radius/Math.tan(s/2);n.moveViewpoint({viewpoint:this._viewerSecondary.currentViewpoint,target:c,sightDirection:new t.Vector3(0,0,1),upDirection:new t.Vector3(0,1,0),targetDistance:d,duration:0})},render:function(){this._viewerSecondary.render()},addCommands:function(){for(var e=o.getWebappsAssetUrl("DMUSection","icons/32/"),i=[{className:"secondaryViewerRotateCWCmd",nls:r.rotateClockwise,url:e+"I_3DSHAREPRORotateCW.png",callback:function(e){var t=.5*Math.PI;e._rotateViewpoint(t)}},{className:"secondaryViewerRotateCCWCmd",nls:r.rotateCounterClockwise,url:e+"I_3DSHAREPRORotateCCW.png",callback:function(e){var t=-.5*Math.PI;e._rotateViewpoint(t)}},{className:"secondaryViewerFlipVerticalCmd",nls:r.flipVertical,url:e+"I_SectionWebInvertVertical.png",callback:function(e){var i=e.options.viewer.currentViewpoint,n=i.getTarget(),o=i.control.orientation.clone(),r=i.getUpDirection(),a=Math.PI,s=(new t.Quaternion).setFromAxisAngle(r,a);o.multiplyQuaternions(s,o.clone());var l=i.control.distanceToTarget;i.control.moveTo({target:n,orientation:o,distanceToTarget:l,duration:400})}},{className:"secondaryViewerFlipHorizontalCmd",nls:r.flipHorizontal,url:e+"I_SectionWebInvertHorizontal.png",callback:function(e){var i=e.options.viewer.currentViewpoint,n=i.getTarget(),o=i.control.orientation.clone(),r=i.getUpDirection(),a=i.getSightDirection(),s=(new t.Vector3).crossVectors(r,a).normalize(),l=Math.PI,c=(new t.Quaternion).setFromAxisAngle(s,l);o.multiplyQuaternions(c,o.clone());var d=i.control.distanceToTarget;i.control.moveTo({target:n,orientation:o,distanceToTarget:d,duration:400})}},{className:"secondaryViewerBgColorCmd",nls:r.switchBgColor,url:e+"I_MldColor2.png",callback:function(e){if(e._bgColorDefault){var t=e._sectionObj.getAttribute("cFillStyleColor");e._viewerSecondary.setBackgroundColor(t.getHex())}else{var i=e._sectionObj._viewer.backgroundColor;e._viewerSecondary.setBackgroundColor(i)}e._bgColorDefault=!e._bgColorDefault}}],n=0;n<i.length;n++)this.addButton(i[n])},_rotateViewpoint:function(e){var i=this.options.viewer.currentViewpoint,n=i.getTarget(),o=i.getEyePosition(),r=i.control.orientation.clone(),a=(new t.Vector3).subVectors(o,n).normalize(),s=(new t.Quaternion).setFromAxisAngle(a,e);r.multiplyQuaternions(s,r.clone());var l=i.control.distanceToTarget;i.control.moveTo({target:n,orientation:r,distanceToTarget:l,duration:400})}})}),define("DS/DMUSection/DMUCreateSectionCmd",["UWA/Utils","DS/DMUBaseCommands/EXPCommand","DS/DMUPlaySection/DMUToolsSection","DS/DMUMeasurable/DMUToolsSceneGraph","DS/DMUMeasurable/DMUSwitchRepService","DS/DMUMeasurable/DMUSectionPosService","DS/DMUBaseUIControllers/DMUReviewContextInitializer","DS/DMUPlaySection/DMUSection","DS/DMUBaseExperience/EXPUtils","DS/DMUBaseCommands/EXPToolsWUX","DS/ApplicationFrame/CommandsManager","DS/DMUBaseExperience/DMUContextManager","DS/CATWebUXPreferences/CATWebUXPreferencesManager","DS/DMUSection/DMUSectionEditCmd","DS/Selection/CSOManager","DS/Visualization/ThreeJS_DS","DS/DMUSection/DMUSectionPrecisePosCmd","i18n!DS/DMUSection/assets/nls/DMUSection"],function(e,t,i,n,o,r,a,s,l,c,d,u,h,m,S,g,p,v){"use strict";return t.extend({init:function(e){this._parent(e),this._context=e.context,"ProgressiveVisuLoading"===this._arguments[0].ID&&(this._sectionCommandMode="ProgressiveVisuLoading"),this.sectionEditCmd=new m({ID:"DMUSectionInEditModeHdr",context:this._context,isAsynchronous:!0,mode:"shared",viewer:this._viewer});if(u.setAuthoringFeatureTypes("Section"),"ProgressiveVisuLoading"!==this._sectionCommandMode){var t=h.getPreferenceManager({context:this.getFrameWindow()});if(t){var i=u.getEventsController({viewer:this.getFrameWindow().getViewer()});t.addPreferences([{nls:v.preferences.sectionSectionTitle,id:"SectionPreferences",type:"section",preferences:[{nls:v.preferences.ComputeContourLbl,id:"DMUSectionComputeContour",type:"checkbox",getValue:function(){return"true"===localStorage.getItem("DMUComputeSectionContour")},getDefaultValue:function(){return!1},setValue:function(e){e!==("true"===localStorage.getItem("DMUComputeSectionContour"))&&(localStorage.setItem("DMUComputeSectionContour",e?"true":"false"),i&&i.fireEvent("onDMUPreferencesChanged",{DMUSectionComputeContour:e}))}}]}])}}this.destroy=function(){if("ProgressiveVisuLoading"!==this._sectionCommandMode){var e=h?h.givePreferenceManager({context:this.getFrameWindow()}):null;e&&e.removePreferences(["SectionPreferences"]),h&&h.unreferencePreferenceManager({context:this.getFrameWindow()})}}},begin:function(){if(!this._isRunning){var e=d.getCommand(d.getCurrentCmdId(this._ctx),this._ctx),t=e&&e.getRequestedCommandMode?e.getRequestedCommandMode({cmd:"Section"}):"exclusive";this._mode="shared"===t?"shared":"exclusive"}this._parent.apply(this,arguments)},setCommandMode:function(e){this._sectionCommandMode=void 0,"ProgressiveVisuLoading"===e&&(this._sectionCommandMode="ProgressiveVisuLoading")},beginExecute:function(){var e=this;e.sectionPrecisePosCmd=void 0;if(function(){var t,i,r=e._viewer,a=S.get(),s=a.length,l=[],c=!1;if(s){var d=u.getContextViewer({viewer:e.getFrameWindow().getViewer()});for(d.getController&&(e._viewerController=d.getController()),e._switchService||(e._switchService=new o({viewer:r})),t=0;t<s;t++){var h,m,g=[];if(m=n.isOOCTileSetNodeInPath(a[t].pathElement),a[t].pathElement&&a[t].pathElement.getLastElement())if(a[t].pathElement.getLastElement().sgNode||n.isPathToAxisSystem(a[t].pathElement)||m){if(!m)if(e._switchService.retriveNodesFromPath(a[t].pathElement,g),g&&g.length)for(i=0;i<g.length;i++)h=g[i],a[t].pathElement&&a[t].pathElement.getLastElement&&(e._viewerController.hasMeshInRAM(n.getNodeID(h))&&"thumbnail"!==e._viewerController.getLoadedStream(h)||(l.push(a[t]),c=!0));else l.push(a[t]),c=!0}else l.push(a[t]),c=!0;else l.push(a[t]),c=!0}}c&&l.length&&l.forEach(function(e){S.remove(e)})}(),S.get().length){e.sectionPrecisePosCmd=d.getCommand("DMUSectionPreSelectPrecisePosHdr",e._context),e.sectionPrecisePosCmd||(e.sectionPrecisePosCmd=new p({context:this._context,ID:"DMUSectionPreSelectPrecisePosHdr",isEnabled:!0}));var t=[];S.get().forEach(function(i){var n;i.normal&&i.tangent&&i.position||(n=function(t){if(t&&t.event){var i=t.event.currentPosition?t.event.currentPosition:t.event.from?t.event.from[0].currentPosition:new g.Vector2(0,0),n=i?e._viewer.getMousePosition(i):void 0;return n?e._viewer.pick(n,"primHybrid",!0):void 0}}(i)),t.push({pathElement:i.pathElement?i.pathElement.clone():void 0,position:i.position?i.position.clone():n&&n.position?n.position:void 0,normal:i.normal?i.normal.clone():n&&n.normal?n.normal:void 0,tangent:i.tangent?i.tangent.clone():n&&n.tangent?n.tangent.clone():void 0})}),e.sectionPrecisePosCmd.setObjectToTreat(t)}else e.sectionPrecisePosCmd=void 0;e._bProfiling&&window.console&&window.console.profile&&window.console.profile("Section");var i=u.getContextViewer({viewer:e.getFrameWindow().getViewer()}),r=u.getReviewContext({viewer:e.getFrameWindow().getViewer()});r?r.getTransientReviewBag().removeDMUObjects("DMUSection"):a.createReviewContext({context:i}),l._sendUsageProbe("command","Section")},endExecute:function(){},_performCallback:function(){var t,o=this._arguments[0].ID;(l.isEnvActivated("psection",!0)||"3dPlayPro"===o)&&(t=c.getCSO());var a=n.computeBoundingBox(this._viewer,t);if(void 0!==a){var d=u.getReviewContext({viewer:this.getFrameWindow().getViewer()}),h=d.getCurrentSessionMarkup();if((!h||h&&!h.getActiveFlag()||h&&h.getActiveFlag()&&!h.isVisible()||h&&h.getActiveFlag()&&h.isVisible()&&h.isReadOnly()||h&&h.getActiveFlag()&&h.isVisible()&&!h.isReadOnly()&&!h.getCurrentSlide())&&(h=d.getTransientReviewBag()),h){this._section=new s(this._viewer,h,o,this._sectionCommandMode,this.sectionEditCmd,this._context,this.sectionPrecisePosCmd),this.sectionPrecisePosCmd&&this.sectionPrecisePosCmd.setSectionObject(this._section);var m=!1;m="ProgressiveVisuLoading"!==this._sectionCommandMode&&"3dPlay"!==o&&"true"===localStorage.getItem("DMUComputeSectionContour"),this._section.setAttribute("bSectionCurvesVisible",m),t&&t.length>0&&this._section.setObjects(t,!0);var S=[];(S=h.getCurrentSlide?S.concat(h.getCurrentSlide().getDMUObjects("DMUSection")):h.getDMUObjects("DMUSection")).length>6&&this.sendNotify("info",v.sectionCutLimitation);var g=Math.max(a.max.x-a.min.x,a.max.y-a.min.y,a.max.z-a.min.z),p=i.computeSectionPlaneReferencial(this._viewer,a),D=g,_=g;!function(){if(!l.isEnvActivated("oldSectionPlaneDim",!0)){var e=r.computePlaneDim(a,p,!0);e&&(e.fPlaneSizeV&&e.fPlaneSizeU&&(_=e.fPlaneSizeV,D=e.fPlaneSizeU),e.plane&&(p=e.plane))}}(),this._section.setAttributes([{name:"sID",value:h.computeNewID()},{name:"sUuid",value:e.getUUID()},{name:"sName",value:h.computeNewName({object:this._section,prefix:v.sectionPrefix})},{name:"mPlaneReferential",value:p},{name:"fXDirSize",value:D},{name:"fYDirSize",value:_},{name:"sDisplayPlaneMode",value:"Plane"},{name:"sDisplayContourMode",value:"Contour"},{name:"sSectionRender",value:"CutOneSide"},{name:"sPartialClippingMode",value:!1},{name:"sUpdateAndFreezeMode",value:"Update"},{name:"fXDirGridStep",value:D/20},{name:"fYDirGridStep",value:_/20},{name:"sPlaneBoxMode",value:"NormalMode"},{name:"fSliceOffset",value:0},{name:"fOpacity",value:.2}]),this.sectionPrecisePosCmd&&this._section.setSectionCurveUpdateStatus(!1),h.addDMUObject?h.addDMUObject(this._section):h.getCurrentSlide().addDMUObject(this._section),this._section.fireEvent("onDMUObjectInitialized",{dmuObject:this._section}),this.addInCSO(this._section)}}}})}),define("DS/DMUSection/DMUSectionSecondaryViewerlImpl",["UWA/Class","DS/DMUSection/DMUSectionSecondaryViewer"],function(e,t){"use strict";return e.extend({init:function(e){var i=null;this.isBuilt=function(){return null!==i},this.build=function(){return i||(i=new t(e)),i},this.isShow=function(){return!!i&&i.isShow()},this.show=function(){i&&i.show()},this.noShow=function(){i&&i.noShow()},this.render=function(){i&&i.render()},this.clear=function(){i&&(i.clear(),i=null)},this.getViewer=function(){if(i)return i.getViewer()}}})}),define("DS/DMUSection/DMUSectionContextCmd",["DS/ApplicationFrame/Command","DS/Selection/CSOManager","DS/DMUBaseExperience/DMUContextManager","DS/DMUSection/DMUSectionSecondaryViewerlImpl"],function(e,t,i,n){"use strict";return e.extend({init:function(e){var t=e||{};t.mode="DMUSectionDeleteSectionHdr"!==t.ID?"shared":"exclusive",this._parent(t)},beginExecute:function(){var e,o=t.get();if(1===o.length){var r=i.getReviewContext({viewer:this.getFrameWindow().getViewer()});if(r){var a=r.getDMUObjectFromPathElement(o[0].pathElement);if(a&&"DMUSection"===a.getType()){switch(this._id){case"DMUSectionCutHdr":a.sectionCut(!0);break;case"DMUSectionNoCutHdr":a.sectionCut(!1);break;case"DMUSectionGridHdr":a.sectionGrid();break;case"DMUSectionFlipHdr":a.sectionFlip();break;case"DMUSectionNormalToXHdr":a.sectionToX();break;case"DMUSectionNormalToYHdr":a.sectionToY();break;case"DMUSectionNormalToZHdr":a.sectionToZ();break;case"DMUSectionMoveHdr":a.sectionViewpoint();break;case"DMUSectionSecondaryViewerHdr":(e=a)._iViewerSecondaryWindow?e._iViewerSecondaryWindow.isBuilt()?e._iViewerSecondaryWindow.isShow()?e._iViewerSecondaryWindow.noShow():(e._iViewerSecondaryWindow.show(),e.computeCurves()):e._iViewerSecondaryWindow.build():(e._iViewerSecondaryWindow=new n(e),e._iViewerSecondaryWindow&&e._iViewerSecondaryWindow.build());break;case"DMUSectionDeleteSectionHdr":a.getParent().removeDMUObjects?a.getParent().removeDMUObjects([a]):a.getParent().getCurrentSlide().removeDMUObject(a)}"DMUSectionMoveHdr"!==this._id&&r.getCurrentSessionMarkup()&&r.getCurrentSessionMarkup().isVisible()&&r.getCurrentSessionMarkup().getCurrentSlide()&&r.getCurrentSessionMarkup().getCurrentSlide().fireEvent("onSlidePreviewRefreshRequired",{dmuObject:r.getCurrentSessionMarkup().getCurrentSlide()})}}}}})});