define("DS/W3DSpaceApp/Views/cleanCollaborativeSpace",["DS/UIKIT/Input/Select","DS/UIKIT/Alert","DS/W3DContentApp/Views/SuperModal","DS/W3DContentApp/Utils/Alert","DS/W3DContentApp/Utils/RequestHelper","i18n!DS/W3DSpaceApp/assets/nls/W3DSpaceApp","css!DS/UIKIT/UIKIT.css","css!DS/W3DSpaceApp/W3DSpaceApp.css"],function(e,t,n,i,o,r){"use strict";return function(a,s){var c,l,p=0,u=0;c=s&&s.report?s.report.length:0;var d,m,f,h=s&&s.results?s.results:[],g=[],b=[];(h.filter(function(e){return"businessobject"!==e.basetype||"PLMPosSettingRef"!==e.type}).forEach(function(e){var t;e.actiontype&&"automove"===e.actiontype?(p++,t={objectID:e.ObjectID,targetowner:e.target.owner,targetcs:e.target.cs,targetorg:e.target.org},g.push(t)):e.actiontype&&"manualmove"===e.actiontype&&(u++,t={objectID:e.ObjectID,targetowner:e.attributes.owner,targetorg:e.attributes.organization},b.push(t))}),c||p||u)?(d={title:a.get("title"),nbReports:c,nbAutoMove:p,nbManualMove:u,spaces:[]},u>0?(m="{0}/resources/enocsmrest/collabspaces".format(a._auth.platform.url3DSpace),f={embed:"contexts",sort:"atitle",fields:"title,contexts"},new Promise(function(e,t){var n=["VPLMProjectLeader","VPLMCreator"];o.performRequestWithOptions(m,{type:"json",data:f,onComplete:function(t){var i=t.filter(function(e){if(e.name!==a.id){var t=e.contexts;return t.filter(function(e){return Boolean(n.includes(e.role))}).length>0}return!1}).map(function(e){var t={value:e.name,label:e.title,context:e.contexts[0].name};return t});e(i)},onFailure:function(e){t(e)}})})).then(function(e){d.spaces=e,v(d)},function(){v(d)}):v(d)):i.add({message:r.replace(r.reportCheckNoReport,{name:a.get("title")}),className:"error"});function v(o){var s,c,p,u=r.replace(r.deleteElem,{name:o.title}),d="";d+="<ul>",o.nbReports&&(c=r.replace(r.reportCheckError,{nbelem:o.nbReports}),d=d.concat("<li>").concat(c).concat("</li>")),o.nbAutoMove&&(c=r.replace(r.reportCheckAutoMove,{nbelem:o.nbAutoMove}),d=d.concat("<li>").concat(c).concat("</li>")),o.nbManualMove&&(c=r.replace(r.reportCheckManualMove,{nbelem:o.nbManualMove}),d=d.concat("<li>").concat(c).concat("</li>"),p=new e({className:"cleanSelect",placeholder:o.spaces.length?r.selectCS:r.reportCheckNoCS,disabled:Boolean(!o.spaces.length),events:{onChange:function(e){s=e.target.value}}}),s=o.spaces.length?o.spaces[0].value:void 0,o.spaces.forEach(function(e,t){var n={};n.value=e.value,n.label=e.label,n.selected=0===t,p.add(n)}));var m=document.createElement("div");m.classList.add("cleanHeader"),m.innerHTML=r.reportCheckHeader,d+="</ul><br>";var f=document.createElement("div");f.innerHTML=d,f.classList.add("cleanActions");var h=[m,f];p&&h.push(p);var v={title:u,body:h,buttons:[{value:r.move,disabled:!o.nbAutoMove&&!o.nbManualMove||o.nbManualMove&&!s,active:!0,action:function(e){if(!b.length||s){b.length&&b.forEach(function(e){e.targetcs=s});var n={data:[{content:g.concat(b)}]},c={};c.body=n,a.cleanContent(c).then(function(e){if(e&&e.report&&e.report.length){var t,n=[];e.report.forEach(function(e){e.error&&!n.includes(e.error)&&n.push(e.error)}),n.forEach(function(e){t=t?t+" | "+e:e}),i.add({message:r.replace(r.reportCleanPartial,{name:o.name,message:t}),className:"error"})}else i.add({message:r.replace(r.reportCleanSuccess,{name:o.name}),className:"success"})},function(e){i.add({message:r.replace(r.reportCleanError,{name:o.name}),className:"error"})}),e.hide()}else!function(e){l||(l=new t({visible:!0,autoHide:!0,hideDelay:3e3,className:"w3ddrive alert"}).inject(document.body.querySelector(".cleanSelect"))),l.add({message:e.message,className:e.className||"success"})}({message:r.selectCS,className:"warning"})}},{value:r.cancel,action:function(e){e.hide()}}]};n.dialog(v)}}}),define("DS/W3DSpaceApp/Views/advancedView",["DS/i3DXPnOMultiOrg/OrgOperatorController","DS/W3DSpaceComponents/Views/shareCollaborativeSpace","DS/W3DContentApp/BusEvent","UWA/Core","DS/UIKIT/Tooltip","DS/W3DDrive/widget","DS/W3DContentApp/Utils/Metrics","i18n!DS/W3DSpaceApp/assets/nls/W3DSpaceApp"],function(e,t,n,i,o,r,a,s){"use strict";return{createMultiOrgButton:function(e){var t=i.createElement("span",{class:"fonticon fonticon-user-cog fonticon-clickable",events:{click:function(){c(e),a.trackAction({eventAction:"advancedView",model:e})}}});return new o({target:t,body:s.advanced,position:"top"}),t},multiOrgClick:c};function c(i){var o=document.createElement("div");o.classList.add("multiOrg"),o.classList.add("multiOrg--visible"),r.body.appendChild(o),window.selectedInode=i,window.orgOperatorController=new e({container:o,tenantId:i._auth.platformId,currentUser:i.drive.get("user").id,collabSpace:i.id,collabSpaceTitle:i.get("title"),securityContext:function(e){var t,n,i=e.get("contexts");if(i.length>1){for(t=0;t<i.length&&"VPLMProjectAdministrator"!==(n=i[t]).role&&"3DSRestrictedOwner"!==n.role;t++);return encodeURIComponent(n.name)}return encodeURIComponent(i[0].name)}(i),owner:l(i).isOwner,ownerRestricted:l(i).isOwnerRestricted,mainOwner:i.get("owners").login,roles:i.drive.get("availableRoles"),onAddUsers:function(){(function(e){t(e),a.trackAction({eventAction:"addMemberAdvanced",model:e})}).call(this,selectedInode)},onCloseView:function(){document.querySelector(".multiOrg").destroy(),n.dispatchEvent("inodeDetailAccessesView:onAccesses",selectedInode),r.removeEvents({onLoad:orgOperatorController.load.bind(orgOperatorController),onRefresh:orgOperatorController.refresh.bind(orgOperatorController),onDestroy:orgOperatorController.destroy.bind(orgOperatorController)}),orgOperatorController.destroy(),orgOperatorController=null}}),i.listenTo(orgOperatorController,"onRemoveUser",function(e){var t=this.permissions,n=t.findWhere({physicalid:e});n&&t.remove(n)}),r.addEvents({onLoad:orgOperatorController.load.bind(orgOperatorController),onRefresh:orgOperatorController.refresh.bind(orgOperatorController),onDestroy:orgOperatorController.destroy.bind(orgOperatorController)})}function l(e){for(var t,n,i,o=e.get("contexts"),r=0;r<o.length;r++){if("VPLMProjectAdministrator"===(t=o[r]).ocdx){n=!0;break}if("3DSRestrictedOwner"===t.ocdx){i=!0;break}n=!1,i=!1}return{isOwner:n,isOwnerRestricted:i}}}),define("DS/W3DSpaceApp/Actions/editCS",["DS/W3DContentApp/Utils/formFactory","DS/W3DContentApp/Views/SuperModal","DS/W3DContentApp/BusEvent","DS/W3DContentApp/Utils/drivesInputs","DS/W3DContentApp/Actions/Utils/actionsUtils","i18n!DS/W3DSpaceApp/assets/nls/W3DSpaceApp"],function(e,t,n,i,o,r){"use strict";return function(a,s){var c,l,p,u,d,m,f,h,g,b,v=i(a),S=v.maxchars,D=v.maxcharsDesc,y=[],C=a.drive.get("actions").filter(function(e){return"add.collabspaces.visibility"===e}),A=[{value:"PRIVATE",label:r.isPrivate+" - "+r.privateDetail,selected:a.get("visibility").value.toUpperCase()==="Private".toUpperCase(),disabled:"STANDARD"===a.get("family").name.toUpperCase()},{value:"PROTECTED",label:r.isProtected+" - "+r.protectedDetail,selected:a.get("visibility").value.toUpperCase()==="Protected".toUpperCase(),disabled:"STANDARD"===a.get("family").name.toUpperCase()},{value:"PUBLIC",label:r.isPublic+" - "+r.publicDetail,selected:a.get("visibility").value.toUpperCase()==="Public".toUpperCase()}];if(h=r.editCollabSpace,l=e.createTextInput(Object.assign({pattern:v.forbiddenChars.regex,required:!0,placeholder:r.CSName,title:v.forbiddenChars.text,value:a.get("title")},S)),f=e.createTextError(v.forbiddenChars.text),b=e.createTextError(r.warningDescription),p=e.createTextInput(Object.assign({name:"description",placeholder:r.description,value:a.get("description"),autofocus:!1},D)),u=e.createSelectInput(Object.assign({required:!0,message:r.choosePrivacy,options:A,value:a.get("visibility").value},S)),a.get("actions")){var w=a.get("actions");a.get("actions").indexOf("edit.title")>a.get("actions").indexOf("edit.owner")&&(w=a.get("actions").reverse());for(var W=0;W<w.length;W++)"edit.title"===w[W]&&y.push(e.createTextLabel(r.title),l,f),"edit.description"===w[W]&&y.push(e.createTextLabel(r.description),p,b),C.length>0&&"edit.visibility"===w[W]&&y.push(e.createTextLabel(r.visibility),u)}function T(){var e;document.createEvent?(e=document.createEvent("Event")).initEvent("submit",!0,!0):e=new Event("submit"),c.dispatchEvent(e)}function x(e){"Enter"===e.key&&0===document.getElementsByClassName("form__message-error form__message-error--active").length&&(e.preventDefault(),T())}(c=e.createForm(y,{className:"form_form-create"})).addEventListener("submit",function(e){e.preventDefault();var i,d=(l.value||"").trim(),m=p.value||"",f=u.getValue()[0];if(d){i={title:d,description:m,visibility:f};var h=function(e,t,n){var i=["PRIVATE","PROTECTED","PUBLIC"],o=i.findIndex(t=>t===e.toUpperCase()),a=i.findIndex(e=>e===t.toUpperCase()),s=null;a>o?(s=r.replace(r.visibilityIncreaseConfirmMessage1,{name:n}),s+="<br><br><b>",s+=r.visibilityIncreaseConfirmMessage2+"</b>"):a<o&&(s=r.replace(r.visibilityReduceConfirmMessage1,{name:n}),s+="<br><br><b>",s+=r.visibilityReduceConfirmMessage2+"</b>");return s}(a.get("visibility").value,f,a.get("title"));if(h){var g=r.replace(r.visibilityConfirmTitle),b=r.get("Edit");o.showGenericConfirmationModal(g,h,b,function(){n.dispatchEvent("inodeActions:onEditCS",[a,s,i])})}else n.dispatchEvent("inodeActions:onEditCS",[a,s,i]),c.parentNode.removeChild(c),c=null,t.modals.current.hide()}}),m={chars:v.forbiddenChars.text,maxLengthText:S?S.maxLengthText:void 0},g={chars:D?D.maxLength:void 0,maxLengthText:r.warningDescription},l.addEventListener("keyup",function(){e.onCheckInput(S.maxLength,l,f,m,".js-validation-button")}),p.addEventListener("keyup",function(){e.onCheckInput(D.maxLength,p,b,g,".js-validation-button")}),l.addEventListener("keydown",x),p.addEventListener("keydown",x),d={title:h,body:c,buttons:[{className:"primary js-validation-button",value:r.get("Edit"),action:function(){T()}},{value:r.cancel,action:function(){c.parentNode.removeChild(c),c=null,t.modals.current.hide()}}]},t.dialog(d),l.focus()}}),define("DS/W3DSpaceApp/Views/inodePropertiesView3DSpaceContainer",["UWA/Drivers/Alone","UWA/Core","UWA/Class/View","DS/W3DContentApp/Views/InodeDetailView/inodePropertiesView","DS/EditPropWidget/EditPropWidget","DS/EditPropWidget/constants/EditPropConstants","DS/EditPropWidget/models/EditPropModel","DS/UIKIT/Scroller","i18n!DS/W3DSpaceApp/assets/nls/W3DSpaceApp"],function(e,t,n,i,o,r,a,s,c){"use strict";return function(e){if(!e||!e.model)throw new Error("Missing input");var l,p,u,d,m=e.model,f=new n,h=f.destroy,g=f.render;return m.isContainer()?(m.isCollabSpace()?e.listProperties=[{key:"name",attribute:"name",nls:c.name,type:"string"},{key:"type",attribute:"mimeType",nls:c.type,type:"string",value:function(e){return e.isCollabSpace()?c.collaborativeSpace:""}},{key:"owner",attribute:"owners",nls:c.owner,type:"string",value:function(e){return e.getOwnerNames()}},{key:"createdDate",attribute:"createdDate",nls:c.dateCreated,type:"date"},{key:"modifiedDate",attribute:"modifiedDate",nls:c.dateModified,type:"date"},{key:"description",attribute:"description",nls:c.description,type:"string"},{key:"visibility",attribute:"visibility",nls:c.visibility,type:"string",value:function(e){return e.get("visibility")?e.get("visibility").name:""}},{key:"family",attribute:"family",nls:c.family,type:"string",value:function(e){return e.get("family")?e.get("family").name:""}}]:e.listProperties=[],l=i(e),f.elements.propertiesView=l,f.container.appendChild(l.container),l.container.classList.add("inode-detail__body")):(u=t.createElement("div",{className:"inode-edit-properties inode-detail__body"}),f.container.appendChild(u),p={"onChange:title":function(){d.onRefresh()},"onChange:description":function(){d.onRefresh()}}),new s({element:f.container}),Object.assign(f,{render:function(){if(l)l.render();else{f.stopListening(),f.listenTo(m,p);var e=u,t=[],n=new a({metatype:"businessobject",tenant:m.drive.id,objectId:m.get("id")});if(d)d.onRefresh(),t.push(n),d.initDatas(t);else{d=new o({typeOfDisplay:r.ONLY_EDIT_PROPERTIES,selectionType:r.NO_SELECTION,extraNotif:!0,editMode:!1}),t.push(n),d.initDatas(t);var i=d.elements.container.elements.container.getElementsByClassName("EP_ContainerProperties")[0],s=d.elements.container.elements.container.getElementsByClassName("formSections")[0],c=d.elements.container.elements.container.getElementsByClassName("EP_ScrollerProperties")[0],h=d.elements.container.elements.container.getElementsByClassName("IDCardInnerBottomArea")[0];h?(i.appendChild(s),c.remove(),h.appendChild(i),h.inject(e)):e.appendChild(i)}}return g(),f},destroy:function(){f.stopListening(),h.apply(f,arguments),f.container=null,f.stopListening(),f.model=null}})}}),define("DS/W3DSpaceApp/Utils/W3DSpacePreferencesUpgrade",[],function(){"use strict";return function(e){var t=e.getValue("collab-storage");return t&&(e.setValue("saved-fragment","drives/"+t+"/mimetype/text%2Fdirectory/inode/myCollabSpaces/content"),e.setValue("firstlyLoading","false"),e.setValue("collab-storage",null),e.setValue("main-view",null),e.setValue("id-card-view",null)),e}}),define("DS/W3DSpaceApp/Actions/accessActions",["i18n!DS/W3DSpaceApp/assets/nls/W3DSpaceApp"],function(e){"use strict";return function(t){function n(e){t.dispatchAccessActions("onChangeCollabSpaceMemberRole",[t.model,e])}return t.actions=t.actions.concat([{id:"removePermission",text:e.remove,icon:"fonticon fonticon-user-delete",handler:function(){var n,i=t.model;return n=i.isGroup()?document.createTextNode(e.removeAccessGroupDescription):document.createTextNode(e.removeAccessUserDescription),t.openDialog({title:e.replace(e.get("removeAccessTo"),{name:i.get("title")}),body:[n],confirmAction:{title:e.remove,handler:function(){t.dispatchAccessActions("onRemoveCollabSpaceMember",[i])}}})}},{id:"makePublicReader",text:e.publicReader,icon:"fonticon fonticon-eye",handler:function(){n({value:"PublicReader",admin:!1})}},{id:"makeReader",text:e.reader,icon:"fonticon fonticon-eye",handler:function(){n({value:"Reader",admin:!1})}},{id:"makeContributor",text:e.contributor,icon:"fonticon fonticon-eye",handler:function(){n({value:"Contributor",admin:!1})}},{id:"makeAuthor",text:e.author,icon:"fonticon fonticon-feather",handler:function(){n({value:"Author",admin:!1})}},{id:"makeLeader",text:e.leader,icon:"fonticon fonticon-star",handler:function(){n({value:"Leader",admin:!1})}},{id:"makeLeaderOwner",text:e.leaderOwner,icon:"fonticon fonticon-star",handler:function(){n({value:"Leader",admin:!0})}},{id:"makeOwner",text:e.owner,icon:"fonticon fonticon-key",handler:function(){n({value:"Owner",admin:!0})}},{id:"makeMainOwner",text:e.mainOwner,icon:"fonticon fonticon-user-key",handler:function(){t.dispatchAccessActions("onChangeMainOwnerCS",[t.model])}}]),t}}),define("DS/W3DSpaceApp/Views/PublishContent",["UWA/Class/View","DS/W3DContentApp/Views/SuperModal","DS/W3DContentApp/Views/PublishTo3DSwymService","i18n!DS/W3DSpaceApp/assets/nls/W3DSpaceApp"],function(e,t,n,i){"use strict";return e.extend({setup:function(e){if(!e)throw new Error("Missing input");this.inode=e,this._launch()},_launch:function(){t.dialog({title:i.replace(i.get("publishTo3DSwymTitle"),{name:this.inode.get("title")}),body:[new n(this.inode).render()]}),t.modals.current.getBody().className="shareview"}})}),define("DS/W3DSpaceApp/Actions/editContent",["DS/W3DContentApp/Utils/formFactory","DS/W3DContentApp/Views/SuperModal","DS/W3DContentApp/BusEvent","DS/W3DContentApp/Utils/drivesInputs","i18n!DS/W3DSpaceApp/assets/nls/W3DSpaceApp"],function(e,t,n,i,o){"use strict";return function(r){var a,s,c,l,p,u,d,m=i(r),f=m.maxchars,h=m.maxcharsDesc,g=[];d=o.get("EditProperties"),s=e.createTextInput(Object.assign({required:!0,placeholder:o.title,value:r.get("title")},f)),u=e.createTextError(o.warningEditTitle),c=e.createTextInput(Object.assign({name:"description",placeholder:o.description,value:r.get("description"),autofocus:!1},h)),g.push(e.createTextLabel(o.title),s,u),g.push(e.createTextLabel(o.description),c),(a=e.createForm(g,{className:"form_form-create"})).addEventListener("submit",function(e){var i;e.preventDefault(),i={title:(s.value||"").trim(),description:c.value||""},n.dispatchEvent("inodeActions:onEditContent",[r,i]),a.parentNode.removeChild(a),a=null,t.modals.current.hide()}),p={chars:m.forbiddenChars.notEmpty,maxLengthText:f?f.maxLengthText:void 0},s.addEventListener("keyup",function(){e.onCheckInput(f.maxLength,s,u,p,".js-validation-button")}),l={title:d,body:a,buttons:[{className:"primary js-validation-button",value:o.get("Edit"),action:function(){var e;document.createEvent?(e=document.createEvent("Event")).initEvent("submit",!0,!0):e=new Event("submit"),a.dispatchEvent(e)}},{value:o.cancel,action:function(){a.parentNode.removeChild(a),a=null,t.modals.current.hide()}}]},t.dialog(l),s.focus()}}),define("DS/W3DSpaceApp/Metas/inode",["DS/W3DContentApp/Metas/inode","DS/WebappsUtils/WebappsUtils"],function(e,t){"use strict";return function(){var n=e();return Object.assign(n.ids,{files:"files",trueRoot:"trueRootId",collaborativeSpaces:"CollaborativeSpaces",myCollabSpaces:"myCollabSpaces"}),Object.assign(n.icons,{}),Object.assign(n.thumbnails,{collabSpace:t.getWebappsAssetUrl("W3DDrive","Collab_Space_Thumbnail.png"),defaultPeople:t.getWebappsAssetUrl("W3DContentApp","thumbnails/default-people.png")}),n.boType={collabSpace:"collaborative Space",team:"Team",leader:"Leader",leaderOwner:"Leader & Owner",folder:"Workspace Vault",document:"Document"},n}}),define("DS/W3DSpaceApp/Views/inodeDetailAnalyticsView",["UWA/Core","UWA/Class/View","DS/W3DXComponents/Views/GraphView","DS/UIKIT/Scroller","DS/W3DContentApp/Utils/Metrics","i18n!DS/W3DSpaceApp/assets/nls/W3DSpaceApp","css!DS/W3DSpaceApp/W3DSpaceApp.css","css!DS/UIKIT/UIKIT.css"],function(e,t,n,i,o,r){"use strict";var a;function s(t){var i,o,s,c;i={title:r.mpr,unit:r.unitMembers,labelFormat:"",graphName:"Members"},o=t,s=new n({title:i.title,type:n.TYPE_PIE,unit:i.unit,plotOptions:{pie:{allowPointSelect:!0,cursor:"pointer",dataLabels:{enabled:!0,format:"<b>{point.name}</b>: {point.y:} "+i.labelFormat}}},series:[]}),c=e.createElement("div",{class:"analytics"}),s.inject(c),c.inject(o),s.reflow(),a=s}return function(n){var c=n.model,l=new t(n),p=l.destroy,u=e.createElement("div",{class:"inode-analytics_container"});return u.render=function(){},u.container=u,o.trackAction({model:c,eventAction:"analyticsTab"}),l.container.classList.add("inode-detail-analytics"),Object.assign(l,{render:function(){var e,t,n=l.container;return 0===n.getChildren().length&&((t=document.createElement("div")).classList.add("inode-detail-analytics__to-scroll"),e=t,s(u),function(e,t){var n={onComplete:function(t){var n,i,o=JSON.parse(t),a=o.mpr,s=o.nbmembers;n=e,i={data:a,subtitle:r.members,nbr:s},n.setOptions({subtitle:i.nbr+" "+i.subtitle,series:[{data:i.data}]}),n.render(),n._highcharts.container.childNodes[0].childNodes[6].style.visibility="hidden"}};t.getAnalyticsMembers(n)}(a,c),e.appendChild(u),n.appendChild(e),new i({element:e})),l},destroy:function(){l.stopListening(),p.apply(l,arguments)}})}}),define("DS/W3DSpaceApp/Actions/createCS",["DS/W3DContentApp/Utils/formFactory","DS/W3DContentApp/Views/SuperModal","DS/W3DContentApp/BusEvent","DS/W3DContentApp/Utils/drivesInputs","i18n!DS/W3DSpaceApp/assets/nls/W3DSpaceApp"],function(e,t,n,i,o){"use strict";return function(r,a){var s,c,l,p,u,d,m,f,h,g,b,v=i(r),S=v.maxchars,D=v.maxcharsDesc,y=[],C=r.drive.get("actions").filter(function(e){return"add.collabspaces.visibility"===e});function A(){var e;document.createEvent?(e=document.createEvent("Event")).initEvent("submit",!0,!0):e=new Event("submit"),s.dispatchEvent(e)}function w(e){"Enter"===e.key&&0===document.getElementsByClassName("form__message-error form__message-error--active").length&&(e.preventDefault(),A())}b=o.createCollabSpace,c=e.createTextInput(Object.assign({pattern:v.forbiddenChars.regex,required:!0,placeholder:o.CSName,title:v.forbiddenChars.text},S)),f=e.createTextError(v.forbiddenChars.text),g=e.createTextError(o.warningDescription),l=e.createTextInput(Object.assign({placeholder:o.description,required:!1,name:"description",autofocus:!1},D)),p=e.createSelectInput(Object.assign({required:!0,message:o.chooseFamily,name:"family",id:"family",options:[{value:"DESIGNTEAM",id:"DESIGNTEAM",label:o.design+" - "+o.designDetail,selected:!0,disabled:!1},{value:"STANDARDTEAM",id:"STANDARDTEAM",label:o.standard+" - "+o.standardDetail,disabled:!1}]},S)),(u=e.createSelectInput(Object.assign({required:!0,message:o.choosePrivacy,name:"visibility",id:"visibility",options:[{value:"PRIVATE",label:o.isPrivate+" - "+o.privateDetail,id:"private",selected:!0,disabled:!1},{value:"PROTECTED",label:o.isProtected+" - "+o.protectedDetail,id:"protected",disabled:!1},{value:"PUBLIC",label:o.isPublic+" - "+o.publicDetail,id:"public",disabled:!1}]},S))).elements.choices.classList.add("visibility"),u.elements.dropdown.classList.add("visibility"),0===C.length?(p.disable(1),u.enable(0),u.disable(1),u.disable(2),u.setValue(0)):C.length>0&&r.drive.get("isInnovation")&&p.addEvent("onChange",function(){"DESIGNTEAM"===this.getValue()[0]?(u.enable(0),u.enable(1),u.enable(2),u.setValue(0)):(u.enable(2),u.disable(1),u.disable(0),u.setValue(2))}),y=[e.createTextLabel(o.title),c,f,e.createTextLabel(o.description),l,g],r.drive.get("isInnovation")&&(y.push(e.createTextLabel(o.family),p),C.length>0&&y.push(e.createTextLabel(o.visibility),u)),(s=e.createForm(y,{className:"form_form-create"})).addEventListener("submit",function(e){e.preventDefault();var i,o=(c.value||"").trim(),d=l.value||"",m=u.getValue()[0],f=r.drive.get("isInnovation")?p.getValue()[0]:"DESIGNTEAM";o&&(i={title:o,description:d,visibility:m,family:f},n.dispatchEvent("inodeActions:onCreateCS",[r,a,i]),s.parentNode.removeChild(s),s=null,t.modals.current.hide())}),m={chars:v.forbiddenChars.text,maxLengthText:S?S.maxLengthText:void 0},h={chars:D?D.maxLength:void 0,maxLengthText:o.warningDescription},c.addEventListener("keyup",function(){e.onCheckInput(S.maxLength,c,f,m,".js-validation-button")}),l.addEventListener("keyup",function(){e.onCheckInput(D.maxLength,l,g,h,".js-validation-button")}),c.addEventListener("keydown",w),l.addEventListener("keydown",w),d={title:b,body:s,buttons:[{className:"primary js-validation-button",value:o.create,action:function(){A()}},{value:o.cancel,action:function(){s.parentNode.removeChild(s),s=null,t.modals.current.hide()}}]},t.dialog(d),c.focus(),e.disableValidationButton(".js-validation-button")}}),define("DS/W3DSpaceApp/Actions/contentIterationActions",["DS/W3DContentApp/Metas/inode","DS/W3DContentApp/Utils/Actions/Iterations/Base","DS/W3DDrive/Actions/downloadAction","DS/W3DContentApp/Utils/contextHelpers","i18n!DS/W3DSpaceApp/assets/nls/W3DSpaceApp"],function(e,t,n,i,o){"use strict";return function(r){var a=new t({model:r}),s=e();return a.actions=a.actions.concat([{id:s.actionPubIds.downloadVersion,text:o.download,icon:"download",fonticon:"download",handler:function(){n({model:r,context:"version"})}}]),a.actions=i.actionsFilters.applyCurrentContexts(a.actions),a}}),define("DS/W3DSpaceApp/Models/CSMember",["DS/W3DContentApp/Models/AuthModel","UWA/String"],function(e,t){"use strict";return e.extend({idAttribute:"physicalid",defaults:{type:"",id:"",role:{}},parse:function(e){return"Person"===e.type?{type:e.type,id:e.id,physicalid:e.physicalid,title:e.title,picture:n(this,e),email:e.email,role:i(e.role),accessright:i(e.role).value,isownercs:e.isownercs,actions:o(e.actions),collabspace:e.collabspace}:{type:e.type,id:e.id,physicalid:e.physicalid,title:e.title,picture:n(this,e),members:e.members,role:i(e.role),accessright:i(e.role).value,isownercs:e.isownercs,actions:o(e.actions),collabspace:e.collabspace}},getActionIds:function(){return this.get("actions")||[]},isUser:function(){return"Person"===this.get("type")},isGroup:function(){return"Group"===this.get("type")},isPending:function(){return this.get("id")===this.get("email")},isActionAllowed:function(e){return-1!==this.getActionIds().indexOf(e)}});function n(e,n){return"Person"===n.type?t.format("{0}/api/user/getpicture/login/{1}/format/normal",e._auth.getSwymService(),n.id):n.picture}function i(e){var t;if(e)return e&&e.value&&"owner"!==(t=e.value.toLowerCase())&&e.admin&&(t+="Owner"),{value:t,admin:e.admin,restricted:e.restricted}}function o(e){if(e){var t={delete:"removePermission","edit.role.publicreader":"makePublicReader","edit.role.reader":"makeReader","edit.role.contributor":"makeContributor","edit.role.author":"makeAuthor","edit.role.leader":"makeLeader","edit.role.leaderowner":"makeLeaderOwner","edit.role.owner":"makeOwner","edit.owner":"makeMainOwner"};return e.map(function(e){return t[e]})}}}),define("DS/W3DSpaceApp/Models/ContentVersion",["UWA/Class/Promise","UWA/Class/Model","DS/W3DContentApp/Utils/RequestHelper"],function(e,t,n){"use strict";return t.extend({idAttribute:"physicalid",parentId:"",drive:"",parse:function(e){var t,n={};for(t in n={physicalid:e.physicalid,file:e.file,masterid:e.masterid,title:e.title,modified:this.convertDateToMs(e.modified),actions:e.actions,fileExtension:e.title.split(".")[1]})n.hasOwnProperty(t)&&void 0===n[t]&&delete n[t];return n},getDownloadUrl:function(){var t=this,i="{0}/resources/enocsmrest/collabspaces/{1}/contents/{2}/versions/{3}/download".format(this.collection._auth.platform.url3DSpace,this.collection._parentInode.id,this.get("masterid"),this.id);return new e(function(e,o){n.performRequestWithOptions(i,{type:"json",onComplete:function(n){var i=n?n.url:null;t.set("downloadUrl",i),e({url:i,method:"POST"})},onFailure:o})})},isActionIdoK:function(){return"download"},isActionAllowed:function(e){return!0===this.get("actions").reduce(function(e,t){return e[t]=!0,e},{})[e.replace("Version","")]},isContainer:function(){return!1},convertDateToMs:function(e){if(e)return 1e3*parseInt(e,10)}})}),define("DS/W3DSpaceApp/Views/dndCoachmark",["DS/W3DXComponents/Views/EmptyView","i18n!DS/W3DSpaceApp/assets/nls/W3DSpaceApp","css!DS/W3DContentApp/W3DContentApp.css"],function(e,t){"use strict";const n="start-view--medium",i="start-view--small",o="no-content-view",r="dnd-view";let a,s=!0,c=0;const l=Object.freeze({normal:980,small:660});function p(e,t){return e&&t in e?e[t].join?e[t].join(" "):e[t]:""}function u(e="div",t={}){const n=t.id,i=p(t,"classes");return"<"+e+(n?' id="'+n+'"':"")+(i?' class="'+i+'"':"")+">"+p(t,"content")+"</"+e+">"}function d(e){return!(!e||!e.dataTransfer)&&Array.prototype.some.call(e.dataTransfer.types,function(e){return"Files"===e})}function m(e){e.container.removeEvents(),e.container.addEvents({dragenter:function(t){d(t)&&(c++,e.container.classList.toggle("drag-over",!0))},dragleave:function(t){c--,d(t)&&0===c&&e.container.classList.toggle("drag-over",!1)},drop:function(){c=0,e.container.classList.toggle("drag-over",!1)}})}function f(e){e&&m(this);const t=this.container.querySelector("#"+o),n=this.container.querySelector("#"+r);t&&t.classList.toggle("hidden",e),n&&n.classList.toggle("hidden",!e)}return function(p={}){let d=new e({id:"start_view_0",template:function(){return u("div",{id:o,classes:"empty-view-infos"+(p.isDnD?" hidden":""),content:[u("span",{classes:"empty-view-icon center-block fonticon fonticon-5x fonticon-picture"}),u("span",{classes:"empty-view-title center-block",content:t.get("noContent")})]})+u("div",{id:r,classes:"start-view__drop-zone"+(p.isDnD?"":" hidden"),content:[u("div",{classes:"start-view__drop-zone-content",content:[u("span",{classes:"start-view__drop-zone-icon fonticon fonticon-5x fonticon-picture"}),u("span",{classes:"start-view__drop-zone-title",content:t.get("dropFiles")})]})]})}});var h;d.container.classList.add("start-view"),h=d,s=!0,a=window.requestAnimationFrame(function e(){if(s&&(setTimeout(function(){s&&(a=requestAnimationFrame(e))},500),h&&h.container)){const e=h.container.classList,t=parseInt(getComputedStyle(h.container).getPropertyValue("width").replace("px",""),10);if(t<l.small){if(e.contains(i))return;return e.remove(n),void e.add(i)}if(t<l.normal){if(e.contains(n))return;return e.remove(i),void e.add(n)}e.remove(n),e.remove(i)}}),p.isDnD&&m(d),d.toggleDnDView=f;const g=d.destroy;return d.destroy=function(){d&&(d.container.removeEvents(),window.cancelAnimationFrame(a),a=null,s=!1,d.template=null,g.apply(d,arguments),d.stopListening(),d.container=null,d.model=null,d=null,c=0)},d}}),define("DS/W3DSpaceApp/Utils/actionsFiltering",[],function(){"use strict";var e={getCollabSpaceActions:function(e){var t=[];"trueRootId"!==e.get("parentId")&&(t=["viewAccesses","viewAnalytics"]);var n=e.get("actions");if(n)for(var i=0;i<n.length;i++)"edit.title"===n[i]&&t.push("editCS"),"add.contents"===n[i]&&t.push("addContent"),"add.members"===n[i]&&t.push("PublicReader","Reader","Contributor","Author","Leader","Readerrestricted","Contributorrestricted","Authorrestricted","Leaderrestricted"),"add.members.restricted"===n[i]&&t.push("Readerrestricted","Contributorrestricted","Authorrestricted","Leaderrestricted"),"delete"===n[i]&&t.push("delete"),"edit.thumbnail"===n[i]&&t.push("changeThumbnail"),"add.collabspaces"===n[i]&&t.push("createCollabSpace");return t},getContentActions:function(e){var t=["comment","preview","openWith","viewHistory"],n=e.get("actions");if(n)for(var i=0;i<n.length;i++)"download"===n[i]&&(t.push("download"),"Document"===e.get("type").value&&t.push("shareContent")),"move"===n[i]&&t.push("moveToCS"),"update"===n[i]&&t.push("update"),"delete"===n[i]&&t.push("delete"),"edit"===n[i]&&t.push("editContent");return t}};return e}),define("DS/W3DSpaceApp/Views/inodeAllAccessesContainer",["UWA/Class/View","DS/UIKIT/Iconbar","DS/W3DDrive/InodeActions","DS/W3DSpaceApp/Views/advancedView","DS/W3DContentApp/Views/InodeDetailView/inodeAllAccessesView","DS/W3DContentApp/Components/SearchFilterAccesses","DS/W3DSpaceApp/Actions/accessActions","i18n!DS/W3DSpaceApp/assets/nls/W3DSpaceApp"],function(e,t,n,i,o,r,a,s){"use strict";return function(c){if(!c||!c.model)throw new Error("**************** Missing input! ****************");var l=c.model,p=new e,u=p.destroy,d=i.createMultiOrgButton(l),m=new n({model:l,context:"access"}).toJSON(),f=l.drive.get("availableRoles")||[],h=new t({className:"inode-access__topbar",items:m.filter(function(e){return"addMember"===e.id||"addMemberRestricted"===e.id})});c.shareAccessActions=a,c.emptyView={title:s.noMemberRetreived,icon:"search"};var g=o(c);function b(e){const t={};let n,i,o;return Object.entries(e).forEach(function(e){"title"===e[0]&&(o=e[1]),"type"===e[0]&&(n=e[1]),"role"===e[0]&&(i=e[1].toString())}),n&&(t.type=n),i&&(t.role=i),o&&(t.title=o),t}g.render();var v=[{category:"role",name:"contributor",fonticon:"eye",text:s.get("contributor"),selectable:!0},{category:"role",name:"author",fonticon:"pencil",text:s.get("author"),selectable:!0},{category:"role",name:"leaderOwner",fonticon:"star",text:s.get("leaderOwner"),selectable:!0}];return f.includes("Reader")&&v.push({category:"role",name:"reader",fonticon:"eye",text:s.get("reader"),selectable:!0}),f.includes("PublicReader")&&v.push({category:"role",name:"publicReader",fonticon:"eye",text:s.get("publicReader"),selectable:!0}),f.includes("Leader")&&v.push({category:"role",name:"leader",fonticon:"star",text:s.get("leader"),selectable:!0}),f.includes("Owner")&&v.push({category:"role",name:"owner",fonticon:"key",text:s.get("owner"),selectable:!0}),c={is3DSpace:!0,collection:l.permissions,searchConfig:{handler:function(){this.collection.fetch({reset:!0,data:b(this.filters)})}},filterConfig:{multiSelect:!0,items:[{className:"header",text:s.get("responsibilities")},v,{className:"divider"},{className:"header",text:s.get("Types")},{category:"type",name:"Person",fonticon:"user",text:s.get("person"),selectable:!0},{category:"type",name:"Group",fonticon:"users-group",text:s.get("group"),selectable:!0}],handler:function(){const e=this.elements.filterMenu.getSelectedItems(),t=e.filter(e=>"role"===e.category).map(e=>e.name);this.filters.role=t;const n=e.filter(e=>"type"===e.category).map(e=>e.name);this.filters.type=n.join(),this.collection.fetch({reset:!0,data:b(this.filters)})}}},d.inject(h.getContent().querySelector(".iconbar-items-wrap"),"top"),new r(c).render().container.inject(h.getContent().querySelector(".iconbar-items-wrap"),"top"),p.container.setContent([h,g.elements.spinner,g.elements.scrollView]),p.container.classList.add("inode-access"),Object.assign(p,{destroy:function(){u.apply(p,arguments),p.container=null,p.stopListening(),p.model=null}})}}),define("DS/W3DSpaceApp/Models/MyCollabSpace",["UWA/Core","UWA/Class/Promise","UWA/Class/Model","DS/W3DSpaceApp/Metas/inode","DS/W3DContentApp/Models/Inode","DS/W3DSpaceApp/Utils/actionsFiltering","DS/W3DContentApp/Utils/Helpers","DS/W3DContentApp/Utils/RequestHelper","DS/W3DSpaceComponents/Utils/SecurityContext","DS/W3DDrive/widget","i18n!DS/W3DSpaceApp/assets/nls/W3DSpaceApp"],function(e,t,n,i,o,r,a,s,c,l,p){"use strict";var u=i();function d(t,n){var i;return t&&(i=t[n],e.is(i,"function")&&(i=i.call(t))),i}return o.extend({idAttribute:"name",versions:[],extensionsAllowed:[".3dxml",".step",".stp",".stpz",".ifc",".ifczip",".smg",".rvt",".rfa",".stl",".jpg",".jpeg",".png",".gif",".tif",".tiff",".bmp",".svg",".flv",".avi",".mov",".wmv",".mpg",".mpeg",".mp4",".m4v",".rm",".webm",".mkv",".mp3",".wav",".aac",".m4a",".wma",".ra",".ogg",".doc",".docx",".ppt",".pptx",".pps",".ppsx",".xls",".xlsx",".xlsm",".pdf",".zip",".txt",".csv",".json",".xml",".xd",".geojson",".mdb",".gml",".kml",".sdm",".omf",".str",".mineschedanimation"],extensionsAllowedThumbnail:[".jpg",".jpeg",".png",".gif",".tif",".tiff",".bmp",".svg"],setup:function(){return this._parent(arguments)},url:function(){var e="";if(this.isNew())return e;if(!this._auth)return e;var t=this._auth.platform;return t?e="{0}/resources/enocsmrest/collabspaces/{1}?embed=contexts&sort=amodified".format(t.url3DSpace,this.id):e},parse:function(e){var t,n;function i(e){if(e)return 1e3*parseInt(e,10)}for(t in e.id=e.name,n={name:e.name,id:e.id,parentId:u.ids.myCollabSpaces,mimeType:u.mimeType.collabSpace,title:e.title,contexts:e.contexts,thumbnailLink:function(e){var t,n;return t={},n=e.thumbnail?e.thumbnail:u.thumbnails.collabSpace,t.medium=n,t.small=n,t.large=n,t}(e),iconLink:"logo-3dspace",description:e.description,createdDate:i(e.created),modifiedDate:e.modified?i(e.modified):i(e.created),family:e.family,visibility:e.visibility,solution:e.solution,owner:"",contents:"",members:"",actions:e.actions,owners:e.owner?e.owner:void 0})n.hasOwnProperty(t)&&void 0===n[t]&&delete n[t];return n},save:function(t,i,o){var r;if(o=Object.assign({},o,{}),e.is(t)&&"object"!==e.typeOf(t)?(r={})[t]=i:(r=t,o=i),!r)return this._parent(t,o);if("changeThumbnail"===t.action){var a=this.extensionsAllowedThumbnail,s=t.file.name.substring(t.file.name.lastIndexOf("."),t.file.name.length),c=RegExp(s,"i"),l=o.onFailure,p=a.some(function(e){return c.test(e)});if(0===s.length||!1===p)return l(new Error("Extension not supported, please try with an image"));(o=e.clone(o||{},!1)).file=t.file,o.type="json",this.set("thumbnailLink",{});var u=this,m=t.file.name,f=o.onComplete;return o.onComplete=function(t,i,o){e.extend(o,i),o.onComplete=function(e,t,i){i.onComplete=function(e,t,n){if(f)return f(e,t,n)};var o={actions:u.get("actions"),contents:u.get("contents"),contexts:u.get("contexts"),created:u.get("created"),description:u.get("description")?u.get("description"):"",family:u.get("family"),members:u.get("members"),name:u.get("name"),owner:u.get("owners"),solution:u.get("solution"),thumbnail:m,title:u.get("title"),visibility:u.get("visibility")};i.method="PUT",i.url=d(e,"url").split("?")[0]+"?receipt="+encodeURIComponent(t.receipt),i.data=JSON.stringify(o),i.headers={Accept:"application/json","Content-Type":"application/json;charset=utf-8"},n.prototype.save.call(u,o,i)},t.checkInThumbnailFile(o)},this.getTicket(e.extend({model:this},o))}return r={actions:this.get("actions"),contents:this.get("contents"),contexts:[],created:this.get("createdDate"),description:t.csAtrributes?t.csAtrributes.description:this.get("description"),family:t.csAtrributes?t.csAtrributes.family:this.get("family"),members:null,name:this.get("name"),owner:t.owner||this.get("owners"),solution:this.get("solution"),thumbnail:this.get("thumbnailLink").medium,title:t.csAtrributes?t.csAtrributes.title:this.get("title"),visibility:t.csAtrributes&&t.csAtrributes.hasOwnProperty("visibility")?{value:t.csAtrributes.visibility}:this.get("visibility")},o.method="PUT",o.url=this._auth.platform.url3DSpace+"/resources/enocsmrest/collabspaces/"+this.get("id"),o.data=JSON.stringify(r),o.headers={Accept:"application/json","Content-Type":"application/json;charset=utf-8"},this._parent(this,o)},destroy:function(t){t=e.clone(t||{},!1);var n=this._auth.platform.url3DSpace+"/resources/enocsmrest/collabspaces/"+this.get("id");return t=Object.assign({headers:{"Content-Type":"application/json"},url:n,timeout:8e4,method:"DELETE"},t),this._parent(t)},isCollabSpace:function(){return this.get("mimeType")===u.mimeType.collabSpace},enableDrop:function(){return!1},getDetailsUndeletedCS:function(e){var n="{0}/resources/enocsmrest/collabspaces/{1}/typesleft".format(e._auth.platform.url3DSpace,e.get("id"));return new t(function(e,t){s.performRequestWithOptions(n,{type:"json",onComplete:function(t){e(t.types)},onFailure:t})})},checkContent:function(){var e,n=this,i=encodeURIComponent(n.get("contexts")[0].name),o="{0}/resources/v1/application/CSRF".format(n._auth.platform.url3DSpace);return new t(function(t,n){s.performRequestWithOptions(o,{type:"json",onComplete:function(n){e=n.csrf.value,t(e)},onFailure:function(e){n(e)}})}).then(function(e){var o="{0}/resources/lifecycle/clean/cleananalyze".format(n._auth.platform.url3DSpace),r=JSON.stringify({data:[{csname:n.get("id")}]});return new t(function(t,n){s.performRequestWithOptions(o,{type:"json",method:"POST",headers:{ENO_CSRF_TOKEN:e,SecurityContext:"ctx::"+i,"Content-Type":"application/json"},timeout:5e4,data:r,onComplete:function(e){t(e)},onFailure:n,onTimeout:function(){var e=new Error("timeout");e.errorMessage=": Timeout",n(e)}})})})},cleanContent:function(e){var n,i=this,o=encodeURIComponent(i.get("contexts")[0].name),r="{0}/resources/v1/application/CSRF".format(i._auth.platform.url3DSpace);return new t(function(e,t){s.performRequestWithOptions(r,{type:"json",onComplete:function(t){n=t.csrf.value,e(n)},onFailure:t})}).then(function(n){var r="{0}/resources/lifecycle/clean/cleanmove".format(i._auth.platform.url3DSpace),a=JSON.stringify(e.body);return new t(function(e,t){s.performRequestWithOptions(r,{type:"json",method:"POST",headers:{ENO_CSRF_TOKEN:n,SecurityContext:"ctx::"+o,"Content-Type":"application/json"},data:a,timeout:5e4,onComplete:function(t){e(t)},onFailure:function(e){t(e)},onTimeout:function(){var e=new Error("timeout");e.errorMessage=": Timeout",t(e)}})})})},doesItHaveContent:function(){var e="{0}/resources/enocsmrest/collabspaces/{1}/contents".format(this._auth.platform.url3DSpace,this.get("id"));return new t(function(t,n){s.performRequestWithOptions(e,{onComplete:function(e){t(e)},onFailure:n})})},getTicket:function(t){var n,i=this,o=d(this,"url").split("?")[0]+"/ticket?id="+Date.now();return t=t?e.clone(t,!1):{},n=t.onComplete,t.onComplete=function(e){if(n)return n(i,i.parseTicket(e),t)},s.performRequestWithOptions(o,e.extend(e.extend({type:"json"}),t,!0))},parseTicket:function(e){return{urlFCS:e.actionurl,ticket:{name:e.jobticket,value:e.ticket}}},checkInThumbnailFile:function(t){if(!(t=t?e.clone(t,!1):{}).urlFCS)throw new Error('A "url" must be specified');var n,i,o,r=this,a=t.urlFCS,s=t.onComplete;for(var c in t.onComplete=function(e){if(s)return s(r,r.parseThumbnailFileReceipt(e),t)},n=new FormData,i=this.getThumbnailFileForm(t))n.append(c,i[c]);return(o=new XMLHttpRequest).open("POST",a),o.onreadystatechange=function(){4===o.readyState&&(200===o.status?t.onComplete(o.responseText):t.onFailure&&t.onFailure(o.responseText))},o.send(n),o},parseThumbnailFileReceipt:function(t){return{receipt:e.createElement("div").setHTML(t).getElement('[name="__fcs__jobReceipt"]').value}},getThumbnailFileForm:function(t){var n={};return(t=t?e.clone(t,!1):{}).ticket&&t.ticket.name&&(n[t.ticket.name]=t.ticket.value),e.extend(n,{__fcs__jobTicket:t.ticket.value,"file-name":t&&t.file.name,file_0:t&&t.file,"file-title":t&&t.file.name,"file-description":t&&t.file.name}),n},getAnalyticsLastModified:function(e){e||(e={});var t=this._auth.platform.url3DSpace+"/resources/enocsmrest/collabspaces/"+this.id+"/analytics",n=e.modified;n&&(n="&modified="+n);var i=t+"?fields=lmpt,lastmodified,nbmodified"+n;return s.performRequestWithOptions(i,{type:"JSON",headers:{"Accept-Language":l.lang},onComplete:e.onComplete})},getAnalyticsContents:function(e){e||(e={});var t=this._auth.platform.url3DSpace+"/resources/enocsmrest/collabspaces/"+this.id+"/analytics"+"?fields=cpt,cpm,nbcontents";return s.performRequestWithOptions(t,{type:"JSON",headers:{"Accept-Language":l.lang},onComplete:e.onComplete})},getAnalyticsMembers:function(e){e||(e={});var t=this._auth.platform.url3DSpace+"/resources/enocsmrest/collabspaces/"+this.id+"/analytics"+"?fields=mpr,nbmembers";return s.performRequestWithOptions(t,{type:"JSON",headers:{"Accept-Language":l.lang},onComplete:e.onComplete})},securityContext:function(e){var t="{0}/resources/pno/person/setsecuritycontext".format(this._auth.platform.url3DSpace);s.performRequestWithOptions(t,{method:"POST",data:{SecurityContext:c.getPreferred(e)}})},getOwnerNames:function(){return this.get("owners")?this.get("owners").name:""},getActionIds:function(){return r.getCollabSpaceActions(this)},getPreview:function(t){t||(t={});var n=this,i=d(this,"url").split("?")[0]+"/preview",o=t.onComplete;t.onComplete=function(e){if(n.set("thumbnail",e.thumbnail),o)return o(n,e,t)},s.performRequestWithOptions(i,e.extend({type:"json"},e.extend(t,!0)))},isActionIdoK:function(e){return e===u.actionPubIds.share?this._parent("giveEditAccess")||this._parent("giveReadAccess"):e===u.actionPubIds.addMember?this._parent("Contributor")||this._parent("Author")||this._parent("Leader")||this._parent("Reader")||this._parent("PublicReader"):e===u.actionPubIds.addMemberRestricted?!this._parent("Contributor")&&(this._parent("Contributorrestricted")||this._parent("Authorrestricted")||this._parent("Leaderrestricted")||this._parent("Readerrestricted")):this._parent(e)},"onChange:id":function(e,n,i){var o,r,c=this;i.add||this.get("parentId")&&(r=this,new t(function(e,t){var n;try{"/"!==(n=a.result(r,"url"))[n.length-1]&&(n+="/"),n+="preview",s.performRequestWithOptions(n,{type:"json",onComplete:e,onFailure:t})}catch(e){t(e)}})).then(function(e){o=function(e){var t={};return t.medium=e,t.small=e,t.large=e,t}(e.thumbnail),c.set("thumbnailLink",o)})},getNLSType:function(){return p.collaborativeSpace}})}),define("DS/W3DSpaceApp/Models/MyCollabSpacesRoot",["DS/W3DSpaceApp/Metas/inode","DS/W3DContentApp/Models/Inode","DS/W3DContentApp/Models/Stub","DS/W3DSpaceApp/Utils/actionsFiltering","DS/W3DContentApp/BusEvent","i18n!DS/W3DSpaceApp/assets/nls/W3DSpaceApp"],function(e,t,n,i,o,r){"use strict";var a=e();return t.extend(n,{defaults:{parentId:a.ids.trueRoot,title:r.myCollabSpaces,mimeType:a.mimeType.folder,iconLink:"logo-3dspace",thumbnailLink:{small:a.thumbnails.collabSpace,medium:a.thumbnails.collabSpace,large:a.thumbnails.collabSpace}},setup:function(){const e=this;this.listenTo(o,{setSessionAvailable:function(t){e.set({isInnovation:t.isInnovation,isAdmin:t.isAdmin,actions:t.actions})}})},getActionIds:function(){var e=this.isFolder();return i[e?"getCollabSpaceActions":"getContentActions"](this)},getNLSType:function(){return""},doesExistInBackend:function(){return new Promise(function(e){e(!0)})},isFolder:function(){return!0}})}),define("DS/W3DSpaceApp/Views/versionItemView3DSpace",["DS/W3DContentApp/Views/itemView","DS/W3DSpaceApp/Actions/contentIterationActions","DS/W3DContentApp/Utils/Helpers"],function(e,t,n){"use strict";return function(i){if(!i||!i.model)throw new Error("Missing input");var o,r,a,s=i.model,c={model:s};return a={id:"physicalid",title:"title"},Object.keys(a).map(function(e){c[e]=s.get(a[e])}),c.metas=n.getDateStr(s.get("modified")),c.actions=t(s).toJSON(),r=e(c),o=r.destroy,r.container.addClassName("permission-item"),Object.assign(r,{destroy:function(){return s=null,c.actions&&(c.actions.model=null),c=null,o.apply(r,arguments)}})}}),define("DS/W3DSpaceApp/Views/inodeHistoryContainer",["DS/W3DContentApp/Views/InodeDetailView/inodeFileHistoryView","DS/W3DSpaceApp/Views/versionItemView3DSpace"],function(e,t){"use strict";return function(n){if(!n||!n.model)throw new Error("Missing input");return e({model:n.model,itemView:t})}}),define("DS/W3DSpaceApp/Views/inodeVersionsView3DSpace",["UWA/Class/View","DS/W3DSpaceApp/Views/versionItemView3DSpace","DS/W3DContentApp/Views/InodeDetailView/versionsView","i18n!DS/W3DSpaceApp/assets/nls/W3DSpaceApp"],function(e,t,n,i){"use strict";return function(o){var r=o.model.contentVersions,a=new e(o),s=a.destroy,c=n({collection:r,itemView:t});return a.container.classList.add("inode-version"),Object.assign(a,{render:function(){var e=a.container;r.fetch();var t=document.createElement("div");return t.classList.add("headerVersion"),t.textContent=i.iterations,e.setContent([t,c]),c.render(),a},destroy:function(){s.apply(a,arguments),r=null,c.destroy(),a.model=null,a.container=null,a.stopListening()}})}}),define("DS/W3DSpaceApp/Collections/MyCollabSpaces",["UWA/Core","DS/W3DContentApp/Collections/Inodes","DS/W3DContentApp/Utils/scheduleTasksToGlobalSession","DS/W3DSpaceApp/Models/MyCollabSpace","DS/W3DDrive/widget","DS/W3DContentApp/Utils/RequestHelper"],function(e,t,n,i,o,r){"use strict";return t.extend({model:i,thumbnailsRetrieved:!1,state:{firstPage:0,currentPage:0,pageSize:20,lastPage:0},queryFilter:null,queryReset:!1,resetState:function(){this.state={firstPage:0,currentPage:0,pageSize:20,lastPage:0}},updateState:function(e){this.state=Object.assign({},this.state,e)},queryParams:{currentPage:"page",pageSize:"limit",totalRecords:"csTotal"},url:function(){var e=this._auth.platform.url3DSpace;return"{0}/resources/enocsmrest/collabspaces".format(e)},parseResponseForStateUpdate:function(e){return{totalRecords:e.csTotal,lastPage:e.nbPages>0?e.nbPages-1:0}},parseRecords:function(e){return e.items},parse:function(e,t){this.thumbnailsRetrieved=!1;var n=this.parseResponseForStateUpdate(e,Object.assign({},this.queryParams),Object.assign({},this.state),t);return n&&this.updateState(n),this.parseRecords(e,t)},setup:function(e,t){t&&(this._auth=t.auth),o&&this.listenTo(o,{onSearch:this.onSearchFilter,onResetSearch:this.onResetSearchFilter})},sort:function(e){if((e=e||{}).sorting&&e.sorting.id!==this._sorting.id)return this._sorting=e.sorting,this.getFirstPage({reset:!0})},onSearch:function(e){this.queryFilter=e||null;var t,n={reset:!0,type:"json",evnt:"OnSearch",setState:{firstPage:0,currentPage:0,pageSize:20,lastPage:0}};t=n.onComplete,n.onComplete=function(){t&&t(arguments)},this.fetch(n)},onResetSearchFilter:function(){this.queryFilter=null,this.queryReset=!0},onSearchFilter:function(e){this.queryFilter=e,this.queryReset=!0},create:function(t,n){var i;return n=e.clone(n||{},!1),t.csAtrributes.title&&(i={actions:[],contents:null,contexts:[],description:t.csAtrributes.description,family:{value:t.csAtrributes.family},members:null,owner:{},solution:"",thumbnail:"",title:t.csAtrributes.title,visibility:{value:t.csAtrributes.visibility}},n.method="POST",n.url=this._auth.platform.url3DSpace+"/resources/enocsmrest/collabspaces"),n.data=JSON.stringify(i),n.headers={Accept:"application/json","Content-Type":"application/json;charset=utf-8"},this._parent(t,n)},fetch:function(t){!0!==t.queryReset&&!0!==this.queryReset||(t.reset=!0,this.resetState(),this.queryReset=!1);var n=Object.assign({},this.state),i=this,r=Object.keys(this.queryParams).reduce(function(e,t){var o=i.queryParams[t],r=n[t];return o="function"==typeof o?o.call(i):o,r="function"==typeof r?r.call(i):r,null!==o&&null!==r&&(e[o]=r),e},{});t.data=Object.assign({},t.data,r),e.extend(t,!0),t.data||(t.data={}),this.queryFilter&&(t.data.filter=this.queryFilter),t.data.embed="contexts",t.data.sort=this.getCurrentSorting(),t.headers={"Accept-Language":o.lang},t.data.fields||(t.data.fields="actions,contexts,created,description,family,owner,solution,visibility,title,modified"),this._parent.apply(this,arguments)},getPreviews:function(t){if(!this.isEmpty()){t||(t={});var n=this,i=this._auth.platform.url3DSpace+"/resources/enocsmrest/collabspaces/previews",o=t.onComplete;t.onComplete=function(e){var i,r,a;if(e.forEach(function(e){(i=n.get(e.id))&&(r=null===e.thumbnail?i.get("thumbnailLink").small:e.thumbnail,a=function(e){var t={};return t.medium=e,t.small=e,t.large=e,t}(r),i.set("thumbnailLink",a))}),o)return o(n,e,t)},r.performRequestWithOptions(i,e.extend(t,{type:"json",data:{ids:this.pluck(this.model.prototype.idAttribute).reduce(function(e,t){return e+","+t})}}))}},shareChildren:function(e,t){var i=this,o=e.reduce(function(e,n){if(!i.contains(n))return e;var o=n.permissions;return t.map(function(e){var t=o.findWhere({emailAddress:e.emailAddress});return t?function(){return new Promise(function(i,o){t.save({role:e.role},{patch:!1,onComplete:function(e){i({inode:n,permission:e})},onFailure:function(e){o({inode:n,permission:e})}})})}:function(){return new Promise(function(t,i){o.create(e,{wait:!0,onComplete:function(e){t({inode:n,permission:e})},onFailure:function(e){o.remove(e),i({inode:n,permission:e})}})})}}).concat(e)},[]);return n(o)},getCurrentSorting:function(){var e,t=o.getValue("inodesSorting")?o.getValue("inodesSorting"):{id:"modifiedDate-a"};return"title-a"===t.id?e="atitle":"title-d"===t.id?e="dtitle":"modifiedDate-a"===t.id?e="amodified":"modifiedDate-d"===t.id?e="dmodified":"createdDate-a"===t.id?e="acreated":"createdDate-d"===t.id&&(e="dcreated"),e},onReset:function(){this.thumbnailsRetrieved=!0,this.getPreviews()},onChange:function(){this.thumbnailsRetrieved||(this.thumbnailsRetrieved=!0,this.getPreviews())}})}),define("DS/W3DSpaceApp/Models/InodeFactoryCS",["DS/W3DSpaceApp/Metas/inode","DS/W3DSpaceApp/Models/MyCollabSpacesRoot","DS/W3DSpaceApp/Models/MyCollabSpace"],function(e,t,n){"use strict";var i=e(),o={};o[i.ids.myCollabSpaces]=t;var r="id";function a(e,t){e.name||(e.name=e.id);var i=o[e[r]];return i||(i=n),new i(e,t)}return a.prototype.idAttribute=r,a}),define("DS/W3DSpaceApp/Collections/CSMembers",["UWA/String","DS/W3DContentApp/Collections/AuthCollection","DS/W3DSpaceApp/Models/CSMember","DS/W3DContentApp/Collections/Pagination"],function(e,t,n,i){"use strict";var o=t.extend({model:n,state:{firstPage:0,currentPage:0,pageSize:20,lastPage:0,type:"",role:"",title:""},queryParams:{currentPage:"page",pageSize:"limit"},url:function(){return e.format("{0}/resources/enocsmrest/collabspaces/{1}/allmembers",this._auth.getStorage().url3DSpace,this._parentInode.get("id"))},init:function(e,t){var n=(t=t||{}).parentInode;if(!n||!n.id)throw new Error("You must specify a valid parentInode options");return this._parentInode=n,this._parent.apply(this,arguments)},fetch:function(e){(e.firstLoad||e.reset)&&(this.state.currentPage=0,this.state.firstPage=0,this.state.pageSize=20,this.state.lastPage=0,this.state.type="",this.state.role="",this.state.title=""),e.data&&(e.data.type||e.data.role||e.data.title)&&(this.state.type=e.data.type,this.state.role=e.data.role,this.state.title=e.data.title),e.data==={}&&(this.state.type="",this.state.role="",this.state.title="");var t=Object.assign({},this.state),n=this,i=Object.keys(this.queryParams).reduce(function(e,i){var o=n.queryParams[i],r=t[i];return o="function"==typeof o?o.call(n):o,r="function"==typeof r?r.call(n):r,null!=o&&null!=r&&(e[o]=r),e},{});(t.role||t.type||t.title)&&void 0===e.data&&(e.data={}),t.role&&e.data&&void 0===e.data.role&&(e.data=Object.assign(e.data,{role:this.state.role})),t.type&&e.data&&void 0===e.data.type&&(e.data=Object.assign(e.data,{type:this.state.type})),t.title&&e.data&&void 0===e.data.title&&(e.data=Object.assign(e.data,{title:this.state.title})),e.data=Object.assign({withactions:!0,sort:"atitle"},e.data,i),"refresh"!==e.from&&"myCollabSpaces"!==e.inode&&this._parent.apply(this,arguments)},parse:function(e){return this.updateState({totalRecords:e.total,lastPage:e.nbPages>0?e.nbPages-1:0}),e.items},updateState:function(e){this.state=Object.assign({},this.state,e)}});return o=i(o)}),define("DS/W3DSpaceApp/Collections/ContentVersions",["UWA/Core","DS/W3DContentApp/Collections/AuthCollection","DS/W3DSpaceApp/Models/ContentVersion"],function(e,t,n){"use strict";return t.extend({model:n,id:"",parentId:"",parentCS:"",init:function(e,t){var n=(t=t||{}).parentInode;if(!n)throw new Error("You must specify a valid parentInode options");return this._parentInode=n,this._inode=t.inode,this._parent.apply(this,arguments)},url:function(){return!this._auth&&this._parentInode._auth&&(this._auth=this._parentInode._auth),this._auth.platform.url3DSpace+"/resources/enocsmrest/collabspaces/"+this._inode.get("parentId")+"/contents/"+this._inode.get("id")+"/versions"},fetch:function(e){return e=e||{},this._parent(e)},sync:function(e,t,n){return this._parent(e,t,n)},parse:function(e){return this.dispatchEvent("onUpdate"),e.reverse()}})}),define("DS/W3DSpaceApp/Models/MyCollabSpaceContent",["UWA/Core","UWA/String","UWA/Class/Promise","DS/W3DContentApp/Models/Inode","DS/W3DSpaceApp/Utils/actionsFiltering","DS/W3DSpaceApp/Collections/ContentVersions","DS/W3DContentApp/Utils/RequestHelper","DS/W3DSpaceComponents/Utils/SecurityContext"],function(e,t,n,i,o,r,a,s){"use strict";function c(e){return new n(function(t,n){var i;try{e.id&&(i=e._auth.platform.url3DSpace+"/resources/enocsmrest/collabspaces/"+e.get("parentId")+"/contents/"+e.id+"/preview",setTimeout(function(){a.performRequestWithOptions(i,{type:"json",onComplete:t,onFailure:n})},7e3))}catch(e){n(e)}})}function l(e){return[function(e){return e.actionurl}(e),function(e){return e.jobticket}(e),function(e){return e.ticket}(e)]}function p(t){return e.createElement("div").setHTML(t).getElement('[name="__fcs__jobReceipt"]').value}function u(e,t,i,o){var r,a=o.substring(o.lastIndexOf("."),o.split("."));return r=Object.assign({actions:[],businessobj:{description:"",file:o,fullnameowner:"",icon:"",maturity:"",modified:"",owner:{},thumbnail:"",title:a,type:{}},collabspace:e.collabspace}),n.cast([r,t,i])}return i.extend({idAttribute:"id",setup:function(){var e=this.collection?this.collection._parentInode:this.get("parentId");return this.inodeVersions=new r([],{parentInode:e,inode:this,auth:this._auth}),this._parent.apply(this,arguments)},parse:function(e){var t,n,i,o,r,a;function s(e){if(e)return 1e3*parseInt(e,10)}function c(e){var t=document.createElement("textarea");return t.innerHTML=e,t.value}for(t in n={id:e.id,parentId:e.collabspace,title:e.businessobj?c(e.businessobj.title):void 0,name:e.businessobj?c(e.businessobj.name):void 0,createdDate:e.businessobj?s(e.businessobj.created):void 0,type:e.businessobj?e.businessobj.type:void 0,modifiedDate:e.businessobj?s(e.businessobj.modified):void 0,thumbnailLink:e.businessobj?(r=e.businessobj.thumbnail,a={},a.medium=r,a.small=r,a.large=r,a):void 0,iconLink:e.businessobj?e.businessobj.icon:void 0,description:e.businessobj?e.businessobj.description.replace(/&amp;/g,"&"):void 0,family:{},owners:e.businessobj?function(e){var t;return e&&(t=e.fullnameowner),t?[{displayName:t}]:void 0}(e.businessobj):void 0,downloadUrl:"",fullnameowner:e.businessobj?e.businessobj.fullnameowner:void 0,maturity:e.businessobj?e.businessobj.maturity:void 0,version:e.businessobj?e.businessobj.version:void 0,actions:e.actions,taxonomies:e.businessobj?(i=e.businessobj.taxonomies,o=[],i&&i.map(function(e){"types"===e.split("/")[0].toLowerCase()?o.push(e.split("/")[1]):o.push(e)}),o):void 0,icon:e.businessobj?e.businessobj.icon:void 0})n.hasOwnProperty(t)&&void 0===n[t]&&delete n[t];return n},getDownloadUrl:function(){var e=this,t="{0}/resources/enocsmrest/collabspaces/{1}/contents/{2}/download".format(this._auth.platform.url3DSpace,this.get("parentId"),this.get("id"));return new n(function(n,i){a.performRequestWithOptions(t,{type:"json",onComplete:function(t){var i=t?t.url:null;e.set("downloadUrl",i),n({url:i,method:"POST"})},onFailure:i})})},getOwnerNames:function(){return this.get("owners")[0]?this.get("owners")[0].displayName:""},getFileUrl:function(){var e=this,t="{0}/resources/enocsmrest/collabspaces/{1}/contents/{2}/fileurl".format(this._auth.platform.url3DSpace,this.get("parentId"),this.get("id"));return new n(function(n,i){a.performRequestWithOptions(t,{type:"json",onComplete:function(t){var i=t?t.url:null,o=t?t.extension:null;e.set("fileUrl",i),e.set("fileExtension",o),n(i)},onFailure:i})})},sync:function(e,t,i){if("create"!==e)return this._parent(e,t,i);var o,r,s=this,c=this.collection._auth.getStorage(),d=i.file||{},m=function(e,t,n){var i;return i=Object.assign({data:{},headers:{"Content-Type":"application/json;charset=utf-8"}},t),[{title:e.title,duplicatedfrom:e.duplicatedfrom,collabspace:n.get("parentId")},i]}(function(e,t){var n,i,o,r={};return e&&(e.parentId&&(n=e.parentId),e.description&&(i=e.description),e.title&&(o=e.title),e.parentId&&e.parentId),n&&(r.parents=[{id:n}]),i&&(r.description=i||""),o&&(r.title=o),t&&(r.uploadType="media"),r}(t._attributes||t.toJSON(),t.isNew()),i,t),f=t._parent.bind(t),h=i.onFailure,g=[];this.collection&&this.collection._parentInode&&(g=this.collection._parentInode.extensionsAllowed||[]);var b=d.name.substring(d.name.lastIndexOf("."),d.name.length),v=RegExp(b,"i"),S=g.some(function(e){return v.test(e)});if(0===b.length||!1===S)return h(new Error("Extension not supported"));r="update"===i.action?"{0}/resources/enocsmrest/collabspaces/{1}/contents/{2}/versions".format(t._auth.platform.url3DSpace,t.get("parentId"),t.get("id")):"{0}/resources/enocsmrest/collabspaces/{1}/contents".format(t._auth.platform.url3DSpace,t.get("parentId")),i.headers=i.headers||{},i.headers["Content-Type"]="application/json;charset=UTF-8",o=function(e,t){return new n(function(n,i){var o;o="{0}/resources/enocsmrest/collabspaces/{1}/ticket?id={2}".format(t.url3DSpace,e.get("parentId"),window.Date.now()),a.performRequestWithOptions(o,{method:"GET",type:"json",onComplete:function(e){n(e)},onFailure:i})})}.call(t,t,c).then(l).spread(function(e,t,i){return function(e,t,i,o,r){var a,s,c;return a=new window.FormData,(s={})[t]=i,s["file-name"]=o.name,s.file_0=o,s["file-title"]=o.name,s["file-description"]=o.name,Object.keys(s).map(function(e){a.append(e,s[e])}),(c=new window.XMLHttpRequest).open("POST",e,!0),new n(function(e,t){c.onload=function(){this.status>=200&&this.status<400?e(this.response):t("file upload in FCS failed")},c.onerror=function(){t()},c.upload.onprogress=r.dispatchAsEventListener("onProgress"),c.send(a)})}(e,t,i,d,s)}).then(p),n.all(m.concat(o).concat(d.name)).spread(u).spread(function(n,o,a){return"update"===i.action?i.data={title:n.businessobj.file,file:n.businessobj.file,modified:n.businessobj.modified,filedescription:n.businessobj.description,download:"",preview:"",index:"",physicalid:"",versionnumbers:"",actions:["download"]}:(i.data=o||{},i.data=n),i.type="json",i.data=JSON.stringify(i.data),i.url=r+"?receipt="+encodeURIComponent(a),f(e,t,i)}).catch(function(e){h(e)})},destroy:function(t){return t=e.clone(t||{},!1),this.get("type"),this._parent(t)},save:function(t,n,i){var o,r="";return i=Object.assign({},i),e.is(t)&&"object"!==e.typeOf(t)?(o={})[t]=n:(o=t,i=n),o?(o.parentid&&(r=this._auth.platform.url3DSpace+"/resources/restmove/collabspaces/"+this.get("parentId")+"/moveable/"+this.get("id"),a.performRequestWithOptions(r,{method:"PUT",data:JSON.stringify({collabspace:t.parentid}),headers:{"Content-type":"application/json"},onComplete:i.onComplete,onFailure:i.onFailure})),"editContent"===t.action?(r=this._auth.platform.url3DSpace+"/resources/enocsmrest/collabspaces/"+this.get("parentId")+"/contents/"+this.id,this._parent(this,Object.assign({},i,{url:r,type:"json",method:"PUT",headers:{Accept:"application/json","Content-Type":"application/json;charset=utf-8"},data:JSON.stringify({actions:this.get("actions"),businessobj:{created:this.get("createdDate"),description:t.attributes.description,fullnameowner:this.get("fullnameowner"),icon:this.get("iconLink"),maturity:this.get("maturity"),modified:this.get("modified"),owner:this.owner,physicalid:this.id,thumbnail:this.get("thumbnail"),title:t.attributes.title,type:this.get("type"),version:this.get("version")},collabspace:t.inode.get("parentId"),id:t.inode.id})}))):void 0):this._parent(o,i)},getActionIds:function(){return o.getContentActions(this)},"onChange:id":function(e,t,n){var i=this;n&&void 0===n.from&&c(this).then(function(e){e.thumbnail&&i.set("thumbnailLink",{medium:e.thumbnail})})},"onChange:thumbnail":function(){var e=this;c(this).then(function(t){t.thumbnail&&e.set("thumbnailLink",{medium:t.thumbnail})})},getNLSType:function(){return this.get("type").name},get3DPlayOptions:function(){return{asset:{provider:"EV6",physicalid:this.id,dtype:this.get("type")?this.get("type").value:null,tenant:this._auth.platformId,serverurl:this._auth.platform.url3DSpace,requiredAuth:"passport",contextId:s.getNominalContext(this.collection&&this.collection._parentInode)}}},isPlayable:function(){return!1},enableDrop:function(){return!1},getDragDataType:function(){return null},getDropDataType:function(){return null},doesExistInBackend:function(){var e=this;return new n(function(t){e.sync("GET",e,{onComplete:function(n){n.businessobj&&(n.businessobj.contexts||n.businessobj.maturity)?t(!0):(t(!1),e.destroy({noSync:!0}))},onFailure:function(){t(!1),e.destroy({noSync:!0})}})})},uploadFileToSwym:function(e){var i=t.format("{0}/resources/enocsmrest/publish/swym/createMedia",this._auth.platform.url3DSpace),o=this.get("id"),r=this._auth.platform.url3DSpace;return new n(function(t,n){var s=e.platform_instance,c=e.community_id,l=e.content_type;a.performRequestWithOptions(i,{url:i,auth:r,timeout:3e5,method:"POST",data:JSON.stringify({platformid:s,communityid:c,contenttype:l,isDownloadable:"true",objectid:o}),type:"json",headers:{"Content-type":"application/json; charset=UTF-8",Accept:"application/json; charset=UTF-8"},proxy:"passport",onComplete:function(e){t(e)},onTimeout:function(){var e=new Error("timeout");e.name="timeout",n(e)},onFailure:function(e,t){var i=new Error;i.name="error",i.message=t,n(i)}})})}})}),define("DS/W3DSpaceApp/Models/InodeFactory",["DS/W3DSpaceApp/Metas/inode","DS/W3DSpaceApp/Models/MyCollabSpacesRoot","DS/W3DSpaceApp/Models/MyCollabSpace","DS/W3DSpaceApp/Models/MyCollabSpaceContent"],function(e,t,n,i){"use strict";var o=e(),r={};r[o.ids.myCollabSpaces]=t;var a="id";function s(e,t){e.name||(e.name=e.id);var s=r[e[a]];return e.mimeType===o.boType.collabSpace&&(s=n),e[a]===o.ids.trueRoot&&(s=n),s||(s=i),new s(e,t)}return s.prototype.idAttribute=a,s}),define("DS/W3DSpaceApp/Collections/InodesFactoryCS",["DS/W3DSpaceApp/Metas/inode","DS/W3DSpaceApp/Collections/MyCollabSpaces","DS/W3DSpaceApp/Models/InodeFactoryCS"],function(e,t,n){"use strict";var i=e(),o={};function r(e,n){var r=n.parentInode;if(r){var a=r.id,s=o[a];return r.get("parentId")===i.ids.trueRoot&&(s=t),s||(s=t),new s(e,n)}}return o[i.ids.myCollabSpaces]=t,r.prototype.model=n,r}),define("DS/W3DSpaceApp/Collections/RootInodes",["DS/W3DContentApp/Collections/Inodes","DS/W3DContentApp/Collections/Stub","DS/W3DSpaceApp/Metas/inode","DS/W3DSpaceApp/Models/InodeFactory"],function(e,t,n,i){"use strict";n=n();return e.extend(t,{init:function(e,t){t=t||{};var i=[];i.push(n.ids.myCollabSpaces);var o=this.model.prototype.idAttribute;return this._parent(i.map(function(e){var t={};return t[o]=e,t}).map(function(t){var n,i;for(i=0;!n&&i<e.length;i++)e[i].id===t.id&&(n=e[i]);return n||t}),t)},model:i})}),define("DS/W3DSpaceApp/Collections/MyCollabSpaceContents",["UWA/Core","UWA/String","DS/W3DContentApp/Collections/Inodes","DS/W3DSpaceApp/Models/MyCollabSpaceContent","DS/W3DContentApp/Utils/scheduleTasksToGlobalSession","DS/W3DContentApp/Utils/RequestHelper","DS/W3DDrive/widget","DS/W3DContentApp/Utils/Tagger6WProxy"],function(e,t,n,i,o,r,a,s){"use strict";return n.extend({shouldFetch:!0,model:i,state:{firstPage:0,currentPage:0,pageSize:25,lastPage:0},queryParams:{currentPage:"page",pageSize:"limit",totalRecords:"contentTotal"},filterTagObj:null,isNewFilter:!1,queryFilter:null,resetState:function(){this.state={firstPage:0,currentPage:0,pageSize:25,lastPage:0}},updateState:function(e){this.state=Object.assign({},this.state,e)},url:function(){return t.format("{0}/resources/enocsmrest/collabspaces/{1}/contents",this._auth.platform.url3DSpace,this._parentInode.id)},setup:function(e,t){t&&(this._auth=t.auth),a&&this.listenTo(a,{onSearch:this.onSearchFilter,onResetSearch:this.onResetSearchFilter})},sort:function(e){if((e=e||{}).sorting&&e.sorting.id!==this._sorting.id)return this._sorting=e.sorting,this.getFirstPage({reset:!0})},fetch:function(t){var n,i,o,r,c=this;(t=t||{}).setState&&(this.state=t.setState),t.data||(t.data={}),t.data.fields||(t.data.sort=this.getCurrentSorting()),(n=Object.assign({},t)).headers={"Accept-Language":a.lang},r=Object.assign({},this.state);var l=Object.keys(this.queryParams).reduce(function(e,t){var n=c.queryParams[t],i=r[t];return n="function"==typeof n?n.call(c):n,i="function"==typeof i?i.call(c):i,null!=n&&null!=i&&(e[n]=i),e},{});return n.data=Object.assign({},t.data,l),this.shouldFetch?(!0===this.queryReset&&(n.reset=!0,this.resetState(),this.queryReset=!1),t.queryReset&&(n.remove=!1),(t.evnt||this.filterTagObj)&&((i=this.filterTagObj)&&(o={tags:JSON.stringify(i)},n.data=n.data?e.extend(o,n.data):o),n.onComplete=function(e,n){var i=c.parseTags(n);!0===t.reset?s._currentTagger.setTags(i.subjectsTags,i.tagValues):s._currentTagger.addSubjects(i.subjectsTags),c.isNewFilter=!1}),this.queryFilter&&(n.data.q=this.queryFilter),t.withThumbnails&&(n.onComplete=function(e,n){var i=c.parseTags(n);s._currentTagger.setTags(i.subjectsTags,i.tagValues),c.isNewFilter=!1,"function"==typeof t.onComplete&&t.onComplete(e,n,t)}),this._parent.call(this,n)):("function"==typeof t.onComplete&&t.onComplete(this,this.toJSON(),t),void this.dispatchEvent("onSync",[this,this.toJSON(),t]))},parseTags:function(e){return{tagValues:e.tagValues,subjectsTags:e.subjectsTags}},onSearch:function(e){this.queryFilter=e||null;var t,n={reset:!0,type:"json",evnt:"OnSearch",setState:{firstPage:0,currentPage:0,pageSize:25,lastPage:0}};t=n.onComplete,n.onComplete=function(){t&&t(arguments)},this.fetch(n)},onResetSearchFilter:function(){this.queryFilter=null,this.queryReset=!0},onSearchFilter:function(e){this.queryFilter=e,this.queryReset=!0},parseResponseForStateUpdate:function(e,t,n,i){return{totalRecords:e.contentTotal,lastPage:e.nbPages>0?e.nbPages-1:0}},parseRecords:function(e){return e.items},parse:function(e,t){var n=this.parseResponseForStateUpdate(e,Object.assign({},this.queryParams),Object.assign({},this.state),t);return n&&this.updateState(n),this.parseRecords(e,t)},getCurrentSorting:function(){var e,t=a.getValue("inodesSorting")?a.getValue("inodesSorting"):{id:"modifiedDate-a"};return"title-a"===t.id?e="atitle":"title-d"===t.id?e="dtitle":"modifiedDate-a"===t.id?e="amodified":"modifiedDate-d"===t.id?e="dmodified":"createdDate-a"===t.id?e="acreated":"createdDate-d"===t.id&&(e="dcreated"),e}})}),define("DS/W3DSpaceApp/Collections/InodesFactory",["DS/W3DSpaceApp/Collections/RootInodes","DS/W3DSpaceApp/Metas/inode","DS/W3DSpaceApp/Models/InodeFactory","DS/W3DSpaceApp/Collections/MyCollabSpaces","DS/W3DSpaceApp/Collections/MyCollabSpaceContents"],function(e,t,n,i,o){"use strict";var r=t(),a={};function s(e,t){var n=t.parentInode;if(n){var s=n.id,c=a[s];return n.get("parentId")===r.ids.trueRoot&&(c=i),!n.get("parentId")&&n.isCollabSpace()&&(c=o),c||(c=o),new c(e,t)}}return a[r.ids.trueRoot]=e,s.prototype.model=n,s}),define("DS/W3DSpaceApp/Models/Drive",["DS/W3DContentApp/Models/DriveAbstract","DS/W3DSpaceApp/Collections/InodesFactory","DS/W3DSpaceApp/Collections/InodesFactoryCS","DS/W3DSpaceApp/Collections/CSMembers","DS/W3DContentApp/BusEvent"],function(e,t,n,i,o){"use strict";return e.extend({_Inodes:t,_Contents:n,isDsDrive:!1,isCollabSpace:!0,_Permissions:i,isActionIdoK:function(){return!1},url:function(){var e=this.get("auth").platform.url3DSpace;if(e)return"{0}/resources/enocsmrest/session".format(e);console.log("3DSpace url is not returned! the url can't be defined")},init:function(e){return this._parent(e)},fetch:function(e){return this._parent(e)},parse:function(e){return o.dispatchEvent("setSessionAvailable",{isInnovation:e.isinnovation,isAdmin:e.isadmin,actions:e.actions}),{id:e.id,name:e.id,auth:e.auth,granted:e.granted,authenticated:e.authenticated,actions:e.actions,isAdmin:e.isadmin,isInnovation:e.isinnovation,availableRoles:e.availableRoles}},getMeta:function(){return this.get("auth").platform.displayName}})});