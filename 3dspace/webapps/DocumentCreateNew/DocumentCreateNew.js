define("DS/DocumentCreateNew/Utils/DimensionUtils",["UWA/Class","UWA/Promise","DS/WAFData/WAFData","i18n!DS/DocumentCreateNew/assets/nls/DocumentCreateNew"],function(e,t,n,i){"use strict";return e.singleton({init:function(){},Dimensions:{},getDimensions:function(e){var s=this;return s.Dimensions[e.tenantUrl]?s.Dimensions[e.tenantUrl].ready:(s.Dimensions[e.tenantUrl]={ready:t.deferred()},n.authenticatedRequest(e.tenantUrl+"/resources/dictionary/dimensions",{method:"GET",headers:{Accept:"application/json","content-type":"application/json","Accept-Language":widget.lang?widget.lang:widget.getValue("lang"),SecurityContext:e.securityContext},timeout:6e4,type:"json",onComplete:function(t){try{var n={};t.results.forEach(function(e){e.Units.forEach(function(t){e.MKSUnit==t.Name&&(n[e.Name]=t.NLSName)})}),s.Dimensions[e.tenantUrl]._dimensions=n,s.Dimensions[e.tenantUrl].ready.resolve(s.Dimensions[e.tenantUrl]._dimensions),console.info("Dimensions loaded")}catch(t){console.error("Unexpected error when fetching dimensions"),console.error(t),s.Dimensions[e.tenantUrl].ready.reject({subtitle:i.get("DIMENSIONAL_ATTRIBUTES_ARE_INVALID"),message:i.get("PLEASE_TRY_AGAIN_OR_CONTACT_SYSTEM_ADMINSTRATOR")}),delete s.Dimensions[e.tenantUrl]}},onFailure:function(t){console.error("Unable to get dimensions : "),console.error(t),s.Dimensions[e.tenantUrl].ready.reject({subtitle:i.get("FAILED_TO_FETCH_DIMENSIONAL_ATTRIBUTES"),message:(t.message||t)+" \n"+i.get("PLEASE_TRY_AGAIN_OR_CONTACT_SYSTEM_ADMINSTRATOR"),error:t}),delete s.Dimensions[e.tenantUrl]}}),s.Dimensions[e.tenantUrl].ready)}})}),define("DS/DocumentCreateNew/Utils/Credentials",["UWA/Core","UWA/Promise","DS/WAFData/WAFData","i18n!DS/DocumentCreateNew/assets/nls/DocumentCreateNew"],function(e,t,n,i){"use strict";return e.Class.singleton({init:function(){},credentials:{},getCredentialsList:function(e){var s=this;if(s.credentials[e.tenantUrl+e.tenant])return s.credentials[e.tenantUrl+e.tenant].ready;s.credentials[e.tenantUrl+e.tenant]={ready:t.deferred()};var o=[],a=e.tenantUrl+"/resources/modeler/pno/person?current=true";return a+="&select=preferredcredentials&select=collabspaces",a+="&tenant="+e.tenant,n.authenticatedRequest(a,{method:"GET",type:"json",onComplete:function(t){o=[],[];var n=!1;if(t.collabspaces&&t.collabspaces.length>0)for(var i=void 0,a=0;a<t.collabspaces.length;a++)for(var r=0;r<t.collabspaces[a].couples.length;r++){var l=t.collabspaces[a].couples[r];null==i&&(i=l.organization.name),i!=l.organization.name&&(n=!0);var c=l.role.name+"."+l.organization.name+"."+t.collabspaces[a].name;t.collabspaces[a].title||(t.collabspaces[a].title=t.collabspaces[a].name),l.organization.title||(l.organization.title=l.organization.name),l.role.nls||(l.role.nls=l.role.name);var d=t.collabspaces[a].title+" ● "+l.organization.title+" ● "+l.role.nls,u=t.collabspaces[a].title+" ● "+l.role.nls;o.push({value:c,withorg_nls:d,withoutorg_nls:u,collabspaceTitle:t.collabspaces[a].title})}s.credentials[e.tenantUrl+e.tenant].ready.resolve(o.sort(function(e,t){return n?e.withorg_nls<t.withorg_nls?-1:e.withorg_nls>t.withorg_nls?1:0:e.withoutorg_nls<t.withoutorg_nls?-1:e.withoutorg_nls>t.withoutorg_nls?1:0}).map(function(e){return{label:s.multiOrg?e.withorg_nls:e.withoutorg_nls,value:e.value}})),console.info("Credentials loaded")},onFailure:function(t){console.error("Failed to get credentials:",t),s.credentials[e.tenantUrl+e.tenant].ready.reject({subtitle:i.get("FAILED_TO_FETCH_CREDENTIALS"),message:err.message||err,error:err})}}),s.credentials[e.tenantUrl+e.tenant].ready},addCredentialList:function(e,n){this.credentials[e.tenantUrl+e.tenant]={ready:t.deferred()},this.credentials[e.tenantUrl+e.tenant].ready.resolve(n)}})}),define("DS/DocumentCreateNew/Utils/TypesUtils",["UWA/Class","UWA/Promise","DS/WAFData/WAFData","i18n!DS/DocumentCreateNew/assets/nls/DocumentCreateNew"],function(e,t,n,i){"use strict";return e.singleton({init:function(){},Dictionarys:{},getTypeInfos:function(e){var s=this;return s.Dictionarys[e.tenantUrl]?s.Dictionarys[e.tenantUrl].ready:(s.Dictionarys[e.tenantUrl]={ready:t.deferred()},n.authenticatedRequest(e.tenantUrl+"/resources/dictionary/Dictionary?lang="+widget.lang,{method:"GET",headers:{Accept:"application/json","content-type":"application/json","Accept-Language":widget.lang,SecurityContext:e.securityContext},timeout:6e4,type:"json",onComplete:function(t){try{s.Dictionarys[e.tenantUrl]._typeInfos=s.formatResult(t.Dictionary.Types,t.Dictionary.Interfaces,t.DictionaryNLS),s.Dictionarys[e.tenantUrl].ready.resolve(s.Dictionarys[e.tenantUrl]._typeInfos),console.info("Dictionary loaded")}catch(t){console.error("Unexpected error when fetching types infos"),console.error(t),s.Dictionarys[e.tenantUrl].ready.reject({subtitle:i.get("TYPE_INFORMATION_IS_INVALID"),message:i.get("PLEASE_TRY_AGAIN_OR_CONTACT_SYSTEM_ADMINSTRATOR")}),delete s.Dictionarys[e.tenantUrl]}},onFailure:function(t){console.error("Unable to get types infos : "),console.error(t),s.Dictionarys[e.tenantUrl].ready.reject({subtitle:i.get("FAILED_TO_FETCH_TYPE_INFORMATION"),message:(t.message||t)+" \n"+i.get("PLEASE_TRY_AGAIN_OR_CONTACT_SYSTEM_ADMINSTRATOR"),error:t}),delete s.Dictionarys[e.tenantUrl]}}),s.Dictionarys[e.tenantUrl].ready)},formatResult:function(e,t,n){console.time("formatResult");var i=this,s={},o=[];for(var a in e){var r=e[a];if("Document"==r.FirstOOTB&&"Yes"==r.Specialization){s[a]||(s[a]={nls:n["Type."+a],icon:r.IconName,parent:r.Parent,childs:[],abstract:r.Abstract,attributes:[],interfaces:{}},o.includes(a)||o.push(a));let t=r.Parent;t&&t.trim().length>0&&(s[t]?s[t].childs.push(a):(s[t]={nls:n["Type."+t],icon:e[t].IconName,parent:e[t].Parent,childs:[a],abstract:e[t].Abstract,attributes:[],interfaces:{}},o.includes(t)||o.push(t)));var l=r.Attributes?r.Attributes:{};s[a].attributes=i.extractAttributeDef(l,n,null)}}for(var c in null==s.Document&&(s.Document={nls:n["Type.Document"],icon:e.Document.IconName,parent:e.Document.Parent,childs:[],abstract:e.Document.Abstract,attributes:[],interfaces:{}},o.includes("Document")||o.push("Document")),s.Document.attributes=[],t){var d=n["Interface."+c];"Yes"==t[c].Automatic&&t[c].ScopeTypes&&o.forEach(e=>{t[c].ScopeTypes.includes(e)&&(console.log(e,c),s[e].interfaces[d]=i.extractAttributeDef(t[c].Attributes,n,c))})}return console.timeEnd("formatResult"),s},extractAttributeDef:function(e,t,n){var i=[];for(var s in e){var o=e[s],a={Name:s,nls_Name:null==n?t["Attribute."+s]:t["Attribute."+n+"."+s]||t["Attribute."+s],Type:o.Type,MaxLength:o.MaxLength,MultiValuated:o.MultiValuated,MultiLine:o.MultiLine,Default:o.Default};o.Dimension&&(a.Dimension=o.Dimension),"Yes"==o.HasRangeDefined&&(a.AuthorizedValues=o.AuthorizedValues.map(e=>({label:t["Range."+s+"."+e]?t["Range."+s+"."+e]:e,value:e}))),i.push(a)}return i}})}),define("DS/DocumentCreateNew/Views/CreateForm",["UWA/Core","DS/Controls/Editor","DS/Controls/LineEditor","DS/Controls/ComboBox","DS/Controls/FilePicker","DS/Controls/Accordeon","DS/DataGridView/DataGridView","DS/Tweakers/TweakerArray","DS/Tweakers/TweakerNumber","DS/Tweakers/TweakerDate","DS/Tweakers/TweakerBoolean","DS/Controls/TooltipModel","DS/Controls/SelectionChipsEditor","DS/Controls/Popup"],function(e,t,n,i,s,o,a,r,l,c,d,u,p,m){"use strict";var g=e.Controls.Abstract.extend({init:function(e){this._parent(e),this.buildSkeleton()},buildSkeleton:function(){var e=this,t=this.options.fields;g.doctypesList=this.options.doctypes,g.dimensions=this.options.dimensions,g.elements={},g.events=this.options.events,t.forEach(function(t){"header"==t.type?e.buildHeader(t):"accordeon"==t.type?e.buildAccordeon(t):"grid"==t.type?e.buildGrid(t):e.createInputField(t,e.options.container)})},createInputField:function(o,a){var m=e.createElement("div",{class:"form-group",styles:{display:o.display}}).inject(a),f=e.createElement("label",{text:o.label,attributes:{for:o.settings.domId},styles:{display:o.display}}).inject(m);o.settings.requiredFlag&&e.createElement("span",{class:"label-field-required"}).inject(f).setHTML(' <i class="wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-required "></i>');var h=null;if("block"==o.display){switch(o.type){case"text":h=new n(o.settings).inject(m);break;case"combobox":h=new i(o.settings).inject(m);break;case"textarea":h=new t(o.settings).inject(m);break;case"file":h=new s(o.settings).inject(m);break;case"multi":o.settings&&"string"==o.settings.valueType?h=new p({value:[],placeholder:"Type a unique value",uniqueValue:!0,maxLength:o.settings.maxLength}).inject(m):(h=new r(o.settings).inject(m)).getContent().setAttribute("id",o.settings.domId);break;case"number":h=new l(o.settings).inject(m);break;case"date":h=new c(o.settings).inject(m);break;case"boolean":h=new d(o.settings).inject(m)}if(null!=h){var y=h.elements.container.dsModel.value;if(h.elements.container.dsModel.selectedIndex&&(y=h.elements.container.dsModel.currentLabel),h.tooltipInfos=new u({shortHelp:y}),g.elements[o.settings.domId]=h.elements.container.dsModel,h._properties.requiredFlag=o.settings.requiredFlag,o.additionalAttributes)for(var b in o.additionalAttributes)"combobox"==o.type||"text"==o.type?h.getContent().setAttribute(b,o.additionalAttributes[b]):h.getContent().children[0].setAttribute(b,o.additionalAttributes[b]);if(o.events){for(var b in o.events)h.addEventListener(b,o.events[b]);"file"==o.type&&(h.value=o.settings.blob)}}}},buildHeader:function(t){e.createElement("p",t).inject(this.options.container)},buildAccordeon:function(t){var n=this,i={style:t.styles,exclusive:t.exclusive,domId:t.domId},s=[];t.items.forEach(function(e){s.push(n.buildItem(e.id,e.header,e.content))}),i.items=s;var a=e.createElement("div",{class:"attribute-accordeon",styles:{display:t.display}}).inject(this.options.container),r=new o(i).inject(a);g.elements[t.domId]=r,this.appendDynamicAttributes(g.elements.Document_Type.value,r)},buildGrid:function(t){var n=e.createElement("div",{class:"",styles:{display:t.display}}).inject(this.options.container);new a(t).inject(n)},buildItem:function(t,n,i){var s=this,o=e.createElement("div",{class:"item-sections",id:t}),a={header:n};return i.forEach(function(e){s.createInputField(e,o)}),a.content=o,a},getFielfDef:function(t){var n={settings:{},additionalAttributes:{},events:{}};return n.label=t.nls_Name,n.display="block",n.settings.domId=t.Name.replace(" ","_"),n.settings.value=t.Default,n.additionalAttributes.Style="width:100%;",n.events=g.events,t.AuthorizedValues?(n.type="combobox",n.settings.elementsList=t.AuthorizedValues,n.settings.enableSearchFlag=!0,n.settings.popupSizeAdjustPolicy=m.SizeAdjustPolicyEnum.AdjustToVisibleContents):"Yes"==t.MultiValuated?(n.type="multi",n.settings.itemEditionTrigger="in place",n.settings.valueType=t.Type.toLowerCase(),isNaN(parseInt(t.MaxLength))||(n.settings.maxLength=parseInt(t.MaxLength)),t.Dimension&&(n.label+=" (in "+g.dimensions[t.Dimension]+")")):"Integer"==t.Type||"Double"==t.Type||"Real"==t.Type?(n.type="number","Integer"==t.Type&&(n.settings.stepValue=1),t.Dimension&&(n.settings.units=g.dimensions[t.Dimension])):"Date"==t.Type?(n.type="date",e.is(t.Default,"string")&&""!=t.Default?n.settings.value=new Date(1e3*t.Default):""==t.Default&&(n.settings.value=void 0)):"Boolean"==t.Type?(n.type="boolean",null==n.settings.value&&(n.settings.value=!1)):t.MultiLine&&"Yes"==t.MultiLine?(n.type="textarea",n.settings.newLineMode="enter",n.settings.nbRows=5,n.settings.maxLength=t.MaxLength):(n.type="text",n.settings.selectAllOnFocus=!0,n.settings.displayClearFieldButtonFlag=!0,isNaN(parseInt(t.MaxLength))||(n.settings.maxLength=parseInt(t.MaxLength))),n}});return g.prototype.appendInheritedAttributes=function(e,t){if(g.doctypesList[e]&&"DOCUMENTS"!=g.doctypesList[e]){var n=g.doctypesList[e].attributes;n&&n.length>0&&n.forEach(function(e){t.attributes.unshift(e)});var i=g.doctypesList[e].interfaces;if(i)for(const e in i)if(Object.hasOwnProperty.call(i,e)){const n=i[e];t.attributes.push(...n)}this.appendInheritedAttributes(g.doctypesList[e].parent,t)}},g.prototype.appendDynamicAttributes=function(t,n){var i=this,s={attributes:[]};i.appendInheritedAttributes(t,s);var o=n.items[n.items.length-1];if(s.attributes.length>0){var a=e.createElement("div",{class:"item-sections",id:"DCN_CustomAttributes"}).inject(o.content);g.elements.DCN_CustomAttributes=a,s.attributes.forEach(function(e){var t=i.getFielfDef(e);i.createInputField(t,a)})}n.clear(),n.addItem(o)},g}),define("DS/DocumentCreateNew/CreateNew",["UWA/Core","DS/UIKIT/Mask","DS/DocumentManagement/DocumentManagement","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","i18n!DS/DocumentCreateNew/assets/nls/DocumentCreateNew","DS/Windows/Dialog","DS/Controls/Button","DS/Controls/TooltipModel","DS/DocumentCreateNew/Views/CreateForm","DS/DocumentCreateNew/Utils/TypesUtils","DS/DocumentCreateNew/Utils/DimensionUtils","DS/DocumentCreateNew/Utils/Credentials","DS/Controls/Loader","DS/Controls/ModalContainer","UWA/Promise","css!DS/DocumentCreateNew/DocumentCreateNew"],function(e,t,n,i,s,o,a,r,l,c,d,u,p,m,g,f){"use strict";var h={},y=e.Controls.Abstract.extend({name:"doco-create-new2",options:{className:""},init:function(t){var n=this;this._parent(t),widget&&widget.app&&widget.app.jobs&&"doco-jobs"==widget.app.jobs.name&&widget.app.progressPane&&"doco-progress"==widget.app.progressPane.name?(h=widget.app).jobs.MAX_PARALLEL_JOBS=1:(null==h.jobs&&require(["DS/DocumentCommands/Jobs"],function(e){null==h.jobs&&(h.jobs=new e(h),h.jobs.MAX_PARALLEL_JOBS=1)}),null==h.progressPane&&require(["DS/DocumentCommands/ProgressPane"],function(e){null==h.progressPane&&(h.progressPane=new e(h),h.progressPane.inject(widget.body))})),y.selectedFiles=[],null==t.credentialsPrefName&&(t.credentialsPrefName="credentials"),null==this.options.containerToOverlay&&(this.options.containerToOverlay=widget.body),t.securityContext&&t.securityContext.startsWith("ctx::")&&(this.options.securityContext=t.securityContext.replace("ctx::",""));var i=widget.getPreference(t.credentialsPrefName);i?(y.credentials=i.options.map(function(e){return{label:e.label,value:e.value.startsWith("ctx::")?e.value.replace("ctx::",""):e.value}}),p.addCredentialList(t,y.credentials)):p.getCredentialsList(t).promise.then(function(e){y.credentials=e}),u.getDimensions(t).promise.then(function(e){y.dimensions=e},function(e){console.error("CreateNew: Failed to load Dimensions",e)}),d.getTypeInfos(t).promise.then(function(e){y.docTypesList=e},function(e){console.error("CreateNew: Failed to load Types",e)}),this.elements.container=e.createElement("div",{class:this.getClassNames()}),n.loader=new m({text:o.get("LOADING"),showButtonFlag:!0}),n.loader.canceller=f.deferred(),n.loader.elements.stopButton.addEventListener("buttonclick",function(e){n.loader.canceller.reject("usercancelled")})},generateForm:function(){var e=this;this.startLoading();var t=y.selectedFiles.length>1,n=function(t){e.valueChanged(t,e)};new c({doctypes:y.docTypesList,dimensions:y.dimensions,container:this.elements.container,events:{change:n},fields:[{type:"header",class:"header1",text:o.get("Head_Info_1").replace("{nbFiles}",y.selectedFiles.length),styles:{display:t?"block":"none"}},{type:"header",class:"header2",text:o.get("Head_Info_2"),styles:{display:t?"block":"none"}},{type:"text",label:o.get("Title"),display:t?"none":"block",settings:{domId:"Title",selectAllOnFocus:!0,displayClearFieldButtonFlag:!1,requiredFlag:!0},additionalAttributes:{Style:"width:100%;"},events:{change:n}},{type:"combobox",label:o.get("Document_Type"),display:"block",settings:{domId:"Document_Type",elementsList:e.filteredTypes,selectedIndex:widget.getPreference("lastSelected")?widget.getPreference("lastSelected").defaultValue:0,enableSearchFlag:!0,requiredFlag:!0},additionalAttributes:{Style:"width:100%;"},events:{change:function(t){e.docTypeChanged(t,e)}}},{type:"file",label:o.get("File"),display:t?"none":"block",settings:{domId:"file",blob:y.selectedFiles[0],width:"100%",requiredFlag:!0},events:{change:e.fileChanged}},{type:"combobox",label:o.get("Credentials"),display:"block",settings:{domId:"credentials",elementsList:y.credentials,selectedIndex:0,value:e.options.securityContext,enableSearchFlag:!0,requiredFlag:!0},additionalAttributes:{Style:"width:100%;"},events:{change:n}},{type:"accordeon",items:[{doctypeDefault:"Document",id:"ShowMore",header:o.get("Show_more"),content:[{type:"textarea",display:t?"none":"block",label:o.get("Description"),settings:{domId:"Description",newLineMode:"enter",nbRows:5},additionalAttributes:{Style:"width:100%;"},events:{change:n}},{type:"text",display:t?"none":"block",label:o.get("Collaborative_Policy"),settings:{domId:"Policy",value:o.get("Policy_Name"),disabled:!0},additionalAttributes:{Style:"width:100%;"}}]}],styles:"simple",exclusive:!1,domId:"accordeon",display:t?"none":"block"},{type:"grid",display:t?"block":"none",identifier:"selectedFilesListId",height:"500",treeDocument:e.generategridTree(y.selectedFiles),maxVisibleRowCount:10,columns:[{text:o.get("Title"),dataIndex:"name",typeRepresentation:"string",alignment:"near",width:"100%",minWidth:"30",height:"150",alwaysVisibleFlag:!0,editableFlag:!1}],cellSelection:"none",rowSelection:"none",selectionBehavior:{selectNodeModelOnCellSelection:!1},showBackgroundFlag:!0,columnDragEnabledFlag:!1,showSelectionCheckBoxesFlag:!1,defaultColumnDef:{minWidth:30,width:"auto",sortableFlag:!0},layoutOptions:{columnsHeader:!0,rowsHeader:!1}}]}),e.finishLoading()},startLoading:function(){t.mask(this.elements.container)},finishLoading:function(){t.unmask(this.elements.container)},docTypeChanged:function(e,t){try{t.valueChanged(e,t);var n=c.elements.DCN_CustomAttributes;n&&n.remove(),c.prototype.appendDynamicAttributes(e.dsModel.value,c.elements.accordeon),widget.addPreference({name:"lastSelected",type:"hidden",defaultValue:e.dsModel.selectedIndex})}catch(e){console.error(e)}},fileChanged:function(e){let t=e.dsModel.value,n=t.name;y.selectedFiles.length=0,y.selectedFiles.push(t),n=-1==n.indexOf(".")?n:n.substring(0,n.lastIndexOf(".")),c.elements.Title&&(c.elements.Title.value.length>0?c.elements.Title.value=n:(c.elements.Title.value=n,c.elements.Title._giveFocus()))},generategridTree:function(){var e=new i;e.prepareUpdate();for(var t=0;t<y.selectedFiles.length;t++){var n=y.selectedFiles[t];e.addRoot(new s({label:n.name,grid:{name:n.name}}))}return e.expandAll(),e.pushUpdate(),e},addChilds:function(e,t,n,i){var s=this,o=y.docTypesList[e].childs;o&&o.forEach(function(o){var a={label:y.docTypesList[o].nls,icon:y.docTypesList[o].icon,value:o};t.includes(o)||i.includes(e)||"No"!=y.docTypesList[e].abstract||(n.unshift(a),i.push(e),s.addChilds(o,t,n,i))})},filterTypes:function(){var e=[],t=this.options.supportedTypes;if(!t||!t.includedTypes&&!t.excludedTypes)return Object.keys(y.docTypesList).forEach(function(t){"No"==y.docTypesList[t].abstract&&e.unshift({label:y.docTypesList[t].nls,icon:y.docTypesList[t].icon,value:t})}),e;var n=[];for(var i in y.docTypesList){var s={label:y.docTypesList[i].nls,icon:y.docTypesList[i].icon,value:i};!t.includedTypes.includes("*")&&!t.includedTypes.includes(i)||t.excludedTypes.includes(i)||n.includes(i)||"No"!=y.docTypesList[i].abstract||(e.unshift(s),n.push(i),this.addChilds(i,t.excludedTypes,e,n))}return e},appendInheritedAttributes:function(t,n){if(y.docTypesList[t]){var i=y.docTypesList[t].attributes;i&&i.length>0&&i.forEach(function(e){n.attributes.unshift(e)});var s=y.docTypesList[t].interfaces;s&&e.merge(n.deploy_interfaces,s),this.appendInheritedAttributes(y.docTypesList[t].parent,n)}},formatInputValues:function(e){var t=void 0;if(Array.isArray(e)){var n=[];e.forEach(function(e){n.push(e instanceof Date?e:e.toString())}),n.length>0&&(t=n)}else e&&(t=e instanceof Date?e:e.toString());return t},createAndUpload:function(e){var t=this,n=y.selectedFiles.length>1;if(n||!n&&c.elements.Title&&c.elements.Title.value.trim().length>0){var i=c.elements.Document_Type.value,s={},o={attributes:[]};c.prototype.appendInheritedAttributes(i,o),o.attributes.forEach(function(e){var n=t.formatInputValues(c.elements[e.Name.replace(" ","_")].value);n&&(s[e.Name]=n)}),y.selectedFiles.length>0?y.selectedFiles.forEach(e=>{var o={title:n?-1==e.name.indexOf(".")?e.name:e.name.substring(0,e.name.lastIndexOf(".")):c.elements.Title.value,type:i,description:n?"":c.elements.Description.value,custom_attributes:s,fileInfo:{comments:n?"":c.elements.Description.value,file:e}};t.options.connector?(t.options.parentObject.parentId&&(o.relInfo={parentId:t.options.parentObject.parentId,parentRelName:t.options.parentRelName,parentDirection:"from"}),t.options.connector.uploadAttachment(o,t.options.parentObject,c.elements.credentials.value)):(t.options.parentId&&(o.relInfo={parentId:t.options.parentId,parentRelName:t.options.parentRelName,parentDirection:"from"}),t.uploadDocument(o,{tenant:t.options.tenant,securityContext:c.elements.credentials.value,tenantUrl:t.options.tenantUrl,getWorkUnderHeaders:t.options.getWorkUnderHeaders}))}):this.uploadDocument({title:n?"":c.elements.Title.value,description:n?"":c.elements.Description.value},{tenant:t.options.tenant,securityContext:c.elements.credentials.value,tenantUrl:t.options.tenantUrl,getWorkUnderHeaders:t.options.getWorkUnderHeaders}),e.close(),e.destroy(),t.options.onUploadStart&&t.options.onUploadStart()}else n||0!=c.elements.Title.value.trim().length||c.elements.Title.getContent().getParent().addClassName("has-error"),0==y.selectedFiles.length&&widget.getElement("#DCN_uploadBtn").dsModel.getContent().addClassName("has-error")},create:function(t){var n=this;g.createModal(n.options.containerToOverlay,this.loader.elements.container),n.loader.on(o.get("LOADING"));for(var i=0;i<t.length;i++)y.selectedFiles.push(t[i]);var s=new e.Promise(function(t,i){e.Promise.all([p.getCredentialsList(n.options).promise,d.getTypeInfos(n.options).promise,u.getDimensions(n.options).promise]).then(function(e){t(e)},function(e){i(e)})}),c=this.loader.canceller.promise;e.Promise.race([s,c]).then(function(e){n.loader.on(o.get("LOADING")),g.removeModal(n.options.containerToOverlay),y.credentials=e[0],y.docTypesList=e[1],y.dimensions=e[2],console.log(y.docTypesList),n.filteredTypes=n.filterTypes(),0==n.filteredTypes.length?n.options.onError&&n.options.onError({subtitle:o.get("INVALID_CONFIGURATION"),message:o.get("NO_DOCUMENT_TYPES_ALLOWED")}):(n.generateForm(),n.dialog=new a({title:o.get("Upload")+(t.length>1?" "+t.length+" - "+o.get("files"):""),content:n.getContent(),immersiveFrame:n.options.immersiveFrame,resizableFlag:!0,width:"500",modalFlag:!0,buttons:{Cancel:new r({label:o.get("Cancel"),onClick:function(e){e.dsModel.dialog.close(),e.dsModel.dialog.destroy(),n.options.onCancel&&n.options.onCancel()},tooltipInfos:new l({title:o.get("Cancel"),mouseRelativePosition:!1})}),Ok:new r({label:o.get("Upload"),emphasize:"primary",domId:"DCN_uploadBtn",onClick:function(e){n.createAndUpload(e.dsModel.dialog)},tooltipInfos:new l({title:o.get("Upload"),mouseRelativePosition:!1})})}}))},function(e){n.options.onError&&"usercancelled"!=e&&n.options.onError(e),n.options.onCancel&&"usercancelled"==e&&n.options.onCancel(),g.removeModal(n.options.containerToOverlay)})},selectFilesAndCreate:function(){var t=this,n=e.createElement("input",{attributes:{type:"file",multiple:!0},styles:{display:"none"},events:{change:function(e){var i=e.target&&e.target.files&&e.target.files.length>0?e.target.files:e.dataTransfer.files;t.create(i),n.destroy()}}}).inject(document.body);n.click()},valueChanged:function(e,t){var n=e.dsModel.value;(e.dsModel.selectedIndex&&(n=e.dsModel.currentLabel),e.dsModel.tooltipInfos.shortHelp=n,e.dsModel._properties)&&(e.dsModel._properties.requiredFlag&&t.validateInputs(e))},validateInputs:function(e){if(this.dialog&&this.dialog.buttons&&this.dialog.buttons.Ok&&this.dialog.buttons.Ok.getModel()){var t=this.dialog.buttons.Ok.getModel();t.disabled=!1;for(var n=Object.keys(c.elements),i=0;!t.disabled&&i<n.length;i++){var s=c.elements[n[i]];if(s._properties)!s._properties.requiredFlag||s.value&&0!=s.value.length||(t.disabled=!0)}}}});return y.prototype.uploadDocument=function(t,i){var s=this,a={tenant:i.tenantId,securityContext:i.securityContext,tenantUrl:i.tenantUrl,additionalHeaders:e.is(i.getWorkUnderHeaders,"function")?i.getWorkUnderHeaders():{},onFailure:function(e){h.jobs.finishJob(l,"failed"),s.options.onError&&s.options.onError({title:o.get("DOCUMENT_CANNOT_BE_CREATED"),message:e&&e.error||o.get("X_CANNOT_BE_CREATED",{title:t.title})})},onProgress:function(e){l.update(e)},onComplete:function(e){e.data;if(h.jobs.finishJob(l),s.options.onDocumentUpload){var n={notification:{title:o.get("DOCUMENT_CREATED"),subtitle:o.get("X_HAS_BEEN_CREATED_SUCCESSFULLY",{title:t.title})},documents:e.data};t.relInfo&&(n.relInfo=t.relInfo),s.options.onDocumentUpload(n)}},customDocumentObject:t.custom_attributes?{dataelements:t.custom_attributes}:void 0,preProcess:function(e){console.log("docJson"),console.log(e)}},r=t.title;t.fileInfo&&(r=t.fileInfo.file.name);var l={title:o.get("UPLOADING_X",{title:r}),ui:!!t.fileInfo,process:function(){l.xhr=n.createDocument(t,a)}};h.jobs.addJob(l)},y});