define("DS/WebUtils/ProbesManager",["UWA/Class","DS/WebSystem/Environment","DS/WebSystem/Downloader"],function(t,e,i){"use strict";var n=!e.isSet("3DPlay.DisableProbes"),r="3DPlay_";"undefined"!=typeof widget&&widget.id&&(r=widget.id+"_3DPlay_");var s=[],o=0;return{createProbe:function(t,e,i){if(!n)return{begin:function(){},end:function(){},getTime:function(){}};var a={probeName:t,id:r+t,strMarkBegin:e||t+"_Begin_"+o,strMarkEnd:i||t+"_End_"+o,begin:function(){return window.performance.mark(this.strMarkBegin),this},end:function(){try{window.performance.mark(this.strMarkEnd),window.performance.measure(this.id,this.strMarkBegin,this.strMarkEnd)}catch(t){console.log(this.probeName,t)}},getTime:function(){var t=window.performance.getEntriesByName(this.id).pop();return t?Math.floor(t.duration):0}};if(e&&i)try{window.performance.measure(a.id,a.strMarkBegin,a.strMarkEnd)}catch(t){}return o++,s.push(a),a},createFunctionProbe:function(t,e,i){return n?(r="string"==typeof t?this.createProbe(t).begin():t,s=e,function(){r.end(),UWA.is(s,"function")&&s.apply(r,Array.prototype.slice.call(arguments)),r=null,s=null}):e;var r,s},createNetWorkProbe:function(t,e){var i=this.createProbe(t);return e.onComplete=this.createFunctionProbe(i,e.onComplete),e.onFailure=this.createFunctionProbe(i,e.onFailure),i},_parse:function(t){var e=0;for(e=s.length;e--;)if(s[e].probeName===t)return s[e];0===e&&console.error("Probe not found : ",t)},begin:function(t){var e=this.createProbe(t);return e.begin(),e},end:function(t){var e=this._parse(t);e&&e.end()},getTime:function(t){var e=this._parse(t);return e?e.getTime():0},GetProcessedData:function(t){var e,i,n=0,r=0,s=[],o="";if(t=t||{},"undefined"!=typeof widget&&widget.id&&(o=widget.id),window["3DPlay.ProbesManager.TopWindowNotAvailable"])e=window.performance.getEntriesByName(o+"clap"),Array.isArray(e)&&(e=e[0]),n=e.startTime;else{var a=window.top.performance.getEntriesByName(o+"clap");Array.isArray(a)&&(a=a[0]),e=window.performance.getEntriesByName(o+"clap"),Array.isArray(e)&&(e=e[0]),a&&e&&(n=e.startTime,r=a.startTime-e.startTime)}if(window.performance.getEntriesByType("measure").forEach(function(e){e.duration>2&&((!t.only3DPlay||e.name.indexOf("3DPlay")>-1)&&s.push({name:e.name,startTime:e.startTime,duration:e.duration}))}),t.cleanNames)for(i=0;i<s.length;i++){var u=s[i],h=u.name.split("3DPlay_");h.length>=2&&(h=h.slice(1),u.name=h.join("_"))}return{iframeTime:r,adjustTime:n,probes:s}},GetSubProbesFrom:function(t,e){e=void 0===e||e;var i=[];if(t){var n=window.performance.getEntriesByName(t.id).pop();if(n){var r=this.GetProcessedData({topWindow:!1,cleanNames:!0}),s=n.startTime,o=s+n.duration;r.probes.forEach(function(e){t.probeName!==e.name&&e.duration>2&&e.startTime>=s&&e.startTime+e.duration<=o&&(i[e.name]=Math.floor(e.duration+.5))})}}return i},dump:function(t,e){t=t?t+"_":"";var n=new Date,r=n.getFullYear()+"-"+(n.getMonth()+1)+"-"+n.getDate()+"-"+n.getHours()+":"+n.getMinutes(),s=[];if(e)s=this.GetProcessedData({topWindow:!1,cleanName:!0,only3DPlay:!0});else{try{s=(s=window.top.performance.getEntriesByType("measure")).concat(window.top.performance.getEntriesByType("mark"))}catch(t){}s=(s=s.concat(window.performance.getEntriesByType("mark"))).concat(window.performance.getEntriesByType("measure"))}i("3DPlay.PCS_"+t+r+".json",new Blob([JSON.stringify(s)],{type:"text/plain"}))},cleanProbes:function(){s=[],window.performance.clearMeasures()}}}),define("DS/WebUtils/StringUtils",["UWA/Class"],function(t){"use strict";var e={fileExtension:/(?:\.([^./]+)(?:\.\d)?)?$/,urlprotocol:/(^[A-Za-z]+)\:\/\//,urlhostname:/(?:\:\/\/)(?=(.+)\:|\/)/,urlhostport:/(?:\:)(?=([0-9]+))/,rooturi:/(?:\:\/\/[^\/]+\/)(?=(.+))/,isInt:/^(\-|\+)?([0-9]+|Infinity)$/};return t.singleton({init:function(t){},sprintf:function(){for(var t=arguments[0],e=0,i=arguments.length-1;e<i;e++)t=t.replace("{"+e+"}",arguments[e+1]);return t},parseUrl:function(t){var i={},n=t.match(/^(^[A-Za-z]+)\:\/\/(([^:\/?#]*)(?:\:([0-9]+))?)(\/[^?#]*)(\?[^#]*|)(#.*|)$/);if(n)i={protocol:n[1],host:n[2],hostname:n[3],port:n[4]?parseInt(n[4]):{http:80,https:443}[n[1]],pathname:n[5].substring(1),search:n[6],hash:n[7]};else{if(i.protocol=e.urlprotocol.exec(t),null===i.protocol||void 0===i.protocol)return null;i.protocol=i.protocol[1],i.hostname=e.urlhostname.exec(t),null!==i.hostname&&void 0!==i.hostname&&(i.hostname=i.hostname[1]),i.port=e.urlhostport.exec(t),null!==i.port&&void 0!==i.port&&(i.port=i.port[1]),i.pathname=e.rooturi.exec(t),null!==i.pathname&&void 0!==i.pathname&&(i.pathname=i.pathname[1])}if(i.pathname){var r=i.pathname.indexOf("/");i.rooturi=i.pathname.substring(0,r>-1?r:i.pathname.length)}return i},getExtension:function(t){if(null==t||""===t)return"";var i,n=t.indexOf("?")+1,r=t;n&&(r=t.substring(0,t.indexOf("?")));var s=e.rooturi.exec(r);return s=null!=s?s[1]:t,null!=(i=e.fileExtension.exec(s))&&(i=i[1]),null!=i?i:""},filterInt:function(t){return e.isInt.test(t)?Number(t):NaN}})}),define("DS/WebUtils/ContextedSingleton",["UWA/Class"],function(t){"use strict";return t.singleton({data:{},init:function(){},add:function(t,e,i){var n=this.data[t];void 0===n&&(n=this.data[t]={}),n[e]=i},get:function(t,e){var i=this.data[t];return void 0!==i?i[e]:i},remove:function(t,e){var i=this.data[t];return void 0!==i&&void 0!==i[e]&&(i[e].dispose&&i[e].dispose(),i[e]=null,delete i[e]),this},removeCtx:function(t){if(this.data[t]){for(var e in this.data[t])this.remove(t,e);delete this.data[t]}return this}})}),define("DS/WebUtils/EventDisposer",["DS/CoreEvents/Events","UWA/Class"],function(t,e){"use strict";return e.extend({init:function(t){this._parent(),this.arr=[]},add:function(t){return this.arr.push(t),this},dispose:function(){for(var e=this.arr.length;e--;)t.unsubscribe(this.arr[e]),this.arr[e]=null;this.arr=null}})}),define("DS/WebUtils/MemoryProfiler",["DS/WebSystem/DetectBrowser","DS/WebInfraUI/DOMGraph"],function(t,e){"use strict";var i={update:console.log},n=1e3,r={chrome:!0},s=1073741824,o=function(){setTimeout(o,n),i.update(Math.floor(window.performance.memory.usedJSHeapSize/s))};return function(a){a=a||{};var u=t();r[u.browser.name]&&window.performance.memory?(n=a.updateTime||n,s=a.size||s,i=a.output?a.output:new e({updateLegend:a.updateLegend||"Ko",name:a.name||"Memory",container:a.container?a.container:document.body,color:a.color||"f00",length:a.length||200,updateSize:!0}),o()):console.warn('Memory Profiling is only supported by chrome whith " --enable-precise-memory-info" option')}}),define("DS/WebUtils/State",["UWA/Class"],function(t){"use strict";var e=0;return t.extend({init:function(t){this.name=t.name||"undefined"+e++,this._restore=t.restore,this.getValue=t.getValue,this.initValue=t.getValue()},getValue:function(){},restore:function(){this._restore(this.initValue)},getInitialValue:function(){return this.initValue}})}),define("DS/WebUtils/FunctionDisposer",["UWA/Class"],function(t){"use strict";return t.extend({init:function(t){this._parent(),this.disposeFunctions=[]},add:function(t){this.disposeFunctions.push(t)},dispose:function(){for(var t=this.disposeFunctions.length;t--;)this.disposeFunctions[t]&&(this.disposeFunctions[t](),this.disposeFunctions[t]=null),delete this.disposeFunctions[t]}})}),define("DS/WebUtils/3DPlayState",["DS/CefCommunication/CefCommunication"],function(t){"use strict";return{isWebinWin:function(){return t.isAvailable()}}}),define("DS/WebUtils/Clock",[],function(){"use strict";function t(t){this.autoStart=void 0===t||t,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}return t.prototype={constructor:t,start:function(){this.startTime=(performance||Date).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0},stop:function(){this.getElapsedTime(),this.running=!1},getElapsedTime:function(){return this.getDelta(),this.elapsedTime},getDelta:function(){var t=0;if(this.autoStart&&!this.running&&this.start(),this.running){var e=(performance||Date).now();t=(e-this.oldTime)/1e3,this.oldTime=e,this.elapsedTime+=t}return t}},t}),define("DS/WebUtils/GraphicOption",["UWA/Class"],function(t){"use strict";return t.extend({init:function(t){this.name=t.name,this.settingName=t.settingName,this.defaultValue=t.defaultValue,this.nlsTitle=t.nlsTitle,this.enabled=!0,this.available=!0,this.viewer=t.viewer},enable:function(){this.enabled=!0,this.activateFunc(!0)},disable:function(){this.enabled=!1,this.activateFunc(!1)},refreshAvailability:function(){this.available=this.getCurrentState(),this.enabled=this.available},activateFunc:function(t){},getCurrentState:function(){return!0}})}),define("DS/WebUtils/Profiler",["UWA/Class"],function(t){"use strict";var e=function(){return(new Date).getTime()};function i(t,n,r){this.father=n,this.name=t,this.startTime=this.stopTime=0,this.path=n?n.path:"",this.path+=t+"/",this.addProfile=function(t,e){this.children=this.children||{};var n=this.children[t];return n||(n=new i(t,this),this.children[t]=n),n.start()},this.addProfileFromObject=function(t){var e=this.addProfile(t.name);return e.startTime=t.startTime,e},this.stop=function(t){0===this.stopTime&&(this.stopTime=e());var i=this.stopTime-this.startTime;return t&&this.father&&this.father.stop(!0),i},this.start=function(){return this.stopTime=0,this.startTime=e(),this},this.getTime=function(){return(0===this.stopTime?e():this.stopTime)-this.startTime},this.isStopped=function(){return 0!==this.stopTime},this.dumpAsJSON=function(){var t=this.isStopped()?this.getTime():-1;if(this.children){t={time:t};var e=this.children;for(var i in e)t[i]=e[i].dumpAsJSON()}return t},this.getPath=function(){return this.path},this.dispose=function(){if(this.name=null,this.path=null,this.father=null,Array.isArray(this.children))for(var t=0;t<this.children.length;t++)this.children[t].dispose();this.children=null}}return t.singleton({Profiles:{},_searchNode:function(t,e,n){var r;if(-1!=t.indexOf("/")){var s=t.split("/"),o=s.shift();(r=e&&e.children?e.children[o]:this.Profiles[o])||(e?r=e.addProfile(o):n&&(r=new i(o),this.Profiles&&(this.Profiles[o]=r))),r&&s.length>0&&(r=this._searchNode(s.join("/"),r,n))}else e?(e.children&&(r=e.children[t]),!r&&n&&(r=e.addProfile(t))):r=this.Profiles[t];return r},init:function(t){},start:function(t,e){var n=this._searchNode(t,void 0,!0);return n||(n=new i(t),this.Profiles[t]=n),n.start()},stop:function(t,e){var i=this._searchNode(t,void 0,!1);return void 0!==i?i.stop(e):(console.warn("[PROFILER] unknown profile :",t),-1)},getTime:function(t){var e=this._searchNode(t,void 0,!1);return void 0!==e?e.getTime():(console.warn("[PROFILER] unknown profile :",t),-1)},dumpAsJSON:function(){var t={},e=this.Profiles;for(var i in e)t[i]=e[i].dumpAsJSON();return t}})}),define("DS/WebUtils/Logger",["DS/WebSystem/Environment","DS/Logger/Logger"],function(t,e){"use strict";return function(i,n){var r=e.getLogger(i);return r.setLevel(n&&t.isSet(n)||t.isSet("3DPlay.Debug")?"log":"warn"),r}}),define("DS/WebUtils/PhaseProgress",["UWA/Class","DS/WebInfraUI/Progress"],function(t,e){"use strict";return t.extend({init:function(){this.progressBarDivision=0,this.subProgressArray=[0],this._MaxValue=100,this.progress=new e},registerSubProgress:function(){return this.progressBarDivision++,this.subProgressArray[this.progressBarDivision]=0,this.progressBarDivision},registerMultipleSubProgress:function(t){for(var e=[],i=0;i<t;++i)e.push(this.registerSubProgress());return e},getSubProgressDivisions:function(){return this.progressBarDivision},resetProgress:function(){this._OldValue=0,this._CurrentValue=0,this.progressBarDivision=0,this.subProgressArray=[0]},dispose:function(){this.resetProgress(),this.progressBarDivision=void 0,this.subProgressArray=[],this._MaxValue=void 0,this.progress.dispose()},advanceToMax:function(t){t&&this.setAbsoluteProgress(t,this._MaxValue)},setAbsoluteProgress:function(t,e){t&&t<=this.progressBarDivision&&(e<=100&&(this.subProgressArray[t]=e),this._advance())},setIncrementalProgress:function(t,e){t&&t<=this.progressBarDivision&&(this.subProgressArray[t]+e<=100&&(this.subProgressArray[t]+=e),this._advance())},setIndeterminateState:function(){this.progress.updateProgression(-1)},showProgressBar:function(){this.progress.visible()},hideProgressBar:function(){this.progress.hide()},getProgressBarState:function(){return this.progress.getProgressBarState()},addProgressBarIntoUI:function(t){t.appendChild(this.progress.getContent())},_getProgress:function(){return{loaded:this._CurrentValue,total:this._MaxValue}},_advance:function(){var t=0;this.subProgressArray.forEach(function(e){0!==e&&(t+=e)}),t/=this.progressBarDivision,this._CurrentValue=t,this._CurrentValue-this._OldValue>=0?(this._OldValue=this._CurrentValue,this._updateProgressBar(),this.onAdvance&&this.onAdvance(this._getProgress())):this._CurrentValue-this._MaxValue>.001&&console.error("[3DPlay/PhaseProgress] _CurrentValue > _MaxValue ("+this._CurrentValue+" > "+this._MaxValue+")")},_updateProgressBar:function(){this.progress.updateProgression(this._CurrentValue)},_CurrentValue:0,_OldValue:0})}),define("DS/WebUtils/Vector2",["UWA/Class"],function(t){"use strict";return t.extend({init:function(t,e){this.x=t||0,this.y=e||0},set:function(t,e){return this.x=t,this.y=e,this},setScalar:function(t){return this.x=t,this.y=t,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setComponent:function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}},clone:function(){return new this.constructor(this.x,this.y)},copy:function(t){return this.x=t.x,this.y=t.y,this},add:function(t,e){return void 0!==e?this.addVectors(t,e):(this.x+=t.x,this.y+=t.y,this)},addScalar:function(t){return this.x+=t,this.y+=t,this},addVectors:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this},addScaledVector:function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this},sub:function(t,e){return void 0!==e?this.subVectors(t,e):(this.x-=t.x,this.y-=t.y,this)},subScalar:function(t){return this.x-=t,this.y-=t,this},subVectors:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this},multiply:function(t){return this.x*=t.x,this.y*=t.y,this},multiplyScalar:function(t){return this.x*=t,this.y*=t,this},divide:function(t){return this.x/=t.x,this.y/=t.y,this},divideScalar:function(t){return this.multiplyScalar(1/t)},min:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this},max:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this},clamp:function(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this},clampLength:function(t,e){var i=this.length();return this.multiplyScalar(Math.max(t,Math.min(e,i))/i)},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this},negate:function(){return this.x=-this.x,this.y=-this.y,this},dot:function(t){return this.x*t.x+this.y*t.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)},normalize:function(){return this.divideScalar(this.length())},angle:function(){var t=Math.atan2(this.y,this.x);return t<0&&(t+=2*Math.PI),t},distanceTo:function(t){return Math.sqrt(this.distanceToSquared(t))},distanceToSquared:function(t){var e=this.x-t.x,i=this.y-t.y;return e*e+i*i},distanceToManhattan:function(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)},setLength:function(t){return this.multiplyScalar(t/this.length())},lerp:function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this},lerpVectors:function(t,e,i){return this.subVectors(e,t).multiplyScalar(i).add(t)},equals:function(t){return t.x===this.x&&t.y===this.y},fromArray:function(t,e){return void 0===e&&(e=0),this.x=t[e],this.y=t[e+1],this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.x,t[e+1]=this.y,t},fromBufferAttribute:function(t,e){return this.x=t.getX(e),this.y=t.getY(e),this},rotateAround:function(t,e){var i=Math.cos(e),n=Math.sin(e),r=this.x-t.x,s=this.y-t.y;return this.x=r*i-s*n+t.x,this.y=r*n+s*i+t.y,this}})}),define("DS/WebUtils/Tracker",["UWA/Class","DS/WebUtils/Logger","DS/Usage/TrackerAPI","DS/WebUtils/Profiler","DS/WebSystem/Environment"],function(t,e,i,n,r){"use strict";var s,o,a="3DPlay",u=r.isSet("3DPlay.Tracker.ProbesChecker")?"-probesChecker":"",h="X3DPLAW_AP",l=e("3DPlay.Tracker","3DPlay.Log.Tracker"),c=Date.now(),f=0;return{scenario:function(t){this.trackPageEvent("commands","scenario",t,void 0,{count:this.incCommandCounter()})},command:function(t,e){this.trackPageEvent("commands","command",t,e||void 0,{count:this.incCommandCounter()})},startCommand:function(t){n.start(t)},endCommand:function(t){this.command(t,Math.floor(n.stop(t)/1e3))},resetCommandCounter:function(){f=0},incCommandCounter:function(){return s||o||f++,f},trackPageEvent:function(t,e,n,r,f,d,p){var m,g={pd1:"undefined"!=typeof widget?widget.id:"default-widget-id"},y={pv1:Math.floor((Date.now()-c)/1e3)},v=1;if(f)for(var x in f)f.hasOwnProperty(x)&&void 0!==f[x]&&(p?v=p[x]:v++,v&&(g["pd"+v]=x,y["pv"+v]=f[x]));"undefined"!=typeof widget&&(m=widget.getValue("x3dPlatformId")),!m&&d&&(m=d);var b={};b.eventCategory=a+"-"+t+u,b.eventAction=e,b.eventLabel=n,b.eventValue=r,b.persDim=g,b.appID=h,b.tenant=m,b.persVal=y,s||o?s&&(s=!1):(i.trackPageEvent(b),l.log(b))},disableNext:function(){s=!0},pause:function(t){o=t},setAppInfos:function(t){a=t.Prefix,h=t.appId}}}),define("DS/WebUtils/GeometryUtils",["DS/WebUtils/Vector2"],function(t){"use strict";return{convexHullCompute:function(t){for(var e=t.slice().sort(function(t,e){return t.x==e.x?t.y-e.y:t.x-e.x}),i=[],n=0;n<e.length;n++){for(;i.length>=2&&this._leftTurn(i[i.length-2],i[i.length-1],e[n]);)i.pop();i.push(e[n])}i.pop();var r=i.length+2;for(n=e.length-1;n>=0;n--){for(;i.length>=r&&this._leftTurn(i[i.length-2],i[i.length-1],e[n]);)i.pop();i.push(e[n])}return i.pop(),i},boundingBoxCompute:function(e){for(var i=Number.MAX_VALUE,n=[],r=[],s=0,o=0,a=0,u=0,h=0;h<e.length;h++)r.push(e[(h+1)%e.length].clone().sub(e[h]).normalize()),e[h].x<e[s].x&&(s=h),e[h].x>e[o].x&&(o=h),e[h].y<e[u].y&&(u=h),e[h].y>e[a].y&&(a=h);var l=new t(-1,0),c=new t(0,-1);for(h=0;h<e.length;h++){var f=[c.dot(r[s]),-c.dot(r[o]),l.dot(r[a]),-l.dot(r[u])];switch(f.indexOf(Math.max.apply(Math,f))){case 0:(l=r[s].clone()).set(l.y,-l.x),s=(s+1)%e.length;break;case 1:(l=r[o].clone().negate()).set(l.y,-l.x),o=(o+1)%e.length;break;case 2:l=r[a].clone(),a=(a+1)%e.length;break;case 3:l=r[u].clone().negate(),u=(u+1)%e.length}(c=l.clone().negate()).set(c.y,-c.x);var d=this._intersection(e[s],c,e[a]),p=this._intersection(e[o],c,e[a]),m=this._intersection(e[u],l,e[s]),g=this._intersection(e[u],l,e[o]),y=d.distanceTo(p)*d.distanceTo(m);y<i&&(n=[d,m,g,p],i=y)}return n},isIntersect:function(t,e){for(var i=0;i<t.length;i++)for(var n=0;n<e.length;n++)if(this._intersect(t[i],t[(i+1)%t.length],e[n],e[(n+1)%e.length]))return!0;return!1},isOverlap:function(t,e){var i=this.isIntersect(t,e);return!1===i&&(this._isInsidePolygon(t[0],e)&&(i=!0),this._isInsidePolygon(e[0],t)&&(i=!0)),i},getCurveLength:function(t){for(var e=0,i=0;i<t.length-1;i++)e+=t[i+1].clone().sub(t[i]).length();return e},getTopLeftPoint:function(e){new t(9999,9999);for(var i=9999,n=9999,r=0;r<e.length;r++)e[r].x<i&&(i=e[r].x),e[r].y<n&&(n=e[r].y);return new t(i,n)},getBarycenter2D:function(e){for(var i=new t,n=0;n<e.length;n++)i.x+=e[n].x,i.y+=e[n].y;return i.x/=e.length,i.y/=e.length,i},getBarycenter:function(t){for(var e={x:0,y:0,z:0},i=0;i<t.length;i++)e.x+=t[i].x,e.y+=t[i].y,e.z+=t[i].z;return e.x/=i,e.y/=i,e.z/=i,e},_isInsidePolygon:function(t,e){for(var i=0,n=0;n<e.length;n++)e[n].y<=t.y?e[(n+1)%e.length].y>t.y&&this._isLeft(e[n],e[(n+1)%e.length],t)&&i++:e[(n+1)%e.length].y<=t.y&&(this._isLeft(e[n],e[(n+1)%e.length],t)||i--);return!(0==i)},_isnearPolygon:function(t,e,i,n){var r=6;n&&(r=n),r/=i;for(var s=0;s<e.length;s++){var o=t.x-e[s].x,a=t.y-e[s].y;if(Math.sqrt(o*o+a*a)<r)return!0}return!1},_leftTurn:function(t,e,i){return(e.x-t.x)*(i.y-e.y)-(e.y-t.y)*(i.x-e.x)<=0},_isLeft:function(t,e,i){return(e.x-t.x)*(i.y-t.y)-(i.x-t.x)*(e.y-t.y)>=0},_intersect:function(t,e,i,n){return(this._isLeft(t,i,n)?1:0)^(this._isLeft(e,i,n)?1:0)&&(this._isLeft(i,t,e)?1:0)^(this._isLeft(n,t,e)?1:0)},_intersection:function(e,i,n){var r=((e.x-n.x)*i.x-(n.y-e.y)*i.y)/(-i.x*i.x-i.y*i.y);return new t(e.x+r*i.x,e.y+r*i.y)},_checkEqual:function(t,e){return Math.abs(e-t)<=.1},wrapText:function(t){var e=t.canvasCtx,i=t.text,n=t.width,r=t.height,s=[],o=0;if(!e){var a=document.createElement("canvas");a.width=n,a.height=r,(e=a.getContext("2d")).font=t.font}for(var u=i.split("\n"),h=0;h<u.length;h++){for(var l="",c="",f=u[h].split(" "),d=0;d<f.length;d++){var p=d<f.length-1?f[d]+" ":f[d],m=Math.max(e.measureText(f[d]).width,Math.abs(e.measureText(f[d]).actualBoundingBoxLeft)+Math.abs(e.measureText(f[d]).actualBoundingBoxRight));if(m<=n||this._checkEqual(m,n)){if(c+=p,(y=Math.max(e.measureText(c).width,Math.abs(e.measureText(c).actualBoundingBoxLeft)+Math.abs(e.measureText(c).actualBoundingBoxRight)))<=n||this._checkEqual(y,n))l=c;else s.push(l),o=(v=Math.max(e.measureText(l).width,Math.abs(e.measureText(l).actualBoundingBoxLeft)+Math.abs(e.measureText(l).actualBoundingBoxRight)))>o?v:o,l=c=c.substring(l.length)}else{if(l.length>0)s.push(l),o=(v=Math.max(e.measureText(l).width,Math.abs(e.measureText(l).actualBoundingBoxLeft)+Math.abs(e.measureText(l).actualBoundingBoxRight)))>o?v:o,c=c.substring(l.length),l="";for(var g=0;g<p.length;g++){var y;if(c+=p[g],(y=Math.max(e.measureText(c).width,Math.abs(e.measureText(c).actualBoundingBoxLeft)+Math.abs(e.measureText(c).actualBoundingBoxRight)))<=n||this._checkEqual(y,n))l=c;else s.push(l),o=(v=Math.max(e.measureText(l).width,Math.abs(e.measureText(l).actualBoundingBoxLeft)+Math.abs(e.measureText(l).actualBoundingBoxRight)))>o?v:o,l=c=c.substring(l.length)}}}var v;s.push(l),o=(v=Math.max(e.measureText(l).width,Math.abs(e.measureText(l).actualBoundingBoxLeft)+Math.abs(e.measureText(l).actualBoundingBoxRight)))>o?v:o}return{wrappedLines:s,width:o}}}}),define("DS/WebUtils/Statistics",["UWA/Class","DS/WebUtils/Profiler","DS/WebSystem/Environment","UWA/Class","DS/WebSystem/FpsInfo","DS/Controls/TreeBase","DS/Controls/TreeNodeBase","DS/WebInfraUI/DOMGraph","DS/WebUtils/MemoryProfiler","DS/WebUtils/ProbesManager"],function(t,e,i,n,r,s,o,a,u,h){"use strict";var l="";return n.extend({updateProfile:function(t){if(this.UpdateProbes){this.UpdateProbes=!1;var e=this.tree.getNthRoot(0),n=h.GetProcessedData({topWindow:"full"===i.get("3DPlay.Statistics"),cleanNames:!0,only3DPlay:"full"!==i.get("3DPlay.Statistics")});if(e._children)for(;e._children&&e._children.length;)e.removeChild(e._children[0]);for(var r=function(t,e){var i;if(t._children)for(var n=0;n<t._children.length;n++){var s=t._children[n];if(e.startTime>=s.options.probeModel.startTime&&e.startTime+e.duration<=s.options.probeModel.startTime+s.options.probeModel.duration){i=s;var o=r(s,e);o&&(i=o)}}return i},s=0;s<n.probes.length;s++){var a=n.probes[s],u=(d=a).name+": "+Math.floor(d.startTime+.5)+" | "+Math.floor(d.duration+.5),l=r(e,a);l?u+=" ("+Math.floor(.5+100*a.duration/l.options.probeModel.duration)+"%)":l=e,l.addChild(new o({label:u,probeModel:a}))}if(!document.getElementById("iframedelay")){var c="undefined"!=typeof widget&&"X3DPLAW_AP"!==widget.getValue("appId")?widget.getValue("appId"):"WAFR",f=document.createElement("div");f.id="iframedelay",f.innerHTML="Time in 3DDashBoard before Widget creation : "+Math.floor(n.iframeTime)+"<br> Time in "+c+" : "+Math.floor(n.adjustTime),this.tree.getContent().insertBefore(f,this.tree.getContent().firstChild)}e.expandAll()}var d},preProcess:function(){},postProcess:function(){var t=(new Date).getTime();if(this.frames++,this.totalFrames++,t>this.prevTime+this.updatetime){var e=Math.round(1e3*this.frames/(t-this.prevTime));this.fpsInfo.min>e?this.fpsInfo.min=e:this.fpsInfo.max<e&&(this.fpsInfo.max=e),this.fpsInfo.avg=1e3*this.totalFrames/(t-this.first),this.fpsHistory.length>this.history-1&&this.fpsHistory.shift(),this.fpsHistory.push(e);var i=Math.min(this.fpsHistory.length,this.history);this.fpsInfoHistory.clear();for(var n=0;n<i;n++){var r=this.fpsHistory[n];this.fpsInfoHistory.avg+=r,this.fpsInfoHistory.min>r?this.fpsInfoHistory.min=r:this.fpsInfoHistory.max<r&&(this.fpsInfoHistory.max=r)}this.fpsInfoHistory.avg=Math.round(this.fpsInfoHistory.avg/i),this.fpsGraph.update(e),this.frames=0,this.prevTime=t,this.hidden()||(l="FPS:"+e+" ("+this.fpsInfo.toString()+") history ("+this.fpsInfoHistory.toString()+")",this.tree.getNthRoot(0).elements.label.innerText="=> Task : Start time from 3DPlay Entry point | duration time",this.updateProfile())}},clearHistory:function(){this.fpsInfo=new r,this.fpsInfoHistory=new r;for(var t=history;t--;)this.fpsGraph.update(fps);this.fpsHistory=[],this.totalFrames=0,this.frames=0,this.startTime=(new Date).getTime(),this.prevTime=this.startTime,this.first=this.startTime,this.frameduration=this.startTime,this.frames=0,this.totalFrames=0},visibility:function(t){this.stats.style.display=t?"block":"none"},show:function(){this.visibility(!0)},hide:function(){this.visibility(!1)},hidden:function(){return"none"==this.stats.style.display},dispose:function(){this.hide(),this.fpsGraph.dispose(),this.fpsGraph=null,this.cleanDiv(),this.container=null,this.stats.empty&&this.stats.empty(),this.stats=null},cleanDiv:function(){try{this.container.removeChild(this.stats)}catch(t){}},set:function(t){this.container!=t.container&&(this.container=t.container,this.cleanDiv(),this.container.appendChild(this.stats))},init:function(t){this.UpdateProbes=!1,t=t||{},this.clearHistory(),this.updatetime=void 0!==t.updatetime?t.updatetime:200;var e=i.get("Statistics.updateTime");e&&(this.updatetime=parseInt(e)),this.historySecond=void 0!==t.historySecond?t.historySecond:50,this.history=void 0!==t.history?t.history:1e3*this.historySecond/this.updatetime,(e=i.get("Statistics.history"))&&(this.history=parseInt(e));this.stats=document.createElement("div"),this.stats.id="statistics",this.stats.style.cssText="top:25px;left:25px;position:absolute;height:100%",document.getElementById("Memory")||u({container:this.stats,length:this.history,updateTime:this.updatetime,size:1048576,updateLegend:"Mo"}),this.fpsGraph=new a({name:"FrameRate",container:this.stats,color:"0b5",length:this.history,caption:function(){return l}}),this.stats.appendChild(this.fpsGraph.getContainer()),this.tree=new s,this.tree.getContent().setStyles({minHeight:400,top:0,left:0,position:"relative",opacity:.8}),this.tree.addRoot({label:"Root"}),this.tree.inject(this.stats),this.hide();var n=this;document.addEventListener("keydown",function(t){222==t.keyCode&&(n.hidden()?n.show():n.hide())},!1),setTimeout(function(){n.show()},10),this._parent({name:"Statistics"})}})}),define("DS/WebUtils/Network",["DS/WAFData/WAFData","DS/WebUtils/ProbesManager","DS/WebUtils/Logger","DS/WebSystem/Environment"],function(t,e,i,n){"use strict";var r=i("DS/WebUtis/Network","3DPlay.Log.Network"),s={_updateOptions:function(t){t.timeout||(t.timeout=6e5)},_createContext:function(t,e,i){this._updateOptions(i);var s,o,a,u,h=n.isSet("3DPlay.Log.Network");i.onComplete=(s=i.onComplete,o=i.onStatistics,function(n){var a=this.getTime();h&&r.log(i.method,":",e," duration:",this.getTime()," data:",i.data," header:",i.headers," Response:",n),t.stats&&o&&(t.stats.time=a,o(t.stats),o=null),s(n),e=null,i=null,s=null,t=null}),i.onFailure=(a=i.onFailure,function(n){r.error(i.method,":",e," duration:",this.getTime()," data:",i.data," header:",i.headers," Response:",n),a&&a(n),e=null,i=null,a=null,t=null}),i.onCancel=function(){i.onCancel;return function(n){r.error(i.method,":",e," duration:",this.getTime()," data:",i.data," header:",i.headers," Response:",n),onCancel&&onCancel(n),e=null,i=null,onCancel=null,t=null}}(),i.onTimeout=function(e,n){var s=i.onTimeout;return function(n){r.error(i.method,":",e," duration:",this.getTime()," data:",i.data," header:",i.headers," Response:",n),s&&s(n),e=null,i=null,s=null,t=null}}(),i.onProgress=(u=i.onProgress,function(e){u&&u(e),t.stats=t.stats||{},t.stats.DownloadSize=e.total,0===t.stats.DownloadSize&&(t.stats.DownloadSize=e.loaded)})},authenticatedRequest:function(i,n,r){this._createContext({},i,n,r),e.createNetWorkProbe(r||"authenticatedRequest",n).begin(),t.authenticatedRequest(i,n)},handleRequest:function(i,n,r,s){this._createContext({},i,n),e.createNetWorkProbe(r||"handleRequest",n).begin(),s?t.handleRequest_HOOKED(i,n):t.handleRequest(i,n)},hookNetwork:function(t){this.functionHandler=t,this.hookhandleRequest()},hookhandleRequest:function(){t.handleRequest_HOOKED||(t.handleRequest_HOOKED=t.handleRequest,t.handleRequest=function(e,i){var n,r,o=s.functionHandler&&s.functionHandler(e);o?(s.functionHandler=null,o.onStatistics&&(i.onStatistics=o.onStatistics),o.onProgress&&(i.onProgress=(r=i.onProgress,function(t){r&&r(t),o.onProgress(t)})),i.onComplete=(n=i.onComplete,function(){o.onComplete(),n.apply(null,Array.prototype.slice.call(arguments)),n=null,o=null}),s.handleRequest(e,i,o.id,!0)):t.handleRequest_HOOKED(e,i)})},disableHook:function(){t.handleRequest_HOOKED&&(t.handleRequest=t.handleRequest_HOOKED,delete t.handleRequest_HOOKED)}};return s.hookhandleRequest(),s}),define("DS/WebUtils/WebServices",["DS/WebUtils/Network","DS/WebUtils/ProbesManager","DS/WebUtils/Logger","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/WebSystem/Environment"],function(t,e,i,n,r){"use strict";var s,o=i("DS/WebUtis/WebServices","3DPlay.Log.WebServices"),a={url:"/cvservlet/fetch/v2",method:"POST"},u={url:"/resources/modeler/pno/person?current=true&select=preferredcredentials&select=collabspaces",method:"GET"},h={getSecurityContext:function(e){return s||(s=new Promise(function(t){require([].concat("DS/PADUtils/PADSecurityCtxConverter"),t)})),new Promise(function(i,n){function o(){console.error(arguments)}if(!e)return o("Tenant is missing"),void n();h.getServiceUrl({serviceName:"3DSpace",platformId:e,onError:o,onSuccess:function(n){t.authenticatedRequest(n.url+u.url+"&tenant="+e,{timeout:6e6,onComplete:function(t){s.then(function(e){var n=e.prepareForStorage(JSON.parse(t));r.set("PreferredCredentials",n.securityContext),r.set("securityContext",n.cspaces),i(n.securityContext)})},onCancel:o,onFailure:o,onTimeout:o,method:u.method,headers:{Accept:"application/json","Content-Type":"application/json","Accept-Language":"en"}},"Person")}})})},getTenant:function(t){var e="OnPremise";if(t=t||widget&&widget.uwaUrl){var i=t.indexOf("-");i>-1&&(e=t.substring(t.indexOf("://")+3,i).toUpperCase())}return e},getPlatformServices:function(t){e.createNetWorkProbe("i3DXCompassPlatformServices.getPlatformServices",t).begin(),n.getPlatformServices(t)},getServiceUrl:function(t){var i=t.logger?t.logger:o;if(t.onError){if(!t.onSuccess)return i.error("onSuccess required"),void t.onError();if(!t.serviceName)return i.error("serviceName required"),void t.onError();t.onSuccess=e.createFunctionProbe("getServiceURL",t.onSuccess),n.getPlatformServices({platformId:t.platformId,onComplete:function(e){var i;if(e)if(Array.isArray(e)){for(var n={url:void 0},r=0;r<e.length;r++){var s=e[r];if(i=s[t.serviceName]){n.url=i,n.platformId=s.platformId;break}}n.url?t.onSuccess(n):t.onError({serviceName:t.serviceName})}else if(i=e[t.serviceName])t.onSuccess({url:i,platformId:t.platformId});else{if(t.platformId){var o=UWA.extend({},t);delete o.platformId,t=o}h.getServiceUrl(t)}else t.onError({serviceName:t.serviceName,error:"Compass Error"})},onFailure:function(e){i.error(e),t.onError({serviceName:t.serviceName,error:"Compass Error"})}})}else i.error("onError required")},isKindOf:function(t,e,i){this.getParentsType({physicalid:e.physicalid,tenant:e.tenant,onFailure:function(){i(!1)},onComplete:function(e){i(e&&Array.isArray(e)&&e.indexOf(t)>-1)}})},getParentsType:function(t){this.fetch({contextid:t.contextid,serverUrl:t.serverUrl,tenant:t.tenant,physicalid:[t.physicalid],select_predicate:["taxonomies"],responseType:"json",dtype:t.dtype,onFailure:t.onFailure||function(t){console.error(t)},onComplete:function(e){if(e.infos&&1===e.infos.nresults&&e.results)for(var i=e.results.length;i--;){var n=e.results[i];if(n.attributes)for(var r=n.attributes,s=r.length;s--;)if("taxonomies"===r[s].name.toLowerCase()){var o=r[s].value.split("/");o.length&&"types"===o[0]&&t.onComplete(o.slice(1))}}else"Document"===t.dtype?t.onComplete(["DOCUMENTS","Document"]):t.onFailure&&t.onFailure()}})},fetch:function(e){if(e.tenant)if(e.physicalid){var i=function(n,s){var o=n.url+a.url+"?xrequestedwith=xmlhttprequest&SecurityContext="+(s||(e.contextid?e.contextid:"preferred"));e.tenant&&(o+="&tenant="+e.tenant);var u={physicalid:e.physicalid,label:e.label||"X3DPLAW_AP-"+(new Date).getTime(),locale:"en"};e.tenant&&(u.tenant=e.tenant),e.select_predicate&&(u.select_predicate=e.select_predicate),e.select_file&&(u.select_file=e.select_file);var l={timeout:6e6,data:JSON.stringify(u),onComplete:function(t){"json"===e.responseType&&"string"==typeof t&&""!==t&&(t=JSON.parse(t)),t&&t.results?e.onComplete(t):h.getSecurityContext(e.tenant).then(function(t){r.set("PreferredCredentials",t),i(n,t)})},onCancel:e.onCancel||e.onFailure,onFailure:e.onFailure,onTimeout:e.onTimeout||e.onFailure,method:a.method,headers:{Accept:"application/json","Content-Type":"application/json","Accept-Language":"en"}};e.type&&(l.type=e.type),e.requiredAuth&&(l.authentication=e.requiredAuth),t.authenticatedRequest(o,l,"Fetch")};e.serverUrl?i({url:e.serverUrl}):this.getServiceUrl({serviceName:"3DSpace",platformId:e.tenant,onError:e.onFailure,onSuccess:i})}else e.onFailure&&e.onFailure("physicalid required");else e.onFailure&&e.onFailure("tenant required")}};return h});