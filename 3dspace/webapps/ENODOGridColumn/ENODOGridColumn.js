define("DS/ENODOGridColumn/utils/Constants",["UWA/Core","UWA/Controls/Abstract"],function(t,e){"use strict";return{EMPTY_JSON_OBJECT:{},PLATFORM_SERVICES:"platformServices",PLATFORM_ID:"platformid",SEC_CTX:"xPref_CREDENTIAL",URL_3DSPACE:"url3dspace",CADORIGIN_CATIAV5:"CATIAV5",CADORIGIN_3DEXP:"3DEXPERIENCE",STATUS_JOBFAIL:"JobFail",STATUS_UNSYNC:"Unsync",STATUS_NA:"NA",PSE_CONTEXT_REFRESH:"SyncModelRefresh"}}),define("DS/ENODOGridColumn/cmd/DOModelEvents",["DS/CoreEvents/ModelEvents"],function(t){"use strict";var e=new t;return{getModelEvents:function(){return e},publish:function(t){return e.publish(t)},subscribe:function(t,n){return e.subscribe(t,n)},unsubscribe:function(t){return e.unsubscribe(t)},unsubscribeAll:function(t){return e.unsubscribeAll(t)}}}),define("DS/ENODOGridColumn/utils/DONotification",["DS/Notifications/NotificationsManagerUXMessages","DS/Notifications/NotificationsManagerViewOnScreen"],function(t,e){"use strict";return{_notif_manager:null,init:function(n){null===this._notif_manager&&(this._notif_manager=t,e.setNotificationManager(this._notif_manager),e.setStackingPolicy(5),e.setRemoveStackOnFirstTimeoutFlag(!0),e.setFadeOutPolicy(2))},sucessMsg:function(t){this._notif_manager||this.init(),this._notif_manager.addNotif({level:"success",message:t,sticky:!1})},infoMsg:function(t){this._notif_manager||this.init(),this._notif_manager.addNotif({level:"info",message:t,sticky:!1})},warningMsg:function(t){this._notif_manager||this.init(),this._notif_manager.addNotif({level:"warning",message:t,sticky:!1})},errorMsg:function(t){this._notif_manager||this.init(),this._notif_manager.addNotif({level:"error",message:t,sticky:!1})}}}),define("DS/ENODOGridColumn/utils/SettingsManagement",["UWA/Class","DS/ENODOGridColumn/utils/Constants"],function(t,e){"use strict";return t.singleton({init:function(){this.isPlatformInitialized=!0},addSetting:function(t,e){if(!this.isPlatformInitialized)throw new Error("Platformservices not initialized");widget[t]&&console.log("Setting is already in use"),widget[t]=e},getSetting:function(t){return widget[t]||""},getPlatformURLs:function(){return this.getSetting(e.PLATFORM_SERVICES)},getPlatformId:function(){return this.getSetting(e.PLATFORM_ID)},getSecCtx:function(){var t=this.getSetting(e.SEC_CTX);return t.startsWith("ctx::")||(t="ctx::"+t),t},get3DSpaceURL:function(){return this.getSetting(e.URL_3DSPACE)},getLang:function(){return"undefined"!=typeof widget?widget.lang:"en"},getWidgetId:function(){return"undefined"!=typeof widget?widget.id:-1}})}),define("DS/ENODOGridColumn/DOWSProxy",["UWA/Core","DS/WAFData/WAFData","DS/ENODOGridColumn/utils/SettingsManagement"],function(t,e,n){let o=function(t,n,o){return new Promise(function(i,s){n.onComplete=function(t){let e=function(t){return"string"==typeof t?JSON.parse(t):t}(t),n=e;o&&(n=o(e)),i(n)},n.onFailure=function(t){s(t)},n.data&&(n.data=JSON.stringify(n.data)),function(t,n,o){let i=null;i=e.authenticatedRequest(t,n)}(t,n)})};return{getAdditionalCtxMenu:function(){let t=n.get3DSpaceURL(),e=n.getSecCtx(),i={};return t+="/resources/v1/derivedoutput/derivedoutputrules/getconversionformats",i.method="GET",i.headers={Accept:"application/json",SecurityContext:e},o(t,i)},getDOStatus:function(t){console.log("---DOStatus calling getDOStatus WS.......");let e=n.get3DSpaceURL(),i=n.getSecCtx(),s={};return e=e+"/resources/PLMDerivedOutputWSAPI/derivedoutputonIndex_services/getDOStatusForRep?tenant="+n.getPlatformId(),s.type="json",s.proxy="passport",s.method="POST",s.headers={Accept:"application/json","Content-Type":"application/json",SecurityContext:i},s.data={ids:t.ids,format:t.format,withjobs:!0},o(e,s)},getDOStatistic:function(t){console.log("---DOStatus calling getDOStatistic WS.......");let e=n.get3DSpaceURL(),i=n.getSecCtx(),s={};return e=e+"/resources/PLMDerivedOutputWSAPI/derivedoutputonIndex_services/getNodeSynchroStatistics?tenant="+n.getPlatformId(),s.type="json",s.proxy="passport",s.method="POST",s.headers={Accept:"application/json","Content-Type":"application/json",SecurityContext:i},s.data={selection:{path:t.occurrencepath,filter:t.hasOwnProperty("filter")?t.filter:{}},format:t.format},o(e,s)}}}),define("DS/ENODOGridColumn/utils/PlatformServices",["UWA/Class","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/ENODOGridColumn/utils/SettingsManagement","DS/ENODOGridColumn/utils/Constants","DS/WAFData/WAFData"],function(t,e,n,o,i){"use strict";return t.extend({initializePlatform:function(t){var i=this;e.getPlatformServices({onComplete:function(e){if(null===e){e.options=t,(0,t.onFailure)("cannot retrieve platform data")}else{var s=o.EMPTY_JSON_OBJECT,a="OnPremise";null!=widget.getValue&&(a=widget.getValue("x3dPlatformId")?widget.getValue("x3dPlatformId"):"OnPremise");for(var r=0;r<e.length;r++)e[r].platformId===a&&(i.platformurls=s.platformurls=e[r]);n.addSetting(o.PLATFORM_SERVICES,i),n.addSetting(o.PLATFORM_ID,a);let l=s.platformurls["3DSpace"];n.addSetting(o.URL_3DSPACE,l),s.options,(0,t.onComplete)(s)}},onFailure:function(e){(0,t.onFailure)(e)}})},setSecurityContext:function(){let t=n.get3DSpaceURL()+"/resources/pno/person/getsecuritycontext?tenant="+n.getPlatformId();return new Promise(function(e,s){i.authenticatedRequest(t,{headers:{Accept:"application/json","Content-Type":"application/json"},method:"GET",onComplete:function(t){var i=JSON.parse(t);if(i&&i.SecurityContext){let s=i.SecurityContext,a="";0!==s.indexOf("ctx::")&&(a="ctx::"),t=a+s,n.addSetting(o.SEC_CTX,t),e(t)}},onFailure:function(t){console.log("Get SecurityContext Error"+t),s(t)}})})},get3DSpaceURL:function(){return this.getURL("3DSpace")},getURL:function(t){return this.platformurls[t]||""}})}),define("DS/ENODOGridColumn/AdditionalColumns",["i18n!DS/ENODOGridColumn/assets/nls/ENODOStatus.json","UWA/Core","UWA/Class","DS/PADUtils/PADContext","DS/ENODOGridColumn/utils/PlatformServices","DS/ENODOGridColumn/DOWSProxy","DS/WebappsUtils/WebappsUtils","DS/ENODOGridColumn/cmd/DOModelEvents","DS/ENODOGridColumn/utils/Constants","css!DS/ENODOGridColumn/ENODOGridColumn"],function(t,e,n,o,i,s,a,r,l){"use strict";return n.singleton({_columnDataIndex:["hasDO"],_columnDefDGV:{hasDO:{dataIndex:"hasDO",alignmentValue:"center",editableFlag:!1,sortableFlag:!1,width:50,minWidth:50,visibleFlag:!1,isAdditionalColumn:!0,_selectedFormat:null,formatAndNls:null,_processedPids:null,getCellTypeRepresentation:function(t){if(t.nodeModel){let e=t.nodeModel.options.grid.hasDO;if(void 0===e||""===e)return"status_LOADING";return"status_"+e}},getCellSemantics:function(t){if(t.nodeModel){let e=t.nodeModel.options.grid.hasDO;if(void 0===e||""===e||"INTERMEDIATE"!==e)return{disabled:!0}}},getCellValueForExport:function(e){let n="";if(-1===e.rowID)n=e.cellModel;else if(e&&e.nodeModel&&e.nodeModel.options.grid&&e.nodeModel.options.grid.hasDO){let o="status_"+e.nodeModel.options.grid.hasDO,i=e.nodeModel.options.grid.hasDONewnls;n=null!=i?""+i:""+t[o]}return n},customisation:{dataIndex:"hasDO",exportable:{lock:!1,value:!1},layout:{removable:!1}}}},init:function(e){this._parent(e);var n=this;n._processedPids=[],r.subscribe({event:"updateHasDOcolumnName"},function(e){var i=o.get();if(i){var s=i.getPADTreeDocument(),a=i.options.views?i.options.views.datagridview:void 0;if(a&&!a.isColumnHidden("hasDO")){let o=n.formatAndNls.find(t=>t.format===e);n._selectedFormat!==o.format&&(n._selectedFormat=o.format,localStorage.setItem("formatForDOColumn",n._selectedFormat),a.changeColumnTitle("hasDO",t.hasDO+"["+o.nls+"]"),a.hideColumn("hasDO"),a.showColumn("hasDO"),n._processedPids.forEach(function(t){let e=s.getNodesById(t);0==e.length?n._processedPids.splice(n._processedPids.indexOf(t),1):e.forEach(function(t){t.updateOptions({grid:{hasDO:"LOADING"}})})}),n.updateAttributes({pids:n._processedPids,relids:[]},function(t){n._processedPids.forEach(function(e){null!=t.pids[e]&&s.getNodesById(e).forEach(function(n){n.updateOptions({grid:{hasDO:t.pids[e].hasDO,hasDONewnls:t.pids[e].hasDONewnls}})})})}))}}})},updateHasDoCellValue_bis:function(t){this._processedPids.forEach(function(e){if(null!=t.pids[e]){model.getNodesById(e).forEach(function(n){n.updateOptions({grid:{hasDO:t.pids[e].hasDO,hasDONewnls:t.pids[e].hasDONewnls}})})}})},isAdditionalColumnsAvailable:function(t){var e=this;if(console.log("DO status--isAdditionalColumnAvailable Enter--\x3e"),"function"!=typeof t)throw new Error("A callback function should be defined");const n=new i;new Promise(function(t,e){var o={onComplete:t,onFailure:e};n.initializePlatform(o)}).then(function(t){return n.setSecurityContext()},function(t){console.log(t)}).then(function(n){s.getAdditionalCtxMenu().then(function(n){if(console.log("WS Results->"+n),n.derivedOutputFormats.length>0){t(!0),e.formatAndNls=[];var o=localStorage.getItem("formatForDOColumn");n.derivedOutputFormats.forEach(function(t){e.formatAndNls.push({format:t.format,nls:t.formatToDisplay}),t.format===o&&(e._selectedFormat=o)}),null!==e._selectedFormat&&null!==o||(e._selectedFormat=e.formatAndNls[0].format)}else t(!1)}).catch(function(e){console.error(e),t(!1)})})},getName:function(){return"ENODOFormatStatus_Col"},_getColumnName:function(){var e=localStorage.getItem("formatForDOColumn"),n=t.hasDO+"["+this.formatAndNls[0].nls+"]";return null!==e&&this.formatAndNls.forEach(function(o){var i=o.format;console.log(i),o.format===e&&(n=t.hasDO+"["+o.nls+"]")}),n},getManagedColumnNames:function(){return this._columnDataIndex},getAutoReloadNames:function(){let t=[];return t.push("ds6w:cadMaster"),t},toBeUpdated:function(t,e){let n=!1,o=t.hasDO;return e!==l.PSE_CONTEXT_REFRESH&&void 0!==o&&""!==o||(n=!0),n},updateAttributes:function(t,e){console.log("DO Status-updateAttrs Entry--\x3e");var n=this;if("object"!=typeof t)throw new Error("The object ids to modify must be specify");if("function"!=typeof e)throw new Error("A callback function should be defined");var o={pids:{},relids:{}};t.pids.forEach(function(t){n._processedPids.includes(t)||n._processedPids.push(t),o.pids[t]={hasDO:void 0,hasDONewnls:void 0}}),null!=n._selectedFormat&&s.getDOStatus({ids:t.pids,format:n._selectedFormat}).then(function(n){console.log("DO status WS Results->"+n);let i=new Map;n.ids.forEach(function(t){let e,n=t.id;t.streams.forEach(function(t){e=t.status}),i.set(n,e)}),t.pids.forEach(function(t){let e="";i.has(t)&&(e=i.get(t)),o.pids[t]={hasDO:e}}),e(o)}).catch(function(n){console.error(n),t.pids.forEach(function(t){o.pids[t]={hasDO:"ERROR"}}),e(o)})},getAdditionalColumnsUXDGV:function(t){let n=[];for(let e=0;e<t.length;e++)n.push(t[e].dataIndex);for(let o=0;o<this._columnDataIndex.length;o++){let i=this._columnDataIndex[o],s=e.clone(this._columnDefDGV[i]),a=n.indexOf(i);-1===a?(s.text=this._getColumnName(),t.push(s)):(t[a]=e.extend(t[a],s,!0),t[a].text=this._getColumnName())}},provideDisplayTooltip:function(e){let n=null;if(e.nodeModel&&"hasDO"===e.dataIndex){let o=e.nodeModel.options.grid.hasDO;if(""!=o&&"NA"!=o){let i="status_"+o,s=e.nodeModel.options.grid.hasDONewnls;n=null!=s?""+s:""+t[i]}}return n},getTypeRepresentations:function(){return{status_SYNC:{stdTemplate:"functionIcon",semantics:{icon:{iconName:"status-ok dgv-hasDO-status-ok",fontIconFamily:WUXManagedFontIcons.Font3DS}}},status_NOTSYNC:{stdTemplate:"functionIcon",semantics:{icon:{iconName:"status-ko dgv-hasDO-status-ko",fontIconFamily:WUXManagedFontIcons.Font3DS}}},status_JOBSUBMITTED:{stdTemplate:"functionIcon",semantics:{icon:{iconName:"hourglass dgv-hasDO-hourglass",fontIconFamily:WUXManagedFontIcons.Font3DS}}},status_JOBRUNNING:{stdTemplate:"functionIcon",semantics:{icon:{iconName:"clock dgv-hasDO-clock",fontIconFamily:WUXManagedFontIcons.Font3DS}}},status_JOBFAILED:{stdTemplate:"functionIcon",semantics:{icon:{iconName:"attention dgv-hasDO-attention",fontIconFamily:WUXManagedFontIcons.Font3DS}}},status_INTERMEDIATE:{stdTemplate:"functionIcon",semantics:{icon:{iconName:"i-question",fontIconFamily:WUXManagedFontIcons.Font3DS}}},status_NA:{stdTemplate:"functionIcon",semantics:{icon:{iconName:"",fontIconFamily:WUXManagedFontIcons.Font3DS}}},status_LOADING:{stdTemplate:"functionIcon",semantics:{className:"relationRefresh",icon:{iconName:"reload wux-ui-3ds-spin dgv-hasDO-reload",fontIconFamily:WUXManagedFontIcons.Font3DS}}},status_ERROR:{stdTemplate:"functionIcon",semantics:{icon:{iconName:"attention dgv-hasDO-attention",fontIconFamily:WUXManagedFontIcons.Font3DS}}}}},getOnCellClickCB:function(n){var i=this;if(0===this._columnDataIndex.indexOf(n))return function(n){if(n.nodeModel&&"INTERMEDIATE"===n.nodeModel.options.grid.hasDO){n.nodeModel.updateOptions({grid:{hasDO:""}});var a=n.nodeModel,r=(n.nodeModel.getOccurencePath(),a.getRoot().getID()),l=o.get(),c={},u={V1:{}};if(void 0!==l.HasFilter&&"function"==typeof l.HasFilter){var d=l.HasFilter(r);if(e.is(d.hasFilter)&&!0===d.hasFilter&&e.is(l.GetFilterSpec(r,u).CVQuery)){var f=l.GetFilterSpec(r,u).CVQuery;e.is(f.union.expand)&&f.union.expand.length>0?f.union.expand[0]["q.iterative_filter_query_bo"]+=' OR [ds6w:type]:"DerivedOutputEntity"':e.is(f.union.expand3d)&&f.union.expand3d.length>0&&(f.union.expand3d[0]["q.iterative_filter_query_bo"]+=' OR [ds6w:type]:"DerivedOutputEntity"'),c=f}}s.getDOStatistic({occurrencepath:n.nodeModel.getOccurencePath(),format:i._selectedFormat,filter:c}).then(function(e){console.log("DO Statistic status WS Results->"+e);let o=e.sync_do_count,i=e.rep_count,s="SYNC";o!=i&&(s="NOTSYNC");let a=t.replace(t.nls_nonleaf,{syncDo:o,leafnumber:i});n.nodeModel.updateOptions({grid:{hasDO:s,hasDONewnls:a}}),n.cellView._updateTooltip({longHelp:a})}).catch(function(t){console.error(t)})}}},getAdditionalCtxMenu:function(e){let n,o=!1;e.ctxParams.treeview?(o=e.ctxParams.treeview.isHeader,n=e.ctxParams.treeview.dataIndex):"datagridview"===e.view&&(o=-1===e.ctxParams.cellInfos.rowID,n=e.ctxParams.collectionView.getColumnOrGroup(e.ctxParams.cellInfos.columnID).dataIndex);let i=[];if(!0===o&&"hasDO"===n){i={type:"PushItem",icon:{iconName:"list",fontIconFamily:WUXManagedFontIcons.Font3DS},title:t.select_format,submenu:[]};for(let t=0;t<this.formatAndNls.length;t++){let e=this.formatAndNls[t];i.submenu.push({type:"RadioItem",title:e.nls,state:e.format===this._selectedFormat?"selected":"",action:{context:e.format,callback:function(t){r.publish({event:"updateHasDOcolumnName",data:t.context})}}})}e.callback("cmdReqDOStatus",i)}else e.callback(null)}})});