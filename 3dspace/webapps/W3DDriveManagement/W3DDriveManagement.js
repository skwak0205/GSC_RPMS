define("DS/W3DDriveManagement/view/ShareTableLayout",["UWA/Core","UWA/Class/View","UWA/Controls/Pager","UWA/Class/Promise","DS/UIKIT/Scroller","DS/UIKIT/SuperModal","DS/UIKIT/Input/Button","DS/UIKIT/Mask","DS/WAFData/WAFData","DS/Handlebars/Handlebars","text!DS/W3DDriveManagement/template/ShareTableLayout.html","i18n!DS/W3DDriveManagement/assets/nls/W3DDriveManagement","css!DS/UIKIT/UIKIT.css"],function(e,t,n,a,i,s,r,o,c,l,u,h){"use strict";var d=new s({renderTo:document.body});return t.extend({searchString:"",lastFetchedIndex:0,paginationSize:50,pager:{},domEvents:{"click .restricted__available":"_showRestrictedEmails","click .revoke__access__icon":"_revokeAccess"},setup:function(e){var t=this;this.alert=e.alert,this.template=l.compile(u),this.listenTo(this.collection,"onChange",this.render),this.listenTo(this.collection,"onSync",this.render),this.listenTo(this.collection,"onAdd",this.render),this.listenTo(this.collection,"onRemove",this.render),this.pager=new n({limit:this.paginationSize,offset:0,type:1,showPageLinks:!0,max:this.collection.length,events:{onOffsetChange:function(e){if(t.render(),e+this.limit>=this.length){var n=t.lastFetchedIndex+1;t.fetchMoreSharedLinks({index:n}).then(function(){t.pager.length!==t.collection.length&&(t.lastFetchedIndex++,t.pager.setLength(t.collection.length),t.pager.onRefresh())})}}}})},refresh:function(){var e=this;return new a(function(t){e.collection.fetch({onComplete:function(){e.pager.setLength(e.collection.length),e.pager.onRefresh(),t()}})})},render:function(){var e=this.pager.offset;this.currentModel=this.collection;var t=this.collection.length>0;if(t&&(this.currentModel=this.collection.toJSON().slice(e,e+this.paginationSize)),this.container.innerHTML=this.template({isDataAvailable:t,links:this.currentModel,NLS:h}),this.pager.elements.container.parentNode!==this.container.parentElement.querySelector(".pager")){var n=this.container.parentElement.querySelector(".pager");if(!n)return;n.appendChild(this.pager.elements.container)}},_revokeAccess:function(e){var t=this,n=e.target.dataset.modelId,a=this.collection.findWhere({id:n});d.dialog({body:h.revokeAccessMessage,title:h.replace(h.revokeAccessFor,{name:a.get("sharedObjectName")}),buttons:[{className:"primary",value:h.revoke,action:function(e){e.hide(),a.destroy({onComplete:function(){t.alert.add({message:h.revokeAccessSuccess,className:"success"})},onFailure:function(){t.alert.add({message:h.revokeAccessError,className:"error"})},wait:!0})}},{className:"default",value:h.cancel,action:function(e){e.hide()}}]})},_showRestrictedEmails:function(e){var t=e.target.dataset.modelId,n=this.collection.findWhere({id:t}),a=document.createElement("div");0===n.get("restrictions").length?a.innerText=h.emptyRestrictions:n.get("restrictions").map(function(e){var t=document.createElement("div");t.innerText=e.mail,a.appendChild(t)}),d.dialog({body:a,title:h.replace(h.restrictionsFor,{name:n.get("sharedObjectName")}),buttons:[{className:"primary",value:h.ok,action:function(e){e.hide()}}]})},fetchMoreSharedLinks:function(e){var t=this,n=e.index;return o.mask(this.container),new a(function(e,a){if(t.collection.last)return o.unmask(t.container),e({offset:t.collection.length-t.paginationSize});n="number"==typeof n&&isNaN(n)?0:n,t.collection.fetch({page:n,remove:!1,onComplete:function(){o.unmask(t.container),e({offset:t.collection.length})},onFailure:function(){a(arguments)}})})}})}),define("DS/W3DDriveManagement/Utils/WAFDataForDriveMgt",["DS/WAFData/WAFData"],function(e){"use strict";var t,n={};return{authenticatedRequest:function(n,a){var i=Object.assign({},a);i.headers=Object.assign({},i.headers),i.headers["X-DS-CSRFTOKEN"]=t||"";var s=i.onComplete;return i.onComplete=function(e,n,a){var i=Object.keys(n).filter(function(e){return-1!==e.search(/x-ds-csrftoken/i)});t=i.length>0?n[i[0]]:t,"function"==typeof s&&s(e,n,a)},e.authenticatedRequest(n,i)},getPlatform:function(){return n},setPlatform:function(e){n=e}}}),define("DS/W3DDriveManagement/W3DDriveManagementWidget",["UWA/Array","UWA/Class/Promise","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/PlatformAPI/PlatformAPI","i18n!DS/W3DDriveManagement/assets/nls/W3DDriveManagement"],function(e,t,n,a,i){"use strict";var s,r,o=!1;function c(){return new t(function(e,t){n.getPlatformServices({onComplete:function(t){var n;t&&(n=t.filter(function(e){return e["3DDrive"]}).map(function(e){if(e){var t={tenant:e.platformId,displayName:e.displayName,url:e["3DDrive"],urlSwym:e["3DSwym"]};return e.driveshub&&(t.urlDriveshub=e.driveshub),t}})),e(n)},onFailure:t})})}function l(n){return new t(function(t,r){n||r("Unexpected error");var c={type:"list",name:"collab-storage",label:"3DEXPERIENCE Platform",options:[],onchange:"onStorageChange"},l=s.getValue("collab-storage");if(""===l){var u,h=s.getValue("x3dPlatformId");(u=e.detect(n,function(e){return e.tenant===h}))||(u=n[0]),u&&s.setValue("collab-storage",u.tenant)}else u=e.detect(n,function(e){return e.tenant===l});n.forEach(function(e){c.options.push({label:e.displayName,value:e.tenant})}),1===n.length&&u&&(c.type="hidden"),s.addPreference(c),o&&(s.dispatchEvent("onEdit",["refreshPrefs"]),u||(u=n[0])),a.subscribe("PlatformManagement.renamePlatformName",function(e){u.set("displayName",e)}),u?(s.setValue("x3dPlatformId",u.tenant),t(u)):r(i.updatePreference)})}return{init:function(t,n){var a=this;s=t,require([n],function(t){(r=new t({container:s.body})).render(),s.addEvents({onRefresh:function(){if(a.storageChange){var t=a.storageChange;delete a.storageChange,c().then(function(n){var a=e.detect(n,function(e){return e.tenant===t});s.setValue("x3dPlatformId",a.tenant),r.refresh({platform:a})}).catch(function(e){r.error(e)})}else r.refresh()},onStorageChange:function(e,t){a.storageChange=t},onEdit:function(e){if(o=!0,"refreshPrefs"!==e){s.addPreference({type:"list",name:"collab-storage",label:"3DEXPERIENCE Platform",options:[{label:"Loading",value:""}],onchange:"onStorageChange"}),s.dispatchEvent("onEdit",["refreshPrefs"]),c().then(l).catch(function(e){r.error(e)})}},endEdit:function(e){o=!1}}),c().then(l).then(function(e){r.refresh({platform:e})}).catch(function(e){r.error(i.fetchError)})})}}}),define("DS/W3DDriveManagement/Utils/Helpers",["i18n!DS/W3DDriveManagement/assets/nls/W3DDriveManagement"],function(e){"use strict";return{computeNLSSize:function(t){let n,a;t=Number(t);if(isNaN(t))throw new Error("Size input is not a number");if(t<0)throw new Error("Size input is negative");if(0===t)n=0,a=0;else{if((a=Math.floor(Math.log(t)/Math.log(1024)))>5)throw new Error("Size input is too big");const e=t/Math.pow(2,10*a),i=Math.pow(10,a>0?2:0);1024===(n=Math.round(e*i)/i)&&a<8&&(n=1,a++)}return e.replace(e[["sizeB","sizeKB","sizeMB","sizeGB","sizeTB","sizePB"][a]],{size:n})}}}),define("DS/W3DDriveManagement/Models/AccessCapacity",["UWA/Class/Model","DS/W3DDriveManagement/Utils/WAFDataForDriveMgt"],function(e,t){return e.extend({defaults:{quota:0,total:0},url:function(){return t.getPlatform().url+"/resources/share/admin/accesscapacity"},sync:function(e,n,a){var i=Object.assign({ajax:t.authenticatedRequest},a);return this._parent(e,n,i)},parse:function(e){return e}})}),define("DS/W3DDriveManagement/Models/IterationsDays",["UWA/Class/Model","DS/W3DDriveManagement/Utils/WAFDataForDriveMgt"],function(e,t){"use strict";return e.extend({defaults:{iterationsdays:0},idAttribute:"iterationsdays",url:function(){return t.getPlatform().url+"/resources/3ddrive/v1/admin/iterationsdays?tenant="+t.getPlatform().tenant},fetch:function(e){var n=Object.assign({ajax:t.authenticatedRequest},e);return this._parent(n)},parse:function(e){return e}})}),define("DS/W3DDriveManagement/view/W3DDriveManagementShare",["UWA/Core","UWA/Class/View","UWA/Class/Promise","DS/WAFData/WAFData","DS/Handlebars/Handlebars","DS/UIKIT/Mask","DS/UIKIT/Scroller","DS/W3DDriveManagement/Utils/WAFDataForDriveMgt","DS/W3DDriveManagement/view/ShareTableLayout","DS/W3DDriveManagement/Models/AccessCapacity","text!DS/W3DDriveManagement/template/W3DDriveManagementShare.html","i18n!DS/W3DDriveManagement/assets/nls/W3DDriveManagement"],function(e,t,n,a,i,s,r,o,c,l,u,h){"use strict";return t.extend({domEvents:{"change .shareaccess .toggle-switch":"_onChangeShareByLinkValue"},setup:function(e){e&&(this.alert=e.alert),this.template=i.compile(u);var t=window.parent.location.search;new URLSearchParams(t);this.sharedLinks=this.options.sharedLinks,this.shareAccess=this.options.shareAccess,this.listenTo(this.shareAccess,"onChange",this._updateSharedLinksTable),this.listenTo(this.shareAccess,"onChange",this._updateAccessCapacity),this.listenTo(this.shareAccess,"onSync",this._updateToggleShareByLink),this.accessCapacity=new l},refresh:function(){var e=this;return this._updateAccessCapacity(),n.all([this._fetchShareByLinkActivated().then(function(){!0===e.shareAccess.get("sharebylink")&&e.shareTableLayout&&e.shareTableLayout.refresh()})]).catch(function(){e.alert.add({message:h.fetchError,className:"error"})})},render:function(e){var t=this;this.buildView(e);var a=this.container.children[0];s.mask(a);var i=[this._fetchShareByLinkActivated()];return n.all(i).catch(function(){t.alert.add({message:h.fetchError,className:"error"})}).finally(function(){s.unmask(a)})},buildView:function(){this.container.innerHTML="",this.container.innerHTML=this.template({NLS:h}),this._updateSharedLinksTable(),this._updateAccessCapacity(),this._addScroller()},_addScroller:function(){var e=this.container,t=this.getElement(".share_link_content");new r({element:t}).inject(e)},_fetchShareByLinkActivated:function(){var e=this;return new n(function(t,n){e.shareAccess.fetch({onComplete:function(e,n){t(n)},onFailure:function(){n(arguments)}})})},_onChangeShareByLinkValue:function(e){var t=this,n=e.target.checked,a=!n;this.shareAccess.save({sharebylink:n},{ajax:o.authenticatedRequest,onComplete:function(e,a){var i="";i=n?h.shareByLinkActivationSuccess:h.shareByLinkDeactivationSuccess,t.alert.add({message:i,className:"success"})},onFailure:function(){var i="";(e.srcElement||e.target).checked=a,i=n?h.shareByLinkActivationError:h.shareByLinkDeactivationError,t.alert.add({message:i,className:"error"})},wait:!0})},_updateSharedLinksTable:function(){var e=this.container.querySelector(".drive__share__table");e&&(this.shareAccess.get("sharebylink")?(e.classList.remove("drive__share__table--hidden"),this.shareTableLayout?this.shareTableLayout.refresh():(this.shareTableLayout=new c({container:this.container.getElement(".drive__sharetable"),collection:this.sharedLinks,platform:o.getPlatform(),alert:this.alert}),this.shareTableLayout.refresh())):e.classList.add("drive__share__table--hidden"))},_unitRound:function(e){return e<5?5:10},_roundFunc:function(e){if("number"!=typeof e||isNaN(e))return NaN;if(e%5==0||e%10==0)return e;if(e<10)return this._unitRound(e);var t=(""+e)[0],n=(""+e)[1],a=this._unitRound(Number(n));return 10===a?10*Number(t)+10:Number(t+a)},_updateAccessCapacity:function(){var e=this;this.elements.accessCapacitySection=this.container.querySelector(".accesscapacity"),this.elements.accessCapacityProgress=this.container.querySelector(".accesscapacity__progress"),this.elements.accessCapacityProgressValue=this.container.querySelector(".accesscapacity__progress .progress-bar"),this.elements.accessCapacityUsed=this.container.querySelector(".accesscapacity__used"),this.elements.accessCapacityTotal=this.container.querySelector(".accesscapacity__total"),this.elements.accessCapacitySection&&(this.shareAccess.get("sharebylink")?(this.elements.accessCapacitySection.classList.remove("accesscapacity--hidden"),this.accessCapacity.fetch({onComplete:function(t){var n=t.get("quota"),a=t.get("total"),i=e.mathTrunc(100*n/a);e.elements.accessCapacityUsed.innerText=h.replace(h.usedCapacity,{used:e.mathTrunc(n)}),e.elements.accessCapacityTotal.innerText=h.replace(h.totalCapacity,{total:a}),e.elements.accessCapacityProgress.classList.remove("w-0-percent"),e.elements.accessCapacityProgress.classList.add("w-"+e._roundFunc(i)+"-percent"),e.elements.accessCapacityProgressValue.innerText=i+"%"},onFailure:function(){e.elements.accessCapacityProgress.classList.add("w-0-percent")}})):this.elements.accessCapacitySection.classList.add("accesscapacity--hidden"))},_toggleShareAccessTable:function(){var e=this.container.querySelector(".drive__share__table");e&&(this.shareAccess.get("sharebylink")?(e.classList.remove("drive__share__table--hidden"),this.shareTableLayout?this.shareTableLayout.refresh():(this.shareTableLayout=new c({container:this.container.getElement(".drive__sharetable"),collection:this.sharedLinks,platform:o.getPlatform(),alert:this.alert}),this.shareTableLayout.refresh())):e.classList.add("drive__share__table--hidden"))},_updateToggleShareByLink:function(){var e=this.container.querySelector(".shareaccess #checkbox-sharebylink"),t=this.container.querySelector(".shareaccess__label");e&&t&&(this.shareAccess.get("sharebylink")?e.checked=!0:e.checked=!1)},mathTrunc:function(e){return Math.trunc?Math.trunc(e):function(e){return isNaN(e)?NaN:e>0?Math.floor(e):Math.ceil(e)}(e)}})}),define("DS/W3DDriveManagement/Models/Drive",["UWA/Class/Model","DS/W3DDriveManagement/Utils/WAFDataForDriveMgt","DS/W3DDriveManagement/Utils/Helpers"],function(e,t,n){"use strict";return e.extend({defaults:{physicalid:"",email:"",fullnameowner:"",fname:"",lname:"",title:"",status:"",ownerstatus:"",usage:"",actions:[]},idAttribute:"physicalid",url:function(e){var n=this.get("physicalid")?this.get("physicalid"):e.driveid;return t.getPlatform().url+"/resources/3ddrive/v1/admin/drives/"+n+"?withactions=true&tenant="+t.getPlatform().tenant},fetch:function(e){var n=Object.assign({ajax:t.authenticatedRequest,url:this.url(e)},e);return this._parent(n)},parse:function(e,t){var a,i,s=parseInt(e.quota);return a=-1===s&&t.quota?t.quota.get("defaultquota"):s,i=e.usage<0?"-":Math.round(e.usage/(1073741824*a)*100),{physicalid:e.physicalid,email:e.email,fullnameowner:e.fullnameowner,fname:e.fname,lname:e.lname,title:e.title,status:e.status,ownerstatus:e.ownerstatus,usage:e.usage,usageNLS:e.usage<0?"-":n.computeNLSSize(e.usage),ratio:i,actions:e.actions,quota:a}},destroy:function(e){var n=Object.assign({method:"DELETE",ajax:t.authenticatedRequest},e);return this._parent(n)}})}),define("DS/W3DDriveManagement/Models/SharedLink",["UWA/Class/Model","DS/W3DDriveManagement/Utils/WAFDataForDriveMgt"],function(e,t){"use strict";return e.extend({default:{expirationDate:"",id:"",modificationDate:"",platform:{},restricted:!1,restrictions:[],service:"",sharedObjectName:"",sharer:"",sharerFullName:"",tenant:"",url:""},idAttribute:"id",url:function(){return t.getPlatform().url+"/resources/share/admin/accesses/"+this.get("id")},setup:function(e){var t=this.collection;return t&&(this.platform=t.platform),this._parent(e)},parse:function(e){return{expirationDate:new Date(e.expiration).toLocaleString(),id:e.objectid,modificationDate:new Date(e.modified).toLocaleString(),restricted:e.restricted,restrictions:e.restrictions,service:e.service,sharedObjectName:e.objectName,sharer:e.sharer,sharerFullName:e.sharerFullName,tenant:e.tenant,url:e.url}},destroy:function(e){var n=Object.assign({method:"DELETE",ajax:t.authenticatedRequest},e);return this._parent(n)}})}),define("DS/W3DDriveManagement/Models/ShareAccess",["UWA/Class/Model","DS/W3DDriveManagement/Utils/WAFDataForDriveMgt"],function(e,t){"use strict";return e.extend({defaults:{sharebylink:!1},idAttribute:"sharebylink",url:function(){return t.getPlatform().url+"/resources/3ddrive/v1/admin/sharebylink?tenant="+t.getPlatform().tenant},parse:function(e){if(e)return{sharebylink:"true"===e.sharebylink}},sync:function(e,t,n){return"update"===e&&(n.data=JSON.stringify({sharebylink:t.get("sharebylink")?"true":"false"}),n.headers={"Content-Type":"application/json"}),this._parent(e,t,n)},fetch:function(e){var n=Object.assign({ajax:t.authenticatedRequest},e);return this._parent(n)}})}),define("DS/W3DDriveManagement/view/DriveInformationLayout",["UWA/Core","UWA/Class/View","DS/UIKIT/Tooltip","DS/Handlebars/Handlebars","text!DS/W3DDriveManagement/template/DriveInformationLayout.html","DS/W3DDriveManagement/Utils/WAFDataForDriveMgt","i18n!DS/W3DDriveManagement/assets/nls/W3DDriveManagement"],function(e,t,n,a,i,s,r){"use strict";return t.extend({domEvents:{"click .fonticon-pencil.rename-drive":"_renameDrive","click .btn-rename-drive .btn-primary":"_performRenameDrive","click .btn-rename-drive .btn-default":"_cancelRenameDrive","click .fonticon-pencil.edit-quota":"_editQuota","click .btn-edit-quota .btn-primary":"_performEditQuota","click .btn-edit-quota .btn-default":"_cancelEditQuota","keyup #drive-rename input":"_onKeyUpRenameDrive","keyup .quota-input":"_onQuotaEdit","mouseup .quota-input":"_onQuotaEdit"},setup:function(e){this.template=a.compile(i),this.alert=e.alert,this.drive=e.drive,this.listenTo(this.drive,"onAnyEvent",this.render)},render:function(){var e=this.drive.toJSON();e&&(e.ownerstatus=r[e.ownerstatus]),this.container.innerHTML=this.template({drive:e,NLS:r});var t=this.container.querySelector(".information-table .fonticon.fonticon-pencil");new n({position:"right",target:t,body:r.rename})},_renameDrive:function(){var e=this.container.querySelector("#drive-rename");e.style.display="table-row",this.container.querySelector("#drive-title").style.display="none",e.querySelector("input").focus()},_editQuota:function(){var e=this.container.querySelector("#quota-edit");this.container.querySelector("#drive-quota").style.display="none",e.style.display="table-row",e.querySelector("input").focus()},_performRenameDrive:function(){var e=this,t=this.container.querySelector("#drive-rename input").value;t!==this.drive.get("title")&&e.drive.save({title:t},{ajax:s.authenticatedRequest,onComplete:function(){e.alert.add({message:r.saveSuccess,className:"success"}),e._cancelRenameDrive()},onFailure:function(){e.alert.add({message:r.saveError,className:"error"})},wait:!0})},_performEditQuota:function(){var e=this,t=parseInt(this.container.querySelector("#quota-edit input").value);t!==this.drive.get("quota")&&e.drive.save({quota:t},{ajax:s.authenticatedRequest,onComplete:function(){e.alert.add({message:r.saveSuccess,className:"success"}),e._cancelEditQuota()},onFailure:function(){e.alert.add({message:r.saveError,className:"error"})},wait:!0})},_cancelEditQuota:function(){this.container.querySelector("#quota-edit").style.display="none",this.container.querySelector("#drive-quota").style.display=""},_onKeyUpRenameDrive:function(){this.container.querySelector("#drive-rename input").value!==this.drive.get("title")?(this._enableRenameDriveButtons(),"Enter"!==event.key||this._performRenameDrive()):this._disableRenameDriveButton()},_onQuotaEdit:function(){var e=this.container.querySelector(".quota-input");parseInt(e.value)!==this.drive.get("quota")?"Enter"!==event.key?this._checkQuotaInput():this._performEditQuota():this._disableEditQuotaButtons()},_checkQuotaInput:function(){var e=this.container.querySelector(".quota-input");if(e.checkValidity())return this._enableEditQuotaButtons(),this.container.querySelector(".quota-error-message").style.display="none",void(e.style.border="");this._disableEditQuotaButtons(),e.style.border="1px solid red",this.container.querySelector(".quota-error-message").style.display="block"},_cancelRenameDrive:function(){this.container.querySelector("#drive-rename").style.display="none",this.container.querySelector("#drive-title").style.display=""},_disableRenameDriveButtons:function(){this.container.querySelector(".btn-rename-drive > .btn-primary").disabled=!0,this.container.querySelector(".btn-rename-drive > .btn-default").disabled=!0},_enableRenameDriveButtons:function(){this.container.querySelector(".btn-rename-drive > .btn-primary").disabled=!1,this.container.querySelector(".btn-rename-drive > .btn-default").disabled=!1},_disableEditQuotaButtons:function(){this.container.querySelector(".btn-edit-quota > .btn-primary").disabled=!0,this.container.querySelector(".btn-edit-quota > .btn-default").disabled=!1},_enableEditQuotaButtons:function(){this.container.querySelector(".btn-edit-quota > .btn-primary").disabled=!1,this.container.querySelector(".btn-edit-quota > .btn-default").disabled=!1},_enableRenameDriveButton:function(){this.container.querySelector(".btn-rename-drive > .btn-primary").disabled=!1},_disableRenameDriveButton:function(){this.container.querySelector(".btn-rename-drive > .btn-primary").disabled=!0}})}),define("DS/W3DDriveManagement/Models/Block",["UWA/Class/Model","DS/W3DDriveManagement/Utils/WAFDataForDriveMgt"],function(e,t){"use strict";return e.extend({defaults:{blockactions:!1},idAttribute:"blockactions",url:function(){return t.getPlatform().url+"/resources/3ddrive/v1/admin/block?tenant="+t.getPlatform().tenant},fetch:function(e){var n=Object.assign({ajax:t.authenticatedRequest},e);return this._parent(n)},parse:function(e){return e}})}),define("DS/W3DDriveManagement/Collections/SharedLinks",["UWA/Class/Collection","DS/W3DDriveManagement/Models/SharedLink","DS/W3DDriveManagement/Utils/WAFDataForDriveMgt"],function(e,t,n){"use strict";return e.extend({model:t,default:{last:!1,first:!0},url:function(e){var t=e||{},a="limit=",i="&page=";return n.getPlatform().url+"/resources/share/admin/accesses?"+(a+=t.limit?t.limit:51)+(i+=t.page?t.page:0)},fetch:function(e){var t=Object.assign({ajax:n.authenticatedRequest,url:this.url(e)},e);return this._parent(t)},parse:function(e){return Object.assign(this,{last:e.last,first:e.first}),e.content}})}),define("DS/W3DDriveManagement/Collections/Drives",["UWA/Class/Collection","DS/W3DDriveManagement/Utils/WAFDataForDriveMgt","DS/W3DDriveManagement/Models/Drive"],function(e,t,n){"use strict";return e.extend({model:n,date:"",total:0,url:function(){return t.getPlatform().url+"/resources/3ddrive/v1/admin/drives?tenant="+t.getPlatform().tenant+"&"+(new Date).getTime()},fetch:function(e){var n=Object.assign({ajax:t.authenticatedRequest},e);return this._parent(n)},parse:function(e){return this.total=e.total,e.items}})}),define("DS/W3DDriveManagement/Models/ActiveExtDrive",["UWA/Class/Model","DS/W3DDriveManagement/Utils/WAFDataForDriveMgt"],function(e,t){"use strict";return e.extend({defaults:{externaldrives:"box,dropbox,google,onedrive"},idAttribute:"externaldrives",url:function(){return t.getPlatform().url+"/resources/3ddrive/v1/admin/config?tenant="+t.getPlatform().tenant},fetch:function(e){var n=Object.assign({ajax:t.authenticatedRequest},e);return this._parent(n)},parse:function(e){return e}})}),define("DS/W3DDriveManagement/Models/Quota",["UWA/Class/Model","DS/W3DDriveManagement/Utils/WAFDataForDriveMgt"],function(e,t){"use strict";return e.extend({defaults:{defaultquota:0,quota:0},idAttribute:"defaultquota",url:function(){return t.getPlatform().url+"/resources/3ddrive/v1/admin/quota?tenant="+t.getPlatform().tenant},fetch:function(e){var n=Object.assign({ajax:t.authenticatedRequest},e);return this._parent(n)},parse:function(e){return e.defaultquota=parseInt(e.defaultquota),e}})}),define("DS/W3DDriveManagement/Models/IterationsNumber",["UWA/Class/Model","DS/W3DDriveManagement/Utils/WAFDataForDriveMgt"],function(e,t){"use strict";return e.extend({defaults:{iterationsnumber:0},idAttribute:"iterationsnumber",url:function(){return t.getPlatform().url+"/resources/3ddrive/v1/admin/iterationsnumber?tenant="+t.getPlatform().tenant},fetch:function(e){var n=Object.assign({ajax:t.authenticatedRequest},e);return this._parent(n)},parse:function(e){return e}})}),define("DS/W3DDriveManagement/Models/Access",["UWA/Class/Model","DS/W3DDriveManagement/Utils/WAFDataForDriveMgt"],function(e,t){"use strict";return e.extend({default:{id:"",login:"",name:"",fname:"",lname:"",email:"",accessright:"",actions:[]},idAttribute:"id",url:function(e){var n=e||{},a=t.getPlatform().url+"/resources/3ddrive/v1/admin/drives/"+n.driveid+"/shares";"delete"===n.action&&(a+="/"+n.userid);return a+"?withactions=true"},parse:function(e){var n,a=(n=e.id,t.getPlatform().urlSwym+"/api/user/getpicture/login/"+n+"/format/normal");return Object.assign(e,{picture:a})},save:function(e,n){var a=Object.assign({ajax:t.authenticatedRequest,url:this.url(Object.assign(n,{userid:this.get("userid")})),headers:{"Content-Type":"application/json"},method:"POST"},n);a.data=JSON.stringify(n.data),this._parent(this,a)},destroy:function(e){var n=Object.assign({method:"DELETE",ajax:t.authenticatedRequest,url:this.url(Object.assign(e,{action:"delete"}))},e);return this._parent(n)}})}),define("DS/W3DDriveManagement/view/W3DDriveManagementSettings",["UWA/Core","UWA/Class/View","UWA/Class/Promise","DS/WAFData/WAFData","DS/Handlebars/Handlebars","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/UIKIT/Mask","DS/UIKIT/Scroller","DS/UIKIT/Tooltip","DS/W3DDriveManagement/Utils/WAFDataForDriveMgt","DS/W3DDriveManagement/Models/AccessCapacity","DS/W3DDriveManagement/Models/IterationsDays","DS/W3DDriveManagement/Models/IterationsNumber","DS/W3DDriveManagement/Models/Block","DS/W3DDriveManagement/Models/ActiveExtDrive","text!DS/W3DDriveManagement/template/W3DDriveManagementSettings.html","i18n!DS/W3DDriveManagement/assets/nls/W3DDriveManagement"],function(e,t,n,a,i,s,r,o,c,l,u,h,d,m,v,f,g){"use strict";return t.extend({domEvents:{"change .blockactions .toggle-switch":"_onChangeBlockActionsValue","change .external-drive .toggle-switch":"_onChangeExternalDrive","click .save-button-quota":"_saveQuota","click .cancel-button-quota":"_cancelQuota","keyup .quota-input":"_onKeyupQuotas","click .iterations-number .save-button":"_saveIterationsNumber","click .iterations-number .cancel-button":"_cancelIterationsNumber","keyup .iterations-number input":"_onKeyupIterationsNumber","click .iterations-days .save-button":"_saveIterationsDays","click .iterations-days .cancel-button":"_cancelIterationsDays","keyup .iterations-days input":"_onKeyupIterationsDays"},setup:function(e){var t=this;e&&(this.alert=e.alert),this.template=i.compile(f),"ifCond"in i.helpers||i.registerHelper("ifCond",function(e,t,n,a){switch(t){case"==":return e==n?a.fn(this):a.inverse(this);case"===":return e===n?a.fn(this):a.inverse(this);case"!=":return e!=n?a.fn(this):a.inverse(this);case"!==":return e!==n?a.fn(this):a.inverse(this);case"<":return e<n?a.fn(this):a.inverse(this);case"<=":return e<=n?a.fn(this):a.inverse(this);case">":return e>n?a.fn(this):a.inverse(this);case">=":return e>=n?a.fn(this):a.inverse(this);case"&&":return e&&n?a.fn(this):a.inverse(this);case"||":return e||n?a.fn(this):a.inverse(this);default:return a.inverse(this)}});var n=window.parent.location.search;"false"===new URLSearchParams(n).get("blockactions")&&(this.hideBlockactions=!0),this.block=new m,this.driveProviders=this.options.driveProviders,this.providers=[],this.activeExtDrive=new v,this.activeDrives=[],this.iterationsDays=new h,this.iterationsNumber=new d,this.listenTo(this.model,"onChange",this._updateQuota),this.listenTo(this.iterationsDays,"onSync",this._updateIterationsDays),this.listenTo(this.iterationsNumber,"onSync",this._updateIterationsNumber),this.accessCapacity=new u,this._fetchDriveProviders().finally(function(){t.render()})},refresh:function(){var e=this;return n.all([this._fetchIterationsDays(),this._fetchIterationsNumber(),this._fetchActiveExtDrives()]).catch(function(){e.alert.add({message:g.fetchError,className:"error"})})},render:function(e){var t=this;this.buildView(e);var a=this.container.children[0];r.mask(a),new c({target:t.container.querySelector(".blockactions .fonticon-info"),body:'<span style="display:block;text-align:left">'+g.restrictedActions+'</span><span style="display:block;font-weight:bold">'+g.restrictedActionsList+"</span>",position:"bottom",trigger:"touch",autoHide:!1});var i=[this._fetchIterationsDays(),this._fetchIterationsNumber()];return this.hideBlockactions?this.container.querySelector(".blockactions").classList.add("hidden"):i.push(this._fetchBlockActions()),n.all(i).catch(function(){t.alert.add({message:g.fetchError,className:"error"})}).finally(function(){r.unmask(a)})},buildView:function(){this.container.innerHTML="",this.container.innerHTML=this.template({driveProviders:this.providers,providersLength:this.providers.length,NLS:g}),this._buildQuotaView(),this._buildIterationsView(),this._addScroller(),this._fetchActiveExtDrives()},_addScroller:function(){var e=this.container,t=this.getElement(".drive__management__settings__content");new o({element:t}).inject(e)},_buildQuotaView:function(){var e=this.container.querySelector.bind(this.container);this.elements.quota={buttonCancel:e(".cancel-button-quota"),buttonValidation:e(".save-button-quota"),input:e(".quota-input")},this._updateQuota()},_buildIterationsView:function(){var e=this.container.querySelector.bind(this.container);this.elements.iterationsNumber={buttonCancel:e(".iterations-number .cancel-button"),buttonValidation:e(".iterations-number .save-button"),input:e(".iterations-number input")};this.elements.iterationsDays={buttonCancel:e(".iterations-days .cancel-button"),buttonValidation:e(".iterations-days .save-button"),input:e(".iterations-days input")}},_cancelIterationsNumber:function(){this._disableButtonsIterationsNumber(),this.elements.iterationsNumber.input.value=this.iterationsNumber.get("iterationsnumber")},_disableButtonsIterationsNumber:function(){this.elements.iterationsNumber.buttonCancel.disabled=!0,this.elements.iterationsNumber.buttonValidation.disabled=!0},_disableButtonValidationIterationsNumber:function(){this.elements.iterationsNumber.buttonValidation.disabled=!0},_enableButtonValidationIterationsNumber:function(){this.elements.iterationsNumber.buttonValidation.disabled=!1},_fetchIterationsNumber:function(){var e=this;return new n(function(t,n){e.iterationsNumber.fetch({onComplete:function(e,n){t(n)},onFailure:function(){n(arguments)}})})},_onKeyupIterationsNumber:function(e){this.elements.iterationsNumber.input.value!==this.iterationsNumber.get("iterationsnumber")?"Enter"!==e.key?(this.elements.iterationsNumber.buttonCancel.disabled=!1,this.elements.iterationsNumber.input.checkValidity()?this._enableButtonValidationIterationsNumber():this._disableButtonValidationIterationsNumber()):this._saveIterationsNumber():this._disableButtonsIterationsNumber()},_saveIterationsNumber:function(){var e=this,t=this.elements.iterationsNumber.input,n=t.value;!1!==t.checkValidity()?(this._disableButtonsIterationsNumber(),this.iterationsNumber.save({iterationsnumber:n},{ajax:l.authenticatedRequest,onComplete:function(){e.alert.add({message:g.saveSuccess,className:"success"})},onFailure:function(){e.alert.add({message:g.saveError,className:"error"}),t.value=e.iterationsNumber.get("iterationsnumber")},wait:!0})):this.alert.add({message:g.iterationsWrongValue,className:"error"})},_updateIterationsNumber:function(){this.elements.iterationsNumber.input.value=this.iterationsNumber.get("iterationsnumber")},_cancelIterationsDays:function(){this._disableButtonsIterationsDays(),this.elements.iterationsDays.input.value=this.iterationsDays.get("iterationsdays")},_disableButtonsIterationsDays:function(){this.elements.iterationsDays.buttonCancel.disabled=!0,this.elements.iterationsDays.buttonValidation.disabled=!0},_disableButtonValidationIterationsDays:function(){this.elements.iterationsDays.buttonValidation.disabled=!0},_enableButtonValidationIterationsDays:function(){this.elements.iterationsDays.buttonValidation.disabled=!1},_fetchIterationsDays:function(){var e=this;return new n(function(t,n){e.iterationsDays.fetch({onComplete:function(e,n){t(n)},onFailure:function(){n(arguments)}})})},_onKeyupIterationsDays:function(e){this.elements.iterationsDays.input.value!==this.iterationsDays.get("iterationsdays")?"Enter"!==e.key?(this.elements.iterationsDays.buttonCancel.disabled=!1,this.elements.iterationsDays.input.checkValidity()?this._enableButtonValidationIterationsDays():this._disableButtonValidationIterationsDays()):this._saveIterationsDays():this._disableButtonsIterationsDays()},_saveIterationsDays:function(){var e=this,t=this.elements.iterationsDays.input,n=t.value;!1!==t.checkValidity()?(this._disableButtonsIterationsDays(),this.iterationsDays.save({iterationsdays:n},{ajax:l.authenticatedRequest,onComplete:function(){e.alert.add({message:g.saveSuccess,className:"success"})},onFailure:function(){e.alert.add({message:g.saveError,className:"error"}),t.value=e.iterationsDays.get("iterationsdays")},wait:!0})):this.alert.add({message:g.iterationsWrongValue,className:"error"})},_updateIterationsDays:function(){this.elements.iterationsDays.input.value=this.iterationsDays.get("iterationsdays")},_fetchBlockActions:function(){var e=this;return new n(function(t,n){e.block.fetch({onComplete:function(n,a){e._updateToggleBlockActions(),t(a)},onFailure:function(){n(arguments)}})})},_onChangeBlockActionsValue:function(e){var t=this,n=e.target.checked,a=!n;this.block.save({blockactions:String(n)},{ajax:l.authenticatedRequest,onComplete:function(e,a){var i="";i=n?g.blockActionsActivationSuccess:g.blockActionsDeactivationSuccess,t._updateToggleBlockActions(),t.alert.add({message:i,className:"success"})},onFailure:function(){var i="";(e.srcElement||e.target).checked=a,i=n?g.blockActionsActivationError:g.blockActionsDeactivationError,t.alert.add({message:i,className:"error"})},wait:!0})},_unitRound:function(e){return e<5?5:10},_roundFunc:function(e){if("number"!=typeof e||isNaN(e))return NaN;if(e%5==0||e%10==0)return e;if(e<10)return this._unitRound(e);var t=(""+e)[0],n=(""+e)[1],a=this._unitRound(Number(n));return 10===a?10*Number(t)+10:Number(t+a)},_updateToggleBlockActions:function(){var e=this.container.querySelector(".blockactions #checkbox-limitActions"),t=this.container.querySelector(".blockActions__label");e&&t&&("true"!==this.block.get("blockactions")?e.checked=!1:e.checked=!0)},_cancelQuota:function(){this._disableButtonsQuota(),this.elements.quota.input.value=this.model.get("defaultquota")},_disableButtonsQuota:function(){this.elements.quota.buttonCancel.disabled=!0,this.elements.quota.buttonValidation.disabled=!0},_disableButtonValidationQuota:function(){this.elements.quota.buttonValidation.disabled=!0},_enableButtonValidationQuota:function(){this.elements.quota.buttonValidation.disabled=!1},_onKeyupQuotas:function(e){this.elements.quota.input.value!==this.model.get("defaultquota")?"Enter"!==e.key?(this.elements.quota.buttonCancel.disabled=!1,this.elements.quota.input.checkValidity()?this._enableButtonValidationQuota():this._disableButtonValidationQuota()):this._saveQuota():this._disableButtonsQuota()},_saveQuota:function(){var e=this,t=this.elements.quota.input.value,n=this.model.get("defaultquota");!1!==this.elements.quota.input.checkValidity()?(this._disableButtonsQuota(),this.model.save({defaultquota:t},{ajax:l.authenticatedRequest,onComplete:function(){e.alert.add({message:g.saveSuccess,className:"success"})},onFailure:function(){e.alert.add({message:g.saveError,className:"error"}),e.elements.quota.input.value=n},wait:!0})):this.alert.add({message:g.quotaWrongValue,className:"error"})},_updateQuota:function(){this.elements.quota.input.value=this.model.get("defaultquota")},_updateActiveDrives:function(){if(this.activeDrives.length&&this.container.querySelector(".external-drive-container.settings-section .toggle-switch"))for(const e in this.activeDrives)this.container.querySelector(`.external-drive-container.settings-section .toggle-switch #${this.activeDrives[e]}`).checked=!0},_fetchDriveProviders:function(){var e=this;return new n(function(t,n){e.driveProviders.fetch({onComplete:function(n,a){e.providers=a.filter(function(e){return"3ddrive"!==e.driveId}),t()},onFailure:function(){n(arguments)}})})},_fetchActiveExtDrives:function(){var e=this;return new n(function(t,n){e.activeExtDrive.fetch({onComplete:function(n,a){var i=a.externaldrives;i.length>1&&(e.activeDrives=i.split(","),e._updateActiveDrives()),t(a)},onFailure:function(){n(arguments[1])}})})},_onChangeExternalDrive:function(e){var t,n=this,a=e.target.checked,i=e.target.id;a?n.activeDrives.push(i):n.activeDrives.splice(n.activeDrives.indexOf(i),1),t=n.activeDrives.length?n.activeDrives.join():" ",this.activeExtDrive.save({externaldrives:String(t)},{ajax:l.authenticatedRequest,onComplete:function(e,t){var i="";i=a?g.externalDriveActivationSuccess:g.externalDriveDeactivationSuccess,n._updateActiveDrives(),n.alert.add({message:i,className:"success"})},onFailure:function(){var t="";(e.srcElement||e.target).checked=!a,t=a?g.externalDriveActivationError:g.externalDriveDeactivationError,n.alert.add({message:t,className:"error"})},wait:!0})},mathTrunc:function(e){return Math.trunc?Math.trunc(e):function(e){return isNaN(e)?NaN:e>0?Math.floor(e):Math.ceil(e)}(e)}})}),define("DS/W3DDriveManagement/Collections/Accesses",["UWA/String","UWA/Class/Collection","DS/W3DDriveManagement/Models/Access","DS/W3DDriveManagement/Utils/WAFDataForDriveMgt"],function(e,t,n,a){"use strict";return t.extend({model:n,url:function(t){var n=t||{};return e.format("{0}/resources/3ddrive/v1/admin/drives/{1}/shares?withactions=true&tenant={2}",a.getPlatform().url,n.driveid,a.getPlatform().tenant)},fetch:function(e){var t=Object.assign({ajax:a.authenticatedRequest,url:this.url(e)},e);return this._parent(t)},parse:function(e){return e.items},create:function(e,t){var n=Object.assign({data:e},t);return this._parent(this,n)}})}),define("DS/W3DDriveManagement/Models/DriveProvider",["UWA/Class/Model","DS/W3DDriveManagement/Utils/WAFDataForDriveMgt","DS/W3DDriveManagement/Utils/Helpers"],function(e,t,n){"use strict";return e.extend({defaults:{driveName:"",driveId:"",driveIcon:""},url:function(e){},fetch:function(e){var n=Object.assign({ajax:t.authenticatedRequest,url:this.url(e)},e);return this._parent(n)},parse:function(e,t){return{driveName:e.driveName,driveId:e.driveId,driveIcon:e.driveIcon}},destroy:function(e){var n=Object.assign({method:"DELETE",ajax:t.authenticatedRequest},e);return this._parent(n)}})}),define("DS/W3DDriveManagement/view/DriveAccessLayout",["UWA/Core","UWA/String","UWA/Class/View","DS/UIKIT/Scroller","DS/UIKIT/DropdownMenu","DS/UIKIT/Tooltip","DS/Handlebars/Handlebars","DS/W3DDriveManagement/Utils/WAFDataForDriveMgt","DS/WAFData/WAFData","DS/W3DXComponents/Views/Item/PanelAddMemberView","DS/W3DDriveManagement/Collections/Accesses","text!DS/W3DDriveManagement/template/DriveAccessLayout.html","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","i18n!DS/W3DDriveManagement/assets/nls/W3DDriveManagement"],function(e,t,n,a,i,s,r,o,c,l,u,h,d,m){"use strict";return n.extend({domEvents:{"click .fonticon-user-add":"_addAccess","click .paneladdmember-item-view-buttons .btn-default":"_cancelShare","click .fonticon-open-down":"_manageOptions"},setup:function(e){this.template=r.compile(h),this.alert=e.alert,this.drive=e.drive,this.accesses=new u,this.listenTo(this.accesses,"onAnyEvent",this.render),this._fetchAccesses(),this.tenant=o.getPlatform().tenant},render:function(){var e=this.drive.toJSON();this.currentCollection=this.accesses;var t=this.accesses.length>0;t&&(this.currentCollection=this.currentCollection.toJSON(),this.currentCollection.forEach(function(e){e.accessright=m[e.accessright]})),this.container.innerHTML=this.template({drive:e,hasAccesses:t,accesses:this.currentCollection,NLS:m});var n=this.container.querySelector(".access-view > .fonticon.fonticon-user-add");new s({position:"right",target:n,body:m.share}),this._addPanelMemberView();var i=this.getElement(".access-scroller-view"),r=this.getElement(".members-list");new a({element:r}).inject(i)},_fetchAccesses:function(){var e=this;return new Promise(function(t,n){e.accesses.fetch({driveid:e.drive.get("physicalid"),onComplete:function(e,n){t(n)},onFailure:function(){n(arguments)}})})},_get3DSearchURL:function(){var e=this;return new Promise(function(t,n){d.getPlatformServices({onComplete:function(a){var i=a.filter(function(t){return t.platformId===e.tenant});0!=i.length?t(i.map(function(e){return e["3DSearch"]})):n("3DSearch url not found")},onFailure:n})})},_addPanelMemberView:function(){var e,n,a=this,i={categories:[{id:"giveEditAccess",name:m.edit_share}],suggestFormat:"{label}",suggestKey:"resourceid",labelFormat:"{label}",placeholder:m.get("enterName"),typeDelay:500,minLength:2,getSuggestions:function(t,n,a){if(e=function(){Object.keys(n).map(function(e){delete n[e]})},!t)return;if(n[t])return a(n[t]);s(t).then(a,function(){})},saveProcess:function(e){var e=e;"My Files"===a.drive.get("title")&&a.drive.save({title:a.drive.get("fullnameowner")+"'s files"},{ajax:o.authenticatedRequest,onComplete:function(){},onFailure:function(){a.alert.add({message:m.saveError,className:"error"})},wait:!0});return e.map(function(e){a.accesses.create({id:e.item.resourceid,type:"Person",accessright:"edit_share",message:""},{driveid:a.drive.get("physicalid"),ajax:o.authenticatedRequest,onComplete:function(){a.alert.add({message:m.replace(m.shareSuccess,{drive:a.drive.get("title")}),className:"success"})},onFailure:function(){a.alert.add({message:m.replace(m.shareError,{drive:a.drive.get("title")}),className:"error"})},wait:!0})})}},s=function(e){return n&&(n.cancel(),n=null),a._get3DSearchURL().then(function(n){return new Promise(function(i,s){var r=t.format("{0}/search",n),o=Date.now(),l=JSON.stringify({query:'[ds6w:type]:"pno:Person" AND personOrGroup:('+e.trim()+") AND ut_state:1",source:["swym"],order_by:"desc",order_field:"relevance",select_predicate:["ds6w:label","resourceid","ds6w:resourceUid"],nresults:8,tenant:a.tenant,label:"DrivesControlCenter-"+o,with_synthesis:!1,with_synthesis_attribute:!1});c.authenticatedRequest(r,{method:"POST",type:"json",headers:{Accept:"application/json","Content-Type":"application/json"},data:l,onComplete:function(e){var t=[];e.hasOwnProperty("results")&&(t=e.results.filter(function(e){return e.hasOwnProperty("attributes")}).map(function(e){return e.attributes.filter(function(e){return e.hasOwnProperty("format")&&e.hasOwnProperty("name")&&e.hasOwnProperty("value")}).map(function(e){return-1!==e.name.indexOf("ds6w:")&&(e.name=e.name.split("ds6w:")[e.name.split("ds6w:").length-1]),"resourceid"===e.name&&(e.value=e.value.split("iam:")[e.value.split("iam:").length-1]),e}).filter(function(e){return"resourceid"===e.name||"label"===e.name}).reduce(function(e,t){return e[t.name]=t.value,e},{})}).filter(function(e){return e.resourceid!==a.drive.get("fullnameowner")})),i(t)},onFailure:s})})})},r=new l(Object.assign(i,{})),u=r.container.querySelector("button.btn-primary"),h=r.container.querySelector("button.btn-default");u.textContent=m.share,h.textContent=m.cancel;var d=r.render.apply(r,arguments);return r.show(),a.container.getElement("#access-members").appendChild(r.container),r.destroy=function(){return"function"==typeof e&&e(),destroy.apply(this,arguments)},d},_addAccess:function(){this.container.querySelector(".paneladdmember-item-view-container").addClassName("expanded"),this.container.querySelector("#access-members").style.display="initial",this.container.querySelector(".access-scroller-view").addClassName("expanded"),this.container.querySelector(".paneladdmember-item-view-body input").focus()},_cancelShare:function(){this.container.querySelector("#access-members").style.display="none",this.container.querySelector(".access-scroller-view").removeClassName("expanded")},_manageOptions:function(e){var t=this,n=e.target,a=n.dataset.modelId,s=this.accesses.findWhere({id:a}),r=new i({target:n,renderTo:n.parentNode,position:"bottom right",items:[{text:m.remove,fonticon:"cancel",handler:function(){t._removeAccess(s)}}],events:{onHide:function(){r.destroy()}}}).show()},_removeAccess:function(e){var t=this;e.destroy({driveid:t.drive.get("physicalid"),userid:e.get("physicalid"),onComplete:function(){t.alert.add({message:m.replace(m.shareRemoveSuccess,{username:e.get("title")}),className:"success"})},onFailure:function(){t.alert.add({message:m.replace(m.shareRemoveError,{username:e.get("title")}),className:"error"})},wait:!0})}})}),define("DS/W3DDriveManagement/Collections/DriveProviders",["UWA/Class/Collection","DS/W3DDriveManagement/Utils/WAFDataForDriveMgt","DS/W3DDriveManagement/Models/DriveProvider"],function(e,t,n){"use strict";return e.extend({model:n,date:"",total:0,url:function(){return t.getPlatform().urlDriveshub+"/drive/v1/providers?tenant="+t.getPlatform().tenant+"&expand=true"},fetch:function(e){var n=Object.assign({ajax:t.authenticatedRequest},e);return this._parent(n)},parse:function(e){return e}})}),define("DS/W3DDriveManagement/view/DriveManager",["UWA/Core","UWA/Class/View","DS/Handlebars/Handlebars","DS/UIKIT/SuperModal","DS/W3DDriveManagement/view/DriveInformationLayout","DS/W3DDriveManagement/view/DriveAccessLayout","text!DS/W3DDriveManagement/template/DriveManager.html","i18n!DS/W3DDriveManagement/assets/nls/W3DDriveManagement"],function(e,t,n,a,i,s,r,o){"use strict";return t.extend({domEvents:{"click .information":"_renderInformationView","click .access":"_renderAccessView"},classes:{informationTab:"information",accessTab:"access",informationView:"drive-manager-information",accessView:"drive-manager-access",active:"active"},dotClasses:function(e){return"."+this.classes[e]},setup:function(e){this.template=n.compile(r),this.alert=e.alert,this.drive=e.drive,this.listenTo(this.drive,"onSync",this._renderInformationView)},render:function(){this.container.innerHTML=this.template({NLS:o}),new a({renderTo:document.body}).dialog({title:o.replace(o.manageDriveTitle,{username:this.drive.get("fullnameowner")}),body:this.container}),this._renderInformationView()},_renderInformationView:function(){this.informationView||(this.informationView=new i({alert:this.alert,container:this.container.getElement(this.dotClasses("informationView")),drive:this.drive}),this.informationView.render()),this.container.getElement(this.dotClasses("accessView")).removeClassName(this.classes.active),this.container.getElement(this.dotClasses("informationView")).addClassName(this.classes.active),this.container.getElement(this.dotClasses("accessTab")).removeClassName(this.classes.active),this.container.getElement(this.dotClasses("informationTab")).addClassName(this.classes.active)},_renderAccessView:function(){this.accessView||(this.accessView=new s({alert:this.alert,container:this.container.getElement(this.dotClasses("accessView")),drive:this.drive}),this.accessView.render()),this.container.getElement(this.dotClasses("informationView")).removeClassName(this.classes.active),this.container.getElement(this.dotClasses("accessView")).addClassName(this.classes.active),this.container.getElement(this.dotClasses("informationTab")).removeClassName(this.classes.active),this.container.getElement(this.dotClasses("accessTab")).addClassName(this.classes.active)}})}),define("DS/W3DDriveManagement/view/TableLayout",["UWA/Core","UWA/Class/View","DS/UIKIT/Scroller","DS/Handlebars/Handlebars","DS/UIKIT/SuperModal","DS/W3DDriveManagement/view/DriveManager","text!DS/W3DDriveManagement/template/TableLayout.html","i18n!DS/W3DDriveManagement/assets/nls/W3DDriveManagement"],function(e,t,n,a,i,s,r,o){"use strict";return t.extend({searchString:"",domEvents:{"click .sortable.fonticon":"_sort","click .fonticon.action":"_manageOptions"},setup:function(e){this.alert=e.alert,this.template=a.compile(r),this.quota=e.quota,"ifCond"in a.helpers||a.registerHelper("ifCond",function(e,t,n,a){switch(t){case"==":return e==n?a.fn(this):a.inverse(this);case"===":return e===n?a.fn(this):a.inverse(this);case"!=":return e!=n?a.fn(this):a.inverse(this);case"!==":return e!==n?a.fn(this):a.inverse(this);case"<":return e<n?a.fn(this):a.inverse(this);case"<=":return e<=n?a.fn(this):a.inverse(this);case">":return e>n?a.fn(this):a.inverse(this);case">=":return e>=n?a.fn(this):a.inverse(this);case"&&":return e&&n?a.fn(this):a.inverse(this);case"||":return e||n?a.fn(this):a.inverse(this);default:return a.inverse(this)}})},render:function(){this.currentModel=this.collection.toJSON(),this.container.innerHTML=this.template({users:this.currentModel,NLS:o});var e=this.options.pager;if(e){if(null==this.container.parentElement)return;var t=this.container.parentElement.querySelector(".pager");e.limit<e.length&&t.appendChild(e.elements.container)}var a=this.container,i=this.getElement(".table-layout");if(new n({element:i}).inject(a),this.options.activeSortClassname&&""!==this.options.activeSortClassname){var s=this.container.getElementsByClassName(this.options.activeSortClassname)[0];"up"===this.options.sortState?s.classList.add("active"):"down"===this.options.sortState&&(s.classList.add("fonticon-expand-down"),s.classList.remove("fonticon-expand-up"),s.classList.add("active"))}},_sort:function(e){var t,n,a=e.target.classList,i="sortable fonticon fonticon-clickable ";a.contains("fname")?t="fname":a.contains("lname")?t="lname":a.contains("ownerstatus")&&(t="ownerstatus"),i+=t,a.contains("fonticon-expand-down")&&(t="a"+t,n="up"),a.contains("fonticon-expand-up")&&(t="d"+t,n="down"),this.dispatchEvent("onSort",{sortAttribute:t,activeSortClassname:i,sortState:n})},_manageOptions:function(e){var t=e.target,n=t.dataset.modelId,a=this.collection.findWhere({physicalid:n});t.className.includes("fonticon-cog")&&this._manageDrive(a),t.className.includes("fonticon-trash")&&"active"!==a.get("ownerstatus")&&this._deleteDrive(a)},_manageDrive:function(e){this.listenTo(e,"onSync",this.render);e&&(this.driveManager=new s({drive:e,alert:this.alert}),this.driveManager.render())},_deleteDrive:function(e){var t=this;new i({className:"delete-drive",renderTo:document.body}).dialog({title:o.replace(o.deleteDriveTitle,{username:e.get("fullnameowner")}),body:o.deleteDriveMessage,buttons:[{className:"primary",value:o.deleteText,action:function(n){n.hide(),e.destroy({driveid:e.get("physicalid"),onComplete:function(){t.alert.add({message:o.replace(o.deleteDriveSuccess,{username:e.get("fullnameowner")}),className:"success"}),t.dispatchEvent("onDelete")},onFailure:function(){t.alert.add({message:o.replace(o.deleteDriveError,{username:e.get("fullnameowner")}),className:"error"})},wait:!0})}},{className:"default",value:o.cancel,action:function(e){e.hide()}}]})}})}),define("DS/W3DDriveManagement/view/W3DDriveManagementDrives",["UWA/Core","UWA/Class/View","DS/Handlebars/Handlebars","UWA/Controls/Pager","DS/UIKIT/Dropdown","DS/UIKIT/DropdownMenu","DS/UIKIT/Badge","DS/UIKIT/Mask","DS/W3DDriveManagement/view/TableLayout","DS/W3DDriveManagement/Collections/Drives","text!DS/W3DDriveManagement/template/W3DDriveManagementDrives.html","i18n!DS/W3DDriveManagement/assets/nls/W3DDriveManagement"],function(e,t,n,a,i,s,r,o,c,l,u,h){"use strict";return t.extend({pager:{},pagination:!1,paginationSize:15,sortAttribute:"alname",searchAttribute:"fullnameowner",searchValue:"",filterAttribute:"ownerstatus",filterValue:"",clearBtnShown:!1,fetchOnOffsetChange:!0,activeSortClassname:"sortable fonticon fonticon-expand-up lname",sortState:"up",KEY_UP_THRESHOLD:400,domEvents:{"click   .clear-search-input":"_clearSearchInput","input  form.usage-form":"_search","submit form.usage-form":"_search","keyup .search-input":"_handleSearchInputKeyup","click .search-icon":"_searchBox"},setup:function(e){var t=this;this.alert=e.alert,this.quota=e.quota,t.template=n.compile(u),this.collection=new l,this.timer=null,this.pager=new a({limit:t.paginationSize,offset:0,type:1,showPageLinks:!0,events:{onOffsetChange:function(e){if(t.fetchOnOffsetChange){var n,a=e/t.pager.limit;n=t._handleRequestOptions({page:a}),t._fetchDrives(n).then(function(){t._handleSearchbarState()})}}}}),this.pagination=!0,this.listenTo(this.collection,"onReset",this.render)},render:function(){var e=this,t=e.collection.length>0,n=e.collection.total;e.container.innerHTML=e.template({hasDrives:t,NLS:h}),""!=this.filterValue&&this._addBadge(this.filterValue),t?(e.pager.setLength(e.collection.total),e.pager.onRefresh(),this.tableLayout=new c({alert:e.alert,container:e.container.getElement(".drive__table"),collection:e.collection,pager:e.pager,quota:e.quota,activeSortClassname:e.activeSortClassname,sortState:e.sortState}),this.listenTo(this.tableLayout,"onSort",this._sort),this.listenTo(this.tableLayout,"onDelete",this.refresh),this.tableLayout.render()):""!==this.searchValue||""!==this.filterValue?this.container.querySelector(".no-drives").innerHTML=h.get("noResult"):n>0&&(this.container.querySelector(".no-drives").innerHTML=h.get("largeNumberOfDrives",{drives:n})),new s({target:e.container.getElement(".fonticon-filter"),closeOnClick:!0,items:[{text:h.get("active"),selectable:!0,selected:"active"===this.filterValue},{text:h.get("inactive"),selectable:!0,selected:"inactive"===this.filterValue}],events:{onClick:function(t,n){var a=n.text.toLowerCase();a&&(e._filter(a),e.render())}}})},refresh:function(){var e=this,t=this._handleRequestOptions({page:0});this._fetchDrives(t).then(function(){e._resetPagerOffset(),e._handleSearchbarState(),o.isMasked(e.container)&&o.unmask(e.container)})},_searchBox:function(){this.container.getElement(".search-text-box").classList.remove("box-visiblity"),this.container.getElement(".search-input").focus()},_filter:function(e){this.fetchOnOffsetChange=!1,this.filterValue=e,o.mask(this.container),this.refresh()},_search:function(e){e.preventDefault();var t=this;clearTimeout(this.timer),this.timer=setTimeout(function(){t.fetchOnOffsetChange=!1;var e=t.container.getElement(".search-input").value;e.length>=2?(t.searchValue=e.trim(),o.mask(t.container),t.refresh()):0===e.length&&(t.searchValue="",o.mask(t.container),t.refresh())},this.KEY_UP_THRESHOLD)},_sort:function(e){this.fetchOnOffsetChange=!1,0===Object.keys(e).length?(this.sortAttribute="",this.activeSortClassname=""):(this.sortAttribute=e.sortAttribute,this.activeSortClassname=e.activeSortClassname,this.sortState=e.sortState),this.refresh()},_fetchDrives:function(e){var t=this;return new Promise(function(n,a){t.collection.fetch({reset:!0,data:e,quota:t.quota,onComplete:function(e,t,a){n()},onTimeout:function(){t.error(h.fetchTimeout),t.render()},onFailure:function(e,n,i){i.request&&i.request.xhr&&204===i.request.xhr.status?t.error(h.fetchEmpty):t.error(h.fetchError),a()}})})},error:function(e){null!==this.alert&&this.alert.add({message:e,className:"error"})},_handleRequestOptions:function(e){return""!=this.filterValue&&""!=this.searchValue?(e.filteron=this.filterAttribute+","+this.searchAttribute,e.filter=this.filterValue+","+this.searchValue):(""!=this.filterValue&&(e.filteron=this.filterAttribute,e.filter=this.filterValue),""!=this.searchValue&&(e.filteron=this.searchAttribute,e.filter=this.searchValue)),""!=this.sortAttribute&&(e.sort=this.sortAttribute),this.pagination&&(e.limit=this.paginationSize),e},_handleSearchbarState:function(){""!==this.searchValue&&(this.container.getElement(".search-input").value=this.searchValue,this.clearBtnShown=!0,this.container.getElement(".clear-search-input").classList.remove("hidden"),this.container.getElement(".search-text-box").classList.remove("box-visiblity"),this.container.getElement(".search-input").focus())},_resetPagerOffset:function(){this.pager.setOffset(0),this.fetchOnOffsetChange=!0},_handleSearchInputKeyup:function(e){var t=this.container.getElement(".search-input").value,n=this.container.getElement(".clear-search-input");""===t?this.clearBtnShown&&(this.clearBtnShown=!1,n.classList.add("hidden")):this.clearBtnShown||(this.clearBtnShown=!0,n.classList.remove("hidden"))},_clearSearchInput:function(){this.container.getElement(".search-input").value="",this.clearBtnShown=!1,this.container.getElement(".clear-search-input").classList.add("hidden"),""!==this.searchValue&&(this.fetchOnOffsetChange=!1,this.searchValue="",o.mask(this.container),this.refresh())},_addBadge:function(e){var t=this;new r({content:e,className:"primary",selectable:!0,closable:!0,icon:"tag",events:{onClose:function(e){t.filterValue="",t.refresh()}}}).inject(document.querySelector(".usage-form .input-group"))}})}),define("DS/W3DDriveManagement/view/W3DDriveManagement",["UWA/Core","UWA/Class/View","UWA/Class/Promise","DS/UIKIT/Alert","DS/UIKIT/Mask","DS/Handlebars/Handlebars","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/W3DDriveManagement/Utils/WAFDataForDriveMgt","DS/W3DDriveManagement/Models/Quota","DS/W3DDriveManagement/Collections/SharedLinks","DS/W3DDriveManagement/Models/ShareAccess","DS/W3DDriveManagement/view/W3DDriveManagementSettings","DS/W3DDriveManagement/view/W3DDriveManagementDrives","DS/W3DDriveManagement/view/W3DDriveManagementShare","DS/W3DDriveManagement/Collections/DriveProviders","text!DS/W3DDriveManagement/template/W3DDriveManagement.html","i18n!DS/W3DDriveManagement/assets/nls/W3DDriveManagement","css!DS/W3DDriveManagement/W3DDriveManagement.css","css!DS/UIKIT/UIKIT.css"],function(e,t,n,a,i,s,r,o,c,l,u,h,d,m,v,f,g){"use strict";return t.extend({domEvents:{"click .usage":"_renderDrives","click .settings":"_renderSetting","click .share":"_renderShare"},classes:{driveManagementUsage:"drive-management-usage",driveManagementSettings:"drive-management-settings",driveManagementShare:"drive-management-share",active:"active",usage:"usage",settings:"settings",share:"share",removeDisplay:"remove-display"},dotClasses:function(e){return"."+this.classes[e]},setup:function(){this.template=s.compile(f),this.quota=new c,this.shareAccess=new u,this.sharedLinks=new l,this.driveProviders=new v},refresh:function(e){var t=this;i.mask(this.container),e&&e.platform&&(this.platform=e.platform),this.platform&&(o.setPlatform(this.platform),this._fetchQuota().then(function(){var e=[];t.drivesView&&e.push(t.drivesView.refresh()),t.settingsView&&e.push(t.settingsView.refresh()),t.shareView&&e.push(t.shareView.refresh()),n.all(e).then(i.unmask(t.container))},function(){}))},_fetchQuota:function(){var e=this;return new n(function(t,n){e.quota.fetch({onComplete:function(n,a,i){e.platform.csrf=i.responseHeaders,t()},onFailure:function(t,a,s){403===s.request.xhr.status?(e.error(g.drivesAccessDenied),e.drivesView.container.innerHTML=""):a&&a.error&&a.error.message?e.error(a.error.message):e.error(g.fetchError),i.unmask(e.container),n()}})})},render:function(){this.container.innerHTML=this.template({NLS:g}),i.mask(this.container),this.alert=new a({className:"drive-alert",closable:!0,renderTo:document.body,visible:!0,autoHide:!0,messageClassName:"error",maximumVisibleMessages:1}),this._renderDrives(),this._shareByLinkService()},_shareByLinkService:function(){var e=this;return new n(function(t,n){r.getServiceUrl({serviceName:"scdatamgt",platformId:widget.getValue("x3dPlatformId"),onComplete:function(n){!n&&e.container.querySelector(".tab-item.share.share-font")?(e.container.querySelector(".tab-item.share.share-font").addClassName(e.classes.removeDisplay),t()):t(n)},onFailure:n})})},error:function(e){this.alert.add({message:e,className:"error"})},_renderDrives:function(){this.drivesView||(this.drivesView=new d({alert:this.alert,quota:this.quota,container:this.container.getElement(this.dotClasses("driveManagementUsage"))})),this.container.getElement(this.dotClasses("driveManagementSettings")).removeClassName(this.classes.active),this.container.getElement(this.dotClasses("driveManagementShare")).removeClassName(this.classes.active),this.container.getElement(this.dotClasses("driveManagementUsage")).addClassName(this.classes.active),this.container.getElement(this.dotClasses("settings")).removeClassName(this.classes.active),this.container.getElement(this.dotClasses("share")).removeClassName(this.classes.active),this.container.getElement(this.dotClasses("usage")).addClassName(this.classes.active)},_renderSetting:function(){this.settingsView||(this.settingsView=new h({alert:this.alert,container:this.container.getElement(this.dotClasses("driveManagementSettings")),model:this.quota,driveProviders:this.driveProviders})),this.container.getElement(this.dotClasses("driveManagementUsage")).removeClassName(this.classes.active),this.container.getElement(this.dotClasses("driveManagementShare")).removeClassName(this.classes.active),this.container.getElement(this.dotClasses("driveManagementSettings")).addClassName(this.classes.active),this.container.getElement(this.dotClasses("usage")).removeClassName(this.classes.active),this.container.getElement(this.dotClasses("share")).removeClassName(this.classes.active),this.container.getElement(this.dotClasses("settings")).addClassName(this.classes.active)},_renderShare:function(){this.shareView||(this.shareView=new m({alert:this.alert,container:this.container.getElement(this.dotClasses("driveManagementShare")),model:this.quota,shareAccess:this.shareAccess,sharedLinks:this.sharedLinks}),this.shareView.render()),this.container.getElement(this.dotClasses("driveManagementUsage")).removeClassName(this.classes.active),this.container.getElement(this.dotClasses("driveManagementSettings")).removeClassName(this.classes.active),this.container.getElement(this.dotClasses("driveManagementShare")).addClassName(this.classes.active),this.container.getElement(this.dotClasses("usage")).removeClassName(this.classes.active),this.container.getElement(this.dotClasses("settings")).removeClassName(this.classes.active),this.container.getElement(this.dotClasses("share")).addClassName(this.classes.active)}})});