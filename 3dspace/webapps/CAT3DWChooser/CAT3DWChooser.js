define("DS/CAT3DWChooser/CAT3DWLoadServices",["UWA/Class"],function(t){"use strict";var e=t.extend({init:function(t){e.prototype._onOpenFile=null,this._inputId="CAT3DWChooser-fileinput",document.getElementById(this._inputId)||this.createInputFile(),this._acceptAttributes="image/*",t&&t.acceptAttributes&&(this._acceptAttributes=t.acceptAttributes)},createInputFile:function(){var t=document.getElementsByClassName(this._inputId+"-class");if(t)for(var e=0;e<t.length;e++)t[e].parentElement.remove();new UWA.Element("div",{html:[{tag:"input",id:this._inputId,class:this._inputId+"-class",type:"file",styles:{visibility:"hidden",position:"absolute",left:"0px",top:"0px"},events:{change:this.openFile.bind(this)}}]}).inject(document.body)},openFileSelector:function(t){var i=document.getElementById(this._inputId);i.setAttribute("accept",this._acceptAttributes),e.prototype._onOpenFile=t,i.value=null,i.click()},openFile:function(t){if(t){var i=t.target.files;if(i&&i.length){var n=window.URL.createObjectURL(i[0]);e.prototype._onOpenFile(n,i[0])}else e.prototype._onOpenFile(null)}}});return e}),define("DS/CAT3DWChooser/CAT3DWChooseThread",["UWA/Class","UWA/Promise","DS/UIKIT/Form","DS/UIKIT/Modal","DS/UIKIT/Input/Toggle","DS/CAT3DWInfra/CAT3DWPlateformServices","DS/CAT3DWInfra/CAT3DWPreferenceManager","i18n!DS/CAT3DWChooser/assets/nls/CAT3DSKChooseThread","css!DS/CAT3DWChooser/CAT3DWChooser"],function(t,e,i,n,s,o,r,a){"use strict";var c=UWA.Class.extend({init:function(t){this._platformId=t.platformId,this._platformUrl=t.platformUrl,this._platformId||this._platformUrl||console.warn("[CAT3DWChooseThread] A platformId or a platformUrl must be provided"),this._appMode=r.getPreferenceValue("appMode"),this._formName="thread-form",this._threadConversation="dm",this._threadCommunity="community",this._defaultThreadType=this._threadCommunity},_getPlateformData:function(){return new e(function(t,e){o.get3DSwym(this._platformId).then(o.getCsrfToken).then(function(e){this._platformUrl=e.url,this._csrfToken=e.token,t(e)}.bind(this)).catch(function(t){console.log(t),e()})}.bind(this))},getCurrentUser:function(){return new e(function(t){this._currentUser&&t(this._currentUser),o.getCurrentUser({url:this._platformUrl,token:this._csrfToken}).then(function(e){this._currentUser=e,t(e)}.bind(this)).catch(function(t){console.log(t)})}.bind(this))},selectThread:function(t){return new e(function(e,i){this._getCommunities().then(this._getConversations.bind(this)).then(function(s){s.type=this._defaultThreadType;var o="whiteboard"===this._appMode?a.get("modalTitleWhiteboard"):a.get("modalTitleSketch"),r=new n({className:"choose-thread-modal",closable:t,header:"<h4>"+o+"</h4>",body:this._getBody(s),escapeToClose:!1,footer:'<button type="submit" form="'+this._formName+'" class="btn btn-primary submit-thread-btn">'+a.get("submitBtnLabel")+"</button>"}).inject(document.body);r.onHide=this._onHide.bind(this,r),r.onShow=this._onShow.bind(this,r),this._onSubmitCB=function(t,n,s){r.hide(),r.destroy(),this._onSubmitCB=null,t&&n?e({threadId:t,threadType:n,threadTitle:s}):i()}.bind(this),this._onThreadTypeChangeCB=function(e){r.hide(),r.destroy(),s.type=e,(r=new n({className:"choose-thread-modal",closable:t,header:"<h4>"+o+"</h4>",body:this._getBody(s),escapeToClose:!1,footer:'<button type="submit" form="'+this._formName+'" class="btn btn-primary submit-thread-btn">'+a.get("submitBtnLabel")+"</button>"}).inject(document.body)).onHide=this._onHide.bind(this,r),r.onShow=this._onShow.bind(this,r),r.show()}.bind(this),r.show()}.bind(this)).catch(function(){i()})}.bind(this))},_onShow:function(t){},_onHide:function(t){t.destroy()},_getBody:function(t){t.communities.sort((t,e)=>t.label>e.label?1:e.label>t.label?-1:0),t.conversations.sort((t,e)=>t.label>e.label?1:e.label>t.label?-1:0);var e=document.createElement("div"),n=document.createElement("p");n.innerText=a.get("selectLocation"),n.className="label-cnt",e.appendChild(n);var o=document.createElement("div");o.className="thread-selector-cnt",e.appendChild(o);var r="primary thread-selector ";r+=t.type===this._threadCommunity?"checked":"",new s({name:"threadType",value:this._threadCommunity,label:a.get("community"),className:r,checked:t.type===this._threadCommunity}).inject(o).addEvent("onClick",function(){this._onThreadTypeChangeCB&&this._onThreadTypeChangeCB(this._threadCommunity)}.bind(this)),r="primary thread-selector ",r+=t.type===this._threadConversation?"checked":"",new s({name:"threadType",value:this._threadConversation,label:a.get("conversation"),className:r,checked:t.type===this._threadConversation}).inject(o).addEvent("onClick",function(){this._onThreadTypeChangeCB&&this._onThreadTypeChangeCB(this._threadConversation)}.bind(this));var c=new i({fields:[{type:"select",label:t.type===this._threadCommunity?a.get("selectLabelCommunity"):a.get("selectLabelConversation"),name:"threadInput",options:t.type===this._threadConversation?t.conversations:t.communities}]}).inject(e);if(c.elements.container.setAttribute("id",this._formName),c.addEvent("onSubmit",function(e){this._onSubmitCB&&(e.threadInput&&""!==e.threadInput?this.getThreadTitle(e.threadInput).then(function(i){this._onSubmitCB(e.threadInput,t.type,i)}.bind(this)):this._onSubmitCB(void 0,void 0,void 0))}.bind(this)),t.type===this._threadConversation&&0===t.conversations.length&&0!==t.communities.length){var l=document.createElement("p");l.classList.add("infoMsg"),l.textContent=a.get("emptyConversationList"),e.appendChild(l)}else if(t.type===this._threadCommunity&&0===t.communities.length&&0!==t.conversations.length){var h=document.createElement("p");h.classList.add("infoMsg"),h.textContent=a.get("emptyCommunityList"),e.appendChild(h)}else if(0===t.communities.length&&0===t.conversations.length){var d=document.createElement("p");d.classList.add("infoMsg"),d.textContent=a.get("emptyThreadList"),e.appendChild(d)}return e},_getCommunities:function(){return new e(function(t){this._platformId||this._platformUrl?this._getPlateformData().then(o.getCommunities.bind(this)).then(function(e){for(var i=[],n=0;n<e.length;n++)i.push({label:e[n].title,value:e[n].id});t({communities:i})}).catch(function(e){t({communities:[]})}):t({communities:[]})}.bind(this))},_getConversations:function(t){return new e(function(e){if(!this._platformId&&!this._platformUrl)return t.conversations=[],void e(t);this._getPlateformData().then(o.getConversations.bind(this)).then(function(i){var n=[];if(!i.length)return t.conversations=[],void e(t);for(var s=0;s<i.length;s++)this._getConversationName(i[s]).then(s=>{n.push({label:s.title,value:s.id}),n.length===i.length&&(t.conversations=n,e(t))})}.bind(this)).catch(function(i){t.conversations=[],e(t)})}.bind(this))},_getConversationName:function(t){return new e(function(e){var i;this.getCurrentUser().then(function(t){i=t.login}).finally(function(){var n=t.topic;if(null===n){n="";for(var s=0;s<t.users.length;s++)i.toLowerCase()!==t.users[s].login.toLowerCase()&&(n+=t.users[s].first_name+" "+t.users[s].last_name,s!==t.users.length-1&&(s===t.users.length-2&&i.toLowerCase()===t.users[s+1].login.toLowerCase()||(n+=", ")))}e({title:n,id:t.id})})}.bind(this))},getThreadTitle:function(t){return new Promise(function(e,i){var n=function(){return this._platformUrl?new Promise(function(t){t(this._platformUrl)}.bind(this)):this._getPlateformData()}.bind(this),s={id:t};n().then(function(){o.callPlatformWebService({url:this._platformUrl,params:s,api:"/api/community/get",token:this._csrfToken,returnPromise:!1,onSuccessCB:function(t){if(t.result.community_type===this._threadCommunity)e(t.result.title);else if(t.result.community_type===this._threadConversation){let i=t.result.topic?t.result.topic:a.get("conversationTitle");e(i)}}.bind(this),onFailCB:function(){i(new Error("[CAT3DWChooseThread] - getThreadTitle failed"))}})}.bind(this))}.bind(this))}});return UWA.namespace("DS/CAT3DWChooser/CAT3DWChooseThread",c)}),define("DS/CAT3DWChooser/CAT3DWImageGallery",["UWA/Core","UWA/Controls/Abstract","UWA/Json","WebappsUtils/WebappsUtils","text!DS/CAT3DWChooser/assets/gallerySettings.json","i18n!DS/CAT3DWChooser/assets/nls/CAT3DWImageGallery"],function(t,e,i,n,s,o){"use strict";var r="variable";return e.singleton({init:function(){this._currentSection={},this._maxLength=8,this._settingsURL=null,this._initialPath="",this._currentPath=""},initProperties:function(){var e=JSON.parse(s),o=i.path(e,"$");o[0].sections.map(function(t){return t.thumbnails.forEach(function(e){e.sectionName=t.name,e.url=e.url?n.getWebappsAssetUrl("CAT3DWChooser",e.url):e.url}),t}),this._initialPath+=t.Json.encode(o),this._currentPath+=this._initialPath},getIDs:function(t){var e=i.decode(this._currentPath);return i.path(e[0],'$.sections[?(@.name=="'+t+'")].thumbnails..id')},getThumbnails:function(t){var e=i.decode(this._currentPath);return i.path(e[0],'$.sections[?(@.name=="'+t+'")].thumbnails..url')},addThumbnail:function(t,e){var n=i.decode(this._currentPath);if(this._currentSection=i.path(n[0],'$.sections[?(@.name=="'+t+'")]')[0],this._currentSection&&this._currentSection.type===r){var s=this._genId();return this._currentSection.thumbnails||(this._currentSection.thumbnails=[]),this._currentSection.thumbnails.unshift({id:s,url:e}),this._currentSection.thumbnails.length>this._maxLength&&this._currentSection.thumbnails.pop(),this._currentPath=i.encode(n),s}return!1},getThumbnailPropertiesByID:function(t){var e=i.decode(this._currentPath);return i.path(e[0],'$..properties[?(@.id=="'+t+'")]')[0]},getSectionTitle:function(t){return o.get(t)},isSectionSelected:function(t){var e=i.decode(this._currentPath);return i.path(e[0],'$.sections[?(@.name=="'+t+'")].selected')[0]},setSectionVisible:function(t,e){var n=i.decode(this._currentPath);this._currentSection=i.path(n[0],'$.sections[?(@.name=="'+t+'")]')[0],this._currentSection&&(this._currentSection.visible=e,this._currentPath=i.encode(n))},countVisibleSections:function(){if(""!==this._currentPath){var t=i.decode(this._currentPath);return i.path(t[0],"$.sections[?(@.visible==true)]").length}return 0},isSectionVisible:function(t){var e=i.decode(this._currentPath);return i.path(e[0],'$.sections[?(@.name=="'+t+'")].visible')[0]},getOnClickCB:function(t){var e=i.decode(this._currentPath);return i.path(e[0],'$.sections[?(@.name=="'+t+'")].onClick')[0]},getSectionsNames:function(){var t=i.decode(this._currentPath);return i.path(t[0],"$.sections..name")},reset:function(){this._currentPath="",this._currentPath+=this._initialPath},_genId:function(){var t=Date.now();return t+=Math.floor(10*Math.random())}})}),define("DS/CAT3DWChooser/CAT3DWDisplayUserMedia",["UWA/Core","UWA/Promise","DS/CAT3DWInfra/CAT3DW3DSwymMediaServices","DS/CAT3DWLoaderLight/CAT3DWLoaderLight","DS/CoreEvents/Events","DS/CAT3DWInfra/CAT3DWPlateformServices","DS/CAT3DWInfra/CAT3DWPreferenceManager","i18n!DS/CAT3DWChooser/assets/nls/CAT3DWDisplayUserMedia","css!DS/CAT3DWChooser/CAT3DWChooser"],function(t,e,i,n,s,o,r,a){"use strict";var c=t.Class.extend({init:function(t){this.mediaContainer=t.body,n.initialize(t.body),n.show(),this.mediaList=[],this.conversationList=[],this._currentUser=r.getPreferenceValue("currentUserInfo"),this._swymMediaServices=new i({platformId:r.getPreferenceValue("swymTenant")}),this.platformId=r.getPreferenceValue("swymTenant"),this._isWhiteboard="whiteboard"===r.getPreferenceValue("appMode"),this._getPlateformData().then(this._getCurrentUser.bind(this)).then(this._getConversations.bind(this)).then(this._get3DSearchUrl.bind(this)).then(function(){this._getMediasOfCurrentUser(128,0)}.bind(this))},displayRecentUserMedia:function(){let e=t.createElement;this.titleBoxContainer=e("div",{class:"title-box-container",html:a.get("recentPublishedContent")}),this.boxContainer=e("div",{class:"box-container"}),this.screenContent=document.getElementsByClassName("afr-welcome-screen-content")[0],this.screenContent.style.overflow="auto",this.screenContent.style.width="78%",this.mediaContainer.className="media-container",this.mediaContainer.appendChild(this.titleBoxContainer),this.mediaContainer.appendChild(this.boxContainer)},_getPlateformData:function(){return new e(function(t){this._swymMediaServices.getPlatformUrl().then(o.getCsrfToken).then(function(e){this.platformUrl=e.url,this.csrfToken=e.token,t(e)}.bind(this)).catch(function(t){console.log(t)})}.bind(this))},_getCurrentUser:function(){return new e(function(t){this._currentUser&&t(this._currentUser),o.getCurrentUser({url:this.platformUrl,token:this.csrfToken}).then(function(e){this._currentUser=e,t(this._currentUser)}.bind(this)).catch(function(t){console.log(t)})}.bind(this))},_get3DSearchUrl:function(){return new e(function(t){this._federatedSearchUrl&&t(this._federatedSearchUrl),o.get3DSearch(this.platformId).then(function(e){this._federatedSearchUrl=e,t(this._federatedSearchUrl)}.bind(this)).catch(function(t){console.log(t)})}.bind(this))},_getConversations:function(){return new e(function(t){o.getConversations({url:this.platformUrl,token:this.csrfToken}).then(function(e){e.forEach(t=>{var e=this._getConversationName(t);this.conversationList[t.id]=e}),t()}.bind(this)).catch(function(e){console.log(e),t()})}.bind(this))},_getConversationName:function(t){var e=this._currentUser.last_name,i=this._currentUser.first_name,n=t.topic;if(null===n){n="";for(var s=0;s<t.users.length;s++)e===t.users[s].last_name&&i===t.users[s].first_name||(n+=t.users[s].first_name+" "+t.users[s].last_name,s!==t.users.length-1&&(s===t.users.length-2&&e===t.users[s+1].last_name&&i===t.users[s+1].first_name||(n+=", ")))}return n},_getMediasOfCurrentUser:function(t,e){o.searchMedia({url:this._federatedSearchUrl,platform_id:this.platformId,current_user:this._currentUser.login,media_type:this._isWhiteboard?"whiteboard":"sketch",page_size:t,page:e}).then(i=>{i.results?(this._displaUserMedia(i.results),i.results.length===t&&i.infos.nhits>t&&(e+=1,this._getMediasOfCurrentUser(t,e))):(n.hide(),this.noMediaView())})},_displaUserMedia:function(t){var e=[];t.forEach(t=>{let i={};t.attributes.map(t=>{let e=t.name;"resourceid"===(e=e.replace("ds6w:","").replace("swym:",""))&&t.value.contains("media:")&&(e="id",t.value=t.value.split("media:")[1]),"containerUid"===e&&t.value.contains("community:")&&(t.value=t.value.split("community:")[1]),i[e]=t.value}),i.isDraft="Draft"===i.publicationState,i.modified=this.formatDate(new Date(i.modified)),e.push(o.checkIfMediaExists({url:this.platformUrl,token:this.csrfToken,mediaId:i.id,returnPromise:!0}).then(function(t){t instanceof Error||this.mediaList.push(i)}.bind(this)))}),Promise.all(e).then(function(){n.hide(),this.mediaList.length>0?this.mediaCardView():this.noMediaView()}.bind(this))},mediaCardView:function(){this.boxContainer.innerText="",this.mediaList.sort((t,e)=>t.modified<e.modified?1:e.modified<t.modified?-1:0),this.mediaList.forEach(e=>{let i=t.createElement;var n=i("div",{class:"box",events:{click:function(){o.getMedia({url:this.platformUrl,token:this.csrfToken,mediaId:e.id,returnPromise:!0}).then(t=>{s.publish({event:"mediaClicked",data:t})})}.bind(this)}}),r=i("div",{class:"image-container",styles:{height:"142px"}}),c=i("img",{class:"media-image",src:e.preview_url}),l=i("div",{class:"details-container"}),h=i("div",{class:"header-container"}),d=i("div",{class:"draft-label",html:a.get("draft")});e.isDraft&&h.appendChild(d);var u=i("div",{class:"title-text",html:e.label});h.appendChild(u);var m=i("div",{class:"date-container",html:e.modified}),f=i("div",{class:"community-container"}),p=i("div",{class:"community-icon",html:e.community?'<span class="fonticon fonticon-users-alt"></span>':'<span class="fonticon fonticon-chat-alt"></span>'}),_=i("div",{class:"community-text",html:e.community?e.community:this.conversationList[e.containerUid]});f.appendChild(p),f.appendChild(_),n.setAttribute("href",this.platformUrl+"/#community:"+e.containerUid+"/media:"+e.id+"/edit"),r.appendChild(c),n.appendChild(r),l.appendChild(h),l.appendChild(m),l.appendChild(f),n.appendChild(l),this.boxContainer.appendChild(n)})},noMediaView:function(){var e=t.createElement("div",{class:"empty-container",html:this._isWhiteboard?a.get("noWhiteboard"):a.get("noSketch")});this.boxContainer.appendChild(e)},formatDate:function(t){return t.getFullYear().toString().padStart(4,0)+"-"+t.getMonth().toString().padStart(2,0)+"-"+t.getDate().toString().padStart(2,0)+" "+t.getHours().toString().padStart(2,0)+":"+t.getMinutes().toString().padStart(2,0)+":"+t.getSeconds().toString().padStart(2,0)}});return t.namespace("DS/CAT3DWChooser/CAT3DWDisplayUserMedia",c)}),define("DS/CAT3DWChooser/CAT3DWChoose3DModel",["UWA/Class","DS/UIKIT/Modal","DS/UIKIT/SuperModal","DS/CAT3DWChooser/CAT3DWLoadServices","DS/CAT3DWInfra/CAT3DWPlateformServices","DS/CAT3DWInfra/CAT3DWPreferenceManager","i18n!DS/CAT3DWChooser/assets/nls/CAT3DSKChoose3DModel","css!DS/CAT3DWChooser/CAT3DWChooser"],function(t,e,i,n,s,o,r){"use strict";var a=UWA.Class.extend({init:function(){this._onOpenFile=null,this._url=null,this._loadServices=new n({acceptAttributes:".3dxml,.cgr"}),this._drivePanelAnchor="sidepanel:X3PDRIV_AP"},open:function(t){this._onOpenFile=t;var e=new i({className:"choose-picture-modal"});e.onHide=this.onHide.bind(this,e),this._chooseProviderContent(e)},onHide:function(t){this._url=null,t.destroy()},_chooseProviderContent:function(t){if(s.cacheUrl3DDrive||o.getPreferenceValue("ODTMode")){var e=[];if(o.getPreferenceValue("ODTMode")){var i=this._createProviderObject(r.get("odtBtnLabel"),this._onODTClick.bind(this,t),"fonticon-cog",null);e.push(i);new UWA.Element("input",{type:"hidden",id:"x3DPhoto-ODT-modelUrl"}).inject(document.body)}var n=this._createProviderObject(r.get("deviceBtnLabel"),this._onComputerClick.bind(this,t),"fonticon-install",null);if(e.push(n),s.cacheUrl3DDrive){var a=this._getDrivePanelUrl(),c=this._createProviderObject(r.get("driveBtnLabel"),this._on3DDriveClick.bind(this,t),"fonticon-component",a);e.push(c)}var l=new UWA.Element("div",{html:e});t.dialog({body:l,title:r.get("title"),buttons:[{value:r.get("cancelBtnLabel"),action:function(t){t.hide()}}]})}else this._onComputerClick(t)},_onComputerClick:function(t){this._loadServices.openFileSelector(function(e){t.next(),this._onOpenFile(e)}.bind(this))},_onODTClick:function(t){var e=document.getElementById("x3DPhoto-ODT-modelUrl");t.next(),this._onOpenFile(e.value)},_on3DDriveClick:function(t){},_createProviderObject:function(t,e,i,n){return{tag:"a",href:n||"javascript:void(0)",target:"_parent",html:{tag:"div",class:"provider",html:[{tag:"span",class:"fonticon "+i+" fonticon-2x"},{tag:"span",class:"name",text:t}],events:{click:e}}}},_getDrivePanelUrl:function(){return parent.document.location.hash="","/#"+this._drivePanelAnchor}});return UWA.namespace("DS/CAT3DWChooser/CAT3DWChoose3DModel",a)}),define("DS/CAT3DWChooser/CAT3DWChoosePicture",["UWA/Class","UWA/Controls/Scroller","DS/UIKIT/Accordion","DS/UIKIT/Modal","DS/UIKIT/SuperModal","DS/CAT3DWChooser/CAT3DWLoadServices","DS/CAT3DWInfra/CAT3DWPlateformServices","DS/CAT3DWInfraUI/CAT3DWCanvasServices","DS/CAT3DWChooser/CAT3DWImageGallery","DS/i3DXCompassServices/i3DXCompassPubSub","WebappsUtils/WebappsUtils","DS/WAFData/WAFData","DS/CAT3DWInfra/CAT3DWPreferenceManager","i18n!DS/CAT3DWChooser/assets/nls/CAT3DWChoosePicture","css!DS/CAT3DWChooser/CAT3DWChooser"],function(t,e,i,n,s,o,r,a,c,l,h,d,u,m){"use strict";var f=UWA.Class.extend({init:function(){this._onOpenFile=null,this._url=null,this._loadServices=new o,this._canvasServices=new a,this._drivePanelAnchor="sidepanel:X3PDRIV_AP",this._maxWidth=2e3,this._maxHeight=1500,this._widget=null},setWidget:function(t){this._widget=t},open:function(t){this._onOpenFile=t;var e=new s({className:"choose-picture-modal"});e.onHide=this.onHide.bind(this,e),this._chooseProviderContent(e)},dropImage:function(t,e){this._onOpenFile=e,this._canvasServices.loadImage(t,!1,function(t){this._computeImageUrl(t,function(t){this._url=t,this._onOpenFile(this._url)}.bind(this))}.bind(this))},onHide:function(t){this._url=null,t.destroy(),l.unsubscribe("setX3DContent")},_chooseProviderContent:function(t){if(!r.cacheUrl3DDrive&&!u.getPreferenceValue("ODTMode")&&c.countVisibleSections()<=0)this._onComputerClick(t);else{var e=[];if(u.getPreferenceValue("ODTMode")){var i=this._createProviderObject(m.get("odtBtnLabel"),this._onODTClick.bind(this,t),"fonticon-cog",null);e.push(i);new UWA.Element("input",{type:"hidden",id:"x3DPhoto-ODT-imageUrl"}).inject(document.body)}var n=this._createProviderObject(m.get("deviceBtnLabel"),this._onComputerClick.bind(this,t),"fonticon-install",null);if(e.push(n),r.cacheUrl3DDrive){var s=this._getDrivePanelUrl(),o=this._createProviderObject(m.get("driveBtnLabel"),this._on3DDriveClick.bind(this,t),"fonticon-component",s);e.push(o)}var a=null;c.countVisibleSections()>1?a=this._createAccordionContainer("divided",t):1==c.countVisibleSections()&&(a=this._createSectionContainer(t)),a&&e.push(a);var l=new UWA.Element("div",{html:e});t.dialog({body:l,title:m.get("title"),buttons:[{value:m.get("cancelBtnLabel"),action:function(t){t.hide()}}]});var h=document.getElementById("toScroll");h&&this._addToScroller(h)}},_onComputerClick:function(t){this._loadServices.openFileSelector(function(e,i){this._loadLocalImage(t,e,i)}.bind(this))},_onODTClick:function(t){var e=document.getElementById("x3DPhoto-ODT-imageUrl");this._loadLocalImage(t,e.value)},_loadLocalImage:function(t,e,i){this._canvasServices.loadImage(e,!1,function(e){t.next(),this._computeImageUrl(e,function(t){this._url=t,this._onOpenFile(this._url,i?i.name:"")}.bind(this))}.bind(this))},_on3DDriveClick:function(t){var e=this._selectPictureContent(t);t.next(),l.subscribe("setX3DContent",this._on3DXContentSelection.bind(this,e))},_onRecentContentClick:function(t){this._canvasServices.getBlobUrlFromImg(this._url,function(e){this._url=e,this._onOpenFile(this._url),t.next()}.bind(this))},_onRecentTextureClick:function(t){this._canvasServices.getBlobUrlFromImg(this._url,function(e){this._url=e,this._onOpenFile(this._url),t.next()}.bind(this))},_onSampleClick:function(t,e){if(this._url=c.getThumbnailPropertiesByID(e),!this._url.type)return this._onOpenFile(this._url),void t.next();if("side"==this._url.type){for(var i in this._url.set){var n=this._url.set[i];n&&"string"==typeof n&&(this._url.set[i]=n?n.match("http")?n:h.getWebappsAssetUrl("CAT3DWChooser",n):null)}this._canvasServices.getBlobUrlFromImg(this._url.set.front,function(e){this._url.set.front=e,this._canvasServices.getBlobUrlFromImg(this._url.set.left,function(e){this._url.set.left=e,this._canvasServices.getBlobUrlFromImg(this._url.set.top,function(e){this._url.set.top=e,this._onOpenFile(this._url),t.next()}.bind(this))}.bind(this))}.bind(this))}else"scene"==this._url.type?(this._url.background=h.getWebappsAssetUrl("CAT3DWChooser",this._url.background),this._canvasServices.getBlobUrlFromImg(this._url.background,function(e){u.setPreferenceValue("SampleMode",{base:this._url.manhattanBase,floorParams:this._url.floorParams,camParams:this._url.camParams}),this._onOpenFile(e),t.next()}.bind(this))):(this._onOpenFile(this._url),t.next())},_selectPictureContent:function(t){var e=h.getWebappsAssetUrl("CAT3DWChooser","graphics/G_NXGAddImageWhite.png"),i=new UWA.Element("div",{html:[{tag:"div",class:"thumbnail",styles:{backgroundImage:"url("+e+")"},html:{tag:"img",src:e,class:"hide"}}]});return t.dialog({body:i,title:m.get("title"),buttons:[{className:"primary",value:m.get("validateBtnLabel"),action:function(t){this._url&&(this._onOpenFile(this._url),t.hide())}.bind(this)},{value:m.get("cancelBtnLabel"),action:function(t){t.hide()}}]}),i.getElementsByTagName("img")[0]},_on3DXContentSelection:function(t,e){if(e&&null!=e.data.items[0]){var i=r.cacheUrl3DDrive+"/resources/3ddrive/v1/bos/"+e.data.items[0].objectId+"/download";d.authenticatedRequest(i,{method:"GET",type:"json",onComplete:function(e){this._canvasServices.loadImage(e.url,!1,function(e){this._computeImageUrl(e,function(e){t.parentNode.setStyle("backgroundImage","url("+e+")"),this._url=e}.bind(this))}.bind(this))}.bind(this),onFailure:function(t){}})}},_createProviderObject:function(t,e,i,n){return{tag:"a",href:n||"javascript:void(0)",target:"_parent",html:{tag:"div",class:"provider",html:[{tag:"span",class:"fonticon "+i+" fonticon-2x"},{tag:"span",class:"name",text:t}],events:{click:e}}}},_createPictureContainer:function(t,e,i){var n=new UWA.Element("div",{class:"section-thumbnail",events:{click:function(){this._url=t,e?i(e):i()}.bind(this)}});return this._canvasServices.loadImage(t,!1,function(t){t.naturalWidth>t.naturalHeight?n.addClassName("landscape"):n.addClassName("portrait"),n.appendChild(t)}),n},_createSectionContent:function(t,e,i){if(n=null,t&&t.length>0){var n=new UWA.Element("div",{class:"section-thumbnail-container",id:"toScroll"});t.forEach(function(t,s){this._createPictureContainer(t,e?e[s]:null,i).inject(n,"bottom")}.bind(this)),new UWA.Element("div",{class:"section-padding-trick"}).inject(n)}return n},_createAccordionContainer:function(t,e){var n=new UWA.Element("div",{class:"section-container"}),s=new i({className:t||"",exclusive:!1,items:[]});return c.getSectionsNames().forEach(function(t){c.isSectionVisible(t)&&(s.addItem({title:c.getSectionTitle(t),name:t,content:this._createSectionContent(c.getThumbnails(t),c.getIDs(t),this[c.getOnClickCB(t)].bind(this,e)),selected:c.isSectionSelected(t)}),s.inject(n))}.bind(this)),n},_createSectionContainer:function(t){var e=new UWA.Element("div",{class:"section-container"});return c.getSectionsNames().forEach(function(i){if(c.isSectionVisible(i)){var n=this._createSectionContent(c.getThumbnails(i),c.getIDs(i),this[c.getOnClickCB(i)].bind(this,t));if(n)new UWA.Element("div",{class:"section-title",text:c.getSectionTitle(i)}).inject(e),n.inject(e)}}.bind(this)),e},_addToScroller:function(t){new e(t,{scrollbarV:!1,scrollableY:!1})},_getDrivePanelUrl:function(){return parent.document.location.hash="","/#"+this._drivePanelAnchor},_computeImageUrl:function(t,e){var i=null,n=this._widget?this._widget.getValue("ImageOptimization"):"1";"-1"===n&&(t.width>this._maxWidth||t.height>this._maxHeight)?this._openImageOtimizationModal(function(n){i=this._optimizeImage(t,n),e(i)}.bind(this)):(i=this._optimizeImage(t,n),e(i))},_openImageOtimizationModal:function(t){var e=new n({className:"image-optimization",overlay:!0,closable:!1,header:"<h4>"+m.get("optimTitle")+"</h4>",body:"<p>"+m.get("optimMessage1")+"</p><p>"+m.get("optimMessage2")+'</p><br /><p><font size="2">'+m.get("optimTip")+"</font></p>",footer:'<button type="button" class="btn btn-primary" value="1">'+m.get("optimYesBtnLabel")+'</button> <button type="button" class="btn btn-default" value="0">'+m.get("optimNoBtnLabel")+"</button>"}).inject(document.body);e.onHide=this._onImageOptimizationHide.bind(this,e),e.getContent().getElements(".btn").forEach(function(i){i.addEvent("click",function(){e.hide(),this._widget&&this._widget.setValue("ImageOptimization",i.value),t(i.value)}.bind(this))}.bind(this)),e.show()},_optimizeImage:function(t,e){var i=t.width,n=t.height;"1"===e?(i=this._maxWidth,n=this._maxHeight):"0"===e&&(i=4e3,n=4e3);var s=this._canvasServices.getOptimizedDataUrlFromImg(t,i,n);return this._canvasServices.getBlobUrlFromDataUrl(s)},_onImageOptimizationHide:function(t){t.destroy()}});return UWA.namespace("DS/CAT3DWChooser/CAT3DWChoosePicture",f)});