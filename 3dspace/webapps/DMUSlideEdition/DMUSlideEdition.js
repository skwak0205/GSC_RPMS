define("DS/DMUSlideEdition/DMUEditAssociatedFormatCmd",["DS/ApplicationFrame/Command","DS/Selection/CSOManager","DS/DMUBaseExperience/DMUContextManager","DS/DMUBaseUIControllers/DMUSlidesController"],function(e,t,i,n){"use strict";return e.extend({init:function(e){e.mode="exclusive",this._parent(e);var r=this;this.beginExecute=function(){var e=t.get();if(1===e.length){var a=e[0].pathElement.getLastElement(!0);if(a&&a.getDMUType&&"DMUSlide"===a.getDMUType()){var o=i.getReviewContext({viewer:r.getFrameWindow().getViewer()});if(o){var l=o.getDMUObjectFromPathElement(e[0].pathElement);if(l&&l.getPointedFormats&&l.getPointedFormats().length){var s=l.getPointedFormats()[0],d=!o.getUIManager().getFormatEditionModeFlag();o.getUIManager().setFormatEditionModeFlag(d);var g=n.giveDMUSlidesController({context:r.getFrameWindow()});g&&g.setActiveSlide(s,{duration:0});var c=i.giveEventsController({viewer:r.getFrameWindow().getViewer()});c&&c.fireEvent(d?"onFormatsEditionModeStarted":"onFormatsEditionModeEnded")}}}}r.end()}}})}),define("DS/DMUSlideEdition/DMUSlideEdition",[],function(){}),define("DS/DMUSlideEdition/DMUCreateSlideCmd",["require","exports","DS/ApplicationFrame/Command","DS/DMUBaseUIControllers/DMUSlidesController","DS/DMUBaseExperience/DMUContextManager","DS/DMUBaseExperience/EXPManagerSet","DS/DMUBaseUIControllers/DMUSceneDisplayController","DS/DMUBaseUIControllers/DMUApplicativeContextManager","DS/DMUBaseUI/DMUToolsUsers","UWA/Utils","DS/DMUPlaySlide/DMUFormat","DS/DMUPlaySlide/DMUSlide","DS/DMUBaseExperience/DMUModelServices","i18n!DS/DMUSlideEdition/assets/nls/DMUSlideEdition"],function(e,t,i,n,r,a,o,l,s,d,g,c,u,m){"use strict";return class extends i{constructor(e){super(e,"exclusive");let t=this;r.setAuthoringFeatureTypes("Slide"),this.beginExecute=async function(){let e=r.getReviewContext({viewer:t.getFrameWindow().getViewer()}),i=r.giveEventsController({viewer:t.getFrameWindow().getViewer()}),p=e.getValidation();if(p||e){let D=p?p.getCurrentMarkup():null;for(;D&&"Markup"!==D.getValType();)D=D.getParentRepRef().getParent();D&&D.getValType&&"Markup"===D.getValType()&&(D=D.getRepRef());let f=D?D.getMarkupContent():e.getCurrentSessionMarkup(),M=[];if(f){p&&p.setCurrentMarkup(D);let U,S=r.getContextViewer({viewer:t.getFrameWindow().getViewer()}),h=o.giveDMUSceneDisplayController({context:S}),v=f.isVisible()?null:h.getDisplayedAndHiddenOccurrences(),E=e.getTransientReviewBag().getDMUObjects(),C=e.getTransientReviewBag().getAttribute("oLinksManager");if(E.length){let e;i&&i.fireEvent("onBeginDMUObjectDuplication");for(let t=0;t<E.length;t++){if(-1!==E[t].getType().indexOf("Compare")&&C){let e=[],i=[],n=[],r=E[t].getAttribute("oSelections");if("DMUCompare2D"===E[t].getType()&&(n=E[t].getAttribute("oSheetIDs")),n&&2===n.length&&(n[0].id&&i.push({id:n[0].id}),n[1].id&&i.push({id:n[1].id}),2===i.length&&E[t].setAttribute("oSheetIDs",i)),2===r.length&&r[0].id&&r[1].id){let i=C.getChildWithID(r[0].id),n=null;i.path?n=C.getOccurrenceIdPath(i.path):i.identifier&&(n=[i.identifier]);let a=f.getOccurence({idPath:n},!0);a&&a.id&&e.push({id:a.id}),i=C.getChildWithID(r[1].id),n=null,i.path?n=C.getOccurrenceIdPath(i.path):i.identifier&&(n=[i.identifier]),(a=f.getOccurence({idPath:n},!0))&&a.id&&e.push({id:a.id}),2===e.length&&E[t].setAttribute("oSelections",e),h&&(E[t].setAttribute("fBalance",h.getCurrentCompareBalance()),E[t].setAttribute("bLocalAxis",h.getCurrentLocalAxisValue()))}}e=await u.getObjectDefinition(E[t]),M.push(e)}}let w,F=e.getUIManager().getFormatEditionModeFlag(),b=[{name:"sID",value:f.computeNewID()},{name:"sUuid",value:d.getUUID()}];if(F)(U=new g(t.getFrameWindow().getViewer(),f)).setAttributes(b);else{U=new c(t.getFrameWindow().getViewer(),f);let i=f.getCurrentSlide();i&&i instanceof c&&i.getAttribute("sPointedFormats")&&b.push({name:"sPointedFormats",value:i.getAttribute("sPointedFormats")}),e.getValidation()&&(b=b.concat([{name:"sOwner",value:s.getUserLogin()},{name:"fCreationDate",value:Date.now()}])),U.setAttributes(b)}if(U.updateEnvironmentOverload({target:e.getEnvironment(),state:e.getEnvironment().getEnvironmentInfo()}),F&&U instanceof g){let e;if(f.getCurrentSlide()){let t=f.getFormats();for(w=0;w<t.length;w++)if(t[w]===f.getCurrentSlide()&&w!==t.length-1){e=w+1;break}}f.addFormat(U,e),U.setReadOnly(!1),window.require(["DS/DMUBaseExperience/EXPUtils"],function(e){e._sendUsageProbe("command","CreateFormat")})}else if(U instanceof c){let e;if(f.getCurrentSlide()){let t=f.getSlides();for(w=0;w<t.length;w++)if(t[w]===f.getCurrentSlide()&&w!==t.length-1){e=w+1;break}}f.addSlide(U,e),window.require(["DS/DMUBaseExperience/EXPUtils"],function(e){e._sendUsageProbe("command","CreateSlide")})}if(M.length){let e=a.getManager({name:"DMUUserExperienceManager",context:t.getFrameWindow()});await e.duplicateDMUElements({elementDefinitions:M,parent:U,cb:function({duplicatedElements:e}){if(e&&e.length)for(w=0;w<e.length;w++)e[w].setAttributes([{name:"sID",value:f.computeNewID()},{name:"sUuid",value:d.getUUID()}])}})}if(v&&h){let t,i,n=[],r=function(i,r){(t=e.getCurrentSessionMarkup().getOrCreateOccurrenceOverloader(i,!0))&&(n.push({target:t,state:{bVisible:r}}),U.addObjectOverload({target:t,state:{bVisible:r}}))};v.hidden&&(v.hidden.paths.forEach(function(e){r({pathElement:e},!1)}),v.hidden.idPaths.forEach(function(e){(i=e.slice())[0]===S.getController().getRootBagId()&&i.splice(0,1),r({idPath:i},!1)})),v.shown&&(v.shown.paths.forEach(function(e){r({pathElement:e},!0)}),v.shown.idPaths.forEach(function(e){(i=e.slice())[0]===S.getController().getRootBagId()&&i.splice(0,1),r({idPath:i},!0)})),n.length&&U.fireEvent("onDMUOverloadPropertiesChanged",{overloads:n})}let x=l.giveDMUApplicativeContextManager({context:S}),O=null;if(!F&&x){let e,t,i=x?x.getApplicativeControllers():[],n=[];for(let r=0;r<i.length;r++){t=i[r].getApplicativeContainerID();let a=x.getVerifiedApplicativeContainerState(t);if(a){if(e=null,(e=i[r].getCurrentAppContainerStateTitle())&&(O?O+=" - ":O="",O+=e),"false"!==localStorage.getItem("DMUSlideNameFromFeature")&&i[r]&&i[r].getFeatureInformation){let e=i[r].getFeatureInformation();e&&e.name&&n.push(e.name)}U.setSlideApplicativeContext(t,a)}}1===n.length&&n[0]&&(O=n[0])}i&&E.length&&(e.getTransientReviewBag().removeDMUObjects(),i.fireEvent("onDMUObjectDuplicated")),f.setVisibleFlag(!0),"false"===localStorage.getItem("DMUSlideNameFromFeature")&&(O=null),U.setAttribute("sName",f.computeNewName({object:U,prefix:F?m.normalFormatTitle:O||m.normalSlideTitle,noSuffixIfPossible:null!==O,separator:null!==O?"parenthesis":null})),U.fireEvent("onDMUObjectInitialized",{dmuObject:U,dmuCont:f,mkpRepRef:D});let A=n.giveDMUSlidesController({context:t.getFrameWindow()});A&&A.setActiveSlide(U,{duration:0})}}t.end()}}}}),define("DS/DMUSlideEdition/DMUGenerateFormatCmd",["DS/ApplicationFrame/Command","DS/DMUControls/EXPNotify","DS/DMUBaseExperience/DMUContextManager","DS/DMUBaseExperience/EXPManagerSet","DS/DMUControls/DMUPasteWithOptionsPanel","DS/DMUBaseUIControllers/DMUSlidesController","i18n!DS/DMUSlideEdition/assets/nls/DMUSlideEdition"],function(e,t,i,n,r,a,o){"use strict";return e.extend({init:function(e){e.mode="exclusive",this._parent(e);var l,s=this;function d(e,i){l&&l.destroy(),l=new t({body:s.getFrameWindow().getUIFrame(),type:e,message:i})}this.beginExecute=function(){var e=!1,t=i.getReviewContext({viewer:s.getFrameWindow().getViewer()});if(t){var l=t.getCurrentSessionMarkup();if(l){var g=n.getManager({name:"DMUUserExperienceManager",context:s.getFrameWindow()});if(g){var c=g.getCCPTarget();if(c&&c.getType&&"DMUSlide"===c.getType()){c.fireEvent("onBeginDMUObjectDuplication");new r({frmWindow:s.getFrameWindow(),panelTitle:o.generateFormatTitle,prefs:{displayAssociateFormatToSlidePref:!0,applyButtonNls:o.generateAndEditLabel},cb:function(e,n){if(g){let r,u=t.getValidation();if(u){for(r=u.getCurrentMarkup();r&&"Markup"!==r.getAttribute("sValType");)r=r.getParentRepRef().getParent();r&&"Markup"===r.getAttribute("sValType")&&(r=r.getRepRef()),r&&(l=r.getMarkupContent())}g.duplicateDMUElements({elements:[c],parent:l,newType:"Format",markupRepRef:r,duplicationOptions:e,cb:function(r){if(r.duplicatedElements&&1===r.duplicatedElements.length)if(e.associateFormat){c.setAttribute("sPointedFormats",[r.duplicatedElements[0].getAttribute("sID")]);for(var l,g,u=Object.keys(e),m=0;m<u.length;m++)if("formatting"===u[m]&&e[u[m]]){for(g=(l=c.getDMUObjects("DMUSection")).length-1;g>=0;g--)c.removeDMUObject(l[g]);for(g=(l=c.getObjectOverloads()).length-1;g>=0;g--)c.removeObjectOverload(l[g])}else if("markers3D"===u[m]&&e[u[m]])for(g=(l=c.getDMUObjects()).length-1;g>=0;g--)-1===l[g].getType().indexOf("DMUMarker3D")&&-1===l[g].getType().indexOf("Measure")||c.removeDMUObject(l[g]);else if("markers2D"===u[m]&&e[u[m]])for(g=(l=c.getDMUObjects()).length-1;g>=0;g--)-1!==l[g].getType().indexOf("DMUMarker2D")&&c.removeDMUObject(l[g])}else r.duplicatedElements.forEach(function(e){e.refreshNode()});if(c.refreshNode(),s.getFrameWindow().getViewer().render(),c.fireEvent("onDMUObjectDuplicated"),r.duplicatedElements&&1===r.duplicatedElements.length&&n){var p=!t.getUIManager().getFormatEditionModeFlag();t.getUIManager().setFormatEditionModeFlag(p);var D=a.giveDMUSlidesController({context:s.getFrameWindow()});D&&D.setActiveSlide(r.duplicatedElements[0],{duration:0});var f=i.giveEventsController({viewer:s.getFrameWindow().getViewer()});f&&f.fireEvent(p?"onFormatsEditionModeStarted":"onFormatsEditionModeEnded")}else c.fireEvent("onSlidePreviewRefreshRequired",{dmuObject:c}),d(r.duplicatedElements&&r.duplicatedElements.length?"info":"error",r.duplicatedElements&&r.duplicatedElements.length?o.formatGenerated:o.formatGenerationError)}})}}})}else e=!0}else e=!0}else e=!0}else e=!0;e&&d("error",o.formatGenerationError),s.end()}}})});