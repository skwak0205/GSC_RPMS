define("UWA/Services/ICal",["UWA/Core","UWA/String"],function(e,t){"use strict";var l=function(e){this.stream=e,this.parse()};return l.prototype={stream:null,regexes:{component:"BEGIN:{0}(?:[^])*?END:{0}",multipleProperties:"\n{0}[^:]*",singleProperty:"({0})(;[^=]*=[^;:\n]*)*:([^\n]*)"},keys:{core:{version:"VERSION",prodId:"PRODID",calendarScale:"CALSCALE",method:"METHOD"},components:{event:"VEVENT",todo:"VTODO",journal:"VJOURNAL",freebusy:"VFREEBUSY"},event:{classification:{key:"CLASS",multiple:!1},created:{key:"CREATED",multiple:!1},description:{key:"DESCRIPTION",multiple:!1},geo:{key:"GEO",multiple:!1},lastModified:{key:"LAST-MODIFIED",multiple:!1},location:{key:"LOCATION",multiple:!1},organizer:{key:"ORGANIZER",multiple:!1},priority:{key:"PRIORITY",multiple:!1},dateTimeStamp:{key:"DTSTAMP",multiple:!1},sequence:{key:"SEQUENCE",multiple:!1},status:{key:"STATUS",multiple:!1},transparent:{key:"TRANSP",multiple:!1},url:{key:"URL",multiple:!1},recurrenceId:{key:"RECURRENCE-ID",multiple:!1},duration:{key:"DURATION",multiple:!1},attach:{key:"ATTACH",multiple:!0},attendee:{key:"ATTENDEE",multiple:!0},categories:{key:"CATEGORIES",multiple:!0},comment:{key:"COMMENT",multiple:!0},contact:{key:"CONTACT",multiple:!0},exceptionDate:{key:"EXDATE",multiple:!0},exceptionRule:{key:"EXRULE",multiple:!0},requestStatus:{key:"REQUEST-STATUS",multiple:!0},related:{key:"RELATED",multiple:!0},ressources:{key:"RESSOURCES",multiple:!0},recurrenceDate:{key:"RDATE",multiple:!0},recurrenceRule:{key:"RRULE",multiple:!0},xProperty:{key:"X-",multiple:!0},uid:{key:"UID",multiple:!0},summary:{key:"SUMMARY",multiple:!1},dateTimeStart:{key:"DTSTART",multiple:!1},dateTimeEnd:{key:"DTEND",multiple:!1}},todo:{classification:{key:"CLASS",multiple:!1},completed:{key:"COMPLETED",multiple:!1},created:{key:"CREATED",multiple:!1},description:{key:"DESCRIPTION",multiple:!1},dateTimeStamp:{key:"DTSTAMP",multiple:!1},geoPosition:{key:"GEO",multiple:!1},lastModified:{key:"LAST-MODIFIED",multiple:!1},location:{key:"LOCATION",multiple:!1},organizer:{key:"ORGANIZER",multiple:!1},percentComplete:{key:"PERCENT-COMPLETE",multiple:!1},priority:{key:"PRIORITY",multiple:!1},recurrenceId:{key:"RECURRENCE-ID",multiple:!1},sequence:{key:"SEQUENCE",multiple:!1},status:{key:"STATUS",multiple:!1},summary:{key:"SUMMARY",multiple:!1},uid:{key:"UID",multiple:!1},url:{key:"URL",multiple:!1},due:{key:"DUE",multiple:!1},duration:{key:"DURATION",multiple:!1},attach:{key:"ATTACH",multiple:!0},attendee:{key:"ATTENDEE",multiple:!0},categories:{key:"CATEGORIES",multiple:!0},comment:{key:"COMMENT",multiple:!0},contact:{key:"CONTACT",multiple:!0},exceptionDate:{key:"EXDATE",multiple:!0},exceptioRule:{key:"EXRULE",multiple:!0},requestStatus:{key:"REQUEST-STATUS",multiple:!0},related:{key:"RELATED",multiple:!0},ressources:{key:"RESSOURCES",multiple:!0},recurrenceDate:{key:"RDATE",multiple:!0},recurrenceRule:{key:"RRULE",multiple:!0},xProperty:{key:"X-",multiple:!0}},journal:{classification:{key:"CLASS",multiple:!1},created:{key:"CREATED",multiple:!1},description:{key:"DESCRIPTION",multiple:!1},datetimeStart:{key:"DTSTART",multiple:!1},datetimeStamp:{key:"DTSTAMP",multiple:!1},lastModified:{key:"LAST-MODIFIED",multiple:!1},organizer:{key:"ORGANIZER",multiple:!1},recurrenceId:{key:"RECURRENCE-ID",multiple:!1},sequence:{key:"SEQUENCE",multiple:!1},status:{key:"STATUS",multiple:!1},summary:{key:"SUMMARY",multiple:!1},uid:{key:"UID",multiple:!1},url:{key:"URL",multiple:!1},attach:{key:"ATTACH",multiple:!0},attendee:{key:"ATTENDEE",multiple:!0},categories:{key:"CATEGORIES",multiple:!0},comment:{key:"COMMENT",multiple:!0},contact:{key:"CONTACT",multiple:!0},exceptionDate:{key:"EXDATE",multiple:!0},exceptionRule:{key:"EXRULE",multiple:!0},related:{key:"RELATED",multiple:!0},recurrenceDate:{key:"RDATE",multiple:!0},recurrenceRule:{key:"RRULE",multiple:!0},requestStatus:{key:"REQUEST-STATUS",multiple:!0},xProperty:{key:"X-",multiple:!0}},freebusy:{contact:{key:"CONTACT",multiple:!1},datetimeStart:{key:"DTSTART",multiple:!1},datetimeEnd:{key:"DTEND",multiple:!1},duration:{key:"DURATION",multiple:!1},description:{key:"DESCRIPTION",multiple:!1},datetimeStamp:{key:"DTSTAMP",multiple:!1},organizer:{key:"ORGANIZER",multiple:!1},uid:{key:"UID",multiple:!1},url:{key:"URL",multiple:!1},attendee:{key:"ATTENDEE",multiple:!0},comment:{key:"COMMENT",multiple:!0},freebusy:{key:"FREEBUSY",multiple:!0},requestStatus:{key:"REQUEST-STATUS",multiple:!0},xProperty:{key:"X-",multiple:!0}}},core:{version:"",prodId:"",calendarScale:"",method:""},components:{event:[],todo:[],journal:[],freebusy:[]},parse:function(){this.parseCoreProperties(),this.parseComponent("event"),this.parseComponent("todo"),this.parseComponent("journal"),this.parseComponent("freebusy")},parseCoreProperties:function(){var e=this.stream;this.core.version=this.parseProperty(this.keys.core.version,e),this.core.prodId=this.parseProperty(this.keys.core.prodId,e),this.core.calendarScale=this.parseProperty(this.keys.core.calendarScale,e),this.core.method=this.parseProperty(this.keys.core.method,e)},parseComponent:function(e){var l,i,r,p=this.keys,u=this.components,o=new RegExp(t.format(this.regexes.component,p.components[e]),"g");if("string"==typeof this.stream&&(r=this.stream.match(o)))for(i in r)if("string"==typeof r[i])for(l in u[e].push({}),p[e])"object"==typeof p[e][l]&&(u[e][i][l]=p[e][l].multiple?this.parseMultipleProperties(p[e][l].key,r[i]):this.parseProperty(p[e][l].key,r[i]))},parseProperty:function(e,l){var i,r,p,u,o=new RegExp(t.format(this.regexes.singleProperty,e),"g").exec(l);if(o){if(r=o[3],o[2])for(p=o[2].substr(1).split(";"),i=0;i<p.length;i++)void 0===(u=p[i].split("="))[1]&&(u[1]=u[0]),p[u[0]]=u[1];return{value:r,parameters:p}}},parseMultipleProperties:function(e,l){var i,r,p=new RegExp(t.format(this.regexes.multipleProperties,e),"g"),u=l.match(p);if(u){for(r=[],i=0;i<u.length;i++)u[i]=u[i].replace(/;.*/,""),r[r.length]=this.parseProperty(u[i]);return r}},getCalendar:function(){return{core:this.core,components:this.components}},getEvents:function(){return this.components.event},getTodoArray:function(){return this.components.todo},getJournals:function(){return this.components.journal},getFreebusys:function(){return this.components.freebusy},getCoreProperties:function(){return this.core}},e.namespace("Services/ICal",l,e)});