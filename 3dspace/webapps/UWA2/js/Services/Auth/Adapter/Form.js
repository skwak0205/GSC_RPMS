define("UWA/Services/Auth/Adapter/Form",["UWA/Core","UWA/Utils","UWA/Ajax","UWA/Json","UWA/Data","UWA/Services/Auth/Adapter/Abstract"],function(t,e,n,i,o,a){"use strict";var r=a.extend({defaultOptions:{timeout:15e3,checkUrl:"https://example.com/myapp/test.json",loginUrl:"https://example.com/global/2.0/login.fcc",logoutUrl:"https://example.com/global/2.0/logout.fcc",params:{},fields:{},variables:{}},isAjaxPostAllowed:function(){return o.allowCrossOriginRequest},hasIdentity:function(t,e){var n=this.options;i.request(n.target,{useOfflineCache:!1,timeout:n.timeout,onComplete:function(e){"function"==typeof t&&t(e)}.bind(this),onFailure:function(t){"function"==typeof e&&e(t)}.bind(this)})},getIdentity:function(t,e){e(new Error("Not implemented."))},clearIdentity:function(t){t=t||function(){},this.isAjaxPostAllowed()?this.clearIdentityUsingAjax(t):this.clearIdentityUsingFrame(t)},authenticate:function(t,n,i){if(n=n||function(){},t=t||function(){},i.login&&i.password){var o=this.options,a=o.loginUrl,r=function(){this.hasIdentity(t,n)}.bind(this),s=o.fields;a+=(a.indexOf("?")>-1?"&":"?")+e.toQueryString(o.params).replace(/%25/g,"-%"),this.isAjaxPostAllowed()?this.authenticateUsingAjax(s,a,r,n):this.authenticateUsingFrame(s,a,r,n)}else n(new Error("Invalid credentials values."))},authenticateUsingFrame:function(n,i,o){var a,r,s=e.random(1,1e5),l=t.createElement("div"),c=t.createElement("iframe",{src:"about:blank",id:"formAuth:frame:"+s,name:"formAuth:frame:"+s,styles:{position:"absolute",top:"-2000px",left:"0px"}}).inject(l),u=t.createElement("form",{target:"formAuth:frame:"+s,action:i,method:"post"}).inject(l);for(a in n)n.hasOwnProperty(a)&&(r=n[a],t.createElement("input",{type:"hidden",name:a,value:r}).inject(u));l.inject(document.body),c.addEvent("load",function(){o(),l.destroy()}),u.submit()},clearIdentityUsingFrame:function(e){var n,i=this.options.logoutUrl;i+=(i.indexOf("?")>-1?"&":"?")+"rnd="+Math.random(),n=t.createElement("iframe",{src:i,styles:{position:"absolute",top:"-2000px",left:"0"},events:{load:function(){e(),n.destroy()}}}).inject(document.body)},authenticateUsingAjax:function(t,e,i,o){n.request(e,{onComplete:i,onFailure:o,method:"POST",data:t})},clearIdentityUsingAjax:function(t){var e=this.options.logoutUrl;e+=(e.indexOf("?")>-1?"&":"?")+"rnd="+Math.random(),n.request(e,{onComplete:t,onFailure:t,method:"GET"})}});return t.namespace("Services/Auth/Adapter/Form",r,t)});