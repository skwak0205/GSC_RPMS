define("UWA/Dispatcher",["UWA/Core","UWA/Utils","UWA/Class"],function(i,t,e){"use strict";var n=i.Class.extend({Binding:null,bindings:null,shouldPropagate:!0,active:!0,dispatching:0,init:function(){this.bindings=[]},registerListener:function(t,e,n,s){if(!(i.is(t,"function")||i.is(t,"object")&&i.is(t.handleEvent,"function")))throw new Error("listener is a required param of add() and addOnce() and should be a Function or an object implementing the EventListener interface.");var r,h;if(r=this.indexOfListener(t,n),h=this.bindings[r]){if(h.isOnce!==e)throw new Error("You cannot add"+(e?"":"Once")+"() then add"+(e?"Once":"")+"() the same listener without removing the relationship first.")}else h=new this.Binding(this,t,e,n,s),this.addBinding(h);return h},addBinding:function(i){var t=this.bindings,e=t.length;do{--e}while(t[e]&&i.priority<=t[e].priority);t.splice(e+1,0,i)},indexOfListener:function(i,t){for(var e=this.bindings,n=e.length;n--;)if(e[n].listener===i&&(void 0===t||e[n].context===t))return n;return-1},add:function(i,t,e){return this.registerListener(i,!1,t,e)},addOnce:function(i,t,e){return this.registerListener(i,!0,t,e)},remove:function(t,e){var n,s;if(!(i.is(t,"function")||i.is(t,"object")&&i.is(t.handleEvent,"function")))throw new Error("listener is a required param of remove() and should be a Function or an object implementing the EventListener interface.");if(-1!==(n=this.indexOfListener(t,e)))if(s=this.bindings[n],this.dispatching&&!s.isOnce){var r=this.bindings.indexOf(s);-1!==r&&this.bindings.splice(r,1)}else s.destroy();return t},removeAll:function(i){var t,e=this.bindings,n=e.length;if(i)for(;n--;)(t=e[n]).context===i&&t.destroy();else{for(;n--;)e[n].destroy();e.length=0}},getNumListeners:function(){return this.bindings.length},getListeners:function(){return this.bindings.map(function(i){return i.listener})},halt:function(){this.shouldPropagate=!1},dispatch:function(i,e){var n,s;if(this.active){i=t.toArray(i),s=this.bindings.slice(),this.shouldPropagate=!0,this.dispatching++;try{for(n=s.length-1;n>=0&&!1!==s[n].execute(i,e)&&this.shouldPropagate;n--);}finally{if(this.dispatching--,this.bindings)for(n=0;n<s.length;n++)this.bindings.indexOf(s[n])<0&&s[n].destroy()}}},dispose:function(){this.removeAll(),this.active=!1,delete this.bindings},toString:function(){return"[Dispatcher active: "+this.active+" numListeners: "+this.getNumListeners()+"]"}});return n.Binding=n.prototype.Binding=e.extend({listener:null,isOnce:!1,context:null,dispatcher:null,priority:0,active:!0,init:function(i,t,e,n,s){this.listener=t,this.isOnce=e,this.context=n,this.dispatcher=i,this.priority=s||0},execute:function(t,e){var n,s=this.listener,r=i.is(this.context)?this.context:e;return this.active&&(this.isOnce&&this.detach(),n="function"==typeof s.handleEvent?s.handleEvent.apply(void 0===r?s:r,t||[]):s.apply(r,t||[])),n},detach:function(){return this.dispatcher&&this.dispatcher.remove(this.listener,this.context),this.listener},getListener:function(){return this.listener},dispose:function(){this.destroy()},destroy:function(){var i,t=this.dispatcher;t&&(i=t.bindings.indexOf(this),this.active=!1,-1!==i&&t.bindings.splice(i,1),delete this.dispatcher),delete this.isOnce,delete this.listener,delete this.context},toString:function(){return"[Dispatcher.Binding isOnce: "+this.isOnce+", active: "+this.active+"]"}}),i.namespace("Dispatcher",n,i)});