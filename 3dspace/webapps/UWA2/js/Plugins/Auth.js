define("UWA/Plugins/Auth",["UWA/Core","UWA/Plugins/Abstract","UWA/Utils/Client","UWA/Event","UWA/Controls/Form","UWA/Services/Auth"],function(t,e,i,n,s,o){"use strict";var a=e.extend({defaultOptions:{formOptions:{loginLabel:"Login",passwordLabel:"Password",logoutLabel:"Logout",submitLabel:"Sign In",loadingCredential:"Credentials validation loading...",requireCredential:"Authentication required!",invalidCredential:"Login / Password combination is incorrect."}},state:0,init:function(t,e){this.elements={},this._parent(t,e),this.auth=new o(this.options),this.saveWidgetBody(),i.isOnline()?(this.addEvent("onLoad",this.checkIdentity,this,1),this.addEvent("onRefresh",this.checkIdentity,this,1)):this.onAuthenticateFailure("offline")},checkIdentity:function(){return 0===this.state&&(this.state=1,this.onAuthenticateLoading(),this.auth.hasIdentity(this.onAuthenticateSuccess.bind(this),this.onAuthenticateFailure.bind(this))),4===this.state},onAuthenticateSuccess:function(){this.state=4,this.addLogout(),this.restoreWidgetBody(),this.dispatchEvent("onLoad")},onAuthenticateFailure:function(t){this.error=t,2===this.state&&(this.state=3),this.addForm()},onAuthenticateLoading:function(){this.addLoading()},onClearIdentity:function(){this.auth.clearIdentity(),this.state=0,this.addForm()},onFormSubmit:function(t){n.stop(t),this.elements.form.getField("signin").disabled=!0,this.onAuthenticateLoading(),this.state=2,this.auth.authenticate(this.onAuthenticateSuccess.bind(this),this.onAuthenticateFailure.bind(this),this.elements.form.getFormValues())},saveWidgetBody:function(){if(!this.widgetBody){var t,e,i=this.widget.body.getChildren();for(this.widgetBody=document.createDocumentFragment(),t=0,e=i.length;t<e;t++)this.widgetBody.appendChild(i[t])}},restoreWidgetBody:function(){this.widget.setBody(this.widgetBody),this.widgetBody=!1},addLoading:function(){var e=this.widget;this.elements.loading=e.createElement("p",{text:t.i18n(this.options.formOptions.loadingCredential),styles:{textAlign:"center"}}).inject(e.elements.body.empty())},addForm:function(){var e=t.i18n,i=this.widget,n=this.options.formOptions;this.removeLogout(),this.elements.form=new s({fields:[{type:"img",src:n.logoUrl},{type:"html",html:{tag:"p",title:this.error&&(this.error.message||this.error),text:3===this.state?n.invalidCredential:n.requireCredential,styles:{textAlign:"center"}}},{type:"text",name:"login",label:e(n.loginLabel),value:""},{type:"password",name:"password",label:e(n.passwordLabel),value:""},{type:"submit",name:"signin",value:e(n.submitLabel)},{type:"html",html:[{tag:"b",text:n.warningTitle},{tag:"p",text:n.warningText,styles:{textAlign:"justify"}}]}],events:{onSubmit:this.onFormSubmit.bind(this)}}).inject(i.elements.body.empty()),"vista"!==i.environment.name&&this.elements.form.getField("login").focus()},removeLogout:function(){var t=this.elements.logout;t&&t.remove()},addLogout:function(){var e=this,i=e.widget,s=t.i18n(e.options.formOptions.logoutLabel);e.elements.logout=i.createElement("a",{title:s,styles:{border:"none",position:"absolute",top:"0px",right:"5px"},html:{tag:"img",src:t.hosts.uwa+t.paths.css+"base/img/logout.png",height:18,width:20,alt:s},events:{click:function(t){n.stop(t),e.onClearIdentity()}}}).inject(i.elements.content)}});return t.namespace("Plugins/Auth",a,t)});