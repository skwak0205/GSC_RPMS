define("UWA/Plugins/Ecosystem",["UWA/Core","UWA/Plugins/Abstract","UWA/Utils","UWA/Utils/Client","UWA/Data","UWA/Storage"],function(t,s,e,a,i,n){"use strict";var u=s.extend({defaultOptions:{api:t.hosts.ecosystem.replace("://","://api."),front:t.hosts.ecosystem,interval:86400,messages:{unavailable:"This Application is not available because it's under maintenance.",suspended:"This Application is not available because it's suspended."}},status:["unknown","online","unavailable","suspended"],init:function(t,s){this._parent(t,s),this.database=new n({database:"__plugin_ecosystem_"+e.getCheckSum(t.getUrl())}),a.isOnline()&&this.addEvent("onLoad",this.checkStatus)},checkStatus:function(){var s=this.getStatus();return this.database.isReady?t.is(s)?(this.removeEvent("onLoad",this.checkStatus),this.checkStatusComplete(s)):i.request(this.options.api+"/widget/status",{onComplete:this.checkStatusComplete.bind(this),onFailure:this.checkStatusFailure.bind(this),cache:!1,type:"json",data:{url:this.widget.getUrl(),format:"json"}}):this.environment.setDelayed("EcosystemCheckStatus",this.checkStatus.bind(this),5e3),!1},checkStatusComplete:function(t){var s=this.status,e=t.state?parseInt(t.state,10):1;this.saveStatus(e),e>1?this.setStatusMessage(s[e]):this.dispatchEvent("onLoad")},checkStatusFailure:function(){this.saveStatus(0),this.dispatchEvent("onLoad")},getStatus:function(){var s=this.database.get("status"),e=parseInt(this.database.get("status_timestamp"),10),a=Math.round(Date.now()/1e3)-this.options.interval;return!t.is(s)||e<a?null:s},saveStatus:function(t){this.database.set("status",t),this.database.set("status_timestamp",Math.round(Date.now()/1e3))},setStatusMessage:function(s,e){var a=t.i18n,i=this.widget;e=e||this.options.messages[s],i.setTitle(a("Unavailable Application")),i.setBody(a(e))}});return t.namespace("Plugins/Ecosystem",u,t)});