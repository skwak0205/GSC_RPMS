define("UWA/Controls/ThemedScroller",["UWA/Core","UWA/Utils","UWA/Utils/Client","UWA/Controls/Abstract","UWA/Controls/Drag","UWA/Class/Timed"],function(t,e,s,i,o,n){"use strict";var l=!1;function r(){if(!1!==l)return l;var e=t.createElement("div",{class:"uwa-themed-scroller-content no-native-scrollbars",styles:{width:"100px",height:"100px",position:"absolute",visibility:"hidden",top:"0",left:"0",overflow:"scroll"}});return document.body.appendChild(e),l=e.offsetWidth-e.clientWidth,document.body.removeChild(e),l}function a(t){t.event&&(t=t.event);var e,s=t.changedTouches||t.touches||[t],i={x:0,y:0},o=s.length;for(e=0;e<o;e++)i.x+=s[e].clientX/o,i.y+=s[e].clientY/o;return i}var c={delta:0,coef:1,active:!1,visible:!1,scrollSize:0,scrollPosition:0,offsetSize:0},h=o.extend({defaultOptions:{touchSnap:0,touchDelay:0},init:function(t,e){this._parent(e),this.scroller=t,this.direction=this.element.className.contains("scrollbar-y")?"y":"x"},_getInfos:function(){return this.scroller._infos[this.direction]},_getPosition:function(){var t=this.element.getBoundingClientRect()["y"===this.direction?"top":"left"];return a(this.currentEvent)[this.direction]-t},start:function(t){this._parent(t),this._getInfos().active=!0,this.scroller.update(),this.position=this._getPosition()},move:function(t,e){this._parent(t,e);var s=this._getInfos();s.delta=(this._getPosition()-this.position)*s.coef,s.active=!0,this.scroller.updateVisible()},stop:function(){this._parent(),this.scroller.updateActive(this.currentEvent)}}),d=i.extend(n,{name:"uwa-themed-scroller",options:{element:null,scrollbars:"auto",scrollbarsMargin:4,scrollbarsMinSize:50,shadows:!1},init:function(e){t.is(e)&&t.is(e.element)&&t.extendElement(e.element),this._parent(e),this._elementEvents={mousemove:this.updateActive.bind(this),mouseout:this.updateActive.bind(this)},"auto"===this.options.scrollbars&&(this.options.scrollbars=0===r()?"native":"virtual"),this._buildElements(),this._initElements(),this.initInfos()},initInfos:function(){this._infos={x:Object.create(c),y:Object.create(c)},this.setPeriodical("update",this.update,1e3),this.update()},destroy:function(){if(this.options.element){var t=this.elements.container;t.removeEvents(this._elementEvents).removeClassName(this.getClassNames()).setContent(this.elements.content.childNodes);var e=t.destroy;t.destroy=function(){},this._parent(),t.destroy=e}else this._parent()},onInjected:function(){this.initInfos()},_buildElements:function(){var e=this.options.element||t.createElement("div");this.elements.container=e,this.elements.content=t.createElement("div",{html:e.childNodes}).inject(e)},_initElements:function(){var t=this.elements.container,e=this.elements.content;t.addClassName(this.getClassNames()).addEvents(this._elementEvents);var s="native"===this.options.scrollbars,i=s?"native-scrollbars ":"no-native-scrollbars ";e.addClassName(i+this.getClassNames("-content")).addEvent("scroll",this.updateVisible.bind(this)),s||e.setStyles({right:-r(),bottom:-r()})},getInnerElement:function(){return this.elements.content},getScrollbar:function(e,s){var i=this.elements[e+"Scrollbar"];return!i&&s&&(i=this.elements[e+"Scrollbar"]=t.createElement("div",{class:this.getClassNames("-scrollbar","-scrollbar-"+e)}).inject(this.elements.container),new h(this,{element:i,root:this.elements.container}),i.clientHeight),i},getShadow:function(e,s){var i=this.elements[e+"Shadow"];return!i&&s&&(i=this.elements[e+"Shadow"]=t.createElement("div",{class:this.getClassNames("-shadow","-shadow-"+e)}).inject(this.elements.container)),i},showShadow:function(t,e){var s=this.getShadow(t,e);e?(e>100&&(e=100),s.setStyle("opacity",e/100).addClassName("active")):s&&s.removeClassName("active")},updateActive:function(t){if("virtual"===this.options.scrollbars){if("mouseout"===t.type||"touchend"===t.type)this._infos.x.active=this._infos.y.active=!1;else{var e=this.elements.container.getBoundingClientRect(),s=a(t);["x","y"].forEach(function(t,o){var n=e[o?"right":"bottom"];this._infos[t].active=i(n-12,s[o?"x":"y"],n)&&i(e[o?"top":"left"],s[t],e[o?"bottom":"right"])},this)}this.updateVisible()}function i(t,e,s){return t<e&&e<s}},updateVisible:function(){this._infos.x.visible=this._infos.y.visible=!0,this.setDelayed("scrollbars-visible",function(){this._infos.x.visible=this._infos.y.visible=!1,this.update()},1e3),this.update()},_read:function(t){var e=this._infos[t?"y":"x"],s=this.elements.content,i=r();e.scrollSize=s[t?"scrollHeight":"scrollWidth"],e.scrollPosition=s[t?"scrollTop":"scrollLeft"]+e.delta,e.offsetSize=s[t?"offsetHeight":"offsetWidth"]-i,e.scrollPosition<0?e.scrollPosition=0:e.scrollPosition>e.scrollSize-e.offsetSize&&(e.scrollPosition=e.scrollSize-e.offsetSize)},_write:function(t){var e=t?"y":"x",s=this._infos[e],i=this.options;if(s.delta&&(this.elements.content[t?"scrollTop":"scrollLeft"]=s.scrollPosition,s.delta=0),"virtual"===this.options.scrollbars){var o=s.scrollSize>s.offsetSize+1,n=this.getScrollbar(e,o);if(o&&s.scrollSize){var l=s.offsetSize-2*i.scrollbarsMargin,r=l*(s.offsetSize/s.scrollSize);r<i.scrollbarsMinSize&&(r=i.scrollbarsMinSize),s.coef=(s.scrollSize-s.offsetSize)/(l-r),n.style[t?"top":"left"]=i.scrollbarsMargin+s.scrollPosition/s.coef+"px",n.style[t?"height":"width"]=r+"px",n.toggleClassName("active",s.active).toggleClassName("visible",s.visible)}else n&&n.removeClassName("active").removeClassName("visible")}i.shadows&&s.offsetSize&&(this.showShadow(e+"-start",s.scrollPosition),this.showShadow(e+"-end",s.scrollSize-s.scrollPosition-s.offsetSize))},update:function(){this.setAnimate("update",function(){this._read(!1),this._read(!0),t.equals(this._previousInfos,this._infos)||(this._write(!1),this._write(!0),this._previousInfos=t.clone(this._infos))})}});return t.namespace("Controls/ThemedScroller",d,t)});