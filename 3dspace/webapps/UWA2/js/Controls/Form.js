define("UWA/Controls/Form",["UWA/Core","UWA/String","UWA/Utils","UWA/Event","UWA/Json","UWA/Controls/Abstract","UWA/Controls/Input"],function(e,t,n,a,l,i,s){"use strict";var c=i.extend({id:null,defaultOptions:{className:"uwa-form",fields:[],labelPreffix:":",nativeInputs:!1,darkBackground:!1},init:function(e){this._parent(e),this.id=n.random(10),this.buildSkeleton()},buildSkeleton:function(){var t,n,l,i=this.options,s=this.options.fields,c=this.fields,r=[],o=e.createElement("form",{class:i.className,id:this.id,events:{submit:function(e){a.stop(e),this.dispatchEvent("onSubmit",[e,this.getFormValues()])}.bind(this)}});for(i.nativeInputs||o.addClassName("uwa-form-uikit"),t=0,n=s.length;t<n;t++)"hidden"!==(l=s[t]).type&&(void 0===c[l.type]&&(l.type="text"),l.id="m_"+this.id+"_"+l.name,r.push(c[l.type](l,i,this)));e.createElement("fieldset",{html:r}).inject(o),this.elements.container=o},getFields:function(){var e=this.elements.container,t=n.toArray(e.getElementsByTagName("textarea")),a=n.toArray(e.getElementsByTagName("input")),l=n.toArray(e.getElementsByTagName("select"));return a.concat(l).concat(t)},getField:function(e){var t,n,a,l=this.getFields();for(t=0,n=l.length;t<n;t++)if((a=l[t]).name===e)return a},getFormValues:function(){var e,t,n={},a=this.getFields();function l(e){return e.getElements("option").filter(function(e){return e.selected}).map(function(e){return e.value})}for(e=0,t=a.length;e<t;e++){var i=a[e];switch(i.type){case"button":case"submit":break;case"password":""!==i.value&&(n[i.name]=i.value);break;case"checkbox":n[i.name]=Boolean(i.checked),"string"==typeof i.value&&(n[i.name]=String(n[i.name]));break;case"radio":i.checked&&(n[i.name]=i.value);break;default:"select"===i.getTagName()&&i.multiple?n[i.name]=l(i):n[i.name]=i.value}}return n},getFormValue:function(e){return this.getFormValues()[e]},setFormValues:function(e){var t,n,a,l,i=this.getFields();for(t=0,n=i.length;t<n;t++)if(a=i[t],e.hasOwnProperty(a.name))switch(l=e[a.name],a.type){case"password":case"button":case"submit":break;case"checkbox":a.checked=Boolean(l);break;case"radio":a.checked&&String(a.value)===l&&(a.checked=Boolean(l));break;default:a.value=l}},setFormValue:function(e,t){var n={};n[e]=t,this.setFormValues(n)},fields:{text:function(n,a,l){var i=e.createElement("input",{type:"text",id:n.id,class:n.type+" small",name:n.name,value:n.value||"",autocomplete:"off",autocorrect:"off",autocapitalize:"off"});return n.onchange&&i.addEvent("keyup",function(){this.dispatchEvent("onChange",[n.onchange,n.name,i.value])}.bind(l)),e.createElement("div",{class:"field field"+t.ucfirst(n.type),html:[{tag:"label",for:n.id,text:e.i18n((n.label||n.name)+a.labelPreffix)},{tag:"span",content:a.nativeInputs?i:new s.Text({_root:!1,element:i,className:"small"})}]})},password:function(n,a,l){var i=e.createElement("input",{type:"password",id:n.id,class:n.type,name:n.name,value:n.value||""});return n.onchange&&i.addEvent("keyup",function(){this.dispatchEvent("onChange",[n.onchange,n.name,i.value])}.bind(l)),e.createElement("div",{class:"field field"+t.ucfirst(n.type),html:[{tag:"label",for:n.id,text:e.i18n((n.label||n.name)+a.labelPreffix)},{tag:"span",content:a.nativeInputs?i:new s.Text({_root:!1,element:i,className:"small"})}]})},submit:function(n,a){var l=e.createElement("input",{id:n.id,class:n.type,type:"submit",name:n.name,value:n.value||e.i18n("Done")});return e.createElement("div",{class:"field field"+t.ucfirst(n.type),html:{tag:"span",content:a.nativeInputs?l:new s.Button({_root:!1,element:l,className:"light-grey small"})}})},button:function(n,a){var l=e.createElement("button",{id:n.id,class:n.type,name:n.name,text:n.value||e.i18n("Done")});return e.createElement("div",{class:"field field"+t.ucfirst(n.type),html:{tag:"span",content:a.nativeInputs?l:new s.Button({_root:!1,element:l,className:"light-grey small"})}})},reset:function(n,a){var l=e.createElement("button",{id:n.id,type:"reset",class:n.type,name:n.name,value:n.value||e.i18n("Done")});return e.createElement("div",{class:"field field"+t.ucfirst(n.type),html:{tag:"span",content:a.nativeInputs?l:new s.Button({_root:!1,element:l,className:"light-grey small"})}})},boolean:function(n,a,l){var i,c=n.id,r=e.createElement("div",{class:"field field"+t.ucfirst(n.type)}),o="string"!=typeof n.value||"true",u=n.value&&(!0===n.value||"true"===n.value);return e.createElement("label",{for:c,text:e.i18n(n.label||n.name)}).inject(r),i=e.createElement("input",{id:c,value:o,type:"checkbox",class:n.type+" "+(u?"checked":"unchecked"),name:n.name}),u&&(i.setAttribute("checked","checked"),i.defaultChecked=!0),i.addEvent("change",function(){var e=i.checked;i.addClassName(e?"checked":"unchecked"),i.removeClassName(e?"unchecked":"checked"),n.onchange&&this.dispatchEvent("onChange",[n.onchange,n.name,e?"true":"false"])}.bind(l)),e.createElement("span",{html:a.nativeInputs?i:new s.Checkbox({_root:!1,element:i,className:a.darkBackground?"green":""})}).inject(r),r},textarea:function(n,a,l){var i=e.createElement("textarea",{id:n.id,class:n.type+" small",name:n.name,text:n.value||""});return n.onchange&&i.addEvent("keyup",function(){this.dispatchEvent("onChange",[n.onchange,n.name,i.value])}.bind(l)),e.createElement("div",{class:"field field"+t.ucfirst(n.type),html:[{tag:"label",for:n.id,text:e.i18n((n.label||n.name)+a.labelPreffix)},a.nativeInputs?i:new s.Text({_root:!1,element:i})]})},range:function(n,a,l){var i,c,r,o,u=n.id,m=e.createElement("div",{class:"field field"+t.ucfirst(n.type)});if(e.createElement("label",{for:u,text:e.i18n((n.label||n.name)+a.labelPreffix)}).inject(m),r=e.createElement("span").inject(m),o=e.createElement("select",{id:"m_"+l.id+"_"+n.name,class:"range",name:n.name}).inject(r),n.step=parseInt(n.step,10),n.max=parseInt(n.max,10),n.min=parseInt(n.min,10),n.step>0)for(i=n.min;i<=n.max;i+=n.step)c=e.createElement("option",{value:i,text:String(i)}),n.value&&parseInt(n.value,10)===i&&(c.setAttribute("selected","selected"),c.selected=!0),o.appendChild(c);return n.onchange&&o.addEvent("change",function(){this.dispatchEvent("onChange",[n.onchange,n.name,o.value])}.bind(l)),a.nativeInputs||new s.Select({_root:!1,element:o,className:"small"}),m},list:function(a,l,i){var c,r,o,u,m,d,f="m_"+i.id+"_"+a.name,h=e.createElement("div",{class:"field field"+t.ucfirst(a.type)});if(e.createElement("label",{for:f,text:e.i18n((a.label||a.name)+l.labelPreffix)}).inject(h),m=e.createElement("span").inject(h),d=e.createElement("select",{id:"m_"+i.id+"_"+a.name,class:"list",name:a.name,multiple:Boolean(a.multiple)}).inject(m),e.is(a.options,"array")&&a.options.length>0){var p=n.splat(a.value).map(function(e){return String(e)});for(c=0,r=a.options.length;c<r;c++)(o=a.options[c]).label=o.label||o.value,u=e.createElement("option",{text:e.i18n(o.label),value:o.value}).inject(d),p.indexOf(String(o.value))>=0&&(u.setAttribute("selected","selected"),u.selected=!0);a.onchange&&d.addEvent("change",function(){this.dispatchEvent("onChange",[a.onchange,a.name,d.value])}.bind(i))}else h.hide();return l.nativeInputs||new s.Select({_root:!1,element:d,className:"small"}),h},checklist:function(a,i,c){var r,o,u,m,d,f=[],h="m_"+c.id+"_"+a.name,p=e.createElement("div",{class:"field field"+t.ucfirst(a.type)});if(e.createElement("label",{for:h,text:e.i18n((a.label||a.name)+i.labelPreffix)}).inject(p),m=e.createElement("span",{class:a.type}).inject(p),d=e.createElement("input",{id:"m_"+c.id+"_"+a.name,name:a.name,type:"hidden",value:e.is(a.value,"array")?l.encode(a.value):a.value}).inject(m),e.is(a.options,"array")&&a.options.length>0){var v=e.is(a.value,"array")?a.value:l.decode(a.value),g=n.splat(v).map(function(e){return String(e)});for(r=0,o=a.options.length;r<o;r++){(u=a.options[r]).label=u.label||u.value;var b=g.indexOf(String(u.value))>=0,E=e.createElement("p").inject(m),y=e.createElement("input",{value:u.value,type:"checkbox",name:u.value,checked:b});f.push(y),y.addEvent("change",function(){var e=[];f.forEach(function(t){t.checked&&e.push(t.value)}),d.value=l.encode(e),a.onchange&&this.dispatchEvent("onChange",[a.onchange,a.name,d.value])}.bind(c)),e.createElement("span",{html:i.nativeInputs?y:new s.Checkbox({_root:!1,className:i.darkBackground?"green":"",element:y})}).inject(E),e.createElement("label",{text:e.i18n(u.label)}).inject(E)}}else p.hide();return p},html:function(n){return e.createElement("div",{class:"field field"+t.ucfirst(n.type),html:{tag:"div",html:n.html}})},img:function(n){var a=e.i18n(n.label||n.name)||"";return e.createElement("div",{class:"field field"+t.ucfirst(n.type),html:{tag:"img",src:n.src,height:n.height||"auto",width:n.width||"100%",alt:a,title:a}})}}});return e.namespace("Controls/Form",c,e)});