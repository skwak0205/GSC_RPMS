define("UWA/Controls/Ellipsis",["UWA/Core","UWA/Controls/Abstract"],function(t,e){"use strict";var s=e.extend({defaultOptions:{reference:null,refreshOn:[],ellipsis:"&#8230;",spaces:/[\s,.:]+/g},init:function(e,s){this._parent(s),s=this.options,this.element=e,this.ellipsis=t.createElement("span",{html:this.options.ellipsis})},destroy:function(){this.ellipsis.destroy()},onRefresh:function(){var t,e,s,i,o,n=this.element,l=this.options.reference||n;if(n.offsetWidth){for(this.dispatchEvent("onPreRefresh"),this.totalWords||(this.totalWords=this.computeData(n)),t=Math.floor(this.totalWords/2),e=Math.ceil(t/2)||1,n.appendChild(this.ellipsis),o=10;o>0;o-=1){if(this.setWordCount(n,t),s=l.offsetHeight+1<l.scrollHeight,t>=this.totalWords&&!s){n.removeChild(this.ellipsis);break}if(1===e){if(void 0!==i&&i!==s)break;i=s}t+=s?-e:e,e=Math.ceil(e/2)}s&&this.setWordCount(n,t-1),this.dispatchEvent("onPostRefresh")}return this},setWordCount:function(t,e){var s,i,o,n,l,h,r=e;if(t===this.ellipsis)return 0;if(t!==this.element&&(t.style.display=e?"":"none"),e||t===this.element)if(s=t.childNodes.length)for(l=0;l<s;l+=1)3===(h=t.childNodes[l]).nodeType?(o=t.ellipsisData[l].spaces,i=t.ellipsisData[l].original,n=o.length,h.data=r?!n||n+1<=r?i:i.substr(0,o[r-1]||0):"",r-=Math.min(r,n+1)):1===h.nodeType&&(r-=r-this.setWordCount(h,r));else r=e-1;return r},computeData:function(t){var e,s,i,o,n,l,h,r,a,p=t.ellipsisData=[],d=t.childNodes,f=0;for(e=0,s=d.length;e<s;e+=1)if(3===(n=d[e]).nodeType){for(p[e]={original:r=n.data,spaces:h=r.match(this.options.spaces)||[]},i=0,o=h.length;i<o;i+=1)a=r.indexOf(h[i],i?a+l:0),l=h[i].length,h[i]=a;h[o-1]+l===r.length&&h.pop(),0===h[0]&&h.shift(),f+=h.length+1}else 1===n.nodeType&&(f+=this.computeData(n));return f}});return t.namespace("Controls/Ellipsis",s,t)});