define("UWA/Controls/WidgetPopupMenu",["UWA/Core","UWA/Element","UWA/Event","UWA/Utils","UWA/Controls/DropDown"],function(t,e,n,i,s){"use strict";var a=s.extend({name:"uwa-widget-popup-menu",init:function(t){this._parent(),this.env=t,this.items=null},setTarget:function(t){return this.target=t,this},onClick:function(t){this._parent(t);var e=n.findElement(t,"li"),i=this.env.widget.getMenu(e.getAttribute("data-name"));i&&this.env.dispatchEvent("onMenuExecute",[i])},onClickOutside:function(t){n.getElement(t)!==this.target&&this.hide()},setPosition:function(){var t,n=this.env.html.moduleFrame||this.env.html.wrapper,i=e.getOffsets.call(n),s=e.getSize.call(n),a=e.getOffsets.call(this.target),o=e.getSize.call(this.target);return{x:a.x,y:a.y+o.height},t={boundary:{x:0,y:a.y+o.height,width:i.x+s.width,height:1/0}},this._parent(a,t)},getInnerElement:function(){return this.getContent(),this.elements.inner},getContent:function(){var e=this.elements;return e.inner||this._parent().setContent(e.inner=t.createElement("menu",{type:"popup"})),e.container},setItems:function(t){return this.items=t,this},toggle:function(){this.getInnerElement().empty(),this.items.forEach(this.addItem,this),this.setPosition(),this._parent()},onShow:function(){this.target.addClassName("active"),this._parent()},onHide:function(){this.target.removeClassName("active"),this._parent()},addItem:function(e){var n,s;if(!1!==(t.is(e.visible,"function")?e.visible():!1!==e.visible))return n=t.createElement("li",{class:this.getClassNames("-item"),"data-name":e.name}),e.icon&&(s=t.createElement("span",{class:"uwa-icon uwa-icon-only"}),1===this._getUtf8StringLength(e.icon)?(s.set("data-icon",e.icon),s.addClassName("uwa-icon-unicode")):i.isAbsoluteUrl(e.icon)?s.adopt(t.createElement("img",{src:e.icon,width:16,height:16})):s.addClassName(e.icon),s.inject(n)),e.label&&t.createElement("span",{text:e.label}).inject(n),(t.is(e.disabled,"function")?e.disabled():!!e.disabled)&&n.addClassName("disabled"),n.inject(this.getInnerElement())},_getUtf8StringLength:function(t){var e=encodeURIComponent(t).match(/%[89ABab]/g);return t.length+(e?e.length:0)}});return t.namespace("Controls/WidgetPopupMenu",a,t)});