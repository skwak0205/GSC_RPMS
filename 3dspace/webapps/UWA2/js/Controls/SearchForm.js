define("UWA/Controls/SearchForm",["UWA/Core","UWA/Utils/Client","UWA/Json","UWA/Event","UWA/Class/Timed","UWA/Controls/Abstract"],function(t,e,i,s,n,o){"use strict";var h=o.extend(n,{name:"uwa-searchform",defaultOptions:{searchText:"",faviconUrl:"",submitButton:"button",className:"nv-search",showCheckbox:!1,showHistory:!1,allowEmpty:!1,dir:"ltr",limit:10},init:function(t){this.historyList=[],this._parent(t),this.buildSkeleton(),this.options.faviconUrl&&this.setFavicon(t.faviconUrl),this.options.searchText&&this.setSearchText(t.searchText)},setOptions:function(t){(t=t||{}).searchHistory&&(t.showHistory=!0),this._parent(t)},setInitialState:function(t,e){this.setFavicon(t),this.setSearchText(e),this.setCheckboxState(e)},buildSkeleton:function(){var e,i,s=t.i18n,n=this.options,o=this.elements;e=t.createElement("div",{class:"search "+this.getClassNames()}),o.form=t.createElement("form",{events:{submit:this.dispatchAsEventListener("onSubmitByHistoryLink")}}).inject(e),o.favicon=t.createElement("img",{class:"favicon",src:t.hosts.uwa+t.paths.css+"base/img/s.gif",width:16,height:16,styles:{display:"none"}}).inject(o.form),o.inputWrapper=t.createElement("span",{class:"input-wrapper"}).inject(o.form),o.inputSearch=t.createElement("input",{class:"search",type:"text",value:"",events:{focus:this.dispatchAsEventListener("onFocusSearch"),blur:this.dispatchAsEventListener("onBlurSearch"),click:this.dispatchAsEventListener("onClickSearch"),keypress:this.dispatchAsEventListener("onSearchKeyPress")}}).inject(o.inputWrapper),o.resetButton=t.createElement("img",{class:"clear",alt:s("Clear"),title:s("Clear"),src:t.hosts.uwa+t.paths.css+"base/img/clear.gif",events:{click:this.dispatchAsEventListener("onResetSearch")},styles:{display:"none"}}).inject(o.inputWrapper),i=n.submitButton&&"string"!=typeof n.submitButton?n.submitButton:"icon"===n.submitButton?t.createElement("a",{"data-icon":"U",class:"uwa-icon uwa-icon-only",alt:t.i18n("Search"),events:{click:this.dispatchAsEventListener("onSubmitByHistoryLink")}}):t.createElement("input",{type:"submit",value:t.i18n("Search")}),o.inputWrapper.addContent(i),o.inputWrapper.lastChild.addClassName("submit"),n.showCheckbox&&(o.checkbox=t.createElement("input",{class:"check",type:"checkbox",title:n.checkboxTitle||"",value:"",events:{click:this.dispatchAsEventListener("onToggleSearch")}}).inject(o.form),"rtl"===n.dir?o.checkbox.setStyle("left","5px"):o.checkbox.setStyle("right","5px")),this.inputSearch=o.inputSearch,this.form=o.form,this.container=e},buildHistoryBox:function(){this.hideHistory();var e=this,i=e.elements,n=i.inputSearch,o=n.getSize(),h=e.getSearchText(),r=e.historyList,c=t.createElement("ul",{class:"uwa-popup-menu",events:{click:function(i){s.stop(i);var n=t.Event.getElement(i).getText();e.setSearchText(n),e.dispatchEvent("onSubmitByHistoryLink",[i])}}});r.forEach(function(t){h!==t&&e.getHistoryBoxItem(t).inject(c)}),t.createElement("li",{class:"uwa-popup-menu-item action",html:{tag:"a",text:t.i18n("Clear recent searches"),events:{click:function(t){s.stop(t),e.clearHistory()}}}}).inject(c),c.inject(i.form),c.setStyles({width:o.width-n.getComputedSize("borderWidth")+"px"}),c.setPosition({x:0,y:o.height-n.getComputedSize("borderWidth")},{relative:n}),i.historyBox=c},getHistoryBoxItem:function(e){return t.createElement("li",{class:"uwa-popup-menu-item",html:{tag:"a",href:"#history:"+e,html:{tag:"span",text:e}}})},setFavicon:function(t,e){var i=this.elements.favicon;i.src=t,i.alt=i.title=e,i[t&&t.length?"show":"hide"]()},setSearchText:function(t){var e=this.elements,i=e.inputSearch,s=e.resetButton;i.value=t||"",s[t&&t.length?"show":"hide"](),this.addHistory(t)},getSearchText:function(){return this.elements.inputSearch.value},setCheckboxState:function(t){var e=this.elements.checkbox;e&&(t?(e.setAttribute("checked","checked"),e.defaultChecked=!0):(e.setAttribute("checked",""),e.defaultChecked=!1))},getCheckboxState:function(){var t=this.elements.checkbox;return t&&"checked"===t.getAttribute("checked")},setHistoryString:function(e){var s=[];t.is(e,"string")&&i.isJson(e)&&(e=i.decode(e)),t.is(e,"array")?s=e:t.is(e)&&(s=String(e).split(":")),s.forEach(this.addHistory,this)},getHistoryString:function(){return i.encode(this.historyList)},addHistory:function(e){var i=this.historyList,s=i.indexOf(e);t.is(e,"string")&&e.length>0&&(s>-1&&i.splice(s,1),i.unshift(e),i.length>this.options.limit&&i.pop(),this.dispatchEvent("updateHistory"))},clearHistory:function(){this.historyList=[],this.dispatchEvent("updateHistory"),this.hideHistory()},hideHistory:function(){this.elements.historyBox&&this.elements.historyBox.destroy(),this.elements.historyBox=null},showHistory:function(){var t=this.historyList,e=this.getSearchText();this.options.showHistory&&(t.length>1||1===t.length&&t[0]!==e)&&this.buildHistoryBox()},toggleHistory:function(){this.options.showHistory&&(this.elements.historyList?this.hideHistory():this.showHistory())},onSubmitSearch:function(t,e){this.hideHistory(),this.setSearchText(t),this.dispatchEvent("submit",[t,e])},onSubmitByHistoryLink:function(t){s.stop(t);var e=this.getSearchText(),i="onSubmitSearch";0!==e.trim().length||this.options.allowEmpty||(i="onResetSearch"),this.dispatchEvent(i,[e,this.getCheckboxState()])},onResetSearch:function(){this.hideHistory(),this.setSearchText(""),this.dispatchEvent("reset")},onToggleSearch:function(){this.dispatchEvent("toggle")},onFocusSearch:function(){this.dispatchEvent("focus"),this.clearDelayed("onBlurSearch")},onBlurSearch:function(){this.options.showHistory&&this.setDelayed("onBlurSearch",this.hideHistory,500,!1,this),this.dispatchEvent("blur")},onClickSearch:function(){this.options.showHistory&&this.toggleHistory()},onSearchKeyPress:function(){this.options.showHistory&&this.hideHistory()}});return t.namespace("Controls/SearchForm",h,t)});