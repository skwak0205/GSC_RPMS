define("UWA/Controls/Carousel",["UWA/Core","UWA/Class/Timed","UWA/Utils/Client","UWA/Event","UWA/Element","UWA/Controls/Abstract","UWA/Controls/Scroller"],function(t,e,s,i,o,l,n){"use strict";var r=l.extend(e,{defaultOptions:{className:"uwa-carousel",orientation:"horizontal",scrollSize:3,scrollerOptions:{lockDirection:!0,momentum:!1,scrollbarH:!1,scrollbarV:!1,scrollDrag:s.Features.touchEvents},nextButton:null,previousButton:null,scrollButtonClassName:"uwa-carousel-button",scrollDuration:300,autoScrollPressedDelay:500,itemSelector:"li"},init:function(e,s){this._parent(s),this.element=t.extendElement(e),this.elements.container=t.createElement("div",{class:this.options.className}).inject(this.element,"before").grab(this.element),this.initEvents(),this.options.scrollerOptions.scrollableY=this.isVertical(),this.options.scrollerOptions.scrollableX=!this.options.scrollerOptions.scrollableY,this.scroller=new n(e,t.merge({_root:!1},this.options.scrollerOptions)),this.scroller.addEvent("onMouseWheel",this.updateScrollButtonsDisabledState.bind(this)),this.scroller.addEvent("onScrollEnd",this.updateScrollButtonsDisabledState.bind(this)),this.scroller.addEvent("onRefresh",this.dispatchEvent.bind(this,"onRefresh"))},scrollHead:function(t){this.scrollToItem(this.element.firstChild,t)},scrollTail:function(t){this.scrollToItem(this.element.lastChild,t)},scrollNext:function(t){this.scrollTo("next",t)},scrollPrevious:function(t){this.scrollTo("previous",t)},scrollToItem:function(t,e){var s,i,o;this.hasDelayed("onRefresh")&&(this.clearDelayed("onRefresh"),this.onRefreshNoDelay()),isNaN(e)&&(e=this.options.scrollDuration),this.element.firstChild===t?s="start":this.element.lastChild===t?s="end":(i=this.getItems(),o=this.getVisibleItems(!0),s=i.indexOf(t)>i.indexOf(o[0])?"end":"before"),this.scroller.scrollToElement(t,s,e)},scrollTo:function(t,e,s){var i,o,l=this.getItems();e=e||this.options.scrollSize,isNaN(s)&&(s=this.options.scrollDuration),"next"===t?(i=l.indexOf(this.getLastItemVisible())+e,o="end"):"previous"===t&&(i=l.indexOf(this.getFirstItemVisible())-e,o="start"),i=Math.min(l.length-1,Math.max(0,i)),this.scroller.scrollToElement(l[i],o,s),this.updateScrollButtonsDisabledState()},isItemVisible:function(t,e){var s=this.isVertical()?"y":"x";return this.scroller.isInViewport(t,!1!==e,s)},getFirstItemVisible:function(){var t,e,s,i=this.getItems();for(e=0,s=i.length;e<s;e+=1)if(t=i[e],this.isItemVisible(t,!1))return t;return null},getLastItemVisible:function(){var t=this.getVisibleItems(!1);return t.length?t[t.length-1]:null},getVisibleItems:function(t){var e,s,i;return this.getItems().filter(function(o){return!0!==i?(e=this.isItemVisible(o,t),i=!1===e&&!0===s,s=e):e=!1,e},this)},nextButton:function(){return this.elements.nextButton||(this.elements.nextButton=this._createScrollButton("next")),this.elements.nextButton},previousButton:function(){return this.elements.previousButton||(this.elements.previousButton=this._createScrollButton("previous")),this.elements.previousButton},initEvents:function(){var t,e=s.Features.touchEvents,i={};i[e?"touchstart":"mousedown"]=this.onScrollButtonDown.bind(this),i[e?"touchend":"mouseup"]=this.onScrollButtonUp.bind(this),i.click=this.onScrollButtonClick.bind(this),(t=this.nextButton())&&(t.addEvents(i),t.setAttribute("data-scroll","next")),(t=this.previousButton())&&(t.addEvents(i),t.setAttribute("data-scroll","previous"))},onScrollButtonClick:function(t){if(!this.stopScroll()){var e=t.timeStamp||Date.now();this.lastClickTime&&e-this.lastClickTime<=300?(delete this.lastClickTime,this.onScrollButtonDblClick(t)):(i.preventDefault(t),this.lastClickTime=e,this.scrollTo(this.getScrollButtonFromEvent(t).getAttribute("data-scroll"),this.options.scrollSize))}},onScrollButtonDblClick:function(t){i.stop(t),this.scrollTo(this.getScrollButtonFromEvent(t).getAttribute("data-scroll"),this.getVisibleItems(!0).length)},onScrollButtonDown:function(t){this.setDelayed("pressedTimeout",this.autoScroll.bind(this,this.getScrollButtonFromEvent(t).getAttribute("data-scroll")),this.options.autoScrollPressedDelay)},onScrollButtonUp:function(){this.stopScroll()},autoScrollNext:function(){this.autoScroll("next")},autoScrollPrevious:function(){this.autoScroll("previous")},autoScroll:function(t){this.stopScroll(),this.setPeriodical("scrollTimer",function(){var e=this.scroller.getPosition(),s=this.isVertical()?"y":"x";"previous"===t?e[s]+=20:"next"===t&&(e[s]-=20),this.scroller.setPosition(e.x,e.y,0)}.bind(this),20)},stopScroll:function(){this.clearDelayed("pressedTimeout");var t=this.hasPeriodical("scrollTimer");return this.clearPeriodical("scrollTimer"),this.scroller.dragScrolling&&(this.scroller.dragScrolling=!1),t},onRefresh:function(){this.setDelayed("onRefresh",this.onRefreshNoDelay.bind(this),50)},onRefreshNoDelay:function(){if(this.isInjected()){var t,e=this.isVertical()?"y":"x",s=this.scroller.maxScroll[e];this.elements.container.hasAttribute("overflow")||this._updateOverflowStatus(),this._updateOverflowStatus(),this.scroller.dispatchEvent("onRefresh"),t=Math.abs(s)-Math.abs(this.scroller.maxScroll[e]),this.dispatchEvent("onScrollerResize",[{deltaScroll:t}]),this.updateScrollButtonsDisabledState()}},updateScrollButtonsDisabledState:function(){var t,e,s=this,i=s.elements,o=s.isVertical()?"y":"x";[i.nextButton,i.previousButton].forEach(function(l,n){l&&(t=s.scroller.isMaxPosition(o,!1,2*n-1),l.toggleClassName("disabled",t),e="max-scroll-"+l.getAttribute("data-scroll"),t?i.container.setAttribute(e,"true"):i.container.removeAttribute(e))})},hasOverflow:function(){return"true"===this.elements.container.getAttribute("overflow")},isVertical:function(){return"vertical"===this.options.orientation},getItems:function(){return this.element.getElements(this.options.itemSelector)},isInjected:function(){return!0!==this.injected&&(this.injected=this.elements.container&&this.elements.container.isInjected()),this.injected},getScrollButtonFromEvent:function(e){return t.Event.getElement(e).getClosest("."+this.options.scrollButtonClassName)},_createScrollButton:function(e){var s=this.options,i=e+"Button",o=!1;return!1!==s[i]&&(o=t.is(s[i],"function")?s[i](this.elements.container):t.is(s[i],"element")?s[i]:t.createElement("a",{class:s.scrollButtonClassName+" "+s.scrollButtonClassName+"-"+e}).grab(t.createElement("span")).inject(this.elements.container),o=t.extendElement(o)),o},_updateOverflowStatus:function(){var t=this.isVertical()?"y":"x",e=this.scroller.hasOverflow(t);this.elements.container.setAttribute("overflow",String(e)),this.scroller.setOptions({preventDefaultMouseWheel:e})}});return t.namespace("Controls/Carousel",r,t)});