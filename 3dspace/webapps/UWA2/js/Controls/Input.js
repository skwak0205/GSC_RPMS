define("UWA/Controls/Input",["UWA/Core","UWA/Event","UWA/Element","UWA/Utils","UWA/Utils/Client","UWA/Utils/Scroll","UWA/Controls/Abstract","UWA/Controls/DropDown","UWA/Controls/ThemedScroller","UWA/Class/Timed"],function(e,t,n,s,i,o,l,a,c,r){"use strict";var u=l.extend({options:{className:"",element:null,attributes:{},value:"",clickable:!0,mixed:!1},name:"uwa-input",_hiddenInput:!0,init:function(t){if(this.constructor===u)throw new Error("Use a subclass of Input");this._parent(t);var n=t&&t.element,s=n&&n.parentNode,i=n&&n.nextSibling;s&&s.removeChild(n),this.events=null,this.getContent(),e.owns(t,"value")&&this.setValue(t.value),s&&this.inject(i||s,i&&"before")},buildSkeleton:function(){var t=this.elements;this._hiddenInput?(t.input=this.options.element||this.buildInput(),t.content=e.createElement("div",{class:this.getClassNames("-content")}),t.input.addClassName(this.getClassNames("-input")+" hidden-input"),t.container=(this.options.container||e.createElement("div")).addContent(t.input,t.content)):t.content=t.container=t.input=this.options.element||this.options.container||this.buildInput(),t.input.set(this.options.attributes),t.container.addClassName(this.getClassNames()),this.options.clickable||this.elements.container.addClassName("not-clickable"),this.setDisabled(this.isDisabled())},_syncEvents:function(e){var t=this,n=this.elements;function s(e){return t.dispatchEvent.bind(t,e)}t.events||(t.events={container:{mouseenter:s("onMouseEnter"),mouseleave:s("onMouseLeave"),mousedown:function(e){this.addClassName("active"),t.dispatchEvent("onMouseDown",[e])},mouseup:function(){this.removeClassName("active")},click:s("onClick")},input:{change:s("onChange"),keydown:s("onKeyDown"),focus:t.focus.bind(t,!0,!1),blur:t.focus.bind(t,!1,!1)}}),t.isDisabled()?(n.container.removeEvents(t.events.container),n.input.removeEvents(t.events.input)):(t._hiddenInput&&e||n.container.addEvents(t.events.container),n.input.addEvents(t.events.input))},buildInput:function(){return e.createElement("input",{type:"text"})},syncInput:function(){this._hiddenInput&&this.elements.content&&this.elements.content.setText(this.getValue())},focus:function(e,t){return void 0===e&&(e=!0),n.toggleClassName.call(this.elements.container,"focus",e),!1!==t&&this.elements.input[e?"focus":"blur"](),this},isDisabled:function(){return Boolean(this.elements.input.disabled)},setDisabled:function(e){return void 0===e&&(e=!0),this.elements.input.disabled=e,this.elements.container.toggleClassName("disabled",e),this._syncEvents(),this},getValue:function(){var e=this.elements.input,t=e.getTagName();return"input"===t||"textarea"===t?e.value:e.getText()},setValue:function(e){var t=this.elements.input,n=t.getTagName();return"input"===n||"textarea"===n?t.value=e:t.setText(e),this.syncInput(),this},getContent:function(){return this.elements.container||(this.buildSkeleton(),this.syncInput()),this.elements.container},getInputElement:function(){return this.elements.input},_dispatchOnChange:function(){this.isDisabled()?this.syncInput():t.dispatchEvent(this.elements.input,"change")},onMouseEnter:function(){this.elements.container.addClassName("hover")},onMouseLeave:function(){this.elements.container.removeClassName("hover")},onMouseDown:function(e){this._hiddenInput&&!i.Features.touchEvents&&(t.preventDefault(e),this.focus())},onChange:function(e){this.syncInput(),this._bubbleOnChange(e)},_bubbleOnChange:function(){var e;return function(s){var i,o=this.elements.input.parentNode;if(!function(){if(void 0===e){e=!1;var s=document.createElement("div"),i=document.createElement("input");i.type="text",s.appendChild(i),s.style.display="none",document.body.appendChild(s),n.addEvent.call(s,"change",function(n){e=!0,t.stop(n)}),t.dispatchEvent(i,"change"),n.remove.call(s),n.removeEvents.call(s)}return e}())for(;o&&1===o.nodeType&&!1!==(s.event||s).returnValue;)(i=o._events&&o._events.change)&&i.handleEvent(s),o=o.parentNode}}(),onKeyDown:function(){this.syncInput()}});return u._ToggleInput=u.extend({options:{mixed:!1},name:"uwa-toggle",init:function(e){e=e||{},this._parent(e),e.mixed&&this.setMixed()},buildSkeleton:function(){this._parent(),this.elements.content.addClassName("uwa-icon")},setMixed:function(e){return this.elements.container[!1!==e?"addClassName":"removeClassName"]("mixed"),this},isChecked:function(){return this.elements.input.checked},focus:function(e){return this._parent(e),this.syncInput(),this},check:function(e){return this.elements.input.checked=!1!==e,this.syncInput(),this}}),u.Radio=u._ToggleInput.extend({name:"uwa-radio",buildInput:function(){return e.createElement("input",{type:"radio"})},onClick:function(e){this._parent(e);var t=this.elements.input;t.checked||(t.checked=!0,this._dispatchOnChange())},syncInput:function(){var e=this.elements.input,t=e.name,s=!1;function i(t){var i=t.parentNode;i&&n.hasClassName.call(i,"uwa-radio")&&n.toggleClassName.call(i,"checked",t.checked),s|=e===t}t&&Array.prototype.forEach.call(document.getElementsByName(t),i),s||i(e)}}),u.Checkbox=u._ToggleInput.extend(r,{name:"uwa-checkbox",buildInput:function(){return e.createElement("input",{type:"checkbox"})},onClick:function(e){this._parent(e),this.hasDelayed("extern-change-prevention")||this.setDelayed("extern-change-prevention",function(){this.elements.input.checked=!this.elements.input.checked,this.syncInput(),this._dispatchOnChange()},1)},onChange:function(e){this._parent(e),this.setDelayed("extern-change-prevention",function(){},1)},syncInput:function(){this.elements.container.toggleClassName("checked",this.elements.input.checked)}}),u.Select=u.extend(r,{name:"uwa-select",options:{options:[]},init:function(t){this._parent(t),e.owns(t,"options")&&this.putOptions(t.options),e.owns(t,"value")&&this.setValue(t.value)},focus:function(e){return this._parent(e),!1===e&&this.elements.dropdown.hide(),this},buildInput:function(){return e.createElement("select")},buildSkeleton:function(){var t,n=this.elements;this._parent();var s=n.container.getDocument().body;n.content.addContent([t=e.createElement("div",{class:this.getClassNames("-split"),html:[{tag:"div",class:this.getClassNames("-text")},{tag:"div",class:this.getClassNames("-button"),html:{tag:"div",class:"uwa-icon uwa-icon-only"}}]})]),n.dropdown=new a({className:this.options.className,global:!0,_root:!1,position:function(){var e=n.dropdown.getInnerElement(),t=n.container.getBoundingClientRect(),s=t.top,o=i.getSize().height-t.top-t.height,l=s>o;return e.toggleClassName("uwa-select-dropdown-top",l),e.getElement("> .uwa-select-split").inject(e,l?"bottom":"top"),e.setStyle("width",t.width),n.scroller.getContent().setStyle("height",Math.min(n.options.offsetHeight,l?s:o)),n.scroller.update(),{x:t.left,y:n.container.getOffsets().y-(l?Math.min(t.top,n.options.offsetHeight):0)}},positionOptions:{fit:"resize-max",relative:s},events:{onShow:function(){n.container&&(n.container.addClassName("dropdown-visible"),this._scrollToSelected())}.bind(this),onHide:function(){n.container&&n.container.removeClassName("dropdown-visible")},onRemoved:function(){n.container&&n.container.removeClassName("dropdown-visible")}}}),n.dropdown.getInnerElement().addClassName("uwa-select-dropdown"),n.dropdown.inject(n.content),n.options=e.createElement("div",{class:this.getClassNames("-options"),events:{mousedown:this._selectionHandler.bind(this)}}),n.scroller=new c({shadows:!1}),n.scroller.getInnerElement().addContent(n.options),n.dropdown.getInnerElement().setContent([t.cloneNode(!0),n.scroller]),this._isSingleLine()&&n.container.addClassName("single-line")},getValue:function(){return this._getSelectedOptions().map(function(e){return e.value})},setValue:function(e){var t=[];return e=s.splat(e),this._getOptions().forEach(function(n,s){-1!==e.indexOf(n.value)&&t.push(s)}),this.setSelection(t)},setSelection:function(e){return this._isMultiple()||(e=e.slice(0,1)),this._getOptions().forEach(function(t,n){t.selected=-1!==e.indexOf(n)}),this._dispatchOnChange(),this},getSelection:function(){var e=[];return this._getOptions().forEach(function(t,n){t.selected&&e.push(n)}),e},_isMultiple:function(){return this.elements.input.multiple},_isSingleLine:function(){return this.options.singleLine},_getOptions:function(){return this.elements.input.getElements("option")},_getSelectedOptions:function(){return this._getOptions().filter(function(e){return e.selected})},_dispatchOnChange:function(){this.clearDelayed("on-change-debounce"),this._parent()},_selectionHandler:function(e){t.stop(e),this._isMultiple()||(this.elements.dropdown.hide(),this.elements.container.removeClassName("hover"));var n,s,i=t.findElement(e,".option,.optgroup"),o=0,l=[],a=i.hasClassName("option"),c=!1;i.getParent().getChildren().some(function(e){if(a){if(i===e)return l.push(o),!0}else if(c){if(!e.hasClassName("option"))return!0;l.push(o)}else i===e&&(c=!0);e.hasClassName("option")&&(o+=1)}),this._isMultiple()&&(n=this.getSelection(),a?-1===(s=n.indexOf(l[0]))?n.push(l[0]):n.splice(s,1):l.some(function(e){return n.indexOf(e)<0})?l.forEach(function(e){n.indexOf(e)<0&&n.push(e)}):n=n.filter(function(e){return l.indexOf(e)<0}),l=n),this.setSelection(l)},syncInput:function(){var t=this.elements.input,s=this.elements;!this._getOptions().length||this._getSelectedOptions().length||this._isMultiple()||(this._getOptions()[0].selected=!0);var i,o,l=this._getSelectedOptions().map(n.getText.call,n.getText).join(", ")||" ";s.content.getElement(".uwa-select-text").setText(l),s.dropdown.getInnerElement().getElement(".uwa-select-text").setText(l),s.options.empty(!0).setContent((o=Array.prototype.map.call(t.getElementsByTagName("*"),function(t){var s=n.getTagName.call(t),o=e.createElement("div",{class:s+(t.selected?" selected":""),text:t.label||n.getText.call(t)||" "});return"optgroup"===s?(i&&i.addClassName("selected"),i=o):t.selected||(i=null),o}),i&&i.addClassName("selected"),o))},_scrollToSelected:function(){var e=this.elements.dropdown&&this.elements.dropdown.getInnerElement().getElement(".option.selected");e&&o.scrollToElement(e)},onClick:function(e){this._parent(e),this.elements.dropdown.show()},onKeyDown:function(e){var n=t.whichKey(e),s=!0;"space"===n?this.elements.dropdown.show():"return"===n?this.elements.dropdown.toggle():"esc"===n?this.elements.dropdown.hide():s=!1,s?t.preventDefault(e):(this._parent(e),this.setDelayed("scroll-to-selected",this._scrollToSelected,1))},putOptions:function(t,i){var o=this.elements.input;function l(e,t){var n,s=o.getElementsByTagName("*");for(n=0;n<s.length;n+=1)if(s[n][e]===t)return s[n]}return i&&n.empty.call(o,!0),s.splat(t).forEach(function(t){var s,i,a=l("value",t.value);void 0!==t.label?(a||(a=e.createElement("option")),n.set.call(a,{text:t.label,value:t.value,selected:t.selected}),t.group?((i=l("label",t.group))||(i=o.appendChild(e.createElement("optgroup",{label:t.group}))),i.appendChild(a)):o.appendChild(a)):a&&(s=a.parentNode,n.remove.call(a),s&&"optgroup"===n.getTagName.call(s)&&0===s.childNodes.length&&n.remove.call(s))}),this.syncInput(),this},removeOptions:function(e){this.putOptions(s.splat(e).map(function(e){return{value:"string"==typeof e?e:e.value}}))}}),u.File=u.extend({name:"uwa-file",buildInput:function(){return e.createElement("input",{type:"file"})},buildSkeleton:function(){this._parent(),this.options.buttonOnly?this.elements.content.addClassName("button-only"):this.elements.text=e.createElement("div",{class:this.getClassNames("-text")}),this.elements.content.addClassName(this.getClassNames("-split")).setContent([this.elements.text,e.createElement("div",{class:this.getClassNames("-button"),text:e.i18n("Browse...")})])},setValue:function(t){if(t)throw new Error("You can't set a value to a file input");var n,s=this.elements.input;s.value="",s.value&&((n=e.extendElement(e.clone(s))).inject(s,"before"),s.destroy(),this.elements.input=n,this._syncEvents(!0)),this.syncInput()},syncInput:function(){this.elements.text&&this.elements.text.setText(this.elements.input.value.replace(/^c:\\fakepath\\/i,"")||" ")}}),u.Text=u.extend(r,{name:"uwa-text",_hiddenInput:!1,options:{multiline:!1},buildInput:function(){return this.options.multiline?e.createElement("textarea"):e.createElement("input",{type:"text"})},buildSkeleton:function(){this._parent(),this.elements.input.addClassName(this.getClassNames("-text"))},onKeyDown:function(e){this._parent(e),this.setDelayed("placeholder-sync",this.syncInput,1)},onHide:function(){this._parent(),this.setDelayed("placeholder-sync",this.syncInput,1)},onShow:function(){this._parent(),this.setDelayed("placeholder-sync",this.syncInput,1)},onPostInject:function(){this.setDelayed("placeholder-sync",this.syncInput,50)},getInputElement:function(){return this.setDelayed("placeholder-sync",this.syncInput,1),this._parent()},syncInput:function(){var e=this.elements.input;i.Features.inputPlaceholder||(e.parentNode&&!this.getValue()&&e.getAttribute("placeholder")&&e.offsetHeight?this._showPlaceholder():this._hidePlaceholder())},_showPlaceholder:function(){var t,n,s=this.elements,i=s.input,o=i.getDimensions();s.placeholder||(this.setPeriodical("placeholder-sync",this.syncInput,1e3),s.placeholder=e.createElement("div",{class:this.getClassNames("-placeholder"),events:{click:this.focus.bind(this,!0)}})),o.width&&o.height?((n=i.getStyles(["font"])).height=o.innerHeight,n.width=o.innerWidth,"textarea"!==i.getTagName()&&(n.lineHeight=o.innerHeight+"px",n.whiteSpace="nowrap"),(t=i.getPosition()).x+=i.getComputedSize("marginLeft","paddingLeft","borderLeftWidth"),t.y+=i.getComputedSize("marginTop","paddingTop","borderTopWidth"),s.placeholder.set({text:i.getAttribute("placeholder"),styles:n}).setPosition(t),s.placeholder.previousSibling!==i&&s.placeholder.inject(i,"after")):this._hidePlaceholder()},_hidePlaceholder:function(){var e=this.elements.placeholder;e&&e.remove()}}),u.Password=u.Text.extend({options:{multiline:!1,attributes:{type:"password"}}}),u.Button=u.extend({name:"uwa-button",options:{className:"dark-grey"},_hiddenInput:!1,init:function(t){e.owns(t,"className")&&(t.className=t.className.replace(/\bblack\b/,"dark-grey"),/\b(?:iconl|iconr|icon-only)\b/.test(t.className)&&(t.className+=" uwa-icon"),/\b(?:dark-grey)\b/.test(t.className)&&(t.className+=" icon-separated")),this._parent(t),/\b(?:icon-only)\b/.test(this.options.className)&&this.setValue(" ")},buildInput:function(){return e.createElement("button",{type:"button"})}}),e.namespace("Controls/Input",u,e)});