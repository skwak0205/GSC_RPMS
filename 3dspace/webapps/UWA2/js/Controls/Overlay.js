define("UWA/Controls/Overlay",["UWA/Core","UWA/Event","UWA/Fx","UWA/Controls/Abstract","UWA/Class/Timed"],function(e,t,i,n,s){"use strict";var o=new WeakMap,l=new WeakMap,a=n.extend(s,{name:"uwa-overlay",defaultOptions:{exclusive:!0,exclusiveWith:function(e){return e.name===this.name},closeable:!0,fxOptions:{},resizeParent:!1},init:function(t){this._parent(t),this.buildSkeleton(),this.fx=new i(this.elements.container,e.merge({wait:!1,events:{onComplete:this.onFxComplete.bind(this)}},this.options.fxOptions))},buildSkeleton:function(){var i=this.elements.container=e.createElement("div",{class:this.getClassNames(),styles:{display:"none",opacity:0}});o.set(i,this),this.options.closeable&&i.addClassName("closeable").addEvent("click",function(e){t.getElement(e)===i&&this.close()}.bind(this))},closeOverlays:function(e){var t=1;function i(){0===(t-=1)&&e()}if(this.options.exclusive){var n=this.elements.container&&this.elements.container.getParent();n&&n.getElements(".uwa-overlay").forEach(function(e){var n=o.get(e);n&&this!==n&&n.isOpen()&&this.options.exclusiveWith.call(this,n)&&(t+=1,n.addEventOnce("onClose",i),n.close())},this)}i()},onFxComplete:function(){var e=this.opening,t=this.elements.container;e||(t.setStyle("display","none"),this.resize(!0)),this.dispatchEvent(e?"onOpen":"onClose",[t]),this.opening=null},isOpen:function(){var e=this.elements.container;return e.getParent()&&"none"!==e.getStyle("display")&&!1!==this.opening},open:function(){return this.setPeriodical("needResize",this.resize,500),this.toggle(!0)},close:function(){return this.clearPeriodical("needResize"),this.toggle(!1)},toggle:function(e){var t=this.elements.container,i=this.isOpen();if(void 0===e)e=!i;else if(e===i)return;return this.dispatchEvent(e?"onPreOpen":"onPreClose",[t]),this.opening=e,t.setStyle("display","block"),this.fx&&this.fx.fade(e?"in":"out"),e&&this.closeOverlays(function(){this.resize()}.bind(this)),this.fx||this.onFxComplete(),this},resize:function(e){if(this.options.resizeParent){var t=l.get(this),i=this.getContent(),n=i.getOffsetParent();!t||n&&t===n||(t.setStyle("height",""),l.delete(this)),n&&(e?(n.setStyle("height",""),l.delete(this)):i.scrollHeight>n.offsetHeight&&(n.setStyle("height",i.scrollHeight),l.set(this,n)))}},onRemoved:function(){this.resize(!0)},onInjected:function(){this.resize()},destroy:function(){this.resize(!0),this._parent()}});return e.namespace("Controls/Overlay",a,e)});