define("UWA/Controls/Scroller",["UWA/Core","UWA/Class/Timed","UWA/Controls/Abstract","UWA/Utils/Client","UWA/Event","UWA/Element","UWA/Fx"],function(t,e,i,s,o,n,r){"use strict";var l,a=/input|textarea|select/i,c=/auto|scroll/i,h=s.Features,u=s.Platform,x=s.Engine.version>=5.1&&Boolean(u.ios);function p(t){return t>>0}function d(t){var e,i,s=!0,n=o.getElement(t);return n&&(e=n.getTagName(),i=n.getStyle("overflow"),s=e&&!e.match(a)&&!i.match(c)),s}function g(t){var e=t.type;return-1!==e.indexOf("mouse")?"mouse":-1!==e.indexOf("touch")?"touch":-1!==e.indexOf("ointer")?"pointer":"none"}function y(t,e,i){"init"===t?n.addEvents.call(e,{touchstart:i,mousedown:i,MSPointerDown:i}):"start"===t?n.addEvents.call(e,{touchmove:i,mousemove:i,MSPointerMove:i,touchend:i,touchcancel:i,mouseup:i,MSPointerUp:i}):"stop"===t?n.removeEvents.call(e,{touchmove:i,mousemove:i,MSPointerMove:i,touchcancel:i,touchend:i,mouseup:i,MSPointerUp:i}):"destroy"===t&&n.removeEvents.call(e,{touchstart:i,mousedown:i,MSPointerDown:i,touchmove:i,mousemove:i,MSPointerMove:i,touchcancel:i,touchend:i,mouseup:i,MSPointerUp:i})}return(l=i.extend(e,{name:"uwa-scroller",position:null,direction:null,scroll:null,maxScroll:null,scroller:null,maxPage:null,scrollBars:null,isScrolling:!1,isTracking:!1,isDragging:!1,isPulling:!1,enabled:!0,defaultOptions:{className:"",width:"",height:"",bounce:!1,momentum:!1,snap:!1,threshold:6,lockDirection:!0,scrollableX:!0,scrollableY:!0,scrollbarH:!0,scrollbarV:!0,scrollTime:250,scrollSize:40,scrollDrag:h.dragAndDrop&&!u.blackberry,useTransform:h.transitionsCSS&&!u.webos,useNative:u.blackberry,isTouch:h.touchEvents,has3d:h.cssMatrix,preventDefaultMouseWheel:!1,debugPixel:!1},init:function(e,i){this._parent(i),i=this.options,t.extend(this,{position:{x:0,y:0},direction:{x:0,y:0},scroll:{x:!1,y:!1,width:0,height:0},maxScroll:{x:0,y:0},scroller:{width:0,height:0},page:{x:0,y:0},maxPage:{x:0,y:0},scrollBars:{x:null,y:null}}),i.useNative?this.buildNative(e):this.buildSkeleton(e),this.initEvents(),this.setPosition(0,0,0,!0)},destroy:function(){var t=this.elements,e=t.element,i=t.scroller,s=t.wrapper,o=t.scrollerParent,r=this.eventHandler;l.activeScroller===this&&delete l.activeScroller,e&&(n.removeEvent.call(e,"resize",r),n.inject.call(e,i,"before")),o&&n.removeEvent.call(o,"resize",r),y("destroy",i,this.eventHandler),n.removeEvents.call(i,{keydown:r,mousewheel:r}),i.destroy(),s.destroy()},setOptions:function(t){this._parent(t);var e=(t=this.options).snap;return t.snap=!0===e?{x:null,y:null}:"number"==typeof e?{x:e,y:e}:e,this},buildNative:function(e){var i=this,s=u.android||u.blackberry||x?"scroll":"auto",n=i.options,r=i.elements={element:e,scroller:t.createElement("div",{class:i.getClassNames("","-native"),styles:{overflow:s,overflowScrolling:"touch",zIndex:"0",position:"relative",height:n.height||"100%",width:n.width||"100%",userSelect:"none",zoom:"1"}}),wrapper:t.createElement("div",{class:n.className+"-wrapper"}),ghost:t.createElement("div",{styles:{height:"10px",width:"10px",background:"#000",position:"absolute",zIndex:"1",opacity:n.debugPixel?1:0},events:{click:function(t){return o.stop(t),!1}}})};r.scroller.style.webkitOverflowScrolling="touch",i.body=!1===n.body?r.scroller:n.body||document.body,r.scroller.inject(e,"before"),r.wrapper.inject(r.scroller),r.ghost.inject(r.scroller),e.inject(r.wrapper),r.scrollerParent=r.scroller.getParent(),r.scroller.addEvent("scroll",function(){i.position=i.getPosition(),i.setAnimate("onScroll",function(){i.triggerOnScroll(),i.triggerOnScrollEnd()})}),i.onRefresh()},buildSkeleton:function(e){var i=this,n=i.options,r=i.scrollBars,a=i.elements={element:e,scroller:t.createElement("div",{class:i.getClassNames("","-fake"),tabindex:"0",styles:{overflow:"hidden",position:"relative",userSelect:"none",outline:0,zoom:"1"}}),wrapper:t.createElement("div",{class:n.className+"-wrapper",styles:{width:"100%",height:"100%",position:"relative"}}),ghost:t.createElement("div",{styles:{height:"10px",width:"10px",background:"#000",position:"absolute",zIndex:"1",opacity:n.debugPixel?1:0},events:{click:function(t){o.stop(t),i.updateGhostPosition({y:0,x:0})}}})};i.body=n.body||s.Engine.ie?document.body:window,a.scroller.addContent([a.wrapper,a.ghost]).inject(e,"before"),e.inject(a.wrapper),a.scrollerParent=a.scroller.getParent(),r.x=n.scrollableX&&n.scrollbarH&&new l.Scrollbar(t.extend({dir:"horizontal"},n.scrollbar),i),r.y=n.scrollableY&&n.scrollbarV&&new l.Scrollbar(t.extend({dir:"vertical"},n.scrollbar),i),i.onRefresh()},initEvents:function(){var t,e=this.options,i=this.elements;t=this.eventHandler=this.handleEvent.bind(this),i.scroller.addEvents({keydown:t,mousewheel:t}),e.scrollDrag&&(y("init",i.scroller,this.eventHandler),this.setCursor("grab"),i.scroller.addEvents({mousemove:o.preventDefault,touchmove:o.preventDefault})),i.element.addEvent("resize",t),i.scrollerParent.addEvent("resize",t)},handleEvent:function(t){var e;switch(t.type){case"touchstart":case"mousedown":case"MSPointerDown":e=this.dispatchEvent("onScrollInit",[t]);break;case"touchmove":case"mousemove":case"MSPointerMove":e=this.dispatchEvent("onScrollMove",[t]);break;case"touchend":case"touchcancel":case"mouseup":case"MSPointerUp":e=this.dispatchEvent("onScrollStop",[t]);break;case"DOMMouseScroll":case"onmousewheel":case"mousewheel":e=this.dispatchEvent("onMouseWheel",[t]);break;case"keydown":e=this.dispatchEvent("onKeyDown",[t]);break;case"DOMSubtreeModified":case"orientationchange":case"resize":e=this.dispatchEvent("onRefresh",[t])}return e},scrollTo:function(t,e,i){var s,o=this.options;i=isNaN(i)?o.scrollTime:i,this.options.snap&&(t=(s=this.snap(t,e)).x,e=s.y,i=Math.min(s.time,i)),this.setPosition(t,e,i)},scrollToPage:function(t,e,i){var s=this.options,o=this.getPage(),n=this.position,r=this.getSnapSize();s.snap||(o.x=-p(n.x/r.x),o.y=-p(n.y/r.y)),"next"===t?t=++o.x:"prev"===t&&(t=--o.x),"next"===e?e=++o.y:"prev"===e&&(e=--o.y),t=!1!==t?-t*r.x:n.x,e=!1!==e?-e*r.y:n.y,i=isNaN(i)?s.scrollTime:i,t=(r=this.snap(t,e)).x,e=r.y,i=Math.min(r.time,i),this.setPosition(t,e,i)},scrollToElement:function(t,e,i){"string"==typeof e?e={x:e,y:e}:void 0===e&&(e={x:"center",y:"center"});var s,o,r,l,a=this.scroll,c=this.maxScroll,h=n.getPosition.call(t,this.elements.wrapper),u=n.getDimensions.call(t),x=this.getSnapSize(),p={x:a.width,y:a.height},d={};for(u={x:u.outerWidth,y:u.outerHeight},s=0;s<2;s+=1)a[o=s?"x":"y"]?(r=-h[o],"center"===e[o]?r+=(p[o]-u[o])/2:"end"===e[o]&&(r+=p[o]-u[o])):r=0,l=r<c[o],r=r>0?0:l?c[o]:r,!l&&this.options.snap&&(r=Math[s?"floor":"round"](r/x[o])*x[o]),r<c[o]&&(r=c[o]),d[o]=r;this.setPosition(d.x,d.y,i)},setPosition:function(t,e,i,s){var o,n,r=this.options,l=this.scrollBars,a=this.scroll,c=this.getPosition();i=isNaN(i)?r.scrollTime:i,n={x:t,y:e},r.bounce||(n=this.bounce(n)),o={x:c.x-n.x,y:c.y-n.y},this.direction={x:0===o.x?0:o.x>0?-1:1,y:0===o.y?0:o.y>0?-1:1},0===o.x&&0===o.y||(this.scrollToPosition(n,i),l.x&&a.x&&0!==o.x&&l.x.setPosition(n.x,i,s),l.y&&a.y&&0!==o.y&&l.y.setPosition(n.y,i,s),!this.isPulling&&(this.isMaxPosition("x")&&0!==o.x||this.isMaxPosition("y")&&0!==o.y)&&this.dispatchEvent("onScrollPull"))},stopScroll:function(){this.scrollToPosition(this.getPosition(!0),0)},scrollToPosition:function(t,e){e=e||0;var i,s,o=this,n=o.elements,l=n.scroller,a=n.wrapper,c=o.options;o.triggerOnScrollStart(),o.position=t,c.useNative?(l.scrollTop=-t.y,l.scrollLeft=-t.x,o.triggerOnScroll(),o.triggerOnScrollEnd()):c.useTransform?(a.removeEvent("transitionEnd"),e>0&&a.addEvent("transitionEnd",function(){a.removeEvent("transitionEnd"),o.triggerOnScrollEnd()}),s={transformOrigin:"0 0",transform:"translateZ(0)",fontSmoothing:"antialiased",perspective:800,transformStyle:"preserve-3d",transitionDelay:"0ms",transitionDuration:e+"ms",transitionProperty:a.getStyleName("transform",!0),transitionTimingFunction:"cubic-bezier(0.33, 0.66, 0.66, 1)"},c.has3d?s.transform="translate3d("+t.x+"px,"+t.y+"px, 0)":s.transform="translate("+t.x+"px,"+t.y+"px)",a.setStyles(s),0===e&&o.triggerOnScrollEnd()):((i=o.fx=o.fx||new r(a,{transition:"cubicOut",wait:!1,events:{onComplete:function(){o.triggerOnScrollEnd()},onAnimate:function(){o.triggerOnScroll()}}})).setOptions({duration:e}),i.start({top:t.y,left:t.x}))},triggerOnScrollStart:function(){var t=this,e=t.options,i=t.isScrolling;t.clearDelayed("onScrollEnd"),i||(t.dispatchEvent("onScrollStart"),(e.useNative||e.useTransform)&&t.setAnimate("onScroll",function e(){t.triggerOnScroll(),t.setAnimate("onScroll",e)})),t.dispatchEvent("onScroll")},triggerOnScroll:function(){this.dispatchEvent("onScroll")},triggerOnScrollEnd:function(){var t=this,e=t.options;t.setDelayed("onScrollEnd",function(){(e.useNative||e.useTransform)&&t.clearAnimate("onScroll"),t.dispatchEvent("onScrollEnd")},100)},getPosition:function(t){var e,i,s=!1,o=this.options,r=this.elements;if(o.useNative)i={y:-r.scroller.scrollTop,x:-r.scroller.scrollLeft};else if(o.useTransform){if(i={y:0,x:0},(e=n.getStyle.call(r.wrapper,"transform",!0))&&"none"!==e)if(h.matrixCSS)try{i={y:(e=new(window.WebKitCSSMatrix||window.MSCSSMatrix||window.MOZCSSMatrix||window.CSSMatrix)(e)).f,x:e.e}}catch(t){}else s=0===e.indexOf("matrix3d"),e=e.replace(/[^0-9-.,]/g,"").split(","),i={y:Number(e[s?13:5]),x:Number(e[s?12:4])};t&&(i={x:p(i.x),y:p(i.y)})}else i={y:(t?parseInt:parseFloat)(r.wrapper.style.top||0,10),x:(t?parseInt:parseFloat)(r.wrapper.style.left||0,10)};if(isNaN(i.x)||isNaN(i.y))throw new Error("Invalid scroller position");return i},getResetPosition:function(){var t=this.scroll,e=this.getPosition(),i=this.maxScroll,s=e.x,o=e.y;return e.x>=0||!t.x?s=0:e.x<i.x&&(s=i.x),e.y>0||!t.y?o=0:e.y<i.y&&(o=i.y),{x:p(s),y:p(o)}},isInViewport:function(t,e,i){var s,o,r=this.elements.wrapper,l=n.getOffsets,a=n.getDimensions,c=l.call(r,!0),h=l.call(t),u=a.call(r),x=a.call(t),p=this.getPosition(),d=u.outerHeight,g=u.outerWidth,y=x.width,m=x.height,v=h.y,S=h.x;return c.y=c.y-p.y,c.x=c.x-p.x,e?(s=S<c.x+g&&S+y>c.x,o=v<c.y+d&&v+m>c.y):(s=S>=c.x&&S+y<=c.x+g,o=v>=c.y&&v+m<=c.y+d),"x"===i?s:"y"===i?o:s&&o},isMaxPosition:function(t,e,i){e=e||this.getPosition(),i=i||this.direction[t];var s=this.maxScroll;return i>0?e[t]>=0:e[t]<=s[t]},hasOverflow:function(t){var e=this.scroll,i=this.scroller,s=e.width<i.width,o=e.height<i.height;return"x"===t?s:"y"===t?o:s||o},setSize:function(t){var e=this.options,i=!1;e.width!==t.width&&(i=!0,this.setOption("width",t.width)),e.height!==t.height&&(i=!0,this.setOption("height",t.height)),i&&this.dispatchEvent("onRefresh")},setCursor:function(t){var e=this.scroll;"grabbing"!==t||e.x&&e.y||(t=e.x?"col-resize":"row-resize"),this.elements.scroller.setStyle("cursor",t)},focus:function(){return this.elements.scroller&&this.elements.scroller.focus(),this},updateGhostPosition:function(t){var e=this.elements,i=e.scroller.getOffsets();this.options.useNative&&(i.y-=e.scroller.scrollTop,i.x-=e.scroller.scrollLeft),e.ghost.setStyles({top:t.y-i.y-5,left:t.x-i.x-5})},createDebugPixel:function(e,i,s,o){var n,r=this.elements;this.options.debugPixel&&(this.debugPixels=this.debugPixels||[],o&&this.debugPixels.forEach(function(t){t.remove()}),n=r.scroller.getOffsets(),this.options.useNative&&(n.y-=r.scroller.scrollTop,n.x-=r.scroller.scrollLeft),this.debugPixels.push(t.createElement("div",{title:(s||"")+" x:"+e.x+" y:"+e.y,styles:{height:"4px",width:"4px",background:i||"red",position:"absolute",zIndex:"1",top:e.y-n.y-2,left:e.x-n.x-2}}).inject(r.scroller)))},getPage:function(){var t,e,i,s=this.getPosition(),o=this.getSnapSize(),n=this.maxScroll,r={};for(e=0;e<2;e++)t=s[i=e?"x":"y"]/o[i],r[i]=-t,t*=o[i],isNaN(t)||t>0?r[i]=0:t<n[i]&&(r[i]=this.maxPage[i]);return r},getSnapSize:function(){var t=this.options.snap,e=this.scroll;return{x:t&&t.x||e.width,y:t&&t.y||e.height}},getScrollSize:function(){var t=this.options,e=t.snap;return{x:e&&e.x||t.scrollSize,y:e&&e.y||t.scrollSize}},bounce:function(t){var e,i,s=this.maxScroll;for(e=0;e<2;e+=1)(t[i=e?"x":"y"]>=0||t[i]<s[i])&&(t[i]=t[i]>=0||s[i]>=0?0:s[i]);return t},momentum:function(t,e,i,s,o){var n,r,l,a,c,h,u,x,d,g,y=this.scroll,m=this.scroller,v={x:t,y:e},S={x:0,y:0},f={x:Number(v.x),y:Number(v.y),time:o};for(n=0;n<2;n++)l=n?"width":"height",c=s[r=n?"x":"y"]-i[r],y[r]&&o<=350&&0!==c&&(x=(a=Math.min(Math.abs(c)/o,1.9))*a/.0012,u=y[l],d=-v[r],g=m[l]-y[l]+v[r],h=u/(6/(x/a*6e-4)),c>0&&x>d?(a=a*(d+=h)/x,x=d):c<0&&x>g&&(a=a*(g+=h)/x,x=g),f[r]=p(v[r]+x*(c<0?-1:1)),S[r]=a/6e-4);return f.time=Math.max(S.y,S.x),f},snap:function(t,e,i){var s,o,n,r,l,a=this.getPage(),c=this.getSnapSize(),h=this.maxScroll,u={x:t,y:e};for(l={x:0===(r={x:(i=i||this.position).x-t,y:i.y-e}).x?0:r.x>0?-1:1,y:0===r.y?0:r.y>0?-1:1},o=0;o<2;o++)0!==r[n=o?"x":"y"]&&(s=Math[l[n]<0?"floor":l[n]?"ceil":"round"](u[n]/c[n]),a[n]=-s,s*=c[n],isNaN(s)||s>0?s=a[n]=0:s<h[n]&&(a[n]=this.maxPage[n],s=h[n]),u[n]=s);return u.time=p(Math.max(Math.abs(i.x-u.x)/c.x*500,Math.abs(i.y-u.y)/c.y*500)),u},onScrollInit:function(t){var e,i,s,r,a,c=this,h=c.options;!o.isDefaultPrevented(t)&&(a=c,!l.activeScroller||l.activeScroller===a)&&function(t){return t.scroll.x||t.scroll.y||t.options.bounce}(c)&&function(t){return"touchstart"===t.type||0===o.whichButton(t)}(t)&&d(t)&&(i=g(t),s=o.getPosition(t),r=t.timeStamp,e=c.getPosition(!0),l.activeScroller=c,"mouse"===i&&o.stop(t),c.createDebugPixel(s,"green","onScrollInit",!0),c.isTracking=i,y("start",c.body,c.eventHandler),(c.isPulling||c.isScrolling)&&c.updateGhostPosition(s),c.scrollStart={time:r,position:e,event:s},c.scrollMove={time:r,direction:!1,event:s},c.positions=[],h.momentum&&c.isScrolling&&c.setDelayed("stopOnScrollInit",function(){var t=c.getPosition(!0);!1!==c.isDragging||t.x===e.x&&t.y===e.y||(c.setPosition(e.x,e.y,0),c.createDebugPixel(s,"purple","stopOnScrollInit"))},150),c.setDelayed("focusOnScrollInit",function(){var t=c.elements.scroller,e=t.getDocument().activeElement;e&&n.isInjected.call(e,t)||c.focus()},75),c.setCursor("grabbing"))},onScrollMove:function(e){var i,s,n,r,l,a,c,h,u,x,p,d,y=this.options,m=this.positions,v=o.getPosition(e),S=y.lockDirection?y.threshold:0,f=y.threshold;this.isTracking===g(e)&&(o.stop(e),this.updateGhostPosition(v),this.clearDelayed("stopOnScrollInit"),this.isDragging?(r=this.scrollMove,s=this.maxScroll,i=t.clone(this.position),a=e.timeStamp,h=v.y-r.event.y,p=0===(c=v.x-r.event.x)?0:c>0?-1:1,d=0===h?0:h>0?-1:1,this.enableScrollX&&(i.x+=c,(i.x<s.x||i.x>0)&&(y.bounce?i.x-=c/2:i.x<s.x?i.x=s.x:i.x=0)),this.enableScrollY&&(i.y+=h,(i.y<s.y||i.y>0)&&(y.bounce?i.y-=h/2:i.y<s.y?i.y=s.y:i.y=0)),m.length>60&&m.splice(0,30),m.push(i.x,i.y,a),this.setPosition(i.x,i.y,0),this.scrollMove.direction&&(this.enableScrollX&&0!==r.direction.x&&r.direction.x!==p||this.enableScrollY&&0!==r.direction.y&&r.direction.y!==d)?(this.createDebugPixel(v,"yellow","onScrollMove:directionChange"),this.scrollStart={time:a,position:i,event:v}):this.createDebugPixel(v,"orange","onScrollMove:isDragging"),this.scrollMove={time:a,direction:{x:p,y:d},position:i,event:v}):(n=this.scroll,l=this.scrollStart,u=Math.abs(v.x-l.event.x),x=Math.abs(v.y-l.event.y),this.enableScrollX=n.x&&u>=S,this.enableScrollY=(n.y||!n.x&&!n.y)&&x>=S,this.isDragging=(this.enableScrollX||this.enableScrollY)&&(u>=f||x>=f),this.isDragging&&this.isScrolling&&this.stopScroll(),this.createDebugPixel(v,"red","onScrollMove:notDragging")))},onScrollStop:function(t){var e,i,s,n,r,a=this,c=a.options,h=c.scrollTime;a.isTracking===g(t)&&(a.isTracking=!1,l.activeScroller===a&&delete l.activeScroller,y("stop",a.body,a.eventHandler),n=o.getPosition(t),e=a.getResetPosition(!0),r=t.timeStamp,a.createDebugPixel(n,"blue","onScrollMove"),a.setCursor("grab"),a.isDragging&&(a.isDragging=!1,s=a.scrollStart,a.scrollEnd=i={time:r,position:e,event:n},o.stop(t),a.updateGhostPosition(n),i.event.x===s.event.x&&i.event.y===s.event.y||(c.momentum&&(e=a.momentum(e.x,e.y,s.event,i.event,i.time-s.time),h=Math.max(e.time,h)),c.snap&&(e=a.snap(e.x,e.y,s.position),h=Math.max(e.time,h)))),a.setPosition(e.x,e.y,h,!1),a.positions.length=0,a.scrollStart=null,a.scrollMove=null,a.scrollEnd=null,a.setDelayed("resetGhostPosition",function(){a.updateGhostPosition({x:0,y:0})},500))},onScrollStart:function(){this.isScrolling=!0},onScroll:function(){},onScrollEnd:function(){var t=this,e=t.options;t.isScrolling&&(t.isScrolling=!1,e.useTransform&&t.elements.wrapper.removeEvent("transitionEnd",t.eventHandler)),t.isTracking||(t.isPulling=!1,t.setAnimate("onResetPosition",function(){var e,i=t.getResetPosition(),s=t.getPosition(),o=t.scrollBars;t.options.snap&&(e=t.snap(i.x,i.y),i.x=e.x,i.y=e.y),s.x!==i.x||s.y!==i.y?t.setPosition(i.x,i.y):(o.x&&o.x.onScrollEnd(),o.y&&o.y.onScrollEnd())}))},onScrollPull:function(){this.isPulling=!0},onKeyDown:function(t){var e=this.position,i=this.scroll,s=this.getScrollSize(),n=t.keyCode,r=38===n,l=37===n,a=40===n||r?"y":!(!(39===n)&&!l)&&"x",c=r||l?1:-1,h={x:e.x,y:e.y};i[a]&&d(t)&&!this.isMaxPosition(a,e,c)&&(o.stop(t),h[a]+=c*s[a],this.scrollTo(h.x,h.y))},onMouseWheel:function(t){var e=this.options,i=this.position,s=this.scroll,n=s.x&&!s.y||"shift"===o.whichKey(t)?"x":"y",r=this.getScrollSize(),l=o.wheelDelta(t),a={x:i.x,y:i.y};l&&s[n]&&!this.isMaxPosition(n,i,l)?(o.stop(t),a[n]+=l*r[n],this.scrollTo(a.x,a.y)):e.preventDefaultMouseWheel&&o.stop(t)},onRefresh:function(){if(!this.elements.scroller.isInjected()||this.isScrolling)return!1;var t,e,i,s,o=this.options,r=this.elements,l=this.position,a=this.scrollBars,c=n.getScrolls.call(r.element),h=n.getDimensions.call(r.scrollerParent);if(i={width:c.width,height:c.height},(e={width:o.width||h.innerWidth,height:o.height||h.innerHeight}).width===this.scroll.width&&e.height===this.scroll.height&&i.width===this.scroller.width&&i.height===this.scroller.height)return!1;s={},!1!==o.scrollableX&&(s.width=e.width),!1!==o.scrollableY&&(s.height=e.height),r.scroller.setStyles(s),e.x=o.scrollableX&&e.width<c.width,e.y=o.scrollableY&&e.height<c.height,this.maxScroll={x:i.width<e.width?0:e.width-i.width,y:i.height<e.height?0:e.height-i.height},this.maxPage={x:Math.ceil(i.width/e.width),y:Math.ceil(i.height/e.height)},this.scroll=e,this.scroller=i,a.x&&a.x.setSize(e.width,i.width),a.y&&a.y.setSize(e.height,i.height),t=this.getResetPosition(),this.moved||t.x===l.x&&t.y===l.y||this.setPosition(t.x,t.y,0,!0),r.scroller.toggleClassName("scrollable",e.y||e.x),r.scroller.toggleClassName("scrollable-x",e.x),r.scroller.toggleClassName("scrollable-y",e.y)}})).Scrollbar=i.extend({name:"uwa-scroller-scrollbar",defaultOptions:{className:"",barColor:"#555",bgColor:"#EEE",opacity:1,dir:"vertical",padding:2,width:6,roundCorder:!0,autoHide:!0,draggable:!0,elastic:!1,debugPixel:!1},position:{x:0,y:0},scroller:null,visible:!0,init:function(t,e){this._parent(t),this.scroller=e,this.buildSkeleton(),this.initEvents(),this.options.autoHide&&this.hide()},destroy:function(){this.elements.wrapper.remove()},createDebugPixel:function(e,i,s,o){var n,r=this.isHorizontal,l=this.elements;this.options.debugPixel&&(this.debugPixels=this.debugPixels||[],o&&this.debugPixels.forEach(function(t){t.remove()}),n=l.wrapper.getOffsets(),this.debugPixels.push(t.createElement("div",{title:(s||"")+" x:"+e.x+" y:"+e.y,styles:{height:"2px",width:"4px",background:i||"red",position:"absolute",zIndex:"11",top:r?0:e.y-n.y-2,left:r?e.x-n.x-2:0}}).inject(this.scroller.elements.scroller)))},buildSkeleton:function(){var e,i,o=this.options,n=this.scroller.options,r="horizontal"===o.dir,l=parseInt(o.padding,10),a=parseInt(o.width,10),c=o.roundCorder?p(o.width/2*100/100):0,h=this.scroller.elements.scroller;this.isHorizontal=r,this.axis=r?"x":"y",this.reverseAxis=r?"y":"x",this.elements.wrapper=i=t.createElement("div",{class:this.getClassNames("","-"+o.dir),styles:{zIndex:"10",position:"absolute",overflow:"hidden",opacity:o.opacity}}).inject(h),o.bgColor&&i.setStyle("background",o.bgColor),r?i.setStyles({bottom:l+"px",left:l+"px",height:a+"px"}):i.setStyles({top:l+"px",right:l+"px",width:a+"px"}),this.elements.bar=e=t.createElement("div",{styles:{background:o.barColor,zIndex:"10",position:"absolute",top:0,left:0}}).inject(i),s.Engine.ie<7&&e.setHTML("&nbsp;&nbsp;&nbsp;"),r?e.setStyles({borderRadius:c+"px "+c+"px",width:a+"px",minWidth:a+1+"px",minHeight:a+"px"}):e.setStyles({borderRadius:c+"px "+c+"px",height:a+"px",minWidth:a+"px",minHeight:a+1+"px"}),o.useTransform&&(e.setStyles({transformOrigin:"0 0",transform:"translateZ(0)"}),n.has3d&&e.setStyles({perspective:800,transformStyle:"preserve-3d"}))},initEvents:function(){var t=this,e=t.options,i=t.elements;t.eventHandler=t.handleEvent.bind(t),e.draggable&&(y("init",i.bar,t.eventHandler),i.bar.setStyle("cursor","grab")),e.autoHide&&i.wrapper.addEvents({mouseenter:function(){t.focused=!0,t.show()},mouseleave:function(){t.focused=!1,t.hide()}})},handleEvent:function(t){var e;switch(t.type){case"touchstart":case"mousedown":e=this.dispatchEvent("onScrollInit",[t]);break;case"touchmove":case"mousemove":e=this.dispatchEvent("onScrollMove",[t]);break;case"touchend":case"touchcancel":case"mouseup":e=this.dispatchEvent("onScrollStop",[t])}return e},setSize:function(t,e){var i=this.options,s=this.scroller.scroll,o=this.isHorizontal,n=o?s.y:s.x,r=parseInt(i.width,10),l=parseInt(i.padding,10);e<=t?this.hide(!0):(i.autoHide||this.show(),this.maxSize=p(t-2*l-(n?r:0)),this.minSize=r,this.size=Math.min(Math.max(this.maxSize*this.maxSize/e,3*r),this.maxSize),this.maxScroll=this.maxSize-this.size,this.minScroll=0,this.toWrapperProp=this.maxScroll/(t-e),this.toPropWrapper=e/this.maxSize,this.elements.wrapper.setStyle(o?"width":"height",this.maxSize+"px"),this.elements.bar.setStyle(o?"width":"height",this.size+"px"))},onScrollInit:function(t){o.stop(t);var e=this.scroller,i=o.getPosition(t);this.createDebugPixel(i,"#7FFF00",!0),y("start",e.body,this.eventHandler),this.scrollStart={x:i.x,y:i.y},this.scrollMove={x:i.x,y:i.y},this.elements.bar.setStyle("cursor","grabbing"),e.setCursor("grabbing"),e.isTracking=!0,e.isDragging=!0},onScrollMove:function(t){o.stop(t);var e=this.axis,i=this.toPropWrapper,s=this.scroller,n=s.maxScroll,r=this.scrollMove,l=this.isHorizontal,a=s.position,c=o.getPosition(t),h=l?(c.x-r.x)*i:0,u=l?0:(c.y-r.y)*i,x={x:a.x-h,y:a.y-u};x[e]>n[e]&&x[e]<0?(this.createDebugPixel(c,"orange"),s.setPosition(x.x,x.y,0),this.scrollMove={x:c.x,y:c.y}):this.createDebugPixel(c,"red")},onScrollStop:function(t){o.stop(t);var e=this.scroller,i=o.getPosition(t),s=e.getResetPosition();this.createDebugPixel(i,"#00CED1"),e.setPosition(s.x,s.y,NaN,!1,!0),y("stop",this.scroller.body,this.eventHandler),this.focused||this.hide(),this.elements.bar.setStyle("cursor","grab"),this.scroller.setCursor("grab"),this.scrollMove=null,this.scrollStart=null,e.isTracking=!1,e.isDragging=!1},setPosition:function(t,e,i){var s,o,n,l,a,c=this.elements.bar,h=this.scroller,u=this.size,x=this.axis,p=this.dimension,d=this.minSize,g=this.position,y=this.maxScroll,m=this.minScroll,v=this.options,S=h.options,f={y:0,x:0};o=this.toWrapperProp*t,l=this.isHorizontal?"width":"height",o<0?v.elastic?(a=Math.max(u+o,d),f[x]=m):f[x]=m:o>y?v.elastic?(a=Math.max(u-(o-y),d),f[x]=Math.min(o,y+u-d)):f[x]=y:(a=u,f[x]=o),f.x===g.x&&f.y===g.y&&p===a||(i?e=0:this.show(),f={x:f.x,y:f.y},S.useTransform?(n={transitionDelay:"0ms",transitionDuration:e+"ms",transitionProperty:[c.getStyleName("transform",!0)].concat([l]).join(","),transitionTimingFunction:"cubic-bezier(0.33, 0.66, 0.66, 1.0)"},a&&v.elastic&&(n[l]=a+"px"),v.has3d?n.transform="translate3d("+f.x+"px,"+f.y+"px, 0)":n.transform="translate("+f.x+"px,"+f.y+"px)",c.setStyles(n)):((s=this.fx=this.fx||new r(c,{transition:"cubicOut",wait:!1})).setOptions({duration:e}),n={top:[g.y,f.y],left:[g.x,f.x]},a&&v.elastic&&(n[l]=[u,a]),s.start(n))),this.position=f,this.dimension=a},onScrollStart:function(){this.show()},onScrollEnd:function(){this.hide()},show:function(){var e;this.visible||(e={opacity:this.options.opacity},this.scroller.options.useTransform&&t.merge(e,{transitionProperty:"opacity",transitionDelay:"0ms",transitionDuration:"50ms"}),this.elements.wrapper.setStyles(e),this.visible=!0)},hide:function(e){var i;!this.visible||this.focused||this.scrollMove||!this.options.autoHide&&!e||(i={opacity:0},this.scroller.options.useTransform&&t.merge(i,{transitionProperty:"opacity",transitionDelay:e?"0ms":"300ms",transitionDuration:e?"0ms":"150ms"}),this.elements.wrapper.setStyles(i),this.visible=!1)}}),t.namespace("Controls/Scroller",l,t)});