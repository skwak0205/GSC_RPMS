define("UWA/Controls/Map",["UWA/Core","UWA/Utils","UWA/Array","UWA/Controls/Abstract","UWA/Class/Timed"],function(t,i,a,e,n){"use strict";var o=e.extend(n,{id:null,api:null,map:null,defaultOptions:{width:320,height:240,className:"uwa-map",googleApiKey:null,api:{zoom:15}},init:function(a){if(this._parent(a),this.id=i.random(1e5),this.apiCallbacks=[],!o.States.apiLoading&&!o.States.apiLoaded){o.States.apiLoading=!0;var e="https://maps.google.com/maps/api/js?callback=UWA.Controls.Map.onApiLoad";this.options.googleApiKey&&(e+="&key="+this.options.googleApiKey),t.createElement("script",{type:"text/javascript",src:e}).inject(document.body)}this.setPeriodical("checkLoad",function(){o.States.apiLoaded&&(this.clearPeriodical("checkLoad"),this.onApiReady())},100),this.buildSkeleton()},buildSkeleton:function(){var i=this.options;this.elements.container=t.createElement("div",{id:"map_canvas"+this.id,class:i.className,styles:{height:i.height,width:i.width},events:{resize:this.dispatchEvent.bind(this,"onResize")}})},callApi:function(t){o.States.apiLoaded?t.call(this,this.api,this.map):this.apiCallbacks.push(t)},setPosition:function(t){this.callApi(function(){this.map.setCenter(new this.api.LatLng(t.coords.latitude,t.coords.longitude))}.bind(this))},setSize:function(t){this.elements.container.setStyles({width:t.width,height:t.height})},addMarker:function(t,i,a){var e=this;this.callApi(function(){var n=e.api,o=e.map,s=new n.InfoWindow({content:a});e.marker=new n.Marker({position:new n.LatLng(t.coords.latitude,t.coords.longitude),map:o,title:i}),n.event.addListener(e.marker,"click",function(){s.open(o,e.marker)})})},onApiReady:function(){var i=this.options,e=this.elements;this.api=google.maps,this.map=new this.api.Map(e.container,t.extend({mapTypeControl:!0,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.DROPDOWN_MENU},navigationControl:!0,navigationControlOptions:{style:google.maps.NavigationControlStyle.SMALL},mapTypeId:google.maps.MapTypeId.HYBRID},i.api)),this.dispatchEvent("onLoad"),this.apiCallbacks.length&&(a.invoke(this.apiCallbacks,"call",this,this.api,this.map),this.apiCallbacks.length=0)},onLoad:function(){},onResize:function(){this.setDelayed("resize",function(){this.map&&this.api&&this.api.event.trigger(this.map,"resize")},500)}});return o.States={apiLoading:!1,apiLoaded:!1},o.onApiLoad=function(){o.States.apiLoading=!1,o.States.apiLoaded=!0},t.namespace("Controls/Map",o,t)});