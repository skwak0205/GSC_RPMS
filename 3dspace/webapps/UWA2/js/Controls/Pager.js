define("UWA/Controls/Pager",["UWA/Core","UWA/Event","UWA/Controls/Abstract"],function(t,e,n){"use strict";var i=n.extend({offset:0,limit:0,max:0,length:0,loadingData:!1,defaultOptions:{className:"uwa-pager nv-pager",type:0,showPageLinks:!1,showMoreLink:!1,pageLinks:5,length:0,offset:0,limit:10,max:0,loadNext:null,prevLabel:"prev",nextLabel:"next",moreLabel:"more"},init:function(t){this._parent(t),t=this.options,this.offset=parseInt(t.offset,10),this.limit=parseInt(t.limit,10),this.max=parseInt(t.max,10),this.length=parseInt(t.length,10),this.buildSkeleton()},setOptions:function(t){return this._parent(t),(t=this.options).dataLength?t.length=t.dataLength:t.dataArray&&(t.length=t.dataArray.length),t.onChange&&this.addEvent("onOffsetChange",t.onChange),t.onMoreClick&&this.addEvent("onMoreClick",t.onMoreClick),(t.showPageLinks||t.pageLinks&&!t.type)&&(this.type=1),this},setLength:function(t){this.length=parseInt(t,10),this.setOffset(this.offset)},setOffset:function(t){var e=this.offset;return t=t<0?0:t,this.offset=Math.min(parseInt(t,10),this.max||this.length),e!==this.offset&&this.dispatchEvent("onOffsetChange",[this.offset]),this},setLimit:function(t){return this.limit=parseInt(t,10),this},getPageOffset:function(t){return Math.ceil((parseInt(t,10)||this.offset)/this.limit)},getPages:function(){return Math.ceil((this.max||this.length||1)/this.limit)},isLastPage:function(){var t=!this.max||this.length>=this.max,e=this.offset+this.limit>=this.length;return t&&e},buildSkeleton:function(){this.elements.container=t.createElement("div",{class:this.options.className}),this.dispatchEvent("onRefresh")},buildPageInfos:function(){var e=this.elements;e.pageInfos=t.createElement("span",{class:"pageInfos",html:t.createElement("span",{text:this.getPageOffset()+1+" / "+this.getPages()})}).inject(e.subContainer)},buildPageLinks:function(){var e,n,i=this.elements,s=this.options,a=this.injectPageLink.bind(this),o=this.injectPageSeparator.bind(this),h=s.pageLinks,l=this.getPages(),r=this.getPageOffset(),c=0,f=Math.round(h/2),g=r>=f&&l>=h?r-f+1:0;if(i.pageContainer=t.createElement("span",{class:"pageLinks"}),g<l)for(e=g;e<l&&c<h;e++)g>=1&&0===c&&(a(c),e>1&&o()),n=a(e),e===r&&n.addClassName("selected"),e<l-1&&c===h-1&&(e<l-2&&o(),a(l-1)),c++;i.pageContainer.inject(i.subContainer)},injectPageLink:function(e){var n=parseInt(e+1,10);return t.createElement("a",{class:"pageLink",href:"#page_"+n,text:n,events:{click:this.dispatchAsEventListener("onPageClick",e)}}).inject(this.elements.pageContainer)},injectPageSeparator:function(){return t.createElement("span",{class:"comas",text:" ... "}).inject(this.elements.pageContainer)},onRefresh:function(){var e=this.elements,n=this.options,i=this.isLastPage();e.container.empty(),e.subContainer=t.createElement("div"),e.prev=t.createElement("a",{class:"prev"+(0===this.offset?" disabled":""),href:"#prev",html:t.createElement("span",{text:t.i18n(n.prevLabel)}),events:{click:this.dispatchAsEventListener("onPrevClick")}}).inject(e.subContainer),i&&(n.showMoreLink||n.moreLink)?e.next=t.createElement("a",{class:"more",href:n.moreLink||"#more",html:t.createElement("span",{text:t.i18n(n.moreLabel)}),events:{click:this.dispatchAsEventListener("onMoreClick")}}).inject(e.subContainer):e.next=t.createElement("a",{class:"next"+(i?" disabled":""),href:"#next",html:t.createElement("span",{text:t.i18n(n.nextLabel)}),events:{click:this.dispatchAsEventListener("onNextClick")}}).inject(e.subContainer),1===n.type?this.buildPageLinks():2===n.type&&this.buildPageInfos(),e.subContainer.inject(e.container)},onOffsetChange:function(t){this.offset=t,this.dispatchEvent("onRefresh"),this.dispatchEvent("onChange",[t])},onPageClick:function(e,n){t.Event.preventDefault(e),this.loadingData||this.setOffset(this.limit*n)},onPrevClick:function(t){e.preventDefault(t);var n=e.findElement(t,"a");this.loadingData||n.hasClassName("disabled")||this.setOffset(this.offset-this.limit)},onNextClick:function(t){e.preventDefault(t);var n=this,i=n.options.loadNext,s=e.findElement(t,"a"),a=n.offset+n.limit,o=a+n.limit<=n.length;function h(){n.setOffset(a)}n.loadingData||n.isLastPage()||s.hasClassName("disabled")||(!i&&n.onNeedMoreData&&(i=function(t,e){n.onNeedMoreData(t),setTimeout(e.bind(null,null),6e4)}),!o&&i?(n.dispatchEvent("onLoadingStart"),i(n.length,function(t){t&&(n.length=t),h(),n.dispatchEvent("onLoadingEnd")})):h())},onMoreClick:function(){},onLoadingStart:function(){this.loadingData=!0,this.elements.subContainer.addClassName("loading")},onLoadingEnd:function(){this.loadingData=!1,this.elements.subContainer.removeClassName("loading")}});return t.namespace("Controls/Pager",i,t)});