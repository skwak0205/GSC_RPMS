define("UWA/Storage/Adapter/CouchDB",["UWA/Core","UWA/Data","UWA/Json","UWA/Storage/Adapter/Abstract"],function(t,e,a,s){"use strict";var i=s.extend({type:"CouchDB",limit:0,defaultOptions:{host:!1},connect:function(t){return this.database=t,e.request(this.options.host+"/"+this.database,{method:"GET",type:"json",async:!1,onComplete:function(t){t.error||(this.available=t,this.storage.isReady=!0)}.bind(this)}),this.available},isAvailable:function(){return this.available},normalizeKey:function(t){return"_keysIndex"===t?"keysIndex":"_lastUpdate"===t?"lastUpdate":t},request:function(a,s,i){var n={method:a,type:"json",async:!1};return i=t.merge(n,i),e.request(s,i)},get:function(t){var e,a;return this.interruptAccess(),t=this.normalizeKey(t),this.data[t]={value:void 0},e=this.options.host+"/"+this.database+"/"+t,a={onComplete:function(e){e.error||(this.data[t]=e)}.bind(this)},this.request("GET",e,a),this.data[t].value},set:function(t,e){var s,i;return this.interruptAccess(),t=this.normalizeKey(t),void 0===this.data[t]?this.data[t]={value:e}:this.data[t].value=e,s=this.options.host+"/"+this.database+"/"+t,i={data:a.encode(this.data[t]),onComplete:function(e){e.error||(this.data[t]=e)}.bind(this)},this.request("PUT",s,i),this.data[t].value},rem:function(t){var e,s,i;return this.interruptAccess(),e=this.get(t),t=this.normalizeKey(t),s=this.options.host+"/"+this.database+"/"+t+"?rev="+this.data[t]._rev,i={data:a.encode(this.data[t]),onComplete:function(e){e.error||(this.data[t]=e)}.bind(this)},this.request("DELETE",s,i),e}});return t.namespace("Storage/Adapter/CouchDB",i,t)});