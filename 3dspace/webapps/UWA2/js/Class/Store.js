define("UWA/Class/Store",["UWA/Core","UWA/Utils","UWA/String","UWA/Class","UWA/Class/Debug"],function(t,e,r,s,i){"use strict";var n;return n=s.extend(i,{init:function(e,r,s){var i;t.log(["","*IMPORTANT NOTICE : UWA.Class.Store IS AN EXPERIMENTAL ","FEATURE SUBJECT TO REMOVAL, DEPRECIATION OR CHANGES IN THE ","NEXT RELEASE! IT IS PROVIDED AS A TEMPORARY CONVENIENCE, ","CONSEQUENTLY DO NOT USE THIS IN PRODUCTION CODE!*"].join("")),this._name=r,this._storage=e,this.debugMode=s&&s.debugMode,i=this._storage.get(this._name),this._records=i&&i.split(",")||[]},log:function(){return this._parent(r.format('Store "{0}": {1}',this._name,r.format.apply(null,arguments)))},_save:function(){return this._storage.set(this._name,this._records.join(","))},_set:function(t,e){return this._storage.set(this._name+"-"+t,JSON.stringify(e))},_rem:function(t){return this._storage.remove(this._name+"-"+t)},_insert:function(t,r){var s=e.getUUID();return t[r]=s,this._set(s,t)&&(this._records.push(s),this._save()?this.log('Successfully inserted model "{0}"',s):this._rem(s)?this._records.pop():this._throwError('Unable to rollback failed insertion of model "{0}"',s)),this._find(s)},_find:function(t){var e=this._storage.get(this._name+"-"+t);return e&&JSON.parse(e)},_findAll:function(){return this._records.map(function(t){return this._find(t)},this).filter(function(t){return t},this)},_update:function(e,r){var s;return(s=this._find(e))&&(s=this._set(e,t.extend(s,r)))&&(s=this._find(e))&&this.log('Successfully updated model "{0}"',e),s},_remove:function(t){var e=this._rem(t);return e&&(this._records=this._records.filter(function(e){return e!==t}),this._save()?this.log('Successfully removed model "{0}"',t):this._set(t,e)?(this._records.push(t.toString()),e=null):this._throwError('Unable to rollback failed deletion of model "{0}"',t)),e},_clear:function(){this._records.forEach(function(t){this._rem(t)},this),this._storage.rem(this._name),this._records.length=0},_throwError:function(){throw new Error(r.format("Store {0}: {1}",this._name,r.format.apply(null,arguments)))},sync:function(e,s,i){var n,o,a,h,u;"create"!==e&&"update"!==e&&"patch"!==e||(o=s.toJSON(i)),n=s.id,a=s.idAttribute;try{switch(e){case"read":h=t.is(n)?this._find(n):this._findAll();break;case"create":h=this._insert(o,a);break;case"update":case"patch":h=this._update(n,o);break;case"delete":h=this._remove(n);break;default:this._throwError('Unsupported method "{0}"',e)}}catch(t){u=t.message}return h?i&&i.onComplete&&i.onComplete(h):i&&i.onFailure&&i.onFailure(u||r.format('Store "{0}": model "{1}" not found',this._name,n)),{cancel:function(){}}}}),t.namespace("Store",n,s)});