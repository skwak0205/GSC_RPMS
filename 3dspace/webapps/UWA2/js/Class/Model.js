define("UWA/Class/Model",["UWA/Core","UWA/String","UWA/Data","UWA/Class","UWA/Class/Events","UWA/Class/Listener"],function(t,e,i,n,s,r){"use strict";var a,o=0,u={create:"POST",update:"PUT",patch:"PATCH",delete:"DELETE",read:"GET"};function h(t,e){var i=e.onFailure;e.onFailure=function(n){i&&i(t,n,e),t.dispatchEvent("onError",[t,n,e])}}function c(){throw new Error('A "url" property or function must be specified')}function l(t){return Array.prototype.concat.apply([],Array.prototype.slice.call(t,0))}return a=n.extend(s,r,{init:function(e,i){var n,s=Array.prototype.slice.call(arguments),r=e||{};this.cid="c"+ ++o,this._attributes={},i&&(t.is(i.collection)&&(this.collection=i.collection),!0===i.parse&&(r=this.parse(e,i)||{})),n=t.result(this,"defaults"),t.is(n)&&(r=t.merge(t.clone(r,!1),n)),this.set(r,i),this._changed={},this.setup.apply(this,s)},clone:function(){return new this.constructor(this._attributes)},setup:function(){},sync:function(e,n,s){var r;t.is(s)||(s={});var a=t.is(s.ajax,"function")?s.ajax:i.request,o={method:u[e],type:"json",headers:{}};s.url||(o.url=t.result(n,"url")||c()),t.is(s.data)||!n||"create"!==e&&"update"!==e&&"patch"!==e||(o.headers["Content-Type"]="application/json",o.data=s.attrs||n.toJSON(s)),"GET"!==o.method&&t.is(o.data,"object")&&(o.data=JSON.stringify(o.data));var h=s.onComplete;s.onComplete=function(t,i){var n;n=r&&r.xhr?r.xhr.status:200,s.responseHeaders=i,h&&h("delete"===e&&204===n?void 0:t)};var l=s.onFailure;s.onFailure=function(t,e,i){s.responseHeaders=i,l&&(e&&0!==e.length||(e=t.message||""),l(e))};var d=t.extend(o,s);return r=s.request=a(d.url,d),n.dispatchEvent("onRequest",[n,r,s]),r},parse:function(t){return t},_validate:function(e,i){var n;return!i.validate||!this.validate||(e=t.extend(t.extend({},this._attributes),e),!(n=this.validationError=this.validate(e,i)||null)||(this.dispatchEvent("onValidationFailure",[this,n,t.extend(i,{validationError:n})]),!1))},url:function(){var e;return e=t.result(this,"urlRoot")||t.result(this.collection,"url")||c(),this.isNew()||(e+="/"===e.charAt(e.length-1)?"":"/",e+=encodeURIComponent(this.id)),e},idAttribute:"id",set:function(e,i,n){var s,r,a,o,u,h,c,l,d,p,f,v;if(e){if(t.is(e,"object")?(r=e,n=i||{}):((r={})[e]=i,n=n||{}),!this._validate(r,n))return!1;for(s in f=n.unset,v=n.silent,o=[],u=this._changing,this._changing=!0,u||(this._previousAttributes=t.clone(this._attributes,!1),this._changed={}),r.hasOwnProperty(this.idAttribute)&&(this.id=r[this.idAttribute]),c=this._attributes,l=this._previousAttributes,h=this._changed,r)i=r[s],t.equals(c[s],i)||o.push(s),t.equals(l[s],i)?delete h[s]:h[s]=i,f?delete c[s]:c[s]=i;if(!v)for(o.length&&(this._pending=!0),d=0,p=o.length;d<p;d++)a=o[d],this.dispatchEvent("onChange:"+a,[this,c[a],n]);if(!u){if(!v)for(;this._pending;)this._pending=!1,this.dispatchEvent("onChange",[this,n]);this._pending=!1,this._changing=!1}}return!0},unset:function(e,i){return this.set(e,void 0,t.extend(t.extend({},i),{unset:!0}))},clear:function(e){var i,n={};for(i in e=e?t.clone(e):{},this._attributes)n[i]=void 0;return this.set(n,t.extend(e,{unset:!0}))},get:function(t){return this._attributes[t]},escape:function(i){var n=this.get(i);return t.is(n)?e.escapeHTML(n.toString()):""},has:function(e){return t.is(this.get(e))},keys:function(){return Object.keys(this._attributes)},values:function(){var t,e,i=this.keys(),n=[];for(t=0,e=i.length;t<e;t++)n.push(this.get(i[t]));return n},pairs:function(){var t,e,i,n=this.keys(),s=[];for(t=0,e=n.length;t<e;t++)i=n[t],s.push([i,this.get(i)]);return s},toJSON:function(){return t.clone(this._attributes,!1)},pick:function(){var t=this,e={};return l(arguments).forEach(function(i){t.has(i)&&(e[i]=t.get(i))}),e},omit:function(){var t,e,i,n={},s=l(arguments),r=this.keys();for(t=0,e=r.length;t<e;t++)i=r[t],-1===s.indexOf(i)&&(n[i]=this.get(i));return n},isNew:function(){return!t.is(this.id)},isValid:function(t){return!this.validate||!this.validate(this._attributes,t)},hasChanged:function(e){var i,n=!1,s=this._changed;if(s)if(t.is(e))n=t.owns(s,e);else for(i in s)if(t.owns(s,i)){n=!0;break}return n},changedAttributes:function(e){var i,n,s=!1;if(t.is(e,"object"))for(n in i=this._changing?this._previousAttributes:this._attributes,e)t.equals(i[n],e[n])||((s=s||{})[n]=e[n]);else this.hasChanged()&&(s=t.clone(this._changed,!1));return s},previous:function(e){var i=this._previousAttributes;return t.is(e)&&i?i[e]:null},previousAttributes:function(){return t.clone(this._previousAttributes,!1)},save:function(e,i,n){var s,r,a,o,u,c=this;if(s=c._attributes,t.is(e)&&"object"!==t.typeOf(e)?(r={})[e]=i:(r=e,n=i),n=t.extend({validate:!0},n),r&&!n.wait){if(!c.set(r,n))return!1}else if(!c._validate(r,n))return!1;return r&&n.wait&&(c._attributes=t.extend(t.extend({},s),r)),void 0===n.parse&&(n.parse=!0),o=n.onComplete,n.onComplete=function(e){var i;return c._attributes=s,i=c.parse(e,n),n.wait&&(i=t.extend(r||{},i)),!("object"==typeof i&&null!==i&&!c.set(i,n))&&(o&&o(c,e,n),c.dispatchEvent("onSync",[c,e,n]))},h(this,n),"patch"===(a=this.isNew()?"create":n.patch?"patch":"update")&&(n.attrs=r),u=this.sync(a,this,n),r&&n.wait&&(c._attributes=s),u},fetch:function(e){var i,n=this;return void 0===(e=e?t.clone(e,!1):{}).parse&&(e.parse=!0),i=e.onComplete,e.onComplete=function(t){return!!n.set(n.parse(t,e),e)&&(i&&i(n,t,e),n.dispatchEvent("onSync",[n,t,e]))},h(this,e),this.sync("read",this,e)},destroy:function(e){var i,n,s,r=this;return e=e?t.clone(e,!1):{},n=e.onComplete,i=function(){return r.dispatchEvent("onDestroy",[r,r.collection,e])},e.onComplete=function(t){if((e.wait||r.isNew())&&i(),n&&n(r,t,e),!r.isNew())return r.dispatchEvent("onSync",[r,t,e])},r.isNew()?(e.onComplete(),!1):(h(r,e),s=r.sync("delete",r,e),e.wait||i(),s)}}),t.namespace("Model",a,n)});