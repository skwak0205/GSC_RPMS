define("UWA/Ajax",["UWA/Core","UWA/Utils","UWA/String"],function(e,t,r){"use strict";var n={getRequest:function(r,o){var s,a,i,u=(o=e.merge(o||{},{url:r,method:"GET",async:!0,responseType:"text",onComplete:function(){},onFailure:function(e){throw e},onTimeout:function(e){throw e},onCancel:function(){}})).method||"GET",p=o.headers||{},d=o.authentication,c=n.onStateChange;if(/OPTIONS|GET|HEAD|POST|PUT|DELETE|TRACE|CONNECT/i.test(u)&&(u=u.toUpperCase()),o.data&&(e.is(o.data,["string","arraybufferview","formdata","blob"])||(o.data=t.toQueryString(o.data)),"GET"===u&&(r+=(r.indexOf("?")>-1?"&":"?")+o.data,o.url=r,delete o.data)),o.cors||(t.getOwnPropertyMatchName(p,"X-Requested-With")||(p["X-Requested-With"]="XMLHttpRequest"),t.getOwnPropertyMatchName(p,"X-Requested-Method")||(p["X-Requested-Method"]=u)),"POST"!==u||t.getOwnPropertyMatchName(p,"Content-Type")||e.is(o.data,["arraybufferview","formdata","blob"])||(p["Content-Type"]="application/x-www-form-urlencoded; charset=utf-8"),d&&(d.username&&d.password?(i=r.split("://"),r=i[0]+"://"+d.username+":"+d.password+"@"+i[1]):r+=(r.indexOf("?")>-1?"&":"?")+t.toQueryString(d)),a=o.cors?n.createCORSRequest():n.createRequest()){if(a.cancel=function(){a.aborted=!0,a.abort()},a.addEventListener&&o.onProgress&&a.addEventListener("progress",function(e){o.onProgress(e)}),a.open(u,r,o.async),o.responseTypeSupport="responseType"in a&&"json"!==o.responseType&&(o.async||"undefined"==typeof window),o.responseTypeSupport)try{a.responseType=o.responseType}catch(e){a.responseType="text"}if(o.withCredentialsSupport="withCredentials"in a&&(o.async||"undefined"==typeof window),o.withCredentials){if(!o.withCredentialsSupport)return void o.onFailure(new Error("XMLHttpRequest does not support withCredentials."));a.withCredentials=o.withCredentials}if(o.timeout&&(a.timeoutTimer=setTimeout(function(){a.timedout=!0,a.abort()},o.timeout)),o.cors?(a.onerror=function(){e.merge(a,{readyState:4,status:500}),c(a,o)},a.onload=function(){e.merge(a,{readyState:4,status:200}),c(a,o)}):a.onreadystatechange=c.bind(n,a,o),a.setRequestHeader)for(s in p)p.hasOwnProperty(s)&&a.setRequestHeader(s,p[s]);return a}o.onFailure(new Error("Unable to initiate XMLHttpRequest object."))},createRequest:function(){var e;return window.XMLHttpRequest?e=new window.XMLHttpRequest:window.ActiveXObject&&(e=new window.ActiveXObject("Msxml2.XMLHTTP")),e},createCORSRequest:function(){var e;return window.XMLHttpRequest&&!(e=new window.XMLHttpRequest).withCredentials&&window.XDomainRequest&&(e=new window.XDomainRequest),e},request:function(e,t){var r;return t=t||{},(r=n.getRequest(e,t)).send(t.data||null),t.async||n.onStateChange(r,t),r},parseResponseHeaders:function(e){var t,r,n,o,s,a,i={};if(e)for(a=e.split("\r\n"),t=0;t<a.length;t++)(r=(s=a[t]).indexOf(": "))>0&&(n=s.substring(0,r),o=s.substring(r+2),i[n]=o);return i},onStateChange:function(){var o="UWA_Platform_";function s(t){var n,s=t;if(e.is(s,"string")&&s.contains(o))try{s=r.stripComments(s),s=JSON.parse(s)}catch(e){s=!1}if(s&&s.error&&String(s.error.type).startsWith(o))return n=new Error(r.format("ProxyError: {0}",s.error.message)),e.merge(n,s.error),n}function a(e,t){var n,o,a=t.responseTypeSupport?e.responseType:t.responseType;if(t.responseTypeSupport){if("text"===a||""===a)n=e.responseText;else try{n=e.response}catch(t){throw new Error(r.format('InvalidResponseError: request has probably invalid "Content-type" header require by responseType "{0}" causing: "{1}".',e.responseType,t))}if(t.fromDataRequest&&(o=s(n)),o)throw o}else{if(t.fromDataRequest&&(o=s(e.responseText)),o)throw o;"text"===a||""===a?n=e.responseText:"json"===a?0===(n=String(e.responseText).trim()).length?n=null:(n=r.stripComments(n),n=JSON.parse(n)):"document"===a?n=e.responseXML:"arraybuffer"===a?n=function(e){var t,r,n=new ArrayBuffer(2*e.length),o=new Uint16Array(n);for(t=0,r=e.length;t<r;t++)o[t]=e.charCodeAt(t);return n}(e.responseText):"blob"===a&&(n=new Blob([e.responseText],{type:e.getResponseHeader("Content-Type")}))}return n}function i(e){return n.parseResponseHeaders(e.getAllResponseHeaders())}return function(e,n){var s,u,p,d;if(e.aborted)n.onCancel(e,n);else if(e.timedout)n.onTimeout(new Error("Request timed out after "+n.timeout+" ms"),e,n);else if(4===e.readyState){if(e.timeoutTimer&&clearTimeout(e.timeoutTimer),e.completed)return;e.completed=!0;var c=!0;if(e.status<=0){var l=t.parseUrl(t.buildUrl(window.location,n.url)).protocol;c="http"!==l&&"https"!==l}else e.status>=400&&(c=!1);if(c){u=i(e);try{s=a(e,n)}catch(e){p=e,String(e.type).startsWith(o)&&(u=e.headers,s=e.body),n.onFailure(e,s,u)}finally{p||n.onComplete(s,u)}}else{d=new Error(r.format('NetworkError: url "{0}" return ResponseCode with value "{1}".',n.fromDataRequest||n.url,e.status||0)),u=i(e);try{s=a(e,n)}catch(e){String(e.type).startsWith(o)&&(Object.assign(d,e),u=e.headers,s=e.body)}n.onFailure(d,s,u)}!function(e,t){t.cors?(e.onerror=null,e.onload=null):e.onreadystatechange=null}(e,n)}}}()};return e.namespace("Ajax",n,e)});