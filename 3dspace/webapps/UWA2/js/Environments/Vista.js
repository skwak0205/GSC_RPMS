define("UWA/Environments/Vista",["UWA/Core","UWA/Utils","UWA/Utils/Client","UWA/Element","UWA/Environment","UWA/Data","UWA/Controls/Scroller","UWA/Storage/Adapter/Vista","UWA/Storage/Adapter/Object"],function(t,e,i,s,o,n,l){"use strict";t.is(window.System)?n.allowCrossOriginRequest=!0:window.System={Fake:!0,Gadget:{Flyout:{},docked:!1,TransitionType:{},Settings:{read:function(){},write:function(){}},endTransition:function(){},beginTransition:function(){}}},n.useOfflineCache=!0;var a=o.extend({name:"vista",maxHeight:400,minHeight:100,maxWidth:351,onInit:function(){var t=document.getElementById("gadget"),e=s.getElement.bind(t);e(".moduleVista")||this.buildSkeleton(t),this.html={viewport:e(".moduleWrapper"),wrapper:e(".module"),header:e(".moduleHeader"),content:e(".moduleWrapper"),body:e(".moduleContent"),edit:e(".moduleEdit"),footer:e(".moduleFooter"),counter:e(".counter"),title:e(".title"),icon:e(".icon"),shareAction:e(".share"),refreshAction:e(".refresh"),editAction:e(".edit")},this.scroller||System.Gadget.docked||(this.scroller=new l(this.html.content,{bounce:!0,lockDirection:!0,momentum:!0,scrollDrag:!1,scrollbarH:!1,scrollbar:{autoHide:!1}})),System.Gadget.onUndock=System.Gadget.onDock=function(){window.location=String(window.location)}},buildSkeleton:function(e){var i=t.hosts,o=t.i18n,n=System.Gadget.docked,l=i.uwa+t.paths.img+(n?"richIcon.png":"icon.png"),a=n?48:16;n?(s.setStyles.call(document.body,{width:"48px",height:"48px"}),s.setContent.call(e,{tag:"div",class:"module moduleVista docked",html:[{tag:"div",class:"moduleContent",styles:{display:"none"}},{tag:"div",class:"moduleWrapper",html:{tag:"div",class:"icon",html:{tag:"img",src:l,width:a,height:a}}}]})):s.setContent.call(e,{tag:"div",class:"module moduleVista",html:[{tag:"div",class:"moduleHeader",html:[{tag:"a",class:"edit",text:o("Edit"),styles:{display:"none"}},{tag:"a",class:"refresh",text:o("Refresh"),styles:{display:"none"}},{tag:"span",class:"icon",html:{tag:"img",height:a,width:a,src:l}},{tag:"span",class:"counter"},{tag:"span",class:"title",text:o(document.title)}]},{tag:"div",class:"moduleScroller",html:{tag:"div",class:"moduleWrapper",html:[{tag:"div",class:"moduleEdit"},{tag:"div",class:"moduleContent",html:o("Loading...")}]}},{tag:"div",class:"moduleFooter",html:[{tag:"a",class:"powered",href:i.netvibes,text:o("Â© Netvibes")},{tag:"a",class:"share",href:i.ecosystem,text:o("Subscribe to this app")}]}]})},onShowEdit:function(){this.scrollTop(),this.dispatchEvent("onResize"),this._parent()},onHideEdit:function(){this.scrollTop(),this.dispatchEvent("onResize"),this._parent()},onResize:function(){var t,e=this.html,i=e.content.getScrolls().height;if(i>0&&i!==this.prevHeight&&(this.prevHeight=i,this.scroller&&(i=Math.max(Math.min(i,this.maxHeight),this.minHeight),this.scroller.setOptions({height:i,width:326}),this.scroller.onRefresh(),this.resize(this.maxWidth,e.wrapper.getScrolls().height))),t=e.content.getScrolls().width,this.prevWidth===t)return!1;this.prevWidth=t},scrollTop:function(){this.scroller&&this.scroller.setPosition(0,0,0,!0)},settingsClosed:function(){event.closeAction===event.Action.commit?(this.widget.data={},this.data={}):this.dispatchEvent("endEdit")},resize:function(t,e){document.body.style.width=t,document.body.style.height=e},onUpdateIcon:function(e,i){if(this.html.icon){var s=System.Gadget.docked,o=this.html.icon,l=s?48:16;return(s||i||!e.toLowerCase().match(/^.*\.(png|jpg|jpeg|gif)$/))&&(e=n.proxifyUrl(e,{proxy:s?"richIcon":"icon"})),t.createElement("img",{styles:{display:"none"},events:{load:function(){o.setContent({tag:"img",src:e,width:l,height:l}),this.destroy()}}}).inject(document.body).setAttribute("src",e),!1}}});return t.extend(o.prototype,a.prototype),t.namespace("Environments/Vista",a,t)});