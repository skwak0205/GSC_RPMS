define("UWA/Environments/Dashboard",["UWA/Core","UWA/Utils","UWA/Element","UWA/Environment","UWA/Data","UWA/Storage/Adapter/Dashboard","UWA/Storage/Adapter/Object"],function(t,e,i,n,o){"use strict";o.useOfflineCache=!0;var s=n.extend({name:"dashboard",growboxInset:-1,minWidth:358,minHeight:570,onInit:function(){var t=document.body,e=i.getElement.bind(t);this.html={wrapper:e(".module"),header:e(".moduleHeader"),content:e(".moduleWrapper"),body:e(".moduleContent"),edit:e(".moduleEdit"),footer:e(".moduleFooter"),counter:e(".counter"),title:e(".title"),icon:e(".icon"),shareAction:e(".share"),refreshAction:e(".refresh"),editAction:e(".edit")},this.onResize(),window.resizeTo(this.minWidth,this.minHeight)},onRegisterWidget:function(){this.html.resizeButton=t.createElement("img",{class:"resizeButton",src:"/System/Library/WidgetResources/resize.png",events:{mousedown:this.onResizeButtonDown.bind(this)}}).inject(this.html.footer),window.widget&&(this.html.editAction.empty(),this.html.editAction.addClassName("infoButton"),new AppleInfoButton(this.html.editAction,this.html.wrapper,"black","black",this.dispatchEvent.bind(this,"toggleEdit"))),this._parent()},onResize:function(){var t=this.html.wrapper,e=t.offsetWidth,i=t.offsetHeight;if(i>0&&i!==this.prevHeight&&(this.prevHeight=i),this.prevWidth===e)return!1;this.prevWidth=e},onEdit:function(){window.resizeTo(this.html.wrapper.offsetWidth,this.minHeight),window.widget&&window.widget.prepareForTransition("ToBack"),this._parent()},onShowEdit:function(){window.widget&&setTimeout("window.widget.performTransition();",100)},endEdit:function(){window.resizeTo(this.html.wrapper.offsetWidth,this.minHeight),window.widget&&window.widget.prepareForTransition("ToFront"),this._parent()},onHideEdit:function(){window.widget&&setTimeout("window.widget.performTransition();",100)},onResizeButtonMove:function(t){if(-1!==this.growboxInset){t.stopPropagation(),t.preventDefault();var e=t.x+this.growboxInset.x,i=t.y+this.growboxInset.y;e=e<this.minWidth?this.minWidth:e,i=i<this.minHeight?this.minHeight:i,this.html.resizeButton.style.top=i-12,window.widget&&window.resizeTo(e,i)}},onResizeButtonDown:function(t){t.stopPropagation(),t.preventDefault(),document.addEventListener("mousemove",this.onResizeButtonMove.bind(this),!0),document.addEventListener("mouseup",this.onResizeButtonUp.bind(this),!0),this.growboxInset={x:window.innerWidth-t.x,y:window.innerHeight-t.y}},onResizeButtonUp:function(t){t.stopPropagation(),t.preventDefault(),this.growboxInset=-1,document.removeEventListener("mousemove",this.onResizeButtonMove.bind(this),!0),document.removeEventListener("mouseup",this.onResizeButtonUp.bind(this),!0)},onOpenURL:function(t){if(t=e.parseUrl(t),window.widget&&window.widget.openURL&&!t.subprotocol)return window.widget.openURL(t.source),!1}});return t.extend(n.prototype,s.prototype),t.namespace("Environments/Dashboard",s,t)});