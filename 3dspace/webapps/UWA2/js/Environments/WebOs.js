define("UWA/Environments/WebOs",["UWA/Core","UWA/Environment","UWA/Internal/StringMap"],function(e,t,n){"use strict";e.is(window.Mojo)&&(e.log=function(e){Mojo.Log.error("UWA: "+e)},e.Data.allowCrossOriginRequest=!0),e.Data.useOfflineCache=!0,e.extend(e.Environment.prototype,{name:"webos",init:function(e){this.name="webos",this.data=new n,window.PalmSystem&&window.PalmSystem.setWindowOrientation("free"),this._parent(e)},onInit:function(){var t=e.extendElement(document.body),n=t.getElement.bind(t);this.html={wrapper:n(".module"),header:n(".moduleHeader"),title:n(".title"),icon:n(".icon"),refreshLink:n(".refresh"),editLink:n(".edit"),content:n(".moduleWrapper"),body:n(".moduleContent"),edit:n(".moduleEdit"),footer:n(".moduleFooter")},this.html.scroller=e.createElement("div",{id:"contentScroller"}).inject(this.html.content,"before"),this.html.content.inject(this.html.scroller),this.dispatchEvent("onResize"),this.html.content.addEvent("resize",this.dispatchEvent.bind(this,"onResize")),e.Element.addEvent.apply(window,["resize",this.dispatchEvent.bind(this,"onResize")])},onRegisterWidget:function(){this.html.wrapper.handleExternalLinks(this.widget.openURL.bind(this.widget))},onShowEdit:function(){this.scrollTo(0,0)},onHideEdit:function(){this.scrollTo(0,0)},onResize:function(){var t=this.html,n=e.Utils.Client.getSize(),i=t.content.offsetHeight,o=0;if(["header","footer"].forEach(function(e){o+=t[e]?t[e].offsetHeight:0}),this.prevHeight!==n.height+i&&(this.prevHeight=n.height+i,o+i>=n.height?t.scroller.setStyle("height","auto"):t.scroller.setStyle("height",n.height-o+"px"),t.scroller.setStyle("min-height",n.height-o+"px"),this.sceneController&&this.getScrollPosition().top<0&&this.getScrollPosition().top-n.height<-i+o&&this.scrollTo(0,-n.height-i-o,!0)),this.prevWidth===n.width)return!1;this.prevWidth=n.width,this.dispatchEvent("onResize")},onOpenURL:function(t){if(t=e.Utils.parseUrl(t),window.PalmServiceBridge&&!t.subprotocol)return(new window.PalmServiceBridge).call("palm://com.palm.applicationManager/open",JSON.stringify({id:"com.palm.app.browser",params:{target:t.source}})),!1},setIcon:function(t,n){if(this.html.icon){var i=this.html.icon;!n&&t.toLowerCase().match(/^.*\.(png|jpg|jpeg|gif)$/)||(t=e.Data.proxifyUrl(t,{proxy:"icon"})),e.createElement("img",{styles:{display:"none"},events:{load:function(){i.setContent({tag:"img",src:t,width:"16",height:"16"}),this.destroy()}}}).inject(document.body).setAttribute("src",t)}},scrollTo:function(e,t,n){return this.sceneController.getSceneScroller.apply(this.sceneController).mojo.scrollTo(e,t,n)},getScrollPosition:function(){return this.sceneController.getSceneScroller.apply(this.sceneController).mojo.getScrollPosition()},handleSelect:function(){var t,n,i,o=document.querySelectorAll("select");if(o)for(t=0,n=o.length;t<n;t++)(i=e.extendElement(o[t])).handleSelect||(i.handleSelect=!0,i.addEvent("click",this.handleSelectClick.bind(this,i)))},handleSelectClick:function(e){var t,n,i,o=e.childNodes,l=this.sceneController,r=[];for(t=0,n=o.length;t<n;t++)i=o[t],r.push({label:i.innerHTML,command:i.value});l.popupSubmenu({placeNear:e,items:r,toggleCmd:e.value,onChoose:function(t){t!==e.value&&(e.value=t,"function"==typeof e.onchange&&e.onchange.call())}})}})});