define("UWA/Json",["UWA/Core","UWA/String","UWA/Utils","UWA/Utils/Client","UWA/Ajax"],function(UWA,UWAString,Utils,Client,Ajax){"use strict";var Json={jsonp:{},encode:JSON.stringify,decode:JSON.parse,prune:function(e,t){var r=[],n=t&&t.toJSON||function(e){return UWA.is(e)&&UWA.is(e.toJSON,"function")?e.toJSON():e},a=t&&t.fallback||function(){return null};return function e(t){var o,s;switch(t=n(t),UWA.typeOf(t)){case"string":case"number":case"boolean":return t;case"array":return-1!==r.indexOf(t)?a(t,"circular"):(r.push(t),o=t.map(e),r.pop(),o);case"object":if(!UWA.is(t,"plain"))return a(t,"unsupported");if(-1!==r.indexOf(t))return a(t,"circular");for(s in r.push(t),o={},t)UWA.owns(t,s)&&(o[s]=e(t[s]));return r.pop(),o;default:return null===t?t:a(t,"unsupported")}}(e)},isJson:function(e){var t=!1;if(UWA.is(e,"string"))try{JSON.parse(e),t=!0}catch(e){}return t},xmlToJson:function(e){var t,r,n,a,o,s,i=function(){return this.nodeValue},l=function(){return parseInt(this.nodeValue,10)};if("string"==typeof e&&(e=Utils.loadXml(e)),e.attributes&&0!==e.attributes.length||!e.childNodes||1!==e.childNodes.length||-1===e.childNodes[0].nodeName.indexOf("#")){if(n={},e.attributes)for(t=0,r=e.attributes.length;t<r;t++)n[s=(o=e.attributes[t]).nodeName]?(n[s]=Utils.splat(n[s]),n[s].push(o.nodeValue)):n[s]=o.nodeValue;for(t=0,r=e.childNodes.length;t<r;t++)n[s=(a=e.childNodes[t]).nodeName]?(n[s]=Utils.splat(n[s]),n[s].push(Json.xmlToJson(a))):-1===s.indexOf("#")?n[s]=Json.xmlToJson(a):a.nodeValue.trim().length>0&&(n.nodeValue=a.nodeValue,n.toString=i,n.valueOf=l)}else n=e.childNodes[0].nodeValue;return n},path:function(){var valueStr="VALUE",pathStr="PATH",sepStr=";",queryPath="$",regExps=[/[\['](\??\(.*?\))[\]']|\['(.*?)'\]/g,/'?\.'?|\['?/g,/;;;|;;/g,/;$|'?\]|'$/g,/#([0-9]+)/g,/^\$;?/,/(^|[^\\])@/g,/\\@/g,/^[0-9*]+$/,/^(-?[0-9]*):(-?[0-9]*):?(-?[0-9]*)$/g,/^\(.*?\)$/,/^\?\(.*?\)$/,/^\?\((.*?)\)$/,/^(-?[0-9]*):(-?[0-9]*):?([0-9]*)$/,/,/,/'?,'?/];function normalize(e){var t=[];return e.replace(regExps[0],function(e,r,n){return"[#"+(t.push(r||n)-1)+"]"}).replace(regExps[1],sepStr).replace(regExps[2],";..;").replace(regExps[3],"").replace(regExps[4],function(e,r){return t[r]}).replace(regExps[5],"")}function run(obj,query,val){var queryEval="var valueEval = arguments[2];"+query.replace(regExps[6],"$1valueEval").replace(regExps[7],"@");try{return obj&&val&&eval(queryEval)}catch(e){throw new SyntaxError("UWA.Json.path error: "+e.message+' for query "'+query+'"')}}function asPath(e){var t,r,n=e.split(sepStr),a=queryPath;for(t=1,r=n.length;t<r;t++)a+=regExps[8].test(n[t])?"["+n[t]+"]":"['"+n[t]+"']";return a}function store(e,t,r,n){return e&&(r[r.length]=n===pathStr?asPath(e):t),Boolean(e)}function walk(e,t,r,n,a){var o,s,i,l=UWA.typeOf(r);if("array"===l)for(o=0,s=r.length;o<s;o++)r.hasOwnProperty(o)&&a(o,e,t,r,n);else if("object"===l)for(i in r)r.hasOwnProperty(i)&&a(i,e,t,r,n)}function slice(e,t,r,n,a,o){if(Array.isArray(r)){var s,i=r.length,l=0,u=1,c=i;for(e.replace(regExps[9],function(e,t,r,n){l=parseInt(t||l,10),c=parseInt(r||c,10),u=parseInt(n||u,10)}),l=l<0?Math.max(0,l+i):Math.min(i,l),c=c<0?Math.max(0,c+i):Math.min(i,c),s=l;s<c;s+=u)trace(s+sepStr+t,r,n,a,o)}}function trace(e,t,r,n,a){if(""!==e){var o,s,i,l=e.split(sepStr),u=l.shift();if(l=l.join(sepStr),t&&t.hasOwnProperty(u))trace(l,t[u],r+sepStr+u,n,a);else if("*"===u)walk(u,l,t,r,function(e,t,r,o,s){trace(e+sepStr+r,o,s,n,a)});else if(".."===u)trace(l,t,r,n,a),walk(u,l,t,r,function(e,t,r,o,s){"object"==typeof o[e]&&trace("..;"+r,o[e],s+sepStr+e,n,a)});else if(regExps[10].test(u))trace(e=run(t,u,t,r.substr(r.lastIndexOf(sepStr)+1))+sepStr+l,t,r,n,a);else if(regExps[11].test(u))walk(u,l,t,r,function(e,r,o,s,i){run(t,r.replace(regExps[12],"$1"),Array.isArray(s)?s[e]:s,e)&&trace(e+sepStr+o,s,i,n,a)});else if(regExps[13].test(u))slice(u,l,t,r,n,a);else if(regExps[14].test(u))for(s=0,i=(o=u.split(regExps[15])).length;s<i;s++)trace(e=o[s]+sepStr+l,t,r,n,a)}else store(r,t,n,a)}return function(e,t,r){var n=[],a=r&&r.resultType||valueStr;return e&&t&&(a===valueStr||a===pathStr)&&trace(normalize(t),e,queryPath,n,a),!!n.length&&n}}(),request:function(e,t){var r,n,a,o,s,i,l,u,c,p,f,d,m,h=!!(t=t||{}).useJsonpRequest||!Utils.matchUrl(e,window.location)&&(UWA.Data&&UWA.Data.useJsonpRequest&&!UWA.Data.allowCrossOriginRequest),g=e,v=Client.isOnline,w=Json.jsonp,y={fromDataRequest:!1,useOfflineCache:!1,async:!0,timeout:!1,callback:"jsonp"+(Date.now()+Utils.random(1,1e4)),callbackName:"callback",callbackMode:"function",callbackModeName:"callbackMode",onCancel:function(){},onFailure:function(e){throw e},onComplete:function(){}};if(!1===(t=UWA.merge(t||{},y)).timeout?t.useOfflineCache?t.timeout=15e3:t.timeout=25e3:t.timeout=parseInt(t.timeout,10),t.data&&(e+=(e.indexOf("?")>-1?"&":"?")+Utils.toQueryString(t.data)),n=t.callback.replace(/[^a-zA-Z0-9_]/g,"$"),(a=t.callbackMode)&&(e=e.replace(/\=(\?|%3F)/g,"="+n),e+=(e.indexOf("?")>-1?"&":"?")+t.callbackName+"="+n,e+="&"+t.callbackModeName+"="+a),e.length>2048)throw new Error("Proxified url is more than 2048 characters, you should consider using POST and CORS Ajax.");return o=t.onFailure,i=t.onTimeout||o,s=t.onComplete,l=t.useOfflineCache,u=t.fromDataRequest,t.onFailure=function(e){if(Json.cleanRequest(n,t),l&&!1===u){var r=Json.getFromCache(g);UWA.is(r)?(v()&&v(!1,5e3),s(r)):o(e)}else o(e)},t.onTimeout=function(e){if(Json.cleanRequest(n,t),l&&!1===u){var r=Json.getFromCache(g);UWA.is(r)?(v()&&v(!1,5e3),s(r)):i(e)}else i(e)},t.onComplete=function(e){Json.cleanRequest(n,t);try{if(u&&e&&e.error&&e.error.type&&"UWA_Platform_Exposition"===e.error.type)throw new Error(UWAString.format('ObjectError: url "{0}" return Error with value "{1}"',u,e.error.message||e.error));s(e)}catch(e){o(e)}},t.cache<0&&(e+=(e.indexOf("?")>-1?"&":"?")+"_="+Date.now()),l&&!1===v()?t.onFailure(new Error("Network is Offline")):h?(w[n]={readyState:!1,options:t},"object"===a?(f=Date.now(),d=13,m=function(){var e,r=Date.now();void 0!==window[n]?(w[n].readyState="loaded",t.onComplete(window[n])):r>f+t.timeout?(e=r-f,t.onTimeout(new Error("Request timed out after "+e+"ms with timeout value "+t.timeout+" ms"))):w[n].poll=setTimeout(m.bind(this),d)}):(window[n]=function(e){void 0!==w[n]&&(w[n].data=e,w[n].readyState="loaded")},f=Date.now(),d=13,m=function(){var e,r=Date.now();"loaded"===w[n].readyState?t.onComplete(w[n].data):r>f+t.timeout?(e=r-f,t.onTimeout(new Error("Timout request after "+e+"ms with timeout value "+t.timeout+" ms"))):w[n].poll=setTimeout(m.bind(this),d)}),c=document.getElementsByTagName("head")[0],(p=UWA.createElement("script",{type:"text/javascript",src:e,async:t.async})).addEvent("error",function(){t.onFailure(new Error("Syntax or http error: "+e))}),p.inject(c),w[n].script=p,m(t),r={jsonId:n,script:p,cancel:function(){w[n].aborted=!0,Json.cleanRequest(n)}}):r=Ajax.request(e,UWA.merge({headers:{Accept:"application/json,text/javascript,*/*","X-Request":"JSON"},onComplete:function(e){var r;a&&!Json.isJson(e)&&((r="object"===a?e.match(/=\s\(?([\s\S]*?)\)?;?\s*$/):e.match(/\(([\s\S]*?)\);?\s*$/))&&(e=r[1]));Json.isJson(e)?t.onComplete(UWA.Json.decode(e)):t.onFailure(new Error('Invalid JSON Response: "'+e+'"'))},onFailure:t.onFailure},t)),r},cleanRequest:function(e){var t,r=document.getElementsByTagName("head")[0],n=Json.jsonp[e];n&&(t=n.options,clearTimeout(n.poll),"object"!==t.callbackMode&&(window[e]=function(){try{delete window[e]}catch(e){}}),n.script&&(r.removeChild(n.script),delete n.script),n.aborted&&t.onCancel(null,t))}};return UWA.namespace("Json",Json,UWA)});