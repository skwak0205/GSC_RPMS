define("UWA/Data",["UWA/Core","UWA/Utils","UWA/Utils/Client","UWA/Ajax","UWA/Json","UWA/Internal/StringMap","UWA/Class/Events"],function(e,t,r,n,o,a,s){"use strict";var u,i,d=new a,c={proxies:(u=e.hosts,i=u.exposition+"/proxy/",e.merge(u.proxies||{},{ajax:i+"ajax",resolve:i+"resolve",xml:i+"xml",spreadsheet:i+"spreadsheet",soap:i+"soap",feed:i+"feed",icon:i+"icon",richIcon:i+"richIcon",rss:i+"feed"})),useJsonpRequest:!0,allowCrossOriginRequest:!1,useOfflineCache:!1,request:function(){var a=/OPTIONS|GET|HEAD|POST|PUT|DELETE|TRACE|CONNECT/i,u=/json|document|blob|arraybuffer|text/,i=/^([A-Za-z0-9+/]{4})*([A-Za-z0-9+/]{4}|[A-Za-z0-9+/]{3}=|[A-Za-z0-9+/]{2}==)$/,d=r.isOnline;var p={text:function(e){return"string"!=typeof e&&(e=o.encode(e)),e},json:function(t){if("string"==typeof t&&(t=o.decode(t)),!e.is(t,["object","array"]))throw new Error('Invalid JSON Response: "'+String(t)+'"');return t},xml:function(e){return"string"==typeof e&&(e=t.loadXml(e)),e},document:function(e){return"string"==typeof e&&(e=t.loadHtml(e)),e},blob:function(e,r){var n=t.getOwnPropertyMatchValue(r,"Content-Type")||"text/plain";return"string"==typeof e&&(e=i.test(e)?function(e,t){var r,n,o=e.indexOf(";base64,")+";base64,".length,a=e.substring(o),s=window.atob(a),u=s.length,i=new Uint8Array(u);for(r=0;r<u;++r)i[r]=s.charCodeAt(r);return(n=new BlobBuilder).append(i.buffer),n.getBlob(t)}(e,n):new Blob([e],{type:n})),e},arraybuffer:function(e){return"string"==typeof e&&(e=new ArrayBuffer(12)),e}};return function(r,h){if(!r)throw new Error("Bad or missing url argument.");h=h||{};var l,f,m,y,g,C,x,w,q,O,T,E,v=window.location,U={timeout:25e3,method:"GET",type:"text",proxy:!1,async:!0,headers:{},useMergeRequest:!0,useOfflineCache:c.useOfflineCache,allowCrossOriginRequest:c.allowCrossOriginRequest,useJsonpRequest:c.useJsonpRequest,onComplete:function(){},onCancel:function(){},onFailure:function(e){throw e}};return h.requestHeaders&&(h.headers=h.requestHeaders,delete h.requestHeaders),h.postBody?(h.method="POST",h.data=h.postBody,delete h.postBody):h.parameters&&(h.method="POST",h.data=h.parameters,delete h.parameters),h.auth&&(h.authentication=h.auth,delete h.auth),"html"===h.type?h.type="document":"feed"===h.type&&(h.type="json"),(h=e.merge(h,U)).type=p[h.type]?h.type:U.type,h.timeout=parseInt(h.timeout,10),a.test(h.method)&&(h.method=h.method.toUpperCase()),"json"===h.type&&(t.getOwnPropertyMatchName(h.headers,"Accept")||(h.headers.Accept="application/json,text/javascript,*/*"),t.getOwnPropertyMatchName(h.headers,"X-Request")||(h.headers["X-Request"]="JSON")),w=h.type,q=h.useOfflineCache,O=h.allowCrossOriginRequest,T=h.useJsonpRequest,E=r,h.proxy?(r=c.proxifyUrl(r,h),T=T&&!1===t.matchUrl(r,v)&&!1===O):!1===t.matchUrl(r,v)&&!1===O?(T=T&&!1===t.matchUrl(c.proxies.ajax,v),r=c.proxifyUrl(r,e.extend(h,{proxy:"ajax"}))):T=!1,c.requests=c.requests||{},g=function(r,n){var o={url:r,timeout:n.timeout,method:n.method,type:n.type,proxy:n.proxy,async:n.async,data:n.data,headers:n.headers};return"GET"===n.method&&!1!==n.useMergeRequest||(o.uuid=t.getUUID()),e.Json.encode(o)}(r,h),f={onComplete:h.onComplete,onFailure:h.onFailure,onCancel:h.onCancel,onTimeout:h.onTimeout||h.onFailure},c.requests[g]?(l=c.requests[g]).addEvents(f):((l=c.requests[g]=new s).addEvents(f),C=function(e,r){var n=e;delete c.requests[g],t.attempt(function(){var o;return T&&(r=e.headers,o=e.body,i.test(o)&&(o=t.base64Decode(o)),e=o),e=p[w](e,r),q&&c.storeInCache(E,n),!0},function(){return x("onFailure",arguments),!1})&&l.dispatchEvent("onComplete",[e,r])},x=function(t,r){var n,o,a=!0;delete c.requests[g],q&&(n=c.getFromCache(E),e.is(n)&&(a=!1,d()&&d(!1,o||5e3),C(n))),a&&l.dispatchEvent(t,r)},m={method:h.method,data:h.data,headers:h.headers,fromDataRequest:E,timeout:h.timeout,async:h.async,withCredentials:h.withCredentials,onComplete:function(e,t){C(e,t)},onFailure:function(){x("onFailure",arguments)},onCancel:function(){x("onCancel",arguments)},onTimeout:function(){x("onTimeout",arguments)},onProgress:h.onProgress},q&&!1===d()?m.onFailure(new Error("Network is Offline")):T?(h.data&&h.data.length>0&&-1!==["POST","PUT"].indexOf(h.method)&&(r+=-1!==r.indexOf("?")?"&":"?","POST"===h.method?r+=t.toQueryString(h.data,"postData"):"PUT"===h.method&&(r+=t.toQueryString(h.data,"rawData")),delete m.data,delete m.method),y=o.request(r,m)):(w&&u.test(w)&&(m.responseType=w),l.xhr=y=n.request(r,m)),l.url=E,l.options=h,l.cancel=y.cancel),l}}(),proxifyUrl:function(e,r){if(!e)throw new Error("Bad or missing url argument.");var n,o=[],a=r.proxy,s=t.toQueryString,u=c.proxies;if(!a||!u[a])throw new Error("Invalid proxy");if(n=u[a],0===e.indexOf(n))return e;if(r.data&&r.method&&"GET"===r.method.toUpperCase()&&(e+=(e.indexOf("?")>-1?"&":"?")+s(r.data),delete r.data),"object"==typeof r[a]&&(o.push(s(r[a])),delete r[a]),r.type&&(o.push(s({type:r.type})),delete r.type),"object"==typeof r.authentication&&o.push(s(r.authentication)),r.cache&&(o.push(s({cache:parseInt(r.cache,10)})),r.cache<0&&o.push(Date.now())),r.headers&&(o.push(s(r.headers,"headers")),delete r.headers),r.connect&&o.push(s({connect:r.connect})),r.service&&o.push(s({service:r.service})),r.wid&&o.push(s({wid:r.wid})),r.method&&o.push(s({method:r.method})),o.push(s({url:e})),(e=n+"?"+o.join("&")).length>2048)throw new Error("Proxified url is more than 2048 characters, that is the limit for most of the browsers.");return e},getFeed:function(e,t){return c.request(e,{method:"GET",proxy:"feed",type:"json",onComplete:t})},getXml:function(e,t){return c.request(e,{method:"GET",type:"xml",onComplete:t})},getText:function(e,t){return c.request(e,{method:"GET",type:"text",onComplete:t})},getJson:function(e,t){return c.request(e,{method:"GET",type:"json",onComplete:t})},getCache:function(){return d},storeInCache:function(r,n){n=t.toArray(n).filter(function(t){return e.is(t)&&!t.nodeType}),c.getCache().set(t.getCheckSum(r),n)},getFromCache:function(e){return c.getCache().get(t.getCheckSum(e))}};return e.namespace("Data",c,e)});