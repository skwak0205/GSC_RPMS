define("UWA/Embedded",["UWA/Core","UWA/String","UWA/Class","UWA/Class/Options","UWA/Class/Debug","UWA/Class/Events","UWA/Utils","UWA/Utils/InterCom"],function(e,t,i,n,s,o,r,a){"use strict";function d(e,t){var i;for(i in t)t.hasOwnProperty(i)&&(e.style[i]=t[i])}function l(e,t){var i,n;for(n in t)t.hasOwnProperty(n)&&(i=t[n],"styles"===n?d(e,i):"html"===n?e.innerHTML=i:"text"===n?(e.innerHTML="",e.appendChild(document.createTextNode(i))):e.setAttribute(n,i))}function h(e,t,i){var n=document.createElement(e);return t&&l(n,t),i&&i.appendChild(n),n}function c(e){var t;if("object"!=typeof e)return!1;for(t in e)if(e.hasOwnProperty(t))return!1;return!0}function u(e){return"boolean"==typeof e?!1===e?"0":"1":r.encodeUrl(e)}var p=i.extend(n,s,o,{url:"",id:null,data:null,version:e.version,elements:null,preferences:null,disableRemote:!0,defaultOptions:{container:null,className:"module",title:null,themeUrl:null,color:"white",height:"auto",width:"100%",maxHeight:!1,bookmarklet:!1,lang:null,id:null,readOnly:!1,data:{},buildHeader:!1,displayHeader:!0,displayFooter:!0,displayScroller:!1,displayEdit:!0,cache:null,useAsyncFrame:!1,useAppCache:!1,offlineMode:!1,autoLaunch:!0,subDomain:!1,subDomainPattern:"{id}.widget.",remoteName:"uwa.embedded",sandbox:!1,exposition:e.hosts.exposition,uwa:e.hosts.uwa},socket:null,init:function(e,t){this.url=e,this.data={},this.elements={},this.preferences=[],this._remoteQueue=[],this.startTime=(new Date).getTime(),this.setOptions(t);var i,n,s,o=typeof(t=this.options).container;if("string"===o?this.container=document.getElementById(t.container):"object"===o&&null!==this.options.container?this.container=t.container:(s=document.getElementById("UWA_ASYNC"),this.container=h("div",{id:this.id,class:t.className}),s?s.parentNode.insertBefore(this.container,s.nextSibling):(n=(i=document.getElementsByTagName("script"))[i.length-1]).parentNode.insertBefore(this.container,n)),p.Instances[this.id]=this,!this.container)throw new Error("UWA.Embedded is unable to get container element with container "+this.container+".");if("string"!=typeof this.url)throw new Error("UWA.Embedded expect url defined has first param");this.log('Init new instance with container id "'+this.id+'" and widget url "'+this.url+'"'),this.render()},destroy:function(){},setOptions:function(e){return this._parent(e),(e=this.options).title&&(e.buildHeader=!0),e.buildHeader&&(e.displayHeader=!1),this.data=e.data||{},!e.id&&this.id||(this.id=e.id||this.generateId()),this},generateId:function(){var e;do{e="uwa-"+r.getCheckSum(this.url)+"-"+r.random(1,1e5)}while(document.getElementById(e)&&null!==p.Instances[e]);return e},render:function(){var t,i={},n=this.options,s=this.container,o=navigator.userAgent.toLowerCase().match(/ip(?:ad|od|hone)/);i.wrapper=h("div",{class:"moduleWrapper"}),n.buildHeader&&(i.header=h("div",{class:"moduleHeader",styles:{position:"relative",overflow:"hidden",height:"23px",padding:"5px 5px 0 5px"}},i.wrapper),i.iconContainer=h("span",{styles:{padding:"0 5px 0 0"}},i.header),i.icon=h("img",{src:n.uwa+e.paths.img+"icon.png",class:"moduleIcon",height:16,width:16,styles:{border:"none",height:16,width:16}},i.iconContainer),i.title=h("span",{text:n.title||"Loading...",class:"moduleTitle",styles:{font:'bold 11px/20px "Lucida Grande",Tahoma,Helvetica,Arial,sans-serif',verticalAlign:"top"}},i.header)),i.body=h("div",{class:"moduleContent"},i.wrapper),t={id:"frame-"+this.id,frameBorder:0,width:"100%",scrolling:n.maxHeight||"auto"!==n.height?"auto":"no"},n.sandbox&&(t.sandbox="allow-same-origin allow-forms allow-scripts allow-popups"),i.iframe=h("iframe",t,i.body),d(i.iframe,{display:"block"}),n.bookmarklet&&(n.displayScroller=!0,n.height="100%",n.width="320px",d(i.wrapper,{position:"fixed",top:0,right:0,height:n.height,width:n.width,"z-index":99999998})),"auto"!==n.height&&(i.iframe.height=n.height),o&&n.displayScroller&&(i.iframe.scrolling="no"),this.elements=i,s.innerHTML="",s.appendChild(i.wrapper),n.useAsyncFrame?this.renderIframeAsync():this.renderIframe(),this.setChromeColor(n.color),this.initRemote()},renderIframe:function(){var e=this.elements.iframe,t=this.getIframeUrl();e.previousIframeUrl&&e.previousIframeUrl===t||(e.previousIframeUrl=t,e.src=t)},renderIframeAsync:function(){var t,i=JSON.stringify,n=this.options,s=this.elements.iframe.contentWindow.document,o=n.exposition+"/widget/amd/js?uwaUrl="+u(this.url),r={id:this.id,widgetDomain:window.location.toString().replace(/#.*$/,"")};n.cache&&(o+="&cache="+u(n.cache)),t=["<!DOCTYPE html>","<html>","<head>",'<meta charset="UTF-8" />','<script type="text/javascript">',"   var UWA = {hosts:"+i(e.hosts)+"},",'       curl = {apiName: "require"};',"<\/script>",'<script type="text/javascript" src="'+n.uwa+"/lib/vendors/curl.js?v="+this.version+'"><\/script>','<script type="text/javascript" src="'+o+"&v="+this.version+'"><\/script>',"</head>","<body>",'<script type="text/javascript">','   define("'+this.id+'", ["'+this.url+'"], function (widget) {',"       UWA.extend(widget, "+i(r)+");","   });","<\/script>","</body>","</html>"],s.open(),s.write(t.join("\n")),s.close()},getIframeUrl:function(){var e,t,i=[],n=this.options,s=this.data,o={uwaUrl:this.url,id:this.id,cache:n.cache,header:n.displayHeader,footer:n.displayFooter,scroller:n.displayScroller,displayEdit:n.displayEdit,autoLaunch:n.autoLaunch&&!n.offlineMode,useAppCache:n.useAppCache,offlineMode:n.offlineMode,chromeColor:n.color,widgetDomain:window.location.toString().replace(/#.*$/,""),themeUrl:n.themeUrl,lang:n.lang};if(!n.offlineMode)for(e in o.readOnly=n.readOnly,s)s.hasOwnProperty(e)&&!o.hasOwnProperty(e)&&(o[e]=s[e]);for(e in o)o.hasOwnProperty(e)&&null!==o[e]&&i.push(e+"="+u(o[e]));if((t=this.getIframeDomain()+"?"+i.join("&")).length>2048)throw new Error("UWA.Embedded iframe url is more than 2048 characters please implement UWA.Embedded using offlineMode=true.");return t},getIframeDomain:function(){var e,t=this.options,i=t.exposition;return t.subDomain&&(e=r.getCheckSum(this.url),i=i.replace("://","://"+t.subDomainPattern.replace("{id}",e))),i+="/widget/frame"},initRemote:function(){var e,t=this,i=t.options;t.socket||(p.Servers[i.remoteName]||(p.Servers[i.remoteName]=new a.Server(i.remoteName)),(e=new a.Socket(t.id+"-master")).subscribeServer(i.remoteName,window,window.location.toString()),e.addListener("widgetMessage",function(e){var i=e.args,n=i.shift();t.disableRemote=n,t.dispatchEvent(n,i),t.disableRemote=!1}),t.socket=e,t._runRemoteQueue())},_runRemoteQueue:function(){var e,t;this.socket&&0!==this._remoteQueue.length&&(t=this._remoteQueue.shift(),!0===this.disableRemote||this.disableRemote===t[0]?this.log("sendRemote message ignored: "+t):(e={id:this.id,args:t},this.log("sendRemote message: "+t),this.socket.dispatchEvent("environmentMessage",e,[e.id+"-slave"])),this._runRemoteQueue())},sendRemote:function(){this._remoteQueue.push(r.toArray(arguments)),this._runRemoteQueue()},launch:function(e,t){void 0!==t&&(this.options.readOnly=t),void 0!==e&&(this.data=e),this.disableRemote=!1,this.sendRemote("launchWidget",this.data,this.options.readOnly)},setChromeColor:function(e){this.dispatchEvent("onColorize",[e]),this.sendRemote("onColorize",e)},setTitle:function(e){this.dispatchEvent("onUpdateTitle",[e]),this.sendRemote("onUpdateTitle",e)},setIcon:function(e,t){this.dispatchEvent("onUpdateIcon",[e,t]),this.sendRemote("onUpdateIcon",e,t)},setValue:function(e,t){this.dispatchEvent("onUpdateValue",[e,t]),this.sendRemote("onUpdateValue",e,t)},setValues:function(e){var t;for(t in e)e.hasOwnProperty(t)&&this.setValue(t,e[t])},resizeHeight:function(e,t){this.dispatchEvent("onResizeHeight",[e,t]),this.sendRemote("onResize")},resizeWidth:function(e,t){this.dispatchEvent("onResizeWidth",[e,t]),this.sendRemote("onResize")},onRegisterWidget:function(){var e=this.options;this.loadTime=(new Date).getTime(),this.disableRemote=!1,e.autoLaunch&&(e.offlineMode||e.useAsyncFrame)&&this.launch()},onUpdateTitle:function(e){this.title!==e&&(this.title=e,this.elements.title&&this.options.buildHeader&&null===this.options.title&&l(this.elements.title,{text:t.stripTags(e)}))},onUpdateIcon:function(e){if(this.icon!==e&&(this.icon=e,this.options.buildHeader)){var t=this.elements.icon,i=h("img",{src:e,onload:function(){t.src=e}});i.complete&&i.width>0&&(t.src=e)}},onUpdatePreferences:function(e){this.preferences=e},onUpdateValue:function(e,t){this.data[e]!==t&&(this.data[e]=t)},onResizeHeight:function(e,t){var i=this.options,n=i.maxHeight,s=n&&e>n;this.elements.iframe&&(t||"auto"===i.height)&&(this.elements.iframe.height=s?n:e)},onResizeWidth:function(e,t){var i=this.options;this.elements.iframe&&(t||"auto"===i.width)&&(this.elements.iframe.width=e)},onColorize:function(t){var i=this.options,n=this.elements;i.color=t,i.buildHeader&&(d(n.header,"transparent"!==t?{background:'url("'+i.uwa+e.paths.css+"themes/blueberry/img/moduleheader"+("white"!==t?"_"+t:"")+".png?v="+this.version+'") repeat-x scroll center top transparent'}:{background:null}),d(n.title,{color:"transparent"!==t?"white":"black"}))},onViewRequest:function(e){e||(e={}),e.error="No view implementation in Embedded mode",this.sendRemote("onViewError",e)},getCode:function(e){var t,i,n,s,o=this.url,r=JSON.stringify,a=this.options,d={},l=["/lib/c/UWA/js/UWA_Embedded.js"],h={uwa:a.uwa,exposition:a.exposition};for(n in a)a.hasOwnProperty(n)&&"container"!==n&&null!==a[n]&&this.defaultOptions[n]!==a[n]&&(c(a[n])||(d[n]=a[n]));if(e&&1===l.length)s=['<script type="text/javascript">',"var UWA = {hosts:"+r(h)+"}, UWA_ASYNC = UWA_ASYNC || [];",'    UWA_ASYNC.push({url: "'+o+'",options:'+r(d)+"});","(function () {",'    var a = document.getElementsByTagName("script"), b = a[a.length - 1] || document.body.lastChild,','        c = b.parentNode, d = document.createElement("script"), e = document.createElement("div");','    e.id = "UWA_ASYNC"; d.type = "text/javascript"; d.async = true;','    d.src = ("https:" == document.location.protocol ? "https://" : "http://") + UWA.hosts.uwa.split("://")[1] + "'+l[0]+"?v="+this.version+'";',"    c.insertBefore(d, b); c.insertBefore(e, b)","})();","<\/script>"];else{for((s=[]).push('<script type="text/javascript"> var UWA = {hosts:'+r(h)+"}; <\/script>"),t=0,i=l.length;t<i;t++)s.push('<script type="text/javascript" src="'+a.uwa+l[t]+"?v="+this.version+'"><\/script>');s.push('<script type="text/javascript">'),s.push('var MyWidget = new UWA.Embedded("'+o+'"'+(c(d)?"":","+r(d))+");"),s.push("<\/script>")}return s.join("\n")}});return p.Instances={},p.Servers={},function(){var t,i,n;if(window.UWA_ASYNC)for(n=window.UWA_ASYNC,e.Widgets=e.Widgets||[],t=0,i=n.length;t<i;t++)e.Widgets[t]=new p(n[t].url,n[t].options||{})}(),e.namespace("Embedded",p,e)});