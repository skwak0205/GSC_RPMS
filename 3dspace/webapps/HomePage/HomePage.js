/*! -- Copyright 2017 Dassault Systemes. All rights reserved. */
define("DS/HomePage/views/Requirement3Dsearch",["UWA/Core","UWA/Utils/InterCom"],function(e,t){"use strict";var n=function(n){this.socketName="search_socket_"+(new Date).getTime(),this.socket=new t.Socket(this.socketName,{dispatchRetryInterval:5}),this.socket.subscribeServer("SearchComServer"),this.listener=this.objectsSelected.bind(this),this.socket.addListener("Selected_Objects_search",this.listener),this.defaultOptions=n,this.defaultOptions={multiSel:!1,source:["3dspace"]},e.extend(this.defaultOptions,n||{})};return n.prototype.options=function(e,t,n,i,r,o){var a={};a.title=e,a.mode="furtive",a.app_socket_id=this.socketName,a.widget_id=widget.id,a.default_with_precond=!0,a.multiSel=r,a.source=this.defaultOptions.source||[],a.show_precond=!1;var s=widget.getValue("x3dPlatformId"),l=s&&""!==s?s:"OnPremise";return a.tenant=l,a.role=n,Array.isArray(t)&&(a.precond="",t.forEach(function(e,t){a.precond+=0==t?"[ds6w:"+e.tag+"]:"+e.value:" AND [ds6w:"+e.tag+"]:"+e.value})),a.precond&&""!==a.precond&&(a.precond="("+a.precond+")"),o&&(a.precond?a.precond="("+a.precond+" AND "+o+")":a.precond="("+o+")"),i&&""!==i.trim()&&(a.default_search_criteria=i),a},n.prototype.destroy=function(){var e={};e.widget_id=widget.id,this.socket.dispatchEvent("unregisterSearchContext",e),this.socket.unsubscribeServer("SearchComServer"),this.socket.removeListener("Selected_Objects_search",this.listener),this.socket.disconnect(),delete this.socket},n.prototype.activate=function(e,t,n,i,r,o,a){var s=this.options(e,t,n,i,r,o);UWA.is(a,"function")||(s.mode="default"),this.callback=a,this.socket.dispatchEvent("unregisterSearchContext",{widget_id:widget.id}),this.socket.dispatchEvent("RegisterContext",s),this.socket.dispatchEvent("InContextSearch",s)},n.prototype.isAvailable=function(){return UWA.is(this.socket)},n.prototype.launchASearch=function(e){if(this.isAvailable()){void 0!==e.multiSel&&null!==e.multiSel||(e.multiSel=this.defaultOptions.multiSel||!0);var t=e.title?e.title:"";this.activate(t,e.allowedTypes,e.role||"",e.criteria=e.criteria,e.multiSel,e.precondition,function(t){e.in_apps_callback(t)})}},n.prototype.objectsSelected=function(e){this.callback&&this.callback(e)},n}),define("DS/HomePage/controllers/DndController",["i18n!DS/HomePage/assets/nls/HomePage","DS/RequirementStructureBrowser/utils/TRMTypeManagement","DS/RequirementStructureBrowser/utils/RequirementAppConfig","css!DS/HomePage/HomePage.css"],function(e,t,n){"use strict";return{_dropArea:null,_trmModelEvents:null,_container:null,_onDragStartRowHeader:function(e,i){var r=i.draggedNodes;e.dataTransfer.effectAllowed="all",n.DRAG_NODE_START=!0;var o=t.prepareDragData(r);return e.dataTransfer.setData("Text",o),!1},_onDragEndRowHeader:function(e,t){this._dropArea&&this._dropArea.hide(),n.DRAG_NODE_START=!1},_onDrop:function(e,n){var i,r=this;t.retrieveAuthorizedObjects({dnd_event:e,callback:function(e){if((i=e)&&0!=i.authorized_objects.length){var t=i.authorized_objects;r._trmModelEvents.publish({event:"TRMViews-WelcomePanel-OpenStructure",data:t})}}}),e.preventDefault(),e.stopPropagation()},_onDragEnd:function(e,t){this._dropArea&&this._dropArea.hide(),e.preventDefault(),e.stopPropagation()},_onDragSpec:function(e,t){this._container&&this._container.classList.add("dragOver"),e.preventDefault(),e.stopPropagation()},_onDragLeave:function(e,t){this._container&&this._container.classList.remove("dragOver"),e.preventDefault(),e.stopPropagation()},_onDragOver:function(e,t){this._container&&this._container.classList.add("dragOver"),e.preventDefault(),e.stopPropagation()},initDropArea:function(t,i){var r=this;this._trmModelEvents=i;var o=this._dropArea=UWA.createElement("div",{class:"trm-welcome-panel-dropArea addInCtx",draggable:!1}).inject(t),a=r.dropZone=UWA.createElement("div",{class:"trm-welcome-panel-dropZone addInCtx",draggable:!1}).inject(o),s=UWA.createElement("div",{class:"trm-welcome-panel-dropIconAndText addInCtx"}).inject(a);UWA.createElement("i",{class:"trm-welcome-panel-img wux-ui-3ds wux-ui-3ds-4x wux-ui-3ds-drag-drop"}).inject(s),UWA.createElement("h5",{class:"trm-welcome-panel-txt addInCtx",text:e.HomePage_OpenObjectInCtx}).inject(s),t.addEventListener("dragenter",function(e,t){n.DRAG_NODE_START&&o.show(),e.stopPropagation()}),t.addEventListener("dragleave",function(e,t){null!=n.DRAG_NODE_START&&n.DRAG_NODE_START||o.hide()}),t.addEventListener("dragend",function(e,t){r._onDragEnd(e,t)}),r.dropZone.addEventListener("dragenter",function(e,t){a.classList.add("hightLight-dropzone"),e.preventDefault(),e.stopPropagation()}),r.dropZone.addEventListener("dragleave",function(e,t){a.classList.remove("hightLight-dropzone"),e.preventDefault(),e.stopPropagation()}),r.dropZone.addEventListener("dragend",function(e,t){droparea.hide()}),r.dropZone.addEventListener("dragover",function(e,t){a.classList.add("hightLight-dropzone"),e.preventDefault(),e.stopPropagation()}),r.dropZone.addEventListener("drop",function(e,t){r._onDrop(e,t)}),o.hide()},dndEmptyContent:function(e,t){this._container=e,this._trmModelEvents=t,e.addEventListener("dragenter",this._onDragSpec.bind(this)),e.addEventListener("dragleave",this._onDragLeave.bind(this)),e.addEventListener("dragover",this._onDragOver.bind(this)),e.addEventListener("drop",this._onDrop.bind(this))},initDndDataGridView:function(e){e&&(e.rowDragEnabledFlag=!0,e.cellDragEnabledFlag=!0,e.onDragStartRowHeader=this._onDragStartRowHeader.bind(this),e.onDragEndRowHeader=this._onDragEndRowHeader.bind(this),e.onDragStartCell=this._onDragStartRowHeader.bind(this),e.onDragEndCell=this._onDragEndRowHeader.bind(this))},onDragStartCell:function(e,i){var r=[],o=this.getNodesXSO();o&&(r=o.get().concat()).sort(function(e,t){return e._getRowID()-t._getRowID()}),r&&0!==r.length||(r=[i.nodeModel]);var a=r;a||(a=[]),e.dataTransfer.effectAllowed="all";var s=t.prepareDragData(a);return e.dataTransfer.setData("Text",s),n.DRAG_NODE_START=!0,!1},onDragEndCell:function(e,t){n.DRAG_NODE_START=!1}}}),define("DS/HomePage/views/RecentlyOpenView",["DS/ENOXEmptyContent/js/ENOXEmptyContent","DS/CollectionView/ResponsiveTilesCollectionView","DS/Tree/TreeDocument","DS/RequirementStructureBrowser/utils/TRMTypeManagement","DS/Core/PointerEvents","DS/HomePage/controllers/DndController","i18n!DS/HomePage/assets/nls/HomePage"],function(e,t,n,i,r,o,a){"use strict";var s=function(e){this.model=new n,this._trmModelEvents=e,this.init(),this._initDivs(),this._loadData()};return s.prototype.init=function(){var n=this,i={sentences:[{type:"drop",text:a.HomePage_DropHereToOpen}],fontSize:"16px",orderedListType:"none",modelEvents:n._trmModelEvents};this._ENOXEmptyContent=new e(i),this.responsiveTilesOptions={height:"inherit",displayedOptionalCellProperties:["contextualMenu","activeFlag"],useDragAndDrop:!0,onDragStartCell:o.onDragStartCell,onDragEndCell:o.onDragEndCell,allowUnsafeHTMLContent:!1},n.model.getModelEvents().subscribe({event:"TRMViews-recent-model-update"},function(e){n.model.getRoots().length>0?(n.ResponsiveView=new t(n.responsiveTilesOptions),n.ResponsiveView.loadApplicativeModel(n.model),n.ResponsiveView.inject(n._recentContainer),n._rtvEventHandler(n.ResponsiveView)):(0===n.model.getChildren().length&&n._recentContainer.classList.remove("displaynone"),n._ENOXEmptyContent.inject(n._recentContainer),o.dndEmptyContent(n._recentContainer,n._trmModelEvents))})},s.prototype._initDivs=function(){this._recentContainer=UWA.createElement("div"),this._recentContainer.classList.add("trm-recent-view"),o.initDropArea(this._recentContainer,this._trmModelEvents)},s.prototype._loadData=function(){i.updateRecentItemModel(this.model)},s.prototype._rtvEventHandler=function(e){var t=this;e.addEventListener(r.POINTERHIT,function(e,n){if(e.multipleHitCount>=2){var i={physicalid:n.nodeModel.options.resourceid};t._trmModelEvents.publish({event:"TRMViews-WelcomePanel-OpenStructure",data:i,context:n.nodeModel})}})},s}),define("DS/HomePage/views/ListViewController",["DS/TraceableRequirementsUtils/Services/RequirementWebServices","DS/TraceableRequirementsUtils/Utils","DS/RequirementStructureBrowser/treemodel/RequirementModelParser","DS/RequirementStructureBrowser/utils/RequirementsConstant","DS/Tree/TreeDocument","DS/Core/PointerEvents","DS/DataGridView/DataGridView","text!DS/RequirementStructureBrowser/assets/RequirementAppSetting.json","DS/ENOXCollectionToolBar/js/ENOXCollectionToolBar","DS/WebappsUtils/WebappsUtils","DS/RequirementStructureBrowser/utils/TRMMask","DS/RequirementStructureBrowser/treemodel/RequirementWSAccess","i18n!DS/RequirementStructureBrowser/assets/nls/TreeLst.json","DS/RequirementStructureBrowser/utils/TRMTypeManagement","DS/HomePage/controllers/DndController","css!DS/HomePage/HomePage.css"],function(e,t,n,i,r,o,a,s,l,c,d,p,u,m,h){"use strict";var _=JSON.parse(s),v=function(e){this._isDestroyed=!1,this._needRefresh=!0,this._trmModelEvents=e,this.data_to_insert=[],this._model=new r,this._reqSpecListView=null,this._dgvColumn=this.getDatagridViewColumns(),this.listViewOptions={id:"reqlist",modelEvents:this._trmModelEvents,useDragAndDrop:!0,currentView:"DGV",withmultisel:!1,showItemCount:!1,filter:{enableCache:!0},viewOptions:{identifier:"reqlist",views:["DataGridView"],currentView:"DGV",currentSort:void 0,grid:{columns:this._dgvColumn},editable:!0,itemViewMapping:{label:function(e){return e.options.grid.title},subLabel:function(e){return e.options.grid.state+" | "+(e.options.grid.owner?e.options.grid.owner:e.options.grid.responsible)},description:"description",customTooltip:function(e){},icon:function(e){}}},actions:[]},this._initDivs(),this._initToolBar(),this._subscribeEvents()};return v.prototype._initDivs=function(){this._containerReqSpec=UWA.createElement("div"),this._containerReqSpec.classList.add("req-list-view"),this._collectionToolBarContainer=document.createElement("div"),this._collectionToolBarContainer.classList.add("req-collectiontoolbar-container"),this._list_view_Container=document.createElement("div"),this._list_view_Container.classList.add("req-list-container"),h.initDropArea(this._list_view_Container,this._trmModelEvents),this.loadDataGridView(this._list_view_Container),this._containerReqSpec.appendChild(this._collectionToolBarContainer),this._containerReqSpec.appendChild(this._list_view_Container)},v.prototype._initToolBar=function(){this._collectionToolBar=new l(this.listViewOptions),this._collectionToolBar.inject(this._collectionToolBarContainer)},v.prototype.loadDataGridView=function(e){var t=this;(new Date).getTime();t._dataGridView=new a({treeDocument:t._model,columns:t._dgvColumn,onContextualEvent:function(){}}).inject(this._list_view_Container),t._dataGridView.rowSelection="multiple",t._dataGridView.cellSelection="none",t._dataGridView.showSelectionCheckBoxesFlag="OnOver",h.initDndDataGridView(t._dataGridView);var n=0;t._dataGridView.addEventListener(o.POINTERHIT,function(e,i){(e.target.hasClassName("wux-tweakers-string-label")||e.target.hasClassName("wux-tweakers-string-icon"))&&(i.nodeModel&&"tree"===e.dsModel.layout.getDataIndexFromColumnIndex(i.columnID)&&(1===e.multipleHitCount?n=setTimeout(function(){if(e.target.hasClassName("wux-tweakers-string-label")){var n={physicalid:i.nodeModel.options.resourceid};t._trmModelEvents.publish({event:"TRMViews-WelcomePanel-OpenStructure",data:n,context:i.nodeModel})}},500):e.multipleHitCount>=2&&clearTimeout(n)))})},v.prototype.fetchData=function(e){var t=this;p._fetchData(e).then(function(e){t._model.prepareUpdate(),e.forEach(function(e){var n=m.getTreeNodeModel(e);t._model.addRoot(n)}),t._model.pushUpdate()}).catch(function(e){console.log(e)})},v.prototype.getDatagridViewColumns=function(){var e=[],t=_.list_column,n={text:"Display Name",dataIndex:"tree",typeRepresentation:"url",width:270,editableFlag:!1,pinned:"left",getCellValue:function(e){return{label:e.nodeModel.options.grid["ds6w:label"]}},setCellValue:function(e,t){t=t.toString(),console.log(t)}};for(var i in e.push(n),t)if(t.hasOwnProperty(i)){var r=u.columns[t[i]],o=t[i];n="type"==i?{text:r,dataIndex:o,typeRepresentation:"string",pinned:"left"}:"revision"==i?{text:r,dataIndex:o,typeRepresentation:"string",pinned:"left",getCellValue:function(e){return e.nodeModel.options.grid["ds6wg:revision"]}}:"current"==i?{text:r,dataIndex:o,typeRepresentation:"string",getCellValue:function(e){return e.nodeModel.options.grid["ds6w:status"]}}:"reserved"==i?{text:r,dataIndex:o,typeRepresentation:"icon",hyperlinkTarget:"_self",alignment:"center",getCellValue:function(e){if(e&&e.nodeModel){var t=e.nodeModel.options.grid["ds6w:reserved"];return"FALSE"===t||"Not Reserved"===t?c.getWebappsAssetUrl("RequirementStructureBrowser","icons/32/I_CheckIn.png"):"TRUE"===t||"Reserved"===t?c.getWebappsAssetUrl("RequirementStructureBrowser","icons/32/I_lock.png"):"N/A"}}}:"description"==i?{text:r,dataIndex:o,typeRepresentation:"string",visibleFlag:!1}:"owner"==i?{text:r,dataIndex:o,typeRepresentation:"string"}:"project"==i?{text:r,dataIndex:o,typeRepresentation:"string"}:"originated"==i?{text:r,dataIndex:o,typeRepresentation:"string"}:"modified"==i?{text:r,dataIndex:o,typeRepresentation:"string"}:"organization"==i?{text:r,dataIndex:o,typeRepresentation:"string"}:{text:r,dataIndex:o,typeRepresentation:"string",visibleFlag:!1},e.push(n)}return e},v.prototype._subscribeEvents=function(){var e=this;this._trmModelEvents.subscribe({event:"enox-collection-toolbar-filter-search-value"},function(t){var n=Array.isArray(t.searchValue)?t.searchValue[0]:"";(new Date).getTime();e._model.prepareUpdate(),e._model.getChildren().forEach(function(e){e.unMatch(n)?e.setSearchFilterState(!0):e.setSearchFilterState(!1),e.applyFilters()}),e._model.pushUpdate()})},v}),define("DS/HomePage/HomePage",["UWA/Core","UWA/Controls/Abstract","UWA/Class/Promise","UWA/Class/Options","DS/PADUtils/PADContext","DS/Controls/Button","DS/ApplicationFrame/CommandsManager","DS/TraceableRequirementsUtils/Command/HomePage_InsertRootCmd","DS/WebappsUtils/WebappsUtils","DS/RequirementStructureBrowser/utils/RequirementsConstant","i18n!DS/HomePage/assets/nls/HomePage","DS/HomePage/views/RecentlyOpenView","DS/HomePage/views/ListViewController","DS/HomePage/views/Requirement3Dsearch","DS/CoreEvents/ModelEvents","DS/RequirementStructureBrowser/utils/TRMMask","DS/RequirementStructureBrowser/utils/TRMTypeManagement","DS/RequirementStructureBrowser/utils/TRMPromiseUtils","css!DS/HomePage/HomePage.css"],function(e,t,n,i,r,o,a,s,l,c,d,p,u,m,h,_,v,g){"use strict";var E="TRMViews-WelcomePanel-";return t.extend(i,{name:"welcome_panel",init:function(t){if(this._parent(t),this._localModelEvents=new h,t.isRichView){var n=t.settings,i=n.root_type,c=n.commands,p=n.Icons;this._context=r.get(),this.elements.container=e.createElement("div",{class:this.getClassNames("_container")}),this.elements.container.search=e.createElement("div",{class:this.getClassNames("_search_container")}),this.elements.container.or=e.createElement("div",{class:this.getClassNames("_search_container_or"),text:"---------- "+d.HomePage_Or+" ----------"}),this.elements.container.or.inject(this.elements.container.search);var u=new o({label:d.HomePage_SearchContent,emphasize:"primary"}).inject(this.elements.container.search);this.elements.container.search.inject(this.elements.container),u.addEventListener("buttonclick",function(e){new s({arguments:[{Type:i}]}).execute()}),this.elements.container.commands=e.createElement("div",{class:this.getClassNames("_command_container")});for(var m=0;m<i.length;m++){var _=new o({label:d["HomePage_"+c[i[m]]],emphasize:"secondary",value:c[i[m]],icon:l.getWebappsAssetUrl("HomePage","icons/"+p[i[m]]),displayStyle:"icon",touchMode:!0}).inject(this.elements.container.commands);_.id=c[i[m]],_.addEventListener("buttonclick",function(e){var t,n=e.dsModel;n=n.value.replace(/ /g,""),t=n,a.getCommand(t).begin()})}this.elements.container.commands.inject(this.elements.container)}},show:function(){this.elements.container.show()},hide:function(){this.elements.container.hide()},initialize:function(){var t=this;return new n(function(n,i){require(["DS/RequirementFrameUtils/RequirementFrameUtils"],function(i){t.elements.container=e.createElement("div",{class:t.getClassNames()});var r=t.frameUtils=new i,o=t.options.modelEvents,a=t._localModelEvents;r.initTriptych(o,t.elements.container),t.elements.triptych=r._triptychComp._triptych,t.leftSlidein=r._triptychComp.getLeftPanelContainer(),t.mainTriptych=r._triptychComp.getMainPanelContainer(),t._mainPanelContent=e.createElement("div",{class:t.getClassNames("_main")}),r.initopbar(o),t._topbar=r._topbar,t.mainTriptych.appendChild(t._topbar),t.mainTriptych.appendChild(t._mainPanelContent);var s={collapsed:!1,parentContainer:t.leftSlidein};r.initWelcomePanel(o,s),t.elements.WelcomePanel=r.WelcomePanelWrapper.WelcomePanel,o.subscribe({event:"welcome-panel-action-selected"},function(e){c.PATH_CREATE_ACTIONS!==e.id&&c.PATH_OPEN_SPEC!==e.id&&(a.publish({event:"welcome-panel-remove-contnet",data:t._mainPanelContent}),a.publish({event:"welcome-panel-select-action",data:e}),o.publish({event:"welcome-panel-active-view",data:e})),t.welcomePanelActions(e)}),o.subscribe({event:E+"clearAll"},t._clearAll.bind(t)),o.subscribe({event:E+"loadData"},function(){var e=widget.getValue("workingNodeIDs");_.mask(t.elements.container,"loading..."),e&&e.length>0?t._openStructureEditor():(o.publish({event:E+"activate"}),o.publish({event:c.EVENT_WELCOME_PANEL_EXPAND})),_.unmask(t.elements.container)}),t.__subscribeEvents(),n()})})},render:function(){return this.elements.container},welcomePanelActions:function(t){var n=this.options.modelEvents;switch(t.id){case c.VIEW_RECENTLY_OPEN:this.recentlyOpen=new p(n),this.recentlyOpen._recentContainer.inject(this._mainPanelContent);break;case c.VIEW_REQ_LIST:case c.VIEW_REQ_SPEC_LIST:var i=c.TYPE_REQUIREMENT;this.req_spec||(this.req_spec=new u(n)),this.req_spec._model.removeRoots(),this.req_spec._containerReqSpec.inject(this._mainPanelContent),"MyReqSPec"===t.id&&(i=c.TYPE_REQUIREMENT_SPECIFICATION),this.req_spec.fetchData(i);break;case c.PATH_CREATE_ACTIONS:n.publish({event:"welcome-panel-action-"+t.id,data:t});break;case c.PATH_OPEN_SPEC:this._x3DSearch||(this._x3DSearch=new m),this._x3DSearch.launchASearch({title:d.open_mv_search_title,allowedTypes:[],precondition:'flattenedtaxonomies:"types/Requirement Specification" OR flattenedtaxonomies:"types/Requirement Group" OR flattenedtaxonomies:"types/Requirement"',multiSel:!0,criteria:"",in_apps_callback:function(t){if(e.is(t,"array")&&t.length>0){var i={x3DSearch:!0,data:t};n.publish({event:"TRMViews-WelcomePanel-OpenStructure",data:i})}}})}},_openStructureEditor:function(e){this.options.modelEvents.publish({event:"TRMViews-WelcomePanel-OpenStructure"})},selectAction:function(e){var t=this.elements.container.getElement(".activity-btn.selected");null!==t&&t.removeClassName("selected"),null!=e&&(this.elements.container.getElement(".activity-btn#"+e).addClassName("selected"),this.selectedItem=e)},_clearAll:function(e){this.options.modelEvents.publish({event:"TRMViews-WelcomePanel-updateStoredObjects",data:{item2remove:e.item2remove}})},__subscribeEvents:function(){var e=this,t=e.options.modelEvents;e._localModelEvents.subscribe({event:"welcome-panel-remove-contnet"},function(e){var t=e.firstChild;t&&e.removeChild(t)}),e._localModelEvents.subscribe({event:"welcome-panel-select-action"},function(t){e.selectAction(null),e.selectAction(t.id),t&&t.id===c.VIEW_REQ_LIST?e._localModelEvents.publish({event:"topbar-show-title",data:{id:c.VIEW_REQ_LIST,label:d.HomePage_RequirementList}}):t&&t.id===c.VIEW_REQ_SPEC_LIST?e._localModelEvents.publish({event:"topbar-show-title",data:{id:c.VIEW_REQ_SPEC_LIST,label:d.HomePage_RequirementSpecificationList}}):t&&t.id===c.VIEW_RECENTLY_OPEN&&e._localModelEvents.publish({event:"topbar-show-title",data:{id:c.VIEW_RECENTLY_OPEN,label:d.HomePage_RecentlyOpened}})}),e._localModelEvents.subscribe({event:"topbar-show-title"},function(t){t&&(e.frameUtils._topbarActionWrapper._title.id=t.id,e.frameUtils._topbarActionWrapper._title.label=t.label,e.frameUtils._topbarActionWrapper._tileContent.setContent(t.label)),e.frameUtils._topbarActionWrapper._breadcrumb.hide(),e.frameUtils._topbarActionWrapper._tileContent.show()}),t.subscribe({event:c.EVENT_WELCOME_PANEL_COLLAPSE},function(){t.publish({event:"triptych-set-size",data:{size:c.LEFT_PANEL_SIZE_COLLAPSED,side:"left"}}),t.publish({event:"triptych-show-panel",data:"left"})}),t.subscribe({event:c.EVENT_WELCOME_PANEL_EXPAND},function(){t.publish({event:"triptych-set-size",data:{size:c.LEFT_PANEL_SIZE_EXPANDED,side:"left"}}),t.publish({event:"triptych-show-panel",data:"left"})})}})});