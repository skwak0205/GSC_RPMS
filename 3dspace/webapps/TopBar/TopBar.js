define("DS/TopBar/model/MainMenuBar",["UWA/Core","UWA/Utils/InterCom","UWA/Utils","DS/TopBarProxy/Menu","DS/TopBarProxy/MenuBarItem"],function(e,t,n,i,s){"use strict";var o,a;function r(t,n,i){var s,o,a;if(!e.is(t,"object"))return t;for(s=0,o=(a=Object.keys(t)).length;s<o;s++)n.call(i,t[a[s]],a[s],t);return t}return o={},a=["away","active","busy","offline"],i.singleton({model:s,uwaClassName:"DS/TopBar/model/MainMenuBar",uninitializedCalls:"throw",alwaysActiveMenuProvidersIds:[],activeMenuProvidersIds:[],_activeProxiesIds:[],setStaticMenuProviders:function(e){this.alwaysActiveMenuProvidersIds=n.splat(e),this.setActiveMenuProviders(this.activeMenuProvidersIds)},setActiveMenuProviders:function(e){this.activeMenuProvidersIds=this.alwaysActiveMenuProvidersIds.concat(n.splat(e)),this._computeActiveProxiesIds(),this._setActiveProxiesIdsOnTopMenuItems()},_computeActiveProxiesIds:function(){this._activeProxiesIds=[],this.activeMenuProvidersIds.forEach(function(e){r(o[e],function(e,t){!0===e&&this._activeProxiesIds.push(t)},this)},this)},_setActiveProxiesIdsOnTopMenuItems:function(){this.forEach(function(e){e.setActiveProxyIds(this._activeProxiesIds)},this)},getActiveMenuProviders:function(){return this.activeMenuProvidersIds},init:function(e){this._parent(null,e)},setup:function(i,s){var o,a,l=[],c=this;this._server=new t.Server("MainMenuBar",{isPublic:!1}),r({activate:"_activateProxy",deactivate:"_deactivateProxy",die:"_unregisterProxy",subscribeToChannel:"_registerProxy",setContent:"setContent",onSubMenuReady:"fireOnSubMenuReady"},function(e,t){this._server.addListener(t,function(t,n){c[e].call(c,n.origin.socket,t)})},this),["onExecute","onSubMenuDisplayed"].forEach(function(e){this.addEvent(e,function(t,i){this._server.dispatchEvent(e,i,null,n.splat(t))},this)},this),a=["context","profile","notification","add","share","content","social","home","help"],(o=s&&s.topMenus)?a.forEach(function(e){var t,n;(t=o)[n=e]&&l.push({id:n,value:t[n]})}):l=[{id:"context"},{id:"profile"},{id:"add"},{id:"share"},{id:"home"},{id:"help"}],l.push({id:"search"}),this.add(l.map(function(t){var n={id:t.id,label:t.id.ucfirst(),submenu:[],onExecute:e.is(t.value,"function")?t.value:void 0};return"profile"===t.id&&(n.userName=s.userName),n}),{silent:!0}),this.setActiveMenuProviders([])},setContent:function(e,t){var n,i=t.onSubMenuDisplayed||{};this.forEach(function(s){var o,a;o=s.id,(a=t[o])&&(s.get("submenu").setItems(e,a),i[o]&&((n=s.get("onSubMenuDisplayed")||{})[e]=!0,s.set("onSubMenuDisplayed",n)))},this)},fireOnSubMenuReady:function(e,t){var n=this.get(t);n&&n.dispatchEvent("onSubMenuReady",[e])},_setProxyActivateStatus:function(t,n,i){var s,a,r,l=o[n];if(e.is(l,"object")&&(a=l[t]),!e.is(a,"boolean"))throw r=this.uwaClassName,new Error(r+": Failed to "+(!1===i?"deactivate":"activate")+" unknown Proxy "+t+" (channel:"+n+")");i!==a&&(l[t]=i,-1<this.activeMenuProvidersIds.indexOf(n)&&(!0===i?this._computeActiveProxiesIds():-1<(s=this._activeProxiesIds.indexOf(t))&&this._activeProxiesIds.splice(s,1),this._setActiveProxiesIdsOnTopMenuItems()))},_deactivateProxy:function(e,t){return this._setProxyActivateStatus(e,t,!1)},_activateProxy:function(e,t){return this._setProxyActivateStatus(e,t,!0)},_unregisterProxy:function(e,t){this.setContent(e,{profile:[],add:[],share:[],home:[],help:[],notification:[],social:[],content:[]}),this._deactivateProxy(e,t),delete o[t][e],this._server.unsubscribeSocket(e)},_registerProxy:function(t,n){var i=o[n];if(i||(i=o[n]={}),e.is(i[t],"boolean"))throw new Error("Proxy "+t+" is already registered on channel "+n);i[t]=!1,this._activateProxy(t,n)},_removeProvider:function(e){var t=this,n=o[e];n&&(r(n,function(n,i){t._unregisterProxy(i,e)}),delete o[e])},setStatus:function(t){var n=this.get({id:"profile"});n?n.set("status",a.indexOf(t)>=0?t:""):e.log("MainMenuBar: Could not change status")},setBadge:function(e,t){var n=this.get({id:e});n&&n.set("countBadge",t)},toJSON:function(e){var t={};return this.forEach(function(n){t[n.id]=n.toJSON(e)},this),t},dump:function(t){t||(t=" "),e.log("Dumping MenuBar: "),this.invoke("dump",t),e.log("JSON value: "),e.log(this.toJSON())}})}),define("TopBar/model/MainMenuBar",["DS/TopBar/model/MainMenuBar"],function(e){"use strict";return e}),define("DS/TopBar/utils/Utils",["UWA/Core"],function(e){"use strict";var t=function(){function e(e){if(null==e)throw new TypeError("assign cannot be called with null or undefined");return Object(e)}return Object.assign?Object.assign:function(t){var n,i,s,o,a,r=e(t);if(1===arguments.length)return r;for(n=1;n<arguments.length;n++)if(null!=(i=arguments[n]))for(s=e(i),o=Object.keys(s),a=0;a<o.length;a++)r[o[a]]=s[o[a]];return r}}();return{debounce:function(e,t,n){var i;return function(){var s,o=this,a=arguments;s=n&&!i,clearTimeout(i),i=setTimeout(function(){i=null,n||e.apply(o,a)},t),s&&e.apply(o,a)}},throttle:function(e,t){var n,i,s,o,a=0;function r(){a=Date.now(),s=null,o=e.apply(n,i)}return function(){var l=Date.now(),c=t-(l-a);return n=this,i=arguments,c<=0?(clearTimeout(s),s=null,a=l,o=e.apply(n,i)):s||(s=setTimeout(r,c)),o}},result:function(t,n){var i;return t?(i=t[n],"function"===e.typeOf(i)?i.call(t):i):null},pick:function(n){var i,s,o;return s={},o=e.is,i=t.apply(null,Array.prototype.concat.apply(Array.prototype,Array.prototype.slice.call(arguments,1)).map(function(e){var t;return o(e,"string")?(t={})[e]=e:o(e,"plain")&&(t=e),t})),Object.keys(i).forEach(function(e){var t,a;e in n&&null!=(t=n[e])&&""!==t&&(a=i[e],o(a,"string")&&(s[a]=n[e]))}),s},renderInitials:function(t,n){var i,s,o,a,r,l,c=["#42A2DA","#57B847","#EA4F37","#00B8DE","#E87B00","#9B2C98","#00AA86","#F564A3","#FF8A2E","#6D2815"];n=e.merge(n||{},{className:"",seed:0});return i=e.createElement("div",{class:"initials-view "+n.className}),(s=(t||"").trim().split(" ")).length<2?i:(o=((r=s[0].substr(0,1))+(l=s[1].substr(0,1))).toUpperCase(),a=Math.ceil((r.charCodeAt(0)+l.charCodeAt(0)+n.seed)%c.length),i.setStyles({"background-color":n.backgroundColor?n.backgroundColor:c[a]}),i.setText(o),i)},find:function(e,t){if(!Array.isArray(e))throw new TypeError("TopBarUtils > find must be call on Array");if("function"!=typeof t)throw new TypeError("TopBarUtils > callback must be a function");for(var n=0;n<e.length;n++){if(t(e[n]))return e[n]}return null},getAllTenants:function(e){return e=e||{},new Promise(function(t){require([["DS","i3DXCompassPlatformServices","i3DXCompassPlatformServices"].join("/")],function(n){n.getPlatformServices({onComplete:function(n){n=n||[];var i=e.serviceName;t(i?n.filter(function(e){return e[i]}):n)},onFailure:function(){t([])}})},function(){t([])})})},getTenant:function(e,t,n){var i=this;return new Promise(function(s){e?(t?t(n):i.getAllTenants(n)).then(function(t){if(t.length){var n=i.find(t,function(t){return[e,t.platformId,t.displayName].every(i.isString)&&t.platformId.toLocaleLowerCase()===e.toLocaleLowerCase()||t.displayName.toLocaleLowerCase()===e.toLocaleLowerCase()});s(n)}else s(null)}):s(null)})},getTenants:function(e,t,n){var i=this,s=[];return new Promise(function(o){if(e.length)return e.forEach(function(e){s.push(i.getTenant(e,t,n))}),Promise.all(s).then(function(e){return o(e)});o([])})},buildPath:function(){var e=[],t=arguments.length-1;return Array.prototype.forEach.call(arguments,function(n,i){n&&(n+="",0!==i&&(n=n.replace(/^\//,"")),i!==t&&(n=n.replace(/\/$/,"")),e.push(n))}),e.join("/")},getAllCollabSpaces:function(e){var t=this;return e.platformId?new Promise(function(t){require([["DS","i3DXCompassPlatformServices","i3DXCompassPlatformServices"].join("/")],function(n){n.getServiceUrl({serviceName:"3DSpace",platformId:e.platformId,onComplete:t,onFailure:function(){t([])}})},function(){t([])})}).then(function(e){return new Promise(function(n,i){var s=t.buildPath(e,"/resources/modeler/pno/person?current=true&select=collabspaces");require([["DS","WAFData","WAFData"].join("/")],function(e){e.authenticatedRequest(s,{method:"GET",type:"json",onComplete:function(e){n((e||{}).collabspaces)},onFailure:function(){n([])}})},function(e){n([])})})}):Promise.resolve([])},getAllCredentials:function(e){return this.getCollabSpace(e).then(function(e){return e&&e.couples})},getCredential:function(e){var t=this;return e.credentialId&&e.credentialId.role&&e.credentialId.organization?t.getAllCredentials(e).then(function(n){return t.find(n,function(t){return t.role.name===e.credentialId.role&&t.organization.name===e.credentialId.organization})}):Promise.resolve(null)},getCredentials:function(e){var t=this,n=[];return new Promise(function(i){if(e.length)return e.forEach(function(e){n.push(t.getCredential(e))}),Promise.all(n).then(function(e){return i(e)});i([])})},getCollabSpace:function(e){var t=this;return e.collabSpaceId?t.getAllCollabSpaces(e).then(function(n){return t.find(n,function(t){return t.name===e.collabSpaceId||t.pid===e.collabSpaceId||t.title===e.collabSpaceId})}):Promise.resolve(null)},getCollabSpaces:function(e){var t=this,n=[];return new Promise(function(i){if(e.length)return e.forEach(function(e){n.push(t.getCollabSpace(e))}),Promise.all(n).then(function(e){return i(e)});i([])})},isString:function(e){return"string"==typeof e||e instanceof String}}}),define("DS/TopBar/views/MenuItemView",["UWA/Core","UWA/Event","UWA/Element","UWA/Class/View","require"],function(e,t,n,i,s){"use strict";var o;return i.extend({tagName:"li",className:"menu-item",setup:function(){var e;this.listenTo(this.model,{onChange:this.update,"onChange:label":this.updateLabel,"onChange:checked":this.updateChecked,"onChange:className":this._updateClassName,onBadgeSumChange:this._updateCountBadge,onRemove:this.remove}),(e=this.model.get("className"))&&e.length&&this.container.addClassName(e)},destroy:function(){this.stopListening(),this._parent()},getContent:function(){var n,i,a,r=this,l=this.model.get("submenu"),c=e.is(l),d=this.model.get("onExecute"),u=this.model.get("group")&&c,m=this.model.get("separator");return this.container.firstChild?this.container:m?(this.container.addClassName("separator"),this.container):(u?this.container.addClassName("menu-item-group"):(this.container.addContent({tag:"div",class:"header",html:[{tag:"span",class:"menu-item-icon menu-item-icon-before"},{tag:"span",class:"menu-item-text",text:this.model.get("label")},{tag:"span",class:"menu-item-badge"}]}),this.model.get("checked")&&this.container.getElement(".menu-item-icon-before").addClassName("checked"),this.$countBadge=this.container.getElement(".menu-item-badge"),"checkbox"===this.model.get("type")?this.container.getElement(".menu-item-icon-before").addClassName("menu-checkbox"):this.model.get("icon")&&this.container.getElement(".menu-item-icon-before").addClassName("fonticon fonticon-"+this.model.get("icon")),this.model.get("icon-after")&&this.container.getElement(".header").addContent({tag:"span",class:"menu-item-icon menu-item-icon-after fonticon fonticon-"+this.model.get("icon-after")})),c&&(o||(o=s("DS/TopBar/views/MenuView").extend({className:"sub-menu"})),i=new o({model:l}),u?n=this.container:(a=function(e){r.toggleSubMenu(),t.stop(e)},d?(this.container.addClassName("executable"),this.container.addContent({tag:"span",class:"menu-item-submenu-icon",events:{click:a}}),this.container.getElement(".header").addEvent("click",function(e){r.container.hasClassName("executable")||a(e)})):(this.container.getElement(".header").addContent({tag:"span",class:"menu-item-submenu-icon"}),this.container.addEvent("click",a)),n=e.createElement("div",{class:"menu-item-submenu"}),this.container.addContent(n)),i.inject(n)),this.model.get("onExecute")?this.container.addEvent("click",function(e){r.model.execute(),t.stop(e)}):c||this.container.addEvent("click",function(e){t.stop(e)}),this.container)},onPostInject:function(){this.$countBadge&&this._updateCountBadge()},update:function(e){e.hasChanged("label")||e.hasChanged("checked")||e.hasChanged("_countBadgeSum")},updateChecked:function(){this.container.getElement(".menu-item-icon-before").toggleClassName("checked")},updateLabel:function(e,t){this.container.getElement(".menu-item-text").setText(t)},remove:function(){this.toggleSubMenu(!1),this.destroy()},toggleSubMenu:function(t){var n=null;e.is(this.model.get("submenu"))&&(this.container.toggleClassName("expanded",t),this.model.get("onExecute")&&this.container.toggleClassName("executable",e.is(t)?!t:void 0),n=this.container.getClosest(".menu"),e.is(n)&&n.toggleClassName("sub-menu-expanded",t))},_updateCountBadge:function(){var e=this.model._getCountsSum();this.$countBadge&&(e&&this.$countBadge.setText(e>99?"99+":e),this.container.toggleClassName("badge",e))},_updateClassName:function(e,t){var n=this.model.previous("className");n&&this.container.removeClassName(n),t&&this.container.addClassName(t)}})}),define("DS/TopBar/utils/Debuggable",["UWA/Core","UWA/Class/Debug"],function(e,t){"use strict";return t.extend({log:function(t){var n=e.is(this.uwaClassName,"string")?this.uwaClassName:"[UNKNOWN]";return this._parent(String.prototype.format.apply(n+": "+t,[].slice.call(arguments,1)))}})}),define("DS/TopBar/views/Menu",["UWA/Core","UWA/Element","UWA/Event","UWA/Utils","UWA/Controls/Abstract"],function(e,t,n,i,s){"use strict";var o,a=(o=/^(header|divider)$/,function(e){if(!e)return!1;for(var t=e.split(" "),n=0;n<t.length;n++)if(o.test(t[n]))return!0;return!1});var r,l={name:"",templateClassname:"",items:null,isVisible:!1,keyboardIndex:-1,defaultOptions:{multiSelect:!1,attributes:{}},init:function(e){void 0===(e=e||{}).kb&&(e.kb=!0),this._parent(e),this.items=[],this.buildSkeleton(),e.items&&e.items.forEach(function(e){this.addItem(e)},this)},buildSkeleton:function(){var t=e.createElement,n=this.elements;n.container||(n.container=t("div",{class:this.getClassNames(),styles:{display:"none","z-index":26}}),Object.keys(this.options.attributes).forEach(function(e){n.container.setAttribute(e,this.options.attributes[e])},this),n.wrapper=t("ul",{class:this.name+"-wrap",tabindex:"1"}),this.options.multiSelect&&n.wrapper.addClassName("dropdown-multiselect"),n.wrapper.inject(n.container))},hide:function(){return this.isVisible&&(this.isVisible=!1,this.getContent().setStyle("display","none"),this.dispatchEvent("onHide")),this},show:function(){return this.isVisible||(this.isVisible=!0,this.getContent().setStyle("display",""),this.focusIt(),this.dispatchEvent("onShow")),this},focusIt:function(){this.options.kb&&this.elements.wrapper.focus()},addItem:function(e){var t=this;return i.splat(e).forEach(function(e){t._addItem(e)}),this},_addItem:function(t){var n,s,o=this.elements,r=t.className||"",l={},c=this;return l.id=t.id||"itm-"+i.getUUID().substr(0,6),t.name||(l.name=t.text),t.disabled&&(r+=" disabled"),t.selected&&(t.selectable=!0),t.selectable&&(r+=" selectable",l.toggleSelection=function(){c.toggleSelection(l)}),l.elements={},l.elements.container=e.createElement("li",{class:"item "+r,id:l.id,title:t.title||""}),Object.keys(t.attributes||{}).forEach(function(e){l.elements.container.setAttribute(e,t.attributes[e])}),t.name&&l.elements.container.set("name",t.name),t.template?l.elements.content=e.createElement("div",{class:"item "+this.templateClassname,id:l.id,html:t.template}).inject(l.elements.container):t.text&&(l.elements.content=e.createElement("span",{class:"item-text",text:t.text||""}).inject(l.elements.container)),a(t.className)?l.elements.container.removeClassName("item"):(t.fonticon&&(l.elements.icon=e.createElement("span",{class:"fonticon fonticon-"+t.fonticon}).inject(l.elements.container,"top"),o.wrapper.addClassName(this.name+"-icons")),!t.fonticon&&t.icon&&(s=t.icon,/\.(gif|jpg|jpeg|tiff|png)$/i.test(s)?l.elements.icon=e.createElement("img",{src:t.icon,class:"item-icon"}):l.elements.icon=e.createElement("span",{class:t.icon}),l.elements.icon.inject(l.elements.container,"top"),o.wrapper.addClassName(this.name+"-icons"))),t.handler&&e.is(t.handler,"function")&&(l.handler=t.handler),t.index&&t.index!==this.items.length+1?(n=this.items[t.index-1],l.elements.container.inject(n.elements.container,"before"),this.items.splice(t.index-1,0,e.merge(l,t))):(l.elements.container.inject(o.wrapper),this.items.push(e.merge(l,t))),t.selected&&this.select(l),l},removeItem:function(e){var t=this;return i.splat(e).forEach(function(e){t._removeItem(e)}),this},_removeItem:function(e){var t=this.getItem(e);t&&(t.elements.container.destroy(),this.items.splice(this.items.indexOf(t),1))},updateItem:function(e){var t=this;return i.splat(e).forEach(function(e){t._updateItem(e)}),this},_updateItem:function(t){var n,i=this.getItem(t.id);i&&(e.is(t.text)&&i.text!==t.text&&(i.text=t.text,i.elements.container.getElement(".item-text").setText(t.text)),n=i.elements.container.getElement("."+this.templateClassname),e.is(t.template)&&n&&n.setHTML(t.template),e.is(t.name)&&i.name!==t.name&&(i.name=t.name),e.is(t.title)&&i.title!==t.title&&(i.title=t.title,i.elements.container.title=t.title),e.is(t.fonticon)&&i.fonticon!==t.fonticon?(i.fonticon=t.fonticon,function(t){t.elements.icon&&t.elements.icon.destroy(),t.elements.icon=e.createElement("span",{class:"fonticon fonticon-"+t.fonticon}).inject(t.elements.container,"top")}(i)):e.is(t.icon)&&i.icon!==t.icon&&(i.icon=t.icon,function(t){t.elements.icon&&t.elements.icon.destroy(),t.elements.icon=e.createElement("span",{class:t.icon}).inject(t.elements.container,"top")}(i)),e.is(t.disabled)&&i.elements.container.toggleClassName("disabled",t.disabled),e.is(t.className)&&i.className!==t.className&&(i.elements.container.removeClassName(i.className),i.elements.container.addClassName(t.className),i.className=t.className,a(t.className)?i.elements.container.removeClassName("item"):i.elements.container.addClassName("item")),e.is(t.handler)&&(i.handler=t.handler))},enableItem:function(e){var t=this.getItem(e);return t&&t.elements.container.removeClassName("disabled"),this},disableItem:function(e){var t=this.getItem(e);return t&&t.elements.container.addClassName("disabled"),this},getItem:function(e){var t,n,i,s=!1;for(t=0,n=this.items.length;t<n;t+=1){if(s=this.items[t],e&&e.nodeType){if(i=e.hasClassName("item")?e:e.getParent(),s.id===i.id)break}else if(t===e||s.id===e||s.name===e)break;s=!1}return s},_hoverItem:function(e,t){var n=this.getItem(e);n&&((t=void 0===t||t)?(n.elements.container.addClassName("js-selected"),this.options.kb&&n.elements.container.focus()):n.elements.container.removeClassName("js-selected"))},_updateKeyboardIndex:function(e,t){var n,i=t||this.keyboardIndex,s=this.keyboardIndex,o=!1;-1===i&&"reset"!==e?(i=0,o=!0):"down"===e&&i<this.items.length-1?(i+=1,o=!0):"up"===e&&i>0?(i-=1,o=!0):"reset"===e&&(this._hoverItem(i,!1),i=-1),(n=this.getItem(i))&&a(n.elements.container.className)&&(o=!1,"down"!==e&&"up"!==e||this._updateKeyboardIndex(e,i)),o&&i>=0&&(this._hoverItem(s,!1),this._hoverItem(i),this.keyboardIndex=i)},toggleSelection:function(e){this.select(e,!e.selected)},select:(r=function(e,t){e.selected=t,e.elements.container[t?"addClassName":"removeClassName"]("selected")},function(e,t){var n,i=!this.options.multiSelect;if(void 0===t||!0===t)i&&(n=this.items.filter(function(e){return e.selected}))[0]&&r(n[0],!1),r(e,!0);else{if(i&&e.selected)return;r(e,!1)}})};return s.extend(l)}),define("DS/TopBar/views/DropdownMenu",["UWA/Core","UWA/Element","UWA/Event","UWA/Utils","DS/UIKIT/Dropdown","DS/UIKIT/Menu"],function(e,t,n,i,s,o){"use strict";var a="dropdown-menu",r="item-submenu",l=o.extend({name:a,templateClassname:"item-template"});function c(e,t,n){Object.keys(e).forEach(function(i){!function(e,t,n,i){t.addEventListener?t.addEventListener(e,n,i):t.attachEvent&&t.attachEvent("on"+e,n,i)}(i,t,e[i],n)})}var d,u=(d=/^(header|divider|disabled)$/,function(e){if(!e)return!1;for(var t=e.split(" "),n=0;n<t.length;n++)if(d.test(t[n]))return!0;return!1}),m={name:a,items:null,menus:null,activeMenu:null,defaultOptions:{subMenuMaxDepth:20},init:function(e){this.menus=[],this.items=[],null==(e=e||{}).kb&&(e.kb=!0),this.setupTemplates(e),this._parent(e),this.menus.reverse()},buildSkeleton:function(){var e,t=this.elements,n=this.options;t.container||(e=this.addMenu(n.items,0,null,n.multiSelect),t.container=e.elements.container,t.container.className=this.getClassNames(),this._handleEvents())},addMenu:function(t,n,i,s){var o,a=[],c=[];return t.forEach(function(e,t){e.items&&n<this.options.subMenuMaxDepth&&(a.push(this.addMenu(e.items,n+1,e.position,e.multiSelect)),c.push(t))},this),(o=new l({kb:this.options.kb,multiSelect:s,items:t,attributes:this.options.attributes})).position=i||"bottom right",this.menus.push(o),this.items=this.items.concat(o.items),a.length&&a.forEach(function(t,n){var i,s=o.getItem(c[n]);t.inject(s.elements.container),s.elements.container.addClassName(r),(i=e.createElement("div",{class:"next-icon"})).inject(s.elements.container),e.createElement("span",{class:"fonticon fonticon-right-open"}).inject(i),t.parentItem=s}),o},setupTemplates:function(t){this.template={},this.template.getItem=function(e){return e.hasClassName("item")?e:e.getParent(".item")},e.extend(this.template,t.template)},addItem:function(e){var t=this;return i.splat(e).forEach(function(e){t._addItem(e)}),this},_addItem:function(t){var n,i,s,o=this;function a(t,n,i){var s,a=o.addMenu(n,0,null,i);return a.inject(o.elements.container),t.elements.container.addClassName(r),(s=e.createElement("div",{class:"next-icon"})).inject(t.elements.container),e.createElement("span",{class:"fonticon fonticon-right-open"}).inject(s),a.parentItem=t,o.updatePosition(),a}if(t.parentItemId)if(i=function(e){var t=o.getItem(e);return t&&o._getMenuFromParentItem(t.id)}(t.parentItemId))t.items?t.text||t.name?((n=i._addItem(t))&&this.items.push(n),n&&a(n,t.items,t.multiSelect)):t.items.forEach(function(e){o.items.push(i._addItem(e))}):this.items.push(i._addItem(t));else{if(!(s=this.getItem(t.parentItemId)))return;t.items&&(t.text||t.name)?i=a(s,[t],t.multiSelect):a(s,t.items||[t],t.multiSelect)}else i=this.menus[0],t.items?((s=i._addItem(t))&&this.items.push(s),s&&a(s,t.items,t.multiSelect)):this.items.push(i._addItem(t))},removeItem:function(e){var t=this;return i.splat(e).forEach(function(e){t._removeItem(e)}),this},_removeItem:function(e){var t,n=this,i=this.getItem(e);i&&((t=this._getMenuFromParentItem(i.id))&&(this.items=this.items.filter(function(i){var s=n._getMenuFromItem(i.id);return!(!s||s.parentItem&&(!s.parentItem||s.parentItem.id===e))||(t.removeItem(i),!1)}),this.menus.splice(this.menus.indexOf(t),1),t.destroy()),(t=this._getMenuFromItem(i.id))&&t.removeItem(e),this.items.splice(this.items.indexOf(i),1))},updateItem:function(e){var t=this;return i.splat(e).forEach(function(e){t._updateItem(e)}),this},_updateItem:function(e){var t,n;(n=this.getItem(e.id))&&(t=this._getMenuFromItem(n.id),e.id=n.id,t&&t.updateItem(e))},enableItem:function(e){var t=this.getItem(e);return t&&t.elements.container.removeClassName("disabled"),this},disableItem:function(e){var t=this.getItem(e);return t&&t.elements.container.addClassName("disabled"),this},getItem:function(e){var t,n,i,s=!1;for(t=0,n=this.items.length;t<n;t++){if(s=this.items[t],e&&e.nodeType){if(i=e.hasClassName("item")?e:e.getParent(),s.id===i.id)break}else if(t===e||s.id===e||s.name===e)break;s=!1}return s},updatePosition:function(e){var t=this;if(this._parent(e),this.isVisible&&!(this.menus.length<=1)){this.getContent().addClassName("js-visible");for(var n=1,i=this.menus.length;n<i;n++)s=this.menus[n],o=void 0,a=void 0,r=void 0,l=void 0,c=void 0,d=void 0,u=void 0,c=(l="bottom")+"-"+(r="right"),d=s.getContent(),u=d.getSize(),s._position&&d.removeClassName(s._position),d.addClassName(c),o=d.getPosition(t.getContent()),a=d.getPosition(),(t._position.offsets.x+o.x+u.width>t._position.viewportWidth||s.position&&s.position.indexOf("left")>-1&&t._position.offsets.x+o.x-a.x-u.width>0)&&(r="left"),(t._position.offsets.y+o.y+u.height>t._position.viewportHeight+t._position.scrollTop||s.position&&s.position.indexOf("top")>-1&&t._position.offsets.y+o.y-a.y-u.height>t._position.scrollTop)&&(l="top"),s._position=l+"-"+r,c!==s._position&&(d.removeClassName(c),d.addClassName(s._position));var s,o,a,r,l,c,d,u;this.getContent().removeClassName("js-visible")}},show:function(e,t){var n;if(this.items.length)return n=this._parent(e,t),this.activeMenu=this.menus[0],this.activeMenu.keyboardIndex=-1,this.activeMenu.focusIt(),this.usingKeyboard=!1,n},hide:function(e){return this._hideSubmenus(),this._parent(e)},_getMenu:function(e){var t,n,i=!1;for(t=0,n=this.menus.length;t<n&&(i=this.menus[t],!e||!e.nodeType||i.elements.container!==e)&&(t!==e&&i.id!==e&&i.name!==e);t++)i=!1;return i},_getMenuFromItem:function(e){return this.menus.filter(function(t){return t.getItem(e)})[0]},_getMenuFromParentItem:function(e){return this.menus.filter(function(t){return t.parentItem&&(t.parentItem.id===e||t.parentItem.name===e||t.parentItem.value===e)})[0]},_hideSubmenus:function(e){var t,n,i=this;if(this.menus.length<=1)this.menus[0].items.forEach(function(e){(e=e.elements&&e.elements.container).removeClassName("js-selected")});else if(e)!function e(n){n&&n.items.forEach(function(n){(n=n.elements&&n.elements.container)&&n.hasClassName(r)&&(t=i._getMenuFromParentItem(n.id),n.removeClassName("js-selected"),t&&t._updateKeyboardIndex("reset"),t&&t.hide(),e(t))})}(i._getMenuFromItem(e));else for(var s=1,o=this.menus.length;s<o;s++)(t=this.menus[s]).hide(),(n=t.parentItem&&this.getItem(t.parentItem.id))&&n.elements.container.removeClassName("js-selected")},_handleItemSelection:function(e){var t;this.timeoutId&&clearTimeout(this.timeoutId),e.hasClassName(r)||e.hasClassName("item-template")?(t=this._getMenuFromParentItem(e.id))&&!t.isVisible&&(this._hideSubmenus(e.id),t=this._getMenuFromParentItem(e.id),e.addClassName("js-selected"),t&&t.show(),this.activeMenu=t):e.hasClassName("item")&&this._hideSubmenus(e.id)},_handleItemClick:function(t,i){var s=n.getElement(t),o=e.Utils.Client.Features.touchEvents,a=!1;if(!i){if(!(i=this.template.getItem(s)))return;i=this.getItem(i.id?i.id:i)}i&&!u(i.elements.container.className)&&(i.selectable&&i.toggleSelection(),o&&(this._handleItemSelection(i.elements.container),a=i.elements.container.hasClassName(r)),this.dispatchEvent("onClick",[t,i,a],this),e.is(i.handler,"function")&&i.handler.call(this,t))},_handleEvents:function(){var t=this,i=this.options;this.events.container={click:function(e){t._handleItemClick(e)},mouseleave:this.dispatchEvent.bind(this,"onMouseLeave"),mouseover:function(e){!t.usingKeyboard&&t._handleItemSelection(n.getElement(e))},mouseout:function(){t.usingKeyboard||(t.timeoutId=setTimeout(t._hideSubmenus.bind(t),500))}},i.kb&&(this.events.container.keydown=function(n){var s,o,a;function r(){t.activeMenu.hide(),(o=t._getMenuFromItem(t.activeMenu.parentItem.id))&&(t.activeMenu=o,t.activeMenu.focusIt())}function l(){(s=t._getActiveItem())&&(s=s.elements.container,t._handleItemSelection(s)),t.activeMenu._updateKeyboardIndex()}switch(t.usingKeyboard=!0,n.which){case 13:(s=t._getActiveItem())&&t._handleItemClick(n,t._getActiveItem()),t.options.closeOnClick&&(t.hide(),i.target.focus()),e.Event.preventDefault(n);break;case 27:t.hide(),i.target.focus(),e.Event.preventDefault(n);break;case 37:a=t.activeMenu.elements.container,s=t._getActiveItem(),a.hasClassName("bottom-left")||a.hasClassName("top-left")?s&&s.elements.container.hasClassName("item-submenu")&&l():r(),e.Event.preventDefault(n);break;case 38:t.activeMenu._updateKeyboardIndex("up"),e.Event.preventDefault(n);break;case 39:a=t.activeMenu.elements.container,s=t._getActiveItem(),a.hasClassName("bottom-left")||a.hasClassName("top-left")?r():s&&s.elements.container.hasClassName("item-submenu")&&l(),e.Event.preventDefault(n);break;case 40:t.activeMenu._updateKeyboardIndex("down"),e.Event.preventDefault(n);break;default:e.Event.preventDefault(n)}}),this.elements.container.addEvents(this.events.container),i.contextual?(this.events.target={mousedown:function(t){var i=n.getElement(t),s=2===e.Event.whichButton(t);i.isInjected(this.elements.container)||i===this.elements.container||s&&this.isVisible&&this.updatePosition(t)}.bind(this),contextmenu:function(e){this.show(!0,e),n.stop(e)}.bind(this)},c(this.events.target,i.target,!0)):i.bound&&(this.events.target={click:this.toggle.bind(this)},c(this.events.target,i.target,!0))},_getActiveItem:function(){var e=this.activeMenu.keyboardIndex;return!!(this.activeMenu&&e>=0)&&this.activeMenu.getItem(e)},getSelectedItems:function(){var e=[];return this.items&&(e=this.items.filter(function(e){return e.selected})),e},isSelected:function(e){var t=this.getItem(e);return t&&t.selected},toggleSelection:function(e){e&&e.selectable&&e.toggleSelection()}};return s.extend(m)}),define("DS/TopBar/views/MenuView",["UWA/Core","UWA/Class/View","DS/TopBar/utils/Utils","DS/UIKIT/DropdownMenu","i18n!DS/TopBar/assets/nls/TopBar"],function(e,t,n,i,s){"use strict";var o="id";function a(e){return e?e.get(o)||e[o]:null}var r=i.extend({init:function(e){this._parent(e)},_onKeyDown:function(e){[13,27,37,38,39,40].includes(e.which)&&this._parent(e)}});return t.extend({className:"",_target:null,_itemMap:null,_dropdownMenu:null,_isDirty:!0,_isActive:!1,setup:function(e){var t;if(!this.model)throw new Error("Incorrect arguments");this._target=e.target,t=this._mapItems(this.model,this._getItemConnections,this._onExecuteItem),this._itemMap=t.map,this._buildDdMenu(this._getInitialDDMenuOptions()),this._addCollectionListeners=this._addCollectionListeners.bind(this),this._initItem=this._initItem.bind(this),this._onExecuteItem=this._onExecuteItem.bind(this),this._onAdd=this._onAdd.bind(this),this._onRemove=this._onRemove.bind(this),this._onRefresh=this._onRefresh.bind(this),this._onUpdateItem=this._onUpdateItem.bind(this),this._bfsIterator(this.model,this._initItem,this._getItemConnections)},_getInitialDDMenuOptions:function(){var e;return e=this._mapItems(this.model,this._getItemConnections,this._onExecuteItem),{tenant:this.options.tenant,items:e.items.length>0?e.items:[{text:""}]}},_addTenantPlaceholder:function(e){var t=n.find(e.items,function(e){return e&&e.name&&"context"===e.name});return t&&(t.items=[{className:"topbar-menu-dd-item",disabled:!0,id:"context-placeholder",name:"context-placeholder",selectable:!1,selected:!1,template:'<span class="item-text">Loading ...</span>',text:"Loading ..."}]),e},_removeTenantPlaceholder:function(){return this._dropdownMenu.removeItem("context-placeholder")},_addTenants:function(e){var t=e||{},n=t&&t.currentTenant,i=n&&n.text,s=n&&n.fonticon,o=t&&t.tenants;t&&t.submenu?(this._dropdownMenu.addItem({parentItemId:"context",items:[{className:"topbar-menu-dd-item",fonticon:s,id:"tenant",name:i,text:i}]}),this._dropdownMenu.addItem({parentItemId:i,items:o.map(function(e){return e.className="topbar-menu-dd-item",e})})):this._dropdownMenu.addItem({parentItemId:"context",items:o.map(function(e){return e.className="topbar-menu-dd-item",e})})},_addCollabSpaces:function(e){var t=e||{},n=t&&t.currentCollabSpace,i=n&&n.text,s=n&&n.fonticon,o=t&&t.collabSpaces;t&&t.submenu?(this._dropdownMenu.addItem({parentItemId:"context",items:[{className:"topbar-menu-dd-item",fonticon:s,id:"collabspace",name:i,text:i}]}),this._dropdownMenu.addItem({parentItemId:i,items:o.map(function(e){return e.className="topbar-menu-dd-item",e})})):this._dropdownMenu.addItem({parentItemId:"context",items:o.map(function(e){return e.className="topbar-menu-dd-item",e})})},_addCredentials:function(e){var t=e||{},n=t&&t.currentCredential,i=n&&n.text,s=n&&n.fonticon,o=t&&t.credentials;t&&t.submenu?(this._dropdownMenu.addItem({parentItemId:"context",items:[{className:"topbar-menu-dd-item",fonticon:s,id:"credential",name:i,text:i}]}),this._dropdownMenu.addItem({parentItemId:i,items:o.map(function(e){return e.className="topbar-menu-dd-item",e})})):this._dropdownMenu.addItem({parentItemId:"context",items:o.map(function(e){return e.className="topbar-menu-dd-item",e})})},_addContexts:function(e){var t,n,i,s,o,a,r,l=this;e().then(function(e){n=e.items[0],s=e.items[1],o=e.items[2],t=n&&n.items,i=s&&s.items,a=o&&o.items,r=t&&t.length&&i&&i.length,n&&t&&t.length>1?(l._updateContextTitle({readOnly:!1}),l._addTenants({currentTenant:n,tenants:t,submenu:r})):l._updateContextTitle({readOnly:!0}),s&&i&&i.length&&(l._addCollabSpaces({currentCollabSpace:s,collabSpaces:i,submenu:r}),o&&a&&a.length&&l._addCredentials({currentCredential:o,credentials:a,submenu:r})),l._removeTenantPlaceholder(),l._dropdownMenu.updatePosition()})},_updateContextTitle:function(t){var n=t&&t.name,i=t&&t.readOnly;n&&this._dropdownMenu.updateItem({id:"context",text:n,name:n}),e.is(i,"boolean")&&this._dropdownMenu.updateItem({id:"context",className:i?"topbar-menu-dd-item read-only":"topbar-menu-dd-item"}),this._dropdownMenu.updatePosition()},_buildDdMenu:function(t){var i=this.model.collection||"",s=i.indexOf(this.model),o=i.length&&i.length-s<=3,l=n.pick(this.options,["position","bound","closeOnClick","offset","events","renderTo","altPosition","multiSelect","subMenuMaxDepth","kb"]),c=e.extend(l,{className:"topbar-menu-dd context-dropdown-menu menu-context",items:t.items||this._getInitialDDMenuOptions().items,addTenantPlaceholder:t.addTenantPlaceholder,target:this._target,scrollableResponsive:!0,events:{onShow:this._handleDropdownEvents.bind(this,"onShow"),onHide:this._handleDropdownEvents.bind(this,"onHide"),onClick:this._handleDropdownEvents.bind(this,"onClick"),onClickOutside:this._handleDropdownEvents.bind(this,"onClickOutside"),onMouseLeave:this._handleDropdownEvents.bind(this,"onMouseLeave")}});this._dropdownMenu&&this._dropdownMenu.destroy(),this.model.id&&(c.position=o?"end-edge":"center"),c.addTenantPlaceholder&&(c=this._addTenantPlaceholder(c)),this._dropdownMenu=new r(c),this._dropdownMenu.elements.container.addClassName(a(this.model))},_handleDropdownEvents:function(e,t,n){var i=this.options.events;"onShow"===e&&(this._isActive=!0,this._isDirty&&(this._onRefresh(this.model.get("submenu"),[],{force:!0}),this.show())),"onHide"===e&&(this._isActive=!1),i&&i[e]&&i[e].apply(null,[t,n])},_initItem:function(e,t){t&&this._addCollectionListeners(t,{isRoot:this.model===e})},_onUpdateItem:function(e){var t,n,i=e.changedAttributes(),s=this._dropdownMenu;this._isActive?i&&s&&(t=s.getItem(e.id))&&(n={id:e.id,template:this._getItemTemplate(e),disabled:e.get("disabled"),selectable:e.get("checked")||"checkbox"===e.get("type")||e.get("selectable"),selected:e.get("checked")||e.get("selected"),multiSelect:e.get("multiSelect")},s.updateItem(n),n.selected!==t.selected&&t.toggleSelection&&t.toggleSelection()):this._isDirty=!0},_addCollectionListeners:function(e,t){t||(t={});e&&this.listenTo(e,t.isRoot?{onAdd:this._onAdd,onRemove:this._onRemove,onChange:this._onUpdateItem,onChangeActivatedProxyIds:this._onRefresh}:{onAdd:this._onAdd,onRemove:this._onRemove})},_removeCollectionListeners:function(e){e&&this.stopListening(e)},getContent:function(){},toggle:function(){},_treeIterator:function(t,n,i,s){s||(s={});var o,a,r,l=[{model:t,parentModel:null,parentCollection:null}],c=!!s.dfs;function d(e){l.push({model:e,parentModel:o.model,parentCollection:o.connections})}function u(){if(c){if(o=l.pop(),a=o.connections=i(o.model))for(var e=a.length-1||0;e>=0;e--)d(a.at?a.at(e):a[e]);r=n(o.model,a,o.parentModel,o.parentCollection)}else o=l.splice(0,1)[0],(a=o.connections=i(o.model))&&a.forEach(d),r=n(o.model,a,o.parentModel,o.parentCollection)}for(;l.length>0&&(!e.is(r)||r);)u()},_bfsIterator:function(e,t,n){this._treeIterator.call(this,e,t,n)},_dfsIterator:function(e,t,n){this._treeIterator.call(this,e,t,n,{dfs:!0})},_getItemConnections:function(e,t){return t||(t={}),e.get("submenu")},_onAdd:function(t,n){var i,s,o,r,l=this._itemMap;this._isActive?l[a(t)]||n.getActiveItems().indexOf(t)<0||(s=this._mapItem(t,this._onExecuteItem.bind(null,t)),l[a(t)]=s,o=this._getParentModel(t,this._getItemConnections),i=this._mapItems(t,this._getItemConnections,this._onExecuteItem,{itemMap:l}),e.extend(l,i.map),i.items.length>0&&(s.items=i.items),o&&o!==this.model&&(s.parentItemId=a(o)),t.get("group")&&t.get("submenu")?(r=[],t.get("submenu").forEach(function(e){var t=l[a(e)];t&&r.push(t)}),this._dropdownMenu.addItem(r)):this._dropdownMenu.addItem(s),this._bfsIterator(t,this._initItem,this._getItemConnections),this._isActive&&!this.isVisible()&&this.show()):this._isDirty=!0},_onRemove:function(e){var t=this;t._bfsIterator(e,function(e,n){t._removeCollectionListeners(n)},t._getItemConnections),t._dropdownMenu.removeItem(a(e)),delete t._itemMap[a(e)]},_getParentModel:function(t,n){var i;return this._bfsIterator(this.model,function(n,s,o){return i=t===n?o:i,!e.is(i)},n),i},_onExecuteItem:function(e){e&&e.execute&&e.execute()},_onExecuteGroup:function(e,t,n){var i=this._dropdownMenu;t.get("multiSelect")||(this._getItemConnections(t)||[]).forEach(function(t){var n=i.getItem(t.id);t!==e&&n&&n.selected&&n.selectable&&n.toggleSelection()}),n(e)},_mapItems:function(e,t,i,s){s||(s={});var o=this,r=a(e),l=o.options,c=s.itemMap||Object.create(null);function d(e,t){return t.last?t.last()===e:t[t.length-1]===e}return o._dfsIterator(e,function(e,t,s,r){var u,m,h,p=a(e),f=c[a(s)],g=n.pick(l,["multiSelect"]);if(e.get("separator")?u=o._mapItem(null,null,{type:"separator"}):e.get("group")?(e.get("label")||r&&(m=0,((h=r).at?h.at(m):h[m]||null)!==e))&&(u=o._mapItem(e,null,{type:"group"})):u=o._mapItem(e,i.bind(null,e),g),s)if(s.get("group")){var v=o._getParentModel(s,o._getItemConnections),b=c[a(v)];u.handler=o._onExecuteGroup.bind(o,e,s,i),b.items||(b.items=[]),b.items.push(u),d(e,r)&&s.collection&&!d(s,s.collection)&&b.items.push(o._mapItem(null,null,{type:"group"}))}else f.items||(f.items=[]),u&&f.items.push(u);u&&(c[p]=u)},t),{items:c[r].items||[],map:c}},_mapItem:function(e,t,n){n||(n={});var i,o,r=e.get("id"),l=r&&s[r]||e.get("label");switch(n.type){case"separator":case"group":i=e&&e.collection&&e.get("label")?{className:"header",text:e.get("label")}:{className:"divider"};break;default:i={name:o=a(e),id:o,disabled:e.get("disabled"),text:l,template:this._getItemTemplate(e),selectable:e.get("checked")||"checkbox"===e.get("type")||e.get("selectable"),selected:e.get("checked")||e.get("selected"),className:"topbar-menu-dd-item",multiSelect:e.get("multiSelect"),handler:e.get("onExecute")&&t?t:void 0}}return i},_getItemTemplate:function(e){var t="",n=e.get("id"),i=n&&s[n]||e.get("label")||"",o=e.get("fonticon")||"",a=e.get("icon")||"",r=e._getCountsSum?e._getCountsSum():0,l=e.get("disabled")?"disabled":"enabled";return o&&(t+='<span class="fonticon fonticon-'+o.escapeHTML()+" item-icon "+l+'"></span>'),a&&(t+='<span class="item-icon item-image '+l+'" style="background-image: url(\''+a+"')\"></span>"),r&&(t+='<span class="item-badge">'+(r>99?"+99":r)+"</span>"),t+='<span class="item-text">'+i.escapeHTML()+"</span>"},_onRefresh:function(e,t,n){n||(n={});var i,s=this;function o(e,t){t&&s._removeCollectionListeners(t)}s._isActive||n.force?(e.forEach(function(e){s._bfsIterator(e,o,s._getItemConnections)}),i=s._mapItems(s.model,function(e){var t=e.get("submenu"),n=null;return t&&(n=t.getActiveItems?t.getActiveItems():t),n},s._onExecuteItem),s._itemMap=i.map,s._buildDdMenu({items:i.items}),s._bfsIterator(s.model,s._initItem,s._getItemConnections),s._isDirty=!1,s._isActive&&!s.isVisible()&&s.show()):s._isDirty=!0},show:function(e){var t=e&&e.refresh;this._isActive=!0,this._isDirty=this._isDirty||!!t,this._isDirty&&this._onRefresh(this.model.get("submenu"),[]),this._dropdownMenu&&this._dropdownMenu.show()},hide:function(){this._isActive=!1,this._dropdownMenu&&this._dropdownMenu.hide()},isVisible:function(){return this._dropdownMenu&&this._dropdownMenu.isVisible},destroy:function(){this._parent(),this._dropdownMenu.destroy(),this.container=null,this._target=null}})}),define("DS/TopBar/views/SearchView",["text!DS/TopBar/assets/templates/SearchView.html","DS/TopBar/assets/nls/TopBar_temp","DS/Handlebars/Handlebars4","UWA/Core","UWA/Element","UWA/Event","UWA/Class/View","DS/TopBar/utils/Debuggable","DS/TopBar/utils/Utils","DS/TopBar/views/MenuView","DS/UIKIT/Tooltip","i18n!DS/TopBar/assets/nls/TopBar"],function(e,t,n,i,s,o,a,r,l,c,d,u){"use strict";function m(e,t,n){var s,o,a;if(!i.is(e,"object"))return e;for(s=0,o=(a=Object.keys(e)).length;s<o;s++)t.call(n,e[a[s]],a[s],e);return e}return a.extend(r,{uwaClassName:"SearchView",id:"global_ctn_search",className:"topbar-search",children:null,domEvents:{"click .topbar-search-cmd":"_onSearch","click .topbar-search-clear":"_onClearSearch","keyup .topbar-search-input":"_onSearchInputKeyUp","keydown .topbar-search-input":"_onSearchInputKeyDown"},template:n.compile(e),setup:function(e){this.listenTo(this.model,{"onChange:searchOptionBox":this._updateSearchOptionName,"onChange:searchPlaceHolder":this._updateSearchPlaceHolder}),this.debugMode=l.result(e,"debugMode"),this.children={},this._filterInProgress=!1},destroy:function(){this.stopListening(this.children.searchOptions),m(this.children,function(e,t,n){e.destroy(),n[t]=null}),this.stopListening(this.model),this._parent(),this.container=null},_updateSearchOptionName:function(e,t){this.$searchOptionName.setText(t||"")},_updateSearchPlaceHolder:function(e,t){this.$searchInput.placeholder=t||""},_onSearch:function(){var e=this.$searchInput.value,t=""===e;this._filterInProgress=!t,this.model.hasEvent("search")&&this.model.dispatchEvent("search",{value:e})},_onClearSearch:function(){this.$searchInput.value="",this.$clearSearchButton.hide(),this.model.hasEvent("clearSearch")&&this.model.dispatchEvent("clearSearch")},_onSearchInputKeyUp:function(e){this.$searchInput.value?this.$clearSearchButton.setStyle("display","inline-block"):this._filterInProgress||this.$clearSearchButton.hide(),o.stopPropagation(e)},_onSearchInputKeyDown:function(e){"return"===o.whichKey(e)&&this._onSearch(),o.stopPropagation(e)},render:function(){var e,n=this;return n.model.set("tooltips",{search:u.search,clear:u.clear}),e=n.template({model:n.model.toJSON(),nls:u}),n.container.setContent(e),m({searchButton:".topbar-search-cmd",searchInput:"input.topbar-search-input",clearSearchButton:".topbar-search-clear"},function(e,t){n["$"+t]=n.getElement(e)},n),new d({position:"bottom",target:n.$searchButton,body:t.search}),n.children.searchOptions=new c({target:n.$searchInput,renderTo:n.container,model:n.options.searchMenu,bound:!0,altPosition:{x:-1,y:42},multiSelect:!0,closeOnClick:!1}),n}})}),define("DS/TopBar/views/ResponsiveDropdownMenu",["UWA/Core","UWA/Element","UWA/Event","DS/TopBar/views/DropdownMenu","DS/TopBar/views/Menu"],function(e,t,n,i,s){"use strict";function o(n,i,s){s=s||5;var o=n.parentNode,a=0;if(i)for(;a<s&&o&&1===o.nodeType&&!t.match.call(o,i);)o=o.parentNode,a++;return(o&&1!==o.nodeType||a===s)&&(o=null),o?e.extendElement(o):null}var a,r=(a=/^(header|divider|disabled)$/,function(e){if(!e)return!1;for(var t=e.split(" "),n=0;n<t.length;n++)if(a.test(t[n]))return!0;return!1}),l="dropdown-menu",c="topbar-menu-dd-item",d="item-submenu",u="conceal",m="active",h="current",p=e.Utils.Client.Features,f=s.extend({name:l,templateClassname:"item-template",show:function(){var e,n=this,i=n._parent,s=arguments,o=this.elements.container;function a(){o.removeClassName(u)}function r(){clearTimeout(e),o.addClassName(m),o.addClassName(h),i.apply(n,s),o.removeEvent("transitionEnd")}n.isVisible||(639>=t.getSize.call(document.body).width?(e=setTimeout(r,400),o.addEvent("transitionEnd",r),window.requestAnimationFrame(a)):(i.apply(n,s),a()),n.isVisible=!0)},hide:function(e){e||(e={});var n,i=this,s=i._parent,o=arguments,a=i.elements.container;function r(){a.addClassName(u)}function l(){clearTimeout(n),a.removeClassName(m),a.removeClassName(h),s.apply(i,o),a.removeEvent("transitionEnd")}i.isVisible&&(639>=t.getSize.call(document.body).width?(n=setTimeout(l,400),a.addEvent("transitionEnd",l),window.requestAnimationFrame(r)):(s.apply(i,o),r()),i.isVisible=!1)}});return i.extend({UI_BREAK:639,name:l,_mainMenu:null,buildSkeleton:function(){var t,n=this.elements,i=this.options;n.container||(n.container=e.createElement("div"),this._mainMenu=t=this.addMenu(i.items,0,i.position,i.multiSelect,null,this),t.elements.container.inject(n.container,"top"),t.elements.container.className=this.getClassNames().replace(i.className,""),n.container.className=i.className+" responsive-dropdown-menu ",t.elements.container.setStyle("display",""),this._handleEvents())},_isSmallScreen:function(){return t.getSize.call(document.body).width<=this.UI_BREAK},_handleEvents:function(){var e,t=this,i=t.elements.container;t._parent.apply(t,arguments),i.removeEvent("mouseover"),i.removeEvent("mouseout"),i.addEvent("mouseover",function(i){t._isSmallScreen()||t._shouldIgnoreMouseOverEvent||(t._shouldIgnoreClickEvent&&(t._shouldIgnoreMouseOverEvent=!0,setTimeout(function(){t._shouldIgnoreMouseOverEvent=!1},100)),(e=n.getElement(i)).hasClassName(c)||(e=o(e,"."+c,3)||e),!t.usingKeyboard&&t._handleItemSelection(e))}),i.addEvent("mouseout",function(e){t._shouldIgnoreMouseOverEvent||t._isSmallScreen()||!t.usingKeyboard&&(t.timeoutId=setTimeout(t._hideSubmenus.bind(t),500))}),!p.touchEvents&&i.addEventListener("touchstart",t._onHybridTouch.bind(t),{passive:!0})},_addMenu:function(t,n,i,s,o,a,r,l){var c,m,h;return(c=new f({kb:a.options.kb,multiSelect:s,items:t})).elements.container.addClassName("responsive"),c.elements.container.addClassName(u),c.position=i||"bottom right",o&&((m=c.getItem(0)).parentItem=o,(h=e.createElement("div",{class:"back-icon"})).inject(m.elements.container,"top"),e.createElement("span",{class:"fonticon fonticon-left-open"}).inject(h)),this.menus.push(c),a.items=a.items.concat(c.items),r&&r.length&&r.forEach(function(t,n){var i,s=c.getItem(l[n]);t.inject(a.elements.container,"top"),s.elements.container.addClassName(d),(i=e.createElement("div",{class:"next-icon"})).inject(s.elements.container),e.createElement("span",{class:"fonticon fonticon-right-open"}).inject(i),t.parentItem=s}),c},addMenu:function(e,t,n,i,s,o){var a=[],r=[];return s&&e.splice(0,null,{text:s.text,className:"item-back"}),e.forEach(function(e,n){e.items&&t<this.options.subMenuMaxDepth&&(a.push(this.addMenu(e.items,t+1,e.position,e.multiSelect,e,o)),r.push(n))}.bind(this)),o||(o=this),this._addMenu(e,t,n,i,s,o,a,r)},_handleItemSelection:function(e){var t,n,i,s=this._getMenuFromItem(e.id);this.timeoutId&&clearTimeout(this.timeoutId),s&&(e.hasClassName("item-back")?(i=this.getItem(e.id),(t=this._getMenuFromItem(i.parentItem.id)).elements.container.getElements(".js-selected").forEach(function(e){e&&e.removeClassName("js-selected")}),window.requestAnimationFrame(function(){s.hide(),t.elements.container.addClassName(h)})):(e.hasClassName(d)||e.hasClassName("item-template"))&&(this._isSmallScreen()&&(n=this._getMenuFromParentItem(e.id))&&n.elements.container.setStyle("display",""),window.requestAnimationFrame(function(){s.elements.container.removeClassName(h)}))),e.hasClassName(d)||e.hasClassName("item-template")?(n=this._getMenuFromParentItem(e.id))&&!n.isVisible?(this._hideSubmenus(e.id,n),n=this._getMenuFromParentItem(e.id),e.addClassName("js-selected"),n&&n.show(),this.activeMenu=n):n&&n.isVisible&&this._hideSubmenus(n.items[0].id):e.hasClassName("item")&&this._hideSubmenus(e.id)},_hideSubmenus:function(e){var t,n,i=this,s=arguments[arguments.length-1];if(this.menus.length<=1)this.menus[0].items.forEach(function(e){(e=e.elements&&e.elements.container).removeClassName("js-selected")});else if(e)!function e(n){n&&n.items.forEach(function(n){(n=n.elements&&n.elements.container)&&n.hasClassName(d)&&(t=i._getMenuFromParentItem(n.id),n.removeClassName("js-selected"),t&&t._updateKeyboardIndex("reset"),t&&t!==s&&t.hide(),e(t))})}(i._getMenuFromItem(e));else for(var o=1,a=this.menus.length;o<a;o++)(t=this.menus[o]).hide(),(n=t.parentItem&&this.getItem(t.parentItem.id))&&n.elements.container.removeClassName("js-selected")},show:function(){var e=this._mainMenu.elements.container;e.addClassName("responsive-dropdown-menu-root"),this._parent.apply(this,arguments),window.requestAnimationFrame(function(){e.addClassName(m),e.addClassName(h)})},hide:function(){var e=this._mainMenu.elements.container;this._parent.apply(this,arguments),window.requestAnimationFrame(function(){e.removeClassName(m),e.removeClassName(h)})},updatePosition:function(){this._parent.apply(this,arguments),"end-edge"===this.options.position&&this.elements.container.addClassName("topbar-end-edge")},_onHybridTouch:function(e){var t=n.getElement(e),i=this.template.getItem(t);i&&(i.hasClassName(c)||(i=o(i,"."+c,3)||i),(i=this.getItem(i.id?i.id:i))&&i.elements.container.hasClassName("item-submenu")&&(this._shouldIgnoreClickEvent=!0,setTimeout(function(){this._shouldIgnoreClickEvent=!1},50)))},_handleItemClick:function(t,i,s){var a=n.getElement(t),l=!1;(s=s||p.touchEvents||p.pointerEvents)||!this._shouldIgnoreClickEvent?(i||(i=this.template.getItem(a)))&&(i&&i.hasClassName("item-back")||t.target.hasClassName("item-back")||o(t.target,".item-back",3)?(this._isSmallScreen()&&this._handleItemSelection(i),l=!0,this.dispatchEvent("onClick",[t,this.getItem(i.id?i.id:i),l],this)):(i=this.getItem(i.id?i.id:i))&&!r(i.elements.container.className)&&(i.selectable&&i.toggleSelection(),(s||this._isSmallScreen())&&(this._handleItemSelection(i.elements.container),l=i.elements.container.hasClassName(d)),this.dispatchEvent("onClick",[t,i,l],this),e.is(i.handler,"function")&&i.handler.call(this,t))):this._shouldIgnoreClickEvent=!1},updateBackIcon:function(e,t){var n,i=e&&this._getMenuFromParentItem(e);i&&(n=i.items&&i.items[0],this.updateItem({id:n.id,text:t}))}})}),define("DS/TopBar/views/MenuBarItemView",["UWA/Core","UWA/Class/View","DS/TopBar/views/MenuView","DS/UIKIT/Tooltip","i18n!DS/TopBar/assets/nls/TopBar"],function(e,t,n,i,s){"use strict";return t.extend({className:function(){return this.model.id+" topbar-menu-item topbar-cmd "+(this.model.get("disabled")?"disabled":"enabled")+" fonticon fonticon-"+this.model.get("fonticon")},attributes:{html:[{tag:"span",class:"topbar-menu-item-badge"},{tag:"span",class:"topbar-floating-arrow"}]},domEvents:{click:"_onIconClick"},_getBadgeClassName:function(e){var t="fonticon fonticon-";switch(e){case"active":t+="check "+e;break;case"busy":t+="minus "+e;break;case"away":t+="cancel "+e;break;case"offline":t+="record "+e}return t},setup:function(){this.className=this.className+" .btn_"+this.model.id,this.listenTo(this.model,{onBadgeSumChange:this._updateCountBadge,"onChange:activatedProxyIds":this._updateEnabled,"onChange:countBadge":this._updateCountBadge,"onChange:status":this._updateStatus,onSubMenuReady:this._onSubMenuReady}),this.$countBadge=this.getElement(".topbar-menu-item-badge"),this.$floatingArrow=this.getElement(".topbar-floating-arrow"),this.deactivate=this.deactivate.bind(this),this.activate=this.activate.bind(this)},destroy:function(){this.subView&&this.subView.destroy(),this.subView=null,this.stopListening(),this._parent(),this.container=null},activate:function(){this.dispatchEvent("onActivate",[this,this.model]),this.container.addClassName("active"),this.model.fireOnSubMenuReady(),this.model.fireOnSubMenuDisplayed()},_onSubMenuReady:function(){var e=this.model.get("submenu");e&&e.length>0?this.$floatingArrow.show():this.$floatingArrow.hide(),this.subView.show()},deactivate:function(){this.container.removeClassName("active"),this.dispatchEvent("onDeactivate",[this,this.model]),this.subView.hide(),this.$floatingArrow.hide()},isActive:function(){return this.container.hasClassName("active")},_onIconClick:function(){var t,n=this.model.get("submenu");this.model.get("onExecute")&&(t=this.model.get("onExecute").call()),(t=e.is(t)?t:!!n&&!!n.getActiveItems().length)&&(this.isActive()?this.deactivate():this.activate())},_updateEnabled:function(){this.model.get("disabled")?(this.container.removeClassName("enabled"),this.container.addClassName("disabled")):(this.container.addClassName("enabled"),this.container.removeClassName("disabled")),this._updateCountBadge()},_updateCountBadge:function(){var e=this.model.get("submenu")._getCountsSum()+(this.model.get("countBadge")||0);e&&(this.$countBadge.setText(99<e?"+99":e),this.options.topFrameVue&&this.options.topFrameVue.patch("menus",[{id:"notification",badge:e}])),this.model.get("status")||this.$countBadge.setStyle("display",e?"inline":"none")},_updateStatus:function(e,t){var n=this,i=n.$countBadge;function s(){i.removeClassName("fonticon"),i.removeClassName("fonticon-check"),i.removeClassName("active"),i.removeClassName("fonticon-minus"),i.removeClassName("busy"),i.removeClassName("fonticon-cancel"),i.removeClassName("away"),i.removeClassName("fonticon-record"),i.removeClassName("offline")}(i||"profile"===n.model.id)&&window.requestAnimationFrame(function(){t?(i.hide(),i.setText(""),s(),i.addClassName(n._getBadgeClassName(t)),i.show()):(i.hide(),s())})},render:function(){var e="profile"===this.model.id?this.model.get("userName"):s[this.model.id];return this.subView=new n({kb:!1,model:this.model,target:this.container,tenant:"context"===this.model.get("id")&&this.model.get("tenantId"),bound:!1,closeOnClick:!0,offset:{x:0,y:-1},subMenuMaxDepth:40,events:{onClickOutside:this.deactivate,onHide:this.deactivate}}),e&&new i({position:"bottom",target:this.container,body:e,closeOnClick:!0}),this.subView.inject(this.container),this.container}})}),define("DS/TopBar/views/ScrollableDropdownMenu",["UWA/Core","UWA/Element","UWA/Utils/Client","DS/UIKIT/Scroller","DS/TopBar/views/ResponsiveDropdownMenu"],function(e,t,n,i,s){"use strict";return s.extend({name:"scrollable-dropdown-menu",_handleItemSelection:function(t){var i=this,s=i._parent.apply(i,arguments),o=e.Element.getSize.apply(document.body),a=o.width>=i.UI_BREAK;if(t.hasClassName("js-selected")){var r=i.activeMenu,l=i.elements.container,c=r.elements.container;if(i.activeMenu.items.some(function(e){return Array.isArray(e.items)})){var d=l.getSize(),u=t.getPosition(l);c&&c.setStyles({right:Math.ceil(d.width-u.x)})}window.requestAnimationFrame(function(){var e=document.body.getElement(".main"),s=e&&e.getSize(),a=s&&s.height,r=l.getSize(),d=o&&o.height,u=t.getPosition(l),m=u&&u.y,h=c&&c.getSize().height;c.setStyles({right:Math.ceil(r.width-u.x)}),a<=h+m?c.setStyle("top",Math.ceil(d-h)-l.offsetTop):c.setStyle("top",Math.ceil(Math.min(d-h,m))),n.Engine.firefox||i.elements.container.setStyles({overflow:""})}),i.activeMenu._scroller===i._scroller||a?i._adaptMenuSize(i.activeMenu,{doSyncResize:!0}):a?n.Engine.firefox&&i.activeMenu._scroller.elements.content.setStyles({"padding-bottom":0,"padding-right":0,"overflow-x":"hidden"}):i._updateSmallMenuHeight()}return s},_adaptMenuSize:function(i,s){s||(s={});var o,a,r=this,l=i||this.activeMenu;function c(){var i,c,d=e.extendElement(o.wrapper),u=d.getElements(".topbar-menu-dd-item"),m=d.getSize(),h=m.width,p={height:Math.ceil(m.height+3)},f=l._scroller.elements.xScrollbar;u.forEach(function(e){var n=t.getSize.call(e).width;h=h>n?h:n}),n.Engine.firefox?(p.width=h-6,l._scroller.elements.content.setStyles({bottom:-25,right:-25,"padding-bottom":0,"padding-right":0,"overflow-x":"hidden"})):p.width=Math.ceil(h),a.setStyles(p),a.offsetWidth<=a.scrollWidth+2&&(f?f.hide():(i=a.offsetWidth,c=a.scrollWidth,Object.defineProperty(l._scroller.elements,"xScrollbar",{configurable:!0,get:function(){return f},set:function(e){(f=e)&&a.offsetWidth===i&&a.scrollWidth===c&&f.hide()}}))),s.updatePosition&&r.elements.container&&r.updatePosition()}l&&(o=l.elements,a=o.container,s.doSyncResize?c():window.requestAnimationFrame(c))},_updateSmallMenuHeight:function(){var e=this,t=e._getMenuFromItem(e.activeMenu.parentItem.id),n={root:e._mainMenu.elements.container.getSize().height,parent:t.elements.container.getSize().height,active:e.activeMenu.elements.wrapper.getSize().height},i=n.root>=n.active?"root":n.parent>=n.active?"parent":"active";e.activeMenu.elements.container.setStyles({height:n[i]}),setTimeout(function(){e.activeMenu._scroller.updateVisible()},200)},addMenu:function(e,t){var n,s=this._parent.apply(this,arguments),o=s.elements.container;return n=new i({element:o,scrollbarsMargin:0}),0===t&&(this._scroller=n),s._scroller=n,s.elements.container=n.elements.container,s},addItem:function(){var e=this._parent.apply(this,arguments);return this._adaptMenuSize(),e},removeItem:function(){var e=this._parent.apply(this,arguments);return this._adaptMenuSize(),e},onPreInject:function(){this._parent.apply(this,arguments),this._adaptMenuSize(this._getMenu(this.id),{updatePosition:!0})}})}),
/*!
  Script: MenuBarView.js

*/
define("DS/TopBar/views/MenuBarView",["UWA/Core","UWA/Class","UWA/Class/Timed","UWA/Element","UWA/Class/View","DS/TopBar/utils/Utils","DS/TopBar/views/MenuBarItemView"],function(e,t,n,i,s,o,a){"use strict";return s.extend({className:"topbar-menu",subViews:null,_initialsEl:null,setup:function(){this.subViews=[],this._onItemViewActivate=this._onItemViewActivate.bind(this)},render:function(){var i,s,o,r,l,c,d,u=this.subViews,m=this.collection,h=this.options.userName||"";if(!h)return this.container.hide(),this.container;for(new(t.extend(n,{})),r=e.createElement("div",{class:"topbar-user d-flex flex-row"}),l=e.createElement("div",{class:"d-flex flex-column full-width topbar-user-context-username-text"}),c=e.createElement("div",{class:"d-flex flex-column justify-end full-width topbar-user-context-arrow-wrapper"}),l.inject(r),this.userName=e.createElement("div",{class:"font-3dslight topbar-username",text:h.trim()}),this.userName.inject(l),this.container.addContent(r),d=e.createElement("div",{class:"topbar-user-context-wrapper hide"}),e.createElement("span",{class:"font-3dsregular topbar-user-context-text"}).inject(d),d.inject(l),e.createElement("span",{class:"fonticon fonticon-chevron-down topbar-user-context-arrow hide"}).inject(c),c.inject(r),i=0;i<m.length;i++)s=m.at(i),(o=new a({model:s,topFrameVue:this.options.topFrameVue})).render().inject(this.container),this._addSubViewListener(o),u.push(o);return this._handleRepositioning(),this.container},_setInitials:function(){var e=this.container.getElement(".profile"),t=this._initialsEl;e&&(t&&t.destroy(),this._initialsEl=o.renderInitials(this.options.userName,{className:"topbar-initials"}).inject(e))},updateUserName:function(e){this.userName.setText(e)},updateContextTitle:function(e){var t=o.find(this.subViews,function(e){return"profile"===e.model.id});t&&t.subView._updateContextTitle({name:e})},updateProfilePicture:function(e){var t,n,i=this.container.getElement(".profile");i&&((n=i.getElement(".profile-picture"))?n.setStyle("background-image",'url("'+e+'")'):(i.removeClassName("fonticon-user-alt"),i.addContent({tag:"div",class:"profile-picture",styles:{"background-image":'url("'+e+'")'}}),n=i.getElement(".profile-picture")),(t=this.subViews.filter(function(e){return"profile"===e.model.id})[0])&&(t.subView._target=n,t.subView.options.offset={x:-10,y:9},t.subView._isDirty=!0))},_addSubViewListener:function(e){this.listenTo(e,"onActivate",this._onItemViewActivate)},_onItemViewActivate:function(e){e?this.subViews.forEach(function(t){e!==t&&(t.model.get("onExecute")?e.model.get("onExecute")&&t.deactivate():t.deactivate())}):this.subViews.forEach(function(e){e.deactivate()})},_handleRepositioning:function(){var e=this,t=957;e.previousScreenWidth=document.body.getSize().width,i.addEvent.call(window,"resize",o.throttle(function(n){var i;e.currentScreenWidth=n.target.innerWidth,i=e.currentScreenWidth<=t&&e.previousScreenWidth>t,e.subViews.forEach(function(t){var n=t.subView;n&&n.isVisible()&&(i?n.hide():n._dropdownMenu.updatePosition()),e.previousScreenWidth=e.currentScreenWidth})},300))},toggleActivate:function(){},destroy:function(){this.stopListening(),this.subViews.forEach(function(e){e.destroy()}),this._parent(),this.container=null,this.subViews.length=0}})}),define("DS/TopBar/views/TopBarView",["text!DS/TopBar/assets/templates/TopBarView.html","DS/Handlebars/Handlebars4","UWA/Core","UWA/Utils","UWA/Element","UWA/Class/View","DS/TopBar/utils/Debuggable","DS/TopBar/utils/Utils","DS/TopBar/views/MenuBarView","DS/TopBar/views/MenuView","DS/TopBar/model/MainMenuBar","DS/TopBarProxy/Menu","DS/TopBar/views/ScrollableDropdownMenu","DS/UIKIT/Tooltip","DS/UIKIT/DropdownMenu","DS/UIKIT/Input/Text","i18n!DS/TopBar/assets/nls/TopBar"],function(e,t,n,i,s,o,a,r,l,c,d,u,m,h,p,f,g){"use strict";var v=959,b="active",C=".menu-context .dropdown-menu-wrap";function _(e,t,i){var s,o,a;if(!n.is(e,"object"))return e;for(s=0,o=(a=Object.keys(e)).length;s<o;s++)t.call(i,e[a[s]],a[s],e);return e}function I(e,t){_(e,function(e,t){this["$"+t]=this.getElement(e)},t)}function w(e,t){return e.slice().sort(function(e,n){var i=t(e).toLowerCase(),s=t(n).toLowerCase();return i<s?-1:i>s?1:0})}var x=p.extend({init:function(e){this._parent(e)},_onKeyDown:function(e){[13,27,37,38,39,40].includes(e.which)&&this._parent(e)}});return o.extend(a,{uwaClassName:"TopBarView",className:"topbar",id:"topbar",serviceName:"",domEvents:{"click .topbar-logo":"_on3DSLogoActivate","click .btn_tag_nav":"_onTaggerActivate","click .topbar-cmd.menu":"_onMenuActivate","click .topbar-cmd.search":"_onSearchActivate","click .topbar-cmd.extrabtn":"_onExtrabtnClick","click .topbar-cmd.addin-close":"_onCloseAddinModeClick","click .topbar-cmd.context, .topbar-user":"_debouncedOnContextClick"},template:t.compile(e),searchAnimationTemplate:t.compile("@media only screen and (min-width : {{smallBreakpoint}}px) and (max-width : {{mediumBreakpoint}}px) {#topbar.topbar .topbar-center { right: {{right}}px; }}"),tenants:null,contextMenu:{},contextVisibility:!1,setup:function(e){var t=this.model,n=t.get("userName");this.serviceName=e.serviceName||"";var i=r.debounce(this._updateUserContextText.bind(this),300);this._debouncedOnContextClick=this._onContextClick(),this.listenTo(t,{"onChange:userName":this._updateUserName,"onChange:brand":this._updateTitle,"onChange:application":this._updateTitle,"onChange:isShared":this._toggleSharedIcon,"onChange:picture":this._updateProfilePicture,"onChange:collabSpaceId":i,"onChange:credentialId":i,"onChange:tenantId":i,"onChange:serviceName":i,"onChange:disableUserContextDropdown":this._updateDisableUserContextDropdown,"onChange:readOnlyUserContext":this._updateReadOnlyUserContext}),this.debugMode=r.result(e,"debugMode"),this.currentScreenWidth=window.innerWidth,this.menuCollection=new u(d.filter(function(e){return"search"!==e.id})),this.children={rightMenuBar:new l({userName:n,collection:this.menuCollection,topFrameVue:this.options.topFrameVue}),menuView:null},this._handleRepositioning()},destroy:function(){_(this.children,function(e,t,n){e.destroy(),n[t]=null}),this.stopListening(this.model),this.stopListening(d),this._parent(),this.container=null},_updateUserName:function(e,t){this.children.rightMenuBar.updateUserName(t)},_updateProfilePicture:function(e,t){this.children.rightMenuBar.updateProfilePicture(t)},_updateTitle:function(){var e,t,n=this.model.get("application"),i=this.$appName;this.$brandName.setText(this.model.get("brand")),i.setText(n),i.setAttribute("title",n),this.addinCloseTooltip&&this.addinCloseTooltip.setBody((e=g.closeApp,t={appName:n},e.replace(/\{([\w\-]+)\}/g,function(e,n){return void 0!==t[n]?t[n]:""})))},_updateContextTitle:function(e){this.children.rightMenuBar.updateContextTitle({name:e})},_toggleSharedIcon:function(e,t){this.$appIcon.setStyle("display",t?"inline-block":"none")},_updateUserContextVisibility:function(e){var t=this.getElement(".topbar-user"),n=this.getElement(".topbar-user-context-wrapper"),i=this.getElement(".topbar-user-context-arrow"),s=this.getElement(".topbar-user-context-arrow-wrapper"),o=!this.model.get("disableUserContextDropdown"),a=this.getElement(".context.topbar-menu-item");this.contextVisibility=e,e?(t&&t.addClassName("topbar-user-context"),n&&n.removeClassName("hide"),i&&i.removeClassName("hide"),a&&a.removeClassName("hide"),s&&o&&s.removeClassName("hide")):(t&&t.removeClassName("topbar-user-context"),n&&n.addClassName("hide"),i&&i.addClassName("hide"),a&&a.addClassName("hide"),s&&s.addClassName("hide"))},_updateUserContextClickable:function(e,t){var n=this.getElement(".topbar-user-context-wrapper");n&&(t?n.addClassName("clickable"):n.removeClassName("clickable"))},_getComputedUserContext:function(e){var t=e&&e.tenant,n=e&&e.collabSpace,i="";return t&&(i+=t),t&&n&&(i+=" | "),n&&(i+=n),i},destroyContextDropdownMenus:function(){var e,t=this;n.is(t.contextMenu,"object")&&Object.keys(t.contextMenu).forEach(function(n){(e=t.contextMenu[n])&&(e.hide(),e.destroy()),t.contextMenu[n]=null})},_updateDisableUserContextDropdown:function(e,t){var n=this.getElement(".topbar-user-context-arrow-wrapper"),i=this.children,s=i&&i.menuView;n&&(t?(n.addClassName("hide"),this.destroyContextDropdownMenus()):n.removeClassName("hide"),s&&(s._dropdownMenu.hide(),s._buildDdMenu({addTenantPlaceholder:!t})))},_updateReadOnlyUserContext:function(e,t){var n=this.getElement(".topbar-user-context-text"),i=this.getElement(".topbar-user-context-arrow"),s=this.getElement(".topbar-user-context"),o=this.getElement(".topbar-menu-item.context");this._updateUserContextText(),t?(n&&n.addClassName("read-only"),i&&i.addClassName("read-only"),s&&s.addClassName("read-only"),o&&o.addClassName("read-only"),this.model.set("disableUserContextDropdown",!0)):(n&&n.removeClassName("read-only"),i&&i.removeClassName("read-only"),s&&s.removeClassName("read-only"),o&&o.removeClassName("read-only"),this.model.set("disableUserContextDropdown",!1))},_updateUserContextText:function(){var e=this,t=e.model,n=t.get("tenantId"),i=t.get("collabSpaceId"),s=t.get("serviceName"),o=t.get("readOnlyUserContext"),a=e.options.getAllTenants||r.getAllTenants,l=function(t){var n=e.$userContext,i=e._getComputedUserContext(t);i&&n.setText(i)},c=function(){e.userContextTooltip&&e.userContextTooltip.destroy(),e.userContextTooltip=null},d=function(t){var n=e.currentScreenWidth>=1356;l(t),u(),!function(t){var n,i=e.$userContextWrapper;return l(t),(n=i).offsetWidth<n.scrollWidth}(t)&&n?c():function(t){e.userContextTooltip&&c(),e.userContextTooltip=new h({className:"topbar-user-context-tooltip-container",position:"bottom",target:t.target}),e.userContextTooltip.setBody('<div class="topbar-user-context-tooltip '+(o?"read-only":"")+'"><span class="fonticon fonticon-cloud-alt"></span> <span>'+t.message+"</span></div>")}({message:e._getComputedUserContext(t),target:e.getUserContextElement()})},u=function(){e._updateUserContextVisibility(!0)};Promise.all([a({serviceName:s}),r.getTenant(n,a,{serviceName:s}),r.getCollabSpace({platformId:n,collabSpaceId:i})]).then(function(t){var n=e.tenants=t.shift(),i=t.shift(),s=t.shift();e.destroyContextDropdownMenus(),i&&n.length>1&&s?(d({tenant:i.displayName,collabSpace:s.title}),e._updateContextTitle(e._getComputedUserContext({tenant:i.displayName,collabSpace:s.title}))):i&&n.length>1?(d({tenant:i.displayName}),e._updateContextTitle(e._getComputedUserContext({tenant:i.displayName}))):s?d({collabSpace:s.title}):(e._updateUserContextVisibility(!1),c())})},_on3DSLogoActivate:function(){this.model.dispatchEvent("logo")},_onTaggerActivate:function(){this.model.dispatchEvent("tagger")},_onExtrabtnClick:function(){this.model.dispatchEvent("click-extrabtn")},_onCloseAddinModeClick:function(){this.model.dispatchEvent("click-close-addinmode")},_getBreakpoint:e=>e<=v?"small":e<=1356?"medium":"large",_getContextMenuOptions:function(e){var t,i,s,o,a,l,c,d=this,u=d.model,m=e&&e.tenantID||u.get("tenantId"),h=e&&e.collabSpaceId||u.get("collabSpaceId"),p=e&&e.collabSpaceId||u.get("credentialId"),f=u.get("serviceName"),g=u.get("disableUserContextDropdown"),v=e&&e.target,b=e&&e.flatTenants,C=d.options.getAllTenants||r.getAllTenants;return Promise.all([C({serviceName:f}),r.getAllCollabSpaces({platformId:m}),r.getTenant(m,C,{serviceName:f}),r.getCollabSpace({platformId:m,collabSpaceId:h}),r.getCredential({platformId:m,collabSpaceId:h,credentialId:p}),r.getAllCredentials({platformId:m,collabSpaceId:h})]).then(function(e){return t=e.shift(),i=e.shift(),s=e.shift(),o=e.shift(),a=e.shift(),l=e.shift(),b=b&&!(o&&i&&i.length),c={className:"context-dropdown-menu menu-context",target:v,items:[],events:{onShow:function(){v&&v.classList.add("active");var e=document.querySelector("#context");e&&(d.contextVisibility?e.removeClassName("hide"):e.addClassName("hide"))},onHide:function(){v&&v.classList.remove("active")},onClickOutside:function(){d.destroyContextDropdownMenus()},onClick:function(e,t){var i=t&&t.name,a=t&&t.text,l=i&&"tenant"===i,c=i&&"collabSpace"===i,g=i&&"credentials"===i,v=t&&t.id&&"context"===t.id;l?r.getTenants([s.platformId,a],C,{serviceName:f}).then(function(e){e.length&&u.dispatchEvent("tenant",{from:e.shift(),to:e.shift()})}):c?r.getCollabSpaces([{collabSpaceId:o.name,platformId:s.platformId},{collabSpaceId:a,platformId:s.platformId}]).then(function(e){e.length&&u.dispatchEvent("collabSpace",{from:e.shift(),to:e.shift()})}):g?r.getCredentials([{platformId:m,collabSpaceId:h,credentialId:p},{platformId:m,collabSpaceId:h,credentialId:{organization:t.attributes.organization,role:t.attributes.role}}]).then(function(e){e.length&&u.dispatchEvent("credentials",{from:e.shift(),to:e.shift()})}):v&&n.is(d.options.onUserContextClick,"function")&&d.options.onUserContextClick()}}},g||(s&&t&&t.length>1&&(t=w(t,function(e){return e.displayName}),b?t.map(function(e){return{name:"tenant",text:e.displayName,selected:e.platformId===s.platformId}}).forEach(function(e){c.items.push(e)}):c.items.push({text:s.displayName,fonticon:"cloud-alt",items:t.map(function(e){return{name:"tenant",text:e.displayName,selected:e.platformId===s.platformId}})})),o&&i&&i.length&&(i=w(i,function(e){return e.title}),c.items.push({text:o.title,fonticon:"drive",items:i.map(function(e){return{name:"collabSpace",text:e.title,selected:e.name===o.name}})}),a&&l&&l.length&&(l=w(l,function(e){return e.role.nls+" - "+e.organization.title}),c.items.push({text:a.role.nls+" - "+a.organization.title,fonticon:"user",items:l.map(function(e){return{name:"credentials",text:e.role.nls+" - "+e.organization.title,selected:e.role.name===a.role.name&&e.organization.name===a.organization.name,attributes:{organization:e.organization.name,role:e.role.name}}})})))),c})},_buildFilterPlatformAction:function(){var e=this,t=e.elements;t.searchMainCtn&&t.searchMainCtn.destroy(),t.searchMainCtn=n.createElement("li",{class:"search-main-container"}),t.searchAction=n.createElement("div",{class:"search-view-container",html:[{tag:"span",class:"search-view-action search-view-apply fonticon fonticon-2x fonticon-search pull-right",events:{click:function(){t.searchInput.focus()}}},{tag:"span",class:"search-view-action search-view-cancel fonticon fonticon-2x fonticon-cancel-squared pull-right",events:{click:function(){e.onClearPlatformFilter()}}}]}),t.searchInput=new f({placeholder:g.findPlatform,className:"search-platform",events:{onKeyDown:function(){setTimeout(function(){e.onSearchChange()})}}}).inject(t.searchAction,"top"),t.searchAction.inject(t.searchMainCtn,"top");var i=document.querySelector(C);i&&t.searchMainCtn.inject(i,"top")},onClearPlatformFilter:function(){var e=this.elements;e.searchInput.setValue(""),e.searchInput.focus(),this.onSearchChange()},onSearchChange:function(){return r.debounce(function(){var e=this.elements,t=e.searchInput.getValue().trim().toLowerCase(),n=document.querySelectorAll(C+' [name="tenant"]');e.searchAction.toggleClassName(b,!!t),n.forEach(function(e){t&&!e.innerText.trim().toLowerCase().includes(t)?e.hide():e.show()})},300)}(),_onContextClick:function(){var e=!1;return function(){var t=this,i=t._getBreakpoint(window.innerWidth),s="small"===i?m:x,o=i&&t.contextMenu[i];this.contextVisibility&&(t.model.get("disableUserContextDropdown")||e||(o?t.destroyContextDropdownMenus():(e=!0,t._getContextMenuOptions({flatTenants:!0,target:t.getUserContextElement()}).then(function(n){n.items.length&&(t.destroyContextDropdownMenus(),t.contextMenu[i]=new s(n),t.userContextTooltip&&t.userContextTooltip.hide(),t.contextMenu[i].show(),"3dspace"!==t.serviceName.toLowerCase()&&t._buildFilterPlatformAction()),e=!1}))),n.is(t.options.onUserContextClick,"function")&&t.options.onUserContextClick())}},_buildMenuView:function(e,t){var n=this,i=new c({model:t,target:e,offset:{x:0,y:-3},kb:!1,bound:!1,events:{onHide:this._onMenuActivate.bind(this,{force:"hide"}),onClick:function(e,t){n._getContextMenuOptions().then(function(i){i.events.onClick(e,t);var s=n._getBreakpoint(window.innerWidth);t.id.includes("context")&&"3dspace"!==n.serviceName.toLowerCase()&&"small"!==s&&n._buildFilterPlatformAction()})},onShow:function(e,t){n._getContextMenuOptions().then(function(n){return n.events.onShow(e,t),n}).then(function(e){e.className.includes("context")&&"3dspace"!==n.serviceName.toLowerCase()&&n._buildFilterPlatformAction()})}}});return i.rightMenuModel=this.rightMenuModel,i.show(),i},_onSearchActivate:function(){var e=this.$searchCmd,t=this.$menuCmdCenter,n=e.hasClassName("active"),i=n?"disable":"enable";this.container.toggleClassName("search-active"),n?e.removeClassName("active"):(e.addClassName("active"),t&&t.removeClassName("active")),this.model.dispatchEvent("mobileSearchAction",{action:i})},_onMenuActivate:function(e){e||(e={});var t=this,n=t.model,i=t.$searchCmd,s=t.$menuCmdCenter,o=t.children,a=n.get("tenantId"),l=n.get("serviceName"),c=n.get("collabSpaceId"),d=t.options.getAllTenants||r.getAllTenants;t.container.removeClassName("search-active"),i&&i.removeClassName("active"),t.container.getSize().width<=v&&(o.menuView||(o.menuView=t._buildMenuView(s,t.model)),s.hasClassName("active")||"hide"===e.force?(s.removeClassName("active"),o.menuView.hide()):(s.addClassName("active"),o.menuView._addContexts(t._getContextMenuOptions.bind(t)),o.menuView.show({refresh:!0}),Promise.all([d({serviceName:l}),r.getTenant(a,d,{serviceName:l}),r.getCollabSpace({platformId:a,collabSpaceId:c})]).then(function(e){var n=e.shift(),i=e.shift(),s=e.shift(),a=n.length>1&&i&&i.displayName,r=s&&s.title;o.menuView._updateContextTitle({name:t._getComputedUserContext({tenant:a,collabSpace:r})})}))),n.dispatchEvent("mobileSearchAction",{action:"disable"})},_handleRepositioning:function(){var e=this,t=n.extendElement(document.body).getSize().width;e.previousScreenWidth=t,e.previousBreakpoint=e._getBreakpoint(t),s.addEvent.call(window,"resize",r.throttle(function(t){var n;!function(t){var n,i=e.children,s=i&&i.menuView;e.currentScreenWidth=t.target.innerWidth,n=e.currentScreenWidth>=v&&e.previousScreenWidth<v,s&&s.isVisible()&&(n?s.hide():s._dropdownMenu.updatePosition(),e.previousScreenWidth=e.currentScreenWidth)}(t),(n=e._getBreakpoint(window.innerWidth))!==e.previousBreakpoint&&(e.destroyContextDropdownMenus(),e._updateUserContextText(),e.previousBreakpoint=n)},300))},_onIconClick:function(e){this.subViews.forEach(function(t){e!==t&&t.deactivate()})},render:function(){var e,t,i=this,s=i.model.toJSON(),o=s.picture||void 0;if(n.extendElement(document),n.extendElement(document.body),e=i.template(s),i.container.setContent(e),i.model.get("displayAccess")&&i.container.addClassName("display-access"),I({brandName:".topbar-app-brand",appName:".topbar-app-name",appIcon:".topbar-app-icon",appMenuIcon:".topbar-app-menu",appTitle:".topbar-app-title",menuCmdCenter:".topbar-center .topbar-cmd.menu",menuCmdRight:".topbar-right .topbar-cmd.menu",searchCmd:".topbar-cmd.search",left:".topbar-left",center:".topbar-center",right:".topbar-right",rightLinks:".topbar-access",extrabtnWrapper:".topbar-extrabtn",extrabtn:".topbar-cmd.extrabtn",addinbtn:".topbar-addinbtn",addinClose:".topbar-cmd.addin-close",tagNav:".topbar-cmd.tagnav"},i),i.children.rightMenuBar.render().inject(i.$right),o&&i.children.rightMenuBar.updateProfilePicture(o),I({user:".topbar-user",userContext:".topbar-user-context-text",userContextWrapper:".topbar-user-context-wrapper",contextIcon:".topbar-cmd.context"},i),i.model.get("displayAccess")&&(t=[{tag:"a",class:"topbar-access-link",text:g.login,events:{click:i.onAccessLinkClick.bind(i,"login")}}],"public"===i.model.get("logoutMode")&&t.push({tag:"a",class:"topbar-access-link",text:g.signup,events:{click:i.onAccessLinkClick.bind(i,"signup")}}),i.$rightLinks.addContent(t)),i.children.search)throw new Error("TopBarView unexpectedly rendered twice!");return i.options.activateSearch&&require([i.options.activateNewSearch?"DS/SNSearchUX/SearchView":"DS/TopBar/views/SearchView"],function(e){i.children.search=new e({model:i.model,searchMenu:d.get({id:"search"})}),i.children.search.render().inject(i.$center,"top"),new h({position:"bottom",target:i.$searchCmd,body:g.search})}),!1===i.options.showTaggerBtn?i.$tagNav.setStyle("display","none"):new h({position:"bottom",target:i.$tagNav,body:g.tagNav}),i.$menuCmdCenter&&new h({position:"bottom",target:i.$menuCmdCenter,body:g.mainMenu}),i.$menuCmdRight&&new h({position:"bottom",target:i.$menuCmdRight,body:g.mainMenu}),i.extrabtnTooltip=new h({position:"bottom",target:i.$extrabtn,body:""}),i.$addinbtn&&!i.options.lockedAppMode&&(i.addinCloseTooltip=new h({position:"bottom",target:i.$addinClose,body:g.close})),i},onAccessLinkClick:function(e){var t=this.model.get(e+"Url"),n=this.model.get(e+"Action");t&&("string"==typeof t||t instanceof String)?window.location=t:n&&"function"==typeof n&&n()},getTitleMenuElement:function(){return this.$appTitle},getTitleMenuIconElement:function(){return this.$appMenuIcon},getTitleName:function(){return this.model.get("application")},getUserContextWrapperElement:function(){return this.getElement(".topbar-user-context-wrapper")},getUserContextElement:function(){return this.currentScreenWidth>=1356?this.$user:this.$contextIcon},toggleExtraButton:function(){var e=this;e.$extrabtnWrapper.toggleClassName("topbar-extrabtn-hidden"),["center","right"].forEach(function(t){["topbar-with-extrabtn","topbar-without-extrabtn"].forEach(function(n){e["$"+t].toggleClassName(n)})})},setExtraButtonOptions:function(e){e.tooltip&&this.extrabtnTooltip.setBody(e.tooltip),e.fonticon&&this.$extrabtn.setAttribute("class","topbar-cmd extrabtn fonticon "+e.fonticon)},toggleAddinModeButton:function(){var e=this;e.$addinbtn.toggleClassName("topbar-addinbtn-hidden"),["center","right"].forEach(function(t){e["$"+t].toggleClassName("with-addinbtn")})},focusOnSearch:function(){var e=this.getElement(".topbar-search input"),t=this.$searchCmd,n=t.hasClassName("active");!t||t.isHidden()||n||this._onSearchActivate(),e&&!e.isHidden()&&e.click()}})}),define("DS/TopBar/TopBar",["UWA/Core","DS/TopBar/model/MainMenuBar","UWA/Class/Model","UWA/Class/Collection","DS/TopBar/views/TopBarView","DS/TopBar/assets/nls/TopBar_temp"],function(e,t,n,i,s,o){"use strict";var a=n.extend({set:function(t,n,i){if(this._parent.apply(this,arguments),e.is(n)&&"picture"===t){var s=this.get("submenu").get({id:"profile"});s&&s.set("icon",n)}}});return{init:function(n){var r,l,c,d,u=this,m=function(t){var n={};if(!t)return n;if(Array.isArray(t.topMenus)){var i=Object.create(null);t.topMenus.forEach(function(t){e.is(t,"string")&&(i[t]=!0)}),n.topMenus=i}return e.extend(t,n)}(n),h=m.tenantId;for(l in u.attributes=m,t.init(m),m.events&&(r=m.events,delete m.events),c=new i(t.filter(function(e){return["context","profile","home","share","add","help","content","notification","social"].indexOf(e.id)>=0})),u._model=d=new a(e.extend(m,{submenu:c,tenantId:""})),d.set("displayAccess",!m.userName),d.set("logoutMode",m.logoutMode),d.set("addinMode",m.addinMode),d.set("lockedAppMode",m.lockedAppMode),r)u.addEvent(l,r[l]);u.rightMenuModel={enable:!1,title:""},u.view=new s({model:u._model,activateNewSearch:m.activateNewSearch,activateSearch:m.activateSearch,showTaggerBtn:m.useTagger,addinMode:m.addinMode,lockedAppMode:m.lockedAppMode,onUserContextClick:m.onUserContextClick,getAllTenants:m.getAllTenants,topFrameVue:m.topFrameVue,serviceName:m.serviceName}),u.getTitleMenuElement=u.view.getTitleMenuElement.bind(u.view),u.getTitleMenuIconElement=u.view.getTitleMenuIconElement.bind(u.view),u.getTitleName=u.view.getTitleName.bind(u.view),u.toggleExtraButton=u.view.toggleExtraButton.bind(u.view),u.setExtraButtonOptions=u.view.setExtraButtonOptions.bind(u.view),u.toggleAddinModeButton=u.view.toggleAddinModeButton.bind(u.view),u.getUserContextWrapperElement=u.view.getUserContextWrapperElement.bind(u.view),o.init(m);var p=u.view.render();if(m.topFrameVue){var f=document.head.querySelector('link[rel=stylesheet][href*="TopBar.css"]');if(f&&f.remove(),e.is(m.topMenus,"object"))Object.keys(m.topMenus).forEach(function(t){e.is(m.topMenus[t],"function")&&u.addEvent(t,m.topMenus[t])})}else p.inject(document.body,"top");d.set("collabSpaceId",""),d.set("credentialId",""),d.set("tenantId",h),d.set("serviceName",m.serviceName),d.set("disableUserContextDropdown",!1),d.set("readOnlyUserContext",!1)},set:function(){this._model.set.apply(this._model,arguments)},addEvent:function(t,n,i){var s,o=this._model,a=this.attributes;if(a&&a.topFrameVue&&(e.is(t,"object")&&t.events&&a.topFrameVue.on(t.events),e.is(t,"string"))){var r={};r[t]=n,a.topFrameVue.on(r)}if(o)if(e.is(t,"object")&&t.events)for(s in t.events)o.addEvent(s,t.events[s],i);else e.is(t,"string")&&o.addEvent(t,n,i)},removeEvent:function(e,t,n){var i=this._model;i&&i.removeEvent(e,t,n)},setRightMenuContext:function(e){var t=this,n={setTitle:function(e){e&&t.set("collabSpaceId",e)},getTarget:null};return console.warn&&console.warn("TopBar.setRightMenuContext is deprecated. Use TopBar.set('collabSpaceId', setRightMenuContext) instead"),n.setTitle(e.title),n},MainMenuBar:t}}),define("TopBar",["TopBar/TopBar"],function(e){"use strict";return e}),define("TopBar/TopBar",["DS/TopBar/TopBar"],function(e){"use strict";return e});