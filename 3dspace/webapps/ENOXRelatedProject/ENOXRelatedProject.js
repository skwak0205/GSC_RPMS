define("DS/ENOXRelatedProject/RelatedProjectsService",["UWA/Core","DS/WAFData/WAFData","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/ENOXSearchUIController/ObjectOpenSearchUtil"],function(e,t,i,n){"use strict";return{init:async function(){this.TENANT=widget&&widget.getValue?widget.getValue("x3dPlatformId"):"onPremise";try{await this.getServiceURLs()}catch{throw new Error("Error getting service URLs")}},getServiceURLs:async function(){var e=this;return e.hasLicense=!1,new Promise((t,n)=>{i.getPlatformServices({onComplete:function(o){o.forEach(function(t){t.platformId===e.TENANT&&(e.PLAN_SERVICE_URL=t["3dplan"],e.SEARCH_SERVICE_URL=t["3DSearch"]+"/search")}),i.getGrantedRoles(function(i){for(let t=0;t<i.length;t++)if("XPP"===i[t].id){e.hasLicense=!0;break}t()},function(){n()})},onFailure:function(e){n(e)}})})},isLicenseGranted:function(){return this.hasLicense},getProjectContributingItem:function(e,i){var n=this.PLAN_SERVICE_URL+"/v1/resources/"+i.replace("<","").replace(">","")+"?$mask=dsplan:MVMask.WorkPackage.Property";return new Promise((e,i)=>{t.authenticatedRequest(n,{method:"GET",type:"json",headers:{"Content-Type":"application/json"},onComplete:function(t){e(t["dsxplan:hasWorkContext"])},onFailure:function(e,t){i(t)}})})},getRelatedPlansFrom3DPlan:function(e){let i=this.PLAN_SERVICE_URL;var n="dscom:"+e.serviceId+"_"+encodeURI(e.id),o=i+"/v1/classes/rdfs:Resource?$where="+encodeURIComponent("?s WHERE { ?s dsplan:hasWorkContext "+n+" }");return new Promise((e,i)=>{t.authenticatedRequest(o,{method:"GET",type:"json",headers:{"Content-Type":"application/json"},onComplete:function(t){let i=[];t&&t.member&&t.member.length>0&&t.member.forEach(function(e){i.push({id:e["@id"],title:e.title,thumbnail:" "!==e.image&&void 0!==e.image?e.image:require.toUrl("ENOXRelatedProject/assets/img/T_Default_Picture.png"),type:"dsplan:Project",serviceId:"3dplan"})}),e(i)},onFailure:function(e,t){i(t)}})})},associatePlans3DPlan:function(e,t){let i=[];var n=this.PLAN_SERVICE_URL+"/v0/invoke/dsxplan:createProxyModel?$mask=dsplan:MVMask.ComponentProxy.Complex",o=this.PLAN_SERVICE_URL+"/v0/invoke/dsxplan:modifyItemVersion?$mask=dsplan:MVMask.WorkPackage.Property",s="dscom:"+e.serviceId+"_"+encodeURI(e.id),a={"@id":s,"@href":"/resources/"+s,"@type":"dscom:ComponentProxy",title:e.title,image:e.image?e.image:"","dscom:ServiceHosting":e.serviceId,"dscom:Tenant":this.TENANT,type:e.type};return t.forEach(e=>{var t=e.id.replace("<","").replace(">","");i.push(this._associate3DPlanInternal(n,o,a,t))}),i},_associate3DPlanInternal:function(e,i,n,o){return new Promise((s,a)=>{t.authenticatedRequest(e,{method:"POST",data:JSON.stringify(n),type:"json",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},onComplete:function(){t.authenticatedRequest(i,{method:"POST",data:JSON.stringify([[{op:"add",path:"/dsxplan:hasWorkContext",value:n}],o]),type:"json",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},onComplete:function(e){let t=e.value;s([{id:t["@id"],title:t["dsxplan:label"],thumbnail:t["dsxplan:hasThumbnail"]?t["dsxplan:hasThumbnail"]:require.toUrl("ENOXRelatedProject/assets/img/T_Default_Picture.png"),type:"dsplan:Project",serviceId:"3dplan"}])},onFailure:function(e,t){a(t)}})},onFailure:function(e,t){a(t)}})})},dissociatePlans3DPlan:function(e,i){var n="dscom:"+e.serviceId+"_"+encodeURI(e.id);let o=[];return i.forEach(e=>{o.push(new Promise((i,o)=>{let s=e.options.title,a=e.options.id;a=a.replace("<","").replace(">","");var r=this.PLAN_SERVICE_URL+"/v0/invoke/dsxplan:modifyItemVersion?$mask=dsplan:MVMask.WorkPackage.Basic";t.authenticatedRequest(r,{method:"POST",data:JSON.stringify([[{op:"remove",path:"/dsxplan:hasWorkContext/{"+n+"}"}],a]),type:"json",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},onComplete:function(e){i(e.value["@id"])},onFailure:function(e,t){o(new Error({planTitle:s,error:e,wsResponse:t}))}})}))}),o},_furtiveSearchWithCriteriaAndCB:function(e){n.configureSearch(),n.launchSearch({criteria:e.criteria?e.criteria:"",allowedTypes:e.allowedTypes?e.allowedTypes:"",excludeList:e.excludeList?e.excludeList:"",multiSel:e.multiselect,defaultMode:!1,idcard_activated:!0,in_apps_callback:e.callback})},searchFullCriterias:function(e,t,i,n,o){if(0!==e.length){var s=[];100;for(var a=Math.ceil(e.length/100),r=0;r<a;r++)s[r]=e.slice(100*r,100*(r+1));this._searchFullCriterias(s,{infos:{nresults:0},results:[]},0,100,o,t,i)}else this._onSearchQueryResultFullCriterias({infos:{nresults:0}},t)},_searchFullCriterias:function(e,i,n,o,s,a,r){var l=this,c="",d="";e[n].forEach(function(e){c+=d,c+='"'+e.objectId+'"',d=" OR "});var h={query:c="[ds6w:resourceUid]:("+c+")",label:"my label",locale:void 0!==widget&&void 0!==widget.lang?widget.lang:"en",nresults:100,start:0,tenant:this.TENANT,with_synthesis:!0,source:["3dplan"],with_synthesis_attribute:!0,select_predicate:["ds6w:label","ds6w:type","ds6w:description","ds6w:identifier","ds6w:created","ds6wg:revision","ds6w:revision","LASTREVISION"]};t.authenticatedRequest(this.SEARCH_SERVICE_URL,{headers:{Accept:"application/json","Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},method:"POST",type:"json",proxy:"passport",data:JSON.stringify(h),onComplete:function(t){i.infos.nresults+=t.infos.nresults,i.results=i.results.concat(t.results),n===e.length-1?l._onSearchQueryResultFullCriterias(i,a):(n++,l._searchFullCriterias(e,i,n,o,s,a,r))},onFailure:r})},_onSearchQueryResultFullCriterias:function(e,t){var i=this,n=[];0!==e.infos.nresults?(e.results.forEach(function(e){var t={"@isArray":[]};e.attributes.forEach(function(e){"date"===e.type&&(e.value=i._convertToTagDate(e.value)),Array.isArray(e.value)?void 0===t[e.value[0]]?(t[e.value[0]]=e.value.slice(1)?e.value.slice(1).toString():"",t["@isArray"].push(e.value[0])):"ds6w:label"===e.name?t[e.value[0]]=t[e.value[0]].toString()+" "+(e.value.slice(1)?e.value.slice(1).toString():""):t[e.value[0]]=t[e.value[0]].toString()+";"+(e.value.slice(1)?e.value.slice(1).toString():""):void 0===t[e.name]?t[e.name]=e.value?e.value.toString():"":"ds6w:label"===e.name?t[e.name]=t[e.name].toString()+" "+(e.value?e.value.toString():""):t[e.name]=t[e.name].toString()+";"+(e.value?e.value.toString():"")}),t["@id"]=t.resourceid,t.physicalid=t.resourceid,n.push(t)}),t(n)):t(n)},_convertToTagDate:function(e){var t=new Date,i="";return e&&("string"==typeof e&&(e=(e=(e=e.replace(/\&#x2f;/g,"/")).replace(/\&#x3a;/g,":")).replace(/\u200E/g,"")),i=(t=new Date(e)).getFullYear()+"/"+(t.getMonth()+1)+"/"+t.getDate()),i}}}),define("DS/ENOXRelatedProject/RelatedProjectsWarning",["UWA/Class/View","DS/UIKIT/Mask","DS/UIKIT/SuperModal","DS/CoreEvents/ModelEvents","DS/Controls/Button","i18n!DS/ENOXRelatedProject/assets/nls/ENOXRelatedProject"],function(e,t,i,n,o,s){"use strict";var a=function(e,t){e&&(this._options=e,this._context=e.context?e.context:void 0,this._title=s.Warning.Title,this._content="<b>"+e.project["ds6w:label"]+"</b> "+s.Warning.Message,this._modelEvent=this._options.modelEvent,this._data=t)};return a.prototype.dialogCreation=function(){var e=this,t=new i({renderTo:document.body,className:"associate-warning",events:{onShow:function(){},onHide:function(){}}}),n=[{className:"primary",touchMode:!0,allowUnsafeHTMLLabel:!1,value:s.Warning.Associate,action:function(t){e._options.onAssociate(e._options.project),t.hide()}},{className:"default",touchMode:!0,allowUnsafeHTMLLabel:!1,value:s.Warning.Cancel,action:function(t){e._options.onCancel(),t.hide()}}];t.dialog({body:this._content,title:this._title,buttons:n})},a}),define("DS/ENOXRelatedProject/RelatedProjectsInfo",["UWA/Core","i18n!DS/ENOXRelatedProject/assets/nls/ENOXRelatedProject"],function(e,t){"use strict";var i=function(){this.PLAN_INFO_CONTAINER_CLICKED="enox-relprj-info-clicked",this.RELATED_PROJECTS_CHANGED="enox-relprj-related-prjs-changed"};return i.prototype.init=function(e){this.options=e,this.infoContainer={},this.buildDOM(),this.subscribeToEvents()},i.prototype.buildDOM=function(){this._attributeValueSection=e.createElement("section",{html:t.LOADING_RELATED_PLANS,id:"relatedprojectsValue",title:t.LOADING_RELATED_PLANS,styles:{display:"block","word-wrap":"break-word",width:"200px","white-space":"normal"}}),this._attributeValueSection.onclick=(()=>{this.options.modelEvents.publish({event:this.PLAN_INFO_CONTAINER_CLICKED})}),this.options.container.appendChild(this._attributeValueSection)},i.prototype.loadData=function(e){if(e){let i=e.getAllDescendants();i&&i.length>0?(this._attributeValueSection.innerHTML="",1===i.length?(this._attributeValueSection.innerText=i[0].options.title,this._attributeValueSection.setAttribute("title",i[0].options.title)):(this._attributeValueSection.innerText=i.length+" "+t.PLANS,this._attributeValueSection.setAttribute("title",i.length+" "+t.PLANS))):this._attributeValueSection.innerHTML=t.NO_PLAN_DEFINED}else this._attributeValueSection.innerHTML=t.ERROR_FETCHING_PLANS_INFO},i.prototype.subscribeToEvents=function(){var t=this;e.is(this.RelatedProjectChangedToken)||(this.RelatedProjectChangedToken=this.options.modelEvents.subscribe({event:this.RELATED_PROJECTS_CHANGED},function(e){t.loadData(e)}))},i.prototype.getInfoDOM=function(){return this.infoContainer},i.prototype.destroy=function(){e.is(this._attributeValueSection)&&(this._attributeValueSection.destroy(),this._attributeValueSection=null),this.options.modelEvents.unsubscribe(this.RelatedProjectChangedToken),this.RelatedProjectChangedToken=null},i}),define("DS/ENOXRelatedProject/RelatedProjectsManagerUI",["UWA/Core","DS/xPortfolioUXCommons/XModelListView/js/XModelListView","DS/xPortfolioUXCommons/XModelListView/js/XModelListViewDataExtension","i18n!DS/ENOXRelatedProject/assets/nls/ENOXRelatedProject","DS/Controls/Loader","DS/UIKIT/Mask","DS/Controls/ModalContainer","DS/ENOXDataDragAndDrop/js/ENOXDataDragAndDrop","DS/UIKIT/Input/Button","DS/ENOXRelatedProject/RelatedProjectsInfo"],function(e,t,i,n,o,s,a,r,l,c){"use strict";var d=function(e){this.RELATED_PROJECTS_CHANGED="enox-relprj-related-prjs-changed",this.SEARCH_EXISITING_PROJECTS_TO_ADD="enox-relprj-search-existing",this.DISSOCIATE_PROJECTS="enox-relprj-dissociate-prjs",this.options=e,this.init()};return d.prototype.init=async function(){this._selectedItems=[],this._container=this.options.container?this.options.container:e.createElement("div",{styles:{display:"flex","flex-direction":"column",height:"100%"}}),this._loader=(new o).inject(this._container),this._setupDroppableRegion(),this._loadView(),this._subscribeToEvents(),this.infoComponent=new c,this.infoComponent.init({modelEvents:this.options.modelEvents,container:this.options.infoSectionContainer})},d.prototype.inject=function(e){e.appendChild(this._container)},d.prototype._setupDroppableRegion=function(){new r({droppableAreas:[this._container],modelEvents:this.options.modelEvents})},d.prototype._subscribeToEvents=function(){let e=this;this.tokenaddselect=this.options.modelEvents.subscribe({event:"xmodel-list-item-on-add-selection"},e=>{this._selectedItems=e.items,this.options.modelEvents.publish({event:"enox-collection-toolbar-visibility-action",data:{id:"remove_tbBtn",flag:!0}})}),this.tokenremoveselect=this.options.modelEvents.subscribe({event:"xmodel-list-item-on-remove-selection"},e=>{this._selectedItems=e.items,0===this._selectedItems.length&&this.options.modelEvents.publish({event:"enox-collection-toolbar-visibility-action",data:{id:"remove_tbBtn",flag:!1}})}),this.tokenemptyselect=this.options.modelEvents.subscribe({event:"xmodel-list-item-on-empty-selection"},()=>{this._selectedItems=[],this.options.modelEvents.publish({event:"enox-collection-toolbar-visibility-action",data:{id:"remove_tbBtn",flag:!1}})}),this.tokenondrop=this.options.modelEvents.subscribe({event:"onDrop"},e=>{this.dropProjectOnView(e)}),this.tokenstartloading=this.options.modelEvents.subscribe({event:"enox-relprj-related-prjs-startloader"},function(){s.mask(e._container)}),this.tokenstoploading=this.options.modelEvents.subscribe({event:"enox-relprj-related-prjs-stoploader"},()=>{s.unmask(e._container)})},d.prototype._loadView=function(){let e=this,o={itemsName:n.PLANS,itemName:n.PLAN,withStableActions:!0,actions:[]};e._checkAccess()&&(o.actions=[{id:"add_tbBtn",text:n.ASSOCIATE_A_PLAN,fonticon:"plus",visibility:!1,handler:e=>{this.options.modelEvents.publish({event:this.SEARCH_EXISITING_PROJECTS_TO_ADD,data:e})}},{className:"divider"},{id:"remove_tbBtn",text:n.DISASSOCIATE_A_PLAN,fonticon:"remove",visibility:!0,handler:()=>{this.options.modelEvents.publish({event:this.DISSOCIATE_PROJECTS,data:this._selectedItems})}}]);let s={id:"relatedProjectsList",model:this.options.model,useDragAndDrop:!0,dropableAreas:this._container,modelEvents:this.options.modelEvents,viewOptions:{identifier:"relatedProjectsTile",views:this.options.views?this.options.views:["TileView","DataGridView"],currentView:"TileView",currentSort:void 0,itemViewMapping:{label:function(e){return e.options.title},subLabel:function(e){return e.options.subLabel?e.options.subLabel:""},thumbnail:function(e){return e.options.thumbnail?e.options.thumbnail:require.toUrl("ENOXRelatedProject/assets/img/T_Default_Picture.png")},icon:function(e){return e.options.icon?e.options.icon:""},description:function(e){return e.options.description?e.options.description:""},customTooltip:function(e){return e.options.customTooltip?e.options.customTooltip:""}},grid:{columns:[{text:n.TITLE,dataIndex:"title"},{text:n.DESCRIPTION,dataIndex:"description"},{text:n.RESPONSIBLE,dataIndex:"responsible"},{text:n.MATURITY,dataIndex:"status"},{text:n.MODIFICATION,dataIndex:"modified",typeRepresentation:"datetime"},{text:n.CREATION,dataIndex:"created",typeRepresentation:"datetime"}]},editable:!1,contextualActions:function(){return e._checkAccess()?e.options._contextualMenus[this.options.id]:[]}},emptyContentOptions:this._getDropInviteDOM(),toolbarOptions:o,extensions:[i]};this._xModelListView=new t(s),this._xModelListView.inject(this._container),this._xModelListView.attachResizeSensor(),this.options.modelEvents.publish({event:"xmodel-list-data-on-load-start"})},d.prototype.dropProjectOnView=function(e){if(e&&e.data&&"3DXContent"===e.data.protocol&&e.data.data&&Array.isArray(e.data.data.items)){let t=e.data.data.items;t=t.map(e=>({id:e.objectId,serviceId:e.serviceId,"ds6w:label":e.displayName,title:e.displayName,type:e.objectType,displayType:e.displayType})),this.options.modelEvents.publish({event:"enox-relprj-associate-prjs",data:t})}},d.prototype._getDropInviteDOM=function(){let e=new l({value:n.ASSOCIATE_A_PLAN,className:"primary"}),t=[];return{sentences:t=this._checkAccess()?[{type:"dom",DOMelement:e.getContent(),events:{onclick:e=>{this.options.modelEvents.publish({event:"enox-relprj-search-existing",data:e})}}},{type:"drop",text:n.DROP_PLAN_TO_ADD}]:[{type:"dom",text:n.FEATURE_UNAVAILABLE}]}},d.prototype._checkAccess=function(){return!this.options.enableLicenseCheck||this.options.enableLicenseCheck&&this.options.relatedProjectsService.isLicenseGranted()},d.prototype.destroy=function(){e.is(this._container)&&this._container.empty(),e.is(this._xModelListView)&&(this._xModelListView.destroy(),this._xModelListView=null),e.is(this.infoComponent)&&(this.infoComponent.destroy(),this.infoComponent=null),this.options.modelEvents.unsubscribe(this.tokenaddselect),this.options.modelEvents.unsubscribe(this.tokenemptyselect),this.options.modelEvents.unsubscribe(this.tokenondrop),this.options.modelEvents.unsubscribe(this.tokenstartloading),this.options.modelEvents.unsubscribe(this.tokenstoploading)},d}),define("DS/ENOXRelatedProject/RelatedProjectsManager",["UWA/Core","UWA/Class","DS/Tree/TreeDocument","DS/TreeModel/DataModelSet","DS/Tree/TreeNodeModel","DS/ENOXRelatedProject/RelatedProjectsManagerUI","DS/ENOXRelatedProject/RelatedProjectsService","DS/i3DXCompassPlatformServices/OpenWith","DS/CoreEvents/ModelEvents","DS/ENOXRelatedProject/RelatedProjectsWarning","i18n!DS/ENOXRelatedProject/assets/nls/ENOXRelatedProject"],function(e,t,i,n,o,s,a,r,l,c,d){"use strict";var h=widget.getValue("x3dPlatformId");return e.is(h)&&"OnPremise"!==h?t.extend({init:function(){this._parent(),this._RelatedProjectsChannel=new l,this._ProjectsMainContainer=e.createElement("div",{class:"projects-info",styles:{height:"100%"}}),this._ProjectsInfoSection=e.createElement("section",{id:"relatedprojectsinfocontainer"}),this._subscribeToEvents(),a.init()},set:async function(t){if(!e.is(this._object)||this._object.id!==t.id){e.is(this.ui)&&(this.ui.destroy(),this.ui=null);var o={container:this._ProjectsMainContainer,infoSectionContainer:this._ProjectsInfoSection,modelEvents:this._RelatedProjectsChannel};this._dataModelSet=new n,this._model=new i({dataModelSet:this._dataModelSet}),o.model=this._model,o.enableLicenseCheck=!!e.is(t.enableLicenseCheck)&&t.enableLicenseCheck,o.relatedProjectsService=a,this._object=t,o.views=this._object.views,this._contextualMenus={},o._contextualMenus=this._contextualMenus,await this._fetchData(o),this.ui=new s(o)}},getEventChannel:function(){return this._RelatedProjectsChannel},getMainContainer:function(){return this._ProjectsMainContainer},getInfoSection:function(){return this._ProjectsInfoSection},destroy:function(){this._parent(),e.is(this._RelatedProjectsChannel)&&(this._RelatedProjectsChannel.destroy(),this._RelatedProjectsChannel=null),e.is(this._ProjectsMainContainer)&&(this._ProjectsMainContainer.destroy(),this._ProjectsMainContainer=null),e.is(this._ProjectsInfoSection)&&(this._ProjectsInfoSection.destroy(),this._ProjectsInfoSection=null)},_fetchData:async function(){let e=[],t=[];e.push(a.getRelatedPlansFrom3DPlan(this._object)),Promise.all(e.map(e=>e.catch(()=>null))).then(async e=>{(e=e.flat()).forEach(e=>{e?t=t.concat(e):window.notifs.addNotif({level:"info",title:d.DSXPFL_Error,message:d.ERROR_FETCHING_PLANS_INFO})}),await this._setModel(t)})},_setModel:async function(t){this._model.prepareUpdate();for(let e=0;e<t.length;e++)t[e]&&t[e].id&&(t[e].id=t[e].id.replace("<","").replace(">","")),t[e].serviceId="3dplan";let i=await this._getContextualMenu(t);i&&Array.isArray(i)&&i.forEach(e=>{this._contextualMenus[e.id]=e.menu}),this._getInfoFromSearch(t).then(async i=>{for(let n=0;n<t.length;n++){let s=t[n],a=i.find(e=>-1!==e.resourceid.indexOf(s.id));s.grid=s;let r=o.createTreeNodeDataModel(this._dataModelSet,s),l=d.TITLE+": "+s.title;a?(l=l+"\n"+d.MATURITY+": "+a["ds6w:what/ds6w:status"],r.options.title=a["ds6w:label"],r.options.subLabel=a["ds6w:who/ds6w:responsible"]+" | "+a["ds6w:what/ds6w:status"],r.options.description=a["ds6w:description"],r.options.responsible=a["ds6w:who/ds6w:responsible"],r.options.created=a["ds6w:when/ds6w:created"],r.options.modified=a["ds6w:when/ds6w:modified"],r.options.status=a["ds6w:what/ds6w:status"],r.options.thumbnail=a.preview_url,r.options.icon=this._object.hasOwnProperty("governingPlanId")&&a["@id"].indexOf(this._object.governingPlanId)>0?"badge":"",r.options.grid=e.merge(r.options.grid,r.options)):(r.options.customTooltip=d.TITLE+": "+s.title,r.options.title=s.title,r.options.thumbnail=require.toUrl("ENOXRelatedProject/assets/img/T_Default_Picture.png"),r.options.icon=this._object.hasOwnProperty("governingPlanId")&&a["@id"].indexOf(this._object.governingPlanId)>0?"badge":""),r.options.customTooltip=l,this._model.addChild(r)}}).catch(async()=>{for(let i=0;i<t.length;i++){let n=t[i];n.grid=n;var e=o.createTreeNodeDataModel(this._dataModelSet,n);e.options.customTooltip=d.TITLE+": "+n.title,e.options.title=n.title,e.options.thumbnail=require.toUrl("ENOXRelatedProject/assets/img/T_Default_Picture.png"),e.options.icon=this._object.hasOwnProperty("governingPlanId")&&n.id===this._object.governingPlanId?"badge":"",this._model.addChild(e)}}).finally(()=>{this._model.pushUpdate(),this._RelatedProjectsChannel.publish({event:"xmodel-list-data-on-load-complete"}),this._RelatedProjectsChannel.publish({event:"enox-relprj-related-prjs-changed",data:this._model}),this._RelatedProjectsChannel.publish({event:"enox-relprj-related-prjs-stoploader"})})},_getContextualMenu:async function(e){var t=this;let i=[];return e.forEach(e=>{let n=new Promise(i=>{var n=[],o=e.id,s=e.type,a=e.serviceId;t._object.hasOwnProperty("governingPlanId")&&(t._object.governingPlanId!==o?n.push({id:"setAsGoverning_ctxMenuBtn",title:d.SET_AS_GOVERNING,text:d.SET_AS_GOVERNING,fonticon:"badge",handler:()=>{var t={id:o,title:e.title,type:s,serviceId:a};this._setAsGoverning(t)}}):n.push({id:"unSetAsGoverning_ctxMenuBtn",title:d.UNSET_AS_GOVERNING,text:d.UNSET_AS_GOVERNING,fonticon:"badge-delete",handler:()=>{var t={id:o,title:e.title,type:s,serviceId:a};this._unSetAsGoverning(t)}})),(new r).set3DXContent({protocol:"3DXContent",version:"1.0",source:widget.data.appId,widgetId:widget.id,data:{items:[{envId:widget.getValue("x3dPlatformId"),serviceId:a,contextId:"",objectId:o,objectType:s}]}}).retrieveCompatibleApps(e=>{if(e&&e.length>0){var t=[];e.forEach(function(e){let i={name:e.text,type:"PushItem",title:e.text,handler:function(){e.handler.call(this)}};e.fonticon?i.fonticon={content:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-"+e.fonticon}:i.fonticon=e.icon,t.push(i)}),n.push({id:"openWith_ctxMenuBtn",title:d.OPEN_WITH,text:d.OPEN_WITH,fonticon:"open-menu-dot",editable:"false",content:t})}n.push({id:"remove_ctxMenuBtn",title:d.REMOVE,text:d.REMOVE,fonticon:"remove",handler:()=>{let e=this._model.getAllDescendants().filter(e=>e.options.id===o);this._dissociateProjects(e)}}),i({id:o,menu:n})})});i.push(n)}),Promise.all(i)},_removeFromModel:function(e){this._model.prepareUpdate(),this._model.getAllDescendants().filter(function(t){return-1!==e.indexOf(t.options.id.replace("<","").replace(">",""))}).forEach(function(e){e.remove()}),this._model.pushUpdate(),this._RelatedProjectsChannel.publish({event:"xmodel-list-data-on-load-complete"}),this.infoComponent&&this.infoComponent.loadData(this._model)},_subscribeToEvents:function(){var t=this;e.is(this.AssociateProjectTK)||(this.AssociateProjectTK=this._RelatedProjectsChannel.subscribe({event:"enox-relprj-associate-prjs"},e=>{t._associateProjects(e)})),e.is(this.DissociateProjectTK)||(this.DissociateProjectTK=this._RelatedProjectsChannel.subscribe({event:"enox-relprj-dissociate-prjs"},e=>{t._dissociateProjects(e)})),e.is(this.SearchProjectTK)||(this.SearchProjectTK=this._RelatedProjectsChannel.subscribe({event:"enox-relprj-search-existing"},()=>{t._launchSearchForPlans()}))},_associatePlans3DPlan:function(t,i){return new Promise(n=>{let o=[];i.forEach(i=>{let n=i.id;o.push(new Promise(function(o,s){a.getProjectContributingItem(t,n).then(function(n){e.is(n)&&n["@id"]?new c({project:i,onAssociate:function(e){a.associatePlans3DPlan(t,[e])[0].then(()=>{o(e)},()=>{window.notifs.addNotif({level:"info",title:d.DSXPFL_Error,message:d.ERROR_ASSOCIATING_PLAN}),s(d.ERROR_ASSOCIATING_PLAN)})},onCancel:function(){s("Cancelled")}}).dialogCreation():a.associatePlans3DPlan(t,[i])[0].then(()=>{o(i)},e=>{e&&401===e["@code"]?window.notifs.addNotif({level:"error",title:d.ERROR_ASSOCIATING_PLAN,message:d.INSUFFICIENT_ACCESS_RIGHTS+i.title}):window.notifs.addNotif({level:"error",title:d.DSXPFL_Error,message:d.ERROR_ASSOCIATING_PLAN}),s(d.ERROR_ASSOCIATING_PLAN)})})}))}),Promise.all(o.map(e=>e.catch(()=>null))).then(e=>{n(e.filter(e=>null!==e))})})},_associateProjects:function(e){var t=this,i=this._model.getAllDescendants().map(e=>e.options.id);let n=[];e.forEach(e=>{let t=e.id;if(t=t.replace("<","").replace(">",""),"dsplan:Project"!==e.type&&"dsplan:xProject"!==e.type){let t=e.displayType?e.displayType:e.type,i=d.OBJECT_TYPE_NOT_SUPPORTED1+t+d.OBJECT_TYPE_NOT_SUPPORTED2;window.notifs.addNotif({level:"error",title:i,subtitle:d.SELECT_A_PLAN_TYPE1})}else if(-1!==i.indexOf(t)){let e=this._model.getAllDescendants().find(e=>t===e.options.id).options.title,i=d.PLAN+" '"+e+"' "+d.IS_ALREADY_ATTACHED;window.notifs.addNotif({level:"error",title:i,subtitle:d.OTHER_PLANS_WILL_BE_ADDED})}else n.push(e)}),n.length>0&&(this._RelatedProjectsChannel.publish({event:"enox-relprj-related-prjs-startloader",data:d.ASSOCIATING_A_PLAN}),this._associatePlans3DPlan(this._object,n).then(e=>{t._setModel(e)}))},_dissociateProjects:function(e){var t=this;let i=[],n=[];this._RelatedProjectsChannel.publish({event:"enox-relprj-related-prjs-startloader",data:d.DISASSOCIATING_A_PLAN}),e.forEach(e=>{n.push(e.options.id);var o={id:e.options.id,title:e.options.title,type:e.options.type,serviceId:e.options.serviceId};t._unSetAsGoverning(o),i.push(e)});let o=[];i.length>0&&(o=o.concat(a.dissociatePlans3DPlan(t._object,i))),Promise.all(o.map(e=>e.catch(e=>e&&e.wsResponse&&"401"===e.wsResponse["@code"]?{errorCode:401,planTitle:e.planTitle}:null))).then(t=>{t=(t=t.flat()).filter(e=>{if(e&&(!e.errorCode||401!==e.errorCode))return e;e&&e.errorCode&&401===e.errorCode?window.notifs.addNotif({level:"error",title:d.ERROR_DISASSOCIATING_PLAN,message:d.INSUFFICIENT_ACCESS_RIGHTS+e.planTitle}):window.notifs.addNotif({level:"error",title:d.DSXPFL_Error,message:d.ERROR_DISASSOCIATING_PLAN})}),this._removeFromModel(t),this._RelatedProjectsChannel.publish({event:"enox-relprj-related-prjs-stoploader"}),this._RelatedProjectsChannel.publish({event:"enox-relprj-dissociate-prjs-post",data:e}),this._RelatedProjectsChannel.publish({event:"enox-relprj-related-prjs-changed",data:this._model})}).catch(()=>{window.notifs.addNotif({level:"info",title:d.DSXPFL_Error,message:d.ERROR_DISASSOCIATING_PLAN}),this._RelatedProjectsChannel.publish({event:"enox-relprj-related-prjs-stoploader"})})},_getInfoFromSearch:async function(e){return new Promise((t,i)=>{0===e.length&&t();var n=[],o="";e.length>0&&(e.forEach(function(e){o="3dplan"===e.serviceId?`[ds6w:resourceUid]:"<${e.id}>"`:`[ds6w:resourceUid]:"${e.id}"`;var t={objectId:`<${e.id}>`,searchQuery:o};n.push(t)}),a.searchFullCriterias(n,function(e){t(e)},function(e){i(e)},e.length))})},_launchSearchForPlans:function(){var e=this;let t=this._model.getAllDescendants().map(e=>e.options.id);var i=[];i.push("dsplan:Project"),i.push("dsplan:xProject");var n="";t.forEach((e,t,i)=>{n+='[ds6w:resourceUid]:"<'+e+'>"',i.length-1!==t&&(n+=" OR ")}),a._furtiveSearchWithCriteriaAndCB({allowedTypes:i,excludeList:"NOT ("+n+")",multiselect:!0,callback:t=>{t.forEach(e=>{e.type=e["ds6w:type_value"]}),e._associateProjects(t)}})},_setAsGoverning:function(e){this._RelatedProjectsChannel.publish({event:"enox-relprj-related-prjs-setasgoverning",data:{projectData:e,itemVersionData:this._object}})},_unSetAsGoverning:function(e){this._RelatedProjectsChannel.publish({event:"enox-relprj-related-prjs-unsetasgoverning",data:{projectData:e,itemVersionData:this._object}})}}):null});