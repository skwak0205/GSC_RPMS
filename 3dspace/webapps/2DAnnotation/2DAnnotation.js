define("DS/2DAnnotation/interface/Command",["UWA/Class","DS/Logger/Logger","i18n!DS/2DAnnotation/assets/nls/2DAnnotation","css!DS/2DAnnotation/2DAnnotation.css"],function(e,t){"use strict";return e.extend({name:"DS/2DAnnotation/interface/Command",_logger:null,init:function(e){this._parent(e),this._logger=t.getLogger(this.name),this.imageEditor=e.imageEditor},start:function(e){throw new Error("should be implemented")},end:function(){throw new Error("should be implemented")}})}),define("DS/2DAnnotation/views/Workspace",["UWA/Class/View","UWA/Core","DS/Logger/Logger","DS/IssueServices/utils/Performance","i18n!DS/2DAnnotation/assets/nls/2DAnnotation","css!DS/2DAnnotation/2DAnnotation.css"],function(e,t,o,a){"use strict";return e.extend({name:"DS/2DAnnotation/Workspace",tagName:"div",className:"annotation-workspace-container",_logger:null,setup:function(e){a.start(this.name+" setup"),this._parent(e),this._logger=o.getLogger(this.name),a.end(this.name+" setup")},render:function(){return a.start(this.name+" render"),a.end(this.name+" render"),this},destroy:function(){this.container.empty()}})}),define("DS/2DAnnotation/components/ColorPicker",["UWA/Core","DS/Controls/ColorPicker"],function(e,t){"use strict";var o={COLORS:{PRESELECTION:["#000000","#FEE000","#FF8A2E","#CC092F","#009DDB","#8DDEE4","#6FBC48","#FFFFFF"]}};return t.extend({buildView:function(){this._parent();var t=this;this.popupBody=e.createElement("div",{class:"annotation-colorpicker"});var a=e.createElement("div",{class:"annotation-colorpicker-selection"}).inject(this.popupBody);o.COLORS.PRESELECTION.forEach(function(o){var i=e.createElement("div",{class:"annotation-colorpicker-selection-button wux-controls-colorpicker-button"});i.setStyle("background",o),i.addEventListener("click",function(){t.value=o,t.currentValue=o}),i.inject(a)}),this.elements._colorChooser&&this.elements._colorChooser.inject(this.popupBody),this.currentValue=this.value,this.initialValue=void 0},handleEvents:function(){this._parent(),this.addEventListener("show",this._onShow.bind(this))},_onShow:function(e){this.getPopup()&&this.getPopup().setBody(this.popupBody)}})}),define("DS/2DAnnotation/commands/Highlight",["DS/Logger/Logger","DS/FabricJS/FabricJS","DS/2DAnnotation/interface/Command","i18n!DS/2DAnnotation/assets/nls/2DAnnotation","css!DS/2DAnnotation/2DAnnotation.css"],function(e,t,o){"use strict";var a=window.fabric;return o.extend({name:"DS/2DAnnotation/commands/Highlight",init:function(e){this._parent(e),this._handlers={mousedown:this._onMouseDown.bind(this),mouseup:this._onMouseUp.bind(this),mousemove:this._onMouseMove.bind(this)}},start:function(e){var t=this.imageEditor.canvas;t.defaultCursor="crosshair",this._color=new a.Color(e.color||"#000000").toRgba(),this._opacity=e.opacity||.5,t.on({"mouse:down":this._handlers.mousedown})},end:function(){var e=this.imageEditor.canvas;e.defaultCursor="default",e.off({"mouse:down":this._handlers.mousedown})},setColor:function(e){this._color=new a.Color(e).toRgba()},setOpacity:function(e){this._opacity=e},_onMouseDown:function(e){var t=this.imageEditor.canvas;t.getActiveObject()||t.getActiveGroup()||(this._startPoint=t.getPointer(e.e),this._shapeObj=null,t.selection=!1,t.uniScaleTransform=!0,t.on({"mouse:move":this._handlers.mousemove,"mouse:up":this._handlers.mouseup}))},_onMouseUp:function(){var e=this.imageEditor.canvas;e.selection=!0,e.uniScaleTransform=!1,e.off({"mouse:move":this._handlers.mousemove,"mouse:up":this._handlers.mouseup});var t=e.getActiveObject();null!=t&&(t.setCoords(),t.selectable=!0,e.calcOffset(),e.selection=!0,e.uniScaleTransform=!1,e.renderAll())},_onMouseMove:function(e){var t=this.imageEditor.canvas,o=t.getPointer(e.e),i=this._startPoint.x,n=this._startPoint.y,r=Math.min(i,o.x),l=Math.min(n,o.y),s=Math.abs(i-o.x),c=Math.abs(n-o.y),d=this._shapeObj;d?d.set("width",s).set("height",c).set("top",l).set("left",r):((d=new a.Rect({top:i,left:n,width:s,height:c,fill:this._color,color:this._color,cornerSize:20,transparentCorners:!0})).set({opacity:this._opacity}),d.annotationType="highlight",t.add(d),t.setActiveObject(d),this._shapeObj=d),t.renderAll()}})}),define("DS/2DAnnotation/commands/CreateText",["DS/Logger/Logger","DS/FabricJS/FabricJS","DS/2DAnnotation/interface/Command","i18n!DS/2DAnnotation/assets/nls/2DAnnotation","css!DS/2DAnnotation/2DAnnotation.css"],function(e,t,o,a){"use strict";var i=window.fabric,n={WIDTH:200,HEIGHT:30};return o.extend({name:"DS/2DAnnotation/commands/CreateText",init:function(e){this._parent(e),this._handlers={mousedown:this._onMouseDown.bind(this),mouseup:this._onMouseUp.bind(this),mousemove:this._onMouseMove.bind(this)}},start:function(e){var t=this.imageEditor.canvas;t.defaultCursor="crosshair",this._fontSize=e.fontSize||10,this._fillColor=new i.Color(e.fillColor||"#000000").toRgba(),this._strokeColor=new i.Color(e.strokeColor||"#000000").toRgba(),this._backgroundColor=new i.Color(e.backgroundColor||"#ffffff").toRgba(),this._text=e.text||null,this._centered=e.centered||!1,t.on({"mouse:down":this._handlers.mousedown})},end:function(){var e=this.imageEditor.canvas;e.defaultCursor="default",e.off({"mouse:down":this._handlers.mousedown})},setFontSize:function(e){this._fontSize=e},setFillColor:function(e){this._fillColor=new i.Color(e).toRgba()},setStrokeColor:function(e){this._strokeColor=new i.Color(e).toRgba()},setBackgroundColor:function(e){this._backgroundColor=new i.Color(e).toRgba()},_onMouseDown:function(e){var t=this.imageEditor.canvas;t.getActiveObject()||t.getActiveGroup()||(this._startPoint=t.getPointer(e.e),this._shapeObj=null,t.selection=!1,t.uniScaleTransform=!0,t.on({"mouse:move":this._handlers.mousemove,"mouse:up":this._handlers.mouseup}))},_onMouseUp:function(){var e=this.imageEditor.canvas;e.selection=!0,e.uniScaleTransform=!1,e.off({"mouse:move":this._handlers.mousemove,"mouse:up":this._handlers.mouseup}),null!==this._shapeObj&&void 0!==this._shapeObj||this._createTextShape(this._startPoint.x,this._startPoint.y,this._startPoint.x+n.WIDTH,this._startPoint.y+n.HEIGHT);var t=e.getActiveObject();t.setCoords(),t.selectable=!0,t.enterEditing(),t.selectAll(),e.calcOffset(),e.selection=!0,e.uniScaleTransform=!1,e.renderAll()},_onMouseMove:function(e){var t=this.imageEditor.canvas,o=t.getPointer(e.e),a=this._startPoint.x,i=this._startPoint.y;this._createTextShape(a,i,o.x,o.y),t.renderAll()},_createTextShape:function(e,t,o,n){var r=this.imageEditor.canvas,l=Math.min(e,o),s=Math.min(t,n),c=Math.abs(e-o),d=Math.abs(t-n),h=this._shapeObj,u=a.tools.createText.emptyText;null!==this._text&&(u=this._text),h?h.set("width",c).set("height",d).set("top",s).set("left",l):((h=new i.IText(u,{top:s,left:l,width:c,height:d,fill:this._fillColor,stroke:this._strokeColor,backgroundColor:this._backgroundColor,fontSize:this._fontSize,cornerSize:20,transparentCorners:!0})).set({opacity:this._opacity}),h.annotationType="createText",r.add(h),!1!==this._centered&&(h.top=(this.imageEditor.elements.container.height-h.height)/2,h.left=(this.imageEditor.elements.container.width-h.width)/2),r.setActiveObject(h),this._shapeObj=h)}})}),define("DS/2DAnnotation/commands/CreateLine",["DS/Logger/Logger","DS/FabricJS/FabricJS","DS/2DAnnotation/interface/Command","i18n!DS/2DAnnotation/assets/nls/2DAnnotation","css!DS/2DAnnotation/2DAnnotation.css"],function(e,t,o){"use strict";var a=window.fabric;return o.extend({name:"DS/2DAnnotation/commands/CreateLine",init:function(e){this._parent(e),this._handlers={mousedown:this._onMouseDown.bind(this),mouseup:this._onMouseUp.bind(this),mousemove:this._onMouseMove.bind(this)}},start:function(e){var t=this.imageEditor.canvas;t.defaultCursor="crosshair",this._dashLine=e.dashLine||!1,this._strokeWidth=e.strokeWidth||2,this._fillColor=new a.Color(e.fillColor||"#000000").toRgba(),this._strokeColor=new a.Color(e.strokeColor||"#000000").toRgba(),t.on({"mouse:down":this._handlers.mousedown})},end:function(){var e=this.imageEditor.canvas;e.defaultCursor="default",e.off({"mouse:down":this._handlers.mousedown})},setDashLine:function(e){this._dashLine=e},setStrokeWidth:function(e){this._strokeWidth=e},setStrokeColor:function(e){this._strokeColor=new a.Color(e).toRgba()},setOpacity:function(e){this._opacity=e},_onMouseDown:function(e){var t=this.imageEditor.canvas;t.getActiveObject()||t.getActiveGroup()||(this._startPoint=t.getPointer(e.e),this._shapeObj=null,t.selection=!1,t.uniScaleTransform=!0,t.on({"mouse:move":this._handlers.mousemove,"mouse:up":this._handlers.mouseup}))},_onMouseUp:function(){var e=this.imageEditor.canvas;e.selection=!0,e.uniScaleTransform=!1,e.off({"mouse:move":this._handlers.mousemove,"mouse:up":this._handlers.mouseup});var t=e.getActiveObject();null!=t&&(t.setCoords(),t.selectable=!0,e.calcOffset(),e.selection=!0,e.uniScaleTransform=!1,e.renderAll())},_onMouseMove:function(e){var t=this.imageEditor.canvas,o=t.getPointer(e.e),i=[this._startPoint.x,this._startPoint.y,o.x,o.y],n=this._shapeObj;n?n.set({x2:o.x,y2:o.y}):((n=new a.Line(i,{stroke:this._strokeColor,strokeWidth:this._strokeWidth,strokeDashArray:!0===this._dashLine?[5,5]:null,originX:"center",originY:"center",cornerSize:20,transparentCorners:!0})).annotationType="createLine",t.add(n),t.setActiveObject(n),this._shapeObj=n),t.renderAll()}})}),define("DS/2DAnnotation/commands/CreateArrow",["DS/Logger/Logger","DS/FabricJS/FabricJS","DS/2DAnnotation/interface/Command","i18n!DS/2DAnnotation/assets/nls/2DAnnotation","css!DS/2DAnnotation/2DAnnotation.css"],function(e,t,o){"use strict";var a=window.fabric;return o.extend({name:"DS/2DAnnotation/commands/CreateArrow",init:function(e){this._parent(e),this._handlers={mousedown:this._onMouseDown.bind(this),mouseup:this._onMouseUp.bind(this),mousemove:this._onMouseMove.bind(this)}},start:function(e){var t=this.imageEditor.canvas;t.defaultCursor="crosshair",this._size=e.size||18,this._fillColor=new a.Color(e.fillColor||"#000000").toRgba(),this._strokeColor=new a.Color(e.strokeColor||"#000000").toRgba(),t.on({"mouse:down":this._handlers.mousedown})},end:function(){var e=this.imageEditor.canvas;e.defaultCursor="default",e.off({"mouse:down":this._handlers.mousedown})},setSize:function(e){this._size=e},setFillColor:function(e){this._fillColor=new a.Color(e).toRgba()},setStrokeColor:function(e){this._strokeColor=new a.Color(e).toRgba()},_onMouseDown:function(e){var t=this.imageEditor.canvas;t.getActiveObject()||t.getActiveGroup()||(this._startPoint=t.getPointer(e.e),this._shapeObj=null,t.selection=!1,t.uniScaleTransform=!0,t.on({"mouse:move":this._handlers.mousemove,"mouse:up":this._handlers.mouseup}))},_onMouseUp:function(){var e=this.imageEditor.canvas;e.selection=!0,e.uniScaleTransform=!1,e.off({"mouse:move":this._handlers.mousemove,"mouse:up":this._handlers.mouseup});var t=e.getActiveObject();null!=t&&(t.setCoords(),t.selectable=!0,e.calcOffset(),e.selection=!0,e.uniScaleTransform=!1,e.renderAll())},_onMouseMove:function(e){var t=this.imageEditor.canvas.getPointer(e.e),o=this._shapeObj;this._shapeObj=this.updateShape(o,this._startPoint,t)},updateShape:function(e,t,o){var i=this,n=i.imageEditor.canvas,r=i._size,l=t&&t.x?t.x:e.points[0].x,s=t&&t.y?t.y:e.points[0].y,c=o&&o.x?o.x:e.points[4].x,d=o&&o.y?o.y:e.points[4].y,h=Math.atan2(d-s,c-l),u=c-r*Math.cos(h),v=d-r*Math.sin(h);null!=e&&n.remove(e);var g=[{x:l,y:s},{x:l-r/4*Math.cos(h-Math.PI/2),y:s-r/4*Math.sin(h-Math.PI/2)},{x:u-r/4*Math.cos(h-Math.PI/2),y:v-r/4*Math.sin(h-Math.PI/2)},{x:u-r*Math.cos(h-Math.PI/2)+10*Math.sin(h-Math.PI/2),y:v-r*Math.sin(h-Math.PI/2)-10*Math.cos(h-Math.PI/2)},{x:u+r*Math.cos(h),y:v+r*Math.sin(h)},{x:u-r*Math.cos(h+Math.PI/2)+10*Math.sin(h-Math.PI/2),y:v-r*Math.sin(h+Math.PI/2)-10*Math.cos(h-Math.PI/2)},{x:u-r/4*Math.cos(h+Math.PI/2),y:v-r/4*Math.sin(h+Math.PI/2)},{x:l-r/4*Math.cos(h+Math.PI/2),y:s-r/4*Math.sin(h+Math.PI/2)},{x:l,y:s}],m=new a.Polyline(g,{fill:i._fillColor,stroke:i._strokeColor,opacity:1,strokeWidth:1,originX:"left",originY:"top",selectable:!0,lockScalingFlip:!0,cornerSize:20,transparentCorners:!0});return m.annotationType="createArrow",m.arrowSize=r,m.setControlsVisibility({bl:!1,br:!0,tl:!0,tr:!1,mt:!1,mb:!1,ml:!1,mr:!1}),n.add(m),n.setActiveObject(m),m.on("modified",function(){var e=this.calcTransformMatrix();m.points=this.get("points").map(function(e){return new a.Point(e.x-m.minX-m.width/2,e.y-m.minY-m.height/2)}).map(function(t){return a.util.transformPoint(t,e)}),i.updateShape(m)}),m}})}),define("DS/2DAnnotation/commands/CreateRectangle",["DS/Logger/Logger","DS/FabricJS/FabricJS","DS/2DAnnotation/interface/Command","i18n!DS/2DAnnotation/assets/nls/2DAnnotation","css!DS/2DAnnotation/2DAnnotation.css"],function(e,t,o){"use strict";var a=window.fabric;return o.extend({name:"DS/2DAnnotation/commands/CreateRectangle",init:function(e){this._parent(e),this._handlers={mousedown:this._onMouseDown.bind(this),mouseup:this._onMouseUp.bind(this),mousemove:this._onMouseMove.bind(this)}},start:function(e){var t=this.imageEditor.canvas;t.defaultCursor="crosshair",this._strokeWidth=e.strokeWidth||2,this._fillColor=new a.Color(e.fillColor||"#000000").toRgba(),this._strokeColor=new a.Color(e.strokeColor||"#000000").toRgba(),t.on({"mouse:down":this._handlers.mousedown})},end:function(){var e=this.imageEditor.canvas;e.defaultCursor="default",e.off({"mouse:down":this._handlers.mousedown})},setStrokeWidth:function(e){this._strokeWidth=e},setFillColor:function(e){this._fillColor=new a.Color(e).toRgba()},setStrokeColor:function(e){this._strokeColor=new a.Color(e).toRgba()},setOpacity:function(e){this._opacity=e},_onMouseDown:function(e){var t=this.imageEditor.canvas;t.getActiveObject()||t.getActiveGroup()||(this._startPoint=t.getPointer(e.e),this._shapeObj=null,t.selection=!1,t.uniScaleTransform=!0,t.on({"mouse:move":this._handlers.mousemove,"mouse:up":this._handlers.mouseup}))},_onMouseUp:function(){var e=this.imageEditor.canvas;e.selection=!0,e.uniScaleTransform=!1,e.off({"mouse:move":this._handlers.mousemove,"mouse:up":this._handlers.mouseup});var t=e.getActiveObject();null!=t&&(t.setCoords(),t.selectable=!0,e.calcOffset(),e.selection=!0,e.uniScaleTransform=!1,e.renderAll())},_onMouseMove:function(e){var t=this.imageEditor.canvas,o=t.getPointer(e.e),i=this._startPoint.x,n=this._startPoint.y,r=Math.min(i,o.x),l=Math.min(n,o.y),s=Math.abs(i-o.x),c=Math.abs(n-o.y),d=this._shapeObj;d?d.set("width",s).set("height",c).set("top",l).set("left",r):((d=new a.Rect({top:i,left:n,width:s,height:c,fill:this._fillColor,stroke:this._strokeColor,strokeWidth:this._strokeWidth,cornerSize:20,transparentCorners:!0})).annotationType="createRectangle",t.add(d),t.setActiveObject(d),this._shapeObj=d),t.renderAll()}})}),define("DS/2DAnnotation/commands/CreateCircle",["DS/Logger/Logger","DS/FabricJS/FabricJS","DS/2DAnnotation/interface/Command","i18n!DS/2DAnnotation/assets/nls/2DAnnotation","css!DS/2DAnnotation/2DAnnotation.css"],function(e,t,o){"use strict";var a=window.fabric;return o.extend({name:"DS/2DAnnotation/commands/CreateCircle",init:function(e){this._parent(e),this._handlers={mousedown:this._onMouseDown.bind(this),mouseup:this._onMouseUp.bind(this),mousemove:this._onMouseMove.bind(this)}},start:function(e){var t=this.imageEditor.canvas;t.defaultCursor="crosshair",this._strokeWidth=e.strokeWidth||2,this._fillColor=new a.Color(e.fillColor||"#000000").toRgba(),this._strokeColor=new a.Color(e.strokeColor||"#000000").toRgba(),t.on({"mouse:down":this._handlers.mousedown})},end:function(){var e=this.imageEditor.canvas;e.defaultCursor="default",e.off({"mouse:down":this._handlers.mousedown})},setStrokeWidth:function(e){this._strokeWidth=e},setFillColor:function(e){this._fillColor=new a.Color(e).toRgba()},setStrokeColor:function(e){this._strokeColor=new a.Color(e).toRgba()},_onMouseDown:function(e){var t=this.imageEditor.canvas;t.getActiveObject()||t.getActiveGroup()||(this._startPoint=t.getPointer(e.e),this._shapeObj=null,t.selection=!1,t.uniScaleTransform=!0,t.on({"mouse:move":this._handlers.mousemove,"mouse:up":this._handlers.mouseup}))},_onMouseUp:function(){var e=this.imageEditor.canvas;e.selection=!0,e.uniScaleTransform=!1,e.off({"mouse:move":this._handlers.mousemove,"mouse:up":this._handlers.mouseup});var t=e.getActiveObject();null!=t&&(t.setCoords(),t.selectable=!0,e.calcOffset(),e.selection=!0,e.uniScaleTransform=!1,e.renderAll())},_onMouseMove:function(e){var t=this.imageEditor.canvas.getPointer(e.e),o=this._shapeObj;this._shapeObj=this.updateShape(o,this._startPoint,t)},updateShape:function(e,t,o){var i=this.imageEditor.canvas,n=t&&t.x?t.x:e.initialCoords.start.x,r=t&&t.y?t.y:e.initialCoords.start.y,l=o&&o.x?o.x:e.initialCoords.end.x,s=o&&o.y?o.y:e.initialCoords.end.y,c=Math.min(n,l),d=Math.min(r,s),h=0;null!=e&&(null!==e.angle&&void 0!==e.angle&&(h=e.angle),i.remove(e));var u=new a.Ellipse({angle:h,left:c,top:d,stroke:this._strokeColor,strokeWidth:this._strokeWidth,fill:this._fillColor,rx:Math.abs(n-l)/2,ry:Math.abs(r-s)/2,cornerSize:20,transparentCorners:!0});return u.annotationType="createCircle",i.add(u),i.setActiveObject(u),this._shapeObj=u,u.initialCoords={start:{x:n,y:r},end:{x:l,y:s}},u.on("modified",function(){this.initialCoords={start:{x:this.aCoords.tl.x,y:this.aCoords.tl.y},end:{x:this.aCoords.br.x,y:this.aCoords.br.y}}}),u}})}),define("DS/2DAnnotation/commands/FreeDrawing",["DS/Logger/Logger","DS/FabricJS/FabricJS","DS/2DAnnotation/interface/Command","i18n!DS/2DAnnotation/assets/nls/2DAnnotation","css!DS/2DAnnotation/2DAnnotation.css"],function(e,t,o){"use strict";var a=window.fabric;return o.extend({name:"DS/2DAnnotation/commands/FreeDrawing",init:function(e){this._parent(e),this._onPathCreated=this._handlers.onPathCreated.bind(this)},start:function(e){var t=this.imageEditor.canvas;t.isDrawingMode=!0,this.setBrush(e),t.on("path:created",this._onPathCreated)},end:function(){var e=this.imageEditor.canvas;e.isDrawingMode=!1,e.off("path:created",this._onPathCreated)},setBrush:function(e){var t=this.imageEditor.canvas.freeDrawingBrush;if(e.width&&(t.width=e.width),e.color){var o=new a.Color(e.color);t.color=o.toRgba()}},_handlers:{onPathCreated:function(e){e.path.annotationType="freedrawing"}}})}),define("DS/2DAnnotation/views/Toolbar",["UWA/Class/Promise","UWA/Controls/Abstract","UWA/Core","DS/Controls/Button","DS/Controls/Popup","DS/Controls/Slider","DS/Controls/SpinBox","DS/Controls/Toggle","DS/Logger/Logger","DS/Windows/Dialog","DS/Windows/Panel","DS/2DAnnotation/components/ColorPicker","DS/IssueServices/utils/Performance","i18n!DS/2DAnnotation/assets/nls/2DAnnotation","css!DS/2DAnnotation/2DAnnotation.css"],function(e,t,o,a,i,n,r,l,s,c,d,h,u,v){"use strict";var g={PREFERENCES:{TOOL_PREFERENCES:{KEY:"2DAnnotation.Toolbar.ToolPreferences",DEFAULT_VALUES:{freedrawing:{weight:5,colorOpacity:1,color:"CC092F"},highlight:{color:"ffff00",opacity:.3},createText:{weight:40,colorOpacity:1,color:"CC092F",strokeColorOpacity:0,strokeColor:"000000",backgroundColorOpacity:0,backgroundColor:"ffffff"},createLine:{weight:4,strokeColorOpacity:1,strokeColor:"000000",dashLine:!1},createArrow:{weight:20,colorOpacity:1,color:"CC092F",strokeColorOpacity:1,strokeColor:"000000"},createRectangle:{weight:10,colorOpacity:0,color:"000000",strokeColorOpacity:1,strokeColor:"CC092F"},createCircle:{weight:10,colorOpacity:0,color:"000000",strokeColorOpacity:1,strokeColor:"CC092F"}}}},FONT_FAMILY:{FontAwesome:WUXManagedFontIcons.FontAwesome,Font3DS:WUXManagedFontIcons.Font3DS},TOOLS:{OPEN:"open",SELECT:"select",FREEDRAWING:"freedrawing",HIGHLIGHT:"highlight",ERASE:"erase",TEXT:"createText",LINE:"createLine",ARROW:"createArrow",RECTANGLE:"createRectangle",CIRCLE:"createCircle",INSERT_IMAGE:"insertImage"},KEY_CODES:{Z:90,Y:85,DEL:46,BACKSPACE:8},FIRST_ELEMENT:0};return t.extend({name:"DS/2DAnnotation/views/Toolbar",isLoaded:null,_deferred:{resolve:null,reject:null},_logger:null,immersiveFrame:null,imageEditor:null,sidebar:{panel:null,remove:null,open:null,select:null,freedrawing:null,highlight:null,text:null,line:null,circle:null,arrow:null},_tooltips:[],activeTool:{id:"",panel:null,toolsUI:{select:{container:null},freedrawing:{container:null,weightSpinBox:null,weightSlider:null,colorOpacitySlider:null,colorPicker:null},highlight:{container:null,opacitySpinBox:null,opacitySlider:null,colorPicker:null},createText:{container:null,weightSpinBox:null,weightSlider:null,colorPicker:null,strokeColorPicker:null,backgroundColorPicker:null},createLine:{container:null,weightSpinBox:null,weightSlider:null,strokeColorPicker:null,dashLineToggle:null},createArrow:{container:null,weightSpinBox:null,weightSlider:null,colorPicker:null,strokeColorPicker:null},createRectangle:{container:null,colorPicker:null,strokeColorPicker:null},createCircle:{container:null,colorPicker:null,strokeColorPicker:null}}},activeObjects:[],callbacks:{saveCallback:null,exitCallback:null},preferences:{},init:function(e,t,a){u.start(this.name+" init"),this._logger=s.getLogger(this.name),this.immersiveFrame=e,this.imageEditor=t,this.sidebar={panel:null,remove:null,open:null,select:null,freedrawing:null,highlight:null,text:null,line:null,circle:null,arrow:null},this._tooltips=[],this.activeTool={id:"",panel:null,toolsUI:{select:{container:null},freedrawing:{container:null,weightSpinBox:null,weightSlider:null,colorOpacitySlider:null,colorPicker:null},highlight:{container:null,opacitySpinBox:null,opacitySlider:null,colorPicker:null},createText:{container:null,weightSpinBox:null,weightSlider:null,colorPicker:null,strokeColorPicker:null,backgroundColorPicker:null},createLine:{container:null,weightSpinBox:null,weightSlider:null,strokeColorPicker:null,dashLineToggle:null},createArrow:{container:null,weightSpinBox:null,weightSlider:null,colorPicker:null,strokeColorPicker:null},createRectangle:{container:null,colorPicker:null,strokeColorPicker:null},createCircle:{container:null,colorPicker:null,strokeColorPicker:null}}},this.activeObjects=[],this.callbacks={saveCallback:a.saveCallback,exitCallback:a.exitCallback};try{var i=localStorage.getItem(g.PREFERENCES.TOOL_PREFERENCES.KEY);this.preferences=null===i||""===i?g.PREFERENCES.TOOL_PREFERENCES.DEFAULT_VALUES:o.merge(JSON.parse(i),g.PREFERENCES.TOOL_PREFERENCES.DEFAULT_VALUES)}catch(e){this.preferences=g.PREFERENCES.TOOL_PREFERENCES.DEFAULT_VALUES}u.end(this.name+" init")},destroy:function(){this.immersiveFrame=null,this.imageEditor=null,this.sidebar={panel:null,remove:null,open:null,select:null,freedrawing:null,highlight:null,text:null,line:null,circle:null,arrow:null},this._tooltips.forEach(function(e){e.hide()}),this.activeTool={id:"",panel:null,toolsUI:{select:{container:null},freedrawing:{container:null,weightSpinBox:null,weightSlider:null,colorOpacitySlider:null,colorPicker:null},highlight:{container:null,opacitySpinBox:null,opacitySlider:null,colorPicker:null},createText:{container:null,weightSpinBox:null,weightSlider:null,colorPicker:null,strokeColorPicker:null,backgroundColorPicker:null},createLine:{container:null,weightSpinBox:null,weightSlider:null,strokeColorPicker:null,dashLineToggle:null},createArrow:{container:null,weightSpinBox:null,weightSlider:null,colorPicker:null,strokeColorPicker:null},createRectangle:{container:null,colorPicker:null,strokeColorPicker:null},createCircle:{container:null,colorPicker:null,strokeColorPicker:null}}},this.activeObjects=[],this.callbacks={saveCallback:null,exitCallback:null},this.preferences={},document.removeEventListener("keydown",this._onKeyDown)},render:function(){var t=this;return u.start(t.name+" render"),t.isLoaded=new e(function(e,o){t._deferred.resolve=e,t._deferred.reject=o}),t._createSidebar(),t._createActiveToolPanel(),t._onToolSelected(g.TOOLS.HIGHLIGHT),t._deferred.resolve(),u.end(t.name+" render"),t},listen:function(){var e=this;return e.imageEditor.canvas.on("selection:cleared",function(){e.sidebar.remove.disabled=!0,e.activeObjects=[],e._onToolSelected(g.TOOLS.SELECT,!0)}),e.imageEditor.canvas.on("object:selected",function(t){e.sidebar.remove.disabled=!1;var o=t.target,a=null,i={};if("group"===o.type){e.activeObjects=e.imageEditor.canvas._activeGroup._objects;var n=e.activeObjects.every(function(t){return e.activeObjects[g.FIRST_ELEMENT].annotationType===t.annotationType});e.activeObjects.length&&n&&(a=e.activeObjects[g.FIRST_ELEMENT].annotationType)}else if(e.activeObjects=[e.imageEditor.canvas.getActiveObject()],o.annotationType)switch(a=o.annotationType,o.annotationType){case g.TOOLS.HIGHLIGHT:i={color:e.imageEditor.utils.RGBAtoHex(e.activeObjects[g.FIRST_ELEMENT].get("fill")).hex,opacity:e.activeObjects[g.FIRST_ELEMENT].get("opacity")};break;case g.TOOLS.TEXT:i={fontSize:e.activeObjects[g.FIRST_ELEMENT].get("fontSize"),fillColor:e.imageEditor.utils.RGBAtoHex(e.activeObjects[g.FIRST_ELEMENT].get("fill")).hex,fillOpacity:e.imageEditor.utils.RGBAtoHex(e.activeObjects[g.FIRST_ELEMENT].get("fill")).opacity,strokeColor:e.imageEditor.utils.RGBAtoHex(e.activeObjects[g.FIRST_ELEMENT].get("stroke")).hex,strokeOpacity:e.imageEditor.utils.RGBAtoHex(e.activeObjects[g.FIRST_ELEMENT].get("stroke")).opacity,backgroundColor:e.imageEditor.utils.RGBAtoHex(e.activeObjects[g.FIRST_ELEMENT].get("backgroundColor")).hex,backgroundOpacity:e.imageEditor.utils.RGBAtoHex(e.activeObjects[g.FIRST_ELEMENT].get("backgroundColor")).opacity};break;case g.TOOLS.LINE:i={strokeWidth:e.activeObjects[g.FIRST_ELEMENT].get("strokeWidth"),strokeColor:e.imageEditor.utils.RGBAtoHex(e.activeObjects[g.FIRST_ELEMENT].get("stroke")).hex,strokeOpacity:e.imageEditor.utils.RGBAtoHex(e.activeObjects[g.FIRST_ELEMENT].get("stroke")).opacity,dashLine:Array.isArray(e.activeObjects[g.FIRST_ELEMENT].get("strokeDashArray"))};break;case g.TOOLS.ARROW:i={size:e.activeObjects[g.FIRST_ELEMENT].get("arrowSize"),fillColor:e.imageEditor.utils.RGBAtoHex(e.activeObjects[g.FIRST_ELEMENT].get("fill")).hex,fillOpacity:e.imageEditor.utils.RGBAtoHex(e.activeObjects[g.FIRST_ELEMENT].get("fill")).opacity,strokeColor:e.imageEditor.utils.RGBAtoHex(e.activeObjects[g.FIRST_ELEMENT].get("stroke")).hex,strokeOpacity:e.imageEditor.utils.RGBAtoHex(e.activeObjects[g.FIRST_ELEMENT].get("stroke")).opacity};break;case g.TOOLS.RECTANGLE:case g.TOOLS.CIRCLE:i={strokeWidth:e.activeObjects[g.FIRST_ELEMENT].get("strokeWidth"),fillColor:e.imageEditor.utils.RGBAtoHex(e.activeObjects[g.FIRST_ELEMENT].get("fill")).hex,fillOpacity:e.imageEditor.utils.RGBAtoHex(e.activeObjects[g.FIRST_ELEMENT].get("fill")).opacity,strokeColor:e.imageEditor.utils.RGBAtoHex(e.activeObjects[g.FIRST_ELEMENT].get("stroke")).hex,strokeOpacity:e.imageEditor.utils.RGBAtoHex(e.activeObjects[g.FIRST_ELEMENT].get("stroke")).opacity};break;default:i=null}a&&a!==g.TOOLS.FREEDRAWING?e._onToolSelected(a,!0,i):e._onToolSelected(g.TOOLS.SELECT,!0)}),document.addEventListener("keydown",e._onKeyDown.bind(e)),e},_createSidebar:function(){var e=this,t=o.createElement("div",{class:"annotation-toolbar-sidebar"}),n=o.createElement("div",{class:"annotation-toolbar-tools-container"}).inject(t);e.sidebar.open=new a({emphasize:"secondary",type:"button",icon:{iconName:"folder-open",fontIconFamily:g.FONT_FAMILY.Font3DS},touch:!0,onClick:function(){var t=o.createElement("div",{class:"annotation-open-confirm",html:v.toolbar.sidebar.openConfirmDialog.content}),i=new c({title:v.toolbar.sidebar.openConfirmDialog.title,content:t,immersiveFrame:e.immersiveFrame,resizableFlag:!1,snappableFlag:!1,modalFlag:!0,buttons:{Cancel:new a({label:v.toolbar.sidebar.openConfirmDialog.cancel,onClick:function(){i.destroy()},allowUnsafeHTMLLabel:!0}),Ok:new a({label:v.toolbar.sidebar.openConfirmDialog.ok,onClick:function(){i.destroy(),e.imageEditor.openFile()},allowUnsafeHTMLLabel:!0})}})},allowUnsafeHTMLLabel:!0}).inject(n);var r=new i({target:e.sidebar.open,trigger:"hover"});r.setBody(v.toolbar.sidebar.panel.open),r.getContent().addClassName("annotation-toolbar-tools-popup"),e._tooltips.push(r);var l=function(t){return function(){e._onToolSelected(t)}},s=o.createElement("div",{class:"annotation-toolbar-tools-container"}).inject(t);e.sidebar[g.TOOLS.SELECT]=new a({emphasize:"secondary",type:"radio",checkFlag:!0,icon:{iconName:"target",fontIconFamily:g.FONT_FAMILY.Font3DS},onClick:l(g.TOOLS.SELECT),allowUnsafeHTMLLabel:!0}).inject(s);var h=new i({target:e.sidebar[g.TOOLS.SELECT],trigger:"hover"});h.setBody(v.tools[g.TOOLS.SELECT].title),h.getContent().addClassName("annotation-toolbar-tools-popup"),e._tooltips.push(h),e.sidebar[g.TOOLS.FREEDRAWING]=new a({emphasize:"secondary",type:"radio",icon:{iconName:"pencil",fontIconFamily:g.FONT_FAMILY.Font3DS},onClick:l(g.TOOLS.FREEDRAWING),allowUnsafeHTMLLabel:!0}).inject(s);var u=new i({target:e.sidebar[g.TOOLS.FREEDRAWING],trigger:"hover"});u.setBody(v.tools[g.TOOLS.FREEDRAWING].title),u.getContent().addClassName("annotation-toolbar-tools-popup"),e._tooltips.push(u),e.sidebar[g.TOOLS.HIGHLIGHT]=new a({emphasize:"secondary",type:"radio",icon:{iconName:"highlighter",fontIconFamily:g.FONT_FAMILY.Font3DS},onClick:l(g.TOOLS.HIGHLIGHT),allowUnsafeHTMLLabel:!0}).inject(s);var m=new i({target:e.sidebar[g.TOOLS.HIGHLIGHT],trigger:"hover"});m.setBody(v.tools[g.TOOLS.HIGHLIGHT].title),m.getContent().addClassName("annotation-toolbar-tools-popup"),e._tooltips.push(m),e.sidebar[g.TOOLS.TEXT]=new a({emphasize:"secondary",type:"radio",icon:{iconName:"text",fontIconFamily:g.FONT_FAMILY.Font3DS},onClick:l(g.TOOLS.TEXT),allowUnsafeHTMLLabel:!0}).inject(s);var T=new i({target:e.sidebar[g.TOOLS.TEXT],trigger:"hover"});T.setBody(v.tools[g.TOOLS.TEXT].title),T.getContent().addClassName("annotation-toolbar-tools-popup"),e._tooltips.push(T),e.sidebar[g.TOOLS.LINE]=new a({emphasize:"secondary",type:"radio",icon:{iconName:"minus",fontIconFamily:g.FONT_FAMILY.Font3DS},onClick:l(g.TOOLS.LINE),allowUnsafeHTMLLabel:!0}).inject(s);var p=new i({target:e.sidebar[g.TOOLS.LINE],trigger:"hover"});p.setBody(v.tools[g.TOOLS.LINE].title),p.getContent().addClassName("annotation-toolbar-tools-popup"),e._tooltips.push(p),e.sidebar[g.TOOLS.ARROW]=new a({emphasize:"secondary",type:"radio",icon:{iconName:"right",fontIconFamily:g.FONT_FAMILY.Font3DS},onClick:l(g.TOOLS.ARROW),allowUnsafeHTMLLabel:!0}).inject(s);var f=new i({target:e.sidebar[g.TOOLS.ARROW],trigger:"hover"});f.setBody(v.tools[g.TOOLS.ARROW].title),f.getContent().addClassName("annotation-toolbar-tools-popup"),e._tooltips.push(f),e.sidebar[g.TOOLS.RECTANGLE]=new a({emphasize:"secondary",type:"radio",icon:{iconName:"checkbox-off",fontIconFamily:g.FONT_FAMILY.Font3DS},onClick:l(g.TOOLS.RECTANGLE),allowUnsafeHTMLLabel:!0}).inject(s);var E=new i({target:e.sidebar[g.TOOLS.RECTANGLE],trigger:"hover"});E.setBody(v.tools[g.TOOLS.RECTANGLE].title),E.getContent().addClassName("annotation-toolbar-tools-popup"),e._tooltips.push(E),e.sidebar[g.TOOLS.CIRCLE]=new a({emphasize:"secondary",type:"radio",icon:{iconName:"radiobutton-off",fontIconFamily:g.FONT_FAMILY.Font3DS},onClick:l(g.TOOLS.CIRCLE),allowUnsafeHTMLLabel:!0}).inject(s);var C=new i({target:e.sidebar[g.TOOLS.CIRCLE],trigger:"hover"});C.setBody(v.tools[g.TOOLS.CIRCLE].title),C.getContent().addClassName("annotation-toolbar-tools-popup"),e._tooltips.push(C),e.sidebar[g.TOOLS.INSERT_IMAGE]=new a({emphasize:"secondary",type:"radio",icon:{iconName:"picture",fontIconFamily:g.FONT_FAMILY.Font3DS},onClick:l(g.TOOLS.INSERT_IMAGE),allowUnsafeHTMLLabel:!0}).inject(s);var O=new i({target:e.sidebar[g.TOOLS.INSERT_IMAGE],trigger:"hover"});O.setBody(v.tools[g.TOOLS.INSERT_IMAGE].title),O.getContent().addClassName("annotation-toolbar-tools-popup"),e._tooltips.push(O);var S=o.createElement("div",{class:"annotation-toolbar-tools-container"}).inject(t);e.sidebar.remove=new a({emphasize:"secondary",type:"button",icon:{iconName:"trash",fontIconFamily:g.FONT_FAMILY.Font3DS},disabled:!0,onClick:e._toolsCallbacks.remove.bind(e),allowUnsafeHTMLLabel:!0}).inject(S);var b=new i({target:e.sidebar.remove,trigger:"hover"});b.setBody(v.toolbar.sidebar.panel.remove),b.getContent().addClassName("annotation-toolbar-tools-popup"),e._tooltips.push(b);var w=o.createElement("div",{class:"annotation-toolbar-tools-container"}).inject(t);e.sidebar.download=new a({emphasize:"secondary",type:"button",icon:{iconName:"download",fontIconFamily:g.FONT_FAMILY.Font3DS},onClick:function(){e.imageEditor.download()},allowUnsafeHTMLLabel:!0}).inject(w);var L=new i({target:e.sidebar.download,trigger:"hover"});L.setBody(v.toolbar.sidebar.panel.download),L.getContent().addClassName("annotation-toolbar-tools-popup"),e._tooltips.push(L),e.sidebar.save=new a({emphasize:"secondary",type:"button",icon:{iconName:"floppy",fontIconFamily:g.FONT_FAMILY.Font3DS},onClick:function(){e.callbacks.saveCallback(e.imageEditor.save())},allowUnsafeHTMLLabel:!0}).inject(w);var k=new i({target:e.sidebar.save,trigger:"hover"});k.setBody(v.toolbar.sidebar.panel.save),k.getContent().addClassName("annotation-toolbar-tools-popup"),e._tooltips.push(k),e.sidebar.close=new a({emphasize:"secondary",type:"button",icon:{iconName:"close",fontIconFamily:g.FONT_FAMILY.Font3DS},onClick:function(){var t=o.createElement("div",{class:"annotation-close-confirm",html:v.toolbar.sidebar.closeConfirmDialog.content}),i=new c({title:v.toolbar.sidebar.closeConfirmDialog.title,content:t,immersiveFrame:e.immersiveFrame,resizableFlag:!1,snappableFlag:!1,modalFlag:!0,buttons:{Cancel:new a({label:v.toolbar.sidebar.closeConfirmDialog.cancel,onClick:function(){i.destroy()},allowUnsafeHTMLLabel:!0}),Ok:new a({label:v.toolbar.sidebar.closeConfirmDialog.save,onClick:function(){e.callbacks.saveCallback(e.imageEditor.save())},allowUnsafeHTMLLabel:!0}),Discard:new a({label:v.toolbar.sidebar.closeConfirmDialog.discard,onClick:function(){e.callbacks.exitCallback()},allowUnsafeHTMLLabel:!0})}})},allowUnsafeHTMLLabel:!0}).inject(w);var I=new i({target:e.sidebar.close,trigger:"hover"});I.setBody(v.toolbar.sidebar.panel.close),I.getContent().addClassName("annotation-toolbar-tools-popup"),e._tooltips.push(I),e.sidebar.panel=new d({content:t,position:{offsetX:20,offsetY:20},immersiveFrame:e.immersiveFrame,resizableFlag:!1,closeButtonFlag:!1,snappableFlag:!1,minWidth:54,width:54,allowedDockAreas:0})},_createActiveToolPanel:function(){var e=o.createElement("div",{class:"annotation-toolbar-active-panel-header",html:""}),t=o.createElement("div",{class:"annotation-toolbar-active-panel-container"});this._createSelectPanel(t),this._createFreeDrawingToolPanel(t),this._createHighlightToolPanel(t),this._createTextToolPanel(t),this._createLineToolPanel(t),this._createArrowToolPanel(t),this._createRectangleToolPanel(t),this._createCircleToolPanel(t),this.activeTool.panel=new d({title:v.activeTool,header:e,content:t,position:{offsetX:90,offsetY:20},immersiveFrame:this.immersiveFrame,resizableFlag:!0,closeButtonFlag:!1,height:240,width:280,allowedDockAreas:0}),this._onToolSelected(g.TOOLS.SELECT)},_createSelectPanel:function(e){this.activeTool.toolsUI.select.container=o.createElement("div",{class:"annotation-toolbar-active-panel-select"}).inject(e).hide()},_createFreeDrawingToolPanel:function(e){var t=this,a=o.createElement("div",{class:"annotation-toolbar-active-panel-freedrawing"}).inject(e).hide();t.activeTool.toolsUI.freedrawing.container=a;var i=o.createElement("div",{class:"annotation-toolbar-active-panel-freedrawing-weight"}).inject(a);o.createElement("div",{class:"annotation-toolbar-active-panel-freedrawing-weight-label",html:v.tools.freedrawing.labels.weight}).inject(i);var l=new r({value:t.preferences.freedrawing.weight,units:"px",minValue:1,maxValue:50,stepValue:1,pageStepValue:1}).inject(i);t.activeTool.toolsUI.freedrawing.weightSpinBox=l;var s=new n({value:t.preferences.freedrawing.weight,minValue:1,maxValue:50,stepValue:1}).inject(i);t.activeTool.toolsUI.freedrawing.weightSlider=s,l.addEventListener("change",function(e){s.value=e.dsModel.value,t.imageEditor.getCommand(g.TOOLS.FREEDRAWING).setBrush({width:e.dsModel.value}),t._saveToolPreferences(g.TOOLS.FREEDRAWING,"weight",e.dsModel.value)}),s.addEventListener("change",function(e){l.value=e.dsModel.value});var c=o.createElement("div",{class:"annotation-toolbar-active-panel-freedrawing-color"}).inject(a);o.createElement("div",{class:"annotation-toolbar-active-panel-freedrawing-color-label",html:v.tools.freedrawing.labels.color}).inject(c);var d=new n({value:t.preferences.freedrawing.colorOpacity,minValue:0,maxValue:1,stepValue:.01}).inject(c);t.activeTool.toolsUI.freedrawing.colorOpacitySlider=d,d.addEventListener("change",function(e){t.imageEditor.getCommand(g.TOOLS.FREEDRAWING).setBrush({color:t.imageEditor.utils.hexToRGBA("#"+t.activeTool.toolsUI.freedrawing.colorPicker.value,e.dsModel.value)}),t._saveToolPreferences(g.TOOLS.FREEDRAWING,"colorOpacity",e.dsModel.value)}),t.activeTool.toolsUI.freedrawing.colorPicker=new h,t.activeTool.toolsUI.freedrawing.colorPicker.value=t.preferences.freedrawing.color,t.activeTool.toolsUI.freedrawing.colorPicker.inject(c),t.activeTool.toolsUI.freedrawing.colorPicker.addEventListener("liveChange",function(e){t.imageEditor.getCommand(g.TOOLS.FREEDRAWING).setBrush({color:t.imageEditor.utils.hexToRGBA("#"+e.dsModel.value,t.activeTool.toolsUI.freedrawing.colorOpacitySlider.value)}),t._saveToolPreferences(g.TOOLS.FREEDRAWING,"color",e.dsModel.value)})},_createHighlightToolPanel:function(e){var t=this,a=o.createElement("div",{class:"annotation-toolbar-active-panel-highlight"}).inject(e).hide();t.activeTool.toolsUI.highlight.container=a;var i=o.createElement("div",{class:"annotation-toolbar-active-panel-highlight-color"}).inject(a);o.createElement("div",{class:"annotation-toolbar-active-panel-highlight-color-label",html:v.tools.highlight.labels.color}).inject(i),t.activeTool.toolsUI.highlight.colorPicker=new h,t.activeTool.toolsUI.highlight.colorPicker.value=t.preferences[g.TOOLS.HIGHLIGHT].color,t.activeTool.toolsUI.highlight.colorPicker.inject(i),t.activeTool.toolsUI.highlight.colorPicker.addEventListener("liveChange",function(e){t.imageEditor.getCommand(g.TOOLS.HIGHLIGHT).setColor(e.dsModel.value),t.activeObjects.forEach(function(t){t.setColor("#"+e.dsModel.value)}),t.imageEditor.canvas.renderAll(),t._saveToolPreferences(g.TOOLS.HIGHLIGHT,"color",e.dsModel.value)});var l=o.createElement("div",{class:"annotation-toolbar-active-panel-highlight-opacity"}).inject(a);o.createElement("div",{class:"annotation-toolbar-active-panel-highlight-opacity-label",html:v.tools.highlight.labels.opacity}).inject(l);var s=new r({value:t.preferences[g.TOOLS.HIGHLIGHT].opacity,units:"",minValue:0,maxValue:1,stepValue:.01,pageStepValue:.01}).inject(l);t.activeTool.toolsUI.highlight.opacitySpinBox=s;var c=new n({value:t.preferences[g.TOOLS.HIGHLIGHT].opacity,minValue:0,maxValue:1,stepValue:.01}).inject(l);t.activeTool.toolsUI.highlight.opacitySlider=c,s.addEventListener("change",function(e){c.value=e.dsModel.value,t.imageEditor.getCommand(g.TOOLS.HIGHLIGHT).setOpacity(e.dsModel.value),t.activeObjects.forEach(function(t){t.set("opacity",e.dsModel.value)}),t.imageEditor.canvas.renderAll(),t._saveToolPreferences(g.TOOLS.HIGHLIGHT,"opacity",e.dsModel.value)}),c.addEventListener("change",function(e){s.value=e.dsModel.value})},_createTextToolPanel:function(e){var t=this,a=o.createElement("div",{class:"annotation-toolbar-active-panel-createtext"}).inject(e).hide();t.activeTool.toolsUI.createText.container=a;var i=o.createElement("div",{class:"annotation-toolbar-active-panel-createtext-weight"}).inject(a);o.createElement("div",{class:"annotation-toolbar-active-panel-createtext-weight-label",html:v.tools.createText.labels.weight}).inject(i);var l=new r({value:t.preferences[g.TOOLS.TEXT].weight,units:"px",minValue:1,maxValue:100,stepValue:1,pageStepValue:1}).inject(i);t.activeTool.toolsUI.createText.weightSpinBox=l;var s=new n({value:t.preferences[g.TOOLS.TEXT].weight,minValue:1,maxValue:100,stepValue:1}).inject(i);t.activeTool.toolsUI.createText.weightSlider=s,l.addEventListener("change",function(e){s.value=e.dsModel.value,t.imageEditor.getCommand(g.TOOLS.TEXT).setFontSize(e.dsModel.value),t.activeObjects.forEach(function(t){t.set("fontSize",e.dsModel.value)}),t.imageEditor.canvas.renderAll(),t._saveToolPreferences(g.TOOLS.TEXT,"weight",e.dsModel.value)}),s.addEventListener("change",function(e){l.value=e.dsModel.value});var c=o.createElement("div",{class:"annotation-toolbar-active-panel-createtext-color"}).inject(a);o.createElement("div",{class:"annotation-toolbar-active-panel-createtext-color-label",html:v.tools.createText.labels.color}).inject(c);var d=new n({value:t.preferences[g.TOOLS.TEXT].colorOpacity,minValue:0,maxValue:1,stepValue:.01}).inject(c);t.activeTool.toolsUI.createText.colorOpacitySlider=d,d.addEventListener("change",function(e){var o=t.imageEditor.utils.hexToRGBA("#"+t.activeTool.toolsUI.createText.colorPicker.value,e.dsModel.value);t.imageEditor.getCommand(g.TOOLS.TEXT).setFillColor(o),t.activeObjects.forEach(function(e){e.setColor(o)}),t.imageEditor.canvas.renderAll(),t._saveToolPreferences(g.TOOLS.TEXT,"colorOpacity",e.dsModel.value)}),t.activeTool.toolsUI.createText.colorPicker=new h,t.activeTool.toolsUI.createText.colorPicker.value=t.preferences[g.TOOLS.TEXT].color,t.activeTool.toolsUI.createText.colorPicker.inject(c),t.activeTool.toolsUI.createText.colorPicker.addEventListener("liveChange",function(e){var o=t.imageEditor.utils.hexToRGBA("#"+e.dsModel.value,t.activeTool.toolsUI.createText.colorOpacitySlider.value);t.imageEditor.getCommand(g.TOOLS.TEXT).setFillColor(o),t.activeObjects.forEach(function(e){e.setColor(o)}),t.imageEditor.canvas.renderAll(),t._saveToolPreferences(g.TOOLS.TEXT,"color",e.dsModel.value)});var u=o.createElement("div",{class:"annotation-toolbar-active-panel-createtext-color"}).inject(a);o.createElement("div",{class:"annotation-toolbar-active-panel-createtext-strokecolor-label",html:v.tools.createText.labels.strokeColor}).inject(u);var m=new n({value:t.preferences[g.TOOLS.TEXT].strokeColorOpacity,minValue:0,maxValue:1,stepValue:.01}).inject(u);t.activeTool.toolsUI.createText.strokeColorOpacitySlider=m,m.addEventListener("change",function(e){var o=t.imageEditor.utils.hexToRGBA("#"+t.activeTool.toolsUI.createText.strokeColorPicker.value,e.dsModel.value);t.imageEditor.getCommand(g.TOOLS.TEXT).setStrokeColor(o),t.activeObjects.forEach(function(e){e.set("stroke",o)}),t.imageEditor.canvas.renderAll(),t._saveToolPreferences(g.TOOLS.TEXT,"strokeColorOpacity",e.dsModel.value)}),t.activeTool.toolsUI.createText.strokeColorPicker=new h,t.activeTool.toolsUI.createText.strokeColorPicker.value=t.preferences[g.TOOLS.TEXT].strokeColor,t.activeTool.toolsUI.createText.strokeColorPicker.inject(u),t.activeTool.toolsUI.createText.strokeColorPicker.addEventListener("liveChange",function(e){var o=t.imageEditor.utils.hexToRGBA("#"+e.dsModel.value,t.activeTool.toolsUI.createText.strokeColorOpacitySlider.value);t.imageEditor.getCommand(g.TOOLS.TEXT).setStrokeColor(o),t.activeObjects.forEach(function(e){e.set("stroke",o)}),t.imageEditor.canvas.renderAll(),t._saveToolPreferences(g.TOOLS.TEXT,"strokeColor",e.dsModel.value)});var T=o.createElement("div",{class:"annotation-toolbar-active-panel-createtext-color"}).inject(a);o.createElement("div",{class:"annotation-toolbar-active-panel-createtext-backgroundcolor-label",html:v.tools.createText.labels.backgroundColor}).inject(T);var p=new n({value:t.preferences[g.TOOLS.TEXT].backgroundColorOpacity,minValue:0,maxValue:1,stepValue:.01}).inject(T);t.activeTool.toolsUI.createText.backgroundColorOpacitySlider=p,p.addEventListener("change",function(e){var o=t.imageEditor.utils.hexToRGBA("#"+t.activeTool.toolsUI.createText.backgroundColorPicker.value,e.dsModel.value);t.imageEditor.getCommand(g.TOOLS.TEXT).setBackgroundColor(o),t.activeObjects.forEach(function(e){e.set("backgroundColor",o)}),t.imageEditor.canvas.renderAll(),t._saveToolPreferences(g.TOOLS.TEXT,"backgroundColorOpacity",e.dsModel.value)}),t.activeTool.toolsUI.createText.backgroundColorPicker=new h,t.activeTool.toolsUI.createText.backgroundColorPicker.value=t.preferences[g.TOOLS.TEXT].backgroundColor,t.activeTool.toolsUI.createText.backgroundColorPicker.inject(T),t.activeTool.toolsUI.createText.backgroundColorPicker.addEventListener("liveChange",function(e){var o=t.imageEditor.utils.hexToRGBA("#"+e.dsModel.value,t.activeTool.toolsUI.createText.backgroundColorOpacitySlider.value);t.imageEditor.getCommand(g.TOOLS.TEXT).setBackgroundColor(o),t.activeObjects.forEach(function(e){e.set("backgroundColor",o)}),t.imageEditor.canvas.renderAll(),t._saveToolPreferences(g.TOOLS.TEXT,"backgroundColor",e.dsModel.value)})},_createArrowToolPanel:function(e){var t=this,a=o.createElement("div",{class:"annotation-toolbar-active-panel-createarrow"}).inject(e).hide();t.activeTool.toolsUI.createArrow.container=a;var i=o.createElement("div",{class:"annotation-toolbar-active-panel-createarrow-weight"}).inject(a);o.createElement("div",{class:"annotation-toolbar-active-panel-createarrow-weight-label",html:v.tools.createArrow.labels.weight}).inject(i);var l=new r({value:t.preferences[g.TOOLS.ARROW].weight,units:"px",minValue:1,maxValue:100,stepValue:1,pageStepValue:1}).inject(i);t.activeTool.toolsUI.createArrow.weightSpinBox=l;var s=new n({value:t.preferences[g.TOOLS.ARROW].weight,minValue:1,maxValue:100,stepValue:1}).inject(i);t.activeTool.toolsUI.createArrow.weightSlider=s,l.addEventListener("change",function(e){s.value=e.dsModel.value,t.imageEditor.getCommand(g.TOOLS.ARROW).setSize(e.dsModel.value),t.activeObjects.forEach(function(e){t.imageEditor.getCommand(g.TOOLS.ARROW).updateShape(e)}),t.imageEditor.canvas.renderAll(),t._saveToolPreferences(g.TOOLS.ARROW,"weight",e.dsModel.value)}),s.addEventListener("change",function(e){l.value=e.dsModel.value});var c=o.createElement("div",{class:"annotation-toolbar-active-panel-createarrow-color"}).inject(a);o.createElement("div",{class:"annotation-toolbar-active-panel-createarrow-color-label",html:v.tools.createArrow.labels.color}).inject(c);var d=new n({value:t.preferences[g.TOOLS.ARROW].colorOpacity,minValue:0,maxValue:1,stepValue:.01}).inject(c);t.activeTool.toolsUI.createArrow.colorOpacitySlider=d,d.addEventListener("change",function(e){var o=t.imageEditor.utils.hexToRGBA("#"+t.activeTool.toolsUI.createArrow.colorPicker.value,e.dsModel.value);t.imageEditor.getCommand(g.TOOLS.ARROW).setFillColor(o),t.activeObjects.forEach(function(e){e.setColor(o)}),t.imageEditor.canvas.renderAll(),t._saveToolPreferences(g.TOOLS.ARROW,"colorOpacity",e.dsModel.value)}),t.activeTool.toolsUI.createArrow.colorPicker=new h,t.activeTool.toolsUI.createArrow.colorPicker.value=t.preferences[g.TOOLS.ARROW].color,t.activeTool.toolsUI.createArrow.colorPicker.inject(c),t.activeTool.toolsUI.createArrow.colorPicker.addEventListener("liveChange",function(e){var o=t.imageEditor.utils.hexToRGBA("#"+e.dsModel.value,t.activeTool.toolsUI.createArrow.colorOpacitySlider.value);t.imageEditor.getCommand(g.TOOLS.ARROW).setFillColor(o),t.activeObjects.forEach(function(e){e.setColor(o)}),t.imageEditor.canvas.renderAll(),t._saveToolPreferences(g.TOOLS.ARROW,"color",e.dsModel.value)});var u=o.createElement("div",{class:"annotation-toolbar-active-panel-createarrow-color"}).inject(a);o.createElement("div",{class:"annotation-toolbar-active-panel-createarrow-strokecolor-label",html:v.tools.createArrow.labels.strokeColor}).inject(u);var m=new n({value:t.preferences[g.TOOLS.ARROW].strokeColorOpacity,minValue:0,maxValue:1,stepValue:.01}).inject(u);t.activeTool.toolsUI.createArrow.strokeColorOpacitySlider=m,m.addEventListener("change",function(e){var o=t.imageEditor.utils.hexToRGBA("#"+t.activeTool.toolsUI.createArrow.strokeColorPicker.value,e.dsModel.value);t.imageEditor.getCommand(g.TOOLS.ARROW).setStrokeColor(o),t.activeObjects.forEach(function(e){e.set("stroke",o)}),t.imageEditor.canvas.renderAll(),t._saveToolPreferences(g.TOOLS.ARROW,"strokeColorOpacity",e.dsModel.value)}),t.activeTool.toolsUI.createArrow.strokeColorPicker=new h,t.activeTool.toolsUI.createArrow.strokeColorPicker.value=t.preferences[g.TOOLS.ARROW].strokeColor,t.activeTool.toolsUI.createArrow.strokeColorPicker.inject(u),t.activeTool.toolsUI.createArrow.strokeColorPicker.addEventListener("liveChange",function(e){var o=t.imageEditor.utils.hexToRGBA("#"+e.dsModel.value,t.activeTool.toolsUI.createArrow.strokeColorOpacitySlider.value);t.imageEditor.getCommand(g.TOOLS.ARROW).setStrokeColor(o),t.activeObjects.forEach(function(e){e.set("stroke",o)}),t.imageEditor.canvas.renderAll(),t._saveToolPreferences(g.TOOLS.ARROW,"strokeColor",e.dsModel.value)})},_createLineToolPanel:function(e){var t=this,a=o.createElement("div",{class:"annotation-toolbar-active-panel-createline"}).inject(e).hide();t.activeTool.toolsUI.createLine.container=a;var i=o.createElement("div",{class:"annotation-toolbar-active-panel-createline-weight"}).inject(a);o.createElement("div",{class:"annotation-toolbar-active-panel-createline-weight-label",html:v.tools.createLine.labels.weight}).inject(i);var s=new r({value:t.preferences[g.TOOLS.LINE].weight,units:"px",minValue:1,maxValue:50,stepValue:1,pageStepValue:1}).inject(i);t.activeTool.toolsUI.createLine.weightSpinBox=s;var c=new n({value:t.preferences[g.TOOLS.LINE].weight,minValue:1,maxValue:50,stepValue:1}).inject(i);t.activeTool.toolsUI.createLine.weightSlider=c,s.addEventListener("change",function(e){c.value=e.dsModel.value,t.imageEditor.getCommand(g.TOOLS.LINE).setStrokeWidth(e.dsModel.value),t.activeObjects.forEach(function(t){t.set("strokeWidth",e.dsModel.value)}),t.imageEditor.canvas.renderAll(),t._saveToolPreferences(g.TOOLS.LINE,"weight",e.dsModel.value)}),c.addEventListener("change",function(e){s.value=e.dsModel.value});var d=o.createElement("div",{class:"annotation-toolbar-active-panel-createline-color"}).inject(a);o.createElement("div",{class:"annotation-toolbar-active-panel-createline-strokecolor-label",html:v.tools.createLine.labels.strokeColor}).inject(d);var u=new n({value:t.preferences[g.TOOLS.LINE].strokeColorOpacity,minValue:0,maxValue:1,stepValue:.01}).inject(d);t.activeTool.toolsUI.createLine.strokeColorOpacitySlider=u,u.addEventListener("change",function(e){var o=t.imageEditor.utils.hexToRGBA("#"+t.activeTool.toolsUI.createLine.strokeColorPicker.value,e.dsModel.value);t.imageEditor.getCommand(g.TOOLS.LINE).setStrokeColor(o),t.activeObjects.forEach(function(e){e.set("stroke",o)}),t.imageEditor.canvas.renderAll(),t._saveToolPreferences(g.TOOLS.LINE,"strokeColorOpacity",e.dsModel.value)}),t.activeTool.toolsUI.createLine.strokeColorPicker=new h,t.activeTool.toolsUI.createLine.strokeColorPicker.value=t.preferences[g.TOOLS.LINE].strokeColor,t.activeTool.toolsUI.createLine.strokeColorPicker.inject(d),t.activeTool.toolsUI.createLine.strokeColorPicker.addEventListener("liveChange",function(e){var o=t.imageEditor.utils.hexToRGBA("#"+e.dsModel.value,t.activeTool.toolsUI.createLine.strokeColorOpacitySlider.value);t.imageEditor.getCommand(g.TOOLS.LINE).setStrokeColor(o),t.activeObjects.forEach(function(e){e.set("stroke",o)}),t.imageEditor.canvas.renderAll(),t._saveToolPreferences(g.TOOLS.LINE,"strokeColor",e.dsModel.value)});var m=o.createElement("div",{class:"annotation-toolbar-active-panel-createline-dashline"}).inject(a);o.createElement("div",{class:"annotation-toolbar-active-panel-createline-dashline-label",html:v.tools.createLine.labels.dashLine}).inject(m),t.activeTool.toolsUI.createLine.dashLineToggle=new l({type:"switch"}),t.activeTool.toolsUI.createLine.dashLineToggle.checkFlag=t.preferences[g.TOOLS.LINE].dashLine,t.activeTool.toolsUI.createLine.dashLineToggle.inject(m),t.activeTool.toolsUI.createLine.dashLineToggle.addEventListener("change",function(e){var o=e.dsModel.checkFlag;t.imageEditor.getCommand(g.TOOLS.LINE).setDashLine(o),t.activeObjects.forEach(function(e){e.set("strokeDashArray",!0===o?[5,5]:null)}),t.imageEditor.canvas.renderAll(),t._saveToolPreferences(g.TOOLS.LINE,"dashLine",e.dsModel.checkFlag)})},_createRectangleToolPanel:function(e){var t=this,a=o.createElement("div",{class:"annotation-toolbar-active-panel-createrectangle"}).inject(e).hide();t.activeTool.toolsUI.createRectangle.container=a;var i=o.createElement("div",{class:"annotation-toolbar-active-panel-createrectangle-weight"}).inject(a);o.createElement("div",{class:"annotation-toolbar-active-panel-createrectangle-weight-label",html:v.tools.createRectangle.labels.weight}).inject(i);var l=new r({value:t.preferences[g.TOOLS.RECTANGLE].weight,units:"px",minValue:1,maxValue:50,stepValue:1,pageStepValue:1}).inject(i);t.activeTool.toolsUI.createRectangle.weightSpinBox=l;var s=new n({value:t.preferences[g.TOOLS.RECTANGLE].weight,minValue:1,maxValue:50,stepValue:1}).inject(i);t.activeTool.toolsUI.createRectangle.weightSlider=s,l.addEventListener("change",function(e){s.value=e.dsModel.value,t.imageEditor.getCommand(g.TOOLS.RECTANGLE).setStrokeWidth(e.dsModel.value),t.activeObjects.forEach(function(t){t.set("strokeWidth",e.dsModel.value)}),t.imageEditor.canvas.renderAll(),t._saveToolPreferences(g.TOOLS.RECTANGLE,"weight",e.dsModel.value)}),s.addEventListener("change",function(e){l.value=e.dsModel.value});var c=o.createElement("div",{class:"annotation-toolbar-active-panel-createrectangle-color"}).inject(a);o.createElement("div",{class:"annotation-toolbar-active-panel-createrectangle-color-label",html:v.tools.createRectangle.labels.color}).inject(c);var d=new n({value:t.preferences[g.TOOLS.RECTANGLE].colorOpacity,minValue:0,maxValue:1,stepValue:.01}).inject(c);t.activeTool.toolsUI.createRectangle.colorOpacitySlider=d,d.addEventListener("change",function(e){var o=t.imageEditor.utils.hexToRGBA("#"+t.activeTool.toolsUI.createRectangle.colorPicker.value,e.dsModel.value);t.imageEditor.getCommand(g.TOOLS.RECTANGLE).setFillColor(o),t.activeObjects.forEach(function(e){e.setColor(o)}),t.imageEditor.canvas.renderAll(),t._saveToolPreferences(g.TOOLS.RECTANGLE,"colorOpacity",e.dsModel.value)}),t.activeTool.toolsUI.createRectangle.colorPicker=new h,t.activeTool.toolsUI.createRectangle.colorPicker.value=t.preferences[g.TOOLS.RECTANGLE].color,t.activeTool.toolsUI.createRectangle.colorPicker.inject(c),t.activeTool.toolsUI.createRectangle.colorPicker.addEventListener("liveChange",function(e){var o=t.imageEditor.utils.hexToRGBA("#"+e.dsModel.value,t.activeTool.toolsUI.createRectangle.colorOpacitySlider.value);t.imageEditor.getCommand(g.TOOLS.RECTANGLE).setFillColor(o),t.activeObjects.forEach(function(e){e.setColor(o)}),t.imageEditor.canvas.renderAll(),t._saveToolPreferences(g.TOOLS.RECTANGLE,"color",e.dsModel.value)});var u=o.createElement("div",{class:"annotation-toolbar-active-panel-createrectangle-color"}).inject(a);o.createElement("div",{class:"annotation-toolbar-active-panel-createrectangle-strokecolor-label",html:v.tools.createRectangle.labels.strokeColor}).inject(u);var m=new n({value:t.preferences[g.TOOLS.RECTANGLE].strokeColorOpacity,minValue:0,maxValue:1,stepValue:.01}).inject(u);t.activeTool.toolsUI.createRectangle.strokeColorOpacitySlider=m,m.addEventListener("change",function(e){var o=t.imageEditor.utils.hexToRGBA("#"+t.activeTool.toolsUI.createRectangle.strokeColorPicker.value,e.dsModel.value);t.imageEditor.getCommand(g.TOOLS.RECTANGLE).setStrokeColor(o),t.activeObjects.forEach(function(e){e.set("stroke",o)}),t.imageEditor.canvas.renderAll(),t._saveToolPreferences(g.TOOLS.RECTANGLE,"strokeColorOpacity",e.dsModel.value)}),t.activeTool.toolsUI.createRectangle.strokeColorPicker=new h,t.activeTool.toolsUI.createRectangle.strokeColorPicker.value=t.preferences[g.TOOLS.RECTANGLE].strokeColor,t.activeTool.toolsUI.createRectangle.strokeColorPicker.inject(u),t.activeTool.toolsUI.createRectangle.strokeColorPicker.addEventListener("liveChange",function(e){var o=t.imageEditor.utils.hexToRGBA("#"+e.dsModel.value,t.activeTool.toolsUI.createRectangle.strokeColorOpacitySlider.value);t.imageEditor.getCommand(g.TOOLS.RECTANGLE).setStrokeColor(o),t.activeObjects.forEach(function(e){e.set("stroke",o)}),t.imageEditor.canvas.renderAll(),t._saveToolPreferences(g.TOOLS.RECTANGLE,"strokeColor",e.dsModel.value)})},_createCircleToolPanel:function(e){var t=this,a=o.createElement("div",{class:"annotation-toolbar-active-panel-createcircle"}).inject(e).hide();t.activeTool.toolsUI.createCircle.container=a;var i=o.createElement("div",{class:"annotation-toolbar-active-panel-createcircle-weight"}).inject(a);o.createElement("div",{class:"annotation-toolbar-active-panel-createcircle-weight-label",html:v.tools.createCircle.labels.weight}).inject(i);var l=new r({value:t.preferences[g.TOOLS.CIRCLE].weight,units:"px",minValue:1,maxValue:50,stepValue:1,pageStepValue:1}).inject(i);t.activeTool.toolsUI.createCircle.weightSpinBox=l;var s=new n({value:t.preferences[g.TOOLS.CIRCLE].weight,minValue:1,maxValue:50,stepValue:1}).inject(i);t.activeTool.toolsUI.createCircle.weightSlider=s,l.addEventListener("change",function(e){s.value=e.dsModel.value,t.imageEditor.getCommand(g.TOOLS.CIRCLE).setStrokeWidth(e.dsModel.value),t.activeObjects.forEach(function(t){t.set("strokeWidth",e.dsModel.value)}),t.imageEditor.canvas.renderAll(),t._saveToolPreferences(g.TOOLS.CIRCLE,"weight",e.dsModel.value)}),s.addEventListener("change",function(e){l.value=e.dsModel.value});var c=o.createElement("div",{class:"annotation-toolbar-active-panel-createcircle-color"}).inject(a);o.createElement("div",{class:"annotation-toolbar-active-panel-createcircle-color-label",html:v.tools.createCircle.labels.color}).inject(c);var d=new n({value:t.preferences[g.TOOLS.CIRCLE].colorOpacity,minValue:0,maxValue:1,stepValue:.01}).inject(c);t.activeTool.toolsUI.createCircle.colorOpacitySlider=d,d.addEventListener("change",function(e){var o=t.imageEditor.utils.hexToRGBA("#"+t.activeTool.toolsUI.createCircle.colorPicker.value,e.dsModel.value);t.imageEditor.getCommand(g.TOOLS.CIRCLE).setFillColor(o),t.activeObjects.forEach(function(e){e.setColor(o)}),t.imageEditor.canvas.renderAll(),t._saveToolPreferences(g.TOOLS.CIRCLE,"colorOpacity",e.dsModel.value)}),t.activeTool.toolsUI.createCircle.colorPicker=new h,t.activeTool.toolsUI.createCircle.colorPicker.value=t.preferences[g.TOOLS.CIRCLE].color,t.activeTool.toolsUI.createCircle.colorPicker.inject(c),t.activeTool.toolsUI.createCircle.colorPicker.addEventListener("liveChange",function(e){var o=t.imageEditor.utils.hexToRGBA("#"+e.dsModel.value,t.activeTool.toolsUI.createCircle.colorOpacitySlider.value);t.imageEditor.getCommand(g.TOOLS.CIRCLE).setFillColor(o),t.activeObjects.forEach(function(e){e.setColor(o)}),t.imageEditor.canvas.renderAll(),t._saveToolPreferences(g.TOOLS.CIRCLE,"color",e.dsModel.value)});var u=o.createElement("div",{class:"annotation-toolbar-active-panel-createcircle-color"}).inject(a);o.createElement("div",{class:"annotation-toolbar-active-panel-createcircle-strokecolor-label",html:v.tools.createCircle.labels.strokeColor}).inject(u);var m=new n({value:t.preferences[g.TOOLS.CIRCLE].strokeColorOpacity,minValue:0,maxValue:1,stepValue:.01}).inject(u);t.activeTool.toolsUI.createCircle.strokeColorOpacitySlider=m,m.addEventListener("change",function(e){var o=t.imageEditor.utils.hexToRGBA("#"+t.activeTool.toolsUI.createCircle.strokeColorPicker.value,e.dsModel.value);t.imageEditor.getCommand(g.TOOLS.CIRCLE).setStrokeColor(o),t.activeObjects.forEach(function(e){e.set("stroke",o)}),t.imageEditor.canvas.renderAll(),t._saveToolPreferences(g.TOOLS.CIRCLE,"strokeOpacity",e.dsModel.value)}),t.activeTool.toolsUI.createCircle.strokeColorPicker=new h,t.activeTool.toolsUI.createCircle.strokeColorPicker.value=t.preferences[g.TOOLS.CIRCLE].strokeColor,t.activeTool.toolsUI.createCircle.strokeColorPicker.inject(u),t.activeTool.toolsUI.createCircle.strokeColorPicker.addEventListener("liveChange",function(e){var o=t.imageEditor.utils.hexToRGBA("#"+e.dsModel.value,t.activeTool.toolsUI.createCircle.strokeColorOpacitySlider.value);t.imageEditor.getCommand(g.TOOLS.CIRCLE).setStrokeColor(o),t.activeObjects.forEach(function(e){e.set("stroke",o)}),t.imageEditor.canvas.renderAll(),t._saveToolPreferences(g.TOOLS.CIRCLE,"strokeColor",e.dsModel.value)})},_onToolSelected:function(e,t,o){var a=this;t||(a.sidebar.remove.disabled=!0,a.imageEditor.canvas.deactivateAll().renderAll(),a.activeObjects=[]),Object.keys(a.activeTool.toolsUI).forEach(function(e){a.activeTool.toolsUI[e].container.hide()}),a.sidebar[e].checkFlag=!0,a.activeTool.panel.header.innerHTML=v.tools[e].title,e in a.activeTool.toolsUI&&a.activeTool.toolsUI[e].container.show(),e in a._toolsCallbacks&&a._toolsCallbacks[e].call(a,o),a.activeTool.id=e},_toolsCallbacks:{remove:function(){var e=this;e.activeObjects.forEach(function(t){e.imageEditor.canvas.remove(t)}),e.imageEditor.canvas.deactivateAll().renderAll()},select:function(){this.imageEditor.stopCommand()},freedrawing:function(){var e=this.imageEditor.utils.hexToRGBA("#"+this.activeTool.toolsUI.freedrawing.colorPicker.value,this.activeTool.toolsUI.freedrawing.colorOpacitySlider.value);this.imageEditor.startCommand(g.TOOLS.FREEDRAWING,{width:this.activeTool.toolsUI.freedrawing.weightSpinBox.value,color:e})},highlight:function(e){null!=e&&(e.hasOwnProperty("color")&&(this.activeTool.toolsUI.highlight.colorPicker.value=e.color),e.hasOwnProperty("opacity")&&(this.activeTool.toolsUI.highlight.opacitySpinBox.value=e.opacity)),this.imageEditor.startCommand(g.TOOLS.HIGHLIGHT,{color:this.activeTool.toolsUI.highlight.colorPicker.value,opacity:this.activeTool.toolsUI.highlight.opacitySpinBox.value})},createText:function(e){var t=null,o=null;null!=e&&(e.hasOwnProperty("fillColor")&&(this.activeTool.toolsUI.createText.colorPicker.value=e.fillColor),e.hasOwnProperty("fillOpacity")&&(this.activeTool.toolsUI.createText.colorOpacitySlider.value=e.fillOpacity),e.hasOwnProperty("strokeColor")&&(this.activeTool.toolsUI.createText.strokeColorPicker.value=e.strokeColor),e.hasOwnProperty("strokeOpacity")&&(this.activeTool.toolsUI.createText.strokeColorOpacitySlider.value=e.strokeOpacity),e.hasOwnProperty("backgroundColor")&&(this.activeTool.toolsUI.createText.backgroundColorPicker.value=e.backgroundColor),e.hasOwnProperty("backgroundOpacity")&&(this.activeTool.toolsUI.createText.backgroundColorOpacitySlider.value=e.backgroundOpacity),e.hasOwnProperty("fontSize")&&(this.activeTool.toolsUI.createText.weightSpinBox.disabled=!0,this.activeTool.toolsUI.createText.weightSlider.disabled=!0,this.activeTool.toolsUI.createText.weightSpinBox.value=e.fontSize,this.activeTool.toolsUI.createText.weightSlider.value=e.fontSize,this.activeTool.toolsUI.createText.weightSpinBox.disabled=!1,this.activeTool.toolsUI.createText.weightSlider.disabled=!1),e.hasOwnProperty("text")&&(t=e.text),e.hasOwnProperty("centered")&&(o=e.centered));var a=this.imageEditor.utils.hexToRGBA("#"+this.activeTool.toolsUI.createText.colorPicker.value,this.activeTool.toolsUI.createText.colorOpacitySlider.value),i=this.imageEditor.utils.hexToRGBA("#"+this.activeTool.toolsUI.createText.strokeColorPicker.value,this.activeTool.toolsUI.createText.strokeColorOpacitySlider.value),n=this.imageEditor.utils.hexToRGBA("#"+this.activeTool.toolsUI.createText.backgroundColorPicker.value,this.activeTool.toolsUI.createText.backgroundColorOpacitySlider.value);this.imageEditor.startCommand(g.TOOLS.TEXT,{fontSize:this.activeTool.toolsUI.createText.weightSpinBox.value,fillColor:a,strokeColor:i,backgroundColor:n,text:t,centered:o})},createLine:function(e){null!=e&&(e.hasOwnProperty("strokeColor")&&(this.activeTool.toolsUI.createLine.strokeColorPicker.value=e.strokeColor),e.hasOwnProperty("strokeOpacity")&&(this.activeTool.toolsUI.createLine.strokeColorOpacitySlider.value=e.strokeOpacity),e.hasOwnProperty("strokeWidth")&&(this.activeTool.toolsUI.createLine.weightSpinBox.disabled=!0,this.activeTool.toolsUI.createLine.weightSlider.disabled=!0,this.activeTool.toolsUI.createLine.weightSpinBox.value=e.strokeWidth,this.activeTool.toolsUI.createLine.weightSlider.value=e.strokeWidth,this.activeTool.toolsUI.createLine.weightSpinBox.disabled=!1,this.activeTool.toolsUI.createLine.weightSlider.disabled=!1),e.hasOwnProperty("dashLine")&&(this.activeTool.toolsUI.createLine.dashLineToggle.checkFlag=e.dashLine));var t=this.imageEditor.utils.hexToRGBA("#"+this.activeTool.toolsUI.createLine.strokeColorPicker.value,this.activeTool.toolsUI.createLine.strokeColorOpacitySlider.value);this.imageEditor.startCommand(g.TOOLS.LINE,{strokeWidth:this.activeTool.toolsUI.createLine.weightSpinBox.value,strokeColor:t,dashLine:this.activeTool.toolsUI.createLine.dashLineToggle.checkFlag})},createArrow:function(e){null!=e&&(e.hasOwnProperty("fillColor")&&(this.activeTool.toolsUI.createArrow.colorPicker.value=e.fillColor),e.hasOwnProperty("fillOpacity")&&(this.activeTool.toolsUI.createArrow.colorOpacitySlider.value=e.fillOpacity),e.hasOwnProperty("strokeColor")&&(this.activeTool.toolsUI.createArrow.strokeColorPicker.value=e.strokeColor),e.hasOwnProperty("strokeOpacity")&&(this.activeTool.toolsUI.createArrow.strokeColorOpacitySlider.value=e.strokeOpacity),e.hasOwnProperty("size")&&(this.activeTool.toolsUI.createArrow.weightSpinBox.disabled=!0,this.activeTool.toolsUI.createArrow.weightSlider.disabled=!0,this.activeTool.toolsUI.createArrow.weightSpinBox.value=e.size,this.activeTool.toolsUI.createArrow.weightSlider.value=e.size,this.activeTool.toolsUI.createArrow.weightSpinBox.disabled=!1,this.activeTool.toolsUI.createArrow.weightSlider.disabled=!1));var t=this.imageEditor.utils.hexToRGBA("#"+this.activeTool.toolsUI.createArrow.colorPicker.value,this.activeTool.toolsUI.createArrow.colorOpacitySlider.value),o=this.imageEditor.utils.hexToRGBA("#"+this.activeTool.toolsUI.createArrow.strokeColorPicker.value,this.activeTool.toolsUI.createArrow.strokeColorOpacitySlider.value);this.imageEditor.startCommand(g.TOOLS.ARROW,{size:this.activeTool.toolsUI.createArrow.weightSpinBox.value,fillColor:t,strokeColor:o})},createRectangle:function(e){null!=e&&(e.hasOwnProperty("fillColor")&&(this.activeTool.toolsUI.createRectangle.colorPicker.value=e.fillColor),e.hasOwnProperty("fillOpacity")&&(this.activeTool.toolsUI.createRectangle.colorOpacitySlider.value=e.fillOpacity),e.hasOwnProperty("strokeColor")&&(this.activeTool.toolsUI.createRectangle.strokeColorPicker.value=e.strokeColor),e.hasOwnProperty("strokeOpacity")&&(this.activeTool.toolsUI.createRectangle.strokeColorOpacitySlider.value=e.strokeOpacity),e.hasOwnProperty("strokeWidth")&&(this.activeTool.toolsUI.createRectangle.weightSpinBox.disabled=!0,this.activeTool.toolsUI.createRectangle.weightSlider.disabled=!0,this.activeTool.toolsUI.createRectangle.weightSpinBox.value=e.strokeWidth,this.activeTool.toolsUI.createRectangle.weightSlider.value=e.strokeWidth,this.activeTool.toolsUI.createRectangle.weightSpinBox.disabled=!1,this.activeTool.toolsUI.createRectangle.weightSlider.disabled=!1));var t=this.imageEditor.utils.hexToRGBA("#"+this.activeTool.toolsUI.createRectangle.colorPicker.value,this.activeTool.toolsUI.createRectangle.colorOpacitySlider.value),o=this.imageEditor.utils.hexToRGBA("#"+this.activeTool.toolsUI.createRectangle.strokeColorPicker.value,this.activeTool.toolsUI.createRectangle.strokeColorOpacitySlider.value);this.imageEditor.startCommand(g.TOOLS.RECTANGLE,{strokeWidth:this.activeTool.toolsUI.createRectangle.weightSpinBox.value,fillColor:t,strokeColor:o})},createCircle:function(e){null!=e&&(e.hasOwnProperty("fillColor")&&(this.activeTool.toolsUI.createCircle.colorPicker.value=e.fillColor),e.hasOwnProperty("fillOpacity")&&(this.activeTool.toolsUI.createCircle.colorOpacitySlider.value=e.fillOpacity),e.hasOwnProperty("strokeColor")&&(this.activeTool.toolsUI.createCircle.strokeColorPicker.value=e.strokeColor),e.hasOwnProperty("strokeOpacity")&&(this.activeTool.toolsUI.createCircle.strokeColorOpacitySlider.value=e.strokeOpacity),e.hasOwnProperty("strokeWidth")&&(this.activeTool.toolsUI.createCircle.weightSpinBox.disabled=!0,this.activeTool.toolsUI.createCircle.weightSlider.disabled=!0,this.activeTool.toolsUI.createCircle.weightSpinBox.value=e.strokeWidth,this.activeTool.toolsUI.createCircle.weightSlider.value=e.strokeWidth,this.activeTool.toolsUI.createCircle.weightSpinBox.disabled=!1,this.activeTool.toolsUI.createCircle.weightSlider.disabled=!1));var t=this.imageEditor.utils.hexToRGBA("#"+this.activeTool.toolsUI.createCircle.colorPicker.value,this.activeTool.toolsUI.createCircle.colorOpacitySlider.value),o=this.imageEditor.utils.hexToRGBA("#"+this.activeTool.toolsUI.createCircle.strokeColorPicker.value,this.activeTool.toolsUI.createCircle.strokeColorOpacitySlider.value);this.imageEditor.startCommand(g.TOOLS.CIRCLE,{strokeWidth:this.activeTool.toolsUI.createCircle.weightSpinBox.value,fillColor:t,strokeColor:o})},insertImage:function(){this.imageEditor.stopCommand(),this.imageEditor.insertImage()}},_onKeyDown:function(e){var t=this;if(e.keyCode!==g.KEY_CODES.BACKSPACE&&e.keyCode!==g.KEY_CODES.DEL||t._toolsCallbacks.remove.call(t),65===e.keyCode&&e.ctrlKey&&(e.preventDefault(),t.imageEditor.selectAll()),67===e.keyCode&&e.ctrlKey){e.stopPropagation();var o=t.imageEditor.canvas.getActiveObject();null===o&&(o=t.imageEditor.canvas.getActiveGroup()),o.clone(function(e){t._clipboard=e})}if(86===e.keyCode&&e.ctrlKey){var a=t.imageEditor.canvas.getActiveObject();if(null!==a&&a.annotationType===g.TOOLS.TEXT&&a.isEditing)return;if(null===t._clipboard||void 0===t._clipboard)return;e.stopPropagation(),t._clipboard.clone(function(e){t.imageEditor.canvas.deactivateAll(),e.set({left:e.left+30,top:e.top+30,evented:!0}),"group"===e.type?(e.forEachObject(function(e){t.imageEditor.canvas.add(e)}),e.setCoords(),t.imageEditor.canvas.setActiveGroup(e)):(t.imageEditor.canvas.add(e),t.imageEditor.canvas.setActiveObject(e)),t._clipboard.top+=30,t._clipboard.left+=30}),t.imageEditor.canvas.renderAll()}},_saveToolPreferences:function(e,t,o){this.preferences[e][t]=o,localStorage.setItem(g.PREFERENCES.TOOL_PREFERENCES.KEY,JSON.stringify(this.preferences))}})}),define("DS/2DAnnotation/components/ImageEditor",["UWA/Class/Promise","UWA/Controls/Abstract","UWA/Core","DS/FabricJS/FabricJS","DS/Logger/Logger","DS/VENWebHtml2Canvas/Html2Canvas","DS/WAFData/WAFData","DS/2DAnnotation/commands/CreateArrow","DS/2DAnnotation/commands/CreateCircle","DS/2DAnnotation/commands/CreateLine","DS/2DAnnotation/commands/CreateRectangle","DS/2DAnnotation/commands/CreateText","DS/2DAnnotation/commands/FreeDrawing","DS/2DAnnotation/commands/Highlight","DS/IssueCommon/utils/Utils","DS/IssueServices/Contexts","DS/IssueServices/utils/Performance","i18n!DS/2DAnnotation/assets/nls/2DAnnotation","css!DS/2DAnnotation/2DAnnotation.css"],function(e,t,o,a,i,n,r,l,s,c,d,h,u,v,g,m,T){"use strict";var p=window.fabric,f={FREE_DRAWING:"freedrawing",HIGHLIGHT:"highlight",TEXT:"createText",LINE:"createLine",ARROW:"createArrow",RECTANGLE:"createRectangle",CIRCLE:"createCircle"},E=t.extend({name:"DS/2DAnnotation/components/ImageEditor",_logger:null,commands:{},elements:{},canvas:null,init:function(){T.start(this.name+" init"),this._logger=i.getLogger(this.name);var e=o.createElement("canvas");this.commands={},this.commands[f.FREE_DRAWING]=new u({imageEditor:this}),this.commands[f.HIGHLIGHT]=new v({imageEditor:this}),this.commands[f.TEXT]=new h({imageEditor:this}),this.commands[f.LINE]=new c({imageEditor:this}),this.commands[f.ARROW]=new l({imageEditor:this}),this.commands[f.RECTANGLE]=new d({imageEditor:this}),this.commands[f.CIRCLE]=new s({imageEditor:this}),this.activeCommand="",this.elements={container:e},this.centeringDev=null,this.canvas=null,T.end(this.name+" init")},load:function(t){var a=this;return new e(function(e){var i,n,r;if(a.canvas&&a.canvas.dispose(),t){var l=o.createElement("div",{class:"annotation-canvas-centering"});l.inject(t),a.centeringDev=l,a.elements.container.inject(l);var s=t.getSize();n=s.width,r=s.height}i=new p.Canvas(a.elements.container,{width:a.defaultWidth||n,height:a.defaultHeight||r,containerClass:"annotation-canvas-container"}),a.centeringDev&&(a.centeringDev.setStyle("min-width",a.defaultWidth||n),a.centeringDev.setStyle("min-height",a.defaultHeight||r)),a.canvas=i,e(a)})},destroy:function(){this.canvas.dispose(),this.canvas=null,this.commands={},this.elements.container.empty(),this.elements.container.destroy(),this.elements={container:null}},openURL:function(t){var o=this;return new e(function(e,a){r.authenticatedRequest(t,{method:"GET",responseType:"blob",onComplete:function(t){o.loadFile(t).then(e).catch(a)},onFailure:a})})},openFile:function(){var e=this;return g.uploadImages(!1).then(function(t){return e.loadFile(t[0])})},loadFile:function(e){var t=this;return g.readImageURI(e).then(function(e){return t.loadURI(e)})},loadURI:function(t){var o=this;return new e(function(e,a){p.util.loadImage(t,function(t){if(t){o.canvas.clear(),o.bgImage=t.src;var i=new p.Image(t);o.canvas.setBackgroundImage(i,function(){o.canvas.setWidth(t.width),o.canvas.setHeight(t.height),o.canvas.renderAll(),e()},{originX:"left",originY:"top"}),o.centeringDev&&(o.centeringDev.setStyle("min-width",t.width),o.centeringDev.setStyle("min-height",t.height))}else a(new Error("error during image loading."))})})},insertImage:function(){var t=this;return g.uploadImages(!1).then(function(e){return g.readImageURI(e[0])}).then(function(o){return new e(function(e,a){p.util.loadImage(o,function(e){if(e){var o=new p.Image(e,{left:t.canvas.width/2-e.width/2,top:t.canvas.height/2-e.height/2});t.canvas.add(o),t.canvas.renderAll()}else a(new Error("error during image loading."))})})})},capture:function(e,t){var o=this;return o.utils.capture(e).then(function(e){return o.loadURI(e.dataURL,t)})},save:function(){if(this.canvas){var e={dataURL:null,blob:null};return e.dataURL=this.canvas.toDataURL("image/jpeg"),e.blob=this.utils.b64toBlob(e.dataURL),e}throw new Error("canvas not instantiated")},download:function(e){var t,a=this.save();e?t=e:t=(t=(new Date).toLocaleString().replace(",","")+".png").replace(/\s/g,"_");if(window.navigator.msSaveBlob)window.URL.createObjectURL(a.blob),window.navigator.msSaveBlob(a.blob,t);else{var i=o.createElement("a",{id:"download-image"});i.setAttribute("download",t),i.href=a.dataURL;var n=document.createEvent("MouseEvents");n.initEvent("click",!1,!0),i.dispatchEvent(n)}},clear:function(){var t=this;return new e(function(e,o){t.canvas?(t.canvas.clear(),t.bgImage?t.canvas.setBackgroundImage(t.bgImage,function(){t.canvas.renderAll(),e()},{originX:"left",originY:"top"}):e()):o(new Error("canvas not instantiated"))})},selectAll:function(){var e=this.canvas.getObjects().map(function(e){return e.set("active",!0)}),t=new p.Group(e,{originX:"center",originY:"center"});this.canvas._activeObject=null,this.canvas.setActiveGroup(t.setCoords()).renderAll()},getCommand:function(e){var t=null;return e in this.commands&&(t=this.commands[e]),t},startCommand:function(e,t){return this.activeCommand in this.commands&&(this.commands[this.activeCommand].end(),this.activeCommand=""),e in this.commands&&(this.commands[e].start(t),this.activeCommand=e),this},stopCommand:function(){return this.activeCommand in this.commands&&(this.commands[this.activeCommand].end(),this.activeCommand=""),this},click:function(e){var t=0,o=0;e&&(t=e.x||0,o=e.y||0),this.canvas.upperCanvasEl.dispatchEvent(new MouseEvent("mousedown",{clientX:t,clientY:o})),document.dispatchEvent(new MouseEvent("mouseup",{clientX:t,clientY:o}))},utils:{hexToRGBA:function(e,t){var o,a;if(/^#([A-Fa-f0-9]{3}){1,2}$/.test(e))return 3===(o=e.substring(1).split("")).length&&(o=[o[0],o[0],o[1],o[1],o[2],o[2]]),a=null==t?0:t,"rgba("+[(o="0x"+o.join(""))>>16&255,o>>8&255,255&o].join(",")+","+a+")";throw new Error("Bad Hex")},RGBAtoHex:function(e){var t={};if(e.startsWith("rgba(")){var o=function(e){return e.replace(/^\s+|\s+$/gm,"")},a=e.substring(e.indexOf("(")).split(","),i=parseInt(o(a[0].substring(1)),10),n=parseInt(o(a[1]),10),r=parseInt(o(a[2]),10),l=parseFloat(o(a[3].substring(0,a[3].length-1)));t.hex="#"+i.toString(16).padStart(2,"0")+n.toString(16).padStart(2,"0")+r.toString(16).padStart(2,"0"),t.opacity=l}else e.startsWith("#")&&(t.hex=e);return t},b64toBlob:function(e){for(var t=atob(e.split(",")[1]),o=new ArrayBuffer(t.length),a=new Uint8Array(o),i=0;i<t.length;i++)a[i]=t.charCodeAt(i);return new Blob([o],{type:"image/jpeg"})},capture:function(t,a){var i,r=this;return(i=a||{timeout:100}).scale=1,new e(function(e){var a=null,l=!1;if(o.is(t.getContext,"function")&&(a=t.getContext("2d"),l=!0),l&&null===a){var s=m.get("pad3DViewer"),c=r.computeImage(s,t),d={canvas:c,dataURL:c.toDataURL("image/jpeg"),blob:null};d.blob=r.b64toBlob(d.dataURL),e(d)}else{(new n).htmlToCanvas(t,i,function(t){var o={canvas:t,dataURL:t.toDataURL("image/jpeg"),blob:null};o.blob=r.b64toBlob(o.dataURL),e(o)})}})},computeImage:function(e,t){var o=e.getViewer(),a=t.width,i=t.height,n={data:null,width:a,height:i},r=document.createElement("canvas");r.width=a,r.height=i,o.renderToTarget(n,e.getViewpoint());var l,s,c,d,h=r.getContext("2d"),u=h.getImageData(0,0,r.width,r.height),v=(n.width-1)/(u.width-1),g=(n.height-1)/(u.height-1),m=n.data,T=u.data;if(1===v&&1===g){var p=u.height,f=4*u.width;for(s=0;s<p;s++)for(c=f*s,d=f*(p-s),l=f;l--;)T[c+l]=m[d+l]}else{var E=function(e,t,o,a,i){return i&&(t=a-t),o*t+e},C=u.height,O=u.width,S=n.height,b=n.width;for(s=0;s<C;s++){var w=Math.floor(g*s);for(l=0;l<O;l++)c=4*E(l,s,O,C),d=4*E(Math.floor(v*l),w,b,S,!0),T[c]=m[d],T[c+1]=m[d+1],T[c+2]=m[d+2],T[c+3]=m[d+3]}}return h.putImageData(u,0,0,0,0,r.width,r.height),r}}});return E.utils=E.prototype.utils,E}),define("DS/2DAnnotation/2DAnnotation",["UWA/Class/View","UWA/Core","UWA/Promise","DS/Logger/Logger","DS/UIKIT/Mask","DS/Windows/ImmersiveFrame","DS/2DAnnotation/views/Toolbar","DS/2DAnnotation/views/Workspace","DS/2DAnnotation/components/ImageEditor","DS/IssueServices/utils/Performance","DS/IssueServices/Contexts","i18n!DS/2DAnnotation/assets/nls/2DAnnotation","css!DS/2DAnnotation/2DAnnotation.css"],function(e,t,o,a,i,n,r,l,s,c,d){"use strict";var h="ENX3DIR_AP";return e.extend({name:"DS/2DAnnotation/2DAnnotation",tagName:"div",className:"annotation-container",isLoaded:null,_deferred:{resolve:null,reject:null},_logger:null,setup:function(e){c.start(this.name+" setup"),this._parent(e),this._logger=a.getLogger(this.name),this.callbacks={saveCallback:e.saveCallback,exitCallback:e.exitCallback},this.imageEditor=new s({}),e.hasOwnProperty("defaultDimensions")&&(t.is(e.defaultDimensions.width,"number")&&(this.imageEditor.defaultWidth=e.defaultDimensions.width),t.is(e.defaultDimensions.height,"number")&&(this.imageEditor.defaultHeight=e.defaultDimensions.height)),this.immersiveFrame=new n,this.immersiveFrame.elements.container.addClassName("annotation-frame-container"),this.workspace=new l({}),this.toolbar=new r(this.immersiveFrame,this.imageEditor,this.callbacks),this.imageURL=e.imageURL,this.captureTarget=e.captureTarget,c.end(this.name+" setup")},render:function(){var e=this;return c.start(e.name+" render"),e.isLoaded=new o(function(t,o){e._deferred.resolve=t,e._deferred.reject=o}),i.mask(e.container),e.imageEditor.load(e.workspace.container).then(function(){var t;return e.imageURL?t=e.openURL(e.imageURL,e.workspace.container):e.captureTarget&&(t=e.capture(e.captureTarget,e.workspace.container)),t}).then(function(){e.immersiveFrame.inject(e.container),e.workspace.render().inject(e.immersiveFrame.getFreeZone()),e.toolbar.render().listen(),e._managePADStatusBarDisplay(!1),i.unmask(e.container),e._deferred.resolve(),c.end(e.name+" render")}).catch(e._deferred.reject),e._addEventListeners(),e},capture:function(e){return this.imageEditor.capture(e,this.workspace.container)},openURL:function(e){return this.imageEditor.openURL(e,this.workspace.container)},destroy:function(){this._managePADStatusBarDisplay(!0),this.imageEditor.destroy(),this.imageEditor=null,this.immersiveFrame.destroy(),this.immersiveFrame=null,this.workspace.destroy(),this.workspace=null,this.toolbar.destroy(),this.toolbar=null,this.container.empty(),this.container.destroy()},_managePADStatusBarDisplay:function(e){var t=d.get("widget");if(t&&t.name===h){var o=d.get("pad3DViewer");o&&o.displayStatusBar(e)}},_addEventListeners:function(){var e=this;e.listenTo(e,"onAddNewObject",function(t){var o=t.data;if(e.toolbar._onToolSelected(o.tool,null,o.options),e.imageEditor.click(),o.select){e.toolbar._onToolSelected("select");var a=e.imageEditor.canvas.getObjects();a&&a[a.length-1]&&e.imageEditor.canvas.setActiveObject(a[a.length-1])}})}})});