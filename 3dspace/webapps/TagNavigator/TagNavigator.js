define("DS/TagNavigator/TaggerTrackerApi",["UWA/Core","UWA/Class","UWA/Class/Debug","UWA/Class/Options","DS/Usage/TrackerAPI","DS/MessageBus/MessageBus"],function(e,t,i,a,n,r){"use strict";return t.singleton(i,a,{tracker:null,messageBus:null,set:function(){this.messageBus=r.subscribe({channel:"TaggerTrackerApi",topic:"hit",callback:this._track.bind(this)})},register:function(e){n.registerData(e)},_track:function(t){if(console.count(t.action),e.is(t)){var i={eventCategory:e.is(t.category)?t.category:"6WTagger",eventAction:e.is(t.action)?t.action:"actions",persDim:e.is(t.persDim)?t.persDim:{},persVal:e.is(t.persVal)?t.persVal:{}};n.trackPageEvent(i)}}})}),define("DS/TagNavigator/Logger",[],function(){"use strict";return new function(e){var t,i,a,n,r,s;function o(e){return function(){if(i)if(a.console){if(window.update_tn_snackbar&&window.update_tn_snackbar.apply(null,[arguments,1]),"function"==typeof a.console[e])return a.console[e].apply(a.console,Array.prototype.slice.call(arguments));if("function"!=typeof a.console[e]&&"object"==typeof a.console[e]&&"debug"!==e)return a.console[e](Array.prototype.slice.call(arguments))}else if(a.opera&&"function"==typeof a.opera.postError)return a.opera.postError.apply(null,Array.prototype.slice.call(arguments))}}for("boolean"!=typeof e&&(e=!1),i=e,a=window||global||{},this.disable=function(){return i=!1,this},this.enable=function(){return i=!0,this},n=0,r=(s=["log","info","warn","error","debug","group","groupEnd"]).length;n<r;n++)this[t=s[n]]=o(t)}(-1!==location.search.indexOf("TNLogs"))}),define("DS/TagNavigator/simplified/model/TagValueWrapper",[],function(){"use strict";return{getWrapper:function(e){return{pred:e.pred,count:0,type:e.type,uri:e.uri,icon:e.icon,displayValue:e.displayValue,embeddedPred:e.embeddedPred,embeddedTags:e.embeddedTags,getUri:function(){return e.getUri()},getDisplayValue:function(){return e.getDisplayValue()},getCount:function(){return this.count},setEmbeddedSixW:function(e){this.embeddedPred=e},setEmbeddedTagValues:function(e){this.embeddedTags=e}}},getWrapperFromTagInfo:function(e){return{pred:e.sixw,count:e.count,type:e.type,uri:e.object,icon:e.icon,displayValue:e.dispValue||e.object,getCount:function(){return this.count}}}}}),define("DS/TagNavigator/TaggerSettings",["UWA/Core","UWA/Class","UWA/Class/Options","text!DS/TagNavigator/assets/TaggerSettings.json"],function(e,t,i,a){"use strict";return t.singleton(i,{_authorized_json_settings:{authorized_beta_users:!0,controlledVocabularies:!0,editTagsPredicateOperators:!0},init:function(){var e;try{e=JSON.parse(a)}catch(t){console.error("FAILED to parse TaggerSettings.json, message="+t.message),e={}}this.setOptions(e)},urlSettings:function(e){if(UWA.is(e,"object"))for(var t in e){var i=e[t];if(UWA.is(i,"string"))if("false"==i.toLowerCase())i=!1;else if("true"==i.toLowerCase())i=!0;else if(this._authorized_json_settings[t]){var a=decodeURIComponent(i);try{i=JSON.parse(a)}catch(e){}}this.setOption(t,i)}},isAuthorizedBetaUser:function(e){var t=!1;if(e){var i=this.getOption("authorized_beta_users");UWA.is(i,"array")&&(t=-1!==i.indexOf(e.toUpperCase()))}return t},getAgentAsMobile:function(){return this.getOption("mobileUserAgent")},enableMobileTypeCode:function(){return this.getOption("enableMobileTypeCode")},isFromToDateAvailable:function(){return this.getOption("fromToDate")},searchOnType:function(){return this.getOption("searchOnUserType")},showDateTiles:function(){return this.getOption("showSelectedDates")}})}),define("DS/TagNavigator/NotificationManager",["UWA/Class","UWA/Class/Events"],function(e,t){"use strict";return e.singleton(t,{init:function(){this._notificationsQueue={}},push:function(e){return e.type&&(this._notificationsQueue[e.type]||(this._notificationsQueue[e.type]=[]),this._notificationsQueue[e.type].push(e)),this},dispatch:function(e){var t,i,a,n,r,s=[],o={},l=this;return n=Object.keys(this._notificationsQueue),e&&n.forEach(function(e){if(t=l._notificationsQueue[e],(a=t[0]).mergeWidth){for(i=1;i<t.length;i++)a.mergeWidth(t[i]);l._notificationsQueue[e]=[a]}}),n.forEach(function(e){for(t=l._notificationsQueue[e],i=0;i<t.length;i++)r=t[i].message.format(t[i].data),t[i].message=r,t[i].data=t[i].data||{className:"error"},t[i].data.className=t[i].data.className||"error",o[r]||(s.push(t[i]),o[r]=!0);l.dispatchEvent("notify",s),o={},s=[]}),this._notificationsQueue={},this}})}),define("DS/TagNavigator/simplified/model/CriteriaModel",["UWA/Core","UWA/Class/Model","UWA/Class/Debug","UWA/Class/Collection"],function(e,t,i,a){"use strict";var n=t.extend(i,{idAttribute:"criteriaId",defaults:{criteriaId:"",title:"",level:0,expandStatus:!1,count:0,iconClass:"",isOther:!1,isComposite:!1,isContainer:!1,rootIconClass:""},setup:function(){this._parent()},getCount:function(){return this.isComposite()?this.get("count")+this.get("subCategories").reduce(function(e,t){return e+t.get("count")},0):this.get("count")},getSubCategory:function(e){return this.get("subCategories").get(e)},addSubCategory:function(e){this.get("subCategories").add(e)},setAsComposite:function(){var e=this.get("subCategories");return e||(e=new a([],{model:n}),this.set("subCategories",e),this.set("isComposite",!0)),e},isComposite:function(){return this.get("isComposite")},setAsContainer:function(){this.set("subCategories",new a([],{model:n})),this.set("isContainer",!0)},isContainer:function(){return this.get("isContainer")},updateCount:function(e){this.set("count",this.get("count")+e)},getSelectedSubCategories:function(e){this.get("subCategories").forEach(function(t){if(!0===t.get("selected"))e.push(t);else if(t.isContainer())return t.getSelectedSubCategories(e)})},getRefineStructure:function(e){var t=[];if(this.isComposite())t.push(this._getCompositeRefineStructure());else if(this.isContainer())if(e){var i=this.get("predicate");t.push({predicate:i?i.getFullPredicateID():"ds6w:what/ds6w:type",object:[],dispValue:this.get("title"),type:i?i.getType():"string",isComposite:!0});for(var a=this.get("subCategories"),n=0;n<a.length;n++){a.at(n).getRefineStructure(e).forEach(function(e){UWA.is(e.object,"array")?t[0].object=t[0].object.concat(e.object):t[0].object.push(e.object)})}}else this.get("subCategories").forEach(function(i){t=t.concat(i.getRefineStructure(e))});else{i=this.get("predicate");t.push({predicate:i.getFullPredicateID(),object:this.get("criteriaId"),dispValue:this.get("title"),type:i.getType()})}return t},_getCompositeRefineStructure:function(){var e=this.get("predicate"),t={predicate:e.getFullPredicateID(),object:[this.get("criteriaId")],dispValue:this.get("title"),type:e.getType(),isComposite:!0};return this.get("subCategories").forEach(function(e){t.object.push(e.get("criteriaId"))}),t}});return n}),define("DS/TagNavigator/simplified/views/SimplifiedTaggerRootWArea",["UWA/Core","UWA/Class/View","text!DS/TagNavigator/assets/templates/SimplifiedTaggerRootWArea.html","DS/Handlebars/Handlebars","DS/UIKIT/Scroller"],function(e,t,i,a,n){"use strict";return t.extend({tagName:"nav",className:"root-w-nav-container",template:a.compile(i),domEvents:{"click a":"clickRootW"},init:function(e){this._parent(e)},setup:function(e){this._parent(e)},render:function(){var e=this.template();this.container.setContent(e),this.taggerView=this.getOption("taggerView");var t=this.taggerView.getActiveRootW();t&&this.enableAllWSelection(t),this.scrollerForWArea=new n({element:this.container});return this.enableGradient(),this.container.addEventListener("mouseenter",this.disableGradient.bind(this)),this.container.addEventListener("mouseleave",this.enableGradient.bind(this)),this},enableAllWSelection:function(e){var t=this;e.forEach(function(e){var i=e.replace("ds6w:","");t.getElement("#root-w-"+i).addClassName("active")}),this.taggerView._simplifiedSelectedRootWs=e,this.taggerView._simplifiedSelectedRootWs.length==this.taggerView.getRootWs().length&&this.container.addClassName("all-w-active")},clickRootW:function(e){var t=this,i=e.target.getClosest("a"),a=i.getAttribute("predicate");i.hasClassName("active")?1==this.taggerView._simplifiedSelectedRootWs.length?this.enableAllWSelection(this.taggerView.getRootWs()):this.taggerView._simplifiedSelectedRootWs.length==this.taggerView.getRootWs().length?(this.taggerView._simplifiedSelectedRootWs.filter(function(e){if(e!=a){var i=e.replace("ds6w:","");t.getElement("#root-w-"+i).removeClassName("active")}}),this.taggerView._simplifiedSelectedRootWs=[a]):(i.removeClassName("active"),this.taggerView._simplifiedSelectedRootWs=this.taggerView._simplifiedSelectedRootWs.filter(function(e){return e!=a})):(i.addClassName("active"),this.taggerView._simplifiedSelectedRootWs.push(a)),this.taggerView._simplifiedSelectedRootWs.length==this.taggerView.getRootWs().length?this.container.addClassName("all-w-active"):this.container.removeClassName("all-w-active"),this.dispatchEvent("onRootWSelection",a.replace("ds6w:",""))},disableGradient:function(){this.container.addClassName("no-after"),this.container.addClassName("no-before")},enableGradient:function(){document.body.clientWidth>639&&document.body.clientWidth<1e3?(this.container.removeClassName("no-after"),this.container.removeClassName("no-before")):this.disableGradient()},addOpacity:function(){this.container.toggleClassName("add-opacity",!0)},destroy:function(){this.stopListening(),this.model=null,this._parent()}})}),define("DS/TagNavigator/simplified/model/OntologyConcept",["UWA/Core","UWA/Class/Debug","UWA/Class/Model","UWA/Class/Collection"],function(e,t,i,a){"use strict";var n=i.extend(t,{setup:function(e){this.set("narrower",new a([],{model:n})),this.set("broader",new a([],{model:n}));let t=e.id.split(":");t.length>0&&this.set("ontology",t[0]+":")},getLabel:function(){return this.get("label")},getURI:function(){return this.id},getOntology:function(){return this.get("ontology")},setAsRootWConcept:function(){this.set("isRootWConcept",!0)},setAsRootConcept:function(){this.set("isRootConcept",!0)},IsARootConcept:function(){return this.get("isRootConcept")},getURIPath:function(){let e=[],t=this;for(;t;)e.push(t.getURI()),t=t.getBroaderConcept();return e.reverse()},getRootConcept:function(){let e,t;for(;Array.isArray(e=this.getBroaderConcept())&&e.length>0;)t=e,e[0].getRootConcept();if(t)return t[0].getURI()},getRootW:function(){return this.get("rootW")},getBroaderConcepts:function(){return this.get("broader")},_addBroaderConcept:function(e){this.get("broader").add(e)},addNarrowerConcept:function(e){this.get("narrower").add(e),e._addBroaderConcept(this)},getNarrowerConcepts:function(){return this.get("narrower").toArray()},setAsTaggable:function(){this.set("taggable",!0)},canBeTagged:function(){return this.get("taggable")}});return n}),define("DS/TagNavigator/simplified/model/TagValueModel",["UWA/Core","UWA/Class/Debug","UWA/Class/Model"],function(e,t,i){"use strict";return i.extend(t,{defaults:{tagValue:void 0,title:void 0,count:void 0,iconClass:void 0,imageURL:void 0},setup:function(e){var t=e.tagValue;this.set("title",t.getDisplayValue()),this.set("count",e.proxy.getNbSubjectsForTagValue(t));var i=t.icon;i&&(i.match(/fonticon-*/)?this.set("iconClass",i):this.set("imageURL",i))},getPredicate:function(){return this.get("tagValue").pred}})}),define("DS/TagNavigator/simplified/actions/ActionUtils",["UWA/Core"],function(e){"use strict";return{ACTION_SELECT:"select",ACTION_GROUP:"group",ACTION_EXCLUDE:"exclude",ACTION_EDITTAGREL:"editTagsSelect",ACTION_SELECTINAPP:"selectInApp",ACTION_COLORIZE:"colorize",onTagMultiSelection:function(e,t){if(-1!==e.id.indexOf("atv"))return!1;if(e.hasClassName("picked"))e.removeClassName("picked"),t.splice(t.indexOf(e.id),1);else{var i=e.getParent();if(e.getParents(".date").length){var a=i.getElement(".picked");a&&(a.removeClassName("picked"),t.splice(t.indexOf(a.id),1))}e.addClassName("picked"),t.push(e.id)}return!1},getChildTag:function(e,t){var i=e.getChildren().filter(function(e){return e.hasClassName("childrenTags")})[0].getElement(".tags-list"),a=i.getChildren().filter(function(e){return e.hasClassName("treeTags")});if(a.length>0){var n=a.filter(function(e){return e.getElement(".tag").getElement(".tag-label").getText()===t});if(n&&n.length>0)return n[0]}return i.getChildren().filter(function(e){return e.hasClassName("tag")}).filter(function(e){return e.getElement(".tag-label").getText()==t})[0]}}}),define("DS/TagNavigator/simplified/actions/AbstractAction",["UWA/Core","UWA/Class/Model","UWA/Class/Debug"],function(e,t,i){"use strict";return t.extend(i,{defaults:{actionClass:"selected",selectionCount:0},setup:function(e){this._parent(e)},onPredicateSelection:function(e){},onTagSelection:function(e){},getSelectionCount:function(){return this._selection.reduce(function(e,t){return UWA.is(t,"object")&&t.doNotCount?e:++e},0)},getTaggerView:function(){var e=this.get("taggerView");if(e)return e()},getNavImpl:function(){return this.getTaggerView().getObservedNavigator()},getPredicateElement:function(e){return this.getTaggerView().container.getElement(".tags-container").getElement("li[predicate='"+e+"']")}})}),define("DS/TagNavigator/ColorManager",["UWA/Core"],function(e){"use strict";function t(){this.colors=["#FEE000","#009DDB","#FF8A2E","#9B2C98","#00AA86","#F564A3","#8DDEE4","#CC092F","#E2D5CC","#6FBC4B","#70036B","#002596","#C6C68B","#7F7F7F","#4EA8B7","#007A4C","#4D62BA","#127277","#6D2815","#000000","#ADADAD"],this.activePredicate=null,this.counter={},this.colorMap={},this.computedColorMap={},this.colorByTv={},this.shading={},this.forbiddenColors={},this.coloredTreeTagList=[],this.adminColorMap={},this.assignedColors=[],this.unassignedColors=e.clone(this.colors),this.computedPartialColorMap={},this.partialColorize={},this.inColorization=null}return t.prototype={isColorized:function(e){return this.activePredicate===e},toggleColorize:function(e){this.activePredicate=this.activePredicate===e?void 0:e,this.partialColorize&&!this.activePredicate&&(this.removeColorByTv(),this.partialColorize=void 0,this.computedPartialColorMap={})},colorizePredicate:function(e){this.activePredicate=e,this.partialColorize||(this.partialColorize={}),this.inColorization=void 0},inColorizePredicate:function(e){this.inColorization=e},isInColorization:function(e){return this.inColorization==e},unColorizePredicate:function(e){this.activePredicate==e&&(this.activePredicate=void 0,this.partialColorize=void 0)},getComputedMap:function(e){return this.computedPartialColorMap&&this.computedPartialColorMap[e]?this.computedPartialColorMap[e]:this.computedColorMap[e]},clearComputedColorMap:function(e){if(!this.adminColorMap[e]&&(delete this.computedColorMap[e],delete this.counter[e],delete this.colorByTv[e],delete this.forbiddenColors[e],this.colorMap[e])){var t={};t[e]=this.colorMap[e],this.setColorMap(t)}},clearComputedPartialColorMap:function(e){this.computedPartialColorMap={}},_prioritizeColorsForPredicate:function(t,i){if(t){if(i){for(var a in this.adminColorMap=this.adminColorMap||{},t)t[a].length>0?this.adminColorMap[a]?delete t[a]:this.colorMap[a]&&(delete this.colorMap[a],delete this.counter[a],delete this.forbiddenColors[a]):delete t[a];this.adminColorMap=e.merge(this.adminColorMap,t)}else{for(var a in this.colorMap=this.colorMap||{},this.adminColorMap)t[a]&&delete t[a];this.colorMap=e.merge(t,this.colorMap)}var n,r,s;for(s in t)for(i||(delete this.counter[s],delete this.forbiddenColors[s]),delete this.colorByTv[s],this.computedColorMap[s]={},this.computedColorMap[s].tagColors=[],this.colorByTv[s]={},n=0;n<t[s].length;n++)(r=t[s][n]).predicate=s,this.computedColorMap[s].tagColors.push(r),this.colorByTv[s][r.object]=r.color,i||-1===this.colors.indexOf(r.color)||(this.forbiddenColors[s]=this.forbiddenColors[s]||[],this.forbiddenColors[s].push(this.colors.indexOf(r.color)))}},updateAdminColors:function(e){if(UWA.is(e,"array"))for(var t of e)this.setAdminColorMap(t)},setAdminColorMap:function(e){e&&this._prioritizeColorsForPredicate(e,!0)},setColorMap:function(e){e&&this._prioritizeColorsForPredicate(e,!1)},getColor:function(e,t){if(this.adminColorMap[t])e=this.colors.length-1;else{for(;this.forbiddenColors[t]&&-1!==this.forbiddenColors[t].indexOf(e);)e=this.counter[t]++;e=e<this.colors.length?e:this.colors.length-1}return this.colors[e]||null},getColorIndex:function(e){return this.counter[e]=this.counter[e]||0,this.counter[e]},getShading:function(e){return this.shading[e]=this.shading[e]||[],this.shading[e]},getCurrentColor:function(e){return this.getColor(this.getColorIndex(e),e)},getUnassignedColor:function(e){if(this.unassignedColors.length)return this.unassignedColors[0];{let e=this.colors.length-1;return this.colors[e]||null}},_addToMap:function(e,t,i){var a=JSON.parse(e.getSelectedTagId());a.color=t;var n=e.getPredicateView()._predicate.getFullPredicateID();i?(this.computedPartialColorMap[n]||(this.computedPartialColorMap[n]={},this.computedPartialColorMap[n].tagColors=[]),this.computedPartialColorMap[n].tagColors.push(a)):(this.computedColorMap[n]||(this.computedColorMap[n]={},this.computedColorMap[n].tagColors=[]),this.computedColorMap[n].tagColors.push(a)),this.colorByTv[n]||(this.colorByTv[n]={}),this.colorByTv[n][e.id()]=t},_removeFromMap:function(e,t){var i=e.getPredicateView()._predicate.getFullPredicateID();if(this.computedPartialColorMap[i]){let e=this.computedPartialColorMap[i].tagColors;this.computedPartialColorMap[i].tagColors.forEach((i,a)=>{i.color==t&&e.splice(a,1)})}this._checkAlreadyDefinedColor(e.id(),i)||delete this.colorByTv[i][e.id()]},_addToTempTreeMap:function(e,t){var i=JSON.parse(e.getSelectedTagId());i.color=t,this.coloredTreeTagList.push(i);var a=e.getPredicateView()._predicate.getFullPredicateID();this.colorByTv[a][e.id()]=t},_clearTempTreeMap:function(){this.coloredTreeTagList=[],this.shading={}},_checkDisplayValue:function(t,i){var a=t.getPredicateView()._predicate.getFullPredicateID();let n=this.computedColorMap;(i||this.partialColorize&&this.partialColorize[a])&&(n=this.computedPartialColorMap);let r=-1,s=0;var{object:o,dispValue:l}=JSON.parse(t.getSelectedTagId());let c;if(e.is(o,"string")?c=((e,t)=>e===t.object):e.is(o,"array")&&(c=((e,t)=>-1!==e.indexOf(t.object))),this.computedColorMap.hasOwnProperty(a)&&i){let t=this;this.computedColorMap[a].tagColors.forEach((i,n)=>{if(e.is(o,"array")&&-1!==o.indexOf(i.object)||e.is(o,"string")&&o===i.object)if(t.computedPartialColorMap.hasOwnProperty(a)){let e=!1;t.computedPartialColorMap[a].tagColors.forEach((t,a)=>{t.object==i.object&&(e=!0)}),e||t.computedPartialColorMap[a].tagColors.push(i)}else t.computedPartialColorMap[a]={},t.computedPartialColorMap[a].tagColors=[],t.computedPartialColorMap[a].tagColors.push(i)})}for(var d of n[a].tagColors){if(c&&c(o,d)){r=s;break}++s}-1==r||n[a].tagColors[r].dispValue||(n[a].tagColors[r].dispValue=l)},resetColorForTagValue:function(e){var t,i=e.getPredicateView()._predicate.getFullPredicateID();if(t=this.colorByTv[i]?this.colorByTv[i][e.id()]:null,this.partialColorize&&this.partialColorize[i]&&this.partialColorize[i][e.id()]&&delete this.partialColorize[i][e.id()],!this._checkAlreadyDefinedColor(e.id(),i)){let e=this.assignedColors.findIndex(e=>e==t);e>=0&&(this.assignedColors.splice(e,1),this.unassignedColors.unshift(t))}return null===t&&void 0===t||this._removeFromMap(e,t),t},getNewColorForTagValue:function(t,i,a){var n=null,r=t.getPredicateView()._predicate.getFullPredicateID();if(i||!this.partialColorize||!this.partialColorize[r]||this.partialColorize[r][t.id()]){if(n=this.colorByTv[r]?this.colorByTv[r][t.id()]:null)this._checkDisplayValue(t,i);else{if(Object.getPrototypeOf(t.getMotherView())===Object.getPrototypeOf(t)&&"tree"===t.type()||i||(n=this.getCurrentColor(r)),i){(!this.partialColorize||this.partialColorize&&!this.partialColorize[r])&&(this.unassignedColors=e.clone(this.colors),this.assignedColors=[]),n=a&&a.onCancel&&a.color?a.color:this.getUnassignedColor();let t=this.unassignedColors.findIndex(e=>e==n);this.unassignedColors.splice(t,1),this.assignedColors.push(n)}n&&(this._addToMap(t,n,i),this.counter[r]++)}return i&&(this.partialColorize=this.partialColorize||{},this.partialColorize[r]=this.partialColorize[r]||{},this.partialColorize[r][t.id()]||(this.partialColorize[r][t.id()]=!0)),n}},_addToPersonMap:function(e,t,i){var a={dispValue:e.displayValue,object:e.uri,predicate:e.pred.getFullPredicateID(),type:e.type};a.color=t;var n=e.pred.getFullPredicateID();i?(this.computedPartialColorMap[n]||(this.computedPartialColorMap[n]={},this.computedPartialColorMap[n].tagColors=[]),this.computedPartialColorMap[n].tagColors.push(a)):(this.computedColorMap[n]||(this.computedColorMap[n]={},this.computedColorMap[n].tagColors=[]),this.computedColorMap[n].tagColors.push(a)),this.colorByTv[n]||(this.colorByTv[n]={}),this.colorByTv[n][e.uri]=t},_removeFromPersonMap:function(e,t){var i=e.pred.getFullPredicateID();if(this.computedPartialColorMap[i]){let e=this.computedPartialColorMap[i].tagColors.findIndex(e=>e.color===t);this.computedPartialColorMap[i].tagColors.splice(e,1)}this._checkAlreadyDefinedColor(e.uri,i,!0)||delete this.colorByTv[i][e.uri]},resetColorForPersonTagValue:function(e){var t,i=e.pred.getFullPredicateID();if(t=this.colorByTv[i]?this.colorByTv[i][e.uri]:null,this.partialColorize&&this.partialColorize[i]&&this.partialColorize[i][e.uri]&&delete this.partialColorize[i][e.uri],!this._checkAlreadyDefinedColor(e.uri,i,!0)){let e=this.assignedColors.findIndex(e=>e==t);e>=0&&(this.assignedColors.splice(e,1),this.unassignedColors.unshift(t))}return null===t&&void 0===t||this._removeFromPersonMap(e,t),t},getColorForTagValue:function(t,i,a){var n=null,r=t.pred.getFullPredicateID();if(i||!this.partialColorize||!this.partialColorize[r]||this.partialColorize[r][t.uri]){if(n=this.colorByTv[r]?this.colorByTv[r][t.uri]:null){let e=t.uri;if(this.computedColorMap.hasOwnProperty(r)&&i){let t=this;this.computedColorMap[r].tagColors.forEach((i,a)=>{if(e==i.object)if(t.computedPartialColorMap.hasOwnProperty(r)){let e=!1;t.computedPartialColorMap[r].tagColors.forEach((t,a)=>{t.object==i.object&&(e=!0)}),e||t.computedPartialColorMap[r].tagColors.push(i)}else t.computedPartialColorMap[r]={},t.computedPartialColorMap[r].tagColors=[],t.computedPartialColorMap[r].tagColors.push(i)})}}else{(!this.partialColorize||this.partialColorize&&!this.partialColorize[r])&&(this.unassignedColors=e.clone(this.colors),this.assignedColors=[]),n=a&&a.onCancel&&a.color?a.color:this.getUnassignedColor();let s=this.unassignedColors.findIndex(e=>e==n);this.unassignedColors.splice(s,1),this.assignedColors.unshift(n),n&&(this._addToPersonMap(t,n,i),this.counter[r]++)}return i&&(this.partialColorize=this.partialColorize||{},this.partialColorize[r]=this.partialColorize[r]||{},this.partialColorize[r][t.uri]||(this.partialColorize[r][t.uri]=!0)),n}},addToColoredTreeTagList:function(e){var i,a,n=e.getPredicateView()._predicate.getFullPredicateID();if(Object.getPrototypeOf(e.getMotherView())===Object.getPrototypeOf(e)&&"tree"===e.type()){i=this.colorByTv[n][e.getMotherView().id()];var r=this.getShading(n);void 0===r[i]&&(r[i]=0),r[i]=r[i]+.2,r[i]>.8&&(r[i]=.8),"#e2e4e3"!==(a=t.shadeColor(i,r[i]))&&this._addToTempTreeMap(e,a)}return a},getColoredTreeTagList:function(){return this.coloredTreeTagList},_checkAlreadyDefinedColor:function(e,t){let i=!1;return this.adminColorMap[t]&&this.adminColorMap[t].forEach(t=>{t.object==e&&(i=!0)}),this.colorMap[t]&&this.colorMap[t].forEach(t=>{t.object==e&&(i=!0)}),i},checkForMapObject:function(e,t){let i=this;!this.computedPartialColorMap[e]&&this.computedColorMap[e]&&this.computedColorMap[e].tagColors.forEach(a=>{let n=t.uri?t.uri:t.id();a.object==n&&(i.computedPartialColorMap[e]={tagColors:[]},i.computedPartialColorMap[e].tagColors.push(a))})},removeColorByTv:function(){let e=this;for(let t in this.computedPartialColorMap)this.computedPartialColorMap[t].tagColors.forEach(i=>{e._checkAlreadyDefinedColor(i.object,t)||e.colorByTv[t]&&delete e.colorByTv[t][i.object]})}},t.shadeColor=function(e,t){var i=parseInt(e.slice(1),16),a=t<0?0:255,n=t<0?-1*t:t,r=i>>16,s=i>>8&255,o=255&i;return"#"+(16777216+65536*(Math.round((a-r)*n)+r)+256*(Math.round((a-s)*n)+s)+(Math.round((a-o)*n)+o)).toString(16).slice(1)},t}),define("DS/TagNavigator/Parameter",["UWA/Class/Model","UWA/Core"],function(e,t){"use strict";return e.extend({defaults:{value:"",type:"",interface:"",unit:"",boolVal:[],stringVal:"",intType:[]},setup:function(){this.set({stringVal:"",boolVal:[],intType:[]})}})}),define("DS/TagNavigator/simplified/activeTags/ActiveTagsViewModel",["UWA/Core","UWA/Class/Model","UWA/Class/Debug"],function(e,t,i){"use strict";return t.extend(i,{defaults:{mode:"readOnly",filter:{},emptyFilter:{}},setup:function(e){this._parent(e)}})}),define("DS/TagNavigator/simplified/model/PersonInfo",["UWA/Core","UWA/Class/Debug","UWA/Class/Model"],function(e,t,i){"use strict";return i.extend(t,{defaults:{title:"",imageURL:void 0,country:void 0,countryCode:void 0,city:void 0,color:"",nbMatches:void 0},idAttribute:"title",setup:function(){this.set({imageURL:[],country:[],countryCode:[],city:[],isReady:!1},{silent:!0})},setArrayProperty:function(e,t,i){var a=UWA.clone(this.get(e))||[];return i>-1?a.length>i&&(a[i]=t):a.push(t),this.set(e,a)},incrementNbMatches:function(){var e=this.get("nbMatches")||0;this.set("nbMatches",++e)}})}),define("DS/TagNavigator/simplified/model/FedSearchResultModel",["UWA/Core","UWA/Class/Model","UWA/Class/Debug"],function(e,t,i){"use strict";return t.extend(i,{setup:function(){this._parent()}})}),define("DS/TagNavigator/simplified/model/DateRangeModel",["UWA/Core","UWA/Class/Debug","UWA/Class/Model"],function(e,t,i){"use strict";return i.extend(t,{defaults:{id:"",title:"",count:0,iconClass:"fonticon fonticon-3ds-when",tagValues:[],object:[],from:void 0,to:void 0},getCount:function(){return this.get("count")}})}),define("DS/TagNavigator/Notification",["UWA/Class"],function(e){"use strict";return e.extend({type:"Notification",init:function(e,t){this.message=e,this.data=t}})}),define("DS/TagNavigator/BroadcastchannelSearchManager",["UWA/Class","UWA/Core","UWA/Class/Events","DS/TagNavigator/Logger"],function(e,t,i,a){"use strict";return e.extend(i,{init:function(){this.EmbeddedTaggerView=null,this._BroadcastChannel=null,this._parent()},setup:function(e){a.log("BroadcastchannelSearchManager setup: ",e),this.EmbeddedTaggerView=null,this.EmbeddedTaggerView=e&&e.EmbeddedTaggerView,this._BroadcastChannel&&this._BroadcastChannel.close(),this._BroadcastChannel&&delete this._BroadcastChannel,this._BroadcastChannel=new BroadcastChannel("EmbeddedTaggerViewWebInWinProxy"),this._parent(e)},getBroadcastchannel:function(){return this._BroadcastChannel},postMessage:function(e,i){let n,r=this;if(t.is(r._BroadcastChannel)&&t.is(r.EmbeddedTaggerView)){if(t.is(i))n=i;else{n={type:"refresh_view",message:(new XMLSerializer).serializeToString(r.EmbeddedTaggerView.container)}}r._BroadcastChannel.postMessage(n),a.log("BroadcastchannelSearchManager postMessage from: "+e,n)}},listenBroadcast:function(){let e=this;t.is(e._BroadcastChannel)&&t.is(e.EmbeddedTaggerView)&&(e._BroadcastChannel.onmessage=(i=>{if(a.log("BroadcastchannelSearchManager onmessage: ",i.data),t.is(i)&&t.is(i.data)){const{type:a="",message:n="",item:r="",value:s="",viewid:o=""}=i.data;if("clickOnW"===a)e.EmbeddedTaggerView.onToggleGrouping({id:o});else if("clearRefine"===a)e.EmbeddedTaggerView.embeddedActiveCriteria&&e.EmbeddedTaggerView.embeddedActiveCriteria.clearRefine();else if("clickOnActivecriteria"===a){let i=n.option,a=n.name,r=n.id,s=e.EmbeddedTaggerView.embeddedActiveCriteria.advActiveTags;if(t.is(s)&&t.is(s._listOfActiveTag,"array")){let e,n=s._listOfActiveTag.length;for(let i=0;i<n;i++)e=s._listOfActiveTag[i],t.is(e)&&t.is(e.id)&&e.id===r&&(i=n);t.is(e)&&("remove"===a?(e.filter.removeSelectedTag(i),e.dispatchEvent("removeActiveTag",i),e.destroy()):"exclude"===a?(e.container.removeClassName("canBeExcluded"),e.filter.handleExclude(i,!0),e.dispatchEvent("excludeTag",i)):"unexclude"===a&&(e.container.addClassName("canBeExcluded"),e.filter.handleExclude(i,!1),e.dispatchEvent("unexcludeTag",i)))}}else if("dropDownMenu"===a){let t=e.EmbeddedTaggerView.rootViews.length,i=0;for(;i<t;i++){let a=e.EmbeddedTaggerView.rootViews[i];if(a.rootw===o){let n=a.buildMenuItemsStructure();(a._hasSubMenus()||!a._hasSubMenus()&&a.menuItems.length>7)&&n.unshift({name:"search-field",id:"search-field"});let r=JSON.stringify(n);e._BroadcastChannel.postMessage({type:"dropDownMenu",viewid:o,message:r}),i=t}}}else if("onClickdropDownMenu"===a){let t=JSON.parse(r);t.className="";let i=e.EmbeddedTaggerView.rootViews.length,a=0;for(;a<i;a++){let n=e.EmbeddedTaggerView.rootViews[a];if(n.rootw===o){let e=[],r=function(t){e=e.concat(t),t.forEach((e,t)=>{e.getOption("subMenuItems")&&r(e.getOption("subMenuItems"))})};r(n.menuItems);let s=e.find(e=>e.getOption("identifier")==t.name);s&&s._toggleTagSelection(),a=i}}}else if("onsearchInputkeyup"===a){let t=e.EmbeddedTaggerView.rootViews.length,i=0;for(;i<t;i++){let a=e.EmbeddedTaggerView.rootViews[i];if(a.rootw===o){let n=[],r=a.getFilteredTagsItems(a.menuItems,s,n),l={type:"onsearchInputkeyupFilter",value:s,viewid:o,message:JSON.stringify(r)};e._BroadcastChannel.postMessage(l),i=t}}}}}))},destroy:function(){this._BroadcastChannel.close(),this._BroadcastChannel&&delete this._BroadcastChannel,this._BroadcastChannel=null,this._parent()}})}),define("DS/TagNavigator/TaggerNLS",["DS/TagNavigator/Logger","i18n!DS/TagNavigator/assets/nls/TagNavigator"],function(e,t){"use strict";var i={},a=null,n=null;return i.getLang=function(){return a||"en"},i.setCurrentLanguage=function(t){return null===a&&(t?(e.info("TagNavigator - Setting language to "+t),a=t):(a="en",e.warn("TagNavigator - Language = "+t+" is not supported... Using default language (English)"))),a},i.getText=function(e){return t[e]?t[e].escapeHTML().replace(/'/g,"&#39;").replace(/&#x2F;/g,"/"):e},i.getFormattedText=function(e,i){if(t[e]){if(i){var a=t[e].escapeHTML().replace(/'/g,"&#39;").replace(/&#x2F;/g,"/");for(var n in i)a=a.replace("{"+n+"}",i[n]);return a}return t[e].escapeHTML().replace(/'/g,"&#39;").replace(/&#x2F;/g,"/")}return e},i.getNLSMonthArray=function(){return n||(n=[i.getText("january"),i.getText("february"),i.getText("march"),i.getText("april"),i.getText("may"),i.getText("june"),i.getText("july"),i.getText("august"),i.getText("september"),i.getText("october"),i.getText("november"),i.getText("december")]),n},i.convertToUnity=function(e,t){return t||this.preciseCount_global?e:e<1e3?e:e>999&&e<1e6?Math.floor(e/1e3)+"k":e>999999&&e<1e9?Math.floor(e/1e6)+"M":e>999999999?e.toString().substring(0,3)+"...":void 0},i}),define("DS/TagNavigator/PredError",["DS/TagNavigator/Notification","DS/TagNavigator/TaggerNLS"],function(e,t){"use strict";return e.extend({type:"PredError",init:function(e){this._parent(t.getText("predError")+t.getText("errorContactAdmin"),e)},mergeWidth:function(e){this.data=[this.data,e.data].join(", ")}})}),define("DS/TagNavigator/simplified/views/PreferredContentView",["UWA/Core","UWA/Class/View","DS/TagNavigator/TaggerNLS","UWA/Class/Promise","DS/MessageBus/MessageBus"],function(e,t,i,a,n){"use strict";return t.extend({tagName:"div",className:"preferred-content",domEvents:{"click .rootw-arrow-container":"toggleRootWArea"},taggerView:null,_availability:void 0,_simplifiedRootViews:{},_simplifiedRootViewsPromises:{},_rootWViewContainers:{},init:function(e){this._availability=!1,this.taggerView=e.taggerView,this.taggerView.getRootWs().forEach(function(e){this._simplifiedRootViews[e]=void 0,this._simplifiedRootViewsPromises[e]=void 0}.bind(this)),this._parent(e)},setup:function(e){this._parent(e)},render:function(){return this._emptyView=!1,this._contentDiv=e.createElement("div",{id:"preferred-view-container"}).inject(this.container),this.taggerView.getRootWs().forEach(function(t){var a=t.split(":")[1];this._rootWViewContainers[t]=e.createElement("div",{id:"preferred-content-"+a,class:"root-container",html:{tag:"div",class:"item-circle",html:{tag:"span",class:"fonticon fonticon-3ds-"+a}}}).inject(this._contentDiv).hide(),e.createElement("div",{id:t,class:"rootw-expander",html:{tag:"div",class:"rootw-arrow-container",html:[{tag:"div",class:"arrow",html:[{class:"fonticon fonticon-chevron-down",tag:"span"},{class:"fonticon fonticon-chevron-right",tag:"span"}]},{tag:"div",class:"rootw-label",text:i.getText(a)}]}}).inject(this._rootWViewContainers[t])}.bind(this)),this},setAvailability:function(e){this._availability=e,this._availability||this._destroyViews()},isVisible:function(){return this._emptyView?this.hide():this.show(),this._emptyView},isAvailable:function(){return this._availability},redraw:function(e,t){if(!this._availability)throw new Error("THIS REDRAW IS NOT NEEDED !");var i=this;return new a(function(n){var r=t.length>1,s=void 0,o=[];i.taggerView.getRootWs().forEach(function(e){s=i._rootWViewContainers[e],r?s.addClassName("root-border"):s.removeClassName("root-border"),t.indexOf(e)>=0?o.push(i.getOrInitRootView(e)):s.hide()}),a.all(o).then(function(t){var r=[];t.forEach(function(t){t.activate(),r.push(t.redraw({onSearch:e.onSearch}))}),a.all(r).then(function(t){t.forEach(function(t){if(t.hideBorder){var a=i._rootWViewContainers[t.viewId].getElement("li.predicate").getAttribute("predicate");i.taggerView.getExpandStatus(a)?i._rootWViewContainers[t.viewId].removeClassName("hide-left-border"):i._rootWViewContainers[t.viewId].addClassName("hide-left-border")}t.isEmpty||t.hasNoResults?i._rootWViewContainers[t.viewId].hide():i._rootWViewContainers[t.viewId].show(),i.setExpandStatus(i._rootWViewContainers[t.viewId],t.viewId,e&&e.onSearch,e&&e.searchString)}),n()})})})},setExpandStatus:function(e,t,i,a){var n=this.taggerView.cacheForSimplified,r=e.getElement(".root-container-inner"),s=n.getExpandCollapseStatusRootW("preferred",t);if(r){var o=r.getElement("ul.predicates")?r.getElement("ul.predicates").getElements("li.predicate").length:0,l=r.getElement("ul.predicates")?r.getElement("ul.predicates").getElements("li.predicate.searchexcluded").length:0;if("ds6w:who"==t)if(1==r.getElement("ul.predicates").getElements("li.predicate").length)var c=r.getElement("ul.predicates").getElement("li.predicate").getAttribute("predicate");e.getElement(".rootw-arrow-container").show(),i&&a&&(o!=l||"person"==c)?(r.setStyles({position:"relative",overflow:"hidden",opacity:1,height:"100%",visibility:"visible"}),e.removeClassName("hide-left-border"),e.getElement(".rootw-arrow-container").addClassName("expanded"),n.setExpandCollapseRootWStatus("preferred",t,!0)):s?(r.setStyles({position:"relative",overflow:"hidden",opacity:1,height:"auto",visibility:"visible"}),e.getElement(".rootw-arrow-container").addClassName("expanded"),e.removeClassName("hide-left-border")):(r.setStyles({position:"absolute",opacity:0,height:"0",visibility:"hidden"}),e.addClassName("hide-left-border"),e.getElement(".rootw-arrow-container").removeClassName("expanded"))}},getRootView:function(e){return this._simplifiedRootViews[e]},isEmpty:function(){var e=[];for(var t in this._rootWViewContainers)this._rootWViewContainers[t].isHidden()&&e.push(t);return e.length==Object.keys(this._rootWViewContainers).length},onViewUpdate:function(e){this._availability?(e.isEmpty||e.hasNoResults?this._rootWViewContainers[e.viewId].hide():this._rootWViewContainers[e.viewId].show(),this.taggerView.onPreferredViewUpdate()):console.log("onViewUpdate event received, but section is not active, ignoring the event..")},getOrInitRootView:function(e){var t=this,i=this._simplifiedRootViewsPromises[e];return i||(i=new a(function(i){var a=t._simplifiedRootViews[e];if(a)i(a);else{var n;switch(e){case"ds6w:where":n="DS/TagNavigator/simplified/views/RootWhereView";break;case"ds6w:what":n="DS/TagNavigator/simplified/views/RootWhatView";break;case"ds6w:when":n="DS/TagNavigator/simplified/views/RootWhenView";break;case"ds6w:who":n="DS/TagNavigator/simplified/views/RootWhoView";break;case"ds6w:how":n="DS/TagNavigator/simplified/views/RootHowView";break;case"ds6w:why":n="DS/TagNavigator/simplified/views/RootWhyView"}require([n],function(n){!function(n){a=new n({taggerView:t.taggerView}).render(),t._simplifiedRootViews[e]=a,a.addEvent("onViewUpdate",t.onViewUpdate.bind(t)),a.inject(t._rootWViewContainers[e].getElement(".rootw-expander")),i(a)}(n)})}}),this._simplifiedRootViewsPromises[e]=i),i},_destroyViews:function(){for(var e in this._simplifiedRootViews){var t=this._simplifiedRootViews[e];t&&(t.destroy(),this._simplifiedRootViews[e]=t=null,this._simplifiedRootViewsPromises[e]=null)}},toggleRootWArea:function(t){var i,a,r,s,o,l=t.target.getClosest(".rootw-arrow-container"),c=l.getClosest(".rootw-expander").id,d=this.taggerView.cacheForSimplified,g=d.getExpandCollapseStatusRootW("preferred",c);if(l){l.toggleClassName("expanded");var u=l.getClosest(".root-border");for(g?u&&u.addClassName("hide-left-border"):u&&u.removeClassName("hide-left-border"),r=0,s=(i=l.getParent().getChildren()).length;r<s;++r)(a=e.extendElement(i[r])).match(".root-container-inner")&&(o=e.extendElement(a.getChildren()[0]),new e.Fx(a,{duration:300,transition:"quadInOut",events:{onComplete:function(){g?a.setStyles({position:"absolute",opacity:0,height:"0",visibility:"hidden"}):a.setStyles({position:"relative",overflow:"hidden",opacity:1,height:"100%",visibility:"visible"})},onStart:function(){a.setStyle("position","relative"),a.setStyle("overflow","hidden")}}}).start({height:g?[o.getSize().height,0]:[0,o.getSize().height]}));d.setExpandCollapseRootWStatus("preferred",c,!g),n.publish({channel:"TaggerTrackerApi",topic:"hit",data:{category:"6WTagger",action:"clickOnRootW-Preferred",persDim:{pd1:c,pd2:g?"collapsed":"expanded"}}})}},destroy:function(){for(var e in this._destroyViews(),this._rootWViewContainers){var t=this._rootWViewContainers[e];t&&(t.destroy(),t=null)}this._parent()}})}),define("DS/TagNavigator/simplified/views/ShowResultsView",["UWA/Core","UWA/Class/View","DS/TagNavigator/TaggerNLS"],function(e,t,i){"use strict";return t.extend({tagName:"div",className:"show-results-cont",domEvents:{click:"closeTagger"},render:function(){return e.createElement("div",{class:"show-results"}).inject(this.container),this},closeTagger:function(e){this.dispatchEvent("showResultClick")},destroy:function(){this._parent()}})}),define("DS/TagNavigator/Predicate",["UWA/Core","DS/TagNavigator/Logger","UWA/Class/Promise","DS/TagNavigator/TaggerSettings","DS/TagNavigator/TaggerNLS"],function(e,t,i,a,n){"use strict";var r,s,o,l,c={},d={},g={},u=a.getOption("companyPredicate_Concepts_Mapping");function h(e){var t,i,a,n,d,g,p,f;e&&(t=e.sixw,i=e.displayName,d=e.options||{},a=e.type,n=e.server,g=e.markPendingForNls,p=e.isCompanyTagPredicate||!1,f=e.isCommunityTagPredicate||!1);var m,v,T,C,w,b=[],y=null,S=a,E=void 0,I=!1,x=d,_=!0,A=void 0;if(void 0===(t?t.length:void 0)&&l(),0===t.length){if(s)return s;s=this}else{if("string"==typeof t&&(t=t.split("/").filter(function(e){return e.length>0})),v=t.slice(0,t.length-1),"string"==typeof(m=t[t.length-1])&&-1===m.indexOf("/")||l(m),-1!==v.indexOf(m)&&l(m),T=h.getPredicate(m)){if((w=T.getFullPredicateID().split("/")).join("/")===t.join("/"))return T;if("void"===w[0])T.set6WRootFather(t[0]);else{if("void"===t[0])return T;if(u[t])return T;l(m)}}(y=new h({sixw:v,type:a,server:n}))===s?!1===o.test(m)&&l(m):y.getFullPredicateID()+"/"+m!==t.join("/")&&l(m),y.addChild(this),T?T.setFather(y):c[m]=this,i&&m.split(":").pop()!==i?r[m]=i:h.addElementsToTranslate(m,n,g)}return this.addChild=function(e){return b.push(e),this},this.removeChild=function(e){var t=b.indexOf(e);return-1!==t&&b.splice(t,1),this},this.id=function(){return m},this.getType=function(){return S},this.setType=function(e){S="dateTime"===e?"date":e||"string"},this.getUnit=function(){return E},this.setUnit=function(e){UWA.is(e,"string")&&e.length>0&&(E=e)},this.setIsEnum=function(e){I=e},this.isEnum=function(){return I},this.setSuggestSupport=function(e){A=e},this.isSuggestSupported=function(){return A},this.isTypeValidBool=function(){return!0===_},this.setTypeValidBool=function(e){_=e},this.getElemOptions=function(){return x},this.setElemOptions=function(e){x=e},this.warnSelect=function(){return x&&x.onCriterionSelectEvent||!1},this.getFullPredicateID=function(e){var t;return"void"===(t=null!==y?y.getFullPredicateID():null)&&e&&(t=""),t&&0!==t.length?t+"/"+m:m},this.displayName=function(){return r[m]?r[m]:m},this.setDisplayName=function(e){return r[m]=e,e},this.countDescendants=function(){return b.length?b.length+b.map(function(e){return e.countDescendants()}).reduce(function(e,t){return e+t}):0},this.getChildren=function(e){var t,i,a;for(e||(e=function(){return!0}),a=[],C=0,i=b.length;C<i;C++)e((t=b[C]).id())&&a.push(t);return a},this.getFather=function(){return y},this.setFather=function(e){"void"===this.get6WRootFather().getFullPredicateID()&&(y=e)},this.get6WRootFather=function(){var e=this;if(this===s)return null;for(;!e.is6WRoot();)e=e.getFather();return e},this.isAKindOf=function(e){return!this.is6WRoot()&&this.get6WRootFather().id()===e},this.set6WRootFather=function(e){var t,i,a;if((t=h.getPredicate(e))&&t.is6WRoot()&&"void"===this.get6WRootFather().getFullPredicateID()){for(i=this,a=this;!i.is6WRoot();)i!==this&&(a=a.getFather()),i=i.getFather();i.removeChild(a),t.addChild(a)}},this.is6WRoot=function(){return y===s},this.isGod=function(){return this===s},this.isCompanyPredicate=function(){return p},this.isCommunityPredicate=function(){return f},this}l=function(e){throw t.error("Fail to create a predicate with invalid arg. Id is :'"+e+"'"),new Error("Invalid input arg")},r={"ds6w:who":"Who","ds6w:when":"When","ds6w:what":"What","ds6w:where":"Where","ds6w:why":"Why","ds6w:how":"How"},h.getElementsNLS=function(){if(!0===a.getOption("offline6W"))return t.warn("Predicate: Offline mode: No NLS translation is to be done."),d={},g={},[];if(0!==Object.keys(d).length){var e,n,s="";for(var o in e=function(e,i){if(e.vocabularyElementNLSInfo){var a,n,s,o,l,c;if((o=e.vocabularyElementNLSInfo).length&&o[0])for(n=0,s=o.length;n<s;n++)if((a=o[n]).uri&&a.nlsName){r[a.uri]=a.nlsName;var d=h.getPredicate(a.uri);l="dateTime"===a.dataType?"date":a.dataType,d&&a.dataType&&(c=d.getType())&&l!==c&&(t.warn("WARNING: predicate type inconsistant with the dictionary for:"+a.uri),t.warn("predDataType="+c+", dictionaryDataType="+l)),d&&l&&d.setType(l)}i("ElementsNLS OK")}else g={},i("ElementsNLS FAILED");return g={},!0},d){for(var l in s=[],d[o].map)s.push(l);s=s.join(","),n=new i(function(t){d[o].server.getElementsNLS(s,e,t)}),g[o]=n}d={}}var c=[];for(var o in g)c.push(g[o]);return c},h.getElementsToTranslate=function(){return d},h.getPendingPromisesForElementsToTranslate=function(){return g};var p=[];h.addElementsToTranslate=function(t,i,a){if(void 0===r[t])if(i){p.push(t);var n={};p.forEach(function(e){n[e]=!0,r[e]=null});var s=i.getTenantName();d[s]||(d[s]={}),d[s].server=d[s].server||i,d[s].map=e.merge(d[s].map?d[s].map:{},n),p=[]}else a&&p.push(t)},o=new RegExp("^(ds6w:who|ds6w:when|ds6w:what|ds6w:where|ds6w:why|ds6w:how|void)$"),s=null,h.getRoots=function(e){return e||(e=function(){return!0}),s?s.getChildren(e):[]},h.getClassDispValue=function(e){return r[e]||null},h.getPredicate=function(e){return c[e]},h.count=function(){return s?s.countDescendants():0},h.ROOT_WHO="ds6w:who",h.COMMUNITY_TAGS="communityTags",h.COMMUNITY_TAGS_V2="CommunityTag",h.COMMUNITY_TAGS_PREDICATES={},h.COMPANY_TAG="CompanyTag",h.COMPANY_TAGS_PREDICATES={};var f=!1;return h.ensureDefaultPredicates=function(){if(f)return;f=!0;let e,t,i=a.getOption("simplifiedRootW"),r=n.getText("communityTags");a.getOption("communityTagsV2")?i.forEach(function(t){h.COMMUNITY_TAGS_PREDICATES[t]=e=new h({sixw:t+"/swym:"+t.replace("ds6w:","")+h.COMMUNITY_TAGS_V2,type:"string",isCommunityTagPredicate:!0}),e.setDisplayName(r)}):i.forEach(function(t){h.COMMUNITY_TAGS_PREDICATES[t]=e=new h({sixw:t+"/"+h.COMMUNITY_TAGS+"_"+t.split(":")[1],type:"string"}),e.setDisplayName(r)}),r=n.getText("companyTags"),i.forEach(function(e){h.COMPANY_TAGS_PREDICATES[e]=t=new h({sixw:e+"/"+e+h.COMPANY_TAG,type:"string",isCompanyTagPredicate:!0}),t.setDisplayName(r)})},h.getCommunityTagPredicate=function(e){return h.ensureDefaultPredicates(),h.COMMUNITY_TAGS_PREDICATES[e]},h.getCompanyTagPredicate=function(e){return h.ensureDefaultPredicates(),h.COMPANY_TAGS_PREDICATES[e]},h}),define("DS/TagNavigator/AdvancedSearchCriteria",["UWA/Core","DS/TagNavigator/TaggerNLS","DS/TagNavigator/Predicate","DS/TagNavigator/TaggerSettings"],function(e,t,i,a){"use strict";return function(){var i={},n={};function r(i,a){var n=0,r=e.createElement();if(a||r.grab(e.createElement("li",{class:"predicate expanded selected ds6w_",html:{tag:"div",class:"predicate-header",html:{tag:"div",class:"predicate-label",text:i.title}}})),"string"===i.type||"boolean"===i.type)r.grab(e.createElement("li",{class:"parameter selected tag",title:i.value[0],html:{tag:"div",class:"parameter tag-label",id:i.cid,html:[{text:i.value[0]},{tag:"span",class:a?"tag-del fonticon fonticon-cancel":""}]}}));else for(n=0;n<i.value.length;n++)r.grab(e.createElement("li",{class:"param-range-label",text:t.getText("paramIntType"+i.value[n].rangeVal)})),!isNaN(i.value[n].fromVal)&&isFinite(i.value[n].fromVal)&&null!=i.value[n].fromVal&&r.grab(e.createElement("li",{class:"parameter selected tag",title:i.value[n].fromVal,html:{tag:"div",id:i.cid,class:"tag-label from",rangeVal:i.value[n].rangeVal,fromto:"from",text:t.getText("from")+":"+i.value[n].fromVal}})),!isNaN(i.value[n].toVal)&&isFinite(i.value[n].toVal)&&null!=i.value[n].toVal&&r.grab(e.createElement("li",{class:"parameter selected tag",title:i.value[n].toVal,html:{tag:"div",id:i.cid,class:"tag-label to",rangeVal:i.value[n].rangeVal,fromto:"to",text:t.getText("from")+":"+i.value[n].toVal}}));return r.getHTML()}function s(e){e=e.split("/");var t=n[e.join("/")]||e[e.length-1].split(":")[1],i='<li class="predicate expanded selected" id="atv'+c(e.join("/"))+'">';return i+='<div class="predicate-header" title="'+t+'"><div class="predicate-label">',i+='<span class="fonticon fonticon-search"></span>'+t+"</div></div></li>"}function o(i,n,r,s){var o,l=0,c=e.createElement();let d;if(s){let e=s.split("/"),t=e[0].contains("ds6w:")?e[0].contains("sixw:")?e[0].replace("sixw:",""):e[0]:"";d=a.getOption("simplifiedRootW").includes(t)?t.replace("ds6w:",""):""}for(l=0;l<i.length;l++)o=e.createElement("li",{class:"tag selected",id:i[l].tagId+"atv",html:[{tag:"div",class:"tag-label",html:[{tag:"span",class:n?"root-icon fonticon "+(d?"fonticon-3ds-"+d:"fonticon-search"):""},{class:"title",text:i[l].isARange?i[l].text.replace(/(from|to)/,function(e,i){return t.getText(i)}):i[l].text}]},{tag:"span",class:n?"tag-del fonticon fonticon-cancel":""}]}),n||o.setAttributes({title:i[l].isARange?i[l].text.replace(/(from:\s|to:\s)/,""):i[l].text}),n&&o.setAttributes({"context-id":r,"proxy-name":"searchCriteria","predicate-name":s.split("/").pop()}),c.grab(o);return c.getHTML()}function l(e,t){if(e&&"string"==typeof e)return!(0===e.length||t&&t instanceof RegExp&&!t.test(e));if(e instanceof Array){for(var i=0;i<e.length;i++)if(!e[i]||"string"!=typeof e[i]||0===e[i].length||t&&t instanceof RegExp&&!t.test(e[i]))return!1;return!0}return!1}function c(e){var t,a,n;if(t=0,0!==e.length)for(a=0,n=e.length;a<n;a++)t=(t<<5)-t+e[a].charCodeAt(0),t&=t;return i[t="id_"+t]=e,t}function d(e,t){return c(JSON.stringify({predicate:t,object:e.object,dispValue:e.displayValue,type:e.type,isSimplifiedCriteria:e.isSimplifiedCriteria}))}this.setActiveCriteria=function(e,i){var a,r,s,o,c={},g=i.isSimplified;if(c={localfilters:{search:{},plmparam:{}}},!l([i.widgetId,i.proxyId]))return c;if(e.search)for(a in e.search){r=e.search[a],c.localfilters.search[a]=[];for(var u=0;u<r.length;u++)if(r[u].object.from||r[u].object.to){var h=r[u].object;if(g){var p={type:r[u].type,object:h};if(r[u].isSimplifiedCriteria)p.isSimplifiedCriteria=!0,c.localfilters.search[a].push({text:r[u].displayValue,tagId:d(p,a)});else if(h.from&&!h.to||h.to&&!h.from){var f=h.from?"from":"to";c.localfilters.search[a].push({text:t.getText(f)+": "+r[u].object[f],tagId:d(p,a)})}else h.from&&h.to&&c.localfilters.search[a].push({text:h.from+" - "+h.to,tagId:d(p,a)})}else c.localfilters.search[a]=Object.keys(r[u].object).map(function(e){if(r[u].object[e]){var t={type:r[u].type||"date",displayValue:e+": "+r[u].object[e],object:{}};return t.object[e]=r[u].object[e],{text:t.displayValue,tagId:d(t,a),isARange:!0}}}).filter(function(e){return void 0!==e})}else c.localfilters.search[a]=r.map(function(e){return{text:e.displayValue,tagId:d(e,a)}})}if(e.plmparam)for(u=0;u<e.plmparam.length;u++)c.localfilters.plmparam=e.plmparam.map(function(e){return s=e.get("type"),o="string"===s?[e.get("stringVal")]:"boolean"===s?e.get("boolVal").length>0?["1"===e.get("boolVal")[0]?t.getText("yes"):t.getText("no")]:[]:e.get("intType").map(function(e){return{fromVal:e.fromVal,toVal:e.toVal,rangeVal:e.rangeVal}}).filter(function(e){return!isNaN(e.fromVal)&&isFinite(e.fromVal)&&null!==e.fromVal||!isNaN(e.toVal)&&isFinite(e.toVal)&&null!==e.toVal}),{title:e.get("value"),type:s,cid:e.cid,value:o}}).filter(function(e){return e.value.length>0&&""!==e.value[0]});return i.predicatesNLS&&(n=i.predicatesNLS),c},this.criteriaToHTML=function(e,t){var i,a,n,c,d=[];if(!e)return"";if(d.push(l([t.widgetId,t.proxyId])&&t.widgetId in e&&t.proxyId in e[t.widgetId]&&e[t.widgetId][t.proxyId].localfilters&&e[t.widgetId][t.proxyId].localfilters.search&&function(e){if(0===Object.keys(e).length)return!1;for(var t in e)if(e[t].length>0)return!0;return!1}(e[t.widgetId][t.proxyId].localfilters.search)),d.push(l([t.widgetId,t.proxyId])&&t.widgetId in e&&t.proxyId in e[t.widgetId]&&e[t.widgetId][t.proxyId].localfilters&&e[t.widgetId][t.proxyId].localfilters.plmparam&&e[t.widgetId][t.proxyId].localfilters.plmparam.length>0),!d[0]&&!d[1])return"";if(i='<div id="searchCriteria-_-'+t.contextId+'" class="appCriteria">',d[0]){for(a in t.isSimplified&&(i+="<ul class=active-predicate-list>"),e[t.widgetId][t.proxyId].localfilters.search)(n=e[t.widgetId][t.proxyId].localfilters.search[a]).length>0&&(t.isSimplified||(i+="<ul class=active-predicate-list>"),i+=t.isSimplified?o(n,t.isSimplified,t.contextId,a):s(a)+o(n,t.isSimplified),t.isSimplified||(i+="</ul>"));t.isSimplified&&(i+="</ul>")}if(d[1])for(c=0;c<e[t.widgetId][t.proxyId].localfilters.plmparam.length;c++)i+="<ul class=freeinput-predicate-list>",i+=r(e[t.widgetId][t.proxyId].localfilters.plmparam[c]),i+="</ul>";return i+="</div>"},this.getCriterionFromDOMId=function(e){var t,a;return t=e.replace("atv",""),i.hasOwnProperty(t)?(a=i[t],JSON.parse(a)):void 0}}}),define("DS/TagNavigator/TaggerUtils",["UWA/Core","UWA/Class","UWA/Promise","DS/TagNavigator/Logger","DS/WebappsUtils/WebappsUtils","DS/TagNavigator/simplified/model/FedSearchResultModel","DS/TagNavigator/TaggerSettings","DS/WAFData/WAFData"],function(e,t,i,a,n,r,s,o){"use strict";return t.singleton({_user_granted_roles_promise:void 0,_service_url_promises:{},defaultUserImage:n.getWebappsBaseUrl()+"TagNavigator/assets/icons/generic_user.png",getGrantedRoles:function(){return UWA.is(this._user_granted_roles_promise)||(this._user_granted_roles_promise=new i(function(e){require(["DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices"],function(t){t.getGrantedRoles(function(t){a.info("i3DXCompassPlatformServices.getGrantedRoles returned roles info as:"+(t&&UWA.is(t,"array")?JSON.stringify(t):t)),e(t)})})})),this._user_granted_roles_promise},getServiceURL:function(e){if(UWA.is(e,"object")&&e.serviceId&&e.platformId){let t=e.serviceId+"__"+e.platformId,n=this._service_url_promises[t];return n||(this._service_url_promises[t]=n=new i(function(t){require(["DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices"],function(i){i.getServiceUrl({serviceName:e.serviceId,platformId:e.platformId,onComplete:function(i){a.log(e.serviceId+" url from i3DXCompassPlatformServices: "+i),t(i)},onFailure:function(){a.error("FAILED to retrieve "+e.serviceId+" url for tenant: "+e.platformId),t()}})})})),n}},buildFedSearchModel:function(e){var t=void 0;if(e&&UWA.is(e.attributes,"array")){var i={};e.attributes.forEach(function(e){i[e.name]=e.value}),t=new r(i)}return t},getDeviceAgent:function(){var e=navigator.userAgent,t=e.indexOf("iPad")>0,i=e.indexOf("iPhone")>0||e.indexOf("iPod")>0,a=e.indexOf("Android")>0,n=s.getAgentAsMobile();return t||i||a||n},getPredicateRangeValues:function(e){e&&e.platformId&&e.lang&&require(["DS/FedDictionaryAccess/FedDictionaryAccessAPI"],function(t){var i={tenantId:e.platformId,lang:e.lang,onComplete:function(t){if(t)try{a.info("Vocabulary suggestions successfully retrieved from FedDictionaryAccess.getRangeValues, responseData="+JSON.stringify(t)),e.onComplete&&e.onComplete(e.platformId,e.predicates,t)}catch(e){a.info("FAILED to parse FedDictionaryAccess.getRangeValues response")}},onFailure:function(){if(a.info("Failed to retrieve Vocabulary suggestions from FedDictionaryAccess.getRangeValues(..)"),e.onComplete)return e.onComplete(e.platformId,e.predicates)}};t.getRangeValues(e.predicates,i)})},getExistingUserTags:function(t){if(t&&t.platformId&&t.subject_uri)return new Promise(function(i,n){require(["DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices"],function(r){r.getServiceUrl({serviceName:"6WTags",platformId:t.platformId,onComplete:function(r){a.log("6WTags url from compass: "+r),function(a){let r={method:"GET",type:"text",timeout:1e4,headers:{Accept:"application/json","Content-Type":"application/json"},onComplete:function(e){i(UWA.is(e,"object")?e:JSON.parse(e))},onFailure:function(){n("FAILED to retrieve user tags for "+t.subject_uri)},onTimeout:function(){n("TIMEOUT during retrieve user tags for "+t.subject_uri)}},s={SecurityContext:"preferred",tenant:t.platformId,subject:t.subject_uri};o.authenticatedRequest(a+"/resources/6w/tags?"+e.Utils.toQueryString(s),r)}(r)},onFailure:function(){a.error("FAILED to retrieve 6WTags url for tenant: "+t.platformId),onFailure("FAILED to retrieve 3DSearch url for tenant"+t.platformId)}})})})}})}),define("DS/TagNavigator/simplified/views/RootWView",["UWA/Core","UWA/Class/View","DS/TagNavigator/Predicate","DS/TagNavigator/TaggerSettings","DS/TagNavigator/Logger"],function(e,t,i,a,n){"use strict";var r=t.extend({searchString:"",customSearch:!1,_tabView:void 0,_rootW:void 0,_preferredPredicates:void 0,_redrawStatus:void 0,_optimizedRedraw:void 0,init:function(e){this._optimizedRedraw=a.getOption("optimizedRedraw"),this._redrawStatus=!0,this._parent(e)},setup:function(e){this._parent(e)},render:function(){return this.customSearch||this.getTaggerView().addEvent("TopBarSearch",this.onSearchInput.bind(this)),this.getTaggerView().addEvent("redrawStatusUpdate",this.onRedrawStatusUpdate.bind(this)),this},activate:function(){this.show()},deactivate:function(){this.hide()},getTaggerView:function(){return this.getOption("taggerView")},getObservedNavImpl:function(){return this.getTaggerView().getObservedNavigator()},availableTagsToHtml:function(e,t,i){return e.availableTagsToHtml(this._rootW,this._getPredicateInfo(t),i)},hasFocusedProxy:function(){return this.getTaggerView().hasFocusedProxy()},hasAdvancedFocsuedProxy:function(e,t){return this.getTaggerView().hasAdvancedFocsuedProxy(e,t)},_getPredicateInfo:function(e){var t,i=e||this.hasFocusedProxy();return i&&(t=i.getPredicateInfo()),t},redraw:function(){return r.getContentStatus(this.container)},_getPreferredPredicates:function(e,t){var a,n=this;return(a=this.getObservedNavImpl().hasPreferredPredicates(!0))||(this._preferredPredicates||(this._preferredPredicates=[]),a=this._preferredPredicates),a.filter(function(e){var a=i.getPredicate(e);if(a)return a.get6WRootFather().id()===n._rootW&&(!t||a.getType()==t)})},clearViews:function(){this.getTaggerView().destroyTagValues()},isActiveView:function(){return!this.container.isHidden()},getActiveTabId:function(){return this._tabView?this._tabView.selectedTab.getName():""},onSearchInput:function(e){this.searchString=e,this._redrawStatus=!0,this.isActiveView()&&this.redraw({onSearch:!0})},onRedrawStatusUpdate:function(e){this._redrawStatus=e,n.warn("RootWView: new redraw status="+e)},getContentStatus:function(e){var t={viewId:this._rootW,isEmpty:!1,hasNoResults:!1,hideBorder:!1},i=e.getElements(".predicate.searchexcluded").length,a=e.getElements(".predicate").length;return 0===a?t.isEmpty=!0:(i==a&&(t.hasNoResults=!0),1===a&&(t.hideBorder=!0)),t},destroy:function(){this.getTaggerView().removeEvent("TopBarSearch"),this.stopListening(),this.model=null,this._parent()}});return r}),define("DS/TagNavigator/simplified/views/RootWhyView",["UWA/Core","DS/TagNavigator/simplified/views/RootWView","DS/TagNavigator/Logger","UWA/Class/Promise"],function(e,t,i,a){"use strict";return t.extend({tagName:"div",className:"root-container-inner root-why-container",_contentDiv:void 0,init:function(e){this._rootW="ds6w:why",this._parent(e)},setup:function(e){this._parent(e)},render:function(){return this._contentDiv=e.createElement("div",{id:"all-tags"}).inject(this.container),this._parent()},redraw:function(e){return new a(function(e){if(i.log("RootWhyView: Inside redraw"),!this._redrawStatus&&this._optimizedRedraw)return i.warn("RootWhyView: redraw status is false, returning.."),this;this._contentDiv.empty();var t=this.getTaggerView(),a=this._getPreferredPredicates(),n=this.availableTagsToHtml(t,null,a);this._contentDiv.setHTML(n),this._contentDiv.getElements("#all-tags .predicate:not(.searchexcluded)").forEach(function(e){e.show()}),this._redrawStatus=!1,e(this.getContentStatus(this._contentDiv))}.bind(this))},destroy:function(){this.stopListening(),this.model=null,this._parent()}})}),define("DS/TagNavigator/simplified/views/RootHowView",["UWA/Core","DS/TagNavigator/simplified/views/RootWView","DS/TagNavigator/Logger","UWA/Class/Promise"],function(e,t,i,a){"use strict";return t.extend({tagName:"div",className:"root-container-inner root-how-container",init:function(e){this._rootW="ds6w:how",this._parent(e)},setup:function(e){this._parent(e)},_contentDiv:void 0,render:function(){return this._contentDiv=e.createElement("div",{id:"all-tags"}).inject(this.container),this._parent()},redraw:function(e){return new a(function(e){if(i.log("RootHowView: Inside redraw"),!this._redrawStatus&&this._optimizedRedraw)return i.warn("RootHowView: redraw status is false, returning.."),this;this._contentDiv.empty();var t=this.getTaggerView(),a=this._getPreferredPredicates(),n=this.availableTagsToHtml(t,null,a);this._contentDiv.setHTML(n),this._contentDiv.getElements("#all-tags .predicate:not(.searchexcluded)").forEach(function(e){e.show()}),this._redrawStatus=!1,e(this.getContentStatus(this._contentDiv))}.bind(this))},destroy:function(){this.stopListening(),this.model=null,this._parent()}})}),define("DS/TagNavigator/simplified/views/RootWhatView",["UWA/Core","DS/TagNavigator/simplified/views/RootWView","DS/TagNavigator/Logger","UWA/Class/Promise"],function(e,t,i,a){"use strict";return t.extend({tagName:"div",className:"root-container-inner root-what-container",init:function(e){this._rootW="ds6w:what",this._parent(e)},setup:function(e){this._parent(e)},render:function(){return this._contentDiv=e.createElement("div",{id:"all-tags"}).inject(this.container),this._parent()},redraw:function(e){return new a(function(e){if(i.log("RootWhatView: Inside redraw"),!this._redrawStatus&&this._optimizedRedraw)return i.warn("RootWhatView: redraw status is false, returning.."),this;this._contentDiv.empty();var t=this.getTaggerView(),a=t.getObservedNavigator(),n=this.hasFocusedProxy(a),r=this._getPreferredPredicates(n),s=this.availableTagsToHtml(t,n,r);this._contentDiv.setHTML(s),this._contentDiv.getElements(".predicate:not(.searchexcluded)").forEach(function(e){e.show()}),this._redrawStatus=!1,e(this.getContentStatus(this._contentDiv))}.bind(this))},destroy:function(){this._parent()}})}),define("DS/TagNavigator/TagsServer",["UWA/Core","DS/WAFData/WAFData","UWA/Utils","DS/TagNavigator/NotificationManager","DS/TagNavigator/Notification","DS/TagNavigator/TaggerNLS","DS/TagNavigator/TaggerSettings","DS/TagNavigator/Logger","DS/TagNavigator/TaggerUtils"],function(e,t,i,a,n,r,s,o,l){"use strict";var c,d,g={};c="/resources/6w",d="/resources/6WVocab/access";var u=0,h=0;function p(g,f,m){var v,T,C,w,b,y,S,E,I,x,_=this;g=i.composeUrl(i.parseUrl(g)),v=f&&"string"==typeof f?{tenant:f}:{},T=m&&"string"==typeof m&&m.length>0?m||"":null;try{S=p.validateBaseUrl(g),y="file:"===(window?window.location.protocol:null),!1,i.matchUrl(window.location,g)||"passport"}catch(e){throw e}I=function(t){return t=t||{},e.Utils.toQueryString(e.merge(e.merge({},t),v))},w=function(){var e;return e={type:"text",timeout:15e3,headers:{Accept:"application/json","Content-Type":"application/json"}},"firefox"===i.Client.Engine.name&&(e.timestamp=Date.now()),e},C=function(){return{tenantId:_.getTenantName(),lang:r.getLang()}},E=function(e,i){if(y)return setTimeout(i.onComplete,1e3),this;try{t.authenticatedRequest(e,i)}catch(e){i.onFailure(e)}return this},b=function(e,t){var i;if("boolean"==typeof t&&(t=!1),!e||""===e)return!t;try{i=JSON.parse(e)}catch(e){return!1}return!i.error},x=function(e){return e.map(function(e){return e.uri}).join("")},this.getElementsNLS=function(e,t,i){if(-1!==(g=_.getUrlPart("baseUrl")).indexOf("/VocabularyStub")){var a,n;(a=w()).onComplete=function(e){return b(e)?(o.info("Elements NLS successfully retrieved from '"+g+"'"),t&&e?t(JSON.parse(e),i):void t({},i)):a.onFailure(e)},a.onFailure=a.onTimeout=function(e){o.info("Failed to retrieve Elements NLS from '"+g+"'"),t({},i)},a.headers["Accept-Language"]=r.getLang(),a.method="POST",a.data=e,a.headers["Content-Type"]="text/uri-list",n=g+d+"/ElementsNLSNames?"+I({});var l=s.getOption("scenario");n=UWA.is(l,"string")?g+d+"/ElementsNLSNames/"+ ++u+"/response":g+d+"/ElementsNLSNames",a.method="GET",E(n,a)}else require(["DS/FedDictionaryAccess/FedDictionaryAccessAPI"],function(a){var n;(n=C()).onComplete=function(e){if(o.info("Elements NLS successfully retrieved from RDF API FedDictionaryAccess.getResourcesInfo(..)"),o.log("FedDictionaryAccess.getResourcesInfo(..)===>responseData=",JSON.stringify(e)),t&&e)return t(e,i);t({},i)},n.onFailure=function(e){if(o.info("Failed to retrieve Elements NLS from from RDF API FedDictionaryAccess.getResourcesInfo(..)"),UWA.is(e,"object")&&UWA.is(e.vocabularyElementNLSInfo,"array")&&t)return t(e,i);t({},i)},o.log("TagsServer.getElementsNLS, param =",e),a.getResourcesInfo(e,n)});return _},this.getTenantName=function(){return f},this.getTenantDisplayName=function(){return T||this.getTenantName()},this.getUrlPart=function(e){return S[e]||null},this.putTag=function(e,t,i,s,l){var d,u=!UWA.is(l,"boolean")||l,h=u?e.tag[0]:void 0,p=w(),f=this;return g=this.getUrlPart("baseUrl"),p.onComplete=function(e){return b(e)?(h&&o.info("Tag {"+[x(h.subject),h.predicate,h.object.literal].join("/")+"} successfully created on server '"+g+"'"),i?i(f.getTenantName(),e,{request:"create"}):void 0):p.onFailure(e)},p.onFailure=p.onTimeOut=function(e){if(h&&o.error("Failed to create tag {"+[x(h.subject),h.predicate,h.object.literal].join("/")+"} on server '"+g+"'. Reason is '"+(e?e.message:void 0)+"'"),u&&(a.push(new n(r.getText("tagCreationFail").format(h.object.literal)+r.getText("errorContactAdmin"))),a.dispatch()),s)return s(h?h.subject:e,{request:"create"})},p.method="PUT",p.data=JSON.stringify(e),d=g+c+"/tags?"+I({SecurityContext:"preferred"}),E(d,p),this},this.deleteTag=function(e,t,i,s,l){var d,u=!UWA.is(l,"boolean")||l,h=w(),p=u?e.tag[0]:void 0;return g=this.getUrlPart("baseUrl"),h.onComplete=function(t){return b(t)?(p&&o.info("Tag {"+[x(p.subject),p.predicate,p.object.literal].join("/")+"} successfully deleted on server '"+g+"'"),u&&(a.push(new n(r.getText("tagDeletionSuccess"),{className:"success"})),a.dispatch()),i?i(p?p.subject:t,e,{request:"delete"}):void 0):h.onFailure(t)},h.onFailure=function(e){if(p&&o.error("Failed to delete tag {"+[x(p.subject),p.predicate,p.object.literal].join("/")+"} on server '"+g+"'. Reason is '"+(e?e.message:void 0)+"'"),u&&(a.push(new n(r.getText("tagDeletionFail").format(p.object.literal)+r.getText("errorContactAdmin"))),a.dispatch()),s)return s(p?p.subject:e,{request:"delete"})},h.method="DELETE",h.data=JSON.stringify(e),d=g+c+"/tags?"+I(t?{SecurityContext:"preferred"}:{}),E(d,h),this},this.getPredicateValue=function(e,t,i){if(-1!==(g=this.getUrlPart("baseUrl")).indexOf("/VocabularyStubCustom")){var a,n=w();n.onComplete=function(e){if(o.info("Success retrieving PredicateValue in ODT"),t)return t(JSON.parse(e),i)},n.headers["Accept-Language"]=r.getLang(),n.method="GET";var l=s.getOption("scenario");return UWA.is(l,"string")&&(a=g+d+"/PredicateValue/"+ ++h+"/response"),void E(a,n)}return-1!==this.getUrlPart("baseUrl").indexOf("/VocabularyStub")?t({},i):(require(["DS/FedDictionaryAccess/FedDictionaryAccessAPI"],function(a){var n=C();n.onComplete=function(e){if(o.info("Success retrieving PredicateValue"),t)return t(UWA.is(e,"string")?JSON.parse(e):e,i)},n.onFailure=function(e){return i()},a.getNlsOfPropertiesValues(JSON.stringify(e),n)}),this)},this.getExplicitTag=function(e,t,i){var a,n=w();return g=this.getUrlPart("baseUrl"),n.onComplete=function(e){return b(e,!0)?(o.info("Tags successfully retrieved from server of tenant:'"+f+"'"),t?t(e,v.tenant,i):void 0):n.onFailure(e)},n.onFailure=function(e){return o.info("Failed to get explicit tags from server of tenant:'"+f+"'. Reason is '"+(e?e.message:void 0)+"'"),t(null,null,i)},n.method="POST",a=g+c+"/tags?"+I({}),n.data=JSON.stringify(e),E(a,n),this},this.getVocabularySuggestions=function(e,t,i){if(o.log("Inside TagsServer.getVocabularySuggestions for predicate "+t),-1!==this.getUrlPart("baseUrl").indexOf("/VocabularyStub")){var a=w();return a.onComplete=function(a){if(o.info("Success retrieving PredicateValue in ODT"),i)return i(e,t,"string"==typeof a?JSON.parse(a):a)},a.headers["Accept-Language"]=r.getLang(),a.method="GET",t=UWA.is(t,"array")?t.join("_").replaceAll("ds6w:",""):t.replace("ds6w:",""),void E(g+d+"/PredicateRangeValues_"+t+"?uri="+t+"&tenant="+e,a)}return l.getPredicateRangeValues({platformId:e,predicates:t,lang:r.getLang(),onComplete:i}),this},this.getUsersInfo=function(i,a,n,r){var l;if(UWA.is(a,"array")&&(l=a.length)>0){var c=this.getTenantName(),d=[];o.log("Inside TagsServer.getUsersInfo, getting the users information for tenant: "+c+", number of users: "+l),require(["DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices"],function(l){var g=function(a,n,r){return new Promise(function(s,o){var l={label:"6WTagger-"+i+"-"+(new Date).getTime(),query:'[ds6w:type]:("pno:Person")',with_nls:!1,with_synthesis:!1,with_indexing_date:!1,select_file:["thumbnail_2d"],source:["swym"],select_predicate:["ds6w:label","ds6w:country","ds6w:city"],tenant:c,nresults:2*r<=500?2*r:500,start:0};l.specific_source_parameter={swym:{additional_query:" AND personOrGroup:("+n+") AND ut_state:1"}};var d={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},data:e.Json.encode(l),url:a+"/search",onComplete:function(e){s(JSON.parse(e).results)},onFailure:function(e){s(e)}};t.authenticatedRequest(d.url,d)})};l.getServiceUrl({serviceName:"3DSearch",platformId:c,onComplete:function(e){o.log("fed search url from compass: "+e);var t=s.getOption("FS_QUERY_LENGTH_LIMIT"),i="",r=!0,l=0;a.forEach(function(a){l++,r?(i='("'+a+'")',r=!1):i+=' BOR ("'+a+'")',i.length>=t&&(o.log("FS_QUERY_LENGTH_LIMIT reached, launching the query"),d.push(g(e,i,l)),i="",r=!0,l=0)}),d.push(g(e,i,l)),n(d)},onFailure:function(){o.error("FAILED to retrieve 3DSearch url for tenant: "+c),r("FAILED to retrieve 3DSearch url for tenant"+c)}})})}}}return p.validateBaseUrl=function(e){var t=i.parseUrl(e);return t.baseUrl=t.protocol+"://"+t.authority+t.path,t},p.isAlreadyInTagsServerList=function(e){return g[e]},p.setInTagsServerList=function(e){g[e]=!0},p}),define("DS/TagNavigator/UserSettings",["UWA/Core","UWA/Class","UWA/Class/Promise","DS/i3DXCompass/Data","DS/i3DXCompass/EventManager","DS/TagNavigator/Logger","DS/TagNavigator/TaggerSettings"],function(e,t,i,a,n,r,s){"use strict";return t.singleton({compassDataInitPromise:void 0,compassGetUserPromise:void 0,getPrefPromise:void 0,TAGGER_SETTINGS:"taggerSettings",isODTMode:!1,init:function(t){this.isODTMode=UWA.is(t,"string")&&-1!==t.indexOf("/VocabularyStub"),this.userSettings={},this.compassDataInitPromise=new i(function(e){n.addEvent("onInitialized",function(){e()})}),e.is(a,"object")&&!e.is(a.getPreferencesUrl,"string")&&e.is(window.COMPASS_CONFIG,"object")&&a.initialize({lang:COMPASS_CONFIG.lang,userId:COMPASS_CONFIG.userId,myAppsBaseUrl:COMPASS_CONFIG.myAppsBaseUrl,passportUrl:"",proxyTicketUrl:""})},getUserId:function(){var e=this;return new i(function(t){e.getUserInfo().then(function(e){t(e.id)})})},getUserInfo:function(){if(!this.compassGetUserPromise){var e=this;this.compassGetUserPromise=new i(function(t){var i={id:s.getOption("odtUser")||"odtuser",firstname:"Mr.",lastname:"Mogambo"};!0===s.getOption("offline6W")?(r.warn("UserSettings#getUserId: user id set to offline6W"),t("offline6W")):e.isODTMode?t(i):require(["DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices"],function(e){e.getUser({onComplete:function(e){r.log("i3DXCompassPlatformServices#getUser SUCCEEDED, "+e),t(e)},onFailure:function(){r.error("i3DXCompassPlatformServices#getUser FAILED"),t(i)}})})})}return this.compassGetUserPromise},retrieveTaggerPreferences:function(){if(!this.getPrefPromise){var t=this;this.getPrefPromise=new i(function(i){s.getOption("offline6W")?(r.warn("UserSettings#retrieveTaggerPreferences: Tagger running in offline mode; no preferences retrieved, forcing simplified mode."),t.userSettings={simplified:!0},i()):t.compassDataInitPromise.then(function(){e.is(a.getPreferencesUrl)||(r.error("INVALID CompassData.getPreferencesUrl, FAILED to retrieve Tagger Preferences"),i());var n=!1,o=s.getOption("simplifiedTagger"),l=s.getOption("legacy6W")||sessionStorage.getItem("legacy6W");if(o?s.getOption("WebInWin")||s.getOption("addinmode")?t.userSettings={simplified:!0}:n=!0:t.userSettings=l?{simplified:!1}:{simplified:!0},n){var c={url:a.getPreferencesUrl,urlParams:{name:"simplified"},onComplete:function(e){t.userSettings={},t.userSettings.simplified=UWA.is(e,"boolean")?e:"true"===e,t.isODTMode&&(t.userSettings.simplified=!0),i()},onFailure:function(e){r.error(UWA.is(e,"object")?JSON.stringify(e):"FAILED to retrieve Tagger Preferences"),t.userSettings={},t.userSettings.simplified=!1,i()}};a.request(c)}else i()})})}return this.getPrefPromise},getPreference:function(e){if(!this.userSettings)throw new Error("getPreference is attempted before the preferences retrieved");return this.userSettings[e]},setPreference:function(t){if(!this.userSettings)throw new Error("setPreference is attempted before the preferences retrieved");if(e.is(a.setPreferencesUrl)&&UWA.is(t.name,"string")&&UWA.is(t.value)){this.userSettings[t.name]=t.value;var i={name:t.name,value:t.value,onComplete:t.onComplete?t.onComplete:function(){r.log("Tagger settings successfully stored")},onFailure:t.onFailure?t.onFailure:function(){r.log("FAILED to store the Tagger settings")}};a.setPreference(i)}}})}),define("DS/TagNavigator/ActiveTagView",["UWA/Core","UWA/Class/View","DS/UIKIT/Tooltip","DS/UIKIT/DropdownMenu","DS/TagNavigator/TaggerNLS"],function(e,t,i,a,n){"use strict";return t.extend({tagName:"li",className:"tag selected",domEvents:{click:"retrieveTag"},setup:function(e){e.id&&this.container.setAttribute("id",e.id),this._parent(e)},render:function(){var t=this.getOption("isSimplified"),a=this.getOption("text"),n=this.getOption("icon"),r=this.getOption("isExcluded"),s=this.getOption("isPinned"),o=this.getOption("isGrouped"),l=this.getOption("hasActions"),c=this.getOption("disabled"),d=this.getOption("onePerLine"),g=this.getOption("attribute"),u=this.getOption("hasExcludeSupport");if(this.condition=this.getOption("condition"),this.renderTo=this.getOption("renderTo"),r&&this.container.addClassName("isExcluded"),l&&this.container.addClassName("tag-with-actions"),c&&this.container.addClassName("disable"),s&&this.container.addClassName("pinned"),o&&this.container.addClassName("grouped"),u&&!r&&this.container.addClassName("canBeExcluded"),d&&this.container.setStyles({display:"flex",margin:"0px 0 10px 0"}),g&&g.length>0){var h=this;g.forEach(function(e){h.container.setAttributes(e)})}var p=e.createElement("div",{class:"tag-elem"}).inject(this.container),f=e.createElement("div",{class:"tag-label"}).inject(p);n&&e.createElement("span",{class:"root-icon fonticon "+n}).inject(f);var m=e.createElement("div",{class:"title",text:a}).inject(f);return n||m.setStyles({"padding-left":"5px"}),this.updateExclude(r),s&&e.createElement("span",{class:"fonticon fonticon-pin pinned"}).inject(p.getElement(".tag-label")),l?e.createElement("span",{class:"tag-dropdown fonticon fonticon-down-open"}).inject(p):t&&e.createElement("span",{class:"tag-del fonticon fonticon-cancel"}).inject(p),this.getOption("withoutTitle")||this.container.setAttributes({title:a}),this.tooltip=new i({position:"bottom",target:f,body:a,className:"tagger-filter-tooltip"}),this},updateExclude:function(t){t?this.container.hasClassName("isExcluded")||(this.container.addClassName("isExcluded"),e.createElement("span",{class:"fonticon fonticon-block excluded"}).inject(this.getElement(".tag-label"))):(this.container.hasClassName("isExcluded")&&this.container.removeClassName("isExcluded"),this.container.getElement(".excluded")&&this.container.getElement(".excluded").destroy())},updateHasActions:function(t){t?this.container.hasClassName("tag-with-actions")||(this.container.addClassName("tag-with-actions"),e.createElement("span",{class:"tag-dropdown fonticon fonticon-down-open"}).inject(this.getElement(".tag-elem")),this.container.getElement(".tag-del")&&this.container.getElement(".tag-del").destroy()):(this.container.hasClassName("tag-with-actions")&&this.container.removeClassName("tag-with-actions"),this.container.getElement(".tag-dropdown").destroy(),e.createElement("span",{class:"tag-del fonticon fonticon-cancel"}).inject(this.getElement(".tag-elem")))},retrieveTag:function(e){if(e.target.getClosest(".tag-with-actions")instanceof HTMLElement)return void this.clickOnTagActions(e);e.preventDefault();let t={tagName:tagName,predicate:predicate,condition:this.condition};this.dispatchEvent("removeActiveTag",t)},clickOnTagActions:function(e){let t=this;this.dropdownMenu&&this.dropdownMenu.destroy();let r=this.container,s=-1!==this.container.className.indexOf("isExcluded"),o=-1!==this.container.className.indexOf("canBeExcluded"),l=[{text:n.getText("removeTag"),name:"remove",fonticon:"trash"}];s?l.unshift({text:n.getText("unexludeTag"),name:"unexclude",fonticon:"block"}):o&&l.unshift({text:n.getText("excludeTag"),name:"exclude",fonticon:"block"});let c=a.extend({getDisplayContext:function(){let e={},t=document.documentElement;return e.viewportWidth=t.clientWidth||window.innerWidth,e.viewportHeight=t.clientHeight||window.innerHeight,e.scrollTop=window.pageYOffset||document.body.scrollTop||t.scrollTop,e}});this.dropdownMenu=new c({target:r,items:l,renderTo:t.renderTo?document.querySelector("#tagnavigator"):document.querySelector("body"),events:{onClick:function(e,i){t.container.id.split("::")[0],t.container.id.split("::")[1];if("remove"===i.name){let e=t.condition;t.dispatchEvent("removeActiveTag",e)}else if("exclude"===i.name){t.condition.excluded=!0;let e=t.condition;t.container.removeClassName("canBeExcluded"),"date"==t.condition.type&&(t.condition.display&&t.condition.displayValue||(e.tagInfo=t.condition.object)),t.dispatchEvent("excludeTag",e)}else if("unexclude"===i.name){t.condition.excluded=!1,t.container.addClassName("canBeExcluded");let e=t.condition;t.container.removeClassName("canBeExcluded"),"date"==t.condition.type&&(t.condition.display&&t.condition.displayValue||(e.tagInfo=t.condition.object)),t.dispatchEvent("excludeTag",e)}},onHide:function(){t.tooltip=new i({position:"bottom",target:t.container.getElement(".tag-label"),body:t.container.id.split("::")[0],className:"tagger-filter-tooltip"})},onShow:function(){t.tooltip&&t.tooltip.elements&&t.tooltip.destroy()}}}),this.dropdownMenu.show(),e.preventDefault(),e.stopPropagation()},destroy:function(){this._parent()}})}),define("DS/TagNavigator/simplified/activeTags/ActiveTagsUtils",["UWA/Core","DS/TagNavigator/TaggerNLS"],function(e,t){"use strict";var i={predicateViews:[],advanceFilter:null,computeFilters:function(e){let t,i=e.computeFilterObj(null,null,void 0,!0,!1);return i&&i.allfilters&&i.allfilters.condition&&i.allfilters.condition.length?t=i:i.allfiters&&i.allfiters.condition&&0!=i.allfiters.condition.length||(t=void 0),t},computeReqObj:function(e){return e.display=e.displayValue,e},computeTagsArray:function(e){let t=[];return Array.isArray(e)&&e.length&&e.forEach((e,a)=>{Object.keys(e).forEach(a=>{let n={};UWA.is(e[a],"array")?e[a].forEach((e,r)=>{let s=i.computeReqObj(e),o=!!s.excluded;n={object:s,predicate:a,isExcluded:o},t.push(n)}):"object"==typeof e[a]&&e[a].condition&&e[a].condition.forEach((i,n)=>{i.predicates.forEach((n,r)=>{let s,o;e[a].isComplex&&(o=a),(i.hasOwnProperty("excluded")||e[a].hasOwnProperty("excluded"))&&(s=!!i.excluded);let l={object:i,predicate:n.predicate,operator:e[a].operator,displayPredicate:o,isExcluded:s};t.push(l)})})})}),t},getTags:function(e,t,i){let a=[];return UWA.is(e,"array")?e.forEach((e,n)=>{let r=this.computeReqObj(e);i?r.excluded&&a.push({condition:r}):t&&r.excluded||a.push({condition:r})}):"object"==typeof e&&e.condition&&e.condition.forEach((e,n)=>{i?e.excluded&&a.push({condition:e}):t&&e.excluded||a.push({condition:e})}),a},_computeDateNls:function(e){let i,a;return e.from&&(i=e.from.split("/").reverse().join("/")),e.to&&(a=e.to.split("/").reverse().join("/")),i&&!a?t.getText("from")+": "+i:!i&&a?t.getText("to")+": "+a:i&&a?i+" - "+a:void 0},hasOverloadedOperator:function(e,t){let i=!1;return Array.isArray(e)&&e.length&&e.forEach((e,a)=>{Object.keys(e).forEach(a=>{if("object"==typeof e[a]){let n=UWA.clone(e[a]);n.id=a,t.operatorIsOverloaded(n)&&(i=!0)}})}),i},getActualPredicates:function(e){let t=new Set;return e.isComplex&&e.condition.forEach(e=>{e.predicates.forEach(e=>{t.add(e.predicate)})}),t},checkNewfilter:function(t,i,a){let n=this,r=[],s=[];return i?(UWA.is(t,"array")?t.forEach(t=>{var o=!1;switch(t.type){case"boolean":case"string":var l={value:t.object,nls:t.displayValue||t.nls||t.object},c=-1;i.length>0&&(c=i.findIndex(function(e){return e.object===l.value}));let g=n.computeReqObj(t);a&&!g.excluded&&(-1===c?r.push({condition:g}):s.push({condition:g}));break;default:if(t.isSimplifiedCriteria)i.length>0&&i.forEach(function(e){e.isSimplifiedCriteria&&e.object.from===t.object.from&&e.object.to===t.object.to&&(o=!0)}),a&&!g.excluded&&(o?s.push({condition:g}):r.push({condition:g}));else{var d=i.filter(function(e){return!e.isSimplifiedCriteria});if(d.length>0)e.extend(d[0],t.object);else{let e=n.computeReqObj(t);a&&!e.excluded&&r.push({condition:e})}}}}):UWA.is(t,"object")&&t.condition.forEach(e=>{let t,n=e.isComplex;var o=function(t,i){return i?e.condition.object.length==t.object.length&&e.condition.object.every(function(e){return-1!==t.object.indexOf(e)}):e.condition.object.length<=t.object.length?e.condition.object.every(function(e){return-1!==t.object.indexOf(e)}):t.object.every(function(t){return-1!==e.condition.object.indexOf(t)})};t=i.condition.findIndex(function(t){return n?e.isComposite?o(t):UWA.is(e.condition.object,"array")&&UWA.is(t.object,"array")?(isHierarchicalTag=!0,o(t,!0)):JSON.stringify(e.condition.object)===JSON.stringify(t.object):e.isComposite?o(t):UWA.is(e.object,"array")&&UWA.is(t.object,"array")?JSON.stringify(e.object)===JSON.stringify(t.object):e.object===t.object}),a&&!e.excluded&&(-1==t?r.push({condition:e}):s.push({condition:e}))}),{newAddedFilters:r,oldFilters:s}):(s=this.getTags(t,a),{newAddedFilters:r,oldFilters:s})}};return i}),define("DS/TagNavigator/ActiveCriteria",["UWA/Core","UWA/Class","UWA/Promise","UWA/Class/Events","UWA/Class/View","DS/UIKIT/Tooltip","DS/TagNavigator/TaggerNLS","DS/UIKIT/DropdownMenu","DS/TagNavigator/TaggerSettings","DS/TagNavigator/Logger","DS/TagNavigator/Predicate","DS/MessageBus/MessageBus"],function(e,t,i,a,n,r,s,o,l,c,d,g){"use strict";var u,h,p,f=a.extend(function(e,t,a){var n=i.deferred();return this.setActiveCriteria=function(i,n){(n=n||{}).contextId=t,n.widgetId=n.widgetId||a,m.setActiveCriteria(i,e,n)},this.redrawCriteria=function(i){(i=i||{}).contextId=t,i.widgetId=i.widgetId||a;try{return m.redrawCriteria(e,i,"NGFilter"===e)}catch(e){throw e}},this.getDisplayStatus=function(){return m.getDisplayStatus(t)},this.getInitPromise=function(){return n.promise},this._getInitDeferredPromise=function(){return n},this}),m=t.singleton({init:function(t){u=u||{},h=h||{},t=t||{};var i=[],a=[],n=!1;this.setAsSimplified=function(){n=!0},this.addOpacity=function(){e.extendElement(document.getElementById("active-tags")).toggleClassName("add-opacity",!0)},this.setupActiveCriteria=function(t){var i,a;if(!e.is(t,"object"))return console.error("Invalid input arg"),null;if(!T(t.id))return console.error("Id is not a valid string"),null;if(!T(t.container))return console.error("Invalid container id"),null;if(!T(t.contextId)){if(!T(t.widgetId))return console.error("contextId and widgetId are not valid strings"),null;e.is(p,"function")?t.contextId=p(t.widgetId):(console.warn("Sorry, I don't have the function to recover contextId from widgetId yet. Opening tagger may resolve this issue"),t.contextId="orphan_-_"+t.widgetId)}return T(t.module,/^DS(\/\w+)+$/gi)?(e.is(t.widgetId2contextId,"function")&&(p=t.widgetId2contextId,function(){var t,i,a,n,r=Object.keys(u).filter(function(e){return"orphan"===e.split("_-_")[0]});for(t=0;t<r;t++)if(i=r[t].split("_-_").shift().join("_-_"),T(a=p(i)))for(n in u[r[t]])u[a][n]=e.clone(u[r[t]][n]),delete u[r[t]][n]}()),i=new f(t.id,t.contextId,t.widgetId),require([t.module],function(r){var s,o,l,c=new r;c&&"function"==typeof c.setActiveCriteria&&"function"==typeof c.criteriaToHTML||console.error("class provided is not valid"),u[t.contextId]=u[t.contextId]||{},a=e.extendElement(document.getElementById(t.container)),s=u[t.contextId][t.id]&&u[t.contextId][t.id].view||[],o=u[t.contextId][t.id]&&u[t.contextId][t.id].container||[],l=u[t.contextId][t.id]&&u[t.contextId][t.id].proxy||[],s.push(a?v(a,n):null),o.push(a||t.container),l.push(i),u[t.contextId][t.id]={container:o,view:s,setActiveCriteria:c.setActiveCriteria,criteriaToHTML:c.criteriaToHTML,getCriterionFromDOMId:"function"==typeof c.getCriterionFromDOMId?c.getCriterionFromDOMId:void 0,proxy:l},i._getInitDeferredPromise().resolve()}),i):(console.error(t.module+" : is not a valid module path"),null)},this.setActiveCriteria=function(e,t,i){var a;T(i.contextId)&&u.hasOwnProperty(i.contextId)&&T(t)&&u[i.contextId].hasOwnProperty(t)&&(i.isSimplified=n,a=u[i.contextId][t].setActiveCriteria(e,i),h[i.contextId]=h[i.contextId]||{},h[i.contextId][t]=h[i.contextId][t]||{},a.allproxies&&(h[i.contextId][t].allproxies=a.allproxies),a.localfilters&&T([i.widgetId,i.proxyId])&&(h[i.contextId][t][i.widgetId]=h[i.contextId][t][i.widgetId]||{},h[i.contextId][t][i.widgetId][i.proxyId]=h[i.contextId][t][i.widgetId][i.proxyId]||{},h[i.contextId][t][i.widgetId][i.proxyId].localfilters=a.localfilters),a.groupings&&T([i.widgetId,i.proxyId])&&(h[i.contextId][t][i.widgetId]=h[i.contextId][t][i.widgetId]||{},h[i.contextId][t][i.widgetId][i.proxyId]=h[i.contextId][t][i.widgetId][i.proxyId]||{},h[i.contextId][t][i.widgetId][i.proxyId].groupings=a.groupings),a.allgroupings&&(h[i.contextId][t].allgroupings=a.allgroupings))},this.redrawCriteria=function(o,g,p){var f,m,C,w;if(g.getProxyFilters=function(e,t){if(t&&T([t.widgetId,t.proxyId]))return e&&e[t.widgetId]&&e[t.widgetId][t.proxyId]?e[t.widgetId][t.proxyId].localfilters:void 0},g.isSimplified=n,n&&(g.withoutPredHeader=!0,g.withRootIcon=!0),T(g.contextId)&&u.hasOwnProperty(g.contextId))if(T(o)&&u[g.contextId].hasOwnProperty(o)){if(w=!0,f=n?"":function(e,t,i){var a="";return a+='<div class="section-header" data-rec-id="active-tags-header">',a+='<span class="section-header-left active-tags-close fonticon fonticon-trash" id="trash-_-'+t+'" data-rec-id="active-tags-close"></span>',a+='<div class="header-title" id="'+(e=e||"")+'">',a+='<div class="arrow"><span class="fonticon fonticon-down-dir"></span><span class="fonticon fonticon-right-dir"></span></div>',a+=(i||s.getText("activeFilters"))+"</div></div>"}("activeFilters",g.contextId,g.headerTitle),f+='<div id="active-tags-list" class="expandable" style="overflow:inherit;height: auto;"><div class="innerForTransition">',u[g.contextId]&&h[g.contextId]&&(u[g.contextId].NGFilter&&h[g.contextId].NGFilter&&(C=u[g.contextId].NGFilter.criteriaToHTML(h[g.contextId].NGFilter,UWA.clone(g)),w=w&&!T(C),f+=C),u[g.contextId].searchCriteria&&h[g.contextId].searchCriteria&&(C=u[g.contextId].searchCriteria.criteriaToHTML(h[g.contextId].searchCriteria,UWA.clone(g)),w=w&&!T(C),f+=C),u[g.contextId].taggerCriteria&&h[g.contextId].taggerCriteria)){var b=UWA.clone(g);if(p){var y=h[g.contextId].taggerCriteria;if(UWA.is(y,"object")){var S=y[g.widgetId];if(UWA.is(S,"object")){var E=Object.keys(S);if(1===E.length){var I=t[E[0]];I&&I.isActive()&&I.getNavImpl().getFocusedProxy()===I&&(b.proxyId=E[0])}}}}C=u[g.contextId].taggerCriteria.criteriaToHTML(h[g.contextId].taggerCriteria,b),w=w&&!T(C),f+=C}if(f+="</div></div>",n&&g.isEmbedded){return{isEmpty:w,generatedHtml:f}}i.forEach(function(e){e.destroy()}),i=[],a.length>0&&(a.forEach(function(e){e.destroy(),e=null}),a=[]);var x=function(e){e.getElements("li.tag").forEach(function(e){var t=e.getAttribute("predicate-name");if(t){t.contains("sixw:")&&(t=t.replace("sixw:",""));var i,n=d.getPredicate(t);n?i=n.displayName():c.warn("predivcate NOT found on the active Tag for predicateId ="+t);var s=i?i+": "+e.getElement(".title").getText():e.getElement(".title").getText();a.push(new r({position:"bottom",target:e.getElement(".tag-label .title"),body:s,className:"title-tooltip"}))}else c.warn("predicateId not found on the active Tag")})};for(m in u[g.contextId])u[g.contextId][m].container.forEach(function(t,a){if(t instanceof HTMLElement||(t=e.extendElement(document.getElementById(t))||t,u[g.contextId][m].view[a]=t instanceof HTMLElement?v(t,n):void 0,u[g.contextId][m].container[a]=t),t instanceof HTMLElement)if(w)try{t.empty(!0),t.setContent(""),t.setStyle("display","none")}catch(e){throw e}else try{if(n)require(["DS/Controls/Expander"],function(i){t.empty(!0);var a=e.createElement("div",{id:"trash-_-"+g.contextId,class:"active-tags-close"}),n=e.createElement("span",{class:"fonticon fonticon-trash"}).inject(a);new r({position:"bottom",target:n,body:s.getText("clearActiveTags"),className:"tagger-filter-tooltip"}),new i({domId:"tn-active-tags",header:g.headerTitle?g.headerTitle:s.getText("activeTagsHeader"),body:e.createElement("div",{html:f}),style:"styled",customHeader:a,expandedFlag:!0,touchMode:!0}).inject(t),x(t)});else{t.hasClassName("expanded-section")||t.addClassName("expanded-section"),t.empty(!0),t.setContent(f);var o=t.getElement(".active-tags-close");o&&i.push(new r({position:"bottom",target:o,body:l.getOption("allowUserPreferredTags")?s.getText("clearNonPinnedActiveTags"):s.getText("clearActiveTags"),className:"tagger-clearAllTags-tooltip"}))}t.setStyle("display","block")}catch(e){throw e}})}else;else;},this._embeddedTaggerCreateActiveCriteriaView=function(e,t){return v(e,t)},this.getDisplayStatus=function(t){return!(!e.is(u[t],"object")||0===Object.keys(u[t]).length)&&Object.keys(u[t]).some(function(e){return 0!==u[t][e].container.length&&u[t][e].container.some(function(e){return e instanceof HTMLElement&&"none"!==e.getStyle("display")})})}}});function v(e,t){var i;return t?e.hasClassName("simplifiedActiveCriteria")||e.addClassName("simplifiedActiveCriteria"):(e.hasClassName("section")||e.addClassName("section"),e.hasClassName("active-tags")||e.addClassName("active-tags")),new(n.extend({container:e,domEvents:{"click .tag":"clickCriteriaEvent","click .tag[grouped]":"removeActiveGrouping","click .local-tag":"clickCriteriaEvent","click .tag-with-actions":"clickGlobalCriteriaEvent","click .tag-dropdown":"clickGlobalCriteriaEvent","click .active-tags-close":"clickTrashEvent"},clickGlobalCriteriaEvent:function(e){i&&i.destroy();var t=e.target.parentElement;if("SPAN"===t.nodeName&&(t=t.parentElement),!(-1!==e.target.getClosest(".tag").className.indexOf("disable"))){var a,n,r,l;a=e.target.getClosest(".appCriteria").id.split("-_-"),n=e.target.getClosest(".tag").id,r=-1!==e.target.getClosest(".tag").className.indexOf("pinned");var c=-1!==e.target.getClosest(".tag").className.indexOf("canBePinned"),d=-1!==e.target.getClosest(".tag").className.indexOf("isExcluded"),h=-1!==e.target.getClosest(".tag").className.indexOf("canBeExcluded");l=[{text:s.getText("removeTag"),name:"remove",fonticon:"trash"}],r?l.unshift({text:s.getText("unPinTag"),name:"unpin",fonticon:"pin-off"}):c&&l.unshift({text:s.getText("pinTag"),name:"pin",fonticon:"pin"}),d?l.unshift({text:s.getText("unexludeTag"),name:"unexclude",fonticon:"block"}):h&&l.unshift({text:s.getText("excludeTag"),name:"exclude",fonticon:"block"});var p=o.extend({getDisplayContext:function(){var e={},t=(this.options,document.documentElement);return e.viewportWidth=t.clientWidth||window.innerWidth,e.viewportHeight=t.clientHeight||window.innerHeight,e.scrollTop=window.pageYOffset||document.body.scrollTop||t.scrollTop,e}});(i=new p({target:t,items:l,renderTo:document.querySelector("#tagnavigator"),events:{onClick:function(t,i){"remove"===i.name?(g.publish({channel:"TaggerTrackerApi",topic:"hit",data:{category:"6WTagger",action:"onClick-RemoveTag",persDim:{pd1:"Remove Tag from menu"}}}),u.hasOwnProperty(a[1])&&u[a[1]].hasOwnProperty(a[0])&&u[a[1]][a[0]].proxy.forEach(function(t){u[a[1]][a[0]].getCriterionFromDOMId&&(n=u[a[1]][a[0]].getCriterionFromDOMId(n)),t.dispatchEvent("onCriteriaRemove",[n,e])})):"pin"===i.name?u.hasOwnProperty(a[1])&&u[a[1]].hasOwnProperty(a[0])&&u[a[1]][a[0]].proxy.forEach(function(t){u[a[1]][a[0]].getCriterionFromDOMId&&(n=u[a[1]][a[0]].getCriterionFromDOMId(n)),t.dispatchEvent("onCriteriaPin",[n,e])}):"unpin"===i.name?u.hasOwnProperty(a[1])&&u[a[1]].hasOwnProperty(a[0])&&u[a[1]][a[0]].proxy.forEach(function(t){u[a[1]][a[0]].getCriterionFromDOMId&&(n=u[a[1]][a[0]].getCriterionFromDOMId(n)),t.dispatchEvent("onCriteriaUnpin",[n,e])}):"exclude"===i.name?u.hasOwnProperty(a[1])&&u[a[1]].hasOwnProperty(a[0])&&u[a[1]][a[0]].proxy.forEach(function(t){u[a[1]][a[0]].getCriterionFromDOMId&&(n=u[a[1]][a[0]].getCriterionFromDOMId(n)),t.dispatchEvent("onCriteriaExclude",[n,e])}):"unexclude"===i.name&&u.hasOwnProperty(a[1])&&u[a[1]].hasOwnProperty(a[0])&&u[a[1]][a[0]].proxy.forEach(function(t){u[a[1]][a[0]].getCriterionFromDOMId&&(n=u[a[1]][a[0]].getCriterionFromDOMId(n)),t.dispatchEvent("onCriteriaUnexclude",[n,e])})}}})).show()}e.stopPropagation(),e.preventDefault()},clickCriteriaEvent:function(e){var t,i,a=e.target.getClosest(".tag");if(!(a.hasAttribute("grouped")||e.target.getClosest(".tag-with-actions")instanceof HTMLElement))return a.getAttribute("proxy-name")?((t=[]).push(a.getAttribute("proxy-name")),t.push(a.getAttribute("context-id"))):t=e.target.getClosest(".appCriteria").id.split("-_-"),g.publish({channel:"TaggerTrackerApi",topic:"hit",data:{category:"6WTagger",action:"clickCriteriaEvent",persDim:{pd1:"Remove a tag from active criteria"}}}),i=a.id,u.hasOwnProperty(t[1])&&u[t[1]].hasOwnProperty(t[0])&&u[t[1]][t[0]].proxy.forEach(function(a){u[t[1]][t[0]].getCriterionFromDOMId&&(i=u[t[1]][t[0]].getCriterionFromDOMId(i)),a.dispatchEvent("onCriteriaClick",[i,e])}),!1},clickTrashEvent:function(e){g.publish({channel:"TaggerTrackerApi",topic:"hit",data:{category:"6WTagger",action:"clickTrashEvent",persDim:{pd1:"Click on Trash Icon"}}});var t,i,a=[];if(t=e.target.getClosest(".active-tags-close").id.split("-_-")[1],u.hasOwnProperty(t))for(i in u[t])u[t][i].container.forEach(function(n){-1===a.indexOf(n.id)&&(u[t][i].proxy.forEach(function(t){t.dispatchEvent("onTrashClick",e)}),a.push(n.id))})},removeActiveGrouping:function(e){c.log("inside removeActiveGrouping");var t=e.target.getClosest(".appCriteria").id.split("-_-"),i=e.target.getClosest(".tag"),a={predicate:i.getAttribute("predicate")};i.hasAttribute("is_predicate")?a.isPredicate=!0:a.text=i.getElement(".tag-label .title").getText(),u.hasOwnProperty(t[1])&&u[t[1]].hasOwnProperty(t[0])&&u[t[1]][t[0]].proxy.forEach(function(e){e.dispatchEvent("onGroupingClick",a)})}}))}function T(e,t){if(e&&"string"==typeof e)return!(0===e.length||t&&t instanceof RegExp&&!t.test(e));if(e instanceof Array){for(var i=0;i<e.length;i++)if(!e[i]||"string"!=typeof e[i]||0===e[i].length||t&&t instanceof RegExp&&!t.test(e[i]))return!1;return!0}return!1}return m}),define("DS/TagNavigator/simplified/activeTags/AdvActiveTagView",["UWA/Core","UWA/Class/View","DS/UIKIT/Tooltip","DS/UIKIT/DropdownMenu","DS/TagNavigator/ActiveTagView","DS/TagNavigator/TaggerNLS"],function(e,t,i,a,n,r){"use strict";return n.extend({domEvents:{click:"retrieveTag"},setup:function(e){this._parent(e)},render:function(){var t=this.getOption("isSimplified"),a=this.getOption("text"),n=this.getOption("icon"),r=this.getOption("isExcluded"),s=this.getOption("isPinned"),o=this.getOption("hasActions"),l=this.getOption("disabled"),c=this.getOption("attribute"),d=this.getOption("hasExcludeSupport");if(this.condition=this.getOption("condition"),this.renderTo=this.getOption("renderTo"),o&&this.container.addClassName("tag-with-actions"),l&&this.container.addClassName("disable"),s&&this.container.addClassName("pinned"),d&&!r&&this.container.addClassName("canBeExcluded"),c&&c.length>0){var g=this;c.forEach(function(e){g.container.setAttributes(e)})}var u=e.createElement("div",{class:"tag-elem"}).inject(this.container),h=e.createElement("div",{class:"tag-label"}).inject(u);n&&e.createElement("span",{class:"root-icon fonticon "+n}).inject(h),this.updateExclude(r);var p=e.createElement("div",{class:"title",text:a}).inject(h);return n||p.setStyles({"padding-left":"5px"}),s&&e.createElement("span",{class:"fonticon fonticon-pin pinned"}).inject(u.getElement(".tag-label")),o?e.createElement("span",{class:"tag-dropdown fonticon fonticon-down-open"}).inject(u):t&&e.createElement("span",{class:"tag-del fonticon fonticon-cancel"}).inject(u),this.getOption("withoutTitle")||this.container.setAttributes({title:a}),this.tooltip=new i({position:"bottom",target:h,body:a,className:"tagger-filter-tooltip"}),this},updateExclude:function(t){t?(this.container.addClassName("isExcluded"),e.createElement("span",{class:"fonticon fonticon-block excluded"}).inject(this.getElement(".tag-label"))):(this.container.hasClassName("isExcluded")&&this.container.removeClassName("isExcluded"),this.container.getElement(".excluded")&&this.container.getElement(".excluded").destroy())},retrieveTag:function(e){if(e.target.getClosest(".tag-with-actions")instanceof HTMLElement)return void this.clickOnTagActions(e);e.preventDefault();let t=this.condition,i=this.container;this.dispatchEvent("removeActiveTag",{option:t,target:i})},clickOnTagActions:function(e){let t=this;this.dropdownMenu&&this.dropdownMenu.destroy();let n=this.container,s=-1!==this.container.className.indexOf("isExcluded"),o=-1!==this.container.className.indexOf("canBeExcluded"),l=[{text:r.getText("removeTag"),name:"remove",fonticon:"trash"}];s?l.unshift({text:r.getText("unexludeTag"),name:"unexclude",fonticon:"block"}):o&&l.unshift({text:r.getText("excludeTag"),name:"exclude",fonticon:"block"});let c=a.extend({getDisplayContext:function(){let e={},t=document.documentElement;return e.viewportWidth=t.clientWidth||window.innerWidth,e.viewportHeight=t.clientHeight||window.innerHeight,e.scrollTop=window.pageYOffset||document.body.scrollTop||t.scrollTop,e}});this.dropdownMenu=new c({target:n,items:l,renderTo:t.renderTo?document.querySelector("#tagnavigator"):document.querySelector("body"),events:{onClick:function(e,i){let a=t.container;if("remove"===i.name){let e=t.condition;t.dispatchEvent("removeActiveTag",{option:e,target:a})}else if("exclude"===i.name){t.condition.condition?t.condition.condition.excluded=!0:t.condition.excluded=!0;let e=t.condition;t.container.removeClassName("canBeExcluded"),"date"==t.condition.type&&(t.condition.display&&t.condition.displayValue||(e.tagInfo=t.condition.object)),t.dispatchEvent("excludeTag",{option:e,target:a})}else if("unexclude"===i.name){t.container.addClassName("canBeExcluded"),t.condition.condition?t.condition.condition.excluded=!1:t.condition.excluded=!1;let e=t.condition;"date"==t.condition.type&&(t.condition.display&&t.condition.displayValue||(e.tagInfo=t.condition.object)),t.dispatchEvent("unexcludeTag",{option:e,target:a})}},onHide:function(){t.tooltip=new i({position:"bottom",target:t.container.getElement(".tag-label"),body:t.condition.tagName,className:"tagger-filter-tooltip"})},onShow:function(){t.tooltip&&t.tooltip.elements&&t.tooltip.destroy()}}}),this.dropdownMenu.show(),e.preventDefault(),e.stopPropagation()},destroy:function(){this._parent()}})}),define("DS/TagNavigator/simplified/utils/OntologyUtils",["UWA/Core","UWA/Class","UWA/Class/Promise","UWA/Class/Collection","DS/WAFData/WAFData","DS/TagNavigator/TaggerSettings","DS/TagNavigator/Logger","DS/i3DXCompassPlatformServices/i3DXCompassRegistryClient","DS/SNInfraUX/TaggerConfigAccess","DS/TagNavigator/simplified/model/OntologyConcept","DS/TagNavigator/TaggerUtils"],function(e,t,i,a,n,r,s,o,l,c,d){"use strict";var g=t.singleton({init:function(){let e={},t=r.getOption("rootWConcepts"),u=r.getOption("concepts_rootW_Mapping"),h=new a([],{model:c}),p={},f=new Map,m=new Map,v={},T=r.getOption("companyTagsAdminGroup");this.isUserAuthorizedForCompanyTags=function(e){let t=v[e];return t||(v[e]=t=new i(function(t){d.getServiceURL({serviceId:"usersgroup",platformId:e}).then(function(e){if(e){var i={method:"GET",headers:{"Content-Type":"application/json"},url:e+"/3drdfpersist/resources/v1/usersgroup?pattern="+T,onComplete:function(e){try{let i=JSON.parse(e);i&&Array.isArray(i.groups)&&(i.groups.length>0?(s.log("response from /3drdfpersist/resources/v1/usersgroup="+JSON.stringify(i)),t(!0)):(s.log("empty response from from /3drdfpersist/resources/v1/usersgroup"),t(!1)))}catch(e){s.log("FAILED to parse response from /3drdfpersist/resources/v1/usersgroup"),t(!1)}},onFailure:function(){s.log("FAILED isUserAuthorizedForCompanyTags"),t(!1)}};n.authenticatedRequest(i.url,i)}else s.log("FAILED to retrive usergroup service URL"),t(!1)})})),t},this.getEnterpriseOntologyTreeModel=function(e){return p[e]},this.setEnterpriseOntologyTreeModel=function(e,t){r.getOption("disableOntologyModelCahe")||this.getEnterpriseOntologyTreeModel(e)||(p[e]=t)},this.getEnterpriseOntologyConcepts=function(e){return new i(function(t){let a=function(i){g.getOntologyConceptsFromSessionId({tenant:e.tenant,sessionId:i.sessionId}).then(function(e){t(e)})};var n;e.sessionId?a(e):(n=e.tenant,new i(function(e){let t={sessionId:void 0},i=r.getOption("distributionSessionId");i?(s.log("Found sessionId as URL param:"+i),t.sessionId=i,e(t)):l.getEnterpriseOntology({tenantID:n}).then(function(i){try{i=UWA.is(i,"array")?i:JSON.parse(i),s.log("TaggerConfigAccess.getEnterpriseOntology response"+JSON.stringify(i)),t.sessionId=i[0].sessionId,e(t)}catch(i){s.error("FAILED to parse response from TaggerConfigAccess.getEnterpriseOntology"),e(t)}},function(){s.error("Error while calling TaggerConfigAccess.getEnterpriseOntology"),e(t)})})).then(a)})},this.getEnterpriseOntologySuggestions=function(e){return new i(function(t){g.isUserAuthorizedForCompanyTags(e.tenant).then(function(i){let a=[];i?g.getEnterpriseOntologyConcepts(e).then(function(){h.filter(function(e){if(e.IsARootConcept())return!0}).forEach(function(e){var t={isEnterpriseOntologySuggestion:!0};t.sixw=e.getBroaderConcepts().at(0).getRootW(),t.object=e.id,t.label=e.getLabel(),a.push(t)}),t({id:e.id,suggestions:a})}):t({id:e.id,suggestions:a})})})},this.hasConcepts=function(){return h.length>0},this.getConcept=function(e){return h.get(e)},this.isConceptAvailable=function(e){if("string"==typeof e&&e)return m.has(e.toLowerCase())};let C=function(e){let t=new c({id:e.shortURI,uri:e.uri,label:e.label}),i=e.types;return Array.isArray(i)||(i=[]),t.set("types",i),-1!==i.indexOf("ds6wclassifier:Tag")&&t.setAsTaggable(),f.set(e.label,!0),m.set(e.label.toLowerCase(),!0),t},w=function(e,i,a){try{i=UWA.is(i,"string")?JSON.parse(i):i,s.log(`Concepts info from sessionId ${e} = ${JSON.stringify(i)}`),i.forEach(function(e){!function(e){let i=h.get(e.shortURI);if(i)throw new Error(e.shortURI+" is already available from "+i.get("uri"));if(i=C(e),h.add(i),UWA.is(e.broader,"array")){let a=e.broader[0].shortURI;1==e.broader.length&&"ds6wclassifier:Root"===a?(i.setAsRootWConcept(),i.set("rootW",u[i.id.toLowerCase()])):e.broader.forEach(function(e){a=e.shortURI;let n=h.get(a);n||(n=C(e),h.add(n)),n.addNarrowerConcept(i),n.canBeTagged()&&i.setAsTaggable(),-1!=t.indexOf(n.id.toLowerCase())&&i.setAsRootConcept()})}}(e)}),a(i)}catch(e){s.log("FAILED to parse /3drdfpersist/resources/v1/ontologies/ response"),a([])}};this.getOntologyConceptsFromSessionId=function(t){var a=e[t.tenant+"_"+t.sessionId];return a||(s.log("Creating a new promise to retrive concepts for sessionId="+t.sessionId+", and tenant="+t.tenant),a=new i(function(e){let i=r.getOption("conceptsInfo");i?w(t.sessionId,i,e):require(["DS/UWPClientCode/PublicAPI","DS/PlatformAPI/PlatformAPI"],function(i,a){var r;if(i.getApplicationConfiguration("app.urls.registry")||a.getApplicationConfiguration("app.urls.registry"))r=i.getApplicationConfiguration("app.urls.registry")||a.getApplicationConfiguration("app.urls.registry");else{r=`${i.getApplicationConfiguration("app.urls.myapps")||a.getApplicationConfiguration("app.urls.myapps")}/resources/AppsMngtRegistry/`}r?(s.log("registryUrl found, registryUrl="+r),o.getServicesByPlatform({platforms:[t.tenant],services:["ontology"],config:{url:r}}).then(function(i){if(s.log("i3DXCompassRegistryClient.getServicesByPlatform returns: "+JSON.stringify(i)),Array.isArray(i)&&i.length>0&&Array.isArray(i[0].services)&&i[0].services.length>0&&i[0].services[0].url){var a={method:"GET",headers:{Accept:"application/json"},url:i[0].services[0].url+"/3drdfklet/resources/v1/concepts/ds6wclassifier:Root/concepts?recurse=all&sessionId="+t.sessionId,onComplete:function(i){w(t.sessionId,i,e)},onFailure:function(){s.log(`FAILED to retrieve concents in sessionId=${t.sessionId}`),e([])}};n.authenticatedRequest(a.url,a)}else s.error("i3DXCompassRegistryClient.getServicesByPlatform did not provide data in expected format"),e([])},function(){s.error("i3DXCompassRegistryClient.getServicesByPlatform FAILED"),e([])})):(s.error("FAILED to retrieve registryUrl"),e([]))})}),e[t.tenant+"_"+t.sessionId]=a),a}}});return g.init()}),define("DS/TagNavigator/TagValue",["UWA/Core","UWA/Class/Promise","DS/TagNavigator/Predicate","DS/TagNavigator/TaggerNLS","DS/TagNavigator/TaggerSettings","DS/TagNavigator/Logger","DS/TagNavigator/NotificationManager","DS/TagNavigator/Notification","DS/TagNavigator/simplified/utils/OntologyUtils"],function(e,t,i,a,n,r,s,o,l){"use strict";var c=/\w+:\w+\.\w+/,d={},g={},u={},h={};function p(e){if(e.isOntologyTag)return h[e.ontologyURI];var t=u[e.embeddedPred?e.embeddedPred.id():e.pred.id()];return t?t[e.originalDisplayValue?e.originalDisplayValue:e.displayValue]:void 0}function f(e,t,i){if(this.pred=e,this.count=t.count||0,this.type=t.type,this.uri=t.uri,this.isComposite=t.isComposite,this.explicit="boolean"==typeof t.explicit?t.explicit:this.pred.is6WRoot(),this.displayValue=t.displayValue,this.icon=t.icon,this.embeddedPred=void 0,this.embeddedTags=void 0,this.explicit||(this.explicit=this.pred.isCompanyPredicate()||this.pred.isCommunityPredicate()),t.hasDisplayValue)this.explicit&&f._treatStandardUserTags.call(this,i?i.getTenantName():void 0);else if(this.explicit)f._treatStandardUserTags.call(this,i?i.getTenantName():void 0);else{var a="ds6w:type"===this.pred.id(),n=c.test(this.displayValue);if(a||n&&!this.explicit){let e=p(this);if(!e&&i){var r=f.getPredicateNlsValueMap(i,this.pred.id());n?(this.originalDisplayValue=this.displayValue.substr(this.displayValue.indexOf(".")+1,this.displayValue.length),r[this.originalDisplayValue]=!0):a&&(r[this.displayValue]=!0)}else this.displayValue=e||this.displayName}}this.parent=t.parent,this.fullid=t.fullid}f.prototype={incrementCount:function(e){},decrementCount:function(e){},getUri:function(){return this.uri},getDisplayValue:function(){return p(this)||i.getClassDispValue(this.displayValue)||this.displayValue},getCount:function(){return this.count},isExplicit:function(){return this.isExplicit},getParent:function(){return this.parent},toString:function(){return this.fullid},setEmbeddedSixW:function(e){this.embeddedPred=e,f.tagvalues[this.fullid]=this,this.parent&&this.parent.setEmbeddedSixW(e)},setEmbeddedTagValues:function(e){this.embeddedTags=e,f.tagvalues[this.fullid]=this,this.parent&&this.parent.addEmbeddedTagValues(e)},addEmbeddedTagValues:function(e){this.embeddedTags||(this.embeddedTags=[]),this.embeddedTags=this.embeddedTags.concat(e),f.tagvalues[this.fullid]=this},clearEmbeddedTagValues:function(){this.embeddedTags=void 0}},f.tagvalues={},f.getTagValue=function(e,t,n,l,c,d,g){var u,h,p,m,v,T;if(p={},!g&&("object"!=typeof e||Array.isArray(e)||e instanceof i)?(p.uri=n,p.displayValue=t,p.explicit=c,p.type=l?l.split("-")[0]:l,h=e):(m=e,p.uri=m.object,p.displayValue=m.dispValue,p.explicit=m.explicit,p.type=m.type?m.type.split("-")[0]:m.type,p.icon=m.icon,h=m.sixw||m.predicate),p.type&&p.type.startsWith("xsd:")&&(p.type=p.type.substr(4,p.type.length)),!(h instanceof i)&&("string"==typeof h||Array.isArray(h))){var C={sixw:h,type:p.type,server:d};try{h=new i(C)}catch(e){s.push(new o("Fail to create a predicate with invalid arg. Id is :'"+C.sixw+"'")),s.dispatch()}}h instanceof i&&("string"==typeof p.uri||Array.isArray(p.uri))&&0!==p.uri.length||function(){throw r.error("Fail to create a tagvalue with unvalid arg"),new Error("Invalid input arg")}(),"string"!==p.type&&"integer"!==p.type&&"float"!==p.type&&"double"!==p.type&&"date"!==p.type&&"tree"!==p.type&&"boolean"!==p.type&&(p.type="string"),h.isCompanyPredicate()&&"string"==typeof p.uri&&(p.uri=p.uri.split(f.BELCHAR)),p.hasDisplayValue="string"==typeof p.displayValue&&p.displayValue.length>0||Array.isArray(p.displayValue)&&Array.isArray(p.uri)&&p.displayValue.length===p.uri.length,p.hasDisplayValue||(p.displayValue=p.uri);var w=p.fullid=h.getFullPredicateID()+p.type+p.uri+typeof p.uri;if(!(u=f.tagvalues[w])){let e="date"===p.type;if(e&&(2!==(v=p.uri.split("/")).length||isNaN(v[1])||(p.displayValue=v[0]+"/"+a.getNLSMonthArray()[parseInt(v[1],10)-1])),("tree"===p.type||Array.isArray(p.uri)||"date"===p.type)&&(e?(v=p.uri.split("/"),T=p.displayValue.split("/")):(Array.isArray(p.uri)?v=p.uri.slice(0):"tree"===p.type&&(v=p.uri.split("/")),T=Array.isArray(p.displayValue)?p.displayValue.slice(0):"tree"===p.type?p.displayValue.split("/"):[p.displayValue]),p.displayValue=T[T.length-1],v.length>1))if(v.splice(v.length-1,1),T.splice(T.length-1,1),Array.isArray(p.uri)){let e=!0;1==v.length&&-1!=v[0].indexOf(f.SIXW_ROOT_ONTOLOGY)&&(e=!1),e&&(p.parent=f.getTagValue(h,T,v,p.type,p.explicit,d))}else p.parent=f.getTagValue(h,T.join("/"),v.join("/"),p.type,null,d);u=new f(h,p,d)}return u},f.removeAll=function(){f.tagvalues={}},f.createTypeCategory=function(e){var t=f.getTagValue(e);f.tagvalues[t.fullid]=t},f.count=function(){return Object.keys(f.tagvalues).length},f.getTagValueNls=function(e,t){var i=u[e];if(i)return i[t]},f.getPredicateNlsValueMap=function(e,t){var i=e.getTenantName(),a=d[i];a||(a={server:e,toTranslate:{}},d[i]=a);var n=a.toTranslate[t];return n||(n={},a.toTranslate[t]=n),n},f.getOntologyNlsValueMap=function(e){var t=g[e];return t||(t={toTranslate:{}},g[e]=t),t.toTranslate},f.getTvToTranslate=function(){return d},f.getOntologyTvToTranslate=function(){return g},f.translateOntologyTagValues=function(){if(!0===n.getOption("offline6W")||!n.getOption("companyTags"))return r.warn("TagValue: No ontology tag value to be translated."),g={},[];var e=[];for(var i in g){let a=new t(function(e,t){let a=g[i].toTranslate;l.getEnterpriseOntologyConcepts({tenant:i}).then(function(){for(let e in a){let t=l.getConcept(e);t?h[e]=t.getLabel():r.warn("FAILED to translate "+e)}e()})});e.push(a)}return g={},e},f.getPredicateValue=function(){if(!0===n.getOption("offline6W"))return r.warn("TagValue: No tag value to be translated."),d={},[];var e=function(e,t){var i,a;for(i in e)for(a in e[i])u[i]||(u[i]={}),u[i][a]||(u[i][a]=e[i][a]);t("PredicateValue OK")},i=[];for(var a in d){var s={};for(var o in d[a].toTranslate)s[o]=Object.keys(d[a].toTranslate[o]);var l=new t(function(t,i){d[a].server.getPredicateValue(s,e,t)});i.push(l)}return d={},i};var m=function(e,t){this.ontologyURI=e[e.length-1];for(let i=1;i<e.length;i++){let a=e[i];if(!h[a]){let e=l.getConcept(a);if(e)h[a]=e.getLabel();else if(t){f.getOntologyNlsValueMap(t)[a]=!0}}}this.displayValue=h[this.ontologyURI]||this.ontologyURI,this.icon="fonticon fonticon-3ds",this.isOntologyTag=!0};return f._treatStandardUserTags=function(e){if("string"==typeof this.uri&&0==this.uri.indexOf(f.SIXW_ROOT_ONTOLOGY)){let t=this.uri.split(f.BELCHAR);2==t.length&&0==t[1].indexOf(f.COMMUNITY_TAG)?(this.isCommunityTag=!0,this.displayValue=t[1].split(f.COMMUNITY_TAG)[1],this.icon="fonticon fonticon-users-alt",this.displayPredicate=i.COMMUNITY_TAGS_PREDICATES[this.pred.id()]):m.call(this,this.uri.split(f.BELCHAR),e)}else Array.isArray(this.uri)&&this.uri.length>1&&0==this.uri[0].indexOf(f.SIXW_ROOT_ONTOLOGY)&&(2==this.uri.length&&0==this.uri[1].indexOf(f.COMMUNITY_TAG)?(this.isCommunityTag=!0,this.displayValue=this.uri[1].replace(f.COMMUNITY_TAG,""),this.icon="fonticon fonticon-users-alt",this.displayPredicate=i.COMMUNITY_TAGS_PREDICATES[this.pred.id()]):2==this.uri[1].split(":").length&&m.call(this,this.uri,e))},f.isSwymCommunityInFocus=function(e){let t=e.observedNavImpl.getProxiesInEdition();if(t.length>0){let e=[];return t.forEach(function(t){t.eachTagValue(function(t){e.push(t)},{allTagsOfType:["ds6w:type"]})}),e.some(function(e){return"swym:Community"==e.uri})}},f.EXPLICIT_TAG="explicit",f.IMPLICIT_TAG="implicit",f.SIXW_ROOT_ONTOLOGY="ds6wclassifier:",f.BELCHAR="_BELCHAR_",f.COMMUNITY_TAG="_#ct#_",f}),define("DS/TagNavigator/simplified/utils/CriteriaUtils",["UWA/Core","UWA/Class","UWA/Class/Collection","DS/WebappsUtils/WebappsUtils","DS/TagNavigator/simplified/model/CriteriaModel","text!DS/TagNavigator/assets/CriteriaInfo.json","DS/TagNavigator/TaggerNLS","DS/TagNavigator/TagValue","DS/TagNavigator/Logger","DS/TagNavigator/TaggerSettings","DS/TagNavigator/simplified/model/TagValueWrapper","DS/TagNavigator/Predicate","DS/TagNavigator/simplified/actions/ActionUtils"],function(e,t,i,a,n,r,s,o,l,c,d,g,u){"use strict";var h=t.singleton({_rootCriteriaStatus:{},_focusedCriteriaPath:void 0,ALL_MODEL_ID:"#all",OTHER_MODEL_ID:"#others",TYPE_CATEGORIZATION:"type_categorization",TYPE_CATEGORIZATION_PREDICATE:"ds6w:what/type_categorization",TYPE_CATEGORY_PREDICATE:"ds6w:what/ds6w:typeCategory",TYPE_CATEGORIZATION_ORIGINAL_PREDICATES:[],ICONS_PATH:"TagNavigator/assets/icons/type_icon/",init:function(){this._criteriaJSONInfo=JSON.parse(r),this.TYPE_CATEGORIZATION_ORIGINAL_PREDICATES=this._criteriaJSONInfo.predicate_Mapping.active_predicates||[],new g({sixw:this.TYPE_CATEGORIZATION_PREDICATE,type:"string",displayName:s.getText("typeCategorizationInfo")}),this._focusedCriteriaPath=[],this._createTypeCategoryTagValues()},_createTypeCategoryTagValues:function(){var e=this._criteriaJSONInfo.category_resources;e&&Object.keys(e).forEach(function(t){for(var i,a=t,n=[a];i=e[a];)i.parent&&n.push(i.parent),a=i.parent;n=n.reverse(),o.createTypeCategory({sixw:this.TYPE_CATEGORY_PREDICATE,type:"string",field:"implicit",object:n,dispValue:n.map(function(e){return s.getText(e)})})}.bind(this))},getTypeCategorizationPredicates:function(){return this.TYPE_CATEGORIZATION_ORIGINAL_PREDICATES},getCriteriaStatus:function(e){var t=this._rootCriteriaStatus[e];return t||(t={},this._rootCriteriaStatus[e]=t),t},getFocusedCriteriaPath:function(){return this._focusedCriteriaPath},setFocusedCriteriaPath:function(e){this._focusedCriteriaPath=e},getExpandStatus:function(e){var t=this.getCriteriaStatus(e),i=t.expandStatus;return UWA.is(i)||(i=t.expandStatus=!1),i},setExpandStatus:function(e,t){if(!UWA.is(t,"boolean"))throw new Error("invalid status:"+t);this.getCriteriaStatus(e).expandStatus=t},getCriteriaInfo:function(e,t,a){var r,o=new i([],{model:n}),g=e.getCache().getSearchValue();if(g&&(r=g.toLowerCase()),e){var u=this._criteriaJSONInfo.predicate_Mapping,p=this._criteriaJSONInfo.category_resources,f={},m=this,v=function(e,t,i){var a=new n({criteriaId:e,title:s.getText(e),iconClass:t.iconClass,level:i||"level0",expandStatus:m.getExpandStatus(e)}),r=t.image;return r?a.set("imageURL",h.getImagePath(r)):a.set("iconClass",t.iconClass),a.setAsContainer(),a},T=function(e){if(e){var t=f[e];if(!t){var i=p[e];if(!i.parent)(t=o.get(e))||(t=v(e,i),o.add(t),f[e]=t);else{t=v(e,i,"level1"),f[e]=t;var a=T(i.parent);a&&a.addSubCategory(t)}}return t}},C=function(e){for(var t;p[e]&&(t=p[e].parent);)e=t;return p[e]?p[e].iconClass:void 0},w=function(e,i){e.count=i;var a=e.getUri(),r=e.pred;if("ds6w:typeCategory"==r.id())if(UWA.is(a,"array")&&a.length>0)if(1==a.length){var s=new n({criteriaId:a,title:e.getDisplayValue(),level:"level0",count:e.getCount(),predicate:r,rootIconClass:"generic"});s.set("imageURL",e.icon),o.add(s)}else{var c;try{c=T(a[a.length-2])}catch(e){l.error("Error during building category hierarchy for: "+a[a.length-2])}if(c){var d=c.getSubCategory(a);d||c.addSubCategory(d=new n({criteriaId:a,title:e.getDisplayValue(),parentCriteriaId:c.id,level:"level1",predicate:r}));var g=C(a[0]);g?d.set("iconClass",g):(l.error("FAILED to compute root category icon for:"+a[0]),d.set("iconClass","fonticon-tn-alert")),d.updateCount(e.getCount())}}else l.error("ds6w:typeCategory tag value is not an array or empty array: "+a);else{var p="ds6w:docExtension"==r.id(),f=u[r.id()][p?a.toUpperCase():a];if(f){if(t&&f.exclude_for_type_categorization)return;var m=f.category;if(UWA.is(m,"string")&&(m=[m]),p&&0==m.length&&(m=["category-Document-Other"]),m)m.forEach(function(t){var i=T(t),s=i.getSubCategory(a);s||i.addSubCategory(s=new n({criteriaId:a,title:e.getDisplayValue(),parentCriteriaId:i.id,level:"level1",isOther:f.isOther,predicate:r}));var o=f.image;if(o)s.set("imageURL",h.getImagePath(o));else{var l=f.iconClass;l?s.set("iconClass",l):s.set("iconClass",C(t))}s.updateCount(e.getCount())}.bind(this));else{var v=new n({criteriaId:a,title:e.getDisplayValue(),level:"level0",count:e.getCount(),predicate:r});f.iconClass?v.set("iconClass",f.iconClass):f.image&&v.set("imageURL",h.getImagePath(f.image)),o.add(v)}}}}.bind(this),b=u.active_predicates;if(UWA.is(a,"array")&&a.length>0)b=a;else if(t){if(!c.getOption("typeCategoryFromSynthesis")){var y=b.indexOf("ds6w:typeCategory");-1!=y&&y<=b.length&&b.splice(y,1)}}else b=["ds6w:type"];e.eachTagValue(function(e,t){r?r&&-1!==e.getDisplayValue().toLowerCase().indexOf(r)&&w(d.getWrapper(e),t):w(d.getWrapper(e),t)},{allTagsOfType:b})}return o},removeDuplicates:function(e){var t=new i([],{model:n});return e.forEach(function(e){if(e.isContainer())t.add(e);else{var i=t.find(function(t){return t.get("title")===e.get("title")});i?i.setAsComposite().add(e):t.add(e);var a=e.get("subCategories");a&&a.length&&h.removeDuplicates(a)}}),t},getAllCriteriaModel:function(e,t){var a=new n({criteriaId:h.ALL_MODEL_ID,parentCriteriaId:e.id,title:s.getText("all"),iconClass:e.get("iconClass"),level:"level1",subCategories:new i([],{model:n})});return t.forEach(function(e){a.addSubCategory(e),a.updateCount(e.getCount())}),a},getOtherCriteriaModel:function(e,t){var a,r=0;return t.forEach(function(t){!0===t.get("isOther")&&(++r,a||(a=new n({criteriaId:h.OTHER_MODEL_ID,rootCriteriaId:e.id,title:s.getText("others"),iconClass:e.get("iconClass"),level:"level1",subCategories:new i([],{model:n})})),a.addSubCategory(t),a.updateCount(1))}),{nbOthers:r,model:a}},buildCondition:function(e,t,i){var a={id:h.TYPE_CATEGORIZATION_PREDICATE,operator:i||"OR",isComplex:!0,condition:{type:"string",object:e instanceof n?e.id:e.object,operator:"OR",value:[],display:e instanceof n?e.get("title"):e.dispValue,predicates:[]}};t&&(a.condition.excluded=t);var r=h.ALL_MODEL_ID===e.id,l=e instanceof n&&e.isContainer();if(r||l){a.condition.object=r?e.get("parentCriteriaId"):e.id,a.condition.display=s.getText(a.condition.object);for(var c=e.get("subCategories"),d=0;d<c.length;d++){var g=c.at(d);(u=g.getRefineStructure()).isComposite&&(a.condition.hasComposites||(a.condition.hasComposites=[]),a.condition.hasComposites.push(d)),u.forEach(function(e){a.condition.value.push(e.object),a.condition.predicates.push({predicate:e.predicate,type:e.type,dispValue:g.get("title"),isComposite:e.isComposite})})}}else if(e instanceof n){var u=e.getRefineStructure();e.isComposite()&&(a.isComposite=!0,a.condition.object=u[0].object),a.condition.predicates.push({predicate:u[0].predicate,type:u[0].type,dispValue:u[0].dispValue}),a.condition.value.push(u[0].object)}else if(e instanceof o){a.condition.object=e.getUri(),a.condition.display=e.getDisplayValue();var p=e.pred;e.isComposite&&(a.isComposite=!0,a.condition.object=e.getUri()),a.condition.value.push(e.getUri()),a.condition.predicates.push({predicate:p.getFullPredicateID(),type:p.getType(),dispValue:e.getDisplayValue()})}else e.isComposite&&(a.isComposite=!0,a.condition.object=e.object),a.condition.value.push(e.object),a.condition.predicates.push({predicate:e.predicate,type:e.type,dispValue:e.dispValue});return a},isSupportedAction:function(e,t){var i=!1;switch(t){case u.ACTION_SELECT:case u.ACTION_EXCLUDE:case u.ACTION_EDITTAGREL:e.hasAdvancedFocsuedProxy(void 0,h.TYPE_CATEGORIZATION)?l.log(t+" action is not supported yet.."):i=!0}return i},getSelectionIndex:function(e,t){return e.findIndex(function(e){if(UWA.is(e,"object")){if(!t.isComposite)return t.object===e.object&&t.predicate===e.predicate;if(e.isComposite&&t.object.length==e.object.length){var i=0;return t.object.forEach(function(t,a){t==e.object[a]&&i++}),i==t.object.length}}})},getImagePath:function(e){return a.getWebappsBaseUrl()+h.ICONS_PATH+e},getCategorizationInfo:function(e){var t=[];if(e&&e.id&&e.predicate){var i=this._criteriaJSONInfo.predicate_Mapping[e.predicate];if(i){var a=i[e.id];if(a&&a.category){var n=a.category;if(n){t.push(n);for(var r,s=this._criteriaJSONInfo.category_resources;r=s[n];)r.parent&&t.push(r.parent),n=r.parent}}}}return t},getCategorizedPredicates:function(){return this.TYPE_CATEGORIZATION_ORIGINAL_PREDICATES}});return h}),define("DS/TagNavigator/simplified/model/PersonModel",["UWA/Core","UWA/Class/Model","UWA/Class/Debug","DS/TagNavigator/TaggerUtils"],function(e,t,i,a){"use strict";return t.extend(i,{defaults:{title:"",personInfo:null,tagValues:[],count:"",activePredicates:[]},setup:function(){this._parent()},getImage:function(){var e=this.get("personInfo");if(e&&1===e.get("nbMatches")){var t=e.get("imageURL");return 1===t.length?t[0]:a.defaultUserImage}return a.defaultUserImage},getCountry:function(){var e=this.get("personInfo");return e?e.get("country"):[]},getCountryCode:function(){var e=this.get("personInfo");return e?e.get("countryCode"):[]},getCity:function(){var e=this.get("personInfo");return e?e.get("city"):[]},isReady:function(){var e=this.get("personInfo");return!e||e.get("isReady")},getNbMatches:function(){var e=this.get("personInfo");if(e)return e.get("nbMatches")},getCount:function(){var e=this.getUniqueTagValuesPerPredicate(),t=[];for(var i in e){var a=e[i];t.push(a[0].count);for(var n=1;n<a.length;n++)t[t.length-1]+=a[n].count}return 1==t.length||t.every(function(e){return e==t[0]})?{exactCount:!0,count:t[0]}:t.reduce(function(e,t){return t>e?t:e},0)},getUniqueTagValuesPerPredicate:function(){var e=this.get("tagValues"),t={};return UWA.is(e,"array")&&e.forEach(function(e){var i=e.pred.id(),a=t[i];a?a.push(e):t[i]=a=[e]}),t},getApplicablePredicatesAsString:function(){var e=this.get("tagValues"),t="";return e.forEach(function(e,i){t+=(i>0?", ":"")+e.pred.id()}),t},getApplicablePredicates:function(){var e=this.get("tagValues"),t=[];return e.forEach(function(e,i){t.push(e.pred)}),t},getTagValueIds:function(){var e=this.get("tagValues"),t=[];return e.forEach(function(e){t.push(e.getUri())}),t},getRefineStructure:function(e){return{predicate:e||this.getApplicablePredicates()[0].getFullPredicateID(),object:this.getTagValueIds()[0],dispValue:this.get("title"),type:this.get("type")||"string"}}})}),define("DS/TagNavigator/simplified/utils/PersonUtils",["UWA/Core","UWA/Class","UWA/Class/Collection","DS/TagNavigator/Logger","DS/TagNavigator/TagValue","DS/TagNavigator/TaggerUtils","DS/TagNavigator/simplified/model/PersonModel","DS/TagNavigator/simplified/model/TagValueWrapper","DS/TagNavigator/simplified/model/PersonInfo","DS/TagNavigator/Predicate","DS/TagNavigator/TaggerNLS","DS/TagNavigator/TaggerSettings","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/TagNavigator/TagsServer"],function(e,t,i,a,n,r,s,o,l,c,d,g,u,h){"use strict";var p=t.singleton({PERSON_REFINE:"person_data",PERSON_PREDICATE:"person",PERSON_REFINE_PREDICATE:"ds6w:who/person",init:function(e){this.personPredicate=new c({sixw:this.PERSON_REFINE_PREDICATE,type:"string",displayName:d.getText("personTitle")})},userInfoCache:{},userInfoCache_ext:{},_expansionStatus:{},userInfoFetchingProgressCache:{},getUserInfoFromCache:function(e,t,i){if(e){var a=i?this.userInfoCache_ext[e]:this.userInfoCache[e];if(a)return a.get(t)}},getExpandStatus:function(e){return this._expansionStatus[e]},setExpandStatus:function(e,t){if(!UWA.is(t,"boolean"))throw new Error("invalid status:"+t);this._expansionStatus[e]=t},getUsersInfo:function(e,t,n){if(e){var r;if(UWA.is(t,"array")?r={allTagsOfType:t}:UWA.is(t,"string")&&(r={allTagsInheritingFromType:t}),r){var c={};e.eachTagValue(function(e,t){var i=e.getDisplayValue(),a=o.getWrapper(e,t);a.count=t,c[i]?c[i].tagValues.push(a):c[i]={tagValues:[a]}},r);var d,u=[],h=e.getTagsServerForUserInfo();h&&(d=h.getTenantName(),this.userInfoCache[d]||(this.userInfoCache[d]=new i([],{model:l})));var p=[];for(var f in c){var m=new s;if(u.push(m),c[f]&&(m.set("title",f),m.set("tagValues",c[f]&&c[f].tagValues?c[f].tagValues:[]),m.set("count",c[f].tagValues[0].count),m.set("expandStatus",this.getExpandStatus(f))),d){var v=this.getUserInfoFromCache(d,f);v||(v=new l({title:f}),this.userInfoCache[d].add(v),p.push(f)),m.set("personInfo",v)}}return g.getOption("offline6W")?a.warn("PersonUtils: Offline mode: Tagger won't fetch user data"):h&&p.length>0&&this._retriveUsersInfo(h,p,e.getUserInfo(),n),u}}},getUsersInfoFromSummary:function(e,t,n){var r=[],c=t.platformID;if(UWA.is(e,"array")&&c.length>0){var d=this,g={};e.forEach(function(e){var t=o.getWrapperFromTagInfo(e),i=t.displayValue;g[i]?g[i].tagValues.push(t):g[i]={tagValues:[t]}}),this.userInfoCache_ext[c]||(this.userInfoCache_ext[c]=new i([],{model:l}));var p=[];for(var f in g){var m=new s;r.push(m),g[f]&&(m.set("title",f),m.set("tagValues",g[f].tagValues),m.set("count",g[f].tagValues[0].count));var v=this.getUserInfoFromCache(c,f,!0);v||(v=new l({title:f}),this.userInfoCache_ext[c].add(v),p.push(f)),m.set("personInfo",v)}p.length>0?u.getServiceUrl({serviceName:"3DSearch",platformId:c,onComplete:function(e){d._retriveUsersInfo(new h(e,c,c),p,t.userId,function(){n(r)},!0)},onFailure:function(){a.error("FAILED to retrieve 3DSearch url for tenant: "+c),n(r)}}):n(r)}return r},_retriveUsersInfo:function(e,t,i,n,s){var o=this,l=[],c=e.getTenantName(),d=function(){t.forEach(function(e){a.log("computation is done for "+e);var t=o.getUserInfoFromCache(c,e,s);t&&t.set("isReady",!0)})},g=function(e){var t;UWA.is(e,"array")&&e.forEach(function(e){var i=r.buildFedSearchModel(e);if(i){t=i.get("ds6w:label");var n=o.getUserInfoFromCache(c,t,s);if(n){n.incrementNbMatches();var d=i.get("preview_url"),g=i.get("ds6w:country"),u=i.get("ds6w:city");d&&n.setArrayProperty("imageURL",d),g&&n.setArrayProperty("country",g),g&&n.setArrayProperty("countryCode",g),u&&n.setArrayProperty("city",u),l.push(n)}else a.warn("user info received for '"+i.get("ds6w:label")+"' is not in the tag value data")}})};e.getUsersInfo(i,t,function(t){t.forEach(function(e){e.then(g)}),Promise.all(t).then(function(){var t=function(){d(),UWA.is(n,"function")&&n(l)};o.translatePersonDetails(e,l).then(t,t)})},function(){d(),a.warn("FAILED to retrieve user info")})},translatePersonDetails:function(e,t){return new Promise(function(r,s){a.log("PersonUtils: handling the modle updates"),e&&UWA.is(t,"array")||s();var o=new i([],{model:l}),c=n.getPredicateNlsValueMap(e,"ds6w:country");if(t.forEach(function(e){e.get("country").forEach(function(t,i){if(t){var r=t.split("."),s=n.getTagValueNls(r[0],r[1]);s?e.setArrayProperty("country",s,i):(a.log("PersonUtils: add "+r[1]+" for translation"),o.add(e),c[r[1]]=!0)}})}),o.length>0){if(a.log("PersonUtils: number of modelsWithPendingNls = "+o.length),0!==Object.keys(n.getTvToTranslate()).length){a.log("TagValue.getTvToTranslate() OK");var d=n.getPredicateValue();a.log("nb promises to treat="+d.length),Promise.all(d).then(function(){a.log("update nls after all promises resolved"),o.forEach(function(e){var t=e.get("country");t.forEach(function(i,r){if(i){var s=i.split(".");if(s.length>1){var o=n.getTagValueNls(s[0],s[1]);o?(a.log(s[1]+" Nls="+o),e.setArrayProperty("country",o,r)):a.warn("NO NLS FOUND!!, title="+e.get("title")+", country="+t)}}})}),r()})}}else r()})},buildCondition:function(e,t,i,a){var n={id:p.PERSON_REFINE_PREDICATE,operator:a||"OR",isComplex:!0,condition:{type:"string",object:e instanceof s?e.get("title"):e.object,operator:"OR",value:[],display:e instanceof s?e.get("title"):e.dispValue,predicates:[]}};if(i&&(n.condition.excluded=i,n.condition.operator="AND"),e instanceof s)for(var r=e.get("tagValues"),o=0;o<r.length;o++){var l=r[o],c=l.pred,d=c.getFullPredicateID();t&&-1===t.indexOf(d)||(n.condition.predicates.push({predicate:d,type:c.getType()}),n.condition.value.push(l.getUri()))}return n},getExistingCondition:function(e,t){var i=e.getLocalFilter().computeFilterObj(!0),a=i.allfilters.condition.findIndex(function(e){return p.PERSON_REFINE_PREDICATE===Object.keys(e)[0]}),n=-1!==a?i.allfilters.condition[a]:void 0,r=void 0;return n&&(r=-1!==(a=n[Object.keys(n)[0]].condition.findIndex(function(e){return e.object===t}))?n[Object.keys(n)[0]].condition[a]:void 0),r},getActivePredicates:function(e,t){var i=[],a=this.getExistingCondition(e,t);return a&&a.predicates.map(function(e){i.push(e.predicate)}),i}});return p}),define("DS/TagNavigator/embeddedTagger/EmbeddedMenuItem",["UWA/Core","UWA/Utils","UWA/Class/View","DS/Handlebars/Handlebars","text!DS/TagNavigator/embeddedTagger/templates/EmbeddedMenuItemTemplate.html","DS/TagNavigator/TaggerSettings","DS/TagNavigator/Logger","DS/TagNavigator/TaggerNLS","DS/TagNavigator/TaggerUtils","DS/TagNavigator/simplified/model/CriteriaModel","DS/TagNavigator/simplified/model/PersonModel","DS/TagNavigator/simplified/utils/PersonUtils"],function(e,t,i,a,n,r,s,o,l,c,d,g){"use strict";return i.extend({tagName:"div",className:"tag-elem",template:a.compile(n),init:function(e){this.navImpl=e.navImpl,this.isPreciseCount=e.isPreciseCount,this._parent(e),this._catView=r.getOption("embeddedCategories")},setup:function(e){this._parent(e)},render:function(e){var t=this.template();return this.container.setContent(t),this.addContent(e),this._toggleTagSelection=this.onTagSelection.bind(this),this.container.addEvent("click",this._toggleTagSelection),this},addContent:function(){if(this.model instanceof d){this.container.getElement(".tag-icon").setStyle("display","none"),this.container.getElement(".tag-image").setAttributes({src:this.model.getImage()}),this.container.getElement(".tag-image").setStyles({width:"32px",height:"32px"}),this.container.getElement(".image-div").setStyle("display","inline-block");var e=this.model.getCount();e.exactCount?this.container.getElement(".tag-count").setText(o.convertToUnity(e.count,this.isPreciseCount)):this.container.getElement(".tag-count").setText(o.getText("atleast")+" "+o.convertToUnity(e,this.isPreciseCount)),this.container.getElement(".tag-label").setStyle("margin-left","5px"),!!this.navImpl.getFocusedProxy()&&this.navImpl.getFocusedProxy().getLocalFilter().isSelected(g.buildCondition(this.model))&&this.container.addClassName("selected")}else if(this.model instanceof c&&(this.container.getElement(".tag-icon").addClassName("tn-"+this.model.get("level")),this.model.get("imageURL")?(this.container.getElement(".tag-icon").setStyle("display","none"),this.container.getElement(".tag-image").setAttributes({src:this.model.get("imageURL")}),this.container.getElement(".tag-image").setStyles({"border-radius":"0"}),this.container.getElement(".image-div").setStyle("display","inline-block"),this.container.getElement(".image-div").addClassName("tn-"+this.model.get("level"))):this.container.getElement(".tag-icon").addClassName(this.model.get("iconClass")),this.getOption("selected")&&this.container.addClassName("selected"),this.container.getElement(".tag-count").setText(o.convertToUnity(this.model.get("count"),this.isPreciseCount)),this.model.get("rootIconClass"))){var i=this.model.get("rootIconClass").replace("fonticon-","");this.getElement(".tag-icon").addClassName("tn-"+i),this.getElement(".image-div").addClassName("tn-"+i)}this.container.getElement(".tag-label").setText(this.model.get("title")),this.setOption("identifier",t.getUUID().substr(0,6))},isSeparator:function(){return!1},setTitle:function(){this.container.getElement(".tag-label").setText(this.model.get("title"))},onTagSelection:function(e){this.container.toggleClassName("selected"),this.dispatchEvent("toggleSelection",{model:this.model})},updateCount:function(e){this.container.getElement(".tag-count").setText(o.convertToUnity(e,this.isPreciseCount))},destroy:function(){var e=this.getOption("subMenuItems");UWA.is(e,"array")&&e.forEach(function(e){e.destroy()}),this.container.removeEvent("click",this._toggleTagSelection),this.stopListening(),this.model=null,this._parent()}})}),define("DS/TagNavigator/simplified/views/EmptyView",["UWA/Core","UWA/Class/View","DS/TagNavigator/TaggerNLS"],function(e,t,i){"use strict";return t.extend({tagName:"div",className:"no-tags",render:function(){return this.container.setText(i.getText("noTags")),this},setMessageText:function(e){this.container.setText(e)},isVisible:function(){return!this.container.isHidden()},destroy:function(){this._parent()}})}),define("DS/TagNavigator/simplified/views/AllContentView",["UWA/Core","UWA/Class/View","DS/TagNavigator/TaggerNLS","DS/TagNavigator/simplified/views/EmptyView","DS/Controls/Expander","DS/MessageBus/MessageBus"],function(e,t,i,a,n,r){"use strict";return t.extend({tagName:"div",className:"all-content",_emptyView:void 0,_rootWViewContainers:{},init:function(e){this._parent(e)},setup:function(e){this._parent(e)},domEvents:{"click .rootw-arrow-container":"toggleAllRootWArea"},render:function(){this._emptyView=(new a).render(),this._contentDiv=e.createElement("div",{id:"all-tags"});var t=e.createElement("div",{class:"wrapper"});return this._emptyView.inject(t),this._contentDiv.inject(t),this.taggerView=this.getOption("taggerView"),this.taggerView.getRootWs().forEach(function(t){var a=t.split(":")[1];this._rootWViewContainers[t]=e.createElement("div",{id:"all-content-"+a,class:"all-content-w",html:{tag:"div",class:"item-circle",html:{tag:"span",class:"fonticon fonticon-3ds-"+a}}}).inject(this._contentDiv),e.createElement("div",{id:t,class:"rootw-expander",html:[{tag:"div",class:"rootw-arrow-container",html:[{tag:"div",class:"arrow",html:[{class:"fonticon fonticon-chevron-down",tag:"span"},{class:"fonticon fonticon-chevron-right",tag:"span"}]},{tag:"div",class:"rootw-label",text:i.getText(a)}]},{tag:"div",class:"content"}]}).inject(this._rootWViewContainers[t])}.bind(this)),this.allTagsExp=new n({domId:"tn-all-tags",header:i.getText("allContentDiv"),body:t,style:"simple",touchMode:!0,expandedFlag:!1}).inject(this.container),this},expand:function(e){var t=!!this.taggerView.observedNavImpl.getFocusedProxy()&&this.taggerView.observedNavImpl.getFocusedProxy().showAllBool;this.allTagsExp.expandedFlag=t||e},collapse:function(e){var t=!!this.taggerView.observedNavImpl.getFocusedProxy()&&this.taggerView.observedNavImpl.getFocusedProxy().showAllBool;this.allTagsExp.expandedFlag=!e&&!!t},isEmpty(){return this._emptyView.isVisible()},showHideHeader:function(e){e?this.container.removeClassName("hide-header"):this.container.addClassName("hide-header")},redraw:function(t,a){this._emptyView&&this._emptyView.hide();var n="",r=void 0;if(t.excludePreferred){var s=this.taggerView.hasFocusedProxy();s?(r=s.hasRelevantPredicates(),e.is(r,"array")&&0==r.length&&(r=void 0),r||(r=[]),r=r.concat(s.getHiddenPredicates())):(r=this.taggerView.observedNavImpl.hasPreferredPredicates())&&(r=r.concat(this.taggerView.observedNavImpl.hasHiddenPredicates()||[]))}for(var o in this._rootWViewContainers){if(a.includes(o)){o.replace("ds6w:",""),n=this.taggerView.availableTagsToHtml(o,void 0,void 0,!0,r);this._rootWViewContainers[o].getElement(".rootw-expander .content").setHTML(n),this._rootWViewContainers[o].show()}else this._rootWViewContainers[o].hide();this.setExpandStatus(this._rootWViewContainers[o],o,t&&t.onSearch,t&&t.searchString)}a.length<=1?this._contentDiv.removeClassName("root-border"):this._contentDiv.addClassName("root-border");var l=a.map(function(e){return function(e){var t={isEmpty:!1},i=e.getElements(".predicate:not(.searchexcluded)");if(i.length>0)i.forEach(function(e){e.show()});else{var a=e.getElements(".predicate.searchexcluded").length,n=e.getElements(".predicate").length;0===n?(t.isEmpty=!0,t.hasNoResults=!0):a==n&&0!=n&&(t.hasNoResults=!0)}return(t.isEmpty||t.hasNoResults)&&e.hide(),t}(this._rootWViewContainers[e])}.bind(this)),c=l.every(function(e){return e.isEmpty}),d=l.every(function(e){return e.hasNoResults});(c||d)&&(this._emptyView.show(),c?this._emptyView.setMessageText(i.getText("noTags")):this._emptyView.setMessageText(i.getText("noRslt")))},setExpandStatus:function(e,t,i,a){var n=this.taggerView.cacheForSimplified,r=n.getExpandCollapseStatusRootW("all",t);if(e.getElement("ul.predicates")){var s=e.getElement("ul.predicates")?e.getElement("ul.predicates").getElements("li.predicate").length:0,o=e.getElement("ul.predicates")?e.getElement("ul.predicates").getElements("li.predicate.searchexcluded").length:0;if(s>=1)e.getElement(".rootw-arrow-container").show(),i&&a&&s!=o?(e.getElement(".content").setStyles({position:"relative",overflow:"hidden",opacity:1,height:"auto",visibility:"visible"}),e.removeClassName("hide-left-border"),e.getElement(".rootw-arrow-container").addClassName("expanded"),n.setExpandCollapseRootWStatus("all",t,!0)):r?(e.getElement(".content").setStyles({position:"relative",overflow:"hidden",opacity:1,height:"auto",visibility:"visible"}),e.getElement(".rootw-arrow-container").addClassName("expanded"),e.removeClassName("hide-left-border")):(e.getElement(".content").setStyles({position:"absolute",opacity:0,height:"0",visibility:"hidden"}),e.addClassName("hide-left-border"),e.getElement(".rootw-arrow-container").removeClassName("expanded"));else{if(1==e.getElements("li.predicate").length){var l=e.getElement("li.predicate").getAttribute("predicate");this.taggerView.getExpandStatus(l)?e.removeClassName("hide-left-border"):e.addClassName("hide-left-border")}e.getElement(".content").setStyles({position:"relative",overflow:"hidden",opacity:1,height:"auto",visibility:"visible"})}}},toggleAllRootWArea:function(t){var i,a,n,s,o,l=t.target.getClosest(".rootw-arrow-container"),c=l.getClosest(".rootw-expander").id,d=this.taggerView.cacheForSimplified,g=d.getExpandCollapseStatusRootW("all",c);if(l){l.toggleClassName("expanded");var u=l.getClosest(".all-content-w");for(g?u&&u.addClassName("hide-left-border"):u&&u.removeClassName("hide-left-border"),n=0,s=(i=l.getParent().getChildren()).length;n<s;++n)(a=e.extendElement(i[n])).match(".content")&&(o=e.extendElement(a.getChildren()[0]),new e.Fx(a,{duration:300,transition:"quadInOut",events:{onComplete:function(){g?a.setStyles({position:"absolute",opacity:0,height:"0",visibility:"hidden"}):a.setStyles({position:"relative",overflow:"hidden",opacity:1,height:"auto",visibility:"visible"})},onStart:function(){a.setStyle("position","relative"),a.setStyle("overflow","hidden")}}}).start({height:g?[o.getSize().height,0]:[0,o.getSize().height]}));d.setExpandCollapseRootWStatus("all",c,!g)}r.publish({channel:"TaggerTrackerApi",topic:"hit",data:{category:"6WTagger",action:"clickOnRootW-All",persDim:{pd1:c,pd2:g?"collapsed":"expanded"}}})},destroy:function(){this._parent()}})}),define("DS/TagNavigator/Filter",["UWA/Core","DS/TagNavigator/TagValue","DS/TagNavigator/Logger"],function(e,t,i){"use strict";var a,n=[].slice;return a=function(e){var t,i,r,s,o;if(r=(s=2<=arguments.length?n.call(arguments,1):[])[0],o=2<=s.length?n.call(s,1):[],!(i=e?e[r]:void 0))return!1;if(o?o.length:null){if(t=(t=[i]).concat(o),!a.apply(null,t))return!1;if(Object.keys(i).length>0)return!0}return delete e[r]},function n(){var r,s,o,l,c,d,g;d={},g={},o=function(e,t,i){return a(d,e,t,i)},r=function(t,i,a,n,r,s){var o,l;if(!(t&&i&&a&&n))throw new Error("Unexpected Error");o=(o=(l={})[t]={})[i=i+"-"+(r?"composite":typeof a)]={};var c=r?a.join("#"):a;return o[c]={disp:n,uri:a},s&&(o[c].excluded=!0),e.extend(d,l,!0),!!(d[t]&&d[t][i]&&d[t][i][a])};var u=function(e){var t,i,a,n,r;if(t=e.pred.getFullPredicateID(),i=e.type+"-"+(e.isComposite?"composite":typeof e.uri),a=e.isComposite?e.uri.join("#"):e.uri,!(r=(n=d[t])&&n[i]?n[i][a]:null)&&"date"==e.type){var s=n?n[i]:null;if(s)for(var o=Object.keys(s),l=0;l<o.length;l++)if(-1!=o[l].indexOf(e.uri)||-1!=e.uri.indexOf(o[l])){r=s[o[l]];break}}return r};return l=function(e,t,a){if(!(e&&t&&a))throw new Error("Unexpected Error");i.log("Inside deleteAttribute, attribute="+e+", type="+t+", value="+(UWA.is(a,"object")?JSON.stringify(a):a));var n,r=!1;n=g[e="sixw:"+e];var s=UWA.is(a,"object")&&a.isSimplifiedCriteria;if(i.log("_sattribute BEFORE deleteAttribute = "+JSON.stringify(g)),n&&n[t])switch(t){case"string":case"boolean":var o=n[t].findIndex(function(e){return e.value===a});-1!==o&&n[t].splice(o,1),r=0===n[t].length;break;default:if(s){var l=n[t].findIndex(function(e){if(e.isSimplifiedCriteria&&e.from===a.from&&e.to===a.to)return!0});-1!==l&&n[t].splice(l,1),r=0===n[t].length}else{var c=n[t].findIndex(function(e){return!e.isSimplifiedCriteria});if(1===c)throw new Error("ERROR: criteria to remove does not exist");var d=n[t][c];a.from&&delete d.from,a.to&&delete d.to,d.excluded&&delete d.excluded,0===Object.keys(d).length&&n[t].splice(c,1),r=0===n[t].length}}return r&&delete g[e],i.log("_sattribute after deleteAttribute = "+JSON.stringify(g)),r},s=function(t,a,n,r){if(!(t&&a&&n))throw new Error("Unexpected Error");i.log("Inside addAttribute, attribute="+t+", type="+a+", value="+(UWA.is(n,"object")?JSON.stringify(n):n)+", nls="+r);var s=!1;r=r||n;var o=UWA.is(n,"object")&&n.isSimplifiedCriteria;i.log("_sattribute BEFORE addAttribute = "+JSON.stringify(g)),g[t="sixw:"+t]||(g[t]={});var l=g[t][a];switch(l||(l=g[t][a]=[]),a){case"boolean":case"string":var c={value:n,nls:r||n},d=-1;l.length>0&&(d=l.findIndex(function(e){return e.value===c.value})),-1===d&&l.push(c);break;default:if(o)l.length>0&&(s=l.every(function(e){if(e.isSimplifiedCriteria&&e.from===n.from&&e.to===n.to)return!0})),s||l.push(n);else{var u=l.filter(function(e){return!e.isSimplifiedCriteria});u.length>0?e.extend(u[0],n):l.push(n)}}return i.log("_sattribute after addAttribute = "+JSON.stringify(g)),!0},c=function(){var t,i,a,n,r;for(t={},r=function(){return!0},i=0,a=(n=["filterPredicates","filterTypes","filterValues"]).length;i<a;i++)t[n[i]]=r;return function(i,a,n){var r,s,o,l,c,g,u;for(l in s=e.clone(t),e.extend(s,a),d)if(s.filterPredicates(l))for(c in g=d[l])if(s.filterTypes(c)||s.isPartOfCompositeFilter&&s.isPartOfCompositeFilter(c))for(u in o=g[c])r=o[u].disp,s.filterValues(o[u].uri,o[u].excluded)&&(n?i(o[u]):i(l,o[u].uri,r,c));return this}}(),{each:function(e,i){return c(function(i,a,n,r){return e(t.getTagValue(i,n,a,r))},i),this},isEmpty:function(){return 0===Object.keys(d).length&&0===Object.keys(g).length},count:function(){return Object.keys(d).length+Object.keys(g).length},isSelected:function(e,t){var i,a,n,r;return i=e.pred.getFullPredicateID(),a=e.type+"-"+(e.isComposite?"composite":typeof e.uri),n=e.isComposite?e.uri.join("#"):e.uri,!!((r=d[i])&&r[a]&&r[a][n])||!(!r||-1===Object.keys(r).findIndex(function(i){if(-1!==i.indexOf("composite")){var a=r[i];if(-1!==Object.keys(a).findIndex(function(i){return UWA.is(e.uri,"array")?t?e.uri.every(function(e){return-1!==a[i].uri.indexOf(e)}):e.uri.length<=a[i].uri.length?e.uri.every(function(e){return-1!==a[i].uri.indexOf(e)}):a[i].uri.every(function(t){return-1!==e.uri.indexOf(t)}):-1!==a[i].uri.indexOf(e.uri)}))return!0}}))},isSelectedDate:function(e){var t,i,a;e.parent?e.parent.parent?t=!0:i=!0:a=!0;var n=this.getSelectedTagValues(e.pred.getFullPredicateID());if(n.length>0){var r=n.findIndex(function(n){return t?n.uri==e.uri:i||a?-1!=n.uri.indexOf(e.uri):void 0});if(-1!=r)return n[r]}},isSelectedAttribute:function(e,t){if(UWA.is(e,"string")&&UWA.is(t,"object")){var i=g[e];if(UWA.is(i,"object")&&(i=i[t.type],UWA.is(i,"array")&&i.length>0&&UWA.is(t.object,"object")))return-1!==i.findIndex(function(e){var i=!1;switch(t.type){case"date":case"integer":case"double":case"float":i=e.from===t.object.from&&e.to===t.object.to}return i})}},getSelectedAttributes:function(e){if(!e)return null;var t,i,a,n,r;for(a in t=(r={})[e]=[],i=g[e])if("string"!=a||"boolean"!=a)for(var s=0;s<i[a].length;s++)n={object:{from:i[a][s].from,to:i[a][s].to},type:a},t.push(n);return r},excludeAttribute:function(e,t,i,a){if(!e)return null;var n,r;for(r in n=g[e])if("string"!=r||"boolean"!=r)for(var s=0;s<n[r].length;s++){let e=n[r][s].nls?n[r][s].nls:void 0;(e&&e==t||i&&n[r][s].from&&i.from&&n[r][s].to&&i.to&&n[r][s].to==i.to&&n[r][s].from==i.from||i&&n[r][s].from&&i.from&&n[r][s].from==i.from||i&&n[r][s].to&&i.to&&n[r][s].to==i.to)&&(a?n[r][s].excluded=!0:n[r][s].excluded&&delete n[r][s].excluded)}},getSelectedTagValues:function(e){var t,i,a=[];return t={filterPredicates:function(t){return t===e}},i=function(e){a.push(e)},this.each(i,t),a},clear:function(){return d={},g={},this},computeDates:function(e,i){var a,n;return n={disptext:(a=t.getTagValue({object:i.uri,sixw:e,type:"date"})).displayValue},a.parent&&(n.parent={disptext:a.parent.displayValue,object:a.parent.uri,type:"date"},i.excluded&&(n.parent.excluded=i.excluded),a.parent.parent&&(n.parent.parent={disptext:a.parent.parent.displayValue,object:a.parent.parent.uri,type:"date"},i.excluded&&(n.parent.parent.excluded=i.excluded))),n},computeFilterObj:function(t,i,a,n,r){var s,o,l,c,u,h,p,f,m,v,T,C,w,b,y,S,E,I;if(s=(c={}).allfilters={},i=i||{},!1!==a)for(u in d)for(f in p=s[u]=[],m=d[u])for(v in l=m[f]){o=l[v].disp;var x=-1!==f.indexOf("composite");x&&!r?l[v].uri.forEach(function(e){h={disptext:o,object:e,type:f.split("-")[0],field:["implicit"]},l[v].excluded&&(h.excluded=!0),p.push(h)}):("date-string"==f&&a&&(I=this.computeDates(u,l[v])),h={disptext:I?I.disptext:o,object:l[v].uri,type:f.split("-")[0],field:x?["implicit"]:i[u+f.split("-")[0]+v+f.split("-")[1]]?Object.keys(i[u+f.split("-")[0]+v+f.split("-")[1]]):[],parent:I?I.parent:void 0},x&&r&&(h.isComposite=!0),l[v].excluded&&(h.excluded=!0),p.push(h),I=null)}if(!a)for(b in g)for(S in y=g[b],w=s[b=b.replace("sixw:void/","sixw:")]=[],y){if(!e.is(y[S],"array"))throw new Error("ERROR: INVALID data in filter..");if("string"===S||"boolean"===S)for(var _=y[S],A=0;A<_.length;A++)E={object:_[A].value,type:S,displayValue:_[A].nls},y[S][A].hasOwnProperty("excluded")&&(E.excluded=y[S][A].excluded),w.push(E);else for(var N=0;N<y[S].length;N++)E={type:S,object:{from:y[S][N].from,to:y[S][N].to},displayValue:y[S][N].nls,isSimplifiedCriteria:y[S][N].isSimplifiedCriteria},y[S][N].hasOwnProperty("excluded")&&(E.excluded=y[S][N].excluded),w.push(E)}if(t){for(u in c.allfilters)if(t.allfilters[u])for(T=0,C=c.allfilters[u].length;T<C;T++)"date"===c.allfilters[u][T].type?c.allfilters[u][T].object.length>t.allfilters[u][T].object.length&&(t.allfilters[u]=c.allfilters[u]):t.allfilters[u].push(c.allfilters[u][T]);else t.allfilters[u]=c.allfilters[u];return t}return c},removeFreeInput:function(e,t,i,a,n){return l(e,t,i)},createFreeInput:function(e,t,i,a,n){return s(e,t,i,a)},toggle:function(e,t){var i,a,n,s,l,g,h;a=e.pred.getFullPredicateID(),n=e.type,l="date"===n,s=e.uri,i=!1,g=!1;var p=!1;return c(function(t,i,a,n){if(g)throw new Error("Unexpected error");if(l){var r=u(e);r&&!0===r.excluded&&(p=!0)}return g=o(t,n,e.isComposite||h?i.join("#"):i)},{filterPredicates:function(e){return e===a},filterTypes:function(t){return t===n+"-"+(e.isComposite?"composite":typeof s)},isPartOfCompositeFilter:function(e){var t=d[a];if(t){var i=t[e],n=Object.keys(i).findIndex(function(e){return-1!==i[e].uri.indexOf(s)});if(-1!==n)return h=i[Object.keys(i)[n]],!0}},filterValues:function(e,a){return h?(i=!0,!0):(n=Array.isArray(e)?e.equals(s):e===s,l&&0===e.indexOf(s)&&(n=!0),n&&t&&(n=!!a),i=i||n,n||l);var n}}),i&&l&&e.parent?(s=e.parent.uri,i=!1):!i&&g&&l&&!e.parent&&(i=!0),p&&(t=!0),!i&&r(a,n,s,e.displayValue,e.isComposite,t)},handleExclude:function(e,t){var i=u(e);if(i)if(t){if(i.excluded)throw new Error("Tag is already excluded !");i.excluded=!0}else{if(!i.hasOwnProperty("excluded"))throw new Error("Tag is NOT already excluded !");delete i.excluded}},isExcluded:function(e){var t=u(e);return!(!t||!t.hasOwnProperty("excluded"))&&t.excluded},_setAttributes:function(e,t){d=e,g=t},cloneFilter:function(){var e=new n;return e._setAttributes(UWA.clone(d),UWA.clone(g)),e}}}}),define("DS/TagNavigator/simplified/actions/Select",["UWA/Core","DS/TagNavigator/simplified/actions/AbstractAction","DS/TagNavigator/simplified/actions/ActionUtils","DS/TagNavigator/simplified/utils/PersonUtils","DS/TagNavigator/simplified/utils/CriteriaUtils"],function(e,t,i,a,n){"use strict";return t.extend({setup:function(){this._parent(),this.set({actionClass:"selected"}),this._selection=this.get("selection")},onPredicateSelection:function(e){TNLog.log("No action on predicate selection during SELECT")},onTagSelection:function(e){return i.onTagMultiSelection(e,this._selection),this.get("isInteractive")&&(e.hasClassName("selected")&&(e.removeClassName("selected"),e.removeClassName("picked")),this.get("isInteractive")&&this.set("selectionCount",this.getSelectionCount())),!1},onPersonSelection:function(e){var t,i=e.view,n=e.refineData;if(e.hasOwnProperty("selectedPredicates")){if(-1!==(s=this._selection.findIndex(function(t){if(UWA.is(t,"object")&&e.isComplex&&t.isComplex&&t.id==a.PERSON_REFINE_PREDICATE)return t.condition.object===i.model.get("title")}))&&this._selection.splice(s,1),e.selectedPredicates.length>0){var r=a.buildCondition(i.model,e.selectedPredicates);this._selection.push(r)}else r=a.buildCondition(i.model,e.selectedPredicates);t=r}else if(i.container.hasClassName("picked")){var s;if(i.container.removeClassName("picked"),-1===(s=this._selection.findIndex(function(t){if(UWA.is(t,"object"))return e.isComplex?n.id==t.id&&n.condition&&t.condition&&n.condition.object===t.condition.object:n.object===t.object&&n.predicate===t.predicate})))throw new Error("the tag is not already selected");this._selection.splice(s,1),i.setAsUnselected(),t=n}else i.isSelected()?(i.setAsUnselected(),this._selection.push(n),t=n):(i.container.addClassName("picked"),i.setAsSelected(),this._selection.push(n),t=n);return this.get("isInteractive")&&this.set("selectionCount",this.getSelectionCount()),t},onCriteriaSelection:function(e){var t=e.view,i=t.model,a=this.get("actionClass");if(!e.isComplex){if(e.isContainer){if(t.isSelectedForAction(a)){if(t.setAsUnselectedForAction(a),-1===(s=n.getSelectionIndex(this._selection,i.getRefineStructure(!0)[0])))throw new Error("the tag is not already selected");this._selection.splice(s,1),t.setAsUnselectedForAction(a),t.setAsContainer()}else if(i.get("selected"))this._selection.push(i.getRefineStructure(!0)[0]),t.setAsUnselected();else{var r=[];i.getSelectedSubCategories(r),r.forEach(function(e){var t=e.getRefineStructure(!0)[0],i=n.getSelectionIndex(this._selection,t);-1!==i?this._selection.splice(i,1):(t.doNotCount=!0,this._selection.push(t))}.bind(this)),r=[],t.getSelectedSubCategoriesForAction(a,r),r.forEach(function(e){var t=e.model.getRefineStructure(!0)[0],i=n.getSelectionIndex(this._selection,t);-1!==i&&this._selection.splice(i,1)}.bind(this)),this._selection.push(i.getRefineStructure(!0)[0]),t.setAsSelectedForAction(a),t.setAsLeaf()}this.set("selectionCount",this.getSelectionCount())}else{if(t.isSelectedForAction(a)){var s;if(t.setAsUnselectedForAction(a),-1===(s=n.getSelectionIndex(this._selection,i.getRefineStructure(!0)[0])))throw new Error("the tag is not already selected");this._selection.splice(s,1),t.setAsUnselectedForAction(a)}else this._selection.push(i.getRefineStructure(!0)[0]),t.setAsSelectedForAction(a);this.set("selectionCount",this.getSelectionCount())}return i.getRefineStructure(!0)[0]}},onDateSelection:function(e){this._selection.push(e.freeInputData),this.set("selectionCount",this.getSelectionCount()),console.log("The selection dates: "+JSON.stringify(this._selection))},removeDate:function(e){var t=this._selection.findIndex(function(t){if(t.type&&"date"==t.type&&t.to==e.to&&t.from==e.from)return t});this._selection.splice(t,1),this.set("selectionCount",this.getSelectionCount())}})}),define("DS/TagNavigator/userTags/utils/UserTagsUtils",["UWA/Core","UWA/Class","UWA/Class/Promise","DS/WAFData/WAFData","DS/TagNavigator/TaggerSettings","DS/TagNavigator/Logger","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/TagNavigator/TagValue","DS/TagNavigator/TaggerUtils","DS/TagNavigator/TaggerNLS","DS/TagNavigator/TagsServer","DS/TagNavigator/Predicate"],function(e,t,i,a,n,r,s,o,l,c,d,g){"use strict";var u={},h={},p=[],f={},m={};let v,T,C,w={},b={},y={},S={"pid:":"3DSpace","swym:":"3DSwym","driveid:":"3DDrive"},E=function(e){var t;if(UWA.is(e,"object")&&-1!=p.indexOf(e.sixw))if(t={object:e.object,object_db:e.object},UWA.is(e.object,"array")&&e.object.length>1){if(0==e.object[0].indexOf(o.SIXW_ROOT_ONTOLOGY))if(2==e.object.length&&0==e.object[1].indexOf(o.COMMUNITY_TAG)){t.isCommunityTag=!0;let i=e.object[1].replace(o.COMMUNITY_TAG,"");t.dispValue=[e.object[0],i],t.label=i,t.object_db=t.object.join(o.BELCHAR)}else 2==e.object[1].split(":").length&&(t.isOntologyTag=!0)}else if(UWA.is(e.object,"string")&&0==e.object.indexOf(o.SIXW_ROOT_ONTOLOGY)){let i=e.object.split(o.COMMUNITY_TAG);2==i.length&&(t.isCommunityTag=!0,t.dispValue=i[1].replace(o.COMMUNITY_TAG,""),t.label=t.dispValue)}return t},I=function(t,i,n){if(t&&(t.communityName||t.communityId)&&t.platformId){r.log("Inside fed search suggestions, with tenant:"+t.platformId||NaN+t.communityName);s.getServiceUrl({serviceName:"3DSearch",platformId:t.platformId,onComplete:function(s){r.log("fed search url from compass: "+s),function(s){var o={label:t.appName+"-"+t.currentUser+"-"+(new Date).getTime(),query:"",with_nls:!1,with_synthesis:!0,with_indexing_date:!1,source:["swym"],tenant:t.platformId,start:0,nresults:1};t.query?(r.log("query param is provided, using it for fedsearch request, query="+t.query),o.query=t.query):t.communityId?(r.log("communityId is provided, using ity for fedsearch request, communityId="+t.communityId),o.query='[ds6w:containerUid]: ("'+t.communityId+'")'):(r.log("communityId is NOT provided, using communityName for fedsearch request, communityName="+t.communityName),o.query='[ds6w:community]: ("'+t.communityName+'")');var l={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},data:e.Json.encode(o),url:s+"/search",onComplete:function(e){var t;try{t=JSON.parse(e)}catch(e){t=e}return i(t)},onFailure:function(e){var t;try{t=JSON.parse(e)}catch(e){t=e}return n(t)}};a.authenticatedRequest(l.url,l)}(s)},onFailure:function(){r.error("FAILED to retrieve 3DSearch url for tenant: "+t.platformId),n("FAILED to retrieve 3DSearch url for tenant"+t.platformId)}})}},x=function(e){if(e.mode=e.mode||n.getOption("communityTagsFetchMode"),"database"==e.mode)return new i(function(t,i){l.getExistingUserTags({platformId:e.platformId,subject_uri:e.communityId}).then(function(e){let i=[];if(UWA.is(e.data,"array")&&1==e.data.length&&UWA.is(e.data[0].tag,"array")){let t,a=e.data[0].tag.map(function(e){return{sixw:e.predicate,object:e.object.literal,type:e.object.literalType.split(":")[1]}});r.log("Number of existing tags found from DB query="+a.length),i=a.filter(function(e){if((t=E(e))&&t.isCommunityTag)return e.dispValue=t.dispValue,e.label=t.label,e.object_db=e.object,!0})}t({communityTags:i})},function(e){i(e)})});{let t=(e.communityId||e.communityName)+"_"+e.platformId,a=u[t];return a||(u[t]=a=new i(function(t,i){let a={platformId:e.platformId,appName:e.appName,currentUser:e.currentUser};e.communityId?(a.communityId=e.communityId,a.query='[ds6w:resourceUid]: ("'+e.communityId+'")'):e.communityName&&(a.communityName=e.communityName,a.query='[ds6w:type]:"swym:community" AND [ds6w:label]: ("'+e.communityName+'")'),I(a,function(e){var i=[];e&&e.facets&&UWA.is(e.facets,"array")&&e.facets.forEach(function(e){if(e.field==o.EXPLICIT_TAG){var t=E(e);t&&t.isCommunityTag&&i.push({sixw:e.sixw,object:e.object,object_db:t.object_db,field:e.field,type:e.type,count:e.count,dispValue:t.dispValue,label:t.label})}}),t({communityTags:i})},function(e){i("FAILED to retrive community tags")})})),a}},_=function(e,t,a,n,s){return r.log((s?"CREATE ":"DELETE ")+n.length+" tags"),new i(function(i,r){let o=new d(e,t,t),l={tag:n.map(function(e){return{subject:[{uri:a}],predicate:e.sixw,object:{literal:e.object}}})},c=function(){i()},g=function(){r("FAILED to "+(s?"CREATE tags":"DELETE tags"))};s?o.putTag(l,!0,c,g,!1):o.deleteTag(l,!0,c,g,!1)})},A=function(e,t){return t||(t="asc"),e.sort(function(e,t){return e.label.toUpperCase().localeCompare(t.label.toUpperCase())}),"desc"==t?e.reverse():e},N=function(e){var t={};return e.forEach(function(e){var i=t[e.sixw];i||(t[e.sixw]=i=[]),i.push(UWA.clone(e))}),t},V=function(e,t){return t||(t="asc"),e.sort(function(e,t){return t.count-e.count}),"desc"==t?e.reverse():e},P=function(e,t){let i=(t=t||{}).text||"";return i&&(i=i.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toUpperCase()),e.filter(function(e){return!t.text||e.label.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toUpperCase().indexOf(i)>-1})};var D=t.singleton({init:function(){p=n.getOption("simplifiedRootW"),f=n.getOption("rootW_Concepts_Mapping"),w=n.getOption("concepts_rootW_Mapping"),v=n.getOption("enableBelchar"),T=new RegExp(o.BELCHAR,"gi"),b=n.getOption("rootW_companyPredicate_Mapping"),y=n.getOption("companyPredicate_Concepts_Mapping"),C=n.getOption("persistTagWithFullLineage")},getVocabularySuggestions:function(e){if(UWA.is(e,"object")&&(e.tagsServer||e.platformId)){var t=e.tagsServer?e.tagsServer.getTenantName():e.platformId,a=m[t];return a||(m[t]=a=new i(function(i){var a=function(e,t,a){UWA.is(a,"object")||(a={});var n=[];p.forEach(function(e){var t={};t[e]=UWA.is(a[e],"object")?a[e]:{literalInfo:[],individualInfo:[]},n.push(t)}),i(n)};e.tagsServer?e.tagsServer.getVocabularySuggestions(t,e.rootWs||p,a):l.getPredicateRangeValues({platformId:t,predicates:e.rootWs||p,lang:e.lang||c.getLang(),onComplete:a})})),a}},getRootWSequence:function(){return UWA.clone(p)},getSourceFromSubjectURI:function(e){var t=Object.keys(S).filter(function(t){return 0==e.indexOf(t)});if(Array.isArray(t)&&t.length>0)return S[t[0]]},getUserTagsByFedSearch:function(e){if(UWA.is(e,"object")&&(e.communityName||e.communityId)&&e.platformId){var t=(e.communityName||e.communityId)+"_"+e.platformId,a=h[t];return a||(h[t]=a=new i(function(t){e.communityId?e.query='[ds6w:containerUid]: ("'+e.communityId+'")':e.query='[ds6w:community]: ("'+e.communityName+'")',I(e,function(i){if(i&&i.facets&&UWA.is(i.facets,"array")){var a=[];i.facets.forEach(function(e){if(e.field==o.EXPLICIT_TAG){let t={};t.sixw=e.sixw,t.object=e.object,t.count=e.count;let i=E(e);i&&(t.label=i.label?i.label:e.object,t.dispValue=i.dispValue?i.dispValue:e.object,t.object_db=i.object_db),a.push(t)}})}var n={id:e.id,suggestions:a};t(n)},function(){var i={id:e.id,suggestions:[]};r.error("FAILED to suggestions from fed search call"),t(i)})})),a}},getCommunityTags:function(e){if(e&&(e.communityId||e.communityName)&&e.platformId)return new i(function(t,i){e.mode=e.mode?e.mode:"index",x(e).then(function(i){let a,n=e.sort||"";if("rootW-alpha"==n){var r=N(i.communityTags);a=[],p.forEach(function(e){let t=r[e];t&&(a=a.concat(A(t)))})}else a="alpha"==n?UWA.clone(A(i.communityTags)):UWA.clone(i.communityTags);t({communityTags:a})},function(e){t({communityTags:[],error:"message"})})})},filterCommunityTags:function(e){var t=this;return new i(function(i,a){UWA.is(e,"object")&&e.platformId&&e.communityId&&e.summary?UWA.is(e.summary,"array")&&(e.mode&&"database"==e.mode&&(r.warn("UserTagsUtils#filterCommunityTags: database mode not allowed...."),a("database mode not allowed....")),t.getCommunityTags(e).then(function(t){var a={};let n,r;t.communityTags.forEach(function(e){var t=a[e.sixw];t||(a[e.sixw]=t={}),t[e.object]=e});var s=e.summary.filter(function(e){let t=E(e);if(t&&(e.object_db=t.object_db),(n=a[e.sixw])&&(r=n[e.object]))return e.dispValue=r.dispValue,e.label=r.label,e.isCommunityTag=!0,!0;var i=E(e);return i&&i.isCommunityTag?(e.dispValue=i.dispValue,e.label=i.label,e.isCommunityTag=!1,!0):void 0}),o=e.sort||"";if("rootW-count"==o){var l=N(s);s=[],p.forEach(function(e){let t=l[e];t&&(s=s.concat(V(t)))})}else"count"==o&&(s=V(s));i({communityTags:s})},function(){a([])})):(r.log("UserTagsUtils#filterCommunityTags: INVALID inputs"),a([]))})},buildCommunityTagInfo:function(e){let t=e.getAttributeValue("predicate"),i=e.getLabel();return{sixw:t,object:f[t]+o.BELCHAR+o.COMMUNITY_TAG+i,dispValue:i,label:i}},buildSuggestedTagInfo:function(e){let t=[],i="",a=e.getParent();for(;a;)t.push(e.getAttributeValue("object")),(!a||a&&!a.getParent())&&(i=e.getAttributeValue("predicate")),e=a,a=a.getParent();return{sixw:i,object:t.reverse().join(o.BELCHAR)}},buildOntologyTagInfo:function(e,t){let i=e.getAttributeValue("predicate");e.getAttributeValue("isEnterpriseConcept")&&(i=b[i],r.log("Using predicate "+i+"for enterprise ontology tag"));let a,n=e.getLabel(),s=[],l=e;for(;l;)(a=l.getAttributeValue("object"))&&s.push(a),l=l.getParent();return s.push(y[i]),s=s.reverse(),r.log("URI path for ontology concept="+s),{sixw:C?g.getPredicate(i).getFullPredicateID():i,object:t?s.join(o.BELCHAR):s,dispValue:n,label:n}},getSelectedCommunityTags:function(e){var t=[];return e&&UWA.is(e._autoComplete.selectedItems,"array")&&e._autoComplete.selectedItems.forEach(function(e){t.push(D.buildCommunityTagInfo(e))}),r.log("selected community Tags="+JSON.stringify(t)),t},getSuggestionsFor3DSwymContent:function(e){if(e&&e.platformId&&(e.communityId||e.communityName))return new i(function(t){var a=[];let n,s,l;e.vocabSuggestions="boolean"!=typeof e.vocabSuggestions||e.vocabSuggestions,e.vocabSuggestions&&(a.push(this.getVocabularySuggestions({platformId:e.platformId,rootWs:e.rootWs})),n=a.length-1),e.communityTags="boolean"!=typeof e.communityTags||e.communityTags,e.communityTags&&(a.push(this.getCommunityTags({platformId:e.platformId,communityId:e.communityId,communityName:e.communityName,appName:e.appName,currentUser:e.currentUser,sort:e.sort||"rootW-alpha"})),s=a.length-1),e.existingUserTags="boolean"!=typeof e.existingUserTags||e.existingUserTags,e.existingUserTags&&(a.push(this.getUserTagsByFedSearch({platformId:e.platformId,communityId:e.communityId,communityName:e.communityName,appName:e.appName,currentUser:e.currentUser})),l=a.length-1);i.all(a).then(function(i){let a,c,d,g=s>=0?i[s].communityTags:[],u=l>=0?i[l].suggestions:[],h=n>=0?function(e){let t,i,a={};return e.forEach(function(e){t=Object.keys(e)[0];let n=a[t];n||(a[t]=n=[]),i=e[t].literalInfo,UWA.is(i,"array")&&i.length>0&&i.forEach(function(e){let i=e.type.split("#");n.push({sixw:t,object:e.value,object_db:e.value,dispValue:e.value,label:e.value,field:o.EXPLICIT_TAG,type:i.length>1?i[i.length-1]:"string"})})}),a}(i[n]):function(){let e={};return p.forEach(function(t){e[t]=[]}),e}();g.forEach(function(e){a=e.sixw,(d=h[a])&&(e.isCommunityTag=!0,d.push(e))});var f={};for(c in h)h[c].forEach(function(e){f[c+e.label]=!0});let m,v;for(c in u&&u.forEach(function(e){(v=E(e))&&!v.isCommunityTag&&(m=e.sixw+e.label,f[m]?r.log("Existing user tag is ignored as it is already a standatd tag:"+JSON.stringify(e)):h[e.sixw].push(e))}),e.sort=e.sort||"rootW-alpha",h)h[c]=P(h[c],{text:e.text});let T,C=e.sort||"";"rootW-alpha"==C?(T=[],p.forEach(function(e){let t=h[e];t&&(T=T.concat(UWA.clone(A(t))))})):(T=[],p.forEach(function(e){let t=h[e];t&&(T=T.concat(UWA.clone(t)))}),"alpha"==C&&(T=A(T))),t({id:e.id,suggestions:T})})}.bind(this))},isARootWTag:function(e){return-1!=p.indexOf(e)},getTextForDefaultSuggestions:function(e){if("string"==typeof e){r.log("UserTagsUtils#getTextForDefaultSuggestions, input text = "+e);let t=e.trim();return t=v?t:t.replace(T,""),r.log("UserTagsUtils#getTextForDefaultSuggestions, output text = "+t),t}},getDefaultSuggestions:function(e){if("string"==typeof e.text){let t=D.getTextForDefaultSuggestions(e.text);return p.map(function(i){let a={sixw:i,dispValue:e.text,label:e.text,type:"string"};return a.object_db=t,a})}},getFilterDescription:function(e){if("string"==typeof e){r.log("UserTagsUtils#getFilterDescription, input filter = "+e);let t=e.split(o.BELCHAR),i=t.length>1?t:t[0];return r.log("UserTagsUtils#getFilterDescription, output filter = "+i),i}return e},updateCommunityTags:function(e){if(e&&e.communityId&&e.platformId)return new i(function(t,a){(function(e){return new i(function(t,a){x({platformId:e.platformId,communityId:e.communityId,mode:"database"}).then(function(n){let o=n.communityTags,l=[],c=[];if(0==e.communityTags.length)l=o;else if(0==o.length)c=e.communityTags;else{let t={},i={},a={};o.forEach(function(e){t[e.object]=!0,i[e.object]=e}),e.communityTags.forEach(function(e){t[e.object]=!0,a[e.object]=e}),Object.keys(t).forEach(function(e){i[e]&&a[e]?r.log("UserTagsUtils#updateCommunityTags: no action needed for "+e):i[e]&&!a[e]?(l.push(i[e]),r.log("UserTagsUtils#updateCommunityTags: tag to delete "+e)):!i[e]&&a[e]&&(c.push(a[e]),r.log("UserTagsUtils#updateCommunityTags: tag to create "+e))})}s.getServiceUrl({serviceName:"6WTags",platformId:e.platformId,onComplete:function(n){r.log("6WTags url from compass: "+n);let s=[];c.length>0&&s.push(_(n,e.platformId,e.communityId,c,!0)),l.length>0&&s.push(_(n,e.platformId,e.communityId,l,!1)),i.all(s).then(function(){t()},function(e){a(e)})},onFailure:function(){r.error("FAILED to retrieve 6WTags url for tenant: "+e.platformId),onFailure("FAILED to retrieve 3DSearch url for tenant"+e.platformId)}})},function(e){a(e)})})})(e).then(function(){r.log("updateCommunityTags OK"),t()},function(e){r.log("updateCommunityTags FAILED"),a(e)})})},translateStandardUserTag:function(e){if("string"==typeof e&&0==e.indexOf(o.SIXW_ROOT_ONTOLOGY)){let t=e.split(o.BELCHAR);if(w[t[0]]&&2==(t=e.split(o.COMMUNITY_TAG)).length)return t[1].replace(o.COMMUNITY_TAG,"")}return e},computeonSuccessCreateResponse:function(e){return{status:"success",tags:this.getSuccessResponse(e)}},computeonFailureCreateResponse:function(e){return{status:"failure",error:e.msg}},getSuccessResponse:function(e){return e.map(function(e){return{sixw:e.predicate,object:e.object.literal,type:e.object.literalType}})}});return D}),define("DS/TagNavigator/simplified/model/CountryModel",["UWA/Core","UWA/Class/Debug","UWA/Class/Model","UWA/Class/Collection","DS/TagNavigator/simplified/model/PersonModel"],function(e,t,i,a,n){"use strict";return i.extend(t,{defaults:{id:"",title:"",count:0,iconClass:"fonticon fonticon-3ds-where",imageURL:"",persons:void 0},setup:function(){this.set("persons",new a([],{model:n}))},addPerson:function(e){var t=this.get("persons");if(0==t.length){var i=this,a=e.get("personInfo");a&&a.addEvent("onChange:country",function(e){i.set("title",e)})}t.add(e)},getPersons:function(){return this.get("persons").toArray()},getCount:function(){return this.get("persons").toArray().reduce(function(e,t){return e+t.get("count")},0)}})}),define("DS/TagNavigator/simplified/model/ContinentModel",["UWA/Core","UWA/Class/Debug","UWA/Class/Model","UWA/Class/Collection","DS/TagNavigator/simplified/model/CountryModel"],function(e,t,i,a,n){"use strict";return i.extend(t,{defaults:{id:"",title:"",iconClass:"fonticon fonticon-globe",imageURL:"",countries:void 0,tagsHierarchy:void 0},setup:function(){this.set("countries",new a([],{model:n})),this.set("tagsHierarchy",[this.id])},getCount:function(){return this.get("countries").reduce(function(e,t){return e+t.getCount()},0)},addCountry:function(e){this.get("countries").add(e),e.set("tagsHierarchy",[this.id,e.id])},getCountry:function(e){return this.get("countries").get(e)},getCountries:function(){return this.get("countries").toArray()}})}),define("DS/TagNavigator/simplified/utils/LocationUtils",["UWA/Core","UWA/Class","UWA/Class/Collection","DS/WebappsUtils/WebappsUtils","DS/TagNavigator/Predicate","DS/TagNavigator/TaggerNLS","DS/TagNavigator/TaggerSettings","DS/TagNavigator/TagValue","DS/TagNavigator/Logger","DS/TagNavigator/simplified/utils/PersonUtils","DS/TagNavigator/simplified/model/ContinentModel","DS/TagNavigator/simplified/model/CountryModel","text!DS/TagNavigator/assets/CountriesInfo.json"],function(e,t,i,a,n,r,s,o,l,c,d,g,u){"use strict";var h=t.singleton({COMPUTED_COUNTRY_INFO:"computedCountryInfo",COMPUTED_CITY_INFO:"computedCityInfo",DATA_LOCATION:"data_location",init:function(){new n({sixw:"ds6w:where/ds6w:location",type:"string",markPendingForNls:!0}),this.computedCountryInfo=new n({sixw:"ds6w:where/ds6w:location/"+this.COMPUTED_COUNTRY_INFO,type:"string",displayName:r.getText("computedCountryInfo")}),this.computedCityInfo=new n({sixw:"ds6w:where/ds6w:location/"+this.COMPUTED_CITY_INFO,type:"string",displayName:r.getText("computedCityInfo")}),this._countriesJSONInfo=JSON.parse(u),this._hierarchyView=s.getOption("geolocationHierarchy")},ensurePredicates:function(e){e&&(this.countryPredicate||(this.countryPredicate=this._buildPredicate("ds6w:country",e)),this.cityPredicate||(this.cityPredicate=this._buildPredicate("ds6w:city",e)))},buildCondition:function(e,t){var i={id:e instanceof o?e.pred.getFullPredicateID():e.predicate,operator:"OR",isComplex:!0,condition:{type:"string",object:e instanceof o?e.uri:e.object,operator:"OR",value:e instanceof o?e.embeddedTags.map(function(e){return e.get("title")}):[],display:e instanceof o?e.getDisplayValue():e.dispValue,predicates:[]}};return t&&(i.condition.excluded=t),i.condition.value.forEach(function(){i.condition.predicates.push({type:"string",predicate:"ds6w:who/ds6w:responsible"})}),i},buildConditionFromModel:function(e){var t,i,a=e instanceof d,n=function(e){return e.get("persons").map(function(e){return e.get("title")})},r={id:this.computedCountryInfo.getFullPredicateID(),operator:"OR",isComplex:!0,condition:{type:"string",object:this._hierarchyView?e.get("tagsHierarchy"):e.get("title"),operator:"OR",value:a?(t=e,i=[],t.getCountries().forEach(function(e){i=i.concat(n(e))}),i):n(e),display:e.get("title"),predicates:[]}};return r.condition.value.forEach(function(){r.condition.predicates.push({type:"string",predicate:"ds6w:who/ds6w:responsible"})}),r},_buildPredicate:function(e,t){var i=n.getPredicate(e);return i||(i=new n({sixw:"ds6w:where/ds6w:location/"+e,type:"string",server:t})),i},getCountryInfo:function(e){var t=e.split(".");return t=2==t.length?t[1]:t[0],this._countriesJSONInfo[t]},computeGeoLocations:function(e,t,n,o){var u=new i([],{model:d}),p=c.getUsersInfo(e,t),f=p.length,m=0;if(UWA.is(p,"array")){var v,T;if(o){var C=e.getFocusedProxy();C&&(v=C.getAdvancedOption(c.PERSON_REFINE)?c.PERSON_REFINE_PREDICATE:"ds6w:who/ds6w:responsible"),v&&(T=e.getListOfSelectedTagValues(v))}l.log("LocationUtils#computeGeoLocations: number of persons info found="+f);var w,b=s.getOption("countryFlag");if(p.forEach(function(e){var t,i,n=!0;if(o&&(t=e.get("title"),i=!0,UWA.is(T,"array")&&T.length>0&&(i=T.findIndex(function(e){return e.display===t})>=0),!i)&&(n=!1),n){e.isReady()||(w=e,++m);var s=e.getCountryCode();s?s.forEach(function(t,i){var n=h.getCountryInfo(t).continent,s=u.get(n);s||(s=new d({id:n,title:r.getText(n)}),u.add(s));var o=s.getCountry(t);if(!o){var l=e.getCountry();o=new g({id:t,title:l.length>i?l[i]:""}),b&&o.set("imageURL",a.getWebappsBaseUrl()+"CountryIcons/assets/icons/country/"+t.split(".")[1].toLowerCase()+".png"),s.addCountry(o)}o.addPerson(e)}):s.length>1&&l.warn("Person '"+e.get("title")+"' found in multiple countries, "+JSON.stringify(s))}}),w){var y=w.get("personInfo");y&&y.addEventOnce("onChange:isReady",function(){n&&n()})}}return{continents:u,total:f,pending:m}},getSourceIcon:function(e){var t;if(UWA.is(e)&&UWA.is(e,"array")&&e.length>0&&(e=e[0]),e)switch(e){case"3DSpace":t="fonticon fonticon-3dspace";break;case"3DSwym":case"ds6w:dataSource.3DSwym":t="fonticon fonticon-users-alt";break;case"3DDrive":t="fonticon fonticon-component";break;case"OneDrive":t="fonticon fonticon-onedrive";break;case"GoogleDrive":t="fonticon fonticon-google-drive";break;case"DropBox":t="fonticon fonticon-dropbox";break;case"Box":t="fonticon-box-company";break;default:t="fonticon fonticon-component"}return t}});return h}),define("DS/TagNavigator/simplified/views/ActionsView",["UWA/Core","UWA/Class/View","DS/TagNavigator/TaggerNLS","DS/UIKIT/DropdownMenu","DS/UIKIT/Input/Button","DS/UIKIT/Tooltip","DS/TagNavigator/Logger","DS/MessageBus/MessageBus"],function(e,t,i,a,n,r,s,o){"use strict";return t.extend({tagName:"div",className:"tn-action-container",domEvents:{"click .action-icon":"onActionButtonClick"},updateModel:function(e){this.stopListening(this.model),this.model=null,e&&(this.model=e,this.listenTo(this.model,{"onChange:selectionCount":this._updateSelectedCount}))},onActionButtonClick:function(e){if(e.ctrlKey)return s.log("nothing happens when you click on the action button with CTRL key pressed"),!1;if(e.target.getClosest(".action-icon").addClassName("pressed"),e.target.hasClassName("fonticon-menu-dot"))this.onMenuClick(e);else if(e.target.hasClassName("fonticon-filter-select-on"))this.onSelectClick(e);else{e.target.getClosest(".tn-action-container").getElement(".fonticon-filter-select-on").isHidden()?this.onMenuClick(e):this.onSelectClick(e)}this.dispatchEvent("updateActionView")},init:function(e){this._parent(e)},setup:function(e){this._parent(e)},render:function(){return this.taggerView=this.getOption("taggerView"),this.hideMenuBtn=this.getOption("hideMenuBtn"),this.hideMenuBtn||(this.actionDiv=e.createElement("div",{class:"action-icon"}).inject(this.container),this.actionTooltip=new r({position:"left",target:this.actionDiv,body:i.getText("chooseAction"),className:"tn-action-tooltip"}),this.threeDotIcon=e.createElement("span",{class:"fonticon fonticon-menu-dot",id:"menu"}).inject(this.actionDiv).hide(),this.selectIcon=e.createElement("span",{class:"fonticon fonticon-filter-select-on",id:"select"}).inject(this.actionDiv).hide()),this.actionBox=e.createElement("div",{class:"action-box"}).inject(this.container).hide(),this.selectedCount=e.createElement("div",{class:"action-box-count",text:"0 "+i.getText("selected")}).inject(this.actionBox),this.primaryButton=new n({className:"action-button primary",disabled:!0}).inject(this.actionBox),this.cancelButton=new n({value:i.getText("cancel"),className:"action-button default cancel"}).inject(this.actionBox),this.primaryButton.addEvent("onClick",this.launchAction.bind(this)),this.cancelButton.addEvent("onClick",this.cancelAction.bind(this)),this},displayAvailableActions:function(){var e=this;this.actionDropdown&&(this.actionDropdown.destroy(),this.actionDropdown=null);var t=this.taggerView.getAvailableActions();this.actionDropdown=new a({target:this.threeDotIcon,renderTo:this.taggerView.taggerRoot,position:"top right",items:t,events:{onClick:function(t,i){e.actionSelected(i.id)},onClickOutside:function(t){t.target.hasClassName("tagger-close")||e.onActionMenuHide()}}}),this.actionDropdown.show(),this.actionTooltip.hide()},redraw:function(){var e=this.taggerView.getAvailableActions();e.length>0?this.show():this.hide(),1==e.length?(this.threeDotIcon.hide(),this.selectIcon.show(),this.actionTooltip.setBody(i.getText("select_tooltip"))):(this.threeDotIcon.show(),this.actionTooltip.setBody(i.getText("chooseAction")),this.selectIcon.hide())},onMenuClick:function(){this.displayAvailableActions(),this.dispatchEvent("addOpacity")},onSelectClick:function(){this.dispatchEvent("addOpacity"),this.actionSelected("select")},onActionMenuHide:function(){this.dispatchEvent("removeOpacity"),this.container.getElement(".action-icon").removeClassName("pressed")},_updateSelectedCount:function(e){this.selectedCount.setText(e.get("selectionCount")+" "+i.getText("selected")),e.get("selectionCount")>0?this.primaryButton.enable(!0):this.primaryButton.disable()},resetBox:function(){this.selectedCount.setText("0 "+i.getText("selected"))},enablePrimaryButton:function(){this.primaryButton.enable(!0)},actionSelected:function(e){switch(o.publish({channel:"TaggerTrackerApi",topic:"hit",data:{category:"6WTagger",action:"clickOnActionMenuTagger",persDim:{pd1:e}}}),this.actionDiv&&this.actionDiv.hide(),this.actionDiv&&this.selectedCount.show(),e){case"group":this.primaryButton.setValue(i.getText("group"));break;case"exclude":this.primaryButton.setValue(i.getText("exclude"));break;case"select":this.primaryButton.setValue(i.getText("refine"));break;case"selectInApp":this.primaryButton.setValue(i.getText("selectInApp"));break;case"editTagsSelect":this.primaryButton.setValue(i.getText("apply")),this.selectedCount.hide(),e="editTagsSelect";break;case"colorize":this.primaryButton.setValue(i.getText("colorize"))}this.selectedCount.getText().startsWith("0")&&this.primaryButton.disable(),this.actionBox.show(),this.dispatchEvent("onActionSelection",{action:e,isInteractive:!0,stdView:!this.hideMenuBtn})},launchAction:function(e){(this.actionBox.hide(),this.hideMenuBtn)||(this.actionDiv.show(),this.container.getElement(".action-icon").removeClassName("pressed"));this.container.setStyle("height",0),this.dispatchEvent("onActionLaunched",{isInteractive:!0,stdView:!this.hideMenuBtn}),this.dispatchEvent("updateActionView")},cancelAction:function(e,t){(this.resetBox(),this.actionBox.hide(),this.hideMenuBtn)||(this.actionDiv.show(),this.container.getElement(".action-icon").removeClassName("pressed"));this.container.setStyle("height",0),t={stdView:!this.hideMenuBtn},this.dispatchEvent("onActionCancelled",t),this.dispatchEvent("updateActionView")},abortAction:function(){this.resetBox(),this.actionBox.hide(),this.actionDiv.show(),this.container.getElement(".action-icon").removeClassName("pressed"),this.container.setStyle("height",0),this.dispatchEvent("updateActionView")},hideActionMenu:function(){this.actionDiv.hide()},showActionMenu:function(){this.actionDiv.show()},destroy:function(){this.stopListening(),this.actionTooltip.destroy(),this._parent()}})}),define("DS/TagNavigator/simplified/utils/AdvancedFilterUtils",["UWA/Core","DS/TagNavigator/simplified/utils/LocationUtils","DS/TagNavigator/simplified/utils/CriteriaUtils","DS/TagNavigator/simplified/utils/PersonUtils"],function(e,t,i,a){"use strict";var n={OPERATOR_OR:"OR",OPERATOR_AND:"AND",OPERATOR_XOR:"XOR",EXCLUDE:"NONE",emptyFilter:{allfilters:{isSimplified:{version:2},operator:"AND",condition:[]}},operatorSupported:["OR","AND","XOR"],_predicateOperator:{},complexTagToComplexJSON:function(e,r){var s=e.predicate;let o=n.getDefaultPredicateOperator(s);return-1!==s.indexOf(t.COMPUTED_COUNTRY_INFO)||-1!==s.indexOf(t.COMPUTED_CITY_INFO)?t.buildCondition(e,r):-1!==s.indexOf(i.TYPE_CATEGORIZATION_PREDICATE)?i.buildCondition(e,r,o):-1!==s.indexOf(a.PERSON_REFINE_PREDICATE)?a.buildCondition(e,null,r,o):e},complexTagToLegacyJSON:function(e){if(UWA.is(e.condition,"object")&&e.id===i.TYPE_CATEGORIZATION_PREDICATE){var t=e.condition.predicates[0];return{predicate:t.predicate,object:e.isComposite?e.condition.value:e.condition.value[0],dispValue:t.dispValue,type:t.type,isComposite:e.isComposite}}},simpleTagToComplexJSON:function(e,t){var i={object:e.object,operator:n.OPERATOR_OR,value:[e.object],display:e.dispValue,type:e.type,predicates:[{type:e.type,predicate:e.predicate}],isComposite:e.isComposite};return e.isExplicit&&(i.field=["explicit"]),t&&(i.excluded=t),i},getDefaultPredicateOperator:function(e){let t=n._predicateOperator,i=e.split("/").pop();if(t&&0!==Object.keys(t).length&&t[i]&&t[i].operator)return t[i].operator},getIrrelevantPredicateOperator:function(e,t){let i,a=n._predicateOperator;if(t){for(let e of t)if(e=e.split("/").pop(),a&&0!==Object.keys(a).length&&a[e]&&a[e].irrelevantOperator)return a[e].irrelevantOperator}else i=e.split("/").pop();if(a&&0!==Object.keys(a).length&&a[i]&&a[i].irrelevantOperator)return a[i].irrelevantOperator},legacyTagToLegacyOrAdvancedJSON:function(e,a){var r=e.pred.id();let s=n.getDefaultPredicateOperator(r);if(r==t.COMPUTED_COUNTRY_INFO||r==t.COMPUTED_CITY_INFO)return t.buildCondition(e,a);if(-1!==i.getTypeCategorizationPredicates().indexOf(r))return i.buildCondition(e,a,s);var o={predicate:e.pred.getFullPredicateID(),object:e.uri,dispValue:e.getDisplayValue(),type:e.type};return e.isComposite&&(o.isComposite=!0),e.explicit&&(o.isExplicit=!0),e.operator&&(o.operator=e.operator),o},manageUniqueHierarchyPathSelection:function(e,t){var i=e.condition.map(function(e){return e.object}),a=t.condition.object;return i.map(function(e,t){return e.length!==a.length&&(n=a,(i=e).length<n.length?r=i.every(function(e,t){return n[t]===e}):s=n.every(function(e,t){return i[t]===e}),r||s)?t:-1;var i,n,r,s}).filter(function(e){return-1!=e})}};return n}),define("DS/TagNavigator/LoggerUX",["UWA/Core","UWA/Class","DS/TagNavigator/TaggerSettings"],function(e,t,i){"use strict";var a=t.singleton({start:function(){i.getOption("loggerUX")&&(i.getOption("TNLogs")||i.getOption("proxyLogs"))&&(window.update_tn_snackbar=function(){if(window.tn_snackbar){let t=arguments[0],i=arguments[1];e.createElement("DIV",{class:"tn-snackbar_elem"}).inject(window.tn_snackbar).innerText=(1==i?"[TNLogs]: ":"[ProxyLogs]: ")+(new Date).toString();for(let a=0;a<t.length;a++){let n=e.createElement("DIV",{class:"tn-snackbar_elem"});n.addClassName(1==i?"tnlogs":"proxylogs");try{n.innerText=UWA.is(t[a],"object")||UWA.is(t[a],"array")?JSON.stringify(t[a]):t[a]}catch(e){n.innerText="exception"}window.tn_snackbar.appendChild(n),window.tn_snackbar.scrollTop=window.tn_snackbar.scrollHeight-window.tn_snackbar.clientHeight}}else{let t=e.createElement("div",{id:"tn-snackbar-root"}).inject(document.body).show();window.tn_snackbar=e.createElement("div",{id:"tn-snackbar"}).inject(t),require(["DS/UIKIT/Input/Button","DS/UIKIT/Badge"],function(i,n){let r=e.createElement("div",{id:"tn-debug-controls"}).inject(t);new i({value:"Clear",class:"tn-snackbar-btn",id:"tn-debug-clear"}).inject(r).addEvent("onClick",function(){window.tn_snackbar.empty()}),new i({value:"Copy",class:"tn-snackbar-btn",id:"tn-debug-copy"}).inject(r).addEvent("onClick",function(){var e=window.tn_snackbar.getElements(".tn-snackbar_elem");let t="";e.forEach(function(e){t+=e.textContent+"\n"}),(e=>{const t=document.createElement("textarea");t.value=e,document.body.appendChild(t),t.select(),document.execCommand("copy"),document.body.removeChild(t)})(t)}),a.contextElem=new n({content:"<<current context>>",className:"primary context_badge",icon:"tag"}).inject(r)})}})},updateContext:function(e){a.contextElem&&a.contextElem.elements.content.setText(e)}});return a}),define("DS/TagNavigator/Groupings",["UWA/Core","DS/TagNavigator/Logger"],function(e,t){"use strict";return function(){var e={groups:[]},t={},i={};return{computeGroupingInfo:function(a,n){this.predicateInfo||(this.predicateInfo={}),UWA.is(a,"array")&&(t={groups:[]},n&&(t.forcedUpdate=!0),i={},a.forEach(function(e){var a=e.predicate;i[a]={},i[a].predLevel=!!e.predLevel&&e.predLevel,e.object&&e.object.forEach(function(e){i[a][e.dispText]=e.object}),t.groups.push({predicate:e.predicate,object:e.object,predLevel:e.predLevel})})),e.groups=UWA.clone(a)},isGroupedBy:function(e,t,a){if(i){var n=i[e];if(n){if(!t)return n.predLevel;if(!a)return n[t];var r=n[t];if(UWA.is(r,"array")&&UWA.is(a,"array")&&r.length==a.length){var s=0;return r.forEach(function(e,t){e==a[t]&&s++}),s==r.length}}}return!1},getGroupingInfo:function(){return t},getActiveGroupings:function(){return UWA.clone(e.groups)},hasActiveGroupings:function(){return e.groups.length>0},clear:function(){e.groups=[],i={},t.groups=[]}}}}),define("DS/TagNavigator/simplified/model/AdvancedFilter",["UWA/Core","UWA/Class","UWA/Class/Debug","DS/TagNavigator/simplified/utils/AdvancedFilterUtils","DS/TagNavigator/TagValue","DS/TagNavigator/simplified/utils/CriteriaUtils","DS/TagNavigator/Filter","DS/TagNavigator/simplified/utils/PersonUtils","DS/TagNavigator/TaggerNLS"],function(e,t,i,a,n,r,s,o,l){"use strict";var c=t.extend(i,{init:function(){var e=UWA.clone(a.emptyFilter),t=new s,i="AND";this.treatExistingEmbeddingFilter=function(e){var t=a.complexTagToLegacyJSON(e);if(t){var i=[],n=this;return this._getConditionsArray().forEach(function(e){e[Object.keys(e)[0]].condition.forEach(function(e){var a=e.value.findIndex(function(i,a){return t.isComposite?e.hasComposites&&-1!==e.hasComposites.indexOf(a)?-1!==e.hasComposites.findIndex(function(i){return t.object[0].length<=e.value[i].length?t.object[0].every(function(t){return-1!==e.value[i].indexOf(t)}):e.value[i].every(function(e){return-1!==t.object[0].indexOf(e)})}):UWA.is(e.object,"array")?t.object[0].length<=e.object.length?t.object[0].every(function(t){return-1!==e.object.indexOf(t)}):e.object.every(function(e){return-1!==t.object[0].indexOf(e)}):void 0:i===t.object}),s=!1;-1!==a&&(s=e.predicates[a].predicate===t.predicate);s&&(i.push(UWA.clone(e)),e.predicates.forEach(function(t,i){i!==a&&n.toggle(r.buildCondition({predicate:t.predicate,object:e.value[i],dispValue:t.dispValue,type:t.type,isComposite:t.isComposite}),!0,!0)}))})}),i.forEach(function(e){n.toggle({id:r.TYPE_CATEGORIZATION_PREDICATE,operator:e.operator,isComplex:!0,condition:e,isComposite:e.isComposite})}),i.length>0}},this.toggle=function(e,t){var i,r=e instanceof n,s=r?a.legacyTagToLegacyOrAdvancedJSON(e,t):e,o=!1,l={},c=s.id?s.id:s.predicate,d=this._getExistingFilter(s.id?s.id:s.predicate);if(!d)return(d=this._addNewFilter(s)).isComplex?(s.condition.isComposite=s.isComposite,d.condition.push(s.condition),l=UWA.clone(s.condition)):(d.condition.push(a.simpleTagToComplexJSON(s,t)),l=UWA.clone(a.simpleTagToComplexJSON(s,t))),{isSelected:o=!0,condition:l,id:c};if((r||s.treatEmbeddingFilter)&&this.treatExistingEmbeddingFilter(s)){o=this.isSelected(e);return i={condition:UWA.clone(s.condition),isSelected:o,id:c}}var g,u=d.isComplex;u&&s.isComplex&&s.predicate&&(s=a.complexTagToComplexJSON(s,t));var h=function(e,t){return t?s.condition.object.length==e.object.length&&s.condition.object.every(function(t){return-1!==e.object.indexOf(t)}):s.condition.object.length<=e.object.length?s.condition.object.every(function(t){return-1!==e.object.indexOf(t)}):e.object.every(function(e){return-1!==s.condition.object.indexOf(e)})},p=d.condition.findIndex(function(e){return u?s.isComposite?h(e):UWA.is(s.condition.object,"array")&&UWA.is(e.object,"array")?(g=!0,h(e,!0)):JSON.stringify(s.condition.object)===JSON.stringify(e.object):s.isComposite?h(e):UWA.is(s.object,"array")&&UWA.is(e.object,"array")?JSON.stringify(s.object)===JSON.stringify(e.object):s.object===e.object}),f=function(e,t){l=UWA.clone(d.condition[e]),d.condition.splice(e,1),t&&0===d.condition.length&&this._removeFilter(s.id?s.id:s.predicate),i={condition:l,isSelected:!1,id:c}};if(-1!==p)f.call(this,p,!0);else{if(g)a.manageUniqueHierarchyPathSelection(d,s).forEach(function(e){f.call(this,e)}.bind(this));u?(s.condition.isComposite=e.isComposite,d.condition.push(s.condition),i={condition:UWA.clone(s.condition),isSelected:!0,id:c}):(d.condition.push(a.simpleTagToComplexJSON(s,t)),i={condition:UWA.clone(s.condition),isSelected:!0,id:c})}return i},this._getConditionIndex=function(e,t,i,a){var n=t.isComplex;return t.condition.findIndex(function(t){if(n){var r;if(!(r=UWA.is(i.condition.object,"array")&&UWA.is(t.object,"array")?JSON.stringify(i.condition.object)===JSON.stringify(t.object):i.condition.object===t.object))if(i.isComposite)r=i.condition.object.length<=t.object.length?i.condition.object.every(function(e){return-1!==t.object.indexOf(e)}):t.object.every(function(e){return-1!==i.condition.object.indexOf(e)});else if(a){var s=t.value.findIndex(function(e){return e===i.condition.object});if(-1!==s)r=t.predicates[s].predicate===e.pred.getFullPredicateID()}return r}return UWA.is(i.object,"array")&&UWA.is(t.object,"array")?JSON.stringify(i.object)===JSON.stringify(t.object):i.object===t.object})},this.isSelected=function(e){var t=e instanceof n,i=t?a.legacyTagToLegacyOrAdvancedJSON(e):e,r=!1,s=this._getExistingFilter(i.id?i.id:i.predicate);if(s){r=-1!==this._getConditionIndex(e,s,i,t)}return r},this.isExcluded=function(e){var t=e instanceof n,i=t?a.legacyTagToLegacyOrAdvancedJSON(e):e,r=this._getExistingFilter(i.id?i.id:i.predicate);if(r){let a=this._getConditionIndex(e,r,i,t);if(-1!==a)return r.condition[a].hasOwnProperty("excluded")&&r.condition[a].excluded}return!1},this.computeFilterObj=function(e,n,r,s,o){var l=UWA.clone(a.emptyFilter);if(l.allfilters.operator=i,!1!==r&&this._getConditionsArray().forEach(function(e){var t=UWA.clone(e);t[Object.keys(t)[0]].condition.forEach(function(e){if(e.isComposite){e.value=e.value[0].map(function(e){return e});var t=e.predicates[0];e.predicates=e.value.map(function(e){return t})}else if(e.hasComposites){var i=[],a=[];e.value.forEach(function(t,n){if(-1!==e.hasComposites.indexOf(n)){var r=e.predicates[n];t.forEach(function(e){i.push(e),a.push(r)})}else i.push(t),a.push(e.predicates[n])}),e.value=i,e.predicates=a}}),l.allfilters.condition.push(UWA.clone(t))}),!r){var c=t.computeFilterObj(null,null,!1,!0);if(c&&UWA.is(c.allfilters,"object"))for(var d in c.allfilters){var g={};g[d]=c.allfilters[d],l.allfilters.condition.push(g)}}return l},this.getSelectedTagValues=function(e){var t=[],i=this._getConditionsArray();for(let s=0;s<i.length;s++)if(i[s].hasOwnProperty(e)){var a=UWA.clone(i[s][e].condition);if(a)for(let n=0;n<a.length;n++){let r={object:a[n].object,display:a[n].display,type:a[n].type,predicate:e,isComposite:a[n].isComposite,isComplex:i[s][e].isComplex};t.push(r)}}else{var n=UWA.clone(this.getSelectedAttributes("sixw:"+e));if(n){var r=n["sixw:"+e];for(let e=0;e<r.length;e++)t.push(r[e])}}return t},this.removeFreeInput=function(e,i,a,n,r){return t.removeFreeInput(e,i,a,r)},this.createFreeInput=function(e,i,a,n){return t.createFreeInput(e,i,a,n)},this.getSelectedAttributes=function(e){return t.getSelectedAttributes(e)},this.isSelectedAttribute=function(e,i){return t.isSelectedAttribute(e,i)},this.isEmpty=function(){return 0===this._getConditionsArray().length&&t.isEmpty()},this.count=function(){return this._getConditionsArray().length+t.count()},this.clear=function(){e=null,e=UWA.clone(a.emptyFilter),t.clear()},this._getConditionsArray=function(){return e.allfilters.condition},this._getExistingFilter=function(e){var t=this._getConditionsArray(),i=t.findIndex(function(t){return Object.keys(t)[0]===e}),a=-1!==i?t[i]:void 0;return a?a[e]:void 0},this.operatorIsOverloaded=function(e){return!!this._checkDefaultOperator(e)||!!this._checkOperatorChangedFromUI(e)},this._checkOperatorChangedFromUI=function(e){return!!e.operator&&e.operator!=a.OPERATOR_OR},this._checkDefaultOperator=function(e){let t=function(e){let t=e.predicates;for(let e=0;e<t.length;e++){let i=a.getDefaultPredicateOperator(t[e].predicate);if(i)return i}return null},i=e.id?e.id:e.predicate,n=a.getDefaultPredicateOperator(i);if(n)return n;if(e.isComplex&&!n)if(Array.isArray(e.condition)){let i=e.condition;for(let e=0;e<i.length;e++){let a=t(i[e]);if(a)return a}}else if("object"==typeof e.condition){return t(e.condition)}},this._addNewFilter=function(e){let t=e.id?e.id:e.predicate,i=e.operator?e.operator:null,n=e.isComplex,r=this._checkDefaultOperator(e);var s={};return s[t]={operator:i||(r||a.OPERATOR_OR),condition:[]},n&&(s[t].isComplex=!0),this._getConditionsArray().push(s),s[t]},this._removeFilter=function(e){var t=this._getConditionsArray(),i=t.findIndex(function(t){return Object.keys(t)[0]===e});if(-1===i)throw new Error("FAILED to remove filter "+e);t.splice(i,1)},this.getNumberOfTags=function(){return this._getConditionsArray().reduce(function(e,t){return e+t[Object.keys(t)[0]].condition.length},0)},this.getNumberOfPredicates=function(){return this._getConditionsArray().length},this._setFilterObj=function(t){e=t},this._setAttributes=function(a,n,r){e=a,t=n.cloneFilter(),i=r},this.cloneFilter=function(){var a=new c;return a._setAttributes(UWA.clone(e),t,i.slice()),a},this.setGlobalOpertor=function(e){i=e},this.getGlobalOperator=function(){return i},this.changeLocalOperator=function(e,t){var i=this._getExistingFilter(e);i&&(i.operator=t,i.hasOwnProperty("excluded")&&delete i.excluded)},this.handleExclude=function(e,i){let r=e instanceof n?a.legacyTagToLegacyOrAdvancedJSON(e,i):e,s=r.id?r.id:r.predicate,l=r.tagName?r.tagName:r.condition?r.condition.display:r.dispValue;var c=this._getExistingFilter(s);if(c){var d=c.condition.findIndex(e=>e.display==l);i?(c.condition[d].excluded=!0,s==o.PERSON_REFINE_PREDICATE&&(c.condition[d].operator="AND")):(delete c.condition[d].excluded,s==o.PERSON_REFINE_PREDICATE&&(c.condition[d].operator="OR"))}else{let a;e.tagInfo&&(a=e.tagInfo),t.excludeAttribute(s,l,a,i)}},this.setAdminPredOperator=function(e){a._predicateOperator=UWA.clone(e)}}});return c}),define("DS/TagNavigator/userTags/UserTagsModel",["UWA/Core","UWA/Class/Model","UWA/Class/Debug","DS/TagNavigator/TaggerSettings"],function(e,t,i,a){"use strict";return t.extend(i,{defaults:{readOnly:!1,touchMode:!0,freeInput:!0},setup:function(e){this._parent(e),this.set("rootWs",a.getOption("simplifiedRootW"))}})}),define("DS/TagNavigator/simplified/utils/DateUtils",["UWA/Core","UWA/Class","DS/WebappsUtils/WebappsUtils","DS/TagNavigator/Predicate","DS/TagNavigator/TaggerNLS","DS/TagNavigator/simplified/model/DateRangeModel"],function(e,t,i,a,n,r){"use strict";return t.singleton({init:function(){this.addLastYear=!0,this.defaultRanges=this.getDefaultRangs()},getDefaultRangs:function(){var e=new Date,t=this.getFormattedDate(e,!0),a=e.getMonth();this.year=e.getFullYear();var r=this.getWeekDays(e),s=new Date(this.year,a,1),o=new Date(this.year,a+1,0),l=new Date(this.year,0,1),c=new Date(this.year,11,31),d=t.split("/"),g=[];g.push({id:"today",title:n.getText("today"),object:[t],from:t,to:t,from_time:new Date(t+" 00:00:00").getTime(),to_time:new Date(t+" 23:59:59").getTime(),imageURL:i.getWebappsBaseUrl()+"TagNavigator/assets/icons/select-day.png"});var u={id:"thisWeek",title:n.getText("this_week"),object:this.getFormattedWeekDays(r),from:this.getFormattedDate(r[0],!0),to:this.getFormattedDate(r[6],!0),imageURL:i.getWebappsBaseUrl()+"TagNavigator/assets/icons/select-week.png"};u.from_time=new Date(u.from+" 00:00:00").getTime(),u.to_time=new Date(u.to+" 23:59:59").getTime(),g.push(u);var h={id:"thisMonth",title:n.getText("this_month"),object:[d[0]+"/"+d[1]],from:this.getFormattedDate(s,!0),to:this.getFormattedDate(o,!0),imageURL:i.getWebappsBaseUrl()+"TagNavigator/assets/icons/select-range.png"};h.from_time=new Date(h.from+" 00:00:00").getTime(),h.to_time=new Date(h.to+" 23:59:59").getTime(),g.push(h);var p={id:"thisYear",title:n.getText("this_year"),object:[d[0]],from:this.getFormattedDate(l,!0),to:this.getFormattedDate(c,!0),imageURL:i.getWebappsBaseUrl()+"TagNavigator/assets/icons/calendar.png"};if(p.from_time=new Date(p.from+" 00:00:00").getTime(),p.to_time=new Date(p.to+" 23:59:59").getTime(),g.push(p),this.addLastYear){var f=this.year-1,m=new Date(f,0,1),v=new Date(f,11,31),T={id:"lastYear",title:n.getText("last_year"),object:[f+""],from:this.getFormattedDate(m,!0),to:this.getFormattedDate(v,!0),imageURL:i.getWebappsBaseUrl()+"TagNavigator/assets/icons/last-year.png"};T.from_time=new Date(T.from+" 00:00:00").getTime(),T.to_time=new Date(T.to+" 23:59:59").getTime(),g.push(T)}return g},_getOlderRange:function(){if(!this._olderRange){var e=new Date(this.addLastYear?this.year-2:this.year-1,11,31);this._olderRange={id:"older",title:n.getText("older"),object:void 0,from:void 0,to:this.getFormattedDate(e,!0),imageURL:i.getWebappsBaseUrl()+"TagNavigator/assets/icons/calendar.png"},this._olderRange.to_time=new Date(this._olderRange.to+" 23:59:59").getTime()}return UWA.clone(this._olderRange)},getFormattedDate:function(e,t){if(e)return t?e.getFullYear()+"/"+("0"+(e.getMonth()+1)).slice(-2)+"/"+("0"+e.getDate()).slice(-2):("0"+e.getDate()).slice(-2)+"/"+("0"+(e.getMonth()+1)).slice(-2)+"/"+e.getFullYear()},getFormattedWeekDays:function(e){return e.map(function(e){return this.getFormattedDate(e)}.bind(this))},getWeekDays:function(e){for(var t=[],i=new Date(e),a=1;a<=7;a++){var n=e.getDate()-e.getDay()+a,r=new Date(i.setDate(n));t.push(r)}return t},buildCondition:function(e,t){if(a.getPredicate(t)){var i={predicate:a.getPredicate(t),value:{nls:e.get("title"),isSimplifiedCriteria:!0},type:"date"};return e.get("from")&&(i.value.from=e.get("from")),e.get("to")&&(i.value.to=e.get("to")),i}return!1},getRangeDetails:function(e,t){var i,a=e.getRangeDefine(t);return a||(a=UWA.clone(this.defaultRanges),(e.hasFreeInputSupport(t)||e.hasFreeInputOnly(t))&&a.push(this._getOlderRange())),a.forEach(function(e){e.tagValues=[],e.count=0}),e.eachTagValue(function(e,t){if(3==e.uri.split("/").length){var n=new Date(e.uri+" 00:00:00").getTime();a.forEach(function(a){i=!1,a.from_time&&a.to_time?n>=a.from_time&&n<=a.to_time&&(a.tagValues.push(e),i=!0):a.from_time&&!a.to_time?n>=a.from_time&&(a.tagValues.push(e),i=!0):!a.from_time&&a.to_time&&n<=a.to_time&&(a.tagValues.push(e),i=!0),i&&t>0&&(a.count+=t)})}},{allTagsOfType:[t]}),a.map(function(e){return new r(e)})}})}),define("DS/TagNavigator/Parameters",["UWA/Class/Collection","UWA/Core","DS/TagNavigator/Parameter"],function(e,t,i){"use strict";return e.extend({model:i,isReadyForSearch:function(){var e,t=this.size(),i=!1;for(e=0;e<t&&!i;e++){var a=this._models[e]._attributes;if(null!==a){var n,r=a.intType.length;for(n=0;n<r&&!i;n++)i=null!==a.intType[n].toVal||null!==a.intType[n].fromVal;i=i||a.boolVal.length&&""!==a.boolVal[0]||a.stringVal.length}}return i},getFilters:function(){var e={plmparam:{}};return this._models.forEach(function(t){var i=t._attributes;if("string"===i.type)""!==i.stringVal&&(e.plmparam.string||(e.plmparam.string={}||e.plmparam.string),e.plmparam.string[i.value]={interface:i.interface,value:i.stringVal});else if("boolean"===i.type)i.boolVal.length&&""!==i.boolVal[0]&&(e.plmparam.boolean||(e.plmparam.boolean={}||e.plmparam.boolean),e.plmparam.boolean[i.value]={interface:i.interface,value:"1"===i.boolVal[0]});else{var a=i.unit||null;i.intType.forEach(function(t){if(null!==t.fromVal||null!==t.toVal){var n,r,s="nominal";switch((t.rangeContainer&&t.rangeContainer.hasChildNodes()?t.rangeContainer.getElement(".form-control"):null).value){case"2":s="min";break;case"3":s="max";break;case"4":s="range"}n="integer"===i.type?parseInt(t.fromVal,10):parseFloat(t.fromVal),r="integer"===i.type?parseInt(t.toVal,10):parseFloat(t.toVal),e.plmparam[i.type]||(e.plmparam[i.type]={}||e.plmparam[i.type]),e.plmparam[i.type][i.value]||(e.plmparam[i.type][i.value]={interface:i.interface},a&&(e.plmparam[i.type][i.value].unit=a)),e.plmparam[i.type][i.value][s]={},n===r?e.plmparam[i.type][i.value][s].equal=n:(isNaN(n)||(e.plmparam[i.type][i.value][s].from=n),isNaN(r)||(e.plmparam[i.type][i.value][s].to=r))}})}}),e},clearValues:function(){this._models.forEach(function(e){e.set({stringVal:"",boolVal:[],intType:[]})})},appendParameter:function(e){var t,i,a,n,r;return t=!0,i=e.get("value"),a=e.get("interface"),n=e.get("type"),r=e.get("unit"),this._models.forEach(function(e){t&&i&&i===e.get("value")&&a&&a===e.get("interface")&&n&&n===e.get("type")&&(r?r===e.get("unit")&&(t=!1):t=!1)}),t&&this.add(e),t}})}),define("DS/TagNavigator/embeddedTagger/EmbeddedPlaceholderMenuItem",["UWA/Core","DS/TagNavigator/embeddedTagger/EmbeddedMenuItem","DS/TagNavigator/simplified/utils/DateUtils"],function(e,t,i){"use strict";return t.extend({init:function(e){this._parent(e)},setup:function(e){this._parent(e)},render:function(){return this._parent(),this.container.setAttributes({id:this.model.id}),this},addContent:function(){this.container.getElement(".tag-icon").setStyle("display","none");var e=this.container.getElement(".tag-label");e.setText(this.model.get("title")),e.setStyles({"padding-left":"10px"})},destroy:function(){this.stopListening(),this.model=null,this._parent()}})}),define("DS/TagNavigator/embeddedTagger/EmbeddedRootWView",["UWA/Core","UWA/Class/View","UWA/Class/Model","UWA/Event","DS/TagNavigator/TaggerNLS","DS/TagNavigator/embeddedTagger/EmbeddedPlaceholderMenuItem","DS/MessageBus/MessageBus","DS/UIKIT/Tooltip","DS/UIKIT/DropdownMenu","DS/TagNavigator/TaggerSettings","DS/TagNavigator/simplified/actions/ActionUtils"],function(e,t,i,a,n,r,s,o,l,c,d){"use strict";return t.extend({rootw:void 0,label:void 0,defaultValues:void 0,menuItem:[],domEvents:{"click .clear-refine-btn":"clearRefine","click .root-icon-div":"onGroupingChange","click .button-text":"onGroupingChange","click .active-tag-label":"clearRefine","click .emb-clear-input-field":"clearInput"},init:function(e){this.proxy=e.proxy,this.defaultValues=e.defaultValues,this.rootw=e.rootw,this._parent(e),this.container.addClassName("disableW"),this._groupingFormatV2=c.getOption("groupingFormatV2"),this._isReadyToUpdateGroupings=!0,this._updateGroupingsWhenReady=!1},setup:function(e){this._parent(e),this.navImpl=this.proxy.getNavImpl()},render:function(){return this.getTabButton(),this.selectedItems=[],this.menuItems=[],this.container.id=this.rootw,this.isPreciseCount=this.navImpl.isPreciseCount(),this},getTabButton:function(){var t=this.icon;this.buttonContainer=e.createElement("div",{class:"tab-btn-cont"}).inject(this.container);var i=e.createElement("div",{class:"icon-cont-div"}).inject(this.buttonContainer),a=e.createElement("div",{class:"root-icon-div"}).inject(i);e.createElement("div",{class:"underline"}).inject(i),t=e.createElement("span",{class:"fonticon "+t+" root-icon"}).inject(a);this.activeIcon=e.createElement("span",{class:"fonticon fonticon-tag-active "}).inject(a);var r=e.createElement("div",{class:this.subLabel?"button-text":"button-text hide-sub-label"}).inject(this.buttonContainer),s=e.createElement("div",{class:"label-cont"}).inject(r);e.createElement("div",{class:"dropnbtn",text:this.label}).inject(s),e.createElement("div",{class:"sub-label",text:this.subLabel}).inject(r);this.subLabel&&(this.subLabelTooltip=new o({position:"bottom",target:this.getElement(".sub-label"),body:this.subLabel,className:"embedded-subLabel-tooltip"}));e.createElement("div",{class:"underline"}).inject(r);if("allw"!==this.rootw){var l=e.createElement("div",{class:"chevron-cont"}).inject(this.buttonContainer);let t=this.label+" "+n.getText("embMenu");var c=e.createElement("div",{class:"chevron-div",nls:t}).inject(l);this._menuTooltip=new o({position:"bottom",target:c,body:t,className:"embeddedW-predicate-tooltip"});e.createElement("span",{class:"fonticon fonticon-chevron-down"}).inject(c)}else if("allw"==this.rootw){var d=e.createElement("span",{class:"clear-refine-btn fonticon fonticon-trash"}).inject(s);this._removeTagTooltip=new o({position:"bottom",target:d,body:n.getText("embClearTags"),className:"embeddedW-clearTags-tooltip"})}},getActionOnClick:function(){return d.ACTION_GROUP},updateSubLabelCall:function(e){if(e&&e.subLabel){var t=this.getActionOnClick();t&&t==d.ACTION_GROUP&&(e.subLabel=n.getText("groupBy")+e.subLabel),this.getElement(".sub-label").setText(e.subLabel),this.getElement(".button-text").removeClassName("hide-sub-label"),this.subLabelTooltip&&this.subLabelTooltip.destroy(),this.subLabelTooltip=new o({position:"bottom",target:this.getElement(".sub-label"),body:e.subLabel,className:"embedded-subLabel-tooltip"})}},isReadyToUpdateGroupings:function(){return this._isReadyToUpdateGroupings},setUpdateGroupingsWhenReadyFlag:function(e){this._updateGroupingsWhenReady=e},onGroupingChange:function(e,t){t=t||{},("allw"!=this.rootw||this.proxy.hasActiveGroupings())&&(this.dispatchEvent("toggleGrouping",UWA.merge({id:this.rootw},t)),s.publish({channel:"TaggerTrackerApi",topic:"hit",data:{category:"EmbeddedTagger",action:"onGroupingChange",persDim:{pd1:this.rootw}}}))},activateGroupingUX:function(){this.buttonContainer.addClassName("grouped")},deactivateGroupingUX:function(){this.buttonContainer.removeClassName("grouped"),this.buttonContainer.removeClassName("selected-tags")},isGroupedBy:function(e){var t=this.buttonContainer.hasClassName("grouped");return e?t&&this.navImpl.isGroupedBy(e):t},getManagedPredicate:function(){return this.predicate},updateGroupingUX:function(){this.navImpl.isGroupedBy(this.predicate)||"allw"==this.rootw&&!this.proxy.hasActiveGroupings()?this.activateGroupingUX():this.deactivateGroupingUX()},addSelectedTagClass:function(){this.buttonContainer.addClassName("selected-tags"),this.buttonContainer.addClassName("has-selected-tag")},clearRefine:function(e,t){t||(this.buttonContainer.removeClassName("selected-tags"),this.buttonContainer.removeClassName("has-selected-tag"),!1!==e&&this.selectedItems.forEach((e,t)=>{this.navImpl.toggleTagSelection(e)}),this.dispatchEvent("deactiveEmbeddedView")),s.publish({channel:"TaggerTrackerApi",topic:"hit",data:{category:"EmbeddedView",action:"clearEmbeddedRefine",persDim:{pd1:this.rootw,pd2:"emabeddedView"}}})},searchTagsInMenu:function(e){var t;t=this.searchInput.value.toUpperCase();var a=this.searchField.getElement(".emb-clear-input-field"),o=this.searchField.getElement(".icon-cont");let l,c=[];if(this._removeItemFromMenu(this.menuItems),this.dropDownMenu.getItem("no-result-item")&&this.dropDownMenu.removeItem("no-result-item"),t?(a.addClassName("add-clear"),o.addClassName("hide-lens")):""==t&&(a.removeClassName("add-clear"),o.removeClassName("hide-lens")),l=this.getFilteredTagsItems(this.menuItems,t,c),!c.length){let e=new r({model:new i({id:"no-result-item",title:n.getText("noRslt")})}).render();e.setOption("identifier","no-result-item"),c.push(e)}this.dropDownMenu.addItem(l),this.dropDownMenu.getItem("no-result-item")&&this.dropDownMenu.disableItem("no-result-item"),this._treatMenuItemView(c),this.dropDownMenu.updatePosition(null),this.searchInput.focus(),s.publish({channel:"TaggerTrackerApi",topic:"hit",data:{category:"EmbeddedTagger",action:"searchTags",persDim:{pd1:this.rootw}}})},sortMenuItems:function(e){e.sort(function(e,t){if(e.model&&t.model)return t.model.get("count")-e.model.get("count")||e.model.get("title").localeCompare(t.model.get("title"))})},_removeItemFromMenu:function(e){let t=this;for(let i=e.length-1;i>=0;i--){let a=e[i];a.getOption("subMenuItems")&&t._removeItemFromMenu(a.getOption("subMenuItems")),t.dropDownMenu.getItem(a.getOption("identifier")).items&&!t.dropDownMenu.getItem(a.getOption("identifier")).items.length&&a.getOption("subMenuItems")||t.dropDownMenu.removeItem(a.getOption("identifier"))}t.dropDownMenu.items.forEach((e,i)=>{"divider"==e.className&&t.dropDownMenu.removeItem(e.id)})},_getFilteredTags:function(e,t,i){let a=this;e.forEach((e,n)=>{t?e.getOption("subMenuItems")?a._getFilteredTags(e.getOption("subMenuItems"),t,i):e.model&&e.model.get("title").toUpperCase().indexOf(t)>-1&&!e.model.get("excludeFromSearch")&&(e.render(!0),i.push(e)):""==t&&(e.render(!0),i.push(e))})},_getSearchField:function(t){var i=e.createElement("div",{id:"search-div"}).inject(this.dropDownMenu.getItem("search-field").elements.container);this.searchField=e.createElement("div",{class:"search-input-cont"}).inject(i),this.searchInput=e.createElement("input",{id:"search-input",type:"text",placeholder:n.getText("search"),class:"input-field"}).inject(this.searchField);var a=e.createElement("i",{class:"emb-clear-input-field fonticon fonticon-cancel-circled"}).inject(this.searchField);this._clearSearchTooltip=new o({position:"bottom",target:a,body:n.getText("embClearSearch"),className:"embeddedW-embClearSearch-tooltip"});var r=e.createElement("div",{class:"icon-cont",html:{tag:"span",class:"fonticon fonticon-search"}}).inject(this.searchField);this._searchIconTooltip=new o({position:"bottom",target:r,body:n.getText("embSearchTags"),className:"embeddedW-embSearchTags-tooltip"}),this.searchInput.addEvent("keyup",this.searchTagsInMenu.bind(this)),a.addEventListener("click",this.clearInput.bind(this))},onTagClick:function(e){this.buttonContainer.removeClassName("shown"),this.dropDownMenu&&this.dropDownMenu.hide(),this.dispatchEvent("deactiveEmbeddedView"),s.publish({channel:"TaggerTrackerApi",topic:"hit",data:{category:"EmbeddedTagger",action:"clickOnTagInMenu",persDim:{pd1:this.rootw}}})},buildMenuItemsStructure:function(e){var t,i=[],a=e||this.menuItems;if(a&&UWA.is(a,"array")){for(var n=0;n<a.length;n++){var r;if((t=a[n]).isSeparator&&t.isSeparator())r={className:"divider"};else{r={name:t.getOption("identifier")?t.getOption("identifier"):void 0,selectable:!t.container.hasClassName("item-disabled"),selected:!!t.container.hasClassName("selected"),disabled:!!t.container.hasClassName("item-disabled"),template:t.container.outerHTML};var s=t.getOption("subMenuItems");s&&s.length>0&&(r.items=this.buildMenuItemsStructure(s))}i.push(r)}return i}},_hasSubMenus:function(){let e=this.menuItems;for(let t=0;t<e.length;t++)if(e[t].getOption("subMenuItems"))return!0},_treatMenuItemView:function(t){let i=this,a=!1;if(UWA.is(t,"array")){for(let e=0;e<t.length;e++){let i=t[e];if(!i.isSeparator||!i.isSeparator()){var n=i.getOption("subMenuItems");n&&n.length>0&&(a=!0),this._treatMenuItemView(n)}}if(a)for(let i=0;i<t.length;i++){let a=t[i];if(!a.getOption("subMenuItems")){var r=this.dropDownMenu.getItem(a.getOption("identifier"));let t=e.is(r,"object")&&r.elements.container.getElement(".tag-count");t&&t.addClassName("align-count")}}}this.dropDownMenu.menus.forEach(function(e){e.elements.container.addClassName("tn-embedded-menu tn-"+i.rootw.replace("ds6w:","")+"-menu")})},createDropdown:function(){var e=this,t=e.buildMenuItemsStructure(),i=l.extend({init:function(e){this._parent(e)},_onKeyDown:function(e){[13,27,37,38,39,40].includes(e.which)&&this._parent(e)},resize:function(){let e=document.activeElement;var t=navigator.userAgent.toLowerCase().indexOf("android")>-1;e&&"search-input"==e.id&&t||this._parent()},_onMouseover:function(e){var t,i,n,r=a.getElement(e),s=r.id;if(!r.hasClassName("item")){let e=r.getClosest("li.item");e&&(s=(r=e).id)}if(s=s||r.parentElement.id||r.parentElement.parentElement.id,i=this._getMenuFromParentItem(s),!(r.hasClassName("item-back")||i&&i._position&&i._position.contains("dropdown-menu-responsive-wrap")||(this.timeoutId&&clearTimeout(this.timeoutId),this.usingKeyboard))){if(!(n=this.template.getItem(r)))return;(n=this.getItem(n.id?n.id:n))&&this._handleItemSelection(n.elements.container)}this.options.responsiveMode&&(n=r.parentElement.classList.contains("next-icon")?r.parentElement.parentElement:r.parentElement,n=(i=this._getMenuFromItem(n.id))&&i.getItem(n.id),t=i&&i.getContent().hasClassName("responsive-menu"),n&&t&&(r.classList.contains("next-icon")||r.parentElement.classList.contains("next-icon"))&&!n.elements.container.classList.contains("selected")&&(n.elements.container.addClassName("js-not-selectable"),n.elements.container.removeClassName("js-selected")))}});(this._hasSubMenus()||!this._hasSubMenus()&&this.menuItems.length>7)&&t.unshift({name:"search-field",id:"search-field"}),this.dropDownMenu=new i({target:e.getElement(".chevron-cont"),className:"tn-embedded-menu tn-"+e.rootw.replace("ds6w:","")+"-menu",multiSelect:!0,closeOnClick:!1,items:t,position:"bottom right",removeOnHide:!0,zindex:e.proxy.embeddedZProperty(),events:{onShow:function(){e.buttonContainer.addClassName("shown"),e._treatMenuItemView(e.menuItems);for(var t=e.dropDownMenu.items,i=0;i<t.length;i++)t[i].elements.container.getElement(".tag-label")&&(t[i].elements.container.getElement(".tag-label").style.width="calc(100% - "+(38+t[i].elements.container.getElement(".tag-count").getDimensions().width)+"px)",t[i].elements.container.getElement(".tag-label").addClassName("add-ellipsis"));e._treatMenuItemView(e.menuItems)},onHide:function(){e.buttonContainer.removeClassName("shown")},onClick:function(t,i,a){if(t.target.className.contains("fonticon-right-open"))return;let n=[],r=function(e){n=n.concat(e),e.forEach((e,t)=>{e.getOption("subMenuItems")&&r(e.getOption("subMenuItems"))})};r(e.menuItems);let s=n.find(e=>e.getOption("identifier")==i.name);s&&s._toggleTagSelection()}}}),this.dropDownMenu.getItem("search-field")&&this._getSearchField()},destroyDropDowmMenu:function(){this.dropDownMenu.items=[]},clearInput:function(e){this.searchInput.value="",this.searchTagsInMenu()},getFilteredTagsItems:function(e,t,a){let s;if(this._getFilteredTags(e,t,a),this.sortMenuItems(a),!a.length){let e=new r({model:new i({id:"no-result-item",title:n.getText("noRslt")})}).render();e.setOption("identifier","no-result-item"),a.push(e)}return s=this.buildMenuItemsStructure(a)},destroy:function(){this.stopListening(),this.model=null,this._menuTooltip&&this._menuTooltip.destroy(),this._menuTooltip=void 0,this._removeTagTooltip&&this._removeTagTooltip.destroy(),this._removeTagTooltip=void 0,this._searchIconTooltip&&this._searchIconTooltip.destroy(),this._searchIconTooltip=void 0,this._clearSearchTooltip&&this._clearSearchTooltip.destroy(),this._clearSearchTooltip=void 0,this.subLabelTooltip&&this.subLabelTooltip.destroy(),this.subLabelTooltip=void 0,this.scroller&&this.scroller.destroy(),this.scroller=void 0,this._parent()}})}),define("DS/TagNavigator/TaggerProxy",["UWA/Core","UWA/Class/Events","UWA/Class/Listener","UWA/Class/Promise","DS/TagNavigator/TagValue","DS/TagNavigator/Predicate","DS/TagNavigator/Filter","DS/TagNavigator/Logger","DS/TagNavigator/Parameters","DS/TagNavigator/NotificationManager","DS/TagNavigator/Notification","DS/TagNavigator/TaggerUtils","DS/TagNavigator/TaggerSettings","DS/TagNavigator/TaggerNLS","DS/SNInfraUX/TaggerConfigAccess","DS/TagNavigator/simplified/model/AdvancedFilter","DS/TagNavigator/simplified/utils/CriteriaUtils","DS/TagNavigator/Groupings","DS/TagNavigator/simplified/utils/PersonUtils","DS/MessageBus/MessageBus"],function(e,t,i,a,n,r,s,o,l,c,d,g,u,h,p,f,m,v,T,C){"use strict";var w=t.extend(i,{init:function(t,i){var a;if(this._enablePerfo=u.getOption("enablePerfo"),this._initPromise=void 0,!t||"string"!=typeof t.id)throw new Error("Invalid input arg");for(a in this._alive=!0,this._navimpl=i,this._listenerOf={},this._tagValuesMap={},this._predicateTagValuesMap={},this._subjectsTagValuesMap={},this._explicitValues={},this._explicitTagSuggestions=[],this.advancedOptions={},t.isSimplifiedView&&(this.advancedOptions=t.simplified||{},Object.keys(this.advancedOptions).length>0&&(this._selectedValues=new f)),this.isSimplifiedView=t.isSimplifiedView,this._selectedValues||(this._selectedValues=new s),this._groupingOptions=t.enableGrouping||void 0,this.validateGroupingOptions(),this._groupings=new v,this._excludeInfo=t.exclude,this._selectInAppInfo=t.selection,this._activeTagsOptions=t.activeTagsOptions,this._tagValuesIdxForSubject={},this._nbSubjects={},this._subjectsInEdition=[],this._persistTags=!0,this._allowedRootWForSubjects=u.getOption("simplifiedRootW"),this._tagsInCreation=[],this.disableOntologySuggestions=!1,this.disableCommunitySuggestions=!1,this.subjectsMapByPredValue={},this._fields={},this._id=t.id,this._widgetId=t.widgetId,this._isActive=!0,this._isReady=!0,t.cStorages)e.is(t.cStorages[a],"object")||delete t.cStorages[a];for(a in t.tagsServers)e.is(t.tagsServers[a],"object")||delete t.tagsServers[a];this._cStorages=t.cStorages||{},this._tagsServers=e.is(t.tagsServers,"object")&&Object.keys(t.tagsServers).length?t.tagsServers:null,this._tenant=t.tenant||null,this._filteringMode=t.filteringMode,this._hasPlatformData=t.hasPlatformData,this.colorizeSupport=t.colorize||!1,this._enableTagsOnDemand=u.getOption("enableTagsOnDemand")&&t.enableTagsOnDemand||!1,this._fetchAllTags=!t.enableTagsOnDemand&&void 0,this.freeInputSupport=t.freeInput||!1,this.preciseCount=t.preciseCount||!1,this.predicateSortOrder=t.predicateSortOrder||void 0,this.relevantPredicates=[],this.enablePLM=t.enablePLM||!1,this.parameters=null,this.enablePLM&&(this.parameters=new l),this._criteriaIdsMap={},this._tagsWithInternalName=u.getOption("tagsWithInternalName"),this._moreCountVar,this.predicateInfo=void 0,this._adminConfig=void 0,this.appID=t.appId,this._adminConfigPromise=void 0,this._taggerViewVisibility=this._navimpl.getTaggerViewVisibility();var n=this;if(this._predicateOperatorConfig=void 0,this._predicateOperatorPromise=void 0,this.predicateTagsMap=new Map,t&&t.embeddedTagger&&(this.hasEmbeddedView=!0,this.embeddedViewVisibility=!1,this._embeddedTaggerView=void 0,this._embeddedTaggerViewOptions=t.embeddedTagger,this.embMultiselect=!t.embeddedTagger.hasOwnProperty("multiselect")||t.embeddedTagger.multiselect,this.zProperty=t.embeddedTagger.hasOwnProperty("zIndexForMenu")?t.embeddedTagger.zIndexForMenu:200,this._initializeEmbeddedView()),Object.keys(this.advancedOptions).length>0&&this.advancedOptions.editTagsRelationships){this.editTagsRelationships=this.advancedOptions.editTagsRelationships;var r=this.hasExcludeSupport();require(["DS/TagNavigator/simplified/activeTags/AdvancedActiveTagsView","DS/TagNavigator/simplified/activeTags/ActiveTagsViewModel"],function(e,t){n.activeTagsViewModel=new t,n.activeTagsView=new e({model:n.activeTagsViewModel,exclude:r}).render(),n.activeTagsView.hide()})}this._globalFiltersWithoutExclude=this._navimpl.getFilters(),this.listenTo(this._navimpl,"onBeforeGlobalFilterChange",this._onBeforeGlobalFilterChangeCB.bind(this)),this._enableCompanyTags=u.getOption("companyTags")},_onBeforeGlobalFilterChangeCB:function(){o.log("Inside _onBeforeGlobalFilterChangeCB for proxy id="+this._id),this.supportsAdvancedFilter()||(this._globalFiltersWithoutExclude=this._removeExcludedTags(this._navimpl.getFilters().allfilters))},getActiveTagsEditView:function(){return this.activeTagsView},getActiveTagsEditModel:function(){return this.activeTagsViewModel},injectEmbeddedTaggerView:function(){if(this._embeddedTaggerView&&!this._embeddedTaggerView.container.isInjected()){var t=document.body.getElement(this._embeddedTaggerViewOptions.target);t?(o.log("targetElem for embedded tagger is AVAILABLE, injecting the view into the DOM"),this._embeddedTaggerView.inject(t)):e.is(this._embeddedTaggerViewOptions)&&e.is(this._embeddedTaggerViewOptions.is6WInWebInWinActive)&&!0===this._embeddedTaggerViewOptions.is6WInWebInWinActive?o.log("targetElem for embedded tagger is IN WebInWin"):o.error("targetElem for embedded tagger is NOT YET AVAILABLE")}},showEmbeddedTaggerView:function(){o.log("inside TaggerProxy#showEmbeddedTaggerView"),this._taggerViewVisibility?o.warn("Main Tagger is visible so ignoring the showEmbeddedTaggerView request"):(this.embeddedViewVisibility=!0,this._embeddedTaggerView&&this._embeddedTaggerView.show())},hideEmbeddedTaggerView:function(){o.log("inside TaggerProxy#hideEmbeddedTaggerView"),this.embeddedViewVisibility=!1,this._embeddedTaggerView&&this._embeddedTaggerView.hide()},redrawEmbeddedView:function(){return this._embeddedTaggerView._redrawTags()},updateEmbeddedViewGroupings:function(){u.getOption("updateEmbeddedGroupings")&&this._embeddedTaggerView&&this._embeddedTaggerView.updateGroupings()},requestEmbeddedViewGroupingChange:function(e){this._embeddedTaggerView&&this._embeddedTaggerView.requestGroupingChange(e)},embeddedViewMultiSelect:function(){return this.embMultiselect},embeddedZProperty:function(){return this.zProperty},getNavImpl:function(){return this._navimpl},setNavImpl:function(e){this._navimpl=e},isFeatureSupported:function(e){var t=!1;switch(e){case"grouping":t=!!this._groupingOptions;break;case"exclude":t=!!this._excludeInfo;break;case"selectInApp":t=null!=this._selectInAppInfo&&"object"==typeof this._selectInAppInfo}return t},getTenant:function(){return this._tenant},isTagInEdition:function(e){return this._tagsInCreation[e.fullid]},widgetId:function(){return this._widgetId},isActive:function(){return this._isActive},isReady:function(){return this._isReady},isFilteringOnServer:function(){return"FilteringOnServer"===this._filteringMode},getFilters:function(e,t,i){var a={};return a.localfilters=e&&!this.isActive()?{}:this._selectedValues.computeFilterObj(null,this._fields,e,t,i).allfilters,a.allfilters=this._selectedValues.computeFilterObj(this._navimpl.getFilters(this._fields),this._fields,e,t,i).allfilters,this._enableTagsOnDemand&&(a.fetchAllTags=this._fetchAllTags),this.hasExcludeSupport()||this.supportsAdvancedFilter()||(a.allfilters=this._removeExcludedTags(a.allfilters)),a},hasFreeInputOnly:function(e){return!(!this.predicateInfo||!this.predicateInfo.hasOwnProperty(e))&&(!!this.predicateInfo[e].hasOwnProperty("freeInputOnly")&&this.predicateInfo[e].freeInputOnly)},hasFreeInputSupport:function(e){var t;return t=!(!this.predicateInfo||!this.predicateInfo.hasOwnProperty(e))&&(!!this.predicateInfo[e].hasOwnProperty("allowFreeInput")&&this.predicateInfo[e].allowFreeInput),this.freeInputSupport||t},validateGroupingOptions:function(){if(this._groupingOptions){if(!UWA.is(this._groupingOptions,"object"))throw new Error("INVALID grouping options provided to the proxy, "+JSON.stringify(this._groupingOptions));var e=this._groupingOptions.maxLevels;e?Number.isInteger(e)&&0!=e||(o.error("INVALID grouping options provided to the proxy, maxLevels= "+JSON.stringify(e)+", setting to default value"),this._groupingOptions.maxLevels=-1):this._groupingOptions.maxLevels=-1;var t=this._groupingOptions.maxPerLevel;t?Number.isInteger(t)&&0!=t||(o.error("INVALID grouping options provided to the proxy, maxPerLevel= "+JSON.stringify(t)+", setting to default value"),this._groupingOptions.maxPerLevel=-1):this._groupingOptions.maxPerLevel=-1;var i=this._groupingOptions.maxHierarchyPerLevel;i?Number.isInteger(i)&&0!=i||(o.error("INVALID grouping options provided to the proxy, maxHierarchyPerLevel= "+JSON.stringify(i)+", setting to default value"),this._groupingOptions.maxHierarchyPerLevel=-1):this._groupingOptions.maxHierarchyPerLevel=-1}},hasGroupingSupport:function(e,t){var i=!1;if(this._groupingOptions&&(i=!0,e&&this.predicateInfo)){var a=this.predicateInfo[e];a&&(0==a.allowGrouping?i=!1:t&&0==a.allowPredicateGrouping&&(i=!1))}return i},getGroupingConfig:function(){return UWA.clone(this._groupingOptions)},isGroupedBy:function(e,t,i){return this._groupings.isGroupedBy(e,t,i)},selectInAppBy:function(e){this.triggerCallbackOfEvent(w.SelectInApp,e)},groupBy:function(e,t,i,a){let n=this,r={},s=UWA.clone(this._navimpl.getGroupingInfo()),o={};e&&e.length||e&&!e.length&&!a?(n._groupings.computeGroupingInfo(e,i),r=UWA.clone(this._groupings.getGroupingInfo()),s&&s.groups&&(r.groups=r.groups.concat(s.groups))):(!e||e&&!e.length&&a)&&(r=UWA.clone(s),(o=UWA.clone(this._groupings.getGroupingInfo()))&&o.groups&&(r.groups=r.groups.concat(o.groups))),t&&this.triggerCallbackOfEvent(w.GroupingChange,r)},getActiveGroupings:function(){return this._groupings.getActiveGroupings()},hasActiveGroupings:function(){return this._groupingOptions&&this._groupings.hasActiveGroupings()},setLocalGrouping:function(e){return new a(function(t,i){if(this._groupingOptions)if(UWA.is(e.grouping,"object")&&UWA.is(e.grouping.groups,"array")){var a=e.grouping.groups;a.length>0?(this.groupBy(a,e.triggerGroupingChangeCB),this._navimpl.dispatchEvent("REDRAW_TAGS",{event:"setLocalGrouping"}),t()):i("INVALID inputs for setLocalGrouping, call ignored")}else i("INVALID inputs for setLocalGrouping, call ignored");else i("Proxy does not support groupings, setLocalGrouping ignored")}.bind(this))},_requestGroupingChange:function(e){this._navimpl.dispatchEvent("REQUEST_GROUPING_CHANGE",{event:"requestGroupingChange",data:e})},clearLocalGrouping:function(e,t){return new a(function(i,a){if(this._groupingOptions){this.groupBy([],e?e.triggerGroupingChangeCB:void 0,null,t),this._navimpl.dispatchEvent("REDRAW_TAGS",{event:"clearLocalGrouping"}),i()}else a("Proxy does not support groupings, clearLocalGrouping ignored")}.bind(this))},hasExcludeSupport:function(e){var t=!1;return UWA.is(this._excludeInfo,"boolean")?t=this._excludeInfo:UWA.is(this._excludeInfo,"obejct"),t},hasSelectInAppSupport:function(){return UWA.is(this._selectInAppInfo,"object")},hasLoadMoreTagsEnabled:function(){return this._enableTagsOnDemand},isFetchAllTagsCalled:function(){return this._fetchAllTags},hasCusomActiveTags:function(){return!!UWA.is(this._activeTagsOptions,"object")},getActiveTagsOptions:function(){return this._activeTagsOptions},getExpandStatus:function(e){var t=this._adminConfig||this.predicateInfo;return!!t&&("person"==e||(t.hasOwnProperty(e)?!!t[e].hasOwnProperty("expanded")&&t[e].expanded:void 0))},isPreciseCount:function(){return this.preciseCount},isAdvancedSearch:function(){return Object.keys(this._criteriaIdsMap).length>0},getTagsServers:function(){return this._tagsServers},getCStorages:function(){return this._cStorages},hasPlatformData:function(){return this._hasPlatformData},getSortOrder:function(){return this.predicateSortOrder},setSortOrder:function(e){this.predicateSortOrder=e,this.triggerCallbackOfEvent(w.SortChange,e)},getAdvancedOption:function(e){return this.advancedOptions[e]},_alivePreCond:function(){if(!this._alive)throw new Error("TaggerProxy '"+this._id+"' is a zombie")},_sanitizeTags:function(t,i,a){let n=i&&!this._enableCompanyTags;const s=performance.now();if(!e.is(t,["object","array"]))return t;var l=Array.isArray(t)?t:[].concat.apply([],Object.keys(t).map(function(e){return t[e]}));o.log("duration convert to Array="+(performance.now()-s));const c=performance.now();var d={},g=u.getOption("forbiddenTags"),h=UWA.is(g,"object")&&this._navimpl.isInternalProduction();const p=new Map;var f,m;let v=new Map;l.forEach(function(e){m=!0;var t=e.sixw,s=p.get(t);let l;if(h&&i&&(f=g[t])&&-1!=f.indexOf(e.object)&&(m=!1,o.log("forbidden tag removed from the summary:"+JSON.stringify(e))),m&&(Array.isArray(e.object)&&(e.object.length>0?(d[t]=!0,(!Array.isArray(e.dispValue)||Array.isArray(e.dispValue)&&e.dispValue.length!==e.object.length)&&(e.dispValue=e.object.slice(0))):(m=!1,o.log("tag removed from the summary, t.object is not a valid array:"+JSON.stringify(e)))),m))if(s)e.predicate=v.get(t),n&&!e.predicate.isCompanyPredicate()||!n?s.push(e):o.log("Company tag blocked : "+e.object);else try{let i={sixw:t,type:e.type,server:a};l=new r(i),v.set(t,l),n&&!l.isCompanyPredicate()||!n?(e.predicate=l,s=[e],p.set(t,s)):o.log("Company tag blocked : "+e.object)}catch(e){o.error("Unable to create predicate")}}),o.log("generic treatment="+(performance.now()-c));const T=performance.now();for(var C in o.log("Number of predicates with hierarchical tags="+Object.keys(d).length),d){o.log("treating predicate with hierarchical tags="+C);var w=p.get(C);if(Array.isArray(w)){let t={},i=[],a=w.length;o.log("total number of tags="+a);for(let e=0;e<a;e++){let a=w[e];Array.isArray(a.object)?t[a.object[0]]=!0:i.push(a)}let n=i.length;o.log("total number of tags with object as string="+n),o.log("size of map of first element of those objects which are array ="+Object.keys(t).length);for(let a=0;a<n;a++){let n=i[a],r=n.object;"string"==typeof r&&t[r]&&(n.object=[r],n.dispValue=e.is(n.dispValue)?[n.dispValue]:n.dispValue)}}}if(o.log("hierarchical treatment="+(performance.now()-T)),i){const e=performance.now();var b=[];for(let e of p.values())b=b.concat(e);return o.log("tags concatenation="+(performance.now()-e)),o.log("total time taken by _sanitizeTags="+(performance.now()-s)),b}return o.log("total time taken by _sanitizeTags="+(performance.now()-s)),t},addNbSubjectsForTagValue:function(e,t){if(this._tagValuesMap[e])this._nbSubjects[e]+=t;else{this._tagValuesMap[e]=e,this._nbSubjects[e]=t;var i=e.pred.id();this._predicateTagValuesMap[i]?this._predicateTagValuesMap[i].push(e):this._predicateTagValuesMap[i]=[e]}},getNbSubjectsForTagValue:function(e){return this._nbSubjects[e]},_addFieldsForTagValue:function(e,t){t&&""!==t&&(this._fields[e]=this._fields[e]||{},this._fields[e][t]=!0,e.parent&&this._addFieldsForTagValue(e.parent,t))},addTagValueForSubject:function(e,t){this.addNbSubjectsForTagValue(t,1),this.indexSubjectsTagsForFiltering(t,e),this._tagValuesIdxForSubject[e].push(t.fullid)},removeTagValueForSubject:function(e,t){this._nbSubjects[t]--,this._nbSubjects[t]<=0&&delete this._tagValuesMap[t],t.decrementCount(1),this.removeFromIndexTagForFiltering(t,e),this._tagValuesIdxForSubject[e].splice(this._tagValuesIdxForSubject[e].indexOf(t.fullid),1)},_computeTagsValues:function(e){var t,i,a,n,r,s,o,l,c,d,g,u,h,p,f,m;for(t in g={},a=[],e)if(e.hasOwnProperty(t))for(u=0,h=(n=e[t]).length;u<h;u++){if(c=(s=g[p=(i=n[u]).sixw]?g[p]:g[p]={})[f=i.field]?s[f]:s[f]={},!("string"==typeof(m=i.object)&&0!==m.length||Array.isArray(m)&&0!==m.length))throw new Error("Invalid input arg");c[m]||(c[m]={count:0,type:i.type,uri:i.object},void 0!==i.dispValue&&(c[m].dispValue=i.dispValue)),c[m].count+=1}for(d in g)if(g.hasOwnProperty(d))for(r in s=g[d])if(s.hasOwnProperty(r))for(o in c=s[r])c.hasOwnProperty(o)&&(i={count:(l=c[o]).count,type:l.type,object:l.uri,sixw:d},void 0!==l.dispValue&&(i.dispValue=l.dispValue),r&&"undefined"!==r&&(i.field=r),a.push(i));return a},getLocalFilter:function(){return this._selectedValues},setClonedFilter:function(e){this._selectedValues=e},supportsAdvancedFilter:function(){return this._selectedValues instanceof f},id:function(){return this._alivePreCond(),this._id},addListener:function(e,t,i){return this._alivePreCond(),this._listenerOf[e]={cb:t,scope:i},this},compareObjects:function e(t,i){if(t===i)return!0;if(!(t instanceof Object&&i instanceof Object))return!1;if(t.constructor!==i.constructor)return!1;for(var a in t)if(t.hasOwnProperty(a)){if(!i.hasOwnProperty(a))return!1;if(t[a]===i[a])continue;if("object"!=typeof t[a])return!1;if(!e(t[a],i[a]))return!1}for(a in i)if(i.hasOwnProperty(a)&&!t.hasOwnProperty(a))return!1;return!0},_removeExcludedTags:function(e){for(var t in e)e[t]=e[t].filter(function(e){return!0!==e.excluded});var i={};for(var t in e)e[t].length>0&&(i[t]=e[t]);return i},shouldBeWarned:function(e){var t=!0;if(!this.hasExcludeSupport()&&UWA.is(e,"object")&&UWA.is(e.allfilters,"object")&&(!(this._navimpl.getFocusedProxy()===this)&&!this.hasLocalFilters()&&!this.supportsAdvancedFilter())){var i=this._removeExcludedTags(UWA.clone(e.allfilters));UWA.is(this._globalFiltersWithoutExclude,"object")&&this.compareObjects(this._globalFiltersWithoutExclude,i)&&(t=!1)}return t},onBeforeRefine:function(){this._isReady=!1},onRefine:function(e){var t,i,a,n;UWA.is(e,"object")&&(t=e.isSearch,i=e.isInternal,a=e.triggerProxyCB);var r=this._isReady;if(this._isReady=!1,n=this.getFilters(),t&&(n.search=!0),UWA.is(a,"boolean")?(n.triggerProxyCB=a,this._isReady=r):null==a&&!0===i&&(this._isReady=r),this.getParameters()){var s=this.getParameters().getFilters();s&&(n.PLMParameters=s)}!0===i?this.triggerCallbackOfEvent(w.InternalFilterChange,n):this.triggerCallbackOfEvent(w.FilterChange,n)},onLoadMoreTags:function(){this._enableTagsOnDemand?(this._fetchAllTags=!0,this._isReady=!1,this.triggerCallbackOfEvent(w.LoadMoreTags)):o.error("Load More Tags not supported by proxy!")},onSearch:function(){this._isReady=!1,this.onRefine({isSearch:!0}),this._navimpl.dispatchEvent("SEARCH_LAUNCH")},warnForCriteriaChange:function(e){this.triggerCallbackOfEvent(w.CriteriaChange,e)},updateTaggerDisplayStatus:function(e,t){this._taggerViewVisibility=e,t&&this.triggerCallbackOfEvent(w.updateDisplayStatus,e)},_initialize:function(){return this._initPromise||(this._initPromise=new a(function(e){let t,i,n,r=[],s=this.getGrantedRoles();r.push(s),this.appID&&this._tenant&&(t=this.retrieveAdminConfig(),r.push(t)),this._embeddedTaggerViewOptions&&(i=this._initializeEmbeddedView(),r.push(i)),this.advancedOptions&&this.advancedOptions.editTagsRelationships&&(n=this.retrieveAdminPredicateOperatorConfig(),r.push(n)),a.all(r).then(function(){e()})}.bind(this))),this._initPromise},getGrantedRoles:function(){return this._rolesPromise||(this._rolesPromise=new a(function(e){if(!0===u.getOption("offline6W"))o.warn("TaggerProxy: No role computation in offline mode"),this._isBIOnly=!1,e();else if(!0===window.richClient||Object.keys(this._cStorages).length>0&&-1!==this._cStorages[Object.keys(this._cStorages)[0]].getUrlPart("path").indexOf("/VocabularyStub"))this._isBIOnly=!1,e();else{var t=this;g.getGrantedRoles().then(function(i){UWA.is(i,"array")&&(t._isBIOnly=!1,t._tenant&&(i=i.filter(function(e){return-1!==e.platforms.indexOf(t._tenant)})),(i=i.map(function(e){return e.id})).length>0&&-1!==i.indexOf("MPU")||1===i.length&&"IFW"===i[0]||1===i.length&&"UAU"===i[0]?t._isBIOnly=!0:2===i.length&&-1!==i.indexOf("Operator")&&-1!==i.indexOf("IFW")&&(t._isBIOnly=!0),e())})}}.bind(this))),this._rolesPromise},populateRelevantPredicates:function(e){this.relevantPredicates=this.relevantPredicates.concat(Object.keys(e).filter(t=>e[t].relevant))},retrieveAdminConfig:function(){return this._adminConfigPromise||(this._adminConfigPromise=new a(function(e){if(this.appID&&this.isSimplifiedView)if(u.getOption("testEnableTagsOnDemand")){require(["DS/TagNavigator.tst/utils/LoadDataUtil"],t=>{t.getData("BasicTagsDemo",this._widgetId,"configure").then(t=>{this._adminConfig=t,e()})})}else p.get6WTagsConfiguration({appID:this.appID,tenantID:this._tenant}).then(function(t){o.log(`Configured Predicates for App ID ${this.appID}: ${JSON.stringify(t)}`),this._adminConfig=t,this._adminConfig&&this.populateRelevantPredicates(this._adminConfig),this.relevantPredicates.length&&this._addAdditionalPreferredPredicates(),e()}.bind(this),function(){o.log(`No Configured Predicates for App ID ${this.appID}.`),e()}.bind(this));else e()}.bind(this))),this._adminConfigPromise},_initializeEmbeddedView:function(){return this._embeddedViewPromise||(this._embeddedViewPromise=new a(function(e){if(this.hasEmbeddedView){var t,i,a=u.getOption("simplifiedRootW"),n={};i=Array.isArray(this._embeddedTaggerViewOptions.rootw)?this._embeddedTaggerViewOptions.rootw.reduce(function(e,t,i){return e[t]={},e},{}):this._embeddedTaggerViewOptions.rootw,a.forEach(function(e){for(var t in i)e==t&&(n[t]=i[t])}),t=i.hasOwnProperty("allw")?{allw:i.allw,...n}:{allw:{},...n},require(["DS/TagNavigator/embeddedTagger/EmbeddedTaggerView"],function(i){this._embeddedTaggerView=new i({rootw:t,proxy:this,is6WInWebInWinActive:this._embeddedTaggerViewOptions?this._embeddedTaggerViewOptions.is6WInWebInWinActive:void 0}).render(),this.embeddedViewVisibility||this._embeddedTaggerView.hide(),this.injectEmbeddedTaggerView(),e()}.bind(this))}else e()}.bind(this))),this._embeddedViewPromise},retrieveAdminPredicateOperatorConfig:function(){let e=u.getOption("editTagsPredicateOperators");return this._predicateOperatorPromise||(this._predicateOperatorPromise=new a(function(t){if(this.isSimplifiedView){if(e)this._predicateOperatorConfig=e,this._selectedValues.setAdminPredOperator&&this._selectedValues.setAdminPredOperator(this._predicateOperatorConfig),t();else if(UWA.is(p.get6WTagsRelationship,"function")){let e=p.get6WTagsRelationship({tenantID:this._tenant});e?e.then(function(e){o.log(`Retrieving the predicate operators from Admin: ${JSON.stringify(e)}`),this._predicateOperatorConfig=e,this._selectedValues.setAdminPredOperator&&this._selectedValues.setAdminPredOperator(this._predicateOperatorConfig),t()}.bind(this),function(){o.log("No operators set by Admin"),t()}.bind(this)):(o.log("Error resolving promise"),t())}else p.get6WTagsRelationship=function(){return new a(function(e){this._predicateOperatorConfig={"ds6w:type":{operator:"AND"},"ds6w:policy":{operator:"XOR"},"ds6w:context":{opertaor:"AND"}},this._selectedValues.setAdminPredOperator&&this._selectedValues.setAdminPredOperator(this._predicateOperatorConfig),e()})};t()}else t()}.bind(this))),this._predicateOperatorPromise},getResultsCount:function(){return this.resultCount},setTags:function(t,i,r){this.dispatchEvent("setTags_ended_external");var s=performance.now();return this.hasEmbeddedView&&this.injectEmbeddedTaggerView(),this.resultCount=r?r.count:null,new a(function(a){var r=performance.now();this._initialize().then(function(){var l,c,d,g,u,h;this._enablePerfo&&console.profile("SET TAGS"),o.log("TaggerProxy.setTags _initialize performance: "+(performance.now()-r)+"ms"),this.dispatchEvent("setTags_started"),this._isBIOnly&&e.is(this._tagsServers,"object")?h=this._tagsServers[Object.keys(this._tagsServers)[0]]:!1===this._isBIOnly&&e.is(this._cStorages,"object")&&(h=this._cStorages[Object.keys(this._cStorages)[0]]),t=this._sanitizeTags(t,null,h),(i=this._sanitizeTags(i,!0,h))||(i=null),this.unloadAllTags();let p=performance.now();if(null===i||0===i.length)try{i=this._computeTagsValues(t)}catch(e){o.error("Invalid input arg")}if(o.log("TaggerProxy.setTags _computeTagsValues performance: "+(performance.now()-p)+"ms"),i){let e=performance.now();for(g=0,u=i.length;g<u;g++){"date"===(d=i[g]).type&&(d.object=d.object.split("-").join("/").substr(0,10));let e=d.sixw,t=this.predicateTagsMap.get(e);try{if(d.field&&(d.explicit=d.field==n.EXPLICIT_TAG,d.explicit&&d.object&&("string"==typeof d.object&&1==d.object.split(n.BELCHAR).lenght||Array.isArray(d.object)&&1==d.object.length&&0==d.object[0].indexOf(n.SIXW_ROOT_ONTOLOGY)))){o.log("Ignoring the standard explicit tag which is not an hierarchy - "+JSON.stringify(d));continue}c=n.getTagValue(d,null,null,null,null,h,!0)}catch(e){o.error("Error in setTags")}c&&("string"==typeof(l=d.count)&&(l=parseInt(l,10)),"number"!=typeof l||isNaN(l)?o.warn("Invalid count '"+d.count+"' passed to setTags API for tag '"+d.dispValue+"'"):(c.incrementCount(l),this.addNbSubjectsForTagValue(c,l),this._addFieldsForTagValue(c,d.field)),t?t.push(c):(t=[c],this.predicateTagsMap.set(e,t)))}o.log("TaggerProxy.setTags TagValue.getTagValue & related processes performance: "+(performance.now()-e)+"ms"),this.addSubjects(t).then(function(){this._isReady=!0,this.dispatchEvent("setTags_ended");let e=performance.now()-s;o.log("TaggerProxy.setTags performance: "+e+"ms"),this._enablePerfo&&console.profileEnd();let n={pd1:e.toString(),pd2:i?i.length.toString():0,pd3:t?Object.keys(t).length.toString():0};(i&&i.length||t&&Object.keys(t).length)&&this.messageBusAnalytics("6WProxySetTagsPerfo",n),this._navimpl.dispatchEvent("REDRAW_TAGS",{event:"setTags"}),a()}.bind(this))}else a()}.bind(this))}.bind(this))},messageBusAnalytics:function(e,t){C.publish({channel:"TaggerTrackerApi",topic:"hit",data:{category:"6WTagger",action:e,persDim:t}})},setEmbeddedViewProperties:function(e){return this.dispatchEvent("embedded_properties_change",e),this},_addInternalNameToEnumDisplay:function(e){UWA.is(e.datasets)&&UWA.is(e.datasets.items,"array")&&e.datasets.items.forEach(function(e){e.label&&e.value&&(e.label+=" ("+e.value+")")})},setCriteria:function(t){return new a(function(i){this._initialize().then(function(){var a,n,s,l,g;if(this._isBIOnly&&e.is(this._tagsServers,"object")?l=this._tagsServers[Object.keys(this._tagsServers)[0]]:!1===this._isBIOnly&&e.is(this._cStorages,"object")&&(l=this._cStorages[Object.keys(this._cStorages)[0]]),this._criteriaIdsMap={},t)for(a=0,n=t.length;a<n;a++){if(this._criteriaIdsMap[t[a].sixw]=!0,!(s=r.getPredicate(t[a].sixw.split("/").pop()))){-1===t[a].sixw.indexOf("/")&&(t[a].sixw="void/"+t[a].sixw),g="enum"===t[a].type?"string":t[a].type;var u={sixw:t[a].sixw,type:g,server:l,options:t[a].options};(t[a].forceDispValue||"void/vpmextension"===u.sixw)&&(o.warn("considering the input display name for predicate "+u.sixw+"="+t[a].dispValue),u.displayName=t[a].dispValue);try{s=new r(u)}catch(e){c.push(new d("Fail to create a predicate with invalid arg. Id is :'"+u.sixw+"'")),c.dispatch()}}"enum"===t[a].type&&s.setIsEnum(!0),s.setSuggestSupport(t[a].allowSuggestions),s.setUnit(t[a].unit),t[a].options&&(this._tagsWithInternalName&&s.isEnum()&&this._addInternalNameToEnumDisplay(t[a].options),s.setElemOptions(t[a].options))}this.countMore(),this._navimpl.dispatchEvent("REDRAW_CRITERIA"),i()}.bind(this))}.bind(this))},updateCriteria:function(t){return new a(function(i){this._initialize().then(function(){var a,n,s,l;if(this._isBIOnly&&e.is(this._tagsServers,"object")?l=this._tagsServers[Object.keys(this._tagsServers)[0]]:!1===this._isBIOnly&&e.is(this._cStorages,"object")&&(l=this._cStorages[Object.keys(this._cStorages)[0]]),t&&t.length){for(a=0,n=t.length;a<n;a++){if(this._criteriaIdsMap[t[a].sixw]=!0,s=r.getPredicate(t[a].sixw.split("/").pop()))t[a].options&&(this._tagsWithInternalName&&s.isEnum()&&this._addInternalNameToEnumDisplay(t[a].options),s.setElemOptions(t[a].options));else{-1===t[a].sixw.indexOf("/")&&(t[a].sixw="void/"+t[a].sixw);var g={sixw:t[a].sixw,type:t[a].type,server:l,options:t[a].options};(t[a].forceDispValue||"void/vpmextension"===g.sixw)&&(o.warn("considering the input display name for predicate "+g.sixw+"="+t[a].dispValue),g.displayName=t[a].dispValue);try{s=new r(g)}catch(e){c.push(new d("Fail to create a predicate with invalid arg. Id is :'"+g.sixw+"'")),c.dispatch()}t[a].dispValue&&s.displayName()!==t[a].dispValue&&s.setDisplayName(t[a].dispValue),this._tagsWithInternalName&&s.isEnum()&&t[a].options&&this._addInternalNameToEnumDisplay(t[a].options),s.setElemOptions(t[a].options)}s.setSuggestSupport(t[a].allowSuggestions),s.setUnit(t[a].unit)}this.countMore(),this._navimpl.dispatchEvent("REDRAW_CRITERIA"),i()}}.bind(this))}.bind(this))},removeCriteria:function(e){var t,i;if(this._cStorages[Object.keys(this._cStorages)[0]],e&&e.length){for(t=0,i=e.length;t<i;t++)r.getPredicate(e[t].sixw.split("/").pop())&&delete this._criteriaIdsMap[e[t].sixw];this.countMore(),this._navimpl.dispatchEvent("REDRAW_CRITERIA")}},countMore:function(){var e=0;for(var t in this._criteriaIdsMap)r.getPredicate(t.split("/").pop()).getElemOptions()&&!1===r.getPredicate(t.split("/").pop()).getElemOptions().showByDefault&&e++;this.setMoreCountProxy(e)},setMoreCountProxy:function(e){this._moreCountVar=e},getMoreCountProxy:function(){return this._moreCountVar},_addAdditionalPreferredPredicates:function(){if(this.relevantPredicates||(this.relevantPredicates=[]),this.predicateInfo||(this.predicateInfo={}),!u.getOption("blockCommunityTagsInPreferredSection")&&this.isSimplifiedView){let e;r.ensureDefaultPredicates();for(let t in r.COMMUNITY_TAGS_PREDICATES)e=r.COMMUNITY_TAGS_PREDICATES[t].id(),-1==this.relevantPredicates.indexOf(e)&&this.relevantPredicates.push(e),this.predicateInfo[e]={relevant:!0,weight:1,expanded:!0}}if(!u.getOption("blockCompanyTagsInPreferredSection")&&this.isSimplifiedView){let e;r.ensureDefaultPredicates();for(let t in r.COMPANY_TAGS_PREDICATES)e=r.COMPANY_TAGS_PREDICATES[t].id(),-1==this.relevantPredicates.indexOf(e)&&this.relevantPredicates.push(e),this.predicateInfo[e]={relevant:!0,weight:2,expanded:!0}}this.getAdvancedOption(T.PERSON_REFINE)&&(this.predicateInfo[T.PERSON_PREDICATE]={relevant:!0,weight:99,expanded:!0},this.populateRelevantPredicates(this.predicateInfo))},configurePredicates:function(t){e.is(t,"object")?(this.populateRelevantPredicates(t),this.predicateInfo=t):o.error("the configurePredicates API take an Object as first arg."),UWA.is(this.predicateSortOrder)||(this.predicateSortOrder="sort-weight"),this.relevantPredicates.length&&this._addAdditionalPreferredPredicates()},getPredicateInfo:function(){return this.predicateInfo?UWA.clone(this.predicateInfo):void 0},hasRelevantPredicates:function(e){var t=UWA.clone(this.relevantPredicates);if(t&&t.length>0){if(e){var i=this.getHiddenPredicates();return t.filter(function(e){return-1==i.indexOf(e)})}return t}},getHiddenPredicates:function(){var e=[],t=this._adminConfig||this.predicateInfo;if(t)for(var i in t){var a=t[i];a&&UWA.is(a.weight,"number")&&a.weight<1&&e.push(i)}return this.getAdvancedOption(m.TYPE_CATEGORIZATION)&&e.push("ds6w:typeCategory"),e},getRangeDefine:function(e){},setStatus:function(e){this._navimpl.dispatchEvent("STATUS_UPDATE",e)},addSubjects:function(t){return new a(function(i){this._initialize().then(function(){var a,r,s,l,c,d,g;this._isBIOnly&&e.is(this._tagsServers,"object")?g=this._tagsServers[Object.keys(this._tagsServers)[0]]:!1===this._isBIOnly&&e.is(this._cStorages,"object")&&(g=this._cStorages[Object.keys(this._cStorages)[0]]);let u=!this._enableCompanyTags;for(a in t)if(t.hasOwnProperty(a))for(r=t[a],this._tagValuesIdxForSubject[a]=[],this._subjectsTagValuesMap[a]={},c=0,d=r.length;c<d;c++)if((s=r[c]).field&&(s.explicit=s.field==n.EXPLICIT_TAG,s.explicit&&s.object&&("string"==typeof s.object&&0==s.object.indexOf(n.SIXW_ROOT_ONTOLOGY)||Array.isArray(s.object)&&1==s.object.length&&0==s.object[0].indexOf(n.SIXW_ROOT_ONTOLOGY))))o.log("Ignoring the standard explicit tag which is not an hierarchy - "+JSON.stringify(s));else{"date"===s.type&&(s.object=s.object.split("-").join("/").substr(0,10));try{l=n.getTagValue(s.sixw,s.dispValue,s.object,s.type,null,g)}catch(e){o.error("Error in addSubjects")}if(l){if(u&&l.pred.isCompanyPredicate()){o.log("Ignoring the company tag on the subject - "+s.object);continue}this.indexSubjectsTagsForFiltering(l,a),this._tagValuesIdxForSubject[a].push(l.fullid),this._subjectsTagValuesMap[a][l.fullid]=l}}i()}.bind(this))}.bind(this))},indexSubjectsTagsForFiltering:function(e,t){var i=e.fullid;return this.subjectsMapByPredValue[i]=this.subjectsMapByPredValue[i]||{},this.subjectsMapByPredValue[i][t]=!0,e.parent&&this.indexSubjectsTagsForFiltering(e.parent,t),this},removeFromIndexTagForFiltering:function(e,t){var i=e.fullid;return delete this.subjectsMapByPredValue[i][t],this},getSubjectsFromTag:function(e){return Object.keys(this.subjectsMapByPredValue[e.fullid]||{})||[]},supportsEmbeddedView:function(){return this._embeddedTaggerView||this.hasEmbeddedView},die:function(e){return o.log("Inside TgagerProxy#die for proxy id="+this._id),this._isDying=!0,e||(e=!0),this._alivePreCond(),this.unloadAllTags(),this.clearLocalFilter(),this._isActive=!1,this._navimpl.getFocusedProxy()===this&&this._navimpl.removeFocusedProxy(!0),this.hasSubjectsInEdition()?this.unfocus():e&&this._navimpl.dispatchEvent("REDRAW_TAGS",{event:"die"}),this._navimpl.removeProxy(this),this._navimpl.updateFocusedProxy(),this.stopListening(this._navimpl,"onBeforeGlobalFilterChange"),this._navimpl=null,this._alive=!1,this._embeddedTaggerView&&this._embeddedTaggerView.destroy(),this.activeTagsView&&this.activeTagsView.destroy(),this.activeTagsViewModel&&this.activeTagsViewModel.destroy(),this},isAlive:function(){return this._alive},isDying:function(){return this._isDying},hasSubjectsInEdition:function(){return 0!==this._subjectsInEdition.length},focusOnSubjects:function(e,t,i,a){if(!0!==u.getOption("offline6W")){"boolean"!=typeof t&&(t=!0),i&&(this._dataSources=i),this._alivePreCond(),this._persistTags=t,this._subjectsInEdition=e.slice(0);var n=u.getOption("simplifiedRootW");if(a&&a.rootW?UWA.is(a.rootW,"array")&&(0==a.rootW.length?this._allowedRootWForSubjects=[]:this._allowedRootWForSubjects=a.rootW.filter(function(e){return-1!==n.indexOf(e)})):this._allowedRootWForSubjects=n,!this.hasSubjectsInEdition())return this.unfocus(),!1;if(u.getOption("EXISTINGS_TAGS_FROM_6WTAGS_DB")){const e=performance.now();this._tagsServers[Object.keys(this._tagsServers)[0]].getExistingTags({subject_uri:this._subjectsInEdition[this._subjectsInEdition.length-1],onComplete:function(t){console.log("existing tags subject="+t),console.log("duration to get existing tags="+(performance.now()-e))},onFailure:function(){console.error("FAILED to reetrive existing tags for subject")},onTimeout:function(){console.error("TIMEOUT to retrive existing tags for subject")}})}if(u.getOption("enableUserTagsSuggestions_FUN128285")&&a&&a.suggestionOptions){let e=a.suggestionOptions;e.disableOntologySuggestions&&(this.disableOntologySuggestions=!0),e.disableCommunitySuggestions&&(this.disableCommunitySuggestions=!0),e.suggestions&&Array.isArray(e.suggestions)?(e.suggestions.forEach(e=>{e.isExplicitTagSuggestion=!0}),this._explicitTagSuggestions=e.suggestions):this._explicitTagSuggestions=[]}return this._navimpl.dispatchEvent("REDRAW_TAGS",{event:"focusOnSubjects"}),this._navimpl.setIconVisibleBool(this._widgetId,!1),this._navimpl.dispatchEvent("UPDATE_ICON"),this}o.warn("Focus on subject ignored on offline mode")},getExplicitTagSuggestions:function(){if(this._explicitTagSuggestions.length)return new a(e=>{e({suggestions:this._explicitTagSuggestions})})},getFocusedSubjectsData:function(){var e=[],t=this;return this._subjectsInEdition.forEach(function(i){let a=t._dataSources?t._dataSources[i]:void 0,n={uri:i};a?UWA.is(a,"string")?n.service=a||(t.createTagOn3DSpace(i)?"3DSpace":""):UWA.is(a,"object")&&(n.source=a.source,n.service=a.serviceToPersistTags,n.containerId=a.containerId):n.service=t.createTagOn3DSpace(i)?"3DSpace":"",e.push(n)}),e},getAllowedRootWForTagging:function(){return this._allowedRootWForSubjects},activate:function(){this._alivePreCond(),!0!==this._isActive&&(this._isActive=!0,this._navimpl.updateFocusedProxy(),this._navimpl.dispatchEvent("REDRAW_TAGS",{event:"activate"}))},deactivate:function(){this._alivePreCond(),!1!==this._isActive&&(this._isActive=!1,this._navimpl.updateFocusedProxy(),this._navimpl.dispatchEvent("REDRAW_TAGS",{event:"deactivate"}))},unfocus:function(){this._alivePreCond(),this._subjectsInEdition=[],this._navimpl.dispatchEvent("REDRAW_TAGS",{event:"unfocus"}),this._navimpl.getIconVisibleBool(this._widgetId)!==(0!==Object.keys(this.getFilters().localfilters).length)&&(this._navimpl.setIconVisibleBool(this._widgetId,0!==Object.keys(this.getFilters().localfilters).length),this._navimpl.dispatchEvent("UPDATE_ICON"))},unsetTags:function(){return this._alivePreCond(),this.unloadAllTags(),this._isReady=!0,this.unfocus(),this},unloadAllTags:function(){return this._alivePreCond(),Object.keys(this._tagValuesMap).forEach(function(e){this._tagValuesMap[e].decrementCount(this._nbSubjects[e])}.bind(this)),this.subjectsMapByPredValue={},this._tagValuesIdxForSubject={},this._nbSubjects={},this._tagValuesMap={},this._predicateTagValuesMap={},this._subjectsTagValuesMap={},this},updateLocalFilterStatus:function(e){return this.triggerCallbackOfEvent(w.UpdateLocalFilterStatus,e)},toggleProxyFocus:function(e){return this._alivePreCond(),this._isActive?(this._navimpl.toggleProxyFocus(this,e),this):(o.error("Proxy is deactivate: Cannot focus on an inactive proxy"),this)},clearLocalFilter:function(e){this._alivePreCond();var t,i,a,n,s,o=this._navimpl.getCache().getCriteriaToResetBeforeFilterChange(this.id()),l=this._selectedValues.isEmpty();for(a in this._selectedValues.clear(),o)if(i=r.getPredicate(a),o[a].value)for(n=0;n<o[a].value.length;n++)-1!==(t=(s=i.getElemOptions())&&s.datasets&&s.datasets.items?s.datasets.items.map(function(e){return e.value}).indexOf(o[a].value[n].value):-1)&&!0===s.datasets.items[t].predefined&&delete s.datasets.items[t].predefined;return this._navimpl.getCache().resetCriteriaToResetBeforeFilterChange(this.id()),this._navimpl.getCache().resetCriteriaToRemoveBeforeFilterChange(this.id()),this.getParameters()&&this.getParameters().clearValues(),this.updateProxyView(l),!0===e&&this.onRefine(),this},setLocalFilter:function(t,i,s){return new a(function(a){this._initialize().then(function(){o.log("Inside setLocalFilter after _initialize"),o.log("mode = "+(s||"toggle"));var l,g,u,p,m,v,T,C,w,b,y=this,S=["ds6w:who","ds6w:when","ds6w:what","ds6w:where","ds6w:why","ds6w:how"],E=this._navimpl.getCache().getCriteriaToResetBeforeFilterChange(this.id()),I={};this._isBIOnly&&e.is(this._tagsServers,"object")?b=this._tagsServers[Object.keys(this._tagsServers)[0]]:!1===this._isBIOnly&&e.is(this._cStorages,"object")&&(b=this._cStorages[Object.keys(this._cStorages)[0]]);var x=(g=t.localFilter).isSimplified;!x||this._selectedValues instanceof f||o.error("Error in setLocalFilter, cannot handle the advanced input filter"),this._alivePreCond(),v=this._selectedValues.isEmpty();var _=function(t,i,a){if(u=t.replace("sixw:",""),T=u.split("/").pop(),"string"===a){for(p=0,m=i.length;p<m;p++)this._selectedValues.createFreeInput(u,a,i[p].object,i[p].displayValue),i[p].value=i[p].object,i[p].label=i[p].displayValue,i[p].selected=!0;I[T]=E[T]||{},I[T].type=E[T]&&E[T].type?E[T].type:i[0].type,I[T].value=E[T]&&E[T].value?E[T].value.concat(i):i,E=e.merge(I,E)}else if("boolean"===a)i.map(function(e){e.value=e.object,e.label="true"===e.object?h.getText("yes"):h.getText("no")}),I[T]={},I[T].value=i,I[T].type=a,this._selectedValues.createFreeInput(u,a,i[0].object,i[0].label);else if("integer"===a||"double"===a||"float"===a||"date"===a)for(w in"date"===a&&x?i.forEach(function(e){e.object.isSimplifiedCriteria=e.isSimplifiedCriteria,e.object.nls=e.displayValue,y._selectedValues.isSelectedAttribute(t,e)?y._selectedValues.removeFreeInput(u,a,e.object):y._selectedValues.createFreeInput(u,a,e.object)}):this._selectedValues.createFreeInput(u,a,i[0].object),I[T]={},I[T].type=a,i[0].object)"type"!==w&&(I[T][w]={value:"date"===a?new Date(i[0].object[w]):i[0].object[w],type:a});if(!r.getPredicate(T)){-1===S.indexOf(u.split("/")[0])&&(u="void/"+u);var n={sixw:u,type:a,server:b};try{new r(n)}catch(e){c.push(new d("Fail to create a predicate with invalid arg. Id is :'"+n.sixw+"'")),c.dispatch()}}};if(x)o.log("filter is AdvancedFilter"),g.condition.forEach(function(e){UWA.is(e,"object")&&o.log("filterCondition="+JSON.stringify(e));var t=Object.keys(e)[0];if(o.log("fullPredId="+t),0===t.indexOf("sixw:")){var i=e[t];C=e[t][0].type,_.call(y,t,i,C)}else{var a=e[t];UWA.is(a,"object")&&o.log("filterConditionInfo="+JSON.stringify(a)),a.isComplex?(o.log("filterCondition is complex"),a.condition.forEach(function(e){y._selectedValues.toggle({id:t,operator:a.operator,isComplex:!0,condition:e})})):a.condition.forEach(function(e){if(UWA.is(e,"object")&&o.log("condition="+JSON.stringify(e)),e.isComposite){o.log("filterCondition is composite");var i=y._navimpl._getCompositeTagValue({predicate:t,type:e.predicates[0].type,object:e.object,dispValue:e.display});y.getAdvancedOption("editTagsRelationships")&&(i.operator=a.operator),"add"===s?y._selectedValues.isSelected(i,!0)?o.log("filter is currently ALREADY SELECTED, no action needed"):(o.log("filter is currently NOT SELECTED, adding it"),y._selectedValues.toggle(i,P)):"remove"===s?y._selectedValues.isSelected(i,!0)?(o.log("filter is currently SELECTED, removing it"),y._selectedValues.toggle(i,P)):o.log("filter is currently NOT SELECTED, no action needed"):y._selectedValues.toggle(i,P)}else e.value.forEach(function(i,r){UWA.is(i,"object")&&o.log("tagObject="+JSON.stringify(i));try{var l=n.getTagValue(t,e.display,i,e.predicates[r].type,null,b)}catch(e){o.error("Error in setLocalFilter with TagValue.getTagValue")}y.getAdvancedOption("editTagsRelationships")&&(l.operator=a.operator),"add"===s?y._selectedValues.isSelected(l,!0)?o.log("filter is currently ALREADY SELECTED, no action needed"):(o.log("filter is currently NOT SELECTED, adding it"),y._selectedValues.toggle(l,P)):"remove"===s?y._selectedValues.isSelected(l,!0)?(o.log("filter is currently SELECTED, removing it"),y._selectedValues.toggle(l,P)):o.log("filter is currently NOT SELECTED, no action needed"):y._selectedValues.toggle(l,P)})})}});else for(var A in g)if(o.log("fullPredId="+A),g.hasOwnProperty(A))if(0===A.indexOf("sixw:")){var N=g[A];C=g[A][0].type,_.call(y,A,N,C)}else{UWA.is(g[A],"array")&&o.log("tags before manageDuplicates="+JSON.stringify(g[A]));N=this.manageDuplicates(g[A]);for(UWA.is(N,"array")&&o.log("tags after manageDuplicates="+JSON.stringify(N)),p=0,m=N.length;p<m;p++){var V=N[p];UWA.is(V,"object")&&o.log("tag to treat="+JSON.stringify(V));try{l=V.isComposite?this._navimpl._getCompositeTagValue({predicate:A,object:V.object,dispValue:V.disptext,type:V.type,isComposite:!0}):n.getTagValue(A,V.disptext,V.object,V.type,null,b)}catch(e){o.error("Error in setLocalFilter")}var P=void 0;UWA.is(V.excluded,"boolean")&&(P=V.excluded),"add"===s?y._selectedValues.isSelected(l,!0)?o.log("filter is currently ALREADY SELECTED, no action needed"):(o.log("filter is currently NOT SELECTED, adding it"),y._selectedValues.toggle(l,P)):"remove"===s?y._selectedValues.isSelected(l,!0)?(o.log("filter is currently SELECTED, removing it"),y._selectedValues.toggle(l,P)):o.log("filter is currently NOT SELECTED, no action needed"):y._selectedValues.toggle(l,P)}}this._navimpl.getCache().setCriteriaToResetBeforeFilterChange(this.id(),E),this.updateProxyView(v),!0===t.warn?this.onRefine():window.richClient?this.onRefine({isInternal:!0}):this.onRefine({triggerProxyCB:!1}),e.is(i,"function")&&i(),a()}.bind(this))}.bind(this))},manageDuplicates:function(e,t){var i={};return e.forEach(function(e){var t=e.disptext?e.disptext:e.object,a=i[t];a?(UWA.is(a.object),a.object=[a.object],a.isComposite=!0,a.object.push(e.object)):i[t]=e}),Object.keys(i).map(function(e){return i[e]})},addLocalFilter:function(e){return o.log("Inside TaggerProxy#addLocalFilter"),this.setLocalFilter(e,void 0,"add")},removeLocalFilter:function(e){return o.log("Inside TaggerProxy#removeLocalFilter"),this.setLocalFilter(e,void 0,"remove")},updateTenantInfo:function(e){},eachTagValue:function(e,t){var i,a,n,r,s,o,l;this._alivePreCond();var c=t&&UWA.is(t.allTagsInheritingFromType,"string"),d=t&&UWA.is(t.allTagsOfType,"array")&&t.allTagsOfType.length>0,g=this.getHiddenPredicates(),u=t&&t.excludeHiddenPredicates&&g.length>0,h=function(e){var i=!0;return c?e.pred.isAKindOf(t.allTagsInheritingFromType)||(i=!1):d&&-1===t.allTagsOfType.indexOf(e.pred.id())&&(i=!1),i&&u&&(i=g.indexOf(-1!==e.pred.id())),i};if(this.hasSubjectsInEdition()){for(n=0,s=this._subjectsInEdition.length;n<s;n++)if(a=this._subjectsInEdition[n],this._tagValuesIdxForSubject[a])for(r=0,o=(l=this._tagValuesIdxForSubject[a]).length;r<o;r++)i=l[r],t?this._tagValuesMap[i]&&h(this._tagValuesMap[i])?e.call(this,this._tagValuesMap[i],1):this._subjectsTagValuesMap[a]&&this._subjectsTagValuesMap[a][i]&&h(this._subjectsTagValuesMap[a][i])&&e.call(this,this._subjectsTagValuesMap[a][i],1):this._tagValuesMap[i]?e.call(this,this._tagValuesMap[i],1):this._subjectsTagValuesMap[a]&&this._subjectsTagValuesMap[a][i]&&e.call(this,this._subjectsTagValuesMap[a][i],1)}else Object.keys(this._tagValuesMap).forEach(function(i){var a;0!==this._nbSubjects[i]&&(t?(a=this._tagValuesMap[i],h(a)&&e.call(this,a,this._nbSubjects[i])):e.call(this,this._tagValuesMap[i],this._nbSubjects[i]))}.bind(this));return this},getEachTagValueForPredicate:function(e,t){var i,a=this._predicateTagValuesMap[e];if(UWA.is(a),!t)return a;a.forEach(function(e){(i=this._tagValuesMap[e])?t(i,this._nbSubjects[i]):o.error("TaggerProxy#getEachTagValueForPredicate: "+e+" not found in _tagValuesMap")}.bind(this))},getTagValuesForPredicate:function(e){return this._predicateTagValuesMap[e]},updateSelectedTVLocalFilter:function(e,t,i,a){var n,r;return r=this._selectedValues.isEmpty(),n=this._selectedValues.toggle(t,a),this.updateProxyView(r,null,i),n},updateFreeInputs:function(e,t){var i,a,n=this._selectedValues.isEmpty();for(a=0,t.length;a<t.length;a++)i=t[a],this._selectedValues.removeFreeInput(i.predicate.getFullPredicateID(!0),i.type,i.value,i.nls);for(this._navimpl.getCache().resetCriteriaToRemoveBeforeFilterChange(this.id()),a=0,e.length;a<e.length;a++)i=e[a],this._selectedValues.createFreeInput(i.predicate.getFullPredicateID(!0),i.type,i.value,i.nls);this.updateProxyView(n,null,!1),this.onSearch()},createFreeInputs:function(e,t){var i,a,n=this._selectedValues.isEmpty();for(a=0,e.length;a<e.length;a++)i=e[a],this._selectedValues.createFreeInput(i.predicate.getFullPredicateID(!0),i.type,i.value,i.nls);this.updateProxyView(n,null,!1),!1!==t&&this.onRefine()},removeFreeInputs:function(e,t){var i,a,n,r,s,o,l,c,d=!1,g=this._navimpl.getCache().getCriteriaToResetBeforeFilterChange(this.id()),u=this._selectedValues.isEmpty();for(a=0,e.length;a<e.length;a++)if(i=e[a],this._selectedValues.removeFreeInput(i.predicate.getFullPredicateID(!0),i.type,i.value,i.nls),n=i.predicate.getFullPredicateID().split("/").pop(),o=i.type,n&&g[n])if("boolean"===o)delete g[n];else if("string"===o){for(r=0,g[n].value.length;r<g[n].value.length;r++)if(g[n].value[r].value===i.value){d=!0;break}d&&(g[n].value.splice(r,1),0===g[n].value.length&&delete g[n]),-1!==(l=(c=i.predicate.getElemOptions())&&c.datasets&&c.datasets.items?c.datasets.items.map(function(e){return e.value}).indexOf(i.value):-1)&&!0===c.datasets.items[l].predefined&&delete c.datasets.items[l].predefined}else{for(s in i.value)g[n][s]&&delete g[n][s];1===Object.keys(g[n]).length&&delete g[n]}this.updateProxyView(u,null,!1),!1!==t&&this.onRefine()},hasLocalFilters:function(){var e=this.getFilters().localfilters;return this._selectedValues instanceof f?UWA.is(e.condition,"array")&&e.condition.length>0:0!==Object.keys(e).length},updateProxyView:function(e,t,i){var a=this._selectedValues.isEmpty(),n=this._navimpl.getFocusedProxy()===this;(a!==e||t)&&this.updateLocalFilterStatus({hasFilter:!a,isFocused:n});var r=this.hasLocalFilters();this._navimpl.getIconVisibleBool(this._widgetId)!==r&&(this._navimpl.setIconVisibleBool(this._widgetId,r),this._navimpl.dispatchEvent("UPDATE_ICON")),!1!==i&&this._navimpl.dispatchEvent("REDRAW_TAGS",{event:"focus"}),t&&(n?(this.showEmbeddedTaggerView(),o.log("showing the embedded view")):(o.log("hiding the embedded view"),this.hideEmbeddedTaggerView()))},getCriteriaIdsMap:function(){return this._criteriaIdsMap},hasCriteria:function(){return 0!==Object.keys(this._criteriaIdsMap).length},colorize:function(t){var i=this;if(this.colorizeSupport&&t){t=e.extend({coloredSubjects:{}},t);var a=function(e){try{var a=n.getTagValue(e)}catch(e){o.error("Error in colorize")}i.getSubjectsFromTag(a).forEach(function(i){t.coloredSubjects[i]=e.color})};t.tagColors.forEach(function(e){e&&e.isComposite?e.object.forEach(function(t){var i=UWA.clone(e);i.object=t,a(i)}):a(e)}),this.triggerCallbackOfEvent(w.colorize,t)}},unColorize:function(){this.colorizeSupport&&this.triggerCallbackOfEvent(w.unColorize)},setColorMap:function(e){this._navimpl.setColorMap(e)},triggerCallbackOfEvent:function(e,t){var i;return this._alivePreCond(),(i=this._listenerOf[e])&&i.cb?i.cb.call(i.scope||void 0,t):void 0},createTagValue:function(e,t,i,a){var s,l,c,d,g,u,h,p,f,m,v,T,C,b,y=0;if(this._alivePreCond(),!(t instanceof r&&"string"==typeof e))throw new Error("Invalid input arg");c={subjects:[],predicate:t.getFullPredicateID(),object:e},s={tag:[{subject:[],predicate:t.getFullPredicateID(),object:{literal:e}}]},l={tag:[{subject:[],predicate:t.getFullPredicateID(),object:{literal:e}}]};try{u=n.getTagValue(t,e,e)}catch(e){o.error("Error in createTagValue")}for(f=0,v=this._subjectsInEdition.length;f<v;f++)d=this._subjectsInEdition[f],-1===this._tagValuesIdxForSubject[d].indexOf(u.fullid)&&(this.createTagOn3DSpace(d)?l.tag[0].subject.push({uri:d}):s.tag[0].subject.push({uri:d}),c.subjects.push(d));for(this.addNbSubjectsForTagValue(u,0),this._tagsInCreation[u.fullid]=l.tag[0].subject.length+s.tag[0].subject.length,p=function(a){if(this._explicitValues[t.getFullPredicateID()+e]=a,this._tagsInCreation[u.fullid]=0,0===--y)return i(),this.triggerCallbackOfEvent(w.AddTag,c)}.bind(this),h=function(e){for(m=0,T=e.length;m<T;m++)d=e[m].uri,this.removeTagValueForSubject(d,u);if(0===--y)return i(),this.triggerCallbackOfEvent(w.AddTag,c)}.bind(this),C=l.tag[0].subject,b=s.tag[0].subject,m=0,T=C.length;m<T;m++)g=C[m].uri,this.addTagValueForSubject(g,u),u.incrementCount(1);for(m=0,T=b.length;m<T;m++)g=b[m].uri,this.addTagValueForSubject(g,u),u.incrementCount(1);if(y=0,!0===this._persistTags){if(b.length>0)for(y+=a.length,m=0,T=a.length;m<T;m++)this._tagsServers[a[m]].putTag(s,this._hasPlatformData,p,h);if(C.length>0)for(y+=a.length,m=0,T=a.length;m<T;m++)this._cStorages[a[m]].putTag(l,this._hasPlatformData,p,h)}else y=1,setTimeout(p,200);return i(u),this},onAddTagSuccess:function(e,t){for(var i,a,s,l=this,c=this.getEventData(e).subjects,d=this.getEventData(e).tags,g=0;g<d.length;g++)s={subjects:c,predicate:d[g].split("|")[0],object:d[g].split("|")[1]},this.triggerCallbackOfEvent(w.AddTag,s);for(var u in e){e[u].forEach(function(e){i=e.sixw;let s=a=e.object;-1!=a.indexOf(n.BELCHAR)&&(a=a.split(n.BELCHAR),s=void 0);var c=r.getPredicate(i);try{var d=n.getTagValue(c,s,a,c.getType(),!0)}catch(e){o.error("Error in createTagValue")}-1===l._tagValuesIdxForSubject[u].indexOf(d.fullid)&&l.addTagValueForSubject(u,d),l._explicitValues[c.getFullPredicateID()+a]=t})}this._navimpl.dispatchEvent("REDRAW_TAGS",{event:"addTag"})},getEventData:function(e){var t=[],i=[];for(var a in e){t.push(a),e[a].forEach(function(e){i.push(e.sixw+"|"+e.object)})}return{subjects:t,tags:i.filter(function(e,t,i){return i.indexOf(e)===t})}},createTagOn3DSpace:function(e){if(this._dataSources){let t=this._dataSources[e];return UWA.is(t,"string")?"3DSpace"==t:UWA.is(t,"object")?"3DSpace"==t.serviceToPersistTags:this._hasPlatformData}return this._hasPlatformData},deleteTagValue:function(e,t,i){var a,s,l,c,d,g,u,h,p,f,m,v=0;if(this._alivePreCond(),!(t instanceof r))throw new Error("Invalid input arg");l={subjects:[],predicate:t.id(),object:e},a={tag:[{subject:[],predicate:t.id(),object:{literal:Array.isArray(e)?e.join(n.BELCHAR):e}}]},s={tag:[{subject:[],predicate:t.id(),object:{literal:Array.isArray(e)?e.join(n.BELCHAR):e}}]};try{d=n.getTagValue(t,e,e)}catch(e){o.error("Error in deleteTagValue")}if(!this._tagValuesMap[d.fullid])return!1;for(h=0,f=this._subjectsInEdition.length;h<f;h++)c=this._subjectsInEdition[h],-1!==this._tagValuesIdxForSubject[c].indexOf(d.fullid)&&(this.createTagOn3DSpace(c)?s.tag[0].subject.push({uri:c}):a.tag[0].subject.push({uri:c}),l.subjects.push(c));if(g=function(a){if(this._explicitValues[t.getFullPredicateID()+e]&&delete this._explicitValues[t.getFullPredicateID()+e],0===--v){for(p=0,m=a.length;p<m;p++)c=a[p].uri,this.removeTagValueForSubject(c,d);i(),this.triggerCallbackOfEvent(w.RemoveTag,l)}}.bind(this),u=function(){0===--v&&i()}.bind(this),!0===this._persistTags){if(a.tag[0].subject.length>0)for(h in this._tagsServers)this._tagsServers[h].deleteTag(a,this._hasPlatformData,g,u),v+=1;if(s.tag[0].subject.length>0)for(h in this._cStorages)this._cStorages[h].deleteTag(s,this._hasPlatformData,g,u),v+=1}else a.tag[0].subject.length>0&&(v+=1,g(a.tag[0].subject)),s.tag[0].subject.length>0&&(v+=1,g(s.tag[0].subject));return this},addPLMUpdateListener:function(e,t){return this.addListener(w.PLMUpdate,e,t)},addRequestSuggestionsListener:function(e,t){return this.addListener(w.RequestSuggestions,e,t)},addFilterChangeListener:function(e,t){return this.addListener(w.FilterChange,e,t)},addCriteriaChangeListener:function(e,t){return this.addListener(w.CriteriaChange,e,t)},addTagCreationListener:function(e,t){return this.addListener(w.AddTag,e,t)},addTagDeletionListener:function(e,t){return this.addListener(w.RemoveTag,e,t)},addLocalFilterStatusListener:function(e,t){return this.addListener(w.UpdateLocalFilterStatus,e,t)},addInternalFilterChangeListener:function(e,t){return this.addListener(w.InternalFilterChange,e,t)},addUnfocusSubjectsListener:function(e,t){return this.addListener(w.UnfocusSubjects,e,t)},addColorizeListener:function(e,t){return this.addListener(w.colorize,e,t)},addOpenTaggerListener:function(e,t){return this.addListener(w.openTagger,e,t)},addCloseTaggerListener:function(e,t){return this.addListener(w.closeTagger,e,t)},addUpdateDisplayStatusListener:function(e,t){return this.addListener(w.updateDisplayStatus,e,t)},addUnColorizeListener:function(e,t){return this.addListener(w.unColorize,e,t)},addSortChangeListener:function(e,t){return this.addListener(w.SortChange,e,t)},addGroupingChangeListener:function(e,t){return this.addListener(w.GroupingChange,e,t)},addSelectInAppListener:function(e,t){return this.addListener(w.SelectInApp,e,t)},addLoadMoreTagsListener:function(e,t){return this.addListener(w.LoadMoreTags,e,t)},isPLMParameterEnabled:function(){return this.enablePLM},sendStringTypedForPLM:function(e){var t=this.getFilters();return t.PLMTitle=e,this.triggerCallbackOfEvent(w.PLMUpdate,t)},getParameters:function(){return this.parameters}});return w.FilterChange=1,w.AddTag=2,w.RemoveTag=3,w.CriteriaChange=4,w.UpdateLocalFilterStatus=5,w.colorize=7,w.unColorize=8,w.PLMUpdate=9,w.openTagger=10,w.closeTagger=11,w.RequestSuggestions=12,w.SortChange=14,w.GroupingChange=15,w.SelectInApp=16,w.LoadMoreTags=17,w.updateDisplayStatus=21,w.InternalFilterChange=100,w}),define("DS/TagNavigator/TaggerProxyWithFilteringServices",["DS/TagNavigator/TaggerProxy","DS/TagNavigator/TaggerSettings","UWA/Class/Promise","DS/TagNavigator/Logger","UWA/Core"],function(e,t,i,a,n){"use strict";var r={},s=[];function o(t){var i,a,o,l,c,d,g,u,h,p,f,m,v,T,C,w,b,y,S,E,I,x,_=this;if(!(t instanceof e))throw new Error("Invalid input arg");x=t,h={},g={},d=[],I={},p={},f={},m={},v={},u=function(e,t){var i,a,n,r;return I[n=e.sixw]||(I[n]={}),I[e.sixw][typeof e.object]||(I[e.sixw][typeof e.object]={}),(a=I[e.sixw][typeof e.object])[r=e.object]||(a[r]={}),"string"!==(i=e.type)&&"integer"!==i&&"date"!==i&&"tree"!==i&&(i="string"),I[e.sixw][typeof e.object][r][t]={field:e.field,dispValue:e.dispValue,type:i,uri:e.object},this},E=function(e,t){return delete I[e.sixw][typeof e.object][e.object][t],this},this.getTaggerProxy=function(){return x},this.id=function(){return x.id()},this.widgetId=function(){return x.widgetId()},this.supportsAdvancedFilter=function(){return x.supportsAdvancedFilter()},this.hasLocalFilters=function(){return x.hasLocalFilters()},this.addFilterSubjectsListener=function(e,t){h={cb:e,scope:t}},this.addTagCreationListener=function(e,t){p={cb:e,scope:t}},this.addTagDeletionListener=function(e,t){f={cb:e,scope:t}},this.addLocalFilterStatusListener=function(e,t){m={cb:e,scope:t}},this.addUnfocusSubjectsListener=function(e,t){v={cb:e,scope:t}},this.addColorizeListener=function(e,t){T={cb:e,scope:t}},this.addUnColorizeListener=function(e,t){C={cb:e,scope:t}},this.addGroupingChangeListener=function(e,t){w={cb:e,scope:t}},this.setColorMap=function(e){x.setColorMap(e)},this.setSubjectsTags=function(e,t){return x.hasPlatformData()||!1===t||b(e),S(e)},this.addSubjectsTags=function(e,t){return x.hasPlatformData()||!1===t||b(e),y(e)},y=function(e){for(var t in e)g[t]=g[t]||[],g[t]=g[t].concat(e[t]);return S(n.clone(g)),this},S=function(e){var t,i,n,r,s,o,l;for(n in _.unloadAllTags(),t=x.getFilters(),(i=0===Object.keys(t.allfilters).length)&&x.setTags(e),g=e,e)for(s=e[n],d.push(n),o=0,l=s.length;o<l;o++)r=s[o],u(r,n);return i||a(t),this},this.die=function(){return this.unloadAllTags(),x.die(!0),this},this.isAlive=function(){return x.isAlive()},this.isActive=function(){return x.isActive()},this.getNavImpl=function(){return x.getNavImpl()},this.focusOnSubjects=function(e,t,i){return"boolean"!=typeof t&&(t=!0),x.focusOnSubjects(e,t,i),this},this.getAllowedRootWForTagging=function(){return x.getAllowedRootWForTagging()},this.unfocus=function(){return x.unfocus(),this},this.activate=function(){x.activate()},this.deactivate=function(){x.deactivate()},this.activate=function(){x.activate()},this.toggleProxyFocus=function(e){x.toggleProxyFocus(e)},this.clearLocalFilter=function(e){x.clearLocalFilter(e)},this.setLocalFilter=function(e){x.setLocalFilter(e,function(){x.getNavImpl().dispatchEvent("UPDATE_ACTIVECRITERIA")})},this.updateLocalFilterStatus=function(e){x.updateLocalFilterStatus(e)},this.updateTaggerDisplayStatus=function(e){x.updateTaggerDisplayStatus(e)},this.unloadAllTags=function(){return x.unloadAllTags(),g={},d=[],I={},this},this.unsetTags=function(){this.unloadAllTags(),x.unsetTags()},this.notifyListenerOfFilterSubjects=function(e){return h&&h.cb&&h.cb.call(h?h.scope:void 0,{filteredSubjectList:e,hasFiltersTEMP:0!==Object.keys(x.getNavImpl().getFilters().allfilters).length}),this},this.getFilters=function(){return x.getFilters()},this.hasCriteria=function(){return x.hasCriteria()},b=function(e){var t,i=[];if(!x.hasPlatformData()){for(t in e)i.push({uri:t});0!==i.length&&(r[_.id()]={proxy:x,subjects:i,proxyWF:_}),s=s.concat(i)}},i=function(e){var t,i,a,n,r,s;for(i={sixw:e.predicate,object:e.object},a=0,n=(r=e.subjects).length;a<n;a++)t=r[a],g[t].push(i),u(i,t);return p&&(s=p.cb)&&s.call(p?p.scope:void 0,e),_},o=function(e){var t,i,a,n,r,s;for(i={sixw:e.predicate,object:e.object},r=0,s=(a=e.subjects).length;r<s;r++)t=a[r],n=g[t].indexOf(i),g[t].splice(n,1),E(i,t);return f&&(a=f.cb)&&a.call(f?f.scope:void 0,e),_},l=function(e){var t;return m&&(t=m.cb)&&t.call(m?m.scope:void 0,e),_},c=function(e){var t;return v&&(t=v.cb)&&t.call(v?v.scope:void 0,e),_};return a=function(e){var t,i,a,r,s,o,l,c,u,h,p,f,m,v,T,C,w,b,y,S,E,A,N,V,P,D,O,U,F,j,W;for(s in t=e.allfilters,a=[],u=0,m={},p={},l={},t){for(h=t[s],l[s]||(l[s]={}),N=0,D=h.length;N<D;N++)if(b=(C=h[N]).object,I[s]){if("date"===C.type||"tree"===C.type||Array.isArray(b))for(A in F=I[s][typeof b])S=F[A],W=C.object.toString(),A.substring(0,W.length)===W&&n.extend(m,S);else m=I[s][typeof C.object][b]||{};for(f in m)l[s][f]=1,p[f]||(p[f]=0),p[f]+=1;m={}}u++}if(0===u)a=d;else for(f in p)p[f]>=u&&a.push(f);for(c={},r={},V=0,O=a.length;V<O;V++)for(f=a[V],y=g[f],r[f]=y,P=0,U=y.length;P<U;P++)o=(C=y[P]).sixw+C.field+C.object+typeof C.object,"string"!==(E=C.type)&&"integer"!==E&&"date"!==E&&"tree"!==E&&(E="string"),c[o]||(c[o]={object:C.object,sixw:C.sixw,field:C.field,dispValue:C.dispValue,count:0,type:E}),c[o].count+=1;for(s in j=function(e){return e.object===A},t)if("date"!==(h=t[s])[0].type)for(E in I[s])for(A in I[s][E])if(m=I[s][E][A],!h.detect(j))for(f in m)-1===a.indexOf(f)&&!Object.keys(t).some(function(e){return e!==s&&!l[e][f]})&&(w=m[f].uri,i=m[f].field,c[o=s+i+w]||(c[o]={object:w,sixw:s,field:i,dispValue:m[f].dispValue,count:0,type:m[f].type}),c[o].count+=1,r[f]||(r[f]=[]),r[f].push(c[o]));for(o in v=[],c)T=c[o],v.push(T);return _.notifyListenerOfFilterSubjects(a),x.setTags(r,v),!1},x.addListener(e.FilterChange,a,this),x.addListener(e.AddTag,i,this),x.addListener(e.RemoveTag,o,this),x.addListener(e.UpdateLocalFilterStatus,l,this),x.addListener(e.UnfocusSubjects,c,this),x.addListener(e.colorize,function(e){T&&T.cb&&T.cb.call(T.scope,e)},this),x.addListener(e.unColorize,function(){C&&C.cb&&C.cb.call(C.scope)},this),x.addListener(e.GroupingChange,function(){w&&w.cb&&w.cb.call(w.scope)},this),this}return o.getSubjectsForExplicitTags=function(){return s},o.clearProxiesTemp=function(){s=[],r={}},o.getExplicitTags=function(){if(!0===t.getOption("offline6W"))return a.warn("TaggerProxyWithFilteringServices: No explicit tags to be fetched."),[];var e,n,o,l,c,d=[];if(Object.keys(r).length)for(e in n=r[Object.keys(r)[0]].proxy.getTagsServers(),o={tag:[{subject:s}]},l=function(e,t,i){if(e){var a,n,s,o,l,c,d,g,u,h,p,f,m,v,T={},C={};if((e=JSON.parse(e)).data.length){for(a=0,o=e.data.length;a<o;a++)for(n=0,l=e.data[a].tag.length;n<l;n++){for(C[c=e.data[a].subject.uri]=C[c]||[],d=e.data[a].tag[n].object.literal,g=e.data[a].tag[n].predicate,u=!0,s=0;s<C[c].length;s++)T=C[c][s],u=!!u&&(T.object!==d||T.sixw!==g);u&&C[c].push({object:d,sixw:g,dispValue:d})}for(h in r){for(p=r[h].subjects,f={},n=0;n<p.length;n++)if(C[p[n].uri])for(f[p[n].uri]=C[p[n].uri],a=0;a<C[p[n].uri].length;a++)v=C[p[n].uri][a].sixw,m=C[p[n].uri][a].object,r[h].proxyWF.getTaggerProxy()._explicitValues[v+m]=t;Object.keys(f).length&&r[h].proxyWF.addSubjectsTags(f,!1)}}}i("ExplicitTags OK")},n)c=new i(function(t){n[e].getExplicitTag(o,l,t)}),d.push(c);return d},o}),define("DS/TagNavigator/simplified/actions/Exclude",["UWA/Core","DS/TagNavigator/Logger","DS/TagNavigator/simplified/actions/AbstractAction","DS/TagNavigator/simplified/utils/PersonUtils"],function(e,t,i,a){"use strict";return i.extend({setup:function(){this._parent(),this.set({actionClass:"excluded"}),this._selection=this.get("selection")},onPredicateSelection:function(e){t.log("No action on predicate selection during EXCLUDE")},onTagSelection:function(e){var t=this.get("selectionCount"),i=e.hasClassName("selected");e.hasClassName(this.get("actionClass"))||i?(e.removeClassName(this.get("actionClass")),i?(e.removeClassName("selected"),this.addTagToExclude(e.id),t++):(this.removeTagToExclude(e.id),t--)):(e.addClassName(this.get("actionClass")),this.addTagToExclude(e.id),t++),this.get("isInteractive")&&this.set("selectionCount",t)},onPersonSelection:function(e){var t=e.view,i=e.refineData,n=this.get("actionClass");if(e.isComplex)if(e.hasOwnProperty("selectedPredicates")){var r=this._selection.findIndex(function(i){if(UWA.is(i,"object")&&e.isComplex&&i.isComplex&&i.id==a.PERSON_REFINE_PREDICATE)return i.condition.object===t.model.get("title")});if(-1!==r&&this._selection.splice(r,1),e.selectedPredicates.length>0)var s=a.buildCondition(t.model,e.selectedPredicates,!0);else s=a.buildCondition(t.model,e.selectedPredicates,!0);this.addTagToExclude(s,!0)}else t.isSelectedForAction(n)?(t.setAsUnselectedForAction(n),this.removeTagToExclude(i,!0)):(t.setAsSelectedForAction(n),this.addTagToExclude(i,!0));else t.isSelectedForAction(n)?(t.setAsUnselectedForAction(n),this.removeTagToExclude(i,!0)):(t.setAsSelectedForAction(n),this.addTagToExclude(i,!0))},onCriteriaSelection:function(e){var t=e.view,i=t.model,a=this.get("actionClass");if(e.isComplex);else if(e.isContainer){if(t.isSelectedForAction(a)){if(t.setAsUnselectedForAction(a),-1===(r=CriteriaUtils.getSelectionIndex(this._selection,i.getRefineStructure(!0)[0])))throw new Error("the tag is not already selected");this._selection.splice(r,1),t.setAsUnselectedForAction(a),t.setAsContainer()}else if(i.get("selected"))this._selection.push(i.getRefineStructure(!0)[0]),t.setAsUnselectedForAction(a);else{var n=[];i.getSelectedSubCategories(n),n.forEach(function(e){var t=e.getRefineStructure(!0)[0],i=CriteriaUtils.getSelectionIndex(this._selection,t);-1!==i?this._selection.splice(i,1):(t.doNotCount=!0,this._selection.push(t))}.bind(this)),n=[],t.getSelectedSubCategoriesForAction(a,n),n.forEach(function(e){var t=e.model.getRefineStructure(!0)[0],i=CriteriaUtils.getSelectionIndex(this._selection,t);-1!==i&&this._selection.splice(i,1)}.bind(this)),this._selection.push(i.getRefineStructure(!0)[0]),t.setAsSelectedForAction(a),t.setAsLeaf()}this.set("selectionCount",this.getSelectionCount())}else{if(t.isSelectedForAction(a)){var r;if(t.setAsUnselectedForAction(a),-1===(r=CriteriaUtils.getSelectionIndex(this._selection,i.getRefineStructure(!0)[0])))throw new Error("the tag is not already selected");this._selection.splice(r,1),t.setAsUnselectedForAction(a)}else this._selection.push(i.getRefineStructure(!0)[0]),t.setAsSelectedForAction(a);this.set("selectionCount",this.getSelectionCount())}},removeTagToExclude:function(e,i){var a=this._selection.findIndex(function(t){if(UWA.is(t,"object")){if(UWA.is(e,"object"))return t.object===e.object&&t.predicate===e.predicate}else if(UWA.is(e,"string"))return t===e});-1!==a?(t.log("Removing the tag from exclude selection"),this._selection.splice(a,1),i&&this.get("isInteractive")&&this.set("selectionCount",this._selection.length)):t.error("FAILED to remove the tag from exclude selection")},addTagToExclude:function(e,t){this._selection.push(e),t&&this.get("isInteractive")&&this.set("selectionCount",this._selection.length)}})}),define("DS/TagNavigator/embeddedTagger/EmbeddedRootWhyView",["UWA/Core","DS/TagNavigator/embeddedTagger/EmbeddedRootWView","DS/TagNavigator/TaggerNLS","DS/TagNavigator/Logger","DS/TagNavigator/TaggerSettings"],function(e,t,i,a,n){"use strict";return t.extend({tagName:"div",className:"embedded-root-container embedded-why",init:function(e){this._parent(e)},render:function(){return this._parent()}})}),define("DS/TagNavigator/simplified/actions/EditTagsSelect",["UWA/Core","DS/TagNavigator/simplified/actions/Select","DS/TagNavigator/TagValue"],function(e,t,i){"use strict";return t.extend({setup:function(){this._parent(),this._selection=this.get("selection")},onTagSelection:function(e){this._parent(e)},onCriteriaSelection:function(e){var t,a=this._parent(e);a.isComplex?this.getTaggerView().updateActiveTagView(a):a.isComposite?(t=this.getTaggerView().getObservedNavigator()._getCompositeTagValue(a),this.getTaggerView().updateActiveTagView(t)):(t=i.getTagValue(a.predicate,a.dispValue,a.object,a.type),this.getTaggerView().updateActiveTagView(t))},onPersonSelection:function(e){var t=this._parent(e);this.get("isInteractive")&&this.set("selectionCount",1),this.getTaggerView().updateActiveTagView(t)},onDateSelection:function(e){this._parent(e),this.getTaggerView().updateActiveTagView(e.freeInputData)}})}),define("DS/TagNavigator/simplified/views/RoundRootView",["UWA/Core","UWA/Class/View","DS/TagNavigator/TaggerNLS","DS/MessageBus/MessageBus"],function(e,t,i,a){"use strict";return t.extend({tagName:"div",className:"root-w-nav",domEvents:{click:"clickRootW"},init:function(e){this._parent(e)},setup:function(e){this._parent(e)},render:function(){this.container.setContent('<div class="root-icon-div"><span class="fonticon root-icon"></span></div><div class="root-w-text"><div class="dropnbtn w-label"></div></div>'),this.taggerView=this.getOption("taggerView"),this.rootw=this.getOption("rootw");var e=this.rootw.split(":")[1]?this.rootw.split(":")[1]:this.rootw;"allw"==e?(this.container.getElement(".root-icon").addClassName("fonticon-tag"),this.container.addClassName("all-w")):this.container.getElement(".root-icon").addClassName("fonticon-3ds-"+e);this.taggerView.getActiveRootW();return this.container.setAttribute("predicate",this.rootw),this.container.getElement(".w-label").setText(i.getText(e)),this},clickRootW:function(e){var t=this.container.getAttribute("predicate"),i=!1;this.container.hasClassName("active")?(this.container.removeClassName("active"),this.taggerView._simplifiedSelectedRootWs=this.taggerView._simplifiedSelectedRootWs.filter(function(e){return e!=t}),i=!1):(this.container.addClassName("active"),i=!0,"allw"!=t&&(this.taggerView._simplifiedSelectedRootWs.length==this.taggerView.getRootWs().length&&(this.taggerView._simplifiedSelectedRootWs=[]),this.taggerView._simplifiedSelectedRootWs.push(t))),this.dispatchEvent("onRootWClick",{activeW:t,isActive:i}),a.publish({channel:"TaggerTrackerApi",topic:"hit",data:{category:"6WTagger",action:"RootWFilter",persDim:{pd1:t,pd2:""+i}}})},destroy:function(){this.stopListening(),this.model=null,this._parent()}})}),define("DS/TagNavigator/simplified/actions/SelectInApp",["UWA/Core","DS/TagNavigator/Logger","DS/TagNavigator/simplified/actions/Select"],function(e,t,i){"use strict";return i.extend({setup:function(){this._parent(),this._selectedElems=[]},onTagSelection:function(e){this._selectedElems.push(e),this._parent(e)},onPersonSelection:function(e){this._selectedElems.push({elem:e.view,isPerson:!0}),this._parent(e)},removeTagHighlight:function(){this._selectedElems.forEach(function(e){e.isPerson?(e.elem.setAsUnselected(),e.elem.container.removeClassName("picked")):e.removeClassName("picked")}),this._selectedElems=[]}})}),define("DS/TagNavigator/embeddedTagger/EmbeddedRootHowView",["UWA/Core","DS/TagNavigator/embeddedTagger/EmbeddedRootWView","DS/TagNavigator/TaggerNLS","DS/TagNavigator/Logger","DS/TagNavigator/TaggerSettings"],function(e,t,i,a,n){"use strict";return t.extend({tagName:"div",className:"embedded-root-container embedded-how",init:function(e){this._parent(e)},render:function(){return this._parent()}})}),define("DS/TagNavigator/embeddedTagger/EmbeddedAllWView",["UWA/Core","UWA/Class/Model","UWA/Class/Collection","DS/WebappsUtils/WebappsUtils","DS/TagNavigator/embeddedTagger/EmbeddedRootWView","DS/TagNavigator/TaggerNLS","DS/TagNavigator/Logger","DS/TagNavigator/TaggerSettings"],function(e,t,i,a,n,r,s,o){"use strict";return n.extend({tagName:"div",className:"embedded-root-container embedded-all",init:function(e){this._parent(e)},setup:function(e){this._parent(e)},render:function(){return this.label=this.defaultValues.label?this.defaultValues.label:"All",this.subLabel=this.defaultValues.subLabel?this.defaultValues.subLabel:"",this.icon="fonticon-list ",this._parent()},getActionOnClick:function(){return null},redrawTags:function(e){this.container.removeClassName("disableW"),this.proxy.hasActiveGroupings()?this.deactivateGroupingUX():this.activateGroupingUX(),this.subLabel&&this.buttonContainer.getElement(".button-text").removeClassName("hide-sub-label")},clearRefine:function(){this.navImpl.clearFilters();this._parent(!1,!1)}})}),define("DS/TagNavigator/embeddedTagger/EmbeddedWhatMenuItem",["UWA/Core","UWA/Utils","DS/TagNavigator/TaggerNLS","DS/TagNavigator/embeddedTagger/EmbeddedMenuItem","DS/TagNavigator/TaggerSettings","DS/TagNavigator/simplified/utils/CriteriaUtils"],function(e,t,i,a,n,r){"use strict";var s=a.extend({init:function(e){this._parent(e)},setup:function(e){this.isPreciseCount=e.isPreciseCount,this._parent(e)},render:function(e){return this._parent(e),this},addContent:function(e){var a=this;if(this.container.getElement(".tag-icon").addClassName("tn-"+this.model.get("level")),this.container.getElement(".tag-icon").addClassName("tn-"+this.model.get("rootIconClass")),this.model.get("imageURL")?(this.container.getElement(".tag-icon").setStyle("display","none"),this.container.getElement(".tag-image").setAttributes({src:this.model.get("imageURL")}),this.container.getElement(".tag-image").setStyles({"border-radius":"0"}),this.container.getElement(".image-div").setStyle("display","inline-block"),this.container.getElement(".image-div").addClassName("tn-"+this.model.get("level"))):this.container.getElement(".tag-icon").addClassName(this.model.get("iconClass")),this.getOption("rootClassId")){var n=this.getOption("rootClassId");this.getElement(".tag-icon").addClassName("tn-"+n),this.getElement(".image-div").addClassName("tn-"+n)}this.container.getElement(".tag-label").setText(this.model.get("title"));var o=!!this.navImpl.getFocusedProxy()&&this.navImpl.getFocusedProxy().getLocalFilter().isSelected(r.buildCondition(this.model));o&&this.container.addClassName("selected"),this.setOption("identifier",t.getUUID().substr(0,6));var l=a.getOption("eventsToListen");if(UWA.is(l,"object"))for(event in l)this.addEvent(event,l[event]);if(e){let t=function(e,i){e.forEach((e,a)=>{e.getOption("subMenuItems")?(t(e.getOption("subMenuItems"),i),e.render(i)):e.render(i)})},i=this.getOption("subMenuItems");i&&t(i,e)}else if(this.model.isContainer()){var c=[],d=r.removeDuplicates(this.model.get("subCategories")),g=d.sortBy("title");if(this.model.set("count",d.length),this.model.set("subCategories",d),o)this.model.set("excludeFromSearch",!0);else g.forEach(function(e){e=new s({model:e,navImpl:a.navImpl,rootClassId:a.getOption("rootClassId"),isPreciseCount:a.isPreciseCount,eventsToListen:a.getOption("eventsToListen")}).render();c.push(e)}),c.sort(function(e,t){return t.model.get("count")-e.model.get("count")||e.model.get("title").localeCompare(t.model.get("title"))}),this.setOption("subMenuItems",c)}this.container.getElement(".tag-count").setText(i.convertToUnity(this.model.getCount(),this.isPreciseCount))},destroy:function(){this.stopListening(),this.model=null,this._parent()}});return s}),define("DS/TagNavigator/simplified/views/DateCalendarView",["UWA/Core","UWA/Class/View","DS/TagNavigator/TaggerNLS","DS/UIKIT/Tooltip","DS/TagNavigator/Logger","DS/UIKIT/DatePicker","DS/TagNavigator/Predicate","DS/Controls/LineEditor","DS/TagNavigator/simplified/actions/ActionUtils","DS/TagNavigator/ActiveTagView","DS/TagNavigator/TaggerSettings"],function(e,t,i,a,n,r,s,o,l,c,d){"use strict";return t.extend({tagName:"div",className:"tn-calendar-div",domEvents:{"click .multi-select .tag-del":"removeFromSelection"},datePicker:void 0,fromDate:void 0,toDate:void 0,init:function(e){this._parent(e)},setup:function(e){this._parent(e)},render:function(){this.taggerView=this.getOption("taggerView"),this.inputTextDiv=e.createElement("div",{class:"fromToInput"}).inject(this.container);var t=e.createElement("div",{id:"from-input-container",class:"input-container"}).inject(this.inputTextDiv);e.createElement("label",{text:i.getText("from")+":",id:"from-label"}).inject(t);this.fromInput=new o({placeholder:i.getText("dateFormat"),touchMode:!0,sizeInCharNumber:10}).inject(t),this.fromInput.domId="from-input",this.fromInput.getContent().addClassName("calendar-input"),this.fromInput.addEventListener("focus",this.handleFromFocusEvent.bind(this)),this.fromInput.addEventListener("change",this.fromClearEvent.bind(this));var a=e.createElement("div",{id:"to-input-container",class:"input-container"}).inject(this.inputTextDiv);e.createElement("label",{text:i.getText("to")+":",id:"to-label"}).inject(a);return this.toInput=new o({placeholder:i.getText("dateFormat"),touchMode:!0,sizeInCharNumber:10,disabled:!0}).inject(a),this.toInput.domId="to-input",this.toInput.getContent().addClassName("calendar-input"),this.toInput.addEventListener("focus",this.handleToFocusEvent.bind(this)),d.showDateTiles()&&(this.multiSelectDiv=e.createElement("ul",{class:"multi-select"}).inject(this.container)),this.renderDateEvents(),this.activePredicate=this.getOption("predicateId"),this},getFromToDiv:function(){this.inputTextDiv.setStyle("margin-right","38px")},renderDateEvents:function(){var e=this,t={onSelect:function(t){var i=e.setFromToDate(this.getDate());if(e.setInputFieldsValue(e.fromDate,e.toDate),i){var a={};e.fromDate&&e.toDate?(a.fromDate=e._getFormattedDate(e.fromDate,!0),a.toDate=e._getFormattedDate(e.toDate,!0),a.nls=a.fromDate==a.toDate?e._getFormattedDate(e.fromDate):e._getFormattedDate(e.fromDate)+" - "+e._getFormattedDate(e.toDate)):(a.fromDate=e._getFormattedDate(e.fromDate,!0),a.nls=e._getFormattedDate(e.fromDate),e.container.getElement(".datepicker-calendar .datepicker-table").addEventListener("mouseover",e.hoverRangeSelection.bind(e))),e.launchRefine(a,!0)}},onDraw:function(){e.fromDate&&(e.hoverRangeSelection(),e.container.getElement(".datepicker-calendar .datepicker-table").addEventListener("mouseover",e.hoverRangeSelection.bind(e)),e.container.getElement(".datepicker-calendar .datepicker-table").addEventListener("mouseout",e.removeRangeSelection.bind(e)))}};this.datePicker=new r({showWeekNumber:!0,events:{onSelect:t.onSelect,onDraw:t.onDraw}}).inject(this.container),this.datePicker.hide()},handleFromFocusEvent:function(e){this.datePicker.isVisible()||this.datePicker.show()},handleToFocusEvent:function(e){this.datePicker.isVisible()||this.datePicker.show()},fromClearEvent:function(e){this.fromInput.value||(this.fromDate="",this.datePicker.setDate(null),this.toInput.disabled=!0)},setInputFieldsValue:function(e,t){e&&(this.fromInput.value=this._getFormattedDate(e),t||(this.fromInput.elements.container.removeAttribute("focused"),this.toInput.disabled=!1,this.toInput.elements.container.setAttributes({focused:!0}))),t&&(this.toInput.value=this._getFormattedDate(t)),e||t||(this.fromInput.value="",this.toInput.value="")},getDatePicker:function(){return this.datePicker},removeFromSelection:function(e){var t=this.taggerView.actionManager.getCurrentAction(),i=e.target.getClosest("li.tag"),a={from:i.getAttribute("from"),to:i.getAttribute("to")};t.removeDate(a),i.remove()},launchRefine:function(e,t){var i=this.getOption("taggerView"),a=i.getObservedNavigator();if(UWA.is(e,"object")){if(e.fromDate&&e.toDate){var n=[{predicate:s.getPredicate(this.activePredicate),value:{from:e.fromDate,to:e.toDate,nls:e.nls,isSimplifiedCriteria:!0},type:"date"}],r=this.taggerView.actionManager.getCurrentAction();if(!r||r.id!==l.ACTION_SELECT&&r.id!==l.ACTION_EDITTAGREL)t?a.createFreeInputs(n):a.removeFreeInputs(n),i.setActiveCriteria(!0,!0),i.setSpinner();else if(r.onDateSelection({freeInputData:{predicate:s.getPredicate(this.activePredicate),value:{from:e.fromDate,to:e.toDate,nls:e.nls,isSimplifiedCriteria:!0},type:"date",isFreeInput:!0}}),this.clearDates(),this.setInputFieldsValue(),this.fromInput.elements.container.setAttributes({focused:!0}),this.toInput.elements.container.removeAttribute("focused"),d.showDateTiles())new c({isSimplified:!0,text:e.nls,attribute:[{from:e.fromDate,to:e.toDate}]}).render().container.inject(this.multiSelectDiv)}else{var o={predicate:s.getPredicate(this.activePredicate).getFullPredicateID(),object:e.fromDate?e.fromDate:e.toDate,dispValue:e.nls,type:"date"};a.toggleTagSelection(JSON.stringify(o),void 0,!0),i.setSpinner()}this.fromDate=this.toDate=null}},redraw:function(){this.fromDate=this.toDate=this.hoveredDate=null,this.datePicker.hide(),this.clearDates(),this.setInputFieldsValue(),this.fromInput.elements.container.removeAttribute("focused"),this.toInput.elements.container.removeAttribute("focused")},_getFormattedDate:function(e,t){if(e)return t?e.getFullYear()+"/"+("0"+(e.getMonth()+1)).slice(-2)+"/"+("0"+e.getDate()).slice(-2):("0"+e.getDate()).slice(-2)+"/"+("0"+(e.getMonth()+1)).slice(-2)+"/"+e.getFullYear()},setFromToDate:function(e){var t=this.taggerView.hasFocusedProxy();return t&&(t.hasFreeInputSupport(this.activePredicate)||t.hasFreeInputOnly(this.activePredicate))?this.fromDate?(this.checkTheDates(this.fromDate,e)?(this.toDate=this.fromDate,this.fromDate=e):this.toDate=e,!0):(this.fromDate=e,!1):(this.fromDate=e,!0)},checkTheDates:function(e,t){return e.getTime()>t.getTime()},clearDates:function(e){this.datePicker&&this.datePicker.setDate(null)},setActivePredicate:function(e){this.activePredicate=e},onPredicateChange:function(e){this.setActivePredicate(e),this.fromDate=this.toDate=this.hoveredDate=null},hoverRangeSelection:function(e){if(!e||"BUTTON"==e.target.nodeName){var t=this;if(!this.toDate){if(this.hoveredDate=e?e.target.dataset.year+"-"+("0"+(parseInt(e.target.dataset.month)+1)).slice(-2)+"-"+e.target.dataset.day:this.hoveredDate,this.fromDate){var i=this.fromDate.getFullYear()+"-"+("0"+(this.fromDate.getMonth()+1)).slice(-2)+"-"+this.fromDate.getDate(),a=function(e,i){var a,n,r,s=new Array,o={0:31,1:28,2:31,3:30,4:31,5:30,6:31,7:31,8:30,9:31,10:30,11:31};if(i){var l=t.container.getElement(".datepicker-calendar .datepicker-title select.datepicker-select-month").value,c=t.container.getElement(".datepicker-calendar .datepicker-title select.datepicker-select-year").value;if(r=parseInt(c)!=i.getFullYear()?c:i.getFullYear(),!(parseInt(r)%4&&parseInt(r)%100)&&parseInt(r)%400&&(o[1]=29),e<i)for(e.getMonth()==parseInt(l)?(a=new Date(e),n=e.getMonth()==i.getMonth()?new Date(i):new Date(r+"-"+("0"+(parseInt(l)+1)).slice(-2)+"-"+o[l])):parseInt(l)==i.getMonth()&&(a=new Date(r+"-"+("0"+(parseInt(l)+1)).slice(-2)+"-01"),n=new Date(i));a<=n;)s.push(new Date(a).getDate()),a.setDate(a.getDate()+1);else if(e>i)for(e.getMonth()==parseInt(l)?(a=new Date(e),n=e.getMonth()==i.getMonth()?new Date(i):new Date(r+"-"+("0"+(parseInt(l)+1)).slice(-2)+"-01")):parseInt(l)==i.getMonth()&&(a=new Date(r+"-"+("0"+(parseInt(l)+1)).slice(-2)+"-"+o[l]),n=new Date(i));a>=n;)s.push(new Date(a).getDate()),a.setDate(a.getDate()-1)}return s}(new Date(i),t.hoveredDate?new Date(t.hoveredDate):null);a&&this.container.getElements(".datepicker-calendar tbody td").forEach(function(e,t){e.hasClassName("is-empty")||e.hasClassName("datepicker-week")||(a.includes(parseInt(e.innerText))&&!e.hasClassName("is-selected")?e.addClassName("in-range"):e.removeClassName("in-range"))})}this.hoveredDate&&(this.toInput.value=this._getFormattedDate(new Date(t.hoveredDate)))}}},removeRangeSelection:function(e){this.container.getElements(".datepicker-calendar tbody td").forEach(function(e,t){e.hasClassName("in-range")&&e.removeClassName("in-range")})},destroy:function(){this.stopListening(),this.datePicker.destroy(),this.fromInput.destroy(),this.toInput.destroy(),this._parent()}})}),define("DS/TagNavigator/simplified/views/RootWhenView",["UWA/Core","DS/Handlebars/Handlebars","DS/TagNavigator/simplified/views/RootWView","text!DS/TagNavigator/assets/templates/RootWhenViewTemplate.html","DS/TagNavigator/Predicate","DS/UIKIT/Input/Select","DS/TagNavigator/Logger","DS/TagNavigator/simplified/views/DateCalendarView"],function(e,t,i,a,n,r,s,o){"use strict";var l=i.extend({tagName:"div",className:"root-container-inner root-when-container",template:t.compile(a),domEvents:{},predicateSelector:void 0,init:function(e){this._rootW="ds6w:when",this._parent(e)},setup:function(e){this._parent(e)},render:function(){var t=this;return this._calendarContentDiv=e.createElement("div",{id:"calendar-content-div"}).inject(this.container),this.predicateSelector=new r({className:"predicate-selector",placeholder:!1,disabled:!0,showTooltips:!0,renderTo:t.getTaggerView().simplifiedTaggerRoot,events:{onChange:function(e){t.activePredicate=this.getValue()[0],t.dateView.onPredicateChange(t.activePredicate)}}}).inject(e.createElement("div",{id:"predicate-selector-div"}).inject(this._calendarContentDiv)),this.dateView=new o({taggerView:this.getTaggerView(),predicateId:this.activePredicate}).render().inject(this._calendarContentDiv),this._defaultContentDiv=e.createElement("div",{id:"default-content-div"}).inject(this.container),this._defaultContentDiv.hide(),this._calendarContentDiv.hide(),this._parent()},onPostInject:function(){if(this.predicateSelector){var e=this.dateView.getDatePicker().getContent().getStyle("z-index");e&&(e=parseInt(e),s.log("datePickerZIndex="+e),this.predicateSelector.getContent().setStyle("z-index",e+1)),this.dateView.getFromToDiv()}},redraw:function(e){var t=e&&e.onSearch,i=this.getTaggerView();if(t&&i.searchedString&&this._defaultContentDiv.isHidden())return this._calendarContentDiv.hide(),new Promise(function(e){e({viewId:this._rootW,hasNoResults:!0})}.bind(this));var a=this.hasFocusedProxy(),r={},o={};this.dateView.redraw();var c=this._getPreferredPredicates(a),d=this.getObservedNavImpl(),g=this;if(d){var u=d.listPredicates(c),h=[],p=[];for(var f in u)if(-1!==c.indexOf(f)){var m=u[f];if(UWA.is(m,"object")){var v=[];for(var T in m){var C=m[T];if(UWA.is(C,"array")){var w=C.every(function(e){return!e||"date"==e.type});v.push(w)}}v.every(function(e){return e})?h.push(f):(s.warn("predicate "+f+" does not have DATE type of tag values"),p.push(f))}}var b=[];h.forEach(function(e){a&&(a.hasFreeInputSupport(e)||a.hasFreeInputOnly(e))?b.push(e):p.push(e)});var y=this._getPredicateInfo(a);if((b=b.sort(function(e,t){var i=y&&y[e]&&y[e].hasOwnProperty("weight")?y[e].weight:0,a=((y&&y[t]&&y[t].hasOwnProperty("weight")?y[t].weight:0)||0)-(i||0);return 0===a?n.getPredicate(e).displayName().localeCompare(n.getPredicate(t).displayName()):a})).length>0&&!i.searchedString)if(this._calendarContentDiv.show(),0!==Object.keys(n.getElementsToTranslate()).length){var S=n.getElementsNLS();Promise.all(S).then(function(){g._updatePredicateOptions(b)})}else g._updatePredicateOptions(b);else(d.hasActiveTags()||d.hasLocalActiveTags())&&0==this._calendarContentDiv.isHidden()?this._calendarContentDiv.show():(i.searchedString?r.hasNoResults=!0:r.isEmpty=!0,this._calendarContentDiv.hide());-1!=c.indexOf(l.COMMUNITY_TAGS)&&p.push(l.COMMUNITY_TAGS);var E=this.availableTagsToHtml(i,a,p);this._defaultContentDiv.innerHTML='<div id="all-tags">'+E+"</div>",this.container.getElements(".predicate:not(.searchexcluded)").forEach(function(e){e.show()}),(o=this.getContentStatus(this._defaultContentDiv)).isEmpty||o.hasNoResults?(this._defaultContentDiv.hide(),o.isEmpty&&(o.hasNoResults=!0)):this._defaultContentDiv.show()}return this._redrawStatus=!1,new Promise(function(e){e({viewId:this._rootW,isEmpty:r.isEmpty&&o.isEmpty,hasNoResults:r.hasNoResults&&o.hasNoResults,hideBorder:o.hideBorder})}.bind(this))},_updatePredicateOptions:function(e){var t=this,i=[];e.forEach(function(e,a){let r=n.getPredicate(e)?n.getPredicate(e).displayName():e;i.push({value:e,label:r,selected:t.activePredicate==e||0==a,attributes:{id:e,labelText:r}}),t.activePredicate==e?t.predicateSelector.setValue(r):t.activePredicate||0!=a||t.predicateSelector.setValue(r)}),this.predicateSelector.add(i),this.predicateSelector.setDisabled(!1)},destroy:function(){this.dateView.destroy(),this.predicateSelector&&this.predicateSelector.destroy(),this._parent()},resetUI:function(){this.clearDates()}});return l.COMMUNITY_TAGS="communityTags_when",l}),define("DS/TagNavigator/CacheManager",["UWA/Class","DS/TagNavigator/ColorManager","DS/TagNavigator/TaggerSettings"],function(e,t,i){"use strict";return e.extend({init:function(e){this.activePredicates={},this.activeW={allw:!0},this.collapsedPredicates={},this.interactivePredicateStatus={},this.expandedTagTree={},this.searchId="filter-all",this.searchVisibility=!1,this.searchValue="",this.addTagVisible=!1,this.addTagValue="",this.openedToolBox={},this.predicatesSortingMode={},this.colorManager=new t,this.viewMode={},this.collapsedSection={},this.moreClicked=!1,this.more=!1,this.criteriaToResetMap={},this.criteriaToRemoveArray={},this.sort6W="sort-tag",this.cloudPredicate={},this.parameterClicked=!1,this.selectedTab="tags",this.expandRootW={},this._isMoreTagsButtonClicked=!1,this.storage=e&&e.storage?e.storage:null,this.storage&&(this.viewMode=this.storage.get("viewMode"),this.viewMode||(this.viewMode=i.getOption("defaultViewMode")),this.storage.set("viewMode",this.viewMode),this.sectionInfo=this.storage.get("sectionInfo"),this.sectionInfo||(this.sectionInfo={"tn-all-tags":{expanded:!1},"tn-add-tags":{expanded:!0}},this.storage.set("sectionInfo",this.sectionInfo)),this.addTagActiveW=this.storage.get("addTagActiveW"),this.addTagActiveW||(this.addTagActiveW="ds6w:where",this.storage.set("addTagActiveW",this.addTagActiveW)),this.rootWExpanderStatus=this.storage.get("rootWExpanderStatus"),this.rootWExpanderStatus||(this.rootWExpanderStatus={all:{},preferred:{}},i.getOption("simplifiedRootW").forEach(function(e){this.rootWExpanderStatus.all[e]=!0,this.rootWExpanderStatus.preferred[e]=!0}.bind(this))))},setSectionExpandStatus:function(e,t){this.sectionInfo[e].expanded=t,this.storage.set("sectionInfo",this.sectionInfo)},getSectionExpandStatus:function(e){return this.sectionInfo[e].expanded},setAddTagActiveW:function(e){this.storage.set("addTagActiveW",e),this.addTagActiveW=e},getAddTagActiveW:function(){return this.addTagActiveW},isActivePredicate:function(e){return this.activePredicates[e]||!1},setActivePredicate:function(e){this.activePredicates[e]=!0},clearActivePredicate:function(){this.activePredicates={}},isActiveW:function(e){return this.activeW[e]||!1},addActiveW:function(e){this.activeW[e]=!0},removeActiveW:function(e){delete this.activeW[e]},getActiveW:function(){return this.activeW},setActiveW:function(e){this.activeW={},this.activeW[e]=!0},getIsMoreTagsButtonClicked:function(){return this._isMoreTagsButtonClicked},setIsMoreTagsButtonClicked:function(e){"boolean"==typeof e&&(this._isMoreTagsButtonClicked=e)},toggleActiveW:function(e){this.activeW[e]?this.removeActiveW(e):this.addActiveW(e)},isPredicateCollapsed:function(e){return!1!==this.collapsedPredicates[e]},collapsePredicate:function(e){delete this.collapsedPredicates[e]},expandPredicate:function(e){this.collapsedPredicates[e]=!1},getInteractiveExpandCollapseStatus:function(e){return!1!==this.interactivePredicateStatus[e]},setAsInteractivelyCollapsed:function(e){this.interactivePredicateStatus[e]=!1},setAsInteractivelyExpanded:function(e){this.interactivePredicateStatus[e]=!0},setExpandCollapseRootWStatus:function(e,t,i){this.storage&&(this.rootWExpanderStatus[e][t]=i,this.storage.set("rootWExpanderStatus",this.rootWExpanderStatus))},getExpandCollapseStatusRootW:function(e,t){if(this.rootWExpanderStatus&&this.rootWExpanderStatus[e])return this.rootWExpanderStatus[e][t]},isTagTreeExpanded:function(e){return this.expandedTagTree[e]||!1},collapseTagTree:function(e){delete this.expandedTagTree[e]},expandTagTree:function(e){this.expandedTagTree[e]=!0},setSearchId:function(e){this.searchId=e},getSearchId:function(){return this.searchId},setSearchVisibility:function(e){this.searchVisibility=e},isSearchVisible:function(){return this.searchVisibility},setSearchValue:function(e){this.searchValue=e},getSearchValue:function(){return this.searchValue},toggleAddTagVisibility:function(){this.addTagVisible=!this.addTagVisible},isAddTagVisible:function(){return this.addTagVisible},setAddTagValue:function(e){this.addTagValue=e},getAddTagValue:function(){return this.addTagValue},toggleToolboxVisibility:function(e,t){this.openedToolBox[e]="boolean"==typeof t?t:!this.openedToolBox[e]},isToolboxVisible:function(e){return this.openedToolBox[e]||!1},changeSort:function(e,t){var i,a=this.predicatesSortingMode[t];a.sortMode===e?a.order=!a.order:(a.sortMode=e,i=a.order,a.order=a.secondaryorder,a.secondaryorder=i)},getCurrentSort:function(e){var t;return this.predicatesSortingMode[e]||(this.predicatesSortingMode[e]={}),(t=this.predicatesSortingMode[e]).sortMode||("ds6w:when"===e.split("/").shift()?(t.sortMode="alphaSort",t.order=!0,t.secondaryorder=!1):(t.sortMode="nbSort",t.order=!1,t.secondaryorder=!0)),t},setViewMode:function(e,t){this.viewMode[e]=t,this.storage&&this.storage.set("viewMode",this.viewMode)},getViewMode:function(e,t){var i=this.viewMode[e];return i||("ds6w:who"==t&&this.storage?(i="people",this.viewMode[e]="people",this.storage.set("viewMode",this.viewMode)):i="tag"),i},setViewModeForSearch:function(){var e;for(e in this.viewMode)"freeInput"===this.viewMode[e]&&(this.viewMode[e]="tag")},isSectionCollapsed:function(e){return this.collapsedSection[e]},toggleSection:function(e,t){void 0!==t?this.collapsedSection[e]=t:UWA.is(this.collapsedSection[e])&&!1!==this.collapsedSection[e]?this.collapsedSection[e]=!1:this.collapsedSection[e]=!0},isMoreClicked:function(){return this.moreClicked},setMoreClicked:function(e){this.moreClicked=e},getMore:function(){return this.more},setMore:function(e){this.more=e},getCriteriaToResetBeforeFilterChange:function(e){return e?this.criteriaToResetMap[e]?this.criteriaToResetMap[e]:(this.criteriaToResetMap[e]={},this.criteriaToResetMap[e]):{}},setCriteriaToResetBeforeFilterChange:function(e,t){UWA.is(e,"string")?this.criteriaToResetMap[e]=t:console.warn("setCriteriaToResetBeforeFilterChange called with invalid proxyId")},resetCriteriaToResetBeforeFilterChange:function(e){UWA.is(e,"string")?delete this.criteriaToResetMap[e]:console.warn("resetCriteriaToResetBeforeFilterChange called with invalid proxyId")},getCriteriaToRemoveBeforeFilterChange:function(e){return e?this.criteriaToRemoveArray[e]?this.criteriaToRemoveArray[e]:(this.criteriaToRemoveArray[e]=[],this.criteriaToRemoveArray[e]):[]},resetCriteriaToRemoveBeforeFilterChange:function(e){UWA.is(e,"string")?delete this.criteriaToRemoveArray[e]:console.warn("resetCriteriaToRemoveBeforeFilterChange called with invalid proxyId")},get6WSort:function(){return this.sort6W},set6WSort:function(e){this.sort6W=e},isCloud:function(e){return this.cloudPredicate[e]||!1},addCloud:function(e){this.cloudPredicate[e]=!0},removeCloud:function(e){delete this.cloudPredicate[e]},getParameterClicked:function(){return this.parameterClicked},setParameterClicked:function(e){this.parameterClicked=e}})}),define("DS/TagNavigator/embeddedTagger/EmbeddedWhereMenuItem",["UWA/Core","UWA/Utils","DS/TagNavigator/TaggerNLS","DS/TagNavigator/embeddedTagger/EmbeddedMenuItem","DS/TagNavigator/TaggerSettings","DS/TagNavigator/simplified/model/ContinentModel"],function(e,t,i,a,n,r){"use strict";var s=a.extend({init:function(e){this._parent(e)},setup:function(e){this.isPreciseCount=e.isPreciseCount,this._parent(e)},render:function(e){return this._parent(e),this},addContent:function(e){var a=this;if(this.model.get("imageURL")){this.container.getElement(".tag-icon").setStyle("display","none");var o=this.container.getElement(".tag-image");o.setAttributes({src:this.model.get("imageURL")}),this.container.getElement(".image-div").setStyle("display","inline-block"),n.getOption("countryFlag")&&(o.setStyles({width:"28px",height:"21px","border-radius":"0"}),this.container.getElement(".tag-label").setStyle("margin-left","5px"))}else this.container.getElement(".tag-icon").addClassName(this.model.get("iconClass"));this.container.getElement(".tag-label").setText(this.model.get("title")),this.container.getElement(".tag-count").setText(i.convertToUnity(this.model.getCount(),this.isPreciseCount)),this.model.get("isSelected")&&this.container.addClassName("selected"),this.setOption("identifier",t.getUUID().substr(0,6));var l=a.getOption("eventsToListen");if(UWA.is(l,"object"))for(event in l)this.addEvent(event,l[event]);if(e){let t=function(e,i){e.forEach((e,a)=>{e.getOption("subMenuItems")?(t(e.getOption("subMenuItems"),i),e.render(i)):e.render(i)})},i=this.getOption("subMenuItems");i&&t(i,e)}else if(this.model instanceof r){var c=[];this.model.getCountries().forEach(function(e){var t=new s({model:e,navImpl:a.navImpl,isPreciseCount:a.isPreciseCount,eventsToListen:a.getOption("eventsToListen")}).render();c.push(t)}),this.setOption("subMenuItems",c)}},destroy:function(){this.stopListening(),this.model=null,this._parent()}});return s}),define("DS/TagNavigator/simplified/activeTags/ExcludedTags",["UWA/Core","UWA/Class/View","DS/TagNavigator/TaggerNLS","DS/TagNavigator/simplified/activeTags/AdvActiveTagView","DS/TagNavigator/Predicate","DS/TagNavigator/simplified/activeTags/ActiveTagsUtils"],function(e,t,i,a,n,r){"use strict";return t.extend({tagName:"div",className:"excluded-tags-list",setup:function(e){this._parent(e)},render:function(){return this.mode=this.getOption("mode"),this.exclude=this.getOption("exclude"),this.container.hide(),e.createElement("span",{class:"fonticon fonticon-block"}).inject(this.container),e.createElement("span",{class:"title",text:i.getText("excludedTags")}).inject(this.container),this.excludedTagsList=e.createElement("ul",{class:"active-predicate-list "+this.mode}).inject(this.container),this.activeTagView={},this},updateExcludedTags:function(e){let t=this;this.emptyContent(),e.forEach(e=>{let i=[],a=Object.keys(e)[0],s=a.split("/").pop(),o=s.contains("sixw:")?n.getPredicate(s.replace("sixw:","")).displayName():n.getPredicate(s).displayName();(i=r.getTags(e[a],!1,!0))&&i.length&&(t.container.show(),i.forEach(t=>{let i,n;t.condition.display?i=t.condition.display:"date"==t.condition.type&&(i=t.condition.display?t.condition.display:r._computeDateNls(UWA.clone(t.condition.object))),e[a].isComplex?n={condition:t.condition,id:a,predDispName:o,tagName:i}:((n=t.condition).id=a,n.predDispName=o,n.tagName=i);let s=this._getActiveTagsOption(n),l=this.createTagView(s);this.activeTagView[s.attribute[0].unique_id]=l,this.excludedTags++}),t.show())})},addTag:function(e){this.container.show();let t=this._getActiveTagsOption(e),i=this.createTagView(t);this.activeTagView[t.attribute[0].unique_id]=i,this.excludedTags++},createTagView:function(e){let t=new a(e).render().inject(this.excludedTagsList);return t.addEvent("unexcludeTag",this.dispatchExcludeEvent.bind(this)),t.addEvent("removeActiveTag",this.dispatchRemoveEvent.bind(this)),t},dispatchExcludeEvent:function(e){let t=e.option;e.target.destroy(),this.enableActionButton(),this.destroyActiveTagView(t),this.excludedTags||this.container.hide(),this.dispatchEvent("excludeTag",t)},dispatchRemoveEvent:function(e){let t=e.option;this.dispatchEvent("removeTag",t),this.destroyActiveTagView(t),this.excludedTags||this.hide()},enableActionButton:function(){this.dispatchEvent("informActiveView")},emptyContent:function(){this.hide(),this.excludedTagsList.empty(),this.destroyAllActiveTagViews()},_getActiveTagsOption:function(e){let t,i="";return e.condition?((t=UWA.clone(e.condition)).id=e.id,t.tagName=e.tagName):t=UWA.clone(e),"string"==typeof t.object?i=t.object.replaceAll(" ","_")+"_"+t.id:Array.isArray(t.object)&&(i=t.object.join("_")+"_"+t.id),{id:t.tagName.replaceAll(" ","_")+"::"+t.id,text:t.tagName,isSimplified:!0,hasActions:this.exclude,hasExcludeSupport:this.exclude,isExcluded:t.excluded,condition:e,attribute:[{unique_id:i}],advancedProxy:!0,renderTo:!0}},destroyActiveTagView:function(e){let t,i="";return e.condition?((t=UWA.clone(e.condition)).id=e.id,t.tagName=e.tagName):t=UWA.clone(e),"string"==typeof t.object?i=t.object.replaceAll(" ","_")+"_"+t.id:Array.isArray(t.object)&&(i=t.object.join("_")+"_"+t.id),!!this.activeTagView[i]&&(this.activeTagView[i].destroy(),delete this.activeTagView[i],this.excludedTags--,this.excludedTags||this.hide(),!0)},destroyAllActiveTagViews:function(){for(let e in this.activeTagView)this.activeTagView[e].destroy();this.excludedTags=0},destroy:function(){this.stop,this._parent()}})}),define("DS/TagNavigator/simplified/views/ContextMenu",["UWA/Core","UWA/Class","DS/TagNavigator/TaggerNLS","DS/UIKIT/DropdownMenu"],function(e,t,i,a){"use strict";return t.extend({init:function(e){let t=this;this.createDropdown=function(e){this.target=e.target,this.view=e.view,this.dropdown=new a({className:"tn-ctx-menu",target:e.target,bound:!1,removeOnHide:!0,scrollMode:!1,contextual:!0,items:e.items,events:{onClick:function(e,i){t.onClickEvent(i.id)}.bind(t),onClickOutside:function(){t.dropdown.destroy()}.bind(t)}}).show(!1,e.evtObj)},this.onClickEvent=function(e){{let t="exclude"==e;if(this.target.hasClassName("tag")){let e=this.target.id,i=this.view.getIdFromDOMId(e);this.view.isSelected(i)?t?this.view.observedNavImpl.excludeTag(i,t):this.view.observedNavImpl.undoExcludeTag(i,t):this.view.toggleTagSelection(e,null,t)}else this.target.hasClassName("people-view")&&this.view.excludeTag(t)}}}})}),define("DS/TagNavigator/embeddedTagger/Embedded3DEXPERIENCEMenuItem",["UWA/Core","UWA/Utils","DS/TagNavigator/TaggerNLS","DS/TagNavigator/embeddedTagger/EmbeddedMenuItem","DS/TagNavigator/simplified/model/TagValueModel","DS/TagNavigator/simplified/utils/LocationUtils"],function(e,t,i,a,n,r){"use strict";var s={},o=a.extend({init:function(e){this._parent(e)},setup:function(e){this.isPreciseCount=e.isPreciseCount,this._parent(e)},render:function(e){return this.updateImageCB=this.updateImage.bind(this),this.model.addEvent("onChange:iconClass",this.updateImageCB),this.updateCountCB=this.updateCount.bind(this),this.model.addEvent("onChange:count",this.updateCountCB),this._parent(e),this},updateImage:function(){this.model.get("imageURL")?(this.container.getElement(".tag-icon").setStyle("display","none"),this.container.getElement(".tag-image").setAttributes({src:this.model.get("imageURL")}),this.container.getElement(".image-div").setStyle("display","inline-block")):this.model.get("iconClass")?this.container.getElement(".tag-icon").addClassName(this.model.get("iconClass")).show():this.container.getElement(".tag-icon").setStyle("display","none")},updateCount:function(){var e=this.model.get("count");e&&this.container.getElement(".tag-count").setText(i.convertToUnity(e,this.isPreciseCount))},addContent:function(e){var i=this;this.container.getElement(".tag-label").setText(this.model.get("title")),this.updateImageCB(),this.updateCount(),this.setOption("identifier",t.getUUID().substr(0,6));var a=i.getOption("eventsToListen");if(UWA.is(a,"object"))for(event in a)this.addEvent(event,a[event]);if(e){let t=function(e,i){e.forEach((e,a)=>{e.getOption("subMenuItems")?(t(e.getOption("subMenuItems"),i),e.render(i)):e.render(i)})},i=this.getOption("subMenuItems");i&&t(i,e)}else if(this.model instanceof n)this.navImpl.isSelected(this.model.get("tagValue"))&&this.container.addClassName("selected");else{this.navImpl.isGroupedBy("ds6w:dataSource")&&this.container.addClassName("selected"),s={};var l=this.navImpl.getFocusedProxy(),c=function(e){var t=new o({model:new n({tagValue:e,proxy:l}),navImpl:i.navImpl,isPreciseCount:i.isPreciseCount,eventsToListen:a}).render();s[e.getDisplayValue()]=t;var d=e.getParent();if(d){var g=s[d.getDisplayValue()];g||(g=c(d)),(u=g.getOption("subMenuItems"))||(u=[]),u.push(t),g.setOption("subMenuItems",u),t.model.set("iconClass",e.icon?e.icon:g.model.get("iconClass"))}else{var u;(u=i.getOption("subMenuItems"))||(u=[]),u.push(t),i.setOption("subMenuItems",u),t.model.set("iconClass",r.getSourceIcon(e.getUri()))}return t},d=l?l.getEachTagValueForPredicate("ds6w:dataSource"):[];UWA.is(d,"array")&&d.forEach(function(e){s[e.getDisplayValue()]||c(e)});var g=i.getOption("subMenuItems");UWA.is(g,"array")&&g.forEach(function(e){var t=i.getCount(e);t&&e.model.set("count",t)}),this.sort()}},getCount:function(e){var t=this,i=e.getOption("subMenuItems");if(!UWA.is(i,"array"))return e.model.get("count");var a=i.reduce(function(e,i){return e+t.getCount(i)},0);e.model.set("count",a)},_sortItems:function(e,t,i){if(i=i||!1,"nbSort"==(t=t||"nbSort")){var a,n,r=function(e,t){a=e.model.get("count"),n=t.model.get("count"),a=a||0,n=n||0};return i?e.sort(function(e,t){return r(e,t),a-n}):e.sort(function(e,t){return r(e,t),n-a})}},sort:function(){var e=this.getOption("subMenuItems"),t=[];if(e&&e.length>0)return e.forEach(function(e){e.sort()&&t.push(e)}),e=this._sortItems(e),this.setOption("subMenuItems",e),!0},destroy:function(){this.stopListening(),this.model=null,this._parent()}});return o}),define("DS/TagNavigator/simplified/views/PersonPredicateView",["UWA/Core","UWA/Class/View","DS/UIKIT/Input/Toggle","DS/TagNavigator/simplified/utils/PersonUtils"],function(e,t,i,a){"use strict";return t.extend({tagName:"ul",className:"person-predicates",_tooltip:void 0,_predicateToggles:[],domEvents:{"click li.predicate-info input":"clickOnPredicate"},init:function(e){this._predicateToggles=[],this._parent(e)},setup:function(e){this._parent(e)},render:function(){return this.addContent(),this},addContent:function(){var t=this.getOption("navImpl"),n=this.model.getUniqueTagValuesPerPredicate();if(t.hasProxiesInEdition())for(var r in n){var s=e.createElement("li",{class:"predicate-info"}).inject(this.container),o=e.createElement("div",{class:"pred-count"}),l=n[r][0],c=new i({type:"checkbox"}).setValue(l.pred.getFullPredicateID()).setLabel(l.pred.displayName()).setClassName("primary").inject(s);this._predicateToggles.push(c),o.setText("("+n[r].length+")").inject(s)}else{var d=[];for(var r in n){var g=n[r];d.push(g[0]);for(var u=1;u<g.length;u++)g[0].count+=g[u].count}d=d.sort(function(e,t){return t.count-e.count});for(var h=0,p=this.getOption("hasAdvancedFocsuedProxy")(a.PERSON_REFINE),f=p?a.getActivePredicates(p,this.model.get("title")):[],m=0;m<d.length;m++){l=d[m],s=e.createElement("li",{class:"predicate-info"}).inject(this.container),o=e.createElement("div",{class:"pred-count"});!function(){return p?-1!==f.indexOf(l.pred.getFullPredicateID()):t.isSelected(JSON.stringify(this.model.getRefineStructure(l.pred.getFullPredicateID())))}.call(this)?this._predicateToggles.push(new i({type:"checkbox"}).setValue(l.pred.getFullPredicateID()).setLabel(l.pred.displayName()).setClassName("primary").inject(s)):(h++,this._predicateToggles.push(new i({type:"checkbox"}).setValue(l.pred.getFullPredicateID()).setLabel(l.pred.displayName()).setClassName("primary").check().inject(s))),h===d.length&&this.getOption("setAsSelected")(),o.setText("("+l.count+")").inject(s)}}},clickOnPredicate:function(e){var t=e.target.value,i=[];this._predicateToggles.forEach(function(e){e.isChecked()&&i.push(e.getValue())}),this.dispatchEvent("onPredicateSelection",[{currentPredicate:t,activePredicates:i},e])},destroy:function(){this.stopListening(),this.model=null,this._predicateToggles=[],this._parent()}})}),define("DS/TagNavigator/simplified/utils/ColorUtils",["UWA/Core","UWA/Class","DS/TagNavigator/Logger","DS/SNInfraUX/TaggerConfigAccess"],function(e,t,i,a){return t.singleton({init:function(){this.colorPromiseFromTenants={}},retrieveAdminColors:function(e){return this.colorPromiseFromTenants[e]||(this.colorPromiseFromTenants[e]=new Promise(function(t){a.get6WTagsColorsConfiguration({tenantID:e}).then(function(a){UWA.is(a,"object")?(i.log(`Retrieved admin colors from tenant ${e}:`,a),t(a)):(i.warn(`Invalid object type from tenant ${e}:`,a),t({}))},function(){i.error(`Error while retrieving colors from ${e}:`,colorMapObj),t({})})})),this.colorPromiseFromTenants[e]},getColorPromisesForTenants:function(e){var t=e.getProxiesToDisplay().map(function(e){return e.getTenant()});t=[...new Set(t)];var i=[];for(var a of t)a&&i.push(this.retrieveAdminColors(a));return i}})}),define("DS/TagNavigator/simplified/views/Expander",["UWA/Core","UWA/Class/View","DS/TagNavigator/TaggerNLS","DS/Controls/Button"],function(e,t,i,a){"use strict";return t.extend({tagName:"div",className:"tn-expander",domEvents:{"click .arrow":"toggleArrows"},init:function(e){this._parent(e)},setup:function(e){this._parent(e)},render:function(){let t=this.getOption("label"),n=(this.getOption("deleteButton"),this.getOption("editBtn"));this.header=e.createElement("div",{class:"section-header"}).inject(this.container);var r=e.createElement("div",{class:"arrow"}).inject(this.header);return this.downArrow=e.createElement("span",{class:"fonticon fonticon-down-dir"}).inject(r),this.rightArrow=e.createElement("div",{class:"fonticon fonticon-right-dir"}).inject(r).hide(),e.createElement("div",{class:"header-title",text:t}).inject(this.header),n&&(this.editTagBtn=new a({label:i.getText("editTagPen"),icon:{iconName:"pencil",fontIconFamily:WUXManagedFontIcons.Font3DS}}).inject(this.header)),this.clearBtn=e.createElement("span",{class:"section-header-left active-tags-close disbale fonticon fonticon-trash"}).inject(this.header),this.body=e.createElement("div",{class:"section-body"}).inject(this.container),this},toggleArrows:function(){this.downArrow.isHidden()?(this.rightArrow.hide(),this.downArrow.show(),this.body.show()):this.rightArrow.isHidden()&&(this.downArrow.hide(),this.rightArrow.show(),this.body.hide())},toggleEditBtn:function(e){e?this.editTagBtn.show():this.editTagBtn.hide()},toggleClearButton:function(e){this.clearBtn.toggleClassName("disable",e)},destroy:function(){this._parent()}})}),define("DS/TagNavigator/simplified/views/PersonView",["UWA/Core","UWA/Class/View","DS/Handlebars/Handlebars","DS/UIKIT/Tooltip","DS/TagNavigator/simplified/views/PersonPredicateView","DS/TagNavigator/simplified/utils/PersonUtils","text!DS/TagNavigator/assets/templates/PersonViewTemplate.html","DS/TagNavigator/TagValue","DS/TagNavigator/TaggerNLS","DS/TagNavigator/Predicate","DS/TagNavigator/simplified/actions/ActionUtils","DS/MessageBus/MessageBus"],function(e,t,i,a,n,r,s,o,l,c,d,g){"use strict";return t.extend({tagName:"li",className:"people-view",template:i.compile(s),_tooltip:void 0,domEvents:{"click div.people-template":"clickOnPerson","click .people-filter":"togglePredicateListView",contextmenu:"onContextMenuOpen",touchstart:"startTheTimer",touchend:"stopTheTimer"},init:function(e){this._parent(e)},setup:function(e){this._parent(e)},updateImageCB:void 0,updateSubTitleCB:void 0,render:function(){var e=this.template();return this.container.setContent(e),this.navImpl=this.getOption("navImpl"),this.addContent(),this.getOption("expandable")&&(this.container.addClassName("expandable"),this.container.getElement(".people-filter").setStyle("display","block")),this.personInfo=this.model.get("personInfo"),this.personInfo&&(this.updateImageCB=this.updateImage.bind(this),this.personInfo.addEvent("onChange:imageURL",this.updateImageCB),this.updateSubTitleCB=this.updateSubTitle.bind(this),this.personInfo.addEvent("onChange:country",this.updateSubTitleCB)),this.personPredicateView=null,this.listenTo(this.model,"onHideView",this.onHideView.bind(this)),this.listenTo(this.model,"onShowView",this.onShowView.bind(this)),this._tooltip=new a({position:"bottom",target:this.container.getElement(".people-template"),body:this.model.get("title"),className:"person-tooltip"}),this.taggerView=this.getOption("getTaggerView")(),this.contextMenu=this.taggerView.contextMenu,this},excludeTag:function(e){if(this.getOption("hasAdvancedFocsuedProxy")(r.PERSON_REFINE)&&this.getOption("expandable")){let t=r.buildCondition(this.model,null,e);!this.isSelected()&&e?this.navImpl.toggleComplexTagSelection(t,!0,e):e?this.navImpl.excludeTag(t):this.navImpl.undoExcludeTag(t)}else{let t=this.model.getUniqueTagValuesPerPredicate(),i=c.getPredicate(Object.keys(t)[0]).getFullPredicateID(),a=this.model.getRefineStructure(i);this.isSelected()?e?this.navImpl.excludeTag(a):this.navImpl.undoExcludeTag(a):this.navImpl.toggleTagSelection(a,!0,e)}},onHideView:function(){this.hide()},onShowView:function(){this.show()},updateImage:function(){this.container.getElement("img").setAttributes({src:this.model.getImage()})},updateSubTitle:function(){var e=this.container.getElement(".sub-label"),t=this.model.getCountry();if(1===this.model.getNbMatches()&&1===t.length&&t[0]){var i,a=t[0].split(".");2==a.length&&(i=o.getTagValueNls(a[0],a[1])),i?e.setText(i):e.setText(t[0]),e.setStyle("display","block")}else e.setText(""),e.setStyle("display","none")},isExcluded:function(){let e=this.getOption("hasAdvancedFocsuedProxy")(r.PERSON_REFINE),t=!1;var i=this.model.getUniqueTagValuesPerPredicate();if(e&&this.getOption("expandable")){let i=r.getExistingCondition(e,this.model.get("title"));return i&&i.excluded?i.excluded:t}if(1===Object.keys(i).length){let e=i[Object.keys(i)[0]][0];t=this.navImpl.isExcluded(JSON.stringify(this.model.getRefineStructure(e.pred.getFullPredicateID())))}return t},onContextMenuOpen:function(e){if(this.navImpl.hasExcludeSupport()){e.preventDefault();this.contextMenu.dropdown&&(this.contextMenu.dropdown.destroy(),this.contextMenu.dropdown=null);let t=[];this.isExcluded()?t.push({text:l.getText("unexludeTag"),fonticon:"block",id:"include"}):t.push({text:l.getText("excludeTag"),fonticon:"block",id:"exclude"}),this.contextMenu.createDropdown({cont:this.taggerView.taggerRoot,target:this.container,view:this,items:t,evtObj:{pageX:e.x,pageY:e.y}}),console.log("in dropdown")}return!1},startTheTimer:function(e){this.touchStartTimeStamp=e.timeStamp},stopTheTimer:function(e){let t=e.timeStamp-this.touchStartTimeStamp;console.log("Press Time = "+t),t>=3e3&&this.onContextMenuOpen(e)},isSelected:function(){return this.container.getElement("div.people-template").hasClassName("people-selected")},setAsSelected:function(){this.container.getElement("div.people-template").addClassName("people-selected")},setAsUnselected:function(){this.container.getElement("div.people-template").removeClassName("people-selected")},isSelectedForAction:function(e){return this.container.getElement("div.people-template").hasClassName(e)},setAsSelectedForAction:function(e){this.container.getElement("div.people-template").addClassName(e)},setAsUnselectedForAction:function(e){this.container.getElement("div.people-template").removeClassName(e)},getSelectedPredicatesCount:function(){var e=this.getOption("hasAdvancedFocsuedProxy")(r.PERSON_REFINE);if(e)return r.getActivePredicates(e,this.model.get("title")).length;var t=0,i=this.model.getUniqueTagValuesPerPredicate();for(var a in i){var n=i[a][0];this.navImpl&&this.navImpl.isSelected(JSON.stringify(this.model.getRefineStructure(n.pred.getFullPredicateID())))&&t++}return t},setAsExpanded:function(){this.showPredicateListView()},addContent:function(){var t;(this.updateImage(),this.container.getElement(".people-filter").setAttributes({title:this.model.get("title")}),this.isExcluded()&&e.createElement("span",{class:"fonticon fonticon-block"}).inject(this.container.getElement(".item-label"),"before"),this.container.getElement(".item-label").setText(this.model.get("title")),(t=this.model.getCount()).exactCount?this.container.getElement(".item-count").setText(this.getOption("preciseCount")?t.count:l.convertToUnity(t.count)):this.container.getElement(".item-count").setText(l.getText("atleast")+" "+(this.getOption("preciseCount")?t:l.convertToUnity(t))),this.updateSubTitle(),this.getOption("expandable"))&&((t=this.getSelectedPredicatesCount())>0&&this.container.getElement(".people-filter").setAttributes({"data-badge":t}));if(this.getOption("color")){var i=this.getOption("color");this.container.addClassName("colorize"),this.container.getElement("img").setStyle("border","5px solid "+i),this.container.getElement("img").setAttributes({color:i})}var a=this.getOption("getTaggerView")(),n=a.actionManager?a.actionManager.getCurrentAction():void 0;n&&n.id===d.ACTION_COLORIZE&&this.container.hasClassName("colorize")&&this.container.addClassName("picked-for-colorize")},togglePredicateListView:function(){var e=!1;this.personPredicateView?this.personPredicateView.container.isHidden()?this.personPredicateView.show():this.personPredicateView.hide():(e=!0,this.showPredicateListView()),r.setExpandStatus(this.model.get("title"),e)},clickOnPerson:function(e){if(this.navImpl.hasProxiesInEdition())console.warn("Refine not possible when subject is in focus");else{if(this.getOption("expandable")&&e.target.hasClassName("people-filter"))return;if(this.getOption("hasAdvancedFocsuedProxy")(r.PERSON_REFINE)&&this.getOption("expandable")){var t=!0;if(e.ctrlKey&&e.altKey)return!1;var i=r.buildCondition(this.model),a=this.getOption("getTaggerView")(),n=a.actionManager.getCurrentAction();if(e.ctrlKey||n&&(n.id===d.ACTION_SELECT||n.id===d.ACTION_EDITTAGREL))t=!1,n||(n=a.startSelectAction()),n.onPersonSelection({view:this,refineData:i,isComplex:!0});else if(n&&n.id===d.ACTION_GROUP)t=!1,n.onPersonSelection({view:this,refineData:i,isComplex:!0});else if(n&&n.id===d.ACTION_SELECTINAPP)t=!1,n.onPersonSelection({view:this,refineData:i,isComplex:!0});else if(n&&n.id===d.ACTION_EXCLUDE)t=!1,i=r.buildCondition(this.model,null,!0),n.onPersonSelection({view:this,refineData:i,isComplex:!0});else{if(n&&n.id===d.ACTION_COLORIZE)return void n.onPersonSelection({view:this,refineData:i,isComplex:!0,model:this.model});this.navImpl.toggleComplexTagSelection(i)}t&&this.getOption("setSpinner")()}else{var s=this.model.getUniqueTagValuesPerPredicate();1===Object.keys(s).length&&this.onPredicateSelection({currentPredicate:c.getPredicate(Object.keys(s)[0]).getFullPredicateID()},e)}let o=c.getPredicate(Object.keys(this.model.getUniqueTagValuesPerPredicate())[0]).getFullPredicateID();this.trackPersonRefine(o)}},trackPersonRefine:function(e){setTimeout(()=>{let t=e.split("/"),i={pd1:t[t.length-1],pd2:t[0]};g.publish({channel:"TaggerTrackerApi",topic:"hit",data:{category:"6WTagger",action:"ClickOnTag",persDim:i}})})},showPredicateListView:function(){var e=this;this.personPredicateView=new n({model:this.model,navImpl:this.navImpl,hasAdvancedFocsuedProxy:this.getOption("hasAdvancedFocsuedProxy"),setAsSelected:function(){e.setAsSelected()}}).render().inject(this.container),this.personPredicateView.show(),this.personPredicateView.addEvent("onPredicateSelection",this.onPredicateSelection.bind(this))},onPredicateSelection:function(e,t){var i=this.navImpl;if(i)if(i.hasProxiesInEdition())console.warn("no refine possible when focused on subjects");else{var a=!0,n=this.getOption("hasAdvancedFocsuedProxy")(r.PERSON_REFINE),s=this.getOption("getTaggerView")(),o=s.actionManager.getCurrentAction();if(n&&this.getOption("expandable")){if(t.ctrlKey&&t.altKey)return!1;if(t.ctrlKey||o&&(o.id===d.ACTION_SELECT||o.id===d.ACTION_EDITTAGREL))a=!1,o||(o=s.startSelectAction()),o.onPersonSelection({view:this,isComplex:!0,selectedPredicates:e.activePredicates});else if(o&&o.id===d.ACTION_GROUP)a=!1,o.onPersonSelection({view:this,isComplex:!0,selectedPredicates:e.activePredicates});else if(o&&o.id===d.ACTION_EXCLUDE)a=!1,o.onPersonSelection({view:this,isComplex:!0,selectedPredicates:e.activePredicates});else{if(o&&o.id===d.ACTION_COLORIZE)return void o.onPersonSelection({view:this,refineData:e.activePredicates,model:this.model,isComplex:!0});if(r.getExistingCondition(n,this.model.get("title"))){var l=r.buildCondition(this.model);n.getLocalFilter().toggle(l)}if(e.activePredicates.length>0){var c=r.buildCondition(this.model,e.activePredicates);n.getLocalFilter().toggle(c)}i.onRefine()}}else{if(t.ctrlKey&&t.altKey)return!1;var g=this.model.getRefineStructure(e.currentPredicate);if(t.ctrlKey||o&&(o.id===d.ACTION_SELECT||o.id===d.ACTION_EDITTAGREL))a=!1,o||(o=s.startSelectAction()),o.onPersonSelection({view:this,refineData:g,isComplex:!1});else if(o&&o.id===d.ACTION_GROUP)a=!1,o.onPersonSelection({view:this,refineData:g,isComplex:!0});else if(o&&o.id===d.ACTION_EXCLUDE)a=!1,o.onPersonSelection({view:this,refineData:g,isComplex:!1});else if(o&&o.id===d.ACTION_SELECTINAPP)a=!1,o.onPersonSelection({view:this,refineData:g,isComplex:!1,model:this.model});else{if(o&&o.id===d.ACTION_COLORIZE)return void o.onPersonSelection({view:this,refineData:g,isComplex:!1,model:this.model});i.getFocusedProxy()||i.dispatchEvent("onBeforeGlobalFilterChange"),i.toggleTagSelection(JSON.stringify(g))}}a&&this.getOption("setSpinner")()}},destroy:function(){this.personPredicateView&&this.personPredicateView.destroy(),this._tooltip.destroy(),this.stopListening(),this.personInfo&&(this.personInfo.removeEvent("onChange:imageURL",this.updateImageCB),this.personInfo.removeEvent("onChange:country",this.updateSubTitleCB)),this.model=null,this.updateImageCB=null,this.updateSubTitleCB=null,this.contextMenu.dropdown&&this.contextMenu.dropdown.destroy(),this.touchStartTimeStamp&&(this.touchStartTimeStamp=null),this._parent()}})}),define("DS/TagNavigator/Suggestions",["UWA/Class","UWA/Core","UWA/Element","DS/UIKIT/Autocomplete","DS/TagNavigator/TaggerNLS"],function(e,t,i,a,n){"use strict";return e.singleton({init:function(){var e={},t=null,i=null,a=null,n=null;this.getSuggestionsFromServers=function(r){var s;r.tagsServers,a=r.pred,i=r.tenants&&r.tenants.length?r.tenants[0]:null,n=r.autocomplete,s=function(i,a,r){var s,o,l={};if(e[i+a]={},r&&Object.keys(r).length){for(l={name:i+a,items:[]},s=0,o=(r=r.literalInfo).length;s<o;s++)r[s].value&&l.items.push({value:r[s].value});l.items.sort(function(e,t){return(e.label||e.value).toLowerCase()<(t.label||t.value).toLowerCase()?-1:(e.label||e.value).toLowerCase()>(t.label||t.value).toLowerCase()?1:0}),t&&n.removeDataset(t),e[i+a]=l,t=i+a,n.addDataset(e[i+a])}},i&&a&&n&&(t&&n.removeDataset(t),e[i+a]?(t=i+a,Object.keys(e[t]).length&&n.addDataset(e[t])):r.tagsServers[i].getVocabularySuggestions(i,a,s))}}}).init()}),define("DS/TagNavigator/embeddedTagger/EmbeddedAdvancedActiveCriteria",["UWA/Core","UWA/Class/View","DS/TagNavigator/TaggerNLS","DS/TagNavigator/simplified/activeTags/AdvActiveTagView","DS/TagNavigator/simplified/activeTags/ActiveTagsUtils","DS/TagNavigator/Predicate"],function(e,t,i,a,n,r){"use strict";return t.extend({tagName:"ul",className:"advanced-active-tags active-predicate-list",init:function(t){this.proxy=t.proxy,e.is(this.proxy)&&e.is(this.proxy._embeddedTaggerViewOptions)&&e.is(this.proxy._embeddedTaggerViewOptions.is6WInWebInWinActive)&&!0===this.proxy._embeddedTaggerViewOptions.is6WInWebInWinActive&&(this._listOfActiveTag=[]),this._parent(t)},setup:function(e){this._parent(e)},render:function(){return this},redraw:function(e){this.container.innerHTML="",this.lastPredicate=void 0,this.objectPredicateTag=new Map,this.advancedFilter=this.proxy._selectedValues,this.filter=n.computeFilters(this.advancedFilter),this.modified=!1,this.addActiveTags()},addActiveTags:function(){let t=this,i=[];this.activeTags={},this.filter&&this.filter.allfilters&&(i=this.filter.allfilters.condition?this.filter.allfilters.condition:this.filter.allfilters),e.is(t._listOfActiveTag,"array")&&(t._listOfActiveTag=[]),(i.length||this.activeGroupings&&this.activeGroupings.length)&&(this.emptyView&&this.emptyView.hide(),this.modified||(this.modified=n.hasOverloadedOperator(i,this.advancedFilter)),this.addTag(i))},_getActiveTagsOption:function(e){let t;return e.condition?((t=UWA.clone(e.condition)).id=e.id,t.tagName=e.tagName,t.predDispName=e.predDispName,t.icon=e.icon):t=UWA.clone(e),{id:t.tagName.replaceAll(" ","_")+"::"+t.id,text:t.tagName,isSimplified:!0,icon:"fonticon-3ds-"+t.icon,hasActions:this.proxy.hasExcludeSupport(),hasExcludeSupport:this.proxy.hasExcludeSupport(),isExcluded:t.excluded,condition:e,attribute:[{"predicate-name":t.predDispName}],advancedProxy:!0}},addTag:function(t){let a=this;t.forEach(t=>{let s=[],o=Object.keys(t)[0],l=o.split("/").pop(),c=l.contains("sixw:")?r.getPredicate(l.replace("sixw:","")).displayName():r.getPredicate(l).displayName(),d=this._getPredicateIcon(o);if((s=n.getTags(t[o]))&&s.length){let r=["string","boolean"];s.forEach((l,g)=>{let u,h;l.condition.display?u=l.condition.display:-1==r.indexOf(l.condition.type)&&(u=l.condition.display?l.condition.display:n._computeDateNls(UWA.clone(l.condition.object))),t[o].isComplex?h={condition:l.condition,id:o,predDispName:c,tagName:u,icon:d,isComplex:t[o].isComplex}:((h=l.condition).id=o,h.predDispName=c,h.tagName=u,h.icon=d);let p=this._getActiveTagsOption(h),f=t[o].operator,m=this.createTagView(p);0==g&&this.modified&&f&&"XOR"==f&&e.createElement("span",{class:"tag-label operator-text",text:i.getText("only")}).inject(m.container,"before"),g>=0&&g+1!=s.length&&this.modified&&f&&e.createElement("span",{class:"tag-label operator-text",text:i.getText(f)}).inject(this.container),e.is(a._listOfActiveTag,"array")&&e.is(m)&&a._listOfActiveTag.push(m)})}})},createTagView:function(e){let t=new a(e).render().inject(this.container);return t.addEvent("excludeTag",this.dispatchExcludeEvent.bind(this)),t.addEvent("unexcludeTag",this.dispatchExcludeEvent.bind(this)),t.addEvent("removeActiveTag",this.dispatchRemoveEvent.bind(this)),t},_getPredicateIcon:function(e){return e.contains("ds6w:what")?"what":e.contains("ds6w:where")?"where":e.contains("ds6w:when")?"when":e.contains("ds6w:who")?"who":e.contains("ds6w:why")?"why":e.contains("ds6w:how")?"how":void 0},dispatchRemoveEvent:function(e){let t;t=e.option.isComplex?e.option:{dispValue:e.option.display,object:e.option.object,type:e.option.type,predicate:e.option.id},this.proxy._navimpl.toggleTagSelection(t)},dispatchExcludeEvent:function(e){let t,i;e.option.isComplex?(t=e.option,i=e.option.condition.excluded):(t={dispValue:e.option.display,object:e.option.object,type:e.option.type,predicate:e.option.id},i=e.option.excluded),i?this.proxy._navimpl.excludeTag(t):this.proxy._navimpl.undoExcludeTag(t)},destroy:function(){e.is(that._listOfActiveTag,"array")&&this._listOfActiveTag.forEach(function(e){e.destroy()}),this.stopListening(),this._parent()}})}),define("DS/TagNavigator/simplified/activeTags/PredicateView",["UWA/Core","UWA/Class/View","DS/TagNavigator/TaggerNLS","DS/UIKIT/Input/Select","DS/TagNavigator/simplified/activeTags/AdvActiveTagView","DS/TagNavigator/simplified/utils/AdvancedFilterUtils","DS/TagNavigator/Predicate","DS/TagNavigator/simplified/activeTags/ActiveTagsUtils","DS/TagNavigator/TaggerSettings"],function(e,t,i,a,n,r,s,o,l){"use strict";return t.extend({tagName:"div",className:"predicate-tags tag-list-cont",setup:function(e){this._parent(e)},render:function(){let t=this;this.predicateInfo=this.getOption("predicateInfo"),this.mode=this.getOption("mode"),this.toShowHeader=this.getOption("toShowHeader"),this.predicate=Object.keys(this.predicateInfo)[0],this.filter=this.predicateInfo[this.predicate],this.exclude=this.getOption("exclude"),this.activeTags=0,this.activeTagView={},this.predId=this.predicate.split("/").pop(),this.predDispName=this.predId.contains("sixw:")?s.getPredicate(this.predId.replace("sixw:","")).displayName():s.getPredicate(this.predId).displayName();let n=this._getPredicateIcon(this.predicate),c=this.predId;this.tagsListCont=e.createElement("div",{class:"active-tags-list-container",styles:{display:"block"}}).inject(this.container),this.predicateLabelCont=e.createElement("div",{class:"predicate-label-cont "+t.mode}).inject(this.tagsListCont).hide(),e.createElement("span",{class:"w-icon fonticon fonticon-3ds-"+n}).inject(this.predicateLabelCont),e.createElement("div",{class:"object-predicate-label",text:t.predDispName}).inject(this.predicateLabelCont),this.predContainer=e.createElement("div",{class:"predicate-container"}).inject(this.tagsListCont),this.predContainer.setAttributes({predicate:c}),this.predicateTagsList=e.createElement("ul",{class:"active-predicate-list "});let d,g,u=this.getPredicateOperator(),h=[];if(l.getOption("toShowXOR")){d=u||r.OPERATOR_OR,this.predicateInfo[this.predicate].isComplex&&(g=o.getActualPredicates(this.predicateInfo[this.predicate]));let t=r.getIrrelevantPredicateOperator(this.predicate,g);r.operatorSupported.forEach(a=>{(t&&t.length&&!t.includes(a)||!t)&&h.push({value:i.getText("local_"+a),selected:!!e.equals(d,a)})})}else{d=u?u===r.OPERATOR_XOR?r.OPERATOR_OR:u:r.OPERATOR_OR;let t=r.getIrrelevantPredicateOperator(pred);r.operatorSupported.forEach(a=>{(t&&t.length&&!t.includes(a)||!t)&&h.push({value:i.getText("local_"+a),selected:!!e.equals(d,a)})})}return e.is(d)&&!this.predicate.contains("sixw:")&&(this.select=new a({className:"combo-operator hide",showTooltips:!0,placeholder:!1,options:h,predicate:t.predicate,events:{onChange:function(){let e=this.getValue()[0],a=r.getDefaultPredicateOperator(t.predId);switch(e){case i.getText("local_OR"):e=r.OPERATOR_OR;break;case i.getText("local_AND"):e=r.OPERATOR_AND;break;case i.getText("local_XOR"):e=r.OPERATOR_XOR}t.changeLocalOperator({predicate:t.predicate,operator:e,informView:a!==e}),t.updateLocalOperatorText(e)}}}).inject(this.predContainer)),this.predicateTagsList.inject(this.predContainer),this.updatePredicateView(),this},updatePredicateView:function(e){this.mode=e?e.mode:this.mode,e&&e.predicateInfo&&(this.old_filter=UWA.clone(this.filter),this.filter=e.predicateInfo[this.predicate]),this.toShowHeader=e?e.toShowHeader:this.toShowHeader,(this.toShowHeader||"writeable"==this.mode)&&this.predicateLabelCont.show(),this.createTagView()},getPredicateOperator:function(){return"object"==typeof this.filter&&(this.filter&&this.filter.operator)},updateLocalOperatorText:function(t){"XOR"!=t?this.container.getElement(".operator-text-xor")&&this.container.getElement(".operator-text-xor").destroy():e.createElement("span",{class:"tag-label operator-text-xor",text:i.getText("only")}).inject(this.predicateTagsList,"top");let a=this.container.getElements(".operator-text");a.length&&a.forEach(e=>{e.setText(i.getText(t))}),this.filter.operator=t},createTagView:function(){let t,a=this,n="writeable"==this.mode||"readOnly"==this.mode&&this.toShowHeader;this.old_filter||this.destroyAllActiveTagViews();let r=this.filter,s=this.old_filter;if((t=o.checkNewfilter(r,s,n)).newAddedFilters.length||t.oldFilters.length?!t.newAddedFilters.length&&t.oldFilters.length?(this.destroyAllActiveTagViews(),t=t.oldFilters):t=t.newAddedFilters:this.destroyAllActiveTagViews(),Array.isArray(t)&&t.length){this.show();let n=["string","boolean"];t.forEach((t,r)=>{let s;t.condition.display?s=t.condition.display:-1==n.indexOf(t.condition.type)&&(s=t.condition.display?t.condition.display:o._computeDateNls(UWA.clone(t.condition.object)));let l={};this.predicateInfo[this.predicate].isComplex?l={condition:t.condition,id:this.predicate,tagName:s}:((l=t.condition).id=this.predicate,l.tagName=s);let c=a._getActiveTagsOption(l),d=a._createActiveTagView(c);this.activeTags++,"XOR"==a.getPredicateOperator()&&1==a.activeTags?e.createElement("span",{class:"tag-label operator-text-xor",text:i.getText("only")}).inject(a.predicateTagsList):(a.toShowHeader||"writeable"==a.mode)&&a.getPredicateOperator()&&a.activeTags>1&&e.createElement("span",{class:"tag-label operator-text",text:i.getText(a.getPredicateOperator())}).inject(a.predicateTagsList),d.container.inject(a.predicateTagsList),this.activeTagView[c.attribute[0].unique_id]=d})}if(this.select){let e=this.activeTags>1&&"writeable"==this.mode;this.select.elements.container.toggleClassName("hide",!e)}},_createActiveTagView:function(e){let t=new n(e).render();return t.addEvent("removeActiveTag",this.dispatchRemoveEvent.bind(this)),t.addEvent("unexcludeTag",this.dispatchExcludeEvent.bind(this)),t.addEvent("excludeTag",this.dispatchExcludeEvent.bind(this)),t},dispatchRemoveEvent:function(e){let t=e.option;this.destroyActiveTagView(t),"writeable"==this.mode&&this.updateView(),this.dispatchEvent("removeTag",t)},updateView:function(){1==this.activeTags?this.select&&!this.select.elements.container.isHidden()&&this.select.elements.container.toggleClassName("hide",!0):this.select&&this.select.elements.container.isHidden()&&this.select.elements.container.toggleClassName("hide",!1)},dispatchExcludeEvent:function(e){let t=e.option;if("writeable"==this.mode){(e.option.condition?e.option.condition.excluded:e.option.excluded)&&this.destroyActiveTagView(e.option)}this.dispatchEvent("excludeTag",t)},addTag:function(t){let a=this._getActiveTagsOption(t),n=this._createActiveTagView(a);this.activeTags++,this.updateView(),"XOR"==this.getPredicateOperator()&&1==this.activeTags?e.createElement("span",{class:"tag-label operator-text-xor",text:i.getText("only")}).inject(this.predicateTagsList):this.getPredicateOperator()&&this.activeTags>1&&e.createElement("span",{class:"tag-label operator-text",text:i.getText(this.getPredicateOperator())}).inject(this.predicateTagsList),n.container.inject(this.predicateTagsList),this.activeTagView[a.attribute[0].unique_id]=n,this.show()},_getActiveTagsOption:function(e){let t;e.condition?((t=UWA.clone(e.condition)).id=e.id,t.tagName=e.tagName):t=UWA.clone(e);let i="";return"string"==typeof t.object?i=t.object.replaceAll(" ","_")+"_"+this.predicate:Array.isArray(t.object)&&(i=t.object.join("_")+"_"+this.predicate),{id:t.tagName.replace(" ","_")+"::"+t.id,text:t.tagName,isSimplified:!0,hasActions:this.exclude,hasExcludeSupport:this.exclude,isExcluded:t.excluded,condition:e,attribute:[{"predicate-name":this.predDispName,unique_id:i}],advancedProxy:!0,renderTo:!0}},_getPredicateIcon:function(e){return e.contains("ds6w:what")?"what":e.contains("ds6w:where")?"where":e.contains("ds6w:when")?"when":e.contains("ds6w:who")?"who":e.contains("ds6w:why")?"why":e.contains("ds6w:how")?"how":void 0},_computeDateNls:function(e){let t=e.from.split("/").reverse().join("/"),a=e.to.split("/").reverse().join("/");return t&&!a?i.getText("from")+": "+t:!t&&a?i.getText("to")+": "+a:t&&a?t+" - "+a:void 0},changeLocalOperator:function(e){this.dispatchEvent("updatePredicateOperator",e)},destroyActiveTagView:function(e){let t,i="";if(e.condition?((t=UWA.clone(e.condition)).id=e.id,t.tagName=e.tagName):t=UWA.clone(e),"string"==typeof t.object?i=t.object.replaceAll(" ","_")+"_"+this.predicate:Array.isArray(t.object)&&(i=t.object.join("_")+"_"+this.predicate),this.activeTagView[i]){let e=this.predicateTagsList.getElement("li.tag[unique_id='"+i+"'] + span.operator-text");return e?e.destroy():(e=this.predicateTagsList.getElements("span.tag-label").pop())&&e.destroy(),this.activeTagView[i].destroy(),delete this.activeTagView[i],this.activeTags--,this.activeTags||this.hide(),!0}return!1},destroyAllActiveTagViews:function(){this.hide(),this.activeTags=0,this.predicateTagsList.empty();for(let e in this.activeTagView)this.activeTagView[e].destroy();this.activeTagView={}},destroy:function(){this.stopListening(),this.destroyAllActiveTagViews(),this._parent()}})}),define("DS/TagNavigator/embeddedTagger/EmbeddedTaggerActiveCriteria",["UWA/Core","UWA/Class/View","DS/TagNavigator/ActiveCriteria","DS/TagNavigator/TaggerNLS","DS/TagNavigator/embeddedTagger/EmbeddedAdvancedActiveCriteria"],function(e,t,i,a,n){"use strict";return t.extend({tagName:"div",className:"embedded-tagger-active-tags",init:function(e){this._activeCriteriaView=void 0,this.proxy=e.proxy,this._parent(e)},setup:function(e){this._parent(e)},render:function(){this.container.hide(),this._activeCriteriaView=i._embeddedTaggerCreateActiveCriteriaView(this.container,!0),this.selectedTagsDiv=e.createElement("div",{class:"selected-tag",text:a.getText("activeTagsHeader")+":"}),this.clearBtn=e.createElement("div",{class:"section-header-left clear-active-tags"});e.createElement("span",{class:"fonticon fonticon-trash",styles:{display:"inline-block"}}).inject(this.clearBtn),e.createElement("span",{class:"clear-label",text:a.getText("clearActiveTags")}).inject(this.clearBtn);return this.clearBtn.addEventListener("click",this.clearRefine.bind(this)),this.proxy.getAdvancedOption("editTagsRelationships")&&(this.advActiveTags=new n({proxy:this.proxy}).render(),this.selectedTagsDiv.inject(this.container),this.advActiveTags.inject(this.container),this.clearBtn.inject(this.container)),this},redraw:function(t){if(this.proxy.getAdvancedOption("editTagsRelationships"))this.advActiveTags.redraw(),0==this.container.getElements("li.tag.selected").length?this.container.hide():this.container.show();else{var i=this.proxy?this.proxy.getNavImpl():null;if(i&&i.activeCriteriaProxy){let a=i.activeCriteriaProxy.redrawCriteria(t);if(a.isEmpty)this.container.hide();else{let t=e.createElement("div",{class:"all-criteria-list"}),i=e.createElement("ul",{class:"active-predicate-list"}).inject(t);this.container.innerHTML=a.generatedHtml,i.empty(!0),this.selectedTagsDiv.inject(this.container.getElement("#active-tags-list"),"before"),0==this.container.getElements("li.tag.selected").length?this.container.hide():(this.container.getElements("li.tag.selected").forEach((e,t)=>{e.inject(i)}),t.inject(this.container.getElement("#active-tags-list .innerForTransition")),this.clearBtn.inject(this.container),this.container.show())}}}},clearRefine:function(){let e={clearGrouping:!1},t=this.proxy?this.proxy.getNavImpl():null;t&&(t.dispatchEvent("ON_TAGGERVIEW_MASKED"),t.clearFilters(e))},destroy:function(){this.advActiveTags.destroy(),this.stopListening(),this._parent()}})}),define("DS/TagNavigator/embeddedTagger/EmbeddedRootWhoView",["UWA/Core","UWA/Class/Model","DS/TagNavigator/embeddedTagger/EmbeddedRootWView","DS/TagNavigator/TaggerNLS","DS/TagNavigator/Logger","DS/TagNavigator/UserSettings","DS/TagNavigator/simplified/utils/PersonUtils","DS/TagNavigator/embeddedTagger/EmbeddedMenuItem","DS/TagNavigator/Predicate"],function(e,t,i,a,n,r,s,o,l){"use strict";return i.extend({tagName:"div",className:"embedded-root-container embedded-who",init:function(e){this._parent(e);var t=this;r.getUserInfo().then(function(e){t.me=e.firstname+" "+e.lastname}),this._mapOfMenuItems={},this.updateImageCB=this.updateImage.bind(this)},setup:function(e){this._parent(e)},render:function(){return this.predicate=s.PERSON_PREDICATE,this.label=this.defaultValues.label?this.defaultValues.label:"Who",this.icon="fonticon-3ds-who",this.defaultValues.subLabel&&(this.subLabel=this.defaultValues.subLabel),this._parent()},redrawTags:function(e){var t=this;this.menuItems.forEach(function(e){e.destroy()}),this.menuItems=[],this._mapOfMenuItems={};var i=[];this.selectedItems=[];var n=[],r=s.getUsersInfo(this.navImpl,["ds6w:responsible","ds6w:lastModifiedBy"]),c=void 0;r.forEach((e,r)=>{var l=new o({model:e,navImpl:this.navImpl,isPreciseCount:this.isPreciseCount});l.addEvent("toggleSelection",this.onTagClick.bind(this)),t._mapOfMenuItems[e.get("title")]=e;var d=e.get("personInfo");d&&d.addEvent("onChange:imageURL",t.updateImageCB),t.me&&t.me===e.get("title")?(c=l,e.set("title",a.getText("me"))):i.push(l),l.render(),e.set("menu_identifier",l.getOption("identifier")),l.container.hasClassName("selected")&&(t.selectedItems.push(s.buildCondition(e)),n.push(e.get("title")))}),i.length||c?(this.container.removeClassName("disableW"),this.sortMenuItems(i),c&&i.unshift(c),this.menuItems=i,this.dropDownMenu&&this.dropDownMenu.destroy(),this.createDropdown()):this.container.addClassName("disableW");var d=l.getPredicate(this.predicate).displayName();this.defaultValues.subLabel||this.subLabel||(this.subLabel=d),this.updateSubLabelCall({subLabel:this.subLabel}),this.getElement(".button-text").removeClassName("hide-sub-label")},sortMenuItems:function(e){var t,i;return e.sort(function(e,a){var n,r;return n=e.model,r=a.model,t=n.getCount(),i=r.getCount(),t=t.exactCount?t.count:t,(i=i.exactCount?i.count:i)-t||e.model.get("title").localeCompare(a.model.get("title"))}),e},updateImage:function(e){if(this.dropDownMenu){let t=this._mapOfMenuItems[e.get("title")];if(t){let e=t.get("menu_identifier");if(e){let i=this.dropDownMenu.getItem(e).elements.container.getElement(".tag-image");i&&i.setAttributes({src:t.getImage()})}}}},onTagClick:function(e){var t=e.model;if(t){var i=s.buildCondition(t);this.navImpl.toggleComplexTagSelection(i)}this._parent(e)},getGroupingData:function(){var e,t,i=[],a={predicate:this.predicate,object:i},n=this.navImpl.getFocusedProxy().getGroupingConfig();return this.menuItems.forEach(function(a){e=a.model;var r={dispText:(t=s.buildCondition(e)).condition.display,type:t.condition.type};this._groupingFormatV2?(r.object={operator:t.condition.operator,predicates:t.condition.predicates,value:t.condition.value},t.isComplex&&(r.isComplex=!0),r.identifier=t.condition.object):(r.object=t.condition.value,r.predicate=t.condition.predicates.map(function(e){return e.predicate})),n.withIconInfo&&(r.iconInfo={image:e.getImage()}),i.push(r)}.bind(this)),a}})}),define("DS/TagNavigator/simplified/views/PersonListView",["UWA/Core","UWA/Class/View","DS/TagNavigator/simplified/views/PersonView","DS/TagNavigator/simplified/utils/PersonUtils","DS/TagNavigator/TagValue","DS/TagNavigator/Logger","DS/TagNavigator/TaggerNLS","DS/TagNavigator/TaggerSettings","DS/TagNavigator/Predicate","DS/TagNavigator/UserSettings","DS/MessageBus/MessageBus"],function(e,t,i,a,n,r,s,o,l,c,d){"use strict";return t.extend({tagName:"div",className:"people-list-div",personViewList:void 0,personModelList_global:void 0,init:function(e){this.personViewList=[],this._parent(e);var t=this.getOption("taggerView");this.navImpl=t.getObservedNavigator()},setup:function(e){this._parent(e)},render:function(){return this.ulList=e.createElement("ul",{class:"people-list"}).inject(this.container),this.moreDiv=e.createElement("div",{class:"show-more-container",id:"show-more-people",html:[{tag:"div",class:"show-more"}]}).inject(this.container).show(),this.moreDiv.addEventListener("click",this.clickOnShowMore.bind(this)),this},getPredicateId:function(){return this.getOption("predicates")[0]},hasEmbeddedTagger:function(){return this.navImpl.hasEmbeddedView()},clickOnShowMore:function(){var e=this.getOption("taggerView").getObservedNavigator();e.clickOnMoreButton(this.getPredicateId()),this.updatePeopleList(e),d.publish({channel:"TaggerTrackerApi",topic:"hit",data:{category:"6WTagger",action:"ClickOnViewMore",persDim:{pd1:this.getPredicateId()}}})},getFullPredicateId:function(){var e=this.getPredicateId();return l.getPredicate(e).getFullPredicateID(e)},redraw:function(){var e,t=this,i=this.getOption("taggerView").getObservedNavigator();if(this.hasAdvancedFocsuedProxy=this.getOption("hasAdvancedFocsuedProxy"),"person"==this.getPredicateId()){let t=[l.ROOT_WHO,l.getCommunityTagPredicate(l.ROOT_WHO).id(),l.getCompanyTagPredicate(l.ROOT_WHO).id()];e=this._getPreferredPredicates(this.hasAdvancedFocsuedProxy(i,a.PERSON_REFINE)).filter(function(e){return-1==t.indexOf(e)})}else e=this.getOption("predicates");var n=[];("string"==typeof e||Array.isArray(e)&&e.length>0)&&(n=a.getUsersInfo(i,e));var r={};0==n.length&&(r.isEmpty=!0),this.hasEmbeddedTagger()?c.getUserInfo().then(function(e){t.me=e.firstname+" "+e.lastname;for(var i=0;i<n.length;i++)if(t.me&&t.me==n[i].get("title")){n[i].set("title",s.getText("me")),t.meInfoModel=n[i];break}t._internalRedraw(r,n)}):this._internalRedraw(r,n)},_internalRedraw:function(e,t){var i=this.navImpl.getCache().getSearchValue();if(i){var a=i.toLowerCase();this.personModelList_global=t.filter(function(e){if(-1!==e.get("title").toLowerCase().indexOf(a))return e})}else this.personModelList_global=t;if(0!==this.personModelList_global.length||e.isEmpty||(e.hasNoResults=!0),this.sortPersonListView(this.navImpl),this.updatePeopleList(this.navImpl),"person"==this.getPredicateId()){if(this.personModelList_global.length>0){var n=this.container.getClosest("li.predicate");n.show(),n.getElement(".predicate-header .predicate-count").setText(this.personModelList_global.length)}this.getOption("taggerView").dispatchEvent("onFlattenedPersonListStatusUpdate",e)}},sortPersonListView:function(e){var t=e.getCache().getCurrentSort("ds6w:who/"+this.getPredicateId());if("alphaSort"==t.sortMode)t.order?this.personModelList_global=this.personModelList_global.sort(function(e,t){return e.get("title").localeCompare(t.get("title"))}):this.personModelList_global=this.personModelList_global.sort(function(e,t){return t.get("title").localeCompare(e.get("title"))});else if("nbSort"==t.sortMode){var i,a,n=function(e,t){let n=e.getCount(),r=t.getCount();i=n.exactCount?n.count:n,a=r.exactCount?r.count:r};t.order?this.personModelList_global=this.personModelList_global.sort(function(e,t){return n(e,t),i-a||e.get("title").localeCompare(t.get("title"))}):this.personModelList_global=this.personModelList_global.sort(function(e,t){return n(e,t),a-i||e.get("title").localeCompare(t.get("title"))})}},_getPreferredPredicates:function(e){var t;return e&&(t=e.hasRelevantPredicates()),t.filter(function(e){var t=l.getPredicate(e);if(t)return"ds6w:who"==t.get6WRootFather().id()})},updatePeopleList:function(e){var t=this;this.destroyPersonView();let n=e.getProxiesToDisplay();if(n.length&&n.some(e=>e.isFeatureSupported("grouping")))var r=function(t,i){return e.isGroupedBy(d,t,i)}.bind(this);var o=this.getOption("hasAdvancedFocsuedProxy")(e,a.PERSON_REFINE);if(UWA.is(this.personModelList_global,"array")&&this.personModelList_global.length>0){var l,c=!(!this.hasAdvancedFocsuedProxy(e,a.PERSON_REFINE)||"person"!=this.getPredicateId())||this.getOption("expandablePerson"),d=this.getPredicateId(),g=this.getFullPredicateId(d),u=e.getMoreLimitForPredicate(d),h=e.getCache().colorManager.isColorized(this.getFullPredicateId());this.hasEmbeddedTagger()&&this.getLoggedInPersonModel();for(var p=this.personViewList.length;p<this.personModelList_global.length&&p<u;p++){var f=this.personModelList_global[p];if(h)var m=f.get("tagValues"),v=e.getCache().colorManager.getColorForTagValue(m[0]);if(l=new i({model:f,navImpl:e,hasAdvancedFocsuedProxy:function(i){return t.getOption("hasAdvancedFocsuedProxy")(e,i)},setSpinner:function(){t.getOption("taggerView").setSpinner()},expandable:!(!this.hasAdvancedFocsuedProxy(e,a.PERSON_REFINE)||"person"!=this.getPredicateId())||this.getOption("expandablePerson"),getTaggerView:function(){return t.getOption("taggerView")},color:v||null}).render().inject(this.ulList),o)if(g==a.PERSON_REFINE_PREDICATE){var T=a.getActivePredicates(o,f.get("title")),C=f.getUniqueTagValuesPerPredicate(),w=[];for(var d in C){var b=C[d];w.push(b[0])}for(var y=0,S=0;S<w.length;S++){var E=w[S];-1!==T.indexOf(E.pred.getFullPredicateID())&&y++}y===w.length&&l.setAsSelected()}else e.isSelected(JSON.stringify(f.getRefineStructure()))&&l.setAsSelected();else(e.isSelected(JSON.stringify(f.getRefineStructure()))||r&&r(f.get("title")))&&(l.setAsSelected(),r&&r(f.get("title"))&&l.container.addClassName("grouped-by"));c&&1==f.get("expandStatus")&&l.setAsExpanded();var I=l.getElement(".item-count").getDimensions().width;l.getElement(".item-label").setStyle("width","calc(100% - "+(I+40)+"px)"),this.personViewList.push(l)}this.personModelList_global.length>7&&this.personViewList.length<this.personModelList_global.length?this.moreDiv.getElement(".show-more").setText(s.getText("showMore")+" ["+(this.personModelList_global.length-u)+"]").show():this.moreDiv.hide()}},getLoggedInPersonModel:function(){var e=this,t=this.personModelList_global.findIndex(function(t){return t==e.meInfoModel});-1!==t&&(this.personModelList_global.splice(t,1),this.personModelList_global.unshift(this.meInfoModel))},destroyPersonView:function(){this.personViewList.forEach(function(e){e.destroy(),e=null}),this.personViewList=[]},destroy:function(){this.destroyPersonView(),this.meInfoModel=void 0,this.stopListening(),this._parent()}})}),define("DS/TagNavigator/simplified/views/LoadOnDemandView",["UWA/Core","UWA/Class/View","DS/TagNavigator/TaggerNLS","DS/UIKIT/Input/Button","DS/Controls/Expander","DS/MessageBus/MessageBus","UWA/Event"],function(e,t,i,a,n,r,s,o){"use strict";return t.extend({tagName:"div",id:"tn-load-more-tags-message",className:"tn-load-more-tags-message",init:function(e){this._parent(e),this.container.setStyle("width","100%")},setup:function(e){this._parent(e)},render:function(){return this.taggerView=this.getOption("taggerView"),new a({value:i.getText("loadMoreTags"),icon:"fonticon fonticon-cloud-download",id:"load-more-tags-button"}).inject(this.container).addEvent("onClick",this.onLoadMoreTagsClick.bind(this)),this._parent()},destroy:function(){this.container.destroy()},onLoadMoreTagsClick:function(){this.dispatchEvent("tnLoadMoreTagsClick")},show:function(e){e?this.container.show():this.container.hide()}})}),define("DS/TagNavigator/simplified/views/DropdownMenu6W",["UWA/Core","DS/UIKIT/DropdownMenu","DS/TagNavigator/TaggerNLS","DS/UIKIT/Tooltip"],function(e,t,i,a){"use strict";return t.extend({init:function(e){this._parent(e)},closeOnClick:!1,defaultOptions:{items:[{name:"allw"},{className:"divider"},{name:"ds6w:what"},{name:"ds6w:where"},{name:"ds6w:who"},{name:"ds6w:when"},{name:"ds6w:how"},{name:"ds6w:why"}]}})}),define("DS/TagNavigator/simplified/views/TaggerTopBar",["UWA/Core","UWA/Class/View","text!DS/TagNavigator/assets/templates/TaggerTopBar.html","DS/Handlebars/Handlebars","DS/TagNavigator/TaggerNLS","DS/UIKIT/Tooltip","DS/TagNavigator/Predicate","DS/TagNavigator/Logger","DS/TagNavigator/UserSettings","DS/TagNavigator/TaggerSettings","DS/TagNavigator/simplified/views/DropdownMenu6W","DS/TagNavigator/simplified/views/RoundRootView","DS/MessageBus/MessageBus"],function(e,t,i,a,n,r,s,o,l,c,d,g,u){"use strict";return t.extend({tagName:"div",className:"tagger-topbar-container",template:a.compile(i),setup:function(e){this._parent(e)},domEvents:{"click .clear-search-tag":"clearSearchInput","click .type-icon-cnt":"showTypeIconDetails","click .tag-settings-cnt":"deactivateSimplifiedTagger"},render:function(){var e=this.template();this.container.setContent(e);var t=this;this.taggerView=this.getOption("taggerView"),this.roundRootViews={},this._attachUWATooltips(),this.searchField=this.getElement("#taginput"),this.searchField.addEventListener("keyup",this.onSearchInput.bind(this)),this.getElement(".search-tag").addEventListener("click",this.onSearchClick.bind(this)),!c.getOption("WebInWin")&&c.getOption("simplifiedTagger")||this.getElement(".tag-settings-cnt").hide(),c.getOption("typeIcons")||this.getElement(".type-icon-cnt").hide();let i=["allw","",...c.getOption("simplifiedRootW")],a=[];i.forEach(e=>{e?a.push({name:e}):a.push({className:"divider"})}),this.dropdownButton=this.container.getElement(".fonticon-tag-eye");var s=new r({position:"bottom",target:this.dropdownButton,body:n.getText("hideShow"),className:"tagger-filter-tooltip"});this.dropDownMenu=new d({target:this.dropdownButton,position:"bottom",className:"root-w-menu",closeOnClick:!1,events:{onShow:function(){t.dropdownButton.addClassName("active"),s.hide()},onHide:function(){6==t.taggerView._simplifiedSelectedRootWs.length&&t.dropdownButton.removeClassName("active"),s.show()}},items:a});for(var o=0;o<this.dropDownMenu.items.length;++o)if(1!==o){var l=this.dropDownMenu.items[o].name;this.roundRootViews[l]=new g({taggerView:this.getOption("taggerView"),rootw:this.dropDownMenu.items[o].name}).render(),t.roundRootViews[l].inject(this.dropDownMenu.items[o].elements.container),t.roundRootViews[l].addEvent("onRootWClick",t.onRootWSelect.bind(t))}var u=this.taggerView.getActiveRootW();return u&&this.enableAllWSelection(u),this},onRootWSelect:function(e){if(e){var t=e.activeW,i=e.isActive;"allw"==t?(i?this.setAllW():this.resetW(),this.taggerView._simplifiedSelectedRootWs=this.taggerView.getRootWs(),this.dropdownButton.removeClassName("active")):(this.dropDownMenu.elements.container.removeClassName("all-w-active"),this.roundRootViews.allw.container.removeClassName("active"),this.dropdownButton.addClassName("active"),0==this.taggerView._simplifiedSelectedRootWs.length&&(this.setAllW(),t="allw",this.taggerView._simplifiedSelectedRootWs=this.taggerView.getRootWs(),this.dropdownButton.removeClassName("active"))),this.dispatchEvent("onRootWSelection",t.replace("ds6w:",""))}this.taggerView._simplifiedSelectedRootWs.length?this.dropdownButton.addClassName("active"):this.dropdownButton.removeClassName("active")},setAllW:function(){for(var e in this.dropDownMenu.elements.container.addClassName("all-w-active"),this.roundRootViews)"allw"!==e&&this.roundRootViews[e].container.removeClassName("active")},resetW:function(){for(var e in this.dropDownMenu.elements.container.removeClassName("all-w-active"),this.roundRootViews)"allw"!==e&&this.roundRootViews[e].container.addClassName("active")},resetToOriginalW:function(e){for(var t in this.dropDownMenu.elements.container.removeClassName("all-w-active"),this.roundRootViews)e.includes(t)&&this.roundRootViews[t].container.addClassName("active")},enableAllWSelection:function(e){e.length==this.taggerView.getRootWs().length?(this.setAllW(),this.roundRootViews.allw.container.addClassName("active")):(e.forEach((e,t)=>{this.roundRootViews[e]&&this.roundRootViews[e].container.addClassName("active")}),this.dropdownButton.addClassName("active")),this.taggerView._simplifiedSelectedRootWs=e},addOpacity:function(){this.getElement("#filter-tags").toggleClassName("add-opacity",!0),this.getElement(".search-tag.tag-cntrl").toggleClassName("add-opacity",!0)},launchEditAction:function(){this.getElement(".edit-tag").hasClassName("active-edit-tag")||(this.getElement(".edit-tag").addClassName("active-edit-tag"),this.dispatchEvent("onTopBarEditClick","editTagRelationShip")),this.dispatchEvent("onTopBarEditClickTagger")},cancelEditActionCall:function(){this.dispatchEvent("cancelEditAction")},onSearchInput:function(e){var t=this.getElement("#taginput").value;this.sendSearchMetrics(t),""==t?this.dispatchEvent("onTopBarSearch",{searchText:""}):this.dispatchEvent("onTopBarSearch",{searchText:t,allWView:!0}),this.dispatchEvent("keyup_searchField",e)},sendSearchMetrics:function(e){this.to&&clearTimeout(this.to),e&&e.length&&(this.to=setTimeout(()=>{u.publish({channel:"TaggerTrackerApi",topic:"hit",data:{category:"6WTagger",action:"onSearchTag",persDim:{pd1:e}}})},1e3))},onSearchClick:function(e){if(this.getElement("#filter-tags").toggleClassName("hide-filter-input"),this.getElement("#filter-tags").hasClassName("hide-filter-input"))this.getElement("#filter-tags").setStyles({width:"0"});else{this.searchField.focus();var t=this.getElement("#tag-Controls").getDimensions().width;this.getElement("#filter-tags").setStyles({width:"calc(100% - "+t+"px)",right:t+"px"})}this.getElement("#filter-tags").hasClassName("hide-filter-input")&&this.searchField.value&&this.clearSearchInput()},clearSearchInput:function(e){this.searchField.value="",this.searchField.getClosest(".addClear")&&this.searchField.getClosest(".addClear").removeClassName("addClear"),this.searchField.focus(),this.dispatchEvent("onTopBarSearch",{searchText:""})},startEventListening:function(){this.handleSearchCB=this.handleSearch.bind(this),document.body.addEvent("keydown",this.handleSearchCB),document.body.addEvent("click",this.handleSearchCB)},handleSearch:function(e){if("click"==e.type)document.body.removeEvent("keydown",this.handleSearchCB),document.body.removeEvent("click",this.handleSearchCB),this.handleSearchCB=null;else{if("BODY"==e.target.tagName){var t=new Array;t.push(8),t.push(9),t.push(46),t.push(36),t.push(35),t.push(37),t.push(39);var i=0==e.keyCode?e.charCode:e.keyCode;(i>=48&&i<=57||i>=65&&i<=90||32==i||i>=97&&i<=122)&&(this.getElement("#filter-tags").hasClassName("hide-filter-input")&&this.getElement("#filter-tags").toggleClassName("hide-filter-input"),this.searchField.focus())}document.body.removeEvent("keydown",this.handleSearchCB),document.body.removeEvent("click",this.handleSearchCB),this.handleSearchCB=null}},showTypeIconDetails:function(){require(["DS/SimplifiedTaggerTests/TypeCategoriesInfo"],function(e){e()})},deactivateSimplifiedTagger:function(){l.setPreference({name:"simplified",value:!1,onComplete:function(){c.getOption("WebInWin")||location.reload()},onFailure:function(){o.warn("FAILED to de-activate the 6WTagger Beta")}})},_attachUWATooltips:function(){new r({position:"bottom",target:this.getElement(".search-tag"),body:n.getText("searchTag"),className:"tagger-filter-tooltip"}),new r({position:"bottom",target:this.getElement(".tagger-close"),body:n.getText("closeTagger"),className:"tagger-close-tooltip"}),new r({position:"bottom",target:this.getElement(".type-icon-cnt"),body:"Type Icons",className:"tagger-clearAllTags-tooltip"}),new r({position:"bottom",target:this.getElement(".tag-close"),body:n.getText("clearSearch"),className:"tagger-clear-tooltip"}),new r({position:"bottom",target:this.getElement(".tagger-settings"),body:n.getText("deactivate-simplified"),className:"tagger-settings-tooltip"})},setPlaceHolderText:function(e){if(this.searchField){s.getPredicate("ds6w:"+e);this.searchField.setAttributes({placeholder:n.getText("search")})}},destroy:function(){this.stopListening(),this.handleSearchCB=null,this.handleRemovalOfListenersCB=null,this._parent()}})}),define("DS/TagNavigator/embeddedTagger/EmbeddedSeparatorMenuItem",["UWA/Core","DS/TagNavigator/embeddedTagger/EmbeddedMenuItem"],function(e,t){"use strict";return t.extend({init:function(e){this._parent(e)},setup:function(e){this._parent(e)},render:function(){return this},addContent:function(){},isSeparator:function(){return!0},destroy:function(){this._parent()}})}),define("DS/TagNavigator/embeddedTagger/EmbeddedRootWhatView",["UWA/Core","UWA/Class/Model","UWA/Class/Collection","DS/WebappsUtils/WebappsUtils","DS/TagNavigator/embeddedTagger/EmbeddedRootWView","DS/TagNavigator/TaggerNLS","DS/TagNavigator/Logger","DS/TagNavigator/Predicate","DS/TagNavigator/TaggerSettings","DS/TagNavigator/embeddedTagger/EmbeddedWhatMenuItem","DS/TagNavigator/embeddedTagger/EmbeddedMenuItem","DS/TagNavigator/simplified/model/CriteriaModel","DS/TagNavigator/simplified/utils/CriteriaUtils","DS/UIKIT/DropdownMenu","text!DS/TagNavigator/assets/CriteriaInfo.json"],function(e,t,i,a,n,r,s,o,l,c,d,g,u,h,p){"use strict";return n.extend({tagName:"div",className:"embedded-root-container embedded-what",init:function(e){this._criteriaJSONInfo=JSON.parse(p),this._categoryView=l.getOption("embeddedCategories"),this._parent(e)},setup:function(e){this._parent(e)},render:function(){return this.predicate=u.TYPE_CATEGORIZATION,this.label=this.defaultValues.label?this.defaultValues.label:"What",this.icon="fonticon-3ds-what",this.defaultValues.subLabel&&(this.subLabel=this.defaultValues.subLabel),this._parent()},redrawTags:function(e){var t=this;this.menuItems.forEach(function(e){e.destroy()}),this.menuItems=[];var n,r=[],l=[];if(this.selectedItems=[],this._categoryView){var h=this._hasFocusedAdvProxy(this.navImpl,u.TYPE_CATEGORIZATION),p=u.getCriteriaInfo(this.navImpl,h);if(p&&p.length>0){for(var f=p.sortBy("count"),m=0;m<f.length;m++){var v=f[m],T=f[m].get("iconClass").replace("fonticon-",""),C=new c({model:v,navImpl:this.navImpl,rootClassId:T,isPreciseCount:this.isPreciseCount,eventsToListen:{toggleSelection:t.onTagClick.bind(t)}}).render();r.push(C)}r.sort(function(e,t){return t.model.get("count")-e.model.get("count")||e.model.get("title").localeCompare(t.model.get("title"))})}r.length?(this.container.removeClassName("disableW"),this.sortMenuItems(r),this.menuItems=r,this.dropDownMenu&&this.dropDownMenu.destroy(),this.createDropdown()):this.container.addClassName("disableW")}else{var w=new i([],{model:g}),b=this._criteriaJSONInfo.predicate_Mapping,y=this._criteriaJSONInfo.category_resources;this.proxy.eachTagValue(function(e,t){var i=e.getUri(),r=e.pred,o="ds6w:docExtension"==r.id(),l=b[r.id()][o?i.toUpperCase():i];if(l){var c=l.category,d=new g({title:e.getDisplayValue(),predicate:r,criteriaId:i,count:t});if(w.length?n=w.find(function(e){return e.get("title")===d.get("title")}):w.push(d),n)n.setAsComposite().add(d);else{if(l.iconClass)d.set("iconClass",l.iconClass);else if(l.image)d.set("imageURL",a.getWebappsBaseUrl()+"TagNavigator/assets/icons/type_icon/"+l.image);else{if(y[c])var u=y[c].parent?y[c].parent:y[c],h=y[u]?y[u].iconClass:u.iconClass;else h=l.iconClass;d.set("iconClass",h)}if(y[c]){u=y[c].parent?y[c].parent:y[c];h=y[u]?y[u].iconClass:u.iconClass,d.set("level","level1")}else h=l.iconClass,d.set("level","level0");d.set("rootIconClass",h),w.add(d)}}else s.log("Uncategorized item:"+i)}.bind(this),{allTagsOfType:b.active_predicates});var S=!!this.navImpl.getFocusedProxy()&&this.navImpl.getFocusedProxy().getLocalFilter();w.forEach(function(e,i){var a=!!S&&S.isSelected(u.buildCondition(e)),n=new d({model:e,navImpl:this.navImpl,selected:a,isPreciseCount:this.isPreciseCount}).render();if(n.addEvent("toggleSelection",t.onTagClick.bind(t)),r.push(n),a&&(this.selectedItems.push(u.buildCondition(e)),l.push(e.get("title"))),e.get("isComposite")){var s=e.getCount();n.updateCount(s)}},this),r.length||l.length?(this.container.removeClassName("disableW"),r.sort(function(e,t){return t.model.getCount()-e.model.getCount()||e.model.get("title").localeCompare(t.model.get("title"))}),this.menuItems=r,this.dropDownMenu&&this.dropDownMenu.destroy(),this.createDropdown()):this.container.addClassName("disableW")}if(o.getPredicate(this.predicate)){var E=o.getPredicate(this.predicate).displayName();this.defaultValues.subLabel||this.subLabel||(this.subLabel=E),this.updateSubLabelCall({subLabel:this.subLabel}),this.getElement(".button-text").removeClassName("hide-sub-label")}},sortMenuItems:function(e){return e.sort(function(e,t){if(!e.getOption("subMenuItems")&&!t.getOption("subMenuItems"))return t.model.getCount()-e.model.getCount()||e.model.get("title").localeCompare(t.model.get("title"))}),e},onTagClick:function(e){this._parent(e);var t=e.model;if(t)if(t.isContainer()){for(var i=t.get("subCategories"),a=this._hasFocusedAdvProxy(this.navImpl,u.TYPE_CATEGORIZATION).getLocalFilter(),n=0;n<i.length;n++){var r=u.buildCondition(i.at(n));a&&a.isSelected(r)&&a.toggle(r)}var s=u.buildCondition(t);this.navImpl.toggleComplexTagSelection(s)}else{(s=u.buildCondition(t)).treatEmbeddingFilter=!0,this.navImpl.toggleComplexTagSelection(s)}},_hasFocusedAdvProxy:function(e,t){var i=e?e.getFocusedProxy():this.hasFocusedProxy();if(i&&t&&i.getAdvancedOption(t))return i},_getIconInfo:function(e){var t="tn-"+e.get("level"),i=e.get("imageURL"),a=e.get("rootIconClass").replace("fonticon-","tn-");if(i)return{image:i,classes:t+" "+a};var n=e.get("iconClass");return n?{classes:"fonticon "+n+" "+t+" "+a}:void 0},getGroupingData:function(){var e=[],t=this,i={predicate:this.predicate,object:e},a=this.navImpl.getFocusedProxy().getGroupingConfig();if(this._categoryView){var n=function(e){var i=e.model,r=u.buildCondition(i),s={dispText:r.condition.display,object:{operator:r.condition.operator,predicates:r.condition.predicates,value:r.condition.value},type:r.condition.type};r.isComplex&&(s.isComplex=!0),s.identifier=r.condition.object,a.withIconInfo&&(s.iconInfo=t._getIconInfo(i));var o=e.getOption("subMenuItems");return o&&(s.subGroups=o.map(function(e){return n(e)})),s};i.object=this.menuItems.map(function(e){return n(e)})}else{var r,s;this.menuItems.forEach(function(t){if(r=t.model,(s=u.buildCondition(r)).isComposite){s.condition.value=s.condition.value[0].map(function(e){return e});var i=s.condition.predicates[0];s.condition.predicates=s.condition.value.map(function(e){return i})}var n={dispText:s.condition.display,object:s.condition.value,type:s.condition.type,predicate:s.condition.predicates.map(function(e){return e.predicate})};if(a.withIconInfo){var o="tn-"+r.get("level"),l=r.get("imageURL"),c=r.get("rootIconClass").replace("fonticon-","tn-");if(l)n.iconInfo={image:l,classes:o+" "+c};else{var d=r.get("iconClass");d&&(n.iconInfo={classes:"fonticon "+d+" "+o+" "+c})}}e.push(n)})}return i}})}),define("DS/TagNavigator/embeddedTagger/EmbeddedWhenMenuItem",["UWA/Core","UWA/Utils","DS/TagNavigator/TaggerNLS","DS/TagNavigator/embeddedTagger/EmbeddedMenuItem","DS/Controls/Label","DS/TagNavigator/TaggerSettings"],function(e,t,i,a,n,r){"use strict";return a.extend({_secondaryLabel:null,init:function(e){this._parent(e)},setup:function(e){this.isPreciseCount=e.isPreciseCount,this._parent(e)},render:function(){return this._parent(),this.container.setAttributes({id:this.model.id}),this},addContent:function(){this.container.getElement(".tag-icon").setStyle("display","none"),this.container.getElement(".tag-image").setAttributes({src:this.model.get("imageURL")}),this.container.getElement(".tag-image").setStyles({"border-radius":"0"}),this.container.getElement(".image-div").setStyle("display","inline-block");var e=this.container.getElement(".tag-label");e.setText(this.model.get("title")),r.getOption("dateTagsWithGMT")&&(this._secondaryLabel=new n({value:i.getText("gmt"),emphasize:"secondary"}).inject(e),this._secondaryLabel.getContent().addClassName("tn-gmt"));var a=this.container.getElement(".tag-count");if(a){var s=this.model.get("count");a.setText(i.convertToUnity(s,this.isPreciseCount)),0==s&&this.container.addClassName("item-disabled")}this.model.get("isSelected")&&this.container.addClassName("selected"),this.setOption("identifier",t.getUUID().substr(0,6))},destroy:function(){this.stopListening(),this.model=null,this._secondaryLabel&&this._secondaryLabel.destroy(),this._parent()}})}),define("DS/TagNavigator/embeddedTagger/EmbeddedRootWhereView",["UWA/Core","UWA/Class/Model","DS/TagNavigator/embeddedTagger/EmbeddedRootWView","DS/TagNavigator/embeddedTagger/EmbeddedSeparatorMenuItem","DS/TagNavigator/embeddedTagger/EmbeddedPlaceholderMenuItem","DS/TagNavigator/embeddedTagger/EmbeddedWhereMenuItem","DS/TagNavigator/embeddedTagger/Embedded3DEXPERIENCEMenuItem","DS/TagNavigator/TaggerNLS","DS/TagNavigator/TagValue","DS/TagNavigator/Logger","DS/TagNavigator/TaggerSettings","DS/TagNavigator/simplified/utils/LocationUtils","DS/TagNavigator/Predicate","DS/TagNavigator/simplified/model/TagValueModel","DS/TagNavigator/simplified/model/ContinentModel"],function(e,t,i,a,n,r,s,o,l,c,d,g,u,h,p){"use strict";return i.extend({tagName:"div",className:"embedded-root-container embedded-where",init:function(e){this._parent(e),g.ensurePredicates(this.navImpl.getTagsServerForUserInfo()),this._hierarchyView=d.getOption("geolocationHierarchy"),this._3DEXPERIENCEAsContinent=d.getOption("3DEXPERIENCEAsContinent"),this._hasContinents=!1},setup:function(e){this._parent(e)},render:function(){return this.predicate=this.groupedPredicate=g.COMPUTED_COUNTRY_INFO,this.label=this.defaultValues.label?this.defaultValues.label:"Where",this.icon="fonticon-3ds-where",this.defaultValues.subLabel&&(this.subLabel=this.defaultValues.subLabel),this._parent()},redrawTags:function(e){this._isReadyToUpdateGroupings=!0;var i=this;if(this.menuItems.forEach(function(e){e.destroy()}),this.menuItems=[],this.proxy.getAdvancedOption(g.DATA_LOCATION)){this.selectedItems=[];var n=g.computeGeoLocations(this.navImpl,["ds6w:responsible"],function(e){c.log("EmbeddedWhere: redrawTags after computeGeoLocations"),i.redrawTags()},!0);if(this.container.addClassName("disableW"),this.navImpl.isGroupedBy(g.COMPUTED_COUNTRY_INFO)&&0!=n.pending&&(this._isReadyToUpdateGroupings=!1),this._hierarchyView){var o=i.navImpl.getTagsServerForUserInfo(),d=g.computedCountryInfo.getFullPredicateID(),h=[];if(n.continents.forEach(function(e){var t,a,n=e.get("title");e.getCountries().forEach(function(i,r){t=l.getTagValue({count:i.getCount(),type:"string",object:[e.id,i.id],dispValue:[n,i.get("title")],sixw:d,icon:i.get("imageURL")},null,null,null,null,o),0==r&&t.parent.clearEmbeddedTagValues(),t.setEmbeddedSixW(g.countryPredicate),a=i.getPersons(),t.setEmbeddedTagValues(a)});var s=new r({model:e,navImpl:i.navImpl,isPreciseCount:i.isPreciseCount,eventsToListen:{toggleSelection:i.onTagClick.bind(i)}}).render();h.push(s)}),h.sort(function(e,t){return t.model.getCount()-e.model.getCount()||e.model.get("title").localeCompare(t.model.get("title"))}),this.menuItems=h,this._hasContinents=this.menuItems.length>0,this._3DEXPERIENCEAsContinent){var p=new s({model:new t({title:"3DEXPERIENCE",iconClass:"fonticon fonticon-3ds",is3DEXPERIENCE:!0}),navImpl:i.navImpl,isPreciseCount:i.isPreciseCount,eventsToListen:{toggleSelection:i.onTagClick.bind(i)}}).render(),f=p.getOption("subMenuItems");f&&f.length>0?(this._hasContinents&&this.menuItems.unshift(new a({}).render()),this.menuItems.unshift(p)):(p.destroy(),p=null)}this.dropDownMenu&&this.dropDownMenu.destroy(),this.createDropdown(),this.menuItems.length&&this.container.removeClassName("disableW"),this._updateGroupingsWhenReady&&(c.log("view is now ready for grouping update, sending the event..."),this.dispatchEvent("updateGroupings"))}else{var m=n.continents,v=[];m.forEach(function(e){v=v.concat(e.getCountries())});o=i.navImpl.getTagsServerForUserInfo(),d=g.computedCountryInfo.getFullPredicateID(),h=[];v.forEach(function(e){var t=l.getTagValue({count:0,type:"string",object:e.get("title"),sixw:d},null,null,null,null,o);t.setEmbeddedSixW(g.countryPredicate),t.setEmbeddedTagValues(e.getPersons()),i.navImpl.isSelected(t)&&e.set("isSelected",!0);var a=new r({model:e,navImpl:i.navImpl,isPreciseCount:i.isPreciseCount}).render();a.addEvent("toggleSelection",i.onTagClick.bind(i)),h.push(a),h.sort(function(e,t){return t.model.getCount()-e.model.getCount()||e.model.get("title").localeCompare(t.model.get("title"))})}),this.menuItems=h,this.dropDownMenu&&this.dropDownMenu.destroy(),this.createDropdown(),this.menuItems.length&&this.container.removeClassName("disableW")}}var T=u.getPredicate(this.predicate).displayName();this.defaultValues.subLabel||this.subLabel||(this.subLabel=T),this.updateSubLabelCall({subLabel:this.subLabel}),this.getElement(".button-text").removeClassName("hide-sub-label")},updateGroupingUX:function(){this.navImpl.isGroupedBy(g.COMPUTED_COUNTRY_INFO)||this.navImpl.isGroupedBy("ds6w:dataSource")?this.activateGroupingUX():this.deactivateGroupingUX()},onGroupingChange:function(e,t){UWA.is(t,"object")&&t.predicate?this.groupedPredicate=t.predicate:e&&!this.isGroupedBy()&&(this.groupedPredicate=g.COMPUTED_COUNTRY_INFO),this._parent(e,t)},_getTagIdForFilter:function(e){if(e instanceof h){var t=e.get("tagValue");return{predicate:t.pred.getFullPredicateID(),object:t.getUri(),dispValue:e.get("title"),type:"string"}}return{predicate:g.computedCountryInfo.getFullPredicateID(),object:this._hierarchyView?e.get("tagsHierarchy"):e.get("title"),dispValue:e.get("title"),type:"string"}},onTagClick:function(e){this._parent(e);var t=e.model;if(t)if(t.get("is3DEXPERIENCE"))this.groupedPredicate="ds6w:dataSource",this.onGroupingChange(void 0,{predicate:this.groupedPredicate});else{var i=this._getTagIdForFilter(t);this.navImpl.toggleTagSelection(i)}},_getIconInfo:function(e){var t=e.get("imageURL");return t?{image:t}:e.get("iconClass")?{classes:e.get("iconClass")}:void 0},_groupByGeolocation:function(e){var t=this,i=function(a){var n=a.model,r=g.buildConditionFromModel(n),s={dispText:r.condition.display,object:{operator:r.condition.operator,predicates:r.condition.predicates,value:r.condition.value},type:r.condition.type};r.isComplex&&(s.isComplex=!0),s.identifier=r.condition.object,e.withIconInfo&&(s.iconInfo=t._getIconInfo(n));var o=a.getOption("subMenuItems");return o&&(s.subGroups=o.map(function(e){return i(e)})),s},a=[];return this.menuItems.forEach(function(e){e.model&&!e.model.get("is3DEXPERIENCE")&&a.push(i(e))}),a},_groupByDataSource:function(e){var t=this;if(this.menuItems.length){var i=this.menuItems[0];if(i.model.get("is3DEXPERIENCE")){var a=i.getOption("subMenuItems")||[],n=u.getPredicate("ds6w:dataSource").getType(),r=function(i){var a=i.model,s={dispText:a.get("title"),object:a.get("tagValue").getUri(),type:n};if(e.withIconInfo){var o=t._getIconInfo(a);o&&(s.iconInfo=o)}var l=i.getOption("subMenuItems");return l&&(s.subGroups=l.map(function(e){return r(e)})),s};return a.map(function(e){return r(e)})}}},getGroupingData:function(){var e,t,i=[],a={predicate:this.groupedPredicate,object:i},n=this.navImpl.getFocusedProxy().getGroupingConfig();this._hierarchyView?(this._hasContinents||(this.groupedPredicate="ds6w:dataSource"),"ds6w:dataSource"==this.groupedPredicate?(a.predicate=this.groupedPredicate,a.object=this._groupByDataSource(n)):a.object=this._groupByGeolocation(n)):this.menuItems.forEach(function(a){e=a.model;var r={dispText:(t=g.buildConditionFromModel(e)).condition.display,object:t.condition.value,type:t.condition.type,predicate:t.condition.predicates.map(function(e){return e.predicate})};if(n.withIconInfo){var s=e.get("imageURL");r.iconInfo=s?{image:s}:{classes:e.get("iconClass")}}i.push(r)});return a}})}),define("DS/TagNavigator/userTags/UserTagsView",["UWA/Core","UWA/Class/View","DS/TagNavigator/TaggerNLS","DS/TagNavigator/userTags/UserTagsModel","DS/TagNavigator/Logger","DS/WUXAutoComplete/AutoComplete","DS/Tree/TreeDocument","DS/Tree/TreeNodeModel","DS/TagNavigator/TagsServer","DS/TagNavigator/TaggerSettings","DS/TagNavigator/userTags/utils/UserTagsUtils","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/TagNavigator/simplified/utils/OntologyUtils","DS/TagNavigator/TagValue"],function(e,t,i,a,n,r,s,o,l,c,d,g,u,h){"use strict";return t.extend({tagName:"div",className:"user-tags-view",init:function(e){if(this._displaySuggestionWithType=c.getOption("displaySuggestionWithType"),e=e||{},!UWA.is(e.onCommit,"function"))throw new Error("MANDATORY CBs not provided for UserTagsView");if(this._parent(e),this.onCompleteAction=e.onCommit,this.setPopupWidth=e.onSuggestDisplayed,!(this.model instanceof a))throw new Error("INVALID model for UserTagsView");this.listenTo(this.model,{"onChange:subjects":this._updateSubjects,"onChange:platformId":this._updateTenant,"onChange:readOnly":this._updateReadOnlyMode,"onChange:applicativeSuggestions":this._updateApplicativeSuggestions,"onChange:rootWs":this._updateAllowedRootWs,"onChange:freeInput":this._updateFreeInputMode})},setup:function(e){this._parent(e)},render:function(){var t=this,a=this.getOption("labelInfo");if(UWA.is(a,"object")&&a.title){var o=e.createElement("label",{text:a.title}).inject(this.container);a.required&&e.createElement("span",{class:"label-field-required",text:" *"}).inject(o)}this.treeDocument=new s({shouldBeSelected:function(e){let t=!0;return e.getAttributeValue("isEnterpriseConcept")&&(t=e.getAttributeValue("shouldBeSelected")),t}});var l=this.getOption("suggestsInfo");return this._autoComplete=new r({touchMode:this.model.get("touchMode"),allowFreeInputFlag:this.model.get("freeInput"),selectedItems:[],displayCustomNodeInDropDown:!1,multiSearchMode:!0,placeholder:l?l.placeHolder:i.getText("userTagPlaceholder"),elementsTree:this.treeDocument,customFilterMessage:l?l.filterMessage:i.getText("typeName"),filterCB:function(e){e&&(e=e.trim()),n.log("inside filterCB, text="+e),t._allowTemporarySuggestions()?(t.treeDocument.prepareUpdate(),t._removeTempModels(),e&&t._addTempModels(e),t.treeDocument.pushUpdate()):n.log("tree text suggestions are disabled"),t.treeDocument.setFilterModel({label:{filterId:"stringRegexp",filterModel:{condition1:{type:"contains",filter:e}},filterOptions:{ensureVisible:!0}}})}}).inject(this.container),this._autoComplete.addEventListener("change",t._onChange.bind(t)),this._autoComplete.addEventListener("show",t._onShow.bind(t)),this._applyProperties(),this.onCreateResponse={},this},_applyProperties:function(){var e=this.model.get("subjects");UWA.is(e,"array")&&this._updateSubjects(this.model,e);var t=this.model.get("applicativeSuggestions");UWA.is(t,"array")&&this._updateApplicativeSuggestions(this.model,t);var i=this.model.get("platformId");i&&this._updateTenant(this.model,i);var a=this.model.get("readOnly");UWA.is(a,"boolean")&&this._updateReadOnlyMode(this.model,a);var n=this.model.get("rootWs");this._updateAllowedRootWs(this.model,n);var r=this.model.get("freeInput");UWA.is(r,"boolean")&&this._updateFreeInputMode(this.model,r)},_onChange:function(e){if(!this._allowTemporarySuggestions()){var t=[];UWA.is(this._autoComplete.selectedItems,"array")&&(t=this._autoComplete.selectedItems.filter(function(e){return e.getAttributeValue("isValid")})),t.length!==this._autoComplete.selectedItems.length&&setTimeout(function(){this._autoComplete.selectedItems=t}.bind(this),100)}this._addRootIcon();let i=this.getOption("onSelectionChange");i&&i(this._autoComplete.selectedItems.length)},_onShow:function(e){var t=document.querySelector(".wux-controls-autoComplete-popup .wux-controls-autoComplete-dataGridViewContainer");this.setPopupWidth&&this.setPopupWidth(t)},_getExistingSubjectTags:function(){var e=this.treeDocument.getRoots(),t={};return e.forEach(function(e){e.getAttributeValue("isExisting")&&(t[this._getKeyFromModel(e)]=e)}.bind(this)),t},_addNarrowerConcepts:function(e){let t=e.getAttributeValue("object"),i=u.getConcept(t);if(i){e.setAttribute("shouldBeSelected",!!i.canBeTagged());let t=i.getNarrowerConcepts();if(UWA.is(t,"array")){let i=e.getAttributeValue("predicate");t.forEach(function(t){let a={label:t.getLabel(),grid:{object:t.id,isValid:!0,predicate:i,isApplicative:!0,isConcept:!0,isEnterpriseConcept:e.getAttributeValue("isEnterpriseConcept"),shouldBeSelected:!!t.canBeTagged()}},n=new o(a);e.addChild(n),this._addNarrowerConcepts(n)}.bind(this))}}else n.error("concept Model not found for "+t)},_addTypeInformation:function(e){let t;e.grid.isCommunityTag?t=" (isCommunityTag)":e.grid.isEnterpriseConcept&&(t=" (isEnterpriseConcept)"),t&&(e.label=e.label+t)},_updateApplicativeSuggestions:function(e,t){n.log("applicative suggestions="+JSON.stringify(t)),this._removeApplicativeModels();var i=this._getExistingSubjectTags(),a=[];t&&(function(e){var t=[];return c.getOption("simplifiedRootW").forEach(function(i){var a=e.filter((e,t)=>{if(e.sixw&&e.sixw==i)return e});t=t.concat(a)}),t}(t).forEach(function(e){if(e.sixw&&e.object)if(i[e.sixw+e.object])n.log("applicative suggestion is an existing subject tag: predicate="+e.sixw+", title="+e.object);else{let t,i=e.isEnterpriseOntologySuggestion;if(i&&(t=u.getEnterpriseOntologyTreeModel(e.object)),!t){let a={label:e.label?e.label:e.dispValue?e.dispValue:e.object,grid:{object:e.object,isValid:!0,predicate:e.sixw,isApplicative:!0},icons:[{iconName:"6w-"+e.sixw.split(":")[1],fontIconFamily:WUXManagedFontIcons.font3DS}]};a.grid.isConcept=i,a.grid.isEnterpriseConcept=i,a.grid.isExplicitTagSuggestion=e.isExplicitTagSuggestion,i&&(a.grid.isRootConcept=!0),a.grid.isCommunityTag=e.isCommunityTag,this._displaySuggestionWithType&&this._addTypeInformation(a),a.grid.isCommunityTag?a.icons.push({iconName:"topbar-users",fontIconFamily:WUXManagedFontIcons.font3DS}):a.grid.isEnterpriseConcept&&a.icons.push({iconName:"logo-3ds-company",fontIconFamily:WUXManagedFontIcons.font3DS}),t=new o(a),i&&(u.setEnterpriseOntologyTreeModel(a.grid.object,t),this._addNarrowerConcepts(t)),e.isExplicitTagSuggestion&&this.setExplicitTagSuggestionsChildren(t,e,e.sixw),t.onSelect(function(){n.log(this.getLabel()+" is selected -> applicative suggestion")})}a.push(t)}else n.log("invalid applicative suggestion ignored")}.bind(this)),a.length&&this.mergeSuggestions(a,"isApplicative"))},setExplicitTagSuggestionsChildren:function(e,t,i){let a=t.children;Array.isArray(a)&&a.forEach(t=>{let a={label:t.label?t.label:t.object,grid:{object:t.object,isValid:!0,predicate:i,isApplicative:!0,isExplicitTagSuggestion:!0}},n=new o(a);e.addChild(n),this.setExplicitTagSuggestionsChildren(n,t,i)})},_allowTemporarySuggestions:function(){var e=!0,t=this.getOption("suggestsInfo");return t&&UWA.is(t.allowFreeText,"boolean")&&(e=t.allowFreeText),e},_enableVocabSuggestions:function(){var e=!0,t=this.getOption("suggestsInfo");return t&&UWA.is(t.vocabSuggestions,"boolean")&&(e=t.vocabSuggestions),e},_isASelectedTempModel:function(e,t){if(this._autoComplete.selectedItems)return-1!=this._autoComplete.selectedItems.findIndex(function(i){if(i.getAttributeValue("isTemporary")&&i.getLabel()===e&&i.getAttributeValue("predicate")==t)return!0})},_addTempModels:function(e){var t=this,i=d.getTextForDefaultSuggestions(e);if(u.hasConcepts()){let e=this.model.get("subjects");if(Array.isArray(e)){let t=c.getOption("supportedSourcesForCompanyTags");if(e.some(function(e){return-1!=t.indexOf(d.getSourceFromSubjectURI(e.uri))})&&u.isConceptAvailable(i))return}}var a=this.model.get("rootWs").slice();this.treeDocument.getRoots().filter(function(e){var t=e.getLabel();if(UWA.is(t,"string")&&t===i)return e}).forEach(function(e){var t=a.indexOf(e.getAttributeValue("predicate"));t>-1&&a.splice(t,1)}),a.forEach(function(a){if(!t._isASelectedTempModel(e,a)){var r=new o({label:i,grid:{object:i,isValid:!0,predicate:a,isTemporary:!0},icons:[{iconName:"6w-"+a.split(":")[1],fontIconFamily:WUXManagedFontIcons.font3DS}]});r.onSelect(function(){n.log(this.getLabel()+" is selected")}),t.treeDocument.addRoot(r)}})},_removeTempModels:function(e){var t=this;e&&this.treeDocument.prepareUpdate();var i=this.treeDocument.getRoots(),a=[];i.forEach(function(e){e.getAttributeValue("isTemporary")&&(e.isSelected()||a.push(e))}),a.forEach(function(e){t.treeDocument.removeRoot(e),n.log("Removing "+e.getLabel())}),e&&this.treeDocument.pushUpdate()},_removeVocabModels:function(e){var t=this;e&&this.treeDocument.prepareUpdate();var i=this.treeDocument.getRoots(),a=[];i.forEach(function(e){e.getAttributeValue("isVocabSuggestion")&&a.push(e)}),a.forEach(function(e){t.treeDocument.removeRoot(e),n.log("Removing "+e.getLabel())}),e&&this.treeDocument.pushUpdate()},_removeApplicativeModels:function(e){var t=this;e&&this.treeDocument.prepareUpdate();var i=this.treeDocument.getRoots(),a=[];i.forEach(function(e){e.getAttributeValue("isApplicative")&&a.push(e)}),a.forEach(function(e){t.treeDocument.removeRoot(e),n.log("Removing "+e.getLabel())}),e&&this.treeDocument.pushUpdate()},_addRootIcon:function(t){var i=this._autoComplete._selectionChips.elements.container.getElementsByClassName("wux-chip-cell-container");if(i.length==this._autoComplete.selectedItems.length)for(var a=0;a<i.length;a++){if(!i[a].getElement("span.tn-rootw-icon")){let t=this._autoComplete.selectedItems[a].getAttributeValue("predicate");if(t){var n=t.split(":")[1];e.createElement("span",{class:"fonticon fonticon-3ds-"+n+" tn-rootw-icon"}).inject(i[a].getElement(".wux-chip-cell-label"),"before")}}if(this._autoComplete.selectedItems[a].getAttributeValue("isCommunityTag")){if(!i[a].getElement("span.tn-community-icon"))e.createElement("span",{class:"tn-community-icon fonticon fonticon fonticon-users-alt"}).inject(i[a].getElement(".wux-chip-cell-label"),"after")}else if(this._autoComplete.selectedItems[a].getAttributeValue("isEnterpriseConcept")){if(!i[a].getElement("span.tn-enterprise-icon"))e.createElement("span",{class:"tn-enterprise-icon fonticon fonticon fonticon-3ds"}).inject(i[a].getElement(".wux-chip-cell-label"),"after")}}},_updateSubjects:function(e,t){var i=this,a=t||this.model.get("subjects")||[],r={};this._manageDirtyState()&&a.length>1&&(a=[a[0]],n.warn("with manageDirtyState as true, we only consider the first subject from the list")),a.forEach(function(e){if(e.service||(e.service="6WTags"),UWA.is(e.tags,"array")){for(var t in e.tags.forEach(function(t){var a=t.sixw,n=t.object,s=a+n;if(l=r[s])l.options.grid.subjects.push(e.uri);else{var l=new o({label:n,grid:{object:n,isValid:!0,predicate:a,isExisting:!0,subjects:[e.uri]},icons:[{iconName:"6w-"+a.split(":")[1],fontIconFamily:WUXManagedFontIcons.font3DS}]});r[s]=l,l.onSelect(function(){}),i.treeDocument.addRoot(l)}}),i._autoComplete.selectedItems=[],i.treeDocument.prepareUpdate(),r)r[t].select();i.treeDocument.pushUpdate()}})},_updateAllowedRootWs:function(e,t){var i=c.getOption("simplifiedRootW");UWA.is(t,"array")?t.length>0&&this.model.set("rootWs",t.filter(function(e){return-1!==i.indexOf(e)})):this.model.set("rootWs",i)},_updateTenant:function(e,t){var i=this;this.cs=void 0,this.ts=void 0,UWA.is(t,"string")?(g.getServiceUrl({serviceName:"6WTags",platformId:t,onComplete:function(e){i.ts=new l(e,t,t),i._updateVocabularySuggestions(i.ts)},onFailure:function(){n.error("FAILED to retrieve 6WTags url for tenant: "+t)}}),g.getServiceUrl({serviceName:"3DSpace",platformId:t,onComplete:function(e){i.cs=new l(e,t,t)},onFailure:function(){n.error("FAILED to retrieve 3DSpace url for tenant: "+t)}})):UWA.is(t,"object")?(t.cStorageUrl&&(this.cs=new l(t.cStorageUrl,t.id,t.displayName)),t.tagsServerUrl&&(this.ts=new l(t.tagsServerUrl,t.id,t.displayName)),i._updateVocabularySuggestions()):n.error("invalid platformId:"+t)},_updateVocabularySuggestions:function(e){if(this._enableVocabSuggestions()){var t=this,i=[];d.getVocabularySuggestions({tagsServer:e||this.cs||this.ts}).then(function(e){n.log("suggestions="+JSON.stringify(e)),t._removeVocabModels(),e.forEach(function(e){var t=Object.keys(e)[0];e[t].literalInfo.forEach(function(e){var a=new o({label:e.value,grid:{object:e.value,isValid:!0,predicate:t,isVocabSuggestion:!0},icons:[{iconName:"6w-"+t.split(":")[1],fontIconFamily:WUXManagedFontIcons.font3DS}]});a.onSelect(function(){}),i.push(a)})}),i.length&&t.mergeSuggestions(i,"isVocabSuggestion")})}else n.log("vocab suggestions are disabled")},mergeSuggestions:function(e,t){var i=this,a=this.treeDocument.getRoots(),n=[],r=[],s=[];let o=c.getOption("simplifiedRootW"),l=function(e){o.forEach((t,a)=>{e.filter(e=>e.getAttributeValue("predicate")==t).sort(function(e,t){return e.getLabel().toUpperCase().localeCompare(t.getLabel().toUpperCase())}).forEach((e,t)=>{i.treeDocument.addRoot(e)})})};if(a.length>0){let o;a.forEach((e,t)=>{e.getAttributeValue("isVocabSuggestion")?n.push(e):e.getAttributeValue("isApplicative")?r.push(e):e.getAttributeValue("isTemporary")&&s.push(e)}),this.treeDocument.empty();const c=(e,t)=>{const a=new Set(t.map(e=>i._getKeyFromModel(e)));return[...e.filter(e=>!a.has(i._getKeyFromModel(e))),...t]};"isVocabSuggestion"==t&&r.length>0?o=c(e,r):"isApplicative"==t&&n.length>0&&(o=c(e,n)),l(o),s.length>0&&s.forEach((e,t)=>{i.treeDocument.addRoot(e)})}else l(e)},_updateReadOnlyMode:function(e,t){this._autoComplete.disabled=t,t?this.container.addClassName("disabledState"):this.container.removeClassName("disabledState")},_updateFreeInputMode:function(e,t){this._autoComplete.allowFreeInputFlag=t},_getKeyFromModel:function(e){return e.getAttributeValue("predicate")+e.getLabel()},computeOnCreateResponse:function(e){var t=this;e&&UWA.is(e,"array")&&e.forEach(function(e){e.tag?t.onCreateResponse[e.subject.uri]=d.computeonSuccessCreateResponse(e.tag):e.error&&(t.onCreateResponse[e.subject.uri]=d.computeonFailureCreateResponse(e.error))})},computeCreateCallStatus:function(){var e=[];for(var t in this.onCreateResponse)"success"==this.onCreateResponse[t].status?e.push(!0):e.push(!1);let i=e.every(function(e,t,i){return 0===i.indexOf(e)});this.onCreateResponse.status=i?1==e[0]?"success":"failure":"partial"},dispatchResponse:function(e){var t=this,i={};e.forEach(function(e){var a=e.data,n=e.request;"create"==n&&(t.computeOnCreateResponse(a),t.computeCreateCallStatus(),i[n]=t.onCreateResponse)}),this.onCreateResponse={},t.onCompleteAction(i)},_buildTagInfoToPersist:function(e,t){let i=e.getAttributeValue("object");var a={subject:t,predicate:e.getAttributeValue("predicate"),object:{}};if(e.getAttributeValue("isCommunityTag"))a.object.literal=d.buildCommunityTagInfo(e).object,n.log("literal for community tag="+a.object.literal);else if(e.getAttributeValue("isConcept")){let t=d.buildOntologyTagInfo(e,!0);a.object.literal=t.object,a.predicate=t.sixw}else if(e.getAttributeValue("isExplicitTagSuggestion")){let t=d.buildSuggestedTagInfo(e,!0);a.object.literal=t.object,a.predicate=t.sixw,n.log("SuggestedTagInfo: ",t)}else a.object.literal=i;return n.log("Tag information to persist: ",a),a},commit:function(e){var t=this.model.get("subjects");if(!t||t.length<1)return n.log("no subjects set, no action on commit"),!1;var i=this._autoComplete.selectedItems,a=this.isDirty();if(!(a&&this._manageDirtyState()||!this._manageDirtyState()&&UWA.is(i,"array")&&i.length>0))return n.log("no tag selected/modified, no action on commit."),!1;n.log("modifications found, handling the commit action.");var r,s,o,l,c=this,d=[],g=[],u=[],h=0;for(r=0,s=t.length;r<s;r++)"3DSpace"==t[r].service?g.push({uri:t[r].uri}):u.push({uri:t[r].uri});o=function(e,t,i){d.push({data:t?JSON.parse(t).data:"",request:i.request}),0==--h&&c.dispatchResponse(d)},l=function(e,t){0,d.push({data:e?JSON.parse(e).data?JSON.parse(e).data:JSON.parse(e):"",request:t.request}),0==--h&&c.dispatchResponse(d)};var p=function(t,i){if(u.length>0){var a={tag:t.map(function(e){return this._buildTagInfoToPersist(e,u)}.bind(this))};++h,i?this.ts.putTag(a,e,o,l,!1):this.ts.deleteTag(a,e,o,l,!1)}if(g.length>0){var n={tag:t.map(function(e){return this._buildTagInfoToPersist(e,g)}.bind(this))};++h,i?this.cs.putTag(n,e,o,l,!1):this.cs.deleteTag(n,e,o,l,!1)}};if(a&&this._manageDirtyState()){var f,m=[],v=this._getExistingSubjectTags(),T={};f=i.filter(function(e){var t=c._getKeyFromModel(e);return T[t]=e,!v[t]}),Object.keys(v).forEach(function(e){T[e]||(m.push(v[e]),n.log("tag to DELETE ="+e))}),f.length>0&&p.call(this,f,!0),m.length>0&&p.call(this,m,!1)}else p.call(this,i,!0);return!0},restore:function(){this.treeDocument.prepareUpdate(),this._autoComplete.selectedItems=[],this.treeDocument.removeRoots(),this._applyProperties(),this.treeDocument.pushUpdate()},clear:function(){this._autoComplete.selectedItems=[]},_manageDirtyState:function(){return this.getOption("manageDirtyState")},isDirty:function(){var e=!0;if(this._manageDirtyState()){var t=this._autoComplete.selectedItems||[],i=this._getExistingSubjectTags();if(t.length===Object.keys(i).length)t.filter(function(e){return!!i[this._getKeyFromModel(e)]}.bind(this)).length===t.length&&(e=!1)}return e},destroy:function(){this.stopListening(),this._autoComplete.destroy(),this.treeDocument.destroy(),this._parent()}})}),define("DS/TagNavigator/simplified/views/UserTagsSimplifiedView",["UWA/Core","UWA/Class/View","DS/TagNavigator/TaggerNLS","DS/TagNavigator/Logger","DS/Controls/ComboBox","DS/TagNavigator/userTags/UserTagsView","DS/TagNavigator/userTags/UserTagsModel","DS/Controls/Button","DS/TagNavigator/NotificationManager","DS/TagNavigator/Notification","DS/TagNavigator/userTags/utils/UserTagsUtils","DS/TagNavigator/simplified/utils/OntologyUtils","DS/TagNavigator/TaggerSettings"],function(e,t,i,a,n,r,s,o,l,c,d,g,u){"use strict";return t.extend({tagName:"div",className:"edit-tags-view expandable",init:function(e){this._parent(e)},render:function(){this.taggerView=this.getOption("taggerView"),this.dropdownCont=e.createElement("div",{class:"dropdown-container"}).inject(this.container),e.createElement("label",{text:i.getText("platformName")}).inject(this.dropdownCont);var t=this.taggerView.getObservedNavigator().getTenantList();if(t){var a=[];Object.keys(t).forEach(function(e){a.push({label:t[e].getTenantDisplayName(),value:t[e].getTenantName()})}),this.tenantDropdown=new n({elementsList:a,enableSearchFlag:!1,reachablePlaceholderFlag:!0,touchMode:!0,selectedIndex:0}).inject(this.dropdownCont),this.tenantDropdown.addEventListener("change",this.onTenantChange.bind(this))}return this.dropdownCont.hide(),this.userTagModel=new s,this.userTagView=new r({model:this.userTagModel,onCommit:this.actionOnCommit.bind(this),onSuggestDisplayed:this.setAutoCompletePopupWidth.bind(this),onSelectionChange:this.onSelectionChangeInView.bind(this)}).render().inject(this.container),this.addTag=new o({label:i.getText("addTagButton"),emphasize:"primary",touchMode:!0}).inject(e.createElement("div",{class:"add-tag-btn"}).inject(this.container)),this.addTag.getContent().addEventListener("buttonclick",this.onAddTag.bind(this)),this.addTag.disabled=!0,this},onSelectionChangeInView:function(e){this.addTag.disabled=!(e>0)},actionOnCommit:function(e){for(var t in e)"create"==t&&("success"!=e[t].status&&"partial"!=e[t].status||this.actionOnCreateSuccess(e[t]))},actionOnCreateSuccess:function(e){var t=this.userTagModel.get("platformId")[0],a=this.taggerView.observedNavImpl.getProxiesInEdition(),n={};for(var r in e)e[r]&&UWA.is(e[r],"object")&&e[r].tags&&e[r].tags.forEach(function(e){n[r]||(n[r]=[]),n[r].push(e)});a.length&&(l.push(new c(i.getText("tagCreationSuccess"),{className:"success"})),l.dispatch(),a[0].onAddTagSuccess(n,t)),this.userTagView.clear()},actionOnFailure:function(e){l.push(new c(i.getText("tagCreationFail"))),l.dispatch(),this.userTagView.clear()},redraw:function(){var e,t,i,a,n,r,s,o=this.taggerView.observedNavImpl.getProxiesInEdition(),l=this.taggerView.observedNavImpl;if(o.length){if(t=(s=o[0]).getCStorages(),a={},i=s.getTagsServers())for(e in i)a[i[e].getTenantName()]=e;else if(t)for(e in t)a[t[e].getTenantName()]=e;var c=s.getAllowedRootWForTagging();this.userTagModel.set("rootWs",c),!s.hasPlatformData()&&i&&Object.keys(a).length>1?(this.dropdownCont.show(),this.selectedTenant=this.tenantDropdown.value,this.selectedTenantName=this.tenantDropdown.label,n=i[a[this.tenantDropdown.value]].getUrlPart("baseUrl"),r=t[a[this.tenantDropdown.value]]?t[a[this.tenantDropdown.value]].getUrlPart("baseUrl"):void 0):1===Object.keys(a).length&&(this.dropdownCont.isHidden()||this.dropdownCont.hide(),this.selectedTenant=a[Object.keys(a)[0]],this.selectedTenantName=i[a[Object.keys(a)[0]]].getTenantDisplayName(),n=i[a[Object.keys(a)[0]]].getUrlPart("baseUrl"),r=t[a[Object.keys(a)[0]]]?t[a[Object.keys(a)[0]]].getUrlPart("baseUrl"):void 0),this.userTagModel.set("platformId",{id:this.selectedTenant,tagsServerUrl:n,cStorageUrl:r,displayName:this.selectedTenantName});var h=s.getFocusedSubjectsData();this.userTagModel.set("subjects",h);let p=function(e){let t={},i=e.source;if(i)t.source=i.toLowerCase();else{let e=function(){let e;return s.eachTagValue(function(t){e=t&&t.uri?t.uri:null},{allTagsOfType:["ds6w:community"]}),e}();e&&(t.source="3dswym",t.communityName=e)}return t.containerId=e.containerId,t};this.userTagModel.set("freeInput",!0);let f=[],m=-1;if(u.getOption("companyTags")&&!s.disableOntologySuggestions){let e=u.getOption("supportedSourcesForCompanyTags");h.every(function(t){return-1!=e.indexOf(d.getSourceFromSubjectURI(t.uri))})&&(m=f.length,f.push(g.getEnterpriseOntologySuggestions({tenant:this.selectedTenant})))}let v,T=-1;if(u.getOption("explicitCommunitySugestions")&&!s.disableCommunitySuggestions&&1==h.length){let e=p(h[0]),t={appName:"6WTagger",currentUser:l.getUserInfo(),platformId:this.selectedTenant,vocabSuggestions:!1,communityTags:u.getOption("suggestCommunityTags")};"3dswym"==e.source&&(e.containerId?(v=e.containerId+"_"+this.selectedTenant,t.communityId=e.containerId):(v=e.communityName+"_"+this.selectedTenant,t.communityName=e.communityName),t.id=v,T=f.length,f.push(d.getSuggestionsFor3DSwymContent(t)))}let C=-1;if(u.getOption("enableUserTagsSuggestions_FUN128285")){let e=s.getExplicitTagSuggestions();e&&(C=f.length,f.push(e))}Promise.all(f).then(function(e){let t=[];-1!=m&&UWA.is(e[m].suggestions,"array")&&(t=t.concat(e[m].suggestions)),-1!=T&&e[T].id==v&&UWA.is(e[T].suggestions,"array")&&(t=t.concat(e[T].suggestions)),-1!=C&&(t=t.concat(e[C].suggestions)),this.userTagModel.set("applicativeSuggestions",[]),this.userTagModel.set("applicativeSuggestions",t)}.bind(this))}},onTenantChange:function(){var e=this.taggerView.observedNavImpl.getProxiesInEdition();if(e.length){var t,i,a=e[0],n=a.getCStorages(),r=a.getTagsServers();this.selectedTenant=r[this.tenantDropdown.value].getTenantName(),this.selectedTenantName=r[this.tenantDropdown.value].getTenantDisplayName(),t=r[this.tenantDropdown.value].getUrlPart("baseUrl"),i=n[this.tenantDropdown.value]?n[this.tenantDropdown.value].getUrlPart("baseUrl"):void 0,this.userTagModel.set("platformId",{id:this.selectedTenant,tagsServerUrl:t,cStorageUrl:i,displayName:this.selectedTenantName});var s=a.getFocusedSubjectsData();this.userTagModel.set("subjects",s)}},onAddTag:function(){var e=this.taggerView.observedNavImpl.getProxiesInEdition();e.length&&this.userTagView.commit({hasPlatformData:e[0].hasPlatformData()})},setAutoCompletePopupWidth:function(e){var t=e.getDimensions().width,i=this.addTag.elements.button.getDimensions().width+10;e.setStyles({width:t-i,"overflow-x":"hidden","min-width":"180"})},clear:function(){this.userTagView.clear()},destroy:function(){this.stopListening(),this._parent()}})}),define("DS/TagNavigator/embeddedTagger/EmbeddedRootWhenView",["UWA/Core","UWA/Class/Model","DS/TagNavigator/embeddedTagger/EmbeddedRootWView","DS/TagNavigator/Logger","DS/TagNavigator/embeddedTagger/EmbeddedWhenMenuItem","DS/TagNavigator/simplified/utils/DateUtils","DS/TagNavigator/Predicate","DS/TagNavigator/TaggerNLS"],function(e,t,i,a,n,r,s,o){"use strict";return i.extend({tagName:"div",className:"embedded-root-container embedded-when",init:function(e){this._parent(e),this.selectedItems=[]},setup:function(e){this._parent(e)},render:function(){this.getElement(".chevron-div");return this.predicate="ds6w:modified",this.label=this.defaultValues.label?this.defaultValues.label:"When",this.icon="fonticon-3ds-when",this.defaultValues.subLabel&&(this.subLabel=this.defaultValues.subLabel),this._parent()},redrawTags:function(e){if(!s.getPredicate(this.predicate))return!1;var t=this;this.menuItems.forEach(function(e){e.destroy()}),this.selectedItems=[],this.menuItems=[];var i=r.getRangeDetails(this.proxy,this.predicate),a="sixw:"+(c=s.getPredicate(this.predicate)).getFullPredicateID();if(this.navImpl.getFocusedProxy())var o=this.navImpl.getSelectedAttributes(a);var l=[];i.forEach(function(e,i){t.checkForRanges(o,e,a),e.get("isSelected")&&l.push(e.get("title"));var r=new n({model:e,navImpl:t.navImpl,isPreciseCount:t.isPreciseCount}).render();r.container.hasClassName("item-disabled")||r.addEvent("toggleSelection",t.onTagClick.bind(t)),t.menuItems.push(r)}),this.menuItems.length?this.menuItems.filter(e=>e.container.hasClassName("item-disabled")).length==this.menuItems.length?this.container.addClassName("disableW"):this.container.removeClassName("disableW"):this.container.addClassName("disableW"),l.length&&this.container.removeClassName("disableW"),this.dropDownMenu&&this.dropDownMenu.destroy(),this.createDropdown();var c=s.getPredicate(this.predicate).displayName();this.defaultValues.subLabel||this.subLabel||(this.subLabel=c),this.updateSubLabelCall({subLabel:this.subLabel}),this.getElement(".button-text").removeClassName("hide-sub-label")},checkForRanges:function(e,t,i){if(e&&e[i]){var a=e[i],n=this;a.forEach((e,i)=>{var a=e.object.from,r=e.object.to,s=t.get("from"),o=t.get("to");a==s&&r==o&&(t.set("isSelected",!0),n.selectedItems.push(t))})}},_updateFreeInput:function(e,t,i){var a=[r.buildCondition(e,this.predicate)];t?this.navImpl.createFreeInputs(a,i):this.navImpl.removeFreeInputs(a,i),this.navImpl.dispatchEvent("UPDATE_ACTIVECRITERIA",!0)},_getSelectedIndex:function(e){return this.selectedItems.findIndex(function(t){return t.id===e.id})},clearRefine:function(){for(var e=0;e<this.selectedItems.length;e++){this._updateFreeInput(this.selectedItems[e],!1,!0),e==this.selectedItems.length-1&&(this.selectedItems=[]);this._parent(!1)}},onTagClick:function(e){var t=e.model;if(t){var i=this._getSelectedIndex(t);-1!==i?(this._updateFreeInput(this.selectedItems[i]),this.selectedItems=[]):(this.selectedItems.length>0&&(this._updateFreeInput(this.selectedItems[0],!1,!1),this.selectedItems=[]),this._updateFreeInput(t,!0),this.selectedItems.push(t))}this.container.getElements(".tag-elem").forEach(function(e){this.selectedItems.length&&this.selectedItems[0].id===e.id?e.addClassName("selected"):e.removeClassName("selected")}.bind(this)),this._parent(e)},getGroupingData:function(){var e,t,i=[],a={predicate:this.predicate,object:i},n=this.navImpl.getFocusedProxy().getGroupingConfig();return this.menuItems.forEach(function(a){e=a.model;var s={dispText:(t=r.buildCondition(e,this.predicate)).value.nls,type:t.type},o={};t.value.from&&(o.from=t.value.from),t.value.to&&(o.to=t.value.to),this._groupingFormatV2?s.object=o:(s.object=[o],s.predicate=[t.predicate.getFullPredicateID()]),n.withIconInfo&&(s.iconInfo={image:e.get("imageURL")}),i.push(s)}.bind(this)),a}})}),define("DS/TagNavigator/simplified/views/CriteriaView",["UWA/Core","UWA/Class/View","DS/Handlebars/Handlebars","text!DS/TagNavigator/assets/templates/CriteriaViewTemplate.html","DS/TagNavigator/simplified/utils/CriteriaUtils","DS/TagNavigator/TaggerNLS","DS/UIKIT/Tooltip","DS/TagNavigator/TaggerUtils","DS/TagNavigator/Logger","DS/TagNavigator/TaggerSettings"],function(e,t,i,a,n,r,s,o,l,c){"use strict";var d=t.extend({tagName:"li",className:"category with-expander",template:i.compile(a),subCriteriaViews:void 0,subCriteriaViewParentElem:void 0,parentView:void 0,updateCountCB:void 0,domEvents:{click:"onCriteriaClick","click .expand-icon-container":"onExpandClick",mouseover:"onHoverAdd",mouseout:"onHoverRemove","mouseover .expand-icon-container":"onHoverRemove"},init:function(e){this.subCriteriaViews=[],this.subCriteriaViewParentElem=null,this.parentView=null,this._parent(e)},setup:function(e){this._parent(e)},render:function(){var e=this.template();return this.container.setContent(e),this.addContent(),this.updateCountCB=this.updateCount.bind(this),this.model.addEvent("onChange:count",this.updateCountCB),this},addContent:function(){this.container.getElement("li .cat-title").setText(this.model.get("title")),this.container.getElement("li .cat-count").setText(r.convertToUnity(this.model.getCount()));var t=this.model.get("level");this.container.addClassName(t);var i=this.model.get("iconClass");this.container.addClassName(i?i.replace("fonticon-",""):""),"level0"!==t&&this.model.isContainer()&&this.container.addClassName(this.model.id);var a=this.container.getElement(".cat-lower-div");a.addClassName("tn-"+t);var n=this.container.getElement(".cat-icon");n.addClassName("tn-"+t);var o=this.model.get("rootIconClass");("level0"!=t||o&&"level0"===t)&&(n.addClassName("tn-"+o),a.addClassName("tn-"+o)),i?(n.addClassName(i),"level0"==t&&(n.addClassName(i.replace("fonticon","tn")),a.addClassName(i.replace("fonticon","tn")))):(n.removeClassName("fonticon"),e.createElement("img",{src:this.model.get("imageURL"),class:"type-icon"}).inject(n)),this._tooltip=new s({position:"bottom",target:this.container.getElement(".cat-title"),body:this.model.get("title"),className:"title-tooltip"})},updateCount:function(){this.container.getElement("li .cat-count").setText(r.convertToUnity(this.model.getCount()))},getParentView:function(){return this.parentView},findViewById:function(e,t){var i=this.subCriteriaViews.filter(function(i){if(i.model.id==e)return i;if(t){var a=i.findViewById(e,t);if(UWA.is(a,"array"))return a[0]}});if(i.length>0)return i[0]},addSubCriteriaViews:function(t,i,a){if(this.addEvent("onCriteriaToggle",a.onCriteriaToggle),a.focusedAdvProxy)a.isRootSelected?this.setAsSelected():a.focusedAdvProxy.getLocalFilter().isSelected(n.buildCondition(this.model))&&this.setAsSelected();else{var r=this.model.isContainer();a.navImpl.isSelected(JSON.stringify(this.model.getRefineStructure(!0)[0]),r)&&this.setAsSelected()}if(this.model.isContainer()){this.addEvent("onCriteriaExpand",a.onCriteriaExpand),this.subCriteriaViewParentElem=e.createElement("li",{class:"sub-category "+t+("level0"==this.model.get("level")?"":" "+this.model.id)}).inject(i);var s=n.removeDuplicates(this.model.get("subCategories")),o=[],l=[];s.sortBy("title").forEach(function(e){e.isContainer()?o.push(e):l.push(e)}),this.model.set("count",s.length),this.model.set("subCategories",s),a.isMobileDevice&&s.length>1&&this.subCriteriaViews.push(new d({model:n.getAllCriteriaModel(this.model,s),taggerView:this.getOption("taggerView")}).render().inject(this.subCriteriaViewParentElem));for(var c=o.concat(l),g=0,u=0;u<c.length;u++){c[u].set("rootIconClass",t);var h=new d({model:c[u],taggerView:this.getOption("taggerView")}).render().inject(this.subCriteriaViewParentElem);h.parentView=this,this.subCriteriaViews.push(h),h.model.get("selected")&&g++,h.addSubCriteriaViews(t,this.subCriteriaViewParentElem,a)}g==c.length&&this.setAsSelected()}else this.setAsLeaf(),this.container.addClassName(t);return this},onExpandClick:function(e){this.dispatchEvent("onCriteriaExpand",this)},onCriteriaClick:function(e){var t=this.getOption("taggerView");if(!t.getObservedNavigator().hasProxiesInEdition()){o.getDeviceAgent()&&c.enableMobileTypeCode();if(e.target.hasClassName("fonticon-expand-down"))return;var i=t.actionManager.getCurrentAction();if(i&&!n.isSupportedAction(t,i.id))return;this.container.toggleClassName("cat-selected")}this.dispatchEvent("onCriteriaToggle",[e,this])},onHoverAdd:function(e){this.container.addClassName("set-opacity")},onHoverRemove:function(e){this.container.removeClassName("set-opacity")},setAsUnselected:function(){this.container.removeClassName("cat-selected"),this.model.isContainer()&&(this.container.addClassName("with-expander"),this.container.getElement(".expand-icon-container").show())},setAsSelected:function(){this.container.addClassName("cat-selected"),this.model.set("selected",!0),this.model.isContainer()&&(this.container.removeClassName("with-expander"),this.container.getElement(".expand-icon-container").hide())},isSelectedForAction:function(e){return this.container.hasClassName(e)},setAsSelectedForAction:function(e){this.container.addClassName(e)},setAsUnselectedForAction:function(e){this.container.removeClassName(e)},getSelectedSubCategoriesForAction:function(e,t){this.subCriteriaViews.forEach(function(i){if(i.isSelectedForAction(e))t.push(i);else if(i.model.isContainer())return i.getSelectedSubCategoriesForAction(e,t)})},setAsLeaf:function(){this.container.removeClassName("with-expander")},setAsContainer:function(){this.container.addClassName("with-expander")},setAsExapnded:function(){this.subCriteriaViewParentElem&&this.subCriteriaViewParentElem.setStyle("display","grid")},setAsCollapsed:function(){this.subCriteriaViewParentElem&&this.subCriteriaViewParentElem.setStyle("display","none")},hideSubCriteria:function(){this.subCriteriaViewParentElem&&this.subCriteriaViewParentElem.hide()},showSubCriteria:function(){this.subCriteriaViewParentElem&&this.subCriteriaViewParentElem.setStyle("display","grid")},showAllSubCriteria:function(){this.subCriteriaViewParentElem&&this.subCriteriaViewParentElem.setStyle("display","grid"),this.subCriteriaViews.forEach(function(e){e.show()})},showDefaultSubCriteria:function(){this.showSubCriteria(),this.subCriteriaViews.forEach(function(e){n.OTHER_MODEL_ID===e.model.id?e.show():n.ALL_MODEL_ID===e.model.id?e.show():!0===e.model.get("isOther")?e.hide():e.show()})},searchSubCriteria:function(e,t){var i=0;return this.subCriteriaViews.forEach(function(t){n.OTHER_MODEL_ID===t.model.id?t.hide():n.ALL_MODEL_ID===t.model.id?t.hide():-1===t.model.get("title").toLowerCase().indexOf(e)?t.hide():(i++,t.show())}),this.hide(),i>0?(this.setAsExapnded(),this.showSubCriteria()):this.hideSubCriteria(),i>0},destroy:function(){this.stopListening(),this.model.removeEvent("onChange:count",this.updateCountCB),this.model=null,this.subCriteriaViewParentElem&&this.subCriteriaViewParentElem.destroy(),this.subCriteriaViews.forEach(function(e){e.destroy(),e=null}),this.subCriteriaViews=[],this._tooltip.destroy(),this._tooltip=null,this._parent()}});return d}),define("DS/TagNavigator/ActiveGroupView",["UWA/Core","UWA/Class/View","DS/UIKIT/Tooltip","DS/UIKIT/DropdownMenu","DS/TagNavigator/ActiveTagView","DS/TagNavigator/TaggerNLS"],function(e,t,i,a,n,r){"use strict";return n.extend({domEvents:{click:"removeGroup"},setup:function(e){this._parent(e)},render:function(){var t=this.getOption("isSimplified"),a=this.getOption("text"),n=this.getOption("icon"),r=this.getOption("isGrouped"),s=this.getOption("disabled"),o=this.getOption("attribute");if(this.condition=this.getOption("condition"),this.renderTo=this.getOption("renderTo"),s&&this.container.addClassName("disable"),r&&this.container.addClassName("grouped"),o&&o.length>0){var l=this;o.forEach(function(e){l.container.setAttributes(e)})}var c=e.createElement("div",{class:"tag-elem"}).inject(this.container),d=e.createElement("div",{class:"tag-label"}).inject(c);n&&e.createElement("span",{class:"root-icon fonticon "+n}).inject(d),r&&e.createElement("span",{class:"fonticon fonticon-group"}).inject(d);var g=e.createElement("div",{class:"title",text:a}).inject(d);return n||g.setStyles({"padding-left":"5px"}),t&&e.createElement("span",{class:"tag-del fonticon fonticon-cancel"}).inject(c),this.getOption("withoutTitle")||this.container.setAttributes({title:a}),this.tooltip=new i({position:"bottom",target:d,body:a,className:"tagger-filter-tooltip"}),this},removeGroup:function(e){e.preventDefault(),this.dispatchEvent("removeActiveGroup",this.condition)},destroy:function(){this._parent()}})}),define("DS/TagNavigator/simplified/views/CriteriaListView",["UWA/Core","UWA/Class/View","DS/TagNavigator/TaggerNLS","DS/TagNavigator/Logger","DS/TagNavigator/simplified/utils/CriteriaUtils","DS/TagNavigator/simplified/views/CriteriaView","DS/TagNavigator/simplified/views/EmptyView","DS/TagNavigator/TaggerUtils","DS/TagNavigator/TaggerSettings","DS/TagNavigator/simplified/actions/ActionUtils"],function(e,t,i,a,n,r,s,o,l,c){"use strict";return t.extend({tagName:"div",className:"type-categories",_rootCategoryViews:void 0,_focusedCriteriaPath:void 0,init:function(e){this._parent(e),this._rootCategoryViews=[],this._focusedCriteriaPath=void 0},setup:function(e){this._parent(e)},render:function(){return this.taggerView=this.getOption("taggerView"),this.hasAdvancedFocsuedProxy=this.getOption("hasAdvancedFocsuedProxy"),this._emptyView=(new s).render().inject(this.container),this._addCriteriaDetailsHeader(),this._typesRootUL=e.createElement("ul",{class:"root-category"}).inject(this.container),this.taggerView.addEvent("TopBarSearch",this.onSearchInput.bind(this)),this.searchDiv=e.createElement("ul",{class:"search-categories"}).inject(this.container),this.taggerView.buildTypeToggleElem({viewMode:"category",text:i.getText("showAll")}).inject(this.container).show(),this._parent()},_destroyRoots:function(){this._rootCategoryViews.forEach(function(e){e.destroy(),e=null}),this._rootCategoryViews=[]},redraw:function(e){var t=this.taggerView,a=t.getObservedNavigator(),s=o.getDeviceAgent()&&l.enableMobileTypeCode(),c=t.searchedString;this._destroyRoots(),this._emptyView&&this._emptyView.hide(),this._focusedCriteriaPath=n.getFocusedCriteriaPath();var d=this.hasAdvancedFocsuedProxy(a,n.TYPE_CATEGORIZATION),g=n.getCriteriaInfo(a,d,this.getOption("predicates"));if(g&&g.length>0){var u=[],h=[];g.sortBy("title").forEach(function(e){e.isContainer()?u.push(e):h.push(e)});for(var p=u.concat(h),f=0;f<p.length;f++){var m=p[f],v=new r({model:m,taggerView:this.taggerView}).render().inject(this._typesRootUL);this._rootCategoryViews.push(v);var T=m.get("iconClass").replace("fonticon-",""),C=!!d&&d.getLocalFilter().isSelected(n.buildCondition(m));v.addSubCriteriaViews(T,this._typesRootUL,{focusedAdvProxy:d,navImpl:a,isRootSelected:C,onCriteriaToggle:this.onCriteriaClick.bind(this),onCriteriaExpand:this.onExpandClick.bind(this),isMobileDevice:s})}if(this._focusedCriteriaPath.length>0){this.otherCriteriaHeader.getElement(".cat-title").innerHTML="";var w=this._focusedCriteriaPath[0],b=this._rootCategoryViews.findIndex(function(e){return e.model.id==w});if(-1!=b){for(var y=this._rootCategoryViews[b],S=0;S<this._focusedCriteriaPath.length;S++){var E=this._focusedCriteriaPath[S],I=null;if(0!=S){var x=y.findViewById(E,!0);if(!x)break;I=x.getParentView()}this.showCriteriaDetails(E,I,!1)}this._focusedCriteriaPath.forEach(function(e,t){}.bind(this))}else this._focusedCriteriaPath=[],n.setFocusedCriteriaPath(this._focusedCriteriaPath)}}else this._emptyView.show(),this._emptyView.setMessageText(i.getText("noTags")),this.otherCriteriaHeader&&this.otherCriteriaHeader.hide();return this._redrawStatus=!1,c&&this.showOnlyLeaf(),this},_addCriteriaDetailsHeader:function(){var t=this;this.otherCriteriaHeader=e.createElement("div",{id:"otherCriteriaHeader",styles:{height:"38px"}}).inject(this.container),e.createElement("div",{id:"back-title",html:"<div class='back-title' style='border-right: 1px solid #B6B4BA; padding-right: 10px; margin-right: 10px;'><span class='fonticon fonticon-chevron-left'></span>"+i.getText("back")+"</div>",events:{click:function(){t.hideCriteriaDetails()}}}).inject(this.otherCriteriaHeader),e.createElement("div",{class:"cat-title"}).inject(this.otherCriteriaHeader),this.otherCriteriaHeader.hide()},showOnlyLeaf:function(e){var t=this;this.getElement("#otherCriteriaHeader").hide(),(e||this._rootCategoryViews).forEach(function(e){e.model.isContainer()?(e.hide(),t.showOnlyLeaf(e.subCriteriaViews)):(e.container.inject(t.searchDiv),t.searchDiv.show())})},hideCriteriaDetails:function(){if(this._focusedCriteriaPath.length<1)throw new Error("INVALID expand status for criteria");var e=this._focusedCriteriaPath.pop();n.setFocusedCriteriaPath(this._focusedCriteriaPath);var t=[];if(0==this._focusedCriteriaPath.length)this.otherCriteriaHeader.hide(),t=this._rootCategoryViews;else{this.otherCriteriaHeader.getElement(".cat-title").innerHTML=this._focusedCriteriaPath.map(function(e){return i.getText(e)}).join(" - ");var a=this._focusedCriteriaPath[0];t=this._rootCategoryViews.filter(function(e){return e.model.id==a})[0].findViewById(e,!0).getParentView().subCriteriaViews}t.forEach(function(t){t.show(),t.parentView?t.container.getParent().setStyle("display","grid"):t.container.getParent().removeClassName("adjust-css"),t.model.id===e&&t.setAsCollapsed()}.bind(this))},showCriteriaDetails:function(e,t,a){var r=!t;(r?this._rootCategoryViews:t.subCriteriaViews).forEach(function(t){t.model.id===e?(t.hide(),r?t.container.getParent().hasClassName("adjust-css")||t.container.getParent().addClassName("adjust-css"):t.container.getParent().setStyle("display","block"),t.showAllSubCriteria(),this.otherCriteriaHeader.show(),this.otherCriteriaHeader.setStyle("display","flex"),a&&(this._focusedCriteriaPath.push(t.model.id),n.setFocusedCriteriaPath(this._focusedCriteriaPath)),this.otherCriteriaHeader.getElement(".cat-title").innerHTML=this._focusedCriteriaPath.map(function(e){return i.getText(e)}).join(" - ")):(t.hide(),t.hideSubCriteria())}.bind(this))},onExpandClick:function(e){var t=e.model.id,i=e.getParentView();this.showCriteriaDetails(t,i,!0)},onCriteriaClick:function(e,t){var i=t.model,r=this.taggerView.getObservedNavigator();if(r)if(r.hasProxiesInEdition())console.warn("no refine possible when focused on subjects");else{var s,o=!1,l=n.ALL_MODEL_ID===i.id,d=this.taggerView.actionManager.getCurrentAction();if(e.ctrlKey&&d)return void a.log("no treatment when pressing CTRL key during action mode");if(i.isContainer()||l)if(s=this.hasAdvancedFocsuedProxy(r,n.TYPE_CATEGORIZATION)){for(var g=i.get("subCategories"),u=s.getLocalFilter(),h=0;h<g.length;h++){var p=n.buildCondition(g.at(h));u.isSelected(p)&&u.toggle(p)}var f=n.buildCondition(i);r.toggleComplexTagSelection(f)}else if(e.ctrlKey||d&&(d.id==c.ACTION_SELECT||d.id==c.ACTION_EDITTAGREL))d||(d=this.taggerView.startSelectAction()),d.onCriteriaSelection({view:t,isComplex:!1,isContainer:!0});else if(d&&d.id==c.ACTION_EXCLUDE)d.onCriteriaSelection({view:t,isComplex:!1,isContainer:!0});else{if(r.getFocusedProxy()||r.dispatchEvent("onBeforeGlobalFilterChange"),!i.get("selected")){var m=[];i.getSelectedSubCategories(m),m.forEach(function(e){r.toggleTagSelection(JSON.stringify(e.getRefineStructure(!0)[0]),!1)})}r.toggleTagSelection(JSON.stringify(i.getRefineStructure(!0)[0]),!1),r.onRefine(),o=!0}else if(s=this.hasAdvancedFocsuedProxy(r,n.TYPE_CATEGORIZATION))(f=n.buildCondition(i)).treatEmbeddingFilter=!0,r.toggleComplexTagSelection(f);else e.ctrlKey||d&&(d.id==c.ACTION_SELECT||d.id==c.ACTION_EDITTAGREL)?(d||(d=this.taggerView.startSelectAction()),d.onCriteriaSelection({view:t,isComplex:!1,isContainer:!1})):d&&d.id==c.ACTION_EXCLUDE?d.onCriteriaSelection({view:t,isComplex:!1,isContainer:!1}):(r.toggleTagSelection(JSON.stringify(i.getRefineStructure(!0)[0])),o=!0);o&&this.taggerView.setSpinner()}},destroy:function(){this.taggerView.removeEvent("TopBarSearch"),this._destroyRoots(),this._parent()},onSearchInput:function(e){if(this.searchString=e,this.searchString){var t=0,a=this.searchString.toLowerCase();this._rootCategoryViews.forEach(function(e){this._focusedCriteriaPath&&e.model.id!==this._focusedCriteriaPath||e.searchSubCriteria(a,e.model.id===this._focusedCriteriaPath)&&t++}.bind(this)),0===t||0===t&&!viewAllIsActive?(this._emptyView.show(),this._emptyView.setMessageText(i.getText("noRslt"))):this._emptyView.hide()}else{var n;this._rootCategoryViews.forEach(function(e){n=e.model.id===this._focusedCriteriaPath,this._focusedCriteriaPath&&!n||(n||e.show(),n?e.showAllSubCriteria():(e.showDefaultSubCriteria(),!0!==e.model.get("expandStatus")&&e.setAsCollapsed()))}.bind(this)),this._emptyView.hide()}}})}),define("DS/TagNavigator/AbstractPredicateView",["UWA/Core","UWA/Class","DS/TagNavigator/Predicate","DS/TagNavigator/TaggerNLS","DS/UIKIT/Input/Date","DS/UIKIT/Input/Select","DS/UIKIT/Input/Text","DS/UIKIT/Autocomplete","DS/UIKIT/Mask","UWA/Promise","DS/TagNavigator/Logger","DS/TagNavigator/TaggerSettings","DS/TagNavigator/simplified/views/PersonListView","DS/TagNavigator/simplified/views/CriteriaListView"],function(e,t,i,a,n,r,s,o,l,c,d,g,u,h){"use strict";var p,f={},m={},v={},T=/^[\w-.\s,]*$/;return(p=t.extend({init:function(e,t){if(!(e instanceof i))throw new Error("Invalid input arg");var a,n,r,s,o,l;this.taggerView=t,this.nbDescendantTagValues=0,this._id=e.id(),this._displayName=e.displayName(),this._tagValueViews=[],this._tagValueViewsMap={},this._predicate=e,this._colorize=!1,this.criterion={},this.colorManager=null,this.debouncedRequestSuggestions=(a=this.taggerView.observedNavImpl.requestSuggestions,n=250,r=this.taggerView.observedNavImpl,(l=function(){var e,t=r||this,i=arguments,l=function(){o=null,s||(e=a.apply(t,i))};if(o&&clearTimeout(o),s){var c=!o;o=setTimeout(l,n),c&&(e=a.apply(this,i))}else o=setTimeout(l,n);return e}).cancel=function(){clearTimeout(o),o=null},l);var c=this.taggerView.getObservedNavigator().getCache(),d=e.getFullPredicateID().split("/");d.length>1&&"ds6w:when"===d[0]&&!UWA.is(c.viewMode[this._id])&&this.taggerView.hasFreeInputSupport(this._id)?c.setViewMode(this._id,"freeInput"):d.length>1&&"ds6w:when"===d[0]&&!UWA.is(c.viewMode[this._id])&&!this.taggerView.hasFreeInputSupport(this._id)&&c.setViewMode(this._id,"tag"),this.from_keyup_handler=null,this.to_keyup_handler=null,this.boolean_keyup_handler_handler=null,this._hasHierarchicalTags=!1},hasHierarchicalTags:function(){this._hasHierarchicalTags=!0},getHasHierarchyTags:function(){return this._hasHierarchicalTags},getDisplayname:function(){return this._displayName},getCompleteID:function(e){return this._predicate.getFullPredicateID(e)},getPredicate:function(){return this._predicate},getChildrenTagValueViews:function(e){var t,i,a,n;for(e||(e=function(){return!0}),n=[],i=0,a=this._tagValueViews.length;i<a;i++)e((t=this._tagValueViews[i]).id())&&n.push(t);return n},getTagValueViews:function(e,t,i){var a=this;if(e){var n;d.log("looking for tvv for tagName="+e);var r,s=function(e,t){var a=e.findIndex(function(e){if(i){if(n=e.id(),UWA.is(n,"array")&&(n=n[n.length-1]),n==t)return!0}else if(e.getDisplayname()==t)return!0});if(-1!==a)return e[a];d.error("FAILED to find tvv for "+t)};if(t){var o,l=[];e.forEach(function(e,t){d.log("looking for tvv for hierarchical tag="+e),0==t?(o=s(a._tagValueViews,e))&&l.push(o):o&&(o=s(o.getChildrenTagValueViews(),e))&&l.push(o)}),r=[l]}else{var c=s(this._tagValueViews,e);c&&(r=[c])}return r}return this._tagValueViews},getChildTagValueView:function(e){return this._tagValueViewsMap[e]},addTagValueView:function(e){if(this._tagValueViewsMap[e.getDisplayname()])throw new Error("Unexpected addition of already existing child TagValueView");return this._tagValueViews.push(e),this._tagValueViewsMap[e.getDisplayname()]=e,this.incNbDescendantTagValues(),this},predComparator:function(e,t){return e.getDisplayname().toLowerCase()>t.getDisplayname().toLowerCase()?1:e.getDisplayname().toLowerCase()<t.getDisplayname().toLowerCase()?-1:0},findInsertionPoint:function(e,t,i){var a,n,r,s;for(r=0,n=e.length,s=-1,a=0;r<n;)if((a=i(e[s=parseInt((r+n)/2,10)],t))<0)r=s+1;else{if(!(a>0))return s;n=s}return r},getComparator:function(e,t){var i=e?1:-1,a=t?1:-1;return this.sortTwoValues.bind(this,i,a)},sortTwoValues:function(e,t,i,a){function n(e,t,i){return(t.t!==i.t?t.t>i.t?1:-1:t.localeSort||i.localeSort?t.value.localeCompare(i.value):t.value>i.value?1:t.value===i.value?0:-1)*e}var r=0;return 0===(r=n(e,i[0],a[0]))&&(r=n(t,i[1],a[1])),r},getNbDescendantTagValues:function(){return this.nbDescendantTagValues},incNbDescendantTagValues:function(){return this.nbDescendantTagValues++,this},isRootPredView:function(){return this._isRootPredView},hasSuggestSupport:function(){var e=this._predicate.getElemOptions();return e&&e.multiSelect&&e.allowFreeInput&&!1!==this._predicate.isSuggestSupported()},updateSuggestions:function(t){if(e.is(this.criterion,"object")&&e.is(this.criterion.string)){var i=this.criterion.string.getDataset("displayedSuggestions");e.is(t)&&e.is(t.items,"array")&&0!==t.items.length?(t.items.unshift({label:this.criterion.string.elements.input.value,value:this.criterion.string.elements.input.value,isUserText:!0}),UWA.is(this.resolve,"function")&&this.resolve({dataset:i,matchingItems:t.items})):UWA.is(this.resolve,"function")&&this.reject({type:"error",dataset:i})}},id:function(){return this._id},idForDOM:function(){return this.taggerView.getDOMId(this._predicate.getFullPredicateID())},updateCompositeStatus:function(){for(var e=0;e<this._tagValueViews.length;e++){this._tagValueViews[e].updateCompositeStatus()}},createTempArrayForSort:function(t,i){return t.map(function(t,a){var n,r,s,o=[],l=!1,c=!1,d=t.type();return n={value:t.nbSubjectsTagged(),t:0,localeSort:!1},"date"===d?(s=t.id().toLowerCase(),l=!1):(s=t.getDisplayname(),isNaN(s)&&e.is(s,"string")?(s=s.toLowerCase(),l=!T.test(s)):(s=parseFloat(s),l=!1,c=!0)),r={value:s,t:c?0:"date"===d?1:2,localeSort:l},o.index=a,"nbSort"===i.sortMode?(o.push(n),o.push(r)):(o.push(r),o.push(n)),o})},sortTagValues:function(e){var t,i;return t=this.taggerView.getObservedNavigator().getCache().getCurrentSort(this._predicate.getFullPredicateID()),0!==this.getChildrenTagValueViews().length&&this.getChildrenTagValueViews()[0].nbSubjectsTagged()<0&&"alphaSort"!==t.sortMode&&this.taggerView.getObservedNavigator().getCache().changeSort("alphaSort",this._predicate.getFullPredicateID()),t=this.taggerView.getObservedNavigator().getCache().getCurrentSort(this._predicate.getFullPredicateID()),(i=this.createTempArrayForSort(e,t)).sort(this.getComparator(t.order,t.secondaryorder)),i=i.map(function(t){return e[t.index]})},destroyUiElement:function(e){if(e?delete v[this.id()]:delete m[this.id()],Object.keys(this.criterion).length){var t=Object.keys(this.criterion)[0];switch(t){case"graph":case"category":case"string":case"people":case"calendar":this.criterion[t].destroy();break;case"integer":case"float":case"double":case"date":this.from_keyup_handler&&this.criterion[t].from.elements.input.removeEvent("keyup",this.from_keyup_handler),this.from_keyup_handler=null,this.to_keyup_handler&&this.criterion[t].to.elements.input.removeEvent("keyup",this.to_keyup_handler),this.to_keyup_handler=null,this.criterion[t].from.destroy(),this.criterion[t].to.destroy();break;case"boolean":this.boolean_keyup_handler&&this.criterion[t].elements.input.removeEvent("keyup",this.boolean_keyup_handler),this.boolean_keyup_handler=null,this.criterion[t].destroy()}delete this.criterion[t]}this.resolve&&(this.resolve=null),this.reject&&(this.reject=null)},redrawUiElement:function(t){var i,n,g,f=this,m={},T=["from","to"],C=this.taggerView.getObservedNavigator().getCache(),w=this.taggerView.getObservedNavigator().getFocusedProxy(),b=this._predicate.getElemOptions(),y=C.getCriteriaToResetBeforeFilterChange(w?w.id():void 0),S=C.getCriteriaToRemoveBeforeFilterChange(w?w.id():void 0),E="",I=this.taggerView.getDOMId(this.getCompleteID());if(i=t?this.taggerView.taggerUWAElement.getElement("#"+I+"sug"):this.taggerView.taggerUWAElement.getElement("#"+I),E=this.taggerView._simplifiedTagger?this.taggerView.getCacheSimplified().getViewMode(this.id()):this.taggerView.getObservedNavigator().getCache().getViewMode(this.id()),e.is(i)){switch(t||0!==E.indexOf("graph")?t||0!==E.indexOf("category")?t||0!==E.indexOf("people")?this.taggerView._simplifiedTagger&&!t&&"date"==this._predicate.getType()?(this.taggerView.hasFreeInputOnly(this.id())||"freeInput"==E&&this.taggerView.hasFreeInputSupport(this.id()))&&(n="calendar"):n=this._predicate.getType():n="people":n="category":n="graph",n){case"category":(i=this.taggerView.taggerUWAElement.getElement("#"+I.concat("_category")))&&(f.criterion.category&&(d.log("destroying the existing category view before creating a new one"),f.criterion.category.destroy(),f.criterion.category=null),f.taggerView&&(f.criterion.category=new h({taggerView:f.taggerView,hasAdvancedFocsuedProxy:f.taggerView.hasAdvancedFocsuedProxy,predicates:"ds6w:typeCategory"==f.id()?[f.id()]:void 0}).inject(i).render(),f.criterion.category.redraw()));break;case"people":(i=this.taggerView.taggerUWAElement.getElement("#"+I.concat("_people")))&&f.taggerView&&(f.criterion.people=new u({taggerView:f.taggerView,hasAdvancedFocsuedProxy:f.taggerView.hasAdvancedFocsuedProxy,predicates:[f.id()],expandablePerson:!1,searchString:C.getSearchValue()}).render().inject(i),f.criterion.people.redraw());break;case"calendar":require(["DS/TagNavigator/simplified/views/DateCalendarView"],function(e){f.taggerView&&(f.criterion.calendar=new e({taggerView:f.taggerView,predicateId:f._predicate.id()}).render().inject(i.getElement(".date-view-container")))});break;case"graph":var x="graphBar"===E,_=I.concat("_graph");i=this.taggerView.taggerUWAElement.getElement("#"+_),require(["DS/W3DXComponents/Views/GraphView"],function(e){f.criterion.graph=new e({type:x?"column":"pie",width:f.dataForGraph.widthBarChartGraph,series:[{type:x?"column":"pie",pointRange:f.dataForGraph.dateRange,data:f.dataForGraph.completeData,borderWidth:x?2:1,borderColor:x?null:"white"}],expertOpts:{chart:{zoomType:"x"},title:{text:null},plotOptions:{pie:{borderWidth:1,borderColor:"#FFFFFF",point:{events:{legendItemClick:function(){return!!this.id&&((f.taggerView.actionManager?f.taggerView.actionManager.getCurrentAction():void 0)?(d.log("NO treatment for pie chart selection during action mode"),!1):void f.taggerView.toggleTagSelection(this.id.replace("atv","")))}}},dataLabels:{enabled:!1},showInLegend:!0},column:{states:{select:{color:null,borderWidth:2,borderColor:"#368ec4"}},colorByPoint:!0},series:{allowPointSelect:!1,cursor:"pointer",point:{events:{click:function(e){if(this.id){if(f.taggerView.actionManager?f.taggerView.actionManager.getCurrentAction():void 0)return d.log("NO treatment for bar chart selection during action mode"),!1;f.taggerView.toggleTagSelection(this.id.replace("atv",""))}}}},turboThreshold:1e4}},legend:{enabled:!x,maxHeight:"56",itemStyle:{width:"150px",textOverflow:"ellipsis",overflow:"hidden"},labelFormat:'{name} <span style="font-weight:normal">({percentage:.1f}%)</span>'},xAxis:{type:f.dataForGraph.datetime?"datetime":"category",tickInterval:f.dataForGraph.datetime?f.dataForGraph.dateRange:null,minRange:f.dataForGraph.datetime?f.dataForGraph.dateRange:null,dateTimeLabelFormats:{day:"%d",month:"%B",year:"%Y"},labels:{rotation:-45,formatter:f.dataForGraph.datetime?null:function(){var e=this.value;return e.length>10&&!f.dataForGraph.datetime&&(e=e.substring(0,9).concat("...")),e}},reversed:!!f.dataForGraph.datetime&&f.dataForGraph.reversed,crosshair:!0},tooltip:{pointFormat:x?"<b>{point.y}</b>":"<b>{point.y}</b> ({point.percentage:.1f}%)",formatter:null,positioner:x?function(e,t,i){return{x:i.plotX+f.criterion.graph._highcharts.plotLeft-e/2,y:t>i.plotY?f.criterion.graph._highcharts.plotHeight+f.criterion.graph._highcharts.plotTop+10:i.plotY+f.criterion.graph._highcharts.plotTop-t-10}}:void 0}}}),f.criterion[n].setContainer(i).render(),i&&i.scrollWidth!==i.clientWidth&&i.setStyle("padding-bottom","15px")});break;case"string":m.onKeyDown=function(e){if(-1===[8,46].indexOf(e.keyCode)||this.options.multiSelect||!e.target.value)return!1;this.options.events.onUnselect.call(this,this.selectedItems[0])},m.onKeyUp=function(e){var i,a=[];if(-1!==[8,46].indexOf(e.keyCode))return!1;if(13!==e.keyCode||e.target.value)return!1;if(t)f.taggerView.onSearchLaunch();else{for(i=0;i<this.getSelection().length;i++)a.push({predicate:f._predicate,value:this.getSelection()[i].value,type:"string"});f.taggerView.observedNavImpl.createFreeInputs(a),f.taggerView.setActiveCriteria(!0,!0)}},m.onSelect=function(e){"ds6w:dataSource"==f._id&&l.mask(v["ds6w:type"].criterion.string.elements.container);var t,i=[],a=this.getSelection();if("string"==typeof a&&(a=void 0!==e?[e]:[]),f._predicate.warnSelect()&&f._predicate.isEnum()){for(t=0;t<a.length;t++)i.push(a[t].value);f.taggerView.warnProxyOfCriteriaChange({sixw:f._predicate.getFullPredicateID(),value:i})}"string"==typeof a[a.length-1]&&a.pop(),a.length>0?y[f._predicate.id()]={value:a,type:"string"}:delete y[f._predicate.id()],p.checkActiveSearch(f.taggerView)},m.onUnselect=function(e){if(!this.opened){var i,a=[],n=this.getSelection();if(f._predicate.warnSelect()&&f._predicate.isEnum()){for(i=0;i<n.length;i++)a.push(n[i].value);f.taggerView.warnProxyOfCriteriaChange({sixw:f._predicate.getFullPredicateID(),value:a})}"string"==typeof n[n.length-1]&&n.pop(),n.length>0?y[f._predicate.id()]={value:n,type:"string"}:delete y[f._predicate.id()],t?S.push({predicate:f._predicate,type:"string",value:e.value}):f.taggerView.getObservedNavigator().getFocusedProxy().removeFreeInputs([{predicate:f._predicate,type:"string",value:e.value}]),b&&b.datasets&&b.datasets.items&&b.datasets.items.length&&b.datasets.items.forEach(function(e){!0===e.predefined&&(e.predefined=!1)}),p.checkActiveSearch(f.taggerView)}},b&&b.events&&delete b.events;var A=e.merge(b||{},{showSuggestsOnFocus:!0,placeholder:a.getText("typestring"),multiSelect:!0,allowFreeInput:!f._predicate.isEnum(),noResultsMessage:!!f._predicate.isEnum()&&a.getText("noRslt"),events:m});if(f.hasSuggestSupport()?(A.datasets={name:"displayedSuggestions",items:[],configuration:{templateEngine:function(e,t,i){e.addClassName("default-template");var a=UWA.createElement("span",{class:"item-label"});a.setText(i.label),a.inject(e),!0===i.isUserText&&a.setStyle("font-style","italic")}}},"criteria"==f.taggerView.tabView.selectedTab.getName()&&(A.datasets.configuration.remoteSearchEngine=function(e,t){return new c(function(e,i){f.resolve=e,f.reject=i,f.debouncedRequestSuggestions(f._id,t)})})):f._predicate.isEnum()&&f.taggerView._customEnumFiltering&&(A.datasets.configuration={searchEngine:function(e,t){var i=t.trim().toLowerCase(),a=e.items.filter(function(e,t){var a=e.label.toLowerCase().indexOf(i);if(-1!==a)return e.matchInfo={matchFoundAt:a},!0});return a.sort(function(e,t){return e.matchInfo.matchFoundAt===t.matchInfo.matchFoundAt?0:e.matchInfo.matchFoundAt>t.matchInfo.matchFoundAt?1:-1}),a}}),f._predicate.isEnum())f.criterion[n]=new o(A);else{var N=o.extend({onClickOutside:function(){var e;if(d.log("Inside onClickOutside"),this.elements.input&&(e=this.elements.input.value),UWA.is(e,"string")&&e.length>0){d.log("Input freetext: "+e);var t=e.replace(/\||\n/g,"\t").replace(/^\s+|\s+$/g,"").split("\t").map(function(e){return e.trim()}).filter(function(e,t,i){return i.indexOf(e)===t}).map(function(e){return{value:e,selected:!0}});this.addItems(t,{items:[]})}f.hasSuggestSupport()&&this.resetCache(),this._parent()}});f.criterion[n]=new N(A)}if(f._predicate.isEnum()||(f.criterion[n].elements.input.onpaste=function(e){var t;if(e.preventDefault(),e.clipboardData&&UWA.is(e.clipboardData.getData,"function")?t=e.clipboardData.getData("text/plain"):window.clipboardData&&UWA.is(window.clipboardData.getData,"function")&&(t=window.clipboardData.getData("text")),UWA.is(t,"string")){var i=t.replace(/\||\n/g,"\t").replace(/^\s+|\s+$/g,"").split("\t").filter(function(e,t,i){return e.trim(),i.indexOf(e)===t}).map(function(e){return{value:e,selected:!0}});this.addItems(i,{items:[]})}}.bind(f.criterion[n])),f._predicate.isEnum()&&b.datasets&&b.datasets.items&&0===b.datasets.items.length){if(y[f._predicate.id()]&&y[f._predicate.id()].value){var V=y[f._predicate.id()].value;for(g=0,V.length;g<V.length;g++)S.push({type:"string",predicate:f._predicate,value:V[g].value,nls:V[g].label});delete y[f._predicate.id()]}}else{if(y[f._predicate.id()]){var P=y[f._predicate.id()].value||[];if(f._predicate.isEnum()||0===P.length)for(g=0;g<P.length;g++)f.criterion[n].getItem(P[g].value)&&f.criterion[n].onSelect(f.criterion[n].getItem(P[g].value));else for(f.criterion[n].addItems(P,{items:[]}),g=0;g<P.length;g++)P[g].pending&&delete P[g].pending}if(b.datasets&&b.datasets.items)b.datasets.items.filter(function(e){return!0===e.predefined}).forEach(function(e,t,i){y[f._predicate.id()]=y[f._predicate.id()]||{type:"string",value:[]},t=y[f._predicate.id()].value.map(function(e){return e.value}).indexOf(e.value),f.criterion[n].getItem(e.value)&&-1===t&&(f.criterion[n].onSelect(f.criterion[n].getItem(e.value)),y[f._predicate.id()].value.push(f.criterion[n].getItem(e.value))),1===i.length&&"ds6w:dataSource"===f._id&&(p.mask=!0)});else if(b.defaultValue){if(f._predicate.isEnum())console.warn("defaultValue ignored for enum predicate"+f._predicate.id()+", plz provide datasets.items");else{var D=null,O=[];if(y[f._predicate.id()]&&(O=y[f._predicate.id()].value.map(e=>e.label)),UWA.is(b.defaultValue,"string")?D=[b.defaultValue]:UWA.is(b.defaultValue,"array")&&(D=b.defaultValue),UWA.is(D,"array")){for(var U=[],F=0;F<D.length;F++){var j;(O.length>0&&!O.includes(D[F])||O.length<=0&&D.length>0)&&(j=D[F],UWA.is(j,"string")?U.push({value:j,selected:!0}):console.warn("default value provided is not a string, ignored..."))}U.length>0&&f.criterion[n].addItems(U,{items:[]})}}delete b.defaultValue}}this.criterion[n].inject(i.getElement(".add-tag-close"),"before");break;case"integer":case"float":case"double":var W=[],M=null,R="integer"===n?"int":"float";for(f.criterion[n]={},g=0;g<T.length;g++){var L=T[g];f.criterion[n][L]=new s({placeholder:b&&b.placeholder?b.placeholder:a.getText(L)+":"+a.getText("type"+R+("from"===L?"min":"max")),className:L});var k=function(e){var i,a={};i=(i=e.target.value).replace(",",".");var r=e.target.hasClassName("from")?"from":"to",s=i.length<=0;if(s||(s="int"===R?!isNaN(parseInt(i))&&parseInt(i)+""===i:!isNaN(parseFloat(i))&&parseFloat(i)+""===i),UWA.is(e.target.type,"string")&&"text"==e.target.type&&UWA.is(e.target.parentNode)){if(!0!==s)return e.target.parentNode.addClassName("has-error")&&!1;e.target.parentNode.removeClassName("has-error")}if(13===e.keyCode)if(!t&&i){var o={predicate:f._predicate,type:n};a[r]=i,o.value=a,W.push(o),y[f._predicate.id()]["from"===r?"to":"from"]&&((M={predicate:f._predicate,type:n}).value={},M.value["from"===r?"to":"from"]=y[f._predicate.id()]["from"===r?"to":"from"].value),M&&W.push(M),f.taggerView.observedNavImpl.createFreeInputs(W),f.taggerView.setActiveCriteria(!0,!0)}else t&&f.taggerView.onSearchLaunch();else{var l;if(y[f._predicate.id()]=y[f._predicate.id()]||{},y[f._predicate.id()].type=n,i)y[f._predicate.id()][r]={value:i,type:n};else l={predicate:f._predicate,type:n},y[f._predicate.id()][r]&&y[f._predicate.id()][r].value&&(l.value={},l.value[r]=y[f._predicate.id()][r].value,S.push(l)),delete y[f._predicate.id()][r];1===Object.keys(y[f._predicate.id()]).length&&delete y[f._predicate.id()]}f.taggerView.addOrRemoveClear(e)};"from"===L?(this.from_keyup_handler&&console.warn("keyup handler for 'from' field found, possibly an issue with AbstractPredicateView lifecycle...., Predicate type="+n),this.from_keyup_handler=k):(this.to_keyup_handler&&console.warn("keyup handler for 'to' field found, possibly an issue with AbstractPredicateView lifecycle...., Predicate type="+n),this.to_keyup_handler=k),f.criterion[n][L].elements.input.addEvent("keyup",k),y[f._predicate.id()]&&y[f._predicate.id()][L]&&f.criterion[n][L].setValue(y[f._predicate.id()][L].value)}UWA.is(b.defaultValue,"object")&&(UWA.is(b.defaultValue.from)&&(f.criterion[n].from.getValue()||(y[f._predicate.id()]=y[f._predicate.id()]||{type:n},f.criterion[n].from.setValue(b.defaultValue.from),y[f._predicate.id()].from={value:f.criterion[n].from.getValue(),type:n},delete b.defaultValue.from)),UWA.is(b.defaultValue.to)&&(f.criterion[n].to.getValue()||(y[f._predicate.id()]=y[f._predicate.id()]||{type:n},f.criterion[n].to.setValue(b.defaultValue.to),y[f._predicate.id()].to={value:f.criterion[n].to.getValue(),type:n},delete b.defaultValue.to))),this.criterion[n].from.inject(i.getElement(".from.add-tag-close"),"before"),this.criterion[n].to.inject(i.getElement(".to.add-tag-close"),"before");break;case"date":m.onChange=function(e){if(f.criterion[n]){var i,a,r="SPAN"===e.target.tagName?e.target.getClosest(".add-tag-cont").getElement("input").hasClassName("from"):e.target.hasClassName("from"),s=r?"from":"to",o={};if(y[f._predicate.id()]=y[f._predicate.id()]||{type:"date"},this.getValue()){if(y[f._predicate.id()][s]={value:this.getDate(),type:"date"},r?f.criterion[n].to.setMinDate(this.getDate()):f.criterion[n].from.setMaxDate(this.getDate()),!t){o[s]=this.getDate().getFullYear()+"/"+("0"+(this.getDate().getMonth()+1)).slice(-2)+"/"+("0"+this.getDate().getDate()).slice(-2);var l={predicate:f._predicate,value:o,type:n};f.taggerView.observedNavImpl.createFreeInputs([l])}}else a={predicate:f._predicate,type:"date"},i=(i=y[f._predicate.id()][s].value).getFullYear()+"/"+("0"+(i.getMonth()+1)).slice(-2)+"/"+("0"+i.getDate()).slice(-2),a.value={},a.value[s]=i,delete y[f._predicate.id()][s],1===Object.keys(y[f._predicate.id()]).length&&delete y[f._predicate.id()],this.setDate("",!0),t?S.push(a):f.taggerView.getObservedNavigator().getFocusedProxy().removeFreeInputs([a]),r?f.criterion[n].to.setMinDate(!1):f.criterion[n].from.setMaxDate(!1);f.taggerView.setActiveCriteria(!0,!0),f.taggerView.addOrRemoveClear(e)}};var B=f.taggerView.taggerRoot;if(f.criterion[n]=p.createDateInput({events:{onChange:m.onChange}},y[f._predicate.id()],B),UWA.is(b.defaultValue,"object")){var G;if(UWA.is(b.defaultValue.from,"string"))if(!f.criterion[n].from.getDate())3===(G=b.defaultValue.from.split("/")).length&&(y[f._predicate.id()]=y[f._predicate.id()]||{type:"date"},f.criterion[n].from.setDate(new Date(parseInt(G[0]),G[1]-1,G[2]),!0),y[f._predicate.id()].from={value:f.criterion[n].from.getDate(),type:"date"},delete b.defaultValue.from);if(UWA.is(b.defaultValue.to,"string"))if(!f.criterion[n].to.getDate())3===(G=b.defaultValue.to.split("/")).length&&(y[f._predicate.id()]=y[f._predicate.id()]||{type:"date"},f.criterion[n].to.setDate(new Date(parseInt(G[0]),G[1]-1,G[2]),!0),y[f._predicate.id()].to={value:f.criterion[n].to.getDate(),type:"date"},delete b.defaultValue.to)}for(g=0;g<T.length;g++){k=function(e){if(13!==e.keyCode)return!1;f.taggerView.onSearchLaunch()};"from"===T[g]?(this.from_keyup_handler&&console.warn("keyup handler for 'from' field found, possibly an issue with AbstractPredicateView lifecycle...., Predicate type=Date"),this.from_keyup_handler=k):(this.to_keyup_handler&&console.warn("keyup handler for 'to' field found, possibly an issue with AbstractPredicateView lifecycle...., Predicate type=Date"),this.to_keyup_handler=k),f.criterion[n][T[g]].elements.input.addEvent("keyup",k)}this.criterion[n].from.inject(i.getElement(".from.add-tag-close"),"before"),this.criterion[n].to.inject(i.getElement(".to.add-tag-close"),"before");break;case"boolean":m.onChange=function(e){var i={value:this.getValue()[0],label:"true"===this.getValue()[0]?a.getText("yes"):a.getText("no")};i&&!t?(f.taggerView.observedNavImpl.updateFreeInputs([{predicate:f._predicate,value:i.value,type:n,nls:i.label}],[{predicate:f._predicate,value:"true"===this.getValue()[0]?"false":"true",nls:"true"===this.getValue()[0]?a.getText("no"):a.getText("yes"),type:n}]),f.taggerView.setActiveCriteria(!0,!0)):(y[f._predicate.id()]&&S.push({predicate:f._predicate,value:y[f._predicate.id()].value.value,nls:y[f._predicate.id()].value.label,type:n}),i?y[f._predicate.id()]={value:i,type:n}:delete y[f._predicate.id()]),p.checkActiveSearch(f.taggerView)};var H=y[f._predicate.id()]?y[f._predicate.id()].value.value:null;if(!UWA.is(H)&&b&&UWA.is(b.defaultValue))if(UWA.is(b.defaultValue,"string")){var z={value:H=b.defaultValue.toLowerCase(),label:"true"===H?a.getText("yes"):a.getText("no")};y[f._predicate.id()]={type:n,value:z},delete b.defaultValue}else console.warn("defaultValue specified for boolean type of field is not a string");f.criterion[n]=new r({placeholder:a.getText("selectValue"),options:[{value:"true",label:a.getText("yes"),selected:"true"===H},{value:"false",label:a.getText("no"),selected:"false"===H}],events:m.onChange?m:{}}),f.boolean_keyup_handler&&console.warn("keyup handler for 'boolean' field found, possibly an issue with AbstractPredicateView lifecycle...."),f.boolean_keyup_handler=function(e){if(13!==e.keyCode)return!1;f.taggerView.onSearchLaunch()},f.criterion[n].elements.input.addEvent("keyup",f.boolean_keyup_handler),this.criterion[n].inject(i.getElement(".boolean"))}"integer"!==n&&"float"!==n&&"double"!==n&&"date"!==n||(this.taggerView.addOrRemoveClear(this.criterion[n].from.elements.input),this.taggerView.addOrRemoveClear(this.criterion[n].to.elements.input)),!0===p.mask&&v["ds6w:type"]&&v["ds6w:type"].criterion.string&&0===v["ds6w:type"].criterion.string.datasets[0].items.length&&(l.mask(v["ds6w:type"].criterion.string.elements.container),p.mask=!1)}},getTagValueViewOfSelectedDate:function(e,t,i,a){var n,r,s,o,l=[];if(1===(r=t.split("/").length))if(n=e.length>1?e.filter(function(e){return e.id()===t}).pop():e[0],i)for(s=n.getChildrenTagValueViews(),o=0;o<s.length;o++)-1!==s[o].getDisplayname().toLowerCase().indexOf(a)&&l.push(s[o]);else l=n.getChildrenTagValueViews();else if(2===r)if(n=(n=e.length>1?e.filter(function(e){return e.id()===t.split("/")[0]}).pop().getChildrenTagValueViews():e[0].getChildrenTagValueViews()).length>1?n.filter(function(e){return e.id()===t}).pop():n[0],i)for(s=n.getChildrenTagValueViews(),o=0;o<s.length;o++)-1!==s[o].getDisplayname().toLowerCase().indexOf(a)&&l.push(s[o]);else l=n.getChildrenTagValueViews();else if(3===r)if(n=(n=(n=e.length>1?e.filter(function(e){return e.id()===t.split("/")[0]}).pop().getChildrenTagValueViews():e[0].getChildrenTagValueViews()).length>1?n.filter(function(e){return e.id()===t.split("/").slice(0,-1).join("/")}).pop().getChildrenTagValueViews():n[0].getChildrenTagValueViews()).length>1?n.filter(function(e){return e.id()===t}).pop():n[0],i)for(s=e[0].getChildrenTagValueViews()[0].getChildrenTagValueViews(),o=0;o<s.length;o++)-1!==s[o].getDisplayname().toLowerCase().indexOf(a)&&l.push(s[o]);else l=n.getMotherView().getChildrenTagValueViews();return{motherDate:n,tvv:l}},updateGraphColors:function(){var e=this.taggerView.getObservedNavigator().getCache();if(this.tvvForGraph&&this.dataForGraph&&this.dataForGraph.completeData&&this.tvvForGraph.length===this.dataForGraph.completeData.length){var t=this;this.tvvForGraph.forEach(function(i,a){t.dataForGraph.completeData[a].color=e.colorManager.getNewColorForTagValue(i)})}},getElementTvvForGraph:function(e,t){var i,n,r,s=!1,o=1,l=[],c=0,d=0,g=0,u=this,h=[],p=[],f=[],m=[],v=this.taggerView.getObservedNavigator().getCache();function T(e,t){var i,a={name:e.getDisplayname(),id:u.taggerView.getDOMId(e.getSelectedTagId()),category:e.getDisplayname(),y:e.nbSubjectsTagged(),selected:e.isSelectedTag(),sliced:e.isSelectedTag(),color:v.colorManager.getNewColorForTagValue(e)};return t&&(i=new Date(e.id().split("/").join("-")),a.x=Date.UTC(i.getFullYear(),i.getMonth(),i.getDate())),a}function C(e,t,i){return{name:e,category:t,y:i,selected:!1,sliced:!1}}if(m=e.slice(0),e.length&&"date"===e[0].type())switch(s=!0,e[0].getDateLevel()){case"year":o=365;break;case"month":o=30;break;case"day":o=1}for(i=0;i<e.length;i++)c+=e[i].nbSubjectsTagged();for(i=0;i<e.length;i++)100*e[i].nbSubjectsTagged()/c<.5?h.push(e[i]):p.push(e[i]);if(d=0,h.length>0&&void 0!==h)for(i=0;i<h.length;i++)d+=h[i].nbSubjectsTagged();if(n=this.taggerView.getObservedNavigator().getCache().getCurrentSort(this._predicate.getFullPredicateID()),r=s&&"alphaSort"===n.sortMode&&t,p.length>31)if("nbSort"===n.sortMode&&!1===n.order)for(f=p.splice(31,p.length),i=0;i<f.length;i++)g+=f[i].nbSubjectsTagged();else for(f=p.splice(0,p.length-31),i=0;i<f.length;i++)g+=f[i].nbSubjectsTagged();if(d<.75*c&&!t&&h.length>0){if("alphaSort"===n.sortMode){for(i=0;i<p.length;i++)l.push(T(p[i],r));l.push(C(a.getText("otherUnderThreshold"),a.getText("otherUnderThreshold"),d)),f.length>0&&l.push(C(a.getText("other"),a.getText("other"),g))}else if(!0===n.order)for(l.push(C(a.getText("otherUnderThreshold"),a.getText("otherUnderThreshold"),d)),f.length>0&&l.push(C(a.getText("other"),a.getText("other"),g)),i=0;i<p.length;i++)l.push(T(p[i],r));else if(!1===n.order){for(i=0;i<p.length;i++)l.push(T(p[i],r));f.length>0&&l.push(C(a.getText("other"),a.getText("other"),g)),l.push(C(a.getText("otherUnderThreshold"),a.getText("otherUnderThreshold"),d))}}else if(e.length>31)if("nbSort"===n.sortMode)if(!0===n.order){for(f=m.splice(0,e.length-31),i=0;i<f.length;i++)g+=f[i].nbSubjectsTagged();for(f.length>0&&l.push(C(a.getText("other"),a.getText("other"),g)),i=0;i<m.length;i++)l.push(T(m[i],r))}else{for(f=m.splice(31,m.length-31),i=0;i<f.length;i++)g+=f[i].nbSubjectsTagged();for(i=0;i<m.length;i++)l.push(T(m[i],r));f.length>0&&l.push(C(a.getText("other"),a.getText("other"),g))}else{for(f=m.splice(0,m.length-31),i=0;i<f.length;i++)g+=f[i].nbSubjectsTagged();for(i=0;i<m.length;i++)l.push(T(m[i],r));f.length>0&&l.push(C(a.getText("other"),a.getText("other"),g))}else for(i=0;i<m.length;i++)l.push(T(m[i],r));return{completeData:l,dateRange:r?24*o*3600*1e3:null,datetime:r,reversed:!n.order}},tvvToHtml:function(e,t){var i,a,n,r,s,o,l,c,d=0,u=0,h="",f="",T=this._predicate.getFullPredicateID(),C=this.taggerView.getDOMId(T),w=this._predicate.getType()?this._predicate.getType():this._tagValueViews[0]?this._tagValueViews[0].type():"string",b=this._predicate.isTypeValidBool(),y=this.taggerView.getObservedNavigator().getCache(),S=this.taggerView._simplifiedTagger?this.taggerView.getCacheSimplified().getViewMode(this.id(),this._predicate.is6WRoot()?void 0:this._predicate.get6WRootFather().id()):y.getViewMode(this.id()),E=(this.taggerView.getObservedNavigator().getFocusedProxy(),y.colorManager);this.isColorized=this.taggerView.isColorizePossible(this.id())&&(E.isColorized(T)||E.isInColorization(T));let I=this.taggerView.getObservedNavigator().hasProxiesInEdition();if("freeInput"===S&&I&&(S="tag"),"freeInput"!==S||this.taggerView.isProxyWithFilteringOnServer()||(y.setViewMode(this.id(),"tag"),S=y.getViewMode(this.id())),this.taggerView.hasFreeInputOnly(this.id())&&!I&&(S="freeInput"),this._hasHierarchicalTags&&"people"==S&&this.taggerView._simplifiedTagger&&(S="tag",this.taggerView.getCacheSimplified().setViewMode(this.id(),S)),a=y.getSearchValue().toLowerCase(),n=y.getSearchId(),i=y.isSearchVisible()&&""!==a&&("filter-all"===n||n.replace("filter-","")===this._predicate.get6WRootFather().id().replace("ds6w:","")),this.taggerView._simplifiedTagger&&!t&&!i){this.updateCompositeStatus();let e=this.taggerView.getObservedNavigator().getProxiesToDisplay();e.length&&e.some(e=>e.isFeatureSupported("grouping"))&&(r=function(e,t){return this.taggerView.getObservedNavigator().isGroupedBy(this._predicate.id(),e,t)}.bind(this))}switch(!e&&i||(this._tagValueViews=this.sortTagValues(this._tagValueViews)),"freeInput"!==S&&0!==this._tagValueViews.length&&"date"===this._tagValueViews[0].type()&&(c=this.taggerView.getListOfSelectedTagValues(this.getCompleteID())).length&&(h=c[0].uri),t?(s=v,S="freeInput"):this.taggerView._simplifiedTagger&&!t&&"freeInput"==S?(s=m,(this.taggerView.hasFreeInputOnly(this.id())||this.taggerView.hasFreeInputSupport(this.id()))&&"date"==w&&(S="calendar")):s=m,S){case"tag":this.isColorized||E.clearComputedColorMap(T);var x="tree"===this._tagValueViews[0].type(),_=this.taggerView.getMoreLimitForPredicate(this._predicate.id());let n=!1;if(g.getOption("activate_hierarchical_tag_scroll"))for(A=0;A<this._tagValueViews.length&&A<=_;A++){let e=this._tagValueViews[A].getSelectedTagId(),t=this.taggerView.getDOMId(e);if(y.isTagTreeExpanded(t)){n=!0;break}}if(f+="<ul class='tags-list "+(x?" treeview":"")+(n?" manage-horizontal-scroll":"")+("date"===w?" date":"")+"'>",i){for(A=0;A<this._tagValueViews.length;A++)(o=this._tagValueViews[A].getNbTagMatch(a))>0&&d<_?(f+=this._tagValueViews[A].toHtml(d<_,!1,h,a,b,r,I),d+=o):o>0&&(u+=o);0!==u&&(f+=p.more(u)),d>0?y.expandPredicate(this.taggerView._simplifiedTagger?this._predicate.id():this.idForDOM()):!this._isRootPredView&&this.taggerView.isW||!this.taggerView.isW?y.collapsePredicate(this.idForDOM()):-1===this.getDisplayname().toLowerCase().indexOf(a)&&(this._hiddenPredicate=!0)}else for(A=0;A<this._tagValueViews.length&&A<=_;A++)f+=A!==_?this._tagValueViews[A].toHtml(A<_,!1,h,"",b,r,I):p.more(this._tagValueViews.length-_);f+="</ul>";break;case"freeInput":this._predicate.getElemOptions();switch(w="tree"===w?"string":w){case"dateTime":case"date":case"integer":case"float":case"double":f+="<div class='add-tag-cont fromto'>",f+=p.freeInputToHtml(w,this);break;case"boolean":case"string":f+="<div class='add-tag-cont'>",f+=p.freeInputToHtml(w,this)}s[this.id()]=this,f+="</div>";break;case"category":if(f+="<div class='category-view ' id='"+C.concat("_category")+"'></div>",m[this.id()]=this,i)this._tagValueViews.filter(function(e){return e.getNbTagMatch(a)>0}).length>0&&y.expandPredicate(this.taggerView._simplifiedTagger?this._predicate.id():this.idForDOM());break;case"people":if(f+="<div class='people-view-container' id='"+C.concat("_people")+"'></div>",m[this.id()]=this,y.colorManager.isColorized(T))for(var A=0;A<this._tagValueViews.length;A++)y.colorManager.getNewColorForTagValue(this._tagValueViews[A]);if(i)this._tagValueViews.filter(function(e){return e.getNbTagMatch(a)>0}).length>0&&y.expandPredicate(this.taggerView._simplifiedTagger?this._predicate.id():this.idForDOM());break;case"calendar":f+="<div class='date-view-container'></div>",s[this.id()]=this;break;case"graphBar":case"graphPie":var N,V="graphBar"===S,P=(C=this.taggerView.getDOMId(T)).concat("_graph");if(0!==(N=i?this._tagValueViews.filter(function(e){return e.getNbTagMatch(a)>0}):this._tagValueViews).length){if(i&&y.expandPredicate(this.taggerView._simplifiedTagger?this._predicate.id():this.idForDOM()),"date"===N[0].type()&&""!==h){var D=this.getTagValueViewOfSelectedDate(N,h,i,a),O=D.motherDate;O&&(this._tagValueMarkup="<ul class='date-filters'>"+O.toHtml(!0,!0)+"</ul>"),N=this.sortTagValues(D.tvv)}this.dataForGraph=this.getElementTvvForGraph(N,V),this.tvvForGraph=N;var U=this.dataForGraph.completeData.length;this.dataForGraph.datetime&&(U=Math.abs(this.dataForGraph.completeData[U-1].x-this.dataForGraph.completeData[0].x)/this.dataForGraph.dateRange),l=(l=30*U+80)>310&&V?l:null,this.dataForGraph.widthBarChartGraph=l,m[this.id()]=this,f+="<div class='graph' id='"+P+"'></div>"}else-1===this.getDisplayname().toLowerCase().indexOf(a)&&(y.collapsePredicate(this.idForDOM()),this._hiddenPredicate=!0)}let F=this.taggerView.actionManager?this.taggerView.actionManager.getCurrentAction():void 0;if(y.colorManager.isColorized(T)&&(!F||F&&"colorize"!==F.id)){var j=[],W=h?3===h.split("/").length?3:h.split("/").length+1:1;if("date"===this._predicate.getType()){for(A=0;A<E.computedColorMap[T].tagColors.length;A++)E.computedColorMap[T].tagColors[A].object.split("/").length==W&&j.push(E.computedColorMap[T].tagColors[A]);this.taggerView.warnForColorize({}[T]={tagColors:j})}else x?(this.taggerView.warnForColorize({}[T]={tagColors:E.getComputedMap(T).tagColors.concat(E.getColoredTreeTagList())}),E._clearTempTreeMap()):this.taggerView.warnForColorize(E.getComputedMap(T))}return f},toHtml:function(t,i,n,r){var s,o=this.id(),l=p.isInFavorites(o)||!1,c=this.taggerView.getObservedNavigator().getCache().isMoreClicked(),d=this.taggerView.getObservedNavigator().getCache(),g=(r=d.getSearchValue().toLowerCase(),d.isSearchVisible()&&""!==r&&("filter-all"===d.getSearchId()||d.getSearchId().replace("filter-","")===this._predicate.get6WRootFather().id().replace("ds6w:",""))),u=this._predicate.getElemOptions(),h=function(e){return-1!==e.getDisplayname().toLowerCase().indexOf(r)||e.getChildrenTagValueViews().some(h)};if(n=n||!1,(i=i||!1)===l){if(this._hiddenPredicate=g&&!this._tagValueViews.some(h),g&&!this._hiddenPredicate&&d.collapsePredicate(this.idForDOM()),this._tagValueMarkup="",this.destroyUiElement(n),s="",this._tagValueViews.length&&!n||n&&(u&&(!0===u.showByDefault||void 0===u.showByDefault)||c)){if(s=this.tvvToHtml(t,n)+"</div>",this.taggerView._simplifiedTagger&&!n)if("ds6w:type"==o)if("tag"==this.taggerView.getCacheSimplified().getViewMode(o)){var f=this.taggerView.buildTypeToggleElem({viewMode:"tag",text:a.getText("showLess")}),m=e.createElement();m.grab(f),s+=m.getHTML()}let i=/ /g;s+="</div></li><div id="+o.trim().replace(i,"_")+"></div>",s=this.headerToHtml(this._tagValueMarkup,this._hiddenPredicate,n)+s}return s}},headerToHtml:function(e,t,i){var a="",n=this.taggerView.isColorizePossible(this.id());return e=e||"",a+=p.predHeader(this,this.taggerView,e,t,null,!1,n,this.isColorized,i),a+=p.openingPredContent(this,!1,e,i)}})).openingPredContent=function(e,t,i,a){var n,r,s,o="";return e&&(r=e._predicate&&e._predicate.getType(),s=e.taggerView._simplifiedTagger?e.taggerView.getCacheSimplified().getViewMode(e._predicate.id()):""),n=!e.taggerView.getObservedNavigator().getCache().isPredicateCollapsed(e.taggerView._simplifiedTagger?e._id:e.idForDOM())||e.taggerView.observedNavImpl.hasProxiesInEdition()&&e._predicate.is6WRoot()||a,e.taggerView.observedNavImpl.hasFocusedProxyWithRelevantPredicate()&&(n=e.taggerView.getExpandStatus(e._id)||n),e.taggerView.isW&&e._predicate.is6WRoot()&&(n=t&&e._predicate.is6WRoot()),i=i||"",o+="<div class='predicate-content expandable'",e.taggerView.isW?o+=n?'style="height: auto; position: relative;"':'style="height: 0px; overflow: hidden;position: absolute;"':o+=n?'style="opacity: 1; height: auto; position: relative;"':'style="opacity: 0; height: 0px; overflow: hidden;position: absolute;"',g.getOption("activate_hierarchical_tag_scroll")&&e.getHasHierarchyTags()&&"date"!==r&&"tag"==s?o+="><div class='innerForTransition add-horizontal-scroll'>":o+="><div class='innerForTransition'>",o},p.getArrayDayOfMonth=function(e,t,i){var a,n,r,s=[];if(a="02"===t?e%4!=0||e%100==0&&e%400!=0?28:29:["04","06","09","11"].indexOf(t)>=0?30:31,i)for(r=1;r<=a;r++)n=r>9?String()+r:"0"+r,s.push(n);else for(r=a;r>0;r--)n=r>9?String()+r:"0"+r,s.push(n);return s},p.isInFavorites=function(e){return f[e]},p.more=function(e){var t="";return t+="<li class='tag more' title='"+e+" "+a.getText("moreHidden")+"'>",t+="<div class='tag-elem'><div class='tag-label'><span class='fonticon fonticon-dot-3'></span><span class='fonticon fonticon-right-dir'></span></div>",t+="<div class='tag-tail'><div class='tag-count'>"+a.convertToUnity(e)+"</div></div></div>",t+="</li>"},p.predHeader=function(e,t,n,r,s,o,l,c,d){var g,u,h,p=t.getObservedNavigator().getCache(),f=(o?"atv":"")+e.idForDOM(),m=!p.isPredicateCollapsed(t._simplifiedTagger?e._id:e.idForDOM())||t.observedNavImpl.hasProxiesInEdition()&&e._predicate.is6WRoot(),v=p.isCloud(e.idForDOM()),T=p.isToolboxVisible(e.idForDOM()),C=e.getDisplayname(),w=(e&&e._predicate&&e._predicate.getType(),s||e.getNbDescendantTagValues()),b=p.getCurrentSort(e._predicate.getFullPredicateID()),y=t._simplifiedTagger?t.getCacheSimplified().getViewMode(e._predicate.id()):p.getViewMode(e._predicate.id()),S=t.isProxyWithFilteringOnServer(),E=t.hasFreeInputSupport(e._id),I=t.hasFreeInputOnly(e._id),x=t.getExpandStatus(e._id),_=t.isGroupedBy(e._id),A=e._predicate.get6WRootFather().id().replace("ds6w:",""),N=t.observedNavImpl.hasProxiesInEdition(),V=p.isActivePredicate(e.getCompleteID()),P=0!==e.getChildrenTagValueViews().length&&e.getChildrenTagValueViews()[0].nbSubjectsTagged()<0,D=t.getObservedNavigator().isPreciseCount(),O=t.getObservedNavigator().isRelevantPredicate(e.id())&&!r,U=t.actionMode,F=p.colorManager.isColorized(e._predicate.getFullPredicateID())||p.colorManager.isInColorization(e._predicate.getFullPredicateID());if(_||"ds6w:type"!=e._id||(_=t.isGroupedBy("type_categorization")),d){var j=e._predicate.getUnit();j&&(C+=" ("+j+")")}n=n||"",u="nbSort"===b.sortMode?(b.order?"asc ":"desc ")+"selected":b.secondaryorder?"asc ":"desc ",h="nbSort"===b.sortMode?b.secondaryorder?"asc ":"desc ":(b.order?"asc ":"desc ")+"selected";let W=!1;F&&!T&&(W=!0);let M=t.actionManager?t.actionManager.getCurrentAction()&&"colorize"==t.actionManager.getCurrentAction().id:void 0;g="<li class='predicate "+(O?"more-relevant ":"")+((e.taggerView.observedNavImpl.hasFocusedProxyWithRelevantPredicate()?x||m:m||d)?"expanded ":"")+(v?"":"list-view ")+A+(r?" searchexcluded ":"")+(c?" colorize ":"")+("when"==A&&U?" group-disabled ":"")+(V?" selected ":"")+"' id='"+f+(d?"sug":"")+"' data-rec-id='"+f+"' predicate='"+e.id()+"'><div class='predicate-header"+(_?" grouped-by":"")+"'title='"+C+"'>",g+=o?"":t._simplifiedTagger?"<div class='arrow'><span class='fonticon fonticon-chevron-down'></span><span class='fonticon fonticon-chevron-right'></span></div>":"<div class='arrow'><span class='fonticon fonticon-down-dir'></span><span class='fonticon fonticon-right-dir'></span></div>",g+=t._simplifiedTagger?"<div class='predicate-label "+(W?"adjust-width":"")+"'><div class='pred-label'>"+C+"</div>":"<div class='predicate-label'><span class='fonticon fonticon-3ds-"+A+"'></span>"+C,/*!isToolboxVisible && */_&&(g+="<span class='action-icon fonticon fonticon-group' action='group' title='"+a.getText("remove_groupBy")+"'></span>"),g+="</div>",g+="<a class='clear-selection "+(M&&F?"":"hide")+"' title='"+a.getText("clear-selections")+"'>"+a.getText("clearSearch")+"</a><span class='action-icon fonticon fonticon-palette "+(W&&!M?"":"hide")+"' action='colorize' title='"+a.getText("uncolorizeTags")+"'></span>";var R="category"==y,L="people"===y,k="ds6w:who"!==e._predicate.id()&&"ds6w:who"==e._predicate.get6WRootFather().id();if(I||R||(g+="<div class='predicate-count' title='"+w+"'>"+a.convertToUnity(w,D)+"</div>"),"atvid_"!==f.substring(0,6)&&!d&&!I){if(g+="<div class='toolbox "+(T?"expanded":"")+"' title='"+a.getText("toolbox")+"'><span class='fonticon fonticon-menu-dot'></span>","ds6w:type"==e._id&&(R?(g+="<span class='tool-icon categoryViewIcon toolboxView fonticon fonticon-view-small-thb selected' title='"+a.getText("categoryView")+"'></span>",g+="<span class='tool-icon toolboxView fonticon tags-view "+(v?"fonticon-th-tag":"fonticon-list")+"' title='"+a.getText("tagsView")+"'></span>",g+="<span class='option-disabled tool-icon sort fonticon fonticon-sort-alpha-asc selected' title='"+a.getText("alphabeticalOrder")+"'></span>",g+="<span class='option-disabled tool-icon sort fonticon fonticon-sort-num-asc' title='"+a.getText("occurenceOrder")+"'></span>",g+="<span class='option-disabled tool-icon toolboxView bar fonticon fonticon-chart-bar ' title='"+a.getText("barChart")+"'></span>",g+="<span class='option-disabled tool-icon toolboxView pie fonticon fonticon-chart-pie ' title='"+a.getText("pieChart")+"'></span>",l&&(g+="<span class='option-disabled tool-icon toolboxView fonticon fonticon-palette "+(c?"selected ":"")+" "+(M?"hide":"")+"' title='"+a.getText("colorize")+"'></span>")):t._simplifiedTagger&&(g+="<span class='tool-icon categoryViewIcon toolboxView fonticon fonticon-view-small-thb ' title='"+a.getText("categoryView")+"'></span>")),k)if(L)"person"!=e._id?(g+="<span class='tool-icon peopleView toolboxView fonticon fonticon-user-alt selected ' title='"+a.getText("peopleView")+"'></span>",g+="<span class='tool-icon toolboxView fonticon tags-view "+(v?"fonticon-th-tag":"fonticon-list")+"' title='"+a.getText("tagsView")+"'></span>",g+="<span class='tool-icon sort fonticon fonticon-sort-alpha-"+h+"' title='"+a.getText("alphabeticalOrder")+"'></span>",g+="<span class='tool-icon sort fonticon fonticon-sort-num-"+u+"' title='"+a.getText("occurenceOrder")+"'></span>",t.hasAdvancedFocsuedProxy()||(g+="<span class='tool-icon toolboxView bar fonticon fonticon-chart-bar ' title='"+a.getText("barChart")+"'></span>",g+="<span class='tool-icon toolboxView pie fonticon fonticon-chart-pie ' title='"+a.getText("pieChart")+"'></span>",l&&(g+="<span class='tool-icon toolboxView fonticon fonticon-palette "+(c?"selected ":"")+" "+(M?"hide":"")+"' title='"+a.getText("colorize")+"'></span>"))):(g+="<span class='tool-icon sort fonticon fonticon-sort-alpha-"+h+"' title='"+a.getText("alphabeticalOrder")+"'></span>",g+="<span class='tool-icon sort fonticon fonticon-sort-num-"+u+"' title='"+a.getText("occurenceOrder")+"'></span>");else if(t._simplifiedTagger&&!e._hasHierarchicalTags){let t=i.COMMUNITY_TAGS_PREDICATES["ds6w:who"].id(),n=i.COMPANY_TAGS_PREDICATES["ds6w:who"].id();e._id!=t&&e._id!=n&&(g+="<span class='tool-icon peopleView toolboxView fonticon fonticon-user-alt ' title='"+a.getText("peopleView")+"'></span>")}R||L||(g+="<span class='tool-icon toolboxView fonticon tags-view "+("tag"===y?"selected ":"")+(v?"fonticon-th-tag":"fonticon-list")+"' title='"+a.getText("tagsView")+"'></span>",g+="<span class='tool-icon sort fonticon fonticon-sort-alpha-"+h+"' title='"+a.getText("alphabeticalOrder")+"'></span>",P||(g+="<span class='tool-icon sort fonticon fonticon-sort-num-"+u+"' title='"+a.getText("occurenceOrder")+"'></span>",g+="<span class='tool-icon toolboxView bar fonticon fonticon-chart-bar "+("graphBar"===y?"selected ":"")+"' title='"+a.getText("barChart")+"'></span>",g+="<span class='tool-icon toolboxView pie fonticon fonticon-chart-pie "+("graphPie"===y?"selected ":"")+"' title='"+a.getText("pieChart")+"'></span>"),l&&(g+="<span class='tool-icon toolboxView fonticon fonticon-palette "+(c?"selected ":"")+" "+(M?"hide":"")+"' title='"+a.getText("colorize")+"'></span>"),S&&E&&!N&&(g+="<span class='tool-icon toolboxView fonticon fonticon-text "+("freeInput"===y?"selected ":"")+"' title='"+a.getText("inputText")+"'></span>")),g+="</div>"}return g+="</div>"},p.freeInputToHtml=function(e,t){var i="";switch(e){case"string":i+="<span class='add-tag-close'><span class='fonticon fonticon-cancel-circled'></span></span>";break;case"date":i+="<span class='from add-tag-close'><span class='fonticon fonticon-cancel-circled'></span></span>",i+="</div><div class='add-tag-cont fromto'>",i+="<span class='to add-tag-close'><span class='fonticon fonticon-cancel-circled'></span></span>";break;case"integer":case"float":case"double":e="integer"===e?"int":"float",i+="<span class='from add-tag-close'><span class='fonticon fonticon-cancel-circled'></span></span>",i+="</div><div class='add-tag-cont fromto'>",i+="<span class='to add-tag-close'><span class='fonticon fonticon-cancel-circled'></span></span>";break;case"boolean":i+="<span class='boolean'></span>"}return i},p.createDateInput=function(t,i,r){var s,o,l={},c=["from","to"];for(s=0;s<c.length;s++)"from"==(o=c[s])&&i&&!i[o]&&i.to?l[o]=new n(e.merge({max:i&&"from"===o?new Date(i.to.value):null,min:i&&i[o]&&i[o]&&"to"===o?new Date(i[o].value):null,placeholder:a.getText(o),className:"date freeinput tagger-input "+o,renderTo:r},t)):(l[o]=new n(e.merge({max:i&&i[o]&&"from"===o&&i.to?new Date(i.to.value):null,min:i&&i[o]&&"to"===o&&i.from?new Date(i.from.value):null,placeholder:a.getText(o),className:"date freeinput tagger-input "+o,renderTo:r},t)),i&&i[o]&&l[o].setDate(i[o].value,!0));return l},p.destroyUiElements=function(){var e;for(e in m)m[e].destroyUiElement();for(e in m={},v)v[e].destroyUiElement(!0)},p.redrawUiElements=function(e,t){var i;if(e)for(i in v)v[i].redrawUiElement(!0);else for(i in m)t?m[i]._predicate.get6WRootFather().id()==t&&m[i].redrawUiElement():m[i].redrawUiElement()},p.getPvWithUiElemInSuggested=function(){return v},p.getPvWithUiElemInPage=function(){return m},p.checkActiveSearch=function(e){var t=e.getObservedNavigator().getFocusedProxy();if(!t)throw new Error("ERROR : AbstractPredicateView.checkActiveSearch is called when there is no focused proxy !!!");var i=e.getObservedNavigator().getCache().getCriteriaToResetBeforeFilterChange(t?t.id():void 0),a=e.getObservedNavigator().getCache().getCriteriaToRemoveBeforeFilterChange(t?t.id():void 0);return Object.keys(i).length>=2||1===Object.keys(i).length&&"ds6w:dataSource"!==Object.keys(i)[0]||0!==Object.keys(a).length&&(1===Object.keys(i).length?"ds6w:dataSource"!==Object.keys(i)[0]:Object.keys(i).length>=2)?(e.getSearchButton().enable(),!0):(e.getSearchButton().disable(),!1)},p.onSearchLaunch=function(e,t){var a,n,r,s,o,l,c,d=[],g=!1,u=["from","to"],h=e.getObservedNavigator().getFocusedProxy();if(!h)throw new Error("ERROR : AbstractPredicateView.onSearchLaunch is called when there is no focused proxy !!!");var f=e.getObservedNavigator().getCache().getCriteriaToResetBeforeFilterChange(h?h.id():void 0),m=e.getObservedNavigator().getCache().getCriteriaToRemoveBeforeFilterChange(h?h.id():void 0);if(p.checkActiveSearch(e)){for(a in t)if(s=i.getPredicate(a),f[a]){var v=f[a].type;switch(v){case"string":if((n=f[a].value).length)for(r=0,n.length;r<n.length;r++)d.push({type:"string",predicate:s,value:n[r].value,nls:n[r].label});break;case"boolean":(n=f[a].value)&&d.push({predicate:s,value:n.value,type:v,nls:n.label});break;case"integer":case"float":case"double":case"date":for(l={},r=0;r<u.length;r++)o=u[r],(n=f[a][o]?f[a][o].value:null)&&("date"!==v?(c=t[a].criterion,l[o]=n.replace(",","."),isNaN(parseFloat(l[o]))?(c[v][o].elements.input.addClassName("has-error"),g=!0):c[v][o].elements.input.removeClassName("has-error")):l[o]=n.getFullYear()+"/"+("0"+(n.getMonth()+1)).slice(-2)+"/"+("0"+n.getDate()).slice(-2),d.push({predicate:s,value:l,type:v}))}}!1===g&&e.observedNavImpl.updateFreeInputs(d,m)}},p}),define("DS/TagNavigator/RootPredicateView",["UWA/Class","DS/TagNavigator/AbstractPredicateView"],function(e,t){"use strict";var i,a={},n=["ds6w:who","ds6w:when","ds6w:what","ds6w:where","ds6w:why","ds6w:how"];return(i=e.extend(t,{init:function(e,t){this._isRootPredView=!0,this._predicateViews=[],this._parent(e,t)},getChildrenPredicateViews:function(e){var t,i,a,n;for(e||(e=function(){return!0}),n=[],i=0,a=this._predicateViews.length;i<a;i++)e((t=this._predicateViews[i]).id())&&n.push(t);return n},addPredicateView:function(e){var t;if(this.getChildrenPredicateViews(function(t){return t===e.id()}).length>0)throw new Error("Unexpected addition of already existing child PredicateView ");return e.isRootPredView()?this._predicateViews.push(e):(t=this.findInsertionPoint(this._predicateViews,e,this.predComparator),this._predicateViews.splice(t,0,e)),this},clearContent:function(){var e,t;for(e=0,t=this._predicateViews.length;e<t;e++)this._predicateViews[e].clearContent();return this._predicateViews=[],this._parent(),this},headerToHtml:function(e,i){var a,n;return this.taggerView.isW?(e||(e=""),n=function(e,t){var i,a,n;for(i=0,a=(n=this._predicateViews).length;i<a;i++)t+=n[i]._tagValueViews.length;return t}.bind(this),a=n(this,this._tagValueViews.length),this.rootpredHeader(this.idForDOM(),this.id(),!this.taggerView.observedNavImpl.getCache().isSectionCollapsed(this.id().replace("ds6w:","")),this._displayName,a)+t.openingPredContent(this,!this.taggerView.observedNavImpl.getCache().isSectionCollapsed(this.id().replace("ds6w:","")),!!this.taggerView.isW&&this.id().replace("ds6w:",""),e)):this._parent(e,i)},rootpredHeader:function(e,t,i,a,n){return"<div class='section ds6w-root-predicate "+t.replace(":","_")+(i?" expanded-section":"")+"' id='"+e+"'>"+this.taggerView.sectionHeaderToHtml(a.toLowerCase(),{count:n,isw:!0})},toHtml:function(e,i,a,n,r){var s;return s="",this._tagValueMarkup="",this._hiddenPredicate=!1,this.taggerView.isW?(s=this.headerToHtml(),this._tagValueViews.length&&(s+=this.tvvToHtml(e)),this._predicateViews.length&&(this._predicateViews.sort(this.predComparator),s+="<ul class='predicates-list'>"+this._predicateViews.map(function(e){return e.toHtml()}).join("")+"</ul>"),s+="</div></div></div>"):(r||(r=this.taggerView.observedNavImpl.getCache().get6WSort()),"sort-tag"===r?(this._predicateViews.length||this._tagValueViews.length)&&(this._tagValueViews.length&&!this.taggerView._simplifiedTagger&&(s+=this._parent(e,t.isInFavorites(this.id()))),this._predicateViews.length&&(this._predicateViews.sort(this.predComparator),s+=this._predicateViews.map(function(e){return e.toHtml()}).join(""))):this._tagValueViews.length&&(s+=this._parent(e,t.isInFavorites(this.id())))),s},hasExplicitTags:function(){return this._tagValueViews.length>0},toHtmlForSeach:function(){var e="";return this._tagValueViews.length&&(e+=this.tvvToHtml()),this._predicateViews.length&&(this._predicateViews.sort(this.predComparator),e+="<ul class='predicates-list'>"+this._predicateViews.map(function(e){return e.toHtml()}).join("")+"</ul>"),e}})).getRoots=function(e){var t,i,r,s;for("boolean"!=typeof e&&(e=!1),s=[],i=0,r=n.length;i<r;i++)t=a[n[i]],(!e||t.getNbDescendantTagValues()>0)&&s.push(t);return s},i.clear=function(){var e,t,i;if(Object.keys(a).length){for(t=0,i=n.length;t<i;t++)(e=a[n[t]])&&e.clearContent();a={}}return this},i.getRootPredicateView=function(e,t){var n=e.id();return a[n]||(a[n]=new i(e,t)),a[n]},i}),define("DS/TagNavigator/PredicateView",["UWA/Class","DS/TagNavigator/AbstractPredicateView","DS/TagNavigator/RootPredicateView","DS/TagNavigator/Logger"],function(e,t,i,a){"use strict";var n,r={};return(n=e.extend(t,{init:function(e,t){this._parent(e,t),this._rootPredicateView=n.getPredicateView(e.get6WRootFather(),this.taggerView),this._rootPredicateView.addPredicateView(this),this.weight=e.weight||1},clearContent:function(e){var t,i;for(this.destroyUiElement(),this.destroyUiElement(!0),t=0,i=this._tagValueViews.length;t<i;t++)this._tagValueViews[t].clearContent();return this._tagValueViews=[],this._tagValueViewsMap={},e||(this.taggerView=null),this.hasHierarchicalTags=!1,this}})).clear=function(){return r={},t.destroyUiElements(),this},n.getListOfHierarchyPredicates=function(){let e=[];for(let t in r)r[t]&&r[t].getHasHierarchyTags()&&e.push(t);return e},n.getPredicates=function(e,t){var i,a,n=[],s={},o=[],l=(a=r[Object.keys(r)[0]])&&a.taggerView&&a.taggerView.getObservedNavigator().hasWidgetMaximized()&&a.taggerView.getObservedNavigator().getFocusedProxy()&&a.taggerView.getObservedNavigator().getFocusedProxy().relevantPredicates.length;for(i in r)r.hasOwnProperty(i)&&(r[i]._isRootPredView?s[r[i]._id]=r[i]:n.push(r[i]));return["ds6w:who","ds6w:when","ds6w:what","ds6w:where","ds6w:why","ds6w:how"].forEach(function(e){s[e]&&o.push(s[e])}),"sort-weight"===e||!e&&l?o.concat(n).sort(function(e,i){var a=t&&t[e._id]?t[e._id].hasOwnProperty("weight")?t[e._id].weight:0:1,n=((t&&t[i._id]?t[i._id].hasOwnProperty("weight")?t[i._id].weight:0:1)||1)-(a||1);return 0===n?e._displayName.localeCompare(i._displayName):n}):"sort-alpha-asc"!==e&&e?"sort-alpha-desc"===e?o.concat(n).sort(function(e,t){return e._displayName.localeCompare(t._displayName)}).reverse():"sort-num-asc"===e?o.concat(n).sort(function(e,t){return e.nbDescendantTagValues-t.nbDescendantTagValues==0?e._displayName.localeCompare(t._displayName):e.nbDescendantTagValues-t.nbDescendantTagValues}):"sort-num-desc"===e?o.concat(n).sort(function(e,t){return t.nbDescendantTagValues-e.nbDescendantTagValues==0?e._displayName.localeCompare(t._displayName):t.nbDescendantTagValues-e.nbDescendantTagValues}):void 0:o.concat(n).sort(function(e,t){return e._displayName.localeCompare(t._displayName)})},n.getExistingPredicateViewById=function(e){return r[e]||null},n.getPredicateView=function(e,t){var a=e.id();return r[a]||(e.is6WRoot()?r[a]=i.getRootPredicateView(e,t):r[a]=new n(e,t)),r[a]},n.redrawUiElements=function(e,i){t.redrawUiElements(e,i)},n}),define("DS/TagNavigator/TagNavigatorManagerImpl",["UWA/Core","UWA/Class","DS/TagNavigator/TaggerProxy","DS/TagNavigator/TaggerProxyWithFilteringServices","DS/TagNavigator/Predicate","DS/TagNavigator/PredicateView","DS/TagNavigator/TagValue","DS/TagNavigator/Filter","DS/TagNavigator/TagsServer","DS/TagNavigator/Logger","DS/TagNavigator/CacheManager","DS/TagNavigator/ActiveCriteria","DS/TagNavigator/TaggerSettings","DS/TagNavigator/UserSettings","DS/TagNavigator/Groupings","DS/MessageBus/MessageBus"],function(e,t,i,a,n,r,s,o,l,c,d,g,u,h,p,f){"use strict";var m,v,T;function C(t,r,l,h){var w,b,y,S,E,I,x,_,A,N,V,P,D,O,U,F=this,j=h?h.tagServers:null;if("string"!=typeof t)throw new Error("Invalid input arg");return v.some(function(e){return(w=e).id()===t})?w:(e.is(l,"function")&&(O=l),E=new d,b=!0,S=t,x=[],_={},V=(N=r)?null:"IsNotInWidget",P=null,A=new o,m||(m=this),I={},U=new p,y=function(){if(!b)throw new Error("TagNavigator #{"+S+"} is a zombie")},this.createActiveCriteria=function(){null!==document.getElementById("active-tags")&&(this.activeCriteriaProxy||(this.activeCriteriaProxy=g.setupActiveCriteria({id:"taggerCriteria",contextId:S,container:"active-tags",module:"DS/TagNavigator/TaggerActiveCriteria",widgetId2contextId:O}),this.activeCriteriaProxy.addEvent("onCriteriaClick",function(e){this.dispatchEvent(C.events.CRITERIA_CLICK,e)},this),this.activeCriteriaProxy.addEvent("onTrashClick",function(e){this.dispatchEvent(C.events.TRASH_CLICK,e)},this),this.activeCriteriaProxy.addEvent("onCriteriaPin",function(e){this.dispatchEvent(C.events.CRITERIA_PIN,e)},this),this.activeCriteriaProxy.addEvent("onCriteriaUnpin",function(e){this.dispatchEvent(C.events.CRITERIA_UNPIN,e)},this),this.activeCriteriaProxy.addEvent("onCriteriaRemove",function(e){this.dispatchEvent(C.events.CRITERIA_UNPIN,e),this.dispatchEvent(C.events.CRITERIA_CLICK,e)},this),this.activeCriteriaProxy.addEvent("onCriteriaExclude",function(e){this.dispatchEvent(C.events.CRITERIA_EXCLUDE,e)},this),this.activeCriteriaProxy.addEvent("onCriteriaUnexclude",function(e){this.dispatchEvent(C.events.CRITERIA_UNEXCLUDE,e)},this),this.activeCriteriaProxy.addEvent("onGroupingClick",function(e){this.dispatchEvent(C.events.GROUPING_REMOVED,e)},this)),this.activeSearchProxy||(this.activeSearchProxy=g.setupActiveCriteria({id:"searchCriteria",contextId:S,container:"active-tags",module:"DS/TagNavigator/AdvancedSearchCriteria"}),this.activeSearchProxy.addEvent("onCriteriaClick",function(e,t){this.dispatchEvent(C.events.CRITERIA_CLICK2,[e,t])},this),this.activeSearchProxy.addEvent("onTrashClick",function(e){this.dispatchEvent(C.events.TRASH_CLICK,e)},this)))},this.createActiveCriteria(),this.getIconVisibleBool=function(e){return!!_[e]&&(void 0!==_[e].localFilterIcon&&_[e].localFilterIcon)},this.setIconVisibleBool=function(e,t){_[e]&&(_[e].localFilterIcon=t)},this.getCache=function(){return E},this.setFavoritesStatus=function(e){D=e},this.isFavoritesExpanded=function(){return D},this.isAlive=function(){return b},this.isTagInEdition=function(e){var t=x;return F.hasProxiesInEdition()&&(t=this.getProxiesInEdition()),t.some(function(t){return t.isTagInEdition(e)})},this.isReadyForDisplay=function(){return!!this.isAlive()&&F.getProxiesToDisplay().every(function(e){return e.isReady()})},this.id=function(){return S},this.getProxy=function(e){var t=null;y();try{t=new i(e,this),x.push(t),"FilteringOnServer"!==e.filteringMode&&(t=new a(t))}catch(e){throw new Error(e.message)}return e.widgetId&&!_[e.widgetId]&&(_[e.widgetId]={lastFocusedProxyId:null}),C.allProxiesMap[t.id()]=t,this.updateFocusedProxy(),t},this.hasFreeInputOnly=function(e){return this.getFocusedProxy()&&this.getFocusedProxy().hasFreeInputOnly(e)},this.hasFreeInputSupport=function(e){var t,i,a=!0,n=this.getProxiesToDisplay();for(t=0,i=n.length;t<i;t++)if(!0!==n[t].hasFreeInputSupport(e)){a=!1;break}return a},this.getGroupingInfo=function(){return U.getGroupingInfo()},this.getActiveGroupings=function(){return U.getActiveGroupings()},this._getProxiesHavingGroupingSupport=function(){let e=[],t=this.getProxiesToDisplay();for(let i=0;i<t.length;i++)t[i].hasGroupingSupport()&&e.push(t[i]);return e},this._getProxiesHavingSelectInAppSupport=function(){let e=[],t=this.getProxiesToDisplay();for(let i=0;i<t.length;i++)t[i].hasSelectInAppSupport()&&e.push(t[i]);return e},this.getProxiesHavingLoadMoreTagsPending=function(){let e=[],t=this.getProxiesToDisplay();for(let i of t)i.hasLoadMoreTagsEnabled()&&!i.isFetchAllTagsCalled()&&e.push(i);return e},this.hasGroupingSupport=function(e,t){let i=this._getProxiesHavingGroupingSupport();return!!i.length&&(!e||!!function(i){let a=[];return i.forEach(i=>{a.push(i.hasGroupingSupport(e,t))}),a}(i).every(e=>!0===e))},this.isGroupedBy=function(e,t,i){var a=this.getFocusedProxy();return a?a.isGroupedBy(e,t,i):U.isGroupedBy(e,t,i)},this.setGroupedByStatus=function(e,t,i){var a=this.getFocusedProxy();a?a.groupBy(e,t,i):(U.computeGroupingInfo(e,i),this._getProxiesHavingGroupingSupport().forEach((e,i)=>{e.groupBy(null,t)}))},this.setSelectInAppStatus=function(e){this._getProxiesHavingSelectInAppSupport().forEach((t,i)=>{t.selectInAppBy(e)})},this.dispatchLoadMoreTagsToProxies=function(){this.getCache().setIsMoreTagsButtonClicked(!0),f.publish({channel:"TaggerTrackerApi",topic:"hit",data:{category:"6WTagger",action:"onClick-LoadMoreTags",persDim:{pd1:"Load More Tags"}}}),this.getProxiesHavingLoadMoreTagsPending().forEach((e,t)=>{e.onLoadMoreTags()})},this.hasExcludeSupport=function(e){var t=this.getProxiesToDisplay();let i=!1;return t.length>0&&(i=t.some(t=>t.hasExcludeSupport(e)),c.log("hasExcludeSupport status for the context ="+i)),i},this.hasSelectInAppSupport=function(){var e=this.getProxiesToDisplay();let t=!1;return e.length>0&&(t=e.some(e=>e.hasSelectInAppSupport()),c.log("hasSelectionSupport status for the context ="+t)),t},this.getExpandStatus=function(e){return this.getFocusedProxy().getExpandStatus(e)},this.hasEmbeddedView=function(){return!(!this.getFocusedProxy()||!this.getFocusedProxy().supportsEmbeddedView())},this.isPreciseCount=function(){return this.getProxiesToDisplay().every(function(e){return e.isPreciseCount()})},this.isAdvancedSearch=function(){return this.getFocusedProxy()&&this.getFocusedProxy().isAdvancedSearch()},this.getStoredTags=function(e){var t={contextId1:{"ds6w:when/ds6w:starts":{"date-string":{"2016/02":{disp:"February",uri:"2016/02"}}}}};for(one in t.contextId1)t.contextId1[one].forEach(function(e){var t=new s(e);A.isSelected(t)||A.toggle(t)})},this.setAsCurrent=function(){var e;return y(),this===m?this:(e=m,m=this,e.dispatchEvent(C.events.CHANGE_OF_CURRENT_TN,S),this.dispatchEvent("UPDATE_ICON"),this)},this.updatePinnedTag=function(e){var t=JSON.parse(localStorage.getItem("taggerPinned"))||{},i=(t=t[C._userId]||{})["3DDashboard"===C._brand?this.id():window.location.hostname]||{keep:[]},a=this,n=!1;i.keep.forEach(function(e){e&&!a.isSelected(e.predicate)&&(a.toggleTagSelection(e.predicate,void 0),n=!0)}),setTimeout(function(){n&&a.dispatchEvent(C.events.UPDATE_ACTIVECRITERIA)},1e3)},this.die=function(){var e,t,i;for(y(),e=0,t=(i=x.slice(0)).length;e<t;e++)i[e].die(!1);return x=[],P=null,E=null,-1!==v.indexOf(this)&&v.splice(v.indexOf(this),1),this.dispatchEvent("REDRAW_TAGS"),b=!1,this},this.removeProxy=function(e){var t;return-1!==(t=x.indexOf(e))&&x.splice(t,1),delete C.allProxiesMap[e.id()],this},this.removeProxiesOfCC=function(e){x.slice(0).forEach(function(t){if(t.widgetId()===e)try{t.die()}catch(e){c.log("removeAllProxies error: trying to remove an already removed proxy...")}})},this.removeProxyAfterSwitch=function(e){c.log("Enter removeProxyAfterSwitch, current navImpl id: "+this.id());var t=x.indexOf(e);-1!==t&&(c.log("proxyToRemove successfully located at index:"+t),x.splice(t,1))},this.addProxyAfterSwitch=function(e){c.log("Enter addProxyAfterSwitch, current navImpl id: "+this.id()),x.push(e),e.setNavImpl(this)},this.switchProxiesOnCC=function(e){if(c.log("Enter switchProxiesOnCC, current navImpl id: "+this.id()),e){c.log("proxies of widgetId id to swicth: "+e);var t=!1;if(x.forEach(function(i){i.widgetId()===e&&(console.error("switchProxiesOnCC: proxy with the given widget id already exist"),t=!0)}),!t){var i=this,a=!1;v.forEach(function(t){if(t)if(t.isAlive()){if(t.id()!==i.id()){c.log("finding the proxy on navImpl: "+t.id());var n=t.getProxiesArray();if(n)n.slice(0).forEach(function(n){n.isAlive()?n.widgetId()===e&&(c.log("adding proxy to this navImpl, proxy id="+n.id()),i.addProxyAfterSwitch(n),t.removeProxyAfterSwitch(n),a=!0):c.log("TaggerProxy '"+n.id()+"' is a zombie")})}}else c.log("navImpl is dead: "+t.id())}),a&&this.dispatchEvent(C.events.REDRAW_TAGS)}}},this.removeAllProxies=function(){x.slice(0).forEach(function(e){try{e.die()}catch(e){c.log("removeAllProxies error: trying to remove an already removed proxy...")}})},this.getProxiesToDisplay=function(e){var t=[],i=!1;return y(),e||(e=function(e){return!!e.isActive()&&((!P||P===e)&&((!V||V===e.widgetId())&&(i||(i=null!==V&&e.hasSubjectsInEdition()),!0)))}),t=x.filter(e),i&&(t=t.filter(function(e){return e.hasSubjectsInEdition()})),t.editionMode=i,t},this.eachTagValue=function(e,t){return y(),F.getProxiesToDisplay().forEach(function(i){i.eachTagValue(e,t)}),this},this.listPredicates=function(e){var t,i={};UWA.is(e,"string")?i.allTagsInheritingFromType=e:i.allTagsOfType=e,y(),t=F.getProxiesToDisplay();var a={};return t.forEach(function(e){var t=e.id();e.eachTagValue(function(e){if(e){var i=e.pred.id();a[i]||(a[i]={}),a[i][t]||(a[i][t]=[]),a[i][t].push(e)}},i)}),a},this.isColorizePossible=function(){return F.getProxiesToDisplay().some(function(e){return e.colorizeSupport})},this.colorize=function(e){if(e&&e.tagColors){var t={tagColors:[]};e.tagColors.forEach(function(e){e.isComposite?e.object.forEach(function(i){var a=UWA.clone(e);delete a.isComposite,a.object=i,t.tagColors.push(a)}):t.tagColors.push(e)}),x.forEach(function(e){e.colorize(t)})}},this.unColorize=function(){x.forEach(function(e){e.unColorize()})},this.isRelevantPredicate=function(e){var t;return y(),(t=!N||window.richClient?(t=this.getProxiesToDisplay())&&1===t.length?t[0]:void 0:this.hasWidgetMaximized()?this.getFocusedProxy():void 0)&&t.relevantPredicates&&t.relevantPredicates.length&&-1!==t.relevantPredicates.indexOf(e)},this.hasProxiesInEdition=function(){return y(),this.getProxiesToDisplay().editionMode},this.getProxiesInEdition=function(){var e;return y(),(e=this.getProxiesToDisplay()).editionMode?e:[]},this.hasWidgetMaximized=function(){return y(),N&&null!==V},this.getWidgetIds=function(){return Object.keys(_)},this.getActiveTags=function(){var e=[];return y(),A.each(function(t){return e.push(t)}),e},this.getLocalActiveTags=function(){var e=[];return y(),null!==this.getFocusedProxy()&&this.getFocusedProxy().getLocalFilter().each(function(t){return e.push(t)}),e},this.hasActiveTags=function(){y();var e=this.getFocusedProxy()?this.getFocusedProxy().getParameters():null;return!A.isEmpty()||e&&e.isReadyForSearch()},this.hasLocalActiveTags=function(){return y(),null!==this.getFocusedProxy()&&!this.getFocusedProxy().getLocalFilter().isEmpty()},this.isSelected=function(e,t){var i,a,n;(y(),e instanceof s)?a=e:(i=JSON.parse(e),UWA.is(j)&&(n=j[Object.keys(j)[0]]),a=i.isComposite?this._getCompositeTagValue(i):s.getTagValue(i.predicate,i.dispValue,i.object,i.type,null,n));return A.isSelected(a,t)||null!==this.getFocusedProxy()&&this.getFocusedProxy().getLocalFilter().isSelected(a,t)},this.isExcluded=function(e){var t,i,a;(y(),e instanceof s)?i=e:(t=JSON.parse(e),UWA.is(j)&&(a=j[Object.keys(j)[0]]),i=t.isComposite?this._getCompositeTagValue(t):s.getTagValue(t.predicate,t.dispValue,t.object,t.type,null,a));return A.isExcluded(i)||null!==this.getFocusedProxy()&&this.getFocusedProxy().getLocalFilter().isExcluded(i)},this.getListOfSelectedTagValues=function(e){return(null!==this.getFocusedProxy()?this.getFocusedProxy().getLocalFilter().getSelectedTagValues(e):[]).concat(A.getSelectedTagValues(e))},this.getSelectedAttributes=function(e){return this.getFocusedProxy().getLocalFilter().getSelectedAttributes(e)},this.onRefine=function(e){var t,i;y(),t=A.computeFilterObj(),this.dispatchEvent("FILTER_CHANGE",t),e||(i=function(e){return e.isActive()});var a=this.getProxiesToDisplay(i),n=[];return a.forEach(function(e,i){e.shouldBeWarned(t)?e.onBeforeRefine():n.push(i)}),a.forEach(function(e,t){-1==n.indexOf(t)&&e.onRefine()}),this},this.clearFilters=function(e){y();var t=this.getActiveTags(),i=this,a=this.getTagPinnedFromCurrentContext(),n=this.getFocusedProxy(),r="3DDashboard"===C._brand,s=!1;if(!(t.length>0&&a.length>0)||n&&r?n&&r||(s=A.count()>0,A.clear()):t.forEach(function(e){var t=!1;a.forEach(function(a){a=JSON.parse(a.predicate),t=t||i.isTheSameTag(e,a)}),t||(A.toggle(e),s=!0)}),n&&(s=n.getLocalFilter().count()>0,n.clearLocalFilter()),s&&this.onRefine(),!n&&U.hasActiveGroupings()&&(!e||e&&e.clearGrouping)){U.clear(),this._getProxiesHavingGroupingSupport().forEach(e=>{e.clearLocalGrouping({triggerGroupingChangeCB:!0},!0)})}return n&&n.hasActiveGroupings()&&(!e||e&&e.clearGrouping)&&n.clearLocalGrouping({triggerGroupingChangeCB:!0},!1),this},this.isTheSameTag=function(e,t){var i=!1;if(e.type===t.type){var a=e.object||e.uri,n=t.object||t.uri,r=e.predicate||e.pred.getFullPredicateID(),s=t.predicate;if(a===n&&r===s)i=!0;else if(a instanceof Array&&a.length===n.length){for(var o=!0,l=0;l<a.length;l++)o=o&&a[l]===n[l];i=o}}return i},this.setUserId=function(e){c.log("this.setUserId"),C._userId=e},this.getUserInfo=function(){return C._userId},this.getBrand=function(){return C._brand},this.getTagPinnedFromCurrentContext=function(){var e=JSON.parse(localStorage.getItem("taggerPinned"))||{};return((e=e[C._userId]||{})["3DDashboard"===C._brand?this.id():window.location.hostname]||{keep:[]}).keep},this.saveTagPinToLocal=function(e,t){var i=JSON.parse(localStorage.getItem("taggerPinned"))||{},a="",n=(i[C._userId]||{})[a="3DDashboard"===C._brand?this.id():window.location.hostname]||{keep:[]},r=!1;n.keep.forEach(function(i,a){var s=JSON.parse(e),o=JSON.parse(i.predicate);i.predicate===e&&(r=!0),!1===r&&"date"===s.type&&s.predicate===o.predicate&&(n.keep.splice(a,1),n.keep.push({predicate:e,DOMId:t}),r=!0)}),!r&&n.keep.push({predicate:e,DOMId:t}),i[C._userId]=i[C._userId]||{},i[C._userId][a]=n,localStorage.setItem("taggerPinned",JSON.stringify(i)),this.dispatchEvent(C.events.UPDATE_ACTIVECRITERIA)},this.clearTagPinInLocal=function(e,t,i){var a=JSON.parse(localStorage.getItem("taggerPinned"))||{},n="",r=(a[C._userId]||{})[n="3DDashboard"===C._brand?this.id():window.location.hostname]||{keep:[]},s=-1,o=0,l=r.keep.length,c=0;for(o=0;o<l;o++){-1===c&&(c=0);var d=r.keep[c];this.isTheSameTag(JSON.parse(d.predicate),JSON.parse(e))&&(s=o);var g=JSON.parse(e),u=JSON.parse(d.predicate);if(/*!isSimplified &&*/"date"===g.type&&"date"===u.type&&g.predicate===u.predicate){var h=this.getFilters(null,!0);!0===h.allfilters.hasOwnProperty(u.predicate)&&(h.allfilters[u.predicate][0].object===g.object?(UWA.is(h.allfilters[u.predicate][0].parent)&&(g.object=h.allfilters[u.predicate][0].parent.object,g.dispValue=h.allfilters[u.predicate][0].parent.disptext),e=JSON.stringify(g),this.isTheSameTag(JSON.parse(d.predicate),JSON.parse(e))||r.keep.push({predicate:e,DOMId:t}),r.keep.splice(c,1),c-=1):h.allfilters[u.predicate][0].parent.object===g.object?(UWA.is(h.allfilters[u.predicate][0].parent.parent)&&(g.object=h.allfilters[u.predicate][0].parent.parent.object,g.dispValue=h.allfilters[u.predicate][0].parent.parent.disptext),e=JSON.stringify(g),this.isTheSameTag(JSON.parse(d.predicate),JSON.parse(e))||r.keep.push({predicate:e,DOMId:t}),r.keep.splice(c,1),c-=1):(r.keep.splice(c,1),c-=1)),s=-1}c+=1}-1!==s&&r.keep.splice(s,1),a[C._userId]=a[C._userId]||{},a[C._userId][n]=r,localStorage.setItem("taggerPinned",JSON.stringify(a)),this.dispatchEvent(C.events.UPDATE_ACTIVECRITERIA)},this.getFilters=function(e,t,i,a){return A.computeFilterObj(null,e,t,i,a)},this.toggleComplexTagSelection=function(e,t,i){this.getFocusedProxy().getLocalFilter().toggle(e,i),!1!==t&&this.onRefine()},this._getCompositeTagValue=function(e,t){return new s(new n({sixw:e.predicate,type:e.type}),{type:e.type,uri:e.object,displayValue:e.dispValue,hasDisplayValue:!0,isComposite:!0},t)},this.toggleTagSelection=function(e,t,i){var a,n,r,o;if(y(),(n=UWA.is(e,"object")?e:JSON.parse(e)).isComplex)return this.toggleComplexTagSelection(n,i);r=n.isComposite?this._getCompositeTagValue(n):s.getTagValue(n.predicate,n.dispValue,n.object,n.type);var l="3DDashboard"===C._brand;"3DDashboard"===C._brand?null!==this.getFocusedProxy()&&l&&(o="local"):null!==this.getFocusedProxy()&&(A.isSelected(r)?this.getFocusedProxy().getLocalFilter().isSelected(r)&&(o="local"):o="local_selectedFilters");var c=!1;if("local"===o||"local_selectedFilters"===o){var d=this.getFocusedProxy().updateSelectedTVLocalFilter(o,r,t,i);UWA.is(d,"boolean")?a=d:UWA.is(d,"object")&&(a=d.isSelected)}else if(A.isSelected(r)&&this.getTagPinnedFromCurrentContext().forEach(function(t){t.predicate===e&&(c=!0)}),!c){var g=A.toggle(r,i);UWA.is(g,"boolean")?a=g:UWA.is(g,"object")&&(a=g.isSelected)}return"date"===n.type&&this.getCache().colorManager.clearComputedColorMap(n.predicate),!1!==t&&(x.length?this.onRefine():this.dispatchEvent("REDRAW_TAGS")),a},this.updateFreeInputs=function(e,t){y(),null!==this.getFocusedProxy()&&this.getFocusedProxy().updateFreeInputs(e,t)},this.createFreeInputs=function(e,t){y(),null!==this.getFocusedProxy()&&this.getFocusedProxy().createFreeInputs(e,t)},this.removeFreeInputs=function(e,t){y(),null!==this.getFocusedProxy()&&this.getFocusedProxy().removeFreeInputs(e,t)},this._handleExclude=function(e,t){if(!this.hasExcludeSupport())throw new Error("TagNavigatorManagerImpl#handleExclude: CANNOT handle the operation, EXCLUDE NOT SUPPORTED on the context");{let a,n=this.getFocusedProxy();n?a=n.getLocalFilter():(a=A,this.dispatchEvent("onBeforeGlobalFilterChange"));let r=UWA.is(e,"object")?e:JSON.parse(e);if(e.isComplex)a.handleExclude(e,t),this.onRefine(!!n);else{var i=r.isComposite?this._getCompositeTagValue(r):s.getTagValue(r);if(!(a.isSelected(i)||"date"==i.type&&a.isSelectedDate(i)))throw new Error("TagNavigatorManagerImpl#handleExclude: CANNOT handle the operation, tag is not selected");a.handleExclude(i,t),this.onRefine(!!n)}this.dispatchEvent(C.events.UPDATE_ACTIVECRITERIA)}},this.excludeTag=function(e){this._handleExclude(e,!0)},this.undoExcludeTag=function(e){this._handleExclude(e,!1)},this.requestSuggestions=function(e,t){var a,n=this.getFocusedProxy();null!==n&&(a={suggestField:e,suggestTitle:t,allfilters:n.getFilters().allfilters,localfilters:n.getFilters().localfilters},n.triggerCallbackOfEvent(i.RequestSuggestions,a))},this.clickOnMoreButton=function(e){y(),I[e]?I[e]+=u.getOption("moreTagsToAdd"):I[e]=7+u.getOption("moreTagsToAdd")},this.getMoreLimitForPredicate=function(e){return y(),I[e]||7},this.createTagValue=function(e,t,i){var a,r=this;if(y(),!this.hasProxiesInEdition())throw new Error("Unexpected creation of tag without a proxy in edition");if(!(t instanceof n&&"string"==typeof e))throw new Error("Invalid input arg");return a=function(){r.modifiedPredicate=t,r.dispatchEvent(C.events.REDRAW_TAGS)},this.getProxiesInEdition().forEach(function(n){n.createTagValue(e,t,a,i)}),this},this.deleteTagValue=function(e,t){var i,a=this;if(y(),!this.hasProxiesInEdition())throw new Error("Unexpected delete of tag without a proxy in edition");if(!(t instanceof n))throw new Error("Invalid input arg");return i=function(){return a.dispatchEvent(C.events.REDRAW_TAGS)},this.getProxiesInEdition().forEach(function(a){a.deleteTagValue(e,t,i)}),this},this.getCriteriaIdsMap=function(){return this.getFocusedProxy()?this.getFocusedProxy().getCriteriaIdsMap():{}},this.updateFocusedProxy=function(){var e,t;V&&((t=this.getFocusedProxy())&&t._widgetId===V&&t.isActive()?e=t:(e=this.getProxyToFocusFromWidgetId(V),this.toggleProxyFocus(e,!0))),this.dispatchEvent("UPDATE_ICON"),"3DDashboard"===C._brand&&this.dispatchEvent(C.events.UPDATE_ACTIVECRITERIA)},this.focusOnCC=function(e){return window.proxyLogs&&(c.group("Focus on widget"),c.info("Widget id : ",e),c.groupEnd("Focus on widget")),y(),N&&"IsNotInWidget"!==e?(V=e,this.updateFocusedProxy(),this):(c.error("Request to focus on widget, but not a widget"),this)},this.unfocusCC=function(){return window.proxyLogs&&(c.group("Unfocus widget"),c.info("Widget id : ",V),c.groupEnd("Unfocus widget")),y(),V=null,this.removeFocusedProxy(!0),this},this.getWidgetMaximized=function(){return V},this.getFocusedProxy=function(){return P},this.getProxyToFocusFromWidgetId=function(e){var t,i=_[e]?_[e].lastFocusedProxyId:void 0;return x.some(function(a){if(a._widgetId===e&&a._isActive){if(!t&&(t=a,!i))return!0;if(a._id===i)return t=a,!0}return!1}),t},this.removeFocusedProxy=function(e){this.toggleProxyFocus(P,!1),this.dispatchEvent("UNFOCUS",e),this.dispatchEvent("UPDATE_ICON")},this.toggleProxyFocus=function(e,t){var i=null;e?(e!==P&&null!==P&&(i=P),(P=t?e:null)&&(_[P._widgetId].lastFocusedProxyId=P._id),i&&i.updateProxyView(i._selectedValues.isEmpty(),!0,!1),e.updateProxyView(e._selectedValues.isEmpty(),!0),e._widgetId,e._id):this.dispatchEvent("REDRAW_TAGS")},this.hasFocusedProxyWithRelevantPredicate=function(){var e=this.getProxiesToDisplay();if(UWA.is(e,"array")&&1===e.length&&e[0]){let t=e[0].hasRelevantPredicates();if(t&&t.length>0&&e[0]===this.getFocusedProxy())return e[0]}},this.hasPreferredPredicates=function(e){var t=this.getFocusedProxy();if(t)return c.log("Proxy is focused."),t.hasRelevantPredicates(e);c.log("Proxy is unfocused, checking if all proxies support preferred Predicates");var i=this.getProxiesToDisplay();if(i.length>0){var a=i.map(t=>t.hasRelevantPredicates(e));for(var n of a)if(!n||0==n.length)return void c.log("One of the proxy does not support preferred predicates.");c.log("All proxies support preferred Predicates: Taking union of all Predicates from all proxies");var r=new Set;for(var n of a)for(var s of n)r.add(s);return r.has("computedCountryInfo")&&r.delete("computedCountryInfo"),c.log(`Predicate List: ${[...r]}`),[...r]}c.log("No proxies found in the current context.")},this.hasHiddenPredicates=function(){var e=this.getFocusedProxy();if(e)return c.log("Proxy is focused, return all hidden predicate list for focused proxy."),e.getHiddenPredicates();c.log("Proxy is unfocused, get all hidden predicates from each proxy.");var t=this.getProxiesToDisplay().map(e=>e.getHiddenPredicates()),i=new Set(t[0]);for(var a of t.slice(1)){if(0==i.length||!a||0==a.length)return void c.log("The intersection is empty: At least one proxy does not have support for each predicate to display");var n=a.filter(e=>i.has(e));i=new Set(n)}return c.log(`Hidden Predicate List: ${[...i]}`),[...i]},this.getProxyPreferredSortOrder=function(){var e=this.getFocusedProxy();if(e)return e.getSortOrder()},this.getTaggerViewVisibility=function(){return T},this.updateDisplayStatus=function(e){T=e;var t=this;v.forEach(function(i){if(i)if(i.isAlive()){var a=i.getProxiesArray();a&&a.forEach(function(a){a.isAlive()?a.updateTaggerDisplayStatus(e,i.id()===t.id()):c.log("TaggerProxy '"+a.id()+"' is a zombie")})}else c.log("navImpl is dead: "+i.id())})},this.getProxiesArray=function(){return x},this.setColorMap=function(e){E.colorManager.setColorMap(e),this.dispatchEvent("REDRAW_TAGS")},this.getTagsServerForUserInfo=function(){var e,t=this.getFocusedProxy();return t&&(e=t.getTagsServers(),UWA.is(e,"object")&&(e=e[Object.keys(e)[0]])),e||1===Object.keys(j).length&&(e=j[Object.keys(j)[0]]),e},this.isInternalProduction=function(){return!!u.getOption("internalProd")||(j&&1===Object.keys(j).length&&(e=j[Object.keys(j)[0]]),e&&"DSEXT001"===e.getTenantName().toUpperCase());var e},this.getTenantList=function(){if(j&&Object.keys(j).length>0)var e=j;return e},v.push(this),this)}e.extend(C.prototype,t.Events.prototype),C.count=function(){return v.length},C.events={CHANGE_OF_CURRENT_TN:"CHANGE_OF_CURRENT_TN",UNFOCUS:"UNFOCUS",UPDATE_ICON:"UPDATE_ICON",REDRAW_TAGS:"REDRAW_TAGS",REDRAW_CRITERIA:"REDRAW_CRITERIA",FILTER_CHANGE:"FILTER_CHANGE",OPEN_TAGGER:"OPEN_TAGGER",CLOSE_TAGGER:"CLOSE_TAGGER",SEARCH_LAUNCH:"SEARCH_LAUNCH",CRITERIA_CLICK:"CRITERIA_CLICK",CRITERIA_CLICK2:"CRITERIA_CLICK2",TRASH_CLICK:"TRASH_CLICK",CRITERIA_PIN:"CRITERIA_PIN",CRITERIA_UNPIN:"CRITERIA_UNPIN",CRITERIA_EXCLUDE:"CRITERIA_EXCLUDE",CRITERIA_UNEXCLUDE:"CRITERIA_UNEXCLUDE",GROUPING_REMOVED:"GROUPING_REMOVED",UPDATE_ACTIVECRITERIA:"UPDATE_ACTIVECRITERIA",STATUS_UPDATE:"STATUS_UPDATE",REQUEST_GROUPING_CHANGE:"REQUEST_GROUPING_CHANGE"},C.allProxiesMap={},v=[],m=null,C.isTagPinned=function(e,t,i){"3DDashboard"===C._brand||(e=window.location.hostname);var a=JSON.parse(localStorage.getItem("taggerPinned"))||{},n=(a=a[C._userId]||{})[e]||{keep:[]},r=!1;return n.keep.forEach(function(e){var a=JSON.parse(e.predicate);if(a.predicate===t)if("date"===i.type)i.object!==a.object?UWA.is(i.parent)&&i.parent.object!==a.object?UWA.is(i.parent.parent)&&i.parent.parent.object===a.object&&(r=!0,i.parent.parent.isPinnedActive=!0,i.parent.isPinnedActive=!1,i.isPinnedActive=!1):(i.isPinnedActive=!1,i.parent&&(i.parent.isPinnedActive=!0,UWA.is(i.parent.parent)&&(i.parent.parent.isPinnedActive=!0)),r=!0):(r=!0,i.isPinnedActive=!0);else if(i.object===a.object)r=!0;else if(i.object instanceof Array&&i.object.length===a.object.length){for(var n=!0,s=0;s<i.object.length;s++)n=n&&i.object[s]===a.object[s];r=n}}),r};try{g.init(C.allProxiesMap)}catch(e){c.log("Issue in ActiveCriteria.init, message="+e.message)}return C}),define("DS/TagNavigator/TaggerActiveCriteria",["UWA/Core","DS/TagNavigator/TaggerNLS","DS/TagNavigator/ActiveTagView","DS/TagNavigator/TagNavigatorManagerImpl"],function(e,t,i,a){"use strict";return function(){var n={},r={},s={};function o(e){if(e.withoutPredHeader)return"";var t=e.predicate.split("/"),i=t[0].split(":")[1],a=s[t.join("/")]||t[t.length-1].split(":")[1],n='<li class="predicate expanded list-view selected '+i+'" id="atv'+g(t.join("/"))+'">';return n+='<div class="predicate-header" title="'+a+'"><div class="predicate-label">',n+='<span class="fonticon fonticon-3ds-'+i+'"></span>'+a+"</div></div></li>"}function l(t,a){var n,r=0,s=0,o=["year","month","day"],l=e.createElement(),c={id:void 0,text:void 0,icon:void 0,isPinned:!1,isExcluded:!1,isSimplified:a.isSimplified,onePerLine:a.onePerLine,disabled:!1,hasActions:!1,withoutTitle:a.isSimplified};a.withRootIcon&&(n="fonticon-3ds-"+a.predicate.split("/")[0].split(":")[1]);var d,g=!a.proxyId&&a.is3DDashboard,u=function(e,t){g&&e.addClassName("canBePinned"),t.canBeExcluded&&e.addClassName("canBeExcluded"),a.globalTag&&e.addClassName("globalTag"),a.isSimplified&&e.setAttributes({"context-id":a.contextId,"proxy-name":"taggerCriteria","predicate-name":a.predicate.split("/").pop()})};for(r=0;r<t.length;r++)if(c.icon=n,c.isPinned=t[r].isPinned,a.globalTag&&(c.disabled=a.is3DDashboard&&a.proxyId),c.isExcluded=UWA.is(t[r].isExcluded,"boolean")?t[r].isExcluded:void 0,a.globalTag&&a.is3DDashboard&&!a.proxyId?c.hasActions=!0:a.proxyId&&t[r].canBeExcluded&&(c.hasActions=!0),c.hasActions=a.globalTag&&a.is3DDashboard||t[r].canBeExcluded,t[r].text instanceof Array)for(s=0;s<t[r].text.length;s++)c.text=t[r].text[s],c.id=t[r].tagId[s]+"atv",c.onePerLine&&(c.onePerLine=!1),s>0&&a.withRootIcon&&!a.isSimplified&&(c.icon=null),c.hasActions=!1,a.globalTag&&a.is3DDashboard&&(c.hasActions=!0),a.proxyId&&t[r].canBeExcluded&&t[r].canBeExcluded[s]&&(c.hasActions=!0),c.hasActions&&t[r].isExcluded&&(c.isExcluded=t[r].isExcluded[s]),(d=new i(c).render()).container.addClassName(o[s%o.length]),u(d.container,{canBeExcluded:t[r].canBeExcluded&&t[r].canBeExcluded[s]}),l.grab(d.container);else c.id=t[r].tagId+"atv",c.text=t[r].text,c.onePerLine=a.onePerLine,u((d=new i(c).render()).container,{canBeExcluded:t[r].canBeExcluded}),l.grab(d.container);return l.getHTML()}function c(e,t){if(e&&"string"==typeof e)return!(0===e.length||t&&t instanceof RegExp&&!t.test(e));if(e instanceof Array){for(var i=0;i<e.length;i++)if(!e[i]||"string"!=typeof e[i]||0===e[i].length||t&&t instanceof RegExp&&!t.test(e[i]))return!1;return!0}return!1}function d(e){if(0===Object.keys(e).length)return!1;for(var t in e)if(e[t].length>0)return!0;return!1}function g(e){var t,i,a;if(t=0,0!==e.length)for(i=0,a=e.length;i<a;i++)t=(t<<5)-t+e[i].charCodeAt(0),t&=t;return r[t="id_"+t]=e,t}function u(e,t,i){var a={predicate:t,object:e.object};return i?(a.dispValue=e.display,a.type=e.type,a.isComplex=!0):(a.dispValue=e.disptext||e.display,a.type=e.type),e.isComposite&&(a.isComposite=!0),g(JSON.stringify(a))}this.setActiveCriteria=function(e,t){var i,a,n,r,o,l,d={};t.isSimplified,o={allproxies:{},localfilters:{}};var g=function(e,i){l=[],d=[];var a=t.isTagPinned(t.contextId,e,i);UWA.is(i.isPinnedActive)&&!1===i.isPinnedActive?(l=[i.disptext],d=[u(i,e)],UWA.is(i.parent)&&!1===i.parent.isPinnedActive?(l.push(i.parent.disptext),d.push(u(i.parent,e)),UWA.is(i.parent.parent)&&!0===i.parent.parent.isPinnedActive&&(n=[i.parent.parent.disptext],r=[u(i.parent.parent,e)])):UWA.is(i.parent)&&(n=[i.parent.disptext],r=[u(i.parent,e)],UWA.is(i.parent.parent)&&!0===i.parent.parent.isPinnedActive&&(n.push(i.parent.parent.disptext),r.push(u(i.parent.parent,e))))):(n=[i.disptext],r=[u(i,e)],i.parent&&(n.push(i.parent.disptext),r.push(u(i.parent,e)),i.parent.parent&&(n.push(i.parent.parent.disptext),r.push(u(i.parent.parent,e))))),o.allproxies[e]=[{text:n.reverse(),tagId:r.reverse(),isPinned:a}],UWA.is(l,"array")&&l.length>0&&o.allproxies[e].push({text:l.reverse(),tagId:d.reverse(),isPinned:!1})};for(i in e.allfilters)(a=e.allfilters[i]).length>0&&"date"===a[0].type?1===a.length&&g(i,a[0]):o.allproxies[i]=a.map(function(e){return{text:e.disptext,tagId:u(e,i),isPinned:t.isTagPinned(t.contextId,i,e),canBeExcluded:t.canBeExcluded(i),isExcluded:e.excluded}});if(c([t.widgetId,t.proxyId])&&e.localfilters)if(UWA.is(e.localfilters,"object")&&e.localfilters.isAdvanced)e.localfilters.condition.forEach(function(e){var t=Object.keys(e)[0],i=o.localfilters[t]=[];e[t].condition.forEach(function(a){i.push({text:a.display,tagId:u(a,t,e[t].isComplex),isPinned:!1})})});else for(i in e.localfilters)(a=e.localfilters[i]).length>0&&"date"===a[0].type?1===a.length&&function(e,a){var s=t.canBeExcluded(i);n=[e.disptext],r=[u(e,i)];var l=[s],c=[e.excluded];e.parent&&(n.push(e.parent.disptext),r.push(u(e.parent,i)),l.push(s),c.push(e.parent.excluded),e.parent.parent&&(n.push(e.parent.parent.disptext),r.push(u(e.parent.parent,i)),l.push(s),c.push(e.parent.parent.excluded))),o.localfilters[i]=[{text:n.reverse(),tagId:r.reverse(),canBeExcluded:l.reverse(),isExcluded:c.reverse()}]}(a[0]):o.localfilters[i]=a.map(function(e){return{text:e.disptext,tagId:u(e,i),isPinned:!1,canBeExcluded:t.canBeExcluded(i),isExcluded:e.excluded}});return e.groupings&&(o.groupings=e.groupings.map(function(e){return{text:e.dispText,predicate:e.predicate,isPredicate:e.isPredicate}})),e.allgroupings&&(o.allgroupings=e.allgroupings.map(function(e){return{text:e.dispText,predicate:e.predicate,isPredicate:e.isPredicate}})),t.predicatesNLS&&(s=t.predicatesNLS),o},this.criteriaToHTML=function(r,s){var g,u,h,p=[];if(!r)return"";if(s.proxyId=s.proxyId||n[s.widgetId],n[s.widgetId]=s.proxyId,p.push(d(r.allproxies)||r.allgroupings&&r.allgroupings.length>0),c([s.widgetId,s.proxyId])&&s.widgetId in r&&s.proxyId in r[s.widgetId]?p.push(d(r[s.widgetId][s.proxyId].localfilters)||r[s.widgetId][s.proxyId].groupings&&r[s.widgetId][s.proxyId].groupings.length>0):p.push(!1),!p[0]&&!p[1])return"";var f={isSimplified:s.isSimplified,withoutPredHeader:s.withoutPredHeader,onePerLine:s.onePerLine,withRootIcon:s.withRootIcon,proxyId:s.proxyId,contextId:s.contextId,is3DDashboard:"3DDashboard"===a._brand};if(g='<div id="taggerCriteria-_-'+s.contextId+'" class="appCriteria">',p[0]){for(u in p[1]&&(g+='<span class="title-active-criteria"> '+t.getText("tab")+" </span>"),s.isSimplified&&(g+='<ul class="active-predicate-list globalTags">'),f.globalTag=!0,r.allproxies)f.predicate=u,(h=r.allproxies[u]).length>0&&(s.isSimplified||(g+="<ul class=active-predicate-list>"),g+=o(f),g+=l(h,f),s.isSimplified||(g+="</ul>"));if(r.allgroupings&&r.allgroupings.length){let t,a=r.allgroupings;g+='<ul class="active-predicate-list global-groupings">';let n=e.createElement();a.forEach(function(e){(t=new i({text:e.text,icon:"fonticon-group",isSimplified:!0,hasActions:!1,withoutTitle:!0}).render()).container.setAttribute("grouped",""),t.container.setAttribute("predicate",e.predicate),t.container.addClassName("globalTag"),e.isPredicate&&t.container.setAttribute("is_predicate",""),n.grab(t.container)}),g+=n.getHTML(),g+="</ul>"}s.isSimplified&&(g+="</ul>")}if(p[1]){p[0]&&(g+='<span class="title-active-criteria">Current Widget: </span>');var m=r[s.widgetId][s.proxyId].localfilters;if(Object.keys(m).length>0){for(u in s.isSimplified&&(g+='<ul class="active-predicate-list localTags">'),f.globalTag=!1,r[s.widgetId][s.proxyId].localfilters)f.predicate=u,(h=r[s.widgetId][s.proxyId].localfilters[u]).length>0&&(s.isSimplified||(g+="<ul class=active-predicate-list>"),g+=o(f)+l(h,f),s.isSimplified||(g+="</ul>"));s.isSimplified&&(g+="</ul>")}if(!s.isEmbedded){var v=r[s.widgetId][s.proxyId].groupings;if(v&&v.length>0){let t;g+='<ul class="active-predicate-list active-groupings">';let a=e.createElement();v.forEach(function(e){(t=new i({text:e.text,icon:"fonticon-group",isSimplified:!0,hasActions:!1,withoutTitle:!0}).render()).container.setAttribute("grouped",""),t.container.setAttribute("predicate",e.predicate),e.isPredicate&&t.container.setAttribute("is_predicate",""),a.grab(t.container)}),g+=a.getHTML(),g+="</ul>"}}}return g+="</div>"}}}),define("DS/TagNavigator/TagValueView",["DS/TagNavigator/PredicateView","DS/TagNavigator/Predicate","DS/TagNavigator/TagValue","DS/TagNavigator/TaggerNLS","DS/TagNavigator/Logger"],function(e,t,i,a,n){"use strict";function r(t,a,s){var o,l,c,d,g,u,h,p,f,m,v,T,C,w;if("number"!=typeof s&&(s=1),!(t instanceof i))throw new Error("Invalid input arg");T=a,p=s,c=t.getDisplayValue(),d=t.uri,C=Array.isArray(t.uri)?"tree":t.type,g=t.explicit,f=t.pred.getFullPredicateID(),m=t.icon,v={predicate:f,object:d,dispValue:t.getDisplayValue(),type:t.type},t.embeddedSixW&&(v.isComplex=!0),v=JSON.stringify(v),w=[];var b=[];this.getSelectedTagId=function(){return v},this.incNbSubjects=function(e){return p+=e,u&&u.incNbSubjects&&u.incNbSubjects(e),p},this.id=function(){return d},this.setIcon=function(e){m=e},this.isADateFilter=function(){return!1},this.getDateLevel=function(){return"date"===C?[0,"year","month","day"][d.split("/").length]:0},this.type=function(){return C},this.nbSubjectsTagged=function(){return p},this.getDisplayname=function(){return Array.isArray(c)?c[c.length-1]:c},this.clearContent=function(){var e,t;for(T=null,e=0,t=w.length;e<t;e++)w[e].clearContent();return w=[],T},this.getMotherView=function(){return u},this.getPredicateView=function(){return u instanceof r?u.getPredicateView():u},this.getTagsInCreation=function(){return T.getTagsInCreation()},this.isSelectedTag=function(){return T.isSelected(t)},this.hasChildren=function(){return w.length>0},this.addTagValueView=function(e){if(this.getChildrenTagValueViews(function(t){return t===e.getDisplayname()}).length>0)throw new Error("Unexpected addition of already existing child TagValueView");return w.push(e),this.incNbSubjects(e.nbSubjectsTagged()),h.hasHierarchicalTags(),this},this.addDuplicateTagValue=function(e){b.push(e),n.log("merging a tag "+e.id()+" under tag "+this.id())},this.getDuplicateTagValues=function(){return b},this.updateCompositeStatus=function(){if(b.length>0){var e=JSON.parse(v);e.object=UWA.is(e.object,"array")?e.object:[e.object],b.forEach(function(t){var i=t.id();-1===e.object.indexOf(i)&&e.object.push(i)}),e.isComposite=!0,v=JSON.stringify(e)}},this.getChildrenTagValueViews=function(e){return e||(e=function(){return!0}),w.filter(function(t){return e(t.getDisplayname())})},this.getChildTagValueView=function(e){var t=this.getChildrenTagValueViews(function(t){return t===e});return t.length?t[0]:void 0},this.getNbTagMatch=function(e){var t,i=0,a=this.getChildrenTagValueViews();if(-1!==this.getDisplayname().toLowerCase().indexOf(e)&&i++,"date"!==this.type()||"date"===this.type()&&this.isSelectedDate())for(t=0;t<a.length;t++)a[t].getChildrenTagValueViews().length>0?i+=a[t].getNbTagMatch(e):-1!==a[t].getDisplayname().toLowerCase().indexOf(e)&&i++;return i},this.isSelectedDate=function(){return this.isSelectedTag()||this.getChildrenTagValueViews().some(function(e){return e.isSelectedTag()||e.isSelectedDate()})},this.toHtml=function(e,a,n,s,o,l,c){var h,y,S,E,I,x,_,A=b.length>0?T.isSelected(v):T.isSelected(t),N=g&&T.isTagInEdition(t),V=g&&!a&&!N&&c,P=T.getObservedNavigator().isPreciseCount(),D=s&&""!==s,O=T.getObservedNavigator().getCache(),U=b.length>0?T.isExcluded(v):T.isExcluded(t);switch(V&&(i.isSwymCommunityInFocus(T)&&t.isCommunityTag?V=!1:t.isOntologyTag&&w.length>0&&(V=!1)),"boolean"!=typeof a&&(a=!1),S=String()+T.getDOMId(v)+(a?"atv":""),C){case"date":var F=["year","month","day"][d.split("/").length-1];if(a)return y="",u instanceof r&&(y=u.toHtml(e,a,n,void 0,o)),y+=r.toHtml({id:S,displayName:this.getDisplayname(),count:p,isPreciseCount:P,isSelected:!0,isDisplayed:!0,isExplicit:g,additionalClassName:F+(o?"":" wrongType"),icon:m,hasProxiesInEdition:c},T);if(n&&""!==n&&!(A=0===n.indexOf(d))&&0!==d.indexOf(n))return"";if(E=r.toHtml({id:S,displayName:this.getDisplayname(),count:p,isPreciseCount:P,isSelected:A,isDeletable:V,isDisplayed:e,isExplicit:g,isUnderCreation:N,isExpanded:!0,icon:m,additionalClassName:(A?F:"")+(o?"":" wrongType"),color:!O.colorManager.isColorized(f)||A&&"day"!==F?void 0:O.colorManager.getNewColorForTagValue(this),hasProxiesInEdition:c,isExcluded:U},T),!a&&A){for(w=this.getPredicateView().sortTagValues(w),T.isSelected(v)&&(E+="<li class='treeTags'><ul class='tags-list'>"),h=0;h<w.length;h++)(!D||D&&w[h].getNbTagMatch(s)>0)&&(E+=w[h].toHtml(e,!1,n,s,o));T.isSelected(v)&&(E+="</ul></li>")}return E;case"tree":I=!a&&w.length>0,E="",x="";var j=null;if(_=Array.isArray(this.id())?this.id().length:this.id().split("/").length,(O.colorManager.isColorized(f)||O.colorManager.isInColorization(f))&&(this.getMotherView()===this.getPredicateView()?O.colorManager.addToColoredTreeTagList(this):Object.getPrototypeOf(this.getMotherView())===Object.getPrototypeOf(this)&&O.isTagTreeExpanded(T.getDOMId(this.getMotherView().getSelectedTagId()))&&(O.colorManager.partialColorize&&O.colorManager.partialColorize[f]||(j=O.colorManager.addToColoredTreeTagList(this)))),D?this.getNbTagMatch(s)>0&&(O.expandTagTree(S),x=r.toHtml({id:S,displayName:this.getDisplayname(),count:p,isPreciseCount:P,isSelected:A,isDeletable:V,isDisplayed:e,isExplicit:g,isGrouped:l&&l(this.getDisplayname(),this.id()),icon:m,isUnderCreation:N,isExpanded:O.isTagTreeExpanded(S),isTree:I,additionalClassName:o?"":" wrongType",color:O.colorManager.isColorized(f)||O.colorManager.isInColorization(f)?O.colorManager.getNewColorForTagValue(this)||j:void 0,level:_,hasProxiesInEdition:c,isExcluded:U},T)):x=r.toHtml({id:S,displayName:this.getDisplayname(),count:p,isPreciseCount:P,isSelected:A,isDeletable:V,isDisplayed:e,isExplicit:g,isGrouped:l&&l(this.getDisplayname(),this.id()),icon:m,isUnderCreation:N,isExpanded:O.isTagTreeExpanded(S),isTree:I,additionalClassName:o?"":" wrongType",color:O.colorManager.isColorized(f)||O.colorManager.isInColorization(f)?O.colorManager.getNewColorForTagValue(this)||j:void 0,level:_,hasProxiesInEdition:c,isExcluded:U},T),!a){if(w=this.getPredicateView().sortTagValues(w),_=Array.isArray(this.id())?this.id().length:this.id().split("/").length,w.length)return E+="<ul class='treeTags"+(_>20?" maxLevel":"")+"'>"+x+"<li class='childrenTags' style='"+(O.isTagTreeExpanded(S)?"position: relative; overflow: hidden; height: auto;":"position: absolute; overflow: hidden; height: 0px;")+"'><ul class='tags-list'>"+w.map(function(t){return t.toHtml(e,a,null,s,o,l,c)}).join("")+"</li></ul></ul>";x=x.replace("<li class='tag ","<li level='"+_+"' class='tag first")}return x;default:return r.toHtml({id:S,displayName:this.getDisplayname()||this.id(),count:p,isPreciseCount:P,isSelected:A,isDeletable:V,isDisplayed:e,isExplicit:g,isGrouped:l&&l(this.getDisplayname()),icon:m,isUnderCreation:N,additionalClassName:o?"":" wrongType",color:O.colorManager.isColorized(f)||O.colorManager.isInColorization(f)?O.colorManager.getNewColorForTagValue(this)||j:void 0,hasProxiesInEdition:c,isExcluded:U},T)}},l=t.displayPredicate||t.pred,h=e.getPredicateView(l,T);var y=t.parent;return function(e){return e===d},(o=(u=y?new r(y,T,0):h).getChildTagValueView(this.getDisplayname()))?(o&&(UWA.is(d,"array")||"date"==t.pred.getType()||o.id()!==this.id()&&o.addDuplicateTagValue(this)),o.incNbSubjects(s),o):(u.addTagValueView(this),this)}return r.toHtml=function(e,t){var i,n=e.isExplicit&&!0===e.isExplicit,r=e.isUnderCreation&&!0===e.isUnderCreation,s=e.isTree&&!0===e.isTree,o=e.isExpanded&&!0===e.isExpanded,l=e.additionalClassName?" "+e.additionalClassName:"",c=e.color||!1,d=e.isPreciseCount||!1,g=e.icon,u="",h="",p=e.isExcluded;g&&g.match(/fonticon-*/)?u='<span class="tag-icon fonticon '+g+'"></span>':g&&g.match(/(http(s)?:\/\/.)?(www\.)?[-a-zA-Z0-9@:%._\+~#=]{2,256}\.[a-z]{2,6}\b([-a-zA-Z0-9@:%_\+.~#?&//=]*)/)&&-1!==["gif","tiff","jpg","jpeg","bmp","png","ico"].indexOf(g.split(".").pop())&&(u='<img class="tag-image" src="'+g+'" style="width:20px;height:20px;">'),p&&(h='<span class="fonticon fonticon-block excluded"></span>');let f=t.actionManager?t.actionManager.getCurrentAction():void 0,m=!1;return f&&"colorize"==f.id&&c&&(m=!0),i="<li"+(e.level?" level= "+e.level:"")+" class='tag "+l+(e.isSelected?" selected":"")+(e.isDeletable?" deletable":"")+(o?" expanded":"")+(e.isGrouped?" grouped-by":"")+(c?" colorize":"")+(m?" picked-for-colorize":"")+(!c&&e.count<0?" no-count":"")+(e.isDisplayed?"":" morelimit")+(n?" explicit":"")+(r?" creating":"")+"' title='"+e.displayName.replace(/'/g,"&#39;")+"' id='"+e.id+"' data-rec-id='"+e.id+"'>",n||(i+=""),i+="<div class='tag-color "+(c?"":"hide-color")+"' style='background-color:"+(c||0)+";'></div>",i+=s?"<div class='arrow tree'><span class='fonticon fonticon-down-dir'></span><span class='fonticon fonticon-right-dir'></span></div>":"",i+="<div class='tag-elem'>"+h+u+"<div class='tag-label'>"+e.displayName.escapeHTML(),r&&(i+='<div class="spinner spinner-sm spinning fade in" style="height: 12px; padding: 6px; -webkit-transform: translate3d(0px, 0px, 0px); display: inline-block;"><span class="spinner-bar"></span><span class="spinner-bar spinner-bar1"></span><span class="spinner-bar spinner-bar2"></span><span class="spinner-bar spinner-bar3"></span></div>'),i+="</div>",i+="<div class='tag-tail'>",e.count>=0&&(i+="<div class='tag-count' title='"+e.count+"'>"+a.convertToUnity(e.count,d)+"</div>"),i+="</div></div>",e.isDeletable&&(t._simplifiedTagger?i+="<div class='tag-delete' title='"+a.getText("deleteTag")+"'><span class='fonticon fonticon-trash'></span></div>":i+="<div class='tag-delete' title='"+a.getText("deleteTag")+"'><span class='fonticon fonticon-cancel'></span></div>"),i+="</li>"},r}),define("DS/TagNavigator/simplified/views/RootWhoView",["UWA/Core","DS/TagNavigator/simplified/views/RootWView","DS/TagNavigator/simplified/utils/PersonUtils","DS/TagNavigator/Logger","UWA/Class/Promise","DS/TagNavigator/Predicate","DS/TagNavigator/TagValue","DS/TagNavigator/TagValueView"],function(e,t,i,a,n,r,s,o){"use strict";return t.extend({tagName:"div",className:"root-container-inner root-who-container",init:function(e){this._rootW="ds6w:who",this._parent(e)},setup:function(e){this._parent(e)},render:function(){return this.peopleContainerDiv=e.createElement("div",{id:"all-tags",class:"people-container"}),this.peopleContainerDiv.inject(this.container),this._parent()},toggleToolBoxVisibility:function(e){this.sortIcon.container.toggleClassName("expanded")},redraw:function(e){return new n(function(e){if(a.log("RootWhoView: Inside redraw"),!this._redrawStatus&&this._optimizedRedraw)return a.warn("RootWhoView: redraw status is false, returning.."),this;this.peopleContainerDiv.empty();var t=this.getObservedNavImpl(),n=this.hasAdvancedFocsuedProxy(t,i.PERSON_REFINE),l=this._getPreferredPredicates().filter(function(e){return"ds6w:who"!=e});if(n&&l.length>0){var c=this.getTaggerView(),d=new s(i.personPredicate,{type:"string",displayValue:"Person",hasDisplayValue:!0});new o(d,c,1);let t=["person"],a=r.getCommunityTagPredicate(this._rootW).id();-1!=l.indexOf(a)&&t.push(a);let n=r.getCompanyTagPredicate(this._rootW).id();-1!=l.indexOf(n)&&t.push(n);var g=this.availableTagsToHtml(c,null,t);this.peopleContainerDiv.innerHTML=g,this.container.getElements("#all-tags .predicate:not(.searchexcluded)").forEach(function(e){e.show()}),e(this.getContentStatus(this.peopleContainerDiv)),c.hasEvent("onFlattenedPersonListStatusUpdate")||(this.onPersonListUpdate=this.onFlattenedPersonListStatusUpdate.bind(this),c.addEvent("onFlattenedPersonListStatusUpdate",this.onPersonListUpdate))}else{g=this.availableTagsToHtml(this.getTaggerView(),null,l);this.peopleContainerDiv.innerHTML='<div id="all-tags">'+g+"</div>",this.container.getElements("#all-tags .predicate:not(.searchexcluded)").forEach(function(e){e.show()}),e(this.getContentStatus(this.peopleContainerDiv))}this._redrawStatus=!1}.bind(this))},onFlattenedPersonListStatusUpdate:function(e){e.viewId=this._rootW,this.dispatchEvent("onViewUpdate",e)},destroy:function(){this.stopListening(),this.model=null,this.onPersonListUpdate&&(this.getTaggerView().removeEvent("onFlattenedPersonListStatusUpdate",this.onPersonListUpdate),this.onPersonListUpdate=null),this._parent()}})}),define("DS/TagNavigator/simplified/views/RootWhereView",["UWA/Core","DS/TagNavigator/simplified/views/RootWView","DS/TagNavigator/simplified/utils/PersonUtils","DS/TagNavigator/TagValue","DS/TagNavigator/TagValueView","DS/TagNavigator/Logger","DS/TagNavigator/simplified/utils/LocationUtils","UWA/Class/Promise","DS/TagNavigator/PredicateView","DS/TagNavigator/TaggerSettings"],function(e,t,i,a,n,r,s,o,l,c){"use strict";return t.extend({tagName:"div",className:"root-container-inner root-where-container",init:function(e){this._rootW="ds6w:where";try{s.init()}catch(e){}this._parent(e)},setup:function(e){this._parent(e)},render:function(){return this._parent()},redraw:function(e){if(r.log("RootWhereView: Inside redraw"),!this._redrawStatus&&this._optimizedRedraw)return r.warn("RootWhereView: redraw status is false, returning.."),this;var t=this.getTaggerView(),i=t.getObservedNavigator(),a=e.onSearch,n=this.hasAdvancedFocsuedProxy(i,s.DATA_LOCATION),c=this._getPreferredPredicates();if(!a){var d=UWA.is(c,"array")?c.filter(function(e){return e==s.COMPUTED_COUNTRY_INFO||e==s.COMPUTED_CITY_INFO}):n?[s.COMPUTED_COUNTRY_INFO,s.COMPUTED_CITY_INFO]:[];d.length>0&&n&&this._computeUsersLocations(t,d)}if(-1!==c.indexOf("ds6w:dataSource")){var g=l.getExistingPredicateViewById("ds6w:dataSource");g&&g.getChildrenTagValueViews().forEach(function(e){var t=e.id();UWA.is(t)&&UWA.is(t,"array")&&t.length>0&&(t=t[0]),t&&e.setIcon(s.getSourceIcon(t))})}var u=this.availableTagsToHtml(t,null,c);if(this.container.innerHTML='<div id="all-tags">'+u+"</div>",this.container.getElements(".predicate:not(.searchexcluded)").forEach(function(e){e.show()}),this._redrawStatus=!1,!e.updateOnRedraw)return new o(function(e){e(this.getContentStatus(this.container))}.bind(this));this.dispatchEvent("onViewUpdate",this.getContentStatus(this.container))},_clearContents:function(e){e.forEach(function(e){var t=l.getExistingPredicateViewById(e);t&&t.clearContent(!0)})},_computeUsersLocations:function(e,t){r.log("RootWhereView: ENTER _computeUsersLocations");var o=e.getObservedNavigator(),l=o.getTagsServerForUserInfo();if(s.ensurePredicates(l),c.getOption("geolocationHierarchy")){var d=s.computeGeoLocations(o,["ds6w:responsible"],void 0,!0);if(0!==d.total&&d.total!==d.pending){var g=d.continents,u=s.computedCountryInfo.getFullPredicateID();g.forEach(function(t){var i,r,o=t.get("title"),c=[];t.getCountries().forEach(function(d,g){i=a.getTagValue({count:d.getCount(),type:"string",object:[t.id,d.id],dispValue:[o,d.get("title")],sixw:u,icon:d.get("imageURL")},null,null,null,null,l),0==g&&i.parent.clearEmbeddedTagValues(),i.setEmbeddedSixW(s.countryPredicate),r=d.getPersons(),i.setEmbeddedTagValues(r),c=c.concat(r),new n(i,e,d.getCount())})})}}else{var h=i.getUsersInfo(o,["ds6w:responsible"]),p={},f={};if(UWA.is(h,"array")){if(r.log("RootWhereView: number of persons info found="+h.length),h.forEach(function(e){if(-1!==t.indexOf(s.COMPUTED_COUNTRY_INFO)){var i=e.getCountry();i&&(i=i.filter(function(e){return!!e})).forEach(function(t){var i=p[t];i||(i=[],p[t]=i),i.push(e)})}var a;-1!==t.indexOf(s.COMPUTED_CITY_INFO)&&((a=e.getCity())&&(a=a.filter(function(e){return!!e})).forEach(function(t){var i=f[t];i||(i=[],f[t]=i),i.push(e)}))}),Object.keys(p).length>0){u=s.computedCountryInfo.getFullPredicateID(),s.countryPredicate.id();for(var m in p){m.split(".")[1];(T=a.getTagValue({count:p[m].length,type:"string",object:m,sixw:u},null,null,null,null,l)).setEmbeddedSixW(s.countryPredicate),T.setEmbeddedTagValues(p[m]),new n(T,e,p[m].reduce(function(e,t){return e+t.get("count")},0))}}if(Object.keys(f).length>0){u=s.computedCityInfo.getFullPredicateID();for(var v in f){var T;(T=a.getTagValue({count:f[v].length,type:"string",object:v,sixw:u},null,null,null,null,l)).setEmbeddedSixW(s.cityPredicate),T.setEmbeddedTagValues(f[v]),new n(T,e,f[v].reduce(function(e,t){return e+t.get("count")},0))}}}}},destroy:function(){this.stopListening(),this.model=null,this._parent()}})}),define("DS/TagNavigator/simplified/actions/Group",["UWA/Core","UWA/Class/Promise","DS/TagNavigator/simplified/actions/AbstractAction","DS/TagNavigator/Predicate","DS/TagNavigator/PredicateView","DS/TagNavigator/simplified/actions/ActionUtils","DS/TagNavigator/Logger","DS/TagNavigator/TaggerNLS"],function(e,t,i,a,n,r,s,o){"use strict";return i.extend({setup:function(e){this._parent(e),this.set({actionClass:"grouped-by"}),this._selection=this.get("selection")},_getGroupingConfig:function(){let e=this.getNavImpl(),t=e.getFocusedProxy(),i={};if(t)return t.getGroupingConfig();{let t=e._getProxiesHavingGroupingSupport();if(t.length)for(let e=0;e<t.length;e++){let a=t[e].getGroupingConfig();if(0===Object.keys(i).length&&i.constructor===Object&&a)i=a;else for(let e in a)i[e]>=-1&&-1!=a[e]&&(-1==i[e]?i[e]=a[e]:i[e]>a[e]&&(i[e]=a[e]))}}return i},onPredicateSelection:function(i){var n=this;return new t(function(t,r){var l,c,d,g=i.getClosest(".predicate-header"),u=g.getParent();l="ds6w:type"==u.getAttribute("predicate")&&(c="type_categorization",(d=n.getNavImpl().getFocusedProxy())&&c&&d.getAdvancedOption(c)&&d)?a.getPredicate("type_categorization"):a.getPredicate(u.getAttribute("predicate"));if(0==n.getNavImpl().hasGroupingSupport(l.id(),!0))return s.log("Predicate level grouping is disabled for "+l.id()),void r();g.hasClassName(this.get("actionClass"))?(g.removeClassName(this.get("actionClass")),g.getElement(".action-icon").remove(),this.removeAddedObject(l)):(!function(){var e=u.getElements("li.tag");if(e.length&&e.forEach(function(e){e.hasClassName(n.get("actionClass"))&&e.removeClassName(n.get("actionClass"))}),u.getElement(".people-view-container")){var t=u.getElement(".people-view-container").getElements(".people-view");t.length&&t.forEach(function(e){e.hasClassName(n.get("actionClass"))&&(e.removeClassName(n.get("actionClass")),e.removeClassName("picked"),e.getElement(".people-template").removeClassName("people-selected"))})}}(),g.addClassName(this.get("actionClass")),this.computePredObject(l,null,g),e.createElement("span",{class:"action-icon fonticon fonticon-group",title:o.getText("remove_groupBy")}).inject(event.target,"after").setAttribute("action","group"));t()}.bind(this))},onTagSelection:function(e){var t=e.getClosest("li.predicate"),i=t.getAttribute("predicate"),n=e.getAttribute("title"),r=a.getPredicate(i),s=function(){t.getElement(".predicate-header").hasClassName(this.get("actionClass"))&&(t.getElement(".predicate-header").removeClassName(this.get("actionClass")),t.getElement(".action-icon").remove(),this.removeAddedObject(r))}.bind(this);e.hasClassName(this.get("actionClass"))?(e.removeClassName(this.get("actionClass")),this.removeAddedObject(r,n)):(s(),e.addClassName(this.get("actionClass")),this.computePredObject(r,n,e))},onPersonSelection:function(e){var t=e.view,i=e.refineData,n=i.predicate.split("/")[i.predicate.split("/").length-1],r=a.getPredicate(n),s=t.container.getClosest("li.predicate");s.getElement(".predicate-header").hasClassName(this.get("actionClass"))&&(s.getElement(".predicate-header").removeClassName(this.get("actionClass")),s.getElement(".action-icon").remove(),this.removeAddedObject(r)),t.container.hasClassName("picked")&&t.container.hasClassName(this.get("actionClass"))?(t.container.removeClassName("picked"),t.container.removeClassName(this.get("actionClass")),t.setAsUnselected(),this.removeAddedObject(r,i.dispValue)):(t.container.addClassName("picked"),t.container.addClassName(this.get("actionClass")),t.setAsSelected(),this.computePredObject(r,i.dispValue))},_getTagObjectInfo:function(e,t,i){return t?e[e.length-1].id():i&&e.hasChildren()?[e.id()]:e.id()},_manageUniqueHierarchyPathSelection:function(e,t,i,n,r,s){var o=this,l=e.object.map(function(e){return e.object}),c=this._getTagObjectInfo(t,n,r),d=l.filter(function(e){if(e.length!==i.length)return a=c,(t=e).length<a.length?n=t.every(function(e,t){return a[t]===e}):r=a.every(function(e,i){return t[i]===e}),n||r;var t,a,n,r}),g=d;if(0==d.length&&this._getGroupingConfig().maxHierarchyPerLevel>0&&l[0][0]!==c[0]){g=l;var u=t[0].getPredicateView().getTagValueViews(g[0],!0,!0)[0].map(function(e){return e.getDisplayname()});s=this._getRootTagValueView(e.predicate,u[0])}g.forEach(function(i){o.removeAddedObject(a.getPredicate(e.predicate),i,!0);var n=t[0].getPredicateView().getTagValueViews(i,!0,!0)[0].map(function(e){return e.getDisplayname()});o._removeHierarchySelection(s,n)})},computePredObject:function(e,t,i){var r,o,l,c=this,d=this._getGroupingConfig(),g=e.id(),u=n.getPredicateView(e);i&&(t?i.getClosest("ul.treeTags")&&(r=!0,s.log("a hierarchical tag is selected")):i.getClosest(".predicate").getElement(".predicate-content").getElements("ul.treeTags").length>0&&(o=!0,s.log("a predicate with hierarchical tags is selected")));var h=[],p=[];if(r){for(var f,m=i.getElement(".arrow.tree"),v=i;f=v.getClosest("ul.treeTags");)h.push(f),v=f.getClosest("ul.tags-list");for(var T=h.length-1;T>=0;T--)p.push(h[T].getElement("li.tag").getElement(".tag-label").getText());m||p.push(i.getElement(".tag-label").getText()),s.log("selection path is:"+JSON.stringify(p)),l=u.getTagValueViews(p,!0)}else l=u.getTagValueViews(t||null);var C,w,b=this._selection.map(function(e){return e.predicate}),y=b.indexOf(g);if(-1!==y?(C=this._selection[y],t?(d.maxPerLevel>0&&C.object.length+1>d.maxPerLevel&&this.removeAddedObject(a.getPredicate(C.predicate),C.object[0].dispText,!0),r&&(this._manageUniqueHierarchyPathSelection(C,l[0],p,r,o,h[h.length-1]),d.maxHierarchyPerLevel>0&&d.maxPerLevel>0&&this._selection[y].object.length+1>d.maxPerLevel&&this.removeAddedObject(a.getPredicate(this._selection[y].predicate),this._selection[y].object[0].dispText,!0))):(this._selection[y].object=[],this._selection[y].predLevel=!0),w=this._selection[y].object):(t?(d.maxLevels>0&&b.length+1>d.maxLevels&&this.removeAddedObject(a.getPredicate(b[0]),void 0,!0),this._selection.push({predicate:g,object:[]})):(d.maxLevels>0&&b.length+1>d.maxLevels&&this.removeAddedObject(a.getPredicate(b[0]),void 0,!0),this._selection.push({predicate:g,object:[],predLevel:!0})),w=this._selection[this._selection.length-1].object),l.forEach(function(t){var i={};if(i.dispText=UWA.is(t,"array")?t[t.length-1].getDisplayname():t.getDisplayname(),i.object=c._getTagObjectInfo(t,r,o),i.type=e.getType(),!r){var a=t.getDuplicateTagValues();if(UWA.is(a,"array")&&a.length>0){var n=i.merged=[];a.forEach(function(e){n.push({object:e.id()})})}}w.push(i)}),this.get("isInteractive")){var S=0;this._selection.forEach(function(e){S+=e.object.length}),this.set("selectionCount",S)}},_removeSelection:function(e,t,i){var a=this,n=this.getPredicateElement(e);if(n){var r=n.getElement(".predicate-header");if(i)r.removeClassName("grouped-by"),r.getElement(".action-icon").remove();else if(n.getElements("li.tag").forEach(function(e){var i=!0;t&&e.getElement(".tag-label").getText()!==t&&(i=!1),i&&e.hasClassName(a.get("actionClass"))&&e.removeClassName(a.get("actionClass"))}),n.getElement(".people-view-container"))n.getElement(".people-view-container").getElements(".people-view").forEach(function(e){e.hasClassName(a.get("actionClass"))&&(e.removeClassName(a.get("actionClass")),e.removeClassName("picked"),e.getElement(".people-template").removeClassName("people-selected"))})}else s.error("Predicate elem not found in the DOM for "+predId)},_getRootTagValueView:function(e,t){return this.getPredicateElement(e).getElement(".predicate-content").getElement(".tags-list").getChildren().filter(function(e){return e.hasClassName("treeTags")?e.getElement(".tag:not(.childrenTags)").getElement(".tag-label").getText()===t:e.getElement(".tag-label").getText()===t})[0]},_removeHierarchySelection:function(e,t){if(1==t.length)e.getElement(".tag:not(.childrenTags)").removeClassName(this.get("actionClass"));else{var i,a=0;for(var n of t)i=0==a?e:r.getChildTag(i,n),++a;i.hasClassName("treeTags")?i.getElement(".tag:not(.childrenTags)").removeClassName(this.get("actionClass")):i.removeClassName(this.get("actionClass"))}},removeAddedObject:function(e,t,i){var a,n=e.id(),r=-1;if(s.log("removing the entry for predicate="+n+(t?", and tag ="+t:"")),-1!==(a=this._selection.findIndex(function(e){return e.predicate==n})))if(t){var o=this._selection[a],l=UWA.is(t,"array");-1!==(r=l?o.object.findIndex(function(e){if(e.object.length==t.length)return e.object.every(function(e,i){return e===t[i]})}):o.object.findIndex(function(e){return e.dispText==t}))?(o.object.splice(r,1),0==o.object.length&&(i||this._selection.splice(a,1)),i&&!l&&this._removeSelection(n,t)):s.error("tag entry NOT found")}else{var c=this._selection.splice(a,1);i&&this._removeSelection(n,void 0,c[0].predLevel)}else s.error("predicate entry NOT found");if(this.get("isInteractive")){var d=0;this._selection.forEach(function(e){d+=e.object.length}),this.set("selectionCount",d)}},addPredicate:function(e){s.log("inside Group#addPredicate");var t=e.predicate,i=this._selection.map(function(e){return e.predicate}),n=i.indexOf(t),r=this._getGroupingConfig();-1===n?(r.maxLevels>0&&i.length+1>r.maxLevels&&this.removeAddedObject(a.getPredicate(i[0])),this._selection.push({predicate:t,object:e.object,predLevel:!0})):(this._selection[n].object=e.object,this._selection[n].predLevel=!0)},removePredicate:function(e){return s.log("inside Group#removePredicate"),this.removeAddedObject(a.getPredicate(e.predicate))},isRefreshNeeded:function(e){return this._selection.filter(function(t){var i=!1;if(t.predLevel){var r=t.predicate,o=a.getPredicate(r);if(e&&e.isEmbedded){var l=this.get("current");(function(e,t){if(s.log("currentGroups="+JSON.stringify(e)),s.log("newGroups="+JSON.stringify(t)),e.length==t.length){for(var i=!0,a=0;a<e.length&&i;a++){i=!1;var n=e[a],r=t[a];if(UWA.is(n.object,"string"))UWA.is(r.object,"string")&&(i=n.object===r.object);else if(UWA.is(n.object,"object")){if(UWA.is(r.object,"object"))if("date"==n.type&&"date"==r.type)i=!0;else{var o=Object.keys(n.object.value),l=Object.keys(r.object.value);o.length==l.length&&(i=o.every(function(e){return-1!==l.indexOf(e)}))}}else UWA.is(n.object,"array")&&UWA.is(r.object,"array")&&(i=n.object.every(function(e){return-1!==r.object.indexOf(e)}));i||(s.warn("DIFFERENCE FOUND IN THE EXISTING AND NEW GROUPINGS"),s.log("_current="+JSON.stringify(n)),s.log("_new="+JSON.stringify(r)))}return!i}return s.warn("NUMBER OF THE EXISTING AND NEW GROUPINGS ARE DIFFERENT"),!0})(l.object,t.object)&&(i=!0,s.log("grouping needs to be updated"),this.addPredicate(l))}else{var c=n.getPredicateView(o).getTagValueViews();UWA.is(c,"array")&&function(e,t){if(e.length!=t.length)return s.warn("NUMBER OF THE EXISTING AND NEW GROUPINGS ARE DIFFERENT"),!0;var i={};return t.forEach(function(e){i[e.dispText]=[e.object].concat(e.merged?e.merged:[])}),e.some(function(e){var t=!1,a=i[e.getDisplayname()];if(a){var n=[e.id()].concat(e.getDuplicateTagValues().map(function(e){return e.id()}));a.length===n.length?a.every(function(e){return-1!==n.indexOf(e)})||(s.log("There is a difference between the existing and new group, due to different merged tags"),s.log("existing Info="+JSON.stringify(a)),s.log("new Info="+JSON.stringify(n)),t=!0):(s.log("There is a difference between the existing and new group, different number of merged tags"),s.log("existing Info="+JSON.stringify(a)),s.log("new Info="+JSON.stringify(n)),t=!0)}else s.log("Tag not found in the existing groups:"+e.getDisplayname()),t=!0;return t})}(c,t.object)&&(i=!0,s.log("grouping needs to be updated"),this.computePredObject(o,null))}}return i}.bind(this)).length>0}})}),define("DS/TagNavigator/simplified/activeTags/GroupedTags",["UWA/Core","UWA/Class/View","DS/TagNavigator/TaggerNLS","DS/TagNavigator/ActiveGroupView","DS/TagNavigator/Predicate"],function(e,t,i,a,n){"use strict";return t.extend({tagName:"div",className:"grouped-tags-list",setup:function(e){this._parent(e)},render:function(){return this.activeGroupings=this.getOption("activeGroupings"),e.createElement("span",{class:"fonticon fonticon-group"}).inject(this.container),e.createElement("span",{class:"title",text:i.getText("groupedTags")}).inject(this.container),this.groupedTagsList=e.createElement("ul",{class:"active-predicate-list"}).inject(this.container),this.redraw(this.activeGroupings),this},redraw:function(e){let t=this.groupedTagsList,i=this;e&&e.length?(this.emptyContent(),this.show(),e.forEach(e=>{let a=e.predicate,r=a.split("/").pop(),s=r.contains("sixw:")?n.getPredicate(r.replace("sixw:","")).displayName():n.getPredicate(r).displayName();if(e.predLevel){let e={tagName:s,predicate:a,isPredicate:!0,predDispName:s,grouped:!0};i._createActiveTagView(e).container.inject(t)}else e.object.forEach(e=>{let n={tagName:e.dispText,predicate:a,predDispName:s,grouped:!0};i._createActiveTagView(n).container.inject(t)})})):this.hide()},_createActiveTagView:function(e){let t={id:e.tagName.replace(" ","_")+"::"+e.predicate,text:e.tagName,isSimplified:!0,isGrouped:!0,condition:e,attribute:[{"predicate-name":e.predDispName,is_predicate:e.isPredicate}]},i=new a(t).render();return i.addEvent("removeActiveGroup",this.dispatchRemoveGroup.bind(this)),i},dispatchRemoveGroup:function(e){this.dispatchEvent("removeGroup",e)},emptyContent:function(){this.groupedTagsList.empty()},destroy:function(){this.parent.destroy()}})}),define("DS/TagNavigator/simplified/activeTags/AdvancedActiveTagsView",["UWA/Core","UWA/Class/View","DS/TagNavigator/TaggerNLS","DS/TagNavigator/simplified/model/AdvancedFilter","DS/TagNavigator/simplified/activeTags/ActiveTagsViewModel","DS/UIKIT/Tooltip","DS/TagNavigator/simplified/views/Expander","DS/TagNavigator/simplified/views/ActionsView","DS/TagNavigator/simplified/views/EmptyView","DS/TagNavigator/simplified/actions/ActionUtils","DS/TagNavigator/simplified/activeTags/ActiveTagsUtils","DS/TagNavigator/simplified/activeTags/PredicateView","DS/TagNavigator/simplified/activeTags/GroupedTags","DS/TagNavigator/simplified/activeTags/ExcludedTags"],function(e,t,i,a,n,r,s,o,l,c,d,g,u,h){"use strict";return t.extend({tagName:"div",className:"active-tags-edit-container",domEvents:{"click .active-tags-close":"clearAllActiveTags","click .wux-controls-button":"toggleView"},setup:function(e){this._parent(e)},render:function(){this.exclude=this.getOption("exclude"),this.toShowHeader=!1,this.predicateViews={},this.model instanceof n&&this.listenTo(this.model,{"onChange:mode":this.updateMode}),this.advanceFilter=new a,this.mainContainer=e.createElement("div",{class:"active-tags-container"});let t=e.createElement("div",{class:"active-tags-close"}),c=e.createElement("span",{class:"fonticon fonticon-trash"}).inject(t);return new r({position:"bottom",target:c,body:i.getText("clearActiveTags"),className:"tagger-filter-tooltip"}),this.expander=new s({label:i.getText("activeTagsHeader"),deleteButton:!0,editBtn:!0}).render().inject(this.container),this.mainContainer.inject(this.expander.container.getElement(".section-body")),this.emptyView=(new l).render().inject(this.expander.container.getElement(".section-body")),this.emptyView.setMessageText(i.getText("selectTagMsg")),this.createGroupView(),this.includedTags=e.createElement("div",{class:"included-tags-list not-modified "+this.mode}).inject(this.mainContainer),this.createExcludeView(),this.mode=this.model.get("mode"),this.actionView=new o({hideMenuBtn:!0}).render().inject(this.expander.container.getElement(".section-body")).show(),this.redraw(),this},redraw:function(){if(this.mainContainer.innerHTML="",this.destroyPredicateViews(),this.groupedView.container.inject(this.mainContainer),"writeable"==this.mode?this.groupedView.container.hide():this.groupedView.redraw(this.activeGroupings),this.includedTags=e.createElement("div",{class:"included-tags-list not-modified "+this.mode}).inject(this.mainContainer),this.excludeView.container.inject(this.mainContainer),"readOnly"!==this.mode||void 0!==this.filter&&this.filter.allfilters.condition.length||void 0!==this.activeGroupings&&this.activeGroupings.length)this.show(),this.toShowHeader=!1,"readOnly"==this.mode?(this.actionView.hide(),this.expander.toggleEditBtn(!0)):(this.actionView.show(),this.expander.toggleEditBtn()),this.dispatchEvent("showTaggerCriteria"),this.updateTags();else if(!this.container.isHidden())return void this.hide()},setActionsManager:function(e){this.actionManager=e,this.actionView.addEvent("onActionSelection",e.startAction.bind(e)),this.actionView.addEvent("onActionLaunched",e.launchAction.bind(e)),this.actionView.addEvent("onActionCancelled",e.cancelAction.bind(e))},toggleView:function(){this.actionManager.hideActionMenu(),this.actionView.container.setStyle("height",50),this.actionView.show(),this.actionView.primaryButton.disable(),this.actionView.actionSelected("editTagsSelect")},callUpdateModelFromAction:function(e){this.actionView.updateModel(e)},clearAllActiveTags:function(e){e.preventDefault(),e.stopPropagation(),this.toShowHeader=!1,"readOnly"==this.model.get("mode")?this.dispatchEvent("clickOnTrash"):(this.removeAllTags(),this.addNoTagsText(),this.dispatchEvent("removeSelectedElems"),this.enableActionButton())},updateMode:function(){this.mode=this.model.get("mode"),this.redraw()},setAdvancedFilter:function(e,t){this.advanceFilter=e,this.groupings=t,this.activeGroupings=UWA.clone(this.groupings.getActiveGroupings()),this.computeFilters(),this.redraw()},disableEditView:function(e){e=e||!1,this.container.toggleClassName("disable",e)},createGroupView:function(){let e=this.activeGroupings;this.groupedView=new u({activeGroupings:e}).render().inject(this.mainContainer),this.groupedView.addEvent("removeGroup",this.removeGroupFromfilter.bind(this))},createExcludeView:function(){this.excludeView=new h({mode:this.mode,exclude:this.exclude}).render().inject(this.mainContainer),this.excludeView.addEvent("excludeTag",this.excludeTag.bind(this)),this.excludeView.addEvent("informActiveView",this.enableActionButton.bind(this)),this.excludeView.addEvent("removeTag",this.removeTag.bind(this))},computeFilters:function(){let e,t=this.advanceFilter.computeFilterObj(null,null,void 0,!0,!1);t&&t.allfilters&&t.allfilters.condition&&t.allfilters.condition.length?e=t:t.allfiters&&t.allfiters.condition&&0!=t.allfiters.condition.length||(e=void 0),this.filter=e},updateTags:function(e){let t,i=[];if(e&&(e.isFreeInput?this.updateFreeInputValues(e):t=this.advanceFilter.toggle(e)),!t||t.isSelected)this.computeFilters(),this.filter&&this.filter.allfilters&&(i=this.filter.allfilters.condition?this.filter.allfilters.condition:this.filter.allfilters),i.length||this.activeGroupings&&this.activeGroupings.length&&"readOnly"==this.mode?(this.emptyView&&(this.emptyView.hide(),this.expander.toggleClearButton(!1)),this.createPredicateView(i),"writeable"==this.mode||this.toShowHeader&&"readOnly"==this.mode?this.excludeView.updateExcludedTags(i):this.excludeView.emptyContent()):this.addNoTagsText();else{let e=!1,i={condition:t.condition,id:t.id};this.predicateViews[t.id]&&((e=this.predicateViews[t.id].destroyActiveTagView(i))||this.excludeView.destroyActiveTagView(i))}},destroyPredicateViews:function(e){if(e)this.predicateViews[e].destroy(),delete this.predicateViews[e];else{for(let e in this.predicateViews)this.predicateViews[e].destroy();this.predicateViews={}}},addNoTagsText:function(){this.emptyView.container.show(),this.expander.toggleClearButton(!0)},updateFreeInputValues:function(e){let t;if(e){let i=e.predicate.id();(t=this.advanceFilter.isSelectedAttribute(i,e))?this.removeFreeInputs(e):this.createFreeInputs(e)}},createFreeInputs:function(e){if(e){let t=e.predicate.getFullPredicateID();this.advanceFilter.createFreeInput(t,e.type,e.value,e.value.nls)}},removeFreeInputs:function(e){let t=e.predicate.getFullPredicateID();this.advanceFilter.removeFreeInput(t,e.type,e.value,e.value.nls,e.value.isSimplifiedCriteria);e.value.nls},createPredicateView:function(e){let t=this;this.toShowHeader||(this.toShowHeader=d.hasOverloadedOperator(e,this.advanceFilter)),this.includedTags.toggleClassName("not-modified",!this.toShowHeader),e.forEach(e=>{let i=Object.keys(e)[0];if(t.predicateViews[i])t.predicateViews[i].updatePredicateView({predicateInfo:e,mode:t.mode,toShowHeader:t.toShowHeader}),t.predicateViews[i].container.isInjected()||t.predicateViews[i].inject(t.includedTags);else{let a=new g({predicateInfo:e,mode:t.mode,toShowHeader:t.toShowHeader,exclude:t.exclude}).render().inject(t.includedTags);t.predicateViews[i]=a,a.addEvent("removeTag",t.removeTag.bind(t)),a.addEvent("informActiveView",t.enableActionButton.bind(t)),a.addEvent("updatePredicateOperator",t.updateOperator.bind(t)),a.addEvent("excludeTag",t.excludeTag.bind(t)),a.addEvent("destroyView",t.destroyPredicateViews.bind(t))}})},hasActiveGroupings:function(){return this.activeGroupings&&this.activeGroupings.length},enableActionButton:function(){this.actionView.enablePrimaryButton(),this.actionManager.enablePrimaryButton()},removeGroupFromfilter:function(e){this.actionManager.startAction({action:c.ACTION_GROUP,isInteractive:!1,grouping:e})},removeTag:function(e){if(e.id.contains("sixw:")){let t=e.id.replace("sixw:",""),i=["string","boolean"],a={type:e.type};-1==i.indexOf(e.type)&&(e.object.from||e.object.to)?a.value={isSimplifiedCriteria:e.isSimplifiedCriteria,from:e.object.from,to:e.object.to}:a.value=e.object,this.advanceFilter.removeFreeInput(t,a.type,a.value)}else this.advanceFilter.toggle(e);this.enableActionButton(),"readOnly"==this.mode&&this.dispatchEvent("removeTagFromActive")},excludeTag:function(e){let t=e.condition?e.condition.excluded:e.excluded;this.advanceFilter.handleExclude(e,t),this.enableActionButton(),"readOnly"==this.mode?this.dispatchEvent("removeTagFromActive"):t?this.excludeView.addTag(e):this.predicateViews[e.id].addTag(e)},updateOperator:function(e){let{predicate:t,operator:i,informView:a}=e;this.advanceFilter.changeLocalOperator(t,i),a&&this.enableActionButton()},removeAllTags:function(){this.activeGroupings=null,this.advanceFilter.clear(),this.destroyPredicateViews(),this.groupedView&&this.groupedView.emptyContent(),this.excludeView.emptyContent()},destroy:function(){this.actionView&&this.actionView.destroy(),this.groupedView&&this.groupedView.destroy(),this.excludeView&&this.excludeView.destroy(),this.emptyView&&this.emptyView.destroy(),this.destroyPredicateViews()}})}),define("DS/TagNavigator/simplified/actions/Colorize",["UWA/Core","DS/TagNavigator/simplified/actions/AbstractAction","DS/TagNavigator/Predicate","DS/TagNavigator/PredicateView","DS/TagNavigator/simplified/utils/PersonUtils"],function(e,t,i,a,n){"use strict";return t.extend({setup:function(){this._parent(),this.set({actionClass:"colorized"}),this._selection=this.get("selection"),this._selectionToReset=[],this.taggerView=this.getTaggerView()},onTagSelection:function(e){var t=e.getClosest("li.predicate"),n=t.getAttribute("predicate");this.parentDomId=t.id;var r=e.getAttribute("title"),s=i.getPredicate(n);let o,l=a.getPredicateView(s),c=[];if(e.hasAttribute("level")){for(var d,g=[],u=[],h=e.getElement(".arrow.tree"),p=e;d=p.getClosest("ul.treeTags");)g.push(d),p=d.getClosest("ul.tags-list");for(var f=g.length-1;f>=0;f--)u.push(g[f].getElement("li.tag").getElement(".tag-label").getText());h||u.push(e.getElement(".tag-label").getText()),c=l.getTagValueViews(u,!0),o=u.length-1,c[0]=c[0][o]}else c=l.getTagValueViews(r);let m=this.taggerView.getObservedNavigator().getCache();if(this.fullPredId=s.getFullPredicateID(),m.colorManager.checkForMapObject(this.fullPredId,c[0]),e.hasClassName("colorize")){e.removeClassName("colorize"),e.removeClassName("picked-for-colorize");var v=this._selection.findIndex(function(t){return t===e.id});-1!==v&&this._selection.splice(v,1),e.getElement(".tag-color").addClassName("hide-color");let i=m.colorManager.resetColorForTagValue(c[0]);this._selectionToReset.push({tv:c[0],color:i,isRemoved:!0,tagElem:e,parentElem:t})}else{e.addClassName("colorize"),e.addClassName("picked-for-colorize"),this._selection.push(e.id);let i=m.colorManager.getNewColorForTagValue(c[0],!0);i&&(e.getElement(".tag-color").setStyle("background-color",i),e.getElement(".tag-color").removeClassName("hide-color"),this._selectionToReset.push({tv:c[0],color:i,isRemoved:!1,tagElem:e,parentElem:t}))}return this.get("isInteractive")&&this.set("selectionCount",this.getSelectionCount()),m.colorManager.inColorizePredicate(this.fullPredId),this.disablePredicate(t,n),!1},disablePredicate:function(e,t){let i=this.taggerView.tagsContainer.getElements("li.predicate"),a=!!e.getElements(".colorize").length;e.toggleClassName("colorize",a),e.getElement(".toolboxView.fonticon-palette")&&e.getElement(".toolboxView.fonticon-palette").toggleClassName("selected",a),i.forEach((e,i)=>{let n=e.getAttribute("predicate");e.getElement(".toolboxView.fonticon-palette")&&e.getElement(".tool-icon.fonticon-palette").addClassName("hide"),n!==t&&(e.getElement(".predicate-content .innerForTransition").toggleClassName("add-opacity",a),e.getElement(".toolbox")&&e.getElement(".toolbox").toggleClassName("add-opacity",a))}),e.getElement(".clear-selection").toggleClassName("hide",!this.getSelectionCount()),e.getElement(".predicate-label").toggleClassName("adjust-width",this.getSelectionCount())},onPersonSelection:function(e,t,i,a){let r,s,o,l,c,d,g;if(e)r=e.view.container,s=e.refineData,o=e.isComplex,c=(l=e.model).get("tagValues"),d=r.getClosest("li.predicate"),this.parentDomId=d.id,g=d.getAttribute("predicate"),this.fullPredId=this.taggerView.getIdFromDOMId(this.parentDomId);else{let e=this.taggerView.getObservedNavigator(),u=n.getUsersInfo(e,[t]),h=i.getElement(".item-label").getText();d=(r=i).getClosest("li.predicate"),this.parentDomId=d.id,g=t,this.fullPredId=this.taggerView.getIdFromDOMId(this.parentDomId),l=u.filter(e=>{if(e.get("title")==h)return e}),s=(o=this.taggerView.hasAdvancedFocsuedProxy(e,n.PERSON_REFINE)&&a)?n.buildCondition(l):l[0].getRefineStructure(this.fullPredId),c=l[0].get("tagValues")}let u,h=this.taggerView.getObservedNavigator().getCache();if(h.colorManager.checkForMapObject(this.fullPredId,c[0]),r.hasClassName("colorize")){r.removeClassName("colorize"),r.removeClassName("picked-for-colorize"),u=o?s.condition.object:s.object;var p=this._selection.findIndex(e=>e===u);-1!==p&&this._selection.splice(p,1);let e=h.colorManager.resetColorForPersonTagValue(c[0]);r.getElement("img").setStyle("border","none"),this._selectionToReset.push({tv:c[0],color:e,isRemoved:!0,tagElem:r,isPerson:!0,parentElem:d})}else{r.addClassName("picked-for-colorize"),o?this._selection.push(s.condition.object):this._selection.push(s.object);let e=h.colorManager.getColorForTagValue(c[0],!0);e&&this.addColorToPerson(r,e),this._selectionToReset.push({tv:c[0],color:e,isRemoved:!1,tagElem:r,isPerson:!0,parentElem:d})}return h.colorManager.inColorizePredicate(this.fullPredId),this.get("isInteractive")&&this.set("selectionCount",this.getSelectionCount()),this.disablePredicate(d,g),!1},addSelections:function(){let e=this.taggerView.getElements(".colorize"),t=this;console.log("Selection count: "+this.get("selectionCount")),e.forEach(e=>{e.hasClassName("predicate")||(e.addClassName("picked-for-colorize"),e.id?t._selection.push(e.id):e.hasClassName("people-view")&&t._selection.push(e.getElement(".item-label").getText()),t.get("isInteractive")&&t.set("selectionCount",t.getSelectionCount()))})},removeSelections:function(e){let t=this;this.taggerView.getElements(".picked-for-colorize").forEach(i=>{i.removeClassName("picked-for-colorize");let a=i.hasClassName("people-view"),n=i.hasClassName("expandable");if(e)if(a){let e=i.getClosest("li.predicate").getAttribute("predicate");t.onPersonSelection(null,e,i,n)}else t.onTagSelection(i)})},addColorToPerson:function(e,t){e.addClassName("colorize"),e.getElement("img").setStyle("border","5px solid "+t),e.getElement("img").setAttributes({color:t})},executeColorize:function(){let e=this.taggerView.getObservedNavigator().getCache(),t=this.fullPredId||e.colorManager.activePredicate;this.taggerView.warnForColorize(e.colorManager.computedPartialColorMap[t]),e.colorManager.colorizePredicate(t),this.removeSelections()},cancelColorize:function(){let e=this.taggerView.getObservedNavigator().getCache();this._selectionToReset.forEach((t,i)=>{let a=t.parentElem,n=a.id;this.fullPredId=this.taggerView.getIdFromDOMId(n),t.isRemoved?(t.isPerson?(e.colorManager.getColorForTagValue(t.tv,!0,{onCancel:!0,color:t.color}),this.addColorToPerson(t.tagElem,t.color)):(e.colorManager.getNewColorForTagValue(t.tv,!0,{onCancel:!0,color:t.color}),a.getElement(".tag-color")&&t.tagElem.getElement(".tag-color").removeClassName("hide-color")),t.tagElem.addClassName("colorize")):(t.isPerson?(e.colorManager.resetColorForPersonTagValue(t.tv),t.tagElem.getElement("img").setStyle("border","none")):(a.getElement(".tag-color")&&a.getElement(".tag-color").addClassName("hide-color"),e.colorManager.resetColorForTagValue(t.tv)),t.tagElem.removeClassName("colorize"));let r=!!a.getElements(".colorize").length;a.toggleClassName("colorize",r)}),e.colorManager.inColorizePredicate(),this.removeSelections()}})}),define("DS/TagNavigator/TagNavigatorManager",["DS/TagNavigator/TagNavigatorManagerImpl","DS/TagNavigator/TagsServer"],function(e,t){"use strict";return function(i){var a;if(!(i instanceof e))throw new Error("Invalid input arg");a=i,this.isAlive=function(){return a.isAlive()},this.setAsCurrent=function(){return a.setAsCurrent(),this},this.focusOnCC=function(e){return a.focusOnCC(e),this},this.unfocusCC=function(){return a.unfocusCC(),this},this.getProxy=function(e){var i,n,r;if(!arguments.length)throw new Error("Invalid Input arguments");if(1===arguments.length&&"object"==typeof e&&null!==e)return e.widgetId&&"string"==typeof e.widgetId||(e.widgetId="IsNotInWidget"),e.cStorages||!e.tagsServicesURL&&!e.tagsServerUrl||(e.cStorages={},i=e.tagsServicesURLQueryParams?e.tagsServicesURLQueryParams.tenant:e.tagsServerUrlParams?e.tagsServerUrlParams.tenant:null,n=e.tagsServicesURL||e.tagsServerUrl,r=new t(n,i),e.cStorages._default=r,i&&(e.cStorages[i]=r)),e.filteringMode||(e.filteringMode="FilteringOnServer"),"boolean"!=typeof e.hasPlatformData&&(e.hasPlatformData=!0),a.getProxy(e);throw new Error("Invalid Input arguments")},this.removeProxiesOfCC=function(e){return a.removeProxiesOfCC(e),this},this.switchProxiesOnCC=function(e){return a.switchProxiesOnCC(e),this},this.removeAllProxies=function(){return a.removeAllProxies(),this},this.getProxyWithFilteringServices=function(e,t){return this.getProxy({proxyDisplayName:e,tagsServerUrl:t,filteringMode:"WithFilteringServices"})},this.getFilters=function(){return a.getFilters()},this.clearFilters=function(){return a.clearFilters(!0)},this.id=function(){return a.id()},this.die=function(){return a.die(),this}}}),define("DS/TagNavigator/simplified/actions/ActionsManager",["UWA/Core","UWA/Class","UWA/Class/Options","UWA/Class/Events","DS/TagNavigator/Predicate","DS/TagNavigator/Logger","DS/SNInfraUX/tracker/SearchTrackerApi","DS/TagNavigator/simplified/views/ActionsView","DS/TagNavigator/simplified/actions/ActionUtils","DS/TagNavigator/simplified/actions/Select","DS/TagNavigator/simplified/actions/Exclude","DS/TagNavigator/simplified/actions/Group","DS/TagNavigator/simplified/actions/SelectInApp","DS/TagNavigator/simplified/actions/EditTagsSelect","DS/TagNavigator/simplified/actions/Colorize","DS/MessageBus/MessageBus"],function(e,t,i,a,n,r,s,o,l,c,d,g,u,h,p,f){"use strict";return t.singleton(i,a,{init:function(e){s.set(),this.setOptions(e);var t,i,a=this.getOption("taggerView");this.initActionsView=function(){return t||((t=new o({taggerView:a}).render()).addEvent("onActionSelection",this.startAction.bind(this)),t.addEvent("onActionLaunched",this.launchAction.bind(this)),t.addEvent("onActionCancelled",this.cancelAction.bind(this)),t.addEvent("addOpacity",this.addOpacity.bind(this)),t.addEvent("removeOpacity",this.removeOpacity.bind(this)),t.addEvent("updateActionView",this.udpateShowActionViews.bind(this))),t},this.hideActionMenu=function(){t.hideActionMenu()},this.enablePrimaryButton=function(){t.enablePrimaryButton()},this.redraw=function(e){t&&(e.abortAction&&this.abortAction(),t.redraw())},this.getCurrentAction=function(){return i},this.addOpacity=function(){a.addOpacity()},this.removeOpacity=function(){a.removeOpacity()},this.udpateShowActionViews=function(){a.udpateShowActionViews()},this.startAction=function(e){if(i)throw new Error("INVALID: action already exists");switch(e.action){case l.ACTION_SELECT:i=new c({id:l.ACTION_SELECT,isInteractive:e.isInteractive,selection:[]});break;case l.ACTION_GROUP:this._startGrouping(e);break;case l.ACTION_EXCLUDE:this._startExclude(e);break;case l.ACTION_EDITTAGREL:i=new h({id:l.ACTION_EDITTAGREL,isInteractive:!0,selection:[],taggerView:function(){return a}}),a.toggleActiveTagsMode();break;case l.ACTION_SELECTINAPP:i=this._startSelectInApp(e);break;case l.ACTION_COLORIZE:this._startColorize(e)}return a.tagContainer.removeClassName("add-opacity"),a.scrollerContainerDiv.addClassName("set-height"),t.updateModel(i),i&&i.id==l.ACTION_EDITTAGREL&&(e.stdView||(a.callUpdateModelOnActiveActions(i),a.scrollerContainerDiv.removeClassName("set-height")),a.disableType("start")),f.publish({channel:"SearchTrackerApi",topic:"hit",data:{category:"6WTagger",action:"startAction",persDim:{pd1:e.action}}}),i},this.launchAction=function(e){switch(i.id){case l.ACTION_SELECT:this._executeSelect(e);break;case l.ACTION_GROUP:this._executeGrouping(e);break;case l.ACTION_EXCLUDE:this._executeExclude(e);break;case l.ACTION_EDITTAGREL:this._executeEditTagsSelect();break;case l.ACTION_SELECTINAPP:this._executeSelectInApp(e);break;case l.ACTION_COLORIZE:this.executeColorize()}a.removeOpacity(),a.scrollerContainerDiv.removeClassName("set-height"),f.publish({channel:"SearchTrackerApi",topic:"hit",data:{category:"6WTagger",action:"launchAction",persDim:{pd1:this.getCurrentAction().id}}}),i&&i.id==l.ACTION_EDITTAGREL&&(e.stdView||(a.callUpdateModelOnActiveActions(i),t.showActionMenu()),a.disableType("launch")),i=void 0,t.resetBox(),t.updateModel(i)},this.cancelAction=function(){i.id==l.ACTION_COLORIZE&&i.cancelColorize(),a.actionCancel(),i=void 0,t.resetBox(),t.updateModel(i),a.removeOpacity(),i&&i.id==l.ACTION_EDITTAGREL&&a.disableType("cancel")},this.abortAction=function(){i&&(i.get("isInteractive")&&t.abortAction(),i.id==l.ACTION_COLORIZE&&i.cancelColorize(),a.removeOpacity(),i=void 0,t.resetBox(),t.updateModel(i))},this._startSelectInApp=function(e){return new u({id:l.ACTION_SELECTINAPP,isInteractive:e.isInteractive,selection:[]})},this._startGrouping=function(e){var t=a.getObservedNavigator(),s=t.getFocusedProxy();let o=[];if(o=s?s.getActiveGroupings():t.getActiveGroupings(),i=new g({id:l.ACTION_GROUP,isInteractive:e.isInteractive,selection:o,taggerView:function(){return a},current:e.current}),e.isInteractive)a.container.getElements("li.predicate").forEach(function(e){var i=e.getAttribute("predicate");"date"==n.getPredicate(i).getType()?e.addClassName("group-disabled"):0==t.hasGroupingSupport(i)&&e.addClassName("group-disabled")});else if(e.grouping){var c=n.getPredicate(e.grouping.predicate);i.removeAddedObject(c,e.grouping.isPredicate?void 0:e.grouping.text);var d=a.container.getElement("li.predicate[predicate='"+c.id()+"']");if(d||"type_categorization"==c.id()&&(d=a.container.getElement("li.predicate[predicate='ds6w:type']")),d)if(e.grouping.isPredicate){var u=d.getElement(".predicate-header");u.removeClassName("grouped-by"),u.getElement(".action-icon").remove()}else{var h=d.getElement(".predicate-content .tag[title='"+e.grouping.text+"']");if(h)h.removeClassName("grouped-by");else{var p=d.getElements(".predicate-content .people-view-container .people-view.grouped-by");p?p.forEach(function(t,i){t.getElement(".people-filter").getAttribute("title")==e.grouping.text&&(t.removeClassName("picked"),t.removeClassName("grouped-by"),t.getElement(".people-template").removeClassName("people-selected"))}):r.log("FAILED to locate the tag element in the DOM")}}else r.log("FAILED to locate the predicate element in the DOM");this.launchAction({isInteractive:!1})}else if(e.embedded&&!e.refreshMode)e.remove&&i.removePredicate(e.remove),e.add&&i.addPredicate(e.add),this.launchAction({isInteractive:!1});else if(e.refreshMode){i.isRefreshNeeded({isEmbedded:e.embedded})?this.launchAction({isInteractive:!1,forcedUpdate:!0}):this.abortAction()}},this._executeGrouping=function(e){var t=i.get("selection");r.log("The selected predicates and tags for GROUPING are:"+JSON.stringify(t)),a.setSpinner(),a.getObservedNavigator().setGroupedByStatus(t,!0,e&&e.forcedUpdate),this._endGrouping(e)},this._endGrouping=function(e){e.isInteractive&&a.container.getElements("li.predicate").forEach(function(e){e.removeClassName("group-disabled")})},this._endSelectInApp=function(e){i.removeTagHighlight()},this._startExclude=function(e){(i=new d({id:l.ACTION_EXCLUDE,isInteractive:e.isInteractive,selection:[]}),e.isInteractive)&&a.container.getElements("li.predicate").forEach(function(e){var t=e.getAttribute("predicate");"date"==n.getPredicate(t).getType()&&e.addClassName("exclude-disabled")})},this._executeExclude=function(e){var t=i.get("selection");r.log("The selected predicates and tags for EXCLUDE are:"+JSON.stringify(t)),a.setSpinner();var n=a.getObservedNavigator();n.getFocusedProxy()||n.dispatchEvent("onBeforeGlobalFilterChange");for(var s=0;s<t.length;s++){var o=t[s];UWA.is(o,"object")?o.isComplex?n.toggleComplexTagSelection(o,!1,!0):n.toggleTagSelection(o,!1,!0):a.toggleTagSelection(o,!1,!0)}a.getObservedNavigator().onRefine(),this._endExclude(e)},this._endExclude=function(e){e.isInteractive&&a.container.getElements("li.predicate").forEach(function(e){var t=e.getAttribute("predicate");"ds6w:when"==n.getPredicate(t).get6WRootFather().id()&&e.removeClassName("exclude-disabled")})},this._executeSelect=function(e){a._onRefineLaunch(i.get("selection"))},this._executeEditTagsSelect=function(){a._onEditTagsRefine()},this._startColorize=function(e){i=new p({id:l.ACTION_COLORIZE,isInteractive:e.isInteractive,selection:[],taggerView:function(){return a}}),t.updateModel(i);let r=a.getObservedNavigator().getCache();a.ensureColorCusto(r).then(function(){i.addSelections(),a.container.getElements("li.predicate").forEach((e,t)=>{let i=e.getAttribute("predicate");"date"==n.getPredicate(i).getType()&&e.getElement(".tn-calendar-div")&&!e.getElement(".tn-calendar-div").isHidden()&&e.addClassName("add-opacity"),e.getElement(".tool-icon.fonticon-palette")&&e.getElement(".tool-icon.fonticon-palette").addClassName("hide");let r=a.taggerUWAElement.getElement(".predicate.colorize");if(r){i!==r.getAttribute("predicate")&&(e.getElement(".predicate-content .innerForTransition").addClassName("add-opacity"),e.getElement(".toolbox")&&e.getElement(".toolbox").addClassName("add-opacity"))}}),a.taggerUWAElement.getElement(".predicate.colorize .action-icon.fonticon-palette")&&(a.taggerUWAElement.getElement(".predicate.colorize .action-icon.fonticon-palette").addClassName("hide"),a.taggerUWAElement.getElement(".predicate.colorize .clear-selection").removeClassName("hide"))})},this.executeColorize=function(){i.executeColorize(),a.container.getElements("li.predicate").forEach(function(e){e.getElement(".tool-icon.fonticon-palette")&&e.getElement(".tool-icon.fonticon-palette").removeClassName("hide");var t=e.getAttribute("predicate");"ds6w:when"==n.getPredicate(t).get6WRootFather().id()&&e.removeClassName("add-opacity")}),a.taggerUWAElement.getElement(".predicate.colorize")&&(a.taggerUWAElement.getElement(".predicate.colorize .action-icon.fonticon-palette")&&a.taggerUWAElement.getElement(".predicate.colorize .action-icon.fonticon-palette").removeClassName("hide"),a.taggerUWAElement.getElement(".predicate.colorize .clear-selection").addClassName("hide"))},this._executeSelectInApp=function(e){var t=i.get("selection");r.log("The selected predicates and tags for SELCT_IN_APP are:"+JSON.stringify(t)),a.setSpinner();let n={};t.forEach(function(e){let t={};t=e.predicate?e:JSON.parse(a.getIdFromDOMId(e)),n[t.predicate]||(n[t.predicate]=[]),t.isComposite&&Array.isArray(t.object)?t.object.forEach(e=>{n[t.predicate].push({disptext:t.dispValue,object:e,type:t.type,field:["implicit"]})}):n[t.predicate].push({disptext:t.dispValue,object:t.object,type:t.type,field:["implicit"]})}),a.getObservedNavigator().setSelectInAppStatus(n),this._endSelectInApp(e)},this._executeEditTagsSelect=function(){a._onEditTagsRefine()}}})}),define("DS/TagNavigator/embeddedTagger/EmbeddedTaggerView",["UWA/Core","UWA/Class/View","UWA/Class/Promise","DS/TagNavigator/TagValue","DS/TagNavigator/Predicate","DS/TagNavigator/Logger","DS/TagNavigator/TaggerSettings","DS/TagNavigator/embeddedTagger/EmbeddedRootWhereView","DS/TagNavigator/embeddedTagger/EmbeddedRootWhatView","DS/TagNavigator/embeddedTagger/EmbeddedRootWhenView","DS/TagNavigator/embeddedTagger/EmbeddedRootWhoView","DS/TagNavigator/embeddedTagger/EmbeddedRootWhyView","DS/TagNavigator/embeddedTagger/EmbeddedRootHowView","DS/TagNavigator/embeddedTagger/EmbeddedAllWView","DS/TagNavigator/TagNavigatorManagerImpl","DS/TagNavigator/simplified/actions/ActionsManager","DS/TagNavigator/simplified/actions/ActionUtils","DS/TagNavigator/embeddedTagger/EmbeddedTaggerActiveCriteria"],function(e,t,i,a,n,r,s,o,l,c,d,g,u,h,p,f,m,v){"use strict";return t.extend({tagName:"div",className:"embedded-tagger-view",init:function(e){e=e||{},this.rootwArray=e.rootw,this.rootViews=[],this._BroadcastchannelSearchManager=null,this._parent(e)},setup:function(e){r.log("setting up embedded view"),this._parent(e),this.proxy=e.proxy,this.observedNavImpl=this.proxy.getNavImpl();var t={REDRAW_TAGS:"REDRAW_TAGS",GROUPING_REMOVED:"GROUPING_REMOVED",STATUS_UPDATE:"STATUS_UPDATE",ON_TAGGERVIEW_MASKED:"ON_TAGGERVIEW_MASKED"},i={};for(var a in i[t.REDRAW_TAGS]=function(e){if(!this.proxy.isDying()){this._redrawTags(!0,e)}},i[t.GROUPING_REMOVED]=function(){this._onGroupingRemoved()},i[t.STATUS_UPDATE]=function(){this.removeOpacity(),this._redrawTags()},i[t.ON_TAGGERVIEW_MASKED]=function(){this.addOpacity()},t)this.observedNavImpl.addEvent(a,i[a],this);this.proxy.addEvent("embedded_properties_change",this.updateSubLabel,this),this._initBroadcastChannel(e)},render:function(){for(var t in r.log("rendering embedded view"),this.tabBarContainer=e.createElement("div",{class:"tab-bar-container"}).inject(this.container),document.addEventListener("click",this.onClickInsideTabViewContainer.bind(this)),this.rootwArray){var i=void 0;switch(t){case"ds6w:where":i=new o({rootw:"ds6w:where",defaultValues:this.rootwArray[t],proxy:this.proxy,icon:"fonticon-3ds-where"}).render().inject(this.tabBarContainer);break;case"ds6w:what":i=new l({rootw:"ds6w:what",defaultValues:this.rootwArray[t],proxy:this.proxy}).render().inject(this.tabBarContainer);break;case"ds6w:when":i=new c({rootw:"ds6w:when",defaultValues:this.rootwArray[t],proxy:this.proxy}).render().inject(this.tabBarContainer);break;case"ds6w:who":i=new d({rootw:"ds6w:who",defaultValues:this.rootwArray[t],proxy:this.proxy}).render().inject(this.tabBarContainer);break;case"ds6w:why":i=new g({rootw:"ds6w:why",defaultValues:this.rootwArray[t],proxy:this.proxy}).render().inject(this.tabBarContainer);break;case"ds6w:how":i=new u({rootw:"ds6w:how",defaultValues:this.rootwArray[t],proxy:this.proxy}).render().inject(this.tabBarContainer);break;case"allw":i=new h({rootw:"allw",defaultValues:this.rootwArray[t],proxy:this.proxy}).render().inject(this.tabBarContainer)}i.addEvent("notifyAllViews",this.closeDropDown.bind(this)),i.addEvent("toggleGrouping",this.onToggleGrouping.bind(this)),i.addEvent("deactiveEmbeddedView",this.addOpacity.bind(this)),i.addEvent("updateGroupings",this.updateGroupings.bind(this)),this.rootViews.push(i)}var a,n=this;return this.container.addEvent("resize",function(){clearTimeout(a),a=setTimeout(n.addScroll.bind(n),1e3)}),this.embeddedActiveCriteria=new v({proxy:this.proxy}).render().inject(this.container),this},addScroll:function(){this.tabBarContainer.getDimensions().width<=1223&&0!==this.tabBarContainer.getDimensions().width?(this.tabBarContainer.getDimensions().width<="639"?this.tabBarContainer.addClassName("mobile-view"):this.tabBarContainer.removeClassName("mobile-view"),this.tabBarContainer.addClassName("with-scroll")):this.tabBarContainer.removeClassName("with-scroll"),this._postMessage("addScroll")},_onGroupingRemoved:function(e){this.rootViews.forEach(e=>{e.isGroupedBy()&&e.deactivateGroupingUX()}),this.removeOpacity(),this._postMessage("_onGroupingRemoved")},_redrawTags:function(t,o){r.log("inside embedded view redraw"),this.observedNavImpl.getFocusedProxy()===this.proxy?i.all(n.getElementsNLS().concat(a.getPredicateValue())).then(function(){r.log("redrawing the W views after nls computation"),this.rootViews.forEach(e=>{e.setUpdateGroupingsWhenReadyFlag(!1),e.redrawTags(t),e.updateGroupingUX()}),this.observedNavImpl.hasProxiesInEdition()?this.addOpacity():(this.removeOpacity(),o&&"setTags"==o.event&&this.proxy.getActiveGroupings().length>0&&s.getOption("updateEmbeddedGroupings")&&this.updateGroupings());var i={widgetId:this.observedNavImpl.getWidgetMaximized(),proxyId:this.proxy?this.proxy._id:void 0,isEmbedded:!0};this.embeddedActiveCriteria.redraw(i),(!e.is(o)||e.is(o)&&e.is(o.event)&&("setTags"===o.event||"clearLocalGrouping"===o.event||"unfocus"===o.event||"focusOnSubjects"===o.event))&&this._postMessage("_redrawTags")}.bind(this)):r.log("embedded view proxy is not same as focused proxy, redraw ignored")},closeDropDown:function(e){this.notToCallOnClickOutside=e.noClickOutside,this.rootViews.forEach((t,i)=>{t.rootw!=e.id&&t.dropdownCont.hasClassName("show")&&t.destroyDropDowmMenu()})},updateSubLabel:function(e){var t=e.rootw;for(var i in t)this.rootViews.forEach((e,a)=>{e.rootw==i&&t[i].subLabel&&e.updateSubLabelCall(t[i])})},onToggleGrouping:function(e){var t,i;if(this.addOpacity(),"allw"==e.id)this.clearAllGroupings();else{this.rootViews.forEach(a=>{a.isGroupedBy(e.predicate)?(i=a,a.deactivateGroupingUX()):a.rootw==e.id&&(t=a,a.activateGroupingUX())});var a={action:m.ACTION_GROUP,isInteractive:!1,embedded:!0};t&&(a.add=t.getGroupingData()),i&&!t&&(a.remove=i.getGroupingData()),f.startAction(a)}this._postMessage("onToggleGrouping")},clearAllGroupings:function(){var e;this.rootViews.forEach(t=>{var i={action:m.ACTION_GROUP,isInteractive:!1,embedded:!0};t.isGroupedBy()&&(e=t,t.deactivateGroupingUX(),i.remove=e.getGroupingData(),f.startAction(i))}),this._postMessage("clearAllGroupings")},updateGroupings:function(){var e,t=this.rootViews.findIndex(e=>e.isGroupedBy());if(-1!==t)if((e=this.rootViews[t])&&e.isReadyToUpdateGroupings()){e.setUpdateGroupingsWhenReadyFlag(!1);var i={action:m.ACTION_GROUP,isInteractive:!1,embedded:!0,refreshMode:!0,current:e.getGroupingData()};f.startAction(i)}else r.log("view is not yet ready for grouping update, wait..."),e.setUpdateGroupingsWhenReadyFlag(!0);this._postMessage("updateGroupings")},requestGroupingChange:function(e){var t=this.rootViews.findIndex(t=>t.getOption("rootw")===e.rootW);if(-1!==t){var i=this.rootViews[t],a={predicate:e.predicate};i.onGroupingChange(void 0,a)}},onClickInsideTabViewContainer:function(e){this.notToCallOnClickOutside=!1},addOpacity:function(){this.container.addClassName("stop-action")},removeOpacity:function(){this.container.removeClassName("stop-action")},destroy:function(){this.stopListening(),this.rootViews.forEach(function(e){e.destroy()}),this._BroadcastchannelSearchManager&&this._BroadcastchannelSearchManager.destroy(),this._BroadcastchannelSearchManager&&delete this._BroadcastchannelSearchManager,this._BroadcastchannelSearchManager=null,this.observedNavImpl.removeEvent(p.events.GROUPING_REMOVED),this.observedNavImpl.removeEvent(p.events.REDRAW_TAGS),this.observedNavImpl.removeEvent(p.events.STATUS_UPDATE),this.container.removeEvent("resize"),this._parent()},show:function(){this._parent();this._postMessage("show",{type:"showEmbeddedTaggerView"})},hide:function(){this._parent();this._postMessage("hide",{type:"hideEmbeddedTaggerView"})},_initBroadcastChannel:function(t){let i=this;e.is(t)&&e.is(t.is6WInWebInWinActive)&&!0===t.is6WInWebInWinActive&&(e.is(this._BroadcastchannelSearchManager)&&this._BroadcastchannelSearchManager.destroy(),e.is(this._BroadcastchannelSearchManager)&&delete this._BroadcastchannelSearchManager,this._BroadcastchannelSearchManager=null,require(["DS/TagNavigator/BroadcastchannelSearchManager"],function(e){r.log("init BroadcastChannel");let t={EmbeddedTaggerView:i};i._BroadcastchannelSearchManager=new e,i._BroadcastchannelSearchManager.setup(t),i._BroadcastchannelSearchManager.listenBroadcast()}))},_postMessage:function(t,i){e.is(this._BroadcastchannelSearchManager)&&this._BroadcastchannelSearchManager.postMessage(t,i)}})}),define("DS/TagNavigator/TaggerView",["UWA/Core","UWA/Class/View","UWA/Class/Promise","UWA/Storage","DS/TagNavigator/TagNavigatorManagerImpl","DS/TagNavigator/AbstractPredicateView","DS/TagNavigator/TagValue","DS/TagNavigator/Predicate","DS/TagNavigator/PredicateView","DS/TagNavigator/RootPredicateView","DS/TagNavigator/TagValueView","DS/TagNavigator/TaggerNLS","DS/TagNavigator/Parameter","DS/TagNavigator/ParameterView","DS/TagNavigator/UserSettings","DS/UIKIT/Alert","DS/UIKIT/Mask","DS/TagNavigator/NotificationManager","DS/UIKIT/Form","DS/UIKIT/Input/Button","DS/UIKIT/Input/Toggle","DS/UIKIT/Input/ButtonGroup","DS/UIKIT/Input/Text","DS/UIKIT/DropdownMenu","DS/UIKIT/IconDropdown","DS/UIKIT/Autocomplete","DS/UIKIT/Tooltip","UWA/Controls/TabView","DS/TagNavigator/Logger","DS/TagNavigator/LoggerUX","DS/TagNavigator/Suggestions","DS/UIKIT/Scroller","DS/TagNavigator/TaggerProxyWithFilteringServices","DS/TagNavigator/TaggerSettings","DS/TagNavigator/ActiveCriteria","DS/TagNavigator/simplified/actions/ActionUtils","DS/TagNavigator/simplified/utils/ColorUtils","DS/TagNavigator/TaggerTrackerApi","DS/MessageBus/MessageBus","DS/TagNavigator/simplified/views/ContextMenu","DS/TagNavigator/simplified/views/LoadOnDemandView"],function(e,t,i,a,n,r,s,o,l,c,d,g,u,h,p,f,m,v,T,C,w,b,y,S,E,I,x,_,A,N,V,P,D,O,U,F,j,W,M,R,L){"use strict";var k=600,B=600,G={"ds6w:who":"Who","ds6w:when":"When","ds6w:what":"What","ds6w:where":"Where","ds6w:why":"Why","ds6w:how":"How"};return t.extend({_customEnumFiltering:void 0,_simplifiedTagger:void 0,_simplifiedSelectedRootWs:[],actionManager:void 0,_viewInitializationPromise:void 0,_enabledAllwMode:void 0,_viewMoreStatus:!1,init:function(e,t,i,a,n,r,s){for(var l in W.set(),this._customEnumFiltering=O.getOption("customFilteringAdvSearch"),G)new o({sixw:[l],type:"string"});this._ignoreRedraw=O.getOption("ignoreRedraw"),this._parent({tnManagerImpl:e,domId:t,tn:i,userSettings:a,setLocalFilterIcon:n,taggerIconId:r,visibility:!0===s})},setup:function(t){var r;if(!(t.tnManagerImpl instanceof n))throw new Error("Invalid input arg");if("string"==typeof t.domId&&(this.taggerUWAElement=document.getElementById(t.domId)),!this.taggerUWAElement)throw new Error("Unexisting target DOM element");this.taggerUWAElement=e.extendElement(this.taggerUWAElement),this.taggerIcon=e.extendElement(document.getElementById(t.taggerIconId)),this.taggerIcon&&this.taggerIcon.addEvent("click",this.mainTaggerIconClicked.bind(this)),this.storage=new a({adapter:"Dom",database:"TagNavigator"}),this.isW=!(!this.storage||"true"!==this.storage.get("isW")),this.container=this.taggerUWAElement,this.tagnavigator=t.tn,this.taggerScroller=null,this.criteriaScroller=null,this.allContentView=null,this.loadMoreTagsView=null,this.timer=null,this.callServerInProgress=!1,this.timerOnSearch=null,this.internalRedrawTimer=null,this.DOMIdToId={},this.selectedTags=[],this.fx=function(t,i,a){var n=this;return new e.Fx(t,{duration:300,transition:"quadInOut",events:{onComplete:function(){i?"createTag"==a?t.setStyles({position:"relative",overflow:"visible",height:"auto"}):t.setStyles({position:"relative",overflow:"hidden",height:"auto"}):t.setStyles({position:"absolute",height:"0px"}),n.updateScroller()},onStart:function(){t.setStyle("position","relative"),t.setStyle("overflow","hidden")}}})},this.setLocalFilterIcon=t.setLocalFilterIcon,this.visibility=t.visibility,this.myNotificationControl=new f({closable:!0,visible:!0,maximumVisibleMessages:2,autoHide:!1,messageClassName:"error"}),this.selectedTenant=null,this.selectedPredicate="ds6w:what";var s={};this.observedNavImpl=t.tnManagerImpl;var o=this;for(r in s[n.events.FILTER_CHANGE]=function(e){this.tagnavigator.hasEvent("onFilterChange")&&this.tagnavigator.dispatchEvent("onFilterChange",e),this.setActiveCriteria(!0,!0)},s[n.events.CHANGE_OF_CURRENT_TN]=function(e){var t,i=new n(e);if(!this.observedNavImpl)throw new Error("Unexpected change of current TN while the TaggerView is not already observing a Tagger?!");if(this.observedNavImpl===i)return!1;if(this._viewInitializationPromise.then(function(){this._simplifiedTagger&&this.observedNavImpl.getCache().set6WSort("sort-weight")}.bind(this)),"3DDashboard"===n._brand){var a=function(){p.getUserId().then(function(e){e&&o.observedNavImpl.setUserId(e),o.observedNavImpl.updatePinnedTag(void 0,o._simplifiedTagger)})};this._viewInitializationPromise.then(function(){a()},function(){a()})}var r=this.storage.get("activeSimplifiedW");for(t in r&&i.getCache().setActiveW(r),n.events)this.observedNavImpl.removeEvent(t,s[t]);for(t in A.log("The view now ignores the TagNavigator '"+this.observedNavImpl.id()+"'"),this.observedNavImpl=i,n.events)this.observedNavImpl.addEvent(t,s[t],this);return A.log("The view now observes the TagNavigator '"+e+"'"),N.updateContext(e),this.tagnavigator.hasEvent("onFilterChange")&&this.tagnavigator.dispatchEvent("onFilterChange",this.observedNavImpl.getFilters()),this.actionManager&&this.actionManager.abortAction(),this.redraw(),this},s[n.events.REDRAW_TAGS]=function(e){this.redrawTriggeredBy=e?e.event:void 0,!this.tabView||"criteria"===this.tabView.selectedTab.getName()&&"focusOnSubjects"===this.redrawTriggeredBy||this.redraw()},s[n.events.REDRAW_CRITERIA]=function(){this.internalRedrawTimer=setTimeout(this.redrawCriteria.bind(this),50)},s.SEARCH_LAUNCH=function(){this.visibility&&this.redrawActiveCriteria(!1)},s[n.events.UPDATE_ICON]=function(){var e;if(this.setLocalFilterIcon)for(var t in n.allProxiesMap)e=n.allProxiesMap[t].widgetId(),this.observedNavImpl.getProxyToFocusFromWidgetId(e)&&t===this.observedNavImpl.getProxyToFocusFromWidgetId(e).id()&&this.setLocalFilterIcon(e,n.allProxiesMap[t].hasLocalFilters());this.redrawTopBarTagIcon()},s[n.events.UNFOCUS]=function(e){return e?this.displayTags(!1):this.displayTags(),this.redraw()},s[n.events.OPEN_TAGGER]=function(){return this.openTagger()},s[n.events.CLOSE_TAGGER]=function(){return this.closeTagger()},s[n.events.CRITERIA_CLICK]=function(e){this.observedNavImpl.getFocusedProxy()||this.observedNavImpl.dispatchEvent("onBeforeGlobalFilterChange"),this.toggleTagSelection(e.replace("atv",""))},s[n.events.CRITERIA_CLICK2]=function(e,t){e?this.deleteFreeInput(e):this.onToggleParamTagSelection(t)},s[n.events.TRASH_CLICK]=function(e){this.clearActiveTags(e)},s[n.events.CRITERIA_PIN]=function(e){e=e.replace("atv","");var t=this.getIdFromDOMId(e);this.observedNavImpl.saveTagPinToLocal(t,e)},s[n.events.CRITERIA_UNPIN]=function(e){e=e.replace("atv","");var t=this.getIdFromDOMId(e);this.observedNavImpl.clearTagPinInLocal(t,e,this._simplifiedTagger)},s[n.events.CRITERIA_EXCLUDE]=function(e){e=e.replace("atv","");var t=this.getIdFromDOMId(e);this.observedNavImpl.excludeTag(t)},s[n.events.CRITERIA_UNEXCLUDE]=function(e){e=e.replace("atv","");var t=this.getIdFromDOMId(e);this.observedNavImpl.undoExcludeTag(t)},s[n.events.UPDATE_ACTIVECRITERIA]=function(e){this.setActiveCriteria(!0,!0),!1!==e&&this.redraw()},s[n.events.STATUS_UPDATE]=function(e){(e&&"grouping"===e.action||"selection"===e.action)&&this.setActiveCriteria(!0,!0,void 0,!0).then(function(){o.redrawActiveCriteria(!0),m.isMasked(o.taggerRoot)&&m.unmask(o.taggerRoot)})},s[n.events.GROUPING_REMOVED]=function(e){A.log("GROUPING_REMOVED event received for "+e.text+", predicate="+e.predicate),this.actionManager.startAction({action:F.ACTION_GROUP,isInteractive:!1,grouping:e})},s[n.events.REQUEST_GROUPING_CHANGE]=function(e){A.log("REQUEST_GROUPING_CHANGE event received for "+e.predicate);var t=[];this.tabView&&"tags"===this.tabView.selectedTab.getName()&&t.push(this.redrawTags()),this.hasEmbeddedView()&&t.push(this.observedNavImpl.getFocusedProxy().redrawEmbeddedView()),i.all(t).then(function(){this.observedNavImpl.getFocusedProxy().requestEmbeddedViewGroupingChange(e.data)}.bind(this))},this.observedNavImpl=t.tnManagerImpl,n.events)this.observedNavImpl.addEvent(r,s[r],this);this.observedNavImpl.setAsCurrent(),this.taggerRoot=e.createElement("div",{id:"tagnavigator",class:this.isW?"isw":"no-w","data-rec-id":"tagnavigator"}),this.taggerUWAElement.addContent(this.taggerRoot),v.addEvent("notify",function(e){this.taggerRoot&&(this.myNotificationControl=new f({closable:!0,visible:!0,maximumVisibleMessages:2,autoHide:!0,hideDelay:8e3,messageClassName:e.data.className||"error"}),this.myNotificationControl.add(e.message),this._simplifiedTagger&&this.myNotificationControl.inject(this.taggerContentContainer,"before"))}.bind(this)),this._viewInitializationPromise=new i(function(e){p.retrieveTaggerPreferences().then(function(){p.getUserId().then(function(t){A.log("User Id:"+t),o._simplifiedTagger=p.getPreference("simplified"),o._simplifiedTagger?(o.observedNavImpl&&o.observedNavImpl.getCache().set6WSort("sort-weight"),A.log("Initializing Simplified TaggerView"),U.setAsSimplified(),o.initSimplifiedTaggerView(e)):(A.log("Initializing Legacy TaggerView"),o.initLegacyTaggerView(),e())})})})},initLegacyTaggerView:function(){this.storage.set("simplifiedTagger",!1),this.tagnavigator.hasEvent("onClose")&&this.taggerRoot.setHTML("<span class='tagger-close fonticon fonticon-cancel' data-rec-id='tagger-close'></span>"),this.taggerActiveCriteria=e.createElement("div",{id:"active-tags",class:"active-tags section "+(this.observedNavImpl.getCache().isSectionCollapsed("activeFilters")?"":"expanded-section"),"data-rec-id":"active-tags",styles:{display:!1!==((this.observedNavImpl.hasActiveTags()||this.observedNavImpl.hasLocalActiveTags())&&!this.observedNavImpl.hasProxiesInEdition())?"block":"none"}}),this.taggerHeader=e.createElement("div",{id:"header-container",class:"allw"}),this.taggerRoot.addContent([this.taggerActiveCriteria,this.taggerHeader]),this.tagsContainer=e.createElement("div",{style:{height:k},id:"all-tags-container","data-rec-id":"all-tags-container",tabindex:0}),this.tagsContainer.grab(e.createElement("div",{id:"all-tags"}).grab(e.createElement("div",{id:"tags-var-height"}))),this.criteriaContainer=e.createElement("div",{style:{height:B},id:"all-criteria-container"}),this.globalSearchInput=e.createElement("div",{id:"filter-all",class:"add-tag-cont search-cont",styles:{overflow:"hidden",height:"0px"},html:"<span class='add-tag-close'><span class='fonticon fonticon-cancel-circled'></span></span><input id='taginput' class='tagger-input searchbox' title='"+g.getText("searchTag")+"' placeholder='"+g.getText("searchTag")+"'/>"}),this.criteriaContainer.setContent("<div id='all-criteria'></div>"),this.searchButton=new C({value:g.getText("search"),className:"primary search-button"}),this.searchButton.disable(),k=600,B=600;var t=this;this.createHeaderElemNoW(),this.taggerHeader.innerHTML=this.tnHeaderToHtml(),this.menu6wContainer.inject(this.taggerHeader.getElement(".tn-header-title")),this.menu6wIcon.inject(this.taggerHeader.getElement(".tn-header-title span.badgeContainer")),this.menu6wBadge.inject(this.taggerHeader.getElement(".tn-header-title span.badgeContainer"));var i=this.taggerHeader.getElement(".sort-6w");this.menuSort6WIcon.inject(i,"bottom"),new x({position:"bottom",target:i,body:g.getText("sort6w"),className:"sort6w-tooltip"});var a=this.taggerHeader.getElement(".tagger-filter");new x({position:"bottom",target:a,body:g.getText("searchTag"),className:"tagger-filter-tooltip"}),this.taggerHeader.getElement(".activate-simplified")&&new x({position:"bottom",target:this.taggerHeader.getElement(".activate-simplified"),body:g.getText("activate-simplified"),className:"tagger-filter-tooltip"}),new x({position:"bottom",target:this.taggerRoot.getElement(".tagger-close"),body:g.getText("closeTagger"),className:"tagger-close-tooltip"}),O.getOption("simplifiedTagger")&&!O.getOption("WebInWin")&&(i.setStyle("right","92px"),a.setStyle("right","57px")),this.tabView=new _({tabs:[new _.Tab({id:"tags-tab",name:"tags",text:"6WTags"}),new _.Tab({id:"criteria-tab",name:"criteria",text:g.getText("suggestedTags")})],events:{onSelectTab:function(e,i,a){t.tabView&&(t.taggerHeader.getElement(".tagnavheader").toggleClassName("criteria","criteria"===e.options.name),"criteria"===e.getName()?t.displayCriteria():"tags"===e.getName()&&t.displayTags(),t.observedNavImpl&&t.observedNavImpl.getCache()&&(t.observedNavImpl.getCache().selectedTab=e.getName()),t.redraw())}}}).inject(this.taggerRoot),this.observedNavImpl.activeCriteriaProxy&&this.observedNavImpl.activeSearchProxy||this.observedNavImpl.createActiveCriteria(),this.tabView.getTab("tags").setContent(this.tagsContainer),this.tabView.getTab("criteria").setContent(this.criteriaContainer),this.globalSearchInput.inject(this.tabView.elements.contentNode.getElement("#tags-tab"),"top"),this.taggerScroller||(this.taggerScroller=new P({element:this.tagsContainer.getElement("#all-tags")}).inject(this.tagsContainer)),this.criteriaScroller||(this.criteriaScroller=new P({element:this.criteriaContainer}).inject(this.taggerRoot.getElement("#criteria-tab"))),window.addEventListener&&window.addEventListener("resize",this.updateScroller.bind(this)),this.tagsContainer.grab(e.createElement("div",{id:"tagger-footer"})),this.criteriaContainer.grab(e.createElement("div",{id:"criteria-footer"})),this.criteriaContainer.getElement("#criteria-footer").innerHTML+="<hr/><div id='criteria-toggle-container'></div><div id='search-button-container'></div>",this.redraw()},initSimplifiedTaggerView:function(t){this.storage.set("simplifiedTagger",!0);var i=this;require(["DS/TagNavigator/simplified/views/TaggerTopBar","DS/TagNavigator/CacheManager","DS/TagNavigator/simplified/views/PreferredContentView","DS/TagNavigator/simplified/views/AllContentView","DS/TagNavigator/simplified/views/ShowResultsView","DS/TagNavigator/simplified/utils/PersonUtils","DS/TagNavigator/simplified/utils/CriteriaUtils","DS/TagNavigator/simplified/utils/LocationUtils","DS/TagNavigator/simplified/actions/ActionsManager","DS/TagNavigator/simplified/views/UserTagsSimplifiedView"],function(a,n,r,s,l,c,d,u,h,p){window.ds&&"3DSwym"==window.ds.env&&O.setOption("searchOnUserType",!1),this.contextMenu=new R,this.PersonUtils=c.init();try{d.init(),u.init()}catch(e){console.log("Utils already initialized")}o.ensureDefaultPredicates(),this.getRootWs().forEach(function(e){o.getPredicate(e).setDisplayName(g.getText("user-tags"))}),this.cacheForSimplified=new n({storage:this.storage}),this.taggerRoot.removeClassName("isw"),this.taggerRoot.addClassName("simplified");var f=this.getActiveRootW().length>1?"":this.getActiveRootW()[0].replace("ds6w:","");this._topBar=new a({taggerView:this}).render().inject(this.taggerRoot),this._topBar.addEvent("onTopBarSearch",this.onTopBarSearch.bind(this)),this._topBar.addEvent("allWView",this.onAllWViewActivation.bind(this)),this._topBar.addEvent("keyup_searchField",this.onRefineLaunch.bind(this)),this._topBar.addEvent("onRootWSelection",this.onRootWSelection.bind(this)),this._topBar.setPlaceHolderText(f),this.taggerActiveCriteria=e.createElement("div",{id:"active-tags-cont",class:"simplifiedActiveCriteria"}),this.simpleActiveCriteria=e.createElement("div",{id:"active-tags",class:"simplifiedActiveCriteria","data-rec-id":"active-tags"}).inject(this.taggerActiveCriteria),this.advancedActiveCriteria=e.createElement("div",{id:"advanced-active-tags"}).inject(this.taggerActiveCriteria).hide();var m=this.sectionHeaderToHtml("createTags");this.editArea=e.createElement("div",{id:"edit-area-container",class:"allw",html:'<div id="edit-tags" data-rec-id="edit-tags"><div class="edit-section simplified-section '+(this.observedNavImpl.getCache().isSectionCollapsed("createTag")?'">':' expanded-section">')+m+"</div></div>"}),this.userTagsView=new p({taggerView:this}).render().inject(this.editArea.getElement(".edit-section")),this.scrollerContainerDiv=e.createElement("div",{class:"simplified scroll-div"}).inject(this.taggerRoot),this.scrollerContainerDiv.addContent([this.taggerActiveCriteria,this.editArea]),this.tabView=new _({tabs:[new _.Tab({id:"tags-tab",name:"tags",text:"6WTags"}),new _.Tab({id:"criteria-tab",name:"criteria",text:g.getText("suggestedTags")})],className:"withSimplified",events:{onSelectTab:function(e,t,a){i.tabView&&(i._topBar.getElement("#filter-tags").toggleClassName("disabled","criteria"===e.options.name),i._topBar.getElement("#filter-tags").hasClassName("disabled")?i._topBar.getElement("input").disabled=!0:i._topBar.getElement("input").disabled=!1,"criteria"===e.getName()?(i.displayCriteria(),i._manageEmbeddedViewVisibility(!1),i.actionManager&&i.actionManager.initActionsView().container.hide()):"tags"===e.getName()&&(i.displayTags(),i.actionManager&&i.actionManager.initActionsView().container.show()),i.observedNavImpl&&i.observedNavImpl.getCache()&&(i.observedNavImpl.getCache().selectedTab=e.getName()),i.redraw())}}}).inject(this.scrollerContainerDiv),this.tagsContainer=e.createElement("div",{style:{height:k},id:"all-tags-container","data-rec-id":"all-tags-container",tabindex:0}),this.tabView.getTab("tags").setContent(this.tagsContainer),this.criteriaContainer=e.createElement("div",{style:{height:B},id:"all-criteria-container"}),this.criteriaContainer.setContent("<div id='all-criteria'></div>"),this.criteriaContainer.grab(e.createElement("div",{id:"criteria-footer-wrapper"})),e.createElement("div",{id:"criteria-footer"}).inject(this.criteriaContainer.getElement("#criteria-footer-wrapper")),this.criteriaContainer.getElement("#criteria-footer").innerHTML+="<hr/><div id='criteria-toggle-container'></div><div id='search-button-container'></div>",this.tabView.getTab("criteria").setContent(this.criteriaContainer),this.searchButton=new C({value:g.getText("search"),className:"primary search-button"}),this.searchButton.disable(),this.simplifiedTaggerRoot=e.createElement("div",{id:"simplified-tagger-root",class:"tagger-root"}),this.taggerContentContainer=e.createElement("div",{id:"tag-content",class:"tagger-content-container"}),this.rootWContainer=e.createElement("div",{class:"roots-w-container"});e.createElement("div",{});this.taggerContentContainer.grab(this.rootWContainer),this.tagContainer=e.createElement("div",{class:"tags-container"}),this.preferredView=new r({taggerView:this}).render(),this.preferredView.inject(this.tagContainer).hide(),this.addAllContentView(!1,s),this.wrapperContainer=e.createElement("div",{class:"wrapper"}),this.wrapperContainer.grab(this.tagContainer),this.taggerContentContainer.grab(this.wrapperContainer),this.simplifiedTaggerRoot.grab(this.taggerContentContainer),this.tagsContainer.addContent(this.simplifiedTaggerRoot),this.taggerScroller=new P({element:this.scrollerContainerDiv}).inject(this.taggerRoot),O.getOption("WebInWin")?this.taggerRoot.addClassName("tagger-webInwin"):(this.showResultsView=(new l).render().inject(this.taggerRoot,"bottom"),this.showResultsView.addEvent("showResultClick",this.closeTagger.bind(this))),this.actionManager=h.init({taggerView:this}),this.actionManager.initActionsView().inject(this.taggerRoot,"bottom"),window.addEventListener("resize",this.updateShowResults.bind(this)),O.getOption("viewPromiseDelay")?setTimeout(function(){t()},O.getOption("viewPromiseDelay")):t()}.bind(this)),this.addAllContentView=function(e,t){this.allContentView||(this.allContentView=new t({taggerView:this}).render(),this.allViewHeaderVisibility(e),this.allContentView.collapse(),this.allContentView.inject(this.tagContainer),this.allContentView.allTagsExp.getContent().addEventListener("expand",this.onSectionExpand.bind(this)),this.allContentView.allTagsExp.getContent().addEventListener("collapse",this.onSectionCollapse.bind(this)))}},domEvents:{"click .tagger-filter":"toggleSearchInput","click .section-header":"toggleSection","click .parameter":"onToggleParamTagSelection","click .attribute":"onFreeInputDeletion","click .tag-delete":"onTagDeletion","click .more":"moreClicked","click .tree":"toggleTagExpand","click #all-tags .tag":"triggerToggleTagSelection","contextmenu #all-tags .tag":"openTagContextMenu","click .fonticon-menu-dot":"toggleToolBoxVisibility","click .tool-icon.sort":"changeSort","click .toolboxView":"changeView","click #all-tags .predicate-header":"clickedPredicateEvent","click .add-tag-close":"clearInput","keyup #taginput":"onSearchInput","input .tagger-input":"addOrRemoveClear","click .tagger-close":"closeTagger","click .criteria-toggle":"toggleCriteriaExpand","click .show-all-toggle":"toggleMore","click .search-button":"onSearchLaunch","keyup #all-tags-container":"onRefineLaunch","keydown #tagnavigator":"toggleIsW","click .parameters-toggle":"toggleParametersExpand","click .add-tag-magnifier-param":"clickParameterMagnifier","keydown #parameter-input-field":"clickParameterMagnifier","click .activate-simplified":"activateSimplifiedTagger","click #typePredicateViewToggle":"onTypePredicateViewToggle"},activateSimplifiedTagger:function(){p.setPreference({name:"simplified",value:!0,onComplete:function(){O.getOption("WebInWin")||location.reload()},onFailure:function(){A.warn("FAILED to activate the 6WTagger Beta")}})},getRootWs:function(){return O.getOption("simplifiedRootW")},onSectionExpand:function(e){var t=this.observedNavImpl.getFocusedProxy();t&&(t.showAllBool=!0)},onSectionCollapse:function(e){var t=this.observedNavImpl.getFocusedProxy();t&&(t.showAllBool=!1),M.publish({channel:"TaggerTrackerApi",topic:"hit",data:{category:"6WTagger",action:"MoreTags",persDim:{pd1:"collapse"}}})},addOpacity:function(){this._topBar.addOpacity(),U.addOpacity(),this.editArea.addClassName("add-opacity"),this.tagContainer.addClassName("add-opacity")},removeOpacity:function(){this.container.getElements(".add-opacity").forEach(function(e){e.removeClassName("add-opacity")}),this.scrollerContainerDiv.removeClassName("set-height")},actionCancel:function(){var e=this.actionManager?this.actionManager.getCurrentAction():void 0;e&&e.id==F.ACTION_EDITTAGREL&&this.activeTagsEditView&&this.redrawActiveTagsEdit();var t=this;this.redrawSimplifiedTags({redrawActiveCriteria:!1,redrawAllView:!0},this._simplifiedSelectedRootWs).then(function(){t._simplifiedSelectedRootWs.forEach(function(e){l.redrawUiElements(void 0,e)})}),this.removeOpacity()},onRootWSelection:function(e){if(UWA.is(e,"string")){var t=this;this.storage.set("activeSimplifiedW",this._simplifiedSelectedRootWs),this.getObservedNavigator().getCache().setActiveW("allw"),this._topBar.setPlaceHolderText(),t.redrawSimplifiedTags({redrawActiveCriteria:!1,redrawAllView:!0,onRootWSelection:!0},this._simplifiedSelectedRootWs).then(function(){t._simplifiedSelectedRootWs.forEach(function(e){l.redrawUiElements(void 0,e)})})}},onAllWViewActivation:function(e){m.mask(this.taggerRoot);var t=this;this._enabledAllwMode=!0,this._topBar.setPlaceHolderText(),this.destroyTagValues(),!e&""!==e&&(this.storage.set("activeSimplifiedW","allw"),this.getObservedNavigator().getCache().setActiveW("allw")),t.timerOnSearch&&clearTimeout(t.timerOnSearch),t.timerOnSearch=setTimeout(function(){t.redrawSimplifiedTags({redrawActiveCriteria:!1,redrawAllView:!0}).then(function(){t._simplifiedSelectedRootWs.forEach(function(e){l.redrawUiElements(void 0,e)}),m.unmask(t.taggerRoot)})}.bind(this),200)},onAllWViewDeactivation:function(){this._enabledAllwMode=!this._enabledAllwMode&&this._enabledAllwMode},updateShowResults:function(){if(this.showResultsView)if((this.observedNavImpl.hasActiveTags()||this.observedNavImpl.hasLocalActiveTags())&&document.body.clientWidth<640)if(this.showResultsView.show(),this.hasFocusedProxy()){var e=this.observedNavImpl.getFocusedProxy().getResultsCount();"number"==typeof e?this.showResultsView.container.getElement(".show-results").setText(g.getFormattedText("seeResultsWithNumber",{count:g.convertToUnity(e)})):this.showResultsView.container.getElement(".show-results").setText(g.getText("seeResults"))}else this.showResultsView.container.getElement(".show-results").setText(g.getText("seeResults"));else this.showResultsView.hide()},udpateShowActionViews:function(){(this.observedNavImpl.hasActiveTags()||this.observedNavImpl.hasLocalActiveTags())&&document.body.clientWidth<640&&(!this.showResultsView||this.showResultsView.container.isHidden()&&!this.actionManager.initActionsView().container.isHidden()?this.showResultsView.hide():(this.actionManager.initActionsView().container.setStyle("height",0),this.showResultsView.show()))},getActiveRootW:function(){var t=this.storage.get("activeSimplifiedW");return(!t||"array"!==e.typeOf(t)||"array"==e.typeOf(t)&&t.length<=0)&&(t=this.getRootWs(),this.storage.set("activeSimplifiedW",t)),t},hasFocusedProxy:function(e){var t=e||this.getObservedNavigator();return t?t.getFocusedProxy():void 0},hasAdvancedFocsuedProxy:function(e,t){var i=e?e.getFocusedProxy():this.hasFocusedProxy();if(i&&t&&i.getAdvancedOption(t))return i},allViewHeaderVisibility:function(e){this.allContentView&&this.allContentView.showHideHeader(e)},getCacheSimplified:function(){return this.cacheForSimplified},startSelectAction:function(){return this.actionManager.startAction({action:F.ACTION_SELECT,isInteractive:!1})},onRefineLaunch:function(e){if(A.log("inside onRefineLaunch"),17===e.keyCode)if(A.log("inside onRefineLaunch, event.keyCode === 17"),this._simplifiedTagger){var t=this.actionManager.getCurrentAction();t&&t.id===F.ACTION_SELECT&&!t.get("isInteractive")&&(A.log("launching Select action"),this.actionManager.launchAction({isInteractive:!1}))}else this._onRefineLaunch()},_onRefineLaunch:function(e){if(this._simplifiedTagger&&(this.selectedTags=UWA.clone(e)),this.selectedTags.length){this.setSpinner();for(var t=0;t<this.selectedTags.length;++t){var i=this.selectedTags[t];UWA.is(i,"object")?(delete i.doNotCount,i.isFreeInput?this.observedNavImpl.createFreeInputs([i]):i.isComplex?this.observedNavImpl.toggleComplexTagSelection(i,!1):this.observedNavImpl.toggleTagSelection(i,!1)):this.toggleTagSelection(this.selectedTags[t],!1)}this.selectedTags=[],this.observedNavImpl.onRefine()}},moreClicked:function(e){var t=e.target.getClosest(".predicate")||e.target.getClosest(".section.ds6w-root-predicate"),i=this.getIdFromDOMId(t.id).split("/").pop();this.observedNavImpl.clickOnMoreButton(i),this.redrawPredicate(t.id),M.publish({channel:"TaggerTrackerApi",topic:"hit",data:{category:"6WTagger",action:"ClickOnViewMore",persDim:{pd1:i}}})},toggleCriteriaExpand:function(e){var t=this.observedNavImpl.getCache();UWA.is(e,"boolean")?t.setMoreClicked(e):(t.setMoreClicked(!t.isMoreClicked()),this.hasAdvancedFocsuedProxy(void 0,"editTagsRelationships")&&this.actionManager&&this.actionManager.abortAction()),this.redraw()},toggleTagExpand:function(t){var i,a,n,r=t.target.getClosest(".tag"),s=t.target.getClosest(".tag").id,o=this.observedNavImpl.getCache(),l=t.target.getClosest(".predicate"),c=this.getIdFromDOMId(l.id),d=(c.split("/").pop(),l.getElement(".predicate-content"));(n=!o.isTagTreeExpanded(s))?o.expandTagTree(s):o.collapseTagTree(s);let g=this.actionManager?this.actionManager.getCurrentAction():void 0;if(o.colorManager.isColorized(c)&&(!g||g&&g.id!=F.ACTION_COLORIZE))this.redrawPredicate(l.id);else{if(r.toggleClassName("expanded",n),O.getOption("activate_hierarchical_tag_scroll")){let e=d.getElement(".treeview");if(e&&"1"==r.getAttribute("level"))if(n)e.addClassName("manage-horizontal-scroll");else{d.getElements(".tag.expanded[level='1']").length||e.removeClassName("manage-horizontal-scroll")}}i=r.getParent().getElement(".childrenTags"),a=e.extendElement(i.getChildren()[0]),this.fx(i,n).start({height:n?[0,a.getSize().height]:[a.getSize().height,0]})}return!1},openTagContextMenu:function(e){if(!(this.actionManager?this.actionManager.getCurrentAction():void 0)){let t=e.target.getClosest(".tag"),i=t.getClosest("li.predicate").getAttribute("predicate");if(this.observedNavImpl.hasExcludeSupport(i)){e.preventDefault();this.contextMenu.dropdown&&this.contextMenu.dropdown.destroy();let i=this.getIdFromDOMId(t.id),a=[];this.observedNavImpl.isExcluded(i)?a.push({text:g.getText("unexludeTag"),fonticon:"block",id:"include"}):a.push({text:g.getText("excludeTag"),fonticon:"block",id:"exclude"}),this.contextMenu.createDropdown({cont:this.taggerRoot,target:t,view:this,items:a,evtObj:{pageX:e.x,pageY:e.y}}),console.log("in dropdown")}}return!1},triggerToggleTagSelection:function(t){var i,a,n,r;if(this.taggerUWAElement.getElement("#tagnavigator").hasClassName("edition_mode"))return!1;i=t.target.getClosest(".tag");var s=this.actionManager?this.actionManager.getCurrentAction():void 0;if(s){if(s.id==F.ACTION_GROUP)return s.onTagSelection(i);if(s.id==F.ACTION_EXCLUDE||s.id==F.ACTION_SELECTINAPP)return s.onTagSelection(i);if(s.id==F.ACTION_COLORIZE)return!i.hasClassName("more")&&s.onTagSelection(i)}if(t.ctrlKey&&t.altKey)return!1;if(t.ctrlKey||s&&(s.id==F.ACTION_SELECT||s.id==F.ACTION_EDITTAGREL||s.id==F.ACTION_SELECTINAPP))return this._simplifiedTagger?(s||(s=this.startSelectAction()),s.id==F.ACTION_EDITTAGREL?(this.emitClickedTagEvent(i),s.onTagSelection(i),!1):s.onTagSelection(i)):F.onTagMultiSelection(i,this.selectedTags);if(this.observedNavImpl&&!this.observedNavImpl.getFocusedProxy()&&this.observedNavImpl.dispatchEvent("onBeforeGlobalFilterChange"),t.altKey&&!s){if(-1!==i.id.indexOf("atv"))return!1;var o=e.extendElement(i.parentElement).getElements("li.selected");for(n=0,r=o.length;n<r;++n)this.toggleTagSelection(o[n].id,!1)}return a=i.id.replace("atv",""),this.toggleTagSelection(a),!1},trackTagClick:function(e){setTimeout(()=>{let t=JSON.parse(e).predicate.split("/"),i={pd1:t[t.length-1],pd2:t[0]};M.publish({channel:"TaggerTrackerApi",topic:"hit",data:{category:"6WTagger",action:"ClickOnTag",persDim:i}})})},toggleTagSelection:function(e,t,i){var a;a=this.getIdFromDOMId(e),this.setSpinner(),!1!==t&&(this.selectedTags=[]),this.trackTagClick(a),this.observedNavImpl.toggleTagSelection(a,t,i)},toggleToolBoxVisibility:function(e){var t,i,a,n=this.observedNavImpl.getCache();if(a=(i=e.target).getClosest(".predicate-header")){t=a.getParent().id;let e=this.getIdFromDOMId(t);if(i.getParent().toggleClassName("expanded",!n.isToolboxVisible(t)),n.toggleToolboxVisibility(t),!(this.actionManager?this.actionManager.getCurrentAction()&&this.actionManager.getCurrentAction().id==F.ACTION_COLORIZE:void 0)){let i=!n.isToolboxVisible(t)&&a.getElement(".action-icon.fonticon-palette")&&n.colorManager.isColorized(e);a.getElement(".action-icon.fonticon-palette").toggleClassName("hide",!i),a.getElement(".predicate-label").toggleClassName("adjust-width",i)}}return!1},changeSort:function(e){if(e.ctrlKey)return!1;if(e.target.hasClassName("option-disabled"))return!1;var t=e.target.hasClassName("fonticon-sort-num-desc")||e.target.hasClassName("fonticon-sort-num-asc"),i=e.target.getClosest(".predicate"),a=this.observedNavImpl.getCache(),n=n=this.getIdFromDOMId(i.id);t?a.changeSort("nbSort",n):a.changeSort("alphaSort",n);var r=a.getCurrentSort(n);return M.publish({channel:"TaggerTrackerApi",topic:"hit",data:{category:"6WTagger",action:"TaggerSortChange",persDim:{pd1:i.getAttribute("predicate"),pd2:r.sortMode}}}),i&&this.redrawPredicate(i.id,!0),!1},toggleSection:function(t){var i,a,n,r,s=this.observedNavImpl.getCache(),o=t.target.getClosest(".section")||t.target.getClosest(".simplified-section");if(!t.target.classList.contains("active-tags-close")){if(o){i=o.getElement(".header-title").id,a=o.getElement(".expandable"),n=UWA.is(s.isSectionCollapsed(i),"boolean")?s.isSectionCollapsed(i):!o.hasClassName("expanded-section"),r=e.extendElement(a.getChildren()[0]);var l="createTag"===i?i:void 0;if(this.fx(a,n,l).start({height:n?[0,r.getSize().height]:[r.getSize().height,0]}),n?t.target.getClosest(".section-header").getParent().addClassName("expanded-section"):t.target.getClosest(".section-header").getParent().removeClassName("expanded-section"),s.toggleSection(i),s.isSearchVisible()&&s.getSearchId()==="filter-"+i){if(s.setSearchVisibility(n),!n){var c=a.getParent().getElement("input");this.resetSearch(c,!0)}this.toggleSearchInput(null,!1,!0)}}return!1}},getSearchButton:function(){return this.searchButton},changeView:function(e){if(e.ctrlKey)return!1;var t=e.target;if(t.hasClassName("option-disabled"))return!1;var i=this._simplifiedTagger?this.getCacheSimplified():this.observedNavImpl.getCache(),a=t.getClosest(".predicate"),n=this.getIdFromDOMId(a.id),r=n.split("/").pop(),s=!1,l={channel:"TaggerTrackerApi",topic:"hit",data:{category:"6WTagger",action:"TaggerViewChange",persDim:{pd1:r}}};if("colorize"==(s=!(s=!(s=!(s=(s=!(s=t.hasClassName("bar")?"bar":t.hasClassName("pie")?"pie":s)&&t.hasClassName("fonticon-palette")?"colorize":s)||!t.hasClassName("fonticon-th-tag")&&!t.hasClassName("fonticon-list")?s:"tag")&&t.hasClassName("fonticon-text")?"input":s)&&t.hasClassName("fonticon-view-small-thb")?"category":s)&&t.hasClassName("peopleView")?"people":s)){var c=this.observedNavImpl.getCache();l.data.action="colorize",l.data.persDim.pd2=c.colorManager.isColorized(n)?"uncolorize":"colorize"}else l.data.persDim.pd2=s;switch(M.publish(l),s){case"bar":case"pie":return this.handleChartView(s,r,a),!1;case"input":"freeInput"===i.getViewMode(r)?i.setViewMode(r,"tag"):i.setViewMode(r,"freeInput");break;case"tag":"tag"!==i.getViewMode(r)?i.setViewMode(r,"tag"):e.target.hasClassName("fonticon-th-tag")?i.removeCloud(a.id):e.target.hasClassName("fonticon-list")&&i.addCloud(a.id);break;case"colorize":return this.handleColorize(a),!1;case"category":i.setViewMode(r,"category");break;case"people":"people"===i.getViewMode(r)?i.setViewMode(r,"tag"):i.setViewMode(r,"people")}return a&&(this.redrawPredicate(a.id),"input"===s&&"freeInput"===i.getViewMode(r)&&(this._simplifiedTagger&&"date"===o.getPredicate(r).getType()||this.container.getElement("#"+a.id+" input").focus())),!1},ensureColorCusto:function(e){return new i(function(t){var a=j.getColorPromisesForTenants(this.observedNavImpl);i.all(a).then(function(i){e.colorManager.updateAdminColors(UWA.clone(i)),t()})}.bind(this))},handleChartView:function(e,t,i){var a=this.observedNavImpl.getCache();this.ensureColorCusto(a).then(function(){var n=this._simplifiedTagger?this.getCacheSimplified():a;"bar"===e?"graphBar"===n.getViewMode(t)?n.setViewMode(t,"tag"):n.setViewMode(t,"graphBar"):"pie"===e&&("graphPie"===n.getViewMode(t)?n.setViewMode(t,"tag"):n.setViewMode(t,"graphPie")),i&&this.redrawPredicate(i.id)}.bind(this))},handleColorize:function(e){let t=this.actionManager?this.actionManager.getCurrentAction():void 0;if(t&&t.id==F.ACTION_COLORIZE)t.removeSelections(!0);else if(!t){var i=[],a=this.observedNavImpl.getCache(),n=this.getIdFromDOMId(e.id),r=e.getAttribute("predicate");this.taggerUWAElement.getElement(".predicate.colorize")&&i.push(this.taggerUWAElement.getElement(".predicate.colorize")),a.colorManager.toggleColorize(n),this.ensureColorCusto(a).then(function(){this.taggerUWAElement.getElements(".graph").forEach(function(e){i.push(e.getClosest(".predicate"))}.bind(this)),i.forEach(function(t){t!==e&&this.redrawPredicate(t.id)}.bind(this)),a.colorManager.isColorized(n)||this.observedNavImpl.unColorize(),e&&this.redrawPredicate(e.id)}.bind(this)),a.colorManager.isColorized(n)&&M.publish({channel:"TaggerTrackerApi",topic:"hit",data:{category:"6WTagger",action:"ColorizeViaOption",persDim:{pd1:r}}})}},clickedPredicateEvent:function(e){var t,i=e.target.getClosest(".predicate-header");if(i.getClosest(".active-predicate-list"))return!1;t=i.getParent().id;var a=this.actionManager?this.actionManager.getCurrentAction():void 0;if(a&&a.id==F.ACTION_GROUP&&e.target.hasClassName("pred-label"))return a.onPredicateSelection(e.target).then(function(){},function(){this.togglePredicateExpand(t,i)}.bind(this));if(e.target.hasClassName("action-icon")){if(e.target.hasClassName("fonticon-palette"))a||(this.observedNavImpl.getCache().colorManager.toggleColorize(this.getIdFromDOMId(t)),this.observedNavImpl.unColorize(),this.redrawPredicate(t));else if(a)a.onPredicateSelection(e.target);else if(this.actionManager){this.actionManager.startAction({action:F.ACTION_GROUP,isInteractive:!1}).onPredicateSelection(e.target).then(function(){this.actionManager.launchAction({isInteractive:!1})}.bind(this)),M.publish({channel:"TaggerTrackerApi",topic:"hit",data:{category:"6WTagger",action:"RemovePredicateGrouping",persDim:{pd1:this.getIdFromDOMId(t)?this.getIdFromDOMId(t).split("/").pop():"error"}}})}}else e.target.hasClassName("clear-selection")&&a&&a.id==F.ACTION_COLORIZE?a.removeSelections(!0):this.togglePredicateExpand(t,i)},togglePredicateExpand:function(t,i){var a,n,r,s,c,d=this,g=this.observedNavImpl.getCache(),u=o.getPredicate(this.getIdFromDOMId(t).split("/").pop()),h=l.getPredicateView(u),p=!i.getParent().hasClassName("expanded");if(this._simplifiedTagger){var f=u.id(),m={channel:"TaggerTrackerApi",topic:"hit",data:{category:"6WTagger",action:"PredicateExpandCollapse",persDim:{pd1:f,pd2:"expanded"}}},v=i.getClosest(".root-border");if(p)g.expandPredicate(f),g.setAsInteractivelyExpanded(f),v&&v.removeClassName("hide-left-border");else m.data.persDim.pd2="collapsed",g.collapsePredicate(f),g.setAsInteractivelyCollapsed(f),1==i.getClosest("ul.predicates").getElements("li.predicate").length&&v&&v.addClassName("hide-left-border");M.publish(m)}else p?g.expandPredicate(t):g.collapsePredicate(t);if(i){for(i.getParent().toggleClassName("expanded",p),r=0,s=(a=i.getParent().getChildren()).length;r<s;++r)(n=e.extendElement(a[r])).match(".predicate-content")&&(c=e.extendElement(n.getChildren()[0]),new e.Fx(n,{duration:300,transition:"quadInOut",events:{onComplete:function(){p?n.setStyles({position:"relative",overflow:"hidden",opacity:1,height:"auto"}):n.setStyles({position:"absolute",opacity:0,height:"auto"}),d.updateScroller()},onStart:function(){n.setStyle("position","relative"),n.setStyle("overflow","hidden")}}}).start({height:p?[0,c.getSize().height]:[c.getSize().height,0]}));var T=this._simplifiedTagger?this.getCacheSimplified():this.observedNavImpl.getCache();p&&-1!==T.getViewMode(u.id()).indexOf("graph")&&this.ensureColorCusto(this.observedNavImpl.getCache()).then(function(){h.updateGraphColors(),h.redrawUiElement()})}},toggleSearchInput:function(e,t,i){var a,n,r,s,o,l=this.observedNavImpl?this.observedNavImpl.getCache():null;return!!l&&(n=function(i){var a=i.getElement("#taginput");null!==a&&(a.value=l.getSearchValue(),this.addOrRemoveClear(a,!1)),this.fx(i,!0).start({height:[0,34]}),(t||e)&&a.focus()}.bind(this),r=function(e){var t=e.getElement("#taginput");t&&(this.fx(e,!1).start({height:[e.getSize().height,0]}),t.blur(),l.getSearchValue()&&!i&&this.resetSearch(t,"filter-all"!==e.id))}.bind(this),o=l.getSearchId(),s=(a=e&&e.target.getClosest(".section")?e.target.getClosest(".section").getElement(".add-tag-cont"):e&&e.target.getClosest("#header-container")?this.globalSearchInput:this.taggerUWAElement.getElement("#"+o)).id,i?l.isSearchVisible()&&a?(n(a),"filter-all"!==a.id&&r(this.globalSearchInput)):r(a):(s!==o&&l.isSearchVisible()||!l.isSearchVisible()?(r(this.taggerUWAElement.getElement("#"+o)),l.setSearchVisibility(!0)):l.setSearchVisibility(!1),l.setSearchId(s),l.isSearchVisible()?n(this.taggerUWAElement.getElement("#"+s)):r(this.taggerUWAElement.getElement("#"+s))),this.taggerRoot.getElement(".tagger-filter").toggleClassName("selected","filter-all"===s&&l.isSearchVisible()),l.isSearchVisible()&&l.isSectionCollapsed(s.replace("filter-",""))||!1)},clearInput:function(e){var t=e.target.getParent(".add-tag-cont").getElement("input");if(t.getClosest(".addClear").removeClassName("addClear"),t){if(t.hasClassName("searchbox"))this.resetSearch(t,"filter-all"!==e.target.getParent(".add-tag-cont").id);else{var i=this.getIdFromDOMId(e.target.getClosest(".predicate").id),a=o.getPredicate(i.split("/").pop());if(a){var n=t.hasClassName("from")?"from":"to",r=l.getPredicateView(a,this),s=a.getType();switch(s){case"integer":case"float":case"double":e.target.value="",r.criterion[s][n].elements.input.value="",r.criterion[s][n].elements.input.triggerEvent("keyup",e);break;case"date":e.target.value="",r.criterion[s][n].elements.input.value="",r.criterion[s][n].events.input.change(e)}}}t.value="",t.focus()}},resetSearch:function(e,t){document.activeElement&&document.activeElement.id;var i,a=this.observedNavImpl.getCache();e.value="",a.setSearchValue(""),a.setViewModeForSearch(),t?(i=this.taggerUWAElement.getElement(".ds6w-root-predicate."+e.getParent().id.replace("filter-","ds6w_"))||void 0,this.redrawPredicateForSearch(i)):(this.tagsContainer.getElements(".predicate"),this.tagsContainer.getElement("#tags-var-height").innerHTML=this.availableTagsToHtml());var n=this.observedNavImpl.getFocusedProxy();n&&(UWA.is(n.relevantPredicates,"array")&&n.relevantPredicates.length>0&&(!1!==n.showAllBool&&void 0!==n.showAllBool||(this.isW?this.tagsContainer.getElement("#all-tags").toggleClassName("relevant-only",!0):this.tagsContainer.getElement(".predicates").toggleClassName("relevant-only",!0))));l.redrawUiElements(),this.updateScroller()},onSearchInput:function(t){if(this._simplifiedTagger)return!1;var i,a,n=e.Event.getElement(t),r=this.observedNavImpl.getCache();return this.timerOnSearch&&clearTimeout(this.timerOnSearch),this.timerOnSearch=setTimeout(function(){if(void 0===n&&(n=t),!n)return!1;r.setSearchValue(n.value),a=e.Event.getElement(t),r.setViewModeForSearch(),"filter-all"===a.getParent().id?(["who","when","what","where","why","how"].forEach(function(e){r.toggleSection(e,!1)}),this.tagsContainer.getElement("#tags-var-height").innerHTML=this.availableTagsToHtml(),l.redrawUiElements(),this.redrawShowAll(),this.isW||this.displayNoTags(!0)):(i=this.taggerUWAElement.getElement(".ds6w-root-predicate."+t.target.getParent().id.replace("filter-","ds6w_"))||void 0,this.redrawPredicateForSearch(i)),this.updateScroller()}.bind(this),200),!1},onTopBarSearch:function(e){if(this.observedNavImpl){var t=this.observedNavImpl.getCache();t.setSearchVisibility(!0),t.setSearchValue(e.searchText),this.searchedString=e.searchText,this.timerOnSearch&&clearTimeout(this.timerOnSearch),this.timerOnSearch=setTimeout(function(){var t=this._simplifiedSelectedRootWs;e.allWView?(this._topBar.setAllW(),t=this.getRootWs()):this._simplifiedSelectedRootWs.length<6&&this._topBar.resetToOriginalW(this._simplifiedSelectedRootWs),this.redrawSimplifiedTags({onSearch:!0,searchString:this.searchedString},t).then(function(){t.forEach(function(e){l.redrawUiElements(void 0,e)})})}.bind(this),200)}},emitClickedTagEvent:function(e){var t,i=this.observedNavImpl.getFocusedProxy(),a=e.getClosest(".predicate")?e.getClosest(".predicate").getAttribute("predicate"):null,n=e.getAttribute("title"),r=e.id.replace("atv",""),o=this.getIdFromDOMId(r),l=UWA.is(o,"object")?o:JSON.parse(o);if(i){var c=i.getEachTagValueForPredicate(a);if(UWA.is(c,"array"))for(var d=0;d<c.length;d++)if(c[d].getDisplayValue()==n){t=c[d];break}t&&!a.includes("computedCountryInfo")||(t=s.getTagValue(l.predicate,l.dispValue,l.object,l.type)),this.updateActiveTagView(t)}},updateActiveTagView:function(e){if(!this.activeTagsEditView)throw new Error("Unexpected error!!! ActiveTags view not initialized");this.activeTagsEditView.updateTags(e)},addOrRemoveClear:function(e,t){e.target&&(e=e.target),""===e.value?e.getClosest(".add-tag-cont").removeClassName("addClear"):e.getClosest(".add-tag-cont").addClassName("addClear"),UWA.is(t)&&!0!==t||r.checkActiveSearch(this)},toggleActiveW:function(e){var t,i,a=e.target.getClosest(".item").getElement(".toggle-root"),n=this.observedNavImpl?this.observedNavImpl.getCache():null;return!!n&&("allw"===(t=a?a.className.split(" ")[1]:e.target.getParent().className.split(" ")[1])?(["who","what","where","when","how","why"].forEach(function(e){n.removeActiveW(e)}),n.addActiveW(t),this.menu6wBadge.addClassName("hidden")):(n.toggleActiveW(t),n.removeActiveW("allw"),i=n.getActiveW(),0===Object.keys(i).length?(n.addActiveW("allw"),this.menu6wBadge.addClassName("hidden")):6===Object.keys(i).length?this.menu6wBadge.addClassName("hidden"):Object.keys(i).length>0&&Object.keys(i).length<6&&(this.menu6wBadge.removeClassName("hidden"),this.menu6wBadge.setHTML(Object.keys(i).length))),this.updateHeaderForActiveW(),this.displayNoTags(),!1)},displayNoTags:function(t,i){var a=this.tagsContainer.getElement("#all-tags ul");this.tagsContainer.getElement(".no-tags")&&this.taggerUWAElement.getElement(".no-tags").destroy(),this.visibility&&a&&0===a.getSize().height&&e.createElement("div",{html:{text:t?g.getText("noRslt"):i?g.getText("noRelevantTags"):g.getText("noTags"),class:"no-tags"}}).inject(a,"after")},toggleIsW:function(e){(A.log("inside toggleIsW"),e.ctrlKey&&this._simplifiedTagger)&&(A.log("e.ctrlKey && this._simplifiedTagger"),this.actionManager.getCurrentAction()||(A.log("Launching Select action in silent mode"),this.actionManager.startAction({action:F.ACTION_SELECT,isInteractive:!1})));if(e.ctrlKey&&e.altKey&&e.keyCode==="D".charCodeAt(0)&&(window.proxyLogs=!0),e.ctrlKey&&e.keyCode==="Q".charCodeAt(0)&&!this._simplifiedTagger){var t=this.observedNavImpl?this.observedNavImpl.getCache():null;this.isW=!this.isW,e.preventDefault(),this.taggerUWAElement&&(this.isW?(this.taggerUWAElement.getElement("#tagnavigator").addClassName("isw",this.isW),this.taggerUWAElement.getElement("#tagnavigator").removeClassName("no-w",this.isW),this.taggerRoot.getElement("#header-container").className="allw"):(this.taggerUWAElement.getElement("#tagnavigator").addClassName("no-w",!this.isW),this.taggerUWAElement.getElement("#tagnavigator").removeClassName("isw",!this.isW),t&&t.setSearchId("filter-all"),this.updateHeaderForActiveW()),this.storage&&this.storage.set("isW",!0===this.isW?"true":"false"),this.redraw())}},createHeaderElemNoW:function(){var t,i,a,n=0,r="",s=this;this.observedNavImpl.getCache();for(this.menu6wContainer=e.createElement("span",{class:"badgeContainer"}),this.menu6wIcon=e.createElement("span",{class:"fonticon fonticon-down-open"}),this.menu6wBadge=e.createElement("span",{class:"badge badge-primary tn-badge-count tn-badge-rounded hidden"}),this.menu6w=new S({className:"menu-6w",items:[{name:"allw"},{className:"divider"},{name:"who"},{name:"when"},{name:"what"},{name:"where"},{name:"why"},{name:"how"}],position:"bottom right",closeOnClick:!1,target:this.menu6wContainer,renderTo:this.taggerRoot,events:{onClick:function(e,t){s[t.name].dispatchEvent("onChange",e)},onShow:function(){s.menu6wContainer.addClassName("active")},onHide:function(){s.menu6wContainer.removeClassName("active")}}}),n=0,t=this.menu6w.items.length;n<t;++n)1!==n&&(i=this.menu6w.items[n].name,r=g.getText(i)!==i?g.getText(i):i.replace(/^\w/,function(e){return e.toUpperCase()}),a={type:"checkbox",events:{onChange:this.toggleActiveW.bind(this)},className:"primary "+i,value:"allw"===i?g.getText("allw"):r,checked:0===n,label:""},this[i]=new w(a),this[i].inject(this.menu6w.items[n].elements.container),this.menu6w.items[n].elements.container.getElement("label").setContent("<span class='fonticon fonticon-"+("allw"===i?"tag":"3ds-"+i)+"'></span>"+("allw"===i?g.getText("allw"):r)));this.menuSort6WIcon=e.createElement("span",{class:"fonticon fonticon-sort-tag selected",id:"sort-6w-menu"}),this.menuSort6W=new E({title:g.getText("changePredicateSort"),className:"sort-6w-menu",items:[{fonticon:"sorting",name:"sort-weight",description:g.getText("sort_by_weight")},{fonticon:"sort-tag",name:"sort-tag",description:g.getText("sortbyw"),selected:!0},{fonticon:"sort-alpha-asc",name:"sort-alpha-asc",description:g.getText("alphabeticalOrder")},{fonticon:"sort-alpha-desc",name:"sort-alpha-desc",description:g.getText("reverseAlphabeticalOrder")},{fonticon:"sort-num-asc",name:"sort-num-asc",description:g.getText("occurenceOrder")},{fonticon:"sort-num-desc",name:"sort-num-desc",description:g.getText("reverseOccurenceOrder")}],position:"bottom right",target:this.menuSort6WIcon,renderTo:this.taggerRoot,events:{onClick:function(e,t){var i=s.observedNavImpl.getFocusedProxy();i?i.setSortOrder(t.name):s.observedNavImpl.getCache().set6WSort(t.name),s.updateSortPred(t.name),s.redraw()}}})},toggleMore:function(){this.toggleDisplayAll()},toggleDisplayAll:function(t){if(this._simplifiedTagger)A.log("toggleDisplayAll is not handled with new Tagger UX");else{var i,a=this.observedNavImpl.getFocusedProxy();e.is(t)?(this.isW?this.tagsContainer.getElement("#all-tags").toggleClassName("relevant-only",!t):this.tagsContainer.getElement(".predicates").toggleClassName("relevant-only",!t),a.showAllBool=t):(i=!(!a||!a.relevantPredicates.length)&&a.showAllBool,this.isW?this.tagsContainer.getElement("#all-tags").toggleClassName("relevant-only",i):this.tagsContainer.getElement(".predicates").toggleClassName("relevant-only",i),a.showAllBool=!i),this.tagsContainer.getElement(".show-all-toggle").innerHTML=g.getText(a.showAllBool?"showLess":"showAll"),this.isW||this.displayNoTags(!1,!0)}},toggleDisplayAllCriteria:function(e){this.toggleCriteriaExpand(e)},updateSortPred:function(e){if(!this._simplifiedTagger){var t=e||this.observedNavImpl.getCache().get6WSort();this.menuSort6WIcon.className="fonticon selected fonticon-"+("sort-weight"===t?"sorting":t),this.menuSort6W._activeItem.name!==t&&this.menuSort6W.setActiveItem(t)}},manageSortByPreference:function(){var e=!!this.observedNavImpl.hasFocusedProxyWithRelevantPredicate();if(this.menuSort6W){var t=this.menuSort6W.getItem("sort-weight");t&&(e?t.elements.container.removeClassName("hidden"):t.elements.container.addClassName("hidden"))}},updateHeaderForActiveW:function(){var e,t,i,a=this.observedNavImpl?this.observedNavImpl.getCache():null;if(!this.isW&&a)for(this.taggerHeader.className=Object.keys(a.getActiveW()).join(" "),e=0,t=this.menu6w.items.length;e<t;++e)1!==e&&((i=this.menu6w.items[e].name).slice(4,i.length),this[i].setCheck(a.isActiveW(i)));return this.updateScroller(),!1},_manageEmbeddedViewVisibility:function(e){if(UWA.is(e,"boolean")){var t=this.observedNavImpl.getFocusedProxy();t&&t.supportsEmbeddedView()&&(e?t.showEmbeddedTaggerView():t.hideEmbeddedTaggerView())}},mainTaggerIconClicked:function(){M.publish({channel:"TaggerTrackerApi",topic:"hit",data:{category:"6WTagger",action:"ClickOnTaggerIcon",persDim:{pd1:this.visibility?"Closing":"Opening"}}});var e=this.getObservedNavigator();if(this.taggerIcon){var t=O.getOption("madeForEachOther");this.visibility?"criteria"===this.tabView.selectedTab.getName()?(this.displayTags(),this.redrawTopBarTagIcon(),!t&&this._manageEmbeddedViewVisibility(!1)):e.hasWidgetMaximized()||null===e.getFocusedProxy()?(this.closeTagger(),!t&&this._manageEmbeddedViewVisibility(!0)):(this.closeTagger(),this.redrawTopBarTagIcon(),!t&&this._manageEmbeddedViewVisibility(!0)):(null!==e.getWidgetMaximized()&&"IsNotInWidget"!==e.getWidgetMaximized()&&e.updateFocusedProxy(),this.displayTags(),this.openTagger(),!t&&this._manageEmbeddedViewVisibility(!1))}},closeTagger:function(){this.tagnavigator.hasEvent("onClose")&&(this.tagnavigator.dispatchEvent("onClose"),this.toggleVisibility(!1),this.observedNavImpl.getFocusedProxy()&&this.observedNavImpl.getFocusedProxy().triggerCallbackOfEvent(11,null),!O.getOption("madeForEachOther")&&this._manageEmbeddedViewVisibility(!0))},openTagger:function(){this.getObservedNavigator();this.tagnavigator.hasEvent("onOpen")&&(this.tagnavigator.dispatchEvent("onOpen"),this.toggleVisibility(!0),this.observedNavImpl.getFocusedProxy()&&this.observedNavImpl.getFocusedProxy().triggerCallbackOfEvent(10,null))},setTaggerMode:function(e){this.getObservedNavigator()&&e&&(this.observedNavImpl.getFocusedProxy()&&"criteria"===e?(this.tabView.selectTab("criteria-tab"),this.actionManager&&this.actionManager.initActionsView().container.hide()):"tags"===e?(this.tabView.selectTab("tags-tab"),this.actionManager&&this.actionManager.initActionsView().container.show()):A.info("cannot set mode = "+e))},clearActiveTags:function(e){return this.observedNavImpl.getFocusedProxy()||this.observedNavImpl.dispatchEvent("onBeforeGlobalFilterChange"),this.setSpinner(),this.observedNavImpl.clearFilters(),this.observedNavImpl.isReadyForDisplay()&&this.redraw(),!1},getObservedNavigator:function(){return this.observedNavImpl},isColorizePossible:function(){return this.observedNavImpl.isColorizePossible()},warnForColorize:function(e){this.observedNavImpl.colorize(e)},toggleVisibility:function(e){this._simplifiedTagger&&e&&O.searchOnType()&&this._topBar&&this._topBar.startEventListening(),this.visibility!==e&&(this.visibility=void 0===e?!this.visibility:e,this.visibility||this.actionManager&&this.actionManager.abortAction(),setTimeout(this.updateScroller.bind(this),500),this.redrawTopBarTagIcon(),this.redraw(),this.observedNavImpl.updateDisplayStatus(this.visibility))},isTagInEdition:function(e){return this.observedNavImpl.isTagInEdition(e)},setSpinner:function(){this.taggerRoot&&(m.mask(this.taggerRoot),this.observedNavImpl&&this.observedNavImpl.dispatchEvent("ON_TAGGERVIEW_MASKED"))},redrawPredicate:function(t,i,a){var n,s,d,g,u,h=this._simplifiedTagger?this.getCacheSimplified():this.observedNavImpl.getCache();t&&(d=(s=(n=o.getPredicate(this.getIdFromDOMId(t).split("/").pop())).is6WRoot()?c.getRootPredicateView(n,this):l.getPredicateView(n,this)).toHtml(i,r.isInFavorites(s.id()),-1!==t.indexOf("sug")),g=this.taggerUWAElement.getElement("#"+t),u=e.createElement("div").addContent(d).getElement("#"+t).inject(g,"before"),g.destroy(),"tag"!==h.getViewMode(n.id())&&s.redrawUiElement(-1!==t.indexOf("sug")),this._simplifiedTagger?u.show():this.updateScroller())},redrawPredicateForSearch:function(t){var i,a=this.observedNavImpl.getCache(),n=o.getPredicate(this.getIdFromDOMId(t.id).split("/").pop()),r=this.taggerUWAElement.getElement("#"+t.id).getElement(".predicate-content.expandable");t&&t.parentElement&&(i=c.getRootPredicateView(n,this).toHtmlForSeach(),r.getChildren().forEach(function(e){e.destroy()}),e.createElement("div").addContent(i).getChildren().forEach(function(e){e.inject(r,"bottom")}),r.getElements(".predicate").forEach(function(e){var t=o.getPredicate(this.getIdFromDOMId(e.id).split("/").pop()),i=l.getPredicateView(t);a.getViewMode(t.id()).contains("graph")&&!i._hiddenPredicate&&i.redrawUiElement()}.bind(this)),0===r.getElements(".tag").length&&r.getElements(".predicate").length===r.getElements(".predicate.searchexcluded").length&&e.createElement("div",{html:{text:g.getText("noRslt"),class:"no-tags"}}).inject(r,"bottom"),this.updateScroller())},redrawTopBarTagIcon:function(){var e=this.getObservedNavigator(),t=e.getFocusedProxy(),i=this.observedNavImpl.getFilters(null,!0).allfilters,a=t?e.getFocusedProxy().getFilters(!0).localfilters:void 0,n=0;n+=Object.keys(i).reduce(function(e,t){return e+i[t].length},0),a&&(t.supportsAdvancedFilter()&&UWA.is(a.condition,"array")?n+=a.condition.length:n+=Object.keys(a).reduce(function(e,t){return e+a[t].length},0)),this.taggerIcon?(this.taggerIcon.toggleClassName("tagger-filter",0!==n),this.tabView&&(this.visibility&&"criteria"!==this.tabView.selectedTab.getName()?this.taggerIcon.toggleClassName("tagger-icon-active",!0):this.taggerIcon.toggleClassName("tagger-icon-active",!1))):window.richClient&&this.tagnavigator.hasEvent("changeTaggerIcon")&&this.tagnavigator.dispatchEvent("changeTaggerIcon",[{"tagger-filter":0!==n}])},updateActiveCriteriaAfterNlsComputation:function(e,t,i,a){var r,l,c,d,g,u,h,p=this,f=!!i&&i instanceof D,m={},v={},T=0,C=i||this.observedNavImpl.getFocusedProxy(),w=i?f?i.getTaggerProxy()._navimpl:i._navimpl:this.observedNavImpl;if(g={widgetId:i?i.widgetId():C?w.getWidgetMaximized()||C:null,proxyId:C?C.id():void 0},w.activeCriteriaProxy&&w.activeSearchProxy||w.createActiveCriteria(),w.activeCriteriaProxy&&w.activeSearchProxy){if(e){for(c in u={},r=w.getFilters(null,!0,this._simplifiedTagger,!0).allfilters)(d=o.getPredicate(c.split("/").pop()))&&!u[c]&&(u[c]=d.displayName()),r[c]=r[c].map(function(e){T++;var t={predicate:c,object:e.object,dispValue:e.disptext,type:e.type};if(e.isComposite&&(t.isComposite=!0),this.getDOMId(JSON.stringify(t)),e.disptext!==e.object||"string"!==e.type)return e;var i=s.getTagValue(c,null,e.object,e.type);return e.disptext=i&&i.getDisplayValue()?i.getDisplayValue():e.disptext,e},this);v.allfilters=r;var b=w.getActiveGroupings();if(UWA.is(b,"array")&&(b.length>0||a)){let e=v.allgroupings=[];b.forEach(function(t){let i=t.predicate;(d=o.getPredicate(i.split("/").pop()))&&!u[c]&&(u[c]=d.displayName()),t.predLevel?e.push({dispText:d.displayName(),predicate:d.id(),type:d.getType(),isPredicate:!0}):t.object.forEach(function(t){e.push({dispText:t.dispText,predicate:d.id(),type:t.type})})})}if(C){if(l=C.getFilters(!0,this._simplifiedTagger,!0).localfilters,C.supportsAdvancedFilter()&&UWA.is(l.condition,"array"))l.isAdvanced=!0,l.condition.forEach(function(e){T++;var t=Object.keys(e)[0];(d=o.getPredicate(t.split("/").pop()))&&!u[t]&&(u[t]=d.displayName()),e[t].condition.forEach(function(i){var a={predicate:t,object:i.object,dispValue:i.display,type:i.type};e[t].isComplex&&(a.isComplex=!0),i.isComposite&&(a.isComposite=!0),p.getDOMId(JSON.stringify(a))})});else for(c in l)(d=o.getPredicate(c.split("/").pop()))&&!u[c]&&(u[c]=d.displayName()),l[c]=l[c].map(function(e){T++;var t={predicate:c,object:e.object,dispValue:e.disptext,type:e.type};if(e.isComposite&&(t.isComposite=!0),this.getDOMId(JSON.stringify(t)),e.disptext!==e.object||"string"!==e.type)return e;var i=s.getTagValue(c,null,e.object,e.type);return e.disptext=i&&i.getDisplayValue()?i.getDisplayValue():e.disptext,e},this);v.localfilters=l;b=C.getActiveGroupings();if(UWA.is(b,"array")&&(b.length>0||a)){let e=v.groupings=[];b.forEach(function(t){let i=t.predicate;(d=o.getPredicate(i.split("/").pop()))&&!u[c]&&(u[c]=d.displayName()),t.predLevel?e.push({dispText:d.displayName(),predicate:d.id(),type:d.getType(),isPredicate:!0}):t.object.forEach(function(t){e.push({dispText:t.dispText,predicate:d.id(),type:t.type})})})}}this.taggerIcon?this.taggerIcon.toggleClassName("tagger-filter",0!==T):window.richClient&&this.tagnavigator.hasEvent("changeTaggerIcon")&&this.tagnavigator.dispatchEvent("changeTaggerIcon",[{"tagger-filter":0!==T}]),g.isTagPinned=n.isTagPinned,g.canBeExcluded=function(e){return w.hasExcludeSupport(e)},w.activeCriteriaProxy.getInitPromise().then(function(){g.predicatesNLS=u,w.activeCriteriaProxy.setActiveCriteria(v,g)})}if(t&&!f){if(h={},C&&C.isActive()){if(C.supportsAdvancedFilter())m.isAdvanced=!0,m.search={},C.getFilters(!1).localfilters.condition.forEach(function(e){var t=Object.keys(e)[0];m.search[t]=[],e[t].forEach(function(e){m.search[t].push({type:e.type,object:e.object,displayValue:e.displayValue,isSimplifiedCriteria:e.isSimplifiedCriteria})})});else m.search=C.getFilters(!1).localfilters;C.getParameters()&&(m.plmparam=C.getParameters()._models),Object.keys(m.search).forEach(function(e){var t=e.split("/").slice(-1)[0].replace("sixw:","");h[e]=o.getPredicate(t).displayName()})}w.activeSearchProxy.getInitPromise().then(function(){g.predicatesNLS=h,w.activeSearchProxy.setActiveCriteria(m,g)})}}},updateGroupings:function(){var e=this.hasFocusedProxy();if(e){var t=e.getGroupingConfig();if(t&&!t.disableGroupingUpdate)e.getActiveGroupings().length>0&&(e.supportsEmbeddedView()||this.actionManager.startAction({action:F.ACTION_GROUP,isInteractive:!1,refreshMode:!0}))}},setActiveCriteria:function(e,t,a,n){var r=this;return new i(function(s){i.all(o.getElementsNLS()).then(function(){r.updateActiveCriteriaAfterNlsComputation(e,t,a,n),s()})})},redrawActiveCriteria:function(e){var t,i,a=0,n=this.observedNavImpl.getFocusedProxy(),r={widgetId:this.observedNavImpl.getWidgetMaximized(),proxyId:n?n._id:void 0};if(this.hasAdvancedFocsuedProxy(void 0,"editTagsRelationships")){this.simpleActiveCriteria&&this.simpleActiveCriteria.hide();let e=!1;this.observedNavImpl.hasProxiesInEdition()&&(e=!0),this.redrawActiveTagsEdit(e)}else{var s=n&&n.hasCusomActiveTags()?n.getActiveTagsOptions():void 0;s&&s.display&&(r.headerTitle=s.sectionName,r.withoutPredHeader=s.display.withoutPred,r.onePerLine=s.display.onePerLine,r.withRootIcon=s.display.withRootIcon),this.activeTagsEditView&&!this.activeTagsEditView.container.isHidden()&&this.activeTagsEditView.container.hide(),this.simpleActiveCriteria&&this.simpleActiveCriteria.isHidden()&&this.simpleActiveCriteria.show(),this.observedNavImpl.activeCriteriaProxy&&this.observedNavImpl.activeSearchProxy||this.observedNavImpl.createActiveCriteria(),e?this.observedNavImpl.activeCriteriaProxy.redrawCriteria(r):this.observedNavImpl.activeSearchProxy.redrawCriteria(r),(this.taggerIcon||window.richClient&&this.tagnavigator.hasEvent("changeTaggerIcon"))&&(t=this.observedNavImpl.getFilters(null,!0).allfilters,a+=Object.keys(t).reduce(function(e,i){return e+t[i].length},0),n&&(i=n.getFilters(!0).localfilters,n.supportsAdvancedFilter()&&UWA.is(i.condition,"array")?a+=i.condition.length:a+=Object.keys(i).reduce(function(e,t){return e+i[t].length},0)),this.taggerIcon?this.taggerIcon.toggleClassName("tagger-filter",0!==a):window.richClient&&this.tagnavigator.hasEvent("changeTaggerIcon")&&this.tagnavigator.dispatchEvent("changeTaggerIcon",[{"tagger-filter":0!==a}]))}},redrawActiveTagsEdit:function(e){var t=this.hasAdvancedFocsuedProxy(void 0,"editTagsRelationships"),i=t.getLocalFilter().cloneFilter(),a=t._groupings;this.activeTagsEditView||this.createActiveTagsView(),this.activeTagsEditView&&(this.activeTagsEditView.setAdvancedFilter(i,a),this.activeTagsEditView.disableEditView(e)),this.activeTagsViewModel&&"readOnly"!=this.activeTagsViewModel.get("mode")&&this.activeTagsViewModel.set("mode","readOnly")},editActionStart:function(){this.toggleActiveTagsMode()},toggleActiveTagsMode:function(){this.activeTagsEditView||this.createActiveTagsView(),"readOnly"==this.activeTagsViewModel.get("mode")?this.activeTagsViewModel.set("mode","writeable"):(this.activeTagsViewModel.set("mode","readOnly"),this.cancelEditAction()),this.removeOpacity()},cancelEditAction:function(e){this.actionCancel()},showTaggerCrietria:function(){this.advancedActiveCriteria.show()},createActiveTagsView:function(){var e=this.hasAdvancedFocsuedProxy(void 0,"editTagsRelationships");e&&(this.activeTagsEditView||(this.activeTagsEditView=e.getActiveTagsEditView()),this.activeTagsViewModel||(this.activeTagsViewModel=e.getActiveTagsEditModel()),this.activeTagsEditView&&(this.actionManager&&this.activeTagsEditView.setActionsManager(this.actionManager),this.activeTagsEditView.addEvent("closeSelectedTags",this.cancelEditAction.bind(this)),this.activeTagsEditView.addEvent("showTaggerCriteria",this.showTaggerCrietria.bind(this)),this.activeTagsEditView.addEvent("clickOnTrash",this.clearActiveTags.bind(this)),this.activeTagsEditView.addEvent("removeTagFromActive",this._onEditTagsRefine.bind(this)),this.activeTagsEditView.addEvent("removeSelectedElems",this.removeSelectedElems.bind(this)),this.activeTagsEditView.container.inject(this.advancedActiveCriteria),this.showTaggerCrietria()))},_onEditTagsRefine:function(){var e=this.hasAdvancedFocsuedProxy(void 0,"editTagsRelationships");if(e){var t=this.activeTagsEditView.advanceFilter.cloneFilter();e.setClonedFilter(t),this.observedNavImpl.onRefine(),this.activeTagsEditView.hasActiveGroupings()?e.groupBy(this.activeTagsEditView.activeGroupings):e._groupings.clear();let i=this.activeTagsEditView.modifiedFromUI;for(let e in i)M.publish({channel:"TaggerTrackerApi",topic:"hit",data:{category:"6WTagger",action:"OperatorChangeForPredicate",persDim:{pd1:e}}})}this.activeTagsViewModel.set("mode","readOnly")},callUpdateModelOnActiveActions:function(e){this.hasAdvancedFocsuedProxy(void 0,"editTagsRelationships")&&this.activeTagsEditView.callUpdateModelFromAction(e)},disableType:function(e){let t=this.taggerRoot.getElement(".category-view");"start"==e?t&&t.addClassName("disable-click"):"cancel"!=e&&"launch"!=e||t&&t.removeClassName("disable-click")},removeSelectedElems:function(e){if(e){if(e.tagName&&e.predicate){let t=this.taggerUWAElement.getElement("li.predicate[predicate='"+e.predicate+"']");if(t){t.getElements(".tag-label").forEach(t=>{t.getText()==e.tagName&&(t.getClosest(".tag").hasClassName("selected")||t.getClosest(".tag").hasClassName("picked")?(t.getClosest(".tag").removeClassName("selected"),t.getClosest(".tag").removeClassName("picked")):t.getClosest(".people-selected").removeClassName("people-selected"))})}}}else{let e=this.taggerUWAElement.getElements(".tag.selected");e.forEach(e=>{e.removeClassName("selected")}),(e=this.taggerUWAElement.getElements(".people-selected")).forEach(e=>{e.removeClassName("people-selected")})}},_firstVisibility:!0,forceRedraw:function(){var e=this.hasFocusedProxy();return e&&e.hasActiveGroupings()},_redraw:function(){var t=this.observedNavImpl.getCache();if(this.visibility||this.forceRedraw()){this._firstVisibility&&(this._firstVisibility=!1,this._simplifiedTagger&&this.getActiveRootW().length>1&&(this._enabledAllwMode=!0));var a,n,r,l,c=this;this.internalRedrawTimer&&(clearTimeout(this.internalRedrawTimer),this.internalRedrawTimer=null),0===Object.keys(o.getElementsToTranslate()).length&&0===Object.keys(o.getPendingPromisesForElementsToTranslate()).length&&0===Object.keys(s.getTvToTranslate()).length&&0===Object.keys(s.getOntologyTvToTranslate()).length&&0===D.getSubjectsForExplicitTags().length||!1!==this.callServerInProgress||(a=o.getElementsNLS(),n=s.getPredicateValue(),l=s.translateOntologyTagValues(),r=D.getExplicitTags(),this.callServerInProgress=!0,i.all(a.concat(n).concat(r).concat(l)).then(function(e){D.clearProxiesTemp(),c.callServerInProgress=!1,c.redraw()})),this.destroyTagValues(),this.selectedTags=[],t&&"criteria"===t.selectedTab?("criteria"!==this.tabView.selectedTab.getName()&&this.displayCriteria(),this.internalRedrawTimer=setTimeout(this.redrawCriteria.bind(this),50),this.observedNavImpl.getFocusedProxy()&&this.hasAdvancedFocsuedProxy(void 0,"editTagsRelationships")):("tags"!==this.tabView.selectedTab.getName()&&this.displayTags(),this.internalRedrawTimer=setTimeout(function(){var e=this.redrawTags();e&&this._simplifiedTagger&&(O.getOption("disableGroupingUpdate")||"setTags"===this.redrawTriggeredBy&&(this.redrawTriggeredBy=void 0,e.then(function(){this.updateGroupings()}.bind(this))))}.bind(this),50))}else if(this.isColorizePossible()&&t.colorManager.activePredicate)this.destroyTagValues(),this.buildTagValues(),this.availableTagsToHtml(),this.redrawActiveCriteria(!0);else{var d=document.getElementById("data-filter-panel-ct");d&&UWA.is(d.isHidden,"function")&&!1===d.isHidden()&&e.extendElement(document.body).getElements(".column.left.shown").length>0&&(console.warn("tagger is hidden but filters panel is visible, so forcing the active criteria redraw"),this.redrawActiveCriteria(!0,!0))}},removeLoadMoreTagsView:function(){this.loadMoreTagsView&&this.loadMoreTagsView.destroy(),this.loadMoreTagsView=null},createLoadMoreTagsView:function(){return this.loadMoreTagsView||(this.loadMoreTagsView=new L({taggerView:this}),this.loadMoreTagsView.render().inject(this.tagContainer),this.loadMoreTagsView&&this.loadMoreTagsView.addEvent("tnLoadMoreTagsClick",this.onLoadMoreTagsClick.bind(this))),this.loadMoreTagsView},onLoadMoreTagsClick:function(){this.setSpinner(),this.observedNavImpl.dispatchLoadMoreTagsToProxies()},redraw:function(){if(!this._ignoreRedraw){var e=this;this._viewInitializationPromise.then(function(){e._redraw()},function(){e._redraw()})}},redrawParameters:function(){var t,i,a,n=this,s=this.observedNavImpl.getCache(),o=this.observedNavImpl.getFocusedProxy();if((null!==o&&o.isPLMParameterEnabled()&&(null!==(t=o.getParameters())&&(t.hasEvent("onAdd")||t.addEvent("onAdd",function(e){n.parameterView.render(e)}),t.hasEvent("onRemove")||t.addEvent("onRemove",function(e){r.checkActiveSearch(n)})),this.paramWarning||(this.paramWarning=e.createElement("div",{id:"paramWarning"})),this.parametersText||(this.parametersText=new y({id:"parameter-input-field",placeholder:g.getText("paramAutocomplete")}))),this.parametersText)&&(this.parametersText.remove(),i=this.criteriaContainer.getElement("#parameters-parent-container"),a=this.criteriaContainer.getElement("#parameters-input-container"),e.is(i)&&e.is(a))){this.parametersText.inject(a);e.createElement("span",{class:"add-tag-magnifier-param fonticon fonticon-search"}).inject(a);if(this.parameterView=new h({model:u,container:i,taggerView:n}),null!==o&&null!==(t=o.getParameters())){if(this.criteriaContainer.getElement("#parameter-list")&&s.getCriteriaToResetBeforeFilterChange(o.id())){var l=!1,c=s.getCriteriaToResetBeforeFilterChange(o.id())["ds6w:dataSource"];c&&c.value&&c.value.length>0&&(l=c&&c.value&&c.value.some(function(e){return"3dspace"===e.value})),l?(n.parametersText.enable(),n.parameterView.disabled=!1):(n.parametersText.disable(),n.parameterView.disabled=!0)}t.forEach(function(e){n.parameterView.render(e)})}}},redrawCriteria:function(){if(this.visibility&&this.tabView&&"criteria"===this.tabView.selectedTab.getName()){var e=this,t=function(){m.unmask(this.taggerRoot),this.redrawActiveCriteria(!1),this.taggerRoot.toggleClassName("edition_mode",!1),this.searchButton.remove(),this.criteriaContainer.getElement("#all-criteria").innerHTML=this.getCriteriaToHtml(),this.searchButton.inject(this.criteriaContainer.getElement("#search-button-container")),l.redrawUiElements(!0),this.redrawParameters(),setTimeout(this.updateScroller.bind(this,!0),50)};if(0!==Object.keys(o.getElementsToTranslate()).length||0!==Object.keys(o.getPendingPromisesForElementsToTranslate()).length){A.info("found some predicates to be translated, redraw adv criteria only after nls is retrieved");var a=o.getElementsNLS();i.all(a).then(function(i){A.info("redraw the Criteria as nls is now retrieved"),t.call(e)})}else t.call(this)}},getViewMoreStatus:function(){return this._viewMoreStatus},updateActiveTagsArea:function(){this.redrawActiveCriteria(!0),this.form?this.simplifiedTaggerRoot.addClassName("border-change"):this.simplifiedTaggerRoot.removeClassName("border-change")},buildTagValues:function(e){this._simplifiedTagger&&(e?e.excludeHiddenPredicates=!0:e={excludeHiddenPredicates:!0}),this.observedNavImpl&&this.observedNavImpl.eachTagValue(function(e,t){return new d(e,this,t)}.bind(this),e),this._simplifiedTagger&&this.PersonUtils.getUsersInfo(this.observedNavImpl,"ds6w:who",function(){this.hasAdvancedFocsuedProxy(void 0,"data_location")&&this.redraw()}.bind(this))},destroyTagValues:function(){for(var e in c.clear(),l.clear(),G)c.getRootPredicateView(o.getPredicate(e),this)},redrawSimplifiedTags:function(e,t){return new i(function(a){if(this.visibility||this.forceRedraw()){var n=this;if(!this.observedNavImpl.isReadyForDisplay())return this.setSpinner(0),this;var r=n.observedNavImpl.hasProxiesInEdition();n.taggerRoot.toggleClassName("edition_mode",r),n.form&&(n.form.destroy(),n.form=null),r?n.userTagsView.redraw():n.userTagsView.clear(),e&&e.redrawActiveCriteria&&n.updateActiveTagsArea();var s={};e&&(e.onSearch||e.onRootWSelection||(s.abortAction=!0));let d=this.actionManager?this.actionManager.getCurrentAction():void 0;d&&d.id==F.ACTION_COLORIZE&&d.cancelColorize(),this.actionManager.redraw(s);var o=[],l={onSearch:e&&e.onSearch,searchString:e&&e.searchString};let g=n.observedNavImpl.hasPreferredPredicates();var c=!!(g&&g.length>0);n.preferredView.setAvailability(!0),n.preferredView.show(),l.excludePreferred=!0,o.push(n.preferredView.redraw(l,t)),i.all(o).then(function(){c||(n.preferredView.setAvailability(c),n.preferredView.hide(),n.allViewHeaderVisibility(!1),n.allContentView.expand()),n.allContentView.redraw(l,t),n.updateShowResults(),n.updateAllContentViewStatus(),a()}.bind(this))}}.bind(this))},updateAllContentViewStatus:function(){if(this.observedNavImpl.getProxiesHavingLoadMoreTagsPending().length)this.allViewHeaderVisibility(!1),this.allContentView.collapse(),this.createLoadMoreTagsView().show(!0),this.preferredView.isEmpty()&&(this.loadMoreTagsView.show(!1),this.allContentView.expand(!0));else{this.loadMoreTagsView&&this.loadMoreTagsView.show(!1);let e=this.observedNavImpl.getCache().getIsMoreTagsButtonClicked();this.preferredView.isEmpty()||this.allContentView.isEmpty()?(this.allViewHeaderVisibility(!1),this.preferredView.isEmpty()?this.allContentView.expand(!0):this.allContentView.collapse(!0)):(this.allViewHeaderVisibility(!0),e?(this.observedNavImpl.getCache().setIsMoreTagsButtonClicked(!1),this.allContentView.expand(!0)):this.allContentView.collapse()),this.preferredView.isEmpty()&&this.allContentView.isEmpty()||this.observedNavImpl.hasProxiesInEdition()?this.actionManager.initActionsView().container.hide():this.actionManager.initActionsView().container.show()}},onPreferredViewUpdate:function(){this.updateAllContentViewStatus()},redrawTags:function(){if(A.log("redrawTags called on: "+(new Date).getTime()),this._simplifiedTagger){this.dispatchEvent("redrawStatusUpdate",!0),this.buildTagValues();var e=[],t=!1,i="";return this.searchedString?(e=this.getRootWs(),t=!0,i=this.searchedString):e=this._simplifiedSelectedRootWs,this.redrawSimplifiedTags({redrawActiveCriteria:!0,redrawAllView:!0,onSearch:t,searchString:i},e).then(function(){m.isMasked(this.taggerRoot)&&m.unmask(this.taggerRoot),e.forEach(function(e){l.redrawUiElements(void 0,e)})}.bind(this))}var a=document.activeElement&&"taginput"===document.activeElement.id,n=this.observedNavImpl.getCache();if(this.visibility){if(m.unmask(this.taggerRoot),void 0===this.observedNavImpl)throw new Error("Unexpected rendering of TaggerView without an observed Tagger?!");if(!this.observedNavImpl.isReadyForDisplay())return this.setSpinner(0),this;this.buildTagValues(),this.redrawActiveCriteria(!0),this.globalSearchInput.inject(this.tabView.elements.contentNode.getElement("#tags-tab"),"top"),this.tagsContainer.getElement("#tags-var-height").innerHTML=this.availableTagsToHtml(),this.isW||this.displayNoTags(),this.taggerHeader.getElement(".tagger-filter").toggleClassName("selected",n&&n.isSearchVisible()),this.taggerRoot.toggleClassName("edition_mode",this.observedNavImpl.hasProxiesInEdition()),this.form&&(this.form.destroy(),this.form=null),this.observedNavImpl.hasProxiesInEdition()&&this.editionAreaToHtml(),this.redrawShowAll(),this.manageSortByPreference(),l.redrawUiElements();try{this.myNotificationControl.inject(this.taggerUWAElement.getElement(".tagnavheader"),"after")}catch(e){}try{v.dispatch(!0)}catch(e){}this.toggleSearchInput(null,a,!0),setTimeout(this.updateScroller.bind(this,!0),50)}return this},updateScrollOnHierarchyTags:function(){let e=this,t=new Set,i=this.observedNavImpl.getCache();(t=l.getListOfHierarchyPredicates()).forEach((t,a)=>{if(!i.isPredicateCollapsed(t)){let i=e.taggerRoot.getElement("li.predicate[predicate='"+t+"']"),a=i.getElement('.tag[level="5"]'),n=a?a.getClosest(".childrenTags").getElements(".tag"):[];if(n.length)for(let e=0;e<n.length;e++){let t=n[e];if("0px"==t.getClosest(".childrenTags").getStyle("height"))break;{let e=i.getElement(".predicate-content"),a=e.getDimensions().width;if((e=>e.offsetWidth<e.scrollWidth||e.offsetWidth!=e.scrollWidth&&void 0)(t.getElement(".tag-label"))){a="37em",e.setStyle("width",a);break}}}}})},redrawShowAll:function(){var e=this.observedNavImpl.getFocusedProxy();if(e&&e.relevantPredicates.length&&Object.keys(e._tagValuesMap).length){var t=!(!e||!e.relevantPredicates.length)&&e.showAllBool,i='<hr/><div class="show-all-toggle">'+g.getText(t?"showLess":"showAll")+"</div>";this.tagsContainer.getElement("#tagger-footer")&&(this.tagsContainer.getElement("#tagger-footer").setStyle("display","").innerHTML=i),this.isW?this.tagsContainer.getElement("#all-tags").toggleClassName("relevant-only",!e.showAllBool):this.tagsContainer.getElement(".predicates").toggleClassName("relevant-only",!e.showAllBool),this.tagsContainer.getElement("#all-tags").addClassName("remove-border"),this.isW||e.showAllBool||this.displayNoTags(!1,!0)}else this.tagsContainer.getElement("#tagger-footer")&&this.tagsContainer.getElement("#tagger-footer").setStyle("display","none"),this.tagsContainer.getElement("#all-tags")&&this.tagsContainer.getElement("#all-tags").removeClassName("remove-border")},updateScroller:function(e){if(!this._simplifiedTagger){var t,i,a,n,r,s,o,l=this.observedNavImpl.getFocusedProxy();if(e||(e=!1),e||this.visibility){if(t=this.taggerRoot.getDimensions().innerHeight-42+(this.observedNavImpl.getCache()&&this.observedNavImpl.getCache().isSearchVisible()?0:30),t-=this.taggerUWAElement.getElement("#active-tags").getDimensions().outerHeight,t-=this.taggerHeader.getDimensions().outerHeight,s=(o=l&&l.relevantPredicates.length&&Object.keys(l._tagValuesMap).length)?t-this.tagsContainer.getElement("#tagger-footer").getDimensions().outerHeight:Math.min(this.tagsContainer.getElement("#tags-var-height").getDimensions().height+5,t),"criteria"!==this.tabView.selectedTab.getName()||this.observedNavImpl.hasProxiesInEdition()?(i=this.tagsContainer,a=this.taggerScroller,n=k):(i=this.criteriaContainer,a=this.criteriaScroller,n=B),a&&(t!==n||e)&&(i.setStyle("height",t),n=t),"tags"===this.tabView.selectedTab.getName()){var c=this.getObservedNavigator().modifiedPredicate;c&&(a.scrollToElement("#"+this.getDOMId(c.getFullPredicateID())),this.getObservedNavigator().modifiedPredicate=null)}else i.getElement(".no-native-scrollbars")?i.getElement(".no-native-scrollbars").setStyle("height",n-40):i.getElement(".native-scrollbars")&&i.getElement(".native-scrollbars").setStyle("height",n-40),r=Math.max(n-40,i.getElement(".criteria-list")?i.getElement(".criteria-list").getDimensions().height+20:0),this.container.getElement("#all-criteria").setStyle("height",r);return this.tagsContainer.getElement(".scroller-content").setStyle("height",o?s:""),this.tagsContainer.getElement("#all-tags").setStyle("height",s),this}}},onSearchLaunch:function(){var e,t,i={},a=this.observedNavImpl.getCriteriaIdsMap();for(t in a)i[e=t.split("/").pop()]=l.getPredicateView(o.getPredicate(e),this);r.onSearchLaunch(this,i),this.setActiveCriteria(!1,!0)},onFreeInputDeletion:function(t){var i,a,n,s,l,c,d,g,u={};if(-1!==t.target.getClosest(".tag").id.indexOf("atv"))return this.observedNavImpl.activeSearchProxy.clickCriteriaEvent(t),!1;if(t.target.getClosest(".freeinput-predicate-list")){n=t.target.getClosest(".freeinput-predicate-list").getElement(".predicate").id,a=this.getIdFromDOMId(n),d=o.getPredicate(a.split("/").pop().replace("sixw:","")),l=this.getIdFromDOMId(t.target.getParent().id),"string"!==(i=d.getType())&&"boolean"!==i&&(u[c=!0===t.target.hasClassName("from")?"from":"to"]=l,l=u);var h=this.observedNavImpl.getFocusedProxy();if(!h)throw new Error("ERROR : TaggerView.onFreeInputDeletion is called when there is no focused proxy !!!");return g=this.observedNavImpl.getCache().getCriteriaToResetBeforeFilterChange(h?h.id():void 0),s=e.is(c)?g[d.id()][c].value:"boolean"===i?g[d.id()].value:g[d.id()].value.filter(function(e){return e.value!==l}).map(function(e){return e.value}),this.warnProxyOfCriteriaChange({sixw:d.getFullPredicateID(),value:s}),this.observedNavImpl.removeFreeInputs([{predicate:d,type:i,value:l}]),r.redrawUiElements(!0),!1}},deleteFreeInput:function(t){var i,a={},n=t.predicate,s=t.type;return i=o.getPredicate(n.split("/").pop().replace("sixw:","")),"string"!==s&&"boolean"!==s&&(t.dispValue=t.object),t.isSimplifiedCriteria&&(a.isSimplifiedCriteria=!0),e.extend(a,t.object),this.observedNavImpl.removeFreeInputs([{predicate:i,type:s,value:UWA.is(t.object,"object")?a:t.object}]),r.checkActiveSearch(this),this.onSearchLaunch(),!1},warnProxyOfCriteriaChange:function(e){this.observedNavImpl.getFocusedProxy()&&this.observedNavImpl.getFocusedProxy().warnForCriteriaChange(e)},onTagDeletion:function(e){var t,i,a,n;return t=(n=JSON.parse(this.getIdFromDOMId(e.target.getClosest(".tag").id))).predicate,i=n.object,a=o.getPredicate(t.split("/").pop()),!!(i.length&&i.length>0)&&(this.observedNavImpl.deleteTagValue(i,a),!1)},onTagCreation:function(e,t,i){var a={sixw:[t],type:"string"};try{this.observedNavImpl.createTagValue(e,new o(a),i)}catch(e){v.push(new Notification("Fail to create a predicate with invalid arg. Id is :'"+a.sixw[0]+"'")),v.dispatch()}},isSelected:function(e){return this.observedNavImpl.isSelected(e)},isExcluded:function(e){if(this.hasAdvancedFocsuedProxy(void 0,"editTagsRelationships"))return this.observedNavImpl.isExcluded(e)},getListOfSelectedTagValues:function(e){return this.observedNavImpl.getListOfSelectedTagValues(e)},getMoreLimitForPredicate:function(e){return this.observedNavImpl.getMoreLimitForPredicate(e)},getDOMId:function(e){var t,i,a=0;for(t=0,i=e.length;t<i;t++)a=(a<<5)-a+e[t].charCodeAt(0),a&=a;return a="id_"+a,this.DOMIdToId[a]=e,a},getIdFromDOMId:function(e){return this.DOMIdToId[e.replace("sug","")]},isProxyWithFilteringOnServer:function(){return!(!this.observedNavImpl||null===this.observedNavImpl.getFocusedProxy())&&this.observedNavImpl.getFocusedProxy().isFilteringOnServer()},hasFreeInputOnly:function(e){return!(!this.observedNavImpl||null===this.observedNavImpl.getFocusedProxy())&&this.observedNavImpl.hasFreeInputOnly(e)},hasFreeInputSupport:function(e){return!(!this.observedNavImpl||null===this.observedNavImpl.getFocusedProxy())&&this.observedNavImpl.hasFreeInputSupport(e)},hasGroupingSupport:function(e){return!!this.observedNavImpl&&this.observedNavImpl.hasGroupingSupport(e)},hasEmbeddedView:function(){return!(!this.observedNavImpl||null===this.observedNavImpl.getFocusedProxy())&&this.observedNavImpl.getFocusedProxy().supportsEmbeddedView()},isGroupedBy:function(e){return!!this.observedNavImpl&&this.observedNavImpl.isGroupedBy(e)},getExpandStatus:function(e){return!(!this.observedNavImpl||null===this.observedNavImpl.getFocusedProxy())&&this.observedNavImpl.getExpandStatus(e)},toggleParametersExpand:function(){var e=this.observedNavImpl.getCache();e.setParameterClicked(!e.getParameterClicked());var t=this.criteriaContainer.getElement("#parameters-parent-container");e.getParameterClicked()?(t.setStyle("visibility","inherit"),t.setStyle("height","auto")):(t.setStyle("visibility","hidden"),t.setStyle("height","0px"))},clickParameterMagnifier:function(e){this.parametersText&&this.parametersText.isDisabled()||"keydown"===e.type&&13!==e.keyCode||this.validateParameterTitle()},validateParameterTitle:function(e){var t=this.parametersText.getValue(),i=this.criteriaContainer.getElement("#parameters-input-container"),a=this.observedNavImpl.getFocusedProxy();i&&a&&(this.paramWarning.remove(),t.length<2?(this.paramWarning.innerHTML=g.getText("paramWarning1"),this.paramWarning.inject(i,"before"),this.parametersAutocomplete&&this.parametersAutocomplete.remove()):t.split(" ").every(function(e){return/[A-Za-z0-9]{2,}/.test(e)})?(m.mask(i),a.sendStringTypedForPLM(t)):(this.paramWarning.innerHTML=g.getText("wildcardWarning"),this.paramWarning.inject(i,"before"),this.parametersAutocomplete&&this.parametersAutocomplete.remove()))},editionAreaToHtml:function(){var t,i,a,n,r,s,o,l=[],c=[],d=[],u=this.observedNavImpl.getProxiesInEdition(),h=[],p=this.taggerUWAElement.getElement(".edit-section"),f=this;this.observedNavImpl.getCache();if(u.length){if(t=u[0].getCStorages(),i=u[0].getTagsServers(),a={},i)for(r in i)s=i[r],a[s.getTenantDisplayName()]=r;else for(r in t)s=t[r],a[s.getTenantDisplayName()]=r;if(f._simplifiedTagger)c.push({label:G["ds6w:where"],value:"ds6w:where"}),c.push({label:G["ds6w:what"],value:"ds6w:what"}),c.push({label:G["ds6w:when"],value:"ds6w:when"}),c.push({label:G["ds6w:who"],value:"ds6w:who"}),c.push({label:G["ds6w:how"],value:"ds6w:how"}),c.push({label:G["ds6w:why"],value:"ds6w:why"});else{for(n in G)d.push(new C({value:G[n],icon:"3ds-"+n.replace("ds6w:",""),className:"predicate-button",name:n,active:f.selectedPredicate===n}));c=new b({type:"radio",buttons:d,events:{onClick:function(e,t){f.selectedPredicate=t.options.name,V.getSuggestionsFromServers({tagsServers:i,tenants:f.selectedTenant,pred:f.selectedPredicate,autocomplete:f.form?f.form.getAutocompleteInput("autocomplete"):null})}}})}!u[0].hasPlatformData()&&i&&Object.keys(a).length>1?l=[{id:"tenant-list",type:"select",name:"platform",label:g.getText("platformName"),value:this.selectedTenantName||null,placeholder:g.getText("enterPlatformName"),options:Object.keys(a),required:!0,events:{onChange:function(){f.selectedTenantName=this.getValue(),f.selectedTenant=[a[this.getValue()[0]]],V.getSuggestionsFromServers({tagsServers:i,tenants:f.selectedTenant,pred:f.selectedPredicate,autocomplete:f.form?f.form.getAutocompleteInput("autocomplete"):null})}}}]:1===Object.keys(a).length&&(this.selectedTenant=[a[Object.keys(a)[0]]])}f._simplifiedTagger?(this.selectedPredicate=f.cacheForSimplified.getAddTagActiveW(),o={className:"predicate-buttons",id:"pred-buttons",type:"select",name:"predButtons",label:g.getText("selectW"),value:this.selectedPredicate,options:c,required:!0,events:{onChange:function(){f.selectedPredicate=this.getValue()[0],f.cacheForSimplified.setAddTagActiveW(f.selectedPredicate),V.getSuggestionsFromServers({tagsServers:i,tenants:f.selectedTenant,pred:f.selectedPredicate,autocomplete:f.form?f.form.getAutocompleteInput("autocomplete"):null})}}}):o={type:"text",className:"predicate-buttons"},h=[o,{type:"autocomplete",name:"autocomplete",allowFreeInput:!0,showSuggestsOnFocus:!0,label:g.getText("tagName"),placeholder:g.getText("enterTagName"),noResultsMessage:!1,typeDelayBeforeSearch:300,className:"tagger-autocomplete nv-autocomplete",required:!0,events:{onFocus:function(e){this.getSuggestions(this.elements.input.value)}}}],l.length&&(h=l.concat(h)),this.form=new T({className:"edit-tags-form expandable",fields:h,buttons:[{type:"submit",className:"create-tag-button primary",value:g.getText("createTag")}],events:{onSubmit:function(){var t=f.form.getAutocompleteInput("autocomplete").getSelection().value||f.form.getAutocompleteInput("autocomplete").getSelection();t&&(t!==e.String.unescapeHTML(t)&&(t=e.String.unescapeHTML(t),v.push(new Notification("For security reasons, your tag has been changed to "+t,{className:"warning"})),v.dispatch()),f.onTagCreation(t,f.selectedPredicate,f.selectedTenant))},onReset:function(){}}}),this.form.inject(p),this._simplifiedTagger||this.form.elements.container[l.length?1:0].getParent().setContent(c),this.selectedPredicate&&this.selectedTenant&&V.getSuggestionsFromServers({tagsServers:i,tenants:this.selectedTenant,pred:this.selectedPredicate,autocomplete:this.form?this.form.getAutocompleteInput("autocomplete"):null}),this._simplifiedTagger&&(4===this.form.elements.container.length?(this.form.elements.container[1].getParent().getParent().setStyles({width:"50%",float:"left"}),this.form.elements.container[2].getParent().getParent().getParent().setStyles({width:"50%",float:"right"})):(this.form.elements.container[0].getParent().getParent().setStyles({width:"50%",float:"left"}),this.form.elements.container[1].getParent().getParent().getParent().setStyles({width:"50%",float:"right"})),this.observedNavImpl.getCache().isSectionCollapsed("createTag")&&this.form.elements.container.setStyles({position:"absolute",height:"0px",overflow:"hidden"}))},tnHeaderToHtml:function(){var e;return e="<div id='edit-tags' data-rec-id='edit-tags'>",e+="<div class='edit-section'>",e+=this.sectionHeaderToHtml("createTag"),e+="</div></div>",e+="<div class='tagnavheader'>",e+="<div class='tn-header-title'>6WTags</span></div>",e+="<div class='search-header-title'>"+g.getText("suggestedTags")+"</span></div>",e+="<div class='show-all'></div>",e+="<div class='ds6w-button sort-6w'></div>",e+="<div class='ds6w-button tagger-filter'><span class='fonticon fonticon-search'></span></div>",O.getOption("simplifiedTagger")&&!O.getOption("WebInWin")&&(e+="<div class='ds6w-button activate-simplified'><span class='fonticon fonticon-cog'></span></div>"),e+="</div>"},availableTagsToHtml:function(e,t,i,a,n){var r=this,s="",o="",d=this.observedNavImpl.getCache(),u=this.observedNavImpl.getFocusedProxy();if(this.isW)s+=c.getRoots().map(function(e){return e.toHtml()}).join("");else{var h=this.observedNavImpl.getProxyPreferredSortOrder(),p=d.get6WSort(),f=h||p;if("sort-tag"===f)o+=c.getRoots().map(function(t){return r._simplifiedTagger&&e?t.id()===e?(A.log("convert the active root predicate view to html: "+t.id()),t.toHtml(void 0,void 0,void 0,void 0,f)):void 0:t.toHtml(void 0,void 0,void 0,void 0,f)}).join("");else{o+=l.getPredicates(f,t||(u?u.getPredicateInfo():null)).map(function(t){return function(t){if(!r._simplifiedTagger||!e)return t.toHtml(null,null,null,d.getSearchValue,f);var a=t.getPredicate();return i&&-1!==i.indexOf(a.id())&&/*!predicate.is6WRoot() &&*/a.get6WRootFather().id()===e?t.toHtml(null,null,null,d.getSearchValue,f):i?void 0:n&&-1!==n.indexOf(a.id())||/*!predicate.is6WRoot() &&*/a.get6WRootFather().id()!==e?"":t.toHtml(null,null,null,d.getSearchValue,f)}(t)}).join("")}s+="<ul class='predicates allw'>",s+=o||(a?"":"<div class='no-tags'>"+g.getText("noTags")+"</div>"),s+="</ul>",this.updateSortPred(f)}return s},sectionHeaderToHtml:function(e,t){var i="";return i+="<div class='section-header'>",i+="<div class='header-title' id='"+(e=e||"")+"'>",i+="createTag"!==e||this._simplifiedTagger?"<div class='arrow'><span class='fonticon fonticon-down-dir'></span><span class='fonticon fonticon-right-dir'></span></div>":"",i+=t&&t.isw?"<span class='fonticon fonticon-3ds-"+e+"'></span>":"",i+=(t&&t.isw?e.replace(/^\w/,function(e){return e.toUpperCase()}):g.getText(e))+"</div>",t&&t.isw&&t.count>=0&&(i+="<span class='tagger-filter fonticon fonticon-search section-header-left'></span>",i+="<span class='root-count section-header-left'>"+t.count+"</span>"),i+="</div>",t&&t.isw&&(i+="<div id='filter-"+e+"' class='add-tag-cont' style='overflow: hidden; height: 0px;'>",i+="<span class='add-tag-close'><span class='fonticon fonticon-cancel-circled'></span></span><input id='taginput' class='tagger-input searchbox' title='",i+=g.getText("searchTag")+"' placeholder='"+g.getText("searchTag")+"'/>",i+="</div>"),i},getActiveParametersToHtml:function(){var e="",t=this.observedNavImpl.getFocusedProxy().getParameters();return t&&t.forEach(function(t){var i=function(e){var t="<ul class='freeinput-predicate-list'>";return t+="<li class='predicate expanded selected  ds6w_'>",t+="<div class='predicate-header'>",t+="<div class='predicate-label'>"+e+"</div>",t+="</div>"},a=function(e,t,i){var a="";return"string"===e||"boolean"===e?(a+="<li class='parameter selected tag' title='"+i+"'>",a+="<div class='parameter tag-label' id='"+t+"'>"+i+"</div>",a+="</li>"):i.forEach(function(e){var i,n,r,s=e.fromVal,o=e.toVal;null===s&&null===o||(n=(i=e.rangeContainer&&e.rangeContainer.hasChildNodes()?e.rangeContainer.getElement(".form-control"):null)?i.value:"",r=g.getText("paramIntType"+n),a+="<li class='param-range-label'>"+r+"</li>",null!==s&&(a+="<li class='parameter selected tag' title='"+s+"'>",a+="<div class='tag-label from' id='"+t+"' rangeval='"+n+"' fromto='from'>"+g.getText("from")+":"+s+"</div>",a+="</li>"),null!==o&&(a+="<li class='parameter selected tag' title='"+o+"'>",a+="<div class='tag-label to' id='"+t+"' rangeval='"+n+"' fromto='to'>"+g.getText("to")+":"+o+"</div>",a+="</li>"))}),a.length>0&&(a+="</ul></li>"),a},n=t.get("type");if("string"===n){var r=t.get("stringVal");r.length>0&&(e+=i(t.get("value")),e+=a(n,t.cid,r))}else if("boolean"===n){var s=t.get("boolVal");s.length>0&&""!==s[0]&&(s="1"===s[0]?g.getText("yes"):g.getText("no"),e+=i(t.get("value")),e+=a(n,t.cid,s))}else{var o=t.get("intType");if(null!==o){var l=a(n,t.cid,o);l.length>0&&(e+=i(t.get("value")),e+=l)}}e+="</ul></li>"}),e},onToggleParamTagSelection:function(e){var t=this,i=e.target.getAttribute("id");return this.observedNavImpl.getFocusedProxy().getParameters().forEach(function(a){if(i===a.cid){var n=a.get("type");if("string"===n)a.set({stringVal:""});else if("boolean"===n)a.set({boolVal:[]});else{var r=a.get("intType"),s=e.target.getAttribute("rangeval");r.forEach(function(t){(t.rangeContainer&&t.rangeContainer.hasChildNodes()?t.rangeContainer.getElement(".form-control"):null).value===s&&("from"===e.target.getAttribute("fromto")?t.fromVal=null:t.toVal=null)})}t.observedNavImpl.getFocusedProxy().onRefine()}}),this.setActiveCriteria(!1,!0),!1},getCriteriaToHtml:function(){var e,t,i=this.observedNavImpl.getCache(),a=this.observedNavImpl.getCriteriaIdsMap(),n="<ul class='criteria-list'>",r=this.observedNavImpl.getFocusedProxy();if(Object.keys(a).length){for(e in a)t=o.getPredicate(e.split("/").pop()),l.getPredicateView(t,this),n+=l.getPredicateView(t,this).toHtml(null,!1,!0);r&&r.getMoreCountProxy()>0&&(this.criteriaContainer.getElement("#criteria-toggle-container").innerHTML="<div class='criteria-toggle' nb-more="+r.getMoreCountProxy()+">"+(i.isMoreClicked()?g.getText("lessCriteria"):g.getText("moreCriteria"))+" ["+r.getMoreCountProxy()+"]</div>"),null!==r&&r.isPLMParameterEnabled()&&(0===r.getMoreCountProxy()||i.isMoreClicked())&&(i.setParameterClicked(!0),n+="<hr/> <li id='parameter-list'><div class='parameters-toggle'>"+g.getText("paramTitle")+"</div>",n+="<div id='parameters-parent-container' style='visibility:inherit; height:auto'>",n+="<div id='parameters-input-container' style='display:inline-block; width:100%; position:relative;'></div></div>")}return n+="</ul>"},displayCriteria:function(e){this.observedNavImpl.getFocusedProxy()&&"criteria"!==this.tabView.selectedTab.getName()&&"criteria"!==this.tabView.selectedTab?(this.tabView.selectTab("criteria-tab"),this.actionManager&&this.actionManager.initActionsView().container.hide(),this.redrawTopBarTagIcon()):A.info("Cannot display adv search, the widget is not maximized"),this.visibility||!1===e||this.openTagger()},displayTags:function(e){(this.visibility||!1!==e)&&(this.tabView&&"tags"!==this.tabView.selectedTab&&(this.tabView.selectTab("tags-tab"),this.actionManager&&this.actionManager.initActionsView().container.show(),this.redrawTopBarTagIcon()),this.visibility||!1===e||this.openTagger())},updatePLMSuggestions:function(e){var t,i=this,a=this.criteriaContainer.getElement("#parameters-input-container"),n=this.observedNavImpl.getFocusedProxy();if(t=n.getParameters(),a&&this.paramWarning){if(this.parametersAutocomplete&&this.parametersAutocomplete.destroy(),this.parametersAutocomplete=new I({showSuggestsOnFocus:!0,events:{onSelect:function(e){if(null!==e&&e.selected&&i.paramWarning)if(this.reset(),i.paramWarning.remove(),t.appendParameter(new u({value:e.title||e.value,interface:e.subLabel,unit:e.unit,type:e.type,displayValue:e.value||e.title})))this.dispatchEvent("onClickOutside");else{var a=i.criteriaContainer.getElement("#parameters-input-container");a&&(i.paramWarning.innerHTML=g.getText("paramWarning3"),i.paramWarning.inject(a,"before"))}}}}),this.paramWarning.remove(),e.items.length<1)this.paramWarning.innerHTML=g.getText("paramWarning2")+" '"+e.name+"'",this.paramWarning.inject(a,"before");else{this.parametersAutocomplete.inject(a),this.parametersAutocomplete.addDataset(e),this.parametersAutocomplete.showAll();var r=e.hasMore?g.getText("paramPlaceholder1"):e.items.length+" "+g.getText("paramPlaceholder2");this.parametersAutocomplete.options.placeholder=r,this.parametersAutocomplete.defaultOptions.placeholder=r,this.parametersAutocomplete.elements.input.placeholder=r,this.parametersAutocomplete.elements.input.setAttribute("placeholder",r)}m.unmask(a)}},updateSuggestions:function(t){var i=e.is(t.suggestField,"string")?o.getPredicate(t.suggestField.split("/").pop()):null,a=i?l.getPredicateView(i,this):null;a&&a.updateSuggestions(t.datasets)},buildTypeToggleElem:function(t){var i=e.createElement("div",{class:"show-more-container",id:"typePredicateViewToggle",html:[{tag:"div",class:"show-more type-show-more",text:t.text}]});return i.setAttribute("viewMode",t.viewMode),i},onTypePredicateViewToggle:function(e){var t=e.target.getClosest("#typePredicateViewToggle").getAttribute("viewMode"),i=e.target.getClosest("li[predicate='ds6w:type']"),a=this.getCacheSimplified(),n={channel:"TaggerTrackerApi",topic:"hit",data:{category:"6WTagger",action:"TypeCategoryViewSwitch",persDim:{pd1:"category"}}};if("category"==t?(a.setViewMode("ds6w:type","tag"),n.data.persDim.pd1="tag"):a.setViewMode("ds6w:type","category"),M.publish(n),this.redrawPredicate(i.id),"tag"==t){var r=this.actionManager?this.actionManager.getCurrentAction():void 0;r&&r.id==F.ACTION_EDITTAGREL&&this.disableType("start")}},getAvailableActions:function(){var e=[];return this.observedNavImpl.hasProxiesInEdition()?A.log("No actions available during edition mode"):this.observedNavImpl.getProxiesToDisplay().length>0&&(this.hasGroupingSupport()&&!this.hasEmbeddedView()&&e.push({text:g.getText(F.ACTION_GROUP),fonticon:"group",id:F.ACTION_GROUP}),this.observedNavImpl.hasSelectInAppSupport()&&e.push({text:g.getText(F.ACTION_SELECTINAPP),fonticon:"doc-select ",id:F.ACTION_SELECTINAPP}),this.isColorizePossible()&&e.push({text:g.getText(F.ACTION_COLORIZE),fonticon:"palette",id:F.ACTION_COLORIZE}),this.observedNavImpl.hasExcludeSupport()&&!this.hasAdvancedFocsuedProxy(void 0,"editTagsRelationships")&&e.push({text:g.getText(F.ACTION_EXCLUDE),fonticon:"block",id:F.ACTION_EXCLUDE}),this.hasAdvancedFocsuedProxy(void 0,"editTagsRelationships")&&e.push({text:g.getText("editTagPen"),fonticon:"pencil",id:F.ACTION_EDITTAGREL}),e.push({text:g.getText("multi_Tag_Refine"),fonticon:"filter-select-on",id:F.ACTION_SELECT})),e}})}),define("DS/TagNavigator/TagNavigator",["UWA/Core","UWA/Class","UWA/Promise","UWA/Class/Events","UWA/Utils/InterCom","DS/TagNavigator/TagNavigatorManager","DS/TagNavigator/TagNavigatorManagerImpl","DS/TagNavigator/TaggerView","DS/TagNavigator/Logger","DS/TagNavigator/LoggerUX","DS/TagNavigator/TagsServer","DS/TagNavigator/TaggerNLS","DS/TagNavigator/UserSettings","DS/TagNavigator/TaggerSettings"],function(e,t,i,a,n,r,s,o,l,c,d,g,u,h){"use strict";var p,f,m,v,T=s.allProxiesMap,C={},w={},b=null,y=null,S=null,E=!1;function I(e){if(e&&e.origin)return e.origin.socket;l.warn("Could not get proxy ID, socket not defined.")}p=t.extend(a,{init:function(){var t=this;t.view=null;var i={},a=window.location.search.substring(1);if(a){for(var n=a.split("&"),c=0;c<n.length;c++){var p=n[c].split("=");1==p.length?i[p[0]]=!0:2==p.length&&p[0].length>0&&(i[p[0]]=p[1])}h.urlSettings(i)}var m=h.getOption("preciseTagsCount");UWA.is(m,"boolean")&&(g.preciseCount_global=m),this.create6WTaggerView=function(i,a,n,r){var c;return l.group("TagNavigator::create6WTaggerView"),l.info("Options : ",n),l.groupEnd("TagNavigator::create6WTaggerView"),(c=null===t.view)&&(e.is(n,"object")&&this.addEvents(n),t.view=new o(new s(null!==i&&i.id()),a,t,f,y,S,r),N.resolve()),c},this.addEvents=function(e){for(var i in e)t.addEvent(i,e[i])},this.toggle6WTaggerViewVisibility=function(e){t.view&&t.view.toggleVisibility(e)},this.get6WTaggerViewVisibility=function(){return!(!t.view||!t.view.visibility)&&t.view.tabView.selectedTab.getName()},this.get6WTagger=function(e){var t;t=null;try{t=new r(new s(e,E,b,{tagServers:C}))}catch(e){l.error(e.message)}return t},this.setDefault6WTagsServicesURL=function(e,t){return l.log("depreacted: please use set6WTaggerOptions"),t||(t={}),this.set6WTaggerOptions({tagsServerUrl:e,tagsServerUrlParams:t})},this.set6WTaggerOptions=function(t){l.group("TagNavigator::set6WTaggerOptions"),l.info("Options : ",t),l.groupEnd("TagNavigator::set6WTaggerOptions");var i,a,n,r,o,c,p,m=0;if(!e.is(t,"object"))throw new Error("Invalid Input arguments");if(t.lang?g.setCurrentLanguage(t.lang.substr(0,2)):window.dsLang?g.setCurrentLanguage(window.dsLang.substr(0,2)):null!==(window.App?window.App.lang:null)&&g.setCurrentLanguage(window.App.lang.substr(0,2)),"3DDashboard"===t.brand?E=!0:t.webInWin&&(window.richClient=!0),s._brand=t.brand,t.startupParams)if(i=t.startupParams,t.startupParams.cstorage=t.startupParams.cstorage.filter(function(e){return e.url&&""!==e.url}),t.startupParams.tagger=t.startupParams.tagger.filter(function(e){return e.url&&""!==e.url}),!E&&t.tenant){for(m=0;m<i.cstorage.length;m++)if(i.cstorage[m].id===t.tenant){r=i.cstorage[m].url,c=i.cstorage[m].id,p=i.cstorage[m].displayName,a=new d(r,c,p),w[c]=a,w._default=a;break}for(m=0;m<i.tagger.length;m++)if(i.tagger[m].id===t.tenant){o=i.tagger[m].url,c=i.tagger[m].id,p=i.tagger[m].displayName,n=new d(o,c,p),C[c]=n,C._default=n;break}}else{if(!E&&!t.tenant)throw new Error("Error: standalone env, a tenant should be given to the Tagnavigator");for(m=0;m<i.cstorage.length;m++)r=i.cstorage[m].url,c=i.cstorage[m].id,p=i.cstorage[m].displayName,a=new d(r,c,p),w[c]=a;for(i.tagger&&0!==i.tagger.length||(i.tagger=i.cstorage),m=0;m<i.tagger.length;m++)o=i.tagger[m].url,c=i.tagger[m].id,p=i.tagger[m].displayName,n=new d(o,c,p),C[c]=n}else t.cStorageService?(c=t.tenant||null,a=new d(t.cStorageService,c),w._default=a,c&&(w[c]=a)):(t.tagsServicesURL||t.tagsServerUrl)&&(o=t.tagsServicesURL||t.tagsServerUrl,c=t.tenant||(t.tagsServicesURLQueryParams?t.tagsServicesURLQueryParams.tenant:null)||(t.tagsServerUrlParams?t.tagsServerUrlParams.tenant:null),n=new d(o,c),w._default=n,c&&(w[c]=n));t&&t.getContextIdFromWidgetId&&"function"==typeof t.getContextIdFromWidgetId&&(b=t.getContextIdFromWidgetId),t&&t.displayFilteredState&&"function"==typeof t.displayFilteredState&&(y=t.displayFilteredState),t&&UWA.is(t.isAuthenticated,"function")&&!t.isAuthenticated()&&(h.getOption("legacy6W")||sessionStorage.getItem("legacy6W")||!1===h.getOption("offline6W")||h.setOption("offline6W",!0)),t.taggerIconId&&(S=t.taggerIconId),t.myAppsBaseUrl&&(f=u.init(t.myAppsBaseUrl))}},_executeProxyAPI:function(e,t,i){var a=T[i];a?A[e](a,t):_(i,e,t)},_setTags:function(e,t){this._executeProxyAPI("setTags",e,t)},_unsetTags:function(e,t){this._executeProxyAPI("unsetTags",e,t)},_setSubjectsTags:function(e,t){this._executeProxyAPI("setSubjectsTags",e,t)},_focusOnSubjects:function(e,t){this._executeProxyAPI("focusOnSubjects",e,t)},_unfocus:function(e,t){this._executeProxyAPI("unfocus",e,t)}}),m=new p,c.start(),l.log("TagNavigator - init of intercom server"),v=new n.Server("com.ds.tagger6w",{isPublic:!1});var x=[],_=function(e,t,i){var a=x.findIndex(function(t){return t.id==e}),n=-1!==a?x[a]:void 0;n||(n={id:e,calls:[]},x.push(n)),l.warn("stacking a proxy call, "+t),n.calls.push({id:t,data:i})},A={};A.setTags=function(e,t){e.setTags(t.tagsdata,t.summaryData,t.options)},v.addListener("setTags",function(e,t){var i=T[I(t)];i?A.setTags(i,e):_(I(t),"setTags",e)}),v.addListener("setEmbeddedViewProperties",function(e,t){T[I(t)].setEmbeddedViewProperties(e)}),v.addListener("addSubjects",function(e,t){T[I(t)].addSubjects(e.tagsdata)}),v.addListener("setCriteria",function(e,t){T[I(t)].setCriteria(e.criteria)}),v.addListener("updateCriteria",function(e,t){T[I(t)].updateCriteria(e.criteria)}),v.addListener("removeCriteria",function(e,t){T[I(t)].removeCriteria(e.criteria)}),A.setSubjectsTags=function(e,t){e.setSubjectsTags(t)},v.addListener("setSubjectsTags",function(e,t){var i=T[I(t)];i?A.setSubjectsTags(i,e):_(I(t),"setSubjectsTags",e)}),v.addListener("addSubjectsTags",function(e,t){T[I(t)].addSubjectsTags(e)}),v.addListener("die",function(e,t){var i=I(t),a=T[i];a&&a.isAlive()&&a.die(),v.dispatchEvent("isDead",null,null,[i])}),A.activate=function(e,t){e.activate(t),m.view.setActiveCriteria(!0,!0)},v.addListener("activate",function(e,t){var i=T[I(t)];i?A.activate(i,e):_(I(t),"activate",e)}),A.deactivate=function(e,t){e.deactivate(t),m.view.setActiveCriteria(!0,!0)},v.addListener("deactivate",function(e,t){var i=T[I(t)];i?A.deactivate(i,e):_(I(t),"deactivate",e)}),A.focusOnSubjects=function(e,t){e.focusOnSubjects(t.subjectsURI,t.persistTags,t.dataSources,t.options)},v.addListener("focusOnSubjects",function(e,t){var i=T[I(t)];i?A.focusOnSubjects(i,e):_(I(t),"focusOnSubjects",e)}),A.unfocus=function(e,t){e.unfocus()},v.addListener("unfocus",function(e,t){var i=T[I(t)];i?A.unfocus(i,e):_(I(t),"unfocus",e)}),A.unsetTags=function(e){e.unsetTags()},v.addListener("unsetTags",function(e,t){var i=T[I(t)];i?A.unsetTags(i):_(I(t),"unsetTags",e)}),v.addListener("toggleProxyFocus",function(e,t){T[I(t)].toggleProxyFocus(e.focusStatus)}),A.clearLocalFilter=function(e,t){e.clearLocalFilter(!!t&&t.refine),m.view.setActiveCriteria(!0,!0,e)},v.addListener("clearLocalFilter",function(e,t){var i=T[I(t)];i?A.clearLocalFilter(i,e):_(I(t),"clearLocalFilter",e)}),v.addListener("setLocalFilter",function(e,t){T[I(t)].setLocalFilter(e,function(){m.view.setActiveCriteria(!0,!0,T[I(t)])})}),A.addLocalFilter=function(e,t){e.addLocalFilter(t).then(function(){m.view&&m.view.setActiveCriteria(!0,!0,e)},function(e){l.error(e)})},v.addListener("addLocalFilter",function(e,t){var i=T[I(t)];i?A.addLocalFilter(i,e):_(I(t),"addLocalFilter",e)}),A.removeLocalFilter=function(e,t){e.removeLocalFilter(t).then(function(){m.view&&m.view.setActiveCriteria(!0,!0,e)},function(e){l.error(e)})},v.addListener("removeLocalFilter",function(e,t){var i=T[I(t)];i?A.removeLocalFilter(i,e):_(I(t),"removeLocalFilter",e)}),v.addListener("setLocalGrouping",function(e,t){T[I(t)].setLocalGrouping(e).then(function(){m.view.setActiveCriteria(!0,!0,T[I(t)])},function(e){l.error(e)})}),v.addListener("requestGroupingChange",function(e,t){T[I(t)]._requestGroupingChange(e)}),v.addListener("clearLocalGrouping",function(e,t){T[I(t)].clearLocalGrouping(e).then(function(){m.view.setActiveCriteria(!0,!0,T[I(t)],!0)},function(e){l.error(e)})}),v.addListener("setColorMap",function(e,t){T[I(t)].setColorMap(e)}),A.configurePredicates=function(e,t){e.configurePredicates(t)},v.addListener("configurePredicates",function(e,t){var i=T[I(t)];i?A.configurePredicates(i,e):_(I(t),"configurePredicates",e)}),v.addListener("setStatus",function(e,t){T[I(t)].setStatus(e)}),v.addListener("showEmbeddedView",function(e,t){T[I(t)].showEmbeddedTaggerView()}),v.addListener("hideEmbeddedView",function(e,t){T[I(t)].hideEmbeddedTaggerView()}),v.addListener("updateProxyOptions",function(e,t){var i,a=T[I(t)];if(a)for(i in e)switch(i){case"tenant":var n=e.tenant;a.updateTenantInfo({tenant:n,cStorage:w[n],tagsServer:C[n]})}}),v.addListener("toggleDisplayAll",function(e,t){m.view.toggleDisplayAll(e)}),v.addListener("displayCriteria",function(e,t){l.log("received displayCriteria event");var i=T[I(t)];if(i){l.log("proxy id="+i.id());var a=i.getNavImpl();if(a){l.log("navImplOfProxy id="+a.id());var n=m.view.getObservedNavigator();if(n){l.log("observedNavImpl id="+n.id());var r=!(!1===e||e&&e.param&&!1===e.param.checkIsACriteria);if(l.log("displayCriteria flag="+r),a.id()===n.id())l.log("navImplOfProxy.id() === observedNavImpl.id()"),r?m.view.displayCriteria(e):m.view.displayTags();else l.warn("navImplOfProxy.id() NOT EQUAL TO observedNavImpl.id()"),a.getFocusedProxy()===i&&l.log("focusedProxy === proxy, set the selectedTab as per displayCriteria flag"),a.getCache()&&(a.getCache().selectedTab=r?"criteria":"tags")}}}}),v.addListener("toggleDisplayAllCriteria",function(e,t){m.view.toggleDisplayAllCriteria(e)}),v.addListener("updatePLMSuggestions",function(e,t){m.view.updatePLMSuggestions(e)}),v.addListener("updateSuggestions",function(e,t){m.view.updateSuggestions(e)});var N=i.deferred();return v.addListener("getProxy",function(t,i){var a=function(a){var n,r,s,o,c;if(t.isSimplifiedView=a,n=I(i),s=t.filteringMode,"FilteringOnServer"===t.filteringMode&&(t.getExplicitTagsByTagger=!1),o=t.tenant||(t.tagsServerUrlParams?t.tagsServerUrlParams.tenant:null),t.contextId||"function"!=typeof b){if(!t.contextId||"string"!=typeof t.contextId)throw new Error("The context identifier can not be defined.");r=t.contextId}else if(r=b(t.widgetId),l.log("getContextIdFromWidgetId="+r),!r&&(UWA.is(e.Widgets)&&UWA.is(e.Widgets.instances,"array")&&e.Widgets.instances.length>0&&(r=e.Widgets.instances.filter(function(i){return e.is(i,"object")&&"sidepanel"===i.getView().type&&i.id===t.widgetId}).map(function(e){return e.context}).pop()),l.log("getContextIdFromWidgetId after treatment ="+r),!r))throw new Error("The widget id is unknown by 3DDashboard.");if(t.tagsServers={},t.cStorages={},o&&"onpremise"===o&&(o="OnPremise"),E)if("IsNotInWidget"===t.widgetId&&l.error("Error: please set a widgetId for the proxy"),o)if(t.pod&&"3DSpace"!==t.pod||!w[o]){if(t.pod&&"6WTags"!==t.pod||!C[o])throw new Error("The given tenant name is unknown by the TagNavigator.");t.hasPlatformData=!1,t.cStorages[o]=w[o],t.tagsServers[o]=C[o]}else t.hasPlatformData=!0,t.cStorages[o]=w[o],t.tagsServers[o]=C[o]||w[o];else t.hasPlatformData=!1,t.tagsServers=C,t.cStorages=w;else if("IsNotInWidget"!==t.widgetId&&(t.widgetId="IsNotInWidget",l.error("Error Not in 3DD: the widgetId will be ignored, please do not set the widgetId parameter")),o)if(t.pod&&"3DSpace"!==t.pod||!w[o]){if(t.pod&&"6WTags"!==t.pod||!C[o])throw new Error("The given tenant name is unknown by the TagNavigator.");t.hasPlatformData=!1,t.cStorages[o]=w[o],t.tagsServers[o]=C[o]}else t.hasPlatformData=!0,t.cStorages[o]=w[o],t.tagsServers[o]=C[o]||w[o];else w._default&&(t.hasPlatformData=!0,t.cStorages._default=w._default);(function(e){var t=e.id(),i=x.findIndex(function(e){return e.id==t}),a=-1!==i?x.splice(i,1)[0]:void 0;a&&a.calls.forEach(function(t){l.warn("launching stacked proxy call, "+t.id),A[t.id](e,t.data)})})(c=m.get6WTagger(r).getProxy(t)),"FilteringOnServer"===s?(c.addFilterChangeListener.apply(c,[function(e){v.dispatchEvent("onFilterChange",e,null,[n])},this]),c.addCriteriaChangeListener.apply(c,[function(e){v.dispatchEvent("onCriteriaChange",e,null,[n])},this]),c.addPLMUpdateListener.apply(c,[function(e){v.dispatchEvent("plmUpdate",e,null,[n])},this]),c.addRequestSuggestionsListener.apply(c,[function(e){v.dispatchEvent("requestSuggestions",e,null,[n])},this]),c.addOpenTaggerListener.apply(c,[function(){v.dispatchEvent("onOpenTagger",null,null,[n])},this]),c.addCloseTaggerListener.apply(c,[function(){v.dispatchEvent("onCloseTagger",null,null,[n])},this]),c.addUpdateDisplayStatusListener.apply(c,[function(e){v.dispatchEvent("updateDisplayStatus",e,null,[n])},this]),c.addSelectInAppListener.apply(c,[function(e){v.dispatchEvent("onSelection",e,null,[n])},this]),c.addLoadMoreTagsListener.apply(c,[function(){v.dispatchEvent("onLoadMoreTags",null,null,[n])},this]),c.triggerCallbackOfEvent(21,m.view.visibility)):"WithFilteringServices"===s&&c.addFilterSubjectsListener.apply(c,[function(t){t=e.merge(t,c.getFilters()),v.dispatchEvent("onFilterSubjectsChange",t,null,[n])},this]),c.addTagCreationListener.apply(c,[function(e){v.dispatchEvent("addTagCreationListener",e,null,[n])},this]),c.addTagDeletionListener.apply(c,[function(e){v.dispatchEvent("addTagDeletionListener",e,null,[n])},this]),c.addLocalFilterStatusListener.apply(c,[function(e){v.dispatchEvent("addLocalFilterStatusListener",e,null,[n])},this]),c.addUnfocusSubjectsListener.apply(c,[function(e){v.dispatchEvent("addUnfocusSubjectsListener",e,null,[n])},this]),c.addColorizeListener.apply(c,[function(e){v.dispatchEvent("colorize",e,null,[n])},this]),c.addUnColorizeListener.apply(c,[function(e){v.dispatchEvent("unColorize",e,null,[n])},this]),UWA.is(c.addSortChangeListener,"function")&&c.addSortChangeListener.apply(c,[function(e){v.dispatchEvent("onSortChange",e,null,[n])},this]),c.addGroupingChangeListener.apply(c,[function(e){v.dispatchEvent("onGroupingChange",e,null,[n])},this]),!0===window.richClient&&c.addInternalFilterChangeListener.apply(c,[function(e){v.dispatchEvent("_internalFilterChangeListener",e,null,[n])},this]),function(e,t){var i={filters:T[e].getFilters(),forceFilterChangeEvent:t};i.lang=g.getLang(),v.dispatchEvent("proxyIsReady",i,null,[e])}(n,!0===t.forceFilterChangeEvent)};l.log("TagNavigator - received a getProxy event!"),l.log("Stacking up the get Proxy call!"),N.promise.then(function(){l.log("After deferred promise resloved!!"),m.view._viewInitializationPromise.then(function(){l.log("TagNavigator - handling a getProxy event as view is INITIALIZED!"),a(m.view._simplifiedTagger)})})}),m}),define("TagNavigator",["TagNavigator/TagNavigator"],function(e){"use strict";return e}),define("TagNavigator/TagNavigator",["DS/TagNavigator/TagNavigator"],function(e){"use strict";return e}),define("DS/TagNavigator/ParameterView",["UWA/Class/View","UWA/Core","DS/TagNavigator/Parameter","DS/TagNavigator/Parameters","DS/TagNavigator/TaggerView","DS/TagNavigator/TaggerNLS","DS/TagNavigator/AbstractPredicateView","DS/UIKIT/Input/Text","DS/UIKIT/Input/Select","DS/UIKIT/Input/Button"],function(e,t,i,a,n,r,s,o,l,c){"use strict";return e.extend({domEvents:{"click .add-tag-close-param":"clearInput"},setup:function(e){this.focusOn=!0,this.taggerView=e.taggerView,this.disabled=!0},clearInput:function(e){if(!this.disabled){var t=e.target.getParent(".add-tag-cont").getElement("input");if(t){t.getClosest(".addClear").removeClassName("addClear");var i=t.getClosest(".form-control-root");i&&(i.value="",i.triggerEvent("keyup",e))}}},render:function(e){var i,a,n,c=this,d=function(){c.taggerView.onSearchLaunch()},g=function(e){var i=e.get("displayValue"),a=e.get("unit");return a&&(i=i+" ("+a+")"),t.createElement("div",{class:"predicate-label",html:i})},u=function(e,i){var a=t.createElement("span",{class:i}).inject(e);return a.setStyle("cursor","pointer"),a.setStyle("vertical-align","top"),a.setStyle("line-height","34px"),a.setStyle("display","inline-block"),"fonticon fonticon-fonticon fonticon-minus"===i&&a.addClassName("param-remove-button"),a},h=e,p=h.get("type");if("string"===p){i=t.createElement("div",{id:"paramString-container"}).inject(this.container),g(h).inject(i),a=t.createElement("div",{id:"paramString-innerContainer"}).inject(i),n=new o({placeholder:r.getText("typestring"),className:"param-inline-container"}).inject(a),this.disabled&&n.disable(),n.elements.input.addEvent("keyup",function(e){this.value.length&&this.value.split("*").length-1===this.value.length?e.target.addClassName("has-error"):(e.target.removeClassName("has-error"),h.set({stringVal:this.value})),s.checkActiveSearch(c.taggerView),13===e.keyCode&&d()}),u(a,"fonticon fonticon-fonticon fonticon-minus").addEvent("click",function(e){c.disabled||(i.remove(),h.collection.remove(h))}).setAttributes({title:r.getText("paramRemove")});var f=h.get("stringVal");""!==f&&(n.elements.input.value=f,n.dispatchEvent("onKeyUp"))}else if("boolean"===p){i=t.createElement("div",{id:"paramBoolean-container"}).inject(this.container),g(h).inject(i),a=t.createElement("div",{id:"paramBoolean-innerContainer"}).inject(i),n=new l({placeholder:r.getText("selectValue"),className:"param-inline-container",options:[{value:"1",label:r.getText("yes")},{value:"2",label:r.getText("no")}],events:{onChange:function(e){h.set({boolVal:this.getValue()}),s.checkActiveSearch(c.taggerView)}}}).inject(a),this.disabled&&n.disable(),n.elements.input.addEvent("keyup",function(e){13===e.keyCode&&d()}),u(a,"fonticon fonticon-fonticon fonticon-minus").addEvent("click",function(e){c.disabled||(i.remove(),h.collection.remove(h))}).setAttributes({title:r.getText("paramRemove")});var m=h.get("boolVal");m.length>0&&""!==m[0]&&(n.setValue(m),n.dispatchEvent("onChange"))}else if("integer"===p||"double"===p){var v=h.get("intType"),T=[],C=function(){var e=[];return v.forEach(function(t){t.rangeVal.length>0&&e.push(t.rangeVal)}),e},w=function(){v.forEach(function(e){var t=null!==e.rangeContainer&&e.rangeContainer.hasChildNodes()?e.rangeContainer.getChildren():null;(d=t?t[0]:null)&&(d.remove(),d.destroy());var i,a=[],n=[];for(T.forEach(function(t){e.rangeVal!==t&&n.push(t)}),i=0;i<4;i++){var s,o;switch(i){case 0:s="1",o=r.getText("paramIntType1");break;case 1:s="2",o=r.getText("paramIntType2");break;case 2:s="3",o=r.getText("paramIntType3");break;case 3:s="4",o=r.getText("paramIntType4")}-1===n.indexOf(s)&&(a.push({value:s,label:o}),s===e.rangeVal&&(a[a.length-1].selected=!0,a[a.length-1].disabled=!0))}var d=new l({placeholder:!1,options:a,events:{onChange:function(t){e.rangeVal=t.target.value,T=C(),w()}}}).inject(e.rangeContainer);c.disabled&&d.disable()})},b=function(e,i,a){i||g(h).inject(e);var n=a||function(){var e={fromVal:null,toVal:null,rangeContainer:null,rangeVal:"1"};return v.push(e),e}();if(!n.rangeContainer){if(T.length>0){var l=0;for(l=0;l<4;l++){var f=l+1+"";if(-1===T.indexOf(f)){n.rangeVal=f;break}}}T=C()}var m=t.createElement("div",{class:"paramInteger-innerContainer"}).inject(e);n.rangeContainer=t.createElement("div",{class:"add-tag-cont fromtoSelect"}).inject(m);var y=function(e,t,i){var a=e.target.value,r=t?parseInt(a,10):parseFloat(a);if(a.length&&isNaN(r))e.target.addClassName("has-error");else{if("from"===i&&null!==n.toVal&&r>n.toVal||"to"===i&&null!==n.fromVal&&n.fromVal>r)return e.target.addClassName("has-error"),null;e.target.removeClassName("has-error")}return isNaN(r)?null:r},S=t.createElement("div",{class:"add-tag-cont fromto from"}).inject(m),E=new o({placeholder:r.getText("from")}).inject(S),I=t.createElement("span",{class:"add-tag-close-param"}).inject(S);t.createElement("span",{class:"fonticon fonticon-cancel-circled"}).inject(I),c.disabled&&E.disable();var x=function(e){e.target&&(e=e.target),""===e.value?e.getClosest(".add-tag-cont").removeClassName("addClear"):e.getClosest(".add-tag-cont").addClassName("addClear"),s.checkActiveSearch(c.taggerView)};E.elements.input.addEvent("keyup",function(e){n.fromVal=y(e,"integer"===p,"from"),x(e),13===e.keyCode&&d()}),""!==n.fromVal&&(E.setValue(n.fromVal),x(E.elements.input));var _=t.createElement("div",{class:"add-tag-cont fromto to"}).inject(m),A=new o({placeholder:r.getText("to")}).inject(_);c.disabled&&A.disable();var N=t.createElement("span",{class:"add-tag-close-param"}).inject(_);return t.createElement("span",{class:"fonticon fonticon-cancel-circled"}).inject(N),A.elements.input.addEvent("keyup",function(e){n.toVal=y(e,"integer"===p,"to"),x(e),13===e.keyCode&&d()}),""!==n.toVal&&(A.setValue(n.toVal),x(A.elements.input)),u(m,"fonticon fonticon-fonticon fonticon-plus").addEvent("click",function(t){c.disabled||v.length<4&&(b(e,!0).inject(e),w())}).setAttributes({title:r.getText("paramAdd")}),u(m,"fonticon fonticon-fonticon fonticon-minus").addEvent("click",function(t){if(!c.disabled){1===v.length?e.remove():m.remove();var i=v.indexOf(n);i>-1&&v.splice(i,1),v.length<1&&h.collection.remove(h),T=C(),w()}}).setAttributes({title:r.getText("paramRemove")}),m};n=t.createElement("div",{id:"paramInteger-container"}).inject(this.container);var y,S=v.length;if(S>0){for(y=0;y<S;y++)b(n,0!==y,v[y]);T=C()}else b(n,!1);w()}if(n&&this.focusOn)if("string"===p||"boolean"===p)n.focus();else{var E=h.get("intType");E&&E.length>0&&E[0].rangeContainer&&E[0].rangeContainer.focus()}return this}})});