define("DS/CATSmmDraw/Vg",["require","exports"],function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.cssFontValue=e.toCSSColor=e.SCALING=e.V_ALIGN=e.H_ALIGN=e.TEXT_V_ALIGNS=e.TEXT_H_ALIGNS=e.LINE_JOINS=e.LINE_CAPS=e.TypeDef=e.OpCodes=void 0,e.OpCodes={OP_SAVE:"{",OP_RESTORE:"}",OP_TRANSFORM:"M",OP_TRANSLATE:"T",OP_SCALE:"S",OP_ROTATE:"R",OP_IMAGE_ID:"i",OP_TEXT:"t",OP_BEGIN_PATH:"b",OP_CLOSE_PATH:"c",OP_MOVE_TO:"m",OP_LINE_TO:"l",OP_ARC_TO:"a",OP_ARC:"A",OP_CUBIC_TO:"B",OP_QUAD_TO:"Q",OP_RECT:"r",OP_ROUNDED_RECT:"e",OP_CLIP:"C",OP_STROKE:"K",OP_OPACITY:"O",OP_FILL:"F",OP_FILL_LINEAR_GRADIENT:"G",OP_DEF:"d",OP_SET_OBJECT_ID:"#"},e.TypeDef={TYPE_STROKE_ATTRIBUTE:"k",TYPE_TEXT_ATTRIBUTE:"t",TYPE_IMAGE_URL:"i"},e.LINE_CAPS=["butt","round","square"],e.LINE_JOINS=["miter","round","bevel"],e.TEXT_H_ALIGNS=["left","center","right"],e.TEXT_V_ALIGNS=["top","middle","bottom","alphabetic"],e.H_ALIGN={LEFT:0,CENTER:1,RIGHT:2},e.V_ALIGN={TOP:0,CENTER:1,BOTTOM:2,BASELINE:3},e.SCALING={NONE:0,STRETCH:1,WIDTH:2,HEIGHT:3,FIT:4,SAME_AREA:5,FILL:6},e.toCSSColor=function(t){if(0===t)return"#000000";if(16777215===t)return"#ffffff";let e=t.toString(16);for(let t=6-e.length;t>0;t--)e=0+e;return"#"+e},e.cssFontValue=function(t,e=1){let i="";t.bold&&(i+="bold "),t.italic&&(i+="italic "),i+=Math.round(t.fontHeight)*e,i+="pt ";const n=t.fontFamily.split(",");for(let t=0;t<n.length;t++)i+="'",i+=n[t].trim(),i+="'",t+1<n.length&&(i+=",");return i}}),define("DS/CATSmmDraw/DrawingKit",["require","exports"],function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.roundedRectangle=e.rectangle=e.polyline=e.ellipse=void 0;const i=.551784;e.ellipse=function(t,e){const n=1-i,s=e[0],r=e[1],o=e[2],a=e[3],c=(o-s)/2,h=(a-r)/2,l=c*n,u=h*n,d=s+l,T=r+u,m=s+c,_=r+h,S=o-l,O=a-u;t.moveTo(s,_),t.bezierCurveTo(s,T,d,r,m,r),t.bezierCurveTo(S,r,o,T,o,_),t.bezierCurveTo(o,O,S,a,m,a),t.bezierCurveTo(d,a,s,O,s,_)},e.polyline=function(t,e){if(0===e.length)return;t.moveTo(e[0],e[1]);let i=2;for(;i<e.length;)t.lineTo(e[i++],e[i++])},e.rectangle=function(t,e){t.moveTo(e[0],e[1]),t.lineTo(e[2],e[1]),t.lineTo(e[2],e[3]),t.lineTo(e[0],e[3]),t.closePath()},e.roundedRectangle=function(t,e,n,s){void 0===s&&(s=n);const r=1-i,o=n*r,a=s*r,c=e[0]+n,h=e[1]+s,l=e[2]-n,u=e[3]-s,d=c-o,T=h-a,m=l+o,_=u+a;t.moveTo(c,e[1]),t.lineTo(l,e[1]),t.bezierCurveTo(m,e[1],e[2],T,e[2],h),t.lineTo(e[2],u),t.bezierCurveTo(e[2],_,m,e[3],l,e[3]),t.lineTo(c,e[3]),t.bezierCurveTo(d,e[3],e[0],_,e[0],u),t.lineTo(e[0],h),t.bezierCurveTo(e[0],T,d,e[1],c,e[1]),t.closePath()}}),define("DS/CATSmmDraw/Geometry",["require","exports"],function(t,e){"use strict";function i(t,i,n,s,r){return r===e.Direction.WEST||r===e.Direction.NORTH_WEST||r===e.Direction.SOUTH_WEST?t:r===e.Direction.EAST||r===e.Direction.NORTH_EAST||r===e.Direction.SOUTH_EAST?n:(t+n)/2}function n(t,i,n,s,r){return r===e.Direction.NORTH||r===e.Direction.NORTH_EAST||r===e.Direction.NORTH_WEST?i:r===e.Direction.SOUTH||r===e.Direction.SOUTH_EAST||r===e.Direction.SOUTH_WEST?s:(i+s)/2}function s(t,i,n,s){const r=t-n,o=i-s;return r>=o?r>=-o?e.Direction.EAST:e.Direction.NORTH:r>=-o?e.Direction.SOUTH:e.Direction.WEST}function r(t,i,n){const r=n[2]-n[0],o=n[3]-n[1],a=Math.min(r,o)/2,c=s(t,i,n[0]+a,n[1]+a);return c===s(t,i,n[2]-a,n[3]-a)?c:r>o?i>n[1]+a?e.Direction.SOUTH:e.Direction.NORTH:t>n[0]+a?e.Direction.EAST:e.Direction.WEST}function o(t,e,i){return e<t[0]&&(t[0]=e),e>t[2]&&(t[2]=e),i<t[1]&&(t[1]=i),i>t[3]&&(t[3]=i),t}function a(t,e,i){return t[0]<=e&&e<=t[2]&&t[1]<=i&&i<=t[3]}function c(t,e,i){const n=2*e;return h(t[n],t[n+1],t[n+2],t[n+3],i)}function h(t,i,n,s,r){let o=l(n,s,r);if(0===o)return!0;let a=0,c=0,h=!1;for(;;){let u=l(t,i,r);if(0===u)return!0;if(0!=(u&o))return!1;h||(c=i-(a=(s-i)/(n-t))*t,h=!0),0!=(u&e.CS_OUTCODE_X_LT)?i=a*(t=r[0])+c:0!=(u&e.CS_OUTCODE_X_GT)?i=a*(t=r[2])+c:0!=(u&e.CS_OUTCODE_Y_LT)?t=((i=r[1])-c)/a:0!=(u&e.CS_OUTCODE_Y_GT)&&(t=((i=r[3])-c)/a)}}function l(t,i,n){let s=0;return t<n[0]?s|=e.CS_OUTCODE_X_LT:t>n[2]&&(s|=e.CS_OUTCODE_X_GT),i<n[1]?s|=e.CS_OUTCODE_Y_LT:i>n[3]&&(s|=e.CS_OUTCODE_Y_GT),s}Object.defineProperty(e,"__esModule",{value:!0}),e.cohenSutherlandOutCode=e.segmentIntersectsRectangle=e.CS_OUTCODE_Y_GT=e.CS_OUTCODE_Y_LT=e.CS_OUTCODE_X_GT=e.CS_OUTCODE_X_LT=e.polylineIntersectsRectangle=e.expandRectangle=e.vector=e.moveRectanglePointBy=e.rectangleContainsRectangle=e.rectangleContainsPoints=e.rectangleContainsPoint=e.rectangleIntersectsRectangle=e.rectangleMergeWithPoints=e.rectangleMergeWithRectangle=e.rectangleMergeWithPoint=e.projectPointOnRectangle=e.positionOfPointRelativeToRectangle=e.positionOfPointRelativeToPoint=e.getRectanglePoint=e.getRectanglePointY=e.getRectanglePointX=e.setNullRectangle=e.Direction=void 0,e.Direction={CENTER:-1,EAST:0,SOUTH_EAST:1,SOUTH:2,SOUTH_WEST:3,WEST:4,NORTH_WEST:5,NORTH:6,NORTH_EAST:7},e.setNullRectangle=function(t){return t[0]=Number.POSITIVE_INFINITY,t[1]=Number.POSITIVE_INFINITY,t[2]=Number.NEGATIVE_INFINITY,t[3]=Number.NEGATIVE_INFINITY,t},e.getRectanglePointX=i,e.getRectanglePointY=n,e.getRectanglePoint=function(t,e){return[i(t[0],t[1],t[2],t[3],e),n(t[0],t[1],t[2],t[3],e)]},e.positionOfPointRelativeToPoint=s,e.positionOfPointRelativeToRectangle=r,e.projectPointOnRectangle=function(t,i,n){const s=[0,0];switch(r(t,i,n)){case e.Direction.EAST:s[0]=n[2],s[1]=Math.max(n[1],Math.min(i,n[3]));break;case e.Direction.SOUTH:s[0]=Math.max(n[0],Math.min(t,n[2])),s[1]=n[3];break;case e.Direction.WEST:s[0]=n[0],s[1]=Math.max(n[1],Math.min(i,n[3]));break;case e.Direction.NORTH:s[0]=Math.max(n[0],Math.min(t,n[2])),s[1]=n[1]}return s},e.rectangleMergeWithPoint=o,e.rectangleMergeWithRectangle=function(t,e){return e[0]<t[0]&&(t[0]=e[0]),e[2]>t[2]&&(t[2]=e[2]),e[1]<t[1]&&(t[1]=e[1]),e[3]>t[3]&&(t[3]=e[3]),t},e.rectangleMergeWithPoints=function(t,e){for(let i=0;i<e.length;i+=2)o(t,e[i],e[i+1]);return t},e.rectangleIntersectsRectangle=function(t,e){return t[0]<=e[2]&&e[0]<=t[2]&&t[1]<=e[3]&&e[1]<=t[3]},e.rectangleContainsPoint=a,e.rectangleContainsPoints=function(t,e){for(let i=0,n=e.length;i<n;i+=2)if(!a(t,e[i],e[i+1]))return!1;return!0},e.rectangleContainsRectangle=function(t,e){return a(t,e[0],e[1])&&a(t,e[2],e[3])},e.moveRectanglePointBy=function(t,i,n){return n!==e.Direction.CENTER&&n!==e.Direction.WEST&&n!==e.Direction.NORTH_WEST&&n!==e.Direction.SOUTH_WEST||(t[0]=t[0]+i[0]),n!==e.Direction.CENTER&&n!==e.Direction.EAST&&n!==e.Direction.NORTH_EAST&&n!==e.Direction.SOUTH_EAST||(t[2]=t[2]+i[0]),n!==e.Direction.CENTER&&n!==e.Direction.NORTH&&n!==e.Direction.NORTH_EAST&&n!==e.Direction.NORTH_WEST||(t[1]=t[1]+i[1]),n!==e.Direction.CENTER&&n!==e.Direction.SOUTH&&n!==e.Direction.SOUTH_EAST&&n!==e.Direction.SOUTH_WEST||(t[3]=t[3]+i[1]),t},e.vector=function(t,e){return[e[0]-t[0],e[1]-t[1]]},e.expandRectangle=function(t,e,i){return t[0]=t[0]-e,t[1]=t[1]-i,t[2]=t[2]+e,t[3]=t[3]+i,t},e.polylineIntersectsRectangle=function(t,e){const i=t.length/2-1;for(let n=0;n<i;n++)if(c(t,n,e))return!0;return!1},e.CS_OUTCODE_X_LT=1,e.CS_OUTCODE_X_GT=2,e.CS_OUTCODE_Y_LT=4,e.CS_OUTCODE_Y_GT=8,e.segmentIntersectsRectangle=h,e.cohenSutherlandOutCode=l}),define("DS/CATSmmDraw/Manhattan",["require","exports","DS/CATSmmDraw/Geometry"],function(t,e,i){"use strict";function n(t){let e,i,n=0,s=0,r=-1,o=!1,a=!0;for(let c=0,h=1;h<t.length;c+=2,h+=2)if(e=n,i=s,n=t[c],s=t[h],c>0){const t=Math.abs(e-n),c=Math.abs(i-s);t+c>r&&(r=t+c,o=t>=c===a),a=!a}return o}Object.defineProperty(e,"__esModule",{value:!0}),e.movePointTo=e.startsHorizontally=void 0,e.startsHorizontally=n,e.movePointTo=function(t,e,s,r,o){const a=2*r;let c=n(t);r%2!=0&&(c=!c),i.rectangleMergeWithPoint(o,t[a],t[a+1]),t[a]=e,t[a+1]=s,i.rectangleMergeWithPoint(o,e,s),a-2>=0&&(i.rectangleMergeWithPoint(o,t[a-2],t[a-1]),c?t[a-2]=e:t[a-1]=s),a+3<t.length&&(i.rectangleMergeWithPoint(o,t[a+2],t[a+3]),c?t[a+3]=s:t[a+2]=e)}}),define("DS/CATSmmDraw/ImageUtils",["require","exports","DS/CATSmmDraw/Vg"],function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.drawImage=void 0,e.drawImage=function(t,e,n,s,r,o,a,c,h){let l=e.width,u=e.height,d=n,T=s,m=a,_=c,S=m/l,O=_/u;switch(h){case i.SCALING.STRETCH:break;case i.SCALING.WIDTH:_=S*u;break;case i.SCALING.HEIGHT:m=O*l;break;case i.SCALING.FIT:S>O?m=O*l:_=S*u;break;case i.SCALING.SAME_AREA:const t=Math.sqrt(S*O);m=l*t,_=u*t;break;case i.SCALING.FILL:S<O?m=O*l:_=S*u;break;default:case i.SCALING.NONE:m=l,_=u}r!==i.H_ALIGN.LEFT&&(r===i.H_ALIGN.CENTER?d-=m/2:d-=m),o!==i.V_ALIGN.TOP&&(o===i.V_ALIGN.CENTER?T-=_/2:T-=_),t.drawImage(e,0,0,l,u,d,T,m,_)}}),define("DS/CATSmmDraw/VgInterpreter",["require","exports","DS/CATSmmDraw/ImageUtils","DS/CATSmmDraw/DrawingKit","DS/CATSmmDraw/Vg"],function(t,e,i,n,s){"use strict";class r{constructor(t){this.input=t,this.definitions=[],this.images={}}evaluate(t){for(this.readSeparators();"\0"!==this.input.peek(0);)this.readStatement(t)}readStatement(t){const e=this.input.peek(0);switch(this.input.skip(1),this.readSeparators(),e){case s.OpCodes.OP_BEGIN_PATH:t.beginPath();break;case s.OpCodes.OP_CLOSE_PATH:t.closePath();break;case s.OpCodes.OP_SAVE:t.save();break;case s.OpCodes.OP_RESTORE:t.restore();break;case s.OpCodes.OP_MOVE_TO:t.moveTo(this.readNumber(),this.readNumber());break;case s.OpCodes.OP_LINE_TO:t.lineTo(this.readNumber(),this.readNumber());break;case s.OpCodes.OP_QUAD_TO:t.quadraticCurveTo(this.readNumber(),this.readNumber(),this.readNumber(),this.readNumber());break;case s.OpCodes.OP_CUBIC_TO:t.bezierCurveTo(this.readNumber(),this.readNumber(),this.readNumber(),this.readNumber(),this.readNumber(),this.readNumber());break;case s.OpCodes.OP_ARC:this.arc(t);break;case s.OpCodes.OP_ARC_TO:t.arcTo(this.readNumber(),this.readNumber(),this.readNumber(),this.readNumber(),this.readNumber());break;case s.OpCodes.OP_RECT:t.rect(this.readNumber(),this.readNumber(),this.readNumber(),this.readNumber());break;case s.OpCodes.OP_ROUNDED_RECT:this.roundedRect(t);break;case s.OpCodes.OP_ROTATE:t.rotate(this.readNumber());break;case s.OpCodes.OP_TRANSLATE:t.translate(this.readNumber(),this.readNumber());break;case s.OpCodes.OP_SCALE:t.scale(this.readNumber(),this.readNumber());break;case s.OpCodes.OP_TRANSFORM:t.transform(this.readNumber(),this.readNumber(),this.readNumber(),this.readNumber(),this.readNumber(),this.readNumber());break;case s.OpCodes.OP_OPACITY:this.opacity(t);break;case s.OpCodes.OP_TEXT:this.text(t);break;case s.OpCodes.OP_IMAGE_ID:this.image(t);break;case s.OpCodes.OP_SET_OBJECT_ID:this.setObjectId();break;case s.OpCodes.OP_DEF:this.def();break;case s.OpCodes.OP_STROKE:this.stroke(t);break;case s.OpCodes.OP_FILL:t.fillStyle=s.toCSSColor(this.readNumber()),t.fill();break;case s.OpCodes.OP_CLIP:t.clip();break;case s.OpCodes.OP_FILL_LINEAR_GRADIENT:this.fillLinearGradient(t);break;default:console.warn("Unknown Op code: "+e+" in "+this.input.peekString(this.input.getPosition()<20?0:-20,20))}this.readSeparators()}setObjectId(){this.readString()}image(t){const e=this.readString(),n=this.readNumber(),s=this.readNumber(),r=this.readNumber(),o=this.readNumber(),a=this.readNumber(),c=this.readNumber(),h=this.readNumber(),l=document.createElement("img");l.src=this.images[e],i.drawImage(t,l,n,s,r,o,a,c,h)}text(t){const e=this.readString(),i=this.readNumber(),n=this.definitions[this.definitions.length-i],r=this.readNumber(),o=this.readNumber();t.font=s.cssFontValue(n),t.fillStyle=s.toCSSColor(this.readNumber()),t.textAlign=s.TEXT_H_ALIGNS[this.readNumber()],t.textBaseline=s.TEXT_V_ALIGNS[this.readNumber()];const a=this.readNumber();a>0?t.fillText(e,r,o,a):t.fillText(e,r,o)}opacity(t){t.globalAlpha*=this.readNumber(),t.globalAlpha<0?t.globalAlpha=0:t.globalAlpha>1&&(t.globalAlpha=1)}roundedRect(t){const e=this.readNumber(),i=this.readNumber(),s=this.readNumber(),r=this.readNumber(),o=this.readNumber();n.roundedRectangle(t,[e,i,e+s,i+r],o,o)}arc(t){const e=this.readNumber(),i=this.readNumber(),n=this.readNumber(),s=this.readNumber(),r=this.readNumber(),o=this.readNumber();n===s?t.arc(e,i,n,r,r+o,o<0):(t.save(),t.translate(e,i),t.scale(n,s),t.arc(0,0,1,r,r+o,o<0),t.restore())}fillLinearGradient(t){const e=s.toCSSColor(this.readNumber()),i=this.readNumber(),n=this.readNumber(),r=s.toCSSColor(this.readNumber()),o=this.readNumber(),a=this.readNumber(),c=t.createLinearGradient(i,n,o,a);c.addColorStop(0,e),c.addColorStop(1,r),t.fillStyle=c,t.fill()}stroke(t){const e=this.readNumber(),i=this.definitions[this.definitions.length-e];t.lineWidth=i.lineWidth,t.lineJoin=i.lineJoin,t.lineCap=i.lineCap,t.strokeStyle=s.toCSSColor(this.readNumber()),t.stroke()}def(){const t=this.input.peek(0);switch(this.input.skip(1),this.readSeparators(),t){case s.TypeDef.TYPE_STROKE_ATTRIBUTE:const e={lineWidth:this.readNumber(),lineCap:s.LINE_CAPS[this.readNumber()],lineJoin:s.LINE_JOINS[this.readNumber()],dashList:this.readNumberArray()};this.definitions.push(e);break;case s.TypeDef.TYPE_TEXT_ATTRIBUTE:const i={fontFamily:this.readString(),fontHeight:this.readNumber(),bold:this.readBoolean(),italic:this.readBoolean()};this.definitions.push(i);break;case s.TypeDef.TYPE_IMAGE_URL:const n={id:this.readString(),url:this.readString()};this.images[n.id]=n.url;break;default:console.warn("Unknown type: "+t)}this.readSeparators()}readString(){this.input.skip(1);let t=0,e=this.input.peek(t),i="";for(;"\0"!==e&&("'"!==e||(t++,"'"===(e=this.input.peek(t))));)i+=e,t++,e=this.input.peek(t);return this.input.skip(t+1),this.readSeparators(),i}readBoolean(){this.readSeparators();const t=this.input.peek(0);return this.input.skip(1),this.readSeparators(),"1"===t}readNumber(){let t=0;for(;"0123456789.-".indexOf(this.input.peek(t))>=0;)t++;const e=this.input.peekString(0,t);return this.input.skip(t),this.readSeparators(),parseFloat(e)}readNumberArray(){const t=this.readNumber();if(0===t)return[];const e=new Array(t);for(let i=0;i<t;i++)e[i]=this.readNumber();return e}readSeparators(){let t=0;for(;r.isSeparator(this.input.peek(t));)t++;this.input.skip(t)}static isSeparator(t){const e=t.charCodeAt(0);return 1<=e&&e<=32}}return r}),define("DS/CATSmmDraw/ViewPoint",["require","exports","DS/CATSmmDraw/Geometry"],function(t,e,i){"use strict";class n{constructor(t,e,i){this.scale=t,this.tx=e,this.ty=i}toJsonObject(){return{scale:this.scale,tx:this.tx,ty:this.ty}}static fromJsonObject(t){return new n(t.scale,t.tx,t.ty)}clamp(t,e){if(t){const i=this.transform(t);let s=this.tx;i[0]>e[2]&&(s=e[2]-t[0]*this.scale),i[2]<e[0]&&(s=e[0]-t[2]*this.scale);let r=this.ty;return i[1]>e[3]&&(r=e[3]-t[1]*this.scale),i[3]<e[1]&&(r=e[1]-t[3]*this.scale),new n(this.scale,s,r)}return this}copy(){return new n(this.scale,this.tx,this.ty)}transform(t){const e=new Array(t.length);for(let i=0;i<t.length;i+=2)e[i]=t[i]*this.scale+this.tx,e[i+1]=t[i+1]*this.scale+this.ty;return e}invTransform(t){const e=new Array(t.length);for(let i=0;i<t.length;i+=2)e[i]=(t[i]-this.tx)/this.scale,e[i+1]=(t[i+1]-this.ty)/this.scale;return e}compose(t){return new n(t.scale*this.scale,this.scale*t.tx+this.tx,this.scale*t.ty+this.ty)}invert(){return new n(1/this.scale,-this.tx/this.scale,-this.ty/this.scale)}linearize(t,e){return new n(this.scale*(1-e)+t.scale*e,this.tx*(1-e)+t.tx*e,this.ty*(1-e)+t.ty*e)}toCssMatrix(){return this.scale>.98&&this.scale<1.02?"translate("+Math.round(this.tx)+"px, "+Math.round(this.ty)+"px) scale("+this.scale+")":"translate("+this.tx+"px, "+this.ty+"px) scale("+this.scale+")"}applyToElement(t){t.style.transformOrigin="0px 0px 0px";const e=this.toCssMatrix();t.style.transform=e}applyToGc(t){t.transform(this.scale,0,0,this.scale,this.tx,this.ty)}static focusOnRectangle(t,e,s,r=!0,o=Number.MAX_VALUE){const a=t[2]-t[0],c=t[3]-t[1],h=a/(e[2]-e[0]),l=c/(e[3]-e[1]);let u;(u=r?h<l?h:l:h>l?h:l)>o&&(u=o);const d=i.getRectanglePoint(t,s),T=i.getRectanglePoint(e,s),m=i.vector([T[0]*u,T[1]*u],d);return new n(u,m[0],m[1])}static focusOnRectangleWithAreaRatio(t,e,s,r=null){const o=t[2]-t[0],a=t[3]-t[1],c=e[2]-e[0],h=e[3]-e[1];let l=Math.sqrt(o*a/(s*s*c*h));null!==r&&(l=Math.max(l,r));const u=i.getRectanglePoint(t,i.Direction.CENTER),d=i.getRectanglePoint(e,i.Direction.CENTER),T=i.vector([d[0]*l,d[1]*l],u);return new n(l,T[0],T[1])}animate(t,e,i){let n=null;const s={stop:!1,duration:e,targetViewPoint:t,onChange:i,cancel(){s.stop=!0}};let r=t=>{if(s.stop)return;null===n&&(n=t);const e=t-n;if(0===e)return void window.requestAnimationFrame(r);const i=Math.log(Math.exp(e/s.duration));i<1?(s.onChange(this.linearize(s.targetViewPoint,i)),window.requestAnimationFrame(r)):s.onChange(s.targetViewPoint)};return window.requestAnimationFrame(r),s}}return n}),define("DS/CATSmmDraw/ZoomManager",["require","exports","DS/CATSmmDraw/Geometry","DS/CATSmmDraw/ViewPoint","DS/CATSystemCommon/Utils"],function(t,e,i,n,s){"use strict";return class{constructor(t){this.touchStartDistance=0,this.startScale=0,this.startTx=0,this.startTy=0,this.panPoint=[],this.startPoint=[],this.visibleBounds=[],this.element=t,this.viewPoint=new n(1,0,0),this.panning=!1,this.pinching=!1,this.touchListenerAttached=!1,this.canMoveBackground=!0,this.canInitiatePan=(()=>!0),this.canInitiateZoom=(()=>!0)}resetAnimation(){this.currentAnimation&&(this.currentAnimation.cancel(),this.currentAnimation=null)}setVisibleBounds(t,e){const s=this.visibleBounds;this.visibleBounds=t;const r=this.drawBounds;if(e&&e.adaptZoom&&s&&r){const e=t[2]-t[0],r=t[3]-t[1],o=e/(s[2]-s[0]),a=r/(s[3]-s[1]);if(1!==o&&1!==a){let e,r,a=o;const c=i.getRectanglePoint(t,i.Direction.NORTH),h=i.getRectanglePoint(s,i.Direction.NORTH);r=c[0]-h[0]*a,e=c[1]-h[1]*a;const l=this.viewPoint,u=new n(a,r,e).compose(l);this.viewPoint=u,this._dispatchViewPointChange({previousViewPoint:l,viewPoint:u})}}}_getPaddedVisibleBounds(){let t=this.visibleBounds;return t||(t=[0,0,this.element.clientWidth,this.element.clientHeight]),i.expandRectangle(t.slice(),.1*-(t[2]-t[0]),.1*-(t[3]-t[1]))}attachListeners(){this._attachMouseListeners(),this._attachTouchListeners()}detachListeners(){this.mouseWheelHandler&&this.element.removeEventListener("wheel",this.mouseWheelHandler),this.onMouseDown&&this.element.removeEventListener("mousedown",this.onMouseDown),this.onTouchStart&&this.element.removeEventListener("touchstart",this.onTouchStart,{passive:!1}),this.resetAnimation()}_getPoint(t){const e=this.element.getBoundingClientRect();return[t.clientX-e.left,t.clientY-e.top]}_attachMouseListeners(){this.onMouseDown=(i=>{const n=this._getPoint(i);this.canMoveBackground=this.canInitiatePan(n,i)&&!i.shiftKey&&!i.ctrlKey,this.canMoveBackground&&(i.preventDefault(),document.addEventListener("mousemove",t),document.addEventListener("mouseup",e),this._handlePinchStop(),this._handlePanStart(n[0],n[1]))});const t=t=>{if(this.canMoveBackground){t.preventDefault();const e=this._getPoint(t);this._handlePan(e[0],e[1])}},e=i=>{document.removeEventListener("mouseup",e),document.removeEventListener("mousemove",t),i.preventDefault(),this._handlePinchStop(),this._handlePanStop()};this.mouseWheelHandler=(t=>{const e=this._getPoint(t);if(this.canInitiateZoom(e,t)){let s;this.currentAnimation?(s=this.currentAnimation.targetViewPoint,this.currentAnimation.cancel()):s=this.viewPoint;let r=s.invTransform(e);this.drawBounds&&!1===i.rectangleContainsPoint(this.drawBounds,r[0],r[1])&&(r=i.projectPointOnRectangle(r[0],r[1],this.drawBounds));const o=function(t){const e=function(t){if(t.deltaY)switch(t.deltaMode){case WheelEvent.DOM_DELTA_LINE:return 40*-t.deltaY;case WheelEvent.DOM_DELTA_PAGE:return 100*-t.deltaY*40;case WheelEvent.DOM_DELTA_PIXEL:return-t.deltaY}else if("number"==typeof t.detail)return 40*-t.detail;return console.warn("cannot compute wheel distance"),1}(t);let i=Math.abs(e)/900;return i=(1+i)*(1+i),i=e<0?1/i:i}(t);let a=new n(o*s.scale,s.tx+(r[0]-r[0]*o)*s.scale,s.ty+(r[1]-r[1]*o)*s.scale);a=a.clamp(this.drawBounds,this._getPaddedVisibleBounds()),this.animate(a,e,200),t.preventDefault()}}),this.element.addEventListener("wheel",this.mouseWheelHandler),this.element.addEventListener("mousedown",this.onMouseDown)}animate(t,e,i){let n;this.currentAnimation?(n=this.currentAnimation.targetViewPoint,this.currentAnimation.cancel()):n=this.viewPoint,this.currentAnimation=n.animate(t,i,i=>{const n=this.viewPoint.copy();this.viewPoint=i,this._dispatchViewPointChange({previousViewPoint:n,viewPoint:i,focusPoint:e}),i===t&&(this.currentAnimation=null)})}_attachTouchListeners(){const t=t=>{t.cancelable&&t.preventDefault();const e=this._getPoint(t.touches[0]);if(1===t.touches.length)this._handlePan(e[0],e[1]);else if(2===t.touches.length){const i=this._getPoint(t.touches[1]);this._handlePinch(e[0],e[1],i[0],i[1])}},e=i=>{if(0===i.touches.length&&this.panning)this._handlePanStop(),document.body.removeEventListener("touchmove",t,{passive:!1}),document.body.removeEventListener("touchend",e),document.body.removeEventListener("touchcancel",e),this.touchListenerAttached=!1;else if(1===i.touches.length){this._handlePinchStop();const t=this._getPoint(i.touches[0]);this._handlePanStart(t[0],t[1])}};this.onTouchStart=(i=>{i.preventDefault(),this.canMoveBackground=i.touches.length>1||this.canInitiatePan([i.touches[0].clientX,i.touches[0].clientY],i),!this.touchListenerAttached&&this.canMoveBackground&&(document.body.addEventListener("touchmove",t,{passive:!1}),document.body.addEventListener("touchend",e),document.body.addEventListener("touchcancel",e),this.touchListenerAttached=!0);const n=this._getPoint(i.touches[0]);if(1===i.touches.length)this._handlePanStart(n[0],n[1]);else if(2===i.touches.length){const t=this._getPoint(i.touches[1]);this._handlePinchStart(n[0],n[1],t[0],t[1],i)}}),this.element.addEventListener("touchstart",this.onTouchStart,{passive:!1})}_handlePanStart(t,e){this.panning=!0,this.panPoint=[t,e]}_handlePan(t,e){if(this.panning){const i=t-this.panPoint[0],s=e-this.panPoint[1];this.panPoint=[t,e];const r=[t,e],o=this.viewPoint.copy();this.viewPoint=new n(this.viewPoint.scale,this.viewPoint.tx+i,this.viewPoint.ty+s).clamp(this.drawBounds,this._getPaddedVisibleBounds()),this._dispatchViewPointChange({previousViewPoint:o,viewPoint:this.viewPoint,focusPoint:r})}}_dispatchViewPointChange(t){(0,s.dispatchCustomEvent)(this.element,"syc-viewpoint-change",t)}_handlePanStop(){this.panning=!1}_handlePinchStart(t,e,i,n,s){const r=[(t+i)/2,(e+n)/2];if(this.canInitiateZoom(r,s)){this.pinching=!0;const s=i-t,o=n-e;this.touchStartDistance=s*s+o*o,this.startScale=this.viewPoint.scale,this.startTx=this.viewPoint.tx,this.startTy=this.viewPoint.ty,this.startPoint=r}}_handlePinch(t,e,s,r){if(this.pinching){let o,a,c,h=this.startPoint;const l=r-e;if(0===this.touchStartDistance){if(o=(a=this.startScale+.01*l)/this.startScale,this.drawBounds){const t=this.viewPoint.transform(this.drawBounds);i.rectangleContainsPoint(t,h[0],h[1])||(h=i.projectPointOnRectangle(h[0],h[1],t))}c=h}else{const i=s-t,n=i*i+l*l;o=Math.sqrt(n/this.touchStartDistance),a=this.startScale*o,c=[(s+t)/2,(r+e)/2]}if(a>0){const t=this.viewPoint.copy(),e=c[0]-(h[0]-this.startTx)*o,i=c[1]-(h[1]-this.startTy)*o;this.viewPoint=new n(a,e,i).clamp(this.drawBounds,this._getPaddedVisibleBounds());const s=h;this._dispatchViewPointChange({previousViewPoint:t,viewPoint:this.viewPoint,focusPoint:s})}}}_handlePinchStop(){this.pinching=!1}}});