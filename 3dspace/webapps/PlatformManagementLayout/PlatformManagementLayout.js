define("DS/PlatformManagementLayout/EditableTabView",["UWA/Core","UWA/Utils","DS/UIKIT/DropdownMenu","i18n!DS/PlatformManagementLayout/assets/nls/PlatformManagementLayout","css!DS/PlatformManagementLayout/PlatformManagementLayout.css"],function(e,t,a,s){"use strict";var n=require("DS/Dashboard/UserPlatformAccess"),o=require("DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices"),i=require("DS/PlatformAPI/PlatformAPI"),l=require("DS/UWPClientCode/PublicAPI"),r="my-account",c=[],m=[],u=null;return{init:function(e,t){var a=this,s=3,l=function(){0===--s&&t.refreshIfVisible()};a.tabsOptions={className:r,classNames:{scroller:"my-account-tablist-scroller",scrollerButton:"my-account-scroller-button",tabView:"my-account-tabview",tabList:"my-account-tablist",tabPanels:"my-account-tabview-panel"},editable:!1,allowNewTab:!1},console.log(e),this.items=[],console.log(a),e.setValue("tabsOptions",a.tabsOptions),o.getGrantedRoles(function(e){c=e,l()}),i.subscribe("com.ds.i3DXCompassManagement:updateNotificationBadge",function(t){var a=e.body.getElement("[data-tabid=PlatformManager00011] .badge");a&&(a.setText(t.count),a.toggleClassName("hidden",0===t.count))}),n.fetchUserStartupParams().then(function(e){e.roles.forEach(function(e){e.roles.detect(function(e){return"Operator"===e.id})&&(a.items.push({value:e.platform,text:e.platform}),localStorage.getItem("platform-manager-id")===e.platform&&(u=e.platform))}),u||(u=a.items[0].text),o.getPlatformServices({platformId:u,onComplete:function(e){m=e,l()}}),l()})},onLoadCards:function(e,t){var a=e.layout.elements.container;l.getUser(),this._buildHeader(e),this._overrideCss(a),this._buildMobileMenu(a),this._buildPlatformSelector(e,a),this._buildMoreLessMenu(a),this._hideMenus(e,a)},_overrideCss:function(e){var t,a;e.className+=" row",a=e.querySelector("."+this.tabsOptions.classNames.scroller+"-ctn"),t=e.querySelector("."+this.tabsOptions.classNames.tabPanels),a.className+=" hidden-xs col-sm-4 col-md-2 resetPadding",t.className+=" col-xs-12 col-sm-8 col-md-10 resetPadding"},_buildMobileMenu:function(t){var a=e.createElement("select",{class:"form-control mobile-tab-select"}),s=e.createElement("div",{class:"mobile-tab-container visible-xs"}),n=t.querySelector("."+this.tabsOptions.classNames.tabPanels);a.inject(s),t.insertBefore(s,n)},_buildHeader:function(e){e.body.innerHTML+='<div class="my-account-header row"><div class="first">'+s.get("welcome")+'</div><div class="second">'+s.get("platformManagement")+"</div></div>"},_buildPlatformSelector:function(t,s){var n=s.querySelector("."+this.tabsOptions.classNames.tabList);if(this.items.length>1)var o=e.createElement("li",{class:"wp-tab my-account-custom-tab",html:{class:"inner-ctn",html:{tag:"span",class:"title",html:[{tag:"i",class:"fonticon fonticon-3ds-compass expand-more"},{tag:"span",text:u},{tag:"i",class:"fonticon fonticon-open-down expand-more"}]}}}).inject(n,"top");!self.dropdown&&this.items.length>1&&(self.dropdown=new a({target:o,position:"bottom left",items:this.items,events:{onClick:function(e,a){console.log(a),localStorage.setItem("platform-manager-id",a.value),t.setPreferences({platform:a.value}),window.location.reload()}}}))},_buildMoreLessMenu:function(t){var a=this,n=t.querySelector("."+this.tabsOptions.classNames.tabList),o=t.querySelectorAll("."+a.tabsOptions.classNames.tabList+" > .wp-tab:not(."+r+"-custom-tab) .title");console.log("."+a.tabsOptions.classNames.tabList+" > .wp-tab:not(."+r+"-custom-tab) .title"),o.length>2&&e.createElement("li",{class:"wp-tab my-account-custom-tab expand-more",html:{class:"inner-ctn",html:{tag:"span",class:"title state-more",html:[{tag:"i",class:"fonticon fonticon-expand-left less"},{tag:"span",text:s.get("more")},{tag:"i",class:"fonticon fonticon-expand-right more"}]}},events:{click:function(){t.querySelectorAll("."+a.tabsOptions.classNames.tabList+" > .wp-tab:not(."+r+"-custom-tab) .title").forEach(function(e,t){t>2&&e.getParent("li").toggleClassName("hidden")}),this.getElement(".title").hasClassName("state-more")?this.querySelector(".title span").innerText=s.get("less"):this.querySelector(".title span").innerText=s.get("more"),this.getElement(".title").toggleClassName("state-more").toggleClassName("state-less")}}}).inject(n)},_hideMenus:function(t,a){var s=this;a.querySelectorAll("."+s.tabsOptions.classNames.tabList+" > .wp-tab:not(."+r+"-custom-tab) .title").forEach(function(a,n){var o=JSON.parse(t.layout.tabs[n].options.item.data),i=o.icon||"",l=o.role||null,r=o.service||null;a.innerHTML='<span class="fonticon fonticon-'+i+'"></span> '+a.innerHTML,n>2&&a.getParent("li").addClassName("hidden"),s._isRoleAvailable(l)||a.getParent("li").addClassName("missing-role"),s._isServiceAvailable(r)||a.getParent("li").addClassName("missing-service");e.createElement("div",{class:"badge-notification",html:{tag:"span",text:0,class:"badge hidden"}}).inject(a)})},_isRoleAvailable:function(e){return!e||!!c.detect(function(t){return t.id===e&&t.platforms.indexOf(u)>-1})},_isServiceAvailable:function(e){return!e||!!m[e]}}}),define("DS/PlatformManagementLayout/Column",["UWA/Core","UWA/Class/Promise"],function(e,t){"use strict";var a=require("DS/UWPClientCode/WidgetFactory"),s=require("DS/WidgetPreview/Environment/Transient"),n=require("DS/i3DXCompass/i3DXCompass");return{init:function(e,t){console.log("init"),t.refreshIfVisible()},_getAppInfo:function(e){return new t(function(t,a){n?n.getAppInfo({appId:e,onComplete:function(e){e?t(e):a("Could not locate app information.")},onFailure:a}):a()})},_instantiateApp:function(n,o,i){return new t(function(t){var l={el:o,title:"",parent:!1,preview:!0,appId:n.id,data:i||{},header:!0};if(!n||!(n.checksum&&n.launchInfos||n.platforms&&n.platforms[0]&&n.platforms[0].checksum&&n.platforms[0].launchInfos))throw new Error("Could not get valid Config from MyApps for the App "+l.appId);l=e.extend(l,{widgetId:e.is(n.launchInfos)?n.launchInfos:n.platforms[0].launchInfos,isolationLevel:e.is(n.isolationLevel)?n.isolationLevel:n.platforms[0].isolationLevel,token:e.is(n.checksum)?n.checksum:n.platforms[0].checksum}),a.load(l,function(){l.widget&&l.widget.environment&&self.wp&&self.wp.isVisible&&l.widget.environment.setVisible(!0,!0),t(l.widget)},s)})},onBeforeLoadColumns:function(t,a){var s=this,n=document.body.querySelector(".main"),o=document.body.querySelector(".my-account-header"),i=n&&e.extendElement(n).getSize().height||588,l=o&&e.extendElement(o).getSize().height||100,r=t&&t.getValue("appId"),c=e.createElement("div",{class:"module my-account -module",styles:{height:i-l}}).inject(t.layout.columns[0].body);s._getAppInfo(r).then(function(e){return s._instantiateApp(e,c,"")})}}});