define("DS/RenderingMaterial/ApplyJOP",["DS/Visualization/ThreeJS_DS"],function(e){var a=function(e){var a=function(e){return e[0]*e[3]-e[1]*e[2]}(e);return Math.abs(a)<=1e-5?e:(a=1/a,[e[3]*a,-e[1]*a,-e[2]*a,e[0]*a])},t=function(e){return 0==e?[1,0,0,1]:[Math.cos(e),-Math.sin(e),Math.sin(e),Math.cos(e)]},n=function(e,a){var t=new Array(4);return t[0]=e[0]*a[0]+e[1]*a[2],t[1]=e[0]*a[1]+e[1]*a[3],t[2]=e[2]*a[0]+e[3]*a[2],t[3]=e[2]*a[1]+e[3]*a[3],t},r=function(e,t,r,o,l){var s=a(e),i=a(t),c=a(r),u=n(n(i,c),s),p=[];return 1==l?(p[0]=-1*o[0],p[1]=-1*o[1]):(p[0]=-1*(s[0]*o[0]+s[1]*o[1])+.5,p[1]=-1*(s[2]*o[0]+s[3]*o[1])+.5),[u[0],u[1],0,0,u[2],u[3],0,0,0,0,1,0,p[0],p[1],0,1]};function o(e,a,n,o){if(!e)return null;if(e&&!a&&!n)return e;var l=["PLANAR","SPHERICAL","FINITE_CYLINDRICAL","CUBIC","None","None","None","None","INFINITE_CYLINDRICAL"],s={};n?(s.repeat_u=n.repeat_u?"REPEAT":"CLAMP_TO_EDGE",s.repeat_v=n.repeat_v?"REPEAT":"CLAMP_TO_EDGE",s.offset_u=n.offset_u,s.offset_v=n.offset_v,s.angle=n.angle,s.flip_u=n.flip_u,s.flip_v=n.flip_v,s.scale_u=n.scale_u,s.scale_v=n.scale_v):(s.repeat_u=e.repeat_u?"REPEAT":"CLAMP_TO_EDGE",s.repeat_v=e.repeat_v?"REPEAT":"CLAMP_TO_EDGE",s.offset_u=e.offset_u,s.offset_v=e.offset_v,s.angle=e.angle,s.flip_u=e.flip_u,s.flip_v=e.flip_v,s.scale_u=e.scale_u,s.scale_v=e.scale_v),s.mapFocus=e.mapFocus,s.type=l[e.type];var i={};a&&null!=a.repeat_u&&(s.repeat_u=a.repeat_u?"REPEAT":"CLAMP_TO_EDGE"),a&&null!=a.repeat_v&&(s.repeat_v=a.repeat_v?"REPEAT":"CLAMP_TO_EDGE"),a&&null!=a.type&&(s.type=l[a.type]),a&&null!=a.mapFocus&&(s.mapFocus=a.mapFocus),a&&null!=a.scale_u&&(s.scale_u*=a.scale_u),a&&null!=a.scale_v&&(s.scale_v*=a.scale_v),s.scale_v=s.scale_u/s.scale_v,o&&0==s.mapFocus&&(s.scale_u*=parseFloat(o.Width),s.scale_v*=parseFloat(o.Height)),a&&null!=a.offset_u&&(s.offset_u+=a.offset_u),a&&null!=a.offset_v&&(s.offset_v+=a.offset_v),a&&null!=a.flip_u&&(s.flip_u^=a.flip_u),a&&null!=a.flip_v&&(s.flip_v^=a.flip_v),a&&null!=a.angle&&(s.angle+=a.angle);var c=[s.offset_u,s.offset_v],u=[s.scale_u,0,0,s.scale_v],p=t(s.angle),_=[s.flip_u?-1:1,0,0,s.flip_v?-1:1];return i.uv_transform=r(u,_,p,c,s.mapFocus),i.repeat_u=s.repeat_u,i.repeat_v=s.repeat_v,i.type=s.type,i}return{OverloadVisuMaterialWithJOP:function(e,a){const t={anisotropy:"anisotropy",anisotropyRotation:"anisotropyAngle",attenuationColor:"attenuationColor",attenuationDistance:"attenuationDistance",clearcoat:"clearCoat",clearcoatRoughness:"clearCoatRoughness",albedo:"color",displacement:"displacementBias",emissionColor:"emissionColor",emissionEnergyNormalization:"emissionNormalized",emissionValue:"emissionValue",flakeColor:"flakesColor",flakeCoverage:"flakesCoverage",flakeRoughness:"flakesRoughness",flakeSize:"flakesSize",flipFlop:"flipFlop",flipFlopColor:"flipFlopColor",ior:"ior",metallic:"metalness",roughness:"roughness",sheenColor:"sheenColor",sheenRoughness:"sheenRoughness",specular:"specular",subsurfaceAnisotropy:"subsurfaceAnisotropy",subsurfaceColor:"subsurfaceColor",thinWalled:"thinWalled",translucency:"translucency",transparency:"transparency"},n={Anisotropy:"anisotropy",AnisotropyRotation:"anisotropyAngle",Attenuation_Color:"attenuationColor",Attenuation_Distance:"attenuationDistance",Clearcoat:"clearCoat",Clearcoat_Roughness:"clearCoatRoughness",Albedo:"color",Displacement:"displacementBias",Emission_Color:"emissionColor",Emission_Energy_Normalization:"emissionNormalized",Emission_Value:"emissionValue",Flake_Color:"flakesColor",Flake_Coverage:"flakesCoverage",Flake_Roughness:"flakesRoughness",Flake_Size:"flakesSize",Flake_Flipflop:"flipFlop",Flake_Flipflop_Color:"flipFlopColor",IOR:"ior",Metallic:"metalness",Roughness:"roughness",SheenColor:"sheenColor",SheenRoughness:"sheenRoughness",Specular:"specular",Subsurface_Anisotropy:"subsurfaceAnisotropy",Subsurface_Color:"subsurfaceColor",Thin_Walled:"thinWalled",Translucency:"translucency",Transparency:"transparency"};let r=a.material_appearance.applied_material_parameters,l=a.material_appearance.reference_material_parameters;a.material_appearance.additional_mapping_parameters;var s={},i={};5!=r.length&&console.log("Some connection mapping infos are missing!");for(let e=0;e<r.length;e++)"Offset_U"==r[e].parameterID&&(s.offset_u=r[e].value),"Offset_V"==r[e].parameterID&&(s.offset_v=r[e].value),"Scale"==r[e].parameterID&&(s.scale_u=r[e].value),"Scale_Ratio"==r[e].parameterID&&(s.scale_v=r[e].value),"Angle"==r[e].parameterID&&(s.angle=r[e].value);for(let e=0;e<l.length;e++)"offset_u"==l[e].parameterID&&(i.offset_u=l[e].value),"offset_v"==l[e].parameterID&&(i.offset_v=l[e].value),"scale_u"==l[e].parameterID&&(i.scale_u=l[e].value),"scale_v"==l[e].parameterID&&(i.scale_v=l[e].value),"angle"==l[e].parameterID&&(i.angle=l[e].value),"repeat_u"==l[e].parameterID&&(i.repeat_v=l[e].value),"repeat_v"==l[e].parameterID&&(i.repeat_u=l[e].value),"flip_u"==l[e].parameterID&&(i.flip_u=l[e].value),"flip_v"==l[e].parameterID&&(i.flip_v=l[e].value),"type"==l[e].parameterID&&(i.mapping_type=l[e].value);for(let a=0;a<l.length;a++){let r="";if(l[a].parameterID in t)r=t[l[a].parameterID];else{if(!(l[a].parameterID in n)){console.log("Cannot find parameter : "+l[a].parameterID+" on WebVisuMaterial ");continue}r=n[l[a].parameterID]}if("CATRmaScalar"==l[a].type||"CATRmaBoolean"==l[a].type||"CATRmaInteger"==l[a].type)e[r]=l[a].value;else if("CATRmaColor"==l[a].type)try{e[r].r=l[a].value[0],e[r].g=l[a].value[1],e[r].b=l[a].value[2]}catch(e){console.log("Cannot set color on"+r+" / "+l[a].parameterID)}else l[a].type,0;let c={};c=o(i,s,null,null);try{null!=e[r+"Map"]&&(e[r+"UvTransform"].elements=c.uv_transform)}catch(e){console.log("parameter"+r+"UvTransform is not present on webVisuMaterial ")}}}}}),define("DS/RenderingMaterial/PLMMaterialFactory",["DS/Visualization/MaterialConnection","DS/Visualization/ThreeJS_DS","DS/Visualization/Node3D","DS/Visualization/PathElement","DS/Visualization/MaterialApplication","DS/Visualization/InternalSceneGraph","DS/Visualization/PLMMaterialConnectionFactory","DS/Visualization/PLMMaterialServicesItf","DS/Visualization/SceneGraphUtils","DS/VisuLoaders/ThreeDXLoader","DS/VisuLoaders/ThreeDXResourcesLibrary","DS/WAFData/WAFData"],function(e,a,t,n,r,o,l,s,i,c,u,p){"use strict";const _=0,f=1,m=0,v=1,g=6,d=["PLANAR","SPHERICAL","FINITE_CYLINDRICAL","CUBIC","None","None","None","None","INFINITE_CYLINDRICAL"],y=["CLAMP_TO_EDGE","REPEAT"];var h=new Map,b=new Map,M=new Map,F=new Map;l.setParams({loadAppearanceCB:function e(a,t,n){var r=F.get(a.appearanceId);null!=r&&null!=r._material?t(a,r):setTimeout(e.bind(null,a,t,n),100)}});var I=new Array,C=new Map,D=0,w=new u,A=1,T=function(e){var a=P(e);return Math.abs(a)<=1e-5?e:(a=1/a,[e[3]*a,-e[1]*a,-e[2]*a,e[0]*a])},x=function(e,a){var t=new Array(4);return t[0]=e[0]*a[0]+e[1]*a[2],t[1]=e[0]*a[1]+e[1]*a[3],t[2]=e[2]*a[0]+e[3]*a[2],t[3]=e[2]*a[1]+e[3]*a[3],t},P=function(e){return e[0]*e[3]-e[1]*e[2]},S=function(e){let t=[1,0,0,1];t[0]=e.scale_u>0?1/e.scale_u:1,t[3]=e.scale_v>0?1/e.scale_v:1;let n=[1,0,0,1];n[0]=e.flip_u?-1:1,n[3]=e.flip_v?-1:1;let r=[1,0,0,1];if(0!=e.angle){let a=Math.sin(e.angle),t=Math.cos(e.angle);r=[t,a,-a,t]}let o=x(x(n,r),t);return new a.Matrix3(o[0],o[2],-e.offset_u,o[1],o[3],-e.offset_v,0,0,1)},R=function(e){if(e)return{matrix:[e["ds6wg:catmatconnection.v_matrix_1"],e["ds6wg:catmatconnection.v_matrix_2"],e["ds6wg:catmatconnection.v_matrix_3"],0,e["ds6wg:catmatconnection.v_matrix_4"],e["ds6wg:catmatconnection.v_matrix_5"],e["ds6wg:catmatconnection.v_matrix_6"],0,e["ds6wg:catmatconnection.v_matrix_7"],e["ds6wg:catmatconnection.v_matrix_8"],e["ds6wg:catmatconnection.v_matrix_9"],0,e["ds6wg:catmatconnection.v_matrix_10"],e["ds6wg:catmatconnection.v_matrix_11"],e["ds6wg:catmatconnection.v_matrix_12"],1],mapType:e["bo.catmatconnection.v_mappingtype"],scale:e["bo.catmatconnection.v_scaleratio"],mapFocus:e["bo.catmatconnection.v_focusmode"],offset:[e["bo.catmatconnection.v_offsetu"],e["bo.catmatconnection.v_offsetv"]],repeat:[e["bo.catmatconnection.v_repeatu"],e["bo.catmatconnection.v_repeatv"]],angle:e["bo.catmatconnection.v_angle2d"],layer:e["bo.catmatconnection.v_layer"],isKindOf:e["ds6w:type"],matpen:e["matPen.jsonstreamstorage"]}},E=function(e,a,t){this.messageFromIndex=e,this.getNodeFromID=a,this.getSecurityParams=t};return E.prototype.onRemovedRoot=function(e){for(const a of F.keys())a.includes(e)&&(F.delete(a),l.removeMaterialConnection(a))},E.prototype.setParams=function(e){null==e.rootId&&(e.rootId=0);var a=1;null!=e.jsonVersion&&(a=e.jsonVersion),2==a?(A=2,function(e,a){var t=e.materials;if(null!=t)for(var n in Object.keys(t))null!=(o=t[n].resourceid)&&((i=null!=h[o])||(h[o]=t[n]["bo.dsc_matref_rep_rendering.visappearance"]));var r=e.connections;if(null!=r)for(var n in Object.keys(r)){var o;null!=(o=r[n].resourceid)&&((i=null!=b[o])||(b[o]=R(r[n])))}var l=e.materials_overload;if(null!=l)for(var n in Object.keys(l)){var s={path:l[n].path,material:l[n].material,connection:l[n].connection},i=!1;if(null!=M[a])for(var c in M[a])if(s.path.length===M[a][c].path.length&&s.material===M[a][c].material&&s.connection===M[a][c].connection){var u=!0;for(var p in s.path)if(s.path[p]!==M[a][c].path[p]){u=!1;break}u&&(i=!0)}i||(null==M[a]&&(M[a]=new Array),M[a].push(s))}}(e.messageFromIndex,e.rootId)):(this.messageFromIndex=e.messageFromIndex||null,function(e,a){if(e){var t=e.materials;if(t){var n=Object.keys(t);for(var r in n)(s=Object.keys(t[n[r]])[0])&&((c=null!=h[s])||(h[s]=t[r][s]))}for(var r in n=Object.keys(e))if("materials"!=n[r]){var o=e[n[r]];for(var l in o){var s,i={path:n[r].split(","),material:o[l].material,connection:o[l].connection};if(i){var c=!1;if(null!=M[a])for(var u in M[a])if(i.path.length===M[a][u].path.length&&i.material===M[a][u].material&&i.connection===M[a][u].connection){var p=!0;for(var _ in i.path)if(i.path[_]!==M[a][u].path[_]){p=!1;break}p&&(c=!0)}c||(null==M[a]&&(M[a]=new Array),M[a].push(i))}i.connection&&(s=i.connection)&&((c=null!=b[s])||(b[s]=o[l]))}}}}(this.messageFromIndex,e.rootId)),this.getNodeFromID=e.getNodeFromID||null,this.retrieveIRPathFromIIPath=e.retrieveIRPathFromIIPath||null,this.getSecurityParams=e.getSecurityParamsCB||null,l.setParams({getNodeFromIdCB:this.getNodeFromID})},E.prototype.computeMapping=function(e,t,n,r){if(!e)return null;if(e&&!t&&!n)return e;var o={};n?(o.repeat_u=n.repeat_u,o.repeat_v=n.repeat_v,o.offset_u=n.offset_u,o.offset_v=n.offset_v,o.angle=n.angle,o.flip_u=n.flip_u,o.flip_v=n.flip_v,o.scale_u=n.scale_u,o.scale_v=n.scale_v):(o.repeat_u=e.repeat_u,o.repeat_v=e.repeat_v,o.offset_u=e.offset_u,o.offset_v=e.offset_v,o.angle=e.angle,o.flip_u=e.flip_u,o.flip_v=e.flip_v,o.scale_u=e.scale_u,o.scale_v=e.scale_v),o.mapFocus=e.mapFocus,o.type=e.type;var l={};o.object_transform=t.object_transform,t&&null!=t.repeat_u&&(o.repeat_u=t.repeat_u),t&&null!=t.repeat_v&&(o.repeat_v=t.repeat_v),t&&null!=t.type&&(o.type=t.type),t&&null!=t.mapFocus&&(o.mapFocus=t.mapFocus),t&&null!=t.scale_u&&(o.scale_u*=t.scale_u),t&&null!=t.scale_v&&(o.scale_v*=t.scale_v),o.scale_v=o.scale_u/o.scale_v,r&&0==o.mapFocus&&(o.scale_u*=parseFloat(r.Width),o.scale_v*=parseFloat(r.Height)),t&&null!=t.offset_u&&(o.offset_u+=t.offset_u),t&&null!=t.offset_v&&(o.offset_v+=t.offset_v),t&&null!=t.flip_u&&(o.flip_u^=t.flip_u),t&&null!=t.flip_v&&(o.flip_v^=t.flip_v),t&&null!=t.angle&&(o.angle+=t.angle);var s,i=[o.offset_u,o.offset_v],c=[o.scale_u,0,0,o.scale_v],u=0==(s=o.angle)?[1,0,0,1]:[Math.cos(s),-Math.sin(s),Math.sin(s),Math.cos(s)],p=[o.flip_u?-1:1,0,0,o.flip_v?-1:1];return l.uv_transform=function(e,a,t,n,r){var o=T(e),l=T(a),s=T(t),i=x(x(l,s),o),c=[];return 1==r?(c[0]=-1*n[0],c[1]=-1*n[1]):(c[0]=-1*(o[0]*n[0]+o[1]*n[1])+.5,c[1]=-1*(o[2]*n[0]+o[3]*n[1])+.5),[i[0],i[1],0,0,i[2],i[3],0,0,0,0,1,0,c[0],c[1],0,1]}(c,p,u,i,o.mapFocus),l.repeat_u=y[o.repeat_u?1:0],l.repeat_v=y[o.repeat_v?1:0],l.type=d[o.type],o.object_transform&&(l.object_transform=function(e){let t=(new a.Matrix4).setFromArray(e);let n=(new a.Matrix4).getInverse(t,!1),r=new Array(16);return n.flattenToArray(r),r}(o.object_transform)),l},E.prototype.computeDecoupledMapping=function(e,t,n,r){const o={scale_u:1,scale_v:1,offset_u:0,offset_v:0,angle:0,repeat_u:!0,repeat_v:!0,flip_u:!1,flip_v:!1,mapFocus:v,type:g};let l=Object.assign({},o);l.mapFocus=e.mapFocus,l.type=e.type,Object.assign(l,t),l.scale_v=l.scale_u/l.scale_v;let s=null;if(l.type!=g){let e=new a.Matrix4,n=(new a.Matrix4).setFromArray(t.object_transform);if(l.mapFocus==m){let t=(new a.Vector3).getPositionFromMatrix(n);t.negate();let r=(new a.Matrix4).extractRotation(n);r.transpose();let o=(new a.Vector3).copy(t);o.applyMatrix4(r),(e=(new a.Matrix4).copy(r)).setPosition(o)}else{const t=!1;e=(new a.Matrix4).getInverse(n,t)}s=new Array(16),e.flattenToArray(s)}let i=Object.assign({},o,e);n&&(Object.assign(i,n),i.mapFocus=e.mapFocus,i.type=e.type),i.scale_v=i.scale_u/i.scale_v,null!=t.mapFocus&&(i.mapFocus=t.mapFocus),null!=t.type&&(i.type=t.type),null!=t.repeat_u&&(i.repeat_u=t.repeat_u),null!=t.repeat_v&&(i.repeat_v=t.repeat_v),r&&i.mapFocus==m&&(i.scale_u*=parseFloat(r.Width),i.scale_v*=parseFloat(r.Height),i.offset_u*=i.scale_u,i.offset_v*=i.scale_v),i.type==g&&i.mapFocus!=m||(i.offset_u-=.5,i.offset_v-=.5);let c=S(l),u=S(i),p=c.elements[6],_=c.elements[7],f=u.elements[6],h=u.elements[7],b=new a.Matrix3(1,0,p+f-.5,0,1,_+h-.5,0,0,1),M=new a.Matrix3(c.elements[0],c.elements[3],0,c.elements[1],c.elements[4],0,0,0,1),F=new a.Matrix3(u.elements[0],u.elements[3],.5,u.elements[1],u.elements[4],.5,0,0,1),I=new a.Matrix3;I.multiplyMatrices(F,M),I.multiplyMatrices(I,b);var C={};return C.uv_transform=new Array(9),I.flattenToArray(C.uv_transform),C.repeat_u=y[i.repeat_u?1:0],C.repeat_v=y[i.repeat_v?1:0],C.type=d[i.type],s&&(C.object_transform=s),C},E.prototype.computeMaterials=function(e){var a="true"==localStorage.getItem("activate_substance_debug"),n=function(e,a){if("0"===e){if(console.warn("[PLMMaterialFactory] physicalID === 0, this means it is probably an old material where substance does not work. You can try to update the VisAppearanceAttribut"),a(null,null),--D,I.length){var t=I.pop();o(t.physicalID,t.doneCB)}}else{var n;this.getSecurityParams&&(n=this.getSecurityParams());var r=function(){if(--D,I.length){var e=I.pop();o(e.physicalID,e.doneCB)}},l="Substance_".length;if(e.includes("Substance_")){var s=e.indexOf("_",l),i=e.substring(l,s),c=e.substr(s+1);p.authenticatedRequest(n.service3DSpaceUrl+"/resources/fcsservices/fcs/mediaURL?boid="+i+"&format=1&filename="+i+"_%27EXTENDED%27.1="+c,{method:"GET",proxy:"passport",responseType:"arraybuffer",timeout:6e4,onComplete:function(t,n){C.delete(e),a(t,"png"),r()}.bind(this),onFailure:function(a,t,n){console.warn("[PLMMaterialFactory] Failed to get Substance texture "+e),C.delete(e),r()},onTimeout:function(){C.has(e)||C.set(e,0),C.get(e)<3?(C.set(e,C.get(e)+1),console.warn("[PLMMaterialFactory] Timeout when trying to load Substance texture : "+e+" => Trying again. ("+C.get(e)+")"),o(e,a)):(console.warn("[PLMMaterialFactory] Timeout when trying to load Substance texture : "+e+" => Max number of timeout reached. ("+C.get(e)+")"),C.delete(e))}})}else p.authenticatedRequest(n.service3DSpaceUrl+"/cvservlet/fetch/v2?tenant="+n.tenant,{method:"POST",proxy:"passport",type:"json",responseType:"json",headers:{Accept:"application/json;charset=UTF-8","Content-Type":"application/json;charset=UTF-8"},data:JSON.stringify({label:n.userLogin+"fetch-"+e,physicalid:[e],locale:"en",tenant:n.tenant,select_predicate:["ds6wg:plmdmtdocument.v_primarymimetype","plmtdoc.stream.name"]}),onComplete:function(t,l){var s="png";if(t&&t.results&&t.results[0].attributes)for(var i=0;i<t.results[0].attributes.length;++i)"ds6wg:plmdmtdocument.v_primarymimetype"==t.results[0].attributes[i].name&&(s=t.results[0].attributes[i].value);p.authenticatedRequest(n.service3DSpaceUrl+"/resources/fcsservices/fcs/mediaURL?boid="+e+"&format=1&filename="+e+"_%27%27.1",{method:"GET",proxy:"passport",responseType:"arraybuffer",timeout:6e4,onComplete:function(t,n){C.delete(e),a(t,s),r()}.bind(this),onFailure:function(a,t,n){console.warn("[PLMMaterialFactory] Failed to get texture "+e),C.delete(e),r()},onTimeout:function(){C.has(e)||C.set(e,0),C.get(e)<3?(C.set(e,C.get(e)+1),console.warn("[PLMMaterialFactory] Timeout when trying to load texture : "+e+" => Trying again. ("+C.get(e)+")"),o(e,a)):(console.warn("[PLMMaterialFactory] Timeout when trying to load texture : "+e+" => Max number of timeout reached. ("+C.set(e)+")"),C.delete(e))}})}.bind(this),onFailure:function(e,a,t){console.warn("[PLMMaterialFactory] Failed to load CATIPLMDmtDocument stream."),r()},onTimeout:function(){console.warn("[PLMMaterialFactory] Timeout when trying to load CATIPLMDmtDocument stream.")}})}}.bind(this),o=function(e,a){D>100?I.push({physicalID:e,doneCB:a}):(++D,n(e,a))}.bind(this),s=0;null!=e&&(s=e.rootId),null==s&&(s=0);for(var i=0;i<M[s].length;++i){var u=null,m=null,v=null;if(h[M[s][i].material]&&(1==A&&h[M[s][i].material].domains&&(h[M[s][i].material].domains[0]&&h[M[s][i].material].domains[0].default_key&&h[M[s][i].material].domains[0].default_key.visappearance&&(u=h[M[s][i].material].domains[0].default_key.visappearance),m=h[M[s][i].material].isKindOf),2==A&&(u=h[M[s][i].material],m=b[M[s][i].connection].isKindOf,v=b[M[s][i].connection].matpen)),u){u=JSON.parse(u);var g,d,y=M[s][i].path,T=M[s][i].connection,x=b[T],P=u.jsonVersion?u.jsonVersion:1,S=null!=u.mappingSemantics?u.mappingSemantics:_;if(null!=u.decoupledMapping&&(S=f),u.dxm)if(g=u.referenceMapping,d=P>=3?u.texturesInfo:u.texturesSize,u.IsSubstance){if(!a)continue;u=JSON.parse('{"header":{"content":"material","generator":"StellarReal-timeNative","version":"3.2"},"materials":[{"albedo":{"value":[1,0,1]},"anisotropy":{"value":0},"anisotropyRotation":{"value":0},"attenuationColor":[0.999999940395355,0.999999940395355,0.999999940395355],"attenuationDistance":1,"clearcoat":{"value":0},"clearcoatRoughness":{"value":0},"cutoutOpacity":{"value":1},"emissionColor":{"value":[0.999999940395355,0.999999940395355,0.999999940395355]},"emissionEnergyNormalization":false,"emissionMode":"LUMINOUS_EMITTANCE","emissionValue":0,"flakeColor":{"value":[0.999999940395355,0.999999940395355,0.999999940395355]},"flakeCoverage":{"value":0},"flakeRoughness":{"value":0},"flakeSize":{"value":0},"ior":1.5,"metallic":{"value":0},"roughness":{"value":0},"sheen":{"value":0},"specular":{"value":1},"specularTint":{"value":[0.999999940395355,0.999999940395355,0.999999940395355]},"subsurfaceColor":[0,0,0],"thinWalled":true,"transparency":{"value":0},"type":"DSPBR"}]}')}else u=u.dxm;else g=null,d=null;null!=u.binaries&&(u.binaries.flag="3DPlay",u.binaries.forEach(function(e,a){null!=e.uri&&(delete e.uri,null!=e.byteLength&&delete e.byteLength,null==e.extUri&&(e.extUri="0"))}),null==g&&console.warn("[PLMMaterialFactory] We have textures but missing reference mapping values. VisAppearanceAttribut generation problem?"),null==d&&console.warn("[PLMMaterialFactory] We have textures but missing texture infos. VisAppearanceAttribut generation problem?"));var R=-1;if(g&&d&&u.textures){R=g.type,x.mapType&&(x.mapType=parseInt(x.mapType,10),0!=x.mapType&&(R=x.mapType-1));var E=u.textures;E&&E.forEach(function(e,a){var t={};if(x.repeat&&(x.repeat[0]=parseFloat(x.repeat[0]),x.repeat[1]=parseFloat(x.repeat[1]),0!=x.repeat[0]&&(t.repeat_u=1==Math.abs(x.repeat[0])),0!=x.repeat[1]&&(t.repeat_v=1==Math.abs(x.repeat[1])),0!=x.repeat[0]&&(t.flip_u=x.repeat[0]<0),0!=x.repeat[1]&&(t.flip_v=x.repeat[1]<0)),x.offset&&(x.offset[0]=parseFloat(x.offset[0]),x.offset[1]=parseFloat(x.offset[1]),0!=x.offset[0]&&(t.offset_u=1e3*x.offset[0]),0!=x.offset[1]&&(t.offset_v=1e3*x.offset[1])),x.scale&&(x.scale=parseFloat(x.scale),0!=x.scale)){t.scale_u=x.scale%1e6;var n=Math.floor(x.scale/1e6);t.scale_v=n>0?n/1e3:1}x.angle&&(x.angle=parseFloat(x.angle),0!=x.angle&&(t.angle=x.angle)),x.matrix&&(t.object_transform=x.matrix.map(function(e){return parseFloat(e)})),x.mapType&&(x.mapType=parseInt(x.mapType,10),0!=x.mapType&&(t.type=x.mapType-1)),x.mapFocus&&(x.mapFocus=parseInt(x.mapFocus,10),0!=x.mapFocus&&(t.mapFocus=x.mapFocus-1));var r={};r.repeat_u=g.repeat_u,r.repeat_v=g.repeat_v,r.offset_u=g.offset_u,r.offset_v=g.offset_v,r.angle=g.angle,r.flip_u=g.flip_u,r.flip_v=g.flip_v,r.scale_u=g.scale_u,r.scale_v=g.scale_u/g.scale_v,r.type=g.type,r.mapFocus=g.behavior;var o=null;P>=3&&d[a].mapping&&((o=d[a].mapping).scale_v=o.scale_u/o.scale_v);var l=null;l=S==f?this.computeDecoupledMapping(r,t,o,d[a]):this.computeMapping(r,t,o,d[a]),e.uWrap=l.repeat_u,e.vWrap=l.repeat_v,e.mapping.slot&&(e.mapping.slot=null),e.mapping.uvTransform=l.uv_transform,e.mapping.operator={type:l.type,transform:l.object_transform}}.bind(this))}if(null!=u){var L=new c,N=new t,k=function(e,a,t,n,r){var o=null,s=null,i=null,c=null;if(r){var u=JSON.parse(r);(o=u.proxy)[0]&&(s=o[0].value),o[1]&&(i=o[1].value,u.version<=2&&0!=i||u.version>2?o[2]&&(c=o[2].value):i=null)}var p=this.retrieveIRPathFromIIPath(e);l.addMaterialConnection(e[0],{idPath:p,appearanceId:a,type:t,vLayer:parseInt(n,10),internalPath:s,cgmIdRep:i,cgmIdPrimitive:c?c[0]:null,cgmIdPrimitives:c,legacyUV:6==R})}.bind(this);if(y){var O=new r({faceMaterial:null}),V="APP#"+s+i;k(y,V,m.toLowerCase().includes("covering")?l.COVERAGE_MATERIAL:l.CORE_MATERIAL,x.layer,v),F.set(V,O),L.loadMaterial({destinationNode:N,json:u,resourcesLibrary:w,binaryCallback:o,doneCallback:function(e,a){var t=a.material;null!=t&&null!=e&&e.setParameters({faceMaterial:t,enableDepth:!0})}.bind(this,O)})}}}}},new E}),define("DS/RenderingMaterial/MaterialRequestBuilder",[],function(){"use strict";return{getAggregatedProcessor:function(){return JSON.parse('{"materials":{ "uql" : "bo_46_plmentity_46_plm_95_externalid:\\"Applied%20Material\\""}}')},getMaterialAttributes:function(){return["ds6w:type","ds6wg:catmatconnection.v_matrix_1","ds6wg:catmatconnection.v_matrix_2","ds6wg:catmatconnection.v_matrix_3","ds6wg:catmatconnection.v_matrix_4","ds6wg:catmatconnection.v_matrix_5","ds6wg:catmatconnection.v_matrix_6","ds6wg:catmatconnection.v_matrix_7","ds6wg:catmatconnection.v_matrix_8","ds6wg:catmatconnection.v_matrix_9","ds6wg:catmatconnection.v_matrix_10","ds6wg:catmatconnection.v_matrix_11","ds6wg:catmatconnection.v_matrix_12","bo.catmatconnection.v_mappingtype","bo.catmatconnection.v_scaleratio","bo.catmatconnection.v_focusmode","bo.catmatconnection.v_offsetu","bo.catmatconnection.v_offsetv","bo.catmatconnection.v_repeatu","bo.catmatconnection.v_repeatv","bo.catmatconnection.v_angle2d","bo.catmatconnection.v_layer","bo.dsc_matref_rep_rendering.visappearance","matPen.jsonstreamstorage"]}}});