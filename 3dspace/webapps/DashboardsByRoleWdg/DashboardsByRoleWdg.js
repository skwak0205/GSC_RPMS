define("DS/DashboardsByRoleWdg/Views/Dashboard",["DS/W3DXComponents/Views/Item/TileView"],function(e){"use strict";return e.extend({tagName:"div",className:"dbsbyrole-db-tile dbsbyrole-db-itm col-xl-3 col-lg-4 col-md-6 col-sm-12",elements:{},setup:function(e){this._parent.apply(this,e),this.collectionView=e.collectionView,this._widgetHelper=e._widgetHelper},render:function(){var e=this.elements,t=this.container;return this._parent.apply(this,arguments),e.actions=t.getElement(".tile-actions"),this},destroy:function(){this.dispatchEvent("onDestroy"),this.stopListening(),this._parent.apply(this,arguments)}})}),define("DS/DashboardsByRoleWdg/Models/Dashboard",["UWA/Class/Model"],function(e){"use strict";var t=top.require("DS/UWPClientCode/PublicAPI"),n=top.require("DS/Dashboard/PublicAPI");return e.extend({defaults:{id:"",name:"",type:"",roles:[],starter:!1},save:function(e,s){var i=this.get("roles").map(function(e){return e.get("id")});this.isStarter()&&i.push("_starter_"),t.setContextRoles({modelId:this.get("id"),type:this.get("type"),roles:i,success:e,failure:s,serviceName:n._getServiceName()})},isStarter:function(){return this.get("starter")},setAsStarter:function(e){this.set("starter",!!e)}})}),define("DS/DashboardsByRoleWdg/Models/Role",["UWA/Class/Model"],function(e){"use strict";return e.extend({defaults:{id:"",name:"",tenant:void 0}})}),define("DS/DashboardsByRoleWdg/Views/Events",[],function(){"use strict";return{role:{check:"role:check",selectAll:"role:selectAll",unselectAll:"role:unselectAll"},dashboard:{edit:"dashboard:edit",refreshList:"dashboard:refreshList"}}}),define("DS/DashboardsByRoleWdg/Collections/Admins",["UWA/Class/Collection","UWA/Utils","DS/WAFData/WAFData","DS/Dashboard/Utils","DS/Dashboard/Models/Member","DS/DashboardsByRoleWdg/Models/Admin"],function(e,t,n,s,i,o){"use strict";var r=top.require("DS/Dashboard/UserPlatformAccess"),l=top.require("DS/Dashboard/PublicAPI");return e.extend({model:o,sync:function(e,i,o){var l,a=this.model;return o&&o.onComplete&&(l=s.buildPath(r.getMyAppsBaseUrl(),"/resources/AppsMngt/","/user?"+t.toQueryString({platform:o.tenantId||"OnPremise",access:1,status:0,limit:500})),n.authenticatedRequest(l,{method:"GET",type:"json",onComplete:function(e){var t=(e.data||[]).filter(function(e){return e.active}).map(function(e){return new a({id:e.id,email:e.email})});o.onComplete(t)},onFailure:o.onFailure})),{cancel:function(){}}},propagateOwnerRights:function(e,t,n){var s=this;l.getContextMembers({id:e.get("id"),failure:n,success:function(o){l.addContextMembers({id:e.get("id"),newOwners:s.filter(function(e){return 0===o.members.filter(function(t){return t.owner&&e.get("id")===t.login}).length}).map(function(e){return{login:e.get("id"),email:e.get("email"),type:i.USER_TYPE}}),sendEmail:!0,success:t,failure:n,scope:s})},scope:s})}})}),define("DS/DashboardsByRoleWdg/Models/Admin",["UWA/Class/Model"],function(e){"use strict";return e.extend({defaults:{id:void 0,email:void 0}})}),define("DS/DashboardsByRoleWdg/Views/Attributes",["UWA/Class/View","DS/UIKIT/Input/Toggle","i18n!DS/DashboardsByRoleWdg/assets/nls/DashboardsByRole"],function(e,t,n){"use strict";return e.extend({tagName:"div",className:"dbsbyrole-attributes",elements:{},attributes:{},setup:function(e){e=e||{},this.parentView=e.parentView,this.dashboard=e.dashboard,this._widgetHelper=e._widgetHelper,this.attributes={isStarter:this.dashboard.isStarter()}},render:function(){var e=this,s=e.container,i=e.elements;return i.starterToggle=new t({className:"set-as-starter-toggle",type:"switch",value:"starter",checked:this.dashboard.isStarter(),label:n.pickRolesAttributesStarterLabel,events:{onChange:function(){e.attributes.isStarter=this.isChecked()}}}),i.starterToggle.inject(s),e},destroy:function(){this.dispatchEvent("onDestroy"),this.stopListening(),this._parent.apply(this,arguments)}})}),define("DS/DashboardsByRoleWdg/Modals/CancelableModal",["DS/UIKIT/SuperModal"],function(e){"use strict";return{show:function(t){var n=function(t){var n,s=t.parentView;function i(){var e=n&&n.frame;e&&(e.modals&&e.modals.current&&n.frame.modals.current.hide(),n.frame.destroy())}return(n={frame:new e({renderTo:s.container||document.body,closable:!0}),body:{},buttons:[]}).body.html=t.html,n.buttons=[{value:t.okText,className:"primary",action:function(){t.okAction(),i()}},{value:t.cancelText,className:"default",action:function(){t.cancelAction&&t.cancelAction(),i()}}],n.frame.close=i,n}(t=t||{});return n.frame.dialog({body:n.body,title:t.title,buttons:n.buttons}),n.frame}}}),define("DS/DashboardsByRoleWdg/Collections/Roles",["UWA/Class/Collection","UWA/Utils","UWA/Promise","DS/DashboardsByRoleWdg/Models/Role","i18n!DS/DashboardsByRoleWdg/assets/nls/DashboardsByRole"],function(e,t,n,s,i){"use strict";var o=top.require("DS/UWPClientCode/PublicAPI"),r=top.require("DS/Dashboard/PublicAPI"),l=top.require("DS/Dashboard/UserPlatformAccess"),a=top.require("DS/WAFData/WAFData"),d=top.require("DS/Dashboard/Utils");return e.extend({model:s,setup:function(e,t){this._widgetHelper=t._widgetHelper},sync:function(e,t,n){var s,l,a=this,c=a.model;return n&&n.onComplete&&(n.dashboardModel?(s=n.dashboardModel,l=n.allRoleModels,o.getContextRoles({modelId:s.get("id"),type:s.get("type"),success:function(e){var t=e.filter(function(e){return"_starter_"!==e.name||(s.setAsStarter(!0),!1)}).map(function(e){return e.name});n.onComplete(l.filter(function(e){return-1!==t.indexOf(e.get("id"))}))},failure:n.onFailure,serviceName:r._getServiceName()})):a.fetchCustomRoles().then(function(e){e.error&&a._widgetHelper.showError(i.roleFetchingWarning);var t=e.data.map(function(e){var t=e.relationships&&e.relationships.platform&&e.relationships.platform.data&&e.relationships.platform.data.id;return new c({id:e.id,name:e.attributes.name,tenant:t})}).sort(function(e,t){return d.localeCompare(e.get("name"),t.get("name"))});n.onComplete(t)}).catch(n.onFailure)),{cancel:function(){}}},fetchCustomRoles:function(){var e=this._widgetHelper.getCurrentTenant();return new n(function(n){var s=d.buildPath(l.getMyAppsBaseUrl(),"/resources/AppsMngt/","api/custom/roles?"+t.toQueryString({filter:e}));a.authenticatedRequest(s,{method:"GET",type:"json",onComplete:function(e){e.code?n({error:e}):n(e)},onFailure:function(e){n({error:e})}})})}})}),define("DS/DashboardsByRoleWdg/Views/DashboardsCollection",["UWA/Class/View","DS/UWPClientCode/I18n","DS/W3DXComponents/Collections/ActionsCollection","DS/W3DXComponents/Views/Layout/ScrollView","DS/DashboardsByRoleWdg/Views/Dashboard","i18n!DS/DashboardsByRoleWdg/assets/nls/DashboardsByRole"],function(e,t,n,s,i,o){"use strict";return e.extend({tagName:"div",className:"dbsbyrole-dbs",elements:{},setup:function(e){e=e||{};var t=this.elements;this.parentView=e.parentView,this._widgetHelper=e._widgetHelper,t.tileViews=this._buildTiles(),t.scrollView=new s({useInfiniteScroll:!1,usePullToRefresh:!1,view:this._getScrollViewContent()})},render:function(){return this.elements.scrollView.render().inject(this.container),this},destroy:function(){this.dispatchEvent("onDestroy"),this.stopListening()},_getScrollViewContent:function(){var t=this;return new(e.extend({tagName:"div",className:"dbsbyrole-dbs-wrapper",render:function(){var e=t.elements,n=this.container;return e.tileViews.forEach(function(e){e.render().inject(n),e.container.setAttribute("draggable",!1)}),this}}))},_buildTiles:function(){var e=this,t=[];return e.collection.sortBy(function(e){return e.get("name").toLowerCase()}).forEach(function(n){t.push(e._buildTile(n))}),t},_buildTile:function(e){var s=this;return e.actions=new n([{id:"edit",title:o.iconEdit,icon:"fonticon fonticon-pencil"}]),new i({lazyLoading:!1,model:e,roles:s.roles,mapping:{title:function(){return e.get("name")},subtitle:function(){return t.replace(o.tileSubtitleRole,{nb:e.get("roles").length})},content:function(){return e.isStarter()?o.tileContentStarter:""}},events:{onActionClick:function(){s.parentView.showPickRolesModal(e)}},collectionView:s,_widgetHelper:s._widgetHelper})}})}),define("DS/DashboardsByRoleWdg/Views/Role",["DS/W3DXComponents/Views/Temp/TempItemView","DS/UIKIT/Input/Toggle","DS/DashboardsByRoleWdg/Views/Events"],function(e,t,n){"use strict";return e.extend({tagName:"div",className:"dbsbyrole-role-itm",elements:{},checked:!1,template:"",domEvents:{"click .dbsbyrole-role-itm-cb input":"onCheck"},setup:function(e){this.collectionView=e.collectionView,this._widgetHelper=e._widgetHelper,this.checked=e.initiallyCheckedGetter(this),this.elements.checkbox=new t({type:"checkbox",value:this.model.get("id"),className:"primary dbsbyrole-role-itm-cb",label:this.model.get("name"),checked:this.checked}),this.listenTo(this.collectionView,n.role.check,this.onOtherRoleChecked.bind(this)),this.listenTo(this.collectionView,n.role.selectAll,this.setChecked.bind(this,!0)),this.listenTo(this.collectionView,n.role.unselectAll,this.setChecked.bind(this,!1))},onOtherRoleChecked:function(e){e!==this&&e.model.get("id")===this.model.get("id")&&(this.checked=e.checked,this.elements.checkbox.setCheck(this.checked))},onCheck:function(){this.checked=this.elements.checkbox.isChecked(),this.collectionView.onItemChecked(this,this.checked),this.collectionView.dispatchEvent(n.role.check,[this])},setChecked:function(e){this.checked=e,this.elements.checkbox.setCheck(this.checked),this.collectionView.onItemChecked(this,this.checked)},render:function(){return this._parent.apply(this,arguments),this.elements.checkbox.inject(this.container),this},destroy:function(){this.dispatchEvent("onDestroy"),this.stopListening(),this._parent.apply(this,arguments)}})}),define("DS/DashboardsByRoleWdg/Views/Main",["DS/W3DXComponents/Views/Temp/TempItemView","DS/DashboardsByRoleWdg/Views/DashboardsCollection","i18n!DS/DashboardsByRoleWdg/assets/nls/DashboardsByRole"],function(e,t,n){"use strict";var s;return e.extend({tagName:"div",className:"dbsbyrole-main",elements:{},template:'<h5 class="dbsbyrole-dbs-title">    <span class="fonticon fonticon-chart-map-tree"></span>&nbsp;    <span>'+n.dashboardsSectionLabel+'</span>&nbsp;|&nbsp;    <span class="dbsbyrole-dbs-count">0</span></h5><div class="dbsbyrole-dbs-ctn"></div>',setup:function(e){this.dashboardsCollection=e.dashboardsCollection,this._widgetHelper=e._widgetHelper,this.elements.dashboardsCollectionView=new t({collection:this.dashboardsCollection,useInfiniteScroll:!1,parentView:this,_widgetHelper:this._widgetHelper})},showPickRolesModal:function(e){var t=this;require(["DS/DashboardsByRoleWdg/Modals/PickRoles"],function(n){s=n.show({parentView:t.elements.dashboardsCollectionView,dashboard:e,_widgetHelper:t._widgetHelper})})},closePickRolesModal:function(){s&&s.close()},render:function(){var e=this.container,t=this.elements.dashboardsCollectionView;return this._parent.apply(this,arguments),t.render().inject(e.getElement(".dbsbyrole-dbs-ctn")),e.getElement(".dbsbyrole-dbs-count").setContent(""+this.dashboardsCollection.length),this},destroy:function(){this.dispatchEvent("onDestroy"),this.stopListening(),this._parent.apply(this,arguments)}})}),define("DS/DashboardsByRoleWdg/Views/RolesCollection",["UWA/Core","UWA/Class/View","DS/UIKIT/Input/Button","DS/UIKIT/Input/ButtonGroup","DS/UIKIT/DropdownMenu","DS/UIKIT/Tooltip","DS/W3DXComponents/Views/Layout/ListView","DS/DashboardsByRoleWdg/Views/Role","DS/DashboardsByRoleWdg/Views/Events","i18n!DS/DashboardsByRoleWdg/assets/nls/DashboardsByRole"],function(e,t,n,s,i,o,r,l,a,d){"use strict";return t.extend({tagName:"div",className:"dbsbyrole-roles",elements:{},_itemsCheckState:{},_displayedListView:null,_noCurrentRole:e.createElement("span",{text:d.noCurrentRole,class:"emptylist"}),_noRoleFound:e.createElement("span",{text:d.noRoleFound,class:"emptylist"}),setup:function(t){t=t||{};var i,o,a=this,c=a.elements;function u(n){return e.merge({itemView:l,className:"dbsbyrole-list-ctn dbsbyrole-roles-ctn",collection:n,usePullToRefresh:!1,useInfiniteScroll:!1,itemViewOptions:{collectionView:a,initiallyCheckedGetter:a._getInitialCheckStateGetter(i),_widgetHelper:a._widgetHelper}},t)}a.parentView=t.parentView,a.dashboard=t.dashboard,a._itemsCheckState={},a._widgetHelper=t._widgetHelper,i=a.dashboard.get("roles"),o=u(a.collection),c.listView=new r(o).render(),c.selectedOnlyBtn=new n({value:d.pickRolesViewSelectedBtn,active:!0}),c.allRolesBtn=new n({value:d.pickRolesViewAllBtn}),c.btnGroup=new s({type:"radio",buttons:[c.selectedOnlyBtn,c.allRolesBtn],events:{onClick:a.onSwitchDisplayedListView.bind(a)}}),c.selectBtn=a._getSelectButton(),a.dashboard?(i.forEach(function(e){a._itemsCheckState[e.get("id")]=!0}),c.restrictedListView=new r(u(i)).render(),0===c.restrictedListView.collection.length?(a._displayedListView=c.listView,a.elements.btnGroup.setActive(1,!0)):a._displayedListView=c.restrictedListView):a._displayedListView=c.listView},_getInitialCheckStateGetter:function(e){return function(t){return!!e.find(function(e){return e.get("id")===t.model.get("id")})}},_getSelectButton:function(){var t=this,n=e.createElement("span",{class:"select-btn",html:'<span class="fonticon fonticon-select-on"></span><span class="fonticon fonticon-chevron-down"></span>'});return new o({target:n,body:d.pickRolesSelectTooltip}),new i({target:n,items:[{id:"selectAll",text:d.pickRolesSelectAll,fonticon:"select-all"},{id:"unselectAll",text:d.pickRolesUnselectAll,fonticon:"select-none"}],events:{onClick:function(e,n){t.dispatchEvent(a.role[n.id])}}}),n},onItemChecked:function(e){this._itemsCheckState[e.model.get("id")]=e.checked},onSwitchDisplayedListView:function(e,t){this._displayedListView=this.elements[t===this.elements.allRolesBtn?"listView":"restrictedListView"],this.render()},render:function(){var e=this,t=e.container,n=e.elements;return e.elements.selectBtn.inject(t),e.elements.btnGroup.inject(t),[n.listView,n.restrictedListView].forEach(function(s){var i,o;i=s.collection.length>0?s:e[s===n.listView?"_noRoleFound":"_noCurrentRole"],o=s!==e._displayedListView?"hide":"show",i.inject(t),i[o]()}),e},destroy:function(){this.dispatchEvent("onDestroy"),this.stopListening(),this._parent.apply(this,arguments)}})}),define("DS/DashboardsByRoleWdg/Modals/PickRoles",["UWA/Core","UWA/Element","UWA/Promise","DS/UWPClientCode/I18n","DS/UIKIT/SuperModal","DS/DashboardsByRoleWdg/Modals/CancelableModal","DS/DashboardsByRoleWdg/Models/Role","DS/DashboardsByRoleWdg/Collections/Roles","DS/DashboardsByRoleWdg/Collections/Admins","DS/DashboardsByRoleWdg/Views/RolesCollection","DS/DashboardsByRoleWdg/Views/Attributes","i18n!DS/DashboardsByRoleWdg/assets/nls/DashboardsByRole"],function(e,t,n,s,i,o,r,l,a,d,c,u){"use strict";var h,p,b;function f(e,t){function n(e,t){var n=!0;return Object.keys(e).forEach(function(s){!e[s]!=!t[s]&&(n=!1)}),n}return n(e,t)&&n(t,e)}function m(e,t){return f(t,e._itemsCheckState)?n.resolve(!1):new n(function(t){var n=[],o=e._itemsCheckState,d=h.getAllAvailableRoles(),c=h.getCurrentTenant();function f(e){var s;e=e||{},Object.keys(o).forEach(function(e){o[e]&&n.push(new r({id:e,name:d.find(function(t){return t.get("id")===e}).get("name")}))}),n=n.concat(b.get("roles").filter(function(e){var t=e.get("tenant");return t&&t!==c})),b.set("roles",new l(n)),e.shouldPropagateOwnerRights&&(s=new a([],{})).fetch({tenantId:c,onFailure:h.showError.bind(null,u.adminFetchingError),onComplete:function(){s.propagateOwnerRights(b,h.showSuccess.bind(null,u.ownerRightsPropagationSuccess),h.showError.bind(null,u.ownerRightsPropagationError))}}),p.render(),t(!0)}0===b.get("roles").filter(function(e){var t=e.get("tenant");return!t||t===c}).length?new i({closable:!1,renderTo:document.body}).confirm(s.replace(u.pickRolesConfirmationBody,{tenant:c,dashboard:b.get("name")}),u.pickRolesConfirmationTitle,function(e){e?f({shouldPropagateOwnerRights:!0}):t(!1)}):f()})}return{show:function(i){var r,l,a,g,w,D,y,S;return b=(i=i||{}).dashboard,p=i.parentView,h=i._widgetHelper,y=new t("div",{class:"dbsbyrole-attributes-ctn"}),S=new t("div",{class:"dbsbyrole-separation-ctn"}),r=new t("div",{class:"dbsbyrole-roles-picker"}),g=o.show({title:s.replace(u.pickRolesTitle,{dashboard:b.get("name")}),html:[y,S,r],parentView:p,okText:u.pickRolesOkBtn,okAction:function(){var e=[];e.push(function(e,t){var s=e.attributes;return f(t,s)?n.resolve(!1):(b.setAsStarter(s.isStarter),n.resolve(!0))}(a,D)),e.push(m(l,w)),n.all(e).then(function(e){e.some(function(e){return e})&&b.save(h.showSuccess.bind(null,u.dashboardSaveSuccess),h.showError.bind(null,u.dashboardSaveError))})},cancelText:u.pickRolesCancelBtn}),l=function(t,n){var s=new d(e.merge({collection:h.getAllAvailableRoles()},t));return s.render().inject(n),s}(i,r),a=function(e,t){var n=new c(e);return n.render().inject(t),n}(i,y),w=e.clone(l._itemsCheckState),D=e.clone(a.attributes),g}}}),define("DS/DashboardsByRoleWdg/Collections/Dashboards",["UWA/Class/Collection","DS/DashboardsByRoleWdg/Models/Dashboard","DS/DashboardsByRoleWdg/Collections/Roles"],function(e,t,n){"use strict";var s=top.require("DS/Dashboard/PublicAPI");return e.extend({model:t,sync:function(e,t,i){var o=this.model,r=[],l=0;function a(){++l===r.length&&i.onComplete(r)}return i&&i.onComplete&&((r=s._getAllDashboardContexts().filter(function(e){return e.owner&&!e.disabled}).map(function(e){return new o({id:e.modelId,name:e.name,type:e.type,roles:new n([])})})).length>0?r.forEach(function(e){e.get("roles").fetch({dashboardModel:e,allRoleModels:i.allRoleModels,onComplete:a,onFailure:i.onFailure})}):i.onComplete()),{cancel:function(){}}}})}),define("DS/DashboardsByRoleWdg/DashboardsByRole",["UWA/Core","UWA/Class","DS/UIKIT/Alert","DS/UIKIT/Spinner","DS/DashboardsByRoleWdg/Views/Main","DS/DashboardsByRoleWdg/Collections/Dashboards","DS/DashboardsByRoleWdg/Collections/Roles","i18n!DS/DashboardsByRoleWdg/assets/nls/DashboardsByRole","css!DS/DashboardsByRoleWdg/DashboardsByRoleWdg"],function(e,t,n,s,i,o,r,l){"use strict";var a,d=top.require("DS/Dashboard/PublicAPI"),c=top.require("DS/PubSub/PubSub");function u(e){var t=e.elements;t&&t.mainView&&t.mainView.closePickRolesModal(),e.buildSkeleton()}return t.extend({init:function(t){var n=this;n.options=e.extend(e.clone(t,!1)||{}),n.widget=t.widget,n._widgetHelper={getAllAvailableRoles:function(){return n.allAvailableRoles},getCurrentTenant:function(){var e=n.widget.getPreference("tenant")||{};return e.value||e.defaultValue||n.widget.getValue("x3dPlatformId")||d._getGlobalPlatformId()},showAlert:function(e,t){var s=n.elements;s&&s.alert&&s.alert.add({className:t?"error":"primary",message:e})},showSuccess:function(e){n._widgetHelper.showAlert(e,!1)},showError:function(e){n._widgetHelper.showAlert(e,!0)}},n._initEvents()},_initEvents:function(){var e=this,t=e.widget,n=e.onLoad.bind(e);t.onDestroy=e.onDestroy,t.addEvents({onLoad:n,onRefresh:n,onEdit:e.onEdit.bind(e),endEdit:e.endEdit.bind(e),onDestroy:e.onDestroy.bind(e)}),["add","duplicate","remove","rename"].forEach(function(t){c.add(d.events.dashboard[t],u.bind(null,e))}),c.add(d.events.tab.change,function(n){var s=d._getTabByModuleId(t.id);s&&s.wp&&s.wp.id===n&&u(e)})},onLoad:function(){var e=this.widget;d.getPlatforms().then(function(t){var n=e.getValue("x3dPlatformId");t.length&&(t.sort(function(e,t){return e.platformId<t.platformId?-1:e.platformId>t.platformId?1:0}),e.addPreference({name:"tenant",type:"list",label:l.tenant_html,defaultValue:n||t[0].platformId,options:t.map(function(e){return{label:e.displayName,value:e.platformId}})}))}),this.dashboardsCollection=new o([],{}),this.allAvailableRoles=new r([],{_widgetHelper:this._widgetHelper}),this.buildSkeleton()},onEdit:function(){a=this.widget.getPreference("tenant")},endEdit:function(){var t=this.widget.getPreference("tenant");e.equals(a,t)||setTimeout(u.bind(null,this),300)},buildSkeleton:function(){var e=this,t=e.elements,o=e.widget.body;t&&t.mainView&&t.mainView.destroy(),t=e.elements={},o.empty(),t.spinner=(new s).inject(o).show(),t.alert=new n({visible:!0,autoHide:!0}).inject(o),e.allAvailableRoles.fetch({onFailure:e._widgetHelper.showError.bind(null,l.roleFetchingError),onComplete:function(){e.dashboardsCollection.fetch({allRoleModels:e.allAvailableRoles,onFailure:e._widgetHelper.showError.bind(null,l.dashboardFetchingError),onComplete:function(){t.mainView=new i({dashboardsCollection:e.dashboardsCollection,allAvailableRoles:e.allAvailableRoles,_widgetHelper:e._widgetHelper}),t.spinner.destroy(),t.mainView.render().inject(o)}})}})},onDestroy:function(){var e=this.elements;this.widget=null,e&&(e.mainView&&e.mainView.destroy(),e.alert&&e.alert.destroy())}})});