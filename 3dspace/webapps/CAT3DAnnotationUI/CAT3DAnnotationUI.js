/*!  Copyright 2016 Dassault Systemes. All rights reserved. */
define("DS/CAT3DAnnotationUI/CAT3DAnnotationAttrDiv",["UWA/Core","UWA/Class","UWA/Controls/ThemedScroller","DS/VisuEvents/EventsManager","DS/WebappsUtils/WebappsUtils","DS/CATWebUXPreferences/CATWebUXPreferencesUtils","i18n!DS/CAT3DAnnotationUI/assets/nls/CAT3DAnnotationUI","css!DS/CAT3DAnnotationUI/CAT3DAnnotationUI.css"],function(e,t,n,i,r,o,a){"use strict";return t.extend({init:function(t){this._parent(t);var l,s,c,A,d,v=e.createElement("div",{class:"CAT3DAnnotationAttrDiv"}),u=[],D=!1,p=r.getWebappsAssetUrl("CAT3DAnnotationRsc","icons/22/"),h={4:"I_W3DAnnot_VeryHighFailureMode.png",3:"I_W3DAnnot_HighFailureMode.png",2:"I_W3DAnnot_MediumFailureMode.png",1:"I_W3DAnnot_LowFailureMode.png",0:"I_W3DAnnot_LeastImportantFailureMode.png"};function m(){this.setStyles({color:"#368ec4",cursor:""})}function f(){this.setStyles({color:"rgb(130, 190, 220)",cursor:"pointer"})}function T(t,n,i){var r=e.createElement("div",{class:"CAT3DAnnotationAttrDivTitleAndText"});(i&&r.setStyle("height","16px"),t)&&(e.createElement("p",{class:"CAT3DAnnotationAttrDivBoldTitle"}).inject(r).innerHTML=t);n&&(e.createElement("p",{class:"CAT3DAnnotationAttrDivText CAT3DAnnotationAttrDivValue"}).inject(r).innerHTML=n);return r}function C(t){var n=e.createElement("div",{class:"CAT3DAnnotationFailureDiv"}),i=e.createElement("div",{class:"CAT3DAnnotationFailureImgBoxDiv"}).inject(n);e.createElement("img",{class:"CAT3DAnnotationFailureImgDiv",src:p+h[t.crit]}).inject(i);var r=e.createElement("div",{class:"CAT3DAnnotationFailureTextDiv"}).inject(n),o=e.createElement("p",{class:"CAT3DAnnotationFailureTextBoldDiv"}).inject(r);o.innerHTML=a.FailureModes[t.crit];for(var l=0;l<t.descriptions.length;l++)(o=e.createElement("p",{class:"CAT3DAnnotationFailureTextValueDiv"}).inject(r)).innerHTML=t.descriptions[l];return n}function g(t,n,r){var o=e.createElement(t,{class:"CAT3DAnnotationAttrDivText CAT3DAnnotationAttrDivUrl"});return"a"===t&&o.setAttributes({href:n.url}),void 0!==n.title&&""!==n.title?(o.innerHTML=n.title,o.setAttributes({title:n.url})):o.innerHTML=n.url,o.addEventListener("mouseenter",f),o.addEventListener("mouseleave",m),o.setStyles({color:"rgb(0, 120, 175)",padding:D?"5px 0px":"2px 0px"}),"a"!==t&&r&&(o.linkedData=n,u.push(i.addEvent(o,"onPrimaryPointerClick",function(){r(n)}))),o}this.setTouchDisplay=function(e){var t="boolean"==typeof e&&e;if(D!==t){D=t;var n=v.querySelectorAll(".CAT3DAnnotationAttrDivUrl");if(!n.length)return;for(var i=0;i<n.length;i++)n[i].setStyles({padding:D?"5px 0px":"0px"})}},this.buildDivWithDots=function(t){(l=e.createElement("div")).appendChild(v),t.uiFrame.appendChild(l),l.setStyle("position","absolute");var r=l.offsetHeight,o=l.offsetWidth+5;if(l.setStyle("position",""),t.uiFrame.removeChild(l),t.createReadMoreDiv){var s=e.createElement("div",{class:"CAT3DAnnotationAttrDivDots"}).inject(l);s.innerHTML=a.MoreLbl,d=i.addEvent(s,"onPrimaryPointerClick",function(e){e.from[0].event.stopPropagation(),e.from[0].event.preventDefault(),t.callback(e)})}if(v.setStyles({height:r+"px",width:o+"px"}),r>290){v.setStyles({maxHeight:"290px"});var c=v.firstChild;v.removeChild(c),(new n).inject(v).getInnerElement().setContent(c),c.parentNode.parentNode.setStyles({height:"100%"}),c.setStyles({height:r+"px"})}t.onDivCreated({div:l})},this.build=function(t,n,r){var a,D,p;if(t===c&&A===n)return v;for(c=t,A=n;v.firstChild;)v.removeChild(v.firstChild);if(d&&(i.removeEventFromToken(d),d=0),u.length){for(a=0;a<u.length;a++)i.removeEventFromToken(u[a]);u.length=0}l=null,s=null,v.setStyles({maxHeight:"",height:"",width:""});var h,m=0;for(a=0;a<c.length;a++){h||(h=e.createElement("div",{class:"CAT3DAnnotationAttrDivMainContainer"}));var f=c[a],y=e.createElement("div",{class:"CAT3DAnnotationAttrDivContent"}).inject(h);if(A){var x=e.createElement("div",{class:"CAT3DAnnotationAttrContainer"}).inject(y);if(f.icon&&e.createElement("img",{src:f.icon,class:"CAT3DAnnotationAttrDivIcon"}).inject(x),f.name){var E=e.createElement("p",{class:"CAT3DAnnotationAttrDivText CAT3DAnnotationAttrDivTitle"}).inject(x);E.innerHTML=f.name,E.title=f.name}}s=e.createElement("div",{class:"CAT3DAnnotationAttrDivTextContainer"}).inject(y);var b=f.infos,j=Object.keys(b);for(D=0;D<j.length;D++)switch(j[D]){case"hyperlinksAndComments":var M=b.hyperlinksAndComments.urls;if(M&&M.length)for(p=0;p<M.length;p++)g("a",{title:M[p].title,url:M[p].url}).inject(s),m++;if(b.hyperlinksAndComments.hiddenText){var S=b.hyperlinksAndComments.hiddenText.split(/(\r\n|\n|\r)/gm);for(p=0;p<S.length;p++)T(null,S[p]).inject(s),m++}break;case"tolerances":b.tolerances.tabulatedLimit&&b.tolerances.toleranceLimits&&(T(b.tolerances.tabulatedLimit," ("+b.tolerances.toleranceLimits.min+" / +"+b.tolerances.toleranceLimits.max+")",!0).inject(s),m++),b.tolerances.generalTol&&(T(b.tolerances.generalTol.name," ("+b.tolerances.generalTol.variation+")",!0).inject(s),m++);break;case"failureModes":if(b.failureModes.length){var L,I=[];for(p=0;p<b.failureModes.length;p++)I[(L=b.failureModes[p]).crit]?I[L.crit].descriptions=I[L.crit].descriptions.concat(L.descriptions):I[L.crit]={crit:L.crit,descriptions:L.descriptions.slice()};for(p=0;p<I.length;p++)I[p]&&(C(I[p]).inject(s),m++)}break;default:if("requirements"===j[D]||"relatedDocs"===j[D]){var U=b[j[D]];if(U&&U.length)for(p=0;p<U.length;p++)g("p",{title:U[p].displayLabel,url:U[p].label,phyID:U[p].phyID,type:U[p].type,phyType:U[p].phyType},r).inject(s),m++}else if(Array.isArray(b[j[D]])){var F,W;for(p=0;p<b[j[D]].length;p++)b[j[D]][p].Hidden||(W=b[j[D]][p].Magnitude,F=b[j[D]][p].Value,W&&W.toLowerCase&&(W=W.toLowerCase()),o.isMagnitudeSupported(W)?F=o.convertValueToString(b[j[D]][p].Value,W,!0):"boolean"===W&&(F=("1"===F).toString()),T(b[j[D]][p].Name+": ",F,!0).inject(s),m++)}else{var k=b[j[D]].split(/(\r\n|\n|\r)/gm);for(p=0;p<k.length;p++)if(10!==k[p].charCodeAt(0)){var H=k[p].indexOf("=");-1===H&&(H=k[p].indexOf(":")),-1!==H?T(k[p].substring(0,H+1),k[p].substring(H+1,k[p].length),!0).inject(s):T(null,k[p],!0).inject(s),m++}}}a!==c.length-1&&c.length>1&&e.createElement("div",{class:"CAT3DAnnotationAttrDivLine"}).inject(y)}return h&&v.appendChild(h),m||A?v:null}}})}),define("DS/CAT3DAnnotationUI/CAT3DAnnotationUI",[],function(){});