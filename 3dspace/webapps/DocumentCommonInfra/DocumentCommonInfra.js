define("DS/DocumentCommonInfra/Model",["UWA/Core","DS/TreeModel/TreeNodeModel","DS/Tweakers/TypeRepresentationFactory","DS/Controls/Label","i18n!DS/DocumentCommonInfra/assets/nls/DocumentCommonInfra"],function(e,t,n,a,i){"use strict";var o=new n;function s(t,n){t.dataelements.originated&&(t.dataelements.originated=new Date(t.dataelements.originated)),t.dataelements.modified&&(t.dataelements.modified=new Date(t.dataelements.modified)),o.generateView(t.dataelements.modified,{readOnly:!0,typePath:"datetime",onViewCreated:function(e){t.dataelements.modifiedAsString=e.getContent().getText()}}),""==t.dataelements.reservedby&&(t.dataelements.reservedby=void 0),t.dataelements.type=t.type;var s={data:t,grid:t.dataelements};if(s.label=t.dataelements.title||t.dataelements.secondaryTitle||t.dataelements.name,s.title=t.dataelements.title||t.dataelements.secondaryTitle||t.dataelements.name,s.icons=[{iconName:"doc-text"}],s.grid.tree=s.title,s.thumbnail=t.dataelements.indexedImage||t.dataelements.image,s.taxonomies=[t.type],"TRUE"!=t.dataelements.isDocumentType||s.taxonomies.includes("Document")||s.taxonomies.push("Document"),s.thumbnail.endsWith("snresources/images/icons/small/I_CDM_Document.png")&&(s.thumbnail=s.thumbnail.replace("small/I_CDM_Document.png","large/I_TextDoc200x150.png")),s.icons=[t.dataelements.indexedTypeicon||t.dataelements.typeicon],t.relateddata&&t.relateddata.ownerInfo&&1==t.relateddata.ownerInfo.length&&t.relateddata.ownerInfo[0].dataelements&&(t.dataelements.owner={label:t.relateddata.ownerInfo[0].dataelements.firstname+" "+t.relateddata.ownerInfo[0].dataelements.lastname,username:t.relateddata.ownerInfo[0].dataelements.name},n&&n["3DSwym"]&&(t.dataelements.owner.icon=n["3DSwym"]+"/api/user/getpicture/login/"+t.relateddata.ownerInfo[0].dataelements.name+"/format/mini")),t.relateddata&&t.relateddata.originatorInfo&&1==t.relateddata.originatorInfo.length&&t.relateddata.originatorInfo[0].dataelements&&(t.dataelements.originator={label:t.relateddata.originatorInfo[0].dataelements.firstname+" "+t.relateddata.originatorInfo[0].dataelements.lastname,username:t.relateddata.originatorInfo[0].dataelements.name},n&&n["3DSwym"]&&(t.dataelements.originator.icon=n["3DSwym"]+"/api/user/getpicture/login/"+t.relateddata.originatorInfo[0].dataelements.name+"/format/mini")),t.relateddata&&t.relateddata.files&&t.relateddata.files.length>0){var r=[];t.relateddata.files.forEach(t=>{t.dataelements&&e.is(t.dataelements.title,"string")&&r.push(function(e){return e.substring(e.lastIndexOf(".")+1,e.length)||e}(t.dataelements.title))}),t.dataelements.fileExtension=r.join(", ")}return s.subLabel=function(t){var n=e.createElement("div",{class:"NameAndState"});return o.generateView(t.grid.owner,{readOnly:!0,typePath:"user",onViewCreated:function(e){e.inject(n)}}),new a({value:t.grid.stateNLS,emphasize:l.getStateEmphasisClassname(t.data)}).inject(n),n}(s),s.description=function(t){var n=e.createElement("div",{class:"property-description"});return o.generateView(i.get("e6wDocumentField.modified")+":",{readOnly:!0,typePath:"string",onViewCreated:function(e){e.inject(n)}}),o.generateView(t.grid.modified,{readOnly:!0,typePath:"datetime",onViewCreated:function(e){e.inject(n)}}),n}(s),s.customTooltip=`${i.get("e6wDocumentField.title")}: ${s.label}\n${i.get("e6wDocumentField.typeNLS")}: ${t.dataelements.typeNLS}\n${i.get("e6wDocumentField.owner")}: ${t.dataelements.owner.label}\n${i.get("e6wDocumentField.revision")}: ${t.dataelements.revision}\n${i.get("e6wDocumentField.stateNLS")}: ${t.dataelements.stateNLS}\n${i.get("e6wDocumentField.modified")}: ${t.dataelements.modifiedAsString}\n${i.get("e6wDocumentField.collabSpaceTitle")}: ${t.dataelements.collabSpaceTitle}\n${i.get("e6wDocumentField.name")}: ${t.dataelements.name}`,s}var l=function(e,n){var a=s(e,n);a.updateData=function(e){i.updateOptions(s(e,n))};var i=new t(a);return i};return l.getStateEmphasisClassname=function(e){return"class-name-of-no-use doco-state-badge doco-state-"+e.dataelements.policy.replace(/ /g,"_")+"-"+e.dataelements.state.replace(/ /g,"_")},l}),define("DS/DocumentCommonInfra/MaturityColors",["UWA/Core","UWA/Element","DS/WAFData/WAFData"],function(e,t,n){"use strict";e.createElement("style",{html:" .doco-state-badge {\n        background-color: rgb(117, 117, 117);\n        color: white;\n        font-weight: bold;\n        padding: 0 4px;\n        margin: 1px 3px;\n        width: 80px;\n    }"}).inject(document.body);var a={},i={cachedPolicies:null,cachedPoliciesStatesIdentifier:[],cachedPoliciesStatesInfo:[],setup:function(e){i.options=e,i.load()},fetchPolicies:function(t,o){if(i.cachedPolicies&&i.cachedPolicies[widget.lang]&&t.every(i.hasStateInfoForDoc))o(i.cachedPolicies);else{var s={url:i.options.platformUrls["3DSpace"]+"/resources/lifecycle/maturity/getStateGraph?tenant="+i.options.platformUrls.platformId,type:"json",method:"POST",headers:{Accept:"application/json","Accept-Language":widget.lang,"Content-Type":"application/json",securitycontext:i.options.fetchSecurityContext()},data:JSON.stringify({data:t.map(function(e){return{physicalid:e.id}})}),onComplete:function(t){t.status&&null==t.status.errorMsg&&(i.cachedPolicies=i.cachedPolicies||{},i.cachedPolicies[widget.lang]=i.cachedPolicies[widget.lang]||{},t.data.policies.forEach(function(t){i.cachedPolicies[widget.lang][t.name]=i.cachedPolicies[widget.lang][t.name]||{},t.maturityGraph.states.forEach(function(n){i.cachedPolicies[widget.lang][t.name][n.stateSysName]=n;var o=t.name+"---"+n.stateSysName;i.cachedPoliciesStatesIdentifier.includes(o)||(i.cachedPoliciesStatesIdentifier.push(o),null==a[o]&&(a[o]=e.createElement("style",{html:` .doco-state-${t.name.replace(/ /g,"_")}-${n.stateSysName.replace(/ /g,"_")} {\n                          background-color: ${n.activeColor};\n                      }`}).inject(document.body)))})})),o(i.cachedPolicies)},onFailure:function(e,t){}};n.authenticatedRequest(s.url,s)}},load:function(){var e=null;null!=e&&null!=(e=JSON.parse(e))&&(i.cachedPolicies=e)},hasStateInfoForDoc:function(e){if(i.cachedPolicies&&i.cachedPolicies[widget.lang]&&(null!=i.cachedPolicies[widget.lang][e.dataelements.policy]&&null!=i.cachedPolicies[widget.lang][e.dataelements.policy][e.dataelements.state]))return!0;return!1}};return i}),define("DS/DocumentCommonInfra/DocDictionary",["UWA/Core","DS/WAFData/WAFData","DS/FedDictionaryAccess/FedDictionaryAccessAPI"],function(e,t,n){"use strict";return e.Class.extend({ready:e.Promise.deferred(),init:function(a){var i=this,o={url:a.tenantUrl+"/resources/dictionary/getTypeInfo?$filter=isOOTB+eq+false",type:"json",method:"POST",headers:{Accept:"application/json","Accept-Language":widget.lang,"Content-Type":"application/json"},data:JSON.stringify(["Document"]),onComplete:function(o,s){var l=["Document"];Object.keys(o).forEach(e=>{"Document Proxy"!=e&&l.push(e)});var r={url:a.tenantUrl+"/resources/dictionary/class/interfaces",type:"json",method:"POST",headers:{Accept:"application/json","Accept-Language":widget.lang,"Content-Type":"application/json"},data:JSON.stringify({classes:l}),onComplete:function(o,s){var r=[];o.results.forEach(e=>{e.interfaces.forEach(e=>{r.includes(e.name)||r.push(e.name)})});var d=new e.Promise(function(e,n){var i={url:a.tenantUrl+"/resources/dictionary/class/properties?$select=name,nlsName,protection",type:"json",method:"POST",headers:{Accept:"application/json","Accept-Language":widget.lang,"Content-Type":"application/json"},data:JSON.stringify({classes:[...l,...r]}),onComplete:function(t,n){var a={};t.results.forEach(e=>{e.properties.forEach(e=>a[e.name]=e.nlsName)}),e(a)},onFailure:function(e,t){n()}};t.authenticatedRequest(i.url,i)}),c=new e.Promise(function(t,i){n.getPropertiesForClass([...l,...r].map(e=>"ds6wg:"+e).join(),{tenantId:a.tenant,lang:widget.lang,apiVersion:"R2019x",onComplete:function(n){n=e.is(n,"string")?JSON.parse(n):n,t(n)},onFailure:function(e){i()}})});e.Promise.all([d,c]).then(function(e){i.ready.resolve(e)},function(){i.ready.reject()})},onFailure:function(e,t){i.ready.reject()}};t.authenticatedRequest(r.url,r)},onFailure:function(e,t){i.ready.reject()}};t.authenticatedRequest(o.url,o)}})}),define("DS/DocumentCommonInfra/Columns",["UWA/Core","DS/WAFData/WAFData","DS/DocumentCommonInfra/DocDictionary","DS/DocumentCommonInfra/Model","i18n!DS/DocumentCommonInfra/assets/nls/DocumentCommonInfra"],function(e,t,n,a,i){"use strict";return e.Class.extend({ready:void 0,predefinedColumns:[{name:"title",includeAlways:!0,typeRepresentation:"url",dataIndex:"tree",pinned:"left",width:"300",className:"preview-column",curi:"ds6w:label"},{name:"name",typeRepresentation:"string",includeAlways:!0,className:"preview-column",curi:"ds6w:identifier"},{name:"policy",includeAlways:!0,hiddenAlways:!0},{name:"state",includeAlways:!0,hiddenAlways:!0},{name:"typeNLS",typeRepresentation:"string",includeAlways:!0,curi:"ds6w:type"},{name:"policyNLS",typeRepresentation:"string",visibleFlag:!1,curi:"ds6w:policy"},{name:"collabSpaceTitle",typeRepresentation:"string",curi:"ds6w:project"},{name:"revision",typeRepresentation:"string",includeAlways:!0,curi:"ds6wg:revision"},{name:"isLatestRevision",typeRepresentation:"boolean",className:"coloured-boolean",curi:"ds6w:isLastRevision"},{name:"lockStatus",typeRepresentation:"string",visibleFlag:!0,needsCustomImplementation:!0,curi:"ds6w:who/ds6w:responsible/ds6w:reservedBy",include:"lockerInfo",fields:["lockerInfo.name","lockerInfo.firstname","lockerInfo.lastname"]},{name:"description",typeRepresentation:"textBlock",visibleFlag:!1,curi:"ds6w:description"},{name:"organizationTitle",typeRepresentation:"string",includeAlways:!0,visibleFlag:!1,curi:"ds6w:organizationResponsible"},{name:"owner",typeRepresentation:"user",includeAlways:!0,needsCustomImplementation:!0,include:"ownerInfo",includeAlways:!0,fields:["ownerInfo.name","ownerInfo.firstname","ownerInfo.lastname"],curi:"ds6w:responsible"},{name:"originator",typeRepresentation:"user",includeAlways:!0,needsCustomImplementation:!0,visibleFlag:!1,include:"originatorInfo",fields:["originatorInfo.name","originatorInfo.firstname","originatorInfo.lastname"],curi:"ds6w:originator"},{name:"stateNLS",typeRepresentation:"tag",includeAlways:!0,needsCustomImplementation:!0,getCellSemantics:function(e){return{emphasize:a.getStateEmphasisClassname(e.nodeModel.options.data)}},curi:"ds6w:status"},{name:"originated",typeRepresentation:"datetime",visibleFlag:!1,curi:"ds6w:created"},{name:"modified",typeRepresentation:"datetime",includeAlways:!0,curi:"ds6w:modified"},{name:"comments",typeRepresentation:"string",visibleFlag:!1},{name:"hasModifyAccess",includeAlways:!0,hiddenAlways:!0},{name:"fileExtension",typeRepresentation:"string",visibleFlag:!1,curi:"ds6w:docExtension",include:"files",includeAlways:!0,fields:["files.name","files.title","files.revision","files.locker"]},{name:"secondaryTitle",hiddenAlways:!0},{name:"ownerInfo",conditionalInclude:"owner",include:"ownerInfo",includeAlways:!0,hiddenAlways:!0,fields:["ownerInfo.name","ownerInfo.firstname","ownerInfo.lastname"]},{name:"originatorInfo",conditionalInclude:"originator",include:"originatorInfo",includeAlways:!0,hiddenAlways:!0,fields:["originatorInfo.name","originatorInfo.firstname","originatorInfo.lastname"]}],predefinedColumnsDictionary:{},customColumnsSelectableDictionary:{},customColumnsDictionary:{},customColumns:[],init:function(a){var o=this;o.ready=e.Promise.deferred();var s=new n(a);o.predefinedColumnsDictionary={},o.predefinedColumns.forEach(e=>{e.text=i.get("e6wDocumentField."+e.name),e.typeRepresentation&&(null==e.dataIndex&&(e.dataIndex=e.name),o.predefinedColumnsDictionary[e.name]=e)});var l=a.tenantUrl+"/resources/v1/modeler/documents";t.authenticatedRequest(l,{method:"post",type:"json",data:"$definition=true",onComplete:function(t){if(t.success){for(const i of t.definitions)if("e6w.documents.fields"==i.name){for(const t of i.items)if("document-custom-fields"==t.name){var n=t;n.items.shift();for(const t of n.items){var a={name:t.name,dataIndex:t.name,text:t.label,visibleFlag:!1,viewConfig:e.Json.isJson(t.viewConfig)?JSON.parse(t.viewConfig):void 0};if(a.viewConfig&&a.viewConfig.attributeType&&!a.viewConfig.multivalue){switch(a.viewConfig.attributeType){case"boolean":a.typeRepresentation="boolean",a.className="coloured-boolean";break;case"date":a.typeRepresentation="datetime";break;case"real":case"double":a.typeRepresentation="number";break;case"integer":a.typeRepresentation="integer";break;default:a.typeRepresentation="string"}"boolean"==a.viewConfig.attributeType?a.typeRepresentation="boolean":"date"==a.viewConfig.attributeType&&(a.typeRepresentation="datetime"),"real"!=a.viewConfig.attributeType&&"double"!=a.viewConfig.attributeType&&"integer"!=a.viewConfig.attributeType||function(e){e.compareFunction=function(e,t){return parseFloat(e)-parseFloat(t)}}(a)}t.units&&e.is(t.units.item,"array")&&t.units.item.forEach(e=>{e.default&&(a.getCellSemantics=function(t){return{units:e.display}})}),t.extension&&(a.selectable=t.extension+"."+t.name,o.customColumnsSelectableDictionary[a.selectable]=a),o.customColumns.push(a),o.customColumnsDictionary[t.name]=a}break}break}s.ready.promise.then(function(e){var t=e[0],n=e[1];o.customColumns.forEach(e=>{t[e.name]&&(e.text=t[e.name])}),n.forEach(e=>{e.properties.forEach(e=>{o.customColumnsSelectableDictionary[e.selectable]&&null==o.customColumnsSelectableDictionary[e.selectable].curi&&(o.customColumnsSelectableDictionary[e.selectable].curi=e.curi)})}),o.showableColumns=o.getColumns(),o.showableColumnsDataIndexDictionary={},o.showableColumns.forEach(e=>{o.showableColumnsDataIndexDictionary[e.dataIndex]=e}),o.ready.resolve(o.showableColumns)})}else o.ready.reject()}})},getColumns:function(){return[...this.predefinedColumns.filter(e=>e.typeRepresentation),...this.customColumns]},getQueryAsPerVisibleColumns:function(e){var t={include:["none"],fields:["none"]};this.sortableVisibleColumns=[];for(const n of e)null!=n.visibleFlag&&1!=n.visibleFlag||null==n.name||(t.fields.push(n.name),n.include&&t.include.push(n.include),n.fields&&t.fields.push(...n.fields),this.sortableVisibleColumns.push(n));for(const e of this.predefinedColumns)e.includeAlways&&(t.fields.includes(e.name)||(t.fields.push(e.name),e.include&&t.include.push(e.include),e.fields&&t.fields.push(...e.fields)));return t},getSortPredicate:function(e){if(this.showableColumnsDataIndexDictionary[e])return this.showableColumnsDataIndexDictionary[e].curi}})});