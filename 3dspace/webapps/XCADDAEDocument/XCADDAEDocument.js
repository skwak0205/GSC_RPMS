define("DS/XCADDAEDocument/DAEProductRepresentation",["DS/XCADInputDocuments/XCADProductRepresentation"],function(t){"use strict";return t.extend(function(t,e,i){this._name=i,this._associatedDocument=t,this._representationType=e,this._rootProducts=[]},{addRootProduct:function(t){this._rootProducts.push(t)}})}),define("DS/XCADDAEDocument/DAETessellatedRepresentation",["DS/XCADInputDocuments/XCADTessellatedRepresentation","DS/XCADInputDocuments/XCADRepresentation","DS/XCADInputDocuments/XCADFaceData"],function(t,e,i){"use strict";var s=null;function r(t){var e,i=s.geometries[t];if(i)e=i.mesh;else if(null==i){var r=t.split("#");2==r.length&&s.geometries[r[0]].mesh&&(e=s.geometries[r[0]].mesh.primitives[r[1]])}return e}return t.extend(function(t){this._associatedDocument=t,this._representationType=e.XCAD_TESSELLATED_REPRESENTATION,this._associatedDocument.COLLADA,s=this._associatedDocument},{getChild:function(t,e){var i=r(t);return i.nodes&&0!=i.nodes.length?i.nodes[e].id:i.geometries&&0!=i.geometries.length?i.geometries[e].url:i.primitives&&0!=i.primitives.length?i.primitives[e].id:void 0},getChildCount:function(t){var e=r(t);return e.nodes&&0!=e.nodes.length?e.nodes.length:e.geometries&&0!=e.geometries.length?e.geometries.length:e.primitives&&0!=e.primitives.length?e.primitives.length:0},getCircleData:function(t){throw"Error: not implemented method"},getConeData:function(t){throw"Error: not implemented method"},getCoordinateSystem:function(t){throw"Error: not implemented method"},getCylinderData:function(t){throw"Error: not implemented method"},getEdgeData:function(t){throw"Error: not implemented method"},getFaceData:function(t){var e=new i,s=r(t);return e.vertices=s.vertices,e.normals=s.normals,e.id=s.id,e},getGPType:function(e){return 3==r(e).vcount?t.KindOfGP.GP_Face:t.KindOfGP.GP_Unknown},getNodeBoundingSphere:function(t){throw"Error: not implemented method"},getNodeColor:function(t){var e=r(t);if(!e.material)return[.825,.825,1];for(var i in s.materials)if(s.materials[i].name==e.material){var n=s.materials[i].instance_effect.url;return[s.effects[n].shader.material.color.r,s.effects[n].shader.material.color.g,s.effects[n].shader.material.color.b,1==s.effects[n].shader.material.transparent?1-s.effects[n].shader.material.opacity:s.effects[n].shader.material.opacity]}},getNodeOrientationMatrix:function(t){var e,i=r(t).matrix;return void 0!==i&&(e=i),e},getNodeType:function(e){var i=r(e);return i.nodes&&0!=i.nodes.length?t.KindOfNode.NOD_ContainerNode:i.geometries&&0!=i.geometries.length?t.KindOfNode.NOD_ContainerNode:i.primitives&&0!=i.primitives.length?t.KindOfNode.NOD_SolidNode:i.vcount?t.KindOfNode.NOD_GP:t.KindOfNode.NOD_Unknown},getNodeUID:function(t){throw"Error: not implemented method"},getPlaneData:function(t){throw"Error: not implemented method"},getPointData:function(t){throw"Error: not implemented method"},getPolyLineData:function(t){throw"Error: not implemented method"},getRootNode:function(t){return this._associatedDocument._internalRepresentationIndex},getRootNodesCount:function(){return 1},getSAG:function(t){throw"Error: not implemented method"},getSphereData:function(t){throw"Error: not implemented method"},isIndexed:function(){return!1}})}),define("DS/XCADDAEDocument/DAEProductInstance",["DS/XCADInputDocuments/XCADProductInstance"],function(t){"use strict";var e;return require(["DS/XCADDAEDocument/DAEProduct"],function(t){e=t}),t.extend(function(t,e){this._document=t,this._DAEProductInstance=e},{getGeometricProperties:function(){throw"Error: not implemented method"},getInstanceAttributes:function(){throw"Error: not implemented method"},getReferenceProduct:function(){return new e(this._document,this._DAEProductInstance)},getUID:function(){throw"Error: not implemented method"},getTransformation:function(){var t,e=this._DAEProductInstance.matrix;return void 0!==e&&(t=e),t}})}),define("DS/XCADDAEDocument/DAEProduct",["exports","DS/XCADInputDocuments/XCADProduct","DS/XCADDAEDocument/DAEProductInstance"],function(t,e,i){"use strict";var s=e.extend(function(t,e){this._document=t,this._DAEProduct=e},{getDocument:function(){var t,e;return this._DAEProduct.geometries&&0!=this._DAEProduct.geometries.length&&(e=this._DAEProduct.geometries),null!=e&&((t=this._document)._internalRepresentationIndex=e[0].url),t},getFilePath:function(){var t;return void 0!==this._DAEProduct.geomRep&&null!==this._DAEProduct.geomRep&&"external"===this._DAEProduct.geomRep.type&&(t=this._DAEProduct.geomRep.location),t},getGeometricProperties:function(){throw"Error: not implemented method"},getInstanceList:function(){var t=[];if(this._DAEProduct.nodes)for(var e=this._DAEProduct.nodes.length,s=0;s<e;s++){var r=new i(this._document,this._DAEProduct.nodes[s]);null!=r&&t.push(r)}return t},getProductAttributes:function(){var t=[];return t.push(this._DAEProduct.name||this._DAEProduct.id),t.push(""),t.push(""),t.push(""),t.push(""),t.push(e.SourceTypes.Unknown),t},getUID:function(){throw"Error: not implemented method"}});return t.DAEProduct=s,s}),define("DS/XCADDAEDocument/DAEInputDocument",["DS/XCADInputDocuments/XCADInputDocument","DS/XCADInputDocuments/XCADRepresentation","DS/XCADDAEDocument/DAETessellatedRepresentation","DS/XCADDAEDocument/DAEProductRepresentation","DS/XCADDAEDocument/DAEProduct","DS/Visualization/ThreeJS_DS"],function(t,e,i,s,r,n){"use strict";var a=null,o={},h={centerGeometry:!1,convertUpAxis:!1,subdivideFaces:!0,upAxis:"Z",defaultEnvMap:null,waitMaterial:new n.MeshPhongMaterial({color:new n.Color(16777215)})},c="Y",l=null,u=n.SmoothShading;function d(){this.id="",this.init_from=""}function p(){this.id="",this.name="",this.type="",this.skin=null,this.morph=null}function f(){this.method=null,this.source=null,this.targets=null,this.weights=null}function m(){this.source="",this.bindShapeMatrix=null,this.invBindMatrices=[],this.joints=[],this.weights=[]}function g(){this.id="",this.name="",this.nodes=[],this.scene=new n.Object3D}function v(){this.id="",this.name="",this.sid="",this.nodes=[],this.controllers=[],this.transforms=[],this.geometries=[],this.channels=[],this.matrix=new n.Matrix4}function b(){this.sid="",this.type="",this.data=[],this.obj=null}function N(){this.url="",this.skeleton=[],this.instance_material=[]}function y(){this.symbol="",this.target=""}function A(){this.url="",this.instance_material=[]}function D(){this.id="",this.mesh=null}function w(t){this.geometry=t.id,this.primitives=[],this.vertices=null}function x(){this.material="",this.count=0,this.inputs=[],this.vcount=null,this.p=[]}function _(){x.call(this),this.vcount=[]}function E(t){x.call(this),this.id=t,this.vcount=3}function T(){this.source="",this.count=0,this.stride=0,this.params=[]}function O(){this.input={}}function C(){this.semantic="",this.offset=0,this.source="",this.set=0}function k(t){this.id=t,this.type=null}function R(){this.id="",this.name="",this.instance_effect=null}function P(){this.color=new n.Color(0),this.color.setRGB(Math.random(),Math.random(),Math.random()),this.color.a=1,this.texture=null,this.texcoord=null,this.texOpts=null}function I(t,e){this.type=t,this.effect=e,this.material=null}function S(t){this.effect=t,this.init_from=null,this.format=null}function X(t){this.effect=t,this.source=null,this.wrap_s=null,this.wrap_t=null,this.minfilter=null,this.magfilter=null,this.mipfilter=null}function M(){this.id="",this.name="",this.shader=null,this.surface={},this.sampler={}}function j(){this.url=""}function L(){this.id="",this.name="",this.source={},this.sampler=[],this.channel=[]}function U(t){this.animation=t,this.source="",this.target="",this.fullSid=null,this.sid=null,this.dotSyntax=null,this.arrSyntax=null,this.arrIndices=null,this.member=null}function Y(t){this.id="",this.animation=t,this.inputs=[],this.input=null,this.output=null,this.strideOut=null,this.interpolation=null,this.startTime=null,this.endTime=null,this.duration=0}function G(t){this.targets=[],this.time=t}function B(){this.id="",this.name="",this.technique=""}function V(){this.url=""}function F(t){var e=t.getAttribute("id");return null!=o[e]?o[e]:(o[e]=new k(e).parse(t),o[e])}function z(t){return"dae"==t?"http://www.collada.org/2005/11/COLLADASchema":null}function Z(t){for(var e=W(t),i=[],s=0,r=e.length;s<r;s++)i.push("true"==e[s]||"1"==e[s]);return i}function q(t){for(var e=W(t),i=[],s=0,r=e.length;s<r;s++)i.push(parseFloat(e[s]));return i}function K(t){for(var e=W(t),i=[],s=0,r=e.length;s<r;s++)i.push(parseInt(e[s],10));return i}function W(t){return t.length>0?function(t){return t.replace(/^\s+/,"").replace(/\s+$/,"")}(t).split(/\s+/):[]}function H(t,e,i){return t.hasAttribute(e)?parseInt(t.getAttribute(e),10):i}function J(t,e){for(var i=a.COLLADA.evaluate(e,t,z,XPathResult.ORDERED_NODE_ITERATOR_TYPE,null),s=i.iterateNext(),r=[];s;)r.push(s),s=i.iterateNext();return r}function $(t,e){t.doubleSided=!1;var i=a.COLLADA.evaluate(".//dae:extra//dae:double_sided",e,z,XPathResult.ORDERED_NODE_ITERATOR_TYPE,null);i&&(i=i.iterateNext())&&1===parseInt(i.textContent,10)&&(t.doubleSided=!0)}function Q(t,e){if(h.convertUpAxis&&c!==h.upAxis)switch(l){case"XtoY":var i=t[0];t[0]=e*t[1],t[1]=i;break;case"XtoZ":i=t[2];t[2]=t[1],t[1]=t[0],t[0]=i;break;case"YtoX":i=t[0];t[0]=t[1],t[1]=e*i;break;case"YtoZ":i=t[1];t[1]=e*t[2],t[2]=i;break;case"ZtoX":i=t[0];t[0]=t[1],t[1]=t[2],t[2]=i;break;case"ZtoY":i=t[1];t[1]=t[2],t[2]=e*i}}function tt(t,e){var i=[t[e],t[e+1],t[e+2]];return Q(i,-1),i}function et(t){if(h.convertUpAxis){var e=[t[0],t[4],t[8]];Q(e,-1),t[0]=e[0],t[4]=e[1],t[8]=e[2],Q(e=[t[1],t[5],t[9]],-1),t[1]=e[0],t[5]=e[1],t[9]=e[2],Q(e=[t[2],t[6],t[10]],-1),t[2]=e[0],t[6]=e[1],t[10]=e[2],Q(e=[t[0],t[1],t[2]],-1),t[0]=e[0],t[1]=e[1],t[2]=e[2],Q(e=[t[4],t[5],t[6]],-1),t[4]=e[0],t[5]=e[1],t[6]=e[2],Q(e=[t[8],t[9],t[10]],-1),t[8]=e[0],t[9]=e[1],t[10]=e[2],Q(e=[t[3],t[7],t[11]],-1),t[3]=e[0],t[7]=e[1],t[11]=e[2]}return new n.Matrix4(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])}return d.prototype.parse=function(t){this.id=t.getAttribute("id");for(var e=0;e<t.childNodes.length;e++){var i=t.childNodes[e];"init_from"==i.nodeName&&(this.init_from=i.textContent)}return this},p.prototype.parse=function(t){this.id=t.getAttribute("id"),this.name=t.getAttribute("name"),this.type="none";for(var e=0;e<t.childNodes.length;e++){var i=t.childNodes[e];switch(i.nodeName){case"skin":this.skin=(new m).parse(i),this.type=i.nodeName;break;case"morph":this.morph=(new f).parse(i),this.type=i.nodeName}}return this},f.prototype.parse=function(t){var e,i={},s=[];for(this.method=t.getAttribute("method"),this.source=t.getAttribute("source").replace(/^#/,""),e=0;e<t.childNodes.length;e++){var r=t.childNodes[e];if(1==r.nodeType)switch(r.nodeName){case"source":i[(a=(new k).parse(r)).id]=a;break;case"targets":s=this.parseInputs(r);break;default:console.log(r.nodeName)}}for(e=0;e<s.length;e++){var n=s[e],a=i[n.source];switch(n.semantic){case"MORPH_TARGET":this.targets=a.read();break;case"MORPH_WEIGHT":this.weights=a.read()}}return this},f.prototype.parseInputs=function(t){for(var e=[],i=0;i<t.childNodes.length;i++){var s=t.childNodes[i];if(1==s.nodeType)switch(s.nodeName){case"input":e.push((new C).parse(s))}}return e},m.prototype.parse=function(t){var e,i,s={};this.source=t.getAttribute("source").replace(/^#/,""),this.invBindMatrices=[],this.joints=[],this.weights=[];for(var r=0;r<t.childNodes.length;r++){var n=t.childNodes[r];if(1==n.nodeType)switch(n.nodeName){case"bind_shape_matrix":var a=q(n.textContent);this.bindShapeMatrix=et(a);break;case"source":var o=(new k).parse(n);s[o.id]=o;break;case"joints":e=n;break;case"vertex_weights":i=n;break;default:console.log(n.nodeName)}}return this.parseJoints(e,s),this.parseWeights(i,s),this},m.prototype.parseJoints=function(t,e){for(var i=0;i<t.childNodes.length;i++){var s=t.childNodes[i];if(1==s.nodeType)switch(s.nodeName){case"input":var r=(new C).parse(s),n=e[r.source];"JOINT"==r.semantic?this.joints=n.read():"INV_BIND_MATRIX"==r.semantic&&(this.invBindMatrices=n.read())}}},m.prototype.parseWeights=function(t,e){for(var i,s,r=[],n=0;n<t.childNodes.length;n++){var a=t.childNodes[n];if(1==a.nodeType)switch(a.nodeName){case"input":r.push((new C).parse(a));break;case"v":i=K(a.textContent);break;case"vcount":s=K(a.textContent)}}var o=0;for(n=0;n<s.length;n++){for(var h=s[n],c=[],l=0;l<h;l++){for(var u={},d=0;d<r.length;d++){var p=r[d],f=i[o+p.offset];switch(p.semantic){case"JOINT":u.joint=f;break;case"WEIGHT":u.weight=e[p.source].data[f]}}c.push(u),o+=r.length}for(l=0;l<c.length;l++)c[l].index=n;this.weights.push(c)}},g.prototype.getChildById=function(t,e){for(var i=0;i<this.nodes.length;i++){var s=this.nodes[i].getChildById(t,e);if(s)return s}return null},g.prototype.getChildBySid=function(t,e){for(var i=0;i<this.nodes.length;i++){var s=this.nodes[i].getChildBySid(t,e);if(s)return s}return null},g.prototype.parse=function(t){this.id=t.getAttribute("id"),this.name=t.getAttribute("name"),this.nodes=[];for(var e=0;e<t.childNodes.length;e++){var i=t.childNodes[e];if(1==i.nodeType)switch(i.nodeName){case"node":this.nodes.push((new v).parse(i))}}return this},v.prototype.getChannelForTransform=function(t){for(var e=0;e<this.channels.length;e++){var i,s=this.channels[e],r=s.target.split("/"),n=(r.shift(),r.shift()),a=n.indexOf(".")>=0,o=n.indexOf("(")>=0;if(a)r=n.split("."),n=r.shift(),r.shift();else if(o){i=n.split("("),n=i.shift();for(var h=0;h<i.length;h++)i[h]=parseInt(i[h].replace(/\)/,""))}if(n==t)return s.info={sid:n,dotSyntax:a,arrSyntax:o,arrIndices:i},s}return null},v.prototype.getChildById=function(t,e){if(this.id==t)return this;if(e)for(var i=0;i<this.nodes.length;i++){var s=this.nodes[i].getChildById(t,e);if(s)return s}return null},v.prototype.getChildBySid=function(t,e){if(this.sid==t)return this;if(e)for(var i=0;i<this.nodes.length;i++){var s=this.nodes[i].getChildBySid(t,e);if(s)return s}return null},v.prototype.getTransformBySid=function(t){for(var e=0;e<this.transforms.length;e++)if(this.transforms[e].sid==t)return this.transforms[e];return null},v.prototype.parse=function(t){var e,i;this.id=t.getAttribute("id"),this.sid=t.getAttribute("sid"),this.name=t.getAttribute("name"),this.type=t.getAttribute("type"),this.type="JOINT"==this.type?this.type:"NODE",this.nodes=[],this.transforms=[],this.geometries=[],this.cameras=[],this.controllers=[],this.matrix=new n.Matrix4;for(var s=0;s<t.childNodes.length;s++){var r=t.childNodes[s];if(1==r.nodeType)switch(r.nodeName){case"node":this.nodes.push((new v).parse(r));break;case"instance_camera":this.cameras.push((new V).parse(r));break;case"instance_controller":this.controllers.push((new N).parse(r));break;case"instance_geometry":this.geometries.push((new A).parse(r));break;case"instance_light":break;case"instance_node":e=r.getAttribute("url").replace(/^#/,"");var o=(i=e,a.COLLADA.evaluate(".//dae:library_nodes//dae:node[@id='"+i+"']",a.COLLADA,z,XPathResult.ORDERED_NODE_ITERATOR_TYPE,null).iterateNext());o&&this.nodes.push((new v).parse(o));break;case"rotate":case"translate":case"scale":case"matrix":case"lookat":case"skew":this.transforms.push((new b).parse(r));break;case"extra":break;default:console.log(r.nodeName)}}return this.channels=function(t){var e=[],i=1e6,s=-1e6;for(var r in a.animations)for(var n=a.animations[r],o=0;o<n.channel.length;o++){var h=n.channel[o],c=n.sampler[o],r=h.target.split("/")[0];r==t.id&&(c.create(),h.sampler=c,i=Math.min(i,c.startTime),s=Math.max(s,c.endTime),e.push(h))}e.length&&(t.startTime=i,t.endTime=s);return e}(this),function(t){if(t.channels&&t.channels.length){for(var e=[],i=[],s=0,r=t.channels.length;s<r;s++){var n,a=t.channels[s],o=a.fullSid,h=a.sampler,c=h.input,l=t.getTransformBySid(a.sid);if(a.arrIndices){n=[];for(var u=0,d=a.arrIndices.length;u<d;u++)n[u]=getConvertedIndex(a.arrIndices[u])}else n=getConvertedMember(a.member);if(l){-1===i.indexOf(o)&&i.push(o);for(var u=0,d=c.length;u<d;u++){var p=c[u],f=h.getData(l.type,u),m=findKey(e,p);if(!m){m=new G(p);var g=findTimeNdx(e,p);e.splice(-1==g?e.length:g,0,m)}m.addTarget(o,l,n,f)}}else console.log('Could not find transform "'+a.sid+'" in node '+t.id)}for(var s=0;s<i.length;s++)for(var v=i[s],u=0;u<e.length;u++){var m=e[u];m.hasTarget(v)||interpolateKeys(e,m,u,v)}t.keys=e,t.sids=i}}(this),this.updateMatrix(),this},v.prototype.updateMatrix=function(){this.matrix.identity();for(var t=0;t<this.transforms.length;t++)this.transforms[t].apply(this.matrix)},b.prototype.parse=function(t){return this.sid=t.getAttribute("sid"),this.type=t.nodeName,this.data=q(t.textContent),this.convert(),this},b.prototype.convert=function(){switch(this.type){case"matrix":this.obj=et(this.data);break;case"rotate":this.angle=n.Math.degToRad(this.data[3]);case"translate":Q(this.data,-1),this.obj=new n.Vector3(this.data[0],this.data[1],this.data[2]);break;case"scale":Q(this.data,1),this.obj=new n.Vector3(this.data[0],this.data[1],this.data[2]);break;default:console.log("Can not convert Transform of type "+this.type)}},b.prototype.apply=function(t){switch(this.type){case"matrix":t.multiply(this.obj);break;case"translate":t.translate(this.obj);break;case"rotate":t.rotateByAxis(this.obj,this.angle);break;case"scale":t.scale(this.obj)}},b.prototype.update=function(t,e){var i=["X","Y","Z","ANGLE"];switch(this.type){case"matrix":if(e)if(1===e.length)switch(e[0]){case 0:this.obj.n11=t[0],this.obj.n21=t[1],this.obj.n31=t[2],this.obj.n41=t[3];break;case 1:this.obj.n12=t[0],this.obj.n22=t[1],this.obj.n32=t[2],this.obj.n42=t[3];break;case 2:this.obj.n13=t[0],this.obj.n23=t[1],this.obj.n33=t[2],this.obj.n43=t[3];break;case 3:this.obj.n14=t[0],this.obj.n24=t[1],this.obj.n34=t[2],this.obj.n44=t[3]}else if(2===e.length){var s="n"+(e[0]+1)+(e[1]+1);this.obj[s]=t}else console.log("Incorrect addressing of matrix in transform.");else this.obj.copy(t);break;case"translate":case"scale":switch("[object Array]"===Object.prototype.toString.call(e)&&(e=i[e[0]]),e){case"X":this.obj.x=t;break;case"Y":this.obj.y=t;break;case"Z":this.obj.z=t;break;default:this.obj.x=t[0],this.obj.y=t[1],this.obj.z=t[2]}break;case"rotate":switch("[object Array]"===Object.prototype.toString.call(e)&&(e=i[e[0]]),e){case"X":this.obj.x=t;break;case"Y":this.obj.y=t;break;case"Z":this.obj.z=t;break;case"ANGLE":this.angle=n.Math.degToRad(t);break;default:this.obj.x=t[0],this.obj.y=t[1],this.obj.z=t[2],this.angle=n.Math.degToRad(t[3])}}},N.prototype.parse=function(t){this.url=t.getAttribute("url").replace(/^#/,""),this.skeleton=[],this.instance_material=[];for(var e=0;e<t.childNodes.length;e++){var i=t.childNodes[e];if(1===i.nodeType)switch(i.nodeName){case"skeleton":this.skeleton.push(i.textContent.replace(/^#/,""));break;case"bind_material":var s=a.COLLADA.evaluate(".//dae:instance_material",i,z,XPathResult.ORDERED_NODE_ITERATOR_TYPE,null);if(s)for(var r=s.iterateNext();r;)this.instance_material.push((new y).parse(r)),r=s.iterateNext()}}return this},y.prototype.parse=function(t){return this.symbol=t.getAttribute("symbol"),this.target=t.getAttribute("target").replace(/^#/,""),this},A.prototype.parse=function(t){this.url=t.getAttribute("url").replace(/^#/,""),this.instance_material=[];for(var e=0;e<t.childNodes.length;e++){var i=t.childNodes[e];if(1==i.nodeType&&"bind_material"==i.nodeName){var s=a.COLLADA.evaluate(".//dae:instance_material",i,z,XPathResult.ORDERED_NODE_ITERATOR_TYPE,null);if(s)for(var r=s.iterateNext();r;)this.instance_material.push((new y).parse(r)),r=s.iterateNext();break}}return this},D.prototype.parse=function(t){this.id=t.getAttribute("id"),$(this,t);for(var e=0;e<t.childNodes.length;e++){var i=t.childNodes[e];switch(i.nodeName){case"mesh":this.mesh=new w(this).parse(i)}}return this},w.prototype.parse=function(t){this.primitives=[];var e,i=0;for(e=0;e<t.childNodes.length;e++){var s=t.childNodes[e];switch(s.nodeName){case"source":F(s);break;case"vertices":this.vertices=(new O).parse(s);break;case"triangles":this.primitives.push(new E(this.geometry+"#"+i).parse(s)),i++;break;case"polygons":this.primitives.push((new x).parse(s));break;case"polylist":this.primitives.push((new _).parse(s))}}o[this.vertices.input.POSITION.source].data;for(e=0;e<this.primitives.length;e++){var r=this.primitives[e];r.setVertices(this.vertices),this.handlePrimitive(r,this.geometry3js)}return this},w.prototype.handlePrimitive=function(t,e){var i,s,r,a,h,c=t.p,l=t.inputs,u=0,d=3,p=0,f=[];for(i=0;i<l.length;i++){var m=(r=l[i]).offset+1;switch(p=p<m?m:p,r.semantic){case"TEXCOORD":f.push(r.set)}}for(var g=0;g<c.length;++g)for(var v=c[g],b=0;b<v.length;){var N=[],y=[],A=null,D=[];for(d=t.vcount?t.vcount.length?t.vcount[u++]:t.vcount:v.length/p,i=0;i<d;i++)for(s=0;s<l.length;s++)switch(r=l[s],h=o[r.source],a=v[b+i*p+r.offset]*h.accessor.params.length,r.semantic){case"VERTEX":N.push(tt(h.data,a));break;case"NORMAL":y.push(tt(h.data,a));break;case"TEXCOORD":void 0===(A=A||{})[r.set]&&(A[r.set]=[]),A[r.set].push(new n.Vector2(h.data[a],h.data[a+1]));break;case"COLOR":D.push((new n.Color).setRGB(h.data[a],h.data[a+1],h.data[a+2]))}null==t.vertices&&(t.vertices=[]),null==t.normals&&(t.normals=[]);for(var w=0;w<N.length;w++)for(var x=0;x<N[w].length;x++)t.vertices.push(N[w][x]);for(w=0;w<y.length;w++)for(x=0;x<N[w].length;x++)t.normals.push(y[w][x]);b+=p*d}},x.prototype.setVertices=function(t){for(var e=0;e<this.inputs.length;e++)this.inputs[e].source==t.id&&(this.inputs[e].source=t.input.POSITION.source)},x.prototype.parse=function(t){this.material=t.getAttribute("material"),this.count=H(t,"count",0);for(var e=0;e<t.childNodes.length;e++){var i=t.childNodes[e];switch(i.nodeName){case"input":this.inputs.push((new C).parse(t.childNodes[e]));break;case"vcount":this.vcount=K(i.textContent);break;case"p":this.p.push(K(i.textContent));break;case"ph":console.warn("polygon holes not yet supported!")}}return this},_.prototype=Object.create(x.prototype),E.prototype=Object.create(x.prototype),T.prototype.parse=function(t){this.params=[],this.source=t.getAttribute("source"),this.count=H(t,"count",0),this.stride=H(t,"stride",0);for(var e=0;e<t.childNodes.length;e++){var i=t.childNodes[e];if("param"==i.nodeName){var s={};s.name=i.getAttribute("name"),s.type=i.getAttribute("type"),this.params.push(s)}}return this},O.prototype.parse=function(t){this.id=t.getAttribute("id");for(var e=0;e<t.childNodes.length;e++)if("input"==t.childNodes[e].nodeName){var i=(new C).parse(t.childNodes[e]);this.input[i.semantic]=i}return this},C.prototype.parse=function(t){return this.semantic=t.getAttribute("semantic"),this.source=t.getAttribute("source").replace(/^#/,""),this.set=H(t,"set",-1),this.offset=H(t,"offset",0),"TEXCOORD"==this.semantic&&this.set<0&&(this.set=0),this},k.prototype.parse=function(t){this.id=t.getAttribute("id");for(var e=0;e<t.childNodes.length;e++){var i=t.childNodes[e];switch(i.nodeName){case"bool_array":this.data=Z(i.textContent),this.type=i.nodeName;break;case"float_array":this.data=q(i.textContent),this.type=i.nodeName;break;case"int_array":this.data=K(i.textContent),this.type=i.nodeName;break;case"IDREF_array":case"Name_array":this.data=W(i.textContent),this.type=i.nodeName;break;case"technique_common":for(var s=0;s<i.childNodes.length;s++)if("accessor"==i.childNodes[s].nodeName){this.accessor=(new T).parse(i.childNodes[s]);break}}}return this},k.prototype.read=function(){var t=[],e=this.accessor.params[0];switch(e.type){case"IDREF":case"Name":case"name":case"float":return this.data;case"float4x4":for(var i=0;i<this.data.length;i+=16){var s=et(this.data.slice(i,i+16));t.push(s)}break;default:console.log("ColladaLoader: Source: Read dont know how to read "+e.type+".")}return t},R.prototype.parse=function(t){this.id=t.getAttribute("id"),this.name=t.getAttribute("name");for(var e=0;e<t.childNodes.length;e++)if("instance_effect"==t.childNodes[e].nodeName){this.instance_effect=(new j).parse(t.childNodes[e]);break}return this},P.prototype.isColor=function(){return null==this.texture},P.prototype.isTexture=function(){return null!=this.texture},P.prototype.parse=function(t){for(var e=0;e<t.childNodes.length;e++){var i=t.childNodes[e];if(1==i.nodeType)switch(i.nodeName){case"color":var s=q(i.textContent);this.color=new n.Color(0),this.color.setRGB(s[0],s[1],s[2]),this.color.a=s[3];break;case"texture":this.texture=i.getAttribute("texture"),this.texcoord=i.getAttribute("texcoord"),this.texOpts={offsetU:0,offsetV:0,repeatU:1,repeatV:1,wrapU:1,wrapV:1},this.parseTexture(i)}}return this},P.prototype.parseTexture=function(t){if(!t.childNodes)return this;t.childNodes[1]&&"extra"===t.childNodes[1].nodeName&&(t=t.childNodes[1]).childNodes[1]&&"technique"===t.childNodes[1].nodeName&&(t=t.childNodes[1]);for(var e=0;e<t.childNodes.length;e++){var i=t.childNodes[e];switch(i.nodeName){case"offsetU":case"offsetV":case"repeatU":case"repeatV":this.texOpts[i.nodeName]=parseFloat(i.textContent);break;case"wrapU":case"wrapV":this.texOpts[i.nodeName]=parseInt(i.textContent);break;default:this.texOpts[i.nodeName]=i.textContent}}return this},I.prototype.parse=function(t){for(var e=0;e<t.childNodes.length;e++){var i=t.childNodes[e];if(1==i.nodeType)switch(i.nodeName){case"ambient":case"emission":case"diffuse":case"specular":case"transparent":case"normal":this[i.nodeName]=(new P).parse(i);break;case"shininess":case"reflectivity":case"index_of_refraction":case"transparency":var s=J(i,".//dae:float");s.length>0&&(this[i.nodeName]=parseFloat(s[0].textContent))}}return this.create(),this},I.prototype.create=function(){var t={},e=void 0!==this.transparency&&this.transparency<1,i=null;function s(){i&&i.numberOfAwaitedTextures&&(i.numberOfAwaitedTextures--,0===i.numberOfAwaitedTextures&&delete i.numberOfAwaitedTextures)}for(var r in this)switch(r){case"ambient":case"emission":case"diffuse":case"specular":case"normal":var o=this[r];if(o instanceof P)if(o.isTexture()){var c=o.texture,l=this.effect.sampler[c].source;if(l){var d=this.effect.surface[l],p=a.images[d.init_from];if(p){var f=n.ImageUtils.loadTexture(void 0+p.init_from,void 0,s,null,!0);0,f.wrapS=o.texOpts.wrapU?n.RepeatWrapping:n.ClampToEdgeWrapping,f.wrapT=o.texOpts.wrapV?n.RepeatWrapping:n.ClampToEdgeWrapping,f.offset.x=o.texOpts.offsetU,f.offset.y=o.texOpts.offsetV,f.repeat.x=o.texOpts.repeatU,f.repeat.y=o.texOpts.repeatV,"normal"===r?t.normalMap=f:t.map=f,"emission"===r&&(t.emissive=16777215)}}}else"diffuse"!==r&&e||("emission"===r?t.emissive=o.color.getHex():t[r]=o.color.getHex());break;case"shininess":t[r]=this[r];break;case"reflectivity":t[r]=this[r],t[r]>0&&(t.envMap=h.defaultEnvMap),t.combine=n.MixOperation;break;case"index_of_refraction":t.refractionRatio=this[r],1!==this[r]&&(t.envMap=h.defaultEnvMap);break;case"transparency":e&&(t.transparent=!0,t.opacity=this[r],e=!0)}switch(t.shading=u,t.side=this.effect.doubleSided?n.DoubleSide:n.FrontSide,this.type){case"constant":null!=t.emissive&&(t.color=t.emissive),i=new n.MeshBasicMaterial(t);break;case"phong":case"blinn":null!=t.diffuse&&(t.color=t.diffuse),i=new n.MeshPhongMaterial(t);break;case"lambert":default:null!=t.diffuse&&(t.color=t.diffuse),i=new n.MeshLambertMaterial(t)}return this.material=i,this.material},S.prototype.parse=function(t){for(var e=0;e<t.childNodes.length;e++){var i=t.childNodes[e];if(1==i.nodeType)switch(i.nodeName){case"init_from":this.init_from=i.textContent;break;case"format":this.format=i.textContent;break;default:console.log("unhandled Surface prop: "+i.nodeName)}}return this},X.prototype.parse=function(t){for(var e=0;e<t.childNodes.length;e++){var i=t.childNodes[e];if(1==i.nodeType)switch(i.nodeName){case"source":this.source=i.textContent;break;case"minfilter":this.minfilter=i.textContent;break;case"magfilter":this.magfilter=i.textContent;break;case"mipfilter":this.mipfilter=i.textContent;break;case"wrap_s":this.wrap_s=i.textContent;break;case"wrap_t":this.wrap_t=i.textContent;break;default:console.log("unhandled Sampler2D prop: "+i.nodeName)}}return this},M.prototype.create=function(){if(null==this.shader)return null},M.prototype.parse=function(t){this.id=t.getAttribute("id"),this.name=t.getAttribute("name"),$(this,t),this.shader=null;for(var e=0;e<t.childNodes.length;e++){var i=t.childNodes[e];if(1==i.nodeType)switch(i.nodeName){case"profile_COMMON":this.parseTechnique(this.parseProfileCOMMON(i))}}return this},M.prototype.parseNewparam=function(t){for(var e=t.getAttribute("sid"),i=0;i<t.childNodes.length;i++){var s=t.childNodes[i];if(1==s.nodeType)switch(s.nodeName){case"surface":this.surface[e]=new S(this).parse(s);break;case"sampler2D":this.sampler[e]=new X(this).parse(s);break;case"extra":break;default:console.log(s.nodeName)}}},M.prototype.parseProfileCOMMON=function(t){for(var e,i=0;i<t.childNodes.length;i++){var s=t.childNodes[i];if(1==s.nodeType)switch(s.nodeName){case"profile_COMMON":this.parseProfileCOMMON(s);break;case"technique":e=s;break;case"newparam":this.parseNewparam(s);break;case"image":var r=(new d).parse(s);a.images[r.id]=r;break;case"extra":break;default:console.log(s.nodeName)}}return e},M.prototype.parseTechnique=function(t){for(var e=0;e<t.childNodes.length;e++){var i=t.childNodes[e];if(1==i.nodeType)switch(i.nodeName){case"constant":case"lambert":case"blinn":case"phong":this.shader=new I(i.nodeName,this).parse(i)}}},j.prototype.parse=function(t){return this.url=t.getAttribute("url").replace(/^#/,""),this},L.prototype.parse=function(t){this.id=t.getAttribute("id"),this.name=t.getAttribute("name"),this.source={};for(var e=0;e<t.childNodes.length;e++){var i=t.childNodes[e];if(1==i.nodeType)switch(i.nodeName){case"animation":var s=(new L).parse(i);for(var r in s.source)this.source[r]=s.source[r];for(var n=0;n<s.channel.length;n++)this.channel.push(s.channel[n]),this.sampler.push(s.sampler[n]);break;case"source":r=(new k).parse(i);this.source[r.id]=r;break;case"sampler":this.sampler.push(new Y(this).parse(i));break;case"channel":this.channel.push(new U(this).parse(i))}}return this},U.prototype.parse=function(t){this.source=t.getAttribute("source").replace(/^#/,""),this.target=t.getAttribute("target");var e=this.target.split("/"),i=(e.shift(),e.shift()),s=i.indexOf(".")>=0,r=i.indexOf("(")>=0;if(s)e=i.split("."),this.sid=e.shift(),this.member=e.shift();else if(r){var n=i.split("(");this.sid=n.shift();for(var a=0;a<n.length;a++)n[a]=parseInt(n[a].replace(/\)/,""));this.arrIndices=n}else this.sid=i;return this.fullSid=i,this.dotSyntax=s,this.arrSyntax=r,this},Y.prototype.parse=function(t){this.id=t.getAttribute("id"),this.inputs=[];for(var e=0;e<t.childNodes.length;e++){var i=t.childNodes[e];if(1==i.nodeType)switch(i.nodeName){case"input":this.inputs.push((new C).parse(i))}}return this},Y.prototype.create=function(){for(var t=0;t<this.inputs.length;t++){var e=this.inputs[t],i=this.animation.source[e.source];switch(e.semantic){case"INPUT":this.input=i.read();break;case"OUTPUT":this.output=i.read(),this.strideOut=i.accessor.stride;break;case"INTERPOLATION":this.interpolation=i.read();break;case"IN_TANGENT":case"OUT_TANGENT":break;default:console.log(e.semantic)}}if(this.startTime=0,this.endTime=0,this.duration=0,this.input.length){this.startTime=1e8,this.endTime=-1e8;for(t=0;t<this.input.length;t++)this.startTime=Math.min(this.startTime,this.input[t]),this.endTime=Math.max(this.endTime,this.input[t]);this.duration=this.endTime-this.startTime}},Y.prototype.getData=function(t,e){var i;if("matrix"===t&&16===this.strideOut)i=this.output[e];else if(this.strideOut>1){i=[],e*=this.strideOut;for(var s=0;s<this.strideOut;++s)i[s]=this.output[e+s];if(3===this.strideOut)switch(t){case"rotate":case"translate":Q(i,-1);break;case"scale":Q(i,1)}else 4===this.strideOut&&"matrix"===t&&Q(i,-1)}else i=this.output[e];return i},G.prototype.addTarget=function(t,e,i,s){this.targets.push({sid:t,member:i,transform:e,data:s})},G.prototype.apply=function(t){for(var e=0;e<this.targets.length;++e){var i=this.targets[e];t&&i.sid!==t||i.transform.update(i.data,i.member)}},G.prototype.getTarget=function(t){for(var e=0;e<this.targets.length;++e)if(this.targets[e].sid===t)return this.targets[e];return null},G.prototype.hasTarget=function(t){for(var e=0;e<this.targets.length;++e)if(this.targets[e].sid===t)return!0;return!1},G.prototype.interpolate=function(t,e){for(var i=0;i<this.targets.length;++i){var s,r=this.targets[i],n=t.getTarget(r.sid);if("matrix"!==r.transform.type&&n){var a=(e-this.time)/(t.time-this.time),o=n.data,h=r.data;if((a<0||a>1)&&(console.log("Key.interpolate: Warning! Scale out of bounds:"+a),a=a<0?0:1),h.length){s=[];for(var c=0;c<h.length;++c)s[c]=h[c]+(o[c]-h[c])*a}else s=h+(o-h)*a}else s=r.data;r.transform.update(s,r.member)}},B.prototype.parse=function(t){this.id=t.getAttribute("id"),this.name=t.getAttribute("name");for(var e=0;e<t.childNodes.length;e++){var i=t.childNodes[e];if(1==i.nodeType)switch(i.nodeName){case"optics":this.parseOptics(i)}}return this},B.prototype.parseOptics=function(t){for(var e=0;e<t.childNodes.length;e++)if("technique_common"==t.childNodes[e].nodeName)for(var i=t.childNodes[e],s=0;s<i.childNodes.length;s++)if(this.technique=i.childNodes[s].nodeName,"perspective"==this.technique)for(var r=i.childNodes[s],n=0;n<r.childNodes.length;n++){switch((o=r.childNodes[n]).nodeName){case"yfov":this.yfov=o.textContent;break;case"xfov":this.xfov=o.textContent;break;case"znear":this.znear=o.textContent;break;case"zfar":this.zfar=o.textContent;break;case"aspect_ratio":this.aspect_ratio=o.textContent}}else if("orthographic"==this.technique){var a=i.childNodes[s];for(n=0;n<a.childNodes.length;n++){var o;switch((o=a.childNodes[n]).nodeName){case"xmag":this.xmag=o.textContent;break;case"ymag":this.ymag=o.textContent;break;case"znear":this.znear=o.textContent;break;case"zfar":this.zfar=o.textContent;break;case"aspect_ratio":this.aspect_ratio=o.textContent}}}return this},V.prototype.parse=function(t){return this.url=t.getAttribute("url").replace(/^#/,""),this},t.extend(function(){a=this,this.COLLADA=null,this.images=[],this.materials=[],this.effects=[],this.geometries=[],this.cameras=[],this.controllers=[],this.animations=[],this.visualScenes=[]},{close:function(){},getGeomRep:function(t){throw"Error: not implemented method"},getInstanceList:function(t){throw"Error: not implemented method"},getReferencedFiles:function(){throw"Error: not implemented method"},getReferenceName:function(t){throw"Error: not implemented method"},getRepresentation:function(t){var n;if(t===e.XCAD_PRODUCT_REPRESENTATION){n=new s(this,e.XCAD_PRODUCT_REPRESENTATION,"root");var a=this.COLLADA.evaluate(".//dae:scene/dae:instance_visual_scene",this.COLLADA,z,XPathResult.ORDERED_NODE_ITERATOR_TYPE,null).iterateNext();if(a){var o=a.getAttribute("url").replace(/^#/,""),h=this.visualScenes[o.length>0?o:"visual_scene0"],c=new r(this,h);n.addRootProduct(c)}}else t===e.XCAD_TESSELLATED_REPRESENTATION&&void 0!==this._internalRepresentationIndex&&0!=this.geometries[this._internalRepresentationIndex].mesh.primitives.length&&(n=new i(this));return n},getRepresentationType:function(t){throw"Error: not implemented method"},getTransformation:function(t){throw"Error: not implemented method"},getRootProducts:function(){throw"Error: not implemented method"},initialize:function(t){if(""!==t){if("string"==typeof t){var e=(new DOMParser).parseFromString(t,"application/xml");a.COLLADA=e}else a.COLLADA=t;return function(){var t=a.COLLADA.evaluate("//dae:asset",a.COLLADA,z,XPathResult.ORDERED_NODE_ITERATOR_TYPE,null).iterateNext();if(t&&t.childNodes)for(var e=0;e<t.childNodes.length;e++){var i=t.childNodes[e];switch(i.nodeName){case"unit":var s=i.getAttribute("meter");s&&parseFloat(s);break;case"up_axis":c=i.textContent.charAt(0)}}}(),function(){if(h.convertUpAxis&&c!==h.upAxis)switch(c){case"X":l="Y"===h.upAxis?"XtoY":"XtoZ";break;case"Y":l="X"===h.upAxis?"YtoX":"YtoZ";break;case"Z":l="X"===h.upAxis?"ZtoX":"ZtoY"}else l=null}(),this.images=i("//dae:library_images/dae:image",d,"image"),this.materials=i("//dae:library_materials/dae:material",R,"material"),this.effects=i("//dae:library_effects/dae:effect",M,"effect"),this.geometries=i("//dae:library_geometries/dae:geometry",D,"geometry"),this.cameras=i(".//dae:library_cameras/dae:camera",B,"camera"),this.controllers=i("//dae:library_controllers/dae:controller",p,"controller"),this.animations=i("//dae:library_animations/dae:animation",L,"animation"),void(this.visualScenes=i(".//dae:library_visual_scenes/dae:visual_scene",g,"visual_scene"))}function i(t,e,i){for(var s=a.COLLADA.evaluate(t,a.COLLADA,z,XPathResult.ORDERED_NODE_ITERATOR_TYPE,null),r={},n=s.iterateNext(),o=0;n;){var h=(new e).parse(n);h.id&&0!=h.id.length||(h.id=i+o++),r[h.id]=h,n=s.iterateNext()}return r}}})});