define("DS/XCityCoreUI/PbrControler",["UWA/Class","DS/XCityTools/Debug","DS/XCityTools/EventDispatcher","DS/Controls/Gauge","DS/Controls/Button","DS/Controls/Toggle","DS/Controls/ButtonGroup","DS/Controls/SpinBox"],function(e,t,i,n,a,s,l,o){"use strict";return UWA.Class.extend({init:function(){this.container=new UWA.Element("div",{html:'<div class="xct-title">Colors</div><div class="xct-parameter"><div class="xct-label">Albedo / Diffuse</div><div id="albedoInput" class="xct-input"><div class="xct-horizontal xct-one-third"><div class="xct-label xct-sublabel">R:</div><div id="albedoRInput"></div></div><div class="xct-horizontal xct-one-third"><div class="xct-label xct-sublabel">G:</div><div id="albedoGInput"></div></div><div class="xct-horizontal xct-one-third"><div class="xct-label xct-sublabel">B:</div><div id="albedoBInput"></div></div></div></div><div class="xct-parameter"><div class="xct-label">Ambient</div><div id="ambientInput" class="xct-input"><div class="xct-horizontal xct-one-third"><div class="xct-label xct-sublabel">R:</div><div id="ambientRInput"></div></div><div class="xct-horizontal xct-one-third"><div class="xct-label xct-sublabel">G:</div><div id="ambientGInput"></div></div><div class="xct-horizontal xct-one-third"><div class="xct-label xct-sublabel">B:</div><div id="ambientBInput"></div></div></div></div><div class="xct-parameter"><div class="xct-label">Specular</div><div id="specularInput" class="xct-input"><div class="xct-horizontal xct-one-third"><div class="xct-label xct-sublabel">R:</div><div id="specularRInput"></div></div><div class="xct-horizontal xct-one-third"><div class="xct-label xct-sublabel">G:</div><div id="specularGInput"></div></div><div class="xct-horizontal xct-one-third"><div class="xct-label xct-sublabel">B:</div><div id="specularBInput"></div></div></div></div><div class="xct-parameter"><div class="xct-label">Emissive</div><div id="emissiveColorInput" class="xct-input"><div class="xct-horizontal xct-one-third"><div class="xct-label xct-sublabel">R:</div><div id="emissiveRInput"></div></div><div class="xct-horizontal xct-one-third"><div class="xct-label xct-sublabel">G:</div><div id="emissiveGInput"></div></div><div class="xct-horizontal xct-one-third"><div class="xct-label xct-sublabel">B:</div><div id="emissiveBInput"></div></div></div></div><div class="xct-separator"></div><div class="xct-title">Values</div><div class="xct-parameter"><div class="xct-label">Metalness</div><div id="metalnessInput" class="xct-input"></div></div><div class="xct-parameter"><div class="xct-label">Roughness</div><div id="roughnessInput" class="xct-input"></div></div><div class="xct-parameter"><div class="xct-label">IOR</div><div id="iorInput" class="xct-input"></div></div><div class="xct-parameter"><div class="xct-label">Transparency</div><div id="transparencyInput" class="xct-input"></div></div><div class="xct-parameter"><div class="xct-label">Emissive</div><div id="emissiveInput" class="xct-input"></div></div>'})},setup:function(){var e=document.getElementById("albedoRInput");this.albedoRSpinbox=new o({value:1,minValue:0,maxValue:1,stepValue:.1,pageStepValue:1,displayStyle:"lite"}),this.albedoRSpinbox.getContent().addClassName("xct-min-width"),this.albedoRSpinbox.inject(e);var t=document.getElementById("albedoGInput");this.albedoGSpinbox=new o({value:1,minValue:0,maxValue:1,stepValue:.1,pageStepValue:1,displayStyle:"lite"}),this.albedoGSpinbox.getContent().addClassName("xct-min-width"),this.albedoGSpinbox.inject(t);var i=document.getElementById("albedoBInput");this.albedoBSpinbox=new o({value:1,minValue:0,maxValue:1,stepValue:.1,pageStepValue:1,displayStyle:"lite"}),this.albedoBSpinbox.getContent().addClassName("xct-min-width"),this.albedoBSpinbox.inject(i);var n=document.getElementById("ambientRInput");this.ambientRSpinbox=new o({value:1,minValue:0,maxValue:1,stepValue:.1,pageStepValue:1,displayStyle:"lite"}),this.ambientRSpinbox.getContent().addClassName("xct-min-width"),this.ambientRSpinbox.inject(n);var s=document.getElementById("ambientGInput");this.ambientGSpinbox=new o({value:1,minValue:0,maxValue:1,stepValue:.1,pageStepValue:1,displayStyle:"lite"}),this.ambientGSpinbox.getContent().addClassName("xct-min-width"),this.ambientGSpinbox.inject(s);var l=document.getElementById("ambientBInput");this.ambientBSpinbox=new o({value:1,minValue:0,maxValue:1,stepValue:.1,pageStepValue:1,displayStyle:"lite"}),this.ambientBSpinbox.getContent().addClassName("xct-min-width"),this.ambientBSpinbox.inject(l);var r=document.getElementById("specularRInput");this.specularRSpinbox=new o({value:1,minValue:0,maxValue:1,stepValue:.1,pageStepValue:1,displayStyle:"lite"}),this.specularRSpinbox.getContent().addClassName("xct-min-width"),this.specularRSpinbox.inject(r);var d=document.getElementById("specularGInput");this.specularGSpinbox=new o({value:1,minValue:0,maxValue:1,stepValue:.1,pageStepValue:1,displayStyle:"lite"}),this.specularGSpinbox.getContent().addClassName("xct-min-width"),this.specularGSpinbox.inject(d);var c=document.getElementById("specularBInput");this.specularBSpinbox=new o({value:1,minValue:0,maxValue:1,stepValue:.1,pageStepValue:1,displayStyle:"lite"}),this.specularBSpinbox.getContent().addClassName("xct-min-width"),this.specularBSpinbox.inject(c);var u=document.getElementById("emissiveRInput");this.emissiveRSpinbox=new o({value:1,minValue:0,maxValue:1,stepValue:.1,pageStepValue:1,displayStyle:"lite"}),this.emissiveRSpinbox.getContent().addClassName("xct-min-width"),this.emissiveRSpinbox.inject(u);var h=document.getElementById("emissiveGInput");this.emissiveGSpinbox=new o({value:1,minValue:0,maxValue:1,stepValue:.1,pageStepValue:1,displayStyle:"lite"}),this.emissiveGSpinbox.getContent().addClassName("xct-min-width"),this.emissiveGSpinbox.inject(h);var m=document.getElementById("emissiveBInput");this.emissiveBSpinbox=new o({value:1,minValue:0,maxValue:1,stepValue:.1,pageStepValue:1,displayStyle:"lite"}),this.emissiveBSpinbox.getContent().addClassName("xct-min-width"),this.emissiveBSpinbox.inject(m);var p=document.getElementById("metalnessInput");this.metalnessSpinBox=new o({value:0,minValue:0,maxValue:1,stepValue:.01,pageStepValue:.1}),this.metalnessSpinBox.inject(p);var v=document.getElementById("roughnessInput");this.roughnessSpinBox=new o({value:.3,minValue:0,maxValue:1,stepValue:.01,pageStepValue:.1}),this.roughnessSpinBox.inject(v);var b=document.getElementById("iorInput");this.iorSpinBox=new o({value:1.5,minValue:1,maxValue:2.5,stepValue:.01,pageStepValue:.1}),this.iorSpinBox.inject(b);var g=document.getElementById("transparencyInput");this.transparencySpinBox=new o({value:0,minValue:0,maxValue:1,stepValue:.01,pageStepValue:.1}),this.transparencySpinBox.inject(g);var C=document.getElementById("emissiveInput");this.emissiveSpinBox=new o({value:0,minValue:0,maxValue:999,stepValue:.1,pageStepValue:1}),this.emissiveSpinBox.inject(C);var y=new a({label:"Apply",type:"check",internalLabelsFlag:!0});y.inject(this.container);var x=this;y.addEventListener("change",function(){xCity.selectedItems[0].get("Content")._node.traverse(function(e){if(e&&e._material&&e._material instanceof THREE.PhysicalMaterial){var t=e._material;t.diffuse.r=this.albedoRSpinbox.value,t.diffuse.g=this.albedoGSpinbox.value,t.diffuse.b=this.albedoBSpinbox.value,t.ambient.r=this.ambientRSpinbox.value,t.ambient.g=this.ambientGSpinbox.value,t.ambient.b=this.ambientBSpinbox.value,t.specular.r=this.specularRSpinbox.value,t.specular.g=this.specularGSpinbox.value,t.specular.b=this.specularBSpinbox.value,t.emissionColor.r=this.emissiveRSpinbox.value,t.emissionColor.g=this.emissiveGSpinbox.value,t.emissionColor.b=this.emissiveBSpinbox.value,t.emissionValue=this.emissiveSpinBox.value,t.metalness=this.metalnessSpinBox.value,t.roughness=this.roughnessSpinBox.value,t.ior=this.iorSpinBox.value,t.transparency=this.transparencySpinBox.value}}.bind(x))})},createPanel:function(){this.colorLabel=new UWA.Element("h6",{text:"Colors"}).inject(this.container),this.albedoLabel=new UWA.Element("h6",{text:"Albedo / Diffuse"}).inject(this.container),this.albedoRInput=new UWA.Element("h6",{text:"R:",classid:"xct-label xct-sublabel"}).inject(this.albedoLabel);var e=new o({value:1,minValue:0,maxValue:1,stepValue:.1,pageStepValue:1,displayStyle:"lite"});e.getContent().addClassName("xct-min-width"),e.inject(this.albedoRInput),this.albedoGInput=new UWA.Element("h6",{text:"G:"}).inject(this.albedoLabel);var t=new o({value:1,minValue:0,maxValue:1,stepValue:.1,pageStepValue:1,displayStyle:"lite"});t.getContent().addClassName("xct-min-width"),t.inject(this.albedoGInput),this.albedoBInput=new UWA.Element("h6",{text:"B:"}).inject(this.albedoLabel);var i=new o({value:1,minValue:0,maxValue:1,stepValue:.1,pageStepValue:1,displayStyle:"lite"});i.getContent().addClassName("xct-min-width"),i.inject(this.albedoBInput)},createSliders:function(){this.coverageLabel=new UWA.Element("h6",{text:"Coverage :"}).inject(this.container),this.sliderCoverage=new n({minValue:0,maxValue:1,stepValue:.01,dynamicGraduations:!1,graduationsLabel:!1,dynamicGaugeColor:!1,knobIndicator:"line",knobMaterial:"pearl",graduations:10,activeGraduationsColor:"#3CF",inactiveGraduationsColor:"#CCC"}).inject(this.container),this.heightLabel=new UWA.Element("h6",{text:"Height :"}).inject(this.container),this.sliderHeight=new n({minValue:0,maxValue:500,stepValue:1,dynamicGraduations:!1,graduationsLabel:!1,dynamicGaugeColor:!1,knobIndicator:"line",knobMaterial:"pearl",graduations:6,activeGraduationsColor:"#3CF",inactiveGraduationsColor:"#CCC"}).inject(this.container),this.thicknessLabel=new UWA.Element("h6",{text:"Thickness :"}).inject(this.container),this.sliderThickness=new n({minValue:0,maxValue:300,stepValue:1,dynamicGraduations:!1,graduationsLabel:!1,dynamicGaugeColor:!1,knobIndicator:"line",knobMaterial:"pearl",graduations:10,activeGraduationsColor:"#3CF",inactiveGraduationsColor:"#CCC"}).inject(this.container),this.aspectLabel=new UWA.Element("h6",{text:"Aspect :"}).inject(this.container),this.sliderAspect=new n({minValue:0,maxValue:1,stepValue:.01,dynamicGraduations:!1,graduationsLabel:!1,dynamicGaugeColor:!1,knobIndicator:"line",knobMaterial:"pearl",graduations:10,activeGraduationsColor:"#3CF",inactiveGraduationsColor:"#CCC"}).inject(this.container),this.shapeLabel=new UWA.Element("h6",{text:"Shape :"}).inject(this.container),this.sliderShape=new n({minValue:.001,maxValue:.01,stepValue:1e-4,dynamicGraduations:!1,graduationsLabel:!1,dynamicGaugeColor:!1,knobIndicator:"line",knobMaterial:"pearl",graduations:10,activeGraduationsColor:"#3CF",inactiveGraduationsColor:"#CCC"}).inject(this.container),this.directionLabel=new UWA.Element("h6",{text:"Wind direction :"}).inject(this.container),this.sliderDirection=new n({minValue:-180,maxValue:180,stepValue:1,dynamicGraduations:!1,graduationsLabel:!1,dynamicGaugeColor:!1,knobIndicator:"line",knobMaterial:"pearl",graduations:36,activeGraduationsColor:"#3CF",inactiveGraduationsColor:"#CCC"}).inject(this.container),this.speedLabel=new UWA.Element("h6",{text:"Wind speed :"}).inject(this.container),this.sliderSpeed=new n({minValue:0,maxValue:1,stepValue:.001,dynamicGraduations:!1,graduationsLabel:!1,dynamicGaugeColor:!1,knobIndicator:"line",knobMaterial:"pearl",graduations:10,activeGraduationsColor:"#3CF",inactiveGraduationsColor:"#CCC"}).inject(this.container)},updateSlide:function(){this.sliderCoverage.getValue()!==xCity._urbanImpl.environment.cloudsParams.coverage&&this.sliderCoverage.setValue(xCity._urbanImpl.environment.cloudsParams.coverage),this.sliderHeight.getValue()!==xCity._urbanImpl.environment.cloudsParams.height&&this.sliderHeight.setValue(xCity._urbanImpl.environment.cloudsParams.height),this.sliderThickness.getValue()!==xCity._urbanImpl.environment.cloudsParams.thickness&&this.sliderThickness.setValue(xCity._urbanImpl.environment.cloudsParams.thickness),this.sliderAspect.getValue()!==xCity._urbanImpl.environment.cloudsParams.aspect&&this.sliderAspect.setValue(xCity._urbanImpl.environment.cloudsParams.aspect),this.sliderShape.getValue()!==xCity._urbanImpl.environment.cloudsParams.shape&&this.sliderShape.setValue(xCity._urbanImpl.environment.cloudsParams.shape),this.sliderSpeed.getValue()!==xCity._urbanImpl.environment.cloudsParams.windSpeed&&this.sliderSpeed.setValue(xCity._urbanImpl.environment.cloudsParams.windSpeed)},initButtonEvent:function(){var e=this;this.cloudsOn.addEventListener("change",function(t){e.buttonClicked=t.dsModel.value[0],e.cloudsOn.getButtonFromValue(e.buttonClicked).checkFlag=!0,0==e.buttonClicked?xCity._urbanImpl.environment.cloudsParams.on=!0:xCity._urbanImpl.environment.cloudsParams.on=!1})},initSlidersEvent:function(){this.sliderCoverage.addEvent("change",function(){var e=this.getValue();xCity._urbanImpl.environment.cloudsParams.coverage=e}),this.sliderThickness.addEvent("change",function(){var e=this.getValue();xCity._urbanImpl.environment.cloudsParams.thickness=e}),this.sliderHeight.addEvent("change",function(){var e=this.getValue();xCity._urbanImpl.environment.cloudsParams.height=e}),this.sliderAspect.addEvent("change",function(){var e=this.getValue();xCity._urbanImpl.environment.cloudsParams.aspect=e}),this.sliderShape.addEvent("change",function(){var e=this.getValue();xCity._urbanImpl.environment.cloudsParams.shape=e}),this.sliderDirection.addEvent("change",function(){var e=this.getValue()*(Math.PI/180),t=Math.cos(e),i=Math.sin(e),n=new THREE.Vector3(t,0,i);xCity._urbanImpl.environment.cloudsParams.windDirection=n}),this.sliderSpeed.addEvent("change",function(){var e=this.getValue();xCity._urbanImpl.environment.cloudsParams.windSpeed=e})}})}),define("DS/XCityCoreUI/LightControler",["UWA/Core","UWA/Class","DS/Windows/Dialog","DS/Controls/Button","DS/Controls/ButtonGroup","DS/Controls/ComboBox","DS/Controls/ColorPicker","DS/Controls/SpinBox","DS/Controls/Slider","DS/Controls/LineEditor","DS/Controls/ColorPalette"],function(e,t,i,n,a,s,l,o,r,d,c){"use strict";var u={id:"lightFolder",name:"Created Lights"},h=1e3,m=135,p=45,v=1,b=1,g=["2000°","3000°","4000°","5000°","6000°","7000°","8000°","9000°","10000°"],C=["#FF890E","#FFB16E","#FFCEA6","#FFE4CE","#FFF6ED","#F3F2FF","#DDE6FF","#D2DFFF","#CADAFF"],y=0,x="#ffb16e",f={spot:{type:"spotLight",intensity:-1,physicalAttenuation:!0,attenuationScale:1},area:{type:"areaLight",intensity:-1,mode:"LUMINOUS_EXITANCE"},point:{type:"pointLight",intensity:-1,physicalAttenuation:!0,attenuationScale:1}},w="point",S=0;function I(e){let t=function(){var e=xCity.findItem({id:u.id});return e||xCity.addFolder({id:u.id,name:u.name})}(),i=t.get("children").length+1;e.setZ(e.z+S);let n={Coordinate:{position:{x:e.x,y:e.y,z:e.z},projection:xCity.widgetData.currentReferential.model._attributes.proj,className:"Coordinate"},id:w+i,className:"Light"};console.log(n),xCity.add3DContent({feature:{name:w+i,selected:!0,Content:{...n,...f[w],power:h,color:x,outerAngle:m,innerAngle:p,width:v,height:b},className:"Feature"},parentFolder:t})}function V(e){return e*(Math.PI/180)}return e.Class.extend({init:function(){this.createPanel()},close:function(){},createPanel:function(){this.container=new e.Element("div"),this.content=new e.Element("div",{html:'\n\t\t<div id="container">\n              <div class="xct-dialog" id="xcity-light-dialog">\n\t\t\t\t\t<div class="xct-parameter">\n\t\t\t\t\t\t<div class="xct-label">Type</div>\n\t\t\t\t\t\t<div class="xct-input" id="xcity-light-selector-buttongroup"></div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="xct-parameter">\n\t\t\t\t\t\t<div class="xct-label">Temperature</div>\n\t\t\t\t\t\t<div class="xct-input" id="xcity-light-temperature-colorpicker"></div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="xct-parameter">\n\t\t\t\t\t\t<div class="xct-label">Power</div>\n\t\t\t\t\t\t<div class="xct-input" id="xcity-light-power-spinbox"></div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="xct-parameter" id="xcity-light-angle-parameter">\n\t\t\t\t\t\t<div class="xct-label">Spot Angles</div>\n\t\t\t\t\t\t<div class="xct-input" id="xcity-light-outerangle-slider"></div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="xct-parameter" id="xcity-light-size">\n\t\t\t\t\t\t<div class="xct-label">Width / Length</div>\n\t\t\t\t\t\t<div class="xct-input" id="xcity-light-size-spinbox"></div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="xct-parameter">\n\t\t\t\t\t\t<div class="xct-label">Offset</div>\n\t\t\t\t\t\t<div class="xct-input" id="xcity-light-offset-spinbox"></div>\n\t\t\t\t\t</div>\n\t\t\t\t\t\x3c!-- div class="xct-parameter">\n\t\t\t\t\t\t<div class="xct-label">Elevation Offset</div>\n\t\t\t\t\t\t<div class="xct-input" id="xcity-light-offsetHeight-spinbox"></div>\n\t\t\t\t\t</div--\x3e\n\t\t\t\t\t<div class="xct-parameter">\n\t\t\t\t\t\t<div class="xct-label"></div>\n\t\t\t\t\t\t<div class="xct-input" id="xcity-light-activation-button"></div>\n\t\t\t\t\t</div>\n              </div>\n        </div>\n        '}),this.container.addContent(this.content),this.selectorDiv=this.content.getElement("#xcity-light-selector-buttongroup"),this.pointLightButton=new n({label:"Point",value:"point",emphasize:"secondary",type:"radio",checkFlag:!0}),this.spotLightButton=new n({label:"Spot",value:"spot",emphasize:"secondary",type:"radio"}),this.areaLightButton=new n({label:"Area",value:"area",emphasize:"secondary",type:"radio"}),this.lightSelectorButtonGroup=new a({}),this.lightSelectorButtonGroup.addChild(this.pointLightButton),this.lightSelectorButtonGroup.addChild(this.spotLightButton),this.lightSelectorButtonGroup.addChild(this.areaLightButton),this.lightSelectorButtonGroup.inject(this.selectorDiv),this.temperatureDiv=this.content.getElement("#xcity-light-temperature-colorpicker"),this.temperatureCombobox=new s({elementsList:g,selectedIndex:1,enableSearchFlag:!1}).inject(this.temperatureDiv),this.temperatureColorPicker=new l({value:"FFB16E"}).inject(this.temperatureDiv),this.powerDiv=this.content.getElement("#xcity-light-power-spinbox"),this.powerSpinbox=new o({units:"lm",stepValue:1}).inject(this.powerDiv),this.powerSpinbox.value=h,this.SpotAngleDiv=this.content.getElement("#xcity-light-angle-parameter"),this.AngleDiv=this.content.getElement("#xcity-light-outerangle-slider"),this.AngleSlider=new r({value:[45,135],minValue:1,maxValue:180,stepValue:1}).inject(this.AngleDiv),this.AngleSlider.value[1]=m,this.AngleSlider.value[0]=p,this.SpotAngleDiv.hide(),this.offsetHeightDiv=this.content.getElement("#xcity-light-offset-spinbox"),this.offsetHeightSpinbox=new o({units:"m",minValue:0,stepValue:1}).inject(this.offsetHeightDiv),this.offsetHeightSpinbox.value=S,this.sizeDiv=this.content.getElement("#xcity-light-size"),this.sizeAreaDiv=this.content.getElement("#xcity-light-size-spinbox"),this.sizeWidthSpinbox=new o({units:"m",minValue:0,stepValue:1}).inject(this.sizeAreaDiv),this.sizeHeightSpinbox=new o({units:"m",minValue:0,stepValue:1}).inject(this.sizeAreaDiv),this.sizeWidthSpinbox.value=v,this.sizeHeightSpinbox.value=b,this.sizeDiv.hide(),this.buttonDiv=this.content.getElement("#xcity-light-activation-button"),this.activationButton=new n({label:"Activate creation",displayStyle:"normal",type:"check",icon:{iconName:"lightbulb",fontIconFamily:WUXManagedFontIcons.Font3DS}}),this.buttonDiv.addContent(this.activationButton),this.lightSelectorButtonGroup.addEventListener("change",e=>{console.log("Selected method : "+this.lightSelectorButtonGroup.value),"spot"==(w=e.dsModel.value)?this.SpotAngleDiv.show():this.SpotAngleDiv.hide(),"area"==w?this.sizeDiv.show():this.sizeDiv.hide()}),this.temperatureColorPicker.addEventListener("change",e=>{x="#"+e.dsModel.value,console.log("Color picker : "+x)}),this.temperatureCombobox.addEventListener("change",e=>{y=e.dsModel.selectedIndex,x=C[y],console.log("Temperature : "+x),this.temperatureColorPicker.value=x.substring(1)}),this.powerSpinbox.addEventListener("change",e=>{h=e.dsModel.value,console.log("Power : "+x)}),this.AngleSlider.addEventListener("change",e=>{m=V(e.dsModel.value[1]),p=V(e.dsModel.value[0]),console.log("Outer angle : "+m),console.log("Inner angle : "+p)}),this.sizeWidthSpinbox.addEventListener("change",e=>{v=e.dsModel.value,console.log("Width : "+v)}),this.sizeHeightSpinbox.addEventListener("change",e=>{b=e.dsModel.value,console.log("Height : "+v)}),this.offsetHeightSpinbox.addEventListener("change",e=>{S=e.dsModel.value}),this.activationButton.addEventListener("buttonclick",e=>{console.log(e),e.dsModel.checkFlag?(e.dsModel.label="Deactivate creation",xCity.onWorldClick(I,!1)):(e.dsModel.label="Activate creation",xCity.removeOnWorldClick())})}})}),define("DS/XCityCoreUI/CloudsControler",["UWA/Class","DS/XCityTools/Debug","DS/XCityTools/EventDispatcher","DS/Controls/Gauge","DS/Controls/Button","DS/Controls/Toggle","DS/Controls/ButtonGroup"],function(e,t,i,n,a,s,l){"use strict";return UWA.Class.extend({init:function(){this.container=new UWA.Element("div",{class:"xCity-clouds-slider-container"}),this.coverageLabel=new UWA.Element("h6",{text:"Clouds :"}).inject(this.container),this.cloudsOn=new l({type:"radio"}),this.cloudsOn.addChild(new s({type:"radio",label:"On",value:0})),this.cloudsOn.addChild(new s({type:"radio",label:"Off",value:1,checkFlag:!0})),this.cloudsOn.inject(this.container),this.createSliders(),this.initButtonEvent(),this.initSlidersEvent(),this.updateSlide()},createSliders:function(){this.coverageLabel=new UWA.Element("h6",{text:"Coverage :"}).inject(this.container),this.sliderCoverage=new n({minValue:0,maxValue:1,stepValue:.01,dynamicGraduations:!1,graduationsLabel:!1,dynamicGaugeColor:!1,knobIndicator:"line",knobMaterial:"pearl",graduations:10,activeGraduationsColor:"#3CF",inactiveGraduationsColor:"#CCC"}).inject(this.container),this.heightLabel=new UWA.Element("h6",{text:"Height :"}).inject(this.container),this.sliderHeight=new n({minValue:0,maxValue:500,stepValue:1,dynamicGraduations:!1,graduationsLabel:!1,dynamicGaugeColor:!1,knobIndicator:"line",knobMaterial:"pearl",graduations:6,activeGraduationsColor:"#3CF",inactiveGraduationsColor:"#CCC"}).inject(this.container),this.thicknessLabel=new UWA.Element("h6",{text:"Thickness :"}).inject(this.container),this.sliderThickness=new n({minValue:0,maxValue:300,stepValue:1,dynamicGraduations:!1,graduationsLabel:!1,dynamicGaugeColor:!1,knobIndicator:"line",knobMaterial:"pearl",graduations:10,activeGraduationsColor:"#3CF",inactiveGraduationsColor:"#CCC"}).inject(this.container),this.aspectLabel=new UWA.Element("h6",{text:"Aspect :"}).inject(this.container),this.sliderAspect=new n({minValue:0,maxValue:1,stepValue:.01,dynamicGraduations:!1,graduationsLabel:!1,dynamicGaugeColor:!1,knobIndicator:"line",knobMaterial:"pearl",graduations:10,activeGraduationsColor:"#3CF",inactiveGraduationsColor:"#CCC"}).inject(this.container),this.shapeLabel=new UWA.Element("h6",{text:"Shape :"}).inject(this.container),this.sliderShape=new n({minValue:.001,maxValue:.01,stepValue:1e-4,dynamicGraduations:!1,graduationsLabel:!1,dynamicGaugeColor:!1,knobIndicator:"line",knobMaterial:"pearl",graduations:10,activeGraduationsColor:"#3CF",inactiveGraduationsColor:"#CCC"}).inject(this.container),this.directionLabel=new UWA.Element("h6",{text:"Wind direction :"}).inject(this.container),this.sliderDirection=new n({minValue:-180,maxValue:180,stepValue:1,dynamicGraduations:!1,graduationsLabel:!1,dynamicGaugeColor:!1,knobIndicator:"line",knobMaterial:"pearl",graduations:36,activeGraduationsColor:"#3CF",inactiveGraduationsColor:"#CCC"}).inject(this.container),this.speedLabel=new UWA.Element("h6",{text:"Wind speed :"}).inject(this.container),this.sliderSpeed=new n({minValue:0,maxValue:1,stepValue:.001,dynamicGraduations:!1,graduationsLabel:!1,dynamicGaugeColor:!1,knobIndicator:"line",knobMaterial:"pearl",graduations:10,activeGraduationsColor:"#3CF",inactiveGraduationsColor:"#CCC"}).inject(this.container)},updateSlide:function(){this.sliderCoverage.getValue()!==xCity._urbanImpl.environment.cloudsParams.coverage&&this.sliderCoverage.setValue(xCity._urbanImpl.environment.cloudsParams.coverage),this.sliderHeight.getValue()!==xCity._urbanImpl.environment.cloudsParams.height&&this.sliderHeight.setValue(xCity._urbanImpl.environment.cloudsParams.height),this.sliderThickness.getValue()!==xCity._urbanImpl.environment.cloudsParams.thickness&&this.sliderThickness.setValue(xCity._urbanImpl.environment.cloudsParams.thickness),this.sliderAspect.getValue()!==xCity._urbanImpl.environment.cloudsParams.aspect&&this.sliderAspect.setValue(xCity._urbanImpl.environment.cloudsParams.aspect),this.sliderShape.getValue()!==xCity._urbanImpl.environment.cloudsParams.shape&&this.sliderShape.setValue(xCity._urbanImpl.environment.cloudsParams.shape),this.sliderSpeed.getValue()!==xCity._urbanImpl.environment.cloudsParams.windSpeed&&this.sliderSpeed.setValue(xCity._urbanImpl.environment.cloudsParams.windSpeed)},initButtonEvent:function(){var e=this;this.cloudsOn.addEventListener("change",function(t){e.buttonClicked=t.dsModel.value[0],e.cloudsOn.getButtonFromValue(e.buttonClicked).checkFlag=!0,0==e.buttonClicked?xCity._urbanImpl.environment.cloudsParams.on=!0:xCity._urbanImpl.environment.cloudsParams.on=!1})},initSlidersEvent:function(){this.sliderCoverage.addEvent("change",function(){var e=this.getValue();xCity._urbanImpl.environment.cloudsParams.coverage=e}),this.sliderThickness.addEvent("change",function(){var e=this.getValue();xCity._urbanImpl.environment.cloudsParams.thickness=e}),this.sliderHeight.addEvent("change",function(){var e=this.getValue();xCity._urbanImpl.environment.cloudsParams.height=e}),this.sliderAspect.addEvent("change",function(){var e=this.getValue();xCity._urbanImpl.environment.cloudsParams.aspect=e}),this.sliderShape.addEvent("change",function(){var e=this.getValue();xCity._urbanImpl.environment.cloudsParams.shape=e}),this.sliderDirection.addEvent("change",function(){var e=this.getValue()*(Math.PI/180),t=Math.cos(e),i=Math.sin(e),n=new THREE.Vector3(t,0,i);xCity._urbanImpl.environment.cloudsParams.windDirection=n}),this.sliderSpeed.addEvent("change",function(){var e=this.getValue();xCity._urbanImpl.environment.cloudsParams.windSpeed=e})}})}),define("DS/XCityCoreUI/Animation",["UWA/Core","UWA/Class","UWA/Element","UWA/Class/Events","UWA/Controls/Input","DS/Controls/Timeline"],function(e,t,i,n,a,s){"use strict";return t.extend({init:function(t){this._parent(t);var n=this;this.container=new e.Element("div");var l=function(){var e=function(){r.setIndex();o()},t=r.openedAnimation;if(Utils.is(t)){for(var i,n=t.getKeyframes(),a=[],s=0;s<n.length;s++)i=n[s].time,a[s]={label:i.toString(),value:i,index:s,onEvent:e,state:0};u.options.maxValue=i,u._realRange=i,u.options.graduations=a,u.getContent().getChildren().forEach(function(e){e.hasClassName("wux-Gauge-scale")&&e.remove()}),u._buildScaling(),u._buildCursor(0),u._buildCursor(1),u.setValue(r.setTime())}},o=function(){b.value=r.setIndex(),g.value=r.setTime()},r=xCity._urbanImpl.getControl(),d=(new a.Button({value:"New Path",events:{onClick:function(e){var t="";Utils.is(r.paths[t])&&(t+="0"),r.createPath(t),c(),d.setValue(t)}}}).inject(this.container),new i("label",{html:" Opened Paths :"}).inject(this.container),new a.Select({events:{onChange:function(e){r.setCurrentPath(d.getValue()[0]),r.goToKeyframe(),l(),o()}}}));d.inject(this.container);var c=function(){for(var t in r.paths)r.paths.hasOwnProperty(t)&&d.putOptions([{label:e.i18n(t),value:t}])};new i("label",{html:" Open File(json or pth) :"}).inject(this.container);new i("input",{html:"file",class:" ",type:"file",events:{change:function(e){var t=this.files[0],i=window.URL.createObjectURL(t),n=new XMLHttpRequest;n.onreadystatechange=function(){4===n.readyState&&200===n.status&&(Utils.endsWith(t.name,".pth")?xCity._urbanImpl.getControl().readPthFile(t.name,n.responseText):Utils.endsWith(t.name,".json")&&xCity._urbanImpl.getControl().setFile(t.name,n.responseText),c(),d.setValue(t.name))},n.open("GET",i,!0),n.send(null)}}}).inject(this.container);new a.Button({value:"Save Path",events:{onClick:function(e){var t,i,n=r.getFile();if(Utils.is(n)){t=n,i=d.getValue()[0],Utils.endsWith(i,".pth")&&(i=i.substring(0,i.lastIndexOf("."))),Utils.endsWith(i,".json")||(i+=".json");var a="data:text/json,"+btoa(t),s=Utils.dataURItoBlob(a);Utils.toDownloadFile(i,s)}else alert("no current path to save")}}}).inject(this.container);var u=new s({minValue:0,maxValue:1e4,value:10,stepValue:.1,dynamicGraduations:!1,dynamicGaugeColor:!1,graduationsLabel:!0,eventsList:[{label:"0",value:0,onEvent:function(){}}],activeGraduationsColor:"#3CF",inactiveGraduationsColor:"#CCC"}).inject(this.container);u.addEvent("change",function(){c(),Utils.is(r.openedAnimation)&&!1===r.openedAnimation.isPlaying()&&r.setAnimationTime(u.getValue())}),[{label:"Play",callback:function(){r.play(),!0===h&&xCity._urbanImpl.getView3D().getRecorder().startRecord(),r.setLoop(v)}},{label:"Pause",callback:function(){r.pause(),!0===h&&xCity._urbanImpl.getView3D().getRecorder().stopRecord(),r.setLoop(v)}},{label:"Stop",callback:function(){r.stop(),r.setIndex(0),r.goToKeyframe(),!0===h&&xCity._urbanImpl.getView3D().getRecorder().stopRecord(),r.setLoop(v),o()}}].forEach(function(e){new i("a",{html:e.label,class:"wux-controls-button",events:{click:e.callback}}).inject(n.container)}),r.timeline=u;var h=!1;new i("label",{html:"Record on Play :"}).inject(this.container),new a.Checkbox({value:"Rec",class:" ",events:{onClick:function(e){h=!h}}}).inject(this.container);new i("label",{html:" time(ms) :"}).inject(this.container);var m=new i("input",{html:" t",class:" ",type:"number",min:0,events:{change:function(e){this.value=r.setAnimationTime(this.valueAsNumber),p.value=1+.025*this.value,u.setValue(this.value)}}}).inject(this.container);new i("label",{html:" frame index :"}).inject(this.container);var p=new i("input",{html:" t",class:" ",type:"number",min:0,events:{change:function(e){var t=40*(this.value-1);m.value=r.setAnimationTime(t),this.value=1+.025*m.value,Debug.log("change event on frameIndex"+t+" , "+m.value+" , "+this.value)}}}).inject(this.container),v=!1;new i("label",{html:" Loop :"}).inject(this.container),new a.Checkbox({value:" Loop",class:" ",events:{onClick:function(e){v=!v,r.setLoop(v)}}}).inject(this.container);new i("label",{html:"<br> Kf index :   "}).inject(this.container);var b=new i("input",{html:" Kf Ind",class:" ",type:"number",min:0,events:{change:function(e){this.value=r.setIndex(this.valueAsNumber);var t=n.urban.getControl().goToKeyframe();Utils.is(t)&&(o(),u.setValue(g.valueAsNumber))}}}).inject(this.container),g=(new i("label",{html:"  Kf Time offset :"}).inject(this.container),new i("input",{html:" Kf Time offset",class:" ",type:"number",min:0,events:{change:function(e){this.value=r.setTime(this.valueAsNumber)}}}).inject(this.container));new a.Button({value:" Add Kf ",class:"",events:{onClick:function(e){r.recordKeyframe(),l(),o()}}}).inject(this.container);new a.Button({value:"OverWrite Kf",class:" ",events:{onClick:function(e){r.overWriteKeyframe(),l(),o()}}}).inject(this.container),new a.Button({value:"Remove Kf",class:" ",events:{onClick:function(e){r.removeKeyframe(),l(),o()}}}).inject(this.container)}})}),define("DS/XCityCoreUI/AnimationReplayPanel",["UWA/Core","UWA/Class","UWA/Element","UWA/Class/Events","UWA/Controls/Input","DS/Controls/Timeline","DS/Windows/Panel"],function(e,t,i,n,a,s,l){"use strict";return t.extend({init:function(t,n,a){var o=this;this.container=new e.Element("div");var r=new s({minValue:0,maxValue:n.duration,value:0,stepValue:.01,dynamicGraduations:!1,dynamicGaugeColor:!1,graduationsLabel:!0,eventsList:[{label:n.startLabel,value:0,onEvent:function(){}},{label:n.endLabel,value:n.duration,onEvent:function(){}}],activeGraduationsColor:"#3CF",inactiveGraduationsColor:"#CCC"}).inject(this.container);r.addEvent("change",function(){if(Utils.is(u)){var e=r.getValue();e<=0&&(e=0),u._setFastTime(1e3*e)}}),n.timeline=r,this.timeline=r,[{label:"Play",callback:function(){r.play()}},{label:"Pause",callback:function(){r.pause()}},{label:"Stop",callback:function(){r.stop()}}].forEach(function(e){new i("a",{html:e.label,class:"wux-controls-button",events:{click:e.callback}}).inject(o.container)});var d=this.container,c=new l({title:"AnimationReplay",content:d,immersiveFrame:t.frmWindow.getImmersiveFrame(),visibleFlag:!0,closeButtonFlag:!1,allowedDockAreas:WUXDockAreaEnum.LeftDockArea|WUXDockAreaEnum.RightDockArea,currentDockArea:WUXDockAreaEnum.RightDockArea,collapsibleFlag:!1,resizableFlag:!0,verticallyStretchableFlag:!0,height:340,minWidth:400,width:400});c.getContent().addClassName("xCity-wux-window"),function(e,t){for(var i in t.windows){var n=t.windows[i];if(n!==e&&0!==e.currentDockArea&&n.currentDockArea===e.currentDockArea){e.attachToWindow(n,WUXSnapAreaEnum.InsideArea),e.windowGroup.verticallyStretchableFlag=!0,e.windowGroup.allowedDockAreas=WUXDockAreaEnum.LeftDockArea|WUXDockAreaEnum.RightDockArea;break}}}(c,t.frmWindow.getImmersiveFrame());var u=a.setOptions(n)}})}),define("DS/XCityCoreUI/TimeControler",["UWA/Class","DS/XCityTools/Debug","DS/XCityTools/EventDispatcher","DS/Controls/Gauge"],function(e,t,i,n){"use strict";return UWA.Class.extend({init:function(){this.container=new UWA.Element("div",{class:"xCity-time-slider-container"}),this.createSlider(),this.updateSlide(),this.initEvents()},createSlider:function(){this.slider=new n({minValue:0,maxValue:23,stepValue:1,dynamicGraduations:!1,graduationsLabel:!1,dynamicGaugeColor:!1,knobIndicator:"line",knobMaterial:"pearl",graduations:24,activeGraduationsColor:"#3CF",inactiveGraduationsColor:"#CCC"}).inject(this.container)},updateSlide:function(){this.slider.getValue()!==xCity.date.getHours()&&this.slider.setValue(xCity.date.getHours())},initEvents:function(){i.subscribeTo(i.eventsList.date,this.updateSlide.bind(this)),this.slider.addEvent("change",function(){var e=this.getValue(),t=xCity.date;t.setHours(e),xCity.date=t})}})}),define("DS/XCityCoreUI/DebugControls",["UWA/Core","UWA/Class","DS/Controls/Toggle","DS/Controls/Button","DS/Controls/ColorPalette","DS/Controls/ButtonGroup","DS/Controls/Slider","DS/xCityPlatformUtils/xCityDocumentManagement","DS/XCityTools/Debug","DS/XCityCore/Terrain","DS/xCityBasicUtils/Utils","DS/XCityTools/EventDispatcher","DS/XCityTools/Downloader"],function(e,t,i,n,a,s,l,o,r,d,c,u,h){"use strict";return t.extend({init:function(t){this.container=new e.Element("div",{class:"xCity-debug-controls-container"}),this.createDebugPanel()},addGeojsonToCity:function(e,t,i,n,a,s,l){JSON.stringify(a);var o=c.createUUID(),r=(xCity._urbanImpl.baseProjection,t||"");e=e+"_"+i;if("Point"===s.type)var d={className:"Feature",name:e,id:o,visible:!0,selectable:!0,Content:{className:"PointOfInterest3DSet",type:"json",objectId:r,serviceId:i,id:o,Clustering:{enable:!1,nbSteps:6,minimumHits:1},scale:[2,2,2]}};else if("LineString"===s.type)d={className:"Feature",name:e,id:o,visible:!0,selectable:!0,Content:{className:"LineSet",type:"json",objectId:r,serviceId:i,id:o}};else if("Polygon"===s.type)d={className:"Feature",name:e,id:o,visible:!0,selectable:!0,Content:{className:"PolygonSet",type:"json",objectId:r,serviceId:i,id:o}};else if("Geometry"===s.type)d={className:"Feature",name:e,id:o,visible:!0,selectable:!0,Content:{className:"GeometrySet",type:"json",objectId:r,serviceId:i,id:o}};void 0!==a?d.Content.geojson=a:void 0!==n&&(d.Content.url=n),s.strid&&(d.Content.stridAttribute=s.strid),s.name&&(d.Content.nameAttribute=s.name);xCity.add3DContent({feature:d,parentFolder:l,readyCB:function(e){var t,i=e.impl.getContent(),n=0;i&&"Point"===s.type?(t=i.nbPoint,n=i.nbMultiPoint):i&&"LineString"===s.type?(t=i.nbLineString,n=i.nbMultiLineString):i&&"Polygon"===s.type&&(t=i.nbPolygon,n=i.nbMultiPolygon);var a=e.get("name");e.set("name",a+" ("+t+" "+s.type+", "+n+" Multi"+s.type+")")}})},processFiles:function(e){return new Promise((t,i)=>{for(var n=this,a=0;a<e.items.length;a++)if("file"===e.items[a].kind){var s=e.items[a].getAsFile();s.name.includes(".json")||s.name.includes(".geojson")||i("wrong file format dropped, please retry"),n.readFileAsJSON(s).then(function(e){console.log(e);var i=n.getAttributesOfGeojson(e);t({fileName:s.name,geojson:e,attributes:i})})}})},readFileAsJSON:function(e){return new Promise((t,i)=>{var n=new FileReader;n.onloadend=function(e){t(JSON.parse(this.result))},n.readAsText(e)})},getAttributesOfGeojson:function(e){return"string"==typeof e&&(e=JSON.parse(e)),Object.keys(e.features[0].properties)},dropHandler:function(e,t){var i=e.getData("text"),n=JSON.parse(i).data.items[0],a=(n.envId,n.serviceId),s=n.objectId;return new Promise((e,t)=>o.retrieveDocumentTypes(s,a).then(function(i){Promise.resolve();for(var l=[],o=0;o<i.types.length;o++){var r=i.types[o].toUpperCase();"GEOJSON"!==r&&"SHP"!==r||l.push({index:o,extension:r})}l.length>0?e({fileName:n.displayName,url:void 0,objectId:s,serviceId:a,attributes:[]}):t()}))},buildCache:function(e,t,i){const n=this;let a=function(a){a.worker.onmessage=(e=>{const s=e.data,l=(s.RequestsRemaining/n._buildCacheTotalTiles).toFixed(2);s.RequestsRemaining%50==0&&(t.label="Pause ("+(100-100*l).toFixed(0)+"%)"),0===s.RequestsRemaining&&(a.release(),n._generalWorker=null,t.label="Build Cache",i.setText("Tile padding"),t.emphasize="success")});let s={function:"buildTileCache",requests:e};a.worker.postMessage(s)};n._generalWorker?a(n._generalWorker):xCity._urbanImpl.generalWorkerSem.requestWorker().then(e=>{n._generalWorker=e,a(n._generalWorker)})},addTileRequest:function(e,t,i){const n=this;if(!e.has(t)){if(e.add(t),!i)return;const a=t.substring(t.search("\\?")),s=t.substring(0,t.search("/[0-9]+/[0-9]+/[0-9]+")),l=t.substring(t.search("/[0-9]+/[0-9]+/[0-9]+")+1,t.search("\\?")).split("/"),o=Number(l[0]),r=Number(l[1]),d=Number(l[2]);let c=0;for(let t=-i.padding.length/2;t<i.padding.length/2;t++){let l=0;for(let u=-i.padding[0].length/2;u<i.padding[0].length/2;u++){if(i.padding[c][l]){const i=s+"/"+Math.max(0,o+Math.ceil(t))+"/"+Math.max(0,r+Math.ceil(u))+"/"+d+a;n.addTileRequest(e,i,null)}l++}c++}}},parseHAFile:async function(e,t,i,n){const a=Math.max(1,Math.min(10,Number(t.value)));let s=[];for(let e=-10;e<10;e++){let t=[];for(let i=-10;i<10;i++){const n=Math.abs(i)<=a&&Math.abs(e)<=a;t.push(n)}s.push(t)}const l={padding:s};if(e){const t=await e.text(),i=JSON.parse(t),n="/globe/datasupplier/dataset/";this._HAFileEntries=i.log.entries.filter(e=>e.request.url.includes(n))}const o=this._HAFileEntries;if(!o||0===o.length)return;const r=o.map(e=>e.request.url),d=new Set,c=this;r.forEach(e=>{c.addTileRequest(d,e,l)});const u=o.map(e=>e.time).reduce((e,t)=>e+t,0)/o.length*d.size;let h="";return h=d.size>1e6?(d.size/1e6).toFixed(0)+"M":d.size>1e3?(d.size/1e3).toFixed(0)+"K":d.size,h+=" tiles.",i.setText("Tile padding. "+h+"  Estimated time (h): "+(u/1e3/60/60).toFixed(2)),d},createDebugPanel:function(){var t=this,o=new i({label:"Display infos",type:"switch",internalLabelsFlag:!0}),c=new i({label:"Display charts",type:"switch",internalLabelsFlag:!0}),m=new i({label:"QT Lock",type:"switch",internalLabelsFlag:!0}),p=new i({label:"QT View",type:"switch",internalLabelsFlag:!0}),v=new i({label:"QT Levels",type:"switch",internalLabelsFlag:!0}),b=new i({label:"QT Tile Infos",type:"switch",internalLabelsFlag:!0}),g=new i({label:"QT Triangles",type:"switch",internalLabelsFlag:!0}),C=new i({label:"MoveTo",type:"switch",internalLabelsFlag:!0}),y=new i({label:"NearGround",type:"switch",internalLabelsFlag:!0}),x=new i({label:"Robot",type:"switch",internalLabelsFlag:!0}),f=new i({label:"Bbox Labels Collisions",type:"switch",internalLabelsFlag:!0}),w=new i({label:"Bbox Item on prim selection",type:"switch",internalLabelsFlag:!0}),S=new n({label:"Ground color picker",type:"check",internalLabelsFlag:!0}),I=new a,V=new l({value:.01,minValue:.01,maxValue:1.73,stepValue:.01,displayStyle:"horizontal"}),k=new s({label:"Skybox",type:"radio"});k.addChild(new i({type:"radio",label:"blue",value:0})),k.addChild(new i({type:"radio",label:"crepuscule",value:1})),k.addChild(new i({type:"radio",label:"natural",value:2})),k.addChild(new i({type:"radio",label:"plaster",value:3,checkFlag:!0})),k.addChild(new i({type:"radio",label:"realistic",value:4})),o.addEventListener("buttonclick",function(i){r.isActive=o.checkFlag,t.debugContainer||(t.debugContainer=new e.Element("div",{id:"Infos"}).inject(t.container)),!0===r.isActive?t.debugContainer.style.display="block":t.debugContainer.style.display="none"}),m.addEventListener("buttonclick",function(e){xCity._urbanImpl.USR.forceUpdate=!0,xCity._urbanImpl.lockQuadtree=m.checkFlag}),p.addEventListener("buttonclick",function(e){xCity._urbanImpl.showQuadtree=p.checkFlag,d.setupDebug({showtiles:xCity._urbanImpl.showQuadtree})}),v.addEventListener("buttonclick",function(e){xCity._urbanImpl.showQuadtreeLevels=v.checkFlag,d.setupDebug({coloredlevels:xCity._urbanImpl.showQuadtreeLevels})}),b.addEventListener("buttonclick",function(e){xCity._urbanImpl.showQuadtreeTileInfos=b.checkFlag,d.setupDebug({tileInfos:xCity._urbanImpl.showQuadtreeTileInfos})}),f.addEventListener("buttonclick",function(e){xCity._urbanImpl.labelManager.enableDebugBbox(f.checkFlag)}),w.addEventListener("buttonclick",function(e){xCity._urbanImpl.showPrimBbox=w.checkFlag}),g.addEventListener("buttonclick",function(e){xCity._urbanImpl.showTriangles=g.checkFlag,d.setupDebug({wireframe:xCity._urbanImpl.showTriangles})}),c.addEventListener("buttonclick",function(e){r.activeCharts(c.checkFlag)}),C.addEventListener("buttonclick",function(e){xCity._urbanImpl.getControl().debugMove()}),y.addEventListener("buttonclick",function(e){xCity._urbanImpl.USR.getViewpoint()._debugNearGround(y.checkFlag)}),x.addEventListener("buttonclick",function(e){xCity.enableRobot(x.checkFlag,xCity.selectedItems[0]),xCity.selectedItems[0]||console.log("you must select a feature before activating the robot")}),this.groundColorPickerChecked=!1,this.groundColorPickerToken=void 0,this.groundColorResult=I,S.addEventListener("change",function(){if(this.groundColorPickerToken)u.unsubscribe(this.groundColorPickerToken),this.groundColorPickerToken=void 0;else{var e=function(e){if(Utils.is(e.gesture)){var t=e.gesture.getEvents();if(Utils.is(t)&&t.length>0){var i=t[0].event;console.log("x : "+i.clientX+" / y : "+i.clientY);var n=xCity._urbanImpl.USR.getGroundColor(i.clientX,i.clientY);console.log("groundColor : ["+n.r+" "+n.g+" "+n.b);var a="rgb("+n.r+","+n.g+","+n.b+")";this.groundColorResult.swatches=[{value:a}],xCity.getSessionRenderingProfile().setRendering("Ground",{oceanColorDetection:a}),xCity.realisticWater=!0}}}.bind(this);this.groundColorPickerToken=u.subscribeToLeftMouseDown(e)}}.bind(this)),V.addEventListener("change",function(e){xCity.getSessionRenderingProfile().setRendering("Ground",{oceanRangeDetection:e.dsModel.value}),xCity.realisticWater=!0}.bind(this)),this.realisticSky=!1,k.addEventListener("change",function(e){if(k.value[0]<4){this.realisticSky&&(xCity._urbanImpl.environment.switchSky(),this.realisticSky=!1);xCity.getSessionRenderingProfile().setRendering("Sky",{cubeMapUrl:"XCityEnvironment/assets/textures/skybox/"+["blue","crepuscule","natural","plaster"][k.value[0]],cubeMapExt:".jpg"})}else 4===k.value[0]&&(this.realisticSky=!0,xCity._urbanImpl.environment.switchSky())}.bind(this)),y.inject(this.container),o.inject(this.container),c.inject(this.container),m.inject(this.container),p.inject(this.container),v.inject(this.container),b.inject(this.container),g.inject(this.container),C.inject(this.container),x.inject(this.container),f.inject(this.container),w.inject(this.container),S.inject(this.container),I.inject(this.container),V.inject(this.container),k.inject(this.container);var D=new e.Element("div",{id:"dropZone",events:{dragenter:function(e){e.preventDefault()},dragleave:function(e){e.preventDefault()},dragover:function(e){e.preventDefault()},drop:function(e){e.preventDefault()}}});D.setStyle("color","blue"),D.setStyle("border-color","#808080"),D.setStyle("border-width","2px"),D.setStyle("border-style","dotted"),D.setStyle("height","50px");var G=new e.Element("span",{id:"dropZoneText",html:"Drag a geojson to this Drop Zone"});t=this;let E,L,j;D.addEvent("drop",function(e){var i=event.dataTransfer;t.dropHandler(i,{fromFile:!0,from3DDrive:!1}).then(function(e){var i;i=e.objectId&&e.serviceId?{name:e.fileName,url:e.url,objectId:e.objectId,serviceId:e.serviceId,attributes:e.attributes}:{name:e.fileName,geojson:e.geojson,attributes:e.attributes};var n=xCity.addFolder({id:"PreviewFolder_"+e.filename,name:"Preview: "+e.serviceId});t.addGeojsonToCity(i.name,i.objectId,i.serviceId,i.url,i.geojson,{strid:void 0,name:void 0,type:"Geometry",proj:"WGS84"},n)},e=>{errorMessage("upload issue",e)})}),G.inject(D),D.inject(this.container);var F=new e.Element("div",{id:"dropZoneHA",events:{dragenter:function(e){e.preventDefault()},dragleave:function(e){e.preventDefault()},dragover:function(e){e.preventDefault()},drop:function(e){e.preventDefault()}}});F.setStyle("color","blue"),F.setStyle("border-color","#808080"),F.setStyle("border-width","2px"),F.setStyle("border-style","dotted"),F.setStyle("height","50px"),F.setStyle("margin","4px 0px 4px 0px");const A=new e.Element("span",{html:"Tile cache builder tool"});A.setStyle("margin","30px 0px 0px 0px"),A.inject(this.container);const P=new e.Element("span",{id:"dropZoneHAText",html:"Drag a Chrome network recording (.har) file to this Drop Zone"});F.addEvent("drop",function(e){e.dataTransfer&&e.dataTransfer.files&&(t._pauseBuildCache=!1,t.parseHAFile(e.dataTransfer.files[0],E,L,j).then(e=>t._cacheBuilderRequests=e))}),P.inject(F),F.inject(this.container),(E=new e.Element("input",{id:"inputTileBuilderPadding",value:2,min:1,max:10,styles:{width:"40px"},type:"number",events:{change:function(e){t.parseHAFile(void 0,E,L,j).then(e=>t._cacheBuilderRequests=e)}}}).inject(this.container)).setStyle("margin","4px 4px 4px 0px"),(L=new e.Element("span",{id:"spanTileBuilderPadding",html:"Tile padding"}).inject(this.container)).setStyle("margin","0px 12px 0px 0px"),(j=new n({label:"Build cache",emphasize:"success"}).inject(this.container)).addEventListener("buttonclick",function(){if("high-attention"===j.emphasize){if(j.emphasize="success",j.label="Resume",t._pauseBuildCache=!0,t._generalWorker){let e={function:"buildTileCache",requests:null,pause:!0};t._generalWorker.worker.postMessage(e)}}else if(t._cacheBuilderRequests&&t._cacheBuilderRequests.size>0){if(j.emphasize="high-attention",j.label="Pause",t._pauseBuildCache&&t._generalWorker){let e={function:"buildTileCache",requests:null,pause:!1,resume:!0};t._generalWorker.worker.postMessage(e)}else t._buildCacheTotalTiles=t._cacheBuilderRequests.size,t.buildCache(t._cacheBuilderRequests,j,L);t._pauseBuildCache=!1}else alert("Please drag and drop a Chrome network recording into the drop zone and wait for the file to be parsed")}),new e.Element("div").inject(this.container).setStyle("margin","0px 0px 50px 0px"),new e.Element("input",{id:"logRefreshInput",value:h.getDownloadStatsRefreshDelay(),styles:{width:"80px"},type:"number",events:{change:function(e){Number.isFinite(Number(e.target.value))?h.setDownloadStatsRefreshDelay(Number(e.target.value)):console.error("DEBUG: Please enter a valid number in milliseconds")}}}).inject(this.container).setStyle("margin","4px 4px 4px 0"),new e.Element("span",{html:"Downloader statistics refresh delay (ms)"}).inject(this.container)}})}),define("DS/XCityCoreUI/AtmosphereControler",["UWA/Class","DS/XCityTools/Debug","DS/XCityTools/EventDispatcher","DS/Controls/Gauge","DS/Controls/Button","DS/Controls/Toggle","DS/Controls/ButtonGroup"],function(e,t,i,n,a,s,l){"use strict";return UWA.Class.extend({init:function(){this.container=new UWA.Element("div",{class:"xCity-atmo-slider-container"}),new UWA.Element("h4",{text:"Select a mode :"}).inject(this.container),this.modeGroup=new l({type:"radio"}),this.modeGroup.addChild(new s({type:"radio",label:"Off",value:2,checkFlag:!0})),this.modeGroup.addChild(new s({type:"radio",label:"Basic",value:0})),this.modeGroup.addChild(new s({type:"radio",label:"Advanced",value:1})),this.modeGroup.inject(this.container),this.modeID=this.modeGroup.value[0],new UWA.Element("h6",{text:"Presets :"}).inject(this.container),this.presetGroup=new l({type:"radio"}),this.presetGroup.addChild(new s({type:"radio",label:"Sunny",value:0,checkFlag:!0})),this.presetGroup.addChild(new s({type:"radio",label:"Light pollution",value:1})),this.presetGroup.addChild(new s({type:"radio",label:"Light Fog",value:2})),this.presetGroup.addChild(new s({type:"radio",label:"Heavy Fog",value:3})),this.presetGroup.addChild(new s({type:"radio",label:"Custom",value:4,disabled:!0})),this.presetGroup.inject(this.container),this.presetSelect=0;var e={turbidity:xCity._urbanImpl.environment.presetList[0].turbidity,reileigh:xCity._urbanImpl.environment.presetList[0].reileigh,mieCoefficient:xCity._urbanImpl.environment.presetList[0].mieCoefficient,mieDirectionalG:xCity._urbanImpl.environment.presetList[0].mieDirectionalG,density:xCity._urbanImpl.environment.presetList[0].density};xCity._urbanImpl.environment.skyParams=e,this._atmosphere=xCity._urbanImpl.getView3D().getAtmosphereEffect(),this.createSliders(),this.initButtonEvent(),this.initSlidersEvent(),this.updateSlide()},createSliders:function(){2==this.modeID?(this._atmosphere.disableEffect(),this.turbidityLabel&&this.turbidityLabel.destroy(),this.mieCLabel&&this.mieCLabel.destroy(),this.mieGLabel&&this.mieGLabel.destroy(),this.densityLabel&&this.densityLabel.destroy(),this.rayleighLabel&&this.rayleighLabel.destroy(),this.sliderTurbidity&&this.sliderTurbidity.destroy(),this.sliderRayleigh&&this.sliderRayleigh.destroy(),this.sliderMieG&&this.sliderMieG.destroy(),this.sliderMieCoefficient&&this.sliderMieCoefficient.destroy(),this.sliderDensity&&this.sliderDensity.destroy(),this.weatherLabel&&this.weatherLabel.destroy(),this.intensityLabel&&this.intensityLabel.destroy(),this.densityLabelEasy&&this.densityLabelEasy.destroy(),this.sliderDensityEasy&&this.sliderDensityEasy.destroy(),this.sliderWeather&&this.sliderWeather.destroy(),this.sliderIntensity&&this.sliderIntensity.destroy()):0==this.modeID?(this._atmosphere.enableEffect(),this.turbidityLabel&&this.turbidityLabel.destroy(),this.mieCLabel&&this.mieCLabel.destroy(),this.mieGLabel&&this.mieGLabel.destroy(),this.densityLabel&&this.densityLabel.destroy(),this.rayleighLabel&&this.rayleighLabel.destroy(),this.sliderTurbidity&&this.sliderTurbidity.destroy(),this.sliderRayleigh&&this.sliderRayleigh.destroy(),this.sliderMieG&&this.sliderMieG.destroy(),this.sliderMieCoefficient&&this.sliderMieCoefficient.destroy(),this.sliderDensity&&this.sliderDensity.destroy(),this.weatherLabel=new UWA.Element("h6",{text:"Weather :"}).inject(this.container),this.sliderWeather=new n({minValue:0,maxValue:1,stepValue:.01,dynamicGraduations:!1,graduationsLabel:!1,dynamicGaugeColor:!1,knobIndicator:"line",knobMaterial:"pearl",graduations:10,activeGraduationsColor:"#3CF",inactiveGraduationsColor:"#CCC"}).inject(this.container),this.intensityLabel=new UWA.Element("h6",{text:"Intensity :"}).inject(this.container),this.sliderIntensity=new n({minValue:0,maxValue:1,stepValue:.01,dynamicGraduations:!1,graduationsLabel:!1,dynamicGaugeColor:!1,knobIndicator:"line",knobMaterial:"pearl",graduations:10,activeGraduationsColor:"#3CF",inactiveGraduationsColor:"#CCC"}).inject(this.container),this.densityLabelEasy=new UWA.Element("h6",{text:"Density :"}).inject(this.container),this.sliderDensityEasy=new n({minValue:0,maxValue:1,stepValue:.01,dynamicGraduations:!1,graduationsLabel:!1,dynamicGaugeColor:!1,knobIndicator:"line",knobMaterial:"pearl",graduations:10,activeGraduationsColor:"#3CF",inactiveGraduationsColor:"#CCC"}).inject(this.container)):(this._atmosphere.enableEffect(),this.weatherLabel.destroy(),this.intensityLabel.destroy(),this.densityLabelEasy.destroy(),this.sliderDensityEasy.destroy(),this.sliderWeather.destroy(),this.sliderIntensity.destroy(),this.turbidityLabel=new UWA.Element("h6",{text:"Turbidity :"}).inject(this.container),this.sliderTurbidity=new n({minValue:1,maxValue:20,stepValue:.1,dynamicGraduations:!1,graduationsLabel:!1,dynamicGaugeColor:!1,knobIndicator:"line",knobMaterial:"pearl",graduations:20,activeGraduationsColor:"#3CF",inactiveGraduationsColor:"#CCC"}).inject(this.container),this.rayleighLabel=new UWA.Element("h6",{text:"Rayleigh coefficient:"}).inject(this.container),this.sliderRayleigh=new n({minValue:.1,maxValue:4,stepValue:.01,dynamicGraduations:!1,graduationsLabel:!1,dynamicGaugeColor:!1,knobIndicator:"line",knobMaterial:"pearl",graduations:5,activeGraduationsColor:"#3CF",inactiveGraduationsColor:"#CCC"}).inject(this.container),this.mieCLabel=new UWA.Element("h6",{text:"Mie coefficient :"}).inject(this.container),this.sliderMieCoefficient=new n({minValue:0,maxValue:.1,stepValue:1e-4,dynamicGraduations:!1,graduationsLabel:!1,dynamicGaugeColor:!1,knobIndicator:"line",knobMaterial:"pearl",graduations:10,activeGraduationsColor:"#3CF",inactiveGraduationsColor:"#CCC"}).inject(this.container),this.mieGLabel=new UWA.Element("h6",{text:"Mie direction :"}).inject(this.container),this.sliderMieG=new n({minValue:-.95,maxValue:-.7,stepValue:.01,dynamicGraduations:!1,graduationsLabel:!1,dynamicGaugeColor:!1,knobIndicator:"line",knobMaterial:"pearl",graduations:26,activeGraduationsColor:"#3CF",inactiveGraduationsColor:"#CCC"}).inject(this.container),this.densityLabel=new UWA.Element("h6",{text:"Density :"}).inject(this.container),this.sliderDensity=new n({minValue:0,maxValue:1,stepValue:.01,dynamicGraduations:!1,graduationsLabel:!1,dynamicGaugeColor:!1,knobIndicator:"line",knobMaterial:"pearl",graduations:11,activeGraduationsColor:"#3CF",inactiveGraduationsColor:"#CCC"}).inject(this.container))},updateSlide:function(){2!=this.modeID&&(0==this.modeID?(this.sliderWeather.setValue(xCity._urbanImpl.environment.skyParams.turbidity/20),this.sliderIntensity.setValue(xCity._urbanImpl.environment.skyParams.reileigh/4),this.sliderDensityEasy.setValue(xCity._urbanImpl.environment.skyParams.density)):(this.sliderTurbidity.getValue()!==xCity._urbanImpl.environment.skyParams.turbidity&&this.sliderTurbidity.setValue(xCity._urbanImpl.environment.skyParams.turbidity),this.sliderRayleigh.getValue()!==xCity._urbanImpl.environment.skyParams.reileigh&&this.sliderRayleigh.setValue(xCity._urbanImpl.environment.skyParams.reileigh),this.sliderMieCoefficient.getValue()!==xCity._urbanImpl.environment.skyParams.mieCoefficient&&this.sliderMieCoefficient.setValue(xCity._urbanImpl.environment.skyParams.mieCoefficient),this.sliderMieG.getValue()!==xCity._urbanImpl.environment.skyParams.mieDirectionalG&&this.sliderMieG.setValue(xCity._urbanImpl.environment.skyParams.mieDirectionalG),this.sliderDensity.getValue()!==xCity._urbanImpl.environment.skyParams.density&&this.sliderDensity.setValue(xCity._urbanImpl.environment.skyParams.density)))},initButtonEvent:function(){var e=this;this.modeGroup.addEventListener("change",function(t){e.modeID=t.dsModel.value[0],e.createSliders(),e.initSlidersEvent(),e.updateSlide(),e.presetGroup.getButtonFromValue(e.presetSelect).checkFlag=!0,console.log(e.presetSelect)}),this.presetGroup.addEventListener("change",function(t){if(4!==t.dsModel.value[0]){var i={turbidity:xCity._urbanImpl.environment.presetList[t.dsModel.value[0]].turbidity,reileigh:xCity._urbanImpl.environment.presetList[t.dsModel.value[0]].reileigh,mieCoefficient:xCity._urbanImpl.environment.presetList[t.dsModel.value[0]].mieCoefficient,mieDirectionalG:xCity._urbanImpl.environment.presetList[t.dsModel.value[0]].mieDirectionalG,density:xCity._urbanImpl.environment.presetList[t.dsModel.value[0]].density};xCity._urbanImpl.environment.skyParams=i,e.presetSelect=t.dsModel.value[0]}e.updateSlide()})},initSlidersEvent:function(){var e=this;2!=this.modeID&&(0==this.modeID?(this.sliderWeather.addEvent("change",function(){var t=this.getValue(),i=20*t,n=.1*t;4!==e.presetGroup.value[0]&&i!==xCity._urbanImpl.environment.presetList[e.presetGroup.value[0]].turbidity&&(e.presetGroup.getButtonFromValue(4).checkFlag=!0),xCity._urbanImpl.environment.skyParams.turbidity=i,xCity._urbanImpl.environment.skyParams.mieCoefficient=n}),this.sliderIntensity.addEvent("change",function(){var t=this.getValue(),i=4*t,n=.25*t-.95;4!==e.presetGroup.value[0]&&i!==xCity._urbanImpl.environment.presetList[e.presetGroup.value[0]].reileigh&&(e.presetGroup.getButtonFromValue(4).checkFlag=!0),xCity._urbanImpl.environment.skyParams.reileigh=i,xCity._urbanImpl.environment.skyParams.mieDirectionalG=n}),this.sliderDensityEasy.addEvent("change",function(){var t=this.getValue();4!==e.presetGroup.value[0]&&t!==xCity._urbanImpl.environment.presetList[e.presetGroup.value[0]].density&&(e.presetGroup.getButtonFromValue(4).checkFlag=!0),xCity._urbanImpl.environment.skyParams.density=t})):(this.sliderTurbidity.addEvent("change",function(){var t=this.getValue();4!==e.presetGroup.value[0]&&t!==xCity._urbanImpl.environment.presetList[e.presetGroup.value[0]].turbidity&&(e.presetGroup.getButtonFromValue(4).checkFlag=!0),xCity._urbanImpl.environment.skyParams.turbidity=t}),this.sliderRayleigh.addEvent("change",function(){var t=this.getValue();4!==e.presetGroup.value[0]&&t!==xCity._urbanImpl.environment.presetList[e.presetGroup.value[0]].reileigh&&(e.presetGroup.getButtonFromValue(4).checkFlag=!0),xCity._urbanImpl.environment.skyParams.reileigh=t}),this.sliderMieG.addEvent("change",function(){var t=this.getValue();4!==e.presetGroup.value[0]&&t!==xCity._urbanImpl.environment.presetList[e.presetGroup.value[0]].mieDirectionalG&&(e.presetGroup.getButtonFromValue(4).checkFlag=!0),xCity._urbanImpl.environment.skyParams.mieDirectionalG=t}),this.sliderMieCoefficient.addEvent("change",function(){var t=this.getValue();4!==e.presetGroup.value[0]&&t!==xCity._urbanImpl.environment.presetList[e.presetGroup.value[0]].mieCoefficient&&(e.presetGroup.getButtonFromValue(4).checkFlag=!0),xCity._urbanImpl.environment.skyParams.mieCoefficient=t}),this.sliderDensity.addEvent("change",function(){var t=this.getValue();4!==e.presetGroup.value[0]&&t!==xCity._urbanImpl.environment.presetList[e.presetGroup.value[0]].density&&(e.presetGroup.getButtonFromValue(4).checkFlag=!0),xCity._urbanImpl.environment.skyParams.density=t})))}})}),define("DS/XCityCoreUI/DebugUI",["UWA/Core","UWA/Class","DS/XCityCoreUI/TimeControler","DS/XCityCoreUI/DebugControls","DS/XCityCoreUI/Animation","DS/XCityCoreUI/AtmosphereControler","DS/XCityCoreUI/CloudsControler","DS/XCityCoreUI/PbrControler","DS/XCityCoreUI/LightControler","DS/Windows/Panel"],function(e,t,i,n,a,s,l,o,r,d){"use strict";function c(e,t){for(var i in t.windows){var n=t.windows[i];if(n!==e&&0!==e.currentDockArea&&n.currentDockArea===e.currentDockArea){e.attachToWindow(n,WUXSnapAreaEnum.InsideArea),e.windowGroup.verticallyStretchableFlag=!0,e.windowGroup.allowedDockAreas=WUXDockAreaEnum.LeftDockArea|WUXDockAreaEnum.RightDockArea;break}}}return t.extend({init:function(e){this.urban=e,this.build()},build:function(){this.frmWindow=this.urban.frmWindow,this.createPanels()},addDebugPanel:function(e,t){var i=this,n=new d({title:e,content:t,immersiveFrame:this.frmWindow.getImmersiveFrame(),visibleFlag:!0,closeButtonFlag:!1,allowedDockAreas:WUXDockAreaEnum.LeftDockArea|WUXDockAreaEnum.RightDockArea,currentDockArea:WUXDockAreaEnum.RightDockArea,collapsibleFlag:!1,resizableFlag:!0,verticallyStretchableFlag:!0,height:340,minWidth:400,width:400});return n.getContent().addClassName("xCity-wux-window"),n.addEventListener("stopWindowDrag",function(e){c(e.dsModel,i.frmWindow.getImmersiveFrame())}),c(n,this.frmWindow.getImmersiveFrame()),n},createPanels:function(){var e=new i;this.timeControlerPanel=this.addDebugPanel("Time Controller",e.container);var t=new a;this.animationPanel=this.addDebugPanel("Animation",t.container);var d=new n;this.debugControlsPanel=this.addDebugPanel("Debug Controls",d.container);var c=new s;this.atmosphereControlsPanel=this.addDebugPanel("Atmosphere Controls",c.container);var u=new l;this.cloudsControlsPanel=this.addDebugPanel("Clouds Controls",u.container);var h=new o;this.pbrControlsPanel=this.addDebugPanel("Pbr Controls",h.container),h.setup();var m=new r;this.lightControlsPanel=this.addDebugPanel("Light Controls",m.container)},hide:function(){this.timeControlerPanel.visibleFlag=!1,this.debugControlsPanel.visibleFlag=!1,this.animationPanel.visibleFlag=!1,this.atmosphereControlsPanel.visibleFlag=!1,this.cloudsControlsPanel.visibleFlag=!1,this.pbrControlsPanel.visibleFlag=!1,this.lightControlsPanel.visibleFlag=!1},show:function(){this.timeControlerPanel.visibleFlag=!0,this.debugControlsPanel.visibleFlag=!0,this.animationPanel.visibleFlag=!0,this.atmosphereControlsPanel.visibleFlag=!0,this.cloudsControlsPanel.visibleFlag=!1,this.pbrControlsPanel.visibleFlag=!1,this.lightControlsPanel.visibleFlag=!1}})});