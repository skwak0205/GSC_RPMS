define("DS/ENOXVersionExplorerSubwayListView/VersionExplorerColumnManager",["UWA/Core","DS/GraphListView/ColumnManagerBase","DS/WidgetServices/WidgetServices","DS/ENOXVersionExplorerUtils/VersionExplorerSettings","DS/ENOXVersionExplorerUtils/VersionExplorerEnums","i18n!DS/ENOXVersionExplorerSubwayListView/assets/nls/SubwayColumnsTitles","i18n!DS/ENOXVersionExplorerViews/assets/nls/VersionExplorerView"],function(e,t,n,o,i,s,r){"use strict";const a={day:"numeric",year:"numeric",month:"long",hour:"numeric",minute:"numeric"};return t.extend({init:function(t){this._parent(t),this.versionExplorerController=t.versionExplorerController,this.setDefaultColumns([{dataIndex:"__GRAPH__",sortFunction:function(e,t){return e.options.fakeDate<t.options.fakeDate?-1:1},onCellRequest:function(e){if(e.isHeader){var t=e.cellView._cellInfos.manager.getOrderedColumnState(),n=!0;o.historyConfig&&o.historyConfig.settings&&o.historyConfig.settings.subwayGraph&&Array.isArray(o.historyConfig.settings.subwayGraph.sortColumns)&&o.historyConfig.settings.subwayGraph.sortColumns.length&&(n=o.historyConfig.settings.subwayGraph.sortColumns.indexOf("__GRAPH__")>=0),n&&"creationDate"===t.dataIndex||"__GRAPH__"===t.dataIndex||"code"===t.dataIndex?e.cellView.getContent().addClassName("wux-ui-sort-"+t.sortOrder):(e.cellView.getContent().removeClassName("wux-ui-sort-asc"),e.cellView.getContent().removeClassName("wux-ui-sort-desc"))}}},{width:250,dataIndex:"tree",onCellRequest:function(e){if(!e.isHeader){var t=e.nodeModel,n=t.getTreeDocument()._DATA_MODEL_TYPE;if(n!==i.DATA_MODEL_TYPES.MODEL_P&&n!==i.DATA_MODEL_TYPES.MODEL_REVISION){var o,s,r=e.cellView.reuseCellContent("title_cell_view"),a=r.getElement(".symbol");if(t.options.ancestors&&t.options.ancestors.length){a.show();for(var l=0;l<t.options.ancestors.length;l++)o&&"I"!==t.options.ancestors[l].semantic||(o=t.options.ancestors[l].icon),"I"!==t.options.ancestors[l].semantic&&(s=t.options.ancestors[l].semantic);o?(a.setHTML('<img src="'+o+'">'),a.setStyle("background-color","transparent")):(a.setHTML(s),a.setStyle("background-color",null))}else a.hide();r.getElement(".title").setHTML(t.options.label)}else e.cellView.getContent().setContent(e.nodeModel.options.label)}}}]),this._customColumnViews.push({id:"thumbnail_cell_view",buildContent:function(){return new e.Element("div",{styles:{height:"80px","background-repeat":"no-repeat","background-size":"contain","background-position":"center center"}})}},{id:"title_cell_view",buildContent:function(){return e.createElement("div",{class:"with-version-semantic",html:["<span>",'<div class="symbol"></div>','<div class="title"></div>',"</span>"].join("\n")})}})},_customizeColumnView:function(t){if("modified"===(t=this._parent(t)).dataIndex)t.onCellRequest=function(e){if(!e.isHeader){var o=e.nodeModel,i=n.getLanguage();if(o.options.grid[e.dataIndex]instanceof Date){var s=o.options.grid[e.dataIndex].toLocaleString(i,a),r=e.cellView.getContent();r.setHTML(s),r.tooltipInfos&&(r.tooltipInfos.shortHelp=s)}}t.width=163};else if("creationDate"===t.dataIndex)t.onCellRequest=function(e){if(e.isHeader){var i=e.cellView._cellInfos.manager.getOrderedColumnState(),s=!0;o.historyConfig&&o.historyConfig.settings&&o.historyConfig.settings.subwayGraph&&Array.isArray(o.historyConfig.settings.subwayGraph.sortColumns)&&o.historyConfig.settings.subwayGraph.sortColumns.length&&(s=o.historyConfig.settings.subwayGraph.sortColumns.indexOf("creationDate")>=0),s&&"creationDate"===i.dataIndex||"__GRAPH__"===i.dataIndex||"code"===i.dataIndex?e.cellView.getContent().addClassName("wux-ui-sort-"+i.sortOrder):(e.cellView.getContent().removeClassName("wux-ui-sort-asc"),e.cellView.getContent().removeClassName("wux-ui-sort-desc"))}else{var r=e.nodeModel,l=n.getLanguage();if(r.options.grid[e.dataIndex]instanceof Date){var d=r.options.grid[e.dataIndex].toLocaleString(l,a),c=e.cellView.getContent();c.setHTML(d),c.tooltipInfos&&(c.tooltipInfos.shortHelp=d)}}t.width=163};else if("code"===t.dataIndex)t.width=75,t.sortFunction=function(e,t){var n=e.options.grid.code,o=t.options.grid.code;const i=e=>(+e).toString()===e,s=n.match(/\d+|\D+/g),r=o.match(/\d+|\D+/g);let a=0,l=Math.min(s.length,r.length);for(;a<l&&s[a]===r[a];)a++;return a===l?s.length-r.length:i(s[a])&&i(r[a])?s[a]-r[a]:s[a].localeCompare(r[a])},t.onCellRequest=function(e){if(e.isHeader){var t=e.cellView._cellInfos.manager.getOrderedColumnState(),n=!0;o.historyConfig&&o.historyConfig.settings&&o.historyConfig.settings.subwayGraph&&Array.isArray(o.historyConfig.settings.subwayGraph.sortColumns)&&o.historyConfig.settings.subwayGraph.sortColumns.length&&(n=o.historyConfig.settings.subwayGraph.sortColumns.indexOf("code")>=0),n&&"creationDate"===t.dataIndex||"__GRAPH__"===t.dataIndex||"code"===t.dataIndex?e.cellView.getContent().addClassName("wux-ui-sort-"+t.sortOrder):(e.cellView.getContent().removeClassName("wux-ui-sort-asc"),e.cellView.getContent().removeClassName("wux-ui-sort-desc"))}else{var i=e.nodeModel;e.cellView.getContent().setHTML(i.options.grid[e.dataIndex])}};else if("current"===t.dataIndex)t.width=150;else if("resp"===t.dataIndex)t.width=225;else if("thumbnail"===t.dataIndex)t.width=131,t.onCellRequest=function(e){if(!e.isHeader){e.nodeModel.options.grid.thumbnail||e.nodeModel.options.grid.icon;var t=e.cellView.reuseCellContent("thumbnail_cell_view");t&&(t.style.backgroundImage="url("+e.nodeModel.options.grid.thumbnail+")");var n=e.cellView.getContent();n.tooltipInfos&&(n.tooltipInfos.shortHelp=r.ClickToViewThumbnail)}},t.cellClickCB=function(e){e.cellModel&&require(["DS/PADUtils/views/PADThumbnail"],function(t){new t({cellModel:e.cellModel})._modal.elements.body.getElement(".padthumbnail_main").setStyle("background-image","url("+e.cellModel.options.value+")")})};else if("maturity_nls"===t.dataIndex&&(t.versionExplorerController=this.versionExplorerController,t.versionExplorerController._statesData&&t.versionExplorerController._statesData.policies&&t.versionExplorerController._statesData.policies.length>0)){t.states=t.versionExplorerController._statesData.policies[0].states,t.onCellRequest=function(n){if(!n.isHeader){var o=n.nodeModel,i=o.options.grid[n.dataIndex],s=o.options.grid.maturity,r=[];t.versionExplorerController._statesData.policies&&(r=t.versionExplorerController._statesData.policies[0].states);for(var a="red",l=0;l<r.length;l++)if(r[l].stateSysName===s){a=r[l].activeColor;break}let d=e.createElement("div",{class:"wux-controls-label",html:i,style:{backgroundColor:a}});d.style.backgroundColor=a,d.style.color="#FFFFFF"===a?"#000000":"#FFFFFF",d.style.paddingLeft="5px",d.style.paddingRight="5px","#FFFFFF"===a&&(d.style.border="1px solid #E2E4E3"),n.cellView.getContent().setContent(d)}};var i=t.versionExplorerController._setUseWebCommandsOnNative(),s=t.versionExplorerController.areCommandsEnabled(),l=t.versionExplorerController._isMaturityButtonDisabled(),d=t.versionExplorerController._isFromWebInWinWrapper();!s||t.versionExplorerController._isMIB||1==l||1==d&&1!=i||(t.cellClickCB=function(e){if(e.cellModel&&!t.isProcessingMaturityClick){t.isProcessingMaturityClick=!0;var n=e.cellView._cellInfos.nodeModel;t.versionExplorerController.publishEvent("preEventCompletedENOXVersionExplorerShowMaturity",n),setTimeout(function(){t.isProcessingMaturityClick=!1},200)}})}return t},getColumns:function(){var e=this._parent();return o.historyConfig&&o.historyConfig.settings&&o.historyConfig.settings.subwayGraph&&Array.isArray(o.historyConfig.settings.subwayGraph.sortColumns)&&o.historyConfig.settings.subwayGraph.sortColumns.length&&e.forEach(function(e){e.isSortable=o.historyConfig.settings.subwayGraph.sortColumns.indexOf(e.dataIndex)>=0}),e}})}),define("DS/ENOXVersionExplorerSubwayListView/VersionExplorerSubwayListView",["UWA/Core","DS/GraphListView/GraphListView","DS/ENOXVersionExplorerSubwayListView/VersionExplorerColumnManager","DS/ENOXVersionExplorerUtils/VersionExplorerSettings","DS/ENOXVersionExplorerUtils/VersionExplorerEnums","DS/ENOXVersionExplorerUtils/ENOXVersionExplorerUtils","DS/LifecycleServices/LifecycleServicesSettings","DS/UIKIT/Mask","css!DS/ENOXVersionExplorerSubwayListView/styles/VersionExplorerSubwayListView"],function(e,t,n,o,i,s,r,a,l){"use strict";function d(e){var t=[];if(e[0]&&e[1]){if(void 0===e[0].__SUBWAYGRAPHNODE__||void 0===e[1].__SUBWAYGRAPHNODE__)return t;var n=e[0].__SUBWAYGRAPHNODE__.data.parentEdges.find(function(t){return t.parentNode===e[1].__SUBWAYGRAPHNODE__})||e[0].__SUBWAYGRAPHNODE__.data.childEdges.find(function(t){return t.childNode===e[1].__SUBWAYGRAPHNODE__});if(n)t.push(n);else{for(var o,i=0,s=this._grMergeConnections.length;i<s;i++){var r=this._grMergeConnections[i];if(r.grParent===e[0].__SUBWAYGRAPHNODE__&&r.grChild.__SUBWAYGRAPHNODE__===e[1]||r.grParent===e[1].__SUBWAYGRAPHNODE__&&r.grChild===e[0].__SUBWAYGRAPHNODE__){o=r;break}}o&&(o.edge?t.push(o.edge):o.edges&&(t=o.edges))}}return t}return t.extend({_options:void 0,init:function(t){var i=this;this._options=e.extend({columnManager:new n(t),customOnDrop:t.customOnDrop,defaultCellHeight:48,enableListSelection:!0,versionExplorerController:t.versionExplorerController,onDragStartCell:function(e,t){var n=t.nodeModel._options.data,o=t.nodeModel.options.grid,i=o&&o.contents&&o.contents.length>0?o.contents[0].id:n.id,s={protocol:"3DXContent",version:"1.0",source:"ENOSTDE_AP",data:{items:[{envId:r.getTenant(),serviceId:n.serviceId,contextId:n.contextId,objectId:i,objectType:n.type,displayName:n.displayName+" "+n.revision,session_object:!1}]}};try{e.dataTransfer.effectAllowed="uninitialized",e.dataTransfer.setData("text/searchitems",JSON.stringify(s)),e.dataTransfer.setData("Text",JSON.stringify(s))}catch(t){e.dataTransfer.setData("Text",JSON.stringify(s))}},onDropCell:function(e,t){"function"==typeof this.options.customOnDrop&&this.options.customOnDrop(e)},onDropBlank:function(e,t){"function"==typeof this.options.customOnDrop&&this.options.customOnDrop(e)},onDropColumnHeader:function(e,t){return!0},onContextualEvent:{callback:function(e){e.treeview.nodeModel&&e.treeview.nodeModel.__MASTER__&&(i._manager.unsetActiveNode(),i._manager.setActiveNode(e.treeview.nodeModel),i._options.onNodeDropdownMenu({cellInfos:e.treeview,event:e.data.event}))}},graphSortingColumnID:["code","creationDate","__GRAPH__"],ascending:o.UserSettings.subwaySortAscending,enableActiveUI:!0,enableKeyboardNavigation:!0},t),this._parent(this._options)},updateSelectionMode:function(e){var t=this._manager;e||this.prepareUpdateColumns(),t.getColumnIDFromDataIndex("__DROPDOWN__")&&this.options.columnManager[this._model._SELECTION_MODE&i.SELECTION_MODES.WITH_COMMANDS?"showColumns":"hideColumns"](["__DROPDOWN__"]),this._model._SELECTION_MODE&i.SELECTION_MODES.MULTI_SELECT_ONLY?(t.options.selection.canMultiSelect=!0,this.options.columnManager.showColumns(["selection"])):(t.options.selection.canMultiSelect=!1,this.options.columnManager.hideColumns(["selection"]),this._model.getXSO().get().length>1&&this._model.getXSO().empty()),e||this.pushUpdateColumns(),(!(this._model._SELECTION_MODE&i.SELECTION_MODES.MULTI_SELECT_ONLY)||!(this._model._SELECTION_MODE&i.SELECTION_MODES.MULTI_SELECT_ACTIVE))&&this._treeDoc.getXSO().get().length>1&&this._treeDoc.getXSO().empty()},onSelectListView:function(e){if(!this._model._FILTER_ENABLED||e.data.nodeModel.__MASTER__.getAttribute("__filter__")){this._parent(e);var t=this._model.getXSO().get();if(!(this._model._SELECTION_MODE&i.SELECTION_MODES.MULTI_SELECT_ACTIVE)&&t.length>1){for(var n=0;n<t.length;n++)t[n].options.grid.__checked__=!0;e.data.nodeModel.__MASTER__._modelEvents.publish({event:"_ENOXVersionExplorerManageMultiSelect",data:!1})}this._manager.forceMultiSelection(!!(this._model._SELECTION_MODE&i.SELECTION_MODES.MULTI_SELECT_ACTIVE))}else this._model._FILTER_ENABLED&&!e.data.nodeModel.__MASTER__.getAttribute("__filter__")&&(e.data.nodeModel.unselect(),this._processMask(e.data.nodeModel._getRowID(),!0))},onUnselectListView:function(e){this._parent(e),this._manager.forceMultiSelection(!!(this._model._SELECTION_MODE&i.SELECTION_MODES.MULTI_SELECT_ACTIVE))},onHighlightLink:function(e){var t=this._graph,n=d.bind(this)(e.data);t.withLockedUpdate(function(){n.forEach(function(e){t.addToSelection(e)})})},onUnhighlightLink:function(e){var t=this._graph,n=d.bind(this)(e.data);t.withLockedUpdate(function(){n.forEach(function(e){t.removeFromSelection(e)})})},_addEventListeners:function(){var e=this;this._parent(),this._addEvent("LISTVIEWMANAGER","preFullUpdateView",function(t){e._manager.onPostUpdateViewOnce(function(t){e.onUpdateViewComplete.bind(e)(t)})}),this._addEvent("LISTVIEWMANAGER","showColumn",function(t){"creationDate"===e._manager.getDataIndexFromColumnID(t.columnID)&&e._manager._setColumnState(t.columnID,"sort:"+(e.options.ascending?"asc":"desc"))}),this._addEvent("LISTVIEWMANAGER","click",function(t){var n=e._manager.options.columns.find(function(e){return e.dataIndex===t.dataIndex});n&&"function"==typeof n.cellClickCB&&n.cellClickCB(t)}),e._addEvent("MASTER","highlightLink",e.onHighlightLink.bind(this)),e._addEvent("MASTER","unhighlightLink",e.onUnhighlightLink.bind(this))},onMasterNodeAttributeChanged:function(e){e.data;this._parent(e),this.onUpdateViewComplete(e)},_setActive:function(e){this._manager[e.__MASTER__.isActive()?"addRowClass":"removeRowClass"](e._getRowID(),"version-explorer-subway-listview-active-version")},_setFilter:function(e){this._manager;var t=e._getRowID();this._model._FILTER_ENABLED&&!e.__MASTER__.getAttribute("__filter__")&&this._processMask(t,!0)},onUpdateViewComplete:function(e){var t;this._manager;if("attributeChanged"===e.event&&(t=e.data.nodeModel),t&&t.__LISTVIEWCOPY__)this._setActive(t.__LISTVIEWCOPY__),this._setFilter(t.__LISTVIEWCOPY__);else for(var n,o=0,i=this._treeDoc.getAllDescendants(),s=i.length;o<s;o+=1)n=i[o],this._setActive(n),this._setFilter(n)},_processMask:function(e,t){var n;this._manager.processCellsOfRow({rowID:e,minColumnID:0},function(e,o,i){(n=e.getView())&&(t?(a.mask(n.getContent(),""),n.getContent().getElement(".spinner").hide()):a.unmask(n.getContent()))})},onSort:function(e){this._parent(e),"creationDate"===e.columnDataIndex&&o._saveUserSettings("subwaySortAscending",this.options.ascending,this._model.useGlobalStorage,this._model.globalStorageName,this._model.webToWinComSocket)},updateNodes:function(){this._parent(),this._manager.sortColumnContent("__GRAPH__",{typeOfCell:"number",sortOrder:!0===this.options.ascending?"asc":"desc"})},deactivate:function(){this._parent();var e=this._graph;e.withLockedUpdate(function(){for(var t,n=e.edges.first;n;n=t)t=n.next,n.isSelected()&&e.removeFromSelection(n)})},activate:function(){this._parent(),this._updateGraphSelection()},prepareUpdateView:function(){this._removeEvent("MASTER","select"),this._removeEvent("MASTER","unselect"),this._removeEvent("MASTER","attributeChanged"),this._parent()},pushUpdateView:function(){this._parent(),this._addEvent("MASTER","select",this.onSelectMaster.bind(this)),this._addEvent("MASTER","unselect",this.onUnselectMaster.bind(this)),this._addEvent("MASTER","attributeChanged",this.onMasterNodeAttributeChanged.bind(this))},setRowHeight:function(e){var t=this.options.columnManager.getColumns().findIndex(function(e){return"thumbnail"===e.dataIndex&&!e.isHidden})>=0?80:e;this._parent(t)},_updateGraphSelection:function(){var e=this._model.getHighlightedLinksData(),t=[],n=this._graph;if(e.length)for(var o=0,i=e.length;o<i;o++)t=t.concat(d.bind(this)(e[o]));n.withLockedUpdate(function(){for(var e,o=n.edges.first;o;o=e)e=o.next,o.isSelected()&&n.removeFromSelection(o);t.forEach(function(e){n.addToSelection(e)})})}})});