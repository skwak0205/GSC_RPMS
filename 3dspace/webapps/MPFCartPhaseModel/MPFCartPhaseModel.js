define("DS/MPFCartPhaseModel/CartPhaseModel",["UWA/Core","UWA/Promise","DS/MPFModel/MPFModel","DS/MPFModel/ModelValidator","i18n!DS/MPFCartPhaseModel/assets/nls/CartPhaseModel"],function(t,e,r,a,i){"use strict";var n,s={},o={},u={},d={};return s.STATE="currentState",s.NAME="Name",s.DESCRIPTION="PhaseDescription",s.NUMBER="PhaseNumber",s.PRICE="UnitNetAmount",s.START_DATE="PhaseStartDate",s.END_DATE="PhaseEndDate",s.TOTAL_NET_AMOUNT="TotalNetAmount",s.TOTAL_TAXES_AMOUNT="TotalTaxesAmount",s.TOTAL_GROSS_AMOUNT="TotalGrossAmount",s.UNIT_TAXES_AMOUNT="UnitTaxesAmount",s.UNIT_NET_AMOUNT="UnitNetAmount",s.PHASE_NUMBER="PhaseNumber",s.DOCUMENTS="documents",o.DRAFT="DRAFT",o.SUBMITTED="SUBMITTED",o.ACCEPTED="ACCEPTED",o.PENDING_PROCESSING="PENDING_PROCESSING",o.PROCESSING="PROCESSING",o.DELIVERED="DELIVERED",o.PAYMENT_REFUSED="PAYMENT_REFUSED",o.READY="READY",o.SHIPPED="SHIPPED",o.DELETED="DELETED",u[o.DRAFT]=i.get("submitted"),u[o.SUBMITTED]=i.get("submitted"),u[o.ACCEPTED]=i.get("accepted"),u[o.PENDING_PROCESSING]=i.get("confirmed"),u[o.PROCESSING]=i.get("processing"),u[o.PAYMENT_REFUSED]=i.get("unknown"),u[o.DELIVERED]=i.get("delivered"),u[o.READY]=i.get("ready"),u[o.SHIPPED]=i.get("delivered"),u[o.DELETED]=i.get("canceled"),d.DOCUMENTS="documents",(n=r.extend({setup:function(t,e){this._type="CartPhaseModel",this._parent(t,e),this.validator=this._createValidator()},updateState:function(t){var r,a;return Object.keys(o).indexOf(t)>-1?((a={})[s.STATE]=t,r=this.savePromise(a,{patch:!0})):r=e.reject(new Error("state "+t+" does not exist")),r},validate:function(t){return this.validator.validate(t)},_createValidator:function(){return new a({model:this,validations:[{attribute:s.DESCRIPTION,required:!0,requiredError:i.get("errorDescriptionMissing")},{attribute:s.PRICE,required:!0,pattern:/^-?\d+(\.\d{1,3})?$/,requiredError:i.get("errorPriceMissing"),invalidError:i.get("errorPriceFormat")},{attribute:s.PRICE,pattern:/^(?!-)[0-9.,]+$/,invalidError:i.get("errorPriceZeroOrNegative")},{attribute:s.PRICE,pattern:/[1-9]+/,invalidError:i.get("errorPriceZeroOrNegative")},{attribute:s.START_DATE,required:!0,requiredError:i.get("errorStartDateMissing")},{attribute:s.END_DATE,required:!0,requiredError:i.get("errorEndDateMissing")}]})},getState:function(){return this.get(s.STATE)},setState:function(t){return this.set(s.STATE,t)},getName:function(){return this.get(s.NAME)},getNumber:function(){return this.get(s.NUMBER)},setNumber:function(t){return this.set(s.NUMBER,t)},getDescription:function(){return this.get(s.DESCRIPTION)},getPrice:function(){return this.get(s.PRICE)},getStartDate:function(){return this.get(s.START_DATE)},getEndDate:function(){return this.get(s.END_DATE)},getTotalNetAmount:function(){return this.get(s.TOTAL_NET_AMOUNT)},getTotalTaxesAmount:function(){return this.get(s.TOTAL_TAXES_AMOUNT)},getTotalGrossAmount:function(){return this.get(s.TOTAL_GROSS_AMOUNT)},getUnitNetAmount:function(){return this.get(s.UNIT_NET_AMOUNT)},getUnitTaxesAmount:function(){return this.get(s.UNIT_TAXES_AMOUNT)},getPhaseNumber:function(){return this.get(s.PHASE_NUMBER)},getDisplayedState:function(){return u[this.getState()]||i.get("unknown")},getDocuments:function(){return this.get(s.DOCUMENTS)},hasDocuments:function(){var t;return!!(t=this.getDocuments())&&t.length>0},isEditable:function(){var t=this.getState();return this.isNew()||t===o.DRAFT||t===o.SUBMITTED}})).Fields=Object.freeze(s),n.States=Object.freeze(o),n.Expands=Object.freeze(d),n}),define("DS/MPFCartPhaseModel/CartPhaseDataProxy",["DS/MPFDataProxy/DataProxy"],function(t){"use strict";return t.extend({init:function(t,e){this._parent(t,"/mdcart/phases",e)}})}),define("DS/MPFCartPhaseModel/CartCartPhaseDataproxy",["UWA/String","DS/MPFDataProxy/DataProxy","DS/MPFError/NotImplementedError"],function(t,e,r){"use strict";return e.extend({init:function(t,e){this._parent(t,"/mdcart/carts/{0}/phases",e)},buildPath:function(e,r){return t.format(this.resourcePath,e.parentResourceId)},urlPut:r.emit,urlDelete:e.delegate,urlPatch:e.delegate,doPut:r.emit,doDelete:e.delegate,doPatch:e.delegate})}),define("DS/MPFCartPhaseModel/CartPhaseValidationResult",["UWA/Class"],function(t){"use strict";return t.extend({init:function(t){this._phase=t,this._isValid=!0,this._errors=[]},isValid:function(){return this._isValid},getPhase:function(){return this._phase},addError:function(t,e){this._isValid=!1,this._errors.push({field:t,message:e})},getErrors:function(){return this._errors},toDataObject:function(){return{isValid:this.isValid(),errors:this.getErrors()}}})}),define("DS/MPFCartPhaseModel/CartPhasesValidationResults",["UWA/Class","DS/MPFCartPhaseModel/CartPhaseValidationResult"],function(t,e){"use strict";return t.extend({init:function(){this._isValid=!0,this._phaseValidationResults=[]},isValid:function(){return this._isValid},addPhaseValidationResult:function(t){this._isValid=this._isValid&&t.isValid(),this._phaseValidationResults.push(t)},getPhaseValidationResults:function(){return this._phaseValidationResults}})}),define("DS/MPFCartPhaseModel/CartPhaseCollection",["DS/MPFModel/MPFCollection","DS/MPFCartPhaseModel/CartPhaseModel","DS/MPFCartPhaseModel/CartPhasesValidationResults","DS/MPFCartPhaseModel/CartPhaseValidationResult","i18n!DS/MPFCartPhaseModel/assets/nls/CartPhaseModel"],function(t,e,r,a,i){"use strict";var n;return(n=t.extend({model:e,comparator:function(t,e){return parseInt(t.getNumber(),10)-parseInt(e.getNumber(),10)},validate:function(t){t=t||{};var n=new r,s=new Date(0);return this.forEach(function(t){var r,o,u;r=new Date(t.getStartDate()),o=new Date(t.getEndDate()),u=new a(t),s>r&&u.addError(e.Fields.START_DATE,i.get("phaseStartDateMustBeAfterPreviousPhaseEndDate")),r>o&&u.addError(e.Fields.END_DATE,i.get("phaseEndDateMustBeAfterStartDate")),this._phaseValidation(t,u),n.addPhaseValidationResult(u),s=o},this),n},_phaseValidation:function(t,e){var r=t.validate();if(Array.isArray(r))for(var a=0;a<r.length;a++)e.addError(r[a].field,r[a].message)},getActivePhase:function(){var t;return(t=this.find(function(t){var r;return(r=t.getState())===e.States.ACCEPTED||r===e.States.PENDING_PROCESSING||r===e.States.PROCESSING||r===e.States.PAYMENT_REFUSED||r===e.States.READY}))||(t=this.find(function(t){return t.getState()===e.States.SUBMITTED})),t}})).Expands=e.Expands,n}),define("DS/MPFCartPhaseModel/CartPhaseFactory",["DS/MPFModelFactory/Factory","DS/MPFCartPhaseModel/CartPhaseModel","DS/MPFCartPhaseModel/CartPhaseCollection","DS/MPFCartPhaseModel/CartPhaseDataProxy","DS/MPFCartPhaseModel/CartCartPhaseDataproxy"],function(t,e,r,a,i){"use strict";var n,s;return s={CART_PHASE:"cartPhase",CART_CART_PHASE:"cartCartPhase"},(n=t.extend({createModel:function(t,r,a){return this._parent(e,t,r,a)},createCollection:function(t,e,a){return this._parent(r,t,e,a)},getDataProxy:function(t){var e;return t===s.CART_CART_PHASE?(this.dataProxies[s.CART_CART_PHASE]||(this.dataProxies[s.CART_CART_PHASE]=new i(this.connector,this.getDataProxy(s.CART_PHASE))),e=this.dataProxies[s.CART_CART_PHASE]):(this.dataProxies[s.CART_PHASE]||(this.dataProxies[s.CART_PHASE]=new a(this.connector)),e=this.dataProxies[s.CART_PHASE]),e}})).Types=Object.freeze(s),n});