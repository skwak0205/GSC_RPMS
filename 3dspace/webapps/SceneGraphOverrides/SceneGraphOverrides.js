define("DS/SceneGraphOverrides/ClippingContext",["DS/Visualization/ClippingContext"],function(e){return console.log("Please require 'DS/Visualization/ClippingContext' instead of 'DS/SceneGraphOverrides/ClippingContext"),e}),define("DS/SceneGraphOverrides/SceneGraphOverrideSetToken",["UWA/Class"],function(e){"use strict";var i=0;return e.extend({init:function(e,t){i++,this.id=i,this.sceneGraphOverrideSet=e,this.rank=t,this.index=-1}})}),define("DS/SceneGraphOverrides/IdPathOverrideWatcherTree",["DS/CoreEvents/Events","DS/Visualization/IdPathWatcher","DS/Visualization/IdPath"],function(e,i,t){"use strict";var r=function(t){this.idPathWatcher=new i({onIdPathActiveCB:this.onIdPathActive.bind(this),onIdPathInactiveCB:this.onIdPathInactive.bind(this),idPathMatcher:t.idPathMatcher||null,viewer:t.viewer}),this.overrideToWatchedOverride=new Map,this.nodeIdOverrideSet=new Set,this.needsUpdate=!0,this.token=e.subscribe({event:"/VISU/onSceneGraphUpdate"},this.onSceneGraphUpdate.bind(this))};r.prototype.addIdPathOverride=function(e){var i,t,r,s=new n(e);this.overrideToWatchedOverride.set(e,s);var a=e._idPathes;if(a)for(i=0;i<a.length;i++)t=a[i],r=s.addIdPath(t),this.idPathWatcher.addIdPath(t,r);else e._nodeId&&(this.nodeIdOverrideSet.add(e),this.activateOverride(e))},r.prototype.activateOverride=function(e){var i;i=e.getSceneGraphOverrideSet()._getViewerEntries();var t=this.idPathWatcher.getIdPathMatcher();e._tryIdPathActivate(t,i)},r.prototype.removeIdPathOverride=function(e){var i=this.overrideToWatchedOverride.get(e);if(i){if(e._nodeId)this.nodeIdOverrideSet.delete(e);else for(var t=i.firstIdPath;t;)this.idPathWatcher.removeIdObject(t),t=t.nextIdPath;this.overrideToWatchedOverride.delete(e)}},r.prototype.onOverrideDetach=function(e){},r.prototype.dispose=function(){this.idPathWatcher.dispose(),this.idPathWatcher=null,this.token&&(e.unsubscribe(this.token),this.token=null)},r.prototype.onIdPathActive=function(e){var i=e.watchedOverride;i.count--,0===i.count&&this.activateOverride(i.override)},r.prototype.onIdPathInactive=function(e){var i=e.watchedOverride;i.count++;var t=i.override;t&&t._resetOccurrenceBuffer()},r.prototype.update=function(){this.needsUpdate&&(this.needsUpdate=!1,this.nodeIdOverrideSet.forEach(e=>{this.activateOverride(e)}))},r.prototype.onSceneGraphUpdate=function(e){this.needsUpdate=!0};var n=function(e){this.override=e,this.count=0,this.firstIdPath=null};n.prototype.addIdPath=function(e){var i=new s(e,this);return i.nextIdPath=this.firstIdPath,this.firstIdPath=i,this.count++,i};var s=function(e,i){this.idPath=e,this.watchedOverride=i,this.nextIdPath=null};return r}),define("DS/SceneGraphOverrides/OverrideLink",["UWA/Class"],function(e){"use strict";var i=1,t=e.extend({init:function(e){this.id=i++,this.visibilityFix=e,this.reset(),window.sealWebVisuObjects&&Object.seal(this)},reset:function(){this.opacityOverride=null,this.fullMaterialOverride=null,this.visibilityOverride=null,this.colorOverride=null,this.pickabilityOverride=null,this.position=null,this.internalMaterialOverride=null,this.disableColorOverride=!1,this.internalMaterialOverrideReset=!1},copyInheritableProperties:function(e){this.opacityOverride=e.opacityOverride,this.fullMaterialOverride=e.fullMaterialOverride,this.visibilityFix||(this.visibilityOverride=e.visibilityOverride),this.colorOverride=e.colorOverride},setFromOverrideSet:function(e){this.fullMaterialOverride=null!==e.fullMaterial?e:null,this.colorOverride=null!==e.color?e:null,this.pickabilityOverride=null!==e.pickability?e:null,this.opacityOverride=null!==e.opacity?e:null,this.visibilityOverride=null!==e.visibility?e:null,this.position=e.position,this.internalMaterialOverride=e.internalMaterialOverride},getFullMaterial:function(){return this.fullMaterialOverride&&this.fullMaterialOverride.fullMaterial},getOpacity:function(){return this.opacityOverride&&this.opacityOverride.opacity},hasTransparency:function(){var e=this.getOpacity();return null!==e&&e<1},getVisibility:function(){return this.visibilityOverride&&this.visibilityOverride.visibility},getForceShowVisibility:function(){return!1},getVisibilityFree:function(){return null},getPickability:function(){return this.pickabilityOverride&&this.pickabilityOverride.pickability},getForceShowPickability:function(){return!1},getPickingPriorityID:function(){return null},getColor:function(){return this.disableColorOverride?null:this.colorOverride&&this.colorOverride.color},getSubstituteMatrix:function(){return this.position},getClipping:function(){return null},hasVisibilityOverride:function(){return!!this.visibilityOverride},hasMaterialOverride:function(){return this.fullMaterialOverride||this.colorOverride||this.opacityOverride},getAppliedPropertiesNEW:function(){var e={};function i(i,t,r){e[i]={value:t}}return this.hasMaterialOverride()&&(this.getColor()&&i("color",this.getColor()),this.getFullMaterial()&&i("material",this.getFullMaterial()),this.getOpacity()&&i("opacity",this.getOpacity())),this.getPickability()&&i("pickability",this.getPickability()),this.getVisibility()&&i("visibility",this.getVisibility().visibility),this.position&&i("matrix",this.position.clone()),e},createOverrideLink:function(){return new t},combine:function(e,i){e?(this.setFromOverrideSet(e),i&&(i.fullMaterialOverride&&!e.forceInheritFullMaterial&&(this.fullMaterialOverride=i.fullMaterialOverride),i.colorOverride&&!e.forceInheritColor&&(this.colorOverride=i.colorOverride),this.visibilityFix||!i.pickabilityOverride||e.forceInheritPickability||(this.pickabilityOverride=i.pickabilityOverride),i.opacityOverride&&!e.forceInheritOpacity&&(this.opacityOverride=i.opacityOverride),this.visibilityFix||!i.visibilityOverride||e.forceInheritVisibility||(this.visibilityOverride=i.visibilityOverride))):i?this.copyInheritableProperties(i):this.reset()},getMatrixUpdate:function(){return!0},clearMatrixUpdate:function(){},setMatrixUpdate:function(){},getRenderStyle:function(){return null},isPGPOnly:function(){return!1}});return t}),define("DS/SceneGraphOverrides/OverrideLink2",["UWA/Class","DS/Visualization/ThreeJS_DS"],function(e,i){"use strict";var t=1,r=-1;function n(){return 1===r&&console.log("ERROR - SceneGraphOverrideSet internal inconsistency"),null}var s=e.extend({init:function(e){this.id=t++,this.visibilityFix=!0,this.reset(),this.disableColorOverride=!1,this.matrixUpdate=!1,r<0&&(r=window.WUXOverrideDebug?1:0),window.sealWebVisuObjects&&Object.seal(this)},reset:function(){this.positionOverride&&(this.matrixUpdate=!0),this.opacityOverride=null,this.pgpInheritance=0,this.fullMaterialOverride=null,this.visibilityOverride=null,this.visibilityFreeOverride=null,this.colorOverride=null,this.pickabilityOverride=null,this.positionOverride=null,this.clippingOverride=null,this.renderStyleOverride=null},copyInheritableProperties:function(e){this.opacityOverride=e.opacityOverride,this.pgpInheritance=e.pgpInheritance,this.fullMaterialOverride=e.fullMaterialOverride,this.visibilityFix||(this.visibilityOverride=e.visibilityOverride),this.colorOverride=e.colorOverride,this.renderStyleOverride=e.renderStyleOverride},setFromOverrideSet:function(e){this.fullMaterialOverride=null!==e.fullMaterial?e:null,this.colorOverride=null!==e.color?e:null,this.pickabilityOverride=null!==e.pickability?e:null,this.opacityOverride=null!==e.opacity?e:null,this.pgpInheritance=e.pgpInheritance?e.pgpInheritance._values.pgpInheritance:0,this.visibilityOverride=null!==e.visibility?e:null,this.visibilityFreeOverride=null!==e.visibilityFree?e:null,this.positionOverride=null!==e.position?e:null,this.clippingOverride=null!==e.clipping?e:null,this.renderStyleOverride=null!==e.renderStyle?e:null,e.matrixUpdate&&(this.matrixUpdate=!0,e.unsetMatrixUpdate())},getFullMaterial:function(e){if(this.fullMaterialOverride&&!this.fullMaterialOverride.fullMaterial)return n();var i=null;if(this.fullMaterialOverride){var t=this.fullMaterialOverride.fullMaterial;!e&&t._sceneGraphOverrideSet._materialModeSensitive||(i=t._values.fullMaterial)}return i},getOpacity:function(){if(this.opacityOverride&&!this.opacityOverride.opacity)return n();var e=this.opacityOverride,i=null;e&&(e.opacity._pgp?2&this.getPGPInheritance()&&(i=this.opacityOverride.opacity._values.opacity):(i=this.opacityOverride.opacity._values.opacity)===s.NO_OPACITY&&(i=null));return i},hasTransparency:function(){var e=this.getOpacity();return null!==e&&e<1},getVisibility:function(){return this.visibilityOverride&&!this.visibilityOverride.visibility?n():this.visibilityOverride&&this.visibilityOverride.visibility._values.visibility},getForceShowVisibility:function(){return!(!this.visibilityOverride||!this.visibilityOverride.visibility)&&this.visibilityOverride.visibility._getForceShowMode()},getVisibilityFree:function(){return this.visibilityFreeOverride&&!this.visibilityFreeOverride.visibilityFree?n():this.visibilityFreeOverride&&this.visibilityFreeOverride.visibilityFree._values.visibilityFree},getClipping:function(){return this.clippingOverride&&!this.clippingOverride.clipping?n():this.clippingOverride&&this.clippingOverride.clipping._values.clipping},getRenderStyle:function(){return this.renderStyleOverride&&!this.renderStyleOverride.renderStyle?n():this.renderStyleOverride&&this.renderStyleOverride.renderStyle._values.renderStyle},getPickability:function(){if(this.pickabilityOverride&&!this.pickabilityOverride.pickability)return n();var e=this.pickabilityOverride&&this.pickabilityOverride.pickability._values.pickability;return e&&e.pickability},getForceShowPickability:function(){return!(!this.pickabilityOverride||!this.pickabilityOverride.pickability)&&this.pickabilityOverride.pickability._getForceShowMode()},getPickingPriorityID:function(){if(this.pickabilityOverride&&!this.pickabilityOverride.pickability)return n();var e=this.pickabilityOverride&&this.pickabilityOverride.pickability._values.pickability;return e&&e.pickingPriorityID},getPGPInheritance:function(){return this.pgpInheritance},getColor:function(){if(this.colorOverride&&!this.colorOverride.color)return n();var e=this.colorOverride,i=null;e&&!this.disableColorOverride&&(e.color._pgp?1&this.getPGPInheritance()&&(i=this.colorOverride.color._values.color):(i=this.colorOverride.color._values.color)===s.NO_COLOR&&(i=null));return i},getSubstituteMatrix:function(){return this.positionOverride&&!this.positionOverride.position?n():this.positionOverride&&this.positionOverride.position._values.position},hasVisibilityOverride:function(){return!(!this.visibilityOverride&&!this.visibilityFreeOverride)},hasMaterialOverride:function(){var e=!1;return this.fullMaterialOverride&&(e=!0),this.colorOverride&&!this.colorOverride._pgp&&(e=!0),this.opacityOverride&&!this.opacityOverride._pgp&&(e=!0),e},getAppliedPropertiesNEW:function(){var e={};function i(i,t,r){e[i]={value:t}}if(this.hasMaterialOverride()){this.getColor()&&i("color",this.getColor()),this.getFullMaterial()&&i("material",this.getFullMaterial());var t=this.getOpacity();null!=t&&i("opacity",t)}return this.getPickability()&&i("pickability",this.getPickability()),this.getVisibility()&&i("visibility",this.getVisibility().visibility),this.getVisibilityFree()&&i("visibilityFree",this.getVisibilityFree().visibilityFree),this.getClipping()&&i("clipping",this.getClipping().clone()),this.getRenderStyle()&&i("renderStyle",this.getRenderStyle().clone()),this.positionOverride&&i("position",this.getSubstituteMatrix().clone()),e},createOverrideLink:function(){return new s},combine:function(e,i){var t,r;if(e){if(this.setFromOverrideSet(e),i){var n=e.getInheritLevel("fullMaterial");if(i.fullMaterialOverride){var s=i.fullMaterialOverride.getInheritLevel("fullMaterial");this.isWeakInherit(s)?this.fullMaterialOverride=this.fullMaterialOverride||i.fullMaterialOverride:this.isStandardOrWeakInherit(n)?this.fullMaterialOverride=i.fullMaterialOverride:this.isReset(n)&&(this.fullMaterialOverride=null)}if(!(t=i.colorOverride)||!t.color._pgp||1&i.getPGPInheritance()||(t=null),t)if(t.color._pgp&&this.colorOverride&&!this.colorOverride.color._pgp);else if(this.colorOverride&&this.colorOverride.color._pgp&&!t.color._pgp)this.colorOverride=t;else{var a=e.getInheritLevel("color"),o=t.getInheritLevel("color");this.isWeakInherit(o)?this.colorOverride=this.colorOverride||t:this.isStandardOrWeakInherit(a)?this.colorOverride=t:this.isReset(a)&&(this.colorOverride=null)}if(!(r=i.opacityOverride)||!r.opacity._pgp||2&i.getPGPInheritance()||(r=null),r)if(r.opacity._pgp&&this.opacityOverride&&!this.opacityOverride.opacity._pgp);else if(this.opacityOverride&&this.opacityOverride.opacity._pgp&&!r.opacity._pgp)this.opacityOverride=r;else{var h=e.getInheritLevel("opacity"),l=r.getInheritLevel("opacity");this.isWeakInherit(l)?this.opacityOverride=this.opacityOverride||r:this.isStandardOrWeakInherit(h)?this.opacityOverride=r:this.isReset(h)&&(this.opacityOverride=null)}this.pgpInheritance=this.pgpInheritance|i.pgpInheritance,i.renderStyleOverride&&(i.renderStyleOverride.hasWeakInherit("renderStyle")?this.renderStyleOverride=this.renderStyleOverride||i.renderStyleOverride:e.hasForceInherit("renderStyle")||(this.renderStyleOverride=i.renderStyleOverride))}}else i?this.copyInheritableProperties(i):this.reset()},isWeakInherit:function(e){return 4===e},isStandardOrWeakInherit:function(e){return e<=1||4===e},isReset:function(e){return 3===e},getMatrixUpdate:function(){return this.matrixUpdate},clearMatrixUpdate:function(){this.matrixUpdate=!1},setMatrixUpdate:function(){this.matrixUpdate=!0},getRenderPriorityOpacity:function(){return null},isPGPOnly:function(){var e=!1;if(this.opacityOverride&&this.opacityOverride.opacity){if(!this.opacityOverride.opacity._pgp)return!1;e=!0}if(this.colorOverride&&this.colorOverride.color){if(!this.colorOverride.color._pgp)return!1;e=!0}return!this.fullMaterialOverride&&e},getPGPGSSOId:function(){var e="#";return this.opacityOverride&&this.opacityOverride.opacity&&(e+="o"+this.opacityOverride.opacity._values.opacity),this.colorOverride&&this.colorOverride.color&&(e+="c"+i.getColorHex(this.colorOverride.color._values.color)),e+="i"+this.pgpInheritance}});return s.getNewId=function(){return t++},s.NO_COLOR="NO_COLOR",s.NO_OPACITY=-1,s}),define("DS/SceneGraphOverrides/OverrideSet",["UWA/Class","DS/Visualization/ThreeJS_DS","DS/SceneGraphOverrides/SceneGraphOverrideSetToken","DS/SceneGraphOverrides/OverrideLink"],function(e,i,t,r){"use strict";var n=1,s=e.extend({init:function(e,i){this.id=n++,this.pathElement=e,this.visibilityFix=i||!1,this.reset(),this.forceInheritOpacity=null,this.forceInheritFullMaterial=null,this.forceInheritVisibility=null,this.forceInheritColor=null,this.forceInheritPickability=null,this.invalidateBE=!1,this.internalMaterialOverride=null,window.sealWebVisuObjects&&Object.seal(this)},reset:function(){this.fullMaterial=null,this.color=null,this.pickability=null,this.opacity=null,this.visibility=null,this.position=null,this.internalMaterialOverride=null},cloneForFlatten:function(){var e=new s(this.pathElement,this.visibilityFix);return e.fullMaterial=this.fullMaterial,e.color=this.color,e.pickability=this.pickability,e.opacity=this.opacity,e.visibility=null!==this.visibility?{visibility:this.visibility.visibility}:null,e.position=this.position,e.internalMaterialOverride=this.internalMaterialOverride,e},clone:function(){var e=this.cloneForFlatten();return e.forceInheritOpacity=this.forceInheritOpacity,e.forceInheritFullMaterial=this.forceInheritFullMaterial,e.forceInheritVisibility=this.forceInheritVisibility,e.forceInheritColor=this.forceInheritColor,e.forceInheritPickability=this.forceInheritPickability,e},copy:function(e){this.fullMaterial=e.fullMaterial,this.color=e.color,this.pickability=e.pickability,this.opacity=e.opacity,this.visibility=e.visibility,this.internalMaterialOverride=e.internalMaterialOverride,this.position=e.position},copyWithoutPosition:function(e){this.fullMaterial=e.fullMaterial,this.color=e.color,this.opacity=e.opacity,this.internalMaterialOverride=e.internalOverride,this.visibilityFix||(this.visibility=e.visibility,this.pickability=e.pickability)},createOverrideLink:function(){return new r},mergeInto:function(e){var i=this;function t(t,r){null!==i[t]&&(e[t]=i[t],r&&(e[r]=i[r]))}t("fullMaterial","forceInheritFullMaterial"),t("color","forceInheritColor"),t("pickability",this.visibilityFix?void 0:"forceInheritPickability"),t("opacity","forceInheritOpacity"),t("visibility",this.visibilityFix?void 0:"forceInheritVisibility"),t("position"),t("internalMaterialOverride")},add:function(e){e.applyToOverrideSet(this)},hasMaterialOverride:function(){return this.fullMaterial||this.color||null!==this.opacity},hasVisibilityOverride:function(){return null!=this.visibility},getSubstituteMatrix:function(){return this.position},getVisibility:function(){return this.visibility},changeOpacity:function(e,i){this.forceInheritOpacity=i,this.opacity=e},changeMaterial:function(e,i){this.forceInheritFullMaterial=i,this.fullMaterial=e},changePosition:function(e){this.invalidateBE=!0,e?(this.position||(this.position=new i.Matrix4),this.position.copy(e)):this.position=null},unsetInvalidateBE:function(){this.invalidateBE=!1},changeVisibility:function(e,i){this.forceInheritVisibility=i,this.visibility=null!==e?{visibility:e}:null},changeColor:function(e,i){this.visibilityFix||(this.forceInheritColor=i),this.color=e},changePickability:function(e,i){this.visibilityFix||(this.forceInheritPickability=i),this.pickability=e},getColor:function(){return this.color},getPickability:function(){return this.pickability},getOpacity:function(){return this.opacity},getMaterial:function(){return this.fullMaterial},getPosition:function(){return this.position},getAppliedProperties:function(e){var i=[];function t(e){return e?"FORCE_INHERIT":"INHERIT"}return this.hasMaterialOverride()&&(!this.color||e&&"color"!==e||i.push({type:"color",color:this.color,inheritance:t(this.forceInheritColor)}),!this.fullMaterial||e&&"material"!==e||i.push({type:"material",material:this.fullMaterial,inheritance:t(this.forceInheritFullMaterial)}),!this.opacity||e&&"opacity"!==e||i.push({type:"opacity",opacity:this.opacity,inheritance:t(this.forceInheritOpacity)})),!this.pickability||e&&"pickability"!==e||i.push({type:"pickability",pickability:this.pickability,inheritance:t(this.forceInheritPickability)}),!this.visibility||e&&"visibility"!==e||i.push({type:"visibility",visibility:this.visibility.visibility,inheritance:t(this.forceInheritVisibility)}),!this.position||e&&"matrix"!==e||i.push({type:"matrix",matrix:this.position.clone(),inheritance:"NOT_INHERIT"}),i},combine:function(e,i,t){this.fullMaterial;e?(this.copy(e),i&&(i.fullMaterial&&!e.forceInheritFullMaterial&&(this.fullMaterial=i.fullMaterial),i.color&&!e.forceInheritColor&&(this.color=i.color),this.visibilityFix||!i.pickability||e.forceInheritPickability||(this.pickability=i.pickability),null===i.opacity||e.forceInheritOpacity||(this.opacity=i.opacity),this.visibilityFix||!i.visibility||e.forceInheritVisibility||(this.visibility=i.visibility))):i?this.copyWithoutPosition(i):this.reset()},setInternalMaterial:function(e,i){this.internalMaterialOverride=e?{internalPath:i,material:e}:null},hasASMInherit:function(){return!0}});return s}),define("SceneGraphOverrides/OverrideSet",["DS/SceneGraphOverrides/OverrideSet","DS/DSMigration/DSMigration"],function(e,i){return i.deprecateModule("SceneGraphOverrides/OverrideSet"),e}),define("DS/SceneGraphOverrides/OverrideSet2",["UWA/Class","DS/Visualization/ThreeJS_DS","DS/SceneGraphOverrides/SceneGraphOverrideSetToken","DS/SceneGraphOverrides/OverrideLink2"],function(e,i,t,r){"use strict";var n=1;return e.extend({init:function(e,i){this.id=n++,this.pathElement=e,this.visibilityFix=!0,this.reset(),this.genericOverrides=[],this.invalidateBE=!1,this.matrixUpdate=!1,window.sealWebVisuObjects&&Object.seal(this)},reset:function(){this.fullMaterial=null,this.color=null,this.pickability=null,this.opacity=null,this.pgpInheritance=null,this.visibility=null,this.visibilityFree=null,this.clipping=null,this.renderStyle=null,this.position=null},copy:function(e){this.fullMaterial=e.fullMaterial,this.color=e.color,this.pickability=e.pickability,this.opacity=e.opacity,this.pgpInheritance=e.pgpInheritance,this.visibility=e.visibility,this.visibilityFree=e.visibilityFree,this.clipping=e.clipping,this.renderStyle=e.renderStyle,this.position=e.position},createOverrideLink:function(){return new r},addGenericOverride:function(e,i){var r,n,s=i.index,a=!1;for(s=0,n=i.index-1;n>=0&&!a;n--)if((r=this.genericOverrides[n])instanceof t||r._index<e._index)s=n+1,a=!0;else if(r===e)return;this.invalidateBE=this.invalidateBE||e.hasBoundingElementInfluence(),this.matrixUpdate=this.matrixUpdate||e.hasPositionOverride(),this.genericOverrides.splice(s,0,e),i.index++},removeGenericOverride:function(e){var i=this.genericOverrides.indexOf(e);if(i>-1){this.invalidateBE=this.invalidateBE||e.hasBoundingElementInfluence(),this.matrixUpdate=this.matrixUpdate||e.hasPositionOverride(),this.genericOverrides.splice(i,1);var r=i>0?this.genericOverrides[i-1]:null,n=this.genericOverrides[i];(!r||r instanceof t)&&n instanceof t&&this.genericOverrides.splice(i,1)}},initToken:function(e){var i,r,n=this.genericOverrides.indexOf(e);if(n<0){for(n=0,i=0;i<this.genericOverrides.length;i++)(r=this.genericOverrides[i])instanceof t&&r.rank<e.rank&&(n=i+1);this.genericOverrides.splice(n,0,e)}e.index=n},update:function(e,i,t){this.invalidateBE=this.invalidateBE||e,this.matrixUpdate=this.matrixUpdate||i;var r,n,s,a,o,h,l={};for(r=0;r<this.genericOverrides.length;r++)if((s=this.genericOverrides[r])._values)for(n in h=s._getDepth(t),s._values)(a=l[n])&&h!==(o=a._getDepth(t))&&s._depthPriority?l[n]=o<h?s._getForceInherit()?s:a:a._getForceInherit()?a:s:l[n]=s;var d=this;function c(e){l.hasOwnProperty(e)?d[e]=l[e]:d[e]=null}c("fullMaterial"),c("color"),c("opacity"),c("pgpInheritance"),c("pickability"),c("visibility"),c("visibilityFree"),c("clipping"),c("renderStyle"),c("position")},onDetach:function(e,i){var r,n,s=i.node;for(r=0;r<this.genericOverrides.length;r++)(n=this.genericOverrides[r])instanceof t||n._hasPropagation()&&!n._isNodeTargeted(s)||n._detach(e)},onAddChild:function(e){var i;for(i=0;i<this.genericOverrides.length;i++){var r=this.genericOverrides[i];r instanceof t||r._onAddChild(e)}},hasMaterialOverride:function(){return this.fullMaterial||this.color||null!==this.opacity},getSubstituteMatrix:function(){return this.position&&this.position._values.position},unsetInvalidateBE:function(){this.invalidateBE=!1},unsetMatrixUpdate:function(){this.matrixUpdate=!1},getInheritLevel:function(e){return this[e]?this[e]._inheritLevel[e]:0},hasForceInherit:function(e){return this[e]&&2===this[e]._inheritLevel[e]},hasClearInherit:function(e){return this[e]&&3===this[e]._inheritLevel[e]},hasWeakInherit:function(e){return this[e]&&4===this[e]._inheritLevel[e]},hasASMInherit:function(){return!(!this.color||!this.color._sceneGraphOverrideSet._hasASMInherit())}})}),define("SceneGraphOverrides/OverrideSet2",["DS/SceneGraphOverrides/OverrideSet2","DS/DSMigration/DSMigration"],function(e,i){return i.deprecateModule("SceneGraphOverrides/OverrideSet2"),e}),define("DS/SceneGraphOverrides/SceneGraphState",["UWA/Class","DS/Visualization/ThreeJS_DS","DS/SceneGraphOverrides/OverrideSet","DS/Visualization/Node3D","DS/Visualization/PathElement"],function(e,i,t,r,n){"use strict";var s=e.extend({init:function(e,i){this.sceneGraph=i,this.viewer=e,this.overrideSets={},this.active=!1},clone:function(){var e,i,t=new s(this.viewer,this.sceneGraph);for(e in this.overrideSets)i=this.overrideSets[e],t.overrideSets[e]=i?i.clone(this.sceneGraph):null;return t},mergeInto:function(e){var i,t,r;for(i in this.overrideSets)(t=this.overrideSets[i])&&((r=e.overrideSets[i])?t.mergeInto(r):e.overrideSets[i]=t.clone(e));e.active&&e.onActivation(e.viewer.getRootNode())},applyOpacityToPath:function(e,i,t){var r,n,s=o(e,this.sceneGraph),a=s.length>0;for(r=0;r<s.length;r++)n=s[r],a=l.call(this,n,i,t)&&a;return a},getAppliedOpacity:function(e){var i=o(e,this.sceneGraph),t=null;if(1===i.length){var r=i[0]._getUniqueOccurrence(this.viewer),n=a.call(this,r,!1,e);n&&(t=n.getOpacity())}return t},applyMaterialToPath:function(e,i,t,r){e.internalPath.length;var n,s,a=o(e,this.sceneGraph),l=a.length>0;for(n=0;n<a.length;n++)s=a[n],l=h.call(this,s,i,t,null)&&l;return l},getAppliedMaterial:function(e){var i=o(e,this.sceneGraph),t=null;if(1===i.length){var r=i[0]._getUniqueOccurrence(this.viewer),n=a.call(this,r,!1,e);n&&(t=n.getMaterial())}return t},applyPositionToPath:function(e,i){var t,r,n=o(e,this.sceneGraph),s=n.length>0;for(t=0;t<n.length;t++)r=n[t],s=d.call(this,r,i)&&s;return s},applyAbsolutePositionToPath:function(e,i,t){var r,n,s=o(e,this.sceneGraph),a=s.length>0;for(r=0;r<s.length;r++)n=s[r],a=c.call(this,n,i,t)&&a;return a},getAppliedPosition:function(e){var i=o(e,this.sceneGraph),t=null;if(1===i.length){var r=i[0]._getUniqueOccurrence(this.viewer),n=a.call(this,r,!1,e);n&&(t=n.getPosition())}return t},applyVisibilityToPath:function(e,i,t){var r,n,s=o(e,this.sceneGraph),a=s.length>0;for(r=0;r<s.length;r++)n=s[r],a=v.call(this,n,i,t)&&a;return a},getAppliedVisibility:function(e){var i=o(e,this.sceneGraph),t=null;if(1===i.length){var r=i[0]._getUniqueOccurrence(this.viewer),n=a.call(this,r,!1,e);n&&(t=(t=n.getVisibility())?t.visibility:null)}return t},applyColorToPath:function(e,i,t){var r,n,s=o(e,this.sceneGraph),a=s.length>0;for(r=0;r<s.length;r++)n=s[r],a=u.call(this,n,i,t)&&a;return a},getAppliedColor:function(e){var i=o(e,this.sceneGraph),t=null;if(1===i.length){var r=i[0]._getUniqueOccurrence(this.viewer),n=a.call(this,r,!1,e);n&&(t=n.getColor())}return t},applyPickabilityToPath:function(e,i,t){var r,n,s=o(e,this.sceneGraph),a=s.length>0;for(r=0;r<s.length;r++)n=s[r],a=p.call(this,n,i,t)&&a;return a},getAppliedProperties:function(e){var i=o(e,this.sceneGraph),t=null;if(1===i.length){var r=i[0]._getUniqueOccurrence(this.viewer),n=a.call(this,r,!1,e);t=n?n.getAppliedProperties():[]}return t},getAllModifications:function(){var e,i,r=[];for(e in this.overrideSets)(i=this.overrideSets[e])instanceof t&&r.push({pathElement:i.pathElement,properties:this.getAppliedProperties(i.pathElement)});return r},computeInheritedVisibility:function(e){return this.computeInheritedProperty(e,"visibility")},computeInheritedColor:function(e){return this.computeInheritedProperty(e,"color")},computeInheritedMaterial:function(e){return this.computeInheritedProperty(e,"material")},computeInheritedOpacity:function(e){return this.computeInheritedProperty(e,"opacity")},computeInheritedPickability:function(e){return this.computeInheritedProperty(e,"pickability")},getCurrentVisibility:function(e){var i=this.computeInheritedProperty(e,"visibility");if(null===i){var t=e._getUniqueOccurrence(this.viewer);t&&(i=t._getVisible())}return i},computeInheritedProperty:function(e,i){var t=o(e,this.sceneGraph);if(1===t.length){t[0];for(var r=[];e;){var n=e._getUniqueOccurrence(this.viewer),s=a.call(this,n,!1,e);s&&(r=s.getAppliedProperties(i).concat(r)),e=e.getParentPath()}var h,l=null;for(h=0;h<r.length;h++)l&&"FORCE_INHERIT"!==r[h].inheritance||(l=r[h]);return l?l[i]:null}return null},toJSON:function(){var e,i,r={};for(e in this.overrideSets)if((i=this.overrideSets[e])instanceof t){r[e]={};var n=r[e];n.pathElement=i.pathElement.toJSON(this.sceneGraph),n.properties=[];for(var s=n.properties,a=this.getAppliedProperties(i.pathElement),o=0;o<a.length;o++){var h=a[o];switch(s[o]={type:h.type,inheritance:h.inheritance},h.type){case"material":s[o].material=h.material.name;break;case"matrix":s[o].matrix=[],h.matrix.flattenToArray(s[o].matrix)}}}return r},setFromJSON:function(e,t,r){var s,a,o,h,l=null,d={},c=function(e,i){l||(l=new e),l.buildFromFile(i,function(e){e.force=!0,d[i].state="loaded",d[i].material=e;for(var t=0;t<d[i].paths.length;t++)v.applyMaterialToPath(d[i].paths[t],e,d[i].inheritances[t])})},v=this,u=t||this.sceneGraph.userRoot;for(s in e){a=e[s],(o=new n).setFromJSON(a.pathElement,u);for(var p=0;p<a.properties.length;p++){var f=a.properties[p];switch(f.type){case"material":if(r){this.applyMaterialToPath(o,r[f.material],f.inheritance);break}var O=d[f.material];if(O){if("loading"===O.state){console.log("need to apply a material that is loading"),O.paths.push(o),O.inheritances.push(f.inheritance);break}this.applyMaterialToPath(o,O,f.inheritance)}else d[f.material]={state:"loading",paths:[o],inheritances:[f.inheritance],material:null},require(["ShaderComposer/ShaderComposer"],function(e){return function(i){return c(i,e)}}(f.material));break;case"matrix":h=(new i.Matrix4).setFromArray(f.matrix),this.applyAbsolutePositionToPath(o,h)}}}},onActivation:function(e){var i=e._occurrences,t=0,r=this;for(t=0;t<i.length;t++)i[t].traverse(function(e,i){var t=i+(e.node.getNotAllowedInPathElement()?"":e.node.id+"/"),n=r.overrideSets[t+"/"];return n&&(e.originalOverrideSet=n),t},""),i[t].requestOverridesUpdate();this.active=!0},onDeactivation:function(e){var i=e._occurrences,t=0;for(t=0;t<i.length;t++)i[t].traverse(function(e){e.originalOverrideSet=null,e.overrideLink&&(e.overrideLink.reset(),e._invalidateBoundingElements(!1),e.updateVisibilityFlag())});this.active=!1},getGlobalAppliedVisibility:function(){return this.computeInheritedVisibility.apply(this,arguments)},getGlobalAppliedColor:function(){return this.computeInheritedColor.apply(this,arguments)},getGlobalAppliedMaterial:function(e){return this.computeInheritedMaterial.apply(this,arguments)},getGlobalAppliedOpacity:function(e){return this.computeInheritedOpacity.apply(this,arguments)},getGlobalAppliedPickability:function(e){return this.computeInheritedPickability.apply(this,arguments)}});function a(e,i,r){return e?(this.active?n=e.originalOverrideSet:(s=r.getKey(),n=this.overrideSets[s]),i&&!n&&(n=new t(r),this.active&&(e.originalOverrideSet=n),s||(s=r.getKey()),this.overrideSets[s]=n),n):null;var n,s}function o(e,i){if(i&&e.externalPath[0]===i)return[e];var t,r,s=[],a=[];for(function e(t,r){var n;if(t[0]===i||0===t[0].parents.length)r.push(t);else for(n=0;n<t[0].parents.length;n++)e([t[0].parents[n]].concat(t),r)}((r=e.externalPath.indexOf(i))>0?e.externalPath.slice(r):e.externalPath,s),t=0;t<s.length;t++){var o=new n;for(r=0;r<s[t].length;r++)s[t][r].getNotAllowedInPathElement()||o.addElement(s[t][r]);for(r=0;r<o.internalPath.length;r++)o.addElement(o.internalPath[r]);a.push(o)}return a}function h(e,i,t,r){var n=e._getUniqueOccurrence(this.viewer);if(!n)return!1;var s=a.call(this,n,!0,e);return r?s.setInternalMaterial(i,r):s.changeMaterial(i,t),this.active&&(n.requestOverridesUpdate(),f(n)),!0}function l(e,i,t){var r=e._getUniqueOccurrence(this.viewer);return!!r&&(a.call(this,r,!0,e).changeOpacity(i,t),this.active&&(r.requestOverridesUpdate(),f(r)),!0)}function d(e,i){var t=e._getUniqueOccurrence(this.viewer);return!!t&&(a.call(this,t,!0,e).changePosition(i),this.active&&t.requestOverridesUpdate(),!0)}function c(e,t,n){var s=e.getLastElement();if(null===s)return!1;if(!(s instanceof r))return!1;var o=e._getUniqueOccurrence(this.viewer),h=a.call(this,o,!0,e);if(t){var l=t.clone();n&&l.multiplyMatrices(n,l);var d=e.getParentPath(),c=d?d.getWorldMatrix(this.viewer):new i.Matrix4,v=new i.Matrix4;v.getInverse(c),l.multiplyMatrices(v,l),h.changePosition(l)}else h.changePosition(null);return this.active&&function(e){var i,t=e._getOccurrences();for(i=0;i<t.length;i++)t[i].requestOverridesUpdate()}(e),!0}function v(e,i,t){var r=e._getUniqueOccurrence(this.viewer);return!!r&&(a.call(this,r,!0,e).changeVisibility(i,t),this.active&&r.requestOverridesUpdate(),!0)}function u(e,i,t){var r=e._getUniqueOccurrence(this.viewer);return!!r&&(a.call(this,r,!0,e).changeColor(i,t),this.active&&(r.requestOverridesUpdate(),f(r)),!0)}function p(e,i,t){var r=e._getUniqueOccurrence(this.viewer);return!!r&&(a.call(this,r,!0,e).changePickability(i,t),this.active&&r.requestOverridesUpdate(),!0)}function f(e){var i=e.originalOverrideSet;if(i&&!i.hasMaterialOverride())for(var t=e.parent,r=!1;t&&!r;)(i=t.originalOverrideSet)&&i.hasMaterialOverride()&&(t.requestOverridesUpdate(),r=!0),t=t.parent}return s}),define("SceneGraphOverrides/SceneGraphState",["DS/SceneGraphOverrides/SceneGraphState","DS/DSMigration/DSMigration"],function(e,i){return i.deprecateModule("SceneGraphOverrides/SceneGraphState"),e}),define("DS/SceneGraphOverrides/GenericOverride",["UWA/Class","DS/SceneGraphOverrides/OverrideSet2","DS/Visualization/PathElement","DS/Visualization/ThreeJS_DS","DS/SceneGraphOverrides/OverrideLink2"],function(e,i,t,r,n){"use strict";var s=1,a=e.extend({init:function(e,i,t,r,n,a,o,h,l,d){this.id=s++;var c=e?[]:null;for(u=0;e&&u<e.length;u++)c.push(e[u].clone());this._node=a||null,this._nodeId=h,this._pathes=c||null;var v=o?[]:null;for(u=0;o&&u<o.length;u++)v.push(o[u].clone());if(this._idPathes=v,this._sceneGraphOverrideSet=i,this._values={},this._inheritLevel={},this._index=t,this._occurrenceBuffer={},this._missingTargets=null,this._propagationMode=r,this._pgp=!!l,this._depthPriority=!(!l&&!d),this._enabled=!!n,this._forceInherit=!1,this._enabled){var u,p=i._getViewerEntries();for(u=0;u<p.length;u++)this._activate(p[u],!1)}},setColor:function(e,i){this._setAttribute("color",e,i?2:1)},setPGPNoColor:function(){this._setAttribute("color",n.NO_COLOR,4)},resetColor:function(){this._setAttribute("color",null,3)},setMaterial:function(e,i){this._setAttribute("fullMaterial",e,i?2:1)},resetMaterial:function(){this._setAttribute("fullMaterial",null,3)},setOpacity:function(e,i){this._setAttribute("opacity",e,i?2:1)},setPGPNoOpacity:function(){this._setAttribute("opacity",n.NO_OPACITY,4)},resetOpacity:function(){this._setAttribute("opacity",null,3)},setPGPInheritance:function(e,i){if(!this._pgp)throw new Error("not a pgp override");this._setAttribute("pgpInheritance",e)},setPickability:function(e,i){if(null===e)this._setAttribute("pickability",e,null);else{var t=null;i&&(t=this._values.pickability||{faces:null,edges:null,points:null,_override:!0},"string"==typeof i&&(t.faces=i,t.edges=i,t.points=i),(i.faces||null===i.faces)&&(t.faces=i.faces),(i.edges||null===i.edges)&&(t.edges=i.edges),(i.points||null===i.points)&&(t.points=i.points)),this._setAttribute("pickability",{pickability:e,pickingPriorityID:t},null)}},setPosition:function(e){if(this._idPathes){var i=this.getPosition();(!i&&e||i&&!e)&&(e?this._sceneGraphOverrideSet._onAddPositionIdPathOverride(this):this._sceneGraphOverrideSet._onRemovePositionIdPathOverride(this))}this._setAttribute("position",e,null)},setVisibility:function(e){var i=null!=e?{visibility:e}:null;this._setAttribute("visibility",i,null)},setVisibilityFree:function(e){var i=null!=e?{visibilityFree:e}:null;this._setAttribute("visibilityFree",i,null)},setClippingContext:function(e){var i=e?e.clone():null;this._getClipping_internal();this._setAttribute("clipping",i,null)},setRenderMode:function(e){},setRenderStyle:function(e,i){e&&e._lock(),this._setAttribute("renderStyle",e,i?2:1)},getPosition:function(){return this._values.hasOwnProperty("position")?this._values.position:null},getVisibility:function(){return this._values.hasOwnProperty("visibility")?this._values.visibility.visibility:null},getVisibilityFree:function(){return this._values.hasOwnProperty("visibilityFree")?this._values.visibilityFree.visibilityFree:null},getColor:function(){return this._values.hasOwnProperty("color")?this._values.color:null},getMaterial:function(){return this._values.hasOwnProperty("fullMaterial")?this._values.fullMaterial:null},getOpacity:function(){return this._values.hasOwnProperty("opacity")?this._values.opacity:null},getPGPInheritance:function(){return this._values.hasOwnProperty("pgpInheritance")?this._values.pgpInheritance:null},getPickability:function(){if(this._values.hasOwnProperty("pickability")){var e=this._values.pickability;return e?e.pickability:null}return null},getPickingPriorityID:function(){if(this._values.hasOwnProperty("pickability")){var e=this._values.pickability;return e?e.pickingPriorityID:null}return null},getRenderMode:function(){var e=null;return this._values.hasOwnProperty("renderMode")&&(e=this._values.renderMode),e&&e.clone()},getRenderStyle:function(){var e=null;return this._values.hasOwnProperty("renderStyle")&&(e=this._values.renderStyle),e},getClippingContext:function(){var e=this._getClipping_internal();return e?e.clone():null},hasBoundingElementInfluence:function(){return this._values.hasOwnProperty("position")||this._values.hasOwnProperty("visibility")||this._values.hasOwnProperty("visibilityFree")},hasPositionOverride:function(){return this._values.hasOwnProperty("position")},getPathes:function(){return this._pathes?this._pathes.concat([]):null},getIdPathes:function(){return this._idPathes?this._idPathes.concat([]):null},isTargetingNode:function(e){var i,t,r;if(this._pathes){for(i=0;i<this._pathes.length;i++)for(r=this._pathes[i],t=0;t<r.externalPath.length;t++)if(r.externalPath[t]===e)return!0}else if(this._node===e)return!0;return!1},enable:function(e){var i=!!e;if(i!==this._enabled){var t;this._enabled=i;var r=this._sceneGraphOverrideSet._getViewerEntries();if(this._enabled)for(t=0;t<r.length;t++)this._activate(r[t],!1);else for(t=0;t<r.length;t++)this._deactivate(r[t])}},isEnabled:function(e){return this._enabled},getSceneGraphOverrideSet:function(){return this._sceneGraphOverrideSet},isIdPathOverride:function(e){return!!this._idPathes},isNodeIdOverride:function(){return!!this._nodeId},getValues:function(){var e,i,t={};for(e in this._values)i=this._values[e],"pickability"===e&&i?(t.pickability=i.pickability,i.pickingPriorityID&&(t.pickingPriorityID=i.pickingPriorityID)):t[e]=i;return t},_setForceInherit:function(e){this._forceInherit=!!e},_getForceInherit:function(){return this._forceInherit},_forceOverrideUpdate:function(){this._update(!0,!0)},_hasAttribute:function(e){return this._values.hasOwnProperty(e)},_getValue:function(e){return this._values[e]},_setAttribute:function(e,i,t){var n=this._values[e];void 0===n&&(n=null);var s=!1;null!=i?(null===n&&(s=!0),"position"===e?(this._values[e]||(this._values[e]=new r.Matrix4),this._values[e].copy(i)):this._values[e]=i,t!==this._inheritLevel[e]&&(this._inheritLevel[e]=t,s=!0)):(null===n&&t===this._inheritLevel[e]||(s=!0),3!==t?(delete this._values[e],delete this._inheritLevel[e]):(this._values[e]=null,this._inheritLevel[e]=t));var a=this._isBEChangingAttribute(e),o="position"===e;(s=s||a||"pickability"===e||"clipping"===e||"renderStyle"===e||"pgpInheritance"===e)?this._update(a,o):this._clearGSSOCache()},_isBEChangingAttribute:function(e){return"position"===e||"visibility"===e||"visibilityFree"===e},_removeAttribute:function(e){delete this._values[e],delete this._inheritLevel[e];var i=this._isBEChangingAttribute(e);this._update(i,"position"===e)},_getToken:function(){return this._sceneGraphOverrideSet._token},_clone:function(e){var i,t=new a(this._pathes,e,this._index,this._propagationMode,this._enabled,this._node,this._idPathes,this._nodeId,this._pgp);for(i in this._values)t._values[i]=this._values[i];for(i in this._inheritLevel)t._inheritLevel[i]=this._inheritLevel[i];return t},_detach:function(e){if(this._idPathes||this._nodeId){var i,t,r=this._sceneGraphOverrideSet._getViewerEntries();for(i=0;i<r.length;i++)t=r[i],this._deactivate(t),t.idPathOverrideWatcher&&t.idPathOverrideWatcher.onOverrideDetach(this);this._pathes=null}else this._resetOccurrenceBuffer(e),this._addMissingTarget(e)},_addMissingTarget:function(e,i){this._missingTargets||(this._missingTargets=[]),this._missingTargets.indexOf(e)<0&&(this._missingTargets.push(e),i||(i=this._sceneGraphOverrideSet._getViewerEntryFromViewer(e)),i&&i.missingTargetOverrides.push(this))},_onAddChild:function(e){this._propagationMode>0&&(this._resetOccurrenceBuffer(e),this._addMissingTarget(e))},_resetOccurrenceBuffer:function(e){var i;if(e)delete this._occurrenceBuffer[e.id];else for(i in this._occurrenceBuffer)delete this._occurrenceBuffer[i]},_getOccurrences:function(e){var i,t=e.viewer,r=t&&t.internalSceneGraph.root3js;if(this._node){var n,s,o,h;if(this._propagationMode===a.PropagationMode._applyToChildren)for(n=[],s=0;s<this._node._occurrences.length;s++)for(h=this._node._occurrences[s].children,o=0;o<h.length;o++)n.push(h[o]);else n=this._node._occurrences;i=n.filter(function(e){return e.scene3js===r})}else this._nodeId||(i=t&&this._occurrenceBuffer[t.id])||(i=this._buildOccurrenceList(e),t&&(!this._missingTargets||this._missingTargets.indexOf(t)<0)&&(this._occurrenceBuffer[t.id]=i));return i},_buildOccurrenceList:function(e){if(!this._pathes||0===this._pathes.length)return null;var i,r,n,s,o,h,l,d=e.viewer,c=[],v=e.prefixPathes?e.prefixPathes:[new t],u=!1,p=this._sceneGraphOverrideSet.rootNode;for(i=0;i<this._pathes.length;i++)for(r=this._pathes[i],s=0;s<v.length;s++)(h=v[s].externalPath.concat([])).length>0&&h.splice(h.length-1,1),l=!0,e.substractivePath?r.isAParentOf(e.substractivePath)?l=!0:(n=new t).substractPath(e.substractivePath,this._pathes[i])?(h=h.concat(n.externalPath),l=!0):l=!1:(l=!0,h=h.concat(r.externalPath)),l&&(h.length>0?((n=new t).setFromArray(h),n.checkExternalPath()?o=n._getOccurrences(d):u=!0):o=e.viewer.getRootNode()._occurrences,c=o?c.concat(o):c);if(this._propagationMode>0)switch(this._propagationMode){case a.PropagationMode.propagateToDirectChildren:c=function(e){var i,t,r,n=[];for(i=0;i<e.length;i++)for(t=e[i].children,n.push(e[i]),r=0;r<t.length;r++)n.push(t[r]);return n}(c);break;case a.PropagationMode.propagateToChildren:c=function(e){var i,t=[];for(i=0;i<e.length;i++)e[i].traverse(function(e){t.push(e)});return t}(c);break;case a.PropagationMode.propagateUntilRepRefs:c=function(e,i){var t,r=[];for(t=0;t<e.length;t++)e[t].traverseWithCondition(function(e){return r.push(e),!i.isNodeRepRef(e.node)});return r}(c,e.viewer.idPathMatcher);break;case a.PropagationMode.propagateToParents:c=function(e,i){var t,r,n,s=[];for(t=0;t<e.length;t++){r=e[t],n=!1;do{r?(s.push(r),r.node===i&&(n=!0),r=r.parent):n=!0}while(!n)}return s}(c,p)}return c=function(e){var i,t,r;if(e.length>1){for(i=[],t=0;t<e.length;t++)(r=e[t])&&!r.__rdo_visited&&(i.push(r),r.__rdo_visited=1);for(t=0;t<i.length;t++)i[t].__rdo_visited=0}else i=e;return i}(c),d&&(u?this._addMissingTarget(d,e):this._missingTargets&&(i=this._missingTargets.indexOf(d))>=0&&(this._missingTargets.splice(i,1),0===this._missingTargets.length&&(this._missingTargets=null),(s=e.missingTargetOverrides.indexOf(this))>=0&&e.missingTargetOverrides.splice(s,1))),c},_createOverrideSet:function(e,t){e.node._setOverrideExistsTraverse(),e.originalOverrideSet||(e.originalOverrideSet=new i(null,!0)),e.originalOverrideSet.initToken(t),e.originalOverrideSet.addGenericOverride(this,t)},_activate:function(e,i){if((this._idPathes&&!this._pathes||this._nodeId&&!this._node)&&(e.idPathOverrideWatcher&&!i&&e.idPathOverrideWatcher.addIdPathOverride(this),this.hasPositionOverride()&&null!==this._idPathes&&e.viewer)){var t=e.viewer._getOOCManager();null!==t&&t._updateOccurrences(this._idPathes)}var r,n,s=this._getOccurrences(e);if(s)for(n=0;n<s.length;n++)r=s[n],this._createOverrideSet(r,e.token),r.originalOverrideSet.update(this.hasBoundingElementInfluence(),this.hasPositionOverride(),r),r.requestOverridesUpdate()},_removeFromIdPathWatcher:function(e){(this._idPathes||this._nodeId)&&(e&&e.removeIdPathOverride(this),this._pathes=null)},_deactivate:function(e){var i=this._getOccurrences(e);if(i){var t,r;for(r=0;r<i.length;r++)(t=i[r]).originalOverrideSet&&(t.originalOverrideSet.removeGenericOverride(this),t.originalOverrideSet.update(this.hasBoundingElementInfluence(),this.hasPositionOverride(),t)),t.requestOverridesUpdate();this._resetOccurrenceBuffer(e.viewer),this._missingTargets&&(r=this._missingTargets.indexOf(e.viewer))>=0&&(this._missingTargets.splice(r,1),0===this._missingTargets.length&&(this._missingTargets=null)),e.missingTargetOverrides&&(r=e.missingTargetOverrides.indexOf(this))>=0&&e.missingTargetOverrides.splice(r,1)}},_update:function(e,i){if(this._enabled){var t,r=this._sceneGraphOverrideSet._viewers;for(t=0;t<r.length;t++)this._updateInViewer(r[t],e,i)}},_clearGSSOCache:function(){if(this._enabled){var e,i,t,r,n,s,a=this._sceneGraphOverrideSet._viewers;for(e=0;e<a.length;e++)if(i=a[e],t=this._getOccurrences(i))for(r=0;r<t.length;r++)for(n=t[r]._getRenderableOccurrences(),s=0;s<n.length;s++)n[s]._flagAsGSSOInvalidated()}},_updateInViewer:function(e,i,t){if(this._enabled){if(t&&null!==this._idPathes){var r=e.viewer._getOOCManager();null!==r&&r._updateOccurrences(this._idPathes)}var n,s,a;if(n=this._getOccurrences(e))for(s=0;s<n.length;s++)a=n[s],this._createOverrideSet(a,e.token),a.originalOverrideSet.update(i,t,a),a.requestOverridesUpdate()}},_getClipping_internal:function(){return this._values.hasOwnProperty("clipping")?this._values.clipping:null},_tryIdPathActivate:function(e,i){if(this._idPathes){if(!this._sceneGraphOverrideSet.rootNode)return!1;var t,r,n=[];for(t=0;t<this._idPathes.length;t++){if(!(r=this._idPathes[t].buildPathElement(e)))return!1;n.push(r)}for(this._pathes=n,t=0;t<i.length;t++)this._activate(i[t],!1);return!0}if(this._nodeId){var s=e.idToNode(this._nodeId);if(!s)return!1;for(this._node=s,t=0;t<i.length;t++)this._activate(i[t],!1);return!0}return!1},_isNodeIdAndActive:function(){if(this._nodeId){var e=idPathMatcher.idToNode(this._nodeId);if(!e)return!1;var i,t=this._sceneGraphOverrideSet._getViewerEntries();for(i=0;i<t.length;i++)if(vewerEntry=t,e._hasOccurrenceInViewer((void 0).viewer))return!0}return!1},_getIdPathes:function(){return this._idPathes},_isNodeTargeted:function(e){if(!this._pathes)return!0;var i;for(i=0;i<this._pathes.length;i++)if(this._pathes[i].getLastElement(!0)===e)return!0;return!1},_hasPropagation:function(){return this._propagationMode!==a.PropagationMode.none},_getDepth:function(e){if(this._node&&this._node!==this._sceneGraphOverrideSet.rootNode){var i=this._node;if(1===i._occurrences.length)return i._occurrences[0].depth;for(var t=e;t&&t.node!==i;)t=t.parent;return t?t.depth:0}return this._sceneGraphOverrideSet._getDepth(e)},_getForceShowMode:function(){return this._sceneGraphOverrideSet._isForceShowMode()},_setMaterialWeak:function(e){this._setAttribute("fullMaterial",e,4)},_setRenderStyleWeak:function(e){this._setAttribute("renderStyle",e,4)}});return a.PropagationMode={none:0,propagateToDirectChildren:1,propagateToChildren:2,propagateUntilRepRefs:3,propagateToParents:4,_applyToChildren:5},a.NO_COLOR=n.NO_COLOR,a.NO_OPACITY=n.NO_OPACITY,a}),define("DS/SceneGraphOverrides/SceneGraphOverrideSet",["UWA/Class","DS/SceneGraphOverrides/GenericOverride","DS/SceneGraphOverrides/OverrideSet","DS/SceneGraphOverrides/SceneGraphOverrideSetToken","DS/Visualization/PathElement","DS/Visualization/OccurrenceInterface","DS/Visualization/Node3D","DS/Visualization/IdPath"],function(e,i,t,r,n,s,a,o){"use strict";var h=1,l=e.extend({init:function(e,i,t,r,n,s){s=s||{},this.id=h++,this.name=void 0!==n?n:"",this.rootNode=e,this.rootId=i||null,this._enabled=!0,this._overrides=[],this._viewers=[],this._pathElementToOverridesMap=null,this._idPathToOverridesMap=null,this._nodeIdToOverridesMap=null,this._rootIdOverrideSet=!(!i||this.rootNode),this._allowNodeOverrides=t&&!this._rootIdOverrideSet,this._idToIdPathPositionOverrideMap=new Map,this._idPathPositionOverridesMap=new Map,this._mode=s.mode||l.normal,this.nodesOnly=!!s.nodesOnly,this._activating=!1,this._deactivating=!1,this._asmInherit=void 0===s.asmInherit||s.asmInherit,this._materialModeSensitive=!!s.materialModeSensitive},createOverride:function(e){if(!this.rootNode||!e||this._rootIdOverrideSet||this.nodesOnly)return null;(e instanceof Array||e instanceof n||e instanceof s)&&(e={pathes:e});var t,r,a=e.pathes;if(a instanceof Array||(a=[a]),0===a.length)return null;for(r=0;r<a.length;r++){if(a[r]instanceof s){if(!(t=a[r].buildPathElement(this.rootNode)))return console.warn("ERROR - provided OccurrenceInterface is not under the rootNode of the SceneGraphOverrideSet"),null;a[r]=t}if(a[r].getElement(0)!==this.rootNode)return console.warn("ERROR - SceneGraphOverrideSet.createOverride: first PathElement node is not equal to this.rootNode"),null;if(!a[r].checkExternalPath())return console.warn("ERROR - SceneGraphOverrideSet.createOverride: invalid path provided"),null}var o=e.propagateToDirectChildren?i.PropagationMode.propagateToDirectChildren:i.PropagationMode.none;e.propagateUntilRepRefs&&(o=i.PropagationMode.propagateUntilRepRefs),e.propagateToChildren&&(o=i.PropagationMode.propagateToChildren),e.propagateToParents&&(o=i.PropagationMode.propagateToParents);var h=!e.hasOwnProperty("enabled")||e.enabled,l=new i(a,this,this._overrides.length,o,h&&this._enabled,null,void 0,void 0,e.pgp,e.depthPriority);return this._overrides.push(l),this._pathElementToOverridesMap&&this._addOverrideToMap(l,this._pathElementToOverridesMap),l},createIdPathOverride:function(e){if(/*!this.rootNode || */!this.rootId||this.nodesOnly)return null;(e instanceof Array||e instanceof o||e instanceof s)&&(e={idPathes:e});var t,r=e.idPathes;if(r instanceof Array||(r=[r]),0===r.length)return null;for(t=0;t<r.length;t++)if(r[t].getElement(0)!==this.rootId)return console.warn("ERROR - SceneGraphOverrideSet.createIdPathOverride: first id is not equal to this.rootId"),null;var n=!e.hasOwnProperty("enabled")||e.enabled,a=e.propagateToDirectChildren?i.PropagationMode.propagateToDirectChildren:i.PropagationMode.none;e.propagateUntilRepRefs&&(a=i.PropagationMode.propagateUntilRepRefs),e.propagateToChildren&&(a=i.PropagationMode.propagateToChildren),e.propagateToParents&&(a=i.PropagationMode.propagateToParents);var h=new i(null,this,this._overrides.length,a,n,void 0,r,void 0,e.pgp,e.depthPriority);return h._enabled=this._enabled,this._overrides.push(h),this._idPathToOverridesMap&&this._addIdPathOverrideToMap(h,this._idPathToOverridesMap),h},createNodeIdOverride:function(e,t,r,n){if(!this._allowNodeOverrides)return null;var s=t?i.PropagationMode._applyToChildren:i.PropagationMode.none,a=new i(null,this,this._overrides.length,s,!0,void 0,void 0,e,r,n);return this._overrides.push(a),this._nodeIdToOverridesMap&&this._addNodeIdOverrideToMap(a,this._nodeIdToOverridesMap),a},getOverrides:function(){return[].concat(this._overrides)},deleteOverrides:function(e){var i;for(i=0;i<e.length;i++)this.deleteOverride(e[i])},deleteOverride:function(e){var i,t=this._overrides.indexOf(e);if(t>=0){for(i=0;i<this._viewers.length;i++)e._deactivate(this._viewers[i]);for(this._overrides.splice(t,1),e.isIdPathOverride()?this._idPathToOverridesMap&&this._removeIdPathOverrideFromMap(e,this._idPathToOverridesMap):e.isNodeIdOverride()?this._nodeIdToOverridesMap&&this._removeNodeIdOverrideFromMap(e,this._nodeIdToOverridesMap):this._pathElementToOverridesMap&&this._removeOverrideFromMap(e,this._pathElementToOverridesMap),e._idPathes&&e.getPosition()&&this._onRemovePositionIdPathOverride(e),i=0;i<this._viewers.length>0;i++)e._removeFromIdPathWatcher(this._viewers[i].idPathOverrideWatcher);return!0}return!1},clone:function(){var e,i=new l(this.rootNode);for(e=0;e<this._overrides.length;e++)i._overrides.push(this._overrides[e]._clone(i));return i},getOverridesFromPathElement:function(e){this._pathElementToOverridesMap||(this._pathElementToOverridesMap=this._buildPathElementToOverridesMap());var i=e.getKey();return this._pathElementToOverridesMap[i]||null},getUniqueOverrideFromPathElement:function(e){var i=this.getOverridesFromPathElement(e);return i&&1===i.length?i[0]:null},getOverridesFromIdPath:function(e){this._idPathToOverridesMap||(this._idPathToOverridesMap=this._buildIdPathToOverridesMap());var i=e.getKey();return this._idPathToOverridesMap[i]||null},getUniqueOverrideFromIdPath:function(e){var i=this.getOverridesFromIdPath(e);return i&&1===i.length?i[0]:null},getOverridesFromNodeId:function(e){return this._nodeIdToOverridesMap||(this._nodeIdToOverridesMap=this._buildNodeIdToOverridesMap()),this._nodeIdToOverridesMap[e]||null},getUniqueOverrideFromNodeId:function(e){var i=this.getOverridesFromNodeId(e);return i&&1===i.length?i[0]:null},getOverridesTargetingNode:function(e){var i,t,r=[];for(i=0;i<this._overrides.length;i++)(t=this._overrides[i]).isTargetingNode(e)&&r.push(t);return r},getAllowNodeOverrides:function(){return this._allowNodeOverrides},enable:function(e){var i;for(this._enabled=!!e,i=0;i<this._overrides.length;i++)this._overrides[i].enable(e)},_buildPathElementToOverridesMap:function(){var e,i,t={};for(e=0;e<this._overrides.length;e++)(i=this._overrides[e]).isIdPathOverride()||this._addOverrideToMap(i,t);return t},_buildIdPathToOverridesMap:function(){var e,i,t={};for(e=0;e<this._overrides.length;e++)(i=this._overrides[e]).isIdPathOverride()&&this._addIdPathOverrideToMap(i,t);return t},_buildNodeIdToOverridesMap:function(){var e,i,t={};for(e=0;e<this._overrides.length;e++)(i=this._overrides[e]).isNodeIdOverride()&&this._addNodeIdOverrideToMap(i,t);return t},_addOverrideToMap:function(e,i){var t,r,n;if(e._pathes)for(t=0;t<e._pathes.length;t++)(n=i[r=e._pathes[t].getKey()])||(n=[],i[r]=n),n.push(e)},_removeOverrideFromMap:function(e,i){var t,r,n,s;for(t=0;t<e._pathes.length;t++)(n=i[r=e._pathes[t].getKey()])&&(s=n.indexOf(e))>=0&&n.splice(s,1),n&&0!==n.length||delete i[r]},_addIdPathOverrideToMap:function(e,i){var t,r,n;for(t=0;t<e._idPathes.length;t++)(n=i[r=e._idPathes[t].getKey()])||(n=[],i[r]=n),n.push(e)},_removeIdPathOverrideFromMap:function(e,i){var t,r,n,s;for(t=0;t<e._idPathes.length;t++)(n=i[r=e._idPathes[t].getKey()])&&(s=n.indexOf(e))>=0&&n.splice(s,1),n&&0!==n.length||delete i[r]},_addNodeIdOverrideToMap:function(e,i){var t,r;(r=i[t=e._nodeId])||(r=[],i[t]=r),r.push(e)},_removeNodeIdOverrideFromMap:function(e,i){var t,r,n;(r=i[t=e._nodeId])&&(n=r.indexOf(e))>=0&&r.splice(n,1),r&&0!==r.length||delete i[t]},_activate:function(e,i,t,n,s,a){if(!this._activating){this._activating=!0;var o=!1;if(this._mode!==l.normal&&this.rootNode&&(this._mode===l.invert?(this.rootNode._setInvertMode(!0),o=!0):this._mode===l.invertPick&&(this.rootNode._setInvertPickMode(!0),o=!0)),this.rootId&&e){var h=e.getIdPathMatcher();if(!h||h.idToNode(this.rootId)!==this.rootNode)return console.warn("Enable to activate SceneGraphOverrideSet: bad rootId"),void(this._activating=!1)}var d,v=0,u=-1;for(v=0;v<this._viewers.length&&u<0;v++)this._viewers[v].viewer===e&&(u=v);for(u<0&&(e?(u=this._viewers.length,this._viewers.push(new c({viewer:e,prefixPathes:i,substractivePath:t,token:new r(this,n),missingTargetOverrides:[],idPathOverrideWatcher:s}))):(this._viewers.push(new c({viewer:null,token:new r(this,n),idPathOverrideWatcher:s})),u=this._viewers.length-1)),v=0;v<this._overrides.length;v++)(d=this._overrides[v]).isEnabled()&&d._activate(this._viewers[u],a);o&&this.rootNode._forceUpdate(),this._activating=!1}},_deactivate:function(e,i){if(!this._deactivating){this._deactivating=!0;var t=!1;this._mode!==l.normal&&this.rootNode&&(this._mode===l.invert?(this.rootNode._setInvertMode(!1),t=!0):this._mode===l.invertPick&&(this.rootNode._setInvertPickMode(!1),t=!0));var r=0,n=-1;for(r=0;r<this._viewers.length&&n<0;r++)this._viewers[r].viewer===e&&(n=r);if(n>=0){r=0;for(r=0;r<this._overrides.length;r++)this._overrides[r]._deactivate(this._viewers[n]),i||this._overrides[r]._removeFromIdPathWatcher(this._viewers[n].idPathOverrideWatcher);this._viewers.splice(n,1)}t&&this.rootNode._forceUpdate(),this._deactivating=!1}},_getViewerEntries:function(){return this._viewers},_getViewerEntryFromViewer:function(e){var i,t;for(i=0;i<this._viewers.length;i++)if((t=this._viewers[i]).viewer===e)return t;return null},_updateOverridesWithMissingTarget:function(e){var i,t,r=this._getViewerEntryFromViewer(e);if(r&&r.missingTargetOverrides.length>0)for(t=r.missingTargetOverrides.concat([]),i=0;i<t.length;i++)t[i]._updateInViewer(r,!0)},_onAddPositionIdPathOverride:function(e){var i,t,r=e._getIdPathes();for(i=0;i<r.length;i++)t=r[i],this._onAddPositionIdPathOverrideSingle(e,t)},_onRemovePositionIdPathOverride:function(e){var i,t,r=e._getIdPathes();for(i=0;i<r.length;i++)t=r[i],this._onRemovePositionIdPathOverrideSingle(e,t)},_registerPositionOverrideIdPath:function(e){var i=e.getLastId(),t=(e.getKey(),this._idToIdPathPositionOverrideMap.get(i));t||(t=new v(i),this._idToIdPathPositionOverrideMap.set(i,t)),t.useCount++},_unregisterPositionOverrideIdPath:function(e){var i=e.getLastId(),t=(e.getKey(),this._idToIdPathPositionOverrideMap.get(i));t&&(t.useCount--,0===t.useCount&&this._idToIdPathPositionOverrideMap.delete(i))},_onAddPositionIdPathOverrideSingle:function(e,i){var t=i.getKey(),r=this._idPathPositionOverridesMap.get(t);r||(r=[],this._idPathPositionOverridesMap.set(t,r)),r[e._index]=e,this._registerPositionOverrideIdPath(i)},_onRemovePositionIdPathOverrideSingle:function(e,i){var t=i.getKey(),r=this._idPathPositionOverridesMap.get(t);if(r){r[e._index]=null;for(var n=r.length-1;n>=0&&r[n];)n--;r.length=n,0===r.length&&this._idPathPositionOverridesMap.delete(t)}this._unregisterPositionOverrideIdPath(i)},_createNodeOverride:function(e){if(!this._allowNodeOverrides)return null;var t=new i(null,this,this._overrides.length,i.PropagationMode.none,this._enabled,e);return this._overrides.push(t),t},_hasIdPathOverride:function(e){var i=this._idToIdPathPositionOverrideMap.get(e);return!!(i&&i.useCount>0)},_getIdPathPositionOverride:function(e){var i,t=e.getKey(),r=this._idPathPositionOverridesMap.get(t),n=null;if(r)for(i=r.length-1;i>=0&&null===n;i--)r[i]&&(n=r[i]);return n},_exportIdPathOverrides:function(e,i){var t,r,n,s,a,o,h,l;for(t=0;t<this._overrides.length;t++)if((r=this._overrides[t]).isIdPathOverride()&&r._hasAttribute(i))for(a=r._idPathes,l=r._getValue(i),s=0;s<a.length;s++)h=new d(o=a[s],l),n=o.getKey(),e.set(n,h)},_removeFromIdPathWatcher:function(e){var i;for(i=0;i<this._overrides.length;i++)this._overrides[i]._removeFromIdPathWatcher(e)},_isCurrentlyActive:function(){return this._viewers.length>0},_getDepth:function(e){if(0===this._viewers.length||this._viewers[0].viewer)return 0;var i,t=this.rootNode;if(1===t._occurrences.length)i=t._occurrences[0].depth;else{for(var r=e;r&&r.node!==t;)r=r.parent;i=r?r.depth:0}return this.prefixPathes&&(i+=this.prefixPathes.externalPath.length-1),this.substractivePath&&(i-=this.substractivePath.externalPath.length-1),i},_isForceShowMode:function(){return this._mode===l.forceShow},_hasASMInherit:function(){return this._asmInherit}});function d(e,i){this.idPath=e,this.value=i}function c(e){this.viewer=e.viewer,this.prefixPathes=e.prefixPathes||null,this.substractivePath=e.substractivePath||null,this.token=e.token,this.missingTargetOverrides=e.missingTargetOverrides||null,this.idPathOverrideWatcher=e.idPathOverrideWatcher||null}function v(e){this.id=e,this.useCount=0}return l.normal="normal",l.forceShow="forceShow",l.invert="invert",l.invertPick="invertPick",l}),define("DS/SceneGraphOverrides/SceneGraphOverrideSetManager",["UWA/Class","DS/SceneGraphOverrides/SceneGraphOverrideSet","DS/SceneGraphOverrides/SceneGraphOverrideSetToken","DS/Visualization/PathElement","DS/SceneGraphOverrides/IdPathOverrideWatcherTree"],function(e,i,t,r,n){"use strict";return e.extend({init:function(e){this.viewer=e.viewer||null,this.node=e.node||null,this.nodeId=e.nodeId||null,this.active=void 0===e.active||e.active,this._sceneGraphOverrideSetArray=[],this._idPathOverrideWatcher=e.idPathOverrideWatcher||null,this._needFullOccurrencesUpdate=!1,this._refreshing=!1},pushSceneGraphOverrideSet:function(e,i){return this.insertSceneGraphOverrideSetAt(e,this._sceneGraphOverrideSetArray.length,i)},getSceneGraphOverrideSetAt:function(e){return this._sceneGraphOverrideSetArray[e].sceneGraphOverrideSet},getNumberOfSceneGraphOverrideSets:function(){return this._sceneGraphOverrideSetArray.length},getSceneGraphOverrideSetIndex:function(e){var i,t=-1;for(i=0;i<this._sceneGraphOverrideSetArray.length&&t<0;i++)this._sceneGraphOverrideSetArray[i].sceneGraphOverrideSet===e&&(t=i);return t},getSceneGraphOverrideSetByName:function(e){for(var i=0;i<this._sceneGraphOverrideSetArray.length;i++){var t=this._sceneGraphOverrideSetArray[i].sceneGraphOverrideSet;if(t&&t.name===e)return t}return null},getSceneGraphOverrideSetsByPrefix:function(e){for(var i=[],t=0;t<this._sceneGraphOverrideSetArray.length;t++){var r=this._sceneGraphOverrideSetArray[t].sceneGraphOverrideSet;r&&r.name.startsWith(e)&&i.push(r)}return i},removeSceneGraphOverrideSet:function(e){var i=this.getSceneGraphOverrideSetIndex(e);this.removeSceneGraphOverrideSetAt(i)},removeSceneGraphOverrideSetAt:function(e){if(e>-1&&e<this._sceneGraphOverrideSetArray.length){var i=this._sceneGraphOverrideSetArray.concat([]);i.splice(e,1),this._setSceneGraphOverrideSetArray(i)}},insertSceneGraphOverrideSetAt:function(e,t,r){if(!(e instanceof i))throw new Error("sceneGraphOverrideSet must be a SceneGraphOverrideSet");if(r=r||{},this._checkSceneGraphOverrideSetParameters(e,r)){if(!(this.getSceneGraphOverrideSetIndex(e)>=0)){var n=this._sceneGraphOverrideSetArray.concat([]);return n.splice(t,0,{sceneGraphOverrideSet:e,prefixPathes:r.prefixPathes,substractivePath:r.substractivePath}),this._setSceneGraphOverrideSetArray(n),!0}console.warn("SceneGraphOverrideSet already active")}else console.warn("SceneGraphOverrideSet not added because either prefixPathes or substractive path were missing/incorrect/provided.\nPlease check SceneGraphOverrideSetManager methods documentation");return!1},clear:function(){this._setSceneGraphOverrideSetArray([])},computeInheritedAttributes:function(e){if(!e)return null;this.viewer.getRootNode()._tryOverridesUpdate(this.viewer);var i=e._getUniqueOccurrence(this.viewer),t=null;return i&&(t=i.overrideLink?i.overrideLink.getAppliedPropertiesNEW():{}),t},computeInheritedOpacity:function(e){var i=this.computeInheritedAttributes(e),t=null;return i&&i.opacity&&(t=i.opacity.value),t},computeInheritedMaterial:function(e){var i=this.computeInheritedAttributes(e),t=null;return i&&i.material&&(t=i.material.value),t},computeInheritedColor:function(e){var i=this.computeInheritedAttributes(e),t=null;return i&&i.color&&(t=i.color.value),t},computeInheritedVisibility:function(e){var i=this.computeInheritedAttributes(e),t=null;return i&&i.visibility&&(t=i.visibility.value),t},computeInheritedVisibilityFree:function(e){var i=this.computeInheritedAttributes(e),t=null;return i&&i.visibilityFree&&(t=i.visibilityFree.value),t},computeInheritedPickability:function(e){var i=this.computeInheritedAttributes(e),t=null;return i&&i.pickability&&(t=i.pickability.value),t},computeAppliedPosition:function(e){var i=this.computeInheritedAttributes(e),t=null;return i&&i.position&&(t=i.position.value),t},getCurrentVisibility:function(e){if(!e)return null;var i;this.viewer.getRootNode()._tryOverridesUpdate(this.viewer);var t=e._getUniqueOccurrence(this.viewer);return t&&(i=t._getVisible()),i},getCurrentVisibilityFree:function(e){if(!e)return null;var i;this.viewer.getRootNode()._tryOverridesUpdate(this.viewer);var t=e._getUniqueOccurrence(this.viewer);return t&&(i=t._getVisibilityFree()),i},hasSceneGraphOverrideSet:function(){return this._sceneGraphOverrideSetArray.length>0},createSceneGraphOverrideSet:function(e){return new i((e=e||{}).rootNode||this.node,e.nodeId||e.rootId||this.nodeId,e.allowNodeOverrides,void 0,e.name,e)},exportIdPathOverrides:function(e){if("position"!==e&&"visibility"!==e)return null;var i=0,t=new Map;for(i=0;i<this._sceneGraphOverrideSetArray.length;i++)this._sceneGraphOverrideSetArray[i].sceneGraphOverrideSet._exportIdPathOverrides(t,e);var r=[];return t.forEach(function(i,t){var n;r.push({idPath:[].concat(i.idPath.ids),value:"position"===e?(n=i.value,[].concat(n.elements)):i.value})}),r},_requestFullOverridesUpdate:function(){this._needFullOccurrencesUpdate=!0},_getSceneGraphOverrideSetArray:function(){return this._sceneGraphOverrideSetArray.concat([])},_setSceneGraphOverrideSetArray:function(e){if(this.active){if(this.viewer){if(this.viewer._sceneGraphStateVersion&&2!==this.viewer._sceneGraphStateVersion)throw console.warn("Cannot use both v1 and v2 sceneGraphStates"),Error();this.viewer._sceneGraphStateVersion||(this.viewer._sceneGraphStateVersion=2)}e=e||[];var i,t,r=0,n=this._sceneGraphOverrideSetArray;for(r=0;r<this._sceneGraphOverrideSetArray.length;r++)(i=this._sceneGraphOverrideSetArray[r].sceneGraphOverrideSet)._deactivate(this.viewer,!1);for(this._sceneGraphOverrideSetIdToRank={},this._sceneGraphOverrideSetArray=e.concat([]),r=0;r<this._sceneGraphOverrideSetArray.length;r++)(i=(t=this._sceneGraphOverrideSetArray[r]).sceneGraphOverrideSet)._activate(this.viewer,t.prefixPathes,t.substractivePath,r,this._getIdPathOverrideWatcher());for(r=0;r<n.length;r++)(i=(t=n[r]).sceneGraphOverrideSet)._isCurrentlyActive()||i._removeFromIdPathWatcher(this._getIdPathOverrideWatcher())}else this._sceneGraphOverrideSetArray=e.concat([])},_activate:function(){if(!this.active){var e,i,t;for(e=0;e<this._sceneGraphOverrideSetArray.length;e++)(t=(i=this._sceneGraphOverrideSetArray[e]).sceneGraphOverrideSet).rootNode=this.node,t._activate(this.viewer,i.prefixPathes,i.substractivePath,e,this._getIdPathOverrideWatcher());this.active=!0}},_deactivate:function(){if(this.active){var e;for(e=0;e<this._sceneGraphOverrideSetArray.length;e++)this._sceneGraphOverrideSetArray[e].sceneGraphOverrideSet.rootNode=null;this.active=!1}},_refresh:function(){if(!this._refreshing){var e,i;for(this._refreshing=!0,e=0;e<this._sceneGraphOverrideSetArray.length;e++)(i=this._sceneGraphOverrideSetArray[e]).sceneGraphOverrideSet._deactivate(this.viewer,!0);for(e=0;e<this._sceneGraphOverrideSetArray.length;e++)this._sceneGraphOverrideSetArray[e].sceneGraphOverrideSet._activate(this.viewer,i.prefixPathes,i.substractivePath,e,this._getIdPathOverrideWatcher(),!0);this._refreshing=!1}},_checkSceneGraphOverrideSetParameters:function(e,i){var t;if(e.getAllowNodeOverrides()&&(i.prefixPathes||i.substractivePath)&&console.warn("prefixPathes and substractivePath are forbidden when allowNodeOverrides is true"),i.prefixPathes)for(t=0;t<i.prefixPathes.length;t++)if(!i.prefixPathes[t].checkExternalPath)return!1;if(i.substractivePath&&!i.substractivePath.checkExternalPath())return!1;if(this.node)return this.node===e.rootNode||(console.warn("SceneGraphOverrideSet root must be equal to SceneGraphOverrideSetManager root"),!1);if(!e.rootNode&&e.nodesOnly)return!0;if(this.viewer){var n=this.viewer.getRootNode();if(n.children.indexOf(e.rootNode)>=0)return!(i.prefixPathes&&0!==i.prefixPathes.length||i.substractivePath);var s,a,o=i.prefixPathes||[new r],h=i.substractivePath&&i.substractivePath.externalPath,l=e.rootNode;if(h){if(e.rootNode!==h[0])return!1;l=h[h.length-1]}for(t=0;t<o.length;t++)if(0===(s=o[t].externalPath).length){if(n.children.indexOf(l)<0)return!1}else if(a=s[s.length-1],n.children.indexOf(s[0])<0||a!==l)return!1}else if(this.nodeId!==e.rootId)return!1;return!0},_hasIdPathOverride:function(e){var i;for(i=0;i<this._sceneGraphOverrideSetArray.length;i++)if(this._sceneGraphOverrideSetArray[i].sceneGraphOverrideSet._hasIdPathOverride(e))return!0;return!1},_getIdPathPositionOverride:function(e){var i,t,r=null;for(i=0;i<this._sceneGraphOverrideSetArray.length;i++)null!==(t=this._sceneGraphOverrideSetArray[i].sceneGraphOverrideSet._getIdPathPositionOverride(e))&&(r=t);return r},_fullOccurrencesUpdate:function(){this._needFullOccurrencesUpdate&&this._sceneGraphOverrideSetArray.length>0&&(this._setSceneGraphOverrideSetArray(this._sceneGraphOverrideSetArray),this._needFullOccurrencesUpdate=!1)},_updateOverridesWithMissingTarget:function(){var e;for(e=0;e<this._sceneGraphOverrideSetArray.length;e++)this._sceneGraphOverrideSetArray[e].sceneGraphOverrideSet._updateOverridesWithMissingTarget(this.viewer)},_getIdPathOverrideWatcher:function(){return this._idPathOverrideWatcher||this.viewer&&this.viewer._getIdPathOverrideWatcher()},_removeNodeId:function(){var e,i,t=[];for(e=0;e<this._sceneGraphOverrideSetArray.length;e++)null!=(i=this._sceneGraphOverrideSetArray[e]).rootId&&t.push(i);this._setSceneGraphOverrideSetArray(t)},dispose:function(){2===this.viewer._sceneGraphStateVersion&&(this._setSceneGraphOverrideSetArray([]),this._idPathOverrideWatcher&&(this._idPathOverrideWatcher.dispose(),this._idPathOverrideWatcher=null))}})}),define("DS/SceneGraphOverrides/CSIOverrideManager",["DS/Visualization/ThreeJS_DS","DS/SceneGraphOverrides/SceneGraphOverrideSet","DS/VisuLoaders/ThreeDXLoader","DS/Visualization/MaterialApplication","DS/Visualization/RenderMode","DS/Visualization/RenderStyle","DS/Visualization/Node3D","DS/WebVisuParameters/GraphicPropertyParameterHelper"],function(e,i,t,r,n,s,a,o){"use strict";var h=function(e){this.viewer=e,this.repViewModeOverrides=new c(!0,"CSIRepViewMode",0),this.plmViewModeOverridesMap=new Map,this.viewpointPLMViewModeMap=new Map,this.nodeToPLMViewModeMap=new WeakMap,this.plmViewModeLoaded=!1,this.plmViewModeDataSets=[],this.plmCustomViewModeDataSet=null,this.currentPLMViewMode=null};function l(){this.plmViewModeData=[]}function d(){this.matApp=null,this.renderStyle=null}function c(e,i,t){this.name=i,this.enabled=e,this.overrideSet=null,this.overrideMap=null,this.index=t}return h.prototype.getRepViewModeOverrideSet=function(){return this.repViewModeOverrides.getOverrideSet(this)},h.prototype.getRepViewModeOverride=function(e){return this.repViewModeOverrides.getOverride(e,this)},h.prototype.deleteRepViewModeOverride=function(e){this.repViewModeOverrides.deleteOverride(e)},h.prototype.setRepViewMode=function(e){this.repViewModeOverrides.setEnabled(e)},h.prototype._getPLMViewModeOverrides=function(e){var i=this.plmViewModeOverridesMap.get(e);return i||(i=new c(!1,"PLMViewMode"+e,1),this.plmViewModeOverridesMap.set(e,i)),i},h.prototype.getPLMViewModeOverrideSet=function(e){return this._getPLMViewModeOverrides(e).getOverrideSet(this)},h.prototype.getPLMViewModeOverride=function(e,i){return this._getPLMViewModeOverrides(e).getOverride(i)},h.prototype.deletePLMViewModeOverride=function(e,i){this._getPLMViewModeOverrides(e).deleteOverride(i)},h.prototype.setPLMViewMode=function(e,i){this._getPLMViewModeOverrides(e).setEnabled(i)},h.prototype.setViewpointPLMViewMode=function(e,i){var t=-1;this.viewpointPLMViewModeMap.has(e)?t=this.viewpointPLMViewModeMap.get(e):this.viewpointPLMViewModeMap.set(e,-1),t!==i&&(i>=0?this.viewpointPLMViewModeMap.set(e,i):(this.setPLMViewMode(e,!1),this.viewpointPLMViewModeMap.set(e,i)))},h.prototype.refreshPLMViewMode=function(e){return this.currentPLMViewMode?this.updatePLMViewMode(this.currentPLMViewMode,e):Promise.resolve(!0)},h.prototype.updatePLMViewMode=function(e,i){this.currentPLMViewMode=e;var r,n,s=[],a=new t;if(this.plmViewModeLoaded=!1,e._PLMCustomRenderingStyle?(this.plmCustomViewModeDataSet=new l,s.push(this.plmCustomViewModeDataSet.load(a,e._PLMCustomRenderingStyle,i,this.viewer))):this.plmCustomViewModeDataSet=null,e._PLMRenderingStyles)for(r=0;r<e._PLMRenderingStyles.length;r++)n=new l,this.plmViewModeDataSets[r]=n,s.push(n.load(a,e._PLMRenderingStyles[r],i,this.viewer));return Promise.all(s).then(()=>(this.plmViewModeLoaded=!0,this.applyPLMViewModes(),!0))},h.prototype.applyPLMViewModes=function(e){this.plmViewModeLoaded&&this.viewpointPLMViewModeMap.forEach((e,i)=>{this.plmCustomViewModeDataSet?this.applyPLMViewMode(i,4):this.applyPLMViewMode(i,e)})},h.prototype.applyPLMViewMode=function(e,i){var t=this.plmViewModeOverridesMap.get(e);if(t&&t.resetOverrides(this),i>=0){var r=4===i?this.plmCustomViewModeDataSet:this.plmViewModeDataSets[i],n=(this.getPLMViewModeOverrideSet(e),this.getViewpointRoot(e));this.getPLMViewModeOverride(e,n)._setMaterialWeak(r.getMaterialApplication(0)),n.traverse(t=>{if(this.nodeToPLMViewModeMap.has(t)){var n=this.nodeToPLMViewModeMap.get(t),s=this.getPLMViewModeOverride(e,t);r.setupOverride(s,n[i])}}),this.setPLMViewMode(e,!0)}this.viewpointPLMViewModeMap.set(e,i)},h.prototype.getViewpointPLMViewModeDataSet=function(e){var i=this.viewpointPLMViewModeMap.get(e);return 4===i?this.plmCustomViewModeDataSet:i>=0?this.plmViewModeDataSets[i]:null},h.prototype.setNodePLMViewMode=function(e,i,t){var r,n=[];for(r=0;r<i._Styles.length;r++)n.push(i._Styles[r]);if(this.nodeToPLMViewModeMap.set(e,n),this.plmViewModeLoaded){var s=this.getViewpointPLMViewModeDataSet(t);if(s){var a=this.viewpointPLMViewModeMap.get(t),o=this.getPLMViewModeOverride(t,e);s.setupOverride(o,n[a])}}},h.prototype.getViewpointRoot=function(e){return this.viewer.getRootNode()},l.prototype.setupOverride=function(e,i){var t=this.plmViewModeData[i];0===i?(e._setMaterialWeak(t.matApp),t.renderStyle&&e._setRenderStyleWeak(t.renderStyle)):(e.setMaterial(t.matApp),t.renderStyle&&e.setRenderStyle(t.renderStyle))},l.prototype.getMaterialApplication=function(e){return this.plmViewModeData[e].matApp},l.prototype.load=function(e,i,t,r){var n,s,a=[];for(n=0;n<i._renderingStyleData.length;n++)s=new d,this.plmViewModeData.push(s),a.push(s.load(e,i._renderingStyleData[n],t,r));return Promise.all(a)},d.prototype.load=function(i,t,n,h){return new Promise((n,l)=>{var d=new a;new o(t._edgeGas,this.clientManager).applyGP(this,d);var c=d.getGAS(),v=c?c.getMaterial(null,1,null,h.getRenderer(),null,-1):new e.LineBasicMaterial({color:"black"});t._filterMode?(this.matApp=new r({}),n(!0)):i.load({json:t._meshMaterial._json,doneCallback:e=>{this.renderStyle=new s,this.renderStyle.setRenderMode("Face",!0),this.renderStyle.setRenderMode("@Edge",t._edgeVisibility),this.matApp=new r({lineMaterial:v,faceMaterial:e.material}),n(!0)}})})},c.prototype.getOverrideSet=function(e){if(null===this.overrideSet){var t=e.viewer.getSceneGraphOverrideSetManager();this.overrideSet=new i(null,null,!0,void 0,this.name,{nodesOnly:!0}),this.overrideSet.enable(this.enabled),t.insertSceneGraphOverrideSetAt(this.overrideSet,this.index,{}),this.overrideMap=new WeakMap}return this.overrideSet},c.prototype.resetOverrides=function(e){null!==this.overrideSet&&(this.enabled=!1,this.overrideMap=null,e.viewer.getSceneGraphOverrideSetManager().removeSceneGraphOverrideSet(this.overrideSet),this.overrideSet=null)},c.prototype.getOverride=function(e,i){var t;(this.overrideMap&&(t=this.overrideMap.get(e)),t)||(t=this.getOverrideSet(i)._createNodeOverride(e),this.overrideMap.set(e,t));return t},c.prototype.deleteOverride=function(e){var i;null!==this.overrideSet&&((i=this.overrideMap.get(e))&&(this.overrideSet.deleteOverride(i),i=null,this.overrideMap.delete(e)))},c.prototype.setEnabled=function(e){var i=!!e;this.enabled!==i&&(this.enabled=i,this.overrideSet&&this.overrideSet.enable(i))},h});