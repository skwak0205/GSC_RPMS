define("DS/DELPPWWorkInstructionsModule/DataCollect/DataCollectMgmtUI",["UWA/Core","text!DS/DELPPWWorkInstructionsModule/assets/json/DataCollectTLVOptions.json"],function(e,t){"use strict";return function(a,l,n,o,i,r,u){var c,s,d,f,v,g,D,C,m,V,I,N=l.getComponent("Element"),b=l.getComponent("WUXFrameWindowsManager"),p=null,h=null,L=[],M=null,w=null,y=null,R=null,S=null,P=null;return t=e.Json.decode(t),c=function(t,a){var l,n,o=a.get("V_Name"),i=a.get("PID"),u=!0;e.is(y)&&y.visibleFlag&&(p===t?(s(),u=!1):y.close()),h=i,l="DataCollectMgmtUI."+(p=t)+".Panel.Title",n=r.getNLSValue(l,{dcTitle:o}),u?(f(n),v(),y.show()):y.title=n},s=function(){i.emptyNodeModel(),L.forEach(function(e){n.removeReference(e.get("PID"),{silent:!0})}),p=null,h=null,L=[]},d=function(){y=null,R=null,S=null,P=null,i.removeEventListener(M),i.removeEventListener(w)},f=function(t){var n=b.getFrameWindow(a.getAppContext()).getImmersiveFrame();R=new N("div",{class:"DataCollectPlan-Panel-Container"}),(y=l.create("Panel",{domId:"DataCollectMgmtUI-Dialog-Identifier",title:e.is(t)?t:r.getNLSValue("DataCollectMgmtUI.Panel.DefaultTitle"),identifier:"DataCollectMgmtUI-Dialog-Identifier",immersiveFrame:n,content:R,width:600,height:315,position:{my:"center",at:"center"},resizableFlag:!0,closeButtonFlag:!0,useBordersFlag:!0,visibleFlag:!1,collapsibleFlag:!0,verticallyStretchableFlag:!0})).close=function(){y.hide(),s(),d()}},v=function(){var a=t[p];a=a||{},(S=new N("div",{class:"DataCollectPlan-Toolbar-Container"})).inject(R),(P=new N("div",{class:"DataCollectPlan-TLV-Container",id:"DataCollectDGView"})).inject(R),a=e.extend(a,{treeDocument:i.getWUXNodeModel(),treeListViewContainer:P,toolbarContainer:S,dataGridViewOptions:{toolbarOptions:{actionHandler:C}}},!0),o.createTreeListView(a)},I=function(e){var t=u.getNodeOptions(e);t.dataCollectPID=h,i.addNodeModel(t)},g=function(){i.emptyNodeModel(),i.prepareUpdate(),L.forEach(function(e){I(e)}),D(),i.pushUpdate(),M=i.addEventListener("select",m),w=i.addEventListener("unselect",m)},D=function(){var e=i.getTreeDocument(),t=i.getRootNodes();i.prepareUpdate(),t.sort(function(e,t){return e.getAttributeValue("V_TreeOrder")-t.getAttributeValue("V_TreeOrder")}).forEach(function(t,a){e.addRoot(t,a)}),i.pushUpdate()},C=function(e){var t;switch(e){case"DCPAddRow":a.notify("createDataCollectRow",h);break;case"DCPEditRow":t=i.getSelectedNodes()[0].getReferencePID(),a.notify("editDataCollectRow",n.getReferenceModel(t));break;case"DCPDeleteRow":V()}},m=function(){var e=i.getSelectedNodes(),t=["DCPAddRow"];1===e.length?t=t.concat(["DCPEditRow","DCPDeleteRow"]):e.length>1&&t.push("DCPDeleteRow"),o.enableToolBarItems(t)},V=function(){var t=i.getSelectedNodes();e.is(t)&&t.forEach(function(t){u.deleteDataCollectRow(h,t.getReferencePID(),{onComplete:function(l){e.is(l)&&l===t.getReferencePID()?(i.removeNode(t),a.info(r.getNLSValue("DataCollectMgmtUI.DCRowDelete.Success"))):a.warn(r.getNLSValue("DataCollectMgmtUI.DCRowDelete.Failure"))},onFailure:function(){a.warn(r.getNLSValue("DataCollectMgmtUI.DCRowDelete.Failure"))}})})},{init:function(t){var l,n=t.get("type"),o=t.get("PID");e.is(n)&&e.is(n)?(u.isDataCollectCheckList(n)?l="DELWkiDataCollectChecklistReference":u.isDataCollectPlan(n)&&(l="DELWkiDataCollectPlanReference"),e.is(l)?u.fetchDataCollectAttrInfos(function(){c(l,t),u.getDataCollectRows(o,{onComplete:function(e){L=e,g()},onFailure:function(){a.warn(r.getNLSValue("DataCollectMgmtUI.CouldntFetchRows"))}})}):a.warn(r.getNLSValue("DataCollectMgmtUI.NotDataCollectType"))):a.warn(r.getNLSValue("DataCollectMgmtUI.InvalidModel"))},isActive:function(){return e.is(y)&&y.visibleFlag},addDataCollectRow:function(e){I(e)},deleteDataCollectRow:function(){V()},onUpdateDataCollectRow:function(e){var t,a=e.get("type"),l=e.get("PID");"PLMSpecifyHowToCollectDataCnx"===a&&e.hasChanged()&&(t=u.getNodeOptions(e),i.updateNodeOptions(l,t),e.hasChanged("V_TreeOrder")&&D())},onUpdateDataCollect:function(e){var t,a;e.get("PID")===h&&e.hasChanged("V_Name")&&(t="DataCollectMgmtUI."+p+".Panel.Title",a=r.getNLSValue(t,{dcTitle:e.get("V_Name")}),y.title=a)},getDataCollectPID:function(){return h},destroy:function(e){y.close()}}}}),define("DS/DELPPWWorkInstructionsModule/DataCollect/DataCollectDialogUI",["UWA/Core"],function(e,t){"use strict";return function(t,a,l,n,o,i){var r,u,c,s,d,f,v,g,D,C,m,V,I,N,b,p,h,L,M,w,y,R,S,P=a.getComponent("Button"),_="PLMSpecifyHowToCollectDataCnx_Custo",A=["V_MinValue","V_MinControlValue","V_MaxValue","V_MaxControlValue"];return N=function(t,a){var l,n,i,r=[],u=[],c=a,s=function(t,a){var n,o="";return"Real"===c?n=t+l.Name:e.is(c)&&(n=t+c),e.is(n)&&m&&(o=d.get(n+"."+a)),o};return i=o.getObjectAndAttributeInfos(t),m&&(c=d.get("V_DCType")),i.forEach(function(a,i){var v,g,D,C=e.clone(a),V=!0;switch(m&&(C.objectToBeModified=d),e.is(t[i].displayType)&&(C.displayType=t[i].displayType),C.dataIndex){case"V_DCType":m?C.readOnly=!0:C.value=c,C.attributeInfo.onChange=h;break;case"V_DCMagnitude":C.attributeInfo.AuthorizedValues=o.getDimensions(),C.attributeInfo.HasRangeDefined="Yes",g=C.attributeInfo.AuthorizedValues,D=m?d.get("V_DCMagnitude"):"LENGTH","Real"===c?(l=g.find(function(e){return e.Name===D}),e.is(l)&&(r=l.Units,n=m?r.find(function(e){return e.Name===d.get("V_DCUnit")}):r[0])):n="",l&&(C.value=l.NLS),m&&(C.readOnly=!0),C.attributeInfo.onChange=L;break;case"V_PossibleValues":m&&(C.value=d.get("DELExtTargetValues"+c+"."+C.dataIndex)),"Boolean"===c?(C.attributeInfo.HasRangeDefined="Yes",m&&(C.value=d.get("DELExtTargetValuesText."+C.dataIndex),C.value=Array.isArray(C.value)?C.value.join(","):C.value)):C.value=e.is(C.value)&&"NULL"!==C.value?C.value:[];break;case"V_DCUnit":e.is(n)&&(C.value=n.NLSName,f=n.Name),C.attributeInfo.onChange=b,C.attributeInfo.AuthorizedValues=r.map(function(t){var a=e.clone(t);return a.NLS=a.NLSName,a});break;case"V_Value":"Real"===c&&e.is(n)&&(C.attributeInfo.Magnitude=l.Name,C.attributeInfo.ManipulationUnit=n.Name,C.attributeInfo.pattern="^[-+]?([1-9][0-9]*)|(0)$"),C.value=s("DELExtTargetValues",C.dataIndex);break;case"V_MinValue":case"V_MaxValue":C.attributeInfo.unit=e.is(n)?n.NLSName:"",C.attributeInfo.Type="Real"===c?"Double":"Integer",m&&(C.value={value:s("DELExtTargetValues",C.dataIndex),inclusive:d.get(C.dataIndex+"_Inclusive")});break;case"V_MinControlValue":case"V_MaxControlValue":C.attributeInfo.unit=e.is(n)?n.NLSName:"",C.attributeInfo.Type="Real"===c?"Double":"Integer",m&&(C.value={value:s("DELExtControlLimits",C.dataIndex),inclusive:d.get(C.dataIndex+"_Inclusive")});break;case"V_DCFormula":m?"Computed"===d.get("V_DCMode")&&(v=o.getNodeOptions(C.objectToBeModified),C.value=v.grid[C.dataIndex]):V=!1}V&&u.push(C)}),u},b=function(e,t){var a,l,n,i=[],r={};v.forEach(function(t){var o,r=t.dataIndex,u=t.attributeInfo.FullName;l=e[u],"V_DCMagnitude"===r&&(n=t.attributeInfo.AuthorizedValues[l.selectedIndex].Name),"V_DCUnit"===r&&(a=t.attributeInfo.AuthorizedValues[l.selectedIndex]),"V_MinValue"!==r&&"V_MaxValue"!==r&&"V_MinControlValue"!==r&&"V_MaxControlValue"!==r&&"V_Value"!==r||((o="inclusiveLineEditor"===l.fieldType?l.getInputValue():l.value)&&i.push({fullName:u,value:o}),l.setUnit(a.label))}),a.Name!==f&&i.length>0?(r={dimension:n,fromUnit:f,toUnit:a.Name,valuesToConvert:i.map(function(e){return e.value})},o.convertValuesBetweenUnits(r).then(function(t){var l=t.ConvertValue.split(";");i.forEach(function(t,a){var n=e[t.fullName],o=l[a];"inclusiveLineEditor"===n.fieldType?n.setValue(o):n.value=o}),f=a.Name,a=null})):f=a.Name},L=function(t,a){var l,n,o,i,r,u=t["PLMSpecifyHowToCollectDataCnx_Custo.V_DCMagnitude"];for(n=0;n<v.length;n++)if("V_DCUnit"===(l=v[n]).attributeName?(o=e.clone(l),r=n):"V_DCMagnitude"===l.attributeName&&(i=l.attributeInfo.AuthorizedValues[u.selectedIndex].Units),e.is(o)&&e.is(i)){o.attributeInfo.AuthorizedValues=i.map(function(t){var a=e.clone(t);return a.NLS=a.NLSName,a}),s.updateAuthorizedList(o.attributeInfo,"PLMSpecifyHowToCollectDataCnx_Custo.V_DCUnit"),v[r]=o;break}},I=function(t){var l={},n={};l.attribute=v,e.is(t)&&e.is(t.formStyle)&&(n.formStyle=t.formStyle),n.section=l,c=a.createElement("div",{class:"section-container"}),s=a.create("FormUI",{sections:n,renderTo:c,headerAccordean:!1})},y=function(){var t,a,l,n=M();e.is(n)?(a=w(),t=g,l=D,r.close(),o.updateDataCollectRow(t,l,a)):r.buttons.Ok.disabled=!1},V=function(t,l){t=t||{},u=a.createElement("div",{class:"DataCollectRow-Dialog"}),(r=a.create("Dialog",{title:t.title,domId:"DataCollectRow-Dialog",content:u,resizableFlag:!0,modalFlag:!0,width:560,minWidth:290,buttons:{Cancel:new P({onClick:function(){r.close()}}),Ok:new P({disabled:!1,emphasize:"primary",onClick:l})}})).close=function(){this.destroy(),f=null,d=null,v=null,g=null,D=null,e.is(s)&&s.destroy(),e.is(u)&&u.destroy(),r=null}},M=function(){var t,a,l=s.validate(),n=function(e,t,a,l){var n=[],o={valid:!0,values:null,message:""};if(0===t.value.length)return o;if(Number.isNaN(Number(t.value)))return o.valid=!1,o.message=i.getNLSValue("DCRow.InvalidValue.Error",{attr:l}),o;if(Array.isArray(e)||"string"==typeof e)e&&(n=Array.isArray(e)?e:[e]);else if("NotSet"!==e.inclusive&&String(e.value).length>0){if(n=Number(e.value),Number.isNaN(n))return o.message=i.getNLSValue("DCRow.InvalidValue.Error",{attr:a}),o.valid=!1,o;n=[n]}return n.length>0&&(o.values=[],o.valid=n.every(function(e,t){return(e=String(e).trim()).length>0&&isNaN(e)?(o.values=null,o.message=i.getNLSValue("DCRow.InvalidValue.Error",{attr:a}),!1):(o.values.push(Number(e)),!0)})),o},o=function(a,l){var o,r=i.getNLSValue(_+"."+a),u=i.getNLSValue(_+"."+l),c=e.clone(t[_+"."+a]),s=e.clone(t[_+"."+l]),d={valid:!0};if("NotSet"!==s.inclusive&&e.is(s.value)&&(s.value=String(s.value).trim(),d=n(c,s,r,u),s.value=Number(s.value),d.valid&&Array.isArray(d.values)))for(var f=0;f<d.values.length;f++)if(o=d.values[f],"Included"===s.inclusive&&o<s.value||"Included"!==s.inclusive&&o<=s.value){d.valid=!1,d.message=i.getNLSValue("DCRow.OutOfBound.Error",{toCompare:r,camparingWith:u});break}return d},u=function(a,l){var o,r=i.getNLSValue(_+"."+a),u=i.getNLSValue(_+"."+l),c=e.clone(t[_+"."+a]),s=e.clone(t[_+"."+l]),d={valid:!0};if("NotSet"!==s.inclusive&&e.is(s.value)&&(s.value=String(s.value).trim(),d=n(c,s,r,u),s.value=Number(s.value),d.valid&&Array.isArray(d.values)))for(var f=0;f<d.values.length;f++)if(o=d.values[f],"Included"===s.inclusive&&o>s.value||"Included"!==s.inclusive&&o>=s.value){d.valid=!1,d.message=i.getNLSValue("DCRow.OutOfBound.Error",{toCompare:r,camparingWith:u});break}return d},c=function(e){var t={valid:!0};return(t=o(e,"V_MinControlValue")).valid&&(t=o(e,"V_MinValue")),t.valid&&(t=u(e,"V_MaxControlValue")),t.valid&&(t=u(e,"V_MaxValue")),t};return l.result&&(t=s.getValues(),a=t[_+".V_DCType"],l.result=v.every(function(e){var t=e.attributeInfo.Name,n={valid:!0};switch(t){case"V_MinControlValue":n=o(t,"V_MinValue");break;case"V_Value":n=c(t);break;case"V_PossibleValues":"Integer"===a&&(n=c(t));break;case"V_MaxControlValue":n=u(t,"V_MaxValue")}return n.valid||(l.message=n.message),n.valid})),!l.result&&l.message&&r.error(l.message),l.result},w=function(){var t,a={};return t=s.getValues(),v.forEach(function(l){var n,o,i,r=l.attributeInfo.Name,u=l.attributeInfo.FullName;e.is(t[u])&&(o=t[u],A.includes(r)?(""!==o.value&&(a[r]=String(o.value)),a[r+"_Inclusive"]=o.inclusive):"V_DCUnit"!==r&&"V_DCMagnitude"!==r||!e.is(o)?"V_PossibleValues"===r?o&&(a[r]=Array.isArray(o)?o:o.split(","),a[r]=a[r].map(function(e){return String(e)})):a[r]="V_Value"===r&&o?String(o):Array.isArray(o)?o:String(o):(i=v.find(function(e){return e.dataIndex===r}))&&(n=i.attributeInfo.AuthorizedValues.find(function(e){return e.NLSName===o||e.NLS===o}),e.is(n)&&(a[r]=n.Name)))}),a},p=function(t){var a,r={};e.is(t)&&(m=!0,d=t,a=n.getNodeModel(d.get("PID"),!0),g=a.options.dataCollectPID,D=d.get("PID"),r.onComplete=function(){var e,a=l.getReferenceModel(g),n={title:i.getNLSValue("DataCollectMgmtDialog.EditDialog")};e=a.get("type")+t.get("V_DCType"),v=N(C[e].Attribute),I({formStyle:C[e].formStyle}),V(n,y),c.inject(u)},o.fetchDataCollectRow(g,D,r))},R=function(t){var a,n,r={title:i.getNLSValue("DataCollectMgmtDialog.AddDialog")};n=l.getReferenceModel(g),o.isDataCollectPlan(n)?a="DELWkiDataCollectPlanReferenceReal":o.isDataCollectCheckList(n)&&(a="DELWkiDataCollectChecklistReferenceBoolean"),e.is(a)&&(v=N(C[a].Attribute,t),I({formStyle:C[a].formStyle}),V(r,S),c.inject(u))},h=function(t,a){var l=a.dsModel.value,n="DELWkiDataCollectPlanReference";e.is(c)&&(c.remove(),c=null),v=N(C[n+=l].Attribute,l),I({formStyle:C[n].formStyle}),c.inject(u)},S=function(){var e,t;M()?(t=w(),e=g,r.close(),o.createDataCollectRow(e,t)):r.buttons.Ok.disabled=!1},{init:function(t){var a=e.is(t)?t:{};e.is(a.editFormConfig)&&(C=a.editFormConfig)},editDataCollectRow:function(e){p(e)},createDataCollectRow:function(t,a){e.is(t)&&(m=!1,g=t,R(a))}}}}),define("DS/DELPPWWorkInstructionsModule/WorkInstructionsModule",["UWA/Core","DS/DELPPWWorkInstructionsModule/DataCollect/DataCollectMgmtUI","DS/DELPPWWorkInstructionsModule/DataCollect/DataCollectDialogUI"],function(e,t,a){"use strict";return{behaviors:["UXFactoryBehavior","ModelBehavior","TreeListViewBehavior","WUXNodeModelBehavior","ResourceBehavior","DataCollectWKIBehavior","EditAttributeBehavior","LinkBehavior"],creator:function(l,n,o,i,r,u,c,s,d){var f,v,g,D,C,m,V,I,N,b=new t(l,n,o,i,r,u,c),p=new a(l,n,o,r,c,u);return v=function(t){(t=e.is(t,"array")?t:[t]).forEach(function(e){b.isActive()&&(c.isDataCollectRow(e)?b.onUpdateDataCollectRow(e):(c.isDataCollectPlan(e)||c.isDataCollectCheckList(e))&&b.onUpdateDataCollect(e))})},g=function(t){var a={};e.is(t)&&(c.isDataCollectPlan(t)||c.isDataCollectCheckList(t)?(b.init(t),a.editFormConfig=f,p.init(a)):t.isWorkInstruction()&&s.editConfiguredAttributes(t))},D=function(t){e.is(t)&&p.editDataCollectRow(t)},C=function(){b.deleteDataCollectRow()},m=function(){b.isActive()&&b.destroy()},V=function(e){var t;e=Array.isArray(e)?e:[e],b.isActive()&&(t=b.getDataCollectPID(),e.some(function(e){return t===e.get("PID")})&&b.destroy())},I=function(t){var a,l;e.is(t)&&(l=o.getReferenceModel(t),a=c.isDataCollectPlan(l)?"Real":"Boolean",p.createDataCollectRow(t,a))},N=function(t){e.is(t)&&c.isDataCollectRow(t)&&b.isActive()&&b.addDataCollectRow(t)},{listenTo:function(){return{editWorkInstruction:g,createDataCollectRow:I,editDataCollectRow:D,deleteDataCollectRow:C,changeReference:v,HideAll:m,removeReference:V,addReference:N}},onStart:function(t,a){var l;e.is(t.editFormAttributesXML)&&(l=d.getXMLValues(t.editFormAttributesXML),f=l.convert("AttributesDescriptionList.Type","name")),a()},onStop:function(){}}}}});