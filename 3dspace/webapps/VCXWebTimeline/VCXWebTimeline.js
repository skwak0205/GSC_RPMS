define("DS/VCXWebTimeline/VCXWebTimelineView",["UWA/Class","UWA/Element","DS/CoreEvents/Events","DS/WebappsUtils/WebappsUtils","DS/Controls/Button","DS/Windows/Panel","DS/Controls/Toggle"],function(e,t,i,n,s,o,r){"use strict";return e.extend({init:function(e){if(this.options=e,this._container=null,this._updateModelLocked=!1,this._listCustomButtons=[],this._parentPanel=null,this._parentNode=e.parent||null,this._frmWindow=e.frmWindow,this._title=e.title||"Timeline",this._maxFrame=e.maxFrame||0,this._fps=e.fps||30,this.loadCssFile("VCXWebTimeline/VCXWebTimeline.css",1),null!==this._parentNode){var t=this._parentNode.parentNode.parentNode.parentNode.parentNode.parentNode.parentNode.parentNode.parentNode.parentNode;this.oldWidth=0;var i=this;this._observer=new MutationObserver(function(e){e.forEach(function(e){if(e.target===t&&i.oldWidth!==t.style.width){var n=i._parentNode.clientWidth-i.oldWidth>0;i._updateDynamicToolbar(i._parentNode.clientWidth,n),i.oldWidth=i._parentNode.clientWidth}})});t&&this._observer.observe(t,{attributes:!0,childList:!1,characterData:!1,subtree:!1,attributeOldValue:!0,attributeFilter:["style"]})}},unInitialize:function(){this._parentPanel&&(this._parentPanel.close(),delete this._parentPanel),this._observer&&this._observer.disconnect(),this._observer=null},updateModelLocked:function(e){this._updateModelLocked=e},isVisible:function(){return!!this._parentPanel&&(!0!==this._parentPanel.getDockedFlag()||!0!==this._frmWindow.getImmersiveFrame().getDockingElement(this._parentPanel.currentDockArea).collapseDockingZoneFlag)},loadCssFile:function(e,t){for(var i=document.getElementsByTagName("head")[0],s=i.getElementsByTagName("link"),o=null,r=0;r<s.length;r++)if((o=s[r]).href.search(e)>-1)return void(o.disabled=!1);(o=document.createElement("link")).type="text/css",o.rel="stylesheet",o.href=void 0===t?e:n.getWebappsBaseUrl()+e,i.appendChild(o)},_convertIndexToTime:function(e){return e/this._fps},_convertIndexToSimpleDisplayTime:function(e){var t=e/this._fps,i=Math.floor(t),n=Math.floor(i/86400),s=Math.floor(i/3600)%24,o=Math.floor(i/60)%60,r=i%60,a=Math.floor(t%1*1e3);return n>0?n+"d "+(s>0?s+"h ":""):s>0?s+"h "+(o>0?o+"min ":""):o>0?o+"min "+(r>0?r+"s ":""):r>0?r+"s "+(a>0?a+"ms":""):a>0?a+"ms":"0"},_convertIndexToDisplayTime:function(e){var t=e/this._fps,i=Math.floor(t),n=Math.floor(i/86400),s=Math.floor(i/3600)%24,o=Math.floor(i/60)%60,r=i%60,a=Math.floor(t%1*1e3);return 0==a&&0==r&&0==o&&0==s&&0==n?"0":(n>0?n+"d ":"")+(s>0?s+"h ":"")+(o>0?o+"min ":"")+(r>0?r+"s ":"")+(a>0?a+"ms":"")},_sendEvent:function(e,t){i.publish({event:e,data:t})},_createPanel:function(e,t,i,n,s,r){e.getDockingElement(WUXDockAreaEnum.TopDockArea).collapseDockingZoneFlag=!0;var a=new o({activeFlag:!1,immersiveFrame:e,resizableFlag:t,currentDockArea:i,title:n,content:s,minWidth:500,width:1e3,height:40,visibleFlag:!0,horizontallyStretchableFlag:!0,maximizedFlag:!1,closeButtonFlag:!1});if(a)return a.elements.container.addClassName(r),a},_createContainer:function(e){return new UWA.Element("div",{class:e})},_addSeparator:function(e){new UWA.Element("div",{class:"wux-afr-cmdSeparator",styles:{height:"24px"}}).inject(e)},_createToggle:function(e,t,i){return new r({type:e,label:t,checkFlag:i})},_createStandardButton:function(e,t,i){var n=t;Array.isArray(t)&&(n=t[0]);var o=new s({recId:i,icon:n,iconSize:"1x",type:"standard"}).inject(e);if(Array.isArray(t)){var r=o.elements.button.childNodes[0];r.className="wux-ui-fa wux-ui-fa-stack vcx-timeline-toolbar-stack",UWA.createElement("i",{class:"wux-ui-fa wux-ui-fa-lg "+t[0]+" "+t[1]}).inject(r),UWA.createElement("i",{class:"wux-ui-fa wux-ui-fa-lg "+t[2]+" "+t[3]}).inject(r)}return o.elements.button.title=i,o},_createCheckButton:function(e,t,i,n){var s=this._createStandardButton(e,t,i);return s.type="check",s.checkFlag=n,s},getContainer:function(){return this._container},getParentPanel:function(){return this._parentPanel},getParentNode:function(){return this._parentNode},getFrameWindow:function(){return this._frmWindow},getTitle:function(){return this._title},getMaxFrame:function(){return this._maxFrame},getFPS:function(){return this._fps},getTrackTreeListView:function(){return null},getTimelineModel:function(){return null}})}),define("DS/VCXWebTimeline/VCXWebTimelineCustomTreeNodeView",["UWA/Class","UWA/Element","DS/CoreEvents/Events","DS/Tree/TreeNodeView"],function(e,t,i,n){"use strict";return n.extend({init:function(e){this._parent(e)},updateInternalParameters:function(){this._parent();var e=this.getCellInfos();e.isHeader||(e.nodeModel.options.preventDisplayChilds?e.cellView.getContent().addClassName("vcx-preventDisplayChilds"):e.cellView.getContent().removeClassName("vcx-preventDisplayChilds"))}})}),define("DS/VCXWebTimeline/VCXWebTimeline",["UWA/Class","DS/CoreEvents/Events"],function(e,t){"use strict";return e.extend({init:function(e){this.options=e,this._index=e.index||0,this._fps=e.fps||30,this._view=null,this._GUID=this.guid(),console.log(this._GUID),this._registerIndexPositionChangedToken,this._registerPlayToken,this._registerPauseToken,this._registerStopToken,this._registerStepBackwardToken,this._registerStepForwardToken,this._registerCameraToken,this._registerLoopToken,this._registerBounceToken,this._registerReverseToken,this._registerAutoKeyToken},unInitialize:function(){this._unRegisterWUXEvent(this._registerIndexPositionChangeWhileToken),this._registerIndexPositionChangeWhileToken=0,this._unRegisterWUXEvent(this._registerIndexPositionChangeEndToken),this._registerIndexPositionChangeEndToken=0,this._unRegisterWUXEvent(this._registerPlayToken),this._unRegisterWUXEvent(this._registerPauseToken),this._unRegisterWUXEvent(this._registerStopToken),this._unRegisterWUXEvent(this._registerStepBackwardToken),this._unRegisterWUXEvent(this._registerStepForwardToken),this._unRegisterWUXEvent(this._registerCameraToken),this._unRegisterWUXEvent(this._registerLoopToken),this._unRegisterWUXEvent(this._registerBounceToken),this._unRegisterWUXEvent(this._registerReverseToken),this._unRegisterWUXEvent(this._registerAutoKeyToken),this._registerPlayToken=0,this._registerPauseToken=0,this._registerStopToken=0,this._registerStepBackwardToken=0,this._registerStepForwardToken=0,this._registerCameraToken=0,this._registerLoopToken=0,this._registerBounceToken=0,this._registerReverseToken=0,this._view&&this._view.unInitialize()},guid:function(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()},_subscribeToGUIEvent:function(e,i){var n=this;return t.subscribe({event:e},function(){n._sendEvent(i)})},_subscribeToGUIEventWithData:function(e,i){var n=this;return t.subscribe({event:e},function(e){n._sendEvent(i,e)})},_registerIndexPositionChange:function(e,i){var n=this;return t.subscribe({event:e},function(e){n._index=e,n._sendEvent(i,e)})},_unRegisterWUXEvent:function(e){t.unsubscribe(e)},_sendEvent:function(e,i){t.publish({event:e,data:i})},getIndex:function(){return this._index},getFPS:function(){return this._fps},getView:function(){return this._view},pauseGUIMode:function(){},playGUIMode:function(){},updateGrid:function(){},onRedraw:function(){},removeKey:function(e){},emptyMarkers:function(){},getTrackTreeListView:function(){return null},getTimelineModel:function(){return null},getSelectedTime:function(){}})}),define("DS/VCXWebTimeline/VCXWebTimelineLightView",["UWA/Core","UWA/Element","DS/Core/PointerEvents","DS/Controls/SpinBox","DS/VCXWebTimeline/VCXWebTimelineView","DS/Controls/Timeline","DS/CoreEvents/Events","i18n!DS/VCXWebTimeline/assets/nls/VCXWebTimeline"],function(e,t,i,n,s,o,r,a){"use strict";return s.extend({init:function(e,t){this._parent(e),this._eventsName=t,this._slider=null,this.sliderContainer=null,this._toolbar=null,this._playBack=null,this.playBackContainer=null,e.customButtons&&(this._listCustomButtons=e.customButtons),this._displayToolbar=e.displayToolbar,this._displaySlider=e.displaySlider,this._displayPlayBack=e.displayPlayBack,this._displayLoop=e.displayLoop,this._displayBounce=e.displayBounce,this._displayReverse=e.displayReverse,this._displayMarkers=e.displayMarkers,this._displayCamera=e.displayCamera,this._cameraMode=e.displayCameraMode,this._displayAutoKey=e.displayAutoKey,this._autoKeyMode=e.displayAutoKeyMode,this._displayRemoveTracks=e.displayRemoveTracks,this._displayFilterOnSelection=e.displayFilterOnSelection,this._filterOnSelectionMode=e.filterOnSelectionMode,this._play=null,this._stepBackward=null,this._stepForward=null,this._stop=null,this._nextMarker=null,this._previousMarker=null,this._loop=null,this._bounce=null,this._reverse=null,this._camera=null,this._waitPressTimer=0,this._pressTimer=0,this._isPressed=!1,this._fromFrame=null,this._prevVal=0;var n=this;this._SLIDER_OR_SPINBOX_MOUSEDOWN_CALLBACK=function(e){n._play.checkFlag&&(n._play.icon="play",n._play.checkFlag=!1,n._sendEvent(n._eventsName.pause)),n._isPressed=!0},this._buildLightTimelineComponents(),null===this._parentNode?(this._parentPanel=this._createPanel(this._frmWindow.getImmersiveFrame(),!0,WUXDockAreaEnum.TopDockArea,this._title,this._container),this._parentNode=this._parentPanel.elements.container):this._container.inject(this._parentNode),this._DOCUMENT_POINTERUP=function(e){if(window.clearTimeout(n._waitPressTimer),window.clearInterval(n._pressTimer),n._isPressed)if(n._isPressed=!1,n._fromFrame!=n._slider.getValue()){var t={from:n._fromFrame,to:n._slider.getValue()};n._sendEvent(n._eventsName.indexPositionChangeEnd,t)}else{t={from:n._prevVal,to:n._slider.getValue()};n._sendEvent(n._eventsName.indexPositionChangeEnd,t)}n._displaySlider&&(n._prevVal=n._slider.getValue())},document.addEventListener(i.POINTERUP,this._DOCUMENT_POINTERUP),this._VCX_Timeline_AutoKey=r.subscribe({event:"VCX_Timeline_AutoKey"},function(e){var t=n;t.isToolbarDisplayed()&&t.getAutoKeyButton()&&t.getAutoKeyButton().checkFlag!==e&&(t.getAutoKeyButton().checkFlag=e)})},unInitialize:function(){this._parent(),r.unsubscribe(this._VCX_Timeline_AutoKey),this._stepBackward.elements.button.removeEventListener(i.POINTERDOWN,this._STEPBACKWARD_MOUSEDOWN_CALLBACK),this._stepForward.elements.button.removeEventListener(i.POINTERDOWN,this._STEPFORWARD_MOUSEDOWN_CALLBACK),this._slider&&(this._slider.elements.container.removeEventListener(i.POINTERDOWN,this._SLIDER_OR_SPINBOX_MOUSEDOWN_CALLBACK),this._slider._modelEvents.unsubscribe(this._SLIDER_ONCHANGE)),this._playBack&&(this._playBack.elements.up.removeEventListener(i.POINTERDOWN,this._SLIDER_OR_SPINBOX_MOUSEDOWN_CALLBACK),this._playBack.elements.down.removeEventListener(i.POINTERDOWN,this._SLIDER_OR_SPINBOX_MOUSEDOWN_CALLBACK)),document.removeEventListener(i.POINTERUP,this._DOCUMENT_POINTERUP),this._container.remove(),this._container=null,this._STEPBACKWARD_MOUSEDOWN_CALLBACK=0,this._STEPFORWARD_MOUSEDOWN_CALLBACK=0,this._DOCUMENT_POINTERUP=0,this._SLIDER_OR_SPINBOX_MOUSEDOWN_CALLBACK=0},_translate:function(e){return this._i18n||(this._i18n=a),this._i18n?this._i18n[e]:e},_buildLightTimelineComponents:function(){this._container=this._createContainer("vcx-timeline vcx-timeline-light"),this._displayToolbar&&this._buildToolbar(),this._displaySlider&&this._buildSlider(),this._displayPlayBack&&this._buildPlayBack()},_buildToolbar:function(){this._toolbar=this._createContainer("vcx-timeline-light vcx-timeline-toolbar").inject(this._container),this._previousMarkerButton(this),this._stepBackwardButton(this),this._playPauseButton(this),this._stopButton(this),this._stepForwardButton(this),this._nextMarkerButton(this),this._addSeparator(this._toolbar),this._loopButton(this),this._bounceButton(this),this._reverseButton(this),this._addSeparator(this._toolbar),this._autoKeyButton(this),this._cameraButton(this),this._removeTrackSelectedButton(this),this._filterOnSelectionButton(this);for(var e=0;e<this._listCustomButtons.length;e++){var t=this._listCustomButtons[e];this._createCustomButton(t.icon,t.tooltip,t.callback)}},_stepBackwardButton:function(e){this._stepBackward=this._createStandardButton(this._toolbar,["wux-ui-fa-play","vcx-timeline-toolbar-stack-frame-backward-1","wux-ui-fa-stop","vcx-timeline-toolbar-stack-frame-backward-2"],this._translate("VCXTimelineLightView.VCXButtonFrameBackward")),this._STEPBACKWARD_MOUSEDOWN_CALLBACK=function(t){e._onPause(e),e._sendEvent(e._eventsName.stepBackward),e._waitPressTimer=window.setTimeout(function(){e._pressTimer=window.setInterval(function(){e._sendEvent(e._eventsName.stepBackward)},100)},300)},this._stepBackward.disabled=!0,this._stepBackward.elements.button.addEventListener(i.POINTERDOWN,this._STEPBACKWARD_MOUSEDOWN_CALLBACK)},_createCustomButton:function(e,t,i){var n=this._createStandardButton(this._toolbar,e,t);return this._addCustomButtonClick(n,i),n},_addCustomButtonClick:function(e,t){e.onClick=t},_previousMarkerButton:function(e){this._displayMarkers&&(this._previousMarker=this._createStandardButton(this._toolbar,["wux-ui-fa-circle-o","vcx-timeline-toolbar-stack-frame-previousMarker-1","wux-ui-fa-play","vcx-timeline-toolbar-stack-frame-previousMarker-2"],this._translate("VCXTimelineLightView.VCXButtonPreviousMarker")),this._previousMarker.visibleFlag=!1,this._previousMarker.onClick=function(t){e._onPause(e),e._sendEvent(e._eventsName.previousMarker)},this._previousMarker.disabled=!0)},_playPauseButton:function(e){this._play=this._createCheckButton(this._toolbar,"play",this._translate("VCXTimelineLightView.VCXButtonPlay"),!1);var t=this;this._play.onClick=function(i){e._play.checkFlag?(e._play.icon="pause",e._play.elements.button.title=t._translate("VCXTimelineLightView.VCXButtonPause"),e._sendEvent(e._eventsName.play)):(e._play.icon="play",e._play.elements.button.title=t._translate("VCXTimelineLightView.VCXButtonPlay"),e._sendEvent(e._eventsName.pause))}},_stopButton:function(e){this._stop=this._createStandardButton(this._toolbar,"stop",this._translate("VCXTimelineLightView.VCXButtonStop")),this._stop.onClick=function(t){e._sendEvent(e._eventsName.stop)}},_nextMarkerButton:function(e){this._displayMarkers&&(this._nextMarker=this._createStandardButton(this._toolbar,["wux-ui-fa-play","vcx-timeline-toolbar-stack-frame-nextMarker-1","wux-ui-fa-circle-o","vcx-timeline-toolbar-stack-frame-nextMarker-2"],this._translate("VCXTimelineLightView.VCXButtonNextMarker")),this._nextMarker.visibleFlag=!1,this._nextMarker.onClick=function(t){e._onPause(e),e._sendEvent(e._eventsName.nextMarker)})},_stepForwardButton:function(e){this._stepForward=this._createStandardButton(this._toolbar,["wux-ui-fa-stop","vcx-timeline-toolbar-stack-frame-forward-1","wux-ui-fa-play","vcx-timeline-toolbar-stack-frame-forward-2"],this._translate("VCXTimelineLightView.VCXButtonFrameForward")),this._STEPFORWARD_MOUSEDOWN_CALLBACK=function(t){e._onPause(e),e._sendEvent(e._eventsName.stepForward),e._waitPressTimer=window.setTimeout(function(){e._pressTimer=window.setInterval(function(){e._sendEvent(e._eventsName.stepForward)},100)},300)},this._stepForward.elements.button.addEventListener(i.POINTERDOWN,this._STEPFORWARD_MOUSEDOWN_CALLBACK)},_cameraButton:function(e){this._displayCamera&&(this._camera=this._createCheckButton(this._toolbar,"video-camera",this._translate("VCXTimelineLightView.VCXButtonCameraPlayMode"),this._cameraMode),this._camera.onClick=function(t){e._sendEvent(e._eventsName.camera,t.dsModel.checkFlag)})},_autoKeyButton:function(e){this._displayAutoKey&&(this._autoKey=this._createCheckButton(this._toolbar,"dot-circle-o",this._translate("VCXTimelineLightView.VCXButtonAutoKeyMode"),this._autoKeyMode),this._autoKey.onClick=function(t){e._sendEvent(e._eventsName.autoKey,t.dsModel.checkFlag)})},_removeTrackSelectedButton:function(e){this._displayRemoveTracks&&(this._removeTracks=this._createStandardButton(this._toolbar,"trash",this._translate("VCXTimelineLightView.VCXButtonEmptySelection")),this._removeTracks.onClick=function(t){e._sendEvent(e._eventsName.removeSelectedTracks,t.dsModel.checkFlag)})},_filterOnSelectionButton:function(e){this._displayFilterOnSelection&&(this._displayFilterOnSelectionButton=this._createCheckButton(this._toolbar,"filter",this._translate("VCXTimelineLightView.VCXButtonFilterOnSelection"),this._filterOnSelectionMode),this._displayFilterOnSelectionButton.onClick=function(t){e._sendEvent(e._eventsName.filterOnSelection,t.dsModel.checkFlag)})},_loopButton:function(e){this._displayLoop&&(this._loop=this._createCheckButton(this._toolbar,"retweet",this._translate("VCXTimelineLightView.VCXButtonLoopPlayMode"),!1),this._loop.onClick=function(t){e._sendEvent(e._eventsName.loop,t.dsModel.checkFlag)})},_bounceButton:function(e){this._displayBounce&&(this._bounce=this._createCheckButton(this._toolbar,["wux-ui-fa-circle","vcx-timeline-toolbar-stack-bounce-1","wux-ui-fa-check","vcx-timeline-toolbar-stack-bounce-2"],this._translate("VCXTimelineLightView.VCXButtonBouncePlayMode"),!1),this._bounce.onClick=function(t){e._sendEvent(e._eventsName.bounce,t.dsModel.checkFlag)})},_reverseButton:function(e){this._displayReverse&&(this._reverse=this._createCheckButton(this._toolbar,["wux-ui-fa-play","vcx-timeline-toolbar-stack-reverse-1","wux-ui-fa-play","vcx-timeline-toolbar-stack-reverse-2"],this._translate("VCXTimelineLightView.VCXButtonReversePlayMode"),!1),this._reverse.onClick=function(t){e._sendEvent(e._eventsName.reverse,t.dsModel.checkFlag)})},_buildSlider:function(){this.sliderContainer=this._createContainer("vcx-timeline-light-slider").inject(this._container),this._createSlider(this.sliderContainer,0,0,this._maxFrame)},_createSlider:function(t,n,s,r){var a=this;this._slider=new o({minValue:n,maxValue:r,value:s,snap:50,dynamicGraduations:!1,dynamicGaugeColor:!1,graduationsLabel:!0,eventsList:[{label:n,value:s},{label:this._convertIndexToSimpleDisplayTime(r),value:r}],activeGraduationsColor:"#3CF",inactiveGraduationsColor:"#CCC"}).inject(t),this._slider._buildScaling=function(){var t,n,s=0,o=this.options.graduations,r=e.typeOf(o);n="array"==r?t=o.length:(t=parseInt(o,10))+1;for(var l=-parseInt(this.options.theme.fontSize+5,10),h=0;h<n;h++){var _,c;if(this.options.dynamicGraduations)c="hsl("+(180-180*h/t)+", 100%, 50%)",_=0;else c=this.options.inactiveGraduationsColor,_=1;s="array"==r?this._realToVirtualValue(o[h].value).percent:h/t;parseInt(this.options.theme.graduations.height/4,10);this.options.dynamicGraduations&&0;var d=new e.Element("div",{class:"wux-Gauge-scale",styles:{position:"absolute",opacity:_}}),m=new e.Element("div",{styles:{position:"relative"}}).inject(d);if(this.options.graduationsLabel){var u;u="array"==r?o[h].label:this._percentToRealValue(parseFloat(s));var p=new e.Element("div",{class:"wux-Gauge-scale-label","data-value":this._percentToRealValue(s),styles:{position:"absolute",top:l,fontSize:this.options.theme.fontSize,color:this.options.graduationsLabelColor},html:u.toString()}).inject(m);if(void 0!==o[h].type){var v=document.createAttribute("marker-type");v.value=o[h].type,p.setAttributeNode(v),p.title=o[h].name;p.addEventListener(i.POINTERDOWN,function(e){return function(t){t.stopPropagation(),a._onPause(a),a._sendEvent(a._eventsName.goToMarker,e)}}(o[h]))}}var T=100*s;d.setStyles({backgroundColor:c,top:-2,left:T+"%",marginLeft:h==n-1?-1:0,width:this.options.theme.graduations.width,height:this.options.theme.graduations.height}).inject(this.elements.container)}},this._slider.removeScalingFromDOM=function(){for(var e=this.elements.container.querySelectorAll(".wux-controls-gauge.wux-timeline > .wux-Gauge-scale:not(.wux-Gauge-cursor)"),t=e.length,i=0;i<t;i++)e[i].parentNode.removeChild(e[i])},this._sliderInteractions()},_sliderInteractions:function(){var e=this;this._SLIDER_ONCHANGE=this._slider.addEvent("change",function(t){var i=e._slider.getValue();e._displayToolbar?e._updateToolbarButtons(e,i):(0===i||i>=e._maxFrame)&&(window.clearTimeout(e._waitPressTimer),window.clearInterval(e._pressTimer)),e._updateModelLocked||(e._sendEvent(e._eventsName.indexPositionChangeWhile,i),e._isPressed||(e._fromFrame=i)),e._updateComposantsUnits(i)}),e._slider.elements.container.addEventListener(i.POINTERDOWN,e._SLIDER_OR_SPINBOX_MOUSEDOWN_CALLBACK)},_addMarkers:function(e){var t=e.length;if(0!==t&&(this._displayMarkers&&(this._previousMarker.visibleFlag=!0,this._nextMarker.visibleFlag=!0),this._displaySlider)){var i;this._slider.removeScalingFromDOM();for(var n=0;n<t;n++)e[n].frame<=this._maxFrame&&(i={id:e[n].id,value:e[n].frame,type:e[n].type,name:e[n].name,label:""}),this._slider.options.graduations.push(i);this._slider._buildScaling()}},_buildPlayBack:function(){this.playBackContainer=this._createContainer("vcx-timeline-light-spinbox").inject(this._container),this._createSpinBox(this.playBackContainer,100,"s",0,this._maxFrame,1,1)},_createSpinBox:function(e,t,i,s,o,r,a){this._playBack=new n({value:t,units:i,minValue:s,maxValue:o,stepValue:r,pageStepValue:a}).inject(e),this._spinBoxInteractions()},_spinBoxInteractions:function(){var e=this;this._playBack.addEventListener("change",function(t){e._displaySlider?e._slider.setValue(t.dsModel.value):e._sendEvent(e._eventsName.indexPositionChangeEnd,t.dsModel.value)}),this._playBack.elements.up.addEventListener(i.POINTERDOWN,this._SLIDER_OR_SPINBOX_MOUSEDOWN_CALLBACK),this._playBack.elements.down.addEventListener(i.POINTERDOWN,this._SLIDER_OR_SPINBOX_MOUSEDOWN_CALLBACK)},_updateDynamicToolbar:function(e,t){this._displayToolbar&&this._toolbar.clientWidth,this._displaySlider&&this.sliderContainer.clientWidth,this._displayPlayBack&&this._playBack.clientWidth;t?e>220&e<=260?this._camera.visibleFlag=!0:e>260?(this._stepBackward.visibleFlag=!0,this._stepForward.visibleFlag=!0):this._camera&&(this._camera.visibleFlag=!0):e<260&&e>220?(this._stepBackward.visibleFlag=!1,this._stepForward.visibleFlag=!1):e<=220&&this._camera&&(this._camera.visibleFlag=!1)},_onPause:function(e){e._play.checkFlag&&(e._play.icon="play",e._play.checkFlag=!1)},_updateComposantsUnits:function(e){var t=this._convertIndexToSimpleDisplayTime(e);this._displayPlayBack&&(this._playBack.elements.inputField.value=t)},_updateToolbarButtons:function(e,t){0===t?(window.clearTimeout(e._waitPressTimer),window.clearInterval(e._pressTimer),e._displayMarkers&&(e._previousMarker.disabled=!0,e._nextMarker.disabled=!1),e._stepBackward.disabled=!0,e._play.disabled=!1,e._stepForward.disabled=!1):t>=e._maxFrame?(window.clearTimeout(e._waitPressTimer),window.clearInterval(e._pressTimer),e._play.disabled=!0,e._stepForward.disabled=!0,e._stepBackward.disabled=!1,e._displayMarkers&&(e._previousMarker.disabled=!1,e._nextMarker.disabled=!0)):(e._play.disabled=!1,e._stepBackward.disabled=!1,e._stepForward.disabled=!1,e._displayMarkers&&(e._previousMarker.disabled=!1,e._nextMarker.disabled=!1))},isToolbarDisplayed:function(){return this._displayToolbar},getStepBackwardButton:function(){return this._stepBackward},getPreviousMarkerButton:function(){return this._previousMarker},getPlayButton:function(){return this._play},getStopButton:function(){return this._stop},getNextMarkerButton:function(){return this._nextMarker},getStepForwardButton:function(){return this._stepForward},getLoopButton:function(){return this._loop},getBounceButton:function(){return this._bounce},getReverseButton:function(){return this._reverse},getCameraButton:function(){return this._camera},getAutoKeyButton:function(){return this._autoKey},getFilterOnSelectionButton:function(){return this._displayFilterOnSelectionButton},isMarkersDisplayed:function(){return this._displayMarkers},isCameraDisplayed:function(){return this._displayCamera},isAutoKeyDisplayed:function(){return this._displayAutoKey},isLoopDisplayed:function(){return this._displayLoop},isBounceDisplayed:function(){return this._displayBounce},isReverseDisplayed:function(){return this._displayReverse},isSliderDisplayed:function(){return this._displaySlider},getSlider:function(){return this._slider},isPlayBackDisplayed:function(){return this._displayPlayBack},getPlayBack:function(){return this._playBack},getWaitPressTimer:function(){return this._waitPressTimer},getPressTimer:function(){return this._pressTimer}})}),define("DS/VCXWebTimeline/VCXWebTimelineLight",["DS/VCXWebTimeline/VCXWebTimeline","DS/VCXWebTimeline/VCXWebTimelineLightView"],function(e,t){"use strict";return e.extend({init:function(e){this._parent(e);var i=this.guid(),n="VCX_Timeline_GUI_IndexPosChgWhile"+i,s="VCX_Timeline_GUI_IndexPosChgEnd"+i,o="VCX_Timeline_GUI_Play"+i,r="VCX_Timeline_GUI_Pause"+i,a="VCX_Timeline_GUI_Stop"+i,l="VCX_Timeline_GUI_StepBackward"+i,h="VCX_Timeline_GUI_StepForward"+i,_="VCX_Timeline_GUI_Camera"+i,c="VCX_Timeline_GUI_Loop"+i,d="VCX_Timeline_GUI_Bounce"+i,m="VCX_Timeline_GUI_Reverse"+i,u="VCX_Timeline_GUI_PreviousMarker"+i,p="VCX_Timeline_GUI_NextMarker"+i,v="VCX_Timeline_GUI_GoToMarker"+i,T="VCX_Timeline_GUI_RemoveSelectedTracks"+i,g="VCX_Timeline_GUI_FilterOnSelection"+i,f="VCX_Timeline_GUI_AutoKey"+i;this.eventsName={indexPositionChangeWhile:n,indexPositionChangeEnd:s,play:o,pause:r,stop:a,stepBackward:l,stepForward:h,camera:_,loop:c,bounce:d,reverse:m,nextMarker:p,previousMarker:u,goToMarker:v,removeSelectedTracks:T,filterOnSelection:g,autoKey:f},this._view=new t(e,this.eventsName),this._registerIndexPositionChangeWhileToken=this._registerIndexPositionChange(n,e.event_timePosChangeWhile),this._registerIndexPositionChangeEndToken=this._registerIndexPositionChange(s,e.event_timePosChangeEnd),this._registerPlayToken=this._subscribeToGUIEvent(o,e.event_play),this._registerPauseToken=this._subscribeToGUIEvent(r,e.event_pause),this._registerStopToken=this._subscribeToGUIEvent(a,e.event_stop),this._registerStepBackwardToken=this._subscribeToGUIEvent(l,e.event_stepBackward),this._registerStepForwardToken=this._subscribeToGUIEvent(h,e.event_stepForward),this._registerCameraToken=this._subscribeToGUIEventWithData(_,e.event_camera),this._registerPreviousMarkerToken=this._subscribeToGUIEvent(u,e.event_previousMarker),this._registerNextMarkerToken=this._subscribeToGUIEvent(p,e.event_nextMarker),this._registerGoToMarkerToken=this._subscribeToGUIEventWithData(v,e.event_goToMarker),this._registerRemoveSelectedTracksToken=this._subscribeToGUIEvent(T,e.event_removeSelectedTracks),this._registerFilterOnSelection=this._subscribeToGUIEventWithData(g,e.event_filterOnSelection),this._registerAutoKeyToken=this._subscribeToGUIEventWithData(f,e.event_autoKey),e.displayLoop&&(this._registerLoopToken=this._subscribeToGUIEventWithData(c,e.event_loop)),e.displayBounce&&(this._registerBounceToken=this._subscribeToGUIEventWithData(d,e.event_bounce)),e.displayReverse&&(this._registerReverseToken=this._subscribeToGUIEventWithData(m,e.event_reverse))},unInitialize:function(){this._parent(),this._unRegisterWUXEvent(this._registerPreviousMarkerToken),this._unRegisterWUXEvent(this._registerNextMarkerToken),this._unRegisterWUXEvent(this._registerGoToMarkerToken),this._unRegisterWUXEvent(this._registerRemoveSelectedTracksToken),this._unRegisterWUXEvent(this._registerFilterOnSelection),this._registerPreviousMarkerToken=0,this._registerNextMarkerToken=0,this._registerGoToMarkerToken=0,this._registerRemoveSelectedTracksToken=0,this._registerFilterOnSelection=0},addMarkers:function(e){this._view._addMarkers(e)},replayAnimation:function(){this.playGUIMode();var e=this._view;e.isToolbarDisplayed()&&e.isLoopDisplayed()&&e.getPlayButton()&&e.getPlayButton().elements.container.click()},playGUIMode:function(){var e=this._view;e.isToolbarDisplayed()&&e.getPlayButton()&&(e.getPlayButton().icon="play",e.getPlayButton().checkFlag=!1)},pauseGUIMode:function(){var e=this._view;e.isToolbarDisplayed()&&e.getPlayButton()&&(e.getPlayButton().icon="pause",e.getPlayButton().checkFlag=!0)},setAnimationLoopMode:function(e){var t=this._view;t.isToolbarDisplayed()&&t.getLoopButton()&&t.getLoopButton().checkFlag!==e&&(t.getLoopButton().checkFlag=e)},setAnimationBounceMode:function(e){var t=this._view;t.isToolbarDisplayed()&&t.getBounceButton()&&t.getBounceButton().checkFlag!==e&&(t.getBounceButton().checkFlag=e)},setAnimationReverseMode:function(e){var t=this._view;t.isToolbarDisplayed()&&t.getReverseButton()&&t.getReverseButton().checkFlag!==e&&(t.getReverseButton().checkFlag=e)},setCameraPlayMode:function(e){var t=this._view;t.isToolbarDisplayed()&&t.getCameraButton()&&t.getCameraButton().checkFlag!==e&&(t.getCameraButton().checkFlag=e)},setAutoKeyMode:function(e){var t=this._view;t.isToolbarDisplayed()&&t.getAutoKeyButton()&&t.getAutoKeyButton().checkFlag!==e&&(t.getAutoKeyButton().checkFlag=e)},setFilterOnSelectionMode:function(e){var t=this._view;t.isToolbarDisplayed()&&t.getFilterOnSelectionButton()&&t.getFilterOnSelectionButton().checkFlag!==e&&(t.getFilterOnSelectionButton().checkFlag=e)},setIndexValue:function(e){var t=this._view;this._index!==e&&(this._index=e,t.updateModelLocked(!0),t.isSliderDisplayed()&&t.getSlider()&&t.getSlider().getValue()!==parseInt(e)&&t.getSlider().setValue(e),t.isPlayBackDisplayed()&&t.getPlayBack()&&t.getPlayBack().value!=e&&(t.getPlayBack().value=e),t.updateModelLocked(!1))}})}),define("DS/VCXWebTimeline/VCXWebTimelineMainView",["UWA/Element","DS/Layouts/GridEngine","DS/Tree/TreeDocument","DS/Tree/TreeNodeModel","DS/Utilities/RAFDispatcher","DS/Utilities/Utils","DS/VisuEvents/EventsManager","DS/Tree/TreeListView","DS/VCXWebTimeline/VCXWebTimelineView","DS/VCXWebTimeline/VCXWebTimelineCustomTreeNodeView","DS/Core/PointerEvents","DS/CoreEvents/Events","DS/Windows/DockingElement"],function(e,t,i,n,s,o,r,a,l,h,_,c,d){"use strict";return l.extend({init:function(e){this._parent(e),this._targetedTracks=[],this.options=e,this._modelInterface=this.options.modelInterface,this._modelInterface.setNodeModel(n),this._mousePosY=0,this._mousePosX=0,this._mouseDownPosX=0,this._selectionStart={},this._selectionStart.x=0,this._selectionFromY=0,this._selectionEnd={},this._selectionEnd.x=0,this._selectionToY=0,this._sliderPosition=0,this._sliderPreviousPosition=0,this._cellWidthMin=100,this._cellWidthMax=210,this._cellWidth=this._cellWidthMin,this._cells=[],this._stopPan=!1,this._isSliderMinPosition=!0,this._delta=0,this._onePixelInTime=0,this._zoomPixels=10,this._currentFrame=0,this._stepTime=1,this._stepTimeMin=e._stepTimeMin||.1,this._timeMax=parseFloat(this._convertIndexToTime(this._maxFrame)),this._fitMode=!0,this._treeMode=!0,this._listOfRenderedMarkers={},this._listOfFreeMarkers=[],this._markers=[],this._tracksLine=[],this._selectedElement=null,this._timeBarH=0,this._trackH=18,this._timeFrameH=18,this._markerContainerH=20,this._treeW=e.propertiesTreeWidth||150,this._panelBottom=15;var s=this;null===this._parentNode?(this._container=this._createContainer("vcx-timeline VCX_TimelineMain_Container"),this._parentPanel=this._createPanel(this._frmWindow.getImmersiveFrame(),!0,WUXDockAreaEnum.TopDockArea,this._title,this._container,"VCX_TimelineMain_Panel"),this._parentNode=this._parentPanel.elements.container):this._container=this.options.container,this._headerBarContainer=this._createContainer("headerBarContainer").inject(this._parentNode.firstChild),this._headerBarLeft=this._createContainer("headerBarLeft").inject(this._headerBarContainer),this._headerBarRight=this._createContainer("headerBarRight").inject(this._headerBarContainer),this._fitButton=this._createToggle("switch","Fit",!0).inject(this._headerBarRight),this._topContainer=this._createContainer("top"),this._topContainerLeft=this._createContainer("topLeft"),this._topContainerRight=this._createContainer("topRight").inject(this._topContainer),this._mainContainer=this._createContainer("main").inject(this._container),this._markersContainer=this._createContainer("markersContainer").inject(this._topContainerRight),this._markersHelper=this._createContainer("markersHelper").inject(this._markersContainer),this._markersTooltip=this._createContainer("markersTooltip").inject(this._markersContainer),this._timeFrame=this._createContainer("timeFrame").inject(this._topContainerRight),this._grid=this._createContainer("grid"),this._grid.style.position="absolute",this._grid.style.top="40px",this._grid.style.bottom="0px",this._grid.style.right="0px",this._grid.style.left="0px",this._grid.style.backgroundColor="#f1f1f1",this._gridComponentContainer=this._createContainer("gridComponentContainer").inject(this._grid),this._gridComponentContainerRel=this._createContainer("gridComponentContainerRel").inject(this._gridComponentContainer),this._tracksLinesContainer=this._createContainer("tracksLinesContainer").inject(this._grid),this._timeBar=this._createContainer("timeBar"),this._timeBarTooltip=this._createContainer("timeBarTooltip wux-controls-popup"),this._ghostKey=this._createContainer("ghostKey disable"),this.hasSelectedTime=!1,this._selectionStart={},this._selectionEnd={},this._selection=this._createContainer("keySelection").inject(this._gridComponentContainerRel),this._selectionBackground=this._createContainer("keySelectionBackground").inject(this._selection),this._selectionTop=this._createContainer("keySelectionTop").inject(this._selection),this._selectionRight=this._createContainer("keySelectionRight").inject(this._selection),this._selectionBottom=this._createContainer("keySelectionBottom").inject(this._selection),this._selectionLeft=this._createContainer("keySelectionLeft").inject(this._selection),this._selectionBottom.style.bottom="-4px",this._selectionRight.style.right="-4px",this._panelW=parseFloat(this._container.clientWidth,10)-this._treeW,this._leftTreeDockingElement=new d({side:WUXDockAreaEnum.LeftDockArea,collapsibleFlag:!1,collapseDockingZoneFlag:!1,visibleDockingZoneFlag:!0,dockingZoneSize:this._treeW}),this._dockingAreaContainer=new UWA.Element("div",{styles:{position:"absolute",top:0,bottom:0,left:0,right:0}}),this._dockingAreaContainer.inject(this._container),this._leftTreeDockingElement.inject(this._dockingAreaContainer),this._markersContainer.style.height=this._markerContainerH+"px",this._timeFrame.style.height=this._timeFrameH+"px",this._markersHelper.style.height=this._timeFrameH+2+"px",this._topContainerLeft.style.height=this._markerContainerH+this._timeFrameH+2+"px",this._timeBar.style.top=this._markerContainerH+"px",this._markersHelper.style.top=this._markerContainerH+"px",this._markersTooltip.style.top=this._markerContainerH+13+"px",this._markersHelper.style.display="none",this._markersTooltip.style.display="none",this._topContainerLeft.style.backgroundColor="#f1f1f1";for(var l=0;l<10;l++)this._tracksLine[l]=this._createContainer("trackLine").inject(this._tracksLinesContainer),this._tracksLine[l].style.height=this._trackH+"px";for(l=0;l<=this._panelW/this._cellWidthMin*2+1;l++){this._cells[l]=this._createContainer("cell").inject(this._timeFrame),this._createContainer("").inject(this._cells[l]);var c,m=this._createContainer("separator").inject(this._cells[l]);this._createContainer("line").inject(this._cells[l]);for(var u=0;u<10;u++)c=4==u?"middle":"small",this._createContainer(c).inject(m)}this._cellsNumber=this._cells.length,this._zoomCB=o.throttle(function(e){s.zoom(e)},40),this._panCB=o.throttle(function(e){s.pan(e)},30),this._panEndCB=function(e){s.panEnd(e)},this._gridMouseDownCB=function(e){s.gridMouseDown(e)},this._gridMouseRightClickCB=function(e){s.gridMouseRightClick(e)},this._keySelectionStartCB=function(e){s.keySelectionStart(e)},this._keySelectionWhileCB=function(e){s.keySelectionWhile(e)},this._keySelectionEndCB=function(e){s.keySelectionEnd(e)},this._leftBorderDownSelectionCB=function(e){s.leftBorderDownSelection(e)},this._rightBorderDownSelectionCB=function(e){s.rightBorderDownSelection(e)},this._topBorderDownSelectionCB=function(e){s.topBorderDownSelection(e)},this._bottomBorderDownSelectionCB=function(e){s.bottomBorderDownSelection(e)},this._leftBorderMoveSelectionCB=function(e){s.leftBorderMoveSelection(e)},this._rightBorderMoveSelectionCB=function(e){s.rightBorderMoveSelection(e)},this._topBorderMoveSelectionCB=function(e){s.topBorderMoveSelection(e)},this._bottomBorderMoveSelectionCB=function(e){s.bottomBorderMoveSelection(e)},this._leftBorderUpSelectionCB=function(e){s.leftBorderUpSelection(e)},this._rightBorderUpSelectionCB=function(e){s.rightBorderUpSelection(e)},this._topBorderUpSelectionCB=function(e){s.topBorderUpSelection(e)},this._bottomBorderUpSelectionCB=function(e){s.bottomBorderUpSelection(e)};var p=s._selection;this._leftBorderEnterCB=function(e){p.style.borderLeftWidth="2px"},this._rightBorderEnterCB=function(e){p.style.borderRightWidth="2px"},this._topBorderEnterCB=function(e){p.style.borderTopWidth="2px"},this._bottomBorderEnterCB=function(e){p.style.borderBottomWidth="2px"},this._leftBorderLeaveCB=function(e){p.style.borderLeftWidth="1px"},this._rightBorderLeaveCB=function(e){p.style.borderRightWidth="1px"},this._topBorderLeaveCB=function(e){p.style.borderTopWidth="1px"},this._bottomBorderLeaveCB=function(e){p.style.borderBottomWidth="1px"},this._selectionDragStartCB=function(e){s._selection.cacheTimeStart=s._selectionStart.x,s._selection.cacheTimeEnd=s._selectionEnd.x,s._selection.cacheClientX=e.clientX,e.preventDefault(),e.stopImmediatePropagation(),s._selection.addEventListener(_.POINTERUP,s._selectionDragEndCB),s._selection.addEventListener(_.POINTERMOVE,s._selectionDragWhileCB)},this._selectionDragWhileCB=function(e){var t=e.clientX-s._selection.cacheClientX,i=s.getTimeFromPixel(t);s._selectionStart.x=s._selection.cacheTimeStart+i,s._selectionEnd.x=s._selection.cacheTimeEnd+i,s.drawRectangle(s._selectionStart,s._selectionEnd),e.preventDefault(),e.stopImmediatePropagation()},this._selectionDragEndCB=function(e){e.preventDefault(),e.stopImmediatePropagation(),s._selection.removeEventListener(_.POINTERMOVE,s._selectionDragWhileCB),s._selection.removeEventListener(_.POINTERUP,s._selectionDragEndCB);var t={};t.tracks=s._targetedTracks,t.timeInitStart=s._selection.cacheTimeStart,t.timeInitEnd=s._selection.cacheTimeEnd,t.timeFinalStart=s._selectionStart.x,t.timeFinalEnd=s._selectionEnd.x,t.timeToFrame=s.getFrameFromTime(1),t.scenarioID=s.options.scenario,s._sendEvent(s.options.event_selectionAreaMove,t)},this._timeBarMouseOverCB=function(e){s.timeBarMouseOver(e)},this._timeBarMouseLeaveCB=function(e){s.timeBarMouseLeave(e)},this._timeBarMouseDownCB=o.throttle(function(e){s.timeBarMouseDown(e)},30),this._timeBarMouseMoveCB=o.throttle(function(e){s.timeBarMouseMove(e)},30),this._timeBarMouseUpCB=function(e){s.timeBarMouseUp(e)},this._timeBarUpdatePositionCB=function(e){s.timeBarUpdatePosition(e)},this._timeFrameMouseDownCB=function(e){s.timeFrameMouseDown(e)},this._panelWCB=o.throttle(function(e){s.displayFromTo(0,s._timeMax,e)},40),this.panelListener(this),this._keyMouseMoveCB=function(e){s.keyMouseMove(e)},this._keyMoveMouseUpCB=function(e){s.keyMoveMouseUp(e)},this._keyCopyMouseUpCB=function(e){s.keyCopyMouseUp(e)},this._markerMouseDownCB=function(e){s.markerMouseDown(e)},this._markerMouseMoveCB=function(e){s.markerMouseMove(e)},this._markerMouseUpCB=function(e){s.markerMouseUp(e)},this._markerCancelOrRemoveCB=function(e){s.markerCancelOrRemove(e)},this._fitCB=function(e){s._fitMode=e.dsModel.checkFlag,s._fitMode&&(s._sliderPosition=0,s.displayFromTo(0,s._timeMax),s.selectionHide())},this._cancelOrRemoveCB=function(e){s.cancelOrRemove(e)},this._wheelEvt="onwheel"in document.createElement("div")?"wheel":void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll",this._timeBar.addEventListener(this._wheelEvt,this._zoomCB),this._timeBar.addEventListener(_.POINTERDOWN,this._timeBarMouseDownCB),this._timeBar.addEventListener("mouseover",this._timeBarMouseOverCB),this._timeBar.addEventListener("mouseleave",this._timeBarMouseLeaveCB),this._timeFrame.addEventListener(this._wheelEvt,this._zoomCB),this._timeFrame.addEventListener(_.POINTERDOWN,this._timeFrameMouseDownCB),this._gridComponentContainerRel.addEventListener(this._wheelEvt,this._zoomCB),this._gridComponentContainerRel.addEventListener(_.POINTERDOWN,this._gridMouseDownCB),r.addEvent(this._gridComponentContainerRel,"onRightClick",this._gridMouseRightClickCB),this._fitButton.addEventListener("buttonclick",this._fitCB),this._selectionTop.addEventListener("mouseenter",this._topBorderEnterCB),this._selectionRight.addEventListener("mouseenter",this._rightBorderEnterCB),this._selectionBottom.addEventListener("mouseenter",this._bottomBorderEnterCB),this._selectionLeft.addEventListener("mouseenter",this._leftBorderEnterCB),this._selectionTop.addEventListener("mouseleave",this._topBorderLeaveCB),this._selectionRight.addEventListener("mouseleave",this._rightBorderLeaveCB),this._selectionBottom.addEventListener("mouseleave",this._bottomBorderLeaveCB),this._selectionLeft.addEventListener("mouseleave",this._leftBorderLeaveCB),this._selection.addEventListener(_.POINTERDOWN,this._selectionDragStartCB);var v={apiVersion:2,height:"auto",defaultCellHeight:this._trackH,show:{rowHeaders:!1,columnHeaders:!1},columns:[{text:"setKey",dataIndex:"setKey",width:20}],expanderStyle:"triangle",selection:{preSelection:!0,nodes:!0,canMultiSelect:!0,enableListSelection:!0,toggle:!1},cellClass:h};this._trackTreeListViewTracks=new a(v),this._trackTreeListViewTracks.onNodeClick(function(e){if("setKey"===e.dataIndex){var t={};t.trackId=e.nodeModel.options.id,s._sendEvent(s.options.event_addTracksKey,t)}}),v.columns=[{text:"Type",dataIndex:"type",width:"auto"}],this._trackTreeListViewTracksRight=new a(v),this._trackTreeListViewTracksRight.getManager().hideColumn(0),this._trackTreeListViewTracks.getContent().setStyles({zIndex:10});var T=new UWA.Element("div",{}),g=new UWA.Element("div",{styles:{position:"absolute",height:40,left:0,top:0,width:"100%",backgroundColor:"#f1f1f1"}}),f=new UWA.Element("div",{class:"vcx-tracks",styles:{position:"absolute",top:40,bottom:0,left:0,right:0}});g.inject(T),f.inject(T),this._trackTreeListViewTracks.inject(f),this._leftTreeDockingElement.dockingZoneContent=T;var C=new UWA.Element("div",{styles:{position:"absolute",width:"100%",height:"100%",left:"5px"}});this._trackTreeListViewTracksRight.inject(this._gridComponentContainerRel),this._timeBarTooltip.inject(C),this._timeBar.inject(C),this._topContainer.inject(C),this._grid.inject(C),this._leftTreeDockingElement.freeZoneContent=C;this._trackTreeListViewTracks.getManager();this._timelineTreeDocument=new i({}),this._timelineTreeDocument.lock=0,this._timelineTreeDocument.prepareUpdate(),this._modelInterface.generateTracksData(this._timelineTreeDocument),this._timelineTreeDocument.pushUpdate(),this._trackTreeListViewTracks.getManager().loadDocument(this._timelineTreeDocument),this._trackTreeListViewTracksRight.getManager().loadDocument(this._timelineTreeDocument),this._displayedTracks=this.getDisplayedTracks(),this._bigData=this._modelInterface._generateGridData(this._displayedTracks,this._maxFrame),this.grid=new t({model:this._bigData,showRowsHeader:!1,showColumnsHeader:!1,defaultCellWidth:this._cellWidth,defaultCellHeight:this._trackH,headersDimensions:{width:40,height:20},height:"auto",performances:{useRequestAnimationFrameRendering:!0}}).inject(this._gridComponentContainerRel),this.grid.onCellRequest(function(e){}),this.grid.onReady(function(){!1!==s.isVisible()&&(s.updatePanelHeight(),s.updateTracksLine(),s.displayFromTo(0,s._timeMax))}),s._trackTreeListViewTracks.getManager().onReady(function(){s&&s._trackTreeListViewTracks&&(s._trackTreeListViewTracks.getManager().getScroller().onScroll(function(){var e={x:s.grid.getScrollerPosition().x,y:s._trackTreeListViewTracks.getManager().getScrollerPosition().y};s.grid.setScrollerPosition(e,!0),s._trackTreeListViewTracksRight.getManager().getScroller().setPosition(e,!0)}),s._trackTreeListViewTracks.getManager().getScroller().onScrollEnd(function(){var e={x:s.grid.getScrollerPosition().x,y:s._trackTreeListViewTracks.getManager().getScrollerPosition().y};s.grid.setScrollerPosition(e,!0),s._trackTreeListViewTracksRight.getManager().getScroller().setPosition(e,!0)}))}),this._markersLayer=this._createContainer("keys-layer").inject(this.grid.elements.poolContainerRel),this._ghostKey.inject(this._markersLayer),this._tracksTreeDocument=new i({shouldBeEditable:function(e){return!1}}),this._timelineTreeDocument.updateNumberTracksDisplayed=function(){s.updateNumberTracksDisplayed()},this._timelineTreeDocument.getXSO().onChange(function(){if(s._timelineTreeDocument.getXSO().get().length>0)s._timelineTreeDocument.getXSO().get()[0]}),this._parentPanel&&(s._parentPanel.onExpandPanel=function(){s._parentPanel&&s._parentPanel.onRedrawLauncher()},s._parentPanel.onCollapsePanel=function(){s._parentPanel},s._parentPanel.onRedrawLauncher=function(){s.updateOnePixel(),s.updateTimeBar(s._currentFrame),s.updateMarkersPosition(),s.onRedraw()});var k=this._parentPanel.immersiveFrame.getDockingElement(this._parentPanel.currentDockArea);k&&(k.addEventListener("expand",s._parentPanel.onExpandPanel.bind(s)),k.addEventListener("collapse",s._parentPanel.onCollapsePanel)),this._timelineTreeDocument.dirty=!0,this._trackTreeListViewTracks.getManager().onPostUpdateView(s._parentPanel.onRedrawLauncher)},unInitialize:function(){if(this._parentPanel){var e=this._parentPanel.immersiveFrame.getDockingElement(this._parentPanel.currentDockArea);e&&e.removeEventListener("expand",this._parentPanel.onRedrawLauncher)}if(this._parent(),this._timeFrame.removeEventListener(this._wheelEvt,this._zoomCB),this._timeFrame.removeEventListener(_.POINTERDOWN,this._timeFrameMouseDownCB),this._timeBar.removeEventListener(_.POINTERDOWN,this._timeBarMouseDownCB),this._timeBar.removeEventListener("mouseover",this._timeBarMouseOverCB),this._timeBar.removeEventListener("mouseleave",this._timeBarMouseLeaveCB),this._timeBar.removeEventListener(this._wheelEvt,this._zoomCB),this._selectionTop.removeEventListener("mouseenter",this._topBorderEnterCB),this._selectionRight.removeEventListener("mouseenter",this._rightBorderEnterCB),this._selectionBottom.removeEventListener("mouseenter",this._bottomBorderEnterCB),this._selectionLeft.removeEventListener("mouseenter",this._leftBorderEnterCB),this._selectionTop.removeEventListener("mouseleave",this._topBorderLeaveCB),this._selectionRight.removeEventListener("mouseleave",this._rightBorderLeaveCB),this._selectionBottom.removeEventListener("mouseleave",this._bottomBorderLeaveCB),this._selectionLeft.removeEventListener("mouseleave",this._leftBorderLeaveCB),this._selection.removeEventListener(_.POINTERDOWN,this._selectionDragStartCB),this._gridComponentContainerRel.removeEventListener(this._wheelEvt,this._zoomCB),this._gridComponentContainerRel.removeEventListener(_.POINTERDOWN,this._timeFrameMouseDownCB),this._fitButton.elements.buttonSwitch.removeEventListener("buttonclick",this._fitCB),this._zoomCB=0,this._panCB=0,this._panEndCB=0,this._timeFrameMouseDownCB=0,this._panelWCB=0,this._timeBarMouseOverCB=0,this._timeBarMouseLeaveCB=0,this._timeBarMouseDownCB=0,this._timeBarMouseMoveCB=0,this._timeBarMouseUpCB=0,this._timeBarUpdatePositionCB=0,this._keyMouseMoveCB=0,this._keyMoveMouseUpCB=0,this._keyCopyMouseUpCB=0,this._cancelOrRemoveCB=0,this._fitCB=0,this._markerMouseDownCB=0,this._markerMouseMoveCB=0,this._markerMouseUpCB=0,this._markerCancelOrRemoveCB=0,this._keySelectionStartCB=0,this._keySelectionWhileCB=0,this._keySelectionEndCB=0,this._leftBorderEnterCB=0,this._rightBorderEnterCB=0,this._topBorderEnterCB=0,this._bottomBorderEnterCB=0,this._leftBorderLeaveCB=0,this._rightBorderLeaveCB=0,this._topBorderLeaveCB=0,this._bottomBorderLeaveCB=0,this._leftBorderDownSelectionCB=0,this._rightBorderDownSelectionCB=0,this._topBorderDownSelectionCB=0,this._bottomBorderDownSelectionCB=0,this._leftBorderMoveSelectionCB=0,this._rightBorderMoveSelectionCB=0,this._topBorderMoveSelectionCB=0,this._bottomBorderMoveSelectionCB=0,this._leftBorderUpSelectionCB=0,this._rightBorderUpSelectionCB=0,this._topBorderUpSelectionCB=0,this._bottomBorderUpSelectionCB=0,this._timelineTreeDocument._cleanBindingOnDocument?this._timelineTreeDocument._cleanBindingOnDocument():this._timelineTreeDocument._cleanBindings&&this._timelineTreeDocument._cleanBindings(),this._timelineTreeDocument.empty(),this._timelineTreeDocument=null,this._trackTreeListViewTracks.getManager().unloadDocument(),this._trackTreeListViewTracks=null,this.grid=null,this.tree){var t=this.tree.getDocument();t._cleanBindingOnDocument?t._cleanBindingOnDocument():t._cleanBindings&&t._cleanBindings(),t.empty();var i=this.tree.getManager();i.unloadDocument(),this.tree.destroy(),t.options=t.defaultOptions,i.options=i.defaultOptions,this.tree.options=this.tree.defaultOptions,this.tree=null}this._targetedTracks=null,this.options=null,this._modelInterface=null,this._selectionStart=null,this._selectionEnd=null,this._cells=null,this._listOfRenderedMarkers=null,this._listOfFreeMarkers=null,this._selectedElement=null;this._container&&this._container.destroy(),this._parentNode&&this._parentNode.destroy(),this._headerBarContainer&&this._headerBarContainer.destroy(),this._headerBarLeft&&this._headerBarLeft.destroy(),this._headerBarRight&&this._headerBarRight.destroy(),this._container=null,this._parentNode=null,this._headerBarContainer=null,this._headerBarLeft=null,this._headerBarRight=null,this._fitButton&&this._fitButton.destroy(),this._fitButton=null,this._topContainer&&this._topContainer.destroy(),this._topContainerLeft&&this._topContainerLeft.destroy(),this._topContainerRight&&this._topContainerRight.destroy(),this._mainContainer&&this._mainContainer.destroy(),this._topContainer=null,this._topContainerLeft=null,this._topContainerRight=null,this._mainContainer=null,this._markersContainer&&this._markersContainer.destroy(),this._markersHelper&&this._markersHelper.destroy(),this._markersTooltip&&this._markersTooltip.destroy(),this._timeFrame&&this._timeFrame.destroy(),this._markersContainer=null,this._markersHelper=null,this._markersTooltip=null,this._timeFrame=null,this._grid&&this._grid.destroy(),this._gridComponentContainer&&this._gridComponentContainer.destroy(),this._gridComponentContainerRel&&this._gridComponentContainerRel.destroy(),this._grid=null,this._gridComponentContainer=null,this._gridComponentContainerRel=null,this._timeBar&&this._timeBar.destroy(),this._timeBarTooltip&&this._timeBarTooltip.destroy(),this._timeBar=null,this._timeBarTooltip=null,this._ghostKey&&this._ghostKey.destroy(),this._ghostKey=null,this._selection&&this._selection.destroy(),this._selectionBackground&&this._selectionBackground.destroy(),this._selectionTop&&this._selectionTop.destroy(),this._selectionRight&&this._selectionRight.destroy(),this._selectionBottom&&this._selectionBottom.destroy(),this._selectionLeft&&this._selectionLeft.destroy(),this._selection=null,this._selectionBackground=null,this._selectionTop=null,this._selectionRight=null,this._selectionBottom=null,this._selectionLeft=null;var n=0;if(this._cells)for(n=0;n<this._cells.length;++n)this._cells[n].destroy();if(this._tracksLine){for(n=0;n<this._tracksLine.length;++n)this._tracksLine[n].destroy();this._tracksLinesContainer&&this._tracksLinesContainer.destroy(),this._tracksLine=null,this._tracksLinesContainer=null}this._leftTreeDockingElement&&this._leftTreeDockingElement.destroy(),this._dockingAreaContainer&&this._dockingAreaContainer.destroy(),this._leftTreeDockingElement=null,this._dockingAreaContainer=null},panelListener:function(e){this._mutationTarget=this._parentNode.firstChild,this._observer=new MutationObserver(function(t){t.forEach(function(t){if(t.target===e._mutationTarget){var i=parseInt(t.oldValue.match(/\d+/)[0]),n=parseInt(e._mutationTarget.style.width.match(/\d+/)[0]);if(i!==n){var s=n>=i;e._panelW=e._parentNode.clientWidth-e._treeW,e._panelW>0&&e._fitMode&&e._panelWCB(s)}}})}),this._observerConfig={attributes:!0,childList:!1,characterData:!1,subtree:!1,attributeOldValue:!0,attributeFilter:["style"]},this._mutationTarget&&this._observer.observe(this._mutationTarget,this._observerConfig)},updatePanelHeight:function(){this.getDisplayedTracks(),this._trackH,this._timeFrameH,this._markerContainerH,this._panelBottom;!this._parentNode||this._parentNode.parentNode},updateTimeFrame:function(e){this._delta+=e,this._delta=parseFloat(this._delta.toFixed(1));for(var t=0;t<this._cellsNumber;t++)this._cells[t].style.left=parseFloat(this._cells[t].style.left,10)+e+"px";if(0==this._delta||Math.abs(this._delta)>=this._cellWidth){this._delta%=this._cellWidth,this._delta=parseFloat(this._delta.toFixed(1));var i=this._delta-this._cellWidth,n=this.getTimeFromPixel(this._sliderPosition+i);n=Math.round(n/this._stepTime)*this._stepTime,this.updateCells(n,i)}},timeFrameMouseDown:function(e){this._mousePosX=e.clientX,this._mouseDownPosX=e.clientX,this._sliderPreviousPosition=this._sliderPosition;var t=e.clientX-this._timeFrame.getBoundingClientRect().left;if(2===e.which)this.setFitMode(!1),document.addEventListener(_.POINTERMOVE,this._panCB),document.addEventListener(_.POINTERUP,this._panEndCB);else if(1===e.which){this._timeBar.classList.add("timeBarTransition"),this._timeBarTooltip.style.display="inline-block";var i=this.getTimeFromPixel(this._sliderPosition+t),n=parseInt(Math.round(this.getFrameFromTime(i)));this._sendEvent(this.options.event_timePosChangeWhile,n),document.addEventListener(_.POINTERMOVE,this._timeBarMouseMoveCB),document.addEventListener(_.POINTERUP,this._timeBarMouseUpCB)}},pan:function(e){if(this._isSliderMinPosition&&this._mouseDownPosX<=e.clientX)this._stopPan=!0;else{this._mousePosX=this._stopPan?this._mouseDownPosX:this._mousePosX;var t=e.clientX-this._mousePosX,i=t>0;if(this._mousePosX=e.clientX,this._stopPan=!1,this._isSliderMinPosition=!!i&&this._isSliderMinPosition,this._sliderPosition=this._sliderPreviousPosition+(this._mouseDownPosX-this._mousePosX),this._sliderPosition=parseFloat(this._sliderPosition.toFixed(1)),this._sliderPosition<=0&&(this._isSliderMinPosition=!0,t+=this._sliderPosition,this._sliderPosition=0),this.updateTimeFrame(t),this.updateTimeBar(this._currentFrame),this.updateMarkersPosition(),this.updateGrid(),this.hasSelectedTime){var n={x:this._selectionStart.x,y:this._selectionFromY},s={x:this._selectionEnd.x,y:this._selectionToY};this.drawRectangle(n,s)}}},panEnd:function(e){document.removeEventListener(_.POINTERMOVE,this._panCB),document.removeEventListener(_.POINTERUP,this._panEndCB)},zoom:function(e){this.setFitMode(!1),"mousewheel"===e.type&&(e.deltaY=-e.wheelDelta);var t=e.deltaY<=0;if(t&&(this._isSliderMinPosition=!1),!(this._stepTime<=this._stepTimeMin&&this._cellWidth==this._cellWidthMax&&t)){var i=e.clientX-this._timeFrame.getBoundingClientRect().left,n=(i+(this._delta>0?this._cellWidth-this._delta:-this._delta))%this._cellWidth,s=parseFloat(this.getTimeFromPixel(this._sliderPosition+i).toFixed(3));if(s<.3&&(s=0),t&&this._cellWidth>=this._cellWidthMax||!t&&this._cellWidth<=this._cellWidthMin){if(!t&&this._isSliderMinPosition)s=0;else var o=s%this._stepTime,r=s-o,a=i-this.getPixelFromTime(o);this._stepTime=this.updateStepTime(this._stepTime,t),this._cellWidth=t?this._cellWidthMin:this._cellWidthMax}else{a=i-n,r=this.getTimeFromPixel(this._sliderPosition+a);if(r=Math.round(r/this._stepTime)*this._stepTime,this._cellWidth+=t?this._zoomPixels:-this._zoomPixels,!t&&this._isSliderMinPosition)a-=5;else{var l=parseFloat((n/this._cellWidth).toFixed(2)),h=Math.round(this._zoomPixels*l);a+=t?-h:h}}if(this._sliderPosition=Math.round(this.getPixelFromTime(s)-i),this._sliderPosition<=0?(this._sliderPosition=0,this._delta=0,this._isSliderMinPosition=!0,r=-this._stepTime,a=-this._cellWidth):this._delta=this._cellWidth-this._sliderPosition%this._cellWidth,a>=0){var _=Math.ceil(a/this._cellWidth);a-=_*this._cellWidth,r-=_*this._stepTime}if(a=Math.round(a),this.updateOnePixel(),this.updateTimeBar(this._currentFrame),this.updateMarkersPosition(),this.updateCells(r,a),this.updateGrid(),this.hasSelectedTime){var c={x:this._selectionStart.x,y:this._selectionFromY},d={x:this._selectionEnd.x,y:this._selectionToY};this.drawRectangle(c,d)}}},selectionHide:function(){this.hasSelectedTime=!1,this._selectionStart={},this._selectionEnd={},this._selection.style.opacity="0",this._selection.style.pointerEvents="none",this._selectionTop.style.opacity="0",this._selectionBottom.style.opacity="0",this._selectionLeft.style.opacity="0",this._selectionRight.style.opacity="0"},selectionShow:function(){this.hasSelectedTime=!0,this._selection.style.opacity="1",this._selection.style.pointerEvents=""},gridMouseDown:function(e){if(this.getTrackTreeListView().getManager().unselectAll(),this._mousePosY=e.clientY,this._mousePosX=e.clientX,this._mouseDownPosX=e.clientX,this._sliderPreviousPosition=this._sliderPosition,2===e.which)this.setFitMode(!1),document.addEventListener(_.POINTERMOVE,this._panCB),document.addEventListener(_.POINTERUP,this._panEndCB);else if(1===e.which)if(this.selectionHide(),e.path&&e.path[0].hasClassName("key")){var t=e.path[0];e.stopPropagation();this._selectedElement=t,this._ghostKey.classList.remove("disable"),this._selectedElement.markerModel.select(!0),this._selectedElement.style.opacity=.4,this._ghostKey.style.cssText=document.defaultView.getComputedStyle(t,"").cssText,document.addEventListener(_.POINTERMOVE,this._keyMouseMoveCB),document.addEventListener("keydown",this._cancelOrRemoveCB),e.ctrlKey||e.shiftKey?document.addEventListener(_.POINTERUP,this._keyCopyMouseUpCB):document.addEventListener(_.POINTERUP,this._keyMoveMouseUpCB)}else document.addEventListener(_.POINTERUP,this._timeBarUpdatePositionCB),document.addEventListener(_.POINTERMOVE,this._keySelectionStartCB);else e.eventType},gridMouseRightClick:function(e){if(e.from&&e.from[0].path&&e.from[0].path[0].hasClassName("key")){var t=e.from[0].path[0];this._selectedElement=t,this._actionsOnKeys(e.from[0].event,"delete")}},keySelectionStart:function(e){document.removeEventListener(_.POINTERUP,this._timeBarUpdatePositionCB),document.removeEventListener(_.POINTERMOVE,this._keySelectionStartCB),document.addEventListener(_.POINTERMOVE,this._keySelectionWhileCB),document.addEventListener(_.POINTERUP,this._keySelectionEndCB);var t=e.clientX-this._timeFrame.getBoundingClientRect().left,i=this.getTimeFromPixel(this._sliderPosition+t);this._selectionStart.x=i,this._selectionFromY=e.clientY,this.selectionShow(),this._targetedTracks=[]},keySelectionWhile:function(e){this._selectionFromY=this._mousePosY<=e.clientY?this._mousePosY:e.clientY,this._selectionToY=this._mousePosY<=e.clientY?e.clientY:this._mousePosY;var t=e.clientX-this._timeFrame.getBoundingClientRect().left,i=this.getTimeFromPixel(this._sliderPosition+t);this._selectionEnd.x=i;var n={x:this._selectionStart.x,y:this._selectionFromY},s={x:this._selectionEnd.x,y:this._selectionToY};this.drawRectangle(n,s)},drawRectangle:function(e,t){e.x=Math.max(0,e.x);var i=this._timeFrame.getBoundingClientRect().top,n=e.y-i-this._timeFrameH,s=t.y-i-this._timeFrameH;n<0?n=0:s>this._displayedTracks*this._trackH&&(s=this._displayedTracks*this._trackH);var o=Math.max(0,parseInt(Math.round(this.getFrameFromTime(e.x)))),r=this.getTimeFromFrame(o),a=this.getPixelFromTime(r)-this._sliderPosition,l=Math.max(0,parseInt(Math.round(this.getFrameFromTime(t.x)))),h=this.getTimeFromFrame(l),_=this.getPixelFromTime(h)-this._sliderPosition;e.y<=t.y?(e.y=Math.floor(n/this._trackH)*this._trackH,t.y=Math.ceil(s/this._trackH)*this._trackH):(e.y=Math.ceil(n/this._trackH)*this._trackH,t.y=Math.floor(s/this._trackH)*this._trackH);var c=Math.min(a,_),d=Math.min(e.y,t.y),m=Math.abs(a-_),u=Math.abs(e.y-t.y);this._selection.style.width=m+"px",this._selection.style.height=u+"px",this._selection.style.left=c+"px",this._selection.style.top=d+"px",this.displayBars(c,d,m,u),e.y=this._selectionFromY,t.y=this._selectionToY,this._selectionStart=e,this._selectionEnd=t},displayBars:function(e,t,i,n){},keySelectionEnd:function(e){var t=Math.min(this._selectionStart.x,this._selectionEnd.x),i=Math.max(this._selectionStart.x,this._selectionEnd.x);this._selectionStart.x=t,this._selectionEnd.x=i,document.removeEventListener(_.POINTERMOVE,this._keySelectionWhileCB),document.removeEventListener(_.POINTERUP,this._keySelectionEndCB),this._selectionLeft.addEventListener(_.POINTERDOWN,this._leftBorderDownSelectionCB),this._selectionRight.addEventListener(_.POINTERDOWN,this._rightBorderDownSelectionCB),this._selectionTop.addEventListener(_.POINTERDOWN,this._topBorderDownSelectionCB),this._selectionBottom.addEventListener(_.POINTERDOWN,this._bottomBorderDownSelectionCB),this.findTargetedTracks(this._selectionStart,this._selectionEnd);var n={};n.tracks=this._targetedTracks,n.frameStart=this._selectionStart.x,n.frameEnd=this._selectionEnd.x,this._sendEvent(this.options.event_selectionArea,n)},leftBorderDownSelection:function(e){e.stopPropagation(),document.addEventListener(_.POINTERMOVE,this._leftBorderMoveSelectionCB),document.addEventListener(_.POINTERUP,this._leftBorderUpSelectionCB),this._selection.cacheTimeStart=this._selectionStart.x,this._selection.cacheTimeEnd=this._selectionEnd.x},rightBorderDownSelection:function(e){e.stopPropagation(),document.addEventListener(_.POINTERMOVE,this._rightBorderMoveSelectionCB),document.addEventListener(_.POINTERUP,this._rightBorderUpSelectionCB),this._selection.cacheTimeStart=this._selectionStart.x,this._selection.cacheTimeEnd=this._selectionEnd.x},topBorderDownSelection:function(e){e.stopPropagation(),document.addEventListener(_.POINTERMOVE,this._topBorderMoveSelectionCB),document.addEventListener(_.POINTERUP,this._topBorderUpSelectionCB)},bottomBorderDownSelection:function(e){e.stopPropagation(),document.addEventListener(_.POINTERMOVE,this._bottomBorderMoveSelectionCB),document.addEventListener(_.POINTERUP,this._bottomBorderUpSelectionCB)},leftBorderMoveSelection:function(e){this._selectionStart.x=this.getTimeFromPixel(e.clientX-this._timeFrame.getBoundingClientRect().left+this._sliderPosition);var t={x:this._selectionStart.x,y:this._selectionFromY},i={x:this._selectionEnd.x,y:this._selectionToY};this.drawRectangle(t,i)},rightBorderMoveSelection:function(e){this._selectionEnd.x=this.getTimeFromPixel(e.clientX-this._timeFrame.getBoundingClientRect().left+this._sliderPosition);var t={x:this._selectionStart.x,y:this._selectionFromY},i={x:this._selectionEnd.x,y:this._selectionToY};this.drawRectangle(t,i)},topBorderMoveSelection:function(e){e.clientY<this._selectionToY?this._selectionFromY=e.clientY:(this._selectionFromY=this._selectionToY,this._selectionToY=e.clientY);var t={x:this._selectionStart.x,y:this._selectionFromY},i={x:this._selectionEnd.x,y:this._selectionToY};this.drawRectangle(t,i)},bottomBorderMoveSelection:function(e){e.clientY>this._selectionFromY?this._selectionToY=e.clientY:(this._selectionToY=this._selectionFromY,this._selectionFromY=e.clientY);var t={x:this._selectionStart.x,y:this._selectionFromY},i={x:this._selectionEnd.x,y:this._selectionToY};this.drawRectangle(t,i)},leftBorderUpSelection:function(e){document.removeEventListener(_.POINTERMOVE,this._leftBorderMoveSelectionCB),document.removeEventListener(_.POINTERUP,this._leftBorderUpSelectionCB);var t=Math.min(this._selectionStart.x,this._selectionEnd.x),i=Math.max(this._selectionStart.x,this._selectionEnd.x);this._selectionStart.x=t,this._selectionEnd.x=i;var n={};n.tracks=this._targetedTracks,n.timeInitStart=this._selection.cacheTimeStart,n.timeInitEnd=this._selection.cacheTimeEnd,n.timeFinalStart=this._selectionStart.x,n.timeFinalEnd=this._selectionEnd.x,n.timeToFrame=this.getFrameFromTime(1),n.scenarioID=this.options.scenario,this._sendEvent(this.options.event_selectionAreaMove,n)},rightBorderUpSelection:function(e){document.removeEventListener(_.POINTERMOVE,this._rightBorderMoveSelectionCB),document.removeEventListener(_.POINTERUP,this._rightBorderUpSelectionCB);var t=Math.min(this._selectionStart.x,this._selectionEnd.x),i=Math.max(this._selectionStart.x,this._selectionEnd.x);this._selectionStart.x=t,this._selectionEnd.x=i;var n={};n.tracks=this._targetedTracks,n.timeInitStart=this._selection.cacheTimeStart,n.timeInitEnd=this._selection.cacheTimeEnd,n.timeFinalStart=this._selectionStart.x,n.timeFinalEnd=this._selectionEnd.x,n.timeToFrame=this.getFrameFromTime(1),n.scenarioID=this.options.scenario,this._sendEvent(this.options.event_selectionAreaMove,n)},topBorderUpSelection:function(e){document.removeEventListener(_.POINTERMOVE,this._topBorderMoveSelectionCB),document.removeEventListener(_.POINTERUP,this._topBorderUpSelectionCB)},bottomBorderUpSelection:function(e){document.removeEventListener(_.POINTERMOVE,this._bottomBorderMoveSelectionCB),document.removeEventListener(_.POINTERUP,this._bottomBorderUpSelectionCB)},findTargetedTracks:function(e,t){for(var i=Math.min(e.y,t.y),n=Math.max(e.y,t.y)+2,s=(this._trackTreeListViewTracks._datagrid.options.defaultCellHeight,null),o=i;o<=n;o+=1){var r=this.getTrackNodeModelFromPosition({x:parseInt(this.getPixelFromTime(this.getTimeFromFrame(e.x))),y:o});if(r&&-1==this._targetedTracks.indexOf(r)){if(4==r._rowID&&!r._isExpanded){s=r;continue}this._targetedTracks.push(r)}}s&&this._targetedTracks.push.apply(this._targetedTracks,s._options.children)},selectTracks:function(e){},getTrackNodeModelFromPosition:function(e){var t,i=this._trackTreeListViewTracks._datagrid.elements.container.getBoundingClientRect(),n=document.elementFromPoint(i.left+.5*(i.right-i.left),e.y),s=(t="wux-datagrid-cell",(" "+n.className+" ").replace(/[\n\t]/g," ").indexOf(" "+t+" ")>-1?n:function e(t,i){var n=t;return n?(" "+n.className+" ").replace(/[\n\t]/g," ").indexOf(" "+i+" ")>-1?n:e(n.parentNode,i):void 0}(n,"wux-datagrid-cell"));return void 0===s?null:this._trackTreeListViewTracks._datagrid._cellsManager._getCellInfosFromDom(s,!0).nodeModel},geTracksNodeModelFromSelection:function(){},timeBarUpdatePosition:function(e){var t=e.clientX-this._timeFrame.getBoundingClientRect().left,i=this.getTimeFromPixel(this._sliderPosition+t),n=parseInt(Math.round(this.getFrameFromTime(i)));this._sendEvent(this.options.event_timePosChangeWhile,n),document.removeEventListener(_.POINTERUP,this._timeBarUpdatePositionCB),document.removeEventListener(_.POINTERMOVE,this._keySelectionStartCB)},updateVerticalGridSeparatorHeight:function(){for(var e=this._timeFrame.querySelectorAll(".line"),t=this._displayedTracks*this._trackH,i=0;i<e.length;i++)e[i].style.height=t+"px"},keyMouseMove:function(e){var t=this._scrollTimelineOnX(e,"key");this.updatePosition(t,this._ghostKey)},keyMoveMouseUp:function(e){this._selectedElement.markerModel.selected=!1,this._ghostKey.classList.add("disable"),this._actionsOnKeys(e,"move"),document.removeEventListener("onkeydown",this._cancelOrRemoveCB),document.removeEventListener(_.POINTERMOVE,this._keyMouseMoveCB),document.removeEventListener(_.POINTERUP,this._keyMoveMouseUpCB)},keyCopyMouseUp:function(e){this._ghostKey.classList.add("disable"),this._actionsOnKeys(e,"copy"),document.removeEventListener("onkeydown",this._cancelOrRemoveCB),document.removeEventListener(_.POINTERMOVE,this._keyMouseMoveCB),document.removeEventListener(_.POINTERUP,this._keyCopyMouseUpCB)},cancelOrRemove:function(e){27!==e.keyCode&&46!==e.keyCode||(27===e.keyCode?this._ghostKey.classList.add("disable"):(this._ghostKey.classList.add("disable"),this._actionsOnKeys("delete")),document.removeEventListener(_.POINTERMOVE,this._keyMouseMoveCB),document.removeEventListener(_.POINTERUP,this._keyMoveMouseUpCB),document.removeEventListener(_.POINTERUP,this._keyCopyMouseUpCB),document.removeEventListener("onkeydown",this._cancelOrRemoveCB))},_actionsOnKeys:function(e,t){this._selectedElement&&(this._selectedElement.markerModel.selected=!1);var i=e.clientX-this._timeFrame.getBoundingClientRect().left,n=this.getTimeFromPixel(this._sliderPosition+i),s=parseInt(this.getFrameFromTime(n));s>this._maxFrame&&(this._maxFrame=s);var o=-1;if(!0===this._modelInterface.options.flattenKeys){var r=this.getTrackNodeModelFromPosition({x:i,y:this._selectedElement.getBoundingClientRect().bottom});r&&(o=r.options.id)}this._modelInterface.actionsOnKeys(e,t,this._selectedElement.markerModel,this._selectedElement.markerModel.options.markerBeginTime,s,this.options.scenario,o)},markerMouseDown:function(e){this._mousePosX=e.clientX,this._selectedElement=this.getMarkerObjSelected(e.target);var t=this._mousePosX-this._timeFrame.getBoundingClientRect().left,i=this.getTimeFromPixel(this._sliderPosition+t),n=Math.round(this.getFrameFromTime(i));i=this.getTimeFromFrame(n),this._markersHelper.style.left=this._selectedElement.div.style.left,this._markersTooltip.style.left=parseFloat(this._selectedElement.div.style.left)+5+"px",this._markersTooltip.innerText=this._convertIndexToDisplayTime(n)+" ("+parseInt(n)+")",this._markersHelper.style.display="block",this._markersTooltip.style.display="block",this._selectedElement.div.style.opacity=.6,this._selectedElement.selected=!0,document.addEventListener("keydown",this._markerCancelOrRemoveCB),document.addEventListener(_.POINTERMOVE,this._markerMouseMoveCB),document.addEventListener(_.POINTERUP,this._markerMouseUpCB)},getMarkerObjSelected:function(e){for(var t=this._markers.length,i=0;i<t;i++)if(e.isEqualNode(this._markers[i].div))return this._markers[i]},markerMouseMove:function(e){var t=this._scrollTimelineOnX(e,"marker");this.updatePosition(t,this._selectedElement.div);var i=this.getTimeFromPixel(this._sliderPosition+t),n=parseInt(Math.round(this.getFrameFromTime(i)));n<0&&(n=0),i=this.getTimeFromFrame(n),this._markersHelper.style.left=this._selectedElement.div.style.left,this._markersTooltip.style.left=parseFloat(this._selectedElement.div.style.left)+5+"px",this._markersTooltip.innerText=this._convertIndexToDisplayTime(n)+" ("+parseInt(n)+")"},markerMouseUp:function(e){this._selectedElement.div.style.opacity=1;var t=e.clientX-this._timeFrame.getBoundingClientRect().left,i=this.updatePosition(t,this._selectedElement.div);this._selectedElement.selected=!1,this._selectedElement.frame=i,this._markersHelper.style.display="none",this._markersTooltip.style.display="none",document.removeEventListener("keydown",this._markerCancelOrRemoveCB),document.removeEventListener(_.POINTERMOVE,this._markerMouseMoveCB),document.removeEventListener(_.POINTERUP,this._markerMouseUpCB)},markerCancelOrRemove:function(e){if(27===e.keyCode||46===e.keyCode){if(27===e.keyCode)this._selectedElement.div.style.opacity=1,this._selectedElement.selected=!1;else{this._selectedElement.div.remove();for(var t=0;t<this._markers.length;t++)if(this._markers[t].selected){this._markers.splice(t,1);break}}this._selectedElement=null,this.updateMarkersPosition(),this._markersHelper.style.display="none",this._markersTooltip.style.display="none",document.removeEventListener("keydown",this._markerCancelOrRemoveCB),document.removeEventListener(_.POINTERMOVE,this._markerMouseMoveCB),document.removeEventListener(_.POINTERUP,this._markerMouseUpCB)}},_createMarker:function(e,t,i,n,s){var o=this._createContainer("wux-Gauge-scale-label"),r=this.getTimeFromFrame(t),a=this.getPixelFromTime(r)-this._sliderPosition;o.style.left=a+"px",o.style.marginTop="16px",o.addEventListener(_.POINTERDOWN,this._markerMouseDownCB);var l=document.createAttribute("marker-type");l.value=i,o.setAttributeNode(l),o.title=n,o.inject(this._markersContainer);var h={div:o,id:e,frame:t,type:i,selected:!1,component:s};this._markers.push(h)},updateMarkersPosition:function(){for(var e=this._markers.length,t=0;t<e;t++)if(!this._markers[t].selected){var i=this.getTimeFromFrame(this._markers[t].frame),n=this.getPixelFromTime(i)-this._sliderPosition;this._markers[t].div.style.left=n+"px"}},timeBarMouseDown:function(e){this._timeBarTooltip.style.display="inline-block",this._mousePosX=e.clientX,document.addEventListener(_.POINTERMOVE,this._timeBarMouseMoveCB),document.addEventListener(_.POINTERUP,this._timeBarMouseUpCB),this._sendEvent(this.options.event_timePosChangeStart)},timeBarMouseMove:function(e){this._timeBar.classList.remove("timeBarTransition");var t=this._scrollTimelineOnX(e,"timebar"),i=this.getTimeFromPixel(this._sliderPosition+t),n=Math.max(0,parseInt(Math.round(this.getFrameFromTime(i))));n>=0&&this._sendEvent(this.options.event_timePosChangeWhile,n)},timeBarMouseOver:function(e){1!==e.which&&(this._timeBarTooltip.style.display="inline-block")},timeBarMouseLeave:function(e){1!==e.which&&(this._timeBarTooltip.style.display="none")},timeBarMouseUp:function(e){this._timeBarTooltip.style.display="none",document.removeEventListener(_.POINTERMOVE,this._timeBarMouseMoveCB),document.removeEventListener(_.POINTERUP,this._timeBarMouseUpCB);var t=this._scrollTimelineOnX(e,"timebar"),i=Math.max(0,this.getTimeFromPixel(this._sliderPosition+t)),n=parseInt(Math.round(this.getFrameFromTime(i)));this._sendEvent(this.options.event_timePosChangeEnd,n)},updateTimeBar:function(e){if(!1!==this.isVisible()){e=e<0?0:e,this._currentFrame=e;var t=this.getTimeFromFrame(e),i=this.getPixelFromTime(t)-this._sliderPosition;this._timeBarH=(this._displayedTracks+1)*this._trackH,this._timeBar.style.height!==this._timeBarH+"px"&&(this._timeBar.style.height=this._timeBarH+"px"),i<=0&&0!=this._sliderPosition?"none"!==this._timeBar.style.display&&(this._timeBar.style.display="none",this._timeBarTooltip.style.display="none"):this._timeBar.style.left!==i+"px"&&(this._timeBar.style.display="block",this._timeBar.style.left=i+"px",this._timeBarTooltip.style.left=i+parseInt(this._timeBar.style.width)+"px");var n=this._convertIndexToDisplayTime(e)+" ("+parseInt(e)+")";this._timeBarTooltip.innerText!==n&&(Number.isNaN(n)?console.error("_timeBarTooltip is corrupted, for frame "+e):this._timeBarTooltip.innerText=n)}},setFitMode:function(e){this._fitMode=e,this._fitButton.checkFlag=e},getDisplayedTracks:function(){for(var e=this._timelineTreeDocument.getRoots(),t=0,i=0;i<e.length;i++)t+=this.getDisplayedTracksChild(e[i]);return t},getTrackTreeListView:function(){return this._trackTreeListViewTracks},getTimelineModel:function(){return this._timelineTreeDocument},getDisplayedTracksChild:function(e){var t=0;if(e&&(t++,"collapseState"==e._expandState))for(var i=e.options.children,n=0;n<i.length;n++)t+=this.getDisplayedTracksChild(i[n]);return t},updateNumberTracksDisplayed:function(){this._displayedTracks=this.getDisplayedTracks();var e={};e.numberOfRows=this._displayedTracks,e.numberOfColumns=this._maxFrame,this._bigData=this._modelInterface._generateGridData(this._displayedTracks,this._maxFrame),this.grid._destroyPool(),this.grid.updateModel(this._bigData),this.updatePanelHeight(),this.updateTimeBar(this._currentFrame),this.updateVerticalGridSeparatorHeight(),this.updateTracksLine()},updateTracksLine:function(){var e=this._displayedTracks-this._tracksLine.length;if(e>0)for(var t=0;t<e;t++){var i=this._createContainer("trackLine").inject(this._tracksLinesContainer);this._tracksLine.push(i)}for(t=0;t<this._tracksLine.length;t++)this._tracksLine[t].style.display=t<this._displayedTracks?"block":"none"},displayFromTo:function(e,t,i){this._isSliderMinPosition=e<=0,this.findStepTime(this._panelW,t,i),this._delta=0,this.updateOnePixel(),this.updateTimeBar(this._currentFrame),this.updateVerticalGridSeparatorHeight(),this.updateMarkersPosition(),this.updateCells(e-this._stepTime,-this._cellWidth),this._sliderPosition=this.getPixelFromTime(e),this._sliderPosition=parseFloat(this._sliderPosition.toFixed(1)),this.updateGrid()},updatePosition:function(e,t){var i=this.getTimeFromPixel(this._sliderPosition+e);i=this.getTimeFromFrame(Math.round(this.getFrameFromTime(i)));var n=this.getPixelFromTime(i)-this._sliderPosition;return t.style.left=n<=0?"0px":n+"px",Math.round(this.getFrameFromTime(i))},_scrollTimelineOnX:function(e,t){var i=e.clientX>this._mousePosX;this._mousePosX=e.clientX;var n=this._mousePosX-this._timeFrame.getBoundingClientRect().left,s=100*parseFloat((n/this._panelW).toFixed(2)),o=s>=90&&i,r=s<=10&&!i&&this._sliderPosition>0;if(o||r){var a=o?89-s:11-s;a>this._sliderPosition&&(a=this._sliderPosition,this._isSliderMinPosition=!0),this.updateTimeFrame(a),this._sliderPosition-=a,this.updateMarkersPosition(),"timebar"!=t&&this.updateTimeBar(this._currentFrame),this.updateGrid()}return n},updateCells:function(e,t){var i=0,n=0;e=parseFloat(e.toPrecision(12));for(var s=0;s<this._cellsNumber;s++)this._cells[s].style.width=this._cellWidth+"px",n=t+s*this._cellWidth,n=parseFloat(n.toFixed(3)),this._cells[s].style.left=n+"px",i=e+s*this._stepTime,(i=parseFloat(i.toPrecision(12)))<0?this._cells[s].style.display="none":(this._cells[s].style.display="block",this._updateCellValue(i,this._cells[s].children[0]))},_updateCellValue:function(e,t){if(void 0!==t){var i,n,s=0,o=0;e>=86400?(s=0==(o=e%86400)?e/86400:o/3600,i=0==o?"d":"h",n=0==o?"day":"hour"):e>=3600?(s=0==(o=e%3600)?e/3600:o/60,i=0==o?"h":"min",n=0==o?"hour":"min"):e>=60?(s=0==(o=e%60)?e/60:o,i=0==o?"min":"s",n=0==o?"min":"sec"):0==(o=1e3*e%1e3)?(s=e,i="s",n="sec"):(o%500==0||o%250==0||o%100==0?(s=o,n="dc"):o%50==0||o%25==0||o%10==0?(s=o.toString().substring(1),n="ct"):(s=o.toString().substring(2),n="ms"),i="ms"),t.innerText=s+""+i,t.className=n}},getTimeFromFrame:function(e){return e*this._timeMax/this._maxFrame},getFrameFromTime:function(e){return e*this._maxFrame/this._timeMax},getPixelFromTime:function(e){return e*this._cellWidth/this._stepTime},getTimeFromPixel:function(e){return e*this._stepTime/this._cellWidth},getFrameFromPixels:function(e){return 0},getPixelFromFrame:function(e){return 0},updateOnePixel:function(){this._onePixelInTime=this.getFrameFromTime(this._stepTime/this._cellWidth),this._timeBar&&(this._timeBar.style.width=1/this._onePixelInTime+"px")},findStepTime:function(e,t,i){var n,s,o=Math.ceil(t/this._stepTime);for(void 0===i&&(i=this.getTimeFromPixel(e)>t);;){if(n=this._cellWidthMin*o,s=this._cellWidthMax*o,e>=n&&e<=s)return this.findCellWidth(e,o);if(!i&&e>s)return this.findCellWidth(e,o);if(i&&e<n)return this._stepTime=this.updateStepTime(this._stepTime,!1),o=Math.ceil(t/this._stepTime),this.findCellWidth(e,o);this._stepTime=this.updateStepTime(this._stepTime,i),o=Math.ceil(t/this._stepTime)}},findCellWidth:function(e,t){for(var i=this._cellWidthMin;i<=this._cellWidthMax;i+=this._zoomPixels){if(i*t>e)return;this._cellWidth=i}},updateStepTime:function(e,t){var i=0,n=e<1;return i=e<.001?1e4:e<.01?1e3:e<.1?100:e<1?10:e<60?1:e<3600?60:e<86400?3600:86400,n?(e*=i,i=1/i):e/=i,n?.001!=i?1==e?e=t?.5:2.5:2.5==e?e=t?1:5:5==e?e=t?2.5:10:10==e&&(e=t?5:10):1==e?e*=t?.5:2:2==e?e=t?1:5:5==e?e=t?1:10:10==e&&(e=t?5:10):i<=60?e<=1?e*=t?.5:2:2==e?e=t?1:5:5==e?e=t?2:10:10==e?e=t?5:15:15==e?e=t?10:20:20==e?e=t?15:30:30==e?e=t?20:60:t&&60==e&&(e=30):1==e?e=t?1:2:2==e?e=t?1:4:4==e?e=t?2:8:8==e?e=t?4:12:12==e?e=t?8:24:e+=t?-24:24,e*i},getSelectedTime:function(){if(!this.hasSelectedTime)return null;var e={};return e.start=parseInt(Math.round(this.getFrameFromTime(this._selectionStart.x))),e.end=parseInt(Math.round(this.getFrameFromTime(this._selectionEnd.x))),e.targetedTracks=this._targetedTracks,e},elementInViewport2:function(e,t){var i=t.x,n=t.w;return i<e.x+e.w&&i+n>e.x},updateGrid:function(){var e=this._sliderPosition;this._timelineTreeDocument.prepareUpdate(),this.renderMarkers(e),this.grid.setScrollerPosition({x:e,y:this.grid.getScrollerPosition().y},!0),this._timelineTreeDocument.pushUpdate()},onRedraw:function(){!1!==this.isVisible()&&this._timelineTreeDocument&&this._timelineTreeDocument.dirty&&0===this._timelineTreeDocument.lock&&(this.updateNumberTracksDisplayed(),this.renderMarkers(this._sliderPosition),this._timelineTreeDocument.dirty=!1)},renderMarkers:function(e){for(var t in this._listOfRenderedMarkers)this._listOfFreeMarkers.push(this._listOfRenderedMarkers[t]),this._listOfRenderedMarkers[t].remove(),delete this._listOfRenderedMarkers[t];this.grid.getVirtualViewport();var i,n=this._timelineTreeDocument.getRoots();for(i=0;i<=n.length;i++){var s=this._timelineTreeDocument.getRoots()[i];s&&this.drawTracksKeys(e,s,this.grid,this._onePixelInTime,!0)}},removeKey:function(e){if(e){var t="node_"+e._getID(),i=this._listOfRenderedMarkers[t];void 0!==i&&(this._listOfFreeMarkers.push(i),delete this._listOfRenderedMarkers[t]),e.remove()}},emptyMarkers:function(){for(var e in this._listOfRenderedMarkers){var t=this._listOfRenderedMarkers[e];t.markerModel=[],this._listOfFreeMarkers.push(t),t.remove(),delete this._listOfRenderedMarkers[e]}},drawTracksKeys:function(e,t,i,n,o){if(!this._timelineTreeDocument.lock){var r=this,a=t._rowID;null===a&&(a=t._parentNode._rowID),null===a&&(a=t._parentNode._parentNode._rowID);var l=t.getChildren()||[],h=t._options.preventDisplayChilds||t.hasChildren()||!1,_=t._options.preventDisplayChilds||"expandState"!==t._expandState&&o,c=a;if(h){for(var d=0;d<l.length;d++){l[d].hasChildren();c=this.drawTracksKeys(e,l[d],i,n,o)}_&&(a=c)}else{var m=t,u="node_"+m._getID();void 0!==r._listOfRenderedMarkers[u]&&(r._listOfFreeMarkers.push(r._listOfRenderedMarkers[u]),r._listOfRenderedMarkers[u].remove(),delete r._listOfRenderedMarkers[u]);var p=m.options.markerBeginTime/r._onePixelInTime,v=m.options.markerDuration/r._onePixelInTime;(!r.grid._scrollerDimensions||r.elementInViewport2({x:e,w:r.grid._scrollerDimensions.width},{x:p,w:v}))&&s.addTask({callback:function(e,t,i,n){if(!1!==r.isVisible()){var s,o="node_"+e._getID();void 0===r._listOfRenderedMarkers[o]?((s=r._listOfFreeMarkers.length>0?r._listOfFreeMarkers.pop():new UWA.Element("div",{class:"key",styles:{position:"absolute",height:r._trackH-6,top:n*r._trackH+3,left:i,width:t,background:e.options.markerColor}})).markerModel=e,s.inject(r._markersLayer),r._listOfRenderedMarkers[o]=s):s=r._listOfRenderedMarkers[o],s.setStyles({top:n*r._trackH+3,left:i,width:t,background:e.options.markerColor,opacity:e.isSelected()?.4:1}),s.title=e.options.markerBeginTime,s.track=e.options.idGroup}else this.destroy()},taskArgs:[m,v,p,a]},u)}return a}}})}),define("DS/VCXWebTimeline/VCXWebTimelineMain",["DS/VCXWebTimeline/VCXWebTimeline","DS/VCXWebTimeline/VCXWebTimelineMainView","DS/VCXWebTimeline/VCXWebTimelineLight"],function(e,t,i){"use strict";return e.extend({init:function(e){this._parent(e),this._view=new t(e);var n=Object.assign({},e,e.toolbar);n.parent||(n.parent=this.getView().getParentNode().getElementsByClassName("headerBarLeft")[0]),this._toolbar=new i(n)},unInitialize:function(){this._toolbar.unInitialize(),this._toolbar=null,this._parent()},setIndexValue:function(e){this._index!==e&&(this._index=e,this.getView().updateTimeBar(e))},setAnimationLoopMode:function(e){this._toolbar.setAnimationLoopMode(e)},setAnimationBounceMode:function(e){this._toolbar.setAnimationBounceMode(e)},setAnimationReverseMode:function(e){this._toolbar.setAnimationReverseMode(e)},setCameraPlayMode:function(e){this._toolbar.setCameraPlayMode(e)},setAutoKeyMode:function(e){this._toolbar.setAutoKeyMode(e)},getView:function(){return this._view},addMarkers:function(e){for(var t=0;t<e.length;t++)this.getView()._createMarker(e[t].id,e[t].frame,e[t].type,e[t].name,e[t].component)},pauseGUIMode:function(){this._toolbar.pauseGUIMode()},playGUIMode:function(){this._toolbar.playGUIMode()},replayAnimation:function(){this._toolbar.replayAnimation()},updateGrid:function(){this.getView().updateGrid()},onRedraw:function(){this.getView().onRedraw()},removeKey:function(e){this.getView().removeKey(e)},emptyMarkers:function(){this.getView().emptyMarkers()},getTrackTreeListView:function(){return this.getView().getTrackTreeListView()},getTimelineModel:function(){return this.getView().getTimelineModel()},getSelectedTime:function(){return this.getView().getSelectedTime()}})});var VCXWebTimelineGUIEnum={Light:0,Main:1,Master:2};define("DS/VCXWebTimeline/VCXWebTimelineController",["UWA/Class","UWA/Element","DS/CoreEvents/Events","DS/Utilities/Color","DS/VCXWebTimeline/VCXWebTimelineLight","DS/VCXWebTimeline/VCXWebTimelineMain","DS/ApplicationFrame/CommandsManager"],function(e,t,i,n,s,o,r){"use strict";return e.extend({init:function(e){var t=this;this.options=e,void 0===this.options.flattenKeys&&(this.options.flattenKeys=!0),this.flattenKeysArray=[],this.listTracks=[],this.selectedTracks=[],this._nodeClass=null,this._isAnimationLoop=!1,this._isAnimationBounce=!1,this._isAnimationReverse=!1,this._isCameraPlayMode=!0,this._isAutoKeyMode=!1,this._isFilterOnSelectionMode=!1,this._timelines=[],this._startChangeTime=!0,this.options.event_timePosChangeStart="VCX_Timeline_TIMEPOS_CHANGE_START",this.options.event_timePosChangeWhile="VCX_Timeline_TIMEPOS_CHANGE_WHILE",this.options.event_timePosChangeEnd="VCX_Timeline_TIMEPOS_CHANGE_END",this.options.event_play="VCX_Timeline_START_PLAY",this.options.event_pause="VCX_Timeline_PAUSE_PLAY",this.options.event_stop="VCX_Timeline_STOP_PLAY",this.options.event_stepBackward="VCX_Timeline_STEPBACKWARD_PLAY",this.options.event_stepForward="VCX_Timeline_STEPFORWARD_PLAY",this.options.event_loop="VCX_Timeline_Loop",this.options.event_bounce="VCX_Timeline_Bounce",this.options.event_reverse="VCX_Timeline_Reverse",this.options.event_previousMarker="VCX_Timeline_PREVIOUSMARKER_PLAY",this.options.event_nextMarker="VCX_Timeline_NEXTMARKER_PLAY",this.options.event_camera="VCX_Timeline_CAMERA_PLAY",this.options.event_goToMarker="VCX_Timeline_GO_TO_MARKER",this.options.event_removeSelectedTracks="VCX_Timeline_RemoveSelectedTracks",this.options.event_filterOnSelection="VCX_Timeline_FilterOnSelection",this.options.event_autoKey="VCX_Timeline_AutoKey",this.options.event_selectionArea="VCX_Timeline_SELECTION_AREA",this.options.event_selectionAreaMove="VCX_Timeline_SELECTION_AREA_MOVE",this.options.event_addTracksKey="VCX_Timeline_AddTracksKey",this._VCX_Timeline_TIMEPOS_CHANGE_START=i.subscribe({event:this.options.event_timePosChangeStart},function(e){t.onTimePosChangeStart(e)}),this._VCX_Timeline_TIMEPOS_CHANGE_WHILE=i.subscribe({event:this.options.event_timePosChangeWhile},function(e){t.onTimePosChangeWhile(e)}),this._VCX_Timeline_TIMEPOS_CHANGE_END=i.subscribe({event:this.options.event_timePosChangeEnd},function(e){t.onTimePosChangeEnd(e)}),this._VCX_Timeline_START_PLAY=i.subscribe({event:this.options.event_play},function(){t.onStartPlay()}),this._VCX_Timeline_PAUSE_PLAY=i.subscribe({event:this.options.event_pause},function(){t.onPausePlay()}),this._VCX_Timeline_STOP_PLAY=i.subscribe({event:this.options.event_stop},function(){t.onStopPlay()}),this._VCX_Timeline_STEPBACKWARD_PLAY=i.subscribe({event:this.options.event_stepBackward},function(){t.onTimelineStepBackward()}),this._VCX_Timeline_STEPFORWARD_PLAY=i.subscribe({event:this.options.event_stepForward},function(){t.onTimelineStepForward()}),this._VCX_Timeline_CAMERA_PLAY=i.subscribe({event:this.options.event_camera},function(e){t.onTimelineCamera(e)}),this._VCX_Timeline_AutoKey=i.subscribe({event:this.options.event_autoKey},function(e){t.onTimelineAutoKey(e)}),this._VCX_Timeline_PREVIOUSMARKER_PLAY=i.subscribe({event:this.options.event_previousMarker},function(){t.OnTimelinePreviousMarker()}),this._VCX_Timeline_NEXTMARKER_PLAY=i.subscribe({event:this.options.event_nextMarker},function(){t.onTimelineNextMarker()}),this._VCX_Timeline_GO_TO_MARKER=i.subscribe({event:this.options.event_goToMarker},function(e){t.onTimelineGoToMarker(e)}),this._VCX_Timeline_RemoveSelectedTracks=i.subscribe({event:this.options.event_removeSelectedTracks},function(){t.getTimelineModel().dirty=!1,t.emptyMarkers(!1),t.onRemoveSelectedTracks(),t.getTimelineModel().prepareUpdate(),t.generateListOfMarkers(),t.getTimelineModel().pushUpdate(),t.getTimelineModel().dirty=!0,t.onRedraw()}),this._VCX_Timeline_FilterOnSelection=i.subscribe({event:this.options.event_filterOnSelection},function(e){t.onToggleFilterOnSelection(e)}),this._tokenSelectionAdd=i.subscribe({event:"VCX_SELECTION_COMPONENTSLIST_ADD"},function(){t.onCSOChange()}),this._tokenSelectionRemove=i.subscribe({event:"VCX_SELECTION_COMPONENTSLIST_REMOVE"},function(){t.onCSOChange()}),this._VCX_Timeline_LOOP=i.subscribe({event:this.options.event_loop},function(e){t.setTimelineLoop(e)}),this._VCX_Timeline_BOUNCE=i.subscribe({event:this.options.event_bounce},function(e){t.setTimelineBounce(e)}),this._VCX_Timeline_REVERSE=i.subscribe({event:this.options.event_reverse},function(e){t.setTimelineReverse(e)}),this._VCX_Timeline_SELECTION_AREA=i.subscribe({event:this.options.event_selectionArea},function(e){t.onSelectionArea(e)}),this._VCX_Timeline_SELECTION_AREA_MOVE=i.subscribe({event:this.options.event_selectionAreaMove},function(e){t.onSelectionAreaMove(e)}),this._VCX_Timeline_ADD_TRACKS_KEY=i.subscribe({event:this.options.event_addTracksKey},function(e){t.onAddTracksKey(e)})},createTimeline:function(e){e.modelInterface=this;var t=Object.assign({},this.options,e),i=null;if(e.timelineGUI===VCXWebTimelineGUIEnum.Light)i=new s(t);else if(e.timelineGUI===VCXWebTimelineGUIEnum.Main)i=new o(t);else if(e.timelineGUI!==VCXWebTimelineGUIEnum.Master)return;var n={timeline:i,options:e};this._timelines.push(n),e.timelineGUI===VCXWebTimelineGUIEnum.Main&&(i.getTrackTreeListView().getDocument().getPXSO().onAdd(function(e){if(e.options.data&&e.options.data.pathElement){var t=e.options.data.pathElement;WUX.Selection.PSOManager.add({pathElement:t})}}),i.getTrackTreeListView().getDocument().getPXSO().onRemove(function(e){if(e.options.data&&e.options.data.pathElement){var t=e.options.data.pathElement;WUX.Selection.PSOManager.remove({pathElement:t})}}),i.getTrackTreeListView().getDocument().getXSO().onAdd(function(e){if(e.options.data&&e.options.data.pathElement){var t=e.options.data.pathElement;WUX.Selection.CSOManager.add({pathElement:t})}}),i.getTrackTreeListView().getDocument().getXSO().onRemove(function(e){if(e.options.data&&e.options.data.pathElement){var t=e.options.data.pathElement;WUX.Selection.CSOManager.remove({pathElement:t})}}))},getTrackTreeListView:function(){return console.error("VCXWebTimelineController::getTrackTreeListView() must be implemented on app's side"),null},getTimelineModel:function(){return console.error("VCXWebTimelineController::getTimelineModel() must be implemented on app's side"),null},unInitialize:function(){this.selectedTracks=[],this.emptyMarkers(),this.emptyTreeTracks(),this.RemoveTimelineEvents();for(var e=0;e<this._timelines.length;e++)this._timelines[e].timeline.unInitialize(),this._timelines[e].timeline=null,this._timelines[e].options=null;this._timelines=[]},addMarkers:function(e){for(var t=0;t<this._timelines.length;t++)this._timelines[t].timeline.addMarkers(e)},setIndexValue:function(e){for(var t=0;t<this._timelines.length;t++)this._timelines[t].timeline.setIndexValue(e)},getSelectedTime:function(){for(var e={},t=0;t<this._timelines.length;t++)if(e=this._timelines[t].timeline.getSelectedTime())return e;return null},setAnimationLoopMode:function(e){if(this._isAnimationLoop!==e){this._isAnimationLoop=e;for(var t=0;t<this._timelines.length;t++)this._timelines[t].timeline.setAnimationLoopMode(e)}},setAnimationBounceMode:function(e){if(this._isAnimationBounce!==e){this._isAnimationBounce=e;for(var t=0;t<this._timelines.length;t++)this._timelines[t].timeline.setAnimationBounceMode(e)}},setAnimationReverseMode:function(e){if(this._isAnimationReverse!==e){this._isAnimationReverse=e;for(var t=0;t<this._timelines.length;t++)this._timelines[t].timeline.setAnimationReverseMode(e)}},setCameraPlayMode:function(e){if(this._isCameraPlayMode!==e){this._isCameraPlayMode=e;for(var t=0;t<this._timelines.length;t++)this._timelines[t].timeline.setCameraPlayMode(e)}},setAutoKeyMode:function(e){if(this._isAutoKeyMode!==e){this._isAutoKeyMode=e;for(var t=0;t<this._timelines.length;t++)this._timelines[t].timeline.setAutoKeyMode(e)}},setFilterOnSelectionMode:function(e){this._isFilterOnSelectionMode=e;for(var t=0;t<this._timelines.length;t++)this._timelines[t].timeline.setFilterOnSelectionMode(e)},getFilterOnSelectionMode:function(){return this._isFilterOnSelectionMode},updateTimelineFromModel:function(){var e=this.getFrameFromModel();this.setIndexValue(e),this.setAnimationLoopMode(this._isAnimationLoop),this.setAnimationBounceMode(this._isAnimationBounce),this.setAnimationReverseMode(this._isAnimationReverse),this.setCameraPlayMode(this._isCameraPlayMode)},RemoveTimelineEvents:function(){i.unsubscribe(this._VCX_Timeline_TIMEPOS_CHANGE_START),i.unsubscribe(this._VCX_Timeline_TIMEPOS_CHANGE_WHILE),i.unsubscribe(this._VCX_Timeline_TIMEPOS_CHANGE_END),i.unsubscribe(this._VCX_Timeline_START_PLAY),i.unsubscribe(this._VCX_Timeline_PAUSE_PLAY),i.unsubscribe(this._VCX_Timeline_STOP_PLAY),i.unsubscribe(this._VCX_Timeline_STEPBACKWARD_PLAY),i.unsubscribe(this._VCX_Timeline_STEPFORWARD_PLAY),i.unsubscribe(this._VCX_Timeline_CAMERA_PLAY),i.unsubscribe(this._VCX_Timeline_AutoKey),i.unsubscribe(this._VCX_Timeline_PREVIOUSMARKER_PLAY),i.unsubscribe(this._VCX_Timeline_NEXTMARKER_PLAY),i.unsubscribe(this._VCX_Timeline_GO_TO_MARKER),i.unsubscribe(this._VCX_Timeline_LOOP),i.unsubscribe(this._VCX_Timeline_BOUNCE),i.unsubscribe(this._VCX_Timeline_REVERSE),i.unsubscribe(this._VCX_Timeline_SELECTION_AREA),i.unsubscribe(this._VCX_Timeline_SELECTION_AREA_MOVE),i.unsubscribe(this._VCX_Timeline_ADD_TRACKS_KEY),i.unsubscribe(this._VCX_Timeline_RemoveSelectedTracks),i.unsubscribe(this._VCX_Timeline_FilterOnSelection),i.unsubscribe(this._tokenSelectionRemove),i.unsubscribe(this._tokenSelectionAdd),this._VCX_Timeline_TIMEPOS_CHANGE_START=0,this._VCX_Timeline_TIMEPOS_CHANGE_WHILE=0,this._VCX_Timeline_TIMEPOS_CHANGE_END=0,this._VCX_Timeline_START_PLAY=0,this._VCX_Timeline_PAUSE_PLAY=0,this._VCX_Timeline_STOP_PLAY=0,this._VCX_Timeline_STEPBACKWARD_PLAY=0,this._VCX_Timeline_STEPFORWARD_PLAY=0,this._VCX_Timeline_CAMERA_PLAY=0,this._VCX_Timeline_AutoKey=0,this._VCX_Timeline_PREVIOUSMARKER_PLAY=0,this._VCX_Timeline_NEXTMARKER_PLAY=0,this._VCX_Timeline_GO_TO_MARKER=0,this._VCX_Timeline_LOOP=0,this._VCX_Timeline_BOUNCE=0,this._VCX_Timeline_REVERSE=0,this._VCX_Timeline_SELECTION_AREA=0,this._VCX_Timeline_SELECTION_AREA_MOVE=0,this._VCX_Timeline_ADD_TRACKS_KEY=0,this._VCX_Timeline_RemoveSelectedTracks=0,this._VCX_Timeline_FilterOnSelection=0,this._tokenSelectionRemove=0,this._tokenSelectionAdd=0},onTimePosChangeStart:function(){},onTimePosChangeWhile:function(e){this.ChangeTimePos(e,!1)},onTimePosChangeEnd:function(e){this.ChangeTimePos(e,!0)},onStartPlay:function(){for(var e=0;e<this._timelines.length;e++)this._timelines[e].timeline.pauseGUIMode()},onStopPlay:function(){for(var e=0;e<this._timelines.length;e++)this._timelines[e].timeline.playGUIMode()},onPausePlay:function(){for(var e=0;e<this._timelines.length;e++)this._timelines[e].timeline.playGUIMode()},setTimelineLoop:function(e){e!=this._isAnimationLoop&&(this.setScenarioAnimationLoop(e),this.setAnimationLoopMode(e))},setTimelineBounce:function(e){e!=this._isAnimationBounce&&(this.setScenarioAnimationBounce(e),this.setAnimationBounceMode(e))},setTimelineReverse:function(e){e!=this._isAnimationReverse&&(this.setScenarioAnimationReverse(e),this.setAnimationReverseMode(e))},setScenarioAnimationLoop:function(e){},setScenarioAnimationBounce:function(e){},setScenarioAnimationReverse:function(e){},onTimelineGoToMarker:function(e){},onRemoveSelectedTracks:function(){var e=this.getTrackTreeListView().getManager().getSelectedCells(),t=this.getSelectedTime();t?this.removeTracksFromModel(t.targetedTracks,t.start,t.end):this.removeTracksFromModel(e)},removeTracksFromModel:function(e,t,i){var n=[],s=this;e.forEach(function(e,o,r){if(void 0!==e._view||!e._manager){var a=e._view?e.getView()._cellInfos.nodeModel:e,l=a.getChildren();if(!1===s.options.flattenKeys){if(a.isRoot()){var h=l;if(h)for(var _=0;_<h.length;_++)n.push(h[_])}else n.push(a);a.remove()}else l&&!a._options.preventDisplayChilds?s.removeTracksFromModel(l):t&&i?s.removeTrackFromModelFlatten(a,t,i):(a.removeChildren(),s.removeTrackFromModelFlatten(a))}},s),this.removeTrackFromModel(n,t,i)},removeTrackFromModel:function(e,t,i){},removeTrackFromModelFlatten:function(e,t,i){},onSelectionArea:function(e){return[]},onSelectionAreaMove:function(e){this.getTimelineModel().dirty=!0,!1===this.options.flattenKeys||this.onSelectionAreaMoveFlatten(e)},moveKeysAreaFromModelFlatten:function(e){},onAddTracksKey:function(e){console.error("VCXWebTimelineController::onAddTracksKey() must be implemented on app's side")},getTrackModelFromTrackNode:function(e){},onTimelineNextMarker:function(){},OnTimelinePreviousMarker:function(){},onTimelineCamera:function(e){this._isCameraPlayMode=e},onTimelineAutoKey:function(e){this._isAutoKeyMode=e;var t=this.options.frmWindow._experienceBase.getManager("VCXContextManager").getContext(),i=r.getCommandCheckHeader("VCXAutoKeyCmd",t);i&&i.setState(this._isAutoKeyMode)},onToggleFilterOnSelection:function(e){this._isFilterOnSelectionMode=e,this.emptyMarkers(),this.generateListOfMarkers(),this.updateGrid()},onCSOChange:function(){this._isFilterOnSelectionMode&&(this.emptyMarkers(),this.generateListOfMarkers(),this.updateGrid()),this.options.flattenKeys},onTimelineStepForward:function(){},onTimelineStepBackward:function(){},ChangeTimePos:function(e,t){},_createTrackNode:function(e,t,i,n,s,o){-1===i&&(i=gridModel.getChildren().length);var r=this,a=new e({label:t,id:i,grid:{type:"",setKey:""}});return n.addChild(a),i++,a.onPostExpand(function(){r.expandCallBack(r.getTimelineModel())}),a.onPostCollapse(function(){r.collapseCallBack(r.getTimelineModel())}),a},expandCallBack:function(e){e.dirty=!0},collapseCallBack:function(e){e.dirty=!0},selectCallBack:function(e){e.select();var t=e.options.id;!1===this.options.flattenKeys&&(t=e.isRoot()?e._localID:e._parentNode._localID+e._localID+1),this.selectedTracks[t]=e},unselectCallBack:function(e){if(e.unselect(),0!==this.selectedTracks.length){var t=e.options.id;!1===this.options.flattenKeys&&(t=e.isRoot()?e._localID:e._parentNode._localID+e._localID+1),this.selectedTracks.splice(t,1)}},clearKeys:function(e,t){},emptyTreeTracks:function(){this.getTrackTreeListView()&&this.getTrackTreeListView().getDocument().empty();this.getTimelineModel()&&this.getTimelineModel().empty()},_generateTreeTracks:function(e){if(e.prepareUpdate(),this.options.flattenKeys)for(var t=0,i=["Position","Materials","Opacity","Camera","Properties"],n=["Links","Viewport","Digger","Others"],s=0;s<i.length;s++){var o=this._createTrackNode(this._nodeClass,i[s],t,e._getTrueRoot());if(t=1+o.options.id,"Properties"===i[s])for(var r=0;r<n.length;r++){var a=this._createTrackNode(this._nodeClass,n[r],t,o);t=1+a.options.id,a._options.preventDisplayChilds=!0}else o._options.preventDisplayChilds=!0}else this.generateClientTreeTracks(e);e.pushUpdate()},emptyMarkers:function(){for(var e=0;e<this._timelines.length;e++)this._timelines[e].timeline.emptyMarkers()},setNodeModel:function(e){this._nodeClass=e},generateTracksData:function(e){this._generateTreeTracks(e),this.generateListOfMarkers(void 0,void 0,void 0,e)},onRedraw:function(){for(var e=0;e<this._timelines.length;e++)this._timelines[e].timeline.onRedraw()},_updateListOfMarkers:function(e,t,i){if(this.getTimelineModel()&&this.getTimelineModel().lock++,void 0!==i){for(var n,s,o,r,a,l,h=this.getTimelineModel(),_=0;_<i.length;_++)if(n=i[_],!0===this.options.flattenKeys&&(s=this.convertTrackToId(n.propertyName,n.modifiable.GetObject().GetType())),o=n.frame,r=n.modifiable.GetHashing(),n.modifiable,a=n.propertyName,l=n.value,n.value){var c="#ababab";1===s&&n.value.GetValue()&&n.value.GetValue().GetColorHexString&&(c="#"+n.value.GetValue().GetColorHexString()),this._addKey(o,1,c,s,r,a,l)}else if(!1===this.options.flattenKeys){for(var d=h.getRoots()||[],m=null,u=null,p=null,v=null,T=0;T<d.length;T++)if((m=d[T]).options._hash===r){u=m.getChildren()||[];for(var g=0;g<u.length;g++)if(u[g].options.label===a){p=u[g].getChildren()||[];for(var f=0;f<p.length;f++){if(p[f]._options.markerBeginTime===o){this.removeKey(p[f]);break}break}break}break}}else{this.flattenKeysArray[s]&&this.flattenKeysArray[s][o]&&this.flattenKeysArray[s][o][a]&&(this.flattenKeysArray[s][o][a]=this.flattenKeysArray[s][o][a].splice(r,1),0===Object.keys(this.flattenKeysArray[s][o][a]).length&&delete this.flattenKeysArray[s][o][a],0===Object.keys(this.flattenKeysArray[s][o]).length&&delete this.flattenKeysArray[s][o]);for(var C=(u=h.search({match:function(e){if(e.nodeModel.options.id===s)return!0}})[0].getChildren()||[]).length-1;C>=0;C--)(v=u[C]).options.markerBeginTime===parseInt(o)&&this.removeKey(v)}this.getTimelineModel()&&(this.getTimelineModel().lock--,this.getTimelineModel().dirty=!0),this.onRedraw()}},_removeMarkers:function(e,t,i,n){for(var s=0;s<e.length;s++){var o=e[s];if(o&&this.listTracks&&o.options.componentHash===n){this.listTracks[t].options.children?(delete e._vcxArrayKeys[i][s],this.listTracks[t].removeChild(o),this.removeKey(o)):(delete this.listTracks[t]._vcxArrayKeys[i][s],this.removeKey(o));break}}},_updateListOfMarkersGroup:function(e,t,i){if(void 0!==i)for(var n,s,o,r,a,l,h=0;h<i.length;h++)if(n=i[h],!0===this.options.flattenKeys&&(t=this.convertTrackToId(n.propertyName,n.modifiable.GetObject().GetType())),s=n.frame,o=n.modifiable.GetHashing(),r=n.modifiable,a=n.propertyName,l=n.value,n.value){var _="#cccccc";3===t&&(_="#"+n.value.GetValue().GetColorHexString()),(u=this._createKey(s,1,_,t,o,r,a,l))._listProperties||(u._listProperties={}),u._listProperties[o]||(u._listProperties[o]={}),u._listProperties[o][a]=!0;var c=!1;void 0===this.listTracks[t]._vcxArrayKeys[s]&&(this.listTracks[t]._vcxArrayKeys[s]=[],c=!0),this.listTracks[t]._vcxArrayKeys[s].push(u),c&&this.listTracks[t].addChild(u)}else{var d=this.listTracks[t]._vcxArrayKeys[s];if(d)for(var m=0;m<d.length;m++){var u;if((u=d[m])&&this.listTracks&&u.options.componentHash===o){this.listTracks[t].options.children&&this.listTracks[t].removeChild(u),delete this.listTracks[t]._vcxArrayKeys[s][m],this.removeKey(u);break}}}},removeKey:function(e){for(var t=0;t<this._timelines.length;t++)this._timelines[t].timeline.removeKey(e)},updateGrid:function(){for(var e=0;e<this._timelines.length;e++)this._timelines[e].timeline.updateGrid()},convertTrackToId:function(e,t){var i=e,n=8;return-1!==i.search("Digger.")||"VCXDigger_Spec"===t?n=7:-1!==i.search("Camera.")||-1!==i.search("Viewpoint.")||"CXPCameraActor_Spec"===t?n=3:-1!==i.search("Viewport.")||"VCXViewport_Spec"===t?n=6:"Actor.Position"===i?n=0:"Actor.Opacity"===i?n=2:"Actor.Color"===i||-1!==i.search("Actor.Env")||-1!==i.search("Actor.Texture")?n=1:"Actor.Hyperlink"===i&&(n=5),n},generateListOfMarkers:function(e,t,i,n){return console.error("VCXWebTimelineController::generateListOfMarkers() must be implemented on app's side"),[]},generateClientTreeTracks:function(e){console.error("VCXWebTimelineController::generateClientTreeTracks() must be implemented on app's side")},_createKey:function(e,t,i,n,s,o,r){return new this._nodeClass({label:e,markerBeginTime:e,markerDuration:t,markerColor:i,idGroup:n,componentHash:s,strPropertyName:o,key:r})},_addKey:function(e,t,i,n,s,o,r,a){if(!0===this.options.flattenKeys){var l=this.flattenKeysArray[n]||[];void 0===l.tracksNames&&(l.tracksNames={}),l[e]=l[e]||[],l[e][o]=l[e][o]||[];var h=l[e][o][s];if(h||(h={length:1,keyColor:i,componentHash:s,strPropertyName:o,data:r},l.tracksNames.strPropertyName=1),l[e][o][s]=h,this.flattenKeysArray[n]=l,Object.keys(l[e]).length>1)return}a=a||this.getTimelineModel();var _=this._createKey(e,t,i,n,s,o,r),c=null;if(!0===this.options.flattenKeys)for(var d=n,m=a.getRoots(),u=0;u<m.length;u++){var p=m[u];if(p._options.id===d){c=p;break}if(4===u)for(var v=a.getNthRoot(u).getChildren(),T=0;T<v.length;T++){var g=v[T];if(g._options.id===d){c=g;break}}}else for(var f=a.getRoots()||[],C=null,k=null,y=0;y<f.length;y++)if((C=f[y]).options._hash===s){k=C.getChildren()||[];for(var B=0;B<k.length;B++)if(k[B].options.label===o){c=k[B];break}break}return!0,c&&(c.addChild(_),this.getTimelineModel()&&(this.getTimelineModel().dirty=!0)),!0},_generateGridData:function(e,t){for(var i=new Array(e),n=0;n<e;n++)i[n]=new Array(t);return i},actionsOnKeys:function(e,t,i,n,s,o,r,a){if(this.getTimelineModel().lock++,!1===this.options.flattenKeys)i._options.key&&(this.getTimelineModel().dirty=!0,this.actionOnKey(t,o,i._options.componentHash,i._options.strPropertyName,n,s,i._options.key.GetValue(),a));else if(4!==r){var l=this.flattenKeysArray[r][n];for(var h in l)for(var _ in l[h])this.getTimelineModel().dirty=!0,this.actionOnKey(t,o,_,h,n,s,l[h][_].data.GetValue(),a)}else for(var c=5;c<9;c++){l=this.flattenKeysArray[c][n];for(var h in l)for(var _ in l[h])this.getTimelineModel().dirty=!0,this.actionOnKey(t,o,_,h,n,s,l[h][_].data.GetValue(),a)}this.getTimelineModel().lock--,this.getTimelineModel().dirty=!0,this.onRedraw()},actionOnKey:function(e,t,i,n,s,o,r){},getFrameFromModel:function(){console.error("VCXWebTimelineController::getFrameFromModel() must be implemented on app's side")},getSelection:function(){console.error("VCXWebTimelineController::getSelection() must be implemented on app's side")},getCurrentSelection:function(){console.error("VCXWebTimelineController::getCurrentSelection() must be implemented on app's side")}})});