define("DS/i3DXCompassMembers/Utils/SpriteManager",["UWA/Core","UWA/Class"],function(t,e){"use strict";return e.extend({spriteParams:[],spriteCache:[],url:null,init:function(t){this.swymUrl=t.url,this.spriteParams=[],this.spriteCache=[]},addItem:function(t){this.spriteParams.push(t)},addCache:function(t){this.spriteCache.push(t)},spritifyElement:function(t,e){var i=100*this.spriteParams.length,n=100/(this.spriteParams.length-1)*e;t.setStyles({"background-image":'url("'+this.getUrl()+'")',"background-size":"100% "+i+"%","background-position":"0px "+n+"%",height:"100%"})},getUrl:function(){return this.url||(this.url=t.String.format("{0}/api/media/streammediasprite/idList/{1}?{2}",this.swymUrl,this.spriteParams.join("="),this.spriteCache.join(""))),this.url}})}),define("DS/i3DXCompassMembers/Views/UserView",["UWA/Core","DS/W3DXComponents/Views/Item/TileView","DS/i3DXCompassCore/Utils","i18n!DS/i3DXCompassMembers/assets/nls/i3DXCompassMembers","UWA/Event"],function(t,e,i,n){"use strict";return e.extend({tagName:"div",name:"platform-management",extendedEvents:!1,getFooterText:function(){var t=null,e=this.model;return e.isCasual()&&(t=n.get("(Casual usage)").format(e.get("casual"))),null!==t?{tag:"div",class:"contractor-text",text:t}:null},getPendingText:function(){var t=null;return this.model.get("active")||(t={tag:"span",text:" "+n.get("(Pending)")}),t},getRoleLabel:function(){var e;if(!this.model.isDeny()&&this.model.isContractor())e={id:"-1",name:n.get("External")};else{var i=this.model.get("role");e=t.Array.detect(this.options.roles,function(t){return t.id===i})}return e&&e.name||""},render:function(){var t=this.model;return this._parent(),this.container.getElement(".tile-content").setContent([{tag:"span",class:!this.model.isDeny()&&this.model.isContractor()?i.getRoleColor("3",!0):i.getRoleColor(t.get("role"),!0),text:this.getRoleLabel()},this.getPendingText(),this.getFooterText()]),this.container.addClassName("user-box grid"),this.container.setAttribute("data-id",t.get("id")),this.container.setAttribute("data-casual",t.get("casual")),this.container.setAttribute("data-type","user"),this.container.setAttribute("data-cross-company",!t.get("licensed")),this.extendedEvents=this._initExtendedEvents(),this._injectPresence(),this},destroy:function(){return this.container&&this.container.getElement(".tile-sub-container")&&this.container.getElement(".tile-sub-container").removeEvent("click"),this._parent()},_injectPresence:function(){var e=this,n=this.model,s=t.createElement("div",{styles:{position:"absolute",bottom:-5,right:-3}});s.inject(this.container.getElement(".platform-management-header")),i.isBetaModeActivated("RTPresence")&&i.getParentModule("DS/RTPresenceAPI/RTPresenceAPI",function(t){new t({login:n.get("id"),button:!1,username:n.getUserFullName(),tenant:e.options.platform,content:s})})},_initExtendedEvents:function(){var t=this;return this.container.getElement(".tile-sub-container").addEvent("click",function(e){t._isActionElement(e.target)||t.container.hasClassName("disabled")||(t.isSelected()?t.unSelect():t.select(),t.options.onSelect&&t.options.onSelect(t.getContent(),t.model))}),!0},_isActionElement:function(t){return t.getParent(".actions-inline-container")||t.hasClassName("actions-inline-container")}})}),define("DS/i3DXCompassMembers/Views/UserRowView",["UWA/Core","UWA/Class/View","DS/i3DXCompassCore/Utils","DS/UIKIT/Input/Toggle","DS/i3DXCompassCore/Model/PreferencesModel","DS/UIKIT/Tooltip","DS/UIKIT/DropdownMenu","UWA/Event","i18n!DS/i3DXCompassMembers/assets/nls/i3DXCompassMembers"],function(t,e,i,n,s,o,a,l,r){"use strict";return e.extend({tagName:"tr",domEvents:{click:"_onClick"},setup:function(){return this.firstRender=!0,this.listenTo(this.model,{onChange:this.render}),this.container.setAttribute("data-type","user"),this.container.setAttribute("data-id",this.model.get("id")),this.container.setAttribute("data-cross-company",!this.model.get("licensed")),this.container.setAttribute("data-casual",this.model.get("casual")),this._parent.apply(this,arguments)},render:function(){return this.container.setContent(this.createContent()),this._injectPresence(),this},getRoleLabel:function(){var e;if(!this.model.isDeny()&&this.model.isContractor())e={id:"-1",name:r.get("External")};else{var i=this.model.get("role");e=t.Array.detect(this.options.roles,function(t){return t.id===i})}return e&&e.name||""},createImage:function(){var t;return this.firstRender&&""!==this.options.getSwymUrl()&&s.shouldLoadPicture()?(t=i.getAsset("s.gif"),this.firstRender=!1):t=this.model.getProfile(s.shouldLoadPicture(),this.options.getSwymUrl()),t},_onClick:function(t){var e=this.getContent(),i=!e.hasClassName("selected");l.stop(t),e.toggleClassName("selected",i),this.toggleSelect.setCheck(i),this.options.onSelect.call(this,e,this.model)},createContent:function(){var e=this.model,s=this.getFooterText(),o=e.getCityFullName(),a=e.getCountryFullName();return this.toggleSelect=new n({className:"primary inline",type:"checkbox",name:"users[]",value:e.get("id"),id:e.get("id"),label:""}),[{tag:"td",html:[this.toggleSelect,{class:"img-wrapper",html:{tag:"img",styles:{height:"100%"},src:this.createImage()}},!1===this.model.get("licensed")?{tag:"i",class:"fonticon fonticon-key"}:null]},{tag:"td",class:"text-ellipsis",html:this.model.get("active")&&e.get("firstname")?t.String.ucfirst(e.get("firstname")):[{tag:"span",text:r.get("Pending")},{tag:"span",html:s}]},{tag:"td",class:"text-ellipsis",html:this.model.get("active")&&e.get("lastname")?[{tag:"span",text:t.String.ucfirst(e.get("lastname"))},{tag:"span",html:s}]:""},{tag:"td",html:[{tag:"span",class:!this.model.isDeny()&&this.model.isContractor()?i.getRoleColor("3",!0):i.getRoleColor(e.get("role"),!0),text:this.getRoleLabel()}]},{tag:"td",class:"text-ellipsis hidden-xs",text:e.get("email")},{tag:"td",class:"text-ellipsis hidden-xs hidden-sm",text:o},{tag:"td",class:"text-ellipsis hidden-xs hidden-sm",text:a},{tag:"td",html:this._buildAction()}]},_injectPresence:function(){var e=this,n=this.model,s=t.createElement("div",{class:"presence-wrapper"});s.inject(this.container.getElement(".img-wrapper")),i.isBetaModeActivated("RTPresence")&&i.getParentModule("DS/RTPresenceAPI/RTPresenceAPI",function(t){new t({login:n.get("id"),button:!1,username:n.getUserFullName(),tenant:e.options.platform,content:s})})},getFooterText:function(){var e=null,i=this.model;return i.isCasual()&&(e=t.String.format(r.get("(Casual usage)"),i.get("casual"))),null!==e?{tag:"span",class:"contractor-text",text:e}:null},_buildAction:function(){var e,i=this,n=this.model;return 1===n.actions.length?e=n.actions.map(function(e){var n=t.createElement("div",{tag:"div",class:"action-container single-action",html:{class:"action-icon-wrapper",html:{tag:"i",class:e.icon}},events:{click:function(t){l.stop(t),i.options.onActionClick(e,i,t)}}});return new o({position:"bottom",target:n,body:e.title}),n}):(e=t.createElement("div",{tag:"div",class:"action-container single-action",html:{class:"action-icon-wrapper",html:{tag:"i",class:"fonticon fonticon-down-open"}},events:{click:function(t){l.stop(t)}}}),new a({target:e,items:n.actions.map(function(t){return{text:t.title,icon:t.icon,handler:function(e){i.options.onActionClick(t,i,e)}}})})),e}})}),define("DS/i3DXCompassMembers/Model/TagModel",["UWA/Core","DS/i3DXCompassCore/Model/i3DXCompassModel"],function(t,e){"use strict";return e.extend({url:"user/tag",parse:function(t){return t}})}),define("DS/i3DXCompassMembers/Utils/TaggerManager",["UWA/Core","UWA/Class","DS/TagNavigatorProxy/TagNavigatorProxy","DS/i3DXCompassMembers/Model/TagModel","i18n!DS/i3DXCompassMembers/assets/nls/i3DXCompassMembers"],function(t,e,i,n,s){"use strict";return e.singleton({model:new n,memberList:null,setup:function(t){return t&&(this.taggerProxy=i.createProxy({widgetId:t.id,filteringMode:"WithFilteringServices",proxyDisplayName:"PlatformManagement-"+t.id,events:{addFilterSubjectsListener:this._addFilterSubjectsListener.bind(this)}})),this},fetch:function(t,e){var i=this;return this.listRoles=t,this.memberList=e,this.taggerProxy&&this.model.fetch({data:{platform:this.memberList.collection.options.data.platform},onComplete:function(){i._buildTags()}}),this},_buildTags:function(){var e=this.taggerProxy,i=e.getCurrentFilter(),n=!1;i&&t.is(i.allfilters,"object")&&(n=Object.keys(i.allfilters).length>0),e&&i&&!n&&e.setSubjectsTags(this._getTags())},_getTags:function(){var e=this,i=this.model,n={},o=this.model.get("locations"),a={roles:{1:i.get("admin"),0:i.get("member"),2:i.get("denied")},status:{0:i.get("active"),1:i.get("pending")},agreements:{0:i.get("employee"),1:i.get("contractor")}};return this.listRoles.roles.forEach(function(i){n=t.merge(n,e._buildTag(a.roles[i.id],i.name,s.get("User rights"),"role-"+i.id))}),this.listRoles.status.forEach(function(i){n=t.merge(n,e._buildTag(a.status[i.id],i.name,s.get("Status"),"status-"+i.id))}),this.listRoles.agreements.forEach(function(i){"0"!==i.id&&(n=t.merge(n,e._buildTag(a.agreements[i.id],i.name,s.get("Agreement"),"agreement-"+i.id)))}),o.forEach(function(i){n=t.merge(n,e._buildTag(i.count,i.tag,t.i18n("Locations"),"location-"+i.id))}),n},_buildTag:function(t,e,i,n){var s,o={};for(s=0;s<t;s++)o[n+"-"+s]=[{object:n,sixw:"ds6w:what",field:"owner",dispValue:e}];return o},_resetCollectionFilter:function(){this.memberList.collection.setParams({access:null,status:null,agreement:null}),this.memberList.collection.setOffset(null)},_convertFilterToParams:function(e){var i,n,s=[],o=[],a=[],l=[];return t.is(e.allfilters)&&t.is(e.allfilters["ds6w:what"])&&e.allfilters["ds6w:what"].length>0&&(e.allfilters["ds6w:what"].forEach(function(t){n=t.object,t.object.contains("role")?s.push(n.replace("role-","")):t.object.contains("status")?a.push(parseInt(n.replace("status-",""),10)):t.object.contains("agreement")?o.push(n.replace("agreement-","")):t.object.contains("location")&&l.push(n.replace("location-",""))}),(s.length>0||a.length>0||o.length>0||l.length>0)&&(i={access:s.join(",")||null,status:a.join(",")||null,agreement:o.join(",")||null,location:l.join(",")||null})),i},syncFilter:function(t){var e,i=this.taggerProxy&&this.taggerProxy.getCurrentFilter?this.taggerProxy.getCurrentFilter():"";this.memberList=t,i&&(e=this._convertFilterToParams(i),i.allfilters&&Object.keys(i.allfilters).length>0&&null===e?this.memberList.collection.setQuery(JSON.stringify(i.allfilters)):this.memberList.collection.setParams(e||{}))},_addFilterSubjectsListener:function(t){var e;this._filter=t,this._resetCollectionFilter(),e=this._convertFilterToParams(t),Object.keys(t.allfilters).length>0&&null===e?this.memberList.collection.setQuery(JSON.stringify(t.allfilters)):this.memberList.collection.setParams(e||{}),this.memberList.refresh()}})}),define("DS/i3DXCompassMembers/MemberList",["UWA/Core","UWA/Class/View","UWA/Class/Model","UWA/Controls/Pager","DS/UIKIT/Touch","DS/UIKIT/Mask","DS/UIKIT/Input/Button","DS/UIKIT/SuperModal","DS/UIKIT/IconDropdown","DS/UIKIT/Iconbar","DS/W3DXComponents/Collections/ActionsCollection","DS/PlatformAPI/PlatformAPI","DS/i3DXCompassCore/Utils","DS/i3DXCompassCore/Model/PreferencesModel","DS/i3DXCompassMembers/Views/UserView","DS/i3DXCompassCmp/Views/TileAddView","DS/i3DXCompassCore/Controls/PlatformNotify","DS/i3DXCompassCore/Collection/MemberCollection","DS/i3DXCompassMembers/Utils/SpriteManager","DS/i3DXCompassMembers/Utils/TaggerManager","DS/i3DXCompassCore/Model/UserRightModel","DS/i3DXCompassMembers/Views/UserRowView","DS/i3DXCompassCmp/Controls/Input/Text","DS/WebappsUtils/WebappsUtils","i18n!DS/i3DXCompassMembers/assets/nls/i3DXCompassMembers"],function(t,e,i,n,s,o,a,l,r,c,m,u,h,d,g,f,p,C,b,y,v,S,D,w,P){"use strict";return e.extend({profileUrl:null,currentUserId:u.getUser().login,forceRefreshView:!1,touchPagerEvent:null,setup:function(t){this._parent(t),this.collection=new C,this.buildContainer()},search:function(t){this.collection.setOffset(0),this.collection.setQuery(t),this.refresh()},refresh:function(t){this.setOptions(t),t&&t.params&&this.collection.setParams(t.params),this.buildContainer()},setTitle:function(e){this.getBody().getElement("h5 span")&&this.getBody().getElement("h5 span").setText(t.String.format(P.get("Members | {0}"),e))},render:function(){this.collection.getMaxLimit()>0?this.getBody().setContent(this.buildContent()):null===this.collection.getQuery()||this.forceRefreshView?this.getBody().setContent(this.buildContent()):(this.collection.setQuery(null),this.setTitle(P.get("No result found"))),this.unmask(),this.forceRefreshView=!1,this.options.onRefresh&&this.options.onRefresh()},getPersistedData:function(t){var e=this,i=0,n=function(){2===++i&&(y.fetch(e.listRoles,e),e.render(),t&&h.scrollToElement(".member-list-wrapper"))};(new v).fetch({onComplete:function(t,i){e.roles=i.roles,e.listRoles=i,n()}}),y.syncFilter(e),this.collection.fetch({onComplete:function(){n()},onFailure:function(){n()}})},getSwymUrl:function(){return""!==this.options.platform.get("swym")?this.profileUrl=this.options.platform.get("swym"):!this.profileUrl&&this.options.platform.collection?this.profileUrl=this.options.platform.collection.at(0).get("swym"):this.profileUrl="",this.profileUrl},buildContainer:function(){var e=this;this.elements.container||(this.elements.container=t.createElement("div",{class:"member-list-wrapper"}),e.elements.container.setContent({class:"empty-body"})),this.mask(),this.options.platform&&null!==this.options.platform&&d.fetch({onComplete:function(){e.collection.setLimit(d.get("membersMaxPerPage")),e.collection.setSortDirection(d.get("membersSortDirection")),e.collection.setSortField(d.get("membersSortField")),e.collection.setPlatform(e.options.platform.getId()),e.getPersistedData()}})},buildTag:function(t,e,i,n){var s,o={};for(s=0;s<t;s++)o[n+"-"+s]=[{object:n,sixw:"ds6w:what",field:"owner",dispValue:e}];return o},buildContent:function(){var t=[];return t.push(this.buildRoleFilter()),t.push(this.buildTitle(this.collection.getMaxLimit())),t.push({class:"pm-grid-container "+(d.isGridLayout()?"layout-grid":"layout-table"),html:[d.isGridLayout()?this.buildTiles():this.createTableView(),this.buildPager()]}),this.initTouchPager(),t},buildAddTile:function(){return new f({lazyLoading:!1,model:new i({fonticon:"fonticon fonticon-user-add fix-alignement",title:P.get("Invite members"),action:function(){this.dispatchEvent("onInviteClick")}.bind(this)}),name:"platform-management",mapping:{}}).render()},createTableView:function(){var t=this,e=new b({url:t.getSwymUrl()}),i=this.collection.map(function(i){return e.addItem(i.getSpriteItem()),e.addCache(!0===i.isContractor()?1:0),"function"==typeof t.options.buildTileActions&&(i.actions=t.options.buildTileActions()),new S({model:i,platform:t.options.platform,roles:t.roles,getSwymUrl:t.getSwymUrl.bind(t),onSelect:t.options.onSelect,onActionClick:function(){this.dispatchEvent("onActionClick",arguments)}.bind(this)}).render()});return""!==t.getSwymUrl()&&d.shouldLoadPicture()&&i.forEach(function(t,i){e.spritifyElement(t.container.getElement("img"),i)}),[new a({value:P.get("Invite members"),icon:"user-add",className:"primary",events:{onClick:function(){this.dispatchEvent("onInviteClick")}.bind(this)}}),{tag:"table",class:"table",html:[{tag:"thead",html:[{tag:"td"},{tag:"td",text:P.get("First Name")},{tag:"td",text:P.get("Last Name")},{tag:"td",text:P.get("User rights")},{tag:"td",text:P.get("Email")},{tag:"td",text:P.get("Details")}]},{tag:"tbody",html:i}]}]},buildTiles:function(){var t=[],e=this,i=new b({url:e.getSwymUrl()});return t.push(e.buildAddTile()),this.collection.forEach(function(n){t.push(e.buildTile(n)),i.addItem(n.getSpriteItem()),i.addCache(!0===n.isContractor()?1:0)}),""!==e.getSwymUrl()&&d.shouldLoadPicture()&&t.forEach(function(t,e){0!==e&&i.spritifyElement(t.container.getElement(".tile-header img"),e-1)}),t},buildTile:function(t){var e=this,i=!0;return"function"==typeof this.options.buildTileActions&&(t.actions=new m(this.options.buildTileActions())),"function"==typeof e.options.manageCasualActivation&&this.listenTo(t,{"onChange:licensed":function(){setTimeout(function(){e.options.manageCasualActivation()},1e3)}}),new g({lazyLoading:!1,model:t,platform:e.options.platform,roles:this.roles,mapping:{title:function(){return this.model.getUserFullName()+(!1===this.model.get("licensed")?'<i class="fonticon fonticon-key"></i>':"")},image:function(){var t;return i&&""!==e.getSwymUrl()&&d.shouldLoadPicture()?(t=w.getWebappsAssetUrl("i3DXCompassCore","s.gif"),i=!1):t=this.model.getProfile(d.shouldLoadPicture(),e.getSwymUrl()),t}},onSelect:e.options.onSelect,events:{onActionClick:function(){this.dispatchEvent("onActionClick",arguments)}.bind(this)}}).render()},buildTitle:function(e){return{tag:"h5",html:[{tag:"i",class:"fonticon fonticon-users"},{tag:"span",text:t.String.format(P.get("Members | {0}"),e)}]}},hasMixedCasualType:function(){var t=this.getBody().getElement('.platform-management-container[data-casual]:not([data-casual="0"])'),e=this.getBody().getElement('.platform-management-container:not([data-casual="0"])');return null!==t&&null!==e},hasMixedCrossCompanyType:function(){var t=this.getBody().getElement('.platform-management-container[data-cross-company="true"]'),e=this.getBody().getElement('.platform-management-container[data-cross-company="false"]');return null!==t&&null!==e},_manageSelectionFilter:function(t,e){var i=this.elements.container.getElements('[data-type="user"] input'),n=this.elements.container.getElement('[data-action="select-mode"]');e.elements.container.removeClassName("selected"),"select-all"===e.action?this.hasMixedCasualType()?new l({closable:!0,renderTo:h.getDocument()}).confirm(P.get("You cannot select different types of casual member"),P.get("Information")):this.hasMixedCrossCompanyType()?new l({closable:!0,renderTo:h.getDocument()}).confirm(P.get("You cannot select different types of assigned member"),P.get("Information")):(n.removeClassName("fonticon-mouse-pointer-check").addClassName("fonticon-files-check").getParent("li").addClassName("item-active"),this.elements.container.getElements('[data-type="user"]').invoke("addClassName","selected"),i&&i.forEach(function(t){t.checked=!0})):(n.removeClassName("fonticon-files-check").addClassName("fonticon-mouse-pointer-check"),this.elements.container.getElements('[data-type="user"].selected').invoke("removeClassName","selected"),i&&i.forEach(function(t){t.checked=!1}),this.options.manageCasualActivation()),this.options.onSelect()},buildRoleFilter:function(){var t=this,e=new D({isCollapsable:!0,minChar:3,attributes:{placeholder:P.get("Search Members"),value:this.collection.getQuery()||"",events:{keyup:function(){t.search(this.value)}}}}),i=new c({items:[{fonticon:"mouse-pointer-check",text:P.get("Manage Selection"),innerComponent:{type:"icondropdown",options:{items:[{action:"select-all",fonticon:"files-check",description:P.get("Select All"),handler:this._manageSelectionFilter.bind(this)},{action:"deselect-all",fonticon:"files-times",description:P.get("Deselect All"),handler:this._manageSelectionFilter.bind(this)}]}}},{fonticon:d.isGridLayout()?"th-list-alt fonticon-interact":"th-list fonticon-interact",text:P.get("Switch View"),handler:function(){d.setLayout(d.isGridLayout()?"table":"grid"),h.getWidget().dispatchEvent("onLoad")}}]});return i.elements.container.getElement(".fonticon").setAttribute("data-action","select-mode"),[{styles:{"padding-right":d.isGridLayout()?15:8,float:"right"},html:i},{styles:{float:"right"},html:e}]},initTouchPager:function(){var t,e=this;!this.touchPagerEvent&&e.pager&&(this.touchPagerEvent=!0,(t=new s(e.getBody())).on("swipeleft",function(){e.collection.hasNext()&&(e.collection.setOffset(e.collection.getNextOffset()),e.pager.setOffset(e.collection.getOffset()))}),t.on("swiperight",function(){e.collection.hasPrevious()&&(e.collection.setOffset(e.collection.getPreviousOffset()),e.pager.setOffset(e.collection.getOffset()))}))},buildPager:function(){var t=this,e=this.collection.getMaxLimit();return e>t.collection.getLimit()?this.pager=new n({limit:t.collection.getLimit(),offset:t.collection.getOffset(),type:1,pageLinks:10,max:e,showPageLinks:!0,length:e,events:{onOffsetChange:function(e){t.mask(),t.collection.setOffset(e),t.getPersistedData(!0)}}}):this.pager=null,this.pager},getBody:function(){return this.content||(this.content=this.elements.container),this.content},mask:function(){this.isMasked()||(o.mask(this.getBody()),this.masked=!0)},unmask:function(){this.isMasked()&&(o.unmask(this.getBody()),this.masked=!1)},isMasked:function(){return this.masked}})});