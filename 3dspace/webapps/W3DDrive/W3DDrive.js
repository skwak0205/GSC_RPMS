define("DS/W3DDrive/Metas/DSDrive/inode",["DS/W3DContentApp/Metas/inode","DS/PlatformAPI/PlatformAPI"],function(e,t){"use strict";return function(){var n=e();Object.assign(n.ids,{root:"DSROOT",sharedWithMe:"sharedwithme",trash:"TRASH",recents:"recents",favorites:"favorites"}),Object.assign(n.mimeType,{folder:"application/folder",labeled:"application/labeled"}),Object.assign(n.actionPubIds,{giveReadAccess:"giveReadAccess",giveEditAccess:"giveEditAccess",giveShareAccess:"giveShareAccess",shareLink:"share.link"}),n.boType={folder:"DriveFolder",document:"DriveFile"};const i=Number(t.getApplicationConfiguration("app.3ddrive.uploadMaxFileSize"));return n.constants={maxFileSize:Number.isInteger(i)?i:1073741824},n}}),define("DS/W3DDrive/initWidget",["DS/WebAppsFoundations/Views/CollectionView","DS/vue/vue","DS/vuekit/vuekit","css!DS/W3DContentApp/W3DContentApp.css","css!DS/W3DDriveApp/W3DDriveApp.css"],function(e,t,n){"use strict";return function(e){function i(t,n){return"string"==typeof t&&(n!==e.getValue(t)?(e.setValue(t,n),!0):void 0)}return t.use(n),e.hasPreference("isInodePanelSideBarOpened")||e.addPreference({name:"isInodePanelSideBarOpened",type:"hidden",label:"InodePanelView SideBar opened state",defaultValue:"`false`"}),e.hasPreference("isDrivePanelSideBarCollapsed")||e.addPreference({name:"isDrivePanelSideBarCollapsed",type:"hidden",label:"DrivePanelView SideBar opened state",defaultValue:"`false`"}),e.hasPreference("inodeTableLayoutKey")||e.addPreference({name:"inodeTableLayoutKey",type:"hidden",label:"selected inodeTableLayout layout",defaultValue:"listLayout"}),e.hasPreference("inodeDetailViewKey")||e.addPreference({name:"inodeDetailViewKey",type:"hidden",label:"selected inodeDetailView tab",defaultValue:"inode-detail-properties"}),e.setValue("3ddrive_uuid","W-"+function(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}()),e.setValue("tenantAware",!0),e.addEvents({onToggleInodePanelSideBarVisibility:function(){var t=!e.getBool("isInodePanelSideBarOpened");e.setValue("isInodePanelSideBarOpened",t),e.dispatchEvent("onInodePanelSideBarVisibilityToggled",t)},onToggleLightboxPropertiesVisibility:function(){e.dispatchEvent("onToggleLightboxPropertiesVisibilityToggled")},onToggleDrivePanelSideBarCollapsed:function(){var t=!e.getBool("isDrivePanelSideBarCollapsed");e.setValue("isDrivePanelSideBarCollapsed",t),e.dispatchEvent("onDrivePanelSideBarCollapsedToggled",t)},onUpdateInodeTableLayoutKey:function(t){i("inodeTableLayoutKey",t)&&e.dispatchEvent("onInodeTableLayoutKeyUpdated",t)},onUpdateInodeDetailViewKey:function(t){e.getValue("inodeDetailViewKey")!==t&&i("inodeDetailViewKey",t)},onViewChange:function(e){e&&"fullscreen"===e.type?document.body.querySelector(".moduleContent").addClassName("fullscreen"):document.body.querySelector(".moduleContent").removeClassName("fullscreen")}}),e}}),define("DS/W3DDrive/Utils/StructureNavigation",["DS/W3DContentApp/Utils/Helpers"],function(e){"use strict";return{filesAreEqual:function(e,t){if(!e||!t)return!1;return e.name===t.name&&e.size===t.size&&e.lastModified===t.lastModified},hasRelations:t,isLinkedFile:function(e){if("object"!=typeof e||Array.isArray(e)||!e.isContainer||!e.drive)return!1;if(e.isContainer())return!1;return t(e)&&e.drive.isDsDrive},isPart:function(e){if("object"!=typeof e||Array.isArray(e)||!e.isContainer||!e.drive)return!1;if(e.isContainer())return!1;return e.drive.isDsDrive&&n({inode:e,extensions:["sldprt","catpart"]})},isSupportedBy3DPlay:function(t){var i=["CATProduct","gml","stpx","stpxz"];"true"===e.getAppBehaviour("FUN115463_step")&&(i.push("stp"),i.push("step"),i.push("stpz"));"true"===e.getAppBehaviour("FUN122525_dwg")&&(i.push("dwg"),i.push("dxf"));return n({inode:t,extensions:i})}};function t(t){var i=["CATProduct","sldasm","gml","stpx","stpxz"];return"true"===e.getAppBehaviour("FUN115463_step")&&(i.push("stp"),i.push("step"),i.push("stpz")),"true"===e.getAppBehaviour("FUN122525_dwg")&&(i.push("dwg"),i.push("dxf")),n({inode:t,extensions:i})}function n(e){if(void 0===e)throw"isExtensionAllowed takes an object options as parameter";if(void 0===e.extensions)throw'isExtensionAllowed takes an array of extensions as "options.extensions"';if(void 0===e.inode)throw'isExtensionAllowed takes an object/string to compare the extension as "options.inode"';var t=e.extensions,n=e.inode,i="",o=new RegExp(t.join("|"),"i");if("string"==typeof n){var a=n.lastIndexOf(".")+1;i=n.substr(a)}else i=n.get("fileExtension");return!(!i||!i.search)&&i.search(o)>-1}}),define("DS/W3DDrive/Utils/W3DSpacePreferencesUpgrade",[],function(){"use strict";return function(e){var t=e.getValue("collab-storage");return t&&(e.setValue("saved-fragment","drives/"+t+"/mimetype/text%2Fdirectory/inode/myCollabSpaces/content"),e.setValue("firstlyLoading","false"),e.setValue("collab-storage",null),e.setValue("main-view",null),e.setValue("id-card-view",null)),e}}),define("DS/W3DDrive/Utils/errors",["DS/W3DContentApp/Utils/Helpers","i18n!DS/W3DDrive/assets/nls/W3DDrive"],function(e,t){"use strict";function n(){var e=Error.apply(this,arguments);e.name=this.name=this.constructor.name,this.stack=e.stack,this.message=e.message}return n.prototype=Object.create(Error.prototype,{constructor:{value:n,writtable:!0,configurable:!0}}),{createUploadFileSizeError:function(i){var o=e.computeNLSSize(i.constants.maxFileSize);return new n(t.replace(t.maxSize,{size:o}))},createUploadFileSizeErrorDSDrive:function(i){var o=e.computeNLSSize(i.constants.maxFileSize);return new n(t.replace(t.maxSizeDSDrive,{size:o}))},createUploadFileNameErrorDSDrive:function(e){return new n(t.replace(t.uploadUnsupportedChar,{character:e}))},UploadError:n}}),define("DS/W3DDrive/Actions/download",["UWA/Promise","UWA/Utils","UWA/Utils/Client"],function(e,t,n){"use strict";return function(e,i,o){if(e){if("GET"===(i=i||"POST")){if(window.navigator.msSaveOrOpenBlob)return void window.open(e,"_blank");var a=document.createElement("a"),r=function(e){e.stopPropagation(),document.body.removeChild(a),a.removeEventListener("click",r)};return a.href=e,a.target="_blank",a.download=o.get("title"),a.addEventListener("click",r),document.body.appendChild(a),void a.click()}var s,c=document.createElement("form");if(c.style.display="none",c.method=i,n.Platform.hasOwnProperty("ios")&&n.Platform.ios&&((s=navigator.userAgent.match(/OS (\d+)_(\d+)_?(\d+)?/))?s[1]:null)<13&&(c.target="_blank"),-1!==e.indexOf("?")){var l=t.parseQuery(e);Object.keys(l).reduce(function(e,t){var n=document.createElement("input");return n.setAttribute("name",t),n.setAttribute("value",l[t]),e.appendChild(n),e},c)}c.action=e.substring(0,e.indexOf("?")),document.body.appendChild(c),c.submit()}}}),define("DS/W3DDrive/initStdWidget",["UWA/Utils","DS/W3DDrive/initWidget","DS/PlatformAPI/PlatformAPI"],function(e,t,n){"use strict";return function(i){let o=e.parseQuery(window.location.href);return o.hasOwnProperty("widgetDomain")&&(o=e.parseQuery(o.widgetDomain)),i.setValue("isDrivePanelSideBarCollapsed",!0),i.setValue("firstlyLoading",!0),o.hasOwnProperty("token")?i.setValue("token",o.token):i.setValue("token",null),i.setValue("SCDataMgtBaseUrl","https://"+e.parseUrl(window.location.href).domain.replace("scpres","scdatamgt")),i.setValue("publicTenant",n.getApplicationConfiguration("app.sc.tenant")),(i=t(i)).removeEvent("onToggleDrivePanelSideBarCollapsed"),i.setValue("isStandalone",!0),i}}),define("DS/W3DDrive/widget",["DS/W3DDrive/initWidget","UWA/Class/Events"],function(e,t){"use strict";return e(t.extend({preferences:{},events:{},getValue:function(e){if(void 0!==this.data[e])return this.data[e]},data:{appId:"fakeAppId"},setTitle:function(){console.log("widget set title does nothing")},getBool:function(e){return this.getValue(e)},setValue:function(e,t){this.data[e]=t},hasPreference:function(e){return!!this.getValue(e)},addPreference:function(e){"`false`"===e.defaultValue&&(e.defaultValue=!1),this.setValue(e.name,e.defaultValue)},setBody:function(e){this.body=e}}).singleton())}),define("DS/W3DDrive/w3DDriveMainView",["UWA/Class/Events","DS/W3DDrive/widget","DS/i3DXCompassServices/i3DXCompassPubSub"],function(e,t,n){"use strict";var i=e.extend({_targetElement:null,_w3ddriveAppElement:null,_selectedFilesIn3DDrive:[],init:function(e){this._subscribeToCompassEvent(),t.showAllPlatforms=!1,t.showExternalDrives=!0,e.platformId&&t.setValue("x3dPlatformId",e.platformId),e.hasOwnProperty("showAllPlatforms")&&(t.showAllPlatforms=e.showAllPlatforms),e.hasOwnProperty("showExternalDrives")&&(t.showExternalDrives=e.showExternalDrives),this._parent.apply(this,arguments)},inject:function(e){if(!e.targetElement)throw new Error("A target Element is required in order to be able to know where the 3DDrive app must be injected in the DOM. Please provide this option");this._targetElement=e.targetElement,this._render()},_subscribeToCompassEvent:function(){var e=this;n.subscribe("setX3DContent",function(t){e._selectedFilesIn3DDrive=t.data.items.filter(function(e){return"text/directory"!==e.objectType}),e.dispatchEvent("onSelectionChange",[e._selectedFilesIn3DDrive])}),n.subscribe("resetX3DContent",function(t){e._selectedFilesIn3DDrive=[],e.dispatchEvent("onSelectionChange",[e._selectedFilesIn3DDrive])})},_render:function(){var e=this;e._w3ddriveAppElement?(t.setBody(e._targetElement),e._targetElement.appendChild(e._w3ddriveAppElement)):e._targetElement&&(t.setBody(e._targetElement),t.setValue("firstlyLoading",!0),require(["DS/W3DDrive/Utils/Preferences","DS/W3DDrive/widget","DS/W3DDrive/w3DDriveApp"],function(t,n){t.runHistory("DSROOT/content"),e._w3ddriveAppElement=n.body.firstChild}))}}),o=i.singleton(),a=!1;return i.initInstance=function(e){return!1===a&&(e=e||{},o.init(e),a=!0),o},i}),define("DS/W3DDrive/Actions/downloadAction",["DS/W3DContentApp/Metas/drive","DS/W3DContentApp/Metas/errors","DS/W3DContentApp/Utils/IntegrationHelper","DS/W3DDrive/Actions/download","DS/W3DDrive/Utils/StructureNavigation","DS/W3DContentApp/Views/SuperModal","DS/W3DContentApp/Utils/Alert","DS/W3DDrive/widget","DS/UIKIT/Input/Toggle","DS/W3DContentApp/Utils/Metrics","i18n!DS/W3DDrive/assets/nls/W3DDrive"],function(e,t,n,i,o,a,r,s,c,l,d){"use strict";return function(e){var t=Object.assign({},e),i=t.model;if(!i)throw"A model is mandatory to initiate a download action.";if(l.trackAction({model:i,eventAction:"downloadIteration",contextView:t.context}),!n.SWIntegration||!n.SWIntegration.downloadFile)return o.hasRelations(i)&&i.drive.isDsDrive&&!0!==s.getValue("isStandalone")?function(e){var t=e.model,n={name:"downloadType",className:"primary"},i=new c(Object.assign({},n,{value:"all",label:d.downloadLinkedFiles})).check(),o=new c(Object.assign({},n,{value:"one",label:d.downloadFileOnly})),r=document.createElement("div");return r.appendChild(i.elements.container),r.appendChild(o.elements.container),a.dialog({title:d.download+" "+t.get("title"),body:r,buttons:[{className:"primary",value:d.download,action:function(t){t.hide(),i.isChecked()?u(Object.assign({},e,{data:{expand:"force"}})):u(e)}},{value:d.cancel,action:function(e){e.hide()}}]})}(t):void u(t);n.SWIntegration.downloadFile(JSON.stringify({fileId:i.id}))};function u(n){var o=e(),a=n.model,s=a.get("title"),c=t().xmlhttprequestCodes;if(a.drive&&a.drive.get("id")===o.ids.google2&&a.get("size")>=11e6){var l={message:" Google Drive link",url:a.get("fileUrl")};r.addWithLink({message:d.replace(d.downloadExceedSize,{name:s}),className:"error"},l)}else a.getDownloadUrl(n).then(function(e){var t=e.url;t?i(t,e.method,a):r.add({message:d.replace(d.emptyDownload,{name:s}),className:"warning"})},function(e){e&&e.hasOwnProperty("status")&&e.status===c.CONFLICT?r.add({message:d.replace(d.duplicationError,{msg:e.data.error.message,fileName:e.data.error.filename}),className:"error"}):r.add({message:d.replace(d.downloadError,{name:s}),className:"error"})})}}),define("DS/W3DDrive/InodeActions",["UWA/Core","UWA/Class","UWA/Class/Events","DS/W3DContentApp/Utils/Metrics","DS/W3DContentApp/Actions/Utils/actionsUtils","DS/UIKIT/Input/Toggle","DS/UIKIT/Alert","DS/W3DContentApp/Utils/Alert","DS/W3DContentApp/Views/SuperModal","DS/W3DContentApp/Metas/actions","DS/W3DContentApp/Metas/inode","DS/W3DContentApp/Metas/errors","DS/W3DDriveApp/Views/createFolder","DS/W3DDriveApp/Views/editInode","DS/W3DContentApp/Utils/Actions/delete","DS/W3DDrive/Actions/download","DS/W3DContentApp/Utils/Actions/moveAndCopy","DS/W3DDriveApp/Views/ExternalServices/ShareContent","DS/W3DDriveApp/Views/ShareModal","DS/W3DSpaceApp/Views/PublishContent","DS/W3DSpaceComponents/Views/shareCollaborativeSpace","DS/W3DDriveApp/Utils/Actions/addToMyDrive","DS/W3DContentApp/Utils/IntegrationHelper","DS/W3DContentApp/Utils/contextHelpers","DS/W3DDrive/Utils/StructureNavigation","DS/W3DDrive/widget","DS/W3DContentApp/BusEvent","DS/W3DDriveApp/Utils/Actions/upload-folder/upload-folder","DS/W3DContentApp/Metas/drive","DS/W3DSpaceApp/Actions/createCS","DS/W3DSpaceApp/Actions/editCS","DS/W3DSpaceApp/Actions/editContent","i18n!DS/W3DDrive/assets/nls/W3DDrive"],function(e,t,n,i,o,a,r,s,c,l,d,u,p,m,g,f,v,D,h,S,w,A,C,b,y,I,E,P,W,F,N,x,T){"use strict";const V=l(),k=d(),U=W(),O=u().xmlhttprequestCodes;return t.extend(n,{actions:[],init:function(t={}){const n=t.model,r=t.context;if(!n)return;if("sharedwithme"===n.get("parentId")&&n.get("addtomydrive")){const e=n.get("actions").filter(e=>"changeAlias"!==e&&"removeFromMyDrive"!==e);n.set("actions",e)}function l(e){return i.trackAction(Object.assign(e,{model:n,contextView:r}))}function d(e,t){E.dispatchEvent("inodeActions:"+e,t)}function u(){if(C.SWIntegration&&C.SWIntegration.downloadFile)C.SWIntegration.downloadFile(JSON.stringify({fileId:n.id}));else{var t,i,r,d,u=n.get("title");if(y.hasRelations(n)&&n.drive.isDsDrive&&!0!==I.getValue("isStandalone"))return t={name:"downloadType",className:"primary"},i=new a(Object.assign({},t,{value:"all",label:T.downloadLinkedFiles})).check(),r=new a(Object.assign({},t,{value:"one",label:T.downloadFileOnly})),(d=document.createElement("div")).appendChild(i.elements.container),d.appendChild(r.elements.container),c.dialog({title:T.download+" "+u,body:d,buttons:[{className:"primary",value:T.download,action:function(e){e.hide();var t=i.isChecked();l({eventAction:"download",hasLinkedFiles:t.toString()}),t?p({data:{expand:"true"}}):p()}},{value:T.cancel,action:function(e){e.hide()}}]});if(n.isFolder())return function(){var t=new a({type:"checkbox",name:"recursiveDownload",className:"primary",label:T.downloadRecursivelyOption}),n=e.createElement("div",{html:[{tag:"span",text:T.downloadRecursively},t]});return c.dialog({title:T.replace(T.downloadSelected,{title:u}),body:n,buttons:[{className:"primary",value:T.download,action:function(e){e.hide();var n=t.isChecked();l({eventAction:"download",recursiveDownload:n.toString()}),n?p({data:{expand:"force"}}):p()}},{value:T.cancel,action:function(e){e.hide()}}]})}();l({eventAction:"download"}),p()}function p(e){if(n.drive&&n.drive.get("id")===U.ids.google2&&n.get("size")>=11e6){var t={message:" Google Drive link",url:n.get("fileUrl")};s.addWithLink({message:T.replace(T.downloadExceedSize,{name:n.get("title")}),className:"error"},t)}else n.getDownloadUrl(e).then(function(e){var t=e.url;if(t){if(e&&e.expandDetails&&e.expandDetails.missingFiles&&e.expandDetails.missingFiles.length>0){var i=e.expandDetails.missingFiles;o.showMoreInfoPopup(i,"downloaded")}f(t,e.method,n)}},function(e){if(404===e.status)return s.add({message:T.replace(T.get("emptyDownload"),{name:u}),className:"warning"});if(e&&e.data&&e.data.error&&("linkInfoMissing"===e.data.error.errorCode||"mainNotIndexed"===e.data.error.errorCode)){var t=T.download,i=e.data.url,a=T.replace(T.downloadSelected,{title:n.get("title")}),r=e.data.error.failingFiles;return o.getConfirmationModal(a,r,t,function(){window.open(i,"_self")},!1)}e&&e.hasOwnProperty("status")&&e.status===O.CONFLICT?s.add({message:T.replace(T.duplicationError,{msg:e.data.error.message,fileName:e.data.error.filename}),className:"error"}):e&&e.status===O.NOT_FOUND&&e.options&&e.options.xhr&&/reached max quota/i.test(e.options.xhr.responseText)?s.add({message:T.guestNoRemainingAccess,className:"error"}):s.add({message:T.replace(T.downloadError,{name:u}),className:"error"})})}}function W(){if(n.drive.get("blockactions"))s.add({message:T.get("quotaExceededWarning"),className:"warning"});else if(C.SWIntegration&&C.SWCheckShared&&!C.SWCheckShared(n))C.SWIntegration.uploadFile(JSON.stringify({folderId:n.id,envId:n.drive.id}));else{var t=e.createElement("input",{attributes:{type:"file",multiple:!0,accept:n.extensionsAllowed?n.extensionsAllowed.join(", "):""},styles:{display:"none"},events:{change:function(){var t=this.files[0].name;if(n.drive.isDsDrive&&1===this.files.length&&y.hasRelations(t))return void function(t){var i=document.createElement("div"),o=document.createElement("div"),a=t.title,s=t.file;o.innerHTML=T.uploadLinkedFileDescription,i.appendChild(o),c.dialog({title:T.upload+" "+a,body:i,buttons:[{className:"primary",value:T.uploadAttachedFiles,action:function(t){t.hide();var i=e.createElement("input",{attributes:{type:"file",multiple:!0},styles:{display:"none"},events:{change:function(){var e=Array.prototype.slice.call(this.files),t=e.filter(function(e){return e.name===s.name});0!==t.length||y.filesAreEqual(t[0],s)||(e=e.concat(s)),d("onUpload",[n,e,{viewContext:r,linkedFiles:!0}])},click:function(e){document.body.onfocus=function(){setTimeout(function(){i.remove()},100),document.body.onfocus=null},e.stopPropagation()}}}).inject(document.body);i.click()}},{value:T.uploadOneFile,action:function(e){e.hide(),d("onUpload",[n,[s],{viewContext:r,linkedFiles:!1}])}}]})}({title:t,file:this.files[0]});d("onUpload",[n,this.files,{viewContext:r,linkedFiles:!1}])},click:function(e){document.body.onfocus=i,e.stopPropagation()}}});t.inject(document.body),t.click()}function i(){setTimeout(function(){t.remove()},100),document.body.onfocus=null}}function M(){l({eventAction:"publishTo3DSwym"}),new S(n)}function R(){l({eventAction:"addMemberCS"}),w(n)}const L={};L[k.actionPubIds.viewInformation]=function(){l({eventAction:"viewInformation"}),d("onViewProperties",n)},L[k.actionPubIds.preview]=function(){l({eventAction:"preview"}),d("onPreview",n)},L[k.actionPubIds.editDocument]=function(){l({eventAction:"editDocument"}),d("onEditDocument",n)},L[k.actionPubIds.openFileLocation]=function(){l({eventAction:"openFileLocation"});const e=n.getLocationLink&&n.getLocationLink();e&&d("openLocation",[n,e])},L[k.actionPubIds.share]=function(){l({eventAction:"share"}),n&&n.drive&&n.drive.isDsDrive?new h({models:n,options:{onComplete:function(e,t,n){d("onShareAccess",[e[0],t,n])}}}):new D(n,{onComplete:function(e,t,n){d("onShareAccess",[e[0],t,n])}})},L[k.actionPubIds.getLink]=function(){navigator.clipboard.writeText(n.getDirectLink()).then(()=>{require(["DS/UWPClientControls/PlatformNotify"],function(e){e.success(T.get("linkCopiedToClipboard"))})})},L[k.actionPubIds.publishTo3DSwym]=M,L[k.actionPubIds.moveTo]=function(){v(n,{dispatchEvent:d})},L[k.actionPubIds.copy]=function(){v(n,{dispatchEvent:d,duplicate:!0})},L[k.actionPubIds.changeProperties]=function(){l({eventAction:"changeProperties"}),m(n)},L[k.actionPubIds.del]=function(){g(n,{dispatchEvent:d})},L[k.actionPubIds.delFinal]=function(){g(n,{dispatchEvent:d,isPermanent:!0})},L[k.actionPubIds.createFolder]=function(){return l({eventAction:"create"}),p(n)},L[k.actionPubIds.upload]=W,L[k.actionPubIds.uploadFolder]=function(){if(n.drive.get("blockactions"))return void s.add({message:T.get("quotaExceededWarning"),className:"warning"});const t=e.createElement("input",{attributes:{type:"file",directory:!0,webkitdirectory:!0,accept:n.extensionsAllowed?n.extensionsAllowed.join(", "):""},styles:{display:"none"},events:{change:function(){P.processFolder(this.files,n)}}});t.inject(document.body),t.click()},L[k.actionPubIds.download]=u,L[k.actionPubIds.insert]=function(){l({eventAction:"insert"}),C.SWIntegration&&C.SWIntegration.insertFile(JSON.stringify({fileId:n.id}))},L[k.actionPubIds.restoreVersion]=function(){if(l({eventAction:"restoreVersion"}),!C.SWIntegration||!C.SWIntegration.downloadFile)return y.hasRelations(n)?c.dialog({title:T.restore+" "+n.get("title"),body:T.restorePointingFile,buttons:[{className:"primary",value:T.restore,action:function(e){e.hide(),d("onRestore",[n])}},{value:T.cancel,action:function(e){e.hide()}}]}):void d("onRestore",[n]);C.SWIntegration.downloadFile(JSON.stringify({fileId:n.id}))},L[k.actionPubIds.restore]=function(){l({eventAction:"restore"});var e=function(){n.destroy({noSync:!0}),s.add({message:T.get("restoreElemSuccess",{name:n.get("title")}),className:"success"})},t=function(i){var o=0;409===i.status&&("parentNotAvailable"===i.code?o=1:"nameNotUnique"===i.code&&(o=2)),0===o?s.add({message:T.get("unexpectedError"),className:"error"}):v(n,{dispatchEvent:d,newTitle:!0,restore:!0,errorCode:o,callback:e,fallback:t})};n.restore().then(e,t)},L[k.actionPubIds.addToMyDrive]=function(){l({eventAction:"addToMyDrive"}),A(n,{action:"add",dispatchEvent:d})},L[k.actionPubIds.removeFromMyDrive]=function(){l({eventAction:"removeFromMyDrive"}),A(n,{action:"remove",dispatchEvent:d})},L[k.actionPubIds.removeOwnAccess]=function(){l({eventAction:"removeOwnAccess"}),d("removeOwnAccess",n)},L[k.actionPubIds.addToFavorites]=function(){l({eventAction:"addToFavorites"}),d("onAddToFavorites",n)},L[k.actionPubIds.removeFromFavorites]=function(){l({eventAction:"removeFromFavorites"}),d("onRemoveFromFavorites",n)},L[k.actionPubIds.createCollabSpace]=function(){return l({eventAction:"createCS"}),F(n,k.mimeType.collabSpace)},L[k.actionPubIds.addContent]=W,L[k.actionPubIds.addMember]=R,L[k.actionPubIds.addMemberRestricted]=R,L[k.actionPubIds.editCS]=function(){return l({eventAction:"editCS"}),N(n,k.mimeType.collabSpace)},L[k.actionPubIds.changeThumbnail]=function(){function t(){setTimeout(function(){i.remove()},100),document.body.onfocus=null}l({eventAction:"changeThumbnailCS"});var i=e.createElement("input",{attributes:{type:"file",multiple:!0},styles:{display:"none"},events:{change:function(){d("onChangeThumbnail",[n,this.files])},click:function(e){document.body.onfocus=t,e.stopPropagation()}}});i.inject(document.body),i.click()},L[k.actionPubIds.update]=function(){function t(){setTimeout(function(){i.remove()},100),document.body.onfocus=null}l({eventAction:"update"});var i=e.createElement("input",{attributes:{type:"file",multiple:!1,accept:!0!==I.getValue("is3DSpaceWidget")&&n.get("fileExtension")?"."+n.get("fileExtension"):"*"},styles:{display:"none"},events:{change:function(){d("onUpdate",[n,this.files])},click:function(e){document.body.onfocus=t,e.stopPropagation()}}});i.inject(document.body),i.click()},L[k.actionPubIds.moveToCS]=function(){var e="w3ddrive item inode-item selected inode-item--focused",t=document.getElementsByClassName(e)[0]?document.getElementsByClassName(e)[0]:this.container;v(n,{dispatchEvent:d,itemView:t})},L[k.actionPubIds.editContent]=function(){return l({eventAction:"editContent"}),x(n)},L[k.actionPubIds.downloadVersion]=u,L[k.actionPubIds.shareContent]=M;let j=V.map(e=>{const t=L[e.id];return t&&(e=Object.assign({handler:t},e)),e});j=j.filter(e=>n.isActionIdoK(e.id)),j=b.actionsFilters.applyCurrentContexts(j),this.actions=j,t.validate&&(this.validate=t.validate),t.events&&this.addEvents(t.events)},toJSON:function(){return this.actions}})}),define("DS/W3DDrive/inodesActions",["DS/UIKIT/Input/Toggle","DS/W3DContentApp/Utils/Actions/delete","DS/W3DDrive/Actions/download","DS/W3DDriveApp/Views/ShareModal","DS/W3DContentApp/Utils/Actions/moveAndCopy","DS/W3DContentApp/Metas/actions","DS/W3DContentApp/Metas/inode","DS/W3DContentApp/Utils/Helpers","DS/W3DContentApp/Utils/contextHelpers","DS/W3DContentApp/Views/SuperModal","DS/W3DContentApp/Utils/Alert","DS/W3DContentApp/BusEvent","DS/W3DDrive/widget","i18n!DS/W3DDrive/assets/nls/W3DDrive"],function(e,t,n,i,o,a,r,s,c,l,d,u,p,m){"use strict";const g=a(),f=r(),v={};function D(e,t){u.dispatchEvent("inodesActions:"+e,t),u.dispatchEvent("inodesActions",t)}return v[f.actionPubIds.share]=function(e){new i({models:e,options:{onComplete:function(e,t){D("onShareAccess",[e,t])}}})},"true"!==p.getValue("is3DSpaceWidget")&&(v[f.actionPubIds.del]=function(e){t(e,{dispatchEvent:D})},v[f.actionPubIds.delFinal]=function(e){t(e,{dispatchEvent:D,isPermanent:!0})},v[f.actionPubIds.moveTo]=function(e){o(e,{dispatchEvent:D})},v[f.actionPubIds.download]=function(t){if(t.length){if(function(e){return e.some(function(e){return e.isFolder()})}(t))return i=new e({type:"checkbox",name:"recursiveDownload",className:"primary",label:m.downloadRecursivelyOption}),l.dialog({title:m.download,body:[{tag:"span",text:m.downloadRecursively},i],buttons:[{className:"primary",value:m.download,action:function(e){e.hide();var t=i.isChecked();t?o({data:{expand:!0}}):o()}},{value:m.cancel,action:function(e){e.hide()}}]});var i;o()}else d.add({className:"warning",message:m.replace(m.empty)});function o(e){t[0].collection.getDownloadUrl(t,e).then(function(e){var t=e.url;t?n(t,e.method):d.add({className:"warning",message:m.replace(m.empty)})},function(){d.add({className:"error",message:m.replace(m.downloadsError)})})}},v[f.actionPubIds.addToFavorites]=function(e){D("onAddToFavorites",[e])},v[f.actionPubIds.removeFromFavorites]=function(e){D("onRemoveFromFavorites",[e])}),{getActionsJSON:function(e){if(!e)return[];e=[].concat(e);let t=s.getActionIds(e),n=(t=c.actionsFilters.applyCurrentContexts(t)).indexOf("giveReadAccess");-1===n&&(n=t.indexOf("giveEditAccess")),-1!==n&&t.splice(n,0,f.actionPubIds.share);let i=g.filter(e=>-1!==t.indexOf(e.id));return(i=i.filter(e=>v[e.id])).map(t=>{const n=v[t.id];return Object.assign({handler:function(){n(e)}},t)})}}}),define("DS/W3DDrive/Utils/Preferences",["UWA/String","DS/W3DContentApp/Utils/Platform","DS/W3DContentApp/Utils/History","DS/W3DDrive/widget"],function(e,t,n,i){"use strict";return{validateRoute:function(t,n,i){let o="drives/{0}/mimetype/text%2Fdirectory/inode/{1}";const a=i.find(function(e){return e.id===n});return n=a?a.id:i[0].id,o=e.format(o,n,t)},runHistory:function(e){const o=this,a=i.getValue("x3dPlatformId");!0===i.getValue("isStandalone")?(n.setBaseURI(e),o._runStartingRoute()):t.getAllPlatforms().then(function(t){a?n.setBaseURI(o.validateRoute(e,a,t),a):t[0]?n.setBaseURI(o.validateRoute(e,t[0].id,t),t[0].id):n.setBaseURI("/"),o._runStartingRoute()},function(){n.setBaseURI("/"),o._runStartingRoute()})},_runStartingRoute:function(e,t){t&&(i.setValue("granted-"+t,!0),n._saveFragment(e)),n.start({root:e})}}}),define("DS/W3DDrive/Utils/CompassHelpers",["DS/W3DDrive/widget","DS/W3DSpaceComponents/Utils/SecurityContext","i18n!DS/W3DDrive/assets/nls/W3DDrive"],function(e,t,n){"use strict";return{getObject:function(i){var o,a,r,s,c;return e.getValue("is3DSpaceWidget")?(o="3DSpace",a=t.getNominalContext(i.collection._parentInode),r=i.get("iconLink"),s=i.get("type")?i.get("type").value:"",c=i.get("type")?i.get("type").name:""):"3DEXPERIENCE"===i.drive.get("title")?(o="3DDrive",a="",r="",s=i.isContainer()?"DriveFolder":"DriveFile",c=i.isContainer()?n.folder:n.file):(o=i.drive.id,a="",r="",s=i.isContainer()?i.get("mimeType"):"Document",c=i.get("fileExtension")),{envId:i._auth.platformId||"",serviceId:o,contextId:a,objectId:i.id,objectRootId:i.get("root"),objectType:s,displayName:i.get("title"),displayType:c,displayIcon:r,displayPreview:i.get("thumbnailLink").medium}},get3DXContent:function(t){var n,i;return e.getValue("is3DSpaceWidget")?(i="X3DCSMA_AP",n="1.0"):(i=e.data.appId,n="2.0"),{protocol:"3DXContent",version:n,source:i,data:{items:t.map(this.getObject)}}}}}),define("DS/W3DDrive/Models/DriveFactory",["DS/W3DContentApp/Models/Drive","DS/W3DDriveApp/Models/Drive","DS/W3DSpaceApp/Models/Drive","DS/W3DDriveApp/Models/DrivesHub/Drive","DS/W3DDrive/widget"],function(e,t,n,i,o){"use strict";function a(e,a){return new(!0===e.isDrivesHubProvider?i:o.getValue("is3DSpaceWidget")?n:t)(e,a)}return a.prototype.idAttribute=e.prototype.idAttribute,a}),define("DS/W3DDrive/Utils/drives",["UWA/Class/Collection","UWA/Class/Promise","DS/W3DContentApp/Utils/Helpers","DS/W3DContentApp/Utils/DSAuth","DS/W3DContentApp/Models/Drive","DS/W3DDrive/Models/DriveFactory","DS/W3DContentApp/Utils/Platform","DS/W3DContentApp/Utils/RequestHelper","DS/W3DDrive/widget","DS/W3DContentApp/Utils/IntegrationHelper","DS/W3DDriveApp/Utils/drivesHubConnect"],function(e,t,n,i,o,a,r,s,c,l,d){"use strict";var u=new e;return Object.assign(u,{model:a,comparator:"title",sync:function(e,a,u){if("read"===e){var p=[],m=[],g=u.onComplete;if(delete(u=Object.assign({},u)).onComplete,!c.getValue("is3DSpaceWidget")&&!a.isEmpty())return a.forEach(function(e){p.push(new t(function(t,n){o.prototype.sync("read",e,Object.assign(u,{onComplete:t,onFailure:n}))}))}),t.all(p).then(function(e){g(e,u)});s.hasTenant()&&m.push({id:s.getTenant(),auth:new i(s.getTenant(),{id:s.getTenant()})}),r.getAllPlatforms().then(e=>(e.forEach(e=>{m.push({id:e.id,auth:new i(e.id,e)})}),new t(i=>{if(c.getValue("is3DSpaceWidget")||c.getValue("isStandalone")||l.CATIAV5||l.SW||n.isExternalDrivesDisabled()||!c.showExternalDrives)i(m);else{const n=e.find(e=>e.id===r.getSelectedPlatformId()),o=n?n.url:"";r.getDrivesHubUrl().then(e=>new t(t=>{e?s.performRequestWithOptions(o+"/resources/3ddrive/v1/admin/config",{method:"GET",type:"json",headers:{"Content-Type":"application/json"},onComplete:function(e={}){const n=e.externaldrives?e.externaldrives.split(","):[];t(n)},onFailure:function(){t([])}}):t(m)}).then(t=>d.tryFetch(e,t).then(e=>{i(m.concat(e))})))}}).then(e=>(e.forEach(function(e){p.push(new t(function(t,n){o.prototype.sync("read",e,Object.assign(u,{onComplete:t,onFailure:n}))}))}),t.all(p).then(function(e){g(e,u)})))))}}})}),define("DS/W3DDrive/w3DDriveApp",["UWA/Class/Promise","UWA/Utils","DS/W3DContentApp/Utils/Metrics","DS/W3DContentApp/Actions/Utils/actionsUtils","DS/W3DDrive/Utils/drives","DS/W3DContentApp/Actions/upload-manager/upload-manager","DS/W3DContentApp/Utils/Router","DS/W3DContentApp/Utils/Alert","DS/W3DContentApp/Views/errorDetailsModal","DS/W3DContentApp/BusEvent","DS/i3DXCompassServices/i3DXCompassPubSub","DS/W3DContentApp/Utils/Tagger6WProxy","DS/W3DContentApp/w3DDriveView","DS/W3DDriveApp/Views/inodeAllAccessesContainer","DS/W3DSpaceApp/Views/inodeAllAccessesContainer","DS/W3DDriveApp/Views/inodeFileHistoryContainer","DS/W3DSpaceApp/Views/inodeHistoryContainer","DS/W3DContentApp/Views/InodeDetailView/inodeDetailSocialView","DS/W3DDriveApp/Views/QuotaExceededView","DS/W3DDriveApp/Views/inodeShareWithExternalContainer","DS/W3DSpaceApp/Views/inodeDetailAnalyticsView","DS/W3DDriveApp/Views/inodePropertiesView3DDriveContainer","DS/W3DSpaceApp/Views/inodePropertiesView3DSpaceContainer","DS/W3DContentApp/Metas/inode","DS/W3DSpaceApp/Metas/inode","DS/W3DDrive/widget","DS/W3DDrive/Utils/errors","DS/W3DContentApp/Utils/IntegrationHelper","DS/W3DDrive/Utils/CompassHelpers","DS/W3DContentApp/Utils/Rerouter","DS/W3DContentApp/Metas/errors","DS/PlatformAPI/PlatformAPI","DS/W3DDriveApp/Utils/AutoRefresh","DS/W3DContentApp/Utils/Helpers","DS/W3DContentApp/Utils/AdvancedHelpers","DS/W3DContentApp/Views/SuperModal","DS/W3DDriveApp/Utils/Actions/upload-folder/upload-folder","DS/W3DSpaceApp/Views/cleanCollaborativeSpace","DS/W3DContentApp/Utils/scheduleTasksToGlobalSession","DS/W3DDrive/Utils/StructureNavigation","DS/W3DDriveApp/Views/startView","DS/W3DSpaceApp/Views/dndCoachmark","DS/W3DContentApp/Utils/Store","i18n!DS/W3DDrive/assets/nls/W3DDrive","css!DS/UIKIT/UIKIT.css"],function(e,t,n,i,o,a,r,s,c,l,d,u,p,m,g,f,v,D,h,S,w,A,C,b,y,I,E,P,W,F,N,x,T,V,k,U,O,M,R,L,j,B,_,q){"use strict";y=y();var H,z,K,X,J,G=N().w3ddrive,Q=b(),$=!0,Y=!1;function Z(t){return new e(function(e,n){t.get("authenticated")&&I.getValue("is3DSpaceWidget")?t.fetch({onComplete:function(){e()}}):t.fetch({onComplete:function(){return t.get("authenticated")?e():(s.add({message:q.replace(q.authenticationExpired,{service:t.get("title")}),className:"error"}),n())}})})}function ee(e,t){a.askForUpload(e,t,{drive:e.drive,onComplete:function(e){e.collection&&e.cid!==e.collection.get(e.id).cid&&s.add({message:q.replace(q.updateSuccess,{title:e.get("title")}),className:"success"})},onFailure:function(e,t){if(void 0!==t){var n="function"==typeof e.get?e.get("title"):e.title,i=q.replace(q.uploadError,{name:n||""});t&&t.error&&"quotaExceed"===t.error.errorCode?i+=": "+q.allocatedDiskSpaceExceeded:t&&"Access denied"===t.message?i+=": "+q.get("accessDenied"):t&&t.error&&t.error.details&&("insufficientFilePermissions"===t.error.details.reason?i+=": "+q.get("accessDenied"):"fileSizeLimitExceeded"===t.error.details.reason&&(i+=": "+q.get("fileSizeLimitExceeded"))),e&&e.destroy&&e.destroy(),t instanceof E.UploadError&&(i+=": "+t.message),s.add({message:i,className:"error"})}else e&&e.destroy&&e.destroy()}})}function te(e){Array.isArray(e)||(e=[].concat(e));if(1===e.length){const t=e[0];t.addToFavorites().then(e=>{s.add({className:"success",message:q.get("addToFavoritesSuccess")}),(e=>{if("object"==typeof e){const t="favorites"===K.get("id"),n=X&&X.get("id")===e.get("id");e.collection&&t&&n&&e.collection.fetch({merge:!0,withThumbnails:!0})}})(e)},()=>{s.add({className:"error",message:q.get("addToFavoritesUniqueError",{name:t.get("title")})})})}else{const t=e.filter(e=>"function"==typeof e.addToFavorites).map(e=>(function(){return e.addToFavorites()}));t.length&&R(t).then(()=>{s.add({className:"success",message:q.get("addToFavoritesSuccess")})},()=>{s.add({className:"error",message:q.get("addToFavoritesSomeError")})})}}function ne(e){Array.isArray(e)||(e=[].concat(e));const t=e=>{if("object"==typeof e){const t="favorites"===K.get("id"),n=X&&X.get("id")===e.get("id");e.collection&&t&&(e.isContainer()&&K.get("id")===e.get("id")||n?e.collection.fetch({merge:!0,withThumbnails:!0}):e.collection.remove(e))}};if(1===e.length){const n=e[0];n.removeFromFavorites().then(e=>{s.add({className:"success",message:q.get("removeFromFavoritesSuccess")}),t(e)},()=>{s.add({className:"error",message:q.get("removeFromFavoritesUniqueError",{name:n.get("title")})})})}else{const n=e.filter(e=>"function"==typeof e.removeFromFavorites).map(e=>(function(){return e.removeFromFavorites()}));n.length&&R(n).then(e=>{e&&e.forEach(e=>{t(e)}),s.add({className:"success",message:q.get("removeFromFavoritesSuccess")})},()=>{s.add({className:"error",message:q.get("removeFromFavoritesSomeError")})})}}function ie(t,n,o){var a,r=t.get("title");new e(function(e,i){a=t.save({parentid:n.id},Object.assign({action:"move",patch:!0,wait:!0,onComplete:function(t,n){e(n)},onFailure:function(e,t){i(t)}},o))}).then(function(e){if(o.itemView&&o.itemView.destroy(),e&&e.expandDetails&&e.expandDetails.missingFiles&&e.expandDetails.missingFiles.length>0){var a=e.expandDetails.missingFiles;i.showMoreInfoPopup(a,"moved")}else s.add({message:q.replace(q.moveSuccess,{name:r,toName:n.get("title")||n.id}),className:"success"});if(e)return{collection:t.collection,expandedIds:e.expandDetails?e.expandDetails.expandedIds:null}},function(e){if(e&&e.error&&("linkInfoMissing"===e.error.errorCode||"mainNotIndexed"===e.error.errorCode)){var c=q.move,d=c+" "+t.get("title"),u=e.error.failingFiles;return i.getConfirmationModal(d,u,c,function(){var e=Object.assign({},o);e.queryStrings={expand:"force"},l.dispatchEvent("inodeActions:onMove",[t,n,e])},!1)}var p=q.get("moveError",{name:r,toName:n.get("title")});if(e&&e.error&&"quotaExceed"===e.error.errorCode)p+=": "+q.allocatedDiskSpaceExceeded;else if(a&&409===a.xhr.status){const t=e?e.error:void 0;p=t&&"string"==typeof t.message&&/parent is not authorized/i.test(t.message)?q.replace(q.moveErrorSelf,{name:r,toName:n.get("title")}):q.replace(q.moveErrorNameConflict,{name:r,toName:n.get("title")})}else e&&e.error&&e.error.details&&("insufficientFilePermissions"===e.error.details.reason?p+=": "+q.get("accessDenied"):"duplicateContentName"===e.error.details.reason&&(p=q.replace(q.get("moveErrorNameConflict"),{name:r,toName:n.get("title")})));s.add({message:p,className:"error"})}).then(ue)}function oe(e,t){var n=e[0].collection;n&&"function"==typeof n.moveItems?n.moveItems(e,t,{wait:!1}).then(function(){s.add({message:q.get("movesSuccess",{toName:t.get("title")}),className:"success"})},function(n){var i=q.get("movesError",{nbFail:n.length,nbItems:e.length,toName:t.get("title")}),o=e.length-n.length;s.addAndCallback({message:i,className:"error",callback:function(){var e=q.get("movesSuccessDetail",{nbSuccess:o,toName:t.get("title")})+"</br> </br>";e+=q.get("movesErrorDetail")+"</br> </br>";var i=[];return n.map(function(e){return i.push(e.get("title")),i}),new c({message:e,items:i})}})}):s.add({message:q.replace(q.movesNotSupported,{toName:t.get("title")}),className:"error"})}function ae(e,t){const n="recents"===t.get("root")?t.get("parentId"):null,i=n?"text/directory":null;z.navigate(e.getInodePreviewURI(t,{containerType:i,containerId:n}),{trigger:!0})}function re(e){if(n.trackNavigation({model:e,eventAction:"dblClick"}),P.SWIntegration&&P.SWCheckShared&&!P.SWCheckShared(e)){var t=e.get("fileExtension").toLowerCase();if("sldprt"===t||"sldasm"===t||"slddrw"===t)return void P.SWIntegration.openFile(JSON.stringify({fileId:e.id,envId:e.drive.id}))}var i=e.drive;const o="recents"===e.get("root")?e.get("parentId"):null,a=o?"text/directory":null;var r=e.isContainer()?i.getInodePanelContentURI(e):i.getInodePreviewURI(e,{containerType:a,containerId:o});z.navigate(r,{trigger:!0}),I.getValue("is3DSpaceWidget")&&e.isCollabSpace()&&(e.securityContext(e),e.get("solution")!==y.boType.team&&s.add({message:q.warningNonOCDX,className:"warning"}))}function se(e,t,n,o){e.getFileUrl(t).then(e=>{if(e&&e.expandDetails&&e.expandDetails.missingFiles&&e.expandDetails.missingFiles.length>0){const t=e.expandDetails.missingFiles;i.showMoreInfoPopup(t,"previewed")}n()},t=>{if(t&&t.error&&("linkInfoMissing"===t.error.errorCode||"mainNotIndexed"===t.error.errorCode)){const n=q.preview,a=n+" "+e.get("title"),r=t.error.failingFiles;return i.getConfirmationModal(a,r,n,o,!0)}})}function ce(t){return new e(function(e){return t.getRootInodes(!0).then(function(t){e(t.first())})}).then(function(e){z.navigate(t.getInodePanelContentURI(e),{trigger:!0})})}function le(){var e=p.getSecondPanel();if(e){var t=e.model;if(t){var n=t.inodeTable,i=t.permissions;"function"==typeof n.getFirstPage?n.getFirstPage({reset:!0,withThumbnails:!0,onFailure:o,drive:t.drive}):n.fetch({reset:!0,withThumbnails:!0,onFailure:o,drive:t.drive}),i.fetch({reset:!0,inode:t.id,from:"refresh"})}}function o(){ce(t.drive),t.collection.remove(t)}}function de(t,n){var i=t.get("emailAddress")===t.collection._parentInode.drive.get("user").emailAddress;return new e(function(e,i){t.destroy(Object.assign({wait:!0,onComplete:e,onFailure:i},n))}).then(function(){i&&le(),s.add({message:n.messageSuccess,className:"success"})},function(){s.add({message:n.messageFailure,className:"error"})})}function ue(t){if(!t||!t.expandedIds||!t.collection)return e.resolve();var n=t.collection,i=t.expandedIds;return e.resolve(n.remove(i))}!0===I.getValue("isStandalone")&&(Y=!0,$=!1),H=r.extend({routes:{error:"onError","error/:errorType/:errorCode/:errorMsg":"onError",":parentInodeId/init":"onReroute","drives/:driveId/mimetype/:mimetype/inode/:parentInodeId/content":"onInodeContent","drives/:driveId/mimetype/:mimetype/inode/:parentInodeId/content/:inodeId/preview":"onInodePreview","drives/:driveId/mimetype/:mimetype/inode/:inodeId/preview":"onInodePreview"},execute:function(t,n){const i=n[":driveId"];let a,r=!1;i!==this.driveId&&(this.driveId=i,r=!0);let c=[],d=!0;new e((e,t)=>{o.fetch({onComplete:function(t){const n={};t.forEach(e=>{n[e.id]=e.get("auth")}),e(n)},onFailure:t,reset:o.isEmpty(),merge:!1})}).then(t=>(function(t,n){const i=[];return new e((e,a)=>{let r=t[":driveId"],c=t[":parentInodeId"];const d=t[":inodeId"],u=t[":mimetype"];let p,m,g,f,v;if("sharedWithMe"===c&&(c=c.toLowerCase()),void 0===r)return a();(p=o.get(r))||(n[r]||(!0!==Y&&s.add({message:q.replace(q.driveAccessError,{driveId:r}),className:"warning"}),r=Object.keys(n)[0],v=!0),p=o.get(r)),z.setBaseURI(p.getInodePanelContentURI(p.getRootInodes().first())),i[0]=p,i[1]=u,p&&(!Y&&v&&(c=p.getRootInodes().first().id),(f={}).mimeType=u,f[p.inodeIdAttr]=c,m=p.getInode(f),i[2]=m),m?(!(g=m.inodeTable.get(d))&&d&&((f={})[p.inodeIdAttr]=d,f.parentId=c,g=p.getInode(f),m.inodeTable.add(g)),i[3]=g,e({drive:p,mappedArgs:i})):(g=p.getInode({id:d})).fetch({onComplete:function(){(m=p.getInode({id:g.get("parentId"),mimeType:u})).inodeTable.add(g),i[2]=m,i[3]=g,e({drive:p,mappedArgs:i})},onFailure:function(){e({errorType:"inodeAccessError",drive:p,mappedArgs:i})}}),_.currentTenant!==p.id&&(_.resetStore(),_.currentTenant=p.id,require(["DS/W3DContentApp/Utils/Platform"],function(e){e.getAllPlatforms().then(e=>{const t=e.find(e=>e.id===_.currentTenant);t&&(_.servicesUrl=t)})}),p&&p.isDsDrive&&!I.getValue("isStandalone")&&k.isODEFeatureEnabled(p).then(e=>{_.features.isODEFeatureAvailable=e,l.dispatchEvent("driveFeaturesList",[m])},()=>{_.features.isODEFeatureAvailable=!1}))})})(n,t)).then((e={})=>{a=e.drive,c=e.mappedArgs,d=Boolean(c&&!e.errorType),t&&t.apply(z,c)},()=>{if(!0===Y&&!n.hasOwnProperty(":driveId"))return c=Object.keys(n).map(e=>n[e]),void(t&&t.apply(z,c));n.hasOwnProperty(":errorType")?(n.hasOwnProperty(":errorCode")?n.hasOwnProperty(":errorMsg")?t.apply(z,[n[":errorType"],n[":errorCode"],n[":errorMsg"]]):t.apply(z,[n[":errorType"],n[":errorCode"]]):t.apply(z,[n[":errorType"]]),t=null):z.navigate("",{trigger:!0,loadBaseUri:!0})}).then(()=>{if(d){const i=c[2];let o=c[3];return a&&a.isCollabSpace&&(o=null),function(t=null,n=null){return new e((e,i)=>{t?t.doesExistInBackend().then(t=>{t?n?n.doesExistInBackend().then(t=>{t?e(!0):i(new Error("inodeAccessError"))}):e(!0):i(new Error("inodeAccessError"))}):e(!0)})}(i,o).then(()=>{r&&!Y&&a&&Z(a)},e=>{Z(a),((e,i)=>{!0!==Y||n.hasOwnProperty(":driveId")?n.hasOwnProperty(":errorType")?(n.hasOwnProperty(":errorCode")?n.hasOwnProperty(":errorMsg")?t.apply(z,[n[":errorType"],n[":errorCode"],n[":errorMsg"]]):t.apply(z,[n[":errorType"],n[":errorCode"]]):t.apply(z,[n[":errorType"]]),t=null):!0===Y?z.navigate("error",{trigger:!0}):e[0]?(i===G.inodeAccessError&&s.add({className:"warning",message:q.get("inodeAccessError")}),ce(e[0])):z.navigate("",{trigger:!0,loadBaseUri:!0}):e=Object.keys(n).map(function(e){return n[e]})})(c,e.message)})}}),F.setRouter(z)},onError:function(e,n,i){if(s.options.autoHide=!1,e===G.noToken)s.add({message:q.standaloneNoToken,className:"error"});else if(e===G.ressourceAccess)s.add({message:q.standaloneLinkError,className:"error"});else if(e===G.inodeAccessError){(function(){const e=document.getElementsByClassName("alert-warning");let t=!1;for(let n=0;n<e.length;n++)if(e[n].innerText===q.inodeAccessError){t=!0;break}return t})()||s.add({className:"warning",message:q.get("inodeAccessError")})}else s.add({message:q.unexpectedError,className:"error"});t.setImmediate(function(){p.showEmptyView()})},onReroute:function(){F.rerouteFromSharedToken(I.getValue("SCDataMgtBaseUrl"),I.getValue("token"))},onDrives:function(){p.showFirstPanel(),p.getFirstPanel().selectedChildren.reset(),p.showSecondPanel(),I.setTitle(),o.fetch({reset:o.isEmpty(),merge:!1}),$&&t.setImmediate(function(){u.unSetInodeTable()})},onInodePreview:function(e,n,i,o){if(!o)return s.add({message:q.inodeAccessError,className:"warning"}),void(e?ce(e):z.navigate("",{trigger:!0,loadBaseUri:!0}));X=o,p.showLightbox({inode:o}),!0===Y&&o.fetch(),t.setImmediate(function(){var t=z.onInodeContent(e,n,i);t&&t.setTags.then(function(){$&&(u.focusOnSubjectsWithInode(o),u.deactivate())},function(){})})},onInodeContent:function(n,i,o){var a={},r=e.deferred(),s=e.deferred();if(a.fetchInodeTable=r.promise,a.setTags=s.promise,K===o)return t.setImmediate(function(){z.onInodePanel(n,i,o)}),$?(t.setImmediate(function(){s.resolve()}),a):void 0;K=o;var c=o.inodeTable,l=I.getValue("inodesSorting");if(c){var d,m=p.showSecondPanel(o).getSecondPanel();return m&&(d=m.elements.contentView.view),c.sort({sorting:l}),$&&t.setImmediate(function(){u.setTaggerProxy(n),d&&u.setInodeTable(d)}),!0===Y&&"sharedwithme"===o.id||c.fetch({reset:c.isEmpty(),merge:!0,queryReset:!0,withThumbnails:!0,drive:n,onComplete:()=>{c.sort({sorting:l}),r.resolve(),$&&t.setImmediate(function(){s.resolve()})},onFailure:()=>{r.reject(),s.reject()}}),t.setImmediate(function(){z.onInodePanel(n,i,o)}),a}},onInodePanel:function(e,n,i){p.showSecondPanel(i),function(e){let t="";e.isDsDrive||e.isCollabSpace?t=e.get("auth").platform.displayName:e.isDrivesHubDrive&&(t=e.get("title")),I.setTitle(t)}(e),!0!==Y&&t.setImmediate(function(){if(p.getFirstPanel()){var t=p.getFirstPanel().findChildViewByModel(e);p.getFirstPanel().selectedChildren.add(t),e.getInodesPath(i.id).then(function(e){var n=t.expandInodesPath(e);n[n.length-1].select(!0)})}})}}),(z=new H).listenTo(l,{"driveActions:onInstallApp":function(){d.publish("installApp",{appId:"X3DDRVN_AP",widgetId:I.id,silent:!0})},"driveActions:onLaunchApp":function(){d.publish("launchApp",{appId:"X3DDRVN_AP",widgetId:I.id,silent:!0})},"driveActions:onStorage":function(e){e&&e.getStorage()},"driveActions:onDisconnect":function(t){const n=p.getFirstPanel().selectedChildren,i=new e((e,n)=>{t.save({authenticated:!1},{wait:!1,onComplete:e,onFailure:n})});i.then(function(){const e=t.collection.find(e=>e.get("authenticated"));l.dispatchEvent("drivesView:onWannaChangeSelection",[e]),s.add({message:q.get("disconnectSuccess",{service:t.get("title")}),className:"success"})},function(){s.add({message:q.get("disconnectError",{service:t.get("title")}),className:"error"})}),n.length||i.then(function(){z.navigate("",{trigger:!0,loadBaseUri:!0})})},"inodeActions:onUpload":function(e,t,i){n.trackAction({model:e,eventAction:"upload",eventValue:t.length,contextView:i.viewContext,hasLinkedFiles:i.linkedFiles}),ee(e,t)},"inodeActions:onCreateFolder":function(e,t,n={}){const i=n.title;e.inodeTable.create({parentId:e.id,mimeType:t,title:n.title,description:n.description},{wait:!0,onComplete:function(e){e.collection&&e.cid!==e.collection.get(e.id).cid?s.add({message:q.get("folderAlreadyExists",{name:i}),className:"warning"}):(s.add({message:q.get("createSuccess",{name:i}),className:"success"}),l.dispatchEvent("inodePanelView:selectItemAmongItems",[e,{selectItemIfNoItemsSelected:!0,scrollToItem:!0}]))},onFailure:function(e,t){let n;t.error&&t.error.message&&-1!==t.error.message.indexOf("unique")?n=q.replace(q.get("createErrorFolderNameConflict"),{name:i}):(n=q.replace(q.get("createError"),{name:i}),"Access denied"===t.message&&(n+=": "+q.get("accessDenied"))),s.add({message:n,className:"error"})}})},"inodesActions:onShare":function(e,t){e[0].collection.shareChildren(e,t).then(function(e){s.add({message:q.replace(q.sharesSuccess),className:"success"})},function(e){e.map(function(e){s.add({message:q.replace(q.shareError,{name:e.inode.get("title")}),className:"error"})})})},"access:onTransferOwnership":function(e,t){var n=e.get("title");e.transferOwnership(t).then(function(e){var t=e.title,i="";n!==t&&(i=q.replace(q.changeOwnerAndRenameSuccess,{title:n,rename:t})),s.add({message:i+q.replace(q.changeOwnerSuccess,{user:e.fullnameowner,title:t}),className:"success"})},function(e){s.add({message:q.replace(q.changeOwnerError,{title:n}),className:"error"})})},"inodeActions:onEdit":function(e,t){var n=e.get("title");e.save({title:t.title,description:t.description},{wait:!0,onComplete:function(){s.add({message:q.replace(q.get("editSuccess"),{name:e.get("title")}),className:"success"})},onFailure:function(e,t){var i=t||{},o=q.replace(q.get("editError"),{name:n});i.error&&i.error.message&&"string"==typeof i.error.message&&(o+=": "+i.error.message),"Access denied"===i.message&&(o+=": "+q.get("accessDenied")),s.add({message:o,className:"error"})}})},"inodeActions:onCopy":function(t,o,a){var r=t.get("title");new e(function(e,n){o.inodeTable.create({duplicatedfrom:t.id,mimeType:t.get("mimeType")},Object.assign({action:"copy",wait:!0,onComplete:function(t,n){e(n)},onFailure:function(e,t){n(t)}},a))}).then(function(e){if(e&&e.expandDetails&&e.expandDetails.missingFiles&&e.expandDetails.missingFiles.length>0){var t=e.expandDetails.missingFiles;i.showMoreInfoPopup(t,"copied")}else s.add({message:q.replace(q.copySuccess,{name:r,toName:o.get("title")}),className:"success"})},function(e){var n;if(e&&e.error&&("linkInfoMissing"===e.error.errorCode||"mainNotIndexed"===e.error.errorCode)){var c=q.copy,d=c+" "+t.get("title"),u=e.error.failingFiles;return i.getConfirmationModal(d,u,c,function(){var e=Object.assign({},a);e.queryStrings={expand:"force"},l.dispatchEvent("inodeActions:onCopy",[t,o,e])},!1)}e&&"nameNotUnique"===e.error.errorCode?n=q.replace(q.copyErrorNameConflict,{name:r,toName:o.get("title")}):(n=q.replace(q.copyError,{name:r,toName:o.get("title")}),"quotaExceed"===e.error.errorCode?n+=": "+q.allocatedDiskSpaceExceeded:e.error.details&&("insufficientFilePermissions"===e.error.details.reason?n+=": "+q.get("accessDenied"):"duplicateContentName"===e.error.details.reason&&(n=q.replace(q.get("copyErrorNameConflict"),{name:r,toName:o.get("title")})))),s.add({message:n,className:"error"})}),n.trackAction({model:t,eventAction:"copy",hasLinkedFiles:a.queryStrings&&"true"===a.queryStrings.expand?"true":"false"})},"inodeActions:onMove":function(e,t,i){ie(e,t,i),n.trackAction({model:e,eventAction:"move",hasLinkedFiles:i&&i.queryStrings&&"true"===i.queryStrings.expand?"true":"false"})},"inodesActions:onMove":function(e,t){oe(e,t),n.trackAction({model:e[0],eventAction:"move",eventValue:e.length,hasLinkedFiles:"false"})},"inodesActions:onDnDMove":function(e,t){var i=[];if(e.map(function(e){i.push(t.drive.getInode({id:e}))}),1===i.length){var o={data:{}};o.data.parentid=t.id,ie(i[0],t,o)}else oe(i,t);n.trackAction({model:i[0],eventAction:"move",eventValue:i.length,contextView:"dnd",hasLinkedFiles:"false"})},"inodeActions:onViewProperties":function(e){const t=p.getSecondPanel();t&&t.handleItemSelection(e),function(e){I.getBool("isInodePanelSideBarOpened")||I.dispatchEvent("onToggleInodePanelSideBarVisibility");var t=p.getSecondPanel();t&&t.elements&&t.elements.detailView&&t.elements.detailView.navigateToTab(e)}("properties")},"inodeActions:onPreview":function(e,t){const n=e.drive;if(e.drive.isCollabSpace)ae(n,e);else if(L.isLinkedFile(e)){const i=()=>{const t={queryStrings:{expand:"force"}};l.dispatchEvent("inodeActions:onPreview",[e,t])};se(e,t,ae.bind(null,n,e),i)}else ae(n,e)},"inodeActions:onEditDocument":function(e){const t=e.drive;V.isAndroidOrIphone()?s.add({message:q.get("ODdisabledActions"),className:"primary"}):(e.editMode=!0,ae(t,e))},"inodeActions:onDelete":function(t,o){var a=t.drive,r="delete";t.isContainer()&&z.navigate(a.getInodePanelContentURI(t.inodeTable.dotDot()),{trigger:!0}),function(t,n){var o=t.get("title"),a=t.collection;new e(function(e,r){t.destroy(Object.assign({wait:!0,onComplete:function(n,s){if(s&&"failure"===s.status&&s.report){for(var c=" ",l=0;l<s.report.length;l++)c+=s.report[l].error+" ";return a.add(t),r({msg:q.replace(q.errorDelete,{title:o,errorMessage:c})})}if(s&&s.expandDetails&&s.expandDetails.missingFiles&&s.expandDetails.missingFiles.length>0){var d=s.expandDetails.missingFiles;i.showMoreInfoPopup(d,"deleted")}var u=s&&s.expandDetails&&s.expandDetails.expandedIds?s.expandDetails.expandedIds:null;e(u)},onFailure:function(e,o){if(o&&o.error&&("linkInfoMissing"===o.error.errorCode||"mainNotIndexed"===o.error.errorCode)){var a=q.deleteText,s=a+" "+t.get("title"),c=o.error.failingFiles;return i.getConfirmationModal(s,c,a,function(){var e=Object.assign({},n);e.queryStrings={expand:"force"},l.dispatchEvent("inodeActions:onDelete",[t,e])},!1)}r(o)},onTimeout:function(e){r({reason:"timeout"})}},n))}).then(function(e){if(s.add({message:q.replace(q.deleteSuccess,{name:o}),className:"success"}),e)return{expandedIds:e,collection:a}},function(e){if(e&&"timeout"===e.reason){var n=q.replace(q.get("deleteTimeout"),{name:o});s.add({message:n,className:"warning"})}else e&&"Access denied"===e.message?s.add({message:q.replace(q.deleteError,{name:o})+": "+q.get("accessDenied"),className:"error"}):t.isCollabSpace()?s.addAndCallback({message:q.replace(q.deleteError,{name:o}),className:"error",callback:function(){return"check"===V.getAppBehaviour("deleteCS")?t.getDetailsUndeletedCS(t).then(function(e){var t={};return t.items=e,t.message=q.DetailsMsgFailureCS,new c(t)}):t.checkContent().then(function(e){return new M(t,e)},function(e){var t=e&&e.errorMessage?e.errorMessage:"";":Timeout"===t?s.add({message:q.unexpectedError+t,className:"warning"}):s.add({message:q.unexpectedError+t,className:"error"})})}}):s.add({message:e&&e.msg?e.msg:q.replace(q.deleteError,{name:o}),className:"error"})}).then(ue)}(t,o),"myCollabSpaces"===t.get("parentId")&&(r="deleteCS"),n.trackAction({model:t,eventAction:r,hasLinkedFiles:o&&o.queryStrings&&"true"===o.queryStrings.expand?"true":"false"})},"inodesActions:onDelete":function(e,t){var i=e[0].collection,o=Object.assign({wait:!1},t);i.destroyChildren(e,o).then(function(){s.add({message:q.deletesSuccess,className:"success"})},function(t){var n=q.get("deletesError",{nbFail:t.length,nbItems:e.length}),i=e.length-t.length;s.addAndCallback({message:n,className:"error",callback:function(){var e=q.get("deletesSuccessDetail",{nbSuccess:i})+"</br> </br>";e+=q.get("deletesErrorDetail")+"</br> </br>";var n=[];return t.map(function(e){return n.push(e.get("title")),n}),new c({message:e,items:n})}})}),n.trackAction({model:e[0],eventAction:"delete",eventValue:e.length,hasLinkedFiles:"false"})},"inodeScrollTableView:onDrop":function(e,t){n.trackAction({model:e.dot(),eventAction:"upload",eventValue:t.length,contextView:"dnd"}),ee(e.dot(),t)},"inodeScrollTableView:onFolderDrop":function(e,t){n.trackAction({model:e,eventAction:"folderUpload",contextView:"dnd"}),O.processFolderDnD(e,t)},onRefresh:function(){le()},"permission:onRemoveLinkAuthorization":function(e,t){var n=Object.assign({},t),i=e.get("displayName");n.messageSuccess=q.replace(q.shareRemoveSuccess,{name:i}),n.messageFailure=q.replace(q.shareRemoveError,{name:i}),de(e,n)},"inodeActions:onChangeAlias":function(e,t){var n=e.get("alias");e.save({alias:t.title,description:t.description},{wait:!0,onComplete:function(){s.add({message:q.replace(q.get("editSuccess"),{name:e.get("alias")}),className:"success"})},onFailure:function(e,t){var i=t.error,o=q.replace(q.get("editError"),{name:n});i&&i.message&&"string"==typeof i.message&&(o+=": "+i.message),s.add({message:o,className:"error"})}})},"inodeActions:onCreateCS":function(t,n,i){new e(function(e,o){t.inodeTable.create({parentId:t.id,csAtrributes:i,mimeType:n},{wait:!0,onComplete:e,onFailure:o,onTimeout:function(e){o({reason:"timeout"})}})}).then(function(e){s.add({message:q.replace(q.CScreateSuccess,{name:i.title}),className:"success"})},function(e){"timeout"===e.reason?s.add({message:q.replace(q.CScreateTimeout,{name:i.title}),className:"warning"}):s.add({message:q.replace(q.CScreateError,{name:e.get("csAtrributes").title}),className:"error"})})},"access:onRemoveCollabSpaceMember":function(e,t){var n=Object.assign({},t),i=e.collection._parentInode.get("title"),o=e.get("title");e.collection&&e.collection._parentInode&&e.collection._parentInode.get("parentId")===y.ids.myCollabSpaces&&(n.messageSuccess=q.replace(q.shareRemoveSuccessCS,{name:o,CSTitle:i}),n.messageFailure=q.replace(q.shareRemoveErrorCS,{name:o})),de(e,n)},"access:onChangeCollabSpaceMemberRole":function(t,n){var i=t.get("role");new e(function(e,i){t.save({role:n},{wait:!0,onComplete:e,onFailure:i})}).then(function(){var e=t.get("role").value;s.add({message:q.replace(q.shareSucessCS,{userName:t.get("title"),name:t.collection._parentInode.get("title"),access:q[e]}),className:"success"})},function(e){t.set("role",i),s.add({message:e&&e.message?e.message:q.replace(q.shareErrorCS,{name:t.get("collabspace")}),className:"error"})})},"access:onChangeMainOwnerCS":function(t){if(!t)throw new Error("Missing input");var n=t.collection._parentInode;new e(function(e,i){n.save({owner:{login:t.get("id")}},{wait:!0,onComplete:e,onFailure:i})}).then(function(){t.set("accessright","leaderOwner"),t.set("actions",[]),s.add({message:q.replace(q.shareSucessCS,{userName:t.get("title"),name:inode.collection._parentInode.get("title"),access:q.leaderOwner}),className:"success"})},function(e){s.add({message:e&&e.message?e.message:q.replace(q.shareErrorCS,{name:t.get("collabspace")}),className:"error"})})},"inodeActions:onEditCS":function(t,n,i){new e(function(e,o){t.save({actualName:t.id,csAtrributes:i,mimeType:n},{wait:!0,onComplete:e,onFailure:function(e,t,n){s.add({message:q.replace(q.CSEditError,{name:e.get("csAtrributes").title}),className:"error"})}})}).then(function(e){s.add({message:q.replace(q.CSEditSuccess,{name:e.get("title")}),className:"success"})},function(e){s.add({message:q.replace(q.CScreateError,{name:e.get("title")}),className:"error"})})},"inodeActions:onChangeThumbnail":function(t,n,i){new e(function(e,i){t.save({actualName:t.id,file:n[0],action:"changeThumbnail"},{wait:!0,onComplete:e,onFailure:i})}).then(function(e){s.add({message:q.replace(q.CSEditThumbnailSuccess,{name:e.get("title")}),className:"success"})},function(e){s.add({message:e.message?e.message:q.replace(q.CSEditThumbnailError,{name:e.get("title")}),className:"error"})})},"iteration:onRestore":function(e){var t=e.get("title");e.restoreVersion().then(function(){s.add({message:q.replace(q.restoreSuccess,{name:t}),className:"success"})},function(){s.add({message:q.replace(q.restoreFail,{name:t}),className:"error"})})},"inodeActions:onUpdate":function(t,n){let i=n[0];new e((e,o)=>{"true"!==I.getValue("is3DSpaceWidget")&&t.get("fileExtension").toLowerCase()!==n[0].name.split(".").pop().toLowerCase()?(s.add({message:q.get("updateDifferentExtension",{extension:t.get("fileExtension")}),className:"error"}),o()):"true"!==I.getValue("is3DSpaceWidget")&&t.get("title")!==n[0].name?(U.dialog({title:q.get("update"),body:q.get("updateDifferentFileNames",{nameA:t.get("title"),nameB:n[0].name}),buttons:[{className:"primary",value:q.get("update"),action:function(t){t.hide(),e()}},{value:q.get("cancel"),action:function(e){e.hide(),o()}}]}),i=new File([i],t.get("title"),{type:i.type})):e()}).then(function(){a.addUploadTask(t),t.sync("create",t,{file:i,action:"update",onComplete:function(e){t.set(t.parse(e)),t.dispatchEvent("onChange:thumbnail"),t.dispatchEvent("onUpdateCompleted"),"true"===I.getValue("is3DSpaceWidget")&&s.add({message:q.replace(q.updateSuccess,{title:t.get("title")}),className:"success"})},onFailure:function(e){t.dispatchEvent("onError",t);let n=q.get("updateError",{title:t.get("title")});e&&e.error&&"quotaExceed"===e.error.errorCode&&(n+=": "+q.get("allocatedDiskSpaceExceeded")),s.add({message:n,className:"error"})}})})},"inodeActions:onEditContent":function(t,n){new e(function(e,i){t.save({inode:t,attributes:n,action:"editContent"},{wait:!0,onComplete:e,onFailure:i})}).then(function(e){s.add({message:q.replace(q.succesEditingContent,{name:e.get("title")}),className:"success"})},function(){s.add({message:q.replace(q.errorEditingContent,{name:t.get("title")}),className:"error"})})},"inodeActions:removeFromMyDrive":function(e){if(!e)throw new Error("Missing input");if(e.isContainer()){var t=e.drive,n=e.drive.getInode(e.get("parentId"));z.navigate(t.getInodePanelContentURI(n),{trigger:!0})}},"inodeActions:openLocation":function(e,t){if(!e||!t)throw new Error("Missing input");const n=p.getLightbox(),i=!!n&&n.isLightboxVisible();let o;e.isFolder()||!e.isFolder()&&!i?z.navigate(t,{trigger:!0}):!e.isFolder()&&i&&l.dispatchEvent("lightbox:onCancelClick",[t]);const a=setTimeout(()=>{clearTimeout(o),s.add({className:"warning",message:q.get("cannotRetrieveContentLocation")})},25e3);!function t(){K.get("id")===e.get("parentContainerId")?function t(){const n=e.drive.getInode({id:e.get("id"),containerToSearchIn:e.get("parentContainerId")}),i=p.getSecondPanel();i&&n&&n.get("parentId")?(i.handleItemSelection(n),function e(){const t=i.getElementFromModel(n);t?(clearTimeout(a),t.scrollIntoView({block:"nearest"})):o=setTimeout(e,500)}()):o=setTimeout(t,500)}():o=setTimeout(t,500)}()},"drivesView:onWannaChangeSelection":function(t){new e((e,i)=>{if(n.trackNavigation({eventAction:"switch-service",tenant:t.get("id")}),t.get("authenticated"))return e();t.save({authenticated:!0},{wait:!0,onComplete:e,onFailure:i})}).then(()=>{t.get("auth")&&t.get("auth").platform&&t.get("auth").platform.id&&I.setValue("x3dPlatformId",t.get("auth").platform.id),ce(t)},()=>{s.add({message:q.get("authenticationError",{service:t.get("title")}),className:"error"}),z.navigate("",{trigger:!0,loadBaseUri:!0})})},"driveView:onNodeClick":function(e){var t=e.drive;n.trackNavigation({eventAction:"tree"}),I.getValue("is3DSpaceWidget")&&e.isCollabSpace()&&(e.securityContext(e),e.get("solution")!==y.boType.team&&s.add({message:q.warningNonOCDX,className:"warning"})),z.navigate(t.getInodePanelContentURI(e),{trigger:!0})},"driveTreeView:onPreExpand":function(e){(!I.getValue("is3DSpaceWidget")||I.getValue("is3DSpaceWidget")&&!e.isCollabSpace())&&e.inodeTable.fetch({reset:!1,merge:!1,remove:!1})},"inodePanelView:onSort":function(e){const t=p.getSecondPanel();if(!t)return;const n=t.model.inodeTable;n&&(I.setValue("inodesSorting",e),n.sort({sorting:e}),p.getSecondPanel().refreshTopBarView())},"inodePanelView:onPathClick":function(e){n.trackNavigation({eventAction:"breadcrumb"}),z.navigate(e,{trigger:!0})},"inodePaneView:onChangeSelection":function(e,t){if(e,!t.length)return $&&u.unfocus(),d.publish("resetObject"),void d.publish("resetX3DContent");$&&u.focusOnSubjectsWithInode(t),!0!==e.isCollabSpace()&&(d.publish("setObject",W.getObject(e)),d.publish("setX3DContent",W.get3DXContent(t)))},"inodeTableScrollView:onNextPage":function(e){e.getNextPage({evnt:"onFilterChange",merge:!1,remove:!1})},"inodeAllAccessesView:onNextPage":function(e){e.getNextPage({permissions:e,merge:!1,remove:!1})},"inodeView:onDblClick":function(e,t){if(e.isContainer()||e.drive.isCollabSpace)re(e);else if(!e.isContainer()&&"TRASH"!==e.get("root")&&e.getActionIds().includes("preview"))if(L.isLinkedFile(e)){const n=()=>{const t={queryStrings:{expand:"force"}};l.dispatchEvent("inodeView:onDblClick",[e,t])};se(e,t,re.bind(null,e),n)}else re(e)},"inodeFileHistoryView:onVersions":function(e){e.inodeVersions.fetch({reset:!0,onFailure:function(){s.add({message:q.contentHistoryError,className:"error"})}})},"inodeDetailAccessesView:onAccesses":function(e){e.permissions.fetch({inode:e,firstLoad:!0,onFailure:function(){s.add({message:q.replace(q.permissionError,{name:e.get("title")}),className:"error"})}})},"lightbox:onPreviewError":function(){s.add({message:q.replace(q.previewError),className:"error"})},"lightbox:onCancelClick":function(e){$&&(u.unfocus(),u.activate()),p.hideLightbox(),z.navigate(e,{trigger:!1}),X=void 0},"lightbox:onArrowClick":function(e){z.navigate(e,{trigger:!0})},"lightbox:onPlay":function(e){p.updateLightbox(e,!0)},"lightbox:onAnnotationShared":function(e){const t=p.getLightbox();t.showCommentsPanel(!0);const n=t.getCommentsPanel();let i,o=!1;setTimeout(function(){clearTimeout(i),o||s.add({message:q.annotationSharedError,className:"error"})},25e3),function a(){t.isCommentsPanelVisible()&&n.view._successFullInit?(o=!0,n.view.setActiveFieldContent({media:[{type:"annotation",file:e.screenshot,data:{annotationFile:e.annotation}}]})):i=setTimeout(a,100)}()},"socialToolbar:onPreviewAnnotation":function(e,t){if(e.editMode)s.add({message:q.get("cannotLoadAnnotationInEditMode"),className:"warning"});else{e.annotation=t;const n=p.getLightbox(),i=e.drive,o={trigger:!0};n&&n.isLightboxVisible()&&(o.force=!0,n.getContainer().$el.getBoundingClientRect().width<639&&n.showCommentsPanel(!1)),z.navigate(i.getInodePreviewURI(e),o)}},"preferences:onEdit":function(){const e=window.parent.document.getElementById("m_"+I.id).getElementsByClassName("form-vertical form")[0],t=X?X.get("title"):K.get("title");if(e){const n=this;require(["DS/W3DDriveApp/Views/PreferencesView"],function(i){new i({widget:I,currentModelTitle:t,currentNavigationFragment:n.getLastFragment()}).inject(e,"bottom")})}},"inodeActions:onShareAccess":function(t,n,i){var o=t.get("title");e.all(n.map(function(n){return new e(function(e,o){var a=t.permissions.findWhere({id:n.id});a?a.save(n,Object.assign({wait:!0,onComplete:e,onFailure:o},i)):t.permissions.create(n,Object.assign({wait:!0,onComplete:e,onFailure:o},i))})})).then(function(){s.add({message:q.replace(q.shareElemSuccess,{name:o}),className:"success"}),t.set("shared",!0)},function(e){Array.isArray(e)||(e=[e]);var t=e.some(function(e){return"timeout"===e.reason});if(n.length!==e.length||t){var i=e.filter(function(e){return"function"==typeof e.permission.get}).map(function(e){return e.permission.get("displayName")});s.add({message:q.replace(q.shareErrorMembers,{name:o,members:i.join(", ")}),className:"error"}),t&&s.add({message:q.replace(q.shareTimeout,{name:o}),className:"warning"})}else s.add({message:q.replace(q.shareError,{name:o}),className:"error"})})},"access:onUpdate":function(t,n,i){var o=t.get("accessright");new e(function(e,o){t.save({accessright:n},Object.assign({wait:!0,onComplete:e,onFailure:o},i))}).then(function(){s.add({message:q.replace(q.shareSucess,{access:q[t.get("accessright")],name:t.collection._parentInode.get("title"),userName:t.get("title")}),className:"success"})},function(e){t.set("accessright",o),s.add({message:e&&e.message?e.message:q.replace(q.shareError,{name:t.collection._parentInode.get("title")}),className:"error"})})},"access:onRemove":function(e,t){var n=Object.assign({},t),i=e.get("title");n.messageSuccess=q.replace(q.shareRemoveSuccess,{name:i}),n.messageFailure=q.replace(q.shareRemoveError,{name:i}),de(e,n)},"inodesActions:onShareAccess":function(e,t){e[0].collection.shareChildren(e,t).then(function(){s.add({message:q.replace(q.sharesSuccess),className:"success"})},function(t){var n=q.get("sharesError",{nbFail:t.length,nbItems:e.length}),i=e.length-t.length;s.addAndCallback({message:n,className:"error",callback:function(){var e=q.get("sharesSuccessDetail",{nbSuccess:i})+"</br> </br>";e+=q.get("sharesErrorDetail")+"</br> </br>";var n=[];return t.map(function(e){return n.push(e.inode.get("title")),n}),new c({message:e,items:n})}})})},"inodeActions:removeOwnAccess":function(e){U.dialog({title:q.get("revokeAccess"),body:q.get("revokeOwnAccessDescription"),buttons:[{className:"primary",value:q.get("Revoke"),action:function(t){var n=e.drive.get("user").displayName;e.permissions.removeOwnAccess({onComplete:function(){s.add({message:q.replace(q.get("shareRemoveSuccess"),{name:n}),className:"success"}),e.collection&&e.collection.remove(e)},onFailure:function(){s.add({message:q.replace(q.get("shareRemoveError"),{name:n}),className:"error"})}}),t.hide()}},{value:q.get("cancel"),action:function(e){e.hide()}}]})},"inodeActions:onAddToFavorites":function(e){te(e)},"inodesActions:onAddToFavorites":function(e,t){if((t=t||{}).isDnD&&t.favoritesRootInode){const n=t.favoritesRootInode;e=e.map(e=>n.drive.getInode({id:e.inodeId,containerToSearchIn:e.rootId}))}te(e)},"inodeActions:onRemoveFromFavorites":function(e){ne(e)},"inodesActions:onRemoveFromFavorites":function(e){ne(e)}}),T.setw3dDriveView(p),T.setRouter(z),x.subscribe("3ddrive.resfresh.notif",function(e){I.getValue("is3DSpaceWidget")||T.processEvent(e,e.lastmodifier===I.getValue("3ddrive_uuid"))}),I.body.empty(),!0===Y&&document.body.addClassName("standalone");var pe=!1;let me,ge,fe=[];!0===Y?(J=[{key:"inode-detail-properties",view:A,nls:q.properties,icon:"doc-text"}],pe=!0,fe=["title","modifiedDate","createdDate","size","type","creator"],me="title-a"):"true"===I.getValue("is3DSpaceWidget")?(J=[{key:"inode-detail-properties",view:C,nls:q.properties,icon:"doc-text"},{key:"inode-detail-history",view:v,nls:q.history,icon:"navigation-history",action:Q.actionPubIds.viewHistory},{key:"inode-detail-accesses",view:g,nls:q.get("Members"),icon:"users",action:Q.actionPubIds.viewAccesses},{key:"inode-detail-comments",view:D,nls:q.comments,icon:"comment",action:Q.actionPubIds.comment},{key:"inode-detail-analytics",view:w,nls:q.analytics,icon:"chart-bar",action:Q.actionPubIds.viewAnalytics}],fe=["title","modifiedDate","createdDate"],me="modifiedDate-a",ge=B):(J=[{key:"inode-detail-properties",view:A,nls:q.properties,icon:"doc-text"},{key:"inode-detail-history",view:f,nls:q.history,icon:"navigation-history",action:Q.actionPubIds.viewHistory},{key:"inode-detail-accesses",view:m,nls:q.get("Members"),icon:"users",action:Q.actionPubIds.viewAccesses},{key:"inode-detail-access-link",view:S,nls:q.get("ShareWithExternal"),icon:"forward-globe",action:Q.actionPubIds.viewShareWithExternal},{key:"inode-detail-comments",view:D,nls:q.comments,icon:"comment",action:Q.actionPubIds.comment}],fe=["title","modifiedDate","createdDate","size","type","creator"],me="title-a",ge=j);var ve={detailViewsList:J,defaultView:"inode-detail-properties"},De={viewSpecs:{inodePanelView:{detailViewSpecs:ve,contentViewSpecs:{emptyView:ge,quotaExceededView:h,filterType:I.getValue("is3DSpaceWidget")?"none":"default"},multisel:!I.getValue("is3DSpaceWidget"),sortingList:fe,sorting:I.getValue("inodesSorting")?I.getValue("inodesSorting").id:me},hideFirstPanel:pe,lightboxView:{detailViewSpecs:ve}}};return p.render(De).inject(I.body),z});