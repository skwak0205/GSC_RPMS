define("DS/MPFAddressFormComponent/AddressCard",["UWA/Core","UWA/Class/View","DS/MPFAddressModel/AddressModel","DS/MPFPersonModel/PersonModel","DS/MPFCompanyModel/CompanyModel","DS/MPFServices/ObjectService","DS/MPFError/BadArgumentError","i18n!DS/MPFAddressFormComponent/assets/nls/AddressFormComponent","css!DS/MPFUI/MPFUI"],(e,t,s,n,i,r,d,o)=>{"use strict";const a={ON_SELECTED:"onSelected"},l=t.extend({className:"mpf-address-card",domEvents:{click:"cardClicked"},setup(t){if(t||(t={}),!e.is(t.legalEntity))throw new Error("options.legalEntity is required");if(r.requiredOfPrototype(this.model,s,"this.model must be an AddressModel"),!Object.prototype.isPrototypeOf.call(i.prototype,t.legalEntity)&&!Object.prototype.isPrototypeOf.call(n.prototype,t.legalEntity))throw new d("AddressCard options.legalEntity must be a CompanyModel or a PersonModel");this.legalEntity=t.legalEntity,this.country=t.country,this.model.get(s.Fields.LINE0)||this.model.set(s.Fields.LINE0,this._getAddressTitle())},render(){const t=[s.Fields.LINE1,s.Fields.LINE2,s.Fields.LINE3,s.Fields.LINE4,s.Fields.CITY,s.Fields.COUNTY,s.Fields.STATE,s.Fields.POSTAL_CODE,s.Fields.COUNTRY].map(t=>{if(t===s.Fields.STATE){const s=o[this.model.getCountry()+this.model.getState()];return e.is(s)?s:this.model.get(t)}return t===s.Fields.COUNTRY&&e.is(this.country)?this.country:this.model.get(t)}).filter(e=>e&&e.length>0).map(t=>e.createElement("div",{class:"mpf-address-card-line",text:t}));return t.unshift(e.createElement("p",{class:"mpf-address-card-line title",text:this.model.get(s.Fields.LINE0)})),this.container.setContent(t),this},destroy(){this.model=null,this._parent(),this.container=null},cardClicked(){this.dispatchEvent(a.ON_SELECTED,this.model)},_getAddressTitle(){return"CompanyModel"===this.legalEntity._type?this.legalEntity.getName():this.legalEntity.getFirstName()+" "+this.legalEntity.getLastName()}});return l.Events=Object.freeze(a),l}),define("DS/MPFAddressFormComponent/AddressFormComponent",["UWA/Core","UWA/Promise","UWA/Element","UWA/Class/View","DS/UIKIT/Input/Text","DS/UIKIT/Input/Select","DS/MPFAddressModel/AddressModel","DS/MPFCountryModel/CountryFactory","DS/MPFCountrySelectComponent/CountrySelectComponent","DS/MPFError/BadArgumentError","i18n!DS/MPFAddressFormComponent/assets/nls/AddressFormComponent","css!DS/MPFUI/MPFUI"],function(e,t,s,n,i,r,d,o,a,l,c){"use strict";return n.extend({tagName:"form",className:"mpf-form mpf-address-form",setup:function(s){var n,i=this;if(!e.is(s))throw new Error("Parameter options is required");if(!e.is(s.constraints))throw new Error("Parameter options.constraints is required");this._parent(s),this.constraints=s.constraints,this.possibleAddresses=[],this.countryMode=s.countryMode||"seller",this.countryReadOnly=!0===s.countryReadOnly,this.hideCountry=!0===s.hideCountry,e.is(this.collection)&&(this.collection.isEmpty()?e.is(this.model)||(this.model=new this.collection.model({},{dataProxy:this.collection.modelDataProxy,constraints:this.collection.constraints})):this.model=this.collection.first()),this.countryFactory=new o(this.model.dataProxy.connector),this.countries=this.countryFactory.createCollection(this.countryMode),this.waitForCountries=new t(function(e,t){i.countries.fetch({onComplete:e,onFailure:function(e,s){t()}})}),this.hideCountry||(this.countrySelectComponent=new a({countries:this.countries,model:this.model,preSetCountry:s.preSetCountry,readOnly:this.countryReadOnly})),this.readOnly=!0===s.readOnly,this.listenTo(this.model,"onChange:country",function(e){this.countrySelectComponent&&this.countrySelectComponent.select&&(n=this.countrySelectComponent.select.elements.input),this._onChangeCountry(n)})},destroy:function(){this.countrySelectComponent.destroy(),this.countrySelectComponent=null,this.stopListening(this.model),this.model=null,this._parent(),this.container=null},domEvents:{change:"onChange"},onChange:function(e){var t,s,n,i;i=(n=e?e.target:void 0)&&"country"===n.name,s=this._getAttributes(),i?this.model.set({country:s.country}):this.model.set(s),e&&this._validateField(n);var r=this.model.get("country");if(!this.possibleAddresses.hasOwnProperty(r)||!i){t=this.constraints.get(r)?Object.keys(this.constraints.get(r).pick(["addressLine1","addressLine2","addressLine3","addressLine4"])):Object.keys(this.constraints.get("DEFAULT").pick(["addressLine1","addressLine2","addressLine3","addressLine4"]));var d=[];s.hasOwnProperty("addressLine1")&&(d.push(s.addressLine1),delete s.addressLine1),s.hasOwnProperty("addressLine2")&&(d.push(s.addressLine2),delete s.addressLine2),s.hasOwnProperty("addressLine3")&&(d.push(s.addressLine3),delete s.addressLine3),s.hasOwnProperty("addressLine4")&&(d.push(s.addressLine4),delete s.addressLine4),this.possibleAddresses.hasOwnProperty(r)||(this.possibleAddresses[r]={});for(var o=0;o<t.length;o++)d.length>0&&(this.possibleAddresses[r][t[o]]=d.shift());for(var a=Object.keys(s),l=0;l<a.length;l++){var c=a[l];this.possibleAddresses[r][c]=s[c]}}},render:function(t){var s,n=this,i=[];return this.waitForCountries.then(function(){n.countrySelectComponent&&i.push(n.countrySelectComponent.render()),s=n._createEntries(),Array.prototype.push.apply(i,s),n.form=e.createElement("fieldset",{html:i}),n.readOnly&&n.form.setAttributes({disabled:!0}),n.container.setContent(n.form);var r=n._getAttributes();n.model.set(r),n.countrySelectComponent&&void 0!==t&&void 0!==t.changedInput&&n._validateField(n.countrySelectComponent.select.elements.input),n.dispatchEvent("onRender",this)},function(){n.dispatchEvent("onError","Cannot fetch country list")}),this},save:function(t){var s;this.validate(t)?e.is(this.collection)&&this.model.isNew()?this.collection.create(this.model,t):this.model.save(null,t):"function"==typeof(s=t.onFailure)&&s()},savePromise:function(e){var s,n,i=t.deferred();return e||(e={}),s=e.onComplete,e.onComplete=function(e,t,n){"function"==typeof s&&s(arguments),i.resolve({model:e,response:t,options:n})},n=e.onFailure,e.onFailure=function(e,t,s){var r;"function"==typeof n&&n(arguments),t&&t.errorCode&&"Error.Tax"===t.errorCode&&(r=new l(c.get("invalidTaxArea"))),i.reject(r)},this.save(e),i.promise},validate:function(e){for(var t,s=0;s<this.inputs.length;s++)t=this._validateField(this.inputs[s].elements.input);return!(t&&t.length&&t.length>0)},clear:function(){var t;this.model.isNew()&&(t=e.clone(d.prototype.defaults),this.countryReadOnly&&delete t[d.Fields.COUNTRY],this.model.set(t),this.possibleAddresses=[],this.render())},_createEntries:function(){this.inputs=[],this.countrySelectComponent&&this.inputs.push(this.countrySelectComponent.select);var t,s,n=[],i=this,r=this.model.get("country"),d=this.constraints.get(r),o=0,a={};if(e.is(d)||(d=this.constraints.get("DEFAULT")),e.is(d)){var l=1;d.keys().filter(function(e){return"country"!==e&&void 0!==i.model.get(e)}).forEach(function(e){var h,u=Array.isArray(d.get(e))?d.get(e)[0]:d.get(e),m="Address Line "===c.get(e)?++o:"";s=u.isRequired()?c.get(e)+m+'<em class="mpf-required">*</em>':c.get(e)+m,0===Object.keys(i.possibleAddresses).length?(t=i.model.get(e),a[e]=t):(h=i.possibleAddresses[r],t=h&&h[e]||"");var p=u.getPattern();"state"===e&&p.length>0&&p.split("|").length>1?n.push(i._createStateField(s,e,t,p.replace(/\^|\$/g,"").split("|"),r)):n.push(i._createEntry(s,e,t,l++))}),Object.keys(a).length>0&&(this.possibleAddresses[r]=a)}return n},_createEntry:function(t,s,n,r){var d=new i({name:s,value:n});return this.inputs.push(d),e.createElement("div",{class:"mpf-addressEntry",html:[{class:"mpf-labels",html:[{class:"mpf-addressLabelSpan"+r,html:t,tag:"span"},{class:"mpf-addressInlineInput",html:d,tag:"div"}],tag:"label"}]})},_createStateField:function(t,s,n,i,d){var o=new r({name:"state",placeholder:c.get("statePlaceholder"),disabled:this.readOnly});this.inputs.push(o);for(var a=0;a<i.length;a++)o.add({label:c.get(d+i[a]),selected:void 0!==this.possibleAddresses[d]?this.possibleAddresses[d].state===i[a]:this.model.get("state")===i[a],value:i[a]});return e.createElement("div",{class:"mpf-addressEntry",html:[{class:"mpf-addressStateLabel",html:t,tag:"span"},{class:"mpf-addressStateDiv",html:o,tag:"div"}]})},_onChangeCountry:function(e){var t,s,n;(t=this.container.getElement('input[name="postalCode"]'))&&(t.value=""),(s=this.container.getElement('input[name="city"]'))&&(s.value=""),(n=this.container.getElement('select[name="state"]'))&&(n.selectedIndex=0),this.render({changedInput:e})},_validateField:function(t){var s,n="select"===t.getTagName()?t.getParent():t,i="select"===t.getTagName()?"mpf-addressSelectError":"mpf-addressInputError";if(n){n.setStyle("border",""),n.setStyle("border-radius","");for(var r=n.getParent().getElementsByTagName("p"),d=0;d<r.length;d++)n.getParent().removeChild(r[d])}var o=this.model.validate();return void 0!==o&&(s=o.filter(function(e){return e.field===t.name})).length>0&&(n&&(n.setStyle("border","1px solid red"),n.setStyle("border-radius","4px")),e.createElement("p",{class:i,text:c.get(s[0].field+"Error")}).inject(n.getParent())),o},_getAttributes:function(){return this.container.getElements("input").concat(this.container.getElements("select")).reduce(function(e,t){return e[t.name]="country"===t.name&&""===t.value.trim()?"DEFAULT":t.value.trim(),e},{})}})}),define("DS/MPFAddressFormComponent/AddressFormComponentV2",["UWA/Core","UWA/Promise","UWA/Class/View","DS/MPFServices/ObjectService","DS/MPFAddressModel/AddressModel","DS/MPFAddressConstraintsModel/AddressConstraintsCollection","DS/MPFCountryModel/CountryCollection","DS/MPFView/FieldTextInputV2","DS/MPFView/FieldSelectInputV2","DS/MPFError/ValidationError","DS/MPFError/BadArgumentError","i18n!DS/MPFAddressFormComponent/assets/nls/AddressFormComponent","css!DS/MPFUI/MPFUI"],function(e,t,s,n,i,r,d,o,a,l,c,h){"use strict";return s.extend({tagName:"form",className:"mpf-form mpf-address-form-v2",domEvents:{'change select[name="country"]':"_onCountryChange"},setup:function(e){e||(e={}),this._checkRequiredParameters(e),this.addressModel=e.addressModel,this.addressConstraints=e.addressConstraints,this.countries=e.countries,this.readOnly=!0===e.readOnly,this.countryReadOnly=!0===e.countryReadOnly,this.horizontalLayout=!0===e.horizontalLayout,this.preSetCountry=e.preSetCountry,this.keepErrorMessages=!0===e.keepErrorMessages,this.showPhoneNumber=!0===e.showPhoneNumber,this._createInputs()},render:function(){this.horizontalLayout&&this.container.addClassName("mpf-horizontal");const e=[];return this.inputs.forEach(function(t){e.push(t.render())}),this.container.setContent(e),this._applyCountryFormatAddress(),this},validate:function(){const e=this;let t,s=!0;return this.inputs.forEach(function(n){n.fieldName!==i.Fields.STATE&&(n.container.isHidden()?""!==e.addressModel.get(n.fieldName)&&e.addressModel.set(n.fieldName,""):(t=n.validate(),s=s&&t.isValid))}),this.stateSelectInput.container.isHidden()&&this.stateTextInput.container.isHidden()?""!==e.addressModel.get(i.Fields.STATE)&&e.addressModel.set(i.Fields.STATE,""):this.stateSelectInput.container.isHidden()?(t=this.stateTextInput.validate(),s=s&&t.isValid):(t=this.stateSelectInput.validate(),s=s&&t.isValid),s},save:function(e){if(this.validate())return this.addressModel.save(null,e)},savePromise:function(e){return this.validate()?this.addressModel.savePromise(null,e).catch(function(e){let s;const n=e&&e.response;return n&&n.errorCode&&"Error.Tax"===n.errorCode&&(s=new c(h.get("invalidTaxArea"))),t.reject(s)}):t.reject(new l(h.get("invalidAddress")))},clear:function(){if(this.addressModel.isNew()){const t=e.clone(i.prototype.defaults);this.countryReadOnly&&delete t[i.Fields.COUNTRY],delete t[i.Fields.IS_BILL_TO],delete t[i.Fields.IS_SHIP_TO],this.addressModel.set(t);const s=Object.keys(t);this.inputs.forEach(function(e){-1!==s.indexOf(e.fieldName)&&e.resetValue()})}},destroy:function(){for(let e=0;e<this.inputs.length;e++)this.inputs[e].destroy(),this.inputs[e]=null;this._parent(),this.container=null},_onCountryChange:function(){""===this.countrySelectComponent.getValue()&&this.addressModel.set("country","DEFAULT"),this._applyCountryFormatAddress()},_applyCountryFormatAddress:function(t){const s=this,n=this.addressModel.getCountry()?this.addressModel.getCountry():"DEFAULT",r=this.addressConstraints.get(n)?this.addressConstraints.get(n):this.addressConstraints.get("DEFAULT");this.inputs.forEach(function(t){t.fieldName===i.Fields.COUNTRY&&""===t.getValue()||s.keepErrorMessages||t._removeErrorMessage();const d=r.get(t.fieldName);e.is(d)?(s._handleRequiredSymbol(t,d.isRequired()),t.fieldName===i.Fields.STATE?s._displayTextOrSelectStateInput(n,d):t.show()):t.hide()}),this._adaptLabelInputsToAddressFormat(r)},_adaptLabelInputsToAddressFormat:function(e){const t=this,s=[];let n=0;this.addressLineInputs.forEach(function(i){if(""!==i.getValue()&&s.push(i.getValue()),i.container.isHidden())++n;else{const s=parseInt(i.fieldName[i.fieldName.length-1])-n;i.fieldLabel=h.get("labelAddressLine"+s),i.container.getElement(".mpf-label").setContent(h.get("labelAddressLine"+s)),t._handleRequiredSymbol(i,e.get(i.fieldName).isRequired())}}),this._adaptValuesToInputsDisplayed(s)},_adaptValuesToInputsDisplayed:function(e){this.addressLineInputs.forEach(function(t){t.container.isHidden()?t.resetValue({silent:!0}):t.setValue(e.length>0?e.shift():"",{silent:!0})})},_displayTextOrSelectStateInput:function(t,s){const n=this,i=s.getPattern();if(-1!==i.indexOf("|")){this.stateSelectInput.remove();const s=i.substring(1,i.length-1).split("|"),r=[];s.forEach(function(s){r.push({value:s,label:h.get(t+s),selected:!!e.is(n.addressModel.getState())&&(n.addressModel.getState()===s&&n.addressModel.getCountry()===t)})}),this.stateSelectInput.add(r),this.stateTextInput.hide(),this.stateSelectInput.show(),this.stateSelectInput._removeErrorMessage()}else this.stateSelectInput.hide(),this.stateTextInput.show()},_handleRequiredSymbol:function(t,s){if(t.fieldName!==i.Fields.PHONE_NUMBER){const n=t.container.getElement("em.mpf-required"),i=e.createElement("em",{class:"mpf-required",text:" *"});!e.is(n)&&s&&(t.required=!0,t.container.hasClassName("mpf-select-v2")?i.inject(t.container.getElement(".mpf-label label")):i.inject(t.container.getElement("span.mpf-label"))),e.is(n)&&!s&&(t.required=!1,n.remove())}},_createInputs:function(){this.countrySelectComponent=new a({model:this.addressModel,fieldName:i.Fields.COUNTRY,fieldLabel:h.get("country"),readOnly:this.countryReadOnly,placeholder:h.get("selectCountry"),selectableOptions:this._getCountriesOptions(),dynamicValidation:!0,silent:!1}),this.addressLine1Input=new o({model:this.addressModel,fieldName:i.Fields.LINE1,fieldLabel:h.get("labelAddressLine1"),readOnly:this.readOnly,dynamicValidation:!0,maxlength:55}),this.addressLine2Input=new o({model:this.addressModel,fieldName:i.Fields.LINE2,fieldLabel:h.get("labelAddressLine2"),readOnly:this.readOnly,dynamicValidation:!0,maxlength:55}),this.addressLine3Input=new o({model:this.addressModel,fieldName:i.Fields.LINE3,fieldLabel:h.get("labelAddressLine3"),readOnly:this.readOnly,dynamicValidation:!0,maxlength:55}),this.addressLine4Input=new o({model:this.addressModel,fieldName:i.Fields.LINE4,fieldLabel:h.get("labelAddressLine4"),readOnly:this.readOnly,dynamicValidation:!0,maxlength:55}),this.cityInput=new o({model:this.addressModel,fieldName:i.Fields.CITY,fieldLabel:h.get("city"),readOnly:this.readOnly,dynamicValidation:!0}),this.countyInput=new o({model:this.addressModel,fieldName:i.Fields.COUNTY,fieldLabel:h.get("county"),readOnly:this.readOnly,dynamicValidation:!0}),this.stateTextInput=new o({model:this.addressModel,fieldName:i.Fields.STATE,fieldLabel:h.get("state"),readOnly:this.readOnly,dynamicValidation:!0}),this.stateSelectInput=new a({model:this.addressModel,fieldName:i.Fields.STATE,fieldLabel:h.get("state"),readOnly:this.readOnly,placeholder:h.get("statePlaceholder"),dynamicValidation:!0}),this.postalCodeInput=new o({model:this.addressModel,fieldName:i.Fields.POSTAL_CODE,fieldLabel:h.get("postalCode"),readOnly:this.readOnly,dynamicValidation:!0}),this.addressLineInputs=[this.addressLine1Input,this.addressLine2Input,this.addressLine3Input,this.addressLine4Input],this.inputs=[this.countrySelectComponent,this.addressLine1Input,this.addressLine2Input,this.addressLine3Input,this.addressLine4Input,this.cityInput,this.countyInput,this.stateTextInput,this.stateSelectInput,this.postalCodeInput],this.showPhoneNumber&&(this.phoneNumberInput=new o({model:this.addressModel,fieldName:i.Fields.PHONE_NUMBER,fieldLabel:h.get("phoneNumber"),readOnly:this.readOnly,dynamicValidation:!0,required:!0,type:"tel"}),this.inputs.push(this.phoneNumberInput))},_getCountriesOptions:function(){const t=this,s=[];return this.countries.forEach(function(n){const i={value:n.getIso3(),label:n.getName()};i.selected=e.is(t.preSetCountry)?n.getIso3()===t.preSetCountry:n.getIso3()===t.addressModel.getCountry(),s.push(i)}),s},_checkRequiredParameters:function(e){n.requiredOfPrototype(e.addressModel,i,"options.addressModel must be an AddressModel"),n.requiredOfPrototype(e.addressConstraints,r,"options.addressConstraints must be an AddressConstraintsCollection"),n.requiredOfPrototype(e.countries,d,"options.countries must be a CountryCollection")}})}),define("DS/MPFAddressFormComponent/AddressList",["UWA/Core","UWA/Class/View","DS/UIKIT/Scroller","DS/MPFAddressFormComponent/AddressCard"],function(e,t,s,n){"use strict";return t.extend({className:"mpf-address-list",setup:function(t){if(t||(t={}),!e.is(t.legalEntity))throw new Error("options.legalEntity is required");this._parent(t),this.addressCards=[],this.selectedAddress=null,this.legalEntity=t.legalEntity},render:function(){var t,i,r,d=this;return this.addressCards.forEach(function(e){d.stopListening(e,"onSelected")}),this.addressCards=this.model.filter(function(e){return!e.isNew()}).map(function(e){return new n({model:e,legalEntity:d.legalEntity})}),this.addressCards.forEach(function(e){d.listenTo(e,"onSelected",d.setSelectedAddress.bind(d))}),t=this.addressCards.map(function(e){var t;return t=e.render(),d.selectedAddress&&d.selectedAddress.id===e.model.id&&e.container.addClassName("selected"),t}),i=e.createElement("div",{class:"mpf-address-cards",html:t}),r=new s({element:i}),this.container.setContent(r),this},getSelectedAddress:function(){return this.selectedAddress},setSelectedAddress:function(e){this.model.contains(e)&&(this.selectedAddress=e,this.addressCards.forEach(function(t){t.model.id===e.id?t.container.addClassName("selected"):t.container.removeClassName("selected")}),this.dispatchEvent("AddressSelected",e))},removeClassName:function(e){this.container.removeClassName(e)},addClassName:function(e){this.container.addClassName(e)}})});