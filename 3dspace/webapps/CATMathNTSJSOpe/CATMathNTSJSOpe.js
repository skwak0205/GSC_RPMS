define("DS/CATMathNTSJSOpe/CATMathRghLifting",["UWA/Core","DS/MathematicsES/MathsDef"],function(t,i){"use strict";var s=t.Class.extend({init:function(){return this._nbPoints=0,this._detectCorners=!0,this._isLinearFiltered=!1,this._isInserted=0,this._epsZero=Math.pow(10,-15),this._epsLength=Math.pow(10,-6),this._epsPressure=1,this._epsVelocity=1,this._minStep=this._epsLength,this._hasRun=!1,this},setListOfPoints:function(t){this._points=t,this._isInserted=1,this._isLinearFiltered=!1,this._nbPoints=this._points.length},setListOfNormals:function(t){this._normals=t},setListOfPressures:function(t){this._pressures=t},setListOfVelocities:function(t){this._velocities=t},setMinimalStep:function(t){this._minStep=t},setEpsPressure:function(t){this._epsPressure=t<=0?.1:t>=1?1:t},setEpsVelocity:function(t){this._epsVelocity=t<=0?.1:t>=1?1:t},getNbPoints:function(){return!1===this._hasRun&&this.runLifting(),this._nbPoints=this._points.length,this._nbPoints},getListOfPoints:function(){return!1===this._hasRun&&this.runLifting(),this._points},getListOfNormals:function(){return!1===this._hasRun&&this.runLifting(),this._normals},getPressures:function(){return!1===this._hasRun&&this.runLifting(),this._pressures},getVelocities:function(){return!1===this._hasRun&&this.runLifting(),this._velocities},isPointToBeKept:function(t,i,s){var e=!0,o=0;if((o=Math.abs(t.x-i.x))>s)return e;var r=o;if((o=Math.abs(t.y-i.y))>s)return e;var n=o;if((o=Math.abs(t.z-i.z))>s)return e;return(o=r*r+n*n+o*o)>s*s?e:e=!1},runLifting:function(){if(void 0!==this._points){var t=this._nbPoints=this._points.length;if(this._hasRun=!0,!(t<=2)){if(!this._isLinearFiltered){var i=[],s=[],e=[],o=[],r=0,n=this._normals,h=this._points,a=this._pressures,c=this._velocities,p=this._minStep,u=h[0],_=h[1];for(i.push(u),void 0!==n&&s.push(n[0]),void 0!==a&&e.push(a[0]),void 0!==c&&o.push(c[0]),r=1;r<t-2;r++){var l=r;_=h[l],this.isPointToBeKept(u,_,p)&&(i.push(_),void 0!==n&&s.push(n[l]),void 0!==a&&e.push(a[l]),void 0!==c&&o.push(c[l]),u=_)}_=h[t-2];var v=this.isPointToBeKept(u,_,p);u=h[t-1];var d=this.isPointToBeKept(u,_,p);v&&d&&(i.push(_),void 0!==n&&s.push(n[t-2]),void 0!==a&&e.push(a[t-2]),void 0!==c&&o.push(c[t-2])),i.push(u),void 0!==n&&s.push(n[t-1]),void 0!==a&&e.push(a[t-1]),void 0!==c&&o.push(c[t-1])}this._isLinearFiltered=!0,this._points=i,this._nbPoints=this._points.length,void 0!==n&&(this._normals=s),void 0!==a&&(this._pressures=e),void 0!==c&&(this._velocities=o)}}}});return t.namespace("DS/CATMathNTSJSOpe/CATMathRghLifting",s)}),define("DS/CATMathNTSJSOpe/CATMathRghImprove",["UWA/Core","DS/MathematicsES/MathsDef"],function(t,i){"use strict";var s=t.Class.extend({init:function(){return this._nbPoints=0,this._params=[],this._epsZero=Math.pow(10,-15),this._epsParam=Math.pow(10,-15),this._epsClosed=Math.pow(10,-6),this._toClose=-1,this._checkEndClosed=!1,this._checkEndNormals=!1,this._statusClosed=-100,this._isReady=!1,this._ALPHA=.5,this._PtDeb=new i.Vector3D(0,0,0),this._PtFin=new i.Vector3D(0,0,0),this._NrDeb=new i.Vector3D(0,0,0),this._NrFin=new i.Vector3D(0,0,0),this._pressDeb=1,this._pressFin=1,this._veloDeb=1,this._veloFin=1,this._controlPoints=[],this},setListOfPoints:function(t){this._points=t,this._nbPoints=this._points.length,this._checkEndClosed=!1,this._checkEndNormals=!1},setListOfNormals:function(t){this._normals=t,this._checkEndNormals=!1},setListOfPressure:function(t){this._pressures=t},setListOfVelocity:function(t){this._velocities=t},SetClose:function(t,i){t<=-1?this._toClose=-1:0===t?this._toClose=0:t>=1&&(this._toClose=1),i>=0?this._epsClosed=i:this.epsClosed=Math.pow(10,-6)},getStatusClosed:function(){return this._statusClosed},getNbArcs:function(){return this._nbPoints<2?0:this._nbPoints-1},getNbCtrlPPArc:function(){return 4},getControlPoints:function(){var t=this._controlPoints;if(void 0===this._points||this._nbPoints<2)return t;if(!0===this.isComputedParams()){var s=0,e=this._points,o=this._nbPoints,r=this._ALPHA;for(s=0;s<o-1;s++){var n=s,h=new i.Vector3D(0,0,0),a=new i.Vector3D(0,0,0),c=new i.Vector3D(0,0,0),p=new i.Vector3D(0,0,0);n>0?h.copy(e[n-1]):h.copy(this._PtDeb),a.copy(e[n]),c.copy(e[n+1]),n<o-2?p.copy(e[n+2]):p.copy(this._PtFin);var u=new i.Vector3D(0,0,0),_=new i.Vector3D(0,0,0),l=new i.Vector3D(0,0,0),v=new i.Vector3D(0,0,0);(l=i.Vector3D.sub(c,h)).multiplyScalar(r),l.divideScalar(3),(v=i.Vector3D.sub(a,p)).multiplyScalar(r),V30.divideScalar(3),u=i.Vector3D.add(a,l),_=i.Vector3D.add(c,v),t.push(a),t.push(u),t.push(_),t.push(c)}}return t},evalPoint:function(t){if(void 0!==this._points)return this.evalAtParam(t,this._points,this._PtDeb,this._PtFin)},evalNrmal:function(t){if(void 0!==this._normals)return this.evalAtParam(t,this._normals,this._NrDeb,this._NrFin)},evalPress:function(t){if(void 0!==this._pressures)return this.evalPVAtParam(t,this._pressures,this._pressDeb,this._pressFin)},evalVelo:function(t){if(void 0!==this._velocities)return this.evalPVAtParam(t,this._velocities,this._veloDeb,this._veloFin)},evalAtParam:function(t,s,e,o){if(void 0===s||s.length<2)return r;var r=new i.Vector3D(0,0,0),n=s.length;t<0&&(t=0),t>n-1&&(t=n-1);var h=Math.floor(t),a=Math.max(t-h,0);if(a<=this._epsParam)return r.copy(s[h]),r;var c=new i.Vector3D(0,0,0),p=new i.Vector3D(0,0,0),u=new i.Vector3D(0,0,0),_=new i.Vector3D(0,0,0);if(!0===this.isComputedParams()){var l=(this._M1im2+(this._M2im2+this._M3im2*a)*a)*a,v=this._M0im1+(this._M2im1+this._M3im1*a)*a*a,d=(this._M1i+(this._M2i+this._M3i*a)*a)*a,f=(this._M2ip1+this._M3ip1*a)*a*a;h>0?c.copy(s[h-1]):c.copy(e),p.copy(s[h]),u.copy(s[h+1]),h<nbPts-2?_.copy(s[h+2]):_.copy(o),c.multiplyScalar(l),p.multiplyScalar(v),u.multiplyScalar(d),_.multiplyScalar(f);var D=new i.Vector3D(0,0,0),m=new i.Vector3D(0,0,0);D=i.Vector3D.add(c,p),m=i.Vector3D.add(u,_),r=i.Vector3D.add(D,m)}return r},evalPVAtParam:function(t,i,s,e){if(void 0===i||r!==n||n<2)return o;var o=1,r=i.length,n=this._points.length;t<0&&(t=0),t>r-1&&(t=r-1);var h=Math.floor(t),a=Math.max(t-h,0);if(a<=this._epsParam)return(o=i[h])<0&&(o=0),o>1&&(o=1),o;if(!0===this.isComputedParams()){var c=(this._M1im2+(this._M2im2+this._M3im2*a)*a)*a,p=this._M0im1+(this._M2im1+this._M3im1*a)*a*a,u=(this._M1i+(this._M2i+this._M3i*a)*a)*a,_=(this._M2ip1+this._M3ip1*a)*a*a;return(o=c*(h>0?i[h-1]:s)+p*i[h]+u*i[h+1]+_*(h<n-2?i[h+2]:e))<0&&(o=0),o>1&&(o=1),o}},isComputedParams:function(){if(!this._isReady){this._M0im1=1,this._M1im2=this._M3im2=this._M2ip1=-this._ALPHA,this._M2im2=2*this._ALPHA,this._M2im1=this._ALPHA-3,this._M3im1=2-this._ALPHA,this._M2i=3-2*this._ALPHA,this._M3i=this._ALPHA-2,this._M1i=this._M3ip1=this._ALPHA;var t=this._points,i=this._points.length;if(void 0===t||i<2)return this._isReady;this._isReady=!0;var s=this._normal,e=s.length,o=this._pressures,r=o.length,n=this._velocities,h=n.length,a=this._PtDeb,c=this._PtFin,p=this._NrDeb,u=this._NrFin;this._toClose>=1&&i>2?(this.closeEndG0(),a.copy(t[i-2]),c.copy(t[1]),void 0!==s&&e===i&&(p.copy(s[i-2]),u.copy(s[1])),void 0!==o&&r===i&&(this._pressDeb=o[i-2],this._pressFin=o[1]),void 0!==n&&h===i&&(this._veloDeb=n[i-2],this._veloFin=n[1]),this._statusClosed=1):(this.closeEndG0(),a.copy(this.computeDebG0(t,i)),c.copy(this.computeFinG0(t,i)),void 0!==s&&e===i&&(p.copy(this.computeDebG0(s,i)),u.copy(this.computeFinG0(s,i))),void 0!==o&&r===i&&(i>2?(this._pressDeb=o[0]+o[1]-o[2],this._pressFin=o[i-1]+o[i-2]-o[i-3]):(this._pressDeb=2*o[0]-o[1],this._pressFin=2*o[1]-o[0])),void 0!==n&&h===i&&(i>2?(this._veloDeb=n[0]+n[1]-n[2],this._veloFin=n[i-1]+n[i-2]-n[i-3]):(this._veloDeb=2*n[0]-n[1],this._veloFin=2*n[1]-n[0])));var _=0;for(_=0;_<=i+1;_++)this._params.push(_)}return this._isReady},computeDebG0:function(t,s){var e=new i.Vector3D(0,0,0),o=new i.Vector3D(0,0,0),r=new i.Vector3D(0,0,0);if(o.copy(t[0]),r.copy(t[1]),s>2){var n=new i.Vector3D(0,0,0);n.copy(t[2]);var h=new i.Vector3D(0,0,0),a=new i.Vector3D(0,0,0);h=i.Vector3D.sub(r,o),a=i.Vector3D.sub(n,r);var c=h.squareNorm(),p=h.dot(a),u=new i.Vector3D(0,0,0);c>this._epsZero&&(h.multiplyScalar(2*p/c),u=i.Vector3D.sub(h,a)),e=i.Vector3D.sub(o,u)}else e=i.Vector3D.sub(o.multiplyScalar(2),r);return e},computeFinG0:function(t,s){var e=new i.Vector3D(0,0,0),o=new i.Vector3D(0,0,0),r=new i.Vector3D(0,0,0);if(o.copy(t[s-2]),r.copy(t[s-1]),s>2){var n=new i.Vector3D(0,0,0);n.copy(t[s-3]);var h=new i.Vector3D(0,0,0),a=new i.Vector3D(0,0,0);h=i.Vector3D.sub(o,r),a=i.Vector3D.sub(n,o);var c=h.squareNorm(),p=h.dot(a),u=new i.Vector3D(0,0,0);c>this._epsZero&&(h.multiplyScalar(-2*p/c),u=i.Vector3D.add(h,a)),e=i.Vector3D.add(r,u)}else e=i.Vector3D.sub(r.multiplyScalar(2),o);return e},closeEndG0:function(){if(this._checkEndClosed)return this._checkEndClosed;var t=this._points,s=this._points.length;if(this._toClose>=0&&s>3&&void 0!==t){var e=new i.Vector3D(0,0,0),o=new i.Vector3D(0,0,0);new i.Vector3D(0,0,0);if(e.copy(t[0]),o.copy(t[s-1]),i.Vector3D.sub(o,e).squareNorm()<=this._epsClosed*this._epsClosed){var r=(e.x+o.x)/2,n=(e.y+o.y)/2,h=(e.z+o.z)/2;t[0].set(r,n,h),t[s-1].set(r,n,h),this._statusClosed=0,this.closeEndNormals()}}return this._checkEndClosed=!0,this._checkEndClosed},closeEndNormals:function(){if(this._checkEndNormals)return this._checkEndNormals;if(this._statusClosed>=0){var t=this._normals,s=this._points.length;if(this._toClose>=1&&s>3&&void 0!==t&&s===t.length){var e=new i.Vector3D(0,0,0),o=new i.Vector3D(0,0,0);e.copy(t[0]),o.copy(t[s-1]);var r=(e.x+o.x)/2,n=(e.y+o.y)/2,h=(e.z+o.z)/2;t[0].set(r,n,h),t[s-1].set(r,n,h)}}return this._checkEndNormals=!0,this._checkEndNormals}});return t.namespace("DS/CATMathNTSJSOpe/CATMathRghImprove",s)}),define("DS/CATMathNTSJSOpe/CATMathRghLiftingDPR",["UWA/Core","DS/MathematicsES/MathsDef","DS/CATMathNTSJSOpe/CATMathRghLifting"].concat(window.dependencies),function(t,i,s){"use strict";var e=s.extend({init:function(){return this._parent(),this._detectCorners=!0,this._maxError=this._epsLength,this},setMaximumError:function(t){this._maxError=t},setCornerDetection:function(t){this._detectCorners=t},computeMax:function(t,s,e,o,r){if(this.IMax=0,this.DMax2=0,e!==s+1){var n=0,h=0,a=!1,c=new i.Vector3D(0,0,0),p=new i.Vector3D(0,0,0),u=(new i.Vector3D(0,0,0),new i.Vector3D(0,0,0)),_=new i.Vector3D(0,0,0),l=new i.Vector3D(0,0,0);c.copy(t[s]),p.copy(t[e]);var v=(u=i.Vector3D.sub(p,c)).squareNorm();for((v<=r||v<=o*o/10)&&(a=!0),n=s+1;n<e;n++){var d=n;if(_=i.Vector3D.sub(t[d],c),a)h=_.squareNorm();else{var f=u.dot(_)/v;l.copy(u),l.multiplyScalar(f),l.add(c),l.sub(t[d]),h=l.squareNorm()}h>this.DMax2&&(this.DMax2=h,this.IMax=d)}}},filterPorV:function(t,i){var s=t.length;if(s===this._points.length){for(var e=0,o=s-1,r=e+1;r<s&&0===i[r];)r++;for(o=r;e<o;){var n=(t[o]-t[e])/(o-e),h=(o*t[e]-e*t[o])/(o-e),a=0,c=0,p=e+1;for(p=e+1;p<o;p++){var u=p,_=Math.abs(t[u]-n*u-h);_>a&&(a=_,c=u)}if(a>this._epsVelocity)i[c]=1,o=c;else{for(r=(e=o)+1;r<s&&0===i[r];)r++;o=r}}}},runLifting:function(){if(this._hasRun=!0,!(this._nbPoints<=2)){!1===this._isLinearFiltered&&this._parent();var t=this._points;if(void 0!==t){var s=this._nbPoints=this._points.length,e=[],o=0;for(o=0;o<s;o++)e.push(0);var r=0,n=s-1;e[r]=1,e[n]=1;for(var h=this._epsZero,a=this._minStep,c=this._maxError,p=0,u=0;r<n;){this.computeMax(t,r,n,a,h),u=this.IMax;if((p=this.DMax2)>c*c)e[u]=1,n=u,0;else if(0===r&&n===s-1&&p>c*c/100&&u>1&&u<s-2)e[u]=1,n=u,0;else for(o=(r=n)+1;o<s;o++)if(e[o]){n=o;break}}if(!0===this._detectCorners){var _=new i.Vector3D(0,0,0),l=new i.Vector3D(0,0,0),v=new i.Vector3D(0,0,0),d=new i.Vector3D(0,0,0),f=0,D=0,m=0,y=0;for(o=1,v.copy(t[0]);o<s&&0===e[o];)o++;for(m=o,d.copy(t[m]),f=(_=i.Vector3D.sub(v,d)).norm(),o++;o<s;){if(0!==e[o]){if(v.copy(t[o]),D=(l=i.Vector3D.sub(v,d)).norm(),m-y>3&&o-m>3){var V=_.dot(l);f>=h&&D>=h&&V>=-.33*f*D&&(e[m]=2)}y=m,m=o,_.copy(l),_.negate(),d.copy(t[m])}o++}for(y=0,m=0,o=1;o<s;){if(0!==e[o]){var P=Math.max(o-3,1),M=Math.min(o+3,s-2);for(y=m=P;y<o;y++)if(0!==e[y]){P=y+1;break}for(y=m=M;y>o;y--)if(0!==e[y]){M=y-1;break}if(M-P<=2){o++;continue}var b=-1.33,w=P,g=M;_.set(0,0,0),l.set(0,0,0),f=0,D=0,v.copy(t[o]);var S=P,C=M;for(S=P;S<o;S++)for(_=i.Vector3D.sub(t[S-1],v),C=M;C>o;C--){l=i.Vector3D.sub(t[C+1],v);V=_.dot(l);f=_.norm(),D=l.norm(),f<h||D<h||b<(V=V/f/D)&&(b=V,w=S,g=C)}if(b<-.33&&2!==e[o]){o++;continue}0===e[w]&&0,e[w]=1,0===e[g]&&0,e[g]=1,o=g}o++}}void 0!==N&&1!==this._epsPressure&&this.filterPorV(N,e),void 0!==L&&1!==this._epsVelocity&&this.filterPorV(L,e);var A=this._normals,N=this._pressures,L=this._velocities,R=[],T=[],F=[],O=[];for(o=0;o<s;o++)0!==e[o]&&(R.push(t[o]),void 0!==A&&T.push(A[o]),void 0!==N&&F.push(N[o]),void 0!==L&&O.push(L[o]));this.setListOfPoints(R),s=this._nbPoints=this._points.length,void 0!==A&&this.setListOfNormals(T),void 0!==N&&this.setListOfPressures(F),void 0!==L&&this.setListOfVelocities(O)}}}});return t.namespace("DS/CATMathNTSJSOpe/CATMathRghLiftingDPR",e)}),define("DS/CATMathNTSJSOpe/CATMathRghImproveCR",["UWA/Core","DS/MathematicsES/MathsDef","DS/CATMathNTSJSOpe/CATMathRghImprove"].concat(window.dependencies),function(t,i,s){"use strict";var e=s.extend({init:function(){return this._parent(),this},evalAtParam:function(t,s,e,o){function r(t,s,e,o,r,n){var h=new i.Vector3D(0,0,0);if(o-e>n){var a=new i.Vector3D(0,0,0),c=new i.Vector3D(0,0,0);a.copy(t),c.copy(s),a.multiplyScalar(o-r),c.multiplyScalar(r-e),(h=i.Vector3D.add(a,c)).divideScalar(o-e)}return h}if(void 0===s||s.length<2)return a;var n=this._nbPoints,h=this._params,a=new i.Vector3D(0,0,0),c=s.length;t<0&&(t=0),t>c-1&&(t=c-1);var p=Math.floor(t),u=Math.max(t-p,0);if(u<=this._epsParam)return a.copy(s[p]),a;var _=new i.Vector3D(0,0,0),l=new i.Vector3D(0,0,0),v=new i.Vector3D(0,0,0),d=new i.Vector3D(0,0,0);if(!0===this.isComputedParams()){var f=h[p],D=h[p+1],m=h[p+2],y=h[p+3],V=u*m+(1-u)*D;p>0?_.copy(s[p-1]):_.copy(e),l.copy(s[p]),v.copy(s[p+1]),p<n-2?d.copy(s[p+2]):d.copy(o);var P=this._epsParam,M=r(_,l,f,D,V,P),b=r(l,v,D,m,V,P),w=r(v,d,m,y,V,P),g=r(M,b,f,m,V,P),S=r(b,w,D,y,V,P),C=r(g,S,D,m,V,P);a.copy(C)}return a},evalPVAtParam:function(t,i,s,e){function o(t,i,s,e,o,r){var n=0;return e-s>r&&(n=(t*(e-o)+i*(o-s))/(e-s)),n}var r=0,n=0;if(void 0!==this._points&&(n=this._points.length),void 0!==i&&(r=i.length),void 0===i||r!==n||n<2)return h;var h=1;t<0&&(t=0),t>r-1&&(t=r-1);var a=Math.floor(t),c=Math.max(t-a,0);if(c<=this._epsParam)return(h=i[a])<0&&(h=0),h>1&&(h=1),h;var p=0,u=0,_=0,l=0;if(!0===this.isComputedParams()){var v=params[a],d=params[a+1],f=params[a+2],D=params[a+3],m=c*f+(1-c)*d;p=a>0?i[a-1]:s,u=i[a],_=i[a+1],l=a<n-2?i[a+2]:e;var y=this._epsParam,V=o(p,u,v,d,m,y),P=o(u,_,d,f,m,y),M=o(_,l,f,D,m,y),b=o(V,P,v,f,m,y),w=o(P,M,d,D,m,y);h=o(b,w,d,f,m,y)}return h<0&&(h=0),h>1&&(h=1),h},getControlPoints:function(){function t(t,s,e,o,r,n,h){var a=r-o,c=n-r;a<h&&(a=0),c<h&&(c=0);var p=new i.Vector3D,u=new i.Vector3D,_=new i.Vector3D;p.copy(t),u.copy(s),_.copy(e),_.multiplyScalar(a*a),p.multiplyScalar(c*c),u.multiplyScalar(2*a*a+3*a*c+c*c);var l=new i.Vector3D(0,0,0);(l=i.Vector3D.sub(_,p)).add(u);var v=1/(3*a*(a+c));return l.multiplyScalar(v),l}var s=this._controlPoints;if(void 0===this._points||o<2)return s;if(!0===this.isComputedParams()){var e=this._points,o=this._nbPoints=this._points.length,r=this._params,n=this._epsParam,h=0;for(h=0;h<o-1;h++){var a=h,c=new i.Vector3D(0,0,0),p=new i.Vector3D(0,0,0);a>0?c.copy(e[a-1]):c.copy(this._PtDeb),a<o-2?p.copy(e[a+2]):p.copy(this._PtFin);var u=t(c,e[a],e[a+1],r[a],r[a+1],r[a+2],n),_=t(p,e[a+1],e[a],-r[a+3],-r[a+2],-r[a+1],n);s.push(e[a]),s.push(u),s.push(_),s.push(e[a+1])}}return s},isComputedParams:function(){if(!this._isReady){var t=this._points,s=this._points.length;if(void 0===t||s<2)return this._isReady;this._isReady=!0;var e=this._normals,o=this._pressures,r=this._velocities,n=this._params,h=0,a=0,c=0;void 0!==e&&(h=e.length),void 0!==o&&(a=o.length),void 0!==r&&(c=r.length);var p=this._PtDeb,u=this._PtFin,_=this._NrDeb,l=this._NrFin;this.toClose>=1&&s>2?(this.closeEndG0(),p.copy(t[s-2]),u.copy(t[1]),void 0!==e&&h===s&&(_.copy(e[s-2]),l.copy(e[1])),void 0!==o&&a===s&&(this._pressDeb=o[s-2],this._pressFin=o[1]),void 0!==r&&c===s&&(this._veloDeb=r[s-2],this._veloFin=r[1]),this._statusClosed=1):(this.closeEndG0(),p.copy(this.computeDebG0(t,s)),u.copy(this.computeFinG0(t,s)),void 0!==e&&h===s&&(_.copy(this.computeDebG0(e,s)),l.copy(this.computeFinG0(e,s))),void 0!==o&&a===s&&(s>2?(this._pressDeb=o[0]+o[1]-o[2],this._pressFin=o[s-1]+o[s-2]-o[s-3]):(this._pressDeb=2*o[0]-o[1],this._pressFin=2*o[1]-o[0])),void 0!==r&&c===s&&(s>2?(this._veloDeb=r[0]+r[1]-r[2],this._veloFin=r[s-1]+r[s-2]-r[s-3]):(this._veloDeb=2*r[0]-r[1],this._veloFin=2*r[1]-r[0])));var v=0;if(n.push(0),this._ALPHA<=0){for(v=1;v<=s+1;v++){var d=v;n.push(d)}return this._isReady}var f=0;for(v=1;v<=s+1;v++){d=v;var D=new i.Vector3D(0,0,0),m=new i.Vector3D(0,0,0);1===d?D.copy(p):D.copy(t[d-2]),d===s+1?m.copy(u):m.copy(t[d-1]);new i.Vector3D(0,0,0);var y=i.Vector3D.sub(m,D).norm();1===this._ALPHA?(n.push(f+y),f+=y):.5===this._ALPHA?(y=Math.sqrt(y),n.push(f+y),f+=y):(y=this._ALPHA*Math.log(y),y=Math.exp(y),n.push(f+y),f+=y)}}return this._isReady}});return t.namespace("DS/CATMathNTSJSOpe/CATMathRghImproveCR",e)}),define("DS/CATMathNTSJSOpe/CATMathRghDiscretize",["UWA/Core","DS/MathematicsES/MathsDef","DS/CATMathNTSJSOpe/CATMathRghImprove","DS/CATMathNTSJSOpe/CATMathRghImproveCR"],function(t,i,s,e){"use strict";var o=t.Class.extend({init:function(){return this._mathRghImprove=null,this._discretizationType=0,this._discretizationStep=4,this._epsNorm=Math.pow(10,-6),this._minPtDist=this._epsNorm,this._params=[],this._nbPoints=0,this._hasRun=!1,this},setFunctionToDiscretize:function(t){this._mathRghImprove=t,this._hasRun=!1},setDiscretizationType:function(t,i){this._discretizationType=t,this._discretizationStep=i,this._hasRun=!1},setMinLineLength:function(t){t<this._epsNorm?this._minPtDist=this._epsNorm:this._minPtDist=t,this._hasRun=!1},getNbPoints:function(){return void 0===this._points?this._nbPoints=0:(!1===this._hasRun&&this.run(),this._nbPoints=this._points.length),this._nbPoints},getListOfPoints:function(){return!1===this._hasRun&&this.run(),this._points},getListOfNormals:function(){return!1===this._hasRun&&this.run(),this._normals},getListOfPressures:function(){return!1===this._hasRun&&this.run(),this._pressures},getListOfVelocities:function(){return!1===this._hasRun&&this.run(),this._velocities},run:function(){if(!0===this._hasRun)return this;this._hasRun=!0;var t=this._mathRghImprove;if(void 0===t)return this;var s=t.getNbCtrlPPArc();if(4===s){var e=t.getNbArcs(),o=[],r=[],n=[],h=[],a=this._params,c=o.length,p=this._discretizationStep;if(1!==this._discretizationType){p<=2&&(p=2);var u=0,_=p-2,l=1/(_+1),v=(_+1)/(_+2);for(u=0;u<=e-1;u++){var d=0;for(d=0;d<v;d+=l){var f=u+d;o.push(t.evalPoint(f)),a.push(f)}}o.push(t.evalPoint(e)),a.push(e),c=o.length}else{p<=0&&(p=10);var D=t.getControlPoints();if(D.length!==e*s)return this;u=0;for(u=1;u<=e;u++){var m=u;this.discretizeSmoothlyThisArc(D,m,o)}}(new i.Vector3D).copy(o[0]);var y=2*this._epsNorm*p/180;y*=y;for(var V,P,M,b,w=0;w<o.length-2;){m=0;V=o,P=w,M=a,b=y,m=i.Vector3D.sub(V[P],V[P+1]).squareNorm()<b?(V.splice(w,P),M.splice(w,P),P):P+1,w=m}if((c=o.length)>2)i.Vector3D.sub(o[c-1],o[c-2]).squareNorm()<y&&(o.splice(c-2,1),a.splice(c-2,1));for((c=o.length)>0&&(this._points=o,this._nbPoints=c),w=0;w<c;w++){f=a[w];var g=t.evalNrmal(f);if(void 0===g)break;r.push(g)}for(r.length>0&&(this._normals=r),w=0;w<c;w++){f=a[w];var S=t.evalPress(f);if(void 0===S)break;n.push(S)}for(n.length>0&&(this._pressures=n),w=0;w<c;w++){f=a[w];var C=t.evalVelo(f);if(void 0===C)break;h.push(C)}h.length>0&&(this._velocities=h)}},discretizeSmoothlyThisArc:function(t,s,e){var o=this._mathRghImprove,r=e,n=this._params,h=[];h.push(0),h.push(1);var a=[],c=new i.Vector3D(0,0,0),p=new i.Vector3D(0,0,0),u=new i.Vector3D(0,0,0),_=new i.Vector3D(0,0,0);c.copy(t[4*s-4]),p.copy(t[4*s-3]),u.copy(t[4*s-2]),_.copy(t[4*s-1]),a.push(c),a.push(p),a.push(u),a.push(_);var l=1,v=1,d=[];d.push(l);for(var f=[],D=!0;D;){if((l=d[v-1])<4){D=!0;var m=0;v=m=this.subdivideLastArc(a,v,h,d)}else f.push(a[4*v-4]),f.push(a[4*v-3]),f.push(a[4*v-2]),f.push(a[4*v-1]),a.splice(4*v-4,4),d.splice(v-1,1),v-=1;0===v&&(D=!1)}function y(t,s,e){var o=new i.Vector3D(0,0,0),r=new i.Vector3D(0,0,0),n=new i.Vector3D(0,0,0),h=new i.Vector3D(0,0,0);o.copy(t[4*s-4]),r.copy(t[4*s-3]),n.copy(t[4*s-2]),h.copy(t[4*s-1]),t[4*s-4].copy(t[4*e-4]),t[4*s-3].copy(t[4*e-3]),t[4*s-2].copy(t[4*e-2]),t[4*s-1].copy(t[4*e-1]),t[4*e-4].copy(o),t[4*e-3].copy(r),t[4*e-2].copy(n),t[4*e-1].copy(h)}var V=h.length-1,P=1;for(P=1;P<=V/2;P++){y(f,m=P,V-m+1)}var M=[],b=[],w=this._discretizationStep*Math.PI/180,g=1,S=V,C=s-1,A=C+1,N=0,L=0,R=w/2,T=R,F=0,O=!1,E=C,x=A,z=i.Vector3D.sub(t[4*s-3],t[4*s-4]);z.normalize();var k=i.Vector3D.sub(t[4*s-2],t[4*s-1]);k.normalize();var I=(new i.Vector3D).copy(t[4*s-4]);for(r.push(I),n.push(C);!0!==O;){var G=new i.Vector3D,J=new i.Vector3D;G.copy(o.evalPoint(E)),J.copy(o.evalPoint(x));c=new i.Vector3D(0,0,0),p=new i.Vector3D(0,0,0),u=new i.Vector3D(0,0,0),_=new i.Vector3D(0,0,0);c.copy(o.evalPoint(C)),_.copy(o.evalPoint(A));var H=0,q=0;H=s-1+h[g],p.copy(o.evalPoint(H)),H>=A&&(H=A,p.copy(_)),q=s-1+h[S-1],u.copy(o.evalPoint(q)),q<=C&&(q=C,u.copy(c));var U=i.Vector3D.sub(p,G);U.normalize();var W=Math.acos(z.dot(U)),Z=i.Vector3D.sub(u,J);Z.normalize();var B=Math.acos(k.dot(Z));N+W>=R&&L+B<T?(W>0&&(F=.1*R,H=this.refineParam(H,W,R-N,z,G,E,c,F)),H>=q&&(q=H=(H+q)/2,O=!0),H>C?(p.copy(o.evalPoint(H)),r.push(p),n.push(H),R=w,(z=i.Vector3D.sub(p,c)).normalize(),C=H,N=0,E=H):++g>V&&(O=!0),k.copy(Z),L+=B,x=q,(--S<1||H>=A)&&(O=!0)):N+W<R&&L+B>=T?(B>0&&(F=.1*T,q=this.refineParam(q,B,T-L,k,J,x,_,F)),q<=H&&(H=q=(H+q)/2,O=!0),q<A?(u.copy(o.evalPoint(q)),M.push(u),b.push(q),T=w,(k=i.Vector3D.sub(u,_)).normalize(),A=q,L=0,x=q):--S<1&&(O=!0),z.copy(U),N+=W,E=H,(++g>V||q<=C)&&(O=!0)):N+W<R&&L+B<T?H>=q?(q=H=(H+q)/2,O=!0,p.copy(o.evalPoint(H)),r.push(p),n.push(H),C=H,A=q):(z.copy(U),k.copy(Z),E=H,x=q,N+=W,L+=B,S--,(++g>V||S<1||H>=A||q<=C)&&(O=!0)):N+W>=R&&L+B>=T?(W>0&&(F=.1*R,H=this.refineParam(H,W,R-N,z,G,E,c,F)),B>0&&(F=.1*T,q=this.refineParam(q,B,T-L,k,J,x,_,F)),H>=q?(q=H=(H+q)/2,O=!0,p.copy(o.evalPoint(H)),r.push(p),n.push(H),C=H,A=q):(H>C?(p.copy(o.evalPoint(H)),r.push(p),n.push(H),R=w,(z=i.Vector3D.sub(p,c)).normalize(),C=H,N=0):++g>V&&(O=!0),q<A?(u.copy(o.evalPoint(q)),M.push(u),b.push(q),T=w,(k=i.Vector3D.sub(u,_)).normalize(),A=q,L=0):--S<1&&(O=!0),E=H,x=q,(H>=A||q<=C)&&(O=!0))):O=!0}for(P=M.length-1;P>=0;P--){m=P,_=(new i.Vector3D).copy(M[m]),q=b[m];r.push(_),n.push(q)}if(s===o.getNbArcs()){_=(new i.Vector3D).copy(t[4*s-1]);r.push(_);q=s;n.push(q)}},subdivideLastArc:function(t,s,e,o){new i.Vector3D(0,0,0);var r=(new i.Vector3D).copy(t[4*s-4]),n=(new i.Vector3D).copy(t[4*s-3]),h=(new i.Vector3D).copy(t[4*s-2]),a=(new i.Vector3D).copy(t[4*s-1]),c=i.Vector3D.add(r,n),p=i.Vector3D.add(r,h),u=i.Vector3D.add(r,a),_=i.Vector3D.add(n,h);c.divideScalar(2),p.divideScalar(4);var l=n.clone();l.divideScalar(2),p.add(l),u.divideScalar(8),_.divideScalar(8),_.multiplyScalar(3);var v=i.Vector3D.add(u,_);u.copy(c),l.copy(p),_.copy(v),t[4*s-3].copy(u),t[4*s-2].copy(l),t[4*s-1].copy(_);var d=new i.Vector3D(0,0,0),f=new i.Vector3D(0,0,0);(c=i.Vector3D.add(n,a)).divideScalar(4),d.copy(h),d.divideScalar(2),c.add(d),(p=i.Vector3D.add(h,a)).divideScalar(2),d.copy(c),f.copy(p),t.push(_),t.push(d),t.push(f),t.push(a);var D=(e[s]+e[s-1])/2;e.splice(s,0,D);var m=o[s-1];return o[s-1]=2*m,o.splice(s,0,2*m),t.length/4},refineParam:function(t,s,e,o,r,n,h,a){var c=1,p=t,u=p,_=this._mathRghImprove;if(void 0===_)return u;var l=new i.Vector3D;l.copy(_.evalPoint(p));var v=i.Vector3D.sub(l,h),d=this._minPtDist,f=v.norm();if(f<=d)return u;var D=e/s*(p-n)+n;l.copy(_.evalPoint(D)),f=(v=i.Vector3D.sub(l,h)).norm();var m=i.Vector3D.sub(l,r);m.normalize();var y=Math.acos(o.dot(m));for(f>d&&y>0&&(u=D);Math.abs(e-y)>=a&&c<1&&f>d&&y>0;)u=D,D=e/s*((p=D)-n)+n,l.copy(_.evalPoint(D)),tPPrec=i.Vector3D.sub(l,h),f=tPPrec.norm(),(m=i.Vector3D.sub(P3,r)).normalize(),y=Mayth.acos(o.dot(m)),c++;return u}});return t.namespace("DS/CATMathNTSJSOpe/CATMathRghDiscretize",o)});