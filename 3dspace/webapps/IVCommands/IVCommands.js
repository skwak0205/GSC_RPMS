define("DS/IVCommands/XRDeviceActivateCmd",["UWA/Core","DS/ApplicationFrame/Command","DS/SUI/HMDScenario","DS/IVBehaviours/TeleportBehaviour","DS/IVBehaviours/SelectionBehaviour","DS/IVBehaviours/AirGrabBehaviour","DS/CoreEvents/Events"],function(e,i,t,n,r,s,a){"use strict";var o=i.extend({init:function(e){if(this._parent(e,{isAsynchronous:!0}),this._hideTree=!1,this._closeActionBar=!1,e&&e.arguments)for(let i=0;i<e.arguments.length;++i)"hideTree"===e.arguments[i].ID&&e.arguments[i].Value?this._hideTree="true"===e.arguments[i].Value:"closeActionBar"===e.arguments[i].ID&&e.arguments[i].Value?this._closeActionBar="true"===e.arguments[i].Value:"clearSelection"===e.arguments[i].ID&&e.arguments[i].Value&&(this._clearSelection="true"===e.arguments[i].Value);var i=this.getFrameWindow();this.viewer=i?i.getViewer():e.viewer,this._scenario=new t(this.viewer),this._scenario._odt=!0===e.odt,this._standing=!0,this._mirroring=!0,this._height=this.viewer.internalSceneGraph.getSceneMin(),this._previousTreeDisplay=null,this.hmdActivated=!1,this._errorSubscription=null,this._errorSubscription2=null},beginExecute:function(){var e=this;this._errorSubscription=a.subscribe({event:"/VR/failedRenderBegun"},function(){e.end()}),this._errorSubscription2=a.subscribe({event:"/VR/failedRenderEnded"},function(){e.end()});var i=this.viewer;this._standing=!0,this._mirroring=!0,this._height=i.internalSceneGraph.getSceneMin();var t=this.getFrameWindow();this._scenario.activate({clearSelection:this._clearSelection}).then(function(){e._scenario.mirroring=e._mirroring,e._scenario.setStanding(e._standing),e._scenario.setSceneMin(e._height),i.offsetPlaneBackground.z=e._height,i.offsetPlaneSmall.z=e._height,e._scenario.enterVRMode().then(function(){if(e.hmdActivated=!0,null!==t){t.getActionBar();if(e._hideTree&&(e._previousTreeDisplay=t.getTree().getContent().style.display,t.getTree().getContent().style.display="none"),e._closeActionBar)t.getActionBar().close()}})},function(){e.end(),e.hmdActivated=!1})},execute:function(){},endExecute:function(){if(this.hmdActivated){var e=this.getFrameWindow();if(null!==e){if(this._closeActionBar)e.getActionBar().open();"none"!==this._previousTreeDisplay&&(e.getTree().getContent().style.display=this._previousTreeDisplay)}this._scenario.deactivate(),this._height=this.viewer.internalSceneGraph.getSceneMin()}this._standing=!0,this._mirroring=!0,a.unsubscribe(this._errorSubscription),a.unsubscribe(this._errorSubscription2)},getScenario:function(){return this._scenario}});return e.namespace("DS/IVCommands/XRDeviceActivateCmd",o)}),define("DS/IVCommands/XRDeviceActivateAfrCmd",["DS/SUI/HMDScenario","DS/CoreEvents/Events"],function(e,i){"use strict";return class{constructor(t){var n=t.executionContext;this._hideTree=t.hideTree,this._closeActionBar=t.closeActionBar,this._clearSelection=t.clearSelection,this.viewer=n.getComponent("Viewer").get3DViewer();var r=this;this._addBehavior=i.subscribe({event:"/VR/onInitialized"},function(){r._scenario&&(r._scenario.controllerManager.activate("AirGrab"),r._scenario.controllerManager.activate("Selection"),r._scenario.controllerManager.activate("TeleportAndRotation"))}),this._scenario=new e(this.viewer),this._standing=!0,this._mirroring=!0,this._height=this.viewer.internalSceneGraph.getSceneMin(),this._previousTreeDisplay=null,this.hmdActivated=!1,this._errorSubscription=null,this._errorSubscription2=null}beginExecute(){var e=this;this._errorSubscription=i.subscribe({event:"/VR/failedRenderBegun"},function(){e.pause()}),this._errorSubscription2=i.subscribe({event:"/VR/failedRenderEnded"},function(){e.pause()});var t=this.viewer;this._standing=!0,this._mirroring=!0,this._height=t.internalSceneGraph.getSceneMin(),this._scenario.activate({clearSelection:this._clearSelection}).then(function(){e._scenario.mirroring=e._mirroring,e._scenario.setStanding(e._standing),e._scenario.setSceneMin(e._height),t.offsetPlaneBackground.z=e._height,t.offsetPlaneSmall.z=e._height,e._scenario.enterVRMode().then(function(){e.hmdActivated=!0}),e.hmdActivated=!0},function(){e.pause(),e.hmdActivated=!1})}pauseExecute(){this.hmdActivated&&(this._scenario.deactivate(),this.hmdActivated=!1,i.unsubscribe(this._errorSubscription),i.unsubscribe(this._errorSubscription2))}resumeExecute(){this._scenario.activate({activateTeleport:!0}).then(function(){that._scenario.mirroring=that._mirroring,that._scenario.setStanding(that._standing),that._scenario.setSceneMin(that._height),viewer.offsetPlaneBackground.z=that._height,viewer.offsetPlaneSmall.z=that._height,that._scenario.enterVRMode(),that.hmdActivated=!0},function(){that.hmdActivated=!1})}destroy(){this.hmdActivated&&(this._scenario.deactivate(),this.hmdActivated=!1,i.unsubscribe(this._errorSubscription),i.unsubscribe(this._errorSubscription2),i.unsubscribe(this._addBehavior))}getScenario(){return this._scenario}}});