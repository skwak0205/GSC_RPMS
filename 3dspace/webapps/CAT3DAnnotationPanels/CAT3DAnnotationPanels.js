/*!  Copyright 2016 Dassault Systemes. All rights reserved. */
define("DS/CAT3DAnnotationPanels/CAT3DAnnotationStandardsInfoPanel",["UWA/Core","UWA/Class","DS/Controls/Toggle","DS/Tree/TreeListView","DS/Controls/Button","DS/Tree/TreeNodeModel","DS/CoreEvents/ModelEvents","i18n!DS/CAT3DAnnotationPanels/assets/nls/CAT3DAnnotationPanels","text!DS/CAT3DAnnotationPanels/assets/json/SemanticStandardsSymbols.json","css!DS/CAT3DAnnotationPanels/CAT3DAnnotationPanels.css"],function(e,t,n,i,l,a,o,s,r){"use strict";return t.extend({init:function(t){var c,d,h,u,p,g,f;this._parent(t);var m,b=[],y=new o,A=JSON.parse(r);function C(e,t){u=function(e){var t,n,i,l,a,o,s=[],r=e.length?null:e.children[0];if(r){if(void 0!==r&&void 0!==r.semanticStandards){for(i=0;i<r.semanticStandards.standards.length;i++)s.push({nameAnnot:r.name,code:r.semanticStandards.standards[i].code,title:r.semanticStandards.standards[i].title,year:r.semanticStandards.standards[i].year,standard:r.semanticStandards.stdName,namePart:e.name});if(r.semanticStandards.defaultSpecs)for(l=0;l<r.semanticStandards.defaultSpecs.length;l++){if(o="",r.semanticStandards.defaultSpecs[l].symbols)for(a=0;a<r.semanticStandards.defaultSpecs[l].symbols.length;a++)A[r.semanticStandards.defaultSpecs[l].symbols[a]]&&(o+=A[r.semanticStandards.defaultSpecs[l].symbols[a]].character);s.push({nameAnnot:r.name,code:r.semanticStandards.defaultSpecs[l].code,subtype:r.semanticStandards.defaultSpecs[l].subtype,type:r.semanticStandards.defaultSpecs[l].type,year:r.semanticStandards.defaultSpecs[l].year,standard:r.semanticStandards.stdName,symbols:o,namePart:e.name})}}}else for(t=0;t<e.length;t++)for(n=0;n<e[t].children.length;n++)if(void 0!==(r=e[t].children[n])&&void 0!==r.semanticStandards){for(i=0;i<r.semanticStandards.standards.length;i++)s.push({nameAnnot:r.name,code:r.semanticStandards.standards[i].code,title:r.semanticStandards.standards[i].title,year:r.semanticStandards.standards[i].year,standard:r.semanticStandards.stdName,namePart:e[t].name});if(r.semanticStandards.defaultSpecs)for(l=0;l<r.semanticStandards.defaultSpecs.length;l++){if(o="",r.semanticStandards.defaultSpecs[l].symbols)for(a=0;a<r.semanticStandards.defaultSpecs[l].symbols.length;a++)A[r.semanticStandards.defaultSpecs[l].symbols[a]]&&(o+=A[r.semanticStandards.defaultSpecs[l].symbols[a]].character);s.push({nameAnnot:r.name,code:r.semanticStandards.defaultSpecs[l].code,subtype:r.semanticStandards.defaultSpecs[l].subtype,type:r.semanticStandards.defaultSpecs[l].type,year:r.semanticStandards.defaultSpecs[l].year,standard:r.semanticStandards.stdName,symbols:o,namePart:e[t].name})}}return s}(e);var n,i=[],l="";switch(t){case"0":var o,r,c,d=[];for(n=0;n<u.length;n++)u[n]&&(o=u[n].namePart+" / "+u[n].nameAnnot,l=u[n].symbols||"",-1!==d.indexOf(o)?((r=new a({label:" ",icons:null,grid:{name:" ",code:u[n].code,title:u[n].title?u[n].title:s[u[n].type]+" "+s[u[n].subtype],year:u[n].year}})).symbols=l,i[d.indexOf(o)].addChild(r)):(r=new a({label:o,icons:null,grid:{name:o,standard:u[n].standard}}),(c=new a({label:" ",icons:null,grid:{name:" ",code:u[n].code,title:u[n].title,year:u[n].year}})).symbols=l,r.addChild(c),i.push(r),d.push(o)));break;case"1":var h,p=[];for(n=0;n<u.length;n++)u[n]&&(h=u[n].code,l=u[n].symbols||"",-1!==p.indexOf(h)?((r=new a({label:" ",icons:null,grid:{code:" ",name:u[n].namePart+" / "+u[n].nameAnnot,title:u[n].title?u[n].title:s[u[n].type]+" "+s[u[n].subtype],year:u[n].year}})).symbols=l,i[p.indexOf(h)].addChild(r)):(r=new a({label:h,icons:null,grid:{code:h,standard:u[n].standard}}),(c=new a({label:" ",icons:null,grid:{code:" ",name:u[n].namePart+" / "+u[n].nameAnnot,title:u[n].title,year:u[n].year}})).symbols=l,r.addChild(c),i.push(r),p.push(h))),b.push(r);break;case"2":var g,f=[];for(n=1;n<u.length;n++)u[n]&&(g=u[n].standard,l=u[n].symbols||"",-1!==f.indexOf(g)?((r=new a({label:" ",icons:null,grid:{name:u[n].namePart+" / "+u[n].nameAnnot,code:u[n].code,title:u[n].title?u[n].title:s[u[n].type]+" "+s[u[n].subtype],year:u[n].year}})).symbols=l,i[f.indexOf(g)].addChild(r)):(r=new a({label:g,icons:null,grid:{standard:g}}),(c=new a({label:" ",icons:null,grid:{name:u[n].namePart+" / "+u[n].nameAnnot,code:u[n].code,title:u[n].title,year:u[n].year}})).symbols=l,r.addChild(c),i.push(r),f.push(g))),b.push(r)}return b=i,i}var v=function(e){for(var t=0;t<b.length;t++)b[t]&&(e?b[t].expand():b[t].collapse())},S=function(e,t){return y.publish({event:e,data:t,context:this})};function D(t){var n,i=t.cellView.getParent().getManager().getTreeNodeModelFromRowID(t.cellModel.getRowID());"title"===t.dataIndex&&t.view.innerHTML&&i.symbols&&((n=e.createElement("p",{class:"CAT3DAnnotSymbol"})).innerHTML=i.symbols,"&"===i.symbols[0]&&n.setStyle("font-family","DSISO1"),n.innerHTML&&" "!==n.innerHTML&&n.inject(t.view))}function w(e,t){c&&(c.destroy(),c=null);var n=i.SETTINGS.STANDARD;n.height="auto",n.width=800,n.show.rowHeaders=!1,n.selection.preSelection=!0,n.performances.renderingMode="standard",n.enableActiveUI=!0,n.enableKeyboardNavigation=!0,n.defaultCellHeight=34,n.enableDragAndDrop=!1,n.onContextualEvent={callback:function(e){if(e.treeview.nodeModel)return-1===e.treeview.virtualRowID?[{type:"PushItem",title:s.Autofit,action:{callback:function(){e.treeview.manager.sizeColumnToFit(e.treeview.dataIndex)}}}]:[{type:"PushItem",title:s.ExpandAll,action:{callback:function(){v(!0)}}},{type:"PushItem",title:s.CollapseAll,action:{callback:function(){v(!1)}}}]}},n.columns="0"===t?[{text:s.RadioButtonName,dataIndex:"tree",width:m.columnSize.name,isSortable:!0,isDraggable:!1,isEditable:!1},{text:s.RadioButtonStandard,dataIndex:"standard",width:m.columnSize.standard,isSortable:!0,isDraggable:!1,isEditable:!1},{text:s.CodeCol,dataIndex:"code",width:m.columnSize.code,isSortable:!0,isDraggable:!1,isEditable:!1},{text:s.YearCol,dataIndex:"year",width:m.columnSize.year,isSortable:!0,isDraggable:!1,isEditable:!1},{text:s.titleCol,dataIndex:"title",width:m.columnSize.title,isSortable:!1,isDraggable:!1,isEditable:!1,isResizable:!0}]:"1"===t?[{text:s.CodeCol,dataIndex:"tree",width:m.columnSize.code,isSortable:!0,isDraggable:!1,isEditable:!1},{text:s.RadioButtonName,dataIndex:"name",width:m.columnSize.name,isSortable:!0,isDraggable:!1,isEditable:!1},{text:s.RadioButtonStandard,dataIndex:"standard",width:m.columnSize.standard,isSortable:!0,isDraggable:!1,isEditable:!1},{text:s.YearCol,dataIndex:"year",width:m.columnSize.year,isSortable:!0,isDraggable:!1,isEditable:!1},{text:s.titleCol,dataIndex:"title",width:m.columnSize.title,isSortable:!1,isDraggable:!1,isEditable:!1,isResizable:!0}]:[{text:s.RadioButtonStandard,dataIndex:"tree",width:m.columnSize.standard,isSortable:!0,isDraggable:!1,isEditable:!1},{text:s.RadioButtonName,dataIndex:"name",width:m.columnSize.name,isSortable:!0,isDraggable:!1,isEditable:!1},{text:s.CodeCol,dataIndex:"code",width:m.columnSize.code,isSortable:!0,isDraggable:!1,isEditable:!1},{text:s.YearCol,dataIndex:"year",width:m.columnSize.year,isSortable:!0,isDraggable:!1,isEditable:!1},{text:s.titleCol,dataIndex:"title",width:m.columnSize.title,isSortable:!1,isDraggable:!1,isEditable:!1,isResizable:!0}],h=n.columns,c=new i(n);for(var l=C(e,t),a=0;a<l.length;a++)c.addRoot(l[a]);return 1===l.length&&c.getRoots()[0].expand(),c.getManager().onCellRequest(D),c.getManager().onColumnWidthUpdate(function(){switch(m.groupBy){case"0":m.columnSize={name:h[0].width,standard:h[1].width,code:h[2].width,year:h[3].width,title:h[4].width};break;case"1":m.columnSize={name:h[1].width,standard:h[2].width,code:h[0].width,year:h[3].width,title:h[4].width};break;case"2":m.columnSize={name:h[1].width,standard:h[0].width,code:h[2].width,year:h[3].width,title:h[4].width}}S("onPreferenceModified",m)}),c}function k(e,t){m.groupBy=e,S("onPreferenceModified",m),(c=w(t,m.groupBy)).inject(d)}this.buildPanel=function(t,i,a){this.cleanPanel(),f=t,m=JSON.parse(i),p=e.createElement("div",{id:"CAT3DAnnotInfoMainDiv",class:"CAT3DAnnotInfoMainDiv"}),d=e.createElement("div",{class:"CAT3DAnnotStdInfoTreeDiv"});var o=e.createElement("div",{class:"CAT3DAnnotStdInfoRadioDiv"}),r=new n({type:"label",label:s.RadioLabel}).inject(o),h=new n({type:"radio",value:"option1",label:s.RadioButtonName,checkFlag:"0"===m.groupBy}).inject(o),u=new n({type:"radio",value:"option2",label:s.RadioButtonCode,checkFlag:"1"===m.groupBy}).inject(o),b=new n({type:"radio",value:"option3",label:s.RadioButtonStandard,checkFlag:"2"===m.groupBy}).inject(o);return a&&(g=new l({label:s.ShowAllButton,onClick:function(){S("onShowAllClick")}}).inject(o)).getContent().setStyles({"margin-left":"320px",display:"inline-block"}),r.getContent().setStyle("display","inline-block"),h.getContent().setStyles({"margin-left":"20px",display:"inline-block"}),u.getContent().setStyles({"margin-left":"20px",display:"inline-block"}),b.getContent().setStyles({"margin-left":"20px",display:"inline-block"}),o.inject(p),h.addEventListener("buttonclick",function(){k("0",f)}),u.addEventListener("buttonclick",function(){k("1",f)}),b.addEventListener("buttonclick",function(){k("2",f)}),(c=w(t,m.groupBy)).inject(d),d.inject(p),p},this.updatePanel=function(e){return f=e,g&&g.getContent().setStyle("display","none"),(c=w(e,m.groupBy)).inject(d),d.inject(p),p},this.cleanPanel=function(){c&&c.destroy(),c=d=h=u=p=m=null,b.length=0},this.subscribe=function(e,t){if(e&&t)return y.subscribe({event:e},t)},this.unsubscribe=function(e){null!=e&&y.unsubscribe(e)}}})}),define("DS/CAT3DAnnotationPanels/CAT3DAnnotationFilterPanel",["UWA/Core","UWA/Class","DS/CoreEvents/ModelEvents","DS/CAT3DAnnotationBaseUI/CAT3DAnnotationFilterListItem","DS/CAT3DAnnotationBaseUI/CAT3DAnnotationFilterTolFilterItem","UWA/Controls/ThemedScroller","DS/UIKIT/SuperModal","DS/WebappsUtils/WebappsUtils","DS/CATWebUXComponents/CATWebUXSectionHeader","i18n!DS/CAT3DAnnotationRsc/assets/nls/CAT3DAnnotationSubtypes","i18n!DS/CAT3DAnnotationRsc/assets/nls/CAT3DAnnotationSupertypes","i18n!DS/CAT3DAnnotationRsc/assets/nls/CAT3DAnnotationTypes","i18n!DS/CAT3DAnnotationRsc/assets/nls/CAT3DAnnotationAttributesCategories","i18n!DS/CAT3DAnnotationPanels/assets/nls/CAT3DAnnotationPanels","css!DS/CAT3DAnnotationPanels/CAT3DAnnotationPanels.css"],function(e,t,n,i,l,a,o,s,r,c,d,h,u,p){"use strict";return t.extend({init:function(t){var g=t||{};this._parent(g);var f,m,b,y,A,C,v,S,D,w,k,P=this,F=void 0!==g.style&&void 0!==g.style.version?g.style.version:1,T=void 0!==g.style&&(void 0!==g.style.semanticUI&&g.style.semanticUI),I=[],V=[],x=[],E=[],M=[],R="AnnotSetAssemblyRoot",L="AnnotViewsCustom",N="AnnotsCustom",B="AttributesAll",O=new n,U=[],_=[],j=[],W=[],H=[],z=!1,q=!1,G=new o({renderTo:document.body});this.buildPanel=function(t){this.cleanPanel(),t.attrTypesFilteredByPref&&t.attrTypesFilteredByPref.length&&(W=t.attrTypesFilteredByPref.slice()),t.attrTypesOrderedList&&t.attrTypesOrderedList.length&&(H=t.attrTypesOrderedList.slice()),te(t.model),f||(f=e.createElement("div",{id:"CAT3DAnnotFilterMainDiv",class:"CAT3DAnnotFilterMainDiv"}));var n=e.createElement("div",{id:"CAT3DAnnotFilterScrollerDiv"}),i=(new a).inject(f);i.getInnerElement().setContent(n),i.getInnerElement().parentNode.setStyle("height","100%");var l=e.createElement("div",{id:"CAT3DAnnotSetsSection",class:"CAT3DAnnotSectionMainDiv"}).inject(n);return I.push(new r({sectionLabel:p.AnnotSetsSectionLbl,displayTooltip:!1,doubleClickCB:se})),l.appendChild(I[I.length-1].getContent()),C=e.createElement("div",{class:"CAT3DAnnotFilterSectionDiv"}).inject(l),Q(!0,l,C),ie(),1===F&&(m=e.createElement("div",{id:"CAT3DAnnotViewsSection",class:"CAT3DAnnotSectionMainDiv"}).inject(n),I.push(new r({sectionLabel:p.AnnotViewsSectionLbl,displayTooltip:!1,doubleClickCB:se})),m.appendChild(I[I.length-1].getContent()),v=e.createElement("div",{class:"CAT3DAnnotFilterSectionDiv"}).inject(m),le()),b=e.createElement("div",{id:"CAT3DAnnotsSection",class:"CAT3DAnnotSectionMainDiv"}).inject(n),I.push(new r({sectionLabel:p.AnnotsSectionLbl,displayTooltip:!1,doubleClickCB:se})),b.appendChild(I[I.length-1].getContent()),A=e.createElement("div",{class:"CAT3DAnnotFilterSectionDiv"}).inject(b),ae(),1!==F&&T&&(y=e.createElement("div",{id:"CAT3DAttributesSection",class:"CAT3DAnnotSectionMainDiv"}).inject(n),I.push(new r({sectionLabel:p.AttributesSectionLbl,displayTooltip:!1,doubleClickCB:se})),y.appendChild(I[I.length-1].getContent()),S=e.createElement("div",{class:"CAT3DAnnotFilterSectionDiv"}).inject(y),oe()),K(),P.setOptionsAvailableFlag(k),f},this.cleanPanel=function(e){var t;for(t=0;t<V.length;t++)V[t].clear();for(V.splice(0,V.length),t=0;t<x.length;t++)x[t].clear();for(x.splice(0,x.length),t=0;t<E.length;t++)E[t].clear();for(E.splice(0,E.length),t=0;t<M.length;t++)M[t].clear();for(M.splice(0,M.length),t=0;t<I.length;t++)I[t].clear();if(I.splice(0,I.length),f)for(;f.firstChild;)f.removeChild(f.firstChild);A=null,C=null,v=null,S=null,D=null,e&&(R="AnnotSetAssemblyRoot",L="AnnotViewsCustom",N="AnnotsCustom",B="AttributesAll",U.length=0,_.length=0,j.length=0,W.length=0,H.length=0,q=!1,z=!1,w=null)};var J=function(e,t){if(!e||!t||e&&t&&e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0};this.updatePanel=function(e){if(!f||!C)return this.buildPanel(e);var t=te(e.model);t.rebuildPanel?(ie(),le(),ae()):J(e.attrTypesFilteredByPref,W)&&J(e.attrTypesOrderedList,H)||(W=e.attrTypesFilteredByPref.slice(),H=e.attrTypesOrderedList.slice()),K(),1!==F&&T&&oe(),t.refreshViewsSection&&ue({name:L,forceRefresh:!0}),t.refreshAnnotsSection&&pe({name:N,forceRefresh:!0}),(q||z)&&(z=!1,q=!1,ve(),Z(!0)),P.setOptionsAvailableFlag(k)};var X=function(e){var t=e.type,n="";return 11===e.superType?n=6===t?"Captures":"Views":40===t||41===t||42===t||43===t||44===t||45===t||46===t||54===t?n="Geometries":22===t||23===t||24===t||25===t||26===t||27===t||28===t?n="GeomTolerances":12===t||13===t||14===t||15===t||16===t||37===t||38===t?n="Dimensions":7===t||8===t||9===t||10===t||11===t?n="GeomTolerances":19===t||20===t||21===t?n="GeomTolerances":17===t||18===t?n="GeomTolerances":5===t?n="Datums":35===t?n="Datums":3===t?n="Datums":4===t?n="GeomTolerances":34===t?n="Dimensions":36===t?n="Dimensions":29===t?n="Roughness":31===t?n="Welds":1===t?n="Notes":2===t?n="Notes":30===t?n="Notes":51===t?n="RestrictedAreas":55===t&&(n="EdgeSpecifications"),n},K=function(){if("AnnotSetCustom"!==R){var e,t,n,i=!1;for(t=0;t<U.length;t++){var l=U[t];if(e=void 0===l.checkFlagInAllSection?l.hasBeenEntirelyLoaded:l.checkFlagInAllSection,"AnnotSetAll"!==R||1!==U.length||e){if(l.children.length)for(n=0;n<l.children.length;n++)if("AnnotSetAll"===R){if(e=void 0===l.checkFlagInAllSection?l.hasBeenEntirelyLoaded:l.checkFlagInAllSection,(1===U.length||U.length>1&&e)&&!l.children[n].isVisible||U.length>1&&!e&&l.children[n].isVisible){i=!0;break}}else if("AnnotSetAssemblyRoot"===R){if(1===U.length){if(!l.children[n].isVisible&&l.children[n].isDirectChild||l.children[n].isVisible&&!l.children[n].isDirectChild){i=!0;break}}else if(U.length>1&&(l.checkFlagInAssySection&&l.children[n].isDirectChild&&!l.children[n].isVisible||l.checkFlagInAssySection&&!l.children[n].isDirectChild&&l.children[n].isVisible||!l.checkFlagInAssySection&&l.children[n].isVisible)){i=!0;break}}else if("AnnotSetNone"===R&&l.children[n].isVisible){i=!0;break}}else i=!0;if(i)break}if(i){for(t=0;t<U.length;t++)for(n=0;n<U[t].children.length;n++)U[t].children[n].checkFlagInCustomSection=U[t].children[n].isVisible;return he({name:"AnnotSetCustom"})}}Z(!1)},Y=function(e){return 11===e.superType?6===e.type?"Capture":"View":e.type},Z=function(e){e&&ne();var t,n,i,l,a=0,o=0,s=!1,r=!1;for(t=0;t<U.length;t++){var c=U[t],d=void 0===c.checkFlagInAllSection?c.hasBeenEntirelyLoaded:c.checkFlagInAllSection;for(c.allView&&c.allView.setCheckFlag(d),c.assyView&&c.assyView.setCheckFlag(c.checkFlagInAssySection),n=0;n<c.children.length;n++){var h=c.children[n];for(h.view&&h.view.setCheckFlag(h.checkFlagInCustomSection),i=0;i<h.children.length;i++){var u=h.children[i];if("RootAttributes"!==u.type)for(l=0;l<u.children.length;l++){var p=u.children[l];"RootViews"!==u.type&&"RootCaptures"!==u.type||!h.isVisible?(h.isVisible&&(r=!0),p.isDisplayed&&h.isVisible&&o++):(a++,s=!0),p.view&&(p.view.setCheckFlag(p.checkFlagInCustomSection),p.view.setDisplayFlag(p.isDisplayed))}}}}for(t=0;t<_.length;t++)for(_[t].view.setDisplayFlag(_[t].isDisplayed),n=0;n<_[t].types.length;n++)_[t].types[n].view.setDisplayFlag(_[t].types[n].isDisplayed);for(t=0;t<V.length;t++)V[t].update(),V[t].setCheckFlag(V[t].name===R);for(t=0;t<x.length;t++)"AnnotViewsAll"===x[t].name&&x[t].setNbElems(a),x[t].update("AnnotViewsCustom"===x[t].name),x[t].setCheckFlag(x[t].name===L);for(1===F&&Q(s,m,v),t=0;t<E.length;t++)"AnnotsAll"===E[t].name&&(1===F?E[t].setNbElems(o):E[t].setNbElems(o+a)),E[t].update("AnnotsCustom"===E[t].name||"AnnotsType"===E[t].name),"AnnotsDisplayOnlyDefault"!==E[t].name&&"AnnotsFilterByTol"!==E[t].name?E[t].setCheckFlag(E[t].name===N):"AnnotsDisplayOnlyDefault"===E[t].name?E[t].setCheckFlag(z):"AnnotsFilterByTol"===E[t].name&&E[t].setCheckFlag(q);Q(1===F?r:r||s,b,A);var g=0,f=!1;for(t=0;t<j.length;t++)j[t].isDisplayed&&-1===W.indexOf(j[t].name)&&g++,(j[t].view&&j[t].view.isDisplayed()!==j[t].isDisplayed||!j[t].view&&j[t].isDisplayed)&&(f=!0);for(f&&oe(),t=0;t<M.length;t++)"AttributesAll"===M[t].name&&M[t].setNbElems(g),M[t].update("AttributesType"===M[t].name),M[t].setCheckFlag(M[t].name===B);1!==F&&T&&Q(0!==g,y,S)},Q=function(e,t,n){t.querySelector(".CATWebUXSectionHeader").setStyles({color:e?"":"rgb(190, 190, 190)"}),n.setStyles({height:e?"auto":"",padding:e?"5px":"0px 5px",overflow:e?"auto":"",opacity:e?"1":"0.5"})};this.setOptionsAvailableFlag=function(e){(k=e)&&"object"==typeof k&&Object.keys(k).forEach(function(e){"AnnotSetAll"===e&&V.some(function(t){if("AnnotSetAll"===t.name&&!k[e])return t.setEnableFlag(k[e]),he({name:"AnnotSetCustom"}),!0})})},this.getCurrentAnnotationSetSection=function(){return R},this.subscribe=function(e,t){if(e&&t)return O.subscribe({event:e},t)},this.unsubscribe=function(e){null!=e&&O.unsubscribe(e)};var $=function(e,t,n,i){var l,a=!0;for(l=0;l<e.length;l++)if(e[l].name===t){null!==e[l].isDisplayed&&!1!==e[l].isDisplayed||(e[l].isDisplayed=i),a=!1;break}if(a){var o=n;o||(o=s.getWebappsAssetUrl("CAT3DAnnotationRsc","icons/22/"),"3DAnnotations"===t?o+="I_W3DAnnot_NodeAnnotationSet.png":o=null);var r={name:t,checkFlag:!0,icon:o,isDisplayed:i};for(l=0;l<j.length;l++)if(j[l].name===t){r.checkFlag=j[l].checkFlag;break}e.push(r)}},ee=function(e,t,n){0===Y(e)?e.hyperlink&&(e.hyperlink.relatedDocs&&e.hyperlink.relatedDocs.length||e.hyperlink.hyperlinksAndComments||e.hyperlink.failureModes&&e.hyperlink.failureModes.length||e.hyperlink.requirements&&e.hyperlink.requirements.length)&&$(t,"3DAnnotations",null,n):$(t,"3DAnnotations",null,n)},te=function(e){var t,n,i,l,a,o,s,r=[],c=e.length!==U.length,d=0,h=[];for(l=0;l<j.length;l++)j[l].isDisplayed=null;for(l=0;l<e.length;l++){var u=e[l],p=null;for(a=0;a<U.length;a++)if(U[a].id===u.id){p=U[a];break}if(p){for("boolean"==typeof u.hasBeenEntirelyLoaded&&(p.hasBeenEntirelyLoaded=u.hasBeenEntirelyLoaded),a=p.children.length-1;a>=0;a--){var g=!1;for(o=0;o<u.children.length;o++)if(u.children[o].id===p.children[a].id){g=!0;break}g||(c=!0,p.children.splice(a,1))}var f=!1;for(a=0;a<u.children.length;a++){t=u.children[a];var m=-1;for(o=0;o<p.children.length;o++)if(t.id===p.children[o].id){m=o;break}if(-1===m){for(c=!0,f=!0,n={},Object.assign(n,t),n.checkFlagInCustomSection=t.isVisible,p.children.push(n),o=0;o<n.children.length;o++)for(i=n.children[o],s=0;s<i.children.length;s++)i.children[s].checkFlagInCustomSection=i.children[s].isVisible;"AnnotsCustom"!==N&&(N="AnnotsCustom",d=0===d?1:3),"AnnotViewsCustom"!==L&&(L="AnnotViewsCustom",d=0===d?2:3)}else{p.children[m].referenceLabel!==t.referenceLabel&&(c=!0,p.children[m].referenceLabel=t.referenceLabel),p.children[m].isVisible!==t.isVisible&&("AnnotsCustom"!==N&&(N="AnnotsCustom",d=0===d?1:3),"AnnotViewsCustom"!==L&&(L="AnnotViewsCustom",d=0===d?2:3),p.children[m].isVisible=t.isVisible,p.children[m].checkFlagInCustomSection=t.isVisible);var b=0;for(o=0;o<p.children[m].children.length;o++){i=p.children[m].children[o];var y=t.children[o];for(s=0;s<i.children.length;s++){var A=i.children[s],C=y.children[s],v=!1;A.id===C.id?(A.name!==C.name&&A.view&&A.view.setLabel(A.name),A.isVisible!==C.isVisible&&(v=!0,A.isVisible=C.isVisible,A.checkFlagInCustomSection=C.isVisible)):(v=!0,i.children.splice(s,1,C),c=!0),v&&("RootViews"!==i.type&&"RootCaptures"!==i.type||"AnnotViewsCustom"===L?"RootViews"!==i.type&&"RootCaptures"!==i.type&&"AnnotsCustom"!==N&&(N="AnnotsCustom",b=0===b?2:3):(L="AnnotViewsCustom",b=0===b?1:3))}}if(0!==b)for(o=0;o<p.children[m].children.length;o++)for(i=p.children[m].children[o],s=0;s<i.children.length;s++)("RootViews"!==i.type&&"RootCaptures"!==i.type||1!==b&&3!==b)&&("RootViews"===i.type||"RootCaptures"===i.type||2!==b&&3!==b)||(i.children[s].checkFlagInCustomSection=i.children[s].isVisible)}}if(f){var S=[];for(a=0;a<u.children.length;a++)for(o=0;o<p.children.length;o++)if(u.children[a].id===p.children[o].id){S.push(p.children[o]);break}p.children=S}}else{c=!0;var D=[];for(a=0;a<u.children.length;a++)n={},Object.assign(n,u.children[a]),n.checkFlagInCustomSection=u.children[a].isVisible,D.push(n);var w="3DShape"===u.type||"CATPart"===u.type||"3DPart"===u.type;"boolean"==typeof u.hasBeenEntirelyLoaded&&(w=u.hasBeenEntirelyLoaded),p={id:u.id,name:u.name,icon:u.icon,children:D,hasBeenEntirelyLoaded:w,checkFlagInAssySection:!0}}for(h.push(p),a=0;a<u.children.length;a++)for(t=u.children[a],p.children[a].hyperlink=t.hyperlink,ee(t,r,t.isVisible),o=0;o<t.children.length;o++)if("RootAttributes"===(i=t.children[o]).type)for(s=0;s<i.children.length;s++)$(r,i.children[s].category,i.children[s].icon,t.isVisible);else if("RootViews"!==i.type&&"RootCaptures"!==i.type)for(s=0;s<i.children.length;s++){if(!p.children[a].children[o].children[s]){c=!0;break}p.children[a].children[o].children[s].hyperlink=i.children[s].hyperlink,ee(i.children[s],r,t.isVisible)}}if(1!==F&&T){var k=[];for(l=0;l<H.length;l++){var P=!1;for(a=r.length-1;a>=0;a--)if(H[l]===r[a].name){k.push(r[a]),r.splice(a,1),P=!0;break}if(!P)for(a=j.length-1;a>=0;a--)if(H[l]===j[a].name){k.push(j[a]),k[k.length-1].isDisplayed=!1;break}}j=k}for(h=h.slice(0,h.length),U=[],l=0;l<e.length;l++)for(a=0;a<h.length;a++)if(h[a].id===e[l].id){U.push(h[a]);break}return ne(),{rebuildPanel:c,refreshViewsSection:2===d||3===d,refreshAnnotsSection:1===d||3===d}},ne=function(){var e,t,n,i,l,a,o,s,r,c,d=[];for(e=0;e<j.length;e++)j[e].isDisplayed=null;if(T)for(e=0;e<_.length;e++)for(_[e].isDisplayed=!1,t=0;t<_[e].types.length;t++)_[e].types[t].isDisplayed=!1;for(e=0;e<U.length;e++)for(r=U[e],t=0;t<r.children.length;t++)for(s=r.children[t],ee(s,d,s.isVisible),n=0;n<s.children.length;n++)for(c=s.children[n],i=0;i<c.children.length;i++){"RootAttributes"===c.type?$(d,c.children[i].category,c.children[i].icon,s.isVisible):"RootViews"!==c.type&&"RootCaptures"!==c.type&&ee(c.children[i],d,s.isVisible),o=c.children[i];var u=!0;if("AnnotSetAll"===R&&U.length>1&&(!1===r.checkFlagInAllSection||void 0===r.checkFlagInAllSection&&!r.hasBeenEntirelyLoaded)&&(u=!1),u&&"AnnotSetAssemblyRoot"===R&&(1===U.length&&!s.isDirectChild||U.length>1&&!r.checkFlagInAssySection||U.length>1&&r.checkFlagInAssySection&&!s.isDirectChild)&&(u=!1),u&&"AnnotSetCustom"===R&&!s.checkFlagInCustomSection&&(u=!1),u&&"AnnotSetNone"===R&&(u=!1),u&&"RootViews"!==c.type&&"RootCaptures"!==c.type&&re(o)?o.isDisplayed=!1:o.isDisplayed=u,T&&(1===F&&"RootViews"!==c.type&&"RootCaptures"!==c.type||1!==F)){var p="";switch(o.superType){case 1:p="NonSemantic";break;case 2:p="Datum";break;case 3:p="PosOrRun";break;case 4:p="Size";break;case 5:case 6:p="PosOrRun";break;case 7:p="Form";break;case 8:p="Geometry";break;case 10:p="RestrictedAreas";break;case 11:p="ViewsAndCaptures";break;default:p=""}if(p){var g=-1,f=-1;for(l=0;l<_.length;l++)if(_[l].name===p){g=l;break}-1===g&&(_.push({name:p,types:[]}),g=_.length-1);var m=h[Y(o)];for(l=0;l<_[g].types.length;l++)if(_[g].types[l].name===m){f=l;break}-1===f&&m&&_[g].types.push({name:m,type:Y(o),checkFlag:!1,isDisplayed:!1})}}}for(e=0;e<d.length;e++)for(t=0;t<j.length;t++)if(j[t].name===d[e].name){j[t].isDisplayed=d[e].isDisplayed;break}if(T)for(e=0;e<U.length;e++)for(r=U[e],t=0;t<r.children.length;t++)for(s=r.children[t],n=0;n<s.children.length;n++)for(c=s.children[n],i=0;i<c.children.length;i++)if(1===F&&"RootViews"!==c.type&&"RootCaptures"!==c.type||1!==F)for(o=c.children[i],l=0;l<_.length;l++)for(a=0;a<_[l].types.length;a++)if(_[l].types[a].name===h[Y(o)]&&o.isDisplayed){_[l].types[a].isDisplayed=!0;break}},ie=function(){var e,t,n,l;for(e=0;e<V.length;e++)V[e].getContent().parentNode===C&&(V[e].clear(),C.removeChild(V[e].getContent()));if(V.splice(0,V.length),U&&U.length>1)for(n=[],l=[],e=0;e<U.length;e++)n.push(new i({id:"AnnotSetAll_"+e,idPath:[e],name:U[e].name,icon:U[e].icon,header:U[e].name,type:"checkbox",className:"AnnotFilterLeaf",displayNbElems:!1,displayTitle:!1,callback:fe,checkFlag:void 0===U[e].checkFlagInAllSection?U[e].hasBeenEntirelyLoaded:U[e].checkFlagInAllSection})),U[e].allView=n[n.length-1],l.push(new i({id:"AnnotSetAssemblyRoot_"+e,idPath:[e],name:U[e].name,icon:U[e].icon,header:U[e].name,type:"checkbox",className:"AnnotFilterLeaf",displayNbElems:!1,displayTitle:!1,callback:me,checkFlag:U[e].checkFlagInAssySection})),U[e].assyView=l[l.length-1];V.push(new i({id:"AnnotSetAll",name:"AnnotSetAll",type:"radio",header:p.AllSectionLbl,checkFlag:"AnnotSetAll"===R,children:n,displayNbElems:void 0!==n,noSelectAll:!0,className:"AnnotFilterMainSection",callback:he,expandingPreference:"AnnotationSets.All"})),V.push(new i({id:"AnnotSetAssemblyRoot",name:"AnnotSetAssemblyRoot",type:"radio",header:p.AssemblyRootSectionLbl,checkFlag:"AnnotSetAssemblyRoot"===R,children:l,displayNbElems:void 0!==l,noSelectAll:!0,className:"AnnotFilterMainSection",callback:he,expandingPreference:"AnnotationSets.AssemblyRoots"}));var a=U.length>1;if(a){var o=0;for(e=0;e<U.length;e++)U[e].children.length&&o++;a=o>1}var s=[];for(e=0;e<U.length;e++){var r=!0,c=[];for(t=0;t<U[e].children.length;t++)U[e].children[t].checkFlagInCustomSection||(r=!1),c.push(new i({id:"AnnotSetCustom_"+e+"_"+t,idPath:[e,t],name:U[e].children[t].referenceLabel+" / "+U[e].children[t].name,icon:U[e].children[t].referenceIcon,header:U[e].children[t].referenceLabel+" / "+U[e].children[t].name,type:"checkbox",className:"AnnotFilterLeaf",displayNbElems:!1,displayTitle:!0,callback:be,checkFlag:U[e].children[t].checkFlagInCustomSection})),U[e].children[t].view=c[c.length-1];a?U[e].children.length&&s.push(new i({id:"AnnotSetCustom_"+e,type:"checkbox",name:U[e].name||p.DefaultRootLbl+"."+e,header:U[e].name||p.DefaultRootLbl+"."+e,noSelectAll:!0,displayNbElems:!0,displayTitle:!0,className:"annotFilterSubSection",checkFlag:r,children:c})):c.length&&(s=s.concat(c))}for(V.push(new i({id:"AnnotSetCustom",name:"AnnotSetCustom",type:"radio",header:p.CustomSectionLbl,displayNbElems:s.length>0,displayTitle:!1,noSelectAll:1!==U.length,expandingPreference:"AnnotationSets.Custom",className:"AnnotFilterMainSection",children:s,checkFlag:"AnnotSetCustom"===R,callback:he})),V.push(new i({id:"AnnotSetNone",name:"AnnotSetNone",type:"radio",header:p.NoneSectionLbl,checkFlag:"AnnotSetNone"===R,displayNbElems:!1,displayTitle:!1,className:"AnnotFilterMainSection",callback:he})),e=0;e<V.length;e++)C.appendChild(V[e].getContent())},le=function(){if(1===F){var e,t,n,l;for(e=0;e<x.length;e++)x[e].getContent().parentNode===v&&(x[e].clear(),v.removeChild(x[e].getContent()));x.splice(0,x.length);var a=[],o=[],s=!0,r=!0;if(U&&U.length)for(e=0;e<U.length;e++){var d=U[e];for(t=0;t<d.children.length;t++){var h=d.children[t];for(n=0;n<h.children.length;n++){var u=h.children[n];if("RootViews"===u.type)for(l=0;l<u.children.length;l++){var g=u.children[l];g.checkFlagInCustomSection=void 0!==g.checkFlagInCustomSection?g.checkFlagInCustomSection:g.isVisible,o.push(new i({id:"AnnotViewsCustomViews_"+e+"_"+t+"_"+n+"_"+l,idPath:[e,t,n,l],isDisplayed:g.isDisplayed,name:g.name+" / "+h.referenceLabel+" / "+h.name,header:g.name+" / "+h.referenceLabel+" / "+h.name,icon:g.icon,type:"checkbox",displayNbElems:!1,displayTitle:!0,className:"AnnotFilterLeaf",callback:ye,checkFlag:g.checkFlagInCustomSection})),o[o.length-1].setDisplayFlag(g.isDisplayed),g.isDisplayed&&!g.isVisible&&(s=!1),g.view=o[o.length-1]}else if("RootCaptures"===u.type)for(l=0;l<u.children.length;l++){var f=u.children[l];f.checkFlagInCustomSection=void 0!==f.checkFlagInCustomSection?f.checkFlagInCustomSection:f.isVisible,a.push(new i({id:"AnnotViewsCustomCaps_"+e+"_"+t+"_"+n+"_"+l,idPath:[e,t,n,l],name:f.name+" / "+h.referenceLabel+" / "+h.name,header:f.name+" / "+h.referenceLabel+" / "+h.name,icon:f.icon,type:"checkbox",displayNbElems:!1,displayTitle:!0,className:"AnnotFilterLeaf",isDisplayed:f.isDisplayed,callback:ye,checkFlag:f.checkFlagInCustomSection})),a[a.length-1].setDisplayFlag(f.isDisplayed),f.isDisplayed&&!f.isVisible&&(r=!1),f.view=a[a.length-1]}}}}var b,y=[];if(o.length){for(b=!1,e=0;e<o.length;e++)if(o[e].isDisplayed()){b=!0;break}y.push(new i({id:"AnnotationViews.Custom.Views",name:"Views",type:"checkbox",className:"annotFilterSubSection",isDisplayed:b,header:c.Views,children:o,checkFlag:s,noSelectAll:!0,displayNbElems:!0,displayTitle:!0,expandingPreference:"AnnotationViews.Custom.Views"}))}if(a.length){for(b=!1,e=0;e<a.length;e++)if(a[e].isDisplayed()){b=!0;break}y.push(new i({id:"AnnotationViews.Custom.Captures",name:"Captures",type:"checkbox",isDisplayed:b,className:"annotFilterSubSection",header:c.Captures,children:a,checkFlag:r,noSelectAll:!0,displayNbElems:!0,displayTitle:!0,expandingPreference:"AnnotationViews.Custom.Captures"}))}for(x.push(new i({id:"AnnotViewsAll",name:"AnnotViewsAll",type:"radio",header:p.AllSectionLbl,className:"AnnotFilterMainSection",checkFlag:"AnnotViewsAll"===L,displayNbElems:!0,displayTitle:!1,nbElems:o.length+a.length,callback:ue})),x.push(new i({id:"AnnotViewsCustom",name:"AnnotViewsCustom",type:"radio",header:p.CustomSectionLbl,checkFlag:"AnnotViewsCustom"===L,children:y,expandingPreference:"AnnotationViews.Custom",noSelectAll:!0,displayNbElems:!0,displayTitle:!1,className:"AnnotFilterMainSection",callback:ue})),e=0;e<x.length;e++)v.appendChild(x[e].getContent());Q(o.length+a.length!==0,m,v)}},ae=function(){var t,n,a,o;for(t=0;t<E.length;t++)E[t].getContent().parentNode===A&&(E[t].clear(),A.removeChild(E[t].getContent()));D&&(A.removeChild(D),D=null),E.splice(0,E.length);var s,r=[],h=0;if(U&&U.length)for(t=0;t<U.length;t++){var u=U[t];for(n=0;n<u.children.length;n++){var g=u.children[n];for(a=0;a<g.children.length;a++){var f=g.children[a];if(1===F&&"RootViews"!==f.type&&"RootCaptures"!==f.type||1!==F){var m=f.children;for(o=0;o<m.length;o++){var y=m[o];y.checkFlagInCustomSection=void 0!==y.checkFlagInCustomSection?y.checkFlagInCustomSection:y.isVisible;var C=X(y);if(""!==C){r[C]||(r[C]=[]);var v="Captures"===C||"Views"===C?ye:Ae,S="Captures"===C||"Views"===C?y.name+" / "+g.referenceLabel+" / "+g.name:y.name;r[C].push(new i({id:"AnnotsCustom_"+t+"_"+n+"_"+a+"_"+o,idPath:[t,n,a,o],name:S,icon:y.icon,header:S,isDisplayed:y.isDisplayed,type:"checkbox",displayNbElems:!1,displayTitle:!0,className:"AnnotFilterLeaf",callback:v,checkFlag:y.checkFlagInCustomSection})),h++,y.view=r[C][r[C].length-1],r[C][r[C].length-1].setDisplayFlag(y.isDisplayed)}}}}}}if(E.push(new i({id:"AnnotsAll",name:"AnnotsAll",type:"radio",header:p.AllSectionLbl,checkFlag:"AnnotsAll"===N,callback:pe,displayNbElems:!0,displayTitle:!1,nbElems:h,className:"AnnotFilterMainSection"})),T){var k=[];for(t=0;t<_.length;t++){var P=_[t],I=[];for(s=!0,n=0;n<P.types.length;n++){var V=P.types[n];I.push(new i({id:"AnnotsType_"+t+"_"+n,idPath:[t,n],name:V.name.toString(),header:V.name.toString(),type:"checkbox",displayNbElems:!1,displayTitle:!0,checkFlag:V.checkFlag,className:"AnnotFilterLeaf",callback:Ce})),V.view=I[I.length-1]}k.push(new i({id:"AnnotsType_"+t,idPath:[t],name:P.name.toString(),header:d[P.name.toString()],type:"checkbox",className:"annotFilterSubSection",expandingPreference:"Annotations.Type."+P.name.toString(),children:I,checkFlag:s,noSelectAll:!0,displayTitle:!0})),P.view=k[k.length-1]}E.push(new i({id:"AnnotsType",name:"AnnotsType",header:p.TypeSectionLbl,type:"radio",checkFlag:"AnnotsType"===N,noSelectAll:!0,displayTitle:!1,className:"AnnotFilterMainSection",children:k,callback:pe,expandingPreference:"Annotations.Type"}))}var x,M=Object.keys(c),R=[];for(t=0;t<M.length;t++)for(x=Object.keys(r),n=0;n<x.length;n++)if(x[n]===M[t]){R[x[n]]=r[x[n]];break}var L=[];for(x=Object.keys(R),t=0;t<x.length;t++){s=!0;var B=!1;for(n=0;n<R[x[t]].length;n++)R[x[t]][n].getCheckFlag()||(s=!1),R[x[t]][n].isDisplayed()&&(B=!0);L.push(new i({id:"AnnotsCustom"+x[t].toString(),name:x[t].toString(),type:"checkbox",header:c[x[t].toString()],className:"annotFilterSubSection",isDisplayed:B,checkFlag:s,noSelectAll:!0,displayNbElems:!0,displayTitle:!0,children:R[x[t]],expandingPreference:"Annotations.Custom."+x[t].toString()})),"Captures"===x[t]&&L[L.length-1].addBottomSeparator()}for(E.push(new i({id:"AnnotsCustom",name:"AnnotsCustom",type:"radio",header:p.CustomSectionLbl,checkFlag:"AnnotsCustom"===N,children:L,callback:pe,displayNbElems:!0,noSelectAll:!0,displayTitle:!1,expandingPreference:"Annotations.Custom",className:"AnnotFilterMainSection"})),1!==F&&E.push(new i({id:"AnnotsNone",name:"AnnotsNone",type:"radio",header:p.NoneSectionLbl,checkFlag:"AnnotsNone"===N,callback:pe,displayNbElems:!1,noSelectAll:!0,displayTitle:!1,className:"AnnotFilterMainSection"})),T&&(E.push(new l({name:"AnnotsFilterByTol",checkFlag:q,callback:Se,formulaComponents:w,className:"AnnotFilterTolItem"})),E.push(new i({id:"AnnotsDisplayOnlyDefault",name:"AnnotsDisplayOnlyDefault",header:p.DefaultAnnotationsLbl,type:"checkbox",callback:De,displayNbElems:!1,displayTitle:!1,checkFlag:z,className:"AnnotFilterDefaultItem"}))),t=0;t<E.length;t++)"AnnotsFilterByTol"===E[t].name&&(D=e.createElement("div",{class:"AnnotFilterSeparator"}),A.appendChild(D)),A.appendChild(E[t].getContent());Q(0!==h,b,A)},oe=function(){if(1!==F){var e;for(e=0;e<M.length;e++)M[e].getContent().parentNode===S&&(M[e].clear(),S.removeChild(M[e].getContent()));M.splice(0,M.length);var t,n=[],l=[];for(e=0;e<j.length;e++)if(j[e].view=null,W&&-1===W.indexOf(j[e].name)&&j[e].isDisplayed){var a=u[j[e].name]||u.unknownAttribute+"("+j[e].name+")";j[e].view=new i({id:"AttributesType_"+e,idPath:[e],name:j[e].name,icon:j[e].icon,header:a,type:"checkbox",displayNbElems:!1,displayTitle:!0,checkFlag:j[e].checkFlag,className:"AnnotFilterLeaf",callback:we}),isNaN(parseFloat(j[e].name))?n.push(j[e].view):"2"===j[e].name?t=j[e].view:l.push(j[e].view)}var o=(t?1:0)+n.length+l.length;M.push(new i({id:"AttributesAll",name:"AttributesAll",type:"radio",header:p.AllSectionLbl,checkFlag:"AttributesAll"===B,callback:ge,displayNbElems:!0,displayTitle:!1,nbElems:o,className:"AnnotFilterMainSection"}));var s=[];for(t&&s.push(t),s=(s=s.concat(n)).concat(l),M.push(new i({id:"AttributesType",name:"AttributesType",type:"radio",header:p.TypeSectionLbl,checkFlag:"AttributesType"===B,callback:ge,children:s,displayNbElems:!1,displayTitle:!1,noSelectAll:s.length<=1,expandingPreference:"Attributes.Type",className:"AnnotFilterMainSection"})),M.push(new i({id:"AttributesNone",name:"AttributesNone",type:"radio",header:p.NoneSectionLbl,checkFlag:"AttributesNone"===N,callback:ge,displayNbElems:!1,noSelectAll:!0,displayTitle:!1,className:"AnnotFilterMainSection"})),e=0;e<M.length;e++)S.appendChild(M[e].getContent());Q(0!==o,y,S)}},se=function(){ke("onFilterPanelResized")},re=function(e){return e.hiddenByDefaultFilter||e.hiddenByTolFilter},ce=function(e){if(1===e.superType||2===e.superType||8===e.superType||9===e.superType)return!1;var t;if(e.toleranceLimits){var n=e.toleranceLimits;t=n.max-n.min}else t=e.toleranceValue;return void 0!==t&&("equal"===w.leftOperand?t===w.leftValue:"infEqual"===w.leftOperand?"infEqual"===w.rightOperand?t>=w.leftValue&&t<=w.rightValue:t>=w.leftValue&&t<w.rightValue:"infEqual"===w.rightOperand?t>w.leftValue&&t<=w.rightValue:t>w.leftValue&&t<w.rightValue)},de=function(e){G.confirm(p.TooManyAnnotSetsLbl,p.WarningSectionLbl,function(t){t?e.onAcceptCB&&e.onAcceptCB():e.onCancelCB&&e.onCancelCB()})},he=function(e){var t,n,i=[];if(R!==e.name){var l=R;if("AnnotSetAll"===(R=e.name)){for(t=0;t<V.length;t++)V[t].setCheckFlag(V[t].name===R);if(1===U.length&&!U[0].hasBeenEntirelyLoaded)return de({idPath:[0],onAcceptCB:function(){for(U[0].hasBeenEntirelyLoaded=!0,U[0].checkFlagInAllSection=!0,t=0;t<V.length;t++)V[t].setCheckFlag(V[t].name===R);var e=[];for(n=0;n<U[0].children.length;n++)U[0].children[n].isVisible||(U[0].children[n].isVisible=!0,e.push({idPath:[0,n],visuFlag:!0}));Z(!0),ke("onAnnotationSetsLoadingRequired",[{idPath:[0]}]),e.length&&ke("onAnnotationsVisibilityModified",e)},onCancelCB:function(){for(he({name:l}),t=0;t<V.length;t++)V[t].setCheckFlag(V[t].name===R);Z(!0)}});for(t=0;t<U.length;t++)for(n=0;n<U[t].children.length;n++)U[t].children[n].isVisible=void 0===U[t].checkFlagInAllSection?U[t].hasBeenEntirelyLoaded:U[t].checkFlagInAllSection,i.push({idPath:[t,n],visuFlag:U[t].children[n].isVisible})}else if("AnnotSetAssemblyRoot"===R){for(t=0;t<U.length;t++)if(1===U.length||U.length>1&&U[t].checkFlagInAssySection)for(n=0;n<U[t].children.length;n++){var a=U[t].children[n].isDirectChild;U[t].children[n].isVisible!==a&&(U[t].children[n].isVisible=a,i.push({idPath:[t,n],visuFlag:a}))}}else if("AnnotSetCustom"===R)for(t=0;t<U.length;t++)for(n=0;n<U[t].children.length;n++)U[t].children[n].isVisible!==U[t].children[n].checkFlagInCustomSection&&(U[t].children[n].isVisible=U[t].children[n].checkFlagInCustomSection,i.push({idPath:[t,n],visuFlag:U[t].children[n].checkFlagInCustomSection}));else if("AnnotSetNone"===R)for(t=0;t<U.length;t++)for(n=0;n<U[t].children.length;n++)U[t].children[n].isVisible&&(U[t].children[n].isVisible=!1,i.push({idPath:[t,n],visuFlag:!1}));Z(!0),ke("onAnnotationsVisibilityModified",i)}for(t=0;t<V.length;t++)V[t].setCheckFlag(V[t].name===R)},ue=function(e){if(1===F){var t,n,i,l,a,o;if(L!==e.name||e.forceRefresh){L=e.name;var s=[],r=[],c=[];for(n=0;n<U.length;n++){var d=U[n];for(i=0;i<d.children.length;i++){var h=d.children[i];for(l=0;l<h.children.length;l++){var u,p=h.children[l];if("RootViews"===p.type||"RootCaptures"===p.type)for(a=0;a<p.children.length;a++){var g=p.children[a];if("AnnotViewsAll"===L)for(g.isVisible=!0,s.push({idPath:[n,i,l,a],visuFlag:!0}),u=g.tpsList,o=0;o<u.length;o++)if(t=h.children[u[o][0]].children[u[o][1]],re(t)){if(!t.isVisible)continue;t.isVisible=!1,s.push({idPath:[n,i,l,a],visuFlag:!1})}else t.isVisible||(t.isVisible=!0,"AnnotsCustom"!==N&&(N="AnnotsCustom"),s.push({idPath:[n,i,u[o][0],u[o][1]],visuFlag:!0}),t.checkFlagInCustomSection=!0);else if("AnnotViewsCustom"===L)for(g.isVisible=g.checkFlagInCustomSection,s.push({idPath:[n,i,l,a],visuFlag:g.checkFlagInCustomSection}),u=g.tpsList,o=0;o<u.length;o++)if(t=h.children[u[o][0]].children[u[o][1]],re(t)){if(!t.isVisible)continue;t.isVisible=!1,s.push({idPath:[n,i,l,a],visuFlag:!1})}else{var f=JSON.stringify([n,i,u[o][0],u[o][1]]);if(g.checkFlagInCustomSection&&-1===r.indexOf(f)){var m=c.indexOf(f);-1!==m&&c.splice(m,1),r.push(f),t.isVisible=!0,t.checkFlagInCustomSection=!0}else g.checkFlagInCustomSection||-1!==c.indexOf(f)||-1!==r.indexOf(f)||(c.push(f),t.isVisible=!1,t.checkFlagInCustomSection=!1)}}}}}if(r.length||c.length){for("AnnotsCustom"!==N&&(N="AnnotsCustom"),n=0;n<r.length;n++)s.push({idPath:JSON.parse(r[n]),visuFlag:!0});for(n=0;n<c.length;n++)s.push({idPath:JSON.parse(c[n]),visuFlag:!1})}Z(!1),ke("onAnnotationsVisibilityModified",s)}for(n=0;n<x.length;n++)x[n].setCheckFlag(x[n].name===L)}},pe=function(e){var t,n,i,l;if(N!==e.name||e.forceRefresh){N=e.name;var a=[];for(t=0;t<U.length;t++){var o=U[t];for(n=0;n<o.children.length;n++){var s=o.children[n];for(i=0;i<s.children.length;i++){var r=s.children[i];if(1===F&&"RootViews"!==r.type&&"RootCaptures"!==r.type||1!==F)for(l=0;l<r.children.length;l++){var c=r.children[l];if("AnnotsAll"===N)if(re(c)){if(!c.isVisible)continue;c.isVisible=!1,a.push({idPath:[t,n,i,l],visuFlag:!1})}else c.isVisible||(c.isVisible=!0,a.push({idPath:[t,n,i,l],visuFlag:!0}));else if("AnnotsType"===N){for(var d=null,h=0;h<_.length;h++){for(var u=0;u<_[h].types.length;u++)if(Y(c)===_[h].types[u].type){d=_[h].types[u].checkFlag;break}if(null!==d)break}if(re(c)){if(!c.isVisible)continue;c.isVisible=!1,a.push({idPath:[t,n,i,l],visuFlag:!1})}else d!==c.isVisible&&(r.children[l].isVisible=d,a.push({idPath:[t,n,i,l],visuFlag:d}))}else if("AnnotsCustom"===N)if(re(c)){if(!c.isVisible)continue;c.isVisible=!1,a.push({idPath:[t,n,i,l],visuFlag:!1})}else c.isVisible!==c.checkFlagInCustomSection&&(c.isVisible=c.checkFlagInCustomSection,a.push({idPath:[t,n,i,l],visuFlag:c.checkFlagInCustomSection}));else"AnnotsNone"===N&&c.isVisible&&(c.isVisible=!1,a.push({idPath:[t,n,i,l],visuFlag:!1}))}}}}ke("onAnnotationsVisibilityModified",a)}for(t=0;t<E.length;t++)"AnnotsDisplayOnlyDefault"!==E[t].name&&"AnnotsFilterByTol"!==E[t].name?E[t].setCheckFlag(E[t].name===N):"AnnotsDisplayOnlyDefault"===E[t].name?E[t].setCheckFlag(z):"AnnotsFilterByTol"===E[t].name&&E[t].setCheckFlag(q)},ge=function(e){var t;if(B!==e.name){B=e.name;var n=[];for(t=0;t<j.length;t++)"AttributesAll"===B?n.push({name:j[t].name,visuFlag:!0}):"AttributesType"===B?n.push({name:j[t].name,visuFlag:j[t].checkFlag}):n.push({name:j[t].name,visuFlag:!1});ke("onAttributesVisibilityModified",n)}for(t=0;t<M.length;t++)M[t].setCheckFlag(M[t].name===B)},fe=function(e){if(U[e.idPath[0]].hasBeenEntirelyLoaded){U[e.idPath[0]].checkFlagInAllSection=e.checkFlag;for(var t=[],n=0;n<U[e.idPath[0]].children.length;n++)t.push({idPath:[e.idPath[0],n],visuFlag:e.checkFlag}),U[e.idPath[0]].children[n].isVisible=e.checkFlag;Z(!0),ke("onAnnotationsVisibilityModified",t)}else de({idPath:e.idPath,onAcceptCB:function(){U[e.idPath[0]].hasBeenEntirelyLoaded=!0,U[e.idPath[0]].checkFlagInAllSection=!0;for(var t=[],n=0;n<U[e.idPath[0]].children.length;n++)U[e.idPath[0]].children[n].isVisible||(U[e.idPath[0]].children[n].isVisible=!0,t.push({idPath:[e.idPath[0],n],visuFlag:!0}));Z(!0),ke("onAnnotationSetsLoadingRequired",[{idPath:e.idPath}]),t.length&&ke("onAnnotationsVisibilityModified",t)},onCancelCB:function(){Z(!0)}})},me=function(e){U[e.idPath[0]].checkFlagInAssySection=e.checkFlag;for(var t=[],n=0;n<U[e.idPath[0]].children.length;n++)U[e.idPath[0]].children[n].isDirectChild&&(t.push({idPath:[e.idPath[0],n],visuFlag:e.checkFlag}),U[e.idPath[0]].children[n].isVisible=e.checkFlag);Z(!0),ke("onAnnotationsVisibilityModified",t)},be=function(e){U[e.idPath[0]].children[e.idPath[1]].checkFlagInCustomSection=e.checkFlag,U[e.idPath[0]].children[e.idPath[1]].isVisible=e.checkFlag,Z(!0),ke("onAnnotationsVisibilityModified",[{idPath:e.idPath,visuFlag:e.checkFlag}])},ye=function(e){U[e.idPath[0]].children[e.idPath[1]].children[e.idPath[2]].children[e.idPath[3]].checkFlagInCustomSection=e.checkFlag,U[e.idPath[0]].children[e.idPath[1]].children[e.idPath[2]].children[e.idPath[3]].isVisible=e.checkFlag;for(var t=[{idPath:e.idPath,visuFlag:e.checkFlag}],n=U[e.idPath[0]].children[e.idPath[1]].children[e.idPath[2]].children[e.idPath[3]].tpsList,i=U[e.idPath[0]].children[e.idPath[1]],l=0;l<n.length;l++){var a=i.children[n[l][0]].children[n[l][1]];if(re(a)){if(!a.isVisible)continue;a.isVisible=!1,t.push({idPath:[e.idPath[0],e.idPath[1],n[l][0],n[l][1]],visuFlag:!1})}else a.isVisible!==e.checkFlag&&(t.push({idPath:[e.idPath[0],e.idPath[1],n[l][0],n[l][1]],visuFlag:e.checkFlag}),a.isVisible=e.checkFlag,a.checkFlagInCustomSection=e.checkFlag)}"AnnotsCustom"!==N&&(N="AnnotsCustom"),Z(!1),ke("onAnnotationsVisibilityModified",t)},Ae=function(e){U[e.idPath[0]].children[e.idPath[1]].children[e.idPath[2]].children[e.idPath[3]].checkFlagInCustomSection=e.checkFlag,U[e.idPath[0]].children[e.idPath[1]].children[e.idPath[2]].children[e.idPath[3]].isVisible=e.checkFlag,Z(!1),ke("onAnnotationsVisibilityModified",[{idPath:e.idPath,visuFlag:e.checkFlag}])},Ce=function(e){_[e.idPath[0]].types[e.idPath[1]].checkFlag=e.checkFlag;for(var t=[],n=_[e.idPath[0]].types[e.idPath[1]].type,i=0;i<U.length;i++)for(var l=U[i],a=0;a<l.children.length;a++)for(var o=l.children[a],s=0;s<o.children.length;s++)for(var r=o.children[s],c=0;c<r.children.length;c++){var d=r.children[c];if(Y(d)===n)if(re(d)){if(!d.isVisible)continue;d.isVisible=!1,t.push({idPath:[i,a,s,c],visuFlag:!1})}else d.isVisible!==e.checkFlag&&(d.isVisible=e.checkFlag,t.push({idPath:[i,a,s,c],visuFlag:e.checkFlag}))}Z(!1),ke("onAnnotationsVisibilityModified",t)},ve=function(){for(var e=0;e<U.length;e++)for(var t=U[e],n=0;n<t.children.length;n++)for(var i=t.children[n],l=0;l<i.children.length;l++){var a=i.children[l];if("RootViews"!==a.type&&"RootCaptures"!==a.type)for(var o=0;o<a.children.length;o++){var s=a.children[o];z&&!s.isDefaultAnnot?s.hiddenByDefaultFilter=!0:s.hiddenByDefaultFilter=!1,q&&!1===ce(s)?s.hiddenByTolFilter=!0:s.hiddenByTolFilter=!1}}},Se=function(e){q=e.checkFlag,w=e.formulaComponents,ve(),Z(!0),pe({name:N,forceRefresh:!0})},De=function(e){z=e.checkFlag,ve(),Z(!0),pe({name:N,forceRefresh:!0})},we=function(e){j[e.idPath[0]].visuFlag=e.checkFlag,j[e.idPath[0]].checkFlag=e.checkFlag,Z(!1),ke("onAttributesVisibilityModified",[j[e.idPath[0]]])},ke=function(e,t){return O.publish({event:e,data:t,context:this})}}})}),define("DS/CAT3DAnnotationPanels/CAT3DAnnotationThumbnailPanel",["UWA/Core","UWA/Class","DS/CoreEvents/ModelEvents","DS/CAT3DAnnotationBaseUI/CAT3DAnnotationBrowserSection","DS/CATWebUXComponents/CATWebUXThumbnail","UWA/Controls/ThemedScroller","DS/WebappsUtils/WebappsUtils","DS/CATWebUXComponents/CATWebUXSectionHeader","i18n!DS/CAT3DAnnotationPanels/assets/nls/CAT3DAnnotationPanels","css!DS/CAT3DAnnotationPanels/CAT3DAnnotationPanels.css"],function(e,t,n,i,l,a,o,s,r){"use strict";return t.extend({init:function(t){this._parent(t);var c,d,h,u,p=!1,g=[],f=new n,m=function(e,t){return f.publish({event:e,data:t,context:this})},b=function(e){if(!e||4!==e.length)return null;for(var t=0;t<g.length;t++)if(g[t].section.idPath[0]===e[0]&&g[t].section.idPath[1]===e[1])for(var n=0;n<g[t].thumbnails.length;n++)if(g[t].thumbnails[n].idPath[2]===e[2]&&g[t].thumbnails[n].idPath[3]===e[3])return{section:g[t].section,thumbnail:g[t].thumbnails[n]}},y=function(e){h&&h.closeContextualSectionHeader();var t=b(e.data.idPath);t.thumbnail.displayFlag=!0,t.thumbnail.view.getDisplayFlag()||(t.thumbnail.view.setDisplayFlag(!0),t.section.view&&t.section.view.updateShadingColor()),m("onThumbnailSelected",e.data)},A=function(e,t){var n,i,a,o,s,r,c,d=[];for(s=0;s<e.children.length;s++)"RootViews"===e.children[s].type?n=s:"RootCaptures"===e.children[s].type&&(i=s);if(p&&e.children[i].children.length)for(s=0;s<e.children[i].children.length;s++)a=e.children[i].children[s],(o={}).idPath=[t[0],t[1],i,s],o.displayFlag=a.displayFlag,o.type=a.type,o.view=new l({id:"3DAnnotBrowserThumb_"+o.idPath[0]+"_"+o.idPath[1]+"_"+o.idPath[2]+"_"+o.idPath[3],width:208,height:121,data:{idPath:o.idPath,label:a.name,icon:a.icon},displayFlag:o.displayFlag,title:a.name,icon:a.icon,preview:a.preview,clickCB:y,backgroundColor:u}),d.push(o);else if(!p){for(s=0;s<e.children[n].children.length;s++){var h=e.children[n].children[s];if(!h.isSubView){o={};var g=null,f=[t[0],t[1],n,s],m=h.associatedCapture;o.displayFlag=h.displayFlag,o.type=h.type;var b=h.preview;if(m&&m.length){var A=e.children[i].children[m[0]-1];g=A.name,f=[t[0],t[1],i,m[0]-1],o.displayFlag=A.displayFlag,A.preview&&(b=A.preview)}if(o.idPath=f.slice(0,f.length),o.view=new l({id:"3DAnnotBrowserThumb_"+o.idPath[0]+"_"+o.idPath[1]+"_"+o.idPath[2]+"_"+o.idPath[3],width:208,height:121,data:{idPath:o.idPath,label:h.name,icon:h.icon},displayFlag:o.displayFlag,title:h.name,icon:h.icon,subtitle:g,preview:b,clickCB:y,backgroundColor:u}),d.push(o),m.length>1)for(r=1;r<m.length;r++)a=e.children[i].children[m[r]-1],(o={}).displayFlag=a.displayFlag,o.idPath=[t[0],t[1],i,m[r]-1],o.type=a.type,o.view=new l({id:"3DAnnotBrowserThumb_"+o.idPath[0]+"_"+o.idPath[1]+"_"+o.idPath[2]+"_"+o.idPath[3],width:208,height:121,data:{idPath:o.idPath,label:a.name,icon:a.icon},displayFlag:o.displayFlag,title:a.name,icon:a.icon,subtitle:h.name,preview:a.preview,clickCB:y,backgroundColor:u}),d.push(o);if(h.isMultiSectionView)for(r=0;r<h.multiSectionData.views.length;r++){var C=e.children[n].children[h.multiSectionData.views[r]-1];if(C.isSubView){var v=C.associatedCapture;if(v&&(!v||v.length))for(c=0;c<v.length;c++)a=e.children[i].children[v[c]-1],(o={}).displayFlag=a.displayFlag,o.idPath=[t[0],t[1],i,v[c]-1],o.type=a.type,o.view=new l({id:"3DAnnotBrowserThumb_"+o.idPath[0]+"_"+o.idPath[1]+"_"+o.idPath[2]+"_"+o.idPath[3],width:208,height:121,data:{idPath:o.idPath,label:a.name,icon:a.icon},displayFlag:o.displayFlag,title:a.name,icon:a.icon,subtitle:C.name,preview:a.preview,clickCB:y,backgroundColor:u}),d.push(o)}}}}for(s=0;s<e.children[i].children.length;s++)(a=e.children[i].children[s]).pointedView||((o={}).displayFlag=a.displayFlag,o.idPath=[t[0],t[1],i,s],o.type=a.type,o.view=new l({id:"3DAnnotBrowserThumb_"+o.idPath[0]+"_"+o.idPath[1]+"_"+o.idPath[2]+"_"+o.idPath[3],width:208,height:121,data:{idPath:o.idPath,label:a.name,icon:a.icon},displayFlag:o.displayFlag,title:a.name,icon:a.icon,preview:a.preview,clickCB:y,backgroundColor:u}),d.push(o))}return d};this.buildPanel=function(n){this.cleanPanel();var l,p,f=0;for(u=n.backgroundColor,l=0;l<n.length;l++)for(p=0;p<n[l].children.length;p++)n[l].children[p].isVisible&&f++;if(f>0){c||(c=e.createElement("div",{id:"CAT3DAnnotThumbMainDiv"})),c.setStyles({height:"100%"});var b=e.createElement("div",{class:"CAT3DAnnotSectionMainDiv"}).inject(c);b.setStyles({"background-color":"rgba(255, 255, 255, 0)",height:"100%"});var y=o.getWebappsAssetUrl("CAT3DAnnotationPanels","icons/22/")+"I_CAT3DAnnotResetDisplayHistory.png",C=[];t.additionalCmdAvailability&&C.push({type:"button",nls:r.ResetDisplayHistoryLbl,icon:y,cb:function(){m("onDeleteDisplayHistory",{})}}),h=new s({sectionLabel:r.viewBrowserPanelLbl,cmdList:C,doubleClickCB:function(){m("onBrowserPanelResized")}}),b.appendChild(h.getContent());var v,S=e.createElement("div",{class:"CAT3DAnnotThumbMainContainer"}),D=0;for(l=0;l<n.length;l++)for(v=!1,p=0;p<n[l].children.length;p++){var w=n[l].children[p];if(w.isVisible){w.semanticStandards&&(w.semanticStandards.standards.length||w.semanticStandards.defaultSpecs.length)&&(v=!0);var k={id:l,thumbnails:A(w,[l,p]),section:{idPath:[l,p],name:w.referenceLabel+" / "+w.name,icon:w.referenceIcon}};if(k.thumbnails.length){for(var P=0;P<k.thumbnails.length;P++)k.hasInfos=v;g.push(k),D+=k.thumbnails.length}}}if(g.length){var F=function(e){m("onInfoClick",n[e])};for(l=0;l<g.length;l++)g[l].section.view=new i({name:g[l].section.name,icon:g[l].section.icon,children:g[l].thumbnails,id:g[l].id,displayInExpanders:g.length>1,displayInfoButton:g[l].hasInfos,onInfoButtonClick:F}),S.appendChild(g[l].section.view.getContent())}return D?(h.setHeaderLabel(r.viewBrowserPanelLbl+" ("+D+")"),(d=(new a).inject(b)).getInnerElement().setContent(S),d.getContent().setStyle("height","calc(100% - 40px)"),function(){for(var e=[],t=0;t<g.length;t++)for(var n=0;n<g[t].thumbnails.length;n++){var i={idPath:g[t].thumbnails[n].idPath,dataTypes:[]},l=!1;g[t].thumbnails[n].preview||(l=!0,i.dataTypes.push("preview")),!0!==g[t].thumbnails[n].displayFlag&&!1!==g[t].thumbnails[n].displayFlag&&(l=!0,i.dataTypes.push("displayFlag")),l&&e.push(i)}m("onAdditionalInfosRequired",e)}(),c):null}},this.cleanPanel=function(){if(c){for(var e=0;e<g.length;e++){g[e].section.view&&g[e].section.view.clear();for(var t=0;t<g[e].thumbnails.length;t++)g[e].thumbnails[t].view.clear()}for(;c.firstChild;)c.removeChild(c.firstChild);g.splice(0,g.length),h&&h.clear(),d&&d.destroy(),h=null,d=null}},this.setDisplayOnlyCapturesFlag=function(e){p=e},this.getThumbnailsIDPaths=function(){for(var e=[],t=0;t<g.length;t++)for(var n=0;n<g[t].thumbnails.length;n++)e.push(g[t].thumbnails[n].idPath);return e},this.setAdditionalInformations=function(e){for(var t=0;t<e.length;t++){var n=b(e[t].idPath);if(n){for(var i=n.thumbnail,l=Object.keys(e[t].infos),a=!1,o=0;o<l.length;o++)"preview"===l[o]?(i.preview=e[t].infos[l[o]],i.view.setPreview(i.preview)):"displayFlag"===l[o]&&(i.displayFlag=e[t].infos[l[o]],i.view.setDisplayFlag(i.displayFlag,!1),a=!0);a&&n.section.view&&n.section.view.updateShadingColor()}}},this.subscribe=function(e,t){if(e&&t)return f.subscribe({event:e},t)},this.unsubscribe=function(e){null!=e&&f.unsubscribe(e)}}})}),define("DS/CAT3DAnnotationPanels/CAT3DAnnotationAttrListTable",["UWA/Core","UWA/Class","DS/Controls/ComboBox","DS/CoreEvents/ModelEvents","DS/WebappsUtils/WebappsUtils","DS/Utilities/TouchUtils","DS/DataGridView/DataGridView","DS/Tree/TreeDocument","DS/CAT3DAnnotationBaseUI/CAT3DAnnotAttrBrowserListItem","i18n!DS/CAT3DAnnotationPanels/assets/nls/CAT3DAnnotationPanels","css!DS/CAT3DAnnotationPanels/CAT3DAnnotationPanels.css"],function(e,t,n,i,l,a,o,s,r,c){"use strict";return t.extend({init:function(t){var d;this._parent(t);var h,u,p,g,f,m,b,y,A,C,v,S,D,w=[],k=null,P=null,F=!1,T=!1,I=!1,V=!1,x=t&&t.fromWebInWin,E=new i,M=this,R={},L=!1,N=["hiddenText","failureModes","navReq","relatedDocs","urls","text"],B=[],O=[],U=[],_=[],j={},W=l.getWebappsAssetUrl("CAT3DAnnotationRsc","icons/22/"),H={4:W+"I_W3DAnnot_VeryHighFailureMode.png",3:W+"I_W3DAnnot_HighFailureMode.png",2:W+"I_W3DAnnot_MediumFailureMode.png",1:W+"I_W3DAnnot_LowFailureMode.png",0:W+"I_W3DAnnot_LeastImportantFailureMode.png"};const z="wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-presentation-slide",q="wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-plus";function G(e,t){E&&(t.discipline=p,E.publish({event:e,data:t,context:M}))}function J(t,n){var i=e.createElement("a"===t&&x?"p":t,{class:"CAT3DAnnotSemAttrText CAT3DAnnotSemAttrUrl"});return i.setStyles({"line-height":a.getTouchMode()?"38px":"24px"}),"a"!==t||x||i.setAttributes({href:n.url}),void 0!==n.title&&""!==n.title?(i.innerHTML=n.title,i.setAttributes({title:n.url})):i.innerHTML=n.url,i.addEventListener("mouseenter",function(){this.setStyles({color:"rgb(130, 190, 220)",cursor:"pointer"})}),i.addEventListener("mouseleave",function(){this.setStyles({color:"#368ec4",cursor:""})}),i.setStyles({color:"rgb(0, 120, 175)"}),("a"!==t||x)&&(i.linkedData=n,n.discipline=p,i.addEventListener("click",function(){G("onAttributeClicked",n)})),i}function X(e){if(!e)return 0;document.body.appendChild(e);var t=e.getStyle("position");e.setStyle("position","absolute");var n=e.offsetHeight;return e.setStyle("position",t),document.body.removeChild(e),n}function K(e){if(e&&e.length){for(var t,n=[],i=0;i<e.length;i++)n[(t=e[i]).crit]?n[t.crit].descriptions=n[t.crit].descriptions.concat(t.descriptions):n[t.crit]={crit:t.crit,descriptions:t.descriptions.slice()};return n}}function Y(t,n){if(t&&t.length){var i,l=new e.Element("div");l.setStyles({"padding-left":a.getTouchMode()?"14px":"7px"});var o="string"==typeof t?t:Array.isArray(t)&&1===t.length&&"string"==typeof t[0]?t[0]:null;if("urls"===n)for(i=0;i<t.length;i++)J("a",t[i]).inject(l);else if(o){var s=e.createElement("p",{class:"CAT3DAnnotSemAttrText"}).inject(l);s.setStyles({"line-height":a.getTouchMode()?"38px":"24px"}),s.innerText=o}else if(Array.isArray(t)){var r;for(i=0;i<t.length;i++)t[i].phyID?J("p",{title:t[i].displayLabel?t[i].displayLabel:t[i].label,url:t[i].label,phyID:t[i].phyID,type:t[i].type,phyType:t[i].phyType}).inject(l):"string"==typeof t[i]&&((r=e.createElement("p",{class:"CAT3DAnnotSemAttrText"}).inject(l)).innerText=t[i],r.setStyles({"line-height":a.getTouchMode()?"38px":"24px"}))}return l}}function Z(t){var n=e.createElement("div",{class:"CAT3DAnnotSemFailureDiv"});e.createElement("div",{class:"CAT3DAnnotSemFailureImgDiv"}).inject(n).setStyle("background-image","url("+H[t.crit]+")");var i=e.createElement("div",{class:"CAT3DAnnotSemFailureTextDiv"}).inject(n),l=e.createElement("p",{class:"CAT3DAnnotSemFailureTextBoldDiv"}).inject(i);l.innerHTML=c.FailureModes[t.crit];for(var a=0;a<t.descriptions.length;a++)(l=e.createElement("p",{class:"CAT3DAnnotSemFailureTextValueDiv"}).inject(i)).innerHTML=t.descriptions[a];var o=X(n);return n.setStyle("height",o+"px"),n}function Q(t){if(t&&t.length){var n=K(t),i=new e.Element("div");if(n&&n.length)for(var l=0;l<n.length;l++)n[l]&&Z(n[l]).inject(i);return i}}function $(){for(var e=0;e<w.length;e++){w[e].section&&w[e].section.clear();for(var t=0;t<w[e].elements.length;t++)w[e].elements[t].clear()}if(w.splice(0,w.length),d&&d.destroy(),u)for(;u.firstChild;)u.removeChild(u.firstChild);k&&k.removeRoots(),k=null,F=!1,T=!1,B=[],O=[],U=[],_=[],j={},L=!1,h=null,C=v=S=null}function ee(){var e,t,n=[],i=function(e){if(e.getIDPath()&&e.getActiveState()&&n.push({idPath:e.getIDPath(),activeState:e.getActiveState()}),e.getChildren()&&e.getChildren().length)for(var t=0;t<e.getChildren().length;t++)i(e.getChildren()[t])};for(e=0;e<w.length;e++)for(w[e].section&&w[e].section.getActiveState()&&n.push({idPath:w[e].section.getIDPath(),activeState:w[e].section.getActiveState()}),t=0;t<w[e].elements.length;t++)i(w[e].elements[t]);return n}function te(){C&&(S.src=j[h&&h.length?C.value:D],S.setStyle("display",h&&h.length?"none":""),v.setStyles({display:h&&h.length?"none":""}),C.elements.container.setStyles({opacity:h&&h.length?"1":"0","pointer-events":h&&h.length?"":"none"}))}function ne(e,t){var n;if(t.getIDPath()&&t.getIDPath().equals(e))n=t;else if(t.getChildren()&&t.getChildren().length)for(var i=0;i<t.getChildren().length&&!(n=ne(e,t.getChildren()[i]));i++);return n}function ie(e){if(e&&(!e||e.length)){for(var t,n=0;n<w.length;n++)if(w[n].section&&"-1"!==w[n].section.getIDPath()[0]&&w[n].section.getIDPath()[0]===e[0]&&w[n].section.getIDPath()[1]===e[1]||"-1"===w[n].section.getIDPath()[0])for(var i=0;i<w[n].elements.length;i++)if(t=ne(e,w[n].elements[i]))return{section:w[n].section,item:t};return t}}function le(e){d&&p&&d.layout.setColumnVisibleFlag("associatedComments",g||e,{isUserInteraction:!0})}function ae(e,t){if(e.uuid===t)return e;if(e.children&&e.children.length)for(var n,i=0;i<e.children.length;i++)if(n=ae(e.children[i],t))return n}function oe(e){var t;if(e&&47===e.attrType&&14===e.attrSubtype){var n,i,l;t={orientations:[],colors:[]};for(var a=0;a<e.attributes.length;a++)i=(n=e.attributes[a]).colID,l=n.value,"Direction"===i?t.orientations.push(l):"DirRed"===i?t.colors.push({r:parseFloat(l)}):"DirGreen"===i?t.colors[t.colors.length-1].g=parseFloat(l):"DirBlue"===i&&(t.colors[t.colors.length-1].b=parseFloat(l))}return t}function se(e,t,n){if("Direction"===e&&n.pointedUuids&&n.pointedUuids.length&&47===n.attrType&&4===n.attrSubtype){var i,l=[];n.pointedUuids.forEach(function(e){l=l.concat(e.uuids)});for(var a=0;a<l.length;a++){for(var o=0;o<P.length;o++){for(var s=0;s<P[o].elements.length&&!(i=ae(P[o].elements[s],l[a]));s++);if(i)break}if(i&&47===i.attrType&&14===i.attrSubtype)for(var r=oe(i),c=0;c<r.orientations.length;c++)if(Array.isArray(t)){for(var d=0;d<t.length;d++)if(-1!==r.orientations[c].indexOf(t[d]))return r.colors[c]}else if(-1!==r.orientations[c].indexOf(t))return r.colors[c]}}}function re(e){var t=e.attrSubtype?parseFloat(e.attrSubtype):-1;if("6"===p&&(4===t||5===t||6===t)){var n=!1;return _.some(function(t){if(t.type===e.attrSubtype)return n=!0,!0}),n||(_.push({type:e.attrSubtype,icon:e.icon,state:!1}),j[e.attrSubtype]=e.icon),!0}return!1}var ce;function de(e){e.getIDPath()&&(V=!1,ce&&clearTimeout(ce),ce=setTimeout(function(){ce=0,h=ee(),G("display"===f?"onAttrDisplayStateModified":"onAttrActiveStateModified",{currentSelection:h,isContextMenuRequested:V}),te()}))}function he(e,t){var n,i;if(e.isAStructuralItem){if(e.children&&e.children.length)for(i=0;i<e.children.length;i++)he(e.children[i],t)}else{var l,a,o=!e.uuid&&!e.pickParent||e.hidden||re(e);if(e.children&&e.children.length)for(n=[],i=0;i<e.children.length;i++)he(e.children[i],n);if(!o){if(e.attributes&&e.attributes.length){var s=e.attributes,c=[];for(i=0;i<s.length;i++)if(s[i].hidden)c.push(i);else if(-1===O.indexOf(s[i].colID)&&(B.push(s[i].title),O.push(s[i].colID)),-1===N.indexOf(s[i].colID)&&Array.isArray(s[i].value)&&N.push(s[i].colID),47===e.attrType&&4===e.attrSubtype){var d=e.originalColID&&"ParamName"===s[i].colID&&s[i+1]?s[i+1].value:s[i].value;(a=se(e.originalColID?e.originalColID:s[i].colID,d,e))&&(l={colID:e.originalColID&&"ParamName"===s[i].colID&&s[i+1]?s[i+1].colID:s[i].colID,color:a},F=!0)}for(i=c.length-1;i>=0;i--)e.attributes.splice(c[i],1)}e.type&&(T=!0)}t.push(new r({idPath:e.idPath,name:e.name,uuid:e.uuid,displayFlag:e.displayFlag,activeState:e.activeState,icon:e.icon,color:l,attributes:e.attributes,originalColID:e.originalColID,pickParent:e.pickParent,type:e.type,createTreeModelNode:!0,children:n,callback:de,onDisplayHistoryFlagChangeCB:function(e){G("onAttrDisplayFlagModified",{idPath:e.getIDPath(),flag:e.getDisplayFlag(),discipline:p})}})),(!e.uuid&&!e.pickParent||e.hidden||re(e))&&t[t.length-1].getContent().hide()}}function ue(e){if(d&&e.nodeModel){var t=e.nodeModel.getBackgroundColorDefinition?e.nodeModel.getBackgroundColorDefinition(d.columns[e.columnID].dataIndex):null,n="";t&&(n="rgb("+t.r+","+t.g+","+t.b+")"),e.cellView.elements.container.setStyles({backgroundColor:n})}}function pe(e){var t;if(e.children&&e.children.length)for(t=0;t<e.children.length;t++)pe(e.children[t]);if(!e.isAStructuralItem&&e.attributes){var n=e.attributes,i=[];for(t=n.length-1;t>=0;t--)n[t].hidden||(L=L||-1!==N.indexOf(n[t].colID),i.unshift({pickParent:!0,name:e.name,type:e.type,attrType:e.attrType,attrSubtype:e.attrSubtype,pointedUuids:e.pointedUuids,activeState:e.activeState,displayFlag:e.displayFlag,originalColID:n[t].colID,attributes:[{colID:"ParamName",title:c.paramNameLbl,value:n[t].title},{colID:"ParamValue",title:c.paramValueLbl,value:n[t].value}]}),e.attributes.splice(t,1));e.children||(e.children=[]),e.children=i.concat(e.children)}}function ge(e){if(d){for(var t=d.reuseCellContent("CAT3DAnnotationAttributesReusableCell");t.firstChild;)t.removeChild(t.firstChild);var n=d.columns[e.columnID].dataIndex,i=e.nodeModel.options.grid[n];"rows"===m&&(n=e.nodeModel.originalColID);var l="failureModes"===n?Q(i):Y(i,n);l&&l.inject(t),e.cellView._setReusableContent(t)}}function fe(e){if(d&&e.nodeModel){var t=d.columns[e.columnID].dataIndex,n="";if("tree"===t){n+=e.nodeModel.options.label;for(var i=e.nodeModel.getParentAttrItem();i&&i.getContent()&&i.getContent().options&&i.getContent().options.label;)i.doNotExport()||(n=i.getContent().options.label+"|"+n),i=i.getContent().getParentAttrItem()}else{var l=e.nodeModel.options.grid[t];"rows"===m&&(t=e.nodeModel.originalColID),n="failureModes"===t?function(e){if(e&&e.length){var t=K(e),n="",i=0;if(t&&t.length)for(var l=0;l<t.length;l++)t[l]&&(++i>1&&(n+=";"),n+=c.FailureModes[t[l].crit]+":"+t[l].descriptions);return n}}(l):function(e,t){if(e&&e.length){var n,i="",l="string"==typeof e?e:Array.isArray(e)&&1===e.length&&"string"==typeof e[0]?e[0]:null;if("urls"===t)for(n=0;n<e.length;n++)n>0&&(i+=","),i+=e[n].url?e[n].url:e[n];else if(l)i=l;else if(Array.isArray(e))for(n=0;n<e.length;n++)n>0&&(i+=","),l?i+=e[n]:e[n].phyID&&(i+=(e[n].displayLabel?e[n].displayLabel+":":e[n].label+":")+e[n].phyID);return i}}(l,t)}return n}}function me(t){var i,h;if($(),t.model&&t.model.length){p=t.discipline,k=new s({useAsyncPreExpand:!1,shouldAcceptDrag:function(){return!1},shouldAcceptDrop:function(){return!1}}),P=t.model;var E=JSON.parse(JSON.stringify(t.model));m=t.attributeDisplayCurrentState?t.attributeDisplayCurrentState:"columns",f=t.discipline&&t.rowSelectionCurrentState?t.rowSelectionCurrentState:"highlight",b=t.discipline&&t.columnSortCurrentState?t.columnSortCurrentState:"disabled",y=t.allowExport,A=t.representationMode&&t.representationMode.slice?t.representationMode.slice():[],B=[],O=[],U=[{text:c.titleCol,dataIndex:"tree",isEditable:!1,getCellValueForExport:fe}],_=[],j={},N=["hiddenText","failureModes","navReq","relatedDocs","urls","text"],L=!1,D=t.multiRepDefaultMode;var M=E;if("rows"===m)for(M=M.slice(),i=0;i<M.length;i++)for(h=0;h<M[i].elements.length;h++)pe(M[i].elements[h]);var W,H,J,K=[];if(p)for(i=0;i<M.length;i++){for(K=[],h=0;h<M[i].elements.length;h++)he(M[i].elements[h],K);if(W=new r({idPath:M[i].section.idPath,name:M[i].section.name,icon:M[i].section.icon,children:K,createTreeModelNode:M.length>1,callback:de,isRootNode:!0}),w.push({section:W,elements:K}),M.length>1){for(h=0;h<K.length;h++)K[h].setRootParentNode(W);k.addRoot(W.getContent())}else for(h=0;h<K.length;h++)K[h].setRootParentNode(W),k.addRoot(K[h].getContent());W.initialize()}else{for(W=new r({idPath:["-1"],name:"RootAttributes",children:K,createTreeModelNode:!1,isRootNode:!0}),i=0;i<M.length;i++)for(h=0;h<M[i].elements.length;h++)he(M[i].elements[h],K);for(h=0;h<K.length;h++)K[h].setRootParentNode(W),k.addRoot(K[h].getContent());w.push({section:W,elements:K})}if(_&&_.length&&t.representationMode&&t.representationMode.length)t.representationMode.forEach(function(e){for(var t=0;t<_.length;t++)e.type===_[t].type&&(_[t].state=e.state,e.state&&(J=e.type))}),H=e.createElement("div",{class:"CAT3DAnnotAttributesListMultiRepCont"}).inject(u),a.getTouchMode()&&H.setStyles({padding:0}),(S=e.createElement("img",{class:"CAT3DAnnotAttributesListMultiRepItem"}).inject(H)).src=j[D],(v=e.createElement("p",{class:"CAT3DAnnotAttributesListMultiRepItem"}).inject(H)).innerText=c["MultiReps_"+p+"_"+D],(C=new n({enableSearchFlag:!1,elementsList:_.map(function(e){return{labelItem:c["MultiReps_"+p+"_"+e.type],iconItem:j[e.type],valueItem:e.type}}),value:J}).inject(H)).elements.container.setStyles({width:"200px"}),C.addEventListener("change",function(){for(i=0;i<_.length;i++)_[i].state=_[i].type===C.value,4===_[i].type&&4===C.value&&(_[i].isolateElts=!0);te(),G("onSwitchMultiRepDisplayMode",{discipline:p,state:_.slice()})}),H.setStyle("min-width","600px"),te();if(function(){var e,t;if(p&&U.push({dataIndex:"associatedComments",icon:z,autoRowHeightFlag:!0,editableFlag:!1,getCellClassName:function(e){if(e.nodeModel&&e.nodeModel.featureUuid)return R[e.nodeModel.featureUuid]?"CAT3DAnnotAttrBrowserTreeListViewIcon":g?"CAT3DAnnotAttrBrowserTreeListViewIconLight"+(a.getTouchMode()?"Touch":""):void 0},getCellValue:function(e){if(e.nodeModel&&e.nodeModel.featureUuid)return R[e.nodeModel.featureUuid]?{icon:z,label:R[e.nodeModel.featureUuid]}:g?{icon:q}:void 0},getCellTypeRepresentation:function(e){if(-1!==e.rowID)return"url"},compareFunction:function(e,t){return e||t?e?t?e===t?0:e<t?-1:1:1:-1:0},pinned:"left",visibleFlag:!0,width:"40"}),!p||"3DAnnotations"===p){var n,i=[],l=[],o=["hiddenText","failureModes","navReq","relatedDocs","urls"];for(e=0;e<o.length;e++)-1!==(n=O.indexOf(o[e]))&&(i.push(O[n]),l.push(B[n]),O.splice(n,1),B.splice(n,1));O=i.concat(O),B=l.concat(B)}for(e=0;e<B.length;e++)t={text:B[e],dataIndex:O[e],isEditable:!1,autoRowHeightFlag:!0},(-1!==N.indexOf(O[e])||"rows"===m&&"ParamValue"===O[e]&&L)&&(L=!0,t.onCellRequest=ge,t.getCellValueForExport=fe),F&&(t.getCellClassName=ue),U.push(t);T&&("columns"===m?U.splice(p?2:1,0,{text:c.typeCol,dataIndex:"type",isEditable:!1}):U.push({text:c.typeCol,dataIndex:"type",isEditable:!1}))}(),(d=new o({identifier:"CAT3DAnnotationAttributesList"+p,treeDocument:k,defaultColumnDef:{width:"auto",sortableFlag:"enabled"===b},columns:U,rowSelection:"multiple",cellSelection:{defaultValue:"none"},rowDragEnabledFlag:!1,allowUnsafeHTMLContent:!1,cellDragEnabledFlag:!1,showNodeKPIColorFlag:!0,activateAllCellsRenderedEventFlag:!0,showRowBorderFlag:!0,placeholder:"",recId:"A3IAttrList"+p,onContextualEvent:function(e){return V=!0,function(e){if(!d)return;var t=[],n=e.cellInfos;if(e&&e.collectionView&&n){if(-1===n.columnID)return t;if(-1===n.rowID){var i=d.layout.getDataIndexFromColumnIndex(n.columnID);"tree"===i&&(i="label");let a="stringRegexp";"type"===i?a="set":"associatedComments"===i&&(a="number"),k.getFilterManager().setPropertyFilterModel(i,{filterId:a}),t=e.collectionView.buildDefaultContextualMenu(e,{pin:!0,firstColumnsVisibility:!1,columnsManagement:!0,sizeColumnToFit:!0}),x&&(t[t.length-1]={type:"PushItem",title:c.customViews,action:{callback:function(){G("onCustomViewsPanelDisplayed",{collectionView:e.collectionView})}}}),t.push({type:"SeparatorItem",title:""}),t.push({type:"PushItem",title:c.expandAllLabel,icon:l.getWebappsAssetUrl("CAT3DAnnotationPanels","icons/22/")+"I_CAT3DAnnotExpandAllRows.png",action:{callback:function(){d&&w.forEach(function(e){e.section.getContent()?e.section.getContent().expandAll():e.elements.forEach(function(e){e.getContent().expandAll()})})}}}),t.push({type:"PushItem",title:c.collapseAllLabel,icon:l.getWebappsAssetUrl("CAT3DAnnotationPanels","icons/22/")+"I_CAT3DAnnotCollapseAllRows.png",action:{callback:function(){d&&w.forEach(function(e){e.section.getContent()?e.section.getContent().collapseAll():e.elements.forEach(function(e){e.getContent().collapseAll()})})}}}),t.push({type:"SeparatorItem",title:""}),t.push({type:"PushItem",title:c.hideColumnLabel,action:{callback:function(){d&&d.layout.setColumnVisibleFlag(d.layout.getDataIndexFromColumnIndex(n.columnID),!1,{isUserInteraction:!0})}}}),t.push({type:"CheckItem",title:c.enableSortingLabel,state:"enabled"===b?"selected":"unselected",action:{callback:function(){b="enabled"===b?"disabled":"enabled",d.defaultColumnDef.sortableFlag="enabled"===b,G("onSwitchEnableColumnSort",{discipline:p,state:b})}}}),p&&t.push({type:"PushItem",title:c.SwitchRowSelectionLbl,submenu:[{type:"RadioItem",title:c.HighlightSelectedRowsLbl,state:"highlight"===f?"selected":"unselected",action:{callback:function(){G("onSwitchRowSelectionMode",{discipline:p,state:f="highlight"})}}},{type:"RadioItem",title:c.DisplaySelectedRowsLbl,state:"display"===f?"selected":"unselected",action:{callback:function(){G("onSwitchRowSelectionMode",{discipline:p,state:f="display"})}}}]}),t.push({type:"PushItem",title:c.AttributeDisplayLbl,submenu:[{type:"RadioItem",title:c.AttributeDisplayInColumnsLbl,state:"columns"===m?"selected":"unselected",action:{callback:function(){m="columns",be(),G("onSwitchAttributeDisplayMode",{discipline:p,state:m})}}},{type:"RadioItem",title:c.AttributeDisplayInRowsLbl,state:"rows"===m?"selected":"unselected",action:{callback:function(){m="rows",be(),G("onSwitchAttributeDisplayMode",{discipline:p,state:m})}}}]}),t.push({type:"PushItem",title:c.AttrResetDisplayHistoryLbl,icon:l.getWebappsAssetUrl("CAT3DAnnotationPanels","icons/22/")+"I_CAT3DAnnotResetDisplayHistory.png",action:{callback:function(){var e=function(t){if(t.getIDPath()&&t.getActiveState()&&t.setDisplayFlag(!0),t.getChildren()&&t.getChildren().length)for(var n=0;n<t.getChildren().length;n++)e(t.getChildren()[n])};w.forEach(function(t){t.section.resetDisplayHistory();for(var n=0;n<t.elements.length;n++)e(t.elements[n])}),G("onDeleteDisplayHistory",{discipline:p})}}})}else{I&&t.push({type:"PushItem",title:c.ReframeOnLabel,icon:l.getWebappsAssetUrl("CAT3DAnnotSemanticCmds","icons/32/")+"I_CAT3DAnnotReframeOn.png",action:{callback:function(){G("onReframeOn",{discipline:p})}}});var a=d.model[n.rowID];a&&a.hasChildren()&&(t.push({type:"PushItem",title:c.expandLabel,icon:l.getWebappsAssetUrl("CAT3DAnnotationPanels","icons/22/")+"I_CAT3DAnnotExpandAllRows.png",action:{callback:function(){a.expandAll()}}}),t.push({type:"PushItem",title:c.collapseLabel,icon:l.getWebappsAssetUrl("CAT3DAnnotationPanels","icons/22/")+"I_CAT3DAnnotCollapseAllRows.png",action:{callback:function(){a.collapseAll()}}})),p&&y&&t.push({type:"PushItem",title:c.technoAttrExportToCSV,callback:function(){},submenu:[{title:c.technoAttrAllVisible,type:"RadioItem",action:{callback:function(){G("onExportToCSVRequired",{discipline:p,onlySelectedRows:!1})}}},{title:c.technoAttrSelected,type:"RadioItem",action:{callback:function(){G("onExportToCSVRequired",{discipline:p,onlySelectedRows:!0})}}}]})}}return t}(e)},onDragStartColumnHeader:t.onDragStartColumnHeader,onDragOverColumnHeader:function(e){return e.stopPropagation(),e.preventDefault(),!0},onDragEndColumnHeader:t.onDragEndColumnHeader})).getContent().addClassName(t.className?t.className:"CAT3DAnnotAttrBrowserTreeListView"),H){d.getContent().setStyles({top:"45px",height:"calc(100% - 45px)"})}d.inject(u),d&&(L&&(d.registerReusableCellContent({id:"CAT3DAnnotationAttributesReusableCell",buildContent:function(){return new e.Element("div")}}),d.layout.getRowHeightFunction=function(e){var t=d.layout.cellHeight,n=d.model[e];if(!n)return t;if(n.customRowHeight)t=n.customRowHeight;else{var i=function(e,n,i){t=Math.max(X(n(e,i)),t)};if("columns"===m)N.forEach(function(e){"failureModes"===e&&n.options.grid.failureModes&&n.options.grid.failureModes.length?i(n.options.grid.failureModes,Q):n.options.grid[e]&&i(n.options.grid[e],Y,e)});else{var l="failureModes"===n.originalColID;i(n.options.grid.ParamValue,l?Q:Y,l?void 0:n.originalColID)}n.customRowHeight=t}return t}),p&&le(0!==Object.keys(R).length),d.addEventListener("DSpointerhit",function(e,t){var n=t&&t.columnID>=0?d.columns[t.columnID].dataIndex:null;p&&"associatedComments"===n&&t.nodeModel&&t.nodeModel.featureUuid&&(R[t.nodeModel.featureUuid]||g)&&setTimeout(function(){G("onCommentClicked",{idPath:t.nodeModel.getIDPath()})}),G("onDSpointerhit",{colIdx:n})}))}}function be(){$(),me({model:P,allowExport:y,representationMode:A,multiRepDefaultMode:D,discipline:p,rowSelectionCurrentState:f,columnSortCurrentState:b,attributeDisplayCurrentState:m})}this.getDiscipline=function(){return p},this.exportAsCSV=function(e){if("rows"===m&&(e.canNodeModelBeExported=function(e){return!e.doNotExport()}),d)return d.getAsCSV(e)},this.buildPanel=function(t){return M.cleanPanel(),u=e.createElement("div",{id:"CAT3DAnnotAttrBrowserMainDiv"}),me(t),u},this.cleanPanel=function(){$(),d=u=f=b=m=y=null},this.destroy=function(){M.cleanPanel(),E=M=null},this.subscribe=function(e,t){if(e&&t)return"onReframeOn"===e&&(I=!0),E.subscribe({event:e},t)},this.unsubscribe=function(e){null!=e&&E.unsubscribe(e)},this.setAdditionalInformations=function(e){var t,n,i=!1;for(t=0;t<e.length;t++){var l=ie(e[t].idPath);if(l){var a=Object.keys(e[t].infos);for(n=0;n<a.length;n++)"activeState"===a[n]&&e[t].infos[a[n]]!==l.item.getActiveState()?(i=!0,l.item.setActiveState(e[t].infos[a[n]]),e[t].infos[a[n]]&&(l.item.expandOrCollapse(!0),d.ensureNodeModelVisible(l.item.getContent(),!1))):"displayFlag"===a[n]&&e[t].infos[a[n]]!==l.item.getDisplayFlag()&&l.item.setDisplayFlag(e[t].infos[a[n]])}}i&&(h=ee(),te())},this.getDisplayedIDPaths=function(e){for(var t=[],n=function(i){if((!e||e&&i.getActiveState())&&t.push(i.getIDPath()),i.getChildren()&&i.getChildren().length)for(var l=0;l<i.getChildren().length;l++)n(i.getChildren()[l])},i=0;i<w.length;i++)for(var l=0;l<w[i].elements.length;l++)n(w[i].elements[l]);return t},this.forceCommentColumnVisibilityFlag=(e=>{g!==e&&(g=e,le(0!==Object.keys(R).length))}),this.setCommentInformation=function(e){if(R={},e){for(var t,n=Object.keys(e),i=0;i<n.length;i++){t=null;for(var l=0;l<P.length;l++){for(var a=0;a<P[l].elements.length;a++)if(t=ae(P[l].elements[a],n[i])){R[n[i]]=e[n[i]];break}if(t)break}}le(0!==Object.keys(R).length),k.withTransactionUpdate(function(){k.getAllDescendants().forEach(function(e){e.featureUuid&&R[e.featureUuid]&&(e.nbAssociatedComments=R[e.featureUuid],e.updateOptions())})})}},this.setRowSelectionMode=function(e){p&&(f=e)},this.setMultiRepOption=function(e){e&&C&&(e.forEach(function(e){for(var t=0;t<_.length;t++)e.type===_[t].type&&(_[t].state=e.state,e.state&&(C.value=e.type))}),te())}}})}),define("DS/CAT3DAnnotationPanels/CAT3DAnnotationPanels",[],function(){}),define("DS/CAT3DAnnotationPanels/CAT3DAnnotationPliesAndLayersPanel",["UWA/Core","UWA/Class","DS/Selection/HSOManager","DS/Visualization/ThreeJS_DS","DS/Visualization/Node3D","DS/CoreEvents/ModelEvents","DS/Visualization/SceneGraphFactory","DS/SceneGraphNodes/BillBoardNode3D","DS/Controls/Expander","DS/Visualization/PathElement","DS/Visualization/WebGLViewer","DS/Visualization/Viewpoint","DS/CAT3DAnnotationPanels/CAT3DAnnotationAttrListTable","i18n!DS/CAT3DAnnotationPanels/assets/nls/CAT3DAnnotationPanels","css!DS/CAT3DAnnotationPanels/CAT3DAnnotationPanels.css"],function(e,t,n,i,l,a,o,s,r,c,d,h,u,p){"use strict";return t.extend({init:function(t){this._parent(t,{});var g,f,m,b,y,A,C,v,S=this,D={},w=new a,k=["#fee000","#009ddb","#ff8a2e","#9b2c98","#00aa86","#f564a3","#8ddee4","#cc092f","#e2d5cc","#6fbc4b","#70036b","#002596","#c6c68b","#7f7f7f","#4ea8b7","#007a4c","#adadad","#127277","#6d2815","#4d62ba"];function P(t,n){if(t){var i=new e.Element("p",{class:"CAT3DAnnotRelatedAttrTxt"}).inject(m);n&&i.setStyles({"font-weight":"bold",color:"rgb(54,142,196)"}),i.innerText=t}}function F(){var e=[];n.get().forEach(function(t){t.pathElement&&t.pathElement.externalPath[0]===C&&e.push({pathElement:t.pathElement.clone()})}),e.length&&n.remove(e),D.onAdd&&n.unsubscribe(D.onAdd),D.onRemove&&n.unsubscribe(D.onRemove),D.onEmpty&&n.unsubscribe(D.onEmpty),D={}}function T(e,t){return w.publish({event:e,data:t,context:this})}this.build=function(t){if(S.clean(),b=new e.Element("div",{class:"CAT3DAnnotRelatedAttrMainDiv"}),!t||!t.plies||!t.plies.length)return b;y=new e.Element("div",{class:"CAT3DAnnotRelatedAttrCanvasDiv"}).inject(b),(g=new d({div:y,multiViewer:!0,svgMode:!1,backgroundColor:new i.Color({r:.92,g:.92,b:.92})})).setPicking({activated:!0}),g.setPrePicking({activated:!0}),g.setVisuEnvOCA("Basic"),g.setVisuShadingMode("ShadingMaterialEdges"),g.setAntiAliasing("MSAA"),(f=new h({viewer:g})).onMove(g.render),f.setProjectionType(1),g.addViewpoint(f),f.setDefaultController(!0,"CATIA"),C=new l("CSViewerMainNode"),g.addNode(C),m=new e.Element("div",{class:"CAT3DAnnotRelatedAttrInfo"}).inject(b),A=new e.Element("div",{class:"CAT3DAnnotRelatedAttrTableDiv"}).inject(b);var a=0,w=0,I=[];t.plies.forEach(function(e){a=a?Math.min(e.curedThickness,a):e.curedThickness,e.color=k[w%k.length],w++,I.push(e.attrModel)}),t.rosettesAttrModel&&(I=I.concat(t.rosettesAttrModel));for(var V,x,E=0,M=function(e,n){var r=new l(e.name);if(C.addChild(r),e.pathElement=new c([C,r]),e.curedThickness){var d=e.curedThickness/a,h=i.MaterialUtils.createMatteFaceMaterial({color:new i.Color(e.color),force:!0});h.line=new i.LineBasicMaterial({color:new i.Color("#000000"),force:!0});var u=o.createCuboidNode({cornerPoint:new i.Vector3(0,0,0),firstAxis:new i.Vector3(2*t.plies.length,0,0),secondAxis:new i.Vector3(0,4*n,0),thirdAxis:new i.Vector3(0,0,d),fill:!0,noEdge:!0,material:h});u.setPickParent(!0),r.addChild(u);var g=o.createCuboidNode({cornerPoint:new i.Vector3(0,0,0),firstAxis:new i.Vector3(2*t.plies.length,0,0),secondAxis:new i.Vector3(0,4*n,0),thirdAxis:new i.Vector3(0,0,d),fill:!1,noEdge:!1,material:h});if(g.setPickParent(!0),r.addChild(g),void 0!==e.direction){var f=function(e,t,n){var a,s=new l,r=n/5,c=Math.floor(t/r)+1,d=function(e){if(e&&e.length){var t=o.createLineNode({points:e,color:new i.Color("#000000")});t.setPickParent(!0),s.addChild(t)}};if(0===e||e===Math.PI)for(a=0;a<5;a++)d([new i.Vector3(0,a*r,0),new i.Vector3(t,a*r,0)]);else if(e===Math.PI/2||e===-Math.PI/2)for(a=0;a<c;a++)d([new i.Vector3(a*r,0,0),new i.Vector3(a*r,n,0)]);else{var h=e<0?Math.PI+e:e,u=h>Math.PI/2;for(a=0;a<5;a++)d(u?[new i.Vector3((n-a*r+Math.tan(h)*t)/Math.tan(h),n,0),new i.Vector3(t,a*r,0)]:[new i.Vector3(0,a*r,0),new i.Vector3((n-a*r)/Math.tan(h),n,0)]);for(r=Math.abs(r/Math.tan(h)),c=Math.floor(t/r)+1,a=0;a<c;a++){var p=u?t-a*r:a*r,g=n/Math.tan(h)+p,f=n;g<0?(g=0,f=-p*Math.tan(h)):g>t&&(g=t,f=(t-p)*Math.tan(h)),d([new i.Vector3(p,0,0),new i.Vector3(g,f,0)])}}return s.setPickParent(!0),s}(e.direction,2*t.plies.length,4);f.setPickParent(!0),f.setMatrix((new i.Matrix4).setPosition(new i.Vector3(0,4*n-4,d))),r.addChild(f)}var m=o.createTextNode({text:e.name,font:"sans-serif",fontSize:.8,sdf:!0,color:new i.Color("#000000"),side:i.DoubleSide});m.setPickParent(!0),m.setNoZ(!0);var b=m.getBoundingBox("visibleSpace"),y=(b.max.x,b.min.x),A=b.max.y-b.min.y,v=new s({type:"Spherical"});v.addChild(m),v.setMatrix((new i.Matrix4).setPosition(new i.Vector3(0,4*n+.5,(d-A)/2))),v.setPickParent(!0),r.addChild(v),(m=o.createTextNode({text:p.thicknessLbl+e.curedThicknessNls+t.thicknessUnit,font:"sans-serif",fontSize:.8,sdf:!0,color:new i.Color("#cc092f"),side:i.DoubleSide})).setPickParent(!0),m.setNoZ(!0),y=(b=m.getBoundingBox("visibleSpace")).max.x-b.min.x,A=b.max.y-b.min.y,m.setMatrix((new i.Matrix4).setPosition(new i.Vector3(-y-.2,0,0))),(v=new s({type:"Spherical"})).addChild(m),v.setMatrix((new i.Matrix4).setPosition(new i.Vector3(2*t.plies.length,0,(d-A)/2))),v.setPickParent(!0),r.addChild(v),r.setMatrix((new i.Matrix4).makeTranslation(0,0,E)),E+=d}},R=function(){var e,i=n.get(),l=[],a=[];for(e=0;e<i.length;e++)if(i[e].pathElement.externalPath[0]===C)for(var o=0;o<t.plies.length;o++)t.plies[o].pathElement.isEqual(i[e].pathElement)&&(l.push(t.plies[o]),a.push(o));for(;m.firstChild;)m.removeChild(m.firstChild);l.length?(P(p.selectedPlies,!0),l.forEach(function(e){var n=e.name;void 0!==e.directionNls&&(n+=" | "+p.directionLbl+": "+e.directionNls+t.directionUnit),void 0!==e.curedThicknessNls&&(n+=" | "+p.thicknessFullLbl+": "+e.curedThicknessNls+t.thicknessUnit),P(n)})):(P(p.totalThicknessLbl+t.thickness+t.thicknessUnit),P(p.totalNbPliesLbl+t.entities));var s=[];for(e=0;e<t.plies.length;e++)s.push({idPath:[e],infos:{activeState:-1!==a.indexOf(e)}});v.setAdditionalInformations(s),S.updateViewerSize()},L=t.plies.length-1;L>=0;L--)M(t.plies[L],L+1);g.render(),P(p.totalThicknessLbl+t.thickness+t.thicknessUnit),P(p.totalNbPliesLbl+t.entities),(v=new u).subscribe("onAttrActiveStateModified",function(e){n.empty();for(var i=[],l=0;l<e.currentSelection.length;l++)i.push(t.plies[e.currentSelection[l].idPath[0]]);n.add(i),g.render()}),v.subscribe("onSwitchAttributeDisplayMode",function(){V.children[0].dsModel.elements.container.setStyles({position:"relative",height:x+"px"})}),V=v.buildPanel({model:[{elements:I}],attributeDisplayCurrentState:"columns",className:"CAT3DAnnotRelatedInfoCS"});var N=new r({header:p.pliesLbl}).inject(A);return N.body=V,N.addEventListener("expand",function(){T("onPlyListExpandedOrCollapsed",{state:!0})}),N.addEventListener("collapse",function(){T("onPlyListExpandedOrCollapsed",{state:!0})}),x=28*(t.plies.length+1)+4,V.children[0].dsModel.elements.container.setStyles({position:"relative",height:x+"px"}),F(),D.onAdd||(D.onAdd=n.onAdd(R)),D.onRemove||(D.onRemove=n.onRemove(R)),D.onEmpty||(D.onEmpty=n.onEmpty(R)),R(),setTimeout(function(){if(C){T("onPlyAndLayersPanelCreated");var e=new c([C]);f.reframe(null,0,e.getBoundingSphere(g,"visibleSpace",!0))}}),b},this.clean=function(){if(g&&g.dispose(),F(),v&&v.destroy(),m)for(;m.firstChild;)m.removeChild(m.firstChild);if(A)for(;A.firstChild;)A.removeChild(A.firstChild);C&&C.removeChildren(),g=f=m=b=y=C=null},this.getTextualAndListHeight=function(){return m&&A?m.offsetHeight+A.offsetHeight:0},this.updateViewerSize=function(e,t){y.setStyles({width:e+"px",height:t+"px"})},this.subscribe=function(e,t){if(e&&t)return w.subscribe({event:e},t)},this.unsubscribe=function(e){null!=e&&w.unsubscribe(e)}}})});