/*!  Copyright 2021 Dassault Systemes. All rights reserved. */
define("DS/CATWebUXCVS/CATWebUXCVSComponent",["UWA/Core","UWA/Class","DS/Windows/Dialog","DS/Controls/Button","DS/UIKIT/Spinner"].concat(["DS/Utilities/Dom","i18n!DS/CATWebUXCVS/assets/nls/CATWebUXCVS","css!DS/CATWebUXCVS/CATWebUXCVS.css"]),function(t,e,i,a,n,s,r){"use strict";return e.extend({init:function(e){if(!(e.title&&e.physicalId&&e.platformSettings&&e.tenant&&e.securityContext))return;var l,o,d,c,g=this,S=null,u=null,v=100,C=20,p=[{id:"inProgress"},{id:"passed"},{id:"failed"}],h=e.title,b=e.physicalId,f=e.isrType;Array.isArray(e.platformSettings)&&e.platformSettings.length>0&&(c=e.platformSettings);var m,A=e.tenant;"function"==typeof e.securityContext.getSecurityContext&&(m=e.securityContext);var y,w=e.onChangeValidationStateCompleted,V=e.onChangeValidationStateClose,T=e.onChangeValidationStateFailure,x=function(t){var e;switch(t){case"inProgress":e="InProgress";break;case"passed":e="Passed";break;case"failed":e="Failed"}return e},W=function(t){d=!1;for(var e=0;e<p.length;e++)if(p[e].beingchanged){p[e].div.getElementsByClassName("CATWebUXCVS-valstate-text")[0].setStyle("visibility","visible"),o.destroy(),p[e].beingchanged=!1;break}T(t)},U=function(t){if(y)t();else{require(["DS/WAFData/WAFData"],function(e){y=e,U(t)})}},j=t.createElement("div",{class:"CATWebUXCVS-valstate-content"}),X=t.createElement("div",{class:"CATWebUXCVS-valstate-div"}).inject(j);X.setStyles({height:140..toString()+"px",width:380..toString()+"px","margin-left":50..toString()+"px"});var k=t.createElement("div",{class:"CATWebUXCVS-svg-container"}).inject(X);k.setStyles({position:"absolute",top:"0",left:"0",width:"100%",height:"100%",visibility:"visible"});var E=t.createElement("div",{class:"CATWebUXCVS-valstate-container"}).inject(X);E.setStyles({display:"flex",position:"absolute","z-index":"10"});var D=t.createElement("div",{class:"CATWebUXCVS-valstate-inprogress-container"}).inject(E);D.setStyles({"vertical-align":"middle","left-margin":v.toString()+"px"}),t.createElement("div",{class:"CATWebUXCVS-valstate-connectors"}).inject(E).setStyles({width:100..toString()+"px",height:140..toString()+"px"});var I=t.createElement("div",{class:"CATWebUXCVS-valstate-passedfailed-container"}).inject(E);I.setStyles({display:"block"});!function(){var e=function(t){return document.createElementNS("http://www.w3.org/2000/svg",t)};(u=e("svg")).setAttribute("id","svgCanvas"),u.setAttribute("width","100%"),u.setAttribute("height","100%");var i=e("path");i.setAttribute("d","M "+(90+C).toString()+" "+70..toString()+" L "+180..toString()+" "+70..toString()),i.setAttribute("class","line");var a=e("path");a.setAttribute("d","M "+180..toString()+" "+(C+20).toString()+" L "+180..toString()+" "+(140-(C+20)).toString()),a.setAttribute("class","line");var n=e("path");n.setAttribute("marker-end","url(#arrow)"),n.setAttribute("d","M "+180..toString()+" "+(C+20).toString()+" L "+(230+C).toString()+" "+(C+20).toString()),n.setAttribute("class","line");var s,r,l,o=e("path");o.setAttribute("marker-end","url(#arrow)"),o.setAttribute("d","M "+180..toString()+" "+(140-(C+20)).toString()+" L "+(230+C).toString()+" "+(140-(C+20)).toString()),o.setAttribute("class","line"),u.appendChild((s=e("marker"),r=e("defs"),l=e("path"),s.appendChild(l),r.appendChild(s),s.setAttribute("id","arrow"),s.setAttribute("markerWidth","10"),s.setAttribute("markerHeight","8"),s.setAttribute("refX","9"),s.setAttribute("refY","4"),s.setAttribute("orient","auto"),l.setAttribute("d","M 3 1 L 10 4 L 3 7"),l.setAttribute("class","arrow"),r)),u.appendChild(i),u.appendChild(a),u.appendChild(n),u.appendChild(o),t.extendElement(u).inject(k)}(),p.forEach(function(i){i.div=t.createElement("div",{class:"CATWebUXCVS-valstate"}),i.div.setStyles({width:90..toString(),height:40..toString(),margin:C.toString()}),i.id===e.current?i.div.addClassName("CATWebUXCVS-valstate-current-"+i.id.toString()):(i.div.addClassName("CATWebUXCVS-valstate-"+i.id.toString()),i.div.addClassName("CATWebUXCVS-valstate-clickable"),i.div.onclick=function(){if(!d){d=!0,i.div.getElementsByClassName("CATWebUXCVS-valstate-text")[0].setStyle("visibility","hidden"),o=new n({visible:!0});var t,e=0;"inProgress"===i.id?(t=60,e=50):"passed"===i.id?(t=C+20-10,e=280):"failed"===i.id&&(t=140-C-20-10,e=280),o.inject(i.div),o.getContent().addClassName("CATWebUXCVS-valstate-spinner"),o.getContent().setStyles({top:t.toString()+"px",left:e.toString()+"px"}),i.beingchanged=!0,a={physicalId:b,state:i.id},U(function(){if(m&&c&&A){var t=m.getSecurityContext();if(t&&t.hasOwnProperty("SecurityContext")){for(var e,i={Accept:"application/json","Content-Type":"application/json","Accept-Language":window.widget.lang,SecurityContext:t.SecurityContext},n=0;n<c.length;n++)if(c[n].platformId===A){e=c[n]["3DSpace"];break}var s,r,l=function(t){if(null===t&&void 0===t)return"";var e="";if(Array.isArray(t))for(var i=t.length/2,a=0;a<i;a++)e+=0===a?"?":"&",e+=t[2*a]+"="+t[2*a+1];return encodeURI(e)},o=[];o.push("securityContext"),o.push(t),o.push("tenant"),o.push(A),f?(s=e+"/resources/PIMwebModel/services/setAttributeValue"+l(o),r={id:a.physicalId,attrName:"SIMItfSimulation.V_ValidationState",attrValue:x(a.state)}):(s=e+"/resources/validationauthoring/service/modifyAttributes"+l(o),r={listObjects:[{sObjectId:a.physicalId,sListOfAttributesToModify:[{sValidationState:x(a.state)}]}]}),y.authenticatedRequest(s,{method:"POST",type:"json",headers:i,data:JSON.stringify(r),onComplete:function(t){t&&t.modifiedObjects&&1===t.modifiedObjects.length||t&&f?(d=!1,w({sValidationState:f?a.state:function(t){var e;switch(t){case"InProgress":e="inProgress";break;case"Failed":e="failed";break;case"Passed":e="passed"}return e}(t.modifiedObjects[0].sValidationState)}),g.clean()):W(t)},onFailure:function(t){W(t)}})}else W()}else W()})}var a}),i.div.addClassName(e.current);var a=t.createElement("span",{class:"CATWebUXCVS-valstate-text"}).inject(i.div);switch(i.id){case"inProgress":i.div.setStyles({"margin-top":50..toString()+"px"}),i.div.inject(D),a.setText(r.valStateChange.inProgress);break;case"passed":i.div.inject(I),a.setText(r.valStateChange.passed);break;case"failed":i.div.inject(I),a.setText(r.valStateChange.failed)}});var P=new a({label:r.valStateChange.closeBtn,onClick:function(){V(),g.clean()}});let L={ensureHeightDefinitionOnHierarchy:!0,title:r.valStateChange.dlgTitle+" - "+h,resizableFlag:!1,buttons:{Close:P},width:480,content:j};function F(t,e){var i=t.getSize(),a=e.getSize(),n=(a.width-i.width)/2,s=(a.height-i.height)/2;t.setStyles({left:n<0?0:n,top:s<0?0:s})}e.parent.appendChild||(L.modalFlag=!0,L.immersiveFrame=e.parent),(S=new i(L)).addEventListener("close",function(){V(),g.clean()}),L.modalFlag||(l=t.createElement("div",{class:"wux-windows-modalDialog",styles:{}}).inject(e.parent),S.elements.container.inject(l),F(S.elements.container,e.parent),s.addResizeListener(e.parent,function(){F(S.elements.container,e.parent)})),this.clean=function(){S&&S.destroy(),l&&(s.removeResizeListener(e.parent),l.destroy(),l=null)}}})});