define("DS/ApplicationFrame/PlayerButton",[],function(){return{PLAY_PAUSE:0,BACK_NEXT:1,BACKWARD_FORWARD:2,FIRST_LAST:3,STOP:4,PLAYREVERSE:5,SLIDER:6,EDITOR:7,LOOP:8,PLAYLIST:9,OPTIONS:10}}),define("DS/ApplicationFrame/PlayerStyle",[],function(){return{SIMPLE:{name:"SIMPLE"},TOUR3D:{name:"TOUR3D"},RUN:{name:"RUN"},SIMULATION:{name:"SIMULATION"}}}),define("DS/ApplicationFrame/CommandsManager",["UWA/Core","DS/Core/Core","DS/Core/Events","UWA/Class"],function(e,t,n,i){"use strict";var o=[],s=i.singleton({options:{},init:function(t){var i=this;this.options=this.defaultOptions,e.extend(this.options,t),this._parent(t),this._reset();var o=!1;document.onkeydown=function(e){var t;27===(e=e||window.event).keyCode?(e.preventDefault(),i._cancelCurrentCmdInAllCtxt()):17===e.keyCode?o=!0:o&&90===e.keyCode?(t=i.getCommand("Undo"))&&t.begin():o&&89===e.keyCode&&(t=i.getCommand("Redo"))&&t.begin()},document.onkeyup=function(e){17===(e=e||window.event).keyCode&&(o=!1)},n.subscribe({event:"COMMAND_MANAGER/Ending_Commands"},function(e){var t;e&&(t=e.context),i.endAll(t)})},_reset:function(){var e,t;for(e in this._commands)this._commands[e]&&this._commands[e]._destroy&&this._commands[e]._destroy();for(t in this._commands)for(e in this._commands[t])this._commands[t][e]&&this._commands[t][e]._destroy&&this._commands[t][e]._destroy();var n=this.getCommandCheckHeaders();for(e in n)n[e]&&n[e]._destroy&&n[e]._destroy();for(t in n)for(e in n[t])n[t][e]&&n[t][e]._destroy&&n[t][e]._destroy();this._commands={},this._cmdCheckHeader=null,this._isCommandEnding=!1,this._ignoreCommandBeginWhileEndingCommand=!1,this._allowNextCmd=!1,this._nextCmd=null,this._commandsState={lastCommand:[],currentCommand:null,currentCommandInstanceId:null,defaultCommand:null}},_cancelCurrentCmdInAllCtxt:function(){if(this._resetNextCmd(),this._commandsState.currentCommand){var e=this._getCurrent();e&&this.getCommand(e).cancel()}else for(var t in this._commandsState){var n=this._getCurrent(t);if(n){var i=this.getCommand(n,t);i&&i.cancel()}}},setDefaultCommand:function(e,t){t=t||e.context,this._loadCommand(e.ID,e.className,t,function(n){t?(this._commandsState[t]||(this._commandsState[t]={},this._commandsState[t].lastCommand=[]),this._commandsState[t].defaultCommand=n):this._commandsState.defaultCommand=n,!0!==e.dontStartCmd&&n.begin()})},resetDefaultCommand:function(e){e?(this._commandsState[e]||(this._commandsState[e]={},this._commandsState[e].lastCommand=[]),this._commandsState[e].defaultCommand=null):this._commandsState.defaultCommand=null},_getDefaultCommand:function(e){return e?this._commandsState[e].defaultCommand:this._commandsState.defaultCommand},_setLast:function(e,t){e&&(t?(this._commandsState[t]||(this._commandsState[t]={}),this._commandsState[t].lastCommand||(this._commandsState[t].lastCommand=[]),this._commandsState[t].lastCommand.push(e)):(this._commandsState.lastCommand||(this._commandsState.lastCommand=[]),this._commandsState.lastCommand.push(e)))},_getLast:function(e){return e?this._commandsState[e].lastCommand.length?this._commandsState[e].lastCommand[this._commandsState[e].lastCommand.length-1]:null:this._commandsState.lastCommand.length?this._commandsState.lastCommand[this._commandsState.lastCommand.length-1]:null},_popLastPausedCmd:function(e){return e?this._commandsState[e].lastCommand.length?this._commandsState[e].lastCommand.pop():null:this._commandsState.lastCommand.length?this._commandsState.lastCommand.pop():null},_removeFromLast:function(e,t){var n;return t?(n=this._commandsState[t].lastCommand.indexOf(e))>=0?this._commandsState[t].lastCommand.splice(n,1):null:(n=this._commandsState.lastCommand.indexOf(e))>=0?this._commandsState.lastCommand.splice(n,1):null},_setCurrent:function(e,t){t?(this._commandsState[t]||(this._commandsState[t]={}),this._commandsState[t].lastCommand||(this._commandsState[t].lastCommand=[]),e?(this._commandsState[t].currentCommand=e._id,this._commandsState[t].currentCommandInstanceId=e.getCSIdentifier()):(this._commandsState[t].currentCommand=null,this._commandsState[t].currentCommandInstanceId=null)):e?(this._commandsState.currentCommand=e._id,this._commandsState.currentCommandInstanceId=e.getCSIdentifier()):(this._commandsState.currentCommand=null,this._commandsState.currentCommandInstanceId=null)},_getCurrent:function(e){return e?this._commandsState[e]?this._commandsState[e].currentCommand:null:this._commandsState.currentCommand},_getCurrentInstanceId:function(e){return e?this._commandsState[e]?this._commandsState[e].currentCommandInstanceId:null:this._commandsState.currentCommandInstanceId},getCurrentCmdId:function(e){return e?this._commandsState[e]?this._commandsState[e].currentCommand?this._commandsState[e].currentCommand:"NoRunningCmd":null:this._commandsState.currentCommand?this._commandsState.currentCommand:"NoRunningCmd"},_restoreLast:function(e){var t=this._getLast(e),n=this._getDefaultCommand(e);e&&this._commands[e]?this._commands[e][t]&&this._commands[e][t].isPaused()?this._commands[e][t].resume():n&&(n.isPaused()?n.resume():n.begin()):this._commands[t]&&this._commands[t].isPaused()?this._commands[t].isPaused()?this._commands[t].resume():this._commands[t].begin():n&&(n.isPaused()?n.resume():n.begin())},_restoreDefault:function(e,t){var n=this._getDefaultCommand(e);n&&(n.isPaused()&&n.isRunning()?n.resume():n.isRunning()||n.begin(t))},activateNextCmd:function(){this._allowNextCmd=!0},deactivateNextCmd:function(){this._allowNextCmd=!1},_isNextCmdAllowed:function(){return this._allowNextCmd},_setNextCmd:function(e){return null===this._nextCmd&&(this._nextCmd=e,!0)},_resetNextCmd:function(){this._nextCmd=null},_getNextCmd:function(){return this._nextCmd},_isNextCmdWaiting:function(){return null!==this._nextCmd},setIgnoreCommandBeginWhileEndingCommand:function(){this._ignoreCommandBeginWhileEndingCommand=!0},unsetIgnoreCommandBeginWhileEndingCommand:function(){this._ignoreCommandBeginWhileEndingCommand=!1},_isIgnoredCommandBeginWhileEndingCommand:function(){return this._ignoreCommandBeginWhileEndingCommand},_isEndingCommand:function(){return this._isCommandEnding},_setEndingCommand:function(){this._isCommandEnding=!0},_unsetEndingCommand:function(){this._isCommandEnding=!1},_isCmdBeingCanceled:function(){var e,t=this.getCommands();for(var n in t){!0===t[n]._executeUndoAtEnd&&(e=!0)}return e},getCommand:function(e,t){return t&&this._commands[t]?this._commands[t][e]:this._commands[e]},getCommands:function(e){return e?this._commands[e]:this._commands},endAll:function(e,t){var i,s;this._resetNextCmd();var a=this.getCommands(e),r={};o=[];var l=0,d=!1;for(s in a)if("function"==typeof(i=a[s]).begin){if(r[s]=i,i.isNewInfraActivated())return;"undefined"!==i._mode&&(i.isRunning&&i.isRunning()||i.isPaused&&i.isPaused())&&l++}if(l>0)for(s in r)"undefined"!==(i=r[s])._mode&&(i.isRunning&&i.isRunning()||i.isPaused&&i.isPaused())&&(o.push({cmdID:i._id,token:i.onCanceled(function(e){l--;for(var t=0;t<o.length;t++)if(o[t].cmdID===e){n.unsubscribe(o[t].token),o.splice(t,1);break}0===l&&!1===d&&(d=!0,n.publish({event:"COMMAND_MANAGER/ALL_CMD_ENDED"}))})}),i.cancel(!1!==t));0===l&&!1===d&&(n.publish({event:"COMMAND_MANAGER/ALL_CMD_ENDED"}),d=!0)},pauseAll:function(e){var t=this.getCommands(e);for(var n in t){var i=t[n];i.isRunning&&i.isRunning()&&i.isPaused&&!i.isPaused()&&i.pause()}},disableAll:function(e,t){"object"==typeof e&&(t=e,e=void 0);var n=this.getCommands(e);for(var i in n)n[i].disable(t);var o=this.getCommandCheckHeaders(e);for(var s in o)o[s].disable(t)},enableAll:function(e){"object"==typeof e&&(e=void 0);var t=this.getCommands(e);for(var n in t)t[n].enable();var i=this.getCommandCheckHeaders(e);for(var o in i)i[o].enable()},_loadCommand:function(e,t,n,i){var o=this,s=this.getCommand(e,n);if(s)i&&i.call(o,s);else{var a=t.replace(/\./g,"/");require([a],function(t){var s=new t({context:n,ID:e});i&&i.call(o,s)})}},onCommandStart:function(e,t){t||(t="");var i="/WUX/AFR/CMD/"+t+"/BEGIN";return n.subscribe({event:i},e)},_registerExistingCommand:function(e){e.options.context?(void 0===this._commands[e.options.context]&&(this._commands[e.options.context]={}),e.options.ID?this._commands[e.options.context][e.options.ID]=e:console.warn("Error: Cannot register the command. Please specify a command ID")):e.options.ID?this._commands[e.options.ID]=e:console.warn("Error: Cannot register the command. Please specify a command ID")},_registerExistingCommandCheckHeader:function(e){if(void 0===e||void 0===e.options)throw new Error("Wrong parameter");if(void 0===e.options.ID||"string"!=typeof e.options.ID)throw new Error("Missing parameter: Cannot register the commandCheckHeader. Please specify a command ID");e.options.context&&"string"!=typeof e.options.context&&console.warn("The context parameter has to be a string"),this._cmdCheckHeader||(this._cmdCheckHeader={}),e.options.context?(void 0===this._cmdCheckHeader[e.options.context]&&(this._cmdCheckHeader[e.options.context]={}),this._cmdCheckHeader[e.options.context][e.options.ID]=e):this._cmdCheckHeader[e.options.ID]=e},getCommandCheckHeader:function(e,t){if(!this._cmdCheckHeader)return this._cmdCheckHeader;if(void 0===e||"string"!=typeof e)throw new Error("The id parameter is not defined or is not a string");return null!=t?("string"!=typeof t&&console.warn("The context parameter has to be a string"),this._cmdCheckHeader[t]?this._cmdCheckHeader[t][e]:void 0):this._cmdCheckHeader[e]},getCommandCheckHeaders:function(e){return e&&this._cmdCheckHeader?this._cmdCheckHeader[e]:this._cmdCheckHeader},_dispose:function(e){var t;if(t=e&&this._commands[e]?this._commands[e]:this._commands)for(var n in t){var i=t[n];i._destroy&&i._ctx===e&&(i._destroy(),delete t[n])}var o=this.getCommandCheckHeaders(e);if(o)for(var s in o)o[s]._destroy&&(o[s]._destroy(),delete o[s])}});return e.namespace("WUX/AFR/CommandsManager",s)}),define("DS/ApplicationFrame/XMLUtilities",["UWA/Core","DS/WebappsUtils/WebappsUtils"],function(e,t){"use strict";function n(n){window.location.href.split("/").slice(0,window.location.href.split("/").length-2).join("/");var i,o=t.getWebappsBaseUrl()+n.module+"/"+n.directory+"/"+n.fileName+"."+n.fileExtension,s="Ajax";"../"!=t.getWebappsBaseUrl()&&(s="Data"),e[s].request(o,{async:!0,type:"xml",onComplete:function(t){var o,s,a;s=(o=t).implementation.createDocument(o.namespaceURI,null,null),a=s.importNode(o.documentElement,!0),s.appendChild(a),i=e.Utils.loadXml(s),n.onComplete&&n.onComplete.call(this,i)},onFailure:function(e){console.error("[!]\tError loading file:"+o),n.onFailure&&n.onFailure.call(this,e)}})}return function(e){n({module:"ApplicationFrame",directory:"assets/afr",fileName:"dafr-template",fileExtension:"xml",onComplete:function(t){var i=t;n({module:e.module,directory:"assets/afr",fileName:e.workbenchName,fileExtension:"xml",onComplete:function(t){var n=t.getElementsByTagName("CATCmdHeadersList");!function(e,t,n,i,o){!function(e){var t=e.getElementsByTagName("CATCmdHeadersList")[0],n=e.getElementsByTagName("CATCmdContainer")[0],i=t.cloneNode(!1),o=n.cloneNode(!1),s=e.getElementsByTagName("Template")[1],a=e.getElementsByTagName("CATCmdWorkbench")[0];s.removeChild(t),a.removeChild(n),s.appendChild(i),a.appendChild(o)}(o);for(var s,a=o.getElementsByTagName("CATCmdHeadersList")[0],r=o.getElementsByTagName("CATCmdContainer")[0],l=(o.createElement("CATCmdWorkbench"),0);l<t.length;l++){var d=t[l];d.hdr_list.length>1&&((s=o.createElement("CATCmdContainer")).setAttribute("Name",d.name),s.setAttribute("RepresentationType","AfrActionBarDropDown"),s.setAttribute("Visibility","1"),r.appendChild(s));for(var c=0;c<d.hdr_list.length;c++){var u=e+d.hdr_list[c]+n,m=i[0].querySelectorAll('[ID="'+u+'"]'),h=m.length>0;h&&0===a.querySelectorAll('[ID="'+u+'"]').length&&a.appendChild(m[0].cloneNode(!0));var p=o.createElement("CATCmdStarter");p.setAttribute("Name",u),p.setAttribute("Command",u),d.hdr_list.length>1&&h?s.appendChild(p):h&&r.appendChild(p)}}}(e.cmdPrefix,e.cmdList,e.cmdSuffix,n,i),e.onComplete&&e.onComplete.call(this,i)}})}})}}),define("DS/ApplicationFrame/PlayerElements",[],function(){return{PLAY_PAUSE:0,BACK_NEXT:1,BACKWARD_FORWARD:2,FIRST_LAST:3,STOP:4,PLAYREVERSE:5,SLIDER:6,EDITOR:7,LOOPRC:8,loopRCBF:9,LOOPRO:10,PLAYLIST:11,OPTIONS:12,EXIT:13}}),define("DS/ApplicationFrame/FrameWindowsManager",["UWA/Core","UWA/Class"],function(e,t){"use strict";var n=t.singleton({options:{},init:function(t){this.options=this.defaultOptions,e.extend(this.options,t),this._parent(t),this._frameWindow=null,this._frameWindows={}},_registerNewFrameWindow:function(e){var t=e.options;t.context?void 0===this._frameWindows[t.context]?(this._frameWindows[t.context]={},this._frameWindows[t.context]=e):console.warn("Warning registering the new FrameWindow! A FrameWindow already exist in this context: "+t.context):this._frameWindow?console.warn("Warning registering the new FrameWindow! A FrameWindow already exist. "):this._frameWindow=e},getFrameWindow:function(e){return e&&this._frameWindows[e]?this._frameWindows[e]:this._frameWindow},_unregisterFrameWindow:function(e){void 0!==e&&this._frameWindows[e]?delete this._frameWindows[e]:this._frameWindow=null}});return e.namespace("WUX/AFR/FrameWindowsManager",n)}),define("DS/ApplicationFrame/CommandCheckHeader",["UWA/Core","DS/Core/Core","DS/Core/Events","DS/CoreEvents/ModelEvents","UWA/Class","DS/ApplicationFrame/FrameWindowsManager","DS/ApplicationFrame/CommandsManager"],function(e,t,n,i,o,s,a){"use strict";return o.extend({defaultOptions:{context:null,ID:null,Behavior:"CATAfrHeaderCheck"},init:function(t,o){e.extend(t,o),this.options=e.extend(this.defaultOptions,t),this._parent(this.options),void 0!==t.isEnabled?this._isEnabled=t.isEnabled:this._isEnable=!0,this._modelEvents=new i,this._state=!1,this._id=this.options.ID,this._context=this.options.context;var s=this,r="";if(this.options.context&&(r=this.options.context+"/"),this._evtID="/WUX/AFR/CMD/"+r+this.options.ID,this._startToken=n.subscribe({event:this._evtID},function(){s.toggleState()}),this.onStateChange(function(){this.getState()?n.publish({event:s._evtID+"/BEGIN",data:s}):n.publish({event:s._evtID+"/END",data:s})}),n.subscribe({event:s._evtID+"/END"},function(e){e||s.setState(!1,!1)}),n.subscribe({event:s._evtID+"/BEGIN"},function(e){e||s.setState(!0,!1)}),a.getCommand(this._id,this._ctx)){if(void 0===this._id)console.warn("The CommandCheckHeader has no ID.");else if("string"!=typeof this._id)throw new Error("The CommandCheckHeader ID has to be a string.")}else a._registerExistingCommandCheckHeader(this)},getState:function(){return this._state},setState:function(e,t){void 0===t&&(t=!0),this._state=e,this._modelEvents.publish({event:"UDPATE",data:this._state,context:this})},toggleState:function(){this.setState(!this.getState(),!1)},onStateChange:function(e){return this._modelEvents.subscribe({event:"UDPATE"},e)},getFrameWindow:function(){return s.getFrameWindow(this._context)},enable:function(){this._isEnabled=!0,n.publish({event:this._evtID+"/ENABLE",data:this}),n.publish({event:this._evtID+"/ENABLE",data:this})},disable:function(e){this._isEnabled=!1,n.publish({event:this._evtID+"/DISABLE",data:this}),n.publish({event:this._evtID+"/DISABLE",data:this})},isEnabled:function(){return this._isEnabled},destroy:function(){},_destroy:function(){this.destroy(),this._modelEvents.unsubscribeAll()}})}),define("DS/ApplicationFrame/Command",["UWA/Core","UWA/Class","DS/Core/Core","DS/CoreEvents/Events","DS/ApplicationFrame/CommandsManager","DS/ApplicationFrame/FrameWindowsManager","DS/AfrUndoRedoUI/Private_UndoRedoManager","DS/AfrUndoRedoUI/Private_UndoStep","DS/CoreUtilities/ErrorManagement"],function(e,t,n,i,o,s,a,r,l){"use strict";var d,c=function(e){l.getDebugMode()&&(l.getDebugMode()?(n.enableWUXConsole(),d=n.getWUXConsole()?n.getWUXConsole():console):d=console,d.log(e))},u=1,m=t.extend({defaultOptions:{context:null,ID:null,className:null,isAsynchronous:!1,isEnabled:!0,arguments:[],mode:"exclusive",repeatMode:!1,withStartUndoStep:!1,undoOnCancel:!0},init:function(t,n){e.extend(t,n),this.options=e.extend(e.clone(this.defaultOptions),t),this._parent(this.options),this._isRunning=!1,this._isEnding=!1,this._isPaused=!1,this._isCanceled=!1,this._executeUndoAtEnd=!1;var s=this,a="";this.options.context&&(a=this.options.context+"/"),this._evtID="/WUX/AFR/CMD/"+a+this.options.ID,this._globalEvtID="/WUX/AFR/CMD/"+a,this._id=this.options.ID,this._ctx=this.options.context,this._mode=this.options.mode,this._isEnabled=this.options.isEnabled,this._repeatMode=this.options.repeatMode,this._withStartUndoStep=this.options.withStartUndoStep,this._previousUndoId=-1,this._isAsynchronous=this.options.isAsynchronous,this._arguments=this.options.arguments,this._undoOnCancel=this.options.undoOnCancel,this._dirtyUndoStack=!1,this._endUndoGroupingRequested=!1,this._undoGroupID="",this._isEnabled?this.enable():this.disable(),o.getCommand(this.getId(),this._ctx)||(o._registerExistingCommand(this),s._startToken=i.subscribe({event:s._evtID},function(){s.begin()}))},done:function(){return!1},isNewInfraActivated:function(){return!1},_destroy:function(){if(this._isRunning){this.cancel();var e=this,t=this.onEnd(function(){e.destroy()});i.unsubscribe(t)}else this.destroy();i.unsubscribe(this._startToken)},_updateOptions:function(t){this.options=e.extend(this.options,t)},beginExecute:function(){},resumeExecute:function(){},pauseExecute:function(){},execute:function(){},cancelExecute:function(e){},endExecute:function(){},destroy:function(){},getFrameWindow:function(){return s.getFrameWindow(this.options.context)},getArguments:function(){return this._arguments||[]},getId:function(){return this._id},getCSIdentifier:function(){return this._instanceId},hasDecalredCS:function(){return this.options.doServerCall},setRepeatMode:function(e){this._repeatMode=e},executeUndoAtEnd:function(e){return void 0===e||"boolean"!=typeof e?l.createReturnObject(l.getErrorManager().MISSING_PARAMETERS,{description:"command.executeUndoAtEnd expect a boolean input parameter"}):(this._executeUndoAtEnd=e,this._undoOnCancel=e,!0)},enable:function(){this._isEnabled=!0,i.publish({event:this._evtID+"/ENABLE",data:this}),i.publish({event:this._globalEvtID+"/ENABLE",data:this})},disable:function(e){this.isRunning()&&this.cancel(),this._isEnabled=!1,i.publish({event:this._evtID+"/DISABLE",data:this}),i.publish({event:this._globalEvtID+"/DISABLE",data:this})},isEnabled:function(){return this._isEnabled},isRunning:function(){return!this._isPaused&&this._isRunning},isPaused:function(){return this._isPaused},isEnding:function(){return this._isEnding},isCanceled:function(){return this._isCanceled},begin:function(e){var t=this,n=function(){if(t._withStartUndoStep){var e=new r({undoTitle:"Start command "+t.getId(),exclusivity:!0,redoEnabled:!1});a.registerAction(e)}i.publish({event:t._evtID+"/BEGIN",data:t}),i.publish({event:t._globalEvtID+"/BEGIN",data:t}),t.beginExecute&&t.beginExecute(),i.publish({event:t._evtID+"/EXECUTE",data:t}),i.publish({event:t._globalEvtID+"/EXECUTE",data:t}),t.execute&&t.isRunning()&&t.execute(),t._isAsynchronous||t.end()};if(o._isEndingCommand()){if(o._isIgnoredCommandBeginWhileEndingCommand())return!1;if(o._isNextCmdAllowed()&&o._isEndingCommand())return o._setNextCmd(this)}if(void 0===e&&(e=!0),this._repeatMode&&o._getCurrent()===this.getId()&&(e=!1),this._isRunning)"undefined"!==this._mode&&this.cancel();else if(this._instanceId=u,u++,c("begin command : "+this.getId()),"undefined"!==this._mode&&o._setCurrent(this,this.options.context),e&&("exclusive"===this._mode&&o.endAll(this.options.context,!1),"shared"===this._mode&&o.pauseAll(this.options.context)),this._isRunning=!0,this._isEnding=!1,this._isPaused=!1,this._isCanceled=!1,this._executeUndoAtEnd=!1,this._undoOnCancel=this.options.undoOnCancel,this._restoreLastCommand=void 0,this._dirtyUndoStack=!1,this._previousUndoId=a.getLastCreatedUndoStepId(),this.hasDecalredCS()){this._doNotSendCommandEnd=!1;var s,d,m={from:this};if(void 0===o.privateAfrCore)"DS/AfrCS/Private_AfrCore",require(["DS/AfrCS/Private_AfrCore","DS/ApplicationFrame/CommandsManager"],function(e,i){i.privateAfrCore=e;var o=i.privateAfrCore.sendStartCommand(m);return l.hasSucceeded(o)?(n(),!0):(t._doNotSendCommandEnd=!0,t===i._getDefaultCommand()&&(d=!1),t.end(d),o)});else{if(s=o.privateAfrCore.sendStartCommand(m),!l.hasSucceeded(s))return this._doNotSendCommandEnd=!0,this===o._getDefaultCommand()&&(d=!1),this.end(d),s;n()}}else n()},pause:function(){if(this.isRunning()&&!this.isEnding()){this._isPaused=!0,o._setLast(this.getId(),this._ctx),i.publish({event:this._evtID+"/PAUSE",data:this}),i.publish({event:this._globalEvtID+"/PAUSE",data:this}),this.pauseExecute()}},resume:function(){if(this.isPaused()){o._popLastPausedCmd(this._ctx),o._setCurrent(this,this._ctx),this._isPaused=!1,this.resumeExecute(),i.publish({event:this._evtID+"/RESUME",data:this}),i.publish({event:this._globalEvtID+"/RESUME",data:this})}},cancel:function(e){if(!this._isCanceled&&this._isRunning){this._isCanceled=!0,this.setRepeatMode(!1);var t=!1===e;if(this.cancelExecute(null,{canceledByAnotherCmd:t}),this._undoOnCancel)if(this._executeUndoAtEnd=!0,c("cancel command : "+this.getId()),this.hasDecalredCS())"NO_CMD_TO_CANCEL"===o.privateAfrCore.cancelCommandService({from:this}).getReturnValue().internalValue?this._doNotSendCommandEnd=!0:(this._isEnding=!1,this._doNotSendCommandEnd=!1);this.end(e)}},end:function(e){if(!this.isEnding()&&this._isRunning){this.isPaused()&&o._removeFromLast(this.getId(),this._ctx),this._isEnding=!0,o._setEndingCommand(),c("ending command : "+this.getId()),this._restoreLastCommand=void 0===e||e;if(this.endExecute&&this.endExecute(),this.hasDecalredCS()&&!this._doNotSendCommandEnd){var t={from:this};this._doNotSendCommandEnd=!0;var n=o.privateAfrCore.sendStopCommand(t);if(l.hasSucceeded(n))return;l.logResult(n)}this.onCmdEnded()}},onCmdEnded:function(){if(this._isRunning){var e;"undefined"!==this._mode&&(e=this._createCmdGlobalUndo()),this._isRunning=!1,this._isEnding=!1,o._unsetEndingCommand();var t=this;i.publish({event:t._evtID+"/END",data:t}),i.publish({event:t._globalEvtID+"/END",data:t}),c("ended command : "+this.getId()),this._executeUndoAtEnd&&e?(this._cancelToken=a.onUndoExecuted(a._private._undoStack.getLastStepId(),function(){i.unsubscribe(t._cancelToken),t._cancelToken=void 0,t.isCanceled()&&(i.publish({event:t._evtID+"/CANCELED",data:t._id}),i.publish({event:t._globalEvtID+"/CANCELED",data:t._id}))}),a.undo()):this.isCanceled()&&(i.publish({event:t._evtID+"/CANCELED",data:t._id}),i.publish({event:t._globalEvtID+"/CANCELED",data:t._id})),this._executeUndoAtEnd=!1,this._endUndoGroupingRequested&&(a._stopConcatenateUS(this._undoGroupID),this._endUndoGroupingRequested=!1),this._relaunchCmd()}},_createCmdGlobalUndo:function(){var e=!1;if(!this._dirtyUndoStack)return e;var t=a._private._undoStack.getLastStepId();if(this._previousUndoId<t){var n=!0;("shared"===this._mode&&o._getLast(this._ctx)||this._executeUndoAtEnd)&&(n=!1);var i=new r({undoTitle:this.getId(),exclusivity:n,redoEnabled:!this._executeUndoAtEnd});a.registerAction(i);var s=a._private._undoStack.groupSteps(i.getId(),this._previousUndoId+1);if(l.hasSucceeded(s))e=!0;else{var d=a._private._undoStack.removeStepWithId(a._private._undoStack.getLastStepId());l.hasSucceeded(d)||l.logResult(d)}}return e},_relaunchCmd:function(){if(o._getCurrent(this._ctx)===this.getId()&&o._getCurrentInstanceId(this._ctx)===this.getCSIdentifier()){if(this._restoreLastCommand)if(o._isNextCmdAllowed()&&o._isNextCmdWaiting()){var e=o._getNextCmd();o._resetNextCmd(),e.begin(!1)}else this._repeatMode?this.begin():"shared"===this._mode&&o._getLast(this._ctx)?o._restoreLast(this._ctx):o._getDefaultCommand(this._ctx)?o._getDefaultCommand(this._ctx).begin(!1):o._setCurrent(null,this._ctx);o._resetNextCmd()}},onBegin:function(e){return i.subscribe({event:this._evtID+"/BEGIN"},e)},onExecute:function(e){return i.subscribe({event:this._evtID+"/EXECUTE"},e)},onPause:function(e){return i.subscribe({event:this._evtID+"/PAUSE"},e)},onResume:function(e){return i.subscribe({event:this._evtID+"/RESUME"},e)},onEnd:function(e){return i.subscribe({event:this._evtID+"/END"},e)},onCanceled:function(e){return i.subscribe({event:this._evtID+"/CANCELED"},e)},askForUndoGroupingAtEnd:function(e){this._endUndoGroupingRequested=!0,this._undoGroupID=e}});return e.namespace("WUX/AFR/Command",m)}),define("DS/ApplicationFrame/CommandStarter",["UWA/Core","DS/Core/Core","UWA/Controls/Abstract","DS/ApplicationFrame/CommandsManager","DS/RuntimeView/RSCManager","DS/RuntimeView/NLSManager","DS/Core/Events","DS/WebappsUtils/WebappsUtils","DS/Controls/TooltipModel"],function(e,t,n,i,o,s,a,r,l){"use strict";return n.extend({defaultOptions:{},init:function(e,t,n){this._parent(e),this._dafrManager=t,this._flyoutContainer=n||null,this._buildView(),this._loadResources(),this._bindEvents()},_buildView:function(){for(var t in this.elements.container=new e.Element("div",{class:"wux-afr-cmdstarter"}),this.options)this.options.hasOwnProperty(t)&&this.elements.container.setAttribute("data-"+t,this.options[t])},_loadResources:function(){var t=this,n=this.elements.container,i=n.getAttribute("data-Command"),a=this._dafrManager.getCommandHeader(i);if(a){var d=a.ResourceFile;o.onResourceLoaded({resourceFile:d},function(){var i,o=t.options.Command;i=t.options.Icon?r.getWebappsBaseUrl()+t.options.Icon:this.getIcon({key:o,size:"Normal"});var d=e.extend(n);"true"===t._dafrManager.options.contextMenu?new e.Element("div",{styles:{backgroundImage:"url("+i+")",backgroundSize:"cover",lineHeight:"32px",display:"inline-block",verticalAlign:"top"}}).inject(d):new e.Element("div",{styles:{width:32,height:32,backgroundImage:"url("+i+")",backgroundSize:"cover",lineHeight:"32px",display:"inline-block",verticalAlign:"top"}}).inject(d);var c=new e.Element("div",{html:o,class:"wux-afr-label"});"true"===t._dafrManager.options.contextMenu&&c.setStyles({display:"inline-block"}),d.appendChild(c),function(e,t,n,i){var o=t.HelpResourceFile,a=e.options.Command,r="top";if(n._privateAfrTmpIsInDropDown&&(r="right",delete n._privateAfrTmpIsInDropDown),n.tooltipInfos=new l({mouseRelativePosition:!1,position:r,allowUnsafeHTMLShortHelp:!0,allowUnsafeHTMLLongHelp:!0}),o){n.tooltipInfos.loadFromHelpRscFile(o,a);var d=o.split("/"),c="i18n!"+d[0];d.splice(0,1),c+="/assets/help/"+d.join("/"),require([c],function(t){if(i.set("html",t[a+".Title"]),e&&e._flyoutContainer){var n="";t[a+".Title"]&&(n=t[a+".Title"]+"+"),null!=e._flyoutContainer.getAttribute("data-containerCommands")&&(n=e._flyoutContainer.getAttribute("data-containerCommands")+n),n&&e._flyoutContainer.setAttribute("data-containerCommands",n)}},function(e){console.error("[i18n] Internationalization file not found",e)})}else{var u=t.ResourceFile;s.onResourceLoaded({resourceFile:u,language:e._dafrManager.options.language},function(){var t=this.getTitle({key:a});t?(n.tooltipInfos.title=t,i.set("html",t)):console.error("[NLS] No NLS title found for "+a),"true"===e._dafrManager.options.contextMenu&&i.setStyles({display:"inline-block"})})}}(t,a,d,c)},{})}},_bindEvents:function(){var e=this,t=this.options.Command,n=this.elements.container,o="";this._dafrManager.options.context&&(o=e._dafrManager.options.context+"/");var s,r="/WUX/AFR/CMD/"+o+t;window.DSWebRecord&&(this.elements.container._record=Object.create(null),this.elements.container._record._commandId=t,o&&o.length>0&&(this.elements.container._record._context=o.substr(0,o.length-1))),n.addEventListener("click",function(t){var n=(" "+t.target.className+" ").replace(/[\n\t]/g," ").indexOf(" wux-ui-state-disabled ")>-1;1!==t.which||n?t.stopPropagation():(a.publish({event:r,data:e}),e._dafrManager._modelEvents.publish({event:"HIDE_DROPDOWN_MENUS"}))}),a.subscribe({event:r+"/BEGIN"},function(){n.addClassName("wux-ui-state-active")}),a.subscribe({event:r+"/RESUME"},function(){n.addClassName("wux-ui-state-active")}),a.subscribe({event:r+"/PAUSE"},function(){n.removeClassName("wux-ui-state-active")}),a.subscribe({event:r+"/END"},function(){n.removeClassName("wux-ui-state-active")}),a.subscribe({event:r+"/ENABLE"},function(){e._enableCommand(t)}),a.subscribe({event:r+"/DISABLE"},function(n){e._disableCommand(t,n)}),(s=""!==o?i.getCommand(t,o.substring(0,o.length-1)):i.getCommand(t,e.options.context))?(void 0===s.isEnabled||s.isEnabled()||e._disableCommand(t),void 0!==s.isRunning&&s.isRunning()&&n.addClassName("wux-ui-state-active")):((s=""!==o?i.getCommandCheckHeader(t,o.substring(0,o.length-1)):i.getCommandCheckHeader(t,e.options.context))&&void 0!==s.getState&&s.getState()&&n.addClassName("wux-ui-state-active"),s&&!s.isEnabled()&&e._disableCommand())},_disableCommand:function(t,n){n=e.extend({tintInGray:!0},n),this.elements.container.addClassName("wux-ui-state-disabled")},_enableCommand:function(e){this.elements.container.removeClassName("wux-ui-state-disabled")}})}),define("DS/ApplicationFrame/CommandFactory",["UWA/Core","DS/Core/Core","DS/ApplicationFrame/CommandsManager","UWA/Class"],function(e,t,n,i){"use strict";function o(e){window.DEBUG_ActionBar_CmdInstantiation&&window.top.performance.mark("b_cmdInstantiation_"+e)}function s(e,t,n){window.DEBUG_ActionBar_CmdInstantiation&&(window.top.performance.mark("e_cmdInstantiation_"+e),window.top.performance.measure(t+"_"+n+"_NewCommandFor"+e,"b_cmdInstantiation_"+e,"e_cmdInstantiation_"+e))}return i.singleton({init:function(){this._parent(this.options)},_createCommandCheckHeader:function(e,t){if(i=n.getCommandCheckHeader(t.ID,t.context))return i;o(t.ID);var i=new e({context:t.context,ID:t.ID,arguments:t.arguments,isEnabled:t.isEnabled});return s(t.ID,t.perfId,t.perfStr),i},_createCommand:function(e,t){if(i=n.getCommand(t.ID,t.context))return i;o(t.ID);var i=new e({context:t.context,ID:t.ID,isEnabled:t.isEnabled,arguments:t.arguments});return s(t.ID,t.perfId,t.perfStr),i}})}),define("DS/ApplicationFrame/CommandContainer",["UWA/Core","DS/Core/Core","UWA/Controls/Abstract","DS/WebappsUtils/WebappsUtils","DS/ApplicationFrame/CommandStarter","DS/Core/PointerEvents","DS/Controls/Popup","DS/RuntimeView/RSCManager","DS/RuntimeView/NLSManager","DS/WebRecordEnabler/Adapter","DS/Core/Events"],function(e,t,n,i,o,s,a,r,l,d,c){"use strict";var u=n.extend({defaultOptions:{},init:function(e,t){this._parent(e),this._dafrManager=t,this._items=[],this._buildView(),this._currentCommandId=""},_buildView:function(){var t=this;for(var n in this.elements.container=new e.Element("div",{class:"wux-afr-cmdContainer"}),this.options)this.options.hasOwnProperty(n)&&this.elements.container.setAttribute("data-"+n.toLowerCase(),this.options[n]);function o(e){(function e(t,n){var i=t;return i?(" "+i.className+" ").replace(/[\n\t]/g," ").indexOf(" "+n+" ")>-1?i:e(i.parentNode,n):void 0})(e.target,"wux-afr-dropdown-popup")||t._dafrManager._modelEvents.publish({event:"HIDE_DROPDOWN_MENUS"})}switch(this.options.RepresentationType){case"AfrActionBarDropDown":if(void 0===this.options.ResourceFile)this.elements.currentCommand=new e.Element("div",{}).inject(this.elements.container),this.elements.dropDownArrow=new e.Element("div",{class:"wux-afr-dropdown-arrow",html:new e.Element("div",{styles:{background:"url("+i.getWebappsBaseUrl()+"Controls/assets/arrow-b.png)",backgroundRepeat:"no-repeat",backgroundSize:"5px",backgroundPosition:"center center",width:8,height:"100%"}})}).inject(this.elements.container);else{this.elements.dropDownArrow=new e.Element("div",{styles:{width:"100%",height:"100%"}}).inject(this.elements.container);var s=new e.Element("div",{styles:{width:"calc(100% - 11px)",height:"100%"}}).inject(this.elements.dropDownArrow),d=(new e.Element("div",{styles:{background:"url("+i.getWebappsBaseUrl()+"Controls/assets/arrow-b.png)",backgroundRepeat:"no-repeat",backgroundSize:"5px",backgroundPosition:"center center",width:11,height:"100%",position:"absolute",right:0,top:0,display:"inline-block",borderRadius:"0 3px 3px 0",boxSizing:"border-box"}}).inject(this.elements.dropDownArrow),this.options.ResourceFile),c=s;r.onResourceLoaded({resourceFile:d},function(){var n,o=t.options.Name;n=t.options.Icon?i.getWebappsBaseUrl()+t.options.Icon:this.getIcon({key:o,size:"Normal"});var s=e.extend(c);new e.Element("div",{styles:{width:32,height:32,backgroundImage:"url("+n+")",backgroundSize:"cover",lineHeight:"32px",display:"inline-block",verticalAlign:"top"}}).inject(s);s.setAttribute("title",o);var a=new e.Element("div",{html:o,class:"wux-afr-label"});s.appendChild(a),l.onResourceLoaded({resourceFile:d,language:t._dafrManager.options.language},function(){var e=this.getTitle({key:o});s.setAttribute("title",e),a.set("html",e)})},{})}this.elements.listOfCommands=new e.Element("ul",{class:"wux-afr-dropdown-menu wux-ui-stack-v"}),this.elements.dropDownArrow.addEventListener("click",function(e){if(e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),t._dafrManager._modelEvents.publish({event:"HIDE_DROPDOWN_MENUS"}),void 0===t.elements.dropDownPopup){var n={target:t.elements.container,position:"top",offset:{x:0,y:0},alignment:"left",constraint:"screen",visibleFlag:!1,overlap:!1,arrowBoxFlag:!1,trigger:""};t.elements.dropDownPopup=new a(n),t.elements.dropDownPopup.getContent().addClassName("wux-afr-dropdown-popup"),window.DSWebRecord&&(t.elements.dropDownPopup.getContent().setAttribute("data-rec-id","flyout"),t.markForRecord(t.elements.dropDownPopup.getContent())),t.elements.dropDownPopup.setBody(t.elements.listOfCommands)}t.elements.dropDownPopup.addEventListener("mouseenter",function(e){var n=t.elements.container.querySelector(".wux-afr-cmdstarter");n&&!n.hasClassName("wux-afr-dropdown-starter-presenter")&&n.addClassName("wux-afr-dropdown-starter-presenter")}),t.elements.dropDownPopup.addEventListener("mouseleave",function(e){var n=t.elements.container.querySelector(".wux-afr-cmdstarter");n&&n.hasClassName("wux-afr-dropdown-starter-presenter")&&n.removeClassName("wux-afr-dropdown-starter-presenter")}),t.elements.dropDownPopup.show(),t.elements.container.toggleClassName("wux-ui-state-active"),t._dafrManager.getContent().getParent().toggleClassName("wux-ui-state-active")}),t.elements.container.addEventListener("mouseup",function(){t._dafrManager._modelEvents.publish({event:"HIDE_DROPDOWN_MENUS"})}),t.elements.container.addEventListener("touchend",function(){t._dafrManager._modelEvents.publish({event:"HIDE_DROPDOWN_MENUS"})}),window.addEventListener("mousedown",o,!0),window.addEventListener("touchend",o,!0),this._dafrManager._modelEvents.subscribe({event:"HIDE_DROPDOWN_MENUS"},function(){if(t.elements.container.removeClassName("wux-ui-state-active"),t.elements.dropDownPopup){t.elements.dropDownPopup.removeEventListener("mouseenter"),t.elements.dropDownPopup.removeEventListener("mouseleave");var e=t.elements.container.querySelector(".wux-afr-cmdstarter");e&&e.removeClassName("wux-afr-dropdown-starter-presenter"),t.elements.dropDownPopup.hide()}t._dafrManager.getContent().getParent()&&t._dafrManager.getContent().getParent().removeClassName("wux-ui-state-active")});break;case"AfrActionBarSection":this._dafrManager._registerSection(this)>1&&this.elements.container.hide();break;case"AfrActionBarFixedSection":this._dafrManager._registerFixedSection(this)}},appendChildCusto:function(t){var n=this;switch(this.options.RepresentationType){case"AfrActionBarDropDown":if(t){var i=t.getContent();i&&i.tooltipInfos?i.tooltipInfos.position="right":i._privateAfrTmpIsInDropDown=!0}var o=new e.Element("li",{html:t,"data-index":this._items.length,styles:{display:"block",userSelect:"none"}});o.addEvent(s.POINTERUP,function(e){e.stopPropagation(),e.stopImmediatePropagation()}),o.addEvent("click",function(e){n.selectCommand(t)});var a="";this._dafrManager.options.context&&(a=n._dafrManager.options.context+"/");var r="/WUX/AFR/CMD/"+a+t.options.Command+"/BEGIN";c.subscribe({event:r},function(){n.selectCommand(t)}),this.elements.listOfCommands.appendChild(o),0===this._items.length&&this.selectCommand(t);break;default:t.tagName?this.elements.container.appendChild(t):this.elements.container.appendChild(t.getContent())}this._items.push(t)},selectCommand:function(e){if(void 0!==this.elements.currentCommand&&(this.options.Icon&&(e.options.Icon=this.options.Icon),this._currentCommandId!==e.options.Name)){var t=new o(e.options,e._dafrManager);this.elements.currentCommand.setHTML(t),this._currentCommandId=e.options.Name}}});return window.DSWebRecord&&d.register(u,"DS/CommandRecord/ActionBarRecord"),u}),define("DS/ApplicationFrame/Json2Html",["UWA/Core","DS/Core/Core","UWA/Controls/Abstract","DS/RuntimeView/RSCManager","DS/RuntimeView/NLSManager","DS/WebappsUtils/WebappsUtils","DS/Core/ModelEvents","DS/Utilities/Xml","DS/ApplicationFrame/CommandContainer","DS/ApplicationFrame/CommandStarter","DS/ApplicationFrame/CommandFactory"],function(e,t,n,i,o,s,a,r,l,d,c){"use strict";var u=!1;function m(e){return e["@tag"]}function h(e){return e["@children"]}function p(e,t){if(e&&e["@attributes"])return e["@attributes"][t]}function _(e){return e?e["@attributes"]:{}}var f={CATCmdStarter:d,CATCmdContainer:l};return n.extend({defaultOptions:{xml:null,module:null,directory:"assets/afr/",fileExtension:".xml",onComplete:null,onFailure:null,showLabels:!1,_createView:!0},init:function(e){this._parent(e),this._perfId=e.perfId,this._perfStr=e.perfStr,this._buildView();var t=this;setTimeout(function(){t._initialize(e)},1)},_initialize:function(t){void 0===t.actionBar&&void 0!==this.options.actionBar&&!0===this.options.actionBar&&(t.actionBar=!0),this.options=e.extend({merge:!0,_createView:!0},t),this._isAlreadyProcessed=!1,this._modelEvents=new a,this._currentSectionID=0,this._listOfSections=[],this._listOfFixedSections=[];var n=window.location.href.split("?")[0].split("/");this._currentModule=n[n.length-2],this._host=s.getWebappsBaseUrl();var i=this;i.backMAB=t.backMAB;var o=s.getWebappsBaseUrl()+(this.options.module||this._currentModule)+"/"+this.options.directory+this.options.xml;this._loadXML(o,function(e){i._model=e,i._processAFR(),i.goToNthSection(0)})},merge:function(e){var t=this;this._isAlreadyProcessed=!1,this._modelEvents=new a,this._currentSectionID=0,this._listOfSections=[],this._listOfFixedSections=[],this.getCommandHeadersList()["@children"]=this.getCommandHeaders().concat(e.getCommandHeaders());var n=h(this.getWorkbench());h(e.getWorkbench()).forEach(function(e){var i,o=p(e,"Name");n.forEach(function(t){o===p(t,"Name")&&(u&&(console.warn("---\x3e found already defined section",o),console.log("-----\x3e",t["@children"])),t["@children"]=h(t).concat(h(e)),i=!0)}),i||(u&&console.warn("---\x3e new section",o),t.getWorkbench()["@children"].push(e))}),this._processAFR()},getModel:function(){return this._model},_loadXML:function(t,n){var i=this,o="Ajax";if("../"!==s.getWebappsBaseUrl()&&(o="Data"),window.DEBUG_ActionBar_Xml&&window.top.performance.mark("b_xml"),"string"==typeof this.options.xml)e[o].request(t,{isAsync:!0,onComplete:function(o){var s;if(window.DEBUG_ActionBar_Xml){window.top.performance.mark("e_xml");var a=t.split("/");s=a[a.length-1],window.top.performance.measure(i._perfId+"_"+i._perfStr+"_XMLRequestFor"+s,"b_xml","e_xml"),window.top.performance.mark("b_xmlParse")}o.replace(/<!--[\s\S]*?-->/g,"");var r=e.Utils.loadXml(o),l=i._convertXml2Json(r);window.DEBUG_ActionBar_Xml&&(window.top.performance.mark("e_xmlParse"),window.top.performance.measure(i._perfId+"_"+i._perfStr+"_XMLToJsonOf"+s,"b_xmlParse","e_xmlParse")),n.call(i,l),i._modelEvents.publish({event:"COMPLETE"})},onFailure:function(e){console.error("[!]\tError loading file:"+t),i.options.onFailure&&i.options.onFailure.call(i,e)}});else{var a=i._convertXml2Json(this.options.xml);n.call(i,a)}},onReady:function(e){return this._modelEvents.subscribe({event:"COMPLETE"},e)},_convertXml2Json:function(e){if(!this._isAlreadyProcessed){this._isAlreadyProcessed=!0;var t=r.toJson(e);return u&&(console.log("AFR XML model",e),console.log("AFR JSON model",t)),t}},_searchTag:function(e,t){var n;return e["@children"].some(function(e,i,o){return m(e)===t&&(n=e,!0)}),n},nextSection:function(){this._currentSectionID++,this.goToNthSection(this._currentSectionID)},goToNthSection:function(e){this.getSections().forEach(function(t,n){n!==e?t.hide():t.show()}),this._currentSectionID=e,this._modelEvents.publish({event:"HIDE_DROPDOWN_MENUS"});var t=this.getNthSection(e);t&&this._modelEvents.publish({context:this,event:"CHANGE_SECTION",data:{sectionID:e,section:t}})},previousSection:function(){this._currentSectionID--,this.goToNthSection(this._currentSectionID)},getStyles:function(){return this.getModel()["@children"][0]},getTemplates:function(){return this.getStyles()["@children"]},getWorkbench:function(){var e,t=this;return this.getTemplates().some(function(n){var i=t._searchTag(n,"CATCmdWorkbench");if(i)return e=i,!0}),e.backCB=t.backMAB,e},getCommandHeadersList:function(){var e,t=this;return this.getTemplates().some(function(n){var i=t._searchTag(n,"CATCmdHeadersList");if(i)return e=i,!0}),e},getCommandHeader:function(e){var t;return h(this.getCommandHeadersList()).forEach(function(n){t||p(n,"ID")===e&&(t=n)}),_(t)},getCommandHeaders:function(){var e=[];return this.getCommandHeadersList()["@children"].forEach(function(t){m(t)&&e.push(t)}),e},_buildView:function(){if(this.elements.container=new e.Element("div",{class:"wux-afr wux-afr-view"}),void 0!==this.options.actionBar&&!0===this.options.actionBar){this.elements.scrollButtons=Object.create(null),this.elements.scrollButtons.leftButton=new e.Element("div",{class:"wux-afr-buttons wux-afr-button-left"}),this.elements.scrollButtons.rightButton=new e.Element("div",{class:"wux-afr-buttons wux-afr-button-right"}),this.elements.borderContainer=new e.Element("div",{class:"wux-afr-border-container"});var t=this;this.elements.scrollButtons.leftButton.inject(this.elements.container),this.elements.scrollButtons.leftButton.addEvent("click",function(){var e=t.elements.borderContainer,n=e.children[0],i=0;n&&((i=n.scrollLeft-(e.clientWidth-146))<0&&(i=0),n.scrollLeft=i)}),this.elements.borderContainer.inject(this.elements.container),window.borderContainer=this.elements.borderContainer,this.elements.scrollButtons.rightButton.inject(this.elements.container),this.elements.scrollButtons.rightButton.addEvent("click",function(){var e=t.elements.borderContainer,n=e.children[0],i=0;n&&((i=n.scrollLeft+(e.clientWidth-146))>n.width&&(i=n.width),n.scrollLeft=i)})}},showLabels:function(e){this.elements.container.addClassName("wux-afr-state-labels"),this.elements.container.removeClassName("wux-afr-state-nolabels"),!1!==e&&window.widget&&widget.setValue("webafr_IsLabelShown",!0),this._modelEvents.publish({event:"SHOW_LABELS"})},hideLabels:function(e){this.elements.container.removeClassName("wux-afr-state-labels"),this.elements.container.addClassName("wux-afr-state-nolabels"),!1!==e&&window.widget&&widget.setValue("webafr_IsLabelShown",!1),this._modelEvents.publish({event:"HIDE_LABELS"})},onShowLabels:function(e){return this._modelEvents.subscribe({event:"SHOW_LABELS"},e)},onHideLabels:function(e){return this._modelEvents.subscribe({event:"HIDE_LABELS"},e)},getLabelsVisibility:function(){return!this.elements.container.hasClassName("wux-afr-state-nolabels")},toggleLabels:function(){this.elements.container.toggleClassName("wux-afr-state-nolabels")},_processAFR:function(){this._processCommandHeaders();var e=this.getWorkbench(!0);e.backCB=this.backMAB,void 0!==this.options.actionBar&&!0===this.options.actionBar?this._processCommands(null,e,this.elements.borderContainer):this._processCommands(null,e,this.elements.container);var t=null;window.widget&&window.widget.getValue&&null==(t=window.widget.getValue("webafr_IsLabelShown"))&&(t=null),null===t&&this.options.showLabels||null!==t&&t?this.showLabels(!1):this.hideLabels(!1)},_postProcessAFR:function(){var e=this;e._listOfSections.length&&(e._listOfFixedSections.forEach(function(t){t.getContent().inject(e.getNthSection(0).getContent(),"top")}),this._modelEvents.subscribe({event:"CHANGE_SECTION"},function(t){e._listOfFixedSections.forEach(function(e){e.getContent().inject(t.section.getContent(),"top")})}))},_getCommandHeaderArgs:function(e){var t=[],n=h(e);return n&&n.forEach(function(e){switch(m(e)){case"CATAfrCommandHeaderArgs":var n=h(e);n&&n.forEach(function(e){switch(m(e)){case"CATCommandHeaderArg":t.push(_(e))}})}}),t},_processCommandHeaders:function(){var e=this,t=function(t){e.getCommandHeaders().length===t&&e.options.onComplete&&(window.DEBUG_ActionBar_ProcessCommandHeader&&(window.top.performance.mark("e_processCommandHeaders"),window.top.performance.measure(e._perfId+"_"+e._perfStr+"_ProcessCommandHeader","b_processCommandHeaders","e_processCommandHeaders")),e._postProcessAFR(),e.options.onComplete.call(e))},n=0;window.DEBUG_ActionBar_ProcessCommandHeader&&window.top.performance.mark("b_processCommandHeaders"),this.getCommandHeaders().forEach(function(s){var a=p(s,"ClassName"),r=p(s,"ID"),l=p(s,"Behavior"),d=p(s,"Available"),u=!0;"0"===d&&(u=!1);var m=p(s,"ResourceFile");if(r){i.loadResource({resourceFile:m}),o.loadResource({resourceFile:m});var h=e._getCommandHeaderArgs(s);if(a){var _=a.replace(/\./g,"/");window.DEBUG_ActionBar_Require&&n<=0&&window.top.performance.mark("b_require_"+_),require([_],function(i){window.DEBUG_ActionBar_Require&&(window.top.performance.mark("e_require_"+_),window.top.performance.measure(e._perfId+"_"+e._perfStr+"_RequireFor"+_,"b_require_"+_,"e_require_"+_)),n++,i?"CATAfrHeaderCheck"===l?c._createCommandCheckHeader(i,{context:e.options.context,ID:r,isEnabled:u,arguments:h,perfId:e._perfId,perfStr:e._perfStr}):c._createCommand(i,{context:e.options.context,ID:r,isEnabled:u,arguments:h,perfId:e._perfId,perfStr:e._perfStr}):console.warn("[DAFR]","The module",_,"has been loaded, but the returned object is undefined. Please check if in this module, there is an object returned."),t(n)},function(i){window.DEBUG_ActionBar_Require&&(window.top.performance.mark("e_require_"+_),window.top.performance.measure(e._perfId+"_"+e._perfStr+"_RequireFor"+_,"b_require_"+_,"e_require_"+_)),t(++n)})}}})},_registerSection:function(e){return this._listOfSections.push(e)},_registerFixedSection:function(e){this._listOfFixedSections.push(e)},_processCommands:function(t,n,i,s){if(n){void 0===s&&(s=0);var a=this,r=a.options._createView?function(t){if(t){var n,r,l,d=m(t),c=_(t);if(function(e,t,n,i){for(var o="",s=0;s<e;s++)o+="    ";o+="|--",u&&console.log(o,t,n,i)}(s,d,c),f[d]?(n=i&&i.elements&&i.elements.container&&"AfrActionBarDropDown"==i.elements.container.getAttribute("data-representationtype")?new f[d](c,a,i.elements.container):new f[d](c,a),a.options.actionBar||t["@attributes"]&&"AfrActionBarSection"!==t["@attributes"].RepresentationType&&(r=new f[d](c,a))):(l=d?d.replace("CATC","c"):"actionBar",n=new e.Element("div",{class:"wux-afr-"+l,styles:{display:"inline-block"}}),a.options.actionBar||(r=new e.Element("div",{class:"wux-afr-"+l,styles:{display:"inline-block"}}))),i.appendChildCusto){if(i.appendChildCusto(n),i.elements&&i.elements.container)if(i.elements.container.getAttribute("class").includes("wux-afr-cmdContainer")&&"AfrActionBarDropDown"==i.elements.container.getAttribute("data-representationtype")&&"wux-afr-cmdstarter"==n.getContent().getAttribute("class")){var h=n.getContent().getAttribute("data-command");if(h){var p=a.getCommandHeader(h);if(p){var v=p.ResourceFile,g=null;v&&o.onResourceLoaded({resourceFile:v},function(){var e;(g=this.getTitle({key:h}))&&(e=g+"+"),null!=i.elements.container.getAttribute("data-containerCommands")&&(e=i.elements.container.getAttribute("data-containerCommands")+e),e&&i.elements.container.setAttribute("data-containerCommands",e)})}}}else if(i.elements.container.getAttribute("class").includes("wux-afr-cmdContainer")&&"AfrActionBarSection"==i.elements.container.getAttribute("data-representationtype")){var C=i.elements.container.getAttribute("data-name"),b=(v=i.elements.container.getAttribute("data-resourcefile"),null);v&&C?o.onResourceLoaded({resourceFile:v},function(){(b=this.getTitle({key:C}))?i.elements.container.setAttribute("data-sectionTitle",b):i.elements.container.setAttribute("data-sectionTitle",C)}):C&&i.elements.container.setAttribute("data-sectionTitle",C)}}else n.tagName?i.appendChild(n):i.appendChild(n.getContent());return t["@view"]=n,a.options.actionBar||t["@attributes"]&&"AfrActionBarSection"!==t["@attributes"].RepresentationType&&(t["@viewMAB"]=r),n}return console.log("Something is wrong"),null}(n):null;n["@children"]&&(s++,n["@children"].forEach(function(e){a._processCommands.call(a,n,e,r,s)}))}else console.log("Something is wrong")},getNumberOfSections:function(){return void 0===this._listOfSections?0:this._listOfSections.length},getSections:function(){return this._listOfSections},getNthSection:function(e){return this._listOfSections[e]},getCurrentSection:function(){return this.getNthSection(this._currentSectionID)},getSectionIDByName:function(e){var t;return this.getSections().forEach(function(n,i){n.options.Name===e&&(t=i)}),t},getSectionID:function(e){var t;return this.getSections().forEach(function(n,i){n.options.Name===e.options.Name&&(t=i)}),t}})}),define("DS/ApplicationFrame/PlayerView",["UWA/Core","UWA/Controls/Abstract","DS/ApplicationFrame/PlayerStyle","DS/ApplicationFrame/PlayerElements","DS/WebappsUtils/WebappsUtils","DS/RuntimeView/NLSManager","DS/Controls/Gauge","DS/Controls/Button","DS/Controls/Slider","DS/Controls/Abstract","DS/Controls/Popup"],function(e,t,n,i,o,s,a,r,l,d,c){"use strict";var u=d.inherit({name:"playerEditor",publishedProperties:{text:{defaultValue:"",type:String},textTotal:{defaultValue:"",type:String},editable:{defaultValue:!1,type:Boolean},showTotal:{defaultValue:!1,type:Boolean}},_preBuildView:function(){var t=this;this.elements.container=new e.Element("div",{class:"wux-controls-player-editor-ctn",style:{display:"inline-block"}}),this.elements.editor=new e.Element("input",{class:"wux-controls-player-editor",events:{onchange:function(e){var n=document.createEvent("Event");n.initEvent("editorchange",!0,!1),n.dsModel=t,n.textValue=t.elements.editor.getAttribute("text"),t.elements.container.dispatchEvent(n)},click:function(e){e.stopPropagation()}}}),this.elements.editor.setAttribute("type","text"),this.elements.editor.setAttribute("value","00:00:00"),this.elements.editor.inject(this.elements.container),this.elements.playerEditor=this.elements.container,this._parent()},_applyText:function(e){this.elements.editor.setAttribute("value",this.text)},_applyTextTotal:function(e){this.elements.totalLabel&&this.elements.totalLabel.setText(this.totalText)},_applyProperties:function(t){this.editable||this.elements.editor.setAttribute("readonly","readonly"),this.showTotal&&(this.elements.totalLabel||(this.elements.totalLabel=new e.Element("div",{class:"wux-controls-player-total-label",styles:{},html:this.textTotal}).inject(this.getContent())))},handleEvents:function(){}}),m=d.inherit({name:"playerButton",publishedProperties:{label:{defaultValue:"",type:String},dataName:{defaultValue:"",type:String},icon:{defaultValue:"",type:String}},_preBuildView:function(){this.elements.container=new e.Element("div",{class:"wux-afr-cmdstarter wux-controls-player-button"}),this.elements.playerButton=this.elements.container,this._parent()},_applyProperties:function(t){this._parent(t),(this.icon||""==this.icon)&&(this.elements.icon?this.elements.icon.setStyle("background","url("+this.icon+")"):(this.elements.icon=new e.Element("div",{styles:{width:32,height:32,backgroundImage:this.icon,backgroundSize:"cover",lineHeight:"32px",display:"inline-block",verticalAlign:"top"}}),this.elements.icon.inject(this.getContent()))),(this.label||""==this.label)&&(this.elements.label?this.elements.label.setText(this.label):(this.elements.label=new e.Element("div",{html:this.label,class:"wux-afr-label"}),this.elements.label.inject(this.getContent())),this.getContent().setAttribute("title",this.label)),this.dataName&&this.getContent().setAttribute("data-name",this.dataName.toLowerCase())}});return t.extend({init:function(e){this._model=e,this._callbacks=e.callbacks,null==this._callbacks&&(this._callbacks={}),this._parent(),this._lines=1,this._secondaryLevel=0,this._buildView(),this._respondToActions(this._model.state)},_buildView:function(){this.elements.container=new e.Element("div",{class:"wux-controls-playerview "}),this.elements.leftOrBottom=new e.Element("div",{class:"wux-controls-player-left-or-bottom-ctn "}).inject(this.elements.container),this.elements.rightFixedContainer=new e.Element("div",{class:"wux-controls-player-right-ctn"}).inject(this.elements.container),this.elements.extensibleContainer=new e.Element("div",{class:"wux-controls-player-extensible-ctn "}).inject(this.elements.container),this._indexesAndViews={},this._maxSecondaryLevel=0;var t=!1;this._noSlider=!0;for(var n=this._model.elements,o=0;o<n.length;o++){var s=n[o],a=this.elements.leftOrBottom;s.group===i.SLIDER?(this._noSlider=!1,a=this.elements.extensibleContainer):t&&(a=this.elements.rightFixedContainer),s.topLine&&(t=!0);var r=this._createElement(s,a);s.hiddenByDefault&&this._setVisibleView(r,!1),this._indexesAndViews[s.id]={index:o,view:r},this._maxSecondaryLevel=Math.max(this._maxSecondaryLevel,s.secondary)}this._createBurgerMenu().inject(this.elements.leftOrBottom);this.elements.exitButton=this._createPlayerButton("exit",!1),this._noSlider?this.elements.exitButton.inject(this.elements.leftOrBottom):this.elements.exitButton.inject(this.elements.rightFixedContainer),this.elements.container.setAttribute("data-player-style",this._model.name)},_createElement:function(e,t){switch(e.group){case i.SLIDER:return this.elements.slider=this._createSlider(e.id),this.elements.slider.inject(t),this.elements.slider;case i.EDITOR:var n=this._model.formatterLabel(1);this.elements.playerEditor=new u({editable:this._model.editableLabel,showTotal:this._model.useTotal,textTotal:n});var o=e.id,s=this;return this.elements.playerEditor.addEventListener("editorchange",function(e){s._publish(o,"editorchange")}),this.elements.playerEditor.inject(t),this.elements.playerEditor;default:o=e.id;return this._createPlayerButton(o,e.checkMode).inject(t)}},_createEditor:function(t,n){var i=this,o=new e.Element("input",{class:"wux-controls-player-editor",events:{focusout:function(e){i._publish(t,"editorchange")},click:function(e){e.stopPropagation()}}});return o.setAttribute("type","text"),o.setAttribute("value","00:00:00"),n||o.setAttribute("readonly","readonly"),o},_createSlider:function(e){var t=100*this._model.progress,n=new l({value:t,minValue:0,maxValue:100,stepValue:1}),i=this;return n.getContent().addEventListener("change",function(t){i._model.progress=n.value/100;var o=i._model.formatterLabel(i._model.progress);null!=i.elements.playerEditor&&(i.elements.playerEditor.text=o),i._publish(e,"change")}),n},_createPlayerButton:function(e,t){var n=this,i=e.substring(0,1).toUpperCase()+e.substring(1,e.length),a="url("+o.getWebappsBaseUrl()+"Controls/assets/I_CompassPlayer"+i+".png)",r=new m({dataName:e,icon:a}),l=i+"Button.Title";r.label=i;return s.loadResource({resourceFile:"Controls/DSPlayer"}),s.onResourceLoaded({resourceFile:"Controls/DSPlayer",language:n._model.language},function(){var e=this.getTitle({key:l});r.label=e}),r.addEventListener("click",function(){n._respondToActions(e),n._publish(e,e)}),r},getButtonWidth:function(){return Math.max(this.elements.exitButton.getContent().getSize().width,40)+4},_createBurgerMenu:function(){this.elements.burgerButton=this._createPlayerButton("hamburger",!1,void 0);var t=new e.Element("div",{class:"wux-controls-player-hbg-menu",styles:{}});return this.elements.burgerMenuTop=new e.Element("div",{styles:{}}).inject(t),this.elements.burgerMenuBottom=new e.Element("div",{styles:{}}).inject(t),this.elements.popupBurgerMenu=new c({target:this.elements.burgerButton,position:"top",alignment:"center",trigger:"click"}),this.elements.popupBurgerMenu.setBody(t),this._setVisibleView(this.elements.burgerButton,!1),this.elements.burgerButton},_publish:function(e,t){var n=this,i=n._callbacks[e];if(null!=i){var o=null,s=n._model.progress;n.elements.editor&&(o=n.elements.editor.text),i({context:n,event:t,data:{eventId:t,source:n,textValue:o,value:s}})}},respondToWidthChange:function(){this.elements.popupBurgerMenu.visibleFlag=!1;var e=this.getButtonWidth();if(0==this._secondaryLevel)if(1==this._lines){var t=this.elements.container.getSize(),n=this.elements.extensibleContainer.getSize();null!=this._model.minimalSliderWidth&&(n.width<this._model.minimalSliderWidth||t.height>e)&&(this._lines=2,!0,this.elements.container.addClassName("two-lines"),this.elements.leftOrBottom.remove(),this.elements.leftOrBottom.inject(this.elements.container),this.elements.exitButton.getContent().remove(),this.elements.exitButton.inject(this.elements.leftOrBottom))}else{n=this.elements.extensibleContainer.getSize();null!=this._model.maximalSliderWidth&&n.width>this._model.maximalSliderWidth&&(this._lines=1,!0,this.elements.container.removeClassName("two-lines"),this.elements.rightFixedContainer.remove(),this.elements.extensibleContainer.remove(),this.elements.rightFixedContainer.inject(this.elements.container),this.elements.extensibleContainer.inject(this.elements.container),this._noSlider||(this.elements.exitButton.getContent().remove(),this.elements.exitButton.inject(this.elements.rightFixedContainer)))}t=this.elements.container.getSize();if(this.elements.exitButton.getContent().getParent()==this.elements.leftOrBottom){var i=this._getVisibleItems(!1).length+1;this._secondaryLevel>0&&i++;for(var o=i*e,s=t.width-o,a=!1;s<e&&this._secondaryLevel<this._maxSecondaryLevel;){a=!0,this._secondaryLevel++;for(var r=this._model.elements,l=0;l<r.length;l++){if((c=r[l]).secondary===this._secondaryLevel)(d=this._indexesAndViews[c.id].view).remove(),o=--i*e,c.secondaryPosition&&"top"!=c.secondaryPosition?"bottom"==c.secondaryPosition&&d.inject(this.elements.burgerMenuBottom):d.inject(this.elements.burgerMenuTop)}this._secondaryLevel>0&&this._setVisibleView(this.elements.burgerButton,!0),s=t.width-o}if(!a&&s>2*e&&this._secondaryLevel>0){for(r=this._model.elements,l=0;l<r.length;l++){var d,c=r[l],u=this.elements.leftOrBottom;if(c.topLine&&(u=this.elements.rightFixedContainer),c.secondary===this._secondaryLevel)if((d=this._indexesAndViews[c.id].view).remove(),c.topLine)d.inject(u);else if(l>0){var m=this._indexesAndViews[r[l-1].id].view;d.getContent().inject(m.getContent(),"after")}else d.getContent().inject(u,"top")}this._secondaryLevel--,0==this._secondaryLevel&&this._setVisibleView(this.elements.burgerButton,!1)}}},_getVisibleItems:function(e){for(var t=[],n=this._model.elements,i=0;i<n.length;i++){var o=n[i],s=this._indexesAndViews[o.id].view;this._isVisibleView(s)&&o.topLine==e&&(0==o.secondary||o.secondary>this._secondaryLevel)&&t.push(o)}return t},_getView:function(e){return this._indexesAndViews[e].view},updateState:function(){this._respondToActions(this._model.state),null!=this.elements.slider&&(this.elements.slider.value=100*this._model.progress),this.elements.playerEditor&&(this.elements.playerEditor.text=this._model.formatterLabel(this._model.progress),this.elements.playerEditor.totalText=this._model.formatterLabel(1))},_respondToActions:function(e){if("hamburger"!=e){var t=this._model.elements;if(this._previousState!==e){if(this._previousState)if(t[this._indexesAndViews[this._previousState].index])this._indexesAndViews[this._previousState].view.getContent().removeClassName("active-action");var n=this._indexesAndViews[e];if(null!=n){this._model.state=e;var i=t[n.index];if(null==i)throw"the state "+e+" do not exist in the index";for(var o=i.visibleOnActive,s=0;null!=o&&s<o.length;s++){if(l=this._indexesAndViews[o[s]]){var a=l.view;if(null==a)throw"the view identified by "+o[s]+" do not exist in the index";this._setVisibleView(a,!0)}}var r=i.hideOnActive;for(s=0;null!=r&&s<r.length;s++){var l;if(l=this._indexesAndViews[r[s]]){var d=l.view;if(null==d)throw"the view identified by "+r[s]+" do not exist in the index";this._setVisibleView(d,!1)}}if(i.checkMode)n.view.getContent().addClassName("active-action");this._previousState=e}}}},_setVisibleView:function(e,t){t?e.getContent().removeClassName("view-hide"):e.getContent().addClassName("view-hide")},_isVisibleView:function(e){return"none"!=(e?e.getContent().getStyle("display"):"none")}})}),define("DS/ApplicationFrame/ContextualMenu",["UWA/Core","UWA/Controls/Abstract","DS/ApplicationFrame/Json2Html","DS/ApplicationFrame/XMLUtilities","DS/Selection/CSOManager","DS/ApplicationFrame/FrameWindowsManager","DS/Menu/Menu","DS/Core/Events","DS/RuntimeView/RSCManager","DS/RuntimeView/NLSManager","DS/ApplicationFrame/CommandsManager"],function(e,t,n,i,o,s,a,r,l,d,c){"use strict";return t.singleton({defaultOptions:{cmdList:null,workbenchName:null,module:null,cmdPrefix:null,fileName:null,subscribersOptions:[],viewerFrame:null,uiFrame:null,Xposition:null,Yposition:null,samePosition:!1,underBar:!1},init:function(t){var n=this;n._parent(t),t=n.options,n.elements.container=new e.Element("div",{class:"wux-afr-contextual-menu"}),n._isShown=!1,n._precPosition=void 0},_adjustPosition:function(e){if(!(null===e.frameWindow&&void 0===e.frameWindow||null===e.menu&&void 0===e.menu)){var t,n={x:0,y:0,XMax:0};null!==e.viewerFrame&&void 0!==e.viewerFrame&&(n.x=e.viewerFrame.getBoundingClientRect().left,n.y=e.viewerFrame.getBoundingClientRect().top,n.XMax=e.viewerFrame.getBoundingClientRect().right);var i=e.menuPosAndSize.width,o=e.menuPosAndSize.height,s=e.menuPosAndSize.top,r=e.menuPosAndSize.left,l=e.YExpectedPosition,d=e.XExpectedPosition;if(e.frameWindow.getContextualUIManager()&&e.frameWindow.getContextualUIManager().getContextualBar()&&e.frameWindow.getContextualUIManager().getContextualBar()._isShown&&e.frameWindow.getContextualUIManager().getContextualBar().elements){var c={x:e.menuPosAndSize.left,y:e.menuPosAndSize.top},u=e.frameWindow.getContextualUIManager().getContextualBar().elements.container,m=u.getDimensions(),h=u.getPosition(),p=!1;(t=l>s)&&u&&u.setStyles({top:c.y-n.y-5-m.height}),d>r&&u&&(u.setStyles({left:c.x-n.x+i-m.width}),p=!0),c.y-n.y-(m.height+5)<0&&u&&u.setStyles({top:c.y-n.y+o+5}),h.x<c.x-n.x&&!p&&u&&(c.x+i>n.XMax&&void 0!==e.menuContentConfig&&void 0!==e.menuContentConfig.config?(u.setStyles({left:c.x-n.x-m.width}),e.menuContentConfig.config.layout=t?"BottomRight":"TopRight",a.show(e.menuContentConfig.content,e.menuContentConfig.config)):u.setStyles({left:c.x-n.x+i-m.width}))}}},_positionnedRelatedToBar:function(e){var t={x:0,y:0};if((null!==e.frameWindow||void 0!==e.frameWindow)&&(null!==e.menu||void 0!==e.menu)&&e.frameWindow.getContextualUIManager()&&e.frameWindow.getContextualUIManager().getContextualBar()&&e.frameWindow.getContextualUIManager().getContextualBar()._isShown&&e.frameWindow.getContextualUIManager().getContextualBar().elements){var n=e.frameWindow.getContextualUIManager().getContextualBar(),i=n.elements.container,o=i.getDimensions(),s=i.getPosition();i&&(n.setHideWithDistance(!1),t={y:s.y+5+o.height,x:s.x});var r={};r.position=t,r.input="touch";var l,d,c=a.show(e.menuContent,r),u=e.frameWindow.getContent().getDimensions();u.width,u.height;l=t.y>c.top,d=t.x>c.left,l&&i&&(t.y=s.y-5-c.height),d&&i&&(t.x=s.x-c.width+o.width),r.position=t,c=a.show(e.menuContent,r),this._precPosition={x:c.left,y:c.top}}},_manageEvent:function(){var e=this;e._keyDown&&document.removeEventListener("keydown",e._keyDown),e._keyDown=function(t){17===t.keyCode&&(t.preventDefault(),e.hide(),document.removeEventListener("keydown",e._keyDown),e._hideForMultiselection=!0)},document.addEventListener("keydown",e._keyDown),e._keyup&&document.removeEventListener("keyup",e._keyup),e._keyup=function(t){17===t.keyCode&&!e._isShown&&e._hideForMultiselection&&(t.preventDefault(),document.addEventListener("keydown",e._keydown),document.removeEventListener("keyup",e._keyup),e._hideForMultiselection=!1)},document.addEventListener("keyup",e._keyup)},_buildMdlMenu:function(e){var t,n=e.that;for(t=0;t<e.cmdList.length;t++)if(e.cmdList[t].hdr_list&&e.cmdList[t].hdr_list.length<=1){var i=n.getCommandHeader(e.cmdList[t].hdr_list[0]);e.tab.push({param1:i,param2:e.parser,param3:e.context}),e.tabFlat.push({parser:e.parser,context:e.context,name:e.cmdList[t].hdr_list[0],ResourceFile:i.ResourceFile})}else if(e.cmdList[t].hdr_list){e.cmdList[t].hdr_list.length;var o=[];e.tab.push({param2:e.parser,param3:e.context,param4:{name:e.cmdList[t].name,ResourceFile:e.cmdList[t].resourceFile},children:o}),e.tabFlat.push({parser:e.parser,context:e.context,name:e.cmdList[t].name,ResourceFile:e.cmdList[t].resourceFile}),this._buildMdlMenu({tab:o,context:e.context,parser:e.parser,cmdList:e.cmdList[t].hdr_list,that:e.that,tabFlat:e.tabFlat})}else{i=n.getCommandHeader(e.cmdList[t]);e.tab.push({param1:i,param2:e.parser,param3:e.context}),e.tabFlat.push({parser:e.parser,context:e.context,name:e.cmdList[t],ResourceFile:i.ResourceFile})}},_definePropMenuEntryView:function(e){var t={type:"",state:""},n="",i="",o=e.header,s=e.cmdHeader;return"CATAfrHeaderCheck"===o.Behavior?(t.type="CheckItem",s.getState&&!0===s.getState()?i="selected":s.getState&&!1===s.getState()&&(i="unselected")):t.type="PushItem",void 0===s.isEnabled||s.isEnabled()||(n="disabled"),void 0!==s.isRunning&&s.isRunning()?i="selected":void 0!==s.isRunning&&s.isRunning()&&(i="unselected"),t.state=i+(""!==i&&""!==n?"|":"")+n,t},_buildMenuView:function(e){var t,n=this,i=e.tabMdl,o=e.tabFlat,a=e.resourceTab;for(t=0;t<i.length;t++){var l=n.options.context;if(void 0===l&&n.options.subscribersOptions.length>=1&&(l=n.options.subscribersOptions[0].context),i[t].param1){var d=i[t].param1;(function(e){var u,m=n._searchEntryInFlatTab({tabFlat:o,id:e});if(void 0!==m&&((u=c.getCommand(e,i[t].param3))||(u=c.getCommandCheckHeader(e,i[t].param3)),d&&u)){var h=n._definePropMenuEntryView({header:d,cmdHeader:u});a.push({type:h.type,state:h.state,icon:m.icon,title:m.title,action:{callback:function(t){var i="";null!=l&&(i=l+"/"),r.publish({event:"/WUX/AFR/CMD/"+i+e,data:n}),s.getFrameWindow(l).getContextualUIManager().getContextualBar().hide()}}})}})(d.ID)}else if(i[t].param4){i[t].param4.name;var u=n._searchEntryInFlatTab({tabFlat:o,id:i[t].param4.name});if(void 0===u)return;var m=[];n._buildMenuView({tabMdl:i[t].children,tabFlat:o,resourceTab:m}),a.push({type:"PushItem",submenu:m,title:u.title})}}},_searchEntryInFlatTab:function(e){for(var t,n=e.tabFlat,i=e.id,o=0;o<n.length;o++)if(n[o].name===i)return t=n[o];return t},show:function(t){var r=this;if(t&&(this.options=e.extend(e.clone(this.defaultOptions),t)),r.elements.container.empty(),!this._hideForMultiselection){this.options.subscribersOptions.length;var c,u=0,m=o.get()[0],h=!1,p={};p.XmousePosition=r.options.Xposition,p.YmousePosition=r.options.Yposition,p.XmousePositionWithDevPxRatio=r.options.Xposition*window.devicePixelRatio,p.YmousePositionWithDevPxRatio=r.options.Yposition*window.devicePixelRatio;var _=[],f=[],v=function(e){var o=r.options.subscribersOptions[u];if(u<r.options.subscribersOptions.length){var s=o.onContextualMenuReady.call(r,m,p),a=o.context;if(void 0===a&&(a=r.options.context),s&&s.cmdList&&0!==s.cmdList.length){h=!0;new i({cmdList:s.cmdList,workbenchName:o.workbenchName,module:o.module,cmdPrefix:o.cmdPrefix,cmdSuffix:"",onComplete:function(i){var l=!1;0===u&&(l=!0),c=new n({showLabels:!0,context:a,module:o.module,language:t.language,contextMenu:"true",xml:i,merge:l,_createView:!1,onComplete:function(){if(r._buildMdlMenu({tab:f,tabFlat:_,cmdList:s.cmdList,context:a,parser:c,that:this}),o.onCtxMenuPostXmlLoadingCB){o.onCtxMenuPostXmlLoadingCB().then(t=>{0,u++,v(e)})}else 0,u++,v(e)},onFailure:function(t){console.log("[!]\tError loading Contextual menu"),u++,v(e)}})}})}else u++,v(e)}else u===r.options.subscribersOptions.length&&h&&e()};v(function(){var e=0,n=function(t){if(e<_.length)if(_[e]){_[e].parser;var i=!1;l.onResourceLoaded({resourceFile:_[e].ResourceFile},function(){var o=_[e].name;_[e].icon=this.getIcon({key:o,size:"Normal"}),d.onResourceLoaded({resourceFile:_[e].ResourceFile,language:_[e].parser.options.language},function(){if(_[e]){_[e].title=this.getTitle({key:o});var s=r.options.context;void 0===s&&r.options.subscribersOptions.length>=1&&(s=r.options.subscribersOptions[0].context),e++,n(t)}i=!0}),i||(d.loadResource({resourceFile:_[e].ResourceFile,language:"en"}),d.onResourceLoaded({resourceFile:_[e].ResourceFile},function(){_[e].title=this.getTitle({key:o}),e++,i=!0,n(t)}))})}else e++,n(t);else e===_.length&&t()};n(function(){var e=[];r._buildMenuView({tabMdl:f,tabFlat:_,resourceTab:e});var n,i=[];for(n=0;n<e.length;n++)i.push(e[n]);var o={x:0,y:0};null!==r.options.viewerFrame&&void 0!==r.options.viewerFrame&&(o.x=r.options.viewerFrame.getBoundingClientRect().left,o.y=r.options.viewerFrame.getBoundingClientRect().top),r.options.Xposition+=o.x,r.options.Yposition+=o.y;var l={};if(!0!==r.options.underBar){!0!==r.options.samePosition?(l.x=r.options.Xposition,l.y=r.options.Yposition):(l.x=r._precPosition.x,l.y=r._precPosition.y);var d={};d.position=l,d.input="touch",null!==t.eventCallback&&void 0!==t.eventCallback&&null!==t.eventCallback.preShowCallback&&void 0!==t.eventCallback.preShowCallback&&t.eventCallback.preShowCallback(i);var c=a.show(i,d),u=r.options.context;void 0===u&&r.options.subscribersOptions.length>=1&&(u=r.options.subscribersOptions[0].context);var m=s.getFrameWindow(u),h=!0!==r.options.samePosition&&!0!==r.options.underBar,p={frameWindow:m,viewerFrame:r.options.viewerFrame,menuPosAndSize:c,YExpectedPosition:!0===h?r.options.Yposition:r._precPosition.y,XExpectedPosition:!0===h?r.options.Xposition:r._precPosition.x,menuContentConfig:{content:i,config:d}};r._adjustPosition(p),r._precPosition={x:c.left,y:c.top}}else{var v={frameWindow:t.frameWindow,menuContent:i};r._positionnedRelatedToBar(v)}r._isShown=!0,null!==t.eventCallback&&void 0!==t.eventCallback&&null!==t.eventCallback.displayedCallback&&void 0!==t.eventCallback.displayedCallback&&t.eventCallback.displayedCallback(),r._manageEvent()})})}},hide:function(){this.elements.container&&this.elements.container.remove(),a.hide(),this._isShown=!1}})}),define("DS/ApplicationFrame/ContextualBar",["UWA/Core","UWA/Controls/Abstract","DS/ApplicationFrame/XMLUtilities","DS/ApplicationFrame/Json2Html","DS/Selection/CSOManager","DS/ApplicationFrame/FrameWindowsManager","DS/Core/Events","DS/WebRecordEnabler/Adapter","DS/CoreEvents/Events"],function(e,t,n,i,o,s,a,r,l){"use strict";var d=t.singleton({defaultOptions:{cmdList:null,workbenchName:null,module:null,cmdPrefix:null,fileName:null,subscribersOptions:[],viewerFrame:null,uiFrame:null,Xposition:null,Yposition:null,hideWithDistance:!0,Xoffset:45,Yoffset:-45,samePosition:!1,withContextMenu:!1},init:function(t){this._parent(t),this.elements.container=new e.Element("div",{class:"wux-afr-contextual-bar"}),window.DSWebRecord&&(this.elements.container.setAttribute("data-rec-id","ContextualBar"),this.markForRecord(this.elements.container)),this._isShown=!1,this._opacityLocalListener=null,this._opacityListener=null,this._fadeEffect=!0},_adjustPosition:function(e){if(!(null===e.frameWindow&&void 0===e.frameWindow||null===e.bar&&void 0===e.bar)){var t=e.frameWindow.getContent().getDimensions(),n=t.width,i=t.height,o=e.bar.getDimensions(),s=o.width,a=o.height,r=e.bar.getPosition();n<=s+r.x&&e.bar.setStyles({left:n-s}),r.x<=0&&e.bar.setStyles({left:0}),r.y<=0&&e.bar.setStyles({top:0}),i<=a+r.y&&e.bar.setStyles({top:i-a})}},_calculateDistanceFromMouse:function(e){var t=e.posElement,n=e.posMouse,i=e.dim,o=0,s=0;return n.y>=t.y?s=n.y-t.y:n.y<=t.y-i.height&&(s=t.y-i.height-n.y),n.x<=t.x?o=t.x-n.x:n.x>=t.x+i.width&&(o=n.x-(t.x+i.width)),Math.sqrt(o*o+s*s)},_selectedHdrInModel:function(e){void 0!==e&&void 0!==e.elemList&&void 0!==e.selectedHdr&&e.elemList.forEach(function(t){void 0!==t.selectedHdr&&1!==t.hdr_list.length&&e.selectedHdr.push([t.name,t.selectedHdr])})},_getSelectedHdr:function(e){var t,n;if(void 0===e||void 0===e.selectedHdrTab||void 0===e.model)return n;var i=e.containerName,o=0;for(o=0;o<e.selectedHdrTab.length;o++){var s=e.selectedHdrTab[o];if(void 0!==s&&2===s.length&&s[0]===i){t=s[1];break}}if(void 0===t)return n;var a=e.model;if(void 0!==a["@children"]){var r=0;for(r=0;r<a["@children"].length;r++)if(void 0!==a["@children"][r]&&"CATCmdStarter"===a["@children"][r]["@tag"]&&a["@children"][r]["@attributes"].Name===t){n=a["@children"][r];break}}return n},_processSelectedHdr:function(e){var t=this;void 0!==e&&void 0!==e.model&&void 0!==e.selectedHdr&&e.model["@children"][0]["@children"].forEach(function(n){if("CATCmdContainer"===n["@tag"]){var i=t._getSelectedHdr({containerName:n["@attributes"].Name,selectedHdrTab:e.selectedHdr,model:n});if(void 0!==i){var o=i["@view"];n["@view"].selectCommand(o)}}})},setPosition:function(e){this.elements.container.setStyles({top:e.y,left:e.x})},getPosition:function(){if(this._isShown&&this&&this.elements&&this.elements.container){var e={};return e.x=parseFloat(this.elements.container.getStyle("left")),e.y=parseFloat(this.elements.container.getStyle("top"))+this.elements.container.getDimensions().outerHeight,e}},show:function(t){var a=this;if(t&&(a.options=e.extend(e.clone(this.defaultOptions),t)),this._hideForMultiselection)return a.hide(),void(a._clicWhenHideForMultiselection=!0);a.elements.container.setStyles({opacity:1});var r,d=o.get()[0];a.elements.container.empty();this.options.subscribersOptions.length;var c=[],u=0,m=!1,h=!1,p={};p.XmousePosition=a.options.Xposition,p.YmousePosition=a.options.Yposition,p.XmousePositionWithDevPxRatio=a.options.Xposition*window.devicePixelRatio,p.YmousePositionWithDevPxRatio=a.options.Yposition*window.devicePixelRatio,p.withContextMenu=a.options.withContextMenu;var _=function(e){var o=a.options.subscribersOptions[u];if(u<a.options.subscribersOptions.length){var s=o.onContextualBarReady.call(a,d,p),f=o.context;if(void 0===f&&(f=a.options.context),s&&s.cmdList&&0!==s.cmdList.length){s._selectedHdrs=[],h=!0,a._selectedHdrInModel({elemList:s.cmdList,selectedHdr:s._selectedHdrs});new n({cmdList:s.cmdList,workbenchName:o.workbenchName,module:o.module,cmdPrefix:o.cmdPrefix,cmdSuffix:"",onComplete:function(n){0!==u&&m?new i({context:f,module:o.module,merge:!1,xml:n,_createView:!1,onComplete:function(){c.push(this),0,u++,void 0!==s._selectedHdrs&&0!==s._selectedHdrs.length&&a._processSelectedHdr({model:this.getWorkbench(),selectedHdr:s._selectedHdrs}),_(e)}}):((r=new i({context:f,module:o.module,xml:n,backMAB:t.backMAB,onComplete:function(){0,u++,t.ignoreMAB||l.publish({event:"/"+a.options.context+"/WUX/ContextualBar/Show/",data:this.getWorkbench()}),void 0!==s._selectedHdrs&&0!==s._selectedHdrs.length&&a._processSelectedHdr({model:this.getWorkbench(),selectedHdr:s._selectedHdrs}),_(e)},onFailure:function(t){console.log("[!]\tError loading Contextual Bar"),u++,_(e)}})).getContent().setStyles({display:"inline-block"}),a.elements.container.empty(),a.elements.container.addContent(r),m=!0)}})}else u++,_(e)}else u===a.options.subscribersOptions.length&&h&&(a.elements.container.inject(t.uiFrame),!0!==a.options.samePosition&&a.elements.container.setStyles({position:"absolute",top:a.options.Yposition-a.elements.container.getDimensions().outerHeight+a.options.Yoffset,left:a.options.Xposition+a.options.Xoffset}),a._isShown=!0,0!==c.length&&(r.elements.container.empty(),c.forEach(function(e,t){r.merge(e),t<c.length-1&&r.elements.container.empty()})),e())};_(function(){a._fadeEffect=!1!==a.options.hideWithDistance;var e=a.options.context;void 0===e&&a.options.subscribersOptions.length>=1&&(e=a.options.subscribersOptions[0].context);var t={frameWindow:s.getFrameWindow(e),bar:a.elements.container,YmousePosition:a.options.Yposition,XmousePosition:a.options.Xposition};a._adjustPosition(t),a._isShown=!0,a.setHideWithDistance(a._fadeEffect),a._multiselectionStart&&document.removeEventListener("keydown",a._multiselectionStart),a._multiselectionStart=function(e){17===e.keyCode&&a._isShown&&(e.preventDefault(),document.removeEventListener("keydown",a._multiselectionStart),document.addEventListener("keyup",a._multiselectionStop),a.elements.container.setStyles({opacity:0}),a._isShown=!1,a._hideForMultiselection=!0,a._clicWhenHideForMultiselection=!1)},document.addEventListener("keydown",a._multiselectionStart),a._multiselectionStop&&document.removeEventListener("keyup",a._multiselectionStop),a._multiselectionStop=function(e){if(17===e.keyCode&&!a._isShown&&a._hideForMultiselection)if(e.preventDefault(),document.addEventListener("keydown",a._multiselectionStart),document.removeEventListener("keyup",a._multiselectionStop),a._hideForMultiselection=!1,a._clicWhenHideForMultiselection)a.show(a.options);else{if(a.elements.container.setStyles({opacity:1}),a.options.withContextMenu){a.elements.container.setStyles({top:a.options.Yposition-a.elements.container.getDimensions().outerHeight-45,left:a.options.Xposition+45});var t=a.options.context;void 0===t&&a.options.subscribersOptions.length>=1&&(t=a.options.subscribersOptions[0].context);var n={frameWindow:s.getFrameWindow(t),bar:a.elements.container,YmousePosition:a.options.Yposition,XmousePosition:a.options.Xposition};a._adjustPosition(n),a._fadeEffect=!0,a.options.hideWithDistance=!0,a.setHideWithDistance(a._fadeEffect)}a._isShown=!0}},document.addEventListener("keyup",a._multiselectionStop),null!==a.options.eventCallback&&void 0!==a.options.eventCallback&&a.options.eventCallback()})},hide:function(){this.elements.container&&this.elements.container.remove(),this._isShown&&a.publish({event:"/WUX/AFR/ctxBarHidden"}),this._isShown=!1},setHideWithDistance:function(e){var t,n,i,o=this;!0!==e&&!1!==e||(o._fadeEffect=e,o._isOnBar=!1,o._opacityLocalListenerEnter&&o.elements.container.removeEventListener("mouseenter",o._opacityLocalListenerEnter),o._opacityLocalListenerEnter=function(e){o._isOnBar=!0},o._opacityLocalListenerLeave&&o.elements.container.removeEventListener("mouseleave",o._opacityLocalListenerLeave),o._opacityLocalListenerLeave=function(e){o._isOnBar=!1,o.options.Xposition=e.clientX,o.options.Yposition=e.clientY},o._opacityListener&&document.removeEventListener("mousemove",o._opacityListener),o._opacityListener=function(e){if(void 0===t&&(t=o.elements.container.getDimensions()),void 0===n&&(n=o.elements.container.getBoundingClientRect().left),void 0===i&&(i=o.elements.container.getBoundingClientRect().bottom),o._isShown&&o._fadeEffect){var s,a=0,r={posElement:{x:n,y:i},posMouse:{x:e.clientX,y:e.clientY},dim:{height:t.height,width:t.width}};(s=o._calculateDistanceFromMouse(r))>=0&&s<=50||o._isOnBar?a=1:s>50&&s<200?a=1-s/200:(a=0,o.elements.container.hasClassName("wux-ui-state-active")||o.elements.container.remove(),o._isShown=!1),o.elements.container.setStyles({opacity:a})}},!0===e?(o.elements.container.addEventListener("mouseenter",o._opacityLocalListenerEnter),o.elements.container.addEventListener("mouseleave",o._opacityLocalListenerLeave),document.addEventListener("mousemove",o._opacityListener)):o.elements.container.setStyles({opacity:1}))},hideMAB:function(){l.publish({event:"/"+this.options.context+"/WUX/ContextualBar/Hide/"})}});return window.DSWebRecord&&r.register(d,"DS/CommandRecord/ContextualBarRecord"),d}),define("DS/ApplicationFrame/AfrPlayerService",["UWA/Core","DS/Core/Core","UWA/Class","DS/ApplicationFrame/PlayerStyle","DS/ApplicationFrame/PlayerElements","DS/ApplicationFrame/PlayerView"],function(e,t,n,i,o,s){"use strict";var a={SIMPLE:{name:"SIMPLE",state:"pause",progress:0,editableLabel:!1,minimalSliderWidth:240,useTotal:!1,language:null,elements:[{id:"play",group:o.PLAY_PAUSE,visibleOnActive:["pause"],hideOnActive:["play"],topLine:!1,secondary:0},{id:"pause",group:o.PLAY_PAUSE,visibleOnActive:["play"],hideOnActive:["pause"],topLine:!1,secondary:0},{id:"slider",group:o.SLIDER,topLine:!1,secondary:0}]},TOUR3D:{name:"3DTOUR",state:"pause",progress:0,editableLabel:!1,minimalSliderWidth:240,maximalSliderWidth:680,useTotal:!1,language:null,elements:[{id:"back",group:o.BACK_NEXT,topLine:!1,secondary:0},{id:"play",group:o.PLAY_PAUSE,visibleOnActive:["pause"],hideOnActive:["play"],topLine:!1,secondary:0},{id:"pause",group:o.PLAY_PAUSE,visibleOnActive:["play"],hideOnActive:["pause"],topLine:!1,secondary:0},{id:"next",group:o.BACK_NEXT,topLine:!1,secondary:0},{id:"slider",group:o.SLIDER,topLine:!0,secondary:0}]},RUN:{name:"RUN",state:"pause",progress:0,editableLabel:!1,useTotal:!1,language:null,elements:[{id:"stop",group:o.STOP,visibleOnActive:["next"],hideOnActive:["backward","forward"],topLine:!1,secondary:0},{id:"pause",group:o.PLAY_PAUSE,checkMode:!0,visibleOnActive:["next"],hideOnActive:["backward","forward"],topLine:!1,secondary:0},{id:"play",group:o.PLAY_PAUSE,checkMode:!0,visibleOnActive:["backward","forward"],hideOnActive:["next"],topLine:!1,secondary:0},{id:"next",group:o.BACK_NEXT,topLine:!1,secondary:0},{id:"backward",group:o.BACKWARD_FORWARD,topLine:!1,secondary:0},{id:"forward",group:o.BACKWARD_FORWARD,topLine:!1,secondary:0},{id:"options",group:o.OPTIONS,topLine:!1,secondary:3,secondaryPosition:"top"},{id:"stack",group:o.PLAYLIST,topLine:!1,secondary:2,secondaryPosition:"top"},{id:"editor",group:o.EDITOR,topLine:!1,secondary:1,secondaryPosition:"top"}]},SIMULATION:{name:"SIMULATION",state:"pause",progress:0,editableLabel:!1,minimalSliderWidth:320,maximalSliderWidth:800,useTotal:!1,language:null,elements:[{id:"first",group:o.FIRST_LAST,topLine:!1,secondary:1,secondaryPosition:"top"},{id:"back",group:o.BACK_NEXT,topLine:!1,secondary:0},{id:"backward",group:o.BACKWARD_FORWARD,topLine:!1,secondary:0},{id:"playReverse",group:o.PLAYREVERSE,checkMode:!0,visibleOnActive:["backward","forward"],hideOnActive:["back","next"],topLine:!1,secondary:0},{id:"pause",group:o.PLAY_PAUSE,checkMode:!0,visibleOnActive:["back","next"],hideOnActive:["backward","forward"],topLine:!1,secondary:0},{id:"play",group:o.PLAY_PAUSE,checkMode:!0,visibleOnActive:["backward","forward"],hideOnActive:["back","next"],topLine:!1,secondary:0},{id:"next",group:o.BACK_NEXT,topLine:!1,secondary:0},{id:"forward",group:o.BACKWARD_FORWARD,topLine:!1,secondary:0},{id:"last",group:o.FIRST_LAST,topLine:!1,secondary:1,secondaryPosition:"top"},{id:"loopRC",group:o.LOOPRC,visibleOnActive:["loopRCBF"],hideOnActive:["loopRC"],topLine:!1,secondary:0},{id:"loopRCBF",group:o.LOOPRCBF,visibleOnActive:["loopRO"],hideOnActive:["loopRCBF"],topLine:!1,secondary:0,hiddenByDefault:!0},{id:"loopRO",group:o.LOOPRO,visibleOnActive:["loopRC"],hideOnActive:["loopRO"],topLine:!1,secondary:0,secondaryPosition:"top",hiddenByDefault:!0},{id:"options",group:o.OPTIONS,topLine:!1,secondary:3,secondaryPosition:"top"},{id:"stack",group:o.PLAYLIST,topLine:!1,secondary:2,secondaryPosition:"top"},{id:"slider",group:o.SLIDER,topLine:!0,secondary:0},{id:"editor",group:o.EDITOR,topLine:!0,secondary:1,secondaryPosition:"bottom"}]}};return n.singleton({state:{state:"pause",progress:0},actions:{PLAY:"play",PAUSE:"pause",BACK:"back",NEXT:"next",BACKWARD:"backward",FORWARD:"forward",FIRST:"first",LAST:"last",STOP:"stop",PLAYREVERSE:"playReverse",SLIDER_CHANGE:"slider",EDITOR_CHANGE:"editorchange",LOOPRC:"loopRC",LOOPRCBF:"loopRCBF",LOOPRO:"loopRO",PLAYLIST:"playlist",OPTIONS:"options",EXIT:"exit"},defaultOptions:{style:i.TOUR3D,excludedElements:[],useTotal:!0,editableLabel:!0,language:null,callbacks:{},formatterLabel:function(e){return 100*e+" %"}},createPlayer:function(t){if(this._options=e.extend(e.clone(this.defaultOptions),t),this._playerModel=e.clone(a[this._options.style.name]),this._options.excludedElements.length>0)for(var n=this._options.excludedElements.slice(0,this._options.excludedElements.length),i=this._playerModel.elements,o=0;o<i.length;){var s=i[o];n.indexOf(s.group)>=0?i.splice(o,1):o++}this._playerModel.useTotal=this._options.useTotal,this._playerModel.editableLabel=this._options.editableLabel,this._playerModel.language=this._options.language,this._playerModel.callbacks=e.clone(this._options.callbacks),this._playerModel.formatterLabel=this._options.formatterLabel;var r=this;this._playerModel.callbacks.exit=function(e){r.hidePlayer(),r._options.callbacks&&r._options.callbacks.exit&&r._options.callbacks.exit(e)},this._state=e.clone(this.state)},showPlayer:function(){this._playerModel&&(this._playerView||(this._playerView=new s(this._playerModel)),this._playerContainer&&void 0!==this._playerContainer.insertPlayer&&this._playerContainer.insertPlayer(this._playerView))},hidePlayer:function(){this._playerView&&(this._playerContainer&&void 0!==this._playerContainer.removePlayer&&this._playerContainer.removePlayer(this._playerView),this._playerView=null)},getState:function(){return this._state},setState:function(t){for(var n in this._state=e.extend(e.clone(this.state),t),this.state)this._state.hasOwnProperty(n)&&(this._playerModel[n]=this._state[n]);this._playerView&&this._playerView.updateState()},registerPlayerContainer:function(t){this._playerContainer&&t&&!e.debug||(this._playerContainer=t)}})}),define("DS/ApplicationFrame/ContextualUIManager",["UWA/Core","UWA/Class","DS/ApplicationFrame/ContextualBar","DS/Selection/CSOManager","DS/ApplicationFrame/ContextualMenu","DS/Core/Events","DS/Core/PointerEvents","DS/WebRecordEnabler/Adapter"],function(e,t,n,i,o,s,a,r){"use strict";return t.extend({init:function(){this._parent()}}).extend({defaultOptions:{onContextualBarReady:function(e){return null},onContextualMenuReady:function(e){return null},frameWindow:void 0,subscriberId:void 0},init:function(t){this.options=e.extend(e.clone(this.defaultOptions),t),this._parent(),this._contextBar=null,this._viewerFrame=this.options.frameWindow.getViewerFrame(),this._uiFrame=this.options.frameWindow.getUIFrame(),this._isInViewpointManipulation=!1,this._listOfSubscribers=[],this._ContextualBarOnLeftClic=!0,this._ContextualBarOnLeftClicAfterCSOChange=!0,this._ContextualMenuOnRightClic=!0,this._ContextualBarAvailable=!0;var n=this;this._unbindBehaviors(),this._bindBehaviors(),i.onEmpty(function(){n.hideContextualMenus()})},register:function(t){(t=e.extend(e.clone(this.defaultOptions),t)).merge?this._listOfSubscribers.push(t):(this._listOfSubscribers=[],this._listOfSubscribers.push(t))},registerUnshift:function(t){(t=e.extend(e.clone(this.defaultOptions),t)).merge?this._listOfSubscribers.unshift(t):(this._listOfSubscribers=[],this._listOfSubscribers.unshift(t))},unregister:function(e){var t;if(e)for(t=0;t<this._listOfSubscribers.length;t++)if(this._listOfSubscribers[t].subscriberId===e){this._listOfSubscribers.splice(t,1);break}},_bindBehaviors:function(){var t=this;t._mousePos={x:0,y:0},this._viewerFrame.addEvent("mousemove",function(e){let n=t._uiFrame.getBoundingClientRect();t._mousePos={x:e.clientX-n.left,y:e.clientY-n.top}}),this._hideListener=function(n){if(!window.DSWebRecord||!r.isReplaying()||null!=n.reason){if(n.reason)var i=n.parentElement,o=n.parentElement2;else i=e.Event.findElement(n,".wux-afr-contextual-bar"),o=e.Event.findElement(n,".wux-menu");if(i||o||t.hideContextualMenus(),window.DSWebRecord&&r.isRecording()){var s=document.querySelector("[data-rec-id=WebGLV6ViewerEventsManager]");r.addCustomInteraction(s,{context:t.options.frameWindow.options.context,parentElement:i,parentElement2:o,reason:"hideListenerCalled"},"DS/CommandRecord/DelegateRec",!1)}}},t._viewerFrame.addEvent(a.POINTERDOWN,t._onPointerDown.bind(t)),t._viewerFrame.addEvent("mousedown",t._onMouseDown.bind(t)),t._viewerFrame.addEvent(a.POINTERUP,t._onMouseUp.bind(t)),t._viewerFrame.addEvent("contextmenu",t._onRightClick.bind(t)),t._viewerFrame.addEvent(a.LONGHOLD,t._onLongHold.bind(t));var n=0,i=function(e){n=0},o=!1;t._visuEventToken=s.subscribe({event:"/VISU/"},function(e){if("@onViewpointChange"===e.eventType)0===n&&(!0===t.getContextualBar()._isShown&&(o=!0),t.hideContextualMenus(),t._viewerFrame.removeEvent("mouseup",i),t._viewerFrame.addEvent("mouseup",i)),n++;else if("@onViewpointBeginMove"===e.eventType&&!0===t._ContextualBarOnLeftClicAfterCSOChange)t._isInViewpointManipulation=!0,o=!1;else if("@onViewpointEndMove"===e.eventType&&!0===t._ContextualBarOnLeftClicAfterCSOChange){if(t._isInViewpointManipulation=!1,!0===o){t.hideContextualMenus();var s={hideWithDistance:!0,ignoreMAB:!0};t._showContextualBar(s)}o=!1}else if("@onClickEvent"===e.eventType&&!0===t._ContextualBarOnLeftClic&&!0===t._ContextualBarOnLeftClicAfterCSOChange&&("@pickNothing"===e.eventID||"@pickPrimitive"===e.eventID||"@pickRep"===e.eventID||"@pickMesh"===e.eventID)){t.hideContextualMenus();s={hideWithDistance:!0,ignoreMAB:!0};t._showContextualBar(s)}}),this._ctxbarHiddenEventToken=s.subscribe({event:"WUX/AFR/ctxBarHidden"},function(e){t._isTouch||t.hideContextualMenu()}),window.removeEventListener("blur",t.hideContextualMenus),window.addEventListener("blur",t.hideContextualMenus)},dispose:function(){s.unsubscribe(this._visuEventToken),s.unsubscribe(this._ctxbarHiddenEventToken),window.removeEventListener("blur",this.hideContextualMenus)},deactivateContextualBarOnLeftClic:function(){this._ContextualBarOnLeftClic=!1},activateContextualBarOnLeftClic:function(){this._ContextualBarOnLeftClic=!0},deactivateContextualBar:function(){this._ContextualBarAvailable=!1},activateContextualBar:function(){this._ContextualBarAvailable=!0},deactivateContextualMenuOnRightClic:function(){this._ContextualMenuOnRightClic=!1},activateContextualMenuOnRightClic:function(){this._ContextualMenuOnRightClic=!0},deactivateContextualBarOnLeftClicAfterCSOChange:function(){this._ContextualBarOnLeftClicAfterCSOChange=!1},activateContextualBarOnLeftClicAfterCSOChange:function(){this._ContextualBarOnLeftClicAfterCSOChange=!0},_unbindBehaviors:function(){var e=this;e._viewerFrame.removeEvent(a.POINTERDOWN,e._onPointerDown.bind(e)),e._viewerFrame.removeEvent("mousedown",e._onMouseDown.bind(e)),e._viewerFrame.removeEvent(a.POINTERUP,e._onMouseUp.bind(e)),e._viewerFrame.removeEvent("contextmenu",e._onRightClick.bind(e)),e._viewerFrame.removeEvent(a.LONGHOLD,e._onLongHold.bind(e)),s.unsubscribe(this._ctxbarHiddenEventToken)},_onBarDisplayed:null,_showContextualBar:function(e){void 0===e&&(e={});var t=this;document.body.removeEventListener("click",this._hideListener),document.body.addEventListener("click",this._hideListener),this._contextBar&&this._contextBar.hide(),this._listOfSubscribers.length&&(null!==this.options.frameWindow.options.context&&void 0!==this.options.frameWindow.options.context&&(e.context=this.options.frameWindow.options.context),e.viewerFrame=this._viewerFrame,e.uiFrame=this._uiFrame,t._isTouch?(e.Xposition=void 0===e.x?t._initMousePos.x:e.x,e.Yposition=void 0===e.y?t._initMousePos.y:e.y):(e.Xposition=void 0===e.x?t._mousePos.x:e.x,e.Yposition=void 0===e.y?t._mousePos.y:e.y),e.subscribersOptions=void 0===e.fillingList||0===e.fillingList.length?this._listOfSubscribers:e.fillingList,e.hideWithDistance=void 0===e.hideWithDistance||e.hideWithDistance,null!==t._onBarDisplayed&&(e.eventCallback=t._onBarDisplayed.bind(t)),null!==e.barDisplayedCB&&void 0!==e.barDisplayedCB&&(e.eventCallback=e.barDisplayedCB),e.Xoffset=void 0===e.Xoffset?45:e.Xoffset,e.Yoffset=void 0===e.Yoffset?-45:e.Yoffset,t._ContextualBarAvailable&&n.show(e))},getContextualBar:function(){return n},hideContextualMenus:function(){document.body.removeEventListener("click",this._hideListener),n.hide(),o.hide()},hideContextualMenu:function(){o.hide()},showContextualBar:function(e){var t={};void 0!==e&&(t.x=e.x,t.y=e.y,void 0!==e.x&&void 0!==e.y&&(t.Xoffset=0,t.Yoffset=0,t.hideWithDistance=!1),t.fillingList=e.fillingList,t.barDisplayedCB=e.barDisplayedCB,void 0!==e.hideWithDistance&&(t.hideWithDistance=e.hideWithDistance),void 0!==e.backMAB&&(t.backMAB=e.backMAB)),this.getContextualBar()&&void 0!==this.getContextualBar()&&this.getContextualBar().hide(),this._showContextualBar(t)},updateContextualBar:function(){if(this.getContextualBar()&&void 0!==this.getContextualBar()&&this.getContextualBar()._isShown){var e={samePosition:!0};this.getContextualBar()&&void 0!==this.getContextualBar()&&this.getContextualBar().hide(),this.hideContextualMenu(),this._showContextualBar(e)}},_onMouseDown:function(e){let t=this._uiFrame.getBoundingClientRect();this._initMousePos={x:e.clientX-t.left,y:e.clientY-t.top},1===e.button&&(this._isInViewpointManipulation=!0)},_onPointerDown:function(e){var t=this;let n=t._uiFrame.getBoundingClientRect();if(t._initMousePos={x:e.clientX-n.left,y:e.clientY-n.top},t._isTouch=a.isTouchEvent(e),0===e.button&&!1!==t._ContextualBarOnLeftClic&&!1===t._ContextualBarOnLeftClicAfterCSOChange){t.hideContextualMenus();var i={hideWithDistance:!0};setTimeout(function(){t._showContextualBar(i)},200)}},_onMouseUp:function(e){var t=e.button;0===t||2===t||1===t&&(this._isInViewpointManipulation=!1)},_onMenuDisplayed:null,_onMenuReadyToShow:null,_showContextualMenu:function(e){var t=this;e||(e={});var n=void 0!==e.withUpdatedBar&&e.withUpdatedBar;if(document.body.removeEventListener("click",this._hideListener),document.body.addEventListener("click",this._hideListener),!t._isInViewpointManipulation){if(n){var i={hideWithDistance:!1,x:void 0===e.x?t._mousePos.x:e.x,y:void 0===e.y?t._mousePos.y:e.y,Xoffset:0,Yoffset:-5,withContextMenu:!0,samePosition:!0===e.samePosition};this._contextBar&&this._contextBar.hide(),t._showContextualBar(i)}if(o.hide(),t._listOfSubscribers.length){var s={};null!==this.options.frameWindow.options.context&&void 0!==this.options.frameWindow.options.context&&(s.context=this.options.frameWindow.options.context),s.frameWindow=t.options.frameWindow,s.viewerFrame=t._viewerFrame,s.uiFrame=t._uiFrame,s.Xposition=void 0===e.x?t._mousePos.x:e.x,s.Yposition=void 0===e.y?t._mousePos.y:e.y,s.samePosition=e.samePosition,s.underBar=e.underBar,s.subscribersOptions=void 0===e.fillingList||0===e.fillingList.length?this._listOfSubscribers:e.fillingList,s.language=t.options.frameWindow.options.language,null!==t._onMenuDisplayed&&(void 0===s.eventCallback&&(s.eventCallback={}),s.eventCallback.displayedCallback=t._onMenuDisplayed.bind(t)),null!==t._onMenuReadyToShow&&(void 0===s.eventCallback&&(s.eventCallback={}),s.eventCallback.preShowCallback=t._onMenuReadyToShow.bind(t)),null!==e.menuDisplayedCB&&void 0!==e.menuDisplayedCB&&(void 0===s.eventCallback&&(s.eventCallback={}),s.eventCallback.displayedCallback=e.menuDisplayedCB),o.show(s)}}},updateContextualMenu:function(e){o&&void 0!==o&&o._isShown&&(void 0!==e&&e||(e={}),e.samePosition=!0,this.hideContextualMenu(),this._showContextualMenu(e))},showContextualMenuUnderBar:function(e){o&&void 0!==o&&this.getContextualBar()&&void 0!==this.getContextualBar()&&this.getContextualBar()._isShown&&(void 0!==e&&e||(e={}),e.underBar=!0,this.hideContextualMenu(),this._showContextualMenu(e))},_onLongHold:function(e){a.isTouchEvent(e)&&this._onRightClick(e)},_onRightClick:function(e){var t=this;if(!(e.buttons>2)){if(window.DSWebRecord&&r.isReplaying()){if(!e.pos)return;t._finalMousePos=e.pos,t._initMousePos=e.posInit,t._mousePos=e.posFinal}else{let n=t._uiFrame.getBoundingClientRect();t._finalMousePos={x:e.clientX-n.left,y:e.clientY-n.top}}if(window.DSWebRecord&&r.isRecording()){var n=document.querySelector("[data-rec-id=WebGLV6ViewerEventsManager]");r.addCustomInteraction(n,{context:t.options.frameWindow.options.context,reason:"contextMenu",event:e,posInit:t._initMousePos,posFinal:t._finalMousePos,pos:t._mousePos},"DS/CommandRecord/DelegateRec",!1)}if(document.body.removeEventListener("click",this._hideListener),document.body.addEventListener("click",this._hideListener),window.DSWebRecord&&r.isReplaying()||e.preventDefault(),t._initMousePos.x===t._finalMousePos.x&&t._initMousePos.y===t._finalMousePos.y&&!1!==t._ContextualMenuOnRightClic){var i={hideWithDistance:!1,x:t._mousePos.x,y:t._mousePos.y,Xoffset:0,Yoffset:-5,withContextMenu:!0};if(t._isTouch&&(i.x=t._finalMousePos.x,i.y=t._finalMousePos.y),this.getContextualBar()&&void 0!==this.getContextualBar()&&this.getContextualBar().hide(),t._showContextualBar(i),o.hide(),t._listOfSubscribers.length){var s={};null!==this.options.frameWindow.options.context&&void 0!==this.options.frameWindow.options.context&&(s.context=this.options.frameWindow.options.context),s.frameWindow=t.options.frameWindow,s.viewerFrame=t._viewerFrame,s.uiFrame=t._uiFrame,t._isTouch?(s.Xposition=t._finalMousePos.x,s.Yposition=t._finalMousePos.y):(s.Xposition=t._mousePos.x,s.Yposition=t._mousePos.y),s.language=t.options.frameWindow.options.language,s.subscribersOptions=t._listOfSubscribers,null!==t._onMenuDisplayed&&(void 0===s.eventCallback&&(s.eventCallback={}),s.eventCallback.displayedCallback=t._onMenuDisplayed.bind(t)),null!==t._onMenuReadyToShow&&(void 0===s.eventCallback&&(s.eventCallback={}),s.eventCallback.preShowCallback=t._onMenuReadyToShow.bind(t)),o.show(s)}}}}})}),define("DS/ApplicationFrame/ActionBar",["UWA/Core","UWA/Controls/Abstract","DS/Core/Core","DS/RuntimeView/NLSManager","DS/ApplicationFrame/Json2Html","DS/Core/ModelEvents","DS/UIBehaviors/Kinetic","DS/Core/PointerEvents","DS/UIBehaviors/ContextualMenuManager","DS/Utilities/Dom","DS/Controls/TabBar","DS/WebRecordEnabler/Adapter","DS/Utilities/TouchUtils","UWA/Utils/Client","DS/Controls/TooltipModel","i18n!DS/ApplicationFrame/assets/nls/ApplicationFrameActionBar"],function(e,t,n,i,o,s,a,r,l,d,c,u,m,h,p,_){"use strict";var f=h.getScrollbarWidth(),v="EVT_SECTION_CHANGE",g=54;function C(){window.DEBUG_ActionBar_Init&&window.top.performance.mark("b_ABInit")}function b(e){window.DEBUG_ActionBar_Init&&(window.top.performance.mark("e_ABInit"),window.top.performance.measure(e._perfId+"_"+e._perfStr+"_ABReady","b_ABInit","e_ABInit"))}function w(e){var t=!0;if(e&&e._afr&&window.widget){var n=e._preferences.getActiveSection();if(null!=n){var i=e._afr.getSectionIDByName(n);void 0!==i&&(e._tabBar.value=[i],t=!1)}}t&&(e._tmpDoNotSaveActiveSectionPreference=!0,e._tabBar.value=[0],delete e._tmpDoNotSaveActiveSectionPreference)}function S(e,t){if(void 0!==t&&void 0!==t.index&&t.index>=0&&t.index<e._afr.getNumberOfSections()){if(e._afr.goToNthSection(t.index),e._checkWidth(),window.widget&&e._afr&&!e._tmpDoNotSaveActiveSectionPreference)if(e._afr.getCurrentSection()){var n=e._afr.getCurrentSection().options.Name;e._preferences.setActiveSection(n)}e._modelEvents.publish({event:v,data:e._afr.getNthSection(t.index)})}}function x(e){var t=m.getTouchMode();t?e.elements.container.addClassName("wux-afr-actionbar-touch"):e.elements.container.removeClassName("wux-afr-actionbar-touch"),e.elements.chevron&&(t?e.elements.chevron.addClassName("wux-ui-chevron-touch"):e.elements.chevron.removeClassName("wux-ui-chevron-touch"))}function y(e){this._private=Object.create(null),this._private.useWidgetPreferences=!0,e&&e.forceLocal&&(this._private.useWidgetPreferences=!1),this._private.isCollapsedPreference=null,this._private.activeSection=null;var t=null;window.widget&&this._private.useWidgetPreferences&&(void 0!==(t=window.widget.getValue("webafr_IsActionBarCollapsed"))&&"boolean"==typeof t&&(this._private.isCollapsedPreference=t),void 0!==(t=window.widget.getValue("webafr_ActiveSectionName"))&&"string"==typeof t&&(this._private.activeSection=t))}y.prototype.setIsCollapsedPreference=function(e){if("boolean"!=typeof e)throw new Error("value must be a boolean.");window.widget&&this._private.useWidgetPreferences&&window.widget.setValue("webafr_IsActionBarCollapsed",e),this._private.isCollapsedPreference=e},y.prototype.getIsCollapsedPreference=function(){return this._private.isCollapsedPreference},y.prototype.setActiveSection=function(e){if(void 0===e)throw new Error("identifier cannot be undefined. To remove the preference, identifier must be null.");window.widget&&this._private.useWidgetPreferences&&widget.setValue("webafr_ActiveSectionName",e),this._private.activeSection=e},y.prototype.getActiveSection=function(){return this._private.activeSection};var E=t.extend({defaultOptions:{context:null,file:null,module:null,enableShowHide:!0,dev:{sectionsBarPosition:"top"},language:"",uiOptions:{displayWatermark:!1}},init:function(e){var t,n;t=this,n=e.module,window.DEBUG_ActionBar_Init&&(t._perfId=window.top.performance.now(),t._perfStr=n),C(),this._parent(e),this._preferences=new y,this._tabBar=new c,this._tabBar.editableFlag=!1,this._tabBar.pinFlag=!1;var a=this;this._tabBar.onSelectTab(function(e){S(a,e)}),document.addEventListener("touchChange",function(){x(a),a._checkWidth()}),this._modelEvents=new s,this._buildLayout();var d={hideLabels:"Hide Labels",showLabels:"Show Labels",bulletMode:"Section with bullet",labelMode:"Section with label"};i.loadResource({resourceFile:"ApplicationFrame/ActionBar"}),i.onResourceLoaded({resourceFile:"ApplicationFrame/ActionBar",language:this.options.language},function(){d.hideLabels=this.getTitle({key:"hideLabels"}),d.showLabels=this.getTitle({key:"showLabels"}),d.bulletMode=this.getTitle({key:"bulletMode"}),d.labelMode=this.getTitle({key:"labelMode"})}),l.onReady({target:a.elements.container,nodes:function(){return"false"===this.elements.container.getAttribute("data-open")?null:[a._afr.getLabelsVisibility()?{label:d.hideLabels,callback:function(){a.hideLabels(!0)}}:{label:d.showLabels,callback:function(){a.showLabels(!0)}}]}.bind(this)}),a.elements.container.addEventListener(r.LONGHOLD,function(e){l.show(e.currentTarget,[e.pageX,e.pageY])}),this._afr=new o({actionBar:!0,context:this.options.context,module:this.options.module,directory:"assets/afr/",xml:this.options.file,language:this.options.language,onComplete:function(){a._postProcess(),w(a),b(a),a._modelEvents.publish({context:a,event:"EVT_ACTIONBAR_READY"}),a._checkWidth()},perfId:this._perfId,perfStr:this._perfStr})},loadModel:function(t){var n=this;C(),t=e.extend({context:this.options.context,merge:!1},t),this._tabBar.remove(),this._tabBar=new c,this._tabBar.editableFlag=!1,this._tabBar.pinFlag=!1,this._tabBar.onSelectTab(function(e){S(n,e)}),this._afr.elements.borderContainer.empty(),"false"===this.elements.container.getAttribute("data-open")&&this._tabBar.hide(),this._tabBar.getContent().inject(this.elements.tabBarParent),t.merge?new o({actionBar:!0,context:t.context,module:t.module,merge:!1,directory:"assets/afr/",language:t.language,xml:t.file,_createView:!1,onComplete:function(){n._afr.merge(this)},perfId:n._perfId,perfStr:n._perfStr}):(void 0===t.showLabels&&(t.showLabels=this._afr.getLabelsVisibility()),this.options=e.extend(this.defaultOptions,t),this._afr._initialize({context:this.options.context,module:t.module,directory:"assets/afr/",xml:t.file,_createView:!0,showLabels:t.showLabels,onComplete:function(){n._postProcess(),n._checkWidth(),w(n),b(n),n._modelEvents.publish({context:n,event:"EVT_ACTIONBAR_READY"})}}))},_buildLayout:function(){this.elements.container=new e.Element("div",{class:"AfrActionBar wux-afr wux-afr-actionbar"}),window.DSWebRecord&&(this.elements.container.setAttribute("data-rec-id","actionBar"),this.markForRecord(this.elements.container)),this.elements.container.setAttribute("data-open","true"),this.elements.container.oncontextmenu=function(){return!1},this.elements.sections=new e.Element("ul",{class:"Sections",html:this.elements.toolbars,events:null}),this.elements.sectionsTop=new e.Element("div").inject(this.elements.sections),this.elements.sectionsTop.addClassName("wux-afr-sectionchooser-container"),this.elements.sectionsBottom=new e.Element("div").inject(this.elements.sections),"top"===this.options.dev.sectionsBarPosition&&(this.elements.container.addClassName("wux-afr-actionbar-top-section"),this.elements.tabBarParent=new e.Element("div"),this.elements.tabBarParent.addClassName("wux-afr-view-tabbar-parent"),this._tabBar.getContent().inject(this.elements.tabBarParent),this.elements.sectionsTop.appendChild(this.elements.tabBarParent)),this.elements.container.appendChild(this.elements.sections),"bottom"===this.options.dev.sectionsBarPosition&&this.elements.container.appendChild(this.elements.sectionsNav),this.elements.itemContainer=this.elements.container},onActionBarReady:function(e){return this._modelEvents.subscribe({event:"EVT_ACTIONBAR_READY"},e)},_postProcess:function(){var t=this;this._afr.inject(this.elements.sections);var n=this._afr.getSections().length,o=0;this._afr.getSections().forEach(function(e,s){var a=t._tabBar.addTab(e.options.Name,s),r=t.options.module+"/"+t.options.file.replace(".xml","");i.onResourceLoaded({resourceFile:r},function(){if(null!=a){var i=this.getTitle({key:e.options.Name});i&&(a.label=i),e.elements.container.setAttribute("data-sectionTitle",a.label),++o>=n&&t._checkWidth()}}),i.loadResource({resourceFile:r})}),this.elements.chevron&&this.elements.chevron.destroy(),this.elements.chevronIcon=e.Element("span",{class:"wux-ui-icon-chevron"}),this.elements.chevron=e.Element("div",{class:"wux-ui-chevron"}),this.elements.chevron.tooltipInfos=new p({title:_.get("hideActionBar"),mouseRelativePosition:!1,position:"top"}),this.elements.chevronIcon.inject(this.elements.chevron),this.elements.chevron.inject(t.elements.tabBarParent,"after"),this.options.enableShowHide?this.elements.chevron.show():this.elements.chevron.hide(),this.elements.chevron.addEvent(r.POINTERUP,this.toggle.bind(this,!0)),x(this),t._modelEvents.publish({event:v,data:t._afr.getNthSection(0)}),this._privateBoundCheckWidth&&window.removeEventListener("resize",this._privateBoundCheckWidth),this._privateBoundCheckWidth=this._checkWidth.bind(t),window.addEventListener("resize",this._privateBoundCheckWidth);var s=!1;d.onNodeRendered(this.elements.container,function(){s||(t._checkWidth(),s=!0)})},showLabels:function(e){this._afr.showLabels(e);this._checkWidth()},hideLabels:function(e){this._afr.hideLabels(e);this._checkWidth()},onShowLabels:function(e){return this._afr._modelEvents.subscribe({event:"SHOW_LABELS"},e)},onHideLabels:function(e){return this._afr._modelEvents.subscribe({event:"HIDE_LABELS"},e)},getLabelsVisibility:function(){return this._afr.getLabelsVisibility()},_checkWidth:function(){var e=this._preferences.getIsCollapsedPreference();null!==e&&e?this.close(!1):null===e||e||this.open(!1);var t=this._afr.getCurrentSection();void 0!==t&&void 0===t._minimumWidthValue&&(t._minimumWidthValue=t.getContent().getDimensions().width);var n,i,o=void 0===this.elements.chevron?0:this.elements.chevron.getDimensions().width,s=this.elements.container.getDimensions().width-o,a=0;if(this._tabBar.visibleFlag&&(a=Math.min(this._tabBar.getWidthWithoutScroll(),s)),this._tabBar.minWidth=a,this.elements.container.getParent()&&t){var r,l=this;r=t.getContent();var d=this.elements.container.getParent().getDimensions();this._afr.elements.borderContainer.setStyles({minWidth:this._tabBar.minWidth+o}),(n=this,i=d.width,n&&n.options&&n.options.uiOptions&&!0===n.options.uiOptions.displayWatermark&&(i-=g),i)<r.getDimensions().width?(l._afr.elements.container.addClassName("wux-ui-scrollbuttons-h"),l._afr.elements.container.setStyles({display:"block",minWidth:""}),l._afr.getWorkbench()["@view"].style.marginBottom=-f-3+"px"):(l._afr.elements.container.removeClassName("wux-ui-scrollbuttons-h"),l._afr.elements.container.setStyles({display:"inline-block",verticalAlign:"top"}),l._afr.getWorkbench()["@view"].style.marginBottom="")}this.getNumberOfSections()<=1?this._tabBar.hide():"true"===this.elements.container.getAttribute("data-open")&&this._tabBar.show(),function(e){if(!e)throw new Error("Action Bar not defined");if(e._afr){var t=e._afr.getWorkbench()["@view"];if(t&&t.getParent()){var n=e._afr.getWorkbench()["@view"].getParent().getDimensions();e._modelEvents.publish({event:"ACTIONBAR_WIDTH_CHANGE",data:n.width})}}}(this)},toggle:function(e){null===this.elements.container.getAttribute("data-open")&&this.elements.container.setAttribute("data-open","true"),"true"===this.elements.container.getAttribute("data-open")?this.close(e):(this.open(e),this._checkWidth())},open:function(e){"true"!==this.elements.container.getAttribute("data-open")&&(this.elements.container.setAttribute("data-open","true"),this.getNumberOfSections()>1&&this._tabBar.show(),this.elements.chevron&&this.elements.chevron.tooltipInfos&&(this.elements.chevron.tooltipInfos.title=_.get("hideActionBar")),!1!==e&&this._preferences.setIsCollapsedPreference(!1),this._modelEvents.publish({context:this,event:"ACTIONBAR_OPEN"}))},close:function(e){"false"!==this.elements.container.getAttribute("data-open")&&(this.elements.container.setAttribute("data-open","false"),this._tabBar.hide(),this.elements.chevron&&this.elements.chevron.tooltipInfos&&(this.elements.chevron.tooltipInfos.title=_.get("showActionBar")),!1!==e&&this._preferences.setIsCollapsedPreference(!0),this._modelEvents.publish({context:this,event:"ACTIONBAR_CLOSE"}))},onActionBarOpen:function(e){return this._modelEvents.subscribe({event:"ACTIONBAR_OPEN"},e)},onActionBarClose:function(e){return this._modelEvents.subscribe({event:"ACTIONBAR_CLOSE"},e)},removeCallback:function(e){if(void 0===e||"string"!=typeof e)throw new Error("Wrong parameter: removeCallback has to be called passing one string parameter");this._modelEvents.unsubscribe(e)},getSectionID:function(e){return this._afr.getSectionIDByName(e)},getNumberOfSections:function(){return this._afr.getNumberOfSections()},goToNthSection:function(e){this._tabBar.value=[this._tabBar.getValueByIndex(e)]},onSectionChange:function(e){return this._modelEvents.subscribe({event:v},e)},onWidthChange:function(e){return this._modelEvents.subscribe({event:"ACTIONBAR_WIDTH_CHANGE"},e)},_setWatermarkLimitationState:function(e,t,n){if("boolean"!=typeof e)throw new Error("bState has to be a boolean");if(e||this._watermarkLimitationState)if(this._watermarkLimitationState=e,e){var i=n-g-t;this.elements.sectionsTop.style.marginLeft="-"+i+"px"}else this.elements.sectionsTop.style.marginLeft="0px"}});return window.DSWebRecord&&u.register(E,"DS/CommandRecord/ActionBarRecord"),E}),define("DS/ApplicationFrame/FrameWindow",["UWA/Core","UWA/Element","DS/Core/Core","DS/Controls/LayerSet","DS/ApplicationFrame/ActionBar","DS/ApplicationFrame/AfrPlayerService","DS/Windows/ImmersiveFrame","DS/Windows/Panel","DS/ApplicationFrame/CommandsManager","DS/ApplicationFrame/FrameWindowsManager","UWA/Controls/Abstract","DS/RuntimeView/NLSManager","DS/Utilities/Css","DS/Core/ModelEvents","DS/Core/PointerEvents","DS/Utilities/TouchUtils"],function(e,t,n,i,o,s,a,r,l,d,c,u,m,h,p,_){"use strict";navigator.language.substr(0,2)||navigator.systemLanguage.substr(0,2);var f=c.extend({defaultOptions:{context:null,workbench:null,workbenchModule:null,defaultCommand:null,viewer:"2d",height:"100%",minHeight:0,ignoreResetCommandManager:!1,viewerOptions:{antiAliasing:"SMAA",useShadowMap:!1,infinitePlane:!0,displayGrid:!0,useVignetting:!1,ssao:!1,dof:!1,deferred:!1,debugShadowLight:!1,debugBSphere:!1,debugBBox:!1,onModelLoaded:null},uiOptions:{displayActionBar:!0,displayTree:!0,displayImmersiveFrame:!0,preserveActionBarHeight:!1,displayWatermark:!1},language:null},init:function(e){var t=this;this._parent(e),this._abTokens=[],d._registerNewFrameWindow(this),this._modelEvents=new h,this._isReady=!1,u.DEFAULT_LANGUAGE=this.options.language,this.onReady(function(){t._isReady=!0}),this._buildView(),this.elements.actionBarAndWatermarkContainer=new UWA.Element("div"),!0===this.options.uiOptions.displayWatermark&&(this.elements.watermarkContainer=new UWA.Element("div"),this.elements.watermarkContainer.addClassName("wux-afr-watermark"),this.elements.watermarkIcon=new UWA.Element("span"),this.elements.watermarkIcon.inject(this.elements.watermarkContainer),this.elements.watermarkContainer.addEvent(p.POINTERUP,function(){window.open("https://3ds.com")}),this.elements.watermarkContainer.inject(this.elements.actionBarAndWatermarkContainer),this.elements.actionBarAndWatermarkContainer.addClassName("wux-afr-actionbar-watermark")),this.elements.layerSet.addLayer(this.elements.actionBarAndWatermarkContainer,{left:0,right:0,bottom:0,zIndex:30001}).setAttribute("data-type","action-bar"),this.elements.contextualComponentContainer=new UWA.Element("div"),this.elements.layerSet.addLayer(this.elements.contextualComponentContainer,{top:0,left:0,right:0,bottom:0,pointerEvents:"none"}).setAttribute("data-type","contextual-component"),this.elements.modalDialogContainer=new UWA.Element("div"),this.elements.layerSet.addLayer(this.elements.modalDialogContainer,{top:0,left:0,right:0,bottom:0,pointerEvents:"none"}).setAttribute("data-type","modal-dialog"),this.options.workbench&&this.loadActionBar({workbench:this.options.workbench,workbenchModule:this.options.workbenchModule}),m.disableSelection(this.elements.container),m.disableSelection(this.getUIFrame()),this.options.defaultCommand&&l.setDefaultCommand({context:this.options.context,ID:this.options.defaultCommand.ID||"myDefaultCmd",className:this.options.defaultCommand.className||"myDefaultCmd"}),this.insertPlayer=function(e){t.elements.playerPanel||(t.elements.playerPanel=new r({title:"Player",closeButtonFlag:!1,collapsibleFlag:!1,expandedFlag:!1,content:e,position:{my:"bottom center",at:"bottom center",offsetY:-30},immersiveFrame:t.elements._immersiveFrame}))},this.removePlayer=function(e){t.elements.playerPanel&&(t.elements.playerPanel.close(),t.elements.playerPanel=null)},s.registerPlayerContainer(this)},_buildView:function(){var e=this;this.elements={},this.elements.container=new UWA.Element("div",{class:"wux-afr-framewindow wux-afr-framewindow-background wux-ui-ambiance-light",styles:{height:this.options.height,minHeight:this.options.minHeight,position:"relative"}}),this._onTouchChange=function(){console.log("on touch change"),_.getTouchMode()?this.elements.container.addClassName("wux-afr-framewindow-touch"):this.elements.container.removeClassName("wux-afr-framewindow-touch")}.bind(this),document.addEventListener("touchChange",this._onTouchChange),this._onTouchChange(),this.elements.viewerFrame=new UWA.Element("div",{styles:{width:"100%",height:"100%"}}),this.elements.uiFrame=new UWA.Element("div",{class:"wux-afr-framewindow-uiframe",dataType:"UI-Frame",styles:{}}),this.elements.uiFrame3d=new UWA.Element("div",{class:"wux-afr-framewindow-uiframe",dataType:"UI-Frame-3D",styles:{}}),this.elements.layerSet=new i({styles:{position:"relative",height:"100%",minHeight:this.options.minHeight}}),this.elements.layerSet.inject(this.elements.container),this.elements.layerSet.addLayer(this.elements.viewerFrame).setAttribute("data-type","viewer");var t=0;if(this.options.uiOptions&&this.options.uiOptions.displayActionBar&&(t=81,this.options.uiOptions.preserveActionBarHeight||(t-=32)),this.elements.layerSet.addLayer(this.elements.uiFrame3d,{top:0,bottom:t,left:0,right:0,pointerEvents:"none"}).setAttribute("data-type","ui-frame-3d"),this.elements.layerSet.addLayer(this.elements.uiFrame,{top:0,bottom:t,left:0,right:0,pointerEvents:"none"}).setAttribute("data-type","ui-frame-2d"),setTimeout(function(){e.elements.container&&e.elements.container.addClassName("wux-ui-at-screen")},0),this.options.uiOptions.displayImmersiveFrame){var n=this.options.context?this.options.context:"";this.elements._immersiveFrame=new a({identifier:n}),this.elements._immersiveFrame.rootContainer=this.elements.container,this.elements._immersiveFrame.inject(this.elements.uiFrame)}},loadActionBar:function(e){if(this.options.ignoreResetCommandManager||l._reset(),e=UWA.extend({workbench:this.options.workbench,workbenchModule:this.options.workbenchModule,language:this.options.language},e),this._actionBar)this._actionBar.loadModel({merge:e.merge,file:e.workbench,module:e.workbenchModule,language:e.language});else if(this._actionBar=new o({context:this.options.context,file:e.workbench,module:e.workbenchModule,language:e.language,uiOptions:{displayWatermark:this.options.uiOptions.displayWatermark}}),this.options.uiOptions.displayActionBar){this._actionBar.inject(this.elements.actionBarAndWatermarkContainer),this.elements.actionBarContainer=this._actionBar.elements.container;var t=this;if(this.options.uiOptions.preserveActionBarHeight){var n=this._onActionBarChange.bind(this);this._abTokens.push(this.onActionBarReady(function(){t._abTokens.push(t._actionBar.onActionBarOpen(n)),t._abTokens.push(t._actionBar.onActionBarClose(n)),t._abTokens.push(t._actionBar.onShowLabels(n)),t._abTokens.push(t._actionBar.onHideLabels(n)),n()}))}if(!0===this.options.uiOptions.displayWatermark)var i=this._actionBar.onActionBarReady(function(){t._actionBar.removeCallback(i),t._onWidthChangeToken=t._actionBar.onWidthChange(function(e){var n=e,i=t.elements.container.getDimensions().width;n>=i-54-54?(t._actionBar._setWatermarkLimitationState(!0,n,i),t._actionBar.getContent().addClassName("wux-afr-actionbar-moved")):(t._actionBar._setWatermarkLimitationState(!1),t._actionBar.getContent().removeClassName("wux-afr-actionbar-moved"))})})}},onActionBarReady:function(e){return this._actionBar.onActionBarReady(e)},_load2dViewer:function(){},onReady:function(e){e.call(this)},_enableBusyMode:function(){this.elements.container.addClassName("wux-ui-state-busy")},_disableBusyMode:function(){this.elements.container.removeClassName("wux-ui-state-busy")},_onActionBarChange:function(e){var t=this._actionBar.elements.container.getSize(),n=0,i="false"!==this._actionBar.elements.container.getAttribute("data-open");this.options.uiOptions&&this.options.uiOptions.displayActionBar&&(n=t.height,i||(n=this._actionBar.elements.chevron.getSize().height),this.elements.uiFrame.getParent().setStyle("bottom",n),this.elements.uiFrame3d.getParent().setStyle("bottom",n))},getViewerFrame:function(){return this.elements.viewerFrame},getUIFrame:function(){return this.elements.uiFrame},getActionBar:function(){return this._actionBar},getImmersiveFrame:function(){return this.elements._immersiveFrame},_onDispose:function(){},dispose:function(){document.removeEventListener("touchChange",this._onTouchChange),l._dispose(this.options.context),d._unregisterFrameWindow(this.options.context),this.elements.playerPanel&&(s.registerPlayerContainer(void 0),this.elements.playerPanel.destroy());for(var e=0;e<this._abTokens.lengh;e++)this._actionBar.removeCallback(this._abTokens[e]);!0===this.options.uiOptions.displayWatermark&&this._onWidthChangeToken&&this._actionBar.removeCallback(this._onWidthChangeToken),this._onDispose(),this.elements._immersiveFrame&&this.elements._immersiveFrame.destroy(),this.elements.container.parentNode&&this.destroy()}});return UWA.namespace("WUX/AFR/FrameWindow",f)}),define("DS/ApplicationFrame/FrameWindow3D",["UWA/Core","DS/ApplicationFrame/FrameWindow","DS/Visualization/WebGLV6Viewer","DS/Visualization/SceneGraph","DS/Visualization/Viewpoint","DS/Visualization/ModelLoader","DS/SceneGraphTree/SceneGraphTree","DS/Visualization/GeometryHelper","DS/ApplicationFrame/CommandsManager","DS/ApplicationFrame/ContextualUIManager","DS/Visualization/Node3D"],function(e,t,n,i,o,s,a,r,l,d,c){"use strict";var u=t.extend({defaultOptions:{context:null,workbench:null,workbenchModule:null,defaultCommand:null,viewer:"3D",height:"100%",minHeight:0,viewerOptions:{antiAliasing:"SMAA",useShadowMap:!1,infinitePlane:!0,displayGrid:!0,useVignetting:!1,ssao:!1,dof:!1,deferred:!1,debugShadowLight:!1,debugBSphere:!1,debugBBox:!1,onModelLoaded:null},uiOptions:{displayActionBar:!0,displayTree:!0}},init:function(e){"3d"===e.viewer&&console.warn("FrameWindow3d error: You don't have to specify viewer:3d in the options."),this._is3DViewer=!0,this._parent(e),this.load3dViewer(this.options.viewerOptions),this._contextualUIManager=new d({frameWindow:this})},load3dViewer:function(e){this._3dViewer=new n(e),this.init3dViewer()},init3dViewer:function(){var e=this;e._3dViewer.setRenderMode("@Edge",!0),e._3dViewer.setPicking({activated:!0,displayHL:!0,gpu:!0,computeNormalDepth:!0,primitive:!1}),e._3dViewer.setPrePicking({activated:!1,displayHL:!0,gpu:!0,computeNormalDepth:!1,primitive:!1}),window.undoSceneGraphMigration?(e._private_sceneGraph=new i("I solemnly swear that I am up to no good."),e._3dViewer.attachScene(e._private_sceneGraph)):e._private_sceneGraph=e._3dViewer.getRootNode(),e._viewpoint=new o({viewer:e._3dViewer}),e._viewpoint.onMove(e._3dViewer.render),e._3dViewer.addViewpoint(e._viewpoint),e._3dViewer.setV6Ambience(),e._modelLoader=new s,e._modelLoader.setSceneGraph(e._private_sceneGraph),e._modelLoader.setRenderCallback(e._3dViewer.render),e._modelLoader.setOnLoadedCallback(function(){e.options.onModelLoaded?e.options.onModelLoaded.call(e):e._viewpoint.reframe(),e._modelEvents.publish({event:"EVT_VIEWER_MODEL_LOADED",data:e})}),e._sceneGraphTree=new a(UWA.extendElement(e._3dViewer.div),e._3dViewer),e._sceneGraphTree.setSceneGraph(e._private_sceneGraph),e.options.uiOptions.displayTree?e._sceneGraphTree.tree.show():e._sceneGraphTree.tree.hide();var t=0;e.options.uiOptions&&e.options.uiOptions.displayActionBar&&(t=81-32),e.elements.layerSet.addLayer(e._sceneGraphTree.tree.getContent(),{height:"auto",position:"absolute",left:0,top:0,bottom:t}),e._sceneGraphTree.tree.getContent().setStyles({height:"auto",position:"absolute",left:0,top:0,bottom:81}),e._3dViewer.inject(e.elements.viewerFrame);var n="Visu"+e._3dViewer.getVisuEnv()+"Env",r={VisuNoEnv:"light",VisuNoneEnv:"light",VisuV6Env:"light",VisuCleanSpaceEnv:"light",VisuDarkBlueEnv:"dark",VisuDarkGreyEnv:"dark",VisuShinyEnv:"dark"};e.elements.container.addClassName("wux-ui-ambiance-"+r[n]),l.onCommandStart(function(t){r[t._id]&&(e.elements.container.removeClassName("wux-ui-ambiance-light"),e.elements.container.removeClassName("wux-ui-ambiance-dark"),e.elements.container.addClassName("wux-ui-ambiance-"+r[t._id]))}),e._modelEvents.publish({event:"EVT_VIEWER_LOADED",context:e})},onViewerModelLoaded:function(e){return this._modelEvents.subscribe({event:"EVT_VIEWER_MODEL_LOADED"},e)},onViewerLoaded:function(e){return this._modelEvents.subscribe({event:"EVT_VIEWER_LOADED"},e)},onReady:function(e){"3d"===this.options.viewer?this.onViewerLoaded(e):e.call(this)},getCurrentViewer:function(){return console.warn("deprecated","WUX.AFR.FrameWindow.getCurrentViewer() is deprecated. Please use WUX.AFR.FrameWindow.getViewer"),this.getViewer()},getModelLoader:function(){return this._modelLoader},getViewer:function(){return this._3dViewer},registerAdditionnalViewer:function(e,t){e?(this._additionnalViewers||(this._additionnalViewers=[]),this._additionnalViewers[e]&&console.warn("FrameWindow3D.js : Registering a new viewer under a viewerID already used. The viewer registered under the id : "+e+" is overwritten"),this._additionnalViewers[e]=t):console.error("FrameWindow3D.js : registerAdditionnalViewer error iViewerID is undefined, can't regsiter a viewer without iViewerID specified")},unregisterAdditionnalViewer:function(e){var t;if(this._additionnalViewers)return this._additionnalViewers[e]?(t=this._additionnalViewers[e],this._additionnalViewers[e]=void 0):console.error("FrameWindow3D.js : unregisterAdditionnalViewer error, no additionnal viewer with Id "+e+" resgitered"),t;console.error("FrameWindow3D.js : unregisterAdditionnalViewer error, no additionnal viewer resgitered")},getViewers:function(){var e=[];if(this.getViewer()&&e.push(this.getViewer()),this._additionnalViewers)for(var t=0;t<this._additionnalViewers.length;t++)e.push(this._additionnalViewers[t]);return e},getViewpoint:function(){return this._viewpoint},getGeometryHelper:function(){return c.DEPRECATED_SceneGraph(new Error),this._geometryHelper||(this._geometryHelper=new r),this._geometryHelper},getSceneGraph:function(){return c.DEPRECATED_SceneGraph(new Error),this._private_sceneGraph},getRootNode:function(){return this._3dViewer.getRootNode()},getTree:function(){if(this._sceneGraphTree)return this._sceneGraphTree.tree},getContextualUIManager:function(){return this._contextualUIManager},get3DUIFrame:function(){return this.elements.uiFrame3d},getRootDelta:function(){return 2},_onDispose:function(){this._contextualUIManager.dispose(),this._modelLoader.abort(),this._modelLoader=null,this.getViewer().dispose(),this._3dViewer=null,this._sceneGraphTree&&this._sceneGraphTree.dispose()},dispose:function(){this._parent()}});return Object.defineProperty(u.prototype,"_sceneGraph",{get:function(){return c.DEPRECATED_SceneGraph(new Error),this._private_sceneGraph}}),UWA.namespace("WUX/AFR/FrameWindow3D",u)}),define("DS/ApplicationFrame/CSIFrameWindow3D",["DS/ApplicationFrame/FrameWindow3D","DS/Visualization/CSIViewer"],function(e,t){"use strict";var n=e.extend({init:function(e){return this._parent(e),this},load3dViewer:function(e){this._3dViewer=new t(e),this.init3dViewer()}});return UWA.namespace("WUX/AFR/CSIFrameWindow3D",n)});