define("DS/LibraryActive/service/LibraryTypeService",["UWA/Controls/Abstract"],function(e,t){return e.singleton({TYPE_ROOT_LIBRARY_1:"General Library",TYPE_ROOT_LIBRARY_2:"Part Library",TYPE_ROOT_LIBRARY_3:"RootLibrary",TYPE_LIBRARY_1:"General Class",TYPE_LIBRARY_2:"Library",TYPE_LIBRARIES_SECTION:"LibrarySection_AllLibraries",TYPE_FAVORITES_SECTION:"LibrarySection_favorite",init:function(){},isRootLibrary:function(e){return e===this.TYPE_ROOT_LIBRARY_1||e===this.TYPE_ROOT_LIBRARY_2||e===this.TYPE_ROOT_LIBRARY_3},isLibrary:function(e){return e===this.TYPE_LIBRARY_1||e===this.TYPE_LIBRARY_2},inFamilyLibrary:function(e){return this.isRootLibrary(e)||this.isLibrary(e)},isSection:function(e){return e===this.TYPE_LIBRARIES_SECTION||e===this.TYPE_FAVORITES_SECTION}})}),define("DS/LibraryActive/commands/LibraryActiveCommands",["i18n!DS/LibraryActive/assets/nls/LibraryActive","DS/WidgetServices/WidgetServices","DS/WebappsUtils/WebappsUtils"],function(e,t,i){"use strict";return{ExpandAllCmd:function(e,t){e.plmType;var i=[];"TREE"===t&&e&&i.push(e),i.length&&i.forEach(function(e){null===e.options.children||("TREE"===t||"Folder"===e.plmType||"LibrarySection_AllLibraries"===e.plmType?e.expand({expandLevel:"All"}):e.expandAll())})},CollapseAllCmd:function(e,t){e.plmType;var i=[];"TREE"===t&&e&&i.push(e),i.length&&i.forEach(function(e){e.collapseAll()})},_addCtxCmd:function(e,i,n,a){var r=!1;"separator"===n.type?r=!0:!1!==n.spaceAvailability&&(r=!0),r&&(t.isWebInWinEnvironment()&&!1===n.webInWinAvailability&&(r=!1),t.isWebInWinEnvironment()||!1!==n.dashboardAvailability||(r=!1)),r&&(a&&("separator"!==a.type||i.length>0)&&i.push(a),i.push(n))},GetContextualMenu:function(t,n){var a,r=this,o=[],s=!!t.white_Click&&t.white_Click;if(void 0===(a=!0===s?a=Folder_CSO.getCurrentFolder():t.nodeModel)&&(a=t),a.isFavorite)return o;var c={label:e.CMDExpandAll,icon:"url("+i.getWebappsAssetUrl("IPClassifyNav","icons/32/I_ExpandAll.png")+")",callback:function(){r.ExpandAllCmd(a,n)},searchAvailability:!0},l={label:e.CMDCollapseAll,icon:"url("+i.getWebappsAssetUrl("IPClassifyNav","icons/32/I_CollapseAll.png")+")",callback:function(){r.CollapseAllCmd(a,n)},searchAvailability:!0};return this._addCtxCmd(n,o,c,{type:"separator"}),this._addCtxCmd(n,o,l),o}}}),define("DS/LibraryActive/service/LibraryActiveWebService",["DS/WAFData/WAFData","DS/PADUtils/PADSettingsMgt","DS/PADUtils/PADUtilsServices","DS/WidgetServices/WidgetServices"],function(e,t,i,n){"use strict";return{favourites:function(e){this._performFetchQuery(e)},get3DSpaceUrl:function(){return new Promise(function(e,t){n.get3DSpaceUrlAsync({onComplete:function(t){e(t)},onFailure:function(e){t(e)}})})},_performFetchQuery:function(e){var i=this;if(!UWA.is(e,"object"))throw new Error("Invalid inputs for LibraryActiveWebService._performFetchQuery");i.get3DSpaceUrl().then(function(n){var a={};UWA.extend(a,e);var r=n+"/cvservlet/fetch/v2";r+="?SecurityContext="+t.getSetting("pad_security_ctx");var o=widget.lang?widget.lang:widget.getValue("lang");a.payload={},a.payload.physicalid=a.ids,a.payload.select_predicate=["ds6w:label","ds6w:type","physicalid"];var s=new Date,c=window.top.dsUserLogin?window.top.dsUserLogin:"unknown";return a.payload.label=("LibraryActiveFetch_"+c+"_"+s.getTime()).replace(new RegExp(" ","g"),"_").replace(new RegExp(",","g"),"").replace(new RegExp("/","g"),"-"),a.method="POST",a.headers={Accept:"application/json","content-type":"application/json","Accept-Language":o},a.type="json",a.data=UWA.Json.encode(a.payload),i._executeRequest(r,a,"Fetch")})},performMultiClassify:function(e){var i=this;if(!UWA.is(e,"object")||!e.data)throw new Error("Invalid inputs for LibraryActiveWebService._performMultiClassify");i.get3DSpaceUrl().then(function(n){var a={};UWA.extend(a,e);var r=n+"/resources/IPClassificationReuse/classifiedItem/addMultipleClassification";r+="?SecurityContext="+t.getSetting("pad_security_ctx");var o=widget.lang?widget.lang:widget.getValue("lang");a.payload={Classes:a.data.Classifications,ClassifyItems:a.data.ItemsToClassify};var s=new Date,c=window.top.dsUserLogin?window.top.dsUserLogin:"unknown";return a.payload.label=("LibraryActiveMultiClassify_"+c+"_"+s.getTime()).replace(new RegExp(" ","g"),"_").replace(new RegExp(",","g"),"").replace(new RegExp("/","g"),"-"),a.method="POST",a.headers={Accept:"application/json","content-type":"application/json","Accept-Language":o},a.type="json",a.data=UWA.Json.encode(a.payload),i._executeRequest(r,a,"performMultiClassify")})},fetchObjectsForFindInTree:function(e){var a=[];if(a.push(new Promise(function(e,t){n.get3DSearchUrlAsync({onComplete:function(t){e(t)},onFailure:function(e){t(e)}})})),this.getSecurityContext()||a.push(this.initSecurityContext()),!UWA.is(e,"object"))throw new Error("Invalid inputs for LibraryActiveWebService.fetchObjectsForFindInTree");var r=this,o={};UWA.extend(o,e),Promise.allSettled(a).then(function(n){var a=n[0].value+"/search",s=widget.lang?widget.lang:widget.getValue("lang");o.payload={},o.payload.locale=s,e.searchFTSquery&&(o.payload.query="[ds6w:label]: *"+e.searchFTSquery+"*"),e.rscIdToSearch&&(o.payload.query="physicalid:"+e.rscIdToSearch),o.payload.select_bo=["physicalid","ds6w:type","ds6w:globalType","ds6w:label"],"LibrarySection_AllLibraries"===e.type?o.payload.specific_source_parameter={"3dspace":{search_in_context:{expand:{root_path_physicalid:e.pid,type_filter_rel:["Subclass"]}}}}:o.payload.specific_source_parameter={"3dspace":{search_in_context:{expand:{root_physicalid:e.pid,type_filter_rel:["Subclass"]}}}},o.payload.nresults=100,o.payload.source=["3dspace"],o.payload.login={"3dspace":{SecurityContext:r._securityContext}};var c=new Date,l=window.top.dsUserLogin?window.top.dsUserLogin:"unknown";return o.payload.label=("LibraryActiveFetchObjectsForFindInTree_"+l+"_"+c.getTime()).replace(new RegExp(" ","g"),"_").replace(new RegExp(",","g"),"").replace(new RegExp("/","g"),"-"),o.timeout=12e4,o.method="POST",o.payload.tenant=i.getPlatformId()||t.getSetting("x3dPlatformId"),o.headers={Accept:"application/json","content-type":"application/json","Accept-Language":s,SecurityContext:t.getSetting("pad_security_ctx")},o.type="json",o.data=UWA.Json.encode(o.payload),r._executeRequest(a,o,"_fetchObjectsForFindInTree")})},_executeRequest:function(t,i,n){var a=Math.round(1e3*Math.random()).toString(),r=widget.id+"_"+widget.getTitle()+"_";window.top.performance.mark("libraryRequest_begin"+a);var o={};return UWA.extend(o,i),UWA.is(o.onTimeout,"function")||(o.onTimeout=function(){o.onFailure({type:"timeout",toString:function(){return"Request timed out"}})},o.onComplete=function(e){window.top.performance.mark("libraryRequest_end"+a);var t=window.top.performance.getEntriesByName("libraryRequest_begin"+a);t&&1===t.length&&(window.top.performance.measure(r+"_Request"+n,"libraryRequest_begin"+a,"libraryRequest_end"+a),window.top.performance.clearMarks("libraryRequest_end"+a),window.top.performance.clearMarks("libraryRequest_begin"+a)),i.onComplete(e)}),e.authenticatedRequest(t,o)}}}),define("DS/LibraryActive/LibraryActive",["DS/IPClassifyActive/IPClassifyActive","DS/IPClassifyActive/utils/IPClassifyActiveUtil","DS/IPClassifyActive/service/IPClassifyActiveWebService","DS/LibraryActive/service/LibraryActiveWebService","i18n!DS/LibraryActive/assets/nls/LibraryActive","DS/WebappsUtils/WebappsUtils","DS/LibraryActive/commands/LibraryActiveCommands","DS/LibraryActive/service/LibraryTypeService","text!DS/LibraryActive/assets/LibraryActive_setting.json","DS/IPClassifyUtil/IPClassifyUtility","DS/IPClassifyUtil/IPClassifyPreference","DS/WidgetServices/WidgetServices","i18n!DS/LibraryActive/assets/nls/LibraryActiveFindInTree"],function(e,t,i,n,a,r,o,s,c,l,d,u,p){"use strict";var y=r.getWebappsAssetUrl("LibraryEditor","icons/librarysectionall.png"),f=r.getWebappsAssetUrl("LibraryEditor","icons/libraryfavorites.png");return e.extend({name:"LibraryActive",_rootNodeFavorite:null,_rootNodeFolders:null,_rootNodeTrash:null,_requestInfo:{},_searchKeys:{},_pathInfo:{},_subBookmarkExpand:{},_favoriteSection:s.TYPE_FAVORITES_SECTION,_allSection:s.TYPE_LIBRARIES_SECTION,_supportedTypesForDropAtFindIn:["General Class"],_findInTreeNLS:p,init:function(e){if(this._LibraryActiveWebService=Object.assign({},i),this._LibraryActiveWebService.fetchObjectsForFindInTree=n.fetchObjectsForFindInTree,this._LibraryActiveWebService.performMultiClassify=n.performMultiClassify,this._LibraryActiveWebService.getSearchQuery=function(){if(e.multiSelectionComponent&&e.multiSelectionComponent.rootLibraries){var t=e.multiSelectionComponent.rootLibraries;if(Array.isArray(t)&&t.length>0){var i="";return t.forEach(function(e){i=i?i+" OR "+e:e}),"physicalid: ("+i+') AND flattenedtaxonomies:"types/General Library"'}return'flattenedtaxonomies:"types/General Library"'}return'flattenedtaxonomies:"types/General Library"'},this._LibraryActiveWebService.navigatePathRelArray=function(){return["Subclass"]},this._LibraryActiveWebService.getType_filter_bo=function(){return["General Library","General Class"]},this._LibraryActiveWebService.generateSearchQuery=function(e,t){return'(flattenedtaxonomies:("types/General Library" OR "types/General Class")) AND (label: *'+e+"*)"+(t?' AND NOT physicalid: "'+t+'"':"")},this._LibraryActiveWebService.getLabel=function(e){return"IPClass-"+(window.top.dsUserLogin?window.top.dsUserLogin:"unknown")+"-"+(new Date).getTime()},this._LibraryActiveWebService.getSpecific_source_parameter=function(e,t){return{"3dspace":{search_in_context:{expand:{root_physicalid:e,expand_iter:t?"-1":"1",type_filter_bo:["General Library","General Class"]}}}}},e.multiSelectionComponent&&!e.multiSelectionComponent.NLS&&(e.multiSelectionComponent.NLS=a.multiSelectionComponent,e.multiSelectionComponent.componentTitle&&(e.multiSelectionComponent.NLS.widget_name=e.multiSelectionComponent.componentTitle),e.multiSelectionComponent.OKButtonLabel&&(e.multiSelectionComponent.NLS.button_OK=e.multiSelectionComponent.OKButtonLabel)),e.dataProvider={},e.dataProvider.widgetEventsProvider={set:"LibraryActive.onSet",classify:"LibraryActive.onClassify",cancel:"LibraryActive.onCancel",selection:"LibraryEditor.Public.Library"},e.dataProvider.widgetDataProvider={isValidType:function(e){return s.inFamilyLibrary(e)},getObjectForPublication:function(e){return e&&s.inFamilyLibrary(e.getType())?{objectID:e.getID(),objectLabel:e.getLabel()}:null},getWidgetName:function(){return e.topBarLabel?e.topBarLabel:a.activeClassification_cmd},getWidgetIcon:function(){return e.panelIcon?e.panelIcon:"library"},getSettings:function(){return JSON.parse(c)}},this._parent(e),u.isReplayedODT()){var t=this.nestedMenuInContext.popover.getContent().id;window[t]=this}},_getWebServiceRef:function(){return this._LibraryActiveWebService},onSetActive:function(e){e&&"function"==typeof e&&(this.onSetActive=e)},_getPlmType:function(e){return e},_getRootIcon:function(){return y},_getFavoritesIcon:function(){return f},_getRootName:function(){return a.name_Section_AllLibraries},_getFavoritesName:function(){return a.name_Section_FavoriteLibraries},_getActiveIcon:function(e){return e?"wux-ui-3ds wux-ui-3ds-wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-library-class":"library-class"},_getFocusBtnTooltip:function(){return a.activeClassification_btn_focus},_showMessageWhileEmpty:function(e){return e?a.activeClassification_msg_empty:a.activeClassification_msg_noclassfoud},_getIcon:function(e){return(e&&"General Class"!==e.type&&"General Class"!==e.plmType?"General Library"===e.type?{iconName:"library"}:null:{iconName:"library-class"})||e.icon||e.icons&&e.icons[0]||""},couldBeExpand:function(e){return"General Library"===e.plmType||"General Class"===e.plmType},couldBeValid:function(e){e&&e.getID&&e.getID();if(e&&e.getType){if(e.getType())return"General Class"===e.getType();if("General Class"===e.plmType)return!0}return!1},_setFavorites:function(e){var t=Array.isArray(e.favoriteFolders)?e.favoriteFolders:[e.favoriteFolders],i=l.getTenantAwarePreferenceName("ipcFavoriteList_v1");d.set(i,t,!1,!1),e.onComplete(t)},getFavorites:function(e){return this._getWebServiceRef().getUserPreferences({name:l.getTenantAwarePreferenceName("ipcFavoriteList_v1"),onComplete:function(i){var a={};if(i&&i.length>0&&"{}"!==i){var r=JSON.parse(t.jsonUnzip(i)),o=[];if(r.forEach(function(e){o.push(e.id),a[e.id]=e.name}),o.length<=0)return void e.onComplete(o);n.favourites({ids:o,onComplete:function(t){for(var i=t.results?t.results:[],n=[],r=0;r<i.length;++r){for(var o={},s=i[r].attributes,c=0;c<s.length;++c)"physicalid"===s[c].name?o.id=s[c].value:"ds6w:type"===s[c].name&&(o.plmType=s[c].value,o.type=s[c].value);o.name=a[o.id],n.push(o)}e.onComplete&&e.onComplete(n)}})}else e.onComplete&&e.onComplete([])},onFailure:function(t){e.onFailure&&e.onFailure(t)}})},_getContextualMenu:function(e,t){return o.GetContextualMenu(e,t)}})}),define("DS/LibraryActive/commands/ActionBar_ActiveClassificationCmd",["DS/ApplicationFrame/CommandCheckHeader","i18n!DS/LibraryActive/assets/nls/LibraryActive","DS/IPClassifyActive/utils/IPClassifyActiveCommunication","DS/IPClassifyActive/utils/IPClassifyActiveUtil","DS/LibraryActive/LibraryActive"],function(e,t,i,n,a){"use strict";return e.extend({labelTopBar:t.activeClassification_cmd,isInsert:!0,datas:{},_activeClassificationId:"",_activeClassification:{},init:function(e){var t=this;this._parent(e,{mode:"exclusive",isAsynchronous:!1});var r=widget.getValue("activeClassification_"+widget.id);if(r){r=n.jsonUnzip(r);try{r=JSON.parse(r)}catch(e){r=null}}var o=widget.getValue("activeClassification_pause_"+widget.id);if((!r||!r.id)&&o){o=n.jsonUnzip(o);try{o=JSON.parse(o)}catch(e){o=null}}r&&r.id&&(this._activeClassificationId=r.id,this.dispatchEvent(r.id,r.label),this.setState(!0,!1)),i.subscribe("LibraryEditor.ActiveLibraryCallBack",function(e){null!==e||i.publish("LibraryEditor.ActiveLibrary",t._activeClassification)}),this.onStateChange(function(){t.popover||(t.popover=new a({container:document.body.querySelector('[data-command="ActionBar_ActiveClassificationCmd"]')}),r&&r.id?t.popover.nestedMenuInContext.setActiveNode(r.id,r.label):o&&o.id&&t.popover.nestedMenuInContext.setActiveNode_pause(o.id,o.label),t.popover.showPopover(),t._checkAndUpdateState(),t.popover.addEvent("onSetActive",function(e){t._activeClassificationId=e.getID?e.getID():"",t.setState(e,!1);var i=e.getID?e.getID():"",a=e.getLabel?e.getLabel():"";t.dispatchEvent(i,a);var r={id:i,label:a};if(r=JSON.stringify(r),r=n.jsonZip(r),widget.setValue("activeClassification_"+widget.id,r),e.isPause){var o=JSON.stringify(e.isPause);o=n.jsonZip(o),widget.setValue("activeClassification_pause_"+widget.id,o)}else widget.setValue("activeClassification_pause_"+widget.id,{id:"",label:""})})),t._checkAndUpdateState()})},dispatchEvent:function(e,t){this._activeClassification={origin:widget.id,id:e,label:t,sc:widget.getPreference("pad_security_ctx")&&widget.getPreference("pad_security_ctx").value},i.publish("LibraryEditor.ActiveLibrary",this._activeClassification)},_checkAndUpdateState:function(){var e=this;this._activeClassificationId&&!0!==this.getState()?setTimeout(function(){e.setState(!0,!1)},0):this._activeClassificationId||!1===this.getState()||setTimeout(function(){e.setState(!1,!1)},0)}})}),define("DS/LibraryActive/commands/ActionBar_MultipleClassificationCmd",["UWA/Core","DS/ApplicationFrame/Command","DS/PADUtils/PADContext","DS/LibraryActive/LibraryActive","DS/PADUtils/PADSettingsMgt"],function(e,t,i,n,a){"use strict";return t.extend({labelTopBar:e.i18n("Classify In Libraries"),init:function(e){this.context=i.get(),this._parent(e,{mode:"exclusive",isAsynchronous:!1})},execute:function(e,t){if(!e){e={};var r=[];if(this.context||(this.context=i.get()),this.context&&this.context.getSelectedNodes&&this.context.getSelectedNodes().forEach(function(e){r.push(e.id)}),r.length>0&&(e.objects=r),this.context||(this.context=i.get()),this.context&&this.context.getInitParams){var o=this.context.getInitParams();o&&(o.securityContext&&(e.securityContext=o.securityContext),o.tenantId&&(e.tenantId=o.tenantId))}}if(t||(this.context||(this.context=i.get()),this.context&&this.context.getClassifCustomization&&(t=this.context.getClassifCustomization())),t||(t={}),e.securityContext&&a.setSetting("pad_security_ctx",e.securityContext),e.tenantId&&a.setSetting("x3dPlatformId",e.tenantId),e.objects||"Chooser"===t.launchMode){var s=new n({selectionMode:t.selectionMode||"DefaultMulti",dialogButtons:t.dialogButtons||!0,favoriteButton:t.favoriteButton||!0,multiSelectionComponent:{withClassify:e.objects.length>0||"Classify"===t.launchMode,inputObjects:e.objects,launchDialog:!0,rootLibraries:t.RootLibraries,componentTitle:t.ComponentTitle,OKButtonLabel:t.OKButtonLabel},couldBeValid:function(e,t,i){var n=!1,a=2===arguments.length,r=t.getSelectedNodes(),o=r.length;if(t&&o>0){if(0==i&&o>1)return!1;if(t.getRoots()[0].isSelected()||t.getRoots()[1].isSelected())return!1;n=!0;for(var s=0;s<r.length;++s)if(a&&"General Library"===r[s].getType()){n=!1;break}}return n},couldBeSelected:function(e){return!0}}),c=s.nestedMenuInContext.nestedMenu;c&&c.popover&&(c.popover.height=400,c.popover.width=350),s.nestedMenuInContext.addEvent("onClassifyMultiple",function(t){console.log("onClassifyMultiple published, data = "+t.chosenClasses),console.log("Selected End Items paramData = "+e.objects)}),s.nestedMenuInContext.addEvent("onSelectorCancel",function(e){console.log("onSelectorCancel published")})}},endExecute:function(){}})}),define("DS/LibraryActive/LibrarySelectorWebInWin",["UWA/Widget","DS/i3DXCompass/Data","DS/PADUtils/PADProbes","DS/PADUtils/PADSettingsMgt","DS/PADUtils/PADUtilsServices","DS/IPClassifyUtil/IPClassifyUtility","DS/LibraryActive/LibraryActive","DS/IPClassifyActive/utils/IPClassifyActiveCommunication","DS/IPClassifyActive/utils/WidgetDataProvider","UWA/Drivers/Alone"],function(e,t,i,n,a,r,o,s,c,l){var d=window.librarySelector.params;window.widget=new e,console.log("Inside LibrarySelectorWebInWin"),widget.setValue("noCompass",!0),d.userId&&(window.top.dsUserLogin=d.userId),n.setSetting("pad_security_ctx",d.securityContext);var u=r.getTenantId();u?(widget.setValue("x3dPlatformId",u),n.setSetting("x3dPlatformId",u)):d.tenantId&&n.setSetting("x3dPlatformId",d.tenantId),widget.body=UWA.createElement("div",{class:"librarySelector",styles:{height:"100%",width:"100%"}}),t.initialize({myAppsBaseUrl:d.myAppsUrl,userId:d.userId,passportUrl:"",proxyTicketUrl:""}),document.body.innerHTML="",window.top.performance.mark("createWidget_begin"),a.app_initialization(function(){var e=new o({selectionMode:d.selectionMode,dialogButtons:"true"===d.dialogButtons,favoriteButton:"true"===d.favoriteButton,multiSelectionComponent:{withClassify:"Classify"===d.launchMode,inputObjects:d.objects,rootLibraries:d.RootLibraries,componentTitle:d.ComponentTitle,OKButtonLabel:d.OKButtonLabel},couldBeValid:function(e,t,i){var n=!1,a=2===arguments.length,r=t.getSelectedNodes(),o=r.length;if(t&&o>0){if(0==i&&o>1)return!1;if(t.getRoots()[0].isSelected()||t.getRoots()[1].isSelected())return!1;n=!0;for(var s=0;s<r.length;++s)if(a&&"General Library"===r[s].getType()){n=!1;break}}return n},couldBeSelected:function(e){return!0}});widget.body.setContent(e.nestedMenuInContext.getMultiSelectorContainer()),widget.body.inject(document.body,"top"),e.nestedMenuInContext.addEvent("onClassifyMultiple",function(e){console.log("onClassifyMultiple published, data = "+e.chosenClasses);var t=c.getEventNameProvider();t&&t.classify&&s.publish(t.classify,e.chosenClasses,!0)}),e.nestedMenuInContext.addEvent("onSelectorCancel",function(e){console.log("onSelectorCancel published");var t=c.getEventNameProvider();t&&t.cancel&&s.publish(t.cancel,!0,!0)})}),widget.dispatchEvent("onLoad"),widget.dispatchEvent("onRefresh"),widget.dispatchEvent("onDestroy"),widget.dispatchEvent("onResize")});