define("DS/MPFInvoiceComponent/InvoiceUploadModal",["UWA/Core","UWA/Class/View","DS/PlatformAPI/PlatformAPI","DS/UIKIT/Modal","DS/UIKIT/Mask","DS/UIKIT/Alert","DS/UIKIT/Input/Button","DS/UIKIT/Input/File","DS/MPFView/FieldTextInputV2","DS/MPFCartModel/CartModel","DS/MPFInvoiceModel/InvoiceDocumentModel","DS/MPFCartPaymentModel/CartPaymentModel","DS/MPFServices/ObjectService","i18n!DS/MPFInvoiceComponent/assets/nls/InvoiceComponent","css!DS/MPFUI/MPFUI","css!DS/MPFInvoiceComponent/MPFInvoiceComponent"],function(e,t,n,i,o,s,a,r,c,l,d,h,u,m){"use strict";var v,p={INVOICE_UPLOADED:"invoiceUploaded"};return(v=t.extend({setup:function(e){u.requiredOfPrototype(this.model,l,"options.model must be a CartModel"),u.requiredOfPrototype(e.invoiceDocument,d,"options.invoiceDocument must be an InvoiceDocumentModel"),this.cart=this.model,this.cartPayment=e.cartPayment,this.invoiceDocument=e.invoiceDocument,this.isPaymentPerPhase=e.isPaymentPerPhase,this.alert=this._createAlert(),this.warningMessage=this._createWarningMessage(),this.invoiceNumberField=this._createInvoiceNumberField(),this.invoiceFileField=this._createInvoiceFileField(),this.saveButton=this._createSaveButton(),this.cancelButton=this._createCancelButton(),this.modal=this._createModal()},render:function(){var e,t;return e=[this.alert,this.warningMessage,this.invoiceNumberField.render(),this.invoiceFileField],t=[this.saveButton,this.cancelButton],this.modal.setBody(e),this.modal.setFooter(t),this.modal.show(),this},validate:function(){var e,t;return e=this.invoiceNumberField.validate().isValid,t=this._validateIvoiceFileField(),e&&t},save:function(){var e=this;o.mask(this.modal.getBody()),this.saveButton.load(),this.cancelButton.disable(),this.validate()?this._saveSelectedFile().then(this._saveCartOrPayment.bind(this)).then(function(){o.unmask(e.modal.getBody()),e.saveButton.load(!1),e.cancelButton.enable(),e.modal.hide(),n.publish("MPCartTimeline",{event:"refresh",cartId:e.cart.id}),e.dispatchEvent(p.INVOICE_UPLOADED)}).catch(function(){o.unmask(e.modal.getBody()),e.saveButton.load(!1),e.cancelButton.enable(),e.alert.add({className:"error",visible:!0,message:m.get("anErrorOccured")})}):(o.unmask(this.modal.getBody()),e.saveButton.load(!1),e.cancelButton.enable())},reset:function(){this.invoiceNumberField.resetValue(),this.fileInput.clear(),this._removeRedBorders()},destroy:function(){this.modal.destroy(),this.invoiceNumberField.destroy(),this.cart=null,this.invoiceDocument=null,this._parent(),this.container=null},_saveSelectedFile:function(){var e=this.fileInput.getContent().getElement("input").files[0];return this.invoiceDocument.saveFile(e)},_saveCart:function(){var e={};return e[l.Fields.BUYER_INVOICE_DOCUMENT_PID]=this.invoiceDocument.id,e[l.Fields.BUYER_INVOICE_NUMBER]=this.invoiceNumberField.getValue(),this.cart.savePromise(e,{patch:!0})},_savePayment:function(){var e={};return e[h.Fields.BUYER_INVOICE_DOCUMENT_PID]=this.invoiceDocument.id,e[h.Fields.BUYER_INVOICE_NUMBER]=this.invoiceNumberField.getValue(),this.cartPayment.savePromise(e,{patch:!0})},_saveCartOrPayment:function(){return this.isPaymentPerPhase?this._savePayment():this._saveCart()},_createAlert:function(){return new s({closable:!0,visible:!0,autoHide:!0,maximumVisibleMessages:2})},_createWarningMessage:function(){return e.createElement("div",{class:"alert-message alert-warning alert-has-icon",html:[{tag:"span",class:"icon fonticon"},{tag:"span",text:m.get("uploadWarning")}]})},_createInvoiceNumberField:function(){return new c({model:this.cart,fieldName:l.Fields.BUYER_INVOICE_NUMBER,fieldLabel:m.get("invoiceNumber"),required:!0,readOnly:!1,dynamicValidation:!0})},_createInvoiceFileField:function(){return this.fileInput=new r({buttonText:m.get("invoiceFile"),events:{onChange:this._validateIvoiceFileField.bind(this)}}),e.createElement("div",{class:"mpf-invoice-file-input mpf-entry-v2",html:[{tag:"label",html:[{tag:"span",class:"mpf-label",html:[m.get("invoiceOrderDocument"),'&nbsp;<span class="mpf-required">*</span>']},this.fileInput]}]})},_createSaveButton:function(){return new a({className:"primary",value:m.get("uploadInvoice"),events:{onClick:this.save.bind(this)}})},_createCancelButton:function(){var e=this;return new a({value:m.get("cancel"),events:{onClick:function(){e.modal.hide()}}})},_createModal:function(){return new i({renderTo:document.body,header:m.get("invoiceUpload"),className:"mpf-invoice-upload-modal",events:{onHide:this.reset.bind(this)}})},_validateIvoiceFileField:function(){var e;return(e=!!this.fileInput.getValue())?this.invoiceFileField.removeClassName("mpf-invalid"):this.invoiceFileField.addClassName("mpf-invalid"),e},_removeRedBorders:function(){this.invoiceFileField.removeClassName("mpf-invalid")}})).Events=Object.freeze(p),v}),define("DS/MPFInvoiceComponent/ProceedToPaymentNoticeComponent",["UWA/Class/View","DS/MPFNoticeComponent/ImportantNoticeComponent","i18n!DS/MPFInvoiceComponent/assets/nls/InvoiceComponent"],function(e,t,n){"use strict";return e.extend({setup:function(e){e=e||{},this.showExplanationLink=!1!==e.showExplanationLink,this.notice=this._createNotice()},render:function(){return this.container.setContent(this.notice.render()),this},destroy:function(){this.notice.destroy(),this.notice=null,this._parent(),this.container=null},_createNotice:function(){return new t({message:n.get("proceedToPayment"),linkText:this.showExplanationLink?n.get("learnMoreAboutDifferedPayment"):null,linkUrl:this.showExplanationLink?"/faq/proceed-to-deferred-payment":null})}})}),define("DS/MPFInvoiceComponent/ProceedToPaymentNoticeBodyComponent",["UWA/Core","UWA/Class/View","i18n!DS/MPFInvoiceComponent/assets/nls/InvoiceComponent"],function(e,t,n){"use strict";return t.extend({setup:function(e){console.warn("This component is deprecated. Please do not use it anymore."),e=e||{},this.message=this._createMessage(),!1!==e.showExplanationLink&&(this.link=this._createLink())},render:function(){return this.container.setContent([this.message,this.link]),this},_createMessage:function(){return e.createElement("p",{text:n.get("proceedToPayment")})},_createLink:function(){return e.createElement("a",{href:"/faq/proceed-to-deferred-payment",text:n.get("learnMoreAboutDifferedPayment"),target:"_blank"})}})}),define("DS/MPFInvoiceComponent/InvoiceUploadNoticeComponent",["UWA/Class/View","DS/MPFNoticeComponent/ImportantNoticeComponent","DS/MPFInvoiceComponent/InvoiceUploadModal","DS/MPFCartModel/CartModel","DS/MPFInvoiceModel/InvoiceDocumentModel","DS/MPFServices/ObjectService","i18n!DS/MPFInvoiceComponent/assets/nls/InvoiceComponent"],function(e,t,n,i,o,s,a){"use strict";var r,c={INVOICE_UPLOADED:"invoiceUploaded"};return(r=e.extend({setup:function(e){s.requiredOfPrototype(this.model,i,"options.model must be a CartModel"),s.requiredOfPrototype(e.invoiceDocument,o,"options.invoiceDocument must be a InvoiceDocumentModel"),this.cart=this.model,this.cartPayment=e.cartPayment,this.invoiceDocument=e.invoiceDocument,this.purchaseOrder=e.purchaseOrder,this.isPaymentPerPhase=e.isPaymentPerPhase,this.showExplanationLink=!1!==e.showExplanationLink,this.notice=this._createNotice(),this.modal=this._createModal(),this.listenTo(this.notice,t.Events.BUTTON_CLICKED,this._showModal.bind(this)),this.listenTo(this.modal,n.Events.INVOICE_UPLOADED,this._onInvoiceUploaded.bind(this))},render:function(){return this.container.setContent([this.notice.render(),this.modal]),this},destroy:function(){this.stopListening(),this.notice.destroy(),this.modal.destroy(),this.notice=null,this.modal=null,this.cart=null,this.cartPayment=null,this.invoiceDocument=null,this._parent(),this.container=null},_showModal:function(){this.modal.render()},_onInvoiceUploaded:function(){this.dispatchEvent(c.INVOICE_UPLOADED)},_createNotice:function(){return new t({message:[{tag:"p",text:a.get("invoicePaymentNoticeMessage")},{tag:"p",text:a.get("invoiceInfoNoticeMessage",this.purchaseOrder.getNumber(),this.purchaseOrder.getLabel())}],linkUrl:this.showExplanationLink?"/faq/proceed-to-deferred-payment":null,linkText:this.showExplanationLink?a.get("learnMoreAboutDifferedPayment"):null,buttonLabel:a.get("uploadInvoice")})},_createModal:function(){return new n({model:this.cart,cartPayment:this.cartPayment,invoiceDocument:this.invoiceDocument,isPaymentPerPhase:this.isPaymentPerPhase})}})).Events=Object.freeze(c),r}),define("DS/MPFInvoiceComponent/InvoiceUploadNoticeBodyComponent",["UWA/Core","UWA/Class/View","DS/UIKIT/Input/Button","DS/MPFInvoiceComponent/InvoiceUploadModal","DS/MPFCartModel/CartModel","DS/MPFInvoiceModel/InvoiceDocumentModel","DS/MPFServices/ObjectService","i18n!DS/MPFInvoiceComponent/assets/nls/InvoiceComponent"],function(e,t,n,i,o,s,a,r){"use strict";var c,l={INVOICE_UPLOADED:"invoiceUploaded"};return(c=t.extend({className:"clearfix",setup:function(t){console.warn("This component is deprecated. Please do not use it anymore."),a.requiredOfPrototype(this.model,o,"options.model must be a CartModel"),a.requiredOfPrototype(t.invoiceDocument,s,"options.invoiceDocument must be an InvoiceDocumentModel"),this.cart=this.model,this.cartPayment=t.cartPayment,this.invoiceDocument=t.invoiceDocument,this.purchaseOrder=t.purchaseOrder,this.isPaymentPerPhase=t.isPaymentPerPhase,this.uploadModal=new i({model:this.cart,cartPayment:this.cartPayment,invoiceDocument:this.invoiceDocument,isPaymentPerPhase:this.isPaymentPerPhase}),this.listenTo(this.uploadModal,i.Events.INVOICE_UPLOADED,this._onInvoiceUploaded.bind(this)),this.firstMessage=e.createElement("p",{text:r.get("invoicePaymentNoticeMessage")}),this.secondMessage=e.createElement("p",{text:r.get("invoiceInfoNoticeMessage",this.purchaseOrder.getNumber(),this.purchaseOrder.getLabel())}),!1!==t.showExplanationLink&&(this.link=e.createElement("a",{href:"/faq/proceed-to-deferred-payment",text:r.get("learnMoreAboutDifferedPayment"),target:"_blank"})),this.uploadInvoiceButton=new n({className:"primary",value:r.get("uploadInvoice"),events:{onClick:this.uploadModal.render.bind(this.uploadModal)}})},render:function(){var e;return e=[this.firstMessage,this.secondMessage,this.link,this.uploadInvoiceButton],this.container.setContent(e),this},destroy:function(){this.stopListening(this.uploadModal),this._parent()},_onInvoiceUploaded:function(){this.dispatchEvent(l.INVOICE_UPLOADED)}})).Events=Object.freeze(l),c});