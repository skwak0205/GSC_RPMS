/*!  COPYRIGHT DASSAULT SYSTEMES 2014   */
define("DS/SNSearchUX/InContextSearch",["UWA/Core","UWA/Class","UWA/Class/Options","UWA/Class/Debug","UWA/Class/Collection","UWA/Promise","UWA/Utils","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/SearchCom","DS/SNInfraUX/SearchUtils","DS/SNInfraUX/PredefinedQueries","DS/SNInfraUX/SearchPreferences","require","DS/MessageBus/MessageBus","DS/SNInfraUX/Logger"],function(e,t,i,n,s,a,r,o,c,h,l,d,u,g,p){"use strict";return t.extend(i,n,{_socket:null,_registered_search_ctx:null,_isWidgetMaximized:!1,_pubsub_loaded:!1,init:function(t){this.setDebugMode(o.getDebugMode()),this._socket=c.createSocket({socket_id:"incontextsearch_socket_id"}),this.setOptions(t);var i=this;u(["DS/PubSub/PubSub"],function(t){i._pubsub_loaded=!0,e.is(t)&&t.add("onViewChange",function(t){var n,s,a,r=t.widgetId||t.id,c=!1;if(e.is(e.Widgets)&&e.is(e.Widgets.instances)&&(e.Widgets.instances.filter(function(t){return e.is(t.id)&&-1!==t.id.indexOf("preview")&&!t.events.onDestroy}).forEach(function(e){e.addEvent("onDestroy",function(){i.computeSearchBar&&i.computeSearchBar()})}),s=(s=e.Widgets.instances.filter(function(e){return e.id===r})).length>0?s[0]:null),a=e.is(i.getOption("addinMode"),"string")||e.is(s)&&s.getValue("stayOnSearch")||!1,e.is(s)&&!0===s.getValue("noSearchModeChange")&&(c=!0),e.is(i._registered_search_ctx)&&e.is(i.getInContextOptions(r)))(n=i.getInContextOptions(r)).id===r&&("maximized"===t.type||"fullscreen"===t.type?(i._isWidgetMaximized=!0,e.is(n.search_delegation)&&"3ddashboard"===n.search_delegation&&!a?!0===o.getOption("find_in_this_tab_default")&&i._socket.dispatchEvent("onSetFindInTab",n):a||(i._socket.dispatchEvent("onSetInAppContext",{isInAppContext:!0}),i._socket.dispatchEvent("onSetFindInApp",n))):"windowed"!==t.type&&"minimized"!==t.type||(i._isWidgetMaximized=!1,i._socket.dispatchEvent("onSetInAppContext",{isInAppContext:!1}),!0!==o.getOption("find_in_this_tab_default")||a?i._socket.dispatchEvent("clickOnChoiceSearch",{resetNLS:!0,focus:!1}):i._socket.dispatchEvent("onSetFindInTab",null)));else{if(e.is(s)&&(s&&"X3DSEAR_AP"===s.getValue("appId")&&i._socket.dispatchEvent("3DSearchWidgetmaximized",t.type),s&&"X3DSEAR_AP"===s.getValue("appId")&&("maximized"===t.type||"fullscreen"===t.type)||"3DSearch"===s.title&&-1<s.id.indexOf("preview")))return void(i._isWidgetMaximized=!0);"windowed"!==t.type&&"minimized"!==t.type||(i._isWidgetMaximized=!1,i._socket.dispatchEvent("onSetInAppContext",{isInAppContext:!1}),!0!==o.getOption("find_in_this_tab_default")||a||!1===c&&i._socket.dispatchEvent("onSetFindInTab",null))}})}),e.is(t.addinMode,"string")&&require(["DS/PlatformAPI/PlatformAPI"],function(e){i.log("InContextSearch: addinMode found, start subscribing to webinwin:win:notification"),e.subscribe("webinwin:win:notification",i._onWinNotif.bind(i))}),this._socket.addListener("RegisterContext",this._registerContext.bind(this)),this._socket.addListener("TemporaryBypassFedsearch",this._temporaryBypassFedsearch.bind(this)),this._socket.addListener("InContextSearch",this._inContextSearch.bind(this)),this._socket.addListener("UnregisterContext",this._unregisterContext.bind(this))},_onWinNotif:function(t){if(e.is(t,"object")&&e.is(t.event,"string")&&e.is(t.content,"object"))switch(t.event){case"RegisterContext":this.log("webinwin:win:notification for RegisterContext notif received, options="+JSON.stringify(t)),this._registerContext(t.content);break;case"InContextSearch":this.log("webinwin:win:notification for InContextSearch notif received, options="+JSON.stringify(t)),this._inContextSearch(t.content)}else this.log("webinwin:win:notification does not contain info in expected format")},getInContextOptions:function(t){var i,n=this._registered_search_ctx.get({id:t});return e.is(n)&&(i=n.toJSON()),i},_registerContext:function(t){this.log("Register Search Context"),p.groupCollapsed("Incontext Parameters(Register)>>"),p.log(t),p.groupEnd();this._addAdvSearchOption(t),e.is(this._registered_search_ctx)||(this._registered_search_ctx=new s),this._cleanSourceValue(t),this._cleanOrderFields(t);var i=this.getInContextOptions(t.widget_id);e.is(i)?(this.log("A Context in already registered for Widget Id "+t.widget_id+". Update it"),this._registered_search_ctx.remove({id:t.widget_id}),t.id=t.widget_id,this._registered_search_ctx.add(t)):(this.log("Register the context for Widget Id "+t.widget_id),t.id=t.widget_id,this._registered_search_ctx.add(t)),this._socket.dispatchEvent("RegisterContext_Response",t,t.app_socket_id)},_amIAMaximizedWidget:function(t){return!(!e.is(e.Widgets)||!e.is(e.Widgets.instances))&&0!==e.Widgets.instances.filter(function(e){return e.id===t&&"maximized"===e.getView().type}).length},_temporaryBypassFedsearch:function(t){if(e.is(t.bypass_url))if(e.is(this._registered_search_ctx)){var i={id:t.widget_id},n=this._registered_search_ctx.where(i);if(e.is(n)&&n.length>0)for(var s=0;s<n.length;s++)e.is(n[s])&&e.is(n[s]._attributes)&&(n[s]._attributes.bypass_url=t.bypass_url);else this.log("No context registered with Widget Id "+t.widget_id)}else this.log("No context registered")},_inContextSearch:function(t){this.log("In Context search Activated"),p.groupCollapsed("Incontext Parameters(Search)>>"),p.log(t),p.groupEnd();var i=this;i._addAdvSearchOption(t);var n={inCtx_widget_id:t.widget_id};this._promise=new a(function(n){!0===t.default_with_precond&&e.is(t.default_search_criteria)&&t.default_search_criteria.length>0?t.default_search_criteria.indexOf(":")>0?require(["DS/SNResultUX/utils/WildcardMgr"],function(e){i._socket.dispatchEvent("fetchPQsFromServer"),l.getPQFetchPromise().then(function(){var i=e.manageWildcardAddtion(t.default_search_criteria);i=h.replacePQsWithCVPrefixes(i),n(i)})}):require(["DS/SNResultUX/utils/WildcardMgr"],function(e){var i=e.manageWildcardAddtion(t.default_search_criteria,{addWildCard_inCtx:t.addWildCard});n(i)}):n()}),this._promise.then(function(s){delete i._promise,i._promise=null,!0===t.default_with_precond?(e.is(t.default_search_criteria)&&t.default_search_criteria.length>0&&(n.value=s,n.displayValue=e.is(t.search_criteria_to_display)?t.search_criteria_to_display:t.default_search_criteria,n.searchStringToDisplayInSearchField=e.is(t.search_criteria_to_display)?t.search_criteria_to_display:t.default_search_criteria),e.is(t.precond)&&t.precond.trim().length>0&&(e.is(n.value)&&n.value.trim().length>0?n.value=n.value+" AND "+t.precond:n.value=t.precond),e.is(t.displayValue)&&(n.searchStringToDisplayInSearchField=t.displayValue)):n.focus=!0,e.is(t.global_actions)&&(n.incontext_global_actions=t.global_actions),e.is(t.itemViewClickHandler)&&t.itemViewClickHandler.trim().length>0&&(n.itemViewClickHandler=t.itemViewClickHandler),i._cleanSourceValue(t),n.source=t.source,e.is(t.tenant)&&(n.tenant=t.tenant),e.is(t.advanced_search)&&(n.advanced_search=t.advanced_search,n.advanced_search.default_search_criteria=n.value),e.is(t.recent_search)&&(n.recent_search=t.recent_search),n.savedSearch=t.savedSearch;var a={id:t.widget_id},r=i._registered_search_ctx.where(a);if(e.is(r)&&r.length>0){if(1!==r.length)throw new Error("2 search context have been registered for the same Widget Id "+t.widget_id);i.log("A Context in already registered for Widget Id "+t.widget_id+". Update it");var o=r[0].toJSON();e.is(t.context_title,"string")?(i._registered_search_ctx.remove({id:t.widget_id}),o.context_title=t.context_title,i._registered_search_ctx.add(o)):e.is(o.context_title,"string")&&(i._registered_search_ctx.remove({id:t.widget_id}),delete o.context_title,i._registered_search_ctx.add(o))}e.is(i.getOption("addinMode"))&&(n.forceWidgetUXRecreation=!0),n.tag_filter=t.tag_filter,n.refine=t.tag_filter,h.autocompleteRendered().then(function(){function e(){i._socket.dispatchEvent("onInContextSearch",{inContextOptions:t,placeholder:void 0}),i._socket.dispatchEvent("search",n)}if(i._hasGlobalChannelSubscriptipons()){g.publish({channel:"GLOBAL_3DSEARCH_MESSAGE_CHANNEL_ID",topic:"checkSidePanelStatus"});var s=g.subscribe({channel:"GLOBAL_3DSEARCH_MESSAGE_CHANNEL_ID",topic:"InContextInit",callback:function(){e(),g.unsubscribe(s)}});g.publish({channel:"GLOBAL_3DSEARCH_MESSAGE_CHANNEL_ID",topic:"activateInContextSearch",data:t})}else e()})})},_addAdvSearchOption:function(t){!0===o.getOption("forceAdvancedSearch",{tenant:t.tenant?t.tenant:h.getActiveTenant()})&&"socket_id_#saved_search_edit#"!=t.app_socket_id&&e.is(t.advanced_search,"object")&&(t.advanced_search.showByDefault=!0,t.advanced_search.searchOnInit=!1)},_hasGlobalChannelSubscriptipons:function(){var t=g.getSubscriptions({channel:"GLOBAL_3DSEARCH_MESSAGE_CHANNEL_ID",topic:"activateInContextSearch"});return e.is(t,"array")&&t.length>0},_cleanOrderFields:function(t){e.is(t.order_field,"array")&&t.order_field.length>0&&e.is(t.order_by,"array")&&t.order_by.length>0?(t.order_field=t.order_field[0],t.order_by=t.order_by[0]):(t.order_field=void 0,t.order_by=void 0)},_cleanSourceValue:function(t){e.is(t.source)&&e.is(t.source,"string")&&(t.source=[t.source])},_unregisterContext:function(t){this.log("Unregister search Context"),p.groupCollapsed("Incontext Parameters(Un-Register)>>"),p.log(t),p.groupEnd();var i=t;if(e.is(i,"string")&&(i={widget_id:t,widgetId:t}),e.is(this._registered_search_ctx)){var n={id:i.widget_id},s=this._registered_search_ctx.where(n);e.is(s)&&s.length>0?this._registered_search_ctx.remove({id:i.widget_id}):this.log("No context registered with Widget Id "+i.widget_id)}else this.log("No context registered")}})}),define("DS/SNSearchUX/utils/SearchViewEvents",["UWA/Core","UWA/Utils","UWA/Controls/Abstract","DS/PubSub/PubSub","DS/SNInfraUX/Logger","i18n!DS/SNSearchUX/assets/nls/SNSearchUX.json"],function(e,t,i,n,s,a){"use strict";return i.extend({init:function(t){e.is(t)&&e.is(t.searchView)?(this.searchView=t.searchView,this.setup()):s.error("Initialization of Search view events failed")},setup:function(){n.add("search.scope:tab",function(t){e.is(that.topBarMenu)&&this.searchView.topBarMenu._clickOnSearchInCurrentTab(t)}.bind(this)),n.add("search:showLastSearchResult",function(t,i){e.is(this.searchView.topBarMenu)&&!this.searchView.topBarMenu._inAppContext&&this.searchView.topBarMenu.currentMode!==a.search_current_tab&&(this.searchView.topBarMenu.showLastSearch(),this.searchView.reSearch=!0,this.searchView.reSearchQuery={value:t,searchStringToDisplayInSearchField:i})}.bind(this)),n.add("tab:change",function(){n.dispatch("SearchQuery",[""]),e.is(this.searchView.topBarMenu)&&e.is(this.searchView.topBarMenu.currentMode)&&this.searchView.topBarMenu.currentMode===a.search_current_tab&&this.searchView.autocomplete.setFieldValue("")}.bind(this)),n.add("onViewSearch",function(t){e.is(t)&&e.is(t.displayString)&&e.is(t.query)?this.searchView.socket.dispatchEvent("search",{value:t.query,searchStringToDisplayInSearchField:t.displayString,source:t.source,testing:t.objectToPreview}):this.searchView._onSearch()}.bind(this))}})}),define("DS/SNSearchUX/SearchUxPowerBy",["UWA/Core","UWA/Class","UWA/Class/Options","UWA/Class/Debug","UWA/Class/Collection","UWA/Promise","UWA/Utils","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/SearchUtils","DS/MessageBus/MessageBus","DS/SNInfraUX/Logger","DS/PlatformAPI/PlatformAPI"],function(e,t,i,n,s,a,r,o,c,h,l,d){"use strict";return t.extend(i,n,{_local_actions:"server",_mode:null,init:function(e){this.setDebugMode(o.getDebugMode()),this.setOptions(e);var t=o.getOption("searchprotocolv2");e.addinMode&&t||c.setPowerByInitDone(),t&&(d.subscribe("webinwin:win:notification",this._onWinNotif.bind(this)),d.publish("webinwin:web:notification",JSON.stringify({event:"search_options_init",content:{}}))),this._subscribeToLocalActionsRequests()},_subscribeToLocalActionsRequests:function(){h.subscribe({channel:"SearchUXPowerByIntegration",topic:"HasPowerByActionsReq",callback:this._hasPowerByActions.bind(this)}),h.subscribe({channel:"SearchUXPowerByIntegration",topic:"PowerByActionsReq",callback:this._getPowerByActions.bind(this)})},_onWinNotif:function(t){if(e.is(t,"object")&&e.is(t.event,"string")&&e.is(t.content,"object"))switch(t.event){case"search_options_set":this.log("webinwin:win:notification for search_options_set notif received, options="+JSON.stringify(t)),this._setPowerByOptions(t.content);break;case"search_contextualaction_set":this.log("webinwin:win:notification for search_contextualaction_set notif received, options="+JSON.stringify(t)),this._setPowerByActions(t.content)}else this.log("webinwin:win:notification does not contain info in expected format")},_setPowerByOptions:function(e){["incontext","sidebar"].indexOf(e.mode)>-1&&(this._mode=e.mode),["local","server","none"].indexOf(e.local_actions)>-1?this._local_actions=e.local_actions:this._local_actions="server",c.setPowerByInitDone()},_setPowerByActions:function(e){var t=this._mapPowerByActions(e);h.publish({channel:"SearchUXPowerByIntegration",topic:"PowerByActionsRes",data:t})},_mapPowerByActions:function(e){return e.actions.forEach(function(e){e.actions.forEach(function(e){e.sourcejs="DS/SNResultUX/utils/PowerByActionsHandler"})}),e},_hasPowerByActions:function(e){h.publish({channel:"SearchUXPowerByIntegration",topic:"HasPowerByActionsRes",data:"none"===this._local_actions?"local":this._local_actions})},_getPowerByActions:function(e){if("none"===this._local_actions){var t={actions:[],status:"success"};e.objects.forEach(function(e){var i={id:e.id,actions:[]};t.actions.push(i)}),this._setPowerByActions(t)}else d.publish("webinwin:web:notification",JSON.stringify({event:"search_contextualaction_get",content:e}))}})}),define("DS/SNSearchUX/SuggestionUXHelper",["UWA/Core","UWA/Class","UWA/Class/Debug","UWA/Promise","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/SearchResultCategories"],function(e,t,i,n,s,a){"use strict";return t.singleton(i,{init:function(){},getSuggestionCategories:function(){return a.getActiveCategories(this.ResultCategoryUXHelper._getTenant(),"suggestion")},getSuggestHelper:function(){var e=this;return this._suggestHelperPromise||(this._suggestHelperPromise=new n(function(t,i){require(["DS/SNResultUX/utils/ResultCategoryUXHelper"],function(i){e.ResultCategoryUXHelper=i,i.getResultCategoryUXHelper().then(function(){t()})})})),this._suggestHelperPromise},getSuggests:function(e){return this.ResultCategoryUXHelper.getCategoryResultsCollectionPromise("suggestion",e)},buildSearchParams:function(t){return this.ResultCategoryUXHelper.buildSearchParams(e.extend({group:"suggestion"},t))}})}),define("DS/SNSearchUX/SearchHistoric",["UWA/Core","UWA/Class","UWA/Class/Debug"],function(e,t,i){"use strict";return t.singleton(i,{history:{},init:function(){},getHistoric:function(){return e.is(localStorage.SNSearchBoxStore)?JSON.parse(localStorage.SNSearchBoxStore):[]},setHistoricInLocalStorage:function(){var e=this.getHistoric();localStorage.SNSearchBoxStore=JSON.stringify(e)},storeValueInDataBase:function(t){if(!e.is(t,"string"))throw new Error("null value given to SearchView._storeValueInLocalStorage!");if(!(t.trim().length<=0)){var i=this.getHistoric();if(-1===i.indexOf(t))i.length>=100&&i.shift(),i.push(t);else{var n=i.indexOf(t),s=i[n];i.splice(n,1),i.push(s)}localStorage.SNSearchBoxStore=JSON.stringify(i)}}})}),define("DS/SNSearchUX/SearchSecondaryMenu",["UWA/Core","UWA/Element","UWA/Controls/Abstract","UWA/Promise","DS/SNInfraUX/Logger","DS/SNInfraUX/SearchUtils","DS/SNInfraUX/SearchRessources","DS/SNInfraUX/SearchCom","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/SNSearchTypeCusto","DS/SNInfraUX/SearchPreferences","DS/SNInfraUX/PlatformEnvServices","DS/UIKIT/DropdownMenu","DS/UIKIT/Input/Toggle","DS/PlatformAPI/PlatformAPI","DS/MessageBus/MessageBus","DS/PubSub/PubSub","DS/UIKIT/SuperModal","i18n!DS/SNSearchUX/assets/nls/SNSearchUX.json","text!DS/SNSearchUX/assets/templates/SearchInformation.html","DS/WebappsUtils/WebappsUtils","DS/SNUQLEditor/SNUQLEditorUX"],function(e,t,i,n,s,a,r,o,c,h,l,d,u,g,p,_,S,m,f,v,C,y){"use strict";return i.extend({_secondaryMenu:null,_autocomplete:null,_socket:null,currentMode:null,currentSearch:null,_secondaryOptionToHide:[],searchTabId:null,src_ressource:null,_searchOptionDividerId:"searchOptionDivider",_predefinedQueryDividerId:"predifinedQueryDivider",_inAppContext:!1,_inContextOptions:null,_AsyncSearchDropdownPromise:n.deferred(),_temporarilyOutOfContext:null,init:function(e){var t=this;this._buildSecondaryMenu(e),p.subscribe("search.secondaryMenu:lastSearchResults",function(){t.clickOnLastSearchResult()})},_buildSecondaryMenu:function(t){var i=this;if(e.is(t)&&(this._secondaryOptionToHide=[],e.is(t.socket)&&(this._socket=t.socket),e.is(t)&&e.is(t.secondaryMenuOptions)&&e.is(t.secondaryMenuOptions.hideTenantMenu)&&!0===t.secondaryMenuOptions.hideTenantMenu&&(this.hideTenantMenu=!0),e.is(t.autocomplete)&&e.is(t.target))){this._autocomplete=t.autocomplete,this._autocomplete.secondaryMenu=this,this.currentSearch=f.searchNew;var n=f.get("find_in_tab.shortHelp");"3DSwym"===a.identifyClientInfo().identifier&&(n=f.get("find_in_page.shortHelp"));let r=[];a.identifyClientInfo()&&"3DSwym"===a.identifyClientInfo().identifier?r=[{id:"betaDivider",className:"divider"},{text:f.searchNew,className:"secondaryMenuSearch",fonticon:"search",title:f.get("search.shortHelp")},{text:f.search_current_tab,className:"secondaryMenuSearchInCurrentTab",fonticon:"filter",title:n},{text:f.adv_search,className:"secondaryMenuAdvanced",fonticon:"search-cog",title:f.get("adv_search.shortHelp")},{id:i._searchOptionDividerId,className:"divider"},{text:f.LastSearchResults,className:"secondaryMenuLastSearch",fonticon:"search-recent",title:f.get("LastSearchResults.shortHelp")},{text:f.MySavedSearches,className:"secondaryMenuFavorite",fonticon:"favorite-on",title:f.get("MySavedSearches.shortHelp")},{text:f.mycontent,className:"secondaryMenuMyContent",fonticon:"user",title:f.get("mycontent.shortHelp")},{id:i._predefinedQueryDividerId,className:"divider"},{text:f.PredefinedQuery,className:"secondaryMenuPQ",fonticon:"help",title:f.get("PredefinedQuery.shortHelp")},{text:f.SearchOptions,className:"secondaryMenuOptions",fonticon:"cog",title:f.get("SearchOptions.shortHelp")}]:a.identifyClientInfo()&&"3DDashboard"===a.identifyClientInfo().identifier?(r=[{id:"betaDivider",className:"divider"},{text:f.searchNew,className:"secondaryMenuSearch",fonticon:"search",title:f.get("search.shortHelp")},{text:f.informationAction,className:"secondaryMenuInfo",fonticon:"info",title:f.get("info.shortHelp")},{text:f.adv_search,className:"secondaryMenuAdvanced",fonticon:"search-cog",title:f.get("adv_search.shortHelp")},{id:i._searchOptionDividerId,className:"divider"},{text:f.LastSearchResults,className:"secondaryMenuLastSearch",fonticon:"search-recent",title:f.get("LastSearchResults.shortHelp")},{text:f.MySavedSearches,className:"secondaryMenuFavorite",fonticon:"favorite-on",title:f.get("MySavedSearches.shortHelp")},{text:f.mycontent,className:"secondaryMenuMyContent",fonticon:"user",title:f.get("mycontent.shortHelp")},{id:i._predefinedQueryDividerId,className:"divider"},{text:f.PredefinedQuery,className:"secondaryMenuPQ",fonticon:"help",title:f.get("PredefinedQuery.shortHelp")},{text:f.SearchOptions,className:"secondaryMenuOptions",fonticon:"cog",title:f.get("SearchOptions.shortHelp")}],!0===c.getOption("ExpertMode")&&r.push({text:"ExpertQuery",className:"secondaryMenuExpertQuery",fonticon:"text",title:"Expert Query"})):r=[{id:"betaDivider",className:"divider"},{text:f.searchNew,className:"secondaryMenuSearch",fonticon:"search",title:f.get("search.shortHelp")},{text:f.adv_search,className:"secondaryMenuAdvanced",fonticon:"search-cog",title:f.get("adv_search.shortHelp")},{id:i._searchOptionDividerId,className:"divider"},{text:f.LastSearchResults,className:"secondaryMenuLastSearch",fonticon:"search-recent",title:f.get("LastSearchResults.shortHelp")},{text:f.MySavedSearches,className:"secondaryMenuFavorite",fonticon:"favorite-on",title:f.get("MySavedSearches.shortHelp")},{text:f.mycontent,className:"secondaryMenuMyContent",fonticon:"user",title:f.get("mycontent.shortHelp")},{id:i._predefinedQueryDividerId,className:"divider"},{text:f.PredefinedQuery,className:"secondaryMenuPQ",fonticon:"help",title:f.get("PredefinedQuery.shortHelp")},{text:f.SearchOptions,className:"secondaryMenuOptions",fonticon:"cog",title:f.get("SearchOptions.shortHelp")}];let o,h=c.getOption("addinmode");if(-1===["solidworks","catiav5"].indexOf(h)&&(!0!==(o=a.isFUN109031Active())&&!1!==o&&(o=!1),r.push({text:f.SearchBETA,className:"secondaryMenuBETA",fonticon:"checkbox-"+(o?"on":"off"),title:f.get("SearchBETA.shortHelp"),selected:o})),!0===(o=l.getItem("FUN110569-state")))for(var s=0;s<r.length;s++)r[s].text===f.informationAction&&r.splice(s,1);this._secondaryMenu=new u({className:"searchOptionMenu",maxItemsBeforeScroll:50,items:r,position:"bottom left",offset:{y:-3,x:0},target:t.target,closeOnClick:!0,events:{onClick:function(t,n){switch(_.publish({channel:"SearchTrackerApi",topic:"hit",data:{category:"OneSearch",action:"dropdownbeta",persDim:{pd14:n.name,pd15:n.className}}}),n.name){case f.searchNew:var s=i._autocomplete._getClearSearchBtn();(""!==i._autocomplete.getInputValue()||e.is(s.isHidden)&&!1===s.isHidden())&&i._searchInCurrentTab(""),i._clickOnSearch(),i._autocomplete._findInthisTabOnClick(!1),""!==i._autocomplete.getInputValue()&&i._onViewSearch();break;case f.search_current_tab:"3DSwym"===a.identifyClientInfo().identifier?(i._clickOnSearchInCurrentTab(),""!==i._autocomplete.getInputValue()&&i._onViewSearch()):i._clickOnInformation();break;case f.informationAction:i._clickOnInformation();break;case f.adv_search:i._clickOnAdvancedSearch(t);break;case f.LastSearchResults:i.clickOnLastSearchResult();break;case f.MySavedSearches:i._clickOnFavoriteSearches(t);break;case f.mycontent:i._clickOnMyContent(t);break;case f.PredefinedQuery:i._autocomplete._showPQSelectionUX();break;case f.SearchOptions:i._clickOnSearchOptions(t);break;case f.SearchBETA:i._clickOnSearchBETA(t);break;case"ExpertQuery":console.log("Expert mode query invocked..."),i._launchUQLEditor();break;default:e.is(n.className)&&n.className.contains("secondaryMenuTenant")&&!n.className.contains("Selector")&&(i._autocomplete._setPlaceHolderValue(f.search+" "+n.name),i.src_ressource.setActiveTenant(n.attributes.tenantId),i._updateMenuOnTenantSelection(n.attributes.tenantId),i._autocomplete.options.events.setSourceCStorage(i.getCurrentTenant().tenantId),""!==i._autocomplete.getInputValue()&&i._onViewSearch())}},onShow:function(){},onHide:function(){}}}),this._toggleDropDownMenuItem(f.LastSearchResults,"hide"),e.is(c.getOption("search_compact_mode"))&&!0===c.getOption("search_compact_mode")&&this._setSecondaryHiddenOptionsPermanent([f.adv_search,f.MySavedSearches,f.PredefinedQuery,f.SearchOptions],!0),("3DDashboard"!==a.identifyClientInfo().identifier||c.getOption("addinmode"))&&this._setSecondaryHiddenOptionsPermanent([f.informationAction],!1)}},_launchUQLEditor:function(){new y},_clickOnInformation:function(){var t=this._autocomplete.getInputValue();e.is(t)&&S.dispatch("3DSearch:open3DDSearchInTab",{query:t,submit:!0})},setInContextState:function(e){this._inContext=e},setInAppContext:function(t){if(!1===t.setInAppContext&&(this._inContextOptions=null),this._inAppContext=t.isInAppContext,!0===t.isInAppContext&&e.is(t.data)&&e.is(t.data.search_criteria_to_display,"string")?this._autocomplete.setFieldValue(t.data.search_criteria_to_display):this.currentMode!==f.search_current_tab&&this._autocomplete.setFieldValue(""),t.isInAppContext&&e.is(t.data)&&e.is(t.data.search_criteria))switch(t.data.search_criteria){case a.SearchTypeEnum.MY_CONTENT:this._clickOnMyContent({focus:!1});break;case a.SearchTypeEnum.FAVORITE_SEARCH:this._clickOnFavoriteSearches({focus:!1});break;case a.SearchTypeEnum.ADVANCED_SEARCH:this._clickOnAdvancedSearch({focus:!1})}this._temporarilyOutOfContext=!1},setFindInContext:function(t,i){this._setFindInContext(t),e.is(i)?this._autocomplete._setPlaceHolderValue(i):this._isMenuItemHidden(f.select_tenant)||this._autocomplete._setPlaceHolderValue(f.get("search"))},_setFindInContext:function(t){var i=this;this._autocomplete._internalSearchCriteria=null,this._autocomplete.elements.input.readOnly=!1,e.is(t.widget_id)&&"widget_id_#saved_search_edit#"!==t.widget_id?this._toggleDropDownMenuItem(f.LastSearchResults,"hide"):this.editFavoriteSearchMode(t);var n=!1;t&&t.UXOptions&&!1===t.UXOptions.menuMyFavorites&&(n=!0),n&&this._AsyncSearchDropdownPromise.promise.then(function(){i._toggleDropDownMenuItem(f.MySavedSearches,"hide")});var s=!1;t&&t.UXOptions&&!1===t.UXOptions.menuMyContent&&(s=!0),s&&this._toggleDropDownMenuItem(f.mycontent,"hide"),e.is(t)&&e.is(t.tenant)?(this._autocomplete.options.events.setSourceCStorage(t.tenant),this.setCurrentTenant(t.tenant),this._clickOnSearch({focus:!1})):this._autocomplete.options.events.setSourceCStorage(this.getCurrentTenant());var a=!0;t&&t.advanced_search&&(a=!1,t.advanced_search.exclusive&&this._toggleDropDownMenuItem(f.searchNew,"hide")),a&&this._AsyncSearchDropdownPromise.promise.then(function(){i._toggleDropDownMenuItem(f.adv_search,"hide")});this._AsyncSearchDropdownPromise.promise.then(function(){i._toggleDropDownMenuItem(f.PredefinedQuery,"hide")}),this._inContextOptions=t},restoreAppContext:function(e){if(this._inAppContext&&e&&(!e.in_apps_search||e.in_apps_search.widget_id!==this._inContextOptions.widget_id))return!1;this._autocomplete.elements.suggestsContainer.getChildren().forEach(function(e){e.show()}),e&&e.in_apps_search&&e.in_apps_search.advanced_search&&e.in_apps_search.advanced_search.exclusive&&this._toggleDropDownMenuItem(f.searchNew,"show"),this.setInAppContext({isInAppContext:!1}),this.currentMode===f.searchNew?this._clickOnSearch({focus:!1,noFocus:!0}):this.currentMode===f.search_current_tab&&this.clickOnSearchInTab()},editFavoriteSearchMode:function(t){this._toggleDropDownMenuItem(f.MySavedSearches,"hide"),this._toggleDropDownMenuItem(f.mycontent,"hide"),e.is(t)&&e.is(t.advanced_search)?this._toggleDropDownMenuItem(f.adv_search,"show"):this._toggleDropDownMenuItem(f.adv_search,"hide"),this._toggleDropDownMenuItem(f.PredefinedQuery,"hide"),this._toggleDropDownMenuItem(f.search_current_tab,"hide"),this._toggleDropDownMenuItem(f.searchNew,"show")},_onViewSearch:function(){S.dispatch("onViewSearch")},showLastSearch:function(){this._toggleDropDownMenuItem(f.LastSearchResults,"show")},_switchSearchMode:function(){l.getItem("searchMode")===f.searchNew?this._clickOnSearch():l.getItem("searchMode")===f.search_current_tab&&this._clickOnSearchInCurrentTab()},_searchInCurrentTab:function(t,i){e.is(i)?S.dispatch("SearchQuery",[t,i]):S.dispatch("SearchQuery",[t])},_toggleDropDownMenuItem:function(t,i){if(!(e.is(this._secondaryOptionToHide)&&e.is(this._secondaryOptionToHide.length)&&this._secondaryOptionToHide.length>0&&this._secondaryOptionToHide.indexOf(t)>=0)&&e.is(this._secondaryMenu)&&e.is(this._secondaryMenu.items)){if(e.is(t)){var n=this._findDropDownMenuItem(t);e.is(n)&&e.is(n.elements)&&e.is(i)&&("show"===i?this._showItem(n):"hide"===i&&this._hideItem(n))}var s=this._findDropDownMenuItem(f.LastSearchResults),a=this._findDropDownMenuItem(f.MySavedSearches),r=this._findDropDownMenuItem(f.mycontent),o=this._findDropDownMenuDivider(this._searchOptionDividerId);s.elements.container.isHidden()&&a.elements.container.isHidden()&&r.elements.container.isHidden()?this._hideItem(o):this._showItem(o);var c=this._findDropDownMenuItem(f.PredefinedQuery),h=this._findDropDownMenuDivider(this._predefinedQueryDividerId);c.elements.container.isHidden()?this._hideItem(h):this._showItem(h)}},_hideItem:function(t){var i="";e.is(t)&&e.is(t.className)&&(i=t.className+" ");var n={id:t.id,className:i+"secondaryMenuHidden"};this._secondaryMenu.updateItem(n)},_showItem:function(t){if(e.is(t)&&e.is(t.className)){var i=t.className;i.contains("secondaryMenuHidden")&&(i=i.replace(/secondaryMenuHidden/g,""));var n={id:t.id,className:i};this._secondaryMenu.updateItem(n)}},_isMenuItemHidden:function(t){if(e.is(t)){var i=this._findDropDownMenuItem(t);return!(!e.is(i.className)||!i.className.contains("secondaryMenuHidden"))}return null},_setSecondaryHiddenOptions:function(t){switch(e.is(t)||(t=""),this._toggleDropDownMenuItem(f.MySavedSearches,"show"),this._toggleDropDownMenuItem(f.mycontent,"show"),this._toggleDropDownMenuItem(f.adv_search,"show"),this._toggleDropDownMenuItem(f.Howtosearch,"show"),this._toggleDropDownMenuItem(f.search_current_tab,"show"),this._toggleDropDownMenuItem(f.SearchOptions,"show"),this._toggleDropDownMenuItem(f.PredefinedQuery,"show"),this._toggleDropDownMenuItem(f.SearchBETA,"show"),this.currentSearch===f.search_current_tab?this._toggleDropDownMenuItem(f.PredefinedQuery,"hide"):this._toggleDropDownMenuItem(f.PredefinedQuery,"show"),t){case f.searchNew:this._toggleDropDownMenuItem(f.search_current_tab,"hide");break;case f.MySavedSearches:case f.mycontent:case f.adv_search:this._toggleDropDownMenuItem(f.PredefinedQuery,"hide"),this._toggleDropDownMenuItem(f.search_current_tab,"hide");break;case"inContext":this._toggleDropDownMenuItem(f.search_current_tab,"hide"),this._toggleDropDownMenuItem(f.SearchOptions,"hide"),this._toggleDropDownMenuItem(f.SearchBETA,"hide")}e.is(this._inAppContext)&&!0===this._inAppContext&&(this._toggleDropDownMenuItem(f.SearchOptions,"hide"),this._toggleDropDownMenuItem(f.adv_search,"hide"),this._toggleDropDownMenuItem(f.MySavedSearches,"hide"),this._toggleDropDownMenuItem(f.PredefinedQuery,"hide"),this._toggleDropDownMenuItem(f.SearchBETA,"hide"))},_setSecondaryHiddenOptionsPermanent:function(t,i){if(e.is(i)&&!0===i&&(this._secondaryOptionToHide=[]),e.is(t,"array"))for(var n=0;n<t.length;n++)this._toggleDropDownMenuItem(t[n],"hide"),e.is(this._secondaryOptionToHide)&&this._secondaryOptionToHide.indexOf(t[n])<0&&this._secondaryOptionToHide.push(t[n])},_unsetSecondaryHiddenOptionsPermanent:function(t){if(e.is(t,"array")){for(var i=[],n=0;n<this._secondaryOptionToHide.length;n++)t.includes(this._secondaryOptionToHide[n])||i.push(this._secondaryOptionToHide[n]);this._secondaryOptionToHide=i;for(var s=0;s<t.length;s++)this._toggleDropDownMenuItem(t[s],"show")}},_findDropDownMenuItem:function(t){if(e.is(this._secondaryMenu)&&e.is(this._secondaryMenu.items)){for(var i=0;i<this._secondaryMenu.items.length;i++)if(this._secondaryMenu.items[i].text===t)return this._secondaryMenu.items[i];return{}}},_findDropDownMenuDivider:function(t){if(e.is(this._secondaryMenu)&&e.is(this._secondaryMenu.items)){for(var i=0;i<this._secondaryMenu.items.length;i++)if(this._secondaryMenu.items[i].id===t)return this._secondaryMenu.items[i];return{}}},initTenantOnSecondaryMenu:function(t){if(e.is(this._secondaryMenu)&&e.is(t.sources)){this.src_ressource=new r(t.sources);for(var i=this.src_ressource.getAvailableTenants(),n=this._findDropDownMenuItem(f.select_tenant),s=0;s<i.length;s++)this.src_ressource.active_tenant===i[s].tenantId&&i.length>1&&(this._autocomplete._setPlaceHolderValue(f.search+" "+i[s].displayName),this._autocomplete.setSelectedTenant(i[s].tenantId));if(i.length<=1&&(this._toggleDropDownMenuItem(f.Wheretosearch,"hide"),this._toggleDropDownMenuItem(f.select_tenant,"hide"),1===i.length&&e.is(n)&&e.is(n.elements)&&e.is(n.elements.container)&&e.is(n.elements.container.setAttribute,"function"))){let s=i[0].tenantId;n.elements.container.setAttribute("activetenant",s),e.is(t)&&e.is(t.sources)&&e.is(t.sources.available_tenants,"object")&&e.is(t.sources.available_tenants[s])&&e.is(t.sources.available_tenants[s].displayName)&&n.elements.container.setAttribute("activetenantnls",t.sources.available_tenants[s].displayName)}var o=this;e.is(this.hideTenantMenu)&&!0===this.hideTenantMenu&&this._setSecondaryHiddenOptionsPermanent([f.select_tenant]),a.isRoleAvailable(["CSV"],this.src_ressource.active_tenant,function(e){!0!==e&&o._setSecondaryHiddenOptionsPermanent([f.adv_search,f.MySavedSearches,f.PredefinedQuery,f.SearchOptions]),o._AsyncSearchDropdownPromise.resolve()}),f.search_current_tab===l.getItem("searchMode")&&a.identifyClientInfo()&&"3DDashboard"!==a.identifyClientInfo().identifier?this._clickOnSearchInCurrentTab():this._clickOnSearch()}},isSingleTenant:function(){return!(d.getAvailableTenantsForSearch().length>1)},getCurrentTenant:function(){if(e.is(this.src_ressource)){var t=this.src_ressource.getAvailableTenants();if(this._isMenuItemHidden(f.select_tenant)&&1===t.length){if(e.is(t[0].name))var i={tenantId:t[0].tenantId,tenantName:t[0].name};else i={tenantId:t[0].tenantId,tenantName:t[0].displayName};return i}for(var n=0;n<t.length;n++)if(t[n].tenantId===this.src_ressource.getActiveTenant())return{tenantId:t[n].tenantId,tenantName:t[n].displayName}}return{tenantId:null,tenantName:null}},setCurrentTenant:function(t){if(!this._isMenuItemHidden(f.select_tenant))for(var i=0;i<this._secondaryMenu.items.length;i++)if(e.is(this._secondaryMenu.items[i].attributes)&&e.is(this._secondaryMenu.items[i].attributes.tenantId)&&this._secondaryMenu.items[i].attributes.tenantId===t)return void this._secondaryMenu.toggleSelection(this._secondaryMenu.items[i]);this.src_ressource.setActiveTenant(t)},_manageSecondaryMenuOptions:function(t){var i=[];e.is(t)&&(e.is(t.enable_my_content)&&!1===t.enable_my_content&&i.push(f.mycontent),e.is(t.enable_favorite_searches)&&!1===t.enable_favorite_searches&&i.push(f.MySavedSearches),e.is(t.enable_search_in_this_tab)&&!1===t.enable_search_in_this_tab&&i.push(f.search_current_tab),e.is(t.enable_predefined_query)&&!1===t.enable_predefined_query&&this._toggleDropDownMenuItem(f.PredefinedQuery)),this._setSecondaryHiddenOptionsPermanent(i)},setSelectedPQPrefix:function(e){this._autocomplete._internalSearchCriteria=null,this._autocomplete.setFieldValue(e),this._autocomplete.elements.input.focus(),!0===this._autocomplete._pqSelect&&this._clickOnSearch({focus:!1}),this._autocomplete._pqSelect=!1},_clickOnMyRecentContent:function(t){this._autocomplete._myRecentContentIsActive=!0;this._clickOnSearch({focus:!1});var i="*";!t||"*"===t.paramsFilter||this._autocomplete.getPlaceHolder()!==f.searchNew&&this._autocomplete.getPlaceHolder()!==f.get("myrecentcontent")||(i=this._autocomplete.getInputValue()?this._autocomplete.getInputValue():t.paramsFilter,this._autocomplete.setFieldValue(i)),this._autocomplete._setInternalCriteria(null),this._autocomplete.options.events.setSourceCStorage(this.getCurrentTenant().tenantId),e.is(t,"object")&&e.is(t.focus)&&!1===t.focus||(e.is(t)?this._autocomplete.dispatchEvent("myRecentContent",{sFilter:i,widgetId:t.widgetId}):this._autocomplete.dispatchEvent("myRecentContent",{sFilter:i}))},setSearchMode:function(t){var i={focus:!1};this.currentMode===f.searchNew&&this._isMenuItemHidden(f.select_tenant)?this._clickOnSearch(i):(this.currentMode!==f.searchNew||this._isMenuItemHidden(f.select_tenant))&&(this.currentMode===f.search_current_tab?(e.is(t.noFocus)&&(i=null),this._clickOnSearchInCurrentTab(i)):this.currentMode===f.adv_search?this._clickOnAdvancedSearch(i):this.currentMode===f.mycontent?this._clickOnMyContent(i):this.currentMode===f.MySavedSearches&&this._clickOnFavoriteSearches(i))},selectTenantOnTabActivation:function(t){if(e.is(t,"object")&&e.is(t.tenant,"string")&&t.tenant.length>0){if("OnPremise"===t.tenant||this._isMenuItemHidden(f.select_tenant))return;this.setCurrentTenant(t.tenant),l.setItem("defaultTenantId",t.tenant),l.commit(),this._updateMenuOnTenantSelection(t.tenant)}},_updateMenuOnTenantSelection:function(t){var i=this;a.isRoleAvailable(["CSV"],t,function(t){!0===t?i._inAppContext?(e.is(i._inContextOptions)&&e.is(i._inContextOptions.advanced_search)?i._toggleDropDownMenuItem(f.adv_search,"show"):i._toggleDropDownMenuItem(f.adv_search,"hide"),e.is(i._inContextOptions)&&e.is(i._inContextOptions.UXOptions)&&!1===i._inContextOptions.UXOptions.menuMyFavorites?i._toggleDropDownMenuItem(f.MySavedSearches,"hide"):i._toggleDropDownMenuItem(f.MySavedSearches,"show"),i._toggleDropDownMenuItem(f.PredefinedQuery,"hide")):!0!==c.getOption("search_compact_mode")&&i._unsetSecondaryHiddenOptionsPermanent([f.adv_search,f.MySavedSearches,f.PredefinedQuery,f.SearchOptions]):i._setSecondaryHiddenOptionsPermanent([f.adv_search,f.MySavedSearches,f.PredefinedQuery,f.SearchOptions])})},setCurrentMode:function(e){if(this.currentMode=e,a.isODTMode())switch(e){case f.searchNew:this._autocomplete.elements.input.setAttribute("currentMode","search");break;case f.search_current_tab:this._autocomplete.elements.input.setAttribute("currentMode","searchInCurrentTab");break;case f.adv_search:this._autocomplete.elements.input.setAttribute("currentMode","advancedSearch");break;case f.MySavedSearches:this._autocomplete.elements.input.setAttribute("currentMode","favoriteSearch");break;case f.mycontent:this._autocomplete.elements.input.setAttribute("currentMode","myContent")}},_clickOnSearchOptions:function(t){var i=this;e.is(t)&&e.is(t.stopPropagation,"function")&&t.stopPropagation(),require(["DS/SNResultUX/views/utils/SearchOptionsUI"],function(e){new e({tenant:i.getCurrentTenant()})})},_clickOnSearchBETA:function(e){a.clickOnSearchBETA()},_clickOnSearch:function(t){this.setCurrentMode(f.searchNew),this.currentSearch=f.searchNew;var i=!1;if(e.is(t)&&e.is(t.resetNLS)&&(i=!0),this._autocomplete._adv_Search_activated=!1,l.setItem("searchMode",f.searchNew),l.commit(),this._inAppContext||(this._toggleDropDownMenuItem(f.PredefinedQuery,"show"),this._toggleDropDownMenuItem(f.MySavedSearches,"show")),this._toggleDropDownMenuItem(f.mycontent,"show"),e.is(t)&&e.is(t.hiddenOptions))for(let e=0;e<t.hiddenOptions.length;e++)this._toggleDropDownMenuItem(t.hiddenOptions[e],"hide");this._autocomplete.getPlaceHolder()!==this._autocomplete._findInTabNLS&&(this._autocomplete._isTypeListDone=!0,t={adv_search_field:this._isTypeValue,focus:!1});if(0===this._autocomplete._typeList.length&&(this._autocomplete._typeList=h.getSearchTypeCustoList()),this._autocomplete._isTypeListMode&&this._autocomplete._isTypeListDone&&this._autocomplete._typeList.length&&-1!==this._autocomplete._typeList.indexOf(t.adv_search_field))return this._clickOnAdvancedSearch(t),this._autocomplete._isTypeListMode=!1,void(this._autocomplete._isTypeListDone=!1);this._autocomplete._setInternalCriteria(null),this._autocomplete.elements.input.readOnly=!1,e.is(t,"object")&&e.is(t.focus)&&!0!==t.focus||this._autocomplete.elements.input.focus(),""===this._autocomplete.getInputValue()&&this._autocomplete._hideClearSearchBtn();var n=f.get("search");if(e.is(this.src_ressource)&&this.src_ressource.getAvailableTenants().length>1){var s=this.getCurrentTenant();e.is(s)&&e.is(s.tenantName)&&(n+=" "+s.tenantName)}else n=f.get("searchNew");this._autocomplete._setPlaceHolderValue(n),(e.is(this.src_ressource)&&!e.is(t,"object")||!e.is(t.setTenant)||!1!==t.setTenant)&&this._autocomplete.options.events.setSourceCStorage(this.getCurrentTenant().tenantId);var a=this._autocomplete.getInputValue();i&&(a=""),this._autocomplete.setFieldValue(a)},_clickOnSearchInCurrentTab:function(t){e.is(t)?(e.is(t.name)&&(this._autocomplete._setPlaceHolderValue(f.replace(f.get("find_in_specific_tab"),{tab:t.name})),this._autocomplete._changeSearchBtnIcon("fonticon-filter")),e.is(t.id)&&(this.searchTabId=t.id)):(this._autocomplete._setPlaceHolderValue(f.search_current_tab),this._autocomplete._changeSearchBtnIcon("fonticon-filter")),!0===this._autocomplete.betaProgramState&&this._autocomplete._clearDropDown(),this.setCurrentMode(f.search_current_tab),this.currentSearch=f.search_current_tab,l.setItem("searchMode",f.search_current_tab),l.commit(),this._toggleDropDownMenuItem(f.PredefinedQuery,"hide"),this._autocomplete._findInthisTabOnClick(!0)},clickOnLastSearchResult:function(){this.setCurrentMode(f.searchNew),this.currentSearch=f.searchNew,this._autocomplete.setFieldValue(""),this._autocomplete._setPlaceHolderValue(f.searchNew),this._autocomplete._hideClearSearchBtn(),this._autocomplete.dispatchEvent("onSelect",["","LastSearch"]),this._inAppContext||(this._toggleDropDownMenuItem(f.mycontent,"show"),this._toggleDropDownMenuItem(f.MySavedSearches,"show"),this._clickOnSearch({focus:!1}))},_clickOnAdvancedSearch:function(t){this.setCurrentMode(f.adv_search),this._setSecondaryHiddenOptions(f.adv_search),this._autocomplete._setInternalCriteria(null),this._autocomplete._adv_Search_activated=!0;var i=f.adv_search;e.is(this.src_ressource)&&this.src_ressource.getAvailableTenants().length>1&&(i+=" "+this.getCurrentTenant().tenantName),this._autocomplete._setPlaceHolderValue(i),this._autocomplete.setFieldValue(""),this._autocomplete.elements.input.readOnly=!0,e.is(t,"object")&&e.is(t.setTenant)&&!1===t.setTenant||this._autocomplete.options.events.setSourceCStorage(this.getCurrentTenant().tenantId),e.is(t)&&e.is(t.adv_search_field,"string")&&t.adv_search_field.length>0?this._autocomplete.dispatchEvent("advancedSearch",t.adv_search_field):e.is(t,"object")&&e.is(t.focus)&&!1===t.focus||this._autocomplete.dispatchEvent("advancedSearch")},_clickOnMyContent:function(t){this.setCurrentMode(f.mycontent),this._setSecondaryHiddenOptions(f.mycontent),this._autocomplete._setInternalCriteria(null);var i=f.mycontent;e.is(this.src_ressource)&&this.src_ressource.getAvailableTenants().length>1&&(i+=" "+this.getCurrentTenant().tenantName),this._autocomplete._setPlaceHolderValue(i),this._autocomplete.setFieldValue(""),this._autocomplete._hideClearSearchBtn(),this._autocomplete.elements.input.readOnly=!0,e.is(t,"object")&&e.is(t.setTenant)&&!1===t.setTenant||this._autocomplete.options.events.setSourceCStorage(this.getCurrentTenant().tenantId),e.is(t,"object")&&e.is(t.focus)&&!1===t.focus||this._autocomplete.dispatchEvent("myContent")},_clickOnFavoriteSearches:function(t){this.setCurrentMode(f.MySavedSearches),this._setSecondaryHiddenOptions(f.MySavedSearches),this._autocomplete._setInternalCriteria(null);var i=f.MySavedSearches;e.is(this.src_ressource)&&this.src_ressource.getAvailableTenants().length>1&&(i+=" "+this.getCurrentTenant().tenantName),this._autocomplete._setPlaceHolderValue(i),this._autocomplete.setFieldValue(""),this._autocomplete._hideClearSearchBtn(),this._autocomplete.elements.input.readOnly=!0,_.publish({channel:"GLOBAL_3DSEARCH_MESSAGE_CHANNEL_ID",topic:"manualSwitchToView",data:{view:l.getItem("LastSearchViewMode")}}),e.is(t,"object")&&e.is(t.setTenant)&&!1===t.setTenant||this._autocomplete.options.events.setSourceCStorage(this.getCurrentTenant().tenantId),e.is(t,"object")&&e.is(t.focus)&&!1===t.focus||this._autocomplete.dispatchEvent("favoriteSearches")}})}),define("DS/SNSearchUX/SearchDropDownMobile",["UWA/Core","UWA/Element","UWA/Event","UWA/Utils","UWA/Controls/Abstract","UWA/Utils/InterCom","DS/MessageBus/MessageBus","require","css!DS/SNSearchUX/SNSearchUX.css","DS/SNInfraUX/Logger","DS/SNInfraUX/SearchRessources","DS/SNInfraUX/SearchPreferences","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/SearchUtils","DS/PlatformAPI/PlatformAPI","DS/SNInfraUX/SNSearchTypeCusto","DS/SNInfraUX/PredicatesNLS","DS/SNInfraUX/SearchLogin","DS/SNResultUX/utils/SearchServices","DS/SNResultUX/utils/SearchDoubleClickHandler","UWA/Promise","DS/SNSearchUX/SuggestionUXHelper","DS/Notifications/NotificationsManagerUXMessages","DS/Notifications/NotificationsManagerViewOnScreen","DS/PubSub/PubSub","DS/UIKIT/Spinner","DS/UIKIT/DropdownMenu","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/SNInfraUX/ServiceDelegationLoader","DS/SNResultUX/models/SearchItemModel","DS/SNSearchUX/SearchSecondaryMenu","i18n!DS/SNSearchUX/assets/nls/SNSearchUX.json"],function(e,t,i,n,s,a,r,o,c,h,l,d,u,g,p,_,S,m,f,v,C,y,b,T,w,I,D,A,E,x,O,M){"use strict";var P=!1,N="";return s.extend({_clearSearch:null,_searchBtn:null,_autocompleteSuggests:null,_timeoutId:null,_suggestTimeout:null,_secondTimeoutId:null,_inAppContext:!1,_temporarilyOutOfContext:!1,_inContextOptions:null,_inContextMode:null,_previouslyActiveSource:null,_sitChoice:null,_findInTabNLS:null,_cstoreChoice:[],_cstoreSources:[],_src_ressource:null,_searchStringToDisplayInSearchField:null,_internalSearchCriteria:null,_isTypeListMode:!1,_typeList:[],_suggestionsInPipeline:0,_cancel_suggest_update:!1,_searchResourcesSet:C.deferred(),canvas:null,itemCache:{},serverSuggests:{},dataCache:{},typeTimeout:null,_betaSuggestionTimer:500,init:function(t){if(this._parent(t),e.is(t)&&e.is(t.isBetaOn)&&!0===t.isBetaOn){if(this.betaProgramState=!0,e.is(n.parseQuery(window.location.search).debounce)){var i=parseInt(n.parseQuery(window.location.search).debounce);"number"==typeof i&&(this._betaSuggestionTimer=i)}}else this.betaProgramState=!1;this.buildSkeleton(),this.attachEvents(),this._createCompassClientSocket()},_createCompassClientSocket:function(){this._compass_socket=new a.Socket("com.ds.searchdropdown"),this._compass_socket.subscribeServer("com.ds.compass",window)},refreshCategories:function(){this._getSuggestCategoriesResult(this.getInputValue())},_getSuggestCategoriesResult:function(t){var i=this;t.length>=3?(this._showSuggestSpinner(),this._showCategoryContainer(),clearTimeout(this._categorySuggestTimeout),this._categorySuggestTimeout=setTimeout(function(){y.getSuggestHelper().then(function(){var n=y.getSuggests({search_text:t});Object.keys(n).forEach(function(t){n[t].then(function(n){i.getInputValue().length>=3&&(e.is(n.collection)&&e.is(n.nls)?i._updateCategory(t,n.collection,n.nls,n.collection.hits):e.is(n.nls)&&i._updateCategory(t,[],n.nls,0))},function(e){console.log(t,": ",e)})})})},this._betaSuggestionTimer)):this._clearDropDown()},_addCategoryToDropDown:function(e,i){var n=this,s=t.create("ul",{id:"search-suggests-categories-"+e,class:"search-suggest-category"}).inject(this.elements.categoriesContainer),a=t.create("li",{class:"search-category-label-container"}).inject(s),o=t.create("img",{class:"search-category-img"}).inject(a),c=t.create("div",{class:"search-category-label",html:M.get(e)}).inject(a),h=t.create("div",{class:"search-category-view-all",html:M.get("search.suggestion.viewAll"),title:M.replace(M.get("search.suggestion.tooltip"),{category:e})}).inject(a);return h.addEventListener("click",function(e){r.publish({channel:"SearchTrackerApi",topic:"hit",data:{category:"InstantSearch",action:"ClickOnViewMore",persDim:{pd1:"0"}}}),n._onClickViewAll(i,e)}),this.elements.categories.push({container:s,labelContainer:a,img:o,label:c,viewAll:h,item:[],model:{}}),s},_onClickViewAll:function(t,i){if(!e.is(i)||!i.target.hasClassName("search-category-label-empty")){var n=this.getInputValue(),s=y.buildSearchParams({category_id:t,search_text:n});s.objectToPreview="instantSearch",w.dispatch("onViewSearch",[e.extend({displayString:n},s)])}},_updateCategory:function(i,n,s,a){var r=this;this._hideSuggestSpinner();var o=this.elements.categories.filter(e=>e.container.id.includes(s));if(o.length>0){var c=o[0];if(this._clearCategory(c.container),this._showCategory(c.container),c.label.setText(s+" ("+a+")"),n.length>0){var h,l,d,u;this._activateCategory(c),1===n.length&&c.viewAll.hide();for(var g=0;g<n.length;g++){h=(u=n._models[g]).get("ds6w:label");var p="search-category-item-rounded";if(l=u.get("preview_url"),e.is(l)||(l=u.get("type_icon_url"),p=""),c.item.push(t.create("li",{class:"search-category-item"}).inject(c.container)),(d=c.item[c.item.length-1]).model=u,e.is(u)&&d.addEventListener("click",function(e){r._onClickItem(e)}),e.is(l)&&t.create("img",{src:l,class:p}).inject(d),e.is(h)){var _=t.create("div",{html:h,title:h}).inject(d);r._resizeCategorySuggestion(_)}}c.img.src=u.get("type_icon_url")}else this._deactivateCategory(c)}},_resizeCategorySuggestion:function(e){let t=window.getComputedStyle(e,null).getPropertyValue("font");if(0!==e.offsetWidth&&e.offsetWidth<=this.getTextWidth(e.textContent,t)){for(var i=e.textContent,n=0;n<50&&this.getTextWidth(i+"...")>e.offsetWidth-26;)i=i.slice(0,i.length-2),n++;e.setText(i+"...")}},_onClickItem:function(t){var i=t.currentTarget.model,n=i.getSourceID(),s=i.getServiceID(),a=i.getPlatformID(),o=i.get("resourceid"),c=f.buildCompassSelectionData({widgetId:"",selectedModels:[i]});if(this._compass_socket.dispatchEvent("onSetX3DContent",c),r.publish({channel:"SearchTrackerApi",topic:"hit",data:{category:"InstantSearch",action:"ClickOnResult",persDim:{pd1:"0"}}}),"3dspace"===n){let e=t.target.title;w.dispatch("onViewSearch",[{displayString:e,query:'[ds6w:label]:"'+e+'"'}])}else A.getServiceUrl({serviceName:s,platformId:a,onComplete:function(t){E.load({serviceID:s,platformID:a,serviceURL:t}).then(function(t){if(e.is(t.getDoubleClickAction,"function")){var n={model:i,appID:"X3DSEAR_AP",client_feature:"search_topbar_suggest",onComplete:function(t){e.is(t)&&e.is(t.id,"string")&&e.is(t.sourceJS,"string")&&t.sourceJS.length>0&&require([t.sourceJS],function(e){e.executeAction({action_id:t.id,actionsHelper:{getModel:function(){return i},getPlatformID:function(){return a},getClientInfo:function(){return g.identifyClientInfo("")},getValue:function(e){var t=e.predicate?e.predicate:e.attribute;return i.get(t+"_value")}},object_ids:[o]})})},onFailure:function(e){console.log(e)}};t.getDoubleClickAction.call(void 0,n)}})}})},_clearDropDown:function(){this._hideSuggestSpinner();for(var e=0;e<this.elements.categories.length;e++)this._clearCategory(this.elements.categories[e].container),this._hideCategory(this.elements.categories[e].container);this._hideCategoryContainer()},_clearCategory:function(e){for(var t=e.getChildren(),i=0;i<t.length;i++)t[i].hasClassName("search-category-label-container")||t[i].destroy()},_hideCategory:function(e){this._clearCategory(e),e.hide()},_showCategory:function(e){e.show()},_activateCategory:function(e){e.labelContainer.hasClassName("search-category-label-empty")&&e.labelContainer.removeClassName("search-category-label-empty"),e.viewAll.show()},_deactivateCategory:function(e){e.labelContainer.hasClassName("search-category-label-empty")||e.labelContainer.addClassName("search-category-label-empty"),e.viewAll.hide()},_buildCategories:function(){this.elements.categoriesContainer=t.create("div",{id:"search-suggests-categories",class:"search-suggests-categories"}).inject(this.elements.suggestsContainer),this.elements.categories=[],y.getSuggestHelper().then(function(){for(var e,t=y.getSuggestionCategories(),i=0;i<t.length;i++)e=this._addCategoryToDropDown(t[i].nls,t[i].id),this._hideCategory(e)}.bind(this))},_hideSuggestSpinner:function(){e.is(this.elements.suggestSpinnerContainer)&&this.elements.suggestSpinnerContainer.hide()},_showSuggestSpinner:function(){e.is(this.elements.suggestSpinnerContainer)&&this.elements.suggestSpinnerContainer.show()},_hideCategoryContainer:function(){this.elements.categoriesContainer.isHidden()||this.elements.categoriesContainer.hide()},_showCategoryContainer:function(){this.elements.categoriesContainer.isHidden()&&this.elements.categoriesContainer.show()},setInContextMode:function(e){this._inContextMode=e,!0===e&&!0===this.betaProgramState&&this._clearDropDown()},_suggestPreviousQueries:function(t,i){var n=null,s=null;if(0===this._typeList.length&&(this._typeList=_.getSearchTypeCustoList()),this._isTypeListMode=!1,this._value=i,this._typeList.length&&0===i.length&&(n=this._typeList,this._isTypeListMode=!0),e.is(localStorage.SNSearchBoxStore)){n=JSON.parse(localStorage.SNSearchBoxStore);var a=[];i&&""!==i.replace(/\s+/g,"")?n.forEach(function(e){0===e.indexOf(i)&&e!==i&&a.push(e)}):a=n,s=a.reverse();var r=10;!0===u.getOption("search_compact_mode")&&(r=u.getOption("suggest_max")),!0===this.betaProgramState&&!0!==this._inContextMode&&this.secondaryMenu.currentMode!=M.search_current_tab&&(r=2),s.length>r&&(s=s.slice(0,r)),t.dispatchEvent("onUpdateSuggests",[s]),t.typeTimeout=null}else t.dispatchEvent("onUpdateSuggests",[s]);this.historySuggestions=s},getServerSuggestions:function(t){var i,n=this,s={query:t.replace(/^\s+|\s+$/g,""),input:t.replace(/^\s+|\s+$/g,"").split(" ")};if(e.is(n.secondaryMenu)&&e.is(n.secondaryMenu.getCurrentTenant)&&(i=n.secondaryMenu.getCurrentTenant()),t.length){if(!0===g.isSuggestAvailable(i)){this.getSearchResources().then(function(){m.login({resources:n._src_ressource,onComplete:function(){var t,i;t=u.getOption("suggest_length"),i=u.getOption("suggest_max_length"),s.query.length>t-1&&s.query.length<i&&!e.is(n._inContextOptions)&&n.elements.input.placeholder===n._getPlaceHolderTextDependingOnActiveTenant("searchNew")&&(n._suggestionsInPipeline++,!1===n._src_ressource.getSuggestions(s,function(e){n._suggestionsInPipeline--;var t=(e=e||[]).map(function(e){return{label:e.entry,command:e.entry,icon:"lightbulb"}});n._cancel_suggest_update||t.length>0&&0===n._suggestionsInPipeline&&n.dispatchEvent("onUpdateSuggests",{serverSuggests:t})})&&n._suggestionsInPipeline--)},onFailure:function(){}})})}}else n.dispatchEvent("onUpdateSuggests",{serverSuggests:[]})},getSearchResources:function(){return this._searchResourcesSet.promise},_buildSearchChoice:function(t){var i=t.sources,n=this;r.subscribe({channel:"TopBar_Suggest",topic:"CancelSuggest",callback:function(){n._cancel_suggest_update=!0}});this.elements;if(this.elements.container.addEvent("drop",function(e){var t=null,i=!!document.documentMode,n=!i&&!!window.StyleMedia;if(i||n||""===e.dataTransfer.getData("shortData")){if(""!==e.dataTransfer.getData("text")){var s=JSON.parse(e.dataTransfer.getData("text"));t=[],s.data.items.forEach(function(e){t.push('"'+e.displayName+'"')})}}else e.preventDefault(),t=JSON.parse(e.dataTransfer.getData("shortData"));e.target.value=t.join(" OR "),e.stopPropagation(),e.preventDefault()}),this.elements.container.addEvent("paste",function(t){var i,s=M.search;if(e.is(n.secondaryMenu)&&e.is(n.secondaryMenu.getCurrentTenant)&&(i=n.secondaryMenu.getCurrentTenant()),e.is(i)&&"OnPremise"!==i.tenantId?s+=" "+i.tenantName:s=M.searchNew,n.elements.input.placeholder===s||n.elements.input.placeholder===M.search_current_tab){var a=0;if(e.is(t.target)&&e.is(t.target.selectionStart)&&e.is(t.target.selectionEnd)&&(a=t.target.value.length-(t.target.selectionEnd-t.target.selectionStart)),0===a&&e.is(t)){var r=null;e.is(t.clipboardData)&&e.is(t.clipboardData.getData,"function")?(r=t.clipboardData.getData("text/plain"),n.getServerSuggestions(r)):e.is(window.clipboardData)&&e.is(window.clipboardData.getData,"function")&&(r=window.clipboardData.getData("Text"),n.getServerSuggestions(r));var o="";if(e.is(r,"string")&&r.length>0){var c=r.indexOf("\t")>=0,h=r.indexOf("\n")>=0,l=r.indexOf("||")>=0,d=r.indexOf("&&")>=0,g=r.indexOf("\\&&")>=0,p=r.indexOf("\\||")>=0;if(!1===c&&!1===h&&!1===l&&!1===d)return void n._showClearSearchBtn();var _=r.split("\n"),S="",m=!1;if(e.is(_,"array")&&_.length>0){for(var f=0,v=_.length;f<v;f++)if(e.is(_[f],"string")&&(_[f]=_[f].trim(),_[f].length>0)){var C=null,y="AND";c=(S=_[f]).indexOf("\t")>=0,l=S.indexOf("||")>=0,d=S.indexOf("&&")>=0,g=S.indexOf("\\&&")>=0,p=S.indexOf("\\||")>=0,!0===g&&(S=S.replace(/\\\&/g,"##__##")),!0===p&&(S=S.replace(/\\\|/g,"__##__")),!0===c?C=S.split("\t"):!0===d?C=S.split("&&"):!0===l?(C=S.split("||"),y="OR"):C=[S];for(var b="",T=0,w=C.length;T<w;T++)e.is(C[T],"string")&&(C[T].trim(),C[T].length>0&&(!0===g&&(C[T]=C[T].replace(/##__##/g,"&")),!0===p&&(C[T]=C[T].replace(/__##__/g,"|")),b.length>0&&(b+=" "+y+" "),C[T].length>1&&'"'===C[T][0]&&'"'===C[T][C[T].length-1]&&(C[T]=C[T].substr(1,C[T].length-2)),C[T]=C[T].replace(/\\([\s\S])|(")/g,"\\$1$2"),b+='"'+C[T]+'"'));b.length>0&&(!0===m&&(o+=" OR "),v>1&&(o+="("),o+=b,v>1&&(o+=")"),m=!0)}var I=u.getOption("maxTopBarInput");o.length>I&&(o=o.substring(0,I)),t.target.value=o,o.length>0&&n._showClearSearchBtn(),t.stopPropagation(),t.preventDefault()}}}}}),e.is(i)||(i=this.options.allSources),!e.is(i,"object"))throw new Error("Invalid value for allSources in SearchAutocomplete._buildSearchChoice!");i.loadPredicates=!0,this._src_ressource=new l(i),this._searchResourcesSet.resolve(),this._cstoreSources=this._src_ressource.getAvailableTenants(),this._cstoreSources.length>1&&(P=!0),e.is(this._cstoreSources,"array")&&this._cstoreSources.length>0&&(N=this._cstoreSources[0].tenantId),g.setAutocompleteRendered()},_getSearchBtn:function(){return null===this._searchBtn&&(this._searchBtn=e.extendElement(document.body).getElement(".run_btn_search")),this._searchBtn},_changeSearchBtnIcon:function(t){var i=this._getSearchBtn();if(e.is(i)){for(var n=i.classList,s=new RegExp("fonticon-\\S+$"),a=0;a<n.length;a++)s.test(n[a])&&i.removeClassName(n[a]);i.addClassName(t)}},setInAppContext:function(t){!1===t&&(this._inContextOptions=null),this._inAppContext=t,this._temporarilyOutOfContext=!1,e.is(this._sitChoice)&&(this._inAppContext?this._sitChoice.setHTML(M.get("find_in_app")):this._sitChoice.setHTML(this._findInTabNLS))},_setFindInApp:function(t){if(this._internalSearchCriteria=null,this._setPlaceHolderValue(M.get("find_in_app")),e.is(this._sitChoice)&&(this._sitChoice.setHTML(M.get("find_in_app")),this._sitChoice.getParent().addClassName("selected")),e.is(t)&&e.is(t.tenant)){if(this.options.events.setSourceCStorage(t.tenant),this._cstoreSources.length>1&&e.is(this._cstoreChoice)&&this._cstoreChoice.length>0)for(var i=0;i<this._cstoreSources.length;i++)this._cstoreSources[i].tenantId===t.tenant?this._cstoreChoice[i].getParent().addClassName("active"):this._cstoreChoice[i].getParent().removeClassName("active");this._setPlaceHolderValue(this._getPlaceHolderTextDependingOnActiveTenant("find_in_app"))}else this.options.events.setSourceCStorage(N);this._inContextOptions=t},setFindInApp:function(e){this.keepPreviousSearchMode(),this._setFindInApp(e)},keepPreviousSearchMode:function(){this.elements.input.placeholder===this._findInTabNLS||this.elements.input.placeholder===this._getPlaceHolderTextDependingOnActiveTenant("find_in_app")?this._previouslyActiveSource=g.SearchTypeEnum.SEARCH_IN:this.elements.input.placeholder===this._getPlaceHolderTextDependingOnActiveTenant("search")?this._previouslyActiveSource=g.SearchTypeEnum.SEARCH:this.elements.input.placeholder===this._getPlaceHolderTextDependingOnActiveTenant("mycontent")?this._previouslyActiveSource=g.SearchTypeEnum.MY_CONTENT:this.elements.input.placeholder===this._getPlaceHolderTextDependingOnActiveTenant("adv_search")?this._previouslyActiveSource=g.SearchTypeEnum.ADVANCED_SEARCH:this.elements.input.placeholder===this._getPlaceHolderTextDependingOnActiveTenant("MySavedSearches")?this._previouslyActiveSource=g.SearchTypeEnum.FAVORITE_SEARCH:this._previouslyActiveSource=g.SearchTypeEnum.SEARCH_IN},onSwitchToFindInApp:function(e){this._setFindInApp(e)},buildSkeleton:function(){var e=this.elements,i=this.options.className;e.form=t.create("form",{class:i,autocomplete:"off"}),e.inputContainer=t.create("div",{class:i+"-searchbox"}).inject(e.form),e.input=t.create("input",{class:i+"-input",placeholder:this.options.placeholder,type:"text",maxlength:u.getOption("maxTopBarInput")}).inject(e.inputContainer),this.resetInput(),e.suggestsContainer=t.create("div",{class:i+"-suggests"}).inject(e.form),e.serverSuggests=t.create("ul",{id:"search-suggests-server"}).inject(e.suggestsContainer),e.suggests=t.create("ul",{id:"search-suggests-history"}).inject(e.suggestsContainer),e.container=e.form,!0===this.betaProgramState&&(e.suggestSpinnerContainer=t.create("ul",{id:"search-suggests-spinner-container",class:"search-suggests-spinner-container"}).inject(e.suggestsContainer).hide(),e.suggestSpinner=new I({className:"search-suggests-spinner"}).inject(e.suggestSpinnerContainer).show(),this._buildCategories()),!0===u.getOption("InstantSearch22x")&&this._buildSearchOptions()},_buildSearchOptions:function(){var e=this.elements;e.searchOptionsLinkContainer=t.create("ul",{class:"search-options-link-container"}).inject(e.suggestsContainer),e.searchOptionsLinkContainer.addEvent("mousedown",function(){this.preventBlur=!0}.bind(this)),e.searchOptionsLinkContainer.addEvent("mouseup",function(){this.preventBlur=!1,this._hideBasicDropDown(),this._showSearchOptions(),this.elements.input.focus()}.bind(this)),e.searchOptionsLink=t.create("li",{class:"search-options-link"}).inject(e.searchOptionsLinkContainer),e.searchOptionsIconLeft=t.create("span",{class:"search-options-icon fonticon fonticon-parameters"}).inject(e.searchOptionsLink),e.searchOptionsText=t.create("div",{html:"Options",class:"search-options-color"}).inject(e.searchOptionsLink),e.searchOptionsIconRight=t.create("span",{class:"search-options-chevron-right fonticon fonticon-chevron-right"}).inject(e.searchOptionsLink),e.searchOptionsContainer=t.create("ul",{class:"search-options-container"}).inject(e.suggestsContainer),e.searchOptionsContainer.hide(),e.searchOptionsBackButton=t.create("li",{class:"search-options-back-button"}).inject(e.searchOptionsContainer),e.searchOptionsBackIcon=t.create("span",{class:"search-options-chevron-left search-options-icon fonticon fonticon-chevron-left"}).inject(e.searchOptionsBackButton),e.searchOptionsBackText=t.create("div",{html:"Back",class:"search-options-color"}).inject(e.searchOptionsBackButton),e.searchOptionsBackButton.addEvent("mousedown",function(){this.preventBlur=!0}.bind(this)),e.searchOptionsBackButton.addEvent("mouseup",function(){this.preventBlur=!1,this._hideSearchOptions(),this._showBasicDropDown(),this.elements.input.focus()}.bind(this)),e.searchOptionsSearch=t.create("li",{class:"search-options-search"}).inject(e.searchOptionsContainer),e.searchOptionsSearchIcon=t.create("span",{class:"search-options-icon fonticon fonticon-search"}).inject(e.searchOptionsSearch),e.searchOptionsSearchText=t.create("div",{html:M.searchNew,class:"search-options-color"}).inject(e.searchOptionsSearch),e.searchOptionsSearch.addEvent("mouseup",function(){this._clickOnSearch()}.bind(this)),e.searchOptionsSearchTab=t.create("li",{class:"search-options-search-tab"}).inject(e.searchOptionsContainer),e.searchOptionsSearchTabIcon=t.create("span",{class:"search-options-icon fonticon fonticon-filter"}).inject(e.searchOptionsSearchTab),e.searchOptionsSearchTabText=t.create("div",{html:M.search_current_tab,class:"search-options-color"}).inject(e.searchOptionsSearchTab),e.searchOptionsSearchTab.addEvent("mouseup",function(){this._clickOnSearchInCurrentTab()}.bind(this)),e.searchOptionsLastSearchResults=t.create("li",{class:"search-options-last-search"}).inject(e.searchOptionsContainer),e.searchOptionsLastSearchResultsIcon=t.create("span",{class:"search-options-icon fonticon fonticon-search-recent"}).inject(e.searchOptionsLastSearchResults),e.searchOptionsLastSearchResultsText=t.create("div",{html:M.LastSearchResults,class:"search-options-color"}).inject(e.searchOptionsLastSearchResults),this._hideLastSearchResult(),e.searchOptionsLastSearchResults.addEvent("mouseup",function(){this._clickOnLastSearchResults()}.bind(this)),e.searchOptionsMyContent=t.create("li",{class:"search-options-my-content"}).inject(e.searchOptionsContainer),e.searchOptionsMyContentIcon=t.create("span",{class:"search-options-icon fonticon fonticon-user"}).inject(e.searchOptionsMyContent),e.searchOptionsMyContentText=t.create("div",{html:M.mycontent,class:"search-options-color"}).inject(e.searchOptionsMyContent),e.searchOptionsMyContent.addEvent("mouseup",function(){this._clickOnMyContent()}.bind(this)),e.searchOptionsTenantSelection=t.create("li",{class:"search-options-select-tenant"}).inject(e.searchOptionsContainer),e.searchOptionsTenantSelection.hide(),e.searchOptionsTenantSelectionIcon=t.create("span",{class:"search-options-icon fonticon fonticon-home"}).inject(e.searchOptionsTenantSelection),e.searchOptionsAdvancedSearchText=t.create("div",{html:M.select_tenant,class:"search-options-color"}).inject(e.searchOptionsTenantSelection),e.searchOptionsTenantSelectionIconRight=t.create("span",{class:"search-options-chevron-right fonticon fonticon-chevron-right"}).inject(e.searchOptionsTenantSelection),e.searchOptionsTenantSelection.addEvent("mousedown",function(){this.preventBlur=!0}.bind(this)),e.searchOptionsTenantSelection.addEvent("mouseup",function(){this.preventBlur=!1,this._showTenantList(),this._hideSearchOptions(),this._hideBasicDropDown(),this.elements.input.focus()}.bind(this)),e.searchOptionsTenantContainer=t.create("ul",{class:"search-options-tenant-container"}).inject(e.suggestsContainer),e.searchOptionsTenantContainer.hide(),e.searchOptionsTenantBackButton=t.create("li",{class:"search-options-back-button"}).inject(e.searchOptionsTenantContainer),e.searchOptionsTenantBackIcon=t.create("span",{class:"search-options-chevron-left search-options-icon fonticon fonticon-chevron-left"}).inject(e.searchOptionsTenantBackButton),e.searchOptionsTenantBackText=t.create("div",{html:"Back",class:"search-options-color"}).inject(e.searchOptionsTenantBackButton),e.searchOptionsTenantBackButton.addEvent("mousedown",function(){this.preventBlur=!0}.bind(this)),e.searchOptionsTenantBackButton.addEvent("mouseup",function(){this.preventBlur=!1,this._hideTenantList(),this._showSearchOptions(),this.elements.input.focus()}.bind(this))},_clickOnLastSearchResults:function(){this.setFieldValue(""),d.setItem("searchMode",M.searchNew),this._hideClearSearchBtn(),this.dispatchEvent("onSelect",["","LastSearch"]),this._inAppContext||this._clickOnSearch({focus:!1})},_showBasicDropDown:function(){this.elements.suggests.show(),this.elements.searchOptionsLinkContainer.show(),e.is(this.elements.categoriesContainer)&&this.elements.categoriesContainer.show()},_hideBasicDropDown:function(){this.elements.suggests.hide(),this.elements.searchOptionsLinkContainer.hide(),e.is(this.elements.suggestSpinnerContainer)&&this.elements.suggestSpinnerContainer.hide(),e.is(this.elements.categoriesContainer)&&this.elements.categoriesContainer.hide()},_showSearchOptions:function(){this._searchOptionsMode=!0,this.elements.searchOptionsContainer.show()},_hideSearchOptions:function(){this._searchOptionsMode=!1,this.elements.searchOptionsContainer.hide()},_showTenantList:function(){this._searchOptionsTenantMode=!0,this.elements.searchOptionsTenantContainer.show()},_hideTenantList:function(){this._searchOptionsTenantMode=!1,this.elements.searchOptionsTenantContainer.hide()},_hideLastSearchResult:function(){this.elements.searchOptionsLastSearchResults.hide()},showLastSearch:function(){e.is(this.elements.searchOptionsLastSearchResults)&&this.elements.searchOptionsLastSearchResults.show()},_resetSearchOptionsMenu:function(){this._hideSearchOptions(),this._hideTenantList(),this._showBasicDropDown()},initTenant:function(i){if(e.is(i)&&e.is(i.sources)){this.src_ressource=new l(i.sources);var n=this.src_ressource.getAvailableTenants();if(n.length>1){var s,a;this.elements.searchOptionsTenantSelection.show();for(var r=0;r<n.length;r++)a="search-options-tenant",this.src_ressource.active_tenant===n[r].tenantId&&(a+=" selected"),(s=t.create("li",{class:a}).inject(this.elements.searchOptionsTenantContainer)).setAttribute("tenantId",n[r].tenantId),t.create("div",{html:n[r].displayName,class:"search-options-color"}).inject(s),s.addEvent("mouseup",function(e){this._selectTenant(e.currentTarget)}.bind(this))}}},_selectTenant:function(e){var t={tenantId:e.getAttribute("tenantid"),tenantName:e.getText()};this._setPlaceHolderValue(M.search+" "+t.tenantName),this._getSelectedTenant().removeClassName("selected"),e.addClassName("selected"),this.src_ressource.setActiveTenant(t.tenantId),this.options.events.setSourceCStorage(t.tenantId)},_getSelectedTenant:function(){var e=this.elements.searchOptionsTenantContainer.getChildren();if(!(e.length>1))return null;for(var t=1;t<e.length;t++)if(e[t].classList.contains("selected"))return e[t]},getCurrentTenant:function(){var e=this.elements.searchOptionsTenantContainer.getChildren();if(!(e.length>1))return{tenantId:null,tenantName:null};for(var t=1;t<e.length;t++)if(e[t].classList.contains("selected"))return{tenantId:e[t].getAttribute("tenantid"),tenantName:e[t].getText()}},_clickOnSearch:function(t){var i=!1;(e.is(t)&&e.is(t.resetNLS)&&(i=!0),this._adv_Search_activated=!1,d.setItem("searchMode",M.searchNew),d.commit(),this.getPlaceHolder()!==this._findInTabNLS)&&(this._isTypeListDone=!0,t={adv_search_field:this._isTypeValue,focus:!1});this._setInternalCriteria(null),this.elements.input.readOnly=!1,e.is(t,"object")&&e.is(t.focus)&&!0!==t.focus||this.elements.input.focus(),""===this.getInputValue()&&this._hideClearSearchBtn();var n=M.get("search");if(e.is(this.src_ressource)&&this.src_ressource.getAvailableTenants().length>1){var s=this.getCurrentTenant();e.is(s)&&e.is(s.tenantName)&&(n+=" "+s.tenantName)}else n=M.get("searchNew");this._setPlaceHolderValue(n),e.is(t,"object")&&e.is(t.setTenant)&&!1===t.setTenant||this.options.events.setSourceCStorage(this.getCurrentTenant().tenantId);var a=this.getInputValue();i&&(a=""),this.setFieldValue(a)},_clickOnSearchInCurrentTab:function(t){e.is(t)?(e.is(t.name)&&(this._setPlaceHolderValue(M.replace(M.get("find_in_specific_tab"),{tab:t.name})),this._changeSearchBtnIcon("fonticon-filter")),e.is(t.id)&&(this.searchTabId=t.id)):(this._setPlaceHolderValue(M.search_current_tab),this._changeSearchBtnIcon("fonticon-filter")),!0===this.betaProgramState&&this._clearDropDown(),d.setItem("searchMode",M.search_current_tab),d.commit()},_clickOnMyContent:function(t){this._setInternalCriteria(null);var i=M.mycontent;e.is(this.getCurrentTenant().tenantName)&&(i+=" "+this.getCurrentTenant().tenantName),this._setPlaceHolderValue(i),this.setFieldValue(""),this._hideClearSearchBtn(),this.elements.input.readOnly=!0,e.is(t,"object")&&e.is(t.setTenant)&&!1===t.setTenant||this.options.events.setSourceCStorage(this.getCurrentTenant().tenantId),e.is(t,"object")&&e.is(t.focus)&&!1===t.focus||this.dispatchEvent("myContent")},getSuggestions:function(t){var i,n,s,a=this;if(t)return this.dataCache[t]?(this.dispatchEvent("onUpdateSuggests",[this.dataCache[t]]),void(this.typeTimeout=null)):this.options.suggestUrl&&(i=(s=this.options.suggestUrl.split("?"))[0],n=s[1].replace("{text}",t),e.is(this.options.source))?(n=this.options.source.getServicesData("suggest",t),UWA.Data.request(i,{method:this.options.method||"POST",data:this.options.data||n,type:this.options.type||"json",headers:this.options.headers||{"Content-Type":"application/json"},onComplete:function(e){return(e=a.dataParse(e)).length>0&&(a.dataCache[t]=e,a.dispatchEvent("onUpdateSuggests",[e])),a.typeTimeout=null,a.typeTimeout},proxy:this.options.proxy||null})):void 0},onUpdateSuggests:function(t){this.dispatchEvent("onShowSuggests");var i,n,s,a=this.elements,o=this;null===t&&(a.suggests.empty(),a.serverSuggests.empty()),e.is(t)&&e.is(t.serverSuggests,"array")&&t.serverSuggests.length>0?(a.suggestsContainer.show(),s=t.serverSuggests,a.serverSuggests.empty(),o.serverSuggests={},s.forEach(function(e){i=o.createSuggestElement(!0,e.command,e.icon,a.input.value,a.serverSuggests,e.label),o.resizeText(i),o.serverSuggests[e.command]=o.querySuggest(e),i.addEvent("click",function(){r.publish({channel:"SearchTrackerApi",topic:"hit",data:{category:"InstantSearch",action:"ClickOnSuggestionIndex",persDim:{pd1:"0"}}}),o.dispatchEvent("onSelect",[e.command,o.serverSuggests[e.command]])})})):(e.is(t)&&e.is(t.history,"Array")||Array.isArray(t))&&(s=t.history||t,a.suggests.empty(),a.serverSuggests.empty(),s.forEach(function(e){n=o.getFormattedSuggest(e),i=o.createSuggestElement(!1,n,"clock",a.input.value,a.suggests),o.resizeText(i),i.addEvent("click",function(e){var t=e.currentTarget.title;r.publish({channel:"SearchTrackerApi",topic:"hit",data:{category:"InstantSearch",action:"ClickOnSuggestionHistory",persDim:{pd1:"0"}}}),o.dispatchEvent("onSelect",[t,e])})})),0!==a.suggests.childElementCount||0!==a.serverSuggests.childElementCount||e.is(a.searchOptionsContainer)?a.suggestsContainer.show():!1===this.betaProgramState||e.is(a.categoriesContainer)&&a.categoriesContainer.isHidden()?a.suggestsContainer.hide():a.suggestsContainer.show(),0!==a.suggests.childElementCount&&a.searchOptionsContainer.isHidden()&&a.searchOptionsTenantContainer.isHidden()?a.suggests.show():a.suggests.hide(),0!==a.serverSuggests.childElementCount&&a.searchOptionsContainer.isHidden()&&a.searchOptionsTenantContainer.isHidden()?a.serverSuggests.show():a.serverSuggests.hide()},onHideSuggests:function(){this.elements.container.removeClassName(this.options.className+"-suggestsDisplayed"),e.is(this.elements.searchOptions)&&this.elements.searchOptions._secondaryMenu.hide(),e.is(this.elements.searchOptionsContainer)&&this._resetSearchOptionsMenu()},onShowSuggests:function(){this.elements.container.addClassName(this.options.className+"-suggestsDisplayed")},createSuggestElement:function(i,n,s,a,r,o){var c,h;(h=i?t.create("div",{class:"search-suggest-div-element",title:n}):t.create("div",{class:"search-history-div-element",title:n}),s)&&t.create("span",{class:"fonticon fonticon-"+(s||"clock")}).inject(h);if((c=i?t.create("a",{class:"search-suggest-element"}).inject(h):t.create("a",{class:"search-history-element"}).inject(h)).setText(n),a&&o){o=e.String.escapeHTML(o||""),a=e.String.escapeHTML(a.split(" ").pop()),o&&n!==o&&(c.innerHTML='<span style="color:#ccc; font-size:13px;">'+function(e,t,i){let n=e;if(n){let e=n.lastIndexOf(t);e>=0&&(n=n.substring(0,e)+i+n.substring(e+t.length))}return n}(c.innerHTML,o,"</span>"+o));var l=function(e){return e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}(a),d=new RegExp(l+"(?!.*"+l+")","i"),u=o.replace(d,"<strong>$&</strong>");c.innerHTML=u}return h.inject(r),h},onClick:function(e){r.publish({channel:"SearchTrackerApi",topic:"hit",data:{category:"InstantSearch",action:"focusOnSearchField"}}),-1===this.elements.form.className.indexOf("nv-autocomplete-suggestsDisplayed")&&this.onFocus(e),!0===this.betaProgramState&&!0!==this._inContextMode&&this.refreshCategories()},onFocus:function(){if(this._cancel_suggest_update=!1,this._inContextOptions&&this._inContextOptions.advanced_search&&this._inContextOptions.advanced_search.exclusive)this.dispatchEvent("onUpdateSuggests",[[]]);else{var e=this.getInputValue();this._suggestPreviousQueries(this,e),this.getServerSuggestions(e),this.dispatchEvent("onShowSuggests"),""===e&&!0===u.options.search_settings.search_on_keyup&&this.dispatchEvent("defaultSearch",{value:"*"})}},onBlur:function(){!0!==this.preventBlur?setTimeout(function(){this.dispatchEvent("onHideSuggests"),this._cancel_suggest_update=!0}.bind(this),200):this.preventBlur=!1},onKeyUp:function(t){var n=this;if(38!==t.keyCode&&40!==t.keyCode&&37!==t.keyCode&&39!==t.keyCode&&35!==t.keyCode&&36!==t.keyCode&&27!==t.keyCode){if(e.is(this.elements.input)&&"?"===this.getInputValue())return this.setFieldValue(""),void this._showPQSelectionUX();this._setInternalCriteria(null),e.is(window.notifs)||(window.notifs=b,T.setNotificationManager(window.notifs));var s=t.srcElement;if(s.value.length>=s.maxLength){var a={level:"warning",title:M.get("searchFieldMaxLengthTitle"),message:M.replace(M.get("searchFieldMaxLengthText"),{number:u.getOption("maxTopBarInput")}),sticky:!1};T.removeLastNotificationDisplayed(),window.notifs.addNotif(a)}var r,o=i.getElement(t);o.value?o.value.length>0?(this._showClearSearchBtn(),this._suggestPreviousQueries(this,o.value)):(this.elements.input.placeholder!==M.search_current_tab&&this._hideClearSearchBtn(),this._suggestPreviousQueries(this,o.value)):(this.elements.input.placeholder!==this._findInTabNLS&&this.elements.input.placeholder!==M.search_current_tab&&this._hideClearSearchBtn(),this._suggestPreviousQueries(this,o.value)),!1===u.options.search_settings.search_on_keyup?!0===this.betaProgramState&&!0!==this._inContextMode&&this.secondaryMenu.currentMode!=M.search_current_tab?(n._getSuggestCategoriesResult(o.value),clearTimeout(this._suggestTimeout),this._suggestTimeout=setTimeout(function(){n.getServerSuggestions(o.value)},350)):(clearTimeout(this._suggestTimeout),this._suggestTimeout=setTimeout(function(){n.getServerSuggestions(o.value)},350)):(o.value&&0===o.value.length&&clearTimeout(this._secondTimeoutId),clearTimeout(this._timeoutId),this._timeoutId=setTimeout((r=o.value,function(){r&&r.length>0&&n.options.events.onSearch(r),n._suggestPreviousQueries(n,r),clearTimeout(n._suggestTimeout),n._suggestTimeout=setTimeout(function(){n.getServerSuggestions(r)},350)}),500))}},onKeyDown:function(e){var t=UWA.Event.whichKey(e);38===e.keyCode?this._arrowKeyOnSuggestions(e,-1):40===e.keyCode?this._arrowKeyOnSuggestions(e,1):27===e.keyCode?this._escapeKeyOnSuggestions(e):"ctrl+a"===t&&e.stopPropagation()},attachEvents:function(){var t;(t=this.elements).input.addEvent("keyup",this.onKeyUp.bind(this)),-1===["iphone","ipad","android"].indexOf(g.getDeviceCategory())?t.input.addEvent("blur",this.onBlur.bind(this)):t.input.addEvent("focusout",this.onBlur.bind(this)),t.input.addEvent("focus",this.onFocus.bind(this)),t.form.addEvent("submit",function(n){var s=this.itemCache[t.input.value.toLowerCase()];return r.publish({channel:"SearchTrackerApi",topic:"hit",data:{category:"InstantSearch",action:"HitOnEnter-SearchField",persDim:{pd1:"0"}}}),i.stop(n),e.is(this.serverSuggests)&&-1!==Object.keys(this.serverSuggests).indexOf(t.input.value)?(this.dispatchEvent("onSelect",[t.input.value,this.serverSuggests[t.input.value]]),t.input.blur(),this.dispatchEvent("onHideSuggests")):this.options.shouldExist&&!s||(this.options.suggestKey&&s&&(t.input.value=s[this.options.suggestKey]),this.dispatchEvent("onSelect",[t.input.value,s]),t.input.blur(),this.dispatchEvent("onHideSuggests")),!1}.bind(this)),(t=this.elements).input.addEvent("keydown",this.onKeyDown.bind(this)),t.input.addEvent("click",this.onClick.bind(this))},dataParse:function(t){var i,n,s,a=this.options.dataParser;if(e.is(a,"function"))t=a(t);else{if(Json.isJson(t))t=Json.decode(t),s=!0;else for(i in t=Json.xmlToJson(t))if(t.hasOwnProperty(i)){t=t[i];break}for(i in t)t.hasOwnProperty(i)&&(n||(n=i),Array.isArray(t[i])&&(t=t[i],s=!0));!s&&n&&(t=[t[n]])}return Array.isArray(t)?t:[]},_escapeKeyOnSuggestions:function(){this.dispatchEvent("onHideSuggests")},_arrowKeyOnSuggestions:function(t,n){var s=this._getSuggestions().getChildren()[0].getChildren().concat(this._getSuggestions().getChildren()[1].getChildren());if(!0===this.betaProgramState)for(var a=0;a<this.elements.categories.length;a++)for(var r=0;r<this.elements.categories[a].item.length;r++)s.push(this.elements.categories[a].item[r]);if(!(s.length<1)){this.dispatchEvent("onShowSuggests");var o=-1,c=-1;for(a=0;a<s.length;a++)if(s[a].hasClassName("suggestion-selected")){o=a;break}if((c=o+n)<0&&(c=s.length-1),c>s.length-1&&(c=0),o>=0&&s[o].removeClassName("suggestion-selected"),c>=0){s[c].addClassName("suggestion-selected");var h=i.getElement(t);e.is(h)&&(h.value=s[c].getText()),this._showClearSearchBtn()}}},_showPQSelectionUX:function(){this.dispatchEvent("showPQListUX")},onSelect:function(t,i,n){e.is(n,"string")&&n.length>0&&(this._isTypeListMode=!0,this._value=""),this._setInputValue(t),this.dispatchEvent("onHideSuggests"),this._showClearSearchBtn()},_getClearSearchBtn:function(){return null===this._clearSearch&&(this._clearSearch=e.extendElement(document.body).getElement(".clear_btn_search")),this._clearSearch},_showClearSearchBtn:function(){var t=this._getClearSearchBtn();if(e.is(t)&&e.is(t.show,"function")){t.setStyle("display","inline-block"),t.show();var i=e.extendElement(document.body).getElement(".nv-autocomplete-input");e.is(i)&&i.addClassName("clear-visible")}},_hideClearSearchBtn:function(){var t=this._getClearSearchBtn();if(e.is(t)&&e.is(t.hide,"function")){t.hide();var i=e.extendElement(document.body).getElement(".nv-autocomplete-input");e.is(i)&&i.removeClassName("clear-visible")}},_setPlaceHolderValue:function(t){if(!e.is(t,"string"))throw new Error("Bad arg in _setPlaceHolderValue!");switch(t){case M.get("MySavedSearches"):this._changeSearchBtnIcon("fonticon-favorite-on");break;case M.get("mycontent"):this._changeSearchBtnIcon("fonticon-user");break;case M.get("search"):this._changeSearchBtnIcon("fonticon-search");break;case M.get("similar_search"):this._changeSearchBtnIcon("fonticon-search-similar");break;case this._findInTabNLS:this._changeSearchBtnIcon("fonticon-filter");break;case M.get("adv_search"):this._changeSearchBtnIcon("fonticon-search-cog");break;default:this._changeSearchBtnIcon("fonticon-search")}if(!e.is(this.elements.input)||!e.is(this.elements.input.placeholder))throw new Error("placeholder not found!");this.elements.input.placeholder=t},getPlaceHolder:function(){return this.elements.input.placeholder},_getSuggestions:function(){return null===this._autocompleteSuggests&&(this._autocompleteSuggests=e.extendElement(document.body).getElement(".nv-autocomplete-suggests")),this._autocompleteSuggests},_setInputValue:function(e){this.elements.input.value=e},getInputValue:function(){return void 0===this.elements.input.value?"":this.elements.input.value},setFieldValue:function(t){this._setInputValue(t),this._searchStringToDisplayInSearchField=t,e.is(t,"string")&&t.length>0?this._showClearSearchBtn():this._hideClearSearchBtn()},_setInternalCriteria:function(e){this._internalSearchCriteria=e},_getPlaceHolderTextDependingOnActiveTenant:function(t){if(!e.is(t,"string")||0===t.length)throw new Error("E_INVALIDARG: need a key !");var i=M.get(t);return this._cstoreSources.length>1&&(e.is(M[t+"_in_active"])?i=M.replace(M.get(t+"_in_active"),{tenant:this.getSelectedTenant().displayName}):i+=" "+this.getSelectedTenant().displayName),i},isMultiTenantContext:function(){return P},setSelectedTenant:function(t){N=t,e.is(this._src_ressource)&&this._src_ressource.setActiveTenant(N)},getSelectedTenant:function(){if(!P)throw new Error("E_INVALIDARG: not in multi tenant context, check first using isMultiTenantContext before calling this function !");var t=null;if(e.is(this.secondaryMenu)&&e.is(this.secondaryMenu.getCurrentTenant)){var i=this.secondaryMenu.getCurrentTenant();t={tenantId:i.tenantId,displayName:i.tenantName}}return null===t&&(t={tenantId:N,displayName:N}),t},_findInthisTabOnClick:function(e){!0===e&&this._restoreActiveSearchInTab(),g.isOneSearchInternalProd()&&(d.setItem("find_in_this_tab_default",e),u.changeSettings({find_in_this_tab_default:e}),d.commit())},_restoreActiveSearchInTab:function(){var t=this;if("3DDashboard"===g.identifyClientInfo().identifier){require(["DS/Dashboard/PublicAPI"],function(i){var n=i.getActiveTab();e.is(n)&&e.is(n.shouldPropagateSearch)&&!0===n.shouldPropagateSearch&&e.is(n.shouldPropagateSearchArg,"string")&&0<n.shouldPropagateSearchArg.length&&t.setFieldValue(n.shouldPropagateSearchArg)})}},getFocus:function(){this.elements.input.focus()},querySuggest:function(e){return{search_type:"#search",value:e.command,searchStringToDisplayInSearchField:e.label,internalSearchCriteria:null,adv_search:!1}},resetInput:function(){this.elements.input.placeholder?this._setInputValue(""):this._setInputValue(this.options.placeholder),this.resetCache()},resetCache:function(){this.dataCache={},this.itemCache={}},resizeText:function(e){var t=e.getElementsByTagName("a")[0],i=e.getElementsByTagName("span")[0],n=window.getComputedStyle(t,null).getPropertyValue("font");if(0!==e.offsetWidth&&0!==i.offsetWidth&&e.offsetWidth-i.offsetWidth-20<=this.getTextWidth(t.text,n)){for(var s=t.text,a=0;a<50&&this.getTextWidth(s+"...")>e.offsetWidth-i.offsetWidth-20;)s=s.slice(0,s.length-2),a++;t.setText(s+"...")}},getTextWidth:function(t,i){e.is(this.canvas)||(this.canvas=document.createElement("canvas"));var n=this.canvas.getContext("2d");return n.font=i,n.measureText(t).width},getFormattedSuggest:function(t){return this.options.suggestFormat.replace(/\{(\w+)\}/g,function(i,n){return e.is(t,"string")?t:t[n]})}})}),define("DS/SNSearchUX/SearchUX_TopBar",["UWA/Core","UWA/Controls/Abstract","UWA/Class/Debug","UWA/Class/Options","UWA/Class/Collection","UWA/Promise","DS/TransientWidget/TransientWidget","DS/PubSub/PubSub","DS/MessageBus/MessageBus","DS/SNInfraUX/SearchVersioning","DS/SNInfraUX/SearchRessources","DS/SNInfraUX/SearchPreferences","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/SearchCom","DS/SNInfraUX/SearchUtils","DS/SNSearchUX/InContextSearch","DS/SNInfraUX/PredicatesNLS","DS/SNInfraUX/SearchControlCenterFetchService","DS/SNInfraUX/PredefinedQueries","DS/SNInfraUX/SearchLogin","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/SNInfraUX/Api/SearchApi","DS/SNInfraUX/SearchRevisionDelegator","i18n!DS/SNSearchUX/assets/nls/SNSearchUX.json","DS/SNInfraUX/Logger","DS/SNSearchUX/SearchUxPowerBy","DS/TransientWidget/Tool/TransientMessaging","DS/TransientWidget/Tool/Mapping"],function(e,t,i,n,s,a,r,o,c,h,l,d,u,g,p,_,S,m,f,v,C,y,b,T,w,I,D,A){"use strict";return t.singleton(i,n,{_resourcesMgt:null,_selectedSource:null,_url_settings:{},_socket:null,_active_3dsearch_widget:null,_wdg_ready:!0,_ctx_search:null,_currentTabId:null,_topframe_search_delegation:!1,_SWFilteringCheckDone:!0,result_ux_customization:{},_PQEvaluationPromisePC:a.deferred(),_EasyType:null,_sidePanelClose:!0,_topFrame:null,_firstInit:!1,_sidePanelHide:!1,_stackTransient:[],_prevent3dSearchSidePanelPositionBack:!1,isCtxWdg:!1,init:function(t){w.group("SearchUX_TopBar.init"),w.log("JS code level for search: ",h.getCurrentVersion()),w.log("options:",t);var i=this;this.isCtxWdg=!1,D.getInstance().on(A.TransientMessaging.ShowWidget,function(e){if(void 0===i.getAddinMode()){if(!0===d.getItem("integratedSearch")&&i._topFrame&&"X3DOPMR_AP"!==e.appId&&"X3DMCTY_AP"!==e.appId)return i._topFrame._frame.closePanel("right","search"),i._topFrame._onRightPanelStateChange("closed"),i._stackTransient=[],void(i._prevent3dSearchSidePanelPositionBack=!0);i._stackTransient.push(e.appId),"X3DSEAR_AP"!==e.appId&&-1!==i._stackTransient.indexOf("X3DSEAR_AP")&&(i._stackTransient=[],r.closeWidget(p.SEARCH_APP_ID))}});var n=window.location.search.substring(1);if(n){for(var s=n.split("&"),a=0;a<s.length;a++){var g=s[a].split("=");1===g.length?this._url_settings[g[0]]=!0:2===g.length&&g[0].length>0&&(this._url_settings[g[0]]=g[1])}u.urlSettings(this._url_settings)}this.setOptions(t),e.is(t)&&e.is(t.userId)?(p.setUserId(t.userId),w.log("Connected User = "+p.getUserId())):w.log("SearchTopBar:init Input options do not contain the connected userId"),!0===u.getOption("forceSearchTransientAndNoTab")?(d.setItem("integratedSearch",!1),d.commit({})):!0!==u.getOption("publicBetaUser")||"ipad"!==p.getDeviceCategory()&&""!==p.getDeviceCategory()||"3DSwym"===p.identifyClientInfo().identifier||"3DSpace"===p.identifyClientInfo().identifier||void 0!==this.getAddinMode()||(d.setItem("integratedSearch",!0),d.commit({})),new I({addinMode:this.getAddinMode()}),p.activateCompactOrComfortMode(),p.ensureBetaStatus().then(function(){this.setDebugMode(u.getDebugMode()),this._resourcesMgt=new l(e.is(t)?t.ressources:{}),y.setResourceMgt(this._resourcesMgt);var n=this._resourcesMgt.getActiveTenant();b.initialize(n),u.getTenantSettings(n).then(function(){p.activateCompactOrComfortMode(n),void 0!==t&&void 0!==this.options.ressources&&this._buildUI();var s=p.identifyClientInfo();e.is(s)&&"3DSwym"!==s||o.add("tab:change",function(e){i._currentTabId=e,i.computeSearchBar(e)}),o.add("dashboard:change",function(){i._socket.dispatchEvent("clearSearch"),e.is(i._topFrame)&&(i._topFrame._frame.closePanel("right",{}),i._topFrame._onRightPanelStateChange("closed"))}),e.is(i.options.searchParams)&&(e.is(i.options.searchParams.close,"function")&&e.is(i.options.searchParams.isOpen,"function")&&e.is(i.options.searchParams.open,"function")&&(i._topframe_search_delegation=!0),i.options.searchParams.pqAccessEvalcallback&&(i.pqAccessEvalcallback=i.options.searchParams.pqAccessEvalcallback),i.options.searchParams.resultUX_customization&&i._addResultUX_customization(i.options.searchParams.resultUX_customization),e.is(i.options.searchParams.searchHelper,"function")&&(i.searchHelper=i.options.searchParams.searchHelper),e.is(i.options.searchParams.search_settings,"object")&&u.initialize({search_settings:i.options.searchParams.search_settings}),p.autocompleteRendered().then(function(){e.is(i.options.searchParams.onSearchInit,"function")&&i.options.searchParams.onSearchInit.call()}));require(["DS/TopFrame/TopFrame"],function(n){i._topFrame=n,!0===d.getItem("integratedSearch")&&(e.is(t.events)&&e.is(t.events.initFrame,"function")&&t.events.initFrame.call(void 0,i._topFrame),e.is(i._topFrame)&&e.is(i._topFrame._frame)&&(i._topFrame._frame.addEvent("onPanelClose",function(t){p.isFUN109031Active()&&e.is(t)&&e.is(t.panel)&&"left"===t.panel&&e.is(t.tag)&&"myAppsCtn"===t.tag&&(u.options.search_settings.taggerClosed=!0,c.publish({channel:"GLOBAL_3DSEARCH_MESSAGE_CHANNEL_ID",topic:"showEmbeddedView"})),p.isFUN109031Active()&&e.is(t)&&e.is(t.panel)&&"left"===t.panel&&e.is(t.tag)&&"taggerCtn"===t.tag&&(u.options.search_settings.taggerClosed=!0),e.is(t)&&e.is(t.tag)&&"taggerCtn"!==t.tag&&("right"===t.panel&&c.publish({channel:"GLOBAL_3DSEARCH_MESSAGE_CHANNEL_ID",topic:"datagrid_preference_force_close"}),i._sidePanelClose=!0,i._sidePanelHide=!0,i._socket.dispatchEvent("showSearchInThisTab"),e.is(t)&&e.is(t.panel)&&"left"===t.panel&&e.is(t.tag)&&"dashboardMenuCtn"===t.tag||(i._socket.dispatchEvent("onCloseTransientTopBar"),i._socket.dispatchEvent("showSearchInThisTab"),c.publish({channel:"GLOBAL_3DSEARCH_MESSAGE_CHANNEL_ID",topic:"datagrid_preference_force_close"})),"right"===t.panel&&"X3DSEAR_AP"===t.tag&&c.publish({channel:"GLOBAL_3DSEARCH_MESSAGE_CHANNEL_ID",topic:"sidePanelClosed"}),!0===p.isTaggerOpenedByCode()&&i._socket.dispatchEvent("closeTagger"),p.isFUN109031Active()&&i._socket.dispatchEvent("hideGlobeView"))}),i._topFrame._frame.addEvent("onPanelOpen",function(t){"right"===t.panel&&!0===i._sidePanelClose&&(e.is(i._topFrame.isTaggerVisible,"function")&&!0===i._topFrame.isTaggerVisible()?p.setTaggerOpenedByCode(!1):p.setTaggerOpenedByCode(!0)),t.position&&"right"===t.panel&&"maximized"===t.position&&e.is(i._topFrame.isTaggerVisible,"function")&&!1===i._topFrame.isTaggerVisible()&&e.is(i.options.events.openTagger,"function")&&"X3DSEAR_AP"===t.tag&&(!0!==p.isFUN109031Active()||i.isCtxWdg)&&(!e.is(u.options.search_settings.taggerClosed)||e.is(u.options.search_settings.taggerClosed)&&0==u.options.search_settings.taggerClosed)&&(i.options.events.openTagger(),p.setTaggerOpenedByCode(!0)),setTimeout(function(){if(e.is(t)&&e.is(t.tag)&&"X3DSEAR_AP"===t.tag&&e.is(t.position)){var n=0,s=i._isSearchWidgetAvailable();if(n=void 0===s.maxIndex&&void 0!==s.indexSide?s.indexSide:s.maxIndex,e.is(s.wdg_search_items)&&s.wdg_search_items.length>0&&e.is(s.wdg_search_items[n])){var a=s.wdg_search_items[n].get("widget_id");if(e.is(a)){let n=p.getSearchWidget(a),s=!1;e.is(n)&&e.is(n.getValue,"function")&&(s=n.getValue("previewMode")),"fitted"===t.position||"maximized"===t.position?(i._socket.dispatchEvent("hideSearchInThisTab"),e.is(i._topFrame.isTaggerVisible())&&i._topFrame.isTaggerVisible()&&p.getsearchType()===p.SearchTypeEnum.ADVANCED_SEARCH&&(i._socket.dispatchEvent("showAdvancedSearch",{adv_search_field:null,widgetId:a}),p.setTaggerOpenedByCode(!0)),i._socket.dispatchEvent("manageActionIconOnSidePanel",{widgetId:a,activation:!1,position:t.position})):(i._socket.dispatchEvent("showSearchInThisTab"),i._socket.dispatchEvent("manageActionIconOnSidePanel",{widgetId:a,activation:!0,position:t.position}),!0===p.isTaggerOpenedByCode()&&i._socket.dispatchEvent("closeTagger")),!1===i._prevent3dSearchSidePanelPositionBack?localStorage.setItem("3dSearch-sidePanelPositionBack",t.position):i._prevent3dSearchSidePanelPositionBack=!1}}require(["DS/PlatformAPI/PlatformAPI"],function(e){e.publish("sideOnPanelOpen",t)})}},1e3)})))})}.bind(i))}.bind(this)),w.groupEnd()},setTagPinnedToQuery:function(t){var i=JSON.parse(localStorage.getItem("taggerPinned"))||{};i=i[p.getUserId()]||{};var n="3DDashboard"===p.identifyClientInfo().identifier,s="";(n=(!document.querySelector(".topbar-app-brand")||!document.querySelector(".topbar-app-brand").innerText.match(/enovia/i))&&n)||(s=window.location.hostname);var a=i[s]||{keep:[]},r={};a.keep&&a.keep.forEach(function(e){var t=JSON.parse(e.predicate),i=t.predicate;t.disptext=t.dispValue,delete t.predicate,delete t.dispValue,r[i]=[t]}),!t.refine&&e.is(r,"object")&&Object.keys(r).length>0&&(t.refine={allfilters:r})},computeSearchBar:function(t){var i,n;if(t=t||this._currentTabId||p.getCurrentTabId(),e.is(this._ctx_search)&&e.is(this._ctx_search._socket)){var s=e.Widgets.instances.filter(function(e){return e.context===t&&"maximized"===e.getView().type});1===s.length?(i=s[0],e.is(this._ctx_search._registered_search_ctx)?(n=this._ctx_search.getInContextOptions(i.id),e.is(n)&&!i.getValue("stayOnSearch")?e.is(n.search_delegation)&&"3ddashboard"===n.search_delegation?this._ctx_search._socket.dispatchEvent("onSetFindInTab",n):(this._ctx_search._socket.dispatchEvent("onSetInAppContext",!0),this._ctx_search._socket.dispatchEvent("onSetFindInApp",n)):i.getValue("stayOnSearch")||(this._ctx_search._socket.dispatchEvent("onSetInAppContext",!1),this._ctx_search._socket.dispatchEvent("onSetFindInTab",i.getValue("searchNLS")||null))):!i.getValue("stayOnSearch")&&e.is(i.getTitle,"function")&&"Unified Search"!==i.getTitle()&&this._ctx_search._socket.dispatchEvent("onSetInAppContext",!1)):(this._ctx_search._socket.dispatchEvent("onSetInAppContext",!1),!0===u.getOption("find_in_this_tab_default")?this._socket.dispatchEvent("onSetFindInTab",null):this._socket.dispatchEvent("onSetBackSearchOrFindInTab",{resetNLS:!0,focus:!1}))}},buildPQAccessMap:function(){var e=this;f.fetchPQsFromServer(e._resourcesMgt).then(function(){var t=f.getPQs();if(e.searchHelper){var i={};i.PQ={PQ:t.PQ,requested_info:["access"]},i.onComplete=function(t){var i=t.PQ.PQ;e.pqAccessMap={},i.forEach(function(t){e.pqAccessMap[t.pqid]=t.viewData.access}),e._PQEvaluationPromisePC.resolve()},e.searchHelper.call(void 0,i)}else if(e.pqAccessEvalcallback){var n={PQ:t.PQ,onComplete:function(t){e.pqAccessMap=t,e._PQEvaluationPromisePC.resolve()}};e.pqAccessEvalcallback.call(void 0,n)}else e.pqAccessMap=null,e._PQEvaluationPromisePC.resolve()})},_buildUI:function(){if(!0===u.getOption("universal_search")){var t,i=this;this.log("User "+this.options.userId+" belong to the white list"),C.getPlatformServices({onComplete:function(t){if(e.is(t,"array")){var i=[],n=0,s=t.length;for(n=0;n<s;n++){var a=t[n],r={};r.id=a.platformId,r.name=a.displayName,r.services=[];var o=Object.getOwnPropertyNames(a);if(e.is(o,"array"))for(var c=0,h=o.length;c<h;c++)0===a[o[c]].indexOf("http")&&r.services.push({id:o[c],url:a[o[c]]});i.push(r)}p.setPlatforms(i)}},onFailure:function(){w.log("oFailure")}});var n=function(){w.groupCollapsed("loginToSources");var t="",n=i._resourcesMgt.getAvailableTenants();if(e.is(n,"array")&&1===n.length)t=n[0].tenantId,w.log("Single Tenant: "+t);else if(e.is(n,"array")&&n.length>1){var s=i._resourcesMgt.getActiveTenant();if(w.log("Multiple tenants avaialable, active tenant: "+s),"3DDashboard"===s){var a=d.getItem("defaultTenantId");w.log("Tenant from preferences: "+a),i._resourcesMgt.getTenantInfo(a)?(t=a,w.log("Tenant found in preferences is available")):(w.log("Tenant found in preferences is NOT available"),t=n[0].tenantId)}else t=s}w.log("Tenant for Login is: "+t),w.groupEnd(),v.login({resources:i._resourcesMgt,tenantID:t,onComplete:function(e){var t=[];0===(t=p.getActiveDataSource()).length&&(e.forEach(function(e){t.push(e.name)}),p.setActiveDataSource(t),p.setActiveDataSourcePromise())},onFailure:function(){}}),!0===u.getOption("force_loading_WebUX_js")&&require(["WebUX/WebUX"],function(e){i.log("WebUX is LOADED")})},s=u.getOption("fed_search_init_timeout");e.is(s,"number")&&(0===s?n.call():s>0&&setTimeout(function(){n.call()},1e3*s)),this._intializeSocket(),this._ctx_search=new _({addinMode:this.getAddinMode()}),this._ctx_search.computeSearchBar=this.computeSearchBar.bind(this),this._ctx_search._socket.addListener("addResultUX_customization",function(e){i._addResultUX_customization(e)});var a=function(n){i._EasyType=n.adv_search_field,i._updateTenantFromIncontextOptions(n);var s={selected_source:i._resourcesMgt.toJSON(),openTagger:i.options.events.openTagger,setTaggerMode:i.options.events.setTaggerMode,closeTagger:i.options.events.closeTagger};if(t=i.getResultUX_customization(),e.is(t)&&(s.result_ux_customization=t),!0===i._isWidgetReadyToLaunch()||!1===i._isSearchWidgetAvailable().wdg_available){var a=f.isAPrefixedPQSearch(n.value);if(e.is(i.searchHelper)&&e.is(a)&&!e.is(n.inCtx_widget_id)){var r=f.getPQObjFromPQPrefix(a),o={};o.PQ={PQ:[r],requested_info:["datagridview_columns","global_actions"]},o.onComplete=function(e){var t=e.PQ.PQ[0];t.viewData&&t.viewData.datagridview_columns&&(n.viewData={SearchColumnCustoDefinition:{viewId:"###"+r.pqName,viewDefinition:[]}},r.viewData.datagridview_columns.forEach(function(e){n.viewData.SearchColumnCustoDefinition.viewDefinition.push({uri:e})})),t.viewData&&t.viewData.global_actions&&(n.viewData||(n.viewData={}),n.viewData.global_actions=t.viewData.global_actions),i._launchWdg(s,n)},i.searchHelper.call(void 0,o)}else i._launchWdg(s,n)}},h=function(t,n){var s={};if(e.is(t,"object")&&(s=t),e.is(i.options)&&e.is(i.options.searchParams))if(e.is(i.options.searchParams.source,"array"))s.source=i.options.searchParams.source;else if(e.is(i.options.searchParams.getSources,"function")){var r=i.options.searchParams.getSources();e.is(r,"array")&&(s.source=r)}s.searchType=n,a(s)};this._socket.addListener("search",function(t){(e.is(t.reSearch)&&!0!==t.reSearch||!e.is(t.reSearch))&&d.getItem("integratedSearch")&&!0===i._sidePanelClose&&i._socket.dispatchEvent("clearfilterbyclosesidepanel"),h(t,p.SearchTypeEnum.SEARCH);c.publish({channel:"TopBar_Suggest",topic:"CancelSuggest",data:!0}),p.setsearchType(p.SearchTypeEnum.SEARCH)}),this._socket.addListener("myContent",function(e){(d.getItem("integratedSearch")&&!0===i._sidePanelClose||p.isFUN109031Active())&&i._socket.dispatchEvent("clearfilterbyclosesidepanel"),h(e,p.SearchTypeEnum.MY_CONTENT),p.setsearchType(p.SearchTypeEnum.MY_CONTENT)}),this._socket.addListener("myRecentContent",function(e){h(e,p.SearchTypeEnum.MY_RECENT_CONTENT),p.setsearchType(p.SearchTypeEnum.MY_RECENT_CONTENT)}),this._socket.addListener("advancedSearch",function(e){u.getOption("debug")&&w.log("[3dSearch - adv search mode]",p.getsearchType()),d.getItem("integratedSearch")&&!0===i._sidePanelClose&&p.SearchTypeEnum.ADVANCED_SEARCH!==p.getsearchType()&&i._socket.dispatchEvent("clearfilterbyclosesidepanel"),localStorage.setItem("3dSearch-sidePanelPositionBack","fitted"),h(e,p.SearchTypeEnum.ADVANCED_SEARCH),p.setsearchType(p.SearchTypeEnum.ADVANCED_SEARCH),d.setItem("errorManager:limit",void 0),o.dispatch("errorManager:clear")}),this._socket.addListener("favoriteSearches",function(e){d.getItem("integratedSearch")&&!0===i._sidePanelClose&&i._socket.dispatchEvent("clearfilterbyclosesidepanel"),h(e,p.SearchTypeEnum.FAVORITE_SEARCH),p.setsearchType(p.SearchTypeEnum.FAVORITE_SEARCH)}),c.subscribe({channel:"GLOBAL_3DSEARCH_MESSAGE_CHANNEL_ID",topic:"favoriteSearches",callback:function(){d.getItem("integratedSearch")&&!0===i._sidePanelClose&&i._socket.dispatchEvent("clearfilterbyclosesidepanel"),localStorage.setItem("3dSearch-sidePanelPositionBack","fitted"),console.log("fitted"),h({value:p.SearchTypeEnum.FAVORITE_SEARCH,adv_search:!1,searchType:p.SearchTypeEnum.FAVORITE_SEARCH,active_tenant:"OnPremise",value:p.SearchTypeEnum.FAVORITE_SEARCH},p.SearchTypeEnum.FAVORITE_SEARCH),p.setsearchType(p.SearchTypeEnum.FAVORITE_SEARCH)}}),this._socket.addListener("focusOnSearch",a),this._socket.addListener("hideAdvancedSearch",function(){i._socket.dispatchEvent("hideAdvancedSearch",{})}),this._socket.addListener("showAdvancedSearch",function(t){if(e.is(t)&&(!0!==d.getItem("integratedSearch")||"normal"!==localStorage.getItem("3dSearch-sidePanelPositionBack"))){var n=i._isSearchWidgetAvailable();if(e.is(n)&&!0===n.wdg_available){var s=void 0===n.maxIndex&&void 0!==n.indexSide?n.indexSide:n.maxIndex,a=n.wdg_search_items[s].get("widget_id");e.is(a)&&(t.widgetId=a)}setTimeout(function(){i._socket.dispatchEvent("showAdvancedSearch",t)},3e3)}}),this._socket.addListener("openTagger",function(){e.is(i.options.events.openTagger,"function")&&(i.options.events.openTagger(),p.setTaggerOpenedByCode(!0))}),c.subscribe({channel:"GLOBAL_3DSEARCH_MESSAGE_CHANNEL_ID",topic:"openTagger",callback:function(){e.is(i.options.events.openTagger,"function")&&(i.options.events.openTagger(),p.setTaggerOpenedByCode(!0))}}),o.add("search:refreshSearchField",function(e){i._socket.dispatchEvent("onRefreshSearchField",e)}),this._socket.addListener("setTaggerMode",function(t){if(e.is(i.options.events.setTaggerMode,"function")&&i.options.events.setTaggerMode(t),!0===i._firstInit&&e.is(t)&&"criteria"===t){var n=i._isSearchWidgetAvailable();if(e.is(n)&&!0===n.wdg_available){var s=0;s=void 0===n.maxIndex&&void 0!==n.indexSide?n.indexSide:n.maxIndex;var a=n.wdg_search_items[s].get("widget_id");e.is(a)&&(!e.is(d.getItem("integratedSearch"))||!0===d.getItem("integratedSearch")&&"normal"!==localStorage.getItem("3dSearch-sidePanelPositionBack"))&&i._socket.dispatchEvent("showAdvancedSearch",{adv_search_field:null,widgetId:a})}i._firstInit=!1}}),this._socket.addListener("closeTagger",function(){e.is(i.options.events.closeTagger,"function")&&i.options.events.closeTagger()}),this._socket.addListener("clearSearch",function(){"3DDashboard"===i._resourcesMgt.getActiveTenant()&&e.is(i.options.events.clearSearch,"function")&&i.options.events.clearSearch.call(void 0,null)}),this._socket.addListener("closeTransient",function(t){e.is(i.options.events.closeTagger,"function")&&i.options.events.closeTagger.call(void 0,null),i._topframe_search_delegation?i.options.searchParams.close.call(void 0,t):u.getOption("transient_widget")&&(i._stackTransient=[],r.closeWidget(p.SEARCH_APP_ID))}),this._socket.addListener("onDragStart",function(){i._topframe_search_delegation?i.options.searchParams.close.call():e.is(i.options)&&e.is(i.options.addinMode)&&e.is(i.options.addinMode.value,"string")&&("solidworks"===i.options.addinMode.value||"catiav5"===i.options.addinMode.value)||!1!==d.getItem("integratedSearch")||setTimeout(function(){!0===p.isTaggerOpenedByCode()&&i._socket.dispatchEvent("closeTagger"),r.hide()},250),!0===d.getItem("integratedSearch")&&e.is(i._topFrame)&&e.is(i._topFrame._frame)&&(i._topFrame._frame.isPanelMaximized("right")||i._topFrame._frame.isPanelFitted("right"))&&(i._topFrame._frame.closePanel("right",{}),i._topFrame._onRightPanelStateChange("closed"))}),this._socket.addListener("onReshow",function(){e.is(i.options)&&e.is(i.options.addinMode)&&e.is(i.options.addinMode.value,"string")&&("solidworks"===i.options.addinMode.value||"catiav5"===i.options.addinMode.value)||(i._stackTransient=[],r.closeWidget(p.SEARCH_APP_ID))}),this._socket.addListener("onShowPQListUX",function(){i.buildPQAccessMap(),i._PQEvaluationPromisePC.promise.then(function(){require(["DS/SNResultUX/SearchPQListUX"],function(e){e.showPQSelector({pqAccessMap:i.pqAccessMap,pqSelectionCallback:function(e){i._socket.dispatchEvent("onPQPrefixSelect",e)}})})})}),this._socket.addListener("getsearchTopbarResouceJson",function(t){i._socket.dispatchEvent("searchTopbarResouceJson",{resources:i._resourcesMgt.toJSON(),tenants:i._resourcesMgt.getAvailableTenants(),active_tenant:i._resourcesMgt.getActiveTenant()},e.is(t)?t.socket_id:null)}),this._socket.addListener("fetchPQsFromServer",function(){f.fetchPQsFromServer(i._resourcesMgt)}),this._socket.addListener("hideSidePanel",function(){e.is(i._topFrame)&&e.is(i._topFrame._frame)&&(i._topFrame._frame.closePanel("right","search"),i._topFrame._onRightPanelStateChange("closed")),i._topFrame._onRightPanelStateChange("closed"),i._sidePanelHide=!0}),this._socket.addListener("3DSearchWidgetmaximized",function(e){if(!0===d.getItem("integratedSearch")&&i._topFrame&&"search"===i._topFrame._visibleXApp){var t=i._topFrame._frame.isPanelOpen("right");"windowed"===e&&!1===i._sidePanelHide?(i._topFrame._updateColumn("right","search"),i._sidePanelHide=!0):"maximized"===e&&!0===t?(i._sidePanelHide=!1,i._topFrame._frame.closePanel("right","search"),i._topFrame._onRightPanelStateChange("closed")):null===t&&"windowed"===e&&!0===i._sidePanelHide&&!0!==i._sidePanelClose&&i._topFrame._updateColumn("right","search")}}),this._socket.addListener("topBar-LastSearch-clearLocalFilter",function(){d.getItem("integratedSearch")&&!0===i._sidePanelClose&&i._socket.dispatchEvent("clearfilterbyclosesidepanel")}),c.subscribe({channel:"GLOBAL_3DSEARCH_MESSAGE_CHANNEL_ID",topic:"closeRightPanel",callback:function(){i._topFrame._frame.closePanel("right",{}),i._topFrame._onRightPanelStateChange("closed"),i._socket.dispatchEvent("closeTagger")}}),c.subscribe({channel:"GLOBAL_3DSEARCH_MESSAGE_CHANNEL_ID",topic:"checkSidePanelStatus",callback:function(){c.publish({channel:"GLOBAL_3DSEARCH_MESSAGE_CHANNEL_ID",topic:"updateSidePanelStatus",data:{sidePanelclosed:i._sidePanelClose}})}}),c.subscribe({channel:"GLOBAL_3DSEARCH_MESSAGE_CHANNEL_ID",topic:"search-maximiseEditingFavoriteSearch",callback:function(){"search"===i._topFrame._visibleApp&&i._topFrame.openPanel("right",{appId:p.SEARCH_APP_ID,fit:!0}).then(function(){i._topFrame._onRightPanelStateChange("fitted")})}}),c.subscribe({channel:"GLOBAL_3DSEARCH_MESSAGE_CHANNEL_ID",topic:"onDeactivateIncontextSearchNoTab",callback:function(){i._topFrame._frame.closePanel("right",{}),i._topFrame._onRightPanelStateChange("closed"),i._forceRelaunchSearch=!0}})}},_intializeSocket:function(){this.log("_intializeSocket");var t=this;this._active_3dsearch_widget=new s,this._socket=g.createSocket({socket_id:"searchtopbar_socket_id"}),e.is(this.options)&&e.is(this.options.x3dPlatformId,"string")&&this._resourcesMgt.setActiveTenant(this.options.x3dPlatformId),p.getSearchViewPromise().then(function(){t.log("SearchView promise resolved"),t._socket.dispatchEvent("onSetSources",{sources:t._resourcesMgt.toJSON(),searchParams:t.options.searchParams}),e.is(t.getAddinMode(),"string")&&require(["DS/PlatformAPI/PlatformAPI"],function(e){p.getPowerByInitPromise().then(function(){t.log("publishing search_ready event"),e.publish("webinwin:web:notification",JSON.stringify({event:"search_ready",source:p.SEARCH_APP_ID,version:"1.0",content:{status:!0}}))})}),p.setSearchReady()}),this._socket.addListener("setSelectedSource",function(e){t.log("The selected source have been modified ["+e.value+"]");try{t._resourcesMgt.setActiveTenant(e.value)}catch(t){w.log("SearchRessources.setActiveTenant throw an error (invalid tenant="+e.value+")")}}),this._socket.addListener("onSearch",function(i){if(t.log("Launch command from the result wdg ["+i+"]"),e.is(i.parameters,"object")&&e.is(i.parameters.search_criteria)){if(e.is(i.tabInfo,"object")&&e.is(i.tabInfo.tenant,"string")&&!0===i.transient_widget){try{t._resourcesMgt.setActiveTenant(i.tabInfo.tenant)}catch(e){w.log("SearchRessources.setActiveTenant throw an error (invalid tenant="+i.tabInfo.tenant+")")}t._socket.dispatchEvent("onSelectTenantAfterTabActivation",{tenant:i.tabInfo.tenant})}var n={focus:!1,setTenant:!1},s=!i.in_apps_search&&e.is(i.tabInfo,"object")&&(!0===i.transient_widget||"3DDashboard"!==i.tabInfo.client_identifier);if(i.parameters.search_criteria===p.SearchTypeEnum.MY_CONTENT)s&&t._socket.dispatchEvent("clickOnChoiceMyContent",n);else if(i.parameters.search_criteria===p.SearchTypeEnum.FAVORITE_SEARCH)s&&t._socket.dispatchEvent("clickOnChoiceFavoriteSearch",n);else if(i.parameters.search_criteria===p.SearchTypeEnum.MY_RECENT_CONTENT);else if(!0===i.parameters.adv_search||i.parameters.search_criteria===p.SearchTypeEnum.ADVANCED_SEARCH)s&&t._socket.dispatchEvent("clickOnChoiceAdvancedSearch",n);else{var a=i.parameters.search_criteria;e.is(i.parameters.originalSearchCriteria,"string")&&(a=i.parameters.originalSearchCriteria),e.is(i.parameters.search_criteria_to_display,"string")&&(a=i.parameters.search_criteria_to_display);var r=a,o=i.parameters.search_criteria,c=t._isWidgetMaximized(i.widget_id,t._currentTabId);i.transient_widget||"3DSwym"===p.identifyClientInfo().identifier||c&&i.in_apps_search||(r=null,o=null);var h=!1;!0===c&&!1===i.transient_widget&&(h=!0),t._socket.dispatchEvent("onRefreshSearchField",{searchStringToDisplayInSearchField:r,internalSearchCriteria:o,isPinnedWidgetMaximized:h}),s&&(n.hiddenOptions=[T.search_current_tab],t._socket.dispatchEvent("clickOnChoiceSearch",n))}}}),this._socket.addListener("onSearchModeSwitch",function(i){e.is(i,"object")&&e.is(i.new_mode,"string")&&(t._socket.dispatchEvent("onSwitchMode",i),i.new_mode===p.SearchTypeEnum.MY_RECENT_CONTENT&&"*"===i.paramsFilter&&t._socket.dispatchEvent("onRefreshSearchField",""))}),this._socket.addListener("onSearchFromCompass",function(i){t.init3DSearchWidgetCreatedFromCompass(i);var n=u.getOption("search_compact_mode");if(!(e.is(window)&&e.is(window.innerWidth)&&!(window.innerWidth>958)||e.is(t.getAddinMode(),"string")&&-1!==["solidworks","catiav5"].indexOf(t.getAddinMode())||!1!==n||!0===u.options.search_settings.taggerClosed)){require(["DS/TopFrame/TopFrame"],function(i){var n=!1;if(e.is(i))try{e.is(i.isTaggerVisible,"function")&&!0===i.isTaggerVisible()&&(n=!0)}catch(t){e.is(i._isTaggerVisible)&&!0===i._isTaggerVisible&&(n=!0),w.log(t)}var s=localStorage.getItem("3dSearch-sidePanelPositionBack")||"fitted";!1===n&&e.is(t.options.events.openTagger,"function")&&"normal"!==s&&!0!==p.isFUN109031Active()&&-1===["iphone","android"].indexOf(p.getDeviceCategory())?(t.options.events.openTagger(),p.setTaggerOpenedByCode(!0)):p.setTaggerOpenedByCode(!1)})}"windowed"!==i.mode&&("3DSwym"!==p.identifyClientInfo().identifier&&t._socket.dispatchEvent("onSetFocusInSearchField",{}),setTimeout(function(){e.is(i)&&e.is(i.x3dPlatformId,"string")&&i.x3dPlatformId.length>0&&t._socket.dispatchEvent("onSelectTenant",i.x3dPlatformId)},200))}),this._socket.addListener("onWdgEndEdit",function(){t._wdg_ready=!0}),this._socket.addListener("onWdgCreation",function(i){if(e.is(i.widget_id)){var n=!1;e.is(i.tabid)&&(t._currentTabId=i.tabid,n=!0);var s=t._currentTabId;null===s&&(s=p.getCurrentTabId());var a=t._isWidgetMaximized(i.widget_id,s);!0===n&&!0===n&&e.is(t._topFrame)&&t._topFrame.toggleTagger&&t._topFrame.toggleTagger(!0),t.log("onWdgCreation"),t.log("Widget id ["+i.widget_id+"]"),t.log("Active Tab id ["+s+"]"),t.log("isMaximized ["+a+"]"),t._active_3dsearch_widget.add({widget_id:i.widget_id,active_tab:s,isMaximized:a,isDefault:"true"===i.transient_widget}),"true"===i.transient_widget&&t._socket.dispatchEvent("hideSearchInThisTab")}t._wdg_ready=!0}),this._socket.addListener("onViewChange",function(i){t.log("onViewChange ["+i.widget_id+"]");var n={active_tab:t._currentTabId,widget_id:i.widget_id},s=t._active_3dsearch_widget.where(n);if(e.is(s)&&1===s.length){t.log("Widget ["+s[0].get("widget_id")+"] in store with maximized option "+s[0].get("isMaximized"));var a=s[0].get("widget_id"),r=t._isWidgetMaximized(a,s[0].get("active_tab"));s[0].set("isMaximized",r),t.log("Maximized option is now set to "+s[0].get("isMaximized"));var o={widgetId:a,maximized:r};t._socket.dispatchEvent("toggleProxyFocus",o)}else t.log("No widget with that id found in the store")}),this._socket.addListener("onDestroyWidget",function(e){var i=t._active_3dsearch_widget.where({widget_id:e.widget_id});t._active_3dsearch_widget.remove(i),g.unsubscribeServer(e.widget_id)}),this._socket.addListener("onCloseTransient",function(){c.publish({channel:"GLOBAL_3DSEARCH_MESSAGE_CHANNEL_ID",topic:"datagrid_preference_force_close"})}),this._socket.addListener("onSetFocusInSearchField",function(){t._socket.dispatchEvent("onSetFocusInSearchField",{}),setTimeout(function(){var t=require("DS/TopBar/TopBar");e.is(t)&&e.is(t.view)&&e.is(t.view.focusOnSearch,"function")&&t.view.focusOnSearch()},100)}),this._socket.addListener("onSearchItemClick",this._manageExternalIdCardDelegation.bind(this))},_manageExternalIdCardDelegation:function(t){if(e.is(this.options.searchParams)){var i=!0;if(t.in_apps_search&&(i=!e.is(t.in_apps_search.idcard_activated)||t.in_apps_search.idcard_activated),i){var n=!1;t.in_apps_search?n=!!e.is(t.in_apps_search.external_idcard)&&t.in_apps_search.external_idcard:e.is(this.options.searchParams.external_idcard,"function")?n=this.options.searchParams.external_idcard.call():e.is(this.options.searchParams.external_idcard)&&(n=this.options.searchParams.external_idcard),!0===n&&e.is(this.options.searchParams.idcard,"function")&&this.options.searchParams.idcard.call(void 0,t.model)}}},_addResultUX_customization:function(e){var t=this;Object.keys(e).forEach(function(i){t.result_ux_customization[i]=e[i]})},getResultUX_customization:function(e){return e?this.result_ux_customization[e]:Object.keys(this.result_ux_customization).length>0?this.result_ux_customization:void 0},_isSearchWidgetAvailable:function(t){var i=this,n={wdg_available:!1,maxIndex:void 0,indexSide:void 0,active_tab:null,wdg_search_items:null};n.active_tab=p.getCurrentTabId(),null===n.active_tab&&(n.active_tab=i._currentTabId);let s=i._active_3dsearch_widget.where({active_tab:n.active_tab}),a=i._active_3dsearch_widget.where({isDefault:!0});if(n.wdg_search_items=function(e){for(var t=e.concat(),i=0;i<t.length;++i)for(var n=i+1;n<t.length;++n)t[i]===t[n]&&t.splice(n--,1);return t}(s.concat(a)),i.log("Check if a widget is available for update"),n.wdg_available=!1,e.is(n.wdg_search_items)&&n.wdg_search_items.length>0){var r=!0;if(e.is(t,"object")&&!0===t.forceWidgetUXRecreation&&(r=!1),r){var o=n.wdg_search_items.length;if(o){i.log("A search widget is already instanciated ==> Check if it is still in the active tab");var c=0;for(c=0;c<o;c++){var h=n.wdg_search_items[c].get("widget_id");e.is(e.Widgets)&&e.is(e.Widgets.instances)&&e.Widgets.instances.length>0&&e.Widgets.instances.filter(function(s){if(s.id===h&&s.context===n.active_tab||s.getValue("search_wdg_id")===h){var a=["maximized","fullscreen"];e.is(t,"object")&&e.is(t.viewType,"string")&&t.viewType.length>0&&(a=[t.viewType]),a.includes(s.getView().type)&&(i.log("Widget available reuse it"),n.wdg_available=!0,n.maxIndex=c),"sidepanel"===s.getView().type&&(i.log("Widget available reuse it Side"),n.wdg_available=!0,n.indexSide=c),e.is(t,"object")&&e.is(t.isRecentContent,"boolean")&&t.isRecentContent&&e.is(t.widgetId)&&s.id===t.widgetId&&(i.log("Type of search is recent content"),n.wdg_available=!0,n.indexSide=c)}})}}}}else i.log("No widget registered in the active tab");return n},init3DSearchWidgetCreatedFromCompass:function(t){var i=this._isSearchWidgetAvailable({viewType:t.mode}),n={};if(n.active_tab=i.active_tab,!0===i.wdg_available){var s=0;if(void 0===i.maxIndex&&void 0!==i.indexSide){if(s=i.indexSide,e.is(t.mode)&&"windowed"===t.mode){var a=this._isSearchWidgetAvailable({viewType:"maximized"});e.is(a)&&e.is(a.maxIndex)&&void 0!==a.maxIndex&&(s=a.maxIndex)}}else s=i.maxIndex;n.ressources=new l(this.options.ressources);try{n.ressources.setActiveTenant(t.x3dPlatformId)}catch(e){w.log("SearchRessources.setActiveTenant throw an error (invalid tenant="+t.x3dPlatformId+")")}this._socket.dispatchEvent("onSearchFromCompassInit",n,"widget_socket_"+i.wdg_search_items[s].get("widget_id"))}},_launchWdg:function(t,i){this.log("_launchWdg");var n=this,s=d.getItem("integratedSearch")||!1;d.getItem("search_tabbed_ui");this.setTagPinnedToQuery(i),this.isCtxWdg=void 0!==i.inCtx_widget_id,u.options.search_settings.adv_search_field=null,e.is(i.adv_search_field,"string")&&i.adv_search_field.length>0&&(u.options.search_settings.adv_search_field=i.adv_search_field);var a=!1;i.searchType===p.SearchTypeEnum.MY_RECENT_CONTENT&&(a=!0);var o,c=this._isSearchWidgetAvailable({forceWidgetUXRecreation:i.forceWidgetUXRecreation,isRecentContent:a,widgetId:i.widgetId});if(i.active_tab=c.active_tab,i&&e.is(i.inCtx_widget_id,"string")&&(o=n._ctx_search.getInContextOptions(i.inCtx_widget_id),e.is(o)&&(i.customization_options=o)),d.getItem("integratedSearch")&&!1===s&&!0===c.wdg_available&&(c.wdg_available=!1),!0===c.wdg_available){var h,l="SearchComServer",g=0;g=void 0===c.maxIndex&&void 0!==c.indexSide?c.indexSide:c.maxIndex,!0===s&&void 0!==c.indexSide&&void 0!==c.maxIndex&&n._topFrame&&n._topFrame._frame&&!0===n._topFrame._frame.isPanelOpen("right")&&(n._topFrame._frame.isPanelMaximized("right")||n._topFrame._frame.isPanelFitted("right"))&&(g=c.indexSide);let t=c.wdg_search_items[g].get("widget_id");t&&0===t.indexOf("preview")&&!0!==d.getItem("integratedSearch")&&void 0===this.getAddinMode()&&r.showWidget(p.SEARCH_APP_ID),h="widget_socket_"+t;var _="SearchComServer_"+t;e.is(n._socket.servers,"array")&&n._socket.servers[_]&&(l=_);var m=!0;if(e.is(n._topFrame)&&void 0===c.maxIndex&&!0===s)if(e.is(i)&&e.is(i.fromEmptyString)&&!0===i.fromEmptyString&&(m=!1,!1===n._sidePanelClose&&(m=!0)),!0===n._sidePanelClose||"#advancedSearch"===i.searchType||n._topFrame._visibleXApp){var C={appId:p.SEARCH_APP_ID};"fitted"===(x=localStorage.getItem("3dSearch-sidePanelPositionBack")||"fitted")&&(C.fit=!0),"normal"===x&&(C.minimized=!0),"maximized"===x&&(C.fit=!0),n._topFrame.openPanel("right",C).then(function(){require(["DS/TagNavigator/TagNavigator"],function(e){n._sidePanelClose=!1;let t=Object.assign({},n._topFrame.XAPPS,n._topFrame._externalApps),i=n._topFrame._visibleApp,s=(t&&i&&t[i]||{}).widget,a=e.get6WTagger("RightPanelContext");a&&s&&s.id&&a.setAsCurrent().focusOnCC(s.id)})}),n._topFrame._visibleXApp="search"}else n._topFrame._frame.showPanelContent("right","search");if(i.active_tenant=n._resourcesMgt.getActiveTenant(),!0===i.reSearch&&(m=!0),o&&o.advanced_search&&o.advanced_search.showByDefault&&1!=o.advanced_search.searchOnInit&&(i.adv_search=!0,i.value="#advancedSearch"),!0===m&&n._socket.dispatchEvent("onSearchWdgUpd",i,h,l),"#advancedSearch"===i.searchType){var y={widgetId:t,maximized:!0};n._socket.dispatchEvent("toggleProxyFocus",y)}var b=u.getOption("search_compact_mode");!0!==u.getOption("debug_mode")&&(!e.is(window)||!e.is(window.innerWidth)||window.innerWidth>958)&&(!e.is(n.getAddinMode(),"string")||-1===["solidworks","catiav5"].indexOf(n.getAddinMode()))&&!1===b&&!0!==u.options.search_settings.taggerClosed&&!0!==u.getOption("no_TopFrame_ODT")&&e.is(n._topFrame)&&e.is(n._topFrame.isTaggerVisible,"function")&&!1===n._topFrame.isTaggerVisible()&&e.is(n.options.events.openTagger,"function")&&o&&"widget_id_#saved_search_edit#"===o.id&&!0===p.isFUN109031Active()&&(n.options.events.openTagger(),p.setTaggerOpenedByCode(!0))}else{if(!0===(!!n._topframe_search_delegation&&n.options.searchParams.isOpen.call()))n.log("A search widget is already instantiated ==> Update its content"),n._socket.dispatchEvent("onSearchWdgUpd",i),n._wdg_ready=!0;else{var T={search_ressources:t.selected_source,transient_context:"true",reSearch:i.refine,settings_topbar:u.serialize(),search_criteria_to_display:i.searchStringToDisplayInSearchField,recent_filter:i.searchStringToDisplayInSearchField};i&&e.is(i.value,"string")&&i.value.length>0?(T.search_criteria=i.value,T.adv_search=i.adv_search,T.adv_search_field=i.adv_search_field):T.focus=!0;var I=!0;if(i){if(e.is(i.searchStringToDisplayInSearchField)&&(T.search_criteria_to_display=i.searchStringToDisplayInSearchField),e.is(o)){if(T.customization_options=o,T.customization_options&&i.advanced_search&&i.advanced_search.showByDefault&&(T.customization_options.advanced_search||(T.customization_options.advanced_search=i.advanced_search),T.adv_search=!0,!0===i.advanced_search.searchOnInit&&(I=!0),T.customization_options.advanced_search.default_search_criteria=i.advanced_search.default_search_criteria,T.search_criteria="#advancedSearch",I=!1),e.is(i.displayValue)?T.search_criteria_to_display=i.displayValue:e.is(T.search_criteria_to_display)||(T.search_criteria_to_display=""),e.is(o.bypass_url)&&("5746ca20-811a-11e4-b116-123b93f75cba"===u.options.search_settings.temp_bypass_fedsearch||"5746cf02-811a-11e4-b116-123b93f75cba"===u.options.search_settings.temp_bypass_fedsearch)){var D=T.search_ressources.available_tenants[T.search_ressources.active_tenant];e.is(D)&&e.is(D.sources)&&e.is(D.sources.search)&&(D.sources.search.url=o.bypass_url,n.log("Temporary bypass of fed_search url by app with UIID "+u.options.search_settings.temp_bypass_fedsearch+": "+D.sources.search.url))}i.recent_search&&(T.customization_options.recent_search=i.recent_search)}if(e.is(i.content,"string")&&(T.content=i.content),T.viewData=i.viewData,e.is(T.viewData)||(T.viewData={}),!e.is(T.viewData.global_actions)){var A=n.getResultUX_customization("global_actions");e.is(A)&&e.is(A.actions)&&e.is(A.app_socket_id)&&(T.viewData.global_actions=A),e.is(o)&&(e.is(i.incontext_global_actions)?T.viewData.global_actions={actions:i.incontext_global_actions,app_socket_id:o.app_socket_id}:o.global_actions&&(T.viewData.global_actions={actions:o.global_actions,app_socket_id:o.app_socket_id}))}T.incontext_global_actions=T.viewData.global_actions,e.is(i.itemViewClickHandler)?T.itemViewClickHandler=i.itemViewClickHandler:e.is(o)&&e.is(o.itemViewClickHandler)&&o.itemViewClickHandler.trim().length>0&&(T.itemViewClickHandler=o.itemViewClickHandler),e.is(i.source)?T.source=i.source:e.is(o)&&e.is(o.source)&&(e.is(o.source,"array")?T.source=o.source:e.is(o.source,"string")&&(T.source=[o.source])),T.search_mode=e.is(i.search_mode)?i.search_mode:"index"}T.tag_filter=i.tag_filter,e.is(t.result_ux_customization)&&(T.result_ux_customization=t.result_ux_customization);var E=p.SEARCH_APP_ID;n.log("Widget App Id: "+E),n._wdg_ready=!1,!0===u.getOption("pcs_analysis")&&w.info("Launch widget at: "+Date.now());if(function(){v.login({resources:n._resourcesMgt,onComplete:function(){},onFailure:function(){w.log("login for helper search FAILED")}});require(["DS/SNResultUX/collections/SearchCollection","DS/SNResultUX/utils/WildcardMgr","DS/SNResultUX/utils/SNResultTypeCustoHelper"],function(t,s,a){var r=function(){if(i&&i.advanced_search&&i.advanced_search.showByDefault&&(i.advanced_search.searchOnInit&&(i.value=i.advanced_search.default_search_criteria),i.advanced_search["ds6w:type"])){var r="";i.advanced_search["ds6w:type"].forEach(function(e){var t=e.uri.split(":");r.length>0&&(r+=" OR "),r=r+'flattenedtaxonomies:"types/'+t[t.length-1]+'"'}),r.length>0&&(e.is(i.value,"string")&&i.value.length>0?i.value=i.value+" AND  ("+r+")":i.value=r)}if(i&&e.is(i.value,"string")&&i.value.length>0){var o=i.value;if(o!==p.SearchTypeEnum.ADVANCED_SEARCH&&I){var c=e.is(i.inCtx_widget_id);c||(o=s.manageWildcardAddtion(o)),S.setResources({resources:n._resourcesMgt});var h=new t(null,{event:{onSetup:function(t){t._isAHelper=!0,t.setSearchRessources(n._resourcesMgt);var s={query:o,mode:T.search_mode,with_synthesis:!p.isFetchSynthesisSeparately(),source:e.is(T.source)?T.source:[],refine:i.refine,originalSearchCriteria:i.searchStringToDisplayInSearchField};if(!e.is(s.source)||s.source.length<1){var r=n.getOption("searchParams");if(e.is(r))if(e.is(r.source,"array"))s.source=r.source;else if(e.is(r.getSources,"function")){var h=n.options.searchParams.getSources();e.is(h,"array")&&(s.source=h)}}if(!c){var l=a.getGlobalSearchTypeCustoQuery(o);e.is(l)&&p.addSourceSpecificParameter(s,{sourceIds:["3dspace"],param:{id:"additional_query",value:l}})}if(e.is(T.customization_options)&&(t._ctx_options=T.customization_options),t.setRequestCriteria("fed_search",s,c),i.viewData&&i.viewData.SearchColumnCustoDefinition&&i.viewData.SearchColumnCustoDefinition.viewDefinition){var d=[];i.viewData.SearchColumnCustoDefinition.viewDefinition.forEach(function(e){d.push(e.uri)}),t.setAttributesToRetrieve(d)}}},fetchSynthesisSeparately:p.isFetchSynthesisSeparately()});p.setHelperCollection(p.TRANSIENT_WIDGET_HELPER_ID,h),h.getFirstPageOfResults({reset:!0,onComplete:function(){h._currentState=p.HelperCollectionStatus.SEARCH_SUCCEEDED,n.log("helper search succeeded"),e.is(h._CBOnComplete,"function")&&(n.log("launching _CBOnComplete"),h._CBOnComplete.apply(h,arguments))},onFailure:function(t,i){h._currentState=p.HelperCollectionStatus.SEARCH_FAILED,n.log("helper search failed"),e.is(h._CBOnFailure,"function")?(n.log("launching _CBOnFailure"),h._CBOnFailure.apply(h,arguments)):h.fedSearch_error=i}}),n.log("helper search launched"),h._currentState=p.HelperCollectionStatus.SEARCH_IN_PROGRESS}}};i&&e.is(i.value,"string")&&i.value.indexOf(":")>0?(f.fetchPQsFromServer(n._resourcesMgt),f.getPQFetchPromise().then(r)):r.call()})}.call(),n._topframe_search_delegation){n.options.searchParams.open.call(void 0,{app_id:E,widget_title:"",preferences_wdg:T});b=u.getOption("search_compact_mode");!0===u.getOption("debug_mode")||e.is(window)&&e.is(window.innerWidth)&&!(window.innerWidth>958)||e.is(n.getAddinMode(),"string")&&-1!==["solidworks","catiav5"].indexOf(n.getAddinMode())||!1!==b||!0===u.options.search_settings.taggerClosed||!0===u.getOption("no_TopFrame_ODT")||!e.is(n._topFrame)||!e.is(n._topFrame.isTaggerVisible,"function")||!1!==n._topFrame.isTaggerVisible()||!e.is(n.options.events.openTagger,"function")||!0===p.isFUN109031Active()?p.setTaggerOpenedByCode(!1):(n.options.events.openTagger(),p.setTaggerOpenedByCode(!0))}else if(e.is(n._topFrame)&&!0===s){var x,O={appId:E,data:T,sidePanel:!0};"fitted"===(x=localStorage.getItem("3dSearch-sidePanelPositionBack")||"fitted")&&(O.fit=!0),"normal"===x&&(O.minimized=!0),"maximized"===x&&(O.fit=!0),n._topFrame._visibleXApp="search",n._topFrame.openPanel("right",O).then(function(){require(["DS/TagNavigator/TagNavigator"],function(e){n._sidePanelClose=!1;let t=Object.assign({},n._topFrame.XAPPS,n._topFrame._externalApps),i=n._topFrame._visibleApp,s=(t&&i&&t[i]||{}).widget,a=e.get6WTagger("RightPanelContext");a&&s&&s.id&&a.setAsCurrent().focusOnCC(s.id)})}),n._firstInit=!0}else{T.x3dPlatformId=T.search_ressources.active_tenant,r.showWidget(E,"",T);b=u.getOption("search_compact_mode");!0===u.getOption("debug_mode")||e.is(window)&&e.is(window.innerWidth)&&!(window.innerWidth>958)||e.is(n.getAddinMode(),"string")&&-1!==["solidworks","catiav5"].indexOf(n.getAddinMode())||!1!==b||!0===u.options.search_settings.taggerClosed||!0===u.getOption("no_TopFrame_ODT")||!e.is(n._topFrame)||!e.is(n._topFrame.isTaggerVisible,"function")||!1!==n._topFrame.isTaggerVisible()||!e.is(n.options.events.openTagger,"function")||!0===p.isFUN109031Active()?p.setTaggerOpenedByCode(!1):(n.options.events.openTagger(),p.setTaggerOpenedByCode(!0))}}}},_isWidgetReadyToLaunch:function(){return this._wdg_ready},_updateTenantFromIncontextOptions:function(t){if(e.is(t))if(e.is(t.tenant))try{this._resourcesMgt.setActiveTenant(t.tenant)}catch(e){w.log("SearchRessources.setActiveTenant throw an error (invalid tenant="+t.tenant+")")}else if(e.is(t.inCtx_widget_id,"string")){var i=this._ctx_search.getInContextOptions(t.inCtx_widget_id);if(e.is(i)&&e.is(i.tenant))try{this._resourcesMgt.setActiveTenant(i.tenant)}catch(e){w.log("SearchRessources.setActiveTenant throw an error (invalid tenant="+i.tenant+")")}else{var n=this._resourcesMgt.getAvailableTenants();1===n.length&&this._resourcesMgt.setActiveTenant(n[0].tenantId)}}},getAddinMode:function(){var t,i=this.getOption("addinMode");return e.is(i,"object")&&(t=i.value),t},_isWidgetMaximized:function(t,i){var n;if(e.Widgets){var s=d.getItem("integratedSearch");n=e.Widgets.instances.filter(function(n){return!1===s?!(!e.is(n,"object")||"maximized"!==n.getView().type||(n.id!==t||n.context!==i)&&n.getValue("search_wdg_id")!==t):!(!e.is(n,"object")||"maximized"!==n.getView().type||(n.id!==t||n.context!==i)&&n.getValue("search_wdg_id")!==t)&&(e.is(n.getValue("appId")===p.SEARCH_APP_ID)&&(n.context=i),!0)})}return n&&n.length>0}})}),define("DS/SNSearchUX/SearchDropDown2",["UWA/Core","UWA/Element","UWA/Controls/Abstract","DS/SNSearchUX/SuggestionUXHelper","DS/SNUQLEditor/SNUQLEditorUX","DS/SNInfraUX/PredefinedQueries","DS/SNInfraUX/SearchRessources","DS/SNInfraUX/SearchUtils","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/ServiceDelegationLoader","DS/SNInfraUX/utils/SNCompassUtils","DS/SNResultUX/utils/SearchServices","DS/SNResultUX/utils/ResultCategoryUXHelper","DS/SNResultUX/collections/SearchCollection","DS/UIKIT/Autocomplete","DS/UIKIT/Scroller","DS/PubSub/PubSub","DS/WebappsUtils/WebappsUtils","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","text!DS/SNSearchUX/assets/templates/SearchDropDown/SearchDropDown.html","text!DS/SNSearchUX/assets/templates/SearchDropDown/SearchSettingsTabContent.html","css!DS/SNSearchUX/assets/css/SearchDropDown.css"],function(e,t,i,n,s,a,r,o,c,h,l,d,u,g,p,_,S,m,f,v,C,y){"use strict";return i.extend({tabContainerList:[],tabList:[],categoryList:[],predefinedQueriesElementList:[],maxServerSuggestions:5,init:function(t){this._parent(t),e.is(t)&&e.is(t.eventManager)&&(this.eventManager=t.eventManager),this.collection=new g,this.build()},initSources:function(e){this._srcRessource=new r(e.sources)},build:function(e){var i=this.elements;this.tabContainerList=[],this.tabList=[];var n="sn-search-field uwa-autocomplete nv-autocomplete";i.form=t.create("form",{class:n,autocomplete:"off"}),i.clearSearchButton=document.body.getElement(".clear_btn_search"),i.inputContainer=t.create("div",{class:n+"-searchbox"}).inject(i.form),i.input=t.create("input",{class:n+"-input",placeholder:"Search",type:"text"}).inject(i.inputContainer),i.input.addEvent("keyup",this.onKeyUp.bind(this)),i.input.addEvent("focus",this.onFocus.bind(this)),i.dropdownContainer=t.create("div",{class:n+"-container"}).addClassName("autocomplete-hidden").inject(i.form),i.dropdownContainer.addEvent("mousedown",function(e){document.activeElement.hasClassName("sn-search-field uwa-autocomplete nv-autocomplete-input")&&(this.noBlur=!0)}.bind(this)),i.dropdownContainer.addEventListener("click",function(e){this.isDropDownVisible()&&this.setFocus()}.bind(this)),-1===["iphone","ipad","android"].indexOf(o.getDeviceCategory())?i.input.addEvent("blur",this.onBlur.bind(this)):i.input.addEvent("focusout",this.onBlur.bind(this)),i.contentContainer=t.create("div",{class:"search-global-content-container"}).inject(i.dropdownContainer),i.tabContainer=t.create("div",{class:"search-global-tab-container"}).inject(i.dropdownContainer),i.searchTabContainer=t.create("div",{class:"search-tab-container"}).inject(i.contentContainer),this.tabContainerList.push(i.searchTabContainer),i.historyContainer=t.create("div",{class:"history-container"}).inject(i.searchTabContainer);var a=t.create("div",{class:"history-inter-container-content"}).inject(i.historyContainer);i.historyContentContainer=t.create("div",{class:"history-container-content"}).inject(a),i.clearHistoryContainer=t.create("div",{class:"search-dropdown-clear-history"}).inject(a),i.clearHistoryContainer.addEvent("click",function(e){e.currentTarget.hasClassName("search-disabled")||this.clearHistoryFromLocalStorage()}.bind(this)),i.clearHistoryIcon=t.create("span",{class:"fonticon fonticon-trash search-dropdown-clear-history-icon"}).inject(i.clearHistoryContainer),i.clearHistoryText=t.create("div",{class:"search-dropdown-clear-history-text",text:"Clear search history"}).inject(i.clearHistoryContainer),i.myContentContainer=t.create("div",{class:"mycontent-container"}).inject(i.searchTabContainer),i.myContentSection=this._createThumbnailSection({title:"My Content",icon:"user",containerClassName:"section-container",count:""}),i.myContentSection.container.inject(i.myContentContainer),i.myContentSection.link.addEvent("mousedown",function(e){this.noBlur=!0}.bind(this)),i.myContentSection.link.addEvent("mouseup",function(e){this.onBlur(),this.eventManager.dispatchEvent("myContent",{value:o.SearchTypeEnum.MY_CONTENT,adv_search:!1})}.bind(this)),i.buttonContainer=t.create("div",{class:"search-tab-buttons-container"}).inject(i.searchTabContainer),i.advancedSearchButton=t.create("div",{class:"search-tab-advanced-search-button",html:'<i class="fonticon fonticon-search-cog"></i>Advanced Search'}).inject(i.buttonContainer),i.advancedSearchButton.addEvent("mousedown",function(e){this.noBlur=!0}.bind(this)),i.advancedSearchButton.addEvent("mouseup",function(e){this.onBlur(),this.eventManager.dispatchEvent("advancedSearch",{value:o.SearchTypeEnum.ADVANCED_SEARCH,adv_search:!0})}.bind(this)),!0===c.getOption("ExpertMode")&&(i.expertSearchButton=t.create("div",{class:"search-tab-expert-search-button",html:'<i class="fonticon fonticon-search-cog"></i>Expert Search'}).inject(i.buttonContainer),i.expertSearchButton.addEvent("click",function(e){new s}.bind(this))),i.favoriteSearchButton=t.create("div",{class:"search-tab-favorite-search-button",html:'<i class="fonticon fonticon-favorite-on"></i>Favorite Searches'}).inject(i.buttonContainer),i.favoriteSearchButton.addEvent("mousedown",function(e){this.noBlur=!0}.bind(this)),i.favoriteSearchButton.addEvent("mouseup",function(e){this.onBlur(),this.eventManager.dispatchEvent("favoriteSearches",{value:o.SearchTypeEnum.FAVORITE_SEARCH,adv_search:!1})}.bind(this)),i.settingsTabContainer=t.create("div",{class:"settings-tab-container"}).hide().inject(i.contentContainer),this.tabContainerList.push(i.settingsTabContainer),i.settingsTabContainer.addContent(C),i.predefinedQueriesTabContainer=t.create("div",{class:"predefined-queries-tab-container"}).hide().inject(i.contentContainer),this.tabContainerList.push(i.predefinedQueriesTabContainer),i.predefinedQueriesInput=t.create("div",{class:"predefined-queries-input"}).inject(i.predefinedQueriesTabContainer),i.predefinedQueriesContent=t.create("div",{class:"predefined-queries-content"}).inject(i.predefinedQueriesTabContainer),i.predefinedQueriesContainer=t.create("div",{class:"predefined-queries-container"}).inject(i.predefinedQueriesContent),this.createPredefinedQueriesComponent(),i.predefinedQueriesDocumentationTextContainer=t.create("div",{class:"predefined-queries-documentation-text-container"}).inject(i.predefinedQueriesContent),this.buildPredefinedQueriesDocumentation(i.predefinedQueriesDocumentationTextContainer),i.instantSearchTabContainer=t.create("div",{class:"instant-search-tab-container"}).hide().inject(i.contentContainer),this.tabContainerList.push(i.instantSearchTabContainer),i.suggestionContainer=t.create("div",{class:"suggestion-container"}).inject(i.instantSearchTabContainer),i.instantSearchContainer=t.create("div",{class:"instant-search-container"}).inject(i.instantSearchTabContainer),i.instantSerchEmptyView=t.create("div",{class:"instant-search-empty-view",text:"NO SUGGESTIONS FOUND, PLEASE TRY ANOTHER QUERY"}).inject(i.instantSearchContainer).hide(),i.predefinedQueriesTab=t.create("div",{class:"search-dropdown-tab-predefined-queries"}).inject(i.tabContainer),i.predefinedQueriesTab.addEvent("click",function(e){this.switchActiveTab(i.predefinedQueriesTabContainer,e.currentTarget)}.bind(this)),this.tabList.push(i.predefinedQueriesTab),i.predefinedQueriesTabIcon=t.create("span",{class:"fonticon fonticon-help search-dropdown-tab-icon"}).inject(i.predefinedQueriesTab),i.predefinedQueriesTabText=t.create("div",{class:"search-dropdown-tab-text",text:"Query Assistance"}).inject(i.predefinedQueriesTab),i.settingsTab=t.create("div",{class:"search-dropdown-tab-settings"}).inject(i.tabContainer),i.settingsTab.addEvent("click",function(e){this.switchActiveTab(i.settingsTabContainer,e.currentTarget)}.bind(this)),this.tabList.push(i.settingsTab),i.settingsTabIcon=t.create("span",{class:"fonticon fonticon-cog search-dropdown-tab-icon"}).inject(i.settingsTab),i.settingsTabText=t.create("div",{class:"search-dropdown-tab-text",text:"Settings"}).inject(i.settingsTab),i.searchTab=t.create("div",{class:"search-dropdown-tab-mycontent tab-selected"}).inject(i.tabContainer),i.searchTab.addEvent("click",function(e){this.activateSearchTab(e.currentTarget)}.bind(this)),this.tabList.push(i.searchTab),i.searchTabIcon=t.create("span",{class:"fonticon fonticon-search search-dropdown-tab-icon"}).inject(i.searchTab),i.searchTabText=t.create("div",{class:"search-dropdown-tab-text",text:"Search"}).inject(i.searchTab),this.addSuggestList(this.getHistoryListFromLocalStorage(),[],i.historyContentContainer),this._buildCategories(),i.container=i.form},initSettings:function(){c.getOption("csvSeparatorArray").forEach(function(e){})},getServerSuggestions:function(t){e.is(this._srcRessource)&&e.is(t,"string")&&this._srcRessource.getSuggestions({query:t},function(e){var i=[];e.forEach(function(e){i.push(e.entry)});i.slice(0,this.maxServerSuggestions);this.clearHistory(this.elements.suggestionContainer),this.addSuggestList(this.getHistoryListFromLocalStorage(),i,this.elements.suggestionContainer,t)}.bind(this))},refreshMyContent:function(){this._categorySuggestTimeout=setTimeout(function(){this.fetch({query:"#myContent",count:9,onComplete:function(t,i){var n=[];e.is(t.results)&&t.results.forEach(function(e,i){n.push({title:e["ds6w:label"],icon:e.type_icon_url,image:e.preview_url,model:t._models[i]})}),this._updateCategory({title:"My Content",count:n.length,hits:t.hits,icon:"user",results:n})}.bind(this)})}.bind(this),1e3)},getInputValue:function(){return void 0===this.elements.input.value?"":this.elements.input.value},setInputValue:function(e){this.elements.input.value=e},setFieldValue:function(t){this.setInputValue(t),e.is(t,"string")&&t.length>0?this.showClearSearchButton():(this.hideClearSearchButton(),this.activateSearchTab(this.elements.searchTab)),this.refreshHistoryList()},_setInternalCriteria:function(e){this._internalSearchCriteria=e},getClearSearchButton:function(){return this.elements.clearSearchButton},showClearSearchButton:function(){this.elements.clearSearchButton.show()},hideClearSearchButton:function(){this.elements.clearSearchButton.hide()},setFocus:function(){this.elements.input.focus()},_createSection:function(i){if(e.is(i)&&e.is(i.title)&&e.is(i.count)&&e.is(i.containerClassName)){var n,s=t.create("div",{class:i.containerClassName}),a=t.create("div",{class:i.containerClassName+"-header"}).inject(s);n=e.is(i.icon)?t.create("div",{class:i.containerClassName+"-icon fonticon fonticon-"+i.icon}).inject(a):t.create("div",{class:i.containerClassName+"-icon fonticon"}).inject(a);var r=e.is(i.count)?"<b>"+i.title+"</b> | "+i.count:"<b>"+i.title+"</b> | 0";return{container:s,header:a,image:n,title:t.create("div",{class:i.containerClassName+"-title",title:i.title,html:r}).inject(a),link:t.create("div",{class:i.containerClassName+"-link",text:"View All"}).inject(a)}}return null},_createThumbnailSection:function(i){if(e.is(i)&&e.is(i.title)&&e.is(i.count)&&e.is(i.containerClassName)){var n,s=t.create("div",{class:i.containerClassName}),a=t.create("div",{class:i.containerClassName+"-header"}).inject(s),r=t.create("div",{class:i.containerClassName+"-content"}).inject(s);n=e.is(i.icon)?t.create("div",{class:i.containerClassName+"-icon fonticon fonticon-"+i.icon}).inject(a):t.create("div",{class:i.containerClassName+"-icon fonticon"}).inject(a);var o=e.is(i.count)?"<b>"+i.title+"</b> | "+i.count:"<b>"+i.title+"</b> | 0";return{container:s,header:a,image:n,title:t.create("div",{class:i.containerClassName+"-title",title:i.title,html:o}).inject(a),content:r,link:t.create("div",{class:i.containerClassName+"-link",text:"View All"}).inject(a)}}return null},_createSectionObject:function(e,i){var n=t.create("div",{class:"section-object"});t.create("div",{class:"section-object-image"}).inject(n).style.backgroundImage="url("+e.preview_url+")";var s=t.create("div",{class:"section-object-content"}).inject(n),a=t.create("div",{class:"section-object-title"}).inject(s);t.create("img",{class:"section-object-content-icon"}).inject(a).src=e.type_icon_url;var r=t.create("div",{class:"section-object-content-text",text:e["ds6w:label"]}).inject(a);r.model=i,r.addEventListener("click",function(e){this._onClickObject(e)}.bind(this));t.create("div",{class:"section-object-description",text:"Type | Revision | Maturity | Owner | Community | Modification date | Collab Space | Source"}).inject(s);return n},_createThumbnailObject:function(i,n){var s=t.create("div",{class:"section-thumbnail"});if(e.is(i)){var a=t.create("div",{class:"section-thumbnail-content",title:i.title}).inject(s);e.is(n)&&(a.model=n,a.addEvent("mousedown",function(e){this.noBlur=!0}.bind(this)),a.addEvent("mouseup",function(e){this.onBlur(),this._onClickObject(e)}.bind(this))),e.is(i.id)&&(a.id=i.id,a.addEvent("mousedown",function(e){this.noBlur=!0}.bind(this)),a.addEvent("mouseup",function(e){this.onBlur(),this._onClickApp(e)}.bind(this)));t.create("img",{class:"section-thumbnail-image",src:i.image}).inject(a);var r=t.create("div",{class:"section-thumbnail-title"}).inject(a);if(e.is(i.icon))t.create("img",{class:"section-thumbnail-content-icon"}).inject(r).src=i.icon;t.create("div",{class:"section-thumbnail-content-text",text:i.title}).inject(r)}return s},createPredefinedQueriesComponent:function(){var t=new r({});a.fetchPQsFromServer(t).then(function(){var t=a.getPQs(),i=a.getPQNLS(),n=[];e.is(t)&&t.PQ.forEach(function(e){n.push({id:e.pqid,value:e.value,abbreviations:e.abbreviations,title:i[e.pqid+".Title"]})}),n.sort(function(e,t){return e.title<t.title?-1:e.title>t.title?1:0}),this.buildPredefinedQueriesComponent(n)}.bind(this))},buildPredefinedQueriesComponent:function(e){var i=this.elements,n=this;new p({noResultsMessage:!1,placeholder:"Find",events:{onKeyUp:function(e){n.filterPredefinedQueries(e.currentTarget.value)}}}).inject(i.predefinedQueriesInput).elements.clear.addEventListener("click",function(e){this.filterPredefinedQueries("")}.bind(this)),i.predefinedQueriesTable=t.create("table",{class:"predefined-queries-table"}).inject(i.predefinedQueriesContainer);var s=t.create("tbody",{class:"predefined-queries-table-body"}).inject(i.predefinedQueriesTable);e.forEach(function(e,i){let n;n=i%2==0?t.create("tr",{class:"predefined-queries-grey"}).inject(s):t.create("tr",{class:"predefined-queries-white"}).inject(s),this.predefinedQueriesElementList.push(n);let a=t.create("table").inject(n),r=t.create("tbody").inject(a);t.create("td",{text:e.title,class:"predefined-queries-content-left"}).inject(r);let o=t.create("td",{class:"predefined-queries-content-right"}).inject(r);e.abbreviations.split(",").forEach(function(e){t.create("a",{text:e+":",class:"predefined-queries-content-abbreviation"}).inject(o).addEventListener("click",function(e){this.setInputValue(e.currentTarget.getText()),this.setFocus()}.bind(this)),t.create("span",{text:" "}).inject(o)}.bind(this))}.bind(this)),new _({element:i.predefinedQueriesTable}).inject(i.predefinedQueriesContainer)},filterPredefinedQueries:function(t){if(e.is(t)&&""!==t){var i=0;this.predefinedQueriesElementList.forEach(function(e,n){e.getText().toLowerCase().contains(t.toLowerCase())?(e.show(),e.removeClassName("predefined-queries-white"),e.removeClassName("predefined-queries-grey"),i%2==0?e.addClassName("predefined-queries-grey"):e.addClassName("predefined-queries-white"),i++):e.hide()})}else this.predefinedQueriesElementList.forEach(function(e,t){e.show(),e.removeClassName("predefined-queries-white"),e.removeClassName("predefined-queries-grey"),t%2==0?e.addClassName("predefined-queries-grey"):e.addClassName("predefined-queries-white")})},buildPredefinedQueriesDocumentation:function(e){t.create("p",{class:"predefined-queries-documentation-top",text:"From the proposed list, select a predefined query"}).inject(e),t.create("p",{text:'Predefined Queries use the "predefinedtype_shortcut:searchstring" syntax, for example, "prd:searchstring" to search for products.'}).inject(e),t.create("p",{text:"You can use additional predefined queries (with an s prefix) to search for objects belonging to a standard collaborative space."}).inject(e),new _({element:e}).inject(e.getParent())},_buildCategories:function(){this.categoryList=[],this.categoryList.push(this.elements.myContentSection);var e=this._createThumbnailSection({title:"Application",icon:"",containerClassName:"section-container",count:0});e.container.inject(this.elements.instantSearchContainer).hide(),e.link.addEventListener("click",function(e){l.searchApplicationsInCompass(this.getInputValue())}.bind(this)),this.categoryList.push(e),n.getSuggestHelper().then(function(){for(var e,t=n.getSuggestionCategories(),i=0;i<t.length;i++)(e=this._createThumbnailSection({title:t[i].nls,icon:"",containerClassName:"section-container",count:0})).container.inject(this.elements.instantSearchContainer).hide(),e.link.setAttribute("id",t[i].id),e.link.addEventListener("click",function(e){this._onClickSection(e)}.bind(this)),this.categoryList.push(e)}.bind(this))},_updateCategory:function(t){var i;if(this.categoryList.forEach(function(e){e.title.getAttribute("title")===t.title&&(i=e)}),this._clearCategory(i.container),0===t.count)i.container.hide();else{var n="<b>"+t.title+"</b> | "+t.hits;i.title.setHTML(n),e.is(t.image)?i.image.style.backgroundImage="url("+t.image+")":e.is(t.icon)&&(i.image.className="section-container-icon fonticon fonticon-"+t.icon),i.container.show();for(var s=0;s<t.results.length;s++)"Application"===t.title?this._createThumbnailObject(t.results[s]).inject(i.content):this._createThumbnailObject(t.results[s],t.results[s].model).inject(i.content)}this._isInstantSearchEmpty()?this.elements.instantSerchEmptyView.show():this.elements.instantSerchEmptyView.hide()},_isInstantSearchEmpty:function(){var e=this.elements.instantSearchContainer.getChildren(),t=!0;return e.forEach(function(e){"none"!==e.style.display&&(t=!1)}),t},_clearCategory:function(t){e.is(t)&&t.getChildren().forEach(function(e){(e.className.contains("section-object")&&e.destroy(),e.className.contains("section-container-content"))&&e.getChildren().forEach(function(e){e.className.contains("section-thumbnail")&&e.destroy()})})},_getCategoriesSuggestions:function(t){t.length>=3&&(clearTimeout(this._categorySuggestTimeout),this._categorySuggestTimeout=setTimeout(function(){l.getApplicationsFromCompass(t).then(function(t){if(e.is(t)&&e.is(t.count)&&e.is(t.data)){var i=[];t.data.forEach(function(e){i.push({title:e.title,image:e.icon,id:e.id})});var n={title:"Application",count:i.length,hits:t.count,results:i,image:m.getWebappsAssetUrl("SNSearchUX","images/APPICON.png")};this._updateCategory(n)}}.bind(this)),n.getSuggestHelper().then(function(){var e=n.getSuggests({search_text:t});Object.keys(e).forEach(function(t){e[t].then(function(e){for(var t=[],i=0;i<e.collection.results.length;i++)t.push({title:e.collection.results[i]["ds6w:label"],icon:e.collection.results[i].type_icon_url,image:e.collection.results[i].preview_url,model:e.collection._models[i]});var n={title:e.nls,count:e.collection.results.length,hits:e.collection.hits,image:e.collection.results.length>0?e.collection.results[0].type_icon_url:"",results:t};this._updateCategory(n)}.bind(this),function(e){console.log(t,": ",e)})}.bind(this))}.bind(this))}.bind(this),1e3))},onFocus:function(){this.elements.dropdownContainer.className.contains("autocomplete-hidden")&&(this.refreshHistoryList(),this.refreshMyContent(),this.elements.dropdownContainer.removeClassName("autocomplete-hidden"))},onBlur:function(e){!0===this.noBlur?this.noBlur=!1:this.elements.dropdownContainer.addClassName("autocomplete-hidden")},debugFunction:function(){},onKeyUp:function(e){72===e.keyCode&&this.debugFunction();var t=e.srcElement.value;t.length>0?this.showClearSearchButton():this.hideClearSearchButton(),t.length>2?(this.switchActiveTab(this.elements.instantSearchTabContainer),this.clearHistory(this.elements.suggestionContainer),this.addSuggestList(this.getHistoryListFromLocalStorage(),[],this.elements.suggestionContainer,t),this.getServerSuggestions(t),this._getCategoriesSuggestions(t)):this.switchActiveTab(this.elements.searchTabContainer),this.refreshHistoryList()},_onClickObject:function(t){var i=t.currentTarget.model,n=i.getSourceID(),s=i.getServiceID(),a=i.getPlatformID(),r=i.get("resourceid");if("3dspace"===n){let e=t.target.title;S.dispatch("onViewSearch",[{displayString:e,query:'[ds6w:label]:"'+e+'"'}])}else f.getServiceUrl({serviceName:s,platformId:a,onComplete:function(t){h.load({serviceID:s,platformID:a,serviceURL:t}).then(function(t){if(e.is(t.getDoubleClickAction,"function")){var n={model:i,appID:"X3DSEAR_AP",client_feature:"search_topbar_suggest",onComplete:function(t){e.is(t)&&e.is(t.id,"string")&&e.is(t.sourceJS,"string")&&t.sourceJS.length>0&&require([t.sourceJS],function(e){e.executeAction({action_id:t.id,actionsHelper:{getModel:function(){return i},getPlatformID:function(){return a},getClientInfo:function(){return o.identifyClientInfo("")},getValue:function(e){var t=e.predicate?e.predicate:e.attribute;return i.get(t+"_value")}},object_ids:[r]})})},onFailure:function(e){console.log(e)}};t.getDoubleClickAction.call(void 0,n)}})}})},_onClickApp:function(t){e.is(t.currentTarget.id)&&l.launchApplicationFormCompass(t.currentTarget.id).then(function(e){d._displayAlert({message:e,className:"success"})},function(e){d._displayAlert({message:e,className:"error"})})},_onClickSection:function(t){var i=t.currentTarget.id,s=this.getInputValue(),a=n.buildSearchParams({category_id:i,search_text:s});a.objectToPreview="instantSearch",S.dispatch("onViewSearch",[e.extend({displayString:s},a)])},isDropDownVisible:function(){return!this.elements.dropdownContainer.className.contains("autocomplete-hidden")},addSuggestList:function(t,i,n,s){var a=i.length<t.length&&i.length<5?15-i.length:5,r=0;t.reverse().forEach(function(t){r<a&&(e.is(s,"string")&&s.length>0?t.contains(s)&&t!==s&&(this.addSuggest(t,n,"clock",s),r++):(this.addSuggest(t,n,"clock"),r++))}.bind(this));var o=r<i.length&&r<5?10-r:5;r=0,i.forEach(function(e){r<o&&(this.addSuggest(e,n,"lightbulb"),r++)}.bind(this))},addSuggest:function(i,n,s,a){var r=t.create("div",{class:"search-history-container",title:i}).inject(n);r.addEvent("mousedown",function(e){this.noBlur=!0}.bind(this)),r.addEvent("mouseup",function(e){this.onBlur();let t=e.currentTarget.getText();S.dispatch("onViewSearch",[{displayString:t,query:'[ds6w:label]:"'+t+'"'}])}.bind(this));t.create("span",{class:"fonticon fonticon-"+s+" search-history-icon"}).inject(r);if(e.is(a,"string")&&a.length>0){var o=i.indexOf(a),c=i.substr(0,o),h=i.substr(o+a.length,i.length);t.create("div",{class:"search-history-text",text:c}).inject(r),t.create("div",{class:"search-history-text-filtered",text:a}).inject(r),t.create("div",{class:"search-history-text",text:h}).inject(r)}else t.create("div",{class:"search-history-text",text:i}).inject(r);"clock"===s&&t.create("span",{class:"search-history-delete fonticon fonticon-clear"}).inject(r).addEvent("click",function(e){this.removeHistoryElement(e.currentTarget),this.preventBlur=!0,e.stopPropagation()}.bind(this))},refreshHistoryList:function(t){let i=this.elements.historyContentContainer;e.is(t)&&(i=t),this.clearHistory(i),this.addSuggestList(this.getHistoryListFromLocalStorage(),[],i,this.getInputValue())},clearHistory:function(t){if(e.is(t)){var i=t.getChildren();i.length>0&&i.forEach(function(e){e.remove()})}},removeHistoryElement:function(t){var i=t.getParent();if(e.is(i)){var n=i.getText();i.remove(),this.removeHistoryFromLocalStorage(n),this.refreshHistoryList()}},fetch:function(t){this.collection.setRequestCriteria("fed_search",{ignoreRestrictedSources:!0,order_by:"desc",order_field:"relevance",query:t.query,refine:{allfilters:{},localfilters:{}},select_file:["icon","thumbnail_2d"],source:[],with_synthesis:!0,with_synthesis_hierarchical:!1,next_start:"0"}),e.is(t.count)||(t.count=3),this.collection._resetState(),this.collection.setPageSize(t.count),this.collection.setSearchRessources(this._srcRessource),this.collection.fetch({onComplete:t.onComplete,onFailure:function(e){console.log("Erreur:",e)}})},getHistoryListFromLocalStorage:function(){return e.is(localStorage.SNSearchBoxStore)?JSON.parse(localStorage.SNSearchBoxStore):[]},removeHistoryFromLocalStorage:function(e){var t=this.getHistoryListFromLocalStorage(),i=t.filter(function(t){return t!==e});t.length!==i.length&&(localStorage.SNSearchBoxStore=JSON.stringify(i))},clearHistoryFromLocalStorage:function(){for(var e=this.getHistoryListFromLocalStorage();e.length>0;)e.pop();localStorage.SNSearchBoxStore=JSON.stringify(e),this.refreshHistoryList()},switchActiveTab:function(t,i){this.tabContainerList.forEach(function(e){e===t?e.show():e.hide()}),e.is(i)&&this.tabList.forEach(function(e){e===i?e.addClassName("tab-selected"):e.removeClassName("tab-selected")})},activateSearchTab:function(e){this.refreshHistoryList(),this.getInputValue().length>=3?this.switchActiveTab(this.elements.instantSearchTabContainer,e):this.switchActiveTab(this.elements.searchTabContainer,e)}})}),define("DS/SNSearchUX/SearchDropDown",["UWA/Core","UWA/Element","UWA/Event","UWA/Utils","UWA/Controls/Abstract","UWA/Utils/InterCom","DS/MessageBus/MessageBus","require","css!DS/SNSearchUX/SNSearchUX.css","DS/SNInfraUX/Logger","DS/SNInfraUX/SearchRessources","DS/SNInfraUX/SearchPreferences","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/SearchUtils","DS/PlatformAPI/PlatformAPI","DS/SNInfraUX/SNSearchTypeCusto","DS/SNInfraUX/PredicatesNLS","DS/SNInfraUX/SearchLogin","DS/SNResultUX/utils/SearchServices","DS/SNResultUX/utils/SearchDoubleClickHandler","UWA/Promise","DS/SNSearchUX/SuggestionUXHelper","DS/Notifications/NotificationsManagerUXMessages","DS/Notifications/NotificationsManagerViewOnScreen","DS/PubSub/PubSub","DS/UIKIT/Spinner","DS/WebappsUtils/WebappsUtils","DS/UIKIT/DropdownMenu","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/SNInfraUX/utils/SNCompassUtils","DS/SNInfraUX/ServiceDelegationLoader","DS/SNResultUX/models/SearchItemModel","DS/SNSearchUX/SearchSecondaryMenu","i18n!DS/SNSearchUX/assets/nls/SNSearchUX.json"],function(e,t,i,n,s,a,r,o,c,h,l,d,u,g,p,_,S,m,f,v,C,y,b,T,w,I,D,A,E,x,O,M,P,N){"use strict";var k=!1,B="";return s.extend({_clearSearch:null,_searchBtn:null,_autocompleteSuggests:null,_timeoutId:null,_suggestTimeout:null,_secondTimeoutId:null,_inAppContext:!1,_temporarilyOutOfContext:!1,_inContextOptions:null,_inContextMode:null,_previouslyActiveSource:null,_sitChoice:null,_findInTabNLS:null,_cstoreChoice:[],_cstoreSources:[],_src_ressource:null,_searchStringToDisplayInSearchField:null,_internalSearchCriteria:null,_isTypeListMode:!1,_typeList:[],_suggestionsInPipeline:0,_cancel_suggest_update:!1,_searchResourcesSet:C.deferred(),canvas:null,itemCache:{},serverSuggests:{},dataCache:{},typeTimeout:null,_betaSuggestionTimer:500,addinMode:void 0,init:function(t){if(this._parent(t),e.is(t)&&e.is(t.isBetaOn)&&!0===t.isBetaOn){if(this.betaProgramState=!0,e.is(n.parseQuery(window.location.search).debounce)){var i=parseInt(n.parseQuery(window.location.search).debounce);"number"==typeof i&&(this._betaSuggestionTimer=i)}}else this.betaProgramState=!1;t.addinMode&&(this.addinMode=t.addinMode),this.buildSkeleton(),this.attachEvents(),this._createCompassClientSocket()},_createCompassClientSocket:function(){this._compass_socket=new a.Socket("com.ds.searchdropdown"),this._compass_socket.subscribeServer("com.ds.compass",window)},_buildCategories:function(){this.elements.categoriesContainer=t.create("div",{id:"search-suggests-categories",class:"search-suggests-categories"}).inject(this.elements.suggestsContainer),this.elements.categories=[],y.getSuggestHelper().then(function(){for(var e,t=y.getSuggestionCategories(),i=0;i<t.length;i++)e=this._addCategoryToDropDown(t[i].nls,t[i].id),this._hideCategory(e)}.bind(this));let e={tenant:g.getActiveTenant()};if(!0===u.getOption("activate_instant_search_apps",e)){let e=this._addCategoryAppToDropDown("App");this._hideCategory(e)}},_getSuggestCategoriesResult:function(t){t.length>=3&&!1===this._isPredefinedQueryInstantSearch(t)?(this._showSuggestSpinner(),this._showCategoryContainer(),this.dispatchEvent("onUpdateSuggests"),clearTimeout(this._categorySuggestTimeout),this._categorySuggestTimeout=setTimeout(function(){let i={tenant:g.getActiveTenant()};!0===u.getOption("activate_instant_search_apps",i)&&x.getApplicationsFromCompass(t).then(function(t){e.is(t)&&e.is(t.count)&&e.is(t.data)&&this._updateCategoryApp(t.data,t.count)}.bind(this)),y.getSuggestHelper().then(function(){var i=y.getSuggests({search_text:t,feature:u.getOption("fedsearch_query_label.feature_id.InstantSearch")});Object.keys(i).forEach(function(t){i[t].then(function(i){this.getInputValue().length>=3&&(e.is(i.collection)&&e.is(i.nls)?this._updateCategory(t,i.collection,i.nls,i.collection.hits):e.is(i.nls)&&this._updateCategory(t,[],i.nls,0))}.bind(this),function(e){console.log(t,": ",e)})}.bind(this))}.bind(this))}.bind(this),this._betaSuggestionTimer)):this._clearDropDown()},_addCategoryToDropDown:function(e,i){var n=t.create("ul",{id:"search-suggests-categories-"+e,class:"search-suggest-category"}).inject(this.elements.categoriesContainer),s=t.create("li",{class:"search-category-label-container"}).inject(n),a=t.create("img",{class:"search-category-img"}).inject(s),o=t.create("div",{class:"search-category-label",html:N.get(e)}).inject(s),c=t.create("div",{class:"search-category-view-all",html:N.get("search.suggestion.viewAll"),title:N.replace(N.get("search.suggestion.tooltip"),{category:e})}).inject(s);return c.addEventListener("click",function(e){r.publish({channel:"SearchTrackerApi",topic:"hit",data:{category:"InstantSearch",action:"ClickOnViewMore",persDim:{pd1:"0"}}}),this._onClickViewAll(i,e)}.bind(this)),this.elements.categories.push({container:n,labelContainer:s,img:a,label:o,viewAll:c,item:[],model:{}}),n},_addCategoryAppToDropDown:function(e){var i=t.create("ul",{id:"search-suggests-categories-"+e,class:"search-suggest-category"}).inject(this.elements.categoriesContainer),n=t.create("li",{class:"search-category-label-container",style:"color: red"}).inject(i),s=t.create("li",{class:"search-category-item-container"}).inject(i),a=t.create("img",{class:"search-category-img",src:D.getWebappsAssetUrl("SNSearchUX","images/APPICON.png")}).inject(n),o=t.create("div",{class:"search-category-label",html:N.get(e)}).inject(n),c=t.create("div",{class:"search-category-view-all",html:N.get("search.suggestion.viewAll"),title:N.replace(N.get("search.suggestion.tooltip"),{category:e})}).inject(n);return c.addEventListener("click",function(e){r.publish({channel:"SearchTrackerApi",topic:"hit",data:{category:"InstantSearch",action:"ClickOnViewMore",persDim:{pd1:"0"}}}),x.searchApplicationsInCompass(this.getInputValue())}.bind(this)),this.elements.categories.push({container:i,labelContainer:n,itemContainer:s,img:a,label:o,viewAll:c,item:[],model:{}}),i},_updateCategory:function(i,n,s,a){var r=this;this._hideSuggestSpinner();var o=this.elements.categories.filter(e=>e.container.id.includes(s));if(o.length>0&&a>0){var c=o[0];this._clearCategory(c.container),this._showCategory(c.container);var h=c.label;if(h.setText(s+" ("+a+")"),h.setAttribute("count",a),h.setAttribute("title",s),n.length>0){var l,d,u,g;this._activateCategory(c,a);for(var p=0;p<n.length;p++){l=(g=n._models[p]).get("ds6w:label");var _="search-category-item-rounded";if(d=g.get("preview_url"),e.is(d)||(d=g.get("type_icon_url"),_=""),c.item.push(t.create("li",{class:"search-category-item"}).inject(c.container)),(u=c.item[c.item.length-1]).model=g,e.is(g)&&u.addEventListener("click",function(e){r._onClickItem(e)}),e.is(d)&&t.create("img",{src:d,class:_}).inject(u),e.is(l)){var S=t.create("div",{html:l,title:l}).inject(u);S.setAttribute("title",l),r._resizeCategorySuggestion(S)}}c.img.src=g.get("type_icon_url")}else this._deactivateCategory(c)}},_updateCategoryApp:function(i,n){var s=this.elements.categories.filter(e=>e.container.id.includes("App"));if(s.length>0&&n>0){var a=s[0];this._clearCategory(a.container),this._showCategory(a.container);var r,o=a.label;if(o.setText("App ("+n+")"),o.setAttribute("count",n),o.setAttribute("title","App"),i.length>0){this._activateCategory(a,n);for(var c=0;c<i.length;c++)if(e.is(i[c].id)){if(a.item.push(t.create("div",{class:"search-category-item-horizontal",id:i[c].id}).inject(a.itemContainer)),(r=a.item[a.item.length-1]).addEventListener("click",function(e){this._onClickItemApp(e)}.bind(this)),e.is(i[c].icon)&&t.create("img",{src:i[c].icon}).inject(r),e.is(i[c].title)){r.title=i[c].title;var h=t.create("div",{class:"search-category-item-horizontal-title",html:i[c].title}).inject(r);h.setAttribute("title",i[c].title),this._resizeCategoryAppTitle(h)}if(e.is(i[c].type)&&"Widget"===i[c].type){var l=t.create("div",{class:"search-category-app-widget-container"}).inject(r);t.create("div",{class:"search-category-app-widget-icon"}).inject(l)}}}else this._deactivateCategory(a)}},_onClickItem:function(t){var i=t.currentTarget.model,n=i.getSourceID(),s=i.getServiceID(),a=i.getPlatformID(),o=i.get("resourceid"),c=f.buildCompassSelectionData({widgetId:"",selectedModels:[i]});if(this._compass_socket.dispatchEvent("onSetX3DContent",c),r.publish({channel:"SearchTrackerApi",topic:"hit",data:{category:"InstantSearch",action:"ClickOnResult",persDim:{pd1:i._attributes["ds6w:label"],pd2:i._attributes["ds6w:responsible"],pd3:i._attributes["ds6w:created"],pd4:i._attributes["ds6w:community"],pd5:i._attributes["ds6w:type"],pd6:c.source,pd7:s}}}),"3dspace"===n){let e=t.target.title;w.dispatch("onViewSearch",[{displayString:e,query:'[ds6w:label]:"'+e+'"'}])}else E.getServiceUrl({serviceName:s,platformId:a,onComplete:function(t){O.load({serviceID:s,platformID:a,serviceURL:t}).then(function(t){if(e.is(t.getDoubleClickAction,"function")){var n={model:i,appID:"X3DSEAR_AP",client_feature:"search_topbar_suggest",onComplete:function(t){e.is(t)&&e.is(t.id,"string")&&e.is(t.sourceJS,"string")&&t.sourceJS.length>0&&require([t.sourceJS],function(e){e.executeAction({action_id:t.id,actionsHelper:{getModel:function(){return i},getPlatformID:function(){return a},getClientInfo:function(){return g.identifyClientInfo("")},getValue:function(e){var t=e.predicate?e.predicate:e.attribute;return i.get(t+"_value")}},object_ids:[o]})})},onFailure:function(e){console.log(e)}};t.getDoubleClickAction.call(void 0,n)}})}})},_onClickItemApp:function(t){e.is(t.currentTarget.id)&&x.launchApplicationFormCompass(t.currentTarget.id).then(function(e){f._displayAlert({message:e,className:"success"})},function(e){f._displayAlert({message:e,className:"error"})})},_onClickViewAll:function(t,i){if(!e.is(i)||!i.target.hasClassName("search-category-label-empty")){var n=this.getInputValue(),s=y.buildSearchParams({category_id:t,search_text:n});s.objectToPreview="instantSearch",w.dispatch("onViewSearch",[e.extend({displayString:n},s)])}},_resizeCategorySuggestion:function(e){let t=window.getComputedStyle(e,null).getPropertyValue("font");if(0!==e.offsetWidth&&e.offsetWidth<=this.getTextWidth(e.textContent,t)){for(var i=e.textContent,n=0;n<50&&this.getTextWidth(i+"...")>e.offsetWidth-26;)i=i.slice(0,i.length-2),n++;e.setText(i+"...")}},_resizeCategoryAppTitle:function(e){window.getComputedStyle(e,null).getPropertyValue("font");if(0!==e.offsetWidth){for(var t=e.textContent,i=e.getParent().getParent().getSize().width,n=0;n<50&&this.getTextWidth(t+"...")>i/4;)t=t.slice(0,t.length-2),n++;n>0&&e.setText(t+"...")}},_isPredefinedQueryInstantSearch:function(e){return/^(\w{3}[:]$)/.test(e)},refreshCategories:function(){this._getSuggestCategoriesResult(this.getInputValue())},_clearDropDown:function(){this._hideSuggestSpinner();for(var e=0;e<this.elements.categories.length;e++)this._clearCategory(this.elements.categories[e].container),this._hideCategory(this.elements.categories[e].container);this._hideCategoryContainer()},_clearCategory:function(e){for(var t=e.getChildren(),i=0;i<t.length;i++)if(t[i].hasClassName("search-category-item-container"))for(var n=t[i].getChildren(),s=0;s<n.length;s++)n[s].destroy();else t[i].hasClassName("search-category-label-container")||t[i].destroy()},_hideCategory:function(e){this._clearCategory(e),e.hide()},_showCategory:function(e){e.show()},_activateCategory:function(t,i){t.labelContainer.hasClassName("search-category-label-empty")&&t.labelContainer.removeClassName("search-category-label-empty"),e.is(t.img)&&e.is(t.img.src)&&t.img.show(),e.is(t.viewAll)&&e.is(t.viewAll.show)&&(e.is(i)&&i<1?t.viewAll.hide():t.viewAll.show())},_deactivateCategory:function(t){t.labelContainer.hasClassName("search-category-label-empty")||t.labelContainer.addClassName("search-category-label-empty"),e.is(t.img)&&e.is(t.img.src)&&t.img.hide(),e.is(t.viewAll)&&e.is(t.viewAll.hide)&&t.viewAll.hide()},_hideSuggestSpinner:function(){e.is(this.elements.suggestSpinnerContainer)&&this.elements.suggestSpinnerContainer.hide()},_showSuggestSpinner:function(){e.is(this.elements.suggestSpinnerContainer)&&this.elements.suggestSpinnerContainer.show()},_hideCategoryContainer:function(){this.elements.categoriesContainer.isHidden()||this.elements.categoriesContainer.hide()},_showCategoryContainer:function(){this.elements.categoriesContainer.isHidden()&&this.elements.categoriesContainer.show()},isDropDownVisible:function(){return!this.elements.suggestsContainer.isHidden()},setInContextMode:function(e){this._inContextMode=e,!0===e&&!0===this.betaProgramState&&this._clearDropDown()},_suggestPreviousQueries:function(t,i){var n=null,s=null;if(0===this._typeList.length&&(this._typeList=_.getSearchTypeCustoList()),this._isTypeListMode=!1,this._value=i,this._typeList.length&&0===i.length&&(n=this._typeList,this._isTypeListMode=!0),e.is(localStorage.SNSearchBoxStore)){n=JSON.parse(localStorage.SNSearchBoxStore);var a=[];i&&""!==i.replace(/\s+/g,"")?n.forEach(function(e){0===e.indexOf(i)&&e!==i&&a.push(e)}):a=n,s=a.reverse();var r=10;!0===u.getOption("search_compact_mode")&&(r=u.getOption("suggest_max")),!0===this.betaProgramState&&!0!==this._inContextMode&&this.secondaryMenu.currentMode!=N.search_current_tab&&this.getInputValue().length>=3&&(r=2),s.length>r&&(s=s.slice(0,r)),t.dispatchEvent("onUpdateSuggests",[s]),t.typeTimeout=null}else t.dispatchEvent("onUpdateSuggests",[s]);this.historySuggestions=s},getServerSuggestions:function(t){var i,n=this,s={query:t.replace(/^\s+|\s+$/g,""),input:t.replace(/^\s+|\s+$/g,"").split(" ")};if(e.is(n.secondaryMenu)&&e.is(n.secondaryMenu.getCurrentTenant)&&(i=n.secondaryMenu.getCurrentTenant()),t.length){if(!0===g.isSuggestAvailable(i)){this.getSearchResources().then(function(){m.login({resources:n._src_ressource,onComplete:function(){var t,i;t=u.getOption("suggest_length"),i=u.getOption("suggest_max_length"),s.query.length>t-1&&s.query.length<i&&!e.is(n._inContextOptions)&&n.elements.input.placeholder===n._getPlaceHolderTextDependingOnActiveTenant("searchNew")&&(n._suggestionsInPipeline++,!1===n._src_ressource.getSuggestions(s,function(e){n._suggestionsInPipeline--;var t=(e=e||[]).map(function(e){return{label:e.entry,command:e.entry,icon:"lightbulb"}});n._cancel_suggest_update||t.length>0&&0===n._suggestionsInPipeline&&n.dispatchEvent("onUpdateSuggests",{serverSuggests:t})})&&n._suggestionsInPipeline--)},onFailure:function(){}})})}}else n.dispatchEvent("onUpdateSuggests",{serverSuggests:[]})},getSearchResources:function(){return this._searchResourcesSet.promise},_buildSearchChoice:function(t){var i=t.sources,n=this;r.subscribe({channel:"TopBar_Suggest",topic:"CancelSuggest",callback:function(){n._cancel_suggest_update=!0}});this.elements;if(this.elements.container.addEvent("drop",function(e){var t=null,i=!!document.documentMode,n=!i&&!!window.StyleMedia;if(i||n||""===e.dataTransfer.getData("shortData")){if(""!==e.dataTransfer.getData("text")){var s=JSON.parse(e.dataTransfer.getData("text"));t=[],s.data.items.forEach(function(e){t.push('"'+e.displayName+'"')})}}else e.preventDefault(),t=JSON.parse(e.dataTransfer.getData("shortData"));e.target.value=t.join(" OR "),e.stopPropagation(),e.preventDefault()}),this.elements.container.addEvent("paste",function(t){var i,s=N.search;if(e.is(n.secondaryMenu)&&e.is(n.secondaryMenu.getCurrentTenant)&&(i=n.secondaryMenu.getCurrentTenant()),e.is(i)&&"OnPremise"!==i.tenantId&&e.is(n.secondaryMenu)&&!n.secondaryMenu.isSingleTenant()?s+=" "+i.tenantName:s=N.searchNew,n.elements.input.placeholder===s||n.elements.input.placeholder===N.search_current_tab){var a=0;if(e.is(t.target)&&e.is(t.target.selectionStart)&&e.is(t.target.selectionEnd)&&(a=t.target.value.length-(t.target.selectionEnd-t.target.selectionStart)),0===a&&e.is(t)){var r=null;e.is(t.clipboardData)&&e.is(t.clipboardData.getData,"function")?(r=t.clipboardData.getData("text/plain"),n.getServerSuggestions(r)):e.is(window.clipboardData)&&e.is(window.clipboardData.getData,"function")&&(r=window.clipboardData.getData("Text"),n.getServerSuggestions(r));var o="";if(e.is(r,"string")&&r.length>0){var c=r.indexOf("\t")>=0,h=r.indexOf("\n")>=0,l=r.indexOf("||")>=0,d=r.indexOf("&&")>=0,g=r.indexOf("\\&&")>=0,p=r.indexOf("\\||")>=0;if(n._setInternalCriteria(r),!1===c&&!1===h&&!1===l&&!1===d)return void n._showClearSearchBtn();var _=r.split("\n"),S="",m=!1;if(e.is(_,"array")&&_.length>0){for(var f=0,v=_.length;f<v;f++)if(e.is(_[f],"string")&&(_[f]=_[f].trim(),_[f].length>0)){var C=null,y="AND";c=(S=_[f]).indexOf("\t")>=0,l=S.indexOf("||")>=0,d=S.indexOf("&&")>=0,g=S.indexOf("\\&&")>=0,p=S.indexOf("\\||")>=0,!0===g&&(S=S.replace(/\\\&/g,"##__##")),!0===p&&(S=S.replace(/\\\|/g,"__##__")),!0===c?C=S.split("\t"):!0===d?C=S.split("&&"):!0===l?(C=S.split("||"),y="OR"):C=[S];for(var b="",T=0,w=C.length;T<w;T++)e.is(C[T],"string")&&(C[T].trim(),C[T].length>0&&(!0===g&&(C[T]=C[T].replace(/##__##/g,"&")),!0===p&&(C[T]=C[T].replace(/__##__/g,"|")),b.length>0&&(b+=" "+y+" "),C[T].length>1&&'"'===C[T][0]&&'"'===C[T][C[T].length-1]&&(C[T]=C[T].substr(1,C[T].length-2)),C[T]=C[T].replace(/\\([\s\S])|(")/g,"\\$1$2"),b+='"'+C[T]+'"'));b.length>0&&(!0===m&&(o+=" OR "),v>1&&(o+="("),o+=b,v>1&&(o+=")"),m=!0)}var I=u.getOption("maxTopBarInput");o.length>I&&(o=o.substring(0,I)),t.target.value=o,o.length>0&&n._showClearSearchBtn(),t.stopPropagation(),t.preventDefault()}}}}}),e.is(i)||(i=this.options.allSources),!e.is(i,"object"))throw new Error("Invalid value for allSources in SearchAutocomplete._buildSearchChoice!");i.loadPredicates=!0,this._src_ressource=new l(i),this._searchResourcesSet.resolve(),this._cstoreSources=this._src_ressource.getAvailableTenants(),this._cstoreSources.length>1&&(k=!0),e.is(this._cstoreSources,"array")&&this._cstoreSources.length>0&&(B=this._cstoreSources[0].tenantId),g.setAutocompleteRendered()},_getSearchBtn:function(){return null===this._searchBtn&&(this._searchBtn=e.extendElement(document.body).getElement(".run_btn_search")),this._searchBtn},_changeSearchBtnIcon:function(t){var i=this._getSearchBtn();if(e.is(i)){for(var n=i.classList,s=new RegExp("fonticon-\\S+$"),a=0;a<n.length;a++)s.test(n[a])&&i.removeClassName(n[a]);i.addClassName(t)}},setInAppContext:function(t){!1===t.isInAppContext&&(this._inContextOptions=null),this._inAppContext=t.isInAppContext,!0===t.isInAppContext&&e.is(t.data)&&e.is(t.data.search_criteria_to_display,"string")?this.setFieldValue(t.data.search_criteria_to_display):(this.secondaryMenu.currentMode,N.search_current_tab,this.setFieldValue("")),this._temporarilyOutOfContext=!1},_setFindInApp:function(t){if(this._internalSearchCriteria=null,this._setPlaceHolderValue(N.get("find_in_app")),e.is(this._sitChoice)&&(this._sitChoice.setHTML(N.get("find_in_app")),this._sitChoice.getParent().addClassName("selected")),e.is(t)&&e.is(t.tenant)){if(this.options.events.setSourceCStorage(t.tenant),this._cstoreSources.length>1&&e.is(this._cstoreChoice)&&this._cstoreChoice.length>0)for(var i=0;i<this._cstoreSources.length;i++)this._cstoreSources[i].tenantId===t.tenant?this._cstoreChoice[i].getParent().addClassName("active"):this._cstoreChoice[i].getParent().removeClassName("active");this._setPlaceHolderValue(this._getPlaceHolderTextDependingOnActiveTenant("find_in_app"))}else this.options.events.setSourceCStorage(B);this._inContextOptions=t},setFindInApp:function(e){this.keepPreviousSearchMode(),this._setFindInApp(e)},keepPreviousSearchMode:function(){this.elements.input.placeholder===this._findInTabNLS||this.elements.input.placeholder===this._getPlaceHolderTextDependingOnActiveTenant("find_in_app")?this._previouslyActiveSource=g.SearchTypeEnum.SEARCH_IN:this.elements.input.placeholder===this._getPlaceHolderTextDependingOnActiveTenant("search")?this._previouslyActiveSource=g.SearchTypeEnum.SEARCH:this.elements.input.placeholder===this._getPlaceHolderTextDependingOnActiveTenant("mycontent")?this._previouslyActiveSource=g.SearchTypeEnum.MY_CONTENT:this.elements.input.placeholder===this._getPlaceHolderTextDependingOnActiveTenant("adv_search")?this._previouslyActiveSource=g.SearchTypeEnum.ADVANCED_SEARCH:this.elements.input.placeholder===this._getPlaceHolderTextDependingOnActiveTenant("MySavedSearches")?this._previouslyActiveSource=g.SearchTypeEnum.FAVORITE_SEARCH:this._previouslyActiveSource=g.SearchTypeEnum.SEARCH_IN},onSwitchToFindInApp:function(e){this._setFindInApp(e)},buildSkeleton:function(){var e=this.elements,i=this.options.className;e.form=t.create("form",{class:i,autocomplete:"off"}),e.inputContainer=t.create("div",{class:i+"-searchbox"}).inject(e.form),e.input=t.create("input",{class:i+"-input",placeholder:this.options.placeholder,type:"text",maxlength:u.getOption("maxTopBarInput")}).inject(e.inputContainer),this.resetInput(),e.suggestsContainer=t.create("div",{class:i+"-suggests"}).inject(e.form),e.serverSuggests=t.create("ul",{id:"search-suggests-server"}).inject(e.suggestsContainer),e.suggests=t.create("ul",{id:"search-suggests-history"}).inject(e.suggestsContainer),e.container=e.form,!0===this.betaProgramState&&(e.suggestSpinnerContainer=t.create("ul",{id:"search-suggests-spinner-container",class:"search-suggests-spinner-container"}).inject(e.suggestsContainer).hide(),e.suggestSpinner=new I({className:"search-suggests-spinner"}).inject(e.suggestSpinnerContainer).show(),this._buildCategories())},getSuggestions:function(t){var i,n,s,a=this;if(t)return this.dataCache[t]?(this.dispatchEvent("onUpdateSuggests",[this.dataCache[t]]),void(this.typeTimeout=null)):this.options.suggestUrl&&(i=(s=this.options.suggestUrl.split("?"))[0],n=s[1].replace("{text}",t),e.is(this.options.source))?(n=this.options.source.getServicesData("suggest",t),UWA.Data.request(i,{method:this.options.method||"POST",data:this.options.data||n,type:this.options.type||"json",headers:this.options.headers||{"Content-Type":"application/json"},onComplete:function(e){return(e=a.dataParse(e)).length>0&&(a.dataCache[t]=e,a.dispatchEvent("onUpdateSuggests",[e])),a.typeTimeout=null,a.typeTimeout},proxy:this.options.proxy||null})):void 0},onUpdateSuggests:function(t){this.dispatchEvent("onShowSuggests");var i,n,s,a=this.elements,o=this;null===t&&(a.suggests.empty(),a.serverSuggests.empty()),e.is(t)&&e.is(t.serverSuggests,"array")&&t.serverSuggests.length>0?(a.suggestsContainer.show(),s=t.serverSuggests,a.serverSuggests.empty(),o.serverSuggests={},s.forEach(function(e){i=o.createSuggestElement(!0,e.command,e.icon,a.input.value,a.serverSuggests,e.label),o.resizeText(i),o.serverSuggests[e.command]=o.querySuggest(e),i.addEvent("click",function(){r.publish({channel:"SearchTrackerApi",topic:"hit",data:{category:"InstantSearch",action:"ClickOnSuggestionIndex",persDim:{pd1:e.label}}}),o.dispatchEvent("onSelect",[e.command,o.serverSuggests[e.command]])})})):(e.is(t)&&e.is(t.history,"Array")||Array.isArray(t))&&(s=t.history||t,a.suggests.empty(),a.serverSuggests.empty(),s.forEach(function(e){n=o.getFormattedSuggest(e),i=o.createSuggestElement(!1,n,"clock",a.input.value,a.suggests),o.resizeText(i),i.addEvent("click",function(e){var t=e.currentTarget.title,i=o.historySuggestions.findIndex(e=>e===t);r.publish({channel:"SearchTrackerApi",topic:"hit",data:{category:"InstantSearch",action:"ClickOnSuggestionHistory",persDim:{pd1:t,pd2:"index: "+i}}}),o.dispatchEvent("onSelect",[t,e])})})),0===a.suggests.childElementCount&&0===a.serverSuggests.childElementCount&&(!1===this.betaProgramState||e.is(a.categoriesContainer)&&a.categoriesContainer.isHidden())?a.suggestsContainer.hide():a.suggestsContainer.show(),0===a.suggests.childElementCount?a.suggests.hide():a.suggests.show(),0===a.serverSuggests.childElementCount?a.serverSuggests.hide():a.serverSuggests.show()},onHideSuggests:function(){this.elements.container.removeClassName(this.options.className+"-suggestsDisplayed")},onShowSuggests:function(){this.elements.container.addClassName(this.options.className+"-suggestsDisplayed")},createSuggestElement:function(i,n,s,a,r,o){var c,h;(h=i?t.create("div",{class:"search-suggest-div-element",title:n}):t.create("div",{class:"search-history-div-element",title:n}),s)&&t.create("span",{class:"fonticon fonticon-"+(s||"clock")}).inject(h);if((c=i?t.create("a",{class:"search-suggest-element"}).inject(h):t.create("a",{class:"search-history-element"}).inject(h)).setText(n),a&&o){o=e.String.escapeHTML(o||""),a=e.String.escapeHTML(a.split(" ").pop()),o&&n!==o&&(c.innerHTML='<span style="color:#ccc; font-size:13px;">'+function(e,t,i){let n=e;if(n){let e=n.lastIndexOf(t);e>=0&&(n=n.substring(0,e)+i+n.substring(e+t.length))}return n}(c.innerHTML,o,"</span>"+o));var l=function(e){return e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}(a),d=new RegExp(l+"(?!.*"+l+")","i"),u=o.replace(d,"<strong>$&</strong>");c.innerHTML=u}return h.inject(r),h},onClick:function(e){r.publish({channel:"SearchTrackerApi",topic:"hit",data:{category:"InstantSearch",action:"focusOnSearchField"}}),-1===this.elements.form.className.indexOf("nv-autocomplete-suggestsDisplayed")&&this.onFocus(e),!0===this.betaProgramState&&!0!==this._inContextMode&&this.refreshCategories()},onFocus:function(){if(this._cancel_suggest_update=!1,this._inContextOptions&&this._inContextOptions.advanced_search&&this._inContextOptions.advanced_search.exclusive)this.dispatchEvent("onUpdateSuggests",[[]]);else{var e=this.getInputValue();this._suggestPreviousQueries(this,e),this.getServerSuggestions(e),this.dispatchEvent("onShowSuggests"),""===e&&!0===u.options.search_settings.search_on_keyup&&this.dispatchEvent("defaultSearch",{value:"*"})}},onBlur:function(){!0!==this.preventBlur?setTimeout(function(){this.dispatchEvent("onHideSuggests"),e.is(this.elements.searchOptions)&&this.elements.searchOptions._secondaryMenu.hide(),this._cancel_suggest_update=!0}.bind(this),200):this.preventBlur=!1},onKeyUp:function(t){var n=this;if(38!==t.keyCode&&40!==t.keyCode&&37!==t.keyCode&&39!==t.keyCode&&35!==t.keyCode&&36!==t.keyCode&&27!==t.keyCode){if(e.is(this.elements.input)&&"?"===this.getInputValue())return this.setFieldValue(""),void this._showPQSelectionUX();this._setInternalCriteria(null),e.is(window.notifs)||(window.notifs=b,T.setNotificationManager(window.notifs));var s=t.srcElement;if(s.value.length>=s.maxLength){var a={level:"warning",title:N.get("searchFieldMaxLengthTitle"),message:N.replace(N.get("searchFieldMaxLengthText"),{number:u.getOption("maxTopBarInput")}),sticky:!1};T.removeLastNotificationDisplayed(),window.notifs.addNotif(a)}var r,o=i.getElement(t);o.value?o.value.length>0?(this._showClearSearchBtn(),this._suggestPreviousQueries(this,o.value)):(this.elements.input.placeholder!==N.search_current_tab&&this._hideClearSearchBtn(),this._suggestPreviousQueries(this,o.value)):(this.elements.input.placeholder!==this._findInTabNLS&&this.elements.input.placeholder!==N.search_current_tab&&this._hideClearSearchBtn(),this._suggestPreviousQueries(this,o.value)),!1===u.options.search_settings.search_on_keyup?!0===this.betaProgramState&&!0!==this._inContextMode&&this.secondaryMenu.currentMode!=N.search_current_tab?(n._getSuggestCategoriesResult(o.value),clearTimeout(this._suggestTimeout),this._suggestTimeout=setTimeout(function(){n.getServerSuggestions(o.value)},350)):(clearTimeout(this._suggestTimeout),this._suggestTimeout=setTimeout(function(){n.getServerSuggestions(o.value)},350)):(o.value&&0===o.value.length&&clearTimeout(this._secondTimeoutId),clearTimeout(this._timeoutId),this._timeoutId=setTimeout((r=o.value,function(){r&&r.length>0&&n.options.events.onSearch(r),n._suggestPreviousQueries(n,r),clearTimeout(n._suggestTimeout),n._suggestTimeout=setTimeout(function(){n.getServerSuggestions(r)},350)}),500))}},onKeyDown:function(e){var t=UWA.Event.whichKey(e);38===e.keyCode?this._arrowKeyOnSuggestions(e,-1):40===e.keyCode?this._arrowKeyOnSuggestions(e,1):27===e.keyCode?this._escapeKeyOnSuggestions(e):"ctrl+a"===t&&e.stopPropagation()},attachEvents:function(){var t;(t=this.elements).input.addEvent("keyup",this.onKeyUp.bind(this)),-1===["iphone","ipad","android"].indexOf(g.getDeviceCategory())?t.input.addEvent("blur",this.onBlur.bind(this)):t.input.addEvent("focusout",this.onBlur.bind(this)),t.input.addEvent("focus",this.onFocus.bind(this)),t.form.addEvent("submit",function(n){var s=this.itemCache[t.input.value.toLowerCase()];return r.publish({channel:"SearchTrackerApi",topic:"hit",data:{category:"InstantSearch",action:"HitOnEnter-SearchField",persDim:{pd1:t.input.value}}}),i.stop(n),e.is(this.serverSuggests)&&-1!==Object.keys(this.serverSuggests).indexOf(t.input.value)?(this.dispatchEvent("onSelect",[t.input.value,this.serverSuggests[t.input.value]]),t.input.blur(),this.dispatchEvent("onHideSuggests")):this.options.shouldExist&&!s||(this.options.suggestKey&&s&&(t.input.value=s[this.options.suggestKey]),this.dispatchEvent("onSelect",[t.input.value,s]),t.input.blur(),this.dispatchEvent("onHideSuggests")),!1}.bind(this)),(t=this.elements).input.addEvent("keydown",this.onKeyDown.bind(this)),t.input.addEvent("click",this.onClick.bind(this))},dataParse:function(t){var i,n,s,a=this.options.dataParser;if(e.is(a,"function"))t=a(t);else{if(Json.isJson(t))t=Json.decode(t),s=!0;else for(i in t=Json.xmlToJson(t))if(t.hasOwnProperty(i)){t=t[i];break}for(i in t)t.hasOwnProperty(i)&&(n||(n=i),Array.isArray(t[i])&&(t=t[i],s=!0));!s&&n&&(t=[t[n]])}return Array.isArray(t)?t:[]},_escapeKeyOnSuggestions:function(){this.dispatchEvent("onHideSuggests")},_arrowKeyOnSuggestions:function(t,n){var s=this._getSuggestions().getChildren()[0].getChildren().concat(this._getSuggestions().getChildren()[1].getChildren());if(!0===this.betaProgramState)for(var a=0;a<this.elements.categories.length;a++)for(var r=0;r<this.elements.categories[a].item.length;r++)s.push(this.elements.categories[a].item[r]);if(!(s.length<1)){this.dispatchEvent("onShowSuggests");var o=-1,c=-1;for(a=0;a<s.length;a++)if(s[a].hasClassName("suggestion-selected")){o=a;break}if((c=o+n)<0&&(c=s.length-1),c>s.length-1&&(c=0),o>=0&&s[o].removeClassName("suggestion-selected"),c>=0){s[c].addClassName("suggestion-selected");var h=i.getElement(t);e.is(h)&&(h.value=s[c].getText()),this._showClearSearchBtn()}}},_showPQSelectionUX:function(){this.dispatchEvent("showPQListUX")},onSelect:function(t,i,n){e.is(n,"string")&&n.length>0&&(this._isTypeListMode=!0,this._value=""),this._setInputValue(t),this.dispatchEvent("onHideSuggests"),this._showClearSearchBtn()},_getClearSearchBtn:function(){return null===this._clearSearch&&(this._clearSearch=e.extendElement(document.body).getElement(".clear_btn_search")),this._clearSearch},_showClearSearchBtn:function(){var t=this._getClearSearchBtn();if(e.is(t)&&e.is(t.show,"function")){t.setStyle("display","inline-block"),t.show();var i=e.extendElement(document.body).getElement(".nv-autocomplete-input");e.is(i)&&i.addClassName("clear-visible")}},_hideClearSearchBtn:function(){var t=this._getClearSearchBtn();if(e.is(t)&&e.is(t.hide,"function")){t.hide();var i=e.extendElement(document.body).getElement(".nv-autocomplete-input");e.is(i)&&i.removeClassName("clear-visible")}},_setPlaceHolderValue:function(t){if(!e.is(t,"string"))throw new Error("Bad arg in _setPlaceHolderValue!");switch(t){case N.get("MySavedSearches"):this._changeSearchBtnIcon("fonticon-favorite-on");break;case N.get("mycontent"):this._changeSearchBtnIcon("fonticon-user");break;case N.get("search"):this._changeSearchBtnIcon("fonticon-search");break;case N.get("similar_search"):this._changeSearchBtnIcon("fonticon-search-similar");break;case this._findInTabNLS:this._changeSearchBtnIcon("fonticon-filter");break;case N.get("adv_search"):this._changeSearchBtnIcon("fonticon-search-cog");break;default:this._changeSearchBtnIcon("fonticon-search")}if(!e.is(this.elements.input)||!e.is(this.elements.input.placeholder))throw new Error("placeholder not found!");this.elements.input.placeholder=t},getPlaceHolder:function(){return this.elements.input.placeholder},_getSuggestions:function(){return null===this._autocompleteSuggests&&(this._autocompleteSuggests=e.extendElement(document.body).getElement(".nv-autocomplete-suggests")),this._autocompleteSuggests},_setInputValue:function(e){this.elements.input.value=e},getInputValue:function(){return void 0===this.elements.input.value?"":this.elements.input.value},setFieldValue:function(t){this._setInputValue(t),this._searchStringToDisplayInSearchField=t,e.is(t,"string")&&t.length>0?this._showClearSearchBtn():this._hideClearSearchBtn()},_setInternalCriteria:function(e){this._internalSearchCriteria=e},_getPlaceHolderTextDependingOnActiveTenant:function(t){if(!e.is(t,"string")||0===t.length)throw new Error("E_INVALIDARG: need a key !");var i=N.get(t);return this._cstoreSources.length>1&&(e.is(N[t+"_in_active"])?i=N.replace(N.get(t+"_in_active"),{tenant:this.getSelectedTenant().displayName}):i+=" "+this.getSelectedTenant().displayName),i},isMultiTenantContext:function(){return k},setSelectedTenant:function(t){B=t,e.is(this._src_ressource)&&this._src_ressource.setActiveTenant(B)},getSelectedTenant:function(){if(!k)throw new Error("E_INVALIDARG: not in multi tenant context, check first using isMultiTenantContext before calling this function !");var t=null;if(e.is(this.secondaryMenu)&&e.is(this.secondaryMenu.getCurrentTenant)){var i=this.secondaryMenu.getCurrentTenant();t={tenantId:i.tenantId,displayName:i.tenantName}}return null===t&&(t={tenantId:B,displayName:B}),t},_findInthisTabOnClick:function(e){!0===e&&this._restoreActiveSearchInTab(),g.isOneSearchInternalProd()&&(d.setItem("find_in_this_tab_default",e),u.changeSettings({find_in_this_tab_default:e}),d.commit())},_restoreActiveSearchInTab:function(){var t=this;if("3DDashboard"===g.identifyClientInfo().identifier){require(["DS/Dashboard/PublicAPI"],function(i){var n=i.getActiveTab();e.is(n)&&e.is(n.shouldPropagateSearch)&&!0===n.shouldPropagateSearch&&e.is(n.shouldPropagateSearchArg,"string")&&0<n.shouldPropagateSearchArg.length&&t.setFieldValue(n.shouldPropagateSearchArg)})}},getFocus:function(){this.elements.input.focus()},querySuggest:function(e){return{search_type:"#search",value:e.command,searchStringToDisplayInSearchField:e.label,internalSearchCriteria:null,adv_search:!1}},resetInput:function(){this.elements.input.placeholder?this._setInputValue(""):this._setInputValue(this.options.placeholder),this.resetCache()},resetCache:function(){this.dataCache={},this.itemCache={}},resizeText:function(e){var t=e.getElementsByTagName("a")[0],i=e.getElementsByTagName("span")[0],n=window.getComputedStyle(t,null).getPropertyValue("font");if(0!==e.offsetWidth&&0!==i.offsetWidth&&e.offsetWidth-i.offsetWidth-20<=this.getTextWidth(t.text,n)){for(var s=t.text,a=0;a<50&&this.getTextWidth(s+"...")>e.offsetWidth-i.offsetWidth-20;)s=s.slice(0,s.length-2),a++;t.setText(s+"...")}},getTextWidth:function(t,i){e.is(this.canvas)||(this.canvas=document.createElement("canvas"));var n=this.canvas.getContext("2d");return n.font=i,n.measureText(t).width},getFormattedSuggest:function(t){return this.options.suggestFormat.replace(/\{(\w+)\}/g,function(i,n){return e.is(t,"string")?t:t[n]})}})}),define("DS/SNSearchUX/SearchView",["text!DS/SNSearchUX/assets/templates/SearchView.html","DS/Handlebars/Handlebars4","UWA/Core","UWA/Event","UWA/Class/View","UWA/Class/Debug","DS/SNInfraUX/SearchUtils","DS/SNSearchUX/SearchHistoric","DS/SNInfraUX/SearchCom","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/SearchRessources","DS/SNInfraUX/SearchPreferences","DS/SNSearchUX/SearchDropDown","DS/SNSearchUX/SearchDropDown2","DS/SNSearchUX/SearchSecondaryMenu","DS/Notifications/NotificationsManagerUXMessages","DS/PubSub/PubSub","DS/MessageBus/MessageBus","DS/SNInfraUX/SessionSecurityContextServices","DS/SNSearchUX/utils/SearchViewEvents","i18n!DS/SNSearchUX/assets/nls/SNSearchUX.json"],function(e,t,i,n,s,a,r,o,c,h,l,d,u,g,p,_,S,m,f,v,C){"use strict";return s.extend(a,{name:"DS/SNSearchUX/SearchView",uwaClassName:"SearchView",id:"global_ctn_search",className:"global_ctn_search topbar-search",domEvents:{"click div.run_ctn_search":"_onSearch","click div.clear_btn_search":"_onClearSearch","keyup input.input_search":"_onSearchInputKeyUp","keydown input.input_search":"_onSearchInputKeyDown"},template:t.compile(e),autocomplete:void 0,socket:void 0,selectedSource:void 0,searchTabId:void 0,lastSearch:void 0,secondaryOptionToHide:[],betaProgramState:void 0,currentTenant:void 0,_setSource:function(e){var t=this;h.getTenantSettings(e.sources.active_tenant).then(function(){let n=h.getOption("deactivate_FUN108944");if(["iphone","ipad","android"].indexOf(r.getDeviceCategory()),!0!==n){let n=h.getOption("activate_instant_search",{tenant:e.sources.active_tenant});d.setItem("InstantSearchSCC",n),d.commit(),!0===n&&"catiav5"!==t.addinMode&&"solidworks"!==t.addinMode?(t.betaProgramState=d.getItem("InstantSearchSCC"),i.is(t.betaProgramState)||(t.betaProgramState=!0)):t.betaProgramState=!1,t.render()}i.is(t.topBarMenu)&&t.topBarMenu.initTenantOnSecondaryMenu(e)}),require(["DS/SNSearchUX/SearchUX_TopBar"],function(n){var s=n.getAddinMode();i.is(s,"string")&&(e.searchParams=e.searchParams||{},e.searchParams.enable_search_in_this_tab=!1),i.is(t.autocomplete)&&i.is(t.autocomplete._buildSearchChoice,"function")?(i.is(e.searchParams)&&i.is(t.topBarMenu)&&(t.topBarMenu._manageSecondaryMenuOptions(e.searchParams),i.is(s,"string")&&"true"===s&&t.topBarMenu._setSecondaryHiddenOptionsPermanent([C.LastSearchResults,C.PredefinedQuery])),e.betaProgramState=t.betaProgramState,t.autocomplete._buildSearchChoice(e)):i.is(t.autocomplete)&&i.is(t.autocomplete.initSources,"function")&&t.autocomplete.initSources(e)})},setup:function(e){var t=this;if("3DSwym"===r.identifyClientInfo().identifier&&(C.search_current_tab=C.search_current_page),i.is(e)&&i.is(e.model)&&i.is(e.model.previousAttributes,"function")){let t=e.model.previousAttributes();i.is(t.addinMode)&&(this.addinMode=t.addinMode,i.is(this.addinMode,"object")&&(this.addinMode=this.addinMode.value))}i.is(e)&&i.is(e.searchMenu)&&i.is(e.searchMenu.hideTenantMenu)&&(this.hideTenantMenu=!0),!0===h.getOption("forceSearchTransientAndNoTab")&&(d.setItem("search_tabbed_ui",!1),d.commit({})),this.searchViewEventsManager=new v({searchView:this}),S.add("search:closeTransient",function(){t.socket.dispatchEvent("hideAdvancedSearch"),t.autocomplete.setFieldValue(""),m.publish({channel:"GLOBAL_3DSEARCH_MESSAGE_CHANNEL_ID",topic:"datagrid_preference_force_close"}),t.socket.dispatchEvent("clearfilterbyclosesidepanel"),i.is(t.topBarMenu)&&(t.topBarMenu._setSecondaryHiddenOptions(),t.topBarMenu._inAppContext?t.topBarMenu.restoreAppContext(localOptions):t.topBarMenu.setSearchMode({noFocus:!0}),t.topBarMenu._switchSearchMode(),t.topBarMenu._clickOnSearch())}),S.add("search:setCriteria",function(e){t.autocomplete._setInternalCriteria(e),t.autocomplete.setFieldValue(e)});require(["DS/TopBar/TopBar"],function(e){void 0===e.attributes&&(e.attributes={}),e.addEvent({events:{mobileSearchAction:function(e){switch(e.action){case"enable":i.is(t.autocomplete)&&t.autocomplete.elements.input.focus()}}}})}),m.subscribe({channel:"searchView",topic:"deactivateInContextSearch",callback:function(e){i.is(t.topBarMenu)&&t.topBarMenu.restoreAppContext(e),i.is(t.autocomplete)&&(t.autocomplete.setInContextMode(!1),t.autocomplete.dispatchEvent("onUpdateSuggests",[[]]))}}),m.subscribe({channel:"searchView",topic:"deactivateInContextSearch",callback:function(e){i.is(t.topBarMenu)&&t.topBarMenu.restoreAppContext(e),i.is(t.autocomplete)&&(t.autocomplete.setInContextMode(!1),t.autocomplete.dispatchEvent("onUpdateSuggests",[[]]))}}),this.socket=c.createSocket({socket_id:"searchview_socket_id"}),this.socket.addListener("onViewSearch",function(){t._onSearch()}),this.socket.addListener("onSetSources",function(e){t._setSource(e)}),this.socket.addListener("onSetFindInApp",function(e){t.autocomplete.setFindInApp(e)}),this.socket.addListener("onSetBackSearchOrFindInTab",function(e){i.is(t.topBarMenu)&&t.topBarMenu.setSearchMode(e)}),this.socket.addListener("onSetInAppContext",function(e){i.is(t.topBarMenu)&&t.topBarMenu.setInAppContext(e)}),this.socket.addListener("openTagger",function(e){t.socket.dispatchEvent("openTagger",e)}),this.socket.addListener("setTaggerMode",function(e){t.socket.dispatchEvent("setTaggerMode",e)}),this.socket.addListener("closeTagger",function(e){t.socket.dispatchEvent("closeTagger",e)}),this.socket.addListener("onSetFocusInSearchField",function(){setTimeout(function(){i.is(t.topBarMenu)&&i.is(t.topBarMenu._secondaryMenu)&&!1===t.topBarMenu._secondaryMenu.isVisible&&t.topBarMenu._secondaryMenu.toggle(),i.is(t.autocomplete)&&!t.autocomplete.isDropDownVisible()&&t.autocomplete.elements.input.focus()},100)}),this.socket.addListener("onSelectTenant",function(e){}),this.socket.addListener("onSelectTenantAfterTabActivation",function(e){i.is(t.topBarMenu)?(t.topBarMenu.selectTenantOnTabActivation(e),t.topBarMenu._clickOnSearch()):i.is(t.autocomplete.selectTenantOnTabActivation,"function")&&t.autocomplete.selectTenantOnTabActivation(e)}),this.socket.addListener("onRefreshSearchField",function(e){if(!i.is(e))throw new Error("Invalid localOptions in onRefreshSearchField");e.searchStringToDisplayInSearchField===C.get("myContent_searchFav")&&e.internalSearchCriteria!==C.get("myContent_searchFav")?i.is(t.topBarMenu)&&t.topBarMenu._clickOnSearch({focus:!1}):e.internalSearchCriteria===r.SearchTypeEnum.MY_CONTENT?i.is(t.topBarMenu)&&t.topBarMenu._clickOnMyContent({focus:!1}):e.internalSearchCriteria===r.SearchTypeEnum.FAVORITE_SEARCH?i.is(t.topBarMenu)&&t.topBarMenu._clickOnFavoriteSearches({focus:!1}):e.internalSearchCriteria!==r.SearchTypeEnum.ADVANCED_SEARCH&&e.originalSearchCriteria!==r.SearchTypeEnum.ADVANCED_SEARCH||i.is(t.topBarMenu)&&t.topBarMenu._clickOnAdvancedSearch({focus:!1}),i.is(t.topBarMenu)&&i.is(e)&&i.is(e.isPinnedWidgetMaximized)&&!0===e.isPinnedWidgetMaximized&&t.topBarMenu._toggleDropDownMenuItem(C.search_current_tab,"show"),i.is(e,"string")?(e.length>0&&i.is(t.topBarMenu)&&t.topBarMenu._clickOnSearch(),t.autocomplete.setFieldValue(e)):i.is(e,"object")&&i.is(e.searchStringToDisplayInSearchField,"string")&&i.is(e.internalSearchCriteria,"string")&&(e.searchStringToDisplayInSearchField.length>0&&i.is(t.topBarMenu)&&t.topBarMenu.currentMode!==C.search_current_tab&&t.topBarMenu._clickOnSearch({focus:!1}),t.autocomplete.setFieldValue(e.searchStringToDisplayInSearchField),t.autocomplete._setInternalCriteria(e.internalSearchCriteria))}),this.socket.addListener("onSwitchMode",function(e){t._onSwitchMode(e)}),this._filterInProgress=!1,this.socket.addListener("clickOnChoiceSearch",function(e){i.is(t.topBarMenu)&&t.topBarMenu._clickOnSearch(e)}),this.socket.addListener("clickOnChoiceMyContent",function(e){i.is(t.topBarMenu)&&t.topBarMenu._clickOnMyContent(e)}),this.socket.addListener("clickOnChoiceAdvancedSearch",function(e){i.is(t.topBarMenu)&&t.topBarMenu._clickOnAdvancedSearch(e)}),this.socket.addListener("clickOnChoiceFavoriteSearch",function(e){i.is(t.topBarMenu)&&t.topBarMenu._clickOnFavoriteSearches(e)}),this.socket.addListener("onSetFindInTab",function(e){i.is(t.topBarMenu)&&t.topBarMenu._clickOnSearchInCurrentTab()}),this.socket.addListener("onSwitchToFindInTab",function(e){i.is(t.topBarMenu)&&t.topBarMenu._clickOnSearchInCurrentTab()}),this.socket.addListener("onSwitchToFindInApp",function(e){t.autocomplete.onSwitchToFindInApp(e)}),this.socket.addListener("hideSearchInThisTab",function(e){i.is(t.topBarMenu)&&t.topBarMenu._toggleDropDownMenuItem(C.search_current_tab,"hide")}),this.socket.addListener("showSearchInThisTab",function(e){i.is(t.topBarMenu)&&t.topBarMenu._toggleDropDownMenuItem(C.search_current_tab,"show")}),this.socket.addListener("onPQPrefixSelect",function(e){i.is(t.topBarMenu)&&t.topBarMenu.setSelectedPQPrefix(e)}),this.socket.addListener("onInContextSearch",function(e){i.is(t.topBarMenu)&&!t.topBarMenu._inAppContext?(t._prevTenant=t.topBarMenu.getCurrentTenant(),t.topBarMenu._setSecondaryHiddenOptions("inContext"),"furtive"!==e.inContextOptions.mode&&i.is(e.inContextOptions.app_socket_id,"string")&&"socket_id_#saved_search_edit#"===e.inContextOptions.app_socket_id||(t.topBarMenu.setInAppContext({isInAppContext:!0}),t.topBarMenu.setFindInContext(e.inContextOptions,e.placeholder)),i.is(e.inContextOptions.advanced_search)&&i.is(e.inContextOptions.advanced_search.showByDefault)&&!0===e.inContextOptions.advanced_search.showByDefault?t.topBarMenu._clickOnAdvancedSearch({focus:!1}):t.topBarMenu._clickOnSearch({focus:!1})):t.autocomplete._inAppContext||("furtive"===e.inContextOptions.mode||"socket_id_#saved_search_edit#"!==e.inContextOptions.app_socket_id?t.topBarMenu._setSecondaryHiddenOptions("inContext"):i.is(e.inContextOptions.advanced_search)),i.is(t.autocomplete)&&t.autocomplete.setInContextMode(!0)}),this.socket.addListener("onCloseTransient",function(e){t._onCloseTransient(e)}),this.socket.addListener("onCloseTransientTopBar",function(e){t._onCloseTransient(e)}),this.socket.addListener("onInContextSearchDeactivated",function(e){t.socket.dispatchEvent("onCloseTransient"),t.topBarMenu.restoreAppContext(e),i.is(t.restoreAppContext,"function")&&t.restoreAppContext(e)&&(t.restoreAppContext=null),t.autocomplete.setInAppContext({isInAppContext:!1})}),this.socket.addListener("Last_Tag_Filter",function(e){var n=t.autocomplete._inContextOptions;!i.is(n)&&i.is(t.topBarMenu)&&(n=t.topBarMenu._inContextOptions),n&&"socket_id_#saved_search_edit#"===n.app_socket_id||(t.last_tag_filter=e)}),this.socket.addListener("clearSearch",function(e){(t.autocomplete&&t.autocomplete.elements.input.placeholder===t.autocomplete._getPlaceHolderTextDependingOnActiveTenant("searchNew")||t.autocomplete.elements.input.placeholder===C.search_current_tab)&&t._onClearSearch(e)})},destroy:function(){this.stopListening(this.model),this._parent(),this.container=null},_onSearch:function(e){var t=this;i.is(e)&&"click"==e.type&&m.publish({channel:"SearchTrackerApi",topic:"hit",data:{category:"InstantSearch",action:"ClickOnLens",persDim:{pd1:this.autocomplete?this.autocomplete.getInputValue():""}}}),"3DSwym"===r.identifyClientInfo().identifier&&r.isMobile()&&t.container.parentElement.parentElement.toggleClassName("search-active");var n=this.autocomplete.getInputValue(),s=h.getOption("minTopBarInput");if(this.autocomplete.elements.input.placeholder===C.get("search_current_tab")&&(s=h.getOption("minTopBarInputSiCT")),i.is(n,"string")&&n.length<=s&&n.length>0){var a={level:"info",title:C.get("search-query-too-short:title"),message:C.replace(C.get("search-query-too-short:message"),{count:h.getOption("minTopBarInput")}),sticky:!1};_.addNotif(a)}else{i.is(this.autocomplete._internalSearchCriteria,"string")&&this.autocomplete._internalSearchCriteria.length>0&&(n=this.autocomplete._internalSearchCriteria),i.is(this.autocomplete.showLastSearch,"function")&&d.getItem("searchMode")!==C.search_current_tab&&this.autocomplete.showLastSearch(),i.is(this.topBarMenu)&&!this.topBarMenu._inAppContext&&this.topBarMenu.currentMode!==C.search_current_tab&&this.topBarMenu.showLastSearch(),r.setsearchType(r.SearchTypeEnum.SEARCH);var c=this.autocomplete._adv_Search_activated,l=this.autocomplete._inContextOptions;!i.is(l)&&i.is(this.topBarMenu)&&(l=this.topBarMenu._inContextOptions),i.is(n,"string")&&n.length>h.getOption("minTopBarInput")&&i.is(this.topBarMenu)&&d.getItem("searchMode")!==C.search_current_tab&&(l&&"socket_id_#saved_search_edit#"===l.app_socket_id||(this.reSearch=!0,this.reSearchQuery={value:n,searchStringToDisplayInSearchField:this.autocomplete.getInputValue()}));if(i.is(this.topBarMenu)&&d.getItem("searchMode")===C.search_current_tab)"3DSwym"===r.identifyClientInfo().identifier?this.model.dispatchEvent("search",{value:n,searchMode:r.SearchTypeEnum.SEARCH_IN}):this.topBarMenu._searchInCurrentTab(n,this.topBarMenu.searchTabId),i.is(n)&&""!==n&&o.storeValueInDataBase(n);else if(!0===this.autocomplete._myRecentContentIsActive&&""===n&&!0!==this.reSearch)r.setsearchType(r.SearchTypeEnum.MY_RECENT_CONTENT),this.socket.dispatchEvent("myRecentContent",{value:r.SearchTypeEnum.MY_RECENT_CONTENT,adv_search:!1,sFilter:"*"});else if(""===n)this.autocomplete._inAppContext&&!1===this.autocomplete._temporarilyOutOfContext&&null!==l?g():this.autocomplete.elements.input.placeholder===this.autocomplete._getPlaceHolderTextDependingOnActiveTenant("mycontent")?(r.setsearchType(r.SearchTypeEnum.MY_CONTENT),this.socket.dispatchEvent("myContent",{value:r.SearchTypeEnum.MY_CONTENT,adv_search:!1})):this.autocomplete.elements.input.placeholder===this.autocomplete._getPlaceHolderTextDependingOnActiveTenant("MySavedSearches")?(r.setsearchType(r.SearchTypeEnum.FAVORITE_SEARCH),this.socket.dispatchEvent("myContent",{value:r.SearchTypeEnum.FAVORITE_SEARCH,adv_search:!1})):this.autocomplete.elements.input.placeholder===this.autocomplete._getPlaceHolderTextDependingOnActiveTenant("searchNew")&&this.reSearch?(this.socket.dispatchEvent("search",{value:this.reSearchQuery.value,adv_search:c,refine:this.last_tag_filter,source:[],reSearch:!0,internalSearchCriteria:this.autocomplete._internalSearchCriteria,searchStringToDisplayInSearchField:this.reSearchQuery.searchStringToDisplayInSearchField,fromEmptyString:!0}),t.autocomplete.setFieldValue(this.reSearchQuery.searchStringToDisplayInSearchField)):this.autocomplete.elements.input.placeholder===this.autocomplete._getPlaceHolderTextDependingOnActiveTenant("adv_search")?(r.setsearchType(r.SearchTypeEnum.ADVANCED_SEARCH),this.socket.dispatchEvent("advancedSearch",{value:r.SearchTypeEnum.ADVANCED_SEARCH,adv_search:!0,source:[],adv_search_field:e}),t.autocomplete._AdvancedSearchField=null):(this._filterInProgress=!1,this.autocomplete._hideClearSearchBtn(),this.socket.dispatchEvent("clearSearch"),i.is(this.autocomplete.hideLastSearch,"function")&&this.autocomplete.hideLastSearch(),i.is(this.autocomplete)&&i.is(this.autocomplete.elements)&&i.is(this.autocomplete.elements.input)&&this.autocomplete.elements.input.placeholder===this.autocomplete._findInTabNLS&&this.model.hasEvent("search")&&(r.setsearchType(r.SearchTypeEnum.SEARCH_IN),this.model.dispatchEvent("search",{value:n,searchMode:r.SearchTypeEnum.SEARCH_IN})));else if(this._filterInProgress=!0,this.autocomplete._inAppContext&&!1===this.autocomplete._temporarilyOutOfContext&&null!==l)i.is(t.autocomplete.getInputValue())&&o.storeValueInDataBase(t.autocomplete.getInputValue()),g();else if(i.is(this.autocomplete)&&i.is(this.autocomplete.elements)&&i.is(this.autocomplete.elements.input)&&this.autocomplete.elements.input.placeholder===this.autocomplete._findInTabNLS)this.model.hasEvent("search")&&(r.setsearchType(r.SearchTypeEnum.SEARCH_IN),this.model.dispatchEvent("search",{value:this.autocomplete.getInputValue(),searchMode:r.SearchTypeEnum.SEARCH_IN}));else{function u(){r.executeWithPQ({wait:function(){if(n.indexOf(":")>0)return t.socket.dispatchEvent("fetchPQsFromServer"),!0},run:function(){require(["DS/SNResultUX/utils/WildcardMgr"],function(e){r.setsearchType(r.SearchTypeEnum.SEARCH),i.is(t.topBarMenu)&&!t.topBarMenu._inAppContext&&t.topBarMenu._setSecondaryHiddenOptions(C.searchNew),n=e.manageWildcardAddtion(n),n=r.replacePQsWithCVPrefixes(n),i.is(t.reSearchQuery)&&(t.reSearchQuery.value=n),t.socket.dispatchEvent("search",{value:n,adv_search:c,internalSearchCriteria:i.is(t.autocomplete)?t.autocomplete._internalSearchCriteria:null,searchStringToDisplayInSearchField:i.is(t.autocomplete)?t.autocomplete.getInputValue():null})})}})}!0===this.autocomplete._myRecentContentIsActive&&i.is(this.topBarMenu)&&this.topBarMenu._clickOnSearch(),n===t.autocomplete.getInputValue()&&o.storeValueInDataBase(n),r.getActiveTenant()===t.selectedTenant?u():(t.selectedTenant=r.getActiveTenant(),f.getSecurityContext3DSpace(t.selectedTenant).then(function(e){u()},function(){u()}))}}function g(){r.executeWithPQ({wait:function(){if(t.autocomplete.getInputValue().indexOf(":")>0)return t.socket.dispatchEvent("fetchPQsFromServer"),!0},run:function(){require(["DS/SNResultUX/utils/WildcardMgr"],function(e){var n={inCtx_widget_id:l.widget_id},s=t.autocomplete.getInputValue();s=e.manageWildcardAddtion(s,{addWildCard_inCtx:l.addWildCard}),n.value=r.replacePQsWithCVPrefixes(s),n.searchStringToDisplayInSearchField=t.autocomplete.getInputValue(),i.is(l.precond)&&l.precond.trim().length>0&&(i.is(n.value)&&n.value.trim().length>0&&"*"!==n.value?(n.internalSearchCriteria="("+n.value+") AND ("+l.precond+")",n.value="("+n.value+") AND ("+l.precond+")"):(n.internalSearchCriteria=l.precond,n.value=l.precond),n.displayValue=t.autocomplete.getInputValue()),n.adv_search=c,n.source=l.source,i.is(n.source)||(n.source=[]),t.socket.dispatchEvent("search",n)})}})}},_onClearSearch:function(e){this.autocomplete._setInternalCriteria(null),this.autocomplete.setFieldValue(""),this.reSearch=!1,!0===this.betaProgramState&&this.autocomplete._clearDropDown(),i.is(this.autocomplete)&&i.is(this.autocomplete.elements)&&i.is(this.autocomplete.elements.input)&&this.autocomplete.elements.input.placeholder===this.autocomplete._findInTabNLS?this.model.hasEvent("clearSearch")&&this.model.dispatchEvent("clearSearch"):i.is(this.topBarMenu)&&d.getItem("searchMode")===C.search_current_tab&&("3DSwym"===r.identifyClientInfo().identifier?this.model.dispatchEvent("clearSearch"):(S.dispatch("SearchQuery",[""]),S.dispatch("Search:updateSearchCriteria",[""]))),this.reSearch=!0},_onCloseTransient:function(e){i.is(this.topBarMenu)&&(this._prevTenant&&this._prevTenant.tenantId&&this.topBarMenu.setCurrentTenant(this._prevTenant.tenantId),this.topBarMenu._switchSearchMode(),this.topBarMenu._clickOnSearch(),this.topBarMenu._setSecondaryHiddenOptions(),this.topBarMenu._inAppContext?this.topBarMenu.restoreAppContext(e):this.topBarMenu.setSearchMode({noFocus:!0})),this.autocomplete.setFieldValue(""),this.autocomplete.elements.input.readOnly=!1},_onSwitchMode:function(e){e&&r.SearchTypeEnum.MY_RECENT_CONTENT===e.new_mode&&i.is(this.topBarMenu)&&this.topBarMenu._clickOnMyRecentContent(e)},_onSearchInputKeyUp:function(e){this.autocomplete.getInputValue()?this.autocomplete._showClearSearchBtn():this._filterInProgress||this.autocomplete._hideClearSearchBtn(),n.stopPropagation(e)},_onSearchInputKeyDown:function(e){"return"===n.whichKey(e)&&this._onSearch(),n.stopPropagation(e)},_storeValueInLocalStorage:function(e){if(!i.is(e,"string"))throw new Error("null value given to SearchView._storeValueInLocalStorage!");if(!(e.trim().length<=0)){var t=[];if(i.is(localStorage.SNSearchBoxStore))if(-1===(t=JSON.parse(localStorage.SNSearchBoxStore)).indexOf(e))t.length>=100&&t.shift(),t.push(e),localStorage.SNSearchBoxStore=JSON.stringify(t);else{var n=t.indexOf(e),s=t[n];t.splice(n,1),t.push(s),localStorage.SNSearchBoxStore=JSON.stringify(t)}else t.push(e),localStorage.SNSearchBoxStore=JSON.stringify(t)}},_setTopbarTooltips:function(){this.container.getElement(".clear_ctn_search").title=C.get("clear.tooltip"),this.container.getElement(".run_ctn_search").title=C.get("search.tooltip");var e=this.container.getElement(".option_ctn_search");i.is(e)&&(e.title=C.get("secondaryMenu.tooltip"))},render:function(){var e,t=this;e=this.template(this.model.toJSON()),this.container.setContent(e);var n=this.container.getElement("#input_search_div");n.addClassName("searchProto");var s=this.container.getElement(".right_search"),a=i.createElement("div",{class:"option_ctn_search ctn_search"}).inject(s);if(!0===h.getOption("FUN124298"))this.autocomplete=new g({eventManager:t.socket}).inject(n);else{this.autocomplete=new u({suggestUrl:"tempo_deactivated?query={text}",placeholder:C.searchNew,typeDelay:500,minLength:1,suggestFormat:"{label}",dataParser:function(e){return e.suggest},className:"sn-search-field uwa-autocomplete nv-autocomplete",isBetaOn:t.betaProgramState,events:{openTagger:function(){t.socket.dispatchEvent("openTagger")},setSourceDashboard:function(){t.socket.dispatchEvent("setSelectedSource",{value:"3DDashboard"}),t.selectedSource="3DDashboard"},setSourceCStorage:function(e){t.socket.dispatchEvent("setSelectedSource",{value:e}),t.selectedSource=e,t.betaProgramState,d.setItem("defaultTenantId",e),d.commit()},onSelect:function(e,n){"LastSearch"!==n&&t.socket.dispatchEvent("topBar-LastSearch-clearLocalFilter"),i.is(t.autocomplete._isTypeListMode)&&!0===t.autocomplete._isTypeListMode&&(t.autocomplete._isTypeValue=e);var s=!1;if(i.is(arguments[2])&&"AdvSearch"===arguments[2]&&(s=!0),t.autocomplete._searchStringToDisplayInSearchField=e,i.is(t.autocomplete.elements)&&i.is(t.autocomplete.elements.input)&&i.is(t.autocomplete.getInputValue())&&t.autocomplete.getInputValue()!==e&&(t.autocomplete._searchStringToDisplayInSearchField=null,t.autocomplete._setInternalCriteria(null)),null!==t.autocomplete.getInputValue()&&!0!==s||(t.autocomplete._AdvancedSearchField=e),!1===s){if(i.is(t.topBarMenu)&&t.topBarMenu.currentMode!==C.search_current_tab){var a={hiddenOptions:[C.search_current_tab]};t.topBarMenu._clickOnSearch(a),t.topBarMenu._clickOnSearch()}t._onSearch(t.autocomplete._AdvancedSearchField)}i.is(this._value)&&this._value.length>h.getOption("minTopBarInput")&&(t.autocomplete.elements.input.value=e),t.socket.dispatchEvent("onHideSuggests"),i.is(this._value)&&this._value.length>h.getOption("minTopBarInput")&&(!i.is(n,"object")||!0===n.storeSearch)&&o.storeValueInDataBase(e)},onSearch:function(e){t._onSearch(),i.is(t.autocomplete._isTypeListMode)&&!0===t.autocomplete._isTypeListMode&&o.storeValueInDataBase(e)},myContent:function(){t.socket.dispatchEvent("myContent",{value:r.SearchTypeEnum.MY_CONTENT,adv_search:!1})},favoriteSearches:function(){t.socket.dispatchEvent("favoriteSearches",{value:r.SearchTypeEnum.FAVORITE_SEARCH,adv_search:!1})},myRecentContent:function(e){var n={value:r.SearchTypeEnum.MY_RECENT_CONTENT,adv_search:!1};i.is(e)&&i.is(e.sFilter,"string")&&0<e.sFilter.length?n.sFilter=e.sFilter:n.sFilter="*",i.is(e)&&i.is(e.widgetId,"string")&&0<e.widgetId.length&&(n.widgetId=e.widgetId),t.socket.dispatchEvent("myRecentContent",n)},hideAdvancedSearch:function(){t.socket.dispatchEvent("hideAdvancedSearch",{})},showAdvancedSearch:function(){t.socket.dispatchEvent("showAdvancedSearch",{})},advancedSearch:function(e){t.socket.dispatchEvent("advancedSearch",{value:r.SearchTypeEnum.ADVANCED_SEARCH,adv_search:!0,adv_search_field:e}),t.socket.dispatchEvent("showAdvancedSearch",{adv_search_field:e},["searchtopbar_socket_id"])},storeSuggestion:function(e){o.storeValueInDataBase(e)},showPQListUX:function(){t.socket.dispatchEvent("onShowPQListUX")}}}).inject(n);var c=i.createElement("div",{class:"option_btn_search fonticon fonticon-down-open",id:"searchFieldDropdown","data-rec-id":"option_ctn_search"}).inject(a);this.topBarMenu=new p({target:c,autocomplete:this.autocomplete,socket:this.socket,secondaryMenuOptions:l})}var l={hideTenantMenu:this.hideTenantMenu};return this._setTopbarTooltips(),r.setSearchViewRendered(),this}})});