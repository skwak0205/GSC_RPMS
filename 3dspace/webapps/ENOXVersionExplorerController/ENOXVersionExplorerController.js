define("DS/ENOXVersionExplorerController/CreateNewVersionController",["UWA/Core","UWA/Controls/Abstract","DS/ENOXVersionExplorerViews/NewVersionDialog","DS/ENOXVersionExplorerViews/NewRevisionDialog","DS/ENOXVersionExplorerModelManager/ModelManagerBase","DS/ENOXVersionExplorerModel/VersionTreeDocumentModel","DS/LifecycleCmd/MessageMediator","DS/ENOXVersionExplorerUtils/VersionExplorerEnums","UWA/Promise","DS/ENOXVersionExplorerModelManager/ModelManagerP","DS/ENOXVersionExplorerModelManager/ModelManagerHistory2","DS/ENOXVersionExplorerModelManager/ModelManagerRDF","DS/ENOXVersionExplorerUtils/ENOXVersionExplorerUtils"],function(e,t,n,i,o,r,s,a,d,l,p,u,c){"use strict";return t.extend({init:function(t){t=t||{};var E=this,f=void 0,h=void 0;E=this;function _(e,t){if("string"==typeof t&&t.length&&e!==a.DATA_MODEL_TYPES.MODEL_HISTORY&&(e=a.DATA_MODEL_TYPES[t.contains(":")?"MODEL_RDF":"MODEL_REVISION"]),e&&f._DATA_MODEL_TYPE!==e){switch(f._DATA_MODEL_TYPE=e,f._DATA_MODEL_TYPE){case a.DATA_MODEL_TYPES.MODEL_RDF:h=u;break;case a.DATA_MODEL_TYPES.MODEL_HISTORY:h=p;break;default:h=l}f.setManager(h)}}function v(e){E.dispatchEvent("ENOXVersionExplorerError",e)}function x(e){f.createNewVersionPromise({parentid:e.parent.options.id,title:e.title,description:e.description,versionSemantic:e.versionSemantic,nextRevision:e.parent.nextRevision,itemID:f.itemID,loadThumbnail:!1}).then(function(e){s.dispatchEvent("_ENOXVersionExplorerNewVersionCreated",e),E.dispatchEvent("ENOXVersionExplorerNewVersionCreated",e)},v)}t=e.extend({newVersionDialogContainer:null},t),this._parent(t),f=new(r.implement(o));var D=e.Class.extend({showDialog:function(e){if("string"!=typeof e.parentID||!e.parentID.length)throw Error("CreateNewVersionController:showDialog: parentPhysical ID cannot be null");_(e.dataModelType,e.type),f.loadVersionModelPromise({id:e.parentID,loadThumbnail:!1,tenantId:e.tenantId,securityContext:e.securityContext}).then(function(){var o=f.searchByID(e.parentID);if(o.length>1)throw Error("CreateNewVersionController:showDialog: more than one node with same ID");if(!o.length)throw Error("CreateNewVersionController:showDialog: Parent ID not found");f._DATA_MODEL_TYPE===a.DATA_MODEL_TYPES.MODEL_REVISION?function(e){var n=e.parentTreeNode;if(!n)throw Error("CreateNewVersionController:_displayNewRevisionDialog parent tree node is null");i.displayDialog({defaultName:n.options.grid.title,derivedFrom:{id:n.options.id,name:n.options.grid.title+" "+n.options.grid.code},nextRevision:c.getNextRevision(n.options.grid.code.split(".")[0])+".1",parentContainer:t.newVersionDialogContainer,onOK:function(e,t){x({title:e,description:t,parent:n,versionSemantic:"E"})}})}({parentTreeNode:o[0]}):function(e){var i=e.parentTreeNode;if(!i)throw Error("CreateNewVersionController:_displayNewversionDialog parent tree node is null");n.displayDialog({dataModelType:f._DATA_MODEL_TYPE,defaultName:f.getNewVersionName(),derivedFrom:{id:i.options.id,name:i.options.grid.title},parentContainer:t.newVersionDialogContainer,onOK:function(e,t,n){x({title:e,description:t,parent:i,nextRevision:c.getNextRevision(i.options.grid.code.split(".")[0])+".1",versionSemantic:n})}})}({parentTreeNode:o[0]})},v)},canNewVersionBeCreatedPromise:function(e){if("string"!=typeof e.parentID||!e.parentID.length)throw Error("CreateNewVersionController:canNewVersionBeCreatedPromise: parentPhysical ID cannot be null");return _(e.dataModelType,e.type),new d(function(t,n){f.loadVersionModelPromise({id:e.parentID,loadThumbnail:!1,tenantId:e.tenantId,securityContext:e.securityContext}).then(function(){var n=f.searchByID(e.parentID);if(n.length>1)throw Error("CreateNewVersionController:showDialog: more than one node with same ID");if(!n.length)throw Error("CreateNewVersionController:showDialog: Parent ID not found");t(n[0].isLeaf())},n)})}});e.Class.implement.call(this,D)}})}),define("DS/ENOXVersionExplorerController/VersionExplorerEventList",["UWA/Core","DS/ENOXVersionExplorerUtils/VersionExplorerEnums","DS/ENOXVersionExplorerUtils/VersionExplorerSettings","DS/ENOXVersionExplorerModel/VersionTreeNodeModel","DS/ENOXVersionExplorerViews/NodeDropdownMenu","DS/WebappsUtils/WebappsUtils","DS/LifecycleCmd/CommandAPI","DS/LifecycleServices/LifecycleCommandManager","i18n!DS/ENOXVersionExplorerController/assets/nls/NodeDropdownMenuNLS","css!DS/ENOXVersionExplorerController/styles/VersionExplorerEventList"],function(e,t,n,i,o,r,s,a,d,l){"use strict";var p=function(e,t){return"url("+r.getWebappsBaseUrl()+(t||"RevisionFamily")+"/assets/icons/32/"+e+")"};return function(r,l){function u(t){var n,o,r,s;t instanceof i?(o=t,n={position:{x:0,y:0},selectedNodes:[]}):o=(n=t.menuctx).treeNode,void 0!==o.options&&void 0!==o.options.label&&void 0!==o.options.label&&(s=e.String.unescapeHTML(o.options.label));var a=o.options.data.type;void 0!==a&&0!=a.length||(a=o.options.grid.type);var d=o.options.grid&&o.options.grid.contents&&o.options.grid.contents.length>0?o.options.grid.contents[0].id:o.options.id;return r={physicalid:d,id:d,displayName:s,revision:o.options.grid.code,type:a,pos:[n.position.x,n.position.y],selectedNodes:n.selectedNodes,name:s},t.menuctx=void 0,r}this._eventList=[{id:"ENOXVersionExplorerSetActiveVersion",subscribed:!0,published:!1,externalsub:!0,externalpub:!1,subfn:function(e){var t=e.data||e,n={};t instanceof i?n.treeNode=t:n.id=t&&"string"==typeof t.id?t.id:"string"==typeof t?t:void 0,n.treeNode||n.id||(n.id=this._activeVersion||this._currentVersion),n.id&&this._setActiveVersion(n)}},{id:"ENOXVersionExplorerLoadVersionModel",subscribed:!0,externalsub:!0,onComplete:!0,subfn:function(t){var n=this,i=t&&(t.data||t)||{};if(!("string"==typeof i.id&&i.id.length||"object"==typeof i.id&&null!==i.id))throw Error("ENOXVersionExplorerLoadVersionModel:id <physicalid> cannot be null");var o=i&&"function"==typeof i.onComplete?function(e){i.onComplete(e),n.publishEvent("ENOXVersionExplorerLoadCompleted",e)}:function(e){n.publishEvent("ENOXVersionExplorerLoadCompleted",e)};n._loadVersionModel(e.merge({reframe:!0,onComplete:o},i))}},{id:"ENOXVersionExplorerLoadCompleted",published:!0,externalpub:!0,subscribed:!0,subfn:function(e){null==this.commandManager&&(this.commandManager=new a,this.commandManager.addEvent("onCompleteGetOptions",function(e){for(var t=!1,n=0;n<e.options.length;++n){var i=e.options[n];if(i.hasOwnProperty("newRevisionFromOldRevisionAllowed")){this._REVISION_FROM_NON_LEAF_ALLOWED=i.newRevisionFromOldRevisionAllowed,t=!0;break}}!1===t&&(this._REVISION_FROM_NON_LEAF_ALLOWED=!0)},this));try{var t={data:[{physicalid:e.id}],command:"revise"};void 0===this.tenant&&void 0!==e&&(this.tenant=e.tenantId),this.commandManager.setTenant(this.tenant),this.commandManager.getOptions(t,function(e){},this._context)}finally{}}},{id:"ENOXVersionExplorerRefresh",subscribed:!0,published:!1,externalsub:!0,externalpub:!1,onComplete:!0,subfn:function(t){var n=this,i=t&&(t.data||t)||{};if(i.id=i.id||n._currentVersion,i.tenantId=i.tenantId||n._tenantId,i.context=i.context||n._context,i.type=i.type||n._type,i.dataModelType=i.dataModelType||r._DATA_MODEL_TYPE,"portfolio"===i.applicationName&&!0===i.forcereload&&(r.itemID=null),!("string"==typeof i.id&&i.id.length||"object"==typeof i.id&&null!==i.id))throw Error("ENOXVersionExplorerRefresh:id <physicalid> cannot be null");var o=i&&"function"==typeof i.onComplete?function(e){i.onComplete(e),n.publishEvent("ENOXVersionExplorerLoadCompleted",e)}:function(e){n.publishEvent("ENOXVersionExplorerLoadCompleted",e)};n._loadVersionModel(e.merge({reframe:!0,onComplete:o},i))}},{id:"ENOXVersionExplorerThumbnailGraphLayoutChanged",published:!0,externalsub:!1,externalpub:!0},{id:"ENOXVersionExplorerOpenVersion",externalpub:!0,published:!0},{id:"preENOXVersionExplorerNewRevisionFrom",published:!0,externalpub:!0,onCompleteEvent:"preEventCompletedENOXVersionExplorerNewRevisionFrom",subfn:function(e){this.publishEvent("preEventCompletedENOXVersionExplorerNewRevisionFrom",e)},allowPreventDefault:!0},{id:"preEventCompletedENOXVersionExplorerNewRevisionFrom",subscribed:!0,externalsub:!1,subfn:function(e){var n=e.data||e;if(r._DATA_MODEL_TYPE===t.DATA_MODEL_TYPES.MODEL_RDF){var o={};n instanceof i?o.treeNode=n:o.id=n&&"string"==typeof n.id?n.id:"string"==typeof n?n:void 0,this._displayNewRevisionDialog(o)}else s.runCommand("ReviseFromHdr",[u(n)],this._widget,this._context)}},{id:"preENOXVersionExplorerCompareToSelected",published:!0,externalpub:!0,onCompleteEvent:"preEventCompletedENOXVersionExplorerCompareToSelected",subfn:function(e){this.publishEvent("preEventCompletedENOXVersionExplorerCompareToSelected",e)},allowPreventDefault:!0},{id:"preENOXVersionExplorerCompareWithBranchOrigin",published:!0,externalpub:!0,onCompleteEvent:"preEventCompletedENOXVersionExplorerCompareWithBranchOrigin",subfn:function(e){this.publishEvent("preEventCompletedENOXVersionExplorerCompareWithBranchOrigin",e)},allowPreventDefault:!0},{id:"preEventCompletedENOXVersionExplorerCompareToSelected",subscribed:!0,externalsub:!1,subfn:function(e){for(var t,n,i,o,r,s=e.data||e,a=s.options.data.id,d=s.options.data.contextId,l=s.options.data.serviceId,p=s.options.data.type,u=s.options.data.displayName,c=this.getSelectedNodes(),E=0;E<c.length;E++){var f=c[E];if(f._options.id!==a){t=f._options.id,n=f._options.data.contextId,i=f._options.data.serviceId,o=f._options.data.type,r=f._options.data.displayName;break}}this._showCompare({id:a,contextId:d,serviceId:l,objectType:p,displayName:u},{id:t,contextId:n,serviceId:i,objectType:o,displayName:r})}},{id:"preEventCompletedENOXVersionExplorerCompareWithBranchOrigin",subscribed:!0,externalsub:!1,subfn:function(e){var t,n,i,o,r=e.data||e,s=r.options.data.id,a=r.options.data.contextId,d=r.options.data.serviceId,l=r.options.data.type,p=r.options.data.displayName;if(e.options&&e.options.ancestors){var u=e.options.ancestors.find(function(e){return"PS"===e.semantic.toUpperCase()});if(!u&&e.__BRANCH__&&e.__BRANCH__.nodeList[0].options.ancestors&&(u=e.__BRANCH__.nodeList[0].options.ancestors.find(function(e){return"PS"===e.semantic.toUpperCase()})),u){t=u.id,n=a,i=d,o=l;var c=this.getFilter({id:s,contextId:a,serviceId:d,objectType:l,displayName:p}),E=void 0;if(c&&c.CVQuery&&c.CVQuery.union&&c.CVQuery.union.expand&&1==c.CVQuery.union.expand.length&&c.CVQuery.union.expand[0].root_path_physicalid&&1==c.CVQuery.union.expand[0].root_path_physicalid.length){if(c.CVQuery.union.expand[0].find_path_filter)for(;c.CVQuery.union.expand[0].find_path_filter[0].path_physicalid[0].length>0&&c.CVQuery.union.expand[0].find_path_filter[0].path_physicalid[0][0]!==t;)c.CVQuery.union.expand[0].find_path_filter[0].path_physicalid[0].shift();(E=c.CVQuery.union.expand[0].root_path_physicalid[0][0])==t&&(E=void 0),c.CVQuery.union.expand[0].root_path_physicalid[0].length=0,c.CVQuery.union.expand[0].root_path_physicalid[0].push(t)}if(c&&c.CVQuery3D&&c.CVQuery3D.union&&c.CVQuery3D.union.expand3d&&1==c.CVQuery3D.union.expand3d.length&&c.CVQuery3D.union.expand3d[0].root_path_physicalid&&1==c.CVQuery3D.union.expand3d[0].root_path_physicalid.length){if(c.CVQuery3D.union.expand3d[0].find_path_filter)for(;c.CVQuery3D.union.expand3d[0].find_path_filter[0].path_physicalid[0].length>0&&c.CVQuery3D.union.expand3d[0].find_path_filter[0].path_physicalid[0][0]!==t;)c.CVQuery3D.union.expand3d[0].find_path_filter[0].path_physicalid[0].shift();E||(E=c.CVQuery3D.union.expand3d[0].root_path_physicalid[0][0])==t&&(E=void 0),c.CVQuery3D.union.expand3d[0].root_path_physicalid[0].length=0,c.CVQuery3D.union.expand3d[0].root_path_physicalid[0].push(t)}if(E){var f=JSON.stringify(c);f=f.replaceAll(E,t),c=JSON.parse(f)}this._showCompare({id:s,contextId:a,serviceId:d,objectType:l,displayName:p,filter:void 0},{id:t,contextId:n,serviceId:i,objectType:o,displayName:void 0,filter:c})}}}},{id:"preENOXVersionExplorerWhereUsed",published:!0,externalpub:!0,onCompleteEvent:"preEventCompletedENOXVersionExplorerWhereUse",subfn:function(e){this.publishEvent("preEventCompletedENOXVersionExplorerWhereUse",e)},allowPreventDefault:!0},{id:"preEventCompletedENOXVersionExplorerWhereUse",subscribed:!0,externalsub:!1,subfn:function(e){var t=e.data||e,n=t.options.data.id,i=t.options.data.type,o=t.options.data.displayName;this._showWhereUsed({id:n,type:i,displayName:o})}},{id:"preENOXVersionExplorerCreateNewVersion",published:!0,externalpub:!0,onCompleteEvent:"preEventCompletedENOXVersionExplorerCreateNewVersion",subfn:function(e){this.publishEvent("preEventCompletedENOXVersionExplorerCreateNewVersion",e)},allowPreventDefault:!0},{id:"preEventCompletedENOXVersionExplorerCreateNewVersion",subscribed:!0,externalsub:!1,subfn:function(e){var n=e.data||e;if(r._DATA_MODEL_TYPE===t.DATA_MODEL_TYPES.MODEL_RDF){var o={};n instanceof i?o.treeNode=n:o.id=n&&"string"==typeof n.id?n.id:"string"==typeof n?n:void 0,this._displayNewRevisionDialog(o)}else s.runCommand("RevisionHdr",[u(n)],this._widget,this._context)}},{id:"ENOXVersionExplorerNewVersionCreated",published:!0,externalpub:!0,subscribed:!0,subfn:function(e){var n=e.data||e;if(l._getActiveView()===t.DISPLAY_MODES.THUMBNAIL_VIEW&&l._thumbnailGraphView){var i=[];i.push(n),n.getParent()&&i.push(n.getParent()),l._thumbnailGraphView.reframeOn(i)}}},{id:"preENOXVersionExplorerCreateNewBranch",published:!0,externalpub:!0,onCompleteEvent:"preEventCompletedENOXVersionExplorerCreateNewBranch",subfn:function(e){this.publishEvent("preEventCompletedENOXVersionExplorerCreateNewBranch",e)},allowPreventDefault:!0},{id:"preEventCompletedENOXVersionExplorerCreateNewBranch",subscribed:!0,externalsub:!1,subfn:function(e){var n=e.data||e;if(r._DATA_MODEL_TYPE===t.DATA_MODEL_TYPES.MODEL_RDF){var o={};n instanceof i?o.treeNode=n:o.id=n&&"string"==typeof n.id?n.id:"string"==typeof n?n:void 0,this._displayNewVersionDialog(o)}else s.runCommand("NewBranchHdr",[u(n)],this._widget,this._context)}},{id:"preENOXVersionExplorerCreateDuplicate",published:!0,externalpub:!0,onCompleteEvent:"preEventCompletedENOXVersionExplorerCreateDuplicate",subfn:function(e){this.publishEvent("preEventCompletedENOXVersionExplorerCreateDuplicate",e)},allowPreventDefault:!0},{id:"preEventCompletedENOXVersionExplorerCreateDuplicate",subscribed:!0,externalsub:!1,subfn:function(e){var n=e.data||e;if(r._DATA_MODEL_TYPE===t.DATA_MODEL_TYPES.MODEL_RDF){var o={};n instanceof i?o.treeNode=n:o.id=n&&"string"==typeof n.id?n.id:"string"==typeof n?n:void 0,this._displayNewVersionDialog(o)}else s.runCommand("DuplicateHdr",[u(n)],this._widget,this._context)}},{id:"preENOXVersionExplorerDeleteVersion",published:!0,externalpub:!0,onCompleteEvent:"preEventCompletedENOXVersionExplorerDeleteVersion",subfn:function(e){this.publishEvent("preEventCompletedENOXVersionExplorerDeleteVersion",e)},allowPreventDefault:!0},{id:"preEventCompletedENOXVersionExplorerDeleteVersion",subscribed:!0,externalsub:!1,subfn:function(e){var t=e.data||e;s.runCommand("DeleteHdr",[u(t)],this._widget,this._context)}},{id:"ENOXVersionExplorerVersionDeleteCompleted",published:!0,externalpub:!0},{id:"preEventENOXVersionExplorerShowMaturity",published:!0,externalpub:!0,onCompleteEvent:"preEventCompletedENOXVersionExplorerShowMaturity",subfn:function(e){this.publishEvent("preEventCompletedENOXVersionExplorerShowMaturity",e)},allowPreventDefault:!0},{id:"preEventENOXVersionExplorerOpenWith",published:!0,externalpub:!0,onCompleteEvent:"preEventCompletedENOXVersionExplorerOpenWith",subfn:function(e){this.publishEvent("preEventCompletedENOXVersionExplorerOpenWith",e)},allowPreventDefault:!0},{id:"preEventCompletedENOXVersionExplorerShowMaturity",published:!0,externalpub:!0,subscribed:!0,externalsub:!1,allowPreventDefault:!0,subfn:function(e){var t=e.data||e;s.runCommand("MaturityHdr",[u(t)],this._widget,this._context)}},{id:"ENOXVersionExplorerDoubleClickVersion",published:!0,externalpub:!0},{id:"ENOXVersionExplorerError",published:!0,externalpub:!0},{id:"ENOXVersionExplorerCompare",published:!0,externalpub:!0,subscribed:!1,externalsub:!1},{id:"select",published:!0,externalpub:!0,subscribed:!0,subfn:function(e){void 0!==l._highlightParents&&l._highlightParents(e.data.nodeModel)},externalsub:!0,noPubFn:!0},{id:"unselect",published:!0,externalpub:!0,subscribed:!0,subfn:function(e){void 0!==l._unhighlightParents&&l._unhighlightParents(e.data.nodeModel)},externalsub:!0,noPubFn:!0},{id:"ENOXVersionExplorerVersionModified",published:!0,externalpub:!0},{id:"ENOXVersionExplorerVersionOwnerChanged",published:!0,externalpub:!0},{id:"ENOXVersionExplorerDisplayProperties",published:!0,externalpub:!0,subscribed:!0,externalsub:!1,allowPreventDefault:!0,subfn:function(e){var t=e.data||e;s.runCommand("Properties",[u(t)],this._widget,this._context)}},{id:"ENOXVersionExplorerModalOK",published:!0,externalpub:!0},{id:"ENOXVersionExplorerModalCancel",published:!0,externalpub:!0},{id:"ENOXVersionExplorerDropdownMenu",published:!0,externalpub:!1,subscribed:!0,externalsub:!1,subfn:function(e){var t=e.data||e,n=this;if(n._isWebInWinMode()){var i=t.treeNode.options.grid.type,r=t.treeNode.options.grid.name,s=t.treeNode.options.grid.code,a=t.treeNode.options.grid.id;n._getWebInWinSocket().contextCallback=function(e){n._getNodeDropdownMenuListPromise(t.treeNode).then(function(e){t.menuList=e,o.displayNodeDropdownMenu.bind(n)(t)})},n._fetchNativeContextMenu(a,i,r,s)}else n._getNodeDropdownMenuListPromise(t.treeNode).then(function(e){t.menuList=e,o.displayNodeDropdownMenu.bind(n)(t)})},allowPreventDefault:!0},{id:"ENOXVersionExplorerOnDrag",published:!0,externalpub:!1,subscribed:!0,externalsub:!1,subfn:function(e){var t=e.data||e,n=this;n._getNodeDropdownMenuListPromise(t.treeNode).then(function(e){t.menuList=e,o.displayNodeDropdownMenu.bind(n)(t)})},allowPreventDefault:!0},{id:"ENOXVersionExplorerOnDrop",published:!0,externalpub:!1,subscribed:!0,externalsub:!1,subfn:function(e){var t=e.data||e,n=this;n._getNodeDropdownMenuListPromise(t.treeNode).then(function(e){t.menuList=e,o.displayNodeDropdownMenu.bind(n)(t)})},allowPreventDefault:!0},{id:"_ENOXVersionExplorerInternalRefresh",published:!0,subscribed:!0,externalpub:!1,externalsub:!1,subfn:function(t){var n=this;if(!("string"==typeof n._currentVersion&&n._currentVersion.length||"object"==typeof n._currentVersion&&null!==n._currentVersion))throw Error("_ENOXVersionExplorerInternalRefresh: _versionExplorerController._currentVersion is not defined");n._loadVersionModel(e.extend({id:n._currentVersion,tenantId:n._tenantId,securityContext:n._securityContext,context:n._context,type:n._type,dataModelType:r._DATA_MODEL_TYPE,onComplete:function(e){n.publishEvent("_ENOXVersionExplorerInternalRefreshCompleted",e)}},t))}},{id:"_ENOXVersionExplorerLaunchFilterSpecification",published:!0,externalpub:!0,subscribed:!0,externalsub:!1,allowPreventDefault:!0,subfn:function(e){e.data}},{id:"_ENOXVersionExplorerInternalRefreshCompleted",published:!0,externalpub:!1,subscribed:!0,externalsub:!1},{id:"_ENOXVersionExplorerSelectionModeChanged",published:!0,externalpub:!1,subscribed:!0,externalsub:!1},{id:"_ENOXVersionExplorerManageMultiSelect",published:!0,externalpub:!1,subscribed:!0,externalsub:!1},{id:"_ENOXVersionExplorerNoActions",published:!1,externalpub:!1,pubfn:function(){}},{id:"_ENOXVersionExplorerViewChanged",published:!0,externalpub:!1}],this._menuList=[{id:"ENOXVersionExplorerOpenVersion",event:"ENOXVersionExplorerOpenVersion",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-open",family:WUXManagedFontIcons.Font3DS},text:d.open,userAccess:["read","write"],checkVersion:function(e){return!e.isMIB()&&!e.isActive()},nodeDropdown:!0},{id:"ENOXVersionExplorerDisplayProperties",event:"ENOXVersionExplorerDisplayProperties",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-attributes",family:WUXManagedFontIcons.Font3DS},icon:s.getIconPath("Properties"),text:s.getTitle("Properties"),userAccess:["read","write"],checkVersion:function(e){return r._DATA_MODEL_TYPE!==t.DATA_MODEL_TYPES.MODEL_RDF},nodeDropdown:!0},{id:"ENOXVersionExplorerCompareToSelected",event:"preENOXVersionExplorerCompareToSelected",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-part-compare",family:WUXManagedFontIcons.Font3DS},icon:p("I_Compare.png"),text:d.compareTo,checkAccess:["read","write"],checkVersion:function(e){return!1},nodeDropdown:!0},{id:"ENOXVersionExplorerCompareWithBranchOrigin",event:"preENOXVersionExplorerCompareWithBranchOrigin",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-part-compare",family:WUXManagedFontIcons.Font3DS},icon:p("I_Compare.png"),text:d.compareWithBranchOrigin,checkAccess:["read","write"],checkVersion:function(e){return!(!e.__BRANCH__.nodeList[0].options.ancestors||!e.__BRANCH__.nodeList[0].options.ancestors.find(function(e){return"PS"===e.semantic.toUpperCase()}))},nodeDropdown:!0},{id:"divider"},{id:"ENOXVersionExplorerShowMaturity",event:"preEventENOXVersionExplorerShowMaturity",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-collaborative-lifecycle-management",family:WUXManagedFontIcons.Font3DS},icon:s.getIconPath("MaturityHdr"),text:s.getTitle("MaturityHdr"),userAccess:["read","write"],checkVersion:function(e){return!e.isMIB()&&s.checkAvailability("MaturityHdr",[u(e)],this._widget,this._context)},nodeDropdown:!0},{id:"ENOXVersionExplorerCreateNewRevision",event:"preENOXVersionExplorerCreateNewVersion",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-flow-line-add",family:WUXManagedFontIcons.Font3DS},icon:s.getIconPath("RevisionHdr"),text:s.getTitle("RevisionHdr"),checkAccess:["read","write"],checkVersion:function(e){return!0===n.X_DESIGN||r._DATA_MODEL_TYPE===t.DATA_MODEL_TYPES.MODEL_RDF||null!=this._REVISION_FROM_NON_LEAF_ALLOWED&&(e.isLeaf()||!0===this._REVISION_FROM_NON_LEAF_ALLOWED)&&s.checkAvailability("RevisionHdr",[u(e)],this._widget,this._context)},nodeDropdown:!0},{id:"ENOXVersionExplorerNewRevisionFrom",event:"preENOXVersionExplorerNewRevisionFrom",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-flow-branch-add wux-ui-3ds-flip-vertical version-explorer-noflip-border",family:WUXManagedFontIcons.Font3DS},icon:s.getIconPath("ReviseFromHdr"),text:s.getTitle("ReviseFromHdr"),checkAccess:["read","write"],checkVersion:function(e){return!e.isMIB()&&s.checkAvailability("ReviseFromHdr",[u(e)],this._widget,this._context)},nodeDropdown:!0},{id:"ENOXVersionExplorerCreateNewBranch",event:"preENOXVersionExplorerCreateNewBranch",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-flow-branch-add",family:WUXManagedFontIcons.Font3DS},icon:s.getIconPath("NewBranchHdr"),text:s.getTitle("NewBranchHdr"),checkAccess:["read","write"],checkVersion:function(e){return!0===n.X_DESIGN||r._DATA_MODEL_TYPE===t.DATA_MODEL_TYPES.MODEL_RDF||s.checkAvailability("NewBranchHdr",[u(e)],this._widget,this._context)},nodeDropdown:!0},{id:"ENOXVersionExplorerDuplicate",event:"preENOXVersionExplorerCreateDuplicate",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-duplicate",family:WUXManagedFontIcons.Font3DS},icon:s.getIconPath("DuplicateHdr"),text:s.getTitle("DuplicateHdr"),checkAccess:["read","write"],checkVersion:function(e){return!e.isMIB()&&s.checkAvailability("DuplicateHdr",[u(e)],this._widget,this._context)},nodeDropdown:!0},{id:"ENOXVersionExplorerDeleteVersion",event:"preENOXVersionExplorerDeleteVersion",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-trash",family:WUXManagedFontIcons.Font3DS},icon:s.getIconPath("DeleteHdr"),text:s.getTitle("DeleteHdr"),checkAccess:["read","write"],checkVersion:function(e){return!e.isMIB()&&s.checkAvailability("DeleteHdr",[u(e)],this._widget,this._context)},nodeDropdown:!0},{id:"ENOXVersionExplorerWhereUsed",event:"preENOXVersionExplorerWhereUsed",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-object-related",family:WUXManagedFontIcons.Font3DS},icon:p("I_ENORIPE32.png"),text:d.relations,checkAccess:["read","write"],checkVersion:function(e){return!1},nodeDropdown:!0},{id:"divider"},{id:"ENOXVersionExplorerOpenWith",event:"preEventENOXVersionExplorerOpenWith",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-export",family:WUXManagedFontIcons.Font3DS},icon:p("I_OpenWith.png","ENXNav"),text:d.openWith,userAccess:["read","write"],checkVersion:function(e){return!1},nodeDropdown:!0}],this._multiSelectMenuList=[{id:"ENOXVersionExplorerNoActions",event:"_ENOXVersionExplorerNoActions",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-block",family:WUXManagedFontIcons.Font3DS},text:d.noActions,checkVersion:function(e){return!0},multiSelectMenu:!0,minNodes:2,maxNodes:1/0,excludeIfOtherItemsExist:!0}]}}),define("DS/ENOXVersionExplorerController/VersionExplorerEventManager",["UWA/Core","UWA/Class","UWA/Promise","DS/ENOXVersionExplorerController/VersionExplorerEventList","DS/i3DXCompassPlatformServices/OpenWith","DS/CoreEvents/ModelEvents"],function(e,t,n,i,o,r){"use strict";var s=r.extend({_disabledEventList:[],init:function(r,a,d){this._parent(r);var l=a;s.implement({addExternalNodeDropdownMenuItem:function(e){for(var t=Array.isArray(e)?e:new Array(e),n=0;n<t.length;n++){if("string"!=typeof(e=t[n]).id||!e.id.length)throw Error("VersionExplorerEventManager:addDropDownMenuItem - eventId cannot be null ");if(!e.icon&&!e.fonticon)throw Error("VersionExplorerEventManager:addDropDownMenuItem - icon cannot be null ");if("string"!=typeof e.text||!e.text.length)throw Error("VersionExplorerEventManager:addDropDownMenuItem - menu text cannot be null ");if("function"!=typeof e.subfn)throw Error("VersionExplorerEventManager:addDropDownMenuItem - subscribe function cannot be null");if("function"!=typeof e.checkVersion)throw Error("VersionExplorerEventManager:addDropDownMenuItem - checkVersion function cannot be null");var i={id:e.id,externalpub:!0,published:!0,externalEvent:!0,subfn:e.subfn};this._eventList.push(i),this._registerEvent(i),this._menuList.push({id:e.id,event:e.id,icon:e.icon||void 0,fonticon:e.fonticon||void 0,text:e.text,checkVersion:e.checkVersion,externalMenu:!0,nodeDropdown:!0})}},addExternalMultiSelectDropdownMenuItem:function(e){for(var t=Array.isArray(e)?e:new Array(e),n=0;n<t.length;n++){if("string"!=typeof(e=t[n]).id||!e.id.length)throw Error("VersionExplorerEventManager:addDropDownMenuItem - eventId cannot be null ");if(!e.icon&&!e.fonticon)throw Error("VersionExplorerEventManager:addDropDownMenuItem - icon cannot be null ");if("string"!=typeof e.text||!e.text.length)throw Error("VersionExplorerEventManager:addDropDownMenuItem - menu text cannot be null ");if("function"!=typeof e.subfn)throw Error("VersionExplorerEventManager:addDropDownMenuItem - subscribe function cannot be null");if("function"!=typeof e.checkVersion)throw Error("VersionExplorerEventManager:addDropDownMenuItem - checkVersion function cannot be null");var i={id:e.id,externalpub:!0,published:!0,externalEvent:!0,subfn:e.subfn};this._eventList.push(i),this._registerEvent(i),this._multiSelectMenuList.push({id:e.id,event:e.id,icon:e.icon||void 0,fonticon:e.fonticon||void 0,text:e.text,checkVersion:e.checkVersion,externalMenu:!0,multiSelectMenu:!0,minNodes:e.minNodes||2,maxNodes:e.maxNodes||1/0})}},removeExternalNodeDropdownMenuItem:function(e){this._removeExternalDropdownMenuItem(e)},removeExternalMultiSelectDropdownMenuItem:function(e){this._removeExternalDropdownMenuItem(e,!0)},getPublishedEvents:function(){return this._eventList.reduce(function(e,t){return!0===t.published&&!0===t.externalpub&&e.push({event:t.id,onCompleteEvent:t.onCompleteEvent}),e},[])},getSubscribedEvents:function(){return this._eventList.reduce(function(e,t){return!0===t.subscribed&&!0===t.externalsub&&e.push({event:t.id,onComplete:t.onComplete}),e},[])},subscribeEvent:function(e,t,n){var i,o=this._getEvent(e);return o&&"function"==typeof t&&(i=this.subscribe({event:o.id},t),n&&o.tokenDefault&&!0===o.allowPreventDefault&&(this.unsubscribe(o.tokenDefault),o.tokenDefault=void 0),o.tokens.push(i)),i},unsubscribeEvent:function(e,t){var n=this._getEvent(e);if(n&&t){var i=n.tokens.splice(n.tokens.indexOf(t),1);1===i.length&&this.unsubscribe(i[0]),n.tokens.length||!n.subfn||n.tokenDefault||(n.tokenDefault=this.subscribe({event:n.id},n.externalEvent?n.subfn:n.subfn.bind(this)))}},publishEvent:function(e,t){var n=this._getEvent(e);n&&"function"==typeof n.pubfn&&n.pubfn(t)},disablePublishEvent:function(e){this._disabledEventList.push(e)},enablePublishEvent:function(e){this._disabledEventList.splice(this._disabledEventList.indexOf(e),1)},getMenuItemsIDList:function(e){return this[e?"_multiSelectMenuList":"_menuList"].reduce(function(e,t){return!("divider"===t.id||"ENOXVersionExplorerNoActions"===t.id)&&e.push(t.id),e},[])},hideMenuItem:function(e,t){var n=this[t?"_multiSelectMenuList":"_menuList"].find(function(t){return t.id===e});n&&(n.disabled=!0)},showMenuItem:function(e,t){var n=this[t?"_multiSelectMenuList":"_menuList"].find(function(t){return t.id===e});n&&(n.disabled=!1)},setCheckVersionExternalFunction:function(e,t,n){var i=this[n?"_multiSelectMenuList":"_menuList"].find(function(t){return t.id===e});i&&"function"==typeof t&&(i.checkVersionExternal=t)},resetCheckVersionExternalFunction:function(e,t){var n=this[t?"_multiSelectMenuList":"_menuList"].find(function(t){return t.id===e});n&&(n.checkVersionExternal=void 0)},publish:function(e){if("select"===e.event||"unselect"===e.event&&e.context&&e.context.options){var t=e.context.options;if(t.grid&&t.grid.contents&&t.grid.contents[0].id){var n=t.grid.contents[0].id;e.context.options.cid=n}}this._disabledEventList.indexOf(e.event)<0&&this._parent(e)},_removeExternalDropdownMenuItem:function(e,t){var n,i,o=!0===t?"_multiSelectMenuList":"_menuList";1===(i=1===(n=this[o].splice(this[o].findIndex(function(t){return t.id===e&&!0===t.externalMenu}),1)).length?this._eventList.find(function(e){return e.id===n[0].id&&!0===n[0].externalMenu&&!0===e.externalEvent}):[]).length&&this._unregisterEvent(i[0])},_registerEvent:function(e){e.noPubFn||(e.pubfn=function(t){this.publish({event:e.id,data:t})}.bind(this)),e.tokens=[],e.subfn&&(e.tokenDefault=this.subscribe({event:e.id},e.externalEvent?e.subfn:e.subfn.bind(this)))},_unregisterEvent:function(e){for(var t=e.tokens.length,n=0;n<t;n++)this.unsubscribe(e.tokens[n]);e.tokens=[],e.tokenDefault&&(this.unsubscribe(e.tokenDefault),e.defaultToken=void 0)},_getEvent:function(e){return this._eventList.find(function(t){return t.id===e})},_getMenuItemList:function(e){var t=this;return t[!0===e?"_multiSelectMenuList":"_menuList"].map(function(e){if("object"==typeof e){var n={};if("divider"===e.event)n=e;else for(var i in e)n[i]="event"===i?t._eventList.find(function(t){return t.id===e[i]}):e[i];return n}})},_getNodeDropdownMenuListPromise:function(e){var t=this;return l._getPreContextualMenuPromise(e).then(function(e){var i=e;return new n(function(e,n){var o=t._getMenuItemList().reduce(function(e,n,o,r){return n&&n.id&&("divider"===n.id||!n.disabled&&!!(n.checkVersionExternal||(!0===n.event.externalEvent?n.checkVersion:n.checkVersion.bind(t)))(i)&&!0===n.nodeDropdown)&&e.push(n),e},[]);"divider"==o[o.length-1].id&&o.pop();for(var r=-1,s=0;s<o.length;s++)if("ENOXVersionExplorerOpenWith"===o[s].id){r=s;break}if(!(r<0))return t._getNodeDropdownMenuListOpenWithPromise(i).then(function(t){t.length>0?o[r].submenu=t:o.splice(r,1),e(o)});e(o)})})},_getNodeDropdownMenuListOpenWithPromise:function(t){var i=this;return new n(function(n,s){var a=[],d=t.options.data.type;void 0===d&&(d=t.options.grid.type),!i._widget||t.isMIB()?n(a):require(["DS/PADUtils/PADUtilsServices","DS/PADUtils/PADWSAccess"],function(i,s){i.app_initialization(function(){var s=t;s.options.type=s.options.data.type,s.options.displayname=r.label,s.getID=function(){return this.options.grid&&this.options.grid.contents&&this.options.grid.contents.length>0?this.options.grid.contents[0].id:this.options.id},i.contentOpenWith([s],function(t){var r=new o;r.set3DXContent(t,!1),e.is(r.retrieveCompatibleApps,"function")&&r.retrieveCompatibleApps(function(t){var r=!1;s.options.type===d&&t.forEach(function(e){e.text.contains("CATIA V5")&&(r=!0),a.push({type:"PushItem",title:e.text,fonticon:void 0!==e.fonticon&&null!==e.fonticon&&e.fonticon.length>0?{content:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-"+e.fonticon,family:WUXManagedFontIcons.Font3DS}:void 0,icon:void 0!==e.icon&&null!==e.icon&&e.icon.length>0?e.icon:"",action:{callback:e.handler}})}),r||"XCADNonPSBaseRepReference"!==s.options.type?s.options.type===d&&n(a):(s.options.type="VPMReference",i.contentOpenWith([s],function(t){var i=new o;i.set3DXContent(t,!1),e.is(i.retrieveCompatibleApps,"function")&&i.retrieveCompatibleApps(function(e){e.forEach(function(e){e.text.contains("CATIA V5")&&a.push({type:"PushItem",title:e.text,fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-"+e.fonticon,family:WUXManagedFontIcons.Font3DS},action:{callback:e.handler}})}),s.options.type=d,n(a)})}))})})})})})},_getMultiSelectMenuListPromise:function(e){if(!Array.isArray(e))throw Error("_getMultiSelectMenuListPromise.nodeList: Input not of type array");var t=this,i=e.length;return new n(function(n,o){var r=t._getMenuItemList(!0).reduce(function(n,o,r,s){var a=!0;if(!0===o.multiSelectMenu&&i>=o.minNodes&&i<=o.maxNodes)for(var d=0;d<i;d++)a&=!o.disabled&&(o.checkVersionExternal||o.checkVersion).bind(t)(e[d],e);return o&&o.id&&("divider"===o.id||!0===Boolean(a))&&n.push(o),n},[]);r.length&&"divider"==r[r.length-1].id&&r.pop(),r.length>1&&r.splice(r.findIndex(function(e){return!0===e.excludeIfOtherItemsExist}),1),n(r)})}}),t.implement.call(this,new i(a,d));for(var p=this._eventList.length,u=0;u<p;u++){var c=this._eventList[u];this._registerEvent(c)}}});return s}),define("DS/ENOXVersionExplorerController/VersionExplorerController",["UWA/Core","UWA/Utils/InterCom","DS/ENOXVersionExplorerModel/VersionTreeDocumentModel","DS/ENOXVersionExplorerModel/VersionTreeNodeModel","DS/ENOXVersionExplorerViews/VersionExplorerView","DS/ENOXVersionExplorerViews/NewVersionDialog","DS/ENOXVersionExplorerViews/NewRevisionDialog","DS/ENOXVersionExplorerController/VersionExplorerEventManager","DS/ENOXVersionExplorerUtils/VersionExplorerEnums","DS/ENOXVersionExplorerUtils/VersionExplorerSettings","DS/ENOXVersionExplorerModelManager/ModelManagerBase","DS/ENOXVersionExplorerModelManager/ModelManagerP","DS/ENOXVersionExplorerModelManager/ModelManagerRDF","DS/ENOXVersionExplorerModelManager/ModelManagerHistory","DS/ENOXVersionExplorerModelManager/ModelManagerHistory2","DS/ENOXVersionExplorerUtils/ArrayFunctions","DS/ENOXVersionExplorerUtils/ColumnList","DS/WAFData/WAFData","DS/LifecycleCmd/MessageMediator","DS/LifecycleServices/LifecycleServices","DS/LifecycleServices/LifecycleServicesSettings","DS/LifecycleServices/DictionaryServices","DS/ENOXVersionExplorerViews/VersionExplorerPrefs","DS/PlatformAPI/PlatformAPI","DS/WebInWinHelper/WebInWinHelper"],function(e,t,n,i,o,r,s,a,d,l,p,u,c,E,f,h,_,v,x,D,m,b,O,N,g){"use strict";return a.extend({_currentVersion:void 0,_activeVersion:void 0,_context:void 0,_tenant:void 0,_type:void 0,_widget:void 0,init:function(a){var y,M,V,C,w,S,I,L,A=void 0,T=void 0,X=void 0,P=void 0,W=void 0,R=void 0;function k(t){var n;if("string"==typeof t){var o=JSON.parse(t),r=o.Refresh;if(r)if(Array.isArray(r.created)&&r.created.length>0&&X.isNodeInModel(r.created[0].sourceObjectId))n={physicalid:r.created[0].physicalid,tenant:o.tenant,fireEvent:"ENOXVersionExplorerNewVersionCreated"},r.created[0].forceLoad&&(n.forceLoad=r.created[0].forceLoad);else if(Array.isArray(r.modified)&&r.modified.length>0&&X.isNodeInModel(r.modified[0].physicalid))n={physicalid:r.modified[0].physicalid,tenant:o.tenant,fireEvent:"ENOXVersionExplorerVersionModified"};else if(Array.isArray(r.deleted)&&r.deleted.length>0&&X.isNodeInModel(r.deleted[0].physicalid)){var s=h.intersectionDifference(r.deleted,X._nodeList,function(e,t){return e.physicalid===t.options.id}),a=s[1].difference,d=s[1].intersection;d.length&&(n={removedVersion:d[0],fireEvent:"ENOXVersionExplorerVersionDeleteCompleted"},d[0]===A._activeVersion&&(A._activeVersion=void 0),a.length&&e.extend(n,{physicalid:a[0].options.id,tenant:o.tenant}))}}else if(t&&t.authored&&t.authored.modified&&e.is(t.authored.modified,"array")&&1===t.authored.modified.length){if(e.is(t.authored.modified[0],"string")&&X.isNodeInModel(t.authored.modified[0]))n={physicalid:t.authored.modified[0],fireEvent:"ENOXVersionExplorerVersionModified"};else if(e.is(t.authored.modified[0].physicalid,"string")&&X.isNodeInModel(t.authored.modified[0].physicalid)&&e.is(t.authored.modified[0].key,"string")&&e.is("ownerChanged"===t.authored.modified[0].key)){var l=X._nodeList.findIndex(function(e){return e.options.id===t.authored.modified[0].physicalid});n=0===l&&1===X._nodeList.length?{removedVersion:X.searchByID(t.authored.modified[0].physicalid)[0],fireEvent:"ENOXVersionExplorerVersionOwnerChanged"}:{removedVersion:X.searchByID(t.authored.modified[0].physicalid)[0],fireEvent:"ENOXVersionExplorerVersionOwnerChanged",physicalid:X._nodeList[0===l?1:0].options.id}}}else t.options&&t.options.id&&(n={physicalid:t.options.id,fireEvent:"NewVersionCreated"});n&&(n.physicalid?(n.forceLoad&&(X._circularColorArray.resetCurrentIndex(),X._forceReset=!0,X.items=null),A._loadVersionModel({id:n.physicalid,tenantId:n.tenant,context:A._context,securityContext:A._securityContext,type:X.type,dataModelType:X._DATA_MODEL_TYPE,onComplete:function(e){var t,o;if(t=n.fireEvent.contains("Created")||n.fireEvent.contains("Modified")?1===(o=X.searchByID(n.physicalid)).length?o[0]:void 0:n.removedVersion,A._activeVersion){var r=X.searchByID(A._activeVersion);1===r.length&&r[0]instanceof i&&!r[0].isActive()&&A._setActiveVersion({treeNode:r[0]})}t&&A.publishEvent(n.fireEvent,t)}})):X.empty())}function F(e){console.log("VersionExplorerController error handler"),console.log(e),A.publishEvent("ENOXVersionExplorerError",e),T.unmask()}function U(e,t){X.createNewVersionPromise({parentid:e.parent.options.id,title:e.title,description:e.description,versionSemantic:e.versionSemantic,nextRevision:e.parent.nextRevision,itemID:X.itemID}).then(t,F)}A=this,a=a||{},this._widget=a.widget,l._widget=a.widget,w="boolean"!=typeof a.autoUpdate||a.autoUpdate,(X=new(n.implement(p)))._isODT=a._isODT,X.useGlobalStorage="boolean"==typeof a.useGlobalStorage&&a.useGlobalStorage,X._useFontIcons="boolean"==typeof a.useIcons&&a.useIcons,X.globalStorageName=a.globalStorageName,X.webToWinComSocket=a.webToWinComSocket,this._ID=X._ID="VE_"+Date.now().valueOf().toString(),y=a.versionGraphContainer,V=a.nodeEdgeViewsTemplate,C=a.customOnDrop,M=a.newVersionDialogContainer,S=a.useWebCommandsOnNative,I=a.disableMaturityButton,L=a.fromWebInWinWrapper,R=new O(a.widget,"RevisionExplorerCustomizeColumns",void 0,void 0,a._isODT,X.useGlobalStorage,X.globalStorageName,X.webToWinComSocket),w&&(x.addEvent("_ENOXVersionExplorerNewVersionCreated",k),this.refreshSub=N.subscribe("Lifecycle.Modification",k),require(["DS/PADUtils/PADCommandProxy"],function(e){A.PADCommandProxy=e.create({events:{onRefresh:k.bind(A)}})})),T=new o({parentContainer:y,nodeEdgeViewsTemplate:V,customOnDrop:C,versionExplorerController:A,versionModel:X,_isODT:a._isODT,customizeColumns:R}),this._parent(a,X,T),X._getTrueRoot()._modelEvents._setParent(this),T.build(),X._SELECTION_MODE=a.selectionMode||d.SELECTION_MODES.MULTI_SELECT_ONLY|d.SELECTION_MODES.WITH_COMMANDS,X._SELECTION_MODE>=0&&X._SELECTION_MODE&d.SELECTION_MODES.SINGLE_SELECT_ONLY&&(X._SELECTION_MODE&=~d.SELECTION_MODES.MULTI_SELECT_ONLY),e.Class.implement.call(this,{setSelectionMode:function(e){W=X._SELECTION_MODE,e>=0&&e&d.SELECTION_MODES.SINGLE_SELECT_ONLY&&(e&=~d.SELECTION_MODES.MULTI_SELECT_ONLY),T.setSelectionMode(e>=0?e:d.SELECTION_MODES.MULTI_SELECT_ONLY|d.SELECTION_MODES.WITH_COMMANDS)},restorePreviousSelectionMode:function(){T.setSelectionMode(W||d.SELECTION_MODES.MULTI_SELECT_ONLY|d.SELECTION_MODES.WITH_COMMANDS)},showDialog:function(t,n,o){var r;null==n&&(n=null!=this._widget?this._widget.body:null),T.showDialog(t,n,o);var s,a=1===(r=X.searchByID(A._activeVersion)).length?r[0]:void 0;a instanceof i&&(void 0!==a.options&&void 0!==a.options.label&&void 0!==a.options.label&&(s=e.String.unescapeHTML(a.options.label)),T.setTitle(s))},hideDialog:function(){T.hideDialog()},cleanup:function(){w&&x.removeEvent("_ENOXVersionExplorerNewVersionCreated",k),T.cleanup(),X.empty(),X.itemID=null,X.items=null},getSelectedNodes:function(){return X.getSelectedNodes()},setSingleSelectionMode:function(){this.setSelectionMode(X._SELECTION_MODE&~d.SELECTION_MODES.MULTI_SELECT_ONLY)},setMultiSelectionMode:function(){this.setSelectionMode(X._SELECTION_MODE|d.SELECTION_MODES.MULTI_SELECT_ONLY)},enableCommands:function(){this.setSelectionMode(X._SELECTION_MODE|d.SELECTION_MODES.WITH_COMMANDS)},areCommandsEnabled:function(){return!!(X._SELECTION_MODE&d.SELECTION_MODES.WITH_COMMANDS)},disableCommands:function(){this.setSelectionMode(X._SELECTION_MODE&~d.SELECTION_MODES.WITH_COMMANDS)},select:function(e,t){var n=e instanceof i?[e]:"string"==typeof e&&e.length?X.searchByID(e):void 0;Array.isArray(n)&&1===n.length&&(X.prepareAddDelete(),n[0].select(t),X.pushAddDelete())},unselectAll:function(){X&&(X.prepareAddDelete(),X.unselectAll(),X.pushAddDelete())},applyFilter:function(e){if(X){X.filterData=e,X.prepareAddDelete(),X._FILTER_ENABLED=!0;var t=X?X.applyFilter(e):[];!t.length&&(X._FILTER_ENABLED=!1,this.clearFilter()),X.pushAddDelete()}return t},resetFilter:function(){X&&null!=X.filterData&&this.applyFilter(X.filterData)},clearFilter:function(){X&&(X.prepareAddDelete(),X._FILTER_ENABLED=!1,X&&X.clearFilter(),X.pushAddDelete())},enableDrag:function(e){this.setSelectionMode(X._SELECTION_MODE|d.SELECTION_MODES.ALLOW_DRAG)},disableDrag:function(){this.setSelectionMode(X._SELECTION_MODE&~d.SELECTION_MODES.ALLOW_DRAG)},enableDrop:function(){this.setSelectionMode(X._SELECTION_MODE|d.SELECTION_MODES.ALLOW_DROP)},disableDrop:function(){this.setSelectionMode(X._SELECTION_MODE&~d.SELECTION_MODES.ALLOW_DROP)},getObjects:function(){return X._nodeList.slice()},reframeAll:function(){T&&T.reframeThumbnailGraph()},_getMaturityStatesAttributes:function(t,n,i){return new e.Class.Promise(function(e,o){var r=new Set;r.add(t);var s={policies:Array.from(r)},a=JSON.stringify(s),d=m.get3DSpaceWSUrl(n,"/resources/lifecycle/maturity/getStatesAttributes",null);v.authenticatedRequest(d,{method:"POST",type:"text",headers:m.getHeaders(encodeURIComponent(i)),timeout:6e5,data:a,onComplete:function(t){var n="string"==typeof t?JSON.parse(t):t;e(n)},onFailure:function(t,n){e({})},ontimeout:function(){e({})}})})},_loadVersionModel:function(e){a._isODT||T.setLoadingMask(),X.type=e.type||X.type||"",void 0===e.securityContext&&(e.securityContext=this._securityContext),widget.securityContext=e.securityContext,"function"!=typeof widget.getValue&&(widget.getValue=function(t){if("x3dPlatformId"===t)return e.tenantId});var t=e.tenantId;!t&&e.tenant&&(t=e.tenant),t||(t=widget.getValue("x3dPlatformId"));var n=[e.id],i=["3DSpace"],o=[],r=[0];A._app_initialization(function(){A._loadAttrs(n,i,o,r,t,function(n){A._getIsKindOfPromise(t,["Requirement","Requirement Specification","Requirement Group","Chapter","Comment"],X.type).then(function(i){!function(e,t,n,i,o){if(e===d.DATA_MODEL_TYPES.MODEL_HISTORY&&(X._DupToggling=!0,!1===l.UserSettings.displayDuplicates&&(e=d.DATA_MODEL_TYPES.MODEL_REVISION,X._forceReset=!0)),"string"==typeof t&&t.length&&e!==d.DATA_MODEL_TYPES.MODEL_HISTORY&&(e=d.DATA_MODEL_TYPES[t.contains(":")?"MODEL_RDF":"MODEL_REVISION"]),void 0!==X.lastType&&X.lastType!==t&&(X._forceReset=!0),X.lastType=t,X._forceReset||X._DATA_MODEL_TYPE!==e){X._forceReset=!1,X._DATA_MODEL_TYPE=e;for(var r=_(X._DATA_MODEL_TYPE),s={},a=0;a<r.columns.length;a++)s[r.columns[a].dbKey]=a;if(n&&n.length>0){var p={nlsLabel:!0,"PLMEntity.PLM_ExternalID":!0,"PLMEntity.V_Name":!0,"PLMEntity.V_description":!0,current:!0,originated:!0},h=n[0].basicData,v=n[0].data,x=n[0].computed;n[0].extensions,A._isMIB=0==n[0].physicalID.indexOf("cid:");for(var D={},m=[h,v,x],b=0;b<m.length;b++){var O=m[b];if(void 0!==O)for(a=0;a<O.length;a++){var N=O[a],g=N.selectable,y=N.name,M=N.nls,V=N.path;if(null==N.attrID&&(void 0!==V&&(g=y=V),!(g&&0===g.indexOf("branch.")||A.isMIB&&"SystemModel.Title"===g))){if(void 0===M&&N.displayName&&(M=N.displayName),void 0===g&&y){var C=(g=y).split(":");g=C[C.length-1]}void 0===s[g]&&void 0===p[g]&&(D[g]={dbKey:g,outputKey:y,columnNLS:M})}}}for(var a in D)r.columns.push(D[a])}switch(R.setParams("RevisionExplorerCustomizeColumns_"+X._DATA_MODEL_TYPE.toString(),r.columns,r.defaultCols,r.resetGraphListView,r.resetGraphView),X._DATA_MODEL_TYPE){case d.DATA_MODEL_TYPES.MODEL_RDF:P=c;break;case d.DATA_MODEL_TYPES.MODEL_HISTORY:P=o||"string"==typeof t&&t.length&&(t.indexOf("Requirement")>=0||"Chapter"===t||"Comment"===t)?E:f;break;case d.DATA_MODEL_TYPES.MODEL_CUSTOM:if(!i)throw Error("VersionExplorerController:setModelManager - Custom model manager not provided for data model type MODEL_CUSTOM");P=i;break;default:P=u}X.setManager(P)}}(e.dataModelType,X.type,n,e.customModelManager,i),T&&T.updateViewOptions();var o,r=e.onComplete;A._context=e.context,A._tenantId=t,A._securityContext=e.securityContext,A._securityContext&&!A._context&&(A._context={getSecurityContext:function(){return{SecurityContext:A._securityContext}}}),o=_(X._DATA_MODEL_TYPE).excludeFromQuery,e.attributeList=R.getAlldbKeys(),Array.isArray(o)&&o.length&&(e.attributeList=h.intersectionDifference(e.attributeList,o,function(e,t){return e===t})[0].difference),X.loadVersionModelPromise(e).then(function(t){var n="";X.mainBranchRoot&&X.mainBranchRoot.policy&&(n=X.mainBranchRoot.policy),A._getMaturityStatesAttributes(n,A._tenantId,A._securityContext).then(function(n){A._statesData=n,a._isODT||T.unmask(),t&&T.displayView(e.reframe),A._currentVersion=e.id,"function"==typeof r&&r(e)})},function(e){A._widget&&A._widget.lifecycleWidget&&A._widget.lifecycleWidget.empty(),F(e)})})},void 0,void 0,l)})},_setActiveVersion:function(t){var n;if(t.treeNode)n=t.treeNode;else if(t.id){var i=X.searchByID(t.id);1===i.length&&(n=i[0])}if(X.prepareAddDelete(),X.setAttributeAll("__isActive__",!1),n){var o;if(X.setAttribute(n,"__isActive__",!0),A._activeVersion=n.options.id,void 0!==n.options&&void 0!==n.options.label&&void 0!==n.options.label){var r={};n.options.eStrings&&(r=n.options.eStrings),!0===r[n.options.label]&&(o=e.String.unescapeHTML(n.options.label))}T.setTitle(o)}X.pushAddDelete()},_displayNewVersionDialog:function(e){var t;if(e.treeNode)t=e.treeNode;else if(e.id){var n=X.searchByID(e.id);1===n.length&&(t=n[0])}t&&r.displayDialog({dataModelType:X._DATA_MODEL_TYPE,defaultName:X.getNewVersionName(),derivedFrom:{id:t.options.id,name:t.options.grid.title},parentContainer:M,onOK:function(e,n,i){U({title:e,description:n,parent:t,versionSemantic:i},function(e){A.publishEvent("ENOXVersionExplorerNewVersionCreated",e)})}})},_showWhereUsed:function(e){if(null===X.webToWinComSocket||void 0===X.webToWinComSocket){var n=m.getTenant(),i=require("DS/PADUtils/PADCommandProxy").create();require(["DS/PADUtils/PADUtilsServices"],function(o){var r=[];r.push({envId:n,serviceId:"",contextId:"",objectId:e.id,objectType:e.type,displayName:e.displayName});var s={protocol:"3DXContent",version:"1.0",source:"ENOSTDE_AP",data:{items:r}},a={attributes:{},paths:[],version:"1.1"},d=new t.Socket("compassPageSocket");d.subscribeServer("com.ds.compass",window.parent),d.dispatchEvent("onSetX3DContent",s,"compassPageSocket"),d.addListener("launchApp",function(e){i.select(a),i.destroy(),console.log("Response = "+JSON.stringify(e))}),d.dispatchEvent("onLaunchApp",{appId:"ENORIPE_AP"},"compassPageSocket")})}else g.fireWintopCommand(X.webToWinComSocket,e,"CATRelNavWebInWinCmdHdr")},_getMainBranchAttribute:e=>X.mainBranchRoot?X.mainBranchRoot[e]:"",_isMaturityButtonDisabled:()=>I,_isFromWebInWinWrapper:()=>L,_setUseWebCommandsOnNative(){var e=!1;if(1!=S)return e;if(this._isWebInWinMode()){var t=this._getMainBranchAttribute("type");this._getMainBranchAttribute("label"),this._getMainBranchAttribute("code"),this._getMainBranchAttribute("id");if(""===t){var n=this.getSelectedNodes();n.length>0&&(t=n[0].options.grid.type,n[0].options.grid.name,n[0].options.grid.code,n[0].options.grid.id)}"ConfiguredBaseline"===t&&(e=!0)}return e},_fetchNativeContextMenu:function(e,t,n,i){var o=[],r={displayName:n,id:e,name:n,physicalid:e,revision:i,type:t};o.push(r),g.fetchContextFromSelection(X.webToWinComSocket,o)},_getWebInWinSocket:function(){return X.webToWinComSocket},_isWebInWinMode:function(){return null!==X.webToWinComSocket&&void 0!==X.webToWinComSocket},getFilterHashObject:function(e){return X.filterHash[e]},getFilter:function(e){var t=void 0,n=X.objectHash[e.id];if(n&&n.ancestors){var i=n.ancestors.find(function(e){return e.hasExpand});if(i){var o=X.filterHash&&X.filterHash[i.filterid];o&&o.filterQuery&&(t=o.filterQuery.filter)}}return t},_showCompare:function(e,n){if(null===X.webToWinComSocket||void 0===X.webToWinComSocket){var i=m.getTenant(),o=[];if(null!==e&&o.push({envId:i,serviceId:e.serviceId,contextId:e.contextId,objectId:e.id,objectType:e.objectType,displayName:e.displayName,filterQuery:e.filter}),null!==n&&o.push({envId:i,serviceId:n.serviceId,contextId:n.contextId,objectId:n.id,objectType:n.objectType,displayName:n.displayName,filterQuery:n.filter}),o.length>0){var r={envId:i,protocol:"3DXContent",version:"1.0",source:"ENOSTDE_AP",data:{items:o}},s=new t.Socket("compassPageSocket");s.subscribeServer("com.ds.compass",window.parent),s.dispatchEvent("onSetX3DContent",r,"compassPageSocket"),s.addListener("launchApp",function(e){console.log("Response = "+JSON.stringify(e)),this.response=e.response});s.dispatchEvent("onLaunchApp",{appId:"ENOCOMP_AP"},"compassPageSocket")}}else g.launchWinCompare(X.webToWinComSocket,e,n)},_displayNewRevisionDialog:function(e){var t;if(e.treeNode)t=e.treeNode;else if(e.id){var n=X.searchByID(e.id);1===n.length&&(t=n[0])}t&&s.displayDialog({defaultName:t.options.grid.title,derivedFrom:{id:t.options.id,name:t.options.grid.title+" "+t.options.grid.code},nextRevision:t.nextRevision,parentContainer:M,onOK:function(e,n){U({title:e,description:n,parent:t,versionSemantic:"E"},function(e){A.publishEvent("ENOXVersionExplorerNewVersionCreated",e)})}})},_forceLoad:function(){X._circularColorArray.resetCurrentIndex(),X._forceReset=!0,X.items=null},_app_initialization:function(e){m.app_initialization(e)},_loadAttrs(e,t,n,i,o,r){D.loadAttrs(e,t,n,i,o,r)},_getIsKindOfPromise:(e,t,n)=>b.getIsKindOfPromise(e,t,n)}),a._isODT&&e.Class.implement.call(this,{_ODTGetVersionExplorerView:function(){return T},_ODTGetVersionModel:function(){return X}})}})});