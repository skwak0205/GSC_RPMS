function getTicket(e){var t=widget.getValue("myapps"),n=e+"login?service="+encodeURIComponent(t+"/resources/AppsMngt/api/pull/self?roles=true");return new Promise(function(e,t){require(["DS/WAFData/WAFData"],function(i){i.authenticatedRequest(n,{headers:{Accept:"application/json"},method:"get",type:"json",onComplete:function(t){widget.setValue("passportProxy",t.access_token),e()},onFailure:function(e){t(new Error("Could not fetch proxy ticket."))}})})})}define("DS/ENXEventPublish/Utils/EventWebServices",["DS/WAFData/WAFData","DS/Notifications/NotificationsManagerViewOnScreen","DS/Notifications/NotificationsManagerUXMessages","DS/PlatformAPI/PlatformAPI","i18n!DS/ENXEventPublish/assets/nls/ENXEventMsg"],function(e,t,n,i,a){"use strict";return t.setNotificationManager(n),t.setStackingPolicy(5),{getEventEnablementData:function(t,n){var a=i.getApplicationConfiguration("app.build.isCloud"),o=widget.getValue("x3dPlatformId"),r=widget.getValue("eventpublishing");"false"===a&&(o="OnPremise",r=widget.getValue("3DSpace"));var s=widget.getValue("myapps"),l=(widget.getValue("clm"),widget.getValue("passport")),d=r+"/v1/events/eventenablement";getTicket(l).then(function(i){var r=widget.getValue("passportProxy");e.authenticatedRequest(d,{data:{tenant:o,_myapps:s,proxy:r},headers:{Accept:"application/json"},method:"get",type:"json",onComplete:function(n){if("true"===a){var i=widget.getValue("clm");new Promise(function(t,n){var a={};a.tenant=o,a=JSON.stringify(a);var r=i+"clm/administration/listagents?xrequestedwith=xmlhttprequest";e.authenticatedRequest(r,{data:a,headers:{Accept:"application/json","Content-Type":"application/json"},method:"post",type:"json",onComplete:function(e){var n=e.agents;null!=n&&n.length>0?widget.setValue("isCLMAgent",!0):widget.setValue("isCLMAgent",!1),t()},ontimeout:function(e){widget.setValue("isCLMAgent",!1),t()},onFailure:function(e,n,i){widget.setValue("isCLMAgent",!1),t()}})}).then(function(e){t(n)}).catch(e=>{})}else t(n)},onFailure:function(e,t,i){n(e,t,i)}})})},persistEventEnablementData:function(t,i,o,r){e.authenticatedRequest(t,{data:i,headers:{Accept:"application/json","Content-Type":"application/json"},method:"put",type:"json",onComplete:function(e){n.addNotif({level:"success",message:a.NOTIFICATION_SUBMIT_MESSAGE,title:a.SAVE}),o()},ontimeout:function(e){r("Promise Rejected")},onFailure:function(e,t,i){var o=a.NOTIFICATION_FAILURE_MESSAGE;null!=t&&(null!=t["EVPErr#403"]?o=a.NOTIFICATION_CANCEL_MESSAGE_REASON+t["EVPErr#403"]:null!=t["EVPErr#DB404"]?o=a.NOTIFICATION_CANCEL_MESSAGE_REASON+t["EVPErr#DB404"]:null!=t["EVPErr#405"]?o=a.NOTIFICATION_CANCEL_MESSAGE_REASON+t["EVPErr#405"]:null!=t["EVPErr#DB406"]?o=a.NOTIFICATION_CANCEL_MESSAGE_REASON+t["EVPErr#DB406"]:null!=t["EVPErr#DB403"]?o=a.NOTIFICATION_CANCEL_MESSAGE_REASON+t["EVPErr#DB403"]:null!=t["EVPErr#409"]&&(o=a.NOTIFICATION_CANCEL_MESSAGE_REASON+t["EVPErr#409"])),n.addNotif({level:"error",message:o,title:a.ERROR}),r("Promise Rejected")}})}}}),define("DS/ENXEventPublish/Views/EventsEnablementGridView",["DS/Tree/TreeDocument","DS/Tree/TreeNodeModel","DS/DataGridView/DataGridView","DS/Controls/Button","DS/ENXEventPublish/Utils/EventWebServices","DS/WAFData/WAFData","UWA/Controls/Abstract","DS/Notifications/NotificationsManagerViewOnScreen","DS/Notifications/NotificationsManagerUXMessages","DS/PlatformAPI/PlatformAPI","DS/Controls/Accordeon","i18n!DS/ENXEventPublish/assets/nls/ENXEventMsg","i18n!DS/ENXEventPublish/assets/nls/ENXEventMsgTypeEvent"],function(e,t,n,i,a,o,r,s,l,d,c,u,g){"use strict";function p(o,r){var s=this,l=new e;v.gridDataView(function(e){var r=[],c=[],p=[],f=new Set,v=new Set;widget.setBody([{tag:"div",id:"widget-header",styles:{position:"relative"}},{tag:"div",id:"widget-content",styles:{height:"80%",position:"relative",border:"1px solid darkgray"}},{tag:"div",id:"widget-footer",styles:{height:"auto",position:"sticky",background:"#f1f1f1",border:"1px solid darkgray","border-top":"0px",left:0,right:0,bottom:0,visibility:"hidden",display:"flex","justify-content":"flex-end",padding:"4px 12px"}}]);var y=document.getElementsByClassName("moduleContent");if(y)try{y[0].style.setProperty("padding","7px")}catch(e){}var w=d.getApplicationConfiguration("app.build.isCloud");"true"===w&&!1===widget.getValue("isCLMAgent")&&m("warning",u.NOAGENTERROR,u.WARNING);var N=e.TypeEventsMapping.Services;void 0===N&&m("warning",u.NOCONFIGERROR,u.WARNING);for(var A=0;A<N.length;A++){var S=N[A];for(var C in S){var h=C;if("ServiceName"!==h&&"SupportedClasses"!==h&&"resourceURI"!==h){r.push(h);var I,b=S[h],P=b[0].enabledEvents,V=b[0].supportedEvents;for(I in P)f.add(P[I].trim()),c.push(h+"."+P[I].trim());for(I in V)v.add(V[I].trim()),p.push(h+"."+V[I].trim())}}}f=Array.from(f);var D=function(e,t,n,i){var a=[],o=1;for(var r in e){var s={},l=e[r],d=g.get(l);for(var c in s.Index=o,s.types=d,i){var u=i[c];if(t.indexOf(l+"."+u)>=0)s[u]=!0;else{if(!(n.indexOf(l+"."+u)>=0))continue;s[u]=!1}}a.push(s),o++}return a}(r,c,p,v=Array.from(v)),x=function(e){var t=[],n={},i={},a=[],o=[],r={},s={text:"Serial No.",dataIndex:"tree",typeRepresentation:"string",visibleFlag:!1};for(var l in a.push(s),r.text=u.TYPES,r.dataIndex="types",r.typeRepresentation="string",r.pinned="left",r.sortableFlag=!0,a.push(r),n.dataIndex="Blank",n.children=a,t.push(n),e){var d=e[l],c={};c.text=g.get(d),c.dataIndex=d,c.typeRepresentation="myCustomRepresentation",c.editableFlag=!0,c.editionPolicy="EditionInPlace",c.sortableFlag=!1,o.push(c)}return i.dataIndex="Events",i.text=u.EVENTS,i.children=o,t.push(i),t}(v);l.prepareUpdate(),D.forEach(function(e){var n=new t({label:e.Index,grid:e});l.addRoot(n)}),l.pushUpdate();l.setFilterModel({types:{filterId:"stringRegexp",filterModel:{condition1:{type:"startsWith",filter:""},operator:"or",condition2:{type:"endsWith",filter:""}}}}),l.setUseChangeTransactionMode(!0);var O={};l.onNodeModelUpdate(function(e){var t=e.data.nodeModel;if(t){var n=e.data.attributes;for(var i in n){n[i];break}var a=t._options.grid.types;O[a]=t._options.grid,"html"==document.activeElement.getParent().getTagName()&&(document.body.getElementsByClassName("wux-tweakers-edited")[0].tabIndex=1,document.body.getElementsByClassName("wux-tweakers-edited")[0].focus()),document.activeElement.getParent().className.contains("wux-tweakers-edited")&&"hidden"==document.getElementById("widget-footer").style.visibility&&(document.getElementById("widget-footer").style.visibility="visible")}});var T=new n({treeDocument:l,columns:x,defaultColumnDef:{getCellClassName:function(e){return e.nodeModel&&e.nodeModel._referenceValues&&e.nodeModel._referenceValues.hasOwnProperty(T.layout.getDataIndexFromColumnIndex(e.columnID))?"editedCell":e.nodeModel&&e.nodeModel.options&&"Exchange Jobs"==e.nodeModel.options.grid.types&&1==e.nodeModel.options.grid.computed&&1!=e.columnID?"disabledCell":void 0}},showModelChangesFlag:!0,rowSelection:"none"});T.onContextualEvent={callback:function(e){}},T.sortModel=[{dataIndex:"types",sort:"asc"}],T.getTypeRepresentationFactory().registerTypeRepresentations({myCustomRepresentation:{stdTemplate:"switch"}});var R=widget.body.parentElement.getElement("#widget-header"),M=widget.body.parentElement.getElement("#widget-content"),_=widget.body.parentElement.getElement("#widget-footer"),F=new UWA.Element("span",{display:"inline-flex",styles:{position:"absolute","margin-left":"5px","margin-right":"5px",left:"150px"}}),G=new UWA.Element("span",{id:"okContainer",display:"inline-flex",styles:{"margin-right":"8px"}}),k=new UWA.Element("span",{id:"cancelContainer",display:"inline-flex",styles:{"margin-right":"8px"}}),L=u.HEADING_SHOW_MORE;new UWA.Element("div",{text:L}),T.getContent().inject(M);T.getContent().style.top="40","true"===w&&!1===widget.getValue("isCLMAgent")&&widget.body.parentElement.getElement("#widget-content")&&(widget.body.parentElement.getElement("#widget-content").style.pointerEvents="none");var W=new i({label:u.SAVE,emphasize:"primary",showLabelFlag:"true"}),j=new i({label:u.CANCEL,showLabelFlag:"true"});W.addEventListener("buttonclick",function(e){var t,n=function(e){var t={};for(var n in e)t[e[n]]=n;return t}(g),i={};for(t in O){var o=new Set;for(var e in O[t])"types"!=e.trim()&&"Index"!=e.trim()&&O[t][e]&&o.add(e);void 0===n[t]?i[t]=Array.from(o):i[n[t]]=Array.from(o)}i=JSON.stringify(i);var r=widget.getValue("x3dPlatformId"),d=widget.getValue("eventpublishing");"false"===w&&(r="OnPremise",d=widget.getValue("3DSpace"));var c=widget.getValue("3DSpace");null!=c&&""!==c||(c=d.replace("eps","space"));var u=widget.getValue("passport");new Promise(function(e,t){getTicket(u).then(function(n){var o=widget.getValue("passportProxy"),s=d+"/v1/events/eventenablement?tenant="+r+"&_evpURL="+d+"&proxy="+o+"&3DSpace="+c+"&_myapps="+widget.getValue("myapps");a.persistEventEnablementData(s,i,e,t)})}).then(function(e){!function(e,t){var n=document.getElementsByClassName("wux-controls-switch");for(var i in n)isNaN(i)||""==n[i].getParent().style.backgroundColor||(n[i].getParent().style.backgroundColor="");t.acceptChanges(),document.getElementById("widget-footer").style.visibility="hidden"}(0,l),O={}}).catch(e=>{E(s,l,!0)})}),j.addEventListener("buttonclick",function(e){E(s,l)}),F.inject(R),W.inject(G),j.inject(k),G.inject(_),k.inject(_),null!=o&&o()},function(e,t,n){var i=u.NOTIFICATION_VIEW_MESSAGE;null!=t&&(null!=t["EVPErr#410"]?(i=u.NOTIFICATION_VIEW_MESSAGE_REASON+t["EVPErr#410"],widget.body.empty()):null!=t["EVPErr#DB404"]?i=u.NOTIFICATION_VIEW_MESSAGE_REASON+t["EVPErr#DB404"]:null!=t["EVPErr#409"]?i=u.NOTIFICATION_VIEW_MESSAGE_REASON+t["EVPErr#409"]:null!=t["EVPErr#405"]&&(i=u.NOTIFICATION_VIEW_MESSAGE_REASON+t["EVPErr#405"])),m("error",i,u.ERROR)})}function E(e,t,n){var i=document.getElementsByClassName("wux-controls-switch");for(var a in i)isNaN(a)||""==i[a].getParent().style.backgroundColor||(i[a].getParent().style.backgroundColor="");t.cancelChanges(),!0!==n&&m("success",u.NOTIFICATION_CANCEL_MESSAGE,u.CANCEL),document.getElementById("widget-footer").style.visibility="hidden"}function f(e,t){var n=d.getApplicationConfiguration("app.build.isCloud");require(["DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices"],function(i){i.getPlatformServices({onComplete:function(t){var i=widget.getValue("x3dPlatformId");for(var a in"false"===n&&(i="OnPremise"),t)if(t[a].platformId==i){widget.setValue("myapps",t[a]["3DCompass"]),widget.setValue("eventpublishing",t[a].eventpublishing),widget.setValue("passport",t[a]["3dpassportnta"].replace(/\/?$/,"/")),widget.setValue("3DSpace",t[a]["3DSpace"]),"true"===n&&widget.setValue("clm",t[a].credentiallcmgt),t[a].displayName&&widget.setTitle("Public Event Administration");break}e()},onFailure:function(e){t(new Error("Could not fetch base URLs of services"))}})})}function m(e,t,n){l.addNotif({level:e,message:t,title:n})}s.setNotificationManager(l),s.setStackingPolicy(5);var v={onLoad:function(){widget.setTitle(u.EVPTITLE),new Promise(function(e,t){f(e,t),function(e,t){require(["DS/WAFData/WAFData","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices"],function(n,i){var a=d.getApplicationConfiguration("app.urls.myapps");a&&a.lastIndexOf("/")!==a.length-1&&(a+="/");var o=a+"resources/AppsMngt/environment",r=widget.getValue("x3dPlatformId"),s=[];"true"===d.getApplicationConfiguration("app.build.isCloud")&&i.getGrantedRoles(function(i){i.forEach(function(i){if("PFI"===i.id&&UWA.is(i.platforms,"array")){var a=i.platforms;n.authenticatedRequest(o,{headers:{Accept:"application/json","Content-Type":"application/json"},method:"GET",type:"json",onComplete:function(t){for(var n=0;n<t.cstorage.length;n++)if(a.includes(t.cstorage[n].id)){var i={label:t.cstorage[n].displayName,value:t.cstorage[n].id};s.push(i)}var o={type:"list",name:"collab-storage",label:u.PREF_TENANT,defaultValue:r,options:s,onchange:"onStorageChange"};widget.addPreference(o),widget.setValue("collab-storage",widget.getValue("x3dPlatformId")),e()},ontimeout:function(e){t("Promise Rejected")},onFailure:function(e,n,i){t("Promise Rejected")}})}})})})}(e,t)}).then(function(e){v.createGridView()}).catch(e=>{console.log(e)})},onStorageChange:function(e){widget.setValue("x3dPlatformId",widget.getValue("collab-storage"))},onRefresh:function(){widget.setBody({tag:"div",class:"spinner spinning fade in",styles:{transform:"translate3d(0px, 0px, 0px)",marginTop:"20%",marginLeft:"45%",display:"inline-block"},html:[{tag:"span",class:"spinner-bar"},{tag:"span",class:"spinner-bar spinner-bar1"},{tag:"span",class:"spinner-bar spinner-bar2"},{tag:"span",class:"spinner-bar spinner-bar3"},{tag:"span",class:"text",text:u.LOADINGMESSAGE}]}),new Promise(function(e,t){f(e,t)}).then(function(e){new Promise(function(e,t){v.createGridView(e,t)}).then(function(e){m("info",u.NOTIFICATION_REFRESH_MESSAGE,u.REFRESH)})}).catch(e=>{console.log(e)})},createGridView:function(e,t){p(e)},gridDataView:function(e,t){var n={buildGridData:function(e,t){a.getEventEnablementData.call(this,e,t)}};return n.buildGridData(e,t),r.extend(n)}};return v});