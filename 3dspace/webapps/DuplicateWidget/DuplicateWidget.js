define("DS/DuplicateWidget/converters/Converters",[],function(){"use strict";return{groupActionToNodeAction:function(e){return[EnoTreeNodeAction.Undefined,EnoTreeNodeAction.Duplicate,EnoTreeNodeAction.Duplicate,EnoTreeNodeAction.DuplicateWDrw,EnoTreeNodeAction.Reuse,EnoTreeNodeAction.Exclude,EnoTreeNodeAction.Branch,EnoTreeNodeAction.Branch][e]},groupActionToRecursive:function(e){return e===EnoDupGroupAction.DuplicateTree||e===EnoDupGroupAction.BranchTree},groupStringToAction:function(e){switch(e){case"Duplicate":return EnoDupGroupAction.Duplicate;case"Reuse":return EnoDupGroupAction.Reuse;case"Exclude":return EnoDupGroupAction.Exclude;case"DuplicateDrw":return EnoDupGroupAction.DuplicateWDrw;case"DuplicateTree":return EnoDupGroupAction.DuplicateTree;case"Branch":return EnoDupGroupAction.Branch;case"BranchTree":return EnoDupGroupAction.BranchTree}return EnoDupGroupAction.Invalid},groupActionToString:function(e){switch(e){case EnoDupGroupAction.Duplicate:return"Duplicate";case EnoDupGroupAction.Reuse:return"Reuse";case EnoDupGroupAction.Exclude:return"Exclude";case EnoDupGroupAction.DuplicateWDrw:return"DuplicateDrw";case EnoDupGroupAction.DuplicateTree:return"DuplicateTree";case EnoDupGroupAction.Branch:return"Branch";case EnoDupGroupAction.BranchTree:return"BranchTree"}return""}}}),define("DS/DuplicateWidget/utils/EventRelay",["UWA/Controls/Abstract","DS/LifecycleCmd/Dictionary"],function(e,t){"use strict";return e.extend({defaultOptions:{source:null,eventMap:[],batchMode:!1,dispatcher:function(e,t){console.log("Supply dispatcher to EventRelay!")}},init:function(e){this._parent(e),this.options.source&&this.addSource(this.options.source),this._cache=new t},addSource:function(e){var t=this;this.options.eventMap.forEach(function(i){e.addEvent(i.from,function(e){t.options.batchMode?t._cacheEvent(i.to||i.from,i.batchTransform,e):t.options.dispatcher(i.to||i.from,i.transform?i.transform(e):e)})})},setBatchMode:function(e){this.options.batchMode=e,this.options.batchMode||this._dispatchCache()},_cacheEvent:function(e,t,i){var n=this._cache.find(e);n||(n={data:[],transform:t},this._cache.add(e,n)),n.data.push(i)},_dispatchCache:function(){var e=this;this._cache.each(function(t,i){e.options.dispatcher(t,i.transform?i.transform(i.data):i.data)}),this._cache.clear()}})}),define("DS/DuplicateWidget/AlertBar",["UWA/Controls/Abstract"],function(e){"use strict";return e.extend({name:"alertBar",defaultOptions:{autoHide:!0,autoHideDelay:3e4},init:function(e){this._parent(e),this.buildSkeleton()},buildSkeleton:function(){if(!this.elements.container){var e=this;this.elements.container=UWA.createElement("div",{class:this.getClassNames()}),UWA.createElement("span",{class:"fonticon fonticon-info "+this.getClassNames("-info")}).inject(this.elements.container),this.elements.text=UWA.createElement("span",{class:this.getClassNames("-text")}).inject(this.elements.container),UWA.createElement("span",{class:"fonticon fonticon-cancel "+this.getClassNames("-close")}).inject(this.elements.container),this.elements.container.addEventListener("click",function(){e.hide()}),this.hide()}},show:function(e){var t=this;this.elements.text.setContent(e),this.elements.container.addClassName("alertBar-visible"),setTimeout(function(){t.elements.container.addClassName("alertBar-height")},100),this.options.autoHide&&(this.timer=setTimeout(function(){t.timer=null,t.hide()},this.options.autoHideDelay))},hide:function(){this.timer&&(clearTimeout(this.timer),this.timer=null),this.elements.container.removeClassName("alertBar-visible"),this.elements.container.removeClassName("alertBar-height")}})});var EnoDupTitleSelectionCriteria={Undefined:0,Contains:1,NotContains:2};define("DS/DuplicateWidget/models/SelectionModel",["UWA/Controls/Abstract"],function(e){"use strict";return e.extend({TitleCriteria:EnoDupTitleSelectionCriteria.Contains,TitleString:"",TypeMatch:[],StateMatch:[],_TypeSelected:[],_StateSelected:[],addSelection:function(){this.dispatchEvent("OnAddSelection",this)},removeSelection:function(){this.dispatchEvent("OnRemoveSelection",this)},clearSelection:function(){this.dispatchEvent("OnClearSelection")}})}),define("DS/DuplicateWidget/utils/TreeNodeCache",["UWA/Controls/Abstract","DS/LifecycleCmd/Dictionary"],function(e,t){"use strict";return e.extend({defaultOptions:{nodeModelFactory:function(){return console.error("You must supply factory to TreeNodeCache"),null}},init:function(e){this._parent(e),this._cache=new t},resolve:function(e){var t=this._createKey(e.nodeId,e.occId),i=this._getFromCache(t);return i||this._createAndCache(e,t)},_createKey:function(e,t){return e+"o"+t},_getFromCache:function(e){return this._cache.find(e)},_createAndCache:function(e,t){var i=this.options.nodeModelFactory(e);return this._cache.add(t,i),i}})}),define("DS/DuplicateWidget/utils/UpdateSelectionModelHStrategy",["UWA/Controls/Abstract"],function(e){"use strict";return e.extend({init:function(e){this._parent(e),this.controls={},this.controls.titleEdit=e.idns.getElById("titleEditH"),this.controls.containsRadio=e.idns.getElById("containsRadioH"),this.controls.notContainsRadio=e.idns.getElById("notContainsRadioH")},getGroupMatch:function(e){return this.options.groupList.getIsGroupUnused(e)?this.options.groupList.getGroupAll(e):this.options.groupList.getGroupSelected(e)},_getGroupSelected:function(e){return this.options.groupList.getGroupSelected(e)},updateUIFromModel:function(e){var t=e.TitleCriteria;this.options.groupList.setGroupSelected("type",e._TypeSelected),this.options.groupList.setGroupSelected("state",e._StateSelected),this.controls.titleEdit.wuxControl.value=e.TitleString,this.controls.containsRadio.wuxControl.checkFlag=t===EnoDupTitleSelectionCriteria.Contains,this.controls.notContainsRadio.wuxControl.checkFlag=t===EnoDupTitleSelectionCriteria.NotContains}})});var duplicateWidgetEvents={includeAllDrwOptionSet:"duplicate.incdrw.option.set",includeAllDrwOptionOnChange:"duplicate.incdrw.option.change",includeAllDesignTablesOptionOnChange:"duplicate.incdt.option.change",displayDuplicateAlert:"Lifecycle.Duplicate.Alert"};define("DS/DuplicateWidget/WidgetEvents",[],function(){return{}}),define("DS/DuplicateWidget/utils/RegExReplace",[],function(){"use strict";return{replace:function(e,t,i){return e.replace(new RegExp(function(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}(t),"gi"),i)}}}),define("DS/DuplicateWidget/UIUpdate",["UWA/Controls/Abstract"],function(e){"use strict";return e.extend({init:function(){this.elements=[]},addElement:function(e,t){var i=null;"function"==typeof t.enable?i=t.enable:"function"==typeof t&&(i=t),this.elements.push({element:UWA.is(UWA.Element,e)?e:UWA.extend(e),enable:i})},update:function(e){this.elements.forEach(function(t){t.enable&&(t.element.wuxControl?t.element.wuxControl.disabled=!t.enable(e):t.element.disabled=!t.enable(e))})}})}),define("DS/DuplicateWidget/utils/UpdateSelectionModelVStrategy",["UWA/Controls/Abstract"],function(e){"use strict";return e.extend({init:function(e){this._parent(e),this.controls={},this.controls.titleEdit=e.idns.getElById("titleEdit"),this.controls.containsRadio=e.idns.getElById("containsRadio"),this.controls.notContainsRadio=e.idns.getElById("notContainsRadio")},getGroupMatch:function(e){return this.options.groupList.getIsGroupUnused(e)?this.options.groupList.getGroupAll(e):this.options.groupList.getGroupSelected(e)},_getGroupSelected:function(e){return this.options.groupList.getGroupSelected(e)},updateUIFromModel:function(e){var t=e.TitleCriteria;this.options.groupList.setGroupSelected("type",e._TypeSelected),this.options.groupList.setGroupSelected("state",e._StateSelected),this.controls.titleEdit.wuxControl.value=e.TitleString,this.controls.containsRadio.wuxControl.checkFlag=t===EnoDupTitleSelectionCriteria.Contains,this.controls.notContainsRadio.wuxControl.checkFlag=t===EnoDupTitleSelectionCriteria.NotContains}})});var GrpSelListNodeType={GroupRoot:1,GroupEntry:2},GrpNodeChecked={Checked:1,Unchecked:2,Mixed:3};define("DS/DuplicateWidget/controls/GroupSelectionList",["UWA/Controls/Abstract","DS/Controls/Toggle"],function(e,t){"use strict";var i=e.extend({name:"groupSelectionListNode",defaultOptions:{label:"",id:"you must set id",checked:!0},init:function(e){this.children=[],this._parent(e),this.type=this.options.type,this.label=this.options.label,this.id=this.options.id,this.checked=this.options.checked?GrpNodeChecked.Checked:GrpNodeChecked.Unchecked,this._isSyncing=!1,this._buildLayout()},addChild:function(e){var t=this;this.children.push(e),e.addEvent("onChecked",function(e){t._syncCheck()})},getSelected:function(){return this.children.filter(function(e){return e.checked===GrpNodeChecked.Checked}).map(function(e){return e.id})},getAll:function(){return this.children.map(function(e){return e.id})},getIsUnused:function(){return this.type===GrpSelListNodeType.GroupRoot&&this.checked===GrpNodeChecked.Unchecked},setSelected:function(e){this.children.forEach(function(t){t.setChecked(!!e.find(function(e){return e===t.id}))})},_buildLayout:function(){this.elements.container=new UWA.Element("div",{class:this.type===GrpSelListNodeType.GroupRoot?this.getClassNames("-root"):this.getClassNames("-child")}),this.elements.container.addClassName(this.name)},_render:function(e){for(var i=this;this.elements.container.hasChildNodes();)this.elements.container.removeChild(this.elements.container.lastChild);this.elements.container.inject(e);var n=new UWA.Element("div",{class:this.getClassNames("-content")});n.addClassName(this.type===GrpSelListNodeType.GroupRoot?this.getClassNames("-content-root"):this.getClassNames("-content-child")),n.inject(this.elements.container),this.elements.check=new t({class:this.getClassNames("-check"),type:"checkbox",label:this.label}),this.elements.check.addEventListener("change",function(e){i._isSyncing||i._setCheckedInternal(i.elements.check.checkFlag)}),this.elements.check.checkFlag=this.checked===GrpNodeChecked.Checked,this.elements.check.inject(n),this.children.forEach(function(t){t._render(e)})},_syncCheck:function(){this._isSyncing=!0;var e=this.children.reduce(function(e,t){return t.checked===GrpNodeChecked.Checked?e+1:e},0),t=!1;this.elements.check.mixedState=!1,0===e?(t=this.checked!==GrpNodeChecked.Unchecked,this.checked=GrpNodeChecked.Unchecked,this.elements.check.checkFlag=!1):e===this.children.length?(t=this.checked===GrpNodeChecked.Unchecked,this.checked=GrpNodeChecked.Checked,this.elements.check.checkFlag=!0):(t=this.checked===GrpNodeChecked.Unchecked,this.checked=GrpNodeChecked.Mixed,this.elements.check.checkFlag=!0,this.elements.check.mixedState=!0),t&&this._updateChildrenLabelState(this.checked===GrpNodeChecked.Unchecked),this._isSyncing=!1},_updateChildChecks:function(e){this.children.forEach(function(t){t.setChecked(e)})},_setCheckedInternal:function(e,t){var i=e?GrpNodeChecked.Checked:GrpNodeChecked.Unchecked;return this.checked!==i&&(this.checked=i,this.dispatchEvent("onChecked",this.checked===GrpNodeChecked.Checked),null==t&&!0!==t&&this.type===GrpSelListNodeType.GroupRoot&&(this._updateChildChecks(e),this._updateChildrenLabelState(this.checked===GrpNodeChecked.Unchecked)),!0)},_updateChildrenLabelState:function(e){this.children.forEach(function(t){t._updateLabelState(e)})},_updateLabelState:function(e){var t=this.elements.check.getContent().querySelector(".wux-label");if(t){var i=UWA.extendElement(t);e?i.addClassName("groupSelectionListNode-unused"):i.removeClassName("groupSelectionListNode-unused")}},setChecked:function(e,t){this._setCheckedInternal(e,t)&&(this.elements.check.checkFlag=e)}});return e.extend({name:"groupSelectionList",init:function(e){this.groups=[],this._parent(e),this._buildLayout()},addGroup:function(e,t){var n=new i({type:GrpSelListNodeType.GroupRoot,label:e.label?e.label:e.id,id:e.id});t&&t.forEach&&t.forEach(function(e){n.addChild(new i({type:GrpSelListNodeType.GroupEntry,label:e.label?e.label:e.id,id:e.id}))}),this.groups.push(n),this._render()},getGroupSelected:function(e){var t=this._getGroupById(e);return t?t.getSelected():[]},getGroupAll:function(e){var t=this._getGroupById(e);return t?t.getAll():[]},getIsGroupUnused:function(e){var t=this._getGroupById(e);return t?t.getIsUnused():[]},setGroupSelected:function(e,t){var i=this._getGroupById(e);i&&i.setSelected(t)},_getGroupById:function(e){return this.groups.find(function(t){return t.id===e})},_buildLayout:function(){var e={class:this.getClassNames("-root")};this.elements.container=new UWA.Element("div",UWA.merge(this.options,e)),this._render()},_render:function(){for(;this.elements.container.hasChildNodes();)this.elements.container.removeChild(this.elements.container.lastChild);var e=this.elements.container;this.groups.forEach(function(t){t._render(e)})}})}),define("DS/DuplicateWidget/ExpandReqBuilder",["UWA/Controls/Abstract"],function(e){"use strict";return e.extend({select_rel:["physicalid","ds6w:type","ds6w:label","matrixtxt","ro.plminstance.V_treeorder"],select_rel_federated:["ro.plminstance.V_treeorder"],select_bo:["physicalid","ds6w:type","ds6w:reservedBy","ds6w:globalType","ds6w:label","ds6wg:revision","ds6w:description","ds6w:responsible","ds6w:modified","ds6w:created","ds6w:identifier","ds6w:reserved","ds6wg:PLMReference.V_isLastVersion","ds6w:status","ds6w:cadMaster","ds6wg:EnterpriseExtension.V_PartNumber"],select_bo_federated:[],compute_select_bo:["thumbnail_2d","icon"],init:function(e,t){if(this.getFilterSpec=function(){return{hasFilter:!1}},!e)return void console.warn("Duplicate: Missing API to retrieve current filter");this.operationType=t||"duplicate";let i=null;i=e&&e._biFilter&&e._biFilter.hasFilter?e._biFilter.hasFilter.bind(e._biFilter):e&&e.hasFilter?e.hasFilter.bind(e):()=>!1;let n=null;n=e&&e._biFilter&&e._biFilter.GetFilterSpec?e._biFilter.GetFilterSpec.bind(e._biFilter):e&&e.GetFilterSpec?e.GetFilterSpec.bind(e):()=>({hasFilter:!1}),i&&n?this.getFilterSpec=function(e){var t=i(e);if(t&&!0===t.hasFilter){var o=n(e,{V1:!0});if(o)return{hasFilter:!0,filterSpec:o}}return{hasFilter:!1}}:console.warn("Duplicate: Missing API to retrieve current filter")},isFiltered:function(e){return this.getFilterSpec(e).hasFilter},_buildPSEExpandDataNew:function(e){return{paths:[[e]],root_path_physicalid:[[e]],fcs_url_mode:"REDIRECT",expand_iter:"-1",no_type_filter_rel:["XCADBaseDependency"],"q.iterative_filter_query_bo":'[ds6w:globalType]:"ds6w:Document" OR [ds6w:globalType]:"ds6w:Part"'}},_buildPSEExpandData:function(e){return{intent:"explore_2D",debug:!1,roots:[{id:e}],level:"-1",source:"cstorage",authored:!0,no_type_filter_rel:["XCADBaseDependency"],"q.iterative_filter_query_bo":'[ds6w:globalType]:"ds6w:Document" OR [ds6w:globalType]:"ds6w:Part"'}},_buildExpandData:function(e){return{label:this._genUID(),root_physicalid:e,select_rel:this.select_rel,compute_select_bo:this.compute_select_bo,select_bo:this.select_bo,expand_iter:"-1","q.iterative_filter_query_bo":'[ds6w:globalType]:"ds6w:Document" OR [ds6w:globalType]:"ds6w:Part"',no_type_filter_rel:["XCADBaseDependency"]}},_buildFilteredExpandData:function(e){var t={select_rel:this.select_rel,compute_select_bo:this.compute_select_bo,synthesis_mode:"occurrence",select_bo:this.select_bo,label:this._genUID()};return UWA.merge(t,e.CVQuery)},build:function(e,t,i){if(!t&&i)return{URI:"/resources/enopad/lwc/expand",data:this._buildPSEExpandData(e)};if(t){var n=this.getFilterSpec(e);return n.hasFilter?{URI:"/cvservlet/multiexpand",data:this._buildFilteredExpandData(n.filterSpec)}:{URI:"/cvservlet/expand",data:this._buildExpandData(e)}}var o={roots:[]};return o.roots.push(e),{URI:"/resources/lifecycle/expand/db",data:o}},buildFederated:function(e,t,i){let n="";var o=this.getFilterSpec(e);return o.hasFilter&&(n=JSON.stringify(o.filterSpec)),{URI:"/resources/lifecycle/expand/federated",data:{command:this.operationType,ids:[e],authoring:!t,filter:n,select_bo:this.select_bo_federated,select_rel:this.select_rel_federated,enableProto:i}}},_genUID:function(){return"DUP-"+(new Date).getMilliseconds()+"-"+Math.random()}})});var EnoDupApplyTextPos={Before:0,After:1},EnoDupGroupAction={Duplicate:1,DuplicateTree:2,DuplicateWDrw:3,Reuse:4,Exclude:5,Branch:6,BranchTree:7};define("DS/DuplicateWidget/models/TreeActionsModel",["UWA/Controls/Abstract"],function(e){"use strict";return e.extend({GroupAction:EnoDupGroupAction.Duplicate,Text:"",ApplyTextToChildren:!1,FindText:"",ReplaceText:"",ApplyToAll:!1,ApplyTextPos:EnoDupApplyTextPos.Before,init:function(){this.actions=[]},getActions:function(){return this.actions},setActions:function(e){this.actions=[...e.values()]},applyAction:function(){this.dispatchEvent("OnApplyAction",this)},applySelectionAction:function(e){this.dispatchEvent("OnApplySelectionAction",e)},applyText:function(){this.ApplyTextPos===EnoDupApplyTextPos.Before?this.applyAddPrefixText():this.applyAddPostfixText()},applyAddPrefixText:function(){this.dispatchEvent("OnAddPrefixText",this)},applyAddPostfixText:function(){this.dispatchEvent("OnAddPostfixText",this)},applyReplace:function(){this.dispatchEvent("OnReplace",this)},reset:function(){this.dispatchEvent("OnReset",this)}})}),define("DS/DuplicateWidget/utils/IdNs",["UWA/Controls/Abstract","DS/LifecycleServices/HTMLTemplating"],function(e,t){"use strict";return e.extend({init:function(e,t){this.container=e,this.idPfx=t},getPfx:function(){return this.idPfx},getElById:function(e){return UWA.extendElement(this.container.querySelector("#"+this.idPfx+e))},elementFromTemplate:function(e,i,n,o){return UWA.extendElement(t.ElementFromTemplate(e,i,n,this.idPfx,o))}})}),define("DS/DuplicateWidget/ExtensibilityConstants",[],function(){return{ExpandNodeCapabilites:{Undefined:0,Duplicate:1,Reuse:2,Exclude:3,ChangeTitle:4,FollowParent:5,Branch:6,Max:1e5},OperationCapabilites:{AddPrefix:"045f08a0-5628-48e6-9f81-3822e3505378",Expand:"84a058e4-4e05-4fc3-8c2f-ed137631d5ae",IncludeStructrualObjects:"23216a08-c15f-4955-853d-79a5d194d04b",RelatedObjects:"d4b35923-c853-4522-81ae-cac5e67ac260",ClearConfigurations:"d5db4946-a604-4471-97d0-cd4664154a61"}}});var EnoDupPanelLayout={Vertical:0,Horizontal:1};Object.freeze(EnoDupPanelLayout),define("DS/DuplicateWidget/DupToolsPanel",["UWA/Controls/Abstract","DS/Windows/Panel","i18n!DS/LifecycleWidget/assets/nls/LifecycleWidgetNls","css!DS/DuplicateWidget/DuplicateWidget"],function(e,t,i){"use strict";return e.extend({defaultOptions:{initialDockArea:WUXDockAreaEnum.RightDockArea},init:function(e){var i=this;window.c145ae486a7011e9a9231681be663d3e&&(e.identifier=void 0),this._parent(e),this._initializedUI=!1,this.model=this.options.model,this.immersiveFrame=this.options.immersiveFrame,this.panel=new t({identifier:e.identifier,title:this.getTitle(),content:this.getContent(),currentDockArea:this.options.initialDockArea,immersiveFrame:this.immersiveFrame,resizableFlag:!1,allowedDockAreas:this.options.dockAreas||WUXDockAreaEnum.LeftDockArea|WUXDockAreaEnum.RightDockArea|WUXDockAreaEnum.TopDockArea,closeButtonFlag:!1}),this.panel.addEventListener("prePlaceChange",function(e){i._onPrePlaceChange(e),i.onPrePlaceChange(e)}),this.panel.addEventListener("startWindowDrag",function(e){i.onStartWindowDrag(e)}),this._initialUpdate(this._currentLayout())},getContent:function(){return new UWA.Element("div",{html:"<p>TODO:Panel content</p>"})},getTitle:function(){return"panel title"},haveStoredPlacement:function(){return null!=this.panel._getPositionFromPreferences()},dock:function(e){this.immersiveFrame.dockWindow(this.panel,e)},onStartWindowDrag:function(e){},onPrePlaceChange:function(e){},_onPrePlaceChange:function(e){var t=this._isVerticalLayout(e.dsModel.currentDockArea)?EnoDupPanelLayout.Vertical:EnoDupPanelLayout.Horizontal;this._initializedUI?this._isVerticalLayout(e.dsModel.currentDockArea)!=this._isVerticalLayout(e.options.previousPlace.currentDockArea)&&this._setLayout(t):(this._initialUpdate(t),this._initializedUI=!0)},_currentLayout:function(){return this._isVerticalLayout(this.panel.currentDockArea)?EnoDupPanelLayout.Vertical:EnoDupPanelLayout.Horizontal},_isHorzLayout:function(e){return e==WUXDockAreaEnum.TopDockArea||e==WUXDockAreaEnum.BottomDockArea},_isVerticalLayout:function(e){return!this._isHorzLayout(e)},_setLayout:function(e){},_initialUpdate:function(e){}})}),define("DS/DuplicateWidget/DataFilterer",["UWA/Class"],function(e){"use strict";return e.extend({init:function(){this.filters=[]},addFilter:function(e){this.filters.push(e)},filter:function(e){return e.filter(function(e){return this.filters.every(function(t){return t(e)})},this)}})}),define("DS/DuplicateWidget/ComputeReusableService",["UWA/Core","UWA/Controls/Abstract","UWA/Class/Promise","DS/LifecycleCmd/Set","DS/LifecycleCmd/Dictionary","DS/LifecycleServices/LifecycleServices"],function(e,t,i,n,o,s){"use strict";return t.extend({computationfailure:!1,init:function(e){this.nodes=new o,this.operationDetail="",this.reusables=new n,this.handleError=e&&e.handleError||!1},setOperationDetail:function(e){this.operationDetail=e},addNode:function(e,t,i){this.nodes.add(e,{physicalid:e,rootid:t,children:i})},computeAsync:function(e){var t=this;return new UWA.Class.Promise(function(i,n){"OnPremise"!==e?i():t._postPromise(e,t._createPayload()).then(function(e){t._parseResponse(e),i()},function(e){t.handleError?(console.log("ComputeReusableService translation failed: ",e),t.computationfailure=!0,i()):n(e)})})},getReusedSet:function(){var e=new n;return this.reusables.each(t=>{e.add(t)}),e},_createPayload:function(){var e=[];this.nodes.each(function(t,i){e.push(i)});var t={data:e};return this.operationDetail&&(t.operationDetail=this.operationDetail),t},_parseResponse:function(e){return e&&e.status&&e.results?"success"!=e.status?(console.log("ComputeReusableService computation from server: "+e.status),void(this.computationfailure=!0)):(e.results.forEach(e=>{this.reusables.add(e)}),void this.reusables.each(e=>{this._propagateResults(e)})):(console.log("ComputeReusableService invalid response from server"),void(this.computationfailure=!0))},_propagateResults:function(e){var t=this.nodes.find(e).children;t&&t.forEach(e=>{this.reusables.contains(e)||(this.reusables.add(e),this._propagateResults(e))})},_postPromise:function(e,t){return new UWA.Class.Promise(function(i,n){s.post(e,"/resources/lifecycle/duplicate/reusable_objects",t,function(e){i(e)},function(e){n(e)})})}})}),define("DS/DuplicateWidget/TreeActions",[],function(){return{}}),define("DS/DuplicateWidget/TreeActionsUI",[],function(){return{}}),define("DS/DuplicateWidget/controls/PopupControl",["UWA/Controls/Abstract","DS/WidgetServices/WidgetServices"],function(e,t){"use strict";return e.extend({name:"PopupControl",defaultOptions:{createContent:function(){return UWA.createElement("div")}},init:function(e){this._parent(e),this.createPopupContent=this.options.createContent;var i=t.getWidgetBody(),n=i.getParent("body");this.parentBody=n||i},showPopup:function(e){this.container=this.container||this._createUI();var t=this;this._positionPopup(e.parentEl),setTimeout(function(){t._showPopup()},50)},_createUI:function(){var e=UWA.merge({position:"absolute",display:"none",top:0,left:0,"z-index":99999,background:"green",borderWidth:"1px",borderColor:"#d0c0c0",borderStyle:"solid"},this.options.styles),t=UWA.createElement("div",{class:this.getClassNames("_container"),styles:e});this.createPopupContent().inject(t),t.inject(this.parentBody);var i=this;return this.parentBody.addEvent("click",function(e){i.currentPopup&&!i.currentPopup.contains(e.target)&&i._hidePopup()}),t},hidePopup:function(){this._hidePopup()},_positionPopup:function(e){var t=e.getBoundingClientRect();this.container.setStyle("left",t.left+"px"),this.container.setStyle("top",t.top+t.height+"px")},_showPopup:function(){this.currentPopup=this.container,this.container.setStyle("display","block");var e=this;setTimeout(function(){e.dispatchEvent("onShow",e.currentPopup)},10)},_hidePopup:function(){this.currentPopup&&(this.dispatchEvent("onHide",this.currentPopup),this.currentPopup.setStyle("display","none"),this.currentPopup=null)}})});var EnoTreeNodeAction={Undefined:0,Duplicate:1,DuplicateWDrw:2,Exclude:3,Reuse:4,Branch:5};function getTreeNodeDefaultSupportedActions(e,t){var i=[EnoTreeNodeAction.Duplicate],n=[EnoTreeNodeAction.Duplicate,EnoTreeNodeAction.DuplicateWDrw],o=[EnoTreeNodeAction.Duplicate,EnoTreeNodeAction.Reuse,EnoTreeNodeAction.Exclude,EnoTreeNodeAction.DuplicateWDrw],s=[EnoTreeNodeAction.Duplicate,EnoTreeNodeAction.Reuse,EnoTreeNodeAction.Exclude];return t?e?n:o:e?i:s}define("DS/DuplicateWidget/models/TreeNodeModel",["UWA/Controls/Abstract","DS/LifecycleServices/AssemblyJson","DS/DuplicateWidget/ExtensibilityConstants"],function(e,t,i){"use strict";return e.extend({init:function(e,t,n,o,s){if(this.treeNode=e,this.assembly=n,this.treeList=o,this.isRoot=t,this.assyNode=null,this.nodeFactory=s,this.defaultAction=EnoTreeNodeAction.Duplicate,this.supportedActionsV5=getTreeNodeDefaultSupportedActions(this.isRoot,!0),this.supportedActions=getTreeNodeDefaultSupportedActions(this.isRoot,!1),this._activeSupportedActions=void 0,t?(this.dupActionToIndex=[-1,0,1,-1,-1,-1],this.indexToDupAction=[EnoTreeNodeAction.Duplicate,EnoTreeNodeAction.DuplicateWDrw]):(this.dupActionToIndex=[-1,0,3,2,1,-1],this.indexToDupAction=[EnoTreeNodeAction.Duplicate,EnoTreeNodeAction.Reuse,EnoTreeNodeAction.Exclude,EnoTreeNodeAction.DuplicateWDrw]),this.nodeCaps=[i.ExpandNodeCapabilites.ChangeTitle],this.assembly){var r=this.getInitialSupportedActions();r.actions&&this.setSupportedActions(r.actions),r.actionsV5&&this.setSupportedActions(r.actionsV5,{forV5:!0}),this.nodeCaps=this._getAssyNode().capabilites||this.nodeCaps;let e=this._getAssyNode().defaultAction;null!=e&&(this.defaultAction=e);let t=this._activeSupportedActions,i=this.getSupportedActions();i.includes(this.defaultAction)||(this.defaultAction=i[0]),this._activeSupportedActions=t}this._canEditTitle=!!this.nodeCaps.find(e=>e==i.ExpandNodeCapabilites.ChangeTitle),this._isV5=void 0,this.orgValues={title:this.getLabel(),action:this.defaultAction}},getActionComboIndex:function(e){return this._activeSupportedActions&&!this._activeSupportedActions.includes(e)?-1:this.dupActionToIndex[e]},setAction:function(e){if(!this.isConnectedToParent()){var t=this.getActionComboIndex(e);if(-1!==t){var i=this.getAction();e!==i&&(this.treeList.setDropdownSelectionIf([this.treeNode._treeNode],t,"advancedDuplicateAction"),this.dispatchEvent("onDupActionChange",{node:this,oldAction:i,newAction:e}))}}},getAction:function(){var e=this.treeList.getNodeDropdownSelectedIndex(this.treeNode._treeNode,"advancedDuplicateAction");return this.indexToDupAction[e]},getActionFromIndex:function(e){return this.indexToDupAction[e]},getSupportedActions:function(e){return e&&!0===e.forV5?(this._isV5=!0,this._activeSupportedActions=this.supportedActionsV5):(this._activeSupportedActions=this.supportedActions,this._isV5=!1),this._activeSupportedActions},setSupportedActions:function(e,t){var i=[EnoTreeNodeAction.Duplicate,EnoTreeNodeAction.Branch,EnoTreeNodeAction.Reuse,EnoTreeNodeAction.Exclude,EnoTreeNodeAction.DuplicateWDrw];let n=i.filter(t=>e.includes(t));if(this.isRoot){var o=[EnoTreeNodeAction.Duplicate,EnoTreeNodeAction.Branch,EnoTreeNodeAction.DuplicateWDrw];n=n.filter(e=>o.includes(e))}t&&!0===t.forV5?this.supportedActionsV5=n:this.supportedActions=n,void 0!==this._isV5&&(this._isV5&&t.forV5?this._activeSupportedActions=n:this._isV5||t.forV5||(this._activeSupportedActions=n)),this.dupActionToIndex=Array(6).fill(-1),this.indexToDupAction=[];var s=0;i.forEach(function(e){n.includes(e)&&(this.dupActionToIndex[e]=s,this.indexToDupAction.push(e),++s)},this)},getChildren:function(){var e=this.treeNode.getChildren().map(function(e){return this.nodeFactory(e)},this);return e||[]},getLabel:function(){return this.treeNode?this.treeNode._treeNode.options.label:""},getType:function(){return this._getAssyNode().typeRaw},getTypeNls:function(){return this.treeNode._treeNode.options.type},getMaturityNls:function(){return this.treeNode._treeNode.options.grid.maturityNls},getId:function(){return this.treeNode.nodeId},getOccId:function(){return this.treeNode.occId},isVisible:function(){return this.treeNode._treeNode.isVisible()},getDepth:function(){return this.treeNode._treeNode._nodeDepth},getNewTitle:function(){return this.treeNode._treeNode.getNewTitle()},setNewTitle:function(e){return this.treeNode._treeNode.setNewTitle(e)},select:function(){this.treeNode._treeNode.select()},unselect:function(){this.treeNode._treeNode.unselect()},expandAll:function(){this.treeNode._treeNode.expandAll()},expandn:function(e){this.treeNode._treeNode.expandNLevels({numberOfLevelsToExpand:e})},collapseAll:function(){this.treeNode._treeNode.collapseAll()},isSelected:function(){return this.treeNode._treeNode.isSelected()},isDisabled:function(){return this.treeNode._treeNode.disabled},isConnectedToParent:function(){return this._getAssyNode().connectToParent},getInitialSupportedActions:function(){return{actions:this._getAssyNode().supportedActions,actionsV5:this._getAssyNode().supportedActionsV5}},getDefaultAction:function(){return this.defaultAction},getCanEditTitle:function(){return this._canEditTitle},isHardDisabled:function(){return this.treeNode._treeNode.hardDisabled},setHardDisabled:function(e){this.treeNode._treeNode.hardDisabled=e},isUsingHardDisabledStyle:function(){return!this.treeNode._treeNode.disableHardDisabledStyle},setUseHardDisabledStyle:function(e){this.treeNode._treeNode.disableHardDisabledStyle=!e,e?this.treeNode._treeNode.dropdownList.advancedDuplicateAction.classList.add("hardDisabled-combo"):this.treeNode._treeNode.dropdownList.advancedDuplicateAction.classList.remove("hardDisabled-combo")},reset:function(){this.setNewTitle(this.orgValues.title),this.setAction(this.orgValues.action)},_getAssyNode:function(){return this.assyNode?this.assyNode:(this.assyNode=t.getNode(this.assembly,this.getId()),this.assyNode)}})}),define("DS/DuplicateWidget/expandTree/expand",["UWA/Controls/Abstract","DS/LifecycleServices/WebReq","DS/LifecycleServices/AssemblyJson","DS/DuplicateWidget/models/TreeNodeModel","DS/DuplicateWidget/ExtensibilityConstants","DS/LifecycleServices/LifecycleServicesSettings","DS/DuplicateWidget/ComputeReusableService","i18n!DS/DuplicateWidget/assets/nls/DuplicateWidgetNls"],function(e,t,i,n,o,s,r,a){"use strict";return e.extend({init:function(e){this.options=e},expand:async function(){return this.assemblies=[],this.nodeToRoot=new Map,this.roots=this.options.roots,this.obj2expandProviders=this.options.objId2ExpandProvider||new Map,this.filterReqFails=[],new UWA.Promise(async(e,t)=>{try{let i=await this.options.getAuthoringMode(),n=await this.expandStructures(this.options.securityContext,i);await this.computeResubleFromBL(this.assemblies),e({assemblies:this.assemblies,idCounters:n})}catch(e){console.error(e),t(e)}})},expandStructures:function(e,t){let i=[];this.roots.forEach(n=>{if(this.options.providerIdSet.has(n))i.push(this.expandStructure(n,e,t,!0));else{var o=this.options.objectsList.filter(e=>e.physicalid===n);i.push(this._createExpandData(o[0]))}});try{return new UWA.Promise((e,t)=>{UWA.Promise.all(i).then(t=>{let i={},n={nextNodeId:0,nextOccId:0};t.forEach(e=>{let t=this.expandDone(e,i)||{};n.nextNodeId=i.firstNodeId=t.nextNodeId,n.nextOccId=i.firstOccId=t.nextOccId}),e(n)}).catch(function(e){console.error(e),t(e)})})}catch(e){console.error(e),reject(e)}},expandStructure:function(e,t,i,n){if(n)return this.expandStructureFederatedPromise(e,t,i);var o=this;return this.expandStructurePromise(e,t,i).then(function(n){if(!n||!n.results||0!=n.results.length||i)return UWA.Promise.resolve(n);console.log("expandStructure: No data in results, retrying with authored (non-index)"),o.options.expandReqBuilder.isFiltered(e)&&(o.filterReqFails.push(e),o.options.showError(a.filteredExpandEmpty)),o.expandStructurePromise(e,t,!0).then(e=>UWA.Promise.resolve(e))}).then(function(i){return i&&"not_spported_query"===i.status?(console.log("query lifecycle/expand/db failed, retrying on enopad implementation"),o.expandStructurePromise(e,t,!0,!0)):UWA.Promise.resolve(i)}).catch(function(e){var t=a.expandFailed+": ";e.isTimeout?t+=a.connectionTimeout:t+=e?e.error?e.error:e:"",console.error("expand failed:",t),reject(t)})},expandDone:function(e,t){var n=s.get3DSpaceBaseUrl(this.options.tenant);if(!e.results){if(e.errorCode&&211===e.errorCode)throw a.expandFailed+": "+a.expandDataNotIndexed;if(e.errorMessage)throw e.errorMessage;throw a.expandFailed}let o=e?i.convertFromExpandFormat(e,Object.assign({returnIdCounters:!0,baseUrl:n},t)):{nodes:[]};if(e){e.federatedExpand||(o.legacyExpand=!0);let t=(e=>{let t=e.occurrences.filter(t=>t.occurrenceid===e.rootoccurrence).map(e=>e.nodeid)[0];return e.nodes.filter(e=>e.nodeid===t)[0]})(o);for(var r of(this.options.expandReqBuilder.isFiltered(t.physicalid)&&(this.filterReqFails.includes(t.physicalid)||(t.isFilteredRoot=!0)),o.nodes))r.physicalid!=t.physicalid&&this.nodeToRoot.set(r.physicalid,t.physicalid);this.assemblies=this.pruneAndCollectRoots(this.assemblies,o)}return o},pruneAndCollectRoots:function(e,t){const i=e=>{let t=e.occurrences.filter(t=>t.occurrenceid===e.rootoccurrence).map(e=>e.nodeid)[0];return e.nodes.filter(e=>e.nodeid===t).map(e=>e.physicalid)[0]},n=(e,t)=>e.nodes.filter(e=>e.physicalid===t).length>0;let o=[],s=i(t),r=!1;return e.forEach(e=>{r||(r=n(e,s))}),r||o.push(t),e.forEach(e=>{n(t,i(e))||o.push(e)}),o},expandStructurePromise:function(e,i,n,o){var r=this.options.expandReqBuilder.build(e,!n,o),a=s.get3DSpaceWSUrl(this.options.tenant,r.URI,null);return t.post(a,JSON.stringify(r.data),{securityContext:i,timeout:6e5})},expandStructureDelegatedPromise:function(e,i,n){var o=s.get3DSpaceWSUrl(this.options.tenant,"/resources/lifecycle/expand/delegated",null);let r={ids:[this.roots[0].id],ExpandUUID:this.options.expand.providerUUID};return t.post(o,JSON.stringify(r),{securityContext:e,timeout:6e5})},expandStructureFederatedPromise:function(e,i,n){return new UWA.Promise((o,r)=>{var d=this.options.expandReqBuilder.buildFederated(e,!n,!0),l=s.get3DSpaceWSUrl(this.options.tenant,d.URI,null);t.post(l,JSON.stringify(d.data),{securityContext:i,timeout:6e5}).then(e=>{e.federatedExpand=!0,o(e)}).catch(e=>{var t=a.expandFailed+": ";e.errorMessage&&e.error&&e.error.message&&e.error.message.includes("504")?t+=e.errorMessage+" "+a.dataIsTooLarge:e.isTimeout?t+=a.connectionTimeout:t+=e?e.error?e.error:e:"",console.error(t),r(t)})})},computeResubleFromBL:async function(e){let t=this.createComputeReusableSvc(e);await t.computeAsync(this.options.tenant);let i=t.getReusedSet();i.size>0&&this.setReusableDefaults(e,i)},createComputeReusableSvc:function(e){let t=new r({handleError:!0});return e.forEach(e=>{var i={};e.nodes.forEach(e=>{i[e.nodeid]=e.physicalid});var n={};e.occurrences.forEach(e=>{n[e.occurrenceid]=i[e.nodeid]});var o={};e.occurrencerelationships.forEach(e=>{var t=n[e.parent],i=n[e.child];o.hasOwnProperty(t)||(o[t]=[]),o[t].push(i)});var s=e.occurrences.filter(t=>t.occurrenceid===e.rootoccurrence).map(e=>e.nodeid)[0],r=i[s];e.nodes.forEach(e=>{t.addNode(e.physicalid,r,o[e.physicalid])})}),t},setReusableDefaults:function(e,t){e.forEach(e=>{e.nodes.forEach(e=>{t.contains(e.physicalid)&&(e.defaultAction=EnoTreeNodeAction.Reuse)})})},_createExpandData:function(e){return{results:[{attributes:[{name:"did",value:"0"},{name:"resourceid",value:e.physicalid||e.objectId},{name:"expand::providerUUID",value:""},{name:"ds6w:label",value:e["attribute[PLMEntity.V_Name]"]},{name:"physicalid",value:e.physicalid||e.objectId},{name:"ds6wg:revision",value:e.revision},{name:"ds6w:status",value:e.current},{name:"ds6w:cadMaster",value:e.cadMaster},{name:"ds6w:type",value:e.type},{name:"expand::capabilities",value:[6,3,2,4]},{name:"expand::defaultAction",value:6}]},{icon__default_thumbnail_2d:[{did:["0"],icon:e.imageUrl,thumbnail_2d:""}]},{path:["0"]}],federatedExpand:!0}}})});const getAssyRootNode=e=>{let t=e.occurrences.filter(t=>t.occurrenceid===e.rootoccurrence).map(e=>e.nodeid)[0];return e.nodes.filter(e=>e.nodeid===t)[0]};define("DS/DuplicateWidget/expandTree/duplicateExpand",["UWA/Controls/Abstract","DS/DuplicateWidget/ComputeReusableService","DS/LifecycleServices/WebReq","DS/LifecycleServices/AssemblyJson","DS/DuplicateWidget/models/TreeNodeModel","DS/LifecycleServices/LifecycleServicesSettings","i18n!DS/DuplicateWidget/assets/nls/DuplicateWidgetNls"],function(t,i,n,o,s,r,a){"use strict";return t.extend({init:function(e){this.options=e,this.options.showError=e.showError?showError:()=>{}},expand:async function(){return this.assemblies=[],this.roots=this.options.roots,this.obj2expandProviders=this.options.objId2ExpandProvider||new Map,this.filterReqFails=[],new UWA.Promise(async(e,t)=>{try{let i=await this.options.getAuthoringMode(),n=await this.expandStructures(this.options.securityContext,i);await this.computeResubleFromBL(this.assemblies),e({assemblies:this.assemblies,idCounters:n})}catch(e){let i=a.expandFailed+" : "+e;console.error(i),t(i)}})},expandStructures:function(e,t){let i=[];this.roots.forEach(n=>{let o=this.obj2expandProviders.has(n);i.push(this.expandStructure(n,e,t,o))});try{return new UWA.Promise((e,t)=>{UWA.Promise.all(i).then(t=>{let i={},n={nextNodeId:0,nextOccId:0};t.forEach(e=>{let t=this.expandDone(e,i)||{};n.nextNodeId=i.firstNodeId=t.nextNodeId,n.nextOccId=i.firstOccId=t.nextOccId}),e(n)}).catch(function(e){console.error(e),t(e)})})}catch(e){console.error(e),reject(e)}},expandStructure:function(e,t,i,n){if(n)return this.expandStructureFederatedPromise(e,t,i);var o=this;return this.expandStructurePromise(e,t,i).then(function(n){if(!n||!n.results||0!=n.results.length||i)return UWA.Promise.resolve(n);console.log("expandStructure: No data in results, retrying with authored (non-index)"),o.options.expandReqBuilder.isFiltered(e)&&(o.filterReqFails.push(e),o.options.showError(a.filteredExpandEmpty)),o.expandStructurePromise(e,t,!0).then(e=>UWA.Promise.resolve(e))}).then(function(i){return i&&"not_spported_query"===i.status?(console.log("query lifecycle/expand/db failed, retrying on enopad implementation"),o.expandStructurePromise(e,t,!0,!0)):UWA.Promise.resolve(i)}).catch(function(e){console.error("expand failed:",e);var t=a.expandFailed+": ";throw e.isTimeout?t+=a.connectionTimeout:t+=e?e.error?e.error:e:"",t})},expandDone:function(e,t){this.dispatchEvent("onExpandDone",{expandData:e,options:t});var i=r.get3DSpaceBaseUrl(this.options.tenant);if(!e)throw a.expandFailed;if(!e.results){if(e.errorMessage)throw e.errorMessage;throw a.expandFailed}let n=e?o.convertFromExpandFormat(e,Object.assign({returnIdCounters:!0,baseUrl:i},t)):{nodes:[]};if(e){if(!n)throw a.expandFailed;e.federatedExpand||(n.legacyExpand=!0);let t=getAssyRootNode(n);this.options.expandReqBuilder.isFiltered(t.physicalid)&&(this.filterReqFails.includes(t.physicalid)||(t.isFilteredRoot=!0)),this.assemblies=this.pruneAndCollectRoots(this.assemblies,n)}return n},pruneAndCollectRoots:function(e,t){const i=e=>{let t=e.occurrences.filter(t=>t.occurrenceid===e.rootoccurrence).map(e=>e.nodeid)[0];return e.nodes.filter(e=>e.nodeid===t).map(e=>e.physicalid)[0]},n=(e,t)=>e.nodes.filter(e=>e.physicalid===t).length>0;let o=[],s=i(t),r=!1;return e.forEach(e=>{r||(r=n(e,s))}),r||o.push(t),e.forEach(e=>{n(t,i(e))||o.push(e)}),o},expandStructurePromise:function(e,t,i,o){var s=this.options.expandReqBuilder.build(e,!i,o),a=r.get3DSpaceWSUrl(this.options.tenant,s.URI,null);return n.post(a,JSON.stringify(s.data),{securityContext:t,timeout:6e5})},expandStructureDelegatedPromise:function(e,t,i){var o=r.get3DSpaceWSUrl(this.options.tenant,"/resources/lifecycle/expand/delegated",null);let s={ids:[this.roots[0].id],ExpandUUID:this.options.expand.providerUUID};return n.post(o,JSON.stringify(s),{securityContext:e,timeout:6e5})},expandStructureFederatedPromise:function(t,i,o){return new UWA.Promise((s,a)=>{var d=this.options.expandReqBuilder.buildFederated(t,!o),l=r.get3DSpaceWSUrl(this.options.tenant,d.URI,null);n.post(l,JSON.stringify(d.data),{securityContext:i,timeout:6e5}).then(e=>{e.federatedExpand=!0,s(e)}).catch(t=>{a(e)})})},computeResubleFromBL:async function(e){let t=this.createComputeReusableSvc(e);await t.computeAsync(this.options.tenant);let i=t.getReusedSet();i.size()>0&&this.setReusableDefaults(e,i)},createComputeReusableSvc:function(e){let t=new i({handleError:!0});return e.forEach(e=>{var i={};e.nodes.forEach(e=>{i[e.nodeid]=e.physicalid});var n={};e.occurrences.forEach(e=>{n[e.occurrenceid]=i[e.nodeid]});var o={};e.occurrencerelationships.forEach(e=>{var t=n[e.parent],i=n[e.child];o.hasOwnProperty(t)||(o[t]=[]),o[t].push(i)});var s=e.occurrences.filter(t=>t.occurrenceid===e.rootoccurrence).map(e=>e.nodeid)[0],r=i[s];e.nodes.forEach(e=>{t.addNode(e.physicalid,r,o[e.physicalid])})}),t},setReusableDefaults:function(e,t){e.forEach(e=>{e.nodes.forEach(e=>{t.contains(e.physicalid)&&(e.defaultAction=EnoTreeNodeAction.Reuse)})})}})}),define("DS/DuplicateWidget/views/ExpandOptionsPanel",["DS/DuplicateWidget/DupToolsPanel","DS/DuplicateWidget/utils/IdNs","DS/LifecycleCmd/MessageMediator","DS/LifecycleServices/Utils","DS/Controls/Toggle","text!DS/DuplicateWidget/assets/html/expandoptionspanel.html","i18n!DS/DuplicateWidget/assets/nls/DuplicateWidgetNls","DS/DuplicateWidget/WidgetEvents","css!DS/DuplicateWidget/DuplicateWidget"],function(e,t,i,n,o,s,r){"use strict";return e.extend({init:function(e,t,i){this.expandOptions=i,r=n.createDbgNlsProxy(r),this._parent({identifier:"0f372f30-fee0-4236-84c3-cc45057c7ba7",immersiveFrame:e,model:t})},getContent:function(){return this.content||this.createContent()},getTitle:function(){return"expand options"},createContent:function(){this.content=UWA.createElement("div",{class:"advdup-option-panel"});var e=new t(this.content,"enolcm-dup-expandoptionpanel-");return this.viewModel={},e.elementFromTemplate(s,null,r,this.viewModel).inject(this.content),this.expandOptions.forEach(e=>{new o({type:"switch",label:e.nameNLS,value:e.defaultValue}).inject(this.content)}),this.content}})}),define("DS/DuplicateWidget/utils/UpdateActionModelVStrategy",["UWA/Controls/Abstract","DS/DuplicateWidget/converters/Converters"],function(e,t){"use strict";return e.extend({init:function(e){this._parent(e),this.controls={},this.controls.applyAllRadio=e.idns.getElById("applyAllRadio"),this.controls.applySelRadio=e.idns.getElById("applySelRadio"),this.controls.applyToChildren=e.idns.getElById("applyChildrenCheck"),this.controls.addText=e.idns.getElById("addTextEdit"),this.controls.findText=e.idns.getElById("findTextEdit"),this.controls.replaceText=e.idns.getElById("replaceTextEdit"),this.controls.groupActionCombo=e.idns.getElById("groupAction"),this.controls.dropDownBtn=e.idns.getElById("addtextBtn")},getApplyChildrenCheck:function(){return this.controls.applyToChildren.wuxControl.checkFlag},updateUIFromModel:function(e){this.controls.applyToChildren.wuxControl.checkFlag=e.ApplyTextToChildren,this.controls.dropDownBtn.wuxControl.value=e.ApplyTextPos===EnoDupApplyTextPos.Before?"before":"after",this.controls.groupActionCombo.wuxControl.currentValue=t.groupActionToString(e.GroupAction),this.controls.addText.wuxControl.value=e.Text,this.controls.findText.wuxControl.value=e.FindText,this.controls.replaceText.wuxControl.value=e.ReplaceText}})}),define("DS/DuplicateWidget/views/OptionsPanel",["DS/DuplicateWidget/DupToolsPanel","DS/DuplicateWidget/utils/IdNs","DS/LifecycleCmd/MessageMediator","DS/LifecycleServices/Utils","text!DS/DuplicateWidget/assets/html/optionspanel.html","i18n!DS/DuplicateWidget/assets/nls/DuplicateWidgetNls","DS/DuplicateWidget/WidgetEvents","css!DS/DuplicateWidget/DuplicateWidget"],function(e,t,i,n,o,s){"use strict";return e.extend({init:function(e,t,i){this.opts=i||{},s=n.createDbgNlsProxy(s),this._parent({identifier:"d94c7818-6828-11e9-a923-1681be663d3e"+(this.opts.identifier?this.opts.identifier:""),immersiveFrame:e,model:t})},getContent:function(){return this.content||this.createContent()},getTitle:function(){return s.options},createContent:function(){var e=this;this.content=UWA.createElement("div",{class:"advdup-option-panel"});var n=new t(this.content,"enolcm-dup-optionpanel-");this.viewModel={onIncDrwChange:function(t){e.model.setIncludeDrawings(t)},onKeepCfgChange:function(t){e.model.setKeepConfig(t)}},n.elementFromTemplate(o,null,s,this.viewModel).inject(this.content);var r=n.getElById("incDrwCheck"),a=n.getElById("keepCfgCheck");return this.opts.haveCatiaV5Data&&r.setStyle("display","block"),this.opts.clearConfigurations&&a.setStyle("display","block"),i.addEvent(duplicateWidgetEvents.includeAllDrwOptionSet,function(t){e.model.IncludeDrawings!==t&&(e.model.setIncludeDrawings(t),r.wuxControl.checkFlag=t,i.dispatchEvent(duplicateWidgetEvents.displayDuplicateAlert,s.autoDisableDrw))}),this.model.haveCatiaV5Data||(r.style.display="none"),this.content}})}),define("DS/DuplicateWidget/views/SelectionPanel",["DS/DuplicateWidget/DupToolsPanel","DS/DuplicateWidget/UIUpdate","DS/DuplicateWidget/controls/GroupSelectionList","DS/DuplicateWidget/controls/PopupControl","DS/LifecycleServices/Utils","DS/DuplicateWidget/utils/IdNs","DS/DuplicateWidget/utils/UpdateSelectionModelVStrategy","DS/DuplicateWidget/utils/UpdateSelectionModelHStrategy","text!DS/DuplicateWidget/assets/html/selpanelv.html","text!DS/DuplicateWidget/assets/html/selpanelh.html","i18n!DS/DuplicateWidget/assets/nls/DuplicateWidgetNls","css!DS/DuplicateWidget/DuplicateWidget"],function(e,t,i,n,o,s,r,a,d,l,c){"use strict";return e.extend({content:null,init:function(e,i,n,s){c=o.createDbgNlsProxy(c),this.treeModel=n,this.UIUpdate=new t;let r=s||{};this._parent({identifier:"d94c796c-6828-11e9-a923-1681be663d3e"+(r.identifier?r.identifier:""),immersiveFrame:e,model:i}),this.updateUI=o.debounce(this._updateUI.bind(this),100),n.addEvent("OnTreeInitialized",function(){var e=[];this.treeModel.Types.each(function(t,i){e.push({label:i,id:i})}),this.groupList.addGroup({label:c.grpType,id:"type"},e);var t=[];this.treeModel.States.each(function(e,i){t.push({label:i,id:i})}),this.groupList.addGroup({label:c.grpState,id:"state"},t)},this)},getContent:function(){return this.content||this.createContent()},getTitle:function(){return c.selection},createContent:function(){var e=this;this.content=UWA.createElement("div",{class:"advdup-selection-panels"});var t=new s(this.content,"enolcm-dup-selpanel-");this.verticalLayout=UWA.createElement("div").inject(this.content),this.horzLayout=UWA.createElement("div").inject(this.content);var i={addSelection:function(){e._updateModel().addSelection()},removeSelection:function(){e._updateModel().removeSelection()},clearSelection:function(){e._updateModel().clearSelection()},onChangeContains:function(t){e.model.TitleCriteria=EnoDupTitleSelectionCriteria.Contains},onChangeNotContains:function(t){e.model.TitleCriteria=EnoDupTitleSelectionCriteria.NotContains},setProperty:function(t,i){"title"===t&&(e.model.TitleString=i)}};t.elementFromTemplate(d,null,c,i).inject(this.verticalLayout),t.elementFromTemplate(l,null,c,i).inject(this.horzLayout),this._setupUIUpdate(t);var n=this._createGroupLists(t);return this.updateSelectionModelVStrategy=new r({idns:t,groupList:n.v}),this.updateSelectionModelHStrategy=new a({idns:t,groupList:n.h}),this.content},_setupUIUpdate:function(e){var t=this;[{ids:["removeSelBtn","clearSelBtn","removeSelBtnH","clearSelBtnH"],enableLogic:function(e){return e.haveTreeSelection}}].forEach(function(i){i.ids.forEach(function(n){var o=e.getElById(n);t.UIUpdate.addElement(o,function(e){return i.enableLogic(e)})})})},_connectButtons:function(e){},onStartWindowDrag:function(){this.attlistPopup&&this.attlistPopup.hidePopup()},onPrePlaceChange:function(e){this.attlistPopup&&this.attlistPopup.hidePopup()},_createGroupLists:function(e){var t=this,o=new i,s=e.getElById("dropdownGrouplistPlaceholder");s.addEventListener("show",function(e){e.currentTarget.dsModel.elements.popup&&(e.currentTarget.dsModel.elements.popup.visibleFlag=!1),t.attlistPopup=t.attlistPopup||new n({createContent:function(){var e=new UWA.createElement("div",{class:"groupListDropdown-container",styles:{width:"200px",height:"auto",maxHeight:"0px",transition:"max-height 0.3s ease-in"}});return o.inject(e),e},styles:{borderRadius:"4px",height:"auto",maxHeight:"400px",overflowY:"auto"},events:{onShow:function(e){var t=e.querySelector(".groupListDropdown-container");t&&t.setStyle("max-height","800px");var i=e.querySelector(".groupSelectionList-root");i&&i.setStyle("overflow-y","hidden")},onHide:function(e){var t=e.querySelector(".groupListDropdown-container");t&&t.setStyle("max-height","0px");var i=e.querySelector(".groupSelectionList-root");i&&i.setStyle("overflow-y","auto")}}}),t.attlistPopup.showPopup({parentEl:s})});var r=e.getElById("groupListPlaceholder"),a=new i;return a.inject(r),this.groupList={lists:[],add:function(e){this.lists.push(e)},getGroupSelected:function(e){return this.lists[0].getGroupSelected(e)},addGroup:function(e,t){this.lists.forEach(function(i){i.addGroup(e,t)})}},this.groupList.add(a),this.groupList.add(o),{h:o,v:a}},_updateModel:function(){return this.model.TypeMatch=this.updateModelStrategy.getGroupMatch("type"),this.model.StateMatch=this.updateModelStrategy.getGroupMatch("state"),this.model._TypeSelected=this.updateModelStrategy._getGroupSelected("type"),this.model._StateSelected=this.updateModelStrategy._getGroupSelected("state"),this.model},_updateUI:function(){this.UIUpdate.update({haveTreeSelection:this.treeModel.getSelectedNodes().length>0})},_setLayout:function(e){var t=null;this.updateModelStrategy&&(t=this._updateModel()),e===EnoDupPanelLayout.Vertical?(this.verticalLayout.setStyle("display","block"),this.horzLayout.setStyle("display","none"),this.updateModelStrategy=this.updateSelectionModelVStrategy):(this.verticalLayout.setStyle("display","none"),this.horzLayout.setStyle("display","block"),this.updateModelStrategy=this.updateSelectionModelHStrategy),t&&this.updateModelStrategy.updateUIFromModel(t)},_initialUpdate:function(e){this._setLayout(e),this._updateModel()}})}),define("DS/DuplicateWidget/models/OptionsModel",["UWA/Controls/Abstract","DS/LifecycleCmd/MessageMediator","DS/DuplicateWidget/WidgetEvents"],function(e,t){"use strict";return e.extend({IncludeDrawings:!1,KeepConfig:!1,setIncludeDrawings:function(e){this.IncludeDrawings=e,t.dispatchEvent(duplicateWidgetEvents.includeAllDrwOptionOnChange,this.IncludeDrawings)},setKeepConfig:function(e){this.KeepConfig=e}})}),define("DS/DuplicateWidget/utils/UpdateActionModelHStrategy",["UWA/Controls/Abstract","DS/DuplicateWidget/converters/Converters"],function(e,t){"use strict";return e.extend({init:function(e){this._parent(e),this.controls={},this.controls.applyAllRadio=e.idns.getElById("applyAllRadioH"),this.controls.applySelRadio=e.idns.getElById("applySelRadioH"),this.controls.applyToChildren=e.idns.getElById("applyChildrenCheckH"),this.controls.addText=e.idns.getElById("addTextEditH"),this.controls.findText=e.idns.getElById("findTextEditH"),this.controls.replaceText=e.idns.getElById("replaceTextEditH"),this.controls.groupActionCombo=e.idns.getElById("groupActionH"),this.controls.dropDownBtn=e.idns.getElById("addtextBtnH")},getApplyChildrenCheck:function(){return this.controls.applyToChildren.wuxControl.checkFlag},updateUIFromModel:function(e){this.controls.applyToChildren.wuxControl.checkFlag=e.ApplyTextToChildren,this.controls.dropDownBtn.wuxControl.value=e.ApplyTextPos===EnoDupApplyTextPos.Before?"before":"after",this.controls.groupActionCombo.wuxControl.currentValue=t.groupActionToString(e.GroupAction),this.controls.addText.wuxControl.value=e.Text,this.controls.findText.wuxControl.value=e.FindText,this.controls.replaceText.wuxControl.value=e.ReplaceText}})}),define("DS/DuplicateWidget/utils/TreeNodeFiltering",["UWA/Controls/Abstract","DS/DuplicateWidget/DataFilterer"],function(e,t){"use strict";return e.extend({init:function(e){this.treeModel=e},filterNodes:function(e){var i=function(e,t){return-1!==t.getLabel().search(new RegExp(e,"i"))},n=function(e,t){return new RegExp("^"+e.split("*").join(".*")+"$","i").test(t.getLabel())},o=new t,s=e.TitleString.replace(/[\-\[\]\/\{\}\(\)\+\?\.\\\^\$\|]/g,"\\$&"),r=-1!==s.indexOf("*");return s.length>0&&(e.TitleCriteria===EnoDupTitleSelectionCriteria.Contains?r?o.addFilter(n.bind(null,s)):o.addFilter(i.bind(null,s)):r?o.addFilter(function(e,t){return!n(e,t)}.bind(null,s)):o.addFilter(function(e,t){return!i(e,t)}.bind(null,s))),o.addFilter(function(e,t){return e.some(function(e){return function(e,t){return e===t.getTypeNls()}(e,t)})}.bind(null,e.TypeMatch)),o.addFilter(function(e,t){return e.some(function(e){return function(e,t){return e===t.getMaturityNls()}(e,t)})}.bind(null,e.StateMatch)),o.filter(this.treeModel.getAllNodes())}})}),define("DS/DuplicateWidget/views/ActionsPanel",["DS/DuplicateWidget/DupToolsPanel","DS/DuplicateWidget/UIUpdate","DS/DuplicateWidget/converters/Converters","DS/LifecycleServices/Utils","DS/DuplicateWidget/utils/IdNs","DS/DuplicateWidget/utils/UpdateActionModelVStrategy","DS/DuplicateWidget/utils/UpdateActionModelHStrategy","DS/LifecycleServices/HTMLTemplating","text!DS/DuplicateWidget/assets/html/actionpanelv.html","text!DS/DuplicateWidget/assets/html/actionpanelh.html","i18n!DS/DuplicateWidget/assets/nls/DuplicateWidgetNls","css!DS/DuplicateWidget/DuplicateWidget"],function(e,t,i,n,o,s,r,a,d,l,c){"use strict";return e.extend({defaultOptions:{identifier:""},init:function(e,i,o,s){c=n.createDbgNlsProxy(c);var r=this,a=s||{};this.options=UWA.merge(a,this.defaultOptions),this.treeModel=o,this.UIUpdate=new t,this._parent({identifier:"d94c75a2-6828-11e9-a923-1681be663d3e"+this.options.identifier,immersiveFrame:e,model:i}),this.options=UWA.merge(UWA.merge(a,this.defaultOptions),this.options),this.updateUI=n.debounce(this._updateUI.bind(this),100),this._delayedUpdateModel=n.debounce(this._updateModel.bind(this),100);var d=!1;o.addEvent("OnSelChangeTree",function(e){var t=0!==e.getSelectedCount();t!==d&&(d=t,r._delayedUpdateModel())})},getContent:function(){return this.content||this.createContent()},getTitle:function(){return c.tools},createContent:function(){var e=this;this.content=UWA.createElement("div",{class:"advdup-action-panels"});var t=new o(this.content,"enolcm-dup-actionpanel-");this.verticalLayout=UWA.createElement("div").inject(this.content),this.horzLayout=UWA.createElement("div").inject(this.content);var n={applyAction:function(){e.model.applyAction()},onChangeActionCombo:function(t){e.model.GroupAction=i.groupStringToAction(t),e.model.applyAction()},addText:function(){e.model.applyText()},onApplyChildrenChange:function(t){e._updateModel()},onChangeAddCombo:function(t){e.model.ApplyTextPos="before"===t?EnoDupApplyTextPos.Before:EnoDupApplyTextPos.After},replace:function(){var t=e._updateModel();t.FindText.length>0&&t.applyReplace()},reset:function(){e._updateModel().reset()},setProperty:function(t,i){"addText"===t?e.model.Text=i:"findText"===t?e.model.FindText=i:"replaceText"===t&&(e.model.ReplaceText=i),e.updateUI(e.treeModel)}},u={actions:function(){var e="";return this.actionsArray.forEach(t=>{e+=a.Expand("<option value={{value}}>{{name}}</option>",t)}),e},actionsArray:[]};return this.model.getActions().forEach(e=>{e==EnoTreeNodeAction.Duplicate?(u.actionsArray.push({name:c.duplicate,value:"Duplicate",sortPri:1}),u.actionsArray.push({name:c.duplicateTree,value:"DuplicateTree",sortPri:2})):e==EnoTreeNodeAction.DuplicateWDrw?u.actionsArray.push({name:c.duplicateWDrw,value:"DuplicateDrw",sortPri:3}):e==EnoTreeNodeAction.Reuse?u.actionsArray.push({name:c.reuse,value:"Reuse",sortPri:4}):e==EnoTreeNodeAction.Exclude?u.actionsArray.push({name:c.exclude,value:"Exclude",sortPri:5}):e==EnoTreeNodeAction.Branch&&(u.actionsArray.push({name:c.branch,value:"Branch",sortPri:1}),u.actionsArray.push({name:c.branchTree,value:"BranchTree",sortPri:2}))}),u.actionsArray.sort((e,t)=>e.sortPri<t.sortPri?-1:e.sortPri>t.sortPri?1:0),t.elementFromTemplate(d,u,c,n).inject(this.verticalLayout),t.elementFromTemplate(l,u,c,n).inject(this.horzLayout),this._connectButtons(t),this.updateActionModelVStrategy=new s({idns:t}),this.updateActionModelHStrategy=new r({idns:t}),this.content},_connectButtons:function(e){var t=this,i=function(i){var n=e.getElById(i);t.UIUpdate.addElement(n,function(e){return!e.applyToAll})};i("applyChildrenCheck"),i("applyChildrenCheckH");var n=function(i){var n=e.getElById(i);t.UIUpdate.addElement(n,function(e){return e.haveTreeSelection&&e.haveFindText})};n("replaceBtn"),n("replaceBtnH");var o=function(i){var n=e.getElById(i);t.UIUpdate.addElement(n,function(e){return e.haveTreeSelection&&e.haveAddText})};o("addtextBtn"),o("addtextBtnH"),this.addEvent("applyModeChanged",function(e){t.updateUI(e)})},_updateModel:function(){return this.model.ApplyToAll=0===this.treeModel.getSelectedCount(),this.model.ApplyTextToChildren=this.updateModelStrategy.getApplyChildrenCheck(),this.model},_updateUI:function(){this.UIUpdate.update({haveTreeSelection:this.treeModel.getSelectedNodes().length>0||this.model.ApplyToAll,haveAddText:this.model.Text.length>0,haveFindText:this.model.FindText.length>0,haveReplaceText:this.model.ReplaceText.length>0,applyToAll:this.model.ApplyToAll})},_setLayout:function(e){var t=null;this.updateModelStrategy&&(t=this._updateModel()),e===EnoDupPanelLayout.Vertical?(this.verticalLayout.setStyle("display","block"),this.horzLayout.setStyle("display","none"),this.updateModelStrategy=this.updateActionModelVStrategy):(this.verticalLayout.setStyle("display","none"),this.horzLayout.setStyle("display","block"),this.updateModelStrategy=this.updateActionModelHStrategy),t&&this.updateModelStrategy.updateUIFromModel(t)},_initialUpdate:function(e){this._setLayout(e),this._updateModel()}})}),define("DS/DuplicateWidget/models/TreeModel",["UWA/Controls/Abstract","DS/DuplicateWidget/models/TreeNodeModel","DS/DuplicateWidget/utils/TreeNodeCache","DS/DuplicateWidget/utils/EventRelay","DS/LifecycleCmd/Dictionary"],function(e,t,i,n,o){"use strict";return e.extend({Types:null,States:null,init:function(e){var s=this;this.Types=new o,this.States=new o,e.addEvent("onTreeListCreated",function(t){s.treeList=e.treeList,s.treeList.onInitialUpdateView().then(function(){s.dispatchEvent("OnTreeInitialized",s)}),s.treeList.tree.getDocument().getXSO().onPostAdd(function(e){s.dispatchEvent("OnSelChangeTree",s)}),s.treeList.tree.getDocument().getXSO().onPostRemove(function(e){s.dispatchEvent("OnSelChangeTree",s)}),s.treeList.tree.getDocument().getXSO().onEmpty(function(e){s.dispatchEvent("OnSelChangeTree",s)})}),this._eventRelay=new n({dispatcher:function(e,t){s.dispatchEvent(e,t)},eventMap:[{from:"onDupActionChange",to:"onDupActionChangeTree",transform:function(e){return{nodes:[e]}},batchTransform:function(e){return{nodes:e}}}]}),this._initNodeModel=function(e){s._eventRelay.addSource(e)};var r=function(e){var i=new t(e,0===e._treeNode._nodeDepth,e._treeNode.options.assembly,s.treeList,function(e){var t=s._treeNodeCache.resolve(e);return t||r(e)});return s._initNodeModel(i),i};this._treeNodeCache=new i({nodeModelFactory:r})},getSelectedNodes:function(){return this.treeList.getSelectedNodes().map(function(e){return this._treeNodeCache.resolve(e)},this)},getAllNodes:function(){return this.treeList.getAllNodes().map(function(e){return this._treeNodeCache.resolve(e)},this)},getSelectedCount:function(){return this.treeList?this.treeList.getSelectedNodes().length:0},getModelFromTreeNode:function(e){return this._treeNodeCache.resolve(this.treeList.buildAssemblyNode(e))},appendInstances:function(e){if("function"==typeof e.forEach){var t={},i=[];return e.forEach(function(e){i=i.concat(this._appendInstances(e,t))},this),i}return this._appendInstances(e)},disableNode:function(e){this.treeList.disableNode(e.treeNode._treeNode)},enableNode:function(e){this.treeList.enableNode(e.treeNode._treeNode)},updateCell:function(e,t){this.treeList.tree.getManager().updateCellView(e.treeNode._treeNode._getRowID(),t)},setBatchMode:function(e){this._eventRelay.setBatchMode(e)},_appendInstances:function(e,t){var i=function(e){return e.getId()+"o"+e.getOccId()},n=function(e){t&&(t[e]=!0)},o=function(e){return null==t||null==t[e]},s=this.treeList.getSameNodes(e.getId()).filter(function(t){return t.options.occId!=e.getOccId()}).map(function(e){return{node:e,key:i({getId:function(){return e.options.nodeId},getOccId:function(){return e.options.occId}})}}).filter(function(e){return o(e.key)}).map(function(e){return n(e.key),this.getModelFromTreeNode(e.node)},this),r=i(e);return o(r)&&(s.unshift(e),n(r)),s},clearSelection:function(){this.getSelectedNodes().forEach(function(e){e.unselect()})},_addType:function(e,t){this.Types.contains(e)||this.Types.add(e,t)},_addState:function(e,t){this.States.contains(e)||this.States.add(e,t)}})}),define("DS/DuplicateWidget/AdvDupModelFactory",["UWA/Controls/Abstract","DS/DuplicateWidget/models/SelectionModel","DS/DuplicateWidget/models/OptionsModel","DS/DuplicateWidget/models/TreeActionsModel","DS/DuplicateWidget/models/TreeModel"],function(e,t,i,n,o){"use strict";return e.extend({init:function(e){this.advDupTree=e},createTreeModel:function(){return new o(this.advDupTree)},createOptionsModel:function(){return new i},createSelectionModel:function(){return new t},createTreeActionsModel:function(e){return new n(e)}})}),define("DS/DuplicateWidget/AdvancedDuplicateTree",["UWA/Controls/Abstract","DS/ENO6WPlugins/jQuery","DS/DuplicateWidget/views/SelectionPanel","DS/DuplicateWidget/views/ActionsPanel","DS/DuplicateWidget/views/OptionsPanel","DS/DuplicateWidget/views/ExpandOptionsPanel","DS/DuplicateWidget/AdvDupModelFactory","DS/DuplicateWidget/utils/TreeNodeFiltering","DS/DuplicateWidget/converters/Converters","DS/DuplicateWidget/utils/RegExReplace","DS/Controls/LineEditor","DS/Windows/ImmersiveFrame","DS/LifecycleServices/LifecycleServices","DS/LifecycleServices/LifecycleServicesSettings","DS/LifecycleCmd/Dictionary","DS/LifecycleCmd/MessageMediator","DS/LifecycleControls/AssemblyTreeList","DS/LifecycleServices/AssemblyJson","DS/LifecycleServices/TranslationService","DS/LifecycleControls/NumberModal","DS/LifecycleServices/Utils","DS/LifecycleServices/WebReq","DS/LifecycleServices/ChunkedwebReq","DS/DuplicateWidget/ExtensibilityConstants","i18n!DS/DuplicateWidget/assets/nls/DuplicateWidgetNls"],function(e,t,i,n,o,s,r,a,d,l,c,u,p,h,f,g,m,v,D,y,S,C,A,E,x){"use strict";return e.extend({haveCatiaV5Data:!1,propagateTitleEditToInstances:!0,cadMaster:null,defaultOptions:{roots:[],tenant:"OnPremise",inputValidator:null,expandOneLevel:!0,modelFactory:null},init:function(e){this._parent(e),x=S.createDbgNlsProxy(x),this.roots=[],this.assemblies=[],this.tenant=this.options.tenant,this.inputValidator=this.options.inputValidator,this.expandOneLevel=this.options.expandOneLevel,this.options.showError=this.options.showError?this.options.showError:()=>{},this.identifier=(e?e.identifier:null)||"",this.titleInputValidators=new f,this.translationService=new D({handleError:!0});for(var t=0;t<this.options.roots.length;++t)this.roots.push({id:this.options.roots[t]});this.modelFactory=this.options.modelFactory?this.options.modelFactory:new r(this),this.model=this.modelFactory.createTreeModel(),this.optionsModel=this.modelFactory.createOptionsModel(),this.selectionModel=this.modelFactory.createSelectionModel(),this.treeActionsModel=this.modelFactory.createTreeActionsModel(this.model),this.updateTree=S.debounce(this._updateTree.bind(this),200)},loadUI:function(e){return this.securityContext=e.securityContext,this.clearConfigurations=e.clearConfigurations,new UWA.Promise(async(t,i)=>{this.container=e.parentElement,this.immersiveFrame=e.immersiveFrame||this._createImmersiveFrame(this.container),this.dispatchEvent("expandingStructure");try{let i=await e.treeLoader.expand(),n=i.assemblies;this.assemblies=n,this.createTreeUI({idCounters:i.idCounters}),this.addEvent("onTreeListCreated",async()=>{await this.treeList.onInitialUpdateView(),t()})}catch(e){this.options.showError(e)}})},getTreeData:function(e){return this.getTreeNodesData()},_createImmersiveFrame:function(e){var t="4046f1f2-6823-11e9-a923-1681be663d3e"+this.identifier;window.c145ae486a7011e9a9231681be663d3e&&(t=void 0);var i=new u({identifier:t});i.dockingElements.forEach(function(e){e._properties.side.value===WUXDockAreaEnum.TopDockArea||e._properties.side.value==WUXDockAreaEnum.BottomDockArea?e._properties.dockingZoneSize.value=120:e._properties.side.value!==WUXDockAreaEnum.LeftDockArea&&e._properties.side.value!=WUXDockAreaEnum.RightDockArea||(e._properties.dockingZoneSize.value=230)});var n=UWA.createElement("div",{class:"immersive-frame-parent"});return n.inject(e),i.inject(n),i},openAdvancedTreeODT:function(e,t,i){require(["DS/DuplicateWidget/expandTree/duplicateExpand","DS/DuplicateWidget/ExpandReqBuilder"],(n,o)=>{e||(e=UWA.createElement("div",{styles:{width:"400px",height:"200px",border:"solid 1px black"}})).inject(document.body);let s=i.loader||new n({roots:i.roots,securityContext:t,tenant:this.tenant,expandReqBuilder:i.expandReqBuilder||new o(this.context),getAuthoringMode:i.getAuthoringMode?i.getAuthoringMode:()=>!0});s.addEvent("onExpandDone",e=>{this.dispatchEvent("onLoaderExpandDone",e)}),this.loadUI({immersiveFrame:i.immersiveFrame,parentElement:e,securityContext:t,treeLoader:s})})},getTreeNodesData:function(){return this._getDuplicationData()},_createActionOptsFromArray:function(e){var t={options:[],translated:[],name2idx:[]},i=0;return e.forEach(function(e){switch(e){case EnoTreeNodeAction.Duplicate:t.options.push("duplicate"),t.translated.push(x.duplicate),t.name2idx.duplicate=i++;break;case EnoTreeNodeAction.Reuse:t.options.push("reuse"),t.translated.push(x.reuse),t.name2idx.reuse=i++;break;case EnoTreeNodeAction.Exclude:t.options.push("exclude"),t.translated.push(x.exclude),t.name2idx.exclude=i++;break;case EnoTreeNodeAction.DuplicateWDrw:t.options.push("duplicate2"),t.translated.push(x.duplicatewithdrw),t.name2idx.duplicate2=i++;break;case EnoTreeNodeAction.Branch:t.options.push("branch"),t.translated.push(x.branch),t.name2idx.branch=i++}}),t},getOptions:function(e,t){var i=[];return t&&(i=t.getSupportedActions({forV5:this.haveCatiaV5Data})),this._createActionOptsFromArray(i)},_TreeNodeAction2WebserviceAction:function(e){return e===EnoTreeNodeAction.Duplicate?"duplicate":e===EnoTreeNodeAction.DuplicateWDrw?"duplicate2":e===EnoTreeNodeAction.Reuse?"reuse":e===EnoTreeNodeAction.Exclude?"exclude":e===EnoTreeNodeAction.Branch?"branch":void 0},_getDuplicationDataR:function(e,t,i,n,o,s){var r=v.getNode(e.options.assembly,e.options.nodeId);if(!r.excludeFromServiceCall){var a;if(r.connectToParent)a=s;else a=this.model.getModelFromTreeNode(e).getAction();var d=!!t&&(this.model.getModelFromTreeNode(t).getAction()===EnoTreeNodeAction.Branch&&a===EnoTreeNodeAction.Exclude);if(t&&(a===EnoTreeNodeAction.Duplicate||a===EnoTreeNodeAction.DuplicateWDrw||a===EnoTreeNodeAction.Reuse||a===EnoTreeNodeAction.Branch||d)){var l=v.getRelationshipData(e.options.assembly,t.options.occId,e.options.occId),c=i.find(t.options.physicalId),u=this._TreeNodeAction2WebserviceAction(a);"duplicate2"===u&&(u="duplicate"),d?(c.excludedRels=c.excludedRels?c.excludedRels:[],c.excludedRels.push(l.pid)):c.relations.push({physicalid:l.pid,type:l.type,operation:u})}if(!i.contains(e.options.physicalId)){var p={physicalid:e.options.physicalId,isRootNode:n,operation:this._TreeNodeAction2WebserviceAction(a),title:e.getNewTitle(),revision:r.revision,relations:[]};if(o.push(p),i.add(e.options.physicalId,p),a!==EnoTreeNodeAction.Reuse&&a!==EnoTreeNodeAction.Exclude){var h=e.getChildren();if(h)for(var f=0;f<h.length;++f)this._getDuplicationDataR(h[f],e,i,!1,o,a)}}}},_getDuplicationData:function(){var e=[],t=new f;return this.treeList.tree.getDocument().getRoots().forEach(i=>{this._getDuplicationDataR(i,null,t,!0,e,-1)}),e},_parseExpandState:function(e){var t=e?e.split("."):[];return t.length>1?{state:t[1],policy:t[0]}:{state:e}},_addChildToAssembly:function(e,t,i,n){var o=UWA.merge({nodeid:n.nextNodeId},i);e.nodes.push(o);let s=n.nextNodeId++,r=n.nextOccId++;var a={nodeid:s,occurrenceid:r};e.occurrences.push(a),e.occurrences.forEach(function(n){if(n.nodeid===t){var o={child:r,parent:n.occurrenceid,physicalid:i.relid,type:i.reltype};e.occurrencerelationships.push(o)}},this)},initTreeNode:function(e){e.newTitle=e.Title,e.connectToParent=!1,e.excludeFromServiceCall=!1,e.isEmbeddedComponent=!1},createTreeUI:function(e){e=e||{};var t=[],i=new Map;this.assemblies.forEach(e=>{e.nodes.forEach(function(e){var t=this._parseExpandState(e.state);t.hasOwnProperty("policy")?this.translationService.addStateAndPolicy(t.state,t.policy):this.translationService.addStateAndType(e.state,e.type),this.translationService.addType(e.type),e.cadMaster&&(("3DEXPERIENCE"===e.cadMaster||this.cadMaster&&"3DEXPERIENCE"!==this.cadMaster)&&this.cadMaster||(this.cadMaster=e.cadMaster))},this)},this),"CATIAV5"!=this.cadMaster&&"SOLIDWORKS"!=this.cadMaster||(this.haveCatiaV5Data=!0),this.inputValidator&&(this.inputValidator.haveIllegalChars("type-not-used-yet",this.cadMaster)||(this.inputValidator.validators=this.inputValidator.validators.filter(e=>"illegalChars"!==e.name)));let n=new Map([[E.ExpandNodeCapabilites.Duplicate,EnoTreeNodeAction.Duplicate],[E.ExpandNodeCapabilites.Reuse,EnoTreeNodeAction.Reuse],[E.ExpandNodeCapabilites.Exclude,EnoTreeNodeAction.Exclude],[E.ExpandNodeCapabilites.Branch,EnoTreeNodeAction.Branch],[E.ExpandNodeCapabilites.Max,EnoTreeNodeAction.DuplicateWDrw]]);var o=this,s=new Set;UWA.Promise.all([this.translationService.initAsync(this.tenant)]).then(function(){o.assemblies.forEach(e=>{e.nodes.forEach(function(r){o.initTreeNode(r);var a=o._parseExpandState(r.state);if(r.maturityNls=this.translationService.translateState(a.state),r.typeRaw=r.type,r.type=this.translationService.translateType(r.typeRaw),this.model._addType(r.typeRaw,r.type),this.model._addState(a.state,r.maturityNls),e.legacyExpand)"CATIA Embedded Component"===r.typeRaw&&(r.isEmbeddedComponent=!0),this.haveCatiaV5Data?[EnoTreeNodeAction.Duplicate,EnoTreeNodeAction.Reuse,EnoTreeNodeAction.Exclude,EnoTreeNodeAction.DuplicateWDrw].forEach(e=>s.add(e)):[EnoTreeNodeAction.Duplicate,EnoTreeNodeAction.Reuse,EnoTreeNodeAction.Exclude].forEach(e=>s.add(e));else{let e=r.attributes["expand::capabilities"]||[E.ExpandNodeCapabilites.Duplicate,E.ExpandNodeCapabilites.Reuse,E.ExpandNodeCapabilites.Exclude,E.ExpandNodeCapabilites.ChangeTitle];(e.includes(E.ExpandNodeCapabilites.Duplicate)&&"CATIAV5"==r.cadMaster||"SOLIDWORKS"==r.cadMaster)&&e.push(E.ExpandNodeCapabilites.Max),r.supportedActions=r.supportedActionsV5=e.map(e=>n.has(e)?n.get(e):-1).filter(e=>-1!==e),e=e.sort(),r.supportedActions.forEach(e=>s.add(e)),r.supportedActions.includes(EnoTreeNodeAction.Duplicate)&&this.haveCatiaV5Data&&s.add(EnoTreeNodeAction.DuplicateWDrw),r.capabilites=e.filter(e=>e>=E.ExpandNodeCapabilites.ChangeTitle&&e!==E.ExpandNodeCapabilites.Branch),e.includes(E.ExpandNodeCapabilites.FollowParent)&&(r.connectToParent=!0);let t=r.attributes["expand::defaultAction"]||-1;-1!=t&&e.includes(t)&&(r.defaultAction=n.get(t))}r.attributes.type_icon_url||(r.attributes.type_icon_url=h.get3DSpaceWSUrl("","/snresources/images/icons/small/I_VPMNavProduct.png",null)),e.legacyExpand&&(t.push(r.physicalid),i.has(r.physicalid)||i.set(r.physicalid,[]),i.get(r.physicalid).push({assembly:e,node:r}))},o)},this),o.treeActionsModel.setActions(s),0==t.length?o.createAdvancedTree():o.completeLegacyExpandNodeData(t,i,e.idCounters)})},completeLegacyExpandNodeData:function(e,t,i,n){var o=this,s=h.get3DSpaceWSUrl(o.tenant,"/resources/lifecycle/duplicate/info",null),r={ids:e,attributes:["type","physicalid","attribute[PLMEntity.V_usage]","attribute[XCADEmbeddedCmp.V_IsEmbeddedComponent]","attribute[PLMCoreRepReference.V_isOnceInstantiable]","type.kindof[BundleFastenerAbstract]"],childAttributes:["type","physicalid","attribute[PLMEntity.V_usage]","attribute[XCADEmbeddedCmp.V_IsEmbeddedComponent]","attribute[PLMCoreRepReference.V_isOnceInstantiable]","attribute[PLMEntity.V_Name]","type_icon_url","stateNls","typeNls","revision"],getDesignTables:!0,getSpecificationDocs:!0};A.post(s,r,{chunkMember:"ids",securityContext:o.securityContext,timeout:6e5}).then(function(e){var n=function(e,t){var i=t.attributes.filter(function(t){return t.name===e});return i.length>0?i[0].value:""};e&&e.forEach(function(e){var s=t.get(e.physicalid)||[];let r=[];e.children.forEach(function(e){if(e.Title=n("attribute[PLMEntity.V_Name]",e),""==e.Title&&(e.Title=n("ds6w:label",e)),o.initTreeNode(e),e.revision=n("revision",e),""==e.revision&&(e.revision=n("ds6wg:revision",e)),e.type=n("typeNls",e),e.typeRaw=n("type",e),e.state=n("current",e),e.maturityNls=n("stateNls",e),""==e.state){let t=n("ds6w:status",e),i=t.split(".");e.state=2===i.length?i[1]:t}e.type_icon_url=h.get3DSpaceWSUrl(o.tenant,n("type_icon_url",e),null),e.defaultAction=EnoTreeNodeAction.Reuse,"SpecificationDocument"===e.reltype?e.supportedActionsV5=[EnoTreeNodeAction.Duplicate,EnoTreeNodeAction.Reuse,EnoTreeNodeAction.Exclude]:e.supportedActionsV5=[EnoTreeNodeAction.Duplicate,EnoTreeNodeAction.Reuse],o.model._addType(e.typeRaw,e.type),o.model._addState(e.state,e.maturityNls),r.push(e)});let a=void 0,d=void 0,l=null,c=null;"3DPart"===n("attribute[PLMEntity.V_usage]",e)&&"3DShape"===e.type||"TRUE"===n("attribute[XCADEmbeddedCmp.V_IsEmbeddedComponent]",e)?(a=!0,"TRUE"===n("attribute[XCADEmbeddedCmp.V_IsEmbeddedComponent]",e)&&(d=!0)):"TRUE"===n("attribute[PLMCoreRepReference.V_isOnceInstantiable]",e)?l=c=[EnoTreeNodeAction.Duplicate,EnoTreeNodeAction.Exclude]:"DIFLayout"===n("type",e)||"DIFSheet"===n("type",e)?l=[EnoTreeNodeAction.Duplicate,EnoTreeNodeAction.Exclude]:"TRUE"===n("type.kindof[BundleFastenerAbstract]",e)&&(l=[EnoTreeNodeAction.Duplicate,EnoTreeNodeAction.Exclude]),s.forEach(t=>{r.forEach(e=>{o._addChildToAssembly(t.assembly,t.node.nodeid,e,i)}),t.node.typeRaw=e.type,void 0!==a&&(t.node.connectToParent=a),void 0!==d&&(t.node.isEmbeddedComponent=d),l&&(t.node.supportedActions=l),c&&(t.node.supportedActionsV5=c)})}),o.createAdvancedTree()}).catch(function(e){console.error("completeLegacyExpandNodeData error:",e),o.options&&o.options.showError&&o.options.showError(x.expandFailed+": "+(e?e.error?e.error:e:""))})},isConnectedToParent:function(e){return e.assyNode.isEmbeddedComponent||e.assyNode.connectToParent},getActions:function(e){return this.getOptions(!1,e).translated},getDefaultActionIndex:function(e){let t=e.getDefaultAction();if(t===EnoTreeNodeAction.Undefined)return 0;let i=e.getActionComboIndex(t);return-1===i?0:i},_updateChildTreeR:function(e,t){t?(e.isHardDisabled()&&e.setUseHardDisabledStyle(!1),this.model.disableNode(e)):(e.isHardDisabled()&&e.setUseHardDisabledStyle(!0),this.model.enableNode(e)),this.model.updateCell(e,"newTitle");var i=e.getChildren()||[];if(i.length>0){var n=!!e.isDisabled()&&e.isDisabled();if(!n){var o=e.getAction();n=o!=EnoTreeNodeAction.Duplicate&&o!=EnoTreeNodeAction.DuplicateWDrw&&o!=EnoTreeNodeAction.Branch}for(var s=0;s<i.length;++s)this._updateChildTreeR(i[s],n)}},_updateChildTree:function(e,t){for(var i=t.getActionFromIndex(e),n=i!=EnoTreeNodeAction.Duplicate&&i!=EnoTreeNodeAction.DuplicateWDrw&&i!=EnoTreeNodeAction.Branch,o=t.getChildren()||[],s=0;s<o.length;++s)this._updateChildTreeR(o[s],n);this.updateTree()},_appendInstances:function(e){return this.treeList.getAllNodes().filter(t=>t.physicalId===e.treeNode.physicalId).map(e=>this.model.getModelFromTreeNode(e._treeNode))},_createActionColumn:function(){var e={column:"advancedDuplicateAction",translated:x.action},t=this;return this.treeList.insertDropdownListCol(2,e.column,e.translated,function(e,i){var n=t.model.getModelFromTreeNode(i);return t.isConnectedToParent(n)&&(i.disabled=!0,i.hardDisabled=!0,i.disableHardDisabledStyle||i.dropdownList.advancedDuplicateAction.classList.add("hardDisabled-combo")),t.getActions(n)},function(e,i,n){var o=t.model.getModelFromTreeNode(n),s=o.getActionFromIndex(i);s===EnoTreeNodeAction.DuplicateWDrw&&g.dispatchEvent(duplicateWidgetEvents.includeAllDrwOptionSet,!1),t._appendInstances(o).forEach(function(e){t.model.updateCell(e,"newTitle"),t._updateChildTree(i,e),o.treeNode.occId!==e.treeNode.occId&&e.setAction(s)}),t.model.getSelectedCount()>1&&t.treeActionsModel.applySelectionAction(s)},185,!1,function(e,i){var n=t.model.getModelFromTreeNode(i);return t.getDefaultActionIndex(n)}),e},_fixupSelIndexOnRoot:function(e,t){return t.isRoot&&this.haveCatiaV5Data&&1===e?this.getOptions().name2idx.duplicate2:e},_registerLineEditor:function(){var e=this;this.treeList.tree.getManager().registerReusableCellContent({id:"LineEditor",buildContent:function(){var t=new c({});t.getContent().addClassName("duplicate_title_lineedit"),t.getContent().setStyle("max-width","none");var i=t.getContent().querySelector("input");return i?i.setStyle("max-width","none"):console.error("LineEditor is missing input as child"),t.addEventListener("change",function(t){if(!1!==e.propagateTitleEditToInstances){var i=t.dsModel;i.value=i.value.trim(),e._updateNewTitleOnInstances(i.nodeInfo,i.value),e.dispatchEvent("onTitleChange",i)}}),t.addEventListener("mousedown",function(e){e.stopPropagation()}),t.addEventListener("mouseup",function(e){e.stopPropagation()}),t}})},_updateNewTitleOnInstances:function(e,t){e.instances.length<1||e.instances.forEach(function(i){var n=i.getNewTitle();if(i.options.occId!==e.occId&&n!==t){if("function"==typeof i.updateInputValidation){this.titleInputValidators.find(i.options.occId).getValidator();i.updateInputValidation(t)}i.setNewTitle(t)}},this)},_installCellInputValidator:function(e,t){if(this.inputValidator&&t&&t.parentNode.parentNode){var i=e.nodeModel.options.occId,n=null;if(t.hasAttribute("data-custom-id")){var o=t.getAttribute("data-custom-id"),s=this.titleInputValidators.find(o);s.getValidator().element===t&&s.detach(t)}return this.titleInputValidators.contains(i)?(n=this.titleInputValidators.find(i)).attachElement(t):((n=this.inputValidator.inputValidator.addValidateElement(t,this.inputValidator.validators,!1)).createInfo={label:e.nodeModel.options.label,id:i},n.setCustomId(i),e.nodeModel.updateInputValidation=function(e){if(null==n.getValidator().element&&null==e)return!1},this.titleInputValidators.add(i,n)),n}},_createTitleColumn:function(){var e=this;this._registerLineEditor();var t=new f,i=S.debounce(function(){console.log("updating - entries:",t.count()),t.each(function(e,t){t.nodeInfo.nodeModel&&t.nodeInfo.nodeModel._parentNode&&(t.disabled=t.nodeInfo.nodeModel._parentNode.options.textEditdisabled,t.nodeInfo.nodeModel.options.textEditdisabled=t.disabled)}),t.clear()},100),n=e.treeList.getCol("newTitle");n.isEditable=!1,n.onCellRequest=function(n){if(!n.isHeader){var o=n.cellView.reuseCellContent("LineEditor");if(o){o.nodeInfo={nodeId:n.nodeModel.options.nodeId,occId:n.nodeModel.options.occId,instances:e.treeList.getAllNodes().filter(e=>e.physicalId===n.nodeModel.options.physicalId).filter(e=>e.occId!=n.nodeModel.options.occId).map(e=>e._treeNode)},o.value=n.nodeModel.options.grid.newTitle;var s=o.elements.container.querySelector("input"),r=e._installCellInputValidator(n,s);let l=e.model.getModelFromTreeNode(n.nodeModel),c=l.getAction(),u=c!==EnoTreeNodeAction.Duplicate&&c!==EnoTreeNodeAction.DuplicateWDrw&&c!==EnoTreeNodeAction.Branch||n.nodeModel.disabled;l.getCanEditTitle()||(u=!0),o.disabled=u;var a=n.nodeModel.options.grid.newTitle;if(u){var d=v.getNode(n.nodeModel.options.assembly,n.nodeModel.options.nodeId);d.connectToParent?(o.disabled=n.nodeModel._parentNode.options.textEditdisabled,function(e,n){e.nodeInfo.nodeModel=n,t.add(e.nodeInfo.nodeId,e),i()}(o,n.nodeModel),n.nodeModel._parentNode.options.textEditdisabled&&(a=d.Title)):a=d.Title}r&&r.updateInputValidation(a),n.nodeModel.options.textEditdisabled=o.disabled}}};var o=this.treeList.tree.getManager();this.treeList.tree.getDocument().getAllDescendants().forEach(function(t){t.getNewTitle=function(){return this.options.grid.newTitle},t.setNewTitle=function(t,i){this.options.grid.newTitle=t.trim(),o.setCellContent(this._rowID,"newTitle",t),o.updateCellView(this,"newTitle"),i&&e.updateTree()}})},setDuplicateActionR:function(e,t,i){var n=!1;return e.forEach(function(e){var o=!!e.disabled&&e.disabled&&!e.isSelected(),s=this.treeList.getNodeDropdownSelectedIndex(e,"advancedDuplicateAction");if(!o&&(s!=t||i)){if(!v.getNode(e.options.assembly,e.options.nodeId).connectToParent){"duplicate2"===this.getOptions().options[t]&&g.dispatchEvent(duplicateWidgetEvents.includeAllDrwOptionSet,!1);var r=this.model.getModelFromTreeNode(e),a=this._appendInstances(r);n=!0;var d=a.map(function(e){return e.treeNode._treeNode});this.treeList.setDropdownSelectionIf(d,t,"advancedDuplicateAction"),a.forEach(function(e){this._updateChildTree(t,e)},this)}if(i){var l=e.getChildren()||[];this.setDuplicateActionR(l,t,i)}}},this),n},setDuplicateAction:function(e,t,i){this.treeList.tree.getManager();this.setDuplicateActionR(e,t,i)&&this.updateTree()},createAdvancedTree:function(){var e=this;this.treeList=new m({canMultiSelect:!0,getChildrenInTreeOrder:!0,allCols:["maturityNls","revision","newTitle"],enableDragAndDrop:!1,enableListSelection:!0,useKeyboard:!0,updateRelatedCombos:!1,dropdownCellFactory:function(t,i){var n=e.treeList.defaultDropdownCellFactory(t,i);return n.addEventListener("DSpointerup",function(e){e.stopPropagation()}),n.addEventListener("click",function(e){e.stopPropagation()}),n},onContextualEvent:{callback:function(t,i,n){if(t&&t.treeview&&0===t.treeview.columnID){var o=[],s=t.treeview.nodeModel;s.isSelected()||(e.treeList.clearSelection(),s.select());let i=e.treeList.getSelectedNodes().map(t=>e.model.getModelFromTreeNode(t._treeNode));if(o.push({type:"PushItem",title:x.expandAll,action:{callback:function(e){i.forEach(e=>e.expandAll())}}}),o.push({type:"PushItem",title:x.expandNLevels,action:{callback:function(n){i.length>0&&new y({parentContainer:e.treeList.getContent(),windowPos:t.data.windowPosition,events:{onApply:function(e){i.forEach(t=>t.expandn(e))}}})}}}),o.push({type:"PushItem",title:x.collapseAll,action:{callback:function(e){i.forEach(e=>e.collapseAll())}}}),e.debugMenuItems){var r={advancedTree:e,selNode:s,selNodes:i};e.debugMenuItems.forEach(function(e){e.action&&e.action.callback&&(null==e.action.orgFn&&(e.action.orgFn=e.action.callback),e.action.callback=function(){e.action.orgFn(r)})}),o=o.concat(e.debugMenuItems)}return o}}}});var t=this._createActionColumn();if(this.treeList.load(this.assemblies,["maturityNls","revision",t.column,"newTitle"],{filterDuplicates:!1,noExpandAll:!0}),this._createTitleColumn(),this.treeList.insertCol(1,{text:"txt",dataIndex:"Revision",isSortable:!1,type:"string",width:120}),this.UpdateView=function(){e.updateTree()},this.container.style.padding="0px",this.expandOneLevel)this.treeList.tree.getDocument().collapseAll(),this.treeList.tree.getDocument().expandNLevels(1);else{var s=this.treeList.tree.getNthRoot(0);setTimeout(()=>{s.expandAll()},100)}g.addEvent(duplicateWidgetEvents.includeAllDrwOptionOnChange,function(t){if(0!=t){var i=e.getOptions(),n=e.treeList.getNodes(function(t){let n=e.model.getModelFromTreeNode(t);var o=e._fixupSelIndexOnRoot(t.dropdownListSelectedIndex?t.dropdownListSelectedIndex.advancedDuplicateAction:0,n);return"duplicate2"===i.options[o]});e.setDuplicateAction(n.map(function(e){return e._treeNode}),i.name2idx.duplicate,!1)}}),this.treeList.inject(this.immersiveFrame.getFreeZone()),this._setupLogic();var r=new i(this.immersiveFrame,this.selectionModel,this.model,{identifier:this.identifier}),a=new n(this.immersiveFrame,this.treeActionsModel,this.model,{identifier:this.identifier});if(this.optionsModel.haveCatiaV5Data=this.haveCatiaV5Data,(this.haveCatiaV5Data||this.clearConfigurations)&&this.treeActionsModel.actions&&this.treeActionsModel.actions.includes(EnoTreeNodeAction.Duplicate))new o(this.immersiveFrame,this.optionsModel,{identifier:this.identifier,haveCatiaV5Data:this.haveCatiaV5Data,clearConfigurations:this.clearConfigurations});a.haveStoredPlacement()||a.panel.attachToWindow(r.panel,WUXSnapAreaEnum.InsideArea,"after"),this.model.addEvent("OnTreeInitialized",function(){this.treeList.tree.getRoots().forEach(function(e){v.getNode(e.options.assembly,e.options.nodeId).isFilteredRoot&&e.setBadges({bottomRight:"filter"})})},this);var d=function(){r.updateUI(),a.updateUI()};this.model.addEvent("OnSelChangeTree",function(e){d()}),d(),this.dispatchEvent("onTreeListCreated")},_setupLogic:function(){var e=this,t=this.model,i=(this.optionsModel,this.selectionModel),n=this.treeActionsModel,o=new a(t);i.addEvent("OnClearSelection",function(){t.clearSelection()}),i.addEvent("OnAddSelection",function(e){o.filterNodes(e).forEach(function(e){e.select()})}),i.addEvent("OnRemoveSelection",function(e){o.filterNodes(e).forEach(function(e){e.unselect()})}),this.model.addEvent("onDupActionChangeTree",function(t){var i=!1;t.nodes.forEach(function(t){var n=t.node.getAction();n===EnoTreeNodeAction.DuplicateWDrw&&(i=!0);var o=t.node.dupActionToIndex[n];e._updateChildTree(o,t.node)}),i&&g.dispatchEvent(duplicateWidgetEvents.includeAllDrwOptionSet,!1)});var s=function(e){var t;"function"==typeof e.forEach?t=e:(t=[]).push(e);var i=[];return t.forEach(function(e){i=i.concat(e.getChildren())}),i.forEach(function(e){i=i.concat(s(e))}),i},r=function(e,i,o){var r=(null==o?n.ApplyToAll:o)?t.getAllNodes():t.getSelectedNodes();if(e&&!n.ApplyToAll){var a=s(r);r=r.concat(a)}return i&&!n.ApplyToAll&&(r=t.appendInstances(r)),r},c=function(){return!1===n.ApplyToAll&&!0===n.ApplyTextToChildren},u=function(e,i,n){try{t.setBatchMode(!0),r(!1,!0,n).forEach(function(t){if(i){var n=function(e,t){e.getChildren().forEach(function(e){n(e,t)}),e.setAction(t)};n(t,e)}else t.setAction(e)})}finally{t.setBatchMode(!1)}};n.addEvent("OnApplyAction",function(){var e=d.groupActionToNodeAction(n.GroupAction),t=d.groupActionToRecursive(n.GroupAction);u(e,t,n.ApplyToAll)}),n.addEvent("OnApplySelectionAction",function(e){u(e,!1,!1)});var p=function(t,i){e.propagateTitleEditToInstances=!1,t.setNewTitle(i),e.propagateTitleEditToInstances=!0};n.addEvent("OnAddPrefixText",function(){r(c(),!0).forEach(function(e){p(e,n.Text+e.getNewTitle())})}),n.addEvent("OnAddPostfixText",function(){r(c(),!0).forEach(function(e){var t,i;p(e,(t=e.getNewTitle(),i=n.Text,t+i))})}),n.addEvent("OnReplace",function(){r(!1,!0).forEach(function(e){p(e,l.replace(e.getNewTitle(),n.FindText,n.ReplaceText))})}),n.addEvent("OnReset",function(){r(!1,!0).forEach(function(t){e.propagateTitleEditToInstances=!1,t.reset(),e.propagateTitleEditToInstances=!0})})},_updateTree:function(){if(this.treeList&&this.treeList.tree){var e=this.treeList.tree.getManager();e&&e.updateView()}},relatedObjectsPromise:function(e){var t=h.get3DSpaceWSUrl(this.tenant,"/resources/lifecycle/duplicate/relatedobjects",null);let i={ids:[this.roots[0].id],RelatedObjectsUUID:this.options.relatedObjects.providerUUID};return C.post(t,JSON.stringify(i),{securityContext:e,timeout:6e5})},convertRelatedObjectsToExpandFormat:function(e){let t=e.results.map(e=>({path:e.attributes.filter(e=>"did"===e.name).filter(e=>e).map(e=>parseInt(e.value))}));return t=t.filter(e=>e.path&&e.path.length>0),{results:[...e.results,...t]}},queryData:function(e,t){let i=this.options.expand.providerUUID?this.expandStructureDelegatedPromise(e,t):UWA.Promise.resolve(null);var n=this;UWA.Promise.all([i,relatedObjectsPromise]).then(e=>{let t=null;e[1]&&e[1].data&&e[1].data.results&&(t=e[1].data.results),n.expandDone(e[0]),n.createTreeUI({relatedObjects:t})}).catch(function(e){console.error("expand failed:",e);var t=x.expandFailed+": ";e.isTimeout?t+=x.connectionTimeout:t+=e?e.error?e.error:e:"",n.options.showError(t)})}})}),define("DS/DuplicateWidget/DuplicateWidget",["UWA/Controls/Abstract","DS/ENO6WPlugins/jQuery","UWA/Class/Model","DS/Utilities/TouchUtils","i18n!DS/DuplicateWidget/assets/nls/DuplicateWidgetNls","i18n!DS/LifecycleWidget/assets/nls/LifecycleWidgetNls","i18n!DS/LifecycleServices/assets/nls/LifecycleServicesNls","DS/Windows/ImmersiveFrame","DS/LifecycleServices/LifecycleCommandManager","DS/LifecycleControls/DelayedMask","DS/WAFData/WAFData","DS/LifecycleServices/WebReq","DS/LifecycleServices/LifecycleServices","DS/LifecycleServices/LifecycleServicesSettings","DS/LifecycleServices/LifecycleAlert","DS/LifecycleServices/IllegalCharMapping","DS/LifecycleServices/Utils","DS/LifecycleControls/InputValidation","DS/LifecycleControls/CredentialList","DS/LifecycleServices/DefaultCredential","DS/DuplicateWidget/AdvancedDuplicateTree","DS/DuplicateWidget/AlertBar","DS/DuplicateWidget/utils/IdNs","DS/LifecycleControls/CommandDialog","DS/LifecycleCmd/MessageMediator","DS/WidgetServices/WidgetServices","DS/LifecycleCmd/TargetFolderUtil","DS/DuplicateWidget/ExpandReqBuilder","text!DS/DuplicateWidget/assets/html/simpledup.html","DS/LifecycleControls/DataGridViewContainer","DS/LifecycleControls/RelatedObjectsControl","DS/LifecycleControls/RelatedObjectsDialog","DS/DuplicateWidget/ExtensibilityConstants","DS/DuplicateWidget/expandTree/duplicateExpand","css!DS/LifecycleControls/LifecycleControls","css!DS/LifecycleControls/assets/styles/InputValidation","css!DS/DuplicateWidget/DuplicateWidget"],function(e,t,i,n,o,s,r,a,d,l,c,u,p,h,f,g,m,v,D,y,S,C,A,E,x,b,T,_,w,N,I,W,L,M){"use strict";return e.extend({physicalid:"",supportedObjects:null,multiselect:!1,selType:"",context:null,tenant:null,NLVIntents:"",obj2expandProviders:new Map,init:function(){var e=this;this.roots=[],this.supportedObjects=[],o=m.createDbgNlsProxy(o),this.illegalChars="",this.IllegalCharMapping=new g,this.duplicateOptions=[],this.duplicateCaps={},this.commandManager=new d,this.simpleDupInputChecker=function(){return!(e._SimpleDupInputValidation&&!e._SimpleDupInputValidation.isInputValid(1))},this.advDupInputChecker=function(){return!(e.treeInputValidation.inputValidator&&!e.treeInputValidation.inputValidator.isInputValid(1))},this.inputChecker=this.simpleDupInputChecker,this.usingAdvancedDuplicate=!1},_getTargetFolderId:function(){var e=T.getTargetFolderId(this.context);try{if(void 0!==h.getActiveFolder){var t=h.getActiveFolder();null!==t.id&&""!==t.id&&void 0!==t.id&&(e=t.id,require(["DS/PlatformAPI/PlatformAPI"],function(e){e.publish("FolderEditor.ActiveFolderCallBack",{id:t.id,label:t.label})}))}}catch(t){e=T.getTargetFolderId(this.context)}return e},verifyTargetFolder:function(){return this.folderId=this._getTargetFolderId(),null!==this.folderId||!h.getEnforceFolderLinkSetting()},_getUniqueListBy:function(e,t){return[...new Map(e.map(e=>[e[t],e])).values()]},executeCmd:function(e,t,i){if(e=this._getUniqueListBy(e,"physicalid"),this.addEvent("onReady",function(){this._showCommandUI(e)},this),this.addEvent("onComplete",function(e){i()}),this.context=t.context||{},this.selType=e.length>0?e[0].type:"",this.context.displayNotification=(e=>{this._displayNotification(e)}),!this.verifyTargetFolder())throw o.noFolderSelected;this.setObjects(e)},_showCommandUI:function(e){var t=this;this._execDup=function(){t.inputChecker()&&(t.commandDialog&&t.commandDialog._disableUI(),r._executeDuplicate(function(e){e?(t._saveDlgSize(),a.destroy(),r._onComplete()):a.updateUI()}))};var i=this._renderDialogContent(),n="";this.multiselect?(n=" - "+this.supportedObjects.length+" "+s.multipleSelectionObjects,this.dgvContainer.inject(i.firstChild,"top"),!0===this.dgvContainer.options.clickToShowDGV&&i.addClassName("hasExpander")):n=` - ${e[0].name} ${e[0].revision}`;var r=this,a=new E,d=a.create(i,{title:o.duplicate+n,OKBtnText:o.duplicate,closeButton:!0,imageUrl:e[0].imageUrl||"",resizable:!0,powerMaximize:!0,onOk:this._execDup,onClose:function(){t._saveDlgSize(),r._onComplete()}});this._setupEventListeners(i),this.commandDialog=a,this.dialog=d,d.inject(widget.body),d.elements.body.setStyle("height","100%"),d.elements.container.addClassName("dupDlg"),this.multiselect&&d.elements.container.addClassName("multiSel"),this._isDesktopMode()&&d.elements.container.setAttribute("desktop-mode",""),this.commandDialog.addEvent("widget-maxmized-changed",function(e){e&&t.usingAdvancedDuplicate&&t.commandDialog.maximize(!0)}),this.commandDialog&&this.commandDialog.setPowermaximizeVisibility(!1);var l=this._isDesktopMode()?0:30;this.duplicateCaps.includeChildrenDyn&&(l+=25);var c=this.multiselect?600:530,u=(this.multiselect?335:242)+l;u=this.multiselect?u+24*(this.supportedObjects.length-2):u;var p=(this.multiselect?326:242)+l;this.multiselect&&!0===this.dgvContainer.options.clickToShowDGV&&(u=275,p=275),d.setNewSize({width:c,height:u}),setTimeout(function(){d.setMinSize(440,p),d.dispatchEvent("UICreated"),t.dispatchEvent("UICreated")},10),this._setupSimpleDupInputValidation(e[0].name||""),this._adjustModalBody(!0);var h=this.dialog.elements.footer.querySelector("button.btn-primary");h.disabled=!0;var f=this.dialog.elements.container.querySelector("#enolcm-dup-simple-expander");f&&(f.style.pointerEvents="none",f.classList.add("enolcm-dup-disabled-div"));var g=this.idns.getElById("cred-combo").wuxControl;g.elementsList=[o.loadingText],UWA.Promise.all([this.credListLoader,this.defSecCtxLoader]).then(e=>{e.length<2||!UWA.is(e[0],"array")?console.error("Missing credentials"):(D.filterCredentials(this.tenant,e[0],"duplicate").then(t=>{if(t.length>0){let n=t.map(t=>{let i=e[0].filter(e=>e.ctx===t);return{displayName:i?i[0].displayName:t,ctx:t}});var i=(n=n.sort((e,t)=>e.displayName.localeCompare(t.displayName,void 0,{numeric:!0,sensitivity:"base"}))).map(e=>({labelItem:e.displayName,valueItem:e.ctx}));g.elementsList=i,g.value=e[1],h.disabled=!1,f&&(f.style.pointerEvents="",f.classList.remove("enolcm-dup-disabled-div"))}else{let e=[{labelItem:o.noCredentials}];g.elementsList=e,g.value=e[0].labelItem}}).catch(e=>{console.error("FAiled to call credential filter svc, error:",e),this.showError(o.errCredFilterSvc)}),widget.dispatchEvent("CredentialUiCreated",g))})},_isDesktopMode:function(){return!n.getTouchMode()},_adjustModalBody:function(e){this.dialog.elements&&this.dialog.elements.body&&(e?(this.dialog.elements.body.setStyle("padding-top","2px"),this.dialog.elements.body.setStyle("padding-bottom","2px"),this.dialog.elements.body.setStyle("padding-left","6px"),this.dialog.elements.body.setStyle("padding-right","6px")):(this.dialog.elements.body.setStyle("padding-top","1px"),this.dialog.elements.body.setStyle("padding-bottom","1px"),this.dialog.elements.body.setStyle("padding-left","2px"),this.dialog.elements.body.setStyle("padding-right","2px")))},_openAdvancedDup:function(e){this._delayedMask||(this._delayedMask=new l(e,1e3,o.loadingText)),this.dialog.elements.container.addClassName("dupAdv"),"function"==typeof this.dialog._handleWidgetResize&&this.dialog._handleWidgetResize(),this._openAccordion(this.dialog,e)},_closeAdvancedDup:function(){this._closeAccordion(this.dialog)},_setupEventListeners:function(e){this.commandManager.addEvent("onOpenAccordion",function(e){this._openAdvancedDup(e.div)},this),this.commandManager.addEvent("onCloseAccordion",function(e){this._closeAdvancedDup()},this)},_typeHasIllegalChars:function(){return this.haveVPMReference},_setupSimpleDupInputValidation:function(e){if(this._typeHasIllegalChars()){this._SimpleDupInputValidation=new v;var t=this.dialog.elements.body.querySelector("#enolcm-dup-simple-addtext-input > input");if(t){var i=this.dialog.elements.footer.querySelector("button.btn-primary");this._SimpleDupInputValidation.addValidateElement(t,this._getInputValidators(e.length),!1,1),this._SimpleDupInputValidation.addSubmitElement(i,1)}}},_dupOptions2Caps:function(e){let t={addPrefix:!1,defaultPrefix:null,includeChildren:!1,includeChildrenDefaultValue:!1,clearConfigurations:!1,includeChildrenDyn:!1,includeChildrenLabelDyn:null,advanced:!1,relatedObjects:!1},i=this._getOptionsHelper(e);return t.addPrefix=i.prefix(),t.defaultPrefix=i.defaultPrefix(),i.wholeStructure()&&(t.includeChildren=!0),i.wholeStructureDyn()&&(t.includeChildrenDyn=!0,t.includeChildrenLabelDyn=i.getWholeStructureName(o["dlg-incChildren"])),t.includeChildrenDefaultValue=i.getWholeStructureDefault(!0),t.advanced=i.advanced(),t.relatedObjects=i.relatedObjects(),t.clearConfigurations=i.clearConfigurations(),t},_mergeOptionsAndCaps:function(e,t){let i=this._dupOptions2Caps(e);return t.addPrefix=i.addPrefix||t.addPrefix,t.advanced=i.advanced&&t.advanced,t.includeChildren=i.includeChildren||t.includeChildren,t},_selectRelatedObjects:function(){let e=new W,t=this.supportedObjects[0].physicalid,n=new i({source:"3DSpace",tenant:this.tenant,objectId:t,id:t});e.create({parentContainer:widget.body,model:n}).then(e=>{this.roots=this.roots.concat(e.map(e=>e.id)),this.simpleDupViewModel._openAdvanced(),this._selectRelatedObjects=(()=>{this.simpleDupViewModel._openAdvanced()})}).catch(e=>{console.log("Rel obj dialog cancel: ",e)})},_renderDialogContent:function(){var e=UWA.createElement("div",{class:"duplicate_popup dlg_cmd_content"}),t=this;this.simpleDupViewModel={includeChildren:!!this.duplicateCaps.includeChildrenDefaultValue,text:"",useAdvanced:!1,openAdvanced:function(){t.duplicateCaps.relatedObjects&&!t.multiselect?t._selectRelatedObjects():t.simpleDupViewModel._openAdvanced()},closeAdvanced:function(){t.simpleDupViewModel.useAdvanced=!1,t._closeAdvancedDup()},onTextChange:function(e,i,n){t.simpleDupViewModel.text=e},duplicate:function(){t._execDup()},_openAdvanced:function(){t.simpleDupViewModel.useAdvanced=!0,t._openAdvancedDup(n)}},this.multiselect&&(this.simpleDupViewModel.includeChildren=!1);var i=new A(e,"enolcm-dup-simple-");this.idns=i,o["dlg-incChildren-dynamic"]=this.duplicateCaps.includeChildrenLabelDyn,i.elementFromTemplate(w,null,o,this.simpleDupViewModel).inject(e),i.getElById("wholestructure").addEventListener("change",function(e){var t=i.getElById("wholestructureDyn");t&&(t.wuxControl.checkFlag=this.wuxControl.checkFlag)}),i.getElById("wholestructureDyn").addEventListener("change",function(e){var t=i.getElById("wholestructure");t&&(t.wuxControl.checkFlag=this.wuxControl.checkFlag)});var n=i.getElById("advanced-content"),s=function(e){var t=i.getElById(e);t.parentElement.removeChild(t)};if(this.duplicateCaps.addPrefix?setTimeout(function(){var e=i.getElById("addtext-input");if(e){var t=e.querySelector("input");t&&(t.setSelectionRange(0,t.value.length),t.focus())}},100):(s("addtext-label-container"),s("addtext-input-container")),this.duplicateCaps.defaultPrefix){var r=i.getElById("addtext-input").querySelector("input");r&&r.parentElement&&r.parentElement.wuxControl&&(r.parentElement.wuxControl.value=this.duplicateCaps.defaultPrefix),this.simpleDupViewModel.text=this.duplicateCaps.defaultPrefix}return this.duplicateCaps.includeChildren||s("wholestructure"),this.duplicateCaps.includeChildrenDyn||s("wholestructureDynContainer"),this.duplicateCaps.advanced||this.duplicateCaps.relatedObjects&&!this.multiselect||(s("advanced-content"),s("expander"),s("collapser")),this.HTMLContent=e,e},_getOptionsHelper:function(t){return new(e.extend({init:function(e){this.dupOpts=e},prefix:function(){return 0!==this._findKey("prefix").length},defaultPrefix:function(){return this.prefix()?this._findKey("prefix")[0].value:null},setPrefix:function(e){let t=!1;for(var i=0;i<this.dupOpts.length;i++)"prefix"===this.dupOpts[i].key&&(this.dupOpts[i].value=e,t=!0);t||this.dupOpts.push({key:"prefix",value:e})},wholeStructure:function(){var e=this._findKey("wholeStructure");return(1!==e.length||!e[0].variation||"drawing"!==e[0].variation)&&0!==e.length},wholeStructureDyn:function(){var e=this._findKey("wholeStructure");if(!(e.length>0))return!1;for(var t=0;t<e.length;t++)if(e[t].variation&&"drawing"===e[t].variation)return!0},setWholeStructure:function(e){let t=!1;for(var i=0;i<this.dupOpts.length;i++)"wholeStructure"===this.dupOpts[i].key&&(this.dupOpts[i].value=e,t=!0);t||this.dupOpts.push({key:"wholeStructure",value:e})},getWholeStructureName:function(e){var t=this._findKey("wholeStructure");if(t.length>0)for(var i=0;i<t.length;i++)if(t[i].variation&&"drawing"===t[i].variation)return t[i].nlsKey;return e},getWholeStructureDefault:function(e){var t=this._findKey("wholeStructure");return t.length>0&&void 0!==t[0].value?t[0].value:e},advanced:function(){return 0!==this._findKey("advanced").length},relatedObjects:function(){return 0!==this._findKey("relatedObjects").length},clearConfigurations:function(){return 0!==this._findKey("clearConfigurations").length},setUseAdvanced:function(e){let t=!1;for(var i=0;i<this.dupOpts.length;i++)"advanced"===this.dupOpts[i].key&&(t=!0,!1===e&&!0!==this.dupOpts[i].usingAdvancedDuplicate||(this.dupOpts[i].usingAdvancedDuplicate=e));t||this.dupOpts.push({key:"advanced",value:!0,usingAdvancedDuplicate:e})},_findKey:function(e){return this.dupOpts.filter(function(t){return t.key===e})}}))(t)},_updateOptionsFromViewModel:function(){if(this.simpleDupViewModel){var e=this._getOptionsHelper(this.duplicateOptions);e.setWholeStructure(this.simpleDupViewModel.includeChildren),e.setPrefix(this.simpleDupViewModel.text),e.setUseAdvanced(this.simpleDupViewModel.useAdvanced),this.duplicateOptions=e.dupOpts}},_getInputValidators:function(e){var t=this,i=e||0;return[{name:"illegalChars",validate:function(e){return t.strIsLegal(e)},getErrorInfo:function(e){return o.replace(o.illegalText,{illegalChars:t.illegalChars})}},{name:"maxChars",validate:function(e){return e.length+i<=100},getErrorInfo:function(e){return o.dupTooLongTitle}}]},_createAdvancedDuplicateTree:function(){var e=this,t=new S({tenant:this.tenant,inputValidator:this.treeInputValidation,showError:this.showError.bind(this)});return this.advancedDuplicateTree=t,this.advancedDuplicateTree.immersiveFrame=this.immersiveFrame,this.debugMenuItems&&(t.debugMenuItems=this.debugMenuItems),t.addEvent("expandingStructure",function(t){e.okBtn&&(e.okBtn.disabled=!0)}),t.addEvent("onTreeListCreated",function(i){e._delayedMask&&e._delayedMask.unmask(),t.treeList.onInitialUpdateView().then(function(){e.treeInputValidation.inputValidator.updateValidation(),e.inputChecker=e.advDupInputChecker,e.dispatchEvent("AdvancedUICreated",t)}),t.translationService.translationFailure&&e.showNotification("Translation failed")}),this._createAlertBar(),t},_createAlertBar:function(){var e=(new C).inject(this._getDialogElement("advdup-content"),"top");x.addEvent("Lifecycle.Duplicate.Alert",function(t){e.show(t)})},_createTreeInputValidator:function(e){var t={inputValidator:new v,validators:this._getInputValidators()};t.inputValidator.setCustomCSS({inputCSS:"tree-invalid-input",infoIconCSS:"tree-info-icon-invalid-input"}),t.haveIllegalChars=((e,t)=>this.IllegalCharMapping.mappings&&this.IllegalCharMapping.mappings.data&&this.IllegalCharMapping.mappings.data.hasOwnProperty(t));var i=e.getContainer?e.getContainer():e.elements?e.elements.container:null;return this.okBtn=i?i.querySelector(".btn-primary"):null,this.okBtn&&t.inputValidator.addSubmitElement(this.okBtn),t},_getSecurityContext:function(){return y.loadDefaultContexCredential({tenant:this.tenant,context:this.context})},_getSelectedSecurityContext:function(){return UWA.Class.Promise.resolve(this.idns.getElById("cred-combo").wuxControl.value)},getPADSessionPromise:function(){var e=this;return new UWA.Class.Promise(function(t,i){require(["DS/PADUtils/PADSession"],function(i){e.hasRequestedPADSession=!0,e.PADSession=i,t(e.PADSession)},function(i){e.hasRequestedPADSession=!0,e.PADSession=null,t(e.PADSession)})})},_getPADSession:function(){return this.hasRequestedPADSession?UWA.Class.Promise.resolve(this.PADSession):this.getPADSessionPromise()},_getAuthoringMode:function(){if(this.context&&"function"==typeof this.context.isIndexMode)return UWA,Promise.resolve(!this.context.isIndexMode());var e=this;return new UWA.Class.Promise(function(t,i){widget&&p.isInPSEditorWidget(widget)?e._getPADSession().then(function(e){var i=!0;e&&(i=e.determineAuthoredFlag()),t(i)}):t(!0)})},_createImmersiveFrame:function(e){var t="4046f1f2-6823-11e9-a923-1681be663d3e";window.c145ae486a7011e9a9231681be663d3e&&(t=void 0);var i=new a({identifier:t});i.dockingElements.forEach(function(e){e._properties.side.value===WUXDockAreaEnum.TopDockArea||e._properties.side.value==WUXDockAreaEnum.BottomDockArea?e._properties.dockingZoneSize.value=120:e._properties.side.value!==WUXDockAreaEnum.LeftDockArea&&e._properties.side.value!=WUXDockAreaEnum.RightDockArea||(e._properties.dockingZoneSize.value=230)});var n=UWA.createElement("div",{class:"immersive-frame-parent"});return n.inject(e),i.inject(n),i},_openAccordion:function(e,t){var i=this;this.immersiveFrame||(this.immersiveFrame=this._createImmersiveFrame(t)),this.treeInputValidation&&(this.treeInputValidation.inputValidator.updateValidation(),this.inputChecker=this.advDupInputChecker),this.treeInputValidation=this.treeInputValidation||this._createTreeInputValidator(e),this.advancedDuplicateTree=this.advancedDuplicateTree||this._createAdvancedDuplicateTree(),this.defSecCtxLoader.then(function(n){i.disableWholeStructureCheckbox(),i.setPrefixOrSuffixEditDisabledState(!0),i.inputValidation=i.inputValidation||new v(t,i._getInputValidators());var o=UWA.createElement("div",{class:"duplicate_tree_container"});if(t.appendChild(o),i.advRootContainer=e.getContainer?e.getContainer():e.elements?e.elements.container:null,i._hideShowOpts(i.advRootContainer,!0),!i.loadedAdvancedUI){i.loadedAdvancedUI=!0;let e=new M({roots:i.roots,securityContext:n,tenant:i.tenant,expandReqBuilder:new _(i.context),objId2ExpandProvider:i.obj2expandProviders,getAuthoringMode:i._getAuthoringMode.bind(i)});i.dispatchEvent("onTreeLoaderCreated",e),i.advancedDuplicateTree.loadUI({immersiveFrame:i.immersiveFrame,parentElement:o,securityContext:n,treeLoader:e,clearConfigurations:i.duplicateCaps.clearConfigurations})}i._adjustDialogSizeLarge(e),e.centerIt(),i._adjustModalBody(!1),i.usingAdvancedDuplicate=!0})},_adjustDialogSizeLarge:function(e){if(!this.dialog.isMaximized){var t=this._loadSize("advDupLarge"),i=this._getCurrentSize(e);this._storeSize("advDupSmall",i),e.setNewSize(t?{width:t.width,height:t.height}:{width:2*i.width,height:480}),this.commandDialog&&this.commandDialog.isWidgetMaximized()&&this.commandDialog.maximize(!0)}},_adjustDialogSizeSmall:function(e){if(!this.dialog.isMaximized){var t=this._loadSize("advDupSmall"),i=this._getCurrentSize(e);this._storeSize("advDupLarge",i),e.setNewSize(i?{width:t.width,height:t.height}:{})}},_closeAccordion:function(e){this.commandDialog&&this.commandDialog.setPowermaximizeVisibility(!1),this._SimpleDupInputValidation&&this._SimpleDupInputValidation.updateValidation(),this.inputChecker=this.simpleDupInputChecker,this._hideShowOpts(this.advRootContainer,!1),this.enableWholeStructureCheckbox(),this.setPrefixOrSuffixEditDisabledState(!1),this._adjustDialogSizeSmall(e),this._adjustModalBody(!0),this.usingAdvancedDuplicate=!1},_getCurrentSize:function(e){var t=e.getModalBodySize();return t.height=e.getContainerHeight(),t},_saveDlgSize:function(){var e="advDupSmall";this.usingAdvancedDuplicate&&(e="advDupLarge");var t=this._getCurrentSize(this.dialog);this._storeSize(e,t)},_loadSize:function(e){var t=widget.getValue(e);return t?JSON.parse(t):null},_storeSize:function(e,t){widget.getValue(e)||widget.addPreference({name:e,type:"hidden",defaultValue:"{}"}),widget.setValue(e,JSON.stringify(t))},_onComplete:function(){this.dispatchEvent("onComplete",{})},_getDialogElement:function(e){return this.HTMLContent?this.HTMLContent.getElementsByClassName(e)[0]:null},getWholeStructureCheckbox:function(){return this._getDialogElement("lifecycle-option-wholeStructure")},getPrefixOrSuffixEdit:function(){var e=this._getDialogElement("lifecycle-option-suffix");return e||(e=this._getDialogElement("lifecycle-option-prefix")),e},enableWholeStructureCheckbox:function(){var e=this.getWholeStructureCheckbox();e&&(e.disabled=!1,e.checked=this.wholeStructureCheckboxSaved)},disableWholeStructureCheckbox:function(){var e=this.getWholeStructureCheckbox();e&&(e.disabled=!0,this.wholeStructureCheckboxSaved=e.checked,e.checked=!1)},_getOptions:function(e,t){return new UWA.Promise((t,i)=>{this.commandManager.addEvent("onCompleteGetOptions",function(e){let n=this.supportedObjects.length;if(this._updateSupportedObjectList(e.objects),0===this.supportedObjects.length){let e=n>1?o.noSupportedObjectsInSel:o.errDup3dpart;return this.closeWithError(e),void i(e)}this.roots=this.supportedObjects.map(e=>e.physicalid),void 0!==e.options&&e.options.forEach(function(e){"NLV"===e.key&&(this.NLVIntents=e.value)},this),t(e)},this);var n=this,s={data:e,command:"duplicate"};this.commandManager.getOptions(s,function(e){n.closeWithError(e),i(e)},this.context)})},_getCapabilites:function(e,t){return new UWA.Promise((i,n)=>{let o=h.get3DSpaceWSUrl(this.tenant,"/resources/lifecycle/duplicate/capabilites",null),s={data:e,command:"duplicate"};u.post(o,JSON.stringify(s),{securityContext:t}).then(e=>{console.log("capabilites response:",e);let t=0,n={providers:[],addPrefix:!1,advanced:!1,includeChildren:!1,relatedObjects:!1,clearConfigurations:!1};e.providers.forEach(e=>{let i={clearConfigurations:!1},o=new Map;if(e.capabilities.forEach(e=>{o.set(e.id,e)}),o.has(L.OperationCapabilites.Expand)&&(i.includeChildren=i.advanced=!0,n.includeChildren=!0,t++),o.has(L.OperationCapabilites.IncludeStructrualObjects)){let e=o.get(L.OperationCapabilites.IncludeStructrualObjects);e.haveDefault&&(n.includeChildrenDefaultValue=e.value)}if(o.has(L.OperationCapabilites.AddPrefix)){i.addPrefix=!0,n.addPrefix=!0;let e=o.get(L.OperationCapabilites.AddPrefix);e.haveDefault&&(n.defaultPrefix=e.value)}o.has(L.OperationCapabilites.RelatedObjects)&&(i.advanced=!0,t++),o.has(L.OperationCapabilites.ClearConfigurations)&&(i.clearConfigurations=!0,n.clearConfigurations=!0),i.expandProviderUUID=e.expandID,i.expandOpts=e.expandOptions,i.relatedObjectsProviderUUID=e.relatedObjectsID,i.objectIds=e.objectIds,i.providerClass=e.providerClass,n.providers.push(i)}),n.advanced=t===e.providers.length,i(n)})})},setPrefixOrSuffixEditDisabledState:function(e){var t=this.getPrefixOrSuffixEdit();t&&(t.disabled=e)},setObjects:function(e){var t=this;if(this.data=e,0===e.length)throw o.noObject;var i=e[0];if(i.hasOwnProperty("physicalid")&&""===i.physicalid)throw o.epmtyPhysicalId;this.roots.push(i.physicalid),this.supportedObjects=e,this.multiselect=this.data.length>1,this.tenant=i.tenant,this.commandManager.setTenant(this.tenant),this.defSecCtxLoader=this._getSecurityContext(),this.credListLoader=D.loadCredentials(this.tenant);let n=null;this.defSecCtxLoader.then(t=>(n=t,this._getOptions(this.supportedObjects.length>0?this.supportedObjects:e,t))).then(e=>(this.duplicateOptions=e.options,this._initIllegalCharMappings(),e.hasExtProviders&&e.hasExtProviders.length>0?this._getCapabilites(e.hasExtProviders,n):this._dupOptions2Caps(e.options))).then(e=>{this.duplicateCaps=this.duplicateOptions.length>0?this._mergeOptionsAndCaps(this.duplicateOptions,e):e,this._createProviderMap(e),this.multiselect&&this._createMultiselDatagrid(),t.dispatchEvent("onReady")}).catch(e=>{console.log(e)})},_createProviderMap(e){e.providers&&(this.obj2expandProviders=new Map,e.providers.forEach(e=>{e.objectIds.forEach(t=>{this.obj2expandProviders.has(t)||this.obj2expandProviders.set(t,[]),e.expandProviderUUID&&this.obj2expandProviders.get(t).push(e.expandProviderUUID)})}))},_initIllegalCharMappings:function(){this.haveVPMReference=this.supportedObjects.some(function(e){return"VPMReference"==e.type}),this.supportedObjects.forEach(e=>{var t=e.CADOrigin||"CATIAV5",i="";"CATIAV5"===t&&(i=":!"),this.IllegalCharMapping.addCADType(t,i)}),console.log("BEGIN: Getting illegal char mappings"),this.IllegalCharMapping.getMappings().then(e=>{console.log("END: Getting illegal char mappings"),this.illegalChars=e.find("CATIAV5")||""})},_createMultiselDatagrid:function(){this.dgvContainer=new N({idName:"dgvContainer",clickToShowDGV:!1},this.supportedObjects)},_updateSupportedObjectList:function(e){if(!e)return;let t=e.filter(e=>e.IsOnceInstantiable).map(e=>e.physicalid);this.supportedObjects=this.supportedObjects.filter(e=>!t.includes(e.physicalid))},closeWithError:function(e){this.showError(e),this._onComplete()},_maskDialog:function(){var e=null,t=this.dialog.getContainer?this.dialog.getContainer():this.dialog.elements?this.dialog.elements.container:null;if(t){var i=t.querySelector("#enolcm-dup-simple-mainContainer");i&&(e=new l(UWA.extendElement(i),1e3,o.duplicatingText))}return{unmask:function(){e&&e.unmask()}}},_generateDuplicateServiceReqPayload:function(){var e=this.getDuplicateData(),t=!1,i=!1;return this.usingAdvancedDuplicate&&(t=this.advancedDuplicateTree.optionsModel.IncludeDrawings,i=this.advancedDuplicateTree.optionsModel.KeepConfig),{data:e,options:this.duplicateOptions,folderid:this.folderId,NLVEnabled:this.NLVIntents&&this.NLVIntents.length>0,includeDrawings:t,keepConfig:i}},_executeDuplicate:function(e){if(this.verifySuffix()&&this.verifyPrefix()){if(!this.verifyTargetFolder())return this.showError(o.noFolderSelected),void e(!1);var t=this._generateDuplicateServiceReqPayload();if(this.verifyTitle(t.data)){var i=this._maskDialog(),n=function(){document.body.style.cursor="default",i.unmask(),e(!0)},s=this;this._getSelectedSecurityContext().then(function(e){s.duplicateServiceRequest(t,e,n)}).catch(function(e){var t=p.parseWebServiceError(e);s.showError(t)})}else e(!1)}else e(!1)},getDuplicateOptionValue:function(e){for(var t=0;t<this.duplicateOptions.length;++t)if(this.duplicateOptions[t].key===e)return this.duplicateOptions[t].value},getDuplicateOptionNlsKey:function(e){for(var t=0;t<this.duplicateOptions.length;++t){if(this.duplicateOptions[t].key===e)return this.duplicateOptions[t].nlsKey.substring(0,this.duplicateOptions[t].nlsKey.length-1)}},strContainsNonASCII:function(e){if(e)for(var t=0;t<e.length;++t){if(e.charCodeAt(t)>127)return!0}return!1},strContainsIllegalChars:function(e,t){return!!(e&&b.commonChar(e,this.illegalChars,!0)>0)},strIsLegal:function(e){return!this.strContainsIllegalChars(e,this.illegalChars)},verifyDuplicationString:function(e,t){return null==e||(!!this.strIsLegal(e)||(this.showError(o.replace(o.illegalChar,{label:t,illegalChars:this.illegalChars})),!1))},verifySuffix:function(){var e=this.getDuplicateOptionValue("suffix"),t=this.getDuplicateOptionNlsKey("suffix");return!!this.verifyDuplicationString(e,t)&&(!this.strContainsNonASCII(e)||(this.showError(o.replace(o.nonAsciiChar,{label:t})),!1))},verifyPrefix:function(){return this.verifyDuplicationString(this.getDuplicateOptionValue("prefix"),this.getDuplicateOptionNlsKey("prefix"))},verifyTitle:function(e){return!this.usingAdvancedDuplicate||(!e.some(function(e){return"duplicate"===e.operation&&!this.strIsLegal(e.title)},this)||(this.showError(o.replace(o.illegalTitle,{illegalChars:this.illegalChars})),!1))},getDuplicateData:function(){return this.usingAdvancedDuplicate?this.advancedDuplicateTree.getTreeNodesData():this.supportedObjects.map(e=>({physicalid:e.physicalid}))},showNotification:function(e,t){if(t=t||{},this.context&&"function"==typeof this.context.displayNotification){var i={eventID:"string"==typeof t.type?t.type:"primary",msg:e,sticky:t.sticky||!1};this.context.displayNotification(i)}else alert(e)},showSuccess:function(e,t){if(this.context&&"function"==typeof this.context.displayNotification){var i={eventID:"string"==typeof t?t:"success",msg:e};this.context.displayNotification(i)}else alert(e)},showError:function(e){if(this.context&&"function"==typeof this.context.displayNotification){var t={eventID:"error",msg:e.message||e};this.context.displayNotification(t)}else alert(e)},_displayNotification:function(e){f.displayNotification(e)},duplicateServiceRequest:function(e,t,i){var n=this;this._updateOptionsFromViewModel();e.notificationTimeout=600;var s=h.get3DSpaceWSUrl(this.tenant,"/resources/lifecycle/duplicate/structure"),r=h.getHeaders(t);document.body.style.cursor="wait",c.authenticatedRequest(s,{method:"POST",headers:r,timeout:6e5,onComplete:function(t){if(i(),null!=t&&t.hasOwnProperty("status")){if("failure"===t.status)return void(t.hasOwnProperty("report")&&0!==t.report.length?n.showError(t.report[0].error):n.showError(o.duplicateFailed));n.showSuccess(o.duplicateSuccessful),t.hasOwnProperty("report")&&0!==t.report.length&&(t.report[0].error?n.showNotification(t.report[0].error):t.report[0].warning&&n.showNotification(t.report[0].warning))}var s=n.getCreatedObjectsToDisplay(t.results),r={created:[],deleted:[],modified:[]};r.context=n.context;for(var a=0;a<s.length;++a){var d={physicalid:s[a].physicalid,sourceObjectId:s[a].sourceid?s[a].sourceid:e.data[a].physicalid,operation:"Duplicate"},l=[n.folderId];d.folders=l,r.refreshFolder=!0,r.created.push(d)}x.dispatchEvent("onModification",r)},data:JSON.stringify(e),onFailure:function(e,t){i(),p.showWebServiceError(e,t,function(e,t){t?n.showNotification(o.notificationTimeoutInfo,{sticky:!0}):n.showError(o.duplicateFailed+"<br>"+e)},!0),console.log("Duplicate failed:",e,t)},onTimeout:function(){i(),n.showNotification(o.notificationTimeoutInfo,{sticky:!0}),console.log("Duplicate: Timeout error")},type:"json"})},isDerivedFrom:function(e,t){if(void 0===t)return!1;var i=t["attribute[PLMReference.V_DerivedFrom]"],n=t.derivedFromPhysicalid;return i===e||n===e||t.sourceid===e},getCreatedObjectsToDisplay:function(e){for(var t=this,i=[],n=0;n<e[0].length;n++){var o=e[0][n];o.isRoot&&!0===o.isRoot?i.push(o):this.supportedObjects.forEach(function(e){t.isDerivedFrom(e.physicalid,o)&&i.push(o)})}return 0===i.length&&i.push(e[0][0]),i},_hideShowOpts:function(e,i){var n=this,o=function(e,t,i){if(n.idns){var o=n.idns.getElById(e);o&&o.setStyle(t,i)}};i?(e&&e.classList.add("advanced-mode"),t(e).find(".simpdup-option").slideUp(300,function(){t(this).removeClass("simpdup-option").addClass("lifecycle-option-hidden"),n.dispatchEvent("optionsHidden")}),t(e).find(".duplicate_popup_text").slideUp(300),t(e).find("#dgvContainer").slideUp(300),o("advanced-content","display","block"),o("expander","display","none"),o("collapser","display","block")):(e&&e.classList.remove("advanced-mode"),t(e).find(".lifecycle-option-hidden").slideDown(150,function(){t(this).addClass("simpdup-option").removeClass("lifecycle-option-hidden")}),t(e).find(".duplicate_popup_text").slideDown(150),t(e).find("#dgvContainer").slideDown(150),o("advanced-content","display","none"),o("expander","display","block"),o("collapser","display","none"))}})});