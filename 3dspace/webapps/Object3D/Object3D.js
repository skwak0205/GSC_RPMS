define("DS/Object3D/Object3D",["DS/Mesh/ThreeJS_Base","DS/Visualization/FixedSizeArrayPool","DS/Visualization/GeometryProcessing"],function(t,e,i){"use strict";var s=0,r=new t.Matrix4;const o=t._VisuFilterType,a=t.ProgramIDs;var n,h,l=function(e){if(e.geometry&&e.geometry.boundingSphere&&0!==e.geometry.boundingSphere.radius){var i=new t.Vector3(.259873987,.2768791234,.2458947843);i.multiplyScalar(e.geometry.boundingSphere.radius);var s=(new t.Matrix4).extractMatrix3(e._matrixWorldForDoubleGPU),r=(new t.Vector3).copy(i).applyMatrix4(s);r.x=t.SplitFloat32(r.x).high,r.y=t.SplitFloat32(r.y).high,r.z=t.SplitFloat32(r.z).high;var o=(new t.Matrix4).extractMatrix3(e.matrixWorld),n=(new t.Vector3).copy(i).applyMatrix4(o);r.sub(n),r.length()>.01?e._programID&=~a.LARGE_SCALE:(e._programID|=a.LARGE_SCALE,e._modelViewMatrix=null)}},c=function(){this.id=s++,this.name="",this.parent=void 0,this.children=[],this.up=new t.Vector3(0,1,0),this.position=new t.Vector3,this.rotation=new t.Vector3,this.eulerOrder=c.defaultEulerOrder,this.scale=new t.Vector3(1,1,1),this.worldCenter=new t.Vector3,this.worldRadius=0,this._ratioData=null,this._billboardData=null,this._programID=a.LARGE_SCALE,this.renderDepth=null,this.rotationAutoUpdate=!0,this.matrix=new t.Matrix4,this.matrixWorld=new t.Matrix4,this._matrixWorldForDoubleGPU=new t._Float32Matrix4,this._mElements=this._matrixWorldForDoubleGPU.elements,this.matrixRotationWorld=new t.Matrix4,this.modelViewInvTranspMatrix=null,this.modelViewInvMatrix=null,this.modelInvTranspMatrix=null,this._modelInvRotMatrix=null,this.matrixAutoUpdate=!0,this.matrixWorldNeedsUpdate=!0,this.quaternion=new t.Quaternion,this.useQuaternion=!1,this.visible=!0,this.visibilityFree=!1,this._castShadow=!1,this._receiveShadow=!1,this.applyBackgroundViewMode=!1,this._planeSpace=null,this._applyPlaneViewMode=!1,this._frustumCulled=!0,this.userData={},this.__webglActive=null,this.__webglInit=!1,this._modelViewMatrix=null,this._normalMatrix=null,this.orientation=0,this.boundingSphere=null,this.boundingBox=null,this.isUniformlyScaled=!0};new Float32Array(3);return c.prototype={constructor:c,_updateBackgroundViewMode(t){this.applyBackgroundViewMode=this._occurrence&&!this._occurrence._isAlwaysInForeground()&&this._occurrence.node.getLinkedToSceneGraph()&&this._occurrence.isInBackground()!==t},_computePlaneSpace(){let t=this.geometry;t.length||0===t.length||(t=[t]);let e=null;for(let s=0;s<t.length;s++){const r=t[s].drawingGroups;for(let t=0;t<r.length;t++){const s=r[t],o=i.FitPlaneSpace.compute(s.geometry,[s.start,s.start+s.count]);e=i.FitPlaneSpace.combine(e,o)}}return e||i.FitPlaneSpace.space_none()},_updatePlaneSpace(){this._planeSpace||(this._planeSpace=this._computePlaneSpace())},_canBeFittedByPlane(t){return this._updatePlaneSpace(),i.FitPlaneSpace.fit({plane:t,space:this._planeSpace,transform:this.matrixWorld})},_updatePlaneViewMode(t){this._applyPlaneViewMode=this._occurrence&&this._occurrence.node.getLinkedToSceneGraph()&&!this._canBeFittedByPlane(t)},applyMatrix:(h=new t.Matrix4,function(t){this.matrix.multiplyMatrices(t,this.matrix),this.position.getPositionFromMatrix(this.matrix),this.scale.getScaleFromMatrix(this.matrix),this.isUniformlyScaled=Math.abs(this.scale.x-this.scale.y)<1e-4&&Math.abs(this.scale.z-this.scale.y)<1e-4,this.isUniformlyScaled?this._programID&=~a.NON_UNIFORM_SCALE:this._programID|=a.NON_UNIFORM_SCALE,this._updateWorldCenterAndRadius(),h.extractRotation(this.matrix),!0===this.useQuaternion?this.quaternion.setFromRotationMatrix(h):this.rotation.setEulerFromRotationMatrix(h,this.eulerOrder)}),_getMMMatrix:function(){return this.matrixWorld},_getFilter:function(t){return this._occurrence?this._occurrence._getFilter(t):null},getFilterGeomType:function(){var t=this._getFilter(o._STATIC_GEOM_TYPE)||this._getFilter(o.GEOM_TYPE);return t?t._geomType:0},_updateWorldCenterAndRadius:function(){var e=this.matrixWorld,i=this.geometry&&this.geometry.boundingSphere;if(i?(this.worldCenter.copy(i.center),this.worldRadius=i.radius,this._billboardData&&0!==this._billboardData.type&&(this.worldRadius+=this.worldCenter.length(),this.worldCenter.set(0,0,0)),this._ratioData&&this._ratioData.ratio>0?(this._ratioData.center&&(this.worldRadius+=this._ratioData.center.length()/this._ratioData.ratio),this.worldRadius+=this.worldCenter.length(),this.worldRadius*=this._ratioData.ratio,this.worldCenter.set(0,0,0)):this.worldRadius*=e.getMaxScaleOnAxis()):(this.worldCenter.set(0,0,0),this.worldRadius=0),this.worldCenter.applyMatrix4(e),this._ratioData&&this._ratioData.ratio>0?this._programID|=a.FIXED_SIZE:this._programID&=~a.FIXED_SIZE,this._ratioData&&this._ratioData.center?this._programID|=a.FIXED_SIZE_CENTER:this._programID&=~a.FIXED_SIZE_CENTER,this._billboardData&&this._billboardData.type>=1?this._programID|=a.BILLBOARD:(this._modelInvRotMatrix=null,this._programID&=~a.BILLBOARD),this.geometry){var s=null,r=0;this.geometry.length>=0?(s=this.geometry[0],r=this.geometry.length):2===this.geometry._type&&(s=this.geometry,r=1);for(var o=0;o<r;o++){var n=this.geomWorldBE[o];s.boundingSphere&&(n||(this.geomWorldBE[o]={radius:0,center:new t.Vector3},n=this.geomWorldBE[o]),n.center.copy(s.boundingSphere.center),n.radius=s.boundingSphere.radius,this._billboardData&&0!==this._billboardData.type&&(n.radius+=n.center.length(),n.center.set(0,0,0)),this._ratioData&&this._ratioData.ratio>0?(this._ratioData.center&&(n.radius+=this._ratioData.center.length()/this._ratioData.ratio),n.radius+=n.center.length(),n.radius*=this._ratioData.ratio,n.center.set(0,0,0)):n.radius*=e.getMaxScaleOnAxis(),n.center.applyMatrix4(e)),s=this.geometry[o+1]}}},_removeFromAllStateSortingResults:function(){var t=this._tokens;if(t){for(var e in t)this._removeFromStateSortingResult(e);t={}}},_removeFromStateSortingResult:function(i){var s=this._tokens?this._tokens[i]:null;if(s){for(var r=0;r<s.length;++r){var o=s[r];if(this.isCurvedPipe){for(var a=!1,n=0;n<this.geometry.drawingGroups.length;n++){var h=this.id+"_"+n,l=t.InstancedCurvedPipeManager._perRenderableData.get(h);a=o.autoInstancingData.removeInstances(this.id,n,l)}if(!a)continue}var c=o.attachment;o.attachment=null,c.next=o.next,o.next&&(o.next.attachment=c),o.next=null;var d=c.tree;d&&null===c.next&&d.delete(c.sortId),o.instanced?e.prototype.releaseInstanced(o):e.prototype.release(o)}delete this._tokens[i]}},_flagAsGSSOInvalidated:function(){},_flagAsFrustumCulled:function(){},translate:(n=new t.Vector3,function(t,e){return n.copy(e),!0===this.useQuaternion?n.applyQuaternion(this.quaternion):n.applyEuler(this.rotation,this.eulerOrder),n.multiplyScalar(t),this.position.add(n),this}),translateX:function(){var e=new t.Vector3(1,0,0);return function(t){return this.translate(t,e)}}(),translateY:function(){var e=new t.Vector3(0,1,0);return function(t){return this.translate(t,e)}}(),translateZ:function(){var e=new t.Vector3(0,0,1);return function(t){return this.translate(t,e)}}(),lookAt:function(){var e=new t.Matrix4;return function(t){e.lookAt(t,this.position,this.up),!0===this.useQuaternion?this.quaternion.setFromRotationMatrix(e):this.rotation.setEulerFromRotationMatrix(e,this.eulerOrder)}}(),add:function(t,e){if(t!==this){if(t instanceof c){void 0!==t.parent&&t.parent.remove(t),t.parent=this,this.children.push(t);var i=this.getScene();i&&i.__addObject(t,e)}}else console.warn("Object3D.add: An object can't be added as a child of itself.")},remove:function(t){var e=this.children.indexOf(t);if(-1!==e){t.parent=void 0,this.children.splice(e,1);var i=this.getScene();i&&i.__removeObject(t)}},traverse:function(t){t(this);for(var e=0,i=this.children.length;e<i;e++)this.children[e].traverse(t)},traverseObject3DWithCondition:function(t){if(t(this))for(var e=0,i=this.children.length;e<i;e++)this.children[e].traverseObject3DWithCondition(t)},getChildByName:function(t,e){for(var i=0,s=this.children.length;i<s;i++){var r=this.children[i];if(r.name===t)return r;if(!0===e&&void 0!==(r=r.getChildByName(t,e)))return r}},getDescendants:function(t){void 0===t&&(t=[]),Array.prototype.push.apply(t,this.children);for(var e=0,i=this.children.length;e<i;e++)this.children[e].getDescendants(t);return t},updateMatrix:function(){if(this.matrix.setPosition(this.position),!1===this.useQuaternion?this.matrix.setRotationFromEuler(this.rotation,this.eulerOrder):this.matrix.setRotationFromQuaternion(this.quaternion),1===this.scale.x&&1===this.scale.y&&1===this.scale.z||this.matrix.scale(this.scale),this.isUniformlyScaled=Math.abs(this.scale.x-this.scale.y)<1e-4&&Math.abs(this.scale.z-this.scale.y)<1e-4,this.isUniformlyScaled?this._programID&=~a.NON_UNIFORM_SCALE:this._programID|=a.NON_UNIFORM_SCALE,this._updateWorldCenterAndRadius(),null!==this.modelInvTranspMatrix&&this.modelInvTranspMatrix.getInverse(this.matrixWorld).transpose(),null!==this._modelInvRotMatrix){var e=(new t.Matrix4).getInverse(this.matrixWorld);this._modelInvRotMatrix.extractRotation(e)}this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(e){if(!this.isRoot3ds){if(!0===this.matrixAutoUpdate&&this.updateMatrix(),!0===this.matrixWorldNeedsUpdate||!0===e){if(void 0===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this._updateWorldCenterAndRadius(),this._matrixWorldForDoubleGPU._fromMatrix4WithLowPartTranslation(this.matrixWorld),l(this),null!==this.modelInvTranspMatrix&&this.modelInvTranspMatrix.getInverse(this.matrixWorld).transpose(),null!==this._modelInvRotMatrix){var i=(new t.Matrix4).getInverse(this.matrixWorld);this._modelInvRotMatrix.extractRotation(i)}this.matrixWorldNeedsUpdate=!1,e=!0}for(var s=0,r=this.children.length;s<r;s++)this.children[s].updateMatrixWorld(e)}},clone:function(e){void 0===e&&(e=new c),e.name=this.name,e.up.copy(this.up),e.position.copy(this.position),e.rotation instanceof t.Vector3&&e.rotation.copy(this.rotation),e.eulerOrder=this.eulerOrder,e.scale.copy(this.scale),e.renderDepth=this.renderDepth,e.rotationAutoUpdate=this.rotationAutoUpdate,e.matrix.copy(this.matrix),e.matrixWorld.copy(this.matrixWorld),e._matrixWorldForDoubleGPU._fromMatrix4WithLowPartTranslation(e.matrixWorld),e.matrixRotationWorld.copy(this.matrixRotationWorld),e.matrixAutoUpdate=this.matrixAutoUpdate,e.matrixWorldNeedsUpdate=this.matrixWorldNeedsUpdate,e.quaternion.copy(this.quaternion),e.useQuaternion=this.useQuaternion,e.visible=this.visible,e.visibilityFree=this.visibilityFree,e.castShadow=this.castShadow,e.receiveShadow=this.receiveShadow,e._programID=this._programID,e.frustumCulled=this.frustumCulled;for(var i=0;i<this.children.length;i++){var s=this.children[i];e.add(s.clone())}return e},getWebGLObjects:function(){return null},getScene:function(){return null!=this.parent?this.parent.getScene():null},getUniqueColor:function(){var e=Number(this.id).toString(16);return this.id>=4194303&&console.warn("max  number of pickingId values reached"),(e="000000".substr(0,6-e.length)+e).toUpperCase(),e="#"+e,new t.Color(e)},recompileShaders:function(t){var e,i;for(e=0,i=this.children.length;e<i;e++)this.children[e].recompileShaders(t)},getMeshInstances:function(){if(!this.parent)return[];for(var t=this;void 0!==t.parent;)t=t.parent;return t.getMeshInstances()},containsLensFlare:function(e){if(e instanceof t.LensFlare){var i=this.getScene();if(i&&i.__webglFlares&&-1!==i.__webglFlares.indexOf(e))return!0}return!1},containsLight:function(e){if(e instanceof t.Light){var i=this.getScene();if(i&&-1!==i.__lights.indexOf(e))return!0}return!1},containsMesh:function(e){if(e instanceof t.Mesh||e instanceof t.CSS2DNode){var i=this.getScene();if(i&&i.__objects.has(e))return!0}return!1},containsObject:function(t){for(var e=this;void 0!==e.parent;)e=e.parent;var i=t.parent;if(void 0===i)return!1;for(;void 0!==i.parent;)i=i.parent;return i===e},setMatrix:function(e,i){if(this.matrix=e,e){this.scale.getScaleFromMatrix(this.matrix);var s=r.extractRotation(this.matrix);this.rotation.setEulerFromRotationMatrix(s,this.eulerOrder),this.position.getPositionFromMatrix(this.matrix)}else this.scale.set(1,1,1),this.rotation.set(0,0,0),this.position.set(0,0,0);this.isUniformlyScaled=Math.abs(this.scale.x-this.scale.y)<1e-4&&Math.abs(this.scale.z-this.scale.y)<1e-4,this.isUniformlyScaled?this._programID&=~a.NON_UNIFORM_SCALE:this._programID|=a.NON_UNIFORM_SCALE,!1===i?(this.matrixWorldNeedsUpdate=!1,this.matrixWorld=this.matrix||t.IdentityMatrix):this.matrixWorldNeedsUpdate=!0,this._updateWorldCenterAndRadius(),this._matrixWorldForDoubleGPU._fromMatrix4WithLowPartTranslation(this.matrixWorld),l(this),null!==this.modelInvTranspMatrix&&this.modelInvTranspMatrix.getInverse(this.matrixWorld).transpose()},getLookAt:function(){var e=this._getMMMatrix().elements;return new t.Vector3(-e[8],-e[9],-e[10])},cloneSimple:function(e){return void 0===e&&(e=new c),e.name=this.name,e.up.copy(this.up),e.position.copy(this.position),e.rotation instanceof t.Vector3&&e.rotation.copy(this.rotation),e.eulerOrder=this.eulerOrder,e.scale.copy(this.scale),e.renderDepth=this.renderDepth,e.rotationAutoUpdate=this.rotationAutoUpdate,e.matrix.copy(this.matrix),e.matrixWorld.copy(this.matrixWorld),e._matrixWorldForDoubleGPU._fromMatrix4WithLowPartTranslation(e.matrixWorld),e.matrixRotationWorld.copy(this.matrixRotationWorld),e.matrixAutoUpdate=this.matrixAutoUpdate,e.matrixWorldNeedsUpdate=this.matrixWorldNeedsUpdate,e.quaternion.copy(this.quaternion),e.useQuaternion=this.useQuaternion,e.visible=this.visible,e.visibilityFree=this.visibilityFree,e._noZPriority=this._noZPriority,e._programID=this._programID,e.castShadow=this.castShadow,e.receiveShadow=this.receiveShadow,e.frustumCulled=this.frustumCulled,e.isUniformlyScaled=this.isUniformlyScaled,e},_isDecal:function(){return!1},_isReceivingDecal:function(){return!1},_isInDecalPass:function(){return!1}},Object.defineProperty(c.prototype,"receiveShadow",{get:function(){if(this._occurrence){var t=this._occurrence._getShadow()[1];return null===t?this._receiveShadow:t}return this._receiveShadow},set:function(t){this._receiveShadow=t}}),Object.defineProperty(c.prototype,"castShadow",{get:function(){if(this._occurrence){var t=this._occurrence._getShadow()[0];return null===t?this._castShadow:t}return this._castShadow},set:function(t){this._castShadow=t}}),Object.defineProperty(c.prototype,"frustumCulled",{set:function(t){this._flagAsFrustumCulled(t),this._frustumCulled=t},get:function(){return this._frustumCulled}}),c.defaultEulerOrder="XYZ",c}),define("DS/Object3D/Light",["DS/Mesh/ThreeJS_Base","DS/Object3D/Object3D"],function(t,e){"use strict";var i=new t.Color,s={LUMINOUS_POWER:0,LUMINOUS_EXITANCE:1},r=1e6/Math.PI,o=function(i){e.call(this),this.onlyShadow=!1,i=i instanceof t.Color?i:new t.Color(i),this.color=i,this.sRGB=!1,this._vptPosition=null,this._phongReduction=!0,this._sceneShadow=!1};(o.prototype=Object.create(e.prototype)).clone=function(t){return void 0===t&&(t=new o),e.prototype.clone.call(this,t),t.color.copy(this.color),t.sRGB=this.sRGB,t._vptPosition=this._vptPosition,t._phongReduction=this._phongReduction,t._sceneShadow=this._sceneShadow,t},o.prototype._sortKey=0,o.prototype.allocateShadows=function(t,e){return 0},o.prototype.setup=function(t,e,i,s){},o.prototype.allocate=function(t){},o.prototype.updateShadowParameters=function(t,e){},o.prototype.dispose=function(){};var a=function(t){o.call(this,t)};(a.prototype=Object.create(o.prototype)).clone=function(t){return void 0===t&&(t=new a),o.prototype.clone.call(this,t),t},a.prototype.setup=function(t,e,s,r){if(this.visible){var o=this.color;if(r.gammaInput&&!this.sRGB){var a=i.copyToLinear(o,r.simpleGamma);t.ambient.r+=a.r,t.ambient.g+=a.g,t.ambient.b+=a.b}else t.ambient.r+=o.r,t.ambient.g+=o.g,t.ambient.b+=o.b}};var n=function(t,e,i,r){o.call(this,t),this.intensity=void 0!==e?e:1,this.radius=void 0!==i?i:1,this.mode=void 0!==r?r:s.LUMINOUS_EXITANCE,this._internalScale=1};(n.prototype=Object.create(o.prototype)).clone=function(t){return void 0===t&&(t=new n),o.prototype.clone.call(this,t),t.intensity=this.intensity,t.radius=this.radius,t.mode=this.mode,t._internalScale=this._internalScale,t},n.prototype.setup=function(e,i,o,a){if(e.sphere.sphereCount+=1,this.visible){var n=3*e.sphere.sphereLength,h=this.matrixWorld.getMaxScaleOnAxis()/this._internalScale*this.radius,l=this.mode===s.LUMINOUS_POWER?r*this.intensity/(h*h*4*Math.PI):this.intensity;a.gammaInput&&!this.sRGB?i(e.sphere.sphereColors,n,this.color,l,a.simpleGamma):o(e.sphere.sphereColors,n,this.color,l);var c=new t.Vector3;c.getPositionFromMatrix(this.matrixWorld),e.sphere.spherePositions[n]=c.x,e.sphere.spherePositions[n+1]=c.y,e.sphere.spherePositions[n+2]=c.z,e.sphere.sphereData[n]=h,e.sphere.sphereData[n+1]=0,e.sphere.sphereData[n+2]=0,e.sphere.sphereLength+=1}},n.prototype.allocate=function(t){t.sphereLights++};var h=function(t,e,i,r){o.call(this,t),this.intensity=void 0!==e?e:1,this.radius=void 0!==i?i:1,this.mode=void 0!==r?r:s.LUMINOUS_EXITANCE,this._internalScale=1};(h.prototype=Object.create(o.prototype)).clone=function(t){return void 0===t&&(t=new h),o.prototype.clone.call(this,t),t.intensity=this.intensity,t.radius=this.radius,t.mode=this.mode,t._internalScale=this._internalScale,t},h.prototype.setup=function(e,i,o,a){if(e.disk.diskCount+=1,this.visible){var n=3*e.disk.diskLength,h=Math.max(this.matrixWorld.getScaleOnAxisX(),this.matrixWorld.getScaleOnAxisY())/this._internalScale*this.radius,l=this.mode===s.LUMINOUS_POWER?r*this.intensity/(h*h*Math.PI):this.intensity;a.gammaInput&&!this.sRGB?i(e.disk.diskColors,n,this.color,l,a.simpleGamma):o(e.disk.diskColors,n,this.color,l);var c=new t.Vector3;c.getPositionFromMatrix(this.matrixWorld),e.disk.diskPositions[n]=c.x,e.disk.diskPositions[n+1]=c.y,e.disk.diskPositions[n+2]=c.z;var d=new t.Vector4;d.getColumnFromMatrix(2,this.matrixWorld),d.w=0,d.normalize(),e.disk.diskNormals[n]=d.x,e.disk.diskNormals[n+1]=d.y,e.disk.diskNormals[n+2]=d.z,d.getColumnFromMatrix(1,this.matrixWorld),d.w=0,d.normalize(),e.disk.diskUps[n]=d.x,e.disk.diskUps[n+1]=d.y,e.disk.diskUps[n+2]=d.z,e.disk.diskData[n]=h,e.disk.diskData[n+1]=0,e.disk.diskData[n+2]=0,e.disk.diskLength+=1}},h.prototype.allocate=function(t){t.diskLights++};var l=function(t,e,i,r,a){o.call(this,t),this.intensity=void 0!==e?e:1,this.radius=void 0!==i?i:1,this.width=void 0!==r?r:1,this.mode=void 0!==a?a:s.LUMINOUS_EXITANCE,this._internalScale=1};(l.prototype=Object.create(o.prototype)).clone=function(t){return void 0===t&&(t=new l),o.prototype.clone.call(this,t),t.intensity=this.intensity,t.radius=this.radius,t.width=this.width,t.mode=this.mode,t._internalScale=this._internalScale,t},l.prototype.setup=function(e,i,o,a){if(e.tube.tubeCount+=1,this.visible){var n=3*e.tube.tubeLength,h=this.matrixWorld.getScaleOnAxisX()/this._internalScale,l=this.matrixWorld.getScaleOnAxisY()/this._internalScale*this.radius,c=h*this.width,d=this.mode===s.LUMINOUS_POWER?r*this.intensity/(2*Math.PI*c*l+l*l*4*Math.PI):this.intensity;a.gammaInput&&!this.sRGB?i(e.tube.tubeColors,n,this.color,d,a.simpleGamma):o(e.tube.tubeColors,n,this.color,d);var p=new t.Vector3;p.getPositionFromMatrix(this.matrixWorld),e.tube.tubePositions[n]=p.x,e.tube.tubePositions[n+1]=p.y,e.tube.tubePositions[n+2]=p.z;var u=new t.Vector4;u.getColumnFromMatrix(1,this.matrixWorld),u.w=0,u.normalize(),e.tube.tubeRights[n]=u.x,e.tube.tubeRights[n+1]=u.y,e.tube.tubeRights[n+2]=u.z,e.tube.tubeData[n]=l,e.tube.tubeData[n+1]=c,e.tube.tubeData[n+2]=0,e.tube.tubeLength+=1}},l.prototype.allocate=function(t){t.tubeLights++};var c=function(t,e,i,r,a){o.call(this,t),this.intensity=void 0!==e?e:1,this.height=void 0!==r?r:1,this.width=void 0!==i?i:1,this.mode=void 0!==a?a:s.LUMINOUS_EXITANCE,this._internalScale=1};(c.prototype=Object.create(o.prototype)).clone=function(t){return void 0===t&&(t=new c),o.prototype.clone.call(this,t),t.intensity=this.intensity,t.width=this.width,t.height=this.height,t.mode=this.mode,t._internalScale=this._internalScale,t},c.prototype.setup=function(e,i,o,a){if(e.area.areaCount+=1,this.visible){var n=3*e.area.areaLength,h=this.matrixWorld.getScaleOnAxisX()/this._internalScale,l=this.matrixWorld.getScaleOnAxisY()/this._internalScale*this.height,c=h*this.width,d=this.mode===s.LUMINOUS_POWER?r*this.intensity/(l*c):this.intensity;a.gammaInput&&!this.sRGB?i(e.area.areaColors,n,this.color,d,a.simpleGamma):o(e.area.areaColors,n,this.color,d);var p=new t.Vector3;p.getPositionFromMatrix(this.matrixWorld),e.area.areaPositions[n]=p.x,e.area.areaPositions[n+1]=p.y,e.area.areaPositions[n+2]=p.z;var u=new t.Vector4;u.getColumnFromMatrix(2,this.matrixWorld),u.w=0,u.normalize(),e.area.areaNormals[n]=u.x,e.area.areaNormals[n+1]=u.y,e.area.areaNormals[n+2]=u.z,u.getColumnFromMatrix(1,this.matrixWorld),u.w=0,u.normalize(),e.area.areaUps[n]=u.x,e.area.areaUps[n+1]=u.y,e.area.areaUps[n+2]=u.z,e.area.areaData[n]=c,e.area.areaData[n+1]=l,e.area.areaData[n+2]=0,e.area.areaLength+=1}},c.prototype.allocate=function(t){t.areaLights++};var d=function(i,s){o.call(this,i),this.position.set(0,1,0),this.target=new e,this.intensity=void 0!==s?s:1,this.castShadow=!1,this.onlyShadow=!1,this.castGroundShadow=!1,this.shadowCameraNear=50,this.shadowCameraFar=5e3,this.shadowCameraLeft=-500,this.shadowCameraRight=500,this.shadowCameraTop=500,this.shadowCameraBottom=-500,this.shadowCameraVisible=!1,this.shadowCameraHelperToUpdate=!0,this.shadowBias=-.005,this.shadowDarkness=.5,this.shadowMapWidth=512,this.shadowMapHeight=512,this.shadowCascade=!1,this.shadowCascadeOffset=new t.Vector3(0,0,-1e3),this.shadowCascadeCount=2,this.shadowCascadeBias=[0,0,0],this.shadowCascadeWidth=[512,512,512],this.shadowCascadeHeight=[512,512,512],this.shadowCascadeNearZ=[-1,.99,.998],this.shadowCascadeFarZ=[.99,.998,1],this.shadowCascadeArray=[],this.updateShadowMap=!0,this.blockUpdate=!1,this.shadowMap=null,this.transparentShadowMap=null,this.shadowMapSize=null,this.shadowCamera=null,this.transparentShadowCamera=null,this.shadowMatrix=null,this.LiSPSM=!1};(d.prototype=Object.create(o.prototype))._sortKey=32,d.prototype.clone=function(t){return void 0===t&&(t=new d),o.prototype.clone.call(this,t),null!==this.target?this.target.clone(t.target):t.target=null,t.intensity=this.intensity,t.castShadow=this.castShadow,t.onlyShadow=this.onlyShadow,t},d.prototype.allocateShadows=function(t,e){return this.shadowCascade||this.isVirtual&&!t.shadowMapCascade||(e.tex2d++,e.dirLight++),0},d.prototype._getLightDirection=function(e){var i=new t.Vector3;new t.Vector3;if(this.target)i.getPositionFromMatrix(this.matrixWorld),i.sub(this.target.position),0===i.x&&0===i.y&&0===i.z&&(i.copy(e),i.applyMatrix4((new t.Matrix4).extractRotation(this.matrixWorld)));else if(i.copy(e),i.applyMatrix4((new t.Matrix4).extractRotation(this.matrixWorld)),this._occurrence&&this._occurrence.node._attachedToVpt){var s=(new t.Vector3).crossVectors(this._vptSight,this._vptUp);i=new t.Vector3(s.x*i.x+this._vptUp.x*i.y-this._vptSight.x*i.z,s.y*i.x+this._vptUp.y*i.y-this._vptSight.y*i.z,s.z*i.x+this._vptUp.z*i.y-this._vptSight.z*i.z)}return i.normalize(),i},d.prototype.setup=function(t,e,i,s){if(t.directional.dirCount+=1,this.visible){var r=this._getLightDirection(s.baseLightDirection);if(0!==r.x||0!==r.y||0!==r.z){var o=3*t.directional.dirLength;t.directional.dirPositions[o]=r.x,t.directional.dirPositions[o+1]=r.y,t.directional.dirPositions[o+2]=r.z,s.gammaInput&&!this.sRGB?(e(t.directional.dirColors,o,this.color,this.intensity,s.simpleGamma,t.directional.dirColorsNoIntensity),e(t.directional.dirColorsPhong,o,this.color,this.intensity,s.simpleGamma)):(i(t.directional.dirColors,o,this.color,this.intensity,t.directional.dirColorsNoIntensity),i(t.directional.dirColorsPhong,o,this.color,this.intensity)),this._phongReduction&&(t.directional.dirColorsPhong[o]/=Math.PI,t.directional.dirColorsPhong[o+1]/=Math.PI,t.directional.dirColorsPhong[o+2]/=Math.PI),t.directional.dirLength+=1}}},d.prototype.allocate=function(t){t.dirLights++},d.prototype.updateShadowParameters=function(e,i){if(null!==e){var s=this._getLightDirection(i),r=null!==this.target?this.target.position:e.center;this.position=(new t.Vector3).copy(s).multiplyScalar(2*e.radius).add(r);var o=this.position.distanceTo(e.center),a=-.5*s.dot(i)+.5;Math.PI,Math.max(.1,.5-a);this.shadowCamera&&!this.LiSPSM?(this.updateShadowMap=this.updateShadowMap||this.shadowCamera.top!==e.radius,this.shadowCamera.far=o+2.64*e.radius,this.shadowCamera.near=Math.max(.001*this.shadowCamera.far,o-e.radius),this.shadowCamera.left=-e.radius,this.shadowCamera.right=e.radius,this.shadowCamera.bottom=-e.radius,this.shadowCamera.top=e.radius,this.shadowCamera.updateProjectionMatrix()):(this.shadowCameraFar=o+2.64*e.radius,this.shadowCameraNear=Math.max(.001*this.shadowCameraFar,o-e.radius),this.updateShadowMap=!0)}},d.prototype.dispose=function(){this.shadowMap&&this.shadowMap.dispose(),this.transparentShadowMap&&this.transparentShadowMap.dispose()};var p=function(t,e){d.call(this,t,e),this.castShadow=!0};(p.prototype=Object.create(d.prototype))._sortKey=8,p.prototype.clone=function(t){return void 0===t&&(t=new p),d.prototype.clone.call(this,t),t},p.prototype.allocateShadows=function(t,e){return this.shadowCascade||this.isVirtual&&!t.shadowMapCascade||e.dirIBLLight++,0},p.prototype.setup=function(t,e,i,s){if(t.directionalIBL.dirIBLCount+=1,this.visible){var r=this._getLightDirection(s.baseLightDirection);if(0!==r.x||0!==r.y||0!==r.z){var o=3*t.directionalIBL.dirIBLLength;t.directionalIBL.dirIBLPositions[o]=r.x,t.directionalIBL.dirIBLPositions[o+1]=r.y,t.directionalIBL.dirIBLPositions[o+2]=r.z,i(t.directionalIBL.dirIBLColors,o,this.color,this.intensity),t.directionalIBL.dirIBLLength+=1}}},p.prototype.allocate=function(t){t.dirIBLLights++};var u=function(t,e){d.call(this,t,e),this.castShadow=!1};(u.prototype=Object.create(d.prototype))._sortKey=0,u.prototype.clone=function(t){return void 0===t&&(t=new u),d.prototype.clone.call(this,t),t},u.prototype.allocateShadows=function(t,e){return 0},u.prototype.setup=function(t,e,i,s){if(t.directionalPhong.dirPhongCount+=1,this.visible){var r=this._getLightDirection(s.baseLightDirection);if(0!==r.x||0!==r.y||0!==r.z){var o=3*t.directionalPhong.dirPhongLength;t.directionalPhong.dirPhongPositions[o]=r.x,t.directionalPhong.dirPhongPositions[o+1]=r.y,t.directionalPhong.dirPhongPositions[o+2]=r.z,i(t.directionalPhong.dirPhongColors,o,this.color,this.intensity),t.directionalPhong.dirPhongColors[o]/=Math.PI,t.directionalPhong.dirPhongColors[o+1]/=Math.PI,t.directionalPhong.dirPhongColors[o+2]/=Math.PI,t.directionalPhong.dirPhongLength+=1}}},u.prototype.allocate=function(t){t.dirPhongLights++};var g=function(t,e,i){o.call(this,t),this.intensity=void 0!==e?e:1,this.distance=void 0!==i?i:0,this.isPhysicallyAttenuated=!1,this.attenuationScale=1,this.shadowCameraNear=50,this.shadowCameraFar=5e3,this.shadowCameraFov=90,this.shadowCameraVisible=!1,this.shadowCameraHelperToUpdate=!0,this.shadowBias=0,this.shadowDarkness=.5,this.shadowMapWidth=512,this.shadowMapHeight=512,this.updateShadowMap=!0,this.shadowMap=null,this.transparentShadowMap=null,this.shadowMapSize=null,this.shadowCameras=null,this.transparentShadowCameras=null,this.shadowMatrix=null};(g.prototype=Object.create(o.prototype))._sortKey=4,g.prototype.clone=function(t){return void 0===t&&(t=new g),o.prototype.clone.call(this,t),t.intensity=this.intensity,t.distance=this.distance,t.isPhysicallyAttenuated=this.isPhysicallyAttenuated,t.attenuationScale=this.attenuationScale,t.castShadow=this.castShadow,t.onlyShadow=this.onlyShadow,t},g.prototype.allocateShadows=function(t,e){e.texCube++},g.prototype.setup=function(e,i,s,r){if(e.point.pointCount+=1,this.visible){var o=3*e.point.pointLength;r.gammaInput&&!this.sRGB?(i(e.point.pointColors,o,this.color,this.intensity,r.simpleGamma,e.point.pointColorsNoIntensity),i(e.point.pointColorsPhong,o,this.color,this.intensity,r.simpleGamma)):(s(e.point.pointColors,o,this.color,this.intensity,e.point.pointColorsNoIntensity),s(e.point.pointColorsPhong,o,this.color,this.intensity)),this._phongReduction&&(e.point.pointColorsPhong[o]/=Math.PI,e.point.pointColorsPhong[o+1]/=Math.PI,e.point.pointColorsPhong[o+2]/=Math.PI);var a=new t.Vector3;this._occurrence&&this._occurrence.node._attachedToVpt?a.copy(this._vptPosition):a.getPositionFromMatrix(this.matrixWorld),e.point.pointPositions[o]=a.x,e.point.pointPositions[o+1]=a.y,e.point.pointPositions[o+2]=a.z,e.point.pointPhysicalAttenuations[e.point.pointLength]=this.isPhysicallyAttenuated,e.point.pointDistances[e.point.pointLength]=this.isPhysicallyAttenuated?this.attenuationScale:this.distance,e.point.pointLength+=1}},g.prototype.setupShadowPositions=function(e){if(this.visible){var i=new t.Vector3;this._occurrence&&this._occurrence.node._attachedToVpt?i.copy(this._vptPosition):i.getPositionFromMatrix(this.matrixWorld),e.push(i.x),e.push(i.y),e.push(i.z)}},g.prototype.allocate=function(t){t.pointLights++},g.prototype.dispose=function(){this.shadowMap&&this.shadowMap.dispose(),this.transparentShadowMap&&this.transparentShadowMap.dispose()};var m=function(t,i,s,r,a){o.call(this,t),this.position.set(0,1,0),this.target=new e,this.intensity=void 0!==i?i:1,this.distance=void 0!==s?s:0,this.angle=void 0!==r?r:Math.PI/2,this.innerAngle=void 0!==a?a:this.angle-.001,this.exponent=1,this.isPhysicallyAttenuated=!1,this.attenuationScale=1,this.castShadow=!1,this.onlyShadow=!1,this.shadowCameraNear=50,this.shadowCameraFar=5e3,this.shadowCameraFov=50,this.shadowCameraVisible=!1,this.shadowCameraHelperToUpdate=!0,this.shadowBias=0,this.shadowDarkness=.5,this.shadowMapWidth=512,this.shadowMapHeight=512,this.updateShadowMap=!0,this.shadowMap=null,this.transparentShadowMap=null,this.shadowMapSize=null,this.shadowCamera=null,this.transparentShadowCamera=null,this.shadowMatrix=null};(m.prototype=Object.create(o.prototype))._sortKey=16,m.prototype.clone=function(t){return void 0===t&&(t=new m),o.prototype.clone.call(this,t),null!==this.target?this.target.clone(t.target):t.target=null,t.intensity=this.intensity,t.localDirection=this.localDirection,t.distance=this.distance,t.angle=this.angle,t.innerAngle=this.innerAngle,t.exponent=this.exponent,t.castShadow=this.castShadow,t.onlyShadow=this.onlyShadow,t.isPhysicallyAttenuated=this.isPhysicallyAttenuated,t.attenuationScale=this.attenuationScale,t},m.prototype.allocateShadows=function(t,e){e.tex2d++,e.spotLight++},m.prototype.setup=function(e,i,s,r){if(e.spot.spotCount+=1,this.visible){var o=3*e.spot.spotLength;r.gammaInput&&!this.sRGB?(i(e.spot.spotColors,o,this.color,this.intensity,r.simpleGamma,e.spot.spotColorsNoIntensity),i(e.spot.spotColorsPhong,o,this.color,this.intensity,r.simpleGamma)):(s(e.spot.spotColors,o,this.color,this.intensity,e.spot.spotColorsNoIntensity),s(e.spot.spotColorsPhong,o,this.color,this.intensity)),this._phongReduction&&(e.spot.spotColorsPhong[o]/=Math.PI,e.spot.spotColorsPhong[o+1]/=Math.PI,e.spot.spotColorsPhong[o+2]/=Math.PI);var a=new t.Vector3,n=new t.Vector3;if(this._occurrence&&this._occurrence.node._attachedToVpt)a.copy(this._vptPosition),n.copy(this._vptSight),n.negate();else{a.getPositionFromMatrix(this.matrixWorld);var h=e.spot.spotLength;e.spot.spotPhysicalAttenuations[h]=this.isPhysicallyAttenuated,e.spot.spotDistances[h]=this.isPhysicallyAttenuated?this.attenuationScale:this.distance,this.target?(n.copy(a),n.sub(this.target.position),0===n.x&&0===n.y&&0===n.z&&(n.set(0,0,1),n.applyMatrix4((new t.Matrix4).extractRotation(this.matrixWorld)))):(n.set(0,0,1),n.applyMatrix4((new t.Matrix4).extractRotation(this.matrixWorld)))}n.normalize(),e.spot.spotPositions[o]=a.x,e.spot.spotPositions[o+1]=a.y,e.spot.spotPositions[o+2]=a.z,e.spot.spotDirections[o]=n.x,e.spot.spotDirections[o+1]=n.y,e.spot.spotDirections[o+2]=n.z,e.spot.spotAnglesCos[h]=Math.cos(this.angle),e.spot.spotInnerAnglesCos[h]=Math.cos(this.innerAngle),e.spot.spotLength+=1}},m.prototype.allocate=function(t){t.spotLights++},m.prototype.dispose=function(){this.shadowMap&&this.shadowMap.dispose(),this.transparentShadowMap&&this.transparentShadowMap.dispose()};var f=function(t,e,i,s){o.call(this,t),this.intensity=void 0!==e?e:1,this.distance=void 0!==i?i:0,this.iesTexture=s};return(f.prototype=Object.create(o.prototype)).clone=function(t){return void 0===t&&(t=new f),o.prototype.clone.call(this,t),t.intensity=this.intensity,t.distance=this.distance,t.iesTexture=this.iesTexture,t},f.prototype.setup=function(e,i,s,r){if(e.ies.iesCount+=1,this.visible){var o=3*e.ies.iesLength;r.gammaInput&&!this.sRGB?i(e.ies.iesColors,o,this.color,this.intensity,r.simpleGamma):s(e.ies.iesColors,o,this.color,this.intensity);var a=new t.Vector3;this._occurrence&&this._occurrence.node._attachedToVpt?a.copy(this._vptPosition):a.getPositionFromMatrix(this.matrixWorld),e.ies.iesPositions[o]=a.x,e.ies.iesPositions[o+1]=a.y,e.ies.iesPositions[o+2]=a.z,e.ies.iesDistances[e.ies.iesLength]=this.distance,e.ies.iesLightTexture[e.ies.iesCount-1]=this.iesTexture;var n=new t.Matrix4;e.ies.matrixWorldInv[e.ies.iesCount-1]=n.getInverse(this.matrixWorld),e.ies.iesLength+=1}},f.prototype.allocate=function(t){t.iesLights++},{AreaLightUnits:s,BaseLight:o,PointLight:g,SpotLight:m,DirectionalLight:d,DirectionalIBLLight:p,DirectionalPhongLight:u,AreaLight:c,TubeLight:l,DiskLight:h,SphereLight:n,AmbientLight:a,IESLight:f}}),define("DS/Object3D/Mesh",["DS/Mesh/ThreeJS_Base","DS/Object3D/Object3D","DS/Mesh/Mesh","DS/Materials/MeshBasicMaterial"],function(t,e,i,s){"use strict";var r=1,o=[],a=function(t){0!=t&&o.push(t)},n=function(i,r,o){e.call(this),this.geometry=[],i&&(i.length?this.geometry=i.slice():void 0===i.length&&(this.geometry=i),this.geometry.boundingSphere=i.boundingSphere,this.geometry.boundingBox=i.boundingBox),t.disableJHGDev?this.material=void 0!==r?r:new s({color:16777215*Math.random(),wireframe:!1}):this.material=void 0!==r?r:null,this.matApp=null,this.gas=null,this.geometry&&null===this.geometry.boundingSphere&&this.geometry.computeBoundingSphere(),this.geometry.boundingSphere||(this.geometry.boundingSphere=new t.Sphere),this.geometry.boundingBox||(this.geometry.boundingBox=new t.Box3),this.beforeRenderCB=null,this._meshRef=0,this.pickable=!0,this.pickingID=0,this.sceneGraph=null,this.highLight=null,this.noPickThrough=!0,this.enableNormalDepth=!0,this.__invisiblePlane=!1,this.visible=!0,this.visibilityFree=!1,this._noZPriority=!1,this._priorityMode=t.PriorityMode.ClassicPriority,this._depthPriority=0,this.filtered=!1,this.layer=null,this.selectionGroups=null,this.outlinesGeometry=null,this.sectionLinesBuilder=null,this._bodyDim=0,this.hasPoint=!1,this.renderPointsOnly=!1,this._checkGeometry(),this.boundingSphere=this.geometry.boundingSphere,this.boundingBox=this.geometry.boundingBox,this.geomWorldBE=[],this.__webglInit=!1,this.__webglActive=null,this._normalMatrix=null,this.render=!0,this.z=0,this.renderLineMode=null,this._occurrence=null,this.pickingPriorityID=0,this.occurrenceRenderingOverride=null,this._centerZ=0,this.highlightMeshes=null,this.preHighlight=null,this._instancingInfos=null,this.clippingPlane=null,this.disableMirror=0,this._manipulators=void 0,this._3dxmlMaterial=null,this._gsso_cache=null,this._advancedPriority=!1,this.fromLoadedModel=!1,this.materialMode=2,this.isCurvedPipe=!1,this.geometry.length&&(i[0].compressedVertices&&(this._programID|=t.ProgramIDs.COMPRESSED_VERTICES),i[0].compressedNormals&&(this._programID|=t.ProgramIDs.COMPRESSED_NORMALS),i[0].compressedUVs&&(this._programID|=t.ProgramIDs.COMPRESSED_UVS),i[0].compressedColors&&(this._programID|=t.ProgramIDs.COMPRESSED_COLORS)),this._vertexColors=t.VertexColorType.NoColors,this._skinning=null,this._skinningInstancing=null,this.lightMapData=null,this._decalData=null,this._tokens={},this._scenes=null,o||window.sealWebVisuObjects&&Object.seal(this),this._forceBackFacesOnSolid=!1,this.kdTree=null};return(n.prototype=Object.create(e.prototype))._isDecal=function(){return this._decalData&&this._decalData.key>0&&this._decalData.key%2==1},n.prototype._isReceivingDecal=function(){return this._decalData&&this._decalData.key>0&&this._decalData.key%2==0},n.prototype._isInDecalPass=function(){return this._decalData&&this._decalData.stencilID>0&&this._decalData.key>0},n.prototype._forceGeomType=function(e){for(var i="string"==typeof e?t.GeomTypeEnum[e]:e,s=0;s<this.geometry.length;s++)for(var r=this.geometry[s],o=0;o<r.drawingGroups.length;o++){r.drawingGroups[o]._geomType=i}},n.prototype.getMorphTargetIndexByName=function(t){return void 0!==this.morphTargetDictionary[t]?this.morphTargetDictionary[t]:(console.log("Mesh.getMorphTargetIndexByName: morph target "+t+" does not exist. Returning 0."),0)},n.prototype.clone=function(t){return void 0===t&&(t=new n(this.geometry,this.material)),this.matApp&&(t.matApp=this.matApp),e.prototype.clone.call(this,t),t._vertexColors=this._vertexColors,t._skinningInstancing=this._skinningInstancing,t._skinning=this._skinning,t},n.prototype.setVertexColors=function(e){this._vertexColors=e,e?this._programID|=t.ProgramIDs.VERTEX_COLORS:this._programID&=~t.ProgramIDs.VERTEX_COLORS,this._flagAsGSSOInvalidated()},n.prototype.setSkinningTransformations=function(e){this._skinning=e,this._skinningInstancing=null,this._programID&=~t.ProgramIDs.SKINNING_INSTANCING,e?this._programID|=t.ProgramIDs.SKINNING:this._programID&=~t.ProgramIDs.SKINNING,this._flagAsGSSOInvalidated()},n.prototype.setSkinningTransformationsInstancing=function(e){this._skinning=null,this._skinningInstancing=e,this._programID&=~t.ProgramIDs.SKINNING,e?this._programID|=t.ProgramIDs.SKINNING_INSTANCING:this._programID&=~t.ProgramIDs.SKINNING_INSTANCING,this._flagAsGSSOInvalidated()},n.prototype.getOwningScene=function(){return this.getScene()},n.prototype._flagAsGSSOInvalidated=function(){this._gsso_cache=null;var t,e=this;if(this._scenes){this._scenes.length;this._scenes.forEach(function(t){null!==t&&t.flagAsGSSOInvalidated(e)})}if(this.highlightMeshes)for(t=0;t<this.highlightMeshes.length;t++)this.highlightMeshes[t].renderable._flagAsGSSOInvalidated();this.preHighlight&&this.preHighlight._flagAsGSSOInvalidated()},n.prototype._compactArrays=function(t){for(var e=0;e<this.geometry.length;e++)this.geometry[e]._compactArrays(t)},n.prototype.recompileShaders=function(e){var i;if(this.material&&this.material.recompileShaders(!0,iParams),this.matApp&&this.matApp.recompileShaders(iParams),this.userData&&this.userData.oldMaterial&&this.userData.oldMaterial.recompileShaders(!0,iParams),this.layer&&this.layer.layers)for(i=0;i<this.layer.layers.length;i++){var s=this.layer.layers[i].drawableInterval.material;s&&s.recompileShaders(!0,iParams)}var r=null,o=0;this.geometry.length>=0?(r=this.geometry[0],o=this.geometry.length):2===this.geometry._type&&(r=this.geometry,o=1);for(var a=0;a<o;a++){for(var n=r.drawingGroups,h=0;h<n.length;h++)n[h].gas&&!n[h].gas.isGAS&&n[h].gas.recompileShaders(!1,iParams),n[h].material&&n[h].material instanceof t.Material&&n[h].material.recompileShaders(!1,iParams);r=this.geometry[a+1]}},n.prototype._getMMMatrix=function(){var i,s=null,r=function(t){return t&&t.parent&&t.parent.scene3js?t.parent.scene3js.viewer.currentViewpoint:null};if(this._billboardData&&this._billboardData.type>=1&&this.matrixWorld&&(i=r(this._occurrence))){var o=(b=i.camera).getLookAt();o.add(b.position);var a=(new t.Matrix4).extractRotation(this.matrixWorld),n=(new t.Matrix4).getInverse(a),h=null;if(1===this._billboardData.type)h=(new t.Matrix4).lookAt(b.position,o,b.up);else{var l=this._billboardData.axis,c=new t.Vector3,d=new t.Vector3,p=new t.Vector3,u=new t.Vector3,g=new t.Vector3,m=new t.Vector3,f=new t.Vector3;if(l?d.copy(l).transformDirection(this.matrixWorld).normalize():d.set(this.matrixWorld.elements[8],this.matrixWorld.elements[9],this.matrixWorld.elements[10]).normalize(),3===this._billboardData.type){var y=new t.Projector;f.getPositionFromMatrix(this.matrixWorld),c.subVectors(f,b.position),m.addVectors(f,d);var _=f.clone();y.projectVector(_,b),y.projectVector(m,b),m.z=_.z,y.unprojectVector(m,b),m.sub(f),m.normalize(),d.copy(m)}else c.subVectors(o,b.position);if(c.normalize(),p.crossVectors(c,d),p.lengthSq()<1e-10){var v=Math.abs(c.z)<.999?g.set(0,0,1):g.set(1,0,0);p.crossVectors(v,c)}p.normalize(),u.crossVectors(d,p),u.normalize(),h=(new t.Matrix4).set(p.x,u.x,d.x,0,p.y,u.y,d.y,0,p.z,u.z,d.z,0,0,0,0,1)}s=(new t.Matrix4).multiplyMatrices(n,h);this._billboardData.rotation&&(s=(new t.Matrix4).multiplyMatrices(s,this._billboardData.rotation))}if(this._ratioData&&this._ratioData.ratio>0&&this.matrixWorld&&(i=r(this._occurrence))){var x=new t.Vector3;x.getPositionFromMatrix(this.matrixWorld);var b,w=1/this.matrixWorld.getMaxScaleOnAxis();(b=i[this._ratioData.cameraName?this._ratioData.cameraName:"camera"]).fullWidth&&(w*=b.height/b.fullHeight);var S=w*b.getWorldSizeFromPixelSize(1,x,i.viewer._getDivClientHeight()),M=new t.Matrix4;if(this._ratioData.center){var I=(new t.Vector3).copy(this._ratioData.center);I.multiplyScalar(S);var P=(new t.Vector3).copy(I);P.applyMatrix4(this.matrixWorld),S=this._ratioData.ratio*w*b.getWorldSizeFromPixelSize(1,P,i.viewer._getDivClientHeight()),M.makeScale(S,S,S),M.setPosition(I)}else S*=this._ratioData.ratio,M.makeScale(S,S,S);var C=new t.Matrix4;if(C.multiplyMatrices(this.matrixWorld,M),s){var L=new t.Matrix4;return L=(new t.Matrix4).multiplyMatrices(C,s)}return C}return s&&this.matrixWorld?((L=new t.Matrix4).multiplyMatrices(this.matrixWorld,s),L):e.prototype._getMMMatrix.call(this)},n.prototype.computeKDTree=function(e){if(!this._occurrence||!t.KDTree)return null;var i=this._occurrence.node.mesh3js;if(i.kdTree)return this.kdTree=i.kdTree,i.kdTree;var s=new t.KDTree(100,20),r="build kd-tree for renderable "+this.id,o=performance.now();return s.buildFromMesh(i,!!e),r+=" took "+(performance.now()-o)/1e3+" s",t.VisualizationTraces.info(r),s.getNbNodes()>1&&s.getNbTotalElts()>100?(this.kdTree=s,i.kdTree=s,s):(console.warn("kdTree too small to be used"),this.kdTree=null,i.kdTree=null,null)},n.prototype._flagAsFrustumCulled=function(t){this._frustumCulled=t;var e,i=this;if(this._scenes){this._scenes.length;this._scenes.forEach(function(e){null!==e&&e.flagAsFrustumCulled(i,t)})}if(this.highlightMeshes)for(e=0;e<this.highlightMeshes.length;e++)this.highlightMeshes[e].renderable._flagAsFrustumCulled(t);this.preHighlight&&this.preHighlight._flagAsFrustumCulled(t)},Object.defineProperty(n.prototype,"instanceAttribArrays",{get:function(){return this._instancingInfos?this._instancingInfos.instanceAttribArrays:null},set:function(t){this._instancingInfos&&(this._instancingInfos.instanceAttribArrays=t)}}),Object.defineProperty(n.prototype,"instancingSelectionMode",{get:function(){return this._instancingInfos?this._instancingInfos.instancingSelectionMode:""},set:function(t){this._instancingInfos&&(this._instancingInfos.instancingSelectionMode=t)}}),Object.defineProperty(n.prototype,"nbInstances",{get:function(){return this._instancingInfos?this._instancingInfos.nbInstances:-1},set:function(t){this._instancingInfos&&(this._instancingInfos.nbInstances=t)}}),n.prototype.copyInstancingInfos=function(t){this._instancingInfos&&(t._instancingInfos={isInstanceNode3D:this._instancingInfos.isInstanceNode3D,nbInstances:this._instancingInfos.nbInstances,instancingSelectionMode:this._instancingInfos.instancingSelectionMode,instanceAttribArrays:this._instancingInfos.instanceAttribArrays,pickedInstanceId:[]})},n.prototype.addRefVBO=function(t){var e;t||(0==this._meshRef&&(this.pickingID=((e=o.length?o.pop():r++)>=4194303&&console.warn("max  number of pickingId values reached"),e)),this._meshRef++);var i=null,s=0;this.geometry.length>=0?(i=this.geometry[0],s=this.geometry.length):2===this.geometry._type&&(i=this.geometry,s=1);for(var a=0;a<s;a++)i.addRefVBO(this,t),i=this.geometry[a+1]},n.prototype.releaseVBO=function(t){t||(this._meshRef--,0==this._meshRef&&(a(this.pickingID),this.pickingID=0));var e=null,i=0;this.geometry.length>=0?(e=this.geometry[0],i=this.geometry.length):2===this.geometry._type&&(e=this.geometry,i=1);for(var s=0;s<i;s++)e.releaseVBO(this,t),e=this.geometry[s+1];this.clearOutlines()},n.prototype.clearOutlines=function(){this.outlinesGeometry&&(this.outlinesGeometry.dispose(),this.outlinesGeometry=null)},n.prototype.dispose=function(){var t=null,e=0;a(this.pickingID),this.pickingID=0,this.geometry.length>=0?(t=this.geometry[0],e=this.geometry.length):2===this.geometry._type&&(t=this.geometry,e=1);for(var i=0;i<e;i++)t.dispose(),t=this.geometry[i+1]},n.prototype.computeTangents=function(t){var e=null,i=0;this.geometry.length>=0?(e=this.geometry[0],i=this.geometry.length):2===this.geometry._type&&(e=this.geometry,i=1);for(var s=0;s<i;s++)e.computeTangents(t),e=this.geometry[s+1]},n.prototype.computeUVs=function(){var t=null,e=0;this.geometry.length>=0?(t=this.geometry[0],e=this.geometry.length):2===this.geometry._type&&(t=this.geometry,e=1);for(var i=0;i<e;i++)t.computeUVs(this.geometry.boundingBox),t=this.geometry[i+1]},n.prototype.detachGeometry=function(t){if(t&&this.layer){for(var e=this.layer.getIntervals(t,null,!0),i=0;i<e.length;i++)-1!==(s=this.layer.layers.indexOf(e[i]))&&(this.layer.layers.splice(s,1),this.layer.upToDate=!1);if(this.geometry&&this.geometry.length){var s=this.geometry.indexOf(t);-1!==s&&this.geometry.splice(s,1)}}},n.prototype.removeGeometry=function(t){if(t){for(var e=t.meshList,i=0;i<e.length;i++){if((r=e[i]).layer){var s=r.layer.getIntervals(t,null,!0);for(i=0;i<s.length;i++)-1!==(o=r.layer.layers.indexOf(s[i]))&&(r.layer.layers.splice(o,1),r.layer.upToDate=!1)}}for(i=0;i<e.length;i++){var r;if((r=e[i]).geometry&&r.geometry.length){var o=r.geometry.indexOf(t);-1!==o&&r.geometry.splice(o,1)}}}},n.prototype.addGeometry=function(e,s,r){for(var o=!1,a=0;a<this.geometry.length;a++)if(this.geometry[a]===e){o=!0;break}if(o)if(r){this.layer||this.initLayers(1);for(var n=0;n<r.length;n++){var h=r[n],l=h.drawableInterval;if(1===l.layerNum||l.material){for(var c=[],d=Math.min(h.drawableGroup.getPrimitivesCount(),l.primitiveStart+l.primitiveCount),p=l.primitiveStart;p<d;p++){var u=new i.SGPrimitiveHelper;u.set(h.drawableGroup,p),c.push(u)}this.layer.addPrimitivesToLayer(e,h.drawableGroup,c,l.layerNum,l.material)}}}else this._initLayersForGeometry(1,e);else{if(e.boundingBox||e.computeBoundingBox(),this.geometry.boundingBox||(this.geometry.boundingBox=new t.Box3),s&&this.geometry.boundingBox.expandByPoint(e.boundingBox.min),s&&this.geometry.boundingBox.expandByPoint(e.boundingBox.max),e.boundingSphere||e.computeBoundingSphere(),this.geometry.boundingSphere||(this.geometry.boundingSphere=new t.Sphere),s&&this.geometry.boundingSphere.clone().mergeWithSphere(e.boundingSphere,this.geometry.boundingSphere),this._occurrence&&this._occurrence.scene3js&&e.addRefVBO(this,!1),!this.layer&&!r)return this.geometry.push(e),void this._checkGeometry();this.layer||this.initLayers(1),this.geometry.push(e),r?this._copyLayers(r):this._initLayersForGeometry(1,e),this._checkGeometry()}},n.prototype.getRenderablesFromGeometries=function(){if(this.geometry&&this.geometry.length){for(var t={},e=0;e<this.geometry.length;e++)for(var i=this.geometry[e],s=0;s<i.meshList.length;s++){var r=i.meshList[s];t[r.id]=r}var o=[];for(var e in t)o.push(t[e]);return o}},n.prototype.optimizeBuffers=function(){},n.prototype.isMeshHiddenByLayer=function(){if(null===this.layer||!this.layer.layers.length)return!1;for(var t=0;t<this.layer.layers.length;t++){if(0!==this.layer.layers[t].drawableInterval.layerNum)return!1}return!0},n.prototype._findHLIndexOrAdd=function(t){var e,i=-1,s=this.highLight;s.map.has(t.container)?(e=s.map.get(t.container)).has(t.index)?i=e.get(t.index):e.set(t.index,s.primitives.length):((e=new Map).set(t.index,s.primitives.length),s.map.set(t.container,e));return i},n.prototype._removeHLIndex=function(t){var e=this.highLight;if(e.map.has(t.container)){var i=e.map.get(t.container);i.has(t.index)&&(i.delete(t.index),0===i.size&&e.map.delete(t.container))}},n.prototype._findHLIndex=function(t){var e=-1,i=this.highLight;if(i.map.has(t.container)){var s=i.map.get(t.container);s.has(t.index)&&(e=s.get(t.index))}return e},n.prototype.addHighLightPrimitive=function(t){if(this.highLight){var e=this.highLight,i=this._findHLIndexOrAdd(t);if(-1===i){var s=t.clone();e.primitives.push(s),e.nbSelected.push(1),null===this.layer&&this.initLayers(),this.layer.addPrimitivesToLayers([s],1)}else e.nbSelected[i]++}},n.prototype.addHighLightRep=function(t){if(this.highLight){for(var e=this.highLight,s=[],r=new i.SGPrimitiveHelper,o=0;o<t.getPrimitivesCount();o++){r.set(t,o);var a=this._findHLIndexOrAdd(r);if(-1===a){var n=r.clone();e.primitives.push(n),e.nbSelected.push(1),s.push(n)}else e.nbSelected[a]++}null===this.layer&&this.initLayers(),this.layer.addPrimitivesToLayers(s,1)}},n.prototype.removeHighLightPrimitive=function(t){if(this.highLight){var e=this._findHLIndex(t);if(-1!==e&&null!==this.layer){var i=this.highLight;i.nbSelected[e]--,i.nbSelected[e]||(this._removeHLIndex(t),i.primitives.splice(e,1),i.nbSelected.splice(e,1),this.layer.addPrimitivesToLayers([t.clone()],0))}}},n.prototype.removeHighLightRep=function(e){if(this.highLight){for(var s=[],r=this.highLight,o=new i.SGPrimitiveHelper,a=new Set,n=0;n<e.getPrimitivesCount();n++){o.set(e,n);var h=this._findHLIndex(o);-1!==h&&(r.nbSelected[h]--,r.nbSelected[h]||(this._removeHLIndex(o),a.add(h),s.push(o.clone())))}if(a.size>0){var l=new Array(r.primitives.length-a.size),c=new Array(r.nbSelected.length-a.size),d=0;for(n=0;n<r.primitives.length;n++)a.has(n)||(l[d]=r.primitives[n],c[d++]=r.nbSelected[n]);r.primitives=l,r.nbSelected=c}null===this.layer&&(this.layer=new t.BufferLayer(this)),this.layer.addPrimitivesToLayers(s,0)}},n.prototype.removeHighLight=function(){this.highLight&&(this.layer=null,this.highLight.map.clear(),this.highLight.primitives=[],this.highLight.nbSelected=[])},n.prototype.initLayers=function(e){if(null===this.layer){this.layer=new t.BufferLayer(this);var i=1,s=this.geometry;this.geometry.length>=0&&(s=this.geometry[0],i=this.geometry.length);for(var r=0;r<i;r++)this._initLayersForGeometry(e,s),s=this.geometry[r+1]}},n.prototype._initLayersForGeometry=function(e,i){this.layer||(this.layer=new t.BufferLayer(this));for(var s=this.layer.getIntervals(i,null,!0),r=0;r<s.length;r++){var o=this.layer.layers.indexOf(s[r]);-1!==o&&this.layer.layers.splice(o,1)}for(var a=0;a<i.drawingGroups.length;a++){var n=i.drawingGroups[a],h=new t.DrawableInterval(e,n.start,n.count);h.primitiveStart=0,h.primitiveCount=n.getPrimitivesCount();var l=new t.LayerInterval(i,n,h);this.layer.layers.push(l)}},n.prototype._copyLayers=function(e){this.layer||(this.layer=new t.BufferLayer(this));for(var i=0;i<e.length;i++){var s=e[i];this.layer.layers.push(s.clone())}},n.prototype.hasPriorityManipulators=function(){if(this._manipulators)for(var t in this._manipulators)if(this._manipulators[t].active&&this._manipulators[t].getPickingPriority())return!0;return!1},n.prototype.getManipulators=function(){for(var t={},e=this._occurrence;e;){if(e._manipulators)for(var i in e._manipulators){var s=e._manipulators[i];t[i]=s}e=e.parent}return t},n.prototype.hasManipulators=function(){if(this._manipulators)for(var t in this._manipulators)if(this._manipulators[t].active)return!0;return!1},n.prototype._checkGeometry=function(){var t,e,i,s,r,o;if(this.geometry.length)for(t=this.geometry.length,i=0;i<t;i++)if(2===(r=this.geometry[i])._type)for(e=(o=r.drawingGroups).length,s=0;s<e;s++)if(0===o[s].glType)return this.hasPoint=!0,!0;return!1},n.prototype.getNode=function(){return this._occurrence&&this._occurrence.node},n.prototype.getSelectionGroup=function(t){if(!this.selectionGroups)return null;for(var e=0;e<this.selectionGroups.length;e++){var i=this.selectionGroups[e];if(i.contains(t))return i}return null},n.prototype.removeSelectionGroup=function(t){if(!this.selectionGroups)return null;for(var e=0;e<this.selectionGroups.length;e++){if(this.selectionGroups[e].contains(t)){this.selectionGroups.splice(e,1);break}}},n.prototype.addSelectionGroup=function(t){this.selectionGroups||(this.selectionGroups=[]),this.selectionGroups.push(t)},n.prototype._performFrustumCulling=function(t,e,i,s,r){return e.performFrustumCulling(i,s)},n.prototype.getMin=function(e){var i,s,r,o,a,n=void 0!==e?e:"z",h=null,l=new t.Vector3;for(s=null,r=0,this.geometry.length>=0?(s=this.geometry[0],r=this.geometry.length):2===this.geometry._type&&(s=this.geometry,r=1),o=0;o<r;o++){if(null===s.vertexPositionArray){s=this.geometry[o+1];continue}i=this._getMMMatrix();const t=s.getVertexCount();for(a=0;a<t;a++)s.getVertexPosition(a,l),l.applyMatrix4(i),(l[n]<h||null===h)&&(h=l[n]);s=this.geometry[o+1]}return h},Object.defineProperty(n.prototype,"drawInHLRender",{get:function(){return t.getWebVisualizationLevel()>425?console.error("drawInHLRender deprecated, use noPickThrough instead"):console.warn("drawInHLRender deprecated, use noPickThrough instead"),this.noPickThrough},set:function(e){t.getWebVisualizationLevel()>425?console.error("drawInHLRender deprecated, use noPickThrough instead"):console.warn("drawInHLRender deprecated, use noPickThrough instead"),this.noPickThrough=e}}),n}),define("DS/Object3D/Camera",["DS/Mesh/ThreeJS_Base","DS/Object3D/Object3D"],function(t,e){"use strict";var i,s="undefined"!=typeof EXPERIENCE_PLAYER,r=window.SIMULATE_EXPERIENCE_PLAYER,o={NONE:0,PRINCIPAL:1,REFLECTED:2,BACKGROUND:3,ROBOT_CONNECTED:4,ROBOT_ORTHO:5,FULL_SCREEN:6,STEREO:7,STEREO_BACKGROUND:8,STEREO_REFLECTED:9},a=function(){e.call(this),this.matrixWorldInverse=new t.Matrix4,this.projectionMatrix=new t.Matrix4,this.projectionMatrixInverse=new t.Matrix4,this.realProjectionMatrixInverse=new t.Matrix4,this.pixelCulling=4.5,this.isOrtho=!1,this._hasChanged=!0,this.externalProjectionMatrix=!1,this.fixedSizeCameraConstant=1,this.pixelCullingCst=0,this._cstLOD=0,this._viewpoint=null,this.aspect=1,this._renderingRole=o.NONE};(a.prototype=Object.create(e.prototype))._setBackgroundRenderingRoleFromPrincipal=function(t){switch(t._renderingRole){case o.STEREO:this._renderingRole=o.STEREO_BACKGROUND;break;case o.PRINCIPAL:default:this._renderingRole=o.BACKGROUND}},a.prototype._setReflectedRenderingRoleFromPrincipal=function(t){switch(t._renderingRole){case o.STEREO:this._renderingRole=o.STEREO_REFLECTED;break;case o.PRINCIPAL:default:this._renderingRole=o.REFLECTED}},a.prototype.clone=function(t){return void 0===t&&(t=new a),e.prototype.cloneSimple.call(this,t),t.matrixWorldInverse.copy(this.matrixWorldInverse),t.projectionMatrix.copy(this.projectionMatrix),t.projectionMatrixInverse.copy(this.projectionMatrixInverse),t.fixedSizeCameraConstant=this.fixedSizeCameraConstant,t.pixelCullingCst=this.pixelCullingCst,t._viewpoint=this._viewpoint,t.aspect=this.aspect,t.pixelCulling=this.pixelCulling,t},a.prototype.lookAt=(i=new t.Matrix4,function(t){i.lookAt(this.position,t,this.up),!0===this.useQuaternion?this.quaternion.setFromRotationMatrix(i):this.rotation.setEulerFromRotationMatrix(i,this.eulerOrder)}),a.prototype.setViewOffsetInternal=function(t,e,i,s,r,o,a,n){(this.fullWidth!=t||this.fullHeight!=e||this.x!=i||this.y!=s||this.width!=r||this.height!=o||this.pickingRatio)&&(this.fullWidth=t,this.fullHeight=e,this.x=i,this.y=s,this.width=r,n||(a&&this.height?this.visualizedHeight=this.height:this.visualizedHeight=0,this._hasChanged=!0),a?(this.pickingRatioW=a.ratioW,this.pickingRatioH=a.ratioH):(this.pickingRatioW=null,this.pickingRatioH=null),this.height=o,this.realProjectionMatrixInverse=this.projectionMatrixInverse.clone(),this.updateProjectionMatrix())},a.prototype.setViewOffset=function(t,e,i,s,r,o){console.warn("deprecated ! use viewpoint.setViewOffset instead"),this.setViewOffsetInternal(t,e,i,s,r,o)};var n=function(t,e,i,s,r,o){a.call(this),this.left=t,this.right=e,this.top=i,this.bottom=s,this.near=void 0!==r?r:.1,this.far=void 0!==o?o:2e3,this.fov=45,this.isOrtho=!0,this.updateProjectionMatrix(),this.visualizedHeight=400};(n.prototype=Object.create(a.prototype)).clone=function(t){return void 0===t&&(t=new n),a.prototype.clone.call(this,t),this.fullWidth?(t.fullWidth=this.fullWidth,t.fullHeight=this.fullHeight,t.x=this.x,t.y=this.y,t.width=this.width,t.height=this.height):(t.fullWidth&&delete t.fullWidth,t.fullHeight&&delete t.fullHeight),t.left=this.left,t.right=this.right,t.top=this.top,t.bottom=this.bottom,t.near=this.near,t.far=this.far,this.visualizedHeight&&(t.visualizedHeight=this.visualizedHeight),t.updateProjectionMatrix(),t},n.prototype.getCameraConstant=function(t,e){return t*(this.top-this.bottom)/(e||1)},n.prototype.getWorldSizeFromPixelSize=function(t,e,i){return t*(this.top-this.bottom)/(i||1)},n.prototype.updateProjectionMatrix=function(t,e){var i=Math.abs(this.right-this.left),s=Math.abs(this.top-this.bottom),r=t||0,o=e||0;if(this.fullWidth){this.aspect=this.fullWidth/this.fullHeight;var a=this.fullWidth/this.fullHeight,n=this.top,h=n-s,l=a*h,c=a*n;i=Math.abs(c-l),s=Math.abs(n-h);this.projectionMatrix.makeOrthographic(l+(this.x+r*this.width)/this.fullWidth*i,l+(this.x+(1+r)*this.width)/this.fullWidth*i,n-(this.y+o*this.height)/this.fullHeight*s,n-(this.y+(1+o)*this.height)/this.fullHeight*s,this.near,this.far)}else this.projectionMatrix.makeOrthographic(this.left+r*i,this.right+r*i,this.top+o*s,this.bottom+o*s,this.near,this.far);this.projectionMatrixInverse.getInverse(this.projectionMatrix)},n.prototype.setVisualizedHeight=function(t,e,i){this.fov=i||(this.fov?this.fov:45);var s=this.visualizedHeight;this.visualizedHeight=t?2*t*Math.tan(Math.PI*this.fov/360):this.visualizedHeight?this.visualizedHeight:400,this.visualizedHeight!==s&&(this._hasChanged=!0),this.aspect=e||(this.aspect?this.aspect:1),this.top=this.visualizedHeight/2,this.bottom=-this.top,this.left=this.aspect*this.bottom,this.right=-this.left,this.updateProjectionMatrix()},n.prototype.setViewportInfos=function(t,e,i,s){t==this.top&&e==this.bottom&&i==this.left&&s==this.right||(this._hasChanged=!0,this.top=t,this.bottom=e,this.left=i,this.right=s,this.updateProjectionMatrix())};var h=function(t,e,i,s){a.call(this),this.fov=void 0!==t?t:50,this.aspect=void 0!==e?e:1,this.near=void 0!==i?i:.1,this.far=void 0!==s?s:2e3,this.offsetX=0,this.offsetY=0,this.sensorSizeHeight=24,this.sensorSizeWidth=36,this.focalLength=.5*this.sensorSizeHeight/Math.tan(this.fov*Math.PI/360),this.aperture=.9,this.blades=0,this.updateProjectionMatrix()};return(h.prototype=Object.create(a.prototype)).clone=function(t){return void 0===t&&(t=new h),a.prototype.clone.call(this,t),t.fov=this.fov,t.aspect=this.aspect,t.near=this.near,t.far=this.far,t.externalProjectionMatrix=this.externalProjectionMatrix,t.sensorSizeHeight=this.sensorSizeHeight,t.sensorSizeWidth=this.sensorSizeWidth,t.focalLength=this.focalLength,t.aperture=this.aperture,t.blades=this.blades,this.fullWidth?(t.fullWidth=this.fullWidth,t.fullHeight=this.fullHeight,t.x=this.x,t.y=this.y,t.width=this.width,t.height=this.height):(t.fullWidth&&delete t.fullWidth,t.fullHeight&&delete t.fullHeight),t.updateProjectionMatrix(),t},h.prototype.setLens=function(e,i,s){i&&i.length&&(this.sensorSizeHeight=i[1],this.sensorSizeWidth=i[0]),this.focalLength=e||this.focalLength,this.fov=s?2*t.Math.radToDeg(Math.atan(this.sensorSizeWidth/(2*this.focalLength))):2*t.Math.radToDeg(Math.atan(this.sensorSizeHeight/(2*this.focalLength))),this.updateProjectionMatrix()},h.prototype.setAperture=function(t,e){this.aperture=t,this.blades=void 0!==e?e:0},h.prototype.getCameraConstant=function(t,e){return 2*Math.tan(.5*this.fov*Math.PI/180)*t/(e||1)},h.prototype.getWorldSizeFromPixelSize=function(t,e,i){var s=this.matrixWorldInverse.elements;return 2*Math.abs(s[2]*e.x+s[6]*e.y+s[10]*e.z+s[14])*Math.tan(.5*this.fov*Math.PI/180)*t/(i||1)},h.prototype.performPixelAndFrustumCullingOnGeometry=function(t,e,i,s){if(2!==s._type||!i.frustumCulled)return!0;var r=s===i.geometry?s:i.geometry.indexOf(s),o=i.geomWorldBE[r];if(!o)return!0;var a=o.center,n=o.radius,h=this.pixelCulling,l=this.matrixWorldInverse.elements;if(h>0){var c=h;if(!i._ratioData||0===i._ratioData.ratio){var d=Math.abs(l[2]*a.x+l[6]*a.y+l[10]*a.z+l[14]);c=this.pixelCullingCst*d}if(n<c)return!1}var p=n;if(i._ratioData&&i._ratioData.ratio>0){d=Math.abs(l[2]*a.x+l[6]*a.y+l[10]*a.z+l[14]);p*=this.fixedSizeCameraConstant*d}return t.performFrustumCulling(p,a)},h.prototype.performPixelCullingOnDG=function(t,e,i,o,a,n){if(s&&!EXPERIENCE_PLAYER||!s&&!r){var h=e.geometry.indexOf(i),l=e.geomWorldBE[h];if(!l)return n;if(this.pixelCulling>0){var c=l.center,d=l.radius,p=0,u=o.cullingData.length-1,g=this.matrixWorldInverse.elements,m=this.pixelCulling,f=!e._ratioData||0===e._ratioData.ratio,y=e.matrixWorld.getMaxScaleOnAxis(),_=e._ratioData.ratio/y;if(f){var v=Math.abs(g[2]*c.x+g[6]*c.y+g[10]*c.z+g[14])-d;m=this.pixelCullingCst*v}for(;u-p>1;){var x=Math.floor(.5*(p+u));(S=o.cullingData[x]).start;if(S.start<a&&(p=x),S.start>a+n)return n;var b=S.radius*y;f||(b*=_),b<m?u=x:p=x}var w=u;if(p!==u){b=(S=o.cullingData[p]).radius*y;f||(b*=_),b<m&&(w=p)}if(w<o.cullingData.length-1){var S=o.cullingData[w];return Math.max(S.start-a,0)}b=(S=o.cullingData[w]).radius*y;if(f||(b*=_),b<m)return Math.max(S.start-a,0)}return n}},h.prototype.updateProjectionMatrix=function(e,i){if(!this.externalProjectionMatrix){var s=e||0;s+=this.offsetX?this.offsetX:0;var r=i||0;if(r+=this.offsetY?this.offsetY:0,this.fullWidth){var o=this.fullWidth/this.fullHeight,a=o*(d=-(c=Math.tan(t.Math.degToRad(.5*this.fov))*this.near)),n=o*c,h=Math.abs(n-a),l=Math.abs(c-d);this.projectionMatrix.makeFrustum(a+(this.x+s*this.width)/this.fullWidth*h,a+(this.x+(1+s)*this.width)/this.fullWidth*h,c-(this.y+(1+r)*this.height)/this.fullHeight*l,c-(this.y+r*this.height)/this.fullHeight*l,this.near,this.far)}else if(this._viewpoint&&this._viewpoint._nativeTranslationOffset){var c,d=-(c=Math.tan(t.Math.degToRad(.5*this.fov))*this.near);a=this.aspect*d,n=this.aspect*c,h=Math.abs(n-a),l=Math.abs(c-d);this.projectionMatrix.makeFrustum(a+this._viewpoint._nativeTranslationOffset.x*this.near,n+this._viewpoint._nativeTranslationOffset.x*this.near,d+this._viewpoint._nativeTranslationOffset.y*this.near,c+this._viewpoint._nativeTranslationOffset.y*this.near,this.near,this.far)}else this.projectionMatrix.makePerspective(this.fov,this.aspect,this.near,this.far,s,r);this.projectionMatrixInverse.getInverse(this.projectionMatrix)}},{_CameraRoles:o,_FrameTypes:{MAIN:0,GPU_INTERSECTION:1,GPU_INTERSECTION_SMALL:2,COLLISION:3},BaseCamera:a,OrthographicCamera:n,PerspectiveCamera:h}}),define("DS/Object3D/Scene",["DS/Mesh/ThreeJS_Base","DS/Object3D/Object3D","DS/Object3D/Light","DS/Object3D/Camera","DS/Object3D/Mesh","DS/Visualization/WebGLObjectManager","DS/Visualization/CullingSystem","DS/Visualization/BufferGPUManager"],function(t,e,i,s,r,o,a,n){"use strict";var h=function(){e.call(this),this.overrideMaterial=null,this.matrixAutoUpdate=!1,this.envMipMap=[],this.envMipMapID=null,this.envMipMapSheenID=null,this.ambienceMatrix=new t.Matrix4,this.reflectionProbes=[],this.useFiniteEnvMap=!1,this.parallaxCorrectionParameters={sphereCenter:[],sphereRadius:1,projectionCenter:[]},this._cullingSystems=[],this.__objects=new Set,this.__lights=[],this.__objectsAdded=new Map,this.__objectsRemoved=new Set,this.__objectsUpdated=new Map,this.defaultRenderList="main",this.isBackground=!1,this.highlightData=null,this.initWebGLObjectFrameIndex=-1,this.__webglObjects=null,this.__webglObjectsAll=null,this.__webglObjectsToDraw=null,this.__webglObjectsSharedToInit=null,this.__webglSprites=null,this.__webglFlares=null,this.renderResultIndices=null};(h.prototype=Object.create(e.prototype)).constructor=h,h.prototype._lightSort=function(t,e){var i=t._sortKey,s=e._sortKey;return i=t.onlyShadow?0:i,s=e.onlyShadow?0:s,i+=t.castShadow?1:0,s+=e.castShadow?1:0,i+=t.shadowCascade?2:0,(s+=e.shadowCascade?2:0)-i},h.prototype.__addObject=function(e,r){e instanceof i.BaseLight?(-1===this.__lights.indexOf(e)&&(this.__lights.push(e),this.__lights.sort(this._lightSort)),e.target&&void 0===e.target.parent&&this.add(e.target)):e instanceof t.LensFlare?(this.__webglFlares||(this.__webglFlares=[]),this.__webglFlares.push(e)):e instanceof s.BaseCamera||e instanceof t.Bone||(e._scenes||(e._scenes=new Set),e._scenes.add(this),this.__objects.add(e),this.__objectsUpdated.has(e)?this.__objectsUpdated.set(e,r):this.__objectsAdded.set(e,r),n.addGeometryFromObject(e),this.__objectsRemoved.delete(e));for(var o=0;o<e.children.length;o++)this.__addObject(e.children[o])},h.prototype.dispose=function(){var t,e=this.children.length;for(t=0;t<this.__lights.length;t++){var i=this.__lights[t];i.shadowMap&&i.shadowMap.dispose&&i.shadowMap.dispose()}for(t=0;t<e;t++)this.remove(this.children[0]);if(this.__objects.clear(),this.__lights=[],this.__objectsAdded.clear(),this.__objectsRemoved.clear(),this.__objectsUpdated.clear(),this.__webglObjects={main:new o},this.__webglObjectsAll=new o,this.__webglObjectsToDraw=[],this.__webglSprites=[],this._cullingSystems=[],a.__CullingSystemFactory){var s=a.__CullingSystemFactory.map,r=s.get(this.id);r&&(r.clear(),s.delete(this.id))}},h.prototype.updateObjectPasses=function(e,r){e instanceof i.BaseLight||e instanceof t.LensFlare||e instanceof s.BaseCamera||e instanceof t.Bone||(this.__objectsAdded.has(e)?this.__objectsAdded.set(e,r||null):this.__objectsUpdated.set(e,r||null))},h.prototype.getScene=function(){return this},h.prototype.getMeshInstances=function(){var t=[],e=this.getWebGLObjects("main",0);if(!e)return t;for(var i=0;i<e.length;i++){var s=e[i].object;s instanceof r&&t.push(s)}return t},h.prototype.__removeObject=function(e){if(e instanceof i.BaseLight)-1!==(r=this.__lights.indexOf(e))&&this.__lights.splice(r,1);else if(e instanceof t.LensFlare){var r;-1!==(r=this.__webglFlares.indexOf(e))&&this.__webglFlares.splice(r,1)}else e instanceof s.BaseCamera||this.__objects.delete(e)&&(this.__objectsRemoved.add(e),e._scenes&&e._scenes.delete(this),this.flagAsGSSOInvalidated(e),e._removeFromAllStateSortingResults(),this.__objectsAdded.delete(e));for(var o=0;o<e.children.length;o++)this.__removeObject(e.children[o])},h.prototype.getWebGLObjects=function(t,e){var i=this.__webglObjects[t&&"main"!==t?t:this.defaultRenderList];return i?i.getObjects(e):[]},h.prototype.flagAsGSSOInvalidated=function(t){if(null!==t)for(var e=this._cullingSystems,i=0;i<e.length;i++){var s=e[i];for(var r in s.objectManagers){var o=s.objectManagers[r].list.idMap;if(o.has(t))for(var a=o.get(t),n=0;n<a.length;n++)s.objectManagers[r].list.objects[a[n]].invalidated=!0}}},h.prototype.flagAsFrustumCulled=function(t,e){if(null!==t){var i=this.__webglObjectsAll;if(null!==i){var s=i.idMap;if(s.has(t))for(var r=s.get(t),o=0;o<r.length;o++)i.objects[r[o]].frustumCulled=e}}},h.prototype.getNbWebGLObjects=function(t){return this.__webglObjects?this.getWebGLObjects(t,0).length:0},h.prototype.getAllWebGLObjects=function(t){return this.__webglObjectsAll.getObjects(t)},h.prototype.getNbAllWebGLObjects=function(){return this.__webglObjects?this.getAllWebGLObjects(0).length:0},h.prototype.computeLightsKey=function(){for(var t=this.__lights,e={dirLights:0,dirIBLLights:0,dirPhongLights:0,pointLights:0,spotLights:0,sphereLights:0,areaLights:0,diskLights:0,tubeLights:0,iesLights:0,key:0},i={dirLight:0,dirIBLLight:0,spotLight:0,tex2d:0,texCube:0},s=t.length,r=0;r<s;r++){var o=t[r];o.onlyShadow||(o.allocate(e),o.castShadow&&o.allocateShadows(null,i))}var a=e.iesLights;return a=16*(a=16*(a=16*(a=16*(a=16*(a=16*(a=16*(a=16*(a=16*(a=16*(a=16*(a=16*(a=16*a+e.pointLights)+e.spotLights)+e.dirLights)+e.dirIBLLights)+e.dirPhongLights)+e.areaLights)+e.sphereLights)+e.diskLights)+e.tubeLights)+i.texCube)+i.spotLight)+i.dirLight)+i.dirIBLLight,e.key=a,e};const l=["main"],c=a.WebGLObjectCullingStatus,d=o.__WebGLObject,p=o.__WebGLObjectNoPoints,u=o.__WebGLObjectCurvedPipe,g=o.__WebGLObjectFixedSize;function m(t,e,i,s){var r,a,n=t.__webglObjects,h=t.__webglObjectsAll,m=t._cullingSystems,f=null;s||(s=l);var y=null;for(y=i.isCurvedPipe?new u(e,i):i._ratioData&&i._ratioData.ratio>0?new g(e,i):i.hasPoint?new d(e,i):new p(e,i),r=0;r<s.length;r++){n[a=s[r]]||(n[a]=new o),n[a].add(y);for(var _=0;_<m.length;_++){(f=m[_]).objectManagers[a]||(f.objectManagers[a]={list:new o,frame:-1});var v=new c(y);f.objectManagers[a].list.add(v),f.objectManagers[a].frame=-2}}h.add(y)}function f(e,i,s){var r,o,a=e.object,n=e.passes,h=!1;a.__webglActive===i?h=!0:a.__webglActive instanceof Array&&a.__webglActive.indexOf(i)>=0&&(h=!0);var l=null;if(!h){var c=!0;if(a instanceof t.Mesh){if(1===(o=a.geometry)._type)m(i,o,a,n);else if(2===o._type||o.length>=0)m(i,o,a,n);else if(0===o._type)for(r in o.geometryGroups)m(i,o.geometryGroups[r],a,n)}else a instanceof t.Line||a instanceof t.ParticleSystem?m(i,o=a.geometry,a,n):a instanceof t.Sprite?(i.__webglSprites.push(a),c=!1):a instanceof t.CSS2DNode?m(i,null,a,["css2d"]):a instanceof t.CSS3DNode&&m(i,null,a,["css3d"]);a.__webglActive?a.__webglActive instanceof Array?a.__webglActive.push(i):a.__webglActive=[a.__webglActive,i]:a.__webglActive=i,s&&(l=c?i.__webglObjectsAll.objects[i.__webglObjectsAll.objects.length-1]:{object:a})}return l}function y(e,i,s){e instanceof t.Mesh||e instanceof t.ParticleSystem||e instanceof t.Line||e instanceof t.CSS2DNode||e instanceof t.CSS3DNode?(s&&function(t,e){var i,s=t.__webglObjects,r=t.__webglObjectsAll;for(i in s)s[i].remove(e);r.remove(e);for(var o=t._cullingSystems,a=null,n=0;n<o.length;n++)for(i in(a=o[n]).objectManagers)a.objectManagers[i].list.remove(e),a.objectManagers[i].frame=-2}(i,e),e._removeFromAllStateSortingResults()):e instanceof t.Sprite&&function(t,e){for(var i=t.length-1;i>=0;i--)t[i]===e&&t.splice(i,1)}(i.__webglSprites,e);var r,o=e.__webglActive;o&&(o instanceof Array?(r=o.indexOf(i))<=0&&(o.splice(r,1),1===o.length&&(e.__webglActive=o[0])):e.__webglActive=!1)}return h.prototype.__processAddedObjects=function(t){var e=this;this.__objectsAdded.forEach(function(i,s,r){t({object:s,passes:i},e,!1,f)}),this.__objectsAdded.clear()},h.prototype.__processUpdatedObjects=function(t){var e=this;this.__objectsUpdated.forEach(function(i,s,r){y(s,e,!0),t({object:s,passes:i},e,!0,f)}),this.__objectsUpdated.clear()},h.prototype.__processRemovedObjects=function(t){var e=this;t.removeGeometryList(this.__objectsRemoved),this.__objectsRemoved.forEach(function(t,i,s){y(t,e,!1)}),function(t){var e,i=t.__webglObjects,s=t.__webglObjectsAll,r=t.__objectsRemoved;for(e in i)i[e].removeCollection(r);s.removeCollection(r);for(var o=t._cullingSystems,a=null,n=0;n<o.length;n++)for(e in(a=o[n]).objectManagers)a.objectManagers[e].list.removeCollection(r),a.objectManagers[e].frame=-2}(this),this.__objectsRemoved.clear()},h});