define("DS/CAT3DExpModel/interfaces/CATI3DXJSONProcessor",["DS/VIAIdeaExperienceScenarioModelWeb/interfaces/CATI3DXJSONProcessor"],function(e){"use strict";return console.warn("DS/CAT3DExpModel/interfaces/CATI3DXJSONProcessor"),e}),define("DS/CAT3DExpModel/extensions/CATE3DExpVCXObjectConvertor",["UWA/Core","UWA/Class"],function(e,t){"use strict";return t.extend({GetNeutralsFromVariables:function(e){return e},UpdateVariablesFromNeutrals:function(){}})}),define("DS/CAT3DExpModel/extensions/XCTEWSEAssetLoadCategory",["UWA/Core"],function(e){"use strict";return e.Class.extend({getCategory:function(){return"default"}})}),define("DS/CAT3DExpModel/XCTPLMDocumentHelper",["UWA/Core","DS/DocumentManagement/DocumentManagement","DS/WAFData/WAFData"],function(e,t,r){"use strict";return{getDocumentFile:function(e,t,r,n){return this._getDocumentFileID(e,t,r,n).then(t=>this._getDocumentFileURL(e,t,r,n)).then(e=>this._getDocumentFileFromURL(e))},_getDocumentFileID:function(r,n,i,a){var o=e.Promise.deferred();return t.getDocuments([r],{tenant:i,tenantUrl:a,onComplete:function(e){if(e.data.length<1)o.reject(new Error("Cant Retrieve PLMDocument"));else{for(var t=e.data[0].relateddata.files,r=0;r<t.length;r++)if(t[r].dataelements.title===n){o.resolve(t[r].id);break}o.reject(new Error("PLMDocument : Cant Retrieve File "+n))}},onFailure:function(e){o.reject(new Error(e))}}),o.promise},_getDocumentFileURL:function(r,n,i,a){var o=e.Promise.deferred();return t.downloadDocument([r],n,!1,{tenant:i,tenantUrl:a,onComplete:function(e){o.resolve(e)},onFailure:function(e){o.reject(new Error(e))}}),o.promise},_getDocumentFileFromURL:function(t){var n=e.Promise.deferred();return r.authenticatedRequest(t,{method:"GET",type:"text",proxy:"passport",onComplete:function(e){n.resolve(new Blob([e]))},onFailure:function(e){n.reject(new Error(e))}}),n.promise}}}),define("DS/CAT3DExpModel/expCoreLink/ExpCoreLinkContext",["UWA/Core","UWA/Class"],function(e,t){"use strict";return t.extend({init:function(e,t){this._expCoreLinkManager=t},_createExpCoreLinkContext:function(e,t){return this._expCoreLinkManager._createExpCoreLinkContext(e,t)},_createExpCoreLinkService:function(e){return this._expCoreLinkManager._createExpCoreLinkService(e)},_getContent:function(){console.error("ExpCoreLinkContext._getContent must be implement by derived class")},_getService:function(){console.error("ExpCoreLinkContext._getService must be implement by derived class")},_getParentLinkContext:function(){console.error("ExpCoreLinkContext._getParentLinkContext must be implement by derived class")},_getParentService:function(){console.error("ExpCoreLinkContext._getParentService must be implement by derived class")},_resolveLink:function(t){if("ExpCore://./"===t)return this._getContent();if(t.startsWith("ExpCore://./../")){let e="ExpCore://./"+t.slice(15);var r=this._getParentLinkContext();return this._getParentService()._resolveLink(e,r)}if(t.startsWith("ExpCore://./")){var n=t.slice(12),i=n.indexOf("/"),a=n.substr(0,i);let e="ExpCore://./"+n.substr(i+1);var o=this._getService(a);if(o)return o._resolveLink(e,this)}return e.Promise.reject(new Error("Cant resolve this link"+t))}})}),define("DS/CAT3DExpModel/interfaces/CATI3DExpVCXObjectConvertor",["UWA/Class","DS/WebComponentModeler/CATWebInterface"],function(e,t){"use strict";return t.singleton({interfaceName:"CATI3DExpVCXObjectConvertor",required:{GetNeutralsFromVariables:function(){},UpdateVariablesFromNeutrals:function(){}},optional:{}})}),define("DS/CAT3DExpModel/interfaces/CATIAlias",["UWA/Class","DS/WebComponentModeler/CATWebInterface"],function(e,t){"use strict";return t.singleton({interfaceName:"CATIAlias",required:{GetAlias:function(){},SetAlias:function(){}},optional:{}})}),define("DS/CAT3DExpModel/managers/W3AACAT3DXEnvironmentManager",["UWA/Core","DS/WebApplicationBase/W3AAManager"],function(e,t){"use strict";return t.extend({update:function(){this.GetObject()._update()}})}),define("DS/CAT3DExpModel/expCoreLink/ExpCoreLinkService",["UWA/Core","UWA/Class"],function(e,t){"use strict";return t.extend({init:function(e){this._expCoreLinkManager=e},_createExpCoreLinkContext:function(e,t){return this._expCoreLinkManager._createExpCoreLinkContext(e,t)},_getChildLinkContextFromIdentifier:function(){return e.Promise.reject(new Error("ExpCoreLinkService._getLinkContext must be implement by derived class"))},_resolveLink:function(t,r){if(t.startsWith("ExpCore://./../")){let e="ExpCore://./"+t.slice(15);return r._resolveLink(e)}if(t.startsWith("ExpCore://./")){var n=t.slice(12),i=n.indexOf("/");let e,a;return-1===i?(a=n,e="ExpCore://./"):(a=n.substr(0,i),e="ExpCore://./"+n.substr(i+1)),this._getChildLinkContextFromIdentifier(r,a).then(function(t){return t._resolveLink(e)})}return e.Promise.reject(new Error("Cant resolve this link"+t))}})}),define("DS/CAT3DExpModel/XCTExpPathOfIds",["UWA/Core","UWA/Class"],function(e){"use strict";var t=e.Class.extend({init:function(){this._pathOfIdsArray=[]},setFromArray:function(e){this._pathOfIdsArray=e.slice()},toArray:function(){return this._pathOfIdsArray.slice()},toString:function(){return this._pathOfIdsArray.toString()},clone:function(){var e=new t;return e.setFromArray(this._pathOfIdsArray),e},pushId:function(e){return this._pathOfIdsArray.push(e)},popId:function(){return this._pathOfIdsArray.pop()},isEqual:function(e){return e.toString()===this.toString()},contains:function(e){return this.toString().contains(e.toString())},getLength:function(){return this._pathOfIdsArray.length},getIdByIndex:function(e){return this._pathOfIdsArray[e]}});return t}),define("DS/CAT3DExpModel/extensions/CATE3DExpState",["UWA/Core"],function(e){"use strict";return e.Class.extend({ApplyStatedValues:function(){var t=[],r=this.QueryInterface("CATI3DExperienceObject").GetValueByName("_listObjectTracks");if(r){for(var n=0;n<r.length;n++){var i=r[n].QueryInterface("CATI3DExperienceObject");if(i){var a=i.QueryInterface("CATI3DExperienceObject").GetValueByName("_targetObject");if(!a)continue;for(var o=i.QueryInterface("CATI3DExperienceObject").ListLocalVariables(),s=0;s<o.length;++s)if("_targetObject"!==o[s]&&"_varName"!==o[s]&&a.QueryInterface("CATI3DExperienceObject").HasVariable(o[s])&&i.QueryInterface("CATI3DExperienceObject").GetVariableType(o[s])===a.QueryInterface("CATI3DExperienceObject").GetVariableType(o[s])&&i.QueryInterface("CATI3DExperienceObject").GetVariableValuationMode(o[s])===a.QueryInterface("CATI3DExperienceObject").GetVariableValuationMode(o[s])){var c=i.QueryInterface("CATI3DExperienceObject").GetValueByName(o[s]);null!==c&&t.push(a.QueryInterface("CATI3DExperienceObject").SetValueByName(o[s],c).catch(function(t){return"true"===localStorage.getItem("EWS_Debug")&&console.warn(t),e.Promise.reject(t)}))}}}return e.Promise.allSettled(t)}}})}),define("DS/CAT3DExpModel/expCoreLink/ExpCoreLinkManager",["UWA/Core","UWA/Class"],function(e,t){"use strict";return t.extend({init:function(){this._rootServices={},this._shortcuts={},this._linkContextMap={},this._linkServicetMap={}},_dispose:function(){delete this._rootServices,delete this._shortcuts,delete this._linkContextMap,delete this._linkServicetMap},_addExpCoreLinkContext:function(e,t){this._linkContextMap[e]&&console.warn(e+" Link Context is replaced"),this._linkContextMap[e]=t},_removeExpCoreLinkContext:function(e){delete this._linkContextMap[e]},_addExpCoreLinkService:function(e,t){this._linkServicetMap[e]&&console.warn(e+" Link Service is replaced"),this._linkServicetMap[e]=t},_removeExpCoreLinkService:function(e){delete this._linkServicetMap[e]},_createExpCoreLinkContext:function(e,t){return new this._linkContextMap[e](t,this)},_createExpCoreLinkService:function(e){if(this._linkServicetMap[e])return new this._linkServicetMap[e](this)},_addExpCoreLinkServiceRoot:function(e,t){this._rootServices[e]&&console.warn(e+" Root service is replaced"),this._rootServices[e]=this._createExpCoreLinkService(t)},_removeExpCoreLinkServiceRoot:function(e){delete this._rootServices[e]},_addExpCoreLinkContextShortcut:function(e,t,r){this._shortcuts[e]&&console.warn(e+" Shortcut is replaced"),this._shortcuts[e]=this._createExpCoreLinkContext(t,r)},_removeExpCoreLinkContextShortcut:function(e){delete this._shortcuts[e]},resolveLink:function(t,r,n){if("string"!=typeof t||!t.startsWith("ExpCore://"))return e.Promise.reject(new Error("Cant resolve this link"+t));var i=t.slice(10);if(i.startsWith("."))return this._createExpCoreLinkContext(r,n)._resolveLink("ExpCore://./"+i);var a=i.indexOf("/"),o=i.substr(0,a),s="ExpCore://./"+i.substr(a+1);return this._rootServices[o]?this._rootServices[o]._resolveLink(s):this._shortcuts[o]?this._shortcuts[o]._resolveLink(s):e.Promise.reject(new Error("Cant resolve this link"+t))}})}),define("DS/CAT3DExpModel/XCTEWS",["UWA/Core","UWA/Class"],function(e){"use strict";return e.Class.extend({initialize:function(){return e.Promise.reject(new Error("XCTEWS.initialize: Must be implemented by derived class."))},dispose:function(){return e.Promise.reject(new Error("XCTEWS.close: Must be implemented by derived class."))}})}),define("DS/CAT3DExpModel/XCTEWSObjectModelerAsyncDictionary",["UWA/Core","UWA/Class","DS/WebExtensionServers/WebExtensionServer"],function(e,t,r){"use strict";return e.Class.extend({init:function(e){this._experienceBase=e.experienceBase,this._interfacesTable=e.interfacesTable,this._componentsTable=e.componentsTable,this._managersTable=e.managersTable,this._ewsExtensionServer=new r,this._experienceBase.AddDictionaryApp(this),this._addComponentPromises={},this._componentsClasses={},this._componentsClassesPromises={}},fillServer:function(){return this._ewsExtensionServer},_dispose:function(){delete this._experienceBase,delete this._interfacesTable,delete this._componentsTable,delete this._managersTable,delete this._ewsExtensionServer,delete this._addComponentPromises,delete this._componentsClasses,delete this._componentsClassesPromises},_buildManager:function(t){var r=this;let n;return(n=this._managersTable[t].impl?this._require(this._managersTable[t].impl):e.Promise.resolve(e.Class.extend({GetType:function(){return t}}))).then(function(e){return r._ewsExtensionServer.AddComponent(t,e),r._addExtensions(t,r._managersTable[t].extensions)}).then(function(){var e=r._experienceBase.Factory.BuildComponent(t);return e.SetID(t),e})},_buildComponent:function(t,r,n){var i=this._experienceBase.Factory.BuildComponent(t);if(i)return i.SetID(n),e.Promise.resolve(i);var a=this;return this._addComponent(t,r).then(function(){return a._experienceBase.Factory.BuildComponent(t)}).then(function(e){return e.SetID(n),e})},_addComponent:function(t,r){if(this._addComponentPromises[t])return this._addComponentPromises[t];var n,i=this;return this._addComponentPromises[t]=this._getComponentClass(t,r).then(function(e){return n=e,i._addComponentExtensions(t,r)}).then(function(){i._ewsExtensionServer.AddComponent(t,n),delete i._addComponentPromises[t]}).catch(function(r){return delete i._addComponentPromises[t],e.Promise.reject(r)}),this._addComponentPromises[t]},_getComponentClass:function(t,r){if(!t)return e.Promise.resolve(e.Class.extend({}));if(this._componentsClasses[t])return e.Promise.resolve(this._componentsClasses[t]);if(this._componentsClassesPromises[t])return this._componentsClassesPromises[t];var n=this;if(this._componentsTable[t]&&this._componentsTable[t].impl)return this._componentsClassesPromises[t]=this._require(this._componentsTable[t].impl).then(function(e){return n._componentsClasses[t]=e,delete n._componentsClassesPromises[t],n._componentsClasses[t]}).catch(function(r){return delete n._componentsClassesPromises[t],e.Promise.reject(r)}),this._componentsClassesPromises[t];var i=r.slice();i.pop();var a=i[i.length-1];return this._componentsClassesPromises[t]=this._getComponentClass(a,i).then(function(e){return n._componentsClasses[t]=e.extend({GetType:function(){return t}}),delete n._componentsClassesPromises[t],n._componentsClasses[t]}).catch(function(r){return delete n._componentsClassesPromises[t],e.Promise.reject(r)}),this._componentsClassesPromises[t]},_addComponentExtensions:function(e,t){for(var r={},n=0;n<t.length;n++){var i=this._componentsTable[t[n]];if(i){var a=i.extensions;if(a)for(var o in a)a.hasOwnProperty(o)&&(r[o]=a[o])}}return this._addExtensions(e,r)},_addExtensions:function(t,r){if(!r)return e.Promise.resolve();var n=[];for(var i in r)r.hasOwnProperty(i)&&n.push(this._addExtension(t,i,r[i]));return e.Promise.all(n)},_addExtension:function(t,r,n){var i=this;return this._require(n).then(function(a){return a.GetOrigin=function(){return n},i._ewsExtensionServer.AddExtension(t,r,a),i._ewsExtensionServer.GetInterface(r)?e.Promise.resolve():i._addInterface(r)})},_addInterface:function(e){var t=this;return this._require(this._interfacesTable[e]).done(function(r){t._ewsExtensionServer.AddInterface(e,r)})},_require:function(t){var r=e.Promise.deferred();return require([t],function(e){r.resolve(e)},function(e){r.reject(e)}),r.promise}})}),define("DS/CAT3DExpModel/XCTExpDataObjectMap",["UWA/Core","UWA/Class"],function(e){"use strict";return e.Class.extend({init:function(){this._expDataObjects={},this._unresolvedExpObjects={}},_dispose:function(){this._expDataObjects={},this._unresolvedExpObjects={}},_addExpDataObject:function(e,t){var r=e.toString();r in this._expDataObjects&&console.error("2 Objects share the same id"),this._expDataObjects[r]=t,r in this._unresolvedExpObjects&&(this._unresolvedExpObjects[r].resolve(t),delete this._unresolvedExpObjects[r])},_removeExpDataObject:function(e){var t=e.toString();t in this._expDataObjects&&delete this._expDataObjects[t],t in this._unresolvedExpObjects&&(this._unresolvedExpObjects[t].reject(new Error("Object has been removed")),delete this._unresolvedExpObjects[t])},_getExpDataObjectAsync:function(t){var r=t.toString();return r in this._expDataObjects?e.Promise.resolve(this._expDataObjects[r]):r in this._unresolvedExpObjects?this._unresolvedExpObjects[r].promise:(this._unresolvedExpObjects[r]=e.Promise.deferred(),this._unresolvedExpObjects[r].promise)},_getExpDataObject:function(e){var t=e.toString();if(t in this._expDataObjects)return this._expDataObjects[t]},_getExpDataObjects:function(){var e=[];for(var t in this._expDataObjects)this._expDataObjects.hasOwnProperty(t)&&e.push(this._expDataObjects[t]);return e}})}),define("DS/CAT3DExpModel/XCTExp3DSpaceVOAsset",["UWA/Core","UWA/Class"],function(e){"use strict";return e.Class.extend({init:function(e){this._pathOfPhysicalId=e},getPathOfPhysicalId:function(){return this._pathOfPhysicalId}})}),define("DS/CAT3DExpModel/interfaces/CATI3DXVolatileEO",["UWA/Class","DS/WebComponentModeler/CATWebInterface"],function(e,t){"use strict";return t.singleton({interfaceName:"CATI3DXVolatileEO",required:{setVolatile:function(){},restorePersistent:function(){}},optional:{}})}),define("DS/CAT3DExpModel/interfaces/XCTEWSIExperienceMgr",["UWA/Class","DS/WebComponentModeler/CATWebInterface"],function(e,t){"use strict";return t.singleton({interfaceName:"XCTEWSIExperienceMgr",required:{onExperienceReady:function(){},onPreDisposeExperience:function(){}},optional:{}})}),define("DS/CAT3DExpModel/managers/CAT3DXNotificationsManager",["UWA/Core","UWA/Class"],function(e,t){"use strict";return t.extend({GetType:function(){return"CAT3DXNotificationsManager"},_logNotif:function(e){var t=e.title&&e.title.toString?e.title.toString().toUpperCase():null,r=e.subtitle&&e.subtitle.toString?e.subtitle.toString():null,n=e.message&&e.message.toString?e.message.toString():null;"info"===e.level||"success"===e.level?(t&&console.log(t),r&&console.log(r),n&&console.log(n)):"warning"===e.level?(t&&console.warn(t),r&&console.warn(r),n&&console.warn(n)):"error"===e.level&&(t&&console.error(t),r&&console.error(r),n&&console.error(n))},addNotification:function(e){e.level=e.level?e.level:"info",this._logNotif(e)},addPromisedNotification:function(t){t.level=t.level?t.level:"info",this._logNotif(t);var r=e.Promise.deferred(),n=this;return r.promise.then(function(e){e.level=e.level?e.level:"success",n._logNotif(e)}).catch(function(e){e.level=e.level?e.level:"error",n._logNotif(e)}),r},removeNotification:function(){}})}),define("DS/CAT3DExpModel/interfaces/CATI3DGeoVisu",["UWA/Class","DS/WebComponentModeler/CATWebInterface"],function(e,t){"use strict";return t.singleton({interfaceName:"CATI3DGeoVisu",required:{GetNode:function(){},GetPathElement:function(){},GetOverride:function(){},GetLocalNodes:function(){},Refresh:function(){},RequestVisuRefresh:function(){},isReady:function(){return!1},setReady:function(){},GetBoundingBox:function(){},GetBoundingSphere:function(){}},optional:{}})}),define("DS/CAT3DExpModel/managers/XCTEWSAssetLoadManager",["UWA/Core","UWA/Class/Events"],function(e,t){"use strict";return e.Class.extend(t,{Build:function(){this._assetLoadingProgress={},this._updatedCategories=[]},Dispose:function(){delete this._assetLoadingProgress,this._updatedCategories=[]},_update:function(){for(var e=0;e<this._updatedCategories.length;e++)this.dispatchEvent("ASSET_LOADING_PROGRESS_"+this._updatedCategories[e],[this.getAssetLoadingProgressByCategory(this._updatedCategories[e])]);this._updatedCategories.length>0&&this.dispatchEvent("ASSET_LOADING_PROGRESS",[this.getAssetLoadingProgress()]),this._updatedCategories=[]},_startLoading:function(e){var t=e.QueryInterface("XCTEWSIAssetLoadCategory")?e.QueryInterface("XCTEWSIAssetLoadCategory").getCategory():"default";this._assetLoadingProgress[t]?this._assetLoadingProgress[t].loading++:this._assetLoadingProgress[t]={loading:1,loaded:0,failed:0},this._updatedCategories.indexOf(t)<0&&this._updatedCategories.push(t)},_endLoading:function(e){var t=e.QueryInterface("XCTEWSIAssetLoadCategory")?e.QueryInterface("XCTEWSIAssetLoadCategory").getCategory():"default";this._assetLoadingProgress[t].loading--,this._assetLoadingProgress[t].loaded++,this._updatedCategories.indexOf(t)<0&&this._updatedCategories.push(t)},_failLoading:function(e){var t=e.QueryInterface("XCTEWSIAssetLoadCategory")?e.QueryInterface("XCTEWSIAssetLoadCategory").getCategory():"default";this._assetLoadingProgress[t].loading--,this._assetLoadingProgress[t].failed++,this._updatedCategories.indexOf(t)<0&&this._updatedCategories.push(t)},getAssetLoadingProgressByCategory:function(e){return{loading:this._assetLoadingProgress[e]?this._assetLoadingProgress[e].loading:0,loaded:this._assetLoadingProgress[e]?this._assetLoadingProgress[e].loaded:0,failed:this._assetLoadingProgress[e]?this._assetLoadingProgress[e].failed:0}},getAssetLoadingProgress:function(){var e={};for(var t in this._assetLoadingProgress)this._assetLoadingProgress.hasOwnProperty(t)&&(e[t]=this.getAssetLoadingProgressByCategory(t));return e},GetType:function(){return"XCTEWSAssetLoadManager"}})}),define("DS/CAT3DExpModel/interfaces/CATIMovable",["UWA/Class","DS/WebComponentModeler/CATWebInterface"],function(e,t){"use strict";return t.singleton({interfaceName:"CATIMovable",required:{GetLocalPosition:function(){},SetLocalPosition:function(){},GetAbsPosition:function(){},SetAbsPosition:function(){}},optional:{}})}),define("DS/CAT3DExpModel/XCTExpVariable",[],function(){"use strict";var e={_value:null,_isComputed:null,_description:null,_SetDescription:function(e,t,r,n,i,a){this._description={_name:e,_type:t,_maxNumberOfValues:r,_valuationMode:n,_restrictedTypes:i,_ID:a||"ID"+e}},_GetType:function(){return this._description._type},_GetValuationMode:function(){return this._description._valuationMode},_GetRestrictedTypes:function(){return this._description._restrictedTypes},_GetMaxNumberOfValues:function(){return this._description._maxNumberOfValues},_GetName:function(){return this._description._name},_GetID:function(){return this._description._ID},_SetValue:function(e,t){this._value=e,this._isComputed=!!t},_GetValue:function(){return this._value},_IsComputed:function(){return this._isComputed},VarType:{Integer:0,Double:1,String:2,Object:3,Boolean:4,Color:5,All:6},ValuationMode:{AggregatingValue:0,ReferencingValue:1,PointingVariable:2,Undef:3}};return e}),define("DS/CAT3DExpModel/managers/CAT3DXPreviewManager",["UWA/Core","UWA/Class/Listener","DS/Visualization/Viewpoint","DS/Visualization/ThreeJS_DS"],function(e,t,r,n){"use strict";return e.Class.extend({Dispose:function(){this._previewViewpoint&&(this._previewViewpoint.viewer.removeViewpoint(this._previewViewpoint),delete this._previewViewpoint)},getPreview:function(t,r,i){var a=this;return this._isVisuReady(t).done(function(){var o=a._experienceBase.getManager("CAT3DXVisuManager"),s=o.getViewer(),c=o.getContent();o.setContent(t);var l,u,p=r/i;s.SCREEN_WIDTH/s.SCREEN_HEIGHT<p?(l=s.SCREEN_WIDTH,u=Math.floor(s.SCREEN_WIDTH/p)):(l=Math.floor(s.SCREEN_HEIGHT*p),u=s.SCREEN_HEIGHT);var d=a._getPreviewViewpoint(),f=d.getBoundingSphere("visibleSpace"),h=l/s.SCREEN_WIDTH,_=u/s.SCREEN_HEIGHT,C=d.camera.sensorSizeWidth*h,x=d.camera.sensorSizeHeight*_,b=Math.atan(.5*C/d.camera.focalLength),v=Math.atan(.5*x/d.camera.focalLength),m=f.radius/Math.tan(b),D=f.radius/Math.tan(v),E=Math.max(m,D),g=f.center.clone(),A=d.control.orientation.clone(),y=new n.Vector3(0,0,-1);y.applyQuaternion(A),y.normalize(),d.moveTo({orientation:A,eyePosition:(new n.Vector3).addVectors(g,y.clone().multiplyScalar(-E)),distanceToTarget:E,duration:0}),d.camera.far=1.1*(E+f.radius);var S={data:null,width:s.SCREEN_WIDTH,height:s.SCREEN_HEIGHT};s.renderToTarget(S,d);var V=e.createElement("canvas");V.width=l,V.height=u;for(var O=V.getContext("2d"),T=O.getImageData(0,0,l,u),j=Math.floor((S.width-l)/2),M=Math.floor((S.height-u)/2),I=0;I<l;I++)for(var L=0;L<u;L++){var P=4*(L*l+I),k=4*((S.height-1-M-L)*S.width+j+I);T.data[P]=S.data[k],T.data[P+1]=S.data[k+1],T.data[P+2]=S.data[k+2],T.data[P+3]=S.data[k+3]}O.putImageData(T,0,0,0,0,l,u);var G=V.toDataURL("image/jpeg",1);return o.removeContent(),c&&o.setContent(c),G})},_isVisuReady:function(r){if(r.isReady())return e.Promise.resolve();var n=e.Promise.deferred(),i=new t;return i.listenTo(r,"readyChanged",function(e){if(e)return i.stopListening(r,"readyChanged"),n.promise()}),n.promise()},_getPreviewViewpoint:function(){if(!this._previewViewpoint){var e=this._experienceBase.getManager("CAT3DXVisuManager").getViewer();this._previewViewpoint=new r({viewer:e}),e.addViewpoint(this._previewViewpoint)}return this._previewViewpoint},GetType:function(){return"CAT3DXPreviewManager"}})}),define("DS/CAT3DExpModel/managers/CAT3DXLinkManager",["UWA/Core","UWA/Class","DS/CAT3DExpLinkContext/CAT3DExpLinkContextFactory"],function(e,t,r){"use strict";return e.Class.extend({Build:function(){this._lcFactory=new r},registerLinkContextForDatatransfer:function(e,t){this._lcFactory.registerLinkContextForDatatransfer(e,t)},registerLinkContextForJSONDescription:function(e,t){this._lcFactory.registerLinkContextForJSONDescription(e,t)},getLinkContextFromDataTransfer:function(e){return this._lcFactory.getLinkContextFromDataTransfer(e)},getLinkContextFromJSONDescription:function(e){return this._lcFactory.getLinkContextFromJSONDescription(e)},GetType:function(){return"CAT3DXLinkManager"}})}),define("DS/CAT3DExpModel/extensions/CATEAlias",["UWA/Core","UWA/Class/Events","UWA/Class/Listener"],function(e,t,r){"use strict";return e.Class.extend(t,r,{Build:function(){var e=this;this.listenTo(this.QueryInterface("CATI3DExperienceObject"),"_varName.CHANGED",function(t){e.dispatchEvent("NAME_CHANGED",[t])})},Dispose:function(){this._parent(),this.stopListening()},SetAlias:function(e){this.QueryInterface("CATI3DExperienceObject").SetValueByName("_varName",e)},GetAlias:function(){return this.QueryInterface("CATI3DExperienceObject").GetValueByName("_varName")}})}),define("DS/CAT3DExpModel/interfaces/CATI3DExpState",["UWA/Class","DS/WebComponentModeler/CATWebInterface"],function(e,t){"use strict";return t.singleton({interfaceName:"CATI3DExpState",required:{ApplyStatedValues:function(){}},optional:{}})}),define("DS/CAT3DExpModel/interfaces/XCTEWSIAssetLoadCategory",["UWA/Class","DS/WebComponentModeler/CATWebInterface"],function(e,t){"use strict";return t.singleton({interfaceName:"XCTEWSIAssetLoadCategory",required:{getCategory:function(){}},optional:{}})}),define("DS/CAT3DExpModel/XCTExpAsset",["UWA/Core","UWA/Class"],function(e){"use strict";var t=e.Class.extend({init:function(r,n,i,a){Object.defineProperty(this,"linkDescription",{writable:!1,value:r}),Object.defineProperty(this,"cache",{writable:!1,value:n}),Object.defineProperty(this,"status",{writable:!1,value:e.is(i)?i:t.AssetStatus.NotComputed}),Object.defineProperty(this,"linkContext",{writable:!1,value:a})}});return t.AssetStatus={StatusBroken:0,StatusBrokenSlave:1,StatusOK:2,StatusFilter:3,NotComputed:4,StatusBrokenUsed:5},t}),define("DS/CAT3DExpModel/loaders/CAT3DXLoader",["UWA/Core","UWA/Class/Promise"],function(e,t){"use strict";return e.Class.extend({init:function(e){this._experienceBase=e},loadLink:function(e,r){return t.reject(new Error("not yet implemented"+e+r))}})}),define("DS/CAT3DExpModel/interfaces/CATI3DXGraphicalProperties",["UWA/Class","DS/WebComponentModeler/CATWebInterface"],function(e,t){"use strict";return t.singleton({interfaceName:"CATI3DXGraphicalProperties",required:{GetPickMode:function(){},SetPickMode:function(){},GetShowMode:function(){},SetShowMode:function(){},GetOpacity:function(){},SetOpacity:function(){},GetRed:function(){},GetGreen:function(){},GetBlue:function(){},SetColor:function(){}},optional:{}})}),define("DS/CAT3DExpModel/managers/CAT3DXDragAndDropManager",["UWA/Core","UWA/Class","DS/DataDragAndDrop/DataDragAndDrop"],function(e,t,r){"use strict";return t.extend({Build:function(){this._dropZones=[]},register:function(e,t,n){if(this.isRegistered(e))console.error("DropZone can only be set droppable once");else{this._dropZones.push(e);var i=this,a={enter:function(e,r){t.enter&&t.enter.call(n,e,r)},leave:function(e,r){t.leave&&t.leave.call(n,e,r)},over:function(e,r){t.over&&t.over.call(n,e,r)},drop:function(e,r,a){if(t.expectedTypes){var o=i._experienceBase.getManager("CAT3DXLinkManager").getLinkContextFromDataTransfer(a.dataTransfer);i._experienceBase.getManager("CAT3DXLoaderManager").loadLink(o,t.expectedTypes).then(function(i){t.drop&&t.drop.call(n,i,e,r,a)}).catch(function(i){t.fail?t.fail.call(n,i,e,r,a):console.error(i)})}}};r.droppable(e,a)}},unRegister:function(e){r.clean(e);var t=this._dropZones.indexOf(e);this._dropZones.splice(t,1)},isRegistered:function(e){return-1!==this._dropZones.indexOf(e)},GetType:function(){return"CAT3DXDragAndDropManager"}})}),define("DS/CAT3DExpModel/managers/W3AAXCTEWSAssetLoadManager",["UWA/Core","DS/WebApplicationBase/W3AAManager"],function(e,t){"use strict";return t.extend({update:function(){this.GetObject()._update()}})}),define("DS/CAT3DExpModel/managers/W3AACAT3DXVisuManager",["UWA/Core","DS/WebApplicationBase/W3AAManager"],function(e,t){"use strict";return e.Class.extend(t,{getUpdatePriority:function(){return 1},update:function(){this.GetObject()._update()}})}),define("DS/CAT3DExpModel/managers/CAT3DXEnvironmentManager",["UWA/Core","UWA/Class","UWA/Class/Listener","DS/WebappsUtils/WebappsUtils","DS/Visualization/ModelLoader","DS/Visualization/Node3D"],function(e,t,r,n,i,a){"use strict";return t.extend(r,{Build:function(){this._viewer=this._experienceBase.webApplication.frmWindow.getViewer(),this._transparentBackground=!1,this._currentEnvironment=void 0,this._environmentToLoad=void 0,this._environmentLoading=void 0,this._environmentsToRefresh=[]},Dispose:function(){this.removeExperience(),delete this._viewer,this._transparentBackground=!1},setTransparentBackground:function(e){e?(this._viewer.ambience.getBackground().setActivated(!1),this._viewer.setBackgroundColor("rgb(0,0,0)","0")):this._viewer.ambience.getBackground().setActivated(!0),this._transparentBackground=e},isTransparentBackground:function(){return this._transparentBackground},_update:function(){void 0!==this._environmentToLoad&&(this._switchEnvironment(this._environmentToLoad,this._environmentLoading),this._environmentToLoad=void 0);for(var e=0;e<this._environmentsToRefresh.length;e++)this._environmentsToRefresh[e].Refresh();this._environmentsToRefresh.length>0&&this._renderViewerInDynamicMode(),this._environmentsToRefresh=[]},setExperience:function(e){if(this._experience)console.warn("CAT3DXEnvironmentManager : An experience is already defined");else{this._experience=e;var t=this;this.listenTo(e.QueryInterface("CATI3DExperienceObject"),"currentEnvironment.CHANGED",function(e){t._environmentToLoad=e||null});var r=e.QueryInterface("CATI3DExperienceObject").GetValueByName("currentEnvironment");this._environmentToLoad=r||null}},removeExperience:function(){delete this._experience,delete this._default3DExciteAmbience,delete this._default3DExciteAmbiencePromise,this.stopListening(),this._currentEnvironment=void 0,this._environmentToLoad=void 0,this._environmentLoading=void 0,this._environmentsToRefresh=[]},_getViewer:function(){return this._viewer},_renderViewerInDynamicMode:function(){this._viewer.render({forceDynamicMode:!0})},_switchEnvironment:function(t,r){var n;n=r||e.Promise.resolve();var i=this;this._environmentLoading=n.then(function(){return i._currentEnvironment===t?e.Promise.resolve():(i._currentEnvironment&&i._currentEnvironment.QueryInterface("CATICXPEnvironmentActivate").Deactivate(),t?t.QueryInterface("CATICXPEnvironmentActivate").Activate():i._setDefault3DExciteAmbience())}).then(function(){i._currentEnvironment=t,i._environmentLoading=void 0})},_refreshEnvironment:function(e){this._environmentsToRefresh.push(e)},_setDefault3DExciteAmbience:function(){var e=this;return this._getDefault3DExciteAmbience().done(function(t){e._transparentBackground?t.getBackground().setActivated(!1):t.getBackground().setActivated(!0),e._viewer&&e._viewer.setAmbience(t,!0)})},_getDefault3DExciteAmbience:function(){if(this._default3DExciteAmbience)return e.Promise.resolve(this._default3DExciteAmbience);if(this._default3DExciteAmbiencePromise)return this._default3DExciteAmbiencePromise;var t=new XMLHttpRequest;t.open("GET",n.getWebappsBaseUrl()+"CAT3DExpModel/assets/3DExcite_Ambiance_Default/3DExcite_Ambiance_Default_1024.3dxc",!0),t.responseType="blob";var r=e.Promise.deferred();t.onload=function(e){r.resolve(e.target.response)},t.send();var o=this;return this._default3DExciteAmbiencePromise=r.promise.done(function(t){var r=e.Promise.deferred(),n=new i,s=URL.createObjectURL(t);return n.setFileType("3dxc"),n.setOnLoadedCallback(function(e){URL.revokeObjectURL(s),delete o._default3DExciteAmbiencePromise,o._default3DExciteAmbience=e.ambiance,r.resolve(o._default3DExciteAmbience)}),n.loadModel(s,new a),r.promise}),this._default3DExciteAmbiencePromise},GetType:function(){return"CAT3DXEnvironmentManager"}})}),define("DS/CAT3DExpModel/interfaces/CATI3DXAssetHolder",["UWA/Class","DS/WebComponentModeler/CATWebInterface","DS/CAT3DExpModel/XCTExpAsset"],function(e,t,r){"use strict";var n=t.singleton({interfaceName:"CATI3DXAssetHolder",required:{_getLinkDescription:function(){},_getCache:function(){},_getAssetStatus:function(){},_resolveAsset:function(){}},optional:{}});return n.AssetStatus=r.AssetStatus,n}),define("DS/CAT3DExpModel/CAT3DXModel",["UWA/Core","UWA/Promise","DS/CAT3DExpModel/XCTExpDataObjectMap","DS/CAT3DExpModel/expCoreLink/ExpCoreLinkManager","DS/CAT3DExpModel/XCTExpVariable"],function(e,t,r,n,i){"use strict";return e.Class.singleton({_ewsInitialized:!1,_initialize:function(t,i){return this._ewsInitialized?e.Promise.reject("EWS already initialized"):(this._factory=t,this._objectBuilder=i,this._expDataObjectMap=new r,this._expCoreLinkManager=new n,i._initialize(t,this._expDataObjectMap,this._expCoreLinkManager),t._initialize(i,this._expDataObjectMap,this._expCoreLinkManager),this._ewsInitialized=!0,e.Promise.resolve())},_dispose:function(){var e=this;return this._disposeExperience().then(function(){return e._ewsInitialized=!1,e._factory._dispose()}).then(function(){delete e._factory,e._objectBuilder._dispose(),delete e._objectBuilder,e._expDataObjectMap._dispose(),delete e._expDataObjectMap,e._expCoreLinkManager._dispose(),delete e._expCoreLinkManager})},_disposeExperience:function(){return this.GetExperience()?this.CloseExperience():e.Promise.resolve()},getObjectBuilder:function(){return this._objectBuilder},getFactory:function(){return this._factory},_getDataFromExpObject:function(e){return this._objectBuilder._getDataFromExpObject(e)},_getExpObjectFromData:function(e){return this._objectBuilder._getExpObjectFromData(e)},_getExpCoreLinkManager:function(){return this._expCoreLinkManager},GetExpObject:function(e){var t=this._expDataObjectMap._getExpDataObject(e);return this._getExpObjectFromData(t)},GetExpObjects:function(){var e=this._expDataObjectMap._getExpDataObjects(),t=this;return e.map(function(e){return t._getExpObjectFromData(e)})},CreateExperience:function(t,r,n){if(this.GetExperience())return e.Promise.reject(new Error("Fail to create a new experience. An experience is already open, Close the experience first"));var i=this;return this._isEWSInitialized().then(function(){return i._factory.CreateExperience(t,r,n)}).then(function(e){return i._factory._SetExperience(e),i._getExpObjectFromData(e)})},GetExperiencePhysicalID:function(){return this._isEWSInitialized().then(()=>this._factory.GetExperiencePhysicalID())},GetSecurityContext:function(){return this._isEWSInitialized().then(()=>this._factory.GetSecurityContext())},LoadExperience:function(t,r){if(this.GetExperience())return e.Promise.reject(new Error("Fail to create a new experience. An experience is already open, Close the experience first"));var n=this;return this._isEWSInitialized().then(function(){return n._factory.LoadExperience(t,r)}).then(function(e){return n._factory._SetExperience(e),n._getExpObjectFromData(e)})},IsExperienceStarted:function(){var e=this;return this._isEWSInitialized().then(function(){return e._factory.IsExperienceStarted()})},RetrieveExperienceFromServer:function(){var e=this;return this._isEWSInitialized().then(function(){return e._factory.RetrieveExperienceFromServer()}).then(function(t){return e._factory._SetExperience(t),e._getExpObjectFromData(t)})},SaveExperience:function(){var e=this;return this._isEWSInitialized().then(function(){return e._factory.SaveExperience()})},SaveExperienceAsNew:function(e){return this._isEWSInitialized().then(()=>this._factory.SaveExperienceAsNew(e))},CloseExperience:function(){var e=this;return this._isEWSInitialized().then(function(){return e._factory.CloseExperience()}).then(function(){return e._factory._SetExperience(null),t.resolve()})},GetExperience:function(){return this._getExpObjectFromData(this._factory.GetExperience())},CreateVariable:function(e,t,r,n,a,o){var s=this;return this._isEWSInitialized().then(function(){return r===i.VarType.Object&&(o=Array.isArray(o)?o.map(function(e){return s._getDataFromExpObject(e)}):s._getDataFromExpObject(o)),s._factory.CreateVariable(s._getDataFromExpObject(e),t,r,n,a,o)})},SetVariableValues:function(e,t,r){var n=this;return this._isEWSInitialized().then(function(){var a=n._getDataFromExpObject(e);return a.GetVariableType(t)===i.VarType.Object&&(r=Array.isArray(r)?r.map(function(e){return n._getDataFromExpObject(e)}):n._getDataFromExpObject(r)),n._factory.SetVariableValues(a,t,r)})},SetVariablesValues:function(e){var t=this;return this._isEWSInitialized().then(function(){for(var r=[],n=0;n<e.length;n++){var a={};a.object=t._getDataFromExpObject(e[n].object),a.variableName=e[n].variableName,a.object.GetVariableType(a.variableName)===i.VarType.Object?Array.isArray(e[n].variableValues)?a.variableValues=e[n].variableValues.map(function(e){return t._getDataFromExpObject(e)}):a.variableValues=t._getDataFromExpObject(e[n].variableValues):a.variableValues=e[n].variableValues,r.push(a)}return t._factory.SetVariablesValues(r)})},SetVariablesValuesAuthoring:function(e){var t=this;return this._isEWSInitialized().then(function(){for(var r=[],n=0;n<e.length;n++){var a={};a.object=t._getDataFromExpObject(e[n].object),a.variableName=e[n].variableName,a.object.GetVariableType(a.variableName)===i.VarType.Object?Array.isArray(e[n].variableValues)?a.variableValues=e[n].variableValues.map(function(e){return t._getDataFromExpObject(e)}):a.variableValues=t._getDataFromExpObject(e[n].variableValues):a.variableValues=e[n].variableValues,r.push(a)}return t._factory.SetVariablesValuesAuthoring(r)})},BakeVariables:function(e){var t=this;return this._isEWSInitialized().then(function(){for(var r=[],n=0;n<e.length;n++){var i={};i.object=t._getDataFromExpObject(e[n].object),i.variableName=e[n].variableName,r.push(i)}return t._factory.BakeVariables(r)})},SetVariablesDraftMode:function(e,t){var r=this;return this._isEWSInitialized().then(function(){for(var n=[],i=0;i<t.length;i++){var a={};a.object=r._getDataFromExpObject(t[i].object),a.variableName=t[i].variableName,n.push(a)}return r._factory.SetVariablesDraftMode(e,n)})},CreateActor:function(e,t,r){var n=this;return this._isEWSInitialized().then(function(){return n._factory.CreateActor(e,t,n._getDataFromExpObject(r))}).then(function(e){return n._getExpObjectFromData(e)})},CreatePath:function(e,t,r,n,i){var a=this;return this._isEWSInitialized().then(function(){return a._factory.CreatePath(e,a._getDataFromExpObject(t),r,n,i?a._getDataFromExpObject(i):i)}).then(function(e){return a._getExpObjectFromData(e)})},CreateState:function(e,t,r,n){var i=this;return this._isEWSInitialized().then(function(){return i._factory.CreateState(e,t,r,n)})},CreateStateCollection:function(e,t){var r=this;return this._isEWSInitialized().then(function(){return r._factory.CreateStateCollection(e,t)})},DeleteState:function(e,t){var r=this;return this._isEWSInitialized().then(function(){return r._factory.DeleteState(e,t)})},DeleteStateCollection:function(e){var t=this;return this._isEWSInitialized().then(function(){return t._factory.DeleteStateCollection(e)})},UpdateState:function(e,t,r,n){var i=this;return this._isEWSInitialized().then(function(){return i._factory.UpdateState(e,t,r,n)})},UpdateStateCollection:function(e,t,r){var n=this;return this._isEWSInitialized().then(function(){return n._factory.UpdateStateCollection(e,t,r)})},ApplyState:function(e,t){var r=this;return this._isEWSInitialized().then(function(){return r._factory.ApplyState(e,t)})},CreateCityActorExternal:function(e,t,r,n){var i=this;return this._isEWSInitialized().then(function(){return i._factory.CreateCityActorExternal(e,i._getDataFromExpObject(t),r,n)}).then(function(e){return i._getExpObjectFromData(e)})},CreateCityActorInternal:function(e,t,r,n){var i=this;return this._isEWSInitialized().then(function(){return i._factory.CreateCityActorInternal(e,t,i._getDataFromExpObject(r),n)}).then(function(e){return i._getExpObjectFromData(e)})},DeleteActor:function(e){var t=this;return this._isEWSInitialized().then(function(){return t._factory.DeleteActor(t._getDataFromExpObject(e))})},DeleteExperienceObjects:function(e){var t=this;return this._isEWSInitialized().then(function(){return t._factory.DeleteExperienceObjects(e.map(function(e){return t._getDataFromExpObject(e)}))})},InsertProduct:function(e,t,r,n){var i=this;return this._isEWSInitialized().then(function(){return i._factory.InsertProduct(e,i._getDataFromExpObject(t),r,n)}).then(function(e){return i._getExpObjectFromData(e)})},CreateBulkOverrides:function(e,t){var r=this;return this._isEWSInitialized().then(function(){return r._factory.CreateBulkOverrides(e,t)}).then(function(e){return r._getExpObjectFromData(e)})},CreateOverrideProduct:function(e,t,r){var n=this;return this._isEWSInitialized().then(function(){return n._factory.CreateOverrideProduct(e,t,n._getDataFromExpObject(r))}).then(function(e){return n._getExpObjectFromData(e)})},CreateOverridesProduct:function(e,t){var r=this;return this._isEWSInitialized().then(function(){return r._factory.CreateOverridesProduct(e,r._getDataFromExpObject(t))}).then(function(e){return e.map(function(e){return r._getExpObjectFromData(e)})})},CreateAllOverridesProduct:async function(e){var t=this;return this._isEWSInitialized().then(function(){return t._factory.CreateAllOverridesProduct(t._getDataFromExpObject(e))}).then(function(e){return e.map(function(e){return t._getExpObjectFromData(e)})})},DeleteOverride:function(e){var t=this;return this._isEWSInitialized().then(function(){return t._factory.DeleteOverride(t._getDataFromExpObject(e))})},DeleteOverrides:function(e){var t=this;return this._isEWSInitialized().then(function(){return t._factory.DeleteOverrides(e.map(function(e){return t._getDataFromExpObject(e)}))})},DeleteAllOverrides:function(e){var t=this;return this._isEWSInitialized().then(function(){return t._factory.DeleteAllOverrides(t._getDataFromExpObject(e))})},CheckAssetStatus:function(e,t,r){var n=this;return this._isEWSInitialized().then(function(){return n._factory.CheckAssetStatus(n._getDataFromExpObject(e),t,r).then(function(e){if(e.brokenExpObjects)for(var t=0;t<e.brokenExpObjects.length;t++)e.brokenExpObjects[t].expObject=n._getExpObjectFromData(e.brokenExpObjects[t].expObject);return e})})},UpdateProductAsset:function(e,t){var r=this;return this._isEWSInitialized().then(function(){return r._factory.UpdateProductAsset(r._getDataFromExpObject(e),t)})},UpdateOverrideAsset:function(e,t){var r=this;return this._isEWSInitialized().then(function(){return r._factory.UpdateOverrideAsset(r._getDataFromExpObject(e),t)})},CreateBehavior:function(e,t,r){var n=this;return this._isEWSInitialized().then(function(){return n._factory.CreateBehavior(e,t,n._getDataFromExpObject(r))}).then(function(e){return n._getExpObjectFromData(e)})},DeleteBehavior:function(e){var t=this;return this._isEWSInitialized().then(function(){return t._factory.DeleteBehavior(t._getDataFromExpObject(e))})},CreateScenario:function(e){var t=this;return this._isEWSInitialized().then(function(){return t._factory.CreateScenario(e)}).then(function(e){return t._getExpObjectFromData(e)})},CreateAct:function(e,t){var r=this;return this._isEWSInitialized().then(function(){return r._factory.CreateAct(e,r._getDataFromExpObject(t))}).then(function(e){return r._getExpObjectFromData(e)})},CreateParagraph:function(e,t){var r=this;return this._isEWSInitialized().then(function(){return r._factory.CreateParagraph(e,r._getDataFromExpObject(t))}).then(function(e){return r._getExpObjectFromData(e)})},CreateSentence:function(e,t){var r=this;return this._isEWSInitialized().then(function(){return r._factory.CreateSentence(e,r._getDataFromExpObject(t))}).then(function(e){return r._getExpObjectFromData(e)})},CreateBlock:function(e,t,r){var n=this;return this._isEWSInitialized().then(function(){return n._factory.CreateBlock(e,n._getDataFromExpObject(t),r)}).then(function(e){return n._getExpObjectFromData(e)})},CreateBinaryResource:function(e,t,r){var n=this;return this._isEWSInitialized().then(function(){return n._factory.CreateBinaryResource(e,t,r)}).then(function(e){return n._getExpObjectFromData(e)})},UpdateBinaryResource:function(e,t,r){var n=this;return this._isEWSInitialized().then(function(){return n._factory.UpdateBinaryResource(n._getDataFromExpObject(e),t,r)})},CreateURLResource:function(e,t){var r=this;return this._isEWSInitialized().then(function(){return r._factory.CreateURLResource(e,t)}).then(function(e){return r._getExpObjectFromData(e)})},UpdateURLResource:function(e,t){var r=this;return this._isEWSInitialized().then(function(){return r._factory.UpdateURLResource(r._getDataFromExpObject(e),t)})},DeleteResource:function(e){var t=this;return this._isEWSInitialized().then(function(){return t._factory.DeleteResource(t._getDataFromExpObject(e))})},InsertAmbience:function(e,t,r){var n=this;return this._isEWSInitialized().then(function(){return n._factory.InsertAmbience(e,t,r)}).then(function(e){return n._getExpObjectFromData(e)})},DeleteAmbience:function(e){var t=this;return this._isEWSInitialized().then(function(){return t._factory.DeleteAmbience(t._getDataFromExpObject(e))})},InsertMaterial:function(e,t,r){var n=this;return this._isEWSInitialized().then(function(){return n._factory.InsertMaterial(e,t,r)}).then(function(e){return n._getExpObjectFromData(e)})},DeleteMaterial:function(e){var t=this;return this._isEWSInitialized().then(function(){return t._factory.DeleteMaterial(t._getDataFromExpObject(e))})},ApplyMaterial:function(e,t){var r=this;return this._isEWSInitialized().then(function(){return r._factory.ApplyMaterial(r._getDataFromExpObject(e),r._getDataFromExpObject(t))}).then(function(e){return r._getExpObjectFromData(e)})},CreateUIButton:function(e){var t=this;return this._isEWSInitialized().then(function(){return t._factory.CreateUIButton(e)}).then(function(e){return t._getExpObjectFromData(e)})},CreateUIText:function(e){var t=this;return this._isEWSInitialized().then(function(){return t._factory.CreateUIText(e)}).then(function(e){return t._getExpObjectFromData(e)})},CreateUIImage:function(e){var t=this;return this._isEWSInitialized().then(function(){return t._factory.CreateUIImage(e)}).then(function(e){return t._getExpObjectFromData(e)})},CreateUITextField:function(e){var t=this;return this._isEWSInitialized().then(function(){return t._factory.CreateUITextField(e)}).then(function(e){return t._getExpObjectFromData(e)})},CreateUIColorPicker:function(e){var t=this;return this._isEWSInitialized().then(function(){return t._factory.CreateUIColorPicker(e)}).then(function(e){return t._getExpObjectFromData(e)})},CreateUISlider:function(e){var t=this;return this._isEWSInitialized().then(function(){return t._factory.CreateUISlider(e)}).then(function(e){return t._getExpObjectFromData(e)})},CreateUICameraViewer:function(e){var t=this;return this._isEWSInitialized().then(function(){return t._factory.CreateUICameraViewer(e)}).then(function(e){return t._getExpObjectFromData(e)})},CreateUIWebViewer:function(e){var t=this;return this._isEWSInitialized().then(function(){return t._factory.CreateUIWebViewer(e)}).then(function(e){return t._getExpObjectFromData(e)})},CreateUIGalleryMenu:function(e){var t=this;return this._isEWSInitialized().then(function(){return t._factory.CreateUIGalleryMenu(e)}).then(function(e){return t._getExpObjectFromData(e)})},CreateUIGalleryImage:function(e){var t=this;return this._isEWSInitialized().then(function(){return t._factory.CreateUIGalleryImage(e)}).then(function(e){return t._getExpObjectFromData(e)})},CreateUIGalleryProduct:function(e){var t=this;return this._isEWSInitialized().then(function(){return t._factory.CreateUIGalleryProduct(e)}).then(function(e){return t._getExpObjectFromData(e)})},CreateUIGalleryViewpoint:function(e){var t=this;return this._isEWSInitialized().then(function(){return t._factory.CreateUIGalleryViewpoint(e)}).then(function(e){return t._getExpObjectFromData(e)})},CreateGalleryItem:function(e,t){var r=this;return this._isEWSInitialized().then(function(){return r._factory.CreateGalleryItem(e,r._getDataFromExpObject(t))}).then(function(e){return r._getExpObjectFromData(e)})},_isEWSInitialized:function(){return this._ewsInitialized?e.Promise.resolve():t.reject(new Error("EWS is not initialized"))},CreateObject:function(e,r,n,i){var a=this;return this._factory&&this._factory.CreateObject?this._factory.CreateObject(e,r,a._getDataFromExpObject(n),i).then(function(e){return a._getExpObjectFromData(e)}):t.reject(new Error("Factory.CreateObject fail"))}})}),define("DS/CAT3DExpModel/extensions/CATE3DXAssetHolder",["UWA/Core","UWA/Class","UWA/Class/Listener","UWA/Class/Events","DS/CAT3DExpModel/CAT3DXModel"],function(e,t,r,n,i){"use strict";return e.Class.extend(r,n,{Dispose:function(){delete this._asset,delete this._assetPromise},_clearAsset:function(){delete this._asset,delete this._assetPromise},Build:function(){this.listenTo(this.QueryInterface("CATI3DExperienceObject"),"ASSET_CHANGED",()=>{this._clearAsset(),this.dispatchEvent("ASSET_CHANGED")})},getLinkContext:function(){console.log("DEPRECATED");var e=this.QueryInterface("CATI3DExperienceObject")._GetAsset();if(e)return e.linkContext},getLinkDescription:function(){return console.log("DEPRECATED"),this._getLinkDescription()},_getLinkDescription:function(){var e=this.QueryInterface("CATI3DExperienceObject")._GetAsset();if(e)return e.linkDescription},getCache:function(){return console.log("DEPRECATED"),this._getCache()},_getCache:function(){var e=this.QueryInterface("CATI3DExperienceObject")._GetAsset();if(e)return e.cache},_getAssetStatus:function(){var e=this.QueryInterface("CATI3DExperienceObject")._GetAsset();if(e)return e.status},resolveAsset:function(){return console.log("DEPRECATED"),this._resolveAsset()},_resolveAsset:function(){var t=this.GetObject()._experienceBase.getManager("XCTEWSAssetLoadManager");if(!t)return"true"===localStorage.getItem("EWS_AuthoringV2")?this._resolveAssetAuthoringV2():this._resolveAssetV1();t._startLoading(this);var r=this;let n;return(n="true"===localStorage.getItem("EWS_AuthoringV2")?this._resolveAssetAuthoringV2():this._resolveAssetV1()).then(function(e){return t._endLoading(r),e}).catch(function(n){return t._failLoading(r),e.Promise.reject(n)})},_resolveAssetV1:function(){return e.Promise.reject(new Error("CATI3DXAssetHolder._resolveAsset: Must be implemented by derived class."))},_resolveAssetAuthoringV2:function(){if(this._asset)return e.Promise.resolve(this._asset);if(this._assetPromise)return this._assetPromise;var t=this.GetObject()._experienceBase.getManager("XCTEWSAssetLoadManager");t&&t._startLoading(this);var r=i._getExpCoreLinkManager(),n=this;return this._assetPromise=r.resolveLink(this._getLinkDescription()).then(e=>(t&&t._endLoading(n),this._asset=e,delete this._assetPromise,e)).catch(r=>(t&&t._failLoading(n),e.Promise.reject(r))),this._assetPromise}})}),define("DS/CAT3DExpModel/managers/CAT3DXVisuManager",["UWA/Core","UWA/Class","UWA/Element","UWA/Class/Listener","DS/Visualization/ThreeJS_DS","DS/MathematicsES/MathsDef","DS/SceneGraphOverrides/SceneGraphOverrideSet","DS/Visualization/ModelLoader","DS/CAT3DExpModel/CAT3DXModel"],function(e,t,r,n,i,a,o,s,c){"use strict";return e.Class.extend(n,{Build:function(){this._objectsToRefresh=[],this._requireRefresh=!1,this._visuRefreshCB=[],this._root=null,this._content=null,this._overrideSet=null,this._viewer=this._experienceBase.webApplication.frmWindow.getViewer(),this._viewer.delayBeforeIteration=150,this._viewer.setVisuShadingMode("ShadingMaterial"),this._viewer.setLinesFilter(!1),this._viewer.setPointsFilter(!1),this._viewer.setAxisFilter(!1),this._viewer.setReferenceAxisSystem(!1),this._viewer.picking.displayHL=!1,this._viewer.setPrePicking({activated:!0,displayHL:!0}),this._viewer.pPicking.activated=!1,this._viewer.pPicking.displayHL=!1,this._viewer.setManipulators({activated:!1,preActivate:!1}),this._viewer.useDefaultLights&&(this._viewer.useDefaultLights=!1,this._viewer.setTriLights(!1),this._viewer.directionalLight.intensity=0,this._viewer.directionalLight2.intensity=0,this._viewer.directionalLight.castShadow=!1,this._viewer.directionalLight2.castShadow=!1,this._viewer.setAmbientLight(0)),this.pushVisuRefreshCB(this._renderViewerInDynamicMode.bind(this))},Dispose:function(){this.removeContent(),this._objectsToRefresh=[],this.stopListening(),this._modelLoader&&(this._modelLoader.clearRessourceLibrary(),delete this._modelLoader),delete this._accelerationStructure},_update:function(){for(var e=0;e<this._objectsToRefresh.length;e++){let t=this._objectsToRefresh[e].Refresh();this._requireRefresh=this._requireRefresh||t}if(this._requireRefresh)for(var t=0;t<this._visuRefreshCB.length;t++)this._visuRefreshCB[t]();this._objectsToRefresh=[],this._requireRefresh=!1},getViewer:function(){return this._viewer},_renderViewerInDynamicMode:function(){this._viewer.render({forceDynamicMode:!0})},setRoot:function(e){this._root=e,this._viewer.getSceneGraphOverrideSetManager().clear(),this._root&&(this._overrideSet=new o(e.GetNode()))},getRoot:function(){return this._root},getOverrideSet:function(){return this._overrideSet},setContent:function(e){if(e!==this._content&&this._root){this.removeContent(),this._content=e,this._viewer.addNode(this._content.GetNode()),this._listenContentReady(e);var t=this._content.GetPathElement();t.getElement(0)!==this._root.GetNode()&&console.warn("Content path should start with root node"),this._viewer.getSceneGraphOverrideSetManager().pushSceneGraphOverrideSet(this.getOverrideSet(),{substractivePath:t.getLength()>1?t:void 0})}},getContent:function(){return this._content},removeContent:function(){this._content&&(this._viewer.getSceneGraphOverrideSetManager().clear(),this.stopListening(this._content),this._viewer.removeNode(this._content.GetNode()),this._content=null)},setViewpointControl:function(e){this._viewer.currentViewpoint.setDefaultController(!1),this._viewer.currentViewpoint.control=e,this._viewer.currentViewpoint.resetCameraOrientation(),this._viewer.currentViewpoint.onMove(this._renderViewerInDynamicMode.bind(this))},getViewpointControl:function(){return this._viewer.currentViewpoint.control},forceViewerRefresh:function(){this._requireRefresh=!0},refreshGeoVisu:function(e){this._objectsToRefresh.indexOf(e)>0||this._objectsToRefresh.push(e)},_listenContentReady:function(e){this.listenTo(e,"readyChanged",function(e){e&&this.forceViewerRefresh()})},pushVisuRefreshCB:function(e){this._visuRefreshCB.push(e)},removeVisuRefreshCB:function(e){var t=this._visuRefreshCB.indexOf(e);t>=0&&this._visuRefreshCB.splice(t,1)},getModelLoader:function(){if(this._modelLoader)return e.Promise.resolve(this._modelLoader);if(this._modelLoaderPromise)return this._modelLoaderPromise;var t=this,r=new s;"true"===localStorage.getItem("CXPWeb_enableNoMeshInRam")&&r.setNoMeshInRAM(!0),!0===this._accelerationStructure&&r.setAccelerationStructure(!0),r.setRenderCallback(this._renderViewerInDynamicMode.bind(this));var n=c._getExpCoreLinkManager();return this._modelLoaderPromise=n.resolveLink("ExpCore://localMedia/Streams/materials.3dxc").catch(function(){return n.resolveLink("ExpCore://localMedia/Streams/materials.3dx")}).then(function(t){var n=e.Promise.deferred(),i=URL.createObjectURL(t);return t.name.endsWith("3dxc")?r.setFileType("3dxc"):r.setFileType("3dx"),r.addRessourceLibrary(i,function(){URL.revokeObjectURL(i),n.resolve()}),n.promise}).then(function(){return t._modelLoader=r,delete t._modelLoaderPromise,e.Promise.resolve(r)}).catch(function(){return t._modelLoader=r,delete t._modelLoaderPromise,e.Promise.resolve(r)}),this._modelLoaderPromise},activateAccelerationStructure:async function(){this._accelerationStructure=!0},waitContentReady:function(){if(this._content.isReady())return e.Promise.resolve();let t=e.Promise.deferred();return this.listenTo(this._content,"readyChanged",e=>{e&&(this.stopListening(this._content,"readyChanged"),t.resolve())}),t.promise},GetType:function(){return"CAT3DXVisuManager"}})}),define("DS/CAT3DExpModel/extensions/CATE3DExperienceObject",["UWA/Core","DS/CAT3DExpModel/CAT3DXModel","UWA/Class/Events","DS/CAT3DExpModel/XCTExpVariable","UWA/Class/Listener"],function(e,t,r,n,i){"use strict";return e.Class.extend(r,i,{init:function(){this._onlyVolatile=!1},Build:function(){this._volatileValues={}},Dispose:function(){this._volatileValues={},delete this._expDataObject,this.stopListening()},GetPathOfIds:function(){return this._expDataObject.GetPathOfIds()},_GetVariablePathOfIds:function(e){return this._expDataObject._GetVariablePathOfIds(e)},ListVariables:function(e,t){return this._expDataObject.ListVariables(e,t)},ListLocalVariables:function(e,t){return this._expDataObject.ListLocalVariables(e,t)},HasVariable:function(e){return this._expDataObject.HasVariable(e)},AddVariable:function(e,r,n,i,a){return t.CreateVariable(this.GetObject(),e,r,n,i,a)},GetValueByName:function(e){var t;if(this._volatileValues.hasOwnProperty(e))t=this._volatileValues[e];else if((t=this._expDataObject.GetValueByName(e))&&this._expDataObject.GetVariableType(e)===n.VarType.Object)return Array.isArray(t)?t.map(function(e){return e._GetObjectModelerComponent()}):t._GetObjectModelerComponent();return"true"===localStorage.getItem("EWS_FilterUnnecessarySetValue")&&Array.isArray(t)&&(t=t.slice()),t},SetValueByName:function(r,n){if("true"===localStorage.getItem("EWS_FilterUnnecessarySetValue")){if(!this._isSetValueNecessary(r,n))return e.Promise.resolve();Array.isArray(n)&&(n=n.slice())}this._volatileValues[r]=n,this._dispatchVariableEvent(r,n);var i=this;return this._onlyVolatile?e.Promise.resolve():t.SetVariableValues(this.GetObject(),r,n).then(function(){n===i._volatileValues[r]&&delete i._volatileValues[r]}).catch(function(t){return i.RestorePersistentValueByName(r),e.Promise.reject(t)})},_isSetValueNecessary:function(e,t){if(!this.IsLocalVariable(e))return!0;var r=this.GetValueByName(e);return!this._compareValues(t,r)},_compareValues:function(e,t){var r=localStorage.getItem("EWS_FilterUnnecessarySetValueDecimalPrecision")?localStorage.getItem("EWS_FilterUnnecessarySetValueDecimalPrecision"):6,n=Math.pow(10,r);if(Array.isArray(e)){if(!Array.isArray(t))return!1;if(e.length!==t.length)return!1;for(var i=0;i<e.length;i++)if("number"==typeof e[i]&&"number"==typeof t[i]){if(Math.round(e[i]*n)!==Math.round(t[i]*n))return!1}else if(e[i]!==t[i])return!1;return!0}return"number"==typeof e&&"number"==typeof t?Math.round(e*n)===Math.round(t*n):e===t},_dispatchVariableEvent:function(e,t){this.dispatchEvent("VARIABLE_CHANGED",[e,t]),this.dispatchEvent(e+".CHANGED",[t])},GetParent:function(){var e=this._expDataObject.GetParent();if(e)return e._GetObjectModelerComponent()},GetParentVariable:function(){return this._expDataObject.GetParentVariable()},IsLocalVariable:function(e){return this._expDataObject.IsLocalVariable(e)},IsComputedVariable:function(e){return this._expDataObject.IsComputedVariable(e)},GetVariableInfo:function(e){return this._expDataObject.GetVariableInfo(e)},GetVariableType:function(e){return this._expDataObject.GetVariableType(e)},GetVariableValuationMode:function(e){return this._expDataObject.GetVariableValuationMode(e)},GetVariableRestrictedTypes:function(e){return this._expDataObject.GetVariableRestrictedTypes(e)},GetVariableMaxNumberOfValues:function(e){return this._expDataObject.GetVariableMaxNumberOfValues(e)},Traverse:function(e,t){this._expDataObject.Traverse(function(t){e(t._GetObjectModelerComponent())},t)},GetAsset:function(){return console.log("DEPRECATED"),this._GetAsset()},_GetAsset:function(){return this._expDataObject._GetAsset()},_SetExpDataObject:function(e){this._expDataObject=e;var t=this;this.listenTo(e.GetEventHandler(),"VARIABLE_CHANGED",function(e,r){r&&t._expDataObject.GetVariableType(e)===n.VarType.Object&&(r=Array.isArray(r)?r.map(function(e){return e._GetObjectModelerComponent()}):r._GetObjectModelerComponent()),t._volatileValues[e]!==r&&t._dispatchVariableEvent(e,r)}),this.listenTo(e.GetEventHandler(),"ASSET_CHANGED",function(e){t.dispatchEvent("ASSET_CHANGED",[e])})},_GetExpDataObject:function(){return this._expDataObject},SetVolatile:function(){this._onlyVolatile=!0},IsVolatile:function(){return this._onlyVolatile},RestorePersistent:function(){for(var e in this._onlyVolatile=!1,this._volatileValues)this._volatileValues.hasOwnProperty(e)&&this.RestorePersistentValueByName(e)},RestorePersistentValueByName:function(e){delete this._volatileValues[e],this._dispatchVariableEvent(e,this.GetValueByName(e))}})}),define("DS/CAT3DExpModel/interfaces/CATI3DExperienceObject",["UWA/Class","DS/WebComponentModeler/CATWebInterface","DS/CAT3DExpModel/XCTExpVariable"],function(e,t,r){"use strict";var n=t.singleton({interfaceName:"CATI3DExperienceObject",required:{GetPathOfIds:function(){},_GetVariablePathOfIds:function(){},ListVariables:function(){},ListLocalVariables:function(){},HasVariable:function(){return!1},AddVariable:function(){},GetValueByName:function(){},SetValueByName:function(){},GetParent:function(){},GetParentVariable:function(){},IsLocalVariable:function(){},IsComputedVariable:function(){},GetVariableInfo:function(){},GetVariableType:function(){},GetVariableValuationMode:function(){},GetVariableRestrictedTypes:function(){},GetVariableMaxNumberOfValues:function(){},Traverse:function(){},_SetExpDataObject:function(){},_GetExpDataObject:function(){},SetVolatile:function(){},IsVolatile:function(){},RestorePersistent:function(){},RestorePersistentValueByName:function(){},_GetAsset:function(){}},optional:{}});return n.VarType=r.VarType,n.ValuationMode=r.ValuationMode,n}),define("DS/CAT3DExpModel/extensions/CATE3DXVolatileEO",["UWA/Core","DS/CAT3DExpModel/interfaces/CATI3DExperienceObject"],function(e,t){"use strict";return e.Class.extend({init:function(){},setVolatile:function(){var e=this.QueryInterface("CATI3DExperienceObject");e.SetVolatile();var r=[];e.ListVariables(r,t.VarType.Object);for(var n=0;n<r.length;n++)if(e.GetVariableValuationMode(r[n])===t.ValuationMode.AggregatingValue){var i=e.GetValueByName(r[n]);if(i)if(Array.isArray(i))for(var a=0;a<i.length;a++)i[a].QueryInterface&&i[a].QueryInterface("CATI3DXVolatileEO")&&i[a].QueryInterface("CATI3DXVolatileEO").setVolatile();else i.QueryInterface&&i.QueryInterface("CATI3DXVolatileEO")&&i.QueryInterface("CATI3DXVolatileEO").setVolatile()}},restorePersistent:function(){var e=this.QueryInterface("CATI3DExperienceObject");e.RestorePersistent();var r=[];e.ListVariables(r,t.VarType.Object);for(var n=0;n<r.length;n++)if(e.GetVariableValuationMode(r[n])===t.ValuationMode.AggregatingValue){var i=e.GetValueByName(r[n]);if(i)if(Array.isArray(i))for(var a=0;a<i.length;a++)i[a].QueryInterface&&i[a].QueryInterface("CATI3DXVolatileEO")&&i[a].QueryInterface("CATI3DXVolatileEO").restorePersistent();else i.QueryInterface&&i.QueryInterface("CATI3DXVolatileEO")&&i.QueryInterface("CATI3DXVolatileEO").restorePersistent()}}})}),define("DS/CAT3DExpModel/extensions/CATEModifiable",["UWA/Core","DS/CAT3DExpModel/CAT3DXModel","DS/VCXWebProperties/VCXProperty","DS/VCXWebProperties/VCXPropertySet","DS/VCXWebProperties/VCXPropertyInfo","DS/VCXWebProperties/VCXPropertyValueFloat","DS/VCXWebProperties/VCXPropertyValueInt","DS/VCXWebProperties/VCXPropertyValueString","DS/VCXWebProperties/VCXPropertyValueBoolean","DS/VCXWebProperties/VCXPropertyValueColor","DS/VCXWebProperties/VCXPropertyValueLink","DS/VCXWebModifiables/VCXModifiable","DS/CAT3DExpModel/interfaces/CATI3DExperienceObject","DS/CAT3DExpModel/XCTExpPathOfIds","i18n!DS/VCXWebModifiables/assets/nls/VCXWebModifiables"],function(e,t,r,n,i,a,o,s,c,l,u,p,d,f,h){"use strict";return p.extend({init:function(){this._parent(),this.VCXProperties={}},Dispose:function(){this._parent(),this.VCXProperties={}},GetType:function(){return this._type},GetProperties:function(){for(var e=new n,t=this.QueryInterface("CATI3DExperienceObject").ListVariables(),r=0;r<t.length;++r){var i=this.GetProperty(t[r]);i&&e.AddOrModifyProperty(i)}return e},GetProperty:function(e){var t=this._getVCXProperty(e);if(t){var r=this._getVCXPropertyValue(e);return t.SetPropertyValue(r),t}},OnChangeProperty:function(e,t){if(this.QueryInterface("CATI3DExperienceObject").HasVariable(e)){var r=this.QueryInterface("CATI3DExperienceObject").GetValueByName(e),n=this._getVariableValue(e,t);r!==n&&this.QueryInterface("CATI3DExperienceObject").SetValueByName(e,n)}},_getVCXProperty:function(e){if(!this.VCXProperties[e]){var t=this.QueryInterface("CATI3DExperienceObject");if(!t.HasVariable(e))return;if(t.GetVariableType(e)===d.VarType.Object&&t.GetVariableValuationMode()===d.ValuationMode.AggregatingValue)return;if(1!==t.GetVariableMaxNumberOfValues(e))return;this._createVCXProperty(e)}return this.VCXProperties[e]},_createVCXProperty:function(e){var t=new i(e,0,!0,"VCXWebModifiables/VCXWebModifiables",h);this.VCXProperties[e]=new r(t)},_getVCXPropertyValue:function(e){var t=this.QueryInterface("CATI3DExperienceObject");if(t.HasVariable(e))switch(t.GetVariableType(e)){case d.VarType.Integer:return this._toVCXInt(e);case d.VarType.Double:return this._toVCXFloat(e);case d.VarType.String:return this._toVCXString(e);case d.VarType.Boolean:return this._toVCXBool(e);case d.VarType.Color:return this._toVCXColor(e);case d.VarType.Object:return this._toVCXLink(e)}},_getVariableValue:function(e,t){var r=this.QueryInterface("CATI3DExperienceObject");if(r.HasVariable(e))switch(r.GetVariableType(e)){case d.VarType.Object:return this._fromVCXLink(t);default:return t.GetValue()}},_toVCXInt:function(e){return new o(this.QueryInterface("CATI3DExperienceObject").GetValueByName(e))},_toVCXFloat:function(e){return new a(this.QueryInterface("CATI3DExperienceObject").GetValueByName(e))},_toVCXString:function(e){return new s(this.QueryInterface("CATI3DExperienceObject").GetValueByName(e))},_toVCXBool:function(e){return new c(this.QueryInterface("CATI3DExperienceObject").GetValueByName(e))},_toVCXColor:function(e){return new l(this.QueryInterface("CATI3DExperienceObject").GetValueByName(e))},_toVCXLink:function(e){var t=this.QueryInterface("CATI3DExperienceObject").GetValueByName(e),r=t?t.QueryInterface("CATI3DExperienceObject").GetPathOfIds().toString():null;return new u(r)},_fromVCXLink:function(e){var r=new f,n=e.GetValue();return r.setFromArray(n.split(",")),t.GetExpObject(r)}})}),define("DS/CAT3DExpModel/XCTExpDataObject",["UWA/Core","UWA/Class/Events","DS/CAT3DExpModel/XCTExpVariable","DS/CAT3DExpModel/XCTExpAsset","DS/CAT3DExpModel/XCTExpPathOfIds","DS/CAT3DExpModel/CAT3DXModel"],function(e,t,r,n,i,a){"use strict";var o={Dispose:function(){if(this.hasOwnProperty("_childrenObjects"))for(var e=0;e<this._childrenObjects.length;e++)this._childrenObjects[e].Dispose();var t=Object.getPrototypeOf(this);for(var r in t._RemoveChildObject(this),this)this.hasOwnProperty(r)&&delete this[r]},_SetObjectBuilder:function(e){this._objectBuilder=e},_RemoveObjectBuilder:function(){delete this._objectBuilder},_CreateChildExpObject:function(e){var t=this._CreateChildObject(e,!1);return t._isPrototypeObject=!1,t._updateVirtualObjects().done(function(){return t})},_CreateChildVirtualExpObject:function(e){var t=this._CreateChildObject(e);return t._isPrototypeObject=!1,t._isVirtualObject=!0,t._updateVirtualObjects().done(function(){return t})},_CreateChildPrototypeObject:function(e,t){var r=this._CreateChildObject(e,t);return r._isPrototypeObject=!0,r},_CreateChildObject:function(e,t){var r=Object.create(this);(r._SetPathOfIds(e),t)||this._GetChildrenObjects().push(r);return r},_RemoveChildObject:function(e){var t=this._GetChildrenObjects(),r=t.indexOf(e);t.splice(r,1)},_GetChildrenObjects:function(){return this.hasOwnProperty("_childrenObjects")||(this._childrenObjects=[]),this._childrenObjects},_updateVirtualObjects:function(){var t=Object.getPrototypeOf(this),n=[];t.ListVariables(n,r.VarType.Object);var i=[];for(let e=0;e<n.length;e++)this.GetVariableValuationMode(n[e])===r.ValuationMode.AggregatingValue&&i.push(this._updateVirtualObjectsFromAggregatingVariable(n[e]));var a=this;return e.Promise.all(i).done(function(){i=[];for(let e=0;e<n.length;e++)a.GetVariableValuationMode(n[e])===r.ValuationMode.ReferencingValue&&i.push(a._updateVirtualObjectsFromReferencingVariable(n[e]));return e.Promise.all(i)})},_updateVirtualObjectsFromAggregatingVariable:function(e){return 1===this.GetVariableMaxNumberOfValues(e)?this._updateVirtualObjectsFromAggregatingVariableWithSingleValue(e):this._updateVirtualObjectsFromAggregatingVariableWithArrayValue(e)},_updateVirtualObjectsFromAggregatingVariableWithSingleValue:function(t){if(this.IsLocalVariable(t))return e.Promise.resolve();var r,n=Object.getPrototypeOf(this);if(n._isPrototypeObject)for(;n.HasVariable(t)&&!e.is(r);)r=n._GetLocalValueByName(t),n=Object.getPrototypeOf(n);else n.HasVariable(t)&&(r=n.GetValueByName(t));if(!r)return e.Promise.resolve();this._GetVirtualValueByName(t)&&console.log("todo");var a=new i,o=r.GetPathOfIds().toArray();if(r._isPrototypeObject){var s=this._GetVariablePathOfIds(t).toArray();a.setFromArray(s.concat(o))}else{var c=this.GetPathOfIds().toArray(),l=r.GetParent().GetPathOfIds().toArray();a.setFromArray(c.concat(o.slice(l.length)))}var u=this;return this._objectBuilder._createVirtualObject(r,a).done(function(e){return u._SetVirtualValueByNameSession(t,e)})},_updateVirtualObjectsFromAggregatingVariableWithArrayValue:function(t){var r=[],n=Object.getPrototypeOf(this);if(n._isPrototypeObject)for(;n.HasVariable(t);){var a=n._GetLocalValueByName(t);a&&(r=r.concat(a)),n=Object.getPrototypeOf(n)}else n.HasVariable(t)&&(r=n.GetValueByName(t));if(0===r.length)return e.Promise.resolve();var o=this._GetVirtualValueByName(t);o?console.log("todo"):o=[];for(var s=[],c=0;c<r.length;c++){var l=new i,u=r[c].GetPathOfIds().toArray();if(r[c]._isPrototypeObject){var p=this._GetVariablePathOfIds(t).toArray();l.setFromArray(p.concat(u))}else{var d=this.GetPathOfIds().toArray(),f=r[c].GetParent().GetPathOfIds().toArray();l.setFromArray(d.concat(u.slice(f.length)))}s.push(this._objectBuilder._createVirtualObject(r[c],l).done(function(e){o.push(e)}))}var h=this;return e.Promise.all(s).done(function(){return h._SetVirtualValueByNameSession(t,o)})},_updateVirtualObjectsFromReferencingVariable:function(t){return 1===this.GetVariableMaxNumberOfValues(t)?this._updateVirtualObjectsFromReferencingVariableWithSingleValue(t):(console.log("Not implemented"),e.Promise.resolve())},_updateVirtualObjectsFromReferencingVariableWithSingleValue:function(t){if(this.IsLocalVariable(t))return e.Promise.resolve();var r,n=Object.getPrototypeOf(this);if(n.HasVariable(t)&&(r=n.GetValueByName(t)),!r)return e.Promise.resolve();this._GetVirtualValueByName(t)&&console.log("todo");var o,s=r.GetPathOfIds().toArray(),c=n.GetPathOfIds().toArray();for(o=0;o<s.length&&(s[o]&&c[o]&&s[o]===c[o]);o++);var l=s.splice(o,s.length-o),u=this.GetPathOfIds().toArray();u.splice(o,u.length-o);var p=u.concat(l),d=new i;d.setFromArray(p);var f=this;return a._expDataObjectMap._getExpDataObjectAsync(d).then(function(e){return f._SetVirtualValueByNameSession(t,e)})},_SetPathOfIds:function(e){this._pathOfIds=e.clone()},GetPathOfIds:function(){return this._pathOfIds?this._pathOfIds.clone():null},GetType:function(){var e=Object.getPrototypeOf(this);if(!o.isPrototypeOf(e))return null;var t=e.GetPathOfIds();return t?t.toString():null},GetTypes:function(){for(var e=[],t=this;t&&o.isPrototypeOf(t);){var r=t.GetType();r&&e.push(r),t=Object.getPrototypeOf(t)}return e.reverse()},IsKindOf:function(e){for(var t=this.GetType(),r=this;t;){if(t===e)return!0;t=(r=Object.getPrototypeOf(r)).GetType()}return!1},_SetFacet:function(e){this._facet=e},_GetFacet:function(){return this._facet},_setAssetSession:function(e,t,r,i){this._asset=new n(e,t,r,i),this.GetEventHandler().dispatchEvent("ASSET_CHANGED",[this._asset])},_GetAsset:function(){return this._asset},SetValueByName:function(e,t){return a.SetVariableValues(this,e,t)},_SetValueByNameSession:function(e,t,n){return this.GetVariableType(e)===r.VarType.Object?this._SetObjectValueByNameSession(e,t,n):this._SetDefaultValueByNameSession(e,t,n)},_SetObjectValueByNameSession:function(t,n,i){if(this._SetLocalValueByName(t,n,i),n&&this.GetVariableValuationMode(t)===r.ValuationMode.AggregatingValue){this._SetChildrenParent(n,t),this._DispatchVariableEvent(t,this.GetValueByName(t));let r=this._GetChildrenObjects(),i=[];for(let e=0;e<r.length;e++)i.push(r[e]._updateVirtualObjectsFromAggregatingVariable(t));return e.Promise.all(i)}this._DispatchVariableEvent(t,this.GetValueByName(t));let a=this._GetChildrenObjects(),o=[];for(let e=0;e<a.length;e++)o.push(a[e]._updateVirtualObjectsFromReferencingVariable(t));return e.Promise.all(o)},_SetVirtualValueByNameSession:function(t,n){var i=this._GetVariableByName(t);if(!i)return console.warn("variable "+t+" doesnt exist"),e.Promise.reject("variable "+t+" doesnt exist");if(this.IsLocalVariable(t+"_virtual")||((i=Object.create(i))._isVirtual=!0,this["_vName_"+t+"_virtual"]=i),i._SetValue(n),this.GetVariableValuationMode(t)===r.ValuationMode.AggregatingValue){this._SetChildrenParent(n,t),this._DispatchVariableEvent(t,this.GetValueByName(t));for(var a=this._GetChildrenObjects(),o=[],s=0;s<a.length;s++)o.push(a[s]._updateVirtualObjectsFromAggregatingVariable(t));return e.Promise.all(o)}return this._DispatchVariableEvent(t,this.GetValueByName(t)),e.Promise.resolve()},_SetDefaultValueByNameSession:function(t,r,n){return this._SetLocalValueByName(t,r,n),this._PropagateDefaultVariableEvent(t,r),e.Promise.resolve()},_SetLocalValueByName:function(t,n,i){var a=this._GetVariableByName(t);if(!a)return console.warn("variable "+t+" doesnt exist"),e.Promise.reject("variable "+t+" doesnt exist");this.IsLocalVariable(t)||(Array.isArray(n)&&this.GetVariableValuationMode(t)===r.ValuationMode.AggregatingValue&&a._GetValue()===n&&console.warn("WARNING : YOU MUST CLONE SESSION OBJECT TO OVERRIDE VALUE!"),a=Object.create(a),this._AddVariableToDataObject(a,!1)),a._SetValue(n,i)},_PropagateDefaultVariableEvent:function(e,t){this._DispatchVariableEvent(e,t);for(var r=this._GetChildrenObjects(),n=0;n<r.length;n++){var i=r[n];i.IsLocalVariable(e)||i._PropagateDefaultVariableEvent(e,t)}},_DispatchVariableEvent:function(e,t){var r=this.GetEventHandler();r.dispatchEvent("VARIABLE_CHANGED",[e,t]),r.dispatchEvent(e+".CHANGED",[t])},_SetChildrenParent:function(e,t){if(Array.isArray(e))for(var r=0;r<e.length;r++)e[r]._SetParent(this,t);else e._SetParent(this,t)},GetValueByName:function(e){if(this.GetVariableType(e)===r.VarType.Object)return this._GetObjectValueByName(e);var t=this._GetVariableByName(e);if(t)return t._GetValue();console.warn("variable "+e+" doesnt exist")},_GetObjectValueByName:function(e){var t=this._GetVariableByName(e);if(t){var r=this._GetVariableByName(e+"_virtual");if(1===this.GetVariableMaxNumberOfValues(e))return this.IsLocalVariable(e)?t._GetValue():r&&this.IsLocalVariable(e+"_virtual")?r._GetValue():void 0;var n=[];return this.IsLocalVariable(e)&&(n=n.concat(t._GetValue())),r&&this.IsLocalVariable(e+"_virtual")&&(n=n.concat(r._GetValue())),n}console.warn("variable "+e+" doesnt exist")},_GetLocalValueByName:function(e){var t=this._GetVariableByName(e);if(t)return this.IsLocalVariable(e)?t._GetValue():void 0;console.warn("variable "+e+" doesnt exist")},_GetVirtualValueByName:function(e){var t=this._GetVariableByName(e+"_virtual");if(t&&this.IsLocalVariable(e+"_virtual"))return t._GetValue()},AddVariable:function(e,t,r,n,i){return a.CreateVariable(this,e,t,r,n,i)},_AddVariableSession:function(t,n,i,a,o,s,c){var l=Object.create(r);return l._SetDescription(t,n,i,a,o,s),this._AddVariableToDataObject(l,!0),e.is(c)?this._SetValueByNameSession(t,c):n===r.VarType.Object&&1!==i?this._SetValueByNameSession(t,[]):e.Promise.resolve()},_AddVariableToDataObject:function(e,t){var r=e._GetName();this["_vName_"+r]=e,t&&(this["_vId_"+e._GetID()]=r)},_GetVariableByName:function(e,t){if(!t||this.hasOwnProperty("_vName_"+e))return this["_vName_"+e]},_GetVariableByID:function(e){return this["_vName_"+this["_vId_"+e]]},HasVariable:function(e){return!!this._GetVariableByName(e)},_HasVariableFromId:function(e){return!!this._GetVariableByID(e)},ListVariables:function(t,n){var i=t||[];for(var a in i.length=0,this)!r.isPrototypeOf(this[a])||this[a]._isVirtual||e.is(n)&&n!==r.VarType.All&&n!==this[a]._GetType()||i.push(this[a]._description._name);return i},ListLocalVariables:function(t,n){var i=t||[];for(var a in i.length=0,this)!this.hasOwnProperty(a)||!r.isPrototypeOf(this[a])||this[a]._isVirtual||e.is(n)&&n!==r.VarType.All&&n!==this[a]._GetType()||i.push(this[a]._description._name);return i},IsLocalVariable:function(e){return!!this._GetVariableByName(e,!0)},IsComputedVariable:function(e){var t=this._GetVariableByName(e);if(t)return t._IsComputed();console.warn("variable "+e+" doesnt exist")},GetVariableInfo:function(e){var t=this._GetVariableByName(e);if(t)return{name:e,type:t._GetType(),valuationMode:t._GetValuationMode(),maxNumberOfValues:t._GetMaxNumberOfValues(),restrictedTypes:t._GetRestrictedTypes()};console.warn("variable "+e+" doesnt exist")},_GetVariableInfoFromId:function(e){var t=this._GetVariableByID(e);return this.GetVariableInfo(t._GetName())},GetVariableType:function(e){var t=this._GetVariableByName(e);if(t)return t._GetType();console.warn("variable "+e+" doesnt exist")},GetVariableValuationMode:function(e){var t=this._GetVariableByName(e);if(t)return t._GetValuationMode();console.warn("variable "+e+" doesnt exist")},GetVariableRestrictedTypes:function(e){var t=this._GetVariableByName(e);if(t)return t._GetRestrictedTypes();console.warn("variable "+e+" doesnt exist")},GetVariableMaxNumberOfValues:function(e){var t=this._GetVariableByName(e);if(t)return t._GetMaxNumberOfValues();console.warn("variable "+e+" doesnt exist")},_GetVariablePathOfIds:function(e){var t=this._GetVariableByName(e);if(t){var r=this.GetPathOfIds();return r.pushId(t._GetID()),r}console.warn("variable "+e+" doesnt exist")},_SetParent:function(e,t){this._parent=e,this._parentVariable=t},GetParent:function(){return this._parent},GetParentVariable:function(){return this._parentVariable},GetEventHandler:function(){return this.hasOwnProperty("_eventHandler")||(this._eventHandler=new t),this._eventHandler},Traverse:function(t,n){if(n=!e.is(n)||n,t(this),n){var i=[];this.ListVariables(i,r.VarType.Object);for(var a=0;a<i.length;a++)if(this.GetVariableValuationMode(i[a])===r.ValuationMode.AggregatingValue){var o=this.GetValueByName(i[a]);if(o)if(Array.isArray(o))for(var s=0;s<o.length;s++)o[s].Traverse(t,n);else o.Traverse(t,n)}}else{var c=this.GetParent();c&&c.Traverse(t,n)}}};return o}),define("DS/CAT3DExpModel/expCoreLink/ExpCoreLinkContext3DSpace",["UWA/Core","UWA/Class","DS/CAT3DExpModel/expCoreLink/ExpCoreLinkContext"],function(e,t,r){"use strict";return r.extend({init:function(e,t){this._3DSpaceAsset=e,this._parent(e,t)},_getContent:function(){return this._3DSpaceAsset},_getService:function(e){if("Streams"===e)return this._createExpCoreLinkService("ExpCoreLinkService3DSpaceStream")},_getParentLinkContext:function(){return null},_getParentService:function(){return this._createExpCoreLinkService("ExpCoreLinkService3DSpace")}})}),define("DS/CAT3DExpModel/expCoreLink/ExpCoreLinkContextType",["UWA/Core","UWA/Class","DS/CAT3DExpModel/expCoreLink/ExpCoreLinkContext"],function(e,t,r){"use strict";return r.extend({init:function(e,t){this._type=e,this._parent(e,t)},_getContent:function(){return this._type},_getParentLinkContext:function(){return null},_getParentService:function(){return this._createExpCoreLinkService("ExpCoreLinkServiceTypes")}})}),define("DS/CAT3DExpModel/loaders/CAT3DXVPMReferenceLoader",["UWA/Core","UWA/Class/Promise","DS/CAT3DExpModel/loaders/CAT3DXLoader","DS/CAT3DExpModel/CAT3DXModel"],function(e,t,r,n){"use strict";return r.extend({loadLink:function(e,t){var r=n.GetExperience();return n.InsertProduct(null,r,t,e)}})}),define("DS/CAT3DExpModel/expCoreLink/ExpCoreLinkContextString",["UWA/Core","DS/CAT3DExpModel/expCoreLink/ExpCoreLinkContext"],function(e,t){"use strict";return t.extend({init:function(e,t){this._string=e,this._parent(e,t)},_getContent:function(){return this._string},_getParentLinkContext:function(){return null},_getParentService:function(){return this._createExpCoreLinkService("ExpCoreLinkServiceString")}})}),define("DS/CAT3DExpModel/loaders/CAT3DXImageLoader",["UWA/Core","UWA/Class/Promise","DS/CAT3DExpModel/loaders/CAT3DXLoader","DS/CAT3DExpModel/CAT3DXModel"],function(e,t,r,n){"use strict";return r.extend({loadLink:function(e,t){var r,i=this;return t.resolveLinkAsStream(e).then(function(r){var a=URL.createObjectURL(r);return n.CreateBinaryResource(t.getNameForLinkDescription(e),a,i.blobTypeExtensionMap[r.type])}).then(function(i){return r=i,n.CreateUIImage(t.getNameForLinkDescription(e))}).then(function(e){return e.QueryInterface("CATI3DExperienceObject").GetValueByName("data").QueryInterface("CATI3DExperienceObject").SetValueByName("image",r),e})},blobTypeExtensionMap:{"image/png":"png","image/jpeg":"jpg"}})}),define("DS/CAT3DExpModel/XCTExp3DSpaceAsset",["UWA/Core","UWA/Class","DS/CAT3DExpModel/CAT3DXModel","DS/WAFData/WAFData"],function(e,t,r,n){"use strict";return e.Class.extend({init:function(e){this._physicalId=e},getPhysicalId:function(){return this._physicalId},getType:function(){return this._getInfos().then(e=>e.type)},_getInfos:function(){return this._infos?e.Promise.resolve(this._infos):this._infosPromise?this._infosPromise:(this._infosPromise=r.getFactory().getServerURL().then(t=>{var r=e.Promise.deferred();return n.authenticatedRequest(t+"/resources/v2/e6w/service/ObjectInfo/"+this._physicalId,{method:"GET",type:"json",onComplete:function(e){1===e.data.length?r.resolve(e.data[0]):r.reject(new Error("Cant retrieve 3DSpace Objects infos "+this._physicalId))},onFailure:function(e){r.reject(new Error(e))}}),r.promise}).then(e=>(this._infos=e,delete this._infosPromise,e)).catch(t=>(delete this._infosPromise,e.Promise.reject(t))),this._infosPromise)}})}),define("DS/CAT3DExpModel/XCTExpDataObjectOM",["UWA/Core","DS/CAT3DExpModel/XCTExpDataObject"],function(e,t){"use strict";var r=Object.create(t);return r.Dispose=function(){delete this._objectModelerComponent,t.Dispose.call(this)},r._SetObjectModelerComponent=function(e){this._objectModelerComponent=e},r._GetObjectModelerComponent=function(){return this._objectModelerComponent},r}),define("DS/CAT3DExpModel/expCoreLink/ExpCoreLinkContextExpDataObject",["UWA/Core","UWA/Class","DS/CAT3DExpModel/expCoreLink/ExpCoreLinkContext"],function(e,t,r){"use strict";return r.extend({init:function(e,t){this._expDataObject=e,this._parent(e,t)},_getContent:function(){return this._expDataObject},_getService:function(e){return"Variables"===e?this._createExpCoreLinkService("ExpCoreLinkServiceVariable"):"Scenario"===e?this._createExpCoreLinkService("ExpCoreLinkServiceVCXScenario"):"Streams"===e?this._createExpCoreLinkService("ExpCoreLinkServiceExpDataObjectStream"):void 0},_getParentLinkContext:function(){var e=this._expDataObject.GetPathOfIds();e.popId();var t=e.popId();return this._createExpCoreLinkContext("ExpCoreLinkContextVariable",{parent:this._expDataObject.GetParent(),id:t})},_getParentService:function(){return this._createExpCoreLinkService("ExpCoreLinkServiceValue")}})}),define("DS/CAT3DExpModel/expCoreLink/ExpCoreLinkService3DSpaceStream",["UWA/Core","UWA/Class","DS/CAT3DExpModel/expCoreLink/ExpCoreLinkService","DS/CAT3DExpModel/XCTPLMDocumentHelper","DS/CAT3DExpModel/CAT3DXModel"],function(e,t,r,n,i){"use strict";return r.extend({_getChildLinkContextFromIdentifier:function(t,r){return t._getContent().getType().then(n=>"Document"===n?this._getChildLinkContextFromIdentifierDocument(t,r):e.Promise.reject("ExpCoreLinkService3DSpaceStream : Cant resolve this link "+r))},_getChildLinkContextFromIdentifierDocument:function(e,t){let r;return i.getFactory().getPlatformId().then(e=>(r=e,i.getFactory().getServerURL())).then(i=>n.getDocumentFile(e._getContent().getPhysicalId(),t,r,i)).then(e=>this._createExpCoreLinkContext("ExpCoreLinkContext3DSpaceStream",e))}})}),define("DS/CAT3DExpModel/loaders/CAT3DXExperienceLoader",["UWA/Core","UWA/Class/Promise","DS/CAT3DExpModel/loaders/CAT3DXLoader","DS/CAT3DExpModel/CAT3DXModel"],function(e,t,r,n){"use strict";return r.extend({loadLink:function(e,t){return n.LoadExperience(t,e)}})}),define("DS/CAT3DExpModel/expCoreLink/ExpCoreLinkContext3DSpaceVO",["UWA/Core","UWA/Class","DS/CAT3DExpModel/expCoreLink/ExpCoreLinkContext"],function(e,t,r){"use strict";return r.extend({init:function(e,t){this._3DSpaceVOAsset=e,this._parent(e,t)},_getContent:function(){return this._3DSpaceVOAsset},_getParentLinkContext:function(){return null},_getParentService:function(){return this._createExpCoreLinkService("ExpCoreLinkService3DSpace")}})}),define("DS/CAT3DExpModel/expCoreLink/ExpCoreLinkServiceString",["UWA/Core","UWA/Class","DS/CAT3DExpModel/expCoreLink/ExpCoreLinkService"],function(e,t,r){"use strict";return r.extend({_getChildLinkContextFromIdentifier:function(t,r){return e.Promise.resolve(this._createExpCoreLinkContext("ExpCoreLinkContextString",decodeURIComponent(r)))}})}),define("DS/CAT3DExpModel/expCoreLink/ExpCoreLinkContextStream",["UWA/Core","DS/CAT3DExpModel/expCoreLink/ExpCoreLinkContext"],function(e,t){"use strict";return t.extend({init:function(e,t){this._stream=e,this._parent(e,t)},_getContent:function(){return this._stream},_getParentLinkContext:function(){return null},_getParentService:function(){return null}})}),define("DS/CAT3DExpModel/expCoreLink/ExpCoreLinkService3DSpace",["UWA/Core","UWA/Class","DS/CAT3DExpModel/expCoreLink/ExpCoreLinkService","DS/CAT3DExpModel/XCTExp3DSpaceAsset"],function(e,t,r,n){"use strict";return r.extend({_getChildLinkContextFromIdentifier:function(t,r){return e.Promise.resolve(this._createExpCoreLinkContext("ExpCoreLinkContext3DSpace",new n(r)))}})}),define("DS/CAT3DExpModel/expCoreLink/ExpCoreLinkContext3DSpaceStream",["UWA/Core","DS/CAT3DExpModel/expCoreLink/ExpCoreLinkContextStream"],function(e,t){"use strict";return t.extend({_getParentLinkContext:function(){return null},_getParentService:function(){return this._createExpCoreLinkService("ExpCoreLinkService3DSpaceStream")}})}),define("DS/CAT3DExpModel/CAT3DXJSONReaderV2_1",["UWA/Core","DS/CAT3DExpModel/XCTExpVariable","DS/CAT3DExpModel/XCTExpPathOfIds","DS/VCXWebProperties/VCXColor","DS/CAT3DExpModel/XCTExpAsset"],function(e,t,r,n,i){"use strict";return{read:function(e,t,r,n){var i=e.ExperienceData,a=e.SessionData,o=e.Flavors,s=this;return this._deserializeObject(i,null,o,t,r,n).then(function(e){return s._deserializeSessionData(a,o,r),e})},readVariable:function(e,t,r,n,i){var a=e.ExperienceData,o=e.Flavors;return this._deserializeVariable(t,a,o,r,n,i)},_deserializeObject:function(t,n,i,a,o,s){var c,l;t.IDs.startsWith("./")?(c=n.clone()).pushId(t.IDs.slice(2)):(c=new r).setFromArray(t.IDs.split("/"));var u=this;return a._createObject(t.Prototype,c).then(function(r){return l=r,i.AssetHolders&&u._deserializeAssetHolders(r,t.AssetHolders),t.Variables?u._deserializeVariables(r,t.Variables,i,a,o,s):e.Promise.resolve()}).then(function(){return t.VariablesInContext?u._deserializeVariablesInContext(l,t.VariablesInContext,i,a,o,s):e.Promise.resolve()}).then(function(){return l}).catch(function(t){return"true"===localStorage.getItem("EWS_Debug")&&console.warn(t),e.Promise.reject(t)})},_deserializeAssetHolders:function(e,t){if(t)for(var r=0;r<t.length;r++)this._deserializeAssetHolder(e,t[r])},_deserializeAssetHolder:function(e,t){let r=t.Status?i.AssetStatus[t.Status]:i.AssetStatus.StatusOK;e._setAssetSession(t.LinkDescription,t.Cache,r)},_deserializeVariables:function(t,r,n,i,a,o){for(var s=[],c=0;c<r.length;c++)s.push(this._deserializeVariable(t,r[c],n,i,a,o));return e.Promise.allSettled(s)},_deserializeVariable:function(t,r,n,i,a,o){var s;if(r.IDs.startsWith("./"))s=r.IDs.slice(2);else{var c=r.IDs.split("/");s=c[c.length-1]}var l,u=r.Description;l=u?t._AddVariableSession(u.Name,u.VariableType,u.MaxSize,u.ValuationMode,u.RestrictedType,s):e.Promise.resolve();var p,d=this;return l.then(function(){if(t._HasVariableFromId(s)){p=t._GetVariableInfoFromId(s);var e=t._GetVariablePathOfIds(p.name);return d._getVariableValue(p,r.Value,e,n,i,a,o)}console.warn("Prototype "+t.GetType()+"/"+t.GetPathOfIds().toString()+" cant retrieve variable: "+s)}).then(function(n){var i=!1;return 0===r.IsSet&&e.is(n)&&(i=!0),t._SetValueByNameSession(p.name,n,i)})},_getVariableValue:function(e,r,n,i,a,o,s){return e.type===t.VarType.Color?this._getColorValue(r):e.type===t.VarType.Object?this._getObjectValue(e,r,n,i,a,o,s):this._getDefaultValue(e,r)},_getDefaultValue:function(t,r){return r?1===t.maxNumberOfValues?e.Promise.resolve(r[0]):e.Promise.resolve(r):1===t.maxNumberOfValues?e.Promise.resolve(void 0):e.Promise.resolve([])},_getColorValue:function(t){return t?e.Promise.resolve((new n).FromRGBA(t[0],t[1],t[2],t[3])):e.Promise.resolve()},_getObjectValue:function(r,n,i,a,o,s,c){if(!n)return 0===r.maxNumberOfValues?e.Promise.resolve([]):e.Promise.resolve(void 0);var l=[],u=[];if(r.valuationMode===t.ValuationMode.AggregatingValue)for(let e=0;e<n.length;e++)u.push(this._getAggregatingObject(n,e,i,a,o,s,c).then(function(e){l[e.index]=e.expObject}));else for(let e=0;e<n.length;e++)u.push(this._getReferencingValue(n,e,c).then(function(e){l[e.index]=e.expObject}));return e.Promise.allSettled(u).then(function(){return 1===r.maxNumberOfValues?l[0]:l})},_getAggregatingObject:function(e,t,r,n,i,a,o){return this._deserializeObject(e[t],r,n,i,a,o).then(function(e){return{expObject:e,index:t}})},_getReferencingValue:function(e,t,r){return r.resolveLink(e[t]).then(function(e){return{expObject:e,index:t}})},_deserializeVariablesInContext:function(t,r,n,i,a,o){for(var s=[],c=0;c<r.length;c++)s.push(this._deserializeVariableInContext(t,r[c],n,i,a,o));return e.Promise.allSettled(s)},_deserializeVariableInContext:function(e,t,n,i,a,o){var s=e.GetPathOfIds().toArray().concat(t.Context.split("/")),c=new r;c.setFromArray(s);var l,u,p=t.IDs.slice(2),d=this;return a._getExpDataObjectAsync(c).then(function(e){l=e,u=e._GetVariableInfoFromId(p);var r=l.GetPathOfIds();return r.pushId(p),d._getVariableValue(u,t.Value,r,n,i,a,o)}).then(function(e){return l._SetValueByNameSession(u.name,e)})},_deserializeSessionData:function(e,t,n){if(e&&e.Treekeys&&t.Facets){var i=e.Treekeys["3D"],a=e.RepIdLinks;for(var o in a)if(a.hasOwnProperty(o)){var s=new r;s.setFromArray(o.split("/")),n._getExpDataObject(s)._SetFacet({"3D":{idPath:a[o]["3D"],treeKey:i}})}}}}}),define("DS/CAT3DExpModel/expCoreLink/ExpCoreLinkServiceValue",["UWA/Core","UWA/Class","DS/CAT3DExpModel/expCoreLink/ExpCoreLinkService"],function(e,t,r){"use strict";var n,i=r.extend({_getChildLinkContextFromIdentifier:function(e,t){var r=e._getContent(),i=this,a=r.parent.GetPathOfIds();return a.pushId(r.id),a.pushId(t),n._getExpDataObjectAsync(a).then(function(e){return i._createExpCoreLinkContext("ExpCoreLinkContextExpDataObject",e)})}});return i._setDataObjectMap=function(e){n=e},i._removeDataObjectMap=function(){n=void 0},i}),define("DS/CAT3DExpModel/CAT3DXJSONReaderV1",["UWA/Core","DS/CAT3DExpModel/XCTExpVariable","DS/CAT3DExpModel/XCTExpPathOfIds","DS/VCXWebProperties/VCXColor","DS/CAT3DExpModel/XCTExpAsset"],function(e,t,r,n,i){"use strict";return{read:function(t,r,n,i,a){var o,s=e.Promise.deferred(),c={buildPromises:[],endBuildPromise:s.promise,processPromises:[],JSONContext:t,objectBuilder:r,expDataObjectMap:n},l=e.Promise.deferred();return this._deserializeObject(t,c,a.linkContext).done(function(t){return o=t,e.Promise.all(c.buildPromises)}).done(function(){return s.resolve(),e.Promise.all(c.processPromises)}).done(function(){l.resolve(o)}),l.promise},readVariable:function(t,r,n,i,a,o){var s=e.Promise.deferred(),c={buildPromises:[],endBuildPromise:s.promise,processPromises:[],JSONContext:t,objectBuilder:n,expDataObjectMap:i},l=e.Promise.deferred();return this._deserializeVariable(r,t,c,o.linkContext).done(function(){return e.Promise.all(c.buildPromises)}).done(function(){return s.resolve(),e.Promise.all(c.processPromises)}).done(function(){l.resolve()}),l.promise},_deserializeObject:function(t,r,n){if(t&&t.Prototype){var i,a=this,o=this._buildObject(t,r).then(function(e){if(i=e,e._GetObjectModelerComponent){var o=e._GetObjectModelerComponent();o&&o.QueryInterface("CATI3DXJSONProcessor")&&r.processPromises.push(r.endBuildPromise.then(function(){return o.QueryInterface("CATI3DXJSONProcessor").Process()}))}return n=a._deserializeAsset(e,t,r,n),a._deserializeFacet(e,t),a._deserializeVariables(e,t,r,n)}).then(function(){return i}).catch(function(t){return"true"===localStorage.getItem("EWS_Debug")&&console.warn(t),e.Promise.resolve()});return r.buildPromises.push(o),o}return e.Promise.resolve()},_buildObject:function(t,n){var i=new r;return i.setFromArray(t.IDs.PathOfIds),n.objectBuilder._createObject(t.Prototype,i).then(function(t){return e.Promise.resolve(t)})},_deserializeAsset:function(e,t,r,n){var a,o=t.AssetHolders;if(o)for(a=0;a<o.length;a++){if(o[a].LinkContextDescription&&e._GetObjectModelerComponent){var s=e._GetObjectModelerComponent();s&&s._experienceBase&&(n=s._experienceBase.getManager("CAT3DXLinkManager").getLinkContextFromJSONDescription(o[a].LinkContextDescription))}let t=o[a].Status?i.AssetStatus[o[a].Status]:i.AssetStatus.StatusOK;e._setAssetSession(o[a].LinkDescription,o[a].Cache,t,n)}return n},_deserializeFacet:function(e,t){t.RepIdLink&&e._SetFacet(t.RepIdLink)},_deserializeVariables:function(t,r,n,i){var a=[];if(r.Variables)for(var o=0;o<r.Variables.length;o++)a.push(this._deserializeVariable(t,r.Variables[o],n,i));return e.Promise.allSettled(a)},_deserializeVariable:function(t,r,n,i){var a=!1;if(0===r.IsSet&&e.is(r.Value)&&(a=!0),!r.IsLocalVariable&&!a)return e.Promise.resolve();var o,s=r.Name,c=r.IDs.PathOfIds[r.IDs.PathOfIds.length-1];o=t.HasVariable(s)?e.Promise.resolve():t._AddVariableSession(s,r.VariableType,r.MaxSize,r.ValuationMode,r.RestrictedType,c);var l=this;return o.then(function(){var e=t.GetVariableInfo(s);return l._getVariableValue(e,r.Value,n,i)}).then(function(e){return t._SetValueByNameSession(s,e,a)})},_getVariableValue:function(e,r,n,i){var a=e.type;return a===t.VarType.Color?this._getColorValue(r):a===t.VarType.Object?this._getObjectValue(e,r,n,i):this._getDefaultValue(e,r)},_getDefaultValue:function(t,r){return r?1===t.maxNumberOfValues?e.Promise.resolve(r[0]):e.Promise.resolve(r):1===t.maxNumberOfValues?e.Promise.resolve(void 0):e.Promise.resolve([])},_getColorValue:function(t){return t?e.Promise.resolve((new n).FromRGBA(t[0],t[1],t[2],t[3])):e.Promise.resolve()},_getObjectValue:function(r,n,i,a){if(!n)return 0===r.maxNumberOfValues?e.Promise.resolve([]):e.Promise.resolve(void 0);var o=[],s=[];if(r.valuationMode===t.ValuationMode.AggregatingValue)for(let e=0;e<n.length;e++)s.push(this._getAggregatingObject(n,e,i,a).then(function(e){o[e.index]=e.expObject}));else for(let e=0;e<n.length;e++)s.push(this._getReferencingValue(n,e,i).then(function(e){o[e.index]=e.expObject}));return e.Promise.allSettled(s).then(function(){return 1===r.maxNumberOfValues?o[0]:o})},_getAggregatingObject:function(e,t,r,n){return this._deserializeObject(e[t],r,n).then(function(e){return{expObject:e,index:t}})},_getReferencingValue:function(e,t,r){return r.expDataObjectMap._getExpDataObjectAsync(e[t].PathOfIds.toString()).then(function(e){return{expObject:e,index:t}})}}}),define("DS/CAT3DExpModel/CAT3DXJSONReader",["UWA/Core","DS/CAT3DExpModel/CAT3DXJSONReaderV1","DS/CAT3DExpModel/CAT3DXJSONReaderV2_1"],function(e,t,r){"use strict";return{read:function(n,i,a,o,s){if(s=s||{},!n.Version)return t.read(n,i,a,o,s);switch(n.Version){case"2.1":return r.read(n,i,a,o);default:return e.Promise.reject("CAT3DXJSONReader : Cant read this JSON Version : "+n.Version)}},readVariable:function(n,i,a,o,s,c){if(c=c||{},!n.Version)return t.readVariable(n,i,a,o,s,c);switch(n.Version){case"2.1":return r.readVariable(n,i,a,o,s);default:return e.Promise.reject("CAT3DXJSONReader : Cant read this JSON Version : "+n.Version)}}}}),define("DS/CAT3DExpModel/expCoreLink/ExpCoreLinkService3DSpaceVO",["UWA/Core","UWA/Class","DS/CAT3DExpModel/expCoreLink/ExpCoreLinkService","DS/CAT3DExpModel/XCTExp3DSpaceVOAsset"],function(e,t,r,n){"use strict";return r.extend({_getChildLinkContextFromIdentifier:function(t,r){return e.Promise.resolve(this._createExpCoreLinkContext("ExpCoreLinkContext3DSpaceVO",new n(r.split(","))))}})}),define("DS/CAT3DExpModel/expCoreLink/ExpCoreLinkContextVariable",["UWA/Core","UWA/Class","DS/CAT3DExpModel/expCoreLink/ExpCoreLinkContext"],function(e,t,r){"use strict";return r.extend({init:function(e,t){this._parentVariable=e.parent,this._variableId=e.id,this._parent(e,t)},_getContent:function(){return{parent:this._parentVariable,id:this._variableId}},_getService:function(e){if("Variables"===e)return this._createExpCoreLinkService("ExpCoreLinkServiceValue")},_getParentLinkContext:function(){return this._createExpCoreLinkContext("ExpCoreLinkContextExpDataObject",this._parentVariable)},_getParentService:function(){return this._createExpCoreLinkService("ExpCoreLinkServiceVariable")}})}),define("DS/CAT3DExpModel/extensions/CATE3DExperienceObjectVolatile",["UWA/Core","UWA/Class/Events","DS/CAT3DExpModel/XCTExpVariable"],function(e,t,r){"use strict";var n=e.Class.extend(t,{init:function(){},Build:function(){this._volatileValues={}},Dispose:function(){delete this._expDataObject,delete this._volatileValues,delete this._volatileAsset,delete this._parentObject,delete this._parentVariable,delete this._pathOfIds},_SetPathOfIds:function(e){this._pathOfIds=e.clone()},GetPathOfIds:function(){return this._pathOfIds.clone()},_GetVariablePathOfIds:function(e){var t=this.GetPathOfIds(),r=this._expDataObject._GetVariablePathOfIds(e);return t.pushId(r.popId()),t},ListVariables:function(e,t){return this._expDataObject.ListVariables(e,t)},ListLocalVariables:function(){},HasVariable:function(e){return this._expDataObject.HasVariable(e)},AddVariable:function(){},GetValueByName:function(e){var t;if(this._volatileValues.hasOwnProperty(e))t=this._volatileValues[e];else if((t=this._expDataObject.GetValueByName(e))&&this._expDataObject.GetVariableType(e)===r.VarType.Object){if(Array.isArray(t))return this._expDataObject.GetVariableValuationMode(e)===r.ValuationMode.AggregatingValue?[]:t.map(function(e){return e._omComponent});if(this._expDataObject.GetVariableValuationMode(e)===r.ValuationMode.AggregatingValue)return;return t._omComponent}return"true"===localStorage.getItem("EWS_FilterUnnecessarySetValue")&&Array.isArray(t)&&(t=t.slice()),t},SetValueByName:function(t,r){if("true"===localStorage.getItem("EWS_FilterUnnecessarySetValue")){if(!this._isSetValueNecessary(t,r))return e.Promise.resolve();Array.isArray(r)&&(r=r.slice())}return this._volatileValues[t]=r,this._dispatchEvent(t,r),e.Promise.resolve()},_isSetValueNecessary:function(e,t){if(!this.IsLocalVariable(e))return!0;var r=this.GetValueByName(e);return!this._compareValues(t,r)},_compareValues:function(e,t){var r=localStorage.getItem("EWS_FilterUnnecessarySetValueDecimalPrecision")?localStorage.getItem("EWS_FilterUnnecessarySetValueDecimalPrecision"):6,n=Math.pow(10,r);if(Array.isArray(e)){if(!Array.isArray(t))return!1;if(e.length!==t.length)return!1;for(var i=0;i<e.length;i++)if("number"==typeof e[i]&&"number"==typeof t[i]){if(Math.round(e[i]*n)!==Math.round(t[i]*n))return!1}else if(e[i]!==t[i])return!1;return!0}return"number"==typeof e&&"number"==typeof t?Math.round(e*n)===Math.round(t*n):e===t},_dispatchEvent:function(e,t){this.dispatchEvent("VARIABLE_CHANGED",[e,t]),this.dispatchEvent(e+".CHANGED",[t])},_SetParent:function(e,t){this._parentObject=e,this._parentVariable=t},GetParent:function(){return this._parentObject},GetParentVariable:function(){return this._parentVariable},IsLocalVariable:function(){},IsComputedVariable:function(){},GetVariableInfo:function(e){return this._expDataObject.GetVariableInfo(e)},GetVariableType:function(e){return this._expDataObject.GetVariableType(e)},GetVariableValuationMode:function(e){return this._expDataObject.GetVariableValuationMode(e)},GetVariableRestrictedTypes:function(e){return this._expDataObject.GetVariableRestrictedTypes(e)},GetVariableMaxNumberOfValues:function(e){return this._expDataObject.GetVariableMaxNumberOfValues(e)},Traverse:function(){},_SetExpDataObject:function(e){this._expDataObject=e},_GetExpDataObject:function(){return this._expDataObject},SetVolatile:function(){},IsVolatile:function(){return!0},RestorePersistent:function(){},RestorePersistentValueByName:function(){},_GetAsset:function(){return this._expDataObject._GetAsset()}});return n.GetOrigin=function(){return"DS/CAT3DExpModel/extensions/CATE3DExperienceObjectVolatile"},n}),define("DS/CAT3DExpModel/expCoreLink/ExpCoreLinkServiceRootExperiences",["UWA/Core","UWA/Class","DS/CAT3DExpModel/expCoreLink/ExpCoreLinkService"],function(e,t,r){"use strict";var n,i=r.extend({_getChildLinkContextFromIdentifier:function(e,t){var r=this;return n._getExpDataObjectAsync(t).then(function(e){return r._createExpCoreLinkContext("ExpCoreLinkContextExpDataObject",e)})}});return i._setDataObjectMap=function(e){n=e},i._removeDataObjectMap=function(){n=void 0},i}),define("DS/CAT3DExpModel/expCoreLink/ExpCoreLinkServiceTypes",["UWA/Core","UWA/Class","DS/CAT3DExpModel/expCoreLink/ExpCoreLinkService"],function(e,t,r){"use strict";var n,i=r.extend({_getChildLinkContextFromIdentifier:function(e,t){var r=this;return n._getPrototypeObject(t).then(function(e){return r._createExpCoreLinkContext("ExpCoreLinkContextType",e)})}});return i._setObjectBuilder=function(e){n=e},i._removeObjectBuilder=function(){n=void 0},i}),define("DS/CAT3DExpModel/loaders/CAT3DXCoveringMaterialLoader",["UWA/Core","DS/CAT3DExpModel/loaders/CAT3DXLoader","DS/CAT3DExpModel/CAT3DXModel"],function(e,t,r){"use strict";return t.extend({loadLink:function(e,t){return r.InsertMaterial(null,t,e)}})}),define("DS/CAT3DExpModel/CAT3DXPrototypeJSONReaderV2_0",["UWA/Core","DS/CAT3DExpModel/XCTExpVariable","DS/CAT3DExpModel/XCTExpPathOfIds","DS/VCXWebProperties/VCXColor"],function(e,t,r,n){"use strict";return{getPrototypeDefinitionFromPrototypeList:function(e,t){var r=e.PrototypesData[t];if(r)return{Flavors:e.Flavors,Version:e.Version,PrototypeData:r}},read:function(e,t){var r=e.PrototypeData,n=e.Flavors;return this._deserializePrototypeObject(r,n,t)},_deserializePrototypeObject:function(t,n,i){var a,o=this,s=new r;return s.setFromArray(t.ID.split("/")),i._buildPrototypeFromParent(s,t.Prototype).then(function(e){return a=e,o._deserializeVariables(e,t.Variables,n,i)}).then(function(){return e.Promise.resolve(a)})},_deserializeVariables:function(t,r,n,i){for(var a=[],o=0;o<r.length;o++)a.push(this._deserializeVariable(t,r[o],n,i));return e.Promise.allSettled(a)},_deserializeVariable:function(t,r,n,i){var a,o=r.ID,s=r.Description;a=s?t._AddVariableSession(s.Name,s.VariableType,s.MaxSize,s.ValuationMode,s.RestrictedType,o):e.Promise.resolve();var c,l=this;return a.then(function(){if(t._HasVariableFromId(o))return c=t._GetVariableInfoFromId(o),l._getVariableValue(c,r.Value,n,i);console.warn("Prototype "+t.GetType()+" cant retrieve variable: "+o)}).then(function(e){return t._SetValueByNameSession(c.name,e)})},_getVariableValue:function(e,r,n,i){return e.type===t.VarType.Color?this._getColorValue(r):e.type===t.VarType.Object?this._getObjectValue(e,r,n,i):this._getDefaultValue(e,r)},_getDefaultValue:function(t,r){return r?1===t.maxNumberOfValues?e.Promise.resolve(r[0]):e.Promise.resolve(r):1===t.maxNumberOfValues?e.Promise.resolve(void 0):e.Promise.resolve([])},_getColorValue:function(t){return t?e.Promise.resolve((new n).FromRGBA(t[0],t[1],t[2],t[3])):e.Promise.resolve()},_getObjectValue:function(r,n,i,a){if(!n)return 0===r.maxNumberOfValues?e.Promise.resolve([]):e.Promise.resolve(void 0);if(r.valuationMode===t.ValuationMode.ReferencingValue)return console.warn("CAT3DXPrototypeJSONReaderV2_0 Referencing Variable not implemented"),e.Promise.resolve();for(var o=[],s=[],c=0;c<n.length;c++)o.push(this._deserializePrototypeObject(n[c],i,a).then(function(e){s.push(e)}));return e.Promise.allSettled(o).then(function(){return 1===r.maxNumberOfValues?s[0]:s})}}}),define("DS/CAT3DExpModel/CAT3DXPrototypeJSONReaderV1",["UWA/Core","DS/CAT3DExpModel/XCTExpVariable","DS/CAT3DExpModel/XCTExpPathOfIds","DS/VCXWebProperties/VCXColor"],function(e,t,r,n){"use strict";return{getPrototypeDefinitionFromPrototypeList:function(e,t){var r={},n=e[t];if(n)return r[t]=n,r;for(var i in e)if(e[i].Name===t)return r[i]=e[i],r},read:function(t,n){var i=Object.keys(t);if(1!==i.length)return e.Promise.reject(new Error("CAT3DXPrototypeJSONReaderV1 cant read this definition"));var a=i[0],o=new r;o.pushId(a);var s=t[a],c=this;return n._buildPrototypeFromParent(o,s.Prototype).then(function(t){return c._deserializeVariables(t,s),e.Promise.resolve(t)})},_deserializeVariables:function(e,t){var r=t.Variables;if(r)for(var n=0;n<r.length;n++)this._deserializeVariable(e,r[n])},_deserializeVariable:function(t,r){var n,i=r.Name;n=t.HasVariable(i)?e.Promise.resolve():t._AddVariableSession(i,r.VariableType,r.MaxSize,r.ValuationMode,r.RestrictedType,r.ID);var a=this;return n.then(function(){var n=t.GetVariableInfo(i),o=a._getVariableValue(n,r.Value),s=t.GetValueByName(i);if(e.is(o)){if(!(o===s||Array.isArray(o)&&Array.isArray(s)&&0===o.length&&0===s.length))return t._SetValueByNameSession(i,o);"true"===localStorage.getItem("EWS_Debug")&&console.log("description can be deleted : "+t.GetPathOfIds().toString()+" "+i)}})},_getVariableValue:function(e,r){var n=e.type;return n===t.VarType.Color?this._getColorValue(r):n===t.VarType.Object?this._getObjectValue(e,r):this._getDefaultValue(e,r)},_getDefaultValue:function(e,t){if(!t){if(1===e.maxNumberOfValues)return;return[]}return 1===e.maxNumberOfValues?t[0]:t},_getColorValue:function(e){if(e)return(new n).FromRGBA(e[0],e[1],e[2],e[3])},_getObjectValue:function(){}}}),define("DS/CAT3DExpModel/CAT3DXPrototypeJSONReader",["UWA/Core","DS/CAT3DExpModel/CAT3DXPrototypeJSONReaderV1","DS/CAT3DExpModel/CAT3DXPrototypeJSONReaderV2_0"],function(e,t,r){"use strict";return{_getPrototypeJSONReader:function(n){if(!n.Version)return t;switch(n.Version){case"2.0":return r;default:return e.Promise.reject("CAT3DXPrototypeJSONReader : Cant read this JSON Version : "+n.Version)}},read:function(e,t){return this._getPrototypeJSONReader(e).read(e,t)},getPrototypeDefinitionFromPrototypeList:function(e,t){return this._getPrototypeJSONReader(e).getPrototypeDefinitionFromPrototypeList(e,t)}}}),define("DS/CAT3DExpModel/CAT3DXModelFactory",["UWA/Core","UWA/Promise","DS/CAT3DExpModel/CAT3DXPrototypeJSONReader"],function(e,t,r){"use strict";return e.Class.extend({init:function(e){e=e||{},this._prototypes=e.prototypes?e.prototypes:{},this._expObjectsFilter=e.expObjectsFilter?e.expObjectsFilter:[]},_initialize:function(e,t,r){this._objectBuilder=e,this._expDataObjectMap=t,this._expCoreLinkManager=r},_dispose:function(){return delete this._objectBuilder,delete this._expDataObjectMap,delete this._expCoreLinkManager,e.Promise.resolve()},CreateExperience:function(e,r,n){return t.reject(new Error("CAT3DXModelFactory.CreateExperience: Must be implemented by derived class."+e+r+n))},GetExperiencePhysicalID:function(){return t.reject(new Error("CAT3DXModelFactory.GetExperiencePhysicalID: Must be implemented by derived class."))},LoadExperience:function(e,r){return t.reject(new Error("CAT3DXModelFactory.LoadExperience: Must be implemented by derived class."+e,r))},IsExperienceStarted:function(){return t.reject(new Error("CAT3DXModelFactory.IsExperienceStarted: Must be implemented by derived class."))},RetrieveExperienceFromServer:function(){return t.reject(new Error("CAT3DXModelFactory.RetrieveExperienceFromServer: Must be implemented by derived class."))},SaveExperience:function(){return t.reject(new Error("CAT3DXModelFactory.SaveExperience: Must be implemented by derived class."))},SaveExperienceAsNew:function(e){return t.reject(new Error("CAT3DXModelFactory.SaveExperienceAsNew: Must be implemented by derived class."+e))},CloseExperience:function(){return t.reject(new Error("CAT3DXModelFactory.CloseExperience: Must be implemented by derived class."))},_SetExperience:function(e){this._experience=e,this._expCoreLinkManager._removeExpCoreLinkContextShortcut("localExperience"),this._expCoreLinkManager._addExpCoreLinkContextShortcut("localExperience","ExpCoreLinkContextExpDataObject",e)},GetExperience:function(){return this._experience},CreateActor:function(e,r,n){return t.reject(new Error("CAT3DXModelFactory.CreateActor: Must be implemented by derived class."+e+r+n))},CreatePath:function(e,r,n,i,a){return t.reject(new Error("CAT3DXModelFactory.CreatePath: Must be implemented by derived class."+e,r,n,i,a))},DeleteActor:function(e){return t.reject(new Error("CAT3DXModelFactory.DeleteActor: Must be implemented by derived class."+e))},DeleteExperienceObjects:function(e){return t.reject(new Error("CAT3DXModelFactory.DeleteExperienceObjects: Must be implemented by derived class."+e))},InsertProduct:function(e,r,n,i){return t.reject(new Error("CAT3DXModelFactory.InsertProduct: Must be implemented by derived class."+e+r+n+i))},CreateBulkOverrides:function(e,r){return t.reject(new Error("CAT3DXModelFactory.InsertProduct: Must be implemented by derived class."+e+r))},CreateOverrideProduct:function(e,r,n){return t.reject(new Error("CAT3DXModelFactory.CreateOverrideProduct: Must be implemented by derived class."+e+r+n))},CreateOverridesProduct:function(e,r){return t.reject(new Error("CAT3DXModelFactory.CreateOverridesProduct: Must be implemented by derived class."+e+r))},CreateAllOverridesProduct:async function(e){return t.reject(new Error("CAT3DXModelFactory.CreateAllOverridesProduct: Must be implemented by derived class."+e))},DeleteOverride:function(e){return t.reject(new Error("CAT3DXModelFactory.DeleteOverride: Must be implemented by derived class."+e))},DeleteOverrides:function(e){return t.reject(new Error("CAT3DXModelFactory.DeleteOverrides: Must be implemented by derived class."+e))},DeleteAllOverrides:function(e){return t.reject(new Error("CAT3DXModelFactory.DeleteAllOverrides: Must be implemented by derived class."+e))},CheckAssetStatus:function(e,r,n){return t.reject(new Error("CAT3DXModelFactory.CheckAssetStatus: Must be implemented by derived class."+e+r+n))},UpdateProductAsset:function(e,r){return t.reject(new Error("CAT3DXModelFactory.UpdateProductAsset: Must be implemented by derived class."+e+r))},UpdateOverrideAsset:function(e,r){return t.reject(new Error("CAT3DXModelFactory.UpdateProductAsset: Must be implemented by derived class."+e+r))},CreateBehavior:function(e,r,n){return t.reject(new Error("CAT3DXModelFactory.CreateBehavior: Must be implemented by derived class."+e+r+n))},DeleteBehavior:function(e){return t.reject(new Error("CAT3DXModelFactory.DeleteBehavior: Must be implemented by derived class."+e))},CreateScenario:function(e){return t.reject(new Error("CAT3DXModelFactory.CreateScenario: Must be implemented by derived class."+e))},CreateAct:function(e,r){return t.reject(new Error("CAT3DXModelFactory.CreateAct: Must be implemented by derived class."+e+r))},CreateParagraph:function(e,r){return t.reject(new Error("CAT3DXModelFactory.CreateParagraph: Must be implemented by derived class."+e+r))},CreateSentence:function(e,r){return t.reject(new Error("CAT3DXModelFactory.CreateSentence: Must be implemented by derived class."+e+r))},CreateBlock:function(e,r,n){return t.reject(new Error("CAT3DXModelFactory.CreateBlock: Must be implemented by derived class."+e+r+n))},CreateBinaryResource:function(e,r,n){return t.reject(new Error("CAT3DXModelFactory.CreateBinaryResource: Must be implemented by derived class."+e+r+n))},UpdateBinaryResource:function(e,r,n){return t.reject(new Error("CAT3DXModelFactory.UpdateBinaryResource: Must be implemented by derived class."+e+r+n))},CreateURLResource:function(e,r){return t.reject(new Error("CAT3DXModelFactory.CreateURLResource: Must be implemented by derived class."+e+r))},UpdateURLResource:function(e,r){return t.reject(new Error("CAT3DXModelFactory.UpdateURLResource: Must be implemented by derived class."+e+r))},DeleteResource:function(e){return t.reject(new Error("CAT3DXModelFactory.DeleteResource: Must be implemented by derived class."+e))},InsertAmbience:function(e,r,n){return t.reject(new Error("CAT3DXModelFactory.InsertAmbience: Must be implemented by derived class."+e+r+n))},DeleteAmbience:function(e){return t.reject(new Error("CAT3DXModelFactory.DeleteAmbience: Must be implemented by derived class."+e))},InsertMaterial:function(e,r,n){return t.reject(new Error("CAT3DXModelFactory.InsertMaterial: Must be implemented by derived class."+e+r+n))},DeleteMaterial:function(e){return t.reject(new Error("CAT3DXModelFactory.DeleteMaterial: Must be implemented by derived class."+e))},ApplyMaterial:function(e,r){return t.reject(new Error("CAT3DXModelFactory.ApplyMaterial: Must be implemented by derived class."+e+r))},CreateUIButton:function(e){return t.reject(new Error("CAT3DXModelFactory.CreateUIButton: Must be implemented by derived class."+e))},CreateUIText:function(e){return t.reject(new Error("CAT3DXModelFactory.CreateUIText: Must be implemented by derived class."+e))},CreateUIImage:function(e){return t.reject(new Error("CAT3DXModelFactory.CreateUIImage: Must be implemented by derived class."+e))},CreateUITextField:function(e){return t.reject(new Error("CAT3DXModelFactory.CreateUITextField: Must be implemented by derived class."+e))},CreateUIColorPicker:function(e){return t.reject(new Error("CAT3DXModelFactory.CreateUIColorPicker: Must be implemented by derived class."+e))},CreateUISlider:function(e){return t.reject(new Error("CAT3DXModelFactory.CreateUISlider: Must be implemented by derived class."+e))},CreateUICameraViewer:function(e){return t.reject(new Error("CAT3DXModelFactory.CreateUICameraViewer: Must be implemented by derived class."+e))},CreateUIWebViewer:function(e){return t.reject(new Error("CAT3DXModelFactory.CreateUIWebViewer: Must be implemented by derived class."+e))},CreateUIGalleryMenu:function(e){return t.reject(new Error("CAT3DXModelFactory.CreateUIGalleryMenu: Must be implemented by derived class."+e))},CreateUIGalleryImage:function(e){return t.reject(new Error("CAT3DXModelFactory.CreateUIGalleryImage: Must be implemented by derived class."+e))},CreateUIGalleryProduct:function(e){return t.reject(new Error("CAT3DXModelFactory.CreateUIGalleryProduct: Must be implemented by derived class."+e))},CreateUIGalleryViewpoint:function(e){return t.reject(new Error("CAT3DXModelFactory.CreateUIGalleryViewpoint: Must be implemented by derived class."+e))},CreateGalleryItem:function(e,r){return t.reject(new Error("CAT3DXModelFactory.CreateGalleryItem: Must be implemented by derived class."+e+r))},_getPrototypeDefinition:function(t){if(this._expObjectsFilter.indexOf(t)>=0)return e.Promise.reject(new Error(t+" has been filtered"));var n=r.getPrototypeDefinitionFromPrototypeList(this._prototypes,t);return n?e.Promise.resolve(n):e.Promise.reject(new Error("Cant retrieve definition for : "+t))},CreateVariable:function(){return t.reject(new Error("CAT3DXModelFactory.CreateVariable: Must be implemented by derived class."))},SetVariableValues:function(e,r,n){return t.reject(new Error("CAT3DXModelFactory.SetVariableValues: Not implemented."+e+r+n))},SetVariablesValues:function(e){return t.reject(new Error("CAT3DXModelFactory.SetVariablesValues: Not implemented."+e))},ApplyState:async function(e,r){return t.reject(new Error("CAT3DXModelFactory.ApplyStates: Not implemented."+r+e))},SetVariablesValuesAuthoring:function(e){return t.reject(new Error("CAT3DXModelFactory.SetVariablesValues: Not implemented."+e))},SetVariablesDraftMode:function(e,r){return t.reject(new Error("CAT3DXModelFactory.SetVariablesValues: Not implemented."+r+e))},BakeVariables:function(e){return t.reject(new Error("CAT3DXModelFactory.SetVariablesValues: Not implemented."+e))},getPlatformId:function(){return t.reject(new Error("CAT3DXModelFactory.getPlatformId: Not implemented."))},getServerURL:function(){return t.reject(new Error("CAT3DXModelFactory.getServerURL: Not implemented."))},GetSecurityContext:function(){return t.reject(new Error("CAT3DXModelFactory.GetSecurityContext: Not implemented."))}})}),define("DS/CAT3DExpModel/loaders/CAT3DXAmbienceModelLoader",["UWA/Core","DS/CAT3DExpModel/loaders/CAT3DXLoader","DS/CAT3DExpModel/CAT3DXModel"],function(e,t,r){"use strict";return t.extend({loadLink:function(e,t){return r.InsertAmbience(null,t,e)}})}),define("DS/CAT3DExpModel/managers/CAT3DXLoaderManager",["UWA/Core","UWA/Class","UWA/Class/Promise","DS/CAT3DExpModel/loaders/CAT3DXExperienceLoader","DS/CAT3DExpModel/loaders/CAT3DXVPMReferenceLoader","DS/CAT3DExpModel/loaders/CAT3DXImageLoader","DS/CAT3DExpModel/loaders/CAT3DXAmbienceModelLoader","DS/CAT3DExpModel/loaders/CAT3DXCoveringMaterialLoader"],function(e,t,r,n,i,a,o,s){"use strict";return t.extend({Build:function(){this._loaders={CXPExperience_Spec:new n(this._experienceBase),Model_VPMReference_Spec:new i(this._experienceBase),CXPPictureResource_Spec:new a(this._experienceBase),AmbienceModel_Spec:new o(this._experienceBase),CXPCoveringMaterial_Spec:new s(this._experienceBase)}},registerLoader:function(e,t){this._loaders[e]=new t(this._experienceBase)},_getLoader:function(e){return this._loaders[e]},getLoadableTypes:function(t){var r=[],n=[];for(var i in this._loaders)this._loaders.hasOwnProperty(i)&&n.push(this._isLoadableType(t,i).then(function(e){r.push(e)}));return e.Promise.allSettled(n).then(function(){return r})},_isLoadableType:function(e,t){return e.getLinkDescriptionByType(t).then(function(){return t})},loadLink:function(e,t){return this._getLoaderAndLink(e,t,0).then(function(t){return t.loader.loadLink(t.link,e)})},_getLoaderAndLink:function(t,r,n){if(n>=r.length)return e.Promise.reject(new Error("No match between loader and links"));var i=r[n],a=this._getLoader(i);if(a){var o=this;return t.getLinkDescriptionByType(i).then(function(t){return e.Promise.resolve({loader:a,link:t})}).catch(function(){return o._getLoaderAndLink(t,r,n+1)})}return console.warn("No loader for : "+i),this._getLoaderAndLink(t,r,n+1)},readLink:function(t,r){return e.Promise.reject(new Error("DEPRECATED! use loadLink(iLinkContext, iTypesArray"+t+r))},GetType:function(){return"CAT3DXLoaderManager"}})}),define("DS/CAT3DExpModel/expCoreLink/ExpCoreLinkServiceVariable",["UWA/Core","UWA/Class","DS/CAT3DExpModel/expCoreLink/ExpCoreLinkService"],function(e,t,r){"use strict";return r.extend({_getChildLinkContextFromIdentifier:function(t,r){return e.Promise.resolve(this._createExpCoreLinkContext("ExpCoreLinkContextVariable",{parent:t._getContent(),id:r}))}})}),define("DS/CAT3DExpModel/XCTExpObjectBuilder",["UWA/Core","UWA/Class","DS/CAT3DExpModel/expCoreLink/ExpCoreLinkContextType","DS/CAT3DExpModel/expCoreLink/ExpCoreLinkContextExpDataObject","DS/CAT3DExpModel/expCoreLink/ExpCoreLinkContextVariable","DS/CAT3DExpModel/expCoreLink/ExpCoreLinkContext3DSpace","DS/CAT3DExpModel/expCoreLink/ExpCoreLinkContext3DSpaceVO","DS/CAT3DExpModel/expCoreLink/ExpCoreLinkContextString","DS/VIAIdeaExperienceScenarioModelWeb/expCoreLink/ExpCoreLinkContextVCXScenario","DS/CAT3DExpModel/expCoreLink/ExpCoreLinkContext3DSpaceStream","DS/CAT3DExpModel/expCoreLink/ExpCoreLinkServiceTypes","DS/CAT3DExpModel/expCoreLink/ExpCoreLinkServiceVariable","DS/CAT3DExpModel/expCoreLink/ExpCoreLinkServiceValue","DS/CAT3DExpModel/expCoreLink/ExpCoreLinkServiceRootExperiences","DS/CAT3DExpModel/expCoreLink/ExpCoreLinkService3DSpace","DS/CAT3DExpModel/expCoreLink/ExpCoreLinkService3DSpaceVO","DS/CAT3DExpModel/expCoreLink/ExpCoreLinkServiceString","DS/VIAIdeaExperienceScenarioModelWeb/expCoreLink/ExpCoreLinkServiceVCXScenario","DS/CAT3DExpModel/expCoreLink/ExpCoreLinkService3DSpaceStream"],function(e,t,r,n,i,a,o,s,c,l,u,p,d,f,h,_,C,x,b){"use strict";return e.Class.extend({init:function(){},_initialize:function(e,t,v){this._factory=e,this._expDataObjectMap=t,d._setDataObjectMap(t),f._setDataObjectMap(t),this._expCoreLinkManager=v,this._expCoreLinkManager._addExpCoreLinkContext("ExpCoreLinkContextType",r),this._expCoreLinkManager._addExpCoreLinkService("ExpCoreLinkServiceTypes",u),u._setObjectBuilder(this),this._expCoreLinkManager._addExpCoreLinkServiceRoot("Types","ExpCoreLinkServiceTypes"),this._expCoreLinkManager._addExpCoreLinkContext("ExpCoreLinkContextExpDataObject",n),this._expCoreLinkManager._addExpCoreLinkService("ExpCoreLinkServiceVariable",p),this._expCoreLinkManager._addExpCoreLinkContext("ExpCoreLinkContextVariable",i),this._expCoreLinkManager._addExpCoreLinkService("ExpCoreLinkServiceValue",d),this._expCoreLinkManager._addExpCoreLinkService("ExpCoreLinkServiceRootExperiences",f),this._expCoreLinkManager._addExpCoreLinkServiceRoot("Experiences","ExpCoreLinkServiceRootExperiences"),this._expCoreLinkManager._addExpCoreLinkContext("ExpCoreLinkContext3DSpace",a),this._expCoreLinkManager._addExpCoreLinkService("ExpCoreLinkService3DSpace",h),this._expCoreLinkManager._addExpCoreLinkServiceRoot("3DSpace","ExpCoreLinkService3DSpace"),this._expCoreLinkManager._addExpCoreLinkContext("ExpCoreLinkContext3DSpaceVO",o),this._expCoreLinkManager._addExpCoreLinkService("ExpCoreLinkService3DSpaceVO",_),this._expCoreLinkManager._addExpCoreLinkServiceRoot("3DSpaceVO","ExpCoreLinkService3DSpaceVO"),this._expCoreLinkManager._addExpCoreLinkContext("ExpCoreLinkContextString",s),this._expCoreLinkManager._addExpCoreLinkService("ExpCoreLinkServiceString",C),this._expCoreLinkManager._addExpCoreLinkServiceRoot("String","ExpCoreLinkServiceString"),this._expCoreLinkManager._addExpCoreLinkContext("ExpCoreLinkContextVCXScenario",c),this._expCoreLinkManager._addExpCoreLinkService("ExpCoreLinkServiceVCXScenario",x),this._expCoreLinkManager._addExpCoreLinkContext("ExpCoreLinkContext3DSpaceStream",l),this._expCoreLinkManager._addExpCoreLinkService("ExpCoreLinkService3DSpaceStream",b)},_dispose:function(){delete this._factory,delete this._expObjectMap,this._expCoreLinkManager._removeExpCoreLinkContext("ExpCoreLinkContextType"),this._expCoreLinkManager._removeExpCoreLinkService("ExpCoreLinkServiceTypes"),u._removeObjectBuilder(),this._expCoreLinkManager._removeExpCoreLinkServiceRoot("Types"),this._expCoreLinkManager._removeExpCoreLinkContext("ExpCoreLinkContextExpDataObject"),this._expCoreLinkManager._removeExpCoreLinkService("ExpCoreLinkServiceVariable"),this._expCoreLinkManager._removeExpCoreLinkContext("ExpCoreLinkContextVariable"),d._removeDataObjectMap(),this._expCoreLinkManager._removeExpCoreLinkService("ExpCoreLinkServiceValue"),f._removeDataObjectMap(),this._expCoreLinkManager._removeExpCoreLinkService("ExpCoreLinkServiceRootExperiences"),this._expCoreLinkManager._removeExpCoreLinkServiceRoot("Experiences"),this._expCoreLinkManager._removeExpCoreLinkContext("ExpCoreLinkContext3DSpace"),this._expCoreLinkManager._removeExpCoreLinkService("ExpCoreLinkService3DSpace"),this._expCoreLinkManager._removeExpCoreLinkServiceRoot("3DSpace"),this._expCoreLinkManager._removeExpCoreLinkContext("ExpCoreLinkContext3DSpaceVO"),this._expCoreLinkManager._removeExpCoreLinkService("ExpCoreLinkContext3DSpaceVO"),this._expCoreLinkManager._removeExpCoreLinkServiceRoot("3DSpaceVO"),this._expCoreLinkManager._removeExpCoreLinkContext("ExpCoreLinkContextString"),this._expCoreLinkManager._removeExpCoreLinkService("ExpCoreLinkServiceString"),this._expCoreLinkManager._removeExpCoreLinkServiceRoot("String"),this._expCoreLinkManager._removeExpCoreLinkContext("ExpCoreLinkContextVCXScenario"),this._expCoreLinkManager._removeExpCoreLinkService("ExpCoreLinkServiceVCXScenario"),this._expCoreLinkManager._removeExpCoreLinkContext("ExpCoreLinkContext3DSpaceStream"),this._expCoreLinkManager._removeExpCoreLinkService("ExpCoreLinkService3DSpaceStream"),delete this._expCoreLinkManager},_createObject:function(t,r){var n=this;return this._createObjectInternal(t,r).then(function(e){return n._expDataObjectMap._addExpDataObject(r,e),e}).catch(function(t){return n._expDataObjectMap._removeExpDataObject(r),e.Promise.reject(t)})},_createVirtualObject:function(t,r){var n=this;return this._createVirtualObjectInternal(t,r).then(function(e){return n._expDataObjectMap._addExpDataObject(r,e),e}).catch(function(t){return n._expDataObjectMap._removeExpDataObject(r),e.Promise.reject(t)})},_removeObject:function(t){return this._expDataObjectMap._removeExpDataObject(t.GetPathOfIds()),e.Promise.resolve()},_getDataFromExpObject:function(){console.error(new Error("XCTExpObjectBuilder._getDataFromExpObject: Must be implemented by derived class."))},_getExpObjectFromData:function(){console.error(new Error("XCTExpObjectBuilder._getExpObjectFromData: Must be implemented by derived class."))}})}),define("DS/CAT3DExpModel/XCTExpDataObjectBuilder",["UWA/Core","DS/CAT3DExpModel/XCTExpObjectBuilder","DS/CAT3DExpModel/XCTExpDataObject","DS/CAT3DExpModel/XCTExpVariable","DS/CAT3DExpModel/CAT3DXPrototypeJSONReader"],function(e,t,r,n,i){"use strict";return t.extend({init:function(e){this._prototypesObjects={},this._buildPrototypeObjectPromises={},r._SetObjectBuilder(this),this._parent(e)},_dispose:function(){delete this._objectPrototypes,delete this._objectPrototypesPromises,r._RemoveObjectBuilder(),this._parent()},_removeObject:function(t){var r=t.GetParent(),i=[];if(r){var a=t.GetParentVariable(),o=r.GetValueByName(a);if(Array.isArray(o)){var s=o.indexOf(t);o.splice(s,1),i.push(r._SetValueByNameSession(a,o))}else i.push(r._SetValueByNameSession(a,void 0))}var c=[];t.ListVariables(c,n.VarType.Object);for(var l=0;l<c.length;l++)if(t.GetVariableValuationMode(c[l])===n.ValuationMode.AggregatingValue){var u=t.GetValueByName(c[l]);if(Array.isArray(u))for(var p=u.length-1;p>=0;p--)i.push(this._removeObject(u[p]));else e.is(u)&&i.push(this._removeObject(u))}var d=this,f=this._parent;return e.Promise.all(i).then(function(){return f.call(d,t)}).then(function(){t.Dispose()})},_getDataFromExpObject:function(e){return e},_getExpObjectFromData:function(e){return e},_getBaseImplForExpDataObject:function(){return r},_createObjectInternal:function(e,t){return e.startsWith("ExpCore://")||(e="ExpCore://Types/"+e),this._expCoreLinkManager.resolveLink(e).then(function(e){return e._CreateChildExpObject(t)}).then(function(e){return e})},_createVirtualObjectInternal:function(e,t){return e._CreateChildVirtualExpObject(t)},_getPrototypeObject:function(t){if(this._prototypesObjects[t])return e.Promise.resolve(this._prototypesObjects[t]);if(this._buildPrototypeObjectPromises[t])return this._buildPrototypeObjectPromises[t];var r=this;return this._buildPrototypeObjectPromises[t]=this._factory._getPrototypeDefinition(t).then(function(e){return i.read(e,r)}).then(function(e){return r._prototypesObjects[t]=e,delete r._buildPrototypeObjectPromises[t],e}).catch(function(n){return delete r._buildPrototypeObjectPromises[t],e.Promise.reject(n)}),this._buildPrototypeObjectPromises[t]},_buildPrototypeFromParent:function(t,r){if(r)return r.startsWith("ExpCore://")||(r="ExpCore://Types/"+r),this._expCoreLinkManager.resolveLink(r).then(function(e){return e._CreateChildPrototypeObject(t,!1)});var n=this._getBaseImplForExpDataObject();return e.Promise.resolve(n._CreateChildPrototypeObject(t,!0))}})}),define("DS/CAT3DExpModel/XCTEWSData",["UWA/Core","UWA/Class","DS/CAT3DExpModel/XCTEWS","DS/CAT3DExpModel/XCTExpDataObjectBuilder","DS/CAT3DExpModel/CAT3DXModel"],function(e,t,r,n,i){"use strict";return r.extend({initialize:function(t){var r=t.factory;if(!r)return e.Promise.reject(new Error("EWS Initialization failed : factory parameter is mandatory"));var a=new n;return i._initialize(r,a)},dispose:function(){return i._dispose()}})}),define("DS/CAT3DExpModel/XCTExpOmObjectBuilder",["UWA/Core","DS/CAT3DExpModel/XCTExpDataObjectOM","DS/CAT3DExpModel/XCTExpDataObjectBuilder","DS/CAT3DExpModel/interfaces/CATI3DExperienceObject","DS/CAT3DExpModel/extensions/CATE3DExperienceObjectVolatile","DS/CAT3DExpModel/XCTExpPathOfIds"],function(e,t,r,n,i,a){"use strict";return r.extend({init:function(e){this._parent(e),this._experienceBase=e.experienceBase,this._ewsDictionary=e.ewsDictionary,this._volatilesObjects={},this._volatilesObjectsDeferred={}},_dispose:function(){delete this._experienceBase,delete this._ewsDictionary,delete this._volatilesObjects,delete this._volatilesObjectsDeferred,this._parent()},_createObjectInternal:function(e,t){var r,n=this;return this._parent(e,t).then(function(e){return r=e,n._ewsDictionary._buildComponent(e.GetType(),e.GetTypes(),e.GetPathOfIds().toString())}).then(function(e){return n._experienceBase.ComponentsMap.AddComponent(e),e.QueryInterface("CATI3DExperienceObject")._SetExpDataObject(r),r._SetObjectModelerComponent(e),r})},_createVirtualObjectInternal:function(e,t){var r,n=this;return this._parent(e,t).then(function(e){return r=e,n._ewsDictionary._buildComponent(e.GetType(),e.GetTypes(),e.GetPathOfIds().toString())}).then(function(e){return n._experienceBase.ComponentsMap.AddComponent(e),e.QueryInterface("CATI3DExperienceObject")._SetExpDataObject(r),r._SetObjectModelerComponent(e),r})},_getBaseImplForExpDataObject:function(){return t},_removeObject:function(e){var t=e._GetObjectModelerComponent();return this._experienceBase.ComponentsMap.RemoveComponent(t.GetID()),t.CallDispose(),this._parent(e)},_getDataFromExpObject:function(e){if(e)return e.QueryInterface("CATI3DExperienceObject")._GetExpDataObject()},_getExpObjectFromData:function(e){if(e)return e._GetObjectModelerComponent()},_createVolatileComponentFromPrototype:function(t,r,n,a,o){var s,c,l,u=this,p=n.QueryInterface("CATI3DExperienceObject");return p.IsVolatile()||console.error("Parent should be in volatile mode"),this._getPrototypeObject(t).then(function(t){s=t;var r=t.GetTypes(),n=t.GetPathOfIds().toString();return r.push(n),(c=p._GetVariablePathOfIds(a)).pushId(e.Utils.getUUID()),l=c.toString(),u._ewsDictionary._buildComponent(n,r,l)}).then(function(e){u._volatilesObjects[l]=e,u._volatilesObjectsDeferred[l]&&(u._volatilesObjectsDeferred[l].resolve(),delete u._volatilesObjectsDeferred[l]);var d=u._ewsDictionary._ewsExtensionServer.GetExtension(t,"CATI3DExperienceObject");u._ewsDictionary._ewsExtensionServer._extensionTable[t].CATI3DExperienceObject=i;var f=e.QueryInterface("CATI3DExperienceObject");f._SetExpDataObject(s),f._SetPathOfIds(c),f.SetValueByName("_varName",r),f._SetParent(n,a),u._ewsDictionary._ewsExtensionServer._extensionTable[t].CATI3DExperienceObject=d;var h=p.GetValueByName(a);return 1===p.GetVariableMaxNumberOfValues(a)?h=e:(h=!h||o?[]:h.slice()).push(e),p.SetValueByName(a,h),e})},_createVolatileComponentFromTemplate:function(t,r,a,o,s){var c=t.GetType(),l=this._experienceBase.Factory.BuildComponent(c);if(!l)return e.Promise.reject();var u=a.QueryInterface("CATI3DExperienceObject");u.IsVolatile()||console.error("Parent should be in volatile mode");var p=u._GetVariablePathOfIds(o),d=t.QueryInterface("CATI3DExperienceObject").GetPathOfIds();p.pushId(d.popId());var f=p.toString();this._volatilesObjects[f]&&(p.popId(),p.pushId(e.Utils.getUUID()),f=p.toString()),l.SetID(f),this._volatilesObjects[f]=l,this._volatilesObjectsDeferred[f]&&(this._volatilesObjectsDeferred[f].resolve(),delete this._volatilesObjectsDeferred[f]);var h=this._ewsDictionary._ewsExtensionServer.GetExtension(c,"CATI3DExperienceObject");this._ewsDictionary._ewsExtensionServer._extensionTable[c].CATI3DExperienceObject=i;var _=t.QueryInterface("CATI3DExperienceObject")._GetExpDataObject(),C=l.QueryInterface("CATI3DExperienceObject");C._SetExpDataObject(_),C._SetPathOfIds(p),C.SetValueByName("_varName",r),C._SetParent(a,o),this._ewsDictionary._ewsExtensionServer._extensionTable[c].CATI3DExperienceObject=h;var x=t.QueryInterface("CATI3DExperienceObject"),b=[];x.ListVariables(b,n.VarType.Object);for(var v=0;v<b.length;v++)if(x.GetVariableValuationMode(b[v])===n.ValuationMode.AggregatingValue){var m=x.GetValueByName(b[v]);if(m)if(Array.isArray(m))for(var D=0;D<m.length;D++)this._createVolatileComponentFromTemplate(m[D],m[D].QueryInterface("CATI3DExperienceObject").GetValueByName("_varName"),l,b[v]);else this._createVolatileComponentFromTemplate(m,m.QueryInterface("CATI3DExperienceObject").GetValueByName("_varName"),l,b[v])}else this._updateVolatileObjectsFromReferencingVariable(t,l,b[v]);var E=u.GetValueByName(o);return 1===u.GetVariableMaxNumberOfValues(o)?E=l:(E=!E||s?[]:E.slice()).push(l),u.SetValueByName(o,E),l},_updateVolatileObjectsFromReferencingVariable:function(t,r,n){var i=t.QueryInterface("CATI3DExperienceObject").GetValueByName(n);if(i)if(Array.isArray(i))console.log("Not implemented");else{var o,s=i.QueryInterface("CATI3DExperienceObject").GetPathOfIds().toArray(),c=t.QueryInterface("CATI3DExperienceObject").GetPathOfIds().toArray();for(o=0;o<s.length&&(s[o]&&c[o]&&s[o]===c[o]);o++);var l=s.splice(o,s.length-o),u=r.QueryInterface("CATI3DExperienceObject").GetPathOfIds().toArray();u.splice(o,u.length-o);var p=new a;p.setFromArray(u.concat(l));var d=p.toString(),f=this._expDataObjectMap._getExpDataObject(p);if(f)return void r.QueryInterface("CATI3DExperienceObject").SetValueByName(n,this._getExpObjectFromData(f));if(this._volatilesObjects[d])return void r.QueryInterface("CATI3DExperienceObject").SetValueByName(n,this._volatilesObjects[d]);this._volatilesObjectsDeferred[d]||(this._volatilesObjectsDeferred[d]=e.Promise.deferred()),this._volatilesObjectsDeferred[d].promise.then(function(e){r.QueryInterface("CATI3DExperienceObject").SetValueByName(n,e)})}},_removeVolatileComponent:function(t){var r,i=t.QueryInterface("CATI3DExperienceObject"),a=i.GetParent();if(a){var o=a.QueryInterface("CATI3DExperienceObject");if(o.IsVolatile()){var s=i.GetParentVariable(),c=o.GetValueByName(s);if(Array.isArray(c)){var l=c.indexOf(t);c.splice(l,1),o.SetValueByName(s,c)}else o.SetValueByName(s,void 0)}else console.error("Parent should be in volatile mode")}r=[],i.ListVariables(r,n.VarType.Object);for(var u=0;u<r.length;u++)if(i.GetVariableValuationMode(r[u])===n.ValuationMode.AggregatingValue){var p=i.GetValueByName(r[u]);if(Array.isArray(p))for(var d=p.length-1;d>=0;d--)this._removeVolatileComponent(p[d]);else e.is(p)&&this._removeVolatileComponent(p)}var f=i.GetPathOfIds();t.CallDispose(),delete this._volatilesObjects[f.toString()]},_removeVolatilesObjects:function(){for(var e in this._volatilesObjects)this._volatilesObjects.hasOwnProperty(e)&&(this._volatilesObjects[e].CallDispose(),delete this._volatilesObjects[e])}})}),define("DS/CAT3DExpModel/XCTEWSObjectModeler",["UWA/Core","UWA/Class","DS/CAT3DExpModel/XCTEWS","DS/CAT3DExpModel/XCTEWSObjectModelerAsyncDictionary","DS/CAT3DExpModel/XCTExpOmObjectBuilder","DS/CAT3DExpModel/CAT3DXModel"],function(e,t,r,n,i,a){"use strict";return r.extend({initialize:function(t){if(this._experienceBase=t.experienceBase,!this._experienceBase)return e.Promise.reject(new Error("EWS Initialization failed : experienceBase parameter is mandatory"));var r=t.factory;if(!r)return e.Promise.reject(new Error("EWS Initialization failed : factory parameter is mandatory"));var o=t.interfacesTable?t.interfacesTable:{},s=t.componentsTable?t.componentsTable:{},c=t.managersTable?t.managersTable:{};this._ewsDictionary=new n({experienceBase:this._experienceBase,interfacesTable:o,componentsTable:s,managersTable:c});var l=new i({experienceBase:this._experienceBase,ewsDictionary:this._ewsDictionary});return this._loadManagers(c).then(function(){return a._initialize(r,l)})},dispose:function(){var e=this;return a._dispose().then(function(){return e._unloadManagers()}).then(function(){e._ewsDictionary._dispose(),delete e._ewsDictionary,delete e._experienceBase})},_loadManagers:function(e){var t=this,r=!1;return this._experienceBase.webApplication.runloop&&this._experienceBase.webApplication.runloop.running&&(this._experienceBase.webApplication.runloop.stop(),r=!0),this._buildManagers(e).then(function(e){return t._w3aiManagersByInitPhaseArray=e,t._iterateOnManagersFunctionAsync("initialize")}).then(function(){return t._iterateOnManagersFunctionAsync("postInitialize")}).then(function(){r&&t._experienceBase.webApplication.runloop&&t._experienceBase.webApplication.runloop.start()})},_buildManagers:function(t){var r={},n=[],i=this;for(var a in t)t.hasOwnProperty(a)&&n.push(this._ewsDictionary._buildManager(a).then(function(e){i._experienceBase._ManagerSet.addManager(e.GetID(),e);let t=e.QueryInterface("W3AIManager");var n=t.getInitPhase();r[n]?r[n].push(t):r[n]=[t]}));return e.Promise.all(n).then(function(){var e=[];for(var t in r)r.hasOwnProperty(t)&&(r[t].sort(function(e,t){return e.getUpdatePriority()>t.getUpdatePriority()?1:e.getUpdatePriority()<t.getUpdatePriority()?-1:0}),e.push(r[t]));return e})},_unloadManagers:function(){var e=!1;this._experienceBase.webApplication.runloop&&this._experienceBase.webApplication.runloop.running&&(this._experienceBase.webApplication.runloop.stop(),e=!0);var t=this;return this._iterateOnManagersFunctionAsync("unInitialize",!0).then(function(){for(var r=0;r<t._w3aiManagersByInitPhaseArray.length;r++)for(var n=t._w3aiManagersByInitPhaseArray[r],i=0;i<n.length;i++){n[i].unInitialize=function(){},t._experienceBase._ManagerSet.removeManager(n[i].GetObject().GetID()),n[i].GetObject().CallDispose()}e&&t._experienceBase.webApplication.runloop&&t._experienceBase.webApplication.runloop.start()})},_iterateOnManagersFunctionAsync:function(t,r){return this._w3aiManagersByInitPhaseArray?this._iterateOnManagersFunction(t,r,r?this._w3aiManagersByInitPhaseArray.length-1:0):e.Promise.resolve()},_iterateOnManagersFunction:function(t,r,n){if(!this._w3aiManagersByInitPhaseArray[n])return e.Promise.resolve();var i=[],a=this._w3aiManagersByInitPhaseArray[n];if(r)for(let r=a.length-1;r>=0;r--){a[r][t]()||i.push(e.Promise.resolve())}else for(let r=0;r<a.length;r++){a[r][t]()||i.push(e.Promise.resolve())}var o=this;return e.Promise.all(i).then(function(){return o._iterateOnManagersFunction(t,r,r?n-1:n+1)})}})});