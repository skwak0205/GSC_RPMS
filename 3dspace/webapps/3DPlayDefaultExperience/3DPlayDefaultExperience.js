/*!  COPYRIGHT DASSAULT SYSTEMES 2015   */
define("DS/WebViewer/SceneGraphHelper",["UWA/Class","DS/Visualization/PathElement"],function(e,t){return e.extend({dispose:function(){this.name=null,this.SceneGraphOverrideSet=null},init:function(e,i){this.name=i,this.SceneGraphOverrideSet=e},getSceneGraphOverride:function(e,i,t){var n,a=!1,o=!0;return 1==i&&(a=!0),0==t&&(o=!1),1==o&&(n=this.SceneGraphOverrideSet.getUniqueOverrideFromPathElement(e)),n||(n=this.SceneGraphOverrideSet.createOverride({pathes:e,propagateToChildren:a})),n},setPosition:function(e,i){var t=this.getSceneGraphOverride(e);t&&t.setPosition(i)},getPosition:function(e){var i=this.getSceneGraphOverride(e);return i?i.getPosition():null},setOpacity:function(e,i,t){var n=this.getSceneGraphOverride(e);n&&n.setOpacity(i,t)},getOpacity:function(e){var i=this.getSceneGraphOverride(e);return i?i.getOpacity():null},setVisibility:function(e,i,t){var n=this.getSceneGraphOverride(e);n&&n.setVisibility(i,t)},setVisibilityOnRoot:function(e,i){var t=this.getSceneGraphOverride(e,!0);t&&t.setVisibility(i)},setPickabilityOnRoot:function(e,i){var t=this.getSceneGraphOverride(e,!0);t&&t.setPickability(i)},setOpacityOnRoot:function(e,i,t){var n=this.getSceneGraphOverride(e,!1,!1);n&&n.setOpacity(i,t)},getVisibility:function(e){var i=this.getSceneGraphOverride(e);return i?i.getVisibility():null},setPickability:function(e,i,t){var n=this.getSceneGraphOverride(e);n&&n.setPickability(i,t)},getPickability:function(e){var i=this.getSceneGraphOverride(e);return i?i.getPickability():null},getOverridesFromPathElement:function(e){return this.SceneGraphOverrideSet.getOverridesTargetingNode(e)},deleteOverridesFromPathElement:function(e){this.SceneGraphOverrideSet.deleteOverrides(this.SceneGraphOverrideSet.getOverridesTargetingNode(e))},deleteOverrides:function(e){this.SceneGraphOverrideSet.deleteOverrides(e)},deleteOverride:function(e){this.SceneGraphOverrideSet.deleteOverride(e)},createAndModifyConcatinatedOverrides:function(e,i){var n;if(e.externalPath){for(var a=[],o=0;o<e.externalPath.length;o++){for(var r=new t,s=0;s<=o;s++)r.addElement(e.externalPath[s]);a.push(r)}n=this.SceneGraphOverrideSet.createOverride({pathes:a}),1==i?n.setPickability("PICKABLE"):n.setVisibility(!0)}return n},getConcatinatedOverride:function(e,t){var n;if(e.externalPath){var a=e.externalPath.length,o=e.getKey(),r=this.getOverridesFromPathElement(t);for(i=0;i<r.length;i++)if(override=r[i],override._pathes.length==a){for(j=0;j<override._pathes.length;j++){if(o===override._pathes[j].getKey()){n=override;break}}if(n)break}}return n},getRootsAndConcatinatedPaths:function(e){var n=null,a=null,o=[],r=this.getOverridesFromPathElement(e),s=function(e){var i=new t;return i.addElement(e),e.children&&e.children.length>0&&i.addElement(e.children[0]),i}(e).getKey(),l=-1,c=-1;for(i=0;i<r.length;i++){if(override=r[i],1==override._pathes.length){var d=override._pathes[0].getKey();d===s&&override._propagationMode>0&&!n?(n=override,l=i):d===s&&override._propagationMode<=0&&!a&&.2==override.getOpacity()&&(a=override,c=i)}c!=i&&l!=i&&o.push(override)}return{mainroot:n,opaqueroot:a,concatinated:o}}})}),define("DS/3DPlayNavigationScenario/NavigationService",["UWA/Class","DS/Visualization/ThreeJS_DS","DS/VisuEvents/EventsManager","DS/Visualization/PathElement","DS/WebUtils/Clock","DS/WebInfraUI/Joystick","DS/WebRunloop/Runloop","DS/3DPlay/3DPlay","DS/WebSystem/Nls","DS/WebInfraUI/Notification","DS/3DPlayAnnotation3D/AnnotationUtils","DS/3DPlayAnnotationUtils/ShapeUtils","DS/Core/PointerEvents","DS/ApplicationFrame/CommandsManager","DS/WebUtils/Tracker"],function(e,i,t,n,a,o,r,s,l,c,d,h,u,g,m){"use strict";var p,v=Math.PI;return e.extend({init:function(e){p=this,this._parent(e),this.sensitivity=10,this.defaultDelta=.01,this.speedSliderCB=e.speedSliderCB,this.frameWindow=e.frameWindow,this.setSelectionCallBack=e.setSelectionCallBack,this.ctx=this.frameWindow.options.context,void 0===t._isInit&&t.init(),this._position={x:0,y:0},this._picking={},this._prePicking={},this.setNavigationStates(),this.createReframe(),this.hideReframe(),this._setBBox(),this.upAttribute="y"==this.frameWindow.getViewer()._worldOrientation.upAttribute},_setBBox:function(){this.frameWindow.experience?this.bBox=this.frameWindow.experience.getRootBag().bBox:this.bBox=this.frameWindow._3dViewer.getRootNode().bBox},getBbox:function(){return this.bBox||this._setBBox(),this.bBox},setNavigationStates:function(){this._navigationState={pause:!1,pitch_up:!1,pitch_down:!1,yaw_right:!1,yaw_left:!1,roll_left:!1,roll_right:!1,move_forward_keyboard:!1,move_backward_keyboard:!1,move_forward_mouse:!1,move_backward_mouse:!1,move_forward_touch:!1,move_backward_touch:!1,speed:50},this.touchModeActive=!1},runloopCallBack:function(){!1===this.TOUCH_JOYSTICKS_ACTIVE&&this.clock&&!0===this.navigate&&!0===this.mouseMove&&this.update(this.clock.getDelta()),!0===this.KEYBOARD_ACTIVE&&this.updatePostionFromKeybdEvent()},updatePostionFromMouseEvent:function(e){if(!this._webGLV6Viewer||!e)return!1;if(!1===this.TOUCH_JOYSTICKS_ACTIVE&&this.navigate){var i=this._webGLV6Viewer.getMousePosition(e.from[0].getCurrentPosition());this._position.x=i.x,this._position.y=i.y}},updatePostionFromTouchEvent:function(e,t){if(!0===this.TOUCH_JOYSTICKS_ACTIVE){var n=this._webGLV6Viewer.getMousePosition(new i.Vector2(e.x,e.y));this._position.x=n.x,this._position.y=n.y,this.update(0,!0,t)}},updatePostionFromKeybdEvent:function(){console.log("updatePostionFromKeybdEvent");if(this._navigationState.roll_left||this._navigationState.roll_right)this.joystickLinearMoveLeftRight(50);else{var e={};e.x=p._webGLV6Viewer.SCREEN_WIDTH/2,e.y=p._webGLV6Viewer.SCREEN_HEIGHT/2,this._navigationState.move_forward_keyboard||this._navigationState.move_backward_keyboard||(console.log("IJKL pressed"),this._navigationState.pitch_up?e.y=e.y-100*p._webGLV6Viewer.SCREEN_HEIGHT/500:this._navigationState.pitch_down?e.y=e.y+100*p._webGLV6Viewer.SCREEN_HEIGHT/500:this._navigationState.yaw_left?e.x=e.x-100*p._webGLV6Viewer.SCREEN_WIDTH/500:this._navigationState.yaw_right&&(e.x=e.x+100*p._webGLV6Viewer.SCREEN_WIDTH/500));var t=this._webGLV6Viewer.getMousePosition(new i.Vector2(e.x,e.y));this._position.x=t.x,this._position.y=t.y,this.update(0,!0,50)}},update:function(e,t,n){var a=this._currentViewpoint.getUpDirection(),o=this._currentViewpoint.getSightDirection(),r=this._currentViewpoint.getTargetDistance(),s=(this._currentViewpoint.getTarget(),this._currentViewpoint.getEyePosition()),l=t?this.defaultDelta:80*e/100;this.isInsideBboxLimits()&&this.tranlationSpeed||(this.tranlationSpeed=s.distanceTo(this._originalTarget)/180);var c=this.tranlationSpeed?this.tranlationSpeed:1;this._navigationState.speed&&(c=this.tranlationSpeed*(this._navigationState.speed/100),l*=this._navigationState.speed/100),c<0&&(c=1),n&&(c*=n/12);var d=new i.Vector3(0,0,0);d.crossVectors(a,o),this.upAttribute?d.y=0:d.z=0;var h=v/2*l*this._position.x,u=v/2*l*this._position.y;if(h=-h,u=-u,"Walk"===this.NAVIGATION_MODE&&(u=0),o.applyAxisAngle(a,h),d.applyAxisAngle(a,h),this.upAttribute?d.y=0:d.z=0,o.applyAxisAngle(d,u),!0===this._navigationState.move_forward_mouse||!0===this._navigationState.move_backward_mouse||!0===this._navigationState.move_forward_touch||!0===this._navigationState.move_backward_touch||!0===this._navigationState.move_forward_keyboard||!0===this._navigationState.move_backward_keyboard){var g=new i.Vector3(0,0,0);g.z=c,(this._navigationState.move_forward_mouse||this._navigationState.move_forward_touch||!0===this._navigationState.move_forward_keyboard)&&(g.z=-g.z);var m=this._currentViewpoint.camera.matrixWorld;s=g.applyMatrix4(m)}var p;this.upAttribute?d.y=0:d.z=0,a.crossVectors(o,d),null!=e&&0!=e||(e=this.defaultDelta/this.sensitivity),p={upDirection:a,eyePosition:s,sightDirection:o,distanceToTarget:r,duration:e},this._currentViewpoint.moveTo(p),this.checkLookAt()},checkLookAt:function(){var e=this.frameWindow.getViewer();this.frameWindow.experience?this.bSphere=this.frameWindow.experience.getRootBag().bSphere:this.bSphere=this.frameWindow._3dViewer.getRootNode().bSphere;var i=h.onScreenProjection([this.bSphere.center],e);this.bBox||(this.bBox=this.getBbox());h.onScreenProjection(this.bBox.getPoints(),e);this.bBoxViewerFrame=this.frameWindow.getViewerFrame().getBoundingClientRect();this._currentViewpoint.getEyePosition();var t=!1,n={x:50,y:50,angle:0};this.bBoxViewerFrame.left<i[0].x&&i[0].x<this.bBoxViewerFrame.right&&this.bBoxViewerFrame.top<i[0].y&&i[0].y<this.bBoxViewerFrame.bottom&&(t=!0,n.x=i[0].x%this.bBoxViewerFrame.bottom,n.y=i[0].y%this.bBoxViewerFrame.bottom);var a=this.bSphere.center.addScalar(this.bSphere.radius),o=h.onScreenProjection([a],e);Math.sqrt((o[0].x-i[0].x)*(o[0].x-i[0].x)+(o[0].y-i[0].y)*(o[0].y-i[0].y))/this.bBoxViewerFrame.width<.025&&(t=!1),p.isInsideBboxLimits()&&(t=!0),t?this.hideReframe():(this.bBoxViewerFrame.left<=i[0].x&&i[0].x<=this.bBoxViewerFrame.right?n.x=i[0].x:i[0].x<this.bBoxViewerFrame.left?(n.x=this.bBoxViewerFrame.left+64,n.angle=90):this.bBoxViewerFrame.right<i[0].x&&(n.x=this.bBoxViewerFrame.right-64,n.angle=-90),this.bBoxViewerFrame.top<=i[0].y&&i[0].y<=this.bBoxViewerFrame.bottom?n.y=i[0].y:i[0].y<this.bBoxViewerFrame.top?(n.y=this.bBoxViewerFrame.top+64,n.angle=180):this.bBoxViewerFrame.bottom<i[0].y&&(n.y=this.bBoxViewerFrame.bottom-64,n.angle=0),this.showReframe(n))},isInsideBboxLimits:function(){this.bBox||(this.bBox=this.getBbox());var e=this._currentViewpoint.getEyePosition(),i=this.bBox.max.x-this.bBox.min.x,t=this.bBox.max.x+.05*i,n=this.bBox.min.x-.05*i,a=this.bBox.max.y-this.bBox.min.y,o=this.bBox.max.y+.05*a,r=this.bBox.min.y-.05*a,s=this.bBox.max.z-this.bBox.min.z,l=this.bBox.max.z+.05*s,c=this.bBox.min.z-.05*s;return n<e.x&&e.x<t&&r<e.y&&e.y<o&&c<e.z&&e.z<l},updateHeight:function(){this._currentViewpoint.getUpDirection(),this._currentViewpoint.getSightDirection();var e=this._currentViewpoint.getTargetDistance(),t=(this._currentViewpoint.getTarget(),this._currentViewpoint.getEyePosition()),n=this._heightConstraint;new i.Vector3(0,0,0).y=n-this._previousHeight,n-this._previousHeight!=0&&(t.setZ(t.z+(n-this._previousHeight)*(e/250)),this._previousHeight=n,this._currentViewpoint.moveTo({eyePosition:t}),p.checkLookAt())},beginNavigation:function(e){this._viewerFrame=this.frameWindow.getViewerFrame(),this._webGLV6Viewer=this.frameWindow.getViewer(),this._currentViewpoint=this._webGLV6Viewer.currentViewpoint,this._originalTarget||(this._originalTarget=this._currentViewpoint.getTarget()),this._currentViewpoint.setControlActive(!1),this.setPickingForNavigation(),this.frameWindow.experience&&this.frameWindow.experience.hideRefAxis(),this.NAVIGATION_MODE="Fly",this.TOUCH_JOYSTICKS_ACTIVE=!1,this.KEYBOARD_ACTIVE=!1,this._heightConstraint=0,this._previousHeight=0,this.setKeybdEventsMap(),this.runloop=new r({name:"flyWalkNavigation",data:this,func:this.runloopCallBack}),this.clock=new a,this.runloop.start(),this._currentViewpoint.onCenterCamera(function(){}),this.touchMode=e.touchMode,!0===e.touchMode?this.beginTouchModeNavigation():this.beginMouseModeNavigation()},setPickingForNavigation:function(){this._webGLV6Viewer.picking&&(this._picking.activated=this._webGLV6Viewer.picking.activated,this._picking.displayHL=this._webGLV6Viewer.picking.displayHL,this._picking.trapSelection=this._webGLV6Viewer.picking.trapSelection,this._picking.defaultPicking=this._webGLV6Viewer.getDefaultPicking(),this._webGLV6Viewer.setPicking({activated:!1,displayHL:!1,trapSelection:!0!==this._picking.trapSelection&&void 0},!1)),this._webGLV6Viewer.pPicking&&(this._prePicking.activated=this._webGLV6Viewer.pPicking.activated,this._prePicking.displayHL=this._webGLV6Viewer.pPicking.displayHL,this._prePicking.trapSelection=this._webGLV6Viewer.pPicking.trapSelection,this._webGLV6Viewer.setPrePicking({activated:!1,displayHL:!1,trapSelection:!0!==this._picking.trapSelection&&void 0},!1)),this.pickingOff=!0},unsetPickingForNavigation:function(){UWA.is(this._webGLV6Viewer.picking,"object")&&UWA.is(this._picking,"object")&&UWA.is(this._picking.activated,"boolean")&&UWA.is(this._picking.displayHL,"boolean")&&UWA.is(this._picking.trapSelection,"boolean")&&UWA.is(this._picking.defaultPicking,"boolean")&&this._webGLV6Viewer.setPicking({activated:this._picking.activated,displayHL:this._picking.displayHL,trapSelection:!0===this._picking.trapSelection||void 0},this._picking.defaultPicking),UWA.is(this._webGLV6Viewer.pPicking,"object")&&UWA.is(this._prePicking,"object")&&UWA.is(this._prePicking.activated,"boolean")&&UWA.is(this._prePicking.displayHL,"boolean")&&UWA.is(this._prePicking.trapSelection,"boolean")&&this._webGLV6Viewer.setPrePicking({activated:this._prePicking.activated,displayHL:this._prePicking.displayHL,trapSelection:!0===this._picking.trapSelection||void 0},this._picking.defaultPicking),this.pickingOff=!1},endNavigation:function(){this._currentViewpoint.onCenterCamera(null),this.NAVIGATION_MODE="Fly",this.TOUCH_JOYSTICKS_ACTIVE=!1,this.KEYBOARD_ACTIVE=!1,this.endTouchModeNavigation(),this.endMouseModeNavigation(),this.unsetKeybdEventsMap(),this.displayJoySticks(!1),this.destroyReframe(),this.clock&&(this.clock.stop(),this.clock=void 0),this.runloop&&(this.runloop.stop(),this.runloop.dispose(),this.runloop=void 0),this._currentViewpoint.setControlActive(!0),this.unsetPickingForNavigation(),this.frameWindow.experience&&this.frameWindow.experience.showRefAxis(),this.ctx=void 0},beginMouseModeNavigation:function(){this.setNavigationStates(),this.setMouseEventsMap()},endMouseModeNavigation:function(){this.hideReframe(),this.setNavigationStates(),this.unsetMouseEventsMap()},beginTouchModeNavigation:function(){this.reframeNavigation(),this._heightConstraint=0,this._previousHeight=0,this._position.x=0,this._position.y=0,this.setNavigationStates(),this.displayJoySticks(!0),this.setTouchEventsMap(),this.setSelectionCallBack({id:"TouchMode",state:!0})},endTouchModeNavigation:function(){this.unsetTouchEventsMap(),this.displayJoySticks(!1)},displayJoySticks:function(e){if(e){this.showcmd=!0,m.startCommand("command-Joystick"),this._joystickContainer=UWA.createElement("div",{id:"PlayWeb-joystick-ui-container",styles:{width:this._webGLV6Viewer.SCREEN_WIDTH,height:this._webGLV6Viewer.SCREEN_HEIGHT,"pointer-events":"auto"}}).inject(this._viewerFrame);var i=UWA.createElement("div",{id:"PlayWeb-joystick-ui-container-left",styles:{width:this._webGLV6Viewer.SCREEN_WIDTH/2,height:this._webGLV6Viewer.SCREEN_HEIGHT}}).inject(this._joystickContainer),t=UWA.createElement("div",{id:"PlayWeb-joystick-ui-container-right",styles:{width:this._webGLV6Viewer.SCREEN_WIDTH/2,height:this._webGLV6Viewer.SCREEN_HEIGHT}}).inject(this._joystickContainer);UWA.createElement("div",{id:"PlayWeb-joystick-ui-container-right-zone","pointer-events":"auto"}).inject(t),UWA.createElement("div",{id:"PlayWeb-joystick-ui-container-left-zone","pointer-events":"auto"}).inject(i);var n={left:{zone:document.getElementById("PlayWeb-joystick-ui-container-left-zone"),color:"black",mode:"static",position:{left:"15%",top:"75%"}},right:{zone:document.getElementById("PlayWeb-joystick-ui-container-right-zone"),color:"black",mode:"static",position:{left:"85%",top:"75%"}}};this._joystickLinearMove=new o.create(n.left),this._joystickAngularMove=new o.create(n.right),document.getElementById("PlayWeb-joystick-ui-container-left-zone").setStyle("pointer-events","auto"),document.getElementById("PlayWeb-joystick-ui-container-right-zone").setStyle("pointer-events","auto");var a=document.getElementsByClassName("front");Object.keys(a).forEach(function(e){a[e].style.background="white",a[e].style.opacity=1}),this.TOUCH_JOYSTICKS_ACTIVE=!0}else this.showcmd&&(this.showcmd=!1,m.endCommand("command-Joystick")),this._joystickLinearMove&&this._joystickLinearMove.destroy(),this._joystickAngularMove&&this._joystickAngularMove.destroy(),this._joystickContainer&&this._joystickContainer.destroy(),this._joystickContainer=void 0,this._joystickLinearMove=void 0,this._joystickAngularMove=void 0,this.TOUCH_JOYSTICKS_ACTIVE=!1},createReframe:function(){this.reframeUIMainContainer=UWA.createElement("div",{id:"PlayWeb-reframe-ui-main-container"}).inject(this.frameWindow.getUIFrame()),this.reframeUIContainer=UWA.createElement("div",{id:"PlayWeb-reframe-ui-container"}).inject(this.reframeUIMainContainer),this.reframeUIContainer.addEvent(u.POINTERDOWN,this.lookAt)},destroyReframe:function(){this.reframeUIMainContainer&&(this.reframeUIContainer.removeEvent("click",this.lookAt),this.reframeUIMainContainer.destroy()),this.reframeUIMainContainer=void 0},showReframe:function(e){e&&(this.reframeUIContainer.setStyle("top",e.y+"px"),this.reframeUIContainer.setStyle("left",e.x+"px"),this.reframeUIContainer.style.transform="rotate("+e.angle+"deg)"),!this.reframeUIMainContainer||this.reframeUIMainContainer.show(),!this.reframeUIContainer||this.reframeUIContainer.show()},hideReframe:function(){this.reframeUIMainContainer&&(this.reframeUIMainContainer.hide(),this.reframeUIContainer.hide())},setMouseEventsMap:function(){var e=this;this.evtTokenMouse=[],this.evtTokenMouse.push(t.addEvent(this._viewerFrame,"onLeftMouseDown",function(i){e.navigate=!0,e.mouseMove=!0,e.clock.start(),e.updatePostionFromMouseEvent(i),e._navigationState.move_forward_mouse=!0})),this.evtTokenMouse.push(t.addEvent(this._viewerFrame,"onLeftMouseUp",function(i){e.updatePostionFromMouseEvent(i),e.clock.stop(),e._navigationState.move_forward_mouse=!1,e.navigate=!1,e.mouseMove=!1})),this.evtTokenMouse.push(t.addEvent(this._viewerFrame,"onRightMouseDown",function(i){e.navigate=!0,e.mouseMove=!0,e.clock.start(),e.updatePostionFromMouseEvent(i),e._navigationState.move_backward_mouse=!0})),this.evtTokenMouse.push(t.addEvent(this._viewerFrame,"onRightMouseUp",function(i){e.updatePostionFromMouseEvent(i),e.clock.stop(),e._navigationState.move_backward_mouse=!1,e.navigate=!1,e.mouseMove=!1})),this.evtTokenMouse.push(t.addEvent(this._viewerFrame,"onMouseMove",function(i){1==e.navigate&&(e.mouseMove=!0,e.clock.start(),e.updatePostionFromMouseEvent(i))})),this.evtTokenMouse.push(t.addEvent(this._viewerFrame,"onMiddleMouseDown",function(i){e.navigate=!0})),this.evtTokenMouse.push(t.addEvent(this._viewerFrame,"onMiddleMouseUp",function(i){e.checkLookAt(),e.clock.stop(),e.navigate=!1,e.mouseMove=!1})),this.evtTokenMouse.push(t.addEvent(this._viewerFrame,"onLeftDoubleClick",function(i){e.tapToNavigate(i)})),this.evtTokenMouse.push(t.addEvent(this._viewerFrame,"onDoubleTap",function(i){e.tapToNavigate(i)}))},setKeybdEventsMap:function(){var e=this;this.evtTokenKeybd=[],this.evtTokenKeybd.push(t.addEvent(this._viewerFrame,"onKeyDown",function(i){switch(i.gesture.events[0].event.code||i.gesture.events[0].event.keyCode){case"KeyW":console.log("KeyW"),e.KEYBOARD_ACTIVE=!0,e._navigationState.move_forward_keyboard=!0;break;case"KeyS":console.log("KeyS"),e.KEYBOARD_ACTIVE=!0,e._navigationState.move_backward_keyboard=!0;break;case"KeyA":console.log("KeyA"),e.KEYBOARD_ACTIVE=!0,e._navigationState.roll_left=!0;break;case"KeyD":console.log("KeyD"),e.KEYBOARD_ACTIVE=!0,e._navigationState.roll_right=!0;break;case"KeyI":console.log("KeyI"),e.KEYBOARD_ACTIVE=!0,e._navigationState.pitch_up=!0;break;case"KeyK":console.log("KeyK"),e.KEYBOARD_ACTIVE=!0,e._navigationState.pitch_down=!0;break;case"KeyJ":console.log("KeyJ"),e.KEYBOARD_ACTIVE=!0,e._navigationState.yaw_left=!0;break;case"KeyL":console.log("KeyL"),e.KEYBOARD_ACTIVE=!0,e._navigationState.yaw_right=!0}switch(i.gesture.key){case 107:case 187:e.updateSpeed(5);break;case 109:case 189:e.updateSpeed(-5);break;case 37:console.log("Left arrow"),e.KEYBOARD_ACTIVE=!0,e._navigationState.roll_left=!0;break;case 38:e.KEYBOARD_ACTIVE=!0,e._navigationState.move_forward_keyboard=!0;break;case 39:console.log("Right arrow"),e.KEYBOARD_ACTIVE=!0,e._navigationState.roll_right=!0;break;case 40:e.KEYBOARD_ACTIVE=!0,e._navigationState.move_backward_keyboard=!0}})),this.evtTokenKeybd.push(t.addEvent(this._viewerFrame,"onKeyUp",function(i){e._navigationState.move_forward_keyboard=!1,e.KEYBOARD_ACTIVE=!1,e._navigationState.move_backward_keyboard=!1,e._navigationState.roll_left=!1,e._navigationState.roll_right=!1,e._navigationState.pitch_up=!1,e._navigationState.pitch_down=!1,e._navigationState.yaw_left=!1,e._navigationState.yaw_right=!1}))},updateSpeed:function(e){"number"==typeof e&&p._navigationState.speed&&p._navigationState.speed+e>0&&p._navigationState.speed+e<=100&&(p._navigationState.speed+=e,this.speedSliderCB(p._navigationState.speed))},setSpeed:function(e){p._navigationState.speed&&e>0&&e<=100&&(p._navigationState.speed=e)},tapToNavigate:function(e){var t,n,a=this.frameWindow.getViewer(),o=a.currentViewpoint.getSightDirection(),r=a.currentViewpoint.getTargetDistance(),s=a.currentViewpoint.getEyePosition(),l={},c={x:0,y:0,z:0};e.from?t={x:e.from[0].getJSEvent().pageX,y:e.from[0].getJSEvent().pageY}:(t={},console.log(e));var d=a.pick(a.getMousePosition(t),"mesh",!0);if(d.path.length>0){l=d.position.clone();var h=new i.Vector3(l.x-s.x,l.y-s.y,l.z-s.z),u=h.length();h.normalize(),c.x=l.x-h.x*u*.2,c.y=l.y-h.y*u*.2,"Walk"===this.NAVIGATION_MODE?c.z=s.z:c.z=l.z-h.z*u*.15,n={eyePosition:c,sightDirection:o,distanceToTarget:r,duration:500},a.currentViewpoint.centerCamera(d.position),this._currentViewpoint.onCenterCamera(function(){}),a.currentViewpoint.moveTo(n),this._currentViewpoint.onCenterCamera(null),a.render()}else console.log("points not recognizes on the model")},setTouchEventsMap:function(){var e=this,i={x:0,y:0};i.x=e._webGLV6Viewer.SCREEN_WIDTH/2,i.y=e._webGLV6Viewer.SCREEN_HEIGHT/2;var n={distance:void 0}.distance,a=!1,o=null;this._joystickLinearMove.on("start",function(t,r){i.x=e._webGLV6Viewer.SCREEN_WIDTH/2,i.y=e._webGLV6Viewer.SCREEN_HEIGHT/2,e._navigationState.move_forward_touch=!1,e._navigationState.move_backward_touch=!1,e.updatePostionFromTouchEvent(i,10),o=setInterval(function(i){a&&(1==e._navigationState.roll_left||1==e._navigationState.roll_right?e.joystickLinearMoveLeftRight(n):e.updatePostionFromTouchEvent(i,n))},1,i)}),this._joystickLinearMove.on("move",function(t,o){o&&o.direction&&o.distance&&(n=o.distance,a=!0,"up"===o.direction.y&&"up"===o.direction.angle&&(e._navigationState.move_forward_touch=!0,e._navigationState.move_backward_touch=!1,e._navigationState.roll_left=!1,e._navigationState.roll_right=!1,e.updatePostionFromTouchEvent(i,n)),"down"===o.direction.y&&"down"===o.direction.angle&&(e._navigationState.move_forward_touch=!1,e._navigationState.move_backward_touch=!0,e._navigationState.roll_left=!1,e._navigationState.roll_right=!1,e.updatePostionFromTouchEvent(i,n)),"left"===o.direction.x&&"left"===o.direction.angle&&(e._navigationState.roll_left=!0,e._navigationState.roll_right=!1,e.joystickLinearMoveLeftRight(n)),"right"===o.direction.x&&"right"===o.direction.angle&&(e._navigationState.roll_left=!1,e._navigationState.roll_right=!0,e.joystickLinearMoveLeftRight(n)))}),this._joystickLinearMove.on("end",function(t,a){i.x=e._webGLV6Viewer.SCREEN_WIDTH/2,i.y=e._webGLV6Viewer.SCREEN_HEIGHT/2,e._navigationState.move_forward_touch=!1,e._navigationState.move_backward_touch=!1,e._navigationState.roll_left=!1,e._navigationState.roll_right=!1,e.updatePostionFromTouchEvent(i,n),o&&clearInterval(o)});var r=!1,s=null,l={direction:!1};this._joystickAngularMove.on("start",function(t,n){i.x=e._webGLV6Viewer.SCREEN_WIDTH/2,i.y=e._webGLV6Viewer.SCREEN_HEIGHT/2,e.updatePostionFromTouchEvent(i),s=setInterval(function(i){r&&e.updatePostionFromTouchEvent(i)},1,i)}),this._joystickAngularMove.on("move dir",function(t,n){n&&n.direction&&n.distance&&n.distance>0&&(r=!0,l.angle!==n.direction.angle&&(i.x=e._webGLV6Viewer.SCREEN_WIDTH/2,i.y=e._webGLV6Viewer.SCREEN_HEIGHT/2,e.updatePostionFromTouchEvent(i),l.angle=n.direction.angle),"up"===n.direction.y&&"up"===n.direction.angle&&(i.y=i.y-e._webGLV6Viewer.SCREEN_HEIGHT*n.distance/2e3,e.updatePostionFromTouchEvent(i)),"down"===n.direction.y&&"down"===n.direction.angle&&(i.y=i.y+e._webGLV6Viewer.SCREEN_HEIGHT*n.distance/2e3,e.updatePostionFromTouchEvent(i)),"left"===n.direction.x&&"left"===n.direction.angle&&(i.x=i.x-e._webGLV6Viewer.SCREEN_WIDTH*n.distance/2e3,e.updatePostionFromTouchEvent(i)),"right"===n.direction.x&&"right"===n.direction.angle&&(i.x=i.x+e._webGLV6Viewer.SCREEN_WIDTH*n.distance/2e3,e.updatePostionFromTouchEvent(i)))}),this._joystickAngularMove.on("end",function(t,n){i.x=e._webGLV6Viewer.SCREEN_WIDTH/2,i.y=e._webGLV6Viewer.SCREEN_HEIGHT/2,e.updatePostionFromTouchEvent(i),s&&clearInterval(s)}),this.evtTokenTouch=[],this.evtTokenTouch.push(t.addEvent(this._viewerFrame,"onLeftDoubleClick",function(i){e.tapToNavigate(i)})),this.evtTokenTouch.push(t.addEvent(this._viewerFrame,"onDoubleTap",function(i){e.tapToNavigate(i)})),this.frameWindow.getViewerFrame().addEvent("resize",this.resizefun)},joystickLinearMoveLeftRight:function(e){p._navigationState.move_forward_touch=!1,p._navigationState.move_backward_touch=!1;var t,n,a=new i.Vector3;1==p._navigationState.roll_left?a.x=-e/100*(this._navigationState.speed/100):1==p._navigationState.roll_right&&(a.x=e/100*(this._navigationState.speed/100)),p.distanceToTarget&&p.isInsideBboxLimits()||(p.distanceToTarget=p._currentViewpoint.getControl().distanceToTarget),a.applyQuaternion(p._currentViewpoint.getControl().orientation),a.setLength(.05*p.distanceToTarget),t=p._currentViewpoint.getTarget().add(a),p._currentViewpoint.getControl().orientation.clone(),n=p._currentViewpoint.getTargetDistance();var o=p._currentViewpoint.getCamera().getLookAt().clone(),r=(new i.Vector3).addVectors(t,o.normalize().multiplyScalar(-n));p._currentViewpoint.moveTo({eyePosition:r,duration:1e3/e*2/(this._navigationState.speed/100)}),p.checkLookAt()},unsetTouchEventsMap:function(){this.evtTokenTouch&&(this.evtTokenTouch.forEach(function(e){t.removeEventFromToken(e)}),this.evtTokenTouch=void 0),this.evtTokenTouch=[],this.frameWindow.getViewerFrame().removeEvent("resize",this.resizefun)},unsetMouseEventsMap:function(){this.evtTokenMouse&&(this.evtTokenMouse.forEach(function(e){t.removeEventFromToken(e)}),this.evtTokenMouse=void 0)},unsetKeybdEventsMap:function(){this.evtTokenKeybd&&(this.evtTokenKeybd.forEach(function(e){t.removeEventFromToken(e)}),this.evtTokenKeybd=void 0)},levelViewPointwithGround:function(){var e=this._currentViewpoint.getUpDirection(),i=this._currentViewpoint.getSightDirection(),t=e.clone();if(t.z<0||t.y<0){if(this.upAttribute&&t.y<0){t.y*=-1;var n=t.z;t.z=t.x,t.x=n}else if(!this.upAttribute&&t.z<0){t.z*=-1;n=t.x;t.x=t.y,t.y=n}var a={sightDirection:i,upDirection:t,duration:500};this._currentViewpoint.moveTo(a),setTimeout(function(){p.levelGround()},600)}else p.levelGround()},levelGround:function(){var e={eyePosition:p._currentViewpoint.getEyePosition(),upDirection:this.upAttribute?new i.Vector3(0,1,0).normalize():new i.Vector3(0,0,1).normalize(),duration:1200};p._currentViewpoint.moveTo(e),p.checkLookAt()},getPauseValue:function(){return this._navigationState.pause},setPauseValue:function(e){this._navigationState.pause=e,e?this.clock.stop():this.clock.start()},lookAt:function(){if(p.reframeNavigation(),p.hideReframe(),"Walk"===p.NAVIGATION_MODE){var e=g.getCommand("FlyWalk",p.frameWindow.experience.ctx);e&&e.reloadWalkMode()}},reframeNavigation:function(){p.frameWindow.getViewpoint().reframe()},centerToObject:function(){this._currentViewpoint.centerCamera(this._originalTarget)},resizefun:function(e){console.log("resize"),p.endNavigation(),p.beginNavigation({touchMode:p.touchMode})}.bind(this)})}),define("DS/3DPlayExploreScenario/3DPlayExploreScenario",["DS/3DPlay/3DPlayScenario","DS/WebSystem/Environment"],function(e,i){"use strict";return e.extend({init:function(e){this._parent(e),this.setScenarioResetActionBarPolicy(!1)},isMobileCompatible:function(){return!0}})}),define("DS/3DPlayDefaultExperience/PlayWebDictionary",[],function(){"use strict";var e={VCXWebComponentOccurrence:{W3AISGNodeHolder:"DS/WebApplicationBase/W3AASGNodeHolder"},VCXVolatileGhostingManager:{W3AIManager:"DS/WebApplicationBase/W3AAManager"},VCXLevelExploderManager:{W3AIManager:"DS/WebApplicationBase/W3AAManager"}},i={W3AIManager:"DS/WebApplicationBase/W3AIManager"},t={VCXVolatileGhostingManager:"DS/VCXWebVolatileGhosting/VCXVolatileGhostingManager",VCXLevelExploderManager:"DS/VCXWebLevelExploderGUI/VCXLevelExploderManager"},n=["VCXWebVolatileGhosting/VCXWebVolatileGhosting"];return{GetDictionary:function(){return{interfaces:i,components:t,extensions:e}},getNLSModules:function(){return n}}}),define("DS/3DPlaySpecTree/3DPlaySpecTreeSOManager",["UWA/Class","DS/Visualization/PathElement","DS/Selection/XSO","DS/Selection/CSOManager","DS/Selection/HSOManager"],function(e,i,t,n,a){"use strict";Object.create({object:{_objectId:"",treeObject:{_objectId:"",_object:{}},visuObject:{_objectId:"",_object:{}},getId:function(){return this._objectId}},getObjectForId:function(e){for(var i in this)if(i.getId()===e)return i}});return e.extend({init:function(e){this._parent(e);this._cso=new t({getElementID:function(e){return!1},useUniqueID:!0,areEquals:function(e,i){return!1}})},getCSO:function(){return this._cso},dispose:function(){this._parent()}})}),define("DS/3DPlaySpecTree/3DPlaySpecTree",[],function(){}),define("DS/3DPlayNavigationScenario/3DPlayNavigationScenario",["DS/3DPlay/3DPlayScenario","DS/ApplicationFrame/CommandsManager","DS/WebSystem/Environment"],function(e,i,t){"use strict";return e.extend({init:function(e){void 0!==e&&e.scenarioManager&&(this._exp=e.scenarioManager.getExperience()),this._parent(e)},launch:function(){var e=this;if(this._exp&&this._exp.frmWindow){if(t.isSet("3DPlay.LoadOldFlyWalk"))this.loadWorkbench({module:"3DPlayNavigationScenario",name:"3DPlayNavigationScenario_old"},!0,{sections:[{id:"FlyWalk",nls:"3DPlayNavigationScenario/3DPlayNavigationScenario",rsc:"3DPlayNavigationScenario/3DPlayNavigationScenario"}]});else{for(var n=this._exp.args.workbenchs,a=null,o=[],r=0;r<n.length;r++)"EnopadRightPanel"==n[r].name?a=n[r]:o.push(n[r]);o.push({name:"3DPlayNavigationScenario",module:"3DPlayNavigationScenario"}),!a||o.push(a),this._exp.workbenchIndex=0,this._exp.manageWorkBenchs({createActionBar:!0,finishCallBack:function(e){console.log("custom workBench Loaded!",e)},customWorkBench:o})}if(e._viewer=this._exp.frmWindow.getViewer(),this._exp){this._exp.showContextualMenu(!1);var s=!1;this._exp.isSpecTreeAllowed()&&(s=!0);var l=this._exp.frmWindow.getActionBar();this.token_launch=l.onActionBarReady(function(){if(t.isSet("3DPlay.LoadOldFlyWalk")){var n=i.getCommand("FlyWalk",e._exp.ctx);n&&!n.isRunning()&&(n.hideImmersiveFrame=s,n.navgationService&&(n.navgationService._originalTarget=e._exp.frmWindow.getViewer().currentViewpoint.getTarget()),n.begin())}else{var a=i.getCommandCheckHeader("FlyWalkCmd",e._exp.ctx);a&&!1===a.getState()&&(a.setState(!0),e.token_launch&&(l.removeCallback(e.token_launch),e.token_launch=void 0))}}),1===e._viewer.currentViewpoint.getProjectionType()&&(e._viewer.currentViewpoint.setProjectionType(0),e._previousProjection=1);var c=i.getCommand("VisuPerspectiveView",e._exp.ctx);c&&c.disable();var d=i.getCommand("VisuOrthographicView",e._exp.ctx);d&&d.disable()}}else console.error("3DPlay : Navigation Scenario --\x3e Cound not launch.")},stop:function(){if(this._exp&&this._exp.frmWindow){if(this.token_launch){var e=this._exp.frmWindow.getActionBar();e&&(e.removeCallback(this.token_launch),this.token_launch=void 0)}if(this._viewer=this._exp.frmWindow.getViewer(),this._exp){this._exp.showContextualMenu(!0),1===this._previousProjection&&(this._viewer.currentViewpoint.setProjectionType(1),this._previousProjection=void 0);var n=i.getCommand("VisuPerspectiveView",this._exp.ctx);n&&n.enable();var a=i.getCommand("VisuOrthographicView",this._exp.ctx);if(a&&a.enable(),t.isSet("3DPlay.LoadOldFlyWalk")){var o=i.getCommand("FlyWalk",this._exp.ctx);o&&o.isRunning()&&o.end()}else{var r=i.getCommandCheckHeader("FlyWalkCmd",this._exp.ctx);r&&!0===r.getState()&&r.setState(!1)}this._viewer=void 0}}else console.error("3DPlay : Navigation Scenario --\x3e Cound not stop.")},isMobileCompatible:function(){return!0}})}),define("DS/3DPlayExploreScenario/3DPlayExploreRegister",["DS/3DPlay/3DPlayRegister","DS/3DPlayExploreScenario/3DPlayExploreScenario","DS/3DPlayNavigationScenario/3DPlayNavigationScenario","DS/WebSystem/Environment"],function(e,i,t,n){"use strict";var a=new Promise(function(e,i){require(["DS/CAT3DAnnotationScenario/CAT3DAnnotationScenario"],e,i)});return e.extend({init:function(e){this._parent(e),this._initScenarios()},_initScenarios:function(){this.scenarioManager.addScenario({registerID:this.registerID,scenario:i,available:!0,name:"Explore"}),this.scenarioManager.addScenario({registerID:this.registerID,scenario:t,available:!0,name:"Navigation"});var e=this;if(a.then(function(i){i&&e&&e.scenarioManager.addScenario({registerID:e.registerID,scenario:i,available:!0,name:"FTA"}),e=null}),n.isSet("3DPlay.CollageScenario")){var o=this;require(["DS/3DPlayCollageScenario/3DPlayCollageScenario"],function(e){o.scenarioManager.addScenario({registerID:o.registerID,scenario:e,available:!0,name:"Collage"})})}}})}),define("DS/3DPlayNavigationScenario/CmdFlyWalk",["DS/ApplicationFrame/Command","css!DS/3DPlayNavigationScenario/3DPlayNavigationScenario","DS/Selection/CSOManager","DS/Selection/HSOManager","DS/Selection/PSOManager","DS/Controls/Slider","DS/Windows/Dialog","DS/WebInfraUI/ContextualBarManager","DS/3DPlayNavigationScenario/NavigationService","DS/WebSystem/Settings","DS/WebUtils/Tracker","DS/CoreEvents/Events"],function(e,i,t,n,a,o,r,s,l,c,d,h){"use strict";var u;Math.PI;return e.extend({init:function(e){this._parent(e,{isAsynchronous:!0})},hideImFrame:function(){this.getFrameWindow().getImmersiveFrame(),this.hideImmersiveFrame&&this.getFrameWindow().getImmersiveFrame()&&this.getFrameWindow().getImmersiveFrame().hide()},showImFrame:function(){this.getFrameWindow().getImmersiveFrame()&&this.getFrameWindow().getImmersiveFrame().show()},beginExecute:function(){this.hideImFrame(),d.command(this.getId());var e=this;u=this,this.flywalkWidgetFullscreenDisable=h.subscribe({event:"3DPLAY/MOBILEACTIONBAR/DISABLE"},function(i){e._sliderMainContainer&&e._sliderMainContainer.setAttribute("id","PlayWeb-slider-container_MAB"),e._speedSliderMainContainer&&e._speedSliderMainContainer.setAttribute("id","PlayWeb-speed-slider-container_MAB")}),this.flywalkWidgetFullscreenEnable=h.subscribe({event:"3DPLAY/MOBILEACTIONBAR/ENABLE"},function(i){e._sliderMainContainer&&e._sliderMainContainer.setAttribute("id","PlayWeb-slider-container"),e._speedSliderMainContainer&&e._speedSliderMainContainer.setAttribute("id","PlayWeb-speed-slider-container")});var i=this.getFrameWindow().getActionBar();i.close();var o=i.onActionBarReady(function(){e.isRunning()&&i.close()}),r=i.onActionBarOpen(function(){i.removeCallback(o),i.removeCallback(r),e.end()});t.empty(),n.empty(),a.empty(),this.navgationService=new l({frameWindow:this.getFrameWindow(),setSelectionCallBack:function(i){e._contextualMenu&&e._contextualMenu.setSelected(i)},speedSliderCB:this.speedSliderCB});var s=!1;"ontouchstart"in document.documentElement&&(s=!0),this.displayRightContextualMenu(!0,s),this.navgationService.beginNavigation({touchMode:s})},endExecute:function(){this.showImFrame(),h.unsubscribe(this.flywalkWidgetFullscreenDisable),h.unsubscribe(this.flywalkWidgetFullscreenEnable),this.navgationService.endNavigation(),this.navgationService=void 0,this.distroySpeedSlider(),this.displayWalkHeightSlider(!1),this.displayRightContextualMenu(!1);var e=this.getFrameWindow().getActionBar();e.open(),e.MAB&&e.MAB.showFlyout(0)},displayRightContextualMenu:function(e,i){var t=this;if(e){this._contextualMenu=new s({frameWindow:this.getFrameWindow(),UIHandlerCB:this.calculateSliderPosition.bind(this)});var n=[{type:t._contextualMenu.Button.Radio,onclickCB:function(e){d.command("Flywalk-"+e.id),"Fly"===e.id&&"Fly"!=t.navgationService.NAVIGATION_MODE?(t.navgationService.NAVIGATION_MODE="Fly",t.displayWalkHeightSlider(!1),t.hideSpeedSlider()):"Walk"===e.id&&"Walk"!=t.navgationService.NAVIGATION_MODE&&(t.navgationService.NAVIGATION_MODE="Walk",t.hideSpeedSlider(),t.displayWalkHeightSlider(!0),t.navgationService.centerToObject(),t.levelViewPointwithGround())},content:[{id:"Fly",rsc:"3DPlayNavigationScenario/3DPlayNavigationScenario",nls:"3DPlayNavigationScenario/3DPlayNavigationScenario",selected:"Fly"===t.navgationService.NAVIGATION_MODE},{id:"Walk",rsc:"3DPlayNavigationScenario/3DPlayNavigationScenario",nls:"3DPlayNavigationScenario/3DPlayNavigationScenario",selected:"Walk"===t.navgationService.NAVIGATION_MODE}]},{type:t._contextualMenu.Button.Check,onclickCB:function(e){e.state?(d.command("Flywalk-Ground"),t.hideSpeedSlider(),console.log("Ground Level"),t.levelViewPointwithGround(),t.uncheck=e.uncheck,setTimeout(function(){t.uncheck()},1e3)):console.log("Deletion of the settings panel")},id:"GroundLevel",rsc:"3DPlayNavigationScenario/3DPlayNavigationScenario",nls:"3DPlayNavigationScenario/3DPlayNavigationScenario"},{type:t._contextualMenu.Button.Check,onclickCB:function(e){t.speedSlider=e,d.command("Flywalk-Setting"),e.state?(console.log("Creation of the settings panel"),t.createSpeedSlider()):(console.log("Deletion of the settings panel"),t.hideSpeedSlider())},id:"SpeedSettings",rsc:"3DPlayNavigationScenario/3DPlayNavigationScenario",nls:"3DPlayNavigationScenario/3DPlayNavigationScenario"},{type:t._contextualMenu.Button.Master,id:"ExitNavigation",rsc:"3DPlayNavigationScenario/3DPlayNavigationScenario",nls:"3DPlayNavigationScenario/3DPlayNavigationScenario",onclickCB:function(){t.end()}},{type:t._contextualMenu.Button.MasterCheck,onclickCB:function(e){"Walk"===t.navgationService.NAVIGATION_MODE&&t.reloadWalkMode(),t.distroySpeedSlider(),!1===e.state?(t.navgationService.endTouchModeNavigation(),t.navgationService.beginMouseModeNavigation()):(t.navgationService.endMouseModeNavigation(),t.navgationService.beginTouchModeNavigation())},id:"TouchMode",rsc:"3DPlayNavigationScenario/3DPlayNavigationScenario",nls:"3DPlayNavigationScenario/3DPlayNavigationScenario",selected:!0===i}];n=n.filter(function(e){if(0!==Object.keys(e).length)return e}),this._contextualMenuToken=this._contextualMenu.addButtons(n,{barType:this._contextualMenu.Toolbar.New,showContextBarBackground:!0})}else this._contextualMenu.removeButtons(this._contextualMenuToken),this._contextualMenu.dispose(),this._contextualMenu=void 0},displayWalkHeightSlider:function(e){var i=this;if(e){var t=this.getFrameWindow().getActionBar();t.MAB&&t.MAB.state&&1==t.MAB.state.visible?this._sliderMainContainer=UWA.createElement("div",{id:"PlayWeb-slider-container_MAB","pointer-events":"none"}).inject(this.getFrameWindow().getUIFrame()):this._sliderMainContainer=UWA.createElement("div",{id:"PlayWeb-slider-container","pointer-events":"none"}).inject(this.getFrameWindow().getUIFrame()),this._walkSlider=new o({minValue:-100,maxValue:100,stepValue:1,value:i.navgationService._heightConstraint,displayStyle:"vertical"}).inject(this._sliderMainContainer),this._walkSlider.addEventListener("change",function(e){e.preventDefault&&e.preventDefault(),e.cancelBubble=!0;var t=e.dsModel;i.navgationService._heightConstraint=t.value,i.navgationService.updateHeight()}),this.adjustSliderwithPanel()}else this.distroyWalkSlider()},distroyWalkSlider:function(){this._sliderMainContainer&&this._sliderMainContainer.destroy(),this._sliderMainContainer=void 0,this._walkSlider&&this._walkSlider.destroy(),this._walkSlider=void 0,this.navgationService&&(this.navgationService._heightConstraint=0,this.navgationService._previousHeight=0)},reloadWalkMode:function(){this.distroyWalkSlider(),this.distroySpeedSlider(),this.displayWalkHeightSlider(!0),this.navgationService.centerToObject(),this.levelViewPointwithGround()},createSpeedSlider:function(){var e=this;if(!this._speedSliderMainContainer){var i=this.getFrameWindow().getActionBar();i.MAB&&i.MAB.state&&1==i.MAB.state.visible?this._speedSliderMainContainer=UWA.createElement("div",{id:"PlayWeb-speed-slider-container_MAB","pointer-events":"none"}).inject(this.getFrameWindow().getUIFrame()):this._speedSliderMainContainer=UWA.createElement("div",{id:"PlayWeb-speed-slider-container","pointer-events":"none"}).inject(this.getFrameWindow().getUIFrame()),this._speedSlider=new o({minValue:1,maxValue:100,stepValue:1,value:e.navgationService._navigationState.speed,displayStyle:"vertical"}).inject(this._speedSliderMainContainer),this._speedSlider.addEventListener("change",function(i){i.preventDefault&&i.preventDefault(),i.stopPropagation&&i.stopPropagation(),i.cancelBubble=!0;var t=i.dsModel;e.navgationService.setSpeed(t.value)})}e.showSpeedSlider()},adjustSliderwithPanel:function(){this._contextualMenu.panel.freeZoneResize()},calculateSliderPosition:function(e){function i(i){var t;t=e+73,i.setStyles({right:t+"px"})}this._speedSliderMainContainer&&i(this._speedSliderMainContainer),this._sliderMainContainer&&i(this._sliderMainContainer)},hideSpeedSlider:function(){this.speedSlider&&this.speedSlider.state&&(this.speedSlider.uncheck(),this.speedSlider.state=!1),this._speedSliderMainContainer&&this._speedSliderMainContainer.hide(),this._walkSlider&&this.navgationService&&"Walk"==this.navgationService.NAVIGATION_MODE&&(this._sliderMainContainer.show(),this._walkSlider.show())},showSpeedSlider:function(){this._walkSlider&&(this._sliderMainContainer.hide(),this._walkSlider.hide()),this.adjustSliderwithPanel(),this._speedSliderMainContainer.show()},distroySpeedSlider:function(){this.hideSpeedSlider(),this._speedSliderMainContainer&&this._speedSliderMainContainer.destroy(),this._speedSliderMainContainer=void 0,this._speedSlider&&this._speedSlider.destroy(),this._speedSlider=void 0},speedSliderCB:function(e){u._speedSlider&&(u._speedSlider.value=e)},levelViewPointwithGround:function(){this.navgationService.levelViewPointwithGround()},alignAndReframeNavigation:function(){var e=this;e.navgationService.levelViewPointwithGround(),setTimeout(function(){e.navgationService.centerToObject()},1800)},reframeNavigation:function(){this.navgationService.centerToObject()}})}),define("DS/3DPlaySpecTree/3DPlaySpecTreeUtils",["DS/Windows/Panel","DS/WebSystem/Settings","DS/Visualization/PathElement","DS/Selection/CSOManager","DS/Selection/HSOManager","DS/3DPlaySpecTree/3DPlaySpecTreeSOManager","DS/WebappsUtils/WebappsUtils"],function(e,i,t,n,a,o,r){"use strict";var s=i.get("3DPlay.SpecTree.LoggingEnabled");return{CSOManager:n,HSOManager:a,isDebugLog:s,log:s?console.log.bind(window.console):function(){},specTreeModel:null,rootPaths:null,disposeModelNode:function(){this.specTreeModel=null,this.specTreeView=null,this.viewer=null,this.rootPaths=null},registerModelNodes:function(e,i,t){var n=this;if(!e||!i||!t)return this.log("3DPlay : Error - Could resolve specTreeModel, specTreeView or frameWindow",e,i,t),!1;this.viewer=t.getViewer(),this.specTreeModel=e,this.specTreeView=i,this.rootPaths=this.setRootPaths(t),this.addSelectionCB(),e.registerModelNodeType({nodeType:"model-node",buildIcons:function(){return[{iconName:"product"}]},buildLabel:function(e){return e.nodeModel.options.label},onSelect:function(e){var i=e.nodeModel;i.play3DData.fromCSO?delete i.play3DData.fromCSO:n.select3DNode(i.play3DData.id,n.viewer)},onUnselect:function(e){var i=e.nodeModel;if(i.play3DData.fromCSO)delete i.play3DData.fromCSO;else{var t=i.getChildren();if(n.unselect3DNode(i.play3DData.id,n.viewer),t)for(var a=0;a<t.length;a++)t[a].isSelected()&&n.select3DNode(t[a].play3DData.id,n.viewer)}}})},buildPanel:function(i,t){var n=new UWA.Element("div");return t.content&&n.appendChild(t.content),{panel:new e({titleBarVisibleFlag:!1,icon:r.getWebappsAssetUrl("3DPlaySpecTree","icons/32/")+"I_3DPlaySpecTree.png",title:"",content:n,immersiveFrame:i,resizableFlag:!0,movableFlag:!1,currentDockArea:t.currentDockArea|WUXDockAreaEnum.NoneDockArea,width:400,verticallyStretchableFlag:!0,usePaddingFlag:!1,closeButtonFlag:!1,floatableFlag:!1,expandedFlag:!0,ensureHeightDefinitionOnHierarchy:!0}),content:n}},setRootPaths:function(e){var i=e.getViewer().getNodes(),n=e.experience?e.experience.getRootBag():null,a=[];return i.forEach(function(e){var i=new t;if(n&&e===n)for(var o=e.getChildren(),r=o.length,s=0;s<r;s++)i.addElement(o[s]);else i.addElement(e);a.push(i)}),a},createPathFromId:function(e,i){var t,n=this.rootPaths,a=e.split("/"),o=function(e,i){e.length>0&&e.forEach(function(e){var n=e.getLastElement();if(void 0!==n.getPersistentId)"Instance3D"!=n.productType&&1!=n.getPersistentId()||n.getPersistentId()==i[0]&&(i.splice(0,1),t=e);else if(void 0!==n.id){var a=n.worktype?n.worktype:n.plmtype;"VPMReference"!=a&&"VPMInstance"!=a&&"VPMRepInstance"!=a&&"VPMRepReference"!=a&&"3DShape"!=a&&"CATProduct"!=a&&"CATPart"!=a&&"Viewable"!=a&&"CgrViewable"!=a||n.id==i[0]&&(i.splice(0,1),t=e)}var r=e.getChildrenOccurrencePathes();null!=r&&o(r,i)})};return o(n,a),t},createIdFromPath:function(e){for(var i=e.pathElement,t="";null!=i;){var n=i.getLastElement(!0);if(void 0!==n.getPersistentId)"Instance3D"!=n.productType&&1!=n.getPersistentId()||(0!==t.length&&(t="/"+t),t=n.getPersistentId()+t);else if(void 0!==n.id&&0!==n.id){var a=n.worktype?n.worktype:n.plmtype;if("VPMReference"==a||"VPMInstance"==a||"VPMRepInstance"==a||"VPMRepReference"==a||"3DShape"==a||"CATProduct"==a||"CATPart"==a||"Viewable"==a||"CgrViewable"==a)0!==t.length&&(t="/"+t),t=n.id+t}i=i.getParentOccurrencePath()}return t},select3DNode:function(e,i){this.log("-- select3DNode --:",e);var t=this,o=[],r=[];Array.isArray(e)?r=e:r.push(e),r.forEach(function(e){o.push({pathElement:t.createPathFromId(e,i)})}),this.removeSelectionCB(),n.add(o),a.add(o),this.addSelectionCB()},unselect3DNode:function(e,i){this.log("-- unselect3DNode --:",e);var t=this,o=n.get(),r=[];o.forEach(function(e){r.push(t.createIdFromPath(e))});var s=[];Array.isArray(e)?s=e:s.push(e);var l=[];s.forEach(function(e){for(var i=0;i<r.length;i++)r[i].indexOf(e)>-1&&l.push(o[i])}),l.forEach(function(e){t.removeSelectionCB(),n.remove(e),a.remove(e),t.addSelectionCB()})},emptySelection:function(){n.empty(),a.empty()},addSelectionCB:function(){var e=this;void 0!==this.treeSelectionCB&&(this.treeSelectionCB.onAddToken=n.onAdd(function(i){Array.isArray(i)||(i=[i]);var t=[];i.forEach(function(i){t.push(e.createIdFromPath(i))}),e.treeSelectionCB("ADD/VISUNODE",t)}),this.treeSelectionCB.onRemoveToken=n.onRemove(function(i){Array.isArray(i)||(i=[i]);var t=[];i.forEach(function(i){t.push(e.createIdFromPath(i))}),e.treeSelectionCB("REMOVE/VISUNODE",t)}),this.treeSelectionCB.onEmptyToken=n.onEmpty(function(){e.treeSelectionCB("EMPTY/VISUNODE")}))},removeSelectionCB:function(){void 0!==this.treeSelectionCB&&(void 0!==this.treeSelectionCB.onAddToken&&n.unsubscribe(this.treeSelectionCB.onAddToken),void 0!==this.treeSelectionCB.onRemoveToken&&n.unsubscribe(this.treeSelectionCB.onRemoveToken),void 0!==this.treeSelectionCB.onEmptyToken&&n.unsubscribe(this.treeSelectionCB.onEmptyToken))},treeSelectionCB:function(e,i){var t=this,n=function(){return t.specTreeModel.search({match:function(e){for(var t=0;t<i.length;t++){var n=i[t];if(n&&e.nodeModel.play3DData.id===n)return!0}}})};switch(t.specTreeModel.prepareUpdate(),e){case"EMPTY/VISUNODE":t.specTreeModel.unselectAll();break;case"ADD/VISUNODE":n().forEach(function(e,i){e.play3DData.fromCSO=!0,e.select(),e.reverseExpand()});break;case"REMOVE/VISUNODE":n().forEach(function(e){e.play3DData.fromCSO=!0,e.unselect()})}t.specTreeModel.pushUpdate()}}}),define("DS/3DPlaySpecTree/3DPlaySpecTreePanel",["UWA/Class","DS/Visualization/PathElement","DS/SpecTree/SpecTreeView","DS/SpecTree/SpecTreeDocument","DS/Tree/TreeNodeModel","DS/Utilities/Utils","DS/Selection/CSOManager","DS/3DPlaySpecTree/3DPlaySpecTreeUtils","DS/3DPlaySpecTree/3DPlaySpecTreeSOManager","DS/WebSystem/Settings","DS/CoreEvents/Events"],function(e,i,t,n,a,o,r,s,l,c,d){"use strict";return e.extend({init:function(e){this._parent(e),this._sceneRootBag=e.sceneRootBag,this._frameWindow=e.frameWindow,window.__karma__&&(this._SpecTreeUtils=s)},dispose:function(){this._destroyPanel(),s.removeSelectionCB(),this._sceneRootBag=void 0,this._frameWindow=void 0,this._parent()},instanciateSpecTreePanel:function(){var e=this._frameWindow.getImmersiveFrame();this._specTreeModel=new n,this._specTreeView=new t({height:"auto",treeDocument:this._specTreeModel,show:{rowHeaders:!1,columnHeaders:!1},isEditable:!1,enableDragAndDrop:!1});var i="true"===c.get("3DPlay.SpecTree.VisuTreeEnabled");i&&this._frameWindow.getTree().show();var a=i?WUXDockAreaEnum.RightDockArea:WUXDockAreaEnum.LeftDockArea;this._dockingElement=e.getDockingElement(a),this._dockingElement.collapseDockingZoneFlag=!0,this._panelModel=s.buildPanel(e,{content:this._specTreeView.getContent(),currentDockArea:a}),this._setupSpecTreePanel(),this.SpecTreeDisableSubscribe=d.subscribe({event:"3DPLAY/SPECTREE/DISABLE"},this._disableSpecTree.bind(this)),this.SpecTreeEnableSubscribe=d.subscribe({event:"3DPLAY/SPECTREE/ENABLE"},this._enableSpecTree.bind(this))},_disableSpecTree:function(){var e=this;this._dockingElement.collapseDockingZoneFlag||(this._dockingElement.collapseDockingZoneFlag=!0),setTimeout(function(){e._dockingElement.visibleDockingZoneFlag=!1,e=void 0},500)},_enableSpecTree:function(){this._dockingElement.visibleDockingZoneFlag=!0},_destroyPanel:function(){this.SpecTreeDisableSubscribe&&d.unsubscribe(this.SpecTreeDisableSubscribe),this.SpecTreeEnableSubscribe&&d.unsubscribe(this.SpecTreeEnableSubscribe),this._specTreeView&&(this._specTreeView.destroy(),this._specTreeView=null),this._panelModel&&this._panelModel.panel&&(this._panelModel.panel.destroy(),this._panelModel.panel=null),this._specTreeModel.removeRoots(),this._specTreeModel=null,s.disposeModelNode()},_setupSpecTreePanel:function(){s.registerModelNodes(this._specTreeModel,this._specTreeView,this._frameWindow),this._specTreeModel.prepareUpdate(),this._generateChildren(this._sceneRootBag.children[0]),this._specTreeModel.pushUpdate()},_generateChildren:function(e,i){if(!e)return s.log("3DPlay : Error - Could not resolve parentModel3DNode",e),!1;if(!i){var t=this._specTreeModel.createModelNode({nodeType:"model-node",label:e.name}),n="";return e.getPersistentId&&(n+=e.getPersistentId()),t.play3DData={id:n},this._specTreeModel.addChild(t),this._generateChildren(e,t),t}for(var a=0;a<e.children.length;a++){var o=e.children[a],r=null;if("Instance3D"===o.productType&&1===o.children.length&&"Reference3D"===o.children[0].productType){var l=""+o.name,c=""+o.children[0].name,d="Node-"+a;""!==c&&(d=c),""!==l&&(d+=" ("+l+")"),r=this._specTreeModel.createModelNode({nodeType:"model-node",label:d});var h=i.play3DData.id+"/"+o.getPersistentId();r.play3DData={id:h},i.addChild(r),this._generateChildren(o,r)}else{if("Reference3D"!==o.productType)return!0;r=i,this._generateChildren(o,r)}}return!0}})});var annotationManager=[];window.localStorage["3DPlay.UseExplodeCompatibleAnnotationManager"]?annotationManager.push("DS/3DPlayAnnotation3D/AnnotationExplodeManager"):annotationManager.push("DS/3DPlayAnnotation3D/AnnotationManager"),define("DS/3DPlayDefaultExperience/3DPlayDefaultExperience",["DS/3DPlayExperienceModule/PlayExperience3D","DS/Visualization/ThreeJS_DS","DS/Visualization/PathElement","DS/3DPlay/3DPlay","DS/3DPlay/3DPlayScenarioManager","DS/CoreEvents/Events","DS/ApplicationFrame/CommandsManager","DS/3DPlayDefaultExperience/PlayWebDictionary","DS/3DPlaySpecTree/3DPlaySpecTreePanel","DS/WebSystem/Settings","DS/WebSystem/Environment","DS/WebUtils/Tracker","DS/WebUtils/ContextedSingleton","DS/WebSystem/App"].concat(annotationManager),function(e,i,t,n,a,o,r,s,l,c,d,h,u,g,m){"use strict";return e.extend({init:function(e){var i=this;this._isSpecTreeAllowed=!0,d.isSet("3DPlay.DisableInherance")&&(e.commandApplication=!1,e.workbenchs=[{name:"3DPlayExperience3D",module:"3DPlayExperienceModule"}]),this.useSession=!0,this._parent(e),this.disposeFunctions.add(function(){i=null}),this.EventDisposer.add(this.subscribe("ASSET/LOADINGFINISHED",function(){var e=i.args&&i.args.input&&i.args.input.asset?i.args.input.asset:void 0;if("false"===c.get("3DPlay.SpecTree.Disabled","false")&&i.isSpecTreeAllowedForAsset(e)&&i.isSpecTreeAllowed()){var t=i.frmWindow,n=i.frmWindow.experience.getRootBag();if(void 0===i.specTreePanel){i.specTreePanel=new l({sceneRootBag:n,frameWindow:t}),i.specTreePanel.instanciateSpecTreePanel();var a=i.frmWindow&&i.frmWindow.getActionBar()?i.frmWindow.getActionBar().MAB:null;if(i.specTreePanel&&a){var o=!1;a.onVisibilityChangeSubscribe("PlayWeb-SpecTree",function(e){!1===o&&"hidden"!==e?(i.specTreePanel&&i.specTreePanel._panelModel.panel.hide(),o=!0):!0===o&&"hidden"===e&&(i.specTreePanel&&i.specTreePanel._panelModel.panel.show(),o=!1)})}}}require(["DS/i3DXCompassServices/i3DXCompassPubSub"],function(e){i&&i.activatePlayFromCompass(e)},function(e){console.log(" 3DPlay compass services not fetched!! Load error")})})),this.EventDisposer.add(this.subscribe("ASSET/LOADINGSTARTED",function(){var e=i.frmWindow&&i.frmWindow.getActionBar()?i.frmWindow.getActionBar().MAB:null;e&&e.onVisibilityChangeUnsubscribe("PlayWeb-SpecTree"),i._vcxVCXVolatileGhostingManager=null,i._vcxLevelExploderManager&&(i._vcxLevelExploderManager=null)}))},clearView:function(){if(this.specTreePanel&&(this.specTreePanel.dispose(),this.specTreePanel=void 0),this.frmWindow){var e=this.frmWindow.getViewer();e&&0==e.getVisibleSpace()&&e.swapVisibleSpace()}this._parent()},activatePlayFromCompass:function(e){var i=window.widget,t=!0,n=!1,s=this.ctx,l=function(){r.getCommands(s).Scenario.begin()},c=function(){n&&t&&(i.fullscreen=!0,a.getScenarioAvailibility()&&e.publish("activatePlay",{appId:"X3DDRVN_AP"},function(e){l(),setTimeout(function(){g()},300)}))},h=function(){e.publish("resetPlay",{appId:"X3DDRVN_AP"},function(e){d.isBoolActive("3DPlay.Debug")&&console.log("result",e)})},u=function(e){t=!0,c()},g=function(i){e.publish("activatePlay",{appId:"X3DDRVN_AP"},function(e){d.isBoolActive("3DPlay.Debug")&&console.log("result",e),l(),setTimeout(function(){g()},300)})};this.EventDisposer.add(o.subscribe({event:"3DPLAY/FULLSCREEN/ENABLE"},function(e){n=!0,c()})),this.EventDisposer.add(o.subscribe({event:"3DPLAY/FULLSCREEN/DISABLE"},function(e){n=!1,h()})),this.EventDisposer.add(o.subscribe({event:"3DPLAY/3DPLAYPREVIEW/ENABLE"},u)),this.EventDisposer.add(o.subscribe({event:"3DPLAY/3DPLAYPREVIEW/DISABLE"},function(e){t=!1,h()})),this.EventDisposer.add(o.subscribe({event:"3DPLAY/PLAYFROMCOMPASS/ENABLE"},c)),this.EventDisposer.add(o.subscribe({event:"3DPLAY/PLAYFROMCOMPASS/DISABLE"},h)),void 0!==i&&(n=!i||!i.getView||"windowed"!==i.getView().type),u()},isSpecTreeAllowed:function(e){return"boolean"==typeof e&&(this._isSpecTreeAllowed=e),this._isSpecTreeAllowed},isSpecTreeAllowedForAsset:function(e){return!(!(e=Array.isArray(e)?e[0]:e)||"3dxml"!==e.type||!(g.is3DDrive()||e.originalAsset&&"3DDRIVE"===e.originalAsset.provider)||"3dxml"!==e.originalType&&"catproduct"!==e.originalType&&void 0!==e.originalType)},addDictionaries:function(){if(s&&s.getNLSModules&&s.getNLSModules()&&(this._nlsToLoad||(this._nlsToLoad=[]),this._nlsToLoad=this._nlsToLoad.concat(s.getNLSModules())),s&&s.GetDictionary&&s.GetDictionary())return this._experienceBase.AddDictionaryDescription(s.GetDictionary())},initExperienceBase:function(e,i){this._parent(e),this._vcxVCXVolatileGhostingManager=this.experienceBase.Factory.BuildComponent("VCXVolatileGhostingManager"),this._vcxVCXVolatileGhostingManager.SetID("VCXVolatileGhostingManagerID"),this._vcxVCXVolatileGhostingManager.SetPersistency(1),this._vcxVCXVolatileGhostingManager.ghostAndRefresh_OLD=this._vcxVCXVolatileGhostingManager.ghostAndRefresh,this._vcxVCXVolatileGhostingManager.ghostAndRefresh=function(){h.trackPageEvent("commands","command","volatingghosting"),this.ghostAndRefresh=this.ghostAndRefresh_OLD,this.ghostAndRefresh(),delete this.ghostAndRefresh_OLD},this.experienceBase._ManagerSet.addManager("VCXVolatileGhostingManager",this._vcxVCXVolatileGhostingManager),c.get("3DPlay.UseExplodeCompatibleAnnotationManager")&&(this._vcxLevelExploderManager=this.experienceBase.Factory.BuildComponent("VCXLevelExploderManager"),this._vcxLevelExploderManager&&(this._vcxLevelExploderManager.SetID("VCXLevelExploderManagerID"),this._vcxLevelExploderManager.SetPersistency(1),this.experienceBase._ManagerSet.addManager("VCXLevelExploderManager",this._vcxLevelExploderManager))),i&&i(0)},dispose:function(e){o.publish({event:"3DPLAY/PLAYFROMCOMPASS/DISABLE",data:{}}),this.specTreePanel&&(this.specTreePanel.dispose(),this.specTreePanel=void 0);var i=this.frmWindow&&this.frmWindow.getActionBar()?this.frmWindow.getActionBar().MAB:null;i&&i.onVisibilityChangeUnsubscribe("PlayWeb-SpecTree"),this._vcxVCXVolatileGhostingManager=null,this._vcxLevelExploderManager&&(this._vcxLevelExploderManager=null),this.frmWindow.getContextualUIManager().unregister("3DPlayContextualID"),this.destroyAnnotationManager(),this._parent(e)},onPreCreate:function(){this.args&&(this.args.visu=this.args.visu||{},this.args.visu.showReferenceAxisSystem=!0),this.tabletMabModel={speeddial:[{id:"Reframe",rsc:"3DPlay/3DPlayExperience3D"},{id:"VisibilityCommands",rsc:"3DPlay/3DPlayExperience3D"},{id:"measure2CmdHdr",rsc:"DMUBaseCommands/3DPlayPro",hideAB:!0},{id:"section2CmdHdr",rsc:"DMUBaseCommands/3DPlayPro"},{id:"AnnotationCommands",rsc:"3DPlay/3DPlayExperience3D"},{id:"AnnotationCommand3DText",rsc:"3DPlay/3DPlayExperience3D"},{id:"Share",icon:"3DPlay/assets/icons/32/I_3DSHAREShare.png",flyout:[]}],sections:[{id:"Scenario",nls:"3DPlay/3DPlay",rsc:"3DPlay/3DPlay",hideAB:!0,showBack:!0},{id:"ViewSelector",nls:"3DPlay/3DPlayExperience3D",rsc:"3DPlay/3DPlayExperience3D",hideAB:!0,showBack:!0},{id:"EnhancedExplode",nls:"3DPlay/3DPlayExperience3D",rsc:"3DPlay/3DPlayExperience3D",hideAB:!0,showBack:!0},{id:"AnnotationTour",nls:"3DPlay/3DPlayExperience3D",rsc:"3DPlay/3DPlayExperience3D",hideAB:!0,showBack:!0},{id:"CameraViews",nls:"3DPlay/3DPlayExperience3D",rsc:"3DPlay/3DPlayExperience3D",flyout:[{id:"VisuOrthographicView",rsc:"ViewerCommands/ViewerCommands"},{id:"VisuPerspectiveView",rsc:"ViewerCommands/ViewerCommands"}]},{id:"Render",nls:"3DPlay/3DPlayExperience3D",rsc:"3DPlay/3DPlayExperience3D",flyout:[{id:"VisuShading",rsc:"ViewerCommands/ViewerCommands"},{id:"VisuShadingEdgesNoSmoothEdges",rsc:"ViewerCommands/ViewerCommands"},{id:"VisuShadingEdgesHiddenEdges",rsc:"ViewerCommands/ViewerCommands"},{id:"VisuShadingMaterialEdges",rsc:"ViewerCommands/ViewerCommands"},{id:"VisuShadingMaterial",rsc:"ViewerCommands/ViewerCommands"},{id:"VisuShadingIllustration",rsc:"ViewerCommands/ViewerCommands"},{id:"VisuNoShadingEdges",rsc:"ViewerCommands/ViewerCommands"}]},{id:"Ambiance",nls:"3DPlay/3DPlayExperience3D",rsc:"3DPlay/3DPlayExperience3D",flyout:[{id:"VisuPureWhiteOCACmd",rsc:"ViewerCommands/ViewerCommands"},{id:"VisuWhiteMirrorOCACmd",rsc:"ViewerCommands/ViewerCommands"},{id:"VisuWhiteReviewOCACmd",rsc:"ViewerCommands/ViewerCommands"},{id:"VisuWhiteExperienceOCACmd",rsc:"ViewerCommands/ViewerCommands"},{id:"VisuStudioOCACmd",rsc:"ViewerCommands/ViewerCommands"},{id:"VisuDarkMirrorOCACmd",rsc:"ViewerCommands/ViewerCommands"},{id:"VisuDarkReviewOCACmd",rsc:"ViewerCommands/ViewerCommands"},{id:"VisuWhiteDesignOCACmd",rsc:"ViewerCommands/ViewerCommands"},{id:"VisuBlueDesignOCACmd",rsc:"ViewerCommands/ViewerCommands"},{id:"VisuDarkDesignOCACmd",rsc:"ViewerCommands/ViewerCommands"},{id:"VisuIndoorOCACmd",rsc:"ViewerCommands/ViewerCommands"},{id:"VisuCityOCACmd",rsc:"ViewerCommands/ViewerCommands"},{id:"VisuRoadOCACmd",rsc:"ViewerCommands/ViewerCommands"},{id:"VisuOutdoorOCACmd",rsc:"ViewerCommands/ViewerCommands"},{id:"VisuBasicOCACmd",rsc:"ViewerCommands/ViewerCommands"}]},{id:"LineicFilter",nls:"3DPlay/3DPlayExperience3D",rsc:"3DPlay/3DPlayExperience3D"}]},this.mabModel={speeddial:[{id:"Reframe",rsc:"3DPlay/3DPlayExperience3D"},{id:"AnnotationCommands",rsc:"3DPlay/3DPlayExperience3D"},{id:"AnnotationCommand3DText",rsc:"3DPlay/3DPlayExperience3D"},{id:"Share",icon:"3DPlay/assets/icons/32/I_3DSHAREShare.png",flyout:[]}],sections:[{id:"Scenario",nls:"3DPlay/3DPlay",rsc:"3DPlay/3DPlay",hideAB:!0,showBack:!0},{id:"ViewSelector",nls:"3DPlay/3DPlayExperience3D",rsc:"3DPlay/3DPlayExperience3D",hideAB:!0,showBack:!0},{id:"VisibilityCommands",nls:"3DPlay/3DPlayExperience3D",rsc:"3DPlay/3DPlayExperience3D"},{id:"EnhancedExplode",nls:"3DPlay/3DPlayExperience3D",rsc:"3DPlay/3DPlayExperience3D",hideAB:!0,showBack:!0},{id:"measure2CmdHdr",nls:"DMUBaseCommands/3DPlayPro",rsc:"DMUBaseCommands/3DPlayPro",hideAB:!0},{id:"section2CmdHdr",nls:"DMUBaseCommands/3DPlayPro",rsc:"DMUBaseCommands/3DPlayPro"},{id:"AnnotationTour",nls:"3DPlay/3DPlayExperience3D",rsc:"3DPlay/3DPlayExperience3D",hideAB:!0,showBack:!0},{id:"CameraViews",nls:"3DPlay/3DPlayExperience3D",rsc:"3DPlay/3DPlayExperience3D",flyout:[{id:"VisuOrthographicView",rsc:"ViewerCommands/ViewerCommands"},{id:"VisuPerspectiveView",rsc:"ViewerCommands/ViewerCommands"}]},{id:"Render",nls:"3DPlay/3DPlayExperience3D",rsc:"3DPlay/3DPlayExperience3D",flyout:[{id:"VisuShading",rsc:"ViewerCommands/ViewerCommands"},{id:"VisuShadingEdgesNoSmoothEdges",rsc:"ViewerCommands/ViewerCommands"},{id:"VisuShadingEdgesHiddenEdges",rsc:"ViewerCommands/ViewerCommands"},{id:"VisuShadingMaterialEdges",rsc:"ViewerCommands/ViewerCommands"},{id:"VisuShadingMaterial",rsc:"ViewerCommands/ViewerCommands"},{id:"VisuShadingIllustration",rsc:"ViewerCommands/ViewerCommands"},{id:"VisuNoShadingEdges",rsc:"ViewerCommands/ViewerCommands"}]},{id:"Ambiance",nls:"3DPlay/3DPlayExperience3D",rsc:"3DPlay/3DPlayExperience3D",flyout:[{id:"VisuPureWhiteOCACmd",rsc:"ViewerCommands/ViewerCommands"},{id:"VisuWhiteMirrorOCACmd",rsc:"ViewerCommands/ViewerCommands"},{id:"VisuWhiteReviewOCACmd",rsc:"ViewerCommands/ViewerCommands"},{id:"VisuWhiteExperienceOCACmd",rsc:"ViewerCommands/ViewerCommands"},{id:"VisuStudioOCACmd",rsc:"ViewerCommands/ViewerCommands"},{id:"VisuDarkMirrorOCACmd",rsc:"ViewerCommands/ViewerCommands"},{id:"VisuDarkReviewOCACmd",rsc:"ViewerCommands/ViewerCommands"},{id:"VisuWhiteDesignOCACmd",rsc:"ViewerCommands/ViewerCommands"},{id:"VisuBlueDesignOCACmd",rsc:"ViewerCommands/ViewerCommands"},{id:"VisuDarkDesignOCACmd",rsc:"ViewerCommands/ViewerCommands"},{id:"VisuIndoorOCACmd",rsc:"ViewerCommands/ViewerCommands"},{id:"VisuCityOCACmd",rsc:"ViewerCommands/ViewerCommands"},{id:"VisuRoadOCACmd",rsc:"ViewerCommands/ViewerCommands"},{id:"VisuOutdoorOCACmd",rsc:"ViewerCommands/ViewerCommands"},{id:"VisuBasicOCACmd",rsc:"ViewerCommands/ViewerCommands"}]},{id:"LineicFilter",nls:"3DPlay/3DPlayExperience3D",rsc:"3DPlay/3DPlayExperience3D"}]},!0===d.isSet("3DPlay.NRPrototype.DebugCmd")&&(this.mabModel.speeddial[0]={id:"NR",rsc:"3DPlayWebNRCommands/3DPlayWebNRCommands",nls:"3DPlayWebNRCommands/3DPlayWebNRCommands"},this.tabletMabModel.speeddial[0]={id:"NR",rsc:"3DPlayWebNRCommands/3DPlayWebNRCommands",nls:"3DPlayWebNRCommands/3DPlayWebNRCommands"}),g.is3DPlay()&&(this.mabModel.sections.push({id:"RightSidePanel",rsc:"PADUtils/PADUtils",nls:"PADUtils/PADUtils"}),this.tabletMabModel.sections.push({id:"RightSidePanel",rsc:"PADUtils/PADUtils",nls:"PADUtils/PADUtils"})),this.mabModelAR={speeddial:[{id:"AnnotationCommands",rsc:"3DPlay/3DPlayExperience3D"},{id:"Share",icon:"3DPlay/assets/icons/32/I_3DSHAREShare.png",flyout:[]}],sections:[{id:"Scenario",nls:"3DPlay/3DPlay",rsc:"3DPlay/3DPlay",hideAB:!0,showBack:!0},{id:"VisibilityCommands",nls:"3DPlay/3DPlayExperience3D",rsc:"3DPlay/3DPlayExperience3D"},{id:"EnhancedExplode",nls:"3DPlay/3DPlayExperience3D",rsc:"3DPlay/3DPlayExperience3D",hideAB:!0,showBack:!0},{id:"section2CmdHdr",nls:"DMUBaseCommands/3DPlayPro",rsc:"DMUBaseCommands/3DPlayPro"},{id:"Render",nls:"3DPlay/3DPlayExperience3D",rsc:"3DPlay/3DPlayExperience3D",flyout:[{id:"VisuShading",rsc:"ViewerCommands/ViewerCommands"},{id:"VisuShadingEdgesNoSmoothEdges",rsc:"ViewerCommands/ViewerCommands"},{id:"VisuShadingEdgesHiddenEdges",rsc:"ViewerCommands/ViewerCommands"},{id:"VisuShadingMaterialEdges",rsc:"ViewerCommands/ViewerCommands"},{id:"VisuShadingMaterial",rsc:"ViewerCommands/ViewerCommands"},{id:"VisuShadingIllustration",rsc:"ViewerCommands/ViewerCommands"},{id:"VisuNoShadingEdges",rsc:"ViewerCommands/ViewerCommands"}]}]},this.args&&this.args.input&&this.args.input.asset&&this.args.input.asset.provider&&this.args.input.asset.provider,this._iOS?(this.mabModel.speeddial[3].flyout=[{id:"ShareTo3DSwYm",rsc:"3DPlay/3DPlay"},{id:"SharePrint",rsc:"3DPlay/3DPlay"}],this.tabletMabModel.speeddial[6].flyout=[{id:"ShareTo3DSwYm",rsc:"3DPlay/3DPlay"},{id:"SharePrint",rsc:"3DPlay/3DPlay"}]):(this.mabModel.speeddial[3].flyout=[{id:"ShareTo3DSwYm",rsc:"3DPlay/3DPlay"},{id:"ShareDownload",rsc:"3DPlay/3DPlay"},{id:"SharePrint",rsc:"3DPlay/3DPlay"}],this.tabletMabModel.speeddial[6].flyout=[{id:"ShareTo3DSwYm",rsc:"3DPlay/3DPlay"},{id:"ShareDownload",rsc:"3DPlay/3DPlay"},{id:"SharePrint",rsc:"3DPlay/3DPlay"}]),this.useSession&&(g.is3DSwym()||g.is3DDrive()||g.is3DSpace()||g.is3DPlay())&&g.isOnCloud()&&!0!==this.share3DCommentHide&&(this.mabModel.speeddial[3].flyout.unshift({id:"Share3DComment",rsc:"3DPlay/3DPlay"}),this.tabletMabModel.speeddial[6].flyout.unshift({id:"Share3DComment",rsc:"3DPlay/3DPlay"})),navigator.userAgent.match(/Android|iPhone|iPad|iPod|BlackBerry|Opera Mini|IEMobile/i)||this.mabModel.sections[9].flyout.push({id:"VisuQMCommand",rsc:"ViewerCommands/ViewerCommands"}),d.isSet("3DPlay.VisuPanel")&&(this.mabModel.speeddial.push({id:"VisuViewPanelCommand",rsc:"ViewerCommands/ViewerCommands"}),this.tabletMabModel.speeddial.push({id:"VisuViewPanelCommand",rsc:"ViewerCommands/ViewerCommands"}))},onPostCreate:function(){var e=this,t=this.frmWindow.getViewer(),n=function(n,a){var o=r.getCommandCheckHeader("VCXVolatileGhostingCmd",e.ctx),s=!1;if(e._enableCMenu&&(s=o&&o._state||e._vcxVCXVolatileGhostingManager&&e._vcxVCXVolatileGhostingManager.hasVolatileGhostingToRestore()),e._enableCMenu&&!s&&a&&a.XmousePosition){var l=new i.Vector2(a.XmousePosition,a.YmousePosition),c=t.getMousePosition(l);if(0===t.pick(c,"mesh",!0).path.length){var d=[];return navigator.userAgent.match(/Android|iPhone|iPad|iPod|BlackBerry|Opera Mini|IEMobile/i)||d.push({name:"3DPlayDisplaySection",line:1,hdr_list:["VisuQMCommand"]}),d.push({name:"3DPlayAmbiencesSection",line:1,resourceFile:"3DPlay/3DPlay",hdr_list:["VisuPureWhiteOCACmd","VisuWhiteMirrorOCACmd","VisuWhiteReviewOCACmd","VisuWhiteExperienceOCACmd","VisuStudioOCACmd","VisuDarkMirrorOCACmd","VisuDarkReviewOCACmd","VisuWhiteDesignOCACmd","VisuBlueDesignOCACmd","VisuDarkDesignOCACmd","VisuIndoorOCACmd","VisuCityOCACmd","VisuRoadOCACmd","VisuOutdoorOCACmd","VisuBasicOCACmd"]}),{cmdList:d}}}return null};this._iOS||this._android?this.frmWindow.getContextualUIManager().register({workbenchName:"3DPlayExperience3D_mobile",module:"3DPlay",cmdPrefix:"",merge:!0,subscriberId:"3DPlayContextualID",fileName:"3DPlayExperience3D_mobile.xml",onContextualMenuReady:n}):this.frmWindow.getContextualUIManager().register({workbenchName:"3DPlayExperience3D",module:"3DPlay",cmdPrefix:"",merge:!0,subscriberId:"3DPlayContextualID",fileName:"3DPlayExperience3D.xml",onContextualMenuReady:n})},createAnnotationManager:function(){u.add(this.ctx,"ANNOTATION_MANAGER",new m({frameWindow:this.frmWindow,context:this.ctx}))},destroyAnnotationManager:function(){u.get(this.ctx,"ANNOTATION_MANAGER")&&u.remove(this.ctx,"ANNOTATION_MANAGER")},loadAsset:function(e,i,t,n){this.destroyAnnotationManager(),this.createAnnotationManager(),this._parent(e,i,t,n)}})});