define("DS/CAT3DWMedia/CAT3DWMediaDataService",["UWA/Class"],function(t){"use strict";var e=t.extend({init:function(){this._parent(),this._data={},this._saveData=[]},setValue:function(t,e){return this._data[t]=e,this._data[t]},setValues:function(t){for(var e in t)this.setValue(e,t[e])},getValue:function(t){return this._data[t]},getData:function(){return JSON.parse(JSON.stringify(this._data))},setData:function(t){return this._data=JSON.parse(JSON.stringify(t)),this._data},save:function(){this._saveData.push(JSON.parse(JSON.stringify(this._data)))},forgetChg:function(){this._saveData.length<=0?console.warn("Error during forgetChg : No data has been saved"):this._data=JSON.parse(JSON.stringify(this._saveData.pop()))},clearSave:function(){this._saveData=[]}});return UWA.namespace("DS/CAT3DWMedia/CAT3DWMediaDataService",e)}),define("DS/CAT3DWMedia/CAT3DWMediaView",["DS/ApplicationFrame/FrameWindowsManager","DS/CAT3DWSceneObject/CAT3DWConnectableObject","DS/Visualization/Node3D","DS/Visualization/ThreeJS_DS"],function(t,e,i,a){"use strict";var n=i.extend(e,{init:function(e,i){this._parent(e.getID()),this._media=e,this._saveMatrix=[];var a=t.getFrameWindow();this._viewer=a.getViewer(),this._viewpoint=a.getViewpoint(),i.addChild(this)},initialize:function(){this._viewer.render()},getMediaObj:function(){return this._media},dispose:function(){this._media=null,this._saveMatrix=[]},setMatrix:function(t){this.isLocked()||this._parent(t)},applyMatrix:function(t){this.isLocked()||this._parent(t)},save:function(){this._saveMatrix.push(JSON.parse(JSON.stringify(this.getMatrix())))},forgetChg:function(){if(this._saveMatrix.length<=0)console.warn("Error during forgetChg : No matrix has been saved");else{var t=(new a.Matrix4).copy(JSON.parse(JSON.stringify(this._saveMatrix.pop())));this.setMatrix(t),this._viewer.render()}},clearSave:function(){this._saveMatrix=[]},_buildDottedBorderMaterial:function(){var t=new a.LineBasicMaterial({color:new a.Color("#42A2DA"),force:!0,transparent:!0,opacity:1,lineWidth:2});return t.depthTest=!0,t.depthWrite=!1,t.polite=!0,t.politeMaterial=t.clone(),t.politeMaterial.opacity=.15,t.politeMaterial.depthTest=!1,t.politeMaterial.depthWrite=!1,t.politeMaterial instanceof a.ShaderMaterial&&(t.politeMaterial.transparent=!0,t.politeMaterial.uniforms.opacity.value=.3),t},getID:function(){return this._media.getID()},getType:function(){return this._media.getType()},lock:function(t){this._parent(),t||this._media.lock(!0)},unlock:function(t){this._parent(),t||this._media.unlock(!0)},getMoveData:function(){throw new Error("Must be implemented")},setMoveData:function(){throw new Error("Must be implemented")},getCenter:function(){var t=this.getMatrixWorld();return this._getRectangleCenter(t)},get2DPortPositions:function(t){let e=this.getCorners(),i=e.topRight.clone().sub(e.topLeft).multiplyScalar(.5).add(e.topLeft),n=e.bottomLeft.clone().sub(e.bottomRight).multiplyScalar(.5).add(e.bottomRight),r=e.bottomLeft.clone().sub(e.topLeft).multiplyScalar(.5).add(e.topLeft),s=e.topRight.clone().sub(e.bottomRight).multiplyScalar(.5).add(e.bottomRight);return{top:{pointCoordinates:new a.Vector2(i.x,i.y)},bottom:{pointCoordinates:new a.Vector2(n.x,n.y)},left:{pointCoordinates:new a.Vector2(r.x,r.y)},right:{pointCoordinates:new a.Vector2(s.x,s.y)}}}});return UWA.namespace("DS/CAT3DWMedia/CAT3DWMediaView",n)}),define("DS/CAT3DWMedia/CAT3DWMediaManager",["DS/ApplicationFrame/FrameWindowsManager","DS/CoreEvents/Events","UWA/Class"],function(t,e,i){"use strict";return i.extend({init:function(){this._id=0,this._idGroup=0,this._mediaList=[],this._rootNode=null},initialize:function(){var e=t.getFrameWindow();this._viewer=e.getViewer()},createMediaInGroup:function(t,e){if(!t)return-1;if(t.group){if("number"!=typeof t.group||t.group<0||t.group>=this._mediaList.length||!this._mediaList[t.group])return-1}else t.group=0;t.parentNode=this._rootNode,t.viewer=this._viewer,t.callback=e;var i=this.createMediaObject(t);return this._mediaList[t.group].push(i),i.initialize(t),i},createMediaObject:function(){throw new Error("'DS/CAT3DWMedia/CAT3DWMediaManager' is an abstract class. You must implement this function.")},createNewGroup:function(){return this._mediaList[this._idGroup]=[],this._idGroup++},getMedia:function(t){for(var e=null,i=0;i<this._mediaList.length;i++)if(this._mediaList[i])for(var a=0;a<this._mediaList[i].length;a++)if(this._mediaList[i][a].getID()===t){e=this._mediaList[i][a];break}return e},getMediasInGroup:function(t){return"number"!=typeof t||t<0||t>=this._mediaList.length?null:this._mediaList[t]},getNbMediasInGroup:function(t){var e=0,i=this.getMediasInGroup(t);return i&&(e=i.length),e},getMediaInGroup:function(t,e){if("number"==typeof t&&t>-1&&t<this._mediaList.length&&this._mediaList[t])for(var i=0;i<this._mediaList[t].length;i++)if(this._mediaList[t][i].getID()===e)return this._mediaList[t][i];return null},getNbMedias:function(){for(var t=0,e=0;e<this._mediaList.length;e++)t+=this.getNbMediasInGroup(e);return t},getAllMedias:function(){var t,e,i=[],a=null;for(t=0;t<this._mediaList.length;t++)if(a=this._mediaList[t])for(e=0;e<a.length;e++)i[i.length]=a[e];return i},removeMedia:function(t){if(t){for(var e=t.getID(),i=null,a=null,n=0;n<this._mediaList.length;n++)if(this._mediaList[n])for(var r=0;r<this._mediaList[n].length;r++)if(this._mediaList[n][r].getID()===e){i=n,a=r;break}t.dispose(),null!==i&&null!==a&&this._mediaList[i].splice(a,1),this._viewer.render()}},reset:function(t){this._mediaList=[],this._rootNode&&(this._rootNode.removeChildren(),this._rootNode=null),e.publish({event:this.getResetEvent(),data:t})},getResetEvent:function(){return"CAT3DWMediaManagerReset"},getRootNode:function(){return this._rootNode}})}),define("DS/CAT3DWMedia/CAT3DWMedia",["DS/CAT3DWMedia/CAT3DWMediaDataService","DS/CAT3DWSceneObject/CAT3DWConnectableObject"],function(t,e){"use strict";var i=e.extend({init:function(e){this._parent(),this._id=e.id,e.mediaOccId&&(this._mediaOccId=e.mediaOccId),this._parentNode=e.parentNode,this._viewer=e.viewer,this._mediaData=new t,this._mediaData.setValue("thirdPartyColor",null),this._mediaView=this.createMediaView(this._parentNode,e),e.matrix&&this._mediaView.setMatrix(e.matrix)},update:function(t){this._id=t.id,t.mediaOccId&&(this._mediaOccId=t.mediaOccId),this.getDataService().setValue("updateData",t)},getUpdateData:function(){return{id:this._id,mediaOccId:this._mediaOccId}},dispose:function(){this._parentNode.remove(this._mediaView),this._mediaView.dispose(),this._mediaView=null},createMediaView:function(){throw new Error("You must implement this function")},initialize:function(){throw new Error("You must implement this function")},getCopyData:function(){return{mediaOccId:this._mediaOccId}},getID:function(){return this._id},getMediaOccId:function(){return this._mediaOccId},getType:function(){return"CAT3DWMedia"},lock:function(t){this._parent(),t||this._mediaView.lock(!0)},unlock:function(t){this._parent(),t||this._mediaView.unlock(!0)},get2DPortPositions:function(t){return this._mediaView.get2DPortPositions(t)},getCenter:function(){return this._mediaView.getCenter()},get2DProjectedPosition:function(t,e){return this._mediaView.get2DProjectedPosition(t,e)},getDataService:function(){return this._mediaData},getView:function(){return this._mediaView},save:function(){this._mediaData.save(),this._mediaView.save()},forgetChg:function(){this._mediaData.forgetChg()},clearSavedData:function(){this._mediaData.clearSave(),this._mediaView.clearSave()},getCreationData:function(){var t=this._mediaView.getCreationData();return t.id=this._id,t.mediaOccId=this._mediaOccId,t},getMoveData:function(){return this._mediaView.getMoveData()},setMoveData:function(t){this._mediaView.setMoveData(t)},getEditData:function(){return this._mediaView.getEditData()},setEditData:function(t){this._mediaView.setEditData(t)},thirdPartySelect:function(t){this._mediaView.activateThirdPartySelectionFeedback(t.color),this.getDataService().setValue("thirdPartyUserInfo",t)},thirdPartyDeselect:function(){this._mediaView.deactivateThirdPartySelectionFeedback(),this.getDataService().setValue("thirdPartyUserInfo",null)},isThirdPartySelected:function(){return!!this.getDataService().getValue("thirdPartyUserInfo")},getThirdPartyUserInfo:function(){return this.getDataService().getValue("thirdPartyUserInfo")},callOnMediaSaveCB:function(){this._onMediaSavedCB&&(this.getView()&&this._onMediaSavedCB(),this._onMediaSavedCB=null)},onMediaSaved:function(t){this._onMediaSavedCB=t}});return UWA.namespace("DS/CAT3DWMedia/CAT3DWMedia",i)});