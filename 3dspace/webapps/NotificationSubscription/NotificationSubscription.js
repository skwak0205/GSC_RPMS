define("DS/NotificationSubscription/NotificationSubscription",["UWA/Core","UWA/Class/View","DS/PlatformAPI/PlatformAPI"],function(t,i,s){"use strict";var e;return i.extend({init:function(t){var i;s.getUser()&&(i=s.getUser().login),this._buildContent(t),this.subscribed=0,this._addEvent(t),this._getSubscribedState(t,i)},_buildContent:function(i){this.button=new t.Element("button",{class:"btn btn-primary",text:0===this.subscribed?"Subscribe":"Unsubscribe",styles:{marginBottom:"5px",marginRight:"10px",maxWidth:"110px",overflow:"hidden",textOverflow:"ellipsis",float:"right"}}).inject(i.target)},_addEvent:function(t){e=this,this.button.onclick=function(){var i,n;e._setSubscribedState(),0===window.location.href.search(/https:\/\/([A-z0-9]+)-[A-z0-9]+-[A-z0-9]+-[A-z0-9]+/)&&(n=window.location.href.split(/https:\/\//)[1].split("-")[0].toUpperCase()),s.getUser()&&(i=s.getUser().login),s.publish("INTFSubscriptionTopic",{action:e.subscribed?"subscribe":"unsubscribe",params:{user:i,tenant:n,notificationID:t.notificationID,tokenID:t.tokenID}})},s.subscribe("INTFSubscriptionTopic",function(t){if("setSubscribedState"===t.action){t.state=parseInt(t.state),e.subscribed=t.state?t.state:0;var i=0===e.subscribed?"Subscribe":"Unsubscribe";e.button&&e.button.setText(i)}}),this.addEvent("setState",function(t){this.subscribed=t.state,this.subscribed?(this.button.textContent="Subscribe",this.subscribed=0):(this.button.textContent="Unsubscribe",this.subscribed=1)})},_setSubscribedState:function(){this.subscribed?(this.button.textContent="Subscribe",this.subscribed=0):(this.button.textContent="Unsubscribe",this.subscribed=1)},_getSubscribedState:function(t,i){s.publish("INTFSubscriptionTopic",{action:"getSubscribedState",params:{notificationID:t.notificationID,tokenID:t.tokenID,user:i}})}})});