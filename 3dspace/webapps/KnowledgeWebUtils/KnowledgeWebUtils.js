define("DS/KnowledgeWebUtils/Dependency",["DS/KnowledgeWebUtils/Utils","DS/KnowledgeWebUtils/Listenable"],function(e,t){"use strict";function n(e,n){t.call(this),this._value=!1,this._parentsSolved=!1,this._solved=!1,this._parents=[],this._parentsSolvedCBs=[],this._isSolvedCBs=[],this._current=n,Array.isArray(e)||(e=e?[e]:[]);for(var i=0;i<e.length;i++)this.addParent(e[i]);return this}return(0,e.inherits)(n,t),n.prototype.destroy=function(){this._parentsSolvedCBs=[],this._isSolvedCBs=[],this.removeAllParents()},n.prototype.getLinked=function(){return this._current},n.prototype.setValue=function(e){this._value=e,this.notify("valueChanged"),this._updateSolved()},n.prototype.isSolved=function(){return this._value&&this.areParentsSolved()},n.prototype.addParent=function(e){e&&-1===this._parents.indexOf(e)&&(this._parents.push(e),e.addObjListener(this,this._onParentsChanged,"solvedChanged"),e.addObjListener(this,this._onParentValueChanged,"valueChanged"),this._onParentsChanged())},n.prototype.removeParent=function(e){var t=this._parents.indexOf(e);e&&-1!==t&&(this._parents.splice(t,1),e.removeObjListener(this,"solvedChanged"),this._onParentsChanged())},n.prototype.removeAllParents=function(){let e=this;this._parents.forEach(t=>t.removeObjListener(e,"solvedChanged")),this._parents=[],this._onParentsChanged()},n.prototype.areParentsSolved=function(){for(var e=!0,t=0;t<this._parents.length&&e;t++)e=e&&this._parents[t].isSolved();return e},n.prototype.whenParentsSolved=function(e){this.areParentsSolved()?(e(),this._parentsSolvedCBs.push(e)):this._parentsSolvedCBs.push(e)},n.prototype.whenIsSolved=function(e){this.isSolved()?e.call(this):this._isSolvedCBs.push(e)},n.prototype._onParentsChanged=function(){this._updateSolved()},n.prototype._onParentValueChanged=function(){this.notify("valueChanged")},n.prototype._updateSolved=function(){var e=this.areParentsSolved();e!==this._parentsSolved&&(this._parentsSolved=e,this.notify("parentsSolvedChanged"));var t=this.isSolved();t!==this._solved&&(this._solved=t,this.notify("solvedChanged"))},n.prototype.on_parentsSolvedChanged=function(){if(this.areParentsSolved())for(var e=0;e<this._parentsSolvedCBs.length;e++)this._parentsSolvedCBs[e]()},n.prototype.on_solvedChanged=function(){if(this.isSolved()){for(var e=0;e<this._isSolvedCBs.length;e++)this._isSolvedCBs[e].call(this);this._isSolvedCBs=[]}},n.prototype.getUnsolvedParents=function(e){var t=[];if(this._parents&&this._parents.length>0)for(var n=0;n<this._parents.length;n++){var i=this._parents[n];if(i){var s=i.getUnsolvedParents(!0);if(Array.isArray(s)){if(s.length>0&&!0===e&&!1===this._value)for(var r=0;r<s.length;r++){var o=s[r];o&&o.push(this)}t=t.concat(s)}}}return 0===t.length&&!0===e&&!1===this._value&&(t=[[this]]),void 0!==e&&!1!==e||1!==t.length||(t=t[0]),t},n}),define("DS/KnowledgeWebUtils/ModelUpdate",[],function(){"use strict";function e(e,t,n){this.reference=e,this.origin=null|n,this.changeId=null,this.changes=new Map(t)}return e.prototype.addChange=function(e,t){this.changes.set(e,t)},e}),define("DS/KnowledgeWebUtils/RSCLoader",["DS/WebappsUtils/WebappsUtils","DS/KnowledgeWebCore/context"],function(e,t){"use strict";var n={};return n.LoadCSS=function(n,i,s,r){if(!r){r=document;let e=t.getValue("HTMLContainer");e&&(r=e.ownerDocument)}let o=e.getWebappsBaseUrl()+n+"/"+i+s+".css";return new Promise(function(e,t){if(function(e,t){let n=!1;for(let i=0;i<e.styleSheets.length;i++)e.styleSheets[i].href===t&&(n=!0);return n}(r,o))e();else{let n=document.createElement("link");n.href=o,n.rel="stylesheet",n.type="text/css",r.getElementsByTagName("head")[0].appendChild(n),n.onload=function(){e()},n.onerror=function(){t(new Error("can not load "+this.href))}}})},n}),define("DS/KnowledgeWebUtils/KnowledgeWebTrace",[],function(){"use strict";function e(e,t){localStorage.getItem("KnowledgeWebTrace")&&""!==t&&console[e](t)}return{log:function(t){e("log",t)},warn:function(t){e("warn",t)},error:function(t){e("error",t)}}}),define("DS/KnowledgeWebUtils/Utils",[],function(){"use strict";var e={};const t=e=>null!=e;e.exists=t;e.isFunction=(e=>"function"==typeof e);e.isBoolean=(e=>"boolean"==typeof e);e.isNumeric=(e=>!isNaN(e));e.isNumber=(e=>"number"==typeof e);e.isString=(e=>"string"==typeof e);e.isObject=(e=>"object"==typeof e&&t(e));e.isArray=(e=>Array.isArray(e));e.toArray=(e=>Array.isArray(e)?e:[e]);e.isSet=(e=>e instanceof Set);e.isMap=(e=>e instanceof Map);function n(e,t){for(var n in t.prototype)e.prototype[n]=t.prototype[n];return e}return e.hasProperty=((e,t)=>Object.prototype.hasOwnProperty.call(e,t)),e.get=function(e,n){return n.replace(/\[/g,".").replace(/\]/g,"").split(".").reduce((e,n)=>t(e)?e[n]:e,e)},e.capitalizeFirstLetter=function(e){return e.charAt(0).toUpperCase()+e.slice(1)},e.uncapitalizeFirstLetter=function(e){return e.charAt(0).toLowerCase()+e.slice(1)},e.unionSetMutable=function(e,t){for(let n of t)e.add(n)},e.unionSet=function(e,t){let n=new Set(e);for(let e of t)n.add(e);return n},e.intersectionSet=function(e,t){let n=new Set;for(let i of e)t.has(i)&&n.add(i);return n},e.compareSet=function(e,t){let n=!0;if(n=e.size===t.size)for(let i of e)if(!t.has(i)){n=!1;break}return n},e.differenceSet=function(e,t){let n=new Set(e);for(var i of t)n.delete(i);return n},e.inherits=function(e,t){e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1}})},e.extend=n,e.overload=function(e,t){for(var n in t.prototype)void 0===e.prototype[n]&&(e.prototype[n]=t.prototype[n]);return e},e.enrich=function(e,t,i){t.call(e,i),n(e,t)},e.implement=function(t,n){if(t instanceof n)return!0;if(!e.exists(t)||!e.exists(n))return!1;var i,s=!0,r=e.get(t,"constructor.prototype"),o=e.get(n,"prototype");if(!e.exists(r)||!e.exists(o))return!1;for(i in o)s=s&&i in r;return!!i&&s},e.setValuePath=function(e,t,n){for(var i=t.split("."),s=e,r=0;r<i.length&&null!=s;r++)r===i.length-1?s[i[r]]=n:void 0!==s[i[r]]?s=s[i[r]]:s[i[r]]={}},e.getValuePath=function(e,t){for(var n=t.split("."),i=e,s=0;s<n.length&&null!=i;s++)i=void 0!==i[n[s]]?i[n[s]]:void 0;return i},e.traverse=function e(t,n){Array.isArray(t)?t.forEach(function(t){e(t,n)}):n(t)},e}),define("DS/KnowledgeWebUtils/Listener",["DS/KnowledgeWebUtils/Utils"],function(e){"use strict";const t=e.isFunction,n=e.exists,i=e.isString,s=e=>n(e)&&t(e.addListener)&&t(e.removeListener);function r(...t){this._listenerData={};const n=t.find(e.isObject),s=t.find(e.isFunction),o=t.find(e.isString)||"#NO_KEY#";return e.isFunction(s)||(n&&e.isFunction(n.handler)&&(e.isString(n.key)||e.isObject(n.obj))?(this._listenerData._handler=n.handler,this._listenerData._key=i(n.key)?n.key:"#NO_KEY#",this._listenerData._obj=n.obj,this._listenerData._listening=new Set):e.implement(n,r)&&(this._listenerData._handler=n._listenerData._handler,this._listenerData._key=i(n._listenerData._key)?n._listenerData._key:"#NO_KEY#",this._listenerData._obj=n._listenerData._obj,this._listenerData._listening=new Set)),this._listenerData._listening||(this._listenerData._handler=s,this._listenerData._key=o,this._listenerData._obj=n,this._listenerData._listening=new Set),this}function o(e,t){return!t||e===t}return r.prototype.listen=function(e){e&&s(e)&&e.addListener(this)},r.prototype.stop=function(e){if(e&&s(e)){this._listenerData._listening.has(e)&&this._listenerData._listening.delete(e),e.removeListener(this)}else if(void 0===e){const e=Array.from(this._listenerData._listening);for(const t of e)t.removeListener(this);this._listenerData._listening.clear()}},r.prototype.getKey=function(){return this._listenerData._key},r.prototype.getObj=function(){return this._listenerData._obj},r.prototype.getHandler=function(){return this._listenerData._handler},r.prototype.compare=function(e){return e===this||e&&e._listenerData&&o(this._listenerData._handler,e._listenerData._handler)&&o(this._listenerData._key,"#NO_KEY#"===e._listenerData._key?null:e._listenerData._key)&&o(this._listenerData._obj,e._listenerData._obj)},r.prototype._internalCB=function(t,n){e.isFunction(this._listenerData._handler)&&this._listenerData._handler.call(this._listenerData._obj,t,n)},r.prototype._addListened=function(e){this._listenerData._listening.add(e)},r.prototype._removeListened=function(e){this._listenerData._listening.delete(e)},r}),define("DS/KnowledgeWebUtils/Listenable",["DS/KnowledgeWebUtils/Utils","DS/KnowledgeWebUtils/Listener"],function(e,t){"use strict";const n=e.isString,i=e.isObject,s=e.isFunction,r=e.exists,o=e.implement,a="#NO_KEY#";function l(e){return this._listenableData={listeners:new Map,stacking:!1,children:new Set,stack:[],callingListeners:!1,listenerCleanRequired:!1},this}function d(e){let r=null,a=!1;const l=e.find(i),d=e.find(s),c=e.find(n)||"#NO_KEY#";o(l,t)?r=l:(a=!0,r=new t(l,d,c));return{listener:r,newListener:a}}return l.prototype.addListener=function(...e){const{listener:t,newListener:n}=d(e),i=t.getKey();let s=this._listenableData.listeners.get(i);if(!Array.isArray(s)){const e=[];this._listenableData.listeners.set(i,e),s=e}const r=n?s.some(t.compare.bind(t)):s.includes(t);if(!r){this._listenableData.listeners.get(i).push(t),t._addListened(this)}return r?null:t},l.prototype.removeListener=function(...e){const t=d(e);return this._removeListenerForKeyOrNoKey(t)},l.prototype.addListeners=function(e){let t=[];for(const n of e)Array.isArray(n)?t.push(this.addListener(...n)):t.push(this.addListener(n));return t},l.prototype.removeListeners=function(e){for(const t of e)Array.isArray(t)?this.removeListener(...t):this.removeListener(t)},l.prototype.notify=function(t,n,i){(e.isBoolean(i)?i:this.stacking)?this._listenableData.stack.push({evName:t,evData:n}):this._callListeners(t,n)},l.prototype.addChild=function(e){e instanceof l&&this._listenableData.children.add(e)},l.prototype.removeChild=function(e){this._listenableData.children.delete(e)},l.prototype.startStacking=function(){this._listenableData.stacking=!0,this.notify("startStacking",void 0,!1),this._propagateStackingToChildren()},l.prototype.endStacking=function(){this._listenableData.stacking=!1,this._propagateStackingToChildren(),this.sendStacked(),this.notify("endStacking",void 0,!1)},l.prototype.sendStacked=function(){this._listenableData.stack.forEach(e=>this.notify(e.evName,e.evData),this),this._listenableData.stack=[]},l.prototype.addObjListener=function(...e){return this.addListener(...e)},l.prototype.removeObjListener=function(...e){return this.removeListener(...e)},Object.defineProperty(l.prototype,"stacking",{get:function(){return this._listenableData.stacking},set:function(e){e!==this._listenableData.stacking&&(!0===e?this.startStacking():!1===e?this.endStacking():console.warning("Invalid value set to Listenable.stacking"))}}),l.prototype._propagateStackingToChildren=function(){this._listenableData.children.forEach(function(e){e.stacking=this._listenableData.stacking},this)},l.prototype._removeListenerForKey=function(t,n){const{listener:i,newListener:s}=n;let r=!1;const o=this._listenableData.listeners.get(t);if(e.isArray(o)){const e=s?function(e,t){let n=[];for(let i=0;i<e.length;i++)e[i]&&e[i].compare(t)&&n.push(i);return n}(o,i):[o.indexOf(i)];for(const t of e)t>=0&&t<o.length&&(o[t]=null,i._removeListened(this),r=!0);e.length>0&&this._cleanListenersForKey(t)}return r},l.prototype._removeListenerForKeyOrNoKey=function(e){const t=e.listener.getKey();if(t===a)for(const[t]of this._listenableData.listeners)this._removeListenerForKey(t,e);else this._removeListenerForKey(t,e);return!1},l.prototype._cleanListenersForKey=function(e){if(this._listenableData.listenerCleanRequired){const t=this._listenableData.listeners.get(e);Array.isArray(t)&&this._listenableData.listeners.set(e,t.filter(r))}},l.prototype._callListeners=function(t,n){var i=t;void 0===i&&(i=a),void 0!==this["on_"+t]&&this["on_"+t](n),this._listenableData.callingListeners=!0;const s=this._listenableData.listeners.get(i);if(Array.isArray(s))for(let t of s)e.exists(t)&&e.isFunction(t._internalCB)?t._internalCB(this,n):this._listenableData.listenerCleanRequired=!0;const r=this._listenableData.listeners.get(a);if(a!==i&&Array.isArray(r))for(let t of r)e.exists(t)&&e.isFunction(t._internalCB)?t._internalCB(this,n):this._listenableData.listenerCleanRequired=!0;this._listenableData.callingListeners=!1,this._cleanListenersForKey(a),a!==i&&this._cleanListenersForKey(i)},l}),define("DS/KnowledgeWebUtils/Mouse",["DS/KnowledgeWebUtils/Utils","DS/KnowledgeWebUtils/Listenable","DS/KnowledgeWebCore/context"],function(e,t,n){"use strict";var i,s;function r(){return t.call(this),this.cursorElt="",this.x=0,this.y=0,this.r=!1,this.m=!1,this.l=!1,this.drag={dragging:!1,moved:!1,initialPos:{x:0,y:0},finalPos:{x:0,y:0},significant:!1},this}function o(t,n){e.isObject(n)&&e.exists(n.new)&&(i=n.new)}e.inherits(r,t),r.prototype.significantDrag=function(){return this.drag.moved&&function(e,t){var n=0;if(void 0!==e&&void 0!==t&&void 0!==e.x&&void 0!==t.x&&void 0!==e.y&&void 0!==t.y){var i=e.x-t.x,s=e.y-t.y;n=Math.pow(Math.pow(i,2)+Math.pow(s,2),.5)}return n}(this.drag.initialPos,this)>10},r.prototype.setCursor=function(e=""){""!=this.cursorElt&&i.classList.remove(this.cursorElt),this.cursorElt=e,""!=e&&i.classList.add(e)};var a=new r;function l(e){var t=e.clientX||e.pageX,n=e.clientY||e.pageY;a.x!==t&&a.y!==n&&(a.x=t,a.y=n,a.drag.dragging&&(a.drag.moved=!0,a.drag.significant||a.significantDrag()&&(a.drag.significant=!0,a.notify("significantdrag",e))),a.notify("move",e))}function d(e){switch(a.x=e.x,a.y=e.y,e.button){case 0:a.l=!0,a.notify("ldown",e);break;case 1:a.m=!0,a.notify("mdown",e);break;case 2:a.r=!0,a.notify("rdown",e)}a.drag.dragging=!0,a.drag.moved=!1,a.drag.initialPos.x=e.clientX||e.pageX,a.drag.initialPos.y=e.clientY||e.pageY,a.drag.finalPos.x=0,a.drag.finalPos.y=0,a.drag.significant=!1,a.notify("down",e)}function c(e){switch(e.button){case 0:a.l=!1,a.notify("lup",e);break;case 1:a.m=!1,a.notify("mup",e);break;case 2:a.r=!1,a.notify("rup",e)}a.drag.dragging=!1,a.drag.finalPos.x=e.clientX||e.pageX,a.drag.finalPos.y=e.clientY||e.pageY,a.notify("up",e),a.drag.significant||a.notify("click",e)}function h(){var e=n.getValue("graphWindowOpened");window.removeEventListener("mousemove",l,!0),window.removeEventListener("mousedown",d,!0),window.removeEventListener("mouseup",c,!0),e&&(e.addEventListener("mousemove",l,!0),e.addEventListener("mousedown",d,!0),e.addEventListener("mouseup",c,!0),s=e)}function u(){var e=n.getValue("graphWindowClosed");e&&(e.removeEventListener("mousemove",l,!0),e.removeEventListener("mousedown",d,!0),e.removeEventListener("mouseup",c,!0))}return a.init=function(){(i=n.getValue("HTMLContainer"))?((s=i.ownerDocument.defaultView||i.ownerDocument.parentWindow).addEventListener("mousemove",l,!0),s.addEventListener("mousedown",d,!0),s.addEventListener("mouseup",c,!0)):i=document.querySelector("#displayGraph"),n.addListener(h,"graphWindowOpenedChanged"),n.addListener(u,"graphWindowClosedChanged"),n.addListener(o,"HTMLContainerChanged")},a.end=function(){n.removeListener(o,"HTMLContainerChanged"),n.removeListener(h,"graphWindowOpenedChanged"),n.removeListener(u,"graphWindowClosedChanged"),s&&(s.removeEventListener("mousemove",l,!0),s.removeEventListener("mousedown",d,!0),s.removeEventListener("mouseup",c,!0))},a}),define("DS/KnowledgeWebUtils/JSONifier",["DS/KnowledgeWebUtils/Utils","DS/KnowledgeWebUtils/KnowledgeWebTrace"],function(e,t){"use strict";const n=new Map,i={object2Json:function(s,r){if(e.isArray(s))return s.map(i.object2Json);if(e.isObject(s)&&e.isFunction(s.object2Json)){const i=s.object2Json(r);if(e.isObject(i)&&e.exists(i.key)&&e.isObject(i.json))return e.isFunction(i.func)&&n.set(i.key,i.func),{JSONifierKey:i.key,value:i.json};t.error("JSONifier error: object2Json method didn't return the expected object with key, func and json attributes.")}else if(!e.isObject(s))return s},json2Object:function(s){if(e.isArray(s))return s.map(i.json2Object);if(e.isObject(s)&&e.exists(s.JSONifierKey)&&e.exists(s.value)){if(n.has(s.JSONifierKey)){return n.get(s.JSONifierKey)(s.value)}t.error("JSONifier error: json2Object method doesn't have any function for this key: "+s.JSONifierKey)}return s}};return i}),define("DS/KnowledgeWebUtils/Model",["DS/KnowledgeWebUtils/Utils","DS/KnowledgeWebUtils/Listenable","DS/KnowledgeWebUtils/ModelUpdate","DS/KnowledgeWebUtils/JSONifier"],function(e,t,n,i){"use strict";const s="__all__";class r extends t{constructor(e){super(),this.init(e)}init(e){this.reference=null,this.loaded=!1,this.initAttributes(),this._ModelInternals={toResolveLoadPromise:[],changeIdMap:new Map,refCount:0},e&&(e.reference&&(this.reference=e.reference),void 0!==e.loaded&&null!==e.loaded&&(this.loaded=e.loaded),e.changes instanceof Map&&this.update(e.changes,null,e.container)),this.addListener("loadedChange",this.on_loadedChange.bind(this))}initAttributes(){}destroy(){}addAttribute(e){Object.defineProperty(this,e.name,{set:function(t){this.hasOwnProperty("_"+e.name)||(this["_"+e.name]=null),this.set(e.name,t)},get:function(){return this.get("_"+e.name)}})}get(e){return this[e]}setArray(e,t){var n,i,s,r,o,a,l=[];for(Array.isArray(this[e])||(this[e]=[]),i=this.get(e),o=(n=this[e].length)>(r=t.length)?n:r,a=0;a<o;a++)a<n?i[a]:null,s=a<r?t[a]:null,a<n&&a<r||a>=n&&a<r&&(i.push(s),l.indexOf(s)>-1||this.notify(e+"ItemAdded"))}call(t,n){if(t._callBack=n,this.notify("UIChange",t),e.exists(t.impactedAttributes)&&t.changeId){let n=e.toArray(t.impactedAttributes);for(let e of n)this._addChangeId("all"===e?"":e,t.changeId)}}set(t,n,i,s){var r,o,a=t;this.hasOwnProperty("_"+t)&&(a="_"+t),r=this.get(t),(e.isObject(n)&&e.isFunction(n.compare)?n.compare(r):n===r)||(this[a]=n,o={model:this,changeType:"attributeChange",attrName:t,oldValue:r,newValue:n,origin:!0===i?"server":"UI",data:s},this.notify(t+"Change",o),!0!==i&&this.notify("UIChange",o))}update(t,i,s){const o=t instanceof Map?t:t.changes,a=e.isObject(t)&&e.exists(t.changeId)?t.changeId:null;if(o instanceof Map)for(var[l,d]of o){d instanceof Object&&(Array.isArray(d)||d instanceof n&&(d=s?s.update(d):new r(d)));let t={lastChange:!0};e.exists(a)&&!this._checkChangeId(l,a)&&(t.lastChange=!1),this.set(l,d,!i,t)}}getLoadPromise(){var e,t=this;return e=new Promise(function(e){t.loaded?e(t):t._ModelInternals.toResolveLoadPromise.push(e)}),t.loaded||this.call({model:this,changeName:"GetLoad",changeType:"actionCall",origin:"UI"}),e}on_loadedChange(e,t){var n=this;t&&!0===t.newValue&&(n._ModelInternals.toResolveLoadPromise.forEach(function(e){e(n)}),n._ModelInternals.toResolveLoadPromise=[])}toValue(){return{name:this.name,type:"Feature",value:this.reference}}addRef(){this._ModelInternals.refCount++}release(e){if(this._ModelInternals.refCount--,this._ModelInternals.refCount<=0){this.notify();const t={model:this,changeType:"released",origin:"UI"};this.notify("UIChange",t),e&&this.deleteMe()}}deleteMe(){this.notify("requestForDestruction")}object2Json(){return{key:"Model.js",func:r.json2Object,json:{reference:this.reference,attributes:[{key:"webtype",value:this.webtype}]}}}static json2Object(t){const s=new n(t.reference);if(e.isArray(t.attributes))for(let e of t.attributes)s.addChange(e.key,i.json2Object(e.value));return s}_checkChangeId(t,n){const i=this._ModelInternals.changeIdMap,r=[0];return i.has(s)&&r.push(i.get(s)),e.isString(t)&&t.length>0&&i.has(t)&&r.push(i.get(t)),n>=Math.max(...r)}_addChangeId(t,n){const i=this._ModelInternals.changeIdMap;e.isString(t)&&t.length>0?i.set(t,n):i.set(s,n)}_removeChangeId(t,n){const i=this._ModelInternals.changeIdMap;e.isString(t)&&t.length>0?i.delete(t):i.delete(s)}}return r}),define("DS/KnowledgeWebUtils/ModelSynchronizer",["DS/KnowledgeWebUtils/Utils","DS/KnowledgeWebUtils/ModelUpdate"],function(e,t){"use strict";var n=1;function i(e){this.responseCB=new Map,this._stacking=!1,this._stack=[],e&&(e.container&&(this._container=e.container,this._container.addListener("modelAdded",this.onNewModel.bind(this))),e.decoder&&(this._decoder=e.decoder),e.encoder&&(this._encoder=e.encoder),e.onChangeCB&&(this._onChangeCB=e.onChangeCB))}return i.prototype.stackMessages=function(e){this._stacking!==e&&(this._stacking=e,!1===this._stacking&&(this.encodeAndSend(this._stack),this._stack=[]))},i.prototype.onMessage=function(n,i){this._container.lock();const s=this._decoder(n,this._container),[r,o]=s instanceof t?[s,null]:[s.changes,s.responseData],a=r&&this._container?this._container.update(r):o;this._container.unlock();const l=[];if(o){const t=this.responseCB.get(o.id);if(e.isFunction(t)){let n=t(o);e.isArray(i)&&n instanceof Promise&&l.push(n)}}return a},i.prototype.onNewModel=function(e,t){t.addListener("UIChange",this.onModelChange.bind(this))},i.prototype.onModelChange=function(e,t){const i=n++;t&&"UI"===t.origin&&(t._callBack&&(this.responseCB.set(i,t._callBack),delete t._callBack),t.changeId=i,this._stacking?this._stack.push(t):this.encodeAndSend(t))},i.prototype.encodeAndSend=function(t){const n=this._encoder.encode(t);e.exists(n)&&e.isFunction(this._onChangeCB)&&this._onChangeCB(n,t)},i}),define("DS/KnowledgeWebUtils/ModelContainer",["DS/KnowledgeWebUtils/Listenable","DS/KnowledgeWebUtils/Utils","DS/KnowledgeWebUtils/Model","DS/KnowledgeWebUtils/JSONifier"],function(e,t,n,i){"use strict";return class extends e{constructor(e){super(),this._modelsMap=new Map,this._lock=0,this._factory=null,t.exists(e)&&(this._factory=e)}addModel(e){this._modelsMap.set(e.reference,e),this.addChild(e),e.addObjListener(this,this.onRequestForDestruction,"requestForDestruction"),this.notify("modelAdded",e)}getModel(e){return this._modelsMap.get(e)}onRequestForDestruction(e){this.deleteModel(e)}deleteModel(e){const n=t.isObject(e)?e.reference:e,i=this._modelsMap.get(n);i&&(i.removeObjListener(this,this.onRequestForDestruction,"requestForDestruction"),i.destroy(),this._modelsMap.delete(n),this.removeChild(i))}empty(){for(const[e]of this._modelsMap)this.deleteModel(e)}lock(){this._lock++,1===this._lock&&this.startStacking()}unlock(){this._lock--,this._lock<1&&(this._lock=0,this.endStacking())}islock(){return this._lock>0}_createModelFromUpdateOrder(e){return t.exists(this._factory)?this._factory.create(e):new n(e)}update(e){let n=null;return t.exists(e.reference)?(this.lock(),n=this.getModel(e.reference),t.isObject(n)||(e.container=this,n=this._createModelFromUpdateOrder(e),this.addModel(n)),t.isObject(n)&&n.update(e,null,this),this.unlock()):n=this._createModelFromUpdateOrder(e),n}captureState(){let e={modelsMap:[]};for(let[t,n]of this._modelsMap)e.modelsMap.push({key:t,value:i.object2Json(n)});return e}restoreState(e){if(t.isObject(e)&&t.isArray(e.modelsMap)){const t=new Set;for(let[e,n]of this._modelsMap)t.add(e);for(let{key:n,value:s}of e.modelsMap){t.delete(n);const e=i.json2Object(s);this.update(e)}for(let e of t)this.deleteModel(e)}}}}),define("DS/KnowledgeWebUtils/ModelFactory",["DS/KnowledgeWebUtils/Model","DS/KnowledgeWebUtils/Utils"],function(e,t){"use strict";function n(e){this._modelsConstructors=e}return n.prototype.create=function(n){var i,s=null;if(n&&n.changes instanceof Map){(s=n.changes.get("webtype"))||(s="");const r=this._modelsConstructors.get(s+"Model");i=t.isFunction(r)?new r(n):new e(n)}else i=new e(n);return i},n}),define("DS/KnowledgeWebUtils/ModelManager",["DS/KnowledgeWebUtils/Utils","DS/KnowledgeWebUtils/ModelFactory","DS/KnowledgeWebUtils/ModelContainer","DS/KnowledgeWebUtils/ModelSynchronizer"],function(e,t,n,i){"use strict";return class{constructor(e){this.factory=null,this.container=null,this.synchronizer=null,this.onMessageCB=null,e&&(e.constructors&&(this.factory=new t(e.constructors),this.container=new n(this.factory)),e.encoder&&e.decoder&&(this.synchronizer=new i({container:this.container,decoder:e.decoder,encoder:e.encoder,onChangeCB:e.onMessageCB})))}update(t){return e.exists(this.synchronizer)?this.synchronizer.onMessage(t):null}stackMessages(t){e.exists(this.synchronizer)&&this.synchronizer.stackMessages(t)}captureState(){return e.exists(this.container)&&e.isFunction(this.container.captureState)&&JSON.stringify(this.container.captureState())||""}restoreState(t){const n=JSON.parse(t);e.exists(this.container)&&e.isFunction(this.container.restoreState)&&this.container.restoreState(n)}}}),define("DS/KnowledgeWebUtils/ListenerSet",["DS/KnowledgeWebUtils/Utils","DS/KnowledgeWebUtils/Listener"],function(e,t){"use strict";const n=e.implement;function i(){this._ListeningData={},this._ListeningData._listeners=[]}return i.prototype.addListener=function(...i){const s=i.find(e.isObject);if(n(s,t))this._ListeningData._listeners.push(s);else{var r=new t(...i);this._ListeningData._listeners.push(r)}},i.prototype.addListeners=function(e){for(const t of e)Array.isArray(t)?this.addListener(...t):this.addListener(t)},i.prototype.listen=function(e){for(var t=0;t<this._ListeningData._listeners.length;t++)this._ListeningData._listeners[t].listen(e)},i.prototype.stop=function(e){for(var t=0;t<this._ListeningData._listeners.length;t++)this._ListeningData._listeners[t].stop(e)},i}),define("DS/KnowledgeWebUtils/baseObject",["DS/KnowledgeWebUtils/Utils","DS/KnowledgeWebUtils/Listenable","DS/KnowledgeWebUtils/Listener","DS/KnowledgeWebUtils/ListenerSet","DS/KnowledgeWebUtils/Dependency"],function(e,t,n,i,s){"use strict";var r={};for(let t in e)r[t]=e[t];return r.Listenable=t,r.Listener=n,r.Listening=i,r.Dependency=s,r});