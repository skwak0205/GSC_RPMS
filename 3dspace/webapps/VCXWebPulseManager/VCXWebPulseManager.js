define("DS/VCXWebPulseManager/VCXAPulseBehavior",["UWA/Class","DS/CoreEvents/Events","DS/VCXWebProperties/VCXProperty","DS/VCXWebProperties/VCXPropertyGroup","DS/VCXWebProperties/VCXPropertyInfo","DS/VCXWebProperties/VCXPropertyInfoEnum","DS/VCXWebProperties/VCXPropertyValueEnum","DS/VCXWebProperties/VCXPropertyValueBoolean","i18n!DS/VCXWebPulseManager/assets/nls/VCXWebPulseManager"],function(e,t,r,n,i,o,s,a,u){"use strict";var l=e.extend({init:function(){this._type=0,this._condition=0,this._conditionChanged=!1,this._period=1,this._loop=!0,this._sinusMode=!0,this._pauseAnim=!0,this._isPulsing=!1,this._isDirty=!1},OnChangeProperty:function(e,r,n){var i=r.GetValue();switch(e){case"Actor.Pulse.Type":if(this._type!==i&&(this._type=i),n&&n.rangeChanged){t.publish({event:"VCX_CHANGE_PULSE_PROPERTY",data:this})}break;case"Actor.Pulse.Condition":if(this._condition!==i){this._condition=i;var o=this.GetObject()._experienceBase.getManager("VCXPulseManager");o&&(this._condition===l.ECondition.OnHighlight?o.RegisterInteractableObject(this.GetObject()):o.UnRegisterInteractableObject(this.GetObject()))}break;case"Actor.Pulse.Period":this._period!==i&&(this._period=i);break;case"Actor.Pulse.Loop":this._loop!==i&&(this._loop=i);break;case"Actor.Pulse.Sinus":this._sinusMode!==i&&(this._sinusMode=i);break;case"Actor.Pulse.PauseAnim":this._pauseAnim!==i&&(this._pauseAnim=i);break;default:return!1}return!0},GetProperty:function(e){var t=null,n=this.GetObject()._experienceBase.getManager("VCXContextManager").getPlayerMode();let u=this.GetPropertiesi18n();if("Actor.Pulse.Type"===e){(p=new s).SetValue(this._type);var l=new o(e,0,!0,u),c=this.GetMapChoices();l.SetMapChoiceEnum(c),l.SetGroupId("Group.Effect"),n&&l.SetVisible(!1),t=new r(l,p)}else if("Actor.Pulse.Condition"===e){(p=new s).SetValue(this._condition);c={0:"effect.condition.onStart",1:"effect.condition.onHighlight"};(l=new o(e,1,!0,u)).SetMapChoiceEnum(c),l.SetGroupId("Group.Effect"),n&&l.SetVisible(!1),t=new r(l,p)}else if("Actor.Pulse.Period"===e){var p;(p=new s).SetValue(this._period);c={0:"effect.period.high",1:"effect.period.medium",2:"effect.period.low"};(l=new o(e,0,!0,u)).SetMapChoiceEnum(c),l.SetGroupId("Group.Effect"),t=new r(l,p)}else if("Actor.Pulse.Loop"===e){(P=new a).SetValue(this._loop),(h=new i(e,1,!0,u)).SetGroupId("Group.Effect"),n&&h.SetVisible(!1),t=new r(h,P)}else if("Actor.Pulse.Sinus"===e){(P=new a).SetValue(this._sinusMode),(h=new i(e,1,!0,u)).SetGroupId("Group.Effect"),n&&h.SetVisible(!1),t=new r(h,P)}else if("Actor.Pulse.PauseAnim"===e){var P,h;(P=new a).SetValue(this._pauseAnim),(h=new i(e,1,!0,u)).SetGroupId("Group.Effect"),n&&h.SetVisible(!1),t=new r(h,P)}else t=null;return t},GetProperties:function(e){if(e.AddOrModifyProperty(this.GetProperty("Actor.Pulse.Type")),0!==this._type){e.AddOrModifyProperty(this.GetProperty("Actor.Pulse.Condition")),e.AddOrModifyProperty(this.GetProperty("Actor.Pulse.Period")),e.AddOrModifyProperty(this.GetProperty("Actor.Pulse.Loop")),e.AddOrModifyProperty(this.GetProperty("Actor.Pulse.Sinus")),this._condition===l.ECondition.OnStart&&e.AddOrModifyProperty(this.GetProperty("Actor.Pulse.PauseAnim"));for(var t=this.GetVectorProperties(),r=0;r<t.length;r++){var n=t[r];e.AddOrModifyProperty(this.GetProperty(n))}}},getPropertyGroups:function(e){e||(e={});var t=this.getGroupPropertiesOrders();let r=this.GetPropertiesi18n();return e["Group.Effect"]||(e["Group.Effect"]=new n({groupID:"Group.Effect"}),e["Group.Effect"].i18nGroup=r),e["Group.Effect"].setPropertiesOrder(t["Group.Effect"]),e["Group.Effect"].priority=100,e["Group.Effect"].addProperties([{propertyName:"Actor.Pulse.Type",i18n:r}]),0!==this._type&&e["Group.Effect"].addProperties([{propertyName:"Actor.Pulse.Condition",i18n:r},{propertyName:"Actor.Pulse.Period",i18n:r},{propertyName:"Actor.Pulse.Loop",i18n:r},{propertyName:"Actor.Pulse.Sinus",i18n:r}]),e},getGroupPropertiesOrders:function(){return{"Group.Effect":["Actor.Pulse.Type","Actor.Pulse.Condition","Actor.Pulse.Period","Actor.Pulse.Loop","Actor.Pulse.Sinus"]}},GetPropertiesi18n:function(){return u},SetIsPulsing:function(e){this._isPulsing=e},GetIsPulsing:function(){return this._isPulsing},SetIsDirty:function(e){this._isDirty=e},GetIsDirty:function(){return this._isDirty},GetVectorProperties:function(){},GetMapChoices:function(){}});return l.ECondition={OnStart:0,OnHighlight:1},l}),define("DS/VCXWebPulseManager/VCXPulseManager",["DS/CoreEvents/Events","DS/VCXWebExperienceBase/VCXInteractableObjectsManager","DS/VisuEvents/EventsManager","DS/VCXWebModifiablesServices/VCXModifiablesAccess","DS/VCXWebKernelCommands/VCXCmdChangeKeys","DS/VCXWebKernelCommands/VCXCmdPlayScenario","DS/VCXWebKernelCommands/VCXCmdChangePropertiesVolatile"],function(e,t,r,n,i,o,s){"use strict";var a=t.extend({initialize:function(){this._parent(),this._tokens={previewMode:null,currentScenario:null,pulseProperty:null,startPlay:null,startPlayTimeline:null,stopPlayTimeline:null,changeTimePos:null,scenarioChanged:null,undoRedoDone:null,frameBackward:null,frameForward:null,prevmarker:null,nextMarker:null},this._modUnderMouse=null,this._mapOfPulseBeh={}},onPreviewModeFunc:function(e){(this.SetPreviewMode(e),e)?this._experienceBase.getManager("VCXScenarioManager").GetIsPlayingCurrentScenario()||this.onActivateOnStart():this.StopPulseAllObjects()},postInitialize:function(){var t=this;this._tokens.previewMode=e.subscribe({event:"VCX_PREVIEW_MODE_CHANGED"},this.onPreviewModeFunc.bind(this)),this._tokens.startPlay=e.subscribe({event:"VCX_START_PLAY"},function(){t._bPreviewMode&&t.StopPulseAllObjects()}),this._tokens.startPlayTimeline=e.subscribe({event:"VCX_Timeline_START_PLAY"},function(){t._bPreviewMode&&t.StopPulseAllObjects()}),this._tokens.stopPlayTimeline=e.subscribe({event:"VCX_Timeline_STOP_PLAY"},function(){t._bPreviewMode&&t.StopPulseAllObjects()});var i=function(r){if(t._bPreviewMode)if(0!==Object.keys(t._mapOfPulseBeh).length&&r){t.StopPulseAllObjects();var n=e.subscribe({event:"VCX_PULSE_STOPPED"},function(){e.unsubscribe(n),r||t.onActivateOnStart()})}else t.onActivateOnStart()};this._tokens.changeTimePos=e.subscribe({event:"VCX_TIMEPOS_CHANGED"},function(){t._bPreviewMode&&i()}),this._tokens.undoRedoDone=e.subscribe({event:"VCX_UNDOREDO_DONE"},function(){t._bPreviewMode&&i()}),this._tokens.scenarioChanged=e.subscribe({event:"VCX_CURRENT_SCENARIO_CHANGED"},function(){var e=t._experienceBase.getManager("VCXCommandManager");e._isUnDoRunning||e._isReDoRunning||i()}),this._tokens.frameBackward=e.subscribe({event:"VCX_Timeline_STEPBACKWARD_PLAY"},function(){i()}),this._tokens.frameForward=e.subscribe({event:"VCX_Timeline_STEPFORWARD_PLAY"},function(){i()}),this._tokens.prevmarker=e.subscribe({event:"VCX_Timeline_PREVIOUSMARKER_PLAY"},function(){i()}),this._tokens.nextMarker=e.subscribe({event:"VCX_Timeline_NEXTMARKER_PLAY"},function(){i()}),this._tokens.pulseProperty=e.subscribe({event:"VCX_CHANGE_PULSE_PROPERTY"},function(r){var n=r;if(n&&t._bPreviewMode)if(0!==n.GetProperty("Actor.Pulse.Type").GetPropertyValue().GetValue()){var i=t._experienceBase.getManager("VCXScenarioManager").GetIsPlayingCurrentScenario(),o=n.GetProperty("Actor.Pulse.PauseAnim").GetPropertyValue().GetValue();if(i&&o){if(!t._bPassed){t._bPassed=!0;var s=t._experienceBase.getManager("VCXScenarioManager").GetCurrentFrame(),a=t.GetFrameForStop(n,s);if(0===a)return;a!==s&&t._experienceBase.getManager("VCXScenarioManager").SetCurrentFrame(a),t._experienceBase.getManager("VCXScenarioManager").UpdateProperties()}t.onActivateOnStart(!0),t._experienceBase.getManager("VCXScenarioManager").SetIsPlayingCurrentScenario(!1),e.publish({event:"VCX_PAUSE_PLAY",data:a}),t._bPassed=!1}}else n.GetIsPulsing()&&t.StopPulseOneObject(n)});t=this;this._onVisuEvent=function(e){if(t._bPreviewMode&&t.GetActiveInteraction()){var r=n.GetModifiableFromEvent(e,t._experienceBase);r?(t.StopPulseOnHighlight(r),t.onActivateOnHighlight(r)):(t.StopPulseOnHighlight(),t._modUnderMouse=null)}},r.addEvent(this._experienceBase.getManager("VCXContextManager").getMainViewer().canvas,"onPrimaryPointerMoveUnique",this._onVisuEvent)},unInitialize:function(){for(var t in this._parent(),this._tokens)this._tokens.hasOwnProperty(t)&&e.unsubscribe(this._tokens[t]);this._tokens={},r.removeEvent(this._experienceBase.getManager("VCXContextManager").getMainViewer().canvas,"onPrimaryPointerMoveUnique",this._onVisuEvent)},SetPreviewMode:function(e){this._bPreviewMode=e},GetFrameForStop:function(e,t){var r=t,n=this._experienceBase.getManager("VCXScenarioManager").GetCurrentScenario(),i=this._experienceBase.ComponentsMap.GetComponentFromID(n),o=e.QueryInterface("VCXIModifiable"),s=i.GetObjectAnimation(o.GetHashing()).GetTrack("Actor.Pulse.Type").GetPreviousKey(t,s);return s.GetValue()&&(r=s.GetFrame()),r},StopPulseOnHighlight:function(e){if(this._modUnderMouse){var t="",r=this._modUnderMouse.GetHashing();e&&(t=e.GetHashing()),r!==t&&this.StopPulseOneObject(this._modUnderMouse.QueryInterface("VCXIPulseBehavior"))}},ReturnPulsingObjects:function(){return this._mapOfPulseBeh},StopPulse:function(t,r){var n=Object.keys(this.ReturnPulsingObjects()).length;if(this._bPreviewMode&&0!==n){var i=e.subscribe({event:"VCX_PULSE_STOPPED"},function(){e.unsubscribe(i),t&&t(r)});this.StopPulseAllObjects()}else t&&t(r)},StopPulseAllObjects:function(){for(var e in this._mapOfPulseBeh)if(this._mapOfPulseBeh.hasOwnProperty(e)){var t=this._experienceBase.ComponentsMap.GetComponentFromID(e);if(t){t.QueryInterface("VCXIPulseBehavior").SetIsDirty(!0);var r=this._mapOfPulseBeh[e];r&&r.StopPlayingScenario()}}},StopPulseOneObject:function(e){if(e){e.SetIsDirty(!0);var t=e.GetObject();if(t){var r=t.GetID(),n=this._mapOfPulseBeh[r];n&&n.StopPlayingScenario()}}},onActivateOnHighlight:function(e){var t=this._experienceBase.getManager("VCXScenarioManager").GetIsPlayingCurrentScenario(),r=e.GetObject().QueryInterface("VCXIPulseBehavior");r&&!t&&(1===r.GetProperty("Actor.Pulse.Condition").GetPropertyValue().GetValue()&&(this._modUnderMouse=e,this.UpdatePulse(r)))},onActivateOnStart:function(e){var t=this._experienceBase.getManager("VCXScenarioManager").GetCurrentScenario(),r=this._experienceBase.ComponentsMap.GetComponentFromID(t),n=this._experienceBase.getManager("VCXScenarioManager").GetCurrentFrame(),i=[];r&&r.GetListModifiables(i);for(var o=0;o<i.length;o++){var s=i[o],a=this._experienceBase.getManager("VCXScenarioManager").ModifiableServer.GetModifiableFromHashing(s).GetObject().QueryInterface("VCXIPulseBehavior");if(a)if(0===a.GetProperty("Actor.Pulse.Condition").GetPropertyValue().GetValue()){if(e){var u=r.GetObjectAnimation(s).GetTrack("Actor.Pulse.Type");if(!u||!u.GetKey(n))continue}this.UpdatePulse(a)}}},UpdatePulse:function(t){var r=0,n=!0;if(t&&(n=t.GetIsPulsing(),r=t.GetProperty("Actor.Pulse.Type").GetPropertyValue().GetValue()),0!==r&&!n){var a=t.GetVectorProperties();if(a.length){var u=this._experienceBase.Factory.BuildComponent("VCXScenario");u.SetApplyNeutralAtGoToScenario(!1);var l=t.GetProperty("Actor.Pulse.Period").GetPropertyValue().GetValue(),c=25,p=50;1===l?(c=40,p=80):2===l&&(c=50,p=100);var P=new s;P.SetLockEvents(!0);var h=new s,C=new i(this._experienceBase.getManager("VCXScenarioManager"));C.SetLockEvents(!0);for(var f=t.GetObject().QueryInterface("VCXIModifiable"),g=t.GetProperty("Actor.Pulse.Sinus").GetPropertyValue().GetValue(),_=0;_<a.length;_++){var d=a[_],V=f.GetProperty(d).Clone().GetPropertyValue(),b=d.substr(6),S=f.GetProperty(b).Clone(),y=S.GetPropertyValue();h.ChangeProperty(f,S);var G=S.Clone();G.SetPropertyValue(V),P.ChangeProperty(f,G),C.ChangeKey(u,f,b,0,V),C.ChangeKey(u,f,b,c,y),g&&C.ChangeKey(u,f,b,p,V)}this._experienceBase.getManager("VCXCommandManager").Do(C);var v=this,M=function(r){v._experienceBase.getManager("VCXCommandManager").Do(r),t.SetIsPulsing(!1),t.SetIsDirty(!1),v.RemovePulsingObject(t),0===Object.keys(v._mapOfPulseBeh).length&&e.publish({event:"VCX_PULSE_STOPPED"})},m=new o(this._experienceBase.getManager("VCXScenarioManager"),this._experienceBase.ComponentsMap,this._experienceBase.getManager("VCXCommandManager"));m.PlayScenario(u,0,!0);var A=function(e){t.GetIsDirty()?M(h):(t.GetProperty("Actor.Pulse.Loop").GetPropertyValue().GetValue()?e.SetCallback(A,e):e.SetCallback(M,h),v._experienceBase.getManager("VCXCommandManager").Do(e))};t.SetIsPulsing(!0),this.AddPulsingObject(t,m),P.SetCallback(A,m),this._experienceBase.getManager("VCXCommandManager").Do(P)}}},AddPulsingObject:function(e,t){this._mapOfPulseBeh[e.GetObject().GetID()]=t},RemovePulsingObject:function(e){var t=e.GetObject().GetID();delete this._mapOfPulseBeh[t]}});return Object.defineProperty(a.prototype,"componentType",{enumerable:!0,get:function(){return"VCXPulseManager"}}),a}),define("DS/VCXWebPulseManager/VCXIPulseBehavior",["DS/WebComponentModeler/CATWebInterface"],function(e){"use strict";return e.singleton({interfaceName:"VCXIPulseBehavior",required:{OnChangeProperty:function(e,t){},GetProperty:function(e){},GetProperties:function(e){},SetIsPulsing:function(e){},GetIsPulsing:function(){},GetVectorProperties:function(){},GetMapChoices:function(){}},optional:{}})}),define("DS/VCXWebPulseManager/VCXPulseBehaviorDressupPanel",["DS/VCXWebProperties/VCXColor","DS/VCXWebProperties/VCXProperty","DS/VCXWebProperties/VCXPropertyInfo","DS/VCXWebPulseManager/VCXAPulseBehavior","DS/VCXWebProperties/VCXPropertyValueColor","i18n!DS/VCXWebPulseManager/assets/nls/VCXWebPulseManager"],function(e,t,r,n,i,o){"use strict";return n.extend({init:function(){this._parent(),this._imageColor=new e,this._imageColor.SetRGBA(1,0,0,1),this._backgroundColor=new e,this._backgroundColor.SetRGBA(1,0,0,1)},OnChangeProperty:function(e,t,r){var n=t.GetValue();if("Pulse.Collab.Image.Color"===e)n.r===this._imageColor.r&&n.g===this._imageColor.g&&n.b===this._imageColor.b||(this._imageColor=n);else{if("Pulse.Collab.Background.Color"!==e)return this._parent(e,t,r);n.r===this._backgroundColor.r&&n.g===this._backgroundColor.g&&n.b===this._backgroundColor.b||(this._backgroundColor=n)}return!0},GetProperty:function(e){var n=null;if("Pulse.Collab.Image.Color"===e)(s=new i).SetValue(this._imageColor),(a=new r(e,0,!0,o)).SetGroupId("Group.Effect"),n=new t(a,s);else if("Pulse.Collab.Background.Color"===e){var s,a;(s=new i).SetValue(this._backgroundColor),(a=new r(e,0,!0,o)).SetGroupId("Group.Effect"),n=new t(a,s)}else n=this._parent(e);return n},GetMapChoices:function(){return{0:"effect.type.none",1:"effect.type.pulse.color"}},GetVectorProperties:function(){var e=[];return 1===this._type&&(e.push("Pulse.Collab.Image.Color"),e.push("Pulse.Collab.Background.Color")),e}})}),define("DS/VCXWebPulseManager/VCXPulseBehaviorOccurrence",["DS/VCXWebProperties/VCXColor","DS/VCXWebProperties/VCXProperty","DS/VCXWebProperties/VCXPropertyInfo","DS/VCXWebPulseManager/VCXAPulseBehavior","DS/VCXWebProperties/VCXPropertyValueFloat","DS/VCXWebProperties/VCXPropertyValueColor","i18n!DS/VCXWebPulseManager/assets/nls/VCXWebPulseManager"],function(e,t,r,n,i,o,s){"use strict";return n.extend({init:function(){this._parent(),this._color=new e,this._color.SetRGBA(1,0,0,1),this._opacity=1},OnChangeProperty:function(e,t,r){var n=t.GetValue();switch(e){case"Pulse.Actor.Color":n.r===this._color.r&&n.g===this._color.g&&n.b===this._color.b||(this._color=n);break;case"Pulse.Actor.Opacity":n!==this._opacity&&(this._opacity=n);break;default:return this._parent(e,t,r)}return!0},GetProperty:function(e){var n=null;if("Pulse.Actor.Color"===e){var a=new o;a.SetValue(this._color),(u=new r(e,0,!0,s)).SetGroupId("Group.Effect"),n=new t(u,a)}else if("Pulse.Actor.Opacity"===e){var u,l=new i;l.SetValue(this._opacity),(u=new r(e,1,!0,s)).SetGroupId("Group.Effect"),u.SetBounds(0,1,.1),n=new t(u,l)}else n=this._parent(e);return n},GetMapChoices:function(){return{0:"effect.type.none",1:"effect.type.pulse.color"}},GetVectorProperties:function(){var e=[];return 1===this._type&&e.push("Pulse.Actor.Color"),e},SetIsPulsing:function(e){this._isPulsing=e;var t=this.QueryInterface("VCXIModifiable");if(t){var r=t.GetProperty("Actor.Color.Defined").GetPropertyValue();if(r){var n=r.Clone();e?(this._currentColorDefined=r.GetValue(),n.SetValue(!0)):n.SetValue(this._currentColorDefined),t.OnChangeProperty("Actor.Color.Defined",n),t.OnChangePropertiesEnd()}}}})});