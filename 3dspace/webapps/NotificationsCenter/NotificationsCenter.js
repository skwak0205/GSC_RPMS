define("DS/NotificationsCenter/js/view/NotificationSettingsView",["UWA/Class","UWA/Class/Events","DS/UIKIT/Scroller","DS/UIKIT/Input/Toggle","DS/W3DXLogger/W3DXLogger","DS/UIKIT/SuperModal","DS/NotifAlert/NotificationUsageTracker","i18n!DS/NotificationsCenter/assets/nls/feed"],function(e,t,i,n,o,s,a,r){"use strict";var l=new o({name:"3DNOTIF",debug:"debugNOTIF"});l.log("3DNOTIF - NotificationSettingsView load");var c=e.extend(t,{init:function(e){var t=this;this.notif_by_ui=e?e.notif_by_ui:0,this.notif_by_email=e?e.notif_by_email:0,this.notif_by_browser=e?e.notif_by_browser:0,this.notifId=e?e.notifId:0,this.app=e?e.app:void 0,this.deg=0,this.globalView=UWA.createElement("div",{id:"NOTIFAPPNAME",styles:{display:"inline-flex",width:"100%",height:"auto","padding-left":"10px","padding-right":"10px","border-bottom":"1px solid #f1f1f1"},events:{click:function(e){l.log("Click APP"),t.dispatchEvent("iconClick",e)},mouseover:function(e){t.globalView.style.cursor="pointer"},mouseout:function(e){t.globalView.style.cursor="default"}}}),this.icon=UWA.createElement("div",{id:"NotifIconApp"+e.service,styles:{margin:"auto","margin-right":"10px",color:"#77797c"}}).inject(this.globalView),this.app&&(this.iconApp=UWA.createElement("img",{src:e.nameIcon,styles:{width:"48px",height:"48px"}}).inject(this.icon)),this.appTextDetail=UWA.createElement("div",{styles:{flex:"1"}}).inject(this.globalView),this.text=UWA.createElement("div",{styles:{"margin-top":"8px",color:"#77797c","font-weight":"bold","font-size":"16px"}}).inject(this.appTextDetail),this.detailState=UWA.createElement("div",{text:"Off",styles:{color:"#77797c","font-size":"12px","font-style":"italic","margin-bottom":"8px"}}).inject(this.appTextDetail),this.mail=UWA.createElement("span",{class:"fonticon handler fonticon-right-open-big",styles:{color:"#b4b6ba","font-size":"20px",margin:"auto"},events:{mousedown:function(e){t.mail.style.color="#368ec4"},mouseup:function(e){t.mail.style.color="#b4b6ba"},mouseover:function(e){t.mail.style.cursor="pointer",t.mail.style.color=1===t.notif_by_email?"#005686":"#3d3d3d"},mouseout:function(e){t.mail.style.cursor="default",t.mail.style.color=1===t.notif_by_email?"#368ec4":"#b4b6ba"}}}).inject(this.globalView)},inject:function(e){this.globalView.inject(e)},setText:function(e){var t=UWA.createElement("div",{});t.innerHTML=e,this.text.setText(t.innerText)},setSetting:function(e){void 0!==e.notif_by_email&&(this.notif_by_email=parseInt(e.notif_by_email),this.mail.style.color=1===this.notif_by_email?"#368ec4":"#b4b6ba",e.nodispatch||this.dispatchEvent("updateSettings",[{id:this.notifId,notif_by_email:this.notif_by_email,notif_by_browser:this.notif_by_browser}])),void 0!==e.notif_by_ui&&(this.notif_by_ui=parseInt(e.notif_by_ui),this.monitor.style.color=1===this.notif_by_ui?"#368ec4":"#b4b6ba",e.nodispatch||this.dispatchEvent("updateSettings",[{id:this.notifId,notif_by_ui:this.notif_by_ui,notif_by_email:this.notif_by_email,notif_by_browser:this.notif_by_browser}])),void 0!==e.notif_by_browser&&(this.notif_by_browser=parseInt(e.notif_by_browser),this.monitor.style.color=1===this.notif_by_browser?"#368ec4":"#b4b6ba",e.nodispatch||this.dispatchEvent("updateSettings",[{id:this.notifId,notif_by_ui:this.notif_by_ui,notif_by_email:this.notif_by_email,notif_by_browser:this.notif_by_browser}]))},setOff:function(e){this.globalView.style.opacity=e?"0.6":"1"},setDetailState:function(e){this.detailState.setText(e)}}),d=e.extend(t,{init:function(e){var t=this;this.notifs={},this.idNotifs=[],this.notif_by_ui=0,this.notif_by_email=0,this.notif_by_browser=0,this.appID=void 0,this.service=e.service,this.hNotifView=void 0,this.fxShow=void 0,this.fxHide=void 0,this.hNotifs=0;var i=UWA.createElement("textarea",{});i.innerHTML=e.serviceName,this.titleText=i.value,this.appDetailView=e.detailView,this.globalView=UWA.createElement("div",{}),this.appTitle=new c({app:!0,notif_by_ui:this.notif_by_ui,notif_by_email:this.notif_by_email,notif_by_browser:this.notif_by_browser,nameIcon:e.icon,service:e.service}),this.appTitle.inject(this.globalView),this.appTitle.setText(this.titleText),this.appTitle.addEvent("updateSettings",function(e){for(var i in t.notifs)t.notifs[i].line.setSetting(e)}),this.appTitle.addEvent("iconClick",function(i){t.showDetail(),t.dispatchEvent("hideSettings"),a.trackNotifSettingsViewAction({eventAction:"serviceSettingsView",eventLabel:"Specific service settings",persDim:{pd1:e.serviceName,pd2:e.service}})}),this.buildAppDetailView()},buildAppDetailView:function(){var e=this,t=UWA.createElement("div",{id:"NotifTitleSetting",styles:{display:"inline-flex",width:"100%",height:"44px","margin-top":"-10px"},events:{mousedown:function(e){t.style.color="#368ec4",o.style.color="#368ec4"},mouseup:function(e){o.style.color="#b4b6ba",o.style.color="#b4b6ba"},mouseover:function(){t.style.cursor="pointer",t.style.color="#3d3d3d",o.style.color="#3d3d3d"},mouseout:function(){t.style.cursor="default",t.style.color="#b4b6ba",o.style.color="#b4b6ba"},click:function(t){e.hideDetail(),e.dispatchEvent("showSettings")}}}).inject(this.appDetailView),o=UWA.createElement("span",{class:"fonticon handler fonticon-left-open-big",styles:{color:"#b4b6ba","font-size":"24px","margin-top":"5px"},events:{mousedown:function(e){o.style.color="#368ec4"},mouseup:function(e){o.style.color="#b4b6ba"},mouseover:function(){o.style.cursor="pointer",o.style.color="#3d3d3d"},mouseout:function(){o.style.cursor="default",o.style.color="#b4b6ba"},click:function(t){e.hideDetail(),e.dispatchEvent("showSettings"),a.trackNotifSettingsViewAction({eventAction:"backtoNotificationSettingsView",eventLabel:"Backword navigation from service view",persDim:{pd1:"showSettings"}})}}}).inject(t);UWA.createElement("div",{text:r.preferences,styles:{color:"#77797c","font-size":"14px",width:"100%",margin:"auto"}}).inject(t);var l=UWA.createElement("div",{styles:{display:"inline-flex",width:"96%","border-bottom":"1px solid #f1f1f1"}}).inject(this.appDetailView);UWA.createElement("div",{text:this.titleText,styles:{"font-size":"16px",margin:"auto",flex:"1",color:"rgb(119, 121, 124)","font-weight":"bold"}}).inject(l);this.appToogle=new n({type:"switch",value:"option2",label:"",events:{onChange:function(t){var i=0;e.appToogle.isChecked()?(i=1,e.setDetail()):e.appTitle.setDetailState("Off"),e.displaySettings(e.appToogle.isChecked()),e.appTitle.setOff(!e.appToogle.isChecked()),e.dispatchEvent("updateSettings",[{id:e.appID,subscribe:i}])}}}).inject(l),this.notifView=UWA.createElement("div",{styles:{right:"-16px",bottom:"-16px","padding-right":"16px","padding-bottom":"16px"}}),this.scroll=new i({element:UWA.createElement("div",{class:"scrollable-body",styles:{margin:"auto",overflow:"hidden",height:"calc(100% - 58px)","max-width":"680px"},html:this.notifView})}).inject(this.appDetailView),this.textExplain=UWA.createElement("div",{styles:{width:"100%",height:"20px"}}).inject(this.notifView),this.listNotifs=UWA.createElement("div",{styles:{width:"100%"}}).inject(this.notifView),this.textExplainUI=UWA.createElement("div",{styles:{width:"100%",height:"80px"}}).inject(this.notifView),this.uiDefine=UWA.createElement("div",{styles:{width:"100%",display:"inline-flex"}}).inject(this.notifView),this.centerUI=UWA.createElement("div",{styles:{width:"50%","text-align":"center",margin:"5px"},events:{mouseover:function(){e.centerUI.style.cursor="not-allowed"},mouseout:function(){e.centerUI.style.cursor="default"}}}).inject(this.uiDefine),this.centerIcon=UWA.createElement("span",{class:"icon-desktop-center",title:r.centerNotificationTooltipEnabled,styles:{"font-size":"72px","margin-top":"6px",color:"rgb(54, 142, 196)"}}).inject(this.centerUI),this.txtCenter=UWA.createElement("div",{text:r.centerIconText||"Notification Center",styles:{color:"rgb(54, 142, 196)"}}).inject(this.centerUI),this.AlertUI=UWA.createElement("div",{styles:{width:"50%","text-align":"center",margin:"5px"},events:{mouseover:function(){e.AlertUI.style.cursor="pointer"},mouseout:function(){e.AlertUI.style.cursor="default"},click:function(t){var i=()=>{e.notif_by_ui=!e.notif_by_ui,e.dispatchEvent("updateSettings",[{id:e.appID,notif_by_ui:e.notif_by_ui?1:0,notif_by_email:e.notif_by_email,notif_by_browser:e.notif_by_browser}]);for(var t=0;t<e.idNotifs.length;t++)e.dispatchEvent("updateSettings",[{id:e.idNotifs[t],notif_by_ui:e.notif_by_ui?1:0,notif_by_email:e.notif_by_email,notif_by_browser:e.notif_by_browser}])};e.notif_by_ui?new s({renderTo:document.body,okButtonText:r.confirmButtonLabel}).confirm(r.alertNotifDeactivateMsgForPopup,r.notificationPopupDeactivationTitle,function(t){t&&(i(),e.AlertUIIcon.style.color="rgb(180, 182, 186)",e.AlertUIIcon.title=r.alertNotificationTooltipDisabled,e.txtAlert.style.color="rgb(180, 182, 186)")}):(i(),e.AlertUIIcon.style.color="rgb(54, 142, 196)",e.AlertUIIcon.title=r.alertNotificationTooltipEnabled,e.txtAlert.style.color="rgb(54, 142, 196)");e.setDetail()}}}).inject(this.uiDefine),this.AlertUIIcon=UWA.createElement("span",{class:"icon-desktop-popover",title:r.alertNotificationTooltipDisabled,styles:{"font-size":"72px","margin-top":"6px",color:"rgb(180, 182, 186)"}}).inject(this.AlertUI),this.txtAlert=UWA.createElement("div",{text:r.alertIconText||"Alert",styles:{color:"rgb(180, 182, 186)"}}).inject(this.AlertUI),"X3DMPNF_AP"!==this.service&&"X3DOPMR_AP"!==this.service&&"X3DPMMR_AP"!==this.service?(this.Mail=UWA.createElement("div",{styles:{width:"50%","text-align":"center",margin:"5px"},events:{mouseover:function(){e.Mail.style.cursor="pointer"},mouseout:function(){e.Mail.style.cursor="default"},click:function(t){var i=()=>{e.notif_by_email=!e.notif_by_email,e.dispatchEvent("updateSettings",[{id:e.appID,notif_by_ui:e.notif_by_ui,notif_by_email:e.notif_by_email,notif_by_browser:e.notif_by_browser}]);for(var t=0;t<e.idNotifs.length;t++)e.dispatchEvent("updateSettings",[{id:e.idNotifs[t],notif_by_ui:e.notif_by_ui,notif_by_email:e.notif_by_email,notif_by_browser:e.notif_by_browser}])};e.notif_by_email?new s({renderTo:document.body,okButtonText:r.confirmButtonLabel}).confirm(r.mailNotifDeactivateMsgForPopup,r.notificationPopupDeactivationTitle,function(t){t&&(i(),e.MailIcon.style.color="rgb(180, 182, 186)",e.MailIcon.title=r.mailNotificationTooltipDisabled,e.txtMail.style.color="rgb(180, 182, 186)")}):(i(),e.MailIcon.style.color="rgb(54, 142, 196)",e.MailIcon.title=r.mailNotificationTooltipEnabled,e.txtMail.style.color="rgb(54, 142, 196)");e.setDetail()}}}).inject(this.uiDefine),this.MailIcon=UWA.createElement("span",{class:"icon-desktop-email",title:r.mailNotificationTooltipDisabled,styles:{"font-size":"72px","margin-top":"6px",color:"rgb(180, 182, 186)"},events:{mouseover:function(){e.MailIcon.style.cursor="pointer"},mouseout:function(){e.MailIcon.style.cursor="default"}}}).inject(this.Mail),this.txtMail=UWA.createElement("div",{text:r.mailIconText||"Mail",styles:{color:"rgb(180, 182, 186)"}}).inject(this.Mail),"undefined"!=typeof Notification&&(this.uiDefineBrowser=UWA.createElement("div",{styles:{width:"100%",display:"inline-flex",margin:"5px","margin-bottom":"15px"}}).inject(this.notifView),this.Browser=UWA.createElement("div",{styles:{width:"50%","text-align":"center",margin:"auto"},events:{mouseover:function(){e.Browser.style.cursor="pointer"},mouseout:function(){e.Browser.style.cursor="default"},click:function(t){if(0==e.notif_by_browser){if(!Notification)return void alert("Desktop notifications not available in your browser. Try Chromium.");if("granted"!==Notification.permission){if("denied"!=Notification.permission)new s({renderTo:document.body,okButtonText:r.confirmButtonLabel}).confirm(r.notificationPopupActivationMsgPopupForAllow,r.notificationPopupActivationTitle,function(e){e&&console.log("Notification permission is default")});Notification.requestPermission(function(e){if("granted"===e)i();else if("default"===e){new s({renderTo:document.body}).alert(r.notificationPopupActivationMsgPopupForBlock,r.notificationPopupActivationTitle,function(e){e&&console.log("Notification permission is denied...")})}})}else i()}else{if("granted"!==Notification.permission)new s({renderTo:document.body}).alert(r.notificationPopupActivationMsgPopupForBlock,r.notificationPopupActivationTitle,function(e){e&&console.log("Notification permission is denied...")});i()}function i(){var t=()=>{e.notif_by_browser=!e.notif_by_browser,e.dispatchEvent("updateSettings",[{id:e.appID,notif_by_ui:e.notif_by_ui,notif_by_email:e.notif_by_email,notif_by_browser:e.notif_by_browser}]);for(var t=0;t<e.idNotifs.length;t++)e.dispatchEvent("updateSettings",[{id:e.idNotifs[t],notif_by_ui:e.notif_by_ui,notif_by_email:e.notif_by_email,notif_by_browser:e.notif_by_browser}])};if("granted"!=Notification.permission||e.notif_by_browser){if("granted"==Notification.permission&&e.notif_by_browser){new s({renderTo:document.body,okButtonText:r.confirmButtonLabel}).confirm(r.browserNotifDeactivateMsgForPopup,r.notificationPopupDeactivationTitle,function(i){i&&(t(),e.BrowserIcon.style.color="rgb(180, 182, 186)",e.BrowserIcon.title=r.browserNotificationTooltipDisabled,e.txtBrowser.style.color="rgb(180, 182, 186)")})}}else t(),e.BrowserIcon.style.color="rgb(54, 142, 196)",e.BrowserIcon.title=r.browserNotificationTooltipEnabled,e.txtBrowser.style.color="rgb(54, 142, 196)";e.setDetail()}}}}).inject(this.uiDefineBrowser),this.BrowserIcon=UWA.createElement("span",{class:"icon-desktop-empty",title:r.browserNotificationTooltipDisabled,styles:{"font-size":"72px","margin-top":"6px",color:"rgb(180, 182, 186)"},events:{mouseover:function(){e.BrowserIcon.style.cursor="pointer"},mouseout:function(){e.BrowserIcon.style.cursor="default"}}}).inject(this.Browser),this.txtBrowser=UWA.createElement("div",{text:r.BrowserIconText||"Browser",styles:{color:"rgb(180, 182, 186)"}}).inject(this.Browser))):"undefined"!=typeof Notification&&(this.uiDefineBrowser=UWA.createElement("div",{styles:{width:"100%",display:"inline-flex",margin:"5px","margin-bottom":"15px"}}).inject(this.notifView),this.Browser=UWA.createElement("div",{styles:{width:"50%","text-align":"center",margin:"auto"},events:{mouseover:function(){e.Browser.style.cursor="pointer"},mouseout:function(){e.Browser.style.cursor="default"},click:function(t){if(e.notif_by_browser=1===e.notif_by_browser?0:1,0!=e.notif_by_browser){if(!Notification)return void alert("Desktop notifications not available in your browser. Try Chromium.");if("granted"!==Notification.permission){if("denied"!=Notification.permission)e.notif_by_browser=0,new s({renderTo:document.body,okButtonText:r.confirmButtonLabel}).confirm(r.notificationPopupActivationMsgPopupForAllow,r.notificationPopupActivationTitle,function(e){e&&console.log("Notification permission is default")});Notification.requestPermission(function(t){if("granted"===t)e.notif_by_browser=1,i();else if("default"===t)e.notif_by_browser=0;else{new s({renderTo:document.body}).alert(r.notificationPopupActivationMsgPopupForBlock,r.notificationPopupActivationTitle,function(e){e&&console.log("Notification permission is denied...")})}})}else i()}else{if("granted"!==Notification.permission)new s({renderTo:document.body}).alert(r.notificationPopupActivationMsgPopupForBlock,r.notificationPopupActivationTitle,function(e){e&&console.log("Notification permission is denied...")});i()}function i(){e.dispatchEvent("updateSettings",[{id:e.appID,notif_by_ui:e.notif_by_ui,notif_by_email:e.notif_by_email,notif_by_browser:e.notif_by_browser}]);for(var t=0;t<e.idNotifs.length;t++)e.dispatchEvent("updateSettings",[{id:e.idNotifs[t],notif_by_ui:e.notif_by_ui,notif_by_email:e.notif_by_email,notif_by_browser:e.notif_by_browser}]);if("granted"==Notification.permission&&1===e.notif_by_browser)e.BrowserIcon.style.color="rgb(54, 142, 196)",e.BrowserIcon.title=r.browserNotificationTooltipEnabled,e.txtBrowser.style.color="rgb(54, 142, 196)";else if("granted"==Notification.permission&&0===e.notif_by_browser){new s({renderTo:document.body,okButtonText:r.confirmButtonLabel}).confirm(r.browserNotifDeactivateMsgForPopup,r.notificationPopupDeactivationTitle,function(t){t&&(e.BrowserIcon.style.color="rgb(180, 182, 186)",e.BrowserIcon.title=r.browserNotificationTooltipDisabled,e.txtBrowser.style.color="rgb(180, 182, 186)")})}e.setDetail()}}}}).inject(this.uiDefine),this.BrowserIcon=UWA.createElement("span",{class:"icon-desktop-empty",title:r.browserNotificationTooltipDisabled,styles:{"font-size":"72px","margin-top":"6px",color:"rgb(180, 182, 186)"},events:{mouseover:function(){e.BrowserIcon.style.cursor="pointer"},mouseout:function(){e.BrowserIcon.style.cursor="default"}}}).inject(this.Browser),this.txtBrowser=UWA.createElement("div",{text:r.BrowserIconText||"Browser",styles:{color:"rgb(180, 182, 186)"}}).inject(this.Browser))},setDetail:function(){if(1===this.notif_by_ui&&1===this.notif_by_email&&this.notif_by_browser)this.appTitle.setDetailState(r.centerIconText+", "+r.alertIconText+", "+r.mailIconText+", "+r.BrowserIconText);else if(1===this.notif_by_ui||1===this.notif_by_email||this.notif_by_browser){var e=r.centerIconText;1===this.notif_by_ui&&(e=e+", "+r.alertIconText),this.notif_by_email&&(e=e+", "+r.mailIconText),this.notif_by_browser&&(e=e+", "+r.BrowserIconText),this.appTitle.setDetailState(e)}else this.appTitle.setDetailState(r.centerIconText)},showDetail:function(){var e=this.appTitle.globalView.clientWidth+20;this.appDetailView.style.marginLeft=e+"px",this.appDetailView.style.display="block",new UWA.Fx(this.appDetailView,{duration:300,transition:"linear"}).start({marginLeft:"0px"})},hideDetail:function(){var e=this,t=this.appDetailView.clientWidth+20;new UWA.Fx(this.appDetailView,{duration:300,transition:"linear",events:{onComplete:function(t){e.appDetailView.style.display="none"}}}).start({marginLeft:t+"px"})},displaySettings:function(e){var t=new UWA.Fx(this.scroll.elements.container,{duration:400,transition:"linear"});e?(this.scroll.elements.container.style.height="100%",this.hNotifs=this.scroll.elements.container.clientHeight,t.start({height:["0px",this.hNotifs+"px"]})):t.start({height:"0px"})},addSetting:function(e){var t=this;if("GLOBAL"===e.name)this.appID=e.id,1===parseInt(e.notif_by_ui)&&(this.notif_by_ui=1,t.AlertUIIcon.style.color="rgb(54, 142, 196)",t.AlertUIIcon.title=r.alertNotificationTooltipEnabled,t.txtAlert.style.color="rgb(54, 142, 196)"),1===parseInt(e.notif_by_email)&&(this.notif_by_email=1,t.MailIcon.style.color="rgb(54, 142, 196)",t.MailIcon.title=r.mailNotificationTooltipEnabled,t.txtMail.style.color="rgb(54, 142, 196)"),1===parseInt(e.notif_by_browser)&&("undefined"==typeof Notification?console.log("Notification Object is Undefined for IE browser !!!!"):"granted"===Notification.permission&&(this.notif_by_browser=1,t.BrowserIcon.style.color="rgb(54, 142, 196)",t.BrowserIcon.title=r.browserNotificationTooltipEnabled,t.txtBrowser.style.color="rgb(54, 142, 196)")),parseInt(e.subscribe)?(this.appToogle.check(),t.setDetail()):(this.displaySettings(!1),this.appTitle.setOff(!0),this.appTitle.setDetailState("Off"));else{this.idNotifs.push(e.id);var i=UWA.createElement("div",{styles:{display:"inline-flex",width:"100%","border-bottom":"1px solid #f1f1f1",opacity:"0.6"}}).inject(this.listNotifs),o=UWA.createElement("textarea",{});o.innerHTML=e.name;UWA.createElement("div",{text:o.value,styles:{margin:"auto",flex:"1",color:"rgb(119, 121, 124)","font-size":"14px"}}).inject(i);var s=new n({type:"switch",value:"option2",label:"",events:{onChange:function(n){var o=0;s.isChecked()?(o=1,i.style.opacity="1"):i.style.opacity="0.6",t.dispatchEvent("updateSettings",[{id:e.id,subscribe:o}])}}}).inject(i);1===parseInt(e.subscribe)&&(null===e.unsubscribe_date||new Date(e.unsubscribe_date)<new Date)&&(s.check(),i.style.opacity="1"),this.notifs[e.id]={notifToggle:s,tittleNotif:i}}},setSetting:function(e){if(this.notifs[e.ID]){let t=!1;1===parseInt(e.SUBSCRIBE)&&(null===e.UNSUBSCRIBE_DATE||new Date(e.UNSUBSCRIBE_DATE)<new Date)&&(t=!0),this.notifs[e.ID].notifToggle.setCheck(t),this.notifs[e.ID].notifToggle.isChecked()?this.notifs[e.ID].tittleNotif.style.opacity="1":this.notifs[e.ID].tittleNotif.style.opacity="0.6"}},inject:function(e){this.globalView.inject(e)}});return e.extend(t,{init:function(e){l.log("NotificationSettingsView init"),this.apps={},this.buildView(e),this.buildTitle()},buildView:function(e){var t=this;this.globalView=UWA.createElement("div",{styles:{margin:"auto",height:"100%",padding:"10px",position:"absolute",left:"0px",right:"0px",overflow:"hidden",background:"white","margin-left":e.left,"z-index":"2",display:"none"}}),this.toolbarView=UWA.createElement("div",{id:"NotifToolbarSetting",styles:{display:"inline-flex",width:"100%",height:"44px","margin-top":"-10px"},events:{mousedown:function(e){t.settingIcon.style.color="#368ec4",t.toolbarView.style.color="#368ec4"},mouseup:function(e){t.settingIcon.style.color="#b4b6ba",t.toolbarView.style.color="#b4b6ba"},mouseover:function(){t.toolbarView.style.cursor="pointer",t.settingIcon.style.color="#3d3d3d",t.toolbarView.style.color="#3d3d3d"},mouseout:function(){t.toolbarView.style.cursor="default",t.settingIcon.style.color="#b4b6ba",t.toolbarView.style.color="#b4b6ba"},click:function(e){t.hide(),t.dispatchEvent("showCenter")}}}).inject(this.globalView),this.settingsView=UWA.createElement("div",{styles:{right:"-16px",bottom:"-16px","padding-right":"16px","padding-bottom":"16px"}}),this.scrollerView=new i({element:UWA.createElement("div",{class:"scrollable-body",styles:{margin:"auto",overflow:"hidden",height:"calc(100% - 58px)","max-width":"680px"},html:this.settingsView})}).inject(this.globalView)},buildTitle:function(e){var t=this;this.settingIcon=UWA.createElement("span",{class:"fonticon handler fonticon-left-open-big",styles:{color:"#b4b6ba","font-size":"24px","margin-top":"5px"},events:{mousedown:function(e){t.settingIcon.style.color="#368ec4"},mouseup:function(e){t.settingIcon.style.color="#b4b6ba"},mouseover:function(){t.settingIcon.style.cursor="pointer",t.settingIcon.style.color="#3d3d3d"},mouseout:function(){t.settingIcon.style.cursor="default",t.settingIcon.style.color="#b4b6ba"},click:function(e){t.hide(),t.dispatchEvent("showCenter"),a.trackNotifSettingsViewAction({eventAction:"backtoNotificationCenterView",eventLabel:"Backword navigation from setting view",persDim:{pd1:"showCenter"}})}}}).inject(this.toolbarView),this.tittle=UWA.createElement("div",{text:r.preferences,styles:{color:"#77797c","font-size":"14px",width:"100%",margin:"auto"}}).inject(this.toolbarView)},addSetting:function(e){var t=this;if(!this.apps[e.service]){var i=UWA.createElement("div",{id:"NotifAppDetail",styles:{margin:"auto",height:"100%",padding:"10px",position:"absolute",left:"0px",right:"0px",top:"0px",overflow:"hidden",background:"white",display:"none","z-index":"3"}}).inject(this.globalView);this.apps[e.service]=new d({service:e.service,serviceName:e.serviceName,detailView:i,icon:e.icon}),this.apps[e.service].inject(this.settingsView),this.apps[e.service].addEvent("updateSettings",function(e){t.dispatchEvent("updateSettings",e)}),this.apps[e.service].addEvent("hideSettings",function(e){t.scrollerView.hide()}),this.apps[e.service].addEvent("showSettings",function(){t.scrollerView.show()})}this.apps[e.service]&&this.apps[e.service].addSetting(e)},setSetting:function(e){this.apps[e.APPID].setSetting(e)},getView:function(){return l.log("NotificationSettingsView getView"),this.globalView},show:function(){this.globalView.style.display="block",new UWA.Fx(this.globalView,{duration:300,transition:"linear"}).start({marginLeft:"0px"})},hide:function(){var e=this;new UWA.Fx(this.globalView,{duration:300,transition:"linear",events:{onComplete:function(t){e.globalView.style.display="none"}}}).start({marginLeft:this.globalView.clientWidth+"px"})}})}),define("DS/NotificationsCenter/js/view/NotificationFilterTagsView",["UWA/Core","UWA/Controls/Abstract","UWA/Event","DS/UIKIT/Input/Text","DS/UIKIT/Touch","DS/UIKIT/Spinner","UWA/Utils"],function(e,t,i,n,o,s,a){"use strict";return t.extend({defaultOptions:{text:null,onChange:function(){},onDestroy:function(){}},init:function(e){this._parent(e),this.buildContainer()},destroy:function(){this.options.onDestroy(),this._parent()},processChange:function(t,i){if(e.is(i.getParent("div"))){var n=-1===this.getSelected().indexOf(t);this.options.validator(t)&&n?(this.options.text=t,i.getParent("div").removeClassName("has-error"),this.getContent().setContent(this.setReadInput()),this.asyncCheck()):(i.focus(),e.log(i),i.getParent("div").hasClassName("has-error")||(i.getParent("div").addClassName("has-error"),this.options.onError&&n&&this.options.onError()))}},setEditInput:function(){var t=this;this.input=new n({value:this.options.text,attributes:{type:"email",styles:{width:t.getContent().getSize().width},events:{keyup:function(e){e.preventDefault(),e.stopPropagation(),13===e.keyCode&&t.processChange(this.value,this)},blur:function(i){var n=this;i.preventDefault(),i.stopPropagation(),e.is(n)&&setTimeout(function(){t.processChange(n.value,n)},100)}}}}),this.getContent().setContent(this.input),this.input.focus()},getButton:function(){var t=this;return this.button||(this.button=e.createElement("button",{class:"btn btn-default",html:{tag:"span",class:"fonticon fonticon-cancel"},events:{click:function(e){!this.getElement(".fonticon").hasClassName("fonticon-cancel")||1!==e.detail&&"mouse"!=e.pointerType||(t.destroy(),i.stop(e))}}})),{tag:"span",class:"input-group-btn",html:this.button}},getInputText:function(){var t=this;return this.inputText=e.createElement("span",{class:"form-control",text:this.options.text,events:t.isTouchActivate()?null:{dblclick:function(){t.setEditInput()}}}),t.isTouchActivate()&&(this.touch=new o(this.inputText).on("hold",function(e){e.preventDefault(),e.stopPropagation(),t.setEditInput()})),this.inputText},isTouchActivate:function(){return e.Utils.Client.Features.touchEvents},setReadInput:function(){return e.createElement("div",{class:"input-group",html:[this.getInputText(),this.getButton()]})},buildContainer:function(){this.elements.container=e.createElement("div",{class:"uwa-input-tags uwa-input",html:this.setReadInput()})},setLoading:function(e){var t=this.button.getElement(".fonticon");e?(t.removeClassName("fonticon-cancel"),this.button.addClassName("is-loading"),new s({visible:!0}).inject(t)):(this.button.removeClassName("is-loading"),t.addClassName("fonticon-cancel"),t.setContent(""))},setError:function(e){var t=this.inputText.getParent("div");e?t.hasClassName("has-error")||t.addClassName("has-error"):t.removeClassName("has-error"),this.options.onChange()},asyncCheck:function(){var e=this;this.options.validatorAsync&&(this.setLoading(!0),this.options.syncInputSize(),this.options.validatorAsync(this.inputText.getText(),{onComplete:function(){e.getContent().setContent(e.setReadInput()),e.setLoading(),e.setError(!1),e.options.syncInputSize()},onFailure:function(){e.setLoading(),e.setError(!0),e.options.syncInputSize()}}))},getSelected:function(){var e=[];return this.elements.container.getParent().getElements(".uwa-input-tags span.form-control").forEach(function(t){e.push(t.getHTML())}),e}})}),define("DS/NotificationsCenter/js/view/NotificationFilterTaggerView",["UWA/Core","UWA/Controls/Abstract","DS/UIKIT/Input/Text","DS/NotificationsCenter/js/view/NotificationFilterTagsView","UWA/Utils"],function(e,t,i,n,o){"use strict";return t.extend({defaultOptions:{validator:function(e){return e.length>0},onSuccess:function(){},onError:function(){},onLimitError:function(){},placeholder:"",limit:null,onChange:function(){}},isFirst:!0,init:function(e){var t=this;t._parent(e),this.buildContainer(),setTimeout(function(){t.elements.input.focus()},1)},buildContainer:function(){this.elements.container=e.createElement("div",{html:[{class:"tags-input-wrapper",html:[{class:"tag-wrapper"},{class:"tag-input-wrapper",html:this.buildInput()}]},{class:"clearfix"}]})},buildInput:function(){var e=this;return this.elements.input=new i({className:"pull-right",attributes:{type:"email",placeholder:this.options.placeholder,autofocus:this.options.focus||null,events:{keydown:function(t){9===t.keyCode&&e.paste(!1,!0)},keyup:function(t){document.getElementsByClassName("RTFilterButton")[0].disabled=!0,17!==t.keyCode&&(13===t.keyCode||188===t.keyCode?e.paste(!1,!0):e.paste(!0,!0))},drop:function(){e.paste(!1,!0)},paste:function(){e.paste(!1,!0)},blur:function(){e.paste(!1,!1)}}}}),this.elements.input},paste:function(e,t){var i=this;setTimeout(function(){var n,o,s,a=i.elements.input.getValue(),r=a,l=i.elements.container.getElement(".tags-input-wrapper"),c=i.elements.container.getElement(".tag-input-wrapper");(e&&a.indexOf(";")>-1||!e)&&((n=a.split(";")).forEach(function(e,t){""!==e&&(i.options.validator(e)&&null!==i.options.limit&&i.getSelected().length<i.options.limit?-1===i.getSelected().indexOf(e)&&((o=i.buildTag(e)).inject(l),o.asyncCheck(),s=t+1===n.length?"":";",a=a.replace(e+s,"")):i.options.validator(e)&&i.getSelected().length===i.options.limit&&(c.hasClassName("has-error")||(c.addClassName("has-error"),i.options.onLimitError())))}),a!==r&&(i.elements.input.setValue(a),i.syncInputSize(),t&&setTimeout(function(){i.elements.input.focus()},1)),i.validate())},0)},buildTag:function(e){var t=this;return new n({text:e,onDestroy:function(){setTimeout(function(){t.syncInputSize(),t.validate()},10)},onChange:function(){t.syncInputSize(),t.validate()},onError:function(){t.syncInputSize(),t.options.onError()},syncInputSize:t.syncInputSize.bind(this),validator:t.options.validator,validatorAsync:t.options.validatorAsync})},isFirstEmailAlreadySelected:function(){var e=this.elements.input.getValue().split(";");return this.getSelected().indexOf(e[0])>-1},validate:function(){var e=this;setTimeout(function(){var t=e.elements.container.getElement(".tag-input-wrapper");t&&(""!==e.elements.input.getValue()||0!==e.getContent().getElements(".uwa-input-split.has-error").length?(t.hasClassName("has-error")||t.addClassName("has-error"),""!==e.elements.input.getValue()&&e.isFirstEmailAlreadySelected()?e.options.onError(!0):""!==e.elements.input.getValue()?e.options.onError():e.options.onError(!0)):(t.removeClassName("has-error"),e.options.onSuccess()))},10)},proceedRemove:function(){var e=this.elements.container.getElements(".uwa-input-tags.focus");e.length>0?(e.forEach(function(e){e.destroy()}),this.syncInputSize()):(e=this.elements.container.getElements(".uwa-input-tags")).length>0&&(e[e.length-1].destroy(),this.syncInputSize()),this.validate()},syncInputSize:function(){var e=0,t=this,i=t.elements.container.getSize().width,n=i,o=[];t.elements.container.getElements(".uwa-input-tags").forEach(function(e){e.inject(t.elements.container.getElement(".tags-input-wrapper"))}),t.elements.container.getElements(".uwa-input-tags").forEach(function(n){e+=n.getDimensions().outerWidth,t.isFirst&&(e+=5),o.push(n),e>i-200&&(o.forEach(function(e){t.elements.container.getElement(".tag-wrapper").grab(e)}),o=[],e=0)}),t.isFirst&&(t.isFirst=!1),i-e>200&&(n=i-e),e>0?t.elements.container.getElement("input").setStyle("width",n-5):t.elements.container.getElement("input").setStyle("width","100%"),t.options.onChange()},getSelected:function(){var e=[];return this.elements.container.getElements(".uwa-input-tags span.form-control").forEach(function(t){e.push(t.getHTML())}),e}})}),define("DS/NotificationsCenter/js/view/NotificationFilterView",["UWA/Class","UWA/Class/Events","UWA/Class/Model","DS/UIKIT/Input/ButtonGroup","DS/UIKIT/Input/Button","DS/UIKIT/Input/Toggle","DS/UIKIT/Form","DS/UIKIT/Input/Date","DS/UIKIT/DropdownMenu","DS/NotificationsCenter/js/view/NotificationFilterTaggerView","DS/UIKIT/Spinner","DS/W3DXLogger/W3DXLogger","DS/UWPClientCode/I18n","DS/PlatformAPI/PlatformAPI","i18n!DS/NotificationsCenter/assets/nls/feed","DS/UIKIT/Alert","DS/NotifAlert/NotificationUsageTracker","DS/UIKIT/Autocomplete","css!NotificationsCenter/NotificationsCenter.css"],function(e,t,i,n,o,s,a,r,l,c,d,f,u,h,p,g,m,w){"use strict";var b=new f({name:"3DNOTIF",debug:"debugNOTIF"});return b.log("NotificationFilterView load"),e.extend(t,{init:function(e){b.log("3DNOTIF - NotificationFilterView init"),this.showState=!1,this.isFiltered=!1,this.filterWhoSettingFlag=!1,this.filterCount=0,this.unreadTotalCount=0,this.tenants=[],this.settings=[],this.firstDate,this.buildView(),this.buildListener()},buildListener:function(){var e=this,t=new Date;this.addEvent("updateFilter",function(e){b.log("NotificationFilterView updateFilter")}),this.addEvent("setDates",function(i){var n,o,s;b.log("NotificationFilterView setFilterDates"),e.firstDate=i,(s=e.retrieveFilterDataFromLocalstorage())?(i=new Date(s.first_date),n=new Date(s.last_date),o=new Date(n.setDate(n.getDate()-1))):o=t,e.fields[0].destroy(),e.fields[1].destroy(),e.fields[0]=new r({min:e.firstDate,value:i,max:t}).inject(e.WhenView.firstChild),e.fields[1]=new r({min:e.firstDate,value:o,max:t}).inject(e.WhenView.lastChild)}),this.addEvent("setTenants",function(t){b.log("NotificationFilterView setFilterTenants"),e.tenants=t,e.showTenants()}),this.addEvent("setWhoSettings",function(t){b.log("NotificationFilterView setSettings");for(var i={name:"Settings",items:[]},n=e.settings.reduce(function(e,t){return e[t.serviceName]=e[t.serviceName]||[],e[t.serviceName].push({name:t.name,id:t.id}),e},{}),o=Object.keys(n).map(function(e){return{serviceName:e,setting:n[e]}}),s=0;s<o.length;s++){i.items.push({label:o[s].serviceName}),i.items[s].items=[];for(var a=0;a<o[s].setting.length;a++)"GLOBAL"!==o[s].setting[a].name&&i.items[s].items.push({value:o[s].setting[a].name,positionID:o[s].setting[a].id})}e.autocompleteHierarchicalInput.addDataset(i)}),this.addEvent("resetFilterData",function(t){e.resetFilterData(),e.hide()})},buildView:function(){var e=this,t=new Date;t.setDate(t.getDate()+1),this.globalView=UWA.createElement("div",{class:"RTNotificationFilterView",styles:{display:"none",width:"92%",height:"auto",maxWidth:"680px",margin:"auto",marginBottom:"10px"}}),this.labelViewWhen=UWA.createElement("div",{class:"RTLabelView"}).inject(this.globalView),UWA.createElement("span",{class:"fonticon fonticon-clock",styles:{color:"#77797c","font-size":"14px"}}).inject(this.labelViewWhen),UWA.createElement("span",{class:"RTLabelText",text:"When"}).inject(this.labelViewWhen),this.filterForm=new a({className:"RTFilterForm",fields:[{max:t,name:"filterFormDate1",type:"date",placeholder:"dd / mm / yyyy"},{type:"date",max:t,value:t,name:"filterFormDate2",placeholder:"dd / mm / yyyy"}]}).inject(this.globalView),this.fields=this.filterForm.getFields(),this.WhenView=UWA.createElement("div",{class:"RTWhenView"}),this.WhenView.inject(this.filterForm.elements.container,"top"),this.labelViewWhen.inject(this.filterForm.elements.container,"top"),this.toText=UWA.createElement("span",{class:"RTLabelText",styles:{color:"#77797c","font-size":"14px",marginRight:"5px",marginLeft:"5px",marginTop:"12px"},text:p.get("to")}).inject(this.fields[1].parentElement,"before"),this.WhenView.appendChild(this.fields[0].parentElement),this.WhenView.appendChild(this.toText),this.WhenView.appendChild(this.fields[1].parentElement),this.lastDate&&(this.fields[1].value=this.lastDate),this.labelViewWhat=UWA.createElement("div",{class:"RTLabelView",styles:{marginTop:"0px"}}).inject(this.WhenView,"after"),UWA.createElement("span",{class:"fonticon fonticon-3ds-what",styles:{color:"#77797c","font-size":"14px"}}).inject(this.labelViewWhat),UWA.createElement("span",{class:"RTLabelText",text:"What"}).inject(this.labelViewWhat),this.WhatView=UWA.createElement("div",{styles:{width:"100%",marginBottom:"10px"}}).inject(this.labelViewWhat,"after"),this.tagger=new c({placeholder:p.get("NotifContent"),limit:5,focus:!0,validator:function(e){return!0},onError:function(e){},onLimitError:function(){},onSuccess:function(){e.FilterButton.disabled=!1;e.tagger.getSelected().length;e.tagger.elements.container.getElement(".has-error")},onChange:function(){e.tagger.getSelected().length}}).inject(this.WhatView),this.WhoView=UWA.createElement("div",{class:"RTWhenView"}).inject(this.filterForm.elements.container),this.labelViewWho=UWA.createElement("div",{class:"RTLabelView",styles:{marginTop:"0px"}}).inject(this.WhoView,"before"),UWA.createElement("span",{class:"fonticon fonticon-3ds-who",styles:{color:"#77797c","font-size":"14px"}}).inject(this.labelViewWho),UWA.createElement("span",{class:"RTLabelText",text:"Who"}).inject(this.labelViewWho),this.autocompleteHierarchicalInput=new w({multiSelect:!0,showSuggestsOnFocus:!0,placeholder:p.preferencesName,noResultsMessage:p.noPreferencesName}),this.autocompleteHierarchicalInput.elements.container.style.width="100%",this.autocompleteHierarchicalInput.inject(this.WhoView,"bottom"),this.filtersConfirmation=UWA.createElement("div",{class:"modal-footer RTFilterConfirmation"}).inject(this.globalView),this.FilterButton=new UWA.Element("button",{class:"btn btn-primary btn-sm RTFilterButton",text:p.filter,events:{click:function(){e.dispatchEvent("ResetSetting",!0);var t=[],i=e.filterForm.getValues(),n=[],o=[],s=e.autocompleteHierarchicalInput.getSelection();if(s)for(var a=0;a<s.length;a++)o.push(s[a]),n.push(s[a].positionID);if(i.whoSettingsItems=o,i.whoSettings=n,e.tenants&&0!==e.tenants.length){for(a=0;a<e.tenants.length;a++)"true"===i[e.tenants[a].displayName]&&t.push(e.tenants[a].PLATFORMID);i.tenants=t}"true"===i.archive?i.archive=!0:i.archive=!1,i.what=e.tagger.getSelected(),i.first_date=e.fields[0].getDate();var r=new Date(e.fields[1].getDate());(r.setDate(r.getDate()+1),i.last_date=r,i.first_date<i.last_date)?(h.publish("3dnotifinterne",{action:"filter",values:i}),h.publish("3dnotifinterne",{action:"getFilterTotal",values:i}),e.filterWhoSettingFlag=!0,e.isFiltered=!0,e.dispatchEvent("Filtering",!0),h.getUser()&&(i.login=h.getUser().login),e.storeFilterDataToLocalstorage(i)):new g({visible:!0,autoHide:!0,hideDelay:3e3}).inject(e.globalView,"before").add({className:"error",message:"Wrong date range. Please correct it"});setTimeout(function(){m.trackNotifFilterViewAction({eventAction:"clickFilterButton",eventLabel:"Filter button click",eventValue:e.filterCount})},1e4),e.hide()}}}).inject(this.filtersConfirmation),this.ResetButton=new UWA.Element("button",{class:"btn btn-default btn-sm RTFilterButton",text:p.reset,events:{click:function(){e.resetFilterData(),e.dispatchEvent("Resetting",!0)}}}).inject(this.filtersConfirmation),this.CancelButton=new UWA.Element("button",{class:"btn btn-default btn-sm RTFilterButton",text:p.close,events:{click:function(){e.removeLStoredFilterData(),e.dispatchEvent("Canceling",!0),e.hide(),m.trackNotifFilterViewAction({eventAction:"cancelFilterView",eventLabel:"Filter panel closed",eventValue:0})}}}).inject(this.filtersConfirmation)},refresh:function(){this.cleanAll()},cleanAll:function(e){this.section=[]},getView:function(){return b.log("NotificationFilterView getView"),this.globalView},hide:function(){this.showState=!1,this.globalView.style.display="none"},show:function(){this.showState=!0,this.globalView.style.display=""},showTenants:function(){var e;if(0!==this.tenants.length&&this.tenants.length>1){this.labelViewWhere=UWA.createElement("div",{class:"RTLabelView"}).inject(this.filterForm.elements.container),this.whereView=UWA.createElement("div",{class:"RTWhereView"}).inject(this.filterForm.elements.container),UWA.createElement("span",{class:"fonticon fonticon-3ds-where",styles:{color:"#77797c","font-size":"14px"}}).inject(this.labelViewWhere),UWA.createElement("span",{class:"RTLabelText",text:"Where"}).inject(this.labelViewWhere);for(var t=0,i=0;i<this.tenants.length;i++)this.tenants[i].displayName&&"null"!==this.tenants[i].displayName.toLowerCase()&&(new s({type:"checkbox",name:this.tenants[i].displayName,value:this.tenants[i].displayName,className:"RTFilterToggle"}).inject(this.whereView),this.whereView.children[t].style["margin-top"]="0px",this.hideTenantsWhere&&(this.whereView.children[t].style.display="none"),t++);if(new s({type:"checkbox",name:"archive",value:p.archive,className:"RTFilterToggle"}).inject(this.whereView),this.whereView.children[t].style["margin-top"]="0px",t++,e=this.retrieveFilterDataFromLocalstorage()){var n=e.tenants,o=document.querySelectorAll(".RTFilterToggle input");for(i=0;i<o.length;i++)for(var a=0;a<n.length;a++){o[i].value.includes(n[a])&&(o[i].checked=!0)}e.archive&&o[o.length-1]&&(o[o.length-1].checked=!0)}}else{if(this.labelViewWhere=UWA.createElement("div",{class:"RTLabelView"}).inject(this.filterForm.elements.container),this.whereView=UWA.createElement("div",{class:"RTWhereView"}).inject(this.filterForm.elements.container),UWA.createElement("span",{class:"fonticon fonticon-3ds-where",styles:{color:"#77797c","font-size":"14px"}}).inject(this.labelViewWhere),UWA.createElement("span",{class:"RTLabelText",text:"Where"}).inject(this.labelViewWhere),new s({type:"checkbox",name:"archive",value:p.archive,className:"RTFilterToggle"}).inject(this.whereView),this.whereView.children[0].style["margin-top"]="0px",(e=this.retrieveFilterDataFromLocalstorage())&&e.archive)(o=document.querySelectorAll(".RTFilterToggle input"))[o.length-1]&&(o[o.length-1].checked=!0)}},setDate:function(e){this.fields[1].setValue(e),this.fields[1].min=e},dateStringify:function(e){var t=function(e){var t=e+"";return 1===t.length?"0"+t:t};return e.getFullYear()+"-"+t(e.getMonth()+1)+"-"+t(e.getDate())+" "+t(e.getHours())+":"+t(e.getMinutes())+":"+t(e.getSeconds())},storeFilterDataToLocalstorage:function(e){var t=JSON.stringify(e);localStorage.setItem("filterPredicatesData",t),localStorage.setItem("isFiltered","true")},removeLStoredFilterData:function(){var e=localStorage.getItem("filterPredicatesData"),t=localStorage.getItem("isFiltered");e&&localStorage.removeItem("filterPredicatesData"),t&&localStorage.removeItem("isFiltered")},retrieveFilterDataFromLocalstorage:function(){var e,t;return(e=localStorage.getItem("filterPredicatesData"))&&(t=JSON.parse(e)),t},resetFilterData:function(){this.removeLStoredFilterData(),this.autocompleteHierarchicalInput.reset(),this.filterForm.reset();var e=this.WhatView.getElements(".uwa-input-tags");if(e.length>0){for(var t=0;t<e.length;t++)e[t].destroy();this.tagger.syncInputSize()}var i=new Date;this.fields&&(this.fields[0].destroy(),this.fields[1].destroy(),this.fields[0]=new r({min:this.firstDate,value:this.firstDate,max:i}).inject(this.WhenView.firstChild),this.fields[1]=new r({min:this.firstDate,value:i,max:i}).inject(this.WhenView.lastChild)),this.filterWhoSettingFlag=!1,this.isFiltered=!1,m.trackNotifFilterViewAction({eventAction:"resetFilterFields",eventLabel:"Reset filter panel fields",eventValue:this.unreadTotalCount})},hideTenantOptions:function(){if(this.whereView)for(var e of this.whereView.children)e&&e.children[0]&&"archive"!==e.children[0].name&&(e.style.display="none");else this.hideTenantsWhere=!0},showTenantOptions:function(){if(this.whereView)for(var e of this.whereView.children)e&&e.children[0]&&"archive"!==e.children[0].name&&(e.style.display="block");else this.hideTenantsWhere=!1}})}),define("DS/NotificationsCenter/js/view/NotificationCenterView",["UWA/Class","UWA/Class/Events","UWA/Class/Model","UWA/Utils","UWA/Class/Collection","DS/UIKIT/Input/ButtonGroup","DS/UIKIT/Alert","DS/UIKIT/Input/Button","DS/UIKIT/Input/Select","DS/UIKIT/Scroller","DS/NotifAlert/NotifAlert","DS/UIKIT/DropdownMenu","DS/UIKIT/SuperModal","DS/UIKIT/Spinner","DS/W3DXLogger/W3DXLogger","DS/UWPClientCode/I18n","DS/W3DXTimeline/Timeline","DS/NotificationsCenter/js/view/NotificationFilterView","DS/NotifAlert/NotificationUsageTracker","i18n!DS/NotificationsCenter/assets/nls/feed","DS/PlatformAPI/PlatformAPI"],function(e,t,i,n,o,s,a,r,l,c,d,f,u,h,p,g,m,w,b,v,y){"use strict";var I=new p({name:"3DNOTIF",debug:"debugNOTIF"});return I.log("NotificationCenterView load"),e.extend(t,{init:function(e){I.log("3DNOTIF - NotificationCenterView init"),this.section={},this.numRead=0,this.numFound=0,this.numMerged=0,this.showSpinner=!1,this.alerts={},this.isFiltering=!1,this.scrollCount=0,this.isInject=!1,this.dropDownMenu=void 0,this.showAllFlag=!1,this.showFilterFlag=!1,this.showSetting=!1,this.withRead="all",this.buildView(),this.buildTitle(),this.buildNoNotifs(),this.buildListner();var t=new UWA.Class.Collection;this.timeLine=new m({itemView:d,collection:t,pictureSize:"48px",removeTime:!1,removeCircle:!1})},buildListner:function(){var e=this;this.addEvent("updatePicture",function(t){I.log("NotificationCenterView updatePicture"),e.timeLine.dispatchEvent("updatePicture",t)}),this.notificationFilterView.addEvent("Filtering",function(t){I.log("NotificationCenterView filtering"),t&&(e.cleanAll(),e.showSpinner||(e.spinner=(new h).inject(e.noNotif,"after").show(),e.showSpinner=!0),e.isFiltering=!0,e.showFilterFlag=!0,e.numMerged=0,e.filteringIcon.style.color="#368ec4",e.unreadNotif.style.color="#368ec4",e.pushFilterSettingList(),e.dispatchEvent("getOldFilterNotif",[]))}),this.notificationFilterView.addEvent("Resetting",function(t){I.log("NotificationCenterView Resetting"),t&&(e.filteringIcon.style.color="#77797c",e.unreadNotif.style.color="#77797c",e.cleanAll(),e.dispatchEvent("getUnreadTotal"),e.dispatchEvent("getHistory","all"),e.dispatchEvent("resetFiltering"),e.isFiltering=!1,e.numMerged=0,e.pushDefaultSettingList())}),this.notificationFilterView.addEvent("Canceling",function(t){I.log("NotificationCenterView Canceling"),e.numMerged=0,t&&e.isFiltering?(e.filteringIcon.style.color="#368ec4",e.unreadNotif.style.color="#368ec4"):(e.filteringIcon.style.color="#77797c",e.unreadNotif.style.color="#77797C")}),this.notificationFilterView.addEvent("ResetSetting",function(t){e.updateSelectedSetting("all")}),this.addEvent("setTenants",function(t){I.log("NotificationCenterView setTenants"),e.notificationFilterView.dispatchEvent("setTenants",[JSON.parse(t.src.tenants)])}),this.addEvent("setWhoSettings",function(t){I.log("NotificationCenterView setWhoSettings"),e.notificationFilterView.dispatchEvent("setWhoSettings",t.src.settings)}),this.addEvent("setDates",function(t){I.log("NotificationCenterView setDates");var i=JSON.parse(t.src.Dates);e.notificationFilterView.dispatchEvent("setDates",new Date(i[0].FIRST_DATE))})},buildView:function(){var e=this;this.globalView=UWA.createElement("div",{class:"RTNotificationCenter",styles:{margin:"auto",height:"100%",padding:"10px",position:"absolute",left:"0px",right:"0px",overflow:"hidden"}}),this.toolbarView=UWA.createElement("div",{styles:{display:"inline-flex",width:"100%",margin:"10px 0px",height:"44px","margin-top":"-10px"}}).inject(this.globalView),this.alertsView=UWA.createElement("div",{}),this.scrollerView=new c({element:UWA.createElement("div",{class:"scrollable-body",styles:{margin:"auto",overflow:"hidden",height:"calc(100% - 58px)","max-width":"680px"},html:this.alertsView})}).inject(this.globalView),this.noNotif=UWA.createElement("div",{class:"NotifZero",styles:{height:"calc(100% - 58px)","max-width":"680px","text-align":"center","-webkit-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",margin:"auto",display:"none"}}).inject(e.scrollerView.elements.container.firstChild),this.scrollerView.elements.content.onscroll=function(t){"none"!==e.shareDropdownMenu.elements.container.style.display&&(e.shareDropdownMenu.elements.container.style.display="none",e.settingIcon.style.color="#b4b6ba"),e.dropDownMenu&&(e.dropDownMenu.dropDown.hide(),e.dropDownList=void 0),e.shareDropdownMenu.elements.container.style.display="none",!e.showAllFlag&&!e.showFilterFlag&&t.currentTarget.scrollHeight-t.currentTarget.scrollTop-t.currentTarget.clientHeight<2&&(e.scrollCount++,e.isFiltering||e.scrollCount%2==0?e.isFiltering&&e.scrollCount%2!=0&&(e.displaySpinner(!0),e.dispatchEvent("getMoreFilterHistory","filter")):(e.displaySpinner(!0),e.dispatchEvent("getMoreHistory",e.withRead)))},this.spinnerView=UWA.createElement("div",{styles:{margin:"auto","max-width":"680px","text-align":"center",display:"none"}}).inject(this.globalView);(new h).inject(this.spinnerView).show();this.initialSpinnerView=UWA.createElement("div",{styles:{margin:"auto","max-width":"680px","text-align":"center",display:"block",position:"absolute",top:"38%","padding-left":"44%"}}).inject(this.globalView);(new h).inject(this.initialSpinnerView).show()},buildNoNotifs:function(){UWA.createElement("span",{class:"fonticon handler fonticon-bell",styles:{color:"#d1d4d4","font-size":"90px","margin-top":"50px",opacity:"0.6"}}).inject(this.noNotif),UWA.createElement("div",{text:v.noNotifications,styles:{color:"#d1d4d4","font-size":"24px",width:"100%","text-align":"center",opacity:"0.6"}}).inject(this.noNotif)},buildTitle:function(e){var t=this;this.unreadNotif=UWA.createElement("div",{styles:{color:"#77797c","font-size":"14px",width:"100%",margin:"auto"}}).inject(this.toolbarView),this.filteringIconSpan=UWA.createElement("span",{styles:{color:"#77797c",background:"white",height:"38px",width:"38px",position:"absolute",right:"38px",top:"0px","text-align":"center"},events:{mouseover:function(){t.filteringIconSpan.style.cursor="pointer",t.notificationFilterView.isFiltered||t.notificationFilterView.showState||(t.filteringIcon.style.color="#3d3d3d")},mouseout:function(){t.filteringIconSpan.style.cursor="default",t.notificationFilterView.isFiltered||t.notificationFilterView.showState||(t.filteringIcon.style.color="#77797c")}}}).inject(this.toolbarView),this.notificationFilterView=new w,this.notificationFilterView.getView().inject(t.scrollerView.elements.container.firstChild,"top"),this.filteringIconSpan.onclick=function(){"#77797c"===t.filteringIcon.style.color.rgbToHex()||"#3d3d3d"===t.filteringIcon.style.color.rgbToHex()?t.filteringIcon.style.color="#368ec4":t.notificationFilterView.isFiltered||(t.filteringIcon.style.color="#77797c"),t.notificationFilterView.showState?(t.notificationFilterView.hide(),b.trackNotifFilterViewAction({eventAction:"clicknotifFilterIconToHide",eventLabel:"Click on filter icon to hide filterview",eventValue:0})):(t.notificationFilterView.show(),b.trackNotifFilterViewAction({eventAction:"clicknotifFilterIconToShow",eventLabel:"Click on filter icon to show filterview",eventValue:1}))},this.filteringIcon=UWA.createElement("span",{class:"fonticon fonticon-filter",title:v.filter,styles:{color:"#77797c","font-size":"18px","margin-top":"7px"}}).inject(this.filteringIconSpan),this.settingIconSpan=UWA.createElement("span",{title:v.preferencesDownM,styles:{color:"#77797c",background:"white",height:"38px",width:"38px",position:"absolute",right:"0px",top:"0px","text-align":"center"},events:{mouseover:function(){t.settingIconSpan.style.cursor="pointer",t.showSetting||(t.settingIcon.style.color="#3d3d3d")},mouseout:function(){t.settingIconSpan.style.cursor="default",t.showSetting||(t.settingIcon.style.color="#77797c")}}}).inject(this.toolbarView),this.settingIcon=UWA.createElement("span",{class:"fonticon handler fonticon-cog",styles:{color:"#77797c","font-size":"18px","margin-top":"7px"}}).inject(this.settingIconSpan),this.shareDropdownMenu=new f({target:this.settingIconSpan,items:[{id:"1",text:v.showAll,name:"all",selected:!0},{id:"2",text:v.readOnly,name:"read",disabled:!0},{id:"7",text:v.showImportant,name:"important",disabled:!0},{className:"divider"},{id:"3",text:v.markAllAsRead,name:"allread",disabled:!0},{id:"4",text:v.markAllAsUnread,name:"allunread",disabled:!0},{id:"5",text:v.deleteAll,name:"deleteall",disabled:!0},{className:"divider"},{id:"8",text:v.notificationsDisplay,name:"platformselection",selectable:!1,items:[{id:"81",text:v.currentPlatform,name:"currentplatform",selectable:!0},{id:"82",text:v.allPlatforms,name:"allplatforms",selectable:!0}]},{id:"6",text:v.preferencesDownM,name:"settings"}],events:{onClick:function(e,i){switch(i.name){case"settings":t.dispatchEvent("settings");break;case"all":t.removeLStoredSettingsData(),t.showAllFlag=!0,t.notificationFilterView.isFiltered=!1,t.shareDropdownMenu.updateItem({id:"1",text:v.showAll,name:"all"}),t.shareDropdownMenu.updateItem({id:"2",text:v.readOnly,name:"read"}),t.shareDropdownMenu.updateItem({id:"7",text:v.showStarred,name:"important"}),t.shareDropdownMenu.items[2].elements.container.classList.contains("selected")||(t.shareDropdownMenu.items[2].elements.container.classList.toggle("selectable"),t.shareDropdownMenu.items[2].elements.container.classList.toggle("selected")),t.shareDropdownMenu.items[3].elements.container.classList.contains("selected")&&(t.shareDropdownMenu.items[3].elements.container.classList.toggle("selectable"),t.shareDropdownMenu.items[3].elements.container.classList.toggle("selected")),t.shareDropdownMenu.items[4].elements.container.classList.contains("selected")&&(t.shareDropdownMenu.items[4].elements.container.classList.toggle("selectable"),t.shareDropdownMenu.items[4].elements.container.classList.toggle("selected")),t.shareDropdownMenu.updateItem({id:"3",text:v.markAllAsRead,name:"allread",disabled:!0}),t.shareDropdownMenu.updateItem({id:"4",text:v.markAllAsUnread,name:"allunread",disabled:!0}),t.shareDropdownMenu.updateItem({id:"5",text:v.deleteAll,name:"deleteall",disabled:!0}),(n=t.shareDropdownMenu.getItem("2")).elements&&n.elements.container&&n.elements.container.firstChild&&!n.elements.container.firstChild.className&&n.elements.container.firstChild.destroy(),(n=t.shareDropdownMenu.getItem("7")).elements&&n.elements.container&&n.elements.container.firstChild&&!n.elements.container.firstChild.className&&n.elements.container.firstChild.destroy(),t.cleanAll(),t.initialSpinnerView.style.display="block",t.withRead="all",t.isFiltering&&(t.dispatchEvent("getUnreadTotal"),t.resetFilter()),t.notificationFilterView.removeLStoredFilterData(),t.dispatchEvent("getHistory","all");break;case"read":t.showAllFlag=!0,t.removeLStoredSettingsData(),t.shareDropdownMenu.updateItem({id:"1",text:v.showAll,name:"all"}),t.shareDropdownMenu.updateItem({id:"2",text:v.readOnly,name:"read"}),t.shareDropdownMenu.updateItem({id:"7",text:v.showStarred,name:"important"}),t.shareDropdownMenu.items[3].elements.container.classList.contains("selected")||(t.shareDropdownMenu.items[3].elements.container.classList.toggle("selectable"),t.shareDropdownMenu.items[3].elements.container.classList.toggle("selected")),t.shareDropdownMenu.items[2].elements.container.classList.contains("selected")&&(t.shareDropdownMenu.items[2].elements.container.classList.toggle("selectable"),t.shareDropdownMenu.items[2].elements.container.classList.toggle("selected")),t.shareDropdownMenu.items[4].elements.container.classList.contains("selected")&&(t.shareDropdownMenu.items[4].elements.container.classList.toggle("selectable"),t.shareDropdownMenu.items[4].elements.container.classList.toggle("selected")),t.shareDropdownMenu.updateItem({id:"3",text:v.markAllAsRead,name:"allread",disabled:!0}),t.shareDropdownMenu.updateItem({id:"4",text:v.markAllAsUnread,name:"allunread",disabled:!0}),t.shareDropdownMenu.updateItem({id:"5",text:v.deleteAll,name:"deleteall",disabled:!0}),(n=t.shareDropdownMenu.getItem("1")).elements&&n.elements.container&&n.elements.container.firstChild&&!n.elements.container.firstChild.className&&n.elements.container.firstChild.destroy(),(n=t.shareDropdownMenu.getItem("7")).elements&&n.elements.container&&n.elements.container.firstChild&&!n.elements.container.firstChild.className&&n.elements.container.firstChild.destroy(),t.cleanAll(),t.initialSpinnerView.style.display="block",t.withRead="unread",t.storeSettingsToLocalstorage("unread"),t.isFiltering&&(t.dispatchEvent("getUnreadTotal"),t.resetFilter()),t.dispatchEvent("getHistory","unread");break;case"allread":t.markAll({read:!0,filter:!1});break;case"allunread":t.markAll({read:!1,filter:!1}),t.filteringIcon.style.color="#77797c",t.unreadNotif.style.color="#77797C";break;case"deleteall":t.deleteAll();break;case"deletefilternotif":t.deleteFilterNotif();break;case"allfilterread":t.markAll({read:!0,filter:!0});break;case"allfilterunread":t.markAll({read:!1,filter:!0}),t.filteringIcon.style.color="#77797c",t.unreadNotif.style.color="#77797C";break;case"important":var n;t.showAllFlag=!0,t.removeLStoredSettingsData(),t.shareDropdownMenu.updateItem({id:"1",text:v.showAll,name:"all"}),t.shareDropdownMenu.updateItem({id:"2",text:v.readOnly,name:"read"}),t.shareDropdownMenu.updateItem({id:"7",text:v.showStarred,name:"important"}),t.shareDropdownMenu.items[4].elements.container.classList.contains("selected")||(t.shareDropdownMenu.items[4].elements.container.classList.toggle("selectable"),t.shareDropdownMenu.items[4].elements.container.classList.toggle("selected")),t.shareDropdownMenu.items[2].elements.container.classList.contains("selected")&&(t.shareDropdownMenu.items[2].elements.container.classList.toggle("selectable"),t.shareDropdownMenu.items[2].elements.container.classList.toggle("selected")),t.shareDropdownMenu.items[3].elements.container.classList.contains("selected")&&(t.shareDropdownMenu.items[3].elements.container.classList.toggle("selectable"),t.shareDropdownMenu.items[3].elements.container.classList.toggle("selected")),t.shareDropdownMenu.updateItem({id:"3",text:v.markAllAsRead,name:"allread",disabled:!0}),t.shareDropdownMenu.updateItem({id:"4",text:v.markAllAsUnread,name:"allunread",disabled:!0}),t.shareDropdownMenu.updateItem({id:"5",text:v.deleteAll,name:"deleteall",disabled:!0}),(n=t.shareDropdownMenu.getItem("1")).elements&&n.elements.container&&n.elements.container.firstChild&&!n.elements.container.firstChild.className&&n.elements.container.firstChild.destroy(),(n=t.shareDropdownMenu.getItem("2")).elements&&n.elements.container&&n.elements.container.firstChild&&!n.elements.container.firstChild.className&&n.elements.container.firstChild.destroy(),t.cleanAll(),t.initialSpinnerView.style.display="block",t.withRead="starred",t.storeSettingsToLocalstorage("starred"),t.isFiltering&&t.resetFilter(),t.dispatchEvent("getHistory","starred");break;case"currentplatform":t.dispatchEvent("updateTenantAgnosticMode","current");break;case"allplatforms":t.dispatchEvent("updateTenantAgnosticMode","all")}},onHide:function(){t.showSetting=!1,t.settingIcon.style.color="#77797c"},onShow:function(){"#77797c"===t.settingIcon.style.color.rgbToHex()||"#3d3d3d"===t.settingIcon.style.color.rgbToHex()?(t.settingIcon.style.color="#368ec4",t.showSetting=!0):t.settingIcon.style.color="#77797c"}}})},buildToolBar:function(){var e=this;this.groupB=UWA.createElement("div",{styles:{width:"100%"}}).inject(this.toolbarView),this.selectView=UWA.createElement("div",{styles:{width:"140px"}}).inject(this.groupB);var t=new l({placeholder:!1,options:[{value:"1",label:v.showAll,selected:!0},{value:"2",label:v.readOnly}],events:{onChange:function(i){var n=t.getValue();e.cleanAll(),e.dispatchEvent("getHistory","1"===n[0]?"all":"unread")}}}).inject(this.selectView);this.markAllIcon=UWA.createElement("span",{text:v.markAllAsRead,styles:{color:"#368EC4","font-weight":"bold","min-width":"150px",margin:"auto","font-size":"13px","text-align":"right"},events:{click:function(t){e.markAllIcon.innerText===v.markAllAsRead?(e.markAll({read:!0}),e.markAllIcon.innerText=v.markAllAsUnread):(e.markAll({read:!1}),e.markAllIcon.innerText=v.markAllAsRead)},mouseover:function(){e.markAllIcon.style.cursor="pointer",e.markAllIcon.style.textDecoration="underline"},mouseout:function(){e.markAllIcon.style.cursor="default",e.markAllIcon.style.textDecoration=""}}}).inject(this.toolbarView)},addNotification:function(e,t,n,o){this.initialSpinnerView.style.display="none",this.displayNoNotification(!1),this.disableMenu(!1);var s=this,a=e.MESSAGE,r=!a.icon||a.icon&&a.icon.type&&"appID"===a.icon.type,l=new i({id:e.ID,img:a.icon,text:decodeURI(encodeURI(a.nls.msg)),options:a.actions,appIconBorder:r,listOfService:s.listOfService,readState:!!e.READ_DATE,isInNotifCenter:!0,actioned:!(!e.ACTION_DATE||"0000-00-00 00:00:00"===e.ACTION_DATE),provider:e.APPID,notifications:e.notifications?e.notifications:null,platformId:e.PLATFORMID?e.PLATFORMID:"",date:Date.parse(e.CREATION_DATE),actionedLabel:e.ACTION,actor_data:e.ACTOR_DATA,shared:e.SHARED,isMerge:e.COUNT,groupID:e.GROUPID,appName:n,starredState:1==e.STARRED,currentTenant:o});this.isInject||(this.timeLine.inject(this.alertsView),this.isInject=!0),this.timeLine.add(l,t),l.addEvent("readCenter",function(e){s.dispatchEvent("read",e),"unread"===s.withRead&&this.dispatchEvent("deleteView",e)}),l.addEvent("readMerged",function(e){s.dispatchEvent("read",e)}),l.addEvent("readHiddenMerged",function(e){s.dispatchEvent("readHiddenMerged",e),"unread"===s.withRead&&this.dispatchEvent("deleteView",e)}),l.addEvent("starHiddenMerged",function(e){s.dispatchEvent("starHiddenMerged",e)}),l.addEvent("starredCenter",function(e){e.starred?s.numStarred++:s.numStarred--,s.dispatchEvent("starred",e),"starred"===s.withRead&&(this.dispatchEvent("deleteView",e),s.setNumOfImportant(s.numStarred))}),l.addEvent("starredMerged",function(e){s.dispatchEvent("starred",e)}),l.addEvent("unreadCountDecrement",function(){s.numRead--,s.notificationFilterView.isFiltered||s.setNumOfUnread(s.numRead)}),l.addEvent("addDropDownMenu",function(e){s.dropDownMenu=e}),l.addEvent("removeDropDownMenu",function(e){s.dropDownMenu=void 0}),l.addEvent("actioned",function(e){s.dispatchEvent("actioned",e)}),l.addEvent("updateLabel",function(e){s.dispatchEvent("updateLabel",e)}),l.addEvent("unsubscribeCenter",function(t){I.log("unsubscribe"),s.numRead--,s.showAllFlag=!0,t?s.dispatchEvent("unsubscribe",[{id:e.ID,subscribe:0,forHour:t.forHour}]):s.dispatchEvent("unsubscribe",[{id:e.ID,subscribe:0}])}),l.addEvent("publish",function(e){s.dispatchEvent("publish",e)}),l.addEvent("deleteMerged",function(e){s.dispatchEvent("delete",{id:e.id})}),l.addEvent("deleteCenter",function(t){t.read||(s.numRead--,s.notificationFilterView.isFiltered||s.setNumOfUnread(s.numRead)),s.numFound--,s.notificationFilterView.isFiltered&&s.setNumOfFound(s.numFound),s.timeLine.getElement(".TL-section")||(s.cleanAll(),s.displayNoNotification(!0));let i={id:e.ID,read:t.read};t.groupID&&(i.groupID=t.groupID),s.dispatchEvent("delete",i)}),l.addEvent("getMerge",function(e){s.dispatchEvent("getMerge",e)}),l.addEvent("closeNotifCenter",function(e){s.dispatchEvent("closeNotifCenter",e)}),l.addEvent("increaseCount",function(){s.numRead++,s.notificationFilterView.isFiltered||s.setNumOfUnread(s.numRead)}),e.REFRESH&&(s.cleanAll(),s.withRead="all",s.dispatchEvent("getHistory","all"))},addMergeNotifications:function(e,t,n,o){var s=this;if(e){var a;e=JSON.parse(e);for(var r=new(UWA.Class.Collection.extend({model:i})),l=0;l<e.length;l++){var c=e[l],d=c.MESSAGE,f=!d.icon||d.icon&&d.icon.type&&"appID"===d.icon.type;a=new i({id:c.ID,img:c.MESSAGE.icon,text:decodeURI(encodeURI(c.MESSAGE.nls.msg)),options:c.MESSAGE.actions,appIconBorder:f,listOfService:s.listOfService,readState:!!c.READ_DATE,isInNotifCenter:!0,actioned:!(!c.ACTION_DATE||"0000-00-00 00:00:00"===c.ACTION_DATE),provider:c.APPID,viewIndex:s.numMerged,merged:!0,creationDate:c.CREATION_DATE,platformId:c.PLATFORMID?c.PLATFORMID:"",state:c.STATE,actionedLabel:c.ACTION,actor_data:c.ACTOR_DATA,appName:t,currentTenant:o}),r.add(a),a.addEvent("read",function(e){s.dispatchEvent("read",e)}),a.addEvent("actioned",function(e){s.dispatchEvent("actioned",e)}),a.addEvent("updateLabel",function(e){s.dispatchEvent("updateLabel",e)}),a.addEvent("unsubscribe",function(e){s.numRead--,s.dispatchEvent("unsubscribe",[{id:c.ID,subscribe:0}])}),a.addEvent("publish",function(e){s.dispatchEvent("publish",e)}),a.addEvent("deleteCenter",function(e){s.dispatchEvent("delete",{id:e.id,read:e.read})}),a.addEvent("addDropDownMenu",function(e){s.dropDownMenu=e}),a.addEvent("removeDropDownMenu",function(e){s.dropDownMenu=void 0}),a.addEvent("closeNotifCenter",function(e){s.dispatchEvent("closeNotifCenter",e)})}s.timeLine.alertlist[e[0].ID].alert.setMergeView(r,e,n)}},markAll:function(e){if(this.timeLine.markAll(e),this.dispatchEvent("readAll",[{read:e.read,filter:e.filter}]),this.numRead=0,this.numFound=0,this.notificationFilterView.isFiltered?this.setNumOfFound(this.numFound):this.setNumOfUnread(this.numRead),!e.read&&!this.notificationFilterView.isFiltered){var t=this;setTimeout(function(){t.dispatchEvent("getUnreadTotal",[])},500)}!e.read&&this.notificationFilterView.isFiltered&&(this.setNumOfFound(this.notificationFilterView.filterCount),this.filteringIcon.style.color="#368ec4",this.unreadNotif.style.color="#368ec4"),e.read&&"unread"===this.withRead?(this.cleanAll(),this.displayNoNotification(!0)):e.read||"unread"!==this.withRead||(t.cleanAll(),t.initialSpinnerView.style.display="block",t.withRead="unread",setTimeout(function(){t.dispatchEvent("getHistory","unread")},500))},deleteAll:function(e){var t=this;new u({renderTo:document.body}).confirm(v.deleteMsgForPopup,v.confirmMsg,function(e){console.log("Confirm result: "+e),e&&(t.cleanAll(),t.numRead=0,t.setNumOfUnread(t.numRead),t.dispatchEvent("deleteAllNotification",[]),t.displayNoNotification(!0))})},deleteFilterNotif:function(){var e=this;new u({renderTo:document.body,okButtonText:v.yesbuttonLabel,koButtonText:v.nobuttonLabel}).confirm(v.deleteFilteredNotifMsgForPopup,v.confirmMsgFilteredNotif,function(t){console.log("Confirm result: "+t),t&&(e.notificationFilterView.CancelButton.click(),e.cleanAll(),e.numRead=0,e.setNumOfUnread(e.numRead),e.dispatchEvent("deleteAllFilteredNotification",[]),e.filteringIcon.style.color="#77797c",e.unreadNotif.style.color="#77797C",e.displayAlertMsg(),setTimeout(function(){e.dispatchEvent("getHistory","all")},800))})},displayAlertMsg:function(e){this.deleteNotif?(this.deleteNotif.destroy(),this.deleteNotif=new a({visible:!0,autoHide:!0,hideDelay:e?5e3:3e3,maximumVisibleMessages:1}).inject(this.globalView,"before")):this.deleteNotif=new a({visible:!0,autoHide:!0,hideDelay:e?5e3:3e3,maximumVisibleMessages:1}).inject(this.globalView,"before"),this.displaymsg=e?this.deleteNotif.add({className:"primary",message:v.archiveAlert||"If you want to view older notifications please use Archive checkbox while doing Filter operation"}):this.deleteNotif.add({className:"primary",message:this.numFound+" notifications have been deleted"})},refresh:function(e){var t=e?this.withRead:"all",i=this;this.cleanAll(),this.numRead=0,this.displayNoNotification(!0),this.dispatchEvent("getHistory",t),i.notificationFilterView.isFiltered||(this.setNumOfUnread(this.numRead),setTimeout(function(){i.dispatchEvent("getUnreadTotal",[])},500))},cleanAll:function(e){for(var t in this.alerts)delete this.alerts[t];for(;this.alertsView.firstChild;)this.alertsView.removeChild(this.alertsView.firstChild);this.numMerged=0,this.section=[],this.disableMenu(!0);var i=new UWA.Class.Collection;this.timeLine=new m({itemView:d,collection:i,pictureSize:"48px",removeTime:!1,removeCircle:!1}),this.isInject=!1},setNumOfUnread:function(e){1===e?(this.unreadNotif.style.display="block",this.unreadNotif.innerHTML="<strong>"+e+" "+v.oneNotification+"</strong> "):e>1?(this.unreadNotif.style.display="block",this.unreadNotif.innerHTML="<strong>"+e+" "+v.notifications+"</strong> "):(this.unreadNotif.innerHTML="",this.unreadNotif.style.display="none")},setNumOfFound:function(e){1===e?(this.unreadNotif.style.display="block",this.unreadNotif.innerHTML="<strong>"+e+" "+v.onefoundNotifications+"</strong> "):e>1?(this.unreadNotif.style.display="block",this.unreadNotif.innerHTML="<strong>"+e+" "+v.foundNotifications+"</strong> "):(this.unreadNotif.innerHTML="",this.unreadNotif.style.display="none")},setNumOfImportant:function(e){1===e?(this.unreadNotif.style.display="block",this.unreadNotif.innerHTML="<strong>"+e+" "+v.oneStarredNotification+"</strong> "):e>1?(this.unreadNotif.style.display="block",this.unreadNotif.innerHTML="<strong>"+e+" "+v.starredNotifications+"</strong> "):(this.unreadNotif.innerHTML="",this.unreadNotif.style.display="none")},getView:function(){return I.log("NotificationCenterView getView"),this.globalView},displayNoNotification:function(e){this.noNotif.style.display=e?"block":"none"},disableMenu:function(e){this.shareDropdownMenu.updateItem({id:"2",disabled:e}),this.shareDropdownMenu.updateItem({id:"3",disabled:e}),this.shareDropdownMenu.updateItem({id:"4",disabled:e}),this.shareDropdownMenu.updateItem({id:"5",disabled:e}),this.shareDropdownMenu.updateItem({id:"7",disabled:e})},pushFilterSettingList:function(){this.shareDropdownMenu.getItem("allread")&&this.shareDropdownMenu.updateItem({id:"3",text:v.markAllFilterAsRead,name:"allfilterread"}),this.shareDropdownMenu.getItem("allunread")&&this.shareDropdownMenu.updateItem({id:"4",text:v.markAllFilterAsUnread,name:"allfilterunread"}),this.shareDropdownMenu.getItem("deleteall")&&this.shareDropdownMenu.updateItem({id:"5",text:v.deleteFilteredNotif,name:"deletefilternotif"})},pushDefaultSettingList:function(){this.shareDropdownMenu.getItem("allfilterread")&&this.shareDropdownMenu.updateItem({id:"3",text:v.markAllAsRead,name:"allread"}),this.shareDropdownMenu.getItem("allfilterunread")&&this.shareDropdownMenu.updateItem({id:"4",text:v.markAllAsUnread,name:"allunread"}),this.shareDropdownMenu.getItem("deletefilternotif")&&this.shareDropdownMenu.updateItem({id:"5",text:v.deleteAll,name:"deleteall"})},displaySpinner:function(e){this.spinnerView.style.display=e?"block":"none"},deleteNotification:function(e){this.timeLine.deleteView(e)},storeSettingsToLocalstorage:function(e){if(localStorage.setItem("settingsData",e),y.getUser()){var t=y.getUser().login;localStorage.setItem("settingsUser",t)}},removeLStoredSettingsData:function(){localStorage.getItem("settingsData")&&localStorage.removeItem("settingsData"),localStorage.getItem("settingsUser")&&localStorage.removeItem("settingsUser")},retrieveSettingsFromLocalstorage:function(){var e,t,i={};return e=localStorage.getItem("settingsData"),t=localStorage.getItem("settingsUser"),e&&(i.setting=e),t&&(i.login=t),i},updateSelectedSetting:function(e){"unread"==e?(this.shareDropdownMenu.items[3].elements.container.classList.contains("selected")||(this.shareDropdownMenu.items[3].elements.container.classList.toggle("selectable"),this.shareDropdownMenu.items[3].elements.container.classList.toggle("selected")),this.shareDropdownMenu.items[2].elements.container.classList.contains("selected")&&(this.shareDropdownMenu.items[2].elements.container.classList.toggle("selectable"),this.shareDropdownMenu.items[2].elements.container.classList.toggle("selected")),this.shareDropdownMenu.items[4].elements.container.classList.contains("selected")&&(this.shareDropdownMenu.items[4].elements.container.classList.toggle("selectable"),this.shareDropdownMenu.items[4].elements.container.classList.toggle("selected"))):"all"==e?(this.shareDropdownMenu.items[2].elements.container.classList.contains("selected")||(this.shareDropdownMenu.items[2].elements.container.classList.toggle("selectable"),this.shareDropdownMenu.items[2].elements.container.classList.toggle("selected")),this.shareDropdownMenu.items[3].elements.container.classList.contains("selected")&&(this.shareDropdownMenu.items[3].elements.container.classList.toggle("selectable"),this.shareDropdownMenu.items[3].elements.container.classList.toggle("selected")),this.shareDropdownMenu.items[4].elements.container.classList.contains("selected")&&(this.shareDropdownMenu.items[4].elements.container.classList.toggle("selectable"),this.shareDropdownMenu.items[4].elements.container.classList.toggle("selected"))):(this.shareDropdownMenu.items[4].elements.container.classList.contains("selected")||(this.shareDropdownMenu.items[4].elements.container.classList.toggle("selectable"),this.shareDropdownMenu.items[4].elements.container.classList.toggle("selected")),this.shareDropdownMenu.items[2].elements.container.classList.contains("selected")&&(this.shareDropdownMenu.items[2].elements.container.classList.toggle("selectable"),this.shareDropdownMenu.items[2].elements.container.classList.toggle("selected")),this.shareDropdownMenu.items[3].elements.container.classList.contains("selected")&&(this.shareDropdownMenu.items[3].elements.container.classList.toggle("selectable"),this.shareDropdownMenu.items[3].elements.container.classList.toggle("selected")))},resetFilter:function(){this.notificationFilterView.dispatchEvent("resetFilterData"),this.filteringIcon.style.color="#77797c",this.unreadNotif.style.color="#77797C",this.isFiltering=!1,this.numMerged=0,this.pushDefaultSettingList()},setPlatformSelectionDisplay:function(e){this.shareDropdownMenu.getItem("platformselection").elements.container.style.display=e?"none":"table"},setPlatformSelectionMode:function(e){switch(e){case"current":this.shareDropdownMenu.getItem("currentplatform").elements.container.classList.contains("selected")||this.shareDropdownMenu.getItem("currentplatform").elements.container.classList.toggle("selected"),this.shareDropdownMenu.getItem("allplatforms").elements.container.classList.contains("selected")&&this.shareDropdownMenu.getItem("allplatforms").elements.container.classList.toggle("selected"),this.notificationFilterView.hideTenantOptions();break;case"all":this.shareDropdownMenu.getItem("allplatforms").elements.container.classList.contains("selected")||this.shareDropdownMenu.getItem("allplatforms").elements.container.classList.toggle("selected"),this.shareDropdownMenu.getItem("currentplatform").elements.container.classList.contains("selected")&&this.shareDropdownMenu.getItem("currentplatform").elements.container.classList.toggle("selected"),this.notificationFilterView.showTenantOptions()}}})}),define("DS/NotificationsCenter/js/controller/NotificationCenterController",["UWA/Class","UWA/Class/Events","DS/PlatformAPI/PlatformAPI","DS/NotificationsCenter/js/view/NotificationCenterView","DS/NotificationsCenter/js/view/NotificationSettingsView","DS/W3DXLogger/W3DXLogger","i18n!DS/NotificationsCenter/assets/nls/feed","DS/UIKIT/SuperModal","DS/NotifAlert/NotificationUsageTracker","css!NotificationsCenter/assets/fonticons/fontNotificationStyle.css"],function(e,t,i,n,o,s,a,r,l){"use strict";var c=new s({name:"3DNOTIF",debug:"debugNOTIF"});c.log("NotificationCenterController load");var d={},f=void 0,u=e.extend(t,{init:function(){c.log("NotificationCenterController init"),this.centerView=void 0,this.settingsView=void 0,this.settingsViewExists=!0,this.listOfService=void 0,this.nameofUpdatedSetting=void 0,this.defaultSettings={notif_by_ui:1,notif_by_email:0,notif_by_browser:0},this.oldNotif={CREATION_DATE:void 0,ID:void 0},this.buildView(),this.buildMessagelistner(),this.getServices(),this.loadTime=null,this.startTime=null,this.endTime=null,this.getTenantAgnosticMode(),this.getHistory("all"),this.getUnreadTotal(),this.getUnreadTotalFlag=!0,this.groupIDs=[],this.filterNotifId=[],this.getMoreHistoryFlag=!1,this.getSettings(),this.getTenants(),this.getDates(),this.resetNotifications(),this.platformSelectionInitialized=!1},buildView:function(){var e=this;this.centerView=new n,this.centerView.addEvent("read",function(t){if(t&&t.id){var n={action:"notificationRead",id:t.id,read:t.read,actioned:t.actioned};i.publish("3dnotifinterne",n),l.trackCenterAction({eventAction:t.read?"notificationRead":"notificationUnread",eventLabel:(t.read?"R":"Unr")+"ead a notification",eventValue:e.centerView.numRead})}}),this.centerView.addEvent("readAll",function(t){e.readAllNotifications(t)}),this.centerView.addEvent("starred",function(e){if(e&&e.id){var t={action:"notificationRead",id:e.id,starred:"starred",param:e.starred};i.publish("3dnotifinterne",t)}}),this.centerView.addEvent("actioned",function(e){if(e&&e.id){var t={action:"actioned",params:{id:e.id,actioned:!0}};i.publish("3dnotifinterne",t)}}),this.centerView.addEvent("updateLabel",function(e){if(e&&e.id){var t={action:"notificationRead",updateLabel:"updateLabel",params:{id:e.id,label:e.label,flag:e.flag}};i.publish("3dnotifinterne",t)}}),this.centerView.addEvent("getHistory",function(t){e.getHistory(t)}),this.centerView.addEvent("getOldFilterNotif",function(t){1==e.centerView.isFiltering&&(e.oldNotif={CREATION_DATE:void 0,ID:void 0},e.groupIDs=[])}),this.centerView.addEvent("deleteAllNotification",function(t){e.deleteAllNotification(t)}),this.centerView.addEvent("deleteAllFilteredNotification",function(t){e.deleteAllFilteredNotification(t)}),this.centerView.addEvent("publish",function(e){i.publish(e.topic,e.data)}),this.centerView.addEvent("getMerge",function(e){var t={action:"getMerge",id:e.id,groupID:e.groupID,toBeActioned:e.toBeActioned};i.publish("3dnotifinterne",t)}),this.centerView.addEvent("readHiddenMerged",function(e){var t={action:"notificationRead",id:e.id,groupID:e.groupID,read:e.read,hiddenMerged:!0};i.publish("3dnotifinterne",t)}),this.centerView.addEvent("starHiddenMerged",function(e){var t={action:"notificationRead",id:e.id,groupID:e.groupID,starred:"starred",hiddenMerged:!0,param:e.starred};i.publish("3dnotifinterne",t)}),this.centerView.addEvent("delete",function(t){if(t&&t.id){var n={action:"notificationDelete",id:t.id,read:t.read};t.groupID&&(n.groupID=t.groupID),i.publish("3dnotifinterne",n),l.trackCenterAction({eventAction:"notificationDelete",eventLabel:"Delete a notification",eventValue:e.centerView.numRead})}}),this.centerView.addEvent("settings",function(t){e.settingsView&&(e.settingsView.show(),e.centerView.globalView.style.display="none",l.trackNotifSettingIconAction({eventAction:"invokenotifSettingView",eventLabel:"Open settings view",eventValue:1}))}),e.centerView.addEvent("updateSettings",function(t){e.updateSettings(t)}),e.centerView.addEvent("unsubscribe",function(t){e.unsubscribe(t)}),e.centerView.addEvent("getMoreHistory",function(t){e.getMoreHistory(t)}),e.centerView.addEvent("getMoreFilterHistory",function(t){e.getMoreFilterHistory(t)}),e.centerView.addEvent("getUnreadTotal",function(t){e.getUnreadTotal()}),e.centerView.addEvent("closeNotifCenter",function(e){i.publish("3dnotifinterne",{action:"closeNotifCenter"})}),e.centerView.addEvent("resetFiltering",function(e){i.publish("3dnotifinterne",{action:"resetFilter"})}),e.centerView.addEvent("updateTenantAgnosticMode",function(e){var t="all"===e;i.publish("3dnotifinterne",{action:"updateTenantAgnosticMode",tenantAgnosticMode:t})}),"undefined"!=typeof widget&&widget.environment&&(widget.environment.onResize=function(t){e.centerView.notificationFilterView.tagger.syncInputSize()})},buildMessagelistner:function(){c.log("NotificationCenterController buildMessagelistner");var e=this;i.subscribe("3dnotifinterne",function(t){switch(t.action){case"rollbackPopup":var n,o;t.params.isInNotifCenter?(n=document.body,o=a.rollbackPopupTitleForNotifCenter):(n=parent.document.body,o=a.rollbackPopupTitleFor3DDashboard),new r({renderTo:n}).confirm(a.rollbackPopupMsg,o,function(e){i.publish("3dnotifinterne",{action:"rollbackPopupconfirmation",file:t.params.file,id:t.params.id,confirmPopupResult:e})});break;case"refreshForRollback":e.centerView.cleanAll(),e.centerView.withRead="all",e.centerView.dispatchEvent("getHistory","all");break;case"addNotification":var s=JSON.parse(t.notification),c=t.appName,d=t.currentTenant;e.addNotification(s,"top",c,d),e.centerView.numRead++,e.centerView.setNumOfUnread(e.centerView.numRead);break;case"setTenantAgnosticMode":void 0!==t.hidePlatformSelection&&e.centerView.setPlatformSelectionDisplay(t.hidePlatformSelection);var f=t.tenantAgnosticMode?"all":"current";e.centerView.setPlatformSelectionMode(f),e.platformSelectionInitialized?e.centerView.refresh(!0):e.platformSelectionInitialized=!0;break;case"setHistory":var u=JSON.parse(t.notifications);c=t.appName,d=t.currentTenant;t.language&&e.centerView.timeLine.language!=t.language&&(e.centerView.timeLine.language=t.language),e.centerView.initialSpinnerView.style.display="none",0===u.length&&0===e.centerView.globalView.getElementsByClassName("RTMainNotifAlert").length?(e.centerView.initialSpinnerView.style.display="none",e.centerView.displayNoNotification(!0)):(0===u.length&&e.getMoreHistoryFlag&&e.centerView.displayAlertMsg(!0),e.centerView.displayNoNotification(!1)),"starred"===t.starred?e.getStarredTotal():e.getUnreadTotalFlag?e.getUnreadTotalFlag=!1:e.getUnreadTotal(),e.setHistory(u,c,d),e.centerView.showAllFlag=!1;break;case"setAppInfos":e.centerView.dispatchEvent("updatePicture",[{src:t.src,notifID:t.notifID}]);break;case"setTenants":e.centerView.dispatchEvent("setTenants",[{src:t}]);break;case"setDates":e.centerView.dispatchEvent("setDates",[{src:t}]);break;case"setNotifications":u=JSON.parse(t.notifications),c=t.appName,d=t.currentTenant;e.centerView.initialSpinnerView.style.display="none",u.length?e.centerView.numFound=u.length:(u.length=0,e.centerView.numFound=0,e.centerView.initialSpinnerView.style.display="none"),e.centerView.spinner&&(e.centerView.spinner.elements.container.style.display="none"),e.setHistory(u,c,d),e.centerView.showFilterFlag=!1;break;case"setServices":e.listOfService=t.services;break;case"setWhoSettings":e.centerView.dispatchEvent("setWhoSettings",[{src:t.settings}]),!e.settingsViewExists&&localStorage.getItem("filterPredicatesData")&&e.setFilterWhoSettings();break;case"setSettings":e.setSettings(t.settings,widget.body);break;case"refreshCenterView":e.centerView&&e.centerView.refresh();break;case"setSetting":e.nameofUpdatedSetting=t.setting,e.settingsView&&e.settingsView.setSetting(t.setting),l.trackNotifSettingsViewAction({eventAction:"unsubscribeNotification",eventLabel:"Unsubscribe notification",persDim:{pd1:e.nameofUpdatedSetting.NAME}}),e.updateSettingsTracker(t.setting);break;case"setUnreadTotal":e.centerView.numRead=t.unread,e.centerView.notificationFilterView.unreadTotalCount=t.unread,e.centerView.setNumOfUnread(t.unread);break;case"setStarredTotal":e.centerView.numStarred=t.starred,e.centerView.setNumOfImportant(t.starred);break;case"setFilteredTotal":0==t.count&&(e.centerView.initialSpinnerView.style.display="none",e.centerView.spinner&&(e.centerView.spinner.elements.container.style.display="none"),e.centerView.displayNoNotification(!0)),e.centerView.numFound=t.count,e.centerView.notificationFilterView.filterCount=t.count,e.centerView.setNumOfFound(t.count);u=[];if(t.notifications)try{u=JSON.parse(t.notifications)}catch(e){UWA.log("3DNotification error: notifications JSON parsing error")}if(u.length>=1){e.filterNotifId.length>0&&(e.filterNotifId=[]);for(var h=0;h<u.length;h++)if(e.filterNotifId.push(u[h].ID),u[h].hasOwnProperty("notifications"))for(var p=JSON.parse(u[h].notifications),g=1;g<p.length;g++)e.filterNotifId.push(p[g].ID);UWA.log("Array of filter IDs :"+e.filterNotifId)}break;case"read":if(t.params.scope)e.centerView.timeLine.markAll(t.params),t.params.read?(e.centerView.numRead=0,e.centerView.setNumOfUnread(e.centerView.numRead)):setTimeout(function(){e.dispatchEvent("getUnreadTotal",[])},500);else if(e.centerView&&e.centerView.timeLine&&e.centerView.timeLine.alertlist&&e.centerView.timeLine.alertlist[t.params.id]&&e.centerView.timeLine.alertlist[t.params.id].alert&&e.centerView.timeLine.alertlist[t.params.id].timeView&&e.centerView.timeLine.alertlist[t.params.id].circleView){var m,w=e.centerView.timeLine.alertlist[t.params.id].circleView,b=e.centerView.timeLine.alertlist[t.params.id].timeView,v=e.centerView.timeLine.alertlist[t.params.id].textView.getElement(".TL-cirlce-item");if(v&&(m=v.getElement(".fonticon")),t.params.starred)e.centerView.timeLine.alertlist[t.params.id].alert.getStarredstate()!=t.params.starredState?(e.centerView.timeLine.alertlist[t.params.id].alert.setStarredstate(t.params.starredState),t.params.starredState?(1===v.children.length&&(m=UWA.createElement("div",{class:"fonticon fonticon-favorite-on",styles:{color:"rgb(54, 142, 196)","font-size":"16px","margin-top":"18px","margin-left":"-8px"}}).inject(v)),m&&(m.style.display="block"),w.style.display="none",m&&(e.centerView.timeLine.alertlist[t.params.id].alert.getReadstate()?(m.removeClassName("fonticon-favorite-on"),m.addClassName("fonticon-favorite-off")):(m.removeClassName("fonticon-favorite-off"),m.addClassName("fonticon-favorite-on")))):e.centerView.timeLine.alertlist[t.params.id].alert.getReadstate()?(m&&(m.style.display="none"),w.style.display="block",w.style.background="",w.style.border="2px solid #368ec4"):(m&&(m.style.display="none"),w.style.display="block",w.style.background="#368ec4",w.style.border="2px solid #368ec4")):e.centerView.timeLine.alertlist[t.params.id].alert.getReadstate()?(w.style.background="",b.style.opacity="0.6"):w.style.background="#368ec4";else{var y=!0;if(e.centerView.timeLine.alertlist[t.params.id].alert.mergeList){let i=!1;for(let n of e.centerView.timeLine.alertlist[t.params.id].alert.mergeList)i=i||!n.getReadstate();y=t.params.read!==i}y&&t.params.read&&e.centerView.timeLine.alertlist[t.params.id].alert.getReadstate()!==t.params.read?(e.centerView.timeLine.alertlist[t.params.id].alert.setReadstate(t.params.read),e.centerView.timeLine.alertlist[t.params.id].timeView.style.opacity="0.6",e.centerView.timeLine.alertlist[t.params.id].circleView.style.background="",m&&(m.removeClassName("fonticon-favorite-on"),m.addClassName("fonticon-favorite-off")),e.centerView.numRead--,e.centerView.setNumOfUnread(e.centerView.numRead)):y&&e.centerView.timeLine.alertlist[t.params.id].alert.getReadstate()!==t.params.read&&(e.centerView.timeLine.alertlist[t.params.id].alert.setReadstate(t.params.read),e.centerView.timeLine.alertlist[t.params.id].timeView.style.opacity="1",e.centerView.timeLine.alertlist[t.params.id].circleView.style.background="rgb(54, 142, 196)",m&&(m.removeClassName("fonticon-favorite-off"),m.addClassName("fonticon-favorite-on")),e.centerView.numRead++,e.centerView.setNumOfUnread(e.centerView.numRead))}}break;case"updateLabel":e.centerView&&e.centerView.timeLine&&e.centerView.timeLine.alertlist&&e.centerView.timeLine.alertlist[t.params.id]&&e.centerView.timeLine.alertlist[t.params.id].alert&&e.centerView.timeLine.alertlist[t.params.id].alert.updateActionedLabel(t.params.label,t.params.flag);break;case"setMerge":c=t.appName,d=t.currentTenant;e.centerView&&e.centerView.timeLine&&e.centerView.timeLine.alertlist&&e.centerView.timeLine.alertlist[t.id]&&e.centerView.timeLine.alertlist[t.id].alert&&e.addMergeNotifications(t.notifications,c,t.toBeActioned,d)}})},setHistory:function(e,t,i){c.log("NotificationCenterController setHistory"),this.endTime=(new Date).getTime(),this.loadTime=this.endTime-this.startTime,l.trackNotificationsLoadTime({eventAction:"notificationLoaded",eventLabel:"Loading time in Notification Center in milliseconds",eventValue:this.loadTime}),this.startTime=null,this.endTime=null,this.settingsView?this.setFilterWhoSettings(e.length):this.settingsViewExists=!1,this.centerView.displaySpinner(!1);for(var n=new Date(this.oldNotif.CREATION_DATE),o=0;o<e.length;o++){var s,a=e[o];a.COUNT>1&&(this.groupIDs.includes(a.GROUPID)||this.groupIDs.push(a.GROUPID)),s=new Date(e[o].CREATION_DATE),(!this.oldNotif.CREATION_DATE||n>s)&&(this.oldNotif.ID=e[o].ID,this.oldNotif.CREATION_DATE=e[o].CREATION_DATE,n=new Date(this.oldNotif.CREATION_DATE)),this.addNotification(a,void 0,t,i)}},setSettings:function(e,t){var i=this;if(this.settingsView||(this.settingsView=new o({left:t.clientWidth}),this.settingsView.addEvent("updateSettings",function(e){i.updateSettings(e)}),this.settingsView.getView().inject(t),this.settingsView.addEvent("showCenter",function(){i.centerView.globalView.style.display=""})),e)for(var n=0;n<e.length;n++)"X3DNTFC_AP"!==e[n].service&&(this.settingsView.addSetting(e[n]),this.centerView.notificationFilterView.settings.push(e[n]))},getIconUrl:function(e){switch(e.icon.type){case"url":if("object"!=typeof e.icon.data)return e.icon.data;if(e.platformId&&"null"!==e.platformId)i=this.getServiceUrl({name:e.icon.data.service,platformId:e.platformId});else{if(!e.icon.data.service)return this.checkIfIsUrl(e.icon.data)?e.icon.data:"./../../resources/en/1/webapps/NotifAlert/assets/icons/notificon.png";for(var t in this.listOfService[0])if(e.icon.data.service.toLowerCase()===t.toLowerCase())return this.listOfService[0][t]+e.icon.data.uri}return i?i+e.icon.data.uri:void 0;case"login":var i;return(i=this.getServiceUrl({name:"3dswym",platformId:e.platformId}))+("/"===i?"api/user/getpicture/login/":"/api/user/getpicture/login/")+e.icon.data+"/format";case"app":return void this.getAppInfos({id:e.icon.data})}},checkIfIsUrl:function(e){return/(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/.test(e)},getCsrfUrl:function(e){return this.listOfService[0]["3dswym"]+"/api/index/tk/"},deleteAllNotification:function(e){c.log("NotificationCenterController deleteAllNotification");i.publish("3dnotifinterne",{action:"deleteAllNotification"}),l.trackNotifSettingIconAction({eventAction:"deleteallNotifications",eventLabel:"Delete all notifications",eventValue:0})},deleteAllFilteredNotification:function(e){c.log("NotificationCenterController deleteAllFilteredNotification");var t={action:"deleteAllFilteredNotification",notificationID:this.filterNotifId};i.publish("3dnotifinterne",t),l.trackNotifSettingIconAction({eventAction:"deleteallFilteredNotifications",eventLabel:"Delete all filtered notifications",eventValue:this.filterNotifId.length})},readAllNotifications:function(e){var t;c.log("NotificationCenterController readAllNotifications");e&&void 0!==e.read&&(e.filter?(console.log("For filtered notifications....."),t={action:"notificationRead",read:e.read,scope:!0,filter:e.filter,notificationID:this.filterNotifId}):t={action:"notificationRead",read:e.read,scope:!0,filter:e.filter},i.publish("3dnotifinterne",t),!0===e.read&&t.scope?t.filter?l.trackNotifSettingIconAction({eventAction:"readallFilterNotifications",eventLabel:"Read all filter notifications",eventValue:this.centerView.numFound}):l.trackNotifSettingIconAction({eventAction:"readallNotifications",eventLabel:"Read all notifications",eventValue:this.centerView.numRead}):!1===e.read&&t.scope&&(t.filter?l.trackNotifSettingIconAction({eventAction:"unreadallFilterNotifications",eventLabel:"Unread all filter notifications",eventValue:this.centerView.numFound}):l.trackNotifSettingIconAction({eventAction:"unreadallNotifications",eventLabel:"Unread all notifications",eventValue:this.centerView.numRead})))},getTenantAgnosticMode:function(){i.publish("3dnotifinterne",{action:"getTenantAgnosticMode"})},getHistory:function(e){c.log("NotificationCenterController getHistory"),this.startTime=(new Date).getTime();var t,n,o,s,a,r=this,d="",f=!1,u=!1;if(this.getMoreHistoryFlag=!1,i.getUser()&&(s=i.getUser().login),(a=r.centerView.retrieveSettingsFromLocalstorage())&&a.login&&(s==a.login?u=!0:r.centerView.removeLStoredSettingsData()),(n=r.centerView.notificationFilterView.retrieveFilterDataFromLocalstorage())&&n.login&&s==n.login&&(f=!0),n&&0==f&&r.centerView.notificationFilterView.removeLStoredFilterData(),n&&!r.centerView.notificationFilterView.isFiltered&&f&&(o=n.what).length>0&&(o.forEach(e=>{d=d+e+";",t=r.centerView.notificationFilterView.tagger}),t.elements.input.setValue(d),t.paste(!0,!1)),this.oldNotif={CREATION_DATE:void 0,ID:void 0},this.groupIDs=[],n&&f)i.publish("3dnotifinterne",{action:"filter",values:n}),r.getFilterTotal(),r.centerView.notificationFilterView.isFiltered=!0,r.centerView.notificationFilterView.dispatchEvent("Filtering",!0);else if(a&&u){r.centerView.updateSelectedSetting(a.setting);var h={action:"getHistory",type:a.setting};i.publish("3dnotifinterne",h),r.getUnreadTotal()}else{h={action:"getHistory",type:e};i.publish("3dnotifinterne",h),r.getUnreadTotal()}"all"===e?l.trackNotifSettingIconAction({eventAction:"showAll",eventLabel:"Display all notifications",persDim:{pd1:"Showing_"+e}}):"unread"===e&&l.trackNotifSettingIconAction({eventAction:"showUnreadNotif",eventLabel:"Display unread notifications",persDim:{pd1:"Showing_"+e}})},getTenants:function(e){c.log("NotificationCenterController getTenants");i.publish("3dnotifinterne",{action:"getTenants"})},getDates:function(e){c.log("NotificationCenterController getDate");i.publish("3dnotifinterne",{action:"getDates"})},getUnreadTotal:function(){c.log("NotificationCenterController getUnreadTotal");if(!this.centerView.notificationFilterView.retrieveFilterDataFromLocalstorage()){i.publish("3dnotifinterne",{action:"getUnreadTotal"})}},getFilterTotal:function(){c.log("NotificationCenterController getFilterTotal");var e={action:"getFilterTotal",values:this.centerView.notificationFilterView.retrieveFilterDataFromLocalstorage()};i.publish("3dnotifinterne",e)},getStarredTotal:function(){c.log("NotificationCenterController getStarredTotal");i.publish("3dnotifinterne",{action:"getStarredTotal"})},getAppInfos:function(e){c.log("NotificationCenterController getAppInfos");var t={action:"getAppInfos",appID:e.appID,notifID:e.notifID};i.publish("3dnotifinterne",t)},getServices:function(){c.log("NotificationCenterController getServices");i.publish("3dnotifinterne",{action:"getServices"})},getSettings:function(){c.log("NotificationCenterController getHistory");i.publish("3dnotifinterne",{action:"getSettings"})},addNotification:function(e,t,i,n){c.log("NotificationCenterController addNotification");var o=decodeURIComponent(escape(window.atob(e.MESSAGE)));if((o=JSON.parse(o)).icon)switch(o.icon.type){case"appID":this.getAppInfos({appID:o.icon.data,notifID:e.ID});break;case"login":case"url":o.icon=this.getIconUrl({icon:o.icon,platformId:e.PLATFORMID});break;default:o.icon="./../../resources/en/1/webapps/NotifAlert/assets/icons/notificon.png"}if(o.actions)for(var s=0;s<o.actions.length;s++){var a=o.actions[s];if(a.options&&a.options.event&&("url"===a.options.event.type||"UI"===a.options.event.type)){var r=a.options.event;if(a.options&&a.options.event&&"UI"===a.options.event.type){var l=a.options.event.options;if(l.attachments&&l.attachments.length>0)for(var d=0;d<l.attachments.length;d++)"button"===l.attachments[d].type&&(r=l.attachments[d].options.event)}if(r.options&&r.options.service&&r.options.uri){var f=this.getServiceUrl({name:r.options.service,platformId:e.PLATFORMID});r.options.url=f+r.options.uri,"USASWYM_AP"===e.APPID&&(r.options.csrf=f+"/api/index/tk/")}else if("select"===a.type&&r.options&&r.options.length>0)for(var u=0;u<r.options.length;u++){f=this.getServiceUrl({name:r.options[u].service,platformId:e.PLATFORMID});r.options[u].url=f+r.options[u].uri,"USASWYM_AP"===e.APPID&&(r.options[u].csrf=f+"/api/index/tk/")}}}e.MESSAGE=o,this.centerView.addNotification(e,t,i,n)},addMergeNotifications:function(e,t,i,n){if(e){e=JSON.parse(e);for(var o=0;o<e.length;o++){var s=decodeURIComponent(escape(window.atob(e[o].MESSAGE)));if((s=JSON.parse(s)).icon)switch(s.icon.type){case"appID":this.getAppInfos({appID:s.icon.data,notifID:e[o].ID});break;case"login":case"url":s.icon=this.getIconUrl({icon:s.icon,platformId:e[o].PLATFORMID});break;default:s.icon="./../../resources/en/1/webapps/NotifAlert/assets/icons/notificon.png"}if(s.actions)for(var a=0;a<s.actions.length;a++){var r=s.actions[a];if(r.options&&r.options.event&&(r.options.event.type,1)){var l=r.options.event;if(r.options&&r.options.event&&"UI"===r.options.event.type){var c=r.options.event.options;if(c.attachments&&c.attachments.length>0)for(var d=0;d<c.attachments.length;d++)"button"===c.attachments[d].type&&(l=c.attachments[d].options.event)}if(l.options&&l.options.service&&l.options.uri){var f=this.getServiceUrl({name:l.options.service,platformId:e[o].PLATFORMID});l.options.url=f+l.options.uri,"USASWYM_AP"===e[o].APPID&&(l.options.csrf=f+"/api/index/tk/")}else if("select"===r.type&&l.options&&l.options.length>0)for(var u=0;u<l.options.length;u++){var h=this.getServiceUrl({name:l.options[u].service,platformId:e[o].PLATFORMID});l.options[u].url=h+l.options[u].uri,"USASWYM_AP"===e[o].APPID&&(l.options[u].csrf=h+"/api/index/tk/")}}}e[o].MESSAGE=s}this.centerView.addMergeNotifications(JSON.stringify(e),t,i,n)}},getServiceUrl:function(e){for(var t=0;t<this.listOfService.length;t++){if(!e.platformId)return this.listOfService[t][e.name.toLowerCase()]?this.listOfService[t][e.name.toLowerCase()]:this.listOfService[t+1]?this.listOfService[t+1][e.name.toLowerCase()]:void 0;if(this.listOfService[t].platformid.toLowerCase()===e.platformId.toLowerCase()){if(this.listOfService[t][e.name.toLowerCase()])return this.listOfService[t][e.name.toLowerCase()];if(!this.listOfService[t][e.name.toLowerCase()]&&"3ddashboard"===e.name.toLowerCase())for(var i=0;i<this.listOfService.length;i++)if(this.listOfService[i][e.platformId.toLowerCase()])return this.listOfService[i][e.name.toLowerCase()]}}if(this.listOfService.length>0)return this.listOfService[0][e.name.toLowerCase()]},getView:function(){return this.centerView.getView()},resetNotifications:function(){i.publish("3dnotifinterne",{action:"resetNotifications"})},updateSettings:function(e){c.log("NotificationCenterController updateSettings");var t=e;t.action="updateSettings",i.publish("3dnotifinterne",t),this.updateSettingOptionsTracker(e)},updateSettingsTracker:function(e){0===e.SUBSCRIBE?l.trackNotifSettingsViewAction({eventAction:"disableNotifServiceOrSettings",eventLabel:"Disable specific notification service or particular settings",eventValue:e.SUBSCRIBE,persDim:{pd1:e.NAME}}):1===e.SUBSCRIBE&&l.trackNotifSettingsViewAction({eventAction:"enableNotifServiceOrSettings",eventLabel:"Enable specific notification service or particular settings",eventValue:e.SUBSCRIBE,persDim:{pd1:e.NAME}})},updateSettingOptionsTracker:function(e){0===e.notif_by_ui&&this.defaultSettings.notif_by_ui!=e.notif_by_ui?(this.defaultSettings.notif_by_ui=0,l.trackNotifSettingsViewAction({eventAction:"disableNotifAlert",eventLabel:"Disable notification alert setting",eventValue:e.notif_by_ui})):1===e.notif_by_ui&&this.defaultSettings.notif_by_ui!=e.notif_by_ui&&(this.defaultSettings.notif_by_ui=1,l.trackNotifSettingsViewAction({eventAction:"enableNotifAlert",eventLabel:"Enable notification alert setting",eventValue:e.notif_by_ui})),0===e.notif_by_email&&this.defaultSettings.notif_by_email!=e.notif_by_email?(this.defaultSettings.notif_by_email=0,l.trackNotifSettingsViewAction({eventAction:"disableNotifMail",eventLabel:"Disable notification mail setting",eventValue:e.notif_by_email})):1===e.notif_by_email&&this.defaultSettings.notif_by_email!=e.notif_by_email&&(this.defaultSettings.notif_by_email=1,l.trackNotifSettingsViewAction({eventAction:"enableNotifMail",eventLabel:"Enable notification mail setting",eventValue:e.notif_by_email})),0===e.notif_by_browser&&this.defaultSettings.notif_by_browser!=e.notif_by_browser?(this.defaultSettings.notif_by_browser=0,l.trackNotifSettingsViewAction({eventAction:"disableNotifBrowser",eventLabel:"Disable notification browser setting",eventValue:e.notif_by_browser})):1===e.notif_by_browser&&this.defaultSettings.notif_by_browser!=e.notif_by_browser&&(this.defaultSettings.notif_by_browser=1,l.trackNotifSettingsViewAction({eventAction:"enableNotifBrowser",eventLabel:"Enable notification browser setting",eventValue:e.notif_by_browser}))},unsubscribe:function(e){c.log("NotificationCenterController unsubscribe");var t=e;t.action="unsubscribe",i.publish("3dnotifinterne",t)},getMoreHistory:function(e){c.log("NotificationCenterController getMoreHistory"),this.getMoreHistoryFlag=!0;var t={action:"getHistory",type:e,oldID:this.oldNotif.ID,groupIDs:this.groupIDs};i.publish("3dnotifinterne",t)},getMoreFilterHistory:function(e){c.log("NotificationCenterController getMoreFilterHistory");var t={action:"getFilterHistory",type:e,oldID:this.oldNotif.ID,groupIDs:this.groupIDs};i.publish("3dnotifinterne",t)},setFilterWhoSettings:function(e){var t,i=this;if((t=i.centerView.notificationFilterView.retrieveFilterDataFromLocalstorage())&&!i.centerView.notificationFilterView.filterWhoSettingFlag&&0!=e){var n=t.whoSettingsItems;n.length>0&&(i.centerView.notificationFilterView.autocompleteHierarchicalInput.elements.inputContainer.getElement("input").dispatchEvent(new Event("focus")),n.forEach(e=>{i.centerView.notificationFilterView.autocompleteHierarchicalInput.dispatchEvent("onSelect",[e,-1])}),i.centerView.notificationFilterView.autocompleteHierarchicalInput.dispatchEvent("onHideSuggests"))}i.settingsViewExists=!0}});return d.getInstance=function(e){return f||((f=new u).getView().inject(e.body),f)},d});