define("DS/SpecGridView/model/TreeDocument",["UWA/Core","UWA/Class","DS/Tree/TreeDocument","DS/TreeModel/DataModelSet","DS/SpecGridView/utils/GridUtil","DS/XSRCommonComponents/utils/Utils","DS/PlatformAPI/PlatformAPI","DS/XSRCommonComponents/utils/Constants"],function(e,t,r,i,o,n,s,a){"use strict";return r.extend({init:function(e){e.currentTabKey&&(this.currentTabKey=e.currentTabKey),this.xsrModelEvents=e.xsrModelEvents,this._parent(e);e.appCore,this.currentTabKey,e.container,this.specModel;this.onPreExpand(this._onPreExpand.bind(this))},getSelectedNodes:function(){for(var e=[],t=this._xso.get(),r=0;r<t.length;r++){var i=t[r];i._canBeGrouped()&&e.push(i)}return e},_onPreExpand:function(e){e.data.nodeModel._canBeGrouped()&&this.xsrModelEvents.publish({event:a.SPECS_EXPAND_NODES+"-"+this.currentTabKey,data:e})},getOriginalGridRoots:function(e,t){var r=t||[],i=e?e.getChildren():this.getChildren();if(i)for(var o=0;o<i.length;o++){var n=i[o];n._canBeGrouped()?r.push(n):r.concat(this.getOriginalGridRoots(n,r))}return r},setLayoutInstance:function(e){this.gridLayout=e},removeRoot:function(e){var t;e&&e.getParent()&&(t=e.getParent()),this._parent(e),this.acceptChanges(),t._canBeGrouped()||(this._recursiveRemoveEmptyParent(t),this.acceptChanges())},removeFakeGridTable:function(){if(this._getTrueRoot()){let e=this._getTrueRoot();e&&e._fakeNodesTable&&delete e._fakeNodesTable}},isViewGrouped:function(){var e=this.getGroupByColumns();return!(!e||0==e.length)},getGroupByColumns:function(){let e=this.currentTabKey?"xsr-grid-propertiesToGroup-"+this.currentTabKey:"xsr-grid-propertiesToGroup";return widget.getValue(e)},_recursiveRemoveEmptyParent:function(e){if(e&&e.getParent()&&!e.getChildren())this.removeRoot(e);else if(e&&e.getProperty){var t=this._updateGroupNodeLabel(e.getProperty(),e);e.updateOptions(t)}},groupRoots:function(e){var t=this;e.updateGroupingNodeOptions=function(e){var r=this.getProperty(),i=t._updateGroupNodeLabel(r,this);this.updateOptions(i)};var r=e.propertiesToGroup;this._parent(e);let i=!1;"docs"==this.currentTabKey&&r&&r.length>0&&(Array.isArray(r)?1==r.length&&-1===r.indexOf("relType")?i=!0:r.length>1&&(i=!0):"relType"!==r&&(i=!0)),i&&this.currentTabKey?widget.setValue("xsr-noDefault-RelType",!0):i||"docs"!=this.currentTabKey||widget.setValue("xsr-noDefault-RelType",void 0);var o=this.currentTabKey?"xsr-grid-propertiesToGroup-"+this.currentTabKey:"xsr-grid-propertiesToGroup";r&&widget.setValue(o,r)},_updateGroupNodeLabel:function(e,t){var r=t,i=this.gridLayout.getColumnOptionValue(e,"hideColNameOnGroup")?"":this.gridLayout.getColumnOptionValue(e,"text"),o=(i?i+": ":"")+(r.getIdentifier().label?r.getIdentifier().label:r.getIdentifier())+" ("+r.getNumberOfVisibleChildren()+")";return{label:o,grid:{tree:o}}},_getNodesByCriteria:function(e){var t=[];return this.getOriginalGridRoots().filter(e).forEach(function(e){t.push(e)}),t}})});