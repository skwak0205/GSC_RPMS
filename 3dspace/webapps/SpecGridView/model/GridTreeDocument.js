define("DS/SpecGridView/model/GridTreeDocument",["UWA/Core","UWA/Class","DS/SpecGridView/model/TreeDocument","DS/TreeModel/DataModelSet","DS/SpecGridView/utils/GridUtil","DS/XSRCommonComponents/utils/Utils","DS/PlatformAPI/PlatformAPI","DS/XSRCommonComponents/utils/Constants"],function(e,t,o,n,i,r,a,l){"use strict";return t.extend({init:function(e){e&&(this.modelEvents=e.modelEvents?e.modelEvents:null,this.enableCrossWidgetFeature=!!e.enableCrossWidgetFeature&&e.enableCrossWidgetFeature,this.currentTabKey=e.currentTabKey?e.currentTabKey:void 0,this.isColorized=!!e.isColorized,this.appCore=e.appCore,this.parentModel=e.parentModel,this.enableRightInteractivity=e.enableRightInteractivity,this.specTagsFilter=e.specTagsFilter?e.specTagsFilter:null,this.itemModelMapping=[])},getNodeFromModelMapping:function(e){if(e){var t=this.itemModelMapping.filter(function(t){return Object.keys(t)[0]===e});return t&&t.length>0?Object.values(t[0])[0]:null}},getTreeDocuments:function(e){var t=this,i=new n;return this.model=new o({dataModelSet:i,currentTabKey:t.currentTabKey,xsrModelEvents:t.modelEvents}),this.model.setUseChangeTransactionMode(!0),this.model.prepareUpdate(),e&&e.forEach(function(e){t.model.addRoot(e.getTreeModel())}),this.model.pushUpdate(),this.model.expandAll(),this.addEventsOnModel(),this.model.isColorized=this.isColorized,this.model.bomItemModelMapping=this.itemModelMapping,this.model},unGroupRoots:function(){this.model.ungroupRoots()},groupRoots:function(e){var t=Array.isArray(e)?{propertiesToGroup:e}:{propertiesToGroup:[e]};this.model.groupRoots(t),this.model.expandAll()},publishSelectedNodesInGrid:function(){let e=this.model.getSelectedNodes(),t=e.length;if(1==t){!e[0]._canBeGrouped()||this.modelEvents.publish({event:l.EVENT_GRID_TOTAL_SELECTED_NODES,data:{count:t,currentModel:e,gridModel:this.model}})}else this.modelEvents.publish({event:l.EVENT_GRID_TOTAL_SELECTED_NODES,data:{count:t,currentModel:e,gridModel:this.model}})},manageTriptychRightPanel:function(){var e=this,t=e.model.getSelectedNodes(),o=e.appCore.triptychManager;if(o.setLaunchFromIcon(!1),t&&o.isRightPanelVisible){var n=t.length;if(n>1)e.appCore.basicModelEvents.publish({event:l.EVENT_SPEC_GRID_NODES_SELECTION_ACTION,data:{currentTab:e.currentTabKey,count:n,commandId:o.commandId,currentModel:e.model}});else if(1==n){!t[0]._canBeGrouped()||setTimeout(function(){e.appCore.basicModelEvents.publish({event:l.EVENT_SPEC_GRID_NODES_SELECTION_ACTION,data:{currentTab:e.currentTabKey,count:n,commandId:o.commandId,currentModel:t[0]}})},50)}else setTimeout(function(){e.appCore.basicModelEvents.publish({event:l.EVENT_SPEC_GRID_NODES_SELECTION_ACTION,data:{currentTab:e.currentTabKey,count:n,commandId:o.commandId,currentModel:t[0],parentModel:void 0}})},50)}},addEventsOnModel:function(){var e=this,t=function(){var t=e.model.getSelectedNodes(),o=t.length;if(e.modelEvents.publish({event:l.UPDATE_ITEMVIEW_TOOLBOOR_COUNT,data:o}),e.enableCrossWidgetFeature&&o>0){var n=(new i).getCrossHLData(t);r.publishCrossWidgetHighlightEvent(r.uid(),n[0])}};this.model.getXSO().onPostAdd(function(o){for(var n=0;n<o.length;n++){var i=o[n];!i._canBeGrouped()?i.selectAll():t()}e.enableRightInteractivity&&(e.manageTriptychRightPanel(),e.publishSelectedNodesInGrid())}),this.model.getXSO().onPostRemove(function(o){for(var n=0;n<o.length;n++){var i=o[n];!i._canBeGrouped()?i.unselectAll():t()}e.enableRightInteractivity&&(e.manageTriptychRightPanel(),e.publishSelectedNodesInGrid())}),e.enableCrossWidgetFeature&&(this.platFormSusbcribtion=a.subscribe(l.CROSS_APP_SELECTION_EVENT,function(t){if(t.metadata&&t.metadata.appid==="ENOSPEC_AP_"+widget.id)return;var o=[];t.data.attributes;t.data.paths.forEach(function(e){let t={};t.parentId=e[0],t.connectionId=e[1],t.childId=e[2],o.push(t)});for(var n=!1,i=e.model.getOriginalGridRoots(),r=0;r<i.length;r++){var a=i[r];if(0===o.length)break;for(let t=0;t<o.length;t++)o[t].childId===a.getID()&&o[t].connectionId===a.getInstanceId()&&(n||(e.model.unselectAll(),n=!0),o.splice(t,1),a.select())}}))},addRoot:function(e,t){var o=function(e){var t=e.getTreeModel();if(n.model.addRoot(t),n.currentTabKey===l.BOM_TAB){var o={};o[t.getID()]=t;var r=n.itemModelMapping.filter(function(e){return Object.keys(e)[0]===t.getID()});if(r&&r.length>0){let e=(new i).updateItemModelMapping(n.itemModelMapping,t);n.itemModelMapping=e}else n.itemModelMapping.push(o)}};if(e){var n=this,r=!1!==t;Array.isArray(e)?e.forEach(function(e){o(e),r&&e.select()}):e&&(o(e),r&&e.select())}this.model.acceptChanges()},removeRoot:function(e){if(e){var t=this,o=function(e){t.model.removeRoot(e);e.getParent();if(t.currentTabKey===l.BOM_TAB&&t.itemModelMapping){var o=t.itemModelMapping.filter(function(t){return Object.keys(t)[0]===e.getID()});if(o&&o.length>0){let o=(new i).removeItemModelMapping(t.itemModelMapping,e);t.itemModelMapping=o}}t.model.acceptChanges()};Array.isArray(e)?e.forEach(function(e){o(e)}):o(e)}},destroy:function(){this.platFormSusbcribtion&&a.unsubscribe(this.platFormSusbcribtion),this.itemModelMapping=[]}})});