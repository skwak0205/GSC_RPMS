define("DS/SpecGridView/controller/GridColumn",["DS/XSRCommonComponents/utils/Constants","DS/XSRCommonComponents/utils/Utils","DS/Controls/LineEditor","DS/Controls/ComboBox","DS/Controls/Toggle","DS/XSRCommonComponents/utils/TypeUtils","i18n!DS/SpecGridView/assets/nls/SpecGridView"],function(e,t,n,o,a,i,r){"use strict";function l(e){return this}return l.prototype.process=function(l){var d=this;return l&&l.forEach(function(l){l.text=l.text,l.editableFlag&&l.forbiddenCheck&&(d.columnCharValidationList[l.dataIndex]=!0),!1!==l.exportFlag&&d.exportableColums.push(l.dataIndex),l.editableFlag&&(l.getCellEditableState=function(e){var n=e.nodeModel;return!(!n||!n.getID||t.isOriginatedInGLS(n))&&n.hasAccess("modify")}),"uomupdated"===l.dataIndex&&(l.getCellValue=function(t){var l=UWA.createElement("div",{class:"uom-container"}),s=widget.getValue(e.PERSISTENCY_BOM_VIEW);if((c=t.nodeModel)&&c._canBeGrouped()){var u=!0,g=!0;"Released"===c.options.grid["ds6w:status"]&&(g=!1,u=!1),"function"==typeof c.getCQInstance&&c.getCQInstance()?u=!0:"boolean"!=typeof s||s?"function"==typeof c.IsComputed&&c.IsComputed()&&(u=!1):u=!1,u&&"EA (each)"==c.options.grid.uom&&(g=!1),!d.parentModel||"Released"!==d.parentModel.options.maturity&&"Released"!==d.parentModel.options.grid["ds6w:status"]||(u=!1);var c=t.nodeModel,p=Object.entries(i.getUOMUnits(c.options.grid.quantityType,c.options.grid.quantityTypeDBName)),m=[],C=new Map;p.forEach(function(e){m.push(e[1]),C.set(e[1],e[0])}),m.sort(function(e,t){return(e=e.toLowerCase())==(t=t.toLowerCase())?0:e>t?1:-1});var f=t.nodeModel.getUnitOfMeasure(),I="function"==t.nodeModel.getQuantity?t.nodeModel.getQuantity():t.nodeModel.options.grid.quantity,M=null==I||null==I?"":I,v=-1;null!=f&&(v=m.indexOf(f));var y=c.getasNeeded(),b=M+(null==f||null==f?"":f)+(y?" "+r.label_As_Required:""),h=UWA.createElement("div",{class:"readonly-container",html:b}).inject(l),x=UWA.createElement("div",{class:"xsr-grid-wux-hide"}).inject(l);u&&h.addEventListener("click",function(){h.addClassName("xsr-grid-wux-hide"),x.toggleClassName("xsr-grid-wux-hide")});var w=new a({label:r.label_As_Required,type:"switch",checkFlag:y});w.getContent().addClassName("xsr-grid-wux-inline"),w.addEventListener("buttonclick",function(e){var t=e.dsModel.checkFlag;c.updateOptions({grid:{asNeeded:t}})});var R=g?"([0-9]*[.])?[0-9]+":"[0-9]+",D=new n({placeholder:r.placeholder_Quantity,value:M,pattern:R}).inject(x),S=new o({elementsList:m,selectedIndex:v,placeholder:r.placeholder_UOM}).inject(x);w.inject(x),S.getContent().addClassName("xsr-grid-combobox"),D.getContent().addClassName("xsr-grid-lineeditor"),D.addEventListener("change",function(e){let t=e.dsModel.value;""!=t&&c.updateOptions({grid:{quantity:parseFloat(t)}})}),S.addEventListener("change",function(e){let t=e.dsModel.value;null!=t&&c.updateOptions({grid:{quantityUOMNLS:t,quantityUOM:C.get(t),uom:t}})}),g||(S.disabled=!0,w.disabled=!0)}return l},l.getCellValueForExport=function(e){var t=e.nodeModel;if(t&&t.getID){if(null==t)return r.label_UOM;var n=t.getQuantity()+t.getUnitOfMeasure();return t.getasNeeded()&&(n+=r.label_As_Required),n}}),"quantity"!==l.dataIndex&&"asNeeded"!==l.dataIndex||(l.getCellEditableState=function(t){var n=widget.getValue(e.PERSISTENCY_BOM_VIEW),o=t.nodeModel;return!!o&&(!("function"!=typeof o.getCQInstance||!o.getCQInstance())||("boolean"!=typeof n||n?"function"!=typeof o.IsComputed||!o.IsComputed():null))},"quantity"===l.dataIndex&&(l.getCellSemantics=function(e){var t=e.nodeModel;if(t&&t.getID)return"EA (each)"==t.options.grid.uom?{stepValue:1}:{}}),"asNeeded"===l.dataIndex&&(l.getCellTooltip=function(e){var t=e.nodeModel;if(t&&t.getID&&("function"==typeof t.getCQInstance&&t.getCQInstance()||"function"==typeof t.getMadeFrom&&t.getMadeFrom()))return{shortHelp:t.options.grid.asNeeded?r.label_True:r.label_False}})),"madeFrom"===l.dataIndex&&(l.getCellValueForExport=function(e){var t=e.nodeModel;if(t&&t.getID)switch(d.grid.layout.getDataIndexFromColumnIndex(e.columnID)){case"madeFrom":return void 0===t.getMadeFrom()||null===t.getMadeFrom()?"":r.label_MakeFrom}},l.getCellTooltip=function(e){var t=e.nodeModel;if(t&&t.getID&&!!t.getMadeFrom())return{shortHelp:r.label_MakeFrom}}),"uom"===l.dataIndex&&(l.getCellSemantics=function(e){var t=e.nodeModel;if(t&&t._canBeGrouped()&&(t.options.grid.quantityType||"function"==typeof t.getCQInstance&&t.getCQInstance())){var n=Object.entries(i.getUOMUnits(t.options.grid.quantityType,t.options.grid.quantityTypeDBName));i.getUOMUnits(t.options.grid.quantityType);if(n){var o=[];return t.options.grid.CQInstance&&o.push(""),n.forEach(function(e){o.push(e[1])}),o.sort((e,t)=>(e=e.toLowerCase())==(t=t.toLowerCase())?0:e>t?1:-1),{possibleValues:()=>o,placeholder:r.placeholder_UOM}}return null}},l.getCellEditableState=function(e){var t=e.nodeModel;if(t&&t._canBeGrouped())return"function"==typeof t.IsComputed&&t.IsComputed()?null:t.options.grid.quantityType||"function"==typeof t.getCQInstance&&t.getCQInstance()?{editableFlag:!0,typeRepresentation:"enumValueToProperty"}:null}),"url"===l.typeRepresentation?(l.getCellValue=function(n){var o,a,i=function(e,n,o,a,i){return t.isXSRAuthoredType(o.getTypeActualName())?{label:e,icon:a,url:"#UNEXISTANT_ID",module:"DS/XSRCommonComponents/utils/GridCommonActionsManager",func:"launch",argument:{commandId:n,selectedNode:o,appCore:d.appCore,currentTabKey:d.currentTabKey,selectFacet:i}}:{label:e}},r=n.nodeModel,l=d.grid.layout.getDataIndexFromColumnIndex(n.columnID);if(r.getID){switch(l){case"partNumber":(a=void 0===r.getPartNumber()||null===r.getPartNumber()?"":r.getPartNumber())&&(o=i(a,e.SET_PART_NUMB,r));break;case"ds6wg:revision":(a=void 0===r.getRevision()||null===r.getRevision()?"":r.getRevision())&&(o=i(a,e.VERSION_GRAPH_CMD,r),r.isLastVersion&&void 0!==r.isLastVersion()&&!r.isLastVersion()&&(o.icon="flow-line")),a&&t.isOriginatedInGLS(r)&&(o=a);break;case"ds6w:status":(a=void 0===r.getMaturity()||null===r.getMaturity()?"":r.getMaturity())&&(o=i(a,e.MATURITY_GRAPH_CMD,r)),a&&t.isOriginatedInGLS(r)&&(o=a);break;case"ds6w:responsible":(a=void 0===r.getOwner()||null===r.getOwner()?"":r.getOwner())&&(o=i(a,e.CHANGE_OWNER_CMD,r)),a&&t.isOriginatedInGLS(r)&&(o=a);break;case"Alternate":var s="",u=r._options.grid.Alternate;"Yes"==(u=u?u.replace("\n",""):u)&&(s="fonticon fonticon-exchange alternateColumn"),o=i("",e.INFORMATION_CMD,r,s,e.FACET_ALTERNATE);break;case"revisionForTMS":let n=null,d=null;r&&r.getRevision&&(n=r.getRevision()),r&&r.isLastVersion&&!r.isLastVersion()&&(d="flow-line"),o={icon:d,label:n}}return o}},l.getCellGroupingKey=function(e){var t=e.nodeModel;if(t&&t.getID){var n=d.grid.layout.getDataIndexFromColumnIndex(e.columnID);return e.nodeModel.options.grid[n]}},l.getCellValueForExport=function(e){var t=e.nodeModel;if(t&&t.getID)switch(d.grid.layout.getDataIndexFromColumnIndex(e.columnID)){case"partNumber":return void 0===t.getPartNumber()||null===t.getPartNumber()?"":t.getPartNumber();case"ds6wg:revision":var n=void 0===t.getRevision()||null===t.getRevision()?"":t.getRevision();return n=n&&t.isLastVersion&&t.isLastVersion()?n:n+"("+r.HigherRevExist+")";case"ds6w:status":return void 0===t.getMaturity()||null===t.getMaturity()?"":t.getMaturity();case"ds6w:responsible":return void 0===t.getOwner()||null===t.getOwner()?"":t.getOwner()}},"ds6wg:revision"===l.dataIndex&&(l.getCellTooltip=function(e){var t=e.nodeModel;if(t&&t.getID)return{shortHelp:t.isLastVersion()?t.getRevision():t.getRevision()+"  "+r.HigherRevExist}}),"Alternate"===l.dataIndex&&(l.getCellTooltip=function(e){var t=e.nodeModel;if(t&&t.getID){return{shortHelp:"Yes"==t._options.grid.Alternate?r.label_Alternate:""}}}),"ds6wg:revision"!==l.dataIndex&&"ds6w:status"!==l.dataIndex&&"ds6w:responsible"!==l.dataIndex||(l.getCellTypeRepresentation=function(e){return e.nodeModel&&t.isOriginatedInGLS(e.nodeModel)?"string":l.typeRepresentation})):"menu"===l.dataIndex&&(l.getCellValue=function(t){var n=t.nodeModel;if(n.getID&&n.getID()){var o=[];return n.currentTabKey===e.FACET_MBMF&&n.appCore.contextAppId===e.XSR_APP_ID?(o.push("Information"),o.push("OpenSpecificationView"),o.push("DeleteItem")):n.currentTabKey===e.FACET_MBMF&&n.appCore.contextAppId!==e.XSR_APP_ID?o=["Information","OpenSpecificationView","OpenWith","ManageFiles","SetPartNumber","UPSAuthUnparent","RemoveChild","VersionExplorer","DuplicateItem","CompareWith","RelatedObjects","MaturityGraph","ActionBar_ChangeOwner","MultiOwnership","DownloadReport","DownloadDocument","Subscriptions","DeleteItem","addExisting","RegenerateReport","Close"]:n.currentTabKey===e.BOM_TAB?o=["Information_Widget","Alternates"]:"test-method-facet"===n.currentTabKey&&(o=["Information","OpenWith","ManageFiles","SetPartNumber","UPSAuthUnparent","RemoveChild","VersionExplorer","DuplicateItem","CompareWith","RelatedObjects","MaturityGraph","ActionBar_ChangeOwner","MultiOwnership","DownloadReport","Subscriptions","DeleteItem","addExisting","RegenerateReport","Close","Information_Widget","Alternates"]),{label:"",module:"DS/XSRCommonComponents/utils/GridCommonActionsManager",func:"getActionMenu",argument:{execludeCmds:o}}}n.options.grid.menu=""},l.hasCellValue=function(e){var t=e.nodeModel;return!(!t||!t._canBeGrouped())})}),l},l});