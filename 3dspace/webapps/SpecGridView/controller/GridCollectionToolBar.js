define("DS/SpecGridView/controller/GridCollectionToolBar",["UWA/Core","UWA/Class","DS/Menu/Menu","DS/XSRCommonComponents/utils/XSRMask","DS/XSRCommonComponents/utils/XspecEvents","DS/XSRCommonComponents/utils/Utils","DS/XSRCommonComponents/utils/Constants","DS/ENOXCollectionToolBar/js/ENOXCollectionToolBar","i18n!DS/SpecGridView/assets/nls/SpecGridView"],function(e,t,n,i,o,s,a,r,l){"use strict";return t.extend({init:function(e){this.appCore=e.appCore,this.modelEvents=e.appCore.specViewerModelEvents,this.currentTabKey=e.currentTabKey,this.target=e.target,this.preferredView=e.preferredView,this.container=e.container,this.toolBarEvents=new o,this.hiddenCmds=[],this.currentViewType,this._subscribeEvents()},draw:function(e){e&&(this.target=e);var t={modelEvents:this.toolBarEvents,withmultisel:!0,showItemCount:!0,actions:this.actionCommands,multiselActions:null,multiselActionCallback:this.getMultipleActions.bind(this),filter:{multiselect:!1,enableCache:!1},sort:[],currentView:this.preferredView?this.preferredView:a.GRID_VIEW,views:this.currentTabKey===a.FACET_MBMF?[]:[{id:a.BIG_TILE,text:l.bigTile,fonticon:"view-big-tile"},{id:a.GRID_VIEW,text:l.DataGridView,fonticon:"tree-table"}],currentNbitems:0,currentNbSelections:0};this.collectionToolbar=new r(t),this.collectionToolbar.inject(e),this.hideCommand("ResetChanges"),this.hideCommand("Unwraptext")},_subscribeEvents:function(e){var t=this;this.subscriptionList=[],this.modelEvents&&(this.subscriptionList.push(this.modelEvents.subscribe({event:a.UPDATE_ITEMVIEW_TOOLBOOR_COUNT},function(e){var n=t.currentModel?t.currentModel.getSelectedNodes().length:0;n>0?t.toolBarEvents.publish({event:a.COLLECTION_TOOLBAR_CHECKBOX_CHECK_FLAG,data:{}}):t.toolBarEvents.publish({event:a.COLLECTION_TOOLBAR_CHECKBOX_UNCHECK_FLAG,data:{}}),t.toolBarEvents.publish({event:a.COLLECTION_TOOLBAR_SELECTIONS_COUNT_UPDATE,data:n}),t.toolBarEvents.publish({event:a.COLLECTION_TOOLBAR_EVENT_UPDATE_COUNT,data:n})})),this.subscriptionList.push(t.modelEvents.subscribe({event:t.currentTabKey?"xsr-show-toolbar-reset-command-"+t.currentTabKey:"xsr-show-toolbar-reset-command"},function(){t.showCommand("ResetChanges")})),this.subscriptionList.push(t.modelEvents.subscribe({event:t.currentTabKey?"xsr-hide-toolbar-reset-command-"+t.currentTabKey:"xsr-show-toolbar-reset-command"},function(){t.hideCommand("ResetChanges")})),this.subscriptionList.push(t.modelEvents.subscribe({event:t.currentTabKey?"xsr-hide-toolbar-makeFrom-command-"+t.currentTabKey:null},function(e){e&&(t.hideMBMFCommand=e.disableMBMFCmd)}))),t.toolBarEvents.subscribe({event:a.COLLECTION_TOOLBAR_EVENT_ALL_SELECTED},function(e){t.currentModel.gridLayout.collectionView.selectAllVisibleNodes()}),t.toolBarEvents.subscribe({event:a.COLLECTION_TOOLBAR_EVENT_ALL_UNSELECTED},function(e){t.currentModel.unselectAll()}),t.toolBarEvents.subscribe({event:a.COLLECTION_TOOLBAR_EVENT_VIEW_ACTIVATED},function(e){e!==t.currentViewType&&(t.currentViewType=e,t.launchResetModelChanges(),t.switchView(e))}),t.toolBarEvents.subscribe({event:a.COLLECTION_TOOLBAR_SEARCH},function(e){var n=t.currentModel;n.prepareUpdate();var i=n.getChildren();(t.showAllNodes(i),e.searchValue[0]&&0!==e.searchValue.length)?(n.search({match:function(t){var n,i=t.nodeModel;if(!i._canBeGrouped())return!1;if(i.currentTabKey===a.MEI_TAB||void 0!==i.getMEIInterface&&i.getMEIInterface()===a.MEI_INTERFACE)n=i.getTitle()+" "+i.getMaturity()+" "+i.getType()+" "+i.getName()+" "+i.getRevision()+" "+i.getOriginatedDate()+" "+i.getModifedDate()+" "+i.getDescription()+" "+i.getMftPartNo()+" "+i.getManufacturer()+" "+i.getPartSource()+" "+i.getPartSourceURL()+" "+i.getOwner()+" "+i.getEqQualIsPreferred();else{let e=widget.getValue(a.PERSISTENCY_BOM_VIEW);var o=i.getPartNumber?i.getPartNumber():"",s=i.getasNeeded?i.getasNeeded():"",r=i.getInstanceCount?i.getInstanceCount():"",l=i.getUnitOfMeasure?i.getUnitOfMeasure():"",c=i.getMBMFReferenceName?i.getMBMFReferenceName():"",u=i.getCoreMat?i.getCoreMat():"",d=i.getAllAttributeValue?i.getAllAttributeValue():"";n=o+" "+s+" "+r+" "+l+" "+i.getTitle()+" "+i.getMaturity()+" "+i.getType()+" "+i.getName()+" "+i.getRevision()+" "+i.getModifedDate()+" "+i.getOriginatedDate()+" "+i.getDescription()+" "+i.getOwner()+" "+c+" "+u+" "+d,!e&&i.getInstanceTitle&&(n+=i.getInstanceTitle())}return e.searchValue[0]&&-1!==n.toUpperCase().indexOf(e.searchValue[0].toUpperCase())?(i.setSearchFilterState(!0),!1):(i.setSearchFilterState(!1),!0)}}).forEach(function(e,t){e._canBeGrouped()&&(e.unmatchSearch(),e.setSearchFilterState(!1),e.applyFilters())}),n.pushUpdate()):n.pushUpdate()})},showAllNodes:function(e){var t=this;e&&Array.isArray(e)&&e.forEach(function(e,n){e._canBeGrouped()?(e.setSearchFilterState(!0),e.applyFilters()):t.showAllNodes(e.getChildren())})},switchView:function(e){var t=this.currentTabKey?"grid-toolbar-switch-view-"+this.currentTabKey:"grid-toolbar-switch-view";this.modelEvents&&this.modelEvents.publish({event:t,data:e})},getMultipleActions:function(e){var t=this.currentTabKey?a.UPDATE_MULTI_TOOLBAR_MENU+"-"+this.currentTabKey:a.UPDATE_MULTI_TOOLBAR_MENU;this.modelEvents&&this.modelEvents.publish({event:t,data:{target:e}})},setActions:function(e){this.actionCommands=this.drawMenus(e)},setCurrentModel:function(e){this.currentModel=e},setTooltip:function(e,t,n,i){if("bomViews"===e.id&&n&&e.tooltip){let n=widget.getValue(t);var o;o=void 0!==n?n?l.label_QuantityMode:l.label_InstanceMode:i?l.label_QuantityMode:l.label_InstanceMode,e.tooltip.getBody().setText(o)}},setDefaultTooltip:function(e,t,n,i){if("bomViews"===e&&i){let e=widget.getValue(n);return void 0!==e?e?l.label_QuantityMode:l.label_InstanceMode:t}},setCommandFontIcon:function(e,t,n,i){if("bomViews"===e.id&&n&&e.fonticon){let n,o,s=widget.getValue(t),a="fonticon fonticon-";void 0!==s?(n=s?"object-reference":"object-instance",o=s?a+"object-reference":a+"object-instance"):(n=i?"object-reference":"object-instance",o=i?a+"object-reference":a+"object-instance"),e.fonticon=n,e.elements.icon.className=o}},getCommandIcon:function(e,t,n){if("bomViews"===e){let e=widget.getValue(t);return void 0!==e?e?"object-reference":"object-instance":n}},drawMenus:function(e){var t=[],n=this;if(e.forEach(function(e){var i={};i.id=e.key;var o=e.persistencyKey,s=e.isSelectable;if(i.text=e.text,i.title=e.text,i.fonticon=e.fonticon,i.disabled=e.disabled,o&&s){let t=n.setDefaultTooltip(e.key,e.text,o,s);i.title=i.text=t;let a=n.getCommandIcon(e.key,o,i.fonticon);i.fonticon=a}var a=e.subMenu;i.handler=a?function(e){var t=e.target.getBoundingClientRect();n.drawSubMenu(t,a,this,o,s)}:n.launchCommand.bind(n,e.key),t.push(i)}),this.currentTabKey!==a.FACET_MBMF&&"test-method-facet"!==this.currentTabKey){var i={id:"Export"};i.text=l.ExportCSV,i.title=l.ExportCSV,i.fonticon="export",i.handler=n.launchCommand.bind(n,"Export"),t.push(i)}if("test-method-facet"!==this.currentTabKey){var o={id:"personalize"};o.text=l.PersonalizeView,o.title=l.PersonalizeView,o.fonticon="cog",o.handler=n.launchCommand.bind(n,"personalize"),t.push(o)}var s={id:"Wraptext"};s.text=l.Wrap,s.title=l.Wrap,s.fonticon="text-wrapping-ok",s.handler=n.launchWrapText.bind(n),t.push(s);var r={id:"Unwraptext"};r.text=l.Unwrap,r.title=l.Unwrap,r.fonticon="text-wrapping-off",r.handler=n.launchUnWrapText.bind(n),t.push(r);var c={id:"ResetChanges"};return c.text=l.ResetChanges,c.title=l.ResetChanges,c.fonticon="reset",c.handler=n.launchResetModelChanges.bind(n),t.push(c),t},launchResetModelChanges:function(){this.currentModel&&(this.currentModel.cancelChanges(),this.hideCommand("ResetChanges"))},launchWrapText:function(){i.maskLoader(this.container,l.WrapLoader);try{this.currentModel.gridLayout.collectionView.prepareUpdateView();for(var e=this.currentModel.gridLayout.columns,t=0;t<e.length;t++){var n=e[t],o=n.dataIndex;"tree"!==n.typeRepresentation&&"string"!==n.typeRepresentation||(n._defaulttypeRepresentation=n.typeRepresentation,this.currentModel.gridLayout.setColumnTypeRepresentation(o,"textBlock")),this.currentModel.gridLayout.setColumnAutoRowHeightFlag(o,!0)}this.currentModel.gridLayout.collectionView.pushUpdateView({updateCellContent:!0,updateCellLayout:!0,updateCellAttributes:!0},!0),this.hideCommand("Wraptext"),this.showCommand("Unwraptext"),i.unmaskLoader(this.container)}catch(e){console.error("Wraping failed!! "+e),i.unmaskLoader(this.container)}},launchUnWrapText:function(){i.maskLoader(this.container,l.UnwrapLoader);try{this.currentModel.gridLayout.collectionView.prepareUpdateView();for(var e=this.currentModel.gridLayout.columns,t=0;t<e.length;t++){var n=e[t],o=n.dataIndex;"textBlock"===n.typeRepresentation&&(n.typeRepresentation=n._defaulttypeRepresentation),this.currentModel.gridLayout.setColumnAutoRowHeightFlag(o,!1)}this.currentModel.gridLayout.collectionView.pushUpdateView({updateCellContent:!0,updateCellLayout:!0,updateCellAttributes:!0},!0),this.hideCommand("Unwraptext"),this.showCommand("Wraptext"),i.unmaskLoader(this.container)}catch(e){console.error("Unwraping failed!! "+e),i.unmaskLoader(this.container)}},hideCommand:function(e){var t=this.target?this.target.getElementsByTagName("li")[e]:void 0;t&&(t.setStyle("display","none"),-1===this.hiddenCmds.indexOf(e)&&this.hiddenCmds.push(e))},showCommand:function(e){var t=this.target?this.target.getElementsByTagName("li")[e]:void 0;t&&(t.setStyle("display","inline-block"),this.hiddenCmds.splice(this.hiddenCmds.indexOf(e),1))},drawSubMenu:function(e,t,i,o,s){var a=this;if(t){var r=function(e){var t=[];return e.forEach(function(e){var n={};if(n.title=e.text,"CheckItem"==e.type?n.type=e.type:n.type=e.type&&"separator"===e.type?"TitleItem":"PushItem",!a.hideMBMFCommand||"addMBMFItem"!==e.key&&"addMBMFRawMat"!==e.key||(n.state="disabled"),o){let t=widget.getValue(o);null!=t?e.isDefault?n.state=t?"selected":"unselected":n.state=t?"unselected":"selected":(e.isDefault,n.state=e.isDefault?"selected":"unselected")}if(e.subMenu){e.fonticon&&(n.fonticon={family:"DSFontIcon",content:"wux-ui-3ds wux-ui-3ds-2x wux-ui-3ds-"+e.fonticon}),n.action={this:this,callback:function(t){a.launchCommand(e.key)}};var l=r(e.subMenu);n.submenu=l}else"PushItem"!==n.type&&"CheckItem"!==n.type||(e.fonticon&&(n.fonticon={family:"DSFontIcon",content:"wux-ui-3ds wux-ui-3ds-2x wux-ui-3ds-"+e.fonticon}),n.action={this:this,callback:function(t){!e.isDefault&&s?widget.setValue(o,!1):e.isDefault&&s&&widget.setValue(o,!0),a.setTooltip(i,o,s,e.isDefault),a.setCommandFontIcon(i,o,s,e.isDefault),a.launchCommand(e.key),["expandall","expandNLevel","collapseall"].includes(e.key)&&a.changeTooltipFontIcon(i,e)}});t.push(n)}),t};a.subMenus=r(t),n.show(a.subMenus,{position:{x:e.left,y:e.bottom}})}},disableCommands:function(e){for(var t=0;t<e.length;t++){var n=e[t];this.toolBarEvents.publish({event:a.COLLECTION_TOOLBAR_COMMAND_DISABLE,data:n}),this.hiddenCmds.indexOf(n)>=0&&this.hideCommand(n)}},enableCommands:function(e){for(var t=0;t<e.length;t++){var n=e[t];this.toolBarEvents.publish({event:a.COLLECTION_TOOLBAR_COMMAND_ENABLE,data:n}),this.hiddenCmds.indexOf(n)>=0&&this.hideCommand(n)}},launchCommand:function(e){var t=this.currentTabKey?"grid-toolbar-action-click-"+this.currentTabKey:"grid-toolbar-action-click";this.modelEvents&&this.modelEvents.publish({event:t,data:e})},changeTooltipFontIcon:function(e,t){console.log(e,t),e.tooltip.getBody().setText(t.text),e.fonticon="fonticon fonticon-"+t.fonticon,e.elements.icon.className="fonticon fonticon-"+t.fonticon},destroy:function(){this.subscriptionList&&this.modelEvents&&this.modelEvents.unsubscribeList(this.subscriptionList),this.toolBarEvents.unsubscribeAll()}})});