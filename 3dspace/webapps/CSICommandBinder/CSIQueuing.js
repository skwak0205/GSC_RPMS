"undefined"==typeof define&&(define=function(t,e,r){CSIQueuing=r(EK,Parameters),define=void 0}),define("DS/CSICommandBinder/CSIQueuing",["DS/ExperienceKernel/ExperienceKernel","DS/CSICommandBinder/CSIParameters"],function(t,e){"use strict";var r={};r.JobStatus=Object.freeze({created:0,pending:1,running:2,cancel_pending:3,succeeded:4,failed:5,canceled:6,removed:7}),r.JobPriority=Object.freeze({high:0,aboveNormal:1,normal:2,belowNormal:3,low:4});var o=function(t,e){this.parameters_=t,this.context_=e};o.prototype.create=function(t){this.context_.callQueue("csiPushJob",this.parameters_,function(e){var r=e.readString("jobId");t(r)},function(e){var r=e.readString("error");t(void 0,r)})};var i=function(t){this.inputs_=t.readParameters("inputs","Parameters"),this.progress_=t.readParameters("progress","Parameters"),this.answer_=t.readParameters("answer","Parameters")};i.prototype.getInputs=function(){return this.inputs_},i.prototype.getProgress=function(){return this.progress_},i.prototype.getAnswer=function(){return this.answer_};var n=function(t){this.jobId_=t.readString("jobId"),this.tenant_=t.readString("tenantId"),this.pool_=t.readString("pool"),this.identifier_=t.readString("nodeIdentifier"),this.functionName_=t.readString("functionName"),this.functionVersion_=t.readInt32("functionVersion"),this.ttk_=t.readInt32("ttk"),this.ttl_=t.readInt32("ttl"),this.user_=t.readString("casUser"),this.user_uuid_=t.readString("casUserUUID"),this.keepProgress_=t.readBool("keepProgress"),this.retryCount_=t.readInt16("retryCount"),this.submissionTime_=t.readInt64("submissionTime"),this.startingTime_=t.readInt64("startingTime"),this.completionTime_=t.readInt64("completionTime"),this.status_=t.readInt32("status"),this.priority_=t.readInt32("priority"),t.exists("customProperties")&&(this.customProperties_=JSON.parse(t.readString("customProperties"))),t.exists("jobData")&&(this.jobData_=new i(t.readParameters("jobData","CSIJobData")))};n.prototype.getJobID=function(){return this.jobId_},n.prototype.getTenant=function(){return this.tenant_},n.prototype.getPool=function(){return this.pool_},n.prototype.getNodeIdentifier=function(){return this.identifier_},n.prototype.getFunctionName=function(){return this.functionName_},n.prototype.getFunctionVersion=function(){return this.functionVersion_},n.prototype.getTTK=function(){return this.ttk_},n.prototype.getTTL=function(){return this.ttl_},n.prototype.getCASUser=function(){return this.user_},n.prototype.getCASUserUUID=function(){return this.user_uuid_},n.prototype.getStatus=function(){return this.status_},n.prototype.getPriority=function(){return this.priority_},n.prototype.GetKeepProgress=function(){return this.keepProgress_},n.prototype.GetRetryCount=function(){return this.retryCount_},n.prototype.getSubmissionTime=function(){return this.submissionTime_},n.prototype.getStartingTime=function(){return this.startingTime_},n.prototype.getCompletionTime=function(){return this.completionTime_},n.prototype.getExecutionDuration=function(){return this.completionTime_-this.startingTime_},n.prototype.getCustomProperties=function(){return this.customProperties_},n.prototype.getJobData=function(){return this.jobData_},r.JobContext=function(t){this.impl_=new s(t)};var s=function(t){this.node_=t,this.queueId_=void 0,this.queueNodeTimeout_=void 0};s.prototype.queueId=function(){return void 0!==this.queueId_&&this.queueId_.getStatus()!==t.Status.disconnected||(this.queueId_=this.node_.select("CSIQueue",t.Criterion.timeout(300))),this.queueId_},s.prototype.callQueueForGetter=function(t,e,r,o){this.callQueue(t,e,r,function(t){var e=t.readString("error");o(void 0,e)})},s.prototype.callQueueForSetter=function(t,e,r){this.callQueue(t,e,function(){r()},function(t){r(t.readString("error"))})},s.prototype.callQueue=function(e,r,o,i){var n=this.queueId();void 0!==this.queueNodeTimeout_&&clearTimeout(this.queueNodeTimeout_),this.queueNodeTimeout_=setTimeout(function(){this.queueNodeTimeout_=void 0,n.getStatus()===t.Status.connected&&n.close()},6e4),this.node_.call({destinationNodeId:n,name:e,version:1,parameters:r,onSuccess:o,onError:i})},r.JobBuilder=function(t,o,i,n){this.context_=t.impl_,this.pool_=o,this.functionName_=i,this.functionVersion_=n,this.jobCreationProperties_=new e,this.jobCreationProperties_.writeInt32("status",r.JobStatus.created)},r.JobBuilder.prototype.create=function(t){return this.jobCreationProperties_.writeString("pool",this.pool_),this.jobCreationProperties_.writeString("functionName",this.functionName_),this.jobCreationProperties_.writeInt32("functionVersion",this.functionVersion_),new o(this.jobCreationProperties_,this.context_).create(t)},r.JobBuilder.prototype.createAndSubmit=function(t){return this.jobCreationProperties_.exists("functionInput")?(this.jobCreationProperties_.writeInt32("status",r.JobStatus.pending),this.create(t)):t(void 0,"Impossible to submit a job without inputs")},r.JobBuilder.prototype.ttk=function(t){return this.jobCreationProperties_.writeInt32("ttk",t),this},r.JobBuilder.prototype.ttl=function(t){return this.jobCreationProperties_.writeInt32("ttl",t),this},r.JobBuilder.prototype.priority=function(t){return this.jobCreationProperties_.writeInt32("priority",t),this},r.JobBuilder.prototype.identifier=function(t){return this.jobCreationProperties_.writeString("nodeIdentifier",t),this},r.JobBuilder.prototype.inputs=function(t){return this.jobCreationProperties_.writeParameters("functionInput","Parameters",t),this},r.JobBuilder.prototype.keepAllProgress=function(){return this.jobCreationProperties_.writeBool("keepProgress",!0),this},r.JobBuilder.prototype.customProperties=function(t){return this.jobCreationProperties_.writeString("customProperties",JSON.stringify(t)),this},r.JobController=function(t){this.context_=t.impl_},r.JobController.prototype.getInput=function(t,e){this.context_.callQueueForGetter("csiGetInput",u(t),function(t){var r=t.readParameters("input","Parameters");e(r)},e)},r.JobController.prototype.getAnswer=function(t,e){this.context_.callQueueForGetter("csiGetAnswer",u(t),function(t){var r=t.readParameters("answer","Parameters");e(r)},e)},r.JobController.prototype.getProgress=function(t,e){this.context_.callQueue("csiGetProgress",u(t),function(t){var r=t.readParameters("progress","Parameters"),o=t.readInt64("timestamp");e(r,o)},function(t){var r=t.readString("error");e(void 0,void 0,r)})},r.JobController.prototype.getAllProgress=function(t,e,r,o){void 0===r&&(r=-1),void 0===o&&(o=-1);var i=u(t);o>0&&r>=0&&(i.writeInt32("limit",o),i.writeInt32("offset",r)),this.context_.callQueue("csiGetAllProgress",i,function(t){var r=t.readParametersArray("progresses","Parameters"),o=t.readInt32Array("timestamps");e(r,o)},function(t){var r=t.readString("error");e(void 0,void 0,r)})},r.JobController.prototype.getProperties=function(t,r){var o=[].concat(t||[]);if(o.length<1)r(null);else{var i=1===o.length,s=new e;s.writeStringArray("jobIds",o),this.context_.callQueueForGetter("csiGetProperties",s,function(t){var e=t.readParametersArray("jobs","CSIJobProperties").map(function(t){return Object.freeze(new n(t))});r(i?e[0]:e)},r)}},r.JobController.prototype.getPropertiesAndData=function(t,r){var o=[].concat(t||[]),i=1===o.length,s=new e;s.writeStringArray("jobIds",o),s.writeBool("includeJobData",!0),this.context_.callQueueForGetter("csiGetProperties",s,function(t){var e=t.readParametersArray("jobs","CSIJobProperties").map(function(t){return Object.freeze(new n(t))});i&&e&&1===e.length?r(e[0]):r(e)},r)},r.JobController.prototype.getCustomProperties=function(t,e){this.context_.callQueueForGetter("csiGetCustomProperties",u(t),function(t){var r=JSON.parse(t.toJSObject().customProperties);e(r)},e)},r.JobController.prototype.getJobs=function(t,r,o){var i=new e;void 0!==o&&void 0!==r&&(i.writeInt32("limit",o),i.writeInt32("offset",r));this.context_.callQueueForGetter("csiGetAllJobs",i,function(e){var r=e.readStringArray("jobIds");t(r)},t)},r.JobController.prototype.setJobPriority=function(t,e,r){var o=u(t);o.writeInt32("priority",e),this.context_.callQueueForSetter("csiSetPriority",o,r)},r.JobController.prototype.setCustomProperties=function(t,e,r){var o=u(t);o.writeString("customProperties",JSON.stringify(e)),this.context_.callQueueForSetter("csiSetCustomProperties",o,r)},r.JobController.prototype.extendTTK=function(t,e,r){var o=u(t);o.writeInt32("ttk",e),this.context_.callQueueForSetter("csiExtendTTK",o,r)},r.JobController.prototype.extendTTL=function(t,e,r){var o=u(t);o.writeInt32("ttl",e),this.context_.callQueueForSetter("csiExtendTTL",o,r)},r.JobController.prototype.setInputs=function(t,e,r){var o=u(t);o.writeParameters("functionInput","Parameters",e),this.context_.callQueueForSetter("csiPushInputs",o,r)},r.JobController.prototype.submit=function(t,e){this.context_.callQueueForSetter("csiSubmitJob",u(t),e)},r.JobController.prototype.cancelJob=function(t,e){this.context_.callQueueForSetter("csiCancelJob",u(t),e)},r.JobController.prototype.removeJob=function(t,r){var o=[].concat(t||[]),i=new e;i.writeStringArray("jobIds",o),this.context_.callQueueForSetter("csiRemoveJob",i,r)};var u=function(t){var r=new e;return r.writeString("jobId",t),r};return r});