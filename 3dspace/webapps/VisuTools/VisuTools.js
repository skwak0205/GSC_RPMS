define("DS/VisuTools/PageObjectData",[],function(){"use strict";function e(){this.offsetX=0,this.offsetY=0,this.offsetWidth=0,this.offsetHeight=0}e.prototype.getOffsets=function(){return{x:this.offsetX,y:this.offsetY}},e.prototype.setData=function(e){this.offsetX=e.offsetX,this.offsetY=e.offsetY,this.offsetWidth=e.offsetWidth,this.offsetHeight=e.offsetHeight};var t=function(){this.forceRenderTargetSize={width:1,height:1},this.freeZone=null};return t.prototype.setSize=function(e,t){this.forceRenderTargetSize.width=e,this.forceRenderTargetSize.height=t},t.prototype.getFreeZone=function(){return this.freeZone},t.prototype.setFreeZone=function(t){this.freeZone||(this.freeZone=new e),this.freeZone.setData(t)},t}),define("DS/VisuTools/SettingManager",[],function(){"use strict";let e=new Set;e.add("_name"),e.add("_authorizedKeys"),e.add("_prefix"),e.add("_widget"),e.add("_value"),e.add("_size"),e.add("_commit"),e.add("_asStruct"),e.add("_useLocalStorage"),e.add("_pull"),e.add("_empty");let t={get:function(e,t){throw new Error("Write only")},set:function(t,i,n){if("function"!=typeof n){if(!(t._authorizedKeys&&!t._authorizedKeys.has(i)||e.has(i)))return t._pull(),t._value[i]=n,void 0===t._value&&delete t._value,t._commit(),!0;console.error("Error: unauthorized key")}else console.error("Error: value can not be a function")}},i={set:function(e,t,i){throw new Error("Read only")},get:function(t,i){if(!(t._authorizedKeys&&!t._authorizedKeys.has(i)||e.has(i)))return t._pull(),t._value[i];console.error("Error: unauthorized key")}};class n{constructor(e){this._authorizedKeys=e.authorizedKeys?e.authorizedKeys:null,this._name=e.name,this._prefix=e.viewer._familyName?e.viewer._familyName:"",this._widget=e.useWidget&&window.widget?window.widget:null,this._useLocalStorage=!!e.useLocalStorage,this._value=null,this._empty=!0,this._pull()}_pull(){var e;this._widget&&(e=this._widget.getValue(this._name)),!e&&this._useLocalStorage&&(e=localStorage.getItem(this._prefix+this._name)),e?(this._value=JSON.parse(e),this._empty=!1):this._value={}}_commit(){this._widget&&(this._widget.setValue(this._name,JSON.stringify(this._value)),this._empty=!1),this._useLocalStorage&&(localStorage.setItem(this._prefix+this._name,JSON.stringify(this._value)),this._empty=!1)}_asStruct(){this._pull();var e={};return Object.assign(e,this._value),e}_size(){return this._name.length+JSON.stringify(this._value).length}}return{Write:function(e){return new Proxy(new n(e),t)},Read:function(e){return new Proxy(new n(e),i)},Size:function(e){return new n(e)._size()},Struct:function(e){return new n(e)._asStruct()},isEmptySettings:function(e){return new n(e)._empty}}}),define("DS/VisuTools/CounterNode",["DS/Visualization/ThreeJS_DS","DS/Visualization/Node3D","DS/Visualization/TextNode","DS/Visualization/SceneGraphFactory"],function(e,t,i,n){"use strict";return t.extend({init:function(o,s,a){this._parent("FPSCounter"),this.viewer=o,this.ratio=4,this.setColor("black"),this.fixedSizeNode3D=new t("fixedSizeNode3D"),this.addChild(this.fixedSizeNode3D),this.text="null",this.oldColor=null,this.getPosition=s,this.size=a||10;var r=new t;n.createCuboidNode({cornerPoint:new e.Vector3(-5,-5,-5),firstAxis:new e.Vector3(10,0,0),secondAxis:new e.Vector3(0,10,0),thirdAxis:new e.Vector3(0,0,10),material:e.MaterialUtils.createShinyFaceMaterial({color:"red",force:!0})});return this.textNode=new i,r.addChild(this.textNode),this.token=null,this.fixedSizeNode3D.addChild(r),this.fixedSizeNode3D._setRatio(this.ratio),this.fixedSizeNode3D._setFixedSizeCameraName("robotCameraOrtho"),r._setBillboardData(1,null,null),this.onViewpointChange(),this},setColor:function(e){this.color=e},setText:function(t){this.text=t;var i=this.textNode;null!==this.token&&i.removeText(this.token),this.token=i.addText({string:t,anchor:new e.Vector3(0,0,0),color:new e.Color(this.color),size:this.size,lineLength:500,up:new e.Vector3(0,1,0),right:new e.Vector3(1,0,0)})},onViewpointChange:function(){var t,i,n=this.viewer.currentViewpoint;n&&(n._updateRobotCamera(this.viewer.internalSceneGraph),i=function(t,i){var o,s=n.robotCameraOrtho,a=new e.Vector3(t,i,0);if((new e.Projector).unprojectVector(a,s),s instanceof e.PerspectiveCamera){var r=new e.Ray(data.cameraEye,a.sub(data.cameraEye).normalize()),u=new e.Plane(this.viewer.currentViewpoint.camera.getLookAt(),0);o=r.intersectPlane(u)}else o=a;return(new e.Matrix4).setPosition(o)}((t=this.getPosition(this.viewer.canvas.width,this.viewer.canvas.height)).x,t.y),this.setMatrix(i))}})}),define("DS/VisuTools/StatsComputer",["DS/Visualization/OccurrenceExplorer","DS/Visualization/PrimitiveIterator","DS/Mesh/MeshUtils","DS/Visualization/Mesh3D"],function(e,t,i,o){"use strict";var s=function(e){this.viewer=e};s.prototype.computeStats=function(t){var i=this.viewer.getWebGLContext(),n=new e(this.viewer),s=this,r=new a;n.explore(function(e){(t?e.getOccurrenceItf(t):e.getUserRootOccurrenceItf()).traverse(s._handleOccurrence.bind(s,r,i))});var u=t?t.getLastElement():this.viewer.getRootNode();return u&&u.traverseUnique(function(e){e instanceof o?r.nbMeshes++:r.nbNodes++}),r},s.prototype._handleOccurrence=function(e,t,i){if(i.getVisibility()){var n=i.getMesh3D();if(n){e.nbMeshOccurrences++;var o=this.computeMeshStats(n,t);e.addStats(o)}else e.nbNodeOccurrences++}},s.prototype.computeMeshStats=function(e,t){var i,o,s,r,u,h,l,c=new a,d=e.mesh3js.geometry,p=d.length;for(i=0;i<p;i++)if((o=d[i]).drawingGroups)for(r=o.drawingGroups.length,s=0;s<r;s++)switch(h=(u=o.drawingGroups[s]).glType,l=u.count,h){case t.POINTS:c.nbPoints+=l;break;case t.LINES:c.nbLines+=l/2;break;case t.LINE_STRIP:n=l/2-1,n>0&&(c.nbLines+=2);break;case t.LINE_LOOP:c.nbLines+=l/2;break;case t.TRIANGLES:c.nbTriangles+=l/3;break;case t.TRIANGLE_STRIP:n=l/3-2,n>0&&(c.nbTriangles+=n);break;case t.TRIANGLE_FAN:n=l/3-1,n>0&&(c.nbTriangles+=n)}return c};var a=function(){this.nbPoints=0,this.nbLines=0,this.nbTriangles=0,this.nbNodes=0,this.nbNodeOccurrences=0,this.nbMeshes=0,this.nbMeshOccurrences=0};return a.prototype.addStats=function(e){this.nbPoints+=e.nbPoints,this.nbLines+=e.nbLines,this.nbTriangles+=e.nbTriangles},s}),define("DS/VisuTools/WebVisuPOUtils",["DS/VisuEvents/EventsManager","DS/VisuEvents/MouseEvent","DS/Visualization/TrackballControls","DS/VisuEvents/TouchEvent"],function(e,t,i,n){"use strict";var o=null;function s(e){return[e.x,e.y,e.z]}function a(e){var t=e.currentViewpoint,i={version:1,viewpoint:{sightDirection:s(t.getSightDirection()),upDirection:s(t.getUpDirection()),eyePosition:s(t.getEyePosition()),distanceToTarget:t.getTargetDistance(),projectionType:t.projectionType},support:{size:[e.canvas.width,e.canvas.height],devicePixelRatio:e.devicePixelRatio}};if(0===t.projectionType)i.viewpoint.fov=t.getAngle();else{var n=t.camera;i.viewpoint.top=n.top,i.viewpoint.bottom=n.bottom,i.viewpoint.left=n.left,i.viewpoint.right=n.right}var o=l.createFreeZoneJSON(e,!0);return o&&(i.support.freeZone=o),i}function r(e,t,i){var n=a(t),o=t.canvas,s=t.devicePixelRatio,r=e.getCurrentPosition(t,o),u={x:Math.round(s*t.SCREEN_WIDTH*r.x/o.offsetWidth),y:Math.round(s*t.SCREEN_HEIGHT*r.y/o.offsetHeight)};-1!==e.button&&(u.button=e.button);var h=l.modifierKeysToInteger(e.event);h&&(u.keys=h),l.writeCtxToConsole(n),l.writeToConsole("await viewer."+i+"("+JSON.stringify(u)+",ctx);",{type:i,data:u})}function u(e,t,i,n){var o=a(i),s=i.canvas,r=e.getCurrentPosition(i,s),u=t.getCurrentPosition(i,s),h=i.devicePixelRatio,c={x0:Math.round(h*i.SCREEN_WIDTH*r.x/s.offsetWidth),y0:Math.round(h*i.SCREEN_HEIGHT*r.y/s.offsetHeight),x1:Math.round(h*i.SCREEN_WIDTH*u.x/s.offsetWidth),y1:Math.round(h*i.SCREEN_HEIGHT*u.y/s.offsetHeight)};-1!==e.button&&(c.button=e.button);var d=l.modifierKeysToInteger(e.event);d&&(c.keys=d),l.writeCtxToConsole(o),l.writeToConsole("await viewer."+n+"("+JSON.stringify(c)+",ctx);",{type:n,data:c})}function h(e){var t,i=e.from[0].button;for(t=1;t<e.from.length;t++)-1!==e.from[t].button&&(i=e.from[t].button);return i}var l={writeCtxToConsole:function(e){var t=JSON.stringify(e);t!==o&&(l.writeToConsole("var ctx = "+t+";",{type:"ctx",data:e}),o=t)},dumpEvents:function(t){var i=this.tokens;0===i.length&&(i.push(e.addEvent(t.canvas,"onLeftClick",this._onMouseClick.bind(this,t))),i.push(e.addEvent(t.canvas,"onMiddleClick",this._onMouseClick.bind(this,t))),i.push(e.addEvent(t.canvas,"onRightClick",this._onMouseClick.bind(this,t))),i.push(e.addEvent(t.canvas,"onMouseMove",this._onMouseMove.bind(this,t))),i.push(e.addEvent(t.canvas,"onLeftMouseDown",this._onMouseDown.bind(this,t))),i.push(e.addEvent(t.canvas,"onMiddleMouseDown",this._onMouseDown.bind(this,t))),i.push(e.addEvent(t.canvas,"onRightMouseDown",this._onMouseDown.bind(this,t))),i.push(e.addEvent(t.canvas,"onLeftMouseUp",this._onMouseUp.bind(this,t))),i.push(e.addEvent(t.canvas,"onMiddleMouseUp",this._onMouseUp.bind(this,t))),i.push(e.addEvent(t.canvas,"onRightMouseUp",this._onMouseUp.bind(this,t))),i.push(e.addEvent(t.canvas,"onLeftDoubleClick",this._onMouseDoubleClick.bind(this,t))),i.push(e.addEvent(t.canvas,"onMiddleDoubleClick",this._onMouseDoubleClick.bind(this,t))),i.push(e.addEvent(t.canvas,"onRightDoubleClick",this._onMouseDoubleClick.bind(this,t))),i.push(e.addEvent(t.canvas,"onHoldLeftMouseDown",this._onHoldMouseDown.bind(this,t))),i.push(e.addEvent(t.canvas,"onHoldMiddleMouseDown",this._onHoldMouseDown.bind(this,t))),i.push(e.addEvent(t.canvas,"onHoldRightMouseDown",this._onHoldMouseDown.bind(this,t))),i.push(e.addEvent(t.canvas,"onTap",this._onTap.bind(this,t))),i.push(e.addEvent(t.canvas,"onDoubleTap",this._onDoubleTap.bind(this,t))),i.push(e.addEvent(t.canvas,"onPrimaryPointerDownUnique",this._onPrimaryPointerDownUnique.bind(this,t))),i.push(e.addEvent(t.canvas,"onPrimaryPointerUpUnique",this._onPrimaryPointerUpUnique.bind(this,t))),i.push(e.addEvent(t.canvas,"onHold",this._onHold.bind(this,t))),i.push(e.addEvent(t.canvas,"onLongHold",this._onLongHold.bind(this,t))),i.push(e.addEvent(t.canvas,"onSwipe",this._onSwipe.bind(this,t))),document.addEventListener("keydown",this._onKeyDownEvent.bind(this,t)),document.addEventListener("keyup",this._onKeyUpEvent.bind(this,t)))},createFreeZoneJSON:function(e,t){var i=e.getFreeZone();if(i){var n=i.getOffsets?i.getOffsets():{x:0,y:0};return t?[n.x,n.y,i.offsetWidth,i.offsetHeight]:{offsetX:n.x,offsetY:n.y,offsetWidth:i.offsetWidth,offsetHeight:i.offsetHeight}}return null},touch:{hold:!1,longHold:!1,swipe:{start:null,end:null}},_onHold:function(e,t){this.touch.hold=!0},_onLongHold:function(e,t){this.touch.longHold=!0},_onPrimaryPointerDownUnique:function(e,t){this.touch.hold=!1,this.touch.longHold=!1;var i=t.from[0].event;if(i.changedTouches&&1===i.changedTouches.length){var o=new n(i.changedTouches[0].identifier,i);o.update(i),this.touch.swipe.start=o,this.touch.swipe.end=null}},_onSwipe:function(e,t){e.currentViewpoint.isMoving()&&(this.touch.swipe.start=null);var i=t.from[0].event;if(i.changedTouches&&1===i.changedTouches.length){var o=new n(i.changedTouches[0].identifier,i);o.update(i),this.touch.swipe.end=o}},_onPrimaryPointerUpUnique:function(e,t){if(this.touch.swipe.start&&this.touch.swipe.end){var i="touchSwipe";this.touch.hold&&(i="touchHoldSwipe"),this.touch.longHold&&(i="touchLongHoldSwipe"),u(this.touch.swipe.start,this.touch.swipe.end,e,i)}},_onTap:function(e,t){if(l.play&&l.high){var i=t.from[0].event;if(i.changedTouches&&1===i.changedTouches.length){var o=new n(i.changedTouches[0].identifier,i);o.update(i),r(o,e,"touchTap")}}},_onDoubleTap:function(e,t){if(l.play&&l.high){var i=t.from[0].event;if(i.changedTouches&&1===i.changedTouches.length){var o=new n(i.changedTouches[0].identifier,i);o.update(i),r(o,e,"touchDoubleTap")}}},_onMouseClick:function(e,i){if(l.play&&l.high){var n=i.from[0].event,o=h(i),s=new t(o,n);s.update(n),r(s,e,"mouseClick")}},_onMouseDoubleClick:function(e,i){if(l.play&&l.high){var n=i.from[0].event,o=h(i),s=new t(o,n);s.update(n),r(s,e,"mouseDoubleClick")}},_onHoldMouseDown:function(e,t){l.holdDown=!0},_onMouseMove:function(e,i){if(e.currentViewpoint.isMoving()&&(l.downEvent=null),l.play){var n=i.from[0].event,o=h(i),s=new t(o,n);s.update(n),l.high||r(s,e,"mouseMove")}},_onMouseDown:function(e,i){if(l.holdDown=!1,l.downEvent=null,l.play){var n=i.from[0].event,o=h(i),s=new t(o,n);s.update(n),l.downEvent=s,l.high||r(s,e,"mouseDown")}},_onMouseUp:function(e,i){if(l.play){var n=i.from[0].event,o=h(i),s=new t(o,n);if(s.update(n),l.high){if(l.downEvent&&l.dumpDrag){var a=l.downEvent.currentPosition.distanceTo(s.currentPosition),c=s.currentTime-l.downEvent.currentTime;(a>10||c>300)&&u(l.downEvent,s,e,l.holdDown?"mouseLongDrag":"mouseDrag")}}else r(s,e,"mouseUp")}},modifierKeysToInteger:function(e){return(e.shiftKey?1:0)+(e.altKey?2:0)+(e.ctrlKey?4:0)},integerToModifierKeys:function(e){return{shiftKey:!!(1&e),altKey:!!(2&e),ctrlKey:!!(4&e)}},_onKeyDownEvent:function(e,t){if(l.play&&l.dumpKeyboard&&!l.keyDownMap.has(t.keyCode)){var i={key:t.key,keyCode:t.keyCode},n=l.modifierKeysToInteger(t);n&&(i.keys=n),l.keyDownMap.set(t.keyCode,{time:Date.now()}),l.high||l.writeToConsole("await viewer.keyDown("+JSON.stringify(i)+");",{type:"keyDown",data:i})}},_onKeyUpEvent:function(e,t){if(l.play&&l.dumpKeyboard){var i={key:t.key,keyCode:t.keyCode},n=l.modifierKeysToInteger(t);if(n&&(i.keys=n),l.high){if(l.keyDownMap.has(t.keyCode))Date.now()-l.keyDownMap.get(t.keyCode).time<500&&l.writeToConsole("await viewer.keyClick("+JSON.stringify(i)+");",{type:"keyClick",data:i})}else l.writeToConsole("await viewer.keyUp("+JSON.stringify(i)+");",{type:"keyUp",data:i});l.keyDownMap.delete(t.keyCode)}},_onScreenShot:function(e,t,i,n,o,s){var r=a(e);l.writeCtxToConsole(r);var u=s?"FullPixelChecker":"ContentChecker",h=s?', "key": key':"",c=e.devicePixelRatio,d={x:c*t,y:+(c*i),width:+(c*n),height:+(c*o)};l.writeToConsole("await viewer.snapshot("+JSON.stringify(d)+', ctx, {checkerMode:"'+u+'"'+h+"}).then((v)=>{expect(v).toEqual(true);});",{type:"snaphot",data:d,checkerMode:u})},_onRepPick:function(e,t,i){var n=a(e),s=JSON.stringify(n);s!==o&&(l.writeToConsole("var ctx = "+s+";"),o=s);var r={x:t,y:i};l.writeToConsole("await viewer.dumpRepresentationProperties("+JSON.stringify(r)+", ctx).then((v)=>{expect(v).toEqual(true);});",{type:"dumpRepresentationProperties",data:r})},tokens:[],consoleDlg:null,consoleItems:[],play:!0,high:!0,downEvent:null,holdDown:!1,dumpDrag:!0,dumpKeyboard:!0,keyDownMap:new Map,writeToConsole:function(e,t){this.consoleDlg?this.consoleDlg._displayItems([{str:e,json:t}]):this.consoleItems.push({str:e,json:t})},clear:function(){o=null},getConsoleItems:function(){var e=this.consoleItems;return this.consoleItems=[],e},registerConsoleDlg:function(e){this.consoleDlg=e},setPlay:function(e){this.play=e},setLevel:function(e){this.high="high"===e}};return l}),define("DS/VisuTools/OccurrenceDump",["UWA/Class","DS/Visualization/ThreeJS_DS","DS/Mesh/Mesh"],function(e,t,i){"use strict";var n={WIRE_EDGE:2,BOUNDARY_EDGE:4,SHARP_EDGE:8,SMOOTH_EDGE:16,BOUNDARY_POINT:64,SHARP_POINT:128,SMOOTH_POINT:256,SURFACIC_POINT:512,FREE_POINT:1024,INFINITE_FACE:4096,FACE:8192,AXIS_SYSTEM:1<<17};return UWA.Class.extend({init:function(e){this._newMatInherit=!1,this._renderable=e.occurrence?e.occurrence.renderable:null,this._rep=e.rep,this._materialsAndGAS=null,this._viewer=e.viewer,this._pickPos=e.pickingPosition,this._json=null,this._renderable&&this._rep?this._fromRep():this._viewer&&this._pickPos&&this.fromPick(this._viewer,this._pickPos)},fromPick:function(e,t){if(this._json=null,!e)return!1;this._newMatInherit=window.newMaterialInheritance;var i=e.pick(e.getMousePosition(t),"repHybrid");if(!i)return!1;var n=i.path&&i.path[0];if(!n)return!1;var o=n._getRenderableOccurrences();return!(!o||!o.length||o.length>1)&&(this._renderable=o[0],this._rep=n.getLastElement(!1),this._fromRep())},isEqual:function(e){this.getJSON();var t=this._json;return!!t&&(e.version===t.version&&(!!this._compareMatrices(e.worldMatrix,t.worldMatrix)&&(e.nbPrimitives===t.nbPrimitives&&(e.nbTriangles===t.nbTriangles&&(e.nbLines===t.nbLines&&(e.nbPoints===t.nbPoints&&(e.bbox.min.x===t.bbox.min.x&&e.bbox.min.y===t.bbox.min.y&&e.bbox.min.z===t.bbox.min.z&&e.bbox.max.x===t.bbox.max.x&&e.bbox.max.y===t.bbox.max.y&&e.bbox.max.z===t.bbox.max.z&&(e.materials.length===t.materials.length&&(e.gas.length===t.gas.length&&e.groups.length===t.groups.length)))))))))},getJSON:function(){return this._json||this._buildJSON(),this._json},downloadJSON:function(e){this.getJSON();var t=JSON.stringify(this._json,null,4),i=new Blob([t],{type:"text/plain"}),n=document.createElement("a");n.download=e,n.innerHTML="Download File",n.href=window.URL.createObjectURL(i),document.body.appendChild(n),n.click(),document.body.removeChild(n)},_fromRep:function(){return this._json=null,this._materialsAndGAS=new Map,this._getDGsFromRep(),this._renderable.layer&&this._getLayersFromRep(),this._getMaterialsAndGAS(),this._renderable.layer&&this._mergeLayers(),this._buildJSON(),null!==this._json},_buildJSON:function(){if(!this._renderable||!this._rep)return!1;var e=!!this._renderable.layer,o={worldMatrix:this._renderable.matrix.createJSON(),bbox:{min:[1/0,1/0,1/0],max:[-1/0,-1/0,-1/0]},groups:[]};new Map,new Map,new Map;const s=this._materialsAndGAS[Symbol.iterator]();for(const _ of s){var a=_[0];if(e&&(a=a.drawableGroup),!n[a.geomType])return;var r=_[1],u=r.primitives,h={geomType:i.GeomTypeString[a._geomType],nbPrimitives:u.length};r.material&&(h.material=this._getJSONMaterial(r.material)),r.gas&&(h.gas=r.gas.isGAS?r.gas.getJSON():this._getJSONGAS(r.gas)),o.groups.push(h);for(var l=0;l<u.length;l++)for(var c=u[l],d=c.getStart(),p=c.getCount(),f=a.geometry,v=f.vertexIndexArray,m=new t.Vector3,g=d;g<d+p;g++)f.getVertexPosition(v[g],m),m.x<o.bbox.min[0]&&(o.bbox.min[0]=m.x),m.y<o.bbox.min[1]&&(o.bbox.min[1]=m.y),m.z<o.bbox.min[2]&&(o.bbox.min[2]=m.z),m.x>o.bbox.max[0]&&(o.bbox.max[0]=m.x),m.y>o.bbox.max[1]&&(o.bbox.max[1]=m.y),m.z>o.bbox.max[2]&&(o.bbox.max[2]=m.z)}this._json=o},_getDGsFromRep:function(){for(var e=this._rep.getPrimitives(),t=0;t<e.length;t++){var i=e[t],n=i.getGroup(),o=this._materialsAndGAS.get(n);o||(o={primitives:[],layer:null,material:null,gas:null},this._materialsAndGAS.set(n,o)),o.primitives.push(i)}},_getLayersFromRep:function(){const e=this._materialsAndGAS[Symbol.iterator]();var t=new Map;for(const p of e)for(var i=p[0],n=p[1].primitives,o=i.geometry,s=this._renderable.layer.getIntervals(o,i,!0),a=0;a<n.length;a++)for(var r=n[a],u=r.getStart(),h=0;h<s.length;h++){var l=s[h],c=l.drawableInterval;if(u>=c.start&&u<c.start+c.count){var d=t.get(l);d||(d={primitives:[],layer:c,material:null,gas:null},t.set(l,d)),d.primitives.push(r);break}}this._materialsAndGAS=t},_mergeLayers:function(){const e=this._materialsAndGAS[Symbol.iterator]();var t=new Map,i=new Map;for(const f of e){var n=f[0],o=n.drawableGroup,s=n.drawableInterval,a=f[1].primitives,r=f[1].material,u=f[1].gas,h=o.glType+"-"+o._geomType+"-";h+=(u?u.id:-1)+"-",h+=r?r.id:-1;var l=t.get(h);if(l)for(var c=0;c<a.length;c++)l.primitives.push(a[c]);else{var d=a.slice();t.set(h,{primitives:d});var p={primitives:d,layer:s,material:r,gas:u};i.set(n,p)}}this._materialsAndGAS=i},_getJSONGAS:function(e){return{color:e.color.getHexString(),opacity:e.opacity,lineWidth:e.lineWidth}},_getJSONMaterial:function(e){return{type:e.getType(),color:e.color.getHexString(),opacity:e.opacity}},_getRenderMaterial:function(e,t){var i=e;return t.glType>=1&&t.glType<=3&&e.line&&(i=e.line),0===t.glType&&e.point&&(i=e.point),i},_getMaterialsAndGAS:function(){var e=this._renderable,i=!!e.layer,n=e.material,o=e.matApp,s=e.gas;if(this._newMatInherit){const p=this._materialsAndGAS[Symbol.iterator]();for(const f of p){var a=f[0];i&&(a=a.drawableGroup);var r=a.glType,u=null,h=null,l=o&&o._getMaterialFromGLType(r,a._geomType),c=f[1].layer&&f[1].layer.material?f[1].layer.material:a.material,d=f[1].layer&&f[1].layer.gas?f[1].layer.gas:a.gas;c&&(c.isMatApp&&(u=c.solveInheritance(o,e._occurrence.depth)===o?l:c._getMaterialFromGLType(r,a._geomType)),u||c.isMatApp||(l?o:null,(u=l)||(u=c instanceof t.Material?c:null))),u||(o,u=l),!u&&n&&n.force&&(u=n),h=s?s.getMaterial(d,r,null,null):d.isGAS?d.getMaterial(null,r,null,null):d,f[1].material=u,f[1].gas=h}}else{const e=this._materialsAndGAS[Symbol.iterator]();for(const t of e){a=t[0];i&&(a=a.drawableGroup);u=null,h=null,d=t[1].layer?t[1].layer.gas:a.gas;t[1].layer&&t[1].layer.material?u=this._getRenderMaterial(t[1].layer.material,a):n.force?u=this._getRenderMaterial(n,a):a.material&&(u=this._getRenderMaterial(a.material,a)),h=this._getRenderMaterial(d,a),t[1].material=u,t[1].gas=h}}}})}),define("DS/VisuTools/FPSCounter",["DS/Visualization/ThreeJS_DS","DS/VisuTools/CounterNode"],function(e,t){"use strict";var i=function(e,t){this.sampleSize=e||20,this.invertMaxMin=!!t,this.reset()};i.prototype.addSample=function(e,t){if(this.sampleSize>=0){(t||-1===this.nextSampleIndex||this.lastFrame!==window.webVisuPerfo.frameCount)&&(-1!==this.nextSampleIndex&&(this.min=this.min>this.currentValue?this.currentValue:this.min),this.nextSampleIndex=(this.nextSampleIndex+1)%this.sampleSize,this.nbSamples++,this.lastFrame=window.webVisuPerfo.frameCount,this.samples.length<this.sampleSize?this.samples.push(0):this.samples[this.nextSampleIndex]=0,this.currentValue=0),this.samples[this.nextSampleIndex]+=e,this.sum+=e;var i,n=0;for(i=0;i<this.samples.length;i++)n+=this.samples[i];n/=this.samples.length,this.currentValue+=e,this.window=n,this.global=this.sum/this.nbSamples,this.max=this.max<this.currentValue?this.currentValue:this.max}else-1===this.lastFrame?this.window=e:this.window+=e,this.min=this.window,this.max=this.window,this.global=this.window},i.prototype.reset=function(){this.sample=[],this.samples=[],this.sum=0,this.nbSamples=0,this.nextSampleIndex=-1,this.lastFrame=-1,this.currentValue=0,this.sampleSize<0?(this.window=0,this.global=0,this.min=0,this.max=0):(this.min=1/0,this.max=-1/0,this.window=void 0,this.global=void 0)},i.prototype.getValue=function(){var e=window.webVisuPerfo._mode;return this.invertMaxMin&&("min"===e?e="max":"max"===e&&(e="min")),this[e]};var n=function(e,t){this.name=e,this.measure=new i(t),this.startTime=null};n.prototype.startSample=function(){this.startTime=performance.now()},n.prototype.endSample=function(){if(null!==this.startTime){var e=performance.now()-this.startTime;window.fpsCounterODT&&(e=2*window.fpsCounterODT),this.measure.addSample(e)}this.startTime=null};var o=function(e){var n=this;this.viewer=e,this.node=new t(e,function(e,t){return{x:2*(e-200*n.viewer.devicePixelRatio)/e-1,y:.65}}),this.node.setRenderPasses(["robotOrtho"]),this.activated=!1,this.token=null,this.previousTime=(new Date).getTime(),this.frozen=!1,this.color=null,this.ldhNodeManager=null,this.fpsMeasure=new i(30,!0),this._measuresMap={fps:{measure:this.fpsMeasure}}};function s(e){var t=window.webVisuPerfo;switch(e.key){case"+":t.setMode("max");break;case"-":t.setMode("min");break;case"w":t.setMode("window");break;case"g":t.setMode("global");break;case"r":t.reset();break;case"f":t.freeze()}}o.prototype.toggleFrozen=function(){this.frozen=!this.frozen,this.frozen?(this.node.setColor("#aaffaa"),this.node.setText(this.node.text),this.viewer.render()):this.node.setColor(this.color)},o.prototype.onAnimate=function(){function e(e){return null!=e&&e.toFixed?e.toFixed(1):NaN}var t=window.webVisuPerfo;if(this.viewer===t._leadViewer&&t.frameCount++,null===this.ldhNodeManager&&window.oocLDHNodeManager&&(this.ldhNodeManager=window.oocLDHNodeManager),this.activated){var i=(new Date).getTime(),n=(this.average,window.webVisuPerfo),o=n._enabled?n._measuresList:[],s=i-this.previousTime;void 0!==window.fpsCounterODT&&(s=1e3/window.fpsCounterODT),this.fpsMeasure.addSample(s,!0);var a="";window.webVisuPerfo.lastResults||(window.webVisuPerfo.lastResults={});var r=window.webVisuPerfo.lastResults,h=window.modelLoaderPoolStats;(o.length||h&&h.startTime>0)&&(a+="fps: ");var l,c,d=1e3/this.fpsMeasure.getValue();if(r.frameTime=this.fpsMeasure.getValue(),a+=e(d),u||(a=""),h&&h.startTime>0){var p=h.computeInstantStats();a+="\nmps: "+e(p.mps),a+="\nimps: "+e(p.imps),a+="\nbatch: "+p.batches,a+="\nbsize: "+e(p.batchSize),a+="\nMb/s: "+e(p.mbps),a+="\nq: "+oocLDHNodeManager.queues[0].nodesToLoadQueue.getSize(),a+="\noccl: "+p.occlusion;var f=window.debugUnloadManager;if(f&&(a+="\nmem: "+e(f.usage)+"%",a+="\ngpu: "+e(f.usageGPU)+"%"),a+="\nmtot: "+e(h.nbLoadedModels),this.ldhNodeManager){var v="---";this.ldhNodeManager.lastDeltaTime>=0&&(v=this.ldhNodeManager.lastDeltaTime/1e3+"s"),this.ldhNodeManager.previousIsLoading&&(v="("+v+")"),a+="\nvp: "+v}for(a+="\nmlt: "+e(p.modelLoadingTime)+"s",p.ttsTime>=0&&(a+="\nttsvp: "+e((p.ttsTime-this.ldhNodeManager.startLoadTime)/1e3)+"s",a+="\nttsmlt: "+e((p.ttsTime-p.firstLoadTime)/1e3)+"s"),l=0;l<p.flags.length;l++)a+="\n"+p.flags[l]}if(u)for(l=0;l<o.length;l++)c=o[l],d=n._measuresMap[c].measure.getValue(),r[c]=d,a+="\n"+c+": "+e(d);window.fpsCounterODT||t._statsMap.forEach(function(e,t,i){a+="\n"+t+": "+e}),this.frozen||this.node.setText(a),this.previousTime=i,u&&this.viewer.render()}},o.prototype.setActivated=function(e){e?this.activated||(this.viewer.internalSceneGraph.robotRoot.addChild(this.node),this.token=this.viewer.currentViewpoint.onMove(this.node.onViewpointChange.bind(this.node))):this.activated&&(this.viewer.internalSceneGraph.robotRoot.removeChild(this.node),this.viewer.currentViewpoint.unsubscribe(this.token),this.token=null),this.activated=!!e},o.prototype.setColor=function(e){this.color=e,this.frozen||this.node.setColor(this.color)},window.webVisuPerfo=window.webVisuPerfo||{};var a,r={setEnabled:function(e){(e&&!this._enabled||!e&&this._enabled)&&(this._enabled=e,e?document.addEventListener("keydown",s):document.removeEventListener("keydown",s)),this.setMode(e?"global":"window")},startPerfo:function(e,t){if(this._enabled){var i=this._measuresMap[e];i||(i=new n(e,t),this._measuresMap[e]=i,this._measuresList.push(e)),i.startSample()}},endPerfo:function(e){if(this._enabled){var t=this._measuresMap[e];t&&t.endSample()}},setStats:function(e,t){this._statsMap.set(e,t)},setMode:function(e){if("window"!==e&&"global"!==e&&"min"!==e&&"max"!==e)throw new Error("Unknown mode (permitted values are 'window', 'global', 'min' or 'max')");this._mode=e,console.log("perfo monitor: mode="+e)},reset:function(){var e,t,i=this._perfoManagers;for(e=0;e<i.length;e++)i[e].fpsMeasure.reset();for(t in this._measuresMap)this._measuresMap[t].measure.reset();console.log("perfo monitor: reset")},freeze:function(){this._leadViewer.fpsCounter.toggleFrozen()},_perfoManagers:[],_measuresMap:{},_measuresList:[],_statsMap:new Map,_mode:"global",_enabled:!1,_leadViewer:null,frameCount:0};for(a in r)r.hasOwnProperty(a)&&(window.webVisuPerfo[a]=r[a]);r=null;var u=!0;return{setActivated:function(e,t,i){window.webVisuPerfo._leadViewer||(window.webVisuPerfo._leadViewer=e);var n=e.fpsCounter;n||(n=new o(e),e.fpsCounter=n,window.webVisuPerfo._perfoManagers.push(n)),void 0!==i&&n.setColor(i),n.setActivated(t)},setAutoRefresh:function(e){u=!!e}}}),define("DS/VisuTools/InfoCounter",["DS/Visualization/ThreeJS_DS","DS/VisuTools/CounterNode"],function(e,t){function i(e,i){var n=this;this._activated=!0,this.viewer=e,this.color=i,this.counterNode=new t(e,function(e,t){return{x:200*n.viewer.devicePixelRatio/e-1,y:.9}},6),this.viewer.internalSceneGraph.robotRoot.addChild(this.counterNode),this.counterNode.setRenderPasses(["robotOrtho"]),this.token=e.currentViewpoint.onMove(this.counterNode.onViewpointChange.bind(this.counterNode)),i&&this.setColor(i),this.text=null,this.updateText()}return i.prototype.setColor=function(e){this.counterNode.setColor(e)},i.prototype._getInfos=function(){var t=this.viewer.renderer.renderer,i={},n=t.info.renderTime.frameTypeMap.get(e._FrameTypes.MAIN);n&&(i.main={time:Math.round(1e3*n._duration)/1e3}),(n=t.info.renderTime.frameTypeMap.get(e._FrameTypes.GPU_INTERSECTION))&&(i.pick={time:Math.round(1e3*n._duration)/1e3}),(n=t.info.renderTime.frameTypeMap.get(e._FrameTypes.GPU_INTERSECTION_SMALL))&&(i.smallPick={time:Math.round(1e3*n._duration)/1e3});var o=t.info.renderMap.get(e._FrameTypes.MAIN);return o&&Object.assign(i,{memory:t.info.memory,culling:o.getCulling(),geometries:o.getGeometries(),rendering:o.getRendering()}),i},i.prototype.buildText=function(){var e,t,i=this._getInfos(),n="";for(e in i){var o;if(i.hasOwnProperty(e)&&"render"!=e)for(o in t=i[e],n+=e.toUpperCase()+"\n",t)t.hasOwnProperty(o)&&(n+="   "+o+": "+t[o]+"\n")}return n},i.prototype.updateText=function(){if(requestAnimationFrame(this.updateText.bind(this)),this._activated){var e=this.buildText();e!==this.text&&(this.counterNode.setText(e),this.text=e,this.viewer.render())}},i.prototype.activate=function(e){e=!!e,this.counterNode.setVisibility(e),this._activated=e,this.viewer.render()},i}),define("DS/VisuTools/WebVisuPOEngine",["DS/Visualization/ThreeJS_DS","DS/VisuTools/PageObjectData","DS/VisuEvents/EventsManager","DS/VisuTools/WebVisuPOUtils","DS/Visualization/Ambience","DS/VisuTools/OccurrenceDump","DS/Visualization/MaterialManager"],function(e,t,i,n,o,s,a){"use strict";var r={lastPosition:{x:-1,y:-1},touchData:{touchID:0,nbFingers:0,fingers:{}},simulateClick:function(e,t,i,n){var o=this.getViewer(n);this._applyCtx(t,o);var s=this._createEventData(e);this._warmupPicking(o);var a=s.x,r=s.y;this.lastPosition.x=a,this.lastPosition.y=r,this._simulateEvent("mousemove",s,o),this._simulateEvent("mousedown",s,o),this._simulateEvent("mouseup",s,o),2===e.button&&this._simulateEvent("contextmenu",s,o),i&&i()},simulateDoubleClick:function(e,t,i,n){var o=this.getViewer(n);this._applyCtx(t,o),this._warmupPicking(o);var s=this._createEventData(e),a=s.x,r=s.y;this.lastPosition.x=a,this.lastPosition.y=r,this._simulateEvent("mousemove",s,o),this._simulateEvent("mousedown",s,o),this._simulateEvent("mouseup",s,o),setTimeout(()=>{this._simulateEvent("mousedown",s,o),this._simulateEvent("mouseup",s,o),this._simulateEvent("dblclick",s,o),i&&i()},200)},simulateMouseEvent:function(e,t,i,n,o){var s=this.getViewer(o);this._applyCtx(i,s);var a=this._createEventData(t);this._simulateEvent(e,a,s),n&&n()},simulateDrag:function(e,t,i,n){var o=this.getViewer(n);this._applyCtx(t,o),this._warmupPicking(o);var s=this._createEventData(e,e.x0,e.y0);this._simulateEvent("mousemove",s,o),this._simulateEvent("mousedown",s,o),s=this._createEventData(e,e.x1,e.y1),this._simulateEvent("mousemove",s,o);var a=this;setTimeout(function(){a._simulateEvent("mouseup",s,o),i&&i()},500)},simulateLongDrag:function(e,t,n,o){var s=this.getViewer(o);this._applyCtx(t,s),this._warmupPicking(s);var a=this,r=a._createEventData(e,e.x0,e.y0);a._simulateEvent("mousemove",r,s),a._simulateEvent("mousedown",r,s);var u=i.getLongHoldTime()+100;setTimeout(function(){r=a._createEventData(e,e.x1,e.y1),a._simulateEvent("mousemove",r,s),setTimeout(function(){a._simulateEvent("mouseup",r,s),n()},500)},u)},simulateKeyDown:function(e,t,i){var n=this.getViewer(i);this._simulateKeyboardEvent("keydown",e,n),t&&t()},simulateKeyUp:function(e,t,i){var n=this.getViewer(i);this._simulateKeyboardEvent("keyup",e,n),t&&t()},simulateKeyClick:function(e,t,i){var n=this.getViewer(i);this._simulateKeyboardEvent("keydown",e,n),this._simulateKeyboardEvent("keyup",e,n),t&&t()},simulateTap:function(e,t,i,n){var o=this.getViewer(n);this._applyCtx(t,o);this._createEventData(e);this._warmupPicking(o),this._simulateTouchEvent("touchstart",0,e,o),this._simulateTouchEvent("touchend",0,e,o),i&&i()},simulateDoubleTap:function(e,t,i,n){var o=this.getViewer(n);this._applyCtx(t,o),this._warmupPicking(o);var s=this._createEventData(e);this._simulateTouchEvent("touchstart",0,s,o),this._simulateTouchEvent("touchend",0,s,o),setTimeout(()=>{this._simulateTouchEvent("touchstart",0,s,o),this._simulateTouchEvent("touchend",0,s,o),i&&i()},200)},simulateHoldSwipe:function(e,t,n,o){var s=this.getViewer(o);this._applyCtx(t,s),this._warmupPicking(s);var a=this,r=a._createEventData(e,e.x0,e.y0);a._simulateTouchEvent("touchstart",0,r,s);var u=i.getHoldTime()+100;setTimeout(function(){r=a._createEventData(e,e.x1,e.y1),a._simulateTouchEvent("touchmove",0,r,s),setTimeout(function(){a._simulateTouchEvent("touchend",0,r,s),n&&n()},500)},u)},simulateLongHoldSwipe:function(e,t,n,o){var s=this.getViewer(o);this._applyCtx(t,s),this._warmupPicking(s);var a=this,r=a._createEventData(e,e.x0,e.y0);a._simulateTouchEvent("touchstart",0,r,s);var u=i.getLongHoldTime()+100;setTimeout(function(){r=a._createEventData(e,e.x1,e.y1),a._simulateTouchEvent("touchmove",0,r,s),setTimeout(function(){a._simulateTouchEvent("touchend",0,r,s),n&&n()},500)},u)},simulateSwipe:function(e,t,i,n){var o=this.getViewer(n);this._applyCtx(t,o),this._warmupPicking(o);var s=this,a=s._createEventData(e,e.x0,e.y0);s._simulateTouchEvent("touchstart",0,a,o);setTimeout(function(){a=s._createEventData(e,e.x1,e.y1),s._simulateTouchEvent("touchmove",0,a,o),setTimeout(function(){s._simulateTouchEvent("touchend",0,a,o),i&&i()},500)},10)},doRepPick:function(t,i,n,o){var a=this.getViewer(o);i._noCtx||this._applyCtx(i,a);var r=a.canvas.getBoundingClientRect(),u=r.left+1*t.x*a.canvas.offsetWidth/a.canvas.width,h=r.top+1*t.y*a.canvas.offsetHeight/a.canvas.height,l=new s({viewer:a,pickingPosition:new e.Vector2(u,h)}).getJSON();n(l?JSON.stringify(l,null,4):null)},doScreenShot:function(t,i,n,o,s){var a="FullPixelChecker"===s.checkerMode,r=this.getViewer(o);i._noCtx||this._applyCtx(i,r);var h,l,c,d,p,f=r.devicePixelRatio,v={x:t.x,y:t.y},m={data:null,width:Math.round(t.width),height:Math.round(t.height),x:Math.round(v.x),y:Math.round(f*r.SCREEN_HEIGHT-(v.y+t.height))},g=r.renderer.ToneMappingEffect,_=e.__QA_AUTOMATION_MASK__;a?l={AntiAliasing:!1}:(c=r.pPicking.displayHL,r.setPrePicking({displayHL:!1}),function(e){var t=new Map;return e.renderer.effectStatusMap.forEach(function(e,i,n){"ToneMapping"!==i&&t.set(i,e)}),t}(r),h=r.getVisuAppearanceMode(),l=function(e){var t={};return Object.entries(e._viewerEffectSettings.settings).forEach(e=>{var i=e[0],n=e[1];n.hasOwnProperty("contentChecker")&&(t[i]=n.contentChecker)}),t}(r),p=g&&g._getQAParams(),g&&g._applyQAParams({tonemapping:1,gamma:2.2,brightness:0,autoExposure:null,colorGrading:null,power:0}),this.deactivateAmbience(r),r.setVisuAppearanceMode(e.DefaultAppearanceMode.__QA_AUTOMATION__),r.renderer.setBackgroundColor("#030340",1),d=r.infinitePlane,r.displayInfinitePlane(!1),e.__QA_AUTOMATION_MASK__=e.GeomTypeEnum.FACE|e.GeomTypeEnum.UNKNOWN_0D|e.GeomTypeEnum.UNKNOWN_1D|e.GeomTypeEnum.UNKNOWN_2D|e.GeomTypeEnum.UNKNOWN,s.displayEdges&&(e.__QA_AUTOMATION_MASK__|=e.GeomTypeEnum.SMOOTH_EDGE|e.GeomTypeEnum.SHARP_EDGE),s.displayWires&&(e.__QA_AUTOMATION_MASK__|=e.GeomTypeEnum.WIRE_EDGE|e.GeomTypeEnum.BOUNDARY_POINT|e.GeomTypeEnum.SHARP_POINT|e.GeomTypeEnum.SMOOTH_POINT),s.displayRefPlanes&&(e.__QA_AUTOMATION_MASK__|=e.GeomTypeEnum.INFINITE_FACE),s.displayAxis&&(e.__QA_AUTOMATION_MASK__|=e.GeomTypeEnum.AXIS_SYSTEM),s.displayPoints&&(e.__QA_AUTOMATION_MASK__|=e.GeomTypeEnum.FREE_POINT)),r.internalSceneGraph.robotRoot.setVisibility(!1),r.renderToTarget(m,r.currentViewpoint,!0,l,!0),r.internalSceneGraph.robotRoot.setVisibility(!0),a||(e.__QA_AUTOMATION_MASK__=_,r.displayInfinitePlane(d),r.setVisuAppearanceMode(e.DefaultAppearanceMode[h]),this.restoreAmbience(r),g&&g._applyQAParams(p),r.setPrePicking({displayHL:c}));var w=document.createElement("canvas");w.width=t.width,w.height=t.height;for(var y=(i=w.getContext("2d")).getImageData(0,0,t.width,t.height),b=y.data,T=0;T<y.height;T++)for(var x=0;x<y.width;x++){var S=u(x,T,y.width,y.height,!1),E=u(x,T,m.width,m.height,!0);b[4*S]=m.data[4*E],b[4*S+1]=m.data[4*E+1],b[4*S+2]=m.data[4*E+2],b[4*S+3]=m.data[4*E+3]}i.putImageData(y,0,0),n(w.toDataURL())},_createEventData:function(e,t,i){return{x:parseFloat(void 0!==t?t:e.x),y:parseFloat(void 0!==i?i:e.y),button:e.button||0}},getViewer:function(e){var t=1/0,i=null;return a.singleton.viewerList.forEach((n,o)=>{(!e&&o<t||e&&e===n.pageObjectName)&&(t=o,i=n)}),i},_applyCtx:function(e,t){e.version?this._applyCtxV1(e,t):this._applyCtxV0(e,t),t.animate()},_applyCtxV0:function(i,n){n._pageObjectData||(n._pageObjectData=new t,n._pageObjectData.devicePixelRatio=n.devicePixelRatio),this._applyDevicePixelRatio({},n),i.size&&(n._pageObjectData.setSize(parseInt(i.size.width),parseInt(i.size.height)),n.render()),i.freeZone&&n._pageObjectData.setFreeZone(i.freeZone);var o=function(t){var i,n,o={};for(i in t)void 0!==(n=t[i]).x&&void 0!==n.y&&void 0!==n.z?o[i]=new e.Vector3(parseFloat(n.x),parseFloat(n.y),parseFloat(n.z)):o[i]=n;return o}(i.viewpoint);o.duration=0,n.currentViewpoint.moveTo(o)},_applyCtxV1:function(i,n){n._pageObjectData||(n._pageObjectData=new t,n._pageObjectData.devicePixelRatio=n.devicePixelRatio),this._applyDevicePixelRatio(i.support,n),i.support.size&&(n._pageObjectData.setSize(parseInt(i.support.size[0]),parseInt(i.support.size[1])),n.render());var o=i.support.freeZone;i.support.freeZone&&n._pageObjectData.setFreeZone({offsetX:o[0],offsetY:o[1],offsetWidth:o[2],offsetHeight:o[3]});var s=function(t){var i,n,o={};for(i in t)3===(n=t[i]).length?o[i]=new e.Vector3(parseFloat(n[0]),parseFloat(n[1]),parseFloat(n[2])):o[i]=n;return o}(i.viewpoint);s.duration=0;var a=n.currentViewpoint,r=parseInt(i.viewpoint.projectionType);r!==n.currentViewpoint.projectionType&&n.currentViewpoint.setProjectionType(r),0===r?a.camera.fov=parseFloat(i.viewpoint.fov):(a.camera.top=parseFloat(i.viewpoint.top),a.camera.bottom=parseFloat(i.viewpoint.bottom),a.camera.left=parseFloat(i.viewpoint.left),a.camera.right=parseFloat(i.viewpoint.right)),n.currentViewpoint.moveTo({sightDirection:s.sightDirection,upDirection:s.upDirection,eyePosition:s.eyePosition,distanceToTarget:s.distanceToTarget})},_applyDevicePixelRatio:function(e,t){if(e.devicePixelRatio||(e.devicePixelRatio=1),e.devicePixelRatio!==t.devicePixelRatio)throw console.log("FATAL: devicePixelRatio is not the same as the one used when writing the script.."),new Error("incompatible devicePixelRatio")},_simulateEvent:function(e,t,i){var o=document.createEvent("MouseEvents");o.initEvent(e,!0,!0);var s=i.canvas.getBoundingClientRect(),a=s.left+1*t.x*i.canvas.offsetWidth/i.canvas.width,r=s.top+1*t.y*i.canvas.offsetHeight/i.canvas.height,u=t.keys||0,h=n.integerToModifierKeys(u);o.initMouseEvent(e,!0,!0,window,1,a,r,a,r,h.ctrlKey,h.altKey,h.shiftKey,h.metaKey,t.button,null),o.po_x=a,o.po_y=r,i.canvas.dispatchEvent(o)},_simulateTouchEvent:function(e,t,i,n){i.x=Math.round(i.x),i.y=Math.round(i.y);var o,s=n.canvas.getBoundingClientRect(),a=s.left+1*i.x*n.canvas.offsetWidth/n.canvas.width,r=s.top+1*i.y*n.canvas.offsetHeight/n.canvas.height,u=document.createEvent("UIEvent");u.initUIEvent(e,!0,!0,window,1),u.touches=[],u.changedTouches=[];var h=this.touchData,l=n.canvas;for(var c in"touchstart"===e?(o={clientX:i.x,clientY:i.y,identifier:t,target:l},h.fingers[h.touchID]=o,h.nbFingers++):"touchend"===e?((o=h.fingers[t]).clientX=i.x,o.clientY=i.y,h.fingers[t]=null,h.nbFingers--):((o=h.fingers[t]).clientX=i.x,o.clientY=i.y),o&&(o.po_x=a,o.po_y=r),h.fingers)null!==h.fingers[c]&&u.touches.push(h.fingers[c]);u.changedTouches.push(o),u._simul=!0,l.dispatchEvent(u)},_simulateKeyboardEvent:function(e,t,i){document.createEvent("KeyboardEvent");var o,s,a,r,u,h,l,c,d=t.keys||0,p=n.integerToModifierKeys(d);o=e,s=t.key,a=t.keyCode,r=p.ctrlKey,u=p.shiftKey,h=p.altKey,l=i.canvas,!o||!s&&null==a||("function"==typeof window.KeyboardEvent?(c=new window.KeyboardEvent(o,{key:s,keyIdentifier:s,bubbles:!0,which:a,keyCode:a,ctrlKey:r,shiftKey:u,altKey:h}),Object.defineProperty(c,"key",{get:function(){return s}}),Object.defineProperty(c,"keyCode",{get:function(){return a}}),Object.defineProperty(c,"which",{get:function(){return a}})):(c=document.createEvent("KeyboardEvent"),Object.defineProperty(c,"key",{get:function(){return s}}),Object.defineProperty(c,"keyCode",{get:function(){return a}}),Object.defineProperty(c,"which",{get:function(){return a}}),c.initKeyboardEvent(o,!0,!0,null,s,0,!1,!1,!1)),l?l.dispatchEvent(c):document.dispatchEvent(c))},deactivateAmbience:function(e){e._saveAmbience={ground:e.ambience.getGround().isActivated(),sphereEnv:e.ambience.getBackground().isActivated(),grid:!!e.grid&&e.grid.visible,smallPlane:!!e.infPlaneSmall&&e.infPlaneSmall.visible,infPlane:!!e.infPlane&&e.infPlane.visible,bgColor:e.ambience.getBackgroundColor(),bgAlpha:e.ambience.getBackgroundAlpha(),LiSPSM:!!e.directionalLight&&e.directionalLight.LiSPSM},e._saveAmbience.ground&&e.ambience.getGround().setActivated(!1),e._saveAmbience.sphereEnv&&e.ambience.getBackground().setActivated(!1),e._saveAmbience.grid&&e.setGrid(!1),e.renderer.setBackgroundColor(0,0),e.ambience.update()},restoreAmbience:function(e){e.ambience.getGround().setActivated(e._saveAmbience.ground),e.ambience.getBackground().setActivated(e._saveAmbience.sphereEnv),e._saveAmbience.grid&&e.setGrid(!0),e.renderer.setBackgroundColor(e._saveAmbience.bgColor.getHex(),e._saveAmbience.bgAlpha),e.ambience.update()},_warmupPicking:function(t){var i=t.getMousePosition(new e.Vector2(0,0));t.pick(i,"mesh",!0)}};function u(e,t,i,n,o){return o?(t=n-t,i*Math.floor(t-1)+Math.floor(e)):i*Math.floor(t)+Math.floor(e)}return window.debugWebGLV6Viewer.touchTap=function(e,t){r.simulateTap(e,t)},window.viewerPOEngine=r,r}),define("DS/VisuTools/NodeCounter",["DS/VisuTools/CounterNode","DS/CoreEvents/Events"],function(e,t){function i(i,n){var o=this;this._activated=!0,this.viewer=i,this.color=n,this.counterNode=new e(i,function(e,t){return{x:200*o.viewer.devicePixelRatio/e-1,y:.9}},6),this.viewer.internalSceneGraph.robotRoot.addChild(this.counterNode),this.counterNode.setRenderPasses(["robotOrtho"]),this.token=i.currentViewpoint.onMove(this.counterNode.onViewpointChange.bind(this.counterNode)),n&&this.setColor(n),this.text=null,this.sceneGraphUpdated=!0,this.onSceneGraphUpdateEvent=t.subscribe({event:"/VISU/onSceneGraphUpdate"},function(e){o.sceneGraphUpdated=!0}),this.updateText()}return i.prototype.setColor=function(e){this.counterNode.setColor(e)},i.prototype.countToString=function(e){var t=[],i=0;for(key in e)0!==key.indexOf("*")&&(t.push(key+": "+e[key].nodes+" ("+e[key].occurrences+")"),i+=e[key].nodes);t.sort();var n=[],o=0;for(key in e)0===key.indexOf("*")&&(n.push(key+": "+e[key].nodes),o+=e[key].nodes);n.sort();var s="";return s+=t.join("\n"),s+="\n",s+="-- TOTAL: "+i+" --\n",n.length>0&&(s+="\n",s+=n.join("\n"),s+="\n",s+="-- OVERALL TOTAL: "+(o+i)+" --\n"),s},i.prototype.buildText=function(){var e={},t={},i=this.viewer.internalSceneGraph.root,n=0;function o(e){var t;for(n++,t=0;t<e.length;t++)e[t].traverse(s);n--}function s(i){if(!e[i.id]){e[i.id]=!0;var s=i.getNodeType(),a=(n>0?"*":"")+s;t.hasOwnProperty(a)||(t[a]={nodes:0,occurrences:0}),t[a].nodes++,t[a].occurrences+=i._occurrences.length,"LODNode3D"===s&&(0!==i.refined&&-1!==i.refined||o(i._lodChildren),1!==i.refined&&-1!==i.refined||o(i._representationNodes))}}return i.traverse(s),this.countToString(t)},i.prototype.updateText=function(){if(requestAnimationFrame(this.updateText.bind(this)),this.sceneGraphUpdated&&this._activated){var e=this.buildText();e!==this.text&&(this.counterNode.setText(e),this.text=e,this.viewer.render())}this.sceneGraphUpdated=!1},i.prototype.activate=function(e){e=!!e,this.counterNode.setVisibility(e),this._activated=e,this.viewer.render()},i});