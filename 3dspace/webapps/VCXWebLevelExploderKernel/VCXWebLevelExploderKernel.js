define("DS/VCXWebLevelExploderKernel/VCXLevelExploderKernelServices",["UWA/Class","DS/Visualization/ThreeJS_DS","DS/ENOPAD3DViewer/utils/PAD3DViewerModelServices"],function(e,t,n){"use strict";return e.singleton({PRODUCT_TYPES:{INSTANCE:0,REFERENCE:1,INSTANCE_REP:2,REFERENCE_REP:3},init:function(){},_getStagesInfo:function(e){var t=[],n=this;!function e(r,s){for(var a=0,i=0;i<r.children.length;++i){var o=r.children[i];if(n.doesNodeHasProductTypeValue(o,n.PRODUCT_TYPES.INSTANCE_REP))0===s&&(t[s]||(t[s]=[]),t[s][a]=0,++a);else{var c=s;n.doesNodeHasProductTypeValue(o,n.PRODUCT_TYPES.INSTANCE)&&(t[s]||(t[s]=[]),t[s][a]=0,++c,++a),e(o,c)}}}(e,0);for(var r=[],s=0,a=0;s<t.length;++a)1===t[s].length?(t.splice(s,1),r.push(a)):++s;return{nbOfStages:Math.min(t.length,6),discardedStagesIdxs:r}},updateMapWithTranslationsVectors:function(e,n){for(var r in e)if(e.hasOwnProperty(r)){var s=e[r].initCenterPosInWCS,a=e[r].pathElement.getParentPath().getBoundingSphere(n).center,i=(new t.Vector3).subVectors(s,a).multiplyScalar(2);e[r].maxTranslationVect=i.clone()}return e},getLeafGeometriesPathsUnderPath:function(e){var t=this,n=[];return function e(r){var s=t.getDirectDescendantInstancePaths(r);if(0===s.length)t.doesNodeHasProductTypeValue(r.getLastElement(),t.PRODUCT_TYPES.INSTANCE)&&n.push(r);else for(var a=0;a<s.length;++a)e(s[a])}(e),n},getDirectDescendantInstancePaths:function(e){var t=[],n=e.getLastElement();if(this.doesNodeHasProductTypeValue(n,this.PRODUCT_TYPES.INSTANCE_REP))return t;var r=n.children;if(0===r.length)return t;var s=e.clone(),a=n.children[0];this.doesNodeHasProductTypeValue(a,this.PRODUCT_TYPES.REFERENCE)&&(r=n.children[0].children,s.addElement(a));for(var i=0;i<r.length;++i){var o=r[i];if(this.doesNodeHasProductTypeValue(o,this.PRODUCT_TYPES.INSTANCE)){var c=s.clone();c.addElement(o),t.push(c)}}return t},doesNodeHasProductTypeValue:function(e,t,r){var s;if("number"!=typeof t)s=this.getNodeType(e);else if(n&&(n.isInstance(e)||n.isReference(e)||n.isRepInstance(e)))switch(t){case this.PRODUCT_TYPES.INSTANCE:s=n.isInstance(e);break;case this.PRODUCT_TYPES.REFERENCE:s=n.isReference(e);break;case this.PRODUCT_TYPES.INSTANCE_REP:s=n.isRepInstance(e);break;default:return console.warn("case 'iProductType === "+t+"' not supported"),!1}else{var a=this.getNodeType(e),i=a&&a.toLowerCase();if(!i)return;switch(t){case this.PRODUCT_TYPES.INSTANCE:s=i.indexOf("instance")>-1&&-1===i.indexOf("rep");break;case this.PRODUCT_TYPES.REFERENCE:s=i.indexOf("reference")>-1&&-1===i.indexOf("rep");break;case this.PRODUCT_TYPES.INSTANCE_REP:s=i.indexOf("instance")>-1&&i.indexOf("rep")>-1;break;default:return console.warn("case 'iProductType === "+t+"' not supported"),!1}}return r?!s:Boolean(s)},getNodeType:function(e){var t=n.getNodeType(e);return t||(t=e.productType)}})});