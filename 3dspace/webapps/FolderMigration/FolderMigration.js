define("DS/FolderMigration/FolderMigration",["DS/FolderEditor/utils/UserPreference","DS/FolderEditor/utils/FolderEditorUtil","DS/PADUtils/PADUtilsServices","DS/PADUtils/PADProbes","text!DS/FolderEditor/assets/FolderEditorColumns.json"],function(e,n,t,i,r){var o=JSON.parse(r);function a(e){if(e){var n={},t=function e(n){var t=!1,i={};for(var r in n){var o=r,a=n[r];!0!==a.e?o="_X_"+r:t=!0;var d=e(a.c);(!0===a.e||d.oneIsExpanded)&&(i[o]=d.elements),t=t||d.oneIsExpanded}return{oneIsExpanded:t,elements:i}}(e.root.c);t.oneIsExpanded&&(n={root:t.elements}),widget.setValue("folderTreeStructure",JSON.stringify(n))}}function d(n){return new Promise(function(i){if(s()>=1||n<1)return i();var r=widget.getValue("folderTreeStructure");r?r.indexOf('"e"')>=0?(a(r=m(r,{})),i()):i():e.get("folderTreeStrucure - "+t.getPlatformId(),function(e){a(e),i()},!0)})}function s(){var e=widget.getValue("vMigration");return e||0}function u(){var e,t,i=widget.getValue("FolderCusto_treelistview"),r=null;s()<3?i&&(r=m(decodeURIComponent(i))):r=i?(e=i,t=n.jsonUnzip(e),value=m(t,null),value):null;return r}function l(e,n,t,i){return new Promise(function(r){if(!e||n>=i||t<i||!e.columnsOptimized)return r();var o=["ds6wg:revision","ds6w:reserved"];e.columnsOptimized.forEach(function(e){e.minWidth&&!e.width&&(50!=e.minWidth||o.indexOf(e.dataIndex)>=0)&&(e.width=e.minWidth),delete e.minWidth}),r()})}function c(e,n,t,i){return new Promise(function(r){if(!e||n>=i||t<i||!e.columnsOptimized)return r();var a=o.attributes,d={};a.forEach(e=>{var n=e.dataIndex;(n=n||e.ds6w)&&(d[n]=e)}),o.order.forEach((n,t)=>{var i=!1,r=d[n];if(r){for(var o=0;o<e.columnsOptimized.length;++o){var a=e.columnsOptimized[o];if(a.dataIndex===n){r.customisation&&!a.customisation&&(a.customisation=r.customisation),void 0!==r.sortableFlag&&(a.sortableFlag=r.sortableFlag),i=!0;break}}if(!i){var s=r;s.dataIndex=n,s.visibleFlag=!1,e.columnsOptimized.splice(t,0,s)}}}),r()})}function f(e,n,t,i){return new Promise(function(r){if(!e||n>=i||t<i)return r();if(e.rowsHeader=!1,delete e.custoFromTree,columns=e.columnsOptimized,columns){var o=[];columns.forEach(function(e){if("bi_color"!==e.dataIndex){var n={width:e.width,editableFlag:!1,customisation:e.customisation,dataIndex:e.dataIndex};e.xnav_options&&(n.kind=e.xnav_options.kind,n.kind="date"==n.kind?"datetime":n.kind,n.typeRepresentation="integer"===n.kind?"string":n.kind,"ds6w:reserved"===e.dataIndex&&(n.typeRepresentation="functionIcon"),n.ds6w=e.xnav_options.ds6w,!0===e.xnav_options.tree&&(n.tree=!0,n.editionPolicy="EditionOnDoubleClick")),!0===e.isHidden&&(n.visibleFlag=!1);for(var t in["kind","typeRepresentation","ds6w","tree","editionPolicy","visibleFlag"].forEach(t=>{void 0===n[t]&&void 0!==e[t]&&(n[t]=e[t])}),n)void 0===n[t]&&delete n[t];o.push(n)}}),e.columnsOptimized=o}r()})}function m(e,n){var t=n=n||null;try{t=e?JSON.parse(e):n}catch(e){t=n}return t}return{migrate:function(e){return new Promise(function(i,r){var o=d(e),a=function(e){return new Promise(function(t){var i=u(),r=s();l(i,r,e,2).then(()=>{f(i,r,e,7).then(()=>{c(i,r,e,7).then(()=>{i?n.setContentViewPreference(i,!1,e).then(t):t()})})})})}(e),v=function(e){return new Promise(function(i){if(s()>=3||e<3)return i();new Promise(function(e){t.app_initialization(function(){require(["DS/PADUtils/PADWSAccess"],function(t){t.getMyAppsTemplate({preference_name:widget.getValue("x3dAppId")+"_template",onComplete:function(t){var i=null,r=!1;t.length>0&&(i=m(decodeURIComponent(t)))&&(r=!0,n.setContentViewPreference(i,"only").then(e)),r||e()},onFailure:e})})})}).then(i)})}(e);Promise.all([a,o,v]).then(function(){widget.setValue("vMigration",e),i()})}.bind(this))},migratePreferences:function(e,t){var i=e.preference;return new Promise((r,o)=>{(function(e,n){return new Promise(function(t){var i=e.version?e.version:0;l(e,i,n,7).then(()=>{f(e,i,n,7).then(()=>{c(e,i,n,7).then(t)})})})})(i,t).then(()=>{n.setContentViewPreference(i,!0===e.template&&"only").then(()=>{r(i)}).catch(o)}).catch(o)})}}});