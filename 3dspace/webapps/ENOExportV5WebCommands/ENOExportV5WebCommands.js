define("DS/ENOExportV5WebCommands/utils/ExportV5connexionMngtUtil",["UWA/Core","UWA/Promise","DS/WAFData/WAFData","DS/WidgetServices/securityContextServices/SecurityContextServices","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","i18n!DS/ENOExportV5WebCommands/assets/nls/ExportV5Cmd"],function(e,t,o,i,n,r){"use strict";var s=null,a=null;return{GetCurrentSecurityContext:function(){return new t(function(e,t){i.getInstance().getSecurityContext({onSuccess:function(t){a=t.SecurityContext.replace("ctx::",""),e()},onFailure:function(){var e={message:r.error.security_context_fail};t(e)}})})},get3DSpaceUrl:function(){return this.getPlatformURL("3DSpace")},getPlatformId:function(){return"undefined"!=typeof widget&&widget.getValue("x3dPlatformId")?widget.getValue("x3dPlatformId"):"OnPremise"},retrievePlatformUrl:function(){return new t(function(e,t){null===s?n.getPlatformServices({onComplete:function(t){s=t,e()},onFailure:function(e){t(e)}}):e()})},getTenantInfo:function(e){for(var t={},o=0;o<s.length;o++)if(s[o].platformId===e){t=s[o];break}return t},getPlatformURL:function(e){if(!UWA.is(s,"array"))throw new Error("Platform services not initialize yet");var t=this.getPlatformId(),o=this.getTenantInfo(t);if(void 0===o[e])throw console.error("No "+e+" URL available for this tenant."),new Error("Unknown service "+e);return o[e]},SendServerRequest:function(e){var t=this,i={};i.method=e.webService.verb,t.GetCurrentSecurityContext().then(function(){i.headers={Accept:"application/json","Content-Type":"application/json",SecurityContext:"ctx::"+a},i.type="json",i.proxy="passport",i.timeout=void 0!==e.timeout?e.timeout:3e5,i.onComplete=e.callback.onComplete,i.onFailure=e.callback.onFailure;var n=e.data;i.data=JSON.stringify(n),t.retrievePlatformUrl().then(function(){var n=t.get3DSpaceUrl();o.authenticatedRequest(n+e.webService.url,i)})}).catch(function(t){e.callback.onFailure(t)})}}}),define("DS/ENOExportV5WebCommands/commands/ExportV5PSECmd",["DS/ApplicationFrame/Command","i18n!DS/ENOExportV5WebCommands/assets/nls/ExportV5Cmd","DS/PADUtils/PADContext","DS/PADUtils/PADUtilsServices","DS/PADUtils/PADSettingsMgt","DS/Utilities/UUID"],function(e,t,o,i,n,r){"use strict";return e.extend({_check_roots:function(){o.get().getPADTreeDocument().getRoots().length>0?this.enable():this.disable()},_check_added_roots:function(e){o.get().getPADTreeDocument();0===e.data.nb_root?this.disable():this.enable()},init:function(e){this._parent(e);var t=o.get(),i=t.options.model?t.options.model:t.getPADTreeDocument();if(UWA.Utils.Client.Platform.ios)this.disable();else{this._check_roots();var n=this._check_roots.bind(this);i.addEventListener("addChild",n),i.addEventListener("removeChild",n),this._check_roots(),t.addEvent("onRootsVisibility",this._check_roots.bind(this)),t.getPADTreeDocument().getModelEvents().subscribe({event:"onRootAdded"},this._check_added_roots.bind(this))}},_getSelectedNodesId:function(e){for(var t=[],o=0;o<e.length;o++){var i=e[o];t.push(i.getID())}return t},_buildRequestMessage:function(e,t){for(var o={requests:[]},i=[],n=[],s=0;s<t.length;s++){var a=t[s],l=a.getOccurencePath(),d=a.getRoot(),c=i.indexOf(d.getID());if(-1===c){i.push(d.getID());var u=[l];n.push(u)}else n[c]&&n[c].push(l)}var m={V1:{}};for(s=0;s<i.length;s++){var p,h={};h.rootId=i[s],h.selection=n[s];var f=null!=e.HasFilter;if(f){var g=e.HasFilter(i[s]);UWA.is(g.hasFilter)&&!0===g.hasFilter?UWA.is(e.GetFilterSpec(i[s],m).CVQuery)&&(p=e.GetFilterSpec(i[s],m).CVQuery):f=!1}f||(p={union:{expand:[{root_path_physicalid:n[s],no_type_filter_rel:["XCADBaseDependency"],"q.iterative_filter_query_bo":'[ds6w:globalType]:"ds6w:Document" OR [ds6w:globalType]:"ds6w:Part"'}]}});p.select_bo=["physicalid","ds6w:label","ds6w:type","ds6w:cadMaster"],p.select_rel=["physicalid"],p.label="ExpandForWebExchanges_"+r.v4(),h.msgExpand=p,o.requests.push(h)}return console.log(o),o},execute:function(){var e=this,t=o.get(),i=t.options.model?t.options.model:t.getPADTreeDocument();require(["DS/ENOExportV5WebCommands/commands/ExportV5GenericCmd"],function(o){var n=i.getSelectedNodes(),r=e._buildRequestMessage(t,n);new o({command_id:e.options.ID,render_div:".xnav_viewmain",disable_cmd:()=>e.disable(),enable_cmd:()=>e.enable(),data:{requests:r.requests}})})}})}),define("DS/ENOExportV5WebCommands/views/_EV5CustomizeView",["css!DS/UIKIT/UIKIT","css!DS/ENOExportV5WebCommands/ENOExportV5WebCommands","i18n!DS/ENOExportV5WebCommands/assets/nls/ExportV5Cmd","text!DS/ENOExportV5WebCommands/assets/catrsc/ExportV5Locations.json","UWA/Controls/Abstract","UWA/Class/Events","UWA/Promise","DS/WAFData/WAFData","DS/PADUtils/PADUtilsServices","DS/Windows/Panel","DS/UIKIT/Modal","DS/Controls/ButtonGroup","DS/Controls/Button","DS/Controls/Toggle","DS/Controls/LineEditor","DS/Controls/Loader","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/Controls/ComboBox","DS/Controls/Expander","DS/Core/PointerEvents","DS/Notifications/NotificationsManagerViewOnScreen","DS/Notifications/NotificationsManagerUXMessages","DS/Utilities/UUID","DS/i3DXCompassServices/i3DXCompassPubSub"],function(e,t,o,i,n,r,s,a,l,d,c,u,m,p,h,f,g,_,b,v,C,S,E,x,y){"use strict";return n.extend(r,{name:"ev5customizeview",_command_id:"",_applyOnlyToThisApp:!1,init:function(e){this._parent(e),UWA.is(e.render_div)&&(this.render_div=document.querySelector(e.render_div));var t=this;e.controller&&(this.controller=e.controller),require(["DS/ENOFloatingPanel/ENOFloatingPanel"],function(i){t._command_id=e._command_id,t.elements.useDLNames=!1,t.model=e.model,t.elements.container=t._createContent(),t.elements.floatingpanel=new i({className:t.name,body:t.elements.container,footer:t._buildFooter(),title:o.title,overlay:!0,closable:!0,animate:!0,resizable:!0,visible:!0,events:{onClose:function(){t.controller._destroyCmd()}}}),t.elements.floatingpanel.inject(t.render_div)})},_isLineEditorPathValid:function(){var e=this.elements.lineEditor.getContent().getChildren()[0].value;return this._isPathValid(e)},_isSelectionValid:function(){return 1==this.elements.useDLNames?-1!=this.elements.combobox.selectedIndex:this._isLineEditorPathValid()},_isPathValid:function(e){if(e){if(e=e.trim(),navigator.platform.indexOf("Win")>-1){return!!/^(?:[a-z]:|\\\\[a-z0-9_.$‚óè-]+)\\(?:[^\\\/:*?"<>|\r\n]+\\)*[^\\\/:*?"<>|\r\n]*$/.test(e.toLowerCase())}return!!/[^\0]+/.test(e)}return!1},_onPathChange:function(){this.elements.launchbutton.disabled=!this._isLineEditorPathValid()},_expandCompleted:function(){this.myLoader.off()},_createContent:function(){var e=this,t=UWA.createElement("div",{class:"ev5customizeview_content"}),n=UWA.createElement("div",{class:"ev5customizeview_body"}).inject(t);n.setAttribute("id","ev5customizeview_body");var r=UWA.createElement("h5",{content:o.option_path.label});n.appendChild(r),i=UWA.is(i,"string")?JSON.parse(i):i;var s=i.paths.length,a=i.manual,l=localStorage.getItem("ExportV5path");if(0===s)if(!0===a){var d="";d=l&&this._isPathValid(l)?l:i.defaultLocation,e.elements.lineEditor=new h({placeholder:o.option_path.option_text,requiredFlag:!0,value:d}),e.elements.lineEditor.addEventListener("uncommittedChange",e._onPathChange.bind(this)),n.appendChild(e.elements.lineEditor.getContent())}else e._displayNotification("error",o.error.title,o.error.emptyDefinedPath),e.controller._destroyCmd();else{var c,u,C=[],S=[],E=[],x=!1,y=new g({shouldBeSelected:function(e){return"section"!==e.options.comboBoxSemantics}}),D=new _({label:o.option_path.predefined_paths,comboBoxSemantics:"section"});y.addRoot(D);var w,N=-1,A=1,P=0;if(i.paths.forEach(function(t){c=t.name,u=t.path,void 0===t.name||""===c?void 0!==t.path&&""!==u?(e._displayNotification("error",o.error.title,o.error.emptyPathIdentifier),e.controller._destroyCmd()):P++:UWA.Array.detect(C,function(e,t){return e==c})?(E.push(c),x=!0):e._isPathValid(u)?(c==l?N=A:u==l&&-1==N&&(N=A),D.addChild(new _({label:c,comboBoxSemantics:"subsection"})),A++,C.push(c),0):(S.push(c),x=!0)}),0==C.length)w=o.error.emptyDefinedPath,x=!0;else if(P>0)w=o.error.emptyobject,x=!0;else if(E.length>0)w=o.replace(o.error.identifierUnicity,{namesList:E});else if(S.length>0)w=o.replace(o.error.pathInvalid,{namesList:S});else{var V=1;if(-1!==N&&(V=N),a){var U=new _({label:o.option_path.added_path,comboBoxSemantics:"section"});y.addRoot(U),this._isPathValid(l)&&(U.addChild(new _({label:l,comboBoxSemantics:"subsection"})),V=y.getAllDescendants().length-1)}var W=new UWA.Element("div",{class:"ev5-path-container"}).inject(n);if(y.expandAll(),e.elements.combobox=new b({elementsTree:y,selectedIndex:V}),W.appendChild(e.elements.combobox.getContent()),e.elements.useDLNames=!0,e.elements.combobox.addEventListener("change",function(){e.elements.launchbutton.disabled=!1}),a){var I=new UWA.Element("div",{class:"expander-container"}),O=new h({placeholder:o.option_path.option_text,value:i.defaultLocation}).inject(I),L=!this._isPathValid(i.defaultLocation),M=new m({domId:"ev5-add-button",label:o.option_path.button_add,emphasize:"primary",touchMode:!0,disabled:L,allowUnsafeHTMLLabel:!1}).inject(I);O.addEventListener("uncommittedChange",function(){e._isPathValid(O.getContent().getChildren()[0].value)?M.disabled=!1:M.disabled=!0});var F=new v({orientation:"horizontal",height:"22px",body:I,allowUnsafeHTMLHeader:!1}).inject(W);M.addEventListener("buttonclick",function(){y.getRoots()[1].getAllDescendants().map(e=>e.getLabel()).includes(O.value)||(y.getRoots()[1].addChild(new _({label:O.value,comboBoxSemantics:"subsection"})),y.expandAll(),e.elements.combobox.selectedIndex=e.elements.combobox.elementsTree.getAllDescendants().length-1,F.getContent().collapse)})}}x&&(e._displayNotification("error",o.error.title,w),e.controller._destroyCmd())}var T=!0;return localStorage.getItem("ExportV5copy")&&(T="false"!=localStorage.getItem("ExportV5copy")),e.elements.toggleCopy=new p({label:o.option_conflict.option_copy,checkFlag:T,allowUnsafeHTMLLabel:!1}),n.appendChild(e.elements.toggleCopy.getContent()),this.myLoader=new f({text:o.loading,showButtonFlag:!1,height:"20px",fadeDuration:100}).inject(t),this.myLoader.on(),t},_getSelectedPath:function(){if(1==this.elements.useDLNames){var e,t=this.elements.combobox.value;return this._isPathValid(t)&&(e=t),i.paths.forEach(function(o){o.name==t&&(e=o.path)}),e=e.trim()}return t=(t=this.elements.lineEditor.value).trim()},_displayNotification:function(e,t,o){window.notifs=E,S.setNotificationManager(window.notifs);var i={level:e,title:t,message:o,sticky:!1};window.notifs.addNotif(i)},_buildFooter:function(){var e=this,t=UWA.createElement("div",{class:"footerModal"}),i=!e._isSelectionValid();e.elements.launchbutton=new m({label:o.buttonExport,emphasize:"primary",touchMode:!0,disabled:i,allowUnsafeHTMLLabel:!1}),e.elements.launchbutton.addEventListener("buttonclick",function(){e._LaunchExport()}),t.appendChild(e.elements.launchbutton.getContent());var n=new m({label:o.buttonCancel,emphasize:"secondary",touchMode:!0,allowUnsafeHTMLLabel:!1});return n.addEventListener("click",function(){e.controller._destroyCmd()}),n.inject(t),t},_LaunchExport:function(){this._isSelectionValid()?(document.getElementById("ev5customizeview_body").style.display="none",this.model.updatePath(this._getSelectedPath()),this.model.updateCopyOption(this.elements.toggleCopy.checkFlag),localStorage.setItem("ExportV5copy",this.elements.toggleCopy.checkFlag),this.elements.launchbutton.disabled=!0,0==this.elements.useDLNames?localStorage.setItem("ExportV5path",this.model.path):localStorage.setItem("ExportV5path",this.elements.combobox.value),this.controller._sendExportRequest()):this._displayNotification("warning",o.warning.title_path,o.warning.empty_path)},destroy:function(){this.elements.floatingpanel.destroy()}})}),define("DS/ENOExportV5WebCommands/commands/ExportV5BECmd",["DS/ApplicationFrame/Command","DS/PADUtils/PADContext","DS/Utilities/UUID","DS/Notifications/NotificationsManagerViewOnScreen","DS/Notifications/NotificationsManagerUXMessages","DS/ENOExportV5WebCommands/utils/ExportV5connexionMngtUtil","i18n!DS/ENOExportV5WebCommands/assets/nls/ExportV5Cmd"],function(e,t,o,i,n,r,s){"use strict";var a=["physicalid","ds6w:label","ds6w:type","ds6w:cadMaster"],l=["physicalid"],d=["Workspace","Workspace Vault"];return e.extend({execute:function(){var e=this,i=t.get(),n=i.getSelectedNodes();1!=n.length||0!=Object.entries(n[0].options.grid).length?n.some(e=>d.includes(e.options.grid.type))?e._displayNotification("warning",s.warning.title,s["ExportV5.Msg.InvalidInput"]):new Promise(function(t,o){var i={data:{ids:n.map(e=>e.getID())},timeout:6e5,webService:{url:"/resources/ENOWebExchangesWSAPI/webExchanges_services/validate?tenant="+r.getPlatformId(),verb:"POST"},callback:{onComplete:function(i){var n=UWA.is(i,"string")?JSON.parse(i):i;if(n&&0!==Object.keys(n).length)if("success"===n.status)t();else{let t=n.msg;e._displayNotification("warning",s.warning.title,s[t])}else e._displayNotification("error",s.error.title,s.error.fetchFailed,s.error.fetchFailed_subtitle),o(s.error.fetchFailed)},onFailure:function(t){let i=t.msg+".Subtitle";e._displayNotification("error",s[t.msg],null,s[i]),o(t.message)},onTimeout:function(){e._displayNotification("error",s.error.title,s.replace(s.error.timeout,{seconds:6e5})),o(s.replace(s.error.timeout,{seconds:6e5}))}}};r.SendServerRequest(i)}).then(function(){require(["DS/ENOExportV5WebCommands/commands/ExportV5GenericCmd"],t=>{var n=function(e){for(var t={requests:[]},i={},n=0;n<e.length;n++){var r=e[n],s=r.getOccurencePath();i[d=r.getRoot().getID()]||(i[d]=[]),i[d].push(s)}for(var d in i){var c={};c.rootId=d,c.selection=i[d];var u={union:{expand:[{root_path_physicalid:c.selection,no_type_filter_rel:["XCADBaseDependency"],"q.iterative_filter_query_bo":'[ds6w:globalType]:"ds6w:Document" OR [ds6w:globalType]:"ds6w:Part"'}]}};u.select_bo=a,u.select_rel=l,u.label="ExpandForWebExchangesBE_"+o.v4(),c.msgExpand=u,t.requests.push(c)}return t}(i.getSelectedNodes());new t({command_id:e.options.ID,render_div:".FolderEditor_global_container",data:{requests:n.requests}})})},function(e){console.log(e)}):e._displayNotification("error",s.error.title,s.error.noSelection)},_displayNotification:function(e,t,o,r){window.notifs=n,i.setNotificationManager(window.notifs);var s={level:e,title:t,sticky:!1};null!==o&&(s.message=o),void 0!==r&&(s.subtitle=r),window.notifs.addNotif(s)}})}),define("DS/ENOExportV5WebCommands/commands/ExportV5GenericCmd",["UWA/Controls/Abstract","UWA/Promise","DS/Notifications/NotificationsManagerViewOnScreen","DS/Notifications/NotificationsManagerUXMessages","DS/i3DXCompassServices/i3DXCompassPubSub","i18n!DS/ENOExportV5WebCommands/assets/nls/ExportV5Cmd","DS/ENOExportV5WebCommands/utils/ExportV5connexionMngtUtil","DS/Utilities/UUID"],function(e,t,o,i,n,r,s,a){"use strict";var l={url:"/resources/ENOWebExchangesWSAPI/webExchanges_services/getExportOpenMessage",verb:"POST"};var d,c;return e.extend({init:function(e){this._parent(e),UWA.is(e.data)&&UWA.is(e.data.requests)&&0!=e.data.requests.length?(this.requestsMessage=e.data.requests,UWA.is(e.render_div)||(this.render_div=e.render_div),this._expandAll(),this._buildModel(),this.view=this._createView()):(this._displayNotification("error",r.error.title,r.error.noSelection),this.destroy())},_buildModel:function(){this.model={path:"",bCopy:!0,updatePath:function(e){this.path=e},updateCopyOption:function(e){this.bCopy=e}}},_createView:function(){var e=this;null!=e.options.disable_cmd&&e.options.disable_cmd(),require(["DS/ENOExportV5WebCommands/views/_EV5CustomizeView"],function(t){var o=new t({_command_id:e.options.ID,render_div:e.options.render_div,model:e.model,controller:e});e._view=o})},_displayNotification:function(e,t,n,r){window.notifs=i,o.setNotificationManager(window.notifs);var s={level:e,title:t,message:n,sticky:!1};void 0!==r&&(s.subtitle=r),window.notifs.addNotif(s)},_expandAll:function(){var e=this;d=!1,c="",new t(function(t,o){a.v4();var i={data:{requests:e.requestsMessage},timeout:6e5,webService:{url:l.url,verb:l.verb},callback:{onComplete:function(o){var i=UWA.is(o,"string")?JSON.parse(o):o;null!=i.status&&"failure"===i.status?(c=r.error.genericError,null!=i.msg&&null!=r[i.msg]?(c=r[i.msg],e._displayNotification("warning",r.error.expand_failed_title,r[i.msg])):e._displayNotification("error",r.error.expand_failed_title,r.error.genericError),e._destroyCmd()):i.results&&0!==i.results.length?(e.message_batch=i,e._view._expandCompleted(),d=!0,t()):(e._displayNotification("error",r.error.title,r.error.fetchFailed,r.error.fetchFailed_subtitle),e._destroyCmd())},onFailure:function(t){var o;if(t.message&&t.message.indexOf("Error:")&&t.message.indexOf("ResponseCode")){var i=t.message.substring(t.message.indexOf("ResponseCode")).split('"')[1];o="500"==i?r.error.expandIssue:"400"==i?r.error.code400:"401"==i?r.error.code401:r.error.genericError}e._displayNotification("error",r.error.expand_failed_title,o),c=t.message,e._destroyCmd()},onTimeout:function(){e._displayNotification("error",r.error.title,r.replace(r.error.timeout,{seconds:6e5})),c=r.replace(r.error.timeout,{seconds:6e5}),e._destroyCmd()}}};s.SendServerRequest(i)})},_sendExportRequest:function(){var e=this;if(d){var t={path:e.model.path,copy_if_conflict:e.model.bCopy,data:e.message_batch},o={widgetId:e._command_id,appId:"ENOEXV5_AP",fileName:"-file",fileContent:JSON.stringify(t)};n.subscribe("launchAppCallback",function(t){t&&t.widgetId===e._command_id&&("COMPLETE"===t.response?e._displayNotification("success",r.success.title,r.success.message):e._displayNotification("error",r.error.title,r.error.launchApp+r.replace(r.error.errorType,{errorID:t.response})),n.unsubscribe("launchAppCallback"),e._destroyCmd())}),n.publish("launchApp",o)}else e._displayNotification("error",r.error,r.error.launchApp+c),e._destroyCmd()},_destroyCmd:function(){null!=this.options.enable_cmd&&this.options.enable_cmd(),UWA.is(this._view)&&this._view.destroy(),this.destroy()}})});