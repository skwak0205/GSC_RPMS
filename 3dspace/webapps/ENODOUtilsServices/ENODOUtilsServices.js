define("DS/ENODOUtilsServices/DOServices",["UWA/Core","UWA/Promise","DS/WAFData/WAFData","DS/PlatformAPI/PlatformAPI","DS/WidgetServices/securityContextServices/SecurityContextServices","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/Notifications/NotificationsManagerViewOnScreen","DS/Notifications/NotificationsManagerUXMessages","i18n!DS/ENODOUtilsServices/assets/nls/enodo_notifications.json","text!DS/ENODOUtilsServices/assets/enodo_webservices.json"],function(e,t,n,i,o,r,a,c,s,l){"use strict";var u=JSON.parse(l),f=null;return{DownloadURL:function(e,t){var n=new XMLHttpRequest;n.open("POST",e),n.responseType="blob",n.onload=function(){if(window.navigator.msSaveBlob)window.navigator.msSaveBlob(n.response,t);else{var e=document.createElement("a");e.href=window.URL.createObjectURL(n.response),t&&(e.download=t),e.style.display="none",document.body.appendChild(e),e.click(),e=void 0}},n.send()},DownloadBinary:function(e,t){var n=new Blob([e],{type:"application/zip"}),i=document.createElement("a");t&&(i.download=t+".zip");let o=new FileReader;o.readAsDataURL(n),o.onload=function(){i.href=o.result,i.click()}},retrieveSelectionInfo:function(e,n,i){var o=this;return new t(function(t,r){var a={data:{physicalid:e,label:"FetchObjectInfo_DOSP",select_predicate:n},webService:{url:u.fetch.url,verb:u.fetch.verb},callback:{onComplete:function(e){var n=UWA.is(e,"string")?JSON.parse(e):e;t(i(n))},onFailure:function(e){r(e||new Error("Issue retrieving selection informations"))}}};o.SendServerRequest(a)})},GetCurrentSecurityContext:function(){return new t(function(e,t){o.getInstance().getSecurityContext({onSuccess:function(t){var n=t.SecurityContext.replace("ctx::","");e(n)},onFailure:function(){var e={message:s.error.security_context_fail};t(e)}})})},GetCurrentRole:function(){var e=this;return new t(function(t,n){e.GetCurrentSecurityContext().then(function(e){var n=e.split(".");t(n[0])},function(e){n(e)})})},GetCurrentUser:function(){return null==f&&(f=i.getUser()),f},getUserLogin:function(){var e=this.GetCurrentUser(),t="";return void 0!==e&&(t=e.login),t},get3DSpaceUrl:function(e){if(null==e)throw new Error("Platform services not initialize yet");return this.getPlatformURL("3DSpace",e)},getPlatformId:function(){return"undefined"!=typeof widget&&widget.getValue("x3dPlatformId")?widget.getValue("x3dPlatformId"):"OnPremise"},retrievePlatformUrl:function(){return new t(function(e,t){r.getPlatformServices({onComplete:function(t){e(t)},onFailure:function(e){t(e)}})})},getTenantInfo:function(e,t){for(var n={},i=0;i<t.length;i++)if(t[i].platformId===e){n=t[i];break}return n},getPlatformURL:function(e,t){if(!UWA.is(t,"array"))throw new Error("Platform services not initialize yet");var n=this.getPlatformId(),i=this.getTenantInfo(n,t);if(void 0===i[e])throw new Error("Unknown service "+e);return i[e]},_displayNotification:function(e,t,n){window.notifs=c,a.setNotificationManager(window.notifs);var i={level:e,title:t,message:n,sticky:!1};window.notifs.addNotif(i)},SendServerRequest:function(e){var t=this,i=this.getUserLogin(),o={};o.method=e.webService.verb,t.GetCurrentSecurityContext().then(function(r){o.headers={Accept:e.webService.hasOwnProperty("accept")?e.webService.accept:"application/json","Content-Type":"application/json","Accept-Language":widget.lang,SecurityContext:encodeURIComponent("ctx::"+r),SecurityToken:encodeURIComponent(i+"|ctx::"+r+"|"+widget.lang)},o.type=e.webService.hasOwnProperty("type")?e.webService.type:"json",o.proxy="passport",o.timeout=void 0!==e.timeout?e.timeout:3e5,o.onComplete=e.callback.onComplete,o.onFailure=e.callback.onFailure,o.onTimeout=void 0!==e.callback.onTimeout?e.callback.onTimeout:e.callback.onFailure;var a=e.data;o.data=JSON.stringify(a),t.retrievePlatformUrl().then(function(i){var r=t.get3DSpaceUrl(i);n.authenticatedRequest(r+e.webService.url,o)})}).catch(function(t){e.callback.onFailure(t)})}}});