define("DS/MPFShowroomComponent/GalleryDeleteModal",["UWA/Class/View","DS/UIKIT/Alert","DS/MPFServices/ObjectService","DS/MPFShowcaseItemModel/ShowcaseItemModel","DS/MPFView/ConfirmationModal","i18n!DS/MPFShowroomComponent/assets/nls/ShowroomComponent"],function(e,t,s,i,o,n){"use strict";const a=Object.freeze({ON_DELETE:"onDelete"}),r=e.extend({className:"mpf-gallery-delete-modal",setup:function(){this.alert=this._createAlert(),this.modal=this._createModal(this.alert)},render:function(){return this.container.setContent(this.modal.render()),this},show:function(e){return s.requiredOfPrototype(e,i,"argument must be a ShowcaseItemModel"),this.showcaseItem=e,this.modal.show(),this},hide:function(){return this.modal.hide(),this},destroy:function(){this.stopListening(),this.modal.destroy(),this.showcaseItem=null,this._parent(),this.container=null},_delete:function(){var e=this;this.modal.setLoading(!0),this.showcaseItem.destroy({onComplete:function(){e.modal.setLoading(!1),e.hide(),e.dispatchEvent(a.ON_DELETE,{status:"successful"})},onFailure:function(t){e.modal.setLoading(!1),console.log(t),e.alert.add({className:"error",message:n.get("deletionFailed")}).show()}})},_createAlert:function(){return new t({autoHide:!0,visible:!1})},_createModal:function(e){var t=new o({header:n.get("removeContent"),body:[e,n.get("deleteConfirmationMessage")],confirmButtonLabel:n.get("delete")});return this.listenTo(t,o.Events.CONFIRM,this._delete.bind(this)),t}});return r.Events=a,r}),define("DS/MPFShowroomComponent/GalleryItem",["UWA/Core","UWA/Class/View","DS/MPFServices/ObjectService","DS/MPFShowcaseItemModel/ShowcaseItemModel"],function(e,t,s,i){"use strict";const o=Object.freeze({SHOW_EDIT_MODAL:"showEditModal",SHOW_DELETE_MODAL:"showDeleteModal"}),n=t.extend({className:"col-xs-12 col-sm-4 col-md-3 mpf-gallery-item",setup:function(e){s.requiredOfPrototype(e.showcaseItem,i,"options.showcaseItem must be a ShowcaseItemModel"),this.showcaseItem=e.showcaseItem,this.editable=!0===e.editable},render:function(){var e=[];return e.push(this._createImageContainer()),this.editable&&e.push(this._createButtons()),this.container.setContent(e),this},destroy:function(){this.showcaseItem=null,this._parent(),this.container=null},_createButtons:function(){return e.createElement("div",{class:"mpf-item-edit-buttons",html:[{tag:"span",class:"fonticon fonticon-2x fonticon-pencil",events:{click:this.dispatchEvent.bind(this,o.SHOW_EDIT_MODAL,this.showcaseItem)}},{tag:"span",class:"fonticon fonticon-2x fonticon-trash",events:{click:this.dispatchEvent.bind(this,o.SHOW_DELETE_MODAL,this.showcaseItem)}}]})},_createImageContainer:function(){return e.createElement("div",{class:"mpf-item-image",styles:{"background-image":"url("+this.showcaseItem.getImage()+")"}})}});return n.Events=o,n}),define("DS/MPFShowroomComponent/ShowroomGalleryDescriptionModal",["UWA/Core","UWA/Class/View","DS/UIKIT/Modal","DS/UIKIT/Scroller","DS/MPFShowcaseItemModel/ShowcaseItemModel","DS/MPFServices/ObjectService"],function(e,t,s,i,o,n){"use strict";return t.extend({className:"mpf-showroom-description-modal",setup:function(){this.modal=this._createModal(this.descriptionContainer)},render:function(){return this.container.setContent(this.modal),this},show:function(e){return n.requiredOfPrototype(e,o,"Function expects ShowcaseItemModel as argument"),this.setModalHeaderText(e.getTitle()),this.setModalBodyText(e.getDescription()),this.modal.show(),this},hide:function(){return this.modal.hide(),this},destroy:function(){this.modal.destroy(),this.modal=null,this._parent(),this.container=null},setModalHeaderText:function(t){this.modal.setHeader(e.createElement("h4",{text:t}))},setModalBodyText:function(t){this.modal.setBody(""),new i({element:e.createElement("div",{text:t})}).inject(this.modal.getBody())},_createModal:function(e){return new s({closable:!0})}})}),define("DS/MPFShowroomComponent/ShowroomShopDescription",["UWA/Core","UWA/String","UWA/Class/View","DS/UIKIT/Input/Button","DS/MPFTooltip/Tooltip","DS/MPFServices/ObjectService","DS/MPFShopModel/ShopServiceModel","i18n!DS/MPFShowroomComponent/assets/nls/ShowroomComponent"],function(e,t,s,i,o,n,a,r){"use strict";return s.extend({className:"mpf-shop-description",setup:function(e){n.requiredOfPrototype(e.shopService,a,"options.shopService must be a ShopServiceModel"),this.shopService=e.shopService,this.serviceTerm=e.serviceTerm||r.get("lab"),this.isContextEditable=!0===e.isContextEditable,this.hasSelectButton=!0===e.hasSelectButton,this.selectButtonLabel=e.selectButtonLabel||r.get("getAQuote"),this.onSelectButtonClicked=e.onSelectButtonClicked,this.listenTo(this.shopService,"onChange:"+a.Fields.BACKGROUND_IMAGE,this.render.bind(this)),this.listenTo(this.shopService,"onChange:"+a.Fields.DESCRIPTION,this.render.bind(this))},render:function(){const e=this.shopService.getBackgroundImage();e?this.container.setStyle("background-image","url("+e+")"):this.container.addClassName("mpf-background-placeholder");const t=[this._createTitle(),this._createDescription()];return!0===this.hasSelectButton&&t.push(this._createSelectButton()),this.container.setContent([{tag:"div",class:"mpf-shop-text-container",html:t}]),this},destroy:function(){this.stopListening(),this.shopService=null,this._parent(),this.container=null},_createTitle:function(){const s=e.createElement("div",{class:"mpf-title",html:r.get("aboutUs")});return this.isContextEditable&&(e.createElement("span",{class:"mpf-required",text:"*"}).inject(s),new o({body:t.format(r.get("aboutUsTooltip"),this.serviceTerm)}).inject(s)),s},_createDescription:function(){const s=e.createElement("div",{class:"mpf-description-container"}),i=this.shopService.getDescription();return e.is(i,"string")&&i.length>0?s.setText(i):s.setContent(e.createElement("span",{text:t.format(r.get("descPlaceHolder"),this.serviceTerm),class:"mpf-description-placeholder"})),s},_createSelectButton:function(){const s=new i({value:t.ucfirst(this.selectButtonLabel),className:"primary"});return s.addEvent("onClick",()=>{this.onSelectButtonClicked()}),e.createElement("div",{class:"mpf-button-container",html:s})}})}),define("DS/MPFShowroomComponent/ShowroomCollaborationDeleteModal",["UWA/Core","UWA/Class/View","DS/UIKIT/Modal","DS/UIKIT/Input/Button","DS/MPFShowcaseItemModel/ShowcaseItemModel","DS/MPFServices/ObjectService","i18n!DS/MPFShowroomComponent/assets/nls/ShowroomComponent"],function(e,t,s,i,o,n,a){"use strict";var r,h={};return h.ON_DELETE="onDelete",(r=t.extend({className:"mpf-showroom-collaboration-delete-modal",setup:function(e){n.requiredOfPrototype(e.showcaseItem,o,"options.showcaseItem must be a ShowcaseItemModel"),this.showcaseItem=e.showcaseItem,this.modal=this._createModal()},render:function(){return this.container.setContent(this.modal),this},destroy:function(){this.modal.destroy(),this._parent(),this.container=null},show:function(){return this.modal.show(),this},hide:function(){return this.modal.hide(),this},_createModal:function(){var t=new i({value:a.get("delete"),className:"error"});t.addEvent("onClick",this._onDelete.bind(this));var o=new i({value:a.get("cancel"),className:"default"});return o.addEvent("onClick",this.hide.bind(this)),new s({closable:!0,header:e.createElement("h4",{text:a.get("removeContent")}),body:a.get("deleteConfirmationMessage"),footer:[t,o]})},_onDelete:function(){var e=this;this.showcaseItem.destroy({onComplete:function(){e.dispatchEvent(h.ON_DELETE,{status:"successful"})},onFailure:function(t){e.dispatchEvent(h.ON_DELETE,{status:"failed",error:t})}}),this.hide()}})).Events=Object.freeze(h),r}),define("DS/MPFShowroomComponent/ImageUploadHelper",["UWA/Promise","DS/MPFShopModel/MediaFactory"],function(e,t){"use strict";return class{static uploadImage(e,s,i){const o=e.createModel(t.Types.MEDIA,null,{parentResourceId:i}),n=new FormData;n.append("file",s);const a={method:"POST"};return a.data=n,o.savePromise(null,a)}static saveFileAndShowcaseItem(t,s,i){return(s.isNew()?s.savePromise():s.hasPendingChanges()?s.savePromise(s.getPendingChanges(),{patch:!0}):e.resolve()).then(function(){if(t.getFile())return i.setParentResourceId(s.get("id")),t.save().then(function(){s.setImage(i.getImage())})})}static readImageFile(e){if(e.file){const t=new window.FileReader;t.onload=function(){e.onLoaded(t.result)},t.onerror=e.onError,t.readAsDataURL(e.file)}}}}),define("DS/MPFShowroomComponent/ShowroomShopSizeTile",["UWA/Core","UWA/Class/View","DS/MPFServices/ObjectService","DS/MPFShopModel/ShopServiceModel","i18n!DS/MPFShowroomComponent/assets/nls/ShowroomComponent"],function(e,t,s,i,o){"use strict";return t.extend({className:"mpf-tile mpf-employees-tile",setup:function(e){s.requiredOfPrototype(e.shopService,i,"options.shopService nust be a ShopServiceModel"),this.shopService=e.shopService,this.employeesTerm=o.get(e.employeesTerm)||o.get("employees"),this.listenTo(this.shopService,"onChange",this.render.bind(this))},render:function(){var t=this._renderEmployeeNumber();return e.is(t,"string")&&t.length>0&&this.container.setContent([{tag:"span",class:"fonticon fonticon-users"},{tag:"div",text:t}]),this},destroy:function(){this.stopListening(),this.shopService=null,this._parent(),this.container=null},_renderEmployeeNumber:function(){const e=this.shopService.getNumberEmployees();if(Array.isArray(e)){if(e.length>0)var t=parseInt(e[0]);if(e.length>1)var s=parseInt(e[1]);if(s&&(null===t||0===t||isNaN(t)))return o.get("lessThanXItems",{number:s,itemTerm:this.employeesTerm});if(t&&!s)return o.get("moreThanXItems",{number:t,itemTerm:this.employeesTerm});if(t&&s)return t===s?1===t?o.get("freelance"):o.get("xItems",{number:t,itemTerm:this.employeesTerm}):o.get("betweenXandYItems",{infNumber:t,supNumber:s,itemTerm:this.employeesTerm})}}})}),define("DS/MPFShowroomComponent/ShowroomShopModal",["UWA/Core","UWA/Class/View","UWA/Promise","UWA/String","DS/UIKIT/Modal","DS/UIKIT/Input/Button","DS/UIKIT/Alert","DS/MPFShopModel/ShopModel","DS/MPFShopModel/ShopServiceModel","DS/MPFShopModel/LogoModel","DS/MPFShopModel/BackgroundModel","DS/MPFServices/ObjectService","DS/MPFView/FieldTextInputV2","DS/MPFView/FieldReplaceImage","i18n!DS/MPFShowroomComponent/assets/nls/ShowroomComponent"],function(e,t,s,i,o,n,a,r,h,l,c,d,m,u,p){"use strict";return t.extend({className:"mpf-showroom-shop-modal",setup:function(e){d.requiredOfPrototype(e.shop,r,"options.shop must be a ShopModel"),d.requiredOfPrototype(e.shopService,h,"options.shopService must be a ShopServiceModel"),d.requiredOfPrototype(e.logo,l,"options.logo must be a LogoModel"),d.requiredOfPrototype(e.background,c,"options.background must be a BackgroundModel"),this.shop=e.shop,this.shopService=e.shopService,this.logo=e.logo,this.background=e.background,this.serviceTerm=e.serviceTerm||p.get("lab"),this.maxFileSize=e.maxFileSize,this.shopNameEntry=this._createShopNameEntry(),this.shopNameRemainingCharactersContainer=this._createRemainingCharactersContainer(this.shopNameEntry),this.shopLogoEntry=this._createShopLogoEntry(),this.shopBackgroundEntry=this._createShopBackgroundEntry(),this.shopDescriptionEntry=this._createShopDescriptionEntry(),this.shopDescriptionRemainingCharactersContainer=this._createRemainingCharactersContainer(this.shopDescriptionEntry),this.modal=this._createModal(),this.alert=new a({autoHide:!0,visible:!1}),this.listenTo(this.shopNameEntry,m.Events.UPDATE,this._onChange.bind(this)),this.listenTo(this.shopDescriptionEntry,m.Events.UPDATE,this._onChange.bind(this)),this.listenTo(this.shopLogoEntry,m.Events.UPDATE,this._onChange.bind(this)),this.listenTo(this.shopBackgroundEntry,m.Events.UPDATE,this._onChange.bind(this)),this.listenTo(this.shopLogoEntry,"error",this._onFileSelectError.bind(this)),this.listenTo(this.shopBackgroundEntry,"error",this._onFileSelectError.bind(this)),this.listenTo(this.shopNameEntry.input.elements.input,"keyup",this._updateRemainingCharacters.bind(this,this.shopNameRemainingCharactersContainer,this.shopNameEntry)),this.listenTo(this.shopDescriptionEntry.input.elements.input,"keyup",this._updateRemainingCharacters.bind(this,this.shopDescriptionRemainingCharactersContainer,this.shopDescriptionEntry))},render:function(){const t=e.createElement("div",{class:"mpf-image-replace-container",html:[this.shopLogoEntry.render(),this.shopBackgroundEntry.render()]});return this.modal.setBody([this.alert,this.shopNameEntry.render(),t,this.shopDescriptionEntry.render()]),this.shopNameRemainingCharactersContainer.inject(this.shopNameEntry.container.getElement(".mpf-label"),"after"),this.shopDescriptionRemainingCharactersContainer.inject(this.shopDescriptionEntry.container.getElement(".mpf-label"),"after"),this.container.setContent([this.modal]),this},show:function(){return this._storeOldValues(),this.saveButton.disable(),this.modal.show(),this},hide:function(){return this.saveButton.load(!1),this.modal.hide(),this.shopLogoEntry.reset(),this.shopBackgroundEntry.reset(),this},destroy:function(){this.stopListening(),this.shop=null,this.shopService=null,this.logo=null,this.background=null,this._parent(),this.container=null},_onChange:function(){this.hasPendingChanges()&&this._validateValues()?this.saveButton.enable():this.saveButton.disable()},_onCancel:function(){this._restoreOldValues(),this.hide()},_onSave:function(){const e=this.shopNameEntry.validate(),t=this.shopDescriptionEntry.validate();if(e.isValid&&t.isValid){this.saveButton.load();var s=[];this._hasNameChanged()&&s.push(this.shopNameEntry.save()),this._hasDescriptionChanged()&&s.push(this.shopDescriptionEntry.save()),s.push(this.shopLogoEntry.save()),s.push(this.shopBackgroundEntry.save()),Promise.all(s).then(()=>{this._storeOldValues(),this.saveButton.load(!1),this.hide()}).catch(e=>{this.saveButton.load(!1),this.alert.add({className:"error alert-error",message:p.get("modificationSaveFailure")}).show(),console.error(e.response||e.message)})}},_createRemainingCharactersContainer:function(t){return e.createElement("span",{class:"nb-remaining-characters",text:" ("+i.format(p.get("nbRemainingCharacters"),this._getNumberRemainingCharacters(t).toString())+")"})},_updateRemainingCharacters:function(e,t){e.setText(" ("+i.format(p.get("nbRemainingCharacters"),this._getNumberRemainingCharacters(t).toString())+")")},_getNumberRemainingCharacters:function(e){return e.maxlength-e.getValue().length},_onFileSelectError:function(e){this.alert.add({className:"error",message:e.message}).show()},_validateValues:function(){return this.shopNameEntry.getValue()&&this.shopDescriptionEntry.getValue()},hasPendingChanges:function(){return this._hasNameChanged()||this._hasDescriptionChanged()||this._hasLogoChanged()||this._hasBackgroundChanged()},_hasNameChanged:function(){return this.shop.get(r.Fields.NAME)!==this.oldValues[r.Fields.NAME]},_hasDescriptionChanged:function(){return this.shopService.get(h.Fields.DESCRIPTION)!==this.oldValues[h.Fields.DESCRIPTION]},_hasLogoChanged:function(){return e.is(this.shopLogoEntry.file)},_hasBackgroundChanged:function(){return e.is(this.shopBackgroundEntry.file)},_createModal:function(){const e=this._createModalTitle();this.saveButton=this._createSaveButton();const t=this._createCancelButton();var s=new o({closable:!0,header:e,footer:[this.saveButton,t]});return s.getContent().getElement(".fonticon-cancel").addEvent("click",e=>{e.preventDefault(),this._onCancel()}),s},_createModalTitle:function(){return e.createElement("h4",{text:i.format(p.get("editServiceModalHeader"),this.serviceTerm)})},_createSaveButton:function(){return new n({value:p.get("save"),className:"primary",disabled:!0,events:{onClick:this._onSave.bind(this)}})},_createCancelButton:function(){return new n({value:p.get("cancel"),events:{onClick:this._onCancel.bind(this)}})},_createShopNameEntry:function(){return new m({className:"mpf-entry-v2 mpf-showroom-service-name",model:this.shop,fieldLabel:i.ucfirst(i.format(p.get("serviceName"),this.serviceTerm)),fieldName:r.Fields.NAME,dynamicValidation:!0,keyUpValidation:!0,required:!0,silent:!1,readOnly:this.shop.get(r.Fields.STATE)===r.States.SUBMITTED,maxlength:60})},_createShopLogoEntry:function(){return new u({model:this.shop,imageModel:this.logo,fieldLabel:i.ucfirst(i.format(p.get("serviceImage"),this.serviceTerm)),fieldName:r.Fields.LOGO,imageShape:"round",maxFileSize:this.maxFileSize})},_createShopBackgroundEntry:function(){return new u({model:this.shopService,imageModel:this.background,fieldLabel:p.get("backgroundImage"),fieldName:h.Fields.BACKGROUND_IMAGE,maxFileSize:this.maxFileSize})},_createShopDescriptionEntry:function(){return new m({className:"mpf-entry-v2 mpf-showroom-description",model:this.shopService,fieldLabel:i.ucfirst(i.format(p.get("serviceDescription"),this.serviceTerm)),fieldName:h.Fields.DESCRIPTION,dynamicValidation:!0,keyUpValidation:!0,silent:!1,required:!0,multiline:!0,multilineRows:5,maxlength:500})},_storeOldValues:function(){this.oldValues={},this.oldValues[r.Fields.NAME]=this.shop.get(r.Fields.NAME),this.oldValues[r.Fields.LOGO]=this.shop.get(r.Fields.LOGO),this.oldValues[h.Fields.BACKGROUND_IMAGE]=this.shopService.get(h.Fields.BACKGROUND_IMAGE),this.oldValues[h.Fields.DESCRIPTION]=this.shopService.get(h.Fields.DESCRIPTION)},_restoreOldValues:function(){this._hasNameChanged()&&this.shop.set(r.Fields.NAME,this.oldValues[r.Fields.NAME]),this._hasDescriptionChanged()&&this.shopService.set(h.Fields.DESCRIPTION,this.oldValues[h.Fields.DESCRIPTION]),this.shop.get(r.Fields.LOGO)!==this.oldValues[r.Fields.LOGO]&&this.shop.set(r.Fields.LOGO,this.oldValues[r.Fields.LOGO]),this.shopService.get(h.Fields.BACKGROUND_IMAGE)!==this.oldValues[h.Fields.BACKGROUND_IMAGE]&&this.shopService.set(h.Fields.BACKGROUND_IMAGE),this.shopNameEntry.resetValue({silent:!0}),this.shopDescriptionEntry.resetValue({silent:!0}),this.shopNameEntry.setValue(this.shop.get(r.Fields.NAME),{silent:!0}),this.shopDescriptionEntry.setValue(this.shopService.get(h.Fields.DESCRIPTION),{silent:!0}),this._updateRemainingCharacters(this.shopNameRemainingCharactersContainer,this.shopNameEntry),this._updateRemainingCharacters(this.shopDescriptionRemainingCharactersContainer,this.shopDescriptionEntry)}})}),define("DS/MPFShowroomComponent/ShowroomShopAddressTile",["UWA/Core","UWA/Class/View","DS/MPFServices/ObjectService","DS/MPFShopModel/ShopModel","DS/MPFAddressModel/AddressModel","DS/MPFCountryModel/CountryModel"],function(e,t,s,i,o,n){"use strict";return t.extend({className:"mpf-tile mpf-address-tile",setup:function(e){s.requiredOfPrototype(e.shop,i,"options.shop must be a ShopModel"),this.shop=e.shop,e.address&&(s.requiredOfPrototype(e.address,o,"options.address must be an AddressModel"),this.address=e.address,this.listenTo(this.address,"onChange",this.render.bind(this))),e.country&&(s.requiredOfPrototype(e.country,n,"options.country must be a CountryModel"),this.country=e.country)},render:function(){var t=this._getCountry(),s=this._getCity()||"";return e.is(t,"string")&&t.length>0&&(s?s+=", "+t:s=t),s&&this.container.setContent([{tag:"span",class:"fonticon fonticon-3ds-where"},{tag:"div",text:s}]),this},destroy:function(){this.stopListening(),this.shop=null,this.address=null,this.country=null,this._parent(),this.container=null},_getCountry:function(){if(this.country&&this.country.getName())return this.country.getName();if(this.shop.getCountry()){var t=this.shop.getCountry();return t=e.is(t,"object")&&t.name?t.name:t}return this.address&&this.address.getCountry()?this.address.getCountry():void 0},_getCity:function(){return this.address&&this.address.getCity()?this.address.getCity():this.shop.getCity()?this.shop.getCity():""}})}),define("DS/MPFShowroomComponent/ShowroomGalleryDeleteModal",["UWA/Class/View","DS/MPFServices/ObjectService","DS/MPFShowcaseItemModel/ShowcaseItemModel","DS/MPFView/ConfirmationModal","i18n!DS/MPFShowroomComponent/assets/nls/ShowroomComponent"],function(e,t,s,i,o){"use strict";var n,a={};return a.ON_DELETE="onDelete",(n=e.extend({className:"mpf-showroom-gallery-delete-modal",setup:function(e){t.requiredOfPrototype(e.showcaseItem,s,"options.showcaseItem must be a ShowcaseItemModel"),this.showcaseItem=e.showcaseItem,this.modal=this._createModal()},render:function(){return this.container.setContent(this.modal.render()),this},show:function(){this.modal.show()},hide:function(){this.modal.hide()},destroy:function(){this.stopListening(),this.modal.destroy(),this.showcaseItem=null,this._parent(),this.modal=null,this.container=null},_createModal:function(){var e=new i({header:o.get("deleteConfirmation"),body:o.get("deleteConfirmationMessage"),confirmButtonLabel:o.get("delete")});return this.listenTo(e,i.Events.CONFIRM,this._deleteItem.bind(this)),this.listenTo(e,i.Events.CANCEL,this.hide.bind(this)),e},_deleteItem:function(){var e=this;this.modal.setLoading(),this.showcaseItem.destroy({onComplete:function(){e.modal.setLoading(!1),e.dispatchEvent(a.ON_DELETE,{status:"successful"})},onFailure:function(t){e.modal.setLoading(!1),e.dispatchEvent(a.ON_DELETE,{status:"failed",error:t})}})}})).Events=Object.freeze(a),n}),define("DS/MPFShowroomComponent/ShowroomCollaborationModal",["UWA/Core","UWA/String","UWA/Class/View","DS/UIKIT/Modal","DS/UIKIT/Alert","DS/UIKIT/Input/Button","DS/MPFView/FieldFileInput","DS/MPFShowcaseItemModel/ShowcaseItemModel","DS/MPFShowroomComponent/ShowroomCollaborationDeleteModal","i18n!DS/MPFShowroomComponent/assets/nls/ShowroomComponent"],function(e,t,s,i,o,n,a,r,h,l){"use strict";var c,d={};return d.SAVE_NEW_ITEM="saveNewItemRequested",d.SAVE_EXISTING_ITEM="replaceImageRequested",d.ON_DELETE="onDelete",(c=s.extend({className:"mpf-collaboration-modal",setup:function(e){this.showcaseItem=e.showcaseItem,this.acceptedFileTypes=e.acceptedFileTypes||["image/jpeg","image/png","image/bmp","image/gif"],this.maxFileSize=e.maxFileSize,this.showcaseItem?this.editMode=!0:this.editMode=!1,this._createModal(),this.editMode&&(this.deleteModal=this._createDeleteModal()),this.alert=new o({autoHide:!0,hideDelay:3e3,maximumVisibleMessages:1})},render:function(){var e=[this.modal];return this.editMode&&e.push(this.deleteModal.render()),this.container.setContent(e),this},destroy:function(){this.stopListening(),this._clearModal(),this._parent(),this.container=null},show:function(){return this.setLoading(!1),this._createModal(),this.render(),this.modal.show(),this},hide:function(){return this.modal.hide(),this._clearModal(),this},setLoading:function(e){e=!1!==e,this.isLoading=e,this.saveButton&&this.saveButton.load(e),this.fileInput&&this.fileInput.setDisabled(e)},showAlert:function(e){for(var t=this.alert.getMessages(),s=0;s<t.length;s++)this.alert.remove(t[s]);this.alert.add(e).show()},_onChange:function(){this.isLoading||(this.fileInput.file?this.saveButton.enable():this.saveButton.disable())},_clearModal:function(){this.saveButton&&(this.saveButton.destroy(),this.saveButton=null),this.cancelButton&&(this.cancelButton.destroy(),this.cancelButton=null),this.deleteButton&&(this.deleteButton.destroy(),this.deleteButton=null),this.fileInput&&(this.fileInput.destroy(),this.fileInput=null),this.modal&&(this.modal.destroy(),this.modal=null)},_onSave:function(){e.is(this.fileInput.getFile())&&(this.editMode?this.dispatchEvent(d.SAVE_EXISTING_ITEM,{showcaseItem:this.showcaseItem,file:this.fileInput.file,name:d.SAVE_EXISTING_ITEM}):this.dispatchEvent(d.SAVE_NEW_ITEM,{file:this.fileInput.file,name:d.SAVE_NEW_ITEM}))},_onDelete:function(){this.deleteModal.show()},_onCancel:function(){this.hide()},_onFileChange:function(e){if(e){var t=this,s=new window.FileReader;s.onload=function(){t.imagePreview.setStyle("background-image","url("+s.result+")"),t.imagePreview.removeClassName("mpf-background-placeholder"),t._onChange()},s.onerror=function(e){console.error(e),t.alert.add({className:"error",message:l.get("fileCouldNotBeLoaded")}).show()},s.readAsDataURL(e)}},_createModal:function(){this.editMode?this.imagePreview=this._createImagePreview(this.showcaseItem.get("image")):this.imagePreview=this._createImagePreview(),this.fileInput=this._createFileInput();var t=[];this.saveButton=new n({value:l.get("save"),className:"primary",disabled:!0}),this.saveButton.addEvent("onClick",this._onSave.bind(this)),t.push(this.saveButton),this.cancelButton=new n({value:l.get("cancel"),className:"default"}),this.cancelButton.addEvent("onClick",this._onCancel.bind(this)),t.push(this.cancelButton),this.editMode&&(this.deleteButton=new n({value:l.get("delete"),className:"error"}),this.deleteButton.addEvent("onClick",this._onDelete.bind(this)),t.push(this.deleteButton)),this.alert=new o({autoHide:!0,hideDelay:3e3,maximumVisibleMessages:1}),this.modal=new i({closable:!0,header:e.createElement("h4",{text:l.get("addNewLogo")}),body:[this.alert,this.imagePreview,this.fileInput.render()],footer:t})},_createImagePreview:function(t){var s=e.createElement("div",{class:"mpf-image-preview"});return t?s.setStyle("background-image","url("+t+")"):s.addClassName("mpf-background-placeholder"),s},_createFileInput:function(){var e;e=this.showcaseItem&&this.showcaseItem.get(r.Fields.IMAGE)?l.get("noNewImageSelected"):l.get("noImageSelected");for(var s=this.acceptedFileTypes[0],i=1;i<this.acceptedFileTypes.length;i++)s+=", "+this.acceptedFileTypes[i];var o=t.format(l.get("uploadImageWithFormat"),s),n=new a({acceptedFileTypes:this.acceptedFileTypes,wrongFileTypeMessage:l.get("wrongFileTypeMessage"),maxFileSize:this.maxFileSize,fieldName:"image",fieldLabel:l.get("image"),buttonText:this.editMode?l.get("replaceImage"):l.get("chooseImage"),placeholder:e,showTextInput:!0,saveOnChange:!1,tooltip:o});return this.listenTo(n,a.Events.NEW_FILE_SELECTED,this._onFileChange.bind(this)),n},_createDeleteModal:function(){var e=new h({showcaseItem:this.showcaseItem}),t=this;return this.listenTo(e,h.Events.ON_DELETE,function(e){"successful"===e.status?t.dispatchEvent(d.ON_DELETE,e):t.alert.add({className:"error",message:l.get("deletionFailed")}).show()}),e}})).Events=Object.freeze(d),c}),define("DS/MPFShowroomComponent/ShowroomCollaborationDropZone",["UWA/Core","UWA/Class/View","UWA/Promise","UWA/String","DS/MPFView/DropZone","DS/MPFShowroomComponent/ShowroomCollaborationModal","DS/MPFShowcaseItemModel/ShowcaseItemCollection","DS/MPFShowcaseItemModel/ShowcaseItemFactory","DS/MPFShopModel/MediaFactory","DS/MPFServices/ObjectService","i18n!DS/MPFShowroomComponent/assets/nls/ShowroomComponent"],function(e,t,s,i,o,n,a,r,h,l,c){"use strict";var d,m={};return m.UPDATE_GALLERY="updateGallery",(d=t.extend({className:"mpf-showroom-collaboration-drop-zone",setup:function(e){l.requiredOfPrototype(e.showcaseItems,a,"options.showcaseItems must be a ShowcaseItemCollection"),this.showcaseItems=e.showcaseItems,l.requiredOfPrototype(e.showcaseItemFactory,r,"options.showcaseItemFactory must be a ShowcaseItemFactory"),this.showcaseItemFactory=e.showcaseItemFactory,l.requiredOfPrototype(e.mediaFactory,h,"options.mediaFactory must be a MediaFactory"),this.mediaFactory=e.mediaFactory,this.acceptedFileTypes=e.acceptedFileTypes||["image/jpeg","image/png","image/bmp","image/gif"],this.maxFileSize=e.maxFileSize,this.dropZone=this._createDropZone(),this.modal=this._createModal(),this.listenTo(this.modal,"saveNewItemRequested",this._onSaveModal.bind(this)),this.listenTo(this.dropZone,"onClick",this._onClick.bind(this)),this.listenTo(this.dropZone,"onDrop",this._onDrop.bind(this))},render:function(){return this.container.setContent([this.dropZone.render(),this.modal.render()]),this},destroy:function(){this.stopListening(),this.dropZone.destroy(),this.modal.destroy(),this._parent(),this.container=null},addClassName:function(e){return this.container.addClassName(e)},removeClassName:function(e){return this.container.removeClassName(e)},_onDrop:function(e){for(var t=e.files,s=0;s<t.length;s++)this._createShowcaseItemOnDrop(t[s])},_onClick:function(){this.modal.show()},_onSaveModal:function(e){var t,s=this;e.file&&(this.modal.setLoading(!0),(t=this._createBlankShowcaseItem()).savePromise().then(function(i){return s._uploadImage(e.file,t.get("id"))}).then(function(e){t.set("image",e.get("image")),s.modal.hide(),s.showcaseItems.push(t),s.dispatchEvent(m.UPDATE_GALLERY)}).catch(function(e){console.error(e),s.modal.showAlert({className:"error",message:c.get("fileUploadFailed")}),s.modal.setLoading(!1)}))},_createDropZone:function(){for(var e=this.acceptedFileTypes[0],t=1;t<this.acceptedFileTypes.length;++t)e+=", "+this.acceptedFileTypes[t];var s=i.format(c.get("uploadImageWithFormat"),e);return new o({acceptedFileTypes:this.acceptedFileTypes,maxFileSize:this.maxFileSize,tooltip:s})},_createModal:function(){return new n({acceptedFileTypes:this.acceptedFileTypes,maxFileSize:this.maxFileSize})},_createBlankShowcaseItem:function(){return this.showcaseItemFactory.createModel("shopServiceShowcaseItem",{itemType:"customerRef"},{parentResourceId:this.showcaseItems.parentResourceId})},_uploadImage:function(e,t){var i=this.mediaFactory.createModel(h.Types.MEDIA,null,{parentResourceId:t}),o=s.deferred(),n=new FormData;n.append("file",e);var a={method:"POST"};return a.data=n,a.onComplete=o.resolve,a.onFailure=function(e,t,s){o.reject({model:e,response:t,options:s})},i.save(null,a),o.promise},_createShowcaseItemOnDrop:function(e){var t,s=this;this.dropZone.showLoading(),this._createBlankShowcaseItem().savePromise().then(function(i){return t=i,s._uploadImage(e,t.get("id"))}).then(function(e){t.set("image",e.get("image")),s.showcaseItems.push(t),s.dropZone.hideLoading(),s.dispatchEvent(m.UPDATE_GALLERY)}).catch(function(e){console.error(e),s.dropZone.showAlert({className:"error",message:c.get("fileUploadFailed")}),s.dropZone.hideLoading()})}})).Events=Object.freeze(m),d}),define("DS/MPFShowroomComponent/ShowroomCollaborationItem",["UWA/Core","UWA/Class/View","UWA/Promise","DS/UIKIT/Alert","DS/MPFShowroomComponent/ShowroomCollaborationModal","DS/MPFShowroomComponent/ShowroomCollaborationDeleteModal","DS/MPFShowcaseItemModel/ShowcaseItemModel","DS/MPFShopModel/MediaFactory","DS/MPFServices/ObjectService","i18n!DS/MPFShowroomComponent/assets/nls/ShowroomComponent"],function(e,t,s,i,o,n,a,r,h,l){"use strict";var c,d={};return d.UPDATE_GALLERY="updateGallery",(c=t.extend({className:"col-xs-6 col-sm-4 col-md-3 mpf-collaboration-item",setup:function(e){h.requiredOfPrototype(e.showcaseItem,a,"options.showcaseItem must be a ShowcaseItemModel"),this.showcaseItem=e.showcaseItem,this.editable=!0===e.editable,this.acceptedFileTypes=e.acceptedFileTypes,this.maxFileSize=e.maxFileSize,this.image=this._createImage(),this.editable&&(h.requiredOfPrototype(e.mediaFactory,r,"options.mediaFactory must me a MediaFactory if ShowroomCollaborationItem is editable"),this.mediaFactory=e.mediaFactory,this.editButtonContainer=this._createEditButtons(),this.editModal=this._createEditModal(),this.deleteModal=this._createDeleteModal(),this.alert=new i({closable:!0,autoHide:!0}),this.listenTo(this.editModal,"replaceImageRequested",this._saveNewImage.bind(this)),this.listenTo(this.editModal,"onDelete",this._onDelete.bind(this)),this.listenTo(this.deleteModal,"onDelete",this._onDelete.bind(this)))},render:function(){var e=[this.alert,this.image];return this.editable&&(e.push(this.editButtonContainer),e.push(this.editModal.render()),e.push(this.deleteModal.render())),this.container.setContent(e),this},destroy:function(){this.stopListening(),this.showcaseItem=null,this._parent(),this.container=null},_updateImage:function(){this.image=this._createImage(),this.render()},_saveNewImage:function(e){var t=this;this.editModal.setLoading(!0),this._uploadImage(e.file).then(function(e){t.showcaseItem.set("image",e.get("image")),t._updateImage(),t.editModal.hide()}).catch(function(e){console.error(e),t.editModal.showAlert({className:"error",message:l.get("fileUploadFailed")}),t.editModal.setLoading(!1)})},_uploadImage:function(e){var t=this.mediaFactory.createModel(r.Types.MEDIA,null,{parentResourceId:this.showcaseItem.get("id")}),i=s.deferred(),o=new FormData;o.append("file",e);var n={method:"POST"};return n.data=o,n.onComplete=i.resolve,n.onFailure=function(e,t,s){i.reject({model:e,response:t,options:s})},t.save(null,n),i.promise},_createImage:function(){return e.createElement("div",{class:"mpf-collaboration-item-image",styles:{"background-image":"url("+this.showcaseItem.get("image")+")"}})},_createEditButtons:function(){var t=this;return e.createElement("div",{class:"mpf-collaboration-item-edit-buttons",html:[{tag:"span",class:"fonticon fonticon-2x fonticon-pencil",events:{click:function(){t.editModal.show()}}},{tag:"span",class:"fonticon fonticon-2x fonticon-trash",events:{click:function(){t.deleteModal.show()}}}]})},_createEditModal:function(){return new o({showcaseItem:this.showcaseItem,acceptedFileTypes:this.acceptedFileTypes,maxFileSize:this.maxFileSize})},_createDeleteModal:function(){return new n({showcaseItem:this.showcaseItem})},_onDelete:function(e){"successful"===e.status?this.dispatchEvent(d.UPDATE_GALLERY):this.alert.add({className:"error",message:l.get("deletionFailed")}).show()}})).Events=Object.freeze(d),c}),define("DS/MPFShowroomComponent/ShowroomShopTopBar",["UWA/Core","UWA/Class/View","DS/MPFView/InitialsDot","DS/MPFShowroomComponent/ShowroomShopAddressTile","DS/MPFShowroomComponent/ShowroomShopSizeTile","DS/MPFServices/ObjectService","DS/MPFShopModel/ShopModel","DS/MPFAddressModel/AddressModel"],function(e,t,s,i,o,n,a,r){"use strict";return t.extend({className:"mpf-showroom-shop-top-bar",setup:function(e){if(n.requiredOfPrototype(e.shop,a,"options.shop must be a ShopModel"),this.shop=e.shop,this.address=e.address,this.shopService=e.shopService,this.country=e.country,this.employeesTerm=e.employeesTerm,this.logoElement=this._createLogo(),(this.country||this.address||this.shop.getCountry()||this.shop.getCity())&&(this.addressElement=this._createAddressTile()),this.shopService){var t=this.shopService.getNumberEmployees();Array.isArray(t)&&t.length>0&&(this.shopSizeElement=this._createShopSizeTile())}this.listenTo(this.shop,"onChange:"+a.Fields.NAME,this.render.bind(this)),this.listenTo(this.shop,"onChange:"+a.Fields.LOGO,this._updateLogo.bind(this))},render:function(){const e=[];return this.addressElement&&e.push(this.addressElement.render()),this.shopSizeElement&&e.push(this.shopSizeElement.render()),this.container.setContent([this.logoElement,{tag:"div",class:"mpf-right-column",html:[{tag:"div",class:"mpf-showroom-shop-title",text:this.shop.getName()},e]}]),this},destroy:function(){this.stopListening(),this.addressElement&&this.addressElement.destroy(),this.shopSizeElement&&this.shopSizeElement.destroy(),this.shop=null,this.address=null,this._parent(),this.container=null},_createLogo:function(){return new s({title:this.shop.getName(),image:this.shop.getLogo()})},_createAddressTile:function(){return new i({shop:this.shop,address:this.address,country:this.country})},_createShopSizeTile:function(){return new o({shopService:this.shopService,employeesTerm:this.employeesTerm})},_updateLogo:function(){this.logoElement=this._createLogo(),this.render()}})}),define("DS/MPFShowroomComponent/GalleryEditModal",["UWA/Core","UWA/Class/View","DS/WebappsUtils/WebappsUtils","DS/UIKIT/Input/Button","DS/UIKIT/Modal","DS/UIKIT/Alert","DS/MPFShowroomComponent/ImageUploadHelper","i18n!DS/MPFShowroomComponent/assets/nls/ShowroomComponent"],function(e,t,s,i,o,n,a,r){"use strict";const h=Object.freeze({ADD_NEW_ITEM:"addNewItem",UPDATE_ITEM:"updateItem",CANCEL:"cancel",SHOW_DELETE_MODAL:"showDeleteModal",NEW_FILE_SELECTED:"newFileSelected",INVALID_FILE_SELECTED:"invalidFileSelected",ON_CHANGE:"onChange"}),l=t.extend({className:"mpf-gallery-edit-modal",setup:function(){this.alert=this._createAlert(),this.imagePreview=this._createImagePreview(),this.formContainer=this._createFormContainer(),this.saveButton=this._createSaveButton(),this.cancelButton=this._createCancelButton(),this.deleteButton=this._createDeleteButton(),this.modal=this._createModal()},render:function(){return this.container.setContent(this.modal),this},destroy:function(){this.stopListening(),this.showcaseItem=null,this._parent(),this.container=null},enableSaveButton:function(e){e=!1!==e,this.saveButton.setDisabled(!e)},updateImagePreview:function(e){(e=e||this.showcaseItem.getImage())?(this.imagePreview.removeClassName("mpf-background-placeholder"),this.imagePreview.setStyle("background-image","url("+e+")")):(this.imagePreview.addClassName("mpf-background-placeholder"),this.imagePreview.setStyle("background-image","url("+s.getWebappsAssetUrl("MPFShowroomComponent","images/shop_background_placeholder.jpg")+")"))},onChange:function(){this.enableSaveButton(this.form.validateValues()&&(this.showcaseItem.hasPendingChanges()||this.form.hasPendingImageChange()))},onFileChange:function(e){var t=this;a.readImageFile({file:e,onLoaded:this.updateImagePreview.bind(this),onError:function(e){console.error(e),t.alert.add({className:"error",message:r.get("fileCouldNotBeLoaded")}).show()}}),this.onChange()},show:function(e){return this.form=e,this.listenTo(this.form,h.NEW_FILE_SELECTED,this.onFileChange.bind(this)),this.listenTo(this.form,h.INVALID_FILE_SELECTED,this.onChange.bind(this)),this.listenTo(this.form,h.ON_CHANGE,this.onChange.bind(this)),this.showcaseItem=e.showcaseItem,this.showcaseItem.isNew()?this.deleteButton.hide():this.deleteButton.show(),this.showcaseItem.isNew()?this.setTitle(r.get("addNewImage")):this.setTitle(r.get("editImage")),this.enableSaveButton(!1),this.updateImagePreview(),this.formContainer.setContent(this.form.render()),this.modal.show(),this},hide:function(){return this.stopListening(),this.form&&this.form.destroy(),this.form=null,this.showcaseItem=null,this.modal.hide(),this},setTitle:function(t){this.modal.setHeader(e.createElement("h4",{text:t}))},_onSave:function(){var e=this;this.saveButton.load(!0);var t=this.showcaseItem,s=t.isNew();this.form.save().then(this.saveButton.load.bind(this.saveButton,!1)).then(this.hide.bind(this)).then(this._dispatchUpdateEvent.bind(this,s,t)).catch(function(t){e.saveButton.load(!1),console.log(t),e.alert.add({className:"error",message:r.get("modificationSaveFailure")}).show()})},_dispatchUpdateEvent:function(e,t){e?this.dispatchEvent(h.ADD_NEW_ITEM,t):this.dispatchEvent(h.UPDATE_ITEM,t)},_onCancel:function(){this.form.restoreOldValues(),this.hide(),this.dispatchEvent(h.CANCEL,this)},_createAlert:function(){return new n({autoHide:!0,visible:!1})},_createImagePreview:function(){return e.createElement("div",{class:"mpf-image-preview"})},_createFormContainer:function(){return e.createElement("div",{class:"mpf-form-container"})},_createSaveButton:function(){return new i({className:"primary",value:r.get("save"),disabled:!0,events:{onClick:this._onSave.bind(this)}})},_createCancelButton:function(){return new i({value:r.get("cancel"),events:{onClick:this._onCancel.bind(this)}})},_createDeleteButton:function(){var e=this;return new i({className:"error",value:r.get("delete"),events:{onClick:function(){var t=e.showcaseItem;e.dispatchEvent(h.SHOW_DELETE_MODAL,t)}}})},_createModal:function(){var e=[this.saveButton,this.cancelButton,this.deleteButton];return new o({header:this.title,body:[this.alert,this.imagePreview,this.formContainer],footer:e})}});return l.Events=h,l}),define("DS/MPFShowroomComponent/ImageGallery",["UWA/Core","UWA/Class/View","UWA/Promise","DS/MPFServices/ObjectService","DS/MPFModel/MPFCollection","DS/MPFShopModel/MediaFactory","DS/MPFShowcaseItemModel/ShowcaseItemFactory","DS/MPFView/DropZone","DS/MPFShowroomComponent/ImageUploadHelper","DS/MPFShowroomComponent/GalleryItem","DS/MPFShowroomComponent/GalleryEditModal","DS/MPFShowroomComponent/GalleryDeleteModal","i18n!DS/MPFShowroomComponent/assets/nls/ShowroomComponent","css!DS/MPFShowroomComponent/MPFShowroomComponent"],function(e,t,s,i,o,n,a,r,h,l,c,d,m){"use strict";return t.extend({className:"mpf-image-gallery",setup:function(e){i.requiredOfPrototype(e.showcaseItems,o,"options.showcaseItems must be a MPFCollection"),i.requiredOfType(e.itemType,"string","options.itemType must be a string"),this.showcaseItems=e.showcaseItems,this.itemType=e.itemType,this.editable=!0===e.editable,this.editable&&(i.requiredOfPrototype(e.mediaFactory,n,"options.mediaFactory must be a MediaFactory"),i.requiredOfPrototype(e.showcaseItemFactory,a,"options.showcaseItemFactory must be a ShowcaseItemFactory"),this.showcaseItemFactory=e.showcaseItemFactory,this.mediaFactory=e.mediaFactory),this.title=e.title||m.get("gallery"),this.subtitle=e.subtitle,this.acceptedFileTypes=e.acceptedFileTypes||["image/jpeg","image/png","image/bmp","image/gif"],this.maxFileSize=e.maxFileSize||2097152,this.galleryItems=this._createItems(this._filterItems(this.showcaseItems)),this.editable&&(this.dropZone=this._createDropZone(),this.deleteModal=this._createDeleteModal(),this.editModal=this._createEditModal())},render:function(){var e=[];this.galleryItems.forEach(function(t){e.push(t.render())}),this.editable&&e.push(this._createDropZoneContainer(this.dropZone.render()));var t=[{tag:"h3",class:"mpf-title",html:this.title},{tag:"h4",class:"mpf-subtitle",text:this.subtitle||""},{tag:"div",class:"mpf-item-container row",html:e.length>0?e:m.get("noItemsYet")}];return this.editable&&(t.push(this.editModal.render()),t.push(this.deleteModal.render())),this.container.setContent(t),this},update:function(){this.editable&&this.editModal.hide();for(var e=0;e<this.galleryItems.length;e++)this.stopListening(this.galleryItems[e]),this.galleryItems[e].destroy();this.galleryItems=this._createItems(this._filterItems(this.showcaseItems)),this.render()},addNewItem:function(e){this.showcaseItems.push(e),this.update()},updateItem:function(e){for(var t=0;t<this.galleryItems.length;t++){var s=this.galleryItems[t];if(s.showcaseItem===e)return void s.render()}},createEditForm:function(){return null},destroy:function(){this.stopListening();for(var e=0;e<this.galleryItems.length;e++)this.galleryItems[e].destroy();this.editable&&(this.editModal.destroy(),this.deleteModal.destroy()),this.showcaseItems=null,this._parent(),this.container=null},_filterItems:function(e){var t=this;return e.filter(function(e){return e.get("type")===t.itemType||e.get("itemType")===t.itemType})},_getNumberShowcaseItems:function(){return this._filterItems(this.showcaseItems).length},_createItems:function(e){var t=this,s=[];return(e=e||[]).forEach(function(e){var i=t._createItem(e);t.listenTo(i,l.Events.SHOW_DELETE_MODAL,t._showDeleteModal.bind(t,e)),t.listenTo(i,l.Events.SHOW_EDIT_MODAL,t._showEditModal.bind(t,e)),s.push(i)}),s},_createItem:function(e){return new l({showcaseItem:e,editable:this.editable})},_createDropZone:function(){var e=new r({acceptedFileTypes:this.acceptedFileTypes,maxFileSize:this.maxFileSize});return this.listenTo(e,r.Events.ON_DROP,this._onDrop.bind(this)),this.listenTo(e,r.Events.ON_CLICK,this._showEditModal.bind(this)),e},_createDropZoneContainer:function(t){return e.createElement("div",{class:"mpf-drop-zone-container "+(this._getNumberShowcaseItems()>0?"col-xs-12 col-sm-4 col-md-3":"col-xs-12"),html:t})},_createEditModal:function(){var e=new c;return this.listenTo(e,c.Events.ADD_NEW_ITEM,this.addNewItem.bind(this)),this.listenTo(e,c.Events.UPDATE_ITEM,this.updateItem.bind(this)),this.listenTo(e,c.Events.SHOW_DELETE_MODAL,this._showDeleteModal.bind(this)),e},_createDeleteModal:function(){var e=new d;return this.listenTo(e,d.Events.ON_DELETE,this.update.bind(this)),e},_showEditModal:function(e){(e=e||this.showcaseItemFactory.createModel(a.Types.SHOP_SERVICE_SHOWCASE_ITEM,{itemType:this.itemType})).setParentResourceId(this.showcaseItems.parentResourceId);var t=this.mediaFactory.createModel(n.Types.MEDIA),s=this.createEditForm({showcaseItem:e,mediaModel:t,acceptedFileTypes:this.acceptedFileTypes,maxFileSize:this.maxFileSize});this.editModal.show(s)},_showDeleteModal:function(e){this.deleteModal.show(e)},_onDrop:function(e){var t=this,i=e.files,o=[];i.forEach(function(e){o.push(t._uploadImageOnDrop(e))}),this.dropZone.showLoading(),s.all(o).then(function(){t.update()}).finally(function(){t.dropZone.hideLoading()})},_uploadImageOnDrop:function(e){var t=this,s=this.showcaseItemFactory.createModel(a.Types.SHOP_SERVICE_SHOWCASE_ITEM,{itemType:this.itemType},{parentResourceId:this.showcaseItems.parentResourceId}),i=e.name.substr(0,e.name.lastIndexOf("."));return s.setTitle(i),s.setDescription(i),s.savePromise().then(function(s){return h.uploadImage(t.mediaFactory,e,s.get("id"))}).then(function(e){s.setImage(e.getImage()),t.dropZone.hideLoading(),t.showcaseItems.push(s)})}})}),define("DS/MPFShowroomComponent/ShowroomCollaborationForm",["UWA/Core","UWA/String","UWA/Class/View","DS/MPFServices/ObjectService","DS/MPFShowroomComponent/ImageUploadHelper","DS/MPFShowcaseItemModel/ShowcaseItemModel","DS/MPFShopModel/MediaModel","DS/MPFView/FieldFileInput","i18n!DS/MPFShowroomComponent/assets/nls/ShowroomComponent"],function(e,t,s,i,o,n,a,r,h){"use strict";var l={};return l.NEW_FILE_SELECTED="newFileSelected",l.INVALID_FILE_SELECTED="invalidFileSelected",s.extend({className:"mpf-showroom-collaboration-form mpf-form mpf-horizontal",setup:function(e){i.requiredOfPrototype(e.showcaseItem,n,"options.showcaseItem must be a ShowcaseItemModel"),i.requiredOfPrototype(e.mediaModel,a,"options.mediaModel must be a MediaModel"),i.requiredOfType(e.acceptedFileTypes,"array","options.acceptedFileTypes must be an array"),this.showcaseItem=e.showcaseItem,this.mediaModel=e.mediaModel,this.acceptedFileTypes=e.acceptedFileTypes,this.maxFileSize=e.maxFileSize,this.fileInput=this._createFileInput(),this.storeOldValues()},render:function(){return this.container.setContent(this.fileInput.render()),this},validateInputs:function(){return this._validateImage()},validateValues:function(){return!this.showcaseItem.validate()&&this._validateImage()},save:function(){if(this.validateInputs())return o.saveFileAndShowcaseItem(this.fileInput,this.showcaseItem,this.mediaModel)},destroy:function(){this.stopListening(),this.fileInput.destroy(),this.showcaseItem=null,this.mediaModel=null,this._parent(),this.container=null},storeOldValues:function(){this.oldValues=this.showcaseItem.omit()},restoreOldValues:function(){this.showcaseItem.set(this.oldValues),this.oldValues=null},hasPendingImageChange:function(){return e.is(this.fileInput.getFile())},_validateImage:function(){return!this.fileInput.isShowingError()&&e.is(this.fileInput.getFile())},_createFileInput:function(){for(var e=this.showcaseItem.get(n.Fields.IMAGE),s=this.acceptedFileTypes[0],i=1;i<this.acceptedFileTypes.length;i++)s+=", "+this.acceptedFileTypes[i];var o=t.format(h.get("uploadImageWithFormat"),s),a=new r({fileModel:this.mediaModel,fieldName:n.Fields.IMAGE,fieldLabel:h.get(n.Fields.IMAGE),showTextInput:!0,silent:!1,acceptedFileTypes:this.acceptedFileTypes,wrongFileTypeMessage:h.get("wrongFileTypeMessage"),maxFileSize:this.maxFileSize,placeholder:""!==e?h.get("noNewImageSelected"):h.get("noImageSelected"),buttonText:""!==e?h.get("replaceImage"):h.get("chooseImage"),required:!0,tooltip:o});return this.listenTo(a,r.Events.NEW_FILE_SELECTED,this.dispatchEvent.bind(this,l.NEW_FILE_SELECTED)),this.listenTo(a,r.Events.INVALID_FILE_SELECTED,this.dispatchEvent.bind(this,l.INVALID_FILE_SELECTED)),a}})}),define("DS/MPFShowroomComponent/ShowroomCollaborationGallery",["UWA/Core","DS/MPFTooltip/Tooltip","DS/MPFShowroomComponent/ImageGallery","DS/MPFShowroomComponent/ShowroomCollaborationForm","i18n!DS/MPFShowroomComponent/assets/nls/ShowroomComponent","css!DS/MPFShowroomComponent/MPFShowroomComponent"],function(e,t,s,i,o){"use strict";return s.extend({setup:function(e){e.acceptedFileTypes=e.acceptedFileTypes||["image/jpeg","image/png","image/bmp","image/gif"],e.maxFileSize=e.maxFileSize||2097152,e.editable=!0===e.editable,e.title=this._createTitle(e.editable),e.itemType="customerRef",this._parent(e),this.container.addClassName("mpf-showroom-collaboration-gallery")},createEditForm:function(e){return new i(e)},_createTitle:function(s){var i=e.createElement("div",{class:"mpf-collaboration-title",text:o.get("partners")});return s&&(this.tooltip=new t({body:o.get("collaborationTooltip")}).inject(i)),i}})}),define("DS/MPFShowroomComponent/ShowroomGalleryItem",["UWA/Core","DS/MPFShowroomComponent/GalleryItem"],function(e,t){"use strict";const s=Object.freeze({SHOW_DESCRIPTION_MODAL:"showDescriptionModal"}),i=t.extend({setup:function(e){this._parent(e),this.longDescriptionMask=this._createLongDescriptionMask(),this.upDownArrow=this._createUpDownArray(),this.container.addClassName("mpf-showroom-gallery-item")},render:function(){var e=[];return this.imageElement=this._createImageElement(),this.imageContainer=this._createImageContainer(this.imageElement),this.textContainer=this._createTextContainer(this.longDescriptionMask),e.push({tag:"div",class:"mpf-gallery-item-content",html:[this.imageContainer,this.textContainer,this.upDownArrow]}),this.editable&&e.push(this._createButtons()),this.container.setContent(e),this._onResize(),this},destroy:function(){this.stopListening(),this.textContainer&&this.textContainer.removeEvents(),this.imageElement&&this.imageElement.removeEvents(),this._parent(),this.container=null},_createImageContainer:function(t){return e.createElement("div",{class:"mpf-gallery-item-image-container",html:t})},_createImageElement:function(){const t=e.createElement("div",{class:"mpf-gallery-item-image",styles:{"background-image":"url("+this.showcaseItem.get("image")+")"},events:{click:this._openImage.bind(this)}});return t.addEvent("resize",this._onResize.bind(this)),t},_createTextContainer:function(t){const s=e.createElement("div",{class:"mpf-gallery-item-text",html:[{tag:"h4",class:"mpf-gallery-item-title",text:this.showcaseItem.getTitle()},{tag:"div",class:"mpf-gallery-item-description",text:this.showcaseItem.getDescription()},t]});return s.addEvent("mouseenter",this._shiftTextUpwards.bind(this)),s.addEvent("mouseleave",this._putTextBackInPlace.bind(this)),s.addEvent("click",this._onTextContainerClick.bind(this)),s},_createUpDownArray:function(){return e.createElement("span",{class:"fonticon fonticon-expand-up",events:{click:this._shiftTextUpwards.bind(this)}})},_createLongDescriptionMask:function(){return e.createElement("div",{class:"mpf-description-mask",html:[{tag:"span",text:" ... ",class:"mpf-show-description-icon"}],events:{click:this.dispatchEvent.bind(this,s.SHOW_DESCRIPTION_MODAL,this.showcaseItem)}})},_shiftTextUpwards:function(){if(this.isDescriptionOverflowing){this.upDownArrow.setOpacity(0);var e=this.container.getSize().height-this.textContainer.getScrolls().height;e=e<0?0:e,this.textContainer.setStyle("top",e.toString()),this.longDescriptionMask.setStyle("display",0===e?"flex":"none")}},_putTextBackInPlace:function(){this.isDescriptionOverflowing&&(this.textContainer.setStyle("top",this.imageContainer.getSize().height+"px"),this.upDownArrow.setOpacity(1),this.container.getSize().height-this.textContainer.getScrolls().height<0&&this.longDescriptionMask.hide())},_onTextContainerClick:function(){parseInt(this.textContainer.getStyle("top"),10)<this.imageContainer.getSize().height?this._putTextBackInPlace():this._shiftTextUpwards()},_openImage:function(){var e=this.showcaseItem.get("image")||this.imageElement.getStyle("background-image").slice(4,-1).replace(/"/g,"");window.open(e,"_blank")},_onResize:function(e){e&&e.target!==this.imageElement||(this._insertArrowForLongDescriptions(),this._cutTooLongDescriptions())},_insertArrowForLongDescriptions:function(e){this.imageContainer.getScrolls().height+this.textContainer.getScrolls().height-this.container.getSize().height>0?(this.isDescriptionOverflowing=!0,this.upDownArrow.show(),this.upDownArrow.setOpacity(1)):(this.isDescriptionOverflowing=!1,this.upDownArrow.hide(),this.upDownArrow.setOpacity(0))},_cutTooLongDescriptions:function(){this.container.getSize().height-this.textContainer.getScrolls().height<0&&this.textContainer.setStyles({height:this.container.getSize().height,"overflow-y":"hidden"})}});return i.Events=s,i}),define("DS/MPFShowroomComponent/ShowroomShop",["UWA/Core","UWA/Promise","UWA/Class/View","DS/UIKIT/Input/Button","DS/MPFShopModel/ShopModel","DS/MPFShopModel/ShopServiceModel","DS/MPFShopModel/LogoModel","DS/MPFShopModel/BackgroundModel","DS/MPFServices/ObjectService","DS/MPFServices/MarketplaceServices","DS/MPFShowroomComponent/ShowroomShopTopBar","DS/MPFShowroomComponent/ShowroomShopDescription","DS/MPFShowroomComponent/ShowroomShopModal","DS/MPFDataProxy/MarketplaceConnector","DS/MPFModelFactory/MPFFactoriesV2","DS/MPFShopModel/ShopFactory","DS/MPFCountryModel/CountryFactory","DS/MPFShopModel/ShopServiceFactory","DS/MPFAddressModel/AddressFactory","DS/MPFAddressModel/AddressModel","css!DS/MPFShowroomComponent/MPFShowroomComponent"],function(e,t,s,i,o,n,a,r,h,l,c,d,m,u,p,g,S,f,I,w){"use strict";const M=Object.freeze({SELECT_CLICKED:"onSelectButtonClicked"}),E=s.extend({className:"mpf-showroom-shop",setup:function(e){h.requiredOfPrototype(e.shop,o,"options.shop must be a ShopModel"),h.requiredOfPrototype(e.shopService,n,"options.shopService must be a ShopServiceModel"),h.requiredOfPrototype(e.logo,a,"options.logo must be a LogoModel"),h.requiredOfPrototype(e.background,r,"options.background must be a BackgroundModel"),this.shop=e.shop,this.address=e.address,this.shopService=e.shopService,this.logo=e.logo,this.background=e.background,this.country=e.country,this.editable=!0===e.editable,this.serviceTerm=e.serviceTerm,this.employeesTerm=e.employeesTerm,this.maxFileSize=e.maxFileSize||2097152,this.hasSelectButton=e.hasSelectButton,this.selectButtonLabel=e.selectButtonLabel,this.logo.setParentResourceId(this.shop.get("id")),this.background.setParentResourceId(this.shopService.get("id")),this.topBar=this._createTopBar(),this.shopDescription=this._createShopDescription(),this.editable&&(this.shopEditModal=this._createShopEditModal(),this.editDescriptionCommand=this._createEditDescriptionCommand())},render:function(){const e=[this.topBar.render(),this.shopDescription.render()];return this.editable&&(e.push(this.editDescriptionCommand),e.push(this.shopEditModal.render())),this.container.setContent(e),this},destroy:function(){this.editDescriptionCommand&&this.editDescriptionCommand.destroy(),this.topBar.destroy(),this.shopDescription.destroy(),this.shop=null,this.shopService=null,this.logo=null,this.background=null,this._parent(),this.container=null},_onEdit:function(){this.shopEditModal.show()},_createShopDescription:function(){return new d({isContextEditable:this.editable,shopService:this.shopService,serviceTerm:this.serviceTerm,hasSelectButton:this.hasSelectButton,selectButtonLabel:this.selectButtonLabel,onSelectButtonClicked:this._onSelectButtonClicked.bind(this)})},_createTopBar:function(){return new c({shop:this.shop,shopService:this.shopService,address:this.address,country:this.country,employeesTerm:this.employeesTerm})},_createEditDescriptionCommand:function(){return new i({className:"mpf-shop-edit",icon:"pencil",events:{onClick:this._onEdit.bind(this)}})},_createShopEditModal:function(){return new m({shop:this.shop,shopService:this.shopService,logo:this.logo,background:this.background,serviceTerm:this.serviceTerm,maxFileSize:this.maxFileSize})},_onSelectButtonClicked:function(){this.dispatchEvent(M.SELECT_CLICKED,{shop:this.shop,shopService:this.shopService})}});return E.fromShopId=function(s,i){let o,n,a,r,h,c,d,m;return console.warn("Deprecated factory function since 4.6. Please use ShowroomShopFactory.fromShopId instead."),i=i||{},e.is(i,"object")?o=i:e.is(i,"boolean")&&(o={editable:i}),function(e){const s=e.service||l.MAKE;return u.fetchPromise({service:s}).then(function(e){const s=p.getInstance(e);return t.all([s.getFactory(p.Types.SHOP),s.getFactory(p.Types.SHOP_SERVICE),s.getFactory(p.Types.LOGO),s.getFactory(p.Types.BACKGROUND),s.getFactory(p.Types.ADDRESS),s.getFactory(p.Types.COUNTRY)])})}(i).then(function(e){const i=e[0],o=e[1],l=e[2],c=e[3];d=e[4];const u=e[5];return n=i.createModel(g.Types.SHOP),a=o.createModel(f.Types.SHOP_SHOP_SERVICE),r=l.createModel(),h=c.createModel(),n.set("id",s),a.setParentResourceId(s),m=u.createCollection(S.Types.SELLER),t.all([n.fetchPromise(),a.fetchPromise(),m.fetchPromise()])}).then(function(){return(c=d.createModel(I.Types.address,{id:n.get("address")},{parentResourceId:s})).fetchPromise()}).then(function(){let t;const s=c.getCountry();return s.test(/^[A-Z]{3}$/)&&(t=m.getCountryWithIso3(s)),o=e.extend(o,{shop:n,shopService:a,logo:r,background:h,address:c,country:t}),new E(o)})},E.fromPublicShopId=function(s,i){console.warn("Deprecated factory function since 4.6. Please use ShowroomShopFactory.fromPublicShopId instead."),(i=i||{}).editable=!1;const n=i.service||l.MAKE;let a,r,h,c,d,m;return u.fetchPromise({service:n}).then(function(e){const s=p.getInstance(e);return t.all([s.getFactory(p.Types.SHOP),s.getFactory(p.Types.SHOP_SERVICE),s.getFactory(p.Types.LOGO),s.getFactory(p.Types.BACKGROUND),s.getFactory(p.Types.COUNTRY)])}).then(function(e){const i=e[0];a=e[1];const n=e[2],h=e[3],l=e[4];return(r=i.createModel(g.Types.PUBLIC_V1)).set("id",s),c=n.createModel(),d=h.createModel(),m=l.createCollection(S.Types.SELLER),t.all([r.fetchPromise({expand:[o.Expands.SHOP_SERVICES]}),m.fetchPromise()])}).then(function(t){const s=t[0].getService(n);let o;h=a.createModel(f.Types.SHOP_SHOP_SERVICE,s);const l=r.getCountry();return l&&l.test(/^[A-Z]{3}$/)&&(o=m.getCountryWithIso3(l)),i=e.extend(i,{shop:r,shopService:h,logo:c,background:d,country:o}),new E(i)})},E.Events=M,E}),define("DS/MPFShowroomComponent/ShowroomShopFactory",["UWA/Core","UWA/Promise","DS/MPFUrl/UrlUtils","DS/MPFConnector/MarketplaceConnector","DS/MPFServices/MarketplaceServices","DS/MPFModelFactory/MPFFactoriesV2","DS/MPFShopModel/ShopFactory","DS/MPFShopModel/ShopServiceFactory","DS/MPFCountryModel/CountryFactory","DS/MPFAddressModel/AddressFactory","DS/MPFShopModel/ShopModel","DS/MPFShowroomComponent/ShowroomShop"],function(e,t,s,i,o,n,a,r,h,l,c,d){"use strict";class m{static fromShopId(i,o={}){let n,c,m,u,p,g,S,f;return e.is(o,"object")?f=o:e.is(o,"boolean")&&(f={editable:o}),this._fetchConnectorGetFactories(o).then(function(e){return n=e[0].createModel(a.Types.SHOP,{id:i}),c=e[1].createModel(r.Types.SHOP_SHOP_SERVICE,null,{parentResourceId:i}),m=e[2].createModel(),u=e[3].createModel(),g=e[4],S=e[5].createCollection(h.Types.SELLER),t.all([n.fetchPromise(),c.fetchPromise(),S.fetchPromise()])}).then(function(){const e=new s(n.getAddress());return(p=g.createModel(l.Types.address,{id:e.extractId()},{parentResourceId:i})).fetchPromise()}).then(function(){let t;const s=p.getCountry();return s.test(/^[A-Z]{3}$/)&&(t=S.getCountryWithIso3(s)),f=e.extend(f,{shop:n,shopService:c,logo:m,background:u,address:p,country:t}),new d(f)})}static fromPublicShopId(i,n={}){n.editable=!1;const m=n.service||o.MAKE;let u,p,g,S,f,I,w;return this._fetchConnectorGetFactories(n).then(function(e){return u=e[1],p=e[0].createModel(a.Types.PUBLIC_V1,{id:i}),S=e[2].createModel(),f=e[3].createModel(),w=e[4].createModel(l.Types.PUBLIC),I=e[5].createCollection(h.Types.SELLER),t.all([p.fetchPromise({expand:[c.Expands.SHOP_SERVICES]}),I.fetchPromise()])}).then(function(){const e=new s(p.getAddress());return w.set("id",e.extractId()),w.fetchPromise()}).then(function(){const t=p.getService(m);let s;g=u.createModel(r.Types.SHOP_SHOP_SERVICE,t);const i=p.getCountry();return i&&i.test(/^[A-Z]{3}$/)&&(s=I.getCountryWithIso3(i)),n=e.extend(n,{shop:p,shopService:g,logo:S,background:f,country:s,address:w}),new d(n)})}static _fetchConnectorGetFactories(e){const s=e.service||o.MAKE;return i.fetchPromise({service:s}).then(function(e){const s=n.getInstance(e);return t.all([s.getFactory(n.Types.SHOP),s.getFactory(n.Types.SHOP_SERVICE),s.getFactory(n.Types.LOGO),s.getFactory(n.Types.BACKGROUND),s.getFactory(n.Types.ADDRESS),s.getFactory(n.Types.COUNTRY)])})}}return m.Events=d.Events,m}),define("DS/MPFShowroomComponent/ShowroomGalleryForm",["UWA/Core","UWA/String","UWA/Promise","UWA/Class/View","DS/MPFServices/ObjectService","DS/MPFShowroomComponent/ImageUploadHelper","DS/MPFShowcaseItemModel/ShowcaseItemModel","DS/MPFShopModel/MediaModel","DS/MPFView/FieldFileInput","DS/MPFView/FieldTextInputV2","i18n!DS/MPFShowroomComponent/assets/nls/ShowroomComponent"],function(e,t,s,i,o,n,a,r,h,l,c){"use strict";const d=Object.freeze({NEW_FILE_SELECTED:"newFileSelected",INVALID_FILE_SELECTED:"invalidFileSelected",ON_CHANGE:"onChange"}),m=i.extend({className:"mpf-showroom-gallery-form mpf-form mpf-horizontal",setup:function(e){o.requiredOfPrototype(e.showcaseItem,a,"options.showcaseItem must be a ShowcaseItemModel"),o.requiredOfPrototype(e.mediaModel,r,"options.mediaModel must be a MediaModel"),o.requiredOfType(e.acceptedFileTypes,"array","options.acceptedFileTypes must be an array"),this.showcaseItem=e.showcaseItem,this.mediaModel=e.mediaModel,this.acceptedFileTypes=e.acceptedFileTypes,this.maxFileSize=e.maxFileSize,this.imageInput=this._createImageInput(),this.titleInput=this._createTitleInput(),this.descriptionInput=this._createDescriptionInput(),this.storeOldValues(),this.listenTo(this.imageInput,h.Events.NEW_FILE_SELECTED,this.dispatchEvent.bind(this,d.NEW_FILE_SELECTED)),this.listenTo(this.imageInput,h.Events.INVALID_FILE_SELECTED,this.dispatchEvent.bind(this,d.INVALID_FILE_SELECTED)),this.listenTo(this.titleInput,l.Events.UPDATE,this.dispatchEvent.bind(this,d.ON_CHANGE)),this.listenTo(this.descriptionInput,l.Events.UPDATE,this.dispatchEvent.bind(this,d.ON_CHANGE))},render:function(){return this.container.setContent([this.imageInput.render(),this.titleInput.render(),this.descriptionInput.render()]),this},validateInputs:function(){var e=[];return e.push(this.titleInput.validate().isValid),e.push(this.descriptionInput.validate().isValid),!this._validateImage()&&e.push(!1),e.indexOf(!1)<0},validateValues:function(){return!this.showcaseItem.validate()&&this._validateImage()&&!!this.titleInput.getValue()&&this.titleInput.getValue()===this.showcaseItem.getTitle()&&!!this.descriptionInput.getValue()&&this.descriptionInput.getValue()===this.showcaseItem.getDescription()},save:function(){return this.validateInputs()?n.saveFileAndShowcaseItem(this.imageInput,this.showcaseItem,this.mediaModel):s.reject("Validation failure")},destroy:function(){this.stopListening(),this.imageInput.destroy(),this.titleInput.destroy(),this.descriptionInput.destroy(),this.showcaseItem=null,this._parent(),this.container=null},storeOldValues:function(){this.oldValues=this.showcaseItem.omit()},restoreOldValues:function(){this.showcaseItem.set(this.oldValues),this.oldValues=null},hasPendingImageChange:function(){return e.is(this.imageInput.getFile())},_validateImage:function(){return!this.imageInput.isShowingError()&&e.is(this.showcaseItem.get(a.Fields.IMAGE))&&this.showcaseItem.get(a.Fields.IMAGE).length>0||e.is(this.imageInput.getFile())},_createImageInput:function(){let e=this.acceptedFileTypes[0];for(let t=1;t<this.acceptedFileTypes.length;t++)e+=", "+this.acceptedFileTypes[t];const s=t.format(c.get("uploadImageWithFormat"),e),i=this.showcaseItem.get(a.Fields.IMAGE);return new h({fileModel:this.mediaModel,fieldName:a.Fields.IMAGE,fieldLabel:c.get(a.Fields.IMAGE),showTextInput:!0,silent:!1,acceptedFileTypes:this.acceptedFileTypes,wrongFileTypeMessage:c.get("wrongFileTypeMessage"),maxFileSize:this.maxFileSize,placeholder:""!==i?c.get("noNewImageSelected"):c.get("noImageSelected"),buttonText:""!==i?c.get("replaceImage"):c.get("chooseImage"),required:!0,tooltip:s})},_createTitleInput:function(){return new l({className:"mpf-entry-v2 mpf-image-title",model:this.showcaseItem,fieldName:a.Fields.TITLE,fieldLabel:c.get("title"),placeholder:c.get(a.Fields.TITLE),required:!0,dynamicValidation:!0,keyUpValidation:!0,silent:!1})},_createDescriptionInput:function(){return new l({className:"mpf-entry-v2 mpf-image-description",model:this.showcaseItem,fieldName:a.Fields.DESCRIPTION,fieldLabel:c.get("description"),placeholder:c.get("addDescription"),required:!0,dynamicValidation:!0,keyUpValidation:!0,silent:!1,multiline:!0,multilineRows:3})}});return m.Events=d,m}),define("DS/MPFShowroomComponent/ShowroomGallery",["DS/MPFShowcaseItemModel/ShowcaseItemCollection","DS/MPFShowcaseItemModel/ShowcaseItemFactory","DS/MPFShopModel/MediaFactory","DS/MPFShowroomComponent/ImageGallery","DS/MPFShowroomComponent/ShowroomGalleryForm","DS/MPFShowroomComponent/ShowroomGalleryItem","DS/MPFShowroomComponent/ShowroomGalleryDescriptionModal","i18n!DS/MPFShowroomComponent/assets/nls/ShowroomComponent","css!DS/MPFShowroomComponent/MPFShowroomComponent"],function(e,t,s,i,o,n,a,r){"use strict";return i.extend({setup:function(e){e.acceptedFileTypes=e.acceptedFileTypes||["image/jpeg","image/png","image/bmp","image/gif"],e.maxFileSize=e.maxFileSize||2097152,e.editable=!0===e.editable,e.title=e.title||r.get("gallery"),e.itemType="image",e.subtitle=e.subtitle||(e.editable?r.get("showYourWork"):null),this._parent(e),this.descriptionModal=this._createDescriptionModal(),this.container.addClassName("mpf-showroom-gallery")},render:function(){return this._parent(),this.container.addContent(this.descriptionModal.render()),this},showDescriptionModal:function(e){this.descriptionModal.show(e)},createEditForm:function(e){return new o(e)},_createItem:function(e){const t=new n({showcaseItem:e,editable:this.editable});return this.listenTo(t,n.Events.SHOW_DESCRIPTION_MODAL,this.showDescriptionModal.bind(this)),t},_createDescriptionModal:function(){return new a}})}),define("DS/MPFShowroomComponent/ShowroomGalleryEditModal",["UWA/Core","UWA/String","UWA/Class/View","DS/UIKIT/Modal","DS/UIKIT/Input/Button","DS/UIKIT/Alert","DS/MPFView/FieldTextInputV2","DS/MPFView/FieldFileInput","DS/MPFServices/ObjectService","DS/MPFShowcaseItemModel/ShowcaseItemModel","DS/MPFShopModel/MediaModel","DS/MPFShowroomComponent/ShowroomGalleryDeleteModal","i18n!DS/MPFShowroomComponent/assets/nls/ShowroomComponent"],function(e,t,s,i,o,n,a,r,h,l,c,d,m){"use strict";var u,p={};return p.SAVE_NEW_ITEM="saveNewItemRequested",p.SAVE_EXISTING_ITEM="updateExistingRequested",p.ON_EDIT_MODAL_DISPLAYED="editingModalShowing",p.ON_DELETE="onDelete",(u=s.extend({className:"mpf-showroom-gallery-modal",setup:function(e){h.requiredOfPrototype(e.showcaseItem,l,"options.showcaseItem must be a ShowcaseItemModel"),h.requiredOfPrototype(e.mediaModel,c,"options.mediaModel must be a MediaModel"),this.acceptedFileTypes=e.acceptedFileTypes||["image/jpeg","image/png","image/bmp","image/gif"],this.maxFileSize=e.maxFileSize,this.showcaseItem=e.showcaseItem,this.mediaModel=e.mediaModel,this.editExisting=!0===e.editExisting,this.isLoading=!1,this.modal=this._createEditionModal(),this.editExisting&&!this.showcaseItem.isNew()&&(this.deleteModal=this._createDeletionModal()),this._createInputs(),this.alert=this._createAlert()},render:function(){return this.modal.setHeader([this._createModalHeader()]),this.modal.setBody([this.alert,this.imagePreview,e.createElement("div",{class:"mpf-form mpf-horizontal",html:[this.fileInput.render(),this.titleInput.render(),this.descriptionInput.render()]})]),this.modal.setFooter([this.saveButton,this.cancelButton,this.deleteButton]),this.container.setContent([this.modal,this.deleteModal]),this},destroy:function(){this.stopListening(),this.fileInput.destroy(),this.titleInput.destroy(),this.descriptionInput.destroy(),this.saveButton.removeEvents(),this.saveButton.destroy(),this.cancelButton.removeEvents(),this.cancelButton.destroy(),this.deleteButton&&(this.deleteButton.removeEvents(),this.deleteButton.destroy()),this.modal.destroy(),this.mediaModel.destroy(),this.mediaModel=null,this.showcaseItem=null,this._parent(),this.container=null},show:function(){return this._saveOldValues(),this.modal.show(),this},hide:function(){return this.mediaModel.clear(),this.setLoading(!1),this.modal.hide(),this._createInputs(),this.render()},validateValues:function(){return!this.showcaseItem.validate()&&this._validateImage()&&this.titleInput.getValue()&&this.descriptionInput.getValue()},validateInputs:function(){var e=[];return e.push(this.titleInput.validate().isValid),e.push(this.descriptionInput.validate().isValid),this._validateImage()||(e.push(!1),this.fileInput.showErrorMessage([{message:t.format(m.get("isRequired"),this.fileInput.fieldLabel)}])),e.indexOf(!1)<0},setLoading:function(e){e=!1!==e,this.isLoading=e,this.saveButton.load(e),this.fileInput.setDisabled(e),this.titleInput.setDisabled(e),this.descriptionInput.setDisabled(e)},_createInputs:function(){this.imagePreview=this._createImagePreview(),this.fileInput=this._createFileInput(),this.titleInput=this._createTitleInput(),this.descriptionInput=this._createDescriptionInput(),this.saveButton=this._createSaveButton(),this.cancelButton=this._createCancelButton(),this.editExisting&&!this.showcaseItem.isNew()?this.deleteButton=this._createDeleteButton():(this.deleteButton&&this.deleteButton.removeEvents(),this.deleteButton=null),this.listenTo(this.titleInput,a.Events.UPDATE,this._onChange.bind(this)),this.listenTo(this.descriptionInput,a.Events.UPDATE,this._onChange.bind(this))},_validateImage:function(){return e.is(this.showcaseItem.get(l.Fields.IMAGE))&&this.showcaseItem.get(l.Fields.IMAGE).length>0||e.is(this.fileInput.getFile())},_validateTitle:function(){return e.is(this.showcaseItem.get(l.Fields.TITLE))&&this.showcaseItem.get(l.Fields.TITLE).length>0},_validateDescription:function(){return e.is(this.showcaseItem.get(l.Fields.DESCRIPTION))&&this.showcaseItem.get(l.Fields.DESCRIPTION).length>0},_onChange:function(){this.isLoading||(this.validateValues()?this.saveButton.enable():this.saveButton.disable())},_onFileChange:function(e){if(e&&this.mediaModel.isNew()){var t=this,s=new window.FileReader;s.onload=function(){t.imagePreview.setStyle("background-image","url("+s.result+")"),t.imagePreview.removeClassName("mpf-background-placeholder"),t._onChange()},s.onerror=function(e){console.error(e),t.alert.add({className:"error",message:m.get("fileCouldNotBeLoaded")}).show()},s.readAsDataURL(e)}},_onSave:function(){this.validateInputs()&&(this.setLoading(!0),!this.editExisting&&this.showcaseItem.isNew()?this.dispatchEvent(p.SAVE_NEW_ITEM,{showcaseItem:this.showcaseItem,mediaModel:this.mediaModel,name:p.SAVE_NEW_ITEM}):this.dispatchEvent(p.SAVE_EXISTING_ITEM,{showcaseItem:this.showcaseItem,mediaModel:this.mediaModel,name:p.SAVE_EXISTING_ITEM}))},_onCancel:function(){this._restoreOldValues(),this.hide()},_onDelete:function(){this.deleteModal.render().show()},_saveOldValues:function(){this.oldValues={},this.oldValues[l.Fields.TITLE]=this.showcaseItem.get(l.Fields.TITLE),this.oldValues[l.Fields.DESCRIPTION]=this.showcaseItem.get(l.Fields.DESCRIPTION)},_restoreOldValues:function(){this.showcaseItem.set(this.oldValues)},_createEditionModal:function(){return new i({className:"site-reset",closable:!1,events:{onShow:this.dispatchEvent.bind(this,p.ON_EDIT_MODAL_DISPLAYED)}})},_createModalHeader:function(){return e.createElement("h4",{html:this.editExisting?m.get("editImage"):m.get("addNewImage")})},_createImagePreview:function(){var t=e.createElement("div",{class:"mpf-image-preview"});return this.showcaseItem.get("image")?t.setStyle("background-image","url("+this.showcaseItem.get("image")+")"):t.addClassName("mpf-background-placeholder"),t},_createFileInput:function(){for(var e=this.acceptedFileTypes[0],s=1;s<this.acceptedFileTypes.length;s++)e+=", "+this.acceptedFileTypes[s];var i=t.format(m.get("uploadImageWithFormat"),e),o=this.showcaseItem.get(l.Fields.IMAGE),n=new r({fileModel:this.mediaModel,fieldName:l.Fields.IMAGE,fieldLabel:m.get(l.Fields.IMAGE),showTextInput:!0,silent:!1,acceptedFileTypes:this.acceptedFileTypes,wrongFileTypeMessage:m.get("wrongFileTypeMessage"),maxFileSize:this.maxFileSize,placeholder:""!==o?m.get("noNewImageSelected"):m.get("noImageSelected"),buttonText:""!==o?m.get("replaceImage"):m.get("chooseImage"),required:!0,tooltip:i});return this.listenTo(n,r.Events.NEW_FILE_SELECTED,this._onFileChange.bind(this)),n},_createTitleInput:function(){return new a({className:"mpf-entry-v2 mpf-image-title",model:this.showcaseItem,fieldName:l.Fields.TITLE,fieldLabel:m.get(l.Fields.TITLE),placeholder:m.get(l.Fields.TITLE),required:!0,dynamicValidation:!0,keyUpValidation:!0,silent:!1})},_createDescriptionInput:function(){return new a({className:"mpf-entry-v2 mpf-image-description",model:this.showcaseItem,fieldName:l.Fields.DESCRIPTION,fieldLabel:m.get(l.Fields.DESCRIPTION),placeholder:m.get("addDescription"),required:!0,dynamicValidation:!0,keyUpValidation:!0,silent:!1,multiline:!0,multilineRows:3})},_createSaveButton:function(){var e=new o({className:"primary",value:m.get("save"),disabled:!0});return e.addEvent("onClick",this._onSave.bind(this)),e},_createCancelButton:function(){var e=new o({value:m.get("cancel")});return e.addEvent("onClick",this._onCancel.bind(this)),e},_createDeleteButton:function(){var e=new o({className:"error",value:m.get("delete")});return e.addEvent("onClick",this._onDelete.bind(this)),e},_createDeletionModal:function(){var e=new d({showcaseItem:this.showcaseItem}),t=this;return this.listenTo(e,d.Events.ON_DELETE,function(e){"successful"===e.status?t.dispatchEvent(p.ON_DELETE,e):t.alert.add({className:"error",message:m.get("deletionFailed")}).show()}),e},_createAlert:function(){return new n({autoHide:!0,hideDelay:3e3,closeOnClick:!0})}})).Events=Object.freeze(p),u}),define("DS/MPFShowroomComponent/ShowroomGalleryDropZone",["UWA/Core","UWA/Class/View","UWA/Promise","UWA/String","DS/MPFView/DropZone","DS/MPFShowroomComponent/ShowroomGalleryEditModal","DS/MPFDataProxy/Connector","DS/MPFShowcaseItemModel/ShowcaseItemFactory","DS/MPFShopModel/MediaFactory","DS/MPFModelFactory/MPFFactoriesV2","DS/MPFShowcaseItemModel/ShowcaseItemModel","DS/MPFShowcaseItemModel/ShowcaseItemCollection","DS/MPFShopModel/MediaModel","DS/MPFShopModel/MediaDataProxy","DS/MPFServices/ObjectService","DS/MPFError/BadArgumentError","i18n!DS/MPFShowroomComponent/assets/nls/ShowroomComponent"],function(e,t,s,i,o,n,a,r,h,l,c,d,m,u,p,g,S){"use strict";var f,I={};return I.UPDATE_GALLERY="updateGallery",(f=t.extend({className:"mpf-showroom-dropzone",setup:function(t){if(p.requiredOfPrototype(t.showcaseItems,d,"options.showcaseItems must be a ShowcaseItemCollection"),!e.is(t.showcaseItems.parentResourceId))throw new g("options.showcaseItems.parentResourceId must be defined to create ShowroomGalleryDropZone");this.showcaseItems=t.showcaseItems,!t.connector||t.mediaFactory||t.showcaseItemFactory?(p.requiredOfPrototype(t.mediaFactory,h,"options.mediaFactory must be a MediaFactory"),this.mediaFactory=t.mediaFactory,p.requiredOfPrototype(t.showcaseItemFactory,r,"options.showcaseItemFactory must be a ShowcaseItemFactory"),this.showcaseItemFactory=t.showcaseItemFactory):(p.requiredOfPrototype(t.connector,a,"options.connector must be a Connector"),this.connector=t.connector),this.additionalClass=t.additionalClass,this.acceptedFileTypes=t.acceptedFileTypes||["image/jpeg","image/png","image/bmp","image/gif"],this.maxFileSize=t.maxFileSize,e.is(t.additionalClass,"string")&&this.container.addClassName(t.additionalClass),this.Fields=c.Fields,this.dropZone=this._createDropZone(),this.listenTo(this.dropZone,"onClick",this._createModal.bind(this)),this.listenTo(this.dropZone,"onDrop",this._onDrop.bind(this))},render:function(){return this.container.setContent([this.dropZone.render()]),this},destroy:function(){this.stopListening(),this.dropZone.destroy(),this._destroyModal(),this.connector=null,this.showcaseItems=null,this._parent(),this.container=null},addClassName:function(e){return this.container.addClassName(e)},removeClassName:function(e){return this.container.removeClassName(e)},_createDropZone:function(){for(var e=this.acceptedFileTypes[0],t=1;t<this.acceptedFileTypes.length;++t)e+=", "+this.acceptedFileTypes[t];var s=i.format(S.get("uploadImageWithFormat"),e);return new o({acceptedFileTypes:this.acceptedFileTypes,maxFileSize:this.maxFileSize,tooltip:s})},_onDrop:function(e){for(var t=e.files,s=0;s<t.length;s++)this._createShowcaseItemOnDrop(t[s])},_createModal:function(){var e=this;return this._createBlankShowcaseItem().then(function(t){var s;s=e.mediaFactory?e.mediaFactory.createModel(h.Types.MEDIA):new m(null,{dataProxy:new u(e.connector)}),e._destroyModal(),e.modal=new n({showcaseItem:t,mediaModel:s,editExisting:!1,acceptedFileTypes:e.acceptedFileTypes,maxFileSize:e.maxFileSize}).inject(e.container).render().show(),e.listenTo(e.modal,"saveNewItemRequested",e._onSave),e.listenTo(e.modal,"updateExistingRequested",e._onSave)})},_destroyModal:function(){this.modal&&(this.modal.destroy(),this.modal=null)},_onSave:function(e){var t=this;this.dropZone.showLoading(),e.showcaseItem.savePromise().then(function(){return e.mediaModel.clear(),e.mediaModel.setParentResourceId(e.showcaseItem.get("id")),t.modal.fileInput.save()}).then(function(s){e.showcaseItem.set("image",s.get("image")),t.dropZone.hideLoading(),t.showcaseItems.push(e.showcaseItem),t.dispatchEvent(I.UPDATE_GALLERY),t._destroyModal()}).catch(function(s){t._onFileUploadFailed(e.showcaseItem,s)})},_onFileUploadFailed:function(e,t){e.destroy(),this.dropZone.hideLoading(),this.modal&&this.modal.modal&&this.modal.modal.isVisible?(this.modal.setLoading(!1),this.modal.alert.add({className:"error",message:S.get("fileUploadFailed")}).show()):this.dropZone.showAlert({className:"error",message:S.get("fileUploadFailed")}),console.error(t.response||t.message)},_createBlankShowcaseItem:function(){var e,t=this;return this.showcaseItemFactory?(e=this.showcaseItemFactory.createModel("shopServiceShowcaseItem",{itemType:"image"},{parentResourceId:t.showcaseItems.parentResourceId}),s.resolve(e)):l.getInstance(this.connector).getFactory(l.Types.SHOWCASE_ITEM).then(function(e){return e.createModel("shopServiceShowcaseItem",{itemType:"image"},{parentResourceId:t.showcaseItems.parentResourceId})})},_uploadImage:function(e,t){var i;i=this.mediaFactory?this.mediaFactory.createModel(h.Types.MEDIA,null,{parentResourceId:t}):new m(null,{dataProxy:new u(this.connector),parentResourceId:t});var o=s.deferred(),n=new FormData;n.append("file",e);var a={method:"POST"};return a.data=n,a.onComplete=o.resolve,a.onFailure=function(e,t,s){o.reject({model:e,response:t,options:s})},i.save(null,a),o.promise},_createShowcaseItemOnDrop:function(e){var t,s=this;this.dropZone.showLoading(),this._createBlankShowcaseItem().then(function(s){t=s;var i=e.name.substr(0,e.name.lastIndexOf(".")),o={};return o[c.Fields.TITLE]=i,o[c.Fields.DESCRIPTION]=i,t.set(o),t.savePromise()}).then(function(){return s._uploadImage(e,t.get("id"))}).then(function(e){t.set(s.Fields.IMAGE,e.get("image")),s.dropZone.hideLoading(),s.showcaseItems.push(t),s.dispatchEvent(I.UPDATE_GALLERY)}).catch(function(e){console.error(e),s._onFileUploadFailed(t,e)})}})).Events=Object.freeze(I),f});