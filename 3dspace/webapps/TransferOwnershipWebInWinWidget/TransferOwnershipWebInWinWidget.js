define("DS/TransferOwnershipWebInWinWidget/TransferOwnershipWebInWinWidget",["UWA/Controls/Abstract","DS/WidgetServices/WidgetServices","DS/TransferOwnershipWidget/component/TransferOwnershipWidget","DS/TransferOwnershipWidget/TransferOwnershipConstant","text!DS/TransferOwnershipWidget/assets/TOSettings.json","DS/WebToWinInfra/WebToWinCom","DS/WebInWinHelper/WebInWinHelper","DS/WidgetServices/securityContextServices/SecurityContextServices","DS/ENOCollabSharingCmds/BaseModels/ResultElement","css!DS/TransferOwnershipWidget/TransferOwnershipWidget.css","i18n!DS/TransferOwnershipWidget/assets/nls/TOSNls","i18n!DS/ENOCollabSharingCmds/assets/nls/langSharingCmds"],function(e,t,i,n,r,s,a,o,l,d,c,p){"use strict";return e.extend({itemListHasPriority:!1,defaultOptions:{className:"",context:null,ForbiddenChar:'"#$@%*,?\\<>[]|:',serverName:"",serverUri:"",activeFirstLineTable:!1,displaySoftDialog:!0,model:!0,wintop:!0,odtMode:!1,serverUrl:""},init:function(e,n,r){var l=null;this._parent(r),this.refreshData={};var d=this;if(this.options=r,a.initTenant(d),this.widget=e,this._parent(r),a.getServices(d),1==r.wintop&&(this.webToWinCom_Socket=s.createSocket({socket_id:"webinwinTransferOwnership_socket_"+Math.floor(1e5*Math.random()+1)})),this.options.webToWinComSocket=this.webToWinCom_Socket,this.options.webInWinHelper=a,1==r.wintop){void 0!==r.serverUrl&&r.serverUrl.length>0&&void 0!==r.serverUrl[0].platformId&&(l=r.serverUrl[0].platformId,this.tenantId=l,this.serverUrl=r.serverUrl[0]["3DSpace"],t.setTenantID(l)),this.container=UWA.createElement("div",{class:"collab-transfer-ownership-content"});d=this;var c={wintop:r.wintop,serverUrl:r.serverUrl};o.getInstance(c).getSecurityContext(),o.getInstance(c).getSecurityContext({onSuccess:function(t){if(null!=t&&""!=t&&t.hasOwnProperty("SecurityContext")){0!=t.SecurityContext.indexOf("ctx::")&&"ctx::"}d.TOSWidget=d.container=new i(e,n,{className:"transferOwnership_innerComponent",setCloseButton:!1,showTopBar:!0,genericTransfer:!0,topClassHeight:"TOSP_PopupDial",serverName:d.serverUrl,serverUri:d.serverUrl,activeDnD:r.activeDnD,activeOptions:r.activeOptions,oldClassName:r.className,securityContext:t.SecurityContext,serverUrl:r.serverUrl,wintop:r.wintop,odtMode:r.odtMode,events:{onNewSize:function(e){},onCancel:function(){d.dispatchEvent("onRefreshCancel")},onValidation:function(e){d.dispatchEvent("onValidation",e)},onTitleChange:function(e){},onLaunchReportingPanel:function(e){d.setRefreshSessionData(e),d.hideWidget()}}}),d.container.inject(n)},onFailure:function(e){alert("Error")}})}},initDatafromWin:function(e){this.phyIdList=[],this.mapOfPhyId={};var t=this;e.forEach(function(e){e.physicalId&&(e.physicalId in t.mapOfPhyId||(t.mapOfPhyId[e.physicalId]=e.name),t.phyIdList.push(e.physicalId))}),require(["DS/WidgetServices/WidgetServices","DS/TransferOwnershipWidget/component/TransferOwnershipWidget","DS/PADUtils/PADContext","DS/LifecycleServices/LifecycleServices","DS/LifecycleServices/LifecycleServicesSettings"],function(e,i,n,r,s){s.app_initialization(function(){r.listAttributes(t.tenantId,t.phyIdList,["attribute[PLMEntity.V_usage]","attribute[XCADEmbeddedCmp.V_IsEmbeddedComponent]","physicalid","owner","revision","attribute[PLMCoreRepReference.V_isOnceInstantiable]","attribute[Marketing Name]","organization","organization.property[Title].value","project","type","displayType","project.property[Title].value"],function(e){for(var i=0,n=0,r=[],s=0;s<e.results.length;s++){var a=e.results[s],o=a.physicalid,d={},c=t.mapOfPhyId[o];d.physicalId=a.physicalid;"3DPart"==a["attribute[PLMEntity.V_usage]"]&&a.type;null===a["attribute[XCADEmbeddedCmp.V_IsEmbeddedComponent]"]||0==a["attribute[XCADEmbeddedCmp.V_IsEmbeddedComponent]"]?d.v_IsEmbeddedComponent=0:(d.v_IsEmbeddedComponent=1,i++);var g;1==(g="3DPart"==a["attribute[PLMEntity.V_usage]"]&&"3DShape"==a.type)&&n++,d.aggrObj=g,d.Revision=a.revision,d.organization=a.organization,d.type=a.type,null==a["organization.property[Title].value"]||""===a["organization.property[Title].value"]?d.organizationTitle=a.organization:d.organizationTitle=a["organization.property[Title].value"],d.project=a.project,null===a["project.property[Title].value"]||""===a["project.property[Title].value"]?d.projectTitle=a.project:d.projectTitle=a["project.property[Title].value"],d.owner=a.owner,d.responsibleName=a.ownerFullName,d.typeDisplayName=a.displayType;var h=new l({urlIcon:"",physicalId:d.physicalId,name:c,title:c,category:"bus",type:d.type,typeDisplayName:d.typeDisplayName,relID:"",parentID:"",cadMaster:"",parentCADMaster:"",responsibleName:d.responsibleName,Revision:d.Revision,projectTitle:d.projectTitle,project:d.project,organizationTitle:d.organizationTitle,organization:d.organization,aggrObj:d.aggrObj,v_IsEmbeddedComponent:d.v_IsEmbeddedComponent});r.push(h)}if(i!=t.phyIdList.length)if(n!=t.phyIdList.length)t.TOSWidget.initData(r,"");else{m=p.get("selectOwning");t.options.webToWinComSocket.dispatchEvent("onDispatchToWin",{notif_name:"invalidSelection",notif_parameters:{severity:"error",message:m}},"lf_web_in_win")}else{var m=p.get("selectOwning");t.options.webToWinComSocket.dispatchEvent("onDispatchToWin",{notif_name:"invalidSelection",notif_parameters:{severity:"error",message:m}},"lf_web_in_win")}})})})},hideWidget:function(){this.TOSWidget&&this.TOSWidget.hide(),this.widget.getElement(".command_dialog")&&(this.widget.getElement(".command_dialog").style.height="100%",this.widget.getElement(".command_dialog").style.width="100%",this.widget.getElement(".floatingPanel_RightButtons")&&(this.widget.getElement(".fonticon-resize-full")&&this.widget.getElement(".fonticon-resize-full").click(),this.widget.getElement(".floatingPanel_RightButtons").style.display="none"),this.widget.getElement(".modal-body")&&(this.widget.getElement(".modal-body").style.maxHeight="100%",this.widget.getElement(".modal-body").style.maxWidth="100%"))},setRefreshSessionData:function(e){var t,i=[];if(e&&e.OKdata&&Array.isArray(e.OKdata)){e.KOdata&&Array.isArray(e.KOdata)&&e.OKdata.concat(e.KOdata);for(var n=0;n<e.OKdata.length;n++)i.push({physicalid:e.OKdata[n][0]})}i.length>0&&(t=this.options.webInWinHelper.createJSONArraySelect(i),this.refreshData=t,this.options.webToWinComSocket.dispatchEvent("onDispatchToWin",{notif_name:"refreshSession",notif_parameters:t},"lf_web_in_win"))},postResize:function(e){var t=this.widget.getElement(".command_dialog");t&&t.length>0&&(this.widget.getElement(".command_dialog").style.height="100%",this.widget.getElement(".command_dialog").style.width="100%")},onResize:function(){this.widget.getElement(".command_dialog")&&(this.widget.getElement(".command_dialog").style.height="100%",this.widget.getElement(".command_dialog").style.width="100%",this.widget.getElement(".modal-body")&&(this.widget.getElement(".modal-body").style.maxHeight="100%",this.widget.getElement(".modal-body").style.maxWidth="100%"))},getDimensions:function(){return this.widget.getElement(".collab-transfer-ownership-content").getBoundingClientRect()}})});