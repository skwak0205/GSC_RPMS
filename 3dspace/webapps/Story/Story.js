define("DS/Story/HandlebarsHelpers",["DS/Handlebars/Handlebars"],function(t){"use strict";"ifcond"in t.helpers||t.registerHelper("ifcond",function(t,e,i){return t===e?i.fn(this):i.inverse(this)}),"times"in t.helpers||t.registerHelper("times",function(t,e){for(var i="",n=1;n<=t;++n)i+=e.fn(n);return i})}),define("DS/Story/View",function(){"use strict";return{creator:"CREATOR",reader:"READER",owner:"OWNER"}}),define("DS/Story/WidgetsView",["DS/PubSub/PubSub","DS/Dashboard/PublicAPI"],function(t,e){"use strict";var i,n={};return{init:function(o){var s=o&&o.onEvent;[e.events.widget._enterFullscreen,e.events.widget._enterMaximized].forEach(function(e){t.add(e,function(t){var o=t&&t.id,r=t&&t.name,a={event:e,name:r,id:o};o&&r&&i&&(n[i]=n[i]||{},n[i][o]=a,s&&s(a))})}),t.add(e.events.widget._enterWindowed,function(t){var o=t&&t.id,r=t&&t.name,a=i&&n[i],l=o&&a&&a[o],c={event:e.events.widget._enterWindowed,name:r,id:o};l&&(delete a[o],s&&s(c))}),t.add(e.events.tab.change,function(t){t&&(i=t)})},fromTab:function(){return i&&n[i]}}}),define("DS/Story/Utils",function(){"use strict";return{isObject:function(t){return t&&"object"==(void 0===t?"undefined":typeof t)&&t.constructor===Object},isString:function(t){return"string"==typeof t||t instanceof String},isBoolean:function(t){return"boolean"==typeof t},isNumber:t=>"number"==typeof t&&isFinite(t),isHidden:function(t){return null===t.offsetParent},isValidScenario:function(t){var e=this,i=!0;return!!Array.isArray(t)&&(t.forEach(function(t,n){e.isObject(t)&&e.isString(t.element)&&e.isString(t.content)||(i=!1),0===n&&e.isObject(t)&&e.isString(t.intro)&&(i=!0)}),i)},isValidScenarioIndex:function(t,e){return e>=0&&e<=t.length},getEmptyScenarioIndex:function(t,e){return t.length<e?t.length:t.findIndex(function(t){return 0===t.length})},isIntro:function(t){return this.isObject(t)&&this.isString(t.intro)},isWidget:function(t){return this.isObject(t)&&this.isBoolean(t.widget)},getElement:function(t){return this.isString(t)?document.querySelector(t):t},getWidget:function(t){var e;if(t)for(e=t;null!==e;){if(!e.tagName||"body"===e.tagName.toLowerCase()){e=null;break}var i=e.className;if(i.indexOf("wi-")>=0&&i.indexOf("module")>=0&&i.indexOf("moduleEditable")>=0)break;e=e.parentNode}return e},getTab:function(t){var e;if(t)for(e=t;null!==e;){if(!e.tagName||"body"===e.tagName.toLowerCase()){e=null;break}if(e.getAttribute("data-tabId"))break;e=e.parentNode}return e},sanitize:function(t){if(!this.isString(t))return t;var e={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"};return t.replace(/[&<>"'/]/gi,function(t){return e[t]})},sanitizeScenario:function(t){var e=this;return Array.isArray(t)&&t.forEach(function(t){e.isObject(t)&&["title","intro","content"].forEach(function(i){t[i]&&(t[i]=e.sanitize(t[i]))})}),t},sanitizeScenarios:function(t){return Array.isArray(t)?t.map(this.sanitizeScenario,this):t}}}),define("DS/Story/Mode",function(){"use strict";return{full:"FULL",degraded:"DEGRADED",disabled:"DISABLED"}}),define("DS/Story/Alert",["DS/UIKIT/Alert"],function(t){"use strict";return{Manager:{init:function(e){this.alert=new t({closable:!0,visible:!0,autoHide:!1,closeOnClick:!1,className:"dashboard-story-alert hide",events:e.events}),this.alert.inject(document.body,"top")},setMessage:function(t){this.message=UWA.createElement("div",{html:t})},showMessage:function(t){this.alert.elements.container.classList.remove("hide"),this.alert.add({className:t?"warning":"primary",message:this.message.getHTML()})},remove:function(){var t=this;t.alert.getMessages().forEach(function(e){t.alert.remove(e)}),this.alert.elements.container.classList.add("hide")}}}}),define("DS/Story/Path",["UWA/Core","UWA/Utils","DS/Handlebars/Handlebars","DS/Story/HandlebarsHelpers","DS/Story/Mode","DS/Story/Utils","DS/UIKIT/Tooltip","DS/WebappsUtils/Utils","DS/Dashboard/UsageTracker","DS/Dashboard/CommentPanelManager","DS/Dashboard/PublicAPI","DS/PubSub/PubSub","text!DS/Story/assets/template/skeleton.html","text!DS/Story/assets/template/bubble.html","i18n!DS/Story/assets/nls/Path","i18n!DS/Dashboard/assets/nls/main","css!DS/Story/assets/stylesheet/path.css"],function(t,e,i,n,o,s,r,a,l,c,h,u,d,b,p,m){"use strict";function g(t){this.config={highlight:{padding:5},bubble:{arrow:10}},(t=t||{}).scenario&&this.setScenario(t.scenario),this.id=Date.now(),this.zIndexElementsChanges={elements:[],parentElements:[]},this.zIndexCommentElementsChanges={elements:[],parentElements:[]},this.stepNumber=1,this.isEditable=!!t.isEditable,this.enableHighlight=!0,this.bubbleTemplate=t.template||b,this.skeletonTemplate=i.compile(d)({id:this.id}),this.isRunning=!1,this.TAB_SCROLL_DURATION=300,this.selectors={tabs:".wp-drop[data-tabid]",tabsContainer:".wp-tablist-scroller",tabsScroller:".wp-tablist-scroller .uwa-scroller",tabsNavigation:".wp-scroller-button",tabsAddNewContainer:".wp-scroller-button-ctn.next",tabsAddNew:".wp-tab-addlist",container:".tuto-container-"+this.id,bubbleContainer:".tuto-bubble-container",tutoHighlight:".tuto-highlight.tuto-scenario",tutoOverlay:".tuto-overlay",bubbleClose:".tuto-close",bubbleEdit:".tuto-edit",bubbleArrow:".tuto-arrow",bubblePrevious:".tuto-prevbutton",bubbleNext:".tuto-nextbutton",bubbleFinish:".tuto-finishbutton",menuContainer:".tuto-menu",menuItemComment:".tuto-menu .tuto-menu-item.tuto-comment",menuItemClose:".tuto-menu .tuto-menu-item.tuto-close"},this.container=document.body.querySelector(this.selectors.container),this.container&&console.error("Path#constructor > Instance of Path already exist"),document.body.insertAdjacentHTML("beforeend",this.skeletonTemplate),this.container=document.body.querySelector(this.selectors.container),this.bubbleContainer=this.container.querySelector(this.selectors.bubbleContainer),this.bubbleArrow=this.container.querySelector(this.selectors.bubbleArrow),this.tutoHighlight=this.container.querySelector(this.selectors.tutoHighlight),this.tutoOverlay=this.container.querySelector(this.selectors.tutoOverlay),this.menuContainer=this.container.querySelector(this.selectors.menuContainer),this.menuItemComment=this.container.querySelector(this.selectors.menuItemComment),this.menuItemClose=this.container.querySelector(this.selectors.menuItemClose),[{target:this.menuItemComment,body:h._isEndUserCockpitContext()?m.cockpitComments:m.dashboardComments},{target:this.menuItemClose,body:p.close}].forEach(function(t){new r({position:"bottom",target:t.target,body:t.body,offset:{x:0,y:0}})}),this._highLight=a.throttle(this._highLight,30,!1,!0,this),this._updateBubblePosition=a.throttle(this._updateBubblePosition,30,!1,!0,this),this._keyboardNavigation=this._keyboardNavigation.bind(this),this.stop=this.stop.bind(this),this.previousStep=this.previousStep.bind(this),this.nextStep=this.nextStep.bind(this),this.toggleComment=function(){this.menuItemComment.classList.contains("active")?this._hideComment():this._showComment()}.bind(this);var e=function(){return!0};this.onClickMenuEdit=t.onClickMenuEdit||e,this.onAfterNext=t.onAfterNext||e,this.onAfterPrevious=t.onAfterPrevious||e,this.onStart=t.onStart||e,this.onStop=t.onStop||e}return g.prototype.start=function(){this.isRunning=!0,this._disableTabsInteractions(),this.render(),this._attachBubbleMoveTrigger(),this._attachKeyboardNavigation(),this._attachMenuEvent(),this.menuContainer.classList.add("show"),c.isOpen()&&this._showComment(),this.onStart(),l.track({category:"dashboard.story",action:"start-story"})},g.prototype.stop=function(){this._enableTabsInteractions(),this._enableCurrentWidgetInteractions(),this.hide(),this._detachHighlightTrigger(),this._detachBubbleMoveTrigger(),this._detachMenuEvent(),this.menuContainer.classList.remove("show"),this._resetZIndex(this.zIndexElementsChanges),this._resetZIndex(this.zIndexCommentElementsChanges),this.stepNumber=1,this._detachKeyboardNavigation(),this._detachBubbleEvent(),this.isRunning=!1,this.onStop(),l.track({category:"dashboard.story",action:"stop-story"})},g.prototype.show=function(t){var e=t&&t.element||"all";["container","all"].includes(e)&&this.container.classList.add("show"),["overlay","all"].includes(e)&&this.tutoOverlay.classList.add("show"),["bubble","all"].includes(e)&&(this.bubbleContainer.classList.add("show"),this.tutoHighlight.classList.add("show"),this.bubbleArrow.classList.add("show"))},g.prototype.hide=function(t){var e=t&&t.element||"all";["container","all"].includes(e)&&this.container.classList.remove("show"),["overlay","all"].includes(e)&&this.tutoOverlay.classList.remove("show"),["bubble","all"].includes(e)&&(this.bubbleContainer.classList.remove("show"),this.tutoHighlight.classList.remove("show"),this.bubbleArrow.classList.remove("show"))},g.prototype.isRunning=function(){return this.isRunning},g.prototype.setMode=function(t){var e=this.stepNumber-1,i=this.scenario[e],n=!0;return s.isWidget(i)?t===o.full?(this.enableHighlight=!0,this.render(),this._attachKeyboardNavigation()):t===o.degraded?(this.enableHighlight=!1,this.hide({element:"bubble"}),this._detachKeyboardNavigation()):t===o.disabled&&(this.enableHighlight=!1,this.hide({element:"bubble"}),this._detachKeyboardNavigation()):n=!1,n},g.prototype.render=function(){var t,e,n,o,r=this.stepNumber-1,a=this.scenario[r],l=s.isIntro(a),c=8;if(this._resetZIndex(this.zIndexElementsChanges),this.show(),this.bubbleContainer.innerHTML=i.compile(this.bubbleTemplate)({stepNumber:(t=this.stepNumber,e=this.scenario.length,n=Math.min(c,e),o=n/2,t+o<e&&t-o>0?(n-0)/2:t+o>=e?n-(e-t):t-o<=0?t:void 0),stepSize:Math.min(c,this.scenario.length),isEditable:this.isEditable,isIntro:l,isLast:this.stepNumber===this.scenario.length,content:l?a.intro:a.content,title:this.getTitle(),Nls:p}),l)this._detachHighlightTrigger(),this._updateBubblePositionToCenter();else{var h=a.element,u=s.getElement(h);this._focusOnTab(h),u&&!s.isHidden(u)?(this._setForegroundZindex(u,this.zIndexElementsChanges),this.highLight(u),this._updateBubblePosition(),this._disableCurrentWidgetInteractions()):(u?s.isHidden(u)&&a.widget&&this.onError(p.widgetStoryMoved):(a.widget&&this.onError(p.widgetStoryDeleted),a.tab&&this.onError(p.tabStoryDeleted)),this._detachHighlightTrigger(),this._updateBubblePositionToCenter())}this._attachBubbleEvent(),this._addTooltips()},g.prototype.nextStep=function(){this._moveOneStep(this.stepNumber+1,this.onAfterNext,"next-item")},g.prototype.previousStep=function(){this._moveOneStep(this.stepNumber-1,this.onAfterPrevious,"previous-item")},g.prototype._moveOneStep=function(t,e,i){var n,o,r;this._enableCurrentWidgetInteractions(),this.setStep(t),this.render(),n=this.stepNumber-1,o=this.scenario[n],r=s.isWidget(o),e.call(this,{step:o,skip:!r,element:s.getElement(o.element)}),l.track({category:"dashboard.story",action:i})},g.prototype.setStep=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;t=Math.min(this.scenario.length,t),this.stepNumber=Math.max(1,t)},g.prototype.setScenario=function(t){s.isValidScenario(t)?this.scenario=t:console.error("Path#setScenario > Wrong scenario")},g.prototype.getEmptyScenario=function(){return[]},g.prototype.getCurrentStepElement=function(){var t=this.stepNumber-1,e=t&&this.scenario[t],i=e&&e.element;return i&&s.getElement(i)},g.prototype.getTitle=function(){return this.scenario[0].title},g.prototype._getTab=function(t){var e=s.getElement(t),i=void 0;return this.scenario.some(function(t){if(t.tab&&(i=s.getElement(t.element)),e===s.getElement(t.element))return!0}),i},g.prototype._focusOnTab=function(t){var e=this,i=e._getTab(t);i?(h._setActiveTab(i),e.hide({element:"bubble"}),setTimeout(function(){e.show(),i.click()},e.TAB_SCROLL_DURATION)):console.error("Path#focusOnTab > No tab added in the scenario for the current step")},g.prototype._enableTabsInteractions=function(){var t=document.querySelectorAll(this.selectors.tabs);[].forEach.call(t,function(t){var e=t.querySelector(".title"),i=t.querySelector(".action");e.style.pointerEvents="auto",i.style.pointerEvents="auto"})},g.prototype._disableTabsInteractions=function(){var t=document.querySelectorAll(this.selectors.tabs);[].forEach.call(t,function(t){var e=t.querySelector(".title"),i=t.querySelector(".action");e.style.pointerEvents="none",i.style.pointerEvents="none"})},g.prototype._enableCurrentWidgetInteractions=function(t){if(!t){var e=this.stepNumber-1,i=this.stepNumber&&this.scenario[e],n=i&&i.element;t=n&&s.getElement(n)}var o=t&&t.querySelector(".moduleHeader");[o&&o.querySelector(".fonticon-minus"),o&&o.querySelector(".fonticon-down-open")].forEach(function(t){t&&(t.style.removeProperty("pointer-events"),t.style.removeProperty("cursor"))})},g.prototype._disableCurrentWidgetInteractions=function(t){if(!t){var e=this.stepNumber-1,i=this.stepNumber&&this.scenario[e],n=i&&i.element;t=n&&s.getElement(n)}var o=t&&t.querySelector(".moduleHeader");[o&&o.querySelector(".fonticon-minus"),o&&o.querySelector(".fonticon-down-open")].forEach(function(t){t&&(t.style.pointerEvents="none",t.style.cursor="context-menu")})},g.prototype._attachHighlightTrigger=function(t){this._detachHighlightTrigger(),t.addEventListener("transitionend",this._highLight),this._getScrollableContainer(t).addEventListener("scroll",this._highLight),this._getScrollableContainer(t).addEventListener("touchmove",this._highLight),document.querySelector(this.selectors.tabsScroller).addEventListener("scroll",this._highLight)},g.prototype._detachHighlightTrigger=function(){var t=this;this.scenario.forEach(function(e){var i=s.getElement(e.element);i&&i.removeEventListener("transitionend",t._highLight),i&&t._getScrollableContainer(i)&&t._getScrollableContainer(i).removeEventListener("scroll",t._highLight),i&&t._getScrollableContainer(i)&&t._getScrollableContainer(i).removeEventListener("touchmove",t._highLight),document.querySelector(t.selectors.tabsScroller).removeEventListener("scroll",t._highLight)})},g.prototype._attachBubbleMoveTrigger=function(){window.addEventListener("resize",this._updateBubblePosition),this._getCommentPanel(!0).addEvent("resize",this._updateBubblePosition)},g.prototype._detachBubbleMoveTrigger=function(){window.removeEventListener("resize",this._updateBubblePosition),this._getCommentPanel(!0).addEvent("resize",this._updateBubblePosition)},g.prototype._keyboardNavigation=function(t){var e=t.keyCode;37===e?this.previousStep():39===e&&this.nextStep()},g.prototype._attachKeyboardNavigation=function(){document.addEventListener("keyup",this._keyboardNavigation)},g.prototype._detachKeyboardNavigation=function(){document.removeEventListener("keyup",this._keyboardNavigation)},g.prototype._attachBubbleEvent=function(){var t=this,e=this.bubbleContainer.querySelector(this.selectors.bubbleClose),i=this.bubbleContainer.querySelector(this.selectors.bubbleEdit),n=this.container.querySelector(this.selectors.bubblePrevious),o=this.container.querySelector(this.selectors.bubbleNext),s=this.container.querySelector(this.selectors.bubbleFinish);e&&e.addEventListener("click",this.stop),i&&i.addEventListener("click",function(){return t.onClickMenuEdit(t.stepNumber)}),n&&n.addEventListener("click",this.previousStep),o&&o.addEventListener("click",this.nextStep),s&&s.addEventListener("click",this.stop)},g.prototype._detachBubbleEvent=function(){var t=this.bubbleContainer.querySelector(this.selectors.bubbleClose),e=this.bubbleContainer.querySelector(this.selectors.bubbleEdit),i=this.container.querySelector(this.selectors.bubblePrevious),n=this.container.querySelector(this.selectors.bubbleNext),o=this.container.querySelector(this.selectors.bubbleFinish);t&&t.removeEventListener("click",this.stop),e&&e.removeEventListener("click",this.onClickMenuEdit),i&&i.removeEventListener("click",this.previousStep),n&&n.removeEventListener("click",this.nextStep),o&&o.removeEventListener("click",this.stop)},g.prototype._attachMenuEvent=function(){this.menuItemComment.addEventListener("click",this.toggleComment),this.menuItemClose.addEventListener("click",this.stop)},g.prototype._detachMenuEvent=function(){this.menuItemComment.removeEventListener("click",this.toggleComment),this.menuItemClose.removeEventListener("click",this.stop)},g.prototype._addTooltips=function(){[{target:this.bubbleContainer.querySelector(this.selectors.bubbleClose),body:p.close},{target:this.bubbleContainer.querySelector(this.selectors.bubbleEdit),body:p.edit}].forEach(function(t){t.target&&new r({position:"bottom",target:t.target,body:t.body,offset:{x:0,y:0}})})},g.prototype._highLight=function(){var t=this.stepNumber-1,e=t&&this.scenario[t]&&this.scenario[t].element&&s.getElement(this.scenario[t].element),i=e&&e.getBoundingClientRect();this.enableHighlight&&e&&(this.tutoHighlight.style.top=i.top-this.config.highlight.padding+"px",this.tutoHighlight.style.left=i.left-this.config.highlight.padding+"px",this.tutoHighlight.style.width=i.width+parseInt(getComputedStyle(e).marginLeft,10)+parseInt(getComputedStyle(e).marginRight,10)+2*this.config.highlight.padding+"px",this.tutoHighlight.style.height=i.height+parseInt(getComputedStyle(e).marginTop,10)+parseInt(getComputedStyle(e).marginBottom,10)+2*this.config.highlight.padding+"px",this._updateBubblePosition())},g.prototype.highLight=function(t){this._attachHighlightTrigger(t),this._isElementInViewport(t)||t.scrollIntoView({behavior:"smooth"}),t.click(),t&&this._getScrollableContainer(t)&&this._getScrollableContainer(t).dispatchEvent(new Event("scroll")),this._highLight(),setTimeout(this._highLight,500),setTimeout(this._highLight,1500),setTimeout(this._highLight,2e3)},g.prototype._setForegroundZindex=function(t,i){function n(t,e){var i="";return t.currentStyle?i=t.currentStyle[e]:document.defaultView&&document.defaultView.getComputedStyle&&(i=document.defaultView.getComputedStyle(t,null).getPropertyValue(e)),i&&i.toLowerCase?i.toLowerCase():i}t!==this._getCommentPanel(!0)&&!["absolute","relative","fixed"].indexOf(t.style.position)>-1&&t.classList.add("tuto-relative-position"),t.classList.add("tuto-show-element"),i.elements.push(t);for(var o=t.parentNode;null!==o&&o.tagName&&"body"!==o.tagName.toLowerCase();){var s=document.defaultView.getComputedStyle(o).getPropertyValue("z-index"),r=o.style.opacity||1,a=n(o,"transform")||n(o,"-webkit-transform")||n(o,"-moz-transform")||n(o,"-ms-transform")||n(o,"-o-transform"),l=e.Client.Platform.ios&&-1!==o.className.indexOf("wp-tabview-panel");(/[0-9]+/.test(s)||r<1||"none"!==a&&void 0!==a||l)&&(o.classList.add("tuto-parent-zIndex"),i.parentElements.push(o)),o=o.parentNode}},g.prototype._resetZIndex=function(t){t.elements.length&&[].forEach.call(t.elements,function(t){t.classList.remove("tuto-show-element"),t.classList.remove("tuto-relative-position")}),t.elements=[],t.parentElements.length&&[].forEach.call(t.parentElements,function(t){t.classList.remove("tuto-parent-zIndex")}),t.parentElements=[]},g.prototype._isElementInViewport=function(e){return t.extendElement(e).isInViewport(document.body,!1)},g.prototype._getScrollableContainer=function(t){var e=null;if(t.getAttribute("data-tabId"))e=document.getElementById(t.getAttribute("data-tabId"));else for(var i=t.parentNode;null!==i&&i.tagName&&"body"!==i.tagName.toLowerCase();){if(i.classList.contains("wp-tabview-panel")){e=i;break}i=i.parentNode}return e},g.prototype._getBubbleBoundaries=function(){var t=this._getCommentPanel(),e=t&&t.getBoundingClientRect();return{left:0,top:0,right:e?e.left:window.innerWidth,bottom:window.innerHeight-1}},g.prototype._updateBubblePosition=function(){var t,e,i,n,o,r,a=this.stepNumber-1,l=this.stepNumber&&this.scenario[a],c=l&&l.element,h=c&&s.getElement(c),u=h&&h.getBoundingClientRect(),d=this.bubbleContainer.getBoundingClientRect(),b=this._getBubbleBoundaries();return h?(this.bubbleContainer.classList.remove("top"),this.bubbleContainer.classList.remove("left"),this.bubbleContainer.classList.remove("right"),this.bubbleContainer.classList.remove("bottom"),this.bubbleContainer.classList.remove("center"),this.show({element:"bubble"}),t=(u.left+u.right)/2,e=d.width/2,n=(i=u.bottom+this.config.bubble.arrow+this.config.highlight.padding)+d.height,(r=(o=t-e>0?t-e:0)+d.width)<=b.right&&i>=b.top&&n<=b.bottom?(this.bubbleContainer.style.top=i+"px",this.bubbleContainer.style.left=o+"px",this.bubbleContainer.classList.add("bottom"),void this._updateArrowBubblePosition(0,{top:u.bottom+this.config.highlight.padding,left:t})):(t=(u.left+u.right)/2,e=d.width/2,n=(i=u.top-d.height-this.config.bubble.arrow-this.config.highlight.padding)+d.height,(r=(o=t-e>0?t-e:0)+d.width)<=b.right&&i>=b.top&&n<=b.bottom?(this.bubbleContainer.style.top=i+"px",this.bubbleContainer.style.left=o+"px",this.bubbleContainer.classList.add("top"),void this._updateArrowBubblePosition(2,{top:u.top-this.config.bubble.arrow-this.config.highlight.padding,left:t})):(n=(i=(t=(u.top+u.bottom)/2)-(e=d.height/2)>0?t-e:0)+d.height,r=(o=u.left-d.width-this.config.bubble.arrow-this.config.highlight.padding)+d.width,o>=b.left&&r<=b.right&&n<=b.bottom?(this.bubbleContainer.style.top=i+"px",this.bubbleContainer.style.left=o+"px",this.bubbleContainer.classList.add("left"),void this._updateArrowBubblePosition(1,{top:t,left:u.left-this.config.bubble.arrow-this.config.highlight.padding})):(n=(i=(t=(u.top+u.bottom)/2)-(e=d.height/2)>0?t-e:0)+d.height,r=(o=u.right+this.config.bubble.arrow+this.config.highlight.padding)+d.width,o>=b.left&&r<=b.right&&n<=b.bottom?(this.bubbleContainer.style.top=i+"px",this.bubbleContainer.style.left=o+"px",this.bubbleContainer.classList.add("right"),void this._updateArrowBubblePosition(3,{top:t,left:u.right+this.config.highlight.padding})):void this._updateBubblePositionToCenter(!0))))):this._updateBubblePositionToCenter(!1)},g.prototype._updateBubblePositionToCenter=function(t){var e=this._getBubbleBoundaries();this.bubbleContainer.classList.remove("top"),this.bubbleContainer.classList.remove("left"),this.bubbleContainer.classList.remove("right"),this.bubbleContainer.classList.remove("bottom"),this.bubbleContainer.style.top=(e.bottom-e.top)/2+"px",this.bubbleContainer.style.left=(e.right-e.left)/2+"px",!t&&this.tutoHighlight.classList.remove("show"),this.bubbleArrow.classList.remove("show"),this.bubbleContainer.classList.add("center")},g.prototype._updateArrowBubblePosition=function(t,e){this.bubbleArrow.classList.remove("top"),this.bubbleArrow.classList.remove("right"),this.bubbleArrow.classList.remove("bottom"),this.bubbleArrow.classList.remove("left"),0===t?this.bubbleArrow.classList.add("top"):1===t?this.bubbleArrow.classList.add("right"):2===t?this.bubbleArrow.classList.add("bottom"):this.bubbleArrow.classList.add("left"),this.bubbleArrow.style.top=e.top+"px",this.bubbleArrow.style.left=e.left+"px"},g.prototype._showComment=function(){var t=this._getCommentPanel(!0);this._setForegroundZindex(t,this.zIndexCommentElementsChanges),this.menuItemComment.classList.add("active"),u.addOnce(h.events.rightpanel.comment.close,this.toggleComment),c.open()},g.prototype._hideComment=function(){this._resetZIndex(this.zIndexCommentElementsChanges),this.menuItemComment.classList.remove("active"),u.remove(h.events.rightpanel.comment.close,this.toggleComment),c.close()},g.prototype._getCommentPanel=function(e){if(c.isOpen()||e)return t.extendElement(document.body.querySelector(".column.right"))},g}),define("DS/Story/ModeManager",["DS/Dashboard/PublicAPI","DS/Story/WidgetsView","DS/Story/Alert","DS/Story/Mode","DS/PubSub/PubSub","DS/UWPClientCode/I18n","DS/Story/View","i18n!DS/Story/assets/nls/Alert"],function(t,e,i,n,o,s,r,a){"use strict";function l(t){var e=t&&t.creatorView,n=t&&t.warning,o=e?a.restoreCreate:a.restoreRead,r=s.replace(o,{name:t.name});i.Manager.setMessage(r),i.Manager.showMessage(n)}return{init:function(s){var r=this;r.setMode=s&&s.setMode,r.storyView=s&&s.storyView,r.setMode&&e.init({onEvent:function(e){var o=e&&e.name,s=e&&e.event,a=e&&e.id;s&&a&&(s===t.events.widget._enterWindowed?(r.setMode({widget:a,degraded:!1}),i.Manager.remove()):[t.events.widget._enterFullscreen,t.events.widget._enterMaximized].includes(s)&&o&&r.setMode({widget:a,degraded:!0}).then(function(t){t&&l({name:o,warning:t===n.disabled})}))}}),i.Manager.init({events:{onClick:function(e){var n=e.target;n&&"b"===n.tagName.toLocaleLowerCase()&&r.setMode({degraded:!1}).then(function(e){e&&(o.dispatch(t.events.widget._exitFullscreen),o.dispatch(t.events.widget._exitMaximized),i.Manager.remove())})}}})},isRunnable:function(i){var o,s,a=this,c=i&&i.skip,h=e.fromTab(),u=h&&Object.keys(h),d=u&&u.length>0;return c?s=!0:d?!(s=!(o=u.find(function(e){return h[e]!==t.events.widget._enterWindowed})))&&a.setMode&&a.setMode({widget:o,degraded:!0}).then(function(t){t&&a.storyView().then(function(e){l({name:h[o].name,warning:t===n.disabled,creatorView:e===r.creator})})}):s=!0,s}}}),define("DS/Story/DashboardStories",["DS/UWPClientControls/PlatformNotify","DS/UWPClientCode/PublicAPI","DS/Story/Mode","DS/PubSub/PubSub","DS/Dashboard/PublicAPI","DS/Story/Utils","DS/WebappsUtils/Utils","DS/Story/View","DS/UWPClientCode/I18n","DS/UIKIT/Modal","i18n!DS/Story/assets/nls/Story"],function(t,e,i,n,o,s,r,a,l,c,h){"use strict";function u(t){this.dashboardId=t.dashboardId,this.isOwner=t.isOwner,this.path=t.path,this.editablePath=t.editablePath,this.currentPath=this.path,this.onScenarioAdd=t.onScenarioAdd,this.scenarioIndex=0,this.MAX_STORIES=10,this.scenarioFrontTimestamp=void 0,this.story={},this.view=void 0,this.alert=t.alert}return u.prototype.start=function(e){var i=this;this._setCurrentScenario({index:e&&e.index,id:e&&e.id,success:function(){i._getScenario(function(e){i.isOwner?e&&e.length?i._ownerReaderView(e):i._writerView(e):e&&e.length?i._readerView(e):t.error(h.notifyNoStory)})}})},u.prototype._destroy=function(){this.currentPath.setScenario(this.currentPath.getEmptyScenario()),this.currentPath.onScenarioSave=null,this.view=null},u.prototype.stop=function(){this._destroy(),this.currentPath.stop()},u.prototype.add=function(){var e=this;this.getScenarios(function(i){var n=s.getEmptyScenarioIndex(i,e.MAX_STORIES);-1!==n?e._setCurrentScenario({index:n,success:e.start.bind(e)}):(e.stop(),t.error(h.tooMuchStories))})},u.prototype.duplicate=function(e){var i=this,n=e&&e.index;s.isNumber(n)?this.getScenarios(function(e){var o=s.getEmptyScenarioIndex(e,i.MAX_STORIES),a=s.isValidScenarioIndex(e,n),c=a&&e[n];-1!==o?a?i._setCurrentScenario({index:o,success:function(){c[0].id=r.uuid(),c[0].title=l.replace(h.copyOfStoryName,{storyName:c[0].title}),i.save(c)}}):(i.stop(),t.error(h.notifyStoryNotFound)):(i.stop(),t.error(h.tooMuchStories))}):(i.stop(),t.error(h.notifyStoryNotFound))},u.prototype.remove=function(e){var i,n=this,o=e&&e.index;function r(){i.isVisible&&i.hide(),i.destroy()}!function(t){(i=new c({className:"tuto-menu-modal",closable:!1}).inject(document.body)).setHeader("<h4>"+h.modalDeleteHeader+"</h4>"),i.setBody("<p>"+h.modalDeleteContent+"</p>"),i.setFooter('<button type="button" class="btn btn-primary">'+h.delete+'</button><button type="button" class="btn btn-default">'+h.cancel+"</button>");var e=i.getContent().getElements(".btn");e[0].addEventListener("click",function(){t.confirm(),r()}),e[1].addEventListener("click",function(){t.cancel(),r()}),!i.isVisible&&i.show()}({confirm:function(){s.isNumber(o)?n.getScenarios(function(e){s.isValidScenarioIndex(e,o)?n._setCurrentScenario({index:o,success:n.delete.bind(n)}):(n.stop(),t.error(h.notifyStoryNotFound))}):(n.stop(),t.error(h.notifyStoryNotFound))},cancel:r})},u.prototype.isRunning=function(){return this.currentPath.isRunning},u.prototype.setMode=function(t){var e,n,o=!1,s=t&&t.degraded,r=t&&t.widget;return this.isRunning()&&(n=(e=this.currentPath.getCurrentStepElement())&&r&&s&&![...e.classList].some(t=>-1!==t.indexOf(r))?i.disabled:s?i.degraded:i.full,o=this.currentPath.setMode(n)),o?n:o},u.prototype._setCurrentScenario=function(e){var i=this,n=e&&e.id,o=e&&e.index,r=e&&e.success;i.getScenarios(function(e){if(s.isNumber(o))s.isValidScenarioIndex(e,o)?(i.scenarioIndex=o,i._getScenario(r)):t.error(h.notifyNoStory);else if(s.isString(n)){var a=e.findIndex(function(t){return i._getScenarioId(t)===n});-1===a?t.error(h.notifyNoStory):(i.scenarioIndex=a,i._getScenario(r))}else i._getScenario(r)})},u.prototype._switchToWriterView=function(t){var e=this;this._getScenario(function(i){e.stop(),e._writerView(i,t)})},u.prototype._ownerReaderView=function(e){this.currentPath=this.path,this.currentPath.setScenario(e),this.currentPath.isEditable=!0,this.currentPath.onClickMenuEdit=this._switchToWriterView.bind(this),this.currentPath.onError=t.error.bind(t),this.view=a.owner,this.currentPath.start()},u.prototype._writerView=function(e,i){this.currentPath=this.editablePath,this.currentPath.setScenario(e||this.currentPath.getEmptyScenario()),this.currentPath.onScenarioSave=this.save.bind(this),this.currentPath.onError=t.error.bind(t),this.view=a.creator,this.currentPath.setStep(i),this.currentPath.start()},u.prototype._readerView=function(e){this.currentPath=this.path,this.currentPath.setScenario(e),this.currentPath.isEditable=!1,this.currentPath.onClickMenuEdit=null,this.currentPath.onError=t.error.bind(t),this.view=a.reader,this.currentPath.start()},u.prototype._getDashboardData=function(t){e.getWidgetInstance({serviceName:o._getServiceName(),id:this.dashboardId,refresh:!t.cache,success:t.success})},u.prototype._getCurrentScenarioId=function(t){var e=this;e._getScenario(function(i){t(e._getScenarioId(i))})},u.prototype._getScenarioId=function(t){var e=!!(t&&t.length)&&t[0];return e&&e.id},u.prototype._getScenario=function(t){var e=this;this._getDashboardData({cache:!1,success:function(i){var n=void 0;try{n=JSON.parse(i.data).stories||{}}catch(t){n={}}e.story={updated:n.updated&&n.updated[e.scenarioIndex],scenario:n.scenarios&&n.scenarios[e.scenarioIndex]},Array.isArray(e.story.scenario)&&e.story.scenario.length>0?t(e.story.scenario):t(void 0)}})},u.prototype.getScenarios=function(t){this._getDashboardData({cache:!0,success:function(e){var i=void 0;try{i=JSON.parse(e.data).stories||{}}catch(t){i={}}i.scenarios?(i.scenarios.forEach(function(t){var e=!!(t&&t.length)&&t[0],i=e&&e.id;e&&!i&&(e.id=r.uuid())}),t(i.scenarios)):t([])}})},u.prototype.isScenarios=function(){var t=this;return new Promise(function(e){t.getScenarios(function(t){var i=!0;t||(i=!1),Array.isArray(t)||(i=!1),0===t.length&&(i=!1),t.length===t.filter(function(t){return!t.length}).length&&(i=!1),e(i)})})},u.prototype._cleanScenario=function(t){var e=!1;return t.forEach(function(t,i){if(t.tab){var n=s.getElement(t.element);e=!(n&&!n.isHidden())}t.dirty=e}),t.filter(function(t){return!t.dirty})},u.prototype.save=function(t){var e=this;this._getDashboardData({cache:!1,success:function(i){var n=void 0;try{n=JSON.parse(i.data)||{}}catch(t){n={}}e._optimisticLockingOperation(n,t)}})},u.prototype.delete=function(){var t=this;this._getDashboardData({cache:!1,success:function(e){var i=void 0;try{i=JSON.parse(e.data)||{}}catch(t){i={}}t._optimisticLockingOperation(i,[])}})},u.prototype._optimisticLockingOperation=function(i,s){var r,a,l=this,c=i.stories,u=c&&c.updated&&c.updated[this.scenarioIndex],d=!(!(s&&s.length)||(r=c,a=this.scenarioIndex,r&&r.scenarios&&r.scenarios.length&&r.scenarios[a]&&r.scenarios[a].length));this.story.updated===u?(c?(c.updated[this.scenarioIndex]=Date.now(),c.scenarios[this.scenarioIndex]=s):((c={updated:[],scenarios:[]}).updated[this.scenarioIndex]=Date.now(),c.scenarios[this.scenarioIndex]=s,i.stories=c),this.story={updated:c.updated[this.scenarioIndex],scenario:c.scenarios[this.scenarioIndex]},e.setWidgetInstance({serviceName:o._getServiceName(),id:this.dashboardId,data:i,success:function(){s&&0===s.length?t.success(h.notifyDashboardDeleted):t.success(h.notifyDashboardSaved),d&&l.onScenarioAdd(l._getScenarioId(s)),n.dispatch(o.events.story.updated)}})):(this.stop(),t.error(h.optimisticConcurrencyFailure))},u}),define("DS/Story/EditablePath",["UWA/Core","DS/Story/Path","DS/Story/Utils","DS/UIKIT/Modal","DS/Story/Mode","DS/UIKIT/Tooltip","DS/WebappsUtils/Utils","DS/Dashboard/UsageTracker","DS/PubSub/PubSub","DS/Dashboard/PublicAPI","text!DS/Story/assets/template/editableBubble.html","i18n!DS/Story/assets/nls/Path"],function(t,e,i,n,o,s,r,a,l,c,h,u){"use strict";function d(i){var n=this;e.call(this,t.extend(i,{scenario:[{intro:u.editableContentIntroPlaceHolder}],template:h})),i=i||{},n.selectors=t.extend(n.selectors,{widgets:'.module.moduleEditable[class*=" wi-"]',mainContainer:".main",bubbleTitle:".tuto-bubble-title",bubbleContent:".tuto-bubble-content",bubbleDelete:".delete-step",bubbleAdd:".add-step",menuContainer:".tuto-menu.tuto-editable",menuItemSave:".tuto-menu.tuto-editable .tuto-menu-item.tuto-save",menuItemClose:".tuto-menu.tuto-editable .tuto-menu-item.tuto-close"}),n.mainContainer=document.body.querySelector(n.selectors.mainContainer),n.menuContainer=n.container.querySelector(n.selectors.menuContainer),n.menuItemSave=n.container.querySelector(n.selectors.menuItemSave),n.menuItemClose=n.container.querySelector(n.selectors.menuItemClose),[{target:n.menuItemSave,body:u.save},{target:n.menuItemClose,body:u.close}].forEach(function(t){new s({position:"bottom",target:t.target,body:t.body,offset:{x:0,y:0}})}),n._selectStepWidgetElementEvent=r.throttle(n._selectStepWidgetElementEvent,400,!0,!0,n),n._menuSave=n._menuSave.bind(n),n._menuClose=n._menuClose.bind(n),n._highLight=r.throttle(n._highLight,30,!1,!0,n);return n.onScenarioChange=function(){n.changes=!0},n.onScenarioSave=i.onScenarioSave||function(){},n}return d.prototype=Object.create(e.prototype),d.prototype.constructor=d,d.prototype.previousStep=function(){this.isEmptyScenario()?this.onError(u.emptyStep):e.prototype.previousStep.call(this)},d.prototype.nextStep=function(t){this.isEmptyScenario()?this.onError(u.emptyStep):this.stepNumber!==this.scenario.length&&e.prototype.nextStep.call(this)},d.prototype.render=function(){e.prototype.render.call(this);var t=this.stepNumber-1,n=this.scenario[t],o=i.isIntro(n);this.bubbleContent=this.bubbleContainer.querySelector(this.selectors.bubbleContent),this.bubbleDelete=this.bubbleContainer.querySelector(this.selectors.bubbleDelete),this.bubbleAdd=this.bubbleContainer.querySelector(this.selectors.bubbleAdd),this.bubbleMenu=this.bubbleContainer.querySelector(this.selectors.bubbleMenu),o&&(this.bubbleTitle=this.bubbleContainer.querySelector(this.selectors.bubbleTitle)),this._attachBubbleContentEditEvent(),new s({position:"bottom",target:this.bubbleAdd,body:u.addStep,offset:{x:0,y:0}}),this._attachBubbleAddEvent(),o||(new s({position:"bottom",target:this.bubbleDelete,body:u.deleteStep,offset:{x:0,y:0}}),this._attachBubbleDeleteEvent())},d.prototype.start=function(){this.changes=!1,this.modal=new n({className:"tuto-menu-modal",container:this.menuContainer,closable:!1}),this.modal.inject(this.menuContainer),this._attachMenuEvent(),this.menuContainer.classList.add("show"),e.prototype.start.call(this)},d.prototype.stop=function(){this._hideSelectableElements(),this._detachMenuEvent(),this.menuContainer.classList.remove("show"),e.prototype.stop.call(this)},d.prototype.show=function(t){var i=t&&t.element||"all";["menu","all"].includes(i)&&this.menuContainer.classList.add("show"),e.prototype.show.call(this,t)},d.prototype.hide=function(t){var i=t&&t.element||"all";["menu","all"].includes(i)&&this.menuContainer.classList.remove("show"),e.prototype.hide.call(this,t)},d.prototype.setMode=function(t){var i=e.prototype.setMode.call(this,t);return i&&(t===o.full?this.show():t===o.degraded&&this.hide({element:"menu"})),i},d.prototype.toJSON=function(){var e=[];return this.scenario.forEach(function(n){var o=t.clone(n);if(!i.isIntro(o)){var s=o.element;"string"!=typeof s&&(o.element=o.widget?"#"+s.id:'[data-tabid="'+s.getAttribute("data-tabId")+'"]')}e.push(o)}),e},d.prototype.getEmptyScenario=function(){return[{title:"",intro:"",id:r.uuid()}]},d.prototype.isEmptyScenario=function(){return!this.scenario||(!Array.isArray(this.scenario)||this.scenario.some(function(t,e){return 0===e?!t.title||!t.intro:0!==e?!t.content:void 0}))},d.prototype._addNewStep=function(e,i){this.scenario.splice(this.stepNumber,0,t.extend({element:e,content:""},i)),this.onScenarioChange()},d.prototype._addNewStepFromSelectStep=function(t){var i=t.target,n=t.widget,o=t.tab;(n||o)&&(this._detachSelectStepElementEvent(),n&&this._addNewStep(i,{widget:!0}),o&&this._addNewStep(i,{tab:!0}),e.prototype.nextStep.call(this))},d.prototype._selectStepWidgetElementEvent=function(t){var e=document.elementFromPoint(t.clientX,t.clientY),n=i.getWidget(e);n&&this._addNewStepFromSelectStep({target:n,widget:!0})},d.prototype._selectStepTabElementEvent=function(t){var e=document.body.querySelector('li[data-tabid="'+t+'"].wp-tab');e&&(this.hide(),this._addNewStepFromSelectStep({target:i.getTab(e),tab:!0}))},d.prototype._attachSelectStepElementEvent=function(){this.enableHighlight=!1,this.bubbleContainer.classList.remove("show"),this.tutoHighlight.classList.remove("show"),this.bubbleArrow.classList.remove("show"),this._detachKeyboardNavigation(),this._detachHighlightTrigger(),this._showSelectableElements(),this.mainContainer.addEventListener("click",this._selectStepWidgetElementEvent,!0),l.addOnce(c.events.tab.click,this._selectStepTabElementEvent,this)},d.prototype._detachSelectStepElementEvent=function(){this.enableHighlight=!0,this.mainContainer.removeEventListener("click",this._selectStepWidgetElementEvent,!0),l.remove(c.events.tab.click,this._selectStepTabElementEvent),this._hideSelectableElements(),this.bubbleContainer.classList.add("show"),this.tutoHighlight.classList.add("show"),this.bubbleArrow.classList.add("show"),this._attachKeyboardNavigation()},d.prototype._cleanInput=function(t){return t.trim()},d.prototype._attachBubbleContentEditEvent=function(){var t=this,e=this.stepNumber-1,n=this.scenario[e],o=i.isIntro(n);["keypress","keyup","keydown"].forEach(function(i){t.bubbleContent.addEventListener(i,function(i){var n=i&&i.target,s=n&&n.value&&t._cleanInput(n.value);o?t.scenario[e].intro=s:(t.scenario[e].content=s,t._updateBubblePosition()),t.onScenarioChange()}),o&&t.bubbleTitle.addEventListener(i,function(i){var n=i&&i.target,o=n&&n.value&&t._cleanInput(i.target.value);t.scenario[e].title=o,t.onScenarioChange()})})},d.prototype._keyboardNavigation=function(t){var e=document.activeElement,i=t.keyCode;e!==this.bubbleContent&&(37===i?this.previousStep():39===i&&this.nextStep())},d.prototype._attachBubbleDeleteEvent=function(){var t=this;this.bubbleDelete.addEventListener("click",function(e){var i=t.stepNumber-1,n=t.scenario[i];if(n.widget)t.scenario.splice(i,1);else if(n.tab){var o=t.scenario.findIndex(function(t,e){return!(e<=i)&&(!t.widget&&(!!t.tab||void 0))});o=-1===o?t.scenario.length:o,t.scenario.splice(i,o-i)}t.onScenarioChange(),t.previousStep(),a.track({category:"dashboard.story",action:"remove-step"})})},d.prototype._attachBubbleAddEvent=function(){var t=this;this.bubbleAdd.addEventListener("click",function(e){t.isEmptyScenario()?t.onError(u.emptyStep):(e&&e.stopPropagation&&e.stopPropagation(),t._attachSelectStepElementEvent(),a.track({category:"dashboard.story",action:"add-step"}))})},d.prototype._menuSave=function(e){var i=!1,n=!t.is(e.render,"boolean")||e.render;return this.isEmptyScenario()?this.onError(u.emptyStep):(this.onScenarioSave(this.toJSON()),this.changes=!1,i=!0,n&&this.render(),a.track({category:"dashboard.story",action:"save-story"})),this.modal.isVisible&&this.modal.hide(),i},d.prototype._menuSaveClose=function(){this._menuSave({render:!1})&&this.stop()},d.prototype._menuClose=function(){var t=this;if(this.changes){this.modal.setHeader("<h4>"+u.modalCloseHeader+"</h4>"),this.modal.setBody("<p>"+u.modalCloseContent+"</p>"),this.modal.setFooter('<button type="button" class="btn btn-primary">'+u.save+'</button><button type="button" class="btn btn-default">'+u.dontSave+'</button><button type="button" class="btn btn-default">'+u.cancel+"</button>");var e=this.modal.getContent().getElements(".btn");e[0].addEventListener("click",this._menuSaveClose.bind(this)),e[1].addEventListener("click",function(){t.modal.isVisible&&t.modal.hide(),t.stop()}),e[2].addEventListener("click",this.modal.hide.bind(this.modal)),!this.modal.isVisible&&this.modal.show()}else this.stop()},d.prototype._attachMenuEvent=function(){this.menuItemSave.addEventListener("click",this._menuSave),this.menuItemClose.addEventListener("click",this._menuClose)},d.prototype._detachMenuEvent=function(){this.menuItemSave.removeEventListener("click",this._menuSave),this.menuItemClose.removeEventListener("click",this._menuClose)},d.prototype._showSelectableElements=function(){var t=this,n=document.querySelectorAll(this.selectors.tabs),o=document.querySelectorAll(this.selectors.widgets),s=this.stepNumber-1;if(n&&[].forEach.call(n,function(e){e.classList.add("tuto-show-selectable"),e.classList.add("animated"),t._setForegroundZindex(e,t.zIndexElementsChanges)}),t._showSelectableTabNavigation(),s>0&&this.scenario.length>1&&o){[].forEach.call(o,function(i){i.classList.add("tuto-show-selectable"),i.classList.add("animated"),e.prototype._disableCurrentWidgetInteractions.call(t,i)});var r=this.scenario[s].element,a=i.getElement(r),l=this._getScrollableContainer(a);l&&this._setForegroundZindex(l,this.zIndexElementsChanges)}},d.prototype._hideSelectableElements=function(){var t=this,i=document.querySelectorAll(this.selectors.tabs),n=document.querySelectorAll(this.selectors.widgets);[].forEach.call(i,function(t){t.classList.remove("tuto-show-selectable"),t.classList.remove("animated")}),t._hideSelectableTabNavigation(),[].forEach.call(n,function(i){i.classList.remove("tuto-show-selectable"),i.classList.remove("animated"),e.prototype._enableCurrentWidgetInteractions.call(t,i)}),this._resetZIndex(this.zIndexElementsChanges)},d.prototype._showSelectableTabNavigation=function(){var t=document.querySelector(this.selectors.tabsAddNewContainer),e=document.querySelector(this.selectors.tabsAddNew),i=document.querySelector(this.selectors.tabsAddNewContainer+" "+this.selectors.tabsNavigation);t&&(this._setForegroundZindex(t,this.zIndexElementsChanges),t.classList.remove("tuto-relative-position"),i.classList.add("hide"),e.classList.add("tuto-show-selectable"))},d.prototype._hideSelectableTabNavigation=function(){var t=document.querySelector(this.selectors.tabsAddNewContainer),e=document.querySelector(this.selectors.tabsAddNew),i=document.querySelector(this.selectors.tabsAddNewContainer+" "+this.selectors.tabsNavigation);t&&(i.classList.remove("hide"),e.classList.remove("tuto-show-selectable"))},d.prototype._showComment=function(){},d.prototype._hideComment=function(){},d.prototype._getCommentPanel=function(t){return t?e.prototype._getCommentPanel(!0):null},d}),define("DS/Story/DashboardsStory",["DS/PubSub/PubSub","DS/WebappsUtils/Map","DS/UWPClientCode/PublicAPI","DS/Dashboard/PublicAPI","DS/Dashboard/Utils","DS/Dashboard/Environment","DS/Dashboard/UsageTracker","DS/Story/EditablePath","DS/Story/Path","DS/Story/DashboardStories","DS/Story/ModeManager"],function(t,e,i,n,o,s,r,a,l,c,h){"use strict";var u=function(){var e={};function i(t){if(e[t])return e[t];var i={promise:null,resolve:null};return i.promise=new Promise(function(t){i.resolve=t}),e[t]=i,i}return t.add(n.events.story.init,function(t){i(t.modelId).resolve(t.id)}),function(t){return i(t).promise}}();function d(){var i=this;function o(t,e){return Object.assign({readonly:t.constructor===l},e)}h.init({setMode:i.setMode.bind(i),storyView:i.getCurrentDashboardStoryView.bind(i)}),i.dashboardsStory=new e,t.add(n.events.story.init,function(){var e=h.isRunnable.bind(h),r={onStart:function(){s.setFocusLock(!0),t.dispatch(n.events.story.start,[o(this)])},onStop:function(){s.setFocusLock(!1),t.dispatch(n.events.story.stop,[o(this)])},onAfterNext:function(i){e({skip:i.skip}),t.dispatch(n.events.story.next,[o(this,i)])},onAfterPrevious:function(e){t.dispatch(n.events.story.previous,[o(this,e)])}};i.path=new l(r),i.editablePath=new a(r)})}return d.prototype.start=function(t){var e=this;return e.stop().then(function(){return e.getCurrentDashboardStories()}).then(function(e){e.start(t)})},d.prototype.stop=function(){return this.getCurrentDashboardStories().then(function(t){return t.stop(),Promise.resolve()})},d.prototype.add=function(){var t=this;return t.stop().then(function(){return t.getCurrentDashboardStories()}).then(function(t){t.add(),r.track({category:"dashboard.story",action:"add-story"})})},d.prototype.duplicate=function(t){var e=this;return e.stop().then(function(){return e.getCurrentDashboardStories()}).then(function(e){e.duplicate(t),r.track({category:"dashboard.story",action:"duplicate-story"})})},d.prototype.remove=function(t){var e=this;return e.stop().then(function(){return e.getCurrentDashboardStories()}).then(function(e){e.remove(t),r.track({category:"dashboard.story",action:"delete-story"})})},d.prototype.setMode=function(t){return this.getCurrentDashboardStories().then(function(e){return e.setMode(t)})},d.prototype.getCurrentDashboardStoryView=function(){return this.getCurrentDashboardStories().then(function(t){return t.view})},d.prototype.getCurrentDashboardIdAndRole=function(){return new Promise(function(t){var e=n._getActiveContext(),i=e.modelId;u(i).then(function(){n.getContextWidgetId({modelId:i}).then(function(n){t({dashboardId:n,dashboardModelId:i,isOwner:o.isEditionFriendlyDevice()&&e.owner})})})})},d.prototype.getCurrentDashboardStories=function(){var t=this;return t.getCurrentDashboardIdAndRole().then(function(e){var o=e.dashboardId,s=e.isOwner;return t.dashboardsStory.has(o)||t.dashboardsStory.set(o,new c({dashboardId:o,isOwner:s,path:t.path,editablePath:t.editablePath,onScenarioAdd:function(e){t.getCurrentDashboardIdAndRole().then(function(t){var o=i.getCachedCurrentUser(),s=t.dashboardModelId,r=n._isEndUserCockpitContext(s);n.getContextMembers({id:s,success:function(t){t.members.length&&n.publish3DNotifications({recipients:t.members.map(function(t){return{email:t.email,id:t.login,login:t.login,name:t.firstName+" "+t.lastName,type:t.type}}),messageId:r?"story.cockpit.msg":"story.dashboard.msg",notificationId:"story.dashboard.setting",uri:"#dashboard:"+s+"/story:"+e,data:{FROM_USER_NAME:o.firstName+" "+o.lastName,INSTANCE_NAME:n._getContext(s).name}})}})})}})),Promise.resolve(t.dashboardsStory.get(o))})},new d});