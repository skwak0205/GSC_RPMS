define("DS/DELPPWImplementModule/ImplementModule",["UWA/Core"],function(e){"use strict";return{behaviors:["UXFactoryBehavior","ResourceBehavior","ModelBehavior","SelectionBehavior","ImplementBehavior","AssignProductBehavior","WUXNodeModelBehavior","TreeListViewBehavior","ViewBehavior","LinkBehavior"],creator:function(t,n,i,o,l,c,m,s,a,r,d){var p,g,u,S,I,h,f,P,L,v,A,C,b,R,T,N,D,O,U,k,w,E,V,y,F,M,W,B,j,x,_,H=null,K=null,X=null,q={};return S=function(t,n){if(q={},!e.is(t))throw new Error("Command ID is null");q.cmdId=t,q.onOKCallBack=n,q.onCancelCallback=w,q.newObjType=p,q.isInstancePossible=null},h=function(n,o){var l;if(p=null,g=null,K=null,e.is(o,"array")&&0<o.length&&o.forEach(function(t){e.is(t)&&e.is(t.ID,"string")&&e.is(t.Value,"string")&&("ReferenceType"===t.ID&&(p=t.Value),"V_DimensionType"===t.ID&&(K=t.Value))},this),!e.is(p))throw l=i.getNLSValue("Error.CommandConfigNotValid",{cmdName:n}),t.warn(l),new Error(l);g=p.split("/")[1]},f=function(t){var n,l,c=!1,m=i.getNLSValue("ImplementUI.SelectedMultiObjectsForProvide");!0===t.bUpdateImplemented?H.updateImplemented(t.selNodes):!0===t.bUpdateImplementing&&H.updateImplementing(t.selNodes),e.is(g)&&(n=H.getImplementingID(),e.is(n)&&(l={parent:o.getReferenceModel(n),child:g},c=o.isInstancePossible(l),H.showDCFormForAssign(c),!1===c&&H.getImplementedIDs().length>1&&H.showErrorMultipleImplementedSelected(m)))},P=function(e){!0===e.bUpdateImplemented&&(H.updateImplemented(e.selNodes),H.showDCFormForCreate())},L=function(e){var t=!0,n=r.getActiveView();return!1===e.changed.isSelected&&e.sourceId!==n&&(t=!1),t},I=function(){e.is(H)&&(H.isVisible()&&H.destroyUI(),H=void 0)},v=function(t,n){if(q={},!e.is(t))throw new Error("Command ID is null");q.cmdId=t,q.moduleOptions=u,q.onOKCallBack=n,q.onCancelCallback=w},C=function(t){var n,l,m,s,a,r,d=!1,p=i.getNLSValue("ImplementUI.Implementing"),g=function(){A()},u=function(e){X.updateImplementedRevnList(l,e,!0,d)},S=function(e){X.showMessages(e,"error")};e.is(t)&&(a=function(){s=o.getInstancesFromCollection(m),e.is(s)&&s.length>0&&(d=!0),X.updateImplementingLabel(m),(n=c.getScopeLinksOfImplementing(m)).length<=0?X.showMessages(i.getNLSValue("ImplementBehavior.Validation.NoScopeExist"),"error"):(l=n[0].get("to"),r=function(t){e.is(t)?X.showMessages(t,"error"):o.getMajorRevisions(l,u,S)},c.prereqChecksForReconnectScope(q.cmdId,m,p,r,g))},m=o.getReferenceId(t),o.needToQueryForChildren(m)?o.getDescendantsFromServer([m],a,{expandLevel:1,forceDBMode:!0}):a())},A=function(){e.is(X)&&(X.isVisible()&&X.destroyUI(),X=void 0)},w=function(){I(),A()},E=function(t){var n=t.implementingId,i=t.implementedIDs[0],o=t.implementingPaths[0],l=t.implementedPaths[0];(e.is(n)&&e.is(i)||e.is(o)&&e.is(l))&&c.createScopeLink([{implementingPID:n,implementedPID:i,implementingAbsPath:o,implementedAbsPath:l}]),I()},M=function(t){const{implementingPaths:n,implementedPaths:i,cmdAction:o}=t,[l]=n,[m]=i;e.is(l)&&e.is(m)&&c.managePartialScopeLink({implementingAbsPath:l,implementedAbsPath:m,cmdAction:o}),I()},y=function(t){var n,i,l;e.is(t)&&(n=t.implementingId),o.isInstance(n)?(l=n,i=o.getReferenceIdFromInstance(l)):i=n,m.assignProduct({mbomReferenceId:i,mbomInstanceId:l,bodyInstanceIds:t.implementedIDs,bodyAbsolutePaths:t.implementedPaths,mbomAbsolutePaths:t.implementingPaths,newMfgAttributes:t.newObjAttributes,isInstancePossible:t.isInstancePossible,securityContextOverride:t.securityContextOverride}),I()},F=function(e){var t=i.getNLSValue(q.cmdTitle,{type:i.getNLSValue(g||"",null,"Type")}),n=e.implementedIDs,o=e.newObjAttributes,l={securityContextOverride:e.securityContextOverride};o[0].V_Type=p,m.createMfgItemAndScopeLink(n,o,t,l),I()},V=function(t){var n={logMessage:e.is(q.cmdTitle)?i.getNLSValue(q.cmdTitle):"Reconnect Scope command"};e.is(t)&&("ReconnectScope"===q.cmdId?c.reconnectScope(t.implementedId,t.implementingId,n,A):"ReviseAndReconnectScope"===q.cmdId&&c.reviseAndReconnectScope(t.implementedId,t.implementingId,n,A))},b=function(){w(),d.getRelations().then(function(e){e.isRelationsLoaded&&(p=null,g=null,S("CreateScopeLink",E),q.cmdTitle="ImplementUI.CreateScope",q.implementingSection=!0,q.implementedSection=!0,q.optionsSection=!1,q.checkForImplementingScope=!0,q.modalFlag=!1,q.multiSelectionOfImplementing=!1,q.multiSelectionOfImplemented=!1,H=n.create("ImplementUI",q),f(H.getSelectionsWithPaths()))})},W=function(){w(),d.getRelations().then(function(e){e.isRelationsLoaded&&(p=null,g=null,S("CreatePartialScopeLink",M),q.cmdTitle="ImplementUI.CreatePartialScope",q.implementingSection=!0,q.implementedSection=!0,q.optionsSection=!1,q.checkForImplementingScope=!0,q.modalFlag=!1,q.multiSelectionOfImplementing=!1,q.multiSelectionOfImplemented=!1,q.cmdAction=c.PartialScopeAction.CREATE_PARTIALSCOPE,H=n.create("ImplementUI",q),f(H.getSelectionsWithPaths()))})},j=function(){w(),d.getRelations().then(function(e){e.isRelationsLoaded&&(p=null,g=null,S("StretchPartialScopeLink",M),q.cmdTitle="ImplementUI.StretchPartialScope",q.implementingSection=!0,q.implementedSection=!0,q.optionsSection=!1,q.checkForImplementingScope=!0,q.modalFlag=!1,q.multiSelectionOfImplementing=!1,q.multiSelectionOfImplemented=!1,q.cmdAction=c.PartialScopeAction.STRETCH_PARTIALSCOPE,H=n.create("ImplementUI",q),f(H.getSelectionsWithPaths()))})},B=function(){var n,o=[],m=i.getNLSValue("ImplementUI.Implementing");if(w(),n=l.getSelectionsWithPaths()[1],e.is(n,"array")&&n.length>0){const t=n,i=t[0].path,l=e.is(i)&&i.length>0?i:t.id;c.isPartialScoped(l)&&(e.is(l,"array")&&l.length>0?o=l:o.push(l))}e.is(o,"array")&&o.length>0?c.managePartialScopeLink({implementingAbsPath:o,cmdAction:c.PartialScopeAction.DELETE_PARTIALSCOPE}):t.warn(i.getNLSValue("Error.PartialScopeDeletion",{objectName:m}))},x=function(){var n,o=[],m=i.getNLSValue("ImplementUI.Implementing");if(w(),n=l.getSelectionsWithPaths()[1],e.is(n,"array")&&n.length>0){const t=n,i=t[0].path,l=e.is(i)&&i.length>0?i:t.id;c.isPartialScoped(l)&&(e.is(l,"array")&&l.length>0?o=l:o.push(l))}e.is(o,"array")&&o.length>0?c.managePartialScopeLink({implementingAbsPath:o,cmdAction:c.PartialScopeAction.SWITCH_TO_FULLSCOPE}):t.warn(i.getNLSValue("Error.SwitchPartialScope",{objectName:m}))},O=function(e){w(),d.getRelations().then(function(t){t.isRelationsLoaded&&(h("AssignProductUI",e.arguments),S("AssignProductUI",y),q.cmdTitle="ImplementUI.AssignImplemented",q.implementingSection=!0,q.implementedSection=!0,q.optionsSection=!1,q.checkForImplementingScope=!1,q.modalFlag=!1,q.multiSelectionOfImplementing=!1,q.multiSelectionOfImplemented=!0,H=n.create("ImplementUI",q),f(H.getSelectionsWithPaths()))})},U=function(){var t,n,i=l.getSelectionsWithPaths()[1],o=[];w(),i.forEach(function(i){t=i.path,n=e.is(t)&&t.length>0?t:i.id,o.push(n)}),m.unassignProduct(o)},k=function(t){w(),h("CreateMfgItemAndScope",t.arguments),S("CreateMfgItemAndScope",F),q.cmdTitle="ImplementUI.CreateImplementingAndScope",q.implementingSection=!1,q.implementedSection=!0,q.optionsSection=!1,q.checkForImplementingScope=!1,q.modalFlag=!0,q.multiSelectionOfImplementing=!1,q.multiSelectionOfImplemented=!0,e.is(K)&&(q.cmdTitle="ImplementUI.ContinuousProvidedMaterialAndScope",q.newObjDimensionType=K),H=n.create("ImplementUI",q),P(H.getSelectionsWithPaths())},R=function(){var n,o,m,s=[],a=i.getNLSValue("ImplementUI.Implementing");w(),n=l.getSelectionsWithPaths()[1],e.is(n,"array")&&n.length>0&&n.forEach(function(t){o=t.path,m=e.is(o)&&o.length>0?o:t.id,c.isScoped(m)&&s.push(m)}),s.length>0?c.deleteScopeLink(s):t.warn(i.getNLSValue("Error.ScopeDeletion",{objectName:a}))},T=function(t,i){w(),v(t,V),q.cmdTitle=e.is(i)?i:"",q.implementedRevTreeListCSSStyle="implementedSection-container",q.optionsSection=!1,q.modalFlag=!1,X=n.create("ImplementedRevChooserUI",q),C(l.getSelections()[1][0])},N=function(){T("ReconnectScope","Dialog.ReconnectScope.Title")},D=function(){T("ReviseAndReconnectScope","Dialog.ReviseAndReconnectScope.Title")},_=function n(){var m,s,a,r=l.getSelectionsWithPaths()[1][0].id,d=o.getReferenceModel(r);e.is(d)?(m=d.get("PID"),(s=c.getScopeLinksOfImplementing(m)).length<=0?t.warn(i.getNLSValue("Error.NoProductScopeExists.Title")):(a=s[0].get("to"),e.is(void 0)&&t.warn(a),c.createEngMadeFromItem(a,d))):t.debug(n+": Reference Model not found for pid:"+r)},{listenTo:function(){return{select:this.onSelect,CreateScopeLink:b,DeleteScopeLink:R,ReconnectScope:N,ReviseAndReconnectScope:D,AssignProduct:O,UnassignProduct:U,CreateMfgItemAndScope:k,CreatePartialScopeLink:W,DeletePartialScopeLink:B,StretchPartialScopeLink:j,SwitchToFullScopeLink:x,DELCreateEngineeringMadeFromItem:_}},onStart:function(e){u=e},onStop:function(){I(),A()},onSelect:function(t){var n;if(e.is(H)&&H.isVisible()){if(e.is(t)){if(!1===L(t))return;e.is(t.selectedNodeIds)&&t.selectedNodeIds.length>0&&(n=H.getSelectionsWithPaths())}e.is(n)&&n.selNodes.length>0&&(!0===q.implementingSection?f(n):P(n))}else e.is(X)&&X.isVisible()&&e.is(t.selectedNodeIds)&&t.selectedNodeIds.length>0&&C(l.getSelections()[1][0])}}}}});