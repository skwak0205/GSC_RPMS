define("DS/MPFOrderComponent/NoOrderConfirmationSectionCommand",["UWA/Class/View","DS/MPFUtils/MPFUtils"],function(t,e){"use strict";var r,n;return(r=t.extend({className:"mpf-command mpf-hidden",render:function(){return this},isOn:e.doNothing,isOff:e.doNothing,setOn:e.doNothing,setOff:e.doNothing,hide:e.doNothing,show:e.doNothing})).getInstance=function(){return n||(n=new r),n},r}),define("DS/MPFOrderComponent/OrderConfirmationSectionCommand",["UWA/Class/View","DS/UIKIT/Input/Button","DS/MPFFiniteStateMachine/FiniteStateMachine"],function(t,e,r){"use strict";var n,i={},s={};return s.COMMAND_ON="commandOn",s.COMMAND_OFF="commandOff",i.ON="ON",i.OFF="OFF",(n=t.extend({className:"mpf-command",setup:function(t){t||(t={}),this.icon=t.icon,this.iconOff=t.iconOff,this.label=t.label,this.labelOff=t.labelOff,this.stateMachine=this._createStateMachine(),this.button=this._createButton()},render:function(){return this.container.setContent(this.button),this},isOn:function(){return this.stateMachine.getState()===i.ON},setOn:function(){this._changeState(i.ON)},setOff:function(){this._changeState(i.OFF)},hide:function(){this.button.hide()},show:function(){this.button.show()},_changeState:function(t){this.stateMachine.changeState(t),this.stateMachine.getState()===i.OFF?(this.button.setIcon(this.icon),this.button.setValue(this.label)):(this.button.setIcon(this.iconOff),this.button.setValue(this.labelOff))},_onClickHandler:function(){this.stateMachine.getState()===i.OFF?(this._changeState(i.ON),this.dispatchEvent(s.COMMAND_ON)):(this._changeState(i.OFF),this.dispatchEvent(s.COMMAND_OFF))},_createButton:function(){return new e({value:this.label,icon:this.icon,className:"link",events:{onClick:this._onClickHandler.bind(this)}})},_createStateMachine:function(){return new r({state:i.OFF,states:[i.OFF,i.ON],transitions:[{from:i.ON,to:i.OFF},{from:i.OFF,to:i.ON}]})}})).Events=Object.freeze(s),n}),define("DS/MPFOrderComponent/OrderPaymentPage",["UWA/Core","UWA/Class/View"],function(t,e){"use strict";return e.extend({className:"mpf-payment-page",setup:function(t){this._parent(t),this._paymentUrl=t.paymentUrl},render:function(){var e;return this._paymentUrl&&(e=t.createElement("iframe",{src:this._paymentUrl}),this.container.setContent(e)),this},setPaymentUrl:function(t){this._paymentUrl=t,this.render()}})}),define("DS/MPFOrderComponent/OrderConfirmationSection",["UWA/Class/View"],function(t){"use strict";return t.extend({className:"mpf-section",setup:function(t){t||(t={}),this.title=t.title,this.commands=Array.isArray(t.commands)?t.commands:[],this.body=Array.isArray(t.body)?t.body:[]},render:function(){return this.container.setContent([{tag:"div",class:"mpf-header",html:[{tag:"h5",class:"mpf-title",text:this.title},{tag:"div",class:"mpf-commands",html:this.commands}]},{tag:"div",class:"mpf-body",html:this.body}]),this},destroy:function(){this.commands=null,this.body=null,this._parent(),this.container=null}})}),define("DS/MPFOrderComponent/OrderTypeToItemNameDictionnary",["DS/MPFMap/BiMap","i18n!DS/MPFOrderComponent/assets/nls/OrderComponent"],function(t,e){"use strict";var r=new t;return r.put("MP3DP_PrintRequest",e.get("printBaseline")),r.put("MPENG_EngineeringItem",e.get("engineeringBaseline")),r.put("MP_DeliveryServiceRequest",e.get("shipping")),r.put("MP3DP_FinishRequest",e.get("finish")),r.put("MP_AdditionalServiceRequest",e.get("additionalServices")),r.put("MP_QuoteRequest",e.get("pricePerQuote")),r}),define("DS/MPFOrderComponent/PurchaseOrderNumberComponent",["UWA/Core","UWA/Class/View","DS/MPFView/FieldTextInput","DS/MPFCartModel/CartPatchArray","DS/MPFCartModel/CartPatchOperation","i18n!DS/MPFOrderComponent/assets/nls/OrderComponent"],function(t,e,r,n,i,s){"use strict";return e.extend({className:"mpf-purchase-order-number",setup:function(){this.input=new r({className:r.prototype.className+" mpf-oneline",fieldName:"PurchaseOrderNumber",fieldLabel:s.get("purchaseOrderNumber"),model:this.model}),this.listenTo(this.input,"update",this.save.bind(this))},render:function(){return this.container.setContent(this.input.render()),this},save:function(){var t,e,r;return t=this.model.pick("PurchaseOrderNumber"),r=new i(i.Operations.modify,"/",t),(e=new n).add(r),this.model.megaPatch(e)},destroy:function(){this.stopListening(this.input),this.input.destroy(),this.input=null,this.stopListening(this.model),this.model=null,this._parent()}})}),define("DS/MPFOrderComponent/OrderConfirmationHelper",["UWA/Core","UWA/Class","UWA/Promise","UWA/Utils","DS/WebappsUtils/WebappsUtils","DS/MPFServices/MarketplaceServices","DS/MPFCartModel/CartModel","DS/MPFCartQuoteModel/CartQuoteModel","DS/MPFPspModel/PspModel","DS/MPFVirtualIbanModel/VirtualIbanFactory","DS/MPFModalConfiguratorComponent/OrderPaymentMethodSection"],function(t,e,r,n,i,s,a,o,c,l,d){"use strict";var h={PAYMENT_TOKEN:"paymentByToken",DISPLAY_IFRAME:"displayIframe",BANK_TRANSFER:"bankTransferInitiated",PAYMENT_COUPON_DONE:"paymentCouponDone"},u=e.extend();return u.preparePayment=function(t){var e={},n=r.resolve();return t.paymentInfo.method===d.PaymentMethod.COUPON?(e.eventName=h.PAYMENT_COUPON_DONE,e.data=!0,u._setCartStatusForCoupon(t)):t.paymentInfo.method===d.PaymentMethod.CB?"addCB"===t.paymentInfo.value?(e.eventName=h.DISPLAY_IFRAME,t.cartPsp.getPsp()===c.Psp.STRIPE?e.data=u._getStripeIFrame(t):(u._prepareHipayCart(t),n=u._getHiPayIFrame.bind(null,t,e))):(e.eventName=h.PAYMENT_TOKEN,e.data=u._getCardTokenPaymentData(t)):(e.eventName=h.BANK_TRANSFER,n=u._getIbans.bind(null,t,e)),u._saveCart(t.cart).then(u._acceptQuote.bind(null,t.cartQuote)).then(n).then(function(){return e})},u._getStripeIFrame=function(e){const r=e.me.dataProxy.connector,n=e.service===s.CLICK_AND_BUY&&(e.cart.hasEduItems()||e.cart.hasMakerItems());return t.createElement("iframe",{class:"mpf-stripe",src:i.getWebappsBaseUrl()+"MPFStripeComponent/StripePaymentPage.html?stripeKey="+e.cartPsp.getPublicKey()+"&isScaEnabled="+e.cartPsp.isScaEnabled()+"&idCart="+e.cart.get("id")+"&CreditCardTokenMultiUse="+e.paymentInfo.CreditCardTokenMultiUse+"&service="+e.service+"&connectorUrl="+encodeURIComponent(r.rootUrl)+"&connectorPlatformId="+encodeURIComponent(r.platformId)+"&isClicknbuyEduOrMakers="+n+"&firstNameUser="+e.me.getFirstName()})},u._prepareHipayCart=function(t){var e={currentState:a.States.PENDING_PAYMENT,cartContextUrl:n.isAbsoluteUrl(i.getWebappsAssetUrl("MPFModalConfiguratorComponent",""))?i.getWebappsAssetUrl("MPFModalConfiguratorComponent",""):window.location.origin+i.getWebappsAssetUrl("MPFModalConfiguratorComponent","")};"1"===t.paymentInfo.CreditCardTokenMultiUse&&(e.CreditCardTokenMultiUse="1"),t.cart.set(e)},u._getHiPayIFrame=function(e,r){r.data=t.createElement("iframe",{src:e.cart.getPaymentUrl()})},u._getCardTokenPaymentData=function(t){return t.paymentInfo.CreditCardToken},u._setCartStatusForCoupon=function(t){t.cart.set(a.Fields.STATE,a.States.PENDING_PAYMENT)},u._acceptQuote=function(t){var e={};return e[o.Fields.STATE]="ACCEPTED",t.fetchPromise().then(t.savePromise.bind(t,e,{patch:!0}))},u._saveCart=function(t){return t.hasPendingChanges()?t.savePromise(t.getPendingChanges(),{patch:!0}):r.resolve()},u._getIbans=function(t,e){if(t.service===s.CLICK_AND_BUY||t.service===s.IFWELOOP||t.service===s.SUBSCRIPTIONS){var n=t.virtualIbanFactory.createCollection(l.Types.COMPANY);return n.setParentResourceId(t.cart.getCompanyID()),n.fetchPromise({currency:t.cart.getCurrency()}).then(function(t){e.data=t})}return r.resolve()},u.Events=Object.freeze(h),u}),define("DS/MPFOrderComponent/OrderNumberInput",["DS/MPFView/FieldTextInput","i18n!DS/MPFOrderComponent/assets/nls/OrderComponent"],function(t,e){"use strict";return t.extend({setup:function(t){t||(t={}),t.fieldName="id",t.fieldLabel=e.get("purchaseOrderNumber"),this._parent(t)}})}),define("DS/MPFOrderComponent/OrderConfirmationPage",["UWA/Core","UWA/Class/View","UWA/Promise","DS/UIKIT/Mask","DS/UIKIT/Alert","DS/MPFServices/MarketplaceServices","DS/MPFServices/ObjectService","DS/MPFBuyer/BuyerType","DS/MPFPersonModel/PersonModel","DS/MPFCartModel/CartModel","DS/MPFCartModel/CartModelHelper","DS/MPFCartQuoteModel/CartQuoteModel","DS/MPFShopModel/ShopModel","DS/MPFCompanyModel/CompanyModel","DS/MPFTCContractModel/SoftwareAgreementModel","DS/MPFPspModel/PspModel","DS/MPFAddressModel/AddressCollection","DS/MPFCountryModel/CountryCollection","DS/MPFPaymentCardTokenModel/PaymentCardTokenCollection","DS/MPFAddressModel/AddressFactory","DS/MPFCartModel/CartItemFactory","DS/MPFVirtualIbanModel/VirtualIbanFactory","DS/MPFTCContractModel/TCContractFactory","DS/MPFTcDocumentModel/TCDocumentFactory","DS/MPFTracker/Tracker","DS/MPFTracker/Dimension","DS/MPFOrderComponent/OrderConfirmationHelper","DS/MPFCartQuoteComponent/CartQuoteDownloadLink","DS/MPFModalConfiguratorComponent/OrderSummaryDetailsSection","DS/MPFModalConfiguratorComponent/CouponSection","DS/MPFModalConfiguratorComponent/BillingInformationSection","DS/MPFModalConfiguratorComponent/OrderPaymentMethodSection","DS/MPFModalConfiguratorComponent/OrderAgreementsSection","DS/MPFModalConfiguratorComponent/SalesConditionsBuyerPaymentSection","DS/MPFClickAndBuyComponent/checkout/LegalAgreementsSection","i18n!DS/MPFOrderComponent/assets/nls/OrderComponent"],(t,e,r,n,i,s,a,o,c,l,d,h,u,m,p,y,C,f,P,S,g,M,D,F,E,O,_,I,b,A,T,v,N,U,k,w)=>{"use strict";const L={QUOTE_DOWNLOADED:"quoteDownloaded",STATE_CHANGE:"stateChange",VALID:"valid",INVALID:"invalid"},R=Object.freeze({LOADING:"loading",NEW_ADDRESS_FORM:"newAddressForm",PAGE_DISPLAYED:"pageDisplayed"}),B=e.extend({className:"mpf-order-confirmation-page",setup(e={}){a.requiredAsOneOf(e.buyer,[c,m],"options.buyer must be a CompanyModel or a PersonModel"),a.requiredOfPrototype(e.me,c,"options.me must be a PersonModel"),a.requiredOfPrototype(e.cart,l,"options.cart must be a CartModel"),a.requiredOfPrototype(e.cartQuote,h,"options.cartQuote must be a CartQuoteModel"),a.requiredOfPrototype(e.cartPsp,y,"options.cartPsp must be a PspModel"),a.requiredOfPrototype(e.addresses,C,"options.addresses must be an AddressCollection"),a.requiredOfPrototype(e.countries,f,"options.countries must be a CountryCollection"),a.requiredOfPrototype(e.cardTokens,P,"options.cardTokens must be a PaymentCardTokenCollection"),a.requiredOfPrototype(e.cartItemFactory,g,"options.cartItemFactory must be a CartItemFactory"),a.requiredOfPrototype(e.addressFactory,S,"options.addressFactory must be an AddressFactory"),a.requiredOfPrototype(e.tcContractFactory,D,"options.tcContractFactory must be a TCContractFactory"),a.requiredOfPrototype(e.virtualIbanFactory,M,"options.virtualIbanFactory must be a VirtualIbanFactory"),this.buyer=e.buyer,this.me=e.me,this.cart=e.cart,this.cartQuote=e.cartQuote,this.cartPsp=e.cartPsp,this.addresses=e.addresses,this.countries=e.countries,this.cardTokens=e.cardTokens,this.cartItemFactory=e.cartItemFactory,this.addressFactory=e.addressFactory,this.tcContractFactory=e.tcContractFactory,this.virtualIbanFactory=e.virtualIbanFactory,this.buyerType=e.buyerType||o.INDIVIDUAL,this.locale=e.locale||"fr-FR",this.service=e.service,this.bankTransferActive=e.bankTransferActive,this.periodicitiesAlreadyPurchased=e.periodicitiesAlreadyPurchased,this.state=t.is(this.cart.get("BillTo"))&&""!==this.cart.get("BillTo")?R.PAGE_DISPLAYED:R.LOADING,e.service===s.IFWELOOP||e.service===s.SUBSCRIPTIONS?(a.requiredOfPrototype(e.softwareAgreement,p,"options.softwareAgreement must be a SoftwareAgreementModel"),this.softwareAgreement=e.softwareAgreement):e.service===s.CLICK_AND_BUY?(a.requiredOfPrototype(e.softwareAgreement,p,"options.softwareAgreement must be a SoftwareAgreementModel"),a.requiredOfPrototype(e.tcDocumentFactory,F,"options.tcDocumentFactory must be a TCDocumentFactory"),this.softwareAgreement=e.softwareAgreement,this.tcDocumentFactory=e.tcDocumentFactory):(a.requiredOfPrototype(e.shop,u,"options.shop must be a ShopModel"),a.requiredOfPrototype(e.tcDocumentFactory,F,"options.tcDocumentFactory must be a TCDocumentFactory"),this.shop=e.shop,this.tcDocumentFactory=e.tcDocumentFactory),this.alert=this._createAlert(),this.cartQuoteLink=this._createQuoteLink(),this.orderSummarySection=this._createOrderSummarySection(),this.couponSection=this._createCouponSection(),this.billingInfoSection=this._createBillingInfoSection(),this.paymentMethodSection=this._createPaymentMethodSection(),this.legalSection=this._createLegalSection(),this._sendTrackingPage()},render(){let e;return this.state===R.NEW_ADDRESS_FORM?e=[this.alert,this.billingInfoSection]:(e=[this.alert,this.cartQuoteLink.render(),this.orderSummarySection.render(),t.is(this.couponSection)?this.couponSection.render():null,this.billingInfoSection.render(),this.paymentMethodSection.render(),this.legalSection.render()],this.service!==s.CLICK_AND_BUY||this.cart.hasEduItems()||this.cart.hasMakerItems()||e.unshift(this._displayCountryInfoMessage())),this.container.setContent(e),this.state===R.LOADING&&n.mask(this.container),this},isValid(){const e=!t.is(this.couponSection)||this.couponSection.isValid();return this.billingInfoSection.isValid()&&this.paymentMethodSection.isValid()&&this.legalSection.isChecked()&&e},save(){if(this.isValid()){const t=this.paymentMethodSection.getPaymentMethod();return this.legalSection.save().then(_.preparePayment.bind(null,{me:this.me,cart:this.cart,cartPsp:this.cartPsp,cartQuote:this.cartQuote,virtualIbanFactory:this.virtualIbanFactory,service:this.service,paymentInfo:t})).then(t=>{this.dispatchEvent(t.eventName,t.data)})}return this.alert.add({className:"error",message:w.get("errorFieldsInfo")}).show(),r.reject()},changeState(t){this.state!==t&&(this.state=t,this.state===R.PAGE_DISPLAYED&&this.billingInfoSection.cancelAddAddress({silent:!0}),this.state!==R.LOADING?(n.unmask(this.container),this.render()):n.mask(this.container),this.dispatchEvent(L.STATE_CHANGE,this.state))},destroy(){this.stopListening(),this.cartQuoteLink.destroy(),this.orderSummarySection.destroy(),this.couponSection&&this.couponSection.destroy(),this.billingInfoSection.destroy(),this.paymentMethodSection.destroy(),this.legalSection.destroy(),this.buyer=null,this.me=null,this.cart=null,this.cartQuote=null,this.cartPsp=null,this.addresses=null,this.countries=null,this.cardTokens=null,this.cartItemFactory=null,this.addressFactory=null,this.tcContractFactory=null,this.virtualIbanFactory=null,this._parent(),this.container=null},_hidePaymentMethod(t){!1!==t?this.paymentMethodSection.hide():this.paymentMethodSection.show()},_updatePaymentCoupon(){return this.paymentMethodSection.updatePaymentCoupon()},_checkPaymentMethodWithCoupon(){this.service===s.CLICK_AND_BUY&&this.paymentMethodSection.checkPaymentMethodWithCoupon()},_onQuoteDownloadOk(){this._sendTrackingEvent("Billing.QuoteDownloaded"),this.dispatchEvent(L.QUOTE_DOWNLOADED)},_onQuoteDownloadError(){this._sendTrackingEvent("Billing.QuoteDownloadFailed"),this.alert.add({className:"error",message:w.get("quoteDownloadFailed")}).show()},_displayCountryInfoMessage(){const e=window.localStorage.getItem("mpOfferCountry"),r=this.countries.find(t=>t.getIso3()===this.buyer.getCountry());if(t.is(e)&&e!==r.getIso2())return t.createElement("div",{class:"alert-message alert-primary alert-has-icon",html:[t.createElement("span",{class:"icon fonticon"}),t.createElement("span",{text:w.get("cartUpdatedWithBillingInfo")})]})},_onChangePaymentMethodError(e){const r=t.is(e)&&"Error.BankTransferNotAllowed"===e.errorCode?t.is(e.errorMsg)?e.errorMsg:w.get("bankTransferNotAllowed"):w.get("errorPaymentMethod");this.scroller.scrollTo(0,0,200),this.alert.add({className:"error",message:r}).show()},_dispatchValidity(){this.dispatchEvent(this.isValid()?L.VALID:L.INVALID)},_createAlert:()=>new i({visible:!1,autoHide:!0,hideDelay:5e3}),_createQuoteLink(){const t=new I({quote:this.cartQuote});return this.listenTo(t,I.Events.CLICKED,this._sendTrackingEvent.bind(this,"Billing.DownloadQuoteClicked")),this.listenTo(t,I.Events.ERROR,this._onQuoteDownloadError.bind(this)),this.listenTo(t,I.Events.QUOTE_DOWNLOADED,this._onQuoteDownloadOk.bind(this)),t},_createCouponSection(){const t=this.service===s.MAKE&&this.cartPsp.getPsp()===y.Psp.STRIPE,e=this.service===s.CLICK_AND_BUY;if(t||e){const t=new A({service:this.service,cart:this.cart,title:w.get("addCoupon"),locale:this.locale});return this.listenTo(t,A.Events.VALID,this._dispatchValidity.bind(this)),this.listenTo(t,A.Events.INVALID,this._dispatchValidity.bind(this)),this.listenTo(t,A.Events.HIDE_PAYMENT_METHOD_SECTION,this._hidePaymentMethod.bind(this,!0)),this.listenTo(t,A.Events.SHOW_PAYMENT_METHOD_SECTION,this._hidePaymentMethod.bind(this,!1)),this.listenTo(t,A.Events.COUPON_ADDED,this._updatePaymentCoupon.bind(this)),this.listenTo(t,A.Events.COUPON_REMOVED,this._updatePaymentCoupon.bind(this)),t}},_createOrderSummarySection(){return new b({title:w.get("orderSummaryTitle"),cart:this.cart,cartItemFactory:this.cartItemFactory,service:this.service,locale:this.locale})},_createBillingInfoSection(){const t=new T({service:this.service,title:w.get("billingInformation"),addresses:this.addresses,buyer:this.buyer,buyerType:this.buyerType,addressFactory:this.addressFactory,cart:this.cart,cartPsp:this.cartPsp,countries:this.countries});return this.listenTo(t,T.Events.NEW_ADDRESS_FORM,this.changeState.bind(this,R.NEW_ADDRESS_FORM)),this.listenTo(t,T.Events.EXIT_ADDRESS_FORM,this.changeState.bind(this,R.PAGE_DISPLAYED)),this.listenTo(t,T.Events.PATCHING_CART,this.changeState.bind(this,R.LOADING)),this.listenTo(t,T.Events.ERROR_PATCH_CART,this.changeState.bind(this,R.PAGE_DISPLAYED)),this.listenTo(t,T.Events.INVALID,this._dispatchValidity.bind(this)),this.listenTo(t,T.Events.VALID,this.changeState.bind(this,R.PAGE_DISPLAYED)),t},_createPaymentMethodSection(){const t=new v({buyerType:this.buyerType,cart:this.cart,service:this.service,title:w.get("paymentMethodTitle"),tokenCards:this.cardTokens,bankTransferActive:this.bankTransferActive,cartPsp:this.cartPsp});return this.listenTo(t,v.Events.VALID,this._dispatchValidity.bind(this)),this.listenTo(t,v.Events.INVALID,this._dispatchValidity.bind(this)),this.listenTo(t,v.Events.ON_CHANGE_METHOD_ERROR,this._onChangePaymentMethodError.bind(this)),t},_createLegalSection(){let t;return t=this.service===s.IFWELOOP||this.service===s.SUBSCRIPTIONS?new N({service:this.service,cart:this.cart,cartItems:this.cartItemFactory.createCollection("",this.cart.getItems()),buyer:this.buyer,softwareAgreement:this.softwareAgreement,tcContractFactory:this.tcContractFactory}):this.service===s.CLICK_AND_BUY?new k({cart:this.cart,buyer:this.buyer,softwareAgreement:this.softwareAgreement,tcContractFactory:this.tcContractFactory,tcDocumentFactory:this.tcDocumentFactory}):new U({serviceRequest:this.service,buyer:this.buyer,shopModel:this.shop,tcDocumentFactory:this.tcDocumentFactory,tcContractFactory:this.tcContractFactory,cartItems:this.cartItemFactory.createCollection("",this.cart.getItems()),cart:this.cart}),this.listenTo(t,"validSection",this._dispatchValidity.bind(this)),this.listenTo(t,"invalidSection",this._dispatchValidity.bind(this)),t},_sendTrackingPage:function(){const t=E.createPageBuilder({url:"/checkout/OrderSummary"}).addDimension(O.MARKETPLACE_SERVICE,this.serviceRequest);d.addTrackerInformation(t,this.cart),t.addDimension(O.BUYER_ID,this.buyer.id).addDimension(O.BUYER_TYPE,this.buyerType.name).addDimension(O.PSP,this.cartPsp.getPsp()).send()},_sendTrackingEvent:function(t){const e=E.createEventBuilder({category:"Checkout",action:t}).addDimension(O.MARKETPLACE_SERVICE,this.serviceRequest);d.addTrackerInformation(e,this.cart),e.addDimension(O.BUYER_ID,this.buyer.id).addDimension(O.BUYER_TYPE,this.buyerType.name).addDimension(O.PSP,this.cartPsp.getPsp()).send()}});return B.States=R,B.Events=Object.assign(L,_.Events),B}),define("DS/MPFOrderComponent/OrderDetailsComponent",["UWA/Core","UWA/String","UWA/Class/View","DS/MPFServices/ObjectService","DS/MPFServices/MarketplaceServices","DS/MPFCartModel/CartModel","DS/MPFCartModel/CartItemModel","DS/MPFCartModel/CartItemCollection","DS/MPFOrderComponent/OrderTypeToItemNameDictionnary","i18n!DS/MPFOrderComponent/assets/nls/OrderComponent"],(t,e,r,n,i,s,a,o,c,l)=>{"use strict";return r.extend({className:"mpf-order-details table-responsive",setup(t){t||(t={}),n.requiredOfPrototype(t.cart,s,"options.cart must be a CartModel"),n.requiredOfPrototype(t.cartItems,o,"options.cartItems must be a CartItemCollection"),this._parent(t),this.service=t.service,this.cart=t.cart,this.cartItems=t.cartItems,this.locale=t.locale||"fr-FR",this.itemsSortedByOffer=this._groupItemsByOfferId(),this.table=this._createTable()},render(){return this.container.setContent([this.table,this._createInfoMessage()]),this},_groupItemsByOfferId(){var e=[];const r=this.cartItems.filter(t=>t.getQuantity()>0).sort((t,e)=>e.getType()===a.Types.MAKE_REQUEST||e.getType()===a.Types.ENGINEERING_REQUEST?1:t.getType()===a.Types.MAKE_REQUEST||t.getType()===a.Types.ENGINEERING_REQUEST?-1:0);return this.service===i.CLICK_AND_BUY?(r.forEach(r=>{const n=r.getOfferId();if(""!==n){const i=e.find(t=>t.offerId===n);t.is(i)?i.items.push(r):e.push({offerId:n,items:[r]})}else e.push({offerId:n,items:[r]})}),e):r},_createTable(){const e=this.cart.getGrossAmountTotal().toLocaleString(this.locale,{style:"currency",currency:this.cart.getCurrency(),currencyDisplay:"code"}).replace(this.cart.getCurrency(),"").trim();return t.createElement("table",{class:"table table-condensed",html:[this._createTableHeader(),this._createTableBody(),this._createTableFooter(e)]})},_createOrderItemEntry(e,r){let n;const i=this.cart.getCurrency(),s=e.getUnitNetAmount().toLocaleString(this.locale,{style:"currency",currency:i,currencyDisplay:"code"}).replace(i,"").trim(),o=e.getUnitTaxesAmount().toLocaleString(this.locale,{style:"currency",currency:i,currencyDisplay:"code"}).replace(i,"").trim(),l=e.getTotalGrossAmount().toLocaleString(this.locale,{style:"currency",currency:i,currencyDisplay:"code"}).replace(i,"").trim();return e.getType()===a.Types.SOFTWARE_REQUEST?n=e.get("ProductDisplayName"):(n=e.get("AdditionalServiceName")||e.get("FinishName"))||(n=c.get(e.getType(),e.getName())),t.createElement("tr",{html:[t.createElement("td",{class:r?"mpf-body-item offer":"mpf-body-item",text:r?"- "+n:n}),t.createElement("td",{class:"mpf-body-quantity",text:parseInt(e.getQuantity())}),t.createElement("td",{text:e.isPriceDisplayable()?s:"-"}),t.createElement("td",{text:e.isPriceDisplayable()?o:"-"}),t.createElement("td",{text:e.isPriceDisplayable()?l+" "+i:"-"})]})},_createOfferEntry(e){const r=this.cart.getCurrency(),n=e.reduce((t,e)=>t+=parseFloat(e.getUnitNetAmount()),0).toLocaleString(this.locale,{style:"currency",currency:r,currencyDisplay:"code"}).replace(r,"").trim(),i=e.reduce((t,e)=>t+=parseFloat(e.getUnitTaxesAmount()),0).toLocaleString(this.locale,{style:"currency",currency:r,currencyDisplay:"code"}).replace(r,"").trim(),s=e.reduce((t,e)=>t+=parseFloat(e.getTotalGrossAmount()),0).toLocaleString(this.locale,{style:"currency",currency:r,currencyDisplay:"code"}).replace(r,"").trim();return t.createElement("tr",{html:[t.createElement("td",{class:"mpf-body-item",text:e[0].get("title")}),t.createElement("td",{class:"mpf-body-quantity",text:parseInt(e[0].getOfferQuantity())}),t.createElement("td",{text:n}),t.createElement("td",{text:i}),t.createElement("td",{text:s+" "+r})]})},_createTableBody(){const e=this.itemsSortedByOffer.map(t=>{if(this.service===i.CLICK_AND_BUY){const e=""!==t.offerId;if(e){const r=t.items.map(t=>this._createOrderItemEntry(t,e));return r.unshift(this._createOfferEntry(t.items)),r}return this._createOrderItemEntry(t.items[0],e)}return this._createOrderItemEntry(t)});return t.createElement("tbody",{html:e.flat()})},_createTableHeader:()=>t.createElement("thead",{html:t.createElement("tr",{html:[{tag:"th",text:l.get("item"),class:"mpf-header-item"},{tag:"th",text:l.get("quantity"),class:"mpf-header-quantity"},{tag:"th",text:l.get("unitPrice")},{tag:"th",text:l.get("taxes")},{tag:"th",text:l.get("totalAmountWithTaxes")}]})}),_createTableFooter(e){return t.createElement("tfoot",{html:t.createElement("tr",{html:[t.createElement("td"),t.createElement("td"),t.createElement("td"),t.createElement("td",{text:l.get("total")}),t.createElement("td",{text:e+" "+this.cart.getCurrency()})]})})},_createInfoMessage(){const r=this.cart.getMinOrderCost();if(t.is(r)){if(parseFloat(r,10)>0){const n=e.format(l.get("messageMinOrderCost"),r,this.cart.getCurrency());return t.createElement("div",{class:"info-message",text:n})}}},destroy(){this.cart=null,this.cartItems=null,this.locale=null,this.table=null,this._parent(),this.container=null}})});