define("DS/SIMAnimationWebMdl/SIMAnimationRepRefUnstreamer",["UWA/Class","DS/Visualization/Node3D"],function(e,t){"use strict";return e.extend({init:function(){},unstream:function(e,a,r){var n=e.firstChild;if(n&&"Osm"===n.nodeName){this.animations=[],this.variantToAnimation=[],this.animChannelToAnimation=[],this.propertyToAnimation=[],this.propertyToChannel=[];for(var i=n.getElementsByTagName("Feature"),s=0;s<i.length;++s){var u=i[s],o=u.getAttribute("StartUp");switch(o){case"CATAnimation":this.unstreamAnimation(u);break;case"CATAnimVariantLine":this.unstreamVariantLine(u);break;case"CATAnimChannel":this.unstreamAnimChannel(u);break;case"CATAnimPropertyDouble":this.unstreamPropertyCommon(u),this.unstreamPropertyDouble(u);break;case"CATAnimPropertyOctet":this.unstreamPropertyCommon(u),this.unstreamPropertyOctet(u);break;case"CATAnimPropertyMessage":this.unstreamPropertyCommon(u),this.unstreamPropertyMessage(u);break;default:console.error("Startup type "+o+" not handled yet.")}}if(this.animations.length>=1){var c=new t("AnimationsList");c.AnimFeaturesList=this.animations,r.add(c)}}},unstreamAnimation:function(e){for(var t=this.animations.length,a={attributes:{}},r=e.getElementsByTagName("Attr"),n=0;n<r.length;++n){var i=r[n];switch(i.getAttribute("Name")){case"_Name":a.attributes._Name=i.getAttribute("Value");break;case"_Description":a.attributes._Description=i.getAttribute("Value");break;case"_Version":a.attributes._Version=parseInt(i.getAttribute("Value"));break;case"_VariantLine":var s=parseInt(i.getAttribute("Value").replace(/#/g,""));this.variantToAnimation[s]=t,a.attributes._VariantLine={};break;case"_AnimChannels":for(var u=JSON.parse(i.getAttribute("Value").replace(/#/g,"")),o=0;o<u.length;++o)this.animChannelToAnimation[u[o]]=t;a.attributes._AnimChannels=[]}}this.animations.push(a)},unstreamVariantLine:function(e){var t=e.getAttribute("Id"),a=this.variantToAnimation[t],r=this.animations[a].attributes._VariantLine;r.attributes={};for(var n=e.getElementsByTagName("Attr"),i=0;i<n.length;++i){var s=n[i];switch(s.getAttribute("Name")){case"_CkeType":r.attributes._CkeType=s.getAttribute("Value");break;case"_Indexes":r.attributes._Indexes=JSON.parse(s.getAttribute("Value"));break;case"_IndexedValues":var u=s.getAttribute("Value").replace(/\.,/g,",").replace(/\.e/g,"e").replace(/\.\]/g,"]");r.attributes._IndexedValues=JSON.parse(u)}}},unstreamAnimChannel:function(e){for(var t=e.getAttribute("Id"),a=this.animChannelToAnimation[t],r=this.animations[a].attributes._AnimChannels.length,n={attributes:{}},i=e.getElementsByTagName("Attr"),s=0;s<i.length;++s){var u=i[s];switch(u.getAttribute("Name")){case"_ExternalObject":n.attributes._ExternalObject=u.getAttribute("Value");break;case"_AnimProperties":for(var o=JSON.parse(u.getAttribute("Value").replace(/#/g,"")),c=0;c<o.length;++c)this.propertyToAnimation[o[c]]=a,this.propertyToChannel[o[c]]=r;n.attributes._AnimProperties=[]}}this.animations[a].attributes._AnimChannels.push(n)},unstreamPropertyCommon:function(e){for(var t=e.getAttribute("Id"),a=this.propertyToChannel[t],r=this.propertyToAnimation[t],n={attributes:{}},i=e.getElementsByTagName("Attr"),s=0;s<i.length;++s){var u=i[s];switch(u.getAttribute("Name")){case"_Type":var o=u.getAttribute("Value").replace(/\'/g,"");n.attributes._Type=o;break;case"_TypeSize":n.attributes._TypeSize=u.getAttribute("Value");break;case"_DefaultInterpolation":n.attributes._DefaultInterpolation=u.getAttribute("Value");break;case"_InterpretType":n.attributes._InterpretType=u.getAttribute("Value");break;case"_RepeatCount":n.attributes._RepeatCount=u.getAttribute("Value");break;case"_ValuesTimeIndex":n.attributes._ValuesTimeIndex=JSON.parse(u.getAttribute("Value"))}}this.animations[r].attributes._AnimChannels[a].attributes._AnimProperties.push(n)},unstreamPropertyDouble:function(e){for(var t=e.getAttribute("Id"),a=this.propertyToChannel[t],r=this.propertyToAnimation[t],n=this.animations[r].attributes._AnimChannels[a].attributes._AnimProperties,i=n[n.length-1],s=e.getElementsByTagName("Attr"),u=0;u<s.length;++u){var o=s[u];switch(o.getAttribute("Name")){case"_ValuesDouble":var c=o.getAttribute("Value").replace(/\.,/g,",").replace(/\.e/g,"e").replace(/\.\]/g,"]"),l=JSON.parse(c);i.attributes._ValuesDouble=l}}},unstreamPropertyOctet:function(e){for(var t=e.getAttribute("Id"),a=this.propertyToChannel[t],r=this.propertyToAnimation[t],n=this.animations[r].attributes._AnimChannels[a].attributes._AnimProperties,i=n[n.length-1],s=e.getElementsByTagName("Attr"),u=0;u<s.length;++u){var o=s[u];switch(o.getAttribute("Name")){case"_ValuesOctet":var c=JSON.parse(o.getAttribute("Value"));i.attributes._ValuesOctet=c}}},unstreamPropertyMessage:function(e){var t=e.getAttribute("Id"),a=this.propertyToChannel[t],r=this.propertyToAnimation[t],n=this.animations[r].attributes._AnimChannels[a].attributes._AnimProperties,i=n[n.length-1];i.values={type:"message"};for(var s=e.getElementsByTagName("Attr"),u=0;u<s.length;++u){var o=s[u];switch(o.getAttribute("Name")){case"_V6Text":i.attributes._V6Text="true"===o.getAttribute("Value");break;case"_ValuesOpCode":i.attributes._ValuesOpCode=JSON.parse(o.getAttribute("Value"));break;case"_ValuesDialogId":i.attributes._ValuesDialogId=o.getAttribute("Value");break;case"_ValuesString":var c=o.getAttribute("Value").replace(/\"/g,'\\"').replace(/\'/g,'"');i.attributes._ValueString=JSON.parse(c);break;case"_WindowSize":i.attributes._WindowSize=JSON.parse(o.getAttribute("Value"))}}}})}),define("DS/SIMAnimationWebMdl/Ox4FeatureModeler",["DS/ZipJS/zip"],function(e){"use strict";var t={rootFeature:new function(){this.startupFacade=function(){this.attributes={}},this.featureFacade=new this.startupFacade},fmZipReader:function(t){var a=this;a.archive=new e.BlobReader(t),a.entries=null,a.entriesCount=0,a.entriesRead=0,a.readNextEntry=function(t,r){var n,i=a.entries[a.entriesRead];n=i.filename,i.getData(new e.TextWriter,function(e){t(n,e.target.result),++a.entriesRead==a.entriesCount?r():a.readNextEntry(t,r)})},a.read=function(t,r){e.createReader(a.archive,function(e){e.getEntries(function(e){a.entries=e,a.entriesCount=e.length,a.readNextEntry(t,r)})})}},unstreamDocument:function(e,a){var r={containers:{},links:{},features:{}};t.representations.hasOwnProperty(e.representationId)?console.log("[E] FM: representation already loaded"):(t.representations[e.representationId]={uuid:{},component:{},specobject:{}},new t.fmZipReader(e.stream).read(function(a,n){var i=-1!==a.search(/91ACA40B/)?"containers":-1!==a.search(/D182A118/)?"links":-1!==a.search(/BFC0DC13/)?"features":null;i&&t.unstreamDomain[i]({domainDependencyTable:r[i],externalDependencies:function(e,t){return r[e][t]},representationId:e.representationId,repRef:e.repRef,stream:n})},a))},unstreamDomain:{containers:function(e){var a,r=void 0!==e.resourceName?t.resources[e.resourceName]:t.representations[e.representationId];for(a in r.containers=e.stream?JSON.parse(e.stream):void 0,r.containers)e.domainDependencyTable[a]=r.containers[a]},links:function(e){var a,r=void 0!==e.resourceName?t.resources[e.resourceName]:t.representations[e.representationId];for(a in r.links=e.stream?JSON.parse(e.stream):void 0,r.links){var n=r.links[a];n.relationTarget=e.repRef.SemanticRelations[n.RelationId],e.domainDependencyTable[a]=n}},features:function(e){var a=null;try{a=JSON.parse(e.stream)}catch(e){throw"[F] FM: JSON error)"}var r,n={};for(r in a){var i=a[r];n[r]=new t.Feature(i,n,e)}for(r in a)t.unstreamFeature2(n[r],n,e)}},unstreamFeature2:function(e,a,r){var n,i,s=null!=r.resourceName?t.resources[r.resourceName]:t.representations[r.representationId];for(n in e.data.attributes){var u=e.data.attributes[n],o=u.value instanceof Array?u.value:[u.value];switch(u.type){case"external":if(void 0!==r.representationId)for(i=0;i<o.length;i++)o[i]=null!==o[i]?r.externalDependencies("links",o[i].id):void 0;break;case"component":case"specobject":for(i=0;i<o.length;i++){var c=null!==o[i]?a[o[i].id]:void 0;if(c){o[i]=c.featureFacade;var l=c.data.uuid;if("component"===u.type&&s[u.type][l])throw"[F] FM: AGG error";s[u.type][l]||(s[u.type][l]=[]),s[u.type][l].push({source:e,attrName:n})}}}u.value instanceof Array?Object.freeze(u.value):u.value=o[0]}},Feature:function(e,a,r){var n=this;n.data={properties:e.properties,attributes:e.values,startupProperties:e.startup,name:e.system.name,diezele:e.readonly.diezele,uuid:e.readonly.uuid},e.hasOwnProperty("ancestor")?e.ancestor.hasOwnProperty("resource")?n.data.ancestor=t.rootFeature:n.data.ancestor=a[e.ancestor.id]:n.data.ancestor=t.rootFeature,n.featureFacade=new n.data.ancestor.featureFacade.constructor,n.featureFacade.name=n.data.name,n.featureFacade.attributes=Object.create(n.data.ancestor.featureFacade.attributes);var i;for(i in Object.defineProperty(n.featureFacade,"name",{get:function(){return n.data.name},enumerable:!0}),n.data.attributes)Object.defineProperty(n.featureFacade.attributes,i,function(e){return{get:function(){return t.getValue(n.data.attributes[e])},enumerable:!0}}(i));if(n.data.uuid in t.representations[r.representationId].uuid)throw"[F] FM: uuid already defined in same scope";t.representations[r.representationId].uuid[n.data.uuid]=n},getValue:function(e){var t,a=e.value;switch(e.type){case"external":var r=a instanceof Array?a:[a];for(t=0;t<r.length;t++)r[t]=r[t].relationTarget;!a instanceof Array&&(a=r[0])}return a}};return{init:function(){t.representations={}},loadRepresentation:function(e,a,r,n){t.unstreamDocument({stream:r,representationId:a,repRef:e},n)},loadResource:function(e,a){t.unstreamDocument({stream:a,resourceName:e})},listRootFeatures:function(e){var a,r=[];for(a in t.representations[e].uuid)if(void 0===t.representations[e].component[a]){var n=t.representations[e].uuid[a];r.push(n.featureFacade)}return r},containFeatures:function(e){return t.representations.hasOwnProperty(e)}}}),define("DS/SIMAnimationWebMdl/SIMAnimationServices",["UWA/Class"],function(e){"use strict";return UWA.Class.extend({refreshSceneGraphState:function(e,t,a){void 0!==e&&void 0!==t&&void 0!==a&&(t.SetCurrentFrame(a),t.UpdateProperties())},getKeyFramer:function(e){var t;if(void 0!==e.KeyFramer)t=e.KeyFramer;else for(var a=0;a<e.children.length&&void 0===(t=this.getKeyFramer(e.children[a]));++a);return t},getAnimationNodes:function(e){var t=[];if(void 0!==e.AnimFeaturesList)t.push(e);else for(var a=0;a<e.children.length;++a){var r=this.getAnimationNodes(e.children[a]);t=t.concat(r)}return t},getAnimations:function(e){var t=[];if(void 0!==e.AnimFeaturesList)e.AnimFeaturesList.length>0?t=t.concat(e.AnimFeaturesList):t.push(e.AnimFeaturesList);else for(var a=0;a<e.children.length;++a){var r=this.getAnimations(e.children[a]);t=t.concat(r)}return t.forEach(function(e){var t=e.attributes._VariantLine;void 0!==t.attributes._IndexedValues&&(t.attributes._OrderedIndexedValues=t.attributes._IndexedValues.slice(0),t.attributes._OrderedIndexedValues.sort(function(e,t){return e-t}),t.attributes._OrderedIndexes=t.attributes._Indexes.slice(0),t.attributes._OrderedIndexes.sort(function(e,a){return t.attributes._IndexedValues[t.attributes._Indexes.indexOf(e)]-t.attributes._IndexedValues[t.attributes._Indexes.indexOf(a)]}))}),t}})});