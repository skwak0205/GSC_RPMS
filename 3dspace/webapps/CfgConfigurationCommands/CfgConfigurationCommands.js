define("DS/CfgConfigurationCommands/commands/CfgEditConfigurationContextCmd",["DS/UIKIT/Alert","UWA/Core","DS/ApplicationFrame/Command","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/PADUtils/PADContext","DS/CfgBaseUX/scripts/CfgController","DS/CfgBaseUX/scripts/CfgUtility","DS/Notifications/NotificationsManagerUXMessages","DS/Notifications/NotificationsManagerViewOnScreen","i18n!DS/CfgConfigurationCommands/assets/nls/CfgConfigurationCommands","i18n!DS/CfgFilterUX/assets/nls/CfgFilterUX","i18n!DS/CfgBaseUX/assets/nls/CfgBaseUXNLS","DS/Utilities/Utils"],function(e,t,n,o,i,s,r,l,a,c,g,d,f){"use strict";return n.extend({contextDialog:null,init:function(e){var t=this;this._parent(e,{mode:"exclusive",isAsynchronous:!1}),this._isConfigAvailable=0,this.enable();t=this;r.rolesAvailable(function(e){e.isCFGRoleAvail&&(t._isConfigAvailable=1,t._setStateCmd())}),void 0!==i.get&&null!==i.get()?this._SelectorManager=i.get().getPADTreeDocument().getXSO():this._SelectorManager=null,null!==this._SelectorManager&&(void 0!==this._SelectorManager.onPostAdd&&this._SelectorManager.onPostAdd(this._checkSelection.bind(this)),void 0!==this._SelectorManager.onPostRemove&&this._SelectorManager.onPostRemove(this._checkSelection.bind(this)),void 0!==this._SelectorManager.onEmpty&&this._SelectorManager.onEmpty(this._checkSelection.bind(this)));t=this;void 0!==i.get&&null!==i.get()&&i.get().addEvent("editModeModified",function(e){!0===e?t._checkSelection():t.disable()})},_checkSelection:f.debounce(function(){this._SelectedID="";var e=this.getData().selectedNodes;e.length>=1&&(this._SelectedID=e[0].id||"",this._SelectedAlias=e[0].alias||"?"),this._setStateCmd()},20),_setStateCmd:function(){var e=0;void 0!==this._SelectedID&&""!==this._SelectedID&&(e=1,0==this._isConfigAvailable&&(e=0)),void 0!==i.get&&null!==i.get()&&!0!==i.get().getEditMode()&&(e=0),1===e?this.enable():this.disable()},destroy:function(){this.contextDialog&&this.contextDialog.closeDialog()},execute:function(){var e=this;this.disable();var t=e.getData().selectedNodes;if(0===t.length)return r.showwarning(c.Error_NoObjectSelection,"error"),void this.disable();1===t.length&&(this._SelectedID=t[0].id||"",this._SelectedAlias=t[0].alias||"?"),console.log(t);e=this;s.init(),widget.getValue("x3dPlatformId")?enoviaServerFilterWidget.tenant=widget.getValue("x3dPlatformId"):enoviaServerFilterWidget.tenant="OnPremise",r.populate3DSpaceURL().then(function(){r.populateSecurityContext().then(function(){r.getPAndOAccess(["GetAttachedModels","AttachModels","DetachModels"]).then(function(t){console.log("pno res : "+t),e.pAndOAccess=t,"Granted"==t.GetAttachedModels?e.onSecurityContext(e):(r.showwarning(d.CfgMessageAccessRightsError,"error"),e.enable())},function(){console.log("getPNO API failed"),e.onSecurityContext(e)})},function(){e.enable()})})},onSecurityContext:function(e){this._SelectedID;for(var t=(e=this).getData().selectedNodes.length,n=[],o=0;o<t;o++)n.push(e.getData().selectedNodes[o].id);new Promise(function(e,t){var o={version:"1.0",pidList:n,modelMask:"Read",enabledCriteria:"YES",cfgCtxt:"YES"};o=JSON.stringify(o),r.makeWSCall("/resources/modeler/configuration/navigationServices/getMultipleConfigurationContextInfo","POST","enovia","application/ds-json",o,function(t){let n=enoviaServerFilterWidget.baseURL;for(var o=0;o<t.contextInfo.length;o++){if(null!=t.contextInfo[o].content.results[0]&&null!=t.contextInfo[o].content.results[0].notification&&"unaccessible"==t.contextInfo[o].content.results[0].notification.code&&"ERROR"==t.contextInfo[o].content.results[0].notification.type)return void r.showwarning(g.Filter_unaccessiblecode_Error,"error");null!=t.contextInfo[o].content.results[0].type_icon_url&&-1==t.contextInfo[o].content.results[0].type_icon_url.indexOf(n)&&(t.contextInfo[o].content.results[0].type_icon_url=n+t.contextInfo[o].content.results[0].type_icon_url),null!=t.contextInfo[o].content.results[0].type_icon_large_url&&-1==t.contextInfo[o].content.results[0].type_icon_large_url.indexOf(n)&&(t.contextInfo[o].content.results[0].type_icon_large_url=n+t.contextInfo[o].content.results[0].type_icon_large_url)}e(t)},function(e,n){t(n.errorMessage)},!0)}).then(function(t){var n={},o=0;n.response=t,n.selection=e.getData().selectedNodes,n.pAndOAccess=e.pAndOAccess;for(var i=0;i<n.response.referencesInfo.length;i++)"NO"==n.response.referencesInfo[i].isConfigurable&&o++;return o>=1&&o<n.response.referencesInfo.length?(e.enable(),void r.showwarning(c.Error_Incorrect_Type_Partial_Fail,"error")):o==n.response.referencesInfo.length?(e.enable(),void r.showwarning(c.Error_Incorrect_Type_Complete_Fail,"error")):(require(["DS/CfgConfigurationContextUX/CfgEditMultipleConfigurationContextDialog"],function(t){e.contextDialog=new t(n),e.contextDialog.render(),e.enable()}),void console.log(t))},function(t){e.enable(),window.notifs=l,a.setNotificationManager(window.notifs);var n=t.search("Incorrect type");""!==n&&n>=0?r.showwarning(c.Error_Models_Incorrect_Type,"error"):r.showwarning(c.Error_Models,"error")})},getData:function(){var e={selectedNodes:[]};if(void 0!==i.get&&null!==i.get()){var t,n=i.get().getPADTreeDocument().getSelectedNodes(),o=n.length;for(t=0;t<o;t++)if(n[t].isRoot()){var s={id:n[t].getID(),alias:n[t].getLabel()};e.selectedNodes.push(s)}else{s={id:n[t].getID(),alias:n[t].getLabel(),parentID:n[t].getParent().getID(),parentalias:n[t].getParent().getLabel()};e.selectedNodes.push(s)}}return e}})});