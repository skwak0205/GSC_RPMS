define("DS/Robot/CustomReferenceAxisSystem",["DS/Visualization/Node3D","DS/SceneGraphNodes/FixedSizeNode3D","DS/Visualization/ThreeJS_DS"],function(t,e,i){return t.extend({init:function(t,i){i=i||{},this._parent("customReferenceAxisSystem"),this._subscribedEvents=[],this.viewer=t,this.ratio=i.ratio||7,this.fixedSizeNode3D=new e({name:"fixedSizeNode3D",ratio:this.ratio}),this.addChild(this.fixedSizeNode3D),this.fixedSizeNode3D.addChild(i.node),this.fixedSizeNode3D.setCameraName("robotCameraOrtho"),this.node=i.node,this.removeGeomTypes=i.removeGeomTypes,this.getPosition=i.getPosition||function(t,e){return{x:2*(t-100)/t-1,y:Math.max(200/e-1,-.85)}},this.notifyNodesHierarchyUpdate();var n=this,a=this.viewer.currentViewpoint.onMove(function(){n.onViewpointChange()});this._subscribedEvents.push({object:this.viewer.currentViewpoint,token:a}),a=this.viewer.onViewerResize(function(){n.onViewpointChange()}),this._subscribedEvents.push({object:this.viewer,token:a})},setRatio:function(t){this.fixedSizeNode3D.setRatio(t)},notifyNodesHierarchyUpdate:function(){var t=this;this.fixedSizeNode3D.traverse(function(e){var i;if("Mesh3D"===e.getNodeType()&&(e.excludeFromHighlight(!0,!0),e.setShadow(!1),e.setFrustumCulled(!1),e.excludeFromCSO(!0),t.removeGeomTypes&&e.mesh3js&&e.mesh3js.geometry))for(i=0;i<e.mesh3js.geometry.length;i++){var n,a=e.mesh3js.geometry[i];for(n=0;n<a.drawingGroups.length;n++)a.drawingGroups[n]._geomType=0}})},onViewpointChange:function(){var t,e,n=this.viewer.currentViewpoint;n&&(n._updateRobotCamera(this.viewer.internalSceneGraph),e=function(t,e){var a,o=n.robotCameraOrtho,s=new i.Vector3(t,e,0);if((new i.Projector).unprojectVector(s,o),o instanceof i.PerspectiveCamera){var r=new i.Ray(data.cameraEye,s.sub(data.cameraEye).normalize()),l=new i.Plane(this.viewer.currentViewpoint.camera.getLookAt(),0);a=r.intersectPlane(l)}else a=s;return(new i.Matrix4).setPosition(a)}((t=this.getPosition(this.viewer.canvas.width,this.viewer.canvas.height)).x,t.y),this.setMatrix(e))},_dispose:function(){var t,e;for(t=0;t<this._subscribedEvents.length;t++)(e=this._subscribedEvents[t]).object.unsubscribe(e.token);this._subscribedEvents=[]},CallBackEventHandlerViewPoint:function(){this.onViewpointChange.apply(this,arguments)}})}),define("DS/Robot/LineTranslationNode",["DS/Visualization/ThreeJS_DS","DS/Visualization/Node3D","WebappsUtils/WebappsUtils","DS/Visualization/GeometryHelper","DS/SceneGraphNodes/BillBoardNode3D","DS/Manipulators/LineTranslationManipulator","DS/Mesh/MeshUtils","DS/CoreEvents/Events","DS/CoreEvents/ModelEvents","DS/Visualization/SceneGraphFactory"],function(t,e,i,n,a,o,s,r,l,h){"use strict";var d=e.extend({init:function(e){var i=this;this._parent(e.name),this.axis=new t.Vector3(0,0,1),this.position=e.position,this._modelEvent=new l,this.isPreactivated=!1,this.isManipulated=!1,this.enablePreactivate=!0,this.touchMode=e.touchMode,this.labelText=null,this.labelBillBoardNode=null,this.labelDistance=11.5,this.labelColor=null,this.colors=e.colors||{rest:new t.Color("#FFFFFF"),manipulate:new t.Color("#1B6E9C"),preactivate:new t.Color("#A1D9ED")};var r=new n,d=r.createRectangle({width:2,height:9,fill:!0,fillColor:null,noEdge:!0}),c=(r.createRectangle({width:2,height:9.5,fill:!0,fillColor:null,noEdge:!0}),new t.ImageUtils._loadTextureVisu("Robot","models/textures/AS_Arrow.png",void 0,null,null,t.ImageUtils.crossOriginPolicy));c.flipY=!1,this.mat=new t.MeshBasicMaterial({map:c,side:t.DoubleSide,transparent:!0,alphaTest:.05,enableClipPlanes:!1,color:this.colors.rest}),this.mat.force=!0;var u=h.createMeshNode(d,this.mat);if(u.setShadow(!1),u.setFrustumCulled(!1),u.excludeFromCSO(!0),u.excludeFromHighlight(!0,!0),this.touchMode){u.setPickable(s.PICKTHROUGH);var p=new t.MeshBasicMaterial({map:c,transparent:!0,opacity:0,enableClipPlanes:!1,force:!0}),v={bottomCenterPoint:new t.Vector3(0,0,0),topCenterPoint:new t.Vector3(0,0,7),radius:1,sag:60,material:p},M=h.createCylinderNode(v);M.excludeFromCSO(!0),M.excludeFromHighlight(!0,!0),M.setShadow(!1),M.setFrustumCulled(!1),this.addChild(M)}u.setMatrix((new t.Matrix4).rotateX(.5*Math.PI).translate(new t.Vector3(-1,-1,0)));var b={position:this.position,name:"billBoardNode",type:"Cylindrical"};this.billBoardNode=new a(b),this.billBoardNode.addChild(u);var m=new t.Matrix4;m.setPosition((new t.Vector3).getPositionFromMatrix(this.getMatrix())),this.setMatrix(m),this.addChild(this.billBoardNode),this.manipulator=new o({axis:this.axis}),this.manipulator.setExclusive(!0),this.manipulator.linkToNode(this),this.manipulator.onPrimaryPointerClick(function(t){i._modelEvent.publish({event:"PrimaryPointerClick",data:t,context:this})}),this.manipulator.onBeginManipulate(function(t){i._modelEvent.publish({event:"LineTranslationBegin",data:t,context:this}),i.mat.opacity=1,i.mat.color=i.colors.manipulate,i.isManipulated=!0}),this.manipulator.onManipulate(function(t){i._modelEvent.publish({event:"LineTranslationManipulation",data:t,context:this})}),this.manipulator.onEndManipulate(function(t){i._modelEvent.publish({event:"LineTranslationEnd",data:t,context:this}),i.isPreactivated?t.viewer.setTemporaryCursor("pointer"):i.mat.color=i.colors.rest,i.isManipulated=!1}),this.manipulator.onBeginPreactivate(function(t){i._modelEvent.publish({event:"BeginPreactivate",data:{preactivated:t.preactivated,node:u},context:this}),i.isPreactivated=!0,!i.isManipulated&&i.enablePreactivate&&(i.mat.color=i.colors.preactivate),!i.isManipulated&&i.enablePreactivate&&t.viewer.setTemporaryCursor("pointer"),t.viewer.render()}),this.manipulator.onEndPreactivate(function(t){i._modelEvent.publish({event:"EndPreactivate",data:{preactivated:t.preactivated,node:u},context:this}),i.isPreactivated=!1,i.isManipulated||(i.mat.color=i.colors.rest),!i.isManipulated&&i.enablePreactivate&&t.viewer.unsetTemporaryCursor(),t.viewer.render()})},setLabel:function(e,i){if(i=i||"grey",(e!==this.labelText||this.labelColor!=i)&&(this.labelColor=i,this.labelText=e,this.labelBillBoardNode&&(this.removeChild(this.labelBillBoardNode),this.labelBillBoardNode=null),e)){var n=h.createTextNode({text:e,font:"Trebuchet MS",fontSize:2,color:new t.Color(i),hotspot:{x:.5,y:.5},zoom:1.3,_fix:!0});n?(this.labelBillBoardNode=new a({name:"labelBillBoardNode",type:"Spherical"}),this._updateLabelPosition(),n.setFrustumCulled(!1),this.labelBillBoardNode.addChild(n),this.labelBillBoardNode.setPickable(s.PICKTHROUGH),this.addChild(this.labelBillBoardNode)):(this.labelColor=null,this.labelText=null)}},setAxis:function(t){this.manipulator.axis=t},_updateLabelPosition:function(e){if(e&&(this.labelDistance=e),this.labelBillBoardNode){var i=new t.Vector3(0,0,this.labelDistance),n=new t.Matrix4;n.setPosition(i),this.labelBillBoardNode.setMatrix(n)}},setParentManipulated:function(t){this.enablePreactivate=!t},setToGhostState:function(){this.mat.opacity=0},setToNonGhostState:function(){this.mat.opacity=1},setToDragState:function(){this.mat.opacity=.2}});return UWA.namespace("THREEDS/Robot/LineTranslationNode",d)}),define("Robot/LineTranslationNode",["DS/Robot/LineTranslationNode","DS/DSMigration/DSMigration"],function(t,e){return e.deprecateModule("Robot/LineTranslationNode"),t}),define("DS/Robot/ReferenceAxisSystemNode",["DS/Visualization/ThreeJS_DS","DS/Visualization/Node3D","DS/Visualization/SceneGraphFactory","DS/Mesh/MeshUtils"],function(t,e,i,n){"use strict";return e.extend({init:function(t,i){this._parent(t),this.viewer=i,this.setVisibilityFree(!0),this.fixedSizeNode=new e("AxisSystemDisplayFixedSizeNode"),this._createAxis(),this.addChild(this.fixedSizeNode),this.setPickable(n.PICKTHROUGH),this.wantedVisibility=!0,this._enabled=!0,this.eventToken=this.viewer._modelEvent.subscribe({event:"UpdateReferenceAxisSystemVisibility"},this.onUpdateVisibility.bind(this)),this._getPositionCB=null},setGetPositionCB:function(t){this._getPositionCB=t,this.onViewpointChange()},onViewpointChange:function(){var e=this.viewer.currentViewpoint;if(e){var i,n,a=this.viewer.devicePixelRatio,o=(i=this._getPositionCB?this._getPositionCB(this.viewer.canvas.width,this.viewer.canvas.height,a):this._getPosition_default(this.viewer.canvas.width,this.viewer.canvas.height,a)).y;n=function(i,n){var a,o=e.robotCameraOrtho,s=new t.Vector3(i,n,0);if((new t.Projector).unprojectVector(s,o),o instanceof t.PerspectiveCamera){var r=new t.Ray(data.cameraEye,s.sub(data.cameraEye).normalize()),l=new t.Plane(e.camera.getLookAt(),0);a=r.intersectPlane(l)}else a=s;return(new t.Matrix4).setPosition(a)}(i.x,o),this._changeMatrix(n,e.robotCameraOrtho)}},onUpdateVisibility:function(t){this.wantedVisibility=t.visible,this.applyVisibility()},setCameraName:function(t){this.fixedSizeNode._setFixedSizeCameraName(t)},applyVisibility:function(){this.setVisibility(this.wantedVisibility&&this._enabled)},_dispose:function(){this.viewer._modelEvent.unsubscribe(this.eventToken),this.eventToken=null},_setEnabled:function(t){this._enabled=t,this.applyVisibility()},_changeMatrix:function(e,i){this.setMatrix(e);var n=new t.Vector3,a=new t.Vector3,o=new t.Vector3,s=i.getLookAt();e.extractBasis(n,a,o);var r=new t.Vector3,l=.01;function h(t,e){r.crossVectors(t,s),r.lengthSq()<l*l?e.setVisibility(!1):e.setVisibility(!0)}var d=this._hasAxis();this._hasAxis()||(d=this._createAxis()),d&&(h(n,this.xAxis),h(a,this.yAxis),h(o,this.zAxis))},_hasAxis:function(){return!!(this.xAxis&&this.yAxis&&this.zAxis)},_createAxis:function(){var n=new t.MeshBasicMaterial({color:"black"}),a=5.5;function o(o,s){var r=i.createTextNode({text:s,hotspot:{x:.5,y:.5},font:"Trebuchet MS",color:new t.Color("black"),fontSize:4,bold:!1,_fix:!0});if(!r)return null;r.setFrustumCulled(!1);var l=new e,h=i.createLineNode({points:[new t.Vector3(0,0,0),new t.Vector3(a*o.x,a*o.y,a*o.z)],material:n});h.setFrustumCulled(!1),h.setShadow(!1),l.addChild(h);var d=new e;return d.addChild(r),d._setBillboardData(1,null,null),d._setFixedSizeCenter(new t.Vector3(1.2*a*o.x,1.2*a*o.y,1.2*a*o.z),4),l.addChild(d),l}return this.xAxis=o(new t.Vector3(1,0,0),"x"),this.yAxis=o(new t.Vector3(0,1,0),"y"),this.zAxis=o(new t.Vector3(0,0,1),"z"),this.xAxis&&this.yAxis&&this.zAxis?(this.fixedSizeNode.addChild(this.xAxis),this.fixedSizeNode.addChild(this.yAxis),this.fixedSizeNode.addChild(this.zAxis),this.fixedSizeNode._setRatio(4),!0):(this.xAxis=null,this.yAxis=null,this.zAxis=null,!1)},_getPosition_default:function(t,e,i){return{x:2*(this.viewer.canvas.width-34*i)/this.viewer.canvas.width-1,y:Math.max(2*i*70/this.viewer.canvas.height-1,-.85)}},CallBackEventHandlerViewPoint:function(){this.onViewpointChange.apply(this,arguments)}})}),define("DS/Robot/RobotUtils",["DS/Visualization/ThreeJS_DS","DS/Visualization/GeometryHelper","WebappsUtils/WebappsUtils","DS/Visualization/SceneGraphFactory"],function(t,e,i,n){"use strict";return{createRobotRectangle:function(i,a,o,s,r){var l,h={width:o,height:s,fill:!0,fillColor:null,noEdge:!0},d=(new e).createRectangle(h),c=t.ImageUtils._loadTextureVisu("Robot","models/textures/"+r,void 0,a,a,t.ImageUtils.crossOriginPolicy);c.flipY=!1,c.minFilter=t.LinearMipMapLinearFilter,(l=new t.MeshBasicMaterial({map:c,side:t.DoubleSide,transparent:!0,alphaTest:.05,enableClipPlanes:!1,opacity:i?0:1})).force=!0;var u=n.createMeshNode(d,l);return u.setShadow(!1),u.setFrustumCulled(!1),u.excludeFromCSO(!0),u.excludeFromHighlight(!0,!0),{node:u,material:l}},createSmallTranslationRectangle:function(t,e){var i=t?"PlaneTranslationNode_picking.png":"PlaneTranslationNode.png";return this.createRobotRectangle(t,e,6,6,i)},createSmallRotationRectangle:function(t,e){var i=t?"Arc_picking.png":"Arc.png";return this.createRobotRectangle(t,e,8.5,8.5,i)},createBigTranslationRectangle:function(t,e){var i=t?"Translation_FullPlane_picking.png":"Translation_FullPlane.png";return this.createRobotRectangle(t,e,15,15,i)},createBigRotationRectangle:function(t,e){var i=t?"Rotation_FullArc_picking.png":"Rotation_FullArc_B.png";return this.createRobotRectangle(t,e,17,17,i)},createTranslationRectangle:function(t,e,i){return i?this.createBigTranslationRectangle(t,e):this.createSmallTranslationRectangle(t,e)},createRotationRectangle:function(t,e,i){return i?this.createBigRotationRectangle(t,e):this.createSmallRotationRectangle(t,e)},disposeMaterial:function(t,e){var i=e[t];i&&(i.map.dispose(),i.map=null,i.dispose(),e[t]=null)}}}),define("DS/Robot/RobotHandle",["DS/Visualization/ThreeJS_DS","DS/Visualization/Node3D","WebappsUtils/WebappsUtils","DS/Visualization/GeometryHelper","DS/SceneGraphNodes/BillBoardNode3D","DS/Manipulators/ScreenPlaneManipulator","DS/Mesh/MeshUtils","DS/CoreEvents/Events","DS/CoreEvents/ModelEvents","DS/Visualization/SceneGraphFactory"],function(t,e,i,n,a,o,s,r,l,h){"use strict";var d=e.extend({init:function(e){this._parent(e.name),this.position=e.position,this._modelEvent=new l,this.isPreactivated=!1,this.isManipulated=!1,this.enablePreactivate=!0,this.touchMode=e.touchMode;var i=this,r=(new n).createRectangle({width:4,height:4,fill:!0,fillColor:null,noEdge:!0}),d=new t.ImageUtils._loadTextureVisu("Robot","models/textures/Point.png",void 0,null,null,t.ImageUtils.crossOriginPolicy);d.flipY=!1,d.minFilter=t.LinearMipMapLinearFilter,this.pointMat=new t.MeshBasicMaterial({map:d,side:t.DoubleSide,transparent:!0,alphaTest:.05,enableClipPlanes:!1}),this.pointMat.force=!0;var c=h.createMeshNode(r,this.pointMat);if(c.setShadow(!1),c.setFrustumCulled(!1),c.name="diskNode",c.excludeFromCSO(!0),c.excludeFromHighlight(!0,!0),c.setMatrix((new t.Matrix4).setPosition(new t.Vector3(-2,-2,0))),this.touchMode){c.setPickable(s.PICKTHROUGH);var u=new t.MeshBasicMaterial({transparent:!0,opacity:0,enableClipPlanes:!1,color:new t.Color("red"),force:!0}),p=h.createSphereNode({radius:3,material:u});p.setShadow(!1),p.setFrustumCulled(!1),p.name="sphereNode",p.excludeFromCSO(!0),p.excludeFromHighlight(!0,!0),this.addChild(p)}var v={position:this.position,name:"billBoard1",type:"Spherical"};this.billBoardNode=new a(v),this.billBoardNode.addChild(c),this.addChild(this.billBoardNode),this.screenPlaneManipulator=new o({cameraName:e.cameraName}),this.screenPlaneManipulator.setExclusive(!0),this.screenPlaneManipulator.linkToNode(this),this.screenPlaneManipulator.onBeginManipulate(function(e){i._modelEvent.publish({event:"ScreenPlaneTranslationBegin",data:e,context:this}),i.pointMat.color=new t.Color("#1B6E9C"),i.pointMat.opacity=1,i.isManipulated=!0}),this.screenPlaneManipulator.onManipulate(function(t){i._modelEvent.publish({event:"ScreenPlaneTranslationManipulation",data:t,context:this})}),this.screenPlaneManipulator.onEndManipulate(function(e){i._modelEvent.publish({event:"ScreenPlaneTranslationEnd",data:e,context:this}),i.isPreactivated?i.pointMat.color=new t.Color("#A1D9ED"):i.pointMat.color=new t.Color("#FFFFFF"),i.isManipulated=!1}),this.screenPlaneManipulator.onBeginPreactivate(function(e){i._modelEvent.publish({event:"BeginPreactivate",data:e,context:this}),!i.isManipulated&&i.enablePreactivate&&e.viewer.setTemporaryCursor("pointer"),i.isPreactivated=!0,!i.isManipulated&&i.enablePreactivate&&(i.pointMat.color=new t.Color("#A1D9ED")),e.viewer.render()}),this.screenPlaneManipulator.onEndPreactivate(function(e){i._modelEvent.publish({event:"EndPreactivate",data:e,context:this}),!i.isManipulated&&i.enablePreactivate&&e.viewer.unsetTemporaryCursor(),i.isPreactivated=!1,i.isManipulated||(i.pointMat.color=new t.Color("#FFFFFF")),e.viewer.render()})},setParentManipulated:function(t){this.enablePreactivate=!t},setToGhostState:function(){this.pointMat.opacity=0},setToNonGhostState:function(){this.pointMat.opacity=1},setCameraName:function(t){this.screenPlaneManipulator.setCameraName(t)}});return UWA.namespace("THREEDS/Robot/RobotHandle",d)}),define("Robot/RobotHandle",["DS/Robot/RobotHandle","DS/DSMigration/DSMigration"],function(t,e){return e.deprecateModule("Robot/RobotHandle"),t}),define("DS/Robot/ScalingNode",["DS/Visualization/ThreeJS_DS","DS/Visualization/Node3D","WebappsUtils/WebappsUtils","DS/Visualization/GeometryHelper","DS/SceneGraphNodes/BillBoardNode3D","DS/Manipulators/ScalingManipulator","DS/Mesh/MeshUtils","DS/CoreEvents/ModelEvents","DS/Visualization/SceneGraphFactory"],function(t,e,i,n,a,o,s,r,l){"use strict";var h=e.extend({init:function(e){var i=this;this._parent(e.name),this.axis=e.constraintAxis,this._modelEvent=new r,this.isPreactivated=!1,this.isManipulated=!1,this.enablePreactivate=!0;var s=(new n).createRectangle({width:2,height:2,fill:!0,fillColor:null,noEdge:!0}),h=new t.ImageUtils._loadTextureVisu("Robot","models/textures/Point.png",void 0,null,null,t.ImageUtils.crossOriginPolicy);h.flipY=!1,h.minFilter=t.LinearMipMapLinearFilter,this.pointMat=new t.MeshBasicMaterial({map:h,side:t.DoubleSide,transparent:!0,alphaTest:.05,enableClipPlanes:!1}),this.pointMat.force=!0;var d=l.createMeshNode(s,this.pointMat);d.setShadow(!1),d.setFrustumCulled(!1),d.name="diskNode",d.excludeFromCSO(!0),d.excludeFromHighlight(!0,!0),d.setMatrix((new t.Matrix4).setPosition(new t.Vector3(-1,-1,0)));var c={position:this.position,name:"billBoard1",type:"Spherical"};this.billBoardNode=new a(c),this.billBoardNode.addChild(d),this.addChild(this.billBoardNode),this.name="handleNode",this.manipulator=new o({axis:this.axis}),this.manipulator.setExclusive(!0),this.manipulator.linkToNode(this),this.manipulator.onBeginManipulate(function(e){i._modelEvent.publish({event:"ScalingBegin",data:e,context:this}),i.pointMat.opacity=1,i.pointMat.color=new t.Color("#1B6E9C"),i.isManipulated=!0}),this.manipulator.onManipulate(function(t){i._modelEvent.publish({event:"ScalingManipulation",data:t,context:this})}),this.manipulator.onEndManipulate(function(e){i._modelEvent.publish({event:"ScalingEnd",data:e,context:this}),i.isPreactivated?i.pointMat.color=new t.Color("#A1D9ED"):i.pointMat.color=new t.Color("#FFFFFF"),i.isManipulated=!1}),this.manipulator.onBeginPreactivate(function(e){i._modelEvent.publish({event:"BeginPreactivate",data:e,context:this}),!i.isManipulated&&i.enablePreactivate&&e.viewer.setTemporaryCursor("pointer"),i.isPreactivated=!0,!i.isManipulated&&i.enablePreactivate&&(i.pointMat.color=new t.Color("#A1D9ED")),e.viewer.render()}),this.manipulator.onEndPreactivate(function(e){i._modelEvent.publish({event:"EndPreactivate",data:e,context:this}),!i.isManipulated&&i.enablePreactivate&&e.viewer.unsetTemporaryCursor(),i.isPreactivated=!1,i.isManipulated||(i.pointMat.color=new t.Color("#FFFFFF")),e.viewer.render()}),this.manipulator.onPrimaryPointerClick(function(t){i._modelEvent.publish({event:"PrimaryPointerClick",data:t,context:this})})},setCenter:function(t){this.manipulator.setCenter(t)},setAxis:function(t){var e=t&&t.clone();e&&e.normalize(),this.axis=e,this.manipulator.axis=e},setParentManipulated:function(t){this.enablePreactivate=!t},setToGhostState:function(){this.pointMat.opacity=0},setToNonGhostState:function(){this.pointMat.opacity=1}});return UWA.namespace("THREEDS/Robot/ScalingNode",h)}),define("Robot/ScalingNode",["DS/Robot/ScalingNode","DS/DSMigration/DSMigration"],function(t,e){return e.deprecateModule("Robot/ScalingNode"),t}),define("DS/Robot/XYRotationNode",["DS/Visualization/ThreeJS_DS","DS/Visualization/Node3D","DS/Visualization/WorldOrientation","DS/SceneGraphNodes/BillBoardNode3D","DS/Manipulators/RotationManipulator","DS/Mesh/MeshUtils","DS/CoreEvents/Events","DS/CoreEvents/ModelEvents","DS/Robot/RobotUtils"],function(t,e,i,n,a,o,s,r,l){"use strict";var h=e.extend({init:function(e){var n=this;this._parent(e.name),this.axis=e.constraintAxis,this._modelEvent=new r,this.isPreactivated=!1,this.isManipulated=!1,this.enablePreactivate=!0,this.touchMode=e.touchMode,this._worldOrientation=null,this.manipulator=null,this._manipulatorToken=null,this._updateRepresentation(i.ZUpYRight),this.manipulator=new a({axis:this.axis}),this.manipulator.setExclusive(!0),this._manipulatorToken=this.manipulator.linkToNode(this),this.manipulator.onBeginManipulate(function(e){n._modelEvent.publish({event:"RotationBegin",data:e,context:this}),n.privilegedPlaneMat.opacity=1,n.privilegedPlaneMat.color=new t.Color("#1B6E9C"),n.isManipulated=!0}),this.manipulator.onManipulate(function(t){n._modelEvent.publish({event:"RotationManipulation",data:t,context:this})}),this.manipulator.onEndManipulate(function(e){n._modelEvent.publish({event:"RotationEnd",data:e,context:this}),n.isPreactivated?n.privilegedPlaneMat.color=new t.Color("#A1D9ED"):n.privilegedPlaneMat.color=new t.Color("#FFFFFF"),n.isManipulated=!1}),this.manipulator.onBeginPreactivate(function(e){n._modelEvent.publish({event:"BeginPreactivate",data:e,context:this}),!n.isManipulated&&n.enablePreactivate&&e.viewer.setTemporaryCursor("pointer"),n.isPreactivated=!0,!n.isManipulated&&n.enablePreactivate&&(n.privilegedPlaneMat.color=new t.Color("#A1D9ED")),e.viewer.render()}),this.manipulator.onEndPreactivate(function(e){n._modelEvent.publish({event:"EndPreactivate",data:e,context:this}),!n.isManipulated&&n.enablePreactivate&&e.viewer.unsetTemporaryCursor(),n.isPreactivated=!1,n.isManipulated||(n.privilegedPlaneMat.color=new t.Color("#FFFFFF")),e.viewer.render()}),this.manipulator.onPrimaryPointerClick(function(t){n._modelEvent.publish({event:"PrimaryPointerClick",data:t,context:this})})},_updateRepresentation:function(e){if(e!==this._worldOrientation){var n=this.manipulator;n&&(n.unlink(this._manipulatorToken),this._manipulatorToken=null),this.removeChildren(),l.disposeMaterial("privilegedPlaneMat",this),l.disposeMaterial("planeMatPicking",this);var a=e===i.ZUpYRight,s=l.createRotationRectangle(!1,null,a);this.privilegedPlaneMat=s.material;var r,h=s.node;if(r=a?(new t.Matrix4).setPosition(new t.Vector3(-8.5,-8.5,0)):new t.Matrix4,h.setMatrix(r),this.addChild(h),this.touchMode){h.setPickable(o.PICKTHROUGH);var d=l.createRotationRectangle(!0,null,a),c=d.node;this.planeMatPicking=d.material,c.setMatrix(r),this.addChild(c)}n&&(this._manipulatorToken=n.linkToNode(this)),this._worldOrientation=e}},setCenter:function(t){this.manipulator.setCenter(t)},setAxis:function(t){this.axis=t,this.manipulator.setAxis(t)},setParentManipulated:function(t){this.enablePreactivate=!t},setToGhostState:function(){this.privilegedPlaneMat.opacity=0},setToNonGhostState:function(){this.privilegedPlaneMat.opacity=1},_setWorldOrientation:function(t){this._updateRepresentation(t)}});return UWA.namespace("THREEDS/Robot/XYRotationNode",h)}),define("Robot/XYRotationNode",["DS/Robot/XYRotationNode","DS/DSMigration/DSMigration"],function(t,e){return e.deprecateModule("Robot/XYRotationNode"),t}),define("DS/Robot/YZRotationNode",["DS/Visualization/ThreeJS_DS","DS/Visualization/Node3D","DS/SceneGraphNodes/BillBoardNode3D","DS/Manipulators/RotationManipulator","DS/Mesh/MeshUtils","DS/CoreEvents/Events","DS/CoreEvents/ModelEvents","DS/Robot/RobotUtils"],function(t,e,i,n,a,o,s,r){"use strict";var l=e.extend({init:function(e){var i=this;this._parent(e.name),this.axis=e.constraintAxis,this._modelEvent=new s,this.isPreactivated=!1,this.isManipulated=!1,this.enablePreactivate=!0,this.touchMode=e.touchMode;var o=r.createSmallRotationRectangle(!1,null);this.planeMat=o.material;var l=o.node;if(l.setMatrix((new t.Matrix4).rotateY(-.5*Math.PI)),this.addChild(l),this.touchMode){l.setPickable(a.PICKTHROUGH);var h=r.createSmallRotationRectangle(!0,null);this.planeMat_picking=h.material;var d=h.node;d.setMatrix((new t.Matrix4).rotateY(-.5*Math.PI)),this.addChild(d)}this.manipulator=new n({axis:this.axis}),this.manipulator.setExclusive(!0),this.manipulator.linkToNode(this),this.manipulator.onBeginManipulate(function(e){i._modelEvent.publish({event:"RotationBegin",data:e,context:this}),i.planeMat.opacity=1,i.planeMat.color=new t.Color("#1B6E9C"),i.isManipulated=!0}),this.manipulator.onManipulate(function(t){i._modelEvent.publish({event:"RotationManipulation",data:t,context:this})}),this.manipulator.onEndManipulate(function(e){i._modelEvent.publish({event:"RotationEnd",data:e,context:this}),i.isPreactivated?i.planeMat.color=new t.Color("#A1D9ED"):i.planeMat.color=new t.Color("#FFFFFF"),i.isManipulated=!1}),this.manipulator.onBeginPreactivate(function(e){i._modelEvent.publish({event:"BeginPreactivate",data:e,context:this}),!i.isManipulated&&i.enablePreactivate&&e.viewer.setTemporaryCursor("pointer"),i.isPreactivated=!0,!i.isManipulated&&i.enablePreactivate&&(i.planeMat.color=new t.Color("#A1D9ED")),e.viewer.render()}),this.manipulator.onEndPreactivate(function(e){i._modelEvent.publish({event:"EndPreactivate",data:e,context:this}),!i.isManipulated&&i.enablePreactivate&&e.viewer.unsetTemporaryCursor(),i.isPreactivated=!1,i.isManipulated||(i.planeMat.color=new t.Color("#FFFFFF")),e.viewer.render()}),this.manipulator.onPrimaryPointerClick(function(t){i._modelEvent.publish({event:"PrimaryPointerClick",data:t,context:this})})},setCenter:function(t){this.manipulator.setCenter(t)},setAxis:function(t){this.axis=t,this.manipulator.axis=t},setParentManipulated:function(t){this.enablePreactivate=!t},setToGhostState:function(){this.planeMat.opacity=0},setToNonGhostState:function(){this.planeMat.opacity=1},_setWorldOrientation:function(t){}});return UWA.namespace("THREEDS/Robot/YZRotationNode",l)}),define("Robot/YZRotationNode",["DS/Robot/YZRotationNode","DS/DSMigration/DSMigration"],function(t,e){return e.deprecateModule("Robot/YZRotationNode"),t}),define("DS/Robot/XZRotationNode",["DS/Visualization/ThreeJS_DS","DS/Visualization/Node3D","DS/Visualization/WorldOrientation","DS/SceneGraphNodes/BillBoardNode3D","DS/Manipulators/RotationManipulator","DS/Mesh/MeshUtils","DS/CoreEvents/Events","DS/CoreEvents/ModelEvents","DS/Robot/RobotUtils"],function(t,e,i,n,a,o,s,r,l){"use strict";var h=e.extend({init:function(e){var n=this;this._parent(e.name),this.axis=e.constraintAxis,this._modelEvent=new r,this.isPreactivated=!1,this.isManipulated=!1,this.enablePreactivate=!0,this.touchMode=e.touchMode,this._worldOrientation=null,this.manipulator=null,this._manipulatorToken=null,this._updateRepresentation(i.ZUpYRight),this.manipulator=new a({axis:this.axis}),this.manipulator.setExclusive(!0),this._manipulatorToken=this.manipulator.linkToNode(this),this.manipulator.onBeginManipulate(function(e){n._modelEvent.publish({event:"RotationBegin",data:e,context:this}),n.planeMat.opacity=1,n.planeMat.color=new t.Color("#1B6E9C"),n.isManipulated=!0}),this.manipulator.onManipulate(function(t){n._modelEvent.publish({event:"RotationManipulation",data:t,context:this})}),this.manipulator.onEndManipulate(function(e){n._modelEvent.publish({event:"RotationEnd",data:e,context:this}),n.isPreactivated?n.planeMat.color=new t.Color("#A1D9ED"):n.planeMat.color=new t.Color("#FFFFFF"),n.isManipulated=!1}),this.manipulator.onBeginPreactivate(function(e){n._modelEvent.publish({event:"BeginPreactivate",data:e,context:this}),!n.isManipulated&&n.enablePreactivate&&e.viewer.setTemporaryCursor("pointer"),n.isPreactivated=!0,!n.isManipulated&&n.enablePreactivate&&(n.planeMat.color=new t.Color("#A1D9ED")),e.viewer.render()}),this.manipulator.onEndPreactivate(function(e){n._modelEvent.publish({event:"EndPreactivate",data:e,context:this}),!n.isManipulated&&n.enablePreactivate&&e.viewer.unsetTemporaryCursor(),n.isPreactivated=!1,n.isManipulated||(n.planeMat.color=new t.Color("#FFFFFF")),e.viewer.render()}),this.manipulator.onPrimaryPointerClick(function(t){n._modelEvent.publish({event:"PrimaryPointerClick",data:t,context:this})})},_updateRepresentation:function(e){if(e!==this._worldOrientation){var n=this.manipulator;n&&(n.unlink(this._manipulatorToken),this._manipulatorToken=null),this.removeChildren(),l.disposeMaterial("planeMat",this),l.disposeMaterial("planeMat_picking",this);var a=e===i.ZUpYRight,s=l.createRotationRectangle(!1,null,!a);this.planeMat=s.material;var r,h=s.node;if(r=a?(new t.Matrix4).rotateX(.5*Math.PI):(new t.Matrix4).rotateX(.5*Math.PI).translate(new t.Vector3(-8.5,-8.5,0)),h.setMatrix(r),this.addChild(h),this.touchMode){h.setPickable(o.PICKTHROUGH);var d=l.createRotationRectangle(!0,null,!a);this.planeMat_picking=d.material;var c=d.node;c.setMatrix(r),this.addChild(c)}n&&(this._manipulatorToken=n.linkToNode(this)),this._worldOrientation=e}},setCenter:function(t){this.manipulator.setCenter(t)},setAxis:function(t){this.axis=t,this.manipulator.axis=t},setParentManipulated:function(t){this.enablePreactivate=!t},setToGhostState:function(){this.planeMat.opacity=0},setToNonGhostState:function(){this.planeMat.opacity=1},_setWorldOrientation:function(t){this._updateRepresentation(t)}});return UWA.namespace("THREEDS/Robot/XZRotationNode",h)}),define("Robot/XZRotationNode",["DS/Robot/XZRotationNode","DS/DSMigration/DSMigration"],function(t,e){return e.deprecateModule("Robot/XZRotationNode"),t}),define("DS/Robot/XZPlaneTranslationNode",["DS/Visualization/ThreeJS_DS","DS/Visualization/Node3D","DS/Visualization/WorldOrientation","DS/SceneGraphNodes/BillBoardNode3D","DS/Manipulators/PlaneTranslationManipulator","DS/CoreEvents/ModelEvents","DS/Visualization/SceneGraphFactory","DS/Mesh/MeshUtils","DS/Robot/RobotUtils"],function(t,e,i,n,a,o,s,r,l){"use strict";var h=e.extend({init:function(e){var n=this;this._parent(e.name),this.axis=e.constraintAxis,this._modelEvent=new o,this.isPreactivated=!1,this.isManipulated=!1,this.enablePreactivate=!0,this.touchMode=e.touchMode,this._worldOrientation=null,this.manipulator=null,this._manipulatorToken=null,this._updateRepresentation(i.ZUpYRight),this.manipulator=new a({axis:this.axis}),this.manipulator.setExclusive(!0),this._manipulatorToken=this.manipulator.linkToNode(this),this.manipulator.onPrimaryPointerClick(function(t){n._modelEvent.publish({event:"PrimaryPointerClick",data:{node:this},context:this})}),this.manipulator.onBeginManipulate(function(e){n._modelEvent.publish({event:"PlaneTranslationBegin",data:e,context:this}),n.planeMat.opacity=1,n.planeMat.color=new t.Color("#1B6E9C"),n.isManipulated=!0}),this.manipulator.onManipulate(function(t){n._modelEvent.publish({event:"PlaneTranslationManipulation",data:t,context:this})}),this.manipulator.onEndManipulate(function(e){n._modelEvent.publish({event:"PlaneTranslationEnd",data:e,context:this}),n.isPreactivated?n.planeMat.color=new t.Color("#A1D9ED"):n.planeMat.color=new t.Color("#FFFFFF"),n.isManipulated=!1}),this.manipulator.onBeginPreactivate(function(e){n._modelEvent.publish({event:"BeginPreactivate",data:e,context:this}),!n.isManipulated&&n.enablePreactivate&&e.viewer.setTemporaryCursor("pointer"),n.isPreactivated=!0,!n.isManipulated&&n.enablePreactivate&&(n.planeMat.color=new t.Color("#A1D9ED")),e.viewer.render()}),this.manipulator.onEndPreactivate(function(e){n._modelEvent.publish({event:"EndPreactivate",data:e,context:this}),!n.isManipulated&&n.enablePreactivate&&e.viewer.unsetTemporaryCursor(),n.isPreactivated=!1,n.isManipulated||(n.planeMat.color=new t.Color("#FFFFFF")),e.viewer.render()})},_updateRepresentation:function(e){if(e!==this._worldOrientation){var n=this.manipulator;n&&(n.unlink(this._manipulatorToken),this._manipulatorToken=null),this.removeChildren(),l.disposeMaterial("planeMat",this),l.disposeMaterial("planeMat_picking",this);var a=e===i.ZUpYRight,o=l.createTranslationRectangle(!1,null,!a);this.planeMat=o.material;var s,h=o.node;if(s=a?(new t.Matrix4).rotateX(.5*Math.PI).translate(new t.Vector3(.5,.5,0)):(new t.Matrix4).rotateX(.5*Math.PI).translate(new t.Vector3(-7.5,-7.5,0)),h.setMatrix(s),this.addChild(h),this.touchMode){h.setPickable(r.PICKTHROUGH);var d=l.createTranslationRectangle(!0,null,!a),c=d.node;this.planeMat_picking=d.material,c.setMatrix(s),this.addChild(c)}n&&(this._manipulatorToken=n.linkToNode(this)),this._worldOrientation=e}},setAxis:function(t){this.axis=t,this.manipulator.axis=t},setParentManipulated:function(t){this.enablePreactivate=!t},setToGhostState:function(){this.planeMat.opacity=0},setToNonGhostState:function(){this.planeMat.opacity=1},_setWorldOrientation:function(t){this._updateRepresentation(t)}});return UWA.namespace("THREEDS/Robot/XZPlaneTranslationNode",h)}),define("Robot/XZPlaneTranslationNode",["DS/Robot/XZPlaneTranslationNode","DS/DSMigration/DSMigration"],function(t,e){return e.deprecateModule("Robot/XZPlaneTranslationNode"),t}),define("DS/Robot/YZPlaneTranslationNode",["DS/Visualization/ThreeJS_DS","DS/Visualization/Node3D","DS/SceneGraphNodes/BillBoardNode3D","DS/Manipulators/PlaneTranslationManipulator","DS/CoreEvents/ModelEvents","DS/Mesh/MeshUtils","DS/Robot/RobotUtils"],function(t,e,i,n,a,o,s){"use strict";var r=e.extend({init:function(e){var i=this;this._parent(e.name),this._modelEvent=new a,this.axis=e.constraintAxis,this.isPreactivated=!1,this.isManipulated=!1,this.enablePreactivate=!0,this.touchMode=e.touchMode,this._worldOrientation=e.worldOrientation;var r=s.createSmallTranslationRectangle(!1,null);this.planeMat=r.material;var l=r.node;if(this.yzPlaneNode=l,this.updatePlaneNodeMatrix(),this.addChild(l),this.touchMode){l.setPickable(o.PICKTHROUGH);var h=s.createSmallTranslationRectangle(!0,null),d=h.node;this.planeMat_picking=h.material,d.setMatrix((new t.Matrix4).rotateY(-.5*Math.PI).translate(new t.Vector3(.5,.5,0))),this.addChild(d)}this.manipulator=new n({axis:this.axis}),this.manipulator.setExclusive(!0),this.manipulator.linkToNode(this),this.manipulator.onPrimaryPointerClick(function(t){i._modelEvent.publish({event:"PrimaryPointerClick",data:{node:this},context:this})}),this.manipulator.onBeginManipulate(function(e){i._modelEvent.publish({event:"PlaneTranslationBegin",data:e,context:this}),i.planeMat.opacity=1,i.planeMat.color=new t.Color("#1B6E9C"),i.isManipulated=!0}),this.manipulator.onManipulate(function(t){i._modelEvent.publish({event:"PlaneTranslationManipulation",data:t,context:this})}),this.manipulator.onEndManipulate(function(e){i._modelEvent.publish({event:"PlaneTranslationEnd",data:e,context:this}),i.isPreactivated?i.planeMat.color=new t.Color("#A1D9ED"):i.planeMat.color=new t.Color("#FFFFFF"),i.isManipulated=!1}),this.manipulator.onBeginPreactivate(function(e){i._modelEvent.publish({event:"BeginPreactivate",data:e,context:this}),!i.isManipulated&&i.enablePreactivate&&e.viewer.setTemporaryCursor("pointer"),i.isPreactivated=!0,!i.isManipulated&&i.enablePreactivate&&(i.planeMat.color=new t.Color("#A1D9ED")),e.viewer.render()}),this.manipulator.onEndPreactivate(function(e){i._modelEvent.publish({event:"EndPreactivate",data:e,context:this}),!i.isManipulated&&i.enablePreactivate&&e.viewer.unsetTemporaryCursor(),i.isPreactivated=!1,i.isManipulated||(i.planeMat.color=new t.Color("#FFFFFF")),e.viewer.render()})},setCenter:function(t){this.manipulator.setCenter(t)},setAxis:function(t){this.axis=t,this.manipulator.axis=t},setParentManipulated:function(t){this.enablePreactivate=!t},setToGhostState:function(){this.planeMat.opacity=0},setToNonGhostState:function(){this.planeMat.opacity=1},updatePlaneNodeMatrix:function(){this.yzPlaneNode.setMatrix((new t.Matrix4).rotateY(-.5*Math.PI).translate(new t.Vector3(.5,.5,0)))},_setWorldOrientation:function(t){}});return UWA.namespace("THREEDS/Robot/YZPlaneTranslationNode",r)}),define("Robot/YZPlaneTranslationNode",["DS/Robot/YZPlaneTranslationNode","DS/DSMigration/DSMigration"],function(t,e){return e.deprecateModule("Robot/YZPlaneTranslationNode"),t}),define("DS/Robot/XYPlaneTranslationNode",["DS/Visualization/ThreeJS_DS","DS/Visualization/Node3D","DS/Visualization/WorldOrientation","DS/SceneGraphNodes/BillBoardNode3D","DS/Manipulators/PlaneTranslationManipulator","DS/CoreEvents/ModelEvents","DS/Mesh/MeshUtils","DS/Robot/RobotUtils"],function(t,e,i,n,a,o,s,r){"use strict";var l=e.extend({init:function(e){var n=this;this._parent(e.name),this.axis=e.constraintAxis,this._modelEvent=new o,this.isPreactivated=!1,this.isManipulated=!1,this.enablePreactivate=!0,this.touchMode=e.touchMode,this._worldOrientation=null,this.manipulator=null,this._manipulatorToken=null,this._updateRepresentation(i.ZUpYRight),this.manipulator=new a({axis:this.axis}),this.manipulator.setExclusive(!0),this._manipulatorToken=this.manipulator.linkToNode(this),this.manipulator.onPrimaryPointerClick(function(t){n._modelEvent.publish({event:"PrimaryPointerClick",data:{node:this},context:this})}),this.manipulator.onBeginManipulate(function(e){n._modelEvent.publish({event:"PlaneTranslationBegin",data:e,context:this}),n.planeMat.opacity=1,n.planeMat.color=new t.Color("#1B6E9C"),n.isManipulated=!0}),this.manipulator.onManipulate(function(t){n._modelEvent.publish({event:"PlaneTranslationManipulation",data:t,context:this})}),this.manipulator.onEndManipulate(function(e){n._modelEvent.publish({event:"PlaneTranslationEnd",data:e,context:this}),n.isPreactivated?n.planeMat.color=new t.Color("#A1D9ED"):n.planeMat.color=new t.Color("#FFFFFF"),n.isManipulated=!1,e.viewer.render()}),this.manipulator.onBeginPreactivate(function(e){n._modelEvent.publish({event:"BeginPreactivate",data:e,context:this}),!n.isManipulated&&n.enablePreactivate&&e.viewer.setTemporaryCursor("pointer"),n.isPreactivated=!0,!n.isManipulated&&n.enablePreactivate&&(n.planeMat.color=new t.Color("#A1D9ED")),e.viewer.render()}),this.manipulator.onEndPreactivate(function(e){n._modelEvent.publish({event:"EndPreactivate",data:e,context:this}),!n.isManipulated&&n.enablePreactivate&&e.viewer.unsetTemporaryCursor(),n.isPreactivated=!1,n.isManipulated||(n.planeMat.color=new t.Color("#FFFFFF")),e.viewer.render()})},_updateRepresentation:function(e){if(e!==this._worldOrientation){var n=this.manipulator;n&&(n.unlink(this._manipulatorToken),this._manipulatorToken=null),this.removeChildren(),r.disposeMaterial("planeMat",this),r.disposeMaterial("planeMatPicking",this);var a=e===i.ZUpYRight,o=r.createTranslationRectangle(!1,null,a);this.planeMat=o.material;var l,h=o.node;if(l=a?(new t.Matrix4).setPosition(new t.Vector3(-7.5,-7.5,0)):(new t.Matrix4).setPosition(new t.Vector3(.5,.5,0)),h.setMatrix(l),this.addChild(h),this.touchMode){h.setPickable(s.PICKTHROUGH);var d=r.createTranslationRectangle(!0,null,a),c=d.node;this.planeMatPicking=d.material,c.setMatrix(l),this.addChild(c)}n&&(this._manipulatorToken=n.linkToNode(this)),this._worldOrientation=e}},setAxis:function(t){this.axis=t,this.manipulator.axis=t},setParentManipulated:function(t){this.enablePreactivate=!t},setToGhostState:function(){this.planeMat.opacity=0},setToNonGhostState:function(){this.planeMat.opacity=1},setToDragState:function(){this.planeMat.opacity=.3},_setWorldOrientation:function(t){this._updateRepresentation(t)}});return UWA.namespace("THREEDS/Robot/XYPlaneTranslationNode",l)}),define("Robot/XYPlaneTranslationNode",["DS/Robot/XYPlaneTranslationNode","DS/DSMigration/DSMigration"],function(t,e){return e.deprecateModule("Robot/XYPlaneTranslationNode"),t}),define("DS/Robot/FreeRobot",["DS/SceneGraphNodes/FixedSizeNode3D","DS/Mesh/MeshUtils","DS/Visualization/ThreeJS_DS","DS/Visualization/Node3D","DS/Robot/LineTranslationNode","DS/Robot/XYRotationNode","DS/Robot/XZRotationNode","DS/Robot/YZRotationNode","DS/Robot/YZPlaneTranslationNode","DS/Robot/XYPlaneTranslationNode","DS/Robot/XZPlaneTranslationNode","DS/Robot/RobotHandle","DS/Robot/ScalingNode","DS/CoreEvents/Events","DS/CoreEvents/ModelEvents","DS/Selection/HSOManager","DS/Visualization/Mesh3D"],function(t,e,i,n,a,o,s,r,l,h,d,c,u,p,v,M,b){"use strict";var m=!1,P=n.extend({init:function(e,n,p,M,m){this._parent(e),this.setParameters(p,M);var P=this;this.isManipulated=!1,this.sceneGraphState=null,this.mode="NODE",this._labels={},this._modelEvent=new v,this._subscribedEvents=[];var g={position:new i.Vector3(0,0,0),touchMode:m||!1};this.arrowZ=new a(g),this.arrowZ.setMatrix((new i.Matrix4).setPosition(new i.Vector3(0,0,2))),this.arrowZ.name="arrowZ",this.arrowY=new a(g),this.arrowY.setMatrix((new i.Matrix4).rotateX(-Math.PI/2).setPosition(new i.Vector3(0,2,0))),this.arrowY.name="arrowY",this.arrowX=new a(g),this.arrowX.setMatrix((new i.Matrix4).rotateY(Math.PI/2).setPosition(new i.Vector3(2,0,0))),this.arrowX.name="arrowX";var w={constraintAxis:new i.Vector3(0,0,1),touchMode:m||!1};this.rotationArcXY=new o(w);var x={constraintAxis:new i.Vector3(0,1,0),touchMode:m||!1};this.rotationArcXZ=new s(x),this.rotationArcXZ.name="rotationArcXZ";var S={constraintAxis:new i.Vector3(1,0,0),touchMode:m||!1};this.rotationArcYZ=new r(S),this.rotationArcYZ.name="rotationArcYZ";var f={position:new i.Vector3(0,0,0),touchMode:m||!1};this.robotHandle=new c(f);var C={constraintAxis:new i.Vector3(1,0,0),touchMode:m||!1};this.scalingNodeX=new u(C),this.scalingNodeX.setMatrix((new i.Matrix4).setPosition(new i.Vector3(11,0,0)));var _={constraintAxis:new i.Vector3(0,1,0),touchMode:m||!1};this.scalingNodeY=new u(_),this.scalingNodeY.setMatrix((new i.Matrix4).setPosition(new i.Vector3(0,11,0)));var T={constraintAxis:new i.Vector3(0,0,1),touchMode:m||!1};this.scalingNodeZ=new u(T),this.scalingNodeZ.setMatrix((new i.Matrix4).setPosition(new i.Vector3(0,0,11)));var E={constraintAxis:new i.Vector3(0,0,1),touchMode:m||!1},R={constraintAxis:new i.Vector3(0,1,0),touchMode:m||!1},D={constraintAxis:new i.Vector3(1,0,0),touchMode:m||!1};this.translationPlaneXY=new h(E),this.translationPlaneXZ=new d(R),this.translationPlaneYZ=new l(D),this.name="robot",this.fixedSizeNode3D=new t({name:"fixedSizeNode3D",ratio:7}),this.fixedSizeNode3D.addChild(this.rotationArcXY),this.fixedSizeNode3D.addChild(this.rotationArcYZ),this.fixedSizeNode3D.addChild(this.rotationArcXZ),this.fixedSizeNode3D.addChild(this.arrowZ),this.fixedSizeNode3D.addChild(this.arrowX),this.fixedSizeNode3D.addChild(this.arrowY),this.fixedSizeNode3D.addChild(this.robotHandle),this.fixedSizeNode3D.addChild(this.scalingNodeZ),this.fixedSizeNode3D.addChild(this.scalingNodeY),this.fixedSizeNode3D.addChild(this.scalingNodeX),this.fixedSizeNode3D.addChild(this.translationPlaneYZ),this.fixedSizeNode3D.addChild(this.translationPlaneXY),this.fixedSizeNode3D.addChild(this.translationPlaneXZ),this.addChild(this.fixedSizeNode3D),this.traverse(function(t){t instanceof b&&t.setMirror(!1)}),this.setVisibilityInTree(!1),this.setRenderPasses(["robot"]),this._subscribeModelEvent(this.arrowX,"LineTranslationBegin",P.LineTranslationBeginCB.bind(P)),this._subscribeModelEvent(this.arrowX,"LineTranslationManipulation",P.LineTranslationManipulationCB.bind(P)),this._subscribeModelEvent(this.arrowX,"LineTranslationEnd",P.LineTranslationEndCB.bind(P)),this._subscribeModelEvent(this.arrowY,"LineTranslationBegin",P.LineTranslationBeginCB.bind(P)),this._subscribeModelEvent(this.arrowY,"LineTranslationManipulation",P.LineTranslationManipulationCB.bind(P)),this._subscribeModelEvent(this.arrowY,"LineTranslationEnd",P.LineTranslationEndCB.bind(P)),this._subscribeModelEvent(this.arrowZ,"LineTranslationBegin",P.LineTranslationBeginCB.bind(P)),this._subscribeModelEvent(this.arrowZ,"LineTranslationManipulation",P.LineTranslationManipulationCB.bind(P)),this._subscribeModelEvent(this.arrowZ,"LineTranslationEnd",P.LineTranslationEndCB.bind(P)),this._subscribeModelEvent(this.translationPlaneYZ,"PlaneTranslationBegin",P.PlaneTranslationBeginCB.bind(P)),this._subscribeModelEvent(this.translationPlaneYZ,"PlaneTranslationManipulation",P.PlaneTranslationManipulationCB.bind(P)),this._subscribeModelEvent(this.translationPlaneYZ,"PlaneTranslationEnd",P.PlaneTranslationEndCB.bind(P)),this._subscribeModelEvent(this.translationPlaneXZ,"PlaneTranslationBegin",P.PlaneTranslationBeginCB.bind(P)),this._subscribeModelEvent(this.translationPlaneXZ,"PlaneTranslationManipulation",P.PlaneTranslationManipulationCB.bind(P)),this.translationPlaneXZ._modelEvent.subscribe({event:"PlaneTranslationEnd"},P.PlaneTranslationEndCB.bind(P)),this._subscribeModelEvent(this.translationPlaneXY,"PlaneTranslationBegin",P.PlaneTranslationBeginCB.bind(P)),this._subscribeModelEvent(this.translationPlaneXY,"PlaneTranslationManipulation",P.PlaneTranslationManipulationCB.bind(P)),this._subscribeModelEvent(this.translationPlaneXY,"PlaneTranslationEnd",P.PlaneTranslationEndCB.bind(P)),this._subscribeModelEvent(this.rotationArcXY,"RotationBegin",P.RotationBeginCB.bind(P)),this._subscribeModelEvent(this.rotationArcXY,"RotationManipulation",P.RotationManipulationCB.bind(P)),this._subscribeModelEvent(this.rotationArcXY,"RotationEnd",P.RotationEndCB.bind(P)),this._subscribeModelEvent(this.rotationArcXZ,"RotationBegin",P.RotationBeginCB.bind(P)),this._subscribeModelEvent(this.rotationArcXZ,"RotationManipulation",P.RotationManipulationCB.bind(P)),this._subscribeModelEvent(this.rotationArcXZ,"RotationEnd",P.RotationEndCB.bind(P)),this._subscribeModelEvent(this.rotationArcYZ,"RotationBegin",P.RotationBeginCB.bind(P)),this._subscribeModelEvent(this.rotationArcYZ,"RotationManipulation",P.RotationManipulationCB.bind(P)),this._subscribeModelEvent(this.rotationArcYZ,"RotationEnd",P.RotationEndCB.bind(P)),this._subscribeModelEvent(this.scalingNodeX,"ScalingBegin",P.ScalingBeginCB.bind(P)),this._subscribeModelEvent(this.scalingNodeX,"ScalingManipulation",P.ScalingManipulationCB.bind(P)),this._subscribeModelEvent(this.scalingNodeX,"ScalingEnd",P.ScalingEndCB.bind(P)),this._subscribeModelEvent(this.scalingNodeY,"ScalingBegin",P.ScalingBeginCB.bind(P)),this._subscribeModelEvent(this.scalingNodeY,"ScalingManipulation",P.ScalingManipulationCB.bind(P)),this._subscribeModelEvent(this.scalingNodeY,"ScalingEnd",P.ScalingEndCB.bind(P)),this._subscribeModelEvent(this.scalingNodeZ,"ScalingBegin",P.ScalingBeginCB.bind(P)),this._subscribeModelEvent(this.scalingNodeZ,"ScalingManipulation",P.ScalingManipulationCB.bind(P)),this._subscribeModelEvent(this.scalingNodeZ,"ScalingEnd",P.ScalingEndCB.bind(P)),this._subscribeModelEvent(this.robotHandle,"ScreenPlaneTranslationBegin",P.ScreenPlaneTranslationBeginCB.bind(P)),this._subscribeModelEvent(this.robotHandle,"ScreenPlaneTranslationManipulation",P.ScreenPlaneTranslationManipulationCB.bind(P)),this._subscribeModelEvent(this.robotHandle,"ScreenPlaneTranslationEnd",P.ScreenPlaneTranslationEndCB.bind(P)),this._labelColor=null,this._updateLabelColor(n);var N=n.onBackgroundModify(function(){P._updateLabelColor(n),P.setLabels(P._labels)});this._subscribedEvents.push({object:n,token:N}),this.snapFilterCallback=null,this.snapTranslationCallback=null,this.snapRotationCallback=null,this.target=null,this.initialMatrix=null,this.initialTargetWorldMatrix=null,this.robotRotationMatrix=null,this._setWorldOrientation(n.getWorldOrientation())},setRatio:function(t){t=t||{ratio:7},this.fixedSizeNode3D.setRatio(t.ratio)},setParameters:function(t,e){this.snapOnFace=t,this.showOnlyManipulated=e},setLabels:function(t){t=t||{},this._labels=t,this.arrowX.setLabel(t.labelX,this._labelColor),this.arrowY.setLabel(t.labelY,this._labelColor),this.arrowZ.setLabel(t.labelZ,this._labelColor)},setMoveMode:function(t,e){"OCCURRENCE"!==t?(this.mode=t,this.sceneGraphState=e?e.sceneGraphState:null):m||(console.warn("OCCURRENCE move mode is no more supported"),m=!0)},setDisplayScalingNodes:function(t){this.scalingNodeX.setVisibility(!!t),this.scalingNodeY.setVisibility(!!t),this.scalingNodeZ.setVisibility(!!t);var e=t?11.5:9;this.arrowX._updateLabelPosition(e),this.arrowY._updateLabelPosition(e),this.arrowZ._updateLabelPosition(e)},getNodeType:function(){return"FreeRobot"},LineTranslationBeginCB:function(t){this.target&&(this.setManipulated(!0),this.initialMatrix=(new i.Matrix4).copy(this.getMatrix()),this.initialTargetWorldMatrix=(new i.Matrix4).copy(this.target.getWorldMatrix(t.viewer)),this.showOnlyManipulated&&this.setToGhostState(),t.viewer.render()),this._modelEvent.publish({event:"LineTranslationBegin",data:{eventChannel:"LineTranslationBegin",target:this.target,intersection:t.intersection,manipulator:t.manipulator,event:t.event}})},LineTranslationManipulationCB:function(t){var e=t.translationVector;if(this.target){var n=t.paths[0].externalPath;if(this.contains(this,n)){if(this.snapTranslationCallback&&!(e=this.snapTranslationCallback({translationVector:e,target:this.target,intersection:t.intersection})))return;var a=new i.Vector3;a.getPositionFromMatrix(this.initialMatrix),a.add(e);var o=(new i.Matrix4).copy(this.getMatrix());this.setMatrix(o.setPosition(a)),this.updateCenterPosition(a);var s=new i.Vector3;s.getPositionFromMatrix(this.initialTargetWorldMatrix),s.add(e);var r=(new i.Matrix4).copy(this.initialTargetWorldMatrix).setPosition(s);if(this.sceneGraphState&&"OCCURRENCE_secret"===this.mode)this.sceneGraphState.applyAbsolutePositionToPath(this.target,r);else if("NODE"===this.mode){var l,h=this.target.externalPath,d=this.target.getParentPath();l=d?d.getWorldMatrix(t.viewer):new i.Matrix4;var c=new i.Matrix4;c.getInverse(l);var u=c.multiply(r);h[h.length-1].setMatrix(u)}t.viewer.render()}}this._modelEvent.publish({event:"LineTranslationManipulation",data:{eventChannel:"LineTranslationManipulation",target:this.target,translationVector:e,intersection:t.intersection,manipulator:t.manipulator,event:t.event}})},LineTranslationEndCB:function(t){this.target&&(this.setManipulated(!1),this.showOnlyManipulated&&this.setToNonGhostState(),t.viewer.render()),this._modelEvent.publish({event:"LineTranslationEnd",data:{eventChannel:"LineTranslationEnd",target:this.target,intersection:t.intersection,manipulator:t.manipulator,event:t.event}})},PlaneTranslationBeginCB:function(t){this.target&&(this.setManipulated(!0),this.initialMatrix=(new i.Matrix4).copy(this.getMatrix()),this.initialTargetWorldMatrix=(new i.Matrix4).copy(this.target.getWorldMatrix(t.viewer)),this.showOnlyManipulated&&this.setToGhostState(),t.viewer.render()),this._modelEvent.publish({event:"PlaneTranslationBegin",data:{eventChannel:"PlaneTranslationBegin",target:this.target,intersection:t.intersection,manipulator:t.manipulator,event:t.event}})},PlaneTranslationManipulationCB:function(t){if(this.target){var e=t.paths[0].externalPath;if(this.contains(this,e)){var n=new i.Vector3;n.getPositionFromMatrix(this.initialMatrix),n.add(t.translationVector);var a=(new i.Matrix4).copy(this.getMatrix());this.setMatrix(a.setPosition(n)),this.updateCenterPosition(n)}var o=new i.Vector3;o.getPositionFromMatrix(this.initialTargetWorldMatrix),o.add(t.translationVector);var s=(new i.Matrix4).copy(this.initialTargetWorldMatrix).setPosition(o);if(this.sceneGraphState&&"OCCURRENCE_secret"===this.mode)this.sceneGraphState.applyAbsolutePositionToPath(this.target,s);else if("NODE"===this.mode){var r,l=this.target.externalPath,h=this.target.getParentPath();r=h?h.getWorldMatrix(t.viewer):new i.Matrix4;var d=new i.Matrix4;d.getInverse(r);var c=d.multiply(s);l[l.length-1].setMatrix(c)}t.viewer.render()}this._modelEvent.publish({event:"PlaneTranslationManipulation",data:{eventChannel:"PlaneTranslationManipulation",target:this.target,translationVector:t.translationVector,intersection:t.intersection,manipulator:t.manipulator,event:t.event}})},PlaneTranslationEndCB:function(t){this.target&&(this.setManipulated(!1),this.showOnlyManipulated&&this.setToNonGhostState(),t.viewer.render()),this._modelEvent.publish({event:"PlaneTranslationEnd",data:{eventChannel:"PlaneTranslationEnd",target:this.target,intersection:t.intersection,manipulator:t.manipulator,event:t.event}})},RotationBeginCB:function(t){this.target&&(this.setManipulated(!0),this.initialMatrix=(new i.Matrix4).copy(this.getMatrix()),this.initialTargetWorldMatrix=new i.Matrix4,this.target.getWorldMatrix(t.viewer,this.initialTargetWorldMatrix),this.showOnlyManipulated&&this.setToGhostState(),t.viewer.render()),this._modelEvent.publish({event:"RotationBegin",data:{eventChannel:"RotationBegin",target:this.target,intersection:t.intersection,manipulator:t.manipulator,event:t.event}})},RotationManipulationCB:function(t){var e=t.angle,n=t.axis;if(this.target){var a=t.paths[0].externalPath,o=t.rotationMatrix;if(this.snapRotationCallback){var s=this.snapRotationCallback({axis:t.axis,angle:t.angle,target:this.target,intersection:t.intersection});if(e=s.value,n=s.axis,void 0===e||!n)return;e=Math.PI*e/180,o=(new i.Matrix4).makeRotationAxis(n,e)}if(this.contains(this,a)){var r=(new i.Matrix4).copy(o);r.multiply((new i.Matrix4).extractRotation(this.initialMatrix));var l=r.setPosition((new i.Vector3).getPositionFromMatrix(this.initialMatrix));this.setMatrix(l)}var h=(new i.Matrix4).copy(this.initialTargetWorldMatrix),d=(o=(new i.Matrix4).makeRotationAxis(n,e),(new i.Matrix4).setPosition((new i.Vector3).getPositionFromMatrix(this.initialMatrix))),c=(new i.Matrix4).getInverse(d).multiply(h),u=(new i.Matrix4).copy(o).multiply(c),p=(new i.Matrix4).copy(d).multiply(u);if(this.sceneGraphState&&"OCCURRENCE_secret"===this.mode)this.sceneGraphState.applyAbsolutePositionToPath(this.target,p);else if("NODE"===this.mode){var v=this.target.externalPath,M=new i.Matrix4,b=this.target.getParentPath();b&&b.getWorldMatrix(t.viewer,M);var m=new i.Matrix4;m.getInverse(M);var P=m.multiply(p);v[v.length-1].setMatrix(P)}t.viewer.render()}this._modelEvent.publish({event:"RotationManipulation",data:{eventChannel:"RotationManipulation",target:this.target,rotationMatrix:t.rotationMatrix,rotationCenter:t.center,angle:e,axis:n,intersection:t.intersection,manipulator:t.manipulator,event:t.event}})},RotationEndCB:function(t){if(this.target){this.setManipulated(!1),this.robotRotationMatrix=(new i.Matrix4).extractRotation(this.getMatrix());var e=new i.Vector3(this.robotRotationMatrix.elements[0],this.robotRotationMatrix.elements[1],this.robotRotationMatrix.elements[2]).normalize(),n=new i.Vector3(this.robotRotationMatrix.elements[4],this.robotRotationMatrix.elements[5],this.robotRotationMatrix.elements[6]).normalize(),a=new i.Vector3(this.robotRotationMatrix.elements[8],this.robotRotationMatrix.elements[9],this.robotRotationMatrix.elements[10]).normalize();this.updateAxis(e,n,a),this.showOnlyManipulated&&this.setToNonGhostState(),t.viewer.render()}this._modelEvent.publish({event:"RotationEnd",data:{eventChannel:"RotationEnd",target:this.target,intersection:t.intersection,manipulator:t.manipulator,event:t.event}})},ScalingBeginCB:function(t){this.target&&(this.setManipulated(!0),this.initialMatrix=(new i.Matrix4).copy(this.target.getWorldMatrix(t.viewer)),this.showOnlyManipulated&&this.setToGhostState(),t.viewer.render()),this._modelEvent.publish({event:"ScalingBegin",data:{eventChannel:"ScalingBegin",target:this.target,intersection:t.intersection,manipulator:t.manipulator,event:t.event}})},ScalingManipulationCB:function(t){if(this.target){var e=t.paths[0].externalPath;if(this.contains(this,e)){var n=new i.Matrix4;if(n.copy(t.scalingMatrix),n.multiply((new i.Matrix4).copy(this.initialMatrix)),this.sceneGraphState&&"OCCURRENCE_secret"===this.mode)this.sceneGraphState.applyAbsolutePositionToPath(this.target,n);else if("NODE"===this.mode){var a,o=this.target.externalPath,s=this.target.getParentPath();a=s?s.getWorldMatrix(t.viewer):new i.Matrix4;var r=new i.Matrix4;r.getInverse(a);var l=r.multiply(n);o[o.length-1].setMatrix(l)}t.viewer.render()}}this._modelEvent.publish({event:"ScalingManipulation",data:{eventChannel:"ScalingManipulation",target:this.target,scalingFactor:t.scalingFactor,scalingCenter:t.center,intersection:t.intersection,manipulator:t.manipulator,event:t.event}})},ScalingEndCB:function(t){this.target&&(this.setManipulated(!1),this.showOnlyManipulated&&this.setToNonGhostState(),t.viewer.render()),this._modelEvent.publish({event:"ScalingEnd",data:{eventChannel:"ScalingEnd",target:this.target,scalingFactor:t.scalingFactor,scalingCenter:t.center,intersection:t.intersection,manipulator:t.manipulator,event:t.event}})},ScreenPlaneTranslationBeginCB:function(t){this._modelEvent.publish({event:"ScreenPlaneTranslationBegin",data:{eventChannel:"ScreenPlaneTranslationBegin",position:t.position,intersection:t.intersection,manipulator:t.manipulator,event:t.event}})},ScreenPlaneTranslationManipulationCB:function(t){this._modelEvent.publish({event:"ScreenPlaneTranslationManipulation",data:{eventChannel:"ScreenPlaneTranslationManipulation",intersection:t.intersection,manipulator:t.manipulator,event:t.event}})},ScreenPlaneTranslationEndCB:function(t){this._modelEvent.publish({event:"ScreenPlaneTranslationEnd",data:{eventChannel:"ScreenPlaneTranslationEnd",target:this.target,intersection:t.intersection,manipulator:t.manipulator,event:t.event}})},setRobotMatrix:function(t){this.setMatrix(t),this.updateCenterPosition((new i.Vector3).getPositionFromMatrix(t));var e=new i.Vector3,n=new i.Vector3,a=new i.Vector3;t.extractBasis(e,n,a),this.updateAxis(e,n,a)},updateCenterPosition:function(t){this.rotationArcXY.setCenter(t),this.rotationArcXZ.setCenter(t),this.rotationArcYZ.setCenter(t),this.scalingNodeZ.setCenter(t),this.scalingNodeX.setCenter(t),this.scalingNodeY.setCenter(t)},updateAxis:function(t,e,i){this.arrowX.setAxis(t),this.arrowY.setAxis(e),this.arrowZ.setAxis(i),this.translationPlaneYZ.setAxis(t),this.translationPlaneXY.setAxis(i),this.translationPlaneXZ.setAxis(e),this.scalingNodeY.setAxis(e),this.scalingNodeX.setAxis(t),this.scalingNodeZ.setAxis(i),this.rotationArcYZ.setAxis(t),this.rotationArcXZ.setAxis(e),this.rotationArcXY.setAxis(i)},setManipulated:function(t){this.isManipulated=t,this.arrowX.setParentManipulated(t),this.arrowY.setParentManipulated(t),this.arrowZ.setParentManipulated(t),this.translationPlaneYZ.setParentManipulated(t),this.translationPlaneXY.setParentManipulated(t),this.translationPlaneXZ.setParentManipulated(t),this.scalingNodeY.setParentManipulated(t),this.scalingNodeX.setParentManipulated(t),this.scalingNodeZ.setParentManipulated(t),this.rotationArcYZ.setParentManipulated(t),this.rotationArcXZ.setParentManipulated(t),this.rotationArcXY.setParentManipulated(t),this.robotHandle.setParentManipulated(t)},setToGhostState:function(){this.arrowX.setToGhostState(),this.arrowY.setToGhostState(),this.arrowZ.setToGhostState(),this.translationPlaneYZ.setToGhostState(),this.translationPlaneXY.setToGhostState(),this.translationPlaneXZ.setToGhostState(),this.scalingNodeY.setToGhostState(),this.scalingNodeX.setToGhostState(),this.scalingNodeZ.setToGhostState(),this.robotHandle.setToGhostState(),this.rotationArcYZ.setToGhostState(),this.rotationArcXZ.setToGhostState(),this.rotationArcXY.setToGhostState()},setToNonGhostState:function(){this.arrowX.setToNonGhostState(),this.arrowY.setToNonGhostState(),this.arrowZ.setToNonGhostState(),this.translationPlaneYZ.setToNonGhostState(),this.translationPlaneXY.setToNonGhostState(),this.translationPlaneXZ.setToNonGhostState(),this.scalingNodeY.setToNonGhostState(),this.scalingNodeX.setToNonGhostState(),this.scalingNodeZ.setToNonGhostState(),this.robotHandle.setToNonGhostState(),this.rotationArcYZ.setToNonGhostState(),this.rotationArcXZ.setToNonGhostState(),this.rotationArcXY.setToNonGhostState()},subscribe:function(t,e){return this._modelEvent.subscribe({event:t},e)},unsubscribe:function(t){this._modelEvent.unsubscribe(t)},setTarget:function(t,e,n){this.target=t;var a=e?e.clone():null;if(!a){a=this.target.getWorldMatrix(n);var o=this.target.getBoundingSphere();a.setPosition(o.center)}this.setMatrix(a);var s=new i.Vector3;s.getPositionFromMatrix(a),this.updateCenterPosition(s);var r=new i.Vector3,l=new i.Vector3,h=new i.Vector3;this.getMatrix().extractBasis(r,l,h),this.updateAxis(r,l,h)},contains:function(t,e){for(var i=0;i<e.length;i++)if(e[i]===t)return!0;return!1},_setWorldOrientation:function(t){this.translationPlaneXY._setWorldOrientation(t),this.translationPlaneXZ._setWorldOrientation(t),this.translationPlaneYZ._setWorldOrientation(t),this.rotationArcXY._setWorldOrientation(t),this.rotationArcXZ._setWorldOrientation(t),this.rotationArcYZ._setWorldOrientation(t)},_dispose:function(){var t,e;for(this.traverse(t=>{var e=t.mesh3js&&t.mesh3js.material;e&&e.map&&(e.map.dispose(),e.map=null)}),t=0;t<this._subscribedEvents.length;t++)(e=this._subscribedEvents[t]).object.unsubscribe(e.token);this._subscribedEvents=[],this._modelEvent.destroy()},_subscribeModelEvent:function(t,e,i){this._subscribe(t._modelEvent,e,i)},_subscribe:function(t,e,i){var n=t.subscribe({event:e},i);this._subscribedEvents.push({object:t,token:n})},_updateLabelColor:function(t){var e=new i.Color(t.backgroundColor),n=Math.round((255*e.r*299+255*e.g*587+255*e.b*114)/1e3);this._labelColor=n>125?"grey":"white"}});return UWA.namespace("THREEDS/Nodes/FreeRobot",P)}),define("Robot/FreeRobot",["DS/Robot/FreeRobot","DS/DSMigration/DSMigration"],function(t,e){return e.deprecateModule("Robot/FreeRobot"),t}),define("DS/Robot/Robot",["DS/Robot/FreeRobot","DS/Mesh/MeshUtils","DS/Visualization/ThreeJS_DS","DS/CoreEvents/Events","DS/CoreEvents/ModelEvents","DS/Selection/HSOManager","DS/Selection/CSOManager","DS/Robot/ReferenceAxisSystemNode"],function(t,e,i,n,a,o,s,r){"use strict";var l={x:new i.Vector3,y:new i.Vector3,z:new i.Vector3},h=t.extend({init:function(t,e,i,n,a,o,s){"I solemnly swear that I am up to no good."!==o&&console.warn("DEPRECATED API USE: create Robot using 'webGLV6Viewer.setRobot(true, {snapOnFace: true});\nStack: "+(new Error).stack),this._parent(e,i,n,a,s),this.viewer=i,this.sceneGraph=t,this._addToCSO=!0,this._addToHSO=!0,this.hiddenMode=!1,this.moveViewpointOnClickDuration=1e3,this._enabled=!0,this._showLabels=!0,this._viewPlane=null,this._viewPlaneOrientation=0,this.ratio=null,this.isConnected=!1,this.isManipulatedInPlane=!1,this._getPositionCB=null,this.checkTarget=!1;var r=this;this.setVisibilityFree(!0),i._addRobot(this,this.sceneGraph),this._subscribe(this.translationPlaneXY._modelEvent,"PrimaryPointerClick",function(t){r.moveViewToPlane("XY")}),this._subscribe(this.translationPlaneXZ._modelEvent,"PrimaryPointerClick",function(t){r.moveViewToPlane("XZ")}),this._subscribe(this.translationPlaneYZ._modelEvent,"PrimaryPointerClick",function(t){r.moveViewToPlane("YZ")}),this._subscribe(this.rotationArcXY._modelEvent,"PrimaryPointerClick",function(t){r.moveViewToPlane("XY")}),this._subscribe(this.rotationArcXZ._modelEvent,"PrimaryPointerClick",function(t){r.moveViewToPlane("XZ")}),this._subscribe(this.rotationArcYZ._modelEvent,"PrimaryPointerClick",function(t){r.moveViewToPlane("YZ")}),this._subscribe(this.arrowZ._modelEvent,"PrimaryPointerClick",function(t){r.moveViewToPlane("XY")}),this._subscribe(this.arrowY._modelEvent,"PrimaryPointerClick",function(t){r.moveViewToPlane("XZ")}),this._subscribe(this.arrowX._modelEvent,"PrimaryPointerClick",function(t){r.moveViewToPlane("YZ")}),this._subscribe(this.scalingNodeZ._modelEvent,"PrimaryPointerClick",function(t){r.moveViewToPlane("XY")}),this._subscribe(this.scalingNodeY._modelEvent,"PrimaryPointerClick",function(t){r.moveViewToPlane("XZ")}),this._subscribe(this.scalingNodeX._modelEvent,"PrimaryPointerClick",function(t){r.moveViewToPlane("YZ")}),this.robotHandle.setCameraName("robotCameraOrtho"),this.snapFilterCallback=null,this.snapTranslationCallback=null,this.snapRotationCallback=null,this.manipulationX=0,this.manipulationY=0,this._setOrthoState(!0),this.setRatio(null)},setRatio:function(t){this.ratio=t||{docked:7,moving:10,connected:10},this._updateRatio()},setAddToCSO:function(t){this._addToCSO=t},setAddToHSO:function(t){this._addToHSO=t},getNodeType:function(){return"Robot"},ScreenPlaneTranslationBeginCB:function(t){this.isManipulatedInPlane=!0,this.setManipulated(!0),this.initialMatrix=(new i.Matrix4).copy(this.getMatrix()),this._updateRatio(),this.setPickable(e.PICKTHROUGH),this.viewer.renderer.pickingGPUComposerContext.needsUpdate=!0,this.viewer.renderer.depthComposerContext.needsUpdate=!0,this.viewer.renderer.normalComposerContext.needsUpdate=!0;var n=new i.Vector3(1,0,0),a=new i.Vector3(0,1,0),o=new i.Vector3(0,0,1);this.updateAxis(n,a,o),this.showOnlyManipulated&&this.setToDragState(),this._parent(t);var s=this.getMousePosition(t.event);this.manipulationX=s.x,this.manipulationY=s.y,this._setOrthoState(!0),this.onViewpointChange(),this._updateLabelsAndReferenceAxisSystem()},ScreenPlaneTranslationManipulationCB:function(t){this._setOrthoState(!0);var e=t.paths[0].externalPath;if(this.contains(this,e)){var i=this.getMousePosition(t.event);this.manipulationX=i.x,this.manipulationY=i.y,this.onViewpointChange(),this.viewer.render(),this._parent(t)}this._updateLabelsAndReferenceAxisSystem()},getMousePosition:function(t){return(t.from[1]||t.from[0]).getCurrentPosition(this.viewer.canvas)},ScreenPlaneTranslationEndCB:function(t){this.isManipulatedInPlane=!1,this.setManipulated(!1);var n=t.intersection,a=n.position&&n.path.length,r=a?n.path[0]:null;if(a&&this.snapFilterCallback&&null==(r=this.snapFilterCallback(r))&&(a=!1),a){this._setOrthoState(!1),this.isConnected=!0,this.target=r,this._addToHSO&&(o.empty(),o.add({pathElement:this.target})),this._addToCSO&&(s.empty(),s.add({pathElement:this.target}));var l=new i.Matrix4;if(this.snapOnFace)l=this.viewer.getWorldOrientation().buildSnapRobotMatrix(n),this.setRobotMatrix(l);else this.updateCenterPosition(n.position),l.setPosition(n.position),this.setMatrix(l)}else this._setOrthoState(!0),this.target=null,this.isConnected=!1,this.viewer.render();this.setPickable(e.PICKABLE),this.showOnlyManipulated&&this.setToNonGhostState(),this.viewer.render(),this._parent(t),this._updateRatio(),this.onViewpointChange(),this._updateLabelsAndReferenceAxisSystem()},onViewpointChange:function(){var t=this.viewer.currentViewpoint;if(t){var e,n;e=this.viewer.devicePixelRatio;var a,o=(n=this._getPositionCB?this._getPositionCB(this.viewer.canvas.width,this.viewer.canvas.height,e):this._getPosition_default(this.viewer.canvas.width,this.viewer.canvas.height,e)).y,s=n.x;this.isManipulatedInPlane?(a=r(2*e*this.manipulationX/this.viewer.canvas.width-1,2*(1-e*this.manipulationY/this.viewer.canvas.height)-1),this.setMatrix(a)):this.isConnected||this.isManipulated||(a=r(s,o),this.setMatrix(a)),this._updateLabelsAndReferenceAxisSystem()}function r(e,n){var a,o=t.robotCameraOrtho,s=new i.Vector3(e,n,0);if((new i.Projector).unprojectVector(s,o),o instanceof i.PerspectiveCamera){var r=new i.Ray(data.cameraEye,s.sub(data.cameraEye).normalize()),l=new i.Plane(t.camera.getLookAt(),0);a=r.intersectPlane(l)}else a=s;return(new i.Matrix4).setPosition(a)}},setConnectionState:function(t){return this.isManipulated?(this._updateLabelsAndReferenceAxisSystem(),this._updateRatio(),!1):(t?this.connect():this.disconnect(),this._updateLabelsAndReferenceAxisSystem(),!0)},setCheckTarget:function(t){this.checkTarget=t},isTargetGone:function(t){if(!this.checkTarget)return!1;if(null===this.target||void 0===this.target)return!0;for(var e=!1,i=!0,n=this.target.externalPath,a=0;a<n.length;a++){var o=n[a];e=o._getVisibilityFree(),i=o._getVisible()}return e?!i:!!t!==i},setSnapFilterCallback:function(t){this.snapFilterCallback=t},setSnapTranslationCallback:function(t){this.snapTranslationCallback=t},setSnapRotationCallback:function(t){this.snapRotationCallback=t},moveViewToPlane:function(t){if(!this.isConnected&&this.moveViewpointOnClickDuration>=0){this.viewer.currentViewpoint.control;var e=new i.Matrix4;this._viewPlane===t?this._viewPlaneOrientation*=-1:this._viewPlaneOrientation=1,this._viewPlane=t;var n=this._viewPlaneOrientation>0?0:Math.PI;"XY"===t?(e.rotateX(0+n),e.rotateZ(Math.PI/2)):"XZ"===t?(e.rotateX(Math.PI/2),e.rotateY(Math.PI+n)):"YZ"===t&&(e.rotateY(Math.PI/2+n),e.rotateZ(Math.PI/2+n));var a=e.decompose(),o=new i.Vector3(0,1,0);o.applyQuaternion(a[1]),o.normalize();var s=new i.Vector3(0,0,-1);s.applyQuaternion(a[1]),s.normalize(),this.viewer.currentViewpoint.moveTo({upDirection:o,sightDirection:s,duration:this.moveViewpointOnClickDuration})}},connect:function(){this._setOrthoState(!1),this.isConnected=!0,this._updateRatio(),this._updateLabelsAndReferenceAxisSystem()},disconnect:function(){this._setOrthoState(!0),this.isConnected=!1,this._updateRatio(),this.onViewpointChange(),this.viewer.render(),this.target=null,this._updateLabelsAndReferenceAxisSystem()},setToDragState:function(){this.arrowX.setToDragState(),this.arrowY.setToDragState(),this.translationPlaneYZ.setToGhostState(),this.translationPlaneXZ.setToGhostState(),this.translationPlaneXY.setToDragState(),this.scalingNodeY.setToGhostState(),this.scalingNodeX.setToGhostState(),this.scalingNodeZ.setToGhostState(),this.rotationArcYZ.setToGhostState(),this.rotationArcXZ.setToGhostState(),this.rotationArcXY.setToGhostState()},setVisibility:function(t){this.setHiddenMode(!t),this._parent(t)},setHiddenMode:function(t){this.hiddenMode=t,this._updateLabelsAndReferenceAxisSystem()},_setOrthoState:function(t){t?(this.setRenderPasses(["robotOrtho"]),this._setCameraName("robotCameraOrtho")):(this.setRenderPasses(["robot"]),this._setCameraName("connectedRobotCamera"))},setDrivenConnectionMode:function(){this.setDrivenMode.apply(this,arguments)},setDrivenMode:function(){this.setConnectionState.apply(this,arguments)},_setCameraName:function(t){this.fixedSizeNode3D.setCameraName(t)},_updateLabelsAndReferenceAxisSystem:function(){var t=this;function e(e){var i=e&&t._enabled;t.fixedSizeNode3D._getVisible()!==i&&t.fixedSizeNode3D.setVisibility(i)}function i(e){e&&t._enabled;t.viewer._modelEvent.publish({event:"UpdateReferenceAxisSystemVisibility",data:{visible:e}})}this.hiddenMode?(e(!1),i(!0)):this.isManipulated?(e(!0),i(!0),this.setLabels(null)):this.isConnected?(this._showLabels?this._setLocalLabels():this.setLabels(null),e(!0),i(!0)):(this._showLabels?this.setLabels({labelX:"x",labelY:"y",labelZ:"z"}):this.setLabels(null),e(!0),i(!1))},_setLocalLabels:function(){function t(t,e){t.normalize();var i=null;return t.x>.9995?i="x":t.y>.9995?i="y":t.z>.9995&&(i="z"),i?e+"|"+i:e}this.getMatrix().extractBasis(l.x,l.y,l.z),this.setLabels({labelX:t(l.x,"u"),labelY:t(l.y,"v"),labelZ:t(l.z,"w")})},setMatrix:function(){this._parent.apply(this,arguments),this._updateLabelsAndReferenceAxisSystem()},setManipulated:function(t){var e=t!==this.isManipulated;this._parent.apply(this,arguments),e&&this._updateLabelsAndReferenceAxisSystem()},showLabels:function(t){this._showLabels=t,this._updateLabelsAndReferenceAxisSystem()},setMoveViewpointOnClickDuration:function(t){this.moveViewpointOnClickDuration=t},setGetPositionCB:function(t){this._getPositionCB=t,this.onViewpointChange()},_setEnabled:function(t){var e=!!t;this._enabled!==e&&(this._enabled=e,this.onViewpointChange())},_isEnabled:function(){return this._enabled},_updateRatio:function(){this.isManipulatedInPlane?this.fixedSizeNode3D.setRatio(this.ratio.moving||this.ratio.ratio):this.isConnected?this.fixedSizeNode3D.setRatio(this.ratio.connected||this.ratio.ratio):this.fixedSizeNode3D.setRatio(this.ratio.docked||this.ratio.ratio)},_dispose:function(){this._getPositionCB=null,this._parent()},_getPosition_default:function(t,e,i){var n;return{x:2*(t-100*i*(n=this.fixedSizeNode3D.ratio/7))/t-1,y:Math.max(200*i*n/e-1,-.85)}},CallBackEventHandlerViewPoint:function(){this.onViewpointChange.apply(this,arguments)}});return UWA.namespace("THREEDS/Nodes/Robot",h)}),define("Robot/Robot",["DS/Robot/Robot","DS/DSMigration/DSMigration"],function(t,e){return e.deprecateModule("Robot/Robot"),t});