define("DS/CSIViewModelWebProcessor/CSIVMClientAttributesHelper",["DS/CSIViewModelWebInterfaces/CSIVMClientOperation","DS/CSIViewModelWebInterfaces/CSIVMClientParameterLabels","CSIMathematics/CSIMathematicsDeclareTypes","DS/CSIViewModelWebInterfaces/CSIVMClientVisFilter","DS/CSIViewModelWebInterfaces/CSIVMClientISODataParameter","DS/CSIViewModelWebInterfaces/CSIVMClientPLMDataParameter","DS/CSIViewModelWebInterfaces/CSIVMClient2DTo3DDataParameter","DS/CSIViewModelWebInterfaces/CSIVMClientBillboardDataParameter","DS/CSIViewModelWebInterfaces/CSIVMClientFixedSizeDataParameter","DS/CSIViewModelWebInterfaces/CSIVMClientSemanticAttributeDataParameter"],function(e,t,r,i,a,n,o,s,d,l){"use strict";let c={createAttributes:function(r){if(!r)return;let i=r.readObject(t.valueMatrix,"CATMathTransformation"),a=r.readObjectArray(t.valueFilters,"CSIViewModelVisFilter"),n=r.readObject(t.valueISO,"CSIViewModelISOData"),o=r.readObject(t.valuePLM,"CSIViewModelPLMData"),s=r.readObject(t.value2DTo3D,"CSIViewModel2DTo3DData"),d=r.readObject(t.valueBillboard,"CSIViewModelBillboardData"),l=r.readObject(t.valueFixedSize,"CSIViewModelFixedSizeData"),c=r.readObject(t.valueSemantic,"CSIViewModelSemanticData");return new e.prototype.Attributes(i,a,n,o,s,d,l,c)},declareTypes:function(e){r.declareTypes(e,"CATMathTransformation"),i.prototype.declareType(),a.prototype.declareType(),n.prototype.declareType(),o.prototype.declareType(),s.prototype.declareType(),d.prototype.declareType(),l.prototype.declareType()}};return c}),define("DS/CSIViewModelWebProcessor/CSIVMClientVisuContextParameter",["DS/CSICommandBinder/CSICommandBinder","DS/CSIViewModelWebInterfaces/CSIVMClientOperation","DS/CSIViewModelWebInterfaces/CSIVMClientParameterLabels","DS/CSIViewModelWebInterfaces/CSIVMClientTreeKey","DS/CSIViewModelWebInterfaces/CSIVMClientSupportParameters","DS/CSIViewModelWebInterfaces/CSIVMClientViewMode","DS/CSIViewModelWebInterfaces/CSIVMClientAmbiance","DS/CSIViewModelWebInterfaces/CSIVMClientViewpoints","DS/CSIViewModelWebInterfaces/CSIVMClientPLMViewMode","DS/CSIViewModelWebInterfaces/CSIVMClientVisContextData"],function(e,t,r,i,a,n,o,s,d,l){"use strict";const c={getUUID:()=>null,getViewType:()=>i.prototype.ViewType.View3D,getView3DType:()=>i.prototype.View3DType.View3D_Main};class p{constructor(e){e||(e={}),this._ambiance=e.Ambiance,this._viewpoints=e.Viewpoints,this._viewMode=e.ViewMode,this._supportParameters=e.SupportParameters,this._plmViewMode=e.PLMViewMode,this._visContextData=e.VisContextData}getAmbiance(){return this._ambiance}getViewpoints(){return this._viewpoints}getViewMode(){return this._viewMode}getSupportParameters(){return this._supportParameters}getPLMViewMode(){return this._plmViewMode}getVisContextData(){return this._visContextData}process(e){const r=e.getProcessor(),i=r.createTransaction(c),a=r.createOperation({_type:t.prototype.OperationType.VisuContextUpdate,_VisuContext:this});return i.doOperation(a),i.executeEnd(),i}static serialize(){return!1}static unserialize(e){if(null==e)return null;const t={Ambiance:e.readObject(r.Ambiance,"CSIAmbiance"),Viewpoints:e.readObject(r.Viewpoints,"CSIViewpoints"),SupportParameters:e.readObject(r.SupportParameters,"CSISupportParameters"),ViewMode:e.readObject(r.ViewMode,"CSIViewMode"),PLMViewMode:e.readObject(r.PLMViewMode,"CSIPLMViewMode")};if(null!=e.exists(r.VisContextData)){const i=e.readParameters(r.VisContextData,"Parameters");t.VisContextData={};const a=i.begin(),n=i.end();for(;!a.equal(n);){const e=a.getName();t.VisContextData[e]=i.readObject(e,"CSIVisContextData"),a.next()}}return null==t.Ambiance&&null==t.Viewpoints&&null==t.ViewpointsInfo&&null==t.SupportParameters&&null==t.ViewMode&&null==t.PLMViewMode&&null==t.VisContextData?null:new p(t)}declareType(){e.declareType({type:"CSIVisuContextMessage",serialize:p.serialize,unserialize:p.unserialize}),a.prototype.declareType(),n.prototype.declareType(),o.prototype.declareType(),s.prototype.declareType(),d.prototype.declareType(),l.prototype.declareType()}}return p}),define("DS/CSIViewModelWebProcessor/CSIVMClientSceneEnvUpdateParameter",["DS/CSICommandBinder/CSICommandBinder","DS/CSIViewModelWebInterfaces/CSIVMClientOperation","DS/CSIViewModelWebInterfaces/CSIVMClientParameterLabels","DS/CSIViewModelWebInterfaces/CSIVMClientTreeKey"],function(e,t,r,i){"use strict";class a{constructor(e,t){this._manageAmbiances=e,this._manageCameras=t,this._sceneEnvKey={getUUID:()=>null,getViewType:()=>i.prototype.ViewType.View3D,getView3DType:()=>i.prototype.View3DType.View3D_Main}}AreAmbiancesManaged(){return this._manageAmbiances}AreLightsManaged(){return!1}AreCamerasManaged(){return this._manageCameras}process(e){const r=e.getProcessor(),i=r.createTransaction(this._sceneEnvKey),a=e.getSceneEnvData();a.setSceneEnvManaged(this.AreAmbiancesManaged(),this.AreCamerasManaged());const n=r.createOperation({_type:t.prototype.OperationType.ModifySceneEnv,_SceneEnvData:a});return i.doOperation(n),i.executeEnd(),i}serialize(){return!1}unserialize(e){const t=e.readBool(r.ManageAmbiances),i=e.readBool(r.ManageCameras);return new a(t,i)}declareType(){e.declareType({type:"CSIViewSceneEnvUpdateParam",serialize:this.serialize,unserialize:this.unserialize})}}return a}),define("DS/CSIViewModelWebProcessor/CSIVMClientTargetsInContext",["DS/CSICommandBinder/CSICommandBinder","DS/CSIViewModelWebInterfaces/CSIVMClientParameterLabels","DS/CSIViewModelWebInterfaces/CSIVMClientDrawGroupParameter"],function(e,t,r){"use strict";function i(e,t,r,i,a){this._context=e,this._batchParent=i,this._noContext=a,this._targetsIds=t||[],this._targetsGeomTypes=r||[]}let a=r.prototype.geomTypeValues,n=function(){return!1},o=function(e){return new i(e.readObject(t.targetsContext,"CSIViewTreeObjectParam"),e.readUint32Array(t.targets),function(e){let t=[];return 1&e&&t.push(a.face),2&e&&t.push(a.boundary_Edge),4&e&&t.push(a.sharp_Edge),8&e&&t.push(a.smooth_Edge),16&e&&t.push(a.boundary_Point),32&e&&t.push(a.sharp_Point),64&e&&t.push(a.smooth_Point),128&e&&t.push(a.surfacic_Point),256&e&&t.push(a.free_Point),512&e&&t.push(a.wire_Edge),1024&e&&t.push(a.infinite_Face),8192&e&&t.push(a.unknown),16384&e&&t.push(a.hidden_Seam_Edge),32768&e&&t.push(a.hidden_Seam_Point),65536&e&&t.push(a.unknown_0D),131072&e&&t.push(a.unknown_1D),262144&e&&t.push(a.unknown_2D),524288&e&&t.push(a.unknown_3D),t}(e.readUint32(t.targetTag)),e.readObject(t.batchParent,"CSIViewTreeObjectParam"),e.readBool(t.targetsNoContext))};return i.prototype.declareType=function(){e.declareType({type:"CSIViewModelTargetsInContext",serialize:n,unserialize:o})},i}),define("DS/CSIViewModelWebProcessor/CSIVMClientAppliedGPTokenId",["DS/CSICommandBinder/CSICommandBinder","DS/CSIViewModelWebInterfaces/CSIVMClientParameterLabels"],function(e,t){"use strict";function r(e,t,r){this._shortId=e,this._idPath=t,this._batchParent=r}let i=function(){return!1},a=function(e){return new r(e.readInt32(t.shortId),e.readString(t.idPath),e.readObject(t.batchParent,"CSIViewTreeObjectParam"))};return r.prototype.declareType=function(){e.declareType({type:"CSIViewModelGPTokenId",serialize:i,unserialize:a})},r}),define("DS/CSIViewModelWebProcessor/CSIVMClientSemanticDataHelper",["DS/CSIViewModelWebInterfaces/CSIVMClientOperation","DS/CSIViewModelWebInterfaces/CSIVMClientParameterLabels","DS/CSIViewModelWebInterfaces/CSIVMClientError","DS/CSIViewModelWebInterfaces/CSIVMClientEltState"],function(e,t,r,i){"use strict";let a={createSemanticData:function(r){if(!r)return;let i={};return i[t.valueAlias]=r.readString(t.valueAlias),i[t.valueTypeId]=r.readString(t.valueTypeId),i[t.valueSubTypeId]=r.readString(t.valueSubTypeId),i[t.valueIconName]=r.readString(t.valueIconName),i[t.valueIconModule]=r.readString(t.valueIconModule),i[t.valueEditCommandName]=r.readString(t.valueEditCommandName),i[t.valueErrors]=r.readObjectArray(t.valueErrors,"CSIViewModelError"),i[t.valueStates]=r.readObjectArray(t.valueStates,"CSIViewModelEltState"),new e.prototype.SemanticData(i)}};return a}),define("DS/CSIViewModelWebProcessor/CSIVMClientIdPatternParameter",["DS/CSICommandBinder/CSICommandBinder","DS/CSIViewModelWebInterfaces/CSIVMClientParameterLabels"],function(e,t){"use strict";function r(e){this._id=e.id||0,this._idSpace=e.idSpace||"",this._idContext=e.idContext||"",this._shared=!!e.shared}r.prototype.getId=function(){return this._id},r.prototype.getIdSpace=function(){return this._idSpace},r.prototype.getIdContext=function(){return this._idContext},r.prototype.getShared=function(){return this._shared},r.prototype.process=function(e){return e.getProcessor().getModel().getOrCreateIdPattern(this._idSpace,this._idContext,this._shared)};let i=function(){return!1},a=function(e){return new r({id:e.readInt32(t.id),idSpace:e.readString(t.idSpace),idContext:e.readString(t.idContext),shared:e.readBool(t.shared)})};return r.prototype.declareType=function(){e.declareType({type:"CSIViewModelIdPattern",serialize:i,unserialize:a})},r}),define("DS/CSIViewModelWebProcessor/CSIVMClientTransactionOnIdent",["DS/CSIViewModelWebImplement/CSIVMClientObject","DS/CSIViewModelWebInterfaces/CSIVMClientOperation","DS/CSIViewModelWebInterfaces/CSIViewModelWebEnv","DS/CSIViewModelWebInterfaces/CSIVMClientTreeKey"],function(e,t,r,i){"use strict";function a(){}return a.prototype.setData=function(e,t,r,i){this._nameSpace=e.getOrCreateNameSpace(t),this._createdObjects={},this._createCells=[],this._reusedObjects={},this._shortIdsToDualIds={},this._IdsObjIsEmpty=!0,this._treeKey=t,this._viewTransac=r,this._Processor=i,this._errManager=e.getErrorManager()},a.prototype.getTreatedObject=function(e){let t=this._createdObjects[e];return null==t&&(t=this._reusedObjects[e]),t},a.prototype.completeOperationWithObjects=function(r){this._errManager.addContext({name:"completeOperationWithObjects",arguments:arguments});let i=r.getType(),a=void 0,n=void 0,o=void 0;if(null!=r._IdOperatedObject){if(null!=r._IdOperatedObject._ShortId)a=this.getTreatedObject(r._IdOperatedObject._ShortId);else if(null!=r._IdOperatedObject._GlobalId){let n=this._nameSpace.decodeGlobalId({Node:null,Id:r._IdOperatedObject._GlobalId});if(i==t.prototype.OperationType.ApplyGP||i==t.prototype.OperationType.AddExistingCell){null!=n&&0!=n.length||(n=this._nameSpace.decodeGlobalId({Node:null,Id:r._IdOperatedObject._GlobalId,State:e.prototype.stateMode.TempoOrPermanent}));let t=n[n.length-1];if(t.isLeaf(this._treeKey)&&t.getIdPattern()._shared&&n.length>1){let e=n[n.length-2];e.getIdPattern()._idContext==t.getIdPattern()._idContext?(a=e,r._OperatedSubElements.push(t.getAssociatedViewElt(this._treeKey))):a=t}else a=t}else null!=n&&0!=n.length&&(a=n[n.length-1])}if(void 0!==r._IdOperatedSubElements){let i=a.getMappedChildren(this._treeKey,e.prototype.stateMode.TempoOrPermanent),n=r._IdOperatedSubElements.length;if(null!=i){let e,t,a;for(e=0;e<n;++e)t=r._IdOperatedSubElements[e],void 0!==(a=i.get(t))&&r._OperatedSubElements.push(a.getAssociatedViewElt(this._treeKey))}n&&!r._OperatedSubElements.length&&(r._type=t.prototype.OperationType.UnknownType),r._IdOperatedSubElements=void 0}if(null==a)throw new Error("we did not find the operatedObject");r._OperatedObject=a.getAssociatedViewElt(this._treeKey),r._IdOperatedObject=void 0}let s=void 0;if(null!=r._ShortIdOperand&&i==t.prototype.OperationType.AddExistingNode&&((s=this.getTreatedObject(r._ShortIdOperand)).getAssociatedViewElt(this._treeKey),r._OperandObject=s.getAssociatedViewElt(this._treeKey),r._ShortIdOperand=void 0,r._GlobalIdOperand=void 0),null!=r._GlobalIdOperand){let a=this._nameSpace.decodeGlobalId({Node:null,Id:r._GlobalIdOperand});i!=t.prototype.OperationType.AddExistingCell&&i!=t.prototype.OperationType.RemoveExistingCell||null!=a&&0!=a.length||(a=this._nameSpace.decodeGlobalId({Node:null,Id:r._GlobalIdOperand,State:e.prototype.stateMode.TempoOrPermanent})),null!=a&&0!=a.length&&(s=a[a.length-1]),r._OperandObject=s.getAssociatedViewElt(this._treeKey),r._GlobalIdOperand=void 0}if(null!=r._ExistingCells){let t,i,a=r._ExistingCells._context.getShortId(),n=r._ExistingCells._context.getIdPath(),o=[];if(r._ExistingCells._noContext)for(let e in r._ExistingCells._targetsIds){let t=this._nameSpace.getObjectsFromCtx("CGMGeom",r._ExistingCells._targetsIds[e]);o.push.apply(o,t)}else if(null!=a)t=this.getTreatedObject(a),i=e.prototype.stateMode.TempoOrPermanent,o=t.getChildrenWithId(this._treeKey,i,r._ExistingCells._targetsIds);else if(null!=n){let a=this._nameSpace.decodeGlobalId({Node:null,Id:n});null!=a&&0!=a.length||(a=this._nameSpace.decodeGlobalId({Node:null,Id:n,State:e.prototype.stateMode.TempoOrPermanent})),t=a[a.length-1],i=e.prototype.stateMode.Permanent,o=t.getChildrenWithId(this._treeKey,i,r._ExistingCells._targetsIds)}if(null!=r._ExistingCells._batchParent){let e=void 0,t=r._ExistingCells._batchParent.getShortId(),i=r._ExistingCells._batchParent.getIdPath();if(null!=t)e=this.getTreatedObject(t);else if(null!=i){let t=this._nameSpace.decodeGlobalId({Node:null,Id:i});null!=t&&0!=t.length&&(e=t[t.length-1])}r._BatchParentCellObject=e.getAssociatedViewElt(this._treeKey)}let s=o.length;if(s!=r._ExistingCells._targetsIds.length&&i===e.prototype.stateMode.Permanent&&(s=(o=t.getChildrenWithId(this._treeKey,e.prototype.stateMode.Tempo,r._ExistingCells._targetsIds)).length),s!=r._ExistingCells._targetsIds.length)throw new Error("we did not find all the existing cells we were looking for");if(0===s)r._OperandSubElements=void 0;else for(let e=0;e<s;++e)r._OperandSubElements.push(o[e].getAssociatedViewElt(this._treeKey))}if(null!=r._IdPreviousObject){let e=void 0;if(null!=r._IdPreviousObject._ShortId)e=this.getTreatedObject(r._IdPreviousObject._ShortId);else if(null!=r._IdPreviousObject._GlobalId){let t=this._nameSpace.decodeGlobalId({Node:null,Id:r._IdPreviousObject._GlobalId});null!=t&&0!=t.length&&(e=t[t.length-1])}r._PreviousObject=e.getAssociatedViewElt(this._treeKey),r._IdPreviousObject=void 0}if(null!=r._IdBatchParentObject){if(null!=r._IdBatchParentObject._ShortId)n=this.getTreatedObject(r._IdBatchParentObject._ShortId);else if(null!=r._IdBatchParentObject._GlobalId){let e=this._nameSpace.decodeGlobalId({Node:null,Id:r._IdBatchParentObject._GlobalId});null!=e&&0!=e.length&&(n=e[e.length-1])}r._BatchParentObject=n.getAssociatedViewElt(this._treeKey)}if(null!=r._IdBatchParentSharedObject){if(null!=r._IdBatchParentSharedObject._ShortId)o=this.getTreatedObject(r._IdBatchParentSharedObject._ShortId);else if(null!=r._IdBatchParentSharedObject._GlobalId){let e=this._nameSpace.decodeGlobalId({Node:null,Id:r._IdBatchParentSharedObject._GlobalId});null!=e&&0!=e.length&&(n=e[e.length-1])}r._BatchParentSharedObject=o.getAssociatedViewElt(this._treeKey)}if(null!=r._GeometricalData&&(null!=r._GeometricalData._idPathInitializers||null!=r._GeometricalData._shortIdInitializers)){let t=0,i=0,a=[];if(null!=r._GeometricalData._shortIdInitializers)for(i=r._GeometricalData._shortIdInitializers.length,t=0;t<i;t++){let e=r._GeometricalData._shortIdInitializers[t];if(null!=e){let t=this.getTreatedObject(e);a.push(t.getAssociatedViewElt(this._treeKey))}}if(null!=r._GeometricalData._idPathInitializers)for(i=r._GeometricalData._idPathInitializers.length,t=0;t<i;t++){let i=r._GeometricalData._idPathInitializers[t];if(null!=i){let t=void 0,r=this._nameSpace.decodeGlobalId({Node:null,Id:i});null!=r&&0!=r.length||(r=this._nameSpace.decodeGlobalId({Node:null,Id:i,State:e.prototype.stateMode.TempoOrPermanent})),null!=r&&0!=r.length&&(t=r[r.length-1]),a.push(t.getAssociatedViewElt(this._treeKey))}}r._GeometricalData._initializers=a}if(null!=r._Groups){if(null==a)throw new Error("object to which we want to add groups is undefined");let t,i=0,n=0;for(i=0;i<r._Groups.length;i++){(t=r._Groups[i])._groupedElements=[];let o=a.getChildrenWithId(this._treeKey,e.prototype.stateMode.Tempo,t._localIDs);for(n=0;n<o.length;n++)t._groupedElements.push(o[n].getAssociatedViewElt(this._treeKey))}}if(null==a&&void 0!==r._IdOperatedSubElements&&null!=r._BatchParentObject){let e,i,a,n,o=r._IdOperatedSubElements.length;for(e=0;e<o;++e)for(a=r._IdOperatedSubElements[e],n=this._nameSpace.getObjectsFromCtx("CGMGeom",a),i=0;i<n.length;i++)void 0!==n[i]&&r._OperatedSubElements.push(n[i].getAssociatedViewElt(this._treeKey));o&&!r._OperatedSubElements.length&&(r._type=t.prototype.OperationType.UnknownType),r._IdOperatedSubElements=void 0}this._errManager.cleanContext(arguments)},a.prototype.doOperation=function(e){this._errManager.addContext({name:"doOperation",arguments:arguments}),r.isPerformanceTracesActivated()&&r.startPerfo("CSIVMClientTransactionOnIdent.doOperation"),this.completeOperationWithObjects(e);let t=this._Processor.checkCompletedOperation(e);void 0!==t&&(t._TreeKey=this._treeKey,this._viewTransac.doOperation(t),this.internalDoOperation(t)),r.isPerformanceTracesActivated()&&r.endPerfo("CSIVMClientTransactionOnIdent.doOperation"),this._errManager.cleanContext(arguments)},a.prototype.executeEnd=function(){let e=void 0;return null!=this._viewTransac.executeEnd&&(e=this._viewTransac.executeEnd()),e},a.prototype.internalDoOperation=function(e){this._errManager.addContext({name:"internalDoOperation",arguments:arguments}),r.isPerformanceTracesActivated()&&r.startPerfo("CSIVMClientTransactionOnIdent.internalDoOperation");let i=e.getType();if(i===t.prototype.OperationType.RemoveAll)this._nameSpace.clear(this._treeKey);else{let r=void 0;if(void 0!==e._IdNewObject){let a,n=this._nameSpace.getObjects(e._IdNewObject._IdPattern,e._IdNewObject._LocalId),o=n.length;if(o){if(void 0!==e._OperatedObject)if(e._OperatedObject.getIdentificationObject().getIdPattern()._idContext!==e._IdNewObject._IdPattern._idContext&&e._OperatedObject.getIdentificationObject().getIdPattern()._idContext===e._IdNewObject._IdPattern._idSpace)a=e._OperatedObject.getIdentificationObject();else{let t=e._OperatedObject.getIdentificationObject().getFirstParentsDefiningNameSpaceOfThis();t.length&&(a=t[0])}if(a)for(let e=0;e<o&&void 0===r;e++)n[e].getFirstParentsDefiningNameSpaceOfThis().indexOf(a)>=0&&(r=n[e]);else{if(o>1)throw new Error("Several objects with same ID without any Parent defining a NameSpace to allow such a situation");r=n[0]}}if(void 0!==r){if(r.getViewData(this._treeKey))throw new Error("we try to create a view of an object which already has a representation in this view");this._reusedObjects[e._IdNewObject._ShortId]=r}else r=this._nameSpace.createObject(e._IdNewObject._IdPattern,e._IdNewObject._LocalId),this._createdObjects[e._IdNewObject._ShortId]=r,e._IdNewObject._LocalIdDual&&(this._shortIdsToDualIds[e._IdNewObject._ShortId]=e._IdNewObject._LocalIdDual,this._IdsObjIsEmpty=!1),i===t.prototype.OperationType.CreateRoot||i===t.prototype.OperationType.CreateRootBatch||i===t.prototype.OperationType.CreateSemanticRoot?r.setRoot():i===t.prototype.OperationType.AddBody&&r.activateChildrenMapping();e._CreatedObject.setIdentificationObject(r),r.associateViewElt(this._treeKey,e._CreatedObject)}switch(i){case t.prototype.OperationType.AddBatchNode:case t.prototype.OperationType.CreateRootBatch:{let t=void 0;e._OperatedObject&&(t=e._OperatedObject.getIdentificationObject());let i=null,a=null,n=e._BatchCellIdPattern;for(let t=0;t<e._CreatedObjectsWithID.length;t++)i=void 0,a=e._CreatedObjectsWithID[t],void 0===i&&(i=this._nameSpace.createObject(n,a.ident),this._createCells.push(i)),a.object.setIdentificationObject(i),i.associateViewElt(this._treeKey,a.object);t&&t.addChild(this._treeKey,r)}break;case t.prototype.OperationType.AddNode:case t.prototype.OperationType.AddBody:case t.prototype.OperationType.AddCustomNode:case t.prototype.OperationType.AddSemanticNode:if(e._OperatedObject.getIdentificationObject().addChild(this._treeKey,r),void 0!==e._GeometricalData&&void 0!==e._GeometricalData._initializers)for(let t=0;t<e._GeometricalData._initializers.length;t++){let i=e._GeometricalData._initializers[t].getIdentificationObject(),a=i.getChildren(this._treeKey,i.stateMode.Tempo);void 0!==a&&r.addChildren(this._treeKey,a)}break;case t.prototype.OperationType.AddCells:{let t=0,r=e._OperatedObject.getIdentificationObject(),i=null,a=null,n=[],o=!1;void 0!==e._MultipleViewElts&&(t=e._MultipleViewElts.length);for(let s=0;s<e._CreatedObjectsWithID.length;s++){if(i=void 0,a=e._CreatedObjectsWithID[s],o=!1,t>0)for(let r=0;r<t&&!o;r++)e._MultipleViewElts[r]===a.ident&&(o=!0);if(o){let t=this._nameSpace.getObjects(e._IdPattern,a.ident),n=t.length;if(n){let e,a=r.getFirstParentsDefiningNameSpaceOfThis();if(a.length&&(e=a[0]),e)for(let r=0;r<n&&void 0===i;r++)t[r].getFirstParentsDefiningNameSpaceOfThis().indexOf(e)>=0&&(i=t[r]);else{if(n>1)throw new Error("Several cells with same ID without any Parent defining a NameSpace to allow such a situation");i=t[0]}}void 0!==i&&(i=i.addObject())}void 0===i&&(i=this._nameSpace.createObject(e._IdPattern,a.ident),this._createCells.push(i)),a.object.setIdentificationObject(i),i.associateViewElt(this._treeKey,a.object),n.push(i)}r.addChildren(this._treeKey,n)}break;case t.prototype.OperationType.AddExistingNode:case t.prototype.OperationType.AddExistingCell:{let t=e._OperatedObject.getIdentificationObject(),r=e._OperandObject.getIdentificationObject();t.addChild(this._treeKey,r)}break;case t.prototype.OperationType.RemoveExistingNode:case t.prototype.OperationType.RemoveExistingCell:{let t=e._OperatedObject.getIdentificationObject(),r=e._OperandObject.getIdentificationObject();t.removeChild(this._treeKey,r)}break;case t.prototype.OperationType.AddExistingCells:{let t=e._OperatedObject.getIdentificationObject(),r=e._OperandSubElements,i=[];for(let e=0;e<r.length;++e)i.push(r[e].getIdentificationObject());t.addChildren(this._treeKey,i)}break;case t.prototype.OperationType.RemoveExistingCells:{let t=e._OperatedObject.getIdentificationObject(),r=e._OperandSubElements,i=[],a=r.length;for(let e=0;e<a;++e)i.push(r[e].getIdentificationObject());t.removeChildren(this._treeKey,i)}}}r.isPerformanceTracesActivated()&&r.endPerfo("CSIVMClientTransactionOnIdent.internalDoOperation"),this._errManager.cleanContext(arguments)},a.prototype.commit=function(){if(this._errManager.addContext({name:"commit",arguments:arguments}),this._viewTransac.commit(),this._nameSpace.commit(this._treeKey),this._nameSpace.isEmpty()){let e=this._Processor.getModel();void 0!==e&&e.removeNameSpace(this._nameSpace)}this._errManager.cleanContext(arguments)},a.prototype.abort=function(){this._errManager.addContext({name:"abort",arguments:arguments});let e=0,t=this._createCells.length;for(e in this._createdObjects)this._nameSpace.removeObject(this._createdObjects[e]);for(e=0;e<t;++e)this._nameSpace.removeObject(this._createCells[e]);this._nameSpace.abort(this._treeKey),this._viewTransac.abort(),this._errManager.cleanContext(arguments)},a.prototype.computeDuality=function(){if(this._errManager.addContext({name:"computeDuality",arguments:arguments}),!this._IdsObjIsEmpty){let e=this._Processor.getModel();if(void 0!==e){let t,r,a,n,o,s=this._treeKey.getViewType(),d=[];s===i.prototype.ViewType.ViewSpecTree||s===i.prototype.ViewType.ViewSpecTree2?d.push(i.prototype.ViewType.View3D):s===i.prototype.ViewType.View3D&&d.push(i.prototype.ViewType.ViewSpecTree,i.prototype.ViewType.ViewSpecTree2);let l,c=d.length;for(t in this._shortIdsToDualIds)if(void 0!==(a=this._createdObjects[t]))for(r=this._shortIdsToDualIds[t],l=0;l<c&&(o=d[l],void 0===(n=a.getDualObject(o))||n.getDualObject(s)!==a);++l)if(void 0!==(n=e.getDualObject(o,a.getIdPattern(),r))){a.setDualObject(o,n),n.setDualObject(s,a);break}}}},a}),define("DS/CSIViewModelWebProcessor/CSIVMClientTreeObjectParameter",["DS/CSICommandBinder/CSICommandBinder","DS/CSIViewModelWebInterfaces/CSIVMClientParameterLabels"],function(e,t){"use strict";function r(e){this._shortId=e.shortId||null,this._idPath=e.idPath||null}r.prototype.getShortId=function(){return this._shortId},r.prototype.getIdPath=function(){return this._idPath};let i=function(){return!1},a=function(e){return new r({shortId:e.readInt32(t.shortId),idPath:e.readString(t.idPath)})};return r.prototype.declareType=function(){e.declareType({type:"CSIViewTreeObjectParam",serialize:i,unserialize:a})},r}),define("DS/CSIViewModelWebProcessor/CSIVMClientAppliedGPTokenParameter",["DS/CSICommandBinder/CSICommandBinder","DS/CSIViewModelWebInterfaces/CSIVMClientParameterLabels","DS/CSIViewModelWebInterfaces/CSIVMClientOperation","DS/CSIViewModelWebProcessor/CSIVMClientTargetsInContext","DS/CSIViewModelWebProcessor/CSIVMClientAppliedGPTokenId"],function(e,t,r,i,a){"use strict";function n(e){this._id=e.id||0,this._shortIds=e.shortIds,this._globalIds=e.globalIds,this._targetsInContext=e.targetsInContext}n.prototype.process=function(e,t){let i=e.getGraphicProperties(),a=e.getProcessor(),n=0,o=0;if(void 0!==this._shortIds)for(o=this._shortIds.length,n=0;n<o;n++){let e=a.createOperation({_type:r.prototype.OperationType.ApplyGP,_IdOperatedObject:{_ShortId:this._shortIds[n]._shortId},_GraphicProperties:i[this._id],_IdBatchParentObject:void 0!==this._shortIds[n]._batchParent?{_GlobalId:this._shortIds[n]._batchParent.getIdPath(),_ShortId:this._shortIds[n]._batchParent.getShortId()}:void 0});t.doOperation(e)}if(void 0!==this._globalIds)for(o=this._globalIds.length,n=0;n<o;n++){let e=a.createOperation({_type:r.prototype.OperationType.ApplyGP,_IdOperatedObject:{_GlobalId:this._globalIds[n]._idPath},_GraphicProperties:i[this._id],_IdBatchParentObject:void 0!==this._globalIds[n]._batchParent?{_GlobalId:this._globalIds[n]._batchParent.getIdPath(),_ShortId:this._globalIds[n]._batchParent.getShortId()}:void 0});t.doOperation(e)}if(void 0!==this._targetsInContext)for(o=this._targetsInContext.length,n=0;n<o;n++){let e=a.createOperation({_type:r.prototype.OperationType.ApplyGP,_IdOperatedObject:null!=this._targetsInContext[n]._context?{_GlobalId:this._targetsInContext[n]._context.getIdPath(),_ShortId:this._targetsInContext[n]._context.getShortId()}:void 0,_GraphicProperties:i[this._id],_IdBatchParentObject:void 0!==this._targetsInContext[n]._batchParent?{_GlobalId:this._targetsInContext[n]._batchParent.getIdPath(),_ShortId:this._targetsInContext[n]._batchParent.getShortId()}:void 0,_IdOperatedSubElements:this._targetsInContext[n]._targetsIds,_OperatedGeomTypes:this._targetsInContext[n]._targetsGeomTypes});t.doOperation(e)}};let o=function(){return!1},s=function(e){return new n({id:e.readUint32(t.idGP),shortIds:e.readObjectArray(t.shortIds,"CSIViewModelGPTokenId"),globalIds:e.readObjectArray(t.globalIds,"CSIViewModelGPTokenId"),targetsInContext:e.readObjectArray(t.targetsInContext,"CSIViewModelTargetsInContext")})};return n.prototype.declareType=function(){e.declareType({type:"CSIViewModelGPTokenParam",serialize:o,unserialize:s}),i.prototype.declareType(),a.prototype.declareType()},n}),define("DS/CSIViewModelWebProcessor/CSIVMClientTreeTokenParameter",["DS/CSICommandBinder/CSICommandBinder","DS/CSIViewModelWebInterfaces/CSIVMClientParameterLabels","DS/CSIViewModelWebProcessor/CSIVMClientTreeObjectParameter","DS/CSIViewModelWebInterfaces/CSIVMClientGeometryParameter","DS/CSIViewModelWebInterfaces/CSIVMClientInfiniteGeometryParameter","DS/CSIViewModelWebInterfaces/CSIVMClientBoundingSphereParameter","DS/CSIViewModelWebInterfaces/CSIVMClientCustomDataParameter","DS/CSIViewModelWebInterfaces/CSIVMClientOperation","DS/CSIViewModelWebInterfaces/CSIVMClientGroup","DS/CSIViewModelWebProcessor/CSIVMClientTargetsInContext","DS/CSIViewModelWebInterfaces/CSIVMClientVisClippingFilter","DS/CSIViewModelWebInterfaces/CSIVMClientVisRepViewModeFilter","DS/CSIViewModelWebInterfaces/CSIVMClientVisCircularScissorFilter","DS/CSIViewModelWebInterfaces/CSIVMClientVisPolygonalScissorFilter","DS/CSIViewModelWebInterfaces/CSIVMClientVisClippingVolumesFilter","DS/CSIViewModelWebInterfaces/CSIVMClientVisAnnotation","DS/CSIViewModelWebInterfaces/CSIVMClientVis2DModeFilter","DS/CSIViewModelWebInterfaces/CSIVMClientVisLayerFilter","DS/CSIViewModelWebInterfaces/CSIVMClientVisZModeFilter","DS/CSIViewModelWebInterfaces/CSIVMClientVisGASInheritFilter","DS/CSIViewModelWebInterfaces/CSIVMClientVisClippingSphereFilter","DS/CSIViewModelWebInterfaces/CSIVMClientVisAlphaFilter","DS/CSIViewModelWebInterfaces/CSIVMClientVisClippingSectionsFilter","DS/CSIViewModelWebInterfaces/CSIVMClientVisContextFilter","DS/CSIViewModelWebInterfaces/CSIVMClientVisCurveClippingFilter","DS/CSIViewModelWebInterfaces/CSIVMClientVisViewportFilter","DS/CSIViewModelWebInterfaces/CSIVMClientVisFurtiveFilter","DS/CSIViewModelWebInterfaces/CSIVMClientVisPolygonOffsetFilter","DS/CSIViewModelWebInterfaces/CSIVMClientVisParameter","DS/CSIViewModelWebProcessor/CSIVMClientAttributesHelper","DS/CSIViewModelWebProcessor/CSIVMClientSemanticDataHelper","DS/CSIViewModelWebInterfaces/CSIViewModelWebEnv","DS/EKEventsWeb/EKEvents"],function(e,t,r,i,a,n,o,s,d,l,c,p,I,h,_,u,S,C,b,m,y,O,f,g,w,V,M,P,v,D,T,j,E){"use strict";function x(e){this._value=e.value||s.prototype.OperationType.UnknownType,this._localIdInt=e.localIdInt,this._localIdString=e.localIdString,this._localIdIntDual=e.localIdIntDual,this._localIdStringDual=e.localIdStringDual,this._shortId=e.shortId,this._idPath=e.idPath,this._idPattern=e.idPattern,this._batchCellIdPattern=e.batchCellIdPattern,this._parent=e.parent,this._batchParent=e.batchParent,this._batchParentShared=e.batchParentShared,this._previous=e.previous,this._geometries=e.geometries&&e.geometries.length?e.geometries:e.geometry?[e.geometry]:void 0,this._infiniteGeometries=e.infiniteGeometries&&e.infiniteGeometries.length?e.infiniteGeometries:e.infiniteGeometry?[e.infiniteGeometry]:void 0,this._visGeometry=e.visGeometry,this._bs=e.bs,this._inits_idPath=e.inits_idPath,this._inits_shortId=e.inits_shortId,this._customData=e.customData,this._groups=e.groups,this._attributes=e.attributes,this._multipleViewElts=e.multipleViewElts,this._hasInfiniteGeometry=e.hasInfiniteGeometry||void 0!==this._infiniteGeometries,this._hasGeomDecorations=e.hasGeomDecorations,this._existingCells=e.existingCells}x.prototype.process=function(e,t){let r;j.isEKPerfoTracesActivated()&&(r=E.Trace.traceStart(j.getEKPerfoProvider(),"web__csivmclienttreetokenparameter_process")),t._errManager.addContext({name:"process",arguments:arguments});let i,a,n,o,d,l,c,p,I,h,_,u,S,C=e.getProcessor(),b=e.getIdPatterns(),m=this._visGeometry;this._value==s.prototype.OperationType.ModifyCustomNode||this._value==s.prototype.OperationType.ApplyAttributes||this._value==s.prototype.OperationType.ModifyBody||this._value==s.prototype.OperationType.ModifyBatch?n={_GlobalId:this._idPath}:this._value!=s.prototype.OperationType.RemoveAll&&(!this._parent||null==this._parent.getShortId()&&null==this._parent.getIdPath()?this._value==s.prototype.OperationType.AddBatchNode?this._value=s.prototype.OperationType.CreateRootBatch:this._value=s.prototype.OperationType.CreateRoot:(n={_ShortId:this._parent.getShortId(),_GlobalId:this._parent.getIdPath()},c=this._idPath,p=this._shortId),this._previous&&(I={_ShortId:this._previous.getShortId(),_GlobalId:this._previous.getIdPath()}),this._value==s.prototype.OperationType.AddCells&&(d=b[this._idPattern]),(this._localIdInt||this._localIdString)&&this._idPattern&&this._shortId&&(o={_LocalId:this._localIdInt||this._localIdString,_LocalIdDual:this._localIdIntDual||this._localIdStringDual,_IdPattern:b[this._idPattern],_ShortId:this._shortId})),this._value!=s.prototype.OperationType.AddExistingCells&&this._value!=s.prototype.OperationType.AddExistingNode&&this._value!=s.prototype.OperationType.AddGroups&&this._value!=s.prototype.OperationType.AddBody||this._batchParent&&(h={_ShortId:this._batchParent.getShortId(),_GlobalId:this._batchParent.getIdPath()}),this._value==s.prototype.OperationType.AddExistingNode&&this._batchParentShared&&(_={_ShortId:this._batchParentShared.getShortId(),_GlobalId:this._batchParentShared.getIdPath()}),(this._geometries||this._infiniteGeometries||this._inits_idPath||this._inits_shortId||this._bs)&&(this._value==s.prototype.OperationType.AddBatchNode||this._value==s.prototype.OperationType.CreateRootBatch?(l=b[this._batchCellIdPattern],this._geometries&&(i=new s.prototype.GeometricalData(this._bs,this._inits_idPath,this._inits_shortId,this._geometries,void 0,e.getViewVersion(),!1,this._hasGeomDecorations)),this._infiniteGeometries&&(a=new s.prototype.GeometricalData(this._bs,this._inits_idPath,this._inits_shortId,this._infiniteGeometries,void 0,e.getViewVersion(),!0,this._hasGeomDecorations))):(i=new s.prototype.GeometricalData(this._bs,this._inits_idPath,this._inits_shortId,this._hasInfiniteGeometry?this._infiniteGeometries:this._geometries,void 0,e.getViewVersion(),this._hasInfiniteGeometry,this._hasGeomDecorations),void 0!==this._geometries&&void 0!==this._infiniteGeometries&&(a=i,i=new s.prototype.GeometricalData(this._bs,this._inits_idPath,this._inits_shortId,this._geometries,this._dim,e.getViewVersion(),!1,this._hasGeomDecorations)))),null!=this._customData&&this._customData.getBinFormat()==this._customData.binFormatValues.sem&&(u=T.createSemanticData(this._customData.getData()),this._value==s.prototype.OperationType.AddCustomNode?this._value=s.prototype.OperationType.AddSemanticNode:this._value==s.prototype.OperationType.CreateRoot?this._value=s.prototype.OperationType.CreateSemanticRoot:this._value==s.prototype.OperationType.ModifyCustomNode&&(this._value=s.prototype.OperationType.ModifySemanticNode)),void 0!==this._attributes&&(S=D.createAttributes(this._attributes));let y=C.createOperation({_type:this._value,_GeometricalData:i,_InfiniteGeometricalData:a,_VisData:m,_CustomData:this._customData,_SemanticData:u,_IdOperatedObject:n,_IdNewObject:o,_IdPreviousObject:I,_IdBatchParentObject:h,_IdBatchParentSharedObject:_,_IdPattern:d,_BatchCellIdPattern:l,_ShortIdOperand:p,_GlobalIdOperand:c,_MultipleViewElts:this._multipleViewElts,_Groups:this._groups,_Attributes:S,_ExistingCells:this._existingCells});t.doOperation(y),t._errManager.cleanContext(arguments),r&&r.End()};let G=function(){return!1},A=function(e){let r=e.readString(t.value);e.readObject(t.valueVisGeometry,"CSIVisParam");return new x({value:t.valueTab[r],localIdInt:e.readUint32(t.localIdInt),localIdString:e.readString(t.localIdString),localIdIntDual:e.readUint32(t.localIdIntDual),localIdStringDual:e.readString(t.localIdStringDual),shortId:e.readInt32(t.shortId),idPath:e.readString(t.idPath),idPattern:e.readInt32(t.idPattern),batchCellIdPattern:e.readInt32(t.batchCellIdPattern),parent:e.readObject(t.parent,"CSIViewTreeObjectParam"),batchParent:e.readObject(t.batchParent,"CSIViewTreeObjectParam"),batchParentShared:e.readObject(t.batchParentShared,"CSIViewTreeObjectParam"),previous:e.readObject(t.previous,"CSIViewTreeObjectParam"),geometry:e.readObject(t.valueGeometry,"CSIGeometryParam"),geometries:e.readObjectArray(t.valueGeometries,"CSIGeometryParam"),infiniteGeometry:e.readObject(t.valueInfiniteGeometry,"CSIInfiniteGeometryParam"),infiniteGeometries:e.readObjectArray(t.valueInfiniteGeometries,"CSIInfiniteGeometryParam"),visGeometry:e.readObject(t.valueVisGeometry,"CSIVisParam"),multipleViewElts:e.readUint32Array(t.valueMultipleViewElts),bs:e.readObject(t.valueBoundingSphere,"CSIBoundingSphereParam"),customData:e.readObject(t.valueCustomData,"CSICustomDataParam"),inits_idPath:e.readStringArray(t.valueIdPathInitializers),inits_shortId:e.readInt32Array(t.valueShortIdInitializers),groups:e.readObjectArray(t.valueGroups,"CSIViewModelGroup"),attributes:e.readObject(t.valueAttribute,"Parameters"),hasInfiniteGeometry:e.readBool(t.valueHasInfiniteGeometry),hasGeomDecorations:e.readBool(t.valueHasGeomDecorations),existingCells:e.readObject(t.targetsInContext,"CSIViewModelTargetsInContext")})};return x.prototype.declareType=function(){e.declareType({type:"CSIViewTreeTokenParam",serialize:G,unserialize:A}),r.prototype.declareType(),i.prototype.declareType(),a.declareType(),v.prototype.declareType(),n.prototype.declareType(),o.prototype.declareType(),d.prototype.declareType(),l.prototype.declareType(),c.prototype.declareType(),p.prototype.declareType(),I.prototype.declareType(),h.prototype.declareType(),_.prototype.declareType(),u.prototype.declareType(),S.prototype.declareType(),C.prototype.declareType(),b.prototype.declareType(),m.prototype.declareType(),y.prototype.declareType(),O.prototype.declareType(),f.prototype.declareType(),g.prototype.declareType(),w.prototype.declareType(),V.prototype.declareType(),M.prototype.declareType(),P.prototype.declareType(),D.declareTypes(e)},x}),define("DS/CSIViewModelWebProcessor/CSIVMClientTreeUpdateParameter",["DS/CSICommandBinder/CSICommandBinder","DS/CSIViewModelWebInterfaces/CSIVMClientParameterLabels","DS/CSIViewModelWebProcessor/CSIVMClientTreeTokenParameter","DS/CSIViewModelWebProcessor/CSIVMClientAppliedGPTokenParameter"],function(e,t,r,i){"use strict";function a(e,t,r){this._treeKey=e||{},this._tokens=t||[],this._appliedGP=r||[]}a.prototype.getTreeKey=function(){return this._treeKey},a.prototype.getTokens=function(){return this._tokens},a.prototype.process=function(e){let r=e.getProcessor();this._treeKey=this._treeKey.process(e),r.abort(this._treeKey);let i=r.createTransactionOnIdent(this._treeKey),a=0,n=null;for(a=0;a<this._tokens.length;a++)(n=this._tokens[a]).process(e,i);for(a=0;a<this._appliedGP.length;a++)(n=this._appliedGP[a]).process(e,i);return i.executeEnd(),e.getViewStatus()===t.viewStatuses.Permanent&&r.commit(this._treeKey),i};let n=function(){return!1},o=function(e){return new a(e.readObject(t.csiTreeKey,"CSIViewTreeKey"),e.readObjectArray(t.tokens,"CSIViewTreeTokenParam"),e.readObjectArray(t.appliedGP,"CSIViewModelGPTokenParam"))};return a.prototype.declareType=function(){e.declareType({type:"CSIViewTreeUpdateParam",serialize:n,unserialize:o}),r.prototype.declareType(),i.prototype.declareType()},a}),define("DS/CSIViewModelWebProcessor/CSIVMClientViewParameter",["DS/CSICommandBinder/CSICommandBinder","DS/CSIViewModelWebInterfaces/CSIVMClientParameterVersion","DS/CSIViewModelWebInterfaces/CSIVMClientParameterLabels","DS/CSIViewModelWebProcessor/CSIVMClientTreeUpdateParameter","DS/CSIViewModelWebProcessor/CSIVMClientSceneEnvUpdateParameter","DS/CSIViewModelWebProcessor/CSIVMClientIdPatternParameter","DS/CSIViewModelWebInterfaces/CSIVMClientSceneEnvMessageParameter","DS/CSIViewModelWebInterfaces/CSIVMClientGraphicPropertyParameter","DS/CSIViewModelWebInterfaces/CSIVMClientMaterialMessageParameter","DS/CSIViewModelWebProcessor/CSIVMClientVisuContextParameter","DS/CSIViewModelWebInterfaces/CSIVMClientTreeKey","DS/CSIViewModelWebInterfaces/CSIVMClientOperation","CSIMathematics/CSIDeclareMathematics","DS/CSIViewModelWebInterfaces/CSIViewModelWebEnv","DS/EKEventsWeb/EKEvents"],function(e,t,r,i,a,n,o,s,d,l,c,p,I,h,_){"use strict";let u=!1,S=!1;function C(e){this._viewStatus=e.viewStatus||this.viewStatusPermanent,this._viewVersion=e.viewVersion,S||(this._viewVersion!==t.currentVersion&&(console.error("****************************************"),console.error("           WARNING: 3DSync Issues       "),console.error("****************************************"),console.error(`Your server 3DSync code is currently build on version ${this._viewVersion}`),console.error(`Your web 3DSync code is currently on version ${t.currentVersion}`),console.error("This mismatch between version can create many unexpected behavior")),S=!0),this._idPatterns=e.idPatterns||{},this._graphicProperties=e.gas||{},this._treeUpdates=e.treeUpdates||[],this._sceneEnvData=e.sceneEnvData||{},this._sceneEnvUpdate=e.sceneEnvUpdate||{},this._visuContext=e.visuContext||{},this._texturesToBeRemovedFromCache=e.texturesToBeRemovedFromCache||void 0}C.prototype.getViewStatus=function(){return this._viewStatus},C.prototype.getViewVersion=function(){return this._viewVersion},C.prototype.getIdPatterns=function(){return this._idPatterns},C.prototype.getGraphicProperties=function(){return this._graphicProperties},C.prototype.getSceneEnvData=function(){return this._sceneEnvData},C.prototype.getTreeUpdates=function(){return this._treeUpdates},C.prototype.getSceneEnvUpdate=function(){return this._sceneEnvUpdate},C.prototype.getVisuContext=function(){return this._visuContext},C.prototype.getProcessor=function(){return this._processor},C.prototype.process=function(e){if(this._processor=e,this.getViewStatus()===r.viewStatuses.Commit)e.commit();else if(this.getViewStatus()===r.viewStatuses.Abort)e.abort();else{let t;h.isEKPerfoTracesActivated()&&(t=_.Trace.traceStart(h.getEKPerfoProvider(),"web__csivmclientviewparameter_processvisucontext")),null!=this._visuContext&&null!=this._visuContext.process&&this._visuContext.process(this),this._sceneEnvUpdate&&0!==Object.keys(this._sceneEnvUpdate).length&&this._sceneEnvUpdate.process&&this._sceneEnvUpdate.process(this),t&&t.End();for(let e in this._idPatterns){let t=this._idPatterns[e];this._idPatterns[e]=t.process(this)}let r,i,a,n,o=[];for(i=this._treeUpdates.length,r=0;r<i;++r)n=(a=this._treeUpdates[r]).process(this),o.push(n);for(i=o.length,r=0;r<i;++r)(n=o[r]).computeDuality();this.cleanTextureCache(e)}},C.prototype.cleanTextureCache=function(e){if(this._texturesToBeRemovedFromCache&&this._texturesToBeRemovedFromCache.length>0){const t={getUUID:()=>null,getViewType:()=>c.prototype.ViewType.View3D,getView3DType:()=>c.prototype.View3DType.View3D_Main},r=e.createTransaction(t),i=e.createOperation({_type:p.prototype.OperationType.RemoveTextureFromCache,_TextureUids:this._texturesToBeRemovedFromCache});r.doOperation(i),r.executeEnd()}};let b=function(){return!1},m=function(e){let t,i,a={viewStatus:e.readUint8(r.viewStatus),viewVersion:e.readUint8(r.viewVersion),gas:{},treeUpdates:e.readObjectArray(r.treeUpdates,"CSIViewTreeUpdateParam"),sceneEnvData:e.readObject(r.sceneEnvMessage,"CSIViewModelSceneEnvMessage"),sceneEnvUpdate:e.readObject(r.sceneEnvUpdate,"CSIViewSceneEnvUpdateParam"),visuContext:e.readObject(r.VisuContextMessage,"CSIVisuContextMessage"),texturesToBeRemovedFromCache:e.readUint32Array(r.textureUids),idPatterns:{}},n=e.readObjectArray(r.idPatterns,"CSIViewModelIdPattern"),o=e.readObjectArray(r.graphicProperties,"CSIViewModelGraphicProperty"),s=e.readObject(r.materialMessage,"CSIViewModelMaterialMessage");if(n)for(t=0;t<n.length;t++){let e=n[t];a.idPatterns[e.getId()]=e}if(o){let e,r;if(void 0!==s){let t=s.getMaterialJSON();void 0!==t&&(e=t.getJSON()),r=s.getMaterialBuffers()}for(t=0;t<o.length;t++){let n=o[t];if(void 0!==n){let t=n.getMaterial();if(void 0!==t){let a=t.getMaterialDefinition();if(void 0!==a)for(void 0===a.JSON&&(a.JSON=e),void 0===a.Buffers&&(a.Buffers=r),i=0;i<a.Indices.length;i++)a.Indices[i]--}a.gas[n.getId()]=n}}}return new C(a)};return C.prototype.declareType=function(){u||(I(e),e.declareType({type:"CSIViewParam",serialize:b,unserialize:m}),i.prototype.declareType(),n.prototype.declareType(),s.prototype.declareType(),d.prototype.declareType(),o.prototype.declareType(),a.prototype.declareType(),l.prototype.declareType(),u=!0)},C.prototype.declareType(),C}),define("DS/CSIViewModelWebProcessor/CSIVMClientProcessor",["DS/CSIViewModelWebImplement/CSIVMClientModel","DS/CSICommandBinder/CSICommandBinder","DS/CSIViewModelWebProcessor/CSIVMClientTransactionOnIdent","DS/CSIViewModelWebInterfaces/CSIVMClientOperation","DS/CSIViewModelWebProcessor/CSIVMClientViewParameter","DS/CSIViewModelWebInterfaces/CSIViewModelWebEnv","DS/EKEventsWeb/EKEvents"],function(e,t,r,i,a,n,o){"use strict";let s=0,d=function(r){let i=this;s=0,this._cbOnFatalError,this._cbOnVMUpdate={},this._delegateMap={},this._model=r,void 0===r&&(this._model=new e),this._curTransactionMap={},a.prototype.declareType(),this.onServerMessageWithOutCallback=function(e){let t;n.isEKPerfoTracesActivated()&&(t=o.Trace.traceStart(n.getEKPerfoProvider(),"web__csivmclientprocessor_readviewparam"));let r=e.readObject("view","CSIViewParam"),a=e.readUint8("OperationType"),s=!0===e.readBool("rc")?"S_OK":"E_FAIL";t&&t.End();let d={Operation:a,rc:s,hasUpdatedView:!1};if(r){let e;n.isEKPerfoTracesActivated()&&(e=o.Trace.traceStart(n.getEKPerfoProvider(),"web__csivmclientprocessor_processviewparam")),d.hasUpdatedView=!0,r.process(i),e&&e.End()}return d},this.answerCallback=function(e,t){let r=void 0;for(let a in i._cbOnVMUpdate)null!=(r=i._cbOnVMUpdate[a])&&r(e,t)},this.onServerMessage=function(e){let t,r;if(n.isEKPerfoTracesActivated()){const r={msg_size:e.getInputStreamSize()};t=o.Trace.traceStart(n.getEKPerfoProvider(),"web__csivmclientprocessor_onservermessage",r)}try{r=i.onServerMessageWithOutCallback(e)}catch(e){if(i._cbOnFatalError)i._cbOnFatalError(e);else{if(window.CSIVMClientManagerThrowUncaughtError)throw e;console.error("Uncaught CSIVMClient Error.",e)}}return t&&t.End(),i.answerCallback(r,e),!0},t.getDefaultResponse().onAnswerDomain("view",this.onServerMessage)};return d.prototype.getModel=function(){return this._model},d.prototype.setNotifier=function(e,t){return this._delegateMap[e]=t,t},d.prototype.getNotifier=function(e){return this._delegateMap[e]},d.prototype.addCBOnVMUpdate=function(e){return this._cbOnVMUpdate[s]=e,++s},d.prototype.addCBOnFatalError=function(e){return this._cbOnFatalError=e,e},d.prototype.removeCBOnVMUpdate=function(e){this._cbOnVMUpdate[e-1]&&(this._cbOnVMUpdate[e-1]=void 0,delete this._cbOnVMUpdate[e-1])},d.prototype.createTransaction=function(e){let t=void 0;return t=this._delegateMap[e.getViewType()].createTransaction(e)},d.prototype.createTransactionOnIdent=function(e){let t=new r,i=this.createTransaction(e);return t.setData(this._model,e,i,this),this._curTransactionMap[e.getUUID()]=t,t},d.prototype.getTransactionOnIdent=function(e){return this._curTransactionMap[e.getUUID()]},d.prototype.deleteTransactionOnIdent=function(e){delete this._curTransactionMap[e.getUUID()]},d.prototype.getOrCreateTransactionOnIdent=function(e){let t=this.getTransactionOnIdent(e);return null==t&&(t=this.createTransactionOnIdent(e)),t},d.prototype.commit=function(e){let t;if(n.isEKPerfoTracesActivated()&&(t=o.Trace.traceStart(n.getEKPerfoProvider(),"web__csivmclientprocessor_commit")),null==e){for(let e in this._curTransactionMap){this._curTransactionMap[e].commit()}this._curTransactionMap={}}else{let t=this.getTransactionOnIdent(e);null!=t&&(t.commit(),this.deleteTransactionOnIdent(e))}t&&t.End()},d.prototype.abort=function(e){if(null==e){for(let e in this._curTransactionMap){this._curTransactionMap[e].abort()}this._curTransactionMap={}}else{let t=this.getTransactionOnIdent(e);null!=t&&(t.abort(),this.deleteTransactionOnIdent(e))}},d.prototype.createOperation=function(e){let t=void 0,r=e._type>1?[{_IdOperatedObject:!0,_IdNewObject:!0,_IdPreviousObject:!1,_Attributes:!1},{_IdOperatedObject:!0,_GeometricalData:!1,_VisData:!1,_IdNewObject:!0,_Attributes:!1,_IdBatchParentObject:!1},{_IdOperatedObject:!0,_GeometricalData:!1,_InfiniteGeometricalData:!1,_IdPattern:!0,_MultipleViewElts:!1},{_IdOperatedObject:!0,_CustomData:!0,_IdNewObject:!0,_IdPreviousObject:!1,_Attributes:!1},{_IdOperatedObject:!0,_ShortIdOperand:!1,_GlobalIdOperand:!1,_IdPreviousObject:!1,_IdBatchParentObject:!1,_IdBatchParentSharedObject:!1,_BatchCellIdPattern:!1},{_IdOperatedObject:!0,_GlobalIdOperand:!0},{_IdOperatedObject:!0,_GlobalIdOperand:!0,_IdPreviousObject:!1},{_IdOperatedObject:!0,_GlobalIdOperand:!0},{},{_IdOperatedObject:!0,_CustomData:!0},{_IdOperatedObject:!0,_Groups:!0,_IdBatchParentObject:!1},{_IdOperatedObject:!1,_GraphicProperties:!0,_IdOperatedSubElements:!1,_OperatedGeomTypes:!1,_IdBatchParentObject:!1},{_IdNewObject:!0,_Attributes:!1},{_IdOperatedObject:!0,_SemanticData:!0,_IdNewObject:!0,_IdPreviousObject:!1,_Attributes:!1},{_IdOperatedObject:!0,_SemanticData:!0},{_IdNewObject:!0,_SemanticData:!0,_Attributes:!1},{_IdOperatedObject:!0,_Attributes:!0},{_IdOperatedObject:!0,_GeometricalData:!1,_VisData:!1},{_IdOperatedObject:!0,_ExistingCells:!0,_IdBatchParentObject:!1},{_IdOperatedObject:!0,_ExistingCells:!0},{_SceneEnvData:!0},{_IdOperatedObject:!0,_IdNewObject:!0,_IdPreviousObject:!1,_Attributes:!1,_GeometricalData:!1,_InfiniteGeometricalData:!1,_BatchCellIdPattern:!1},{_IdOperatedObject:!0,_GeometricalData:!1,_InfiniteGeometricalData:!1},{_IdNewObject:!0,_Attributes:!1,_GeometricalData:!1,_InfiniteGeometricalData:!1,_BatchCellIdPattern:!1},{_TextureUids:!0},{_VisuContext:!0}][e._type-2]:void 0;null!=r&&((t=new i)._type=e._type);for(let i in r){if(1==r[i]&&null==e[i]){t=void 0;break}null!=e[i]&&(t[i]=e[i])}return t},d.prototype.checkCompletedOperation=function(e){let t=e,r=[{_OperatedObject:!0,_IdNewObject:!0},{_OperatedObject:!0,_GeometricalData:!0,_IdNewObject:!0},{_OperatedObject:!0,_GeometricalData:!0,_IdPattern:!0},{_OperatedObject:!0,_CustomData:!0,_IdNewObject:!0},{_OperatedObject:!0,_OperandObject:!0},{_OperatedObject:!0,_OperandObject:!0},{_OperatedObject:!0,_OperandObject:!0},{_OperatedObject:!0,_OperandObject:!0},{},{_OperatedObject:!0,_CustomData:!0},{_OperatedObject:!0,_Groups:!0},{_OperatedObject:!1,_GraphicProperties:!0},{_IdNewObject:!0},{_OperatedObject:!0,_SemanticData:!0,_IdNewObject:!0},{_OperatedObject:!0,_SemanticData:!0},{_IdNewObject:!0,_SemanticData:!0},{_OperatedObject:!0,_Attributes:!0},{_OperatedObject:!0,_GeometricalData:!0},{_OperatedObject:!0,_OperandSubElements:!0},{_OperatedObject:!0,_OperandSubElements:!0},{_SceneEnvData:!0},{_OperatedObject:!0,_IdNewObject:!0},{_OperatedObject:!0},{_IdNewObject:!0},{_TextureUids:!0},{_VisuContext:!0}];if(e._type<2)t=void 0;else{let i=r[e._type-2];for(let r in i)if(1==i[r]&&null==e[r]){t=void 0;break}}return t},d.prototype.clear=function(){this.abort(),this._model&&this._model.clear(),this._model=new e},d}),define("DS/CSIViewModelWebProcessor/CSIVMClientManager",["DS/CSIViewModelWebInterfaces/CSIVMClientManagerList","DS/CSIViewModelWebProcessor/CSIVMClientProcessor","DS/CSICommandBinder/CSICommandBinder","DS/CSICommandBinder/CSIParameters","DS/CSIViewModelWebInterfaces/CSIVMClientRequestWithView","DS/CSIViewModelWebInterfaces/CSIVMClientTreeKey","DS/CSIViewModelWebInterfaces/CSIVMClientDelegateInterface","DS/CSIViewModelWebInterfaces/CSIVMClientParameterLabels"],function(e,t,r,i,a,n,o,s){"use strict";const d={newModelIdentification:!0,defaultAnimationLoop:!0,useQualityManager:!0,useViewPanel:!0,visuFaceMaterialsAsPBR:!0,multiViewer:!0};class l extends Error{}function c(r){Object.defineProperty(this,"_processor",{value:new t,configurable:!1,writable:!1}),this._impl=this,e.Add(this)}function p(e){if(null==this._cbOnCSICommunicationRequest)throw new Error("Not way to communicate with CSI.");const t=this._cbOnCSICommunicationRequest();if(null==e||null==e.name)throw new Error("Not a valid command");return null==e.parameters&&(e.parameters=new r.Parameters),null!=this._sceneID&&e.parameters.writeUint32(s.sceneID,this._sceneID),new Promise((r,i)=>{let a={};Object.assign(a,e,{version:1,onSuccess:r,onError:i}),t.call(a)}).then(t=>{if(!t.readBool("commandHasSucceeded"))throw new l(`Request ${e.name} with sceneID=${this._sceneID} returned RC=E_FAIL`);return e.onSuccess&&e.onSuccess(t),t}).catch(t=>{if(t instanceof r.Parameters)throw console.error(`Request ${e.name} with sceneID=${this._sceneID} has failed.`),e.onError&&e.onError(t),new Error(t.readString("error"));throw t})}function I(e,t){let r,i;if(t&&t.node&&t.serverNodeId)r=t.node,i=t.serverNodeId;else if(this._cbOnCSICommunicationRequest){const e=this._cbOnCSICommunicationRequest();e&&(r=e.node,i=e.serverNodeId)}return r&&i||console.error(`No way to communicate with CSI, cannot send request: ${e}`),new Promise(t=>{const n=new a({node:r,serverNodeId:i,command:{command:e,version:1,defaultCallback:t}},e=>this.getProcessor().onServerMessage(e));n.begin(),n.send(),n.end()}).then(e=>{const r=e.readBool("commandHasSucceeded");return r||console.error(`Request ${command} returned RC=E_FAIL`),t.onAnswer&&t.onAnswer({status:r}),e})}return c.prototype.OperationType={BEGIN:5,DO:6,END:7,EXECUTE:4,CANCEL:3},c.prototype.getModel=function(){return this._processor.getModel()},c.prototype.getProcessor=function(){return this._processor},c.prototype.setNotifier=function(e,t){this._processor.setNotifier(e,t),e===n.prototype.ViewType.View3D&&t instanceof o&&t.setManager(this)},c.prototype.getNotifier=function(e){return this._processor.getNotifier(e)},c.prototype.addCBOnVMUpdate=function(e){return this._processor.addCBOnVMUpdate(e)},c.prototype.addCBOnFatalError=function(e){return this._processor.addCBOnFatalError(e)},c.prototype.removeCBOnVMUpdate=function(e){return this._processor.removeCBOnVMUpdate(e)},c.prototype.createTreeKey=function(e,t,r){return this.getModel().getOrCreateTreeKey(e,t,r)},c.prototype.createCSIVMRequestWithView=function(e){let t=this.getProcessor();if(!(void 0===e||void 0===e.node||void 0===e.serverNodeId||void 0===e.command||e.command&&""===e.command.command))return new a(e,t.onServerMessage.bind(t))},c.prototype.reload=function(e,t=!1){if(e||(e={}),this._processor.clear(),null!=this._sceneID){let e=new r.Parameters;return e.writeBool("noBroadCast",t),p.bind(this)({name:"csiSceneServiceReloadFunction",parameters:e})}return I.bind(this)("CSIReloadViewCommand",e)},c.prototype.getTexturesFromUids=function(e){if(void 0!==e&&e.textureUids.length>0){this._onGetTextureFromUidsAnswer=e.onAnswer;let t=e.node,a=e.serverNodeId;if((void 0===t||void 0===a)&&void 0!==this._cbOnCSICommunicationRequest){let e=this._cbOnCSICommunicationRequest();e&&(t=e.node,a=e.serverNodeId)}if(void 0!==t&&void 0!==a){let n=new r.Parameters;void 0!==this._sceneID&&n.writeUint32(s.sceneID,this._sceneID),n.writeUint32Array(s.textureUids,e.textureUids);let o={destinationNodeId:a,command:"CSIGetTexturesFromUidsCommand",version:1,onAnswer:function(e){if(e instanceof i&&void 0!==this._onGetTextureFromUidsAnswer){let t={};t.status=e.readBool("commandHasSucceeded");let r=e.readObjectArray("textureBuffers","CSIViewModelNamedBinaryBuffer")||[],i=e.readUint32Array(s.textureUids)||[];if(t.buffers={},r.length!=i.length)t.status=!1;else for(let e=0;e<r.length;++e)t.buffers[i[e]]=r[e];this._onGetTextureFromUidsAnswer(t)}}.bind(this)};this.getTexturesRequest=t.createRequest(o),this.getTexturesRequest.send(void 0,n,void 0)}}},c.prototype.clearServerTextureCache=function(e){if(void 0!==e){this._onclearServerTextureCacheAnswer=e.onAnswer;let t=e.node,a=e.serverNodeId;if((void 0===t||void 0===a)&&void 0!==this._cbOnCSICommunicationRequest){let e=this._cbOnCSICommunicationRequest();e&&(t=e.node,a=e.serverNodeId)}if(void 0!==t&&void 0!==a){let e=new r.Parameters;void 0!==this._sceneID&&e.writeUint32(s.sceneID,this._sceneID);let n={destinationNodeId:a,command:"CSIClearTextureCacheCommand",version:1,onAnswer:function(e){if(e instanceof i&&void 0!==this._onclearServerTextureCacheAnswer){let t={};t.status=e.readBool("commandHasSucceeded"),this._onclearServerTextureCacheAnswer(t)}}.bind(this)};this.clearServerTextureCacheRequest=t.createRequest(n),this.clearServerTextureCacheRequest.send(void 0,e,void 0)}}},c.prototype.forceSend3DNoShowData=function(e){return null!=this._sceneID?p.bind(this)({name:"csiSceneServiceForceSend3DNoShowDataFunction"}):I.bind(this)("CSIForceSend3DNoShowDataViewCommand",e)},c.prototype.setCBOnCSICommunicationRequest=function(e){this._cbOnCSICommunicationRequest=e},c.prototype.CallbackOnEvent=function(e){if(void 0!==e){let t=e.readParameters("domains","Parameters");if(void 0!==t){let e=t.readParameters("view","Parameters");void 0!==e&&this._processor.onServerMessage(e)}}},c.prototype.setSceneID=function(e){if(null!=this._sceneID)throw new Error("FORBIDDEN SCENE ID MODIFICATION");if(isNaN(e))throw new Error("INVALID SCENE ID");if(null==this._cbOnCSICommunicationRequest)throw new Error("Not way to communicate with CSI.");const t=this._cbOnCSICommunicationRequest();this._subscribeID=t.subscribeWithSubject("CSISceneViewUpdate",e.toString(),this.CallbackOnEvent.bind(this)),this._sceneID=e},c.prototype.resetSceneID=function(){if(null==this._cbOnCSICommunicationRequest)throw new Error("NO CSI COMMUNICATION REQUEST");return this._cbOnCSICommunicationRequest().unsubscribe(this._subscribeID),p.bind(this)({name:"csiSceneServiceStopSynchroFunction"}).then(()=>{this._sceneID=void 0,this._subscribeID=void 0})},c.prototype.initScene=function(e){let t=new r.Parameters;return t.writeBool("specTree",e),p.bind(this)({name:"csiSceneServiceInitSynchroFunction",parameters:t})},c.prototype.initSpecTree=async function(){let e=0;for(;e++<5;){let e=new r.Parameters;try{return void await p.bind(this)({name:"csiSceneServiceInitSpecTreeFunction",parameters:e})}catch(e){if(!(e instanceof l))throw e;console.warn("InitSpecTree returned with rc=E_FAIL, try again later..."),await new Promise(e=>setTimeout(e,100))}}throw new Error("InitSpecTree failed after 5 attempts")},c.prototype.stopSpecTree=function(){return p.bind(this)({name:"csiSceneServiceStopSpecTreeFunction"})},c.createClientManager=function(){return new c},c.getViewerOptions=function(){return d},c.prototype.initializeViewer=function(e){e.displayPoints(!0),e.displaySurfacicPoints(!0),e.setPicking({activated:!0,trapSelection:!0,trapPrimitive:!1,primitive:!0}),e.setPrePicking({activated:!0,primitive:!0}),e.currentViewpoint.setDefaultController(!0,"COMBINED"),e.setSectionCapping(!0),e.setCSIViewModelManager(this),e.setFillXSOMode(!1)},c});