define("DS/egraph/utils",[],function(){"use strict";var t={};function e(t,e,i){return function(n,o,r){var a;switch(n&&(a=n[o]),typeof a){case"undefined":return r;case t:if(e(a))return a}throw new Error("opts."+o+" should be undefined or "+i)}}t.finite_number_or_nan_opt=e("number",function(t){return isFinite(t)||isNaN(t)}),t.finite_number_opt=e("number",function(t){return isFinite(t)},"a finite number"),t.pos_nonzero_number_opt=e("number",function(t){return isFinite(t)&&t>0},"a positive finite number"),t.pos_number_opt=e("number",function(t){return isFinite(t)&&t>=0},"a positive finite number"),t.pos_integer_opt=e("number",function(t){return isFinite(t)&&t>=0&&t===(0|t)},"a positive finite 32 bits integer number"),t.string_opt=e("string",function(){return!0},"a string"),t.obj_opt=e("object",function(t){return null!==t},"an object (but not null)"),t.function_opt=e("function",function(){return!0},"a function"),t.pos_number_or_nan_arg=function(t,e){if("number"!=typeof e||(isFinite(e)?e<0:!isNaN(e)))throw new Error(t+" should be either NaN, 0 or a finite positive number")},t.pos_number_arg=function(t,e){if("number"!=typeof e||!isFinite(e)||e<0)throw new Error(t+" should be a finite positive number or 0")},t.clamp=function(t,e,i){return t<e?e:t>i?i:t},t.distPt2HLine=function(t,e,i,n,o){return t<i?Math.abs(t-i)+Math.abs(e-o):t>n?Math.abs(t-n)+Math.abs(e-o):isNaN(t)?NaN:Math.abs(e-o)},t.distPt2VLine=function(e,i,n,o,r){return t.distPt2HLine(i,e,o,r,n)},t.addClass=function(t,e){var i,n,o=t.split(/ +/);for(i=0,n=o.length;i<n;++i)if(o[i]===e)return t;return""===o[n-1]?o[n-1]=e:o.push(e),o.join(" ")},t.removeClass=function(t,e){var i,n,o;for(o=(i=t.split(/ +/)).length,n=!1;o-- >0;)i[o]===e&&(n=!0,i.splice(o,1));return n?i.join(" "):t},t.containsClass=function(t,e){var i,n=t.split(/ +/);for(i=n.length;i-- >0;)if(n[i]===e)return!0;return!1},t.classListAdd=function(e,i){e.classList?e.classList.add(i):e instanceof SVGElement?e.className.baseVal=t.addClass(e.className.baseVal,i):e.className=t.addClass(e.className,i)},t.classListRemove=function(e,i){e.classList?e.classList.remove(i):e instanceof SVGElement?e.className.baseVal=t.removeClass(e.className.baseVal,i):e.className=t.removeClass(e.className,i)},t.classListContains=function(e,i){return e.classList?e.classList.contains(i):e instanceof SVGElement?t.containsClass(e.className.baseVal,i):t.containsClass(e.className,i)},t.inherit=function(t,e){t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1}})},t.mix=function(t,e){var i;for(i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},t.applyMixin=function(t,e){if("function"!=typeof t||"function"!=typeof e)throw new Error("parameters must be constructors (i.e. functions)");var i,n;i=e.prototype,n=t.prototype,Object.keys(i).forEach(function(t){Object.defineProperty(n,t,Object.getOwnPropertyDescriptor(i,t))})},t.closestSide=function(e,i,n){var o,r,a,s,h,l,p=[t.distPt2HLine(i,n,e.actualLeft,e.actualLeft+e.actualWidth,e.actualTop),t.distPt2HLine(i,n,e.actualLeft,e.actualLeft+e.actualWidth,e.actualTop+e.actualHeight),t.distPt2VLine(i,n,e.actualLeft,e.actualTop,e.actualTop+e.actualHeight),t.distPt2VLine(i,n,e.actualLeft+e.actualWidth,e.actualTop,e.actualTop+e.actualHeight)];for(o=p[0],r=0,a=1;a<4;++a)p[a]<o&&(o=p[a],r=a);return r<2?(s=i-e.actualLeft,e.actualWidth):(s=n-e.actualTop,e.actualHeight),r<2?(h=s+e.actualLeft,l=0===r?e.actualTop:e.actualTop+e.actualHeight):(l=s+e.actualTop,h=2===r?e.actualLeft:e.actualLeft+e.actualWidth),{v:o,idx:r,offset:s,0:h,1:l}},t.isInNode=function(t,e,i,n){return n=Number(n),e>=t.actualLeft-n&&e<=t.actualLeft+t.actualWidth+n&&i>=t.actualTop-n&&i<=t.actualTop+t.actualHeight+n},t.areIntervalsOverlapping=function(t,e,i,n){return n>=t&&i<=e},t.isIntervalIncluded=function(t,e,i,n){return i<=t&&e<=n},t.areRectsOverlapping=function(e,i,n,o,r,a,s,h){var l;return e>n&&(l=e,e=n,n=l),i>o&&(l=i,i=o,o=l),r>s&&(l=r,r=s,s=l),a>h&&(l=a,a=h,h=l),t.areIntervalsOverlapping(e,n,r,s)&&t.areIntervalsOverlapping(i,o,a,h)},t.isSegmentIntersectingRect=function(t,e,i,n,o,r,a,s){function h(o){return(t*(n-o)-i*(e-o))/(n-e)}var l,p,c,u,d;return t>i&&(t=-t,i=-i,o=-o,a=-a),e>n&&(e=-e,n=-n,r=-r,s=-s),o>a&&(l=o,o=a,a=l),r>s&&(l=r,r=s,s=l),c=e<r?-1:e>s?1:0,u=i<o?-1:i>a?1:0,d=n<r?-1:n>s?1:0,1!==(p=t<o?-1:t>a?1:0)&&(0===p?1!==c&&(0===c||(0===u?d>=0:-1!==d&&h(r)<=a)):-1===p?1!==c&&(0===c?0===d?u>=0:-1!==u&&h(s)>=o:-1!==u&&(-1!==d&&(0===d?0===u||h(r)<=a:0===u?h(s)>=o:!(h(r)>a||h(s)<o)))):void 0)};var i=Math.pow(2,-53);function n(t,e,i,n,o){var r=1-o,a=r*r,s=o*o;return r*a*t+3*a*o*e+3*r*s*i+o*s*n}t.isBezierIntersectingRect=function(e,n,o,r,a,s,h,l,p,c,u,d,g){function f(e,n,o,r,a,s,h,l,y,m,v){var w,b,E,P,D,S,T,L;return!!t.areRectsOverlapping(e,n,h,l,p,c,u,d)&&(!!t.isRectIncluded(e,n,h,l,p,c,u,d)||(y<=i||Math.abs(e-h)<=g&&Math.abs(n-l)<=g||(f(E=e,P=n,D=.5*(E+o),S=.5*(P+r),T=.5*(D+(w=.5*(o+a))),L=.5*(S+(b=.5*(r+s))),e=.5*(T+(o=.5*(w+(a=.5*(a+h))))),n=.5*(L+(r=.5*(b+(s=.5*(s+l))))),y*=.5,m,v+1)||f(e,n,o,r,a,s,h,l,y,y+m,v+1))))}function y(t){var i,p,c=1-t;e=c*(C=c*(O=c*(_=e)+t*o)+t*(i=c*o+t*a))+t*(o=c*i+t*(a=c*a+t*h)),n=c*(N=c*(V=c*(M=n)+t*r)+t*(p=c*r+t*s))+t*(r=c*p+t*(s=c*s+t*l))}var m,v,w,b,E,P,D,S,T,L,_,M,O,V,C,N,R,x,G,k,F,B,A,H,I;if(D=Math.min(e,o,a,h),S=Math.max(e,o,a,h),T=Math.min(n,r,s,l),L=Math.max(n,r,s,l),!t.areRectsOverlapping(D,T,S,L,p,c,u,d))return!1;if(void 0===g&&(g=.5),k=r-n,F=s-r,B=l-s,I=(x=a-o)*x-(G=h-a)*(R=o-e),A=R-2*x+G,m=((H=R-x)-Math.sqrt(I))/A,v=(H+Math.sqrt(I))/A,I=F*F-B*k,A=k-2*F+B,w=((H=k-F)-Math.sqrt(I))/A,b=(H+Math.sqrt(I))/A,(v<m||isNaN(m))&&(E=v,v=m,m=E),(w<v||isNaN(v))&&(E=w,w=v,E<m||isNaN(m)?(v=m,m=E):v=E),(b<w||isNaN(w))&&(E=b,b=w,E<v||isNaN(v)?(w=v,E<m||isNaN(m)?(v=m,m=E):v=E):w=E),P=0,m>0&&m<1){if(y((m-P)/(1-P)),f(_,M,O,V,C,N,e,n,m-P,P,0))return!0;P=m}if(v>0&&v<1){if(y((v-P)/(1-P)),f(_,M,O,V,C,N,e,n,v-P,P,0))return!0;P=v}if(w>0&&w<1){if(y((w-P)/(1-P)),f(_,M,O,V,C,N,e,n,w-P,P,0))return!0;P=w}if(b>0&&b<1){if(y((b-P)/(1-P)),f(_,M,O,V,C,N,e,n,b-P,P,0))return!0;P=b}return f(e,n,o,r,a,s,h,l,1-P,P,0)},t.isSegmentInRect=function(e,i,n,o,r,a,s,h){return t.isRectIncluded(e,i,n,o,r,a,s,h)},t.isBezierInRect=function(e,i,o,r,a,s,h,l,p,c,u,d){function g(t){return!(t>0&&t<1)||g(n(e,o,a,h,t),n(i,r,s,l,t))}var f,y,m,v,w,b,E,P,D;return!(!t.isPointInRect(e,i,p,c,u,d)||!t.isPointInRect(h,l,p,c,u,d))&&(!(!t.isPointInRect(o,r,p,c,u,d)||!t.isPointInRect(a,s,p,c,u,d))||(v=r-i,w=s-r,b=l-s,D=(y=a-o)*y-(m=h-a)*(f=o-e),E=f-2*y+m,!!g(((P=f-y)-Math.sqrt(D))/E)&&(!!g((P+Math.sqrt(D))/E)&&(D=w*w-b*v,E=v-2*w+b,!!g(((P=v-w)-Math.sqrt(D))/E)&&!!g((P+Math.sqrt(D))/E)))))},t.isRectIncluded=function(e,i,n,o,r,a,s,h){var l;return e>n&&(l=e,e=n,n=l),i>o&&(l=i,i=o,o=l),r>s&&(l=r,r=s,s=l),a>h&&(l=a,a=h,h=l),t.isIntervalIncluded(e,n,r,s)&&t.isIntervalIncluded(i,o,a,h)},t.isPointInRect=function(t,e,i,n,o,r){var a;return i>o&&(a=i,i=o,o=a),n>r&&(a=n,n=r,r=a),i<=t&&t<=o&&n<=e&&e<=r},t.nb2px=function(t,e){return t.toFixed(e)+"px"};var o={38:[38,97,109,112,59],60:[38,108,116,59],62:[38,103,116,59],39:[38,35,51,57,59],34:[38,113,117,111,116,59]};t.xmlQuote=function(t,e,i){var n,r,a,s,h,l,p;for(e=e||0,i=void 0!==i?Math.min(i,t.length):t.length,s=new Array(i-e),n=e,h=0;n<i;++n)if((l=t.charCodeAt(n))<9||l>9&&l<10||l>10&&l<13||l>13&&l<32||l>55295&&l<57344||l>65533&&l<65536)s[h++]=65533;else if(p=o[l])for(r=0,a=p.length;r<a;++r)s[h++]=p[r];else s[h++]=l;return String.fromCharCode.apply(null,s)},t.reframeViewpoint=function(e,i,n){function o(){return n&&void 0!==n.defaultVpt?n.defaultVpt:[0,0,1]}function r(t){return isFinite(t)&&t>=0}function a(t){return"number"==typeof t}function s(t,e,i,n,o,r){return t<0?r-e*Math.min(i,n):t>0?o-r-e*Math.max(i,n):.5*(o-e*(i+n))}var h,l,p,c,u,d,g,f,y,m,v,w,b,E,P,D,S,T,L,_;if(h=t.pos_number_opt(n,"padding",0),l=t.pos_nonzero_number_opt(n,"maxScale",1/0),p=t.pos_nonzero_number_opt(n,"minScale",Number.MIN_VALUE),c=t.pos_number_opt(n,"minSize",1),u=t.finite_number_opt(n,"horizontal",0),d=t.finite_number_opt(n,"vertical",0),g=t.pos_integer_opt(n,"aliasing",void 0),l<p)throw new Error("opts.maxScale < opts.minScale");if(!e||2!==e.length)throw new Error("size should be an array of length 2");if(!r(e[0])||!r(e[1]))throw new Error("size must contain two finite positive numbers");if(e[0]<c||e[1]<c)return o();if(E=Math.min(h,.5*(e[0]-c)),P=Math.min(h,.5*(e[1]-c)),i instanceof t.BoundingRect)m=i.xmin,v=i.xmax,w=i.ymin,b=i.ymax;else if(!(i&&4===i.length&&(m=i[0],v=i[1],w=i[2],b=i[3],a(m)&&a(v)&&a(w)&&a(b))))throw new Error("bounds should be an instance of BoundingRect or an array of 4 numbers");return D=Math.abs(v-m),S=Math.abs(b-w),isFinite(D)&&isFinite(S)?(T=p===l?p:Math.max(p,Math.min(l,(e[0]-2*E)/D,(e[1]-2*P)/S)),isFinite(T)?(L=s(u,T,m,v,e[0],E),_=s(d,T,w,b,e[1],P),void 0!==g&&(f=Math.pow(2,g),y=Math.pow(2,-g),L=Math.round(f*L)*y,_=Math.round(f*_)*y),[L,_,T]):o()):o()},t.changeViewpointScale=function(t,e,i,n){return n?[t[0]+(t[2]-e)*i[0],t[1]+(t[2]-e)*i[1],e]:[i[0]-e*(i[0]-t[0])/t[2],i[1]-e*(i[1]-t[1])/t[2],e]},t.calculateNewScale=function(t,e,i){let n=t*Math.pow(2,e);if(i){const o=e?Math.abs(e)/e:1;if(i[0]&&t===i[0]&&1===o||i[1]&&t===i[1]&&-1===o){let e,o=1/i[2]*Math.log(Math.abs(t))/Math.log(2);e=o>=0?Math.floor(o):Math.ceil(o),n=Math.pow(2,i[2]*e)}let r;i[0]&&n<Math.abs(i[0])&&(r=i[0]),i[1]&&n>Math.abs(i[1])&&(r=i[1]),r&&(n=r)}return n},t.incViewpointScale=function(e,i,n,o,r){var a=t.calculateNewScale(e[2],i,r);return t.changeViewpointScale(e,a,n,o)},t.relativeToElement=function(t,e,i){var n;return n=i.getBoundingClientRect(),[t-Math.floor(n.left),e-Math.floor(n.top)]},t.relativeToViewpoint=function(e,i,n,o){var r;return(r=t.relativeToElement(e,i,n))[0]-=o[0],r[1]-=o[1],r[0]/=o[2],r[1]/=o[2],r};var r=/\?([^#]*)(#|)/;t.setQuery=function(t,e,i){e=encodeURIComponent(e),i=void 0!==i?encodeURIComponent(i):"";var n,o,a=r.exec(t);if(a)n=t.substring(0,a.index),o=t.substring(a.index+a[0].length-a[2].length);else{var s=t.indexOf("#");-1===s?(n=t,o=""):(n=t.substring(0,s),o=t.substring(s))}var h,l,p=a?a[1].split("&"):[],c=e.length;for(h=0,l=p.length;h<l;++h){var u=p[h];if(u.substring(0,c)===e&&(u.length===c||"="===u.charAt(c)))break}return i.length?p[h]=e+"="+i:p[h]=e,n+"?"+p.join("&")+o},t.getQuery=function(t,e){var i,n,o,a,s,h,l,p,c,u;if(e=e&&encodeURIComponent(e),n=(i=r.exec(t))?i[1].split("&"):[],!e){for(l={},a=0,s=n.length;a<s;++a)-1!==(p=(h=n[a]).indexOf("="))?(c=h.substring(0,p),u=h.substring(p+1)):(c=h,u=""),l[decodeURIComponent(c)]=decodeURIComponent(u);return l}for(o=e.length,a=0,s=n.length;a<s;++a)if((h=n[a]).substring(0,o)===e&&(h.length===o||"="===h.charAt(o)))return decodeURIComponent(h.substring(o+1))},t.touchCompatRemoveChild=function(t,e){t.removeChild(e)},t.BoundingRect=function(){this.xmin=NaN,this.xmax=NaN,this.ymin=NaN,this.ymax=NaN,this.xminObj=null,this.xmaxObj=null,this.yminObj=null,this.ymaxObj=null},t.BoundingRect.prototype.isModifiedBy=function(t,e,i,n,o){return e<this.xmin||i>this.xmax||n<this.ymin||o>this.ymax||(e>this.xmin&&this.xminObj===t||i<this.xmax&&this.xmaxObj===t||n>this.ymin&&this.yminObj===t||o<this.ymax&&this.ymaxObj===t||(!!(!isNaN(e)&&isNaN(this.xmin)||!isNaN(i)&&isNaN(this.xmax)||!isNaN(n)&&isNaN(this.ymin)||!isNaN(o)&&isNaN(this.ymax))||!!(isNaN(e)&&this.xminObj===t||isNaN(i)&&this.xmaxObj===t||isNaN(n)&&this.yminObj===t||isNaN(o)&&this.ymaxObj===t)))},t.BoundingRect.prototype.isValid=function(){return isFinite(this.xmin)&&isFinite(this.xmax)&&isFinite(this.ymin)&&isFinite(this.ymax)},t.BoundingRect.prototype.reset=function(){this.xmin=NaN,this.xmax=NaN,this.ymin=NaN,this.ymax=NaN,this.xminObj=null,this.xmaxObj=null,this.yminObj=null,this.ymaxObj=null},t.BoundingRect.prototype.update=function(t,e,i,n,o){(e<this.xmin||isNaN(this.xmin))&&(this.xmin=e,this.xminObj=t),(i>this.xmax||isNaN(this.xmax))&&(this.xmax=i,this.xmaxObj=t),(n<this.ymin||isNaN(this.ymin))&&(this.ymin=n,this.yminObj=t),(o>this.ymax||isNaN(this.ymax))&&(this.ymax=o,this.ymaxObj=t)},t.BoundingRect.prototype.toString=function(){var t;function e(e){var i;return i=t[e],isNaN(i)?String(i):String(i)+"("+t[e+"Obj"]+")"}return t=this,"{ xmin: "+e("xmin")+", xmax: "+e("xmax")+", ymin: "+e("ymin")+", ymax: "+e("ymax")+" }"};var a=/[^A-Za-z](Trident|MSIE)[^A-Za-z]/i.test(navigator.userAgent);return t.isIE=function(){return a},t.newNotImplError=function(){return new Error("not implemented")},t.hasClass=function(t,e){return(" "+t.className+" ").replace(/[\n\t]/g," ").indexOf(" "+e+" ")>-1},t.firstParentWithClass=function(e,i){var n=e;if(n)return(" "+n.className+" ").replace(/[\n\t]/g," ").indexOf(" "+i+" ")>-1?n:t.firstParentWithClass(n.parentNode,i)},t}),define("egraph/utils",["DS/egraph/utils"],function(t){return t}),define("DS/egraph/core",["DS/egraph/utils"],function(t){"use strict";var e,i={};function n(){}function o(t){console.log(new Error(t).stack)}function r(t,i){return function(){return e("Use deprecated property: "+i),t.apply(this,arguments)}}!function(){function t(){e=r?o:n}var r=!1;Object.defineProperty(i,"logDeprecatedAccesses",{get:function(){return r},set:function(e){r=Boolean(e),console.log("egraph/core.logDeprecatedAccesses "+(r?"enabled":"disabled")),t()},enumerable:!0,configurable:!1}),t()}(),i.Observable=function(){},i.Observable.prototype.dispatch=function(t){var e,i,n;if("string"!=typeof t.type)throw new Error("No .type string property on the event");if(t.target=this,this.listeners&&this.listeners.hasOwnProperty(t.type)&&(e=this.listeners[t.type]).length>=1)for(i=0,n=e.length;i<n;++i)e[i].call(null,t)},i.Observable.prototype.addListener=function(t,e){if("function"!=typeof e)throw new Error("Listener must be a function");this.listeners||(this.listeners={}),this.listeners[t]=(this.listeners.hasOwnProperty(t)&&this.listeners[t]||[]).concat(e)},i.Observable.prototype.removeListener=function(t,e){var i,n;return!(!this.listeners||!this.listeners.hasOwnProperty(t)||-1===(i=(n=this.listeners[t]).indexOf(e)))&&(this.listeners[t]=n.slice(0,i).concat(n.slice(i+1)),!0)};var a,s=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];function h(t){Object.defineProperty(t.prototype,"name",{configurable:!1,enumerable:!0,get:r(function(){return i.fmtPath(this.path)},"name")})}i.fmtPath=function(t){var e,i,n,o,r,a,h,l;for(n=t.length,e=new Array(n),i=0;i<n;++i){for(h=null,o=0,r=(a=t[i]).length;o<r;++o)(l=a.charCodeAt(o))<32||37===l||127===l?(h||(h=a.substring(0,o)),h+="%",h+=s[l>>>4],h+=s[15&l]):h&&(h+=String.fromCharCode(l));e[i]=h||a}return e.join(".")},i.UpdatedNotif=function(t,e){this.path=t,this.oldValue=e},i.UpdatedNotif.prototype.type="updated",h(i.UpdatedNotif),i.UpdatedNotif.prototype.object=null,i.UpdatedNotif.prototype.toString=function(){var t;return t=this.object?this.object.toString():"null",'{ type: "'+this.type+'", object: '+t+", path: "+i.fmtPath(this.path)+", oldValue: "+this.oldValue+" }"},i.RemovedNotif=function(t,e,i){this.path=t,this.child=e,this.oldNext=i},i.RemovedNotif.prototype.type="removed",i.RemovedNotif.prototype.object=null,h(i.RemovedNotif),i.RemovedNotif.prototype.toString=function(){var t,e,n;return t=this.object?this.object.toString():"null",e=this.child?this.child.toString():"null",n=this.oldNext?this.oldNext.toString():"null",'{ type: "'+this.type+'", object: '+t+", path: "+i.fmtPath(this.path)+", child: "+e+", oldNext: "+n+" }"},i.AddedNotif=function(t,e,i){this.path=t,this.child=e,this.next=i},i.AddedNotif.prototype.type="added",h(i.AddedNotif),i.AddedNotif.prototype.object=null,i.AddedNotif.prototype.toString=function(){var t,e,n;return t=this.object?this.object.toString():"null",e=this.child?this.child.toString():"null",n=this.next?this.next.toString():"null",'{ type: "'+this.type+'", object: '+t+", path: "+i.fmtPath(this.path)+", child: "+e+", next: "+n+" }"},i.MovedNotif=function(t,e,i,n){this.path=t,this.child=e,this.next=i,this.oldNext=n},i.MovedNotif.prototype.type="moved",h(i.MovedNotif),i.MovedNotif.prototype.object=null,i.MovedNotif.prototype.toString=function(){var t,e,n,o;return t=this.object?this.object.toString():"null",e=this.child?this.child.toString():"null",n=this.next?this.next.toString():"null",o=this.oldNext?this.oldNext.toString():"null",'{ type: "'+this.type+'", object: '+t+", path: "+i.fmtPath(this.path)+", child: "+e+", next: "+n+", oldNext: "+o+" }"},a=!1,Object.defineProperty(i,"logInvalidAccesses",{get:function(){return a},set:function(t){a=Boolean(t),console.log("egraph/core.logInvalidAccesses "+(a?"enabled":"disabled")),i.Node=a?m:y,i.BorderCstr=a?E:b,i.Connector=a?D:P,i.Edge=a?T:S},enumerable:!0,configurable:!1}),i.ObservableData=function(){},i.ObservableData.prototype.set=function(t,e){this.setPath([t],e)},i.ObservableData.prototype.setPath=function(t,e){var n,o,r,a,s,h;for(s=t.length,o=this,a=0;o&&a<s-1;++a)o=o[n=t[a]];if(!o)throw new Error("Can't find "+n+" in interpretation of path "+i.fmtPath(t));if(e!==(r=o[h=t[s-1]])){l+=1;try{o[h]=e}finally{l-=1}this.notify(new i.UpdatedNotif(t,r))}},i.ObservableData.prototype.multiset=function(){var t,e,n;if(1&(e=arguments.length))throw new Error("odd number of arguments");i.ObservableData.lock();try{for(t=0;t<e;t+=2)"string"==typeof(n=arguments[t])?this.set(n,arguments[t+1]):this.setPath(n,arguments[t+1])}finally{i.ObservableData.unlock()}};var l=0;i.ObservableData.lockCount=0,i.ObservableData.postCallsCBs=null,i.ObservableData.addPostCallsCB=function(t){if("function"!=typeof t)throw new Error("Callback must be a function");i.ObservableData.postCallsCBs||(i.ObservableData.postCallsCBs=[]),i.ObservableData.postCallsCBs.push(t)},i.ObservableData.lock=function(){i.ObservableData.lockCount?++i.ObservableData.lockCount:i.ObservableData.lockCount=1},i.ObservableData.unlock=function(){var t,e,n,o,r;if(i.ObservableData.lockCount<=0)throw new Error("Illage State: extraneous unlock of object");if(1===i.ObservableData.lockCount)try{for(;i.ObservableData.pendingCalls;){for(t=i.ObservableData.pendingCalls,i.ObservableData.pendingCalls=null,o=t.length,n=0;n<o;++n)t[n].func.__pendingChanges__=null;for(n=0;n<o;++n)(e=t[n]).func(e.arg)}}finally{for(i.ObservableData.lockCount=0;i.ObservableData.postCallsCBs;)for(r=i.ObservableData.postCallsCBs,i.ObservableData.postCallsCBs=null,n=0,o=r.length;n<o;++n)if(r[n](),i.ObservableData.lockCount)throw new Error("A change callback still holds a lock")}else--i.ObservableData.lockCount},i.ObservableData.prototype.notify=function(t){var e,n,o,r,a;if("string"!=typeof t.type)throw new Error("Illegal Argument: no type field in change notification");if(t.object=this,r=this.dataListeners)if(i.ObservableData.lockCount)for(e=0,n=r.length;e<n;++e)(a=r[e]).__pendingChanges__||(i.ObservableData.pendingCalls||(i.ObservableData.pendingCalls=[]),a.__pendingChanges__=[],i.ObservableData.pendingCalls.push({func:a,arg:a.__pendingChanges__})),a.__pendingChanges__.push(t);else{i.ObservableData.lock();try{for(o=[t],e=0,n=r.length;e<n;++e)r[e](o)}finally{i.ObservableData.unlock()}}},i.ObservableData.prototype.addChangeListener=function(t){if("function"!=typeof t)throw new Error("Listener must be a function");this.dataListeners=(this.dataListeners||[]).concat(t)},i.ObservableData.prototype.removeChangeListener=function(t){var e;return!(!this.dataListeners||-1===(e=this.dataListeners.indexOf(t)))&&(this.dataListeners=this.dataListeners.slice(0,e).concat(this.dataListeners.slice(e+1)),!0)},i.inPathSet=function(t,e){var i,n;for(n=arguments.length,i=1;i<n&&!0!==t;++i){if(!t.hasOwnProperty(arguments[i]))return!1;t=t[arguments[i]]}return Boolean(t)},i.Type={EGRAPH:0,NODE:1,GROUP:2,CONNECTOR:3,EDGE:4},i.Type2Str=["egraph","node","group","connector","edge"],i.Selectable=function(){this.nextSel=null,this.prevSel=null},Object.defineProperty(i.Selectable.prototype,"selected",{get:function(){return this.isSelected()},enumerable:!0}),i.Selectable.prototype.isSelected=function(){var t;return!!(t=this.getGraph())&&t.isSelected(this)},i.Element=function(){this.mark=void 0,this.hidden=!1},i.Element.prototype.remove=function(t){throw utils.newNotImplError()},i.Element.prototype.getGraph=function(){throw utils.newNotImplError()},i.Element.prototype.getParent=function(){throw utils.newNotImplError()},i.MarksScope=function(){if(p)throw new Error("can't have two MarksScope opened at the same time!");p=this,this.markedObjects=[]};var p=null;function c(t,e,i,n,o,a){function s(t){var s,l,p,c,u;return t.hasOwnProperty(h)||(l=o?function(){return-t[i]}:function(){return t[i]},p=a?function(e){t[n]=-e}:function(e){t[n]=e},c=a?function(){return-t[n]}:function(){return t[n]},s=r(s=o?function(e){t[i]=-e}:function(e){t[i]=e},e),p=r(p,e),l=r(l,e),c=r(c,e),u=[],Object.defineProperties(u,{0:{set:s,get:l,enumerable:!0,configurable:!1},1:{set:p,get:c,enumerable:!0,configurable:!1}}),Object.defineProperty(t,h,{value:u,writable:!1,enumerable:!1,configurable:!1})),t[h]}var h;h="fake-vector:"+e,Object.defineProperty(t.prototype,e,{enumerable:!0,configurable:!1,get:r(function(){return s(this)},e),set:r(function(t){var e,i,n;for(n=s(this),e=0,i=Math.min(t.length,2);e<i;++e)n[e]=t[e]},e)})}function u(t,e){var n,o,r,a;for(a=e.length,o=t,r=0;o&&r<a-1;++r)o=o[n=e[r]];if(!o)throw new Error("Can't find "+n+" in interpretation of path "+i.fmtPath(e));return o}function d(t,e,i,n){var o,a,s,h;if(("object"!=typeof t||!t)&&"function"!=typeof t)throw new Error("prototype is not an object or is null");if("string"!=typeof e)throw new Error("p is not a string");if(!Array.isArray(n)||n.some(function(t){return"string"!=typeof t})||0===n.length)throw new Error("path must be a non-empty array of strings");if(void 0===i)h=function(){return this};else if("object"==typeof i&&i)h=function(){return i};else{if("function"!=typeof i)throw new Error("dst is not undefined or a function or an non-null object");h=i}s=n[n.length-1],o=r(function(t){u(h.call(this),n)[s]=t},e),a=r(function(){return u(h.call(this),n)[s]},e),Object.defineProperty(t,e,{enumerable:!0,configurable:!1,get:a,set:o})}function g(t,e){function i(){t.apply(this,arguments),function(t,e){function i(e){var i;i=t[e],Object.defineProperty(t,e,{get:function(){return i},set:function(t){l||o("Not authorized access"),i=t},enumerable:!0,configurable:!1})}var n,r;for(n=1,r=arguments.length;n<r;++n)i(arguments[n])}.apply(void 0,[this].concat(n))}var n;return n=Array.prototype.slice.call(arguments,1),i.prototype=t.prototype,i}i.MarksScope.prototype.setMark=function(t,e){if(!t.hasOwnProperty("mark"))throw new Error("elt is not an Element");if(void 0===e)throw new Error("new value can't be undefined");return void 0===t.mark&&this.markedObjects.push(t),t.mark=e,e},i.MarksScope.prototype.dispose=function(){var t,e;if(p!==this)throw new Error("can't dispose a not opened scope!");for(p=null,t=0,e=this.markedObjects.length;t<e;++t)this.markedObjects[t].mark=void 0;this.markedObjects.length=0},i.List=function(){this.first=null,this.last=null},i.List.prototype.addLast=function(t){return t.prev=this.last,this.last?this.last.next=t:this.first=t,this.last=t,t},i.List.prototype.remove=function(t){t.prev?t.prev.next=t.next:this.first=t.next,t.next?t.next.prev=t.prev:this.last=t.prev,t.prev=t.next=null},i.List.prototype.insertBefore=function(t,e){if(e===t)throw new Error("Can't insert an element before itself");(t.next||t.prev||this.first===t)&&this.remove(t),e?(e.prev?e.prev.next=t:this.first=t,t.prev=e.prev,e.prev=t,t.next=e):this.addLast(t)},i.SelectionList=function(){this.first=null,this.last=null},i.SelectionList.prototype.addLast=function(t){return t.prevSel=this.last,this.last?this.last.nextSel=t:this.first=t,this.last=t,t},i.SelectionList.prototype.remove=function(t){t.prevSel?t.prevSel.nextSel=t.nextSel:this.first=t.nextSel,t.nextSel?t.nextSel.prevSel=t.prevSel:this.last=t.prevSel,t.prevSel=t.nextSel=null},i.GraphView=function(){this.viewKey=void 0,this.gr=null},i.GraphView.prototype.oninit=function(t,e){if(this.viewKey||this.gr)throw new Error("Can't initialize twice!");this.viewKey=e,this.gr=t},i.GraphView.prototype.onupdate=function(t,e){},i.GraphView.prototype.rectanglePick=function(t,e,i,n,o){throw utils.newNotImplError()},i.PathCmd={M:0,L:1,C:2},i.makeRewriter=d;var f=[];i.PropertyFlag={VIEW:1,MODEL:2,RECURSIVE:4},i.Nodal=function(t=""){this.gr=null,this.parent=null,this.next=null,this.prev=null,this.left=0,this.top=0,this.originLeft=NaN,this.originTop=NaN,this.actualLeft=NaN,this.actualTop=NaN,this.actualWidth=NaN,this.actualHeight=NaN,this.children=new i.List,this.childrenHidden=!1,this.id=t},i.Nodal.prototype.internalRecursiveUpdate=function(){this.multiset("originLeft",this.parent.originLeft+this.left,"originTop",this.parent.originTop+this.top),this.updateCollapsedFlag()},i.Nodal.prototype.updateCollapsedFlag=function(){throw new Error("Not implemented!")},i.Nodal.prototype.getGraph=function(){return this.gr},i.Nodal.prototype.getParent=function(){return this.parent},i.Nodal.prototype.remove=function(t){this.parent&&this.parent.removeNode(this,t)},i.Nodal.prototype.bringToFront=function(){var t;for(t=this;t.parent;t=t.parent)t.parent.insertNodeBefore(t,null)},i.Nodal.prototype.appendConnector=function(t){this.insertConnectorBefore(t,null)},i.Nodal.prototype.insertConnectorBefore=function(t,e){var n,o;if(t.external&&(t=t.external),e&&e.external&&(e=e.external),this.__graph__&&(this.__graph__.registerNewElement(t),t.internal&&this.__graph__.registerNewElement(t.internal)),e&&e.node!==this)throw new Error("nextConnector not in node");if(e===t)throw new Error("can't insert a connector before itself");if(t.node){if(t.node!==this)throw new Error("connector already in an other node");if(t.internal){if(t.next!==t.internal)throw new Error("invalid internal state");o=t.internal.next,this.children.remove(t.internal)}else o=t.next;this.children.remove(t),n=!0}else n=!1;this.children.insertBefore(t,e),t.internal&&this.children.insertBefore(t.internal,e),t.node=this,t.internal&&(t.internal.node=this),i.ObservableData.lock();try{n?(t.internal&&this.notify(new i.MovedNotif(["children"],t.internal,null,o)),this.notify(new i.MovedNotif(["children"],t,null,o))):(this.notify(new i.AddedNotif(["children"],t,null)),t.internal&&this.notify(new i.AddedNotif(["children"],t.internal,null)))}finally{i.ObservableData.unlock()}},i.Nodal.prototype.removeConnector=function(t,e){function n(t){for(;t.children.first;)t.children.first.ref.remove(e);o.gr&&o.gr.removeFromSelection(t),o.children.remove(t),t.node=null,o.notify(new i.RemovedNotif(["children"],t,r))}var o,r;if(o=this,t.external&&(t=t.external),t.node!==this)throw new Error("connector is not in this group");i.ObservableData.lock();try{if(t.internal){if(t.next!==t.internal)throw new Error("illegal internal state");r=t.internal.next,n(t.internal)}else r=t.next;n(t)}finally{i.ObservableData.unlock()}},i.Node=function(t,e,n=""){i.Element.call(this),i.ObservableData.call(this),i.Nodal.call(this,n),i.Selectable.call(this),this.views={main:t||null},this.data=e||null,this.width=0,this.height=0},t.applyMixin(i.Node,i.Element),t.applyMixin(i.Node,i.ObservableData),t.applyMixin(i.Node,i.Nodal),t.applyMixin(i.Node,i.Selectable);var y=i.Node,m=g(i.Node,"width","height","left","top");function v(t){return function(){var e;return e=t,this.data&&"function"==typeof this.data.toString&&this.data.toString!==Object.prototype.toString&&(e+="<"+this.data.toString()+">"),e}}d(i.Node.prototype,"view",void 0,["views","main"]),c(i.Node,"pos","left","top"),c(i.Node,"dim","width","height"),f[i.Type.NODE]=Object.freeze({left:i.PropertyFlag.VIEW|i.PropertyFlag.MODEL|i.PropertyFlag.RECURSIVE,top:i.PropertyFlag.VIEW|i.PropertyFlag.MODEL|i.PropertyFlag.RECURSIVE,width:i.PropertyFlag.VIEW|i.PropertyFlag.MODEL,height:i.PropertyFlag.VIEW|i.PropertyFlag.MODEL,actualLeft:i.PropertyFlag.VIEW,actualTop:i.PropertyFlag.VIEW,actualWidth:i.PropertyFlag.VIEW,actualHeight:i.PropertyFlag.VIEW,hidden:i.PropertyFlag.VIEW,children:i.PropertyFlag.VIEW}),i.Node.prototype.customPropertyFlags=null,i.Node.prototype.set=function(t,e){if("pos"===t){i.ObservableData.lock();try{i.ObservableData.prototype.set.call(this,"left",e[0]),i.ObservableData.prototype.set.call(this,"top",e[1])}finally{i.ObservableData.unlock()}}else if("dim"===t){i.ObservableData.lock();try{i.ObservableData.prototype.set.call(this,"width",e[0]),i.ObservableData.prototype.set.call(this,"height",e[1])}finally{i.ObservableData.unlock()}}else i.ObservableData.prototype.set.apply(this,arguments)},i.Node.prototype.toString=v("Node"),i.Node.prototype.type=i.Type.NODE,i.Node.prototype.internalUpdate=function(){this.multiset("actualLeft",this.originLeft,"actualTop",this.originTop,"actualWidth",this.width,"actualHeight",this.height)},i.Node.prototype.updateCollapsedFlag=function(){this.multiset("hidden",this.parent.childrenHidden,"childrenHidden",this.parent.childrenHidden)},i.Grouping=function(){this.nodes=new i.List},i.Grouping.prototype.addNode=function(t){this.insertNodeBefore(t,null)},i.dftNext=function(t,e,i){if(!i&&e.nodes&&e.nodes.first)return e.nodes.first;for(;e!==t&&!e.next;)e=e.parent;return e!==t?e.next:null},i.Grouping.prototype.insertNodeBefore=function(t,e){var n,o,r,a;if(this.__graph__&&function(t,e){var n,o;for(n=e;n;n=i.dftNext(e,n))for(t.registerNewElement(n),o=n.children.first;o;o=o.next)t.registerNewElement(o)}(this.__graph__,t),e&&e.parent!==this)throw new Error("nextNode not in this group/graph");if(e===t)throw new Error("can't insert a node before itself");if(t.parent&&t.parent!==this)throw new Error("node in an other group/graph");for(t.parent?(o=t.next,this.nodes.remove(t),n=!0):n=!1,this.nodes.insertBefore(t,e),a=this.type===i.Type.GROUP?this.gr:this,r=t;r;r=i.dftNext(t,r))r.gr=a;t.parent=this,n?this.notify(new i.MovedNotif(["nodes"],t,null,o)):this.notify(new i.AddedNotif(["nodes"],t,null))},i.applyActualGeometry=function(t){if(t.gr&&!(isNaN(t.actualLeft)||isNaN(t.actualTop)||isNaN(t.actualWidth)||isNaN(t.actualHeight))){i.ObservableData.lock();try{t.setOrigin(t.actualLeft,t.actualTop,!0),t.multiset("width",t.actualWidth,"height",t.actualHeight)}finally{i.ObservableData.unlock()}}},i.Grouping.prototype.removeNode=function(t,e){var n,o,r,a,s;if(s=(n=this.type===i.Type.GROUP)?this.gr:this,t.parent!==this)throw new Error("Node not in this group/graph");i.ObservableData.lock();try{for(a=t.next,this.nodes.remove(t),o=t;o;o=i.dftNext(t,o)){for(s&&s.removeFromSelection(o),r=o.children.first;r;r=r.next)for(s&&s.removeFromSelection(r);r.children.first;)s.removeEdge(r.children.first.ref,e);o.gr=null}t.parent=null,this.notify(new i.RemovedNotif(["nodes"],t,a)),!this.nodes.first&&n&&e&&e.onemptygroup&&e.onemptygroup.call(void 0,this)}finally{i.ObservableData.unlock()}},i.Group=function(e=""){i.Element.call(this),i.ObservableData.call(this),i.Nodal.call(this,e),i.Grouping.call(this),i.Selectable.call(this),this.views={},this.data=null,this.width=60,this.height=60,this.childrenBounds=new t.BoundingRect,this.geometry=null,this.collapsed=!1},t.applyMixin(i.Group,i.Element),t.applyMixin(i.Group,i.ObservableData),t.applyMixin(i.Group,i.Nodal),t.applyMixin(i.Group,i.Grouping),t.applyMixin(i.Group,i.Selectable),f[i.Type.GROUP]=Object.freeze({left:i.PropertyFlag.VIEW|i.PropertyFlag.MODEL|i.PropertyFlag.RECURSIVE,top:i.PropertyFlag.VIEW|i.PropertyFlag.MODEL|i.PropertyFlag.RECURSIVE,width:i.PropertyFlag.VIEW|i.PropertyFlag.MODEL,height:i.PropertyFlag.VIEW|i.PropertyFlag.MODEL,geometry:i.PropertyFlag.VIEW|i.PropertyFlag.MODEL,actualLeft:i.PropertyFlag.VIEW,actualTop:i.PropertyFlag.VIEW,actualWidth:i.PropertyFlag.VIEW,actualHeight:i.PropertyFlag.VIEW,nodes:i.PropertyFlag.VIEW,collapsed:i.PropertyFlag.VIEW|i.PropertyFlag.MODEL|i.PropertyFlag.RECURSIVE,hidden:i.PropertyFlag.VIEW,children:i.PropertyFlag.VIEW}),i.Group.prototype.customPropertyFlags=null,i.Group.prototype.toString=v("Group"),i.Group.prototype.type=i.Type.GROUP,i.Group.prototype.setOrigin=function(t,e,n){var o,r,a;if(n){if(!this.gr)throw new Error("group is not in a graph; can't use absolute coordinates");if(isNaN(this.parent.originLeft)||isNaN(this.parent.originTop))throw new Error("no update occured on parent group");t-=this.parent.originLeft,e-=this.parent.originTop}o=this.left-t,r=this.top-e,i.ObservableData.lock();try{for(this.multiset("left",t,"top",e),a=this.nodes.first;a;a=a.next)a.multiset("left",a.left+o,"top",a.top+r)}finally{i.ObservableData.unlock()}},i.Group.prototype.internalUpdate=function(){var t,e;if(!(e=this.childrenBounds).isValid()||this.__modifiedProperties__&&this.__modifiedProperties__.nodes)e.reset();else for(t=this.nodes.first;t;t=t.next)if(t.__modifiedProperties__&&(t.__modifiedProperties__.actualTop||t.__modifiedProperties__.actualLeft||t.__modifiedProperties__.actualWidth||t.__modifiedProperties__.actualHeight)&&e.isModifiedBy(t,t.actualLeft,t.actualLeft+t.actualWidth,t.actualTop,t.actualTop+t.actualHeight)){e.reset();break}if(!e.isValid())for(t=this.nodes.first;t;t=t.next)e.update(t,t.actualLeft,t.actualLeft+t.actualWidth,t.actualTop,t.actualTop+t.actualHeight);this.geometry&&this.geometry.onupdate?this.geometry.onupdate(this):w.onupdate(this)},i.Group.prototype.updateCollapsedFlag=function(){this.multiset("hidden",this.parent.childrenHidden,"childrenHidden",this.parent.childrenHidden||this.collapsed)},i.BoundsGeometry=function(){this.paddingTop=40,this.paddingRight=40,this.paddingBottom=40,this.paddingLeft=40},i.BoundsGeometry.prototype.onupdate=function(t){var e;(e=t.childrenBounds).isValid()&&!t.collapsed?t.multiset("actualLeft",e.xmin-this.paddingLeft,"actualTop",e.ymin-this.paddingTop,"actualWidth",e.xmax-e.xmin+this.paddingLeft+this.paddingRight,"actualHeight",e.ymax-e.ymin+this.paddingTop+this.paddingBottom):t.multiset("actualLeft",t.originLeft,"actualTop",t.originTop,"actualWidth",t.width,"actualHeight",t.height)},i.BoundsGeometry.prototype.recenterGroup=function(t){var e,i,n,o,r,a=t.childrenBounds;if(!t.gr)throw new Error("group not in a graph");if(a.isValid){e=.5*(a.xmax+a.xmin-this.paddingLeft+this.paddingRight-t.width)-t.parent.originLeft,i=.5*(a.ymax+a.ymin-this.paddingTop+this.paddingBottom-t.height)-t.parent.originTop,n=e-t.left,o=i-t.top,t.gr.updateLock();try{for(t.multiset("left",e),t.multiset("top",i),r=t.nodes.first;r;r=r.next)r.multiset("left",r.left-n,"top",r.top-o)}finally{t.gr.updateUnlock()}}};var w=new i.BoundsGeometry;i.EdgeLink=function(t){this.c=null,this.ref=t,this.next=null,this.prev=null},i.EdgeLink.prototype.otherEnd=function(){return this===this.ref.cl1?this.ref.cl2:this.ref.cl1},i.EdgeLink.prototype.nextEdge=function(){return this.next&&this.next.ref===this.ref?this.next.next:this.next},i.EdgeLink.prototype.toString=function(){return"EdgeLink<"+this.c+","+this.ref+">"},i.BorderCstr=function(){this.aoffx=0,this.aoffy=0,this.attach=0,this.offset=0,this.marginTop=0,this.marginRight=0,this.marginBottom=0,this.marginLeft=0};var b=i.BorderCstr,E=g(i.BorderCstr,"offset","attach","aoffy","aoffx","marginTop","marginLeft","marginBottom","marginRight");i.BorderCstr.TOP=0,i.BorderCstr.BOTTOM=1,i.BorderCstr.LEFT=2,i.BorderCstr.RIGHT=3,i.BorderCstr.prototype.onupdate=function(e){var n,o,r,a,s,h,l;switch(o=e.node.actualLeft,r=e.node.actualTop,this.attach){case i.BorderCstr.LEFT:case i.BorderCstr.RIGHT:n=t.clamp(this.offset,this.marginTop,e.node.actualHeight-this.marginBottom);break;case i.BorderCstr.TOP:case i.BorderCstr.BOTTOM:n=t.clamp(this.offset,this.marginLeft,e.node.actualWidth-this.marginRight)}switch(this.attach){case i.BorderCstr.LEFT:r+=n;break;case i.BorderCstr.RIGHT:o+=e.node.actualWidth,r+=n;break;case i.BorderCstr.TOP:o+=n;break;case i.BorderCstr.BOTTOM:o+=n,r+=e.node.actualHeight}switch(a=o,s=r,this.attach){case i.BorderCstr.LEFT:a+=this.aoffy,s-=this.aoffx;break;case i.BorderCstr.RIGHT:a-=this.aoffy,s+=this.aoffx;break;case i.BorderCstr.TOP:a+=this.aoffx,s+=this.aoffy;break;case i.BorderCstr.BOTTOM:a-=this.aoffx,s-=this.aoffy}switch(this.attach){case i.BorderCstr.LEFT:h=-1,l=0;break;case i.BorderCstr.RIGHT:h=1,l=0;break;case i.BorderCstr.TOP:h=0,l=-1;break;case i.BorderCstr.BOTTOM:h=0,l=1}e.multiset("left",o,"top",r,"aleft",a,"atop",s,"anormx",h,"anormy",l)},i.InternalConstraint=function(){},i.defaultInternalCstr=new i.InternalConstraint,i.InternalConstraint.prototype.onupdate=function(t){var e;if(!t.external)throw new Error("Can't use InternalConstraint on a non internal connector");e=t.external,t.multiset("left",e.left,"top",e.top,"aleft",e.aleft,"atop",e.atop,"anormx",-e.anormx,"anormy",-e.anormy)},i.Connector=function(t,e,n,o=""){i.Element.call(this),i.ObservableData.call(this),i.Selectable.call(this),this.views={main:t||null},this.data=e||null,this.cstr=void 0===n?new i.BorderCstr:n,this.next=null,this.prev=null,this.left=0,this.top=0,this.aleft=0,this.atop=0,this.anormx=1,this.anormy=0,this.children=new i.List,this.node=null,this.id=o},t.applyMixin(i.Connector,i.Element),t.applyMixin(i.Connector,i.ObservableData),t.applyMixin(i.Connector,i.Selectable);var P=i.Connector,D=g(i.Connector,"cstr","atop","aleft","top","left","anormx","anormy");d(i.Connector.prototype,"view",void 0,["views","main"]),d(i.Connector.prototype,"offset",void 0,["cstr","offset"]),d(i.Connector.prototype,"attach",void 0,["cstr","attach"]),d(i.Connector.prototype,"aoffx",void 0,["cstr","aoffx"]),d(i.Connector.prototype,"aoffy",void 0,["cstr","aoffy"]),d(i.Connector,"LEFT",function(){return i.BorderCstr},["LEFT"]),d(i.Connector,"RIGHT",function(){return i.BorderCstr},["RIGHT"]),d(i.Connector,"BOTTOM",function(){return i.BorderCstr},["BOTTOM"]),d(i.Connector,"TOP",function(){return i.BorderCstr},["TOP"]),c(i.Connector,"pos","left","top"),c(i.Connector,"apos","aleft","atop"),c(i.Connector,"aoff","aoffx","aoffy",!1,!0),function(){function t(){return this.connector}function e(t){this.connector=t}var n;n="deprecated:margin",d(e.prototype,"top",t,["cstr","marginTop"]),d(e.prototype,"bottom",t,["cstr","marginBottom"]),d(e.prototype,"left",t,["cstr","marginLeft"]),d(e.prototype,"right",t,["cstr","marginRight"]),Object.defineProperty(i.Connector.prototype,"margin",{enumerable:!0,configurable:!1,get:r(function(){return this.hasOwnProperty(n)||(this[n]=new e(this)),this[n]},"margin")})}(),f[i.Type.CONNECTOR]=Object.freeze({cstr:i.PropertyFlag.VIEW|i.PropertyFlag.MODEL,atop:i.PropertyFlag.VIEW,aleft:i.PropertyFlag.VIEW,anormx:i.PropertyFlag.VIEW,anormy:i.PropertyFlag.VIEW,top:i.PropertyFlag.VIEW,left:i.PropertyFlag.VIEW,hidden:i.PropertyFlag.VIEW,children:i.PropertyFlag.VIEW}),i.Connector.prototype.customPropertyFlags=null,i.Connector.prototype.internal=null,i.Connector.prototype.external=null,i.Connector.prototype.set=function(t,n){var o;if(o=!1,"pos"===t){i.ObservableData.lock();try{i.ObservableData.prototype.set.call(this,"left",n[0]),i.ObservableData.prototype.set.call(this,"top",n[1])}finally{i.ObservableData.unlock()}}else if("apos"===t){i.ObservableData.lock();try{i.ObservableData.prototype.set.call(this,"aleft",n[0]),i.ObservableData.prototype.set.call(this,"atop",n[1])}finally{i.ObservableData.unlock()}}else if("aoff"===t){i.ObservableData.lock();try{i.ObservableData.prototype.set.call(this,"aoffx",n[0]),i.ObservableData.prototype.set.call(this,"aoffy",-n[1])}finally{i.ObservableData.unlock()}}else"offset"===t?i.ObservableData.prototype.setPath.call(this,["cstr","offset"],n):"attach"===t?i.ObservableData.prototype.setPath.call(this,["cstr","attach"],n):"aoffx"===t?i.ObservableData.prototype.setPath.call(this,["cstr","aoffx"],n):"aoffy"===t?i.ObservableData.prototype.setPath.call(this,["cstr","aoffy"],n):(i.ObservableData.prototype.set.apply(this,arguments),o=!0);o||e("Use of deprecated property: Connector#"+t)},i.Connector.prototype.toString=v("Connector"),i.Connector.prototype.type=i.Type.CONNECTOR,i.Connector.prototype.internalUpdate=function(){this.cstr&&this.cstr.onupdate?this.cstr.onupdate(this):(this.set("aleft",this.node.left),this.set("left",this.node.left),this.set("atop",this.node.top),this.set("top",this.node.top),this.set("anormx",1),this.set("anormy",0))},i.Connector.prototype.internalRecursiveUpdate=function(){this.set("hidden",this.node.hidden||this.external&&this.node.childrenHidden)},i.Connector.prototype.getGraph=function(){return this.node&&this.node.gr},i.Connector.prototype.getParent=function(){return this.node},i.Connector.prototype.remove=function(t){this.node&&this.node.removeConnector(this,t)},i.Connector.prototype.bringToFront=function(){this.node&&this.node.insertConnectorBefore(this,null)},i.newConnectorPair=function(){var t,e;return t=new i.Connector,e=new i.Connector(null,null,i.defaultInternalCstr),t.internal=e,e.external=t,t},i.Edge=function(t,e,n){i.Element.call(this),i.ObservableData.call(this),i.Selectable.call(this),this.gr=null,this.views={main:t||null},this.data=e||null,this.next=null,this.prev=null,this.cl1=new i.EdgeLink(this),this.cl2=new i.EdgeLink(this),this.geometry=n||null,this.path=[],this._edgeOverlayingFlag=!1},t.applyMixin(i.Edge,i.Element),t.applyMixin(i.Edge,i.ObservableData),t.applyMixin(i.Edge,i.Selectable);var S=i.Edge,T=g(i.Edge,"path","geometry");function L(t,e,i,n){var o,r,a;for(o=i|=0,r=e.length;t&&t.constructor===Object&&o<r;++o,t=t[a]){if(""===(a=e[o]))throw new Error("Invalid argument: path contains empty string");if(!t.hasOwnProperty(a))return}return t&&t.constructor===Object?t.hasOwnProperty("")?t[""]:n:t}function _(t,e){var i;if(!f.hasOwnProperty(e.type))throw new Error("Invalid argument: obj should be a graph element");return i=f[e.type],"data"===t[0]?e.customPropertyFlags?0|L(e.customPropertyFlags,t,1):0:0|L(i,t)}d(i.Edge.prototype,"view",void 0,["views","main"]),i.Edge.prototype.customPropertyFlags=null,f[i.Type.EDGE]=Object.freeze({hidden:i.PropertyFlag.VIEW,geometry:i.PropertyFlag.VIEW|i.PropertyFlag.MODEL,path:i.PropertyFlag.VIEW}),i.Edge.prototype.toString=v("Edge"),i.Edge.prototype.type=i.Type.EDGE,i.Edge.prototype.internalUpdate=function(){this.geometry&&this.geometry.onupdate?this.geometry.onupdate(this):i.LineGeometry.prototype.onupdate(this)},i.Edge.prototype.internalRecursiveUpdate=function(){this.set("hidden",this.cl1.c.hidden||this.cl2.c.hidden)},i.Edge.prototype.split=function(t,e,i,n,o,r){var a,s,h,l,p;if(o&&(p=n,n=i,i=p,p=e,e=t,t=p),!this.gr)throw new Error("edge not in graph");if(t&&t.gr)throw new Error("e1 alreay in a graph");if(e&&e.gr)throw new Error("e2 alreay in a graph");if(i.getGraph()!==this.gr)throw new Error("c1 not in expected graph");if(n.getGraph()!==this.gr)throw new Error("c2 not in expected graph");if(!t&&!e)throw new Error("both e1 or e2 are null");t?e||(e=this):t=this,a=this.cl1.c,s=this.cl2.c,h=this.gr,l=this.next,h.updateLock();try{this.remove(),h.insertEdgeBefore(a,i,t,l,r),h.insertEdgeBefore(n,s,e,l,r)}finally{h.updateUnlock()}},i.Edge.prototype.join=function(t,e,i,n,o){var r,a,s,h,l,p,c,u;if(p=Boolean(o&&o.keep1),c=Boolean(o&&o.keep2),o&&o.reverse&&(l=n,n=i,i=l,l=e,e=t,t=l,l=p,p=c,c=l),!t&&!e)throw new Error("both e1 or e2 are null");if(t?e||(e=this):t=this,t!==e){if(!t.gr)throw new Error("e1 not in a graph");if(!e.gr)throw new Error("e2 not in a graph");if(t.gr!==e.gr)throw new Error("e1 and e2 not in the same graph");if(this.gr&&t!==this&&e!==this)throw new Error("this edge is already in a graph and is neither e1 nor e2");if(this===t&&p)throw new Error("can't keep e1 when this === e1");if(this===e&&c)throw new Error("can't keep e2 when this === e2");if(!i||!n){if(i)u=i.node;else if(n)u=n.node;else if(t.cl1.c.node===e.cl1.c.node||t.cl1.c.node===e.cl2.c.node)u=t.cl1.c.node;else{if(t.cl2.c.node!==e.cl1.c.node&&t.cl2.c.node!==e.cl2.c.node)throw new Error("no common node found");u=t.cl2.c.node}if(!u)throw new Error("c1 or c2 is not in a node");if(!i)if(t.cl1.c.node===u)i=t.cl1.c;else{if(t.cl2.c.node!==u)throw new Error("no common node found");i=t.cl2.c}if(!n)if(e.cl1.c.node===u)n=e.cl1.c;else{if(e.cl2.c.node!==u)throw new Error("no common node found");n=e.cl2.c}}if(t.cl1.c===i)r=t.cl2.c;else{if(t.cl2.c!==i)throw new Error("c1 is not a connector of e1");r=t.cl1.c}if(e.cl1.c===n)a=e.cl2.c;else{if(e.cl2.c!==n)throw new Error("c2 is not a connector of e2");a=e.cl1.c}s=t.gr,h=t.next!==e?t.next:e.next,s.updateLock();try{p||t.remove(),c||e.remove(),s.insertEdgeBefore(r,a,this,h,o&&o.insertOpts)}finally{s.updateUnlock()}}},i.Edge.prototype.multijoin=function(t,e,n){function o(e){var i,n,o,a;if(g)if(i=e.cl1.c.node===t?e.cl2.c:e.cl1.c,s.external&&i.external){if(s.node!==i.node)return}else if(Boolean(s.external)!==Boolean(i.external)){for(s.external?(o=s,n=i):(o=i,n=s),a=n.node;a&&a!==o.node;a=a.parent);if(!a)return}e.join(r,e,h,null,l)}var r,a,s,h,l,p,c,u,d,g;if(r=this,g=Boolean(n&&n.ignoreInvalidPairs),!(a=this.gr))throw new Error("edge not connected");if(!t){if(Array.isArray(e))throw new Error("node parameter is needed when edges is an array");if(e.type!==i.Type.CONNECTOR)throw new Error("input is neither an array nor a connector");t=e.node}if(this.cl1.c.node===t)h=this.cl1.c,s=this.cl2.c;else{if(this.cl2.c.node!==t)throw new Error("this edge connectors are not on provided node");h=this.cl2.c,s=this.cl1.c}l={keep1:!0,reverse:Boolean(n&&n.reverse),insertOpts:n&&n.insertOpts},a.updateLock();try{if(Array.isArray(e))for(p=0,c=e.length;p<c;++p)o(e[p]);else{if(e.type!==i.Type.CONNECTOR)throw new Error("input is neither an array nor a connector");for(u=e.children.first;u;u=d)d=u.nextEdge(),o(u.ref)}n&&n.keep||this.remove()}finally{a.updateUnlock()}},i.Edge.prototype.remove=function(t){this.gr&&this.gr.removeEdge(this,t)},i.Edge.prototype.getGraph=function(){return this.gr},i.Edge.prototype.getParent=function(){return this.gr},i.Edge.prototype.bringToFront=function(){this.cl1&&this.cl2&&this.gr.insertEdgeBefore(this.cl1.c,this.cl2.c,this,null)},i.LineGeometry=function(){},i.LineGeometry.prototype.onupdate=function(t){var e=[i.PathCmd.M,t.cl1.c.aleft,t.cl1.c.atop,i.PathCmd.L,t.cl2.c.aleft,t.cl2.c.atop];t.set("path",e)},i.ReshapableEdge=function(){this.reshapable=!0},i.ReshapableEdge.prototype.getPickedSegmentOptions=function(){throw new Error("Not implemented")},i.ReshapableEdge.prototype.isReshapingValid=function(){throw new Error("Not implemented")},i.ReshapableEdge.prototype.reshapePath=function(){throw new Error("Not implemented")},i.ReshapableEdge.prototype.refinePath=function(){throw new Error("Not implemented")},i.SplittableEdge=function(){this.splittable=!0,this.splitMargin=10},i.SplittableEdge.prototype.getPickedSegmentOptions=function(){throw new Error("Not implemented")},i.SplittableEdge.prototype.isSplitValid=function(){throw new Error("Not implemented")},i.SplittableEdge.prototype.splitPath=function(){throw new Error("Not implemented")},i.StairGeometry=function(t){i.ReshapableEdge.call(this),i.SplittableEdge.call(this),t&&(!isNaN(t.nbStairs)&&t.nbStairs>=0&&(this.nbStairs=t.nbStairs),!1===t.reshapable&&(this.reshapable=!1),!1===t.splittable&&(this.splittable=!1))},t.applyMixin(i.StairGeometry,i.ReshapableEdge),t.applyMixin(i.StairGeometry,i.SplittableEdge),i.StairGeometry.prototype.nbStairs=1,i.StairGeometry.prototype.onupdate=function(t){var e={x:t.cl1.c.aleft,y:t.cl1.c.atop},n={x:t.cl2.c.aleft,y:t.cl2.c.atop};if(!t.path.length||(o=e,r=n,a=t.path,o.x!==a[1]||o.y!==a[2]||r.x!==a[a.length-1]||r.y!==a[a.length-2])){var o,r,a;if(t.path&&6!==t.path.length&&(t.reshaped||t.splitted)){var s={x:(u=t.path.slice())[1],y:u[2]},h={x:u[u.length-2],y:u[u.length-1]};return s.x!==e.x&&(u[1]=e.x),s.y!==e.y&&(u[2]=e.y,u[5]=e.y),h.x!==n.x&&(u[u.length-2]=n.x),h.y!==n.y&&(u[u.length-1]=n.y,u[u.length-4]=n.y),void t.gr.withLockedUpdate(function(){t.set("path",u)})}t.reshaped=!1,t.splitted=!1;var l,p,c;if(e.x===n.x||e.y===n.y)c=0;else if(Math.abs(e.x-n.x)<5||Math.abs(e.y-n.y)<5)c=1,l=Math.floor((n.x-e.x)/2),p=n.y-e.y;else{c=this.nbStairs+1;do{c--,l=Math.floor((n.x-e.x)/(c+1)),p=Math.floor((n.y-e.y)/c)}while(c>1&&(Math.abs(l)<5||Math.abs(p)<5))}for(var u=[i.PathCmd.M,e.x,e.y],d=e.x,g=e.y,f=0;f<2*c-1;f++)f%2==0?d+=l:g+=p,u.push(i.PathCmd.L,d,g);this.nbStairs>0&&u.push(i.PathCmd.L,d,n.y),u.push(i.PathCmd.L,n.x,n.y),t.gr.withLockedUpdate(function(){t.set("path",u)})}},i.StairGeometry.prototype.isOnSegment=function(t,e,i,n,o,r){var a=t-i,s=e-n,h=o-i,l=r-n;return Math.abs(a)<5&&(a=0),Math.abs(s)<5&&(s=0),0===a*l-s*h&&(Math.abs(h)>=Math.abs(l)?h>0?i<=t&&t<=o:o<=t&&t<=i:l>0?n<=e&&e<=r:r<=e&&e<=n)},i.StairGeometry.prototype.getPickedSegmentOptions=function(t,e){if(!t||!e)return{index:-1,direction:[0,0]};if(!t.reshaped&&void 0!==t.reshaped&&!function(t,e){for(var i=[],n=[],o=0;o<=t.path.length-3;o+=3)i.push(t.path[o+1]),n.push(t.path[o+2]);var r=Math.min.apply(null,i),a=Math.max.apply(null,i),s=Math.min.apply(null,n),h=Math.max.apply(null,n);return e[0]>r&&e[0]<a&&e[1]>s&&e[1]<h}(t,e))return{index:-1,direction:[0,0]};for(var i,n,o=t.path[1],r=t.path[2],a=3;a<t.path.length;a+=3){if(i=t.path[a+1],n=t.path[a+2],this.isOnSegment(e[0],e[1],o,r,i,n))return{index:a,direction:[t.path[a+1]-o,t.path[a+2]-r]};o=i,r=n}return{index:-1,direction:[0,0]}},i.StairGeometry.prototype.isReshapingValid=function(t,e,i){var n,o;return!(!t||!e)&&(o=e.direction,n=e.index,(0===o[0]||0===o[1])&&o[0]+o[1]!==0&&3!==n&&n!==t.path.length-3)},i.StairGeometry.prototype.reshapePath=function(t,e,i,n,o,r,a){var s,h,l,p,c,u;if(t&&e&&i){p=null!=a?a:20,l=e.direction&&0===e.direction[1],s=t.path.slice(0);var d,g=n||-1/0,f=o||1/0;if(c=6===(h=e.index)?(l?s[2]:s[1])+p:g,u=h===s.length-6?(l?s[s.length-1]:s[s.length-2])-p:f,l){if(i[1]<c?(s[h+2]=c,s[h-1]=c):i[1]>u?(s[h+2]=u,s[h-1]=u):(s[h+2]=i[1],s[h-1]=i[1]),r)(d=r(s[h+2],s[h-1]))&&2===d.length&&(s[h+2]=d[0],s[h-1]=d[1])}else if(i[0]<c?(s[h+1]=c,s[h-2]=c):i[0]>u?(s[h+1]=u,s[h-2]=u):(s[h+1]=i[0],s[h-2]=i[0]),r)(d=r(s[h+1],s[h-2]))&&2===d.length&&(s[h+1]=d[0],s[h-2]=d[1]);t.gr.withLockedUpdate(function(){t.set("path",s),t.reshaped=!0,t.reshapeInProgress=!0})}},i.StairGeometry.prototype.isSplitValid=function(t,e,i){if(!t||!e)return!1;var n=e.direction,o=e.index;if(!n||0!==n[0]&&0!==n[1]||n[0]+n[1]===0)return!1;if(o<6||o>t.path.length-4)return!1;if(0===n[0]){var r=t.path[o-2]-t.path[o-5]>0?1:-1;if(Math.abs(i[1]-t.path[o-1])<5)return!1;if(Math.abs(i[1]-t.path[o+2])<5)return!1;if(Math.abs(t.path[o+1]-r*this.splitMargin-t.path[o+4])<5)return!1}else{r=t.path[o-1]-t.path[o-4]>0?1:-1;if(Math.abs(i[0]-t.path[o-2])<5)return!1;if(Math.abs(i[0]-t.path[o+1])<5)return!1;if(Math.abs(t.path[o+2]-r*this.splitMargin-t.path[o+5])<5)return!1}return!0},i.StairGeometry.prototype.splitPath=function(t,e,n){var o,r,a,s;t&&e&&n&&(a=0===e.direction[0],o=t.path.slice(0),r=e.index,a?(s=o[r-2]-o[r-5]>0?1:-1,o[r-2]+=s*this.splitMargin,o[r+1]-=s*this.splitMargin,o.splice(r,0,i.PathCmd.L,o[r-2],n[1],i.PathCmd.L,o[r+1],n[1])):(s=o[r-1]-o[r-4]>0?1:-1,o[r+2]-=s*this.splitMargin,o[r-1]+=s*this.splitMargin,o.splice(r,0,i.PathCmd.L,n[0],o[r-1],i.PathCmd.L,n[0],o[r+2])),t.gr.withLockedUpdate(function(){t.set("path",o),t.splitted=!0}))},i.StairGeometry.prototype.refinePath=function(t){if(t&&t.path&&t.reshapeInProgress){t.reshapeInProgress=!1;var e=function(t){var e,n;n=!1,e=t.slice(0);for(var o=3;o<e.length-3;o+=3)if(e[o]===i.PathCmd.L){var r=e[o-2],a=e[o-1],s=e[o+1],h=e[o+2],l=e[o+4],p=e[o+5],c=e[o+7],u=e[o+8],d=Math.abs(l-s),g=Math.abs(p-h);if(0===d&&g<=5||0===g&&d<=5){if(3===o&&r+5>c)continue;if(o===e.length-9&&c-5<r)continue;var f=Math.abs(c-r),y=Math.abs(u-a);f<=5?e[o-2]=c:y<=5&&(e[o-1]=u),e.splice(o,6),n=!0}}return{modified:n,path:e}}(t.path);e.modified&&t.gr.withLockedUpdate(function(){t.set("path",e.path)})}},i.AutoBezierGeometry=function(t){!isNaN(t)&&t>=0&&(this.minTangentLength=t)},i.AutoBezierGeometry.prototype.minTangentLength=120,i.AutoBezierGeometry.prototype.onupdate=function(t){var e,n,o,r,a,s,h,l,p,c,u,d,g,f,y;e=t.cl1.c.anormx,n=t.cl1.c.anormy,o=t.cl2.c.anormx,r=t.cl2.c.anormy,p=t.cl1.c.aleft,c=t.cl1.c.atop,u=t.cl2.c.aleft,d=t.cl2.c.atop,a=p+(g=Math.max(this.minTangentLength,Math.abs(u-p)))*e/2,s=c+(f=Math.max(this.minTangentLength,Math.abs(d-c)))*n/2,h=u+g*o/2,l=d+f*r/2,y=[i.PathCmd.M,p,c,i.PathCmd.C,u,d,a,s,h,l],t.set("path",y)},i.EGraph=function(t,e){i.ObservableData.call(this),i.Observable.call(this),i.Grouping.call(this),this.views={},this.viewsList=[],this.data=e||null,this.edges=new i.List,this.selection=new i.SelectionList,this.boundChangeListener=this.changeListener.bind(this),this.updateLockCount=0,this.boundDelayedUpdate=this.delayedUpdate.bind(this),this.delayedUpdatePending=!1,this.mark=void 0,this.registerNewElement(this),t&&this.addView("main",t),this.edgePickingAreaOpts=void 0,this.zoomOpts=void 0,this._edgePickingAreaList=[],this.viewOpts=void 0,this.mouseProfile=i.EGraphMouseProfileNames.LEGACY},t.applyMixin(i.EGraph,i.ObservableData),t.applyMixin(i.EGraph,i.Observable),t.applyMixin(i.EGraph,i.Grouping),d(i.EGraph.prototype,"view",void 0,["views","main"]),i.EGraph.prototype.toString=v("EGraph"),i.EGraph.prototype.parent=null,i.EGraph.prototype.childrenHidden=!1,i.EGraph.prototype.type=i.Type.EGRAPH,i.EGraph.prototype.originLeft=0,i.EGraph.prototype.originTop=0,f[i.Type.EGRAPH]=Object.freeze({nodes:i.PropertyFlag.VIEW,edges:i.PropertyFlag.VIEW}),i.EGraph.prototype.addView=function(t,e){if(this.views.hasOwnProperty(t))throw new Error("Views with same key already exists: "+t);if(!e)throw new Error("Null view");this.views[t]=e,this.viewsList.push(e),e.oninit&&(i.EGraph.traceUpdates&&console.log("Initialization of view "+t+":"),e.oninit(this,t))},i.EGraph.prototype.setEdgePickingAreaOpts=function(t){this.edgePickingAreaOpts=t},i.EGraph.prototype.setZoomOpts=function(t){this.zoomOpts=t},i.EGraphMouseProfileNames={LEGACY:0,CATIA:1,"3DEXPERIENCE":2,SOLIDWORKS:3},i.EGraph.prototype.setMouseProfile=function(t){Object.values(i.EGraphMouseProfileNames).includes(t)?this.mouseProfile=t:this.mouseProfile=i.EGraphMouseProfileNames.LEGACY},i.EGraph.prototype.setViewOpts=function(t){this.viewOpts=t},i.EGraph.prototype.addAllChangeListener=function(t){if("function"!=typeof t)throw new Error("Listener must be a function");this.allListeners=(this.allListeners||[]).concat(t)},i.EGraph.prototype.removeAllChangeListener=function(t){var e;return!(!this.allListeners||-1===(e=this.allListeners.indexOf(t)))&&(this.allListeners=this.slice(0,e).concat(this.slice(e+1)),!0)},i.EGraph.prototype.changeListener=function(t){var e,i;if(this.storeUpdateChanges(t),this.allListeners)for(e=0,i=this.allListeners.length;e<i;++e)this.allListeners[e](t)};var M=i.PropertyFlag.VIEW|i.PropertyFlag.MODEL;function O(t,e){var i,n,o;for(i=0,n=t.length;i<n;++i)if(o=t[i],e.hasOwnProperty(o)||(e[o]=i===n-1||{}),i!==n-1==("object"!=typeof(e=e[o])))throw new Error("Only leaf of composited properties can be modified")}return i.EGraph.prototype._restoreEdgePickingAreasSelectionCapability=function(){if(this.edgePickingAreaOpts&&this.edgePickingAreaOpts.activate)for(var t=void 0;this._edgePickingAreaList.length>0;)(t=this._edgePickingAreaList.pop()).element.view.display.pickingAreaElt.style.pointerEvents=t.pointerEvents},i.EGraph.prototype._removeEdgePickingAreasSelectionCapability=function(t){this.edgePickingAreaOpts&&this.edgePickingAreaOpts.activate&&t&&t.type===i.Type.EDGE&&(t._edgeOverlayingFlag&&(this._edgePickingAreaList.push({element:t,pointerEvents:t.view.display.pickingAreaElt.style.pointerEvents}),t.view.display.pickingAreaElt.style.pointerEvents="none"),!t._edgeOverlayingFlag&&this._edgePickingAreaList.length>0&&(this._restoreEdgePickingAreasSelectionCapability(),this._edgePickingAreaList.push({element:t,pointerEvents:t.view.display.pickingAreaElt.style.pointerEvents}),t.view.display.pickingAreaElt.style.pointerEvents="none"))},i.EGraph.prototype._setEdgePickingAreaOverlayingFromPoint=function(t,e,n){if(this.edgePickingAreaOpts&&this.edgePickingAreaOpts.activate&&t&&t.type===i.Type.EDGE){t._edgeOverlayingFlag=!1;var o=t.view.display.pickingAreaElt.style.pointerEvents;t.view.display.pickingAreaElt.style.pointerEvents="none";var r,a=function(t,e,i){var n,o,r,a,s=[],h=[];for(a=t.gr.view.domRoot;a.parentNode;a=a.parentNode);for(;(n=a.elementFromPoint(e,i))&&-1===s.indexOf(n)&&null!=n;)s.push(n),h.push({value:n.style.getPropertyValue("pointer-events"),priority:n.style.getPropertyPriority("pointer-events")}),n.style.setProperty("pointer-events","none","important");for(o=h.length;r=h[--o];)s[o].style.setProperty("pointer-events",r.value?r.value:"",r.priority);return s}(t,e,n);for(r=0;r<a.length;r++)if(a[r]&&"path"===a[r].tagName){t._edgeOverlayingFlag=!0;break}t.view.display.pickingAreaElt.style.pointerEvents=o}},i.EGraph.prototype._updateEdgePickingAreaSize=function(t,e){if(this.edgePickingAreaOpts&&this.edgePickingAreaOpts.activate&&t&&t.type===i.Type.EDGE){var n,o=void 0,r=void 0,a=0,s=e;o=t.view.display.elt,r=t.view.display.pickingAreaElt,a=""!==o.style.strokeWidth?Number(o.style.strokeWidth.replace("px","")):1==t.selected?2.5:"modifiable"===o.parentNode.className.baseVal?2.5:1.5,0==s&&(s=1,t.gr&&t.gr.view&&t.gr.view.vpt&&t.gr.view.vpt[2]&&(s=t.gr.view.vpt[2])),n=this.edgePickingAreaOpts.size/s,r.style.strokeWidth=n>=a?n:a}},i.EGraph.prototype.updateEdgesPickingAreasSize=function(t){if(this.edgePickingAreaOpts&&this.edgePickingAreaOpts.activate){var e=void 0;for(e=this.edges.first;e;e=e.next)this._updateEdgePickingAreaSize(e,t)}},i.EGraph.prototype.storeUpdateChanges=function(t){var e,n,o,r;for(e=0,n=t.length;e<n;++e)"updated"===(o=t[e]).type?(r=o.object,_(o.path,r)&M&&(this.pendingUpdateChanges||(this.pendingUpdateChanges=[]),this.pendingUpdateChanges.push(o))):"added"!==o.type&&"removed"!==o.type&&"moved"!==o.type||(this.pendingUpdateChanges||(this.pendingUpdateChanges=[]),this.pendingUpdateChanges.push(o));this.updateLockCount||this.delayedUpdatePending||(this.delayedUpdatePending=!0,i.ObservableData.addPostCallsCB(this.boundDelayedUpdate))},i.EGraph.prototype.delayedUpdate=function(){this.delayedUpdatePending=!1,this.updateLock(),this.updateUnlock()},i.EGraph.prototype.isUpdated=function(){return!this.updateLockCount&&!this.delayedUpdatePending},i.EGraph.prototype.withLockedUpdate=function(t,e){this.updateLock();try{return t.call(e)}finally{this.updateUnlock()}},i.EGraph.prototype.updateLock=function(){++this.updateLockCount},i.EGraph.traceUpdates=!1,i.EGraph.prototype.updateUnlock=function(){var t,e,n;if(this.updateLockCount<=0)throw new Error("Illage State: extraneous unlock of object");if(1===this.updateLockCount){try{for(var o=0;this.pendingUpdateChanges;){if(t=this.pendingUpdateChanges,this.pendingUpdateChanges=null,i.EGraph.traceUpdates){if(o>50)throw new Error("too many loops");for(console.log("Update loop "+ ++o+":"),e=0,n=t.length;e<n;++e)console.log("  "+t[e])}this.applyChanges2(t)}!o&&i.EGraph.traceUpdates&&console.log("Update: no pending changes so no update loop occured")}finally{this.updateLockCount=0}this.dispatch({type:"update"})}else--this.updateLockCount},i.topologicalSortNodes=function(t,e){var n,o,r,a,s,h,l,p,c;if(a=t.length){c=[],n=new i.MarksScope;try{for(o=0;o<a;++o){if((s=t[o]).type!==i.Type.NODE&&s.type!==i.Type.GROUP)throw new Error("element is not a node/group");for(h=s;h&&void 0===h.mark;h=h.parent)n.setMark(h,!1),h.parent||c.push(h);s.mark=!0}for(r=0,o=0,l=c.length;o<l;++o)for(h=p=c[o];h;h=i.dftNext(p,h,void 0===h.mark||h.mark&&e))h.mark&&(t[r++]=h);t.length=r}finally{n.dispose()}}},i.EGraph.prototype.applyChanges2=function(t){var e,n,o;function r(t,e){t.__updateFlag__||(n[t.type]||(n[t.type]=[]),n[t.type].push(t)),t.__updateFlag__|=e}function a(t,n){var o,s;if(t.getGraph()){if(s=!1,0==(1&t.__updateFlag__)&&(r(t,1),e[t.type]||(e[t.type]=[]),e[t.type].push(t),s=!0,t.parent&&t.parent.type===i.Type.GROUP&&a(t.parent)),n&&0==(128&t.__updateFlag__)&&(r(t,128),s=!0,t.nodes))for(o=t.nodes.first;o;o=o.next)a(o,!0);if(s){if(t.children)for(o=t.children.first;o;o=o.next)a(o.ref||o,n);t.type===i.Type.CONNECTOR&&t.internal&&a(t.internal,n)}}}function s(t,e){t.__updateFlag__&=~e}function h(t){var e,i,n;for(e=0,i=t.length;e<i;++e)n=t[e],Boolean(32&n.__updateFlag__)!==Boolean(64&n.__updateFlag__)&&(n.__modifiedProperties__||(n.__modifiedProperties__={}),O(["selected"],n.__modifiedProperties__),r(n,2))}function l(t,e){var n;if(t){if(i.EGraph.traceUpdates)for(console.log("  recursive update of "+e),n=t.length;n-- >0;)128&t[n].__updateFlag__&&console.log("    "+t[n]);for(n=t.length;n-- >0;)128&t[n].__updateFlag__&&(t[n].internalRecursiveUpdate(),p(t[n]))}}function p(t){var e,n,a,s,h,l;if(n=o.pendingUpdateChanges,o.pendingUpdateChanges=null,n){if(i.EGraph.traceUpdates)for(console.log("  changes due to update of "+t+":"),a=0,s=n.length;a<s;++a)console.log("    "+n[a]);for(a=0,s=n.length;a<s;++a){if("updated"!==(e=n[a]).type)throw new Error("Invalid type of change during update (only change of properties accepted): "+e);if(h=e.object,(l=_(e.path,h))&i.PropertyFlag.VIEW&&(h.__modifiedProperties__||(h.__modifiedProperties__={}),O(e.path,h.__modifiedProperties__),r(h,2)),l&i.PropertyFlag.MODEL)throw new Error("Change of a property that would trigger a new update during update: "+e)}}}o=this,n=[],e=[];try{!function(){var e,o,l,p,c,u,d,g;for(e=0,o=t.length;e<o;++e)c=(p=t[e]).object,(l=_(p.path,c))&i.PropertyFlag.VIEW&&(c.__modifiedProperties__||(c.__modifiedProperties__={}),O(p.path,c.__modifiedProperties__),r(c,2)),l&i.PropertyFlag.MODEL&&a(c,l&i.PropertyFlag.RECURSIVE),"added"!==p.type&&"removed"!==p.type&&"moved"!==p.type||(p.object.type===i.Type.EGRAPH&&"selection"===p.path[0]?(u=p.child,"added"===p.type?r(u,32):"removed"===p.type&&(32&u.__updateFlag__?s(u,32):r(u,64))):(u=(u=p.child).ref||u,((p.object.type===i.Type.EGRAPH||p.object.type===i.Type.GROUP)&&"nodes"===p.path[0]||p.object.type===i.Type.EGRAPH&&"edges"===p.path[0]||(p.object.type===i.Type.NODE||p.object.type===i.Type.GROUP)&&"children"===p.path[0])&&("added"===p.type?r(u,4):"moved"===p.type?0==(12&u.__updateFlag__)&&r(u,16):4&u.__updateFlag__?s(u,4):(r(u,8),u.__lastParent__=p.object,s(u,16)))));if(d=n[i.Type.GROUP])for(e=0,o=d.length;e<o;++e)if(l=12&(c=d[e]).__updateFlag__)for(u=c;u;u=i.dftNext(c,u))for(r(u,l),g=u.children.first;g;g=g.next)r(g,l);if(d=n[i.Type.NODE])for(e=0,o=d.length;e<o;++e)if(l=12&(c=d[e]).__updateFlag__)for(u=c.children.first;u;u=u.next)r(u,l);for(e=0,o=n.length;e<o;++e)n[e]&&h(n[e])}(),function(){var t,o,r,s,h;for(t=0,o=n.length;t<o;++t)if(r=n[t])for(s=0,h=r.length;s<h;++s)0!=(20&r[s].__updateFlag__)?a(r[s],!0):t!==i.Type.GROUP&&t!==i.Type.NODE||0==(8&r[s].__updateFlag__)||!r[s].__lastParent__||r[s].__lastParent__.type!==i.Type.GROUP||a(r[s].__lastParent__,!1);for(e[i.Type.GROUP]&&(i.topologicalSortNodes(e[i.Type.GROUP]),e[i.Type.GROUP].reverse()),e[i.Type.CONNECTOR]&&function(t){var e,i,n,o;for(e=0,i=n=t.length;e<i;){for(;e<n&&!t[e].external;)++e;for(;i>0&&t[i-1].external;)--i;e<i&&(--i,o=t[e],t[e]=t[i],t[i]=o,++e)}}(e[i.Type.CONNECTOR]),l(e[i.Type.GROUP],"groups"),l(e[i.Type.NODE],"nodes"),l(e[i.Type.CONNECTOR],"connectors"),l(e[i.Type.EDGE],"edges"),t=0,o=e.length;t<o;++t)if(r=e[t]){if(i.EGraph.traceUpdates)for(console.log("  update "+i.Type2Str[t]),s=0,h=r.length;s<h;++s)console.log("    "+r[s]);for(s=0,h=r?r.length:0;s<h;++s)r[s].internalUpdate(),p(r[s])}}(),function(){var t,e,r;for(n[i.Type.GROUP]&&i.topologicalSortNodes(n[i.Type.GROUP]),t=0,e=o.viewsList.length;t<e;++t)(r=o.viewsList[t])&&r.onupdate&&r.onupdate(o,n)}()}finally{!function(){var t,e,i,o,r;for(t=0,e=n.length;t<e;++t)if(i=n[t])for(o=0,r=i.length;o<r;++o)i[o].__updateFlag__=0,i[o].__modifiedProperties__&&(i[o].__modifiedProperties__=null),i[o].__lastParent__&&(i[o].__lastParent__=null)}()}},i.EGraph.prototype.registerNewElement=function(t){if(t.__graph__){if(t.__graph__!==this)throw new Error("Element already registered in an other graph")}else t.__graph__=this,t.addChangeListener(this.boundChangeListener)},i.EGraph.prototype.removeEdge=function(t,e){var n,o,r,a,s;if(t.getGraph()!==this)throw new Error("Edge not in this graph");i.ObservableData.lock();try{this.removeFromSelection(t),n=t.cl1.c,o=t.cl2.c,a=t.cl1.next,s=t.cl2.next,r=t.next,t.cl1.c.children.remove(t.cl1),t.cl1.c=null,t.cl2.c.children.remove(t.cl2),t.cl2.c=null,this.edges.remove(t),t.gr=null,this.notify(new i.RemovedNotif(["edges"],t,r)),n.notify(new i.RemovedNotif(["children"],t.cl1,a)),o.notify(new i.RemovedNotif(["children"],t.cl2,s))}finally{i.ObservableData.unlock()}},i.EGraph.prototype.removeConnector=function(t){if(!t.node)throw new Error("connector not in a node");t.node.removeConnector(t)},i.EGraph.prototype.addToSelection=function(t){if(t.getGraph()!==this)throw new Error("Element not in this graph");this.isSelected(t)||(this._removeEdgePickingAreasSelectionCapability(t),this.selection.addLast(t),this.notify(new i.AddedNotif(["selection"],t,null)),this._updateEdgePickingAreaSize(t,0))},i.SelectionMode={REPLACE:0,ADD:1,SUBTRACT:2,INTERSECT:3},i.EGraph.prototype.updateSelection=function(t,e){var n,o,r,a,s;if(!Array.isArray(t))throw new Error("elements must be an array");void 0===e&&(e=i.SelectionMode.REPLACE),this.updateLock();try{s=new i.MarksScope;try{if(e===i.SelectionMode.SUBTRACT)for(n=0,o=t.length;n<o;++n)this.removeFromSelection(t[n]);else if(e===i.SelectionMode.ADD)for(n=0,o=t.length;n<o;++n)this.addToSelection(t[n]);else{if(e!==i.SelectionMode.REPLACE&&e!==i.SelectionMode.INTERSECT)throw new Error("invalid mode: "+e);for(n=0,o=t.length;n<o;++n)s.setMark(t[n],!0);for(r=this.selection.first;r;r=a)a=r.nextSel,r.mark||this.removeFromSelection(r);if(e===i.SelectionMode.REPLACE)for(n=0,o=t.length;n<o;++n)this.addToSelection(t[n])}}finally{s.dispose()}}finally{this.updateUnlock()}},i.EGraph.prototype.removeFromSelection=function(t){var e;if(t.getGraph()!==this)throw new Error("Element not in this graph");this.isSelected(t)&&(e=t.nextSel,this.selection.remove(t),this.notify(new i.RemovedNotif(["selection"],t,e)),this._updateEdgePickingAreaSize(t,0))},i.EGraph.prototype.isSelected=function(t){if(t.getGraph()!==this)throw new Error("Element not in this graph");return Boolean(t.nextSel||t.prevSel||t===this.selection.first)},i.EGraph.prototype.clearSelection=function(){var t,e;i.ObservableData.lock();try{for(t=this.selection.first;t;t=e)e=t.nextSel,this.removeFromSelection(t);this._restoreEdgePickingAreasSelectionCapability()}finally{i.ObservableData.unlock()}},i.EGraph.prototype.replaceSelectionWith=function(t){var e,i,n=!1;if(t.getGraph()!==this)throw new Error("Element not in this graph");for(e=this.selection.first;e;e=i)i=e.nextSel,e!==t?this.removeFromSelection(e):n=!0;n||this.addToSelection(t)},i.EGraph.prototype.bringNodeToFront=function(t){t.bringToFront()},i.EGraph.prototype.addConnector=function(t,e){t.insertConnectorBefore(e,null)},i.EGraph.prototype.addEdge=function(t,e,i,n){this.insertEdgeBefore(t,e,i,null,n)},i.EGraph.prototype.insertEdgeBefore=function(t,e,n,o,r){var a,s,h,l,p,c;if(this.registerNewElement(n),t.getGraph()!==this)throw new Error("Connector not in this graph");if(e.getGraph()!==this)throw new Error("Connector not in this graph");if(t===e)throw new Error("Self loop not (yet) supported");if(o&&o.gr!==this)throw new Error("nextEdge not in this graph");if(o===n)throw new Error("can't insert an edge before itself");if(r&&r.autoPairSelection&&(t.internal||t.external||e.internal||e.external)){for(t=t.external||t,e=e.external||e,p=h=t.node,c=l=e.node;(p||c)&&p!==l&&c!==h;)p&&(p=p.parent),c&&(c=c.parent);p===l&&e.internal&&(e=e.internal),c===h&&t.internal&&(t=t.internal)}if(n.gr){if(n.cl1.c!==t||n.cl2.c!==e)throw new Error("can't change edge connectors with reorder; remove first");s=n.next,this.edges.remove(n),a=!0}else a=!1;if(this.edges.insertBefore(n,o),n.gr=this,a||(t.children.addLast(n.cl1),e.children.addLast(n.cl2),n.cl1.c=t,n.cl2.c=e),a)this.notify(new i.MovedNotif(["edges"],n,null,s));else{i.ObservableData.lock();try{this.notify(new i.AddedNotif(["edges"],n,null)),t.notify(new i.AddedNotif(["children"],n.cl1,null)),e.notify(new i.AddedNotif(["children"],n.cl2,null))}finally{i.ObservableData.unlock()}}},i.EGraph.prototype.update=function(t){e("stack dump")},i}),define("egraph/core",["DS/egraph/core"],function(t){return t}),define("DS/egraph/views",["DS/egraph/core","DS/egraph/utils"],function(t,e){"use strict";var i={},n="http://www.w3.org/2000/svg",o=document.createElementNS(n,"svg"),r=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame,a=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame;function s(t,e,i,n){var o,r,a;r=(o=t.getParent())?o.views[i.viewKey]:null,a=n?n.views[i.viewKey]:null,this.onposition(t,n,i,r,a)}function h(t,e,i,n){e&&this.onmodify(t,e,i),s.call(this,t,e,i,n)}function l(t){var e,i,n;for(e in t)t.hasOwnProperty(e)&&(i=t[e])&&(t[e]=null,(n=i.parentNode||i.parentLayer)&&n.removeChild(i))}function p(t,i,n){var o,r;for(o in t)t.hasOwnProperty(o)&&(r=t[o])&&r.className&&(n?e.classListAdd(r,i):e.classListRemove(r,i))}function c(e,i,n){t.inPathSet(n,"selected")&&p(e,"selected",i.selected),t.inPathSet(n,"hidden")&&p(e,"hidden",i.hidden)}function u(t,e,i,n){this.state=0,this.boundAnimCB=this.animCB.bind(this),this.requestID=r(this.boundAnimCB),this.start=null,this.duration=100,this.vpt1=e.slice(),this.vpt2=i.slice(),this.target=t,this.cb=n}function d(t){var e=[];return function t(i,n){var o;if("object"!=typeof n)e.push(i.join("."));else for(o in n)n.hasOwnProperty(o)&&t(i.concat(o),n[o])}([],t),e.join(",")}i.EltView=function(){},i.EltView.prototype.oninsert=function(t,e,i,n){2&this.__viewFlag__?h.call(this,t,e,i,n):(this.__viewFlag__|=2,this.oncreate(t,i),this.onmodify(t,!0,i),s.call(this,t,e,i,n))},i.EltView.prototype.onreorder=function(t,e,i,n){h.call(this,t,e,i,n)},i.EltView.prototype.onupdate=function(t,e,i){2&this.__viewFlag__&&this.onmodify(t,e,i)},i.EltView.prototype.onselect=function(){},i.EltView.prototype.onremove=function(t,e,i,n){n||(this.__viewFlag__&=-3,this.ondestroy(t,i))},i.EltView.prototype.oncreate=function(t,e){},i.EltView.prototype.onposition=function(t,e,i,n,o){},i.EltView.prototype.onmodify=function(t,e,i){},i.EltView.prototype.ondestroy=function(t,e){},i.LayeredEltView=function(){i.EltView.call(this)},e.inherit(i.LayeredEltView,i.EltView),i.LayeredEltView.prototype.oncreate=function(t,e){this.oncreateStructure(t,e),this.oncreateDisplay(t,e)},i.LayeredEltView.prototype.onposition=function(t,e,i,n,o){this.onpositionStructure(t,e,i,n,o)},i.LayeredEltView.prototype.onmodify=function(t,e,i){this.onmodifyStructure(t,e,i),e&&this.onvoteResetDisplay(t,e,i)?(this.ondestroyDisplay(t,i),this.oncreateDisplay(t,i),this.onmodifyDisplay(t,!0,i)):this.onmodifyDisplay(t,e,i)},i.LayeredEltView.prototype.ondestroy=function(t,e){this.ondestroyDisplay(t,e),this.ondestroyStructure(t,e)},i.LayeredEltView.prototype.oncreateStructure=function(t,e){},i.LayeredEltView.prototype.onpositionStructure=function(t,e,i,n,o){},i.LayeredEltView.prototype.onmodifyStructure=function(t,e,i){},i.LayeredEltView.prototype.ondestroyStructure=function(t,e){},i.LayeredEltView.prototype.oncreateDisplay=function(t,e){},i.LayeredEltView.prototype.onvoteResetDisplay=function(t,e,i){return!1},i.LayeredEltView.prototype.onmodifyDisplay=function(t,e,i){},i.LayeredEltView.prototype.ondestroyDisplay=function(t,e){},i.DOMView=function(){i.LayeredEltView.call(this),this.display={},this.structure={},this["deprecated-elts"]={},this["deprecated-lays"]={}},i.HTMLView=i.DOMView,e.inherit(i.DOMView,i.LayeredEltView),t.makeRewriter(i.DOMView.prototype,"elts",void 0,["deprecated-elts"]),t.makeRewriter(i.DOMView.prototype,"lays",void 0,["deprecated-lays"]),i.DOMView.prototype.ondestroy=function(){i.LayeredEltView.prototype.ondestroy.apply(this,arguments),this["deprecated-elts"]&&l(this["deprecated-elts"]),this["deprecated-lays"]&&l(this["deprecated-lays"])},i.DOMView.prototype.ondestroyStructure=function(){i.LayeredEltView.prototype.ondestroyStructure.apply(this,arguments),l(this.structure)},i.DOMView.prototype.onpositionStructure=function(t,e,i,n,o){var r,a,s,h,l;if(this.reorderElts&&this["deprecated-elts"]||this.reorderLays&&this["deprecated-lays"]){if(this.reorderElts&&this["deprecated-elts"])for(s=0,h=this.reorderElts.length;s<h;++s)a=this.reorderElts[s],(r=this["deprecated-elts"][a])&&(o&&((l=o["deprecated-elts"]&&o["deprecated-elts"][a])||console.log(new Error("next not built").stack)),r.parentNode.insertBefore(r,l));if(this.reorderLays&&this["deprecated-lays"])for(s=0,h=this.reorderLays.length;s<h;++s)a=this.reorderLays[s],(r=this["deprecated-lays"][a])&&r.parentLayer&&(o&&((l=o["deprecated-lays"]&&o["deprecated-lays"][a])||console.log(new Error("next not built").stack)),r.parentLayer.insertBefore(r,l))}},i.DOMView.prototype.onmodifyStructure=function(t,e){c.call(this,this.structure,t,e)},i.DOMView.prototype.ondestroyDisplay=function(){i.LayeredEltView.prototype.ondestroyDisplay.apply(this,arguments),l(this.display)},i.DOMView.prototype.onmodifyDisplay=function(t,e){c.call(this,this.display,t,e),this["deprecated-elts"]&&c.call(this,this["deprecated-elts"],t,e)},i.PickableEdgeView=function(){},i.PickableEdgeView.prototype.isRectanglePicked=function(i,n,o,r,a,s,h){var l,p,c,u,d,g,f,y,m,v,w,b,E;for(s?(b=!0,v=e.isSegmentIntersectingRect,w=e.isBezierIntersectingRect):(b=!1,v=function(){return!e.isSegmentInRect.apply(void 0,arguments)},w=function(t,i,n,o,r,a,s,h,l,p,c,u,d){return!e.isBezierInRect(t,i,n,o,r,a,s,h,l,p,c,u)}),E=.5*h.invAnimVptScale,m=!0,l=0,p=i.path.length;l<p;)switch(i.path[l]){case t.PathCmd.M:c=i.path[l+1],u=i.path[l+2],l+=3;break;case t.PathCmd.L:if(m=!1,v(c,u,d=i.path[l+1],g=i.path[l+2],n,o,r,a))return b;c=d,u=g,l+=3;break;case t.PathCmd.C:if(f=i.path[l+1],y=i.path[l+2],m=!1,w(c,u,d=i.path[l+3],g=i.path[l+4],i.path[l+5],i.path[l+6],f,y,n,o,r,a,E))return b;c=f,u=y,l+=7;break;default:throw new Error("unknown path command "+i.path[l])}return!s&&!m},i.SVGEdgeView=function(t){i.DOMView.call(this),i.PickableEdgeView.call(this),t&&(this.className=t)},e.inherit(i.SVGEdgeView,i.DOMView),e.applyMixin(i.SVGEdgeView,i.PickableEdgeView),i.SVGEdgeView.prototype.className="egraph_views_SVGEdgeView",i.SVGEdgeView.prototype.oncreateStructure=function(t,e){i.DOMView.prototype.oncreateStructure.apply(this,arguments),this.structure.root=document.createElementNS(n,"g")},i.SVGEdgeView.prototype.onpositionStructure=function(t,e,n,o,r){i.DOMView.prototype.onpositionStructure.apply(this,arguments),(n.structure?n.structure.edges:n.edgesLayer).group.insertBefore(this.structure.root,r?r.structure.root:null);let a=!1;if(t&&t.gr&&t.gr.viewOpts&&(a=t.gr.viewOpts.addTopologicalIds),!0===a){let e,i;if(null!==t.cl1.c.views.main&&(e=t.cl1.c.views.main.display.elt.getAttribute("tid")),null!==t.cl2.c.views.main&&(i=t.cl2.c.views.main.display.elt.getAttribute("tid")),null!==e&&""!==e&&null!==i&&""!==i){let n=`${e}##${i}`;t&&t.gr&&t.gr.edgePickingAreaOpts&&t.gr.edgePickingAreaOpts.activate?this.display.pickingAreaElt.setAttribute("tid",n):this.display.elt.setAttribute("tid",n)}}},i.SVGEdgeView.prototype.oncreateDisplay=function(t,e){i.DOMView.prototype.oncreateDisplay.apply(this,arguments);let o=!1;if(t&&t.gr&&t.gr.edgePickingAreaOpts&&(o=t.gr.edgePickingAreaOpts.activate),o){if(this.display.pickingAreaElt=document.createElementNS(n,"path"),t.gr.edgePickingAreaOpts.size&&t.gr.edgePickingAreaOpts.size%1==0&&(this.display.pickingAreaElt.style.strokeWidth=t.gr.edgePickingAreaOpts.size,this.display.pickingAreaElt.style.strokeOpacity=0),this.display.pickingAreaElt.grElt=t,this.className){const t="egraph_edgeview_pickingarea";this.display.pickingAreaElt.setAttribute("class",t)}this.structure.root.appendChild(this.display.pickingAreaElt)}this.display.elt=document.createElementNS(n,"path"),this.display.elt.grElt=t,this.className&&this.display.elt.setAttribute("class",this.className),o&&(this.display.elt.style.pointerEvents="none"),this.structure.root.appendChild(this.display.elt),this["deprecated-elts"].elt=this.display.elt},i.SVGEdgeView.prototype.onmodifyDisplay=function(e,n,o){var r,a,s,h,l,p;if(i.DOMView.prototype.onmodifyDisplay.apply(this,arguments),t.inPathSet(n,"path")){r=this.display.elt,a=this.display.pickingAreaElt,l="";t:for(s=0,h=e.path.length;s<h;){switch(e.path[s]){case t.PathCmd.M:p="M"+e.path[s+1]+" "+e.path[s+2],s+=3;break;case t.PathCmd.L:p="L"+e.path[s+1]+" "+e.path[s+2],s+=3;break;case t.PathCmd.C:p="C"+e.path[s+3]+" "+e.path[s+4]+" "+e.path[s+5]+" "+e.path[s+6]+" "+e.path[s+1]+" "+e.path[s+2],s+=7;break;default:throw new Error("Unsupported PathCmd: "+e.path[s])}l+=p}r.setAttribute("d",l),a&&a.setAttribute("d",l)}},i.SVGLayer=function(){this.elt=document.createElementNS(n,"svg"),this.elt.setAttribute("width","100%"),this.elt.setAttribute("height","100%"),this.group=document.createElementNS(n,"g"),this.elt.appendChild(this.group),this.children=new t.List,this.transfo=this.group.transform.baseVal.insertItemBefore(o.createSVGTransform(),0),this.parentLayer=null},i.SVGLayer.prototype.leaf=!0,i.SVGLayer.prototype.name="svg",i.SVGLayer.prototype.remove=function(){this.parentLayer&&this.parentLayer.removeChild(this)},i.SVGLayer.prototype.updateClasses=function(t){this.elt.className.baseVal=t.svgLayerClass},i.SVGLayer.prototype.viewpointChanged=function(t){this.transfo.matrix.e=t[0],this.transfo.matrix.f=t[1],this.transfo.matrix.a=this.transfo.matrix.d=t[2],e.isIE()&&this.elt.parentNode&&this.elt.parentNode.insertBefore(this.elt,this.elt)},i.SVGLayer.prototype.insertNewSVGLayer=function(t){var e;return e=new i.SVGSubLayer,this.insertBefore(e,t),e},i.SVGLayer.prototype.insertBefore=function(t,e){if(e&&e.parentLayer!==this)throw Error("Next layer not in this layer");if(!(t instanceof i.SVGSubLayer))throw new Error("Layer is not an SVGSubLayer");t.parentLayer!==this&&(t.remove(),t.parentLayer=this),this.children.insertBefore(t,e),this.group.insertBefore(t.group,e&&e.group||null)},i.SVGLayer.prototype.removeChild=function(t){if(t.parentLayer!==this)throw new Error("Layer not in this layer");t.parentLayer=null,this.children.removeChild(child),this.group.removeChild(t.group)},i.SVGSubLayer=function(){this.group=document.createElementNS(n,"g"),this.parentLayer=null},i.SVGSubLayer.prototype.leaf=!0,i.SVGSubLayer.prototype.name="svg-sub",i.SVGSubLayer.prototype.remove=i.SVGLayer.prototype.remove,i.HtmlLeafLayer=function(){this.elt=document.createElement("div"),this.parentLayer=null},i.HtmlLeafLayer.prototype.leaf=!0,i.HtmlLeafLayer.prototype.name="html",i.HtmlLeafLayer.prototype.remove=i.SVGLayer.prototype.remove,i.HtmlLeafLayer.prototype.viewpointChanged=function(t,e){this.elt.style.transform=e,this.elt.style.webkitTransform=e,this.elt.style.msTransform=e},i.HtmlLeafLayer.prototype.updateClasses=function(t){this.elt.className=t.htmlLayerClass},i.GroupLayer=function(){this.children=new t.List,this.parentLayer=null},i.GroupLayer.prototype.elt=null,i.GroupLayer.prototype.leaf=!1,i.GroupLayer.prototype.name="group",i.GroupLayer.prototype.remove=i.SVGLayer.prototype.remove,i.GroupLayer.prototype.insertNewSVGLayer=function(t){var e;return e=new i.SVGLayer,this.insertBefore(e,t),e},i.GroupLayer.prototype.newSVGLayer=function(){return new i.SVGLayer},i.dftNextLayer=function(t,e,i){if(!i&&e.children&&e.children.first)return e.children.first;for(;e!==t&&!e.next;)e=e.parentLayer;return e!==t?e.next:null},i.GroupLayer.prototype.insertBefore=function(t,e){var n,o,r,a,s;if(t instanceof i.SVGSubLayer)throw new Error("SVGSubLayer can only be inserted in an SVGLayer");if(t instanceof i.RootLayer)throw new Error("A RootLayer must be at root of the layers' tree");if(e&&e.parentLayer!==this)throw new Error("nextLayer is not in this group layer");if(t===e)throw new Error("layer can't be inserted before itself");for(o=this,n=null;o;n=o,o=o.parentLayer)if(o===t)throw new Error("layer is an ancestor of this group");if(s=t.parentLayer===this,t.remove(),this.children.insertBefore(t,e),t.parentLayer=this,n.elt){for(r=i.dftNextLayer(null,t,!0);r&&!r.leaf;r=i.dftNextLayer(null,r));for(a=r?r.elt:null,n.viewpointChanged(n.vpt,n.cssTransform),o=t;o;o=i.dftNextLayer(t,o,o.leaf))o.leaf&&(s||o.updateClasses(n),n.elt.insertBefore(o.elt,a))}},i.GroupLayer.prototype.insertNewGroupLayer=function(t){var e;return e=new i.GroupLayer,this.insertBefore(e,t),e},i.GroupLayer.prototype.newGroupLayer=function(){return new i.GroupLayer},i.GroupLayer.prototype.insertNewLeafHtmlLayer=function(t){var e;return e=new i.HtmlLeafLayer,this.insertBefore(e,t),e},i.GroupLayer.prototype.newLeafHtmlLayer=function(){return new i.HtmlLeafLayer},i.GroupLayer.prototype.removeChild=function(t){var e,i,n;if(t.parentLayer!==this)throw new Error("childLayer not in this layer");for(e=null,i=this;i;e=i,i=i.parentLayer);if(i=t,n=e.elt)for(;i;)if(!i.leaf&&i.children.first)i=i.children.first;else{for(i.leaf&&n.removeChild(i.elt);i&&i!==t;i=i.parentLayer)if(i.next){i=i.next;break}i===t&&(i=null)}this.children.remove(t),t.parentLayer=null},i.RootLayer=function(t,e,n){i.GroupLayer.call(this),this.svgLayerClass=e||"egraph_views_SVGLayer",this.htmlLayerClass=n||"egraph_views_HtmlLayer",this.elt=document.createElement("div"),this.elt.className=t||"egraph_views_RootLayer",this.vpt=[0,0,1]},e.inherit(i.RootLayer,i.GroupLayer),i.RootLayer.prototype.name="root",i.RootLayer.prototype.setViewpoint=function(t){this.vpt[0]=t[0],this.vpt[1]=t[1],this.vpt[2]=t[2],this.cssTransform="translate("+t[0].toFixed(5)+"px,"+t[1].toFixed(5)+"px) scale("+t[2].toFixed(5)+")",this.viewpointChanged(this.vpt,this.cssTransform)},i.RootLayer.prototype.viewpointChanged=function(t,e){this.elt.style.transform=e,this.elt.style.webkitTransform=e,this.elt.style.msTransform=e},i.RootLayer.prototype.toTreeString=function(){var t,e;return t=[],e="  ",function i(n,o){var r,a;if(t.push(o),n.leaf&&t.push("*"),t.push(n.name,"\n"),n.children)for(a=o+e,r=n.children.first;r;r=r.next)i(r,a)}(this,"  "),t.join("")},u.prototype.cancel=function(){this.state||(this.state=2,a(this.requestID))},u.prototype.animCB=function(t){var i,n,o,a;if(!this.state){for(null===this.start&&(this.start=t),i=t-this.start,n=e.clamp(i/this.duration,0,1),o=[],a=0;a<3;++a)o[a]=(1-n)*this.vpt1[a]+n*this.vpt2[a];this.target.setViewpoint(o),i<this.duration&&(this.requestID=r(this.boundAnimCB)),this.cb&&this.cb(o)}},i.OneViewPerElt=function(){t.GraphView.call(this)},e.inherit(i.OneViewPerElt,t.GraphView),i.OneViewPerElt.prototype.oninit=function(e,i){var n,o,r,a;function s(t){t.views[i]?console.log("    "+t+": oninsert(null)"):console.log("    "+t+": no view")}function h(t){t.views[i]&&t.views[i].oninsert&&t.views[i].oninsert(t,null,a)}if(t.GraphView.prototype.oninit.apply(this,arguments),this.domRoot&&this.domRoot.setAttribute("mouse-profile",e.mouseProfile),a=this,t.EGraph.traceUpdates){for(console.log("  calling views "+i+":"),n=e.nodes.first;n;n=t.dftNext(e,n))for(s(n),o=n.children.first;o;o=o.next)s(o);for(r=e.edges.first;r;r=r.next)s(r)}for(n=e.nodes.first;n;n=t.dftNext(e,n))for(h(n),o=n.children.first;o;o=o.next)h(o);for(r=e.edges.first;r;r=r.next)h(r)};var g=[t.Type.EGRAPH,t.Type.GROUP,t.Type.NODE,t.Type.CONNECTOR,t.Type.EDGE];function f(t,e){function i(t,e){if("number"!=typeof e||!isFinite(e)||e<0)throw new Error(t+" should be a finite positive number")}return void 0===t&&void 0===e?(t=this.domRoot.offsetWidth,e=this.domRoot.offsetHeight):(i("width",t),i("height",e)),(this.width!==t||this.height!==e)&&(this.width=t,this.height=e,!0)}function y(e){e.type!==t.Type.GROUP||e.collapsed?this.structure.nodeRoot.insertBefore(this.structure.connsGroup):this.structure.groupConnectorsRoot.insertBefore(this.structure.connsGroup,this.structure.groupsConnectors),e.type!==t.Type.GROUP||e.collapsed?this.structure.nodeRoot.insertBefore(this.structure.nodeLayer,this.connsInFront?this.structure.connsGroup:null):this.structure.groupRoot.insertBefore(this.structure.nodeLayer,this.structure.groups)}function m(){var t;if(!(isNaN(this.x1)||isNaN(this.y1)||isNaN(this.x2)||isNaN(this.y2))){if(!(t=this.grView.animVpt))throw new Error("grView.animVpt can't be null/undefined");this.rect.x.baseVal.value=Math.round(Math.min(this.x1,this.x2)*t[2]+t[0]),this.rect.y.baseVal.value=Math.round(Math.min(this.y1,this.y2)*t[2]+t[1]),this.rect.width.baseVal.value=Math.max(1,Math.round(Math.abs(this.x2-this.x1)*t[2])),this.rect.height.baseVal.value=Math.max(1,Math.round(Math.abs(this.y2-this.y1)*t[2]))}}function v(t){var e,i,n,o,r,a,s,h,l,p,c,u,d,g,f;if(t&&"resize"===t.type?(this.view_width=t.size[0],this.view_height=t.size[1]):(isNaN(this.view_width)||isNaN(this.view_height))&&(c=this.grView.getSize(),this.view_width=c[0],this.view_height=c[1]),isFinite(this.x1)&&isFinite(this.y1)&&isFinite(this.x2)&&isFinite(this.y2)){if(this.pathVisible||(this.path.style.display="",this.pathVisible=!0),!(e=this.grView.animVpt))throw new Error("grView.animVpt can't be null/undefined");o=Math.abs(this.x2-this.x1)*e[2],r=Math.abs(this.y2-this.y1)*e[2],o<this.minDiameter&&(r*=this.minDiameter/o,o=this.minDiameter),r<this.minDiameter&&(o*=this.minDiameter/r,r=this.minDiameter),i=.5*(this.x1+this.x2)*e[2]+e[0]-.5*o,n=.5*(this.y1+this.y2)*e[2]+e[1]-.5*r,i=Math.round(i),n=Math.round(n),a=i+(o=Math.round(o)),s=n+(r=Math.round(r)),this.pixelcenter&&(i+=.5,n+=.5,a-=.5,s-=.5),u=-(h=this.margin),d=-h,g=this.view_width+h,f=this.view_height+h,l=this.path,p="M"+u+" "+d+"L"+g+" "+d+" "+g+" "+f+" "+u+" "+f+"Z",isFinite(i)&&isFinite(n)&&isFinite(a)&&isFinite(s)&&(p+="M"+i+" "+n+"L"+i+" "+s+" "+a+" "+s+" "+a+" "+n+"Z"),l.setAttribute("d",p)}else this.pathVisible&&(this.path.style.display="none",this.pathVisible=!1)}return i.OneViewPerElt.prototype.onupdate=function(e,i){var n,o,r,a,s,h,l,p,c,u,f,y,m,v;for(t.GraphView.prototype.onupdate.apply(this,arguments),p=this.viewKey,c=[],n=0,o=g.length;n<o;++n)if(s=i[g[n]])for(r=0,a=s.length;r<a;++r)(h=s[r]).views[p]&&(c.push(h),h.views[p].__viewFlag__&=-2);for(u=[],f=[],y=[],r=0,a=c.length;r<a;++r)if(!(1&(h=c[r]).views[p].__viewFlag__))if(20&h.__updateFlag__)for(;;){for(m=h.next;m&&!m.views[p];m=m.next);if(!(m&&20&m.__updateFlag__)||1&m.views[p].__viewFlag__){for(u.push(h),f.push(m),h.views[p].__viewFlag__|=1;y.length;)m=y.pop(),h=y.pop(),u.push(h),f.push(m),h.views[p].__viewFlag__|=1;break}y.push(h),y.push(m),h=m}else h.views[p].__viewFlag__|=1,u.push(h),f.push(void 0);if(t.EGraph.traceUpdates)for(console.log("  calling views "+p+":"),r=0,a=u.length;r<a;++r)h=u[r],m=f[r],l=[],8&h.__updateFlag__&&!(4&h.__updateFlag__)?l.push("onremove("+d(h.__modifiedProperties__)+", false)"):4&h.__updateFlag__?(8&h.__updateFlag__&&l.push("onremove(null, true)"),l.push("oninsert("+d(h.__modifiedProperties__)+", "+m+")")):16&h.__updateFlag__?l.push("onreorder("+d(h.__modifiedProperties__)+", "+m+")"):h.__modifiedProperties__&&l.push("onupdate("+d(h.__modifiedProperties__)+")"),96&h.__updateFlag__&&l.push("onselect("+Boolean(32&h.__updateFlag__)+")"),l.length&&console.log("    "+h+": "+l.join(","));for(r=0,a=u.length;r<a;++r)h=u[r],m=f[r],v=h.views[p],8&h.__updateFlag__&&!(4&h.__updateFlag__)?v.onremove&&v.onremove(h,h.__modifiedProperties__,this,!1):4&h.__updateFlag__?(8&h.__updateFlag__&&v.onremove&&v.onremove(h,null,this,!0),v.oninsert&&v.oninsert(h,h.__modifiedProperties__,this,m)):16&h.__updateFlag__?v.onreorder&&v.onreorder(h,h.__modifiedProperties__,this,m):h.__modifiedProperties__&&v.onupdate&&v.onupdate(h,h.__modifiedProperties__,this),96&h.__updateFlag__&&v.onselect&&v.onselect(h,Boolean(32&h.__updateFlag__),this)},i.OneViewPerElt.prototype.rectanglePick=function(e,i,n,o,r){function a(t){var r;for(r=t.first;r;r=r.next)r.hidden||(u=r.views[g])&&u.isRectanglePicked&&u.isRectanglePicked(r,e,i,n,o,c,s)&&d.push(r)}var s,h,l,p,c,u,d,g,f,y,m,v;if(s=this,!this.gr.isUpdated())throw new Error("graph is locked or there are some out of lock pending modifications");for(g=this.viewKey,f=!r||void 0===r.nodes||Boolean(r.nodes),v=!(!r||void 0===r.groups)&&Boolean(r.groups),m=!(!r||void 0===r.connectors)&&Boolean(r.connectors),y=!(!r||void 0===r.edges)&&Boolean(r.edges),p=!(!r||void 0===r.stopAtGroup)&&Boolean(r.stopAtGroup),c=!r||void 0===r.overlapping||Boolean(r.overlapping),d=[],h=this.gr.nodes.first;h;h=t.dftNext(this.gr,h,l&&p||h.collasped))l=!1,(f&&(h.type===t.Type.NODE||h.type===t.Type.GROUP&&h.collasped)||v&&h.type===t.Type.GROUP&&!h.collasped)&&(u=h.views[g])&&u.isRectanglePicked&&(l=u.isRectanglePicked(h,e,i,n,o,c,this))&&d.push(h),m&&a(h.children);return y&&a(this.gr.edges),d},i.TransformedGraphView=function(){this.vpt=[0,0,1],this.invVptScale=1,this.animVpt=[0,0,1],this.invAnimVptScale=1},i.TransformedGraphView.prototype.clientToViewpoint=function(t,i){return e.relativeToViewpoint(t,i,this.domRoot,this.vpt)},i.TransformedGraphView.prototype.getSize=function(){throw e.newNotImplError()},i.DOMGraphView=function(n,o){if(i.OneViewPerElt.call(this),t.Observable.call(this),i.TransformedGraphView.call(this),o=o||{},!n)throw new Error("container parameter can't be null");this.container=n,this.domRoot=document.createElement("div");var r="egraph_views_domroot";e.isIE()&&(r+=" egraph_browser_isIE"),this.domRoot.className=r,this.container.appendChild(this.domRoot),this.width=NaN,this.height=NaN,this.structure={},this.structure.root=new i.RootLayer(o.rootClass,o.svgClass,o.htmlClass),this.structure.root.name+=" (root)",this.domRoot.appendChild(this.structure.root.elt),this.overlayMarker=document.createElement("div"),this.overlayMarker.className="egraph_views_overlay-marker",this.domRoot.appendChild(this.overlayMarker),this.structure.groups=null,this.structure.edges=null,this.structure.groupsConnectors=null,this.structure.nodes=null,this.viewpointAnimation=null,this.animateVpt=[0,0,1],this.createStructure(),this.structure.groups.name+=" (groups)",this.structure.edges.name+=" (edges)",this.structure.groupsConnectors.name+=" (groupsConnectors)",this.structure.nodes.name+=" (nodes)",f.call(this)},e.inherit(i.DOMGraphView,i.OneViewPerElt),e.applyMixin(i.DOMGraphView,t.Observable),e.applyMixin(i.DOMGraphView,i.TransformedGraphView),t.makeRewriter(i.DOMGraphView.prototype,"rootLayer",void 0,["structure","root"]),t.makeRewriter(i.DOMGraphView.prototype,"edgesLayer",void 0,["structure","edges"]),t.makeRewriter(i.DOMGraphView.prototype,"nodesLayer",void 0,["structure","nodes"]),i.DOMGraphView.prototype.setSize=function(t,e){f.call(this,t,e)&&this.dispatch({type:"resize",size:[this.width,this.height]})},i.DOMGraphView.prototype.getSize=function(){return[this.width,this.height]},i.DOMGraphView.prototype.createStructure=function(){throw new Error("Not implemented")},i.DOMGraphView.prototype.setViewpoint=function(t,e){function i(t){var e;n.animVpt[0]=t[0],n.animVpt[1]=t[1],n.animVpt[2]=e=t[2],n.invAnimVptScale=1/e,n.dispatch({type:"animviewpoint",vpt:n.animVpt.slice()})}var n,o,a,s,h;if(n=this,o=t[0],a=t[1],s=t[2],"number"!=typeof o||!isFinite(o)||"number"!=typeof a||!isFinite(a)||"number"!=typeof s||!isFinite(s))throw new Error("vpt must be an array of 3 finite numbers");if(s<=0)throw new Error("vpt[2] must be > 0");if(h=1/s,!isFinite(h))throw new Error("vpt[2] must > 2^-1024 (else its inverse is infinite)");this.vpt[0]=o,this.vpt[1]=a,this.vpt[2]=s,this.invVptScale=h,r||(e=!1),this.viewpointAnimation&&(this.viewpointAnimation.cancel(),this.viewpointAnimation=null),this.dispatch({type:"viewpoint",vpt:this.vpt.slice()}),e?this.viewpointAnimation=new u(this.structure.root,this.structure.root.vpt,this.vpt,function(t){i(t)}):(this.structure.root.setViewpoint(this.vpt),i(this.vpt))},i.DOMGraphView.prototype.zoomone=function(){var t,i,n;t=this.domRoot.clientWidth,i=this.domRoot.clientHeight,n=e.changeViewpointScale(this.vpt,1,[t/2,i/2],!1),this.setViewpoint(n,!0)},i.DOMGraphView.prototype.zoominc=function(t,i,n,o){var r,a,s;return a=i||this.domRoot.clientWidth/2,s=n||this.domRoot.clientHeight/2,r=e.incViewpointScale(this.vpt,.5*t,[a,s],!1,o),this.setViewpoint(r,!0),r},i.HTMLGraphView=function(t,e){i.DOMGraphView.call(this,t,e)},e.inherit(i.HTMLGraphView,i.DOMGraphView),i.HTMLGraphView.prototype.createStructure=function(){this.structure.groups=this.structure.root.insertNewGroupLayer(null),this.structure.edges=this.structure.root.insertNewSVGLayer(null),this.structure.groupsConnectors=this.structure.root.insertNewGroupLayer(null),this.structure.nodes=this.structure.root.insertNewGroupLayer(null)},i.SVGGraphView=function(t,e){i.DOMGraphView.call(this,t,e)},e.inherit(i.SVGGraphView,i.DOMGraphView),i.SVGGraphView.prototype.createStructure=function(){this.structure.svgRoot=this.structure.root.insertNewSVGLayer(null),this.structure.groups=this.structure.svgRoot.insertNewSVGLayer(null),this.structure.edges=this.structure.svgRoot.insertNewSVGLayer(null),this.structure.groupsConnectors=this.structure.svgRoot.insertNewSVGLayer(null),this.structure.nodes=this.structure.svgRoot.insertNewSVGLayer(null)},i.PickableNodalView=function(){},i.PickableNodalView.prototype.isRectanglePicked=function(t,i,n,o,r,a,s){var h,l,p,c;return h=t.actualLeft,l=t.actualTop,p=h+t.actualWidth,c=l+t.actualHeight,a?e.areRectsOverlapping(h,l,p,c,i,n,o,r):e.isRectIncluded(h,l,p,c,i,n,o,r)},i.PickableConnectorView=function(){},i.PickableConnectorView.prototype.isRectanglePicked=function(t,i,n,o,r,a,s){return e.isPointInRect(t.aleft,t.atop,i,n,o,r)},i.HTMLNodeView=function(){i.DOMView.call(this),i.PickableNodalView.call(this)},e.inherit(i.HTMLNodeView,i.DOMView),e.applyMixin(i.HTMLNodeView,i.PickableNodalView),i.HTMLNodeView.prototype.connsInFront=!0,i.HTMLNodeView.prototype.resetDisplayOnCollapse=!0,i.HTMLNodeView.prototype.oncreateStructure=function(e,n){var o;i.DOMView.prototype.oncreateStructure.apply(this,arguments),o=e.toString(),this.structure.groupRoot=new i.GroupLayer,this["deprecated-lays"].groupRoot=this.structure.groupRoot,this.structure.groupRoot.name+=" (groupRoot:"+o+")",e.type===t.Type.GROUP&&(this.structure.groups=this.structure.groupRoot.insertNewGroupLayer(null),this["deprecated-lays"].groups=this.structure.groups,this.structure.groups.name+=" (groups:"+o+")"),this.structure.groupConnectorsRoot=new i.GroupLayer,this.structure.groupConnectorsRoot.name+=" (groupConnectorsRoot:"+o+")",e.type===t.Type.GROUP&&(this.structure.groupsConnectors=this.structure.groupConnectorsRoot.insertNewGroupLayer(null),this["deprecated-lays"].groupsConnectors=this.structure.groupsConnectors,this.structure.groupsConnectors.name+=" (groupsConnectors:"+o+")"),this.structure.nodeRoot=new i.GroupLayer,this["deprecated-lays"].nodeRoot=this.structure.nodeRoot,this.structure.nodeRoot.name+=" (nodeRoot:"+o+")",e.type===t.Type.GROUP&&(this.structure.nodes=this.structure.nodeRoot.insertNewGroupLayer(null),this["deprecated-lays"].nodes=this.structure.nodes,this.structure.nodes.name+=" "+o,this.structure.nodes.name+=" (nodes:"+o+")"),this.structure.connsGroup=new i.SVGLayer,this.structure.connsGroup.name+=" (connsGroup:"+o+")",this.structure.nodeLayer=new i.HtmlLeafLayer,this.structure.nodeLayer.name+=" (nodeLayer:"+o+")",y.call(this,e)},i.HTMLNodeView.prototype.oncreateDisplay=function(t,e){i.DOMView.prototype.oncreateDisplay.apply(this,arguments),this.display.elt=this.buildNodeElement(t),this["deprecated-elts"].node=this.display.elt,this.display.elt.grElt=t,this.structure.nodeLayer.elt.appendChild(this.display.elt);let n=!1;t&&t.gr&&t.gr.viewOpts&&(n=t.gr.viewOpts.addTopologicalIds),!0===n&&""!==t.id&&this.display.elt.setAttribute("tid",t.id)},i.HTMLNodeView.prototype.onpositionStructure=function(t,e,n,o,r){var a,s,h;i.DOMView.prototype.onpositionStructure.apply(this,arguments),r&&(a=r.structure.nodeRoot,s=r.structure.groupRoot,h=r.structure.groupConnectorsRoot,a&&s&&h||console.log(new Error("next not built").stack)),o.structure.groups.insertBefore(this.structure.groupRoot,s),o.structure.groupsConnectors.insertBefore(this.structure.groupConnectorsRoot,h),o.structure.nodes.insertBefore(this.structure.nodeRoot,a);let l=!1;if(t&&t.gr&&t.gr.viewOpts&&(l=t.gr.viewOpts.addTopologicalIds),!0===l&&t.parent&&t.parent.views&&t.parent.views.main&&t.parent.views.main.display){const e=t.parent.views.main.display.elt.getAttribute("tid");null!==e&&""!==e?this.display.elt.setAttribute("parent-tid",e):this.display.elt.removeAttribute("parent-tid")}},i.HTMLNodeView.prototype.buildNodeElement=(e=>{const i=document.createElement("div");return i.className=e.type!==t.Type.GROUP||e.collapsed?"egraph_views_HTMLNodeView_Node":"egraph_views_HTMLNodeView_Group",i}),i.HTMLNodeView.prototype.onmodifyStructure=function(e,n,o){i.DOMView.prototype.onmodifyStructure.apply(this,arguments),e.type===t.Type.GROUP&&t.inPathSet(n,"collapsed")&&y.call(this,e)},i.HTMLNodeView.prototype.onvoteResetDisplay=function(e,n,o){return!(e.type!==t.Type.GROUP||!this.resetDisplayOnCollapse||!t.inPathSet(n,"collapsed"))||i.DOMView.prototype.onvoteResetDisplay.apply(this,arguments)},i.HTMLNodeView.prototype.onmodifyDisplay=function(n,o,r){i.DOMView.prototype.onmodifyDisplay.apply(this,arguments),t.inPathSet(o,"actualWidth")&&(this.display.elt.style.width=e.nb2px(n.actualWidth)),t.inPathSet(o,"actualHeight")&&(this.display.elt.style.height=e.nb2px(n.actualHeight)),t.inPathSet(o,"actualLeft")&&(this.display.elt.style.left=e.nb2px(n.actualLeft)),t.inPathSet(o,"actualTop")&&(this.display.elt.style.top=e.nb2px(n.actualTop))},i.SVGConnView=function(t){i.DOMView.call(this),i.PickableConnectorView.call(this),t&&(this.className=t)},e.inherit(i.SVGConnView,i.DOMView),e.applyMixin(i.SVGConnView,i.PickableConnectorView),i.SVGConnView.prototype.className="egraph_views_SVGConnView",i.SVGConnView.prototype.oncreateStructure=function(){i.DOMView.prototype.oncreateStructure.apply(this,arguments),this.structure.root=document.createElementNS(n,"g")},i.SVGConnView.prototype.onpositionStructure=function(t,e,n,o,r){i.DOMView.prototype.onpositionStructure.apply(this,arguments),o.structure.connsGroup.group.insertBefore(this.structure.root,r?r.structure.root:null);let a=!1;if(t&&t.node&&t.node.gr&&t.node.gr.viewOpts&&(a=t.node.gr.viewOpts.addTopologicalIds),!0===a){const e=t.node.views.main.display.elt.getAttribute("tid");null!==e&&""!==e&&this.display.elt.setAttribute("parent-tid",e)}},i.SVGConnView.prototype.oncreateDisplay=function(t,e){i.DOMView.prototype.oncreateDisplay.apply(this,arguments),this.display.elt=this.buildConnElement(t),this["deprecated-elts"].elt=this.display.elt,this.display.elt.grElt=t,this.display.elt.transform.baseVal.insertItemBefore(o.createSVGTransform(),0),this.display.elt.transform.baseVal.insertItemBefore(o.createSVGTransform(),0),this.structure.root.appendChild(this.display.elt)},i.SVGConnView.prototype.buildConnElement=function(t){const e=document.createElementNS(n,"circle");e.cx.baseVal.value=0,e.cy.baseVal.value=0,e.r.baseVal.value=6.5,e.className.baseVal=this.className;let i=!1;return t&&t.node&&t.node.gr&&t.node.gr.viewOpts&&(i=t.node.gr.viewOpts.addTopologicalIds),!0===i&&""!==t.id&&e.setAttribute("tid",t.id),e},i.SVGConnView.prototype.onmodifyDisplay=function(e,n){var o;i.DOMView.prototype.onmodifyDisplay.apply(this,arguments),(t.inPathSet(n,"anormx")||t.inPathSet(n,"anormy"))&&((o=this.display.elt.transform.baseVal.getItem(1)).matrix.a=e.anormx,o.matrix.b=e.anormy,o.matrix.c=-e.anormy,o.matrix.d=e.anormx),(t.inPathSet(n,"top")||t.inPathSet(n,"left"))&&this.display.elt.transform.baseVal.getItem(0).setTranslate(e.left,e.top)},i.RectangleOverlay=function(t,e){if(!t)throw new Error("grView can't be null/undefined");if(!t.overlayMarker)throw new Error("grView.overlayMarker can't be null/undefined");if(!t.vpt)throw new Error("grView.vpt can't be null/undefined");this.grView=t,this.background=document.createElement("div"),this.background.className="egraph_views_roverlay_pos "+(e&&e.background&&e.background.className||"egraph_views_roverlay_bgnd"),t.domRoot.insertBefore(this.background,t.overlayMarker),this.rectSvg=document.createElementNS(n,"svg"),this.rectSvg.className.baseVal="egraph_views_roverlay_pos",this.rectSvg.style.height="100%",this.rectSvg.style.width="100%",this.background.appendChild(this.rectSvg),this.rect=document.createElementNS(n,"rect"),this.rect.className.baseVal=e&&e.rectangle&&e.rectangle.className||"egraph_views_roverlay_rect",this.rect.style.display="none",this.rectSvg.appendChild(this.rect),this.rectVisible=!1,this.x1=NaN,this.y1=NaN,this.x2=NaN,this.y2=NaN,this.boundUpdate=m.bind(this),t.addListener("animviewpoint",this.boundUpdate)},i.RectangleOverlay.prototype.remove=function(){this.background.parentNode&&(this.background.parentNode.removeChild(this.background),this.grView.removeListener("animviewpoint",this.boundUpdate))},i.RectangleOverlay.prototype.setRectangle=function(t,e,i,n){if(!(isFinite(t)&&isFinite(e)&&isFinite(i)&&isFinite(n)))throw new Error("x1, y1, x2, y2 must not finite");this.rectVisible||(this.rect.style.display="",this.rectVisible=!0),this.x1=t,this.y1=e,this.x2=i,this.y2=n,m.call(this)},i.PanOverlay=function(t,e){if(!t)throw new Error("grView can't be null/undefined");if(!t.overlayMarker)throw new Error("grView.overlayMarker can't be null/undefined");if(!t.vpt)throw new Error("grView.vpt can't be null/undefined");this.grView=t,this.background=document.createElement("div"),this.background.className="egraph_views_roverlay_pos "+(e&&e.background&&e.background.className||"egraph_views_roverlay_panbgnd"),t.domRoot.insertBefore(this.background,t.overlayMarker)},i.PanOverlay.prototype.remove=function(){this.background.parentNode&&this.background.parentNode.removeChild(this.background)},i.RectHoleOverlay=function(t,i){if(!t)throw new Error("grView can't be null/undefined");if(!t.overlayMarker)throw new Error("grView.overlayMarker can't be null/undefined");if(!t.vpt)throw new Error("grView.vpt can't be null/undefined");if(this.margin=15,i&&void 0!==i.margin){if("number"!=typeof i.margin||!isFinite(i.margin)||i.margin<0)throw new Error("opts.margin must be a finite >=0 number");this.margin=i.margin}this.pixelcenter=!0,i&&void 0!==i.pixelcenter&&(this.pixelcenter=Boolean(i.pixelcenter)),this.minDiameter=e.pos_integer_opt(i,"minDiameter",5),this.grView=t,this.svg=document.createElementNS(n,"svg"),this.svg.style.position="absolute",this.svg.style.left="0",this.svg.style.top="0",this.svg.style.width="100%",this.svg.style.height="100%",this.svg.style.overflow="hidden",t.domRoot.insertBefore(this.svg,t.overlayMarker),this.path=document.createElementNS(n,"path"),this.path.style.display="none",this.path.className.baseVal=e.string_opt(i,"className","egraph_views_rhoverlay_path"),this.svg.appendChild(this.path),this.pathVisible=!1,this.x1=NaN,this.y1=NaN,this.x2=NaN,this.y2=NaN,this.view_width=NaN,this.view_height=NaN,this.boundUpdate=v.bind(this),t.addListener("animviewpoint",this.boundUpdate),t.addListener("resize",this.boundUpdate)},i.RectHoleOverlay.prototype.remove=function(){this.svg.parentNode&&(this.svg.parentNode.removeChild(this.svg),this.grView.removeListener("animviewpoint",this.boundUpdate))},i.RectHoleOverlay.prototype.setRectangle=function(t,e,i,n){this.x1=Number(t),this.y1=Number(e),this.x2=Number(i),this.y2=Number(n),v.call(this)},i}),define("egraph/views",["DS/egraph/views"],function(t){return t}),define("DS/egraph/iact",["DS/egraph/core","DS/egraph/utils","DS/egraph/views","DS/Tweakers/GeneratedToolbar","DS/Tweakers/TypeRepresentationFactory"],function(t,e,i,n,o){"use strict";var r={Buttons:{LEFT:1,RIGHT:2,MIDDLE:4}},a=[r.Buttons.LEFT,r.Buttons.MIDDLE,r.Buttons.RIGHT];const s=function(t,e){if(!e.inside)return;const i=t.graphView;let n=void 0,o=void 0,r=!0;i.gr.zoomOpts&&(i.gr.zoomOpts.customMgt?r=!1:(i.gr.zoomOpts.min&&!isNaN(i.gr.zoomOpts.min)&&(n=i.gr.zoomOpts.min),i.gr.zoomOpts.max&&!isNaN(i.gr.zoomOpts.max)&&(o=i.gr.zoomOpts.max))),r&&i.zoominc&&i.zoominc(.5*e.wheelDelta,e.clientPos[0],e.clientPos[1],[n,o,.25])},h=function(t,e){e&&e.inside&&t&&t.graphView&&t.graphView.vpt&&t.graph.updateEdgesPickingAreasSize(t.graphView.vpt[2])},l=function(t,e=!1){t.enddrag(!1),this.endcb&&this.endcb();const i={consume:!0};return e||(i.state=null),i},p=function(e,i){let n;if(e.edgeRerouteOptions.active&&i.grElt.type===t.Type.CONNECTOR&&(i.modifiers&e.edgeRerouteOptions.modifier?n=r.GetRerouteDrag.call(this,e,i.grElt,!1):e.edgeRerouteOptions.alwaysRerouteSelection&&(n=r.GetRerouteDrag.call(this,e,i.grElt,!0)),n))return e.startdrag(n),{consume:!0,state:r.EndDragOnLeftState};if(i.grElt.type===t.Type.EDGE&&i.grElt.geometry&&i.grElt.geometry.reshapable)return n=new r.EdgeReshapingDrag(e.graph,i.grElt),e.startdrag(n),{consume:!0,state:r.EndDragOnLeftState};if(i.modifiers===r.Modifiers.SHIFT)e.graph.isSelected(i.grElt)?e.graph.removeFromSelection(i.grElt):e.graph.addToSelection(i.grElt);else if(0===i.modifiers){if(!e.graph.isSelected(i.grElt)){e.graph.updateLock();try{e.graph.replaceSelectionWith(i.grElt),i.grElt.bringToFront&&i.grElt.bringToFront()}finally{e.graph.updateUnlock()}}if(n=this.newDragForElement(e.graph,i.grElt,i.subElt))return e.startdrag(n),{consume:!0,state:r.EndDragOnLeftState}}return{consume:!0}};function c(t,e){return function(i,n){return r.EGraphMouseProfiles[i.graph.mouseProfile]&&r.EGraphMouseProfiles[i.graph.mouseProfile][t]&&r.EGraphMouseProfiles[i.graph.mouseProfile][t][e]?r.EGraphMouseProfiles[i.graph.mouseProfile][t][e].call(this,i,n):{}}}function u(t){this.next=null,this.prev=null,this.target=t,this.count=0}function d(t,e){this.identifier=t,this.dragStart=null,this.touchTarget=e}r.EGraphMouseProfiles={[t.EGraphMouseProfileNames.LEGACY]:(()=>({DefaultRootState:{onmousedown:function(t,e){return e.inside&&e.button===r.Buttons.LEFT?e.modifiers&r.Modifiers.ALT?(e.modifiers&r.Modifiers.CTRL?t.startdrag(new r.ViewpointScaleDrag(t.graphView,e.graphPos)):t.startdrag(new r.ViewpointMoveDrag(t.graphView)),{consume:!0,state:r.EndDragOnLeftState}):e.grElt?p.call(this,t,e):(0===e.modifiers&&t.graph.clearSelection(),e.modifiers&r.Modifiers.CTRL?t.startdrag(new r.ViewpointScaleDrag(t.graphView,e.graphPos)):t.startdrag(new r.ViewpointMoveDrag(t.graphView)),{consume:!0,state:r.EndDragOnLeftState}):{}}},EndDragOnLeftRelease:{onmouseup:function(t,e){return e.button===r.Buttons.LEFT?l.call(this,t):{}}},StateMachine:{preprocessing:{onwheel:function(t,e){s.call(this,t,e)}},postprocessing:{onwheel:function(t,e){h.call(this,t,e)}}},PanGrabWait:{onmousedown:function(t,e){return e.inside&&e.button===r.Buttons.LEFT?(e.modifiers&r.Modifiers.CTRL?t.startdrag(new r.ViewpointScaleDrag(t.graphView,e.graphPos)):t.startdrag(new r.ViewpointMoveDrag(t.graphView)),{consume:!0,state:new r.PanGrabDrag(this.overlay)}):{}}},PanGrabDrag:{onmouseup:function(t,e){if(e.button===r.Buttons.LEFT){t.enddrag(!1);var i={};return i.overlay=this.overlay,{consume:!0,state:new r.PanGrabWait(i)}}return{}}}}))(),[t.EGraphMouseProfileNames.CATIA]:(()=>({DefaultRootState:{onmousedown:function(t,e){if(!e.inside)return{};if(e.button===r.Buttons.LEFT){if(e.grElt)return p.call(this,t,e);0===e.modifiers&&t.graph.clearSelection()}else if(e.button===r.Buttons.MIDDLE&&!e.grElt)return{consume:!0,state:new r.WaitingAfterMiddlePressedState};return{}}},EndDragOnLeftRelease:{onmouseup:function(t,e){return e.button===r.Buttons.LEFT?l.call(this,t):{}}},EndDragOnMouseRelease:{onmouseup:function(t,e){let i={};return this.releaseButton===r.Buttons.MIDDLE&&e.button===this.releaseButton&&(i=l.call(this,t),!0===this.isScaling&&h.call(this,t,e)),i},oncontextmenu:function(t,e){return this.releaseButton===r.Buttons.MIDDLE&&e.button===r.Buttons.RIGHT?{consume:!0}:{}}},WaitingAfterMiddlePressedState:{onmouseup:function(t,e){return e.button===r.Buttons.MIDDLE?{consume:!0,state:null}:{}},onmousemove:function(t,e){return t.startdrag(new r.ViewpointMoveDrag(t.graphView)),{consume:!0,state:new r.EndDragOnMouseRelease(r.Buttons.MIDDLE)}},onmousedown:function(t,e){return e.button===r.Buttons.LEFT||e.button===r.Buttons.RIGHT?(t.startdrag(new r.ViewpointScaleDrag(t.graphView,e.graphPos)),{consume:!0,state:new r.EndDragOnMouseRelease(r.Buttons.MIDDLE,!0)}):{}}},StateMachine:{preprocessing:{onwheel:function(t,e){s.call(this,t,e)}},postprocessing:{onwheel:function(t,e){h.call(this,t,e)}}},PanGrabWait:{onmousedown:function(t,e){return e.inside&&e.button===r.Buttons.MIDDLE?{consume:!0,state:new r.PanGrabWaitAfterMiddlePressed(this.overlay)}:{}}},PanGrabWaitAfterMiddlePressed:{onmouseup:function(t,e){if(e.button===r.Buttons.MIDDLE){var i={};return i.overlay=this.overlay,{consume:!0,state:new r.PanGrabWait(i)}}return{}},onmousemove:function(t,e){return t.startdrag(new r.ViewpointMoveDrag(t.graphView)),{consume:!0,state:new r.PanGrabDrag(this.overlay)}},onmousedown:function(t,e){return e.button===r.Buttons.LEFT||e.button===r.Buttons.RIGHT?(t.startdrag(new r.ViewpointScaleDrag(t.graphView,e.graphPos)),{consume:!0,state:new r.PanGrabDrag(this.overlay)}):{}}},PanGrabDrag:{onmouseup:function(t,e){if(e.button===r.Buttons.MIDDLE){t.enddrag(!1);var i={};return i.overlay=this.overlay,{consume:!0,state:new r.PanGrabWait(i)}}return{}},ontouchend:function(t,e){t.enddrag(!1);var i={};return i.overlay=this.overlay,e.graphTouches.length?{consume:!0,state:new r.PanGrabWait(i)}:{consume:!1,state:new r.PanGrabWait(i)}}}}))(),[t.EGraphMouseProfileNames["3DEXPERIENCE"]]:(()=>({DefaultRootState:{onmousedown:function(t,e){if(!e.inside)return{};if(e.button===r.Buttons.LEFT){if(e.grElt)return p.call(this,t,e);0===e.modifiers&&t.graph.clearSelection()}else if(e.button===r.Buttons.MIDDLE){if(!e.grElt)return t.startdrag(new r.ViewpointMoveDrag(t.graphView)),{consume:!0,state:new r.EndDragOnMouseRelease(r.Buttons.MIDDLE)}}else if(e.button===r.Buttons.RIGHT)return{consume:!0,state:new r.CtxMenuState};return{}}},EndDragOnLeftRelease:{onmouseup:function(t,e){return e.button===r.Buttons.LEFT?l.call(this,t):{}}},EndDragOnMouseRelease:{onmouseup:function(t,e){if(e.button===this.releaseButton){if(this.releaseButton===r.Buttons.MIDDLE)return l.call(this,t);if(this.releaseButton===r.Buttons.RIGHT)return h.call(this,t,e),l.call(this,t,!0)}return{}},oncontextmenu:function(t,e){return this.releaseButton===r.Buttons.RIGHT?{consume:!0,state:null}:{}}},CtxMenuState:{onmouseup:function(t,e){return e.button===r.Buttons.RIGHT?{consume:!0,state:null}:{}},onmousemove:function(t,e){return t.startdrag(new r.ViewpointScaleDrag(t.graphView,e.graphPos)),{consume:!0,state:new r.EndDragOnMouseRelease(r.Buttons.RIGHT)}}},StateMachine:{preprocessing:{onwheel:function(t,e){s.call(this,t,e)}},postprocessing:{onwheel:function(t,e){h.call(this,t,e)}}},PanGrabWait:{onmousedown:function(t,e){return e.inside?(e.button===r.Buttons.RIGHT?t.startdrag(new r.ViewpointScaleDrag(t.graphView,e.graphPos)):e.button===r.Buttons.MIDDLE&&t.startdrag(new r.ViewpointMoveDrag(t.graphView)),{consume:!0,state:new r.PanGrabDrag(this.overlay)}):{}}},PanGrabDrag:{onmouseup:function(t,e){if(e.button===r.Buttons.RIGHT||e.button===r.Buttons.MIDDLE){t.enddrag(!1);var i={};return i.overlay=this.overlay,{consume:!0,state:new r.PanGrabWait(i)}}return{}},ontouchend:function(t,e){t.enddrag(!1);var i={};return i.overlay=this.overlay,e.graphTouches.length?{consume:!0,state:new r.PanGrabWait(i)}:{consume:!1,state:new r.PanGrabWait(i)}}}}))(),[t.EGraphMouseProfileNames.SOLIDWORKS]:(()=>({DefaultRootState:{onmousedown:function(t,e){if(!e.inside)return{};if(e.button===r.Buttons.LEFT){if(e.grElt)return p.call(this,t,e);0===e.modifiers&&t.graph.clearSelection()}else if(e.button===r.Buttons.MIDDLE&&!e.grElt)return e.modifiers===r.Modifiers.SHIFT?(t.startdrag(new r.ViewpointScaleDrag(t.graphView,e.graphPos)),{consume:!0,state:new r.EndDragOnMouseRelease(r.Buttons.MIDDLE,!0)}):(t.startdrag(new r.ViewpointMoveDrag(t.graphView)),{consume:!0,state:new r.EndDragOnMouseRelease(r.Buttons.MIDDLE)});return{}}},EndDragOnLeftRelease:{onmouseup:function(t,e){return e.button===r.Buttons.LEFT?l.call(this,t):{}}},EndDragOnMouseRelease:{onmouseup:function(t,e){let i={};return this.releaseButton===r.Buttons.MIDDLE&&e.button===this.releaseButton&&(i=l.call(this,t),!0===this.isScaling&&h.call(this,t,e)),i}},StateMachine:{preprocessing:{onwheel:function(t,e){s.call(this,t,e)}},postprocessing:{onwheel:function(t,e){h.call(this,t,e)}}},PanGrabWait:{oninstall:function(t){this.overlay||(this.overlay=new i.PanOverlay(t.graphView)),t.enddrag(!0)},onuninstall:function(t,e){e&&this.overlay&&this.overlay.remove()},onmousedown:function(t,e){return e.inside&&e.button===r.Buttons.LEFT?(e.modifiers&r.Modifiers.CTRL?t.startdrag(new r.ViewpointScaleDrag(t.graphView,e.graphPos)):t.startdrag(new r.ViewpointMoveDrag(t.graphView)),{consume:!0,state:new r.PanGrabDrag(this.overlay)}):{}},ontouchstart:function(t,e){return 2===e.changedTouches.length?{consume:!0,state:r.TwoPointsViewpointWait}:e.changedTouches.length>2?{consume:!0,state:r.WaitLastTouch}:1!==e.graphTouches.length?{consume:!0,state:r.WaitLastTouch}:(t.startdrag(new r.TwoPointsViewpointWait(t.graphView)),{consume:!0,state:new r.PanGrabDrag(this.overlay)})},onwheel:function(t,e){return e.inside?{consume:!0}:{}}},PanGrabDrag:{onmouseup:function(t,e){if(e.button===r.Buttons.LEFT){t.enddrag(!1);var i={};return i.overlay=this.overlay,{consume:!0,state:new r.PanGrabWait(i)}}return{}},ontouchend:function(t,e){t.enddrag(!1);var i={};return i.overlay=this.overlay,e.graphTouches.length?{consume:!0,state:new r.PanGrabWait(i)}:{consume:!1,state:new r.PanGrabWait(i)}}}}))()},r.EndDragOnMouseRelease=function(t,e){this.releaseButton=t,this.isScaling=e},r.EndDragOnMouseRelease.prototype.onmouseup=c("EndDragOnMouseRelease","onmouseup"),r.EndDragOnMouseRelease.prototype.oncontextmenu=c("EndDragOnMouseRelease","oncontextmenu"),r.CtxMenuState=function(){},r.CtxMenuState.prototype.onmouseup=c("CtxMenuState","onmouseup"),r.CtxMenuState.prototype.onmousemove=c("CtxMenuState","onmousemove"),r.WaitingAfterMiddlePressedState=function(){},r.WaitingAfterMiddlePressedState.prototype.onmouseup=c("WaitingAfterMiddlePressedState","onmouseup"),r.WaitingAfterMiddlePressedState.prototype.onmousedown=c("WaitingAfterMiddlePressedState","onmousedown"),r.WaitingAfterMiddlePressedState.prototype.onmousemove=c("WaitingAfterMiddlePressedState","onmousemove"),r.PanGrabWaitAfterMiddlePressed=function(){},r.PanGrabWaitAfterMiddlePressed.prototype.onmouseup=c("PanGrabWaitAfterMiddlePressed","onmouseup"),r.PanGrabWaitAfterMiddlePressed.prototype.onmousedown=c("PanGrabWaitAfterMiddlePressed","onmousedown"),r.PanGrabWaitAfterMiddlePressed.prototype.onmousemove=c("PanGrabWaitAfterMiddlePressed","onmousemove"),r.Modifiers={CTRL:1,SHIFT:2,ALT:4},r.Sides={TOP:1,BOTTOM:2,LEFT:4,RIGHT:8},r.StateMachine=function(e,i,n,o){if(this.graph=e,this.graphView=o||e.views.main,this.pick=i||new r.DOMPick,this.domRoot=this.graphView.domRoot,!this.domRoot)throw new Error('No "domRoot" property on the graph\'s view');this.rootState=n||new r.DefaultRootState,this.state=null,f.call(this,this.rootState,!0),this.drag=null,this.buttons=0,this.dragStart=null,this.touchTargets=new t.List,this.touchPoints={},this.boundMouseDownHandler=this.mouseDownHandler.bind(this),this.boundMouseMoveHandler=this.mouseMoveHandler.bind(this),this.boundMouseUpHandler=this.mouseUpHandler.bind(this),this.boundCtxMenuHandler=this.ctxMenuHandler.bind(this),this.boundMouseWheelHandler=this.mouseWheelHandler.bind(this),this.boundTouchStartHandler=this.touchStartHandler.bind(this),this.boundTouchMoveHandler=this.touchMoveHandler.bind(this),this.boundTouchEndHandler=this.touchEndHandler.bind(this),this.boundTouchCancelHandler=this.touchCancelHandler.bind(this),this.boundDragStartHandler=this.dragStartHandler.bind(this),this.boundDragEndHandler=this.dragEndHandler.bind(this),this.boundDragHandler=this.dragHandler.bind(this),this.boundDragEnterHandler=this.dragEnterHandler.bind(this),this.boundDragExitHandler=this.dragExitHandler.bind(this),this.boundDragLeaveHandler=this.dragLeaveHandler.bind(this),this.boundDragOverHandler=this.dragOverHandler.bind(this),this.boundDropHandler=this.dropHandler.bind(this),y.call(this,this.domRoot),this.lastMouseEvent=null,this.lastMouseEventResetPending=!1,this.boundResetLastEvent=this.resetLastEvent.bind(this),this.currentDnD=null,this.currentHoveredElement=null,this.edgeRerouteOptions={active:!1,modifier:r.Modifiers.CTRL,alwaysRerouteSelection:!1},this.setEdgeRerouteActive=function(t){this.edgeRerouteOptions.active=!!t},this.setEdgeRerouteOptions=function(t){if("boolean"==typeof(t=t||{}).active&&(this.edgeRerouteOptions.active=t.active),t.modifier){if(t.modifier!==r.Modifiers.CTRL&&t.modifier!==r.Modifiers.ALT&&t.modifier!==r.Modifiers.SHIFT)throw new Error("the given modifier is not valid!");this.edgeRerouteOptions.modifier=t.modifier}"boolean"==typeof t.alwaysRerouteSelection&&(this.edgeRerouteOptions.alwaysRerouteSelection=t.alwaysRerouteSelection)}},r.StateMachine.prototype.addAllEventListeners=function(t){y.call(this,t)},r.StateMachine.prototype.removeAllEventListeners=function(t){(function(t){t.removeEventListener("mousedown",this.boundMouseDownHandler),t.removeEventListener("mouseup",this.boundMouseUpHandler),t.removeEventListener("contextmenu",this.boundCtxMenuHandler),t.removeEventListener("mousemove",this.boundMouseMoveHandler),t.removeEventListener(void 0!==document.body.onwheel?"wheel":"mousewheel",this.boundMouseWheelHandler),t.removeEventListener("touchstart",this.boundTouchStartHandler),t.removeEventListener("dragstart",this.boundDragStartHandler),t.removeEventListener("dragenter",this.boundDragEnterHandler),t.removeEventListener("dragexit",this.boundDragExitHandler),t.removeEventListener("dragleave",this.boundDragLeaveHandler),t.removeEventListener("dragover",this.boundDragOverHandler),t.removeEventListener("drop",this.boundDropHandler)}).call(this,t)},r.StateMachine.prototype.setLastMouseEvent=function(t){this.lastMouseEvent=t,this.lastMouseEventResetPending||(this.lastMouseEventResetPending=!0,setTimeout(this.boundResetLastEvent,0))},r.StateMachine.prototype.resetLastEvent=function(){this.lastMouseEventResetPending=!1,this.lastMouseEvent=null},r.StateMachine.prototype.startdrag=function(t){if(this.enddrag(!0),this.drag=t,this.drag&&this.drag.onstart)this.drag.onstart()},r.StateMachine.prototype.enddrag=function(t){var e;return this.drag&&this.drag.onend&&(e=this.drag.onend(Boolean(t))),this.drag=null,e},r.StateMachine.prototype.buildEventDataFromMouseEvent=function(t){var e,i,n,o,a;return e=this.pick.pick(t.clientX,t.clientY,this.domRoot),n=this.graphView.clientToViewpoint(t.clientX,t.clientY),i=0,t.shiftKey&&(i|=r.Modifiers.SHIFT),t.ctrlKey&&(i|=r.Modifiers.CTRL),t.altKey&&(i|=r.Modifiers.ALT),this.dragStart?(o=[t.clientX-this.dragStart.clientPos[0],t.clientY-this.dragStart.clientPos[1]],a=[n[0]-this.dragStart.graphPos[0],n[1]-this.dragStart.graphPos[1]]):(o=null,a=null),{inside:e.inside,grElt:e.grElt,subElt:e.subElt,dom:t.target,modifiers:i,clientPos:[t.clientX,t.clientY],graphPos:n,buttons:this.buttons,dragStart:this.dragStart,clientDelta:o,graphDelta:a}};var g=!1;function f(t,e){var i,n;if((i=this.state)!==(n=t||this.rootState)){if(g)throw new Error("can't change state while already changing state!");g=!0;try{i&&i.onuninstall&&i.onuninstall(this,e,n),this.state=n,n.oninstall&&n.oninstall(this,e,i)}finally{g=!1}}}function y(t){t.addEventListener("mousedown",this.boundMouseDownHandler),t.addEventListener("mouseup",this.boundMouseUpHandler),t.addEventListener("contextmenu",this.boundCtxMenuHandler),t.addEventListener("mousemove",this.boundMouseMoveHandler),t.addEventListener(void 0!==document.body.onwheel?"wheel":"mousewheel",this.boundMouseWheelHandler),t.addEventListener("touchstart",this.boundTouchStartHandler),t.addEventListener("dragstart",this.boundDragStartHandler),t.addEventListener("dragenter",this.boundDragEnterHandler),t.addEventListener("dragexit",this.boundDragExitHandler),t.addEventListener("dragleave",this.boundDragLeaveHandler),t.addEventListener("dragover",this.boundDragOverHandler),t.addEventListener("drop",this.boundDropHandler)}function m(t,e,i){i&&i.consume&&(e.preventDefault(),t.dragStart&&t.dragStart.inside&&e.stopPropagation())}function v(t,e,i){if("onmousemove"===e)t.graph._setEdgePickingAreaOverlayingFromPoint(i.grElt,i.clientPos[0],i.clientPos[1]),t.graph._restoreEdgePickingAreasSelectionCapability();else if("onmousedown"===e)i.inside&&i.button===r.Buttons.LEFT&&i.grElt&&0===i.modifiers&&(t.graph._setEdgePickingAreaOverlayingFromPoint(i.grElt,i.clientPos[0],i.clientPos[1]),t.graph.isSelected(i.grElt)&&t.graph._removeEdgePickingAreasSelectionCapability(i.grElt));else if("onwheel"===e&&r.EGraphMouseProfiles[t.graph.mouseProfile]&&r.EGraphMouseProfiles[t.graph.mouseProfile].StateMachine&&r.EGraphMouseProfiles[t.graph.mouseProfile].StateMachine.preprocessing&&r.EGraphMouseProfiles[t.graph.mouseProfile].StateMachine.preprocessing.onwheel)return r.EGraphMouseProfiles[t.graph.mouseProfile].StateMachine.preprocessing.onwheel.call(this,t,i)}function w(t,e,i){if("onwheel"===e&&r.EGraphMouseProfiles[t.graph.mouseProfile]&&r.EGraphMouseProfiles[t.graph.mouseProfile].StateMachine&&r.EGraphMouseProfiles[t.graph.mouseProfile].StateMachine.postprocessing&&r.EGraphMouseProfiles[t.graph.mouseProfile].StateMachine.postprocessing.onwheel)return r.EGraphMouseProfiles[t.graph.mouseProfile].StateMachine.postprocessing.onwheel.call(this,t,i)}function b(t,e,i){return m(t,e,i),i&&i.hasOwnProperty("state")&&f.call(t,i.state,!1),!(!i||!i.hasOwnProperty("reinterpret"))&&i.reinterpret}function E(t,e,i,n){var o,r;do{r=!1,t.state[i]&&(v(t,i,n),o=t.state[i](t,n),w(t,i,n),r=b(t,e,o))}while(r);t.drag&&t.drag[i]&&function(t,e,i){m(t,e,i)}(t,e,t.drag[i](n))}function P(t){t.dragStart=null;const e=t.graphView.domRoot.ownerDocument.defaultView;e.removeEventListener("mousedown",t.boundMouseDownHandler),e.removeEventListener("mouseup",t.boundMouseUpHandler),e.removeEventListener("contextmenu",t.boundCtxMenuHandler),e.removeEventListener("mousemove",t.boundMouseMoveHandler)}function D(t,e){var i;return(i=t.buildEventDataFromMouseEvent(e)).dataTransfer=e.dataTransfer,i}function S(t,e){this.sm=t,this.target=e,e.addEventListener("dragend",this.sm.boundDragEndHandler),e.addEventListener("drag",this.sm.boundDragHandler)}function T(t,e){r.StateMachine.prototype[e]=function(e){var i;i=D(this,e),E(this,e,t,i)}}function L(t){if(!this.ignoreMouse)return{inside:t.inside,grElt:t.grElt,subElt:t.subElt,dom:t.dom,clientPos:t.clientPos,graphPos:t.graphPos,dragStart:t.dragStart,clientDelta:t.clientDelta,graphDelta:t.graphDelta},this.onmove(t)}function _(t,e,i){return new r.NodeDrag(t)}r.StateMachine.prototype.setState=function(t){f.call(this,t,!0)},r.StateMachine.prototype.mouseDownHandler=function(t){var e,i=!this.buttons;if(t!==this.lastMouseEvent){if(this.setLastMouseEvent(t),this.graphView.domRoot.focus(),this.buttons|=a[t.button],(e=this.buildEventDataFromMouseEvent(t)).button=a[t.button],e.detail=t.detail,2===e.detail&&E(this,t,"ondoubleclick",e),i){this.dragStart=e;const t=this.graphView.domRoot.ownerDocument.defaultView;t.addEventListener("mousedown",this.boundMouseDownHandler),t.addEventListener("mouseup",this.boundMouseUpHandler),t.addEventListener("contextmenu",this.boundCtxMenuHandler),t.addEventListener("mousemove",this.boundMouseMoveHandler)}E(this,t,"onmousedown",e)}},r.StateMachine.prototype.mouseMoveHandler=function(t){t!==this.lastMouseEvent&&(this.setLastMouseEvent(t),E(this,t,"onmousemove",this.buildEventDataFromMouseEvent(t)))},r.StateMachine.prototype.mouseUpHandler=function(t){var e;t!==this.lastMouseEvent&&(this.setLastMouseEvent(t),this.buttons&=~a[t.button],this.buttons||P(this),(e=this.buildEventDataFromMouseEvent(t)).button=a[t.button],e.detail=t.detail,E(this,t,"onmouseup",e))},r.StateMachine.prototype.ctxMenuHandler=function(t){var e;t!==this.lastMouseEvent&&(this.setLastMouseEvent(t),(e=this.buildEventDataFromMouseEvent(t)).button=a[t.button],E(this,t,"oncontextmenu",e))},r.StateMachine.prototype.mouseWheelHandler=function(t){var e;if((e=this.buildEventDataFromMouseEvent(t)).wheelDelta=void 0!==t.deltaY?-t.deltaY:t.wheelDelta,e.wheelDelta>0)e.wheelDelta=1;else{if(!(e.wheelDelta<0))return;e.wheelDelta=-1}E(this,t,"onwheel",e)},S.prototype.end=function(){this.target.removeEventListener("dragend",this.sm.boundDragEndHandler),this.target.removeEventListener("drag",this.sm.boundDragHandler)},r.StateMachine.prototype.dragStartHandler=function(t){this.currentDnD&&(this.currentDnD.end(),this.currentDnD=null);var e=t.dataTransfer.getData("Text"),i=this.dnd_enabled;!e&&i&&(t.dataTransfer.setData("Text",""),t.dataTransfer.effectAllowed="move"),E(this,t,"ondragstart",D(this,t)),t.defaultPrevented||(this.currentDnD=new S(this,t.target))},r.StateMachine.prototype.dragEndHandler=function(t){this.currentDnD.end(),this.currentDnD=null,this.buttons&&(this.buttons=0,P(this)),E(this,t,"ondragend",D(this,t))},T("ondrag","dragHandler"),T("ondragenter","dragEnterHandler"),T("ondragexit","dragExitHandler"),T("ondragleave","dragLeaveHandler"),T("ondragover","dragOverHandler"),T("ondrop","dropHandler"),r.StateMachine.prototype.buildEventDataFromTouchEvent=function(t){var e,i,n;function o(t){var i,o,r,a,s,h,l,p,c;for(r=t.length,i=new Array(r),o=0;o<r;++o)a=t[o],e.hasOwnProperty(a.identifier)?i[o]=e[a.identifier]:(s=n.pick.pick(a.clientX,a.clientY,n.domRoot),h=n.graphView.clientToViewpoint(a.clientX,a.clientY),n.touchPoints.hasOwnProperty(a.identifier)&&(c=n.touchPoints[a.identifier].dragStart)?(l=[a.clientX-c.clientPos[0],a.clientY-c.clientPos[1]],p=[h[0]-c.graphPos[0],h[1]-c.graphPos[1]]):(l=null,p=null,c=null),e[a.identifier]=i[o]={identifier:a.identifier,inside:s.inside,grElt:s.grElt,subElt:s.subElt,dom:a.target,clientPos:[a.clientX,a.clientY],graphPos:h,dragStart:c,clientDelta:l,graphDelta:p});return i}return n=this,e={},(i={}).touches=o(t.touches),i.changedTouches=o(t.changedTouches).filter(function(e){return n.touchPoints.hasOwnProperty(e.identifier)&&e.dom===t.target}),i.graphTouches=i.touches.filter(function(t){return n.touchPoints.hasOwnProperty(t.identifier)}),i.modifiers=0,t.shiftKey&&(i.modifiers|=r.Modifiers.SHIFT),t.ctrlKey&&(i.modifiers|=r.Modifiers.CTRL),t.altKey&&(i.modifiers|=r.Modifiers.ALT),i},r.StateMachine.prototype.touchStartHandler=function(t){var e,i,n,o,r,a;for(i=0,n=(o=t.changedTouches).length;i<n;++i)if((r=o[i]).target===t.target){if(this.touchPoints.hasOwnProperty(r.identifier))throw new Error("Two touch start events with the same identifier");for(a=this.touchTargets.first;a&&a.target!==r.target;a=a.next);a||(a=new u(r.target),this.touchTargets.addLast(a),r.target.addEventListener("touchmove",this.boundTouchMoveHandler),r.target.addEventListener("touchend",this.boundTouchEndHandler),r.target.addEventListener("touchcancel",this.boundTouchCancelHandler)),a.count+=1,this.touchPoints[r.identifier]=new d(r.identifier,a)}for(i=0,n=(o=(e=this.buildEventDataFromTouchEvent(t)).changedTouches).length;i<n;++i)this.touchPoints[o[i].identifier].dragStart=o[i];E(this,t,"ontouchstart",e)},r.StateMachine.prototype.touchMoveHandler=function(t){var e;t.eventPhase===Event.AT_TARGET&&(this,(e=this.buildEventDataFromTouchEvent(t,!0)).changedTouches.length&&E(this,t,"ontouchmove",e))},r.StateMachine.prototype.removeTouchDrags=function(t){var e,i,n,o;for(e=0,i=(n=t.changedTouches).length;e<i;++e)(o=n[e]).target===t.target&&this.touchPoints.hasOwnProperty(o.identifier)&&(this.touchPoints[o.identifier].dragStart=null)},r.StateMachine.prototype.removeTouchPoints=function(t){var e,i,n,o,r;for(e=0,i=(n=t.changedTouches).length;e<i;++e)(o=n[e]).target===t.target&&this.touchPoints.hasOwnProperty(o.identifier)&&((r=this.touchPoints[o.identifier].touchTarget).count-=1,0===r.count&&(r.target.removeEventListener("touchmove",this.boundTouchMoveHandler),r.target.removeEventListener("touchend",this.boundTouchEndHandler),r.target.removeEventListener("touchcancel",this.boundTouchCancelHandler),this.touchTargets.remove(r)),delete this.touchPoints[o.identifier])},r.StateMachine.prototype.touchEndHandler=function(t){var e;t.eventPhase===Event.AT_TARGET&&(this.removeTouchDrags(t),e=this.buildEventDataFromTouchEvent(t),this.removeTouchPoints(t),e.changedTouches.length&&E(this,t,"ontouchend",e))},r.StateMachine.prototype.touchCancelHandler=function(t){var e;t.eventPhase===Event.AT_TARGET&&(this.removeTouchDrags(t),e=this.buildEventDataFromTouchEvent(t),this.removeTouchPoints(t),e.changedTouches.length&&E(this,t,"ontouchcancel",e))},r.SinglePtDrag=function(){this.ignoreMouse=!1},r.SinglePtDrag.prototype.onmove=function(t){throw new Error("Not implemented in subclass")},r.SinglePtDrag.prototype.onmousemove=L,r.SinglePtDrag.prototype.ondragenter=L,r.SinglePtDrag.prototype.ondragover=L,r.SinglePtDrag.prototype.ontouchmove=function(t){var e,i;if(t.graphTouches.length>1)throw new Error("Multiple touch points not supported by single point drag");if(t.changedTouches.length>1)throw new Error("Invalid State: "+t.changedTouches.length+" changed touches but 1 target touch");if((i=t.changedTouches[0])!==t.graphTouches[0])throw new Error("Invalid State: changed touch is not target touch");this.ignoreMouse=!0,e={inside:i.inside,grElt:i.grElt,subElt:i.subElt,dom:i.dom,clientPos:i.clientPos,graphPos:i.graphPos,dragStart:i.dragStart,clientDelta:i.clientDelta,graphDelta:i.graphDelta},this.onmove(e)},r.MixDrag=function(t){this.drag=t},e.inherit(r.MixDrag,r.SinglePtDrag),r.MixDrag.prototype.chooseDrag=function(t){throw new Error("Not implemented in child class")},r.MixDrag.prototype.onmove=function(t){var e=this.chooseDrag(t);if(e!==this.drag&&(this.drag.onend(!0),this.drag=e),this.drag.onmove)return this.drag.onmove(t)},r.MixDrag.prototype.onmousedown=function(t){if(this.drag.onmousedown)return this.drag.onmousedown(t)},r.MixDrag.prototype.onmouseup=function(t){if(this.drag.onmouseup)return this.drag.onmouseup(t)},r.MixDrag.prototype.ontouchstart=function(t){if(this.drag.ontouchstart)return this.drag.ontouchstart(t)},r.MixDrag.prototype.ontouchend=function(t){if(this.drag.ontouchend)return this.drag.ontouchend(t)},r.MixDrag.prototype.ontouchcancel=function(t){if(this.drag.ontouchcancel)return this.drag.ontouchcancel(t)},r.MixDrag.prototype.onend=function(t){if(this.drag.onend)return this.drag.onend(t)},r.NodeDrag=function(t,e){this.gr=t,this.nodes=null,this.starts=null,this.nodes=e?e.slice():null},e.inherit(r.NodeDrag,r.SinglePtDrag),r.NodeDrag.prototype.onmove=function(e){var i,n,o,r;this.nodes||(this.nodes=function(e){var i,n;for(i=[],n=e.selection.first;n;n=n.nextSel)n.type!==t.Type.NODE&&n.type!==t.Type.GROUP||i.push(n);return i}(this.gr)),this.starts||(t.topologicalSortNodes(this.nodes,!0),this.starts=function(t){var e,i,n,o;for(n=t.length,e=new Array(n),i=0;i<n;++i)o=t[i],e[i]=[o.left,o.top];return e}(this.nodes)),this.gr.updateLock();try{for(o=0,r=this.nodes.length;o<r;++o)i=this.nodes[o],n=this.starts[o],i.multiset("left",n[0]+e.graphDelta[0],"top",n[1]+e.graphDelta[1])}finally{this.gr.updateUnlock()}},r.NodeDrag.prototype.onend=function(t){var e,i,n,o;if(t){this.gr.updateLock();try{for(e=0,i=this.nodes.length;e<i;++e)n=this.nodes[e],o=this.starts[e],n.multiset("left",o[0],"top",o[1])}finally{this.gr.updateUnlock()}}},r.ResizeNodeDrag=function(t,e,i){this.n=e,this.side=i.resize_sides,this.start={left:e.left,top:e.top,width:e.width,height:e.height}},e.inherit(r.ResizeNodeDrag,r.SinglePtDrag),r.ResizeNodeDrag.prototype.onmove=function(e){var i;t.ObservableData.lock();try{this.side&r.Sides.LEFT?(i=Math.min(e.graphDelta[0],this.start.width-60),this.n.set("left",this.start.left+i),this.n.set("width",this.start.width-i)):this.side&r.Sides.RIGHT&&(i=Math.max(e.graphDelta[0],60-this.start.width),this.n.set("width",this.start.width+i)),this.side&r.Sides.TOP?(i=Math.min(e.graphDelta[1],this.start.height-60),this.n.set("top",this.start.top+i),this.n.set("height",this.start.height-i)):this.side&r.Sides.BOTTOM&&(i=Math.max(e.graphDelta[1],60-this.start.height),this.n.set("height",this.start.height+i))}finally{t.ObservableData.unlock()}},r.ResizeNodeDrag.prototype.onend=function(t){t&&this.n.multiset("left",this.start.left,"top",this.start.top,"width",this.start.width,"height",this.start.height)},r.EdgeReshapingDrag=function(t,e){r.SinglePtDrag.apply(this,arguments),this.gr=t,this.edge=e,this.pickedSegmentOptions=null,this.valid=!0,this.initialPath=e.path.slice(0)},e.inherit(r.EdgeReshapingDrag,r.SinglePtDrag),r.EdgeReshapingDrag.prototype.onmove=function(t){var e;this.edge&&(e=this.edge.geometry,this.pickedSegmentOptions||(this.pickedSegmentOptions=e.getPickedSegmentOptions(this.edge,t.graphPos),this.valid=e.isReshapingValid(this.edge,this.pickedSegmentOptions,t.graphPos)),this.valid&&e.reshapePath(this.edge,this.pickedSegmentOptions,t.graphPos))},r.EdgeReshapingDrag.prototype.onend=function(t){if(this.edge){var e=this.edge.geometry;t&&this.initialPath?this.edge.set("path",this.initialPath):e&&e.refinePath&&e.refinePath(this.edge)}},r.ConnDrag=function(t,e){this.c=e},e.inherit(r.ConnDrag,r.SinglePtDrag),r.ConnDrag.prototype.onmove=function(t){var i=e.closestSide(this.c.node,t.graphPos[0],t.graphPos[1]);this.start||(this.start={attach:this.c.cstr.attach,offset:this.c.cstr.offset}),this.c.multiset(["cstr","attach"],i.idx,["cstr","offset"],i.offset)},r.ConnDrag.prototype.onend=function(t){t&&this.start&&this.c.multiset(["cstr","attach"],this.start.attach,["cstr","offset"],this.start.offset),delete this.start},r.ConnConnectDrag=function(t,e){this.gr=t,this.c=e,this.edge=null,this.otherConnector=null,this.temp=null,this.firstMove=!0,this.edgeInsertionOpts={autoPairSelection:!0}},e.inherit(r.ConnConnectDrag,r.SinglePtDrag),r.ConnConnectDrag.prototype.onpick=function(t){return t.grElt},r.ConnConnectDrag.prototype.onaccept=function(t,e){return!0},r.ConnConnectDrag.prototype.onfirstmove=function(){},r.ConnConnectDrag.prototype.ondisconnect=function(t,e,i,n){},r.ConnConnectDrag.prototype.onconnect=function(t,e,i){},r.ConnConnectDrag.prototype.onmove=function(e){var i;this.gr.updateLock();try{if(this.firstMove&&(this.firstMove=!1,this.onfirstmove()),(i=this.onpick(e))===this.otherConnector)return;i&&i!==this.c&&i.type===t.Type.CONNECTOR&&i.getGraph()===this.c.getGraph()&&this.onaccept(this.c,i)?(this.temp&&(this.gr.removeNode(this.temp.node),this.ondisconnect(this.temp.edge,this.temp.conn,!0,i),this.temp=null),this.edge&&i!==this.edge.cl2.c&&(this.gr.removeEdge(this.edge),this.ondisconnect(this.edge,this.otherConnector,!1,i),this.edge=null,this.otherConnector=null),this.edge||(this.edge=this.newEdge(this.c,i),this.otherConnector=i,this.gr.addEdge(this.c,i,this.edge,this.edgeInsertionOpts),this.onconnect(this.edge,this.otherConnector,!1))):(this.edge&&(this.gr.removeEdge(this.edge),this.ondisconnect(this.edge,this.otherConnector,!1,null),this.edge=null,this.otherConnector=null),this.temp||(this.temp={},this.temp.node=this.newTempNode(),this.temp.conn=this.newTempConn(),this.gr.addNode(this.temp.node),this.gr.addConnector(this.temp.node,this.temp.conn),this.temp.edge=this.newTempEdge(),this.gr.addEdge(this.c,this.temp.conn,this.temp.edge,this.edgeInsertionOpts),this.onconnect(this.temp.edge,this.temp.conn,!0)),this.temp.node.multiset("left",e.graphPos[0],"top",e.graphPos[1]))}finally{this.gr.updateUnlock()}},r.ConnConnectDrag.prototype.onend=function(t){this.gr.updateLock();try{this.firstMove=!0,this.temp&&(this.gr.removeNode(this.temp.node),this.ondisconnect(this.edge,this.temp.conn,!0,null),this.temp=null),this.edge&&t&&(this.gr.removeEdge(this.edge),this.ondisconnect(this.edge,this.otherConnector,!1,null),this.edge=null,this.otherConnector=null)}finally{this.gr.updateUnlock()}},r.ConnConnectDrag.prototype.newTempNode=function(){return new t.Node},r.ConnConnectDrag.prototype.newTempConn=function(){return new t.Connector},r.ConnConnectDrag.prototype.newTempEdge=function(){return new t.Edge(new i.SVGEdgeView("egraph_views_SVGEdgeView temp"),null,this.geometry)},r.ConnConnectDrag.prototype.newEdge=function(e,n){return new t.Edge(new i.SVGEdgeView,null,this.geometry)},r.RerouteConnConnectDrag=function(t,e,i){r.ConnConnectDrag.call(this,t,e),this.edgesToReroute=i.edgesToReroute||[],this.nbEdgesToReroute=this.edgesToReroute.length,this.currentConnector=e,this.removed=!1,this.beginConnectors=[],this.edges=[],this.selected=[];for(var n=0;n<this.nbEdgesToReroute;n++){var o=this.edgesToReroute[n].cl1.c,a=this.edgesToReroute[n].cl2.c;this.beginConnectors[n]=this.currentConnector===o?a:o,this.selected[n]=this.edgesToReroute[n].selected}},e.inherit(r.RerouteConnConnectDrag,r.ConnConnectDrag),r.RerouteConnConnectDrag.prototype.onend=function(t){if(r.ConnConnectDrag.prototype.onend.apply(this,arguments),this.removed&&0===this.edges.length)for(var e=0;e<this.nbEdgesToReroute;e++)this.gr.addEdge(this.currentConnector,this.beginConnectors[e],this.edgesToReroute[e]),this.selected[e]&&this.gr.addToSelection(this.edgesToReroute[e])},r.RerouteConnConnectDrag.prototype.onfirstmove=function(){this.removed=!0;for(var t=0;t<this.nbEdgesToReroute;t++)this.ondisconnect(this.edgesToReroute[t],this.currentConnector,!1,null),this.gr.removeEdge(this.edgesToReroute[t]),this.edgesToReroute[t].remove()},r.RerouteConnConnectDrag.prototype.onmove=function(e){var i;this.gr.updateLock();try{if(this.firstMove&&(this.firstMove=!1,this.onfirstmove()),(i=this.onpick(e))===this.otherConnector)return;for(var n=i&&i.type===t.Type.CONNECTOR&&i.getGraph()===this.currentConnector.getGraph(),o=0;n&&o<this.nbEdgesToReroute;o++)n=(n=n&&i!==this.beginConnectors[o])&&this.onaccept(this.beginConnectors[o],i);if(n){this.temp&&this.gr.removeNode(this.temp.node);var r=this.otherConnector;for(o=0;o<this.nbEdgesToReroute;o++)this.temp&&this.temp.edges[o]&&this.ondisconnect(this.temp.edges[o],this.temp.conn,!0,i),this.edges[o]&&i!==this.edges[o].cl2.c&&(this.otherConnector=null,this.ondisconnect(this.edges[o],r,!1,i),this.gr.removeEdge(this.edges[o]),this.edges[o]=null),this.edges[o]||(this.edges[o]=this.newEdge(this.beginConnectors[o],i),this.otherConnector||(this.otherConnector=i),this.gr.addEdge(this.beginConnectors[o],i,this.edges[o],this.edgeInsertionOpts),this.selected[o]&&this.gr.addToSelection(this.edges[o]),this.onconnect(this.edges[o],this.otherConnector,!1));this.temp=null}else{this.temp||(this.temp={},this.temp.node=this.newTempNode(),this.temp.conn=this.newTempConn(),this.gr.addNode(this.temp.node),this.gr.addConnector(this.temp.node,this.temp.conn),this.temp.edges=[]),this.temp.node.multiset("left",e.graphPos[0],"top",e.graphPos[1]);for(o=0;o<this.nbEdgesToReroute;o++)this.edges[o]&&(this.ondisconnect(this.edges[o],this.otherConnector,!1,null),this.gr.removeEdge(this.edges[o]),this.edges[o]=null,this.otherConnector=null),this.temp.edges[o]=this.newTempEdge(),this.gr.addEdge(this.beginConnectors[o],this.temp.conn,this.temp.edges[o],this.edgeInsertionOpts),this.onconnect(this.temp.edges[o],this.temp.conn,!0);this.edges=[]}}finally{this.gr.updateUnlock()}};var M,O=[];return O[t.Type.NODE]={"":_,resize:r.ResizeNodeDrag},O[t.Type.GROUP]={"":_},O[t.Type.CONNECTOR]={"":r.ConnConnectDrag,reroute:r.RerouteConnConnectDrag},r.ViewpointMoveDrag=function(t){this.grView=t},e.inherit(r.ViewpointMoveDrag,r.SinglePtDrag),r.ViewpointMoveDrag.prototype.onmove=function(t){this.start||(this.start=this.grView.vpt.slice());var e=[this.start[0]+t.clientDelta[0],this.start[1]+t.clientDelta[1],this.start[2]];this.grView.setViewpoint(e)},r.ViewpointMoveDrag.prototype.onend=function(t){t&&this.grView.setViewpoint(this.start)},r.ViewpointTwoTouchesDrag=function(t){this.grView=t},r.ViewpointTwoTouchesDrag.prototype.ontouchmove=function(t){var i,n,o;function r(t){return Math.sqrt(Math.pow(t.graphTouches[0].clientPos[0]-t.graphTouches[1].clientPos[0],2)+Math.pow(t.graphTouches[0].clientPos[1]-t.graphTouches[1].clientPos[1],2))}this.start||(this.start=this.grView.vpt.slice(),this.startDist=r(t),this.fixPt=[(t.graphTouches[0].graphPos[0]+t.graphTouches[1].graphPos[0])/2,(t.graphTouches[0].graphPos[1]+t.graphTouches[1].graphPos[1])/2]),i=(t.graphTouches[0].clientDelta[0]+t.graphTouches[1].clientDelta[0])/2,n=(t.graphTouches[0].clientDelta[1]+t.graphTouches[1].clientDelta[1])/2,o=r(t);var a=e.changeViewpointScale(this.start,this.start[2]*o/this.startDist,this.fixPt,!0);a[0]+=i,a[1]+=n,this.grView.setViewpoint(a)},r.ViewpointScaleDrag=function(t,e){this.grView=t,this.center=e},r.ViewpointScaleDrag.prototype.onmousemove=function(t){let i,n;this.grView.gr.zoomOpts&&(this.grView.gr.zoomOpts.min&&!isNaN(this.grView.gr.zoomOpts.min)&&(i=this.grView.gr.zoomOpts.min),this.grView.gr.zoomOpts.max&&!isNaN(this.grView.gr.zoomOpts.max)&&(n=this.grView.gr.zoomOpts.max)),this.start||(this.start=this.grView.vpt.slice());var o=e.incViewpointScale(this.start,.03125*t.clientDelta[1],this.center,!0,[i,n,.03125]);this.grView.setViewpoint(o)},r.ViewpointScaleDrag.prototype.onend=function(t){t&&this.grView.setViewpoint(this.start)},r.RectDrag=function(t,e,i){if(r.SinglePtDrag.call(this),!isFinite(t))throw new Error("startLeft must be finite");if(!isFinite(e))throw new Error("startTop must be finite");if(!i||"function"!=typeof i.setRectangle)throw new Error("overlay must be an object with a setRectangle function");this.x1=t,this.y1=e,this.x2=t,this.y2=e,this.overlay=i},e.inherit(r.RectDrag,r.SinglePtDrag),r.RectDrag.prototype.onmove=function(t){this.x2=t.graphPos[0],this.y2=t.graphPos[1],this.overlay.setRectangle(this.x1,this.y1,this.x2,this.y2)},r.RectDrag.prototype.onend=function(t){r.SinglePtDrag.prototype.onend&&r.SinglePtDrag.prototype.onend.apply(this,arguments),this.overlay.remove(),t||this.apply(this.gr,this.x1,this.y1,this.x2,this.y2)},r.RectDrag.prototype.apply=function(){throw new Error("MUST be overridden")},r.RectSelectionDrag=function(e,i,n,o,a,s,h){if(r.RectDrag.call(this,i,n,o),!e)throw new Error("grView can't be null");if(this.grView=e,this.pickOpts=a,this.selectionMode=void 0!==s?s:t.SelectionMode.REPLACE,void 0!==h){if("function"!=typeof h)throw new Error("apply must be a function");this.apply=h}},e.inherit(r.RectSelectionDrag,r.RectDrag),r.RectSelectionDrag.prototype.apply=function(){this.grView.gr.updateSelection(this.grView.rectanglePick(this.x1,this.y1,this.x2,this.y2,this.pickOpts),this.selectionMode)},r.RectSelectionWaitPt1=function(e){if(e&&e.overlay&&("function"!=typeof e.overlay.setRectangle||"function"!=typeof e.overlay.remove))throw new Error("overlay must be an object with setRectangle and remove functions");if(e&&void 0!==e.endcb&&"function"!=typeof e.endcb)throw new Error("endcb must be either a function or undefined");if(e&&void 0!==e.configcb&&"function"!=typeof e.configcb)throw new Error("configcb must be either a function or undefined");if(e&&void 0!==e.applycb&&"function"!=typeof e.applycb)throw new Error("applycb must be either a function or undefined");this.pickOpts=e?e.pickOpts:void 0,this.selectionMode=e&&void 0!==e.selectionMode?e.selectionMode:t.SelectionMode.REPLACE,this.overlay=e?e.overlay:void 0,this.endcb=e?e.endcb:void 0,this.configcb=e?e.configcb:void 0,this.applycb=e?e.applycb:void 0},r.RectSelectionWaitPt1.prototype.oninstall=function(t){this.overlay||(this.overlay=new i.RectangleOverlay(t.graphView)),t.enddrag(!0)},r.RectSelectionWaitPt1.prototype.onuninstall=function(t,e){e&&this.overlay.remove()},r.RectSelectionWaitPt1.prototype.onmousedown=function(t,e){var i;return e.button!==r.Buttons.LEFT?{consume:!0}:(this.configcb&&this.configcb.call(this),i=new r.RectSelectionDrag(t.graphView,e.graphPos[0],e.graphPos[1],this.overlay,this.pickOpts,this.selectionMode,this.applycb),t.startdrag(i),{consume:!0,state:new r.EndDragOnLeftRelease(this.endcb)})},r.RectSelectionWaitPt1.prototype.ontouchstart=function(t,e){var i;return 1!==e.graphTouches.length?{consume:!0,state:r.WaitLastTouch}:(this.configcb&&this.configcb.call(this),i=new r.RectSelectionDrag(t.graphView,e.graphTouches[0].graphPos[0],e.graphTouches[0].graphPos[1],this.overlay,this.pickOpts,this.selectionMode,this.applycb),t.startdrag(i),{consume:!0,state:new r.EndDragOnTouchChange(this.endcb)})},r.EndDragOnLeftRelease=function(t){if(void 0!==t&&"function"!=typeof t)throw new Error("endcb must be either a function or undefined");this.endcb=t},r.EndDragOnLeftRelease.prototype.oncontextmenu=function(t,e){return{consume:!0}},r.EndDragOnLeftRelease.prototype.onmouseup=function(t,e){return e.button===r.Buttons.LEFT?c("EndDragOnLeftRelease","onmouseup").call(this,t,e):{}},r.EndDragOnLeftState=new r.EndDragOnLeftRelease,r.WaitLastTouch={},r.WaitLastTouch.ontouchend=function(t,e){return e.graphTouches.length?{consume:!0}:{consume:!1,state:null}},r.WaitLastTouch.ontouchcancel=r.WaitLastTouch.ontouchend,r.EndDragOnSinleTouchEnd={ontouchstart:function(t,e){return t.enddrag(!0),{consume:!0,state:r.WaitLastTouch}},ontouchend:function(t,e){return t.enddrag(!1),{consume:!0,state:null}},ontouchcancel:function(t,e){return t.enddrag(!0),{consume:!0,state:null}}},r.EndDragOnTouchChange=function(t){if(void 0!==t&&"function"!=typeof t)throw new Error("endcb must be either a function or undefined");this.endcb=t},r.EndDragOnTouchChange.prototype.ontouchstart=function(t,e){return t.enddrag(!0),this.endcb&&this.endcb(),{consume:!0,state:r.WaitLastTouch}},r.EndDragOnTouchChange.prototype.ontouchend=function(t,e){return t.enddrag(!1),this.endcb&&this.endcb(),{consume:!0,state:e.graphTouches.length?r.WaitLastTouch:null}},r.EndDragOnTouchChange.prototype.ontouchcancel=function(t,e){return t.enddrag(!0),this.endcb&&this.endcb(),{consume:!0,state:e.graphTouches.length?r.WaitLastTouch:null}},M=new r.EndDragOnTouchChange,r.EndDragOnTouchChange.ontouchstart=M.ontouchstart.bind(M),r.EndDragOnTouchChange.ontouchend=M.ontouchend.bind(M),r.EndDragOnTouchChange.ontouchcancel=M.ontouchcancel.bind(M),r.TwoPointsViewpointWait={ontouchstart:function(t,e){return t.enddrag(!0),{consume:!0,state:r.WaitLastTouch}},ontouchend:function(t,e){return t.enddrag(!1),{consume:!0,state:e.graphTouches.length?r.WaitLastTouch:null}},ontouchcancel:function(t,e){return t.enddrag(!0),{consume:!0,state:e.graphTouches.length?r.WaitLastTouch:null}},ontouchmove:function(t,e){return r.isTouchDragSignificant(e)?(t.startdrag(new r.ViewpointTwoTouchesDrag(t.graphView)),{consume:!0,state:r.EndDragOnTouchChange}):{consume:!0}}},r.DefaultRootState=function(){this.longTouchDelay=1e3,this.onlongtouchstart=null,this.onlongtouchcancel=null,this.doubleClickOnNode=null},r.DefaultRootState.prototype.onlongtouchend=function(t,e){if(t.edgeRerouteOptions.active&&1===e.graphTouches.length&&e.graphTouches[0].grElt){var i=r.GetRerouteDrag.call(this,t,e.graphTouches[0].grElt,!1);i&&(t.startdrag(i),f.call(t,r.EndDragOnTouchChange,!1))}},r.DefaultRootState.prototype.newDragForElement=function(t,e,i){var n,o=O[e.type];return o&&(n=o[i?i.id:""]),n?new n(t,e,i):null},r.isTouchDragSignificant=function(t){var e,i,n,o;for(e=0,i=t.graphTouches.length;e<i;++e)if(n=t.graphTouches[e].clientDelta[0],o=t.graphTouches[e].clientDelta[1],Math.abs(n)+Math.abs(o)>12)return!0;return!1},r.DefaultRootState.prototype.ontouchstart=function(e,i){var n,o,a;return o=this,2===i.changedTouches.length?{consume:!0,state:r.TwoPointsViewpointWait}:i.changedTouches.length>2?{consume:!0,state:r.WaitLastTouch}:(a={timer:setTimeout(function(){a.done||(a.done=!0,o.onlongtouchend(e,i),o.onlongtouchendCB&&o.onlongtouchendCB(e,i))},this.longTouchDelay),cancel:function(){this.done||(clearTimeout(this.timer),this.done=!0,o.onlongtouchcancel&&o.onlongtouchcancel(e,i))},done:!1},n={onuninstall:function(){a.cancel()},ontouchstart:function(t,e){return a.cancel(),1===e.changedTouches.length?{consume:!1,state:r.TwoPointsViewpointWait}:{consume:!1,state:r.WaitLastTouch}},ontouchend:function(){var t;return a.cancel(),i.graphTouches[0].grElt?(e.graph.isSelected(i.graphTouches[0].grElt)?e.graph.removeFromSelection(i.graphTouches[0].grElt):e.graph.addToSelection(i.graphTouches[0].grElt),(t=o.newDragForElement(e.graph,i.graphTouches[0].grElt,i.graphTouches[0].subElt))&&(e.startdrag(t),e.enddrag(!1))):e.graph.clearSelection(),{consume:!1,state:null}},ontouchcancel:function(){return a.cancel(),{consume:!0,state:null}},ontouchmove:function(n,s){var h;if(!r.isTouchDragSignificant(s))return{consume:!0};if(a.cancel(),1===i.graphTouches.length)if(i.graphTouches[0].grElt){if(e.edgeRerouteOptions.active&&e.edgeRerouteOptions.alwaysRerouteSelection&&(h=r.GetRerouteDrag.call(o,e,i.graphTouches[0].grElt,!0)))return e.startdrag(h),{consume:!0,state:r.EndDragOnTouchChange};if(i.graphTouches[0].grElt.type===t.Type.EDGE&&i.graphTouches[0].grElt.geometry&&i.graphTouches[0].grElt.geometry.reshapable)return h=new r.EdgeReshapingDrag(e.graph,i.graphTouches[0].grElt),e.startdrag(h),{consume:!0,state:r.EndDragOnTouchChange};e.graph.isSelected(i.graphTouches[0].grElt)||(e.graph.replaceSelectionWith(i.graphTouches[0].grElt),i.graphTouches[0].grElt.bringToFront&&i.graphTouches[0].grElt.bringToFront()),(h=o.newDragForElement(e.graph,i.graphTouches[0].grElt,i.graphTouches[0].subElt))&&e.startdrag(h)}else e.startdrag(new r.ViewpointMoveDrag(e.graphView));return{consume:!0,state:r.EndDragOnTouchChange}}},o.onlongtouchstart&&o.onlongtouchstart(e,i),{consume:!1,state:n})},r.DefaultRootState.prototype.ontouchmove=function(t,e){return{consume:!0}},r.DefaultRootState.prototype.ontouchend=function(t,e){return{consume:!1}},r.DefaultRootState.prototype.ontouchcancel=function(t,e){return{consume:!0}},r.DefaultRootState.prototype.ondoubleclick=function(e,i){var n,o;if(i.button===r.Buttons.LEFT){if((o=i.grElt)&&o.type===t.Type.EDGE&&o.geometry&&o.geometry.splittable){var a=o.geometry.getPickedSegmentOptions(o,i.graphPos);return o.geometry.isSplitValid(o,a,i.graphPos)&&o.geometry.splitPath(o,a,i.graphPos),{consume:!0}}if(o&&o.type===t.Type.NODE&&(n=this.doubleClickOnNode))return n(o),{consume:!0}}return{}},r.DefaultRootState.prototype.onmousemove=function(e,i){if(e.currentHoveredElement&&(e.currentHoveredElement.type===t.Type.EDGE&&e.currentHoveredElement.geometry&&(e.currentHoveredElement.geometry.reshapable||e.currentHoveredElement.geometry.splittable)&&e.currentHoveredElement.view.display.elt.classList.remove("modifiable"),e.currentHoveredElement=null),i.inside&&i.grElt&&(e.currentHoveredElement=i.grElt,i.grElt.type===t.Type.EDGE&&i.grElt.geometry&&(i.grElt.geometry.reshapable||i.grElt.geometry.splittable))){var n=i.grElt.geometry.getPickedSegmentOptions(i.grElt,i.graphPos);(i.grElt.geometry.reshapable&&i.grElt.geometry.isReshapingValid(i.grElt,n,i.graphPos)||i.grElt.geometry.splittable&&i.grElt.geometry.isSplitValid(i.grElt,n,i.graphPos))&&(i.grElt.view.display.elt.classList.add("modifiable"),e.currentHoveredElement=i.grElt)}},r.DefaultRootState.prototype.onmousedown=c("DefaultRootState","onmousedown"),r.DefaultRootState.prototype.onwheel=function(t,e){return e.inside?{consume:!0}:{}},r.GetRerouteDrag=function(e,i,n){if(i.type===t.Type.CONNECTOR){for(var o=[],r=[],a=i.children.first;a;a=a.next)r.push(a.ref),a.ref.selected&&o.push(a.ref);if((n||!e.edgeRerouteOptions.alwaysRerouteSelection)&&0!==o.length)return this.newDragForElement(e.graph,i,{id:"reroute",edgesToReroute:o});if(!n)return this.newDragForElement(e.graph,i,{id:"reroute",edgesToReroute:r})}return null},r.DOMPick=function(){},r.DOMPick.prototype.pick=function(t,e,i){var n,o,r,a,s,h;for(n=i;n.parentNode;n=n.parentNode);for(n.elementFromPoint&&t&&e&&(o=n.elementFromPoint(t,e)),r=o;r&&r!==i;r=r.parentNode)void 0===s&&r.nodeType===Node.ELEMENT_NODE&&r.hasAttribute("data-egraph-subelt")&&(s=r.getAttribute("data-egraph-subelt")),!a&&r.grElt&&(a=r.grElt,void 0===s&&(s=r.subElt));return(h=r===i)||(a=null,s=void 0),{inside:h,grElt:a,subElt:s}},r.SubEltClickDrag=function(t,e,i){if(r.SinglePtDrag.call(this),"function"!=typeof i)throw new Error("cb must be a function");this.cb=i,this.grElt=t,this.subElt=e,this.inside=!0},e.inherit(r.SubEltClickDrag,r.SinglePtDrag),r.SubEltClickDrag.prototype.onmove=function(t){this.inside=t.grElt===this.grElt&&t.subElt===this.subElt},r.SubEltClickDrag.prototype.onend=function(t){!t&&this.inside&&this.cb.call(void 0)},r.SM_HTMLGraphView=function(t,e){i.HTMLGraphView.call(this,t,e),this.rootState=e&&e.rootState||new r.DefaultRootState},e.inherit(r.SM_HTMLGraphView,i.HTMLGraphView),r.SM_HTMLGraphView.prototype.oninit=function(t){i.HTMLGraphView.prototype.oninit.apply(this,arguments),this.stateMachine=new r.StateMachine(t,new r.DOMPick,this.rootState,this)},r.PanGrabWait=function(t){t.overlay?this.overlay=t.overlay:this.overlay=void 0},r.PanGrabWait.prototype.oninstall=function(t){this.overlay||(this.overlay=new i.PanOverlay(t.graphView)),t.enddrag(!0)},r.PanGrabWait.prototype.onuninstall=function(t,e){e&&this.overlay&&this.overlay.remove()},r.PanGrabWait.prototype.onmousedown=c("PanGrabWait","onmousedown"),r.PanGrabWait.prototype.ontouchstart=function(t,e){return 2===e.changedTouches.length?{consume:!0,state:r.TwoPointsViewpointWait}:e.changedTouches.length>2?{consume:!0,state:r.WaitLastTouch}:1!==e.graphTouches.length?{consume:!0,state:r.WaitLastTouch}:(t.startdrag(new r.ViewpointMoveDrag(t.graphView)),{consume:!0,state:new r.PanGrabDrag(this.overlay)})},r.PanGrabWait.prototype.onwheel=function(t,e){return e.inside?{consume:!0}:{}},r.PanGrabDrag=function(t){this.overlay=t},e.inherit(r.PanGrabDrag,r.EndDragOnLeftRelease),r.PanGrabDrag.prototype.onmouseup=function(t,e){if(e.button===r.Buttons.LEFT){t.enddrag(!1);var i={};return i.overlay=this.overlay,{consume:!0,state:new r.PanGrabWait(i)}}return{}},r.PanGrabDrag.prototype.ontouchend=function(t,e){t.enddrag(!1);var i={};return i.overlay=this.overlay,e.graphTouches.length?{consume:!0,state:new r.PanGrabWait(i)}:{consume:!1,state:new r.PanGrabWait(i)}},r.PanGrabDrag.prototype.ontouchcancel=r.PanGrabDrag.prototype.ontouchend,r.StateMachine.prototype.generateToolbarModel=function(e){let i=this.graph,n=this,a=!1,h=!1;function l(){c(-1)}function p(){c(1)}function c(t){s.call(n,n,{inside:!0,clientPos:[n.domRoot.clientWidth/2,n.domRoot.clientHeight/2],wheelDelta:t})}function u(){let e,n,o,r,a;for(a=i.nodes.first;a;a=t.dftNext(i,a,a.type===t.Type.GROUP&&a.collapsed))(a.actualLeft<e||void 0===e)&&(e=a.actualLeft),(a.actualTop<o||void 0===o)&&(o=a.actualTop),(a.actualLeft+a.actualWidth>n||void 0===n)&&(n=a.actualLeft+a.actualWidth),(a.actualTop+a.actualHeight>r||void 0===r)&&(r=a.actualTop+a.actualHeight);d(e,n,o,r)}function d(t,e,o,r){let a=e-t,s=r-o;if(0===s||0===a)return;let h=.1*a,l=.1*s;a+=h,s+=l,t-=h/2,e+=h/2,o-=l/2,r+=l/2;let p=n.domRoot.clientWidth,c=n.domRoot.clientHeight,u=p/a,d=c/s,g=Math.min(u,d),f=s*(c/s-p/a)/2,y=a*(p/a-c/s)/2,m=t*-g+(y>0?y:0),v=o*-g+(f>0?f:0);i.views.main.setViewpoint([m,v,g],!0)}function g(){i.views.main.zoomone(),i.views.main.setViewpoint([0,0,1],!0)}let f=!1;function y(){let t=this;if(!f){f=!0,a=!a,this.getNodeModelByID("pan")&&h&&!v&&this.updateNodeModel("pan",{grid:{data:!1}}),a?(n.setState(new r.RectSelectionWaitPt1({configcb:function(){this.pickOpts={groups:!1,nodes:!1,connectors:!1,edges:!1}},applycb:function(){let t,e,i,n;this.x1<this.x2?(t=this.x1,e=this.x2):(t=this.x2,e=this.x1),this.y1<this.y2?(i=this.y1,n=this.y2):(i=this.y2,n=this.y1),d(t,e,i,n)},endcb:function(){a=!1,f=!0,t.updateNodeModel("zoomArea",{grid:{data:!1}}),f=!1,n.setState(void 0),m.call(t,!1)}})),document.addEventListener("keydown",E),m.call(t,!0)):(n.setState(void 0),document.removeEventListener("keydown",document),m.call(t,!1)),f=!1}}function m(t){this.getNodeModelByID("zoomIn")&&this.updateNodeModel("zoomIn",{disabled:t}),this.getNodeModelByID("zoomOut")&&this.updateNodeModel("zoomOut",{disabled:t}),this.getNodeModelByID("zoomReset")&&this.updateNodeModel("zoomReset",{disabled:t}),this.getNodeModelByID("zoomFit")&&this.updateNodeModel("zoomFit",{disabled:t})}let v=!1;function w(){if(!v){v=!0,h=!h,this.getNodeModelByID("zoomArea")&&a&&!f&&this.updateNodeModel("zoomArea",{grid:{data:!1}}),h?(n.setState(new r.PanGrabWait({})),document.addEventListener("keydown",E)):(n.setState(void 0),document.removeEventListener("keydown",document)),v=!1}}var b={entries:[]};function E(t){"Escape"===t.code&&(h&&myGeneratedToolbar.updateNodeModel("pan",{grid:{data:!1}}),a&&myGeneratedToolbar.updateNodeModel("zoomArea",{grid:{data:!1}}))}return e.forEach(t=>{let e=void 0;switch(e="string"==typeof t?t:t.type){case"Zoom":!function(t,e){t.entries.push({id:"zoomOut",dataElements:{typeRepresentation:"functionIcon",tooltip:"Zoom out",icon:{iconName:"zoom-out",fontIconFamily:1},value:l,position:void 0!==e.position?e.position:"near",visibleFlag:void 0!==e.visible?e.visible:"true",category:"view"}},{id:"zoomIn",dataElements:{typeRepresentation:"functionIcon",tooltip:"Zoom in",icon:{iconName:"zoom-in",fontIconFamily:1},value:p,position:void 0!==e.position?e.position:"near",visibleFlag:void 0!==e.visible?e.visible:"true",category:"view"}})}(b,t);break;case"ZoomReset":!function(t,e){t.entries.push({id:"zoomReset",dataElements:{typeRepresentation:"functionIcon",tooltip:"Zoom reset",icon:{iconName:"zoom-reset",fontIconFamily:1},value:g,position:void 0!==e.position?e.position:"near",visibleFlag:void 0!==e.visible?e.visible:"true",category:"view"}})}(b,t);break;case"ZoomFit":!function(t,e){t.entries.push({id:"zoomFit",dataElements:{typeRepresentation:"functionIcon",tooltip:"Zoom fit",icon:{iconName:"zoom-fit",fontIconFamily:1},value:u,position:void 0!==e.position?e.position:"near",visibleFlag:void 0!==e.visible?e.visible:"true",category:"view"}})}(b,t);break;case"ZoomArea":!function(t,e){t.entries.push({id:"zoomArea",dataElements:{typeRepresentation:"zoomAreaToggle",tooltip:"Zoom area",icon:{iconName:"zoom-area",fontIconFamily:1},value:!1,position:void 0!==e.position?e.position:"near",visibleFlag:void 0!==e.visible?e.visible:"true",category:"view"},onNodeUpdate:y});(new o).registerTypeRepresentations({zoomAreaToggle:{stdTemplate:"toggleIcon",semantics:{possibleValues:[{value:"false",icon:{iconName:"zoom-area",fontIconFamily:1}},{value:"true",icon:{iconName:"zoom-area",fontIconFamily:1,className:"info-active"}}]}}})}(b,t);break;case"Pan":!function(t,e){t.entries.push({id:"pan",dataElements:{typeRepresentation:"panToggle",tooltip:"Pan",icon:{iconName:"view-pan",fontIconFamily:1},value:!1,position:void 0!==e.position?e.position:"near",visibleFlag:void 0!==e.visible?e.visible:"true",category:"view"},onNodeUpdate:w});(new o).registerTypeRepresentations({panToggle:{stdTemplate:"toggleIcon",semantics:{possibleValues:[{value:"false",icon:{iconName:"view-pan",fontIconFamily:1}},{value:"true",icon:{iconName:"view-pan",fontIconFamily:1,className:"info-active"}}]}}})}(b,t);break;case void 0:throw new Error("Undefined element type")}}),b},r}),define("egraph/iact",["DS/egraph/iact"],function(t){return t}),define("DS/egraph/overview",["DS/egraph/utils","DS/egraph/core","DS/egraph/views","DS/egraph/iact"],function(t,e,i,n){"use strict";var o={},r=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame;window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame;o.GraphView=function(n,o,r){if(e.GraphView.call(this),e.Observable.call(this),i.TransformedGraphView.call(this),!n)throw new Error("container parameter can't be null");if(!o||!o.vpt||3===!o.vpt.length||"function"!=typeof o.getSize)throw new Error("mainview must be an object implementing TransformedGraphView contract");if(r=r||{},this.container=n,this.mainview=o,this.mainview_width=NaN,this.mainview_height=NaN,this.width=0,this.height=0,this.maxScale=t.pos_number_opt(r,"maxScale",.5),this.padding=t.pos_number_opt(r,"padding",5),this.background=t.string_opt(r,"background",""),this.nodeFill=t.string_opt(r,"nodeFill","rgba(126, 169, 194, 1.0)"),this.groupFill=t.string_opt(r,"groupFill","rgba(185, 203, 219, 0.623)"),this.aliasing=t.pos_integer_opt(r,"aliasing",void 0),this.canvas=document.createElement("canvas"),this.canvas.width=0,this.canvas.height=0,this.ctx=this.canvas.getContext("2d"),!this.ctx)throw new Error("canvas 2d context not available");this.canvasCropper=document.createElement("div"),this.canvasCropper.style.display="inlink-block",this.canvasCropper.style.position="absolute",this.canvasCropper.style.top="0",this.canvasCropper.style.left="0",this.canvasCropper.style.width="100%",this.canvasCropper.style.height="100%",this.canvasCropper.style.overflow="hidden",this.canvasCropper.appendChild(this.canvas),this.domRoot=document.createElement("div"),this.domRoot.style.display="inlink-block",this.domRoot.style.position="relative",this.domRoot.style.width="0",this.domRoot.style.height="0",this.domRoot.appendChild(this.canvasCropper),this.container.appendChild(this.domRoot),this.overlayMarker=document.createElement("div"),this.overlayMarker.className="egraph_views_overlay-marker",this.domRoot.appendChild(this.overlayMarker),this.rect=new t.BoundingRect,this.empty=!0,this.__updateFlags__=0,this.__pendingFrame__=!1,this._isPierceable=!1,l.call(this,t.pos_number_opt(r,"width",300),t.pos_number_opt(r,"height",150)),this.rectOverlay=new i.RectHoleOverlay(this,t.obj_opt(r,"hole",void 0)),this.boundUpdateOverlay=s.bind(this),this.mainview.addListener("animviewpoint",this.boundUpdateOverlay),this.mainview.addListener("resize",this.boundUpdateOverlay),s.call(this)};var a={SIZE:1,RECT:2};function s(t){var e,i,n,o,r,a;t&&"resize"===t.type?(this.mainview_width=t.size[0],this.mainview_height=t.size[1]):(isNaN(this.mainview_width)||isNaN(this.mainview_height)||0===this.mainview_width||0===this.mainview_height)&&(0!==this.mainview_width&&0!==this.mainview_height||this.mainview.setSize(),a=this.mainview.getSize(),this.mainview_width=a[0],this.mainview_height=a[1]),this.empty?this.rectOverlay.setRectangle():(i=-(e=this.mainview.animVpt)[0]/e[2],n=-e[1]/e[2],o=this.mainview_width/e[2],r=this.mainview_height/e[2],this.rectOverlay.setRectangle(i,n,i+o,n+r))}function h(){this.__pendingFrame__||(this.__pendingFrame__=!0,r(function(){function i(t,i){var n,a,s,h,u,g;for(g=o.nodes.first;g;g=e.dftNext(o,g))g.type===t&&(u=g.views[r])&&(d.fillStyle=!0===u?i:u,s=g.actualLeft*l+p,h=g.actualTop*l+c,n=g.actualWidth*l,a=g.actualHeight*l,y&&(s=Math.round(m*s)*v,h=Math.round(m*h)*v,n=Math.round(Math.max(1,m*n))*v,a=Math.round(Math.max(1,m*a))*v),d.fillRect(s,h,n,a))}var n,o,r,h,l,p,c,u,d,g,f,y,m,v,w,b;w=!1,b=!1,this.__pendingFrame__=!1,n=!1,this.__updateFlags__&a.SIZE&&(this.canvas.width=this.width,this.canvas.height=this.height,n=!0);if(o=this.gr,r=this.viewKey,this.__updateFlags__&a.RECT){for(this.rect.reset(),u=o.nodes.first;u;u=e.dftNext(o,u))u.views[r]&&(g=u.actualLeft,f=u.actualTop,this.rect.update(u,g,g+u.actualWidth,f,f+u.actualHeight));n=!0,this.empty!==!this.rect.isValid()&&(this.empty=!this.rect.isValid(),w=!0)}n&&((h=t.reframeViewpoint([this.width,this.height],this.rect,{padding:this.padding,maxScale:this.maxScale,defaultVpt:this.vpt,aliasing:0}))[0]===this.vpt[0]&&h[1]===this.vpt[1]&&h[2]===this.vpt[2]||(this.animVpt[0]=this.vpt[0]=h[0],this.animVpt[1]=this.vpt[1]=h[1],this.animVpt[2]=this.vpt[2]=h[2],this.invAnimVptScale=this.invVptScale=1/h[2],b=!0));p=this.vpt[0],c=this.vpt[1],l=this.vpt[2],e.Type.NODE,e.Type.GROUP,(d=this.ctx).setTransform(1,0,0,1,0,0),d.clearRect(0,0,this.width,this.height),this.background&&(d.fillStyle=this.background,d.fillRect(0,0,this.width,this.height));void 0===this.aliasing?y=!1:(y=!0,m=Math.pow(2,this.aliasing),v=Math.pow(2,-this.aliasing));i(e.Type.GROUP,this.groupFill),i(e.Type.NODE,this.nodeFill),w&&(s.call(this),this.dispatch({type:"empty"}));b&&(this.dispatch({type:"viewpoint",vpt:this.vpt.slice()}),this.dispatch({type:"animviewpoint",vpt:this.animVpt.slice()}))}.bind(this)))}function l(e,i){if("number"!=typeof e)throw new Error("width must be a number");if("number"!=typeof i)throw new Error("height must be a number");if(!isFinite(e)||e<0)throw new Error("width must be finite and >= 0");if(!isFinite(i)||i<0)throw new Error("height must be finite and >= 0");return(this.width!==e||this.height!==i)&&(this.width=e,this.height=i,this.domRoot.style.width=t.nb2px(this.width),this.domRoot.style.height=t.nb2px(this.height),this.__updateFlags__|=a.SIZE,!0)}function p(t){this.ovrGraphView=t,this.start=null}function c(t){this.ovrGraphView=t,this.start=null}return t.inherit(o.GraphView,e.GraphView),t.applyMixin(o.GraphView,e.Observable),t.applyMixin(o.GraphView,i.TransformedGraphView),o.GraphView.prototype.oninit=function(t,i){e.GraphView.prototype.oninit.apply(this,arguments),this.__updateFlags__|=a.RECT,h.call(this)},o.GraphView.prototype.setPierceable=function(t){if(this._isPierceable!==t){var e=function(t){var e,i;if(t)for(e=i=t;e.parentNode;e=e.parentNode){if(e.querySelector(".egraph_views_domroot"))return i;i=e}}(this.container);e&&(t?(e.style.opacity=.2,e.style.pointerEvents="none",this._isPierceable=!0):(e.style.opacity=1,e.style.pointerEvents="auto",this._isPierceable=!1))}},o.GraphView.prototype.onupdate=function(t,i){function n(t){var i,n,o,r;if(!t)return!1;for(n=0,o=t.length;n<o;++n){if(12&(i=t[n]).__updateFlag__)return!0;if(2&i.__updateFlag__&&(r=i.__modifiedProperties__,e.inPathSet(r,"actualWidth")||e.inPathSet(r,"actualHeight")||e.inPathSet(r,"actualLeft")||e.inPathSet(r,"actualTop")))return!0}return!1}var o;if(e.GraphView.prototype.onupdate.apply(this.arguments),t!==this.gr)throw new Error("Invalid Argument: gr");(o=n(i[e.Type.GROUP]))||(o=n(i[e.Type.NODE])),o&&(this.__updateFlag__=a.RECT,h.call(this))},o.GraphView.prototype.setSize=function(t,e){l.call(this,t,e)&&(h.call(this),this.dispatch({type:"resize",size:[this.width,this.height]}))},o.GraphView.prototype.getSize=function(){return[this.width,this.height]},p.prototype.ontouchmove=function(e){var i;function n(t){return Math.sqrt(Math.pow(t.graphTouches[0].clientPos[0]-t.graphTouches[1].clientPos[0],2)+Math.pow(t.graphTouches[0].clientPos[1]-t.graphTouches[1].clientPos[1],2))}this.start||(this.start={mainVpt:this.ovrGraphView.mainview.vpt.slice(),ovrVpt:this.ovrGraphView.vpt.slice(),d:n(e),fixPt:[(e.graphTouches[0].graphPos[0]+e.graphTouches[1].graphPos[0])/2,(e.graphTouches[0].graphPos[1]+e.graphTouches[1].graphPos[1])/2]}),i=n(e);var o=t.changeViewpointScale(this.start.mainVpt,this.start.mainVpt[2]*this.start.d/i,this.start.fixPt,!0);o[0]-=o[2]*(e.graphTouches[0].clientDelta[0]+e.graphTouches[1].clientDelta[0])/(2*this.start.ovrVpt[2]),o[1]-=o[2]*(e.graphTouches[0].clientDelta[1]+e.graphTouches[1].clientDelta[1])/(2*this.start.ovrVpt[2]),this.ovrGraphView.mainview.setViewpoint(o)},p.prototype.onend=function(t){t&&this.start&&this.ovrGraphView.mainview.setViewpoint(this.start.mainVpt),this.start=null},t.inherit(c,n.SinglePtDrag),c.prototype.onmove=function(t){this.start||(this.start={mainVpt:this.ovrGraphView.mainview.vpt.slice(),ovrVpt:this.ovrGraphView.vpt.slice()});var e=[this.start.mainVpt[0]-Math.round(this.start.mainVpt[2]*t.clientDelta[0]/this.start.ovrVpt[2]),this.start.mainVpt[1]-Math.round(this.start.mainVpt[2]*t.clientDelta[1]/this.start.ovrVpt[2]),this.start.mainVpt[2]];this.ovrGraphView.mainview.setViewpoint(e)},c.prototype.onend=function(t){t&&this.start&&this.ovrGraphView.mainview.setViewpoint(this.start.mainVpt),this.start=null},o.RootState=function(){var t;function e(t,e){var i,n;n=t.graphView.mainview.getSize(),i=[Math.round(n[0]/2-t.graphView.mainview.vpt[2]*e[0]),Math.round(n[1]/2-t.graphView.mainview.vpt[2]*e[1]),t.graphView.mainview.vpt[2]],t.graphView.mainview.setViewpoint(i)}t=this,this.twoPtsWait={ontouchstart:function(t,e){return{consume:!0,state:n.WaitLastTouch}},ontouchend:function(t,e){return{consume:!0,state:e.graphTouches.length?n.WaitLastTouch:null}},ontouchcancel:function(t,e){return{consume:!0,state:e.graphTouches.length?n.WaitLastTouch:null}},ontouchmove:function(t,e){return n.isTouchDragSignificant(e)?(t.startdrag(new p(t.graphView)),{consume:!0,state:n.EndDragOnTouchChange}):{consume:!0}}},this.onePtWait={ontouchstart:function(e,i){return 1===i.changedTouches.length?{consume:!0,state:t.twoPtsWait}:{consume:!0,state:n.WaitLastTouch}},ontouchend:function(t,i){return e(t,i.changedTouches[0].graphPos),{consume:!0,state:null}},ontouchcancel:function(){return{consume:!0,state:null}},ontouchmove:function(t,e){return n.isTouchDragSignificant(e)?(t.startdrag(new c(t.graphView)),{consume:!0,state:n.EndDragOnTouchChange}):{consume:!0}}},this.leftClickWait={onmouseup:function(t,i){return i.button===n.Buttons.LEFT?(e(t,i.graphPos),{consume:!0,state:null}):{}},onmousemove:function(t,e){return e.clientDelta[0]&&e.clientDelta[1]?(t.startdrag(new c(t.graphView)),{consume:!0,state:n.EndDragOnLeftState}):{}}}},o.RootState.prototype.onwheel=function(e,i){var n,o,r;if(i.inside){var a=void 0,s=void 0;return(n=e.graphView.mainview).gr.zoomOpts&&(n.gr.zoomOpts.min&&!isNaN(n.gr.zoomOpts.min)&&(a=n.gr.zoomOpts.min),n.gr.zoomOpts.max&&!isNaN(n.gr.zoomOpts.max)&&(s=n.gr.zoomOpts.max)),r=n.getSize(),o=t.incViewpointScale(n.vpt,.5*i.wheelDelta,[.5*r[0],.5*r[1]],!1,[a,s,.5]),n.setViewpoint(o,!0),{consume:!0}}return{}},o.RootState.prototype.ontouchstart=function(t,e){return 2===e.changedTouches.length?{consume:!0,state:this.twoPtsWait}:e.changedTouches.length>2?{consume:!0,state:o.WaitLastTouch}:{consume:!0,state:this.onePtWait}},o.RootState.prototype.ontouchend=function(t,e){return{consume:!0}},o.RootState.prototype.ontouchcancel=function(t,e){return{consume:!0}},o.RootState.prototype.ontouchmove=function(t,e){return{consume:!0}},o.RootState.prototype.onmousedown=function(t,e){return e.inside&&e.button===n.Buttons.LEFT?{consume:!0,state:this.leftClickWait}:{}},o.RootState.prototype.ondragover=function(t,e){return t.graphView.setPierceable(!0),{consume:!0}},o});