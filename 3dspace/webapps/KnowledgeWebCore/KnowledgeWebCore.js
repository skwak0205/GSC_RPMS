define("DS/KnowledgeWebCore/KnowledgeMagnitudeServices",["DS/KnowledgeWebUtils/Utils","DS/KnowledgeWebUtils/Listenable","text!DS/KnowledgeWebCore/assets/catrsc/KnowledgeMagnitudes.json","text!DS/KnowledgeWebCore/assets/catrsc/MagnitudeRelations.json","DS/VENMathjs/VENMathjs"],function(e,n,t,i,r){"use strict";const o=JSON.parse(t).magnitudes,a=JSON.parse(i);r.config({number:"BigNumber",precision:30});var u=new n;return u.getConfiguration=function(){},u.getMagnitude=function(e){return o.find(function(n){return n.Name===e})},u.getMagnitudes=function(){return[...o]},u.getMKSUnit=function(e){var n=null,t=u.getMagnitude(e);if(t){var i=t.MKSUnit;n=t.Units.find(function(e){return e.Name===i})}return n},u.getUnitFromNLS=function(e,n){var t=null,i=u.getMagnitude(e);return i&&(t=i.Units.find(function(e){return e.NLSName===n})),t},u.getUnitFromLabel=function(e,n){var t=null;const i=n.toLowerCase();var r=u.getMagnitude(e);return r&&(t=r.Units.find(function(e){return e.label.toLowerCase()===i})),t},u.isAMagnitude=function(e){return o.some(function(n){return n.Name===e})},u.convert=function(e,n,t){var i=e,o=null;if("number"==typeof e||"string"==typeof e)try{o=r.eval(e)}catch(e){o=null}else Array.isArray(e)&&(o=e);if(o&&n&&t&&(n===t?i=o:(i=r.multiply(r.subtract(r.bignumber(o),r.bignumber(parseFloat(n.offset))),r.bignumber(parseFloat(n.value))),i=r.add(r.divide(r.bignumber(i),r.bignumber(parseFloat(t.value))),r.bignumber(parseFloat(t.offset))))),Array.isArray(i))return i.map(function(e){return parseFloat(r.format(e))});try{return JSON.parse(r.format(i,15))}catch(n){return e}},u.setUnitToDisplay=function(e,n){localStorage.setItem("KnowledgeMagnitude_"+e,n),u.notify(e+"_unitChanged"),u.notify("unitChanged")},u.setDisplayPrecision=function(e,n){localStorage.setItem("KnowledgeMagnitudePrecision_"+e,n),u.notify(e+"_unitChanged"),u.notify("unitChanged")},u.getDisplayPrecision=function(n){var t;if(window&&window.widget&&window.widget.getPreference){var i=window.widget.getPreference("displayPrecision");i&&(t=i.value)}else t=localStorage.getItem("KnowledgeMagnitudePrecision_"+n);return!1!==e.exists(t)&&""!==t||(t=6),parseInt(t)},u.getUnitToDisplay=function e(n){var t=null,i="";if("string"==typeof n&&n.length>0){if(window&&window.widget&&window.widget.getPreference){var r=n.charAt(0).toUpperCase()+n.toLowerCase().slice(1)+"Unit",u=window.widget.getPreference(r);u&&(i=u.value)}""===i&&(i=localStorage.getItem("KnowledgeMagnitude_"+n));var s=o.find(function(e){return e.Name===n});if(s){if(!i){i=s.MKSUnit;const n=a[s.Name];if(n){const t=e(n.parentMagnitudeName),r=n.lut[t.Name];r&&(i=r)}}(t=s.Units.find(function(e){return e.Name===i||e.label===i}))||(i=s.MKSUnit,t=s.Units.find(function(e){return e.Name===i||e.label===i}))}}return t},u.convertRealToMks=function(e,n){var t=u.getMKSUnit(n),i=u.getUnitToDisplay(n);return u.convert(e,i,t)},u.convertMksToReal=function(e,n,t){var i=u.getMKSUnit(n),r=t?u.getUnitFromLabel(n,t):u.getUnitToDisplay(n);return u.convert(e,i,r)},u.formatToPrecision=function(e,n){if("number"!=typeof e&&"string"!=typeof e)return e;try{var t=r.eval(e),i=u.getDisplayPrecision(n);i||(i=15);var o=r.round(t,i),a=r.pow(r.eval(10),r.eval(-i));return r.equal(r.compare(r.abs(t),a),-1)?r.format(t,{notation:"auto",precision:i,lowerExp:-i}):r.format(o)}catch(n){return e}},u.show=function(e,n,t){var i=null;return n&&(i=u.getUnitToDisplay(n)),i?""+u.formatToPrecision(u.convertMksToReal(e,n),n)+(t||"")+(i&&i.label?i.label:""):""+u.formatToPrecision(e,n)},u.updateMagnitudeFromPreference=function(e){if(!0===e.submitted&&window&&window.widget){var n=window.widget.getPreference("displayPrecision"),t=window.widget.getPreference("LengthUnit"),i=window.widget.getPreference("AngleUnit");n&&n.value&&t&&t.value&&i&&i.value&&(this.setUnitToDisplay("PRECISION",n.value),this.setUnitToDisplay("LENGTH",t.value),this.setUnitToDisplay("ANGLE",i.value))}},u.addition=function(n,t){var i=void 0;return e.exists(n)&&e.exists(t)&&(e.isString(n)&&(n=n.replace(",",".")),n=parseFloat(n),isNaN(n)||isNaN(t)||(i=JSON.parse(r.format(r.add(r.bignumber(n),r.bignumber(t)),15)))),i},u.preferenceCB||(u.preferenceCB=u.updateMagnitudeFromPreference.bind(u)),window&&window.widget&&window.widget.addEvent("endEdit",u.preferenceCB),u}),define("DS/KnowledgeWebCore/context",["DS/KnowledgeWebUtils/Utils","DS/KnowledgeWebUtils/Listenable"],function(e,n){"use strict";var t=new n,i={};function r(e){for(var n=e.split("."),i=t,r=0;r<n.length&&null!=i;r++)i=void 0!==i[n[r]]?i[n[r]]:null;return i}return t.setValue=function(n,o){var a=r(n);!function(n,i){for(var r=n.split("."),o=t,a=0;a<r.length&&null!=o;a++)void 0!==i&&a===r.length-1?o[r[a]]=i:e.exists(o[r[a]])||(o[r[a]]={}),o=o[r[a]]}(n,o);this.notify(n+"Changed",{new:o,old:a}),void 0!==i[n]&&i[n].resolve(o)},t.getValue=function(e){return r(e)},t.getValuePromise=function(e){var n;void 0===i[e]&&(i[e]=new Promise(function(e){n=e}),i[e].resolve=n);return i[e]},t});