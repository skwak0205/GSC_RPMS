define("DS/DibUDLWebLoader/CGR_UDLWebLoader",["DS/ZipJS/zip-fs","DS/Visualization/Node3D","DS/Visualization/ModelLoader","DS/Visualization/ThreeJS_DS"],function(e,t,n,i){"use strict";return{loadCGRs:function(t){return function(t){var o=t.CGRNode,a=t.cgrName;a||t.onFailure();var r=t.zipUDL.find(a);r||t.onFailure();var s=new e.BlobWriter,u=new i.Matrix4;u.setPosition(new i.Vector3(0,0,0));u.setRotation([1,0,0,0,1,0,0,0,1]),o.setMatrix(u);var c=new n;c.setFileType("cgr"),c.set2DAccuracy(t.Accuracy2D),c.set3DAccuracy(t.Accuracy3D),1==t.DrawOrderMode&&c.setSceneGraphOrderMode(1),c.setOnLoadedCallback(function(){t.onSuccess(o)}),r.getData(s,function(e){var t=new FileReader;t.onload=function(){c.loadModelFromBuffer(this.result,o)},t.readAsArrayBuffer(e)});var l=t.cgrNameText;if(""!==l){var f=t.zipUDL.find(l),d=new e.BlobWriter;f.getData(d,function(e){var t=new FileReader;t.onload=function(){c.loadModelFromBuffer(this.result,o)},t.readAsArrayBuffer(e)})}}(t)}}}),define("DS/DibUDLWebLoader/DifSupplementalGeometryUDLWebLoader",["DS/Visualization/Node3D"],function(e){"use strict";var t=function(t){var n="get_SupGeoRef_ObjectInternal",i=t.iRef;i||t.onFailure(n+" no iRef");var o=t.ioMap_ID_Node;o||t.onFailure(n+" no ioMap_ID_Node");var a=t.ioMap_ID_Obj;a||t.onFailure(n+" no ioMap_ID_Obj");var r=a.get(i.iD);r&&t.onSuccess(r);var s=o.get(i.Dif3DShapeInst.Dif3DShapeRepRef.iD);s||t.onFailure(n+" no ShapeNode");var u=o.get(i.Dif3DShapeInst.iD);u||(u=new e,o.set(i.Dif3DShapeInst.iD,u),u.addChild(s));var c=o.get(i.iD);c||(c=new e,o.set(i.iD,c),c.addChild(u));(r={}).iD=i.iD,r.Name=i.Name,r.Type="SupplementalGeometry";var l={};l.node3D=c,r.visuinfo=l,a.set(r.iD,r),t.onSuccess(r)},n=function(n){var i="get_SupGeoInstance_ObjectInternal",o=n.iInstance;o||n.onFailure(i+" no iInstance");var a=n.ioMap_ID_Node;a||n.onFailure(i+" no ioMap_ID_Node");var r=n.ioMap_ID_Obj;r||n.onFailure(i+" no ioMap_ID_Obj");var s=r.get(o.iD);s&&n.onSuccess(s);var u=a.get(o.iD);u||(u=new e,a.set(o.iD,u));(s={}).iD=o.iD,s.Name=o.Name,s.Type="SupplementalGeometryInstance",s.Childs=[];var c={};c.node3D=u,s.visuinfo=c;var l={iRef:o.SupGeoRef,ioMap_ID_Node:a,ioMap_ID_Obj:r,onSuccess:function(e){s.Name||(s.Name=e.Name),s.Childs.push(e),s.visuinfo.node3D?s.visuinfo.node3D.addChild(e.visuinfo.node3D):n.onFailure(i+" no node3D")},onFailure:function(e){console.log(e),n.onFailure(i)}};t(l),r.set(s.iD,s),n.onSuccess(s)};return{get_SupGeoRef_Object:function(e){return t(e)},get_SupGeoInstance_Object:function(e){return n(e)},Manage_SupGeo_Object:function(e){return function(e){var t="Manage_SupGeo_ObjectInternal",i=e.iFather;i||e.onFailure(t+" no iFather");var o=e.ioMap_ID_Node;o||e.onFailure(t+" no ioMap_ID_Node");var a=e.ioMap_ID_Obj;a||e.onFailure(t+" no ioMap_ID_Obj");var r=e.iObj_Father;r||e.onFailure(t+" no iObj_Father"),i.SupGeos&&i.SupGeos.forEach(function(i){n({iInstance:i,ioMap_ID_Node:o,ioMap_ID_Obj:a,onSuccess:function(n){r.Childs.push(n),r.visuinfo.node3D?r.visuinfo.node3D.addChild(n.visuinfo.node3D):e.onFailure(t+" no node3D")},onFailure:function(n){console.log(n),e.onFailure(t)}})}),e.onSuccess()}(e)}}}),define("DS/DibUDLWebLoader/DifUDLWebLoader",["UWA/Core","UWA/Class","DS/ZipJS/zip-fs","DS/Visualization/Node3D","DS/Visualization/ModelLoader","DS/Visualization/ThreeJS_DS","DS/DibWebUtils/DibQueryToolbox","DS/Visualization/RenderStyle","DS/Visualization/PathElement","DS/FedDictionaryAccess/FedDictionaryAccessAPI","DS/Visualization/SceneGraphFactory"],function(e,t,n,i,o,a,r,s,u,c,l){"use strict";let f=()=>require("DS/PADUtils/PADUtilsServices").getPlatformId(),d=()=>require("DS/PADServices/utils/GlobalUtils").getLang();return t.extend({init:function(){var t,c,D,h,p,v=[],S=new Map,g=new Map,I=new Map,b=new Map,w=new Map,m=[],y=0,F=0,_=0,L={},M=0,C=[],A=[],V=[],T=50,P=new Map,x=new Map,N=new Map,R=new Map;R.set("originated","originated_param"),R.set("modified","modified_param"),R.set("current","ds6w:status"),R.set("policy","ds6w:policy"),R.set("reserved","ds6w:reserved"),R.set("revision","ds6wg:majorrevision"),R.set("V_Name","bo.PLMEntity.V_Name"),R.set("PLM_ExternalID","bo.PLMEntity.PLM_ExternalID");var U=function(e){return"DIFLayout"===e},O=function(e){console.log(e)},j=function(e,t,n){e.ObjectList&&e.ObjectList.forEach(function(e){var n=new a.Matrix4;n.setPosition(new a.Vector3(e.SymbolCompToViewMatrix[4],e.SymbolCompToViewMatrix[5],0));var i=[e.SymbolCompToViewMatrix[0],e.SymbolCompToViewMatrix[2],0,e.SymbolCompToViewMatrix[1],e.SymbolCompToViewMatrix[3],0,0,0,1];n.setRotation(i);var o=b.get(e.ID);o&&(o.setMatrix(n),t.addChild(o)),e.ObjectList&&e.ObjectList.forEach(function(e){var n=new a.Matrix4;n.setPosition(new a.Vector3(e.SymbolCompToViewMatrix[4],e.SymbolCompToViewMatrix[5],0));var i=[e.SymbolCompToViewMatrix[0],e.SymbolCompToViewMatrix[2],0,e.SymbolCompToViewMatrix[1],e.SymbolCompToViewMatrix[3],0,0,0,1];n.setRotation(i);var o=b.get(e.ID);o.setMatrix(n),t.addChild(o)})}),n()},E=function(e,t,n){return new Promise(i=>{var r=t.cgr,s=e.find(r),u=new zip.BlobWriter,c=new a.Matrix4;c.setPosition(new a.Vector3(0,0,0));c.setRotation([1,0,0,0,1,0,0,0,1]),n.setMatrix(c);var l=new o;l.setFileType("cgr"),l.set2DAccuracy(y),l.set3DAccuracy(F),1===_&&l.setSceneGraphOrderMode(1),l.setOnLoadedCallback(function(){i()}),s.getData(u,function(e){var t=new FileReader;t.onload=function(){l.loadModelFromBuffer(this.result,n)},t.readAsArrayBuffer(e)});var f=t.cgr_texts;if(""!==f){var d=e.find(f),D=new zip.BlobWriter;d.getData(D,function(e){var t=new FileReader;t.onload=function(){l.loadModelFromBuffer(this.result,n)},t.readAsArrayBuffer(e)})}})},W=async function(e,t,n){for(let i of t)await E(e,i[0],i[1]).then(()=>{i[2]?(b.set(i[0].ID,i[2]),i[2].addChild(i[1])):b.set(i[0].ID,i[1]),n()})},B=function(e,t,n){let i=Math.ceil(t.length/10);for(let a=0;a<10;a++){var o=t.slice(i*a,i*(a+1));W(e,o,n)}},G=function(e,n,o,a,s,u,l){!function(e,n,i,o){var a="getSymbolRealPlmId: ";e||(O(a+"Please provide view stream ID"),o()),n||(O(a+"Please provide symbols relation ID"),o());var s={difViewStreamId:e,symbolsInViewRelIds:n,serverUrl:t,securityContext:c,onComplete:function(e,t){i(e,t)},onFailure:function(){O(a+"Failed getRepObjPlmIdAssociatedToSymbol"),o()}};r.getRepObjPlmIdAssociatedToSymbol(s)}(o,s,function(t,o){x.clear(),N.clear(),t&&t.forEach(function(e){x.set(e.matches[0].sr_id,e.physicalid)}),o&&o.forEach(function(e){N.set(e.matches[0].sr_id,e.to.physicalid)});!function(e,t,n){if(t.ObjectList){let r=[];t.ObjectList.forEach(function(e){if("Symbol"===e.Type){var t=new i,n=x.get(e.Relation_ID);if(t._dibInfo={id:n,type:e.PLM_Type},t.getDibInfo=function(){return this._dibInfo},e.PLM_ref_ID&&e.PLM_ref_Type){var o=new i,a=N.get(e.Relation_ID);o._dibInfo={id:a,type:e.PLM_ref_Type},o.getDibInfo=function(){return this._dibInfo},r.push([e,o,t])}else r.push([e,t])}if("Route"===e.Type){var s=new i,u=x.get(e.Relation_ID);if(s._dibInfo={id:u,type:e.PLM_Type},s.getDibInfo=function(){return this._dibInfo},e.PLM_ref_ID&&e.PLM_ref_Type){var c=new i,l=N.get(e.Relation_ID);c._dibInfo={id:l,type:e.PLM_ref_Type},c.getDibInfo=function(){return this._dibInfo},r.push([e,c,s])}else r.push([e,s])}e.ObjectList&&e.ObjectList.forEach(function(e){var t=new i,n=x.get(e.Relation_ID);if(t._dibInfo={id:n,type:e.PLM_Type},t.getDibInfo=function(){return this._dibInfo},e.PLM_ref_ID&&e.PLM_ref_Type){var o=new i,a=N.get(e.Relation_ID);o._dibInfo={id:a,type:e.PLM_ref_Type},o.getDibInfo=function(){return this._dibInfo},r.push([e,o,t])}else r.push([e,t])})});var o=0;if(r){var a=r.length;B(e,r,function(){a===++o&&n()})}}}(e,n,function(){0,u()})},function(){O("loadViewSymbols:  Failed getSymbolRealPlmId"),l()})},k=function(e,t){var n={};e.results.forEach(function(e){if(e.attributes){var t={};e.attributes.forEach(function(e){t[e.name]=e.value}),n=t}}),t(n)},z=function(e,n,i,o,a,s){var u="manageTextToDisplay ";e||(O(u+"Please provide view stream ID"),s()),n.length>0?function(e,n,i,o,a){var s="queryTextToDisplayWithSRId: ";e||(O(s+"Please provide view stream ID"),a()),n||(O(s+"Please provide text relation ID"),a()),i||(O(s+"Please provide text relation ID"),a());var u=n.length;let l=[];for(;u--;){var f={difViewStreamId:e,textsSRId:n[u],textsAttr:i[u],serverUrl:t,securityContext:c,onComplete:function(e){l.push(e),l.length===n.length&&o(l)},onFailure:function(){O(s+"Failed to retrieve query from text SR "),a()}};r.getPointedObjects(f)}}(e,n,o,function(e){a(e)},function(){O(u+"Failed"),s()}):i.length>0&&function(e,n,i){var o="queryTextToDisplayWithPointedID: ";e||(O(o+"Please provide text relation ID"),i());var a=e.length;let s=[];for(;a--;){var u=e[a],l={objectPhysicalid:u,textsAttr:w.get(u).AttributeName,serverUrl:t,securityContext:c,onComplete:function(t){k(t,function(e){s.push(e)}),s.length===e.length&&n(s)},onFailure:function(){O(o+"Failed to retrieve query from text SR "),i()}};r.expandPointedObject(l)}}(i,function(e){a(e)},function(){O(u+"Failed"),s()})},J=function(e,t,n){var i=0;e||(O("exploitTextToDisplay No data to exploit"),n()),e.forEach(function(n){var o,a,r=n.physicalid,s=r;if(n.matches&&(s=n.matches[0].sr_id),r){var u=w.get(s),c=u.AttributeName,l=u.ResultString;if(l){var D={};for(let e=0;e<l.length;e++){var h=c[e];n[h]&&(D[h]=[],D[h].push(n[h]))}(o=D,a={},new Promise(function(e){require(["DS/FedDictionaryAccess/FedDictionaryAccessAPI"],function(t){t.getNlsOfPropertiesValues(JSON.stringify(o),{tenantId:f(),lang:d(),onComplete:function(t){e(a=t)},onFailure:function(){e(a)}})})})).then(function(n){if(n&&0!==n.length){var o=0;for(let e=0;e<l.length;e++){var a=c[e],r=l[e],f=D[a];if(f){var d=n[a][f];r!==d&&(u.ResultString[e]=d,u.Modified[e]="TRUE",o=1)}}1===o&&w.set(s,u),++i===e.length&&t()}})}}else i++})},q=function(e,t,n,o,r,s,u,c,f){var d=0;z(n,r,s,u,function(n){J(n,function(){!function(e,t,n){let o=[];t.ObjectList&&t.ObjectList.forEach(function(e){if("AnnWithLink"===e.Type){var t=R.get(e.AttributeName);t||(t=e.AttributeName);var r,s,u=new i;if(e.Relation_ID){var c=w.get(e.Relation_ID);r=c.ResultString[0],s=c.Modified[0]}else if(e.PLM_ref_ID){var f=w.get(e.PLM_ref_ID),d=f.AttributeName;for(let e=0;e<d.length;e++)if(t===d[e]){r=f.ResultString[e],s=f.Modified[e];break}}if("TRUE"===s){var D={text:r,hotspot:{x:0,y:0},font:e.FontName,color:(new a.Color).setRGB(e.Red/255,e.Green/255,e.Blue/255),fontSize:e.FontSize,bold:e.bold},h=l.createTextNode(D);u.addChild(h),b.set(e.ID,u),n()}else o.push([e,u])}}),B(e,o,n)}(e,t,function(){o===++d&&c()})},function(){O("loadViewTexts Failed exploitTextToDisplay"),f()})},function(){O("loadViewTexts Failed manageTextToDisplay"),f()})},H=function(e,t,n,o,a){var r=new i,s=P.get(n);if(s)o(s);else{P.set(n,r);var u=0,c=[],l=0,f=[],d=[],D=[];t.ObjectList&&(u=t.ObjectList.length,w.clear(),t.ObjectList.forEach(function(e){if("AnnWithLink"===e.Type){var t=R.get(e.AttributeName);if(t||(t=e.AttributeName),D.push(t),e.Relation_ID){f.push(e.Relation_ID);var n={AttributeName:[],ResultString:[],Modified:[]};n.AttributeName.push(t),n.ResultString.push(e.ResultString),n.Modified.push("FALSE"),w.set(e.Relation_ID,n)}else if(e.PLM_ref_ID){var i=w.get(e.PLM_ref_ID);if(i)i&&(i.AttributeName.push(t),i.ResultString.push(e.ResultString),i.Modified.push("FALSE"));else{d.push(e.PLM_ref_ID);var o={AttributeName:[],ResultString:[],Modified:[]};o.AttributeName.push(t),o.ResultString.push(e.ResultString),o.Modified.push("FALSE"),i=o,w.set(e.PLM_ref_ID,i)}}l++,u--}else c.push(e.Relation_ID),e.ObjectList&&e.ObjectList.forEach(function(e){-1===c.indexOf(e.Relation_ID)&&(c.push(e.Relation_ID),u++)})})),l>0?q(e,t,n,l,f,d,D,function(){u>0?G(e,t,n,0,c,function(){j(t,r,function(){E(e,t,r).then(()=>{o(r)})})},function(){O("loadViewCGRs Failed loadViewSymbols"),a()}):j(t,r,function(){E(e,t,r).then(()=>{o(r)})})},function(){O("loadViewCGRs Failed loadViewTexts"),a()}):u>0?G(e,t,n,0,c,function(){j(t,r,function(){E(e,t,r).then(()=>{o(r)})})},function(){O("loadViewCGRs Failed loadViewSymbols"),a()}):E(e,t,r).then(()=>{o(r)})}},Q=function(o,l,f,d){var D="getSheet3DNodeFromIDInternal : ";o||(O(D+"Please provide sheet ID"),d());var h=g.get(o);if(h)return l(h),void f();var p=S.get(o);p||(O(D+"Sheet not found"),d());var v=[];p.BackgroundViewInstance&&p.BackgroundViewInstance.viewStream&&v.push(p.BackgroundViewInstance.viewStream.ID),p.views.forEach(function(e){e.view&&e.view.viewStreamInstance.viewStream&&v.push(e.view.viewStreamInstance.viewStream.ID)});var I=new i,w=I.createOverrideSetManager(),m=w.createSceneGraphOverrideSet();w.pushSceneGraphOverrideSet(m);var y=m.createOverride(new u([I])),F=new s({combineRenderMode:"IGNORE"});F.setFaceMode("MATERIAL"),y.setRenderStyle(F,!0),l(I),g.size===M&&g.clear(),g.set(o,I);var L={objectPhysicalid:v,serverUrl:t,securityContext:c,onComplete:function(t){t.results||(O(D+"getUDLData : No data retrieved"),d());var i=t.results.length,o=0,r=!1;t.results.forEach(function(t){var s;e.is(t.attributes,"array")&&(t.attributes.forEach(function(e){if("resourceid"===e.name&&(s=e.value),"udl"===e.name){r=!0;var t=new n.fs.FS,u={provider:"FILE",filename:e.value,serverurl:"",proxyurl:"none",requiredAuth:null};t.importHttpContent(u,!1,function(){var e=t.find("DrwStructure.json");null===e&&(O(D+"failed zipEntries"),d()),e.getText(function(e){var n=JSON.parse(e.target.result);_=n.DrawOrderMode,H(t,n.View,s,function(e){b.set(s,e),i!==++o||function(e,t,n){var i=b.get(e.BackgroundViewInstance.viewStream.ID);t.addChild(i),e.views.forEach(function(e){var n,i=e.Angle;n="OnReference"===e.view.ScaleStatus?e.view.Scale:e.Scale;var o=new a.Matrix4;o.setPosition(new a.Vector3(e.X,e.Y,0));var r=[Math.cos(i)*n,Math.sin(i)*n,0,-Math.sin(i)*n,Math.cos(i)*n,0,0,0,1];o.setRotation(r);var s=b.get(e.view.viewStreamInstance.viewStream.ID);s.setMatrix(o),t.addChild(s)}),n()}(p,I,function(){f(),b.clear()})},function(){O(D+"failed loadViewCGRs"),d()})})},function(){O(D+"failed importHttpContent"),d()})}}),r||(O(D+"UDL - No UDL for input model"),d()))})},onFailure:function(){O(D+"Failed getUDLData query"),d()}};r.getUDLData(L)},X=function(i,o,s,u){var l="setDisplaySheetInternal : ";i||(O(l+"Please provide sheet ID"),u());var f=S.get(i);f||(O(l+"Sheet not found"),u());var d=[];f.BackgroundViewInstance&&f.BackgroundViewInstance.viewStream&&d.push(f.BackgroundViewInstance.viewStream.ID),f.views.forEach(function(e){e.view&&e.view.viewStreamInstance.viewStream&&d.push(e.view.viewStreamInstance.viewStream.ID)}),f.views.length+1>T-P.size&&P.clear();var v={objectPhysicalid:d,serverUrl:t,securityContext:c,onComplete:function(t){t.results||(O(l+"no results in data"),u());var i=t.results.length,r=0,c=!1;t.results.forEach(function(t){var d;e.is(t.attributes,"array")&&(t.attributes.forEach(function(e){if("resourceid"===e.name&&(d=e.value),"udl"===e.name){c=!0;var t=new n.fs.FS,v={provider:"FILE",filename:e.value,serverurl:"",proxyurl:"none",requiredAuth:null};t.importHttpContent(v,!1,function(){var e=t.find("DrwStructure.json");null===e&&(O(l+"failed zipEntries"),u()),e.getText(function(e){var n=JSON.parse(e.target.result);H(t,n.View,d,function(e){b.set(d,e),i!==++r||function(e,t){D&&C.length>0&&D.getController().lockNodes({ids:C}),p&&h&&h.removeChild(p),V.forEach(function(e){e.removeChildren()}),V.splice(0,V.length);var n,i=b.get(e.BackgroundViewInstance.viewStream.ID);p=i,D&&(n=D.getController().getNode({id:e.ID})),n&&(h=n,n.addChild(i),g.set(e.ID,n)),e.views.forEach(function(e){var t,n=e.Angle;t="OnReference"===e.view.ScaleStatus?e.view.Scale:e.Scale;var i=new a.Matrix4;i.setPosition(new a.Vector3(e.X,e.Y,0));var o=[Math.cos(n)*t,Math.sin(n)*t,0,-Math.sin(n)*t,Math.cos(n)*t,0,0,0,1];i.setRotation(o);var r,s=b.get(e.view.viewStreamInstance.viewStream.ID);D&&(r=D.getController().getNode({id:e.view.ID})),r&&(V.push(r),r.addChild(s)),s.setMatrix(i)}),t(n)}(f,function(e){o(e),s(),b.clear()})},function(){O(l+"failed loadViewCGRs"),u()})})},function(){O(l+"failed importHttpContent"),u()})}}),c||(O(l+"UDL - No UDL for input model"),u()))})},onFailure:function(){O(l+"Failed getUDLData query"),u()}};r.getUDLData(v)};this.getNumberOfSheets=function(){return v.length},this.getSheetName=function(e){return function(e){return S.get(e).Name}(e)},this.getLoadedSheetsId=function(){return m},this.getSheetBackgroundColor=function(e){return(new a.Color).setRGB(1,1,1)},this.getSheet3DNode=function(e){Q(e.sheetID,e.onSheetNodeCreated,e.onSheetLoaded,e.onFailure)},this.setDisplaySheet=function(e){X(e.sheetID,e.onSheetNodeCreated,e.onSheetLoaded,e.onFailure)},this.getSheetSize=function(e){return{height:S.get(e).Height,width:S.get(e).Width}},this.setMaxSheetInCache=function(e){M=e},this.isDetailSheet=function(e){return!1},this.is3DObject=function(){return!1},this.getSheetThumbnail=function(e){e.onFailure()},this.setSheetPickingByView=function(e){var t=g.get(e.sheetID);null!==t&&t.children.forEach(function(t){t.userData&&"DIFViewInstance"===t.userData.type?V.forEach(function(t){t.children.forEach(function(t){t.children.forEach(function(t){"CGR"===t.name&&t.setPickParent(e.pickingByView),t.children.forEach(function(t){"CGR"===t.name&&t.setPickParent(e.pickingByView),t.children.forEach(function(t){"CGR"===t.name&&t.setPickParent(e.pickingByView)})})})})}):t.children.forEach(function(t){"CGR"===t.name&&t.setPickParent(e.pickingByView),t.children.forEach(function(t){"CGR"===t.name&&t.setPickParent(e.pickingByView),t.children.forEach(function(t){"CGR"===t.name&&t.setPickParent(e.pickingByView)})})})})},this.set2DAccuracy=function(e){y=e},this.set3DAccuracy=function(e){F=e},this.clearLoader=function(){v&&(v=null),S&&(S=null),g&&(g=null),I&&(I=null),b&&(b=null),m&&(m=null),t&&(t=null),c&&(c=null),y&&(y=null),F&&(F=null),_&&(_=null),L&&(L=null),M&&(M=null),D&&(D=null),C&&(C=null),A&&(A=null),h&&(h=null),p&&(p=null),V&&(V=null),T&&(T=null),P&&(P=null),x&&(x=null),N&&(N=null)},this.loadModel=function(e){if(e||(O("DifUDLWebLoader: Bad parameters"),e.onFailure()),e.serverUrl)if(e.securityContext){e.data||(O("DifUDLWebLoader: Bad parameters"),e.onFailure()),e.data.physicalid||(O("DifUDLWebLoader: Bad parameters"),e.onFailure()),e.data.dataType||(O("DifUDLWebLoader: Bad parameters"),e.onFailure()),t=e.serverUrl,c=e.securityContext,D=e.contextViewer;var n={objectPhysicalid:e.data.physicalid,serverUrl:t,securityContext:c,onComplete:function(t){if(L.ID=e.data.physicalid,L.Type=e.data.dataType,function(e){var t,n;e.results.forEach(function(e){if(e.attributes){var i={};e.attributes.forEach(function(e){i[e.name]=e.value}),i.did&&I.set(i.did,i)}else if(e.path){var o,a,r;e.path.forEach(function(e){var i=e.toString(),s=I.get(i);if(s){if("DIFSheetInstance"===s["ds6w:type"]&&(!n||n.ID!==s.physicalid)){var u={};u.ID=s.physicalid,n=u,A.push(n)}if(function(e){return"DIFSheet"===e}(s["ds6w:type"])&&(!t||t.ID!==s.physicalid)){var c={views:[]};c.ID=s.physicalid,c.Name=s["bo.PLMEntity.V_Name"],c.Height=parseFloat(s["bo.DIFAbstractSheet.V_DIFFormatHeight"]),c.Width=parseFloat(s["bo.DIFAbstractSheet.V_DIFFormatWidth"]),t=c,v.push(t),n&&(n.sheetID=c.ID)}if(function(e){return"DIFViewInstance"===e}(s["ds6w:type"])){var l={};l.ID=s.physicalid,l.Scale=parseFloat(s["ro.DIFAbstractViewInstance.V_DIFScale"]),l.X=parseFloat(s["ro.DIFAbstractViewInstance.V_DIFPosX"]),l.Y=parseFloat(s["ro.DIFAbstractViewInstance.V_DIFPosY"]),l.Angle=parseFloat(s["ro.DIFAbstractViewInstance.V_DIFAngle"]),o=l,t.views.push(o)}if(function(e){return"DIFView"===e}(s["ds6w:type"])){var f={};f.ID=s.physicalid,f.Scale=parseFloat(s["bo.DIFAbstractView.V_DIFScale"]),f.ScaleStatus=s["bo.DIFAbstractView.V_DIFScaleStatus"],a=f,o.view=a}if(function(e){return"DIFViewStreamInstance"===e||"DIFBackgroundViewRepInstance"===e}(s["ds6w:type"])){var d={};d.ID=s.physicalid,r=d,a?a.viewStreamInstance=d:t.BackgroundViewInstance=d}if(function(e){return"DIFViewStream"===e||"DIFBackgroundViewRep"===e}(s["ds6w:type"])){var D={};D.ID=s.physicalid,r.viewStream=D}}}),o=null,a=null,r=null}})}(t),m=[],v.forEach(function(e){var t=e.ID;S.set(t,e),m.push(t)}),D){var n={max:[-1,-1,-1],min:[1,1,1]},i={resourceid:L.ID,"ds6w:type":L.Type,"ds6w:globaltype":"ds6w:Part",boundingbox:n},o={encoding:"UTF-8",kind:"InstRef",version:"1.1"},a={infos:o,results:[i,{synthesis:{name:"ProgressiveExpand_FlatSynthesis",value:3}},{synthesis:{name:"ProgressiveExpand_OccSynthesis",value:3}},{synthesis:{name:"ProgressiveExpand_LeafSynthesis",value:1}}]},r=[];r.push(i),U(L.Type)&&v.forEach(function(e){var t={resourceid:e.ID,"ds6w:type":"DIFSheet","ds6w:globaltype":"ds6w:Part",boundingbox:n};r.push(t)}),v.forEach(function(e){e.views&&e.views.forEach(function(e){if(e.view){var t={resourceid:e.view.ID,"ds6w:type":"DIFView","ds6w:globaltype":"ds6w:Part",boundingbox:n};r.push(t),C.push(e.view.ID)}})}),U(L.Type)&&A.forEach(function(e){var t={resourceid:e.ID,"ds6w:type":"DIFSheetInstance",from:L.ID,to:e.sheetID};r.push(t)}),v.forEach(function(e){e.views&&e.views.forEach(function(t){if(t.view){var n={resourceid:t.ID,"ds6w:type":"DIFViewInstance",from:e.ID,to:t.view.ID};r.push(n)}})});var s={rootStats:a,infos:o,results:r};D.loadJSON({data:[{rootID:L.ID,validForServerCall:!0,structure:s}]})}var u={sheetIDList:m};m.length>0&&(u.currentSheetID=m[0]),e.onComplete(u)},onFailure:function(){O("DifUDLWebLoader: Failed expandDifComponent"),e.onFailure()}};r.expandDifComponent(n)}else O("DifUDLWebLoader: Bad argurment");else O("DifUDLWebLoader: Bad argurment")}}})}),define("DS/DibUDLWebLoader/TraceUDLWebLoader",[],function(){"use strict";return{consolePrint:function(e){console.log(e)}}}),define("DS/DibUDLWebLoader/DraftingUDLWebLoader",["UWA/Core","UWA/Class","DS/ZipJS/zip-fs","DS/Visualization/Node3D","DS/Visualization/ModelLoader","DS/Visualization/ThreeJS_DS","DS/DibWebUtils/DibQueryToolbox","DS/Visualization/RenderStyle","DS/Visualization/PathElement","DS/Visualization/SceneGraphFactory"],function(e,t,n,i,o,a,r,s,u,c){"use strict";let l=()=>require("DS/PADUtils/PADUtilsServices").getPlatformId(),f=()=>require("DS/PADServices/utils/GlobalUtils").getLang();return t.extend({init:function(){var e,t,d,D,h,p,v=new Map,S=new Map,g=[],I=[],b=0,w=-1,m=0,y=0,F=0,_=new Map,L=new Map,M=new Map,C="toto";M.set("originated","originated_param"),M.set("modified","modified_param"),M.set("current","ds6w:status"),M.set("policy","ds6w:policy"),M.set("project","ds6w:project"),M.set("locker","ds6w:locker"),M.set("responsible","ds6w:responsible"),M.set("name","ds6w:name"),M.set("reserved","ds6w:reserved"),M.set("revision","ds6wg:majorrevision"),M.set("V_Name","bo.PLMEntity.V_Name"),M.set("PLM_ExternalID","bo.PLMEntity.PLM_ExternalID");var A=function(n,o,r,s){let u=[];t[n].Views.forEach(function(e){var t=new i;u.push([e,t])}),_.clear(),O(e,u,function(e,t){var n=e.ViewToSheetMatrix,i=new a.Matrix4;i.setPosition(new a.Vector3(n[4],n[5],0));var s=[n[0],n[2],0,n[1],n[3],0,0,0,1];i.setRotation(s),t.setMatrix(i),o.addChild(t),r()})},V=function(e,t,n){e.ObjectList&&e.ObjectList.forEach(function(e){var n=new a.Matrix4;n.setPosition(new a.Vector3(e.SymbolCompToViewMatrix[4],e.SymbolCompToViewMatrix[5],0));var i=[e.SymbolCompToViewMatrix[0],e.SymbolCompToViewMatrix[2],0,e.SymbolCompToViewMatrix[1],e.SymbolCompToViewMatrix[3],0,0,0,1];n.setRotation(i);var o=_.get(e.ID);o&&(o.setMatrix(n),t.addChild(o))}),n()},T=async function(e,t,n){for(let i of t)await j(e,i[0],i[1]).then(()=>{i[2]?(_.set(i[0].ID,i[2]),i[2].addChild(i[1])):_.set(i[0].ID,i[1]),n()})},P=function(e,t,n){let i=Math.ceil(t.length/10);for(let a=0;a<10;a++){var o=t.slice(i*a,i*(a+1));T(e,o,n)}},x=function(e,t,n){var i=0;e||(console.log("No data to exploit"),n()),e.forEach(function(n){var o,a,r=n.physicalid,s=r;if(n.matches&&(s=n.matches[0].sr_id),r){var u=L.get(s);if(u){var c=u.AttributeName,d=u.ResultString;if(d){var D={};for(let e=0;e<d.length;e++){var h=c[e];n[h]&&(D[h]=[],D[h].push(n[h]))}(o=D,a={},new Promise(function(e){require(["DS/FedDictionaryAccess/FedDictionaryAccessAPI"],function(t){t.getNlsOfPropertiesValues(JSON.stringify(o),{tenantId:l(),lang:f(),onComplete:function(t){e(a=t)},onFailure:function(){e(a)}})})})).then(function(n){if(n&&0!=n.length){var o=0;for(let e=0;e<d.length;e++){var a=c[e],r=d[e],l=D[a];if(l){var f=n[a][l];r!=f&&(u.ResultString[e]=f,u.Modified[e]="TRUE",o=1)}}1===o&&L.set(s,u),++i===e.length&&t()}})}}else i++}else i++}),i===e.length&&t()},N=function(e,t){var n={};e.results.forEach(function(e){if(e.attributes){var t={};e.attributes.forEach(function(e){t[e.name]=e.value}),n=t}}),t(n)},R=function(e,t,n,i,o,a){t.length>0&&e?function(e,t,n,i,o){e||(console.log("Please provide view stream ID"),o()),t||(console.log("Please provide text relation ID"),o()),n||(console.log("Please provide text relation ID"),o());var a=t.length;let s=[];for(;a--;){var u={difViewStreamId:e,textsSRId:t[a],textsAttr:n[a],serverUrl:h,securityContext:p,onComplete:function(e){s.push(e),s.length==t.length&&i(s)},onFailure:function(e){console.log(e+"QueryTextToDisplays: Failed to retrieve query from text SR "),o()}};r.getPointedObjects(u)}}(e,t,i,function(e){o(e)},function(){a()}):n.length>0&&function(e,t,n){e||(console.log("Please provide text relation ID"),n());var i=e.length,o=0;let a=[];for(;i--;){var s=e[i],u=s;if("ContextualLink"===s&&(s=C),void 0!==s){var c=L.get(u);if(c||(c=L.get(s)),c){var l={objectPhysicalid:s,textsAttr:c.AttributeName,serverUrl:h,securityContext:p,onComplete:function(n){N(n,function(e){a.push(e)}),a.length===e.length&&t(a)},onFailure:function(e){console.log(e+"QueryTextToDisplays: Failed to retrieve query with pointed ID"),n()}};r.expandPointedObject(l)}else console.log("QueryTextToDisplayWithPointedIDno tabResult"),n()}else o++,a.length+o==e.length&&t(a)}}(n,function(e){o(e)},function(){a()})},U=function(e,t,n,o,r,s,u,l,f){var d=0;R(n,r,s,u,function(n){x(n,function(){!function(e,t,n){let o=[];t.ObjectList&&t.ObjectList.forEach(function(e){if("AnnWithLink"==e.Type){var t=M.get(e.AttributeName);t||(t=e.AttributeName);var r,s,u=new i;if(e.PLM_ref_ID){var l=e.PLM_ref_ID,f=(d=L.get(l)).AttributeName;for(let e=0;e<f.length;e++)if(t===f[e]){r=d.ResultString[e],s=d.Modified[e];break}}else if(e.Relation_ID){var d;r=(d=L.get(e.Relation_ID)).ResultString[0],s=d.Modified[0]}if("TRUE"===s){var D={text:r,hotspot:{x:0,y:0},font:e.FontName,color:(new a.Color).setRGB(e.Red,e.Green,e.Blue),fontSize:e.FontSize,bold:e.bold},h=c.createTextNode(D);u.addChild(h),_.set(e.ID,u),n()}else o.push([e,u])}}),P(e,o,n)}(e,t,function(){o==++d&&l()})},function e(){console.log("loadViewTexts: exploitTextToDisplay failed"),e()})},function(){console.log("loadViewTexts: manageTextToDisplay failed"),f()})},O=async function(e,t,n){for(let i of t)await j(e,i[0],i[1]).then(()=>{var t=i[0],o=i[1],a=0,r=[],s=[],u=[],c=C;t.ObjectList&&(a=t.ObjectList.length,L.clear(),t.ObjectList.forEach(function(e){if("AnnWithLink"==e.Type){var t=M.get(e.AttributeName);if(t||(t=e.AttributeName),u.push(t),e.PLM_ref_ID){var n=e.PLM_ref_ID,i="FALSE";"ContextualLink"===n&&(i="TRUE");var o=L.get(n);if(o)o&&(o.AttributeName.push(t),o.ResultString.push(e.ResultString),o.Modified.push(i));else s.push(n),(a={AttributeName:[],ResultString:[],Modified:[]}).AttributeName.push(t),a.ResultString.push(e.ResultString),a.Modified.push(i),o=a,L.set(n,o)}else if(e.Relation_ID){var a;r.push(e.Relation_ID),(a={AttributeName:[],ResultString:[],Modified:[]}).AttributeName.push(t),a.ResultString.push(e.ResultString),a.Modified.push("FALSE"),L.set(e.Relation_ID,a)}}})),a>0?U(e,t,c,a,r,s,u,function(){V(t,o,function(){n(t,o)})},function(){n(i[0],i[1])}):n(i[0],i[1])})},j=function(e,t,n){return new Promise(i=>{var r=t.cgr,s=e.find(r),u=new zip.BlobWriter,c=new a.Matrix4;c.setPosition(new a.Vector3(0,0,0));c.setRotation([1,0,0,0,1,0,0,0,1]),n.setMatrix(c);var l=new o;l.setFileType("cgr"),l.set2DAccuracy(y),l.set3DAccuracy(F),1==b&&l.setSceneGraphOrderMode(1),1==w&&l.setLineTypes(D),l.setOnLoadedCallback(function(){i()}),s.getData(u,function(e){var t=new FileReader;t.onload=function(){l.loadModelFromBuffer(this.result,n)},t.readAsArrayBuffer(e)});var f=t.cgr_texts;if(""!==f&&void 0!==f){var d=e.find(f),h=new zip.BlobWriter;d.getData(h,function(e){var t=new FileReader;t.onload=function(){l.loadModelFromBuffer(this.result,n)},t.readAsArrayBuffer(e)})}})};this.getNumberOfSheets=function(){return t.length},this.getSheetName=function(e){return n=v.get(e),t[n].Name;var n},this.getLoadedSheetsId=function(){return g},this.getSheetBackgroundColor=function(e){return n=v.get(e),t[n].IsDetail?(i=d.SheetColorDetail[0],o=d.SheetColorDetail[1],r=d.SheetColorDetail[2]):(i=d.SheetColorView[0],o=d.SheetColorView[1],r=d.SheetColorView[2]),(new a.Color).setRGB(i/255,o/255,r/255);var n,i,o,r},this.loadSheetInViewer=function(e){!function(e,n,o,a){if(null===d)return console.log("No drawing loaded"),void a();if(e<0||e>=t.length)return console.log("Sheet number out of range"),void a();var r=S.get(e);if(r)return n.addNode(r),void o();var c=new i,l=c.createOverrideSetManager(),f=l.createSceneGraphOverrideSet();l.pushSceneGraphOverrideSet(f);var D=f.createOverride(new u([c])),h=new s({combineRenderMode:"IGNORE"});h.setFaceMode("MATERIAL"),D.setRenderStyle(h,!0),n.addNode(c),A(e,c,function(){o()}),S.size>=m&&(S.delete(I[0]),I.splice(0,1)),I.push(e),S.set(e,c),o()}(v.get(e.sheetID),e.viewer,e.onComplete,e.onFailure)},this.getSheet3DNode=function(e){!function(e,n,o,a){if(null===d)return console.log("No drawing loaded"),void a();if(e<0||e>=t.length)return console.log("Sheet number out of range"),void a();var r=S.get(e);if(r)return n(r),void o();var c=0,l=t[e].Views.length,f=new i,D=f.createOverrideSetManager(),h=D.createSceneGraphOverrideSet();D.pushSceneGraphOverrideSet(h);var p=h.createOverride(new u([f])),v=new s({combineRenderMode:"IGNORE"});v.setFaceMode("MATERIAL"),p.setRenderStyle(v,!0),n(f);var g=!1;A(e,f,function(){l!==++c||g||(g=!0,o())}),S.size>=m&&(S.delete(I[0]),I.splice(0,1)),I.push(e),S.set(e,f)}(v.get(e.sheetID),e.onSheetNodeCreated,e.onSheetLoaded,e.onFailure)},this.getSheetSize=function(e){return{height:t[v.get(e)].Height,width:t[v.get(e)].Width}},this.setMaxSheetInCache=function(e){m=e},this.isDetailSheet=function(e){return t[v.get(e)].IsDetail},this.is3DObject=function(){return!1},this.getSheetThumbnail=function(n){return function(n,i,o){if(null===d)return console.log("No drawing loaded"),void o();if(n<0||n>=t.length)return console.log("Sheet number out of range"),void o();if(!t[n].Thumbnail)return console.log("No sheet thumbnail available"),void o();var a=t[n].Thumbnail;if(a){var r=e.find(a);r?r.getBlob("image/PNG",function(e){var t=window.URL.createObjectURL(e);i(t)}):o()}else o()}(v.get(n.sheetID),n.onComplete,n.onFailure)},this.setSheetPickingByView=function(e){var t=S.get(v.get(e.sheetID));null!==t&&t.children.forEach(function(t){t.traverse(function(n){t!=n&&n.setPickParent(e.pickingByView)},{},!1)})},this.set2DAccuracy=function(e){y=e},this.set3DAccuracy=function(e){F=e},this.clearLoader=function(){e&&(e.closeZipReader(),e=null),null,t=null,v=null,S=null,g=null,I=null,null,d=null,b=null,D=null,w=null,m=null,y=null,F=null,h=null,p=null},this.loadModel=function(i){h=i.serverUrl,p=i.securityContext,C=i.objectPhysicalid,(e=new n.fs.FS).importHttpContent(i.UDLObjURL,!1,function(){var n=e.find("DrwStructure.json");null!==n?n.getText(function(n){var o=JSON.parse(n.target.result);b=o.DrawOrderMode,d=o.Drawing,function(t,n){if(-1==w){var i=d.LineTypeFile;if(i){var o=e.find(i);o?o.getText(function(e){D=JSON.parse(e.target.result),w=1,t()}):(w=0,t())}else w=0,t()}}(function(){t=d.Sheets,g=[],v.clear(),S.clear(),function(){var e=[],n=[],i=0;return t.forEach(function(t){t.IsDetail?n.push(i):e.push(i),i++}),n.forEach(function(t){e.push(t)}),e}().forEach(function(e){var n=t[e].ID;v.set(n,e),g.push(n)});var e={currentSheetID:t[d.CurrentSheetIndex-1].ID,sheetIDList:g};i.onComplete(e)})}):i.onFailure()},function(){console.log("UDL - ZIP open fails"),i.onFailure()})}}})}),define("DS/DibUDLWebLoader/LinkUDLWebLoader",["DS/Visualization/Node3D","DS/DibUDLWebLoader/TraceUDLWebLoader"],function(e,t){"use strict";return{create_Link_FromJson:function(e){return function(e){var t="create_Link_FromJson_Internal",n=e.iJson;n||e.onFailure(t+" no iJson"),e.iomap_ID_Node||e.onFailure(t+" no iomap_ID_Node"),e.iomap_ID_Obj||e.onFailure(t+" no iomap_ID_Obj");var i=e.iObj_Father;i||e.onFailure(t+" no iObj_Father");var o=n.Type;"Link"!==o&&e.onFailure(t+"object not of good type");var a;(a={}).type=o,i.links||(i.links=[]);i.links.push(a),a.father=i,n.Link_ID&&(a.Link_ID=n.Link_ID),n.RepInst_ID&&(a.repInst_ID=n.RepInst_ID),n.POFI_ID&&(a.pofi=[],n.POFI_ID.forEach(function(e){a.pofi.push(e)}));n.Target&&(a.target={},n.Target.CGM_ID&&(a.target.cgmid=n.Target.CGM_ID),n.Target.Target_ID&&(a.target.targetid=n.Target.Target_ID),n.Target.Diezele&&(a.target.diezele=n.Target.Diezele));e.onSuccess()}(e)}}}),define("DS/DibUDLWebLoader/MBDViewUDLWebLoader",["DS/Visualization/Node3D","DS/DibUDLWebLoader/DifSupplementalGeometryUDLWebLoader"],function(e,t){"use strict";var n=function(n){var i="get_MBDViewRef_ObjectInternal",o=n.iRef;o||n.onFailure(i+" no iRef");var a=n.ioMap_ID_Node;a||n.onFailure(i+" no ioMap_ID_Node");var r=n.ioMap_ID_Obj;r||n.onFailure(i+" no ioMap_ID_Obj");var s=r.get(o.iD);s&&n.onSuccess(s);o.viewStreamInstance.viewStream;var u=a.get(o.iD);if(!u){var c=new e;u=c,a.set(o.iD,u)}(s={}).ID=o.iD,s.Name=o.Name,s.Type="MBDView",s.Childs=[];var l={};l.node3D=u,s.visuinfo=l,o.tpsTexts&&o.tpsTexts.forEach(function(t){var n=a.get(t.iD);if(n){var i=a.get(t.plane);if(!i){i=new e;var o=t.plane;a.set(o,i),a.set(o+"A",i),u.addChild(i)}i.addChild(n)}});var f={iFather:o,iObj_Father:s,ioMap_ID_Node:a,ioMap_ID_Obj:r,onSuccess:function(){console.log("Manage_SupGeo_Object Ok")},onFailure:function(e){console.log(e),n.onFailure(i)}};t.Manage_SupGeo_Object(f),r.set(s.ID,s),n.onSuccess(s)},i=function(t){var i="get_MBDViewInstance_ObjectInternal",o=t.iInstance;o||t.onFailure(i+" no iInstance");var a=t.ioMap_ID_Node;a||t.onFailure(i+" no ioMap_ID_Node");var r=t.ioMap_ID_Obj;r||t.onFailure(i+" no ioMap_ID_Obj");var s=r.get(o.iD);s&&t.onSuccess(s);var u=a.get(o.iD);u||(u=new e,a.set(o.iD,u));(s={}).ID=o.iD,s.Name=o.Name,s.Type="MBDViewInstance",s.Childs=[];var c={};c.node3D=u,s.visuinfo=c;var l={iRef:o.view,ioMap_ID_Node:a,ioMap_ID_Obj:r,onSuccess:function(e){s.Name||(s.Name=e.Name),s.Childs.push(e),s.visuinfo.node3D?s.visuinfo.node3D.addChild(e.visuinfo.node3D):t.onFailure(i+" no node3D")},onFailure:function(e){console.log(e),t.onFailure(i)}};n(l),r.set(s.ID,s),t.onSuccess(s)};return{get_MBDViewRef_Object:function(e){return n(e)},get_MBDViewInstance_Object:function(e){return i(e)},Manage_MBDView_Object:function(e){return function(e){var t="Manage_MBDView_ObjectInternal",n=e.iFather;n||e.onFailure(t+" no iFather");var o=e.ioMap_ID_Node;o||e.onFailure(t+" no ioMap_ID_Node");var a=e.ioMap_ID_Obj;a||e.onFailure(t+" no ioMap_ID_Obj");var r=e.iObj_Father;r||e.onFailure(t+" no iObj_Father"),n.MBDViews&&n.MBDViews.forEach(function(n){i({iInstance:n,ioMap_ID_Node:o,ioMap_ID_Obj:a,onSuccess:function(n){r.Childs.push(n),r.visuinfo.node3D?r.visuinfo.node3D.addChild(n.visuinfo.node3D):e.onFailure(t+" no node3D")},onFailure:function(n){console.log(n),e.onFailure(t)}})}),e.onSuccess()}(e)}}}),define("DS/DibUDLWebLoader/Filter2DLUDLWebLoader",["DS/Visualization/Node3D","DS/DibUDLWebLoader/LinkUDLWebLoader","DS/DibUDLWebLoader/TraceUDLWebLoader"],function(e,t,n){"use strict";return{create_Filter2DL_FromJson:function(e){return function(e){var i="create_Filter2DL_FromJson_Internal",o=e.iJson;o||e.onFailure(i+" no iJson");var a=e.iomap_ID_Node;a||e.onFailure(i+" no iomap_ID_Node");var r=e.iomap_ID_Obj;r||e.onFailure(i+" no iomap_ID_Obj");var s=e.iObj_Father;s||e.onFailure(i+" no iObj_Father");var u=o.Type;"Filter2DL"!==u&&e.onFailure(i+"object not of good type");var c=o.PLM_ID,l=r.get(c);l&&e.onFailure(i+"object already created "+c);var f;(l={}).iD=c,l.type=u,r.set(c,l),n.consolePrint(i+"created "+c),s.filter2DLs||(s.filter2DLs=[]);s.filter2DLs.push(l),l.father=s,l.filterMode=o.FilterMode,o.LINKS?f=o.LINKS:o.Links&&(f=o.Links);var d=o.FilterInfos;d&&(l.infos=[],d.forEach(function(e){var t={};t.activateModeColor=e.ActivateModeColor,t.red=e.Red,t.green=e.Green,t.blue=e.Blue,t.visible=e.Visible,t.pick=e.Pick,t.normalintensity=e.Normal_Intensity,t.activateModeTransparency=e.ActivateModeTransparency,t.transparency=e.Transparency,l.infos.push(t)})),f&&f.forEach(function(o){var s={iJson:o,iObj_Father:l,iomap_ID_Node:a,iomap_ID_Obj:r,onSuccess:function(){n.consolePrint(i+" Ok")},onFailure:function(t){n.consolePrint(t),e.onFailure()}};t.create_Link_FromJson(s)}),e.onSuccess()}(e)}}}),define("DS/DibUDLWebLoader/DifCaptureUDLWebLoader",["DS/Visualization/Node3D","DS/Visualization/ThreeJS_DS","DS/Visualization/SceneGraphUtils","DS/Visualization/PathElement","DS/DibUDLWebLoader/DifSupplementalGeometryUDLWebLoader","DS/DibUDLWebLoader/TraceUDLWebLoader"],function(e,t,n,i,o,a){"use strict";var r=function(n){var i="get_CaptureRef_ObjectInternal",r=n.iRef;r||n.onFailure(i+" no iRef");var s=n.ioMap_ID_Node;s||n.onFailure(i+" no ioMap_ID_Node");var u=n.ioMap_ID_Obj;u||n.onFailure(i+" no ioMap_ID_Obj");var c=u.get(r.iD);c&&n.onSuccess(c);var l=r.viewStreamInstance.viewStream,f=s.get(r.iD);if(!f){var d=new e;f=d,s.set(r.iD,f)}var D=s.get(l.iD);D&&f.addChild(D);(c={}).ID=r.iD,c.Name=r.Name,c.Type="Capture",c.Childs=[];var h={};h.node3D=f,c.visuinfo=h;var p=r.Matrix,v=new t.Vector3(p[3],p[4],p[5]),S=new t.Vector3(p[6],p[7],p[8]),g=new t.Vector3(p[9],p[10],p[11]);h.plane=new t.Plane,h.plane.setFromNormalAndCoplanarPoint(S,g),h.up=v,r.presentedAnnotations?r.presentedAnnotations.forEach(function(e){var t={};(t=e.PlaneID?s.get(e.PlaneID):s.get(e.iD))&&f.addChild(t)}):r.MBDViews&&r.MBDViews.forEach(function(e){var t=s.get(e.view.viewStreamInstance.viewStream.iD);t&&f.addChild(t)});var I={iFather:r,iObj_Father:c,ioMap_ID_Node:s,ioMap_ID_Obj:u,onSuccess:function(){a.consolePrint("Manage_SupGeo_Object Ok")},onFailure:function(e){a.consolePrint(e),n.onFailure(i)}};o.Manage_SupGeo_Object(I),u.set(c.ID,c),n.onSuccess(c)},s=function(t){var n="get_CaptureInstance_ObjectInternal",i=t.iInstance;i||t.onFailure(n+" no iInstance");var o=t.ioMap_ID_Node;o||t.onFailure(n+" no ioMap_ID_Node");var s=t.ioMap_ID_Obj;s||t.onFailure(n+" no ioMap_ID_Obj");var u=s.get(i.iD);u&&t.onSuccess(u);var c=o.get(i.iD);c||(c=new e,o.set(i.iD,c));(u={}).ID=i.iD,u.Name=i.Name,u.Type="CaptureInstance",u.Childs=[];var l={};l.node3D=c,u.visuinfo=l;var f={iRef:i.capture,ioMap_ID_Node:o,ioMap_ID_Obj:s,onSuccess:function(e){u.Name||(u.Name=e.Name),u.Childs.push(e),u.visuinfo.node3D?u.visuinfo.node3D.addChild(e.visuinfo.node3D):t.onFailure(n+" no node3D")},onFailure:function(e){a.consolePrint(e),t.onFailure(n)}};r(f),s.set(u.ID,u),t.onSuccess(u)};return{get_CaptureRef_Object:function(e){return r(e)},get_CaptureInstance_Object:function(e){return s(e)},Manage_Capture_Object:function(e){return function(e){var t="Manage_Capture_ObjectInternal",n=e.iFather;n||e.onFailure(t+" no iFather");var i=e.ioMap_ID_Node;i||e.onFailure(t+" no ioMap_ID_Node");var o=e.ioMap_ID_Obj;o||e.onFailure(t+" no ioMap_ID_Obj");var r=e.iObj_Father;r||e.onFailure(t+" no iObj_Father"),n.Captures&&n.Captures.forEach(function(n){s({iInstance:n,ioMap_ID_Node:i,ioMap_ID_Obj:o,onSuccess:function(n){r.Childs.push(n),r.visuinfo.node3D?r.visuinfo.node3D.addChild(n.visuinfo.node3D):e.onFailure(t+" no node3D")},onFailure:function(n){a.consolePrint(n),e.onFailure(t)}})}),e.onSuccess()}(e)}}}),define("DS/DibUDLWebLoader/DifAnnotationSetUDLWebLoader",["UWA/Core","UWA/Class","DS/ZipJS/zip-fs","DS/Visualization/Node3D","DS/Visualization/ModelLoader","DS/Visualization/ThreeJS_DS","DS/DibWebUtils/DibQueryToolbox","DS/DibUDLWebLoader/DifCaptureUDLWebLoader","DS/DibUDLWebLoader/MBDViewUDLWebLoader","DS/DibUDLWebLoader/Filter2DLUDLWebLoader","DS/DibUDLWebLoader/TraceUDLWebLoader","DS/DibUDLWebLoader/CGR_UDLWebLoader"],function(e,t,n,i,o,a,r,s,u,c,l,f){"use strict";return t.extend({init:function(){var t,d,D,h,p,v,S=[],g=new Map,I=new Map,b=new Map,w=new Map,m=new Map,y=new Map,F=[],_=0,L=0,M=0,C=[],A=[],V=0,T=function(t,n,r){t.results||r();var s=t.results.length,u=0,c=!1;t.results.forEach(function(t){if(e.is(t.attributes,"array")){var r,l=!1;if(t.attributes.forEach(function(e){if("resourceid"===e.name&&(r=e.value),"cgr"===e.name){c=!0,l=!0;var t={Type:"SG"};t.iD=r;var f=new i;t.Node=f,function(e,t,n){var i=new a.Matrix4;i.setPosition(new a.Vector3(0,0,0));i.setRotation([1,0,0,0,1,0,0,0,1]),t.setMatrix(i);var r=new o;r.setFileType("cgr"),r.set2DAccuracy(_),r.set3DAccuracy(L),1===M&&r.setSceneGraphOrderMode(1),r.setOnLoadedCallback(function(){n(t)});var s={provider:"FILE",filename:e,serverurl:"",proxyurl:"none",requiredAuth:null};r.loadModel(s,t)}(e.value,f,function(e){b.set(t.iD,f),++u===s&&n()})}}),!l){var f={Type:"SG"};f.iD=r;var d=new i;f.Node=d,b.set(f.iD,d)}}}),c||(n(),r())},P=function(e,n,i){e||i();var o=g.get(e);o||i();var a=[];o.SupGeos.forEach(function(e){if(e.SupGeoRef&&e.SupGeoRef.Dif3DShapeInst.Dif3DShapeRepRef){var t=e.SupGeoRef.Dif3DShapeInst.Dif3DShapeRepRef.iD;a.includes(t)||0!==e.SupGeoRef.Dif3DShapeInst.Dif3DShapeRepRef.other||a.push(t)}}),o.MBDViews.forEach(function(e){e.view.SupGeos.forEach(function(e){if(e.SupGeoRef&&e.SupGeoRef.Dif3DShapeInst.Dif3DShapeRepRef){var t=e.SupGeoRef.Dif3DShapeInst.Dif3DShapeRepRef.iD;a.includes(t)||0!==e.SupGeoRef.Dif3DShapeInst.Dif3DShapeRepRef.other||a.push(t)}})}),o.Captures.forEach(function(e){e.capture.SupGeos.forEach(function(e){if(e.SupGeoRef&&e.SupGeoRef.Dif3DShapeInst.Dif3DShapeRepRef){var t=e.SupGeoRef.Dif3DShapeInst.Dif3DShapeRepRef.iD;a.includes(t)||0!==e.SupGeoRef.Dif3DShapeInst.Dif3DShapeRepRef.other||a.push(t)}})}),a.length>0?function(e,n,i){var o={objectPhysicalid:e,serverUrl:t,securityContext:d,onComplete:n,onFailure:i};r.getSupplementalGeometryData(o)}(a,function(e){T(e,function(){n()},function(){i()})},function(){i()}):n()},x=function(e,t,n){e||n();var i=w.get(e);(i||n(),i.viewStream)&&function(e,t,n){e||n();var i=w.get(e);if(i||n(),0===i.udl){var o=i.iD;t.includes(o)||t.push(o)}}(i.viewStream.iD,t,n)},N=function(e,t,n){e||n();var i=w.get(e);(i||n(),i.view)&&function(e,t,n){e||n();var i=w.get(e);if(i||n(),i.viewStreamInstance){var o=i.viewStreamInstance.iD;x(o,t,n)}}(i.view.iD,t,n)},R=function(e,t,n){e||n();var i=w.get(e);(i||n(),i.capture)&&function(e,t,n){e||n();var i=w.get(e);if(i||n(),i.viewStreamInstance){var o=i.viewStreamInstance.iD;x(o,t,n)}}(i.capture.iD,t,n)},U=function(e,t,n){e||n(),g.get(e)||n();var i=[];!function(e,t,n){e||n();var i=w.get(e);i||n(),i.MBDViews&&i.MBDViews.forEach(function(e){var i=e.iD;N(i,t,n)}),i.Captures&&i.Captures.forEach(function(e){var i=e.iD;R(i,t,n)})}(e,i,n),t(i)},O=function(i,o,a){i||a(),U(i,function(i){!function(e,n,i){var o={objectPhysicalid:e,serverUrl:t,securityContext:d,onComplete:n,onFailure:i};r.getUDLData(o)}(i,function(t){!function(t,i,o){t.results||o();var a=t.results.length,r=0,s=!1;t.results.forEach(function(t){var u;e.is(t.attributes,"array")&&(t.attributes.forEach(function(e){if("resourceid"===e.name&&(u=e.value),"udl"===e.name){s=!0;var t=new n.fs.FS,c={provider:"FILE",filename:e.value,serverurl:"",proxyurl:"none",requiredAuth:null};t.importHttpContent(c,!1,function(){var e=t.find("DrwStructure.json");null!==e?e.getText(function(e){var n=JSON.parse(e.target.result);M=n.DrawOrderMode;var o=w.get(u);if(o){o.udl=1;var s=o.father.father;s.flagjson=1,s.udljson=n.View,s.udlzip=t}a===++r&&i()}):o()},function(){o()})}}),s||o())})}(t,function(){o()},function(){a()})},function(){a()})},function(){a()})},j=function(e,t,n){e||n();var i=w.get(e);(i||n(),i.view)&&function(e,t,n){e||n();var i=w.get(e);if(i||n(),1===i.flagjson){var o=i.iD;t.includes(o)||t.push(o)}}(i.view.iD,t,n)},E=function(e,t,n){e||n();var i=w.get(e);(i||n(),i.capture)&&function(e,t,n){e||n();var i=w.get(e);if(i||n(),1===i.flagjson){var o=i.iD;t.includes(o)||t.push(o)}}(i.capture.iD,t,n)},W=function(e,t,n){e||n(),g.get(e)||n();var i=[];!function(e,t,n){e||n();var i=w.get(e);i||n(),i.MBDViews&&i.MBDViews.forEach(function(e){var i=e.iD;j(i,t,n)}),i.Captures&&i.Captures.forEach(function(e){var i=e.iD;E(i,t,n)})}(e,i,n),t(i)},B=function(e,t,n,i){if(e||i(),t||i(),n||i(),e.cgr){var o={flagcgr:0};o.udlzip=n,t.infocgr=o,t.infocgr.cgr=e.cgr,e.cgr_texts&&(t.infocgr.cgr_texts=e.cgr_texts),e.cgr_textsGP&&(t.infocgr.cgr_textsGP=e.cgr_textsGP)}},G=function(e,t,n){var i=" createObjectFromJson : ";t||n();var o=e.Type;if("SupportPlane"===o)!function(e,t,n){t||n();var i=e.Type;"SupportPlane"!==i&&n();var o=e.PLM_ID,a=w.get(o);a&&n();(a={}).iD=o,a.type=i,w.set(o,a),t.supportPlanes||(t.supportPlanes=[]);t.supportPlanes.push(a),e.Plane&&(a.plane=e.Plane)}(e,t,n);else if("TPSTest"===o||"TPS"===o)!function(e,t,n){t||n();var i=e.Type;"TPSTest"!==i&&"TPS"!==i&&n();var o=e.ID,a=w.get(o);a&&n();(a={}).iD=o,a.type=i,a.father=t,w.set(o,a),t.tpsTexts||(t.tpsTexts=[]);t.tpsTexts.push(a),e.Plane&&(a.plane=e.Plane),B(e,a,t.udlzip,n)}(e,t,n);else if("PresentedAnnotations"===o)!function(e,t,n){t||n();var i,o=e.Type;"PresentedAnnotations"!==o&&n(),i=e.Plane?e.PLM_ID:e.PLM_ID+"A";var a=w.get(i);a&&n();(a={}).iD=i,a.type=o,w.set(i,a),t.presentedAnnotations||(t.presentedAnnotations=[]);t.presentedAnnotations.push(a),e.Plane?a.PlaneID=e.Plane:a.PlaneID=e.ID}(e,t,n);else if("Filter2DL"===o){var a={iJson:e,iObj_Father:t,iomap_ID_Node:b,iomap_ID_Obj:w,onSuccess:function(){l.consolePrint(i+" 2DLFilters Ok")},onFailure:function(e){l.consolePrint(e),n()}};c.create_Filter2DL_FromJson(a)}},k=function(e,t,n){e.forEach(function(e){!function(e,t,n){var i=w.get(e);if(i||n(),1===i.flagjson){var o=i.udljson;o.ObjectList&&o.ObjectList.forEach(function(e){G(e,i,n)}),i.flagjson=2,i.viewStreamInstance&&i.viewStreamInstance.viewStream&&B(o,i.viewStreamInstance.viewStream,i.udlzip,n)}t()}(e,function(){0},function(){0,n()})}),t()},z=function(e,t,n){e||n();var i=w.get(e);if(i||n(),i.viewStreamInstance||n(),i.viewStreamInstance.viewStream||n(),i.viewStreamInstance.viewStream.infocgr&&i.viewStreamInstance.viewStream.infocgr.flagcgr&&0===i.viewStreamInstance.viewStream.infocgr.flagcgr){var o=i.viewStreamInstance.viewStream.iD;t.includes(o)||t.push(o)}i.tpsTexts&&i.tpsTexts.forEach(function(e){!function(e,t,n){e||n();var i=w.get(e);if(i||n(),0===i.infocgr.flagcgr){var o=i.iD;t.includes(o)||t.push(o)}}(e.iD,t,n)})},J=function(e,t,n){e||n();var i=w.get(e);(i||n(),i.capture)&&function(e,t,n){e||n();var i=w.get(e);if(i||n(),i.viewStreamInstance||n(),i.viewStreamInstance.viewStream||n(),i.viewStreamInstance.viewStream.infocgr&&i.viewStreamInstance.viewStream.infocgr.flagcgr&&0===i.viewStreamInstance.viewStream.infocgr.flagcgr){var o=i.viewStreamInstance.viewStream.iD;t.includes(o)||t.push(o)}}(i.capture.iD,t,n)},q=function(e,t,n){e||n();var i=w.get(e);i||n(),i.MBDViews&&i.MBDViews.forEach(function(e){!function(e,t,n){e||n();var i=w.get(e);if(i||n(),i.view){var o=i.view.iD;z(o,t,n)}}(e.iD,t,n)}),i.Captures&&i.Captures.forEach(function(e){var i=e.iD;J(i,t,n)})},H=function(e,t){return new Promise(n=>{e||t(),0!==e.flagcgr&&t();var o=new i;e.cgrNode=o;var a={zipUDL:e.udlzip,cgrName:e.cgr,cgrNameText:e.cgr_texts,CGRNode:o,Accuracy2D:_,Accuracy3D:L,DrawOrderMode:M,onSuccess:n,onFailure:t};f.loadCGRs(a)})},Q=async function(e,t,n){for(let i of e)await H(i.infocgr,n).then(()=>{var e=i.iD,n=i.infocgr.cgrNode;b.set(e,n),i.infocgr.flagcgr=1,t()})},X=function(e,t,n){e||n();var i=e.length,o=0;0===i&&t();var a=[];e.forEach(function(e){var t=w.get(e);t||n(),a.push(t)}),function(e,t,n){let i=Math.ceil(e.length/10);for(let a=0;a<10;a++){var o=e.slice(i*a,i*(a+1));Q(o,t,n)}}(a,function(){++o===i&&t()},function(){n()})},Y=function(e,t,n){e||n(),w.get(e)||n(),function(e,t,n){e||n(),w.get(e)||n();var i=[];q(e,i,n),t(i)}(e,function(e){X(e,function(){t()},function(){n()})},function(){n()})},Z=function(e,n,i){e||i();var o=g.get(e);o||i();var a=[];o.Captures.forEach(function(e){var t=e.capture;t&&t.filter2DLs&&t.filter2DLs.forEach(function(e){e&&e.links&&e.links.forEach(function(e){if(e.Link_ID){var n={};n.father=t,n.fatherID=t.viewStreamInstance.viewStream.iD,n.sR_ID=e.Link_ID,n.link=e,a.push(n)}})})});var s=a.length,u=0;s>0?a.forEach(function(e){!function(e,n,i){e||i();var o=e.father;o||i();var a=e.fatherID;a||i();var s=e.sR_ID;s||i();var u=o.resolvefilter2DLs;u||(o.resolvefilter2DLs=[],u=o.resolvefilter2DLs);var c={fatherID:a,role:"271",sR_ID:s,serverUrl:t,securityContext:d,onComplete:function(t){var i={};i.path=t,i.info=e.link,u.push(i),n()},onFailure:function(){i()}};r.getPointedObjectsFromLink(c)}(e,function(){++u===s&&n()},function(){i()})}):n()},K=function(e,t,n,o){e||o();var a=I.get(e);if(a)return t(a),void n();var r=g.get(e);r||o(),t(D=new i),I.size>=V&&I.delete(e),I.set(e,D),O(e,function(){!function(e,t,n){e||n(),W(e,function(e){k(e,function(){t()},function(){n()})},function(){n()})}(e,function(){Y(e,function(){P(e,function(){Z(e,function(){!function(e,t,n,i){var o=new Map,a={};a.iD=e.iD,a.Name=e.Name,a.Type="AnnotationSet",a.Childs=[];var r={};r.node3D=t,a.visuinfo=r;var c={iFather:e,iObj_Father:a,ioMap_ID_Node:b,ioMap_ID_Obj:o,onSuccess:function(){},onFailure:function(e){i()}};u.Manage_MBDView_Object(c);var l={iFather:e,iObj_Father:a,ioMap_ID_Node:b,ioMap_ID_Obj:o,onSuccess:function(){},onFailure:function(e){i()}};s.Manage_Capture_Object(l),a.Childs.forEach(function(e){"CaptureInstance"===e.Type?A.push(e):"MBDViewInstance"===e.Type&&C.push(e)}),n()}(r,D,n,o)},function(){o()})},function(){o()})},function(){o()})},function(){o()})},function(){o()})};this.getNumberOfSheets=function(){return S.length},this.getSheetName=function(e){return function(e){return g.get(e).Name}(e)},this.getLoadedSheetsId=function(){return F},this.getSheetBackgroundColor=function(e){return(new a.Color).setRGB(1,1,1)},this.getSheet3DNode=function(e){K(e.sheetID,e.onSheetNodeCreated,e.onSheetLoaded,e.onFailure)},this.getSheetSize=function(e){return{height:100,width:100}},this.setMaxSheetInCache=function(e){V=e},this.isDetailSheet=function(e){return!1},this.is3DObject=function(){return!0},this.getSheetThumbnail=function(e){e.onFailure()},this.setSheetPickingByView=function(e){var t=I.get(e.sheetID);null!==t&&t.children.forEach(function(t){t.traverse(function(n){t!=n&&n.setPickParent(e.pickingByView)},{},!1)})},this.set2DAccuracy=function(e){_=e},this.set3DAccuracy=function(e){L=e},this.loadModel=function(e){if(e||e.onFailure(),e.serverUrl&&e.securityContext){e.data||e.onFailure(),e.data.physicalid||e.onFailure(),e.data.dataType||e.onFailure(),t=e.serverUrl,d=e.securityContext;var n={objectPhysicalid:e.data.physicalid,serverUrl:t,securityContext:d,onComplete:function(t){!function(e){var t,n=new Map,i=new Map;e.results.forEach(function(e){var o=e.attributes;if(o){var a={};o.forEach(function(e){var t=e.name,n=e.value;"bo.DIFAbstractView.V_DIF3DMatrix"===t?(a[t]||(a[t]=[]),a[t].push(n)):a[t]=n}),a.did&&i.set(a.did,a)}else if(e.path){var r,s,u,c,l,f,d,D,g;e.path.forEach(function(e){var o=e.toString(),a=i.get(o);if(a){var I=a["ds6w:type"],b=n.get(o);if("DIFAnnotationSet"===I){if(!b){var F={MBDViews:[],Captures:[],SupGeos:[]};F.Name=a["bo.PLMEntity.V_Name"],(b=F).iD=a.physicalid,b.sID=o,b.type=I,n.set(o,b),w.set(b.iD,b),S.push(b)}t=b}if(function(e){return"DIFCaptureInstance"===e}(I)){if(!b){var _={};_.Scale=parseFloat(a["ro.DIFAbstractViewInstance.V_DIFScale"]),_.X=parseFloat(a["ro.DIFAbstractViewInstance.V_DIFPosX"]),_.Y=parseFloat(a["ro.DIFAbstractViewInstance.V_DIFPosY"]),_.Angle=parseFloat(a["ro.DIFAbstractViewInstance.V_DIFAngle"]),(b=_).iD=a.physicalid,b.sID=o,b.type=I,n.set(o,b),w.set(b.iD,b)}c=b,y.get(o)||(t.Captures.push(b),y.set(o,b))}if(function(e){return"DIFCapture"===e}(I)){if(!b){var L={MBDViews:[],SupGeos:[]};L.Name=a["bo.PLMEntity.V_Name"],L.Scale=parseFloat(a["bo.DIFAbstractView.V_DIFScale"]),L.ScaleStatus=a["bo.DIFAbstractView.V_DIFScaleStatus"],L.viewtype=a["bo.DIFCapture.V_ViewType"];var M=a["bo.DIFAbstractView.V_DIF3DMatrix"],C=[];12===M.length&&M.forEach(function(e){C.push(parseFloat(e))}),L.Matrix=C,(b=L).iD=a.physicalid,b.sID=o,b.type=I,b.flagjson=0,n.set(o,b),w.set(b.iD,b)}l=b,c.capture=l}if(function(e){return"MBDViewInstance"===e}(I)){if(!b){var A={};A.Scale=parseFloat(a["ro.DIFAbstractViewInstance.V_DIFScale"]),A.X=parseFloat(a["ro.DIFAbstractViewInstance.V_DIFPosX"]),A.Y=parseFloat(a["ro.DIFAbstractViewInstance.V_DIFPosY"]),A.Angle=parseFloat(a["ro.DIFAbstractViewInstance.V_DIFAngle"]),(b=A).iD=a.physicalid,b.sID=o,b.type=I,n.set(o,b),w.set(b.iD,b)}r=b,l?l.MBDViews.push(b):m.get(o)||(t.MBDViews.push(b),m.set(o,b))}if(function(e){return"MBDView"===e}(I)){if(!b){var V={SupGeos:[]};V.Name=a["bo.PLMEntity.V_Name"],V.Scale=parseFloat(a["bo.DIFAbstractView.V_DIFScale"]),V.ScaleStatus=a["bo.DIFAbstractView.V_DIFScaleStatus"],(b=V).iD=a.physicalid,b.sID=o,b.type=I,b.flagjson=0,n.set(o,b),w.set(b.iD,b)}s=b,r.view=s}if(function(e){return"DIFViewStreamInstance"===e}(I)&&(b||((b={}).iD=a.physicalid,b.sID=o,b.type=I,n.set(o,b),w.set(b.iD,b)),u=b,s?(b.father=s,s.viewStreamInstance=b):l&&(b.father=l,l.viewStreamInstance=b)),function(e){return"DIFViewStream"===e}(I)&&(b||((b={}).iD=a.physicalid,b.sID=o,b.type=I,b.udl=0,n.set(o,b),w.set(b.iD,b)),b.father=u,u.viewStream=b),function(e){return"DIFSupplementalGeometryInstance"===e}(I)&&(b||((b={}).iD=a.physicalid,b.sID=o,b.type=I,n.set(o,b),w.set(b.iD,b)),f=b,l?l.SupGeos.push(b):s?s.SupGeos.push(b):t.SupGeos.push(b)),function(e){return"DIFSupplementalGeometry"===e}(I)){if(!b){var T={};T.Name=a["bo.PLMEntity.V_Name"],(b=T).iD=a.physicalid,b.sID=o,b.type=I,n.set(o,b),w.set(b.iD,b)}d=b,f&&(f.SupGeoRef=d)}if(function(e){return"DIF3DShapeInstance"===e}(I)&&(b||((b={}).iD=a.physicalid,b.sID=o,b.type=I,n.set(o,b),w.set(b.iD,b)),D=b,d&&(b.father=d,d.Dif3DShapeInst=D)),function(e){return"DIF3DShape"===e}(I)&&(b||((b={}).iD=a.physicalid,b.sID=o,b.type=I,b.other=0,n.set(o,b),w.set(b.iD,b)),g=b,D&&(b.father=D,D.Dif3DShapeRepRef=g)),function(e){return"DIFStandardRep"===e}(I)&&(h||(h={}),h.iD=a.physicalid,p&&(p.Ref=h)),function(e){return"DIFStandardRepInstance"===e}(I)&&(p||(p={}),p.iD=a.physicalid),function(e){return"DIFAnnotatedProduct"===e}(I)){var P={};P.iD=a.physicalid,v=P}}}),r=null,s=null,c=null,l=null,u=null,f=null,d=null,D=null,g=null}})}(t),F=[],S.forEach(function(e){var t=e.iD;g.set(t,e),F.push(t)});var n={sheetIDList:F};F.length>0&&(n.currentSheetID=F[0]),e.onComplete(n)},onFailure:function(){e.onFailure()}};r.expandDifComponent(n)}},this.getAnnotationSetMBDCaptures=function(e){var t;t=A,e.onSuccess(t)},this.getAnnotationSetMBDViews=function(e){var t;t=C,e.onSuccess(t)},this.getAnnotationSet3DNode=function(e){D?e.onSuccess(D):e.onFailure()},this.clearLoader=function(){S&&(S=null),g&&(g=null),I&&(I=null),w&&(w=null),m&&(m=null),y&&(y=null),F&&(F=null),t&&(t=null),d&&(d=null),_&&(_=null),M&&(M=null),L&&(L=null),C&&(C=null),A&&(A=null),D&&(D=null),h&&(h=null),p&&(p=null),v&&(v=null),V&&(V=null)}}})}),define("DS/DibUDLWebLoader/CATDibUDLWebLoader",["UWA/Core","UWA/Class","DS/DibUDLWebLoader/DraftingUDLWebLoader","DS/DibUDLWebLoader/DifUDLWebLoader","DS/DibUDLWebLoader/DifAnnotationSetUDLWebLoader","DS/DibWebUtils/DibQueryToolbox"],function(e,t,n,i,o,a){"use strict";return t.extend({init:function(){var e,t=1,r=0,s=0;this.loadDrawingModel=function(t){e&&(e.clearLoader(),e=null),(e=new n).set2DAccuracy(r),e.set3DAccuracy(s);var i={objectPhysicalid:[t.data.physicalid],serverUrl:t.serverUrl,securityContext:t.securityContext,onComplete:function(n){var i;n.results[0].attributes.forEach(function(e){"udl"===e.name&&(i=e.value)});var o={UDLObjURL:{provider:"FILE",filename:i,serverurl:"",proxyurl:"none",requiredAuth:null},serverUrl:t.serverUrl,securityContext:t.securityContext,objectPhysicalid:t.data.physicalid,onComplete:t.onComplete,onFailure:t.onFailure};e.loadModel(o)},onFailure:function(){console.log("CATDibUDLWebLoader: Failed to fetch UDL"),t.onFailure()}};a.getUDLData(i)},this.loadDifSheetModel=function(t){e&&(e.clearLoader(),e=null),(e=new i).set2DAccuracy(r),e.set3DAccuracy(s);var n={data:t.data,serverUrl:t.serverUrl,contextViewer:t.contextViewer,securityContext:t.securityContext,onComplete:t.onComplete,onFailure:t.onFailure};e.loadModel(n)},this.loadDifAnnotationSetModel=function(t){e&&(e.clearLoader(),e=null),(e=new o).set2DAccuracy(r),e.set3DAccuracy(s);var n={data:t.data,serverUrl:t.serverUrl,securityContext:t.securityContext,onComplete:function(n){var i={sheetID:n.currentSheetID,onSheetNodeCreated:function(e){e||(console.log("Fail onSheetNodeCreated"),t.onFailure())},onSheetLoaded:function(){t.onComplete(n)},onFailure:function(){console.log("Failed getting All AnnotationSet nodes")}};e.getSheet3DNode(i)},onFailure:function(){console.log("CATDibUDLWebLoader: loadDifAnnotationSetModel"),t.onFailure()}};e.loadModel(n)},this.loadDifAnnotationSetModelFromProduct=function(e){var t={objectPhysicalid:e.data.physicalid,serverUrl:e.serverUrl,securityContext:e.securityContext,onComplete:function(t){var n="DIFAnnotationSet",i=t[0].physicalid;e.data.dataType=n,i&&(e.data.physicalid=i),loadDifAnnotationSetModel(e)},onFailure:function(){console.log("CATDibUDLWebLoader: loadDifAnnotationSetModelFromProduct"),e.onFailure}};a.getDIFAnnotatedProduct(t)},this.getNumberOfSheets=function(){return e.getNumberOfSheets()},this.getSheetName=function(t){return e.getSheetName(t)},this.getLoadedSheetsId=function(){return e.getLoadedSheetsId()},this.getSheetBackgroundColor=function(t){return e.getSheetBackgroundColor(t)},this.getSheet3DNode=function(t){e.getSheet3DNode(t)},this.setDisplaySheet=function(t){e.setDisplaySheet(t)},this.getSheetSize=function(t){return e.getSheetSize(t)},this.setMaxSheetInCache=function(n){t=n,e&&e.setMaxSheetInCache(n)},this.isDetailSheet=function(t){return e.isDetailSheet(t)},this.getSheetThumbnail=function(t){return e.getSheetThumbnail(t)},this.setSheetPickingByView=function(t){return e.setSheetPickingByView(t)},this.set2DAccuracy=function(e){r=e},this.get2DAccuracy=function(){return r},this.set3DAccuracy=function(e){s=e},this.get3DAccuracy=function(){return s},this.getAnnotationSetMBDViews=function(t){e?e.getAnnotationSetMBDViews(t):t.onFailure()},this.getAnnotationSetMBDCaptures=function(t){e?e.getAnnotationSetMBDCaptures(t):t.onFailure()},this.loadModel=function(n){n&&n.serverUrl&&n.securityContext&&n.data&&n.data.physicalid&&n.data.dataType?(console.log("Please provide symbols relation ID"),"Drawing"===n.data.dataType?this.loadDrawingModel(n):"DIFSheet"===n.data.dataType||"DIFLayout"===n.data.dataType||"DIFView"===n.data.dataType?this.loadDifSheetModel(n):"DIFAnnotationSet"===n.data.dataType||"DIFMBDView"===n.data.dataType?this.loadDifAnnotationSetModel(n):"VPMReference"===n.data.dataType&&this.loadDifAnnotationSetModelFromProduct(n),e||(console.log("CATDibUDLWebLoader: Input Data type not supported"),n.onFailure()),e.setMaxSheetInCache(t)):console.log("CATDibUDLWebLoader: Bad argurment")},this.is3DObject=function(){return e.is3DObject()},this.clearLoader=function(){t=null,e&&(e.clearLoader(),e=null),r=null,s=null}}})}),define("DS/DibUDLWebLoader/CATDibUDLWebLoaderForAnnotationSet",["UWA/Class","DS/DibUDLWebLoader/DifAnnotationSetUDLWebLoader","DS/DibWebUtils/DibQueryToolbox"],function(e,t,n){"use strict";return e.extend({init:function(){var e;this.getAnnotationSetIDAssociatedToProductIDInternal=function(e){if(e)if(e.serverUrl)if(e.securityContext)if(e.physicalid){var t=[],i={objectPhysicalid:e.physicalid,serverUrl:e.serverUrl,securityContext:e.securityContext,onComplete:function(n){Array.isArray(n)?n.forEach(function(e){t.push(e.physicalid)}):n?t.push(n.physicalid):console.log("CATDibUDLWebLoaderForAnnotationSet: No AnnotationSet"),e.onComplete(t)},onFailure:function(){e.onFailure()}};n.getDIFAnnotatedProduct(i)}else console.log("CATDibUDLWebLoaderForAnnotationSet: Missing physicalid argument");else console.log("CATDibUDLWebLoaderForAnnotationSet: Missing securityContext argument");else console.log("CATDibUDLWebLoaderForAnnotationSet: Missing serverUrl argument");else console.log("CATDibUDLWebLoaderForAnnotationSet: Missing argument")},this.getProductIDAssociatedToAnnotationSetInternal=function(e){if(e)if(e.serverUrl)if(e.securityContext)if(e.physicalid){var t={objectPhysicalid:e.physicalid,serverUrl:e.serverUrl,securityContext:e.securityContext,onComplete:function(t){var n;if(Array.isArray(t)){var i=t[0];i?n=i.physicalid:console.log("CATDibUDLWebLoaderForAnnotationSet: No Product")}else t?n=t.physicalid:console.log("CATDibUDLWebLoaderForAnnotationSet: No Product");e.onComplete(n)},onFailure:function(){e.onFailure()}};n.getProductFromDifAnnotationSet(t)}else console.log("CATDibUDLWebLoaderForAnnotationSet: Missing physicalid argument");else console.log("CATDibUDLWebLoaderForAnnotationSet: Missing securityContext argument");else console.log("CATDibUDLWebLoaderForAnnotationSet: Missing serverUrl argument");else console.log("CATDibUDLWebLoaderForAnnotationSet: Missing argument")},this.loadModelInternal=function(n){if(n)if(n.serverUrl)if(n.securityContext)if(n.data)if(n.data.physicalid)if(n.data.dataType){if("DIFAnnotationSet"===n.data.dataType){e=new t;var i={data:n.data,serverUrl:n.serverUrl,securityContext:n.securityContext,onComplete:function(t){var i={sheetID:t.currentSheetID,onSheetNodeCreated:function(e){e||(console.log("No sheet node"),n.onFailure())},onSheetLoaded:function(){n.onComplete(t)},onFailure:function(){console.log("Failed getting All AnnotationSet nodes")}};e.getSheet3DNode(i)},onFailure:function(){console.log("CATDibUDLWebLoaderForAnnotationSet: load Failed"),n.onFailure()}};e.loadModel(i)}e||(console.log("CATDibUDLWebLoaderForAnnotationSet: Input Data type not supported"),n.onFailure())}else console.log("CATDibUDLWebLoaderForAnnotationSet: Bad argurment");else console.log("CATDibUDLWebLoaderForAnnotationSet: Bad argurment");else console.log("CATDibUDLWebLoaderForAnnotationSet: Bad argurment");else console.log("CATDibUDLWebLoaderForAnnotationSet: Bad argurment");else console.log("CATDibUDLWebLoaderForAnnotationSet: Bad argurment");else console.log("CATDibUDLWebLoaderForAnnotationSet: Bad argurment")},this.getAnnotationSetIDAssociatedToProductID=function(e){this.getAnnotationSetIDAssociatedToProductIDInternal(e)},this.getProductIDAssociatedToAnnotationSet=function(e){this.getProductIDAssociatedToAnnotationSetInternal(e)},this.getAnnotationSet3DNode=function(t){e?e.getAnnotationSet3DNode(t):t.onFailure()},this.getAnnotationSetMBDCaptures=function(t){e?e.getAnnotationSetMBDCaptures(t):t.onFailure()},this.getAnnotationSetMBDViews=function(t){e?e.getAnnotationSetMBDViews(t):t.onFailure()},this.loadModel=function(e){this.loadModelInternal(e)}}})});