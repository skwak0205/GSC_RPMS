define("DS/CATSmmViewer/HtmlDisplayer",["require","exports"],function(e,t){"use strict";return class{constructor(e,t){this.container=e,this.container.classList.add("syc-layer-html"),this.options=t,this.container.innerHTML=t.client.config.resolveUrlInHtml(this.options.layer.representation)}render(e){}}}),define("DS/CATSmmViewer/Viewer",["require","exports","DS/CATSmmDraw/Geometry","DS/CATSmmDraw/ViewPoint","css!./Viewer.css"],function(e,t,i,s){"use strict";const n={"2d-canvas":"DS/CATSmmViewer/Canvas2dDisplayer","1d-html":"DS/CATSmmViewer/HtmlDisplayer"};const r={Vertical:"Vertical",Stacked:"Stacked"};return class{constructor(e){switch(this._eventTarget=document.createDocumentFragment(),this.options=e,this.container=document.createElement("div"),this.container.classList.add("syc-viewer"),this._layersElt=document.createElement("div"),this._layoutType()){case r.Stacked:this._layersElt.classList.add("syc-vertical-layers");break;case r.Vertical:this._layersElt.classList.add("syc-stacked-layers")}this.container.appendChild(this._layersElt)}render(){if(this._visibleBounds=[0,0,this.container.clientWidth,this.container.clientHeight],!this.viewPoint){const e=i.expandRectangle(this._visibleBounds.slice(),-10,-10),t=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];for(const e of this.options.preview.layers)e&&e.bounds&&"absolute"===e.anchor.type&&i.rectangleMergeWithRectangle(t,e.bounds);this.viewPoint=s.focusOnRectangle(e,t,i.Direction.CENTER,!0,1)}if(this.displayers)for(const e of this.displayers)e&&e.render({viewPoint:this.viewPoint,visibleBounds:this._visibleBounds});else this._initLayers()}addEventListener(e,t,i){this._eventTarget.addEventListener(e,t,i)}removeEventListener(e,t,i){this._eventTarget.addEventListener(e,t,i)}_dispatchCustomEvent(e,t){const i=new CustomEvent(e,{bubbles:!0,cancelable:!0,detail:t});return this._dispatchEvent(i)}_dispatchEvent(e){return this._eventTarget.dispatchEvent(e)}_layoutType(){for(const e of this.options.preview.layers)if(e)switch(e.format){case"2d-canvas":return r.Stacked;case"1d-html":return r.Vertical}return r.Stacked}_getDisplayerModule(e){if(this.options.displayerModules){const t=this.options.displayerModules[e.format];if(t)return t}if(t=e.format,n.hasOwnProperty(t))return n[e.format];var t}_initLayers(){const t=new Array(this.options.preview.layers.length);this.displayers=t;for(let i=0;i<this.options.preview.layers.length;i++){t[i]=null;const s=this.options.preview.layers[i],n=document.createElement("div");if(n.classList.add("syc-layer"),this._layersElt.appendChild(n),s){const r=this._getDisplayerModule(s);r?e([r],e=>{try{const r=new e(n,{name:i+"",preview:this.options.preview,layer:s,client:this.options.client});t[i]=r,this.viewPoint&&this._visibleBounds&&r.render({viewPoint:this.viewPoint,visibleBounds:this._visibleBounds}),this._dispatchCustomEvent("syc-layer-loaded",{displayer:r})}catch(e){console.error(e)}},e=>console.log(e)):console.warn("Can't find a displayer for this layer: ",s)}}}}}),define("DS/CATSmmViewer/Canvas2dDisplayer",["require","exports","DS/CATSmmDraw/ImageUtils","DS/CATSmmDraw/Geometry","DS/CATSmmDraw/ViewPoint"],function(require,exports,ImageUtils,Geometry,ViewPoint){"use strict";class Canvas2dDisplayer{constructor(e,t){this.container=e,this.container.classList.add("syc-layer-2d"),this.options=t,this.canvas=document.createElement("canvas"),this.container.appendChild(this.canvas),this.displayFunction=evalWithContext("function(c, imgFcn) {"+this.options.layer.representation+"\n}","layer-2d-"+this.options.name+"-"+this.options.preview.id+".js")}render(e){this.canvas.width!==e.visibleBounds[2]-e.visibleBounds[0]&&(this.canvas.width=e.visibleBounds[2]-e.visibleBounds[0]),this.canvas.height!==e.visibleBounds[3]-e.visibleBounds[1]&&(this.canvas.height=e.visibleBounds[3]-e.visibleBounds[1]);const t=this.canvas.getContext("2d");if(t){t.clearRect(0,0,this.canvas.width,this.canvas.height);try{t.save(),anchorViewPoint(this.options.layer.anchor,e.viewPoint,e.visibleBounds,[],this.options.layer.fixedScale).applyToGc(t),t.beginPath(),this.displayFunction(t,imgFctFactory(this.options.preview,t,this.options.client.config,()=>this.render(e)))}finally{t.restore()}}else console.warn("No support for canvas 2d!")}}function evalWithContext(script,scriptName){var require=window.require;return eval("("+script+")\n//# sourceURL="+scriptName)}function imgFctFactory(e,t,i,s){return(n,r,a,o,c,l,d,h)=>{try{void 0===e.images&&(e.images={});let p=e.images[n];if(null==p){(p=new Image).completed=!1,p.onload=function(){p.completed=!0,s()},p.src=i.resolveUrl(n);const t="data:";p.completed=void 0!==p.src&&null!==p.src&&p.src.substr(0,t.length)===t,e.images[n]=p}p.completed&&ImageUtils.drawImage(t,p,r,a,o,c,l,d,h)}catch(e){console.warn(e)}}}function anchorViewPoint(e,t,i,s,n){if(!e)return t;let r=1,a=0,o=0;switch(e.type){case"absolute":const n=t.transform(e.point);a=n[0],o=n[1];break;case"window":a=i[0]*(1-e.point[0])+i[2]*e.point[0],o=i[1]*(1-e.point[1])+i[3]*e.point[1];break;case"selection":if(s.length>0){const n=s[0],r=Geometry.rectangleMergeWithPoints([Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY],n.location),c=anchorViewPoint(n.layer.anchor,t,i,s,n.layer.fixedScale).transform([r[0]*(1-e.point[0])+r[2]*e.point[0],r[1]*(1-e.point[1])+r[3]*e.point[1]]);a=c[0],o=c[1]}}return n||(r=t.scale),new ViewPoint(r,a,o)}return Canvas2dDisplayer}),define("DS/CATSmmViewer/Displayer",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})});