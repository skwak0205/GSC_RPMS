define("DS/VCXWebKernelTools/VCXEnums",["UWA/Class","DS/Visualization/ThreeJS_DS"],function(e,t){"use strict";var r=e.singleton({init:function(){}});return r.Color={White:(new t.Color).setRGB(1,1,1),Black:(new t.Color).setRGB(0,0,0),GreyDark:(new t.Color).setRGB(.1,.1,.1),Grey:(new t.Color).setRGB(.5,.5,.5),Gold:(new t.Color).setRGB(1,.766744,.334458),Aluminium:(new t.Color).setRGB(111/255,114/255,115/255),Satin:(new t.Color).setRGB(235/255,129/255,177/255)},r.TextureMapping={None:0,Planar:1,Spherical:2,Cubic:3,CylindricalFinite:4,CylindricalInfinite:5},r.EnvironmentalId={None:0,Chromic:1,Metal:2,MetalBrushed:3,Plastic:4,Glass:5,GlassPlastic:6,ChromicWithColor:7,Gold:8,Unknown:9,Aluminium:10,Satin:11,PLM:99},r.PrimitiveType={None:0,Line:1,Disc:4,Square:5,Cube:6,Sphere:7,Cylinder:8,Cone:9},r}),define("DS/VCXWebKernelTools/VCXObjectTools",["UWA/Class"],function(e){"use strict";var t=e.singleton({init:function(){}});return t.pRequire=function(e){var t=UWA.Promise.deferred();return requirejs([e],function(e){t.resolve(e)},function(e){t.reject(e)}),t.promise},t.deepCompare=function(e,t,r,n,i){function a(e,t){var r=[];return(a=function(e,t){var n=r.length;for(;n--;)if(r[n--]===t)return r[n]===e;return r.push(e,t),null})(e,t)}return e===t&&0!==e||function e(t,i){var o,s,l,d,h;if((o=toString.call(t))!==toString.call(i))return console.warn("Case 1"),!1;switch(o){default:return t.valueOf()===i.valueOf();case"[object Number]":return(t=+t)==(i=+i);case"[object RegExp]":return t.source==i.source&&t.global==i.global&&t.ignoreCase==i.ignoreCase&&t.multiline==i.multiline&&t.lastIndex==i.lastIndex;case"[object Function]":return console.warn("Case 2"),!1;case"[object Array]":if(n&&null!==(d=a(t,i)))return d;if((s=t.length)!=i.length)return console.warn("Case 3"),!1;for(;s--;)if(!((d=t[s])===(h=i[s])&&0!==d||e(d,h)))return console.warn("Case 4"),!1;return!0;case"[object Object]":if(n&&null!==(d=a(t,i)))return d;if(s=0,r){var c=[];for(l in t)if(t.hasOwnProperty(l)){if(c.push(l),(d=t[l])===(h=i[l])&&0!==d||e(d,h))continue;return console.warn("Case 5"),!1}for(l in i)if(i.hasOwnProperty(l)&&c[s++]!=l)return console.warn("Case 6"),!1}else{for(l in t)if(t.hasOwnProperty(l)){if(++s,(d=t[l])===(h=i[l])&&0!==d||e(d,h))continue;return console.warn("Case 7"),!1}for(l in i)if(i.hasOwnProperty(l)&&--s<0)return console.warn("Case 8"),!1}return!0}}(e,t)},t}),define("DS/VCXWebKernelTools/VCXAnalyticsTrackerBaseManager",["require","exports","DS/Usage/TrackerAPI","DS/Visualization/ThreeJS_DS"],function(e,t,r,n){"use strict";class i{NewClock(){return new n.Clock}getApplicationId(){return""}trackEvent({eventCategory:e="",eventAction:t="",eventLabel:n="",eventValue:i,persDim:a,persVal:o}={}){var s=this.getApplicationId();s&&this._experienceBase.getManager("VCXPlatformServicesManager").GetTenantId().then(function(l){r.trackPageEvent({eventCategory:e,eventAction:t,eventLabel:n,eventValue:i,appID:s,tenant:l,persDim:a,persVal:o})})}postInitialize(){}unInitialize(){}}return Object.defineProperty(i.prototype,"componentType",{enumerable:!0,get:function(){return"VCXAnalyticsTrackerBaseManager"}}),i}),define("DS/VCXWebKernelTools/VCXTextTools",["UWA/Class","DS/Visualization/ThreeJS_DS"],function(e,t){"use strict";var r=e.singleton({init:function(){}});return r.computeFontDimension=function(e,t){var r={};return r.spaceSize=e.measureText(" "),r.size=e.measureText("MHgfd"),r.height=t,void 0===r.size.actualBoundingBoxAscent&&(r.size.actualBoundingBoxAscent=.7*r.height),void 0===r.size.actualBoundingBoxDescent&&(r.size.actualBoundingBoxDescent=.3*r.height),"number"==typeof r.size.actualBoundingBoxAscent&&"number"==typeof r.size.actualBoundingBoxDescent?r.maxHeight=r.size.actualBoundingBoxAscent+r.size.actualBoundingBoxDescent:r.maxHeight=r.height,r},r.analyseText=function(e,t,n,i,a,o,s){t||((t={}).fontInfo=r.computeFontDimension(n,a),t.paragraphs=[],e.split("\n").forEach(function(e){var r={};t.paragraphs.push(r),r.words=[],e.split(" ").forEach(function(e){var t={};r.words.push(t),t.word=e,t.size=n.measureText(e)})}));var l=0;l+=t.fontInfo.size.actualBoundingBoxAscent;for(var d=0,h=0;h<t.paragraphs.length;h++){var c=t.fontInfo.spaceSize.width,f=t.paragraphs[h],u=0,p=0;0!==h&&(l+=t.fontInfo.maxHeight*s),f.lines=[{width:0,words:[],textY:l}];for(var m=0;m<f.words.length;m++){var g=f.words[m],v=0===u;u+g.size.width>i&&0!==m&&i>=0&&(v=!0,u=0,l+=t.fontInfo.maxHeight*o,p++,f.lines.push({width:0,words:[],textY:l})),v?g.size.actualBoundingBoxLeft&&(u+=g.size.actualBoundingBoxLeft):u+=c,g.size.actualBoundingBoxRight&&m===f.words.length-1?u+=g.size.actualBoundingBoxRight:u+=g.size.width,f.lines[p].words.push(g),f.lines[p].width=u,d<u&&(d=u)}}return e.length<10&&!isNaN(Number(e))||(l+=t.fontInfo.size.actualBoundingBoxDescent),t.maxWidth=d,t.maxHeight=l,t},r.drawText=function(e,t,r,n,i,a){e.paragraphs.forEach(function(o){var s=o.lines.length-1;o.lines.forEach(function(o,l){var d=o.textY+n,h=r,c=e.fontInfo.spaceSize.width;if(2===a)h+=i-o.width;else if(1===a)h+=.5*(i-o.width);else if(3===a){var f=i-o.width;(f/=o.words.length-1)>0&&(s===l?f<3*c&&(c+=f):c+=f)}var u=!0;o.words.forEach(function(e){if(u?(u=!1,e.size.actualBoundingBoxLeft&&(h+=e.size.actualBoundingBoxLeft)):h+=c,t){t.fillText(e.word,h,d)}h+=e.size.width})})})},r.htmlEncode=function(e){return e.replace(/[\u00A0-\u9999<>\&]/gm,function(e){return"&#"+e.charCodeAt(0)+";"}).replace(/\n|\r/gm,"<br />")},r.htmlDecode=function(e){var t=document.createElement("textarea");return t.innerHTML=e,t.value.replace(/<[^>]*>?/gm,"")},r.getUrlVars=function(){var e,t={},r={};return window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi,function(e,r,n){t[r]=decodeURIComponent(n)}),t.widgetDomain?e=t.widgetDomain:t.uwaUrl&&(e=t.uwaUrl),e?e.replace(/[?&]+([^=&]+)=([^&]*)/gi,function(e,t,n){r[t]=n}):r=t,r},r}),define("DS/VCXWebKernelTools/VCXMathTools",["require","exports","DS/Visualization/ThreeJS_DS"],function(e,t,r){"use strict";class n{static getOFromMatrix(e){return e?new r.Vector3(e.elements[12],e.elements[13],e.elements[14]):new r.Vector3(0,0,0)}static getVxFromMatrix(e){return e?new r.Vector3(e.elements[0],e.elements[1],e.elements[2]):new r.Vector3(1,0,0)}static getVyFromMatrix(e){return e?new r.Vector3(e.elements[4],e.elements[5],e.elements[6]):new r.Vector3(0,1,0)}static getVzFromMatrix(e){return e?new r.Vector3(e.elements[8],e.elements[9],e.elements[10]):new r.Vector3(0,0,1)}static normalizeMatrix(e){var t=n.getVxFromMatrix(e).normalize(),r=n.getVyFromMatrix(e).normalize(),i=n.getVzFromMatrix(e).normalize();return e.clone().makeBasis(t,r,i)}static rotateMatrixAroundX(e,t){var i=(new r.Matrix4).extractRotation(e);return i.multiply((new r.Matrix4).makeRotationX(t)),i.setPosition(n.getOFromMatrix(e))}static rotateMatrixAroundY(e,t){var i=(new r.Matrix4).extractRotation(e);return i.multiply((new r.Matrix4).makeRotationY(t)),i.setPosition(n.getOFromMatrix(e))}static rotateMatrixAroundZ(e,t){var i=(new r.Matrix4).extractRotation(e);return i.multiply((new r.Matrix4).makeRotationZ(t)),i.setPosition(n.getOFromMatrix(e))}static getEulerFromQuaternion(e){var t=new r.Vector3,n=2*(e.w*e.x+e.y*e.z),i=1-2*(e.x*e.x+e.y*e.y);t.x=Math.atan2(n,i);var a=2*(e.w*e.y-e.z*e.x);Math.abs(a)>=1?t.y=Math.PI/2*Math.sign(a):t.y=Math.asin(a);var o=2*(e.w*e.z+e.x*e.y),s=1-2*(e.y*e.y+e.z*e.z);return t.z=Math.atan2(o,s),t}static getQuaternionFromEuler(e){var t=Math.cos(.5*e.z),n=Math.sin(.5*e.z),i=Math.cos(.5*e.y),a=Math.sin(.5*e.y),o=Math.cos(.5*e.x),s=Math.sin(.5*e.x),l=new r.Quaternion;return l.w=o*i*t+s*a*n,l.x=s*i*t-o*a*n,l.y=o*a*t+s*i*n,l.z=o*i*n-s*a*t,l}static getEulerFromMatrix(e,t="XYZ"){let r,i,a,o=e.elements,s=o[0],l=o[4],d=o[8],h=o[1],c=o[5],f=o[9],u=o[2],p=o[6],m=o[10];switch(t){case"XYZ":i=Math.asin(n.clamp(d,-1,1)),Math.abs(d)<.9999999?(r=Math.atan2(-f,m),a=Math.atan2(-l,s)):(r=Math.atan2(p,c),a=0);break;case"YXZ":r=Math.asin(-n.clamp(f,-1,1)),Math.abs(f)<.9999999?(i=Math.atan2(d,m),a=Math.atan2(h,c)):(i=Math.atan2(-u,s),a=0);break;case"ZXY":r=Math.asin(n.clamp(p,-1,1)),Math.abs(p)<.9999999?(i=Math.atan2(-u,m),a=Math.atan2(-l,c)):(i=0,a=Math.atan2(h,s));break;case"ZYX":i=Math.asin(-n.clamp(u,-1,1)),Math.abs(u)<.9999999?(r=Math.atan2(p,m),a=Math.atan2(h,s)):(r=0,a=Math.atan2(-l,c));break;case"YZX":a=Math.asin(n.clamp(h,-1,1)),Math.abs(h)<.9999999?(r=Math.atan2(-f,c),i=Math.atan2(-u,s)):(r=0,i=Math.atan2(d,m));break;case"XZY":a=Math.asin(-n.clamp(l,-1,1)),Math.abs(l)<.9999999?(r=Math.atan2(p,c),i=Math.atan2(d,s)):(r=Math.atan2(-f,m),i=0)}return{x:r,y:i,z:a,order:t}}static makeRotationFromEuler(e,t){var r=e.elements,n=t.x,i=t.y,a=t.z,o=Math.cos(n),s=Math.sin(n),l=Math.cos(i),d=Math.sin(i),h=Math.cos(a),c=Math.sin(a);switch(t.order){case"XYZ":{let e=o*h,t=o*c,n=s*h,i=s*c;r[0]=l*h,r[4]=-l*c,r[8]=d,r[1]=t+n*d,r[5]=e-i*d,r[9]=-s*l,r[2]=i-e*d,r[6]=n+t*d,r[10]=o*l}break;case"YXZ":{let e=l*h,t=l*c,n=d*h,i=d*c;r[0]=e+i*s,r[4]=n*s-t,r[8]=o*d,r[1]=o*c,r[5]=o*h,r[9]=-s,r[2]=t*s-n,r[6]=i+e*s,r[10]=o*l}break;case"ZXY":{let e=l*h,t=l*c,n=d*h,i=d*c;r[0]=e-i*s,r[4]=-o*c,r[8]=n+t*s,r[1]=t+n*s,r[5]=o*h,r[9]=i-e*s,r[2]=-o*d,r[6]=s,r[10]=o*l}break;case"ZYX":{let e=o*h,t=o*c,n=s*h,i=s*c;r[0]=l*h,r[4]=n*d-t,r[8]=e*d+i,r[1]=l*c,r[5]=i*d+e,r[9]=t*d-n,r[2]=-d,r[6]=s*l,r[10]=o*l}break;case"YZX":{let e=o*l,t=o*d,n=s*l,i=s*d;r[0]=l*h,r[4]=i-e*c,r[8]=n*c+t,r[1]=c,r[5]=o*h,r[9]=-s*h,r[2]=-d*h,r[6]=t*c+n,r[10]=e-i*c}break;case"XZY":{let e=o*l,t=o*d,n=s*l,i=s*d;r[0]=l*h,r[4]=-c,r[8]=d*h,r[1]=e*c+i,r[5]=o*h,r[9]=t*c-n,r[2]=n*c-t,r[6]=s*h,r[10]=i*c+e}}return r[3]=0,r[7]=0,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,e}static getMatrixFromOVxVy(e,t,n){var i=t.clone(),a=(new r.Vector3).crossVectors(t,n).normalize();i.normalize();var o=(new r.Vector3).crossVectors(a,i).normalize();return(new r.Matrix4).makeBasis(i,o,a).setPosition(e)}static getMatrixFromOVxVz(e,t,n){var i=(new r.Vector3).crossVectors(n,t);return i.lengthSq()<1e-4?this.getMatrixFromOVx(e,t):this.getMatrixFromOVxVy(e,t,i)}static getMatrixFromOVyVz(e,t,n){var i=(new r.Vector3).crossVectors(t,n);return i.lengthSq()<1e-4?this.getMatrixFromOVy(e,t):this.getMatrixFromOVxVy(e,i,t)}static getMatrixFromOVzVx(e,t,n){var i=(new r.Vector3).crossVectors(t,n).normalize();return i.lengthSq()<1e-4?this.getMatrixFromOVz(e,t):this.getMatrixFromOVyVz(e,i,t)}static getMatrixFromOVzVy(e,t,n){var i=(new r.Vector3).crossVectors(n,t);return i.lengthSq()<1e-4?this.getMatrixFromOVz(e,t):this.getMatrixFromOVzVx(e,t,i)}static getMatrixFromOVx(e,t){var n=t.clone().normalize(),i=(new r.Vector3).crossVectors(new r.Vector3(0,0,1),n);return i.lengthSq()<1e-4&&(i=new r.Vector3(0,1,0)),this.getMatrixFromOVxVy(e,n,i)}static getMatrixFromOVy(e,t){var n=t.clone().normalize(),i=(new r.Vector3).crossVectors(n,new r.Vector3(0,0,1));return i.lengthSq()<1e-4&&(i=new r.Vector3(1,0,0)),this.getMatrixFromOVxVy(e,i,n)}static getMatrixFromOVz(e,t){var n=t.clone().normalize(),i=(new r.Vector3).crossVectors(new r.Vector3(0,0,1),n);return i.lengthSq()<1e-4&&(i=new r.Vector3(1,0,0)),this.getMatrixFromOVxVz(e,i,n)}static isOrthonormal(e){var t=new r.Vector3,n=new r.Vector3,i=new r.Vector3;if(e.extractBasis(t,n,i),Math.abs(t.dot(n))<.001&&Math.abs(t.dot(i))<.001&&Math.abs(n.dot(i))<.001){if(Math.abs(1-t.length())<.001&&Math.abs(1-n.length())<.001&&Math.abs(1-i.length())<.001)return!0;console.warn("Not normal")}else console.warn("Not orthogonal");return!1}static getNearestPointsBetween2Lines(e,t,n,i){let a={};var o=t.clone().normalize(),s=i.clone().normalize();if(Math.abs(o.dot(s))>.99999){var l=(n.x-e.x)*o.x+(n.y-e.y)*o.y+(n.z-e.z)*o.z;a.p1=e.clone().add(o.clone().multiplyScalar(l)),a.p2=n.clone()}else{var d=o.dot(s),h=1-d*d;if(h<1e-5)return null;var c=(new r.Vector3).subVectors(n,e),f=c.dot(o),u=-c.dot(s),p=(f+d*u)/h,m=u+d*p;a.p1=e.clone().add(o.clone().multiplyScalar(p)),a.p2=n.clone().add(s.clone().multiplyScalar(m))}return a}static getNearestDistanceBetween2Lines(e,t,r,i){var a=n.getNearestPointsBetween2Lines(e,t,r,i);return a.d=a.p1.distanceTo(a.p2),a}static getNearestDistanceSquaredBetween2Lines(e,t,r,i){var a=n.getNearestPointsBetween2Lines(e,t,r,i);return a.d=a.p1.distanceToSquared(a.p2),a}static IsMat1EqualsToMat2(e,t,r){if(!e&&!t)return!0;if(e&&t){r||(r=1e-5);var n=0;for(n=0;n<16;n++)if(Math.abs(e.elements[n]-t.elements[n])>r)return!1;return!0}return!1}static isLineIntersectCircle(e,t,n,i,a,o){var s=new r.Plane;s.setFromNormalAndCoplanarPoint(a,n);var l=s.intersectLine(new r.Line3(e,t));if(!l)return!1;var d=i-o,h=i+o,c=l.distanceToSquared(n);return c>d*d&&c<h*h}static getPointProjectionOnLine(e,t,n){var i=(new r.Vector3).subVectors(n,e),a=t;return(new r.Vector3).addVectors(e,a.clone().multiplyScalar(i.dot(a)/a.dot(a)))}static isLineIntersectPoint(e,t,n,i){var a=(new r.Vector3).subVectors(n,e),o=(new r.Vector3).subVectors(t,e);return(new r.Vector3).addVectors(e,o.clone().multiplyScalar(a.dot(o)/o.dot(o))).distanceToSquared(n)<i*i}static isOnPlane(e,t,n,i){var a=(new r.Vector3).subVectors(e,t);return Math.abs(a.dot(n))<i}static isCylinder(e,t,i,a){var o=e[t].point,s=e[t].normal,l=e[t+1].point,d=e[t+1].normal,h=s.clone().cross(d),c=n.getNearestPointsBetween2Lines(o,s,l,d),f=(new r.Vector3).addVectors(c.p1,c.p2).multiplyScalar(.5),u=o.distanceTo(c.p1),p=new r.Vector3;let m;for(m=t;m<e.length-1&&m<=i-1;++m){var g=e[m].point,v=e[m].normal,y=e[m+1].point,w=e[m+1].normal;h.add(v.clone().cross(w));var b=n.getNearestPointsBetween2Lines(g,v,y,w);u+=g.distanceTo(b.p1),f.add(p.addVectors(b.p1,b.p2).multiplyScalar(.5))}f.divideScalar(m),u/=m,h.normalize();var x=n.getPointProjectionOnLine(f,h,o),A=x.clone(),_=u-a,T=u+a,C=_*_,I=T*T,V=new r.Vector3,B=new r.Vector3,M=new r.Vector3;p=new r.Vector3;for(m=t;m<e.length&&m<=i;++m){let t=n.getPointProjectionOnLine(f,h,e[m].point);if(p.x=V.x-t.x,p.y=V.y-t.y,p.z=V.z-t.z,p.normalize(),Math.abs(p.dot(h))>.001)return null;var S=V.distanceToSquared(t);if(S<C||S>I)return null;if(B.subVectors(x,t),M.subVectors(A,t),!(B.dot(M)<0)){var R=t.distanceToSquared(x),G=t.distanceToSquared(A);R>=G?A=t:G>=R&&(x=t)}}return x.distanceToSquared(A)<1e-4?null:{center:f=(new r.Vector3).addVectors(x,A).multiplyScalar(.5),radius:u,normal:h,point1:x,point2:A}}static isOnCylinder(e,t,i,a,o,s){var l=new r.Vector3(.5*i*o.x,.5*i*o.y,.5*i*o.z),d=new r.Vector3(t.x-l.x,t.y-l.y,t.z-l.z),h=new r.Vector3(t.x+l.x,t.y+l.y,t.z+l.z),c=n.getPointProjectionOnLine(d,l,e),f=(new r.Vector3).subVectors(d,c),u=(new r.Vector3).subVectors(h,c);if(f.dot(u)>0)return!1;var p=c.distanceToSquared(e),m=a-s,g=a+s;return p>m*m&&p<g*g}static isOnCone(e,t,i,a,o,s){var l=t,d=new r.Vector3(t.x+a*o.x,t.y+a*o.y,t.z+a*o.z),h=n.getPointProjectionOnLine(l,o,e),c=(new r.Vector3).subVectors(l,h),f=(new r.Vector3).subVectors(d,h);if(c.dot(f)>0)return!1;var u=e.distanceTo(h)/Math.tan(i),p=h.distanceToSquared(t),m=u-s,g=u+s;return p>m*m&&p<g*g}static isOnSphere(e,t,r,n){var i=e.distanceToSquared(t),a=r-n,o=r+n;return i>a*a&&i<o*o}static clamp(e,t,r){return Math.max(Math.min(e,r),t)}static lerpVectors(e,t,r,n){return n.x=e.x*(1-r)+t.x*r,n.y=e.y*(1-r)+t.y*r,n.z=e.z*(1-r)+t.z*r,n}static getPluckerCoordinates(e,t){let r=[];return r[0]=e.x*t.y-t.x*e.y,r[1]=e.x*t.z-t.x*e.z,r[2]=e.x-t.x,r[3]=e.y*t.z-t.y*e.z,r[4]=e.z-t.z,r[5]=t.y-e.y,r}static sideOperatorFromPluckerCoordinates(e,t){return"object"==typeof e&&"object"==typeof t&&6===e.length&&6===t.length?e[0]*t[4]+e[1]*t[5]+e[2]*t[3]+e[3]*t[2]+e[4]*t[0]+e[5]*t[1]:-1}static sideOperatorFromPoints(e,t,r,i){let a=n.getPluckerCoordinates(e,t),o=n.getPluckerCoordinates(r,i);return n.sideOperatorFromPluckerCoordinates(a,o)}static sideOperatorFromPointsNormal(e,t,r,i){return n.sideOperatorFromPoints(e,e.clone().add(t),r,r.clone().add(i))}static calculatePrimes(e,t){for(var r=[],n=0;n<e;n++){for(var i=n*(t*Math.random()),a=!0,o=2;o<=Math.sqrt(i);++o)if(i%o==0){a=!1;break}a&&r.push(i)}return r}}return n}),define("DS/VCXWebKernelTools/VCXLogServices",["UWA/Class"],function(e){"use strict";var t=e.singleton({});return t._logs={},t.memoryLog=function(e,r,n){void 0===window._startApplicationTime&&(window._startApplicationTime=.001*(new Date).getTime(),window.performance.memory&&console.log("[HEAP] WARNING : set this arg to chrome to see good values : --enable-precise-memory-info"));var i={},a="";window.performance.memory&&(window.gc&&window.gc(),i.memory=window.performance.memory.usedJSHeapSize/1048576),i.time=.001*(new Date).getTime(),r?t._logs[e]=i:t._logs[e]?(window.performance.memory&&(i.deltaMemory=i.memory-t._logs[e].memory),i.deltaTime=i.time-t._logs[e].time):(console.warn("VCXLogServices can't find corresponding start"),i.deltaMemory=i.memory);var o=Math.floor(i.memory);window.performance.memory&&(a+="[HEAP] =\t"+o+"\tMo, ");var s=(i.time-window._startApplicationTime).toLocaleString(void 0,{maximumSignificantDigits:2,minimumSignificantDigits:2});return a+="[TIME] =\t"+s+"\ts",r?a+=", ["+e+" START]":(a+=", ["+e+" END]",a+=", [DELTA HEAP] =\t"+Math.floor(i.deltaMemory)+"\tMo",a+=", [DELTA TIME] =\t"+(!isNaN(parseFloat(i.deltaTime))&&i.deltaTime.toLocaleString(void 0,{maximumSignificantDigits:2,minimumSignificantDigits:2}))+"\ts"),console.log(a),{logName:e,time:s,heap:o}},t}),define("DS/VCXWebKernelTools/VCXMimeTypeServices",["UWA/Class"],function(e){"use strict";return e.singleton({init:function(){this._mapTypes=null,this._mapTypesInv=null},InitMimeTypes:function(){this._mapTypes={},this._mapTypes[".txt"]="text/plain",this._mapTypes[".text"]="text/plain",this._mapTypes[".html"]="text/html",this._mapTypes[".htm"]="text/html",this._mapTypes[".gif"]="image/gif",this._mapTypes[".png"]="image/png",this._mapTypes[".jpeg"]="image/jpeg",this._mapTypes[".jpg"]="image/jpeg",this._mapTypes[".svg"]="image/svg+xml",this._mapTypes[".bmp"]="image/bitmap",this._mapTypes[".tiff"]="image/tiff",this._mapTypes[".tif"]="image/tiff",this._mapTypes[".tga"]="image/x-tga",this._mapTypes[".hdr"]="image/vnd.radiance",this._mapTypes[".doc"]="application/msword",this._mapTypes[".pdf"]="application/pdf",this._mapTypes[".zip"]="application/zip",this._mapTypes[".xml"]="application/xml",this._mapTypes[".xsl"]="application/xml",this._mapTypes[".json"]="application/json",this._mapTypes[".xls"]="application/vnd.ms-excel",this._mapTypes[".ppt"]="application/vnd.ms-powerpoint",this._mapTypes[".mpp"]="application/vnd.ms-project",this._mapTypes[".mpt"]="application/vnd.ms-project",this._mapTypes[".docx"]="application/vnd.openxmlformats-officedocument.wordprocessingml.document",this._mapTypes[".pptx"]="application/vnd.openxmlformats-officedocument.presentationml.presentation",this._mapTypes[".xlsx"]="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",this._mapTypes[".mp4a"]="audio/mp4",this._mapTypes[".mp3"]="audio/mpeg",this._mapTypes[".mpga"]="audio/mpeg",this._mapTypes[".ogg"]="audio/ogg",this._mapTypes[".wav"]="audio/x-wav",this._mapTypes[".mp4"]="video/mp4",this._mapTypes[".mpeg"]="video/mpeg",this._mapTypes[".webm"]="video/webm",this._mapTypes[".ogv"]="video/ogg",this._mapTypes[".avi"]="video/x-msvideo"},InitMimeTypesInv:function(){this._mapTypesInv={},this._mapTypesInv["text/plain"]=".txt",this._mapTypesInv["text/html"]=".html",this._mapTypesInv["image/gif"]=".gif",this._mapTypesInv["image/png"]=".png",this._mapTypesInv["image/jpeg"]=".jpeg",this._mapTypesInv["image/svg+xml"]=".svg",this._mapTypesInv["image/bitmap"]=".bmp",this._mapTypesInv["image/tiff"]=".tiff",this._mapTypesInv["image/x-tga"]=".tga",this._mapTypesInv["image/vnd.radiance"]=".hdr",this._mapTypesInv["application/msword"]=".doc",this._mapTypesInv["application/pdf"]=".pdf",this._mapTypesInv["application/zip"]=".zip",this._mapTypesInv["application/xml"]=".xml",this._mapTypesInv["application/json"]=".json",this._mapTypesInv["application/vnd.ms-excel"]=".xls",this._mapTypesInv["application/vnd.ms-powerpoint"]=".ppt",this._mapTypesInv["application/vnd.ms-project"]=".mpp",this._mapTypesInv["application/vnd.ms-project"]=".mpt",this._mapTypesInv["application/vnd.openxmlformats-officedocument.wordprocessingml.document"]=".docx",this._mapTypesInv["application/vnd.openxmlformats-officedocument.presentationml.presentation"]=".pptx",this._mapTypesInv["application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"]=".xlsx",this._mapTypesInv["audio/mp4"]=".mp4a",this._mapTypesInv["audio/mpeg"]=".mp3",this._mapTypesInv["audio/ogg"]=".ogg",this._mapTypesInv["audio/x-wav"]=".wav",this._mapTypesInv["video/mp4"]=".mp4",this._mapTypesInv["video/mpeg"]=".mpeg",this._mapTypesInv["video/webm"]=".webm",this._mapTypesInv["video/ogg"]=".ogv",this._mapTypesInv["video/x-msvideo"]=".avi"},GetMimeType:function(e){this._mapTypes||this.InitMimeTypes();var t="";t=e.lastIndexOf(".")>0?e.substr(e.lastIndexOf(".")).toLowerCase():e;var r=this._mapTypes[t];return r||(r="application/octet-stream"),r},GetExtension:function(e){this._mapTypesInv||this.InitMimeTypesInv();var t=this._mapTypesInv[e];return t||console.log("Extension not found!"),t}})}),define("DS/VCXWebKernelTools/VCXAnalyticsTrackerAppManager",["require","exports","DS/VCXWebKernelTools/VCXAnalyticsTrackerBaseManager"],function(e,t,r){"use strict";class n extends r{getApplicationId(){let e="";this._experienceBase&&(this._experienceBase.getManager("VCXContextManager").getProdHighMode()&&(e="XCTXPR_AP"));return e}trackImport3dxmlEvent(e,t,r){const n={eventCategory:e,eventAction:"import3dxml",eventLabel:"import3dxml",persDim:{pd1:t,pd2:((e,t)=>(e/1048576).toFixed(t))(r,1)}};this.trackEvent(n)}trackNewPresentationEvent(e){const t={eventCategory:e,eventAction:"NewPresentation",eventLabel:"NewPresentation",persDim:{pd1:window.xHVersion}};this.trackEvent(t)}trackOpenPresentationEvent(e){const t={eventCategory:e,eventAction:"OpenPresentation",eventLabel:"OpenPresentation",persDim:{pd1:window.xHVersion}};this.trackEvent(t)}trackGraphicCards(e){const t={eventCategory:"xH_UserHw",eventAction:"graphicCard",eventLabel:"graphicCard",eventValue:e||"",persDim:{pd1:window.xHVersion}};this.trackEvent(t)}trackStartCmdEvent(e){const t={eventCategory:"xH_Commands",eventAction:"startCommand",eventLabel:"startCommand",eventValue:e,persDim:{pd1:window.xHVersion}};this.trackEvent(t)}trackSkipGuidedTour(e,t){const r={eventCategory:"xH_GuidedTour",eventAction:"SkipGuidedTour",eventLabel:"SkipGuidedTour",eventValue:t,persDim:{pd1:window.xHVersion},persVal:{pv1:e}};this.trackEvent(r)}trackCompletedGuidedTour(e){const t={eventCategory:"xH_GuidedTour",eventAction:"CompletedGuidedTour",eventLabel:"CompletedGuidedTour",persDim:{pd1:window.xHVersion},persVal:{pv1:e}};this.trackEvent(t)}trackStopGuidedTour(e){const t={eventCategory:"xH_GuidedTour",eventAction:"StopGuidedTour",eventLabel:"StopGuidedTour",persDim:{pd1:window.xHVersion},persVal:{pv1:e}};this.trackEvent(t)}trackPublishImage(e,t,r,n,i){const a={eventCategory:"publish",eventAction:"click",eventLabel:"publish.image",eventValue:e,persDim:{pd1:t,pd2:r},persVal:{pv1:n,pv2:i}};this.trackEvent(a)}trackPublishVideo(e,t,r,n){const i={eventCategory:"publish",eventAction:"click",eventLabel:"publish.video",eventValue:e,persDim:{pd1:t,pd2:r,pd3:n}};this.trackEvent(i)}trackComputeVecto(e){const t={eventCategory:"compute",eventAction:"click",eventLabel:"compute.vecto",eventValue:e};this.trackEvent(t)}trackPublishVecto(){this.trackEvent({eventCategory:"publish",eventAction:"click",eventLabel:"publish.vecto"})}trackSaveExperience(){if(this._experienceBase&&this._experienceBase.ComponentsMap){const e=this._experienceBase.ComponentsMap,t=e.GetComponentFromType("VCXScenario").length,r=e.GetComponentFromType("Model_VPMReference_Spec").length,n={eventCategory:"dataStats",eventAction:"save",eventLabel:"Experience data stats (during save)",persDim:{pd1:t,pd2:r,pd3:e.GetComponentFromType("VCXComponentOccurrenceComposer").length-r,pd4:e.GetComponentFromType("CXPCameraActor_Spec").length,pd5:e.GetComponentFromType("VCXViewport_Spec").length,pd6:e.GetComponentFromType("VCXSection_Spec").length,pd7:e.GetComponentFromType("VCXRedLine_Spec").length,pd8:e.GetComponentFromType("VCXPolyline_Spec").length,pd9:e.GetComponentFromType("VCXMarkup_Spec").length,pd10:e.GetComponentFromType("VCXArrow_Spec").length,pd11:e.GetComponentFromType("VCXCompass_Spec").length,pd12:e.GetComponentFromType("VCXCircle_Spec").length,pd13:e.GetComponentFromType("AmbienceModel_Spec").length,pd14:e.GetComponentFromType("VCXDigger_Spec").length,pd15:this._experienceBase.getManager("VCXMaterialManager").getPLMMaterials().length}};this.trackEvent(n);const i=this._experienceBase.getManager("VCXVisuManager").getActiveViewport().QueryInterface("VCXIModifiable"),a={eventCategory:"visuStats",eventAction:"save",eventLabel:"Experience visu stats (during save)",persDim:{pd1:i.GetPropertyValue("Environment.SSAO"),pd2:i.GetPropertyValue("Environment.AA")}};this.trackEvent(a)}}}return Object.defineProperty(n.prototype,"componentType",{enumerable:!0,get:function(){return"VCXAnalyticsTrackerAppManager"}}),n}),define("DS/VCXWebKernelTools/VCXVideoRecorder",["UWA/Class","DS/VCXWebKernelTools/VCXLogServices"],function(e,t){"use strict";var r=e.extend({init:function(e,t,n,i){switch(this.mimeType=r.MimeType.Webm,e.toLowerCase()){case"webm":this.mimeType=r.MimeType.Webm+";codecs="+r.Codec.Webm;break;case"mkv":this.mimeType=r.MimeType.Mkv+";codecs="+r.Codec.Mkv;break;default:this.mimeType=r.MimeType.Webm+";codecs="+r.Codec.Webm}var a=this,o="undefined"!=typeof MediaRecorder;console.log("Type is : "+a.mimeType+" - support : "+o?MediaRecorder.isTypeSupported(a.mimeType):"No"),o&&MediaRecorder.isTypeSupported(a.mimeType)||(console.log("Switch to supported Webm"),a.mimeType=r.MimeType.Webm+";codecs="+r.Codec.Webm),this.mediaSource=new MediaSource,this.mediaSource.addEventListener("sourceopen",function(e){console.log("MediaSource opened");var t=this.mediaSource.addSourceBuffer(a.mimeType);console.log("Source buffer: ",t)},!1),this._nFPS=t||30,this._resWidth=parseInt(n),this._resHeight=parseInt(i),this._canvasVideo=null,this._canvasVideoPreview=null,this._mediaRecorder=null,this._recordedChunks=null,this._acceptZeroSizedChunks=!0},startRecording:function(){if("undefined"!=typeof MediaRecorder){this._canvasVideo=UWA.createElement("canvas",{class:"UserInteractionCanvas",width:this._resWidth+"px",height:this._resHeight+"px",styles:{zIndex:9999999,position:"absolute",top:"0px",left:"0px",pointerEvents:"none",visibility:"visible"}}),this._canvasVideoPreview=null;this._canvasVideo.getContext("2d");this._recordedChunks=[];try{this._mediaRecorder=new MediaRecorder(this._canvasVideo.captureStream(),{mimeType:this.mimeType})}catch(e){try{this._mediaRecorder=new MediaRecorder(this._canvasVideo.captureStream())}catch(e){return alert("Unable to create MediaRecorder with options Object: "+e),void console.log("Unable to create MediaRecorder with options Object: ",e)}}console.log("Created MediaRecorder",this._mediaRecorder,"with options",{mimeType:this.mimeType}),t.memoryLog("Video recording",!0),this._mediaRecorder.start(),this._mediaRecorder.pause(),this._mediaRecorder.onstop=function(e){console.log("Recorder stopped: ",e)};var e=this;this._mediaRecorder.ondataavailable=function(t){var r=!1;t.data&&e._recordedChunks&&(e._acceptZeroSizedChunks||t.data.size)&&(r=!0,e._recordedChunks.push(t.data),e._mediaRecorder&&e._mediaRecorder.pause()),e.cb&&e.cb(r)},console.log("MediaRecorder started",this._mediaRecorder)}else console.log("MediaRecorder api is not supported by your web brower")},_makeConstantFrameTimeCode:function(e,t,r,n){if(!(e instanceof Array))return console.error("unexpected video stream, cant apply algorithm on it"),void r(null);var i,a,o=function(){var e=i[a];if(128&e)return++a,t=127&e;if(64&e){var t=16383&(e<<8|i[a+1]);return a+=2,t}if(32&e){t=2097151&(i[a]<<16|i[a+1]<<8|i[a+2]);return a+=3,t}if(16&e){t=268435455&(i[a]<<24|i[a+1]<<16|i[a+2]<<8|i[a+3]);return a+=4,t}if(8&e){t=34359738367&(i[a]<<32|i[a+1]<<24|i[a+2]<<16|i[a+3]<<8|i[a+4]);return a+=5,t}if(4&e){t=4398046511103&(i[a]<<40|i[a+1]<<32|i[a+2]<<24|i[a+3]<<16|i[a+4]<<8|i[a+5]);return a+=6,t}if(2&e){t=562949953421311&(i[a]<<48|i[a+1]<<40|i[a+2]<<32|i[a+3]<<24|i[a+4]<<16|i[a+5]<<8|i[a+6]);return a+=7,t}if(1&e){t=72057594037927940&(i[a]<<56|i[a+1]<<48|i[a+2]<<40|i[a+3]<<32|i[a+4]<<24|i[a+5]<<16|i[a+6]<<8|i[a+7]);return a+=8,t}return console.log("Problem ..."),72057594037927940},s=new FileReader;s.onload=function(){i=new Uint8Array(this.result),a=0;for(var e=0,s=0;a<i.byteLength;){var l=o(),d=o();switch(l){case 103:for(var h=Math.round(1e3/t*e);d--;)i[a++]=h>>8*d&255;s=0;break;case 35:var c=a;o(),h=Math.round(1e3/t*s);i[a++]=h>>8,i[a++]=255&h,e++,s++,a=c,a+=d;break;case 32:c=a,o(),o(),o(),h=Math.round(1e3/t*s);i[a++]=h>>8,i[a++]=255&h,e++,s++,a=c,a+=d;break;default:72057594037927940!=d&&(a+=d)}}r&&r(new Blob([i],{type:n}))},s.readAsArrayBuffer(new Blob(e,{type:this.mimeType}))},toVideo:function(e){if("undefined"!=typeof MediaRecorder||(console.log("MediaRecorder api is not supported by your web brower"),e(null,null,null)),e){var t=this;if(localStorage?localStorage.getItem("DS_PUBLISH_VIDEO_REAL_TIME"):null){var r=new Blob(t._recordedChunks,{type:t.mimeType});e(window.URL.createObjectURL(r),r,t._canvasVideoPreview.toDataURL())}else this._makeConstantFrameTimeCode(t._recordedChunks,t._nFPS,function(r){e(window.URL.createObjectURL(r),r,t._canvasVideoPreview.toDataURL())},t.mimeType)}},stopRecording:function(){if("undefined"!=typeof MediaRecorder){if(this._mediaRecorder){var e=this._mediaRecorder;this._mediaRecorder=null,e.stop(),console.log("Recorded chunks: ",this._recordedChunks),t.memoryLog("Video recording",!1),this._canvasVideo=null,this.cb=null}}else console.log("MediaRecorder api is not supported by your web brower")},isRecording:function(){return this._mediaRecorder&&this._mediaRecorder.stream&&this._mediaRecorder.stream.active},pushImage:function(e,t){this.cb=t;var r=this._canvasVideo;if(r){var n=r;n.width=e._width,n.height=e._height;var i=n.getContext("2d"),a=i.getImageData(0,0,e._width,e._height);if(a.data.set(e._bufferRGBA),i.putImageData(a,0,0,0,0,e._width,e._height),!this._canvasVideoPreview){this._canvasVideoPreview=UWA.createElement("canvas",{class:"PreviewCanvas",width:this._resWidth+"px",height:this._resHeight+"px",styles:{zIndex:9999999,position:"absolute",top:"0px",left:"0px",pointerEvents:"none",visibility:"visible"}}),(a=(i=this._canvasVideoPreview.getContext("2d")).getImageData(0,0,e._width,e._height)).data.set(e._bufferRGBA),i.putImageData(a,0,0,0,0,e._width,e._height);var o=parseInt(e._width/2),s=parseInt(e._height/2);i.beginPath(),i.moveTo(o-30,s-40),i.lineTo(o-30,s+40),i.lineTo(o+30,s),i.closePath(),i.fillStyle="white",i.fill()}this._mediaRecorder&&(this._mediaRecorder.resume(),this._mediaRecorder&&this._mediaRecorder.requestData())}}}),n=localStorage?localStorage.getItem("DS_PUBLISH_VIDEO_DEFAULT_CODEC_WEBM"):null;return r.Codec={Webm:n?""+n:"vp9",Mkv:"vp9"},r.MimeType={Webm:"video/x-matroska",Mkv:"video/x-matroska"},r.Type={Webm:1,Mkv:2},r}),define("DS/VCXWebKernelTools/VCXMeshServices",["UWA/Class","DS/Visualization/ThreeJS_DS","DS/Visualization/SceneGraphFactory","DS/Mesh/MeshUtils","DS/VCXWebKernelTools/VCXEnums"],function(e,t,r,n,i){"use strict";var a=e.singleton({init:function(){this.sharing=!1,this.optimized=!1,this._primitives=[null,null,null,null,null,null,null,null,null,null]},allocIndexationArray:function(e,t){return t&&t<65536?new Uint16Array(e):new Uint32Array(e)},getPrimitiveMeshNode:function(e){var n=null;switch(e){case i.PrimitiveType.Line:null===this._primitives[e]&&(this._primitives[e]=r.createLineNode({points:[new t.Vector3(0,0,0),new t.Vector3(0,0,1)]})),n=this._primitives[e];break;case i.PrimitiveType.Disc:null===this._primitives[e]&&(this._primitives[e]=r.createCircleNode({radius:1,segments:32,fill:!0,startAngle:0,endAngle:2*Math.PI})),n=this._primitives[e];break;case i.PrimitiveType.Square:if(null===this._primitives[e]){this._primitives[e]=r.createRectangleNode({width:1,height:1,fill:!0});var a=this._primitives[e].getMatrix();a.setPosition({x:-.5,y:-.5,z:0}),this._primitives[e].setMatrix(a)}n=this._primitives[e];break;case i.PrimitiveType.Cube:null===this._primitives[e]&&(this._primitives[e]=r.createCuboidNode({cornerPoint:new t.Vector3(-.5,-.5,-.5),firstAxis:new t.Vector3(1,0,0),secondAxis:new t.Vector3(0,1,0),thirdAxis:new t.Vector3(0,0,1)})),n=this._primitives[e];break;case i.PrimitiveType.Sphere:null===this._primitives[e]&&(this._primitives[e]=r.createSphereNode({radius:1})),n=this._primitives[e];break;case i.PrimitiveType.Cylinder:null===this._primitives[e]&&(this._primitives[e]=r.createCylinderNode({bottomCenterPoint:new t.Vector3(0,0,-1),topCenterPoint:new t.Vector3(0,0,1),radius:1})),n=this._primitives[e];break;case i.PrimitiveType.Cone:null===this._primitives[e]&&(this._primitives[e]=r.createConeNode({bottomCenterPoint:new t.Vector3(0,0,-1),topCenterPoint:new t.Vector3(0,0,1),bottomRadius:1,topRadius:0})),n=this._primitives[e];break;default:n=null}return n},computeSmoothNormalsTrianglesSet:function(e,t){if(!e||!t)return null;t.length%3!=0&&console.error("VCXMeshServices : Invalid data for mesh set node");var r=new Float32Array(e.length);r.fill&&r.fill(0,0,e.length);for(var n=t.length/3,i=0;i<n;++i){var a=3*t[3*i],o=3*t[3*i+1],s=3*t[3*i+2],l={x:e[a],y:e[a+1],z:e[a+2]},d={x:e[o],y:e[o+1],z:e[o+2]},h={x:e[s],y:e[s+1],z:e[s+2]},c={x:d.x-l.x,y:d.y-l.y,z:d.z-l.z},f={x:h.x-l.x,y:h.y-l.y,z:h.z-l.z},u={x:c.y*f.z-c.z*f.y,y:c.z*f.x-c.x*f.z,z:c.x*f.y-c.y*f.x};r[a]+=u.x,r[a+1]+=u.y,r[a+2]+=u.z,r[o]+=u.x,r[o+1]+=u.y,r[o+2]+=u.z,r[s]+=u.x,r[s+1]+=u.y,r[s+2]+=u.z}for(i=0;i<e.length;i+=3){u={x:r[i],y:r[i+1],z:r[i+2]};var p=Math.sqrt(u.x*u.x+u.y*u.y+u.z*u.z);r[i]=u.x/p,r[i+1]=u.y/p,r[i+2]=u.z/p}return r},computeSmoothNormalsStripSet:function(e,t,r){if(!e||!t)return null;var n=new Float32Array(e.length);n.fill&&n.fill(0,0,e.length);for(var i=0,a=r.length,o=0;o<a;++o){for(var s=r[o],l=0;l<s-2;++l){var d=3*t[i+l],h=3*t[i+l+1],c=3*t[i+l+2],f={x:e[d],y:e[d+1],z:e[d+2]};if(1&l)var u={x:e[h],y:e[h+1],z:e[h+2]},p={x:e[c],y:e[c+1],z:e[c+2]};else p={x:e[h],y:e[h+1],z:e[h+2]},u={x:e[c],y:e[c+1],z:e[c+2]};var m={x:p.x-f.x,y:p.y-f.y,z:p.z-f.z},g={x:u.x-f.x,y:u.y-f.y,z:u.z-f.z},v={x:m.y*g.z-m.z*g.y,y:m.z*g.x-m.x*g.z,z:m.x*g.y-m.y*g.x};n[d]+=v.x,n[d+1]+=v.y,n[d+2]+=v.z,n[h]+=v.x,n[h+1]+=v.y,n[h+2]+=v.z,n[c]+=v.x,n[c+1]+=v.y,n[c+2]+=v.z}i+=s}e.length%3!=0&&console.error("VCXMeshServices : Invalid data for mesh set node");for(l=0;l<e.length;l+=3){v={x:n[l],y:n[l+1],z:n[l+2]};var y=Math.sqrt(v.x*v.x+v.y*v.y+v.z*v.z);n[l]=v.x/y,n[l+1]=v.y/y,n[l+2]=v.z/y}return n},buildIndexationFromStripSet:function(e,t,r,i,a){var o=null;switch(e){case n.ConnectivityTypeEnum.TRIANGLE_STRIP:for(var s=0,l=0;l<t;++l)s+=i[l]-2;o=this.allocIndexationArray(3*s,a.length/3);var d=0,h=0;for(l=0;l<t;++l){for(var c=i[l],f=0;f<c-2;++f)o[d++]=r[h+f],1&f?(o[d++]=r[h+f+2],o[d++]=r[h+f+1]):(o[d++]=r[h+f+1],o[d++]=r[h+f+2]);h+=c}break;case n.ConnectivityTypeEnum.LINE_STRIP:var u=0;for(l=0;l<t;++l)u+=i[l]-1;o=new Uint32Array(2*u);for(d=0,h=0,l=0;l<t;++l){for(c=i[l],f=0;f<c-1;++f)o[d++]=r[h+f],o[d++]=r[h+f+1];h+=c}break;default:console.warn("Unknown strip set, can't build indexation")}return o},buildIndexedTriangleSet:function(e,t,i,a,o,s,l,d,h,c,f){if(null===t||null===i||null===o||null===s)return console.error("VCXMeshServices : Invalid data for mesh node"),null;if(t.length%3!=0)return console.error("VCXMeshServices : Invalid data for mesh set node"),null;var u=a?a.length/2:null;if(o.length!==s.length)return console.error("VCXMeshServices : Invalid data for mesh node"),null;var p=null===d?new n.PrimitiveGroup:new n.PrimitiveGroup({fillGAS:new n.FillAttributes(d,c?1:0)});this.sharing&&(p.sharing=!0),this.optimized&&(p.optimized=!0);var m,g,v=0,y=new n.Buffer({component:n.VertexComponentEnum.POSITION,dimension:3,data:t});p.addBuffer(m=v++,y);var w,b,x=new n.Buffer({component:n.VertexComponentEnum.NORMAL,dimension:3,data:i});if(p.addBuffer(g=v++,x),a&&3*a.length==2*t.length){var A=new n.Buffer({component:n.VertexComponentEnum.TEX_COORD_0,dimension:2,data:new Float32Array(3*u)});A.data[0]=a[0];for(var _=1,T=1;T<a.length;T++)A.data[_++]=a[T],T%2&&(A.data[_++]=0);p.addBuffer(w=v++,A)}var C=null;if(o instanceof Uint8Array||o instanceof Uint16Array||o instanceof Uint32Array)C=o;else{console.warn("Buffer indexation should be Uint8Array, Uint16Array or Uint32Array"),C=this.allocIndexationArray(o.length,t.length/3);for(var I=0;I<o.length;I++)C[I]=o[I]}var V,B,M=new n.Buffer({indexBuffer:!0,dimension:1,data:C});if(p.addBuffer(b=v++,M),f)V=b;else{var S=null;if(s instanceof Uint8Array||s instanceof Uint16Array||s instanceof Uint32Array)S=s;else{console.warn("Buffer indexation should be Uint8Array, Uint16Array or Uint32Array"),S=this.allocIndexationArray(s.length,i.length/3);for(I=0;I<s.length;I++)S[I]=s[I]}var R=new n.Buffer({indexBuffer:!0,dimension:1,data:S});p.addBuffer(V=v++,R)}if(f)B=b;else if(l){var G=null;if(l instanceof Uint8Array||l instanceof Uint16Array||l instanceof Uint32Array)G=l;else{console.warn("Buffer indexation should be Uint8Array, Uint16Array or Uint32Array"),G=this.allocIndexationArray(l.length,a.length/2);for(I=0;I<l.length;I++)G[I]=l[I]}var U=new n.Buffer({indexBuffer:!0,dimension:1,data:l});p.addBuffer(B=v++,U)}var P=null===d?new n.Primitive:new n.Primitive({fillGAS:new n.FillAttributes(d,c?1:0)});P.geomType="FACE",P.nbIndices=o.length,P.connectivity=n.ConnectivityTypeEnum.TRIANGLES;var z=new n.VertexComponent;z.nbVertices=t.length,z.bufferId=m,z.indices=new n.IndexArray,z.indices.bufferId=b,z.indices.offset=0,P.addVertexComponent(z);var E=new n.VertexComponent;if(E.nbVertices=i.length,E.bufferId=g,E.indices=new n.IndexArray,E.indices.bufferId=V,E.indices.offset=0,P.addVertexComponent(E),a){var k=new n.VertexComponent;k.nbVertices=a.length,k.bufferId=w,k.indices=new n.IndexArray,k.indices.bufferId=B,k.indices.offset=0}return p.addPrimitive(P),r.createMeshNode(p,h,0,"mono")},buildMonoIndexedTriangleStripSet:function(e,t,i,a,o,s,l,d,h){if(null===t||null===i||null===o)return console.error("VCXMeshServices : Invalid data for mesh node"),null;if(t.length%3!=0)return console.error("VCXMeshServices : Invalid data for mesh set node"),null;var c=t.length/3,f=null===l?new n.PrimitiveGroup:new n.PrimitiveGroup({fillGAS:new n.FillAttributes(l,h?1:0)});this.sharing&&(f.sharing=!0),this.optimized&&(f.optimized=!0);var u=new n.Buffer({component:n.VertexComponentEnum.POSITION,data:t});f.addBuffer(0,u);var p=new n.Buffer({component:n.VertexComponentEnum.NORMAL,data:i});f.addBuffer(1,p);if(a&&3*a.length==2*t.length){var m=new n.Buffer({component:n.VertexComponentEnum.TEX_COORD_0,data:new Float32Array(3*c)}),g=0;m.data[0]=a[0];for(var v=0;v<a.length;v++)m.data[g++]=a[v],v%2&&(m.data[g++]=0);f.addBuffer(2,m)}var y=new n.Buffer({indexBuffer:!0,data:o});f.addBuffer(3,y);for(var w=0,b=0;b<e;b++){var x=new n.Primitive;x.nbIndices=s[b],x.connectivity=n.ConnectivityTypeEnum.TRIANGLE_STRIP;var A=new n.VertexComponent;A.nbVertices=s[b],A.bufferId=0,A.indices=new n.IndexArray,A.indices.bufferId=3,A.indices.offset=w,x.addVertexComponent(A);var _=new n.VertexComponent;if(_.nbVertices=s[b],_.bufferId=1,_.indices=new n.IndexArray,_.indices.bufferId=3,_.indices.offset=w,x.addVertexComponent(_),a){var T=new n.VertexComponent;T.nbVertices=s[b],T.bufferId=2,T.indices=new n.IndexArray,T.indices.bufferId=3,T.indices.offset=w,x.addVertexComponent(T)}f.addPrimitive(x),w+=s[b]}return null===d?r.createMeshNode(f):r.createMeshNode(f,d)},buildIndexedLineSet:function(e,t,i,a,o,s){var l=new n.PrimitiveGroup({lineGAS:new n.LineAttributes(i||new n.Color(1,1,1,1),a||1)});this.sharing&&(l.sharing=!0),this.optimized&&(l.optimized=!0);var d=new n.Primitive;d.nbIndices=t.length,d.connectivity=n.ConnectivityTypeEnum.LINES,d.geomType=o;var h=new n.Buffer({component:n.VertexComponentEnum.POSITION,data:e});l.addBuffer(0,h);var c=new n.Buffer({indexBuffer:!0,data:t});l.addBuffer(1,c);var f=new n.VertexComponent;return f.nbVertices=e.length,f.bufferId=0,f.indices=new n.IndexArray,f.indices.bufferId=1,f.indices.offset=0,d.addVertexComponent(f),l.addPrimitive(d),null===s?r.createMeshNode(l):r.createMeshNode(l,s)},buildLineStripSet:function(e,t,i,a,o,s,l){if(null===e||null===t.length||null===i)return console.error("VCXMeshServices : Invalid data for line set node"),null;var d=new n.PrimitiveGroup({lineGAS:new n.LineAttributes(a||new n.Color(1,1,1,1),o||1)});this.sharing&&(d.sharing=!0);var h=new n.Buffer({component:n.VertexComponentEnum.POSITION,data:e});d.addBuffer(0,h);var c=new n.Buffer({indexBuffer:!0,data:i});d.addBuffer(1,c);for(var f=0,u=0;u<t.length;u++){var p=new n.Primitive;p.nbIndices=t[u],p.connectivity=n.ConnectivityTypeEnum.LINE_STRIP,s&&(p.geomType=s);var m=new n.VertexComponent;m.nbVertices=t[u],m.bufferId=0,m.indices=new n.IndexArray,m.indices.bufferId=1,m.indices.offset=f,p.addVertexComponent(m),d.addPrimitive(p),f+=t[u]}return null===l?r.createMeshNode(d):r.createMeshNode(d,l)},buildLine:function(e,t,r,n,i){if(null===e)return console.error("VCXMeshServices : Invalid data for line set node"),null;if(e.length%3!=0)return console.error("VCXMeshServices : Invalid data for line set node"),null;for(var a=e.length/3,o=[],s=0;s<a;s++)o[s]=s;return this.buildLineStripSet(e,[a],o,i,n)},buildPointSet:function(e,t,i,a,o){if(null===e||null===t)return console.error("VCXMeshServices : Invalid data for point set node"),null;if(e.length%3!=0)return console.error("VCXMeshServices : Invalid data for point set node"),null;var s=e.length/3,l=new n.PrimitiveGroup({pointGAS:new n.PointAttributes(i||new n.Color(1,1,1,1),a||1)});this.sharing&&(l.sharing=!0);var d=new n.Buffer({component:n.VertexComponentEnum.POSITION,data:e});l.addBuffer(0,d);var h=new n.Buffer({indexBuffer:!0,data:t});l.addBuffer(1,h);for(var c=0;c<s;c++){var f=new n.Primitive;f.nbIndices=1,f.connectivity=n.ConnectivityTypeEnum.POINTS;var u=new n.VertexComponent;u.nbVertices=1,u.bufferId=0,u.indices=new n.IndexArray,u.indices.bufferId=1,u.indices.offset=c,f.addVertexComponent(u),l.addPrimitive(f)}return null===o?r.createMeshNode(l):r.createMeshNode(l,o)},buildPoint:function(e,t,r,n){var i=new Float32Array(3);i[0]=e[0],i[1]=e[1],i[2]=e[2];var a=new Uint8Array(1);return a[0]=0,this.buildPointSet(i,a,t,r,n)},buildIndexation:function(e,t,r,n){if(!(e&&t&&r&&n))return null;for(var i=[],o=0,s=0,l=0;l<t.length;l++){if(r[l]===a.IndexationType.TrianglesSet)for(var d=s+t[l],h=s;h<d;h++)i[o++]=n[h];else if(r[l]===a.IndexationType.TrianglesStripSet){d=s+t[l]-2;var c=!0;for(h=s;h<d;h++)i[o++]=n[h],c?(i[o++]=n[h+1],i[o++]=n[h+2],c=!1):(i[o++]=n[h+2],i[o++]=n[h+1],c=!0)}else if(r[l]===a.IndexationType.FanSet){d=s+t[l]-1;var f=n[s];for(h=s+1;h<d;h++)i[o++]=f,i[o++]=n[h],i[o++]=n[h+1]}s+=t[l]}for(var u=this.allocIndexationArray(i.length,e.length/3),p=0;p<i.length;++p)u[p]=i[p];return u},packIndexation:function(e,t){if(null===t||null===e||0===t.length)return null;for(var r=new Map,n=this.allocIndexationArray(t.length,e.length/3),i=0,a=0;a<t.length;a++){i<t[a]&&(i=t[a]);var o=e[p=3*t[a]]+"_"+e[p+1]+"_"+e[p+2],s=r.get(o);void 0!==s?n[a]=s:(r.set(o,t[a]),n[a]=t[a])}r=null,i+=1;for(var l=this.allocIndexationArray(i,e.length/3),d=0;d<i;++d)l[d]=!1;for(d=0;d<n.length;d++)l[n[d]]=!0;for(var h=0,c=new Map,f=0;f<i;f++)l[f]&&c.set(f,h++);var u=new Float32Array(3*c.size);h=0;for(var p=0;p<i;p++)if(l[p]){var m=3*p;u[h++]=e[m],u[h++]=e[m+1],u[h++]=e[m+2]}l=null;for(var g=this.allocIndexationArray(n.length,e.length/3),v=0;v<n.length;v++){m=c.get(n[v]);g[v]=m}return c=null,n=null,{pIndexation:g,pCoord:u}},packIndexationUv:function(e,t){if(null===t||null===e||0===t.length)return null;for(var r=new Map,n=[],i=0,a=0;a<t.length;a++){i<t[a]&&(i=t[a]);var o=e[p=2*t[a]]+"_"+e[p+1],s=r.get(o);void 0!==s?n[a]=s:(r.set(o,t[a]),n[a]=t[a])}i+=1;for(var l=[],d=0;d<i;++d)l[d]=!1;for(d=0;d<n.length;d++)l[n[d]]=!0;for(var h=0,c=new Map,f=0;f<i;f++)l[f]&&c.set(f,h++);var u=[];h=0;for(var p=0;p<i;p++)if(l[p]){var m=2*p;u[h++]=e[m],u[h++]=e[m+1]}for(var g=[],v=0;v<n.length;v++){m=c.get(n[v]);g[v]=m}return{pIndexation:g,pCoord:u}},packIndexationMono:function(e,t,r,n){if(null===n||null===e||0===n.length)return null;for(var i=new Map,a=Math.max(Math.max(e.length/3,t.length/3),r?r.length/2:0),o=this.allocIndexationArray(n.length,a),s=0,l=0;l<n.length;l++){s<n[l]&&(s=n[l]);var d=e[b=3*n[l]]+"_"+e[b+1]+"_"+e[b+2];if(t&&t.length&&(d+=t[b]+"_"+t[b+1]+"_"+t[b+2]),r&&r.length){var h=2*n[l];d+=r[h]+"_"+r[h+1]}var c=i.get(d);void 0!==c?o[l]=c:(i.set(d,n[l]),o[l]=n[l])}i=null,s+=1;for(var f=this.allocIndexationArray(s,a),u=0;u<s;++u)f[u]=!1;for(u=0;u<o.length;u++)f[o[u]]=!0;for(var p=0,m=new Map,g=0;g<s;g++)f[g]&&m.set(g,p++);for(var v=new Float32Array(3*m.size),y=new Float32Array(t&&t.length?3*m.size:0),w=new Float32Array(r&&r.length?3*m.size:0),b=(p=0,0);b<s;b++)if(f[b]){var x=3*b;v[p++]=e[x],v[p++]=e[x+1],v[p++]=e[x+2]}if(t&&t.length){p=0;for(b=0;b<s;b++)if(f[b]){x=3*b;y[p++]=t[x],y[p++]=t[x+1],y[p++]=t[x+2]}}if(r&&r.length){p=0;for(b=0;b<s;b++)if(f[b]){x=2*b;w[p++]=r[x],w[p++]=r[x+1]}}f=null;for(var A=this.allocIndexationArray(o.length,a),_=0;_<o.length;_++){x=m.get(o[_]);A[_]=x}return i=null,o=null,{pIndexation:A,pCoord:v,pNormals:y,pUv:w}},mergeGeosets:function(e){if(!e||0===e.length)return null;var t,i,a,o,s,l,d=null;if(1===e.length&&null!==e[0]){var h=e[0];switch(h.meshType){case n.ConnectivityTypeEnum.TRIANGLES:d=this.buildIndexedTriangleSet(h.nTriangles,h.vertexArray,h.normalsArray,h.uvArray,h.vertexIndexArray,h.normalsIndexArray,h.uvIndexArray,h.colorRGBA,h.material,h.isSolid,h.uniqueIndexation);break;case n.ConnectivityTypeEnum.TRIANGLE_STRIP:!0===h.uniqueIndexation&&(d=this.buildMonoIndexedTriangleStripSet(h.nStrips,h.vertexArray,h.normalsArray,h.uvArray,h.vertexIndexArray,h.lengthsArray,h.colorRGBA,h.material,h.isSolid));break;case n.ConnectivityTypeEnum.LINES:d=this.buildIndexedLineSet(h.vertexArray,h.vertexIndexArray,h.colorRGBA,h.thickness,h.edgeType,h.material);break;case n.ConnectivityTypeEnum.LINE_STRIP:d=this.buildLineStripSet(h.vertexArray,h.lengthsArray,h.vertexIndexArray,h.colorRGBA,h.thickness,h.edgeType,h.material)}if(d)return d}t=i=a=o=s=l=0;for(var c=0;c<e.length;++c){(te=e[c]).vertexArray&&(t+=te.vertexArray.length),te.normalsArray&&(i+=te.normalsArray.length),te.uvArray&&(a+=te.uvArray.length),te.vertexIndexArray&&(o+=te.vertexIndexArray.length),te.normalsIndexArray?s+=te.normalsIndexArray.length:s+=te.vertexIndexArray.length,te.uvIndexArray?l+=te.uvIndexArray.length:l+=te.vertexIndexArray.length}var f,u,p,m,g,v,y=new Float32Array(t),w=new Float32Array(i),b=a?new Float32Array(a):null,x=this.allocIndexationArray(o,t/3),A=this.allocIndexationArray(s,i/3),_=a?this.allocIndexationArray(l,a/2):null,T=!0,C=!0;f=u=p=m=g=v=0;for(c=0;c<e.length;++c){var I=f/3,V=u/3,B=p/3;if((te=e[c]).vertexArray)for(var M=0;M<te.vertexArray.length;++M)y[f++]=te.vertexArray[M];if(te.normalsArray)for(M=0;M<te.normalsArray.length;++M)w[u++]=te.normalsArray[M];if(te.uvArray&&b)for(M=0;M<te.uvArray.length;++M)b[p++]=te.uvArray[M];if(null!==te.vertexIndexArray)for(M=0;M<te.vertexIndexArray.length;++M)x[m++]=te.vertexIndexArray[M]+I;if(null!==te.normalsIndexArray)for(var S=0;S<te.normalsIndexArray.length;++S)A[g++]=te.normalsIndexArray[S]+V;else for(S=0;S<te.vertexIndexArray.length;++S)A[g++]=te.vertexIndexArray[S]+V;if(null!==te.uvIndexArray)for(var R=0;R<te.uvIndexArray.length;++R)_[v++]=te.uvIndexArray[R]+B;else if(_)for(R=0;R<te.vertexIndexArray.length;++R)_[v++]=te.vertexIndexArray[R]+B;!1===te.isSolid&&(T=!1),!1===te.uniqueIndexation&&(C=!1)}if(!0===C){var G=this.packIndexationMono(y,w,b,x);G&&(x=G.pIndexation,y=G.pCoord,w=G.pNormals,b&&(b=G.pUv),G=null,w.length&&(A=x),b&&b.length&&(_=x))}else{var U=this.packIndexation(y,x);if(U&&(y=U.pCoord,x=U.pIndexation,U=null),A.length){var P=this.packIndexation(w,A);P&&(w=P.pCoord,A=P.pIndexation,P=null)}if(_&&_.length&&b){var z=this.packIndexationUv(b,_);z&&(b=z.pCoord,_=z.pIndexation,z=null)}}var E=0,k=new n.PrimitiveGroup;this.sharing&&(k.sharing=!0),this.optimized&&(k.optimized=!0);var L,D=0;k.fillAttr=new n.FillAttributes,k.fillAttr.solid=T?1:0;var F,O,X,W,N,H=new n.Buffer({component:n.VertexComponentEnum.POSITION,dimension:3,data:y});if(k.addBuffer(L=D++,H),w.length&&A.length){var j=new n.Buffer({component:n.VertexComponentEnum.NORMAL,dimension:3,data:w});k.addBuffer(F=D++,j)}if(b&&b.length&&_.length){var q=new n.Buffer({component:n.VertexComponentEnum.TEX_COORD_0,dimension:2,data:new Float32Array(3*b.length/2)}),K=0;q.data[0]=b[0];for(R=0;R<b.length;R++)q.data[K++]=b[R],R%2&&(q.data[K++]=0);k.addBuffer(O=D++,q)}if(x.length>0){var Z=new n.Buffer({indexBuffer:!0,dimension:1,data:x});k.addBuffer(X=D++,Z)}if(C)W=X;else if(A.length>0){var Y=new n.Buffer({indexBuffer:!0,dimension:1,data:A});k.addBuffer(W=D++,Y)}if(C)N=X;else if(_&&_.length>0){var J=new n.Buffer({indexBuffer:!0,dimension:1,data:_});k.addBuffer(N=D++,J)}var Q=0,$=0,ee=0;for(c=0;c<e.length;++c){var te;switch((te=e[c]).meshType){case n.ConnectivityTypeEnum.TRIANGLES:var re=null===te.colorRGBA?new n.Primitive:new n.Primitive({fillGAS:new n.FillAttributes(te.colorRGBA,T?1:0)});if(re.geomType="FACE",re.nbIndices=te.vertexIndexArray.length,re.connectivity=n.ConnectivityTypeEnum.TRIANGLES,(le=new n.VertexComponent).nbVertices=y.length,le.bufferId=L,le.indices=new n.IndexArray,le.indices.bufferId=X,le.indices.offset=Q,re.addVertexComponent(le),w.length)(ie=new n.VertexComponent).nbVertices=w.length,ie.bufferId=F,ie.indices=new n.IndexArray,ie.indices.bufferId=W,ie.indices.offset=$,re.addVertexComponent(ie);if(b&&b.length)(ae=new n.VertexComponent).nbVertices=b.length,ae.bufferId=O,ae.indices=new n.IndexArray,ae.indices.bufferId=N,ae.indices.offset=ee,re.addVertexComponent(ae);k.addPrimitive(re);break;case n.ConnectivityTypeEnum.TRIANGLE_STRIP:E=0;for(var ne=0;ne<te.lengthsArray.length;ne++){var ie,ae,oe=null===te.colorRGBA?new n.Primitive:new n.Primitive({fillGAS:new n.FillAttributes(te.colorRGBA,T?1:0)});if(oe.geomType="FACE",oe.nbIndices=te.lengthsArray[ne],oe.connectivity=n.ConnectivityTypeEnum.TRIANGLE_STRIP,(le=new n.VertexComponent).nbVertices=te.lengthsArray[ne],le.bufferId=L,le.indices=new n.IndexArray,le.indices.bufferId=X,le.indices.offset=Q+E,oe.addVertexComponent(le),null!==te.normalsIndexArray&&te.normalsIndexArray.length)(ie=new n.VertexComponent).nbVertices=te.lengthsArray[ne],ie.bufferId=F,ie.indices=new n.IndexArray,ie.indices.bufferId=W,ie.indices.offset=$+E,oe.addVertexComponent(ie);if(te.uvIndexArray&&te.uvIndexArray.length)(ae=new n.VertexComponent).nbVertices=te.lengthsArray[ne],ae.bufferId=O,ae.indices=new n.IndexArray,ae.indices.bufferId=N,ae.indices.offset=ee+E,oe.addVertexComponent(ae);k.addPrimitive(oe),E+=te.lengthsArray[ne]}break;case n.ConnectivityTypeEnum.LINES:(se=new n.Primitive({lineGAS:new n.LineAttributes(te.colorRGBA?te.colorRGBA:new n.Color(1,1,1,1),te.thickness?te.thickness:1)})).nbIndices=te.vertexIndexArray.length,se.connectivity=n.ConnectivityTypeEnum.LINES,se.geomType=te.edgeType,(le=new n.VertexComponent).nbVertices=y.length,le.bufferId=L,le.indices=new n.IndexArray,le.indices.bufferId=X,le.indices.offset=Q,se.addVertexComponent(le),k.addPrimitive(se);break;case n.ConnectivityTypeEnum.LINE_STRIP:for(E=0,ne=0;ne<te.lengthsArray.length;ne++){var se,le;(se=new n.Primitive({lineGAS:new n.LineAttributes(te.colorRGBA?te.colorRGBA:new n.Color(1,1,1,1),te.thickness?te.thickness:1)})).nbIndices=te.lengthsArray[ne],se.connectivity=n.ConnectivityTypeEnum.LINE_STRIP,se.geomType=te.edgeType,(le=new n.VertexComponent).nbVertices=te.lengthsArray[ne],le.bufferId=L,le.indices=new n.IndexArray,le.indices.bufferId=X,le.indices.offset=Q+E,se.addVertexComponent(le),k.addPrimitive(se),E+=te.lengthsArray[ne]}break;case n.ConnectivityTypeEnum.POINTS:console.log("Merge geosets error : Point geometry type - to be implemented");break;default:console.log("Merge geosets error : unknown geometry type")}null!==te.vertexIndexArray&&(Q+=te.vertexIndexArray.length),null!==te.normalsIndexArray&&($+=te.normalsIndexArray.length),te.uvIndexArray&&(ee+=te.uvIndexArray.length)}return C?r.createMeshNode(k,void 0,0,"mono"):r.createMeshNode(k)}});return a.IndexationType={TrianglesSet:0,TrianglesStripSet:1,FanSet:2},a}),define("DS/VCXWebKernelTools/VCXFileServices",["UWA/Class","DS/WebappsUtils/WebappsUtils","DS/ZipJS/zip-fs","DS/VCXWebKernelTools/VCXMimeTypeServices"],function(e,t,r,n){"use strict";var i=function(e){var t=e.substr(e.lastIndexOf("."));if(t)return n.GetMimeType(t)},a=e.singleton({init:function(){},GetObjectTypeOptions:function(){},PFileReadAs:function(e,t){var r=new FileReader;return new UWA.Promise((n,i)=>{r.onerror=(()=>{r.abort(),i(new Error("Problem parsing input file. "+e))}),r.onload=(e=>{n(r.result)}),r["readAs"+t](e)})},PExtractFromArchiveData:function(e,n){var a=e.slice(0,3),o=new Uint8Array(a),s=null;if(83===o[0]&&77===o[1]&&71===o[2]){var l=e.byteLength;s=new DataView(e.slice(3,l))}else s=new DataView(e);for(var d=new Uint8Array(s.byteLength),h=0;h<d.length;h++)d[h]=s.getUint8(h);var c=new Blob([d],{type:"application/x-gzip"}),f=new r.fs.FS;r.workerScriptsPath=t.getWebappsBaseUrl()+"ZipJS/";var u=UWA.Promise.deferred();return f.importBlob(c,()=>{var e=new Map,t=[];if(n)for(var r=0;r<n.length;r++){var a=f.find(n[r]);if(UWA.is(a.name))a.name.toLowerCase(),t.push(a)}else for(r=0;r<f.entries.length;r++){a=f.entries[r];if(UWA.is(a.name))a.name.toLowerCase(),t.push(a)}var o=0,s=()=>{var r=r=>{return n=>{r=r.toLowerCase(),e.set(r,n),o>10&&console.warn("Warning : nbWorkersRunning > nbWorkersMax"),o--,t.length>0?s():0===o?u.resolve(e):o<0&&(console.warn("Warning : nbWorkersRunning < 0"),u.resolve(e))}},n=[];if(o<2)for(var a=0;a<t.length&&o<10;a++){var l=t[a].name;if(!e.get(l.toLowerCase())){var d;"octet-binary"===(d=i(l))&&console.warn("Warning : unknown resource file type"),o++,t[a].getBlob(d,r(l)),n.push(t[a])}}if(n.length>0)for(var h=0;h<n.length;h++)t.splice(t.indexOf(n[h]),1)};s()},e=>{u.reject(new Error(e))}),u.promise},ExtractFromArchiveData:function(e,n,a,o){var s=e.slice(0,3),l=new Uint8Array(s),d=null;if(83===l[0]&&77===l[1]&&71===l[2]){var h=e.byteLength;d=new DataView(e.slice(3,h))}else d=new DataView(e);for(var c=new Uint8Array(d.byteLength),f=0;f<c.length;f++)c[f]=d.getUint8(f);var u=new Blob([c],{type:"application/x-gzip"}),p=new r.fs.FS;r.workerScriptsPath=t.getWebappsBaseUrl()+"ZipJS/",p.importBlob(u,()=>{var e=new Map,t=[];if(o)for(var r=0;r<o.length;r++){var s=p.find(o[r]);if(UWA.is(s.name))s.name.toLowerCase(),t.push(s)}else for(r=0;r<p.entries.length;r++){s=p.entries[r];if(UWA.is(s.name))s.name.toLowerCase(),t.push(s)}var l=0,d=()=>{var r=r=>{return i=>{r=r.toLowerCase(),e.set(r,i),l>10&&console.warn("Warning : nbWorkersRunning > nbWorkersMax"),l--,t.length>0?d():0===l?(n(e),n=null,a=null):l<0&&(console.warn("Warning : nbWorkersRunning < 0"),n(e),n=null,a=null)}},o=[];if(l<2)for(var s=0;s<t.length&&l<10;s++){var h=t[s].name;if(!e.get(h.toLowerCase())){var c;"octet-binary"===(c=i(h))&&console.warn("Warning : unknown resource file type"),l++,t[s].getBlob(c,r(h)),o.push(t[s])}}if(o.length>0)for(var f=0;f<o.length;f++)t.splice(t.indexOf(o[f]),1)};d()},e=>{a(e),n=null,a=null})},ExtractFromArchive:function(e,t,r,n){var i=new FileReader;i.onload=(e=>{a.ExtractFromArchiveData(e.target.result,t,r,n)}),i.readAsArrayBuffer(e)},BlobURLToBase64:function(e,t,r,n,i){var a=new XMLHttpRequest;a.open("GET",e,!0),a.responseType="blob",a.addEventListener("error",e=>{r(null,n)}),a.onload=(e=>{if(200===a.status){var t=new FileReader;t.onload=(()=>{r(t.result,n)}),t.readAsDataURL(a.response)}else 404===a.status&&i&&r(null,n)}),a.send()},BlobURLToJSONText:function(e,t,r){var n=r,i=new XMLHttpRequest;i.open("GET",e,!0),i.responseType="blob",i.onload=(e=>{if(200===i.status){var r=i.response,a=new FileReader;a.onload=(()=>{var e=a.result,r=JSON.parse(e);n?t.call(n,r):t(r)}),a.readAsText(r)}}),i.send()},PBlobURLToJSONText:function(e,t){var r=UWA.Promise.deferred(),n=new XMLHttpRequest;return n.open("GET",e,!0),n.responseType="blob",n.onload=(e=>{if(200===n.status){var t=n.response,i=new FileReader;i.onload=(()=>{var e=i.result,t=JSON.parse(e);r.resolve(t)}),i.readAsText(t)}}),n.send(),r.promise},BlobURLToText:function(e,t,r){var n=new XMLHttpRequest;n.open("GET",e,!0),n.responseType="blob",n.onload=(e=>{if(200===n.status){var i=n.response,a=new FileReader;a.onload=(()=>{var e=a.result;t(e)}),a.readAsText(i)}else 404===n.status&&r&&r()}),n.send()},dataURLToBlob:function(e,t){if(e){if(-1===e.indexOf(";base64,")){var r,n=(a=e.split(","))[0].split(":")[1],i=decodeURIComponent(a[1]);return(r=new Blob([i],{type:n})).name=t,r}n=(a=e.split(";base64,"))[0].split(":")[1];for(var a,o=(i=window.atob(a[1])).length,s=new Uint8Array(o),l=0;l<o;++l)s[l]=i.charCodeAt(l);return(r=new Blob([s],{type:n})).name=t,r}console.warn("VCXFileServices: dataURL is empty.")},dataURLToFile:function(e,t){if(e){if(-1===e.indexOf(";base64,")){var r=(i=e.split(","))[0].split(":")[1],n=decodeURIComponent(i[1]);return new File([n],t,{type:r})}r=(i=e.split(";base64,"))[0].split(":")[1];for(var i,a=(n=window.atob(i[1])).length,o=new Uint8Array(a),s=0;s<a;++s)o[s]=n.charCodeAt(s);return new File([o],{type:r})}console.warn("VCXFileServices: dataURL is empty.")},BlobURLToBlob:function(e,t,r){try{var n=new XMLHttpRequest;n.addEventListener("error",n=>{var i=500+500*Math.random();console.warn("BlobURLToBlob Error: "+e+" (retry in "+i+" ms)"),window.setTimeout(()=>{console.warn("BlobURLToBlob retrying "+e),this.BlobURLToBlob(e,t,r)},i)}),n.onreadystatechange=(()=>{4==n.readyState&&n.status}),n.open("GET",e,!0),n.responseType="blob",n.onload=(e=>{if(200===n.status){var t=n.response;r(t)}else console.warn("BlobURLToBlob FAILED")}),n.send()}catch(e){console.error(e),console.log("BlobURLToBlob catch")}},PBlobURLToBlob:function(e,t){var r=UWA.Promise.deferred();try{var n=new XMLHttpRequest;n.addEventListener("error",n=>{var i=500+500*Math.random();console.warn("PBlobURLToBlob Error: "+e+" (retry in "+i+" ms)"),window.setTimeout(()=>{console.warn("PBlobURLToBlob retrying "+e),r.resolve(this.PBlobURLToBlob(e,t))},i)}),n.onreadystatechange=(()=>{4==n.readyState&&n.status}),n.open("GET",e,!0),n.responseType="blob",n.onload=(e=>{if(200===n.status){var t=n.response;r.resolve(t)}else r.reject(new Error("PBlobURLToBlob FAILED"))}),n.send()}catch(e){r.reject(new Error("PBlobURLToBlob catch "+e))}return r.promise},PBlobToFileVar:function(e){var t=UWA.Promise.deferred(),r=new FileReader;return r.onload=(()=>{var e=r.result,n=JSON.parse(e);t.resolve(n)}),r.readAsText(e),t.promise},getImageSizeFromBlobUrl:function(e,t){var r=new Image,n=document.createElement("canvas").getContext("2d");r.src=e,n.drawImage(r,0,0);var i={width:0,height:0};return r.onload=(()=>{i.width=this.width,i.height=this.height,t(i)}),i}});return a}),define("DS/VCXWebKernelTools/VCXFileWriter",["UWA/Class","DS/VCXWebKernelTools/VCXFileServices"],function(e,t){"use strict";var r=window.document,n=window;return e.extend({init:function(){},getURL:function(){return n.URL||n.webkitURL||n},revoke:function(e){},saveBlobAs:function(e,t){var i=null;if(void 0!==window.navigator.msSaveBlob)window.navigator.msSaveBlob(e,t);else{var a=r.createElementNS("http://www.w3.org/1999/xhtml","a");i=this.getURL().createObjectURL(e),a.href=i,a.download=t;var o=r.createEvent("MouseEvents");o.initMouseEvent("click",!0,!1,n,0,0,0,0,0,!1,!1,!1,!1,0,null),a.dispatchEvent(o)}this.revoke(i)},saveTextToFile:function(e,t,r){var n=new Blob([e],{type:r||"text/plain;charset=utf-8"});this.saveBlobAs(n,t)},saveAs:function(e,r,n){var i=t.dataURLToBlob(e);this.saveBlobAs(i,r)},BlobURLToBase64:function(e){var t=new XMLHttpRequest;t.open("GET",e,!0),t.responseType="arraybuffer",t.onload=function(e){if(200===this.status){for(var t=new Uint8Array(this.response),r=t.length,n=new Array(r);r--;)n[r]=String.fromCharCode(t[r]);var i=n.join(""),a=window.btoa(i);return a="data:image/png;base64,"+a}},t.send()}})}),define("DS/VCXWebKernelTools/VCXPixelImageSvg",["UWA/Class","DS/VCXWebKernelTools/VCXFileServices","DS/VENWebCanvg/CanvgTools"],function(e,t,r){"use strict";return e.extend({init:function(e,t,r){this.src=e,this._preferredWidthPx=void 0!==t?t:0,this._preferredHeightPx=void 0!==r?r:0},utf8ArrayToStr:function(e){var t,r,n,i,a,o;for(t="",n=e.length,r=0;r<n;)switch((i=e[r++])>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:t+=String.fromCharCode(i);break;case 12:case 13:a=e[r++],t+=String.fromCharCode((31&i)<<6|63&a);break;case 14:a=e[r++],o=e[r++],t+=String.fromCharCode((15&i)<<12|(63&a)<<6|(63&o)<<0)}return t},setAreaToDraw:function(e,t,r,n){for(var i=e.search(/<svg/i),a=i,o=i;o<e.length;++o)if(">"===e[o]){a=o;break}var s=e.substring(0,a),l=' viewBox= "';l+=parseInt(n.x+1).toString(),l+=" ",l+=parseInt(n.y+1).toString(),l+=" ",l+=parseInt(n.width).toString(),l+=" ",l+=parseInt(n.height).toString(),l+='" ';var d=s.match(/(viewBox*)([\s=]*)([/"]*)([0-9.\s]*)([/"]*)/gi);d&&d.length?s=s.replace(d[0],l):s+=l;var h=' width= "';h+=t.toString(),h+='px" ';var c=s.match(/(width*)([\s=]*)([/"]*)([0-9a-z.\s]*)([/"]*)/gi);c&&c.length?s=s.replace(c[0],h):s+=h;var f=' height= "';f+=r.toString(),f+='px" ';var u=s.match(/(height*)([\s=]*)([/"]*)([0-9a-z.\s]*)([/"]*)/gi);return u&&u.length?s=s.replace(u[0],f):s+=f,s+=">",s+=e.substring(a+1,e.length)},renderFromDataUrl:function(e,n){var i=this,a=new FileReader;a.onload=function(e){var t=e.target.result,a=new Uint8Array(t),o=i.utf8ArrayToStr(a),s=UWA.createElement("div");s.setHTML(o),s.inject(document.body);var l=s.children[0].getBBox(),d="";d=i._preferredWidthPx&&i._preferredHeightPx?i.setAreaToDraw(o,Math.floor(i._preferredWidthPx),Math.floor(i._preferredHeightPx),l):i.setAreaToDraw(o,Math.floor(5*l.width),Math.floor(5*l.height),l),document.body.removeChild(s),s=null;var h=new Image,c="data:image/svg+xml;base64,"+btoa(d);h.onload=function(e){var t=document.createElement("canvas");t.width=h.width,t.height=h.height,t.getContext("2d").drawImage(h,0,0),void 0!==n&&n(t)},h.onerror=function(e){var t=new r,i=document.createElement("canvas");t.svgToCanvas(d,i,{ignoreMouse:!0,ignoreAnimation:!0}),void 0!==n&&n(i)},h.src=c},a.readAsArrayBuffer(t.dataURLToBlob(e))},render:function(e){if("string"==typeof this.src&&"blob"===this.src.substring(0,4)){var r=this;t.BlobURLToBase64(this.src,null,function(t,n){r.renderFromDataUrl(t,function(t){void 0!==e&&e(t)})})}else"string"==typeof this.src&&"data"===this.src.substring(0,4)&&this.renderFromDataUrl(this.src,function(t){void 0!==e&&e(t)})}})}),define("DS/VCXWebKernelTools/VCXPixelImage",["UWA/Class","DS/VCXWebProperties/VCXColor","DS/VCXWebKernelTools/VCXFileWriter","DS/VCXWebKernelTools/VCXFileServices","DS/VCXWebKernelTools/VCXPixelImageSvg"],function(e,t,r,n,i){"use strict";var a=e.extend({init:function(e,t,r,n){this._width=0,this._height=0,this._bufferRGBA=null,this._preferredWidth=0,this._preferredHeight=0,this._quality=.8,e instanceof Uint8Array?(this._width=t,this._height=r,this._bufferRGBA=new Uint8ClampedArray(e)):e instanceof ImageData?(this._width=e.width,this._height=e.height,this._bufferRGBA=new Uint8ClampedArray(e.data)):(this._width=0,this._height=0,this._bufferRGBA=null)},setPreferredSize:function(e,t){this._preferredWidth=Math.floor(e),this._preferredHeight=Math.floor(t)},setQuality:function(e){e>=0&&e<=1&&(this._quality=e)},getBytes:function(){return this._bufferRGBA},getPixelWidth:function(){return this._width},getPixelHeight:function(){return this._height},getPixelRGBA:function(e,t){var r=4*(t*this._width+e),n=this._bufferRGBA;return n||console.log("Warning : Empty image!"),n?[n[r],n[r+1],n[r+2],n[r+3]]:[0,0,0,0]},isPowerOf2:function(e){return e&&!(e&e-1)},getNearestPow2:function(e){return Math.pow(2,Math.round(Math.log(e)/Math.log(2)))},hasDimensionsPowerOf2:function(){return this.isPowerOf2(this._width)&&this.isPowerOf2(this._height)},clear:function(e,t,r,n){for(var i=4*this._width*this._height,a=0;a<i;a+=4)this._bufferRGBA[a]=e,this._bufferRGBA[a+1]=t,this._bufferRGBA[a+2]=r,this._bufferRGBA[a+3]=n},loadFromImageUsingCanvas:function(e){var t=document.createElement("canvas");t.width=e.width,t.height=e.height;var r=t.getContext("2d");r.drawImage(e,0,0);var n=r.getImageData(0,0,t.width,t.height);this._width=n.width,this._height=n.height,this._bufferRGBA=new Uint8ClampedArray(n.data)},loadFromImageDataUrl:function(e,t){var r=e.src,n=r.split(",")[0].split(":")[1].split(";")[0],a=this;switch(n){case"image/bitmap":case"image/bmp":a.loadBmpFromDataUrl(r,function(r){!0!==r&&a.loadFromImageUsingCanvas(e),void 0!==t&&t()});break;case"image/svg+xml":new i(r,a._preferredWidth,a._preferredHeight).render(function(e){a._width=e.width,a._height=e.height;var r=e.getContext("2d").getImageData(0,0,e.width,e.height);a._bufferRGBA=new Uint8ClampedArray(r.data),a.removeAreaWithAlphaZero(),void 0!==t&&t()});break;default:a.loadFromImageUsingCanvas(e),void 0!==t&&t()}},loadFromImageBlobUrl:function(e,t){var r=this;n.BlobURLToBase64(e.src,null,function(e,n){var i=new Image;i.onload=function(){r.loadFromImageDataUrl(i,function(){void 0!==t&&t()})},i.src=e})},loadFrom:function(e,t){var r=new Image,a=this,o="";r.onload=function(n){"string"==typeof e&&"blob"===e.substring(0,4)?a.loadFromImageBlobUrl(r,function(){void 0!==t&&t()}):"string"==typeof e&&"data"===e.substring(0,4)&&a.loadFromImageDataUrl(r,function(){void 0!==t&&t()})},r.onerror=function(r){"image/svg+xml"===o?new i(e,a._preferredWidth,a._preferredHeight).render(function(e){a._width=e.width,a._height=e.height;var r=e.getContext("2d").getImageData(0,0,e.width,e.height);a._bufferRGBA=new Uint8ClampedArray(r.data),a.removeAreaWithAlphaZero(),void 0!==t&&t()}):(console.error("Image could not be loaded from url: '"+e+"'"),void 0!==t&&t())},"blob:"===e.substring(0,5)?n.BlobURLToBase64(e,null,function(n){"image/x-tga"===(o=n.split(",")[0].split(":")[1].split(";")[0])?a.loadTgaFromDataUrl(n,function(){void 0!==t&&t()}):r.src=e}):0===e.indexOf("data:image")&&(e.indexOf("image/jpeg")>=0?o="image/jpeg":e.indexOf("image/png")>=0?o="image/png":e.indexOf("image/bitmap")>=0?o="image/bitmap":e.indexOf("image/bmp")>=0?o="image/bmp":e.indexOf("image/svg+xml")>=0?o="image/svg+xml":e.indexOf("image/x-tga")>=0&&(o="image/x-tga"),"image/x-tga"===o?a.loadTgaFromDataUrl(base64,function(){void 0!==t&&t()}):r.src=e)},decodeRLEforTGA:function(e,t,r,n,i){var a,o,s,l,d,h,c,f=i*r;for(c=new Uint8ClampedArray(n),h=new Uint8ClampedArray(r),a=n-f;a>=0;){for(var u=0;u<f;){if(s=1+(127&(o=e.getUint8(t++))),128&o){for(l=0;l<r-1;++l)h[r-2-l]=e.getUint8(t++);for(h[r-1]=e.getUint8(t++),l=0;l<s;++l)c.set(h,a),a+=r}else for(l=0;l<s;++l,a+=r){for(d=0;d<r-1;++d)c[a+(r-2)-d]=e.getUint8(t++);c[a+r-1]=e.getUint8(t++)}u+=s*r}a-=2*f}return c},checkHeaderTGA:function(e){if(0===e.imageType)throw new Error("No data within current TGA file");if(e.bHasColorMap){if(e.colorMapLength>256||24!==e.colorMapSize||1!==e.colorMapType)throw new Error("Invalid colormap for indexed type")}else if(e.colorMapType)throw new Error("The image contains a color map but the imageType field tells it isn't needed.");if(e.width<=0||e.height<=0)throw new Error("Invalid image size: "+e.width+" per "+e.height+".");if(e.pixelDepth%8!=0||e.pixelDepth>32||e.pixelDepth<8)throw new Error('Invalid pixel size of "'+e.pixelDepth+' bits per pixel"')},loadTgaFromDataUrl:function(e,t){var r=new FileReader,i=this;r.onload=function(e){var r=new DataView(e.target.result),n={fileheader:{}};n.fileheader.idLength=r.getUint8(0),n.fileheader.colorMapType=r.getUint8(1),n.fileheader.imageType=r.getUint8(2),n.fileheader.colorMapIndex=r.getUint16(3,!0),n.fileheader.colorMapLength=r.getUint16(5,!0),n.fileheader.colorMapDepth=r.getUint8(7),n.fileheader.offsetX=r.getUint16(8,!0),n.fileheader.offsetY=r.getUint16(10,!0),n.fileheader.width=r.getUint16(12,!0),n.fileheader.height=r.getUint16(14,!0),n.fileheader.pixelDepth=r.getUint8(16,!0),n.fileheader.flags=r.getUint8(17,!0),i.checkHeaderTGA(n.fileheader),i._width=n.fileheader.width,i._height=n.fileheader.height;var a=18+n.fileheader.idLength,o=i._width*i._height,s=n.fileheader.pixelDepth>>3,l=o*s;if(i._bufferRGBA=new Uint8ClampedArray(l),n.fileheader.bHasEncoding=9===n.fileheader.imageType||10===n.fileheader.imageType||11===n.fileheader.imageType,n.fileheader.bHasColorMap=1===n.fileheader.imageType||9===n.fileheader.imageType,n.fileheader.bHasEncoding)i._bufferRGBA=i.decodeRLEforTGA(r,a,s,l,i._width);else{var d=i._width*i._height,h=d*n.fileheader.pixelDepth/8,c=new Uint8Array(e.target.result,a,h);switch(i._bufferRGBA=new Uint8ClampedArray(h),n.fileheader.pixelDepth){case 8:for(var f=0,u=0;u<d;++u)i._bufferRGBA[f++]=c[u],i._bufferRGBA[f++]=c[u],i._bufferRGBA[f++]=c[u],i._bufferRGBA[f++]=255;break;case 16:for(f=0,u=0;u<d;++u){var p=2*u;i._bufferRGBA[f++]=c[p],i._bufferRGBA[f++]=c[p],i._bufferRGBA[f++]=c[p],i._bufferRGBA[f++]=c[p+1]}break;case 24:for(f=0,u=0;u<d;++u){p=3*u;i._bufferRGBA[f++]=c[p+2],i._bufferRGBA[f++]=c[p+1],i._bufferRGBA[f++]=c[p],i._bufferRGBA[f++]=255}break;case 32:for(u=0;u<d;++u){p=4*u;i._bufferRGBA[p]=c[p+2],i._bufferRGBA[p+1]=c[p+1],i._bufferRGBA[p+2]=c[p],i._bufferRGBA[p+3]=c[p+3]}}i.flipVertical()}t&&"function"==typeof t&&t()},r.readAsArrayBuffer(n.dataURLToBlob(e))},loadBmpFromDataUrl:function(e,t){var r=this,i=new FileReader;i.onload=function(e){var n=new DataView(e.target.result),i={fileheader:{}};i.fileheader.bfType=n.getUint16(0,!0),i.fileheader.bfSize=n.getUint32(2,!0),i.fileheader.bfReserved1=n.getUint16(6,!0),i.fileheader.bfReserved2=n.getUint16(8,!0),i.fileheader.bfOffBits=n.getUint32(10,!0),i.infoheader={},i.infoheader.biSize=n.getUint32(14,!0),i.infoheader.biWidth=n.getUint32(18,!0),i.infoheader.biHeight=n.getUint32(22,!0),i.infoheader.biPlanes=n.getUint16(26,!0),i.infoheader.biBitCount=n.getUint16(28,!0),i.infoheader.biCompression=n.getUint32(30,!0),i.infoheader.biSizeImage=n.getUint32(34,!0),i.infoheader.biXPelsPerMeter=n.getUint32(38,!0),i.infoheader.biYPelsPerMeter=n.getUint32(42,!0),i.infoheader.biClrUsed=n.getUint32(46,!0),i.infoheader.biClrImportant=n.getUint32(50,!0),r._width=i.infoheader.biWidth,r._height=i.infoheader.biHeight,r._bufferRGBA=new Uint8ClampedArray(4*r._width*r._height);var a=i.fileheader.bfOffBits,o=new Uint8ClampedArray(e.target.result,a),s=(i.infoheader.biBitCount,4*Math.floor((i.infoheader.biBitCount*i.infoheader.biWidth+31)/32)),l=r._width,d=r._height,h=!1;if(0===i.infoheader.biCompression)switch(i.infoheader.biBitCount){case 24:for(var c=0;c<d;++c)for(var f=0;f<l;++f){var u=3*f+s*c,p=4*(f+l*(d-c-1));r._bufferRGBA[p]=o[u+2],r._bufferRGBA[p+1]=o[u+1],r._bufferRGBA[p+2]=o[u],r._bufferRGBA[p+3]=255}h=!0;break;case 32:for(c=0;c<d;++c)for(f=0;f<l;++f){u=4*f+s*c,p=4*(f+l*(d-c-1));r._bufferRGBA[p]=o[u+2],r._bufferRGBA[p+1]=o[u+1],r._bufferRGBA[p+2]=o[u],r._bufferRGBA[p+3]=o[u+3]}h=!0}void 0!==t&&t(h)},i.readAsArrayBuffer(n.dataURLToBlob(e))},toBmpDataUrl:function(){var e=document.createElement("canvas");e.width=this._width,e.height=this._height;var t=e.getContext("2d"),r=t.getImageData(0,0,this._width,this._height);r.data.set(this._bufferRGBA),t.putImageData(r,0,0,0,0,e.width,e.height);var n,i,a,o,s=e.width,l=e.height,d=4*s,h=e.getContext("2d").getImageData(0,0,s,l),c=new Uint32Array(h.data.buffer),f=4*Math.floor((32*s+31)/32),u=f*l,p=122+u,m=new ArrayBuffer(p),g=new DataView(m),v=0,y=0,w=0;function b(e){g.setUint16(v,e,!0),v+=2}function x(e){g.setUint32(v,e,!0),v+=4}for(b(19778),x(p),v+=4,x(122),x(108),x(s),x(-l>>>0),b(1),b(32),x(3),x(u),x(2835),x(2835),v+=8,x(16711680),x(65280),x(255),x(4278190080),x(1466527264);y<l;){for(i=122+y*f,n=0;n<d;)a=(o=c[w++])>>>24,g.setUint32(i+n,o<<8|a),n+=4;y++}for(var A=new Uint8Array(m),_="",T=0,C=A.length;T<C;)_+=String.fromCharCode(A[T++]);return"data:image/bmp;base64,"+btoa(_)},toCanvas:function(){var e=document.createElement("canvas");e.width=this._width,e.height=this._height;var t=e.getContext("2d"),r=t.getImageData(0,0,e.width,e.height);return r.data.set(this._bufferRGBA),t.putImageData(r,0,0,0,0,e.width,e.height),e},fillCanvas:function(e){e.width=this._width,e.height=this._height;var t=e.getContext("2d"),r=t.getImageData(0,0,e.width,e.height);r.data.set(this._bufferRGBA),t.putImageData(r,0,0,0,0,e.width,e.height)},replaceKeyColorByOther:function(e,t,r){for(var n=new Uint8ClampedArray(this._width*this._height*4),i=255*e.r,a=255*e.g,o=255*e.b,s=255*e.a,l=255*t.r,d=255*t.g,h=255*t.b,c=255*t.a,f=r?255*r.r:255,u=r?255*r.g:255,p=r?255*r.b:255,m=r?255*r.a:255,g=0;g<this._width;g++)for(var v=0;v<this._height;v++){var y=4*(v*this._width+g);Math.abs(this._bufferRGBA[y+0]-i)<3&&Math.abs(this._bufferRGBA[y+1]-a)<3&&Math.abs(this._bufferRGBA[y+2]-o)<3&&Math.abs(this._bufferRGBA[y+3]-s)<3?(n[y+0]=l,n[y+1]=d,n[y+2]=h,n[y+3]=c):r?(n[y+0]=f,n[y+1]=u,n[y+2]=p,n[y+3]=m):(n[y+0]=this._bufferRGBA[y+0],n[y+1]=this._bufferRGBA[y+1],n[y+2]=this._bufferRGBA[y+2],n[y+3]=this._bufferRGBA[y+3])}this._bufferRGBA=n},buildBorderHist:function(e){for(var r=0,n=!1,i=0;i<this._width;i++){r=4*(0*this._width+i),this._bufferRGBA[r+3]<255&&(n=!0);var a=(new t).FromRGBA(this._bufferRGBA[r+0]/255,this._bufferRGBA[r+1]/255,this._bufferRGBA[r+2]/255).GetHex();e.hasOwnProperty(a)?e[a]++:e[a]=0,r=4*((this._height-1)*this._width+i),this._bufferRGBA[r+3]<255&&(n=!0);a=(new t).FromRGBA(this._bufferRGBA[r+0]/255,this._bufferRGBA[r+1]/255,this._bufferRGBA[r+2]/255).GetHex();e.hasOwnProperty(a)?e[a]++:e[a]=0}for(var o=1;o<this._height-1;o++){r=4*(o*this._width+0);this._bufferRGBA[r+3]<255&&(n=!0);a=(new t).FromRGBA(this._bufferRGBA[r+0]/255,this._bufferRGBA[r+1]/255,this._bufferRGBA[r+2]/255).GetHex();e.hasOwnProperty(a)?e[a]++:e[a]=0;r=4*(o*this._width+(this._width-1));this._bufferRGBA[r+3]<255&&(n=!0);a=(new t).FromRGBA(this._bufferRGBA[r+0]/255,this._bufferRGBA[r+1]/255,this._bufferRGBA[r+2]/255).GetHex();e.hasOwnProperty(a)?e[a]++:e[a]=1}return n},toSubImage:function(e,t,r,n){for(var i=e+r<this._width?r:this._width-e,a=t+n<this._height?n:this._height-t,o=new Uint8ClampedArray(i*a*4),s=0,l=0;l<a;l++)for(var d=4*(e+(l+t)*this._width),h=0;h<i;h++)o[s++]=this._bufferRGBA[d++],o[s++]=this._bufferRGBA[d++],o[s++]=this._bufferRGBA[d++],o[s++]=this._bufferRGBA[d++];this._width=i,this._height=a,this._bufferRGBA=o},getSubImage:function(e,t,r,n){for(var i=e+r<this._width?r:this._width-e,o=t+n<this._height?n:this._height-t,s=new Uint8ClampedArray(i*o*4),l=0,d=0;d<o;d++)for(var h=4*(e+(d+t)*this._width),c=0;c<i;c++)s[l++]=this._bufferRGBA[h++],s[l++]=this._bufferRGBA[h++],s[l++]=this._bufferRGBA[h++],s[l++]=this._bufferRGBA[h++];var f=new a;return f._width=i,f._height=o,f._bufferRGBA=s,f},reDimension:function(e,t){for(var r=new Uint8ClampedArray(e*t*4),n=this._width/e,i=this._height/t,a=0;a<t;a++)for(var o=i*a,s=0;s<e;s++){var l=4*(e*Math.floor(a)+Math.floor(s)),d=4*(this._width*Math.floor(o)+Math.floor(n*s));r[l]=this._bufferRGBA[d],r[l+1]=this._bufferRGBA[d+1],r[l+2]=this._bufferRGBA[d+2],r[l+3]=this._bufferRGBA[d+3]}this._width=e,this._height=t,this._bufferRGBA=r},scale:function(e,t,r){var n=Math.floor(this._width*e),i=Math.floor(this._height*t);this.reDimension(n,i)},flipVertical:function(){if(null!==this._bufferRGBA)for(var e,t=4*this._width,r=parseInt(.5*this._height),n=0;n<r;n++)for(var i=t*n,a=t*(this._height-n-1),o=0;o<t;o++)e=this._bufferRGBA[i],this._bufferRGBA[i++]=this._bufferRGBA[a],this._bufferRGBA[a++]=e},setPixelsOpacity:function(e){for(var t=4*this._width*this._height,r=3;r<t;r+=4)this._bufferRGBA[r]=e},removeAreaWithAlphaZero:function(){for(var e=0,t=0;t<this._width;++t){for(var r=!0,n=0;n<this._height;++n){if(this.getPixelRGBA(t,n)[3]){e=t,r=!1;break}}if(!r)break}var i=this._width-1;for(t=this._width-1;t>=0;--t){for(r=!0,n=0;n<this._height;++n){if(this.getPixelRGBA(t,n)[3]){i=t,r=!1;break}}if(!r)break}var a=0;for(n=0;n<this._height;++n){var o=!0;for(t=0;t<this._width;++t){if(this.getPixelRGBA(t,n)[3]){a=n,o=!1;break}}if(!o)break}var s=this._height-1;for(n=this._height-1;n>=0;--n){for(o=!0,t=0;t<this._width;++t){if(this.getPixelRGBA(t,n)[3]){s=n,o=!1;break}}if(!o)break}e>i&&(e=0,i=this._width-1),a>s&&(a=0,s=this._height-1),this.toSubImage(e,a,i,s)},buildFromDataUrl:function(e,t){"string"==typeof e&&"blob"===e.substring(0,4)||t();var r=this,n=new Image;n.onload=function(){var e=document.createElement("canvas");e.width=this.width,e.height=this.height;var n=e.getContext("2d");n.drawImage(this,0,0),r._width=e.width,r._height=e.height;var i=n.getImageData(0,0,e.width,e.height);r._bufferRGBA=new Uint8ClampedArray(i.data),void 0!==t&&t()},n.src=e},toDataUrl:function(e,t,r){if("image/bmp"===e)return this.toBmpDataUrl();var n=document.createElement("canvas");n.width=this._width,n.height=this._height;var i=n.getContext("2d"),a=i.getImageData(0,0,this._width,this._height);a.data.set(this._bufferRGBA),i.putImageData(a,0,0,0,0,n.width,n.height);var o=n.toDataURL(e||"image/png",t||85);if(r&&"image/jpeg"===e){var s=o.replace("data:image/jpeg;base64,",""),l=atob(s);let e=[];for(let t=0;t<l.length;t++)e.push(l.charCodeAt(t));var d=new Uint8Array(e),h=(65535&r)>>8,c=255&r,f=0,u=0;for(f=0;f<20;f++)if(74==d[f]&&70==d[f+1]&&73==d[f+2]&&70==d[f+3]&&0==d[f+4]){u=f+7;break}if(20===u)return console.log("can't set the DPI settings in jpgeg file"),o;d[u]=1,d[u+1]=h,d[u+2]=c,d[u+3]=h,d[u+4]=c;var p="";for(f=0;f<d.length;)p+=String.fromCharCode(d[f++]);return"data:image/jpeg;base64,"+btoa(p)}return o},toBlob:function(){return n.dataURLToBlob(this.toDataUrl())},saveAs:function(e){if(e){var t=document.createElement("canvas");t.width=this._width,t.height=this._height;var n=t.getContext("2d"),i=n.getImageData(0,0,t.width,this._height);i.data.set(this._bufferRGBA),n.putImageData(i,0,0,0,0,t.width,t.height);var a=new r,o="image/jpeg";switch(e.split(".")[1]){case"png":o="image/png";break;case"bmp":o="image/bitmap";break;case"tif":case"tiff":o="image/tiff";break;case"tga":o="image/x-tga";break;case"gif":o="image/gif";break;case"svg":o="image/svg+xml";break;case"hdr":o="image/vnd.radiance"}a.saveAs(t.toDataURL(o,this._quality),e)}},getCanvas:function(){var e=document.createElement("canvas");e.width=this._width,e.height=this._height;var t=e.getContext("2d"),r=t.getImageData(0,0,e.width,this._height);return r.data.set(this._bufferRGBA),t.putImageData(r,0,0,0,0,e.width,e.height),e}});return a});