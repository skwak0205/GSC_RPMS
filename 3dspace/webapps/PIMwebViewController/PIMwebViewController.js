/*!  Copyright 2018 Dassault Systemes. All rights reserved. */
define("DS/PIMwebViewController/PIMwebDisplayCmd",["DS/ApplicationFrame/CommandCheckHeader","DS/PADUtils/PADContext"],function(e,t){"use strict";return e.extend({init:function(e){this._parent(e);var n,i=this,r="colorsState",a=1;"PIMDisplayClashCurveHdr"===i._id?(r="clash",a=1):"PIMDisplayContactCurveHdr"===i._id?(r="contact",a=1):"PIMDisplayClearanceCurveHdr"===i._id?(r="clearance",a=1):"PIMDisplayQuantifiersHdr"===i._id?(r="quantifiers",a=1):"PIMZoomOnInterferenceHdr"===i._id?(r="zoom",a=0):"PIMApplyTransparencyHdr"===i._id&&(r="transparencyState",a=0),this.setState(function(){let e=localStorage.getItem("PIMwebApplyDisplayPref");return e=e?JSON.parse(e):{},Boolean(e&&r in e?e[r]:a)}()),require(["DS/PIMwebViewController/PIMwebItfCtrl"],function(e){n=e.getItfCtrl({pad3DViewer:t.get()}),i&&n.applyDisplay(r,i.getState()?1:0,!0),require(["DS/PIMwebViewModel/PIMwebUtils"],function(e){e._sendUsageProbe("commandCheck","ColorOverloadOff")})}),this.onStateChange(function(){if(!n||!i)return;let e=i.getState();n.applyDisplay(r,e?1:0,!1),function(e){let t=localStorage.getItem("PIMwebApplyDisplayPref");(t=t?JSON.parse(t):{})[r]=e?1:0,localStorage.setItem("PIMwebApplyDisplayPref",JSON.stringify(t))}(e)}),this._destroy=function(){n=i=null;var e=Object.getPrototypeOf(this);e._destroy&&e._destroy.apply(this,arguments)}}})}),define("DS/PIMwebViewController/PIMwebItfCtrl",["UWA/Class","UWA/Core","DS/Visualization/ThreeJS_DS","DS/Visualization/Node3D","DS/PIMwebViewModel/PIMwebUtils","DS/CATWebUXSlideShow/CATWebUXSlideShowController","DS/PIMwebUX/PIMwebDetailedItfListUI","DS/ENOPAD3DViewer/utils/PAD3DViewerModelServices","DS/PADUtils/PADSettingsMgt","DS/PIMwebViewModel/PIMwebIsrMgr","DS/PIMwebUX/PIMwebOpacitySlider","DS/PADUtils/PADUtilsServices","DS/PIMwebUX/PIMwebUnitsUX","DS/CATWebUXComponents/CATWebUXUtils","DS/CATWebUXComponents/CATWebUXPanel","DS/Windows/Dialog","DS/Controls/Button","DS/Visualization/IdPath","DS/Visualization/IdPathMatcher","DS/PIMwebPreferences/PIMwebPreferences","DS/WebappsUtils/WebappsUtils","DS/CoreEvents/ModelEvents","DS/CATWebUXPreferences/CATWebUXPreferencesManager","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","i18n!DS/PIMwebViewController/assets/nls/PIMwebItfCtrl","i18n!DS/PIMwebUX/assets/nls/PIMwebItfListUI","i18n!DS/PIMwebViewController/assets/nls/PIMwebGenerateTICCmd","DS/CATWebUXSlideDrop/CATWebUXSlideDropServices"],function(e,t,n,i,r,a,o,l,s,c,f,u,d,h,p,m,g,b,y,I,C,P,v,w,D,S,M,x){"use strict";function A(e,t){return!(!t||!t.length)&&e.isReferenceComplete(t[t.length-1].physicalid)}function O(e,t){return!(!t||!t.length)&&!1!==e.hasMeshInRAM(t[t.length-1].physicalid)}function T(e,t){return!!t&&t.every(e.isRegistered,e)}function L(e,t){var n,i,r,a;if(e&&e.length)for(r=t.getRootBagPath(),n=0,i=e.length;n<i;++n){if(!(a=t.getNode({id:e[n].physicalid}))){r=null;break}r.addElement(a)}return r&&r.checkExternalPath()?r:null}function E(e,t){function n(e,t){var n=0;e.itfLblSlide=0,Object.keys(t).forEach(function(i){t[i].row.itfLblSlide&&(e.itfLblSlide=(e.itfLblSlide?e.itfLblSlide:0)+t[i].row.itfLblSlide,t[i].row.itfNonUniqueSlide&&!n&&t[i].row.itfNonUniqueSlide.forEach(function(t){t&&e.ctxChilds.every(e=>t.includes(e))&&(e.itfLblSlide=e.itfLblSlide-e.childIds.length+1)}),++n)})}var i,r=(i="mID",e.reduce(function(e,t){var n=t[i]?i:"itfuid";return void 0===t[n]?e:Object.assign(e,{[t[n]]:(e[t[n]]||[]).concat(t)})},{})),a=[];return Object.keys(r).forEach(function(e){var i=r[e];e||(e=i[0].itfuid);var o=Object.assign({row:{},children:{}},t[e]?t[e]:{}),l=function(e){var n=Object.assign({},e,{itfLblSlide:t[e.mID]&&t[e.mID].row?t[e.mID].row.itfLblSlide:""});return n.icons=e.isNonPersistentPIM?[]:["I_PIMInterference.png"],n.itfuid=e.mID?e.mID:e.itfuid,n.itfName=n.tree=e.itfMetricName?e.itfMetricName:e.itfCtxName,delete n.itfCtxName,delete n.itfLblInst1Path,delete n.itfLblInst2Path,delete n.itfLblRef1Path,delete n.itfLblRef2Path,n}(i[0]);l.childIds=o.row.childIds?o.row.childIds:[],l.ctxChilds=o.row.ctxChilds?o.row.ctxChilds:[],Object.keys(i).forEach(function(e){var n=function(e){var t={itfuid:e.itfuid,tree:e.tree?e.tree:e.itfCtxName,itfName:e.itfCtxName,childOf:e.mID,itfCtxName:e.itfCtxName,itfLblSlide:e.itfLblSlide};return["itfLblInst1Path","itfLblInst2Path","itfLblRef1Path","itfLblRef2Path","itfNonUniqueSlide"].reduce(function(n,i){return t[i]=e[i],n},{}),t}(i[e]);-1===l.childIds.indexOf(i[e].itfuid)&&(l.childIds.push(i[e].itfuid),l.ctxChilds.push(i[e].itfuid)),o.children[n.itfuid]=t[n.itfuid]={row:n}}),o.children&&n(l,o.children),o.row=l;var s=function(e){if(!e.itfFeat1&&!e.itfFeat2||!e.itfPath1||!e.itfPath2)return null;var n=e.itfPath1[e.itfPath1.length-1].physicalid+e.itfPath2[e.itfPath2.length-1].physicalid,i=e.itfPath2[e.itfPath2.length-1].physicalid+e.itfPath1[e.itfPath1.length-1].physicalid;e.isNonPersistentPIM&&(n=e.itfFeat1+e.itfFeat2,i=e.itfFeat2+e.itfFeat1);var r=t[n]?t[n].row:t[i]?t[i].row:null,a=r?r.itfuid:n,o=r?r.icons:[];e.itfFeat1&&!o.find(e=>"I_PIMGeoBundle.png"===e)&&Boolean(e.itfPath1.find(e=>"ElectricalBranchGeometry"===e.type))&&o.push("I_PIMGeoBundle.png"),e.itfFeat1&&!o.find(e=>"I_PIMPathwayGeometry.png"===e)&&Boolean(e.itfPath1.find(e=>"Sys3D_PathwayGeometry"===e.type))&&o.push("I_PIMPathwayGeometry.png"),e.itfFeat2&&!o.find(e=>"I_PIMGeoBundle.png"===e)&&Boolean(e.itfPath2.find(e=>"ElectricalBranchGeometry"===e.type))&&o.push("I_PIMGeoBundle.png"),e.itfFeat2&&!o.find(e=>"I_PIMPathwayGeometry.png"===e)&&Boolean(e.itfPath2.find(e=>"Sys3D_PathwayGeometry"===e.type))&&o.push("I_PIMPathwayGeometry.png"),e.isNonPersistentPIM&&!o.find(e=>"I_PIMGeoBundle.png"===e)&&(e.ittEleFeat1Supported||e.ittEleFeat2Supported)&&o.push("I_PIMGeoBundle.png"),e.isNonPersistentPIM&&!o.find(e=>"I_PIMPathwayGeometry.png"===e)&&(e.ittPathway1Supported||e.ittPathway2Supported)&&o.push("I_PIMPathwayGeometry.png");var l={itfuid:a,icons:o,isNonEditable:!0,childIds:[],ctxChilds:[]};return l.itfName=l.tree=e.itfLblRef1+" / "+e.itfLblRef2,["itfLblRef1","itfLblRef2","itfLblRef1Owner","itfLblRef2Owner","itfLblRef1OwnerID","itfLblRef2OwnerID"].reduce(function(t,n){return l[n]=e[n],t},{}),l}(l);s&&(s.childIds=t[s.itfuid]&&t[s.itfuid].row?t[s.itfuid].row.childIds:[],s.ctxChilds=t[s.itfuid]&&t[s.itfuid].row?t[s.itfuid].row.ctxChilds:[],-1===s.childIds.indexOf(o.row.itfuid)&&s.childIds.push(o.row.itfuid),o.row.childIds&&(s.ctxChilds=s.ctxChilds.concat(o.row.ctxChilds).filter((e,t,n)=>n.indexOf(e)===t)),o.row.childOf=s.itfuid,a[s.itfuid]={row:s,children:t[s.itfuid]?t[s.itfuid].children:{}}),t[l.itfuid]=Object.assign({},o),o.children&&1===Object.keys(o.children).length?(Object.assign(o.row,o.children[Object.keys(o.children)[0]].row,{itfuid:l.itfuid,childOf:l.childOf}),o.row.itfName=o.row.tree=l.itfMetricName?l.itfMetricName:l.tree?l.tree:l.itfCtxName,delete o.children):o.row.itfCtxName=o.row.itfLblInst1Path=o.row.itfLblInst2Path=o.row.itfLblRef1Path=o.row.itfLblRef2Path=void 0,s?(a[s.itfuid].children[o.row.itfuid]=o,a[s.itfuid].children&&n(a[s.itfuid].row,a[s.itfuid].children),t[s.itfuid]=a[s.itfuid],function(e){function t(e,t){return"Undefined"===e||"Clash"===e||e===t?e:"Contact"===e&&"Clash"!==t?e:"Clearance"===e&&"Clash"!==t&&"Contact"!==t?e:"NoInterference"===e&&"Clash"!==t&&"Contact"!==t&&"Clearance"!==t?e:t}function n(e,t){return"NotAnalyzed"===e||"KO"===e||e===t||"OK"===e&&"KO"!==t?e:t}e.row.itfSystemType=e.row.itfUserType=e.row.itfAnalysis=e.row.itfPrevAnalysis=void 0,Object.keys(e.children).forEach(function(i){var r=e.children[i].row,a=e.row;e.row.itfSystemType=a.itfSystemType&&"Undefined"!==r.itfSystemType?t(a.itfSystemType,r.itfSystemType):r.itfSystemType,e.row.itfUserType=a.itfUserType&&"Undefined"!==r.itfUserType?t(a.itfUserType,r.itfUserType):r.itfUserType,e.row.itfAnalysis=a.itfAnalysis&&"NotAnalyzed"!==r.itfAnalysis?n(a.itfAnalysis,r.itfAnalysis):r.itfAnalysis,e.row.itfPrevAnalysis=a.itfPrevAnalysis&&"NotAnalyzed"!==r.itfPrevAnalysis?n(a.itfPrevAnalysis,r.itfPrevAnalysis):r.itfPrevAnalysis})}(a[s.itfuid])):a[o.row.itfuid]=o}),a}var R=[["itfLblShape1","itfLblShape1Owner","itfLblShape1OwnerID","itfLblInst1","itfLblInst1Owner","itfLblInst1OwnerID","itfLblRef1","itfLblRef1Owner","itfLblRef1OwnerID","itfLblInst1Path","itfLblInst1Path","itfLblRef1Path"],["itfLblShape2","itfLblShape2Owner","itfLblShape2OwnerID","itfLblInst2","itfLblInst2Owner","itfLblInst2OwnerID","itfLblRef2","itfLblRef2Owner","itfLblRef2OwnerID","itfLblInst2Path","itfLblInst2Path","itfLblRef2Path"]];var V=e.extend({init:function(e){var t,n,i=this,r=null,a=e.readOnly,l=e.cbDnD,s=e.prefUnitValues,c=e.pad3DViewer.getFrameWindow().getImmersiveFrame(),f=e.deforder,u=e.defCols;this.getTreeListViewer=function(){return r},this.show=function(){t&&(t.setPanelVisibilityFlag(!0),t.ensureVisible())},this.hide=function(){t&&t.setPanelVisibilityFlag(!1)},this.destroy=function(){t&&t.destroy()},this.updatePanelTitle=function(e){t&&(t.title=e)},this.onClose=null,this.toggleReadOnly=function(){r&&r.toggleReadOnly()},this.ensureSelectedLineVisibility=function(){r&&r.ensureSelectedLineVisibility()},n=C.getWebappsAssetUrl("PIMwebUX","icons/22/"),(t=new p({title:S.noItf,identifier:"PIMwebItfListPanel",icon:n+"I_ExamineInterference.png",immersiveFrame:c,viewerFrame:e.pad3DViewer.getFrameWindow().getViewerFrame(),resizableFlag:!0,height:200,width:500,collapsibleFlag:!0,floatableFlag:!0,maximizeButtonFlag:!0,horizontallyStretchableFlag:!0,verticallyStretchableFlag:!0,currentDockArea:WUXDockAreaEnum.BottomDockArea})).elements.container.addClassName(t.identifier),r=new o({parent:t,readOnly:a,cbDnD:l,units:{length:s.Length,volume:s.Volume},deforder:f,defCols:u,suffix:f&&f.length>0?"NonPersistent":"",filterCols:{addColsWithSet:f&&f.length>0?["label"]:void 0}}),l=null,t.close=function(){i.onClose?i.onClose():window.console.log("onClose function must be provided")}}}),k=e.extend({init:function(o){var p,w,k,F,N,U,_,G,B,W,j,X,Q,z,q,H,K,J,Z,Y,$=this,ee={},te={},ne=[],ie=new P,re=!1,ae=!1,oe={},le={},se=[],ce={},fe={},ue=[],de=o.pad3DViewer,he=de.getController(),pe=!0,me=!1,ge=[],be=[],ye=!0,Ie={Length:{unit:"mm",decimalPlaceRW:3,decimalPlaceRO:3},Volume:{unit:"mm3",decimalPlaceRW:3,decimalPlaceRO:3}},Ce=he.getRootBagId(),Pe={clash:1,contact:1,clearance:1,quantifiers:1,zoom:0,colorsState:1,transparencyState:0},ve=!1,we={},De={};function Se(){var e=JSON.parse(localStorage.getItem("CATWebUXPreferences_Units"));e&&"inch"===e.Length.unit&&(e.Length.unit="in"),e&&"foot"===e.Length.unit&&(e.Length.unit="ft"),e&&"inch3"===e.Volume.unit&&(e.Volume.unit="in3"),e&&"foot3"===e.Volume.unit&&(e.Volume.unit="ft3"),K=t.extend(t.clone(Ie,!0),e||{})}function Me(){J=!0===JSON.parse(localStorage.getItem("CATWebUXPreferences_TrailingZeros"))}function xe(e,t){return ie.publish({event:e,data:t})}function Ae(e){return ee[e]?e:te[e]&&te[e].row&&te[e].row.childIds?te[e].row.childIds[0]:e}function Oe(e){return e?p?p.getSelectedInterferences(e):[]:(p?p.getSelectedInterferences(e):[]).map(function(e){return Ae(e)}).filter((e,t,n)=>n.indexOf(e)===t)}function Te(e){return function(e,t){return E(e.map(function(e){var t,n={};for(t in e)if(e.hasOwnProperty(t))switch(t){case"itfPenVec":case"itfMinDist":case"itfTolerance":case"itfPenVol":"number"==typeof e[t]&&(n[t]=e[t]);break;case"itfPrevAnalysis":n[t]="OK"===e[t]||"KO"===e[t]||"NotAnalyzed"===e[t]?e[t]:"";break;default:n[t]=e[t]}return n}),t)}(e,te)}function Le(){if(ye){var e,t=de.getViewer(),n=1===t.getVisibleSpace()?"visibleSpace":"invisibleSpace";Object.keys(le).forEach(function(i){if(le[i][0]||le[i][1])if(Pe.zoom&&fe[i]){let t=fe[i];if(!t)return;t.children.forEach(t=>t.children.forEach(t=>{var i=t.children[0].getBoundingSphere(n);i.applyMatrix4(t.children[0].getMatrix()),i&&!i.empty()&&(e?e.mergeWithSphere(i,e):e=i)}))}else{let r=ee[i];if(!r)return;[L(r.itfPath1,he),L(r.itfPath2,he)].forEach(function(i){if(i&&i.checkExternalPath()){var r=i.getBoundingSphere(t,n);e?e.mergeWithSphere(r,e):e=r}})}}),e&&!e.isNaN()&&(e.radius=e.radius/1.1*1.05,de.getFrameWindow().getViewpoint().reframe(void 0,void 0,e))}}function Ee(e){e&&(e.itfManipData&&(e.itfManipData.manipTks.forEach(e.itfManipData.manip.unsubscribe,e.itfManipData.manip),e.itfManipData.manip.unlink(e.itfManipData.manipTk),e.itfManipData=null),e.removeChildren())}function Re(e){e&&(e.children.forEach(e=>Ee(e.children[1])),e.removeChildren())}function Ve(e){let t=fe[e];t&&(t.children.forEach(e=>e.children.forEach(e=>Ee(e.children[1]))),X.removeChild(t),delete fe[e])}Z=I.__readDisplayPrefValues(),Se(),Me();let ke=function(){let e,t,a,o,l,s,c,f,u,h,p,m,g,b=Z.partsOverload||Z.colors,y=new n.Color(b.itfType[0]),I=new n.Color(b.itfType[1]),C=new n.Color(b.itfType[2]),P=new n.LineBasicMaterial({color:y,side:n.DoubleSide,force:!0,lineWidth:3}),v=new n.MeshBasicMaterial({color:y,side:n.DoubleSide,opacity:.3,force:!0}),w=new n.MeshBasicMaterial({color:y,side:n.DoubleSide,force:!0}),S=new n.LineBasicMaterial({color:I,side:n.DoubleSide,force:!0,lineWidth:1}),M=new n.LineBasicMaterial({color:C,side:n.DoubleSide,force:!0,lineWidth:1}),x=new n.MeshBasicMaterial({color:C,side:n.DoubleSide,force:!0}),T=new n.MeshBasicMaterial({color:C,side:n.DoubleSide,force:!0}),E="PIMwebItfGeom",R="PIMwebItfQuantifier",V="Clash",k="Contact",F="Clearance",N=8,U=5,_=2,G=16,B=5,W="sans-serif",j=String(G)+"px "+W,Q="#FFFFFF";function z(e,n){if(n.name===V&&n.children.length)return n.children[0];if(n.name===k&&n.children.length)return n.children[0];if(n.name===F&&e<n.children.length)return n.children[e];let r=new i(e);n.add(r);let a=new i(E);a.setPickable(t.PICKTHROUGH),r.add(a);let o=n.name,l=Pe,s=o===V&&!l.clash||o===k&&!l.contact||o===F&&!l.clearance;return a.setVisibility(!s),(a=new i(R)).setVisibility(l.quantifiers),r.add(a),r}P.color=v.color=w.color=y,S.color=I,M.color=x.color=T.color=C;let q=function(){function r(e,t,n,r){return new Promise(function(a){n||a(),(g=new p).setFileType("cgr");let o=e.children[0];o.setMatrix(t);let l=new i;var s,c,f;o.add(l),g.setOnLoadedCallback(()=>{de.getViewer().render(),a()}),g.loadModelFromBuffer((s=n,c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",f=new ArrayBuffer(s.length/4*3),function(e,t){var n=c.indexOf(e.charAt(e.length-1)),i=c.indexOf(e.charAt(e.length-2)),r=e.length/4*3;64===n&&r--,64===i&&r--;var a,o,l,s,f,u,d,h=0,p=0;for(a=t?new Uint8Array(t):new Uint8Array(r),e=e.replace(/[^A-Za-z0-9+/=]/g,""),h=0;h<r;h+=3)o=c.indexOf(e.charAt(p++))<<2|(f=c.indexOf(e.charAt(p++)))>>4,l=(15&f)<<4|(u=c.indexOf(e.charAt(p++)))>>2,s=(3&u)<<6|(d=c.indexOf(e.charAt(p++))),a[h]=o,64!==u&&(a[h+1]=l),64!==d&&(a[h+2]=s)}(s,f),f),l),function(e,t){if(!e||!t)return;let n=e.createOverrideSetManager(),i=n.createSceneGraphOverrideSet();n.pushSceneGraphOverrideSet(i);let r=i.createOverride(new m([e]));r&&r.setMaterial(t,!0)}(l,r)})}return function(i,o,l,s){return new Promise(function(c){let f=ee[i],u=fe[i],d=!1;f&&u&&u.children&&3===u.children.length||c();let h=Z.useStoredResults&&oe[f.mRepRef];if(u.__pimGeomDone&&(h||null===h)&&c(),null===h)u.__pimGeomDone=!0,u.removeChildren(),c();else if(h){d=!0;let e=new n.Matrix4,t=new n.Matrix4;if(h.r2scaInvMatrix){let t=h.r2scaInvMatrix;e=new n.Matrix4(t[0],t[3],t[6],t[9],t[1],t[4],t[7],t[10],t[2],t[5],t[8],t[11],0,0,0,1)}if(f.msca){let e=L(f.itfPath1.slice(0,f.itfPath1.findIndex(e=>e.physicalid===f.msca)+1),he);e&&(t=e.getWorldMatrix())}t.multiplyMatrices(t,e);var p=[];if(h.clearanceArea)p.push(r(z(0,u.children[0]),t,h.clearanceArea,x));else if(h.clearanceTriangle){(Array.isArray(h.clearanceTriangle)?h.clearanceTriangle:[h.clearanceTriangle]).forEach((e,n)=>p.push(r(z(n,u.children[0]),t,e,M)))}h.contactTriangle&&p.push(r(z(0,u.children[1]),t,h.contactTriangle,S)),h.clashVolume&&p.push(r(z(0,u.children[2]),t,h.clashVolume,v)),h.clashCurve&&p.push(r(z(0,u.children[2]),t,h.clashCurve,P)),Promise.all(p).then(function(){u.__pimGeomDone=!0,c()})}let m=[{t:F,b:!1},{t:k,b:!1},{t:V,b:!1}];if([[u.children[0],s.geometries.clearance],[u.children[1],s.geometries.contact],[u.children[2],s.geometries.clash]].forEach(function(e){let t=e[0];e[1]||t.children.forEach(e=>e&&e.children.length&&e.children[0].removeChildren())}),!(s.geometries.clearance||s.geometries.contact||s.geometries.clash||d))return c();if(2===s.geometries.mode)!s.geometries.clearance||u.children[0].children.length&&u.children[0].children.some(e=>e.children[0].children.length)||(m[0].b=!d),!s.geometries.contact||u.children[1].children.length&&u.children[1].children.some(e=>e.children[0].children.length)||(m[1].b=!d),!s.geometries.clash||u.children[2].children.length&&u.children[2].children.some(e=>e.children[0].children.length)||(m[2].b=!d);else{if(f.itfSystemType===F){if(Re(u.children[1]),Re(u.children[2]),(!s.geometries.clearance||u.children[0].children.length&&u.children[0].children.some(e=>e.children[0].children.length))&&!d)return c()}else if(f.itfSystemType===k){if(Re(u.children[0]),Re(u.children[2]),(!s.geometries.contact||u.children[1].children.length&&u.children[1].children.some(e=>e.children[0].children.length))&&!d)return c()}else if(f.itfSystemType===V&&(Re(u.children[0]),Re(u.children[1]),(!s.geometries.clash||u.children[2].children.length&&u.children[2].children.some(e=>e.children[0].children.length))&&!d))return c();d||(f.itfSystemType===F?m[0].b=!0:f.itfSystemType===k?m[1].b=!0:f.itfSystemType===V&&(m[2].b=!0))}let g=f.isNonPersistentPIM?De&&De.spec&&De.spec.value_of_clearance?1e3*De.spec.value_of_clearance:10:f.itfClearVal,b=m.map(e=>e.b&&a.computeGeometries({path1:o,path2:l,itfType:e.t,clearanceValue:g,maxTime:5e3}));if(b[0]&&b[0].clearance1&&b[0].clearance1.length&&b[0].clearance2&&b[0].clearance2.length&&["clearance1","clearance2"].forEach(function(i){let r,a=b[0][i].length,o=0,l=0,s=[],c=[];s.length=3*a,c.length=6*a;for(let e=0;e<a;++e)3===(r=b[0][i][e]).length&&(s[o++]=new n.Vector3(r[0][0],r[0][1],r[0][2]),s[o++]=new n.Vector3(r[1][0],r[1][1],r[1][2]),s[o++]=new n.Vector3(r[2][0],r[2][1],r[2][2]),c[l++]=o-3,c[l++]=o-2,c[l++]=o-2,c[l++]=o-1,c[l++]=o-1,c[l++]=o-3);z(0,u.children[0]).children[0].add(e.createLineNode({points:s,idx:c,material:M,drawMode:t.ConnectivityTypeEnum.LINES}))}),b[1]&&b[1].contact&&b[1].contact.Surface&&b[1].contact.Surface.length){let i,r=b[1].contact.Surface.length,a=0,o=0,l=[],s=[];l.length=3*r,s.length=6*r;for(let e=0;e<r;++e)3===(i=b[1].contact.Surface[e]).length&&(l[a++]=new n.Vector3(i[0][0],i[0][1],i[0][2]),l[a++]=new n.Vector3(i[1][0],i[1][1],i[1][2]),l[a++]=new n.Vector3(i[2][0],i[2][1],i[2][2]),s[o++]=a-3,s[o++]=a-2,s[o++]=a-2,s[o++]=a-1,s[o++]=a-1,s[o++]=a-3);z(0,u.children[1]).children[0].add(e.createLineNode({points:l,idx:s,material:S,drawMode:t.ConnectivityTypeEnum.LINES}))}if(b[2]&&b[2].clash&&b[2].clash.Segment&&b[2].clash.Segment.length){let i,r=b[2].clash.Segment.length,a=[],o=0;a.length=2*r;let l=[];l.length=a.length;for(let e=0;e<r;++e)i=b[2].clash.Segment[e],l[o]=o,a[o++]=new n.Vector3(i[0][0],i[0][1],i[0][2]),l[o]=o,a[o++]=new n.Vector3(i[1][0],i[1][1],i[1][2]);let s=e.createLineNode({points:a,idx:l,material:P,drawMode:t.ConnectivityTypeEnum.LINES});s.setNoZ(!0),z(0,u.children[2]).children[0].add(s)}b.some(e=>e&&"maxTime"===e.status)&&de.displayNotification({msg:D.maxTime,eventID:"info"}),d||c()})}}(),H=function(){function i(e,i,r){var a=new n.Vector3(e[0],e[1],e[2]),l=new n.Vector3(i[0],i[1],i[2]),s=new o({arrowWidth:2,headLength:10,initialPoint:a,finalPoint:l,color:r,head:1});return s.setPickable(t.PICKTHROUGH),s.updateColor(r),s}function r(i,r,a,o,d,p,m){if(r.length){var g=[],b=0,y=0;r.map(function(i){var r=function(t){var i,r=document.createElement("div"),a=document.createElement("span"),o=document.createTextNode(t.text);r.setAttribute("style","font-family:"+W+";font-size:"+G+"px;"),a.setAttribute("style","white-space:nowrap;"),a.appendChild(o),r.appendChild(a),document.body.appendChild(r),i={width:a.offsetWidth,height:a.offsetHeight},document.body.removeChild(r);var l=i.width,s=i.height,c=new f({width:l,height:s,drawCB:function(e,n){try{n.fillStyle=Q,n.font=j,n.textAlign="left",n.textBaseline="top",n.fillText(t.text,0,s-G)}catch(e){window.console.log("error")}},rectangleTexture:!0,materialParams:{depthTest:!1}});return new u({name:t.text,bottomLeftcorner:new n.Vector3(0,0,0),widthVector:new n.Vector3(l,0,0),heightVector:new n.Vector3(0,s,0),canvasNodeTexture:c},e)}({text:i}),a=r.getBoundingBox();r.setPickable(t.PICKTHROUGH),g.push(r),y+=a.max.y,b=Math.max(b,a.max.x)}),b=N+b+N,y=U+y+(r.length-1)*_+U;var I=function(e,i,r,a,o,f,u){let d,p=new c({type:"Spherical"});p.name="Texts",p.setMatrix((new n.Matrix4).setPosition(new n.Vector3(r[a+0],r[a+1],r[a+2]))),p.setPickParent(!0),p.setNoZ(!0),e.addChild(p);var m=new s({ratio:1});m.setPickParent(!0),p.addChild(m);var g=new n.Vector3(i[0],i[1],i[2]),b=new l({fixPt:g,width:o,height:f,color:u,viewpoint:de.getFrameWindow().getViewpoint()});return b.setPickable(t.PICKTHROUGH),b.setNoZ(!0),b.updateLeader(p.getMatrix().multiply(m.getMatrix())),e.addChild(b),e.itfManipData={manipTks:[]},e.itfManipData.manip=d=new h,d.setDynamic(!0),d.setPrePickingDuringManipulation(!0),d.setPreActivationDuringManipulation(!0),d.setPickingDuringManipulation(!0),d.setExclusive(!0),e.itfManipData.manipTk=d.linkToNode(p),e.itfManipData.manipTks.push(d.subscribe("BeginManipulate",function(t){e.itfManipData.parentMatInv=(new n.Matrix4).getInverse(e.getMatrix());var i=(new n.Vector3).copy(t.manipulator.initial3dIntersectionPoint).applyMatrix4(e.itfManipData.parentMatInv);e.itfManipData.translation=(new n.Vector3).getPositionFromMatrix(p.getMatrix()).sub(i)})),e.itfManipData.manipTks.push(d.subscribe("Manipulate",function(t){var i=e.itfManipData,o=(new n.Vector3).copy(t.manipulator.initial3dIntersectionPoint).add(t.translationVector).applyMatrix4(i.parentMatInv).add(i.translation);r[a+0]=o.x,r[a+1]=o.y,r[a+2]=o.z,p.setMatrix(p.getMatrix().setPosition(o)),b.updateLeader(p.getMatrix().multiply(m.getMatrix())),de.getViewer().render()})),e.itfManipData.manipTks.push(d.subscribe("EndManipulate",function(){delete e.itfManipData.translation,delete e.itfManipData.parentMatInv})),p.cbChange=function(e,t){e.call(this,t),b.updateLeader(this.getMatrix().multiply(m.getMatrix()))}.bind(p,p.cbChange),m}(i,a,o,d,b,y,m),C=function(t,i,r){var a=new n.Shape;a.moveTo(0,B),a.lineTo(0,i-B),a.absarc(B,i-B,B,Math.PI,.5*Math.PI,!0),a.lineTo(t-B,i),a.absarc(t-B,i-B,B,.5*Math.PI,0,!0),a.lineTo(t,B),a.absarc(t-B,B,B,2*Math.PI,1.5*Math.PI,!0),a.lineTo(B,0),a.absarc(B,B,B,1.5*Math.PI,Math.PI,!0);var o=new n.ShapeGeometry(a),l=new n.Mesh(o,r),s=e.createNodeFromTHREEMesh(l);return s.setShadow(!1),s.setFrustumCulled(!1),s}(b,y,p);C.excludeFromCSO(!0),C.excludeFromHSO(!0),C.setPickParent(!0),I.addChild(C),y-=U,g.forEach(function(e){var t=e.getBoundingBox();y-=t.max.y,e.setMatrix((new n.Matrix4).setPosition(new n.Vector3(.5*(b-t.max.x),y,0))),I.addChild(e),y-=_})}}function p(e,t){if(e>0){var n=t?K.Volume.unit:K.Length.unit,i=t?K.Volume.decimalPlaceRO:K.Length.decimalPlaceRO,r=d[t?"volume":"length"][n]*(t?1:.001);return(J?(e*r).toFixed(i):Number((e*r).toFixed(i)).toString())+" "+n}}return function(e,t,o,l){let s=ee[e],c=fe[e],f=new n.Matrix4;if(!s||!c||!c.children||3!==c.children.length)return;if(s.itfSystemType===F&&!s.itfMinDist&&!l.quantifiers.minDist){let e=c.children[0].children.length&&c.children[0].children[0];return void(e&&Ee(e.children[1]))}if(c.__pimQuantifierDone)return;if(c.children.forEach(e=>e.children.forEach(e=>e&&e.children.length&&Ee(e.children[1]))),s.msca){let e=L(s.itfPath1.slice(0,s.itfPath1.findIndex(e=>e.physicalid===s.msca)+1),he);e&&(f=e.getWorldMatrix())}if(s.itfSystemType===F&&!s.itfMinDist&&l.quantifiers.minDist&&"number"!=typeof s.itfMinDistComputed){let e=a.computeMinDist({path1:t,path2:o});s.itfMinDistComputed=e.minDist;let i=(new n.Matrix4).getInverse(f);s.itfQtfPt1=new n.Vector3(e.pos1[0],e.pos1[1],e.pos1[2]).applyMatrix4(i),s.itfQtfPt2=new n.Vector3(e.pos2[0],e.pos2[1],e.pos2[2]).applyMatrix4(i),s.itfQtfPt1=[s.itfQtfPt1.x,s.itfQtfPt1.y,s.itfQtfPt1.z],s.itfQtfPt2=[s.itfQtfPt2.x,s.itfQtfPt2.y,s.itfQtfPt2.z]}let u,d=Z.useStoredResults&&oe[s.mRepRef],h=[],m=new n.Matrix4,g=new n.Matrix4;if(s.pos3D||(s.pos3D=h),(s.itfSystemType===F||s.itfSystemType===V)&&(s.itfSystemType!==V||s.itfPenVec||s.itfPenVol)&&(s.itfSystemType!==F||s.itfMinDist||s.itfMinDistComputed)){if(s.isNonPersistentPIM&&(!s.itfQtfPt1||!s.itfQtfPt2)){let e=function(){var e=null,t=1===de.getViewer().getVisibleSpace()?"visibleSpace":"invisibleSpace";if(Object.keys(le).forEach(function(n){if((le[n][0]||le[n][1])&&fe[n]){let i=fe[n];if(!i)return;i.children.forEach(n=>n.children.forEach(n=>{var i=n.children[0].getBoundingSphere(t);i.applyMatrix4(n.children[0].getMatrix()),i&&!i.empty()&&(e?e.mergeWithSphere(i,e):e=i)}))}}),e&&!e.isNaN())return e}();null!==e&&(s.itfQtfPt1=[e.center.x,e.center.y,e.center.z],s.itfQtfPt2=[e.center.x,e.center.y,e.center.z])}if(s.itfQtfPt1&&3===s.itfQtfPt1.length&&s.itfQtfPt2&&3===s.itfQtfPt2.length){if(d){if(d.r2scaInvMatrix){let e=d.r2scaInvMatrix;m=new n.Matrix4(e[0],e[3],e[6],e[9],e[1],e[4],e[7],e[10],e[2],e[5],e[8],e[11],0,0,0,1)}g.multiplyMatrices(f,m)}else g.multiplyMatrices(f,(new n.Matrix4).getInverse(f));if(Z.useStoredResults&&d&&d.multiClearVectors&&d.multiClearVectors.length%6==0){let e,t,n,a=d.multiClearVectors;for(let o=0;o<d.multiClearVectors.length/6;++o){n=6*o,e=[a[n++],a[n++],a[n++]],t=[a[n++],a[n++],a[n++]],u=[.5*(e[0]+t[0]),.5*(e[1]+t[1]),.5*(e[2]+t[2])],Array.prototype.push.apply(h,u);let l=z(o,c.children[0]).children[1];l.setMatrix(g),l.addChild(i(u,e,C)),l.addChild(i(u,t,C));let f=p(Math.sqrt((t[0]-e[0])*(t[0]-e[0])+(t[1]-e[1])*(t[1]-e[1])+(t[2]-e[2])*(t[2]-e[2])),!1);f&&r(l,[f],u,s.pos3D,3*o,T,C)}c.__pimQuantifierDone=!0}if((s.isNonPersistentPIM||Z.useStoredResults)&&s.itfSystemType===V){let e=z(0,c.children[2]).children[1];e.setMatrix(g);let t=p(s.itfPenVol,!0),a=p(s.itfPenVec,!1),o=[];if(t&&o.push(t),a&&o.push(a),d&&d.clashOnlyPenVector&&6===d.clashOnlyPenVector.length){let t,n;u=[.5*((t=[(n=[d.clashOnlyPenVector[0],d.clashOnlyPenVector[1],d.clashOnlyPenVector[2]])[0]+d.clashOnlyPenVector[3],n[1]+d.clashOnlyPenVector[4],n[2]+d.clashOnlyPenVector[5]])[0]+n[0]),.5*(t[1]+n[1]),.5*(t[2]+n[2])],Array.prototype.push.apply(h,u),e.addChild(i(t,n,y)),r(e,o,u,s.pos3D,3*(s.pos3D.length/3-1),w,y)}else if(s.itfPenVec||s.itfPenVol){let t=d&&d.r2scaInvMatrix?(new n.Matrix4).getInverse(m):f,a=new n.Vector3(s.itfQtfPt1[0],s.itfQtfPt1[1],s.itfQtfPt1[2]).applyMatrix4(t),l=new n.Vector3(s.itfQtfPt2[0],s.itfQtfPt2[1],s.itfQtfPt2[2]).applyMatrix4(t);u=[.5*(l.x+a.x),.5*(l.y+a.y),.5*(l.z+a.z)],Array.prototype.push.apply(h,u),a=[a.x,a.y,a.z],l=[l.x,l.y,l.z],e.addChild(i(l,a,y)),r(e,o,u,s.pos3D,3*(s.pos3D.length/3-1),w,y)}}else if(s.itfSystemType===F&&!c.__pimQuantifierDone){let e=z(0,c.children[0]).children[1];e.setMatrix(g);let t=d&&d.r2scaInvMatrix?(new n.Matrix4).getInverse(m):f,a=new n.Vector3(s.itfQtfPt1[0],s.itfQtfPt1[1],s.itfQtfPt1[2]).applyMatrix4(t),o=new n.Vector3(s.itfQtfPt2[0],s.itfQtfPt2[1],s.itfQtfPt2[2]).applyMatrix4(t);u=[.5*(o.x+a.x),.5*(o.y+a.y),.5*(o.z+a.z)],Array.prototype.push.apply(h,u),a=[a.x,a.y,a.z],o=[o.x,o.y,o.z],e.addChild(i(u,a,C)),e.addChild(i(u,o,C));let l=p(s.itfMinDist||s.itfMinDistComputed,!1);l&&r(e,[l],u,s.pos3D,3*(s.pos3D.length/3-1),T,C)}c.__pimQuantifierDone=!0,l.useStoredResults||s.itfSystemType!==F||Object.keys(fe).forEach(e=>fe[e].children.forEach(e=>e.children.forEach(e=>e.children[1].setVisibility(l.quantifiers.minDist))))}}}}(),Y=function(n,d,g){Array.isArray(n)&&de&&(e?(Object.keys(fe).forEach(function(e){-1===n.indexOf(e)&&Ve(e)}),n.reduce(function(e,t){return e.then(function(){return new Promise(function(e){var n,a,o=ee[t];if(!(o&&A(he,o.itfPath1)&&O(he,o.itfPath1)&&A(he,o.itfPath2)&&O(he,o.itfPath2)))return;if(n=L(o.itfPath1,he),o.featPath1&&(n.externalPath=n.externalPath.concat(o.featPath1.externalPath),n.internalPath=o.featPath1.internalPath),a=L(o.itfPath2,he),o.featPath2&&(a.externalPath=a.externalPath.concat(o.featPath2.externalPath),a.internalPath=o.featPath2.internalPath),!(n&&n.checkExternalPath()&&a&&a.checkExternalPath()))return;let l=fe[t];l||(l=fe[t]=new i(t),X.add(l),l.add(new i(F)),l.add(new i(k)),l.add(new i(V))),setTimeout(function(){(o.mRepRef?new Promise(e=>{oe[o.mRepRef]=null,r._readMetricGeomStream({repRefID:o.mRepRef,onComplete:function(t){t&&t.infos&&"OK"===t.infos.status&&t.buffer&&(oe[o.mRepRef]=JSON.parse(t.buffer)),e()}})}):Promise.resolve()).then(()=>{q(t,n,a,d).then(()=>{H(t,n,a,d),delete oe[o.mRepRef],de.getViewer().render(),e()})})},0)})})},Promise.resolve()).then(()=>{!g&&Pe.zoom&&Le()})):require(["DS/Visualization/SceneGraphFactory","DS/Mesh/Mesh","DS/PIMwebViewController/PIMWebViewTools","DS/SceneGraphNodes/ArrowNode","DS/Manipulators/ScreenPlaneManipulator","DS/SceneGraphNodes/FixedSizeNode3D","DS/SceneGraphNodes/BillBoardNode3D","DS/SceneGraphNodes/CanvasNodeTexture","DS/Visualization/PathElement","DS/SceneGraphNodes/CanvasNode","DS/PIMwebViewController/PIMwebLeaderNode","DS/Visualization/ModelLoader"],function(i,r,b,y,I,C,P,v,w,D,S,M){e=i,t=r,o=y,s=C,c=P,a=b,f=v,u=D,h=I,l=S,p=M,m=w,ke(n,d,g)}))};return Y.updateColors=function(){y.set((Z.partsOverload||Z.colors).itfType[0]),I.set((Z.partsOverload||Z.colors).itfType[1]),C.set((Z.partsOverload||Z.colors).itfType[2])},Y}();function Fe(){let e=Object.keys(le).length;se[0].enable(e>0),se[1].enable(e>0),100===k?(se[0].enable(!1),se[1].enable(!1)):se[0].setOpacity(k/100,!1),Object.keys(le).forEach(function(e){le[e][4]&&(le[e][4].enable(100!==k),100!==k&&le[e][4].setOpacity(.8,!0))})}function Ne(){Object.keys(le).forEach(function(e){var t=ee[e];if(!t)return;let n=le[e][0],i=le[e][1];var r;Pe.colorsState?0===(Z.partsOverload||Z.colors).type?Pe.colorsState&&(n&&n.setColor((Z.partsOverload||Z.colors).parts[0],!1),i&&i.setColor((Z.partsOverload||Z.colors).parts[1],!1)):("Clash"===t.itfSystemType?r=(Z.partsOverload||Z.colors).itfType[0]:"Contact"===t.itfSystemType?r=(Z.partsOverload||Z.colors).itfType[1]:"Clearance"===t.itfSystemType&&(r=(Z.partsOverload||Z.colors).itfType[2]),r&&(n&&n.setColor(r,!1),i&&i.setColor(r,!1))):(n&&n.setColor(null,!1),i&&i.setColor(null,!1));if(Pe.transparencyState)if(255===Z.partsOverload.transparency)n&&(n.setVisibility(!1,!1),n.setVisibilityFree(!0,!1)),i&&(i.setVisibility(!1,!1),i.setVisibilityFree(!0,!1));else{n&&(n.setVisibility(null,!1),n.setVisibilityFree(null,!1)),i&&(i.setVisibility(null,!1),i.setVisibilityFree(null,!1));let e=(255-Z.partsOverload.transparency)/255;n&&n.setOpacity(e,!0),i&&i.setOpacity(e,!0)}else n&&n.resetOpacity(),i&&i.resetOpacity()})}function Ue(e){let t=le[e];t&&t.forEach(e=>e&&B.deleteOverride(e)),delete le[e]}let _e=function(){let e,t=function(e,n,i){if("1"===i.getAttributeCategory())return i.getAnnotationUuid()===n?e.feat=i:i.children.some(t.bind(null,e,n))},n=(n,i)=>{let r=[],a=[];n.forEach(t=>(e.hasAlreadyBeenLoaded(t.repRefID)?r:a).push(t)),(a.length?new Promise(function(t){let i=[],o=function(a){r.push(a.partNode),(r.length===n.length||ve)&&(i.forEach(e.unsubscribe,e),t())};i.push(e.subscribe("onAnnotationSetLoadingFailed",o)),i.push(e.subscribe("onNoAnnotationSetLoaded",o)),i.push(e.subscribe("onAnnotationSetLoaded",o)),i.push(e.subscribe("onAnnotationSetLoadingCanceled",o)),ve&&i.push(e.subscribe("onAnnotationSetRemoved",o)),e.setActiveState(2),a.forEach(t=>e.loadFTAModel({idPath:[t.repRefID]}))}):Promise.resolve()).then(function(){!function(e,n){n(e.map(e=>{let n=he.getNode({id:e.repRefID});return(n&&n.getChildren()||[]).some(function(i){if(!i.getRootAnnotationNode)return;let r={};if(i.getRootAnnotationNode("RootAttributes").children.some(t.bind(null,r,e.featID)),r.feat){let t=r.feat.getAnnotationTTRS();return(t.length&&i.getTTRSs()||[]).some(function(t){if(t.tpsID!==this)return;let i;if(n.children.some(e=>i=e.getPathElement&&e.setInternalSceneGraph&&e),i){let n=i.getPathElement(t.geoP,{externalPath:[i]});e.repRepPath=n&&n.length&&n[0]}return!0},t[0]),!0}}),e}))}(n,i)})};return function(t){return t.length?new Promise(function(i){e?n(t,i):require(["DS/CAT3DAnnotationModelLoader/CAT3DAnnotationModelLoader"].concat([]),function(r){e=r.getAnnotationModelLoader({context:de}),n(t,i)})}):Promise.resolve()}}();function Ge(e){return new Promise(t=>{if(e=ee[e]?e:Ae(e),!ee.hasOwnProperty(e)||le.hasOwnProperty(e))return void t();let n=ee[e],i=[null,null,null,null,null],r=[!1,!1],a=[[],[]],o=[[],[]],l=[];if(n){delete n.featPath1,delete n.featPath2,[n.itfPath1,n.itfPath2].forEach(function(e,t){if(e&&e.length){var n=e.map(function(e){return e.physicalid});T(he,n)?r[t]=n[n.length-1]:r[t]=n;var s,c=n.slice(),f=function(e){if(!e)return null;var t,n,i;if(e.some(function(e,t){return e.isBundleFst&&(n=t),e.isBundleFst})&&n+2<e.length)for(i=[],n+=3,t=0;t<n;++t)i.push(e[t].physicalid);return i}(e);c.unshift(Ce),s=[new b(c)],f&&(f.unshift(Ce),s.push(new b(f)),l.push(s[1])),i[t]=B.createIdPathOverride({idPathes:s}),a[t].push(s[0]);for(var u=c;u.length;)o[t].push(new b(u)),u=u.slice(0,u.length-1)}}),(i[0]||i[1])&&(le[e]=i,l.length&&(i[4]=B.createIdPathOverride({idPathes:l})),i[0]&&(i[2]=B.createIdPathOverride({idPathes:o[0]}),i[2].setPickability("PICKABLE")),i[1]&&(i[3]=B.createIdPathOverride({idPathes:o[1]}),i[3].setPickability("PICKABLE")));var s=r.map(function(e){return e?"string"==typeof e?new Promise(function(t){he.lockNodes({ids:[e]}),t(e)}):new Promise(function(t){he.expand({paths:[e],withFrustumFilter:!1,onComplete:function(){if(T(he,e)){var n=e[e.length-1];he.lockNodes({ids:[n]}),t(n)}else t(!0)},onFailure:function(){t(!0)}},!1,!1,!1)}):Promise.resolve(!1)});Promise.all(s).then(function(e){!0!==e[0]&&!0!==e[1]||p.updateInterferences(Te([function(e,t){return t.forEach(function(t,n){!0===t&&R[n].forEach(function(t){e[t]=void 0})}),e}(n,e)]));let i=[],r=[];var a;"string"==typeof e[0]&&(n.itfFeat1?i.push({repRefID:e[0],featID:n.itfFeat1}):r.push(e[0])),"string"==typeof e[1]&&(n.itfFeat2?i.push({repRefID:e[1],featID:n.itfFeat2}):r.push(e[1])),(r.length||i.length)&&(r.forEach(he.lockRepresentationMeshInRAM,he),Promise.all([(a=r,a.length?new Promise(e=>{he.setForceReferencesLoad({data:a.map(e=>({id:e,state:!0})),callback:e})}):Promise.resolve()),_e(i)]).then(e=>{(e[1]||[]).forEach(e=>{e.repRepPath&&(n.itfFeat1&&n.itfFeat1===e.featID?n.featPath1=e.repRepPath:n.itfFeat2&&n.itfFeat2===e.featID&&(n.featPath2=e.repRepPath))}),r.length&&he.setForceReferencesLoad({data:r.map(e=>({id:e,state:!1}))}),t(!0)}),Ne(),Fe(),de.getViewer().render())})}else t()})}function Be(e){if(e){if(N&&"itfLblSlide"===e.cellClickedIdx&&te[e.idCellClicked].row.itfLblSlide)return e.idCellClicked=te[e.idCellClicked].row.ctxChilds?te[e.idCellClicked].row.ctxChilds:e.idCellClicked,void xe("onApplicativeContextRequested",{id:"ITF",data:e.idCellClicked});Promise.all(e.idsSelected.map(Ge)).then(e=>{e.some(e=>e)&&(Pe.zoom||Le(),ke(Oe(),H||Z))}),N&&!G&&xe("onApplicativeContextChanged",{id:"ITF"}),_=!1}}function We(e,t){if(e){var n=[];e.forEach(function(e){var t=(e=ee[e]?e:Ae(e))?ee[e]:null;t&&[t.itfPath1,t.itfPath2].forEach(function(e){e&&e.length&&n.push(e[e.length-1].physicalid)}),Ue(e)}),n.length&&he.unlockNodes({ids:n}),n.forEach(he.unlockRepresentationMeshInRAM,he),t||(Fe(),de.getViewer().render(),Le(),ke(Oe(),H||Z)),N&&!G&&xe("onApplicativeContextChanged",{id:"ITF"}),_=!1}}function je(){if(w){var e,t=0,n=0,i=0;Object.keys(ee).forEach(function(e){var r=ee[e],a=r.itfUserType,o=r.itfSystemType;"Clash"===a?t++:"Contact"===a?n++:"Clearance"===a?i++:"Undefined"!==a&&a||("Clash"===o?t++:"Contact"===o?n++:"Clearance"===o&&i++)}),(t||n||i)&&(e=t?t+" "+S["Clash"+(t>1?"es":"")]:"",e+=e&&n?" ":"",e+=n?n+" "+S["Contact"+(n>1?"s":"")]:"",e+=e&&i?" ":"",e+=i?i+" "+S["Clearance"+(i>1?"s":"")]:""),e=e||S.noItf;var r=Object.keys(ce);if(r.length){r.length>1&&window.console.error("More than one simulation in session???");var a=c.getIsr(r[0]),o=a?a.getAttributes().label:void 0;e+=o?" - "+o:""}w.updatePanelTitle(e)}}function Xe(e){if(!pe){e.id=ee[e.id]?e.id:Ae(e.id);var n=ee[e.id].itfModelId,i=c.getIsr(n),r=[],a=function(n){if(n.some(function(t){return t.id===e.id})){r.forEach(function(e){i.unsubscribe(e)}),r.length=0;var a=n.map(function(e){var n=i.getInterferences(e.id)[0],r=ee[e.id];return t.extend(r,n,!1),r});p&&(p.updateInterferences(Te(a)),je())}};r.push(i.subscribe("itfUpdateSuccess",a)),r.push(i.subscribe("itfUpdateFailed",a)),i.updateInterference({id:e.id,param:e.param,newValue:e.newValue}),"itfUserType"===e.param&&(ee[e.id].itfUserType=e.newValue,je())}}function Qe(){return N||pe?[]:[{title:S.issueTitle,type:"PushItem",icon:C.getWebappsAssetUrl("PIMwebUX","icons/22/")+"I_DMUIssue.png",action:{callback:function(){require("DS/ApplicationFrame/CommandsManager").getCommand("CATWebUXGenerateIssueHdr",de.getCommandContext()).begin()}}},{title:S.caTitle,type:"PushItem",icon:C.getWebappsAssetUrl("PIMwebUX","icons/22/")+"I_VALCA.png",action:{callback:function(){require("DS/ApplicationFrame/CommandsManager").getCommand("CATWebUXGenerateCAHdr",de.getCommandContext()).begin()}}},{type:"PushItem",title:S.itfExportToCSV,callback:function(){},submenu:[{title:S.itfAllVisible,type:"RadioItem",action:{callback:function(){require("DS/ApplicationFrame/CommandsManager").getCommand("PIMwebExportFilteredHdr",de.getCommandContext()).begin()}}},{title:S.itfSelected,type:"RadioItem",action:{callback:function(){require("DS/ApplicationFrame/CommandsManager").getCommand("PIMwebExportSelectedHdr",de.getCommandContext()).begin()}}}]}]}function ze(){if(F){var e=de.getFrameWindow().getImmersiveFrame(),t=[WUXDockAreaEnum.TopDockArea,WUXDockAreaEnum.LeftDockArea,WUXDockAreaEnum.RightDockArea].map(function(t){var n=0,i=e.getDockingElement(t),r=i.getContainedWindows(),a=!1;if(r&&r.length&&(r[0].isAWindowGroup()&&r[0].getEmbeddedWindows().length||!r[0].isAWindowGroup())){for(var o=r[0].getEmbeddedWindows?r[0].getEmbeddedWindows():r,l=0;l<o.length;l++)if(o[l].visibleFlag){a=!0;break}a&&(n=(i.collapseDockingZoneFlag?0:i.dockingZoneSize)+i._collapserSize)}return!a&&i.interactiveDockAreaVisibleFlag&&(n=i.dockingZoneSize+i._collapserSize),n});F.setPosition({top:String(t[0])+"px",left:String(.5*(e.getFreeZone().getSize().width-F.getSize().width)+t[1])+"px"})}}function qe(e){return function(e,t,n){var i,a,o,l,s=[],f={},u={};if(!t||0===t.length||!e)return Promise.resolve(s);if(c.getIsr(t[0].itfModelId)){if(0===(o=c.getIsr(t[0].itfModelId).getIsrContexts().map(function(e){return e.prd.physicalid})).length)return Promise.resolve(s);if(o.filter(function(e){return-1===n.indexOf(e)}).length)return Promise.resolve(s)}for(i=0,a=t.length;i<a;++i){var d=t[i];if(d&&(d.itfPath1||d.itfPath2)&&!d.isNonPersistentPIM){var h,p;if(d.itfPath1&&d.itfPath1.length>=3){h=!0,d.itfLblShape1=d.itfPath1[d.itfPath1.length-1].label,d.itfLblShape1Owner=d.itfPath1[d.itfPath1.length-1].owner,d.itfLblShape1OwnerID=d.itfPath1[d.itfPath1.length-1].ownerID,d.itfLblMaturity1Shape=d.itfPath1[d.itfPath1.length-1].current,d.itfLblOrganization1Shape=d.itfPath1[d.itfPath1.length-1].organization,d.itfLblCollabSpace1Shape=d.itfPath1[d.itfPath1.length-1].project,d.itfLblRevision1Shape=d.itfPath1[d.itfPath1.length-1].revision,d.itfPath1.length>=4&&(d.itfLblInst1=d.itfPath1[d.itfPath1.length-4].label,d.itfLblInst1Owner=d.itfPath1[d.itfPath1.length-4].owner,d.itfLblInst1OwnerID=d.itfPath1[d.itfPath1.length-4].ownerID),d.itfLblRef1=d.itfPath1[d.itfPath1.length-3].pn?d.itfPath1[d.itfPath1.length-3].pn:d.itfPath1[d.itfPath1.length-3].label,d.itfLblRef1Owner=d.itfPath1[d.itfPath1.length-3].owner,d.itfLblRef1OwnerID=d.itfPath1[d.itfPath1.length-3].ownerID,d.itfLblMaturity1Ref=d.itfPath1[d.itfPath1.length-3].current,d.itfLblRevision1Ref=d.itfPath1[d.itfPath1.length-3].revision,d.itfLblOrganization1Ref=d.itfPath1[d.itfPath1.length-3].organization,d.itfLblCollabSpace1Ref=d.itfPath1[d.itfPath1.length-3].project,d.itfLblInst1Path=d.itfLblRef1Path="",d.itfLblInst1Path=d.itfPath1[0].pn?d.itfPath1[0].pn:d.itfPath1[0].label;for(var m=0;m<=d.itfPath1.length-3;m++)m%2?d.itfLblInst1Path+="\\"+d.itfPath1[m].label:(0!==m&&(d.itfLblRef1Path+="\\"),d.itfLblRef1Path+=d.itfPath1[m].pn?d.itfPath1[m].pn:d.itfPath1[m].label,d.itfPath1[m].isBundleFst&&m+2<d.itfPath1.length&&(d.itfLblFstInst1=d.itfPath1[m+1].label,d.itfLblFstRef1=d.itfPath1[m+2].label,l=d.itfLblFstType1=d.itfPath1[m+2].type,f[l]||(f[l]=[]),f[l].push(d)))}if(d.itfPath2&&d.itfPath2.length>=3){p=!0,d.itfLblShape2=d.itfPath2[d.itfPath2.length-1].label,d.itfLblShape2Owner=d.itfPath2[d.itfPath2.length-1].owner,d.itfLblShape2OwnerID=d.itfPath2[d.itfPath2.length-1].ownerID,d.itfLblMaturity2Shape=d.itfPath2[d.itfPath2.length-1].current,d.itfLblOrganization2Shape=d.itfPath2[d.itfPath2.length-1].organization,d.itfLblCollabSpace2Shape=d.itfPath2[d.itfPath2.length-1].project,d.itfLblRevision2Shape=d.itfPath2[d.itfPath2.length-1].revision,d.itfPath2.length>=4&&(d.itfLblInst2=d.itfPath2[d.itfPath2.length-4].label,d.itfLblInst2Owner=d.itfPath2[d.itfPath2.length-4].owner,d.itfLblInst2OwnerID=d.itfPath2[d.itfPath2.length-4].ownerID),d.itfLblRef2=d.itfPath2[d.itfPath2.length-3].pn?d.itfPath2[d.itfPath2.length-3].pn:d.itfPath2[d.itfPath2.length-3].label,d.itfLblRef2Owner=d.itfPath2[d.itfPath2.length-3].owner,d.itfLblRef2OwnerID=d.itfPath2[d.itfPath2.length-3].ownerID,d.itfLblMaturity2Ref=d.itfPath2[d.itfPath2.length-3].current,d.itfLblRevision2Ref=d.itfPath2[d.itfPath2.length-3].revision,d.itfLblOrganization2Ref=d.itfPath2[d.itfPath2.length-3].organization,d.itfLblCollabSpace2Ref=d.itfPath2[d.itfPath2.length-3].project,d.itfLblInst2Path=d.itfLblRef2Path="",d.itfLblInst2Path=d.itfPath2[0].pn?d.itfPath2[0].pn:d.itfPath2[0].label;for(var g=0;g<=d.itfPath2.length-3;g++)g%2?d.itfLblInst2Path+="\\"+d.itfPath2[g].label:(0!==g&&(d.itfLblRef2Path+="\\"),d.itfLblRef2Path+=d.itfPath2[g].pn?d.itfPath2[g].pn:d.itfPath2[g].label,d.itfPath2[g].isBundleFst&&g+2<d.itfPath2.length&&(d.itfLblFstInst2=d.itfPath2[g+1].label,d.itfLblFstRef2=d.itfPath2[g+2].label,l=d.itfLblFstType2=d.itfPath1[g+2].type,u[l]||(u[l]=[]),u[l].push(d)))}(h||p)&&s.push(d)}}return Object.keys(f).length||Object.keys(u).length?new Promise(function(e){r._getTypeNLS(Object.keys(f).concat(Object.keys(u))).then(function(t){Object.keys(t).forEach(function(e){f[e]&&f[e].forEach(function(n){n.itfLblFstType1=t[e]}),u[e]&&u[e].forEach(function(n){n.itfLblFstType2=t[e]})}),e(s)})}):Promise.resolve(s)}(he,e,Q).then(function(){p&&p.updateInterferences(Te(e))})}function He(e){if(U&&(!ve||0!==Object.keys(ce).length)){var t=[],n=e?e.map(function(e){return e.itfuid}):Object.keys(ee),i=!0;n.forEach(function(e){ee[e].itfLblSlide&&(ee[e].itfLblSlide=0,t.push(e),ee[e].itfNonUniqueSlide&&(ee[e].itfNonUniqueSlide.length=0))});var r=Object.keys(ce);return r=r.length?r[0]:null,U.forEach(function(e){var a=e.state?e.state.context:null;if(!(a&&a.data&&a.data.length&&a.data[0].isr===r&&a.data[0].itfs))return window.console.error("Unexpected!"),void(U=null);a.data[0].itfs.forEach(function(e){ee[e]&&n.indexOf(e)>-1?(ee[e].itfLblSlide||(ee[e].itfLblSlide=0),++ee[e].itfLblSlide,ee[e].itfNonUniqueSlide||(ee[e].itfNonUniqueSlide=[]),ee[e].itfNonUniqueSlide.push(a.data[0].itfs),-1===t.indexOf(e)&&t.push(e)):i=!1})}),i&&(U=null),t}}function Ke(e){W&&B&&-1===W.getSceneGraphOverrideSetIndex(B)&&W.pushSceneGraphOverrideSet(B),e.forEach(function(e){var t=ee[e.itfuid];t&&t.itfLblSlide&&(e.itfLblSlide=t.itfLblSlide),ee[e.itfuid]=e}),qe(e),He(e),je()}function Je(){p&&p.removeInterferences(),ee={},te={},je(),Object.keys(le).forEach(Ue),Fe(),ke([]),z&&z.setActiveState(!1),de.getViewer().render()}function Ze(e){var t=window.widget.getValue("xsceneStoredObjects"),n=[];t&&"string"==typeof t||(t='{"products":{},"filters":{}}'),t=JSON.parse(t),"boolean"==typeof e?(window.widget.setValue("ItfSimuInSession",JSON.stringify(ce)),Object.keys(ce).forEach(function(e){var i=ce[e];i.length?(t.itf||(t.itf={}),i.forEach(function(n){t.itf[n]=e}),n=n.concat(i)):(t.isr||(t.isr={}),t.isr[e]={},n.push(e),t.itf&&(n=n.concat(Object.keys(t.itf))))}),window.widget.setValue("xsceneStoredObjects",JSON.stringify(t))):(window.widget.deleteValue("ItfSimuInSession"),t.itf&&Object.keys(t.itf).forEach(function(i){t.itf[i]===e&&-1===n.indexOf(i)&&n.push(i)}),t.isr&&Object.keys(t.isr).indexOf(e)>=0&&n.push(e)),require(["DS/PADServices/utils/GlobalModelEvents"],function(e){e.publish({event:"ENXViews/LandingPage/refreshCustom",data:n})})}function Ye(e){e&&ce[e]&&(p&&We(Oe(),!0),c.unlockIsr(e),delete ce[e],Je(),Ze(e),xe("onIsrRemoved",{isrLog:t.clone(ce,!0),removedIsr:e}),xe("onDMUCtxtRemoved"))}function $e(){var e=[],t=c.getLoadedIsr();Object.keys(ce).forEach(function(n){e=e.concat(t[n].getIsrContexts()).map(e=>e.prd.physicalid),Ye(n)}),e.length&&de.removeRoots({pids:e})}function et(e){j||(j={isrID:[],metricID:[]},z&&z.setActiveState(!1),setTimeout(function(){let n,i,r,a,o,l=!1,s=Object.keys(ce),f=0,u=!0,d=!1,h=!e.noNotif;if(s.length>1&&window.console.log("More than 1 interference simulation loaded. This must not be possible!!"),j.isrID.length>0){j.isrID.length>1&&h&&de.displayNotification({msg:D.pimSingleIsr,eventID:"info"}),a=j.isrID[0];var p=j.metricID.length;if(ce[a]?0===ce[a].length&&(u=!1):(l=!0,$e(),(ce={})[a]=[]),u){n=function(e){e&&(d=!0,l&&c.lockIsr(e.isrID),je()),0===f&&d&&(de.unsubscribe(i),de.unsubscribe(r),h&&de.displayNotification({msg:D.itfCtrlMsgSuccess,eventID:"success"}),p&&h&&de.displayNotification({msg:D[p>1?"pimMetricsIgnored":"pimMetricIgnored"],eventID:"info"}),Ze(!0),j=null,xe("onIsrAdded",{isrLog:t.clone(ce,!0),loadedIsr:a}),xe("onDMUCtxtLoadingSuccess"))};var b="1"===(1===e.loadMode?"1":0===e.loadMode?"0":localStorage.getItem("PIMwebContextLoadMode"))?"InterferingPartsOnly":"AllParts";c.loadIsr({isrID:a,onProgress:function(e){if("AllParts"===b&&e.context)if(e.context.length){var t=e.context;if(ce[a]&&ce[a].length?ce[a].length=0:t=e.context.filter(function(e){return-1===Q.indexOf(e.prd.physicalid)}),t.length>0){f+=t.length,i||r||(i=de.subscribe({event:"onRootAdded"},function(){f=0,n()}),r=de.subscribe({event:"onRootAlreadyExisting"},function(){f=0,n()}));var l=[],s=[];t.forEach(function(e){e.filter&&e.filter.physicalid&&"ENOStrRefinementSpecification"===e.filter.type?s.push({objectId:e.filter.physicalid}):e.prd&&e.prd.physicalid&&l.push({path:[e.prd.physicalid]})}),l.length&&de.addRoots({objects:l},!0,!1),s.length&&de.addFilter(s)}else h&&de.displayNotification({msg:D.itfCtrlMsgCtxAlreadyLoaded,eventID:"info"})}else h&&de.displayNotification({msg:D.itfCtrlMsgNoContext,eventID:"info"});var u,d=e.isrID?c.getIsr(e.isrID):null,p=d&&e.itfIDs?d.getInterferences(e.itfIDs):null;if("InterferingPartsOnly"===b&&e.interferingPathsReady&&p){de.getAutomaticReframePolicy()&&(de.setAutomaticReframePolicy(!1),u=1);var m=[];for(p.forEach(function(e){e.itfPath1&&m.push(e.itfPath1.map(function(e){return e.physicalid})),e.itfPath2&&m.push(e.itfPath2.map(function(e){return e.physicalid}))}),o=m.length-1;o>=0;--o)m[o].every(function(e){return he.getNode({id:e})})&&m.splice(o,1);!(f+=m.length)||i||r||(i=de.subscribe({event:"onRootAdded"},function(){f--,1===u&&(de.reframe(),u=2),0===f&&(2===u&&de.setAutomaticReframePolicy(!0),n())}),r=de.subscribe({event:"onRootAlreadyExisting"},function(){0===--f&&n()})),f&&de.addRoots({objects:m.map(function(e){return{path:e}})},!0,!1)}p&&Ke(p)},onComplete:n,onFailure:function(e){de.unsubscribe(i),de.unsubscribe(r),ce={},"Simulation"===e.step?h&&de.displayNotification({msg:D.itfCtrlMsgNotFound,eventID:"warning"}):h&&de.displayNotification({msg:D.itfCtrlMsgError,eventID:"warning"}),je();var t={};t[a]=[],j=null,xe("onIsrAddFailed",t),xe("onDMUCtxtLoadingFailure")}})}else{h&&de.displayNotification({msg:D.itfCtrlMsgSimuAlreadyLoaded,eventID:"info"});var y={};y[a]=[],j=null,xe("onIsrAlreadyLoaded",y),xe("onDMUCtxtAlreadyLoaded")}}else if(j.metricID.length>0){var I=0,C=[],P=0,v=j.metricID.length;s.length&&(u=!j.metricID.every(function(e){return s.some(function(t){return ce[t].indexOf(e)>-1})})),u?(n=function(e){if(e)l&&c.lockIsr(e.isrID),je();else{if(j=null,0!==f)return;de.unsubscribe(i),de.unsubscribe(r),C.length?(h&&de.displayNotification({msg:D[C.length>1?"pimMetricsLoadOK":"pimMetricLoadOK"],eventID:"success"}),Ze(!0),xe("onItfAdded",{isrLog:t.clone(ce,!0),loadedIsr:Object.keys(ce)[0],loadedMetrics:C}),xe("onDMUCtxtLoadingSuccess")):v?(h&&de.displayNotification({msg:D[v>1?"pimMetricsAlreadyLoaded":"pimMetricAlreadyLoaded"],eventID:"info"}),xe("onItfAlreadyLoaded"),xe("onDMUCtxtAlreadyLoaded")):(xe("onIsrItfNothingAdded"),xe("onDMUCtxtNotAdded")),P&&h&&de.displayNotification({msg:D[P>1?"pimIgnoredMetrics":"pimIgnoredMetric"],eventID:"info"}),I&&h&&de.displayNotification({msg:D[I>1?"pimMetricsNoIsr":"pimMetricNoIsr"],eventID:"info"})}},c.loadIsrFromMetrics({metrics:j.metricID,onFilterIsr:function(e){function n(t){e.onComplete(t)}var i=Object.keys(e.isrIDs);if(0===i.length)return I=e.metricsWithoutIsr.length,v=0,void n([]);if(s.length&&i.indexOf(s[0])>-1){for(a=s[0],v=e.isrIDs[a].itfM.length,o=1;o<i.length;++o)i[o]!==a&&(P+=e.isrIDs[i[o]].itfM.length);if(0===ce[a].length)return void n([]);if(e.isrIDs[a].itfM.every(function(e){return ce[a].indexOf(e)>-1}))return void n([])}else{for(a=i[0],v=e.isrIDs[a].itfM.length,o=1;o<i.length;++o)v<e.isrIDs[i[o]].itfM.length?(a=i[o],P+=v,v=e.isrIDs[i[o]].itfM.length):P+=e.isrIDs[i[o]].itfM.length;if(s.length){var r,c=new g({onClick:function(){r.destroy(),$e(),n([a]),l=!0,ce[a]=[]}}),f=new g({onClick:function(){r.close()}});return void(r=new m({identifier:"PIMwebIsrRemovePanel",modalFlag:!0,title:D.pimIsrRemoveTitle,content:new t.Element("div",{html:"<p>"+(P?D.pimIsrRemoveMsg2:D.pimIsrRemoveMsg1)+"</p><p><b>"+e.isrIDs[a].label+"</b></p>"}),width:350,immersiveFrame:de.getFrameWindow().getImmersiveFrame(),buttons:{Ok:c,Cancel:f}})).addEventListener("close",function(){P=v=0,n([])})}l=!0,ce[a]=[]}n([a])},onProgress:function(e){var t=e.isrID?c.getIsr(e.isrID):null,a=t&&e.itfIDs?t.getInterferences(e.itfIDs):null;if(e.interferingPathsReady){var l=[];for(a.forEach(function(e){e.itfPath1&&l.push(e.itfPath1.map(function(e){return e.physicalid})),e.itfPath2&&l.push(e.itfPath2.map(function(e){return e.physicalid}))}),o=l.length-1;o>=0;--o)l[o].every(function(e){return he.getNode({id:e})})&&l.splice(o,1);!(f+=l.length)||i||r||(i=de.subscribe({event:"onRootAdded"},function(){0===--f&&n()}),r=de.subscribe({event:"onRootAlreadyExisting"},function(){0===--f&&n()})),f&&de.addRoots({objects:l.map(function(e){return{path:e}})},!0,!1)}a&&Ke(a),e.metrics&&e.metrics.forEach(function(t){-1===ce[e.isrID].indexOf(t)&&ce[e.isrID].push(t),-1===C.indexOf(t)&&C.push(t)})},onComplete:n,onFailure:function(e){de.unsubscribe(i),de.unsubscribe(r),e&&e.isrID&&ce[e.isrID]&&0===ce[e.isrID].length&&(ce={}),je(),h&&de.displayNotification({msg:D[v>1?"pimMetricsLoadKO":"pimMetricLoadKO"],eventID:"warning"}),j=null,xe("onItfAddFailed"),xe("onDMUCtxtLoadingFailure")}})):(h&&de.displayNotification({msg:D[j.metricID.length>1?"pimMetricsAlreadyLoaded":"pimMetricAlreadyLoaded"],eventID:"info"}),j=null,xe("onItfAlreadyLoaded"),xe("onDMUCtxtAlreadyLoaded"))}},0)),e.isrID&&(j.isrID=j.isrID.concat(e.isrID)),e.metricID&&(j.metricID=j.metricID.concat(e.metricID))}function tt(){if(!F){var e=function(){var e={userValue:10,checkedButton:0},t=localStorage.getItem("PIMwebOpacityPref");if("string"==typeof t){var n=t.split("-"),i=Number(n[1]),r=Number(n[2]);"number"==typeof i&&(e.userValue=0<=i&&i<=100?i:e.userValue),"number"==typeof r&&(e.checkedButton=0<=r&&r<=2?r:e.checkedButton)}return e}();e.parent=de.getFrameWindow().getUIFrame(),k=2===e.checkedButton?100:1===e.checkedButton?0:e.userValue,(F=new f(e)).onOpacityChange=function(e){!function(e){var t="0-"+String(e.userValue)+"-"+String(e.checkedButton);localStorage.setItem("PIMwebOpacityPref",t)}(e),k=e.newValue,Fe(),de.getViewer().render()},de.getFrameWindow().getImmersiveFrame().addEventListener("freeZoneResize",ze)}}function nt(){if(!p){var e=["dragenter","dragover","drop"],t=!1,n=[],i={};(De.columns?De.columns:[]).forEach(function(e){i[e.dataIndex]={dataIndex:e.dataIndex,text:e.text,editableFlag:e.editableFlag,visibleFlag:!0},n.push(e.dataIndex)}),(w=new V({pad3DViewer:de,readOnly:pe,cbDnD:{onDragStartCell:c,onDragOverCell:a,onDragEndCell:l,onDragEnterBlank:a,onDragLeaveBlank:a,onDragOverBlank:a,onDragStartColumnHeader:o,onDragOverColumnHeader:function(e){return e.stopPropagation(),t||e.preventDefault(),!t},onDragEndColumnHeader:l,onDragStartRowHeader:c,onDragOverRowHeader:a,onDragEndRowHeader:l},prefUnitValues:K,deforder:n.length>0?n:void 0,defCols:Object.keys(i).length>0?i:void 0})).onClose=function(){$.hideGUX(),xe("onItfListClosed")},(p=w.getTreeListViewer()).onSelect=Be,p.onUnselect=We,p.onCellEdit=Xe,p.onContextualEvent=Qe,p.showSlideColumn(N);var r=Object.keys(ee).map(function(e){return ee[e]});r.length&&qe(r),je()}function a(e){e.stopPropagation()}function o(){var t=de.getViewer().canvas,n=de.getFrameWindow().getImmersiveFrame();return e.forEach(function(e){t.addEventListener(e,a),n.addEventListener(e,a)}),!0}function l(){var n=de.getViewer().canvas,i=de.getFrameWindow().getImmersiveFrame();return t=!1,e.forEach(function(e){n.removeEventListener(e,a),i.addEventListener(e,a)}),!0}function c(e,n){if(!p||!n)return!1;t=!0;var i={protocol:"3DXContent",version:"1.1",data:{items:[]},source:window.widget&&window.widget.getValue("x3dAppId")?window.widget.getValue("x3dAppId"):"ENOI3D_AP",widgetId:window.widget?window.widget.id:void 0},r=[];return Oe().forEach(function(e){var t=ee[e];-1===r.indexOf(t.mID)&&(r.push(t.mID),i.data.items.push({envId:u.getPlatformId(),serviceId:"3DSpace",contextId:s.getSetting("pad_security_ctx")?s.getSetting("pad_security_ctx"):void 0,objectId:t.mID,objectType:t.mType,displayName:t.itfMetricName}))}),e.dataTransfer.setData("Text",JSON.stringify(i)),o(),!1}}function it(){w&&w.hide(),F&&F.hide()}function rt(e,t){var n="";return e.forEach(function(e){n&&(n+=", "),"Issue"===t&&e.filter&&(n+=e.filter.label,n+=" ("),n+=e.prd.label,"Issue"===t&&e.filter&&(n+=")")}),n}function at(e){return new Promise(function(n){var i=c.getIsr(e.isr),a={reportedAgainst:[],contexts:[],assignees:[],attachments:[]};if(e.itf.length){var o=ee[e.itf[0]];a.title=o.itfMetricName,a.description=o.itfDescription?o.itfDescription:rt(i.getIsrContexts(),e.cmdType),i.getIsrContexts().forEach(function(t){a.contexts.push(t.prd.physicalid),"Issue"===e.cmdType&&t.filter&&a.contexts.push(t.filter.physicalid)}),e.itf.forEach(function(e){[ee[e].itfPath1,ee[e].itfPath2].forEach(function(e){var t,n;e&&e.length>2&&((t=e.some(function(e,t){return e.isBundleFst&&(n=t),e.isBundleFst})&&n+2<e.length?e[n+2]:e[e.length-3]).physicalid&&-1===a.reportedAgainst.indexOf(t.physicalid)&&a.reportedAgainst.push(t.physicalid),t.ownerID&&-1===a.assignees.indexOf(t.ownerID)&&a.assignees.push(t.ownerID))}),ee[e].mID&&-1===a.attachments.indexOf(ee[e].mID)&&a.attachments.push(ee[e].mID)}),r._sendUsageProbe("Issue"===e.cmdType?"GenerateIssue":"GenerateCA","NbMetric"+a.attachments.length),n(a)}else{var l,s,f,u,d,h;l=M.issueTitle,s=M.caTitle,f=M.issueOnIsr,u=M.caOnIsr,d=M.yes,h=M.no;var p=t.createElement("div"),b="Issue"===e.cmdType?f:u;t.createElement("label",{text:b,styles:{"margin-bottom":"0px",padding:"10px 0px"}}).inject(p);var y=new m({modalFlag:!0,ensureHeightDefinitionOnHierarchy:!0,title:"Issue"===e.cmdType?l:s,immersiveFrame:de.getFrameWindow().getImmersiveFrame(),content:p,closeButtonFlag:!0,buttons:{Ok:new g({label:d,onClick:function(){var t=i.getAttributes();a.title=t.label,a.description=t.description?t.description:rt(i.getIsrContexts(),e.cmdType),i.getIsrContexts().forEach(function(t){-1===a.reportedAgainst.indexOf(t.prd.physicalid)&&a.reportedAgainst.push(t.prd.physicalid),"Issue"===e.cmdType&&t.filter&&-1===a.reportedAgainst.indexOf(t.filter.physicalid)&&a.reportedAgainst.push(t.filter.physicalid),-1===a.contexts.indexOf(t.prd.physicalid)&&a.contexts.push(t.prd.physicalid),"Issue"===e.cmdType&&t.filter&&-1===a.contexts.indexOf(t.filter.physicalid)&&a.contexts.push(t.filter.physicalid),a.assignees.indexOf(-1===t.prd.ownerID)&&a.assignees.push(t.prd.ownerID),"Issue"===e.cmdType&&t.filter&&a.assignees.indexOf(-1===t.filter.ownerID)&&a.assignees.push(t.filter.ownerID)}),-1===a.attachments.indexOf(i.getAttributes().physicalid)&&a.attachments.push(i.getAttributes().physicalid),y.destroy(),n(a)}}),Cancel:new g({label:h,emphasize:"primary",onClick:function(){y.destroy(),a.status="ticCancel",n(a)}})}});y.addEventListener("close",function(){y.destroy(),n()})}})}de.getViewer().addNode(X=new i("PIMwebDecoration")),de.getViewer().getIdPathMatcher()||de.getViewer().setIdPathMatcher(new y({idToNodeCB:function(e){return he.getNode({id:e})},nodeToIdCB:function(e){return e===he.getRootBag()?Ce:l.getNodeID(e)},isNodeRepRefCB:function(e){return l.isRepReference(e)}})),W=de.getViewer().getSceneGraphOverrideSetManager(),B=W.createSceneGraphOverrideSet({rootNode:he.getRootBag(),rootId:Ce,name:"pimSgos"}),W.pushSceneGraphOverrideSet(B);var ot=new b([Ce]);se.push(B.createIdPathOverride({idPathes:[ot]})),se.push(B.createIdPathOverride({idPathes:[ot],propagateUntilRepRefs:!0})),se[1].setPickability("IGNORED"),Fe(),ne.push(de.subscribe({event:"onRefreshBegin"},function(){ue=t.clone(ce,!0)})),ne.push(de.subscribe({event:"onRefreshCompleted"},function(){var e=Object.keys(ue);if(1===e.length){var t={},n=e[0];Array.isArray(ue[n])&&ue[n].length?t.metricID=ue[n]:t.isrID=n,et(t)}})),ne.push(de.subscribe({event:"onBeginFilterApplied"},function(){Y=!0})),ne.push(de.subscribe({event:"onFilterApplied"},function(){Y=!1})),ne.push(de.subscribe({event:"onBeginFilterRemoved"},function(){Y=!0})),ne.push(de.subscribe({event:"onFilterRemoved"},function(){Y=!1})),Q=de.getRoots().map(function(e){return l.getNodeID(e)}),Array.prototype.push.apply(Q,he.getHiddenRootIds()),ne.push(de.subscribe({event:"onRootAdded"},function(e){-1===Q.indexOf(e.id)&&Q.push(e.id),qe(Object.keys(ee).map(function(e){return ee[e]})),je()})),ne.push(de.subscribe({event:"onRootRemoved"},function(e){if(!Y){var t=Q.indexOf(e.id);-1!==t&&Q.splice(t,1);var n=c.getLoadedIsr();Object.keys(n).forEach(function(t){n[t].getIsrContexts().map(function(e){return e.prd.physicalid}).indexOf(e.id)>-1&&Ye(t)})}})),ne.push(de.subscribe({event:"onEndDelete"},function(){function e(e,t){if(!e||!t)return!1;for(var n=1;n<t.length;n+=2)if(e===t[n].physicalid)return!0;return!1}return function(t){var n=[],i=t.pathToReparent?"string"==typeof t.pathToReparent?t.pathToReparent:l.getNodeID(t.pathToReparent):null;i&&(Object.keys(ee).forEach(function(t){var r=ee[t],a=!1;e(i,r.itfPath1)&&(r.itfLblInst1=r.itfLblInst1Owner=r.itfLblInst1OwnerID=r.itfLblInst1Path=r.itfLblRef1=r.itfLblRef1Owner=r.itfLblRef1OwnerID=void 0,r.itfLblRef1Path=r.itfLblShape1=r.itfLblShape1Owner=r.itfLblShape1OwnerID=void 0,a=!0),e(i,r.itfPath2)&&(r.itfLblInst2=r.itfLblInst2Owner=r.itfLblInst2OwnerID=r.itfLblInst2Path=r.itfLblRef2=r.itfLblRef2Owner=r.itfLblRef2OwnerID=void 0,r.itfLblRef2Path=r.itfLblShape2=r.itfLblShape2Owner=r.itfLblShape2OwnerID=void 0,a=!0),a&&(Ve(t),n.push(r))}),n.forEach(function(e){ee[e.itfuid]=e}),p&&(p.updateInterferences(Te(n)),je()))}}())),de.getApplicativeData().getLoadedItfData=function(){var e,t,n,i={loadMode:"1"===localStorage.getItem("PIMwebContextLoadMode")?1:0,data:[]},r=Object.keys(ce||{});return 1!==r.length?i:(r=r[0],t=((t=(e=c.getIsr(r))?e.getIsrContexts():[])||[]).map(function(e){return e.prd?e.prd.physicalid:null}).filter(function(e){return e}),n=e?e.getAttributes():{},i.data.push({isrID:r,metricID:[].concat(ce[r]),label:n.label,prd:t,type:n.type}),i)},de.getApplicativeData().removeIsrKeepContext=Ye,this.load=et,this.clearIsr=$e,this.loadApplicativeContext=function(e){return ve=!0,new Promise(function(n){var i=(De=t.clone(e.PIM?e.PIM:e)).contextuals?De.contextuals:[];i.forEach(function(e){let t=[];e.path1Ids&&e.path1Ids.forEach(function(n){e.itfPath1||(e.itfPath1=[]),-1!==t.indexOf(n)||we.hasOwnProperty(n)||t.push(n),e.itfPath1.push(we.hasOwnProperty(n)&&we[n]?we[n]:{})}),e.path2Ids&&e.path2Ids.forEach(function(n){e.itfPath2||(e.itfPath2=[]),-1!==t.indexOf(n)||we.hasOwnProperty(n)||t.push(n),e.itfPath2.push(we.hasOwnProperty(n)&&we[n]?we[n]:{})}),de.getController().getAttributes({ids:t,attributes:["physicalid","ds6w:label","ds6w:responsible","owner","ds6w:type"],callbacks:{onComplete:function(t){Object.keys(t).forEach(function(n){let i=e.path1Ids.indexOf(n),r=e.path2Ids.indexOf(n);var a={physicalid:t[n].physicalid||n,label:t[n]["ds6w:label"],owner:t[n]["ds6w:responsible"],ownerID:t[n].owner,type:t[n]["ds6w:type"]};we.hasOwnProperty(t[n].physicalid)||(we[t[n].physicalid]=a),-1!==i&&(e.itfPath1[i]=a),-1!==r&&(e.itfPath2[r]=a)}),Ke([e])},onFailure:function(){}}})});let r,a,o,l,s,c,f=0;r=function(){0===f&&(de.unsubscribe(a),de.unsubscribe(o),i&&Ke(i),xe("onDMUCtxtLoadingSuccess"),n())};var u=[];for(i.forEach(function(e){e.path1Ids&&u.push(e.path1Ids.map(function(e){return e})),e.path2Ids&&u.push(e.path2Ids.map(function(e){return e}))}),l=u.length-1;l>=0;--l)u[l].every(function(e){return he.getNode({id:e})})&&u.splice(l,1);0===(f+=u.length)&&r(),!f||a||o||((c=de.getAutomaticReframePolicy())&&(de.setAutomaticReframePolicy(!1),s=1),a=de.subscribe({event:"onRootAdded"},function(){f--,1===s&&(de.reframe(),s=2),0===f&&(2===s&&de.setAutomaticReframePolicy(c),r())}),o=de.subscribe({event:"onRootAlreadyExisting"},function(){0==--f&&r()})),f&&de.addRoots({objects:u.map(function(e){return{path:e}})},!0,!1),xe("onDMUCtxtLoadingSuccess")})},this.cleanApplicativeContext=function(e,t,n){if((0===Object.keys(ce).length||t)&&(p&&We(Oe(),!0),Je(),w&&w.destroy(),w=null,t&&(ce={}),(p=null)&&p.removeInterferences(),De={},ee={},te={},e)){let e=require("DS/ApplicationFrame/CommandsManager").getCommandCheckHeader("PIMInteferenceListHdr",de.getCommandContext());e&&e.setState(!1)}n&&$.showGUX(),ve=!1},this.removeIsr=Ye,this.showGUX=function(){me=!0,re&&(tt(),F.show(),nt(),w.show(),ze())},this.hideGUX=function(){me&&(me=!1,it())},this.isUIVisible=function(){return me},this.applyDisplay=function(e,t,n){-1!==Object.keys(Pe).indexOf(e)&&"number"==typeof t&&(Pe[e]=t?1:0,n||("clash"===e?Object.keys(fe).forEach(e=>fe[e].children[2].children.forEach(e=>e.children[0].setVisibility(t))):"contact"===e?Object.keys(fe).forEach(e=>fe[e].children[1].children.forEach(e=>e.children[0].setVisibility(t))):"clearance"===e?Object.keys(fe).forEach(e=>fe[e].children[0].children.forEach(e=>e.children[0].setVisibility(t))):"quantifiers"===e?Object.keys(fe).forEach(e=>fe[e].children.forEach(e=>e.children.forEach(e=>e.children[1].setVisibility(t)))):"zoom"===e?(ye=!0,Le()):"colorsState"!==e&&"transparencyState"!==e||Ne(),de.getViewer().render()))},this.exportAsCSV=function(e){return p.exportAsCSV(e)},this.getIsrContext=function(e){return new Promise(function(t){if(de.getApplicativeData().getLoadedItfData){var n=de.getApplicativeData().getLoadedItfData();if((n=n.data.length?n.data[0]:null)&&n.isrID===e){var i=[];return n.prd&&n.prd.length&&i.push(n.prd[0]),void t(i)}}r._navigateFromIsrToContext({isrID:e,onComplete:function(e){var n,i=JSON.parse(e);i&&i.result&&1===i.result.length?(n=i.result[0].outputs&&i.result[0].outputs.prd,t(n&&n.physicalid?[n.physicalid]:[])):t([])},onFailure:function(){t([])}})})},this.getLoadedIsr=function(){return Object.keys(ce).map(function(e){return{isrID:e,isr:c.getIsr(e)}})},this.getSpecAndContextInfoFromCtrl=function(){let e=de.getRoots().map(function(e){return l.getNodeID(e)})[0];var t=De.spec;return t.context={prd:{}},t.context.prd=we[e],t.isEditable=!ve,t},this.getLoadedData=function(){return t.clone(ce,!0)},this.isPIMDataLoaded=function(){return ve},this.activateUI=function(){ae||(ae=!0,X&&(X.setVisibility(!0),X.setVisibilityFree(!1)),W&&B&&-1===W.getSceneGraphOverrideSetIndex(B)&&W.pushSceneGraphOverrideSet(B),de.getViewer().render(),me&&$.showGUX())},this.deactivateUI=function(){ae&&(ae=!1,X&&(X.setVisibility(!1),X.setVisibilityFree(!0)),W&&B&&W.removeSceneGraphOverrideSet(B),de.getViewer().render(),it())},this.isActivatedUI=(()=>ae),this.activate=function(e){if(!re){if(re=!0,N=e.mkpCtx||!1,U=null,$.readOnly(e.readOnly),N||r._getIsrTypes().then(function(e){var t=function(e){u.multiTenantMgt([e],l.getRoots(de),function(t){!t.isMultiTenant&&re&&et({isrID:[e.objectId]})})},n={_PLMPIMMetricReference:function(e){u.multiTenantMgt([e],l.getRoots(de),function(t){!t.isMultiTenant&&re&&et({metricID:[e.objectId]})})},...x.getDelegation(de)};e.forEach(function(e){n["_"+e]=t}),de.setLoadingDelegations(n)}),$.activateUI(),N||function(){var e,t,n;function i(e){if("number"!=typeof e)return!1;var t,n,i,r,a=p.getNumberOfRows(),o=e<0?a-1:e>=a?0:e;if(o<0||o>=a)return window.console.log("No interference in list for slide show"),!1;p.selectRows([o]);var l=Oe(!0);return 1===l.length&&(i="Undefined"===(n="Undefined"===(t=ee[l[0]]?ee[l[0]]:p?p.getRowInternalData(o):{}).itfUserType?t.itfSystemType:t.itfUserType)?"I_InterferenceCheck":"I_PIM_"+n,r=S.itfAnalysis+": ",r+=S["NotAnalyzed"===t.itfAnalysis?"NotAnalyzed"!==t.itfPrevAnalysis?"itfToReAnalyze":"itfToAnalyze":"itf"+t.itfAnalysis]+"\n",r+=S.itfPrevAnalysis+": "+(S["itf"+t.itfPrevAnalysis]||"-")+"\n",r+=S.itfDescription+": "+(t.itfDescription||"-"),z.displaySlideInformation({primary:(t.itfCtxName?t.itfCtxName:t.itfName)+" ("+(o+1)+" / "+a+") ",secondary:S[n],hidden:r,icon:C.getWebappsAssetUrl("PIMwebUX","icons/32/")+i+".png"})),!0}z||(z=a.getSlideShowController({context:de.getFrameWindow(),id:"PIMwebSlideShow",params:{activateRotation:!0}}),ge.push(z.subscribe("onPreviousSlideCB",function(){var e=p.getSelectedRows();i(e&&e.length?e.length>1?e[0]:e[0]-1:0)})),ge.push(z.subscribe("onNextSlideCB",function(){var e=p.getSelectedRows();i(e&&e.length?e.length>1?e[0]:e[0]+1:0)})),ge.push(z.subscribe("onFirstSlideCB",function(){i(0)})),ge.push(z.subscribe("onLastSlideCB",function(){i(p.getNumberOfRows()-1)})),ge.push(z.subscribe("onActiveStateModified",function(r){if(r.state&&0===Object.keys(ce).length)r.onBeginSlideShow(!1);else{r.state&&r.onBeginSlideShow(!0);var a=de.getViewer();if(r.state?(e=de.isDefaultContextualMenuVisible(),t=de.isDefaultContextualBarVisible(),n=de.isOpenWithMenuAvailable(),de.setDefaultContextualBarVisibility(!1),de.setDefaultContextualMenuVisibility(!1),de.setOpenWithMenuAvailability(!1)):(de.setDefaultContextualBarVisibility(e),de.setDefaultContextualMenuVisibility(t),de.setOpenWithMenuAvailability(n)),r.state){var o,l=Boolean(w);me?w.hide():(nt(),w.hide(),tt(),F.show(),a.render()),a.setPicking({activated:!1,trapSelection:!1}),require("DS/ApplicationFrame/CommandsManager").getCommandCheckHeader("PIMInteferenceListHdr",de.getCommandContext()).disable(),l?i((o=p.getSelectedRows())&&0!==o.length?1===o.length?o[0]:null:0):setTimeout(function(){i((o=p.getSelectedRows())&&0!==o.length?1===o.length?o[0]:null:0)},100)}else me?w.show():(F&&F.hide(),a.render()),w&&w.ensureSelectedLineVisibility(),a.setPicking({activated:!0,trapSelection:!0}),require("DS/ApplicationFrame/CommandsManager").getCommandCheckHeader("PIMInteferenceListHdr",de.getCommandContext()).enable()}})))}(),p&&p.showSlideColumn(N),e.noStatusBarCmd){var n=s.getLayout_options("frmWindow_opts").contextualMenuContent;de.getFrameWindow().getContextualUIManager().register({subscriberId:"PIMweb3DPlayExperience",workbenchName:n.workbenchName,module:n.module,cmdPrefix:"",context:de.getCommandContext(),merge:!0,onContextualMenuReady:function(e,t){if(!z||!z.getActiveState()){var i=require("DS/ApplicationFrame/CommandsManager").getCommand("FlyWalkCmd",de.getCommandContext());if((!i||!i.isRunning())&&"number"==typeof t.XmousePosition&&"number"==typeof t.YmousePosition&&de.getViewer()){var r=[];return 0===de.getViewer().pick({xPix:t.XmousePosition,yPix:t.YmousePosition},"mesh",!0).path.length&&(h.isMobile()||r.push({name:"PIMwebDisplaySection",line:1,resourceFile:"PIMwebViewController/PIMwebViewController",hdr_list:["VisuQMCommand"]}),n.emptiness.ambiences&&n.emptiness.ambiences.length&&r.push({name:"PIMwebAmbiencesSection",line:1,resourceFile:"PIMwebViewController/PIMwebViewController",hdr_list:n.emptiness.ambiences})),{cmdList:r}}}}})}!function(){function e(e){if(Z=I.__readDisplayPrefValues(),Se(),Me(),e&&e.length){var n=e.map(e=>e.id),i=!1;if(n.indexOf("PIMwebLoad")>=0){var r=t.clone(ce),a=Object.keys(r);if(a&&1===a.length&&0===r[a[0]].length)return $e(),void et({isrID:a[0]})}if(["IDColorOverLoading","IDColorInstance1","IDColorInstance2","IDColorItfClash","IDColorItfContact","IDColorItfClearance","IDItfPartsTransparency"].some(function(e){return n.indexOf(e)>=0})&&(Ne(),ke.updateColors(),de.getViewer().render()),n.indexOf("IDStoredResults")>=0?(i=!0,Object.keys(fe).forEach(Ve),Object.keys(ee).forEach(e=>delete ee[e].pos3D)):["IDQMinDist","IDGClash","IDGContact","IDGClearance","IDGeometries","IDQuantifiers","IDPeneVolume","IDPeneVector","IDMinimumDistance"].some(function(e){return n.indexOf(e)>=0})&&(i=!0),n.indexOf("CATWebUXPreferences_TrailingZeros")>=0&&(i=!0,Object.keys(fe).forEach(e=>{delete fe[e].__pimQuantifierDone,delete fe[e].__pimGeomDone})),n.indexOf("CATWebUXPreferences_UnitsAndDecimalPlace")>=0){if(i=!0,p){p.setUnits({length:K.Length,volume:K.Volume});let e=Object.keys(ee).map(e=>ee[e]);e.length&&p.updateInterferences(Te(e))}Object.keys(fe).forEach(e=>delete fe[e].__pimQuantifierDone)}!Z.useStoredResults&&n.indexOf("IDQMinDist")>=0&&Object.keys(fe).forEach(e=>fe[e].children.forEach(e=>e.children.forEach(e=>e.children[1].setVisibility(Z.quantifiers.minDist)))),(i||_)&&ke(Oe(),Z),_=!1;var o=require("DS/DMUBaseUIControllers/DMUSlidesController").giveDMUSlidesController({context:de.getFrameWindow()});if(o){var l=o.getActiveSlide();l.getSlideApplicativeContext().ITF.content.prefs=Z,l.getSlideApplicativeContext().ITF.content.prefs.displayOptions=Pe,o.setActiveSlide(l)}}}q||(q=v.givePreferenceManager({context:de.getFrameWindow()}))&&(q.addPreferences(I.getPreferencesDefinition()),be.push(q.subscribe("onPreferencesChanged",e)),be.push(q.subscribe("CATWebUXPreferences_TrailingZeros",()=>e([{id:"CATWebUXPreferences_TrailingZeros"}]))),be.push(q.subscribe("CATWebUXPreferences_UnitsAndDecimalPlace",()=>e([{id:"CATWebUXPreferences_UnitsAndDecimalPlace"}]))))}()}},this.deactivate=function(){if(re){re=!1,N||de.setLoadingDelegations({}),N=!1,U=null,ye=!0,$.deactivateUI(),z&&ge.forEach(z.unsubscribe,z),ge=[],a.unreferenceSlideShowController({context:de.getFrameWindow(),id:"PIMwebSlideShow"}),z=null,q&&(q.removePreferences(["PIMwebPreferences"]),be.forEach(q.unsubscribe,q),be=[],q=null);var e=[];Object.keys(ee).forEach(function(t){ee[t].itfLblSlide&&(ee[t].itfLblSlide=0,e.push(ee[t]))}),p&&(p.updateInterferences(Te(e)),p.showSlideColumn(!1)),de.getFrameWindow().getContextualUIManager().unregister("PIMweb3DPlayExperience")}},this.isActivated=(()=>re),this.readOnly=function(e){pe!==Boolean(e)&&(pe=!pe,w&&w.toggleReadOnly())},this.appInitFromTransition=function(t){return new e.Promise(function(e,n){var i,a,o=t.x3dContent,l=Q,s=[];if(t.issues)a=require("DS/PADUtils/PADUtilsServices").getPlatformId(),o=null,s=t.issues.map(function(e){return{issueID:e.physicalid,attachments:e.attachments}});else if(o&&o.data&&o.data.items&&!l.length)for(i=0;i<o.data.items.length;++i){if("Issue"!==o.data.items[i].objectType){s=[];break}a||(a=o.data.items[i].envId),s.push({issueID:o.data.items[i].objectId})}s.length?require(["DS/IssueServices/services/PlatformServices","DS/IssueAttachmentManager/services/AttachmentServices","DS/IssueServices/Contexts"].concat([]),function(t,i,l){l.add("widget",window.widget),t.getSecurityContext=function(){return require("DS/PADUtils/PADSettingsMgt").getSetting("pad_security_ctx").replace("ctx::","")},t.getTenant=function(){return a},Promise.all([r._getIsrTypes(),t.initPlatformServices()]).then(function(t){r._sendUsageProbe("loadFromIssue",o?"x3dContent":"transition"),r._sendUsageProbe("loadFromIssue",o?"x3dContent":"transition"+s.length);var a=s.map(function(e){return new Promise(function(n){(e.attachments?new Promise(function(e){e({attachments:void 0})}):i.getDocumentsFrom(e.issueID)).then(function(e){var i={isr:[],metric:[]};(e&&Array.isArray(e.attachments)&&e.attachments||[]).forEach(function(e){e&&("PLMPIMMetricReference"===e.type?i.metric.push(e.id):t[0].indexOf(e.type)>-1&&i.isr.push(e.id))}),n(i)}).catch(function(){n({})})})});Promise.all(a).then(function(t){new Promise(function(e){var n,i,a=[];function l(e){return o?Promise.resolve(e):new Promise(function(t){r._navigateFromIsrToContext({isrID:e,onComplete:function(n){var i=JSON.parse(n),r=[];i&&i.result&&0!==i.result.length?(i.result.forEach(function(t){var n=e.indexOf(t.input_object.physicalid);if(-1!==n){r[n]=e[n];var i=t.outputs.prd&&t.outputs.prd.physicalid;i&&Q&&-1!==Q.indexOf(i)||(r[n]=null)}}),t(r)):t(r)},onFailure:function(){t([])}})})}!function o(s){s?s.isr&&s.metric&&(s.isr.length||s.metric.length)?!i&&s.isr.length?l(s.isr).then(function(t){t.some(function(e){return n=e}),n?e({isrIDToLoad:n,metricsToLoad:a}):(s.isr=[],o(s))}):s.metric.length?r._navigateFromMetricToIsr({metricIDs:s.metric,onComplete:function(e){var n=JSON.parse(e);if(n&&n.infos&&"OK"===n.infos.status&&n.result)if((n=n.result)&&Array.isArray(n)){for(var r={},s=0;s<n.length;s++)n[s].outputs.isr&&n[s].outputs.isr.length&&(r[n[s].outputs.isr[0].physicalid]||(r[n[s].outputs.isr[0].physicalid]=[]),r[n[s].outputs.isr[0].physicalid].push(n[s].input_object.physicalid));i?(r[i]&&(a=a.concat(r[i])),o(t.shift())):l(Object.keys(r)).then(function(e){e.some(function(e){return i=e}),i&&(a=a.concat(r[i])),o(t.shift())})}else o(t.shift());else o(t.shift())},onFailure:function(){o(t.shift())}}):o(t.shift()):o(t.shift()):e({isrIDToLoad:n,metricsToLoad:a})}(t.shift())}).then(function(t){var n,i=Object.keys(ce);t.isrIDToLoad?(n="_Isr",i.indexOf(t.isrIDToLoad)>-1&&i.forEach(Ye),et({isrID:t.isrIDToLoad})):t.metricsToLoad&&t.metricsToLoad.length&&(n="_Metric"+t.metricsToLoad.length,i.forEach(Ye),et({metricID:t.metricsToLoad})),r._sendUsageProbe("loadFromIssue",(o?"x3dContent":"transition")+(n||"_NoData")),e(n)})}).catch(n)}).catch(n)},n):e()}).then(function(e){e||t.onNoActionDone()}).catch(t.onNoActionDone).finally(function(){})},this.subscribe=function(e,t){return e&&t?ie.subscribe({event:e},t):null},this.unsubscribe=function(e){if(null!=e)return ie.unsubscribe(e)},this.destroy=function(){F&&F.destroy(),F=null,ne.forEach(function(e){de.unsubscribe(e)}),de=ce=null},this.applySlide=function(){var e;function n(e){if(re&&e){if(e.state||!ve){if(!e.state)return p&&p.selectRowsByUID([]),me&&it(),void e.callback();if(me&&(w&&w.show(),F&&F.show()),e.state.context&&e.state.context.data&&e.state.content){if(1!==e.state.context.data.length)return window.console.error("Invalid data stored in slide"),void e.callback();if(void 0===e.state.content.prefs.useStoredResults){let n=e.state.content.prefs.geometries,i=e.state.content.prefs.quantifiers;Number.isInteger(Z.geometries)?H=t.extend(t.clone(Z,!0),e.state.content.prefs):((H=t.clone(Z,!0)).useStoredResults=1,H.geometries={mode:1,clash:n,contact:n,clearance:n},H.quantifiers={minDist:!!i.minDist&&i.minDist}),Pe.clash=Pe.contact=Pe.clearance=0===n?0:1,Pe.quantifiers=!0===i.minDist?1:0}else if((H=t.extend(t.clone(Z,!0),e.state.content.prefs)).useStoredResults=e.state.content.prefs.useStoredResults?e.state.content.prefs.useStoredResults:1,!Number.isInteger(Z.geometries)){let t=void 0!==e.state.content.prefs.geometriesDef?e.state.content.prefs.geometriesDef:e.state.content.prefs.geometries;H.geometries={mode:t.mode,clash:t.clash,contact:t.contact,clearance:t.clearance},H.quantifiers={minDist:!!e.state.content.prefs.quantifiers.minDist&&e.state.content.prefs.quantifiers.minDist}}var n=e.state.context.data[0],i=n.isr,r=n.itfs.filter(function(e){return ee[e]});if(!ce[i]&&!ve)return window.console.error("Isr id stored in slide does not match currently loaded one"),void e.callback();e.state.content.itfs.forEach(function(e){if(r.indexOf(e.id)>-1)if(Array.isArray(e.pos3D)&&3===e.pos3D.length)ee[e.id].pos3D=[].concat(e.pos3D);else if(Array.isArray(e.pos3Drel)&&3===e.pos3Drel.length){let t=ee[e.id];if(t.itfQtfPt1&&t.itfQtfPt2){let n=[.5*(t.itfQtfPt2[0]+t.itfQtfPt1[0]),.5*(t.itfQtfPt2[1]+t.itfQtfPt1[1]),.5*(t.itfQtfPt2[2]+t.itfQtfPt1[2])];"Clash"===t.itfSystemType&&(n=[t.itfQtfPt1[0],t.itfQtfPt1[1],t.itfQtfPt1[2]]),ee[e.id].pos3D=[n[0]+e.pos3Drel[0],n[1]+e.pos3Drel[1],n[2]+e.pos3Drel[2]]}}}),G=e.noCtxChangedEvt,new Promise(function(e){p?e():(nt(),w.hide(),tt(),F.hide(),setTimeout(e,100))}).then(function(){if(e.state.content.prefs.displayOptions){let n=t.clone(Pe.zoom,!0);(Pe=t.clone(e.state.content.prefs.displayOptions,!0)).zoom=n}let n=require("DS/ApplicationFrame/CommandsManager").getCommandCheckHeader("PIMDisplayClashCurveHdr",de.getCommandContext());n&&(n.setState(1===Pe.clash),require("DS/ApplicationFrame/CommandsManager").getCommandCheckHeader("PIMDisplayContactCurveHdr",de.getCommandContext()).setState(1===Pe.contact),require("DS/ApplicationFrame/CommandsManager").getCommandCheckHeader("PIMDisplayClearanceCurveHdr",de.getCommandContext()).setState(1===Pe.clearance),require("DS/ApplicationFrame/CommandsManager").getCommandCheckHeader("PIMDisplayQuantifiersHdr",de.getCommandContext()).setState(1===Pe.quantifiers),require("DS/ApplicationFrame/CommandsManager").getCommandCheckHeader("PIMApplyTransparencyHdr",de.getCommandContext()).setState(1===Pe.transparencyState),require("DS/ApplicationFrame/CommandsManager").getCommandCheckHeader("PIMColorOverloadHdr",de.getCommandContext()).setState(1===Pe.colorsState)),p.selectRowsByUID(r)&&ke(r,H,!0),setTimeout(function(){G=!1,_=!0,H=null,e.callback&&e.callback()},100)})}else e.callback()}}else e.callback()}return function(t){clearInterval(e),j?e=setInterval(function(){j||(clearInterval(e),n(t))},100):n(t)}}(),this.getDataForSlide=function(){let e,n=Oe(),i=Object.keys(ce),r=Z,a=t.clone,o=a(Pe);if(void 0!==(e={version:1,context:{data:[]},content:{prefs:{useStoredResults:r.useStoredResults,quantifiers:a(r.quantifiers),geometries:a(r.geometries),displayOptions:a(o)},itfs:[]}}).content.prefs.displayOptions.zoom&&delete e.content.prefs.displayOptions.zoom,(i=i.length?i[0]:ve?"1":null)||ve)return e.context.data=[{isr:i,itfs:n.map(function(t){return ee[t].pos3D&&e.content.itfs.push({id:t,pos3D:ee[t].pos3D}),t})}],e;window.console.error("No loaded isr in session")},this.getTitleForSlide=function(){var e=Oe();if(e&&e.length&&e[0]&&ee[e[0]])return ee[e[0]].itfCtxName},this.updateSlideCount=function({slidesAppData:e}){if(!ve||0!==Object.keys(ce).length){U=e;var t=He();t.length&&p&&p.updateInterferences(Te(t.map(function(e){return ee[e]})))}},this.getOrderedSlides=function(e,t){if(e&&t)return e.filter(function(e){return e.context.data.some(function(e){return e.itfs.some(function(e){return t.indexOf(e)>-1})})})},this.allowReframe=function(e){return"boolean"==typeof e&&(ye=e),ye},this.getPimTicInfo=function(e,t){var n=Object.keys(ce);if(n=1===n.length?n[0]:null)return at({cmdType:e,itf:t?Oe():[],isr:n});window.console.error("No  isr in session")},this.getMkpTicInfo=function(e,t,n){var i=Object.keys(ce),r={cmdType:e,itf:[]};if(!(i=1===i.length?i[0]:null))return window.console.error("No  isr in session"),void n();t.forEach(function(e){var t=e.state.context;t&&t.data&&1===t.data.length&&t.data[0].isr===i&&t.data[0].itfs.forEach(function(e){-1===r.itf.indexOf(e)&&r.itf.push(e)})}),r.isr=i,at(r).then(n)},this.getIsrPointingToMetric=function(e){var t={};if(!e||!e.length||!Array.isArray(e))return Promise.resolve(t);var n=Object.keys(ce),i=[].concat(e);return n.forEach(function(e){var n;for(n=i.length-1;n>=0;--n)ce[e].indexOf(i[n])>-1&&(t[i[n]]=[e],i.splice(n,1))}),i.length?new Promise(function(e){r._navigateFromMetricToIsr({metricIDs:i,onComplete:function(n){var r=JSON.parse(n);(r&&r.result||[]).forEach(function(e){-1!==i.indexOf(e.input_object.physicalid)&&(t[e.input_object.physicalid]=e.outputs.isr&&e.outputs.isr[0].physicalid?[e.outputs.isr[0].physicalid]:[])}),e(t)},onFailure:function(){e(t)}})}):Promise.resolve(t)}}}),F=[],N=function(e){var t;return F.some(function(n){return n.pad3DViewer===e&&(t=n)}),t},U=function(e){e&&F.some(function(t,n){var i;return t.itfCtrl===e?(i=!0,t.itfCtrl=null):t.mkpCtrl===e?(i=!0,t.mkpCtrl=null):t.loaderMkp===e&&(i=!0,t.loaderMkp=null),i&&t.ctrl.deactivate(),t.itfCtrl||t.mkpCtrl||t.loaderMkp||(t.ctrl.destroy(),t.pad3DViewer=t.ctrl=null,t=null,F.splice(n,1)),i})},_=function(e,t,n){t||(t={pad3DViewer:e,ctrl:new k({pad3DViewer:e})},F.push(t));var i=t.ctrl;return"itf"!==n||t.itfCtrl?"mkpUI"!==n||t.mkpCtrl?"loaderMkp"!==n||t.loaderMkp||(t.loaderMkp={load:function(e){if(i&&e&&e.data){var t={loadMode:e.data.loadMode};(e.data.metricID||e.data.isrID)&&(e.data.metricID?t.metricID=e.data.metricID:t.isrID=e.data.isrID,i.cleanApplicativeContext&&i.cleanApplicativeContext(!1,!1,!0),i.load(t))}},getIsrPointingToMetric:function(){return t.loaderMkp&&i?i.getIsrPointingToMetric.apply(null,arguments):void 0},getIsrContext:function(){return t.loaderMkp&&i?i.getIsrContext.apply(null,arguments):void 0},remove:function(){return t.loaderMkp&&i?i.removeIsr():void 0},subscribe:function(){return t.loaderMkp&&i?i.subscribe.apply(null,arguments):void 0},unsubscribe:function(e){return t.loaderMkp&&i?i.unsubscribe(e):void 0},dereference:function(){U(t.loaderMkp)}},Object.freeze(t.loaderMkp)):(t.mkpCtrl={setActiveState:function(e){return t.mkpCtrl&&i?i[e?"activateUI":"deactivateUI"]():void 0},getActiveState:function(){return t.mkpCtrl&&i?i.isActivatedUI():void 0},subscribe:function(){return t.mkpCtrl&&i?i.subscribe.apply(null,arguments):void 0},unsubscribe:function(e){return t.mkpCtrl&&i?i.unsubscribe(e):void 0},initializeAppContainer:function(e){if(!i||!t.mkpCtrl)return null;i.activate({readOnly:!0,mkpCtx:!0}),e.options&&e.options.authoring&&w.getGrantedRoles(function(e){i.readOnly(!e.some(function(e){return("RED"===e.id||"InternalDS"===e.id||"DMRMH"===e.id)&&("InternalDS"===e.id||(e.platforms||[]).indexOf(require("DS/PADUtils/PADUtilsServices").getPlatformId())>-1)}))}),e.onApplicativeControllerInitialized()},onLeavingApp:function(){return t.mkpCtrl&&i?i.deactivate():void 0},getApplicativeContainerID:function(){return"ITF"},displayAppContainerState:function(){return t.mkpCtrl&&i?i.applySlide.apply(null,arguments):void 0},getCurrentAppContainerState:function(){return t.mkpCtrl&&i?i.getDataForSlide():void 0},getCurrentAppContainerStateTitle:function(){return t.mkpCtrl&&i?i.getTitleForSlide():void 0},updateAppContainer:function(e){return t.mkpCtrl&&i?i.updateSlideCount(e):void 0},getOrderedAppContainerStates:function(){return t.mkpCtrl&&i?i.getOrderedSlides.apply(null,arguments):void 0},setMinimalUIFlag:function(e){return t.mkpCtrl&&i?i[e?"hideGUX":"showGUX"]():void 0},getMinimalUIFlag:function(){return t.mkpCtrl&&i?!i.isUIVisible():void 0},setAppViewpointManipFlag:function(e){return t.mkpCtrl&&i?i.allowReframe(Boolean(e)):void 0},getAppViewpointManipFlag:function(){return t.mkpCtrl&&i?i.allowReframe():void 0},getAppContainerTICInfo:function(){return t.mkpCtrl&&i?i.getMkpTicInfo.apply(null,arguments):void 0},dereference:function(){U(t.mkpCtrl)}},Object.freeze(t.mkpCtrl)):(t.itfCtrl={load:function(){return t.itfCtrl&&i?i.load.apply(null,arguments):void 0},activate:function(){return t.itfCtrl&&i?i.activate.apply(null,arguments):void 0},deactivate:function(){return t.itfCtrl&&i?i.deactivate.apply(null,arguments):void 0},showGUX:function(){return t.itfCtrl&&i?i.showGUX.apply(null,arguments):void 0},hideGUX:function(){return t.itfCtrl&&i?i.hideGUX.apply(null,arguments):void 0},clearIsr:function(){return t.itfCtrl&&i?i.clearIsr.apply(null,arguments):void 0},removeIsr:function(){return t.itfCtrl&&i?i.removeIsr.apply(null,arguments):void 0},subscribe:function(){return t.itfCtrl&&i?i.subscribe.apply(null,arguments):void 0},unsubscribe:function(){return t.itfCtrl&&i?i.unsubscribe.apply(null,arguments):void 0},applyDisplay:function(){return t.itfCtrl&&i?i.applyDisplay.apply(null,arguments):void 0},exportAsCSV:function(){return t.itfCtrl&&i?i.exportAsCSV.apply(null,arguments):void 0},getLoadedIsr:function(){return t.itfCtrl&&i?i.getLoadedIsr.apply(null,arguments):void 0},getSpecAndContextInfoFromCtrl:function(){return t.itfCtrl&&i?i.getSpecAndContextInfoFromCtrl.apply(null,arguments):void 0},getLoadedData:function(){return t.itfCtrl&&i?i.getLoadedData.apply(null,arguments):void 0},isPIMDataLoaded:function(){return t.itfCtrl&&i?i.isPIMDataLoaded.apply(null,arguments):void 0},appInitFromTransition:function(){return t.itfCtrl&&i?i.appInitFromTransition.apply(null,arguments):void 0},getTICInfo:function(){return t.itfCtrl&&i?i.getPimTicInfo.apply(null,arguments):void 0},dereference:function(){U(t.itfCtrl)}},Object.freeze(t.itfCtrl)),t},G=Object.create({}),B=Object.getPrototypeOf(G);return B.giveItfCtrl=function(e){var t=N(e?e.pad3DViewer:null);return t&&t.itfCtrl?t.itfCtrl:null},B.getItfCtrl=function(e){if(!e||!e.pad3DViewer)return null;var t=N(e.pad3DViewer);return t&&t.itfCtrl||(t=_(e.pad3DViewer,t,"itf")),t.itfCtrl},B.unreferenceApplicativeController=function(e){if(!e||!e.context)return null;var t=N(e.context);t&&t.mkpCtrl&&t.mkpCtrl.dereference()},B.giveApplicativeController=function(e){if(!e||!e.context)return null;var t=N(e.context);return t&&t.mkpCtrl?t.mkpCtrl:null},B.getApplicativeController=function(e){if(!e||!e.context)return null;var t=N(e.context);return t&&t.mkpCtrl||(t=_(e.context,t,"mkpUI")),t.mkpCtrl},B.giveLoaderForMarkup=function(e){if(!e||!e.context)return null;var t=N(e.context);return t&&t.loaderMkp?t.loaderMkp:null},B.getLoaderForMarkup=function(e){if(!e||!e.context)return null;var t=N(e.context);return t&&t.loaderMkp||(t=_(e.context,t,"loaderMkp")),t.loaderMkp},B.loadApplicativeContext=function(e,t){return new Promise(function(n){var i=N(t);i||(i&&i.itfCtrl||(i=_(t,i,"itf")),i=_(t,i,"mkpUI"));var r=i.ctrl;r&&(r.cleanApplicativeContext(!1,!0),r.loadApplicativeContext(e).then(()=>{r.activate({readOnly:!0,mkpCtx:!0});let e=require("DS/ApplicationFrame/CommandsManager").getCommandCheckHeader("PIMInteferenceListHdr",t.getCommandContext());e?(e.disable(),e.setState(!0)):localStorage.setItem("PIMwebItfListVisPref","1"),n()}))})},B.cleanApplicativeContext=function(){return new Promise(function(e){F.some(function(e,t){e.ctrl.cleanApplicativeContext(!0);let n=e.ctrl.getLoadedData();0===Object.keys(n).length&&(e.ctrl.deactivate(),e.itfCtrl||e.mkpCtrl||e.loaderMkp||(e.ctrl.destroy(),e.ctrl=null,e=null,F.splice(t,1)))}),e()})},Object.freeze(G)}),define("DS/PIMwebViewController/PIMwebLeaderNode",["DS/Visualization/ThreeJS_DS","DS/Visualization/Node3D","DS/CoreEvents/Events","DS/SceneGraphNodes/BillBoardNode3D","DS/Visualization/SceneGraphFactory"],function(e,t,n,i,r){"use strict";var a=new e.Matrix4;return t.extend({init:function(t){this._parent(),this.name="LeaderNode";var o,l=t.viewpoint,s=l.viewer.canvas,c=new e.Projector,f=t.fixPt,u=t.width,d=t.height,h=new e.Vector3(1,0,0),p=1,m=new e.Vector3(1,0,0),g=1,b=new e.LineBasicMaterial({side:e.DoubleSide,color:t.color,transparent:!0,opacity:1,force:!0,lineWidth:1});b.color=t.color;var y=r.createLineNode({points:[new e.Vector3(0,0,0),new e.Vector3(0,0,1)],material:b}),I=new i({constraintAxis:h,type:"Cylindrical",viewpoint:l});I.setMatrix((new e.Matrix4).setPosition(f)),I.addChild(y),this.addChild(I);var C=r.createLineNode({points:[new e.Vector3(0,0,0),new e.Vector3(0,0,1)],material:b}),P=new i({constraintAxis:m,type:"Cylindrical",viewpoint:l});function v(e){a.makeScale(1,1,p),y.setMatrix(a),I.cbChange(e),a.makeScale(1,1,g),C.setMatrix(a),P.cbChange(e)}function w(e){l===e.viewpoint&&"@onViewpointChange"===e.eventType&&v(e)}function D(e){var t=c.projectVector(e,l.getCamera());return{top:Math.round((0-t.y)*(s.offsetHeight/2)+s.offsetHeight/2),left:Math.round(t.x*(s.offsetWidth/2)+s.offsetWidth/2)}}P.addChild(C),this.addChild(P),this._onLinkedToSceneGraph=function(){o=n.subscribe({event:"/VISU/"},w)},this._onUnlinkedToSceneGraph=function(){n.unsubscribe(o)},this._getDynamicMatrix=function(e,t,n){return v(t),this.getMatrix()},this.updateLeader=function(t){var n,i=Number.MAX_VALUE,r=new e.Vector3(.5*u,.5*d,0),a=[new e.Vector3(.5*u,0,0),new e.Vector3(.5*u,d,0),new e.Vector3(-15,.5*d,0),new e.Vector3(u+15,.5*d,0)];a.forEach(function(e){e.applyMatrix4(t);var r=e.distanceTo(f);r<i&&(i=r,n=e)}),function(t,n){h.subVectors(t,f),p=h.length(),h.normalize(),I.setConstraintAxis(h),P.setMatrix((new e.Matrix4).setPosition(t)),m.subVectors(n,t),g=m.length(),m.normalize(),P.setConstraintAxis(m)}(n,r.applyMatrix4(t)),v({viewpoint:l});var o=D(f.clone());a.push(new e.Vector3(0,.5*d,0).applyMatrix4(t)),a.push(new e.Vector3(u,.5*d,0).applyMatrix4(t)),a.push(new e.Vector3(0,0,0).applyMatrix4(t)),a.push(new e.Vector3(u,0,0).applyMatrix4(t)),a.push(new e.Vector3(u,d,0).applyMatrix4(t)),a.push(new e.Vector3(0,d,0).applyMatrix4(t));var s=a.some(function(e){return e=D(e),Math.abs(e.top-o.top)<=15&&Math.abs(e.left-o.left)<=15});this.setVisibility(!s),this.setVisibilityFree(s)}}})}),define("DS/PIMwebViewController/PIMWebViewTools",["DS/WebPolyMaths/WebMathsBoundingGeometry","DS/WebPolyMaths/WebGeometryEnums","DS/WebPolyMaths/WebToolsMeasure","DS/WebPolyMaths/WebMathsVector3D","DS/WebPolyMaths/WebMathsFiniteGeometry","DS/ENOPAD3DViewer/utils/PAD3DViewerModelServices","DS/Visualization/PrimitiveIterator"],function(e,t,n,i,r,a,o){"use strict";var l,s,c=.001,f=c*c,u=1024,d=200,h=4,p=function(){this.clash=[],this.contact=[],this.clearance1=[],this.clearance2=[],this.isClash=!1,this.status="OK"};function m(e,t){if(e.internalPath.length)return new o(e,t);let n=function e(t){if(t&&t.mesh3js)return t;for(let n=0;n<t.children.length;++n){let i=e(t.children[n]);if(i)return i}}(e.getLastElement());return n?new o(n,t):void 0}function g(e,t){let n=[],r=e?e.getNbPrimitives():0;for(let a=0;a<r;++a){if("FACE"!==e.getGeomType(a)||e.getConnectivityType(a)!==o.TRIANGLES)continue;let r,l,s,c,f=e.getLength(a),u=e.getOffset(a),d=e.getIndexArray(a),h=e.getPositionArray(a),p=[],m=[];if(d&&h){if(t&&!i.isIdentity(t))for(let e=0;e<f;++e)r=3*d[u+e],p[e]=i.transformPoint([h[r],h[r+1],h[r+2]],t);else for(let e=0;e<f;++e)r=3*d[u+e],p[e]=[h[r],h[r+1],h[r+2]];m[0]=m[3]=p[0][0],m[1]=m[4]=p[0][1],m[2]=m[5]=p[0][2];for(let e=1;e<f;++e)l=p[e][0],s=p[e][1],c=p[e][2],l<m[0]?m[0]=l:l>m[3]&&(m[3]=l),s<m[1]?m[1]=s:s>m[4]&&(m[4]=s),c<m[2]?m[2]=c:c>m[5]&&(m[5]=c);n.push({vertices:p,aabb:m})}else window.console.log("No info for primitive index: "+a)}return n}function b(e,t){var n=e[0]-t[0],i=e[1]-t[1],r=e[2]-t[2];return Math.sqrt(n*n+i*i+r*r)}function y(e,t){for(var n,r=0,a=t.length;r<a;++r)if(n=t[r],i.areEqual(e,n.item||n))return!0;return!1}function I(e,n){for(var i,r=0,a=n.length;r<a;++r)if((i=n[r]).type===t.GeometryType.LINE&&y(i.item[0],e.item)&&y(i.item[1],e.item))return!0;return!1}function C(e,n){for(var r,a,o,l,s,c,u,d,h,p,m=[],g=0,b=e.length;g<b;++g)r=e[g],a=r,o=n,l=void 0,s=void 0,c=void 0,u=void 0,d=void 0,h=void 0,p=void 0,l=i.sub(o[2],o[0]),s=i.sub(o[1],o[0]),c=i.sub(a,o[0]),u=[i.dot(l,l),i.dot(l,s),i.dot(l,c),i.dot(s,s),i.dot(s,c)],p=(u[0]*u[4]-u[1]*u[2])*(d=1/(u[0]*u[3]-u[1]*u[1])),(h=(u[3]*u[2]-u[1]*u[4])*d)>=0&&p>=0&&h+p<=1+f&&m.push({type:t.GeometryType.POINT,item:r});return m}function P(e,t){var n=b(e,t[0]),i=b(e,t[1]),r=b(t[0],t[1]);return Math.abs(r-(n+i))<=c}function v(e,n,r){var a,o={},l=i.sub(e[1],e[0]),s=i.dot(r,l);return 0!==s?(a=(i.dot(r,n)-i.dot(r,e[0]))/s,Math.abs(a)>=0&&Math.abs(a)<=1&&(o={type:t.GeometryType.POINT,item:i.multiplyAndAdd(l,a,e[0])})):o={type:t.GeometryType.LINE,item:e},o}function w(e,n,r){var a=[],o=[];if(P(e[0],n)&&P(e[1],n))a.push({type:t.GeometryType.LINE,item:e});else if(P(n[0],e)&&P(n[1],e))a.push({type:t.GeometryType.LINE,item:n});else if(P(e[0],n)?o.push(e[0]):P(e[1],n)&&o.push(e[1]),P(n[0],e)?o.push(n[0]):P(n[1],e)&&o.push(n[1]),2===o.length)i.areEqual(o[0],o[1])?a.push({type:t.GeometryType.POINT,item:o[0]}):a.push({type:t.GeometryType.LINE,item:o});else if(1===o.length)r&&a.push({type:t.GeometryType.POINT,item:o[0]});else{var l=i.sub(e[1],e[0]),s=i.sub(n[1],n[0]),c=i.sub(n[0],e[0]),f=i.dot(l,l),u=i.dot(l,s),d=i.dot(s,s),h=i.dot(l,c),p=i.dot(s,c),m=f*d-u*u;if(0===m);else{var g=(u*p-d*h)/m,b=(f*p-u*h)/m;if(Math.abs(g)>=0&&Math.abs(g)<=1&&Math.abs(b)>=0&&Math.abs(b)<=1){var y=i.multiplyAndAdd(l,g,e[0]),I=i.multiplyAndAdd(s,b,n[0]);i.areEqual(y,I)&&P(y,e)&&P(y,n)&&a.push({type:t.GeometryType.POINT,item:y})}}}return a}function D(e,t){var n=[];return Array.prototype.push.apply(n,w([e[0],e[1]],t)),Array.prototype.push.apply(n,w([e[0],e[2]],t)),Array.prototype.push.apply(n,w([e[1],e[2]],t)),n}function S(e,n){var r=new p;return e.type===t.GeometryType.LINE&&e.type===n.type?r.clash=w(e.item,n.item):e.type===t.GeometryType.LINE&&n.type===t.GeometryType.SURFACE?r.clash=D(n.item,e.item):e.type===t.GeometryType.SURFACE&&n.type===t.GeometryType.LINE?r.clash=D(e.item,n.item):e.type===t.GeometryType.SURFACE&&n.type===t.GeometryType.SURFACE?r.clash=function(e,n){var r,a=[],o=C(e,n);if(3===o.length)return[{type:t.GeometryType.SURFACE,item:e}];var l=C(n,e);if(3===l.length)return[{type:t.GeometryType.SURFACE,item:n}];l.forEach(function(e){y(e.item,o)||o.push(e)});for(var s=[],c=[],f=[[e[0],e[1]],[e[1],e[2]],[e[2],e[0]]],u=[[n[0],n[1]],[n[1],n[2]],[n[2],n[0]]],d=function(e){if(!i.areEqual(e,l.item)&&y(e,o)){var n={type:t.GeometryType.LINE,item:[e,l.item]};I(n,a)||a.push(n)}},h=0;h<f.length;h++){c=[];for(var p=0;p<u.length;p++)0!==(l=w(f[h],u[p],!0)).length&&((l=l[0]).type===t.GeometryType.LINE?(c=[l],s.push({type:t.GeometryType.POINT,item:l.item[0]}),s.push({type:t.GeometryType.POINT,item:l.item[1]}),I(c[0],a)||a.push(c[0]),p=u.length):y(l.item,s)||(s.push(l),c.push(l),0!==o.length&&([f[h][0],u[p][0]].forEach(d),[f[h][1],u[p][1]].forEach(d))),2===c.length&&(r=[c[0].item,c[1].item],i.subAndSquaredLength(f[h][0],c[1].item)<i.subAndSquaredLength(f[h][0],c[0].item)&&(r=[c[1].item,c[0].item]),I((c=[{type:t.GeometryType.LINE,item:r}])[0],a)||a.push(c[0]),p=u.length))}2===o.length?I(r={type:t.GeometryType.LINE,item:[o[0].item,o[1].item]},a)||a.push(r):1===o.length&&0===a.length&&(a=[{type:t.GeometryType.POINT,item:o[0]}]);var m,g=[];if(s=[],a.length>1){var b,P=a.splice(0,1)[0];for(s.push(P.item[0],P.item[1]),m=P.item[1];!i.areEqual(s[0],m);){for(b=null,h=0;h<a.length&&!b;h++)i.areEqual(a[h].item[0],m)?b=a.splice(h,1)[0].item[1]:i.areEqual(a[h].item[1],m)&&(b=a.splice(h,1)[0].item[0]);b||(b=0!==a.length?a[0].item[0]:s[0]),m=b,s.push(m)}s.length>=3&&(g=[{type:t.GeometryType.SURFACE,item:s}])}else g=a;return g}(e.item,n.item):e.type===t.GeometryType.LINE&&n.type===t.GeometryType.POINT?P(n.item[0],e.item)&&(r.clash=[n]):e.type===t.GeometryType.POINT&&n.type===t.GeometryType.LINE&&P(e.item[0],n.item)&&(r.clash=[e]),r}function M(e,n,r,a,o){var l,s,f,u=[],d=[],h=[],p=[e,n,r];return f=i.dot(o,a),p.forEach(function(e){(s=i.dot(o,e)-f)>c?u.push(e):s<-c?d.push(e):h.push(e)}),3===h.length?l={type:t.GeometryType.SURFACE,item:[e,n,r],overThePlane:3}:2===h.length?l={type:t.GeometryType.LINE,item:h,overThePlane:2}:1===h.length&&1===u.length&&1===d.length?l={type:t.GeometryType.LINE,item:[h[0],v([u[0],d[0]],a,o).item],overThePlane:1}:1!==h.length||2!==u.length&&2!==d.length?1===u.length&&2===d.length?l={type:t.GeometryType.LINE,item:[v([u[0],d[0]],a,o).item,v([u[0],d[1]],a,o).item]}:2===u.length&&1===d.length&&(l={type:t.GeometryType.LINE,item:[v([d[0],u[0]],a,o).item,v([d[0],u[1]],a,o).item]}):l={type:t.GeometryType.POINT,item:[h[0]],overThePlane:1},l}function x(e,t){let n,i=[];for(n=0;n<3;n++)i[n]=e[n]>t[n]?e[n]:t[n];for(n=3;n<6;n++)i[n]=e[n]<t[n]?e[n]:t[n];return i}function A(e){let t;for(t=0;t<3;t++)if(e[t]>e[t+3])return 0;return 1}function O(e,t){if(1==(i=t,(n=e)[0]>=i[0]&&n[1]>=i[1]&&n[2]>=i[2]&&n[3]<=i[3]&&n[4]<=i[4]&&n[5]<=i[5]?1:0))return 2;var n,i;return A(x(e,t))}function T(e,t){let n=t.front;return n<3?e[n+3]<t[n]?0:e[n]>t[n]?2:1:e[n-3]>t[n]?0:e[n]<t[n]?2:1}function L(n,r,a){let o,f,m=new p,g=[],b=[],y=n.vertices.length,I=r.vertices.length;if(!A(g=x(n.aabb,r.aabb)))return m;!function(e){let t;for(t=0;t<3;t++)e[t]-=c,e[t+3]+=c}(g);let C=[],P=[],v=[],w=[];for(o=0;o<y;){let t=[n.vertices[o++],n.vertices[o++],n.vertices[o++]];O(b=e.computeAABBForTriangle(t[0],t[1],t[2]),g)>0&&(C.push({vertices:t,aabb:b}),v.push({index:C.length-1,borderProp:0}))}for(o=0;o<I;){let t=[r.vertices[o++],r.vertices[o++],r.vertices[o++]];O(b=e.computeAABBForTriangle(t[0],t[1],t[2]),g)>0&&(P.push({vertices:t,aabb:b}),w.push({index:P.length-1,borderProp:0}))}return g.depth=1,g.front=-1,f=" ",function e(n,r,a,o,c,f,m){let g,b,y,I,C,P,v,w,D,x=new p,A=[];if(m+="  ",o.length*c.length<d||o.length<=h||c.length<=h||n.depth>=u)for(C=0;C<o.length&&"OK"===x.status;C++)for(w=o[C].index,y=i.cross(i.sub(r[w].vertices[1],r[w].vertices[0]),i.sub(r[w].vertices[2],r[w].vertices[0])),P=0;P<c.length&&"OK"===x.status;P++){if(++l>1e6&&(l=0,performance.now()-s>f)){x.status="maxTime";break}D=c[P].index,o[C].borderProp>0&&o[C].borderProp&c[P].borderProp||(I=i.cross(i.sub(a[D].vertices[1],a[D].vertices[0]),i.sub(a[D].vertices[2],a[D].vertices[0])),g=M(r[w].vertices[0],r[w].vertices[1],r[w].vertices[2],a[D].vertices[0],I),b=M(a[D].vertices[0],a[D].vertices[1],a[D].vertices[2],r[w].vertices[0],y),g&&b&&(v=S(g,b))&&v.clash.length&&(g.overThePlane>1||b.overThePlane>1?v.contact=[{type:t.GeometryType.SURFACE,item:r[w].vertices},{type:t.GeometryType.SURFACE,item:a[D].vertices}]:1===v.clash.length&&v.clash[0].type===t.GeometryType.POINT&&(v.contact=[{type:t.GeometryType.SURFACE,item:r[w].vertices},{type:t.GeometryType.SURFACE,item:a[D].vertices}]),!x.isClash&&v.clash.length&&0===v.contact.length&&(x.isClash=!0),x.concat(v)))}else for(A=function(e){let t,n,i,r,a,o=[],l=[],s=[],c=[];for(t=0;t<6;t++)l[t]=e[t],s[t]=e[t];for(t=0;t<3;t++)c[t]=e[t+3]-e[t];return c[0]>c[1]&&c[0]>c[2]?(n=(e[0]+e[3])/2,l[3]=n,r=3,s[0]=n,a=0):c[1]>c[0]&&c[1]>c[2]?(n=(e[1]+e[4])/2,l[4]=n,r=4,s[1]=n,a=1):(n=(e[2]+e[5])/2,l[5]=n,r=5,s[2]=n,a=2),i=e.depth,i<<=1,l.depth=i,l.front=r,s.depth=i,s.front=a,o[0]=l,o[1]=s,o}(n),C=0;C<2&&"OK"===x.status;C++){let t,n,i,l=[],s=[];for(P=0;P<o.length;P++)w=o[P].index,i=o[P].borderProp,(n=T(r[w].aabb,A[C]))>0&&(1===C&&1===n&&(i|=A[C].depth),l.push({index:w,borderProp:i}));if(l.length){for(P=0;P<c.length;P++)D=c[P].index,i=c[P].borderProp,(n=T(a[D].aabb,A[C]))>0&&(1===C&&1===n&&(i|=A[C].depth),s.push({index:D,borderProp:i}));s.length&&(t=e(A[C],r,a,l,s,f,m),x.concat(t))}}return x}(g,C,P,v,w,a," ")}function E(i,r,l,c){let u,d,h,b,I,C=new p,P=2*f,v=n.retrieveProductAABB;for(let e=i.externalPath.length-1;e>=0;--e){let t=i.externalPath[e];a.isRepReference(t)&&(u=t)}for(let e=r.externalPath.length-1;e>=0;--e){let t=r.externalPath[e];a.isRepReference(t)&&(d=t)}if(!u||!d)return;if(b=i.getWorldMatrix(),I=r.getWorldMatrix(),e.computeAABBSquaredDistance(v(u,b),v(d,I))>=P)return;let w=o._authorizedTeamsOnly_getKey(),D=g(m(i,w),b.elements),S=D.length,M=g(m(r,w),I.elements),x=M.length;for(let t=0;t<S&&"OK"===C.status;++t)for(let n=0;n<x&&"OK"===C.status;++n)if((h=e.computeAABBSquaredDistance(D[t].aabb,M[n].aabb))<f){let e=L(D[t],M[n],c);C.concat(e)}return C.time=performance.now()-s,"Clash"===l?C.contact.length=0:"Contact"===l&&(C.clash.length=0),C.clash.Segment=[],C.contact.Segment=[],C.clash.Surface=[],C.contact.Surface=[],C.clash.forEach(function(e){e.type===t.GeometryType.LINE?C.clash.Segment.push(e.item):e.type===t.GeometryType.SURFACE&&C.clash.Surface.push(e.item)}),C.contact.forEach(function(e){e.type===t.GeometryType.LINE?C.contact.Segment.push(e.item):e.type===t.GeometryType.SURFACE&&C.contact.Surface.push(e.item)}),function(e){for(var t,n,i,r=0;r<e.length;++r)for(n=e[r],t=r+1;t<e.length;++t)y((i=e[t])[0],n)&&y(i[1],n)&&y(i[2],n)&&(e.splice(t,1),--t)}(C.contact.Surface),C}function R(t,n,i,a){let o=new p;if(!(t.vertices&&t.vertices.length&&n.vertices&&n.vertices.length))return;let c=t.vertices.length/3,f=n.vertices.length/3;t.addedTriangles||(t.triangleAdded=[],t.triangleAABB=[],t.triangleAdded.length=t.triangleAABB.length=c),n.addedTriangles||(n.triangleAdded=[],n.triangleAABB=[],n.triangleAdded.length=n.triangleAABB.length=f);let u=t.vertices,d=n.vertices;for(let h=0;h<c;++h){t.triangleAABB[h]||(t.triangleAABB[h]=e.computeAABBForTriangle(u[3*h],u[3*h+1],u[3*h+2]));for(let c=0;c<f;++c){if(++l>1e6&&(l=0,performance.now()-s>a)){o.status="maxTime";break}n.triangleAABB[c]||(n.triangleAABB[c]=e.computeAABBForTriangle(d[3*c],d[3*c+1],d[3*c+2])),e.computeAABBSquaredDistance(t.triangleAABB[h],n.triangleAABB[c])<=i&&0===r.computeTwoTrianglesSquaredDistance(u[3*h],u[3*h+1],u[3*h+2],d[3*c],d[3*c+1],d[3*c+2],i).returnCode&&(t.triangleAdded[h]||(t.triangleAdded[h]=1,o.clearance1.push([u[3*h],u[3*h+1],u[3*h+2]])),n.triangleAdded[c]||(n.triangleAdded[c]=1,o.clearance2.push([d[3*c],d[3*c+1],d[3*c+2]])))}if("OK"!==o.status)break}return o}return p.prototype={constructor:p,concat:function(e){if(!e)return;let t,n;if("OK"!==e.status&&(this.status=e.status),0===this.clash.length)this.clash=e.clash;else if(e.clash.length>0)for(t=e.clash.length,n=0;n<t;++n)this.clash.push(e.clash[n]);if(0===this.contact.length)this.contact=e.contact;else if(e.contact.length>0)for(t=e.contact.length,n=0;n<t;++n)this.contact.push(e.contact[n]);if(0===this.clearance1.length)this.clearance1=e.clearance1;else if(this.clearance1.length>0)for(t=e.clearance1.length,n=0;n<t;++n)this.clearance1.push(e.clearance1[n]);if(0===this.clearance2.length)this.clearance2=e.clearance2;else if(this.clearance2.length>0)for(t=e.clearance2.length,n=0;n<t;++n)this.clearance2.push(e.clearance2[n])}},Object.freeze({computeGeometries:function(t){if(l=0,s=performance.now(),!(t&&t.path1&&t.path2&&t.itfType&&t.maxTime))return;let i;return"Clash"===t.itfType||"Contact"===t.itfType?i=E(t.path1,t.path2,t.itfType,t.maxTime):"Clearance"===t.itfType&&(i=function(t){if(!t.clearanceValue||t.clearanceValue<=0)return;let i,r,l=t.clearanceValue*t.clearanceValue,c=new p,f=t.path1,u=t.path2;for(let e=f.externalPath.length-1;e>=0&&!i;--e){let t=f.externalPath[e];a.isRepReference(t)&&(i=t)}for(let e=u.externalPath.length-1;e>=0&&!r;--e){let t=u.externalPath[e];a.isRepReference(t)&&(r=t)}if(!i||!r)return;let d=f.getWorldMatrix(),h=u.getWorldMatrix(),b=n.retrieveProductAABB;if(e.computeAABBSquaredDistance(b(i,d),b(r,h))>l)return;let y=o._authorizedTeamsOnly_getKey(),I=g(m(f,y),d.elements),C=I.length,P=g(m(u,y),h.elements),v=P.length,w=[];for(let t=0;t<C;++t)for(let n=0;n<v;++n)e.computeAABBSquaredDistance(I[t].aabb,P[n].aabb)<=l&&w.push([t,n]);for(let e=0;e<w.length&&(c.concat(R(I[w[e][0]],P[w[e][1]],l,t.maxTime)),"OK"===c.status);++e);return c.time=performance.now()-s,c}(t)),i&&(i.time=performance.now()-s),i},computeMinDist:function(e){let t=n.measureBetweenWithParts(n.MeasuredType.PRODUCT,e.path1,e.path2);return t&&0===t.returnCode?{minDist:Math.sqrt(t.squaredDistance),pos1:t.aPosition1,pos2:t.aPosition2}:{minDist:0}}})}),define("DS/PIMwebViewController/PIMwebDefaultCmd",["DS/ApplicationFrame/Command","DS/PADUtils/PADContext","DS/CATWebUXPreferences/CATWebUXPreferencesManager","DS/CATWebUXPreferences/CATWebUXPreferencesUtils","DS/CATWebUXSelectionManager/CATWebUXSelectionManager"],function(e,t,n,i,r){"use strict";return e.extend({init:function(e){this._parent(e,{mode:"exclusive",isAsynchronous:!0}),this.setRepeatMode(!1);var a=t.get(),o=n.givePreferenceManager({context:a.getFrameWindow()}),l=[],s=r.getSelectionManager({context:a});o.setUnitsPreferencesDisplayFlag(!0),o.setDisplayPreferencesDisplayFlag(!0),o.set3DSelectionPreferencesDisplayFlag(!0),o.setPreferredPreferenceContainersOrder(["PIMwebPrefLoad","PIMwebPrefDisplay","MeasurePreferences","SectionPreferences"]),l.push(o.subscribe("CATWebUXPreferences_GravitationalEffects",function(e){var t=a?a.getViewer():null;t&&t.currentViewpoint&&t.currentViewpoint.control&&(t.currentViewpoint.getControl().setRotationRolling(!e),t.currentViewpoint.getControl().setRollingForTouchAvailable(!e))})),l.push(o.subscribe("CATWebUXPreferences_ProjectionType",function(e){var t=a?a.getViewer():null;t&&t.currentViewpoint&&t.currentViewpoint.setProjectionType(e)})),l.push(o.subscribe("CATWebUXPreferences_Select3DGeometry",function(e){s.setPicking(e?0:1)})),l.CATWebUXPreferences_SelectParentReferenceOr3DShape=o.subscribe("CATWebUXPreferences_SelectParentReferenceOr3DShape",function(e){s&&s.selectParentReference("select3DShape"!==e)});var c=i.getPreference("CATWebUXPreferences_GravitationalEffects","boolean");"boolean"==typeof c&&(a.getViewer().currentViewpoint.getControl().setRotationRolling(!c),a.getViewer().currentViewpoint.getControl().setRollingForTouchAvailable(!c));var f=i.getPreference("CATWebUXPreferences_ProjectionType","int");0!==f&&1!==f||a.getViewer().currentViewpoint.setProjectionType(f),s.setPicking(i.getPreference("CATWebUXPreferences_Select3DGeometry","boolean")?0:1);let u=i.getPreference("CATWebUXPreferences_SelectParentReferenceOr3DShape","string");s&&s.selectParentReference("select3DShape"!==u),this.beginExecute=this.resumeExecute=function(){a&&(s.setActiveState(!0),a.getViewer().setPicking({trapSelection:!0,trapPrimitive:!1,trapGPU:!0}))},this.endExecute=this.pauseExecute=function(){a&&s.setActiveState(!1)},this._destroy=function(){a&&(l.forEach(o.unsubscribe,o),r.unreferenceSelectionManager({context:a}),a=o=l=s=null,Object.getPrototypeOf(this)._destroy.apply(this,arguments))}}})}),define("DS/PIMwebViewController/PIMwebInteferenceListCmd",["DS/ApplicationFrame/CommandCheckHeader","DS/PADUtils/PADContext"],function(e,t){"use strict";return e.extend({init:function(e){this._parent(e);var n,i,r=this;require(["DS/PIMwebViewController/PIMwebItfCtrl"],function(e){n=e.getItfCtrl({pad3DViewer:t.get()}),i=n.subscribe("onItfListClosed",function(){r&&r.setState(!1)}),r&&r.setState("1"===localStorage.getItem("PIMwebItfListVisPref"))}),this.onStateChange(function(){if(n&&r){var e=r.getState();e?n.showGUX():n.hideGUX(),localStorage.setItem("PIMwebItfListVisPref",e?"1":"0")}}),this._destroy=function(){n&&n.subscribe(i),n=r=i=null;var e=Object.getPrototypeOf(this);e._destroy&&e._destroy.apply(this,arguments)}}})}),define("DS/PIMwebViewController/PIMwebGenerateTICCmd",["DS/CATWebUXTIC/CATWebUXTICCmdAdapt","DS/ApplicationFrame/CommandsManager","DS/PADUtils/PADContext","DS/PIMwebViewController/PIMwebItfCtrl"],function(e,t,n,i){"use strict";return e.extend({init:function(e){var r=this,a=[],o=n.get();e.pad3DViewer=o,this._parent(e);var l=i.getItfCtrl({pad3DViewer:o});a.push(l.subscribe("onIsrAdded",function(){r.enable()})),a.push(l.subscribe("onItfAdded",function(){r.enable()})),a.push(l.subscribe("onIsrRemoved",function(){r.disable()})),l.getLoadedIsr().length&&r.enable(),this.getParameters=function(e){var n=l.getLoadedIsr();if(0!==n.length)if(n.length>1)e.onFailure("More than one isr. Specifications to rework!");else{var i=t.getCommandCheckHeader("PIMInteferenceListHdr",o.getCommandContext()),r=t.getCommandCheckHeader("CATWebUXSlideShowHdr",o.getCommandContext());l.getTICInfo(e.cmdType,i&&i.getState()||r&&r.getState()).then(function(t){t?e.onComplete(t):e.onCancel()})}else e.onFailure("No isr. Execution of command must not be possible")},this._destroy=function(){a.forEach(l.unsubscribe,l),l=a=r=null;var e=Object.getPrototypeOf(this);e._destroy&&e._destroy.apply(this,arguments)}}})}),define("DS/PIMwebViewController/PIMwebExportAsCSVCmd",["DS/ApplicationFrame/Command","DS/PADUtils/PADContext","DS/PIMwebViewController/PIMwebItfCtrl","DS/PIMwebViewModel/PIMwebUtils"],function(e,t,n,i){"use strict";return e.extend({init:function(e){this._parent(e,{mode:"exclusive",isAsynchronous:!1}),this.setRepeatMode(!1);var r="Visible";e&&e.arguments&&e.arguments[0]&&e.arguments[0].type&&(r=e.arguments[0].type),this.execute=function(){var e=n.getItfCtrl({pad3DViewer:t.get()}),a=e.getLoadedIsr(),o=a[0]&&a[0].isr?a[0].isr.getAttributes().label:"",l=new Date;l=new Date(l.getTime()-60*l.getTimezoneOffset()*1e3).toISOString().slice(0,23),this._downloadFile(e.exportAsCSV({onlySelectedRows:"Selected"===r}),o+"_"+l+".csv"),i._sendUsageProbe("command","Visible"===r?"ExportVisibleItfToCSV":"ExportSelectedItfToCSV")},this._downloadFile=function(e,t){var n=new Blob([e],{type:"text/csv"}),i=window.URL.createObjectURL(n),r=document.createElement("a");r.style.display="none",r.download=t,r.href=i,document.body.appendChild(r),r.click(),window.URL.revokeObjectURL(i),document.body.removeChild(r)}}})}),define("DS/PIMwebViewController/PIMwebCreateEditIsrCmd",["DS/ApplicationFrame/Command","DS/PADUtils/PADContext","DS/PIMwebViewController/PIMwebItfCtrl","DS/PIMwebViewModel/PIMwebUtils","DS/PIMwebUX/PIMwebIsrPanelView","DS/Windows/Dialog","DS/Controls/Button","DS/ENOPAD3DViewer/utils/PAD3DViewerModelServices","DS/ENONextGenFilterUX/utils/FilterUIService","DS/ENONextGenFilterUX/utils/FilterPersistencyServices","DS/Selection/CSOManager","DS/Selection/HSOManager","DS/Selection/PSOManager","DS/LevelSelector/LevelSelector","DS/PIMwebUX/PIMwebGroupDefinitionPanelView","DS/PADUtils/PADUtilsServices","DS/PIMwebViewModel/PIMwebIsrMgr","DS/Visualization/PathElement","DS/CoreEvents/Events","DS/CATWebUXPreferences/CATWebUXPreferencesUtils","i18n!DS/PIMwebViewController/assets/nls/PIMwebCreateEditIsrCmd"],function(e,t,n,i,r,a,o,l,s,c,f,u,d,h,p,m,g,b,y,I,C){"use strict";return e.extend({init:function(e){var P,v,w,D,S,M=this,x=!0,A=!0,O=!0,T=!0,L=!0;this._parent(e,{mode:"exclusive",isAsynchronous:!0}),this.setRepeatMode(!1);var E,R="Create",V="I3S",k=!1;e&&e.arguments&&e.arguments[0]&&e.arguments[0].type&&(R=e.arguments[0].type),"Edit"===R&&(V=e.arguments[0].app);var F,N,U,_,G,B,W,j,X,Q,z,q,H=t.get(),K={},J=[],Z=0,Y=null,$=null,ee=null,te=null,ne=[],ie=!0,re=!1,ae=n.getItfCtrl({pad3DViewer:H});function oe(){P&&D&&D.disableAllTabs()}function le(e,t,n){var i={context:{}};"Create"===R&&(i.title=e.isrTitle,i.name=e.isrName,Object.keys(E).forEach(function(t){E[t]===e.isrType&&(i.type=t)}),i.description=e.isrDesc,i.context.rootRefID=t.ProductContext.id),i.context.filterID=t.FilterContext&&t.FilterContext.id||"",i.groupMode=t.Config;for(var r=t.Groups.length,a=[],o=0;o<r;o++){var l={};if(l.mode=t.Groups[o].isFilter?"filter":"occurrence","filter"===l.mode)l.content=t.Groups[o].Elements[0].id;else{for(var s=[],c=t.Groups[o].Elements,f=0;f<c.length;f++){for(var u=[],d=c[f].pathElement.externalPath.length,h=c[f].pathElement.externalPath,p=1;p<d;p++)u.push(h[p].modelIdentification);s.push(u)}l.content=s}a.push(l)}i.groups=a,i.appendInterRep=n.CheckInterRep,i.computeInterRep=n.CompBetweenIntermediateReps;var m=[];!0===n.EngineeringCnx.EnggCnxChecked?m.push("on"):m.push("off"),!0===n.EngineeringCnx.CheckNoClash&&m.push("MCX_Check_NoClash"),!0===n.EngineeringCnx.CheckContact&&m.push("MCX_Check_Contact"),!0===n.EngineeringCnx.CheckClearance&&m.push("MCX_Check_Clearance"),!0===n.EngineeringCnx.NoCheck&&m.push("MCX_Ignore"),i.specMCX=m.join("|"),i.specStd="",!0===n.ComputationMode.Clash&&!1===n.ComputationMode.Contact&&!1===n.ComputationMode.Clearance?i.specStd="Clash":!0===n.ComputationMode.Clash&&!0===n.ComputationMode.Contact&&!1===n.ComputationMode.Clearance?i.specStd="ClashContact":!0===n.ComputationMode.Clash&&!0===n.ComputationMode.Contact&&!0===n.ComputationMode.Clearance&&(i.specStd="ClashContactClearance");var g=!0===n.KnowledgeRule.KnwRulesChecked?"on":"off";n.KnowledgeRule.RuleSet&&(g+="|"+n.KnowledgeRule.RuleSet.id),i.specRule=g,i.electricalItfs=n.CheckElec,i.pathwayItfs=n.checkPathways;var b=n.ComputationMode.ClearanceValue.trim(),y=parseFloat(b),C=b.replace(y.toString(),"").trim();return""===C&&(C=I.getCurrentUnit("Length").unit),i.value_of_clearance=I.convert(y,"Length",C,"m"),n.ComputeQuantifer?(i.clashQuantifier=n.ComputeQuantifer.PenVector,i.clearQuantifier=n.ComputeQuantifer.MinDist,i.volumeQuantifier=n.ComputeQuantifer.PenVolume):n.StoredResults&&!re&&function(e,t){t.clashQuantifier=1===e.StoredResults.ClashQuantifier||3===e.StoredResults.ClashQuantifier,t.clearQuantifier=1===e.StoredResults.ClearanceQuantifier,t.volumeQuantifier=2===e.StoredResults.ClashQuantifier||3===e.StoredResults.ClashQuantifier,t.clashGeometryStorage=e.StoredResults.ClashGeometry,t.contactGeometryStorage=e.StoredResults.ContactGeometry,t.clearanceGeometryStorage=e.StoredResults.ClearanceGeometry;var n=parseFloat(e.StoredResults.Accuracy.value),i=e.StoredResults.Accuracy.units;""===i&&(i=I.getCurrentUnit("Length").unit),t.clearanceAreaGeometryAccuracy=I.convert(n,"Length",i,"m"),t.geometryDetail=e.StoredResults.GeometryDetail}(n,i),i.checkFasteners=n.Fasteners.FstChecked,i.checkFasteneds=n.Fasteners.CheckItfWithFastenedParts,i.destroyOutOfScope=n.ReuseExistingItf.DeleteOutOfScopeItf,i.compare=n.ReuseExistingItf.RecomputeOnlyModItf,i}function se(e){("Create"===R||ie&&"I3D"!==V&&!re)&&P&&P.buttons&&P.buttons.Ok&&(""===e?(P.buttons.Ok.disabled=!0,S=!1,D&&(D.setIsrTabValidity(!1),D.setIsrTitleValidity(!1))):(S=!0,!0===x&&!0===A&&!0===O&&!0===T&&!0===L&&(P.buttons.Ok.disabled=!1),D&&(D.setIsrTabValidity(!0),D.setIsrTitleValidity(!0))))}function ce(e){P&&P.buttons&&P.buttons.Ok&&("Create"!==R&&!ie||"I3D"===V||re?oe():"GroupInfoSufficient"===e?(x=!0,!0===S&&!0===A&&!0===O&&!0===T&&!0===L&&(P.buttons.Ok.disabled=!1),D&&D.setContextTabValidity(T)):"GroupInfoInsufficient"===e&&(x=!1,P.buttons.Ok.disabled=!0,D&&D.setContextTabValidity(!1)))}function fe(e){("Create"===R||ie&&"I3D"!==V&&!re)&&P&&P.buttons&&P.buttons.Ok&&("KnwRuleInfoSufficient"===e?(A=!0,!0===S&&!0===x&&!0===O&&!0===T&&!0===L&&(P.buttons.Ok.disabled=!1),D&&D.setSpecTabValidity(O&&L)):"KnwRuleInfoInsufficient"===e&&(A=!1,P.buttons.Ok.disabled=!0,D&&D.setSpecTabValidity(!1)))}function ue(e){("Create"===R||ie&&"I3D"!==V&&!re)&&P&&P.buttons&&P.buttons.Ok&&("EngCnxInfoSufficient"===e?(O=!0,!0===S&&!0===x&&!0===A&&!0===T&&!0===L&&(P.buttons.Ok.disabled=!1),D&&D.setSpecTabValidity(A&&L)):"EngCnxInfoInsufficient"===e&&(O=!1,P.buttons.Ok.disabled=!0,D&&D.setSpecTabValidity(!1)))}function de(e){("Create"===R||ie&&"I3D"!==V&&!re)&&P&&P.buttons&&P.buttons.Ok&&("SpecInfoSufficient"===e?(L=!0,!0===S&&!0===x&&!0===A&&!0===T&&!0===O&&(P.buttons.Ok.disabled=!1),D&&D.setSpecTabValidity(A&&O)):"SpecInfoInsufficient"===e&&(L=!1,P.buttons.Ok.disabled=!0,D&&D.setSpecTabValidity(!1)))}function he(e){("Create"===R||ie&&"I3D"!==V&&!re)&&P&&P.buttons&&P.buttons.Ok&&("ContextInfoSufficient"===e?(T=!0,!0===S&&!0===x&&!0===A&&!0===O&&(P.buttons.Ok.disabled=!1),D&&D.setContextTabValidity(x)):"ContextInfoInsufficient"===e&&(T=!1,P.buttons.Ok.disabled=!0,D&&D.setContextTabValidity(!1)))}function pe(e){("Create"===R||ie&&"I3D"!==V&&!re)&&P&&P.buttons&&P.buttons.Ok&&""!==e&&D&&D.setIsrTabTitle(e)}function me(){("Create"!==R&&!ie||"I3D"===V||re)&&oe(),y.unsubscribe(z)}function ge(){("Create"!==R&&!ie||"I3D"===V||re)&&oe(),y.unsubscribe(q)}function be(){return v=new o({emphasize:"primary",label:"Create"!==R?C.editButton:C.createButton,onClick:function(e){e&&e.dsModel&&!e.dsModel.disabled&&(P&&P.buttons&&P.buttons.Ok&&(P.buttons.Ok.disabled=!0),"Create"===R?function(){D.writePIMwebIsrPrefs();var e={data:le(D.getIsrInfo(),D.getContextInfo(),D.getSpecInfo()),onComplete:function(e){H.displayNotification({msg:C.isrCreated,eventID:"success"}),ae.load({isrID:e.isrID,noNotif:!0}),M.end()},onFailure:function(){H.displayNotification({msg:C.isrCreationFailed,eventID:"error"}),M.end()}};g.createIsr(e)}():function(){D.writePIMwebIsrPrefs();var e={data:le({isrPid:U},D.getContextInfo(),D.getSpecInfo()),onComplete:function(){H.displayNotification({msg:C.isrEdited,eventID:"success"}),M.end()},onFailure:function(){H.displayNotification({msg:C.isrEditionFailed,eventID:"error"}),M.end()}};te.setSpecAndContextInfo(e),M.end()}())}}),w=new o({label:!ie||"I3D"===V||re?C.closeButton:C.cancelButton,onClick:function(){M.end()}}),(P=new a({modalFlag:!0,ensureHeightDefinitionOnHierarchy:!0,title:"Create"!==R?C.editIsrPanelTitle:C.createIsrPanelTitle,resizableFlag:!0,immersiveFrame:H.getFrameWindow().getImmersiveFrame(),buttons:!ie||"I3D"===V||re?{Cancel:w}:{Ok:v,Cancel:w},width:530,minWidth:530,height:350,minHeight:350})).elements.container.getElementsByClassName("wux-windows-window-content")[0].setStyles({overflow:"hidden"}),k=!1,"Create"===R&&Object.keys(g.getLoadedIsr()).length&&(k=!0,v.emphasize="medium-attention",v.icon={iconName:"attention",fontIconFamily:WUXManagedFontIcons.Font3DS}),P.addEventListener("close",function(){M.end()}),_=y.subscribe({event:"onTitleChange"},se),G=y.subscribe({event:"onGroupInfoChange"},ce),B=y.subscribe({event:"onKnwInfoChange"},fe),W=y.subscribe({event:"onEngCnxInfoChange"},ue),j=y.subscribe({event:"onSpecInfoChange"},de),X=y.subscribe({event:"onContextInfoChange"},he),Q=y.subscribe({event:"onIsrTypeChange"},pe),z=y.subscribe({event:"onSpecTabComplete"},me),q=y.subscribe({event:"onContextTabComplete"},ge),{parent:P,isWeb:!0,type:R,pad3DViewer:H,ctrl:M,isrAlreadyLoaded:k}}function ye(e){if(e.error)return H.displayNotification({msg:e.error,eventID:"error"}),void M.end();var t=new Promise(function(t){(function(e){return new Promise(function(t){e||M.end();var n={Groups:[]};if(!re){e.context&&e.context.prd||(H.displayNotification({msg:C.noIsrContext,eventID:"error"}),M.end());var i=e.context.prd;if(n.ProductContext={id:i.physicalid,alias:i.label,type:i.type},e.context.filter){var r=e.context.filter;n.FilterContext={id:r.physicalid,alias:r.label,type:r.type}}}n.Config=e.groupMode;var a=e.groups.length;if(0===a)t(n);else{for(var o=[],l=H.getRootBagPath().getLastElement(),s=0;s<a;s++){var c={};c.isFilter="filter"===e.groups[s].mode,c.Elements=[];var f={};if(c.isFilter)f.id=e.groups[s].content,o.push(f.id),c.Elements.push(f);else for(var u=e.groups[s].content,d=e.groups[s].content.length,h=0;h<d;h++){f={};var p=u[h].length;f.id=u[h][p-1],o.push(f.id);var m=[];m.push(l);for(var g=0;g<p;g++)m.push(H.getController().getNode({id:u[h][g]}));var y=new b;y.setFromArray(m),f.pathElement=y,c.Elements.push(f)}n.Groups.push(c)}M.getLoadedVPMRefRootData(o).then(function(e){for(var i=e.map(function(e){return e.id}),r=0;r<a;r++)for(var o=n.Groups[r].Elements,l=o.length,s=0;s<l;s++){var c=i.indexOf(o[s].id);-1!==c&&(o[s].label=e[c].alias,o[s].icons=[e[c].icon])}t(n)})}})})(e).then(function(e){t(e)})}),n=new Promise(function(t){(function(e){return new Promise(function(t){var n={ComputationMode:{},Fasteners:{},EngineeringCnx:{},KnowledgeRule:{},ReuseExistingItf:{},ComputeQuantifer:{}};"Clash"===e.specStd?(n.ComputationMode.Clash=!0,n.ComputationMode.Contact=!1,n.ComputationMode.Clearance=!1):"ClashContact"===e.specStd?(n.ComputationMode.Clash=!0,n.ComputationMode.Contact=!0,n.ComputationMode.Clearance=!1):"ClashContactClearance"===e.specStd&&(n.ComputationMode.Clash=!0,n.ComputationMode.Contact=!0,n.ComputationMode.Clearance=!0),n.CheckInterRep=e.appendInterRep,n.CompBetweenIntermediateReps=e.computeInterRep,n.ComputationMode.ClearanceValue=(1e3*parseFloat(e.value_of_clearance)).toString()+"mm",n.Fasteners.FstChecked=e.checkFasteners,n.Fasteners.CheckItfWithFastenedParts=e.checkFasteneds,n.checkElec=!!e.electricalItfs&&e.electricalItfs,n.checkPathways=!!e.pathwayItfs&&e.pathwayItfs;var i=[];i=e.specMCX.split("|"),n.EngineeringCnx.EnggCnxChecked=-1!==i.indexOf("on"),n.EngineeringCnx.CheckNoClash=-1!==i.indexOf("MCX_Check_NoClash"),n.EngineeringCnx.CheckContact=-1!==i.indexOf("MCX_Check_Contact"),n.EngineeringCnx.CheckClearance=-1!==i.indexOf("MCX_Check_Clearance"),n.EngineeringCnx.NoCheck=-1!==i.indexOf("MCX_Ignore"),n.ReuseExistingItf.DeleteOutOfScopeItf=e.destroyOutOfScope,n.ReuseExistingItf.RecomputeOnlyModItf=e.compare,re?(n.ComputeQuantifer.PenVector=e.clashQuantifier,n.ComputeQuantifer.MinDist=e.clearQuantifier,n.ComputeQuantifer.PenVolume=e.volumeQuantifier):(n.StoredResults={},e.clashQuantifier||e.volumeQuantifier?e.clashQuantifier&&!e.volumeQuantifier?n.StoredResults.ClashQuantifier=1:!e.clashQuantifier&&e.volumeQuantifier?n.StoredResults.ClashQuantifier=2:n.StoredResults.ClashQuantifier=3:n.StoredResults.ClashQuantifier=0,n.StoredResults.ClearanceQuantifier=e.clearQuantifier?1:0,n.StoredResults.ClashGeometry=e.clashGeometryStorage,n.StoredResults.ContactGeometry=e.contactGeometryStorage,n.StoredResults.ClearanceGeometry=e.clearanceGeometryStorage,n.StoredResults.Accuracy={},n.StoredResults.Accuracy.value=1e3*parseFloat(e.clearanceAreaGeometryAccuracy),n.StoredResults.Accuracy.units="mm",n.StoredResults.GeometryDetail=e.geometryDetail);var r=[];r=e.specRule.split("|"),n.KnowledgeRule.KnwRulesChecked=-1!==r.indexOf("on"),r.length>1?(n.KnowledgeRule.RuleSet={},M.getLoadedVPMRefRootData([r[1]]).then(function(e){n.KnowledgeRule.RuleSet=e[0],t(n)})):t(n)})})(e).then(function(e){t(e)})});Promise.all([n,t]).then(function(t){ie=e.isEditable;var n=be();n.isNonPersistIsr=re,n.readOnly=!ie||"I3D"===V||re,n.specInfo=t[0],n.contextInfo=t[1],D=new r(n),S=x=A=O=T=L=!0})}function Ie(){f.unsubscribe(K.onAdd),f.unsubscribe(K.onRemove),f.unsubscribe(K.onEmpty),K={}}function Ce(){(K={}).onAdd=f.onAdd(N),K.onRemove=f.onRemove(N),K.onEmpty=f.onEmpty(N)}function Pe(e){var t=new o({emphasize:"primary",label:C.okButton,onClick:e.onOK}),n=new o({label:C.cancelButton,onClick:e.onCancel}),i=new a({modalFlag:!1,ensureHeightDefinitionOnHierarchy:!0,title:C.groupDefinitionPanelTitle,resizableFlag:!0,immersiveFrame:H.getFrameWindow().getImmersiveFrame(),position:{my:"down right",at:"down right"},buttons:{Ok:t,Cancel:n},width:300,minWidth:300,height:100});return i.addEventListener("close",e.onClose),i}function ve(){h.destroyView(),Y.destroy(),Y=null,F=null,u.empty(),f.empty(),Ie(),P.show()}function we(){for(var e=0;e<J.length;e++)D.createGroupViewWithInfo([J[e]]);ve()}function De(){D.addInfoInGroup(ee,J),ve()}re=ae.isPIMDataLoaded(),"Create"!==R&&(S=!0,M.disable(),ne.push(ae.subscribe("onIsrAdded",function(){M.enable()})),ne.push(ae.subscribe("onItfAdded",function(){M.enable()})),ne.push(ae.subscribe("onIsrRemoved",function(){M.disable()})),(ae.getLoadedIsr().length||ae.isPIMDataLoaded())&&M.enable()),this.execute=function(){i._sendUsageProbe("command","Create"===R?"CreateItf":"EditItf"),x=A=O=T=L=!0,re=ae.isPIMDataLoaded(),function(){if("Create"!==R){var e={};if(re)ae&&(e=ae.getSpecAndContextInfoFromCtrl()),ye(e);else{var t=g.getLoadedIsr();if(!Object.keys(g.getLoadedIsr()).length)return H.displayNotification({msg:C.noIsrInSession,eventID:"info"}),M.end();if(Object.keys(g.getLoadedIsr()).length>1)return H.displayNotification({msg:C.onlySingleIsrInSessionAllowed,eventID:"info"}),M.end();if(!(U=Object.keys(t)[0]))return M.end();var n={pid:U,onComplete:function(e){ye(e)},onFailure:function(e){H.displayNotification({msg:C["No stream retrieved"===e?"isrCannotAccessIsrDefinition":"isrInfoRetrievalFailed"],eventID:"error"}),M.end()}};(te=g.getIsr(U))&&te.getSpecAndContextInfo(n)}}else S=!1,D=new r(be()),P&&P.buttons&&P.buttons.Ok&&(P.buttons.Ok.disabled=!0);D&&D.checkContextInfoValidity(),"Create"===R||ie&&"I3D"!==V&&!re||oe()}()},this.pauseExecute=function(){M.end()},this.endExecute=function(){Ie(),P&&(y.unsubscribe(_),y.unsubscribe(G),y.unsubscribe(B),y.unsubscribe(W),y.unsubscribe(X),y.unsubscribe(j),y.unsubscribe(Q),P.destroy(),P=null,H&&H.getFrameWindow()&&H.getFrameWindow().getContextualUIManager()&&H.getFrameWindow().getContextualUIManager().activateContextualBarOnLeftClic()),$&&($.destroy(),$=null),Y&&(Y.destroy(),Y=null)},this._destroy=function(){ne&&ae&&ne.forEach(ae.unsubscribe,ae),ae=ne=null,H&&H.getFrameWindow()&&H.getFrameWindow().getContextualUIManager()&&H.getFrameWindow().getContextualUIManager().activateContextualBarOnLeftClic(),M=null,H=null;var e=Object.getPrototypeOf(this);e._destroy&&e._destroy.apply(this,arguments)},this.searchProducts=function(){return new Promise(function(e){require("DS/PADServices/views/LandingPage").launchSearch({title:C.isrProductSearchPageTitle,precondition:'flattenedtaxonomies:"types/VPMReference"',showApplyButton:!0,ok:function(t){e(t.map(function(e){return{id:e.resourceid,type:e["ds6w:type_value"],alias:e["ds6w:label"]}}))}})})},this.getLoadedRoots=function(){return H.getRoots().map(function(e){return l.getNodeID(e)})},this.getAddedVPMRefRoots=function(){return H.getRoots().map(function(e){if("VPMReference"===l.getNodeType(e))return l.getNodeID(e)})},this.getLoadedVPMRefRootData=function(e){return new Promise(function(t){for(var n={},i=[].concat(e),r=H.getController(),a=0;a<e.length;a++){var o=r.isFiltered(e[a]);o&&o.hasFilter&&o.filterId&&(n[e[a]]={filterId:o.filterId},i.push(o.filterId))}var l=[];r.getAttributes({ids:i,attributes:["ds6w:label","ds6w:type","type_icon_url"],callbacks:{onComplete:function(i){for(var r=0;r<e.length;r++)if(i[e[r]]){var a=i[e[r]]["ds6w:label"],o=i[e[r]]["ds6w:type"],s=i[e[r]].type_icon_url,c={id:e[r],type:o,alias:a,icon:s};n[e[r]]&&n[e[r]].filterId&&i[n[e[r]].filterId]&&(c.filterId=n[e[r]].filterId,c.filterAlias=i[c.filterId]["ds6w:label"],c.filterType=i[c.filterId]["ds6w:type"],c.filterIcon=i[c.filterId].type_icon_url),l.push(c)}t(l)},onFailure:function(){H.displayNotification({msg:C.attrRetrievalFailed,eventID:"info"}),t(l)}}})})},this.searchFilters=function(e){return new Promise(function(t){var n=m.getPlatformId();s.getPlatformServices(n).then(function(){c.retrieveAllFilters([e]).then(function(e){if(e.length){var n=[];e.forEach(function(e){n.push(e.filterId)});var i=n.join(" OR physicalid:");i="(physicalid:"+i+")",m.inAppsSearch({precond:i,title:C.isrFilterSearchPageTitle,callback:function(e){t(e.selected_objects.map(function(e){return{id:e.resourceid,type:e["ds6w:type_value"],alias:e["ds6w:label"],icons:[e.type_icon_url]}}))},cancel:function(){t()}})}else H.displayNotification({msg:C.noFilterFound,eventID:"info"}),t()})})})},N=function(){var e=f.get();if(e.length){for(var t=!0,n=0;n<e.length;n++)if(e[n].pathElement.externalPath[1].modelIdentification!==F){t=!1,H.displayNotification({msg:C.noContextMatch,eventID:"info"});break}t&&function(e){if(e&&0!==e.length){var t=e[0].pathElement,n=e[0].event;if(n){M._levelSelectorContext=e[0].pathElement.clone();var i=[],r={positionX:n.currentPosition.x,positionY:n.currentPosition.y,uiFrame:H.getFrameWindow().getUIFrame(),getLevels:function(e){for(var r=[],a=t;a;){if(l.isPLMNode(a.externalPath[a.externalPath.length-1])&&l.isReference(a.externalPath[a.externalPath.length-1])){var o=a.getLastElement(!0),s=l.getBIColor(o);null!==s?i.push({pathElement:a,canvasColor:s,event:n}):i.push({pathElement:a,event:n}),r.push(l.getNodeID(a.getLastElement(!0)))}a=a.getParentPath()}var c=["ds6w:label","type_icon_url"],f="";H.getController().isColorizeActivated()&&H.getController().isStandalone()&&(f=H.getController().getBIColorMap().predicate,c.push(f)),H.getController().getAttributes({ids:r,attributes:c,callbacks:{onComplete:function(t,n){for(var r=0;r<i.length;++r){var a=i[r],o=l.getNodeID(a.pathElement.getLastElement(!0));if(n[o]&&(a.name=n[o]["ds6w:label"],a.icon=n[o].type_icon_url,H.getController().isColorizeActivated()&&H.getController().isStandalone()&&""!==t)){var s=n[o][t];a.canvasColor=H.getController().getColorValueForPredicate(s)}}e(i)}.bind(this,f),onFailure:function(){e(i)}}});for(var u=0;u<i.length;++u){var d=i[u],h=l.getNodeID(d.pathElement.getLastElement(!0));F===h&&(d.selection="notSelectable")}return i},onHover:function(e){u.empty(),d.empty(),e.event=n,u.add(e)},onLeave:function(){u.empty(),d.empty(),u.add({pathElement:M._levelSelectorContext,event:n})},onSelect:function(e){Ie(),u.empty(),f.empty(),e.event=n,u.add(e),f.add(e),h.destroyView();var t,r,a=i.filter(function(t){return t.pathElement===e.pathElement}),o=!1;if(ee){var s=ee.model.getRoots();for(t=0;t<s.length;t++)if(e.pathElement.isEqual(s[t].options.pathElement)){H.displayNotification({msg:C.isrCtxGroupElementAlreadyAdded,eventID:"info"}),o=!0;break}}if(!o)for(r=0;r<J.length;r++)if(e.pathElement.isEqual(J[r].pathElement)){H.displayNotification({msg:C.isrCtxGroupElementAlreadyAdded,eventID:"info"}),o=!0;break}o||(J.push({id:l.getNodeID(e.pathElement.getLastElement(!0)),label:a[0].name,icons:[a[0].icon],pathElement:e.pathElement}),Z++,$.setEditorText(Z>0?Z.toString().concat(" ",Z>1?C.isrCtxGroupProductsSelected:C.isrCtxGroupProductSelected):C.isrCtxGroupNoSelection)),Ce()}};h.createView(r)}}}(e)}else h.destroyView()},this.addMoreGroups=function(e){!function(e){F=e,J=[],ee=null,Z=0,P.hide();var t={onOK:we,onCancel:ve,onClose:ve};Y&&(Y.destroy(),Y=null);var n={parent:Y=Pe(t),editorText:C.isrCtxGroupNoSelection};$=new p(n),Y.show(),H.getFrameWindow().getContextualUIManager().deactivateContextualBarOnLeftClic(),Ce()}(e)},this.addElementsInGroup=function(e,t){!function(e,t){F=e,ee=t,J=[],Z=t.isFilter?0:t.model.getRoots().length,P.hide();var n={onOK:De,onCancel:ve,onClose:ve};Y&&(Y.destroy(),Y=null),Y=Pe(n);var i=t.isFilter?C.isrCtxGroupFilterSelected:Z>0?Z.toString().concat(" ",Z>1?C.isrCtxGroupProductsSelected:C.isrCtxGroupProductSelected):C.isrCtxGroupNoSelection;$=new p({parent:Y,editorText:i}),Y.show(),H.getFrameWindow().getContextualUIManager().deactivateContextualBarOnLeftClic(),Ce()}(e,t)},this.onPostRowSelect=function(e){for(var t=0;t<e.length;t++)e[t]._options&&e[t]._options.pathElement&&(u.add({pathElement:e[t]._options.pathElement}),f.add({pathElement:e[t]._options.pathElement}))},this.onPostRowUnselect=function(e){for(var t=0;t<e.length;t++)e[t]._options&&e[t]._options.pathElement&&(u.remove({pathElement:e[t]._options.pathElement}),f.remove({pathElement:e[t]._options.pathElement}))},this.getCreationParams=function(){return new Promise(function(e){g.getCreationParams({type:"SIMItfSimulation",onComplete:function(t){e(t)},onFailure:function(){H.displayNotification({msg:C.isrCreateParamInfoRetrievalFailed,eventID:"error"}),e()}})})},this.setAllNlsType=function(e){E=e},this.areAllTabsDisabled=function(){if(D)return D.areAllTabsDisabled()}}})}),define("DS/PIMwebViewController/PIMwebRightSidePanelCmd",["DS/ENOPAD3DViewer/commands/PAD3DViewerRightSidePanel","DS/PADUtils/PADContext","DS/ENOPAD3DViewer/utils/PAD3DViewerModelServices","DS/Selection/CSOManager","DS/PIMwebViewController/PIMwebItfCtrl"],function(e,t,n,i,r){"use strict";return e.extend({init:function(e){var a,o,l,s=[],c=[],f=t.get(),u=r.getItfCtrl({pad3DViewer:f}),d={get:function(){var e,t=i.get();return t.length&&t.some(function(e){return n.isAModelPath(e.pathElement)})?t:s.length?(f&&f.getApplicativeData().getLoadedItfData&&(e=(e=f.getApplicativeData().getLoadedItfData())&&e.data),e||[]):[]},onPostAdd:function(e){return a=e,1},onPostRemove:function(e){return o=e,2},onEmpty:function(e){return l=e,3},unsubscribe:function(e){1===e?a=null:2===e?o=null:3===e&&(l=null)}};function h(e){1===e&&a?a():2===e&&o?o():3===e&&l&&l()}s.push(i.onPostAdd(h.bind(this,1))),s.push(i.onPostRemove(h.bind(this,2))),s.push(i.onEmpty(h.bind(this,3))),c.push(u.subscribe("onIsrAdded",h.bind(this,1))),c.push(u.subscribe("onItfAdded",h.bind(this,1))),c.push(u.subscribe("onIsrRemoved",h.bind(this,1))),this.getXSO=function(){return d},this.getID=function(e){return e&&e.isrID?e.isrID:Object.getPrototypeOf(this).getID.apply(this,arguments)},this.getRelationID=function(e){return e&&e.isrID?void 0:Object.getPrototypeOf(this).getRelationID.apply(this,arguments)},this.getType=function(e){return e&&e.isrID?e.type:Object.getPrototypeOf(this).getType.apply(this,arguments)},this.destroy=function(){h(3),s.forEach(i.unsubscribe,i),s=[],u&&c.forEach(u.unsubscribe,u),c=[],u=null,a=o=l=null,Object.getPrototypeOf(this).destroy.apply(this,arguments)},this._parent(e),h(1)},isNodeValid:function(e){var t=this._parent(e);return!t&&e&&e.isrID&&(t=!0),t},getServiceId:function(e){var t="";return e&&!e.isrID&&(t=this._parent(e)),t}})});