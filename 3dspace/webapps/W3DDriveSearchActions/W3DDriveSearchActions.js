define("DS/W3DDriveSearchActions/searchPropertiesView",["i18n!DS/W3DDriveSearchActions/assets/nls/W3DDriveSearchActions","css!DS/W3DDriveSearchActions/W3DDriveSearchActions.css"],function(e){"use strict";function t(e){if(!("string"==typeof e||e instanceof String))return"";var t={catanalysis:"CATAnalysis",catdrawing:"CATDrawing",catmaterial:"CATMaterial",catpart:"CATPart",catprocess:"CATProcess",catproduct:"CATProduct",catshape:"CATShape",catsystem:"CATSystem"};return t.hasOwnProperty(e.toLowerCase())?t[e.toLowerCase()]:e.toUpperCase()}return function(n){var i=function(n){function i(e){var t,n,i,r=" ",s=["B","KB","MB","GB","TB"];for(i=0;i<=s.length;i++)if(t=Math.pow(1e3,i),n=Math.pow(1e3,i+1),e>=t&&e<n||"0"===e){r+=s[i],t>0&&(e/=t);break}return Math.round(100*e)/100+r}var r,s=["ds6w:type","ds6w:label","ds6wg:filesize","ds6w:created","ds6w:modified","ds6w:responsible","ds6w:responsible/ds6w:originator"],o=[],a=s.length;for(r=0;r<a;r++){var c,l=s[r],u=n.get(l);if("ds6wg:filesize"===l&&Boolean(u)&&(u=i(u)),"ds6w:type"===l)if("document"===(u=n.get(l+"_value"))){var d=(c=n.get("ds6w:label")).lastIndexOf(".");u=d>=0?t(c.slice(d+1)):null}else u="DriveFile"===u?t(c=n.get("ds6w:docExtension")):e.folder;var D=e.get(l);u&&o.push({id:l,title:D,value:u})}return o}(n);return Object.assign(i)}}),define("DS/W3DDriveSearchActions/utils/services-manager",["UWA/Class/Promise","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices"],function(e,t){"use strict";return{_tenantId:null,_servicesCache:{},getServiceUrl:function(n,i){if(!n||!i)throw new Error("Missing input");const r=this;return new e((e,s)=>{i===r._tenantId&&r._servicesCache[n]?e(r._servicesCache[n]):r._tenantId&&r._tenantId===i&&r._servicesCache[n]?s():(i!==r._tenantId&&(r._tenantId=i,r._servicesCache={}),t.getServiceUrl({serviceName:n,platformId:i,onComplete:t=>{r._servicesCache[n]=t,e(t)},onFailure:s}))})}}}),define("DS/W3DDriveSearchActions/utils/request-helper",["DS/WAFData/WAFData"],function(e){"use strict";let t;return{performRequest:function(n,i){let r;const s=Object.assign({},i);s.type||(s.type="json"),s.headers=s.headers?s.headers:{},s.headers["X-DS-CSRFTOKEN"]=t||"",/content-type/gi.test(Object.keys(s.headers))||i.noContentType||(s.headers["Content-Type"]="application/json");const o=s.onComplete;let a;return s.onComplete=function(e,n,i){const r=Object.keys(n).filter(function(e){return-1!==e.search(/x-ds-csrftoken/i)});t=r.length>0?n[r[0]]:t,"function"==typeof o&&o(e,n,i)},s.onFailure&&(a=s.onFailure),s.onFailure=function(e,t){"function"==typeof a&&a({status:r.xhr.status,data:t,options:{xhr:r.xhr}})},r=e.authenticatedRequest(n,s)}}}),define("DS/W3DDriveSearchActions/3DDrivePreview",["UWA/Core","DS/SNInfraUX/SearchPreviewContainer","DS/W3DDriveSearchActions/searchPropertiesView","css!DS/W3DDriveSearchActions/W3DDriveSearchActions.css"],function(e,t,n){"use strict";return t.extend({_isFacetSupported:!0,init:function(e){this._parent(e)},getPrimaryContent:function(t){e.is(t)&&e.is(t.searchmodel)&&e.is(t.onFailure,"function")&&t.onFailure.call()},getSecondaryContent:function(t){if(e.is(t)&&e.is(t.searchmodel)&&e.is(t.onFailure,"function")){var i=n(t.searchmodel);t.onFailure.call(null,i)}},isFacetSupported:function(){return this._isFacetSupported}})}),define("DS/W3DDriveSearchActions/3DDrive",["UWA/Core","UWA/Class","UWA/Class/Debug","UWA/String","DS/W3DDriveSearchActions/utils/services-manager","DS/W3DDriveSearchActions/utils/request-helper","DS/3DPlaySupport/AssetSupport","DS/W3DDriveSearchActions/3DDrivePreview","i18n!DS/W3DDriveSearchActions/assets/nls/W3DDriveSearchActions"],function(e,t,n,i,r,s,o,a,c){"use strict";return t.singleton(n,{_3DDriveDefaultPreview:null,init:function(){this._3DDriveDefaultPreview=null},_viewIn3DDrive:function(e,t,n,i){let s="_top";"3DDashboard"!==n&&(s="_blank"),r.getServiceUrl("3DDashboard",t).then(n=>{!function(n,r){n+="/#app:X3DDRIV_AP/content:";var s="granted-"+t+"=true",o=i.indexOf("Folder")>-1?"/content":"/preview",a="saved-fragment="+encodeURIComponent("drives/"+t+"/mimetype/text%2Fdirectory/inode/"+e+o);window.open(n+s+"&firstlyLoading=false&"+a,r)}(n,s)})},_downloadFrom3DDrive:function(e,t,n,o){r.getServiceUrl("3DDrive",t).then(r=>{if(r){const a=i.format("{0}/resources/3ddrive/v1/bos/{1}/download/?tenant={2}",r,e,t);s.performRequest(a,{onComplete:function(e){e&&require(["DS/W3DDrive/Actions/download"],function(t){t(e.url,"POST")})},onFailure:function(e){if(404===e.status)return o({message:c.replace(c.get("emptyDownload"),{name:n}),className:"warning",autoHide:!0});throw new Error("Download failed.")}})}})},getActionsPath:function(t){if(e.is(t)&&e.is(t.platformID))return"/resources/3ddrive/v1/actions?tenant="+t.platformID;throw new Error("INVALID inputs for getActionsPath, platformID is missing")},is3DPlayAvailable:function(t){if(e.is(t)&&e.is(t.onComplete,"function")){var n=t.model;if(e.is(n))"DriveFile"===n.get("ds6w:type_value")&&function(e){var t={provider:"FILE",physicalid:e.model.id,filename:e.model.get("ds6w:label"),format:e.model.get("ds6w:docExtension"),type:e.model.get("ds6w:docExtension")},n=!1;return o.checkSupport(t,{usage:"preview"},function(e){n=e}),n}(t)?t.onComplete({availability:!0}):t.onComplete({availability:!1})}},get3DPlayOptions:function(t){if(e.is(t)&&e.is(t.onComplete,"function")&&e.is(t.onFailure,"function")){var n=t.model,i=t.defaultPlayOptions;e.is(n)&&e.is(i)&&e.is(t.serviceURL,"string")&&e.is(i.input)&&e.is(i.input.asset)&&(i.input.asset=e.merge({provider:"3DDRIVE",physicalid:n.id,dtype:n.get("ds6w:type_value"),tenant:n.getPlatformID()},i.input.asset),t.onComplete.call(this,i,null,t))}},executeAction:function(e){var t=e.action_id,n=e.object_ids[0],i=e.actionsHelper.getPlatformID({id:n}),r=e.actionsHelper.getClientInfo().identifier,s=e.actionsHelper.getValue({id:n,attribute:"ds6w:type"}),o=e.actionsHelper.getValue({id:n,attribute:"ds6w:label"}),a=e.actionsHelper.displayAlert;switch(t){case"download":this._downloadFrom3DDrive(n,i,o,a);break;case"view":this._viewIn3DDrive(n,i,r,s);break;default:throw new Error("Action id ["+t+"] is not supported")}},getRenderPreview:function(t){if(e.is(t)&&e.is(t.searchmodel)){var n=this;null===n._3DDriveDefaultPreview?function(e){n._3DDriveDefaultPreview=new a,e.onComplete.call(void 0,n._3DDriveDefaultPreview)}(t):t.onComplete.call(void 0,n._3DDriveDefaultPreview)}},getFacets:function(t){if(e.is(t)&&e.is(t.model)&&e.is(t.constants)&&e.is(t.setFacets,"function")&&e.is(t.addFacets,"function")){var n=[t.constants.FACET_PROPERTIES],i=[{name:t.constants.FACET_PROPERTIES,text:c.properties,icon:"attributes",expandedFlag:!0}];if(t.setFacets.call(void 0,n,i),this._3DDriveDefaultPreview&&!0===this._3DDriveDefaultPreview.isFacetSupported()){var r=t.model.getType();if("DriveFile"===r||"DriveFolder"===r){var s={require:"DS/W3DDriveSearchActions/sharedFacet",facet:{name:"sharedwith",text:c.sharedWith,icon:"users",expandedFlag:!0,height:"130px"}};t.addFacets([s])}}}},getDoubleClickAction:function(t){if(e.is(t,"object")&&e.is(t.model)&&e.is(t.appID)&&"X3DSEAR_AP"===t.appID){var n=t.model.getType();"document"===n||"folder"===n?t.onFailure.call(void 0,"no action available for double click on object of type "+n):t.onComplete.call(void 0,{id:"view",sourceJS:"DS/W3DDriveSearchActions/3DDrive"})}},getSubjectURI:function(e){(e=e||{}).subjects=e.subjects||[];var t={};return e.subjects.forEach(function(e){e.id&&(t[e.id]="driveid:"+e.id)}),t},getTaggerService:function(e){return"6WTagger"}})}),define("DS/W3DDriveSearchActions/searchSharedView",["UWA/Core","UWA/String","DS/WAFData/WAFData","DS/W3DDriveSearchActions/utils/services-manager","i18n!DS/W3DDriveSearchActions/assets/nls/W3DDriveSearchActions","css!DS/W3DDriveSearchActions/W3DDriveSearchActions.css","css!DS/UIKIT/UIKIT.css"],function(e,t,n,i,r){"use strict";function s(t){const n=document.createElement("div");n.classList.add("search-detail__card__block");const i=function(t){return t.image?new e.Element("img",{class:"img-circle search-detail__card__block__img",src:t.image}):t.icon?new e.Element("div",{class:t.icon+" search-detail__card__block__icon",tag:"span"}):null}(t);return n.appendChild(i),n}function o(t){if(0===t.length)return function(){const t=document.createElement("div");return t.classList.add("search-detail__share__info"),t.appendChild(new e.Element("p",{class:"fonticon fonticon-lock search-detail__share__info__icon"})),t.appendChild(new e.Element("p",{text:r.notShared})),t}();const n=document.createElement("div");n.classList.add("search-detail__card");return function(e,t){let i=0;for(let r=0;r<e.length;++r)if(n.appendChild(s(e[r])),++i>=t)return}(t,5),n}return function(e){const r=document.createElement("div");return function(e){const r=document.createElement("div"),s=e.id,a=e.tenant,c=i.getServiceUrl("3DDrive",a).then(function(e){return Promise.resolve(e)}),l=i.getServiceUrl("3DSwym",a).then(function(e){return Promise.resolve(e)});return Promise.all([c,l]).then(function(e){const i=e[0],c=e[1];return new Promise(function(e,r){if(i){const o=t.format("{0}/resources/3ddrive/v1/bos/{1}/allaccesses?tenant={2}",i,s,a);n.authenticatedRequest(o,{method:"GET",type:"json",onComplete:function(t){let n=[];const i=[];(n=t.items).forEach(function(e){const t={};"Person"===e.type?t.image=function(e,t){return e+"/api/user/getpicture/login/"+t+"/format/normal"}(c,e.id):"Group"===e.type&&(t.icon="fonticon fonticon-users-group"),i.push(t)}),e(i)},onFailure:r})}}).then(function(e){return r.appendChild(o(e)),r})})}(e).then(function(e){r.appendChild(e)}),r}}),define("DS/W3DDriveSearchActions/sharedFacet",["UWA/Core","UWA/Controls/Abstract","UWA/Class","DS/EditPropWidget/facets/Common/FacetsBase","DS/UIKIT/Scroller","DS/W3DDriveSearchActions/searchSharedView","css!DS/W3DDriveSearchActions/W3DDriveSearchActions.css"],function(e,t,n,i,r,s){"use strict";return n.extend(t,i,{init:function(e){this._parent(e),this._initUI()},_initUI:function(){this.elements.container=e.createElement("div"),this.elements.contentScroll=e.createElement("div"),this.elements.scroller=new r({element:this.elements.contentScroll}).inject(this.elements.container)},updateFacet:function(){this.elements.contentScroll.empty();var e=this.getModel();if(e){var t={id:e.get("objectId"),tenant:e.get("tenant")};this.elements.contentScroll.appendChild(s(t))}},destroyComponent:function(){},onResize:function(){},onRefresh:function(){this.updateFacet()}})});