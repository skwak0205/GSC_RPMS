define("DS/FolderUpload/FolderTree",["UWA/Core","UWA/Class","DS/TreeModel/TreeNodeModel"],function(e,t,o){"use strict";var i=new RegExp("["+["/",'"',"#","$","@","%","*",",","?","\\\\","<",">","[","\\]","|",":","'",";"].join("")+"]","g");return t.extend({title:void 0,folders:[],files:[],id:void 0,parentId:null,path:void 0,isPassthrough:!1,status:void 0,cancelled:!1,init:function(t,o){this.title=t,this.folders=[],this.id="Folder$%Upload_"+performance.now(),this.parentId=null,this.files=[],this.error="",this.doQuery=!0,o&&(this.path=o),this.promise=e.Promise.deferred()},getTitle:function(){return this.title},getName:function(){return this.title.replace(i,"_")},getFolders:function(){return this.folders},getFolder:function(e){return this.folders.filter(function(t){return t.title==e}).length>1?void 0:this.folders.filter(function(t){return t.title==e})[0]},hasFolders:function(){return this.folders.length>0},doesNotHaveThisFolderYet:function(e){return 0==this.folders.filter(function(t){return t.getName()==e}).length},addFolder:function(e){this.folders.push(e),e.parent=this},getId:function(e){return e?this.id:this.id.startsWith("Folder$%Upload_")?void 0:this.id},setId:function(e){this.id=e},getFiles:function(){return this.files},hasFiles:function(){return this.files.length>0},addFile:function(t){return t.promise=e.Promise.deferred(),t.cancelled=!1,t.setCancelled=function(){t.cancelled=!0},t.isCancelled=function(){return t.cancelled},t.markFail=function(e,o){t.status=!1,t.promise.reject({action:e,path:t.displayPath,success:!1,reason:o})},t.markSuccess=function(){t.status=!0,t.promise.resolve({action:"uploaded",path:t.displayPath,success:!0})},this.files.push(t),t},getParentId:function(){return this.parentId},setParentId:function(e){this.parentId=e},markFail:function(e){null==this.status&&(this.status=!1,this.promise.reject({action:"created",path:this.path,success:!1,reason:e})),this.files.forEach(t=>{t.markFail("uploaded",e)}),this.folders.forEach(t=>{t.markFail(e)})},markSuccess:function(e){console.log(e+" "+this.title),this.status=!0,this.promise.resolve({action:e,path:this.path,success:!0})},setError:function(e){this.error=e},setCreated:function(){this.doQuery=!1},getDoQuery:function(){return this.doQuery},getStatus:function(){return this.status},SetAsPassthrough:function(){this.isPassthrough=!0},IsPassthrough:function(){return this.isPassthrough},sort:function(){this.files.sort(function(e,t){return e.name<t.name?-1:e.name>t.name?1:0}),this.folders.sort(function(e,t){return e.title<t.title?-1:e.title>t.title?1:0}),this.folders.forEach(e=>{e.sort()})},getReportNodes:function(){if(this.isPassthrough){var e=[];return this.folders.forEach(t=>{t.getReportNodes().forEach(t=>{e.push(t)})}),this.files.forEach(t=>{e.push(new o({label:t.name,grid:{success:t.status},icons:[{iconName:"doc"}]}))}),e}var t=new o({label:this.title,grid:{success:this.status,error:this.error},icons:[{iconName:"folder"}]});return this.folders.forEach(e=>{e.getReportNodes().forEach(e=>{t.addChild(e)})}),this.files.forEach(e=>{t.addChild(new o({label:e.name,grid:{success:e.status},icons:[{iconName:"doc"}]}))}),[t]},setCancelled:function(){this.cancelled=!0},isCancelled:function(){return this.cancelled}})}),define("DS/FolderUpload/FolderUpload",["UWA/Core","DS/FolderUpload/FolderTree","DS/WAFData/WAFData","DS/DocumentManagement/DocumentManagement","DS/UIKIT/SuperModal","DS/DocumentCommands/Helper","DS/CoreEvents/ModelEvents","DS/DataGridView/DataGridView","DS/TreeModel/TreeDocument","DS/Windows/ImmersiveFrame","DS/TreeModel/TreeNodeModel","text!DS/FolderUpload/assets/config.json","i18n!DS/FolderUpload/assets/nls/FolderUpload","css!DS/FolderUpload/FolderUpload.css"],function(e,t,o,i,n,a,r,l,s,d,c,p,u,f){"use strict";function h(){return 0!=Object.keys(window.folderUploadOperations).length}p=JSON.parse(p),window.folderUploadOperations=window.folderUploadOperations||{};var m={},g=e.Class.extend({options:void 0,events:void 0,operations:void 0,init:function(e){this.validateEnvironment(e),this.options=e,this.events=e.events||new r,this.operations=window.folderUploadOperations,widget&&widget.app&&widget.app.jobs&&"doco-jobs"==widget.app.jobs.name&&widget.app.progressPane&&"doco-progress"==widget.app.progressPane.name?(m=widget.app).jobs.MAX_PARALLEL_JOBS=1:(null==m.jobs&&require(["DS/DocumentCommands/Jobs"],function(e){null==m.jobs&&(m.jobs=new e(m),m.jobs.MAX_PARALLEL_JOBS=1)}),null==m.progressPane&&require(["DS/DocumentCommands/ProgressPane"],function(e){null==m.progressPane&&(m.progressPane=new e(m),m.progressPane.inject(widget.body))}))},getLatestCSRF:function(){var t=this;return new e.Promise(function(e,i){o.authenticatedRequest(t.options.platformUrls["3DSpace"]+"/resources/v1/application/E6WFoundation/CSRF",{method:"GET",onComplete:function(o){t.csrf=JSON.parse(o).csrf,e(t.csrf)}})})},removeOperation:function(e){delete this.operations[e.id]},isOperationWithinTheLimits:function(t){var o=this;if(!t.destinationId&&t.rootFolder.files.length>0){var i=new n({renderTo:widget.body,className:"folder-upload-report-modal single-line-message",events:{onHide:function(){h()||o.events.publish({event:"enable-folder-upload-command-in-ui"})}}}),r=e.createElement("span",{class:"msg",text:u.get("FilesCannotBeDroppedHere")}),f=e.createElement("div",{class:"folder-upload-report"}),m=e.createElement("div",{class:"report-numbers"}).inject(f);e.createElement("span",{class:"fonticon fonticon-2x fonticon-alert text-error"}).inject(m);return r.inject(m),o.events.publish({event:"disable-folder-upload-command-in-ui"}),i.dialog({title:u.get("OperationNotSupported"),body:f,buttons:[{className:"primary",value:u.get("OK"),action:function(e){e.hide()}}]}),!1}if(t.folders.length>p.maxFolderCount||t.files.length>p.maxFileCount||t.totalFileSize>p.maxTotalFileSize){i=new n({renderTo:widget.body,className:"folder-upload-report-modal single-line-message",events:{onHide:function(){h()||o.events.publish({event:"enable-folder-upload-command-in-ui"})}}}),r=e.createElement("span",{class:"msg",text:u.get("SelectedDataAboveLimits")});var g=new s;g.withTransactionUpdate(function(){g.addRoot(new c({label:u.get("NoOfFolders"),grid:{current:t.folders.length,max:p.maxFolderCount,withinLimits:t.folders.length<=p.maxFolderCount}})),g.addRoot(new c({label:u.get("NoOfFiles"),grid:{current:t.files.length,max:p.maxFileCount,withinLimits:t.files.length<=p.maxFileCount}})),g.addRoot(new c({label:u.get("TotalSizeOfFiles"),grid:{current:a.formatBytes(t.totalFileSize,2),max:a.formatBytes(p.maxTotalFileSize,2),withinLimits:t.totalFileSize<=p.maxTotalFileSize}}))}),g.expandAll();var F=[{text:u.get("Limit"),dataIndex:"tree",editableFlag:!1,width:"auto"},{text:u.get("Current"),dataIndex:"current",editableFlag:!1,width:"80",visibleFlag:!0},{text:u.get("Max"),dataIndex:"max",editableFlag:!1,width:"80",visibleFlag:!0},{text:u.get("WithinLimits"),dataIndex:"withinLimits",typeRepresentation:"boolean",editableFlag:!1,className:"coloured-boolean",width:"80",pinned:"right"}],v=new l({class:"report-grid",treeDocument:g,columns:F});v.showSelectionCheckBoxesFlag=!1,v.showRowIndexFlag=!1;var b=new d;b.setContentInBackgroundLayer(v.getContent()),b.reactToPointerEventsFlag=!1;f=e.createElement("div",{class:"folder-upload-report"}),m=e.createElement("div",{class:"report-limits"}).inject(f);r.inject(m);var x=e.createElement("div",{class:"report-grid-container",styles:{"max-height":widget.body.clientHeight-374.5+"px",height:5+v.layout.columnHeaderHeight+3*v.layout.cellHeight+"px","min-height":v.layout.columnHeaderHeight+2*v.layout.cellHeight+"px"}}).inject(f);return b.inject(x),o.events.publish({event:"disable-folder-upload-command-in-ui"}),i.dialog({title:u.get("LimitsCrossed"),body:f,buttons:[{className:"primary",value:u.get("OK"),action:function(e){e.hide()}}]}),!1}return!0},confirmStartOfBulkUpload:function(t){var o=this;if(o.isOperationWithinTheLimits(t)){var i=new n({renderTo:widget.body,events:{onHide:function(){h()||o.events.publish({event:"enable-folder-upload-command-in-ui"})}}}),r=e.createElement("span");e.createElement("p",{text:u.get("NumberOfFoldersToBeUploaded",{count:t.folders.length})}).inject(r),e.createElement("p",{text:u.get("NumberOfFilesToBeUploaded",{count:t.files.length-t.skippedFiles.length})}).inject(r),e.createElement("p",{text:u.get("DataToUpload",{totalFileSize:a.formatBytes(t.totalFileSize,2)})}).inject(r),e.createElement("p",{text:u.get("Destination",{title:t.destinationName})}).inject(r);var c=e.createElement("p").inject(r);e.createElement("span",{text:u.get("CollaborativeSpace")}).inject(c),e.createElement("b",{text:o.options.fetchCollabSpaceDisplayName()}).inject(c),t.replacedFolderNames>0&&e.createElement("p",{text:u.get("NumberOfNormalizedFolderNames",{count:t.replacedFolderNames})}).inject(r),t.skippedFiles.length>0&&(e.createElement("p",{text:u.get("NumberOfFilesToBeSkipped",{count:t.skippedFiles.length,maxFileSize:a.formatBytes(p.maxFileSize,2)})}).inject(r),e.createElement("p",{text:u.get("SkippedFiles")}).inject(r),e.createElement("p",{styles:{"white-space":"pre",overflow:"auto","max-height":"200px"},text:"\n\t"+t.skippedFiles.join("\n\t")}).inject(r)),o.events.publish({event:"disable-folder-upload-command-in-ui"}),i.dialog({title:u.get("StartBulkUploadProcess"),body:r,buttons:[{className:"primary",value:u.get("Yes"),action:function(i){o.operations[t.id]=t,i.hide(),o.i=0,console.time(t.id),t.onBeforeUnload=function(e){e.preventDefault(),e.returnValue=u.get("FolderUploadOperationInProgressDataLossChance")},window.addEventListener("beforeunload",t.onBeforeUnload);var a=setInterval(function(){o.getLatestCSRF()},8e5);o.createAndUploadFolder(t.rootFolder),m.progressPane.addPendingSize(t.totalFileSize),e.Promise.allSettled(t.promises).then(function(i){clearInterval(a),window.removeEventListener("beforeunload",t.onBeforeUnload),t.fileInput&&t.fileInput.destroy(),o.removeOperation(t),console.timeEnd(t.id),o.events.publish({event:"operation-complete",data:{parentId:t.destinationId}});var r=0,c=0,p=0,f=0,m=0,g=0,F=0,v=0;i.forEach(e=>{if("fullfilled"==e.state)switch(r++,e.value.action){case"created":f++;break;case"uploaded":p++;break;case"exists":m++;break;default:throw console.error(e),"Shouldnt have come here "}else switch(c++,e.reason.action){case"created":F++;break;case"uploaded":g++;break;case"skipped":v++;break;default:throw console.error(e),"Shouldnt have come here "}});var b=new n({renderTo:widget.body,className:"folder-upload-report-modal",events:{onHide:function(){h()||o.events.publish({event:"enable-folder-upload-command-in-ui"})}}}),x="",w=e.createElement("span",{class:"msg"}),S="";c>0&&0==r?(x=u.get("FolderUploadFail"),S="alert text-error"):0==c&&r>0?(x=u.get("FolderUploadSuccess"),S="info text-primary"):c>0&&r>0&&(x=u.get("FolderUploadPartial"),S="attention text-warning"),1==f?e.createElement("p",{text:u.get("Created1Folder")}).inject(w):f>1&&e.createElement("p",{text:u.get("CreatedXFolders",{count:f})}).inject(w),1==p?e.createElement("p",{text:u.get("Uploaded1File")}).inject(w):p>1&&e.createElement("p",{text:u.get("UploadedXFiles",{count:p})}).inject(w),1==m?e.createElement("p",{text:u.get("1FolderAlreadyExisted")}).inject(w):m>1&&e.createElement("p",{text:u.get("XFoldersAlreadyExisted",{count:m})}).inject(w),1==F?e.createElement("p",{text:u.get("FailedToCreate1Folder")}).inject(w):F>1&&e.createElement("p",{text:u.get("FailedToCreateXFolders",{count:F})}).inject(w),1==g?e.createElement("p",{text:u.get("FailedToUpload1File")}).inject(w):g>1&&e.createElement("p",{text:u.get("FailedToUploadXFiles",{count:g})}).inject(w),1==v?e.createElement("p",{text:u.get("1FileSkipped")}).inject(w):v>1&&e.createElement("p",{text:u.get("XFilesSkipped",{count:v})}).inject(w);var y=new s;y.withTransactionUpdate(function(){t.rootFolder.getReportNodes().forEach(function(e){y.addRoot(e)})}),y.expandAll();var E=[{text:u.get("FolderOrFileName"),dataIndex:"tree",editableFlag:!1,width:"auto"},{text:u.get("Success"),dataIndex:"success",typeRepresentation:"boolean",editableFlag:!1,className:"coloured-boolean",width:"80",pinned:"right"},{text:u.get("Error"),dataIndex:"error",editableFlag:!1,width:"80",pinned:"right",visibleFlag:!1}],j=new l({class:"report-grid",treeDocument:y,columns:E});j.showSelectionCheckBoxesFlag=!1,j.showRowIndexFlag=!1;var C=new d;if(C.setContentInBackgroundLayer(j.getContent()),C.reactToPointerEventsFlag=!1,""!=S){var k=e.createElement("div",{class:"folder-upload-report"}),I=e.createElement("div",{class:"report-numbers"}).inject(k);e.createElement("span",{class:"fonticon fonticon-2x fonticon-"+S}).inject(I);w.inject(I);var T=e.createElement("div",{class:"report-grid-container",styles:{"max-height":widget.body.clientHeight-374.5+"px",height:5+j.layout.columnHeaderHeight+t.promises.length*j.layout.cellHeight+"px","min-height":j.layout.columnHeaderHeight+2*j.layout.cellHeight+"px"}}).inject(k);C.inject(T),b.dialog({title:x,body:k,buttons:[{className:"primary",value:u.get("OK"),action:function(e){e.hide()}}]})}}).catch(function(e){console.error(e)})}},{className:"default",value:u.get("No"),action:function(e){e.hide()}}]}),t.rootFolder.sort()}},showOnlyOneOperationAtATimeAlert:function(){return!h()||(new n({renderTo:widget.body,className:"folder-upload-report-modal single-line-message"}).alert(u.get("PleaseWaitForAnExistingUploadOperationToFinish"),u.get("AnotherUploadOperationAlreadyRunning")),!1)},openFolderPicker:function(t,o){var i=this;if(i.showOnlyOneOperationAtATimeAlert()){var n=e.createElement("input",{attributes:{type:"file",directory:!0,webkitdirectory:!0},styles:{display:"none"},events:{change:function(e){i.folderPickerHandler(t,o,e.target.files,n)}}});n.inject(document.body),n.click()}},folderPickerHandler:function(e,o,i,n){var a=i[0].webkitRelativePath.split("/")[0],r=new t(a,a),l=this.prepareFolderTreeFromFolderPicker(i,r,e,o);a!=r.getName()&&l.replacedFolderNames++,console.log("TreePrepared:"),console.log(r),l.destinationName=o,l.destinationId=e,l.fileInput=n,this.confirmStartOfBulkUpload(l)},prepareFolderTreeFromFolderPicker:function(e,o,i,n){o.operationId=(new Date).getTime(),window.operations=this.operations;var a={id:o.operationId,rootFolder:new t(void 0,void 0),folders:[o.getTitle()],files:[],skippedFiles:[],promises:[o.promise.promise],totalFileSize:0,replacedFolderNames:0};for(var r of(a.rootFolder.SetAsPassthrough(),a.rootFolder.operationId=o.operationId,a.rootFolder.addFolder(o),i&&(a.rootFolder.setId(i),a.rootFolder.title=n),e)){var l=o,s=r.webkitRelativePath.split("/");s.shift();for(var d=o.getTitle()+"/",c=0;c<s.length;c++)if(d+=s[c]+"/",c===s.length-1)r.displayPath=r.webkitRelativePath,l.addFile(r),a.files.push(r.webkitRelativePath),a.promises.push(r.promise.promise),r.size>p.maxFileSize?(r.skip=!0,a.skippedFiles.push(r.displayPath)):a.totalFileSize+=r.size;else if(l.doesNotHaveThisFolderYet(s[c])){var u=new t(s[c],d);u.getName()!=u.getTitle()&&a.replacedFolderNames++,u.operationId=o.operationId,a.folders.push(d),a.promises.push(u.promise.promise),l.addFolder(u),l=u}else l=l.getFolder(s[c])}return console.log(a),a},handleDnD:function(o,i,n){var a=this;if(a.showOnlyOneOperationAtATimeAlert()){var r=i.items,l=new t(void 0,void 0);l.SetAsPassthrough(),l.operationId=(new Date).getTime(),window.operations=a.operations;var s={id:l.operationId,rootFolder:l,folders:[],files:[],skippedFiles:[],promises:[],filesystemPromises:[],ongoingTraversals:0,totalFileSize:0,destinationName:n,destinationId:o,replacedFolderNames:0};for(let e=0;e<r.length;e++){let t=r[e].webkitGetAsEntry();t&&a.prepareFolderTreeFromDnDItem(t,"",s,l)}var d=function(){e.Promise.allSettled(s.filesystemPromises).then(function(e){console.log(s.ongoingTraversals),0==s.ongoingTraversals?(o&&(s.rootFolder.setId(o),s.rootFolder.title=n),a.confirmStartOfBulkUpload(s)):d()}).catch(function(e){console.error(e)})};d(),console.log(s)}},prepareFolderTreeFromDnDItem:function(o,i,n,a){var r=this;if(o.isDirectory){i+=o.name+"/";var l=new t(o.name,i);l.getName()!=l.getTitle()&&n.replacedFolderNames++,l.operationId=a.operationId,n.folders.push(i),n.promises.push(l.promise.promise),a.addFolder(l);let c=o.createReader();var s=e.Promise.deferred();n.filesystemPromises.push(s.promise);var d=function(){n.ongoingTraversals++,c.readEntries(function(e){e.forEach(function(e){r.prepareFolderTreeFromDnDItem(e,i,n,l)}),0!=e.length?d():s.resolve(),n.ongoingTraversals--})};d()}else{var c=e.Promise.deferred();n.filesystemPromises.push(c.promise),n.ongoingTraversals++,o.file(function(e){e.displayPath=i+e.name,a.addFile(e),n.files.push(e.displayPath),n.promises.push(e.promise.promise),e.size>p.maxFileSize?(e.skip=!0,n.skippedFiles.push(e.displayPath)):n.totalFileSize+=e.size,c.resolve(),n.ongoingTraversals--})}},createAndUploadFolder:function(e){var t=this;void 0!==e.getId()||e.IsPassthrough()?(t.uploadFilesAndSubFolders(e),e.markSuccess("exists")):(t.createFolderOnServer(e),e.promise.promise.then(function(o){t.uploadFilesAndSubFolders(e)},function(e){console.log(e)}))},uploadFilesAndSubFolders:function(e){var t=this,i=e.getId();if(!e.isCancelled()){t.uploadFilesToServer(e);var n=e.getTitle(),a=i;if(e.getDoQuery()){if(e.getFolders().length>0)if(a){var r={method:"GET",type:"json",url:t.options.platformUrls["3DSpace"]+"/resources/v1/modeler/workspaces/"+a+"?$include=all,folders",headers:{Accept:"application/json","Accept-Language":widget.lang,"Content-Type":"application/json",SecurityContext:t.options.fetchSecurityContext()},onComplete:function(o){if(m.jobs.finishJob(l),o.success)for(var i of e.getFolders()){for(var r of(i.setParentId(a),o.data[0].relateddata.folders))i.getName()==r.dataelements.name&&(i.setId(r.id),console.log("matched "+i.getTitle()+" while "+n));t.createAndUploadFolder(i)}else m.jobs.finishJob(l,"failed"),e.markFail()},onFailure:function(t,o){o&&o.error&&e.setError(o.error),m.jobs.finishJob(l,"failed"),e.markFail()},onCancel:function(t){m.jobs.finishJob(l,"cancelled"),e.markFail("cancelled")}},l={title:u.get("PROCESSING_X",{title:n}),tooltip:e.path,ui:!0,process:function(){l.xhr=o.authenticatedRequest(r.url,r)},cancel:function(){e.setCancelled(),console.log("cancel start:"+n),l.xhr&&l.xhr.cancel?l.xhr.cancel():(m.jobs.finishJob(l,"cancelled"),e.markFail("cancelled"))}};m.jobs.addJob(l)}else for(let i of e.getFolders()){i.setParentId(a);let e={title:u.get("PROCESSING_X",{title:i.getTitle()}),tooltip:i.path,ui:!0,process:function(){var n=i.getName(),a={method:"GET",type:"json",url:t.options.platformUrls["3DSpace"]+"/resources/v3/e6w/service/ObjectSearchByName?typeStr=Workspace&searchStr="+encodeURIComponent(n),headers:{Accept:"application/json","Accept-Language":widget.lang,"Content-Type":"application/json",SecurityContext:t.options.fetchSecurityContext()},onComplete:function(o){if(i.isCancelled())return m.jobs.finishJob(e,"cancelled"),void i.markFail("cancelled");if(m.jobs.finishJob(e),o.success){for(var a of o.data)if(a.name==n){i.setId(a.id),console.log("Folder Already Exists:"+n+":"+a.id);break}t.createAndUploadFolder(i)}else i.markFail()},onFailure:function(t,o){o&&o.error&&i.setError(o.error),m.jobs.finishJob(e,"failed"),i.markFail()},onCancel:function(t){m.jobs.finishJob(e,"cancelled"),i.markFail("cancelled")}};e.xhr=o.authenticatedRequest(a.url,a)},cancel:function(){i.setCancelled(),console.log("cancel start:"+e),e.xhr&&e.xhr.cancel?e.xhr.cancel():(m.jobs.finishJob(e,"cancelled"),i.markFail("cancelled"))}};m.jobs.addJob(e)}}else for(var s of e.getFolders())s.setParentId(a),t.createAndUploadFolder(s)}},createFolderOnServer:function(e){var t=this,i=e.getParentId(),n=e.getTitle(),a=e.getName(),r={title:u.get("CREATING_X",{title:a}),tooltip:e.path,ui:!0,process:function(){if(e.isCancelled())return m.jobs.finishJob(r,"cancelled"),void e.markFail("cancelled");t.getLatestCSRF().then(function(l){if(e.isCancelled())return m.jobs.finishJob(r,"cancelled"),void e.markFail("cancelled");var s={};s=i?{id:i,updateAction:"NONE",type:"Workspace",relateddata:{folders:[{id:e.getId(!0),updateAction:"CREATE",type:"Workspace Vault",dataelements:{name:a,title:n,folderClassification:"Bookmark",state:"Create"}}]}}:{id:e.getId(!0),updateAction:"CREATE",type:"Workspace",dataelements:{name:a,title:n,folderClassification:"Bookmark",state:"Create"}};var d={method:"POST",timeout:288e5,type:"json",url:t.options.platformUrls["3DSpace"]+"/resources/v1/modeler/workspaces",headers:{Accept:"application/json","Accept-Language":widget.lang,"Content-Type":"application/json",SecurityContext:t.options.fetchSecurityContext()},data:JSON.stringify({csrf:t.csrf,data:[s]}),onComplete:function(o){m.jobs.finishJob(r),i?e.setId(o.data[0].relateddata.folders[0].id):e.setId(o.data[0].id),e.markSuccess("created"),e.setCreated(!0),t.events.publish({event:"folder-created",data:{id:e.getId(),parentId:i}})},onFailure:function(t,o){o&&o.error&&e.setError(o.error),m.jobs.finishJob(r,"failed"),e.markFail()}};r.xhr=o.authenticatedRequest(d.url,d)})},cancel:function(){e.setCancelled(),console.log("cancel start:"+r),r.xhr&&r.xhr.cancel?r.xhr.cancel():(m.jobs.finishJob(r,"cancelled"),e.markFail("cancelled"))}};console.log("queue create "+a),m.jobs.addJob(r)},uploadFilesToServer:function(e){var t=this,o=e.getId();e.getFiles().forEach(e=>{if(e.skip)e.markFail("skipped");else{var n=e.name;n.includes(".")&&(n=n.substring(0,n.lastIndexOf(".")));var a={title:n,fileInfo:{file:e},relInfo:{parentId:o,parentRelName:"Vaulted Objects",parentDirection:"from"}},r={tenant:t.options.tenantId,securityContext:t.options.fetchSecurityContext(),tenantUrl:t.options.platformUrls["3DSpace"],additionalURLParams:"delayThumbnailGeneration=1",onFailure:function(t){m.jobs.finishJob(l,"failed"),e.markFail("uploaded")},onProgress:function(e){l.update(e)},onComplete:function(i){i.data;m.jobs.finishJob(l),m.addDocumentsToList&&m.addDocumentsToList(i.data),e.markSuccess(),console.log("uploaded "+e.displayPath),t.events.publish({event:"document-uploaded",data:{id:i.data[0].id,parentId:o}})},onCancel:function(t){console.log(l),console.log("got cancelled"),m.jobs.finishJob(l,"cancelled"),e.markFail("uploaded","cancelled")}},l={title:u.get("UPLOADING_X",{title:a.fileInfo.file.name}),tooltip:a.fileInfo.file.displayPath,ui:!!a.fileInfo,process:function(){e.isCancelled()?(m.jobs.finishJob(l,"cancelled"),e.markFail("uploaded","cancelled")):(console.log("startupload "+e.displayPath),l.xhr=i.createDocument(a,r))},cancel:function(){e.setCancelled(),console.log("cancel start file:"+l),l.xhr&&l.xhr.cancel?l.xhr.cancel():(m.jobs.finishJob(l,"cancelled"),e.markFail("uploaded","cancelled"))},size:a.fileInfo.file.size};console.log("queueupload "+e.displayPath),m.jobs.addJob(l)}})},validateEnvironment:function(e){if(e.platformUrls.platformId.toLowerCase()==="OnPremise".toLowerCase())throw new Error("Error: Folder Upload is only supported on Cloud")}});return g.IsAnOperationOngoing=h,g});