define("DS/WAfrUndoRedoUI/Private_UndoStep",["DS/Core/Events","DS/CoreUtilities/ErrorManagement"],function(e,t){"use strict";var n=0,i=t.getErrorManager();function r(t){if(void 0===t)throw new Error("publishUndoExecuted expect an undo step as input");e.publish({event:"UNDO_"+t.getId()+"/EXECUTED",data:t})}function o(t){if(void 0===t)throw new Error("publishRedoExecuted expect an undo step as input");e.publish({event:"REDO_"+t.getId()+"/EXECUTED",data:t})}var d=function(e){if(void 0===e||void 0===e.undoTitle||"string"!=typeof e.undoTitle)throw new Error("PrivateUndoStep constructor : expects an object parameters as an input with a property named undoTitle {string} on it.");if(void 0!==e.undoAction&&"function"!=typeof e.undoAction)throw new Error("PrivateUndoStep constructor : parameters.undoAction if specified must be a function.");if(void 0===e.undoAction&&void 0!==e.undoData)throw new Error("PrivateUndoStep constructor : parameters.undoData specified but parameters.undoAction undefined.");if(void 0!==e.doAction&&"function"!=typeof e.doAction)throw new Error("PrivateUndoStep constructor : parameters.doAction if specified must be a function.");if(void 0===e.doAction&&void 0!==e.doData)throw new Error("PrivateUndoStep constructor : parameters.doData specified but parameters.doAction undefined.");this._private=Object.create(null),this._private._id=n++,this._private._undoTitle=e.undoTitle,this._private._exclusivity=!1,this._private._redoEnabled=!0,this._private._undoAction=void 0,this._private._undoData=void 0,this._private._doAction=void 0,this._private._doData=void 0,this._private._serverUndoStepId=e.serverUndoStepId>=0?e.serverUndoStepId:void 0,this._private._serverExclusivity=!0===e.serverExclusivity,this._private._groupedUndos=[],this._private._groupedUndosTokens=[],this._private._serverUndoToken=void 0,this._private._pendingGroupedUndosIds=[],this._private._undoEventSent=!1,this._private._redoEventSent=!1,this._private._undoAction=e.undoAction,this._private._undoData=e.undoData,this._private._doAction=e.doAction,this._private._doData=e.doData,!1===e.redoEnabled&&(this._private._redoEnabled=!1),!0===e.exclusivity&&(this._private._exclusivity=!0)};return d.prototype._reset=function(){this._private._undoAction=void 0,this._private._undoData=void 0,this._private._doAction=void 0,this._private._doData=void 0,this._private._serverUndoStepId=void 0,this._private._serverExclusivity=!1},d.prototype.getId=function(){return this._private._id},d.prototype.getUndoTitle=function(){return this._private._undoTitle},d.prototype.setExclusivity=function(e){if(void 0===e||"boolean"!=typeof e)throw new Error("privateUndoStep.setExclusivity expects an input parameter exclusivity of type boolean.");this._private._exclusivity=e},d.prototype.getExclusivity=function(){return this._private._exclusivity},d.prototype.setRedoEnabled=function(e){if(void 0===e||"boolean"!=typeof e)throw new Error("privateUndoStep.setRedoEnabled expects an input redoEnabled of type boolean.");this._private._redoEnabled=e},d.prototype.getRedoEnabled=function(){return this._private._redoEnabled},d.prototype.getServerUndoStepId=function(){return this._private._serverUndoStepId},d.prototype.getServerExclusivity=function(){return this._private._serverExclusivity},d.prototype._addGroupedUndo=function(e){if(void 0===e||!(e instanceof d))throw new Error("privateUndoStep.addGroupedUndo expects an input parameter of type number (Id of the undo step to group to.");if(e._private._groupedUndos.indexOf(this)>=0)throw new Error("privateUndoStep.addGroupedUndo cannot group a step into one of its own groupedStep");return this._private._groupedUndos.unshift(e),t.createReturnObject(i.SUCCEEDED,{description:"privateUndoStep.addGroupedUndo was executed as expected."})},d.prototype._removeGroupedUndo=function(e){if(void 0===e||!(e instanceof d))throw new Error("privateUndoStep.removeGroupedUndo expects an input parameter of type number (Id of the undo step to remove.");return this._private._groupedUndos.indexOf(e)>=0&&this._private._groupedUndos.splice(this._private._groupedUndos.indexOf(e),1),t.createReturnObject(i.SUCCEEDED,{description:"privateUndoStep.removeGroupedUndo was executed as expected."})},d.prototype.hasGroupedUndoSteps=function(){return this._private._groupedUndos.length>0},d.prototype.hasGroupedStepWithPropertyValue=function(e){for(var t=0;t<this._private._groupedUndos.length;t++)if(this._private._groupedUndos[t]&&e.propertyGetter(this._private._groupedUndos[t],e.propertyValue)||this._private._groupedUndos[t].hasGroupedStepWithPropertyValue(e))return!0;return!1},d.prototype._executeUndo=function(){var t=!0,n=this,i=this._private._groupedUndos.length-1;for(this._private._undoEventSent=!1,void 0!==this._private._serverUndoStepId&&this._private._serverUndoStepId>=0&&(this._private._serverUndoToken=e.subscribe({event:"UNDO_SERVER_"+this._private._serverUndoStepId+"/EXECUTED"},function(){void 0!==this._private._serverUndoToken&&(e.unsubscribe(this._private._serverUndoToken),this._private._serverUndoToken=void 0),0===this._private._groupedUndosTokens.length&&i<0&&(this._private._undoEventSent=!0,r(n))}.bind(this))),this._private._undoAction&&this._private._undoAction.call(this,this._private._undoData),i=this._private._groupedUndos.length-1;i>=0;i--)this._private._groupedUndos[i]?(this._private._pendingGroupedUndosIds.push(this._private._groupedUndos[i].getId()),this._private._groupedUndosTokens.push(this._private._groupedUndos[i]._onUndoExecuted(function(t){var o=this._private._pendingGroupedUndosIds.indexOf(t.getId());e.unsubscribe(this._private._groupedUndosTokens[o]),this._private._groupedUndosTokens.splice(o,1),this._private._pendingGroupedUndosIds.splice(o,1),0===this._private._groupedUndosTokens.length&&void 0===this._private._serverUndoToken&&i<0&&(this._private._undoEventSent=!0,r(n))}.bind(this))),t=this._private._groupedUndos[i]._executeUndo()):t=!1;return 0===this._private._groupedUndosTokens.length&&void 0===this._private._serverUndoToken&&!1===this._private._undoEventSent&&r(n),t},d.prototype._executeRedo=function(){var t=!0,n=this,i=0;for(this._private._redoEventSent=!1,void 0!==this._private._serverUndoStepId&&this._private._serverUndoStepId>=0&&(this._private._serverUndoToken=e.subscribe({event:"REDO_SERVER_"+this._private._serverUndoStepId+"/EXECUTED"},function(){void 0!==this._private._serverUndoToken&&(e.unsubscribe(this._private._serverUndoToken),this._private._serverUndoToken=void 0),0===this._private._groupedUndosTokens.length&&i>=this._private._groupedUndos.length&&(this._private._redoEventSent=!0,o(n))}.bind(this))),i=0;i<this._private._groupedUndos.length;i++)this._private._groupedUndos[i]?(this._private._pendingGroupedUndosIds.push(this._private._groupedUndos[i].getId()),this._private._groupedUndosTokens.push(this._private._groupedUndos[i]._onRedoExecuted(function(t){var r=this._private._pendingGroupedUndosIds.indexOf(t.getId());e.unsubscribe(this._private._groupedUndosTokens[r]),this._private._groupedUndosTokens.splice(r,1),this._private._pendingGroupedUndosIds.splice(r,1),0===this._private._groupedUndosTokens.length&&void 0===this._private._serverUndoToken&&i>=this._private._groupedUndos.length&&(this._private._redoEventSent=!0,o(n))}.bind(this))),t=this._private._groupedUndos[i]._executeRedo()):t=!1;return this._private._doAction&&this._private._doAction.call(this,this._private._doData),0===this._private._groupedUndosTokens.length&&void 0===this._private._serverUndoToken&&!1===this._private._redoEventSent&&o(n),t},d.prototype._onUndoExecuted=function(t){return e.subscribe({event:"UNDO_"+this._private._id+"/EXECUTED"},t)},d.prototype._onRedoExecuted=function(t){return e.subscribe({event:"REDO_"+this._private._id+"/EXECUTED"},t)},d.prototype.removeCallback=function(t){e.unsubscribe(t)},d}),define("DS/WAfrUndoRedoUI/Private_GenericStack",["DS/Core/Events","DS/WAfrUndoRedoUI/Private_UndoStep","DS/CoreUtilities/ErrorManagement"],function(e,t,n){"use strict";var i=[n.generateReturnValue("MISSING_STEP",!1),n.generateReturnValue("NO_STEPS_TO_GROUP",!1)],r=n.getErrorManager(i,{merge:!0});function o(e){if(void 0===e||"string"!=typeof e)throw new Error("getEventWhenStackFilled expect the stack Id for which to sent the event");return e+"_FILLED"}function d(e){if(void 0===e||"string"!=typeof e)throw new Error("getEventWhenStackEmptied expect the stack Id for which to sent the event");return e+"_EMPTIED"}function a(e){if(void 0===e||"string"!=typeof e)throw new Error("getEventWhenStepPushedIntoStack expect the stack Id for which to sent the event");return"STEP_PUSHED_IN_"+e}function s(e){if(void 0===e||"string"!=typeof e)throw new Error("getEventWhenStepPopedOutOfStack expect the stack Id for which to sent the event");return"STEP_REMOVED_FROM_"+e}function p(t){e.publish({event:d(t)})}var u=function(t){if(this._private=Object.create(null),this._private._stack=[],this._private._capacity=10,this._private._name="",this._private.removeStepAt=function(t){if(void 0===t||"number"!=typeof t||t<0||t>=this._stack.length)throw new Error("genericStack._private.removeStepAt expected a number (betwwen 0 and this._stack.lenght) as an input parameter");var n=this._stack.splice(t,1);if(n&&n[0])return function(t,n){if(void 0===n||"string"!=typeof n)throw new Error("sendStepRemovedFromStack expect the step UndoTitle pushed into the stack");e.publish({event:s(t),data:n})}(this._name,n[0].getUndoTitle()),0===this._stack.length&&p(this._name),n[0]},!t)throw new Error("genericStack constructor: method expects options (an object)  as input parameter.");if(!t.ID||"string"!=typeof t.ID)throw new Error("genericStack constructor: method expects options.ID (a string) as input parameter.");if(this._private._name=t.ID,void 0!==t.capacity){if(!("number"==typeof t.capacity&&t.capacity>=0))throw new Error("genericStack constructor: if options.capacity is set, it must be a number >= 0.");this._private._capacity=t.capacity}};return u.prototype.getName=function(){return this._private._name},u.prototype.getSize=function(){return this._private._stack.length},u.prototype.getCapacity=function(){return this._private._capacity},u.prototype.setCapacity=function(e){if(void 0===e||"number"!=typeof e||e<0)throw new Error("genericStack.setCapacity: method expects the undo stack capacity (a number >= 0) to set as input parameter.");for(this._private._capacity=e;this._private._stack.length>e;)this._private.removeStepAt(0);return n.createReturnObject(r.SUCCEEDED,{description:""})},u.prototype.pushStep=function(i){if(void 0===i)throw new Error("genericStack pushStep: method expects the step as input parameter.");if(!(i instanceof t))throw new Error("genericStack pushStep: method expects the step of type PrivateUndoStep as input parameter.");var d;return this._private._stack.length===this._private._capacity&&this._private.removeStepAt(0),this._private._stack.push(i),function(t,n){if(void 0===n||"string"!=typeof n)throw new Error("sendStepPushedIntoStack expect the step UndoTitle pushed into the stack");e.publish({event:a(t),data:n})}(this.getName(),i.getUndoTitle()),1===this.getSize()&&(d=this.getName(),e.publish({event:o(d)})),n.createReturnObject(r.SUCCEEDED,{description:"Step added in stack"})},u.prototype.popStep=function(){if(0!==this.getSize())return this._private.removeStepAt(this._private._stack.length-1)},u.prototype.flush=function(){this._private._stack=[],p(this.getName())},u.prototype.getLastStepId=function(){return this._private._stack.length>0?this._private._stack[this._private._stack.length-1].getId():-1},u.prototype.getLastStepUndoTitle=function(){return this._private._stack.length>0?this._private._stack[this._private._stack.length-1].getUndoTitle():void 0},u.prototype.findStepIdx=function(e){var t=-1;if(void 0===e||e<-1||"number"!=typeof e)throw new Error("genericStack findStepIdx: method expects the Step identifier (a number >= 0) as input parameter.");for(t=this._private._stack.length-1;t>=0;t--)if(this._private._stack[t].getId()===e)return t;return-1},u.prototype.findStepIdFromPropertyValue=function(e){var t=-1;if(void 0===e||void 0===e.propertyGetter||void 0===e.propertyValue||"function"!=typeof e.propertyGetter)throw new Error("findStepIdFromPropertyValue expects a property named propertyGetter (function) and another named propertyValue on parameters.");for(t=this._private._stack.length-1;t>=0;t--)if(e.propertyGetter(this._private._stack[t],e.propertyValue)||this._private._stack[t].hasGroupedStepWithPropertyValue(e))return this._private._stack[t].getId();return-1},u.prototype.removeStepWithId=function(e){if(void 0===e||"number"!=typeof e||e<0)throw new Error("genericStack.removeStepWithId: method expects the step Id of type nummber >= 0 as input parameter.");var t=this.findStepIdx(e);return t<0?n.createReturnObject(r.MISSING_STEP,{description:"genericStack.removeStepWithId: step with Id:"+e+", not found."}):(this._private.removeStepAt(t),n.createReturnObject(r.SUCCEEDED,{description:"genericStack.removeStepWithId: step with Id : "+e+", was successfully removed."}))},u.prototype.removeStepsFromId=function(e){if(void 0===e||"number"!=typeof e||e<0)throw new Error("genericStack.removeStepsFromId: method expects the step Id from which to remove step of type nummber >= 0 as input parameter.");var t=this.findStepIdx(e);if(t<0)return n.createReturnObject(r.MISSING_STEP,{description:"genericStack.removeStepsFromId: step with Id:"+e+", not found."});for(var i=0;i<=t;i++)this._private.removeStepAt(0);return n.createReturnObject(r.SUCCEEDED,{description:"genericStack.removeUndoWithId: step with Id : "+e+", was successfully removed."})},u.prototype.groupSteps=function(e,t,i){if(void 0===e||void 0===t)throw new Error("genericStack.groupSteps: method expects iFromId and iToId, the 2 server step server Id to group as input parameters.");if("number"!=typeof e||"number"!=typeof t)throw new Error("genericStack.groupSteps: method expects iFromId and iToId, the 2 server step server Id to group as input parameters to be of numbers.");if(t>e)throw new Error("genericStack.groupSteps: index of step with iFromId:"+e+"< index of step with iToId:"+t+".");var o=this.findStepIdx(e);if(-1===o)return n.createReturnObject(r.MISSING_STEP,{description:"genericStack.groupSteps: step with iFromId:"+e+", not found."});if(0===o)return n.createReturnObject(r.NO_STEPS_TO_GROUP,{description:"genericStack.groupSteps: no steps to group between iFromId:"+e+" and iToId:"+t+"."});for(var d,a,s,p=this._private._stack[o],u=e-1;u>=t;)(d=this.findStepIdx(u))>-1&&(a=this._private._stack[d])&&(void 0!==a.getServerUndoStepId()&&a.getServerUndoStepId()>=0&&(s=a),p._addGroupedUndo(a),this._private.removeStepAt(d)),u--;if(void 0!==s){void 0!==i&&i.getComponent(WAfrStandardComponentKey.CSComponent)}return n.createReturnObject(r.SUCCEEDED,{description:"genericStack.groupSteps: server steps from Id : "+e+" to Id : "+t+" were grouped."})},u.prototype.onStackFilled=function(t){return e.subscribe({event:o(this.getName())},t)},u.prototype.onStackEmptied=function(t){return e.subscribe({event:d(this.getName())},t)},u.prototype.onStepPushedIntoStack=function(t){return e.subscribe({event:a(this.getName())},t)},u.prototype.onStepRemovedFromStack=function(t){return e.subscribe({event:s(this.getName())},t)},u.prototype.removeCallback=function(t){e.unsubscribe(t)},u}),define("DS/WAfrUndoRedoUI/Private_UndoRedoManager",["DS/Core/Core","UWA/Class","DS/WAfrHandlers/private/private_CommandHandlerUtilities","DS/Core/Events","DS/WAfrUndoRedoUI/Private_GenericStack","DS/WAfrUndoRedoUI/Private_UndoStep","DS/CoreUtilities/ErrorManagement"],function(e,t,n,i,r,o,d){"use strict";var a=[d.generateReturnValue("MISSING_UNDO_STEP",!1),d.generateReturnValue("WRONG_UNDO_STEP_ORDER",!1),d.generateReturnValue("NO_UNDO_STEPS_TO_GROUP",!1),d.generateReturnValue("UNDO_STEP_CREATION_FAILED",!1),d.generateReturnValue("FAIL",!1)],s=d.getErrorManager(a,{merge:!0}),p=function(t){d.getDebugMode()&&(d.getDebugMode()&&e.enableWUXConsole(),console.log(t))},u=t.singleton({init:function(){u._parent(),this.privateUndoStep=o,this._private||(this._private=Object.create(null)),this._private._undoStack=new r({ID:"AfrUndoStack"}),this._private._redoStack=new r({ID:"AfrRedoStack"}),this._private._endAllEventToken=void 0,this._private._undoExecutedToken=[],this._private._undoExecutedId=[],this._private._redoExecutedToken=[],this._private._redoExecutedId=[],this._private._undosPending=[],this._private._lastUndoStepId=-1,this._private._lastUndoStepIdSaved=-1,this._private._cleanEndAllEventToken=function(){void 0!==this._endAllEventToken&&(i.unsubscribe(this._endAllEventToken),this._endAllEventToken=void 0)},this._private._executeUndoPending=function(){if(this._undosPending.length<=0||void 0===this._undosPending[this._undosPending.length-1])return d.createReturnObject(s.MISSING_UNDO_STEP,{description:"_executeUndoPending: No undo Pending"});var e=this._undosPending.pop();return e?(p("Undo action: "+e.getUndoTitle()),this._undoExecutedId.push(e.getId()),this._undoExecutedToken.push(e._onUndoExecuted(function(e){if(!e)return d.createReturnObject(s.FAILED,{description:"_onUndoExecuted Callback: No undo step corresponding to undo event."});var t=this._undoExecutedId.indexOf(e.getId());return t>=0&&(void 0!==this._undoExecutedToken[t]&&i.unsubscribe(this._undoExecutedToken[t]),this._undoExecutedId.splice(t,1),this._undoExecutedToken.splice(t,1)),!1!==e.getRedoEnabled()&&this._redoStack.pushStep(e),u.displayStacksSize(),i.publish({event:"UNDO_"+e.getId()+"/ENDED",data:e.getUndoTitle()}),d.createReturnObject(s.SUCCEEDED,"_onUndoExecuted Callback: succesful")}.bind(this))),e._executeUndo(),d.createReturnObject(s.SUCCEEDED,"_executeUndoPending: succesful")):d.createReturnObject(s.FAILED,"_executeUndoPending: no undo step found")},this._private.displayStacksSize=function(){p("Undo  : "+this._undoStack.getSize()+" | Redo : "+this._redoStack.getSize())}},createUndoStep:function(e){var t,n;if(void 0===e||void 0===e.undoTitle||"string"!=typeof e.undoTitle||void 0===e.undoAction||"function"!=typeof e.undoAction)throw new Error("PrivateUndoRedoManager.createUndoStep expects an input object parameters with at least parameters.undoTitle {string} and parameters.undoAction {function} specified.");if(!this._private._executionContext)throw new Error("PrivateUndoRedoManager.createUndoStep: cannot get the execution context");(t=this._private._executionContext.getComponent("AFR_CommandsManager"))._private._runningCmd&&(n=t._private._runningCmd._private._command._instance),n&&n._previousUndoId===this._private._lastUndoStepId?(e.redoEnabled=!1,e.exclusivity=!0):(e.redoEnabled=!0,e.exclusivity=!1);var i=new o(e);return i?(this.registerAction(i),d.createReturnObject(s.SUCCEEDED,"PrivateUndoRedoManager.createUndoStep as succeeded, undo step created and add to undo stack.")):d.createReturnObject(s.UNDO_STEP_CREATION_FAILED,"PrivateUndoRedoManager.createUndoStep as failed, undo step couldn't be created correctly.")},registerAction:function(e){if(void 0===e||!(e instanceof o))throw new Error("PrivateUndoRedoManager.registerAction expects a PrivateUndoStep instance as input.");var t=null;if(this._private._executionContext){var n=this._private._executionContext.getComponent("AFR_CommandsManager");n._private._runningCmd&&(t=n._private._runningCmd._private._command._instance)}if(t&&(t._dirtyUndoStack=!0),this._private._lastUndoStepId=e.getId(),this._private._undoStack.pushStep(e),this._private._executionContext){var i=this._private._executionContext.getComponent("AFR_AvailabilityModesComponent");i&&(this._private._redoStack.getSize()>0?i.publish({mode:"WAFR_UNDO_REDO",value:"UNDO_REDO"}):i.publish({mode:"WAFR_UNDO_REDO",value:"UNDO_ONLY"}))}return this._private._redoStack.flush(),d.createReturnObject(s.SUCCEEDED,{description:"Undo step "})},startConcatenateUS:function(){var e=null,t=null,n=null;if(!this._private._executionContext)throw new Error("PrivateUndoRedoManager.startConcatenateUS: cannot get the execution context");(t=this._private._executionContext.getComponent("AFR_CommandsManager"))._private._runningCmd&&(n=t._private._runningCmd._private._command._instance),e=t.getDefaultCommand(),this._private._lastUndoStepIdSaved=null!==e?n._previousUndoId:this._private._lastUndoStepId},stopConcatenateUS:function(e,t){if(-1!==this._private._lastUndoStepIdSaved){var n=null,i=null,r=null;if(!this._private._executionContext)throw new Error("PrivateUndoRedoManager.stopConcatenateUS: cannot get the execution context");(i=this._private._executionContext.getComponent("AFR_CommandsManager"))._private._runningCmd&&(r=i._private._runningCmd._private._command._instance),n=i._private._defaultCommand,r.askForUndoGroupingAtEnd(e,t),null===n._id&&i&&i.endAll(!0)}},discardConcatenateUS:function(){this._private._lastUndoStepIdSaved=-1},_stopConcatenateUS:function(e){var t=this._private._undoStack.getLastStepId();if(this._private._lastUndoStepIdSaved>-1&&this._private._lastUndoStepIdSaved<t){var n=new o({undoTitle:e,exclusivity:!0,redoEnabled:!0});this.registerAction(n);var i=this._private._undoStack.groupSteps(n.getId(),this._private._lastUndoStepIdSaved+1,this._private._executionContext);if(!d.hasSucceeded(i)){var r=this._private._undoStack.removeStepWithId(this._private._undoStack.getLastStepId());d.hasSucceeded(r)||d.logResult(r)}}},getLastCreatedUndoStepId:function(){return this._private._lastUndoStepId},flushStacks:function(){this._private._undoStack.flush(),this._private._redoStack.flush(),p("Undo and redo stacks have been emptied"),this.displayStacksSize()},undo:function(){var e,t=d.createReturnObject(s.SUCCEEDED,{description:""}),r=this._private._undoStack.getSize();if(r>0){(e=this._private._executionContext.getComponent("AFR_AvailabilityModesComponent"))&&(r>1?e.publish({mode:"WAFR_UNDO_REDO",value:"UNDO_REDO"}):e.publish({mode:"WAFR_UNDO_REDO",value:"REDO_ONLY"}));var o=this._private._undoStack.popStep();if(void 0!==o){this._private._undosPending.push(o);var a=null,p=null;if((p=this._private._executionContext.getComponent("AFR_CommandsManager"))._private._runningCmd&&(a=p._private._runningCmd._private._command._instance)&&(a._isCanceled=p._private._runningCmd._private._command._state===n.HandlerState.CANCELED),a&&a._previousUndoId+1>=o.getId()&&!0===o.getRedoEnabled()&&(o.setExclusivity(!0),a._previousUndoId+1===o.getId()&&o.setRedoEnabled(!1)),o.getExclusivity()&&a&&!0!==a._isCanceled){if(!1===o.getRedoEnabled()){this._private._undoStack.pushStep(o);var u=o.getId();this._private._endAllEventToken=i.subscribe({event:"COMMAND_MANAGER/ALL_CMD_ENDED"},function(){this._private._cleanEndAllEventToken(),i.publish({event:"UNDO_"+u+"/ENDED"})}.bind(this)),o=void 0,this._private._undosPending.pop()}else this._private._endAllEventToken=i.subscribe({event:"COMMAND_MANAGER/ALL_CMD_ENDED"},function(){this._private._cleanEndAllEventToken(),this._private._executeUndoPending()}.bind(this));if(!p)throw new Error("PrivateUndoRedoManager.undo: cannot get the command manager");p.endAll(!1)}else this._private._executeUndoPending()}else t=d.createReturnObject(s.EMPTY_STACK,{description:"undo: The undo stack is empty. Nothing to undo"})}else t=d.createReturnObject(s.EMPTY_STACK,{description:"undo: The undo stack is empty. Nothing to undo"});return t},onUndoExecuted:function(e,t){return void 0===e||e<0?void 0:i.subscribe({event:"UNDO_"+e+"/ENDED"},t)},redo:function(){var e,t=d.createReturnObject(s.SUCCEEDED,{description:""}),n=this._private._redoStack.getSize();this._private._executionContext&&(e=this._private._executionContext.getComponent("AFR_AvailabilityModesComponent"))&&(1===n?e.publish({mode:"WAFR_UNDO_REDO",value:"UNDO_ONLY"}):n>1&&e.publish({mode:"WAFR_UNDO_REDO",value:"UNDO_REDO"}));var r=this._private._redoStack.popStep();return r?(p("Redo action: "+r.getUndoTitle()),this._private._redoExecutedId.push(r.getId()),this._private._redoExecutedToken.push(r._onRedoExecuted(function(e){if(!e)return d.createReturnObject(s.FAILED,{description:"redo Callback: No undo step corresponding to undo event."});var t=this._private._redoExecutedId.indexOf(e.getId());return t>=0&&(void 0!==this._private._redoExecutedToken[t]&&i.unsubscribe(this._private._redoExecutedToken[t]),this._private._redoExecutedId.splice(t,1),this._private._redoExecutedToken.splice(t,1)),this._private._undoStack.pushStep(e),u.displayStacksSize(),i.publish({event:"REDO_"+e.getId()+"/ENDED",data:e.getUndoTitle()}),d.createReturnObject(s.SUCCEEDED,{description:"redo Callback success"})}.bind(this))),t=r._executeRedo()):t=d.createReturnObject(s.EMPTY_STACK,{description:"redo: The redo stack is empty. Nothing to redo"}),t},onRedoExecuted:function(e,t){return void 0===e||e<0?void 0:i.subscribe({event:"REDO_"+e+"/ENDED"},t)},displayStacksSize:function(){this._private.displayStacksSize()},getUndoRedoErrorManager:function(){return s}});return u}),define("DS/WAfrUndoRedoUI/UndoCmd",["UWA/Core","UWA/Class","DS/Core/Events","DS/WAfrUndoRedoUI/Private_UndoRedoManager"],function(e,t,n,i){"use strict";return t.extend({_token:void 0,init:function(e){e&&e.executionContext&&(this._exeCtx=e.executionContext),this._token=void 0},beginExecute:function(){var e=!1;if(this._exeCtx){var t=this._exeCtx.getComponent("AFR_CommandsManager");if(t&&"WAFRRedoCmd"===t.getRunningCommand()&&(e=!0),0===i._private._undoStack.getSize()||e)this.done();else{var r=this;this._token=i.onUndoExecuted(i._private._undoStack.getLastStepId(),function(){n.unsubscribe(r._token),r._token=void 0,r.done()}),i.undo()}}},destroy:function(){}})}),define("DS/WAfrUndoRedoUI/UndoRedoServices",["DS/WAfrUndoRedoUI/Private_UndoRedoManager","DS/CoreUtilities/ErrorManagement","DS/CoreEvents/Events"],function(e,t,n){"use strict";var i=t.getErrorManager();return{createUndoStep:function(t){if(void 0!==t.exclusivity){var n=i.createReturnObject(i.WRONG_PARAMETERS,"UndoRedoServices.createUndoStep do not support parameters.exclusivity as a valid input parameter.");i.logResult(n)}if(void 0!==t.redoEnabled){n=i.createReturnObject(i.WRONG_PARAMETERS,"UndoRedoServices.redoEnabled do not support parameters.exclusivity as a valid input parameter.");i.logResult(n)}return e.createUndoStep(t)},setUndoRedoStacksCapacity:function(t){e._private._undoStack.setCapacity(t),e._private._redoStack.setCapacity(t),n.publish({event:"WAfr_URCChanged",data:t})},getUndoRedoStackCapacity:function(){return e._private._undoStack.getCapacity()},startConcatenateUS:function(){return e.startConcatenateUS()},stopConcatenateUS:function(t){return e.stopConcatenateUS(t)}}}),define("DS/WAfrUndoRedoUI/RedoCmd",["UWA/Core","DS/Core/Events","UWA/Class","DS/WAfrUndoRedoUI/Private_UndoRedoManager"],function(e,t,n,i){"use strict";return n.extend({_token:void 0,init:function(e){e&&e.executionContext&&(this._exeCtx=e.executionContext),this._token=void 0},beginExecute:function(){var e=!1;if(this._exeCtx){var n=this._exeCtx.getComponent("AFR_CommandsManager");if(n&&"WAFRUndoCmd"===n.getRunningCommand()&&(e=!0),0===i._private._redoStack.getSize()||e)this.done();else{var r=this;this._token=i.onRedoExecuted(i._private._redoStack.getLastStepId(),function(){t.unsubscribe(r._token),r._token=void 0,r.done()}),i.redo()}}}})});