define("DS/CAT3DWPanoply/CAT3DWDropMenu",["UWA/Core","UWA/Promise","DS/UIKIT/Dropdown","DS/UIKIT/DropdownMenu","DS/CAT3DWInfraUI/CAT3DWPointerEvents"],function(t,n,e,i,s){"use strict";var o=t.Class.extend({init:function(t){this._callback=t.onClickCallback,this._isOpen=!1,this._hidden=!0,this._offset={x:0,y:0};var n=[],s={target:t.target,multiSelect:void 0!==t.multiSelect&&t.multiSelect,closeOnClick:void 0===t.closeOnClick||t.closeOnClick,className:"CAT3DWDropMenu",removeOnHide:!1,bound:!1};switch(this._target=t.target,this.menu=null,void 0!==t.className&&n.push(t.className),!0===t.centerVertical&&n.push("center-vertical"),void 0!==t.offset&&(s.offset=t.offset),s.events={},s.events.onClickOutside=this.hide.bind(this),void 0!==t.onClickCallback&&(s.events.onClick=t.onClickCallback),void 0!==t.onShowCallback&&(s.events.onShow=t.onShowCallback),t.arrowPosition){case"bottom":n.push("arrow-down");break;case"right":n.push("arrow-right");break;case"left":n.push("arrow-left");break;case"top":n.push("arrow-up")}if(void 0!==t.body)s.body=t.body,this.menu=new e(s),window.addEventListener("resize",this._debounce(this._onWindowResize,100).bind(this));else{s.items=[],this.menu=new i(s),s.items=t.items;for(let t=0;t<s.items.length;t++){s.items[t].name=s.items[t].id,this.menu.addItem(s.items[t]);for(let t=0;t<this.menu.items.length;t++)this.menu.items[t].elements.container.setAttribute("data-uid_po",s.items[t].id);s.items[t].icon&&s.items[t].icon.indexOf(".svg")>-1&&this._loadSVG(s.items[t].icon,function(t,n){for(let e=0;e<this.menu.items.length;e++)this.menu.items[e].name===t.name&&(this.menu.items[e].elements.icon.setStyle("padding-left","7px"),this.menu.items[e].elements.icon.setStyle("padding-right","7px"),this.menu.items[e].elements.icon.innerHTML=n)}.bind(this,s.items[t]))}}for(let t=0;t<n.length;t++)this.menu.elements.container.classList.add(n[t]);this._addClickOutsideListener()},checkProportions:function(){var t=this.menu.elements.container.getBoundingClientRect(),n=this.menu.elements.container.getDimensions(),e=this.menu.elements.container.getOffsets();this.menu.elements.container.setStyle("bottom","auto"),this.menu.elements.container.setStyle("right","auto"),t.top<0&&this.menu.elements.container.setStyle("top","5px"),t.left,n.outerHeight+e.y>(window.innerHeight||document.documentElement.clientHeight)&&(this.menu.elements.container.setStyle("top","auto"),this.menu.elements.container.setStyle("bottom","5px")),n.outerWidth+e.x>(window.innerWidth||document.documentElement.clientWidth)&&(this.menu.elements.container.setStyle("left","auto"),this.menu.elements.container.setStyle("right","5px"))},_loadSVG:function(t,e){return new n(function(n){require([t],function(t){e(t),n(t)})})},setCallback:function(t){this.menu.events.onClick=t},show:function(){this.menu.show(),this.checkProportions()},hide:function(){this.menu.hide()},toggle:function(){this.menu.toggle(),this.checkProportions()},getHTMLElement:function(){return this.menu.getContent()},remove:function(){null!==this.menu&&null!==this.menu.body&&window.removeEventListener("resize",this._onWindowResize),this.menu.remove()},onHide:function(t){this.menu.addEvent("onHide",function(){t&&t(this._lastClickEvent)}.bind(this))},_onWindowResize:function(){this.menu.isVisible&&(this.menu.updatePosition(),this.checkProportions())},_debounce:function(t,n,e){var i;return function(){var s,o=this,a=arguments;s=e&&!i,clearTimeout(i),i=setTimeout(function(){i=null,e||t.apply(o,a)},n),s&&t.apply(o,a)}},_addClickOutsideListener:function(){document.addEventListener(s.POINTERDOWN,function(t){this._lastClickEvent=t,!this.menu.isVisible||this.menu.getContent().contains(t.target)||this._target.contains(t.target)||this.hide()}.bind(this))}});return t.namespace("DS/CAT3DWPanoply/CAT3DWDropMenu",o)}),define("DS/CAT3DWPanoply/CAT3DWButton",["UWA/Core","UWA/Promise"],function(t,n){"use strict";var e=t.Class.extend({init:function(n){this._callback=n.callback,this._name=n.name,this._container=new t.Element("div",{class:"CAT3DSKAction-container "+this._name,"data-uid_po":this._name})},loadSVG:function(t,e){return new n(function(n){require([t],function(t){e&&e(t),n(t)})})},addLabel:function(n){n&&""!=n&&(this._labelContainer?this.updateLabel(n):(this._labelContainer=new t.Element("div",{class:"CAT3DSKButton-label-container",text:n}).inject(this._container,"top"),this._container.hasClassName("hasLabel")||this._container.addClassName("hasLabel")))},updateLabel:function(t){this._labelContainer?t&&""!==t&&(this._labelContainer.innerHTML=t):this.addLabel(t)},onClick:function(t){this._callback(t)},toggleON:function(){},toggleOFF:function(){},setCallback:function(t){this._callback=t},setAvailability:function(t){t?(this._container.removeClassName("non-available"),this._container.hasClassName("available")||this._container.addClassName("available")):(this._container.removeClassName("available"),this._container.hasClassName("non-available")||this._container.addClassName("non-available"))},getAvailability:function(){return!!this._container.hasClassName("available")},getHTMLElement:function(){return this._container}});return t.namespace("DS/CAT3DWPanoply/CAT3DWButton",e)}),define("DS/CAT3DWPanoply/CAT3DWActionHelp",["UWA/Core","DS/CAT3DWInfra/CAT3DWPreferenceManager","DS/CAT3DWInfraUI/CAT3DWPointerEvents","DS/UIKIT/Alert","DS/UIKIT/SuperModal","i18n!DS/CAT3DWPanoply/assets/nls/CAT3DWActionHelp"],function(t,n,e,i,s,o){"use strict";var a=t.Class.extend({init:function(n){this._banner=new t.Element("div",{class:"CAT3DWHelp-banner "+n.name}),this._icon=n.icon,this._cmd=n.cmd,this._key=null,this._alert=null,this._message=null,this._tip=null,this._title=null,this._text1=null,this._text2=null,this._gif=null,this._superModal=null,this._viewContainer=null,this._hasBeenClosed={}},show:function(){if(this._message&&!this._alert&&n.getPreferenceValue("help")&&!this._hasBeenClosed[this._key]){this._alert=new i({visible:!0,fullWidth:!1,autoHide:!1,closable:!0,closeOnClick:!1,maximumVisibleMessages:1,events:{onRemoveMessage:function(){this._onRemoveMessage()}.bind(this)}}).inject(this._banner),(this._tip||this._text1||this._text2||this._gif)&&(this._superModal=new s({className:"CAT3DWHelp-modal"}));var t="",a="";this._superModal&&(t='<span class="more-text">'+o.get("moreLabel")+"</span>",a="has-modal");var l='<span class="message">'+this._message+t+"</span>";l+=t,this._alert.add({className:"alert-help",message:'<div class="message-container '+a+'">'+l+"</div>"}),this._superModal&&this._alert.getContent().addEvent(e.POINTERHIT,function(t){this._openModal(t)}.bind(this));var h=this._cmd.getView(),c=this._cmd.getPanoply();h?this._viewContainer=h.getViewContainer():c&&(this._viewContainer=c.getViewContainer()),this._viewContainer&&this._viewContainer.addClassName("has-help")}},hide:function(){this._alert&&(this._viewContainer&&(this._viewContainer.removeClassName("has-help"),this._viewContainer=null),this._alert.destroy(),this._alert=null,this._superModal&&this._superModal.destroy(),this._superModal=null)},isVisible:function(){return!!this._alert},reset:function(){this._hasBeenClosed={}},_openModal:function(t){if(this._superModal&&!t.target.classList.contains("close")){var n="";n+='<div class="helpmodal-textcontent">',this._message&&(n+='<div class="helpmodal-message">'+this._message+"</div>"),this._text1&&(n+='<div class="helpmodal-text1">'+this._text1+"</div>"),this._text2&&(n+='<div class="helpmodal-text2">'+this._text2+"</div>"),n+="</div>",n+='<div class="helpmodal-mediacontent">',this._gif&&(n+=this._gif.outerHTML),n+="</div>",n+='<div class="helpmodal-textcontent">',this._tip&&(n+='<div class="helpmodal-tip"><u>'+o.get("tipLabel")+":</u> "+this._tip+"</div>"),n+="</div>",this._superModal.dialog({body:n,title:this._title,buttons:[{className:"primary",value:o.get("modal.labelButton"),action:function(t){t.hide()}}]})}},_onRemoveMessage:function(){this._hasBeenClosed[this._key]=!0,this._viewContainer.removeClassName("has-help"),this._viewContainer=null},setHelp:function(t){this._key=t.key,this._message=t.message,this._tip=t.tip,this._title=t.title?t.title:o.get("defaultTitle"),this._text1=t.text1,this._text2=t.text2,this._gif=null,t.gif&&(this._gif=new Image,this._gif.onerror=function(t){console.error("Failed to load gif")},this._gif.src=t.gif,this._gif.className="helpmodal-gif",this._gif.alt=this._title)},getHTMLElement:function(){return this._banner}});return t.namespace("DS/CAT3DWPanoply/CAT3DWActionHelp",a)}),define("DS/CAT3DWPanoply/CAT3DWView",["UWA/Core","DS/ApplicationFrame/FrameWindowsManager"],function(t,n){"use strict";var e=t.Class.extend({init:function(e){this._frmWindow=n.getFrameWindow(),this._webGLV6Viewer=this._frmWindow.getViewer(),this._viewpoint=this._frmWindow.getViewpoint(),this._uiFrame=this._frmWindow.getUIFrame(),this._buttonsArray=[],this._ViewContainer=new t.Element("div",{class:"CAT3DSKPanoplyViewContainer"}),e&&e.id&&this._ViewContainer.addClassName(e.id),this._OptionsLContainer=new t.Element("div",{class:"CAT3DSKPanoplyView-OptionsLeftContainer"}).inject(this._ViewContainer),this._ActionsContainer=new t.Element("div",{class:"CAT3DSKPanoplyView-ActionsContainer"}).inject(this._ViewContainer),this._OptionsRContainer=new t.Element("div",{class:"CAT3DSKPanoplyView-OptionsRightContainer"}).inject(this._ViewContainer),this._HelpContainer=new t.Element("div",{class:"CAT3DWView-HelpContainer"}).inject(this._ViewContainer),this._SelectionMenuContainer=new t.Element("div",{class:"CAT3DWView-SelectionMenuContainer"}).inject(this._ViewContainer)},setHand:function(t){t&&!this._ActionsContainer.hasClassName("left-hand")?this._ViewContainer.addClassName("left-hand"):this._ViewContainer.removeClassName("left-hand")},update:function(){},show:function(){this._ViewContainer.inject(this._uiFrame,"top")},hide:function(){this._ViewContainer.remove()},getViewContainer:function(){return this._ViewContainer},getActionsContainer:function(){return this._ActionsContainer},getSelectionMenuContainer:function(){return this._SelectionMenuContainer},getOptionsLContainer:function(){return this._OptionsLContainer},getOptionsRContainer:function(){return this._OptionsRContainer},getHelpContainer:function(){return this._HelpContainer},isLeftPanelEnabled:function(){return!0}});return t.namespace("DS/CAT3DWPanoply/CAT3DWView",e)}),define("DS/CAT3DWPanoply/CAT3DWActionButton",["DS/CAT3DWPanoply/CAT3DWButton","UWA/Core","DS/CAT3DWInfraUI/CAT3DWPointerEvents"],function(t,n,e){"use strict";var i=t.extend({init:function(t){this._parent(t),this._icon=t.icon,this._needCheck=t.needCheck,this._button=new n.Element("div",{class:"CAT3DSKButton-container"}).inject(this.getHTMLElement()),this._button.addEvent(e.POINTERHIT,this.onClick.bind(this,this._name)),this._iconContainer=new n.Element("span",{class:"CAT3DSKButton-icon"}).inject(this._button),this._icon.indexOf(".")>-1?this.loadSVG(this._icon,function(t){this._button.innerHTML=t}.bind(this)):this._iconContainer.addClassName(this._icon),this._needCheck||this.activate(),this.setAvailability(!0)},onClick:function(t,n){n.preventDefault&&n.preventDefault(),this._activated&&(n.buttonType="CAT3DWActionButton",this._parent(n))},addLabel:function(t){if(t&&""!=t)if(this._labelContainer)this.updateLabel(t);else{var e=this.getHTMLElement();this._labelContainer=new n.Element("div",{class:"CAT3DSKButton-label-container",text:t}).inject(e,"top"),e.hasClassName("hasLabel")||e.addClassName("hasLabel")}},updateLabel:function(t){this._labelContainer?t&&""!=t&&(this._labelContainer.innerHTML=t):this.addLabel(t)},removeLabel:function(){this.getHTMLElement().removeClassName("hasLabel"),this._labelContainer&&this._labelContainer.destroy()},activate:function(){this._button.hasClassName("cmd-activate")||this._button.addClassName("cmd-activate"),this._activated=!0},deactivate:function(){this._button.removeClassName("cmd-activate"),this._activated=!1},setIcon:function(t){t.indexOf(".")>-1?this.loadSVG(t,function(t){this._button.innerHTML=t}.bind(this)):(this._iconContainer.removeClassName(this._icon),this._iconContainer.addClassName(t),this._icon=t)},getButtonElement:function(){return this._button}});return n.namespace("DS/CAT3DWPanoply/CAT3DWActionButton",i)}),define("DS/CAT3DWPanoply/CAT3DWActionSubButton",["DS/CAT3DWPanoply/CAT3DWButton","UWA/Core","DS/CAT3DWInfraUI/CAT3DWPointerEvents"],function(t,n,e){"use strict";var i=n.Class.extend({init:function(t){this._parent(t),this._callback=t.callback,this._name=t.name,this._icon=t.icon,this._needCheck=t.needCheck,this._availability=!0,this._button=new n.Element("li",{class:"item CAT3DWActionSubButton-container",id:this._name,"data-uid_po":t.name}),this._button.addEvent(e.POINTERHIT,this.onClick.bind(this,this._name)),this.setIcon(this._icon),this._textContainer=new n.Element("span",{class:"item-text",text:this._name}).inject(this._button),this._needCheck||this.activate(),this.setAvailability(!0)},loadSVG:function(t,n){require([t],function(t){n&&n(t)})},onClick:function(t,n){n.preventDefault&&n.preventDefault(),this._activated&&this._callback(t)},activate:function(){this._button.removeClassName("cmd-activate"),this._button.removeClassName("disabled"),this._button.addClassName("cmd-activate"),this._activated=!0},deactivate:function(){this._button.removeClassName("cmd-activate"),this._button.removeClassName("disabled"),this._button.addClassName("disabled"),this._activated=!1},setCallback:function(t){this._callback=t},setAvailability:function(t){this._availability=t,t?this._button.setStyle("display","flex"):this._button.setStyle("display","none")},getAvailability:function(){return this._availability},setText(t){this._textContainer.setText(t)},setIcon:function(t){this._iconContainer&&(this._iconContainer.destroy(),this._iconContainer=null),this._icon=t,this._icon.indexOf(".")>-1?(this._iconContainer=new n.Element("div",{class:"icon",styles:{width:"24px",height:"24px",margin:"0px 14px"}}).inject(this._button,"top"),this.loadSVG(this._icon,function(t){this._iconContainer.innerHTML=t}.bind(this))):(this._iconContainer=new n.Element("span",{class:"fonticon"}).inject(this._button,"top"),this._iconContainer.addClassName(this._icon))},getHTMLElement:function(){return this._button}});return n.namespace("DS/CAT3DWPanoply/CAT3DWActionSubButton",i)}),define("DS/CAT3DWPanoply/CAT3DWActionToggleSubButton",["DS/CAT3DWPanoply/CAT3DWActionSubButton","UWA/Core"],function(t,n){"use strict";var e=t.extend({init:function(t){this._parent(t),this._button.addClassName("selectable"),this._isOn=!1},toggleON:function(){this._parent(),this.getHTMLElement().hasClassName("selected")||this.getHTMLElement().addClassName("selected"),this._isOn=!0},toggleOFF:function(){this._parent(),this.getHTMLElement().removeClassName("selected"),this._isOn=!1},isOn:function(){return this._isOn}});return n.namespace("DS/CAT3DWPanoply/CAT3DWActionToggleSubButton",e)}),define("DS/CAT3DWPanoply/CAT3DWActionToggleButton",["DS/CAT3DWPanoply/CAT3DWActionButton","UWA/Core"],function(t,n){"use strict";var e=t.extend({init:function(t){this._parent(t),this._isOn=!1},toggleON:function(){this._parent(),this.getHTMLElement().addClassName("active")||this.getHTMLElement().addClassName("active"),this._isOn=!0},toggleOFF:function(){this._parent(),this.getHTMLElement().removeClassName("active"),this._isOn=!1},isOn:function(){return this._isOn}});return n.namespace("DS/CAT3DWPanoply/CAT3DWActionToggleButton",e)}),define("DS/CAT3DWPanoply/CAT3DWActionView",["UWA/Core","DS/CAT3DWPanoply/CAT3DWView","DS/CAT3DWPanoply/CAT3DWActionButton","DS/CAT3DWPanoply/CAT3DWActionToggleButton"],function(t,n,e,i){"use strict";var s=n.extend({init:function(n){this._parent({id:"CAT3DWActionView"}),this._id=n.id,this._validateCallback=n.onValidate,this._cancelCallback=n.onCancel;var i=n.help;this._isLeftPanelEnabled=!1,this._isRightPanelEnabled=!1,this._fallbackPanoply=null,n.fallbackPanoply&&(this._fallbackPanoply=n.fallbackPanoply),this._cancelButton=new e({name:"CAT3DWActionView-cancelButton "+this._id,icon:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-wrong",callback:this._cancelCallback}),this._cancelButton.getHTMLElement().inject(this._ActionsContainer),this._subActionsContainer=new t.Element("div",{class:"CAT3DWActionView-subActionsContainer"}).inject(this._ActionsContainer),this._validateButton=new e({name:"CAT3DWActionView-validateButton "+this._id,icon:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-check",callback:this._validateCallback}),this._validateButton.getHTMLElement().inject(this._ActionsContainer),i&&i.getHTMLElement().inject(this._HelpContainer),this.hide()},setRightOptions:function(t){this._OptionsRContainer.empty();for(var n=0;n<t.length;n++)t[n].button.getHTMLElement().inject(this._OptionsRContainer)},setLeftOptions:function(t){this._OptionsLContainer.empty();for(var n=0;n<t.length;n++)t[n].button.getHTMLElement().inject(this._OptionsLContainer)},setActions:function(t){this._subActionsContainer.empty();for(var n=0;n<t.length;n++)t[n].inject(this._subActionsContainer)},isLeftPanelEnabled:function(){return this._isLeftPanelEnabled},isRightPanelEnabled:function(){return this._isRightPanelEnabled},getFallbackPanoply:function(){return this._fallbackPanoply}});return t.namespace("DS/CAT3DWPanoply/CAT3DWActionView",s)}),define("DS/CAT3DWPanoply/CAT3DWPanoplyView",["UWA/Core","DS/ApplicationFrame/CommandsManager","DS/CAT3DWPanoply/CAT3DWView","DS/CoreEvents/Events","UWA/Promise","DS/CAT3DWPanoply/CAT3DWDropMenu","DS/CAT3DWPanoply/CAT3DWActionButton","DS/CAT3DWVisu/CAT3DWVisuEvents"],function(t,n,e,i,s,o,a,l){"use strict";var h=e.extend({init:function(t,n){this._parent(t),this._content=t,this._id=t.id,this._ViewContainer.addClassName(this._id),this._icon=t.icon,this._panoplyManager=n,this._controlSettings=this._panoplyManager.getControlSettings(),this._actions=[],this._actionsObject={},this._moreCommandsMenu=null,this._moreCommandsMenuButton=null,this._optionsL=[],this._optionsR=[],this._selectionMenu=[],this._defaultCmd=t.command,this._settingsCmd=t.settings,this._settings=t,this._frame3DOptions=t.frame3DOptions,this._onReadyCallbacks=[],this._isReady=!1,this._onScreenOrientationChange=null,this._onResize=null,this._contextualMenu=null,this._eventsService=new l},initialize:function(){this._setUpCommands(this._settings).then(function(){for(this.hide(),this._isReady=!0;this._onReadyCallbacks.length;){this._onReadyCallbacks.pop()()}}.bind(this)).catch(function(t){console.error(t)})},onReady:function(t){this._onReadyCallbacks.push(t)},_getJSONData:function(t,n){var e={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&0===i.indexOf(n)&&(e[i]=t[i]);return e},_setUpCommands:function(t){var n,e,i=[];if(this._defaultCmd&&i.push(this._processCommand({command:this._defaultCmd})),this._settingsCmd&&i.push(this._processCommand({command:t.settings})),t["options-left"]&&t["options-left"].length)for(this._optionsL=t["options-left"],n=0;n<t["options-left"].length;n++)e=t["options-left"][n],i.push(this._processCommand(e));if(t.actions&&t.actions.length)for(this._actions=t.actions,n=0;n<t.actions.length;n++){var s=t.actions[n];this._actionsObject[s.command]=s,i.push(this._processCommand(s)),s.settings&&i.push(this._processCommand({command:s.settings}))}if(t["options-right"]&&t["options-right"].length)for(this._optionsR=t["options-right"],n=0;n<t["options-right"].length;n++)e=t["options-right"][n],i.push(this._processCommand(e));if(t["selection-menu"]&&t["selection-menu"].length)for(this._selectionMenu=t["selection-menu"],n=0;n<t["selection-menu"].length;n++)e=t["selection-menu"][n],i.push(this._processCommand(e));return Promise.all(i).catch(function(t){console.error(t)})},_processCommand:function(t){return new s(function(e){var s=n.getCommand(t.command),o=this._getJSONData(this._panoplyManager.nls,t.command),a=function(e,i){if(e.icon&&i.setIcon(e.icon),o&&i.setNls(o),t.settings){var s=n.getCommand(e.settings);i.setSettingsCmd(s)}i.subscribeEvents&&!i.isSubscribed()&&i.subscribeEvents(),i.setPanoply(this)}.bind(this,t);if(s)a(s),e();else var l=i.subscribe({event:"onSketchReady"},function(t){i.unsubscribe(l);var s=n.getCommand(t.command);a(s),e()}.bind(this,t))}.bind(this))},unload:function(){for(let t=0;t<this._actions.length;t++){n.getCommand(this._actions[t].command).unsubscribeEvents()}let t=this.getSelectionMenuContainer();for(;t.lastChild;)t.lastChild.remove();if(this._defaultCmd){n.getCommand(this._defaultCmd).unsubscribeEvents()}this.hide()},getPanoplyManager:function(){return this._panoplyManager},getID:function(){return this._id},getIcon:function(){return this._icon},getContent:function(){return this._content},getMoreMenuButton:function(){return this._moreCommandsMenuButton},_onCmdAvailabilityChange:function(t){var e=n.getCommand(t);e&&this._actionsObject[t]&&(this._checkActionsContainerSize(45)?this._actionsObject[t].irreducible?this._reduceActionsContainerByOneIfPossible():e.setSubButtonAvailable():e.setButtonAvailable())},_reduceActionsContainerByOneIfPossible:function(){for(var t=0;t<this._actions.length;t++)if(this._actions[t].command&&this._actionsObject[this._actions[t].command]&&!this._actionsObject[this._actions[t].command].irreducible)return void this._reduceAction(this._actions[t].command)},_reduceActionsContainerAsMuchAsPossible:function(){if(this._checkActionsContainerSize())for(var t=0;t<this._actions.length;t++)if(this._actions[t].command&&!this._actionsObject[this._actions[t].command].irreducible){if(!this._checkActionsContainerSize())return;this._reduceAction(this._actions[t].command)}},_reduceActionsInDropDownAsMuchAsPossible:function(){if(!this._checkActionsContainerSize(45))for(var t=0;t<this._actions.length;t++)if(this._actions[t].command&&!this._actionsObject[this._actions[t].command].irreducible){if(this._checkActionsContainerSize(45))return;this._extendAction(this._actions[t].command)}},_checkActionsContainerSize:function(t){var n=0;return t&&(n=t),this.getActionsContainer().offsetHeight+n>=window.innerHeight-84},_reduceAction:function(t){var e=n.getCommand(t);e.isButtonAvailable()&&e.setSubButtonAvailable()},_extendAction:function(t){var e=n.getCommand(t);e.isSubButtonAvailable()&&e.setButtonAvailable()},setHand:function(t){this._parent(t),this._moreCommandsMenu&&(this._moreCommandsMenu.menu.options.offset.x=t?55:-55,this._moreCommandsMenu.menu.updatePosition())},start:function(e){var s=function(){if(this._moreCommandsMenu&&(this._moreCommandsMenu.remove(),this._moreCommandsMenu=null),this._moreCommandsMenuButton&&(this._moreCommandsMenuButton.getHTMLElement().destroy(),this._moreCommandsMenuButton=null),this._frame3DOptions&&"object"==typeof this._frame3DOptions)for(var s in this._frame3DOptions)"profile"===s&&this._controlSettings&&this._frame3DOptions[s]&&this._controlSettings.applyProfile(this._frame3DOptions[s].toUpperCase(),this._frame3DOptions.forceRotation);var l,h,c,u,r;for(this._clearContextualMenu(),this.show(),this._settingsCmd&&(h=n.getCommand(this._settingsCmd))&&h.onPanoplyStart&&h.onPanoplyStart(),this._defaultCmd&&((r=(h=n.getCommand(this._defaultCmd)).getHelp())&&!h.getView()&&r.getHTMLElement().inject(this.getHelpContainer()),n.setDefaultCommand({ID:this._defaultCmd})),l=0;l<this._optionsL.length;l++)c=this._optionsL[l],(h=n.getCommand(c.command))&&((u=h.getButton())&&u.getHTMLElement().inject(this.getOptionsLContainer()),(r=h.getHelp())&&!h.getView()&&r.getHTMLElement().inject(this.getHelpContainer()),h.onPanoplyStart());var m=[],d=null,_=function(e){(h=n.getCommand(e.command))&&(d||(d=new t.Element("ul",{class:"CAT3DWView-MoreMenu dropdown-menu-wrap dropdown-menu-icons"})),h.getSubButton().getHTMLElement().inject(d))};for(l=0;l<this._actions.length;l++){var p=this._actions[l];(h=n.getCommand(p.command))&&(p.irreducible||(_(p),m.push(p)),(u=h.getButton())&&u.getHTMLElement().inject(this.getActionsContainer()),this._onCmdAvailabilityChange(p.command),(r=h.getHelp())&&!h.getView()&&r.getHTMLElement().inject(this.getHelpContainer()),h.onPanoplyStart())}if(e&&e.moreCommands&&e.moreCommands.length)for(l=0;l<e.moreCommands.length;l++)(h=n.getCommand(e.moreCommands[l].command))&&(_(e.moreCommands[l]),(r=h.getHelp())&&!h.getView()&&r.getHTMLElement().inject(this.getHelpContainer()),h.onPanoplyStart());d&&(this._moreCommandsMenuButton=new a({name:"CAT3DWView-DropMenuButton",icon:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-menu-dot"}),this.getViewContainer().hasClassName("left-hand")?this._moreCommandsMenu=new o({target:this._moreCommandsMenuButton.getHTMLElement(),position:"top-left",offset:{x:55,y:-45},body:d}):this._moreCommandsMenu=new o({target:this._moreCommandsMenuButton.getHTMLElement(),position:"top-left",offset:{x:-55,y:-45},body:d}),this._moreCommandsMenu.menu.elements.container.addClassName("CAT3DWView-DropMenu"),this._moreCommandsMenu.menu.elements.container.addClassName("dropdown-menu"),this._moreCommandsMenu.menu.elements.container.addClassName("dropdown-menu-root"),this._moreCommandsMenu.menu.elements.container.setStyle({"overflow-x":"hidden","overflow-y":"auto"}),this._moreCommandsMenuButton.setCallback(function(){if(this._moreCommandsMenu.toggle(),e&&e.moreCommands&&e.moreCommands.length)for(l=0;l<e.moreCommands.length;l++)(h=n.getCommand(e.moreCommands[l].command))&&h.onShowMoreMenu&&h.onShowMoreMenu()}.bind(this)),this._moreCommandsMenuButton&&this._moreCommandsMenuButton.getHTMLElement().inject(this.getActionsContainer()));var C=null;if(e&&e.contextualCommands&&e.contextualCommands.length)for(l=0;l<e.contextualCommands.length;l++)(h=n.getCommand(e.contextualCommands[l].command))&&(C||(C=new t.Element("ul",{class:"dropdown-menu-wrap dropdown-menu-icons"})),h.getContextButton().getHTMLElement().inject(C),(r=h.getHelp())&&!h.getView()&&r.getHTMLElement().inject(this.getHelpContainer()),h.onPanoplyStart());for(C&&(this._contextualMenu=new o({target:new t.Element("div",{}),body:C}),this._contextualMenu.menu.elements.container.addClassName("CAT3DWView-contextualMenu"),this._contextualMenu.menu.elements.container.addClassName("dropdown-menu"),this._contextualMenu.menu.elements.container.addClassName("dropdown-menu-root"),this._contextualMenu.menu.elements.container.setStyle({"overflow-x":"hidden","overflow-y":"auto"}),this._contextMenuCB=function(t){setTimeout(function(){this._contextualMenu.show();var i={x:null,y:null};if(t.position?(i.x=t.position.x,i.y=t.position.y):(i.x=t.clientX,i.y=t.clientY),this._contextualMenu.menu.elements.container.setStyle("top",i.y),this._contextualMenu.menu.elements.container.setStyle("left",i.x),e&&e.contextualCommands&&e.contextualCommands.length)for(l=0;l<e.contextualCommands.length;l++)(h=n.getCommand(e.contextualCommands[l].command))&&h.onShowContextMenu&&h.onShowContextMenu(i);this._contextualMenu.checkProportions()}.bind(this),100)}.bind(this),this._onRightClickEventToken=i.subscribe({event:this._eventsService.getRightClickEvent()},this._contextMenuCB),this._onLongHoldEventToken=i.subscribe({event:this._eventsService.getLongHoldEvent()},function(t){t.isTouch&&this._contextMenuCB(t)}.bind(this))),l=0;l<this._optionsR.length;l++)c=this._optionsR[l],(h=n.getCommand(c.command))&&((u=h.getButton())&&u.getHTMLElement().inject(this.getOptionsRContainer()),(r=h.getHelp())&&!h.getView()&&r.getHTMLElement().inject(this.getHelpContainer()),h.onPanoplyStart());var f=this.getSelectionMenuContainer(),b=this.getHelpContainer(),g=null;for(l=0;l<this._selectionMenu.length;l++)c=this._selectionMenu[l],(h=n.getCommand(c.command))&&((u=h.getButton())&&(g=u.getHTMLElement())&&!g.getParent()&&g.inject(f),(r=h.getHelp())&&!h.getView()&&(g=r.getHTMLElement())&&!g.getParent()&&g.inject(b),h.onPanoplyStart());var y=function(){this._reduceActionsContainerAsMuchAsPossible(),this._reduceActionsInDropDownAsMuchAsPossible()}.bind(this);this._onResize=y,window.addEventListener("resize",y),e&&e.callback&&e.callback()}.bind(this);this._isReady?s():this.onReady(s)},stop:function(){this._moreCommandsMenu&&(this._moreCommandsMenu.remove(),this._moreCommandsMenu=null),this._moreCommandsMenuButton&&(this._moreCommandsMenuButton.getHTMLElement().destroy(),this._moreCommandsMenuButton=null),this._onResize&&(window.removeEventListener("resize",this._onResize),this._onResize=null),this._clearContextualMenu(),n.resetDefaultCommand(),this.hide()},_clearContextualMenu:function(){this._contextualMenu&&(this._contextualMenu.remove(),this._contextualMenu=null),this._contextMenuCB=null,i.unsubscribe(this._onRightClickEventToken),i.unsubscribe(this._onLongHoldEventToken)}});return t.namespace("DS/CAT3DWPanoply/CAT3DWPanoplyView",h)}),define("DS/CAT3DWPanoply/CAT3DWPanoplyManager",["UWA/Core","DS/CAT3DWPanoply/CAT3DWPanoplyView","DS/CAT3DWInfra/CAT3DWPreferenceManager","DS/CoreEvents/Events","DS/ApplicationFrame/CommandsManager","DS/ApplicationFrame/FrameWindowsManager","UWA/Promise","css!DS/CAT3DWPanoply/CAT3DWPanoply"],function(t,n,e,i,s,o,a){"use strict";var l=t.Class.extend({init:function(t){this._panoplyArray=[],this._panoplyObject={},this._panoplyInfosArray=[],this._onPanoplyStartTokens=[],this._currentPanoply=null,this._defaultPanoply=null,this._globalPanoply=null,this._moreCommands=[],this._contextualCommands=[],this._panoplyShortcuts={},this._onReady=[],this._frmWindow=o.getFrameWindow(),this._uiFrame=this._frmWindow.getUIFrame(),t.nls&&t.rsc&&(this.nls=t.nls,this.rsc=t.rsc),t.controlSettings&&(this._controlSettings=t.controlSettings)},initialize:function(){var t=this.rsc.panoplyArray,e=this.rsc.globalPanoply;this.rsc.moreCommands&&this.rsc.moreCommands.length&&(this._moreCommands=this.rsc.moreCommands),this.rsc.contextualCommands&&this.rsc.contextualCommands.length&&(this._contextualCommands=this.rsc.contextualCommands);for(var o=[],l=0;l<t.length;l++)if(o.push(new a(function(e,i){var s=t[e];this._panoplyArray.push(s.id),this._panoplyObject[s.id]=new n(s,this),this._panoplyObject[s.id].onReady(i),this._panoplyObject[s.id].initialize(),this._panoplyInfosArray[e]={id:s.id,icon:s.icon,icon_active:s.icon_active,settings:s.settings}}.bind(this,l))),t[l].shortcut){this._panoplyShortcuts[t[l].shortcut]=t[l].id;let n="Digit"+t[l].shortcut,e="Numpad"+t[l].shortcut;this._panoplyShortcuts[n]=t[l].id,this._panoplyShortcuts[e]=t[l].id}this._onKeydownCB=this._onKeyDown.bind(this),document.addEventListener("keydown",this._onKeydownCB),e&&o.push(new a(function(t){e.id="GlobalPanoplyContainer",this._globalPanoply=new n(e,this),this._globalPanoply.onReady(t),this._globalPanoply.initialize()}.bind(this))),this._onCommandStartToken=s.onCommandStart(this._onActionBegin.bind(this)),Promise.all(o).then(function(){for(var t=[],n=this._moreCommands.concat(this._contextualCommands),e=0;e<n.length;e++)t.push(this._globalPanoply._processCommand(n[e]));return Promise.all(t).catch(function(t){console.error(t)})}.bind(this)).then(function(){this._globalPanoply.start(),i.publish({event:"CAT3DWPanoplyManager/INIT"});for(var t=0;t<this._onReady.length;t++)this._onReady[t]()}.bind(this)).catch(function(t){console.error(t)})},onManagerReady:function(t){this._onReady.push(t)},unload:function(){var t;for(i.unsubscribe(this._onCommandStartToken),document.removeEventListener("keydown",this._onKeydownCB),t=0;t<this._onPanoplyStartTokens.length;t++)i.unsubscribe(this._onPanoplyStartTokens[t]);for(this._globalPanoply&&(this._globalPanoply.unload(),this._globalPanoply=null),t=0;t<this._panoplyArray.length;t++)this._panoplyObject[this._panoplyArray[t]].unload(),this._panoplyObject[this._panoplyArray[t]]=null;this._panoplyArray=[],this._panoplyObject={},this._currentPanoply=null,this._defaultPanoply=null,this._moreCommands=[],this._contextualCommands=[],this._onReady=[]},importCSS:function(t){t.indexOf("css!")>-1&&require([t],function(){})},startPanoply:function(t){this._panoplyObject[t]&&(this._currentPanoply&&t!==this._currentPanoply.getID()&&this._panoplyObject[t]&&this.endPanoply(),this._currentPanoply=this._panoplyObject[t],this._panoplyObject[t].start({moreCommands:this._moreCommands,contextualCommands:this._contextualCommands,callback:function(){this._updateNextPanoply(),i.publish({event:"CAT3DSKPanoply/START",data:{id:this._currentPanoply.getID(),icon:this._currentPanoply.getIcon(),nextId:this._nextPanoply.getID(),nextIcon:this._nextPanoply.getIcon()}})}.bind(this)}))},_onKeyDown:function(t){if(s.getCurrentCmdId()!=this._currentPanoply._defaultCmd)return;if(t&&t.target&&"INPUT"===t.target.tagName)return;let n=s.getCommand("QuickTourCmd");n&&n._isStarted||(this._panoplyShortcuts[t.key]?this.startPanoply(this._panoplyShortcuts[t.key]):this._panoplyShortcuts[t.code]&&this.startPanoply(this._panoplyShortcuts[t.code]))},endPanoply:function(){this._currentPanoply.stop()},getNextPanoply:function(){return this._nextPanoply},_updateNextPanoply:function(){for(var t,n=0;n<this._panoplyArray.length;n++)this._currentPanoply.getID()===this._panoplyArray[n]&&(t=n===this._panoplyArray.length-1&&0!==n?this._panoplyArray[0]:this._panoplyArray[n+1]);this._nextPanoply=this._panoplyObject[t]},nextPanoply:function(){this.startPanoply(this._nextPanoply.getID())},setDefaultPanoply:function(t){this._panoplyObject[t]&&(this._defaultPanoply=this._panoplyObject[t]),this.startDefaultPanoply()},startDefaultPanoply:function(){this._defaultPanoply&&this.startPanoply(this._defaultPanoply.getID())},setHand:function(t){if(this._globalPanoply&&this._globalPanoply.setHand(t),this._panoplyArray.length)for(var n=0;n<this._panoplyArray.length;n++)this._panoplyObject[this._panoplyArray[n]].setHand(t)},_onActionBegin:function(t){var n,e=s.getCommand(s.getCurrentCmdId());if(e&&(n=e.getView()),n)this._temporaryView=n,this._currentPanoply.hide(),this._temporaryView.show(),n.isLeftPanelEnabled()&&n.isRightPanelEnabled()||this._globalPanoply.hide();else if(this._temporaryView){var o=this._temporaryView.getFallbackPanoply();if(this._temporaryView.hide(),this._temporaryView=null,this._currentPanoply.show(),this._globalPanoply.show(),o)var a=t.onExecute(function(){i.unsubscribe(a),this.startPanoply(o)}.bind(this))}},isInCommandSubView:function(){return!!this._temporaryView},onPanoplyStart:function(t){this._onPanoplyStartTokens.push(i.subscribe({event:"CAT3DSKPanoply/START"},t))},getPanoplyInfosArray:function(){return this._panoplyInfosArray},getCurrentPanoply:function(){return this._currentPanoply},enableHelp:function(t){e.setPreferenceValue("help",t);var n=s.getCommand(s.getCurrentCmdId());if(n)if(t)n.getHelp().show();else{n.getHelp().hide();var i=s.getCommands();for(var o in i)i[o].getHelp().reset()}},getControlSettings:function(){return this._controlSettings}});return t.namespace("DS/CAT3DWPanoply/CAT3DWPanoplyManager",l)}),define("DS/CAT3DWPanoply/CAT3DWToggleButton",["DS/CAT3DWPanoply/CAT3DWButton","UWA/Core"],function(t,n){"use strict";var e=t.extend({init:function(t){this._parent(t),this.isChecked=!1},onClick:function(t){this.isChecked?this.isChecked=!1:this.isChecked=!0,this._parent(t)},toggleON:function(){this.isChecked=!0},toggleOFF:function(){this.isChecked=!1},isON:function(){return this.isChecked}});return n.namespace("DS/CAT3DWPanoply/CAT3DWToggleButton",e)}),define("DS/CAT3DWPanoply/CAT3DWActionCmd",["UWA/Core","DS/ApplicationFrame/Command","DS/CAT3DWPanoply/CAT3DWActionButton","DS/CAT3DWPanoply/CAT3DWActionHelp","DS/CAT3DWPanoply/CAT3DWToggleButton","DS/WebappsUtils/WebappsUtils","DS/CoreEvents/Events","DS/CAT3DWPanoply/CAT3DWActionSubButton"],function(t,n,e,i,s,o,a,l){"use strict";var h=n.extend({init:function(t,n){this._parent(t,n),this._icon="",t&&t.icon&&this.setIcon(t.icon),this._button=null,this._subButton=null,this._availability=!0,this._actionView=null,this._panoply=null,this._help=null,"ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch?this._touchMode=!0:this._touchMode=!1},onPanoplyStart:function(){},setPanoply:function(t){this._panoply=t},getPanoply:function(){return this._panoply},subscribeEvents:function(){this._subscribed=!0},unsubscribeEvents:function(){this._subscribed=!1},isSubscribed:function(){return this._subscribed},beginExecute:function(t){this._button&&this._button instanceof s&&this._button.toggleON(),a.publish({event:"CAT3DWActionCmd/START/"+this.getId(),data:t}),a.publish({event:this._globalEvtID+"/EXECUTE",data:this}),this._help&&this._help.show(),this._parent()},cancelExecute:function(t){a.publish({event:"CAT3DWActionCmd/CANCEL/"+this.getId(),data:t}),a.publish({event:this._globalEvtID+"/CANCEL",data:this}),this._parent()},endExecute:function(t){this._button&&this._button instanceof s&&this._button.toggleOFF(),a.publish({event:"CAT3DWActionCmd/END/"+this.getId(),data:t}),a.publish({event:this._globalEvtID+"/END",data:this}),this._help&&this._help.hide(),this._parent()},check:function(){},getAvailability:function(){return this._availability},setAvailability:function(t){this._availability!==t&&(this._availability=t,this._button&&this._button.setAvailability&&this._button.setAvailability(t),this._subButton&&this._subButton.setAvailability&&this._subButton.setAvailability(t),this._contextButton&&this._contextButton.setAvailability&&this._contextButton.setAvailability(t),this._panoply&&this._panoply._onCmdAvailabilityChange(this._id))},setButtonAvailable:function(){this._availability?(this._button&&this._button.setAvailability&&this._button.setAvailability(!0),this._subButton&&this._subButton.setAvailability&&this._subButton.setAvailability(!1)):(this._button&&this._button.setAvailability&&this._button.setAvailability(!1),this._subButton&&this._subButton.setAvailability&&this._subButton.setAvailability(!1))},setSubButtonAvailable:function(){this._availability?(this._button&&this._button.setAvailability&&this._button.setAvailability(!1),this._subButton&&this._subButton.setAvailability&&this._subButton.setAvailability(!0)):(this._button&&this._button.setAvailability&&this._button.setAvailability(!1),this._subButton&&this._subButton.setAvailability&&this._subButton.setAvailability(!1))},isButtonAvailable:function(){if(this._button&&this._button.getAvailability)return this._button.getAvailability()},isSubButtonAvailable:function(){if(this._subButton&&this._subButton.getAvailability)return this._subButton.getAvailability()},setIcon:function(t){this._icon=t,this.getButton().setIcon(this._icon),this.getSubButton().setIcon(this._icon),this.getContextButton().setIcon(this._icon)},setLabel:function(t){this._label=t,this.getButton().addLabel(t),this.getSubButton().setText(t),this.getContextButton().setText(t)},setNls:function(t){this._nls=t,this._nls[this._id+".text"]&&(this.getButton().addLabel(this._nls[this._id+".text"]),this.getSubButton().setText(this._nls[this._id+".text"]),this.getContextButton().setText(this._nls[this._id+".text"]))},setSettingsCmd:function(t){this._settingsCmd=t},_callback:function(){this._isRunning||this.begin()},setButton:function(t){this._button=t},setSubButton:function(t){this._subButton=t},setContextButton:function(t){this._contextButton=t},getButton:function(){return this._button?this._button:(this._button=this.createButton(),this._button)},getSubButton:function(){return this._subButton?this._subButton:(this._subButton=this.createSubButton(),this._subButton)},getContextButton:function(){return this._contextButton?this._contextButton:(this._contextButton=this.createSubButton(),this._contextButton)},createButton:function(){return new e({name:this._id,icon:this._icon,callback:this._callback.bind(this)})},createSubButton:function(){return new l({name:this._id,icon:this._icon,callback:this._callback.bind(this)})},getView:function(){return this._actionView},setView:function(t){this._actionView=t},getHelp:function(){return this._help?this._help:(this._help=new i({name:this._id,icon:this._icon,cmd:this}),this._help)},setHelpResources:function(t){if(t.i18nObj){var n=this.getHelp();n.hide();var e=t.i18nObj,i="help."+t.key+".",s="help.touch."+t.key+".",a=t.mediaObj,l={message:null,tip:null,title:null,text1:null,text2:null};for(var h in l)l[h]=e[i+h]?e.get(i+h):null,this._touchMode&&(l[h]=e[s+h]?e.get(s+h):l[h]);var c={key:t.key,message:l.message,tip:l.tip,title:l.title,text1:l.text1,text2:l.text2,gif:a&&a[i+"gif"]?o.getWebappsBaseUrl()+a[i+"gif"]:null};n.setHelp(c)}}});return t.namespace("DS/CAT3DWPanoply/CAT3DWActionCmd",h)});