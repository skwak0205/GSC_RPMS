define("DS/VCXWebComposer/VCXExperience",["DS/CoreEvents/Events","UWA/Class","DS/VCXWebKernelCommands/VCXCmdGoToScenario","DS/VCXWebKernelCommands/VCXCmdGoToScenarioWithInterpolation","DS/VCXWebDressup/VCXCmdChangeDressup","DS/VCXWebKernelCommands/VCXCmdChangeComponent","DS/VCXWebKernelCommands/VCXCmdChangeScenarioSequence","DS/VCXWebKernelCommands/VCXCmdReplaceScenario","DS/VCXWebProperties/VCXPropertyMap","DS/VCXWebProperties/VCXPropertyValueInt","DS/VCXWebProperties/VCXPropertyValueFloat","DS/VCXWebProperties/VCXPropertyValueString","DS/VCXWebKernelCommands/VCXCmdChangePropertiesAutokey","DS/VCXWebKernelCommands/VCXCmdChangeNeutralProperties","DS/VCXWebKernelTools/VCXFileServices","DS/WebappsUtils/WebappsUtils","DS/VCXWebKernelTools/VCXLogServices","DS/VCXKeyFramer/VCXScenario","DS/RuntimeView/NLSManager","DS/VCXWebVisualization/VCXPublishRasterImage","DS/VCXWebProperties/VCXPropertySet","DS/VCXWebKernelCommands/VCXCmdChangePropertiesVolatile"],function(e,t,n,a,r,i,o,s,c,p,C,l,g,u,M,d,V,h,m,X,S,f){"use strict";var _=t.extend({init:function(){this._endLoadingDone=!1,this._parent(),this._bPreviewMode=!1,this._viewMode=0,this.volatileNotSaved=!1},initialize:function(){this._endLoadingDone=!1;this._cpt=0,this._time=0,this._moy=0;var t=this;this.event_VCX_PROPERTIES_CHANGED=e.subscribe({event:"VCX_PROPERTIES_CHANGED"},function(e){var n=t._experienceBase.getManager("VCXScenarioManager");n&&!1===n.GetAutoKey()&&t.SetVolatileNotSaved(!0)}),this.event_VCX_SCENARIO_CHANGED=e.subscribe({event:"VCX_CURRENT_SCENARIO_CHANGED"},function(e){t._endLoadingDone&&e&&t._experienceBase.getManager("VCXContextManager").getExperienceIn3DPlay()&&"AnimationSmgID"===e._ID&&t._experienceBase.getManager("VCXAPIManager").PlayAnimation("AnimationSmgID")}),this.event_VCX_END_LOADING_DONE=e.subscribe({event:"VCX_END_LOADING_DONE"},function(e){t._endLoadingDone=!0}),this.event_VCX_UPDATE_THUMBNAIL=e.subscribe({event:"VCX_UPDATE_THUMBNAIL"},function(e){var n=t._experienceBase.getManager("VCXScenarioManager");if(n&&n.GetAutoKey()){var a=e&&e.scenarioID;if(a){var r=t._experienceBase.ComponentsMap.GetComponentFromID(a);r&&t.UpdateScenarioThumbnail(r)}}}),this.event_onViewpointEndMove=e.subscribe({event:"/VISU/"},function(e){if(e&&"@onViewpointEndMove"===e.eventType&&"controller"===e.from){var n=t._experienceBase.getManager("VCXScenarioManager");if(n&&n.GetCameraAutoKey()){var a=t._experienceBase.getManager("VCXContextManager").getActiveCamera(),r=a.QueryInterface("VCXIModifiable"),i=a.QueryInterface("VCXIViewpointController");if(i){var o=new S;i.fromViewpoint(o);var s=new c;s.AddOrModifyPropertySet(r.GetHashing(),o);var p=new g(n,t._experienceBase.getManager("VCXCommandManager"),!0);p.ChangePropertiesFromMap(s),t._experienceBase.getManager("VCXCommandManager").Push(p)}}}})},SetVolatileNotSaved:function(e){this.volatileNotSaved=e,this.volatileNotSaved},postInitialize:function(){if(this._viewer=this._experienceBase.getManager("VCXContextManager").getMainViewer(),!this._experienceBase.getManager("VCXContextManager")._UseOverrideSet&&null===this._viewer.getCurrentSceneGraphState()){var e=this._viewer.createSceneGraphState();this._viewer.setCurrentSceneGraphState(e)}this._viewer.setLightOnViewpoint(!0),this._viewer.setAutoUpdateLights(!0),this._loadingOption&&(this._loadingOption.quickLoad(this._experienceBase),this._loadingOption.HideVCXGUI()),this.InitDocumentProperties()},unInitialize:function(){this._endLoadingDone=!1,delete this._viewer,e.unsubscribe(this.event_VCX_PROPERTIES_CHANGED),delete this.event_VCX_PROPERTIES_CHANGED,e.unsubscribe(this.event_VCX_SCENARIO_CHANGED),delete this.event_VCX_SCENARIO_CHANGED,e.unsubscribe(this.event_VCX_END_LOADING_DONE),delete this.event_VCX_END_LOADING_DONE,e.unsubscribe(this.event_VCX_UPDATE_THUMBNAIL),delete this.event_VCX_UPDATE_THUMBNAIL,e.unsubscribe(this.event_onViewpointEndMove),delete this.event_onViewpointEndMove,this.debugTools&&(this.debugTools.unInitialize(),this.debugTools=null)},EndLoadingDressups:function(){V.memoryLog("VCXCmdChangeDressup",!0);var e=new r(this._experienceBase.getManager("VCXCommandManager"),this._experienceBase.getManager("VCXDressupManager"),this._experienceBase.getManager("VCXScenarioManager"),this._experienceBase.ComponentsMap);V.memoryLog("VCXCmdChangeDressup",!1);for(var t=this._experienceBase.ComponentsMap.GetComponentFromType("VCXDressup_Spec"),n=0;n<t.length;n++)e.AddDressups(t[n]);this._experienceBase.getManager("VCXCommandManager").Do(e),V.memoryLog("VCXDressupManager UpdateDressupList",!0),this._experienceBase.getManager("VCXDressupManager").UpdateDressupList(),V.memoryLog("VCXDressupManager UpdateDressupList",!1)},EndLoadingViewpoints:function(){this._viewer.displayPoints(!0);for(var e=this._viewer.getViewpoints(),t=0;t<e.length;t++)this._experienceBase.getManager("VCXContextManager").isSupported("DefaultViewpointControler")||(e[t].setDefaultController(!0,"SIMPLE"),e[t].getControl().setRotationRolling(!1)),e[t].reframe("iso",0),e[t].reframe(null,0)},GetViewer:function(){return this._viewer},RefreshGUI:function(){this._experienceBase.getManager("VCXGUIManager").RefreshGUI(),this._experienceBase.getManager("VCXPaperManager").updatePaper({propagateEvent:!0})},GoToScenario:function(e){this._experienceBase.getManager("VCXScenarioManager").SetCurrentScenario(e),this._experienceBase.getManager("VCXScenarioManager").RestoreNeutralProperties(),this._experienceBase.getManager("VCXScenarioManager").ApplyScenarioVisibility(e),this.SetFrameAndRefresh(0)},GoToNeutrals:function(){this._experienceBase.getManager("VCXScenarioManager").RestoreNeutralProperties(),this.SetFrameAndRefresh(0)},GoToScenarioWithInterpolation:function(t,r){var i=this,o=function(){var o=i._experienceBase.getManager("VCXScenarioManager"),s=o.GetScenarios()[t];if(!s)return console.log("SCENARIO NOT FOUND : "+t),void(r&&r());var c,p=!0;(0==o.GetTransitionTime()&&(p=!1),p)?((c=new a(o,i._experienceBase.ComponentsMap,i._experienceBase.getManager("VCXCommandManager"))).BuildTransitionTo(s),c.SetCallback(r),i._experienceBase.getManager("VCXCommandManager").Push(c)):(e.publish({event:"VCX_BEGIN_TRANSITION",data:{maxframe:10,scenario:s}}),(c=new n(o,i._experienceBase.getManager("VCXCommandManager"))).GoToScenario(t),i._experienceBase.getManager("VCXCommandManager").Push(c),e.publish({event:"VCX_END_TRANSITION"}))};this._experienceBase.getManager("VCXScenarioManager").GetIsPlayingCurrentScenario()&&(this._experienceBase.getManager("VCXContextManager").setAllViewerSensitive(!0),this._experienceBase.getManager("VCXScenarioManager").SetIsPlayingCurrentScenario(!1)),this._bPreviewMode&&this._experienceBase.getManager("VCXPulseManager")?this._experienceBase.getManager("VCXPulseManager").StopPulse(o):o()},SetFrameAndRefresh:function(e,t){this._FrameLastScenarioID===this._experienceBase.getManager("VCXScenarioManager").GetCurrentScenario()&&this._FrameLastRender===e||(this._FrameLastScenarioID=this._experienceBase.getManager("VCXScenarioManager").GetCurrentScenario(),this._FrameLastRender=e,this._experienceBase.getManager("VCXScenarioManager").SetCurrentFrame(e),this._experienceBase.getManager("VCXScenarioManager").UpdateProperties(),t||this._experienceBase.getManager("VCXContextManager").getMainViewer().render())},capturePixels:function(){var e=this._experienceBase,t=new X,n=[165,118],a=1.5*n[0],r=1.5*n[1];return t.doThumbnailToDataUrl(e,a,r)},CaptureScenarioWithThumbnail:function(e,t){var n,a;if(t){(n=this._experienceBase.Factory.BuildComponent("VCXScenario")).SetScenarioType(h.EScenarioType.Scenario),this._experienceBase.getManager("VCXContextManager").getCityMode()?n.GetVisibility().SetMode(2):n.GetVisibility().SetMode(1);var r=n.GetVisibility();r&&(r.Empty(),n.SetVisibility(r)),n.SetPersistency(0),n.SetApplyNeutralAtGoToScenario(!0),n.SetZoomFitAll(!0)}else{var i=this._experienceBase.getManager("VCXContextManager").getActiveCamera();i||console.log("No Camera, scenario does not capture viewpoint..");var o=null;if(i){o=i.QueryInterface("VCXIModifiable");var s=i.QueryInterface("VCXIViewpointController");s&&s.fromViewpoint();var c=this._experienceBase.getManager("VCXScenarioManager")._keyframer._Neutrals.GetPropertySet(o.GetHashing()),p=o.GetProperties();c&&Object.keys(c._map).equals(Object.keys(p._map))||this._experienceBase.getManager("VCXScenarioManager").AddNeutrals(o,p)}var C={bIsPartialView:!1,visibilityMode:1,scenarioType:h.EScenarioType.Scenario,persistency:0};this._experienceBase.getManager("VCXContextManager").getCityMode()&&(C.visibilityMode=2),n=this._experienceBase.getManager("VCXScenarioManager").CaptureCurrentView(C)}e?a=e:a="Scene "+(this._experienceBase.getManager("VCXScenarioManager")._maxIndex+1).toString();n.SetName(a);var g=n.QueryInterface("VCXIModifiable"),d=new u(this._experienceBase.getManager("VCXScenarioManager"));return d.CaptureNeutralProperties(g),d.Do(),this.capturePixels().then(e=>{var t=M.dataURLToBlob(e);if(t){var a=window.URL.createObjectURL(t),r=this._experienceBase.getManager("VCXDocManager").BuildPathFromString(a),i=new l;i.SetValue("thumbnail.jpg"),r.SetFileName(i);var o=this._experienceBase.getManager("VCXDocManager").AddOrModifyDoc(r,e);n.SetDocId(o.GetValue()),(d=new u(this._experienceBase.getManager("VCXScenarioManager"))).CaptureNeutralProperties(g),d.Do()}}).then(()=>n)},UpdateScenario:function(e){return this.CaptureScenarioWithThumbnail(e.GetName()).then(t=>{var n=new s(this._experienceBase.getManager("VCXScenarioManager"));n.ReplaceScenario(e,t),this._experienceBase.getManager("VCXCommandManager").Push(n),this._experienceBase.getManager("VCXGUIManager").deleteTimeline()})},UpdateScenarioThumbnail:function(t,n){if(t&&!this._experienceBase.getManager("VCXContextManager").getPlayerMode()&&this._endLoadingDone){var a=async()=>{if(!this.funcRefreshRunning&&this._experienceBase.isValid){this.funcRefreshRunning=!0;var n,a=this._experienceBase.getManager("VCXExperience"),r=this._experienceBase.getManager("VCXScenarioManager");await a.getAllActorsReadiness();try{if(this._UpdateScenarioThumbnailTimer&&window.clearTimeout(this._UpdateScenarioThumbnailTimer),this._UpdateScenarioThumbnailTimer=null,!this._experienceBase.isValid)throw new Error("Experience not valid anymore");if(console.log("updating thumbnail"),this._experienceBase.getManager("VCXContextManager").update(),!r.GetCameraAutoKey()){(g=this._experienceBase.getManager("VCXVisuManager"))&&(g.CameraControlsViewpoint=!0,g.CameraEasingTime=0),n=new f;for(var i=this._experienceBase.ComponentsMap.GetComponentFromType("CXPCameraActor_Spec"),o=0;o<i.length;o++){var s=new S;i[o].QueryInterface("VCXIViewpointController").fromViewpoint(s);var c=i[o].QueryInterface("VCXIModifiable");for(var p in s._map)if(s._map.hasOwnProperty(p)){var C=s.GetProperty(p);n.ChangeProperty(c,C)}r.UpdateProperties(c.GetHashing())}}let a=await this.capturePixels();var g;if(!r.GetCameraAutoKey())this._experienceBase.getManager("VCXCommandManager").Do(n),(g=this._experienceBase.getManager("VCXVisuManager"))&&(g.CameraControlsViewpoint=!1,g.CameraEasingTime=null);var u=M.dataURLToBlob(a);if(u){var d=this._experienceBase.getManager("VCXDocManager");d.RemoveDocument(t.GetDocId());var V=window.URL.createObjectURL(u),h=d.BuildPathFromString(V),m=new l;m.SetValue("thumbnail.jpg"),h.SetFileName(m);d.AddOrModifyDoc(h,a,t.GetDocId());e.publish({event:"VCX_SCENARIO_REPLACED",data:t})}}catch(e){console.error(e)}finally{this.funcRefreshRunning=!1}}};n?a():this._UpdateScenarioThumbnailTimer?(window.clearTimeout(this._UpdateScenarioThumbnailTimer),this._UpdateScenarioThumbnailTimer=null,this._UpdateScenarioThumbnailTimer=window.setTimeout(a,1e3)):this._UpdateScenarioThumbnailTimer=window.setTimeout(a,1e3)}},CreateNewScenario:function(e,t){return this.CaptureScenarioWithThumbnail("",t).then(t=>{for(var n="",a="",r=this._experienceBase.getManager("VCXSelectionManager").GetComponentsFromCurrentSelection(),i=0;i<r.length;i++){var s=r[i];s.IsKindOf("VCXScenarioSequence")||s.IsKindOf("VCXScenario")&&(a=s.GetID())}var c=new o(this._experienceBase.getManager("VCXSequenceManager"),this._experienceBase.getManager("VCXCommandManager"),this._experienceBase.ComponentsMap),p=this._experienceBase.getManager("VCXSequenceManager").GetSequenceFromScenarioId(a);if(p){var C=this._experienceBase.getManager("VCXSequenceManager").GetPreviousScenarioId(a);c.InsertScenarioInSequence(t,p.GetID(),C),{scenario:t,sequenceId:p.GetID(),prevIndex:p.GetIndexOfScenario(C)}}else{if(n=this._experienceBase.getManager("VCXGUIManager").GetActiveSequenceId());else{var l=this._experienceBase.getManager("VCXSequenceManager").GetListSequences();if(!l[0])return;n=l[0].GetID()}var g=this._experienceBase.getManager("VCXSequenceManager").GetSequenceFromId(n),u=this._experienceBase.getManager("VCXScenarioManager").GetCurrentScenario(),M=g.GetIndexOfScenario(u);c.InsertScenarioInSequence(t,n,M+1),{scenario:t,sequenceId:n,prevIndex:this._experienceBase.getManager("VCXSequenceManager").GetSequenceFromId(n).GetListScenariosId().length-1}}return e?this._experienceBase.getManager("VCXCommandManager").Do(c):this._experienceBase.getManager("VCXCommandManager").Push(c),this._experienceBase.getManager("VCXContextManager").renderAll(),t})},InitImagePanels:function(){if(console.log("InitImagePanels"),-1==this._experienceBase.getManager("VCXDocManager").GetDefaultImageIndex()){var t=this,n=d.getWebappsAssetUrl("VCXWebVisualization","texture/I_VCX_DefaultTexture.png"),a=new Image;a.crossOrigin="Anonymous",a.onload=function(){if(t._experienceBase.Factory){var n=document.createElement("CANVAS"),a=n.getContext("2d");n.height=this.height,n.width=this.width,a.drawImage(this,0,0);var r=n.toDataURL("image/png"),i=M.dataURLToBlob(r),o=window.URL.createObjectURL(i),s=t._experienceBase.getManager("VCXDocManager").BuildPathFromString(o,"I_VCX_DefaultTexture.png"),c=t._experienceBase.getManager("VCXDocManager").AddOrModifyDocInt(s);t._experienceBase.getManager("VCXDocManager").SetDefaultImageIndex(c),n=null,e.publish({event:"VCX_IMAGE_INIT_DONE"})}},a.src=n}},InitDocumentProperties:function(){var e=new u(this._experienceBase.getManager("VCXScenarioManager")),t=this._experienceBase.getManager("VCXScenarioManager").QueryInterface("VCXIModifiable");e.ChangeProperty(t,"ScenarioManager.FPS",new C(30)),e.ChangeProperty(t,"ScenarioManager.InterFramesMax",new p(10)),e.ChangeProperty(t,"ScenarioManager.startScenarioId",new l(""));this._experienceBase.getManager("VCXDocManager").QueryInterface("VCXIModifiable");var n=this._experienceBase.getManager("VCXCommandManager").QueryInterface("VCXIModifiable");e.ChangeProperty(n,"CommandManager.maxSize",new p(500)),this._experienceBase.getManager("VCXCommandManager").Do(e)},SetPreviewMode:function(t){this._bPreviewMode=t,e.publish({event:"VCX_PREVIEW_MODE_CHANGED",data:this._bPreviewMode})},GetPreviewMode:function(){return this._bPreviewMode},SetViewMode:function(e){this._viewMode=e},GetViewMode:function(){return this._viewMode},loadNLS:function(e){if(window.widget){var t=window.widget.lang;m.DEFAULT_LANGUAGE=t}this._experienceBase.odt&&(m.DEFAULT_LANGUAGE="en");for(var n=this._experienceBase.getManager("VCXNLSManager"),a=[],r=0;r<e.length;r++){var i=new UWA.Promise(function(t,n){m.onResourceLoaded({resourceFile:e[r]},function(){t({resourceKey:this._resourceKey,nlsManager:this})}),m.loadResource({resourceFile:e[r]})});i.then(function(e){n.AddNLS(e.resourceKey,e.nlsManager)}),a.push(i)}return UWA.Promise.allSettled(a)},_addManager:function(e,t,n,a,r){var i=this._experienceBase.Factory.BuildComponent(e);return i?(i.SetID(e+"ID"),i.SetPersistency(t),n.addManager(e,i,r),a.push(i),i):(console.error("Can't create manager "+e),null)},getAllActorsReadiness:async function(){let e=[];return this._experienceBase.ComponentsMap.GetComponentFromType("",!0).forEach(t=>{let n=t&&t.QueryInterface("VCXIReadiness");if(n){let t=n.isReady();t&&e.push(t)}}),e.length?(this.readinessPromise||(this.readinessPromise=UWA.Promise.deferred()),Promise.allSettled(e).then(()=>{this.getAllActorsReadiness()}),this.readinessPromise.promise):(this.readinessPromise&&(this.readinessPromise.resolve(),this.readinessPromise=null),!0)},addApplicationManagers:function(){var e=this._experienceBase.getManager("VCXContextManager").getCityMode(),t=this._experienceBase.getManager("VCXContextManager").getPlayerMode(),n=this._experienceBase.getManager("VCXContextManager").getProdHighMode(),a=this._experienceBase.getManager("VCXContextManager").getExperienceIn3DPlay(),r=this._experienceBase.getManager("VCXContextManager").getExperienceInConnectedPlayer(),o=[];(this._addManager("VCXNotificationManager",1,this._experienceBase._ManagerSet,o),this._addManager("VCXGUIManager",1,this._experienceBase._ManagerSet,o,6),this._addManager("VCXSelectionManager",1,this._experienceBase._ManagerSet,o),this._addManager("VCXSelectManager",2,this._experienceBase._ManagerSet,o),this._addManager("VCXMultiUserInputManager",1,this._experienceBase._ManagerSet,o),this._addManager("VCXMaterialManager",1,this._experienceBase._ManagerSet,o),this._addManager("VCXPaperManager",1,this._experienceBase._ManagerSet,o),this._addManager("VCXDressupManager",1,this._experienceBase._ManagerSet,o),this._addManager("VCXImageManager",1,this._experienceBase._ManagerSet,o),this._addManager("VCXHyperlinkManager",1,this._experienceBase._ManagerSet,o),this._addManager("VCXStylesManager",1,this._experienceBase._ManagerSet,o),this._experienceBase.getManager("VCXContextManager").isSupported("VCXIV")&&this._addManager("VCXIVManager",1,this._experienceBase._ManagerSet,o),this._addManager("VCXVisuManager",1,this._experienceBase._ManagerSet,o),this._addManager("VCXNLSManager",1,this._experienceBase._ManagerSet,o),this._addManager("VCXAPIManager",1,this._experienceBase._ManagerSet,o),this._addManager("VCXMarkerManager",1,this._experienceBase._ManagerSet,o),this._addManager("VCXDRMManager",1,this._ManagerSet,o),this._addManager("VCXPulseManager",1,this._experienceBase._ManagerSet,o).SetPreviewMode(this.GetPreviewMode()),this._addManager("VCXManipulatorManager",1,this._experienceBase._ManagerSet,o),this._experienceBase.getManager("VCXContextManager").getCat3DXIntegration()&&(this._addManager("VCXCAT3DXModelManager",1,this._experienceBase._ManagerSet,o,3),this._addManager("VCXPlatformServicesManager",1,this._experienceBase._ManagerSet,o),this._addManager("CAT3DXLinkManager",1,this._experienceBase._ManagerSet,o,2),this._addManager("CAT3DXLoaderManager",1,this._experienceBase._ManagerSet,o)),t||n)&&(this._addManager("VCXSectionManager",1,this._experienceBase._ManagerSet,o),this._addManager("VCXRobotAdapter",1,this._experienceBase._ManagerSet,o),this._addManager("VCXVolatileGhostingManager",1,this._experienceBase._ManagerSet,o).setKeepGhostCommand(!0),this._addManager("VCXQueryEngine",1,this._experienceBase._ManagerSet,o),this._addManager("VCXHotspotManager",1,this._experienceBase._ManagerSet,o),this._addManager("VCXSelectionSetManager",1,this._experienceBase._ManagerSet,o),this._experienceBase.getManager("VCXContextManager").setSupported("PartZoom"));this._addManager("VCXUserInputControllerManager",1,this._experienceBase._ManagerSet,o),!r&&a&&this._addManager("VCXComposerAPIManager",1,this._experienceBase._ManagerSet,o),(n||e)&&(this._addManager("VCXCanonicsManager",1,this._experienceBase._ManagerSet,o),this._addManager("VCXAnalyticsTrackerAppManager",1,this._experienceBase._ManagerSet,o),(void 0!==this._experienceBase.getManager("VCXContextManager").getUrlVars().debug||this._experienceBase.odt)&&(this._experienceBase.getManager("VCXContextManager").setSupported("Section"),this._experienceBase.getManager("VCXContextManager").setSupported("Paths")));var s=new i(this._experienceBase.getManager("VCXCommandManager"),this._experienceBase.ComponentsMap);return s.AddComponents(o),this._experienceBase.getManager("VCXCommandManager").Do(s),o}});return Object.defineProperty(_.prototype,"componentType",{enumerable:!0,get:function(){return"VCXExperience"}}),_}),define("DS/VCXWebComposer/VCXASensible",["UWA/Class"],function(e){"use strict";return e.extend({init:function(){},_getMeshesFromPathElement:function(e){var t=e.getLastElement(!0),n=[];if(t.excludeFromCSO)n.push(t);else{t.traverse(e=>(e.excludeFromCSO&&n.push(e),!1),!1)}return n},_setOrGetXSOAble:function(e,t,n){if("boolean"==typeof e)if("CSO"===t||"HSO"===t||"PSO"===t)if(e&&"boolean"!=typeof n)console.warn("A boolean is required as third argument for this method when first is defined as 'set'.");else{var a=this.GetObject().QueryInterface("W3AISGNodeHolder");if(a){for(var r=a.getPathElement(),i=this._getMeshesFromPathElement(r),o=null,s=0;s<i.length;++s){var c=i[s];if(e)"CSO"===t?c.excludeFromCSO(!n):"HSO"===t?c.excludeFromHSO(!n):c.excludeFromPSO(!n);else{var p=!("CSO"===t?c._excludeFromCSO:"HSO"===t?c._excludeFromHSO:c._excludeFromPSO);if(null===(o="boolean"!=typeof o?p:o===p?o:null))break}}return e?void 0:o}console.warn("Object do not possess a nodeHolder interface")}else console.log("Second argument should be one of the following : CSO | HSO | PSO");else console.log("First argument should be a boolean")},_setXSOAble:function(e,t){this._setOrGetXSOAble(!0,e,t)},_getXSOAble:function(e){return this._setOrGetXSOAble(!1,e)},setSelectable:function(e){this._setXSOAble("CSO",e)},setHighlightable:function(e){this._setXSOAble("HSO",e)},setPreHighlightable:function(e){this._setXSOAble("PSO",e)},getSelectable:function(){return this._getXSOAble("CSO")},getHighlightable:function(){return this._getXSOAble("HSO")},getPreHighlightable:function(){return this._getXSOAble("PSO")}})}),define("DS/VCXWebComposer/VCXISelectBehavior",["DS/WebComponentModeler/CATWebInterface"],function(e){"use strict";return e.singleton({interfaceName:"VCXISelectBehavior",required:{SetSelectMode:function(e){},GetSelectMode:function(){},GetListForSelection:function(){}},optional:{}})}),define("DS/VCXWebComposer/VCXISensible",["DS/WebComponentModeler/CATWebInterface"],function(e){"use strict";return e.singleton({interfaceName:"VCXISensible",required:{setSelectable:function(e){},setHighlightable:function(e){},setPreHighlightable:function(e){},getSelectable:function(){},getHighlightable:function(){},getPreHighlightable:function(){}},optional:{}})}),define("DS/VCXWebComposer/VCXUserInputControllerManager",["UWA/Core","DS/CoreEvents/Events","UWA/Class","DS/VisuEvents/EventsManager","DS/VCXWebModifiablesServices/VCXModifiablesAccess","DS/VCXWebModifiablesServices/VCXModifiablesServices"],function(e,t,n,a,r,i){"use strict";var o=n.extend({init:function(){},initialize:function(){this._lastFocusedElementType=null,this.dblClickToken=null,this.simpleClickToken=null,this.dressupEdition=null,this.deleteFunction=null},postInitialize:function(){var n=this;this._ApiCBDoubClick=null,this.dblClickToken=a.addEvent(this._experienceBase.getManager("VCXContextManager").getMainViewer().canvas,"onPrimaryPointerDoubleClick",function(e){n._onDblClkCanvasZoomFitEvent(e,n)}),this.simpleClickToken=a.addEvent(this._experienceBase.getManager("VCXContextManager").getFrameWindow().elements.container,"onPrimaryPointerClick",function(e){n._onClickUpdateFocusEvent(e,n)}),this.FinalizeDressupToken=t.subscribe({event:"FinalizeDressup"},function(){n._lastFocusedElementType="VCXDressup"}),this.SingleClickOpenEditorToken=t.subscribe({event:"VCX_SELECTION_COMPONENTSLIST_REMOVE"},function(e){var a=t.subscribe({event:"VCX_SELECTION_COMPONENTSLIST_ADD"},function(t){if(!n._experienceBase.getManager("VCXExperience").GetPreviewMode()&&e.includes(t[0])){var a=t[0].QueryInterface("VCXIManipulable");a&&a.isTextEditable()&&a.startEditInPlace()}});setTimeout(function(){t.unsubscribe(a)},250)}),this.onKeyDown=function(t){switch(e.Event.whichKey(t)){case"del":n.dressupEdition||n.deleteFunction(!0);break;case"shift+del":n.dressupEdition||n.deleteFunction(!1)}},document.addEventListener("keydown",this.onKeyDown)},RegisterDoubleClickCB:function(e){this._ApiCBDoubClick=e},_onDblClkCanvasZoomFitEvent:function(e,t){if(t._experienceBase.getManager("VCXContextManager").isSupported("PartZoom")&&!this._experienceBase.getManager("VCXContextManager").cmdIsRunning){var n=r.GetPathElementFromEvent(e,t._experienceBase),a=n&&r.GetModifiableFromPathElement(n,t._experienceBase);if(a)if(a.GetObject().IsDressup)return;var i=t._experienceBase.getManager("VCXContextManager").getMainViewer();if(i)if(n&&a){var o=n.getBoundingSphere(i);i.currentViewpoint.reframe(null,750,o),this._ApiCBDoubClick&&this._ApiCBDoubClick(a._object._ID)}else n||(i.currentViewpoint.reframe(null,750),this._ApiCBDoubClick&&this._ApiCBDoubClick(null))}},_onClickUpdateFocusEvent:function(e,t){var n=e.from[0].view.closest(".Content")&&e.from[0].view.closest(".Content").getAttribute("data-type");if("viewer"===n){var a=r.GetPathElementFromEvent(e,t._experienceBase),i=a&&r.GetModifiableFromPathElement(a,t._experienceBase);if(i){var o=i.GetObject().IsDressup,s=i.GetObject().IsMesh;o?t._lastFocusedElementType="VCXDressup":s?t._lastFocusedElementType="VCXProduct":console.warn("undeclared selection type or empty")}}else if("ui-frame-2d"===n){var c=e.from[0].view.closest(".vcx-scenarios-Wrapper")||e.from[0].view.closest(".vcx-scenarios-Header")||e.from[0].view.closest(".vcx-scenarios-Footer")||e.from[0].view.closest(".vcx-dressuptree-Wrapper")||e.from[0].view.closest(".vcx-dressuptree-Header")||e.from[0].view.closest(".vcx-dressuptree-Footer")||e.from[0].view.closest(".vcx-assemblytree-Wrapper")||e.from[0].view.closest(".vcx-assemblytree-Header")||e.from[0].view.closest(".vcx-assemblytree-Footer");c&&c.classList.forEach(function(e){e.includes("scenario")?t._lastFocusedElementType="VCXSequence":e.includes("dressup")?t._lastFocusedElementType="VCXDressup":e.includes("assembly")&&(t._lastFocusedElementType="VCXProduct")})}},ZoomFitSelection:function(e){var t=this._experienceBase.getManager("VCXContextManager").getMainViewer();if(t){var n=[];if(e.length>0)for(var a=0;a<e.length;++a){var r=this._experienceBase.ComponentsMap.GetComponentFromID(e[a]);r&&n.push(r)}else n=this._experienceBase.getManager("VCXSelectionManager").GetComponentsFromCurrentSelection();if(n&&0<n.length){var o=i.getBBoxInWorldFromComponents(n).getBoundingSphere();t.currentViewpoint.reframe(null,750,o)}else t.currentViewpoint.reframe(null,750)}},unInitialize:function(){a.removeEventFromToken(this.dblClickToken),this.dblClickToken=null,a.removeEventFromToken(this.simpleClickToken),this.simpleClickToken=null,t.unsubscribe(this.FinalizeDressupToken),this.FinalizeDressupToken=null,document.removeEventListener("keydown",this.onKeyDown),this.onKeyDown=null,t.unsubscribe(this.SingleClickOpenEditorToken),this.SingleClickOpenEditorToken=null,this._ApiCBDoubClick=null}});return Object.defineProperty(o.prototype,"componentType",{enumerable:!0,get:function(){return"VCXUserInputControllerManager"}}),o}),define("DS/VCXWebComposer/VCXBlobDumper",["UWA/Class","DS/VCXWebKernelTools/VCXFileServices"],function(e,t){"use strict";return e.extend({init:function(){this._mapDataB64={}},ConvertBlobsFromDocManager:function(e,t){this._mapDataB64={};var n={},a=e.getManager("VCXDocManager").GetDocMapClone();for(var r in a)if(a.hasOwnProperty(r)){var i=a[r];if(0===i.GetPathType().GetValue())i.GetValueURL().GetValue().indexOf("blob:")>=0&&(n[r]=i)}this.BlobsToB64(n,t)},BlobsToB64:function(e,n){var a=Object.keys(e).length;if(0!==a){var r=this,i=function(e,t){a--,e=e||"",r._mapDataB64[t]=e,0===a&&n()};for(var o in e)if(e.hasOwnProperty(o)){var s=e[o],c=s.GetValueURL().GetValue(),p=s.GetFileName().GetValue();t.BlobURLToBase64(c,p,i,o)}}else n()},GetMapOfData:function(){return this._mapDataB64}})}),define("DS/VCXWebComposer/VCXWebDictionary",[],function(){"use strict";var e={VCXExperience:{W3AIManager:"DS/WebApplicationBase/W3AAManager"},VCXActorDocManager:{VCXIModifiable:"DS/VCXWebKernel/VCXModifiableActorDocManager"},VCXComponentAssetOccurrenceComposer:{VCXIModifiable:"DS/VCXWeb3DMaster/VCXModifiableAssetOccurrenceComposer",VCXIModifiableView:"DS/VCXWeb3DMaster/VCXModifiableViewOccurrenceComposer",VCXITreeNode:"DS/VCXWebTreeExtensions/VCXTreeNodeOccurrence",VCXIPulseBehavior:"DS/VCXWebPulseManager/VCXPulseBehaviorOccurrence",VCXISensible:"DS/VCXWebComposer/VCXASensible",VCXIVisibility:"DS/VCXWebVisibilityImpl/VCXVisibilityOccurrence",VCXIModelNavigable:"DS/VCXWeb3DMaster/VCXNavigableAssetOccurrenceComposer",W3AISGNodeHolder:"DS/VCXWeb3DMaster/VCXSGNodeHolderAssetOccurrenceComposer"},VCXComponentOccurrenceComposer:{VCXIModifiable:"DS/VCXWeb3DMaster/VCXModifiableOccurrenceComposer",VCXIModifiableView:"DS/VCXWeb3DMaster/VCXModifiableViewOccurrenceComposer",VCXITreeNode:"DS/VCXWebTreeExtensions/VCXTreeNodeOccurrence",VCXIPulseBehavior:"DS/VCXWebPulseManager/VCXPulseBehaviorOccurrence",VCXISensible:"DS/VCXWebComposer/VCXASensible",VCXIVisibility:"DS/VCXWebVisibilityImpl/VCXVisibilityOccurrence",W3AISGNodeHolder:"DS/WebApplicationBase/W3AASGNodeHolder",VCXIModelNavigable:"DS/WebApplicationBase/VCXAModelNavigable",VCXIReadiness:"DS/WebApplicationBase/VCXAReadiness"},VCXComponentMarker:{VCXIModifiable:"DS/VCXWebKernel/VCXModifiableMarker",VCXIModifiableView:"DS/VCXWebModifiables/VCXModifiableView"},VCXComponentHotspot:{VCXIModifiable:"DS/VCXWebKernel/VCXModifiableHotspot",VCXIModifiableView:"DS/VCXWebKernel/VCXModifiableViewActorList",VCXITreeNode:"DS/VCXWebTreeExtensions/VCXTreeNodeOccurrence",VCXIModelNavigable:"DS/VCXWebKernel/VCXModelNavigableActorList"},VCXComponentSelectionSet:{VCXIModifiable:"DS/VCXWebKernel/VCXModifiableSelectionSet",VCXIModifiableView:"DS/VCXWebKernel/VCXModifiableViewActorList",VCXITreeNode:"DS/VCXWebTreeExtensions/VCXTreeNodeSelectionSet",VCXIModelNavigable:"DS/VCXWebKernel/VCXModelNavigableActorList",VCXISelectBehavior:"DS/VCXWebComposer/VCXASelectBehavior"},VCXComponentGroupSelectionSet:{VCXIModifiable:"DS/VCXWebKernel/VCXModifiableGroupActorList",VCXIModifiableView:"DS/VCXWebKernel/VCXModifiableViewActorList",VCXITreeNode:"DS/VCXWebTreeExtensions/VCXTreeNodeSelectionSet",VCXIModelNavigable:"DS/VCXWebKernel/VCXModelNavigableActorList",VCXISelectBehavior:"DS/VCXWebComposer/VCXASelectBehavior"},VCXComponentGroupHotspot:{VCXIModifiable:"DS/VCXWebKernel/VCXModifiableGroupActorList",VCXIModifiableView:"DS/VCXWebKernel/VCXModifiableViewActorList",VCXITreeNode:"DS/VCXWebTreeExtensions/VCXTreeNodeOccurrence",VCXIModelNavigable:"DS/VCXWebKernel/VCXModelNavigableActorList",VCXISelectBehavior:"DS/VCXWebComposer/VCXASelectBehavior"},VCXImageManager:{W3AIManager:"DS/WebApplicationBase/W3AAManager"},VCXGUIManager:{W3AIManager:"DS/WebApplicationBase/W3AAManager",VCXIModifiable:"DS/VCXWebGUI/VCXModifiableGUIManager"},VCXNotificationManager:{W3AIManager:"DS/WebApplicationBase/W3AAManager"},VCXSelectionManager:{W3AIManager:"DS/WebApplicationBase/W3AAManager",VCXIModifiable:"DS/VCXWebKernel/VCXModifiableSelectionManager"},VCXSelectManager:{W3AIManager:"DS/WebApplicationBase/W3AAManager"},VCXWebSelectionManager:{W3AIManager:"DS/WebApplicationBase/W3AAManager"},VCXMultiUserInputManager:{W3AIManager:"DS/WebApplicationBase/W3AAManager"},VCXMaterialManager:{W3AIManager:"DS/WebApplicationBase/W3AAManager"},VCXPaperManager:{W3AIManager:"DS/WebApplicationBase/W3AAManager"},VCXManipulatorManager:{W3AIManager:"DS/WebApplicationBase/W3AAManager"},VCXHyperlinkManager:{W3AIManager:"DS/WebApplicationBase/W3AAManager"},VCXStylesManager:{W3AIManager:"DS/WebApplicationBase/W3AAManager"},VCXComponentStyle:{VCXIModifiable:"DS/VCXWebStyles/VCXModifiableStyle",VCXIModifiableView:"DS/VCXWebModifiables/VCXModifiableView",VCXITreeNode:"DS/VCXWebTreeExtensions/VCXTreeNodeStyle"},VCXVisuManager:{W3AIManager:"DS/WebApplicationBase/W3AAManager",VCXIReadiness:"DS/WebApplicationBase/VCXAReadiness"},VCXDragDropManager:{W3AIManager:"DS/WebApplicationBase/W3AAManager"},VCXRobotAdapter:{W3AIManager:"DS/WebApplicationBase/W3AAManager"},VCXVolatileGhostingManager:{W3AIManager:"DS/WebApplicationBase/W3AAManager"},VCXNLSManager:{W3AIManager:"DS/WebApplicationBase/W3AAManager"},VCXQueryEngine:{W3AIManager:"DS/WebApplicationBase/W3AAManager"},VCXPulseManager:{W3AIManager:"DS/WebApplicationBase/W3AAManager"},VCXAPIManager:{W3AIManager:"DS/WebApplicationBase/W3AAManager"},VCXMarkerManager:{W3AIManager:"DS/WebApplicationBase/W3AAManager"},VCXHotspotManager:{W3AIManager:"DS/WebApplicationBase/W3AAManager"},VCXSelectionSetManager:{W3AIManager:"DS/WebApplicationBase/W3AAManager"},VCXDRMManager:{W3AIManager:"DS/WebApplicationBase/W3AAManager",VCXIModifiable:"DS/VCXWebKernel/VCXModifiableDRMManager",VCXIModifiableView:"DS/VCXWebModifiables/VCXModifiableView"},VCXCanonicsManager:{W3AIManager:"DS/WebApplicationBase/W3AAManager"},VCXAnalyticsTrackerAppManager:{W3AIManager:"DS/WebApplicationBase/W3AAManager"},VCXComposerAPIManager:{W3AIManager:"DS/WebApplicationBase/W3AAManager"},VCXUserInputControllerManager:{W3AIManager:"DS/WebApplicationBase/W3AAManager"}},t={W3AIManager:"DS/WebApplicationBase/W3AIManager",VCXITreeNode:"DS/VCXWebTreeGUI/VCXITreeNode",VCXISensible:"DS/VCXWebComposer/VCXISensible",VCXIPulseBehavior:"DS/VCXWebPulseManager/VCXIPulseBehavior",VCXIVisibility:"DS/VCXWebVisibility/VCXIVisibility",VCXIViewpointController:"DS/VCXWebVisualization/VCXIViewpointController",VCXISelectBehavior:"DS/VCXWebComposer/VCXISelectBehavior",VCXIContextualContent:"DS/VCXWebKernel/VCXIContextualContent",VCXIModifiableFormatPainter:"DS/VCXWebModifiables/VCXIModifiableFormatPainter",VCXIReadiness:"DS/WebApplicationBase/VCXIReadiness"},n={VCXActorDocManager:"DS/VCXWebKernel/VCXActorDocManager",VCXComponentOccurrenceComposer:"DS/VCXWeb3DMaster/VCXComponentOccurrenceComposer",VCXComponentAssetOccurrenceComposer:"DS/VCXWeb3DMaster/VCXComponentAssetOccurrenceComposer",VCXComponentMarker:"DS/VCXWebKernel/VCXComponentMarker",VCXComponentHotspot:"DS/VCXWebKernel/VCXComponentHotspot",VCXComponentSelectionSet:"DS/VCXWebKernel/VCXComponentSelectionSet",VCXComponentGroupHotspot:"DS/VCXWebKernel/VCXComponentGroupHotspot",VCXComponentGroupSelectionSet:"DS/VCXWebKernel/VCXComponentGroupSelectionSet",VCXExperience:"DS/VCXWebComposer/VCXExperience",VCXImageManager:"DS/VCXWebVisualization/VCXImageManager",VCXPaperManager:"DS/VCXWebVisualization/VCXPaperManager",VCXManipulatorManager:"DS/VCXWebVisualization/VCXManipulatorManager",VCXHyperlinkManager:"DS/VCXWebComposer/VCXHyperlinkManager",VCXHyperlinkManagerBase:"DS/VCXWebExperienceBase/VCXHyperlinkManagerBase",VCXStylesManager:"DS/VCXWebStyles/VCXStylesManager",VCXComponentStyle:"DS/VCXWebStyles/VCXComponentStyle",VCXSelectionManager:"DS/VCXWebKernel/VCXSelectionManager",VCXSelectManager:"DS/VCXWebKernel/VCXSelectManager",VCXWebSelectionManager:"DS/VCXWebKernel/VCXWebSelectionManager",VCXMultiUserInputManager:"DS/VCXWebKernel/VCXMultiUserInputManager",VCXMaterialManager:"DS/VCXWebVisualization/VCXMaterialManager",VCXCanonicsManager:"DS/VCXWebCanonics/VCXCanonicsManager",VCXAnalyticsTrackerAppManager:"DS/VCXWebKernelTools/VCXAnalyticsTrackerAppManager",VCXVisuManager:"DS/VCXWebVisualization/VCXVisuManager",VCXDragDropManager:"DS/VCXWebComposer/VCXDragDropManager",VCXRobotAdapter:"DS/VCXWebVisualization/VCXRobotAdapter",VCXVolatileGhostingManager:"DS/VCXWebVolatileGhosting/VCXVolatileGhostingManager",VCXNLSManager:"DS/VCXWebExperienceBase/VCXNLSManager",VCXQueryEngine:"DS/VCXWebQueryEngine/VCXQueryEngine",VCXPulseManager:"DS/VCXWebPulseManager/VCXPulseManager",VCXHotspotManager:"DS/VCXWebComposer/VCXHotspotManager",VCXSelectionSetManager:"DS/VCXWebComposer/VCXSelectionSetManager",VCXAPIManager:"DS/VCXWebKernel/VCXAPIManager",VCXDRMManager:"DS/VCXWebKernel/VCXDRMManager",VCXNotificationManager:"DS/VCXWebKernel/VCXNotificationManager",VCXMarkerManager:"DS/VCXWebKernel/VCXMarkerManager",VCXComposerAPIManager:"DS/VCXWebKernel/VCXComposerAPIManager",VCXUserInputControllerManager:"DS/VCXWebComposer/VCXUserInputControllerManager",VCXGUIManager:"DS/VCXWebGUI/VCXGUIManager"},a=["VCXWebComposer/VCXWebComposer","VCXWebVolatileGhosting/VCXWebVolatileGhosting","VCXWebModifiables/VCXWebModifiables","VCXWebUnits/VCXWebUnits","VCXWebSequenceManager/VCXWebSequenceManager","VCXWebScenarioManager/VCXWebScenarioManager","VCXWebPulseManager/VCXWebPulseManager","VCXWebProducts/VCXWebProducts","VCXWebGUI/VCXWebGUI","VCXWebGUICommands/VCXWebGUICommands","VCXWebTreeGUI/VCXWebTreeGUI","VCXWebLevelExploderGUI/VCXWebLevelExploderGUI","VCXWebVisualization/VCXWebVisualization","VCXWebTimeline/VCXWebTimeline"];return{GetDictionary:function(){return{interfaces:t,components:n,extensions:e}},getNLSModules:function(){return a}}}),define("DS/VCXWebComposer/VCXASelectBehavior",["UWA/Class"],function(e){"use strict";return e.extend({init:function(){this._selectMode=0},GetSelectMode:function(){return this._selectMode},SetSelectMode:function(e){this._selectMode=e},GetListForSelection:function(){var e=[],t=this.GetObject();if(0===this._selectMode)e.push(t);else if(null!==this._selectMode&&void 0!==this._selectMode){var n=t.QueryInterface("VCXIModelNavigable");if(n)for(var a=n.getChildren(),r=0;r<a.length;r++){var i=a[r];if(i){var o=i.GetObject();e.push(o)}}1===this._selectMode||2===this._selectMode&&e.push(t)}return e}})}),define("DS/VCXWebComposer/VCXExperienceLoader",["UWA/Utils","DS/CoreEvents/Events","DS/VCXWebExperienceLoader/VCXExperienceLoaderBase","DS/VCXWebKernelCommands/VCXCmdChangeSequence","DS/VCXWebKernelTools/VCXFileServices","DS/VCXWebKernelCommands/VCXCmdChangeNeutralProperties","DS/VCXWebKernelCommands/VCXCmdGoToScenario"],function(e,t,n,a,r,i,o){"use strict";return n.extend({InitLoader:function(e){this._parent(e.experienceBase),this._options=e},Load:function(e){if(e){this.InitLoader(e);var n=this._experienceBase.getManager("VCXContextManager");n.setSupported("3DSync",!1),n.setSupported("UseTraverseGraph",!1),n.useTraverseGraph=!1,n.setSupported("Cat3DXIntegration",!1),n._rootInfos={componentType:"VCXComponentOccurrenceComposer",productType:"Reference3D",name:"Experience",id:"VCX_Root"};n.getRootComponent();if(this._experienceBase.getManager("VCXGUIManager").InitGUI(),t.subscribe({event:"VCX_ASSET_LOADED"},t=>{e=null,this.on3dxmlLoaded(this,t)}),this._experienceBase._mapAssetsBlob=e.mapAssets,e.jsonFile)this.LoadJSON(()=>{var t=this._experienceBase.ComponentsMap.GetComponentFromType("VCXComponentAssetOccurrenceComposer");this._numOfAsset=t.length,this._experienceBase.getManager("VCXScenarioManager").RestoreNeutralProperties();var n=this._experienceBase.getManager("VCXContextManager");n.getCityMode()||n.getProdHighMode()&&n.getCat3DXIntegration()?this.EndLoadJSON(e.endCB):e.endCB("json")});else if(this._arrayAssets=[],e.urb?this._bIsCityLoading=!0:this._bIsCADLoading=!0,e.mapAssets){var a=e.mapAssets;for(var r in this._numOfAsset=Object.keys(a).length,a)if(a.hasOwnProperty(r)){var i=this.CreateAsset(r);this._arrayAssets.push(i);var o=i.QueryInterface("VCXIModifiable");o&&this._experienceBase.getManager("VCXScenarioManager").RestoreNeutralPropertiesOneModifiable(o.GetHashing())}this._experienceBase.getManager("VCXScenarioManager").UpdateProperties()}}else console.error("Have to use iOptions")},CreateAsset:function(t){var n="VCXComponentAssetOccurrenceComposer",a=0,r=t.split(".")[1];"3dxml"===r||("smggeom"===r.toLowerCase()?a=1:"urb"!==r.toLowerCase()&&"ctxp"!==r.toLowerCase()||(a=2,n="CIDComponentAsset"));var o=this._experienceBase.Factory.BuildComponent(n);if(o){this._experienceBase.ComponentsMap.AddComponent(o),o.SetAssetID(t);var s=t.split(".")[0]+"-"+e.getUUID().substr(0,18);o.SetNodeID(s),o.SetAssetType(a);var c=this._experienceBase.getManager("VCXContextManager").getRootComponent().QueryInterface("VCXIModelNavigable");o.QueryInterface("VCXIModelNavigable").setParent(c);var p=o.QueryInterface("VCXIModifiable"),C=new i(this._experienceBase.getManager("VCXScenarioManager"));return C.CaptureNeutralProperties(p),C.Do(),o}console.error("Can't create component")},BuildComponentsFromAssetsCityMode:function(e){this._experienceBase.getManager("CityUrbanManager").TraverseDataModel()},BuildComponentsFromAssets:function(e){for(let t=0;t<e.length;t++){var n=e[t],a=n.QueryInterface("W3AISGNodeHolder"),r=a.getSGNode(),o=a.getPathElement(),s=n.QueryInterface("VCXIModelNavigable"),c={attributeToUse:"productType",componentTypeForRootNode:"VCXComponentOccurrenceComposer",Instance3D:"VCXComponentOccurrenceComposer",Reference3D:null,InstanceRep:"VCXComponentMesh",defaultType:null,componentTypeFromFunction:function(e){if(!e)return null;var t=null;switch(e.productType){case"Instance3D":var n=e.getChildren();if(!n||!n.length)return null;for(let e=0;e<n.length;e++)if("InstanceRep"===n[e].productType)return"VCXComponentMesh";if(n[0]&&n[0].children&&n[0].children[0]&&"InstanceRep"===n[0].children[0].productType)return"VCXComponentMesh";t="VCXComponentOccurrenceComposer";break;default:console.log("Unknown DS type")}return t}};this._experienceBase.BuildComponentsFromNodeEXT(r,o,s,c)}for(var p=new i(this._experienceBase.getManager("VCXScenarioManager")),C=this._experienceBase.ComponentsMap.GetComponentFromType("VCXComponentOccurrenceComposer"),l=0;l<C.length;l++){var g=C[l];if(g){var u=g.QueryInterface("VCXIModifiable");u&&p.ChangeProperty(u,"Actor.Name",u.GetProperty("Actor.Name").GetPropertyValue())}}this._experienceBase.getManager("VCXCommandManager").Do(p),t.publish({event:"VCX_ASSETS_ADDED",data:e})},on3dxmlLoaded:function(e,n){if(e._experienceBase.getManager("VCXPaperManager").updatePaper({x:1896,y:798}),e._numOfAsset--,0===e._numOfAsset){if(delete this._experienceBase._mapAssetsBlob,e._bIsCADLoading){if(e.BuildComponentsFromAssets(e._arrayAssets),0===e._experienceBase.ComponentsMap.GetComponentFromType("CXPCameraActor_Spec").length){var r=e._experienceBase.Factory.BuildComponent("CXPCameraActor_Spec");r.SetID("CameraActorId"),e._experienceBase.ComponentsMap.AddComponent(r)}if(0===e._experienceBase.ComponentsMap.GetComponentFromType("VCXViewport_Spec").length){var o=e._experienceBase.Factory.BuildComponent("VCXViewport_Spec");o.SetID("ViewportActorId"),e._experienceBase.ComponentsMap.AddComponent(o)}if(0===e._experienceBase.ComponentsMap.GetComponentFromType("VCXComponentGround").length){var s=e._experienceBase.Factory.BuildComponent("VCXComponentGround");s&&(s.SetID("GroundActorId"),e._experienceBase.ComponentsMap.AddComponent(s))}if(0===e._experienceBase.getManager("VCXSequenceManager").GetListSequencesFromType(0).length){var c=e._experienceBase.Factory.BuildComponent("VCXScenarioSequence");c.SetName("Sequence 1");var p=c.QueryInterface("VCXIModifiable"),C=new i(e._experienceBase.getManager("VCXScenarioManager"));C.CaptureNeutralProperties(p),e._experienceBase.getManager("VCXCommandManager").Do(C);var l=new a(e._experienceBase.getManager("VCXSequenceManager"),e._experienceBase.getManager("VCXCommandManager"),this._experienceBase.ComponentsMap);l.PushSequence(c),e._experienceBase.getManager("VCXCommandManager").Do(l)}e._experienceBase.getManager("VCXExperience").EndLoadingDressups(),e._experienceBase.getManager("VCXGUIManager").RefreshGUI(),e._experienceBase.getManager("VCXGUIManager").setUpTrees(),t.publish({event:"VCX_END_LOADING_DONE"})}else if(e._bIsCityLoading);else{for(var g=e._experienceBase.ComponentsMap.GetComponentFromType("VCXComponentOccurrenceComposer"),u=0;u<g.length;u++){var M=g[u];M&&M.SetIsMesh(!0)}e.EndLoadJSON()}var d=e._options.endCB;void 0!==d&&d("3dxml")}e._options=null,e._experienceBase=null,e._factory=null,e._scenarioManager=null,e._ComponentsMap=null,e._arrayAssets=null},LoadJSON:function(e){var t=new FileReader;t.onload=(()=>{this.filevarJson=JSON.parse(t.result);var n=this._experienceBase.getManager("VCXScenarioManager");n.SetCurrentFrame(0),n.SetDefaultInterpolator("Actor.Hyperlink",0),n.SetDefaultInterpolator("Collab.Image.Doc.ID",0),this.LoadComponents(this.filevarJson.VCXObjects).done(()=>{this.LoadVCXIModelNavigable(this.filevarJson.VCXIModelNavigable),this.LoadMetaPropertiesDef(this.filevarJson.MetaPropertiesDef),this.LoadPropertiesLinks(this.filevarJson.PropertiesLinks),this.LoadNeutrals(this.filevarJson.neutrals),this._experienceBase.getManager("VCXContextManager").getCityMode()?this.ResolveCityExternalAssetsHolder(this.filevarJson.VCXAssetsHolder,e):this.ResolveProductAssetsHolder(this.filevarJson.VCXAssetsHolder,e)})}),t.readAsText(this._options.jsonFile)},LoadComponents:function(e,t){var n=[];if(this._experienceBase.getManager("VCXContextManager").getCat3DXIntegration()){if(e)for(var a=0;a<e.length;a++){var r=e[a].objectID,i=e[a].objectType,o=this._factory.BuildComponent(i);if(o){o.SetID(r),this._ComponentsMap.AddComponent(o);var s=e[a].objectData;s&&o.SetLoadData(s)}else n.push({objectType:i,objectID:r})}return this.BuilComponentsAsync(n)}return this._parent(e),UWA.Promise.resolve()},BuilComponentsAsync:function(e){for(var t=this._experienceBase.getManager("VCXCAT3DXModelManager").GetCAT3DXModel(),n=[],a=0;a<e.length;a++){var r=e[a],i=r.objectType,o=r.objectID;n.push(t.getFactory().BuildComponent(i,o))}return UWA.Promise.all(n)},ResolveProductAssetsHolder:function(e,t){var n=[];if(e){this._experienceBase.getManager("VCXContextManager").getRootNode();for(var a=0;a<e.length;a++){var r=e[a].objectID,i=this._reformatObjectIDForPathOfId(r),o=this._ComponentsMap.GetComponentFromID(i);if(o&&(o.IsKindOf("Model_VPMReference_Spec")||o.IsKindOf("VCXComponentVPMReference"))){o.QueryInterface("W3AISGNodeHolder").getSGNode();var s=e[a].linkDescription;o.QueryInterface("CATI3DXAssetHolder").setLinkDescription(s),s&&n.push(this._experienceBase.getManager("VCXCAT3DXModelManager").LoadProduct(o,!1))}}}UWA.Promise.all(n).done(()=>{t&&t()})},ResolveCityExternalAssetsHolder:function(e,t){if(e)for(var n=0;n<e.length;n++){var a=e[n].objectID,r=this._reformatObjectIDForPathOfId(a),i=this._ComponentsMap.GetComponentFromID(r);if(i)if(i.IsKindOf("CIDAsset_Spec"))if(this._experienceBase.getManager("CityUrbanManager")){var o=i.QueryInterface("CATI3DXAssetHolder"),s=e[n].linkDescription;o.setLinkDescription(s),i.SetAssetID(s);var c=e[n].linkContextDescription;if(c){var p=this._experienceBase.getManager("CAT3DXLinkManager").getLinkContextFromJSONDescription(c);o.setLinkContext(p),o.resolveAsset().done(e=>{e&&this._experienceBase.getManager("CityUrbanManager").LoadModel(e,()=>{this.LoadVCXAssetsHolder(this.filevarJson.VCXAssetsHolder).done(()=>{t&&t()}),this._experienceBase.getManager("VCXGUIManager").getGettingStartedUI().endLoadingExperience()})})}}}},LoadVCXAssetsHolder:function(e){if(!this._experienceBase.getManager("VCXContextManager").getCat3DXIntegration())return UWA.Promise.resolve();if(e){var t=[];for(var n in e)if(e.hasOwnProperty(n)){var a=e[n].objectID,r=this._reformatObjectIDForPathOfId(a),i=this._ComponentsMap.GetComponentFromID(r);if(i){var o=i.QueryInterface("CATI3DXAssetHolder");if(o){var s=e[n].linkDescription;s&&(o.setLinkDescription(s),t.push(o.resolveAsset()))}}}return UWA.Promise.all(t)}},EndLoadJSON:function(e){this._experienceBase.getManager("VCXContextManager").getMainViewer().getRootNode();if(this.LoadW3AISGNodeHolder(this.filevarJson.W3AISGNodeHolder),this.LoadScenarios(this.filevarJson.listScenarios),this.filevarJson.DocManager){var n=this.filevarJson.DocManager.array;if(n&&0!==n.length)for(var a=0;a<n.length;a++){var i=n[a],s=i.type,c=i.value,p=i.docID,C=this.BuildVCXPropertyValue(s,c);null!==C&&this._experienceBase.getManager("VCXDocManager").AddOrModifyDoc(C,void 0,p,!1)}}var l=this.filevarJson.EmbeddedData;if(l&&0!==l.length)for(var g in l)if(l.hasOwnProperty(g)){var u=this._experienceBase.getManager("VCXDocManager").GetPropPath(g);if(u){var M=l[g];if(""!==M){var d=r.dataURLToBlob(M),V=window.URL.createObjectURL(d);console.log(g+":"+V),u.GetValueURL().SetValue(V)}}else console.log("unable to get propPath of "+g)}var h=this.filevarJson.ScenarioSequences;this.LoadScenarioSequences(h);var m=this._experienceBase.getManager("VCXContextManager");if(m.getCityMode()){var X=m.getRootComponent(),S=this._experienceBase.getManager("VCXCAT3DXModelManager");S.TraverseNavigableToVariable(X),S.OnEndLoading(!1).done(()=>{e()})}else if(m.getProdHighMode()&&m.getCat3DXIntegration())this._experienceBase.getManager("VCXCAT3DXModelManager").OnEndLoading(!1).done(()=>{e()});else{if(0===this._experienceBase.ComponentsMap.GetComponentFromType("CXPCameraActor_Spec").length){var f=this._experienceBase.Factory.BuildComponent("CXPCameraActor_Spec");f.SetID("CameraActorId"),this._experienceBase.ComponentsMap.AddComponent(f)}if(0===this._experienceBase.ComponentsMap.GetComponentFromType("VCXViewport_Spec").length){var _=this._experienceBase.Factory.BuildComponent("VCXViewport_Spec");_.SetID("ViewportActorId"),this._experienceBase.ComponentsMap.AddComponent(_)}if(0===this._experienceBase.ComponentsMap.GetComponentFromType("VCXComponentGround").length){var v=this._experienceBase.Factory.BuildComponent("VCXComponentGround");v&&(v.SetID("GroundActorId"),this._experienceBase.ComponentsMap.AddComponent(v))}this._experienceBase.getManager("VCXExperience").EndLoadingDressups(),this._experienceBase.getManager("VCXGUIManager").RefreshGUI(),this._experienceBase.getManager("VCXGUIManager").setUpTrees();var b;b=(h=this._experienceBase.getManager("VCXSequenceManager").GetListSequences())[0].GetListScenariosId()[0];var D=new o(this._experienceBase.getManager("VCXScenarioManager"),this._experienceBase.getManager("VCXCommandManager"));D.GoToScenario(b),this._experienceBase.getManager("VCXCommandManager").Do(D),this._experienceBase.getManager("VCXScenarioManager").SetAutoKey(!0),t.publish({event:"VCX_END_LOADING_DONE"})}}})}),define("DS/VCXWebComposer/VCXWebActorListManager",["DS/VCXWebKernelCommands/VCXCmdChangePropertiesAutokey","DS/VCXWebProperties/VCXPropertyValueLink","UWA/Class"],function(e,t,n){"use strict";var a=n.extend({initialize:function(){},postInitialize:function(){},unInitialize:function(){},disposeComponentsActorListFromType:function(e){for(var t=this._experienceBase.ComponentsMap.GetComponentFromType(e),n=0;n<t.length;++n){var a=t[n];a&&a.CallDispose()}},associateComponentAndActorListToMapCache:function(e,t){var n=e.GetID(),a=this.getComponentsActorListMapCache();if(a){a[n]||(a[n]={});var r=t.GetID();a[n][r]||(a[n][r]=t)}},dissociateComponentAndActorListFromMapCache:function(e,t){var n=e.GetID(),a=this.getComponentsActorListMapCache();if(a&&a[n])if(t){var r=t.GetID();a[n][r]&&(delete a[n][r],0===Object.keys(a[n]).length&&delete a[n])}else delete a[n]},addActorsListToComponentActorList:function(n,a){for(var r="",i=(a.GetID(),a.QueryInterface("VCXIModifiable")),o=i.GetProperty("Actor.ListActors"),s=o.GetPropertyValue().GetValue(),c=[],p=0;p<s.length;++p){var C=s[p];c.push(C.Value)}for(var l=[],g=0;g<n.length;++g){r=n[g].GetID();c.indexOf(r)<0&&l.push(r)}if(l.length>0){for(var u=0;u<l.length;++u){r=l[u];var M=new t;M.SetValue(r),s.push(M),this.associateComponentAndActorListToMapCache(r,hotspotID)}var d=o.Clone();d.GetPropertyValue().SetValue(s);var V=this._experienceBase.getManager("VCXScenarioManager"),h=this._experienceBase.getManager("VCXCommandManager"),m=new e(V,h);return m.ChangeProperty(i,d),h.Push(m),!0}return!1},removeActorsListFromComponentActorList:function(t,n){n.GetID();for(var a=n.QueryInterface("VCXIModifiable"),r=a.GetProperty("Actor.ListActors"),i=r.GetPropertyValue().GetValue(),o=[],s=0;s<i.length;++s){var c=i[s];o.push(c.Value)}for(var p=0,C=0;C<t.length;++C){var l=t[C],g=l.GetID(),u=o.indexOf(g);-1!==u&&(i[u]=null,this.dissociateComponentAndActorListFromMapCache(l,n),++p)}if(p>0){var M=i.filter(function(e){return null!==e}),d=r.Clone();d.GetPropertyValue().SetValue(M);var V=this._experienceBase.getManager("VCXScenarioManager"),h=this._experienceBase.getManager("VCXCommandManager"),m=new e(V,h);return m.ChangeProperty(a,d),h.Push(m),!0}return!1},removeActorsListFromAllComponentsActorListOfAKind:function(e,t){for(var n=[],a=(this.getComponentsActorListMapCache(),this._experienceBase.ComponentsMap.GetComponentFromType(t)),r=0;r<a.length;++r){var i=a[r];this.removeActorsListFromComponentActorList(e,i)&&n.push(i)}return n},isComponentBelongingToMapCache:function(e){var t=this.getComponentsActorListMapCache();if(t)return!!t[e.GetID()]},getListOfComponentActorListOwningComponent:function(e){var t=[],n=this.getComponentsActorListMapCache();if(n){var a=e.GetID();if(n[a])for(var r=Object.keys(n[a]);0<r;++r){var i=r[0];n[a][i]&&t.push(n[a][i])}return t}}});return Object.defineProperty(a.prototype,"componentType",{enumerable:!0,get:function(){return"VCXWebActorListManager"}}),a}),define("DS/VCXWebComposer/VCXUIHyperlink",["UWA/Class","DS/VisuEvents/EventsManager","UWA/Controls/Lightbox","DS/UIBehaviors/ContextualMenuManager","DS/VCXWebKernelTools/VCXFileWriter","DS/VCXWebModifiablesServices/VCXModifiablesAccess","DS/VCXWebModifiablesServices/VCXModifiablesServices","DS/VCXWebKernelTools/VCXFileServices"],function(e,t,n,a,r,i,o,s){"use strict";return e.extend({init:function(e){var n=this;this._experienceBase=e,this._vcxGuiManager=e.getManager("VCXGUIManager"),this._cursorStyle=document.body.style.cursor,this.onVisuEventMouse=function(e){if(n._experienceBase.getManager("VCXExperience").GetPreviewMode()){var t=n._experienceBase.getManager("VCXHyperlinkManager");if(t&&t.GetActiveInteraction()){for(var a=!1,r=t.GetSortedInteractableObjects(),s=0;s<r.length;s++){var c=n._experienceBase.ComponentsMap.GetComponentFromID(r[s]).QueryInterface("VCXIModifiable"),p=o.getDisplayPriority(c);if(p<-7)break;if(p<=6||p>=10){a=!0;break}if(o.isModifiableUnderMouse(c,e))return void n.onChangeMouseStyle(c)}if(a)if(c=i.GetModifiableFromEvent(e,n._experienceBase))return void n.onChangeMouseStyle(c)}}n.onChangeMouseStyle(null)};var a=this._experienceBase.getManager("VCXContextManager").getMainViewer().canvas;t.addEvent(a,"onPrimaryPointerMoveUnique",this.onVisuEventMouse)},UnsubscribeEvent:function(){t.removeEvent(this._experienceBase.getManager("VCXContextManager").getMainViewer().canvas,"onPrimaryPointerMoveUnique",this.onVisuEventMouse)},onChangeMouseStyle:function(e){var t=!1;if(e){var n=null,a=e.GetObject().GetID(),r=null;if(this._experienceBase.getManager("VCXHotspotManager")&&(r=this._experienceBase.getManager("VCXHotspotManager").GetEnabledHotspotFromComponentID(a,!0)),r){n=r.QueryInterface("VCXIModifiable").GetProperty("Actor.Hyperlink").GetPropertyValue().GetValue()}else{var i=e.GetProperty("Actor.Hyperlink").GetPropertyValue().GetValue();n=parseInt(i,10)}n>=0&&(t=!0)}var o=this._experienceBase.getManager("VCXExperience").GetPreviewMode();t&&o?(this._oldCursor=this._vcxGuiManager.GetCursor(),this._vcxGuiManager.SetCursor("pointer")):this._oldCursor&&(this._vcxGuiManager.SetCursor(this._oldCursor),this._oldCursor=null)},CreateMediaDiv:function(e,t){var n=this;s.BlobURLToBase64(e,t,function(a){a.indexOf("data:image")>-1?n.OpenImage(e,t):a.indexOf("data:application/octet-stream")>-1?(new r).saveAs(a,t):window.open(e,"Download")})},OpenImage:function(e,t){var n=this;s.getImageSizeFromBlobUrl(e,function(r){var i=n.CreateDiv(e,t,r);i.styles.width=r.width,i.styles.height=r.height,n._myMedia=UWA.createElement("img",{id:i.id,title:i.title,src:i.src,styles:i.styles}),a.onReady({target:n._myMedia,nodes:i.nodes}),n._myMedia.addEventListener("click",function(e){e.stopPropagation&&e.stopPropagation()}),n._lightbox.addContent(n._myMedia)})},CreateDiv:function(e,t,a){var r=this._vcxGuiManager._uiLayer;this._lightbox=new n,this._lightbox.inject(r),this._lightbox.getInnerElement().style.zIndex="15",this._lightbox.open();var i=this;return{id:"myMedia",title:"Click right to save",src:e,styles:{position:"absolute",left:"50%",bottom:"50%",color:"#888888",width:a.width+"px",height:a.height+"px",marginLeft:-.5*a.width+"px",marginBottom:-.5*a.height+"px",zIndex:"15"},nodes:[{label:"Save  as...",callback:function(){i.LaunchContextMenu(0,e,t)}},{label:"Open  in new tab...",callback:function(){i.LaunchContextMenu(1,e,t)}}]}},LaunchContextMenu:function(e,t,n){0===e?(new r).saveAs(t,n):1===e&&window.open(t)}})}),define("DS/VCXWebComposer/VCXDragDropManager",["UWA/Class","DS/VCXWebExperienceBase/VCXContextManager","DS/DataDragAndDrop/DataDragAndDrop","DS/Controls/Loader","DS/VCXWebComposer/VCXExperienceLoader","DS/VCXWebKernelTools/VCXMimeTypeServices","DS/ApplicationFrame/CommandsManager"],function(e,t,n,a,r,i,o){"use strict";var s=e.extend({getProgressBar:function(){var e=new a({text:"Preparing..."});return e.inject(widget.body),e.getContent().setStyles({margin:"auto",position:"absolute",top:"110px",left:"0",bottom:"0",right:"0",width:"60px",height:"60px"}),e},overCB:function(e,t){this._experienceBase.getManager("VCXSelectionManager").ProcessComponentsFromSelection("HSO",function(e){var t=e.QueryInterface("VCXIModifiable");t&&console.log(t.GetObject().GetID())});var n=t.dataTransfer,a=n.types,r=!1;if(void 0!==a)for(var i=0;i<a.length;i++)if("Files"===a[i]||"text/plain"===a[i])r=!0;else if("cke/id"===a[i]||"scene"===a[i]||"text/uri-list"===a[i]){r=!1;break}return n.dropEffect=r?"copy":"none",!0},enterCB:function(e,t){if(t&&t.dataTransfer&&t.dataTransfer.types){for(var n=t.dataTransfer.types,a=n.length,r=!1,i=0;i<a;i++)if("Files"===n[i]||"text/plain"===n[i])r=!0;else if("cke/id"===n[i]||"scene"===n[i]||"text/uri-list"===n[i]){r=!1;break}r&&this._experienceBase.getManager("VCXGUIManager").AddDropZone()}},leaveCB:function(){this._experienceBase.getManager("VCXGUIManager").RemoveDropZone()},dropCB:function(e,n,a){var s=this._experienceBase,c=s.getManager("VCXContextManager");if(e&&void 0!==widget.onRefresh)return console.log(e),this.loadDroppedFromCollabSpace(a).then(function(){console.log("Load drop done.")}).catch(function(e){console.log("Load drop failed.")});var p=a.dataTransfer.files,C=[],l=!1;if(p.length){l=!0;for(var g=0;g<p.length;g++){if(void 0!==(S=p[g])){var u=S.name;S.type;S.type||(l=!1),_=(_=u.slice(u.lastIndexOf(".")+1)).toLowerCase(),C.push(_)}}}if(p.length>0){var M=c.CheckInputFile(!1,C);if(!l&&!M.supported){var d={level:"warning",title:"Loading",subtitle:M.message,sticky:!0};return s.getManager("VCXNotificationManager").addNotification(d),void s.getManager("VCXGUIManager").RemoveDropZone()}}var V="",h="",m=null,X={};if(1===p.length&&"record"===s.odt){var S=p[0],f=s.getManager("VCXGUIManager").getGettingStartedUI();return s.getManager("VCXAPIManager").OpenModel(S,function(){f.endLoadingExperience()})}s.getManager("VCXGUIManager").RemoveDropZone();for(g=0;g<p.length;g++){if(void 0!==(S=p[g]))if(void 0!==(u=S.name)){var _;if(_=(_=u.slice(u.lastIndexOf(".")+1)).toLowerCase(),!(M=c.CheckInputExtension(_)).supported){s.getManager("VCXNotificationManager").addNotification({level:"warning",title:"Action not supported",message:M.message});continue}"json"===_||"exprd"===_?V=S:"3dxml"===_?(h=S,m=window.URL.createObjectURL(S),X[S.name]=m):"application/octet-stream"!==i.GetMimeType("."+_)||s.getManager("VCXNotificationManager").addNotification({level:"warning",title:"Extension not supported"})}}f=s.getManager("VCXGUIManager").getGettingStartedUI();if(V){window.loading3DXML=!0;var v=this;return s.webApplication.requestNewExperienceBaseAsync().then(function(e){v._experienceBase=e,(new r).Load({experienceBase:v._experienceBase,mapAssets:X,jsonFile:V,urb:!0,endCB:function(){window.loading3DXML=!1}})})}if(h){if("record"===s.odt&&s.getManager("VCXODTManager").SetModelForZip(h),c.isSupported("Import3DXML")){const e=s.getManager("VCXCAT3DXModelManager"),n=s.getManager("VCXPlatformServicesManager");if(e&&!t.getUrlVars().file)return(async()=>{const e=await n.handle3DXML(X);for(let t of p)this._experienceBase.getManager("VCXAnalyticsTrackerAppManager").trackImport3dxmlEvent("xH_HomePageDragAndDrop",e.insertProducts,t.size);return e})()}window.loading3DXML=!0;v=this;return s.webApplication.requestNewExperienceBaseAsync().then(function(e){v._experienceBase=e,(new r).Load({experienceBase:e,mapAssets:X,jsonFile:"",endCB:function(){window.loading3DXML=!1}})})}for(var b={x:a.clientX,y:a.clientY},D=0;D<p.length;D++){if((S=p[D]).type.length){var A=S.name,x=new window.FileReader;x.onloadend=function(){var e=x.result,t=new Blob([e],{type:S.type}),n=window.URL.createObjectURL(t),a=s.getManager("VCXDocManager").BuildPathFromString(n,A),r=o.getCommand("VCXCreateDressup2DImageCmd",s.getManager("VCXContextManager").getContext());r&&(r._mousePosition=b,r._docIDToUse=s.getManager("VCXDocManager").AddOrModifyDoc(a),r.begin()),s.getManager("VCXGUIManager").RemoveDropZone()},x.readAsArrayBuffer(S)}}},postInitialize:function(){var e=this._experienceBase.getManager("VCXContextManager");if(e.getMainViewer().canvas){var t={over:(e,t)=>{this.overCB(e,t)},enter:(e,t)=>{this.enterCB(e,t)},leave:()=>{this.leaveCB()},drop:(e,t,n)=>{this.dropCB(e,t,n)}},a=document.getElementById(e.getMainViewer().canvas.id);a||console.warn("Cannot find canvas id "+e.getMainViewer().canvas.id),a&&n.droppable(a,t);var r=document.getElementsByClassName("vcx-Curtain-Home")[0];r||console.warn("Cannot find vcx-Curtain-Home"),r&&n.droppable(r,t)}else console.error("No canvas !!")},unInitialize:function(){var e=this._experienceBase.getManager("VCXContextManager");if(e.getMainViewer().canvas){var t=document.getElementById(e.getMainViewer().canvas.id);n.clean(t)}},getVersion:function(){return"2.24.0"},loadDroppedFromCollabSpace:function(e){this._experienceBase.getManager("VCXGUIManager").RemoveDropZone();var t=this,n="text/plain";t._experienceBase.getManager("VCXContextManager").isIE11()&&(n="text");var a,r=e.dataTransfer.getData(n);if(!r)return this.dropCB(null,null,e);var i=new Promise(function(e,n){if(!r)return(o=new Error("Content not supported.")).criticity="Warning",n(o);var i=JSON.parse(r).data;a=i.items[0];var o,s=t._experienceBase.getManager("VCXContextManager").CheckInputFile(!0);if(!s.supported)return(o=new Error(s.message)).criticity="Warning",n(o);e(t._experienceBase.getManager("VCXPlatformServicesManager").CheckTenant(a))}).then(function(){var e=a.objectType;console.log("Dropped object type : "+e);var n={};n.data=r,n.getData=function(){return n.data},n.files=[];var i=a.contextId,o=a.displayName,s=a.objectId;if("Document"===e)return t._experienceBase.getManager("VCXPlatformServicesManager").onDropDocument(o,n);if("VPMReference"===e||"CATPart"===e||"CAT_Distiller_Ref"===e||(e.indexOf("Aec")>=0||"Building"===e)&&"null"!==localStorage.getItem("DS_PRODUCTHIGHLIGHT_CCT_IMPORT"))return t._experienceBase.getManager("VCXAnalyticsTrackerAppManager").trackNewPresentationEvent("xH_HomePageDragAndDrop"),t._experienceBase.getManager("VCXPlatformServicesManager").onDropProduct(o,s);if("HighlightPresentation3DCom"===e)return t._experienceBase.getManager("VCXAnalyticsTrackerAppManager").trackOpenPresentationEvent("xH_HomePageDragAndDrop"),t._experienceBase.getManager("VCXPlatformServicesManager").onLoadExperienceFromPhysicalID(o,s,i);if("CityPresentation3DCom"===e)return t._experienceBase.getManager("VCXPlatformServicesManager").onLoadExperienceFromPhysicalID(o,s,i);if("dsc_matref_ref_Covering"===e)return t._experienceBase.getManager("VCXPlatformServicesManager").onDropMaterial(o,s,n);if("AmbienceEnvironment"===e)return t._experienceBase.getManager("VCXPlatformServicesManager").onDropAmbience(o,s,n);console.log("VCXDragDropManager : Object type not found");var c=new Error("Content not supported.");return c.criticity="Warning",UWA.Promise.reject(c)}).catch(function(e){return console.error(e),"Warning"===e.criticity?UWA.Promise.reject(e):t._experienceBase.getManager("VCXCAT3DXModelManager").CloseExperienceAndReset({level:"error",title:"Loading Error",message:"The content could not be loaded."},e).then(function(){return UWA.Promise.reject(e)})});return this._experienceBase.getManager("VCXNotificationManager").addProgressNotification({maskDisplayAdd:1,iPromise:i}),i}});return Object.defineProperty(s.prototype,"componentType",{enumerable:!0,get:function(){return"VCXDragDropManager"}}),s}),define("DS/VCXWebComposer/VCXHyperlinkManager",["DS/Core/Core","DS/CoreEvents/Events","DS/VCXWebExperienceBase/VCXHyperlinkManagerBase","DS/VCXWebComposer/VCXUIHyperlink","DS/VCXWebKernel/VCXCmdGoToMarker","DS/WebRBTree/WebRBIterator"],function(e,t,n,a,r,i){"use strict";var o=n.extend({initialize:function(){this._parent(),this._strEventToListen="onPrimaryPointerClick"},postInitialize:function(){this._parent(),this._vcxUIHyperlink=new a(this._experienceBase),this._bPreviewMode=this._experienceBase.getManager("VCXExperience").GetPreviewMode();this._tokens={},this._tokens.previewModeEvent=t.subscribe({event:"VCX_PREVIEW_MODE_CHANGED"},(e=>{this._bPreviewMode=e}).bind(this))},unInitialize:function(){this._parent(),this._vcxUIHyperlink&&(this._vcxUIHyperlink.UnsubscribeEvent(),this._vcxUIHyperlink=null),t.unsubscribe(this._previewModeEvent)},ObjectHasHyperlink:function(e){var t=e.QueryInterface("VCXIModifiable"),n=null;return t&&(n=t.GetProperty("Actor.Hyperlink")),!!n&&parseInt(n.GetPropertyValue().GetValue(),10)>=0},OpenHyperlink:function(e,t){if(this._bPreviewMode){var n=null,a=e.GetObject().GetID(),r=null;if(this._experienceBase.getManager("VCXHotspotManager")&&(r=this._experienceBase.getManager("VCXHotspotManager").GetEnabledHotspotFromComponentID(a,!0)),r){var i=r.QueryInterface("VCXIModifiable");n=this._getPropertyPathFromModifiable(i)}else n=this._getPropertyPathFromModifiable(e);var o=-1;if(n)o=n.GetPathType().GetValue();if(0===o){var s="",c=n.GetValueURL().GetValue();c.indexOf("blob:")<0&&(s=c.toLowerCase()),s.indexOf("scenario://")>=0?this.OpenScenarioFromOrder(s,t):this.OpenDocument(o,n,t)}else if(1===o){var p=this._experienceBase.ComponentsMap.GetComponentFromLink(n.GetValueLink());p&&this.OpenScenario(p.GetID(),t)}else if(2===o){(l=this._experienceBase.ComponentsMap.GetComponentFromLink(n.GetValueLink())).IsKindOf("VCXComponentMarker")?this.GoToMarker(l,!1,!0,t):l.IsKindOf("VCXScenario")&&this.PlayScenario(l,t)}else if(3===o){var C=this._experienceBase.ComponentsMap.GetComponentFromLink(n.GetValueLink());C&&this.GoToMarker(C,!1,!1,t)}else if(4===o){var l;(l=this._experienceBase.ComponentsMap.GetComponentFromLink(n.GetValueLink()))&&l.IsKindOf("VCXComponentMarker")?this.GoToMarker(l,!0,!1,t):l&&l.IsKindOf("VCXScenario")&&this.PlayMarkerSequence(l,t)}else console.log("[VCXHyperlinkeManager]: mode not found. Failed launch hyperlink.")}},OpenDocument:function(e,t,n){var a=this._getHyperlinkInfosFromProperty(t),r=a.url,i=a.filename;r.indexOf("blob:")>-1?this._vcxUIHyperlink.CreateMediaDiv(r,i):window.open(r);n&&n(r)},OpenScenarioFromOrder:function(e,t){var n=e.substring(11),a=this._experienceBase.getManager("VCXScenarioManager").GetCurrentScenario(),r=this._experienceBase.getManager("VCXSequenceManager").GetSequenceFromScenarioId(a);if(r){this._experienceBase.getManager("VCXSequenceManager").GetListSequencesFromType(0);var i="",o=n.toLowerCase();if("previous"===o)i=this._experienceBase.getManager("VCXSequenceManager").GetPreviousScenarioId(a);else if("next"===o)i=this._experienceBase.getManager("VCXSequenceManager").GetNextScenarioId(a);else if("first"===o)i=r.GetListScenariosId()[0];else if("last"===o){var s=r.GetListScenariosId();i=s[s.length-1]}""!==i&&this.OpenScenario(i,t)}else console.log("Sequence not found !")},OpenScenario:function(e,t){this._experienceBase.getManager("VCXGUIManager").GoToScenarioContext()&&this._experienceBase.getManager("VCXExperience").GoToScenarioWithInterpolation(e,t)},PlayScenario:function(n,a){if(n);else{let e=this._experienceBase.getManager("VCXScenarioManager").GetCurrentScenario();n=this._experienceBase.ComponentsMap.GetComponentFromID(e)}var r=()=>{if(n.HasAnimation()){e.Selection.PSOManager.empty(),t.publish({event:"VCX_START_PLAY"}),this._experienceBase.getManager("VCXContextManager")&&("0"==this._experienceBase.getManager("VCXContextManager").getUrlVars().boost||n.BuildAnimatedModifiablesSets(this._experienceBase.getManager("VCXScenarioManager")._keyframer)),this._experienceBase.getManager("VCXScenarioManager").SetIsPlayingCurrentScenario(!0);var r=t.subscribe({event:"VCX_Timeline_STOP_PLAY"},()=>{t.unsubscribe(r),n.SetSequenceMaxFrame(null)}),i=t.subscribe({event:"VCX_SCENARIO_END_REACHED"},()=>{t.unsubscribe(i),a&&a()})}},i=()=>{this._experienceBase.getManager("VCXScenarioManager").GetCurrentScenario()!==n.GetID()?this.OpenScenario(n.GetID(),r):r()};this._bPreviewMode&&this._experienceBase.getManager("VCXPulseManager")?this._experienceBase.getManager("VCXPulseManager").StopPulse(i):i()},PlayMarkerSequence:function(e,t){var n=this._experienceBase.getManager("VCXScenarioManager").GetCurrentScenario(),a=this._experienceBase.ComponentsMap.GetComponentFromID(n),r=0;e.IsKindOf("VCXComponentMarker")?r=e.QueryInterface("VCXIModifiable").GetProperty("Actor.TimePos").GetPropertyValue().GetValue():e.IsKindOf("VCXScenario")?a=e:r=this._experienceBase.getManager("VCXScenarioManager").GetCurrentFrame();var o=null,s=a.GetTrackMarkers();if(s)for(var c=s._treekeys,p=new i(c),C=p.next();null!==C;){var l=C.GetFrame();parseInt(l)>r?(o=l,C=null):(0,C=p.next())}o&&a.SetSequenceMaxFrame(o),this.PlayScenario(a,t)},GoToMarker:function(e,t,n,a){var i=new r(this._experienceBase.getManager("VCXScenarioManager"),this._experienceBase.getManager("VCXCommandManager"),this._experienceBase.ComponentsMap);i.GoToMarker(e.GetID()),i.SetCallback(a),this._experienceBase.getManager("VCXCommandManager").Push(i),t?this.PlayMarkerSequence(e,a):n&&this.PlayScenario(null,a)}});return Object.defineProperty(o.prototype,"componentType",{enumerable:!0,get:function(){return"VCXHyperlinkManager"}}),o}),define("DS/VCXWebComposer/VCXWebAppHelper",["UWA/Class","DS/Core/Core","DS/CoreEvents/Events","DS/VCXWebComposer/VCXWebDictionary","DS/VCXWebDressup/VCXWebDressupDictionary","DS/VCXWebVisualization/VCXVisuManager"],function(e,t,n,a,r,i){"use strict";var o=e.extend({init:function(e){this._parent(),this._nlsToLoad=[],this.options=UWA.extend({},e,!0)},disposeExperienceBase:function(){return UWA.Promise.resolve()},onActionBarReady:function(){this._experienceBase&&this._experienceBase._ManagerSet&&this._experienceBase._ManagerSet.postInitializePromise&&this._experienceBase._ManagerSet.postInitializePromise.then(function(){var e=this._experienceBase.getManager("VCXGUIManager"),t=this._experienceBase.getManager("VCXContextManager").getActionBar();if(t._additionalActionBarSections||(t._additionalActionBarSections=[],this.getAdditionalActionBarSections(t._additionalActionBarSections),this._experienceBase._ManagerSet.dealWithInitArray("getAdditionalActionBarSections",!1,!1,t._additionalActionBarSections)),t._additionalActionBarSections&&t._additionalActionBarSections.length){var n=t._additionalActionBarSections.pop();t.loadModel(n)}else e.onVCXActionBarReady(t)}.bind(this))},getAdditionalActionBarSections:function(e){},getContextualContent:function(e){return{cmdList:[]}},AddDictionaryDescription:function(e){if(e&&e.getNLSModules&&e.getNLSModules()&&(this._nlsToLoad=this._nlsToLoad.concat(e.getNLSModules())),e&&e.GetDictionary&&e.GetDictionary())return this._experienceBase.AddDictionaryDescription(e.GetDictionary())},addDictionaries:function(){return UWA.Promise.resolve().then(function(){return this.AddDictionaryDescription(a)}.bind(this)).then(function(){return this.AddDictionaryDescription(r)}.bind(this))},onFinished:function(e){var a=this;this._RunLoopStarted=n.subscribe({event:"/W3A/ManagerSet/RunLoopStarted"},function(){a.options.onAppInitialize&&(a.options.onAppInitialize(a,a._experienceBase),a.options.onAppInitialize=null),n.unsubscribe(a._RunLoopStarted),delete a._RunLoopStarted}),t.setFullscreen(),a._experienceBase&&a._experienceBase._ManagerSet&&a._experienceBase._ManagerSet.getVersions&&console.log(this._experienceBase._ManagerSet.getVersions());var r=this._experienceBase.getManager("VCXGUIManager").getGettingStartedUI();return r&&r.clearInitWidget(),UWA.Promise.resolve()}});return o.getOptions=function(){return window.useAsyncExperienceBase=!0,window.enableNewTrapSelection=!0,window.IR551190=!0,window.IR551201=!0,window.WUXEnableGSSOCache=!0,{viewerOptions:i.getViewerOptions(),uiOptions:{displayTree:!1,preserveActionBarHeight:!0}}},o}),define("DS/VCXWebComposer/VCXHotspotManager",["DS/Core/Core","DS/CoreEvents/Events","DS/VCXWebComposer/VCXWebActorListManager","DS/VCXWebKernel/VCXCmdChangeSelection","DS/VCXWebModifiablesServices/VCXModifiablesAccess","DS/VCXWebProperties/VCXPropertyValueVector","DS/VisuEvents/EventsManager","DS/WebRBTree/WebRBIterator"],function(e,t,n,a,r,i,o,s){"use strict";var c=n.extend({initialize:function(){this._mapHotspotsHLFromTree={},this._mapHotspotsHLFromViewport={},this._mapHotSpotCompIdFromSmgXmlAndRealCompID={},this._mapCacheForPreghlight={}},postInitialize:function(){var e=this;this._eventTokens||(this._eventTokens={}),this._eventTokens._tokenScenarioChanged=t.subscribe({event:"VCX_CURRENT_SCENARIO_CHANGED"},function(){for(var t in e._mapHotspotsHLFromTree)if(e._mapHotspotsHLFromTree.hasOwnProperty(t)){var n=e._experienceBase.ComponentsMap.GetComponentFromID(t);e.DeactivateAllHotspots(),e.ActivateHotspotFromTree(n)}}),this._eventTokens._tokenPSO=t.subscribe({event:"/VISU/"},function(t){"@onMoveEvent"===t.eventType&&(t.from?e.onMouseOver(t,e):"@pickNothing"===t.eventID&&e.DeactivateAllHotspots(!0))})},unInitialize:function(){if(this.DeactivateAllHotspots(),this.DeactivateAllHotspots(!0),this._mapHotspotsHLFromTree={},this._mapHotspotsHLFromViewport={},this._mapHotSpotCompIdFromSmgXmlAndRealCompID={},this._mapCacheForPreghlight={},this._eventTokens){for(var e in this._eventTokens)this._eventTokens.hasOwnProperty(e)&&this._eventTokens[e]&&t.unsubscribe(this._eventTokens[e]);delete this._eventTokens}this.disposeComponentsActorListFromType(this.getConcernedComponentActorListType())},getConcernedComponentActorListType:function(){return"VCXComponentHotspot"},getComponentsActorListMapCache:function(){return this._mapCacheForPreghlight},addComponentToMapPrehighlight:function(e,t){var n=this._experienceBase.ComponentsMap.GetComponentFromID(e);if(!n){var a=this._experienceBase.getManager("VCXContextManager");if(a.getOpenSMGXML()){var r=a.getSmgXmlRoot();if(r){var i=r.GetComponentsMap();i.has(e)&&(n=i.get(e)),n&&(this._mapHotSpotCompIdFromSmgXmlAndRealCompID[e]=n.GetID())}}}n&&this.associateComponentAndActorListToMapCache(n,t)},removeComponentFromMapPrehighlight:function(e,t){var n=this._experienceBase.ComponentsMap.GetComponentFromID(e);this.dissociateComponentAndActorListfromMapCache(n,t)},addActorsListToHotspot:function(e,t){},removeActorsListFromHotspot:function(e,t){this.removeActorsListFromComponentActorList(e,t)},removeActorsListFromAllHotspots:function(e){this.removeActorsListFromAllComponentsActorListOfAKind(e,this.getConcernedComponentActorListType())},getHotspotsListFromComponent:function(e){return this.getListOfComponentActorListOwningComponent(e)},GetEnabledHotspotFromComponentID:function(e,t){var n=null,a=this.getComponentsActorListMapCache()[e];for(var r in a){if(a.hasOwnProperty(r))if((n=this._experienceBase.ComponentsMap.GetComponentFromID(r)).QueryInterface("VCXIModifiable").GetProperty("Actor.Enable").GetPropertyValue().GetValue())return n}if(t){var i=this._experienceBase.ComponentsMap.GetComponentFromID(e).QueryInterface("VCXIModelNavigable").getParent();if(i)return this.GetEnabledHotspotFromComponentID(i.GetObject().GetID(),t)}},onMouseOver:function(t,n){var a=t.from;if(a){var i=r.CleanPathElement(a),o=this._experienceBase.ComponentsMap.GetComponentFromExternalPath(i);if(o){var s=this._experienceBase.getManager("VCXHotspotManager").GetEnabledHotspotFromComponentID(o.GetID());s?(e.Selection.PSOManager.empty(!0),this._mapHotspotsHLFromViewport[s.GetID()]||(this.DeactivateAllHotspots(!0),this.ActivateHotspotFromViewport(s))):this.DeactivateAllHotspots(!0)}}},onClickEmptySpace:function(e,t){r.GetPathElementFromEvent(e,t._experienceBase)||(t.DeactivateAllHotspots(),t.DeactivateAllHotspots(!0))},ActivateHotspotFromTree:function(e){if(e&&e.IsKindOf("VCXComponentActorList")){var t=this,n=e.QueryInterface("VCXIModifiable");o.addEvent(this._experienceBase.getManager("VCXContextManager").getMainViewer().canvas,"onPrimaryPointerClick",function(e){t.onClickEmptySpace(e,t)});var r=new a(this._experienceBase.getManager("VCXSelectionManager"));if(r.AddToSelection(e),this._experienceBase.getManager("VCXCommandManager").Do(r),n.GetProperty("Actor.Enable").GetPropertyValue().GetValue())if(this._experienceBase.getManager("VCXSelectionManager").keepHotspotsSelectable){if(!this._mapHotspotsHLFromTree[e.GetID()]){var s=n.GetProperty("Actor.Color").GetPropertyValue(),c=n.GetProperty("Actor.ListActors").GetPropertyValue();if(s&&c){var p=s.GetThreeColor(),C=this.createColorHL(p);this._mapHotspotsHLFromTree[e.GetID()]=C,this.addActorsToColorHL(C,c);var l=new i([C]);n.OnChangeProperty("highlight.color",l)}}}else this._mapHotspotsHLFromTree[e.GetID()]=null;else this._mapHotspotsHLFromTree[e.GetID()]=null}},ActivateHotspotFromViewport:function(e){if(e&&e.IsKindOf("VCXComponentHotspot")){var t=e.QueryInterface("VCXIModifiable");if(t.GetProperty("Actor.Enable").GetPropertyValue().GetValue())if(this._experienceBase.getManager("VCXSelectionManager").keepHotspotsSelectable){var n=t.GetProperty("Actor.Color").GetPropertyValue(),a=t.GetProperty("Actor.ListActors").GetPropertyValue();if(n&&a){var r=n.GetThreeColor(),i=this.createColorHL(r);this.AddToMapViewport(e.GetID(),i),this.addActorsToColorHL(i,a)}}}},createColorHL:function(e){var t=this._experienceBase.getManager("VCXContextManager").getMainViewer();if(t&&e){var n={color:e,outlineColor:e,intensity:.5};return t.createHighlightSet(n,!1,!1,!0)}},addActorsToColorHL:function(e,t){if(e)for(var n=e.getColorHighlight(),a=t.GetValue(),r=0;r<a.length;r++){var i=a[r],o=this._experienceBase.ComponentsMap.GetComponentFromLink(i);if(!o){var s=i.GetValue();if(this._mapHotSpotCompIdFromSmgXmlAndRealCompID.hasOwnProperty(s)){var c=this._mapHotSpotCompIdFromSmgXmlAndRealCompID[s];o=this._experienceBase.ComponentsMap.GetComponentFromID(c)}}var p=o.QueryInterface("W3AISGNodeHolder").getPathElement();e.add(p,{highlightColor:n})}},DeactivateAllHotspots:function(e){if(e){for(var t in this._mapHotspotsHLFromViewport)if(this._mapHotspotsHLFromViewport.hasOwnProperty(t))if(this._mapHotspotsHLFromTree[t]);else{var n=this._experienceBase.ComponentsMap.GetComponentFromID(t);this.DeactivateHotspotFromViewport(n)}}else for(var t in this._mapHotspotsHLFromTree)if(this._mapHotspotsHLFromTree.hasOwnProperty(t)){n=this._experienceBase.ComponentsMap.GetComponentFromID(t);this.DeactivateHotspotFromTree(n)}},DeactivateHotspotFromTree:function(e){if(e){var t=new a(this._experienceBase.getManager("VCXSelectionManager"));t.RemoveFromSelection(e),this._experienceBase.getManager("VCXCommandManager").Do(t);var n=this._mapHotspotsHLFromTree[e.GetID()];n&&(this.removeActorsFromColorHL(n),this._experienceBase.getManager("VCXContextManager").renderAll()),delete this._mapHotspotsHLFromTree[e.GetID()],0===Object.keys(this._mapHotspotsHLFromTree).length&&o.removeEvent(this._experienceBase.getManager("VCXContextManager").getMainViewer().canvas,"onPrimaryPointerClick",this.onVisuEvent)}},DeactivateHotspotFromViewport:function(e){var t=this._mapHotspotsHLFromViewport[e.GetID()];t&&(this.removeActorsFromColorHL(t),this._experienceBase.getManager("VCXContextManager").renderAll()),this.RemoveFromMapViewport(e.GetID())},removeActorsFromColorHL:function(e){e&&e.clearAll()},UpdateHotspotsHyperlinks:function(){for(var e=this._experienceBase.getManager("VCXScenarioManager").GetScenarios(),t=this._experienceBase.ComponentsMap.GetComponentFromType("VCXComponentHotspot"),n=0;n<t.length;n++){var a=t[n].QueryInterface("VCXIModifiable"),r=this._experienceBase.getManager("VCXScenarioManager").GetNeutrals(a.GetHashing()).GetProperty("Actor.Hyperlink");if(r){var i=this._experienceBase.getManager("VCXDocManager").GetPropPath(r.GetPropertyValue().GetValue());if(i)if(1===i.GetPathType().GetValue()){var o=i.GetValueLink().GetValue(),c=this._getScenarioIDFromName(o);i.GetValueLink().SetValue(c)}}for(var c in e)if(e.hasOwnProperty(c)){var p=e[c].GetObjectAnimation(a.GetHashing());if(p){var C=p.GetTrack("Actor.Hyperlink");if(C)for(var l=C._treekeys,g=new s(l),u=g.next();null!==u;){var M=u.GetValue().GetValue(),d=this._experienceBase.getManager("VCXDocManager").GetPropPath(M);if(d)if(1===d.GetPathType().GetValue()){o=d.GetValueLink().GetValue(),c=this._getScenarioIDFromName(o);d.GetValueLink().SetValue(c)}u=g.next()}}}}},_getScenarioIDFromName:function(e){var t=this._experienceBase.getManager("VCXScenarioManager").GetScenariosFromType(0);if(t[e])return e;for(var n in t){if(t.hasOwnProperty(n))if(e===t[n].GetName())return n}},AddToMapViewport:function(e,t){this._mapHotspotsHLFromViewport[e]=t},RemoveFromMapViewport:function(e){delete this._mapHotspotsHLFromViewport[e]}});return Object.defineProperty(c.prototype,"componentType",{enumerable:!0,get:function(){return"VCXHotspotManager"}}),c}),define("DS/VCXWebComposer/VCXExperienceSaver",["DS/VCXWebExperienceLoader/VCXExperienceSaverBase","DS/VCXWebKernelTools/VCXFileWriter","DS/VCXWebComposer/VCXBlobDumper"],function(e,t,n){"use strict";return e.extend({init:function(){this._parent(),this._blobDumper=new n},Save:function(e,t){var n=this;this._blobDumper.ConvertBlobsFromDocManager(e,function(){n.SaveToJson(e,t)})},SaveToJson:function(e,n){var a={FileVersion:1};a.VCXObjects=this._ComponentsMapToJson(e),e.getManager("VCXContextManager").getCityMode()||(a.W3AISGNodeHolder=this._W3AISGNodeHolderToJson(e)),a.VCXIModelNavigable=this._VCXIModelNavigableToJson(e),a.MetaPropertiesDef=this._MetaPropertiesDefToJson(e),a.ScenarioSequences=this._SequencesToJson(e),a.neutrals=this._NeutralsToJson(e),a.listScenarios=this._ScenariosToJson(e),a.DocManager=this._DocManagerToJson(e),a.EmbeddedData=this._EmbeddedDataToJson();var r=JSON.stringify(a,null,4),i="data:text/json;charset=utf8,"+encodeURIComponent(r),o="SaveExperience";if(e&&e.getManager("VCXContextManager")){var s=e.getManager("VCXContextManager").getRootComponentName();if(s)o=s;else{var c=new Date;o+="-",o+=c.getUTCFullYear(),o+=c.getUTCMonth(),o+=c.getUTCDate(),o+=c.getUTCHours(),o+=c.getUTCMinutes(),o+=c.getUTCSeconds()}}e.getManager("VCXContextManager").getCityMode()?o+=".ctps":e.getManager("VCXContextManager").getProdHighMode()?o+=".exprd":o+=".json";var p=e.getManager("VCXCAT3DXModelManager");if(p){var C=e.getManager("VCXContextManager").GetApplicationMode();if(p&&2===C)return void p.PushStream(i,o).done(function(){console.log("Experience "+o+" Saved"),n&&n()})}(new t).saveAs(i,o),n&&n()},_GetStartingScenario:function(e){var t=e.getManager("VCXSequenceManager").GetListSequences();if(0!==t.length)for(var n=t[0].GetListScenariosId(),a=0;a<n.length;a++){var r=n[a];if(0===e.ComponentsMap.GetComponentFromID(r).GetPersistency())return r}else console.log("VCXExperienceSaver: The sequence list is empty !");return""},_SequencesToJson:function(e){for(var t=[],n=e.getManager("VCXSequenceManager").GetListSequences(),a=0;a<n.length;a++){var r=n[a],i={objectID:r.GetID(),listScenarioID:r.GetListScenariosId()};t.push(i)}return t},_ScenariosToJson:function(e){var t=[],n=e.getManager("VCXScenarioManager").GetScenarios();for(var a in n)if(n.hasOwnProperty(a)){var r=n[a];if(0!==r.GetPersistency())continue;var i=this._ScenarioToJson(e,r),o=r.GetVisibility(),s=this._VisibilityToJson(o,e);i.visibility=s,t.push(i)}return t},_DocManagerToJson:function(e){for(var t={},n=[],a=e.getManager("VCXDocManager").NumberOfDoc(),r=0;r<a;r++){var i=e.getManager("VCXDocManager").GetPropPath(r);if(i)if(i.GetValueBool())if(i.GetValueBool().GetValue()){var o=this._PropertyToJson(i,e);n.push({docID:r,type:"VCXPropertyValuePath",value:o})}}e.getManager("VCXDocManager").QueryInterface("VCXIModifiable");return t.array=n,t},_EmbeddedDataToJson:function(){return this._blobDumper.GetMapOfData()},DumpScenario:function(e,n){var a=this._ScenarioToJson(e,n),r=n.GetVisibility(),i={Scenario:a,Visibility:this._VisibilityToJson(r,e)},o=JSON.stringify(i,null,4),s="data:text/json;charset=utf8,"+encodeURIComponent(o);(new t).saveAs(s,"Scenario.json")},DumpComponentsMapContent:function(e,n){var a=[],r=[],i=[],o=e.ComponentsMap.GetComponentTable();for(var s in o)if(o.hasOwnProperty(s)){var c=o[s],p=c.GetType(),C=c.GetLoadData(),l={};l.objectID=s,l.objectType=p;C=null;var g=c.QueryInterface("W3AISGNodeHolder");if(g){var u=g.getPathElement();C=this._BuildArrayIDsFromPathElement(u)}C&&C.length>0&&(l.objectData=C);var M=c.GetPersistency();0===M?a.push(l):1===M?r.push(l):2===M&&i.push(l)}var d={Persistency0:a,Persistency1:r,Persistency2:i},V=JSON.stringify(d,null,4),h="data:text/json;charset=utf-8,"+encodeURIComponent(V),m="";(m=n?n+".json":"ComponentsMap.json","record"===e.odt)||(new t).saveAs(h,m);return{obj:d,url:h,filename:m}},DumpArray:function(e,t,n){var a={MyArray:t};return this.DumpObject(e,a,n)},DumpPropertyMap:function(e,t,n){var a=this._PropMapToJson(e,t);return this.DumpObject(e,a,n)},DumpObject:function(e,n,a){var r={};n.toJSON=function(){var e=Object.keys(this);e.sort();for(var t=0;t<e.length;t++){var n=e[t];"toJSON"!==n&&(r[n]=this[n])}return r};var i=JSON.stringify(n,null,4),o="data:text/json;charset=utf-8,"+encodeURIComponent(i),s="";(s=a?a+".json":"MapObject.json","record"===e.odt||"replay"===e.odt)||(new t).saveAs(o,s);return{obj:r,url:o,filename:s}},_DumpPropMapDiff:function(e,t,n){for(var a in e)if(e.hasOwnProperty(a)){var r=e[a];for(var i in r)if(r.hasOwnProperty(i)){var o=r[i].vcxPropertyRef,s=r[i].vcxProperty;e[a][i].vcxPropertyRef=this._PropertyToJson(o.GetPropertyValue(),n),e[a][i].vcxProperty=this._PropertyToJson(s.GetPropertyValue(),n)}}this.DumpObject(e,t)}})}),define("DS/VCXWebComposer/VCXSelectionSetManager",["DS/CoreEvents/Events","DS/VCXWebComposer/VCXWebActorListManager"],function(e,t){"use strict";var n=t.extend({initialize:function(){this._mapCacheComponentSelectionSet=null},postInitialize:function(){this._mapCacheComponentSelectionSet={},this._eventTokens||(this._eventTokens={})},unInitialize:function(){for(var t in this._eventTokens)this._eventTokens.hasOwnProperty(t)&&this._eventTokens[t]&&e.unsubscribe(this._eventTokens[t]);this.disposeComponentsActorListFromType(this.getConcernedComponentActorListType()),this._mapCacheComponentSelectionSet=null},getConcernedComponentActorListType:function(){return"VCXComponentSelectionSet"},getComponentsActorListMapCache:function(){return this._mapCacheComponentSelectionSet},addComponentToMapSelectionSet:function(e,t){this.associateComponentAndActorListToMapCache(e,t)},removeComponentFromMapSelectionSet:function(e,t){this.dissociateComponentAndActorListfromMapCache(e,t)},addActorsListToSelectionSet:function(e,t){},removeActorsListFromSelectionSet:function(e,t){this.removeActorsListFromComponentActorList(e,t)},removeActorsListFromAllSelectionSets:function(e){this.removeActorsListFromAllComponentsActorListOfAKind(e,this.getConcernedComponentActorListType())},isComponentBelongingToASelectionSet:function(e){return this.isComponentBelongingToMapCache(e)},getSelectionSetListFromComponent:function(e){return this.getListOfComponentActorListOwningComponent(e)}});return Object.defineProperty(n.prototype,"componentType",{enumerable:!0,get:function(){return"VCXSelectionSetManager"}}),n});