define("DS/CAT3DWInfra/CAT3DWMutex",["UWA/Class"],function(e){"use strict";var t=e.extend({init:function(){let e=Promise.resolve();this.lock=(()=>{let t;const r=new Promise(e=>{t=(()=>e())}),n=e.then(()=>t);return e=r,n})}});return UWA.namespace("DS/CAT3DWInfra/CAT3DWMutex",t)}),define("DS/CAT3DWInfra/CAT3DWPreferenceManager",["UWA/Core","UWA/Controls/Abstract"],function(e,t){"use strict";var r=t.singleton({defaultOptions:{myWidgetObject:null},init:function(e){this._parent(e),this._userPref={},this._initConst()},_initConst:function(){this.setPreferenceValue("ONPREMISE","ONPREMISE"),this.setPreferenceValue("TSTPROVIDER","TSTPROVIDER"),this.setPreferenceValue("CLOUD","CLOUD")},getPreferenceValue:function(e){return this._userPref[e]},setPreferenceValue:function(e,t){this._userPref[e]=t},setPreferenceValueAsBoolean:function(e,t){var r=typeof t;"object"===r&&null===t||"undefined"===r?this.setPreferenceValue(e,!1):"string"===r?"1"===(t=t.toLowerCase())||"true"===t?this.setPreferenceValue(e,!0):"0"===t||"false"===t?this.setPreferenceValue(e,!1):console.error("Can't convert value "+t+" for key "+e+" to boolean"):"number"===r?1===t?this.setPreferenceValue(e,!0):0===t?this.setPreferenceValue(e,!1):console.error("Can't convert value "+t+" for key "+e+" to boolean"):"boolean"===r?this.setPreferenceValue(e,t):console.error("Can't convert type "+r+" to boolean")},removePreference:function(e){e&&delete this._userPref[e]}});return UWA.namespace("DS/CAT3DWInfra/CAT3DWPreferenceManager",r)}),define("DS/CAT3DWInfra/CAT3DWQueuePromise",["UWA/Class","UWA/Promise"],function(e,t){"use strict";var r="no",n="inprogress",i="finished",o=UWA.Class.extend({init:function(e){this._promises=[],this._promisesCount=0,this._resolveValues=[],this._promisesCompleted=0,this._nbThreads=0,this._delay=0,this._limit=0,this._wait=r,this._callback=e&&"function"==typeof e?e:function(){},this._nbPromises=35,this._timeoutValue=2e3},all:function(e,n,i){return Array.isArray(e)?0===e.length?t.resolve([]):(this._promises=e,this._promisesCount=this._promises.length,this._resolveValues=[],this._promisesCompleted=0,this._nbThreads=n||5,this._delay=i&&i.delay?i.delay:1e4,this._limit=i&&i.limit?i.limit:-1,this._wait=r,new t(function(e,t){this._runThreads(e,t)}.bind(this)).then(function(){return this._resolveValues}.bind(this))):t.reject(new Error("First parameter must be an array of promises."))},run:function(){return new t(this._callback)},_runThreads:function(e,t){for(var r=Math.min(this._promisesCount-this._promisesCompleted,this._nbThreads),n=0;n<r;n++)this._runNextPromise(e,t)},_runNextPromise:function(e,t){if(this._wait!==n){var a=this._promisesCount-this._promises.length;if(a!==this._promisesCount){if(this._limit>0&&this._wait===r&&a&&a%this._limit==0)return this._wait=n,void setTimeout(function(){this._wait=i,this._runThreads(e,t)}.bind(this),this._delay);this._wait=r;var s=this._promises.shift(),l=function(r,n){this._resolveValues[n]=r,this._promisesCompleted++,this._promises.length>0?this._runNextPromise(e,t):this._promisesCompleted===this._promisesCount&&e()}.bind(this);return s instanceof o?s.run().then(function(e,t){l(t,e)}.bind(this,a)).catch(t):void 0}}},sampleWithQueue:function(){return new t(function(e,t){for(var r=[],n=0;n<this._nbPromises;n++)r.push(new o(function(e,t,r){console.log("[QueuePromise sample] START SUCCESS : "+e),setTimeout(function(){console.log("[QueuePromise sample] END SUCCESS : "+e),t("youpiii"+e)},this._timeoutValue)}.bind(this,n)));this.all(r,5,{limit:10,delay:1e4}).then(function(){console.log("%c [QueuePromise sample] Main promise OK","color:green"),e()}).catch(function(e){console.log("%c [QueuePromise sample] Main promise KO","color:red"),console.error(e),t()})}.bind(this))}});return UWA.namespace("DS/CAT3DWInfra/CAT3DWQueuePromise",o)}),define("DS/CAT3DWInfra/CAT3DW3DDriveUtils",["DS/CAT3DWInfra/CAT3DWPreferenceManager","DS/WAFData/WAFData"],function(e,t){"use strict";function r(e,t){return e+(e.match(/\?/)?"&":"?tenant="+encodeURIComponent(t))}function n(n){var i=n.url+"/resources/3ddrive/v1/bos",o=e.getPreferenceValue("M3DEMobile")?t.proxifiedRequest:t.authenticatedRequest;return new Promise(function(t,a){o(r(i+"/ticket",n.platformId),{proxy:e.getPreferenceValue("M3DEMobile")?"passport":void 0,method:"GET",type:"json",onComplete:function(e,r){return t({body:e,headers:r})},onFailure:a})}).then(function(e){var t=e.body;return t.csrfToken=e.headers["x-ds-csrftoken"],t.tenant=n.platformId,t})}return{saveFileTo3DDriveAtGivenTenant:function(i,o,a,s){return n(s).then(function(n){var l=new FormData;return l.append("__fcs__nohtml",!0),l.append(n.jobticket,n.ticket),l.append("file_0",o,i),fetch(n.actionurl,{proxy:e.getPreferenceValue("M3DEMobile")?"passport":void 0,method:"POST",body:l}).then(function(e){return e.text()}).then(function(e){return e.trim()}).then(function(o){return function(n,i,o,a,s){var l=s.url+"/resources/3ddrive/v1/bos",u=e.getPreferenceValue("M3DEMobile")?t.proxifiedRequest:t.authenticatedRequest;return new Promise(function(t,c){u(r(l+"/"+a+"/contents",s.platformId),{proxy:e.getPreferenceValue("M3DEMobile")?"passport":void 0,method:"POST",type:"json",headers:{"Content-Type":"application/json","X-DS-CSRFTOKEN":o},onComplete:function(e){t(e)},onFailure:c,data:JSON.stringify({type:"Document",title:n,receipt:i})})})}(i,o,n.csrfToken,a,s)})})},updateFileIn3DDriveAtGivenTenant:function(i,o,a,s){return n(s).then(function(n){var l=new FormData;return l.append("__fcs__nohtml",!0),l.append(n.jobticket,n.ticket),l.append("file_0",o,i),fetch(n.actionurl,{method:"POST",body:l}).then(function(e){return e.text()}).then(function(e){return e.trim()}).then(function(o){return new Promise(function(l,u){var c=s.url+"/resources/3ddrive/v1/bos";(e.getPreferenceValue("M3DEMobile")?t.proxifiedRequest:t.authenticatedRequest)(r(c+"/"+a,s.platformId),{proxy:e.getPreferenceValue("M3DEMobile")?"passport":void 0,method:"PUT",type:"json",headers:{"Content-Type":"application/json","X-DS-CSRFTOKEN":n.csrfToken},onComplete:function(e){l(e)},onFailure:u,data:JSON.stringify({type:"Document",title:i,receipt:o})})})})})},getFolderContentsInTenant:function(n,i){var o=i.url+"/resources/3ddrive/v1/bos",a=e.getPreferenceValue("M3DEMobile")?t.proxifiedRequest:t.authenticatedRequest;return new Promise(function(e,t){a(r(o+"/"+n+"/contents",i.platformId),{type:"json",onComplete:e,onFailure:t})})},getFolderDataInTenantFromID:function(n,i){var o=i.url+"/resources/3ddrive/v1/bos",a=e.getPreferenceValue("M3DEMobile")?t.proxifiedRequest:t.authenticatedRequest;return new Promise(function(e,t){a(r(o+"/"+n,i.platformId),{type:"json",onComplete:e,onFailure:t})})}}}),define("DS/CAT3DWInfra/CAT3DWUserPreferences",["UWA/Core","UWA/Class","DS/CAT3DWInfra/CAT3DWPreferenceManager"],function(e,t,r){"use strict";var n=t.extend({init:function(){this.PREFIX="",this._touchMode=r.getPreferenceValue("MobileMode"),this._appMode=r.getPreferenceValue("appMode"),this.initPrefix()},initPrefix:function(){!0===this._touchMode?this.PREFIX="Mobile.":this.PREFIX="Desktop.","whiteboard"===this._appMode?this.PREFIX+="3DWhiteboard.":this.PREFIX+="3DSketch."},getPrefix:function(){return this.PREFIX},setUserPreference:function(e,t){if(!e||null===e)return void console.error("Name of the local storage preference invalid!");let r=this.PREFIX+e;try{window.localStorage.setItem(r,JSON.stringify(t))}catch(e){console.error(e)}},getUserPreference:function(e){if(!e||null===e)return void console.error("Name of the local storage preference invalid!");let t=this.PREFIX+e;try{return JSON.parse(window.localStorage.getItem(t))}catch(e){console.error(e)}}});return e.namespace("DS/CAT3DWInfra/CAT3DWUserPreferences",n)}),define("DS/CAT3DWInfra/CAT3DWFileServices",["UWA/Class","DS/CAT3DWInfra/CAT3DWPreferenceManager","WebappsUtils/WebappsUtils","text!DS/CAT3DWInfra/assets/CAT3DWFileTypes.json"],function(e,t,r,n){"use strict";var i=e.extend({init:function(){this._fileTypes=JSON.parse(n),this._unsupportedKey="UNSUPPORTED",this._errorImageName="xl_thumb_error.png",this._processingImageName="xl_thumb_waiting_processing.png",this._defaultMaxSize=5e7},getMaxSize:function(e){if(!e)return console.warn("[CAT3DWFileServices] iType paramater is undefined"),this._defaultMaxSize;if(!i.prototype.platformSupportedExtensions)return console.warn("[CAT3DWFileServices] Platform supported extensions/maxsize list is undefined"),this._defaultMaxSize;let t=i.prototype.platformSupportedExtensions.maxsize;return t[e]?t[e]:this._defaultMaxSize},getReadableMaxSize:function(e){var t=this.getMaxSize(e);if(!t)return"";var r=["Bytes","KB","MB","GB","TB"],n=parseInt(Math.floor(Math.log(t)/Math.log(1024)));return 0===n?t+" "+r[n]:(t/Math.pow(1024,n)).toFixed(1)+" "+r[n]},setPlatformSupportedExtensions:function(e){i.prototype.platformSupportedExtensions=e},getPlatformSupportedExtensions:function(){return i.prototype.platformSupportedExtensions},dispose:function(){this._fileTypes=null,this._unsupportedKey=null,this._errorImageName=null,this._processingImageName=null},getSupportedExtensions:function(e){if(!e)return this._fileTypes[this._unsupportedKey].extensions;for(var t in this._fileTypes)if(this._fileTypes[t].label===e)return this._fileTypes[t].extensions;return this._fileTypes[this._unsupportedKey].extensions},getTypeObjFromExtension:function(e){if(!e)return this._fileTypes[this._unsupportedKey];for(var t in this._fileTypes)for(var r=0;r<this._fileTypes[t].extensions.length;r++)if(this._fileTypes[t].extensions[r]===e)return this._fileTypes[t];return this._fileTypes[this._unsupportedKey]},extractExtensionFromName:function(e){return e?e.match(/\.([^.]*)$/)[1].toLowerCase():null},extractTitleFromName:function(e){return e?e.replace(/\.([^.]*)$/,""):null},getExtensionFromMIMEType:function(e){return"video/x-msvideo"===e?"avi":"image/bmp"===e?"bmp":"image/gif"===e?"gif":"image/jpeg"===e?"jpeg":"video/mpeg"===e?"mpeg":"image/png"===e?"png":"application/pdf"===e?"pdf":"image/svg+xml"===e?"svg":"image/webp"===e?"webp":void 0},getErrorImageName:function(){return this._errorImageName},getProcessingImageName:function(){return this._processingImageName},getErrorImagePlaceholderUrl:function(){return r.getWebappsAssetUrl("CAT3DWInfra","placeholders/"+this._errorImageName)},getProcessingImagePlaceholderUrl:function(){return r.getWebappsAssetUrl("CAT3DWInfra","placeholders/"+this._processingImageName)},createTitle:function(){var e="",r=this.getNowDate();return"whiteboard"===t.getPreferenceValue("appMode")?e+="3DWhiteboard":e+="3DSketch",e+="-Media "+r},createProjectTitle:function(){var e="",r=this.getNowDate();return"whiteboard"===t.getPreferenceValue("appMode")?e+="3DWhiteboard "+r:e+="3DSketch "+r,e},getProjectExtension:function(){var e="";return"whiteboard"===t.getPreferenceValue("appMode")?e+="3dwb":e+="3dskt",e},getNowDate:function(){var e="",t=new Date;return e+=t.toLocaleString("default",{month:"short"})+" ",e+=t.getDate()+" ",e+=t.getFullYear()+" ",e+=t.getHours()+":"+t.getMinutes()+":"+t.getSeconds()}}),o=JSON.parse(n);for(var a in o)i["TYPE_"+a.toUpperCase()]=o[a].label,i["FORMAT_"+o[a].format.toUpperCase()]=o[a].format;return i.STATUS_OK="fileok",i.STATUS_KO="fileko",i.STATUS_PROCESSING="fileprocessing",i}),define("DS/CAT3DWInfra/CAT3DWPlateformServices",["UWA/Core","UWA/Controls/Abstract","UWA/Promise","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/PlatformAPI/PlatformAPI","DS/WAFData/WAFData","DS/CAT3DWInfra/CAT3DWPreferenceManager"],function(e,t,r,n,i,o,a){"use strict";var s=t.singleton({defaultOptions:{myWidgetObject:null},init:function(e){this._parent(e),this._debugMode=a.getPreferenceValue("debug")||"true"===a.getPreferenceValue("debugUrl")},getUserID:function(){return i.getUser().login},getUserData:function(){return i.getUser()},getOrCreateSessionID:function(e){return new r(function(t,r){var n="";s.cacheSessionId||("local"==e?(n+="x3DPhoto",n+="/",n+=Date.now(),n+=Math.floor(10*Math.random())):(n+=s.getUserID(),n+="/",n+=a.getPreferenceValue("ServiceName"),n+="/",null!=a.getPreferenceValue("WidgetID")?n+=a.getPreferenceValue("WidgetID"):(n+=Date.now(),n+=Math.floor(10*Math.random())),n=n.replace(/\s+/g,"")),s.cacheSessionId=n),t(s.cacheSessionId)})},get3DSpace:function(e){return new r(function(t,r){1==a.getPreferenceValue("DebugMode")&&console.time("[PERFO - x3DPhoto] - get3DSpace"),n.getServiceUrl({serviceName:"3DSpace",platformId:e,onComplete:function(e){s.cacheUrl3DSpace=e,1==a.getPreferenceValue("DebugMode")&&console.timeEnd("[PERFO - x3DPhoto] - get3DSpace"),t(e)},onFailure:function(e){r(new Error("Internal Error - get3DSpace failed"))}})})},get3DSearch:function(e){var t=e?e.toUpperCase():null;return new r(function(e,r){n.getServiceUrl({serviceName:"3DSearch",platformId:t,onComplete:function(r){var n="";t?n=r:r&&r.length&&r[0]&&(console.warn("get3DSearch : PlatformId/Tenant is null so first url of the list is returned"),n=r[0].url),e(n)},onFailure:function(e){e&&console.warn(e),r(new Error("Internal Error - get3DSearch failed"))}})})},get3DDrive:function(e){var t=e?e.toUpperCase():null;return new r(function(e,r){1==a.getPreferenceValue("DebugMode")&&console.time("[PERFO - x3DPhoto] - get3DDrive"),n.getServiceUrl({serviceName:"3DDrive",platformId:t,onComplete:function(r){1==a.getPreferenceValue("DebugMode")&&console.timeEnd("[PERFO - x3DPhoto] - get3DDrive");var n="";t?n=r:r&&r.length&&r[0]&&(console.warn("get3DDrive : PlatformId/Tenant is null so first url of the list is returned"),n=r[0].url),s.cacheUrl3DDrive=n,e(n)},onFailure:function(e){e&&console.warn(e),s.cacheUrl3DDrive="",r(new Error("Internal Error - get3DDrive failed"))}})})},get3DDesign:function(e){return new r(function(t,r){1==a.getPreferenceValue("DebugMode")&&console.time("[PERFO - x3DPhoto] - get3DDesign"),n.getServiceUrl({serviceName:"3ddesignlinux",onComplete:function(r){var n="";for(var i in r)if(""!=e&&r[i].platformId==e){n=r[i].url;break}if(""==n||!n){console.log("WARNING: 3DXEnginering app has not been found on tenant "+e);for(i=0;i<r.length&&""==n;)n=r[i].url,i++}s.cacheUrl3DDesign=n.substring(n.indexOf("https://")+8),1==a.getPreferenceValue("DebugMode")&&console.timeEnd("[PERFO - x3DPhoto] - get3DDesign"),t(r)},onFailure:function(e){r(new Error("Internal Error - get3DDesign failed"))}})})},getx3DPhoto:function(e){return new r(function(t,r){1==a.getPreferenceValue("DebugMode")&&console.time("[PERFO - x3DPhoto] - getx3DPhoto"),n.getServiceUrl({serviceName:"x3dphoto",onComplete:function(r){var n="";for(var i in r)if(""!=e&&null!=e&&r[i].platformId.toLowerCase()==e){n=r[i].url;break}if(""==n||!n){console.log("WARNING: x3DPhoto app has not been found on tenant "+e);for(i=0;i<r.length&&""==n;)n=r[i].url,i++}s.cacheUrl3DPhoto=n.substring(n.indexOf("https://")+8),1==a.getPreferenceValue("DebugMode")&&console.timeEnd("[PERFO - x3DPhoto] - getx3DPhoto"),t(r)},onFailure:function(e){r(new Error("Internal Error - getx3DPhoto failed"))}})})},get3DPassport:function(e){return new r(function(t,r){1==a.getPreferenceValue("DebugMode")&&console.time("[PERFO - x3DPhoto] - get3DPassport"),n.getServiceUrl({serviceName:"3DPassport",platformId:e.toUpperCase(),onComplete:function(e){e&&e[0]&&e[0].url&&(e=e[0].url);var r=e.replace(/^https?:\/\//,"");s.cacheUrl3DPassport=r,1==a.getPreferenceValue("DebugMode")&&console.timeEnd("[PERFO - x3DPhoto] - get3DPassport"),t(e)},onFailure:function(e){r(new Error("Internal Error - get3DPassport failed"))}})})},getCollabSpaceList:function(t,n){return new r(function(r,i){1==a.getPreferenceValue("DebugMode")&&console.time("[PERFO - x3DPhoto] - getCollabSpaceList");var o={timeout:15e3,cache:-1,method:"GET",type:"json",headers:{Accept:"application/json","Accept-Language":null},proxy:"passport",onComplete:function(e){for(var t=[],i=0;i<e.length;i++){var o={name:e[i].name,context:e[i].contexts[0]};t.push(o)}t.name=n,1==a.getPreferenceValue("DebugMode")&&console.timeEnd("[PERFO - x3DPhoto] - getCollabSpaceList"),r(t)},onFailure:function(e){i(new Error("Internal Error - getCollabSpaceList failed"))}},s=t+"/resources/enocsmrest/collabspaces?";n&&(s+="tenant="+n),e.Data.request(s,o)})},getTransientTicket:function(){return new r(function(e,t){var r="https://"+s.cacheUrl3DPassport+"/api/authenticated/cas/transient";o.authenticatedRequest(r,{method:"GET",type:"json",onComplete:function(r){r?e(r.x3ds_reauth_url):t()},onFailure:function(){t()}})})},getLoginTicket:function(t,n,i){return new r(function(r,o){1==a.getPreferenceValue("DebugMode")&&console.time("[PERFO - x3DPhoto] - getLoginTicket");var l={timeout:15e3,cache:-1,method:"GET",type:"json",headers:{Accept:"application/json","Accept-Language":null},proxy:"passport",onComplete:function(e){var n={loginTicket:e.ticket,url3DSpace:t};s.cacheloginTicket=e.ticket,1==a.getPreferenceValue("DebugMode")&&console.timeEnd("[PERFO - x3DPhoto] - getLoginTicket"),r(n)},onFailure:function(e){o(new Error("Internal Error - GetLoginTicket failed"))}},u=t+"/ticket/get?";u+=n?"runasctx="+n:"runasctx=preferred",i&&(u+="&tenant="+i),u=encodeURI(u),e.Data.request(u,l)})},setPartID:function(e){s.cachePartId=e},getPassportTicket:function(e,t,r){var n="https://"+s.cacheUrl3DDesign,i=e.passportURL;o.authenticatedRequest(i+"/login?service="+n,{method:"GET",headers:{Accept:"application/json"},onComplete:function(e){var r=JSON.parse(e).access_token;t(n,r)},onFailure:function(e){r("message"),console.log(e)}})},logIn3DDrive:function(){return new e.Promise(function(e,t){var r="https://"+s.cacheUrl3DPassport+"/login?service="+encodeURIComponent(s.cacheUrl3DDrive+"/resources/3ddrive/v1/bos/DSROOT?withactions=true&tenant="+s.cacheTenantID.toUpperCase()+"&serverId=MT_Metadata_0&xrequestedwith=xmlhttprequest");o.authenticatedRequest(r,{method:"GET",type:"json",onComplete:function(r){var n=r.x3ds_service_redirect_url;o.authenticatedRequest(n,{onComplete:function(t){e(t)},onFailure:function(e,r,n){t(e)}})},onFailure:function(e,r,n){t(e)}})})},logInX3DPhoto:function(t){return new e.Promise(function(e,r){var n=s.cacheUrl3DPassport,i=n.split("/"),a="https://"+(i=0===i.length?n:i[0])+"/login?service=https://"+encodeURIComponent(s.cacheUrl3DPhoto+t);o.authenticatedRequest(a,{method:"GET",type:"json",onComplete:function(t){var r=t.x3ds_service_redirect_url;e(r)},onFailure:function(e,t,n){r(e)}})})},getFileListInRoot3DDrive:function(){return new e.Promise(function(e,t){var r=s.cacheUrl3DDrive+"/resources/3ddrive/v1/bos/DSROOT/contents?tenant="+s.cacheTenantID.toUpperCase();o.authenticatedRequest(r,{method:"GET",type:"json",onComplete:function(t,r){var n=Object.keys(r).filter(function(e){return-1!==e.search(/x-ds-csrftoken/i)});this._csrfDrive=r[n[0]],e(t.items)}.bind(this),onFailure:function(e,r,n){t(e)}})}.bind(this))},get3DSwym:function(e){var t=e?e.toUpperCase():null;return new r(function(r,i){e||i(new Error('Cannot get Swym url. Missing parameter "platformId".')),n.getServiceUrl({serviceName:"3DSwym",platformId:t,onComplete:function(e){var n="";t?n=e:e&&e.length&&e[0]&&(console.warn("get3DSwym : PlatformId/Tenant is null so first url of the list is returned"),n=e[0].url),r(n)},onFailure:function(e){e&&console.warn(e),i(new Error("Internal Error - get3DSwym failed"))}})})},getCsrfToken:function(e){var t=a.getPreferenceValue("M3DEMobile")?o.proxifiedRequest:o.authenticatedRequest;return new r(function(r,n){if(!e)return console.warn("Internal Error - getCsrfToken failed because url is null"),void n(new Error("Internal Error - getCsrfToken failed"));t(e+"/api/index/tk",{method:"GET",type:"json",onComplete:function(t){r({token:t.result.ServerToken,url:e})},onFailure:function(e){e&&console.warn(e),n(new Error("Internal Error - getCsrfToken failed"))}})})},getMedia:function(e){if(e.returnPromise)return new r(function(t,r){e.onSuccessCB=t,e.onFailCB=r,this._getMedia(e)}.bind(this));this._getMedia(e)},_getMedia:function(e){var t=a.getPreferenceValue("M3DEMobile")?o.proxifiedRequest:o.authenticatedRequest;return e.mediaId?e.url?void t(e.url+"/api/media/get",{proxy:a.getPreferenceValue("M3DEMobile")?"passport":void 0,method:"POST",type:"json",data:JSON.stringify({request_id:"0",params:{id_media:e.mediaId}}),headers:{"Content-Type":"application/json","X-DS-SWYM-CSRFTOKEN":e.token},onComplete:function(r){var n=r.result;n.play&&n.play.wake_up_url&&""!==n.play.wake_up_url?t(n.play.wake_up_url,{proxy:a.getPreferenceValue("M3DEMobile")?"passport":void 0,method:"GET",type:"json",onComplete:function(){e.onSuccessCB(n)},onFailure:function(t){t&&this._debugMode&&console.warn(t),e.onFailCB(new Error("Internal Error - getMedia failed"))}.bind(this)}):e.onSuccessCB(n)},onFailure:function(t){t&&this._debugMode&&console.warn(t),e.onFailCB(new Error("Internal Error - getMedia failed"))}.bind(this)}):(console.warn("Internal Error - getMedia failed because url is null"),void e.onFailCB(new Error("Internal Error - getMedia failed"))):(console.warn("Internal Error - getMedia failed because media ID is null"),void e.onFailCB(new Error("Internal Error - getMedia failed")))},getCurrentUser:function(e){var t=a.getPreferenceValue("M3DEMobile")?o.proxifiedRequest:o.authenticatedRequest;return new r(function(r,n){return e.url?e.token?void t(e.url+"/api/user/getcurrent",{method:"GET",type:"json",headers:{"Content-Type":"application/json","X-DS-SWYM-CSRFTOKEN":e.token},onComplete:function(e){r(e.result)},onFailure:function(e){e&&console.warn(e),n(new Error("Internal Error - getCurrentUser failed"))}}):(console.warn("Internal Error - getCurrentUser failed because token is null"),void e.onFailCB(new Error("Internal Error - getCurrentUser failed"))):(console.warn("Internal Error - getCurrentUser failed because url is null"),void e.onFailCB(new Error("Internal Error - getCurrentUser failed")))})},addMedia:function(e){if(e.setUrl="/api/media/add",e.returnPromise)return new r(function(t,r){e.onSuccessCB=t,e.onFailCB=r,this._setMedia(e)}.bind(this));this._setMedia(e)},editMedia:function(e){if(e.setUrl="/api/media/edit",e.returnPromise)return new r(function(t,r){e.onSuccessCB=t,e.onFailCB=r,this._setMedia(e)}.bind(this));this._setMedia(e)},_setMedia:function(e){var t=o.authenticatedRequest;return e.url?e.setUrl&&e.formData&&e.formData instanceof FormData?void t(e.url+e.setUrl,{method:"POST",type:"json",data:e.formData,headers:{"X-DS-SWYM-CSRFTOKEN":e.token},timeout:432e5,onComplete:function(t){if(t.errorcode){var r={error:new Error("Internal Error - _setMedia failed")};return e.onFailCB(r),void console.warn("Internal Error - _setMedia failed")}e.onSuccessCB(t)},onFailure:function(t,r){t&&console.warn(t);var n=new Error("Internal Error - _setMedia failed");r&&r.errorcode&&(n.errorcode=r.errorcode);var i={error:n};e.onFailCB(i)},onTimeout:function(t){t&&console.warn(t);var r=new Error("Internal Error - _setMedia timeout");r.isTimeout=!0;var n={error:r};e.onFailCB(n)}}):(console.warn("Internal Error - _setMedia failed because setUrl is null"),void e.onFailCB(new Error("Internal Error - _setMedia failed"))):(console.warn("Internal Error - _setMedia failed because url is null"),void e.onFailCB(new Error("Internal Error - _setMedia failed")))},getDriveFile:function(e){if(e.returnPromise)return new r(function(t,r){e.onSuccessCB=t,e.onFailCB=r,this._getDriveFile(e)}.bind(this));this._getDriveFile(e)},_getDriveFile:function(e){var t=a.getPreferenceValue("M3DEMobile")?o.proxifiedRequest:o.authenticatedRequest;if(!e.objectId)return console.warn("Internal Error - _getDriveFile failed because object ID is null"),void e.onFailCB(new Error("Internal Error - _getDriveFile failed"));if(!e.url)return console.warn("Internal Error - _getDriveFile failed because url is null"),void e.onFailCB(new Error("Internal Error - _getDriveFile failed"));var r=e.url+"/resources/3ddrive/v1/bos/"+e.objectId,n=r+"/fileurl";e.platformId&&(r+="?tenant="+e.platformId.toUpperCase(),n+="?tenant="+e.platformId.toUpperCase()),t(r,{proxy:a.getPreferenceValue("M3DEMobile")?"passport":void 0,method:"GET",type:"json",onComplete:function(r){t(n,{proxy:a.getPreferenceValue("M3DEMobile")?"passport":void 0,method:"GET",type:"json",onComplete:function(t){var n=r;n.fileUrl=t.url,e.onSuccessCB(n)},onFailure:function(t){t&&console.warn(t),e.onFailCB(new Error("Internal Error - _getDriveFile failed"))}})},onFailure:function(t){t&&console.warn(t),e.onFailCB(new Error("Internal Error - _getDriveFile failed"))}})},getCommunities:function(e){var t=a.getPreferenceValue("M3DEMobile")?o.proxifiedRequest:o.authenticatedRequest;return new r(function(r,n){return e.url?e.token?void t(e.url+"/api/community/listmycommunities/limit/128/page/1/creation_granted_for/media",{method:"GET",type:"json",headers:{"Content-Type":"application/json","X-DS-SWYM-CSRFTOKEN":e.token},onComplete:function(e){r(e.result)},onFailure:function(e){e&&console.warn(e),n(new Error("Internal Error - getCommunities failed"))}}):(console.warn("Internal Error - getCommunities failed because token is null"),void n(new Error("Internal Error - getCommunities failed"))):(console.warn("Internal Error - getCommunities failed because url is null"),void n(new Error("Internal Error - getCommunities failed")))})},getConversations:function(e){var t=a.getPreferenceValue("M3DEMobile")?o.proxifiedRequest:o.authenticatedRequest;return new r(function(r,n){return e.url?e.token?void t(e.url+"/api/directmessages/lite?with_favorites=false",{method:"GET",type:"json",headers:{"Content-Type":"application/json","X-DS-SWYM-CSRFTOKEN":e.token},onComplete:function(e){r(e.result)},onFailure:function(e){e&&console.warn(e),n(new Error("Internal Error - getConversations failed"))}}):(console.warn("Internal Error - getConversations failed because token is null"),void n(new Error("Internal Error - getConversations failed"))):(console.warn("Internal Error - getConversations failed because url is null"),void n(new Error("Internal Error - getConversations failed")))})},listMedia:function(e){return new r(function(t,r){e.onSuccessCB=t,e.onFailCB=r,this._listMedia(e)}.bind(this))},_listMedia:function(e){var t=a.getPreferenceValue("M3DEMobile")?o.proxifiedRequest:o.authenticatedRequest;return e.community_id?e.token?e.limit?e.page?void t(e.url+"/api/media/list",{proxy:a.getPreferenceValue("M3DEMobile")?"passport":void 0,method:"POST",type:"json",data:JSON.stringify({params:{community_id:e.community_id,limit:e.limit,page:e.page}}),headers:{"Content-Type":"application/json","X-DS-SWYM-CSRFTOKEN":e.token},onComplete:function(t){e.onSuccessCB(t)},onFailure:function(t){t&&console.warn(t),e.onFailCB(new Error("Internal Error - listMedia failed"))}}):(console.warn("Internal Error - listMedia failed because page is null"),void e.onFailCB(new Error("Internal Error - listMedia failed"))):(console.warn("Internal Error - listMedia failed because limit is null"),void e.onFailCB(new Error("Internal Error - listMedia failed"))):(console.warn("Internal Error - listMedia failed because token is null"),void e.onFailCB(new Error("Internal Error - listMedia failed"))):(console.warn("Internal Error - listMedia failed because community_id is null"),void e.onFailCB(new Error("Internal Error - listMedia failed")))},search:function(e){var t=a.getPreferenceValue("M3DEMobile")?o.proxifiedRequest:o.authenticatedRequest;return new r(function(r,n){return e.url?e.token?void t(e.url+"/api/exalead/search?xrequestedwith=xmlhttprequest",{method:"POST",headers:{"Content-Type":"application/json","X-DS-SWYM-CSRFTOKEN":e.token},data:JSON.stringify({params:{legacyFormat:e.legacyFormat,query:e.query,contentType:e.contentType,refineUsingQuery:e.refineUsingQuery,nresults:e.nresults,start:e.start}}),timeout:15e3,onComplete:function(e){var t=JSON.parse(e);r(t)},onFailure:function(e){e&&console.warn(e),n(new Error("Internal Error - search failed"))},onTimeout:function(){n(new Error("Internal Error - search timed out"))}}):(console.warn("Internal Error - search failed because token is null"),void n(new Error("Internal Error - search failed"))):(console.warn("Internal Error - search failed because url is null"),void n(new Error("Internal Error - search failed")))})},deleteMedia:function(e){var t=a.getPreferenceValue("M3DEMobile")?o.proxifiedRequest:o.authenticatedRequest;return new r(function(r,n){return e.url?e.token?e.mediaId?void t(e.url+"/api/media/delete",{proxy:a.getPreferenceValue("M3DEMobile")?"passport":void 0,method:"POST",type:"json",data:JSON.stringify({params:{id_media:e.mediaId}}),headers:{"Content-Type":"application/json","X-DS-SWYM-CSRFTOKEN":e.token},onComplete:function(e){r()},onFailure:function(e){e&&console.warn(e),n(new Error("Internal Error - deleteMedia failed"))}}):(console.warn("Internal Error - deleteMedia failed because url is null"),void n(new Error("Internal Error - deleteMedia failed"))):(console.warn("Internal Error - deleteMedia failed because token is null"),void n(new Error("Internal Error - deleteMedia failed"))):(console.warn("Internal Error - deleteMedia failed because url is null"),void n(new Error("Internal Error - deleteMedia failed")))})},checkIfMediaExists:function(e){if(e.returnPromise)return new r(function(t){e.onSuccessCB=t,e.onFailCB=t,this._getMedia(e)}.bind(this));this._getMedia(e)},searchMedia:function(t){return t.url?t.platform_id?t.current_user?t.media_type?new Promise(function(r){var n={label:"6WTagger-"+t.current_user+"-"+(new Date).getTime(),query:'[ds6w:responsibleUid]:("'+t.current_user+'") AND [ds6w:type]:("swym:'+t.media_type+'")',with_synthesis:!1,source:["swym"],select_predicate:["ds6w:media","ds6w:community","ds6w:label","ds6w:modified","swym:publicationState","ds6w:containerUid"],tenant:t.platform_id,nresults:t.page_size,start:t.page,specific_source_parameter:{swym:{withDraft:!0,moderationMode:!1}}},i={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},data:e.Json.encode(n),url:t.url+"/search",onComplete:function(e){r(JSON.parse(e))},onFailure:function(e){r(e)}};o.authenticatedRequest(i.url,i)}):(console.warn("Internal Error - searchMedia failed because media_type is null"),void reject(new Error("Internal Error - searchMedia failed"))):(console.warn("Internal Error - searchMedia failed because current_user is null"),void reject(new Error("Internal Error - searchMedia failed"))):(console.warn("Internal Error - searchMedia failed because platform_id is null"),void reject(new Error("Internal Error - searchMedia failed"))):(console.warn("Internal Error - searchMedia failed because url is null"),void reject(new Error("Internal Error - searchMedia failed")))},callPlatformWebService:function(e){if(e.returnPromise)return new r(function(t,r){e.onSuccessCB=t,e.onFailCB=r,this._callPlatformWebService(e)}.bind(this));this._callPlatformWebService(e)},_callPlatformWebService:function(e){var t=a.getPreferenceValue("M3DEMobile")?o.proxifiedRequest:o.authenticatedRequest;return e.api?e.token?e.params?e.url?void t(e.url+e.api,{proxy:a.getPreferenceValue("M3DEMobile")?"passport":void 0,method:"POST",type:"json",data:JSON.stringify({request_id:"0",params:e.params}),headers:{"Content-Type":"application/json","X-DS-SWYM-CSRFTOKEN":e.token},onComplete:function(t){e.onSuccessCB(t)},onFailure:function(t){t&&this._debugMode&&console.warn(t),e.onFailCB(new Error("Internal Error - callPlatformWebService failed"))}.bind(this)}):(console.warn("Internal Error - callPlatformWebService failed because url is null"),void e.onFailCB(new Error("Internal Error - callPlatformWebService failed"))):(console.warn("Internal Error - callPlatformWebService failed because postparams is null"),void e.onFailCB(new Error("Internal Error - callPlatformWebService failed"))):(console.warn("Internal Error - callPlatformWebService failed because token is null"),void e.onFailCB(new Error("Internal Error - getCurrentUser failed"))):(console.warn("Internal Error - callPlatformWebService failed because api is null"),void e.onFailCB(new Error("Internal Error - callPlatformWebService failed")))}});return e.namespace("DS/CAT3DWInfra/CAT3DWPlateformServices",s)}),define("DS/CAT3DWInfra/CAT3DW3DSwymMediaServices",["UWA/Class","UWA/Promise","DS/CAT3DWInfra/CAT3DWPlateformServices","DS/CAT3DWInfra/CAT3DWQueuePromise","DS/CAT3DWInfra/CAT3DWPreferenceManager","DS/CAT3DWInfra/CAT3DWFileServices"],function(e,t,r,n,i,o){"use strict";return e.extend({init:function(e){this._platformId=e.platformId,this._platformUrl=e.platformUrl,this._platformId||this._platformUrl||console.warn("A platformId or a platformUrl must be provided"),this._fileServices=new o,this._errorImageName=this._fileServices.getErrorImageName(),this._runningTokenRequest=null,this._token=null,this._tokenCreationTime=0,this._tokenExpirationTime=1e4,this._maxNbGet=5,this._maxNbGetDelay=500,this._listOfMediaToGet=[],this._nbRunningGet=0,this._getStartTime=0,this._getIntervalToken=void 0},dispose:function(){this._platformId=null,this._platformUrl=null,this._fileServices.dispose(),this._fileServices=null,this._errorImageName=null,this._runningTokenRequest=null,this._token=null,this._tokenCreationTime=null,this._tokenExpirationTime=null,this._maxNbGet=null,this._maxNbGetDelay=null,this._listOfMediaToGet=[],this._nbRunningGet=null,this._getStartTime=null,this._getIntervalToken=null},getToken:function(e){return this._runningTokenRequest?this._runningTokenRequest.then(e=>e):Date.now()-this._tokenCreationTime>this._tokenExpirationTime?(this._tokenCreationTime=Date.now(),this._runningTokenRequest=r.getCsrfToken(e),this._runningTokenRequest.then(e=>(this._runningTokenRequest=null,this._token=e,e))):new Promise(e=>{e(this._token)})},getPlatformUrl:function(){return this._platformUrl?new t(function(e){e(this._platformUrl)}.bind(this)):r.get3DSwym(this._platformId)},requestSingleMedia:function(e){return new Promise(t=>{this._listOfMediaToGet.push({media:e,callback:e=>{var r=this._parseSwymGetMediasData([e]);t(r[0])}}),this._processListOfMedia()})},_processListOfMedia:function(){Date.now()-this._getStartTime>this._maxNbGetDelay&&(this._getStartTime=Date.now(),this._nbRunningGet=0);let e=null;for(;this._nbRunningGet<this._maxNbGet&&this._listOfMediaToGet.length>0;)this._nbRunningGet++,e=this._listOfMediaToGet.shift(),this._runGetMedia(e.media,e.callback);0===this._listOfMediaToGet.length?(clearInterval(this._getIntervalToken),this._getIntervalToken=void 0):this._getIntervalToken||(this._getIntervalToken=setInterval(this._processListOfMedia.bind(this),this._maxNbGetDelay))},_runGetMedia:function(e,t){this.getPlatformUrl().then(this.getToken.bind(this)).then(n=>{r.getMedia({url:n.url,mediaId:e.mediaId,token:n.token,returnPromise:!1,onSuccessCB:r=>{r.processed_media_id=e.mediaId,r.associatedData=e.associatedData,t(r)},onFailCB:()=>{t({processed_media_id:e.mediaId,associatedData:e.associatedData})}})})},getMedia:function(e){return new t(function(t,r){this.getMedias([e],null).then(function(e){t(e[0])}).catch(function(e){e&&console.log(e),r(new Error("Get media failed"))})}.bind(this))},getMedias:function(e,i){return new t(function(o,a){if(!e){var s="Can't get medias, list of medias is null";return console.warn(s),i&&(i=null),void a(new Error(s))}(function(){return this._platformUrl?new t(function(e){e(this._platformUrl)}.bind(this)):r.get3DSwym(this._platformId)}).bind(this)().then(r.getCsrfToken.bind(this)).then(function(t){var s=Math.round(90/e.length);this._inc=0;for(var l=[],u=0;u<e.length;u++)l.push(new n(function(e,n){e&&!e.associatedData&&(e.associatedData={}),e&&e.mediaId?r.getMedia({url:t.url,mediaId:e.mediaId,token:t.token,returnPromise:!1,onSuccessCB:function(e,t){this._inc++;var r=this._inc*s<=100?this._inc*s:100;i&&i(r),t.processed_media_id=e.mediaId,t.associatedData=e.associatedData,n(t)}.bind(this,e),onFailCB:function(e){this._inc++;var t=this._inc*s<=100?this._inc*s:100;i&&i(t),n({processed_media_id:e.mediaId,associatedData:e.associatedData})}.bind(this,e)}):n({processed_media_id:null,associatedData:e?e.associatedData:{}})}.bind(this,e[u])));(new n).all(l,5,{delay:600,limit:5}).then(function(e){i&&(i=null);var t=this._parseSwymGetMediasData(e);o(t)}.bind(this)).catch(function(e){i&&(i=null),e&&console.log(e),a(new Error("Get medias failed"))})}.bind(this)).catch(function(e){i&&(i=null),e&&console.log(e),a(new Error("Get medias failed"))})}.bind(this))},setMedia:function(e){return new t(function(t,r){this.setMedias([e],null).then(function(e){t(e[0])}).catch(function(e){e&&console.log(e),r(new Error("Set media failed"))})}.bind(this))},setMedias:function(e,i){return new t(function(o,a){if(!e){var s="Can't set medias, list of medias is null";return console.warn(s),i&&(i=null),void a(new Error(s))}(function(){return this._platformUrl?new t(function(e){e(this._platformUrl)}.bind(this)):r.get3DSwym(this._platformId)}).bind(this)().then(r.getCsrfToken.bind(this)).then(function(t){var s=Math.round(90/e.length);this._inc=0;for(var l=[],u=0;u<e.length;u++)l.push(new n(function(e,n){if(e){var o={url:t.url,formData:e.formData,token:t.token,returnPromise:!1,onSuccessCB:function(e,t){t.associatedData=e.associatedData;var r=this._parseSwymSetMediaData(t);this._inc++;var o=this._inc*s<=100?this._inc*s:100;i&&i(o,r),n(r)}.bind(this,e),onFailCB:function(e,t){this._inc++;var r=this._inc*s<=100?this._inc*s:100;t.associatedData=e.associatedData;var o=this._parseSwymSetMediaData(t);i&&i(r,o),n(o)}.bind(this,e)};e.edit?r.editMedia(o):r.addMedia(o)}else n()}.bind(this,e[u])));(new n).all(l,3,{delay:2e3,limit:3}).then(function(e){i&&(i=null),o(e)}).catch(function(e){i&&(i=null),e&&console.log(e),a(new Error("Set medias failed"))})}.bind(this)).catch(function(e){i&&(i=null),e&&console.log(e),a(new Error("Set medias failed"))})}.bind(this))},deleteMedia:function(e){return new t(function(t,n){this.getPlatformUrl().then(r.getCsrfToken.bind(this)).then(i=>{r.deleteMedia({token:i.token,url:i.url,mediaId:e.subject6wuri}).then(function(){t()}).catch(function(){n(new Error("Delete media failed"))})}).catch(function(){n(new Error("Delete media failed"))})}.bind(this))},_parseSwymGetMediasData:function(e){if(!e||!e.length)return[];for(var t=[],r={},n=0;n<e.length;n++)if(e[n]&&e[n].processed_media_id)if(e[n].subject6wuri||!e[n].processed_media_id){if(r={published:parseInt(e[n].published),mediaId:e[n].subject6wuri,title:e[n].title,orig_name:e[n].orig_name,extension:this._fileServices.extractExtensionFromName(e[n].orig_name),format:e[n].media_type===o.TYPE_3DMODEL||"sketch"===e[n].media_type?o.FORMAT_3D:o.FORMAT_2D,associatedData:e[n].associatedData},(e[n].media_type===o.TYPE_3DMODEL||"sketch"===e[n].media_type)&&this._fileServices.getSupportedExtensions(o.TYPE_3DMODEL).indexOf(r.extension)>-1)r.type=o.TYPE_3DMODEL,"processed"===e[n].status&&(r.url=e[n].play["3d_streams"][0].transient_url,r.extension=e[n].play.download_original_url.format);else if(e[n].media_type===o.TYPE_IMAGE&&this._fileServices.getSupportedExtensions(o.TYPE_IMAGE).indexOf(r.extension)>-1)r.type=o.TYPE_IMAGE,"processed"===e[n].status&&(r.url=e[n].play["2d_streams"][0].transient_url);else if((e[n].media_type===o.TYPE_VIDEO||"animatedPicture"===e[n].media_type)&&this._fileServices.getSupportedExtensions(o.TYPE_VIDEO).indexOf(r.extension)>-1){if(r.type=o.TYPE_VIDEO,"processed"===e[n].status)(e[n].play.av_streams?e[n].play.av_streams.length:0)&&(r.url=e[n].play.av_streams[0].transient_url),r.url||"animatedPicture"!==e[n].media_type||(r.type=o.TYPE_IMAGE,r.url=e[n].play.view[0].transient_url)}else if("document"===e[n].media_type)if("processed"===e[n].status){r.type=o.TYPE_UNSUPPORTED,r.url=null;for(var a=e[n].play.doc_streams,s=0;s<a.length;s++)a[s].format===o.TYPE_PDF&&(r.type=o.TYPE_PDF,r.url=a[s].transient_url)}else r.type=o.TYPE_DOCUMENT;else r.type=o.TYPE_UNSUPPORTED,r.url=null;"processed"===e[n].status?(r.status=o.STATUS_OK,r.size=e[n].size,r.url&&i.getPreferenceValue("M3DEMobile")&&(r.url=UWA.Data.proxifyUrl(r.url,{proxy:"passport"}))):(r.status=o.STATUS_PROCESSING,r.url=this._fileServices.getProcessingImagePlaceholderUrl(),r.size=0),t.push(r)}else t.push({published:0,mediaId:e[n].processed_media_id,status:o.STATUS_KO,format:o.FORMAT_2D,type:o.TYPE_IMAGE,url:this._fileServices.getErrorImagePlaceholderUrl(),title:"Error",orig_name:this._errorImageName,extension:this._fileServices.extractExtensionFromName(this._errorImageName),size:0,associatedData:e[n].associatedData});else t.push({published:0,mediaId:null,status:null,format:o.FORMAT_NONE,type:null,url:null,associatedData:e[n]?e[n].associatedData:{}});return t},_parseSwymSetMediaData:function(e){var t={associatedData:e.associatedData};if(e.error)t.error=e.error;else{var r=e.result._community?e.result._community:e.result.community;t.threadType=r.community_type,t.threadId=r.id,t.mediaId=e.result.subject6wuri,t.media=e.result}return t}})}),define("DS/CAT3DWInfra/CAT3DW3DDriveServices",["UWA/Class","UWA/Promise","DS/CAT3DWInfra/CAT3DWPlateformServices","DS/CAT3DWInfra/CAT3DWQueuePromise","DS/CAT3DWInfra/CAT3DWPreferenceManager","DS/CAT3DWInfra/CAT3DWFileServices"],function(e,t,r,n,i,o){"use strict";return e.extend({init:function(e){this.initPlatform(e),this._fileServices=new o},initPlatform:function(e){this._platformId=e.platformId,this._platformUrl=e.platformUrl,this._platformId||this._platformUrl||console.warn("[3DDriveServices] A platformId or a platformUrl must be provided")},getFile:function(e){return new t(function(t,r){this.getFiles([e],null).then(function(e){t(e[0])}).catch(function(e){e&&console.log(e),r(new Error("Get file failed"))})}.bind(this))},getFiles:function(e,i){return new t(function(o,a){if(!e){var s="Can't get files, list of files is null";return console.warn(s),i&&(i=null),void a(new Error(s))}(function(){return this._platformUrl?new t(function(e){e(this._platformUrl)}.bind(this)):r.get3DDrive(this._platformId)}).bind(this)().then(function(t){var s=Math.round(90/e.length);this._inc=0;for(var l=[],u=function(e,n){e&&!e.associatedData&&(e.associatedData={}),e&&e.objectId?r.getDriveFile({url:t,objectId:e.objectId,platformId:this._platformId,returnPromise:!1,onSuccessCB:function(e,t){this._inc++;var r=this._inc*s<=100?this._inc*s:100;i&&i(r),t.processed_file_id=e.objectId,t.associatedData=e.associatedData,n(t)}.bind(this,e),onFailCB:function(e){this._inc++;var t=this._inc*s<=100?this._inc*s:100;i&&i(t),n({processed_file_id:e.objectId,associatedData:e.associatedData})}.bind(this,e)}):n({processed_file_id:null,associatedData:e?e.associatedData:{}})}.bind(this),c=0;c<e.length;c++)l.push(new n(u.bind(this,e[c])));(new n).all(l,5,{delay:600,limit:5}).then(function(e){i&&(i=null);var t=this._parseDriveGetFilesData(e);o(t)}.bind(this)).catch(function(e){i&&(i=null),e&&console.log(e),a(new Error("Get files failed"))})}.bind(this))}.bind(this))},_parseDriveGetFilesData:function(e){if(!e||!e.length)return[];for(var t=[],r={},n=0;n<e.length;n++)if(e[n]&&e[n].processed_file_id)if(e[n].id||!e[n].processed_file_id){var a=this._fileServices.getTypeObjFromExtension(e[n].extension);(r={objectId:e[n].id,status:o.STATUS_OK,title:e[n].title,extension:e[n].extension,format:a.format,type:a.label,url:e[n].fileUrl,size:e[n].size,associatedData:e[n].associatedData}).url&&i.getPreferenceValue("M3DEMobile")&&(r.url=UWA.Data.proxifyUrl(r.url,{proxy:"passport"})),t.push(r)}else t.push({objectId:e[n].processed_file_id,status:o.STATUS_KO,format:o.FORMAT_2D,type:o.TYPE_IMAGE,url:this._fileServices.getErrorImagePlaceholderUrl(),title:"Error",extension:this._fileServices.extractExtensionFromName(this._fileServices.getErrorImageName()),size:0,associatedData:e[n].associatedData});else t.push({objectId:null,status:null,format:o.FORMAT_NONE,type:null,url:null,associatedData:e[n]?e[n].associatedData:{}});return t}})}),define("DS/CAT3DWInfra/CAT3DWLocalStorageManager",["UWA/Class","DS/CAT3DWInfra/CAT3DWPreferenceManager"],function(e,t){"use strict";var r=e.extend({init:function(){this.PREFIX="3DSketch",this.SEPARATOR="-"},setItem:function(e,t){try{window.localStorage.setItem(e,JSON.stringify(t))}catch(e){console.error(e)}},getItem:function(e,t){return JSON.parse(window.localStorage.getItem(e))},removeItem:function(e,t){window.localStorage.removeItem(e)},setPrefixedItem:function(e,t,r){try{window.localStorage.setItem(this._buildPrefixedKey(e,r),JSON.stringify(t))}catch(e){console.error(e)}},getPrefixedItem:function(e,t){return JSON.parse(window.localStorage.getItem(this._buildPrefixedKey(e,t)))},removePrefixedItem:function(e,t){window.localStorage.removeItem(this._buildPrefixedKey(e,t))},_buildPrefixedKey:function(e,r){var n,i=this.PREFIX,o=!1,a=t.getPreferenceValue("swymTenant").toUpperCase();if(!r)throw new Error("The options object is not defined");return!0===r.tenant&&r.widget&&r.widget.id?(i+=this.SEPARATOR+a+this.SEPARATOR+r.widget.id,o=!0):!0===r.tenant?(i+=this.SEPARATOR+a,o=!0):r.widget&&r.widget.id&&(i+=this.SEPARATOR+r.widget.id,o=!0),!0===o?n=i+this.SEPARATOR+e:Logger.error("Either the tenant or the widget should be specified in the options object"),n}});return UWA.namespace("DS/CAT3DWInfra/CAT3DWLocalStorageManager",r)}),define("DS/CAT3DWInfra/CAT3DWUserGroupService",["UWA/Class","DS/WAFData/WAFData","DS/CAT3DWInfra/CAT3DWLocalStorageManager","DS/CAT3DWInfra/CAT3DWPreferenceManager","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices"],function(e,t,r,n,i){"use strict";var o=e.extend({init:function(){this.FEATUREGROUPKEY="feature-groups",this.FEATURE_GROUP_CACHE_DURATION=48,this.featureGroupCache=[],this._fedSearchUrl=null,this.LSManager=new r},getFedsearchURL:function(e){return new Promise(function(t,r){this._fedSearchUrl?t(this._fedSearchUrl):i.getServiceUrl({serviceName:"3DSearch",platformId:e,onComplete:function(e){e?this._fedSearchUrl=e:console.error("There is no fedsearch url returned by I3DXCompassPlatformServices.getServiceUrl "+e),t(this._fedSearchUrl)},onFailure:r})}.bind(this))},find:function(e,t){if(Array.isArray(e))for(var r=0;r<e.length;r++)if(e[r].name===t)return e[r];return!1},callFedSearch:function(e,r,n,i,o){this.getFedsearchURL(o).then(function(a){t.authenticatedRequest(a+"/search",{method:"POST",headers:{"Content-Type":"application/json"},type:"json",data:JSON.stringify({with_synthesis:!1,with_nls:!1,label:n,select_predicate:["ds6w:hasMember"],with_synthesis_hierarchical:!1,query:'[ds6w:type]:"foaf:Group" AND [ds6w:label]:"'+i+'"',source:["usersgroup"],tenant:o}),onComplete:function(t){var r=!1,o=t.results;r=!!Array.isArray(o)&&o.some(function(e){return e&&e.attributes&&e.attributes.some(function(e){return"ds6w:hasMember"===e.name&&e.value===n})});var a=this.featureGroupCache&&this.find(this.featureGroupCache,i);if(a)a.isMember=r,a.cacheDate=(new Date).toISOString();else{var s={name:i,isMember:r,cacheDate:(new Date).toISOString()};this.featureGroupCache.push(s)}this.LSManager.setPrefixedItem(this.FEATUREGROUPKEY,this.featureGroupCache,{tenant:!0}),e(r)}.bind(this),onFailure:function(e){r(e)}})}.bind(this))},isMember:function(e,t){var r=n.getPreferenceValue("swymTenant").toUpperCase();this.featureGroupCache=this.LSManager.getPrefixedItem(this.FEATUREGROUPKEY,{tenant:!0})||[];var i=this.featureGroupCache&&this.find(this.featureGroupCache,t);return new Promise(function(n,o){if(i){var a=new Date(i.cacheDate);Math.abs(Date.now()-a.getTime())/36e5>this.FEATURE_GROUP_CACHE_DURATION?this.callFedSearch(n,o,e,t,r):n(i.isMember)}else this.callFedSearch(n,o,e,t,r)}.bind(this))}});return UWA.namespace("DS/CAT3DWInfra/CAT3DWUserGroupService",o)}),define("DS/CAT3DWInfra/CAT3DWUrlServices",["UWA/Class","UWA/Core","DS/CAT3DWInfra/CAT3DWPreferenceManager"],function(e,t,r){"use strict";var n=e.extend({init:function(){this._urlAppliParams={}},dispose:function(){this._urlAppliParams=null},isValidHttpUrl:function(e){var t;try{if(!e.contains("."))return!1;(e=e.trim()).startsWith("http://")||e.startsWith("https://")||(e="https://"+e),t=decodeURIComponent(e),t=new URL(t)}catch(e){return!1}return"http:"===t.protocol||"https:"===t.protocol},generateUrlWithSuffix:function(e){if(!this.isValidHttpUrl(e))return e;var t,n=window.location.host.split(".");t=r.getPreferenceValue("isMDE")||window.ds&&window.ds.isMDE?e.contains("%3F")?"%26sketch":"3Fsketch":e.contains("?")?"&sketch":"?sketch";var i=n[0];null!=i&&i.length>0?t+="_"+i.toLowerCase().replace(/[^a-z0-9-_]/g,""):t+="_localhost";return e+t},parseUrl:function(e){var t=null;t=e?(t=e.split("?"))[1]:window.location.search.substr(1),this._urlAppliParams=this._getURLParams(t)},getURLParam:function(e){return this._urlAppliParams[e.toLowerCase()]},getURLParamAsBoolean:function(e){var t=this._urlAppliParams[e.toLowerCase()],r=typeof t;return("object"!==r||null!==t)&&"undefined"!==r&&("string"===r?"1"===t||"true"===t:"number"===r?1===t:"boolean"===r&&t)},_getURLParams:function(e){var t={};if(e)for(var r,n=e.split("&"),i=0;i<n.length;i++)1===(r=n[i].split("=")).length?t[r[0].toLowerCase()]=!0:r[1].includes("base64")||this._isUrl(r[1])?t[r[0].toLowerCase()]=r[1]:t[r[0].toLowerCase()]=r[1].toLowerCase();return t},_isUrl:function(e){return!!new RegExp("^(https?:\\/\\/)?((([a-z\\d]([a-z\\d-]*[a-z\\d])*)\\.)+[a-z]{2,}|((\\d{1,3}\\.){3}\\d{1,3}))(\\:\\d+)?(\\/[-a-z\\d%_.~+]*)*(\\?[;&a-z\\d%_.~+=-]*)?(\\#[-a-z\\d_]*)?$","i").test(e)}});return t.namespace("DS/CAT3DWInfra/CAT3DWUrlServices",n)}),define("DS/CAT3DWInfra/CAT3DWInitWidget",["UWA/Class","UWA/Core","DS/CAT3DWInfraVC/CAT3DWNavigationController","DS/CAT3DWInfra/CAT3DWPreferenceManager","DS/CAT3DWInfra/CAT3DWUrlServices","DS/RuntimeView/NLSManager","DS/UWPClientCode/I18n","DS/Usage/TrackerAPI"],function(e,t,r,n,i,o,a,s){"use strict";var l=e.extend({init:function(){this._viewParams={myWidgetObject:null,container:null},this._urlServices=new i,this._parent(),window.ThreeDSketchVersion="1.24"},initODTWidget:function(e){this._urlServices.parseUrl(e.uwaUrl),this.widget=e,this.widget.body.empty(),this._appContainer=t.createElement("div",{id:"webapp-container"}).inject(this.widget.body),this.widget.setTitle(""),this.initialize()},initFrame:function(e,r){if(this._urlServices.parseUrl(e.uwaUrl),this.widget=e,this.widget.body.empty(),this._appContainer=t.createElement("div",{id:"webapp-container"}).inject(this.widget.body),e.addEvent("onResize",function(){this.onResize()}.bind(this)),e.addEvent("onRefresh",function(){this.onRefresh()}.bind(this)),r)for(var i in r)n.setPreferenceValue(i,r[i]);this.initialize(),this.onWidgetReady();var o=n.getPreferenceValue("isMDE"),a=n.getPreferenceValue("swymTenant");o?"whiteboard"===n.getPreferenceValue("appMode")?s.trackPageEvent({eventCategory:"3DWhiteboard_OpenFrom",eventAction:"3DWhiteboard_OpenFromM3DE",eventLabel:"3DWhiteboard opened from M3DE",appID:"CAT3DSKT_AP",tenant:a,persDim:{pd1:window.ThreeDSketchVersion}}):s.trackPageEvent({eventCategory:"3DSketch_OpenFrom",eventAction:"3DSketch_OpenFromM3DE",eventLabel:"3sketch opened from M3DE",appID:"CAT3DSKT_AP",tenant:a,persDim:{pd1:window.ThreeDSketchVersion}}):"whiteboard"===n.getPreferenceValue("appMode")?(this.widget.setTitle("3DWhiteboard"),s.trackPageEvent({eventCategory:"3DWhiteboard_OpenFrom",eventAction:"3DWhiteboard_OpenFromSwym",eventLabel:"3DWhiteboard opened from Swym",appID:"CAT3DSKT_AP",tenant:a,persDim:{pd1:window.ThreeDSketchVersion}})):(this.widget.setTitle("3DSketch"),s.trackPageEvent({eventCategory:"3DSketch_OpenFrom",eventAction:"3DSketch_OpenFromSwym",eventLabel:"3sketch opened from Swym",appID:"CAT3DSKT_AP",tenant:a,persDim:{pd1:window.ThreeDSketchVersion}}))},initialize:function(){var e;this._viewParams.myWidgetObject=this.widget,this._viewParams.container=this._appContainer,this._waitTopBar=!1,this.widget?e=this.widget.getValue("lang"):a=a.getCurrentLanguage(),require.config({config:{i18n:{locale:e}}}),window.dsLang=e,n.setPreferenceValue("lang",e),e&&n.setPreferenceValue("langLocalizedName",a.getSupportedLanguages()[e].localizedName),o.init(),o.DEFAULT_LANGUAGE=n.getPreferenceValue("lang"),this._WidgetNavigationViewController=new r({NavigationControllerName:"WidgetNavigationContoller"}),this.widget?(this.widget.controller=this._WidgetNavigationViewController,n.setPreferenceValue("WidgetID",this.widget.id),this.widget.uwaUrl?(this._WidgetNavigationViewController.SetTopBarAccess(this.widget.id,"3DDashboard"),n.setPreferenceValue("StandAloneWidget",!1)):(n.setPreferenceValue("StandAloneWidget",!0),n.setPreferenceValue("MobileMode",this._urlServices.getURLParamAsBoolean("MOBILE"))),n.setPreferenceValue("ODTMode",this.widget.getValue("ODTMode"))):n.setPreferenceValue("StandAloneWidget",!1);var t=this._urlServices.getURLParam("debug"),i=!1;t?i=!0:this.widget&&"true"===(t=this.widget.getValue("DebugMode"))&&(i=!0),i&&n.setPreferenceValue("DebugMode",i),n.setPreferenceValue("PickingDebug",this._urlServices.getURLParamAsBoolean("pickingdebug")),"ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch?n.setPreferenceValue("DeviceTouch",!0):n.setPreferenceValue("DeviceTouch",!1),this._setCrossOrigin("use-credentials")},onWidgetLoad:function(){if(this._waitTopBar)var e=setInterval(function(){this._waitTopBar||(clearInterval(e),this.onWidgetReady())}.bind(this),100);else this.onWidgetReady()},onWidgetReady:function(){(n.getPreferenceValue("StandAloneWidget")||n.getPreferenceValue("ODTMode"))&&require(["DS/Core/Core"],function(e){e.setFullscreen()});"undefined"===n.getPreferenceValue("ODTMode")&&this.onResize()},onResize:function(e){this.setWidget(e),this._WidgetNavigationViewController.onResize()},setWidget:function(e){this.widget=e},onRefresh:function(e){e.isEdit||(this.setWidget(e),this._WidgetNavigationViewController.onRefresh())},onDestroy:function(){this._WidgetNavigationViewController.onDestroy()},initTopBarMobile:function(e,t){this._waitTopBar=!0;require({baseUrl:"../"},["DS/TopFrame/TopFrame","DS/TopBar/TopBar","css!TopBar/TopBar.css","css!TopFrame/TopFrame.css","css!i3DXCompass/i3DXCompass.css"],function(r,i){var o={userId:"CUO",userName:"CUO",brand:"",lang:n.getPreferenceValue("lang"),transparentMode:!0,baseImgPath:"../plugins/Compass/html/",baseHtmlPath:"../plugins/Compass/images/",application:e,activateFederatedSearch:!1,useTagger:!1,startupParams:{instantMessaging:[{id:"TENANTID",displayName:"TENANTID",url:"default6WTagsServicesURL"}],swym:[{id:"TENANTID",displayName:"TENANTID",url:"default6WTagsServicesURL"}]}};r.init(o),i.MainMenuBar.setActiveMenuProviders([e,"3DShapeWeb"]),this._waitTopBar=!1;var a=document.getElementsByClassName("profile-picture");a.length&&a[0].addClassName("wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-topbar-user"),t&&t()}.bind(this));var r=document.getElementsByClassName("module moduleUwa windowed-view");r.length&&r[0].setStyle("padding-top","43px")},_setCrossOrigin:function(e){n.setPreferenceValue("CrossOrigin",e);var t=null;switch(e){case"anonymous":t=!1;break;case"use-credentials":t=!0;break;default:t=null}n.setPreferenceValue("UseCredentials",t)}});return t.namespace("DS/CAT3DWInfra/CAT3DWInitWidget",l)});