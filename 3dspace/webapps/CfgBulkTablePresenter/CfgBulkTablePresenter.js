define("DS/CfgBulkTablePresenter/BulkEdition/Presenter/CfgAutocomplete",["UWA/Core","DS/Utilities/Dom","DS/Controls/Abstract","DS/Controls/SelectionChips","DS/Controls/LineEditor","DS/Controls/Popup","DS/DataGridView/DataGridView","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/Utilities/Array","DS/Utilities/KeyboardUtils","DS/Utilities/Utils","DS/Core/PointerEvents","DS/Menu/Menu","css!DS/CfgBulkTablePresenter/BulkEdition/Presenter/CfgAutoComplete.css"],function(e,t,i,o,s,n,a,l,r,d,h,u,c,p){"use strict";var m=10;function _(e){return void 0!==e?Array.isArray(e)?this.multiSearchMode?e:[e[0]]:[e]:[]}function f(e){var t=this;I.call(t,t._valueOperation,{operationType:t._valueUpdated.ADD,noOfItemsModified:1},function(){var i=this.value;this.multiSearchMode?e&&""!==e&&(Array.isArray(i)?(i=i.slice(0),d.pushUnique(i,e)):i=[e],t._editor&&(t._editor.value="")):i=e,t.value=i})}function v(e,t){let i=!1,o=0;if(this.popupSizeAdjustPolicy===n.SizeAdjustPolicyEnum.NoAdjust)o=this._DGVContainerFitWidth;else if(this._dataGridView){const e=this._numberOfItems>m?u.getScrollbarWidth():0,t=this._dataGridView._getMaxContentSizeInfo("tree",{computeAllRows:this.popupSizeAdjustPolicy===n.SizeAdjustPolicyEnum.AdjustToAllContents}).maxContentSize;o=Math.max(this._DGVContainerMinWidth,t+e),this._DGVContainerWidth!==o&&(this._DGVContainerMinWidth=o)}if(e){const t=this._DGVContainerFitWidth+e.left+e.right;o=Math.min(o,t)}return 0!==o&&this._DGVContainerWidth!==o&&(this._DGVContainerWidth=o,this._dataGridViewContainer.setStyle("width",o+"px"),i=!0),(i||t)&&this.elements.popup._updateView(),!this._popupVisibility&&this.elements.popup&&this.elements.popup.visibleFlag&&(this._popupVisibility=!0,this.elements.popup.getContent().setStyle("visibility","visible"),this.fire("popupVisibilityChange")),i||t}function g(e){const t=function(e){let t=0;if(e){const i=this._dataGridView?this._dataGridView.layout.getRowHeight():27;let o=e.bottom-4,s=o/i;0===(t=Math.floor(s))&&(s=(o=e.top-4)/i,t=Math.floor(s))}else this._numberOfItems=0,this._model&&(this._numberOfItems=this._model.getNumberOfVisibleDescendants()),t=this._numberOfItems;if(this._nbItemsToDisplay=Math.min(t,m),!this._dataGridView||!this._dataGridViewContainer)return!1;let i=!1;const o=this._dataGridView.layout.getRowHeight(),s=0===this._nbItemsToDisplay?1:this._nbItemsToDisplay,n=(this._pendingPromise?80:o*s)+"px";return this._dataGridViewContainer.style.height!==n&&(this._dataGridViewContainer.style.height=n,i=!0),i}.call(this,e);return v.call(this,e,t)}function y(){var e=void 0;this._selectionChips&&(e=this._selectionChips.getContent().getDimensions().height),e>this._selectionChipsHeight?null!=this.elements.popup&&this.elements.popup._updateView():e<this._selectionChipsHeight&&g.call(this),this._selectionChipsHeight=e}function C(e){this.filterCB(e),g.call(this)}function M(e){var t=V.call(this,e);if(t.length>0&&t[0])this._model&&this._model.getNthRoot(0)&&this._model.getNthRoot(0).options.customNode&&this._model.removeRoot(this._model.getNthRoot(0));else if(e){if(this.allowFreeInputFlag&&this._model)if(0!=this._model.getRoots().length&&this._model.getNthRoot(0).options.customNode)this._model.getNthRoot(0).updateOptions({label:e,value:e});else{var i=new r({label:e,value:e,icons:[{iconName:"pencil"}],customNode:!0});this._model&&this._model.addRoot(i,0)}}else this._model&&this._model.getNthRoot(0)&&this._model.getNthRoot(0).options.customNode&&this._model.removeRoot(this._model.getNthRoot(0))}function b(e,t){if(!this._modelLoaded)if(this.selectedItems&&t&&(I.call(this,this._valueModifiedbyAPI,!0,function(){this._model&&(this._model.getXSO().isEmpty()||this._model.getXSO().empty())}),this._properties.value.value=void 0,this._properties.selectedItems.value=void 0,this._selectionChips&&this._selectionChips.removeAllChips(),this._editor&&(this._editor.value="")),function(){this._model&&(this._addChildCB&&(this._model.unsubscribe(this._addChildCB),this._addChildCB=void 0),this._removeChildCB&&(this._model.unsubscribe(this._removeChildCB),this._removeChildCB=void 0))}.call(this),void 0===e)this._defaultModel||(this._defaultModel=new l),this._defaultModel.empty(),this._model=this._defaultModel,this._modelLoaded=!0;else{if(e instanceof l)return D.call(this,e);if(Array.isArray(e))return function(e){if(Array.isArray(e)){var t=new l;t.prepareUpdate();for(var i=0;i<e.length;i++){var o=e[i];let n="string"==typeof o?o:o.value,a="string"==typeof o?void 0:o.icon;var s=new r({label:n,value:n,icons:a?[a]:[]});t.addRoot(s)}return t.pushUpdate(),D.call(this,t)}}.call(this,e);if(e instanceof Function)return this._lastSearchedString=this._editor?this._editor.valueToCommit:"",b.call(this,e.call(this,this._lastSearchedString),!1);if(e instanceof Promise){this._pendingPromise=!0,this._dataGridView&&(this._dataGridView.displayModalLoader("Loading.."),this._dataGridView.placeholder="");var i=this;e.then(function(e){b.call(i,e,!1),i._editor&&i.displayCustomNodeInDropDown&&M.call(i,i._editor.valueToCommit)}).finally(function(e){i._pendingPromise=!1,i._dataGridView&&(i._dataGridView.removeModalLoader("Loading.."),i._dataGridView.placeholder=i.customFilterMessage,i._editor&&C.call(i,i._editor.valueToCommit))})}}}function w(){this._editor&&void 0!==this._editor.valueToCommit&&this._editor.valueToCommit.length>=this.minLengthBeforeSearch&&(!this._modelLoaded&&!this._pendingPromise||!this.keepSearchResultsFlag&&!this._pendingPromise||this.elementsTree instanceof Function&&this.minLengthBeforeSearch>0&&this._editor.valueToCommit.toLowerCase().indexOf(this._lastSearchedString.toLowerCase())<0)&&(this._modelLoaded=!1,b.call(this,this.elementsTree,!1))}function D(e){if(e instanceof l){if(this._model=e,this._modelLoaded=!0,this._dataGridView&&(this._dataGridView.treeDocument=this._model),!this.isDirty("value")&&!this.isDirty("selectedItems")){var t=e.getXSO().get();t.length>0&&I.call(this,this._valueOperation,{operationType:this._valueUpdated.ADD,noOfItemsModified:t.length},function(){this.selectedItems=t})}var i=this,o=function(e){g.call(i)};this._addChildCB=this._model.addModelEventListener("addChild",o),this._removeChildCB=this._model.addModelEventListener("removeChild",o),this._model.onPostExpand(function(){g.call(i)}),this._model.onPostCollapse(function(){g.call(i)}),this._model.getXSO().onPostAdd(function(e){i._valueModifiedbyAPI||I.call(i,i._valueOperation,{operationType:i._valueUpdated.ADD,noOfItemsModified:e.length},function(){if(i.multiSearchMode){var t=[];i.selectedItems&&(t=i.selectedItems.slice(0)),e&&e.forEach(function(e){d.pushUnique(t,e)}),i.selectedItems=t,y.call(i)}else i._hidePopup(),i.selectedItems=e[0]})}),this._model.getXSO().onPostRemove(function(e){i.displayCustomNodeInDropDown&&e[0].options&&e[0].options.customNode||i._valueModifiedbyAPI||I.call(i,i._valueOperation,{operationType:i._valueUpdated.REMOVE,noOfItemsModified:e.length},function(){if(i.multiSearchMode){var t=[];i.selectedItems&&(t=i.selectedItems.slice(0)),e.forEach(function(e){for(var i=t.length-1;i>=0;i--)if(t[i]===e){t.splice(i,1);break}}),i.selectedItems=t,y.call(i)}})})}}function I(e,t,i){var o=this._valueModifiedbyAPI;!0===e.hasOwnProperty("operationType")&&!0===e.hasOwnProperty("noOfItemsModified")?(this._valueOperation.operationType=t.operationType,this._valueOperation.noOfItemsModified=t.noOfItemsModified):this._valueModifiedbyAPI=t,i.call(this),e.operationType&&e.noOfItemsModified?(this._valueOperation.operationType=void 0,this._valueOperation.noOfItemsModified=void 0):this._valueModifiedbyAPI=o}var V=function(t){var i,o=!1,s=[],n=[];if(Array.isArray(t)?s=t:s[0]=t,this._model)for(var a=0;a<s.length;a++){var l=this;o=!1,void 0!==(i=l._model.search({useTransaction:!1,match:function(t){if("string"==typeof s[a]||"number"==typeof s[a]){if(l._valueOperation.operationType===l._valueUpdated.REMOVE||l._valueOperation.operationType===l._valueUpdated.ADD){if("string"==typeof s[a]&&"string"==typeof t.nodeModel.options.label){if(e.equals(s[a].toLowerCase(),t.nodeModel.options.label.toLowerCase()))return o=!0,!0}else if(e.equals(s[a],t.nodeModel.options.label))return o=!0,!0}else if(l.displayCustomNodeInDropDown&&l._model.getNthRoot(0).options.customNode&&t.nodeModel.options.label&&e.equals(s[a].toLowerCase(),t.nodeModel.options.label.toLowerCase()))return o=!0,!0;if(t.nodeModel.options.hasOwnProperty("value")&&void 0!==t.nodeModel.options.value){if(e.equals(s[a],t.nodeModel.options.value))return o=!0,!0}else if(e.equals(s[a],t.nodeModel.options.label))return o=!0,!0}else if("object"==typeof s[a])if(t.nodeModel.options.hasOwnProperty("value")&&void 0!==s[a].options.value&&void 0!==t.nodeModel.options.value){if(e.equals(s[a].options.value,t.nodeModel.options.value))return o=!0,!0}else if((l._valueOperation.operationType===l._valueUpdated.REMOVE||l._valueOperation.operationType===l._valueUpdated.ADD)&&e.equals(s[a].options.label,t.nodeModel.options.label))return o=!0,!0},shouldStop:function(){return o}}))[0]&&d.pushUnique(n,i[0])}return n};function S(){if(this._dataGridView){var e=-1,t=Array.isArray(this.selectedItems)?this.selectedItems[this.selectedItems.length-1]:this.selectedItems;return t&&(e=this._dataGridView.layout.getCellIDFromCoordinates({rowID:t._getRowID(),columnID:0})),this._dataGridView.setActiveCell(e,!0,!0),this._dataGridView.setPreselectedCell(e),this._dataGridView.ensureCellVisible(e,!1,0)}}return i.inherit({name:"autoComplete",publishedProperties:{placeholder:{defaultValue:"",type:"string",category:"Appearance"},multiSearchMode:{defaultValue:!0,type:"boolean",category:"Behavior"},displayCustomNodeInDropDown:{defaultValue:!0,type:"boolean",category:"Behavior",noNeedToApplyFlag:!0},value:{defaultValue:void 0,type:"object",category:"Appearance"},elementsTree:{defaultValue:void 0,type:"object",category:"Model"},selectedItems:{defaultValue:void 0,type:"Array",category:"Appearance"},filterCB:{defaultValue:function(e){this.filterItems(e,{filterId:"stringRegexp"})},type:"function"},customFilterMessage:{defaultValue:"",type:"string",category:"Appearance"},allowFreeInputFlag:{defaultValue:!0,type:"boolean",category:"Behavior",noNeedToApplyFlag:!0},allowResetToUndefinedByUIFlag:{defaultValue:!0,type:"boolean",category:"Behavior"},minLengthBeforeSearch:{defaultValue:0,type:"integer",category:"Behavior",noNeedToApplyFlag:!0},typeDelayBeforeSearch:{defaultValue:0,type:"integer",category:"Behavior",noNeedToApplyFlag:!0},keepSearchResultsFlag:{defaultValue:!0,type:"boolean",category:"Behavior",noNeedToApplyFlag:!0},popupSizeAdjustPolicy:{defaultValue:n.SizeAdjustPolicyEnum.AdjustToVisibleContents,type:"integer",category:"Appearance"},getChipInfo:{defaultValue:function(e){return this.getDefaultChipInfo(e)},type:"function"}},getDefaultChipInfo:function(e){let t="object"==typeof e.options.value?e.options.value.label||e.getLabel():e.getLabel()||e.options.value+"",i=e.options.icon||("object"==typeof e.options.value?e.options.value.icon:void 0),o={roundFlag:"user"===this.getTypeRepresentation(e)||"detailedUser"===this.getTypeRepresentation(e)};return i||"user"!==this.getTypeRepresentation(e)&&"detailedUser"!==this.getTypeRepresentation(e)||(i={userName:"object"==typeof e.options.value?e.options.value.label||e.getLabel():e.getLabel()||e.options.value+""}),{label:t,icon:i,_iconOptions:o}},getTypeRepresentation:function(e){return(e?e.options.typeRepresentation:void 0)||this.columnOptions&&void 0!==this.columnOptions.getTypeRepresentation&&this.columnOptions.getTypeRepresentation({nodeModel:e})||this.columnOptions&&this.columnOptions.typeRepresentation||"string"},keymaps:{tab:"manageTab","shift+tab":"manageTab",esc:"manageEscape",up:"upMove",down:"downMove",pageup:"pageupMove",pagedown:"pagedownMove",home:"homeMove",end:"endMove"},commands:{manageTab:function(e){return this._hidePopup(),f.call(this,this._editor.valueToCommit),{stopPropagation:!1}},manageEscape:function(e){return this.elements.popup&&this.elements.popup.visibleFlag&&(!this.multiSearchMode&&this._editor&&this._editor._myInput&&this.selectedItems&&(this._editor.valueToCommit=this.selectedItems.getLabel(),this._editor.value=this.selectedItems.getLabel()),this.callMethodFromUIInteraction("_hidePopup")),{stopPropagation:!1}},upMove:function(){return this._manageNavigationKey("up")},downMove:function(){return this._manageNavigationKey("down")},pageupMove:function(){return this._manageNavigationKey("pageup")},pagedownMove:function(){return this._manageNavigationKey("pagedown")},homeMove:function(){return this._manageNavigationKey("home",!0)},endMove:function(){return this._manageNavigationKey("end",!0)}},buildView:function(){this.elements.container.addClassName("wux-controls-autoComplete"),this.elements.container.addClassName("cfg-bulkedit-autoComplete"),this.elements.container.setAttribute("tabindex",0),this._modelLoaded=!1,this._defaultModel=void 0,this._lastSearchedString="",this._valueOperation={operationType:void 0,noOfItemsModified:void 0},this._valueUpdated={ADD:1,REMOVE:2},this._nbItemsToDisplay=-1,this._valueModifiedbyAPI=!1,this._selectionChipsHeight=0,this._DGVContainerFitWidth=0,this._DGVContainerMinWidth=0,this._DGVContainerWidth=0},_postBuildView:function(){void 0===this._editor&&(this._editor=new s({placeholder:this.placeholder,displayStyle:"text",fireOnlyFromUIInteractionFlag:!0,selectAllOnFocus:!0,disabled:this.disabled}),this._editor.getContent().addClassName("wux-controls-autoComplete-editor"),this._selectedImage=e.createElement("div",{class:"cfg-autoComplete-image"}),this._selectedImage.inject(this._editor.getContent(),"top")),this._editor.touchMode=this.touchMode,this._applyMultiSearchMode(),this.multiSearchMode||this.selectedItems&&(this._editor.value=Array.isArray(this.selectedItems)?this.selectedItems[0].options.label:this.selectedItems.options.label),this._delayPopupCreation()},handleEvents:function(){var e=this,i=function(){var t=!1;e._valueModifiedbyAPI||(!(e._editor&&""!==e._editor.valueToCommit&&e._editor.valueToCommit.length>=e.minLengthBeforeSearch)||e.elements.popup&&e.elements.popup.visibleFlag?e.elements.popup&&e.elements.popup.visibleFlag&&e._editor&&void 0!==e._editor.valueToCommit&&e._editor.valueToCommit.length<e.minLengthBeforeSearch&&e._hidePopup():(e._showPopup(),t=!0,e._dataGridView&&(e._dataGridView.setScrollerPosition({x:0,y:0,animate:!1}),e.multiSearchMode||e._dataGridView.unselectAll(),e._dataGridView.setActiveCell(-1,!0,!0),e._dataGridView.setPreselectedCell(-1)))),!t&&e.elements.popup&&e.elements.popup.visibleFlag&&w.call(e),e.displayCustomNodeInDropDown&&M.call(e,e._editor.valueToCommit),C.call(e,e._editor.valueToCommit),e.elements.popup&&e.elements.popup.visibleFlag&&e._dataGridView&&e._dataGridView.setFindStr(e._editor.valueToCommit,!1,void 0,!0)};t.addEventOnElement(this,this._editor,"uncommittedChange",function(t){!e._valueModifiedbyAPI&&(p.hide(),e.elements.popup&&e.elements.popup.visibleFlag&&e._editor&&void 0!==e._editor.valueToCommit&&e._editor.valueToCommit.length<e.minLengthBeforeSearch)?e._hidePopup():!e._valueModifiedbyAPI&&e.typeDelayBeforeSearch>0?(this._debouncedlaunchSearch||(this._debouncedlaunchSearch=u.debounce(i,e.typeDelayBeforeSearch)),this._debouncedlaunchSearch()):i()}),t.addEventOnElement(this,this._editor,"change",function(t){t.stopPropagation(),e._valueModifiedbyAPI||(f.call(e,e._editor.value),e._hidePopup())}),t.addEventOnElement(this,this,"keydown",function(t){t.keyCode!=h.SPACE||t.actionPerformed?t.keyCode===h.HOME?e._manageNavigationKey("home",!0):t.keyCode===h.END?e._manageNavigationKey("end",!0):t.keyCode!=h.ENTER||t.actionPerformed||e._manageReturn(t):e._manageSpace(t)},!0)},_manageSpace:function(e){if(this.multiSearchMode&&this.elements.popup&&this.elements.popup.visibleFlag&&this._dataGridView){var t=this._dataGridView.getActiveCellID();if(t>=0){var i=this._dataGridView.getNodeModelAt(t);i&&(i.isSelected()?i.unselect():i.select(),e&&(e.stopPropagation(),e.preventDefault()),this._editor&&this._editor._giveFocus())}}},_manageReturn:function(e){var t,i=!1;if(this.elements.popup&&this.elements.popup.visibleFlag){if(this._dataGridView){var o=this._dataGridView.getActiveCellID();o>=0&&(t=this._dataGridView.getNodeModelAt(o))}this._hidePopup()}return t?(t.select(),i=!0):this._editor.value&&(f.call(this,this._editor.value),i=!0),{stopPropagation:!1,infos:{actionPerformed:i}}},_manageNavigationKey:function(e,t){if(p.hide(),this.elements.popup&&this.elements.popup.visibleFlag){if(this._dataGridView){var i=-1,o=this._dataGridView.getActiveCellID();i=void 0===o||o<0?this._dataGridView.layout.getCellIDFromCoordinates({rowID:"end"===e?this._dataGridView.model.length-1:0,columnID:0}):this._dataGridView.computeCellIDFromActiveCell(e,t),this._dataGridView.setActiveCell(i,!0,!0),this._dataGridView.setPreselectedCell(i)}}else this._showPopup();return{preventDefault:!0}},_delayPopupCreation:function(){if(!this._delayPopupCreationInfos){var i=this,o={target:this,position:"bottom",offset:{x:0,y:4},trigger:"click escape keydown",toggleFlag:!0,constraint:"screen",className:"wux-controls-autoComplete-popup wux-controls-popup",alignment:"near",overlap:!1,getBody:function(){i._dataGridViewContainer=new e.Element("div"),i._dataGridViewContainer.addClassName("wux-controls-autoComplete-dataGridViewContainer");var o={treeDocument:i._model,columns:[{text:"Text",dataIndex:"tree"}],cellSelection:"none",selectionBehavior:{toggle:!0},showAlternateBackgroundFlag:!1,showRowBorderFlag:!0,selectionStyle:"lightSelectionEdging",rowSelection:i.multiSearchMode?"multiple":"single",selectNextCellOnEnterFlag:!1,layoutOptions:{columnsHeader:!1,rowsHeader:!1}};return i._dataGridView=new a(o),i._dataGridView.touchMode=i.touchMode,i.customFilterMessage&&(i._dataGridView.placeholder=i.customFilterMessage),i._dataGridView.getContent().addClassName("wux-controls-autoComplete-dataGridView"),i._dataGridView.inject(i._dataGridViewContainer),t.addEventOnElement(i,i._dataGridView,"focus",function(e){i._editor&&i._editor._giveFocus()}),i._dataGridView._getScroller().onScrollEnd(function(){i.popupSizeAdjustPolicy===n.SizeAdjustPolicyEnum.AdjustToVisibleContents&&v.call(i)}),i._dataGridViewContainer},beforeDisplayCallback:function(){if(w.call(i),i._editor&&(""===i._editor.valueToCommit&&(!i._model||0===i._model.getRoots().length)&&!i._pendingPromise||void 0!==i._editor.valueToCommit&&i._editor.valueToCommit.length<i.minLengthBeforeSearch))return{preventDisplay:!0};i.elements.popup.getContent().setStyle("visibility","hidden"),i._popupVisibility=!1;let e=0,t=0;if(!i.multiSearchMode&&i._editor&&i._editor._myInput){const o=window.getComputedStyle(i._editor._myInput);0===parseInt(o.borderLeft.slice(0,-2))&&(e=-1,t=2),i.elements.popup.offset={x:e,y:4}}let o="";i.multiSearchMode&&(o=i._editor.valueToCommit),C.call(i,o),i._dataGridView&&i._dataGridView.setFindStr(o,!1,void 0,!0),i._DGVContainerFitWidth=i.elements.container.getBoundingClientRect().width+t,i._DGVContainerMinWidth=i._DGVContainerFitWidth,i._DGVContainerWidth=i._DGVContainerFitWidth,i._dataGridViewContainer.style.width=i._DGVContainerWidth+"px"}};this._delayPopupCreationInfos=n.delayPopupCreation(o,function(e){i.elements.popup=e,i._editor.preventBlurForTargetedElements([i.elements.popup]),e.addEventListener("show",async function(e){e.stopPropagation(),i._dataGridView.subscribeOnceToAllCellsRendered(function(){i._dataGridView.layout.prepareLayout(),i.popupSizeAdjustPolicy===n.SizeAdjustPolicyEnum.AdjustToVisibleContents?S.call(i)||v.call(i):(S.call(i),v.call(i)),i.fire("show")})}),e.addEventListener("hide",function(e){e.stopPropagation(),i.fire("hide")}),e.addEventListener("mousedown",function(e){e.preventDefault()})})}},_applyProperties:function(e){if(this._parent(e),this.isDirty("placeholder")&&this._applyPlaceholder(e.placeholder),this.isDirty("multiSearchMode")&&this._applyMultiSearchMode(e.multiSearchMode),this.isDirty("elementsTree")&&this._applyElementsTree(e.elementsTree),this.isDirty("value")&&e&&e.hasOwnProperty("value"))this._applyValue(e.value);else if(this.isDirty("selectedItems")&&e&&e.hasOwnProperty("selectedItems"))this._applySelectedItems(e.selectedItems);else if(this.isDirty("elementsTree")&&this.elementsTree&&this.elementsTree instanceof l){var t=this.elementsTree.getXSO().get();t.length>0&&I.call(this,this._valueOperation,{operationType:this._valueUpdated.ADD,noOfItemsModified:t.length},function(){this.selectedItems=t})}this.isDirty("customFilterMessage")&&this._applyCustomFilterMessage(e.customFilterMessage),this.isDirty("allowResetToUndefinedByUIFlag")&&this._applyAllowResetToUndefinedByUIFlag(e.allowResetToUndefinedByUIFlag)},_applyDisabled:function(){this._parent(),this._editor&&(this._editor.disabled=this.disabled),this._selectionChips&&(this._selectionChips.disabled=this.disabled)},_applyPlaceholder:function(){this._editor&&(this._editor.placeholder=this.placeholder)},_applyMultiSearchMode:function(e){this.multiSearchMode?(this._editor&&!0===this.elements.container.hasChildNodes()&&this._editor.remove(),void 0!==this.elements.popup&&I.call(this,this._valueModifiedbyAPI,!0,function(){this._dataGridView.rowSelection="multiple"}),this._selectionChips||function(){this._selectionChips=new o({fireOnlyFromUIInteractionFlag:!0,disabled:this.disabled}),this._selectionChips.getContent().addClassName("wux-controls-autoComplete-selectionChips"),this._selectionChips.touchMode=this.touchMode;var e=this;t.addEventOnElement(this,this._selectionChips,"onPostRemove",function(t){e._valueModifiedbyAPI||I.call(e,e._valueOperation,{operationType:e._valueUpdated.REMOVE,noOfItemsModified:t.options.chips.length},function(){if(e.multiSearchMode&&t.options.chips){if(t.options.allChipsRemoved)return void(e.selectedItems=[]);for(var i=0;i<t.options.chips.length;i++){const s=t.options.chips[i].chipOptions;if(s.value&&s.value.options.customNode){const t=_.call(e,e.selectedItems).findIndex(e=>e===s.value);if(-1!==t){const i=e.selectedItems.slice(0);i.splice(t,1),e.selectedItems=i}}else if(s.value){var o=V.call(e,s.value);o&&o[0]&&s.value.unselect()}}}})}),t.addEventOnElement(this,this._selectionChips,"change",function(e){e.stopPropagation()})}.call(this),this._editor&&this._editor._myInput&&this._selectionChips&&!1===this.elements.container.hasChildNodes()&&(this._editor._myInput.style.width="100%",this._editor.displayStyle="lite",this._selectionChips.addLastWidget(this._editor),this._selectionChips.inject(this.elements.container))):(this._selectionChips&&!0===this.elements.container.hasChildNodes()&&this._selectionChips.remove(),this.elements.popup&&I.call(this,this._valueModifiedbyAPI,!0,function(){this._dataGridView.rowSelection="single"}),this._editor&&this._editor._myInput&&!1===this.elements.container.hasChildNodes()&&(this._editor._myInput.style.width="100%",this._editor.displayStyle="text",this._editor.inject(this.elements.container))),this._applyAllowResetToUndefinedByUIFlag(),void 0!==e&&this.multiSearchMode!==e&&(this.isDirty("value")||this.isDirty("selectedItems")||(I.call(this,this._valueModifiedbyAPI,!0,function(){this._model&&(this._model.getXSO().isEmpty()||this._model.getXSO().empty())}),this._properties.value.value=void 0,this._properties.selectedItems.value=void 0,this._selectionChips&&this._selectionChips.removeAllChips(),this._editor&&(this._editor.value="")))},_applyValue:function(e,t){if(void 0===this.value)return this.selectedItems=void 0,void(this._modelLoaded||this.fire("change"));var i=_.call(this,this.value);this.multiSearchMode?Array.isArray(this.value)||(this._properties.value.value=i):Array.isArray(this.value)&&(this._properties.value.value=i[0]),I.call(this,this._valueModifiedbyAPI,!0,function(){for(var o=[],s=0;i.length>s;s++){var n=V.call(this,i[s])[0];if(!n&&i[s]&&""!==i[s])if(this.allowFreeInputFlag)n=new r({label:i[s],value:i[s],customNode:!0});else if(!this.multiSearchMode){if(this._modelLoaded)return this.value=e,void(this._editor.value=e);this._editor.value=t}n&&d.pushUnique(o,n)}this.selectedItems=this.multiSearchMode?o:o[0]}),y.call(this)},_applyElementsTree:function(e){this._modelLoaded=!1,(this.elements.popup&&this.elements.popup.visibleFlag||!this.elementsTree||this.elementsTree instanceof l||Array.isArray(this.elementsTree))&&b.call(this,this.elementsTree,!this.isDirty("value")&&!this.isDirty("selectedItems"))},filterItems:function(e,t){if(this._model){var i=t&&t.property||"label",o=t&&t.type||"contains",s=t&&t.filterId||"stringRegexp";this._model.getFilterManager().setPropertyFilterModel(i,{filterId:s,filterModel:{condition1:{type:o,filter:e}}})}},_applySelectedItems:function(){var e=this,i=_.call(this,this.selectedItems);this.multiSearchMode?Array.isArray(this.selectedItems)||(this._properties.selectedItems.value=i):Array.isArray(this.selectedItems)&&(this._properties.selectedItems.value=i[0]);for(var o=[],s=0;s<i.length;s++)d.pushUnique(o,i[s]);if(i.length!==o.length&&(i=o,this.multiSearchMode?this._properties.selectedItems.value=i:this._properties.selectedItems.value=i[0]),this.multiSearchMode){this._properties.value.value=[],I.call(this,this._valueModifiedbyAPI,!0,function(){this._model&&!this._model.getXSO().isEmpty()&&this._model.getXSO().empty();for(var t=0;i.length>t;t++)i[t].select();if(this._selectionChips){var o=[];let t;i.forEach(function(i){t=e.getChipInfo(i),d.pushUnique(o,{id:i.id,label:t.label,value:i,icon:t.icon,_iconOptions:t._iconOptions})}),this._selectionChips.removeAllChips(),this._selectionChips.addChips(o)}C.call(this,""),this._editor&&(this._editor.valueToCommit="",this._editor.value="")});e=this;i.forEach(function(t){t.options.hasOwnProperty("value")&&void 0!==t.options.value?e._properties.value.value.push(t.options.value):e._properties.value.value.push(t.options.label)}),this._selectedImage&&this._selectedImage.hide()}else I.call(this,this._valueModifiedbyAPI,!0,function(){if(this._valueOperation.operationType!==this._valueUpdated.REMOVE&&(this._model&&!this._model.getXSO().isEmpty()&&this._model.getXSO().empty(),i.length>0&&i[0]&&i[0].select()),this._editor){this._editor.value=i[0]?i[0].options.label:"";i[0]&&i[0].options.image;var e=i[0]?i[0].options.icons:[];if(e&&this._selectedImage){for(var o of(this._selectedImage.setContent(""),e))this._selectedImage.addContent(t.generateIcon(o));this._selectedImage.isHidden()&&this._selectedImage.show()}}else this._selectedImage&&this._selectedImage.hide();var s=void 0;i[0]&&(s=i[0].options.hasOwnProperty("value")&&void 0!==i[0].options.value?i[0].options.value:i[0].options.label),this._properties.value.value=s});this.displayCustomNodeInDropDown&&this._model&&this._model.getNthRoot(0)&&this._model.getNthRoot(0).options.customNode&&this._model.removeRoot(this._model.getNthRoot(0)),this.fire("change")},_showPopup:function(){if(this.elements.popup){if(this.elements.popup.visibleFlag)return;this.elements.popup.visibleFlag=!0}else this._delayPopupCreationInfos&&"function"==typeof this._delayPopupCreationInfos.createVisiblePopup&&this._delayPopupCreationInfos.createVisiblePopup()},_hidePopup:function(){if(this.elements.popup&&this.elements.popup.visibleFlag&&(this.elements.popup.visibleFlag=!1,this._editor)){var e=this;setTimeout(function(){e._editor&&!e._editor._isFocused()&&e._editor._giveFocus()},1)}},_giveFocus:function(){this._parent(),this._editor&&this._editor._giveFocus()},_applyCustomFilterMessage:function(){this._dataGridView&&(this._dataGridView.placeholder=this.customFilterMessage)},_applyAllowResetToUndefinedByUIFlag:function(){this._editor&&(this._editor.displayClearFieldButtonFlag=this.allowResetToUndefinedByUIFlag&&!this.multiSearchMode)},_applyTouchMode:function(){this._parent(),this._getCurrentTouchMode()?this.elements.container.setAttributeNode(document.createAttribute("touch-mode")):this.elements.container.removeAttribute("touch-mode"),this._editor&&(this._editor.touchMode=this.touchMode),this._selectionChips&&(this._selectionChips.touchMode=this.touchMode),this._dataGridView&&(this._dataGridView.touchMode=this.touchMode)},getValueToCommit:function(){return this._editor?this._editor.valueToCommit:""},showLoader:function(e){this._dataGridView.displayModalLoader(e||"")},hideLoader:function(e){this._dataGridView.removeModalLoader(e||"")},updateIcons:function(e,i){if(e)if(this.multiSearchMode)this._selectionChips&&i&&this._applyMultiSearchMode(!1);else if(this._selectedImage)for(var o of(this._selectedImage.setContent(""),e))this._selectedImage.addContent(t.generateIcon(o))},destroy:function(){this._dataGridView&&this._dataGridView.destroy(),this._parent()}})}),define("DS/CfgBulkTablePresenter/BulkEdition/Model/BulkTableModel",["UWA/Core"],function(e){"use strict";var t=function(){};return t.prototype.init=function(e){this._jsonModel={},this._mapDico=e||{},this._variabilityValuesMap={},this._columnsMap={},this._jsonModel=this._initJsonModel(),this._mapDico&&this._mapDico.features&&(this._jsonModel.rowHeaders=this.createRowHeaders(this._mapDico.features))},t.prototype._initJsonModel=function(){return this._jsonModel.columnHeaders=[],this._jsonModel.rowHeaders=[],this._jsonModel.columnsValidity=[],this._jsonModel.matrix=[],this._jsonModel},t.prototype.getJsonModel=function(){return this._jsonModel},t.prototype.getColumnHeader=function(e){if(e>=0)return this._jsonModel.columnHeaders[e]},t.prototype.createColumn=function(e){if(e&&this._columnsMap&&!this._columnsMap[e.id]){var t={};t.id=e.id,t.title=e.title,t.type=e.type,t.attributes=e,t.parentId=e.modelID,t.objectId=e.id,t.isAsReference=!1,this._columnsMap[t.id]={columnID:this._jsonModel.columnHeaders.length,columnData:t},this._jsonModel.columnHeaders.push(t),this._jsonModel.columnsValidity.push("V"),this._snapshotJsonModel&&Object.entries(this._snapshotJsonModel).length>0&&this.addColumnToSnapshotJsonModel(t),this.createColumnData()}},t.prototype.removeColumn=function(e){if(e)for(var t=0;t<this._jsonModel.columnHeaders.length;t++)if(this._jsonModel.columnHeaders[t].id===e.id){this._jsonModel.matrix.splice(t,1),this._jsonModel.columnHeaders.splice(t,1),delete this._columnsMap[e.id],this._jsonModel.columnsValidity.splice(t,1),this._snapshotJsonModel&&Object.entries(this._snapshotJsonModel).length>0&&this.removeColumnFromSnapshotJsonModel(t);break}},t.prototype.createRowHeaders=function(e){var t=[];if(e){for(var i=0;i<e.length;i++){var o={};if(o.id=e[i].ruleId,o.title=e[i].displayName,o.type=e[i].type,o.sequenceNumber=e[i].sequenceNumber,o.image=e[i].image,o.mandatory=!0,"false"===e[i].selectionCriteria&&(o.mandatory=!1),e[i].values&&(o.children=this._getVariabilityValues(e[i])),"Parameter"===e[i].type){var s=[],n={},a={},l={};n.value=e[i].minValue,n.unit=e[i].minUnit,a.value=e[i].maxValue,a.unit=e[i].maxUnit,l.max=a,l.min=n,s.push(l),o.range=s}t.push(o)}return t}},t.prototype.createColumnData=function(){for(var e=[],t=0;t<this._jsonModel.rowHeaders.length;t++){var i={};if(this._jsonModel.rowHeaders[t].children&&this._jsonModel.rowHeaders[t].children.length>0)for(var o=0;o<this._jsonModel.rowHeaders[t].children.length;o++)i.state="A",i.stateValidity="V",e.push(i);else{var s=[];i.dropDownData=[];var n=this._mapDico.features[t].options;if(n){var a={};if(n.length>0){for(var l=0;l<n.length;l++)a.id=n[l].ruleId,a.title=n[l].displayName,a.image=n[l].image,a.state="U",a.stateValidity="V",s.push(a),a.type=n[l].type,this._variabilityValuesMap[a.id]={rowID:t,variabilityValue:a},a={};i.dropDownData=s}else a.id=this._mapDico.features[t].ruleId,a.title=this._mapDico.features[t].displayName,a.state="U",a.stateValidity="V",a.type=this._mapDico.features[t].type,this._variabilityValuesMap[a.id]={rowID:t,variabilityValue:a}}if("VariabilityGroup"===this._mapDico.features[t].type){var r={};r.dropDownData=i.dropDownData,r.values=[],e.push(r)}else"Parameter"===this._mapDico.features[t].type?(i.id=this._mapDico.features[t].ruleId,i.unit=this._mapDico.features[t].unit):i.id="",i.title="",i.state="U",i.stateValidity="V",i.image=this._jsonModel.rowHeaders[t].image,e.push(i)}}this._jsonModel.matrix.push(e),this._snapshotJsonModel&&Object.entries(this._snapshotJsonModel).length>0&&this.addColumnToSnapshotJsonModel(e)},t.prototype._getVariabilityValues=function(e){var t=[];if(e&&e.values.length>0)for(var i=0;i<e.values.length;i++){var o={};o.id=e.values[i].ruleId,o.title=e.values[i].displayName,o.type=e.values[i].type,o.sequenceNumber=e.values[i].sequenceNumber,o.image=e.values[i].image,t.push(o)}return t},t.prototype.getVariabilityValuesMap=function(){return this._variabilityValuesMap},t.prototype.snapshotJsonModel=function(){this._snapshotJsonModel=JSON.parse(JSON.stringify(this._jsonModel))},t.prototype.restoreJsonModelFromSnapshot=function(){this._snapshotJsonModel&&Object.entries(this._snapshotJsonModel).length>0&&(this._jsonModel=JSON.parse(JSON.stringify(this._snapshotJsonModel)))},t.prototype.addColumnToSnapshotJsonModel=function(t){e.is(t,"object")?(this._snapshotJsonModel.columnHeaders.push(t),this._snapshotJsonModel.columnsValidity.push("V")):this._snapshotJsonModel.matrix.push(t)},t.prototype.removeColumnFromSnapshotJsonModel=function(e){this._snapshotJsonModel.matrix.splice(e,1),this._snapshotJsonModel.columnHeaders.splice(e,1),this._snapshotJsonModel.columnsValidity.splice(e,1)},t.prototype.updateJsonModel=function(e,t){if(e&&t>=0)for(var i=0;i<e.length;i++){var o=e[i];if(o&&o.state&&(this.updateDropDownData([o],t),"U"!==o.state&&"I"!==o.state))if("Option"===o.type||"VariantMultiSelectionValue"===o.type){var s=this._jsonModel.matrix[t][o.rowID].dropDownData,n=this._jsonModel.matrix[t][o.rowID].values;if(n)if(!n.find(e=>e.id===o.id)){for(var a=0;a<s.length;a++)s[a].id===o.id&&(s[a].state=o.state,n.push(s[a]));this._jsonModel.matrix[t][o.rowID].values=n}}else"Parameter"===o.type?(this._jsonModel.matrix[t][o.rowID].unit=o.unit,this._jsonModel.matrix[t][o.rowID].title=o.title,this._jsonModel.matrix[t][o.rowID].id=o.id,this._jsonModel.matrix[t][o.rowID].state=o.state):"M"!==o.state&&(this._jsonModel.matrix[t][o.rowID].id=o.id,this._jsonModel.matrix[t][o.rowID].title=o.title,this._jsonModel.matrix[t][o.rowID].state=o.state,this._jsonModel.matrix[t][o.rowID].stateValidity=o.stateValidity,this._jsonModel.matrix[t][o.rowID].image=o.image)}},t.prototype.updateDropDownData=function(e,t){if(e&&t>=0)for(var i=0;i<e.length;i++){var o=e[i];if(o&&o.rowID>=0){var s=this._jsonModel.matrix[t][o.rowID].dropDownData;if(s&&s.length>0)for(var n=this._variabilityValuesMap[o.id].variabilityValue,a=0;a<s.length;a++)if(s[a].id===n.id){s[a].state=o.state,s[a].stateValidity=o.stateValidity;break}}}},t.prototype.getColumnData=function(e){var t=[];return e>=0&&this._jsonModel&&this._jsonModel.matrix&&this._jsonModel.matrix[e]&&(t=this._jsonModel.matrix[e]),t},t.prototype.getColumnID=function(e){var t;if(e)for(var i=0;i<this._jsonModel.columnHeaders.length;i++)if(this._jsonModel.columnHeaders[i].id===e)return t=i;return t},t.prototype.getAllColumnIDs=function(){var e=[];if(this._jsonModel.columnHeaders&&this._jsonModel.columnHeaders.length>0)for(var t=0;t<this._jsonModel.columnHeaders.length;t++){var i=this._jsonModel.columnHeaders[t],o=this.getColumnID(i.id);e.push(o)}return e},t.prototype.getMatrixCellData=function(e,t){var i;return e>=0&&t>=0&&this._jsonModel.matrix[e][t]&&(i=this._jsonModel.matrix[e][t]),i},t.prototype.setMatrixCellData=function(t,i,o){if(o&&""!==o){var s={};if(e.is(o,"array")){var n={values:[]};if(n.dropDownData=this._jsonModel.matrix[t][i].dropDownData,o.length>0){for(var a=0;a<o.length;a++)if(e.is(o[a],"object")){n.values=e.clone(this._jsonModel.matrix[t][i].values,"true");var l=n.values.findIndex(e=>e.id===o[a].id);n.values[l].state=o[a].state}else{s=this._variabilityValuesMap[o[a]].variabilityValue;var r={};r.id=s.id,r.title=s.title;var d=this.getCellState(t,i,o[a]);r.state=d?"M"===d?"C":d:"C",r.stateValidity="V",r.image=s.image,n.values.push(r)}if(this._jsonModel.matrix[t][i].values.length>o.length){var h=this._jsonModel.matrix[t][i].values,u=h.filter(e=>!o.some(t=>e.id===t));if(u)for(var c=0;c<u.length;c++)if("D"===u[c].state){var p=h.findIndex(e=>e.id===u[c].id);p>=0&&(this._jsonModel.matrix[t][i].values[p].state="M")}}}else for(var m=0;m<n.dropDownData.length;m++)"C"===n.dropDownData[m].state?n.dropDownData[m].state="U":"D"===n.dropDownData[m].state&&(n.dropDownData[m].state="M");this._jsonModel.matrix[t][i]=n}else this._variabilityValuesMap[o]?(s=this._variabilityValuesMap[o].variabilityValue,e.is(s)&&(this._jsonModel.matrix[t][i].values&&delete this._jsonModel.matrix[t][i].values,this._jsonModel.matrix[t][i].id=s.id,this._jsonModel.matrix[t][i].title=s.title,this._jsonModel.matrix[t][i].image=s.image,this._jsonModel.matrix[t][i].state="C",this._jsonModel.matrix[t][i].stateValidity=s.stateValidity),this._clearOptionGroupValues(t)):(this._jsonModel.matrix[t][i].title=o,this._jsonModel.matrix[t][i].state="C")}else{"D"===this.getCellState(t,i)?this._jsonModel.matrix[t][i].state="M":(this._jsonModel.matrix[t][i].id="",this._jsonModel.matrix[t][i].title="",this._jsonModel.matrix[t][i].state="U"),this._jsonModel.matrix[t][i].stateValidity="V",this._clearOptionGroupValues(t)}return this.getColumnHeader(t).isDirty=!0,this.getMatrixCellData(t,i)},t.prototype._clearOptionGroupValues=function(e){for(var t=this._jsonModel.rowHeaders,i=0;i<t.length;i++)"VariabilityGroup"===t[i].type&&this._jsonModel.matrix[e][i].values&&(this._jsonModel.matrix[e][i].values=[])},t.prototype.getDirtyColumnHeaders=function(){return this._jsonModel.columnHeaders.filter(e=>e.isDirty)},t.prototype.clearColumnHeaders=function(){this._jsonModel.columnHeaders.forEach(function(e){e.isDirty=!1})},t.prototype.getRowHeaderData=function(e){return this._jsonModel.rowHeaders[e]},t.prototype.isColumnEmpty=function(t){if(t>=0){var i=this.getColumnData(t);if(i&&i.length>0)for(var o=0;o<i.length;o++)if(e.is(i[o],"array")){if(i[o].length>0)return!1}else if(i[o].title&&""!==i[o].title)return!1}return!0},t.prototype.switchVariantToMultiSelection=function(t,i){for(var o=this._jsonModel.rowHeaders.length,s=e.clone(t,"false"),n=0;n<o;n++){var a=n,l=this.getCellType(a);if(l&&"Variant"===l){var r=t.filter(e=>e.rowID===a&&"C"===e.state);if(r.length>1){var d=this.getMatrixCellData(i,a);d&&(this._jsonModel.matrix[i][a]={},this._jsonModel.matrix[i][a].dropDownData=d.dropDownData,this._jsonModel.matrix[i][a].values=[]);for(var h=0;h<s.length;h++){r.some(e=>e.id===s[h].id)&&(s[h].type="VariantMultiSelectionValue")}}}}return s},t.prototype.getCellState=function(e,t,i){var o,s=this.getMatrixCellData(e,t);if(s){var n=this.getCellType(t);if("Variant"===n||"Parameter"===n)o=s.state;else if(s.values&&s.values.length){var a=s.values.find(function(e){if(e.id===i)return e.state});a&&(o=a.state)}}return o},t.prototype.getCellType=function(e){if(e>=0)return this.getRowHeaderData(e).type},t.prototype.setColumnAsReferenceInModel=function(e){this._jsonModel.columnHeaders[e].isAsReference=!0,this._snapshotJsonModel&&this._snapshotJsonModel.columnHeaders&&this._snapshotJsonModel.columnHeaders[e]&&(this._snapshotJsonModel.columnHeaders[e].isAsReference=!0)},t.prototype.getColumnAsReference=function(){for(var e,t=0;t<this._jsonModel.columnHeaders.length;t++)this._jsonModel.columnHeaders[t].isAsReference&&(e=this._jsonModel.columnHeaders[t]);return e},t.prototype.unSetColumnAsReferenceInModel=function(e){this._jsonModel.columnHeaders[e].isAsReference=!1,this._snapshotJsonModel&&this._snapshotJsonModel.columnHeaders&&this._snapshotJsonModel.columnHeaders[e]&&(this._snapshotJsonModel.columnHeaders[e].isAsReference=!1)},t.prototype.getColumnAsReferenceData=function(){var e,t=this.getColumnAsReference();if(t&&t.id){var i=this.getColumnID(t.id);e=this.getColumnData(i)}return e},t}),define("DS/CfgBulkTablePresenter/BulkEdition/Presenter/WarningDialog",["UWA/Class/View","DS/UIKIT/Mask","DS/UIKIT/SuperModal","DS/CoreEvents/ModelEvents","DS/Controls/Button","i18n!DS/CfgBulkTablePresenter/assets/nls/WarningDialog"],function(e,t,i,o,s,n){"use strict";return{dialogCreation:function(e){var t=this;e&&(this._options=e,this._context=e.context?e.context:void 0,this._modelEvent=this._options.modelEvent);var o=new i({renderTo:document.body,events:{onShow:function(){},onHide:function(){}}}),s=[{className:"primary",touchMode:!0,allowUnsafeHTMLLabel:!1,value:n._save,action:function(e){t._options.onSave(),e.hide()}},{className:"default",touchMode:!0,allowUnsafeHTMLLabel:!1,value:n._dont_save,action:function(e){t._options.onDoNotSave(),e.hide()}},{className:"default",touchMode:!0,allowUnsafeHTMLLabel:!1,value:n._cancel,action:function(e){t._options.onCancel(),e.hide()}}];o.dialog({body:n._modal_message,title:n._modal_title,buttons:s})}}}),define("DS/CfgBulkTablePresenter/BulkEdition/Presenter/BulkTablePresenter",["UWA/Class","UWA/Core","DS/TreeModel/TreeNodeModel","DS/TreeModel/TreeDocument","DS/DataGridView/DataGridView","DS/ENOXCollectionToolBar/js/ENOXCollectionToolBarV2","DS/UIKIT/Mask","DS/Handlebars/Handlebars","DS/UIKIT/Input/Button","DS/Controls/ProgressBar","DS/CfgBulkTablePresenter/BulkEdition/Presenter/WarningDialog","i18n!DS/CfgBulkTablePresenter/assets/nls/BulkTablePresenter","text!DS/CfgBulkTablePresenter/BulkEdition/View/BulkTablePresenter.html","css!DS/CfgBulkTablePresenter/BulkEdition/Presenter/BulkTablePresenter.css"],function(e,t,i,o,s,n,a,l,r,d,h,u,c){"use strict";return e.extend({init:function(e){e=e||{},this._showEditAction=!!e.showEditAction&&e.showEditAction,this._showCompareAction=!!e.showCompareAction&&e.showCompareAction,this._conflictColumn={},this._editionflag=!1,this._compareFlag=!1},_createBulkTableDGV:function(e){this._jsonModel=e.jsonModel,this._presenterState=e.presenterState,this._dropDownData=e.dropDownData,this._modelEvent=e.modelEvent,this._expandAll=e.expandAll,this._statusBarOptions=e.statusBarOptions,this._setAsReferenceItem=!!this._showCompareAction&&e.setAsReferenceItem,this.COLUMN_ID_INDEX=e.COLUMN_ID_INDEX,this._createLayout(),this.createDataGridView(),this._subscribeToEvents(),this._createBottomBar(),this._createCollectionToolBar(),this.rendrer()},_createLayout:function(){var e=l.compile(c)();this._container=t.createElement("div",{class:"bulk-edit-container"}),this._container.innerHTML=e},createDataGridView:function(){var e=this;this._treeDocument=this._createTreeDocument(this._jsonModel.rowHeaders);var t={};t.columns=[{text:u.Variability,dataIndex:"tree",pinned:"left",editableFlag:!1},{text:u.Type,dataIndex:"type",pinned:"left",editableFlag:!1,visibleFlag:!1,getCellValue:function(e){if(e.nodeModel){var t,i=e.nodeModel.options.grid;if(i)return"Parameter"===i.type?t=u.Parameter:"VariabilityGroup"===i.type?t=u.OptionGroup:"Variant"===i.type&&(t=u.Variant),t}}},{text:u.SequenceNumber,dataIndex:"sequenceNumber",pinned:"left",editableFlag:!1,visibleFlag:!1,typeRepresentation:"integer"}];var i=this.isEditable();return t.treeDocument=this._treeDocument,t.selectionMode="cell",t.defaultColumnDef={editableFlag:i,resizableFlag:!0,sortableFlag:!0,allowUnsafeHTMLContent:!1,width:250},t.showOutlineFlag=!0,this._dataGridView=new s(t),this._createStatusBar(),this._dataGridView.columnDragEnabledFlag=!1,this._dataGridView.columns[0].sortableFlag=!0,this._dataGridView.showRowBorderFlag=!0,this._dataGridView.layout.rowsHeader=!1,this._dataGridView.onContextualEvent=function(t){var i=[];if(t&&t.collectionView&&(t.cellInfos&&-1===t.cellInfos.rowID)){(i=t.collectionView.buildDefaultContextualMenu(t,{pin:!1,firstColumnsVisibility:!0,columnsManagement:!1,sizeColumnToFit:!1,insertRow:!1}))[0].state="selected|disabled";for(var o=3;o<i.length;o++)i[o].state="selected|disabled";if(e._setAsReferenceItem&&t.cellInfos.columnID>=3){var s={type:"CheckItem",title:u.SetAsReference,action:{callback:function(t){e._onChangeCompareFlag(t.context)},context:t.cellInfos}};e._jsonModel.columnHeaders.length>=2?"left"===this.layout.getColumnPinned(t.cellInfos.columnID)&&(s.state="selected|disabled"):s.state="disabled",i.unshift(s)}}return i},this._dataGridView.onReady(function(){e._treeDocument.prepareUpdate(),e._treeDocument.expandAll(),e._treeDocument.pushUpdate(),e._dataGridView.getContent().setStyles({height:"100%",position:"relative"})}),this._dataGridView.addEventListener("click",function(t,i){i&&i.rowID>=0&&i.columnID>=3&&e._modelEvent.publish({event:"OnDataGridCellClick",data:{cellInfos:i,event:t}})}),this._treeDocument.setUseChangeTransactionMode(!0),this._dataGridView},getPresenterState:function(){return this._presenterState},isEditable:function(){return"preview-mode"!==this._presenterState},clickSave:function(){a.mask(this._container);var e=this.saveMassEdit(),t=this;return e.then(function(){t.onTableUpdateEnd()}).catch(function(){a.unmask(t._container),t.onTableUpdateEnd()}),e},clickCancel:function(){this._bulkTableModel.restoreJsonModelFromSnapshot(),this.onTableUpdateEnd()},_createBottomBar:function(){this._savePCContainer=this._container.querySelector("#bulk-edit-save"),this._cancelPCContainer=this._container.querySelector("#bulk-edit-cancel"),this._saveBtn=new r({value:u.Save,className:"primary"}).inject(this._savePCContainer),this._CancelBtn=new r({value:u.Cancel}).inject(this._cancelPCContainer);var e=this;this._saveBtn.addEvent("onClick",function(){this.setFocus(!1),e.clickSave()}),this._CancelBtn.addEvent("onClick",function(){this.setFocus(!1),e.clickCancel()})},_subscribeToEvents:function(){var e=this;this._modelEvent.subscribe({event:"enox-collection-toolbar-sort-activated"},function(t){var i={dataIndex:t.sortAttribute,sort:t.sortOrder.toLowerCase(),id:t.sortAttribute,order:t.sortOrder.toLowerCase()};e._collectionToolbar._activateCurrentSort(i),e._dataGridView&&(e._dataGridView.sortModel&&1===e._dataGridView.sortModel.length&&e._dataGridView.sortModel[0].dataIndex===i.dataIndex&&e._dataGridView.sortModel[0].sort===i.sort?e._dataGridView.reapplySortModel():e._dataGridView.sortModel=[i])}),this._modelEvent.subscribe({event:"enox-collection-toolbar-filter-search-value"},function(t){if(t.searchValue.length>0){var i=0,o=[],s=e._bulkTableModel.getJsonModel(),n=e._treeDocument.search({match:function(n){var a,l,r=n.nodeModel.getAttributeValue("title").toLowerCase(),d=t.searchValue[0].toLowerCase();if(e._dataGridView.columns[1].visibleFlag&&"variabilitygroup"===(a=n.nodeModel.getAttributeValue("type").toLowerCase())&&(a=u.OptionGroup.toLocaleLowerCase()),e._dataGridView.columns[2].visibleFlag&&(l=n.nodeModel.getAttributeValue("sequenceNumber").toString()),r.includes(d))return i++,!0;if(a&&a.includes(d))return i++,!0;if(l&&l.includes(d))return i++,!0;var h=n.nodeModel.options.grid.rowIndex;return e.isSearchedValueInDGVContent(h,d,s)?(i++,!0):(o.push(n.nodeModel),!1)},shouldStop:function(){return i===e._treeDocument.getRoots().length}});o.length>0?(o.forEach(function(e){e.hide()}),n.length>0&&n.forEach(function(e){e.show()})):o.length<=0&&n.length>0&&n.forEach(function(e){e.show()})}else e._treeDocument.getRoots().forEach(function(e){e.show()})}),this._modelEvent.subscribe({event:"pcsBulkEdit-on-change"},function(){e._container.addClassName("edition")})},isSearchedValueInDGVContent:function(e,i,o){if(e>=0&&void 0!==i)for(var s=0;s<o.matrix.length;s++){var n=this._bulkTableModel.getMatrixCellData(s,e);if(n)if(n.values){if(n.values.find(e=>e.title.toLocaleLowerCase().includes(i)))return!0}else if(t.is(n.title,"string")){if(n.title.toLocaleLowerCase().includes(i))return!0}else{var a=n.title.toString()+" "+n.unit;if(a&&a.toLocaleLowerCase().includes(i))return!0}}return!1},onTableUpdateStart:function(){let e={id:"edit-pencil",icon:"pencil",text:u.Disable_Edit};this._privateChannel.publish({event:"enox-collection-toolbar-color-selected-action",data:e}),this._privateChannel.publish({event:"enox-collection-toolbar-change-text-tooltip-action",data:e}),this._presenterState="edition-mode",this._bulkTableModel.snapshotJsonModel()},onTableUpdateEnd:function(){if(!this._editionflag){let e={id:"edit-pencil",fonticon:"pencil",text:u.Enable_Edit};this._privateChannel.publish({event:"enox-collection-toolbar-change-icon-action",data:e}),this._container.removeClassName("edition"),this._presenterState="preview-mode"}this._bulkTableModel.getDirtyColumnHeaders()&&this._bulkTableModel.clearColumnHeaders(),this._bulkTableModel.snapshotJsonModel()},saveMassEdit:function(){var e=this._bulkTableModel.getDirtyColumnHeaders(),t=this;return this.batchSaving(e,e.length).then(function(){t._bulkTableModel.clearColumnHeaders()})},batchSaving:function(e,t,i){var o=this;return o._progressBar.visibleFlag=!0,o._progressBar.infiniteFlag=t-e.length==0,new Promise(s=>{var n=[];e.length&&n.push(o.saveElement(e.shift()));var a=[];i&&i.length>0&&(a=i),n.length?Promise.allSettled(n).then(i=>{var n=[];i.forEach(function(e){"fulfilled"===e.status?n.push(e.value):a.push(e.reason)}),o._progressBar.infiniteFlag=!1,o._progressBar.value=(t-e.length)/t*100,o.batchSaving(e,t,a).then(s()),n&&o._modelEvent.publish({event:"pcsbulk-on-save-update",data:n})}):(a.length>0?(o._modelEvent.publish({event:"pcsbulk-on-save-failed",data:a}),console.error("Save PCs failed",a)):o._modelEvent.publish({event:"pcsbulk-on-save-done"}),s(),o._progressBar.visibleFlag=!1)})},beforeClosing:function(){var e=this;return new Promise(function(t,i){e._bulkTableModel.getDirtyColumnHeaders().length?h.dialogCreation({onSave:function(){e.clickSave().then(t())},onDoNotSave:function(){e._bulkTableModel.restoreJsonModelFromSnapshot(),e.onTableUpdateEnd(),t()},onCancel:function(e){i(e)}}):t()})},_createStatusBar:function(){var e=[{type:0,id:"totalRows",dataElements:{typeRepresentation:"string",value:this._statusBarOptions.totalRowsLabel+" : "+this._jsonModel.rowHeaders.length,displayLabel:!0}},{type:0,id:"totalColumn",dataElements:{typeRepresentation:"string",value:this._statusBarOptions.totalColumnLabel+" : "+this._jsonModel.columnHeaders.length,displayLabel:!0}},{type:0,id:"nbConflict",dataElements:{typeRepresentation:"string"}}];this._statusBarOptions.withStatusInfo&&(e.push({type:0,id:"statusConflict",dataElements:{position:"far",typeRepresentation:"string",value:u.Conflicts_Computing+" : 0%",displayLabel:!0,icon:"clock"}}),this._statusBarOptions.withStatusComputing&&(e[3].dataElements.value=u.Status_Computing+" : 0%",e[3].id="statusComputing")),this._statusBarOptions.withSuggestionsComputing&&e.push({type:0,id:"statusSuggestion",dataElements:{position:"far",typeRepresentation:"string",value:u.Suggestions_Computing+" : 0%",displayLabel:this._statusBarOptions.withSuggestionsComputing,icon:"clock"}}),this._statusBarOptions.withInvalidColumn&&e.push({type:0,id:"invalidColumn",dataElements:{typeRepresentation:"string",displayLabel:!0}}),this._dataGridView.buildStatusBar(e)},_updateStatusBar:function(e){e&&this._dataGridView.elements.statusBar.getNodeModelByID(e.id).updateOptions({grid:{data:e.text,semantics:{icon:e.icon}}})},_createCollectionToolBar:function(){var e=this,t=[{id:"edit-pencil",fonticon:"pencil",text:u.Enable_Edit,handler:function(){e._onChangeEdtionFlag()}},{id:"compare-pc",fonticon:"highlighter",text:u.HighlightDifferences,handler:function(){e._onChangeCompareFlag()}}],i={modelEvents:this._modelEvent,actions:t,filter:{enableCache:!0,width:400},withStableActions:!0,sort:[{id:"tree",text:u.Variability,type:"string"},{id:"type",text:u.Type,type:"string"},{id:"sequenceNumber",text:u.SequenceNumber,type:"integer"}]};return this._collectionToolbar=new n(i),this._collectionToolbar.attachResizeSensor(),this._collectionToolbar},_onChangeCompareFlag:function(e){var t=this,i=this._bulkTableModel.getDirtyColumnHeaders();this._bulkTableModel.getJsonModel().columnHeaders.length>=2&&(this._compareFlag?e?i.some(i=>t._bulkTableModel.getColumnID(i.id)===e.columnID-t.COLUMN_ID_INDEX)?this.beforeClosing().then(function(){t.unSetColumnAsReference(!0),t.setColumnAsReference(e)}):(this.unSetColumnAsReference(!0),this.setColumnAsReference(e)):this.unSetColumnAsReference(!1):(e||(e={columnID:3}),i.some(i=>t._bulkTableModel.getColumnID(i.id)===e.columnID-t.COLUMN_ID_INDEX)?this.beforeClosing().then(function(){t.setColumnAsReference(e)}):t.setColumnAsReference(e)))},setColumnAsReference:function(){let e={id:"compare-pc",icon:"highlighter",text:u.UnHighlightDifferences};this._compareFlag=!0,this._privateChannel.publish({event:"enox-collection-toolbar-color-selected-action",data:e}),this._privateChannel.publish({event:"enox-collection-toolbar-change-text-tooltip-action",data:e})},unSetColumnAsReference:function(e){if(!e){let e={id:"compare-pc",fonticon:"highlighter",text:u.HighlightDifferences};this._compareFlag=!1,this._privateChannel.publish({event:"enox-collection-toolbar-change-icon-action",data:e})}},_onChangeEdtionFlag:function(){var e=this;this.beforeClosing().then(function(){e._editionflag?(e._editionflag=!1,e.onTableUpdateEnd()):(e._editionflag=!0,e.onTableUpdateStart())}).catch(function(e){console.error(e)})},_createTreeDocument:function(e){var t,s=new o({useAsyncPreExpand:this._expandAll});s.prepareUpdate();for(var n=0;n<e.length;n++){var a=e[n];if(a.rowIndex=n,t=new i({id:e[n].id,label:e[n].title,icons:[e[n].image],grid:a}),s.addChild(t),e[n].children&&e[n].children.length>0)for(var l=0;l<e[n].children.length;l++){var r=e[n].children[l];r.cellType="content";var d=new i({id:e[n].children[l].id,label:e[n].children[l].title,icons:[e[n].image],grid:r});t.addChild(d)}this._expandAll&&t.setState({state:"expanded"})}return s.expandAll(),s.pushUpdate(),s},countConflictInColumn:function(e){var t;if(e>=0){var i=this._jsonModel.matrix[e];if(i)for(var o=0;o<i.length;o++){var s=i[o];if(s&&s.stateValidity&&s.state)if("conflict"===s.stateValidity)this._conflictColumn[e]?this._conflictColumn[e].rowID.includes(o)||this._conflictColumn[e].rowID.push(o):this._conflictColumn[e]={columnID:e,rowID:[o],visible:!0};else if(this._conflictColumn[e]&&this._conflictColumn[e].rowID.includes(o)){var n=this._conflictColumn[e].rowID.indexOf(o);this._conflictColumn[e].rowID.splice(n,1),0===this._conflictColumn[e].rowID.length&&delete this._conflictColumn[e]}}}this._conflictColumn[e]&&this._conflictColumn[e].rowID&&(t=this._conflictColumn[e].rowID.length),this.updateNBConflictInStatusBar(t)},updateNBConflictInStatusBar:function(e){var t,i=this._countNotVisibleConflict();if(this._conflictColumn)if(e&&e>0)if(i&&i>0){var o=e-i;t={id:"nbConflict",text:u.Number_Conflict+" : "+o+"/"+e,icon:"attention"},this._updateStatusBar(t)}else t={id:"nbConflict",text:u.Number_Conflict+" : "+e,icon:"attention"},this._updateStatusBar(t);else t={id:"nbConflict"},this._updateStatusBar(t)},_countNotVisibleConflict:function(){var e=0;for(var t in this.conflictColumn)this.conflictColumn[t].rowID&&(this.conflictColumn[t].visible||(e+=this.conflictColumn[t].rowID.length));return e},countInvalidcolumn:function(){},destroy:function(){this._container.innerHTML=""},rendrer:function(){this._container&&(this._progressBar=new d({displayStyle:"lite",visibleFlag:!1}),this._progressBar.inject(this._container.querySelector("#progressbar")),this._collectionToolbar.inject(this._container.querySelector("#toolbar")),this._dataGridView.inject(this._container.querySelector("#table")),this._showEditAction||this._modelEvent.publish({event:"enox-collection-toolbar-visibility-action",data:{id:"edit-pencil",flag:!1}}),this._showCompareAction||this._modelEvent.publish({event:"enox-collection-toolbar-visibility-action",data:{id:"compare-pc",flag:!1}}))},getConflictColumn:function(){return this._conflictColumns}})});