var requires=["UWA/Core","DS/PADUtils/PADCommandProxy","DS/PADUtils/PADSettingsMgt","DS/PADUtils/PADSharedSettings","DS/PADUtils/PADUtilsServices","DS/PADUtils/PADContext","DS/FolderEditor/FolderComponent","DS/FolderEditor/FolderIdCardCont","DS/FolderEditor/FolderTreeCont","DS/FolderEditor/Folder_CSO","DS/FolderEditor/ActionBar/FolderCommandManager","DS/FolderEditor/utils/FolderEditorEvents","DS/FolderEditor/commands/FolderCommands","i18n!DS/FolderEditor/assets/nls/FolderEditor","i18n!DS/PADUtils/assets/nls/PADUtils","DS/FolderEditor/service/FolderServices","DS/FolderEditor/service/FolderTypeService","DS/IPClassifyUtil/IPClassifyAlert","DS/FolderEditor/utils/FolderEditorcontrol","DS/FolderEditor/utils/FolderEditorKeyboardListener","DS/FolderEditor/utils/FolderEditorUtil","DS/FolderEditor/utils/FolderCommunication","DS/PADServices/utils/AttributesMgtV2","DS/PADServices/utils/GlobalModelEvents","DS/WidgetServices/WidgetServices","DS/IPClassifyUXUtil/CredentialsView","DS/PADUtils/PADProbes","DS/PlatformAPI/PlatformAPI","DS/Windows/ImmersiveFrame","DS/WebUAUtils/WebUAUtils","text!DS/FolderEditor/assets/folder_settings.json","DS/FolderEditor/utils/FolderLoaderGlobal"];function initBookmark(e,t,o,n,i,r,a,s,l,d,c,u,p,g,f,h,m,v,_,C,S,F,y,D,b,E,w,A,T,x,P,I){var N=this;N.options=N.options||{},UWA.extend(N.options,{custo_view_title:g.name_Widget_Title}),N.checkOnCommand=!1,r.set(N),window.top.performance.mark("loadRequire_end"),window.top.performance.measure(N.probeHeader+"loadRequire","createWidget_begin","loadRequire_end");var U,O=function(e){if(e){var t=g[e.label];t=t||f[e.label],e.label=t||e.label,e.options&&e.options.forEach(function(e){e.label=g[e.label]})}},M=function(e){var t=o.getSpecificWidgetPreference(e);t&&t.length>0&&O(t[0]),"useIndexAccleration"==e&&(t[0].onchange="onUseOnlyDBChange",widget.addEvent("onUseOnlyDBChange",function(){var e=JSON.parse(JSON.stringify(widget.getPreference("autoSwitch")));widget.getValue("useIndexAccleration")?e.disabled=!1:e.disabled=!0,widget.addPreference(e),widget.dispatchEvent("onEdit")})),"autoSwitch"==e&&(t[0].disabled=!widget.getValue("useIndexAccleration")),widget.mergePreferences(t)},R=JSON.parse(P);if("function"==typeof window.updateSettings&&window.updateSettings(R),o.setApp(R.padsettings,"enopad",!0),w.initialize({padid:widget.id,padtitle:widget.getTitle()}),widget.setValue("tenantAware",!0),o.addEventOnce("onNoSecurityContext",function(e){!0!==e&&(_._isSecurityCTXInitialized=!1,widget.setBody(" "),UWA.createElement("div",{text:g.get("authentication_error"),class:"FolderEditor_auth_error"}).inject(widget.body))}),o.addEventOnce("onNoPlatform",function(){_._isTenantInitialized=!1,widget.setBody(" "),UWA.createElement("div",{text:g.get("noPlatform_error"),class:"FolderEditor_auth_error"}).inject(widget.body)}),N.updateTitle=function(){N.setTitle&&N.setTitle(N._label)},o.addEvent("onPad_security_ctx",N.updateTitle.bind(N)),o.addEvent("onPad_tenant",N.updateTitle.bind(N)),widget.addPreference({name:"pad_security_ctx",type:"hidden"}),M("drag-and-drop"),M("filtered-content"),M("allow-products-expand"),M("show-sub-folders"),M("activateBIFilter"),o.setSetting("activateTreeFilter",!1),M("useIndexAccleration"),M("autoSwitch"),!0===widget.getValue("noCompass")&&widget.setValue("autoSwitch","Never"),window.authoringModeODT&&widget.setValue("useIndexAccleration",!1),U=["x3dPlatformId"],n.addSharedSettings(widget,U),U.forEach(function(e){var t=widget.getPreference(e);O(t)}),"1"===widget.getValue("debug_me")&&(M("activateOpenWith18xFD01"),M("expandSaveLimitation"),M("resetCustomization"),M("compactModeForLeftSidebar"),M("CandABookmark")),M("activeIsLastVersionColumn"),!0===o.getSetting("Activate_relationsColumns")?M("activateRelationsColumns"):widget.addPreference({name:"activateRelationsColumns",type:"hidden"}),N.widget.addEvent("endEdit",o.updateWidgetPreferences.bind(o)),o.updateWidgetPreferences(),o.setSetting("activate_autodownload",!1),o.setSetting("EditModeActivated",!0),o.setSetting("compactMode",!0),!1!==widget.getValue("activeIsLastVersionColumn")){var k=y.getMap().defaultOrder;k.push("ds6wg:PLMReference.V_isLastVersion");var L={default:!0,order:k};y.updateAttributesList(L)}N.widget.getValue("x3dAppId")||N.widget.addPreference({name:"x3dAppId",type:"hidden",defaultValue:"ENOFOL3_AP"}),N.widget.addEvent("onPlatformIdChange",function(e,t){"x3dPlatformId"==e&&o.dispatchEvent("onPad_tenant")}),_.setWidgetRefresh(N.onRefresh.bind(N));let W={};W.onRefresh=_.getWidgetRefresh(),W.widgetCBOnPopup=_.onTenantSecurityCTXPopup,E.render(W),N.promiseCtx=new Promise(function(e){_.checkSecurityCTXandTenantInitialization(function(){e()},!0),i.app_initialization(()=>{})}),u.onCurrentFolderChange(function(e){N.setTitle(this.getLabel())});var V=b.getWidgetId()+b.getTenantID()+"ENOFOL3_AP";if(A.subscribe(V,function(){N.folderTree_Cont.refreshFolderTreeAndContent()}),u.onFolderRename(function(e){e.getID()===d.getCurrentFolderID()&&UWA.is(widget)&&N.setTitle(e.getLabel())}),N.setTitle=function(e){var t=b.getTenantID(),o=i.getTenantsPreference().filter(function(e){return e.value===t})[0];o=o?o.label:t;var n=widget.getPreference("pad_security_ctx").value;N._csName&&N._currentSC===n?N._setTitle(e,o,N._csName):require(["DS/PADUtils/PADWSAccess","DS/PADUtils/PADSecurityCtxConverter"],function(i,r){i.getscandcollab({tenant:t,onComplete:function(t){(UWA.is(t,"string")?JSON.parse(t):t).collabspaces.forEach(function(e){!!n&&n.endsWith("."+e.name)&&(N._currentSC=n,N._csName=e.title.trim())}),e&&N._setTitle(e,o,N._csName)},onFailure:function(e){}})})},N._setTitle=function(e,t,o){var n=e||"";o&&(n=o+" - "+n),N._label=e,widget.setTitle(n)},N.getEditMode=function(){var e=_.getContent();return!!e&&e.getEditMode()},N._onRefreshFolder=function(e){var t=!1,o=[];if(require("DS/FolderEditor/views/FolderMode").switchtoAuthoringMode(!0),e.authored&&UWA.is(e.authored.connected,"array")){var n=d.getCurrentFolder().getID(),i=e.authored.connected;if(i.length>0)for(var r=0;r<i.length;r++){var a=i[r];if(UWA.is(a,"array")){var s=a[0];if(a.length>1&&o.push(a[1]),s==n){t=!0;break}}}}t&&N.folderContent_Cont.loadContentAndSelect(d.getCurrentFolder(),o)},F.subscribe("FolderEditor.refresh",N._onRefreshFolder.bind(N)),N._commandProxy=t.create({events:{onRefresh:N._onRefreshFolder.bind(N)}}),null===N.folderTree_Cont||void 0===N.folderTree_Cont){N.core=e,N.widget.body.empty(),N._buildSkeleton(),I.setContainer("global",this.widget.body.globalLoaderContainer),I.addComponentsToLoad("global",{widget:""});N.widget.addEvent("endEdit",function(){N.widget.getPreferences().forEach(function(e){var t="boolean"===e.type&&UWA.is(e.value,"string")?N.convertToBool(e.value):e.value;N.widget.setValue(e.name,t)})}),N.folderGlobal_div=N.widget.body.container,N.folderTree_div=N.widget.body.left_side_div,N.folderSlide_div=N.widget.body.slide_div,N.folderTreeDoc_div=N.widget.body.right_side_div,N.folderIdCard_div=N.widget.body.top_right_side_div,N.folderContent_div=N.widget.body.bottom_right_side_div;var B=N._initializeFolderEditorComponent.bind(N);if(null===N.folderContent_Cont){var j={x3dAppId:N.widget.getValue("x3dAppId"),lang:N.widget.lang?N.widget.lang:N.widget.getValue("lang"),layout:{view_customization:null,css_view_class:N.css_view_class,store_roots_in_pref:!0,padshell:!0},authorize_setStructure:!0,settings:R};!0===o.getSetting("resetCustomization")?(localStorage.removeItem("PADTreeListDefinition."+N.widget.getValue("x3dAppId")+"_"+widget.getValue("x3dPlatformId")),B(j)):S.getContentViewPreference().then(function(e){var t=[];if(e){var o=e.preference;j.layout.view_customization=o;var n=widget.getValue("vMigration");if(o&&n!==o.version){console.log("Bookmark migration needed for preferences");var i=new Promise(function(t,o){require(["DS/FolderMigration/FolderMigration"],function(i){i.migratePreferences(e,n).then(t).catch(o)})});t.push(i)}}Promise.all(t).then(function(){B(j)})}),N.getSelectedNodes=function(){var e=c.getTempSelection(),t=e||d.getSelectedNodes();if(1===(Array.isArray(t)?t.length:0)){var o=t[0];if(o&&"FolderSection_Trash"===o.plmType){var n=_.getTrashCont();if(n){var i=n.getSelectedNodes();Array.isArray(i)&&i.length>0&&(t=i)}}}return t},N.getCurrentFolder=function(){var e=S.getCurrentSecurityContextAndFolderData(!0);return JSON.stringify(e)},N.getSecurityContext=function(){var e=S.getTenant();return{SecurityContext:o.getSetting("pad_security_ctx"),tenant:e}},N.RefreshView=function(e){var t=!1,o=e.created,n=e.modified,i=e.deleted,r=[],a=[];if(o.forEach(function(e){"Duplicate"===e.operation||"Revise"===e.operation?t=!0:console.log("  unknown operation :",e.operation)}),n.length>0){t=!1;var s={};s.modified=n,_.getContent().getPADTreeDocument().refreshNodeById(s)}i.length>0&&(t=!0,i.forEach(function(e){"Delete"===e.operation&&e.physicalid.length>0&&a.push(e.physicalid)}));for(var l=d.getCurrentFolder(),c=l.getID(),u=!1,p=0;p<a.length;p++){var f=a[p];if(f===c){u=!0;break}if(l.isExpanded()&&l.hasChildren())for(var C=l.getChildren(),S=0;S<C.length;S++){var F=C[S];F.id===f&&_.getTreeCont().removeFromTree(F)}}if(!0===u){var y=l.getParent();y&&(_.getTreeCont().removeFromTree(l),y.select(!0),t=!1)}else if(a.length>0){var D=l.getType();if(m.inFamilyFolder(D)&&UWA.is(_.getContent())){for(p=0;p<a.length;p++)_.getContent().removeNodeInContent(a[p]);t=!1}}if(!0===t&&r.length>0)h.AddContent({IDs:r,callbacks:{onComplete:function(e){var t=d.getCurrentFolder();_.getContent().RefreshProductStructure=!0,N.folderContent_Cont.loadContentAndSelect(t,r[0]);var o,n,i="";if(e){var a=JSON.parse(e);o=a.objectsAlreadyPresent,n=a.objectsAdded,i=a.information?" ("+a.information+")":i}0!==o?v.displayNotification({message:g.replace(g.msg_info_Addinfolder,{objectsAlreadyPresent:o,objectsAdded:n,targetfolder:t.getLabel()})+i,className:"success"}):v.displayNotification({message:g.replace(g.msg_info_Addinfolder_1,{objectsAdded:n,targetfolder:t.getLabel()})+i,className:"success"})},onFailure:function(e){if(e&&e.advice)v.displayNotification({title:g.msg_error_Addinfolder,subtitle:e.advice,message:e.error,className:"error"});else if(e&&e.message&&e.message.contains("NetworkError")&&e.message.contains("500"))v.displayNotification({message:g.msg_error_objectNoLongerAccessible,className:"error"});else{let t={className:"error"};t.message=g.msg_error_Addinfolder,e&&(t.message=e,t.title=g.msg_error_Addinfolder),v.displayNotification(t)}}}});else if(!0===t&&0===r.length){var b=d.getCurrentFolder();_.getContent().RefreshProductStructure=!0,N.folderContent_Cont.loadContentAndSelect(b)}return e},N.beginBlockingTransaction=function(e){require(["DS/UIKIT/Mask"],function(t){t.mask(N.folderContent_div,e)})},N.endBlockingTransaction=function(){require(["DS/UIKIT/Mask"],function(e){e.unmask(N.folderContent_div)})},N.author=function(e){},N.insertNodes=function(e){var t=[];function o(e){-1===t.indexOf(e.resourceid)&&t.push(e.resourceid)}for(var n in e)e.hasOwnProperty(n)&&e[n].forEach(o);var i=t[0];N._insertOrAdd(i,"insert")},N.addRoots=function(e){if(e.pids.length>0){var t=e.pids[0];N._insertOrAdd(t,"add",!0)}},N._insertOrAdd=function(e,t,o){var n=d.getCurrentFolder();require("DS/FolderEditor/views/FolderMode").switchtoAuthoringMode();var i=!0;if(null!==n){var r=n.getType();if((m.inFamilyFolder(r)||"FolderSection_AllFolders"==r)&&(i=!1,UWA.is(_.getContent())&&_.getContent().loadContentAndSelect(n,e,{insertMode:t}),UWA.is(_.getTreeCont()))){var a=n.isFavorite?_.getTreeCont()._getVisibleNodeById(n.getID()):n,s="partiallyExpanded"===a.getState();null!==a&&a.isExpanded()&&!s?_.getTreeCont().updateTreeWithNewFolder(a):!0===n.isFavorite||n.isExpanded()&&!s||!0!==o||n.expand()}}if(i){var l=[];UWA.is(_.getTreeCont())&&(l=_.getTreeCont()._folders_TreeDocument.getRoots()),l.forEach(function(t){"FolderSection_AllFolders"==t.plmType&&(null!==n&&n.unselect(),t.select(),UWA.is(_.getContent())&&_.getContent().loadContentAndSelect(t,e),t.isExpanded()?_.getTreeCont().updateTreeWithNewFolder(t):!0!==t.isFavorite&&o&&t.expand())})}},N.displayNotification=function(e){v.displayNotification({message:e.msg,className:e.eventID})},N.getPADTreeDocument=function(){return _.getContent()?_.getContent().getPADTreeDocument():this.options.model},N.toggleView=function(e){UWA.is(_.getContent().toggleView)&&_.getContent().toggleView(e)},N.getPADTreeListView=function(){return _.getContent().getPADTreeListView()},N.compactMode=function(e){return _.getContent().compactMode(e)}}}}function preferenceIsNotSet(e){return void 0===widget.getValue(e)||null===widget.getValue(e)}function FolderEditor(e){"use strict";var t=new Promise(function(e){require(["DS/FolderEditor/utils/FolderEditorUtil"],e)});function o(e){console.log(e)}var n={widget:null,promiseCtx:null,promiseInit:null,folderContent_Cont:null,folderTree_div:null,folderTreeDoc_div:null,folderTree_Cont:null,folderIdCard_div:null,folderIdCard_Cont:null,core:null,widthToHideLeftPanel:300,_actionbar:null,_commandProxy:null,folderTree_W_NotLinked:!1,css_view_class:"windowed",_mouseEventsManager:{unlockMouseMove:!1,draggingXSlider:null,mouseStartXSlider:null,initialMouseStartXSlider:null,dragginDirection:null,cancelDragging:!1,spanPosition:null,widthLeftDiv:null,widthRightDiv:null,widthLeftDivSave:null,widthRightDivSave:null,widthGlobalDiv:null,newWidthGlobalDiv:null},init:function(e){var t=this;this.widget=e.widget,e.launchWithReadMode&&(this.widget.launchWithReadMode=this.widget.readOnly=e.launchWithReadMode),this.widget.folderToOpen=e.folderToOpen,this.widget.multiselection=e.multiselection,this.reInitialize=e.reInitialize;var o=null,n={};this.widget=e.widget,this.widget.changeInPreference={},this.widget.refreshDuetoChangeInPreference=!1,this.widget.addEvent("onLoad",this.onLoad.bind(this)),this.widget.addEvent("onRefresh",this.onRefresh.bind(this)),this.widget.addEvent("onDestroy",this.onDestroy.bind(this)),this.widget.addEvent("onResize",this.onResize.bind(this)),this.widget.addEvent("onEdit",function(){o||(o=o||{},t.widget.preferences.forEach(function(e){"hidden"!==e.type&&(o[e.name]=t.widget.getValue(e.name))}))}),this.widget.addEvent("endEdit",function(e){t._manageOpenWith(!0),!(!e||!e.submitted&&!e.needRefresh)&&o&&(t.widget.changeInPreference={},Object.keys(o).forEach(function(e){if(n[e]=t.widget.getValue(e),o[e]!==n[e]){if("pad_security_ctx"===e&&n[e])require("DS/FolderEditor/service/FolderEditorWebService").setPreferredSecurityContext(n[e]);t.widget.changeInPreference[e]=n[e]}}),UWA.log(t.widget.changeInPreference),t.widget.refreshDuetoChangeInPreference=!0,o=null)})},onRefresh:function(e){var t=this;e&&e.reInitialize?t._onReInit():require(["DS/FolderEditor/Folder_CSO","DS/IPClassifyUtil/IPClassifyAlert","i18n!DS/FolderEditor/assets/nls/FolderEditor","DS/PADUtils/PADSettingsMgt","DS/FolderEditor/Folder_Clipboard"],function(o,n,i,r,a){if(t.folderContent_Cont.addEvent("onCompleteRefreshNodes",function(e){this.removeEvent("onCompleteRefreshNodes"),n.displayNotification({message:i.msg_info_refresh,className:"primary"})}),e&&UWA.is(e.authored.deleted,"array")){var s=o.getCurrentFolder();s.getID()===e.authored.deleted[0]&&s.getParent().select(!0),require("DS/FolderEditor/views/FolderMode").switchtoAuthoringMode(),0==a.removeDeletedNodeFromClipboard(e.authored.deleted)&&a.ClearClipboard()}var l=require("DS/FolderEditor/utils/FolderEditorcontrol").getFindInCtx();l&&l.visibleFlag&&l.closeViewafterRefresh(),require("DS/FolderEditor/views/FolderMode").updateIconAndSettings(!1),t.folderTree_Cont.refreshFolderTreeAndContent(),require(["DS/FolderEditor/utils/FolderEditorcontrol","DS/PlatformAPI/PlatformAPI","DS/LifecycleServices/LifecycleServicesSettings"],function(e,t,o){var n=!1;o.getEnforceFolderLinkSettingAsync(function(e,t){e||(n=t)}),(n||e.isCustomizedEnv()||e.isActiveBookmarkActivated())&&t.publish("FolderEditor.ActiveFolderCheck",{})}),t.widget.refreshDuetoChangeInPreference=!1,t.widget.changeInPreference={}})},setCtxMenu:function(e,t,o){require(["DS/FolderEditor/commands/FolderCommands"],function(o){o&&o.showWebInWinCtxMenu(e,t)})},insertSelectedSearchObjs:function(e){var t=e[0].split(",");require(["DS/ApplicationFrame/CommandsManager"],function(e){if(e)try{var o=e.getCommand("AddExistingContent");o.preProcessInsertOperation(t),o._processInsertOperation(t)}catch(e){console.error("Error trying to execute command","ActiveFolder",e)}})},onWebInWinFilterChange:function(e){require(["DS/FolderEditor/tagger/TaggerContentProxy"],function(t){e.proxyId===t.getProxy().getProxyId()&&t.onFilterBIFilteringEvent(e.data)})},onClearSelection:function(){},onDestroy:function(){},onResize:function(){var e=this;setTimeout(function(){e.folderGlobal_div&&e.folderIdCard_Cont&&0!==e.folderGlobal_div.clientWidth&&e.folderIdCard_Cont.updateDisplayPath()},500),require(["DS/IPClassifyUtil/IPClassifyUtility","DS/FolderEditor/utils/FolderEditorcontrol"],function(e,t){var o=t.getTreeCont();o&&(e.isWidgetMaximized()?o.setOrderToolAreaSelectable(!0):(o.activateTreeFilter(!1),o.setOrderToolAreaSelectable(!1)))})},setSupportedTenant:function(){return new Promise((e,t)=>{require(["DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices"],o=>{o.getAppInfo({appId:widget.getValue("x3dAppId")?widget.getValue("x3dAppId"):"ENOFOL3_AP",onComplete:function(t){t.platforms.length>0&&widget.setValue("x3dPlatformId",t.platforms[0].id),e()},onFailure:t})})})},applyExclusiveFilterAndLoadContent:function(e){require(["DS/FolderEditor/utils/FolderEditorcontrol","DS/FolderEditor/tagger/TaggerContentProxy"],function(t,o){t.getContent().getSpecficMode("read").resetInfoIndex(),o.setLocalFilter(e),t.getContent().switchMode("read",!0)})},expandToBookmarkExternally:function(e){require(["DS/FolderEditor/utils/FolderEditorcontrol","DS/IPClassifyUtil/IPClassifyAlert"],function(t,o){var n=t.getTreeCont();t.getTreeCont().forceLoad=!0,n.expandTreeAndSelectFolder({folderToFindAndSelect:{ids:e.ids},partiallyExpandPath:e.isToBeExpandedPartially,onComplete:function(){dscef&&dscef.sendString('{"operation":"expand successful"}')},onFailure:function(e){dscef&&dscef.sendString('{"operation":"expand failed"}'),o.displayNotification({message:e instanceof Error?e.message:e,className:"error"})}})})},onLoad:function(){require(["DS/IPClassifyUtil/IPClassifyUtility"],function(e){e.setPCSEntry(widget.id+"_FolderWidgetLoad",!0)});var e=!0===widget.getValue("noCompass");if(!e){require(["DS/MSFDocumentManagement/WidgetIntegration"],function(e){widget.MSFDocumentClient=e,widget.MSFDocumentClient.ConnectWidgetWithMSF()})}this._assignTenantFromX3DContentId();var t=widget.getValue("x3dPlatformId"),o=Promise.resolve();t||e||(o=this.setSupportedTenant()),o.then(this._preLoad.bind(this))},_preLoad:function(){var e=this;this.probeHeader=this.widget.id+"_"+this.widget.getTitle()+"_",window.top.performance.mark("onLoad_begin"),window.top.performance.measure(this.probeHeader+"createToOnLoad","createWidget_begin","onLoad_begin");var t=!0;if(preferenceIsNotSet("vMigration")&&preferenceIsNotSet("pad_security_ctx"))widget.setValue("vMigration",7);else{var o=widget.getValue("vMigration");(o=o||0)<7&&(t=!1,console.log("Bookmark migration needed"),require(["DS/FolderMigration/FolderMigration"],function(t){t.migrate(7).then(function(){widget.migrated=!0,e._onLoad()})}))}t&&e._onLoad()},_onReInit:function(){var e=this;delete n.folderTree_Cont,n.folderTree_Cont=null,delete n.folderContent_Cont,n.folderContent_Cont=null,delete n.folderIdCard_Cont,n.folderIdCard_Cont=null,n.widget.body.container=null,n.folderTree_W_NotLinked=!1,require(["DS/FolderEditor/utils/FolderEditorEvents"],function(t){t.unsubscribeAll(),n.init({widget:e.widget,reInitialize:!0})})},_onLoad:function(){var e=this;this.promiseInit=new Promise(function(t){!0===widget.getValue("noCompass")?require(["DS/FolderEditor/utils/FolderEditorEvents"],function(e){e.onFolderEditorReadyforWenInWin(function(){t()})}):e.widget.addEvent("onFolderEditorReady",function(){t()})}),require(["DS/PADUtils/Configuration","text!DS/FolderEditor/assets/FolderEditorConf.json","DS/PADServices/utils/AttributesMgtV2"],function(t,o,n){var i=JSON.parse(o);t.mergeConfig(i);var r=[],a=new Promise(function(e){require(requires,function(){e(arguments)})});if(r.push(a),!0!==e.reInitialize){var s=n.initialize({defaultAttributesJSON:"DS/FolderEditor/assets/FolderEditorColumns.json"});r.push(s)}Promise.all(r).then(function(t){initBookmark.apply(e,t[0])})})},_slidderMoveEndCallback:function(){this.folderIdCard_Cont&&this.folderIdCard_Cont.updateDisplayPath()},_buildSkeleton:function(){if(!this.core.is(this.widget.body.container)){var e=new UWA.Element("div",{class:"wux-control-inline-container",style:{"vertical-align":"top"}});e.inject(widget.body);var t=require("DS/Windows/ImmersiveFrame"),o=require("DS/WebUAUtils/WebUAUtils"),n=require("DS/WidgetServices/WidgetServices"),i=new t;i.inject(e),this.widget.immersiveFrame=i,"false"!==n.getUrlParameter("UAPanel")&&o.setPanelHelpMode({immersiveFrame:i}),this.widget.body.container=UWA.createElement("div",{class:"FolderEditor_global_container"}).inject(i.getFreeZone(),"top"),this.widget.body.globalLoaderContainer=UWA.createElement("div",{class:"FolderEditor_global_loader"}).inject(this.widget.body.container),this.widget.body.left_side_div=UWA.createElement("div",{class:"FolderEditor_left_side_div"}).inject(this.widget.body.container),this.widget.body.right_side_div=UWA.createElement("div",{class:"FolderEditor_right_side_div"}).inject(this.widget.body.container),this.widget.body.top_right_side_div=UWA.createElement("div",{class:"FolderEditor_top_right_side_div"}).inject(this.widget.body.right_side_div),this.widget.body.bottom_right_side_div=UWA.createElement("div",{class:"FolderEditor_bottom_right_side_div"}).inject(this.widget.body.right_side_div)}},convertToBool:function(e){return"true"===e.toLowerCase()},_assignTenantFromX3DContentId:function(){t.then(e=>{var t=e.getX3DTenant();t&&"OnPremise"!==t&&this.widget.setValue("x3dPlatformId",t)})},_manageOpenWith:function(e){var n=require("DS/FolderEditor/utils/FolderEditorcontrol"),i=require("DS/IPClassifyUtil/IPClassifyAlert");t.then(t=>{e&&t.clearX3DItem();var r=t.getX3DBookmarkId();r&&(this._assignTenantFromX3DContentId(),require("DS/FolderEditor/views/FolderMode").switchtoAuthoringMode(),n.getTreeCont().expandTreeAndSelectFolder({folderToFindAndSelect:{ids:[r]},partiallyExpandPath:!0,onComplete:function(){},onGiveUp:o.bind(null," expandTreeAndSelectFolder:onGiveUp"),onFailure:function(e){var t=e;"object"!=typeof e&&(t={message:e}),t.className="error",i.displayNotification(t)}}))})},_initializeFolderEditorComponent:function(e){var t=this,o=require("DS/FolderEditor/FolderTreeCont"),n=require("DS/FolderEditor/utils/FolderEditorcontrol"),i=require("DS/FolderEditor/FolderComponent"),r=require("DS/FolderEditor/utils/FolderEditorKeyboardListener"),a=require("DS/LifecycleServices/LifecycleServicesSettings"),s=(require("DS/PADUtils/PADUtilsServices"),require("DS/PADUtils/PADProbes"),require("DS/IPClassifyUtil/IPClassifyUtility")),l=t.folderTree_Cont;t.folderTree_Cont||(l=new o({lang:t.widget.lang?t.widget.lang:t.widget.getValue("lang"),css_view_class:t.css_view_class,events:{onReady:function(){if(n.setTreeCont(this),t.folderTree_Cont=this,null!==t.folderContent_Cont)t.folderTree_Cont.setOption("_folderContentView",t.folderContent_Cont);else{if(!0===t.folderTree_W_NotLinked)throw"FolderTree are not linked !!!";t.folderTree_W_NotLinked=!0}t.folderTree_Cont._commonToolSection.inject(this.elements.container,0),t._manageOpenWith(),!0===widget.getValue("noCompass")?require(["DS/FolderEditor/utils/FolderEditorEvents"],function(e){e.notifyFolderEditorReady()}):t.widget.dispatchEvent("onFolderEditorReady")}}}));var d=t._retrieveinitializationOpts(),c=UWA.extend(e,d);c.multiselection=!1!==this.widget.multiselection,require(["UWA/Promise"],function(e){var t=[],o=new e(function(e){require(["DS/FolderEditor/views/additionalColumns/FolderIsLastRevisionColumn"],function(t){t.isAdditionalColumnsAvailable(function(o){!0===o?e(t):e()})})}),n=new e(function(e){require(["DS/FolderEditor/views/additionalColumns/BookmarkLocationColumn"],function(t){t.isAdditionalColumnsAvailable(function(o){!0===o?e(t):e()})})}),r=new e(function(e){require(["DS/FolderEditor/views/additionalColumns/ThumbnailColumn"],function(t){t.isAdditionalColumnsAvailable(function(o){!0===o?e(t):e()})})}),a=new e(function(e){require(["DS/IPClassifyUX/views/additionalData/manipulationUnitColumns","DS/FolderEditor/dataProvider/ManipulationUnitColumnsDataProvider"],function(t,o){t.isAdditionalColumnsAvailable(o,function(o){!0===o?e(t):e()})})});e.all([n,o,r,a]).then(function(e){var o;e.forEach(e=>{e&&t.push(e)}),(o=t).length&&(c.additionalColumnsModules=o),new i(c,l)})}),t.promiseInit.then(()=>{if(t.folderTree_Cont){t.folderTree_Cont._doScrolltotheSavedPosition(),s.setPCSEntry(widget.id+"_FolderWidgetLoad",!1),s.sendPCSTracketPageEvent("FolderWidget_Performance","FolderWidgetLoad",widget.id+"_FolderWidgetLoad");var e=window.top.performance.getEntriesByName("createWidget_begin");e&&e.length>0&&(window.top.performance.mark("createWidget_end"),window.top.performance.measure(t.probeHeader+"createWidget","createWidget_begin","createWidget_end")),setTimeout(()=>{var e=!1;a.getEnforceFolderLinkSettingAsync(function(t,o){t||(e=o)}),(e||n.isCustomizedEnv()||n.isActiveBookmarkActivated())&&require(["DS/ApplicationFrame/CommandsManager"],e=>{try{var t=e.getCommand("ActiveFolder",n.getContent());t&&t.begin()}catch(e){console.error("Error trying to execute command","ActiveFolder",e)}})})}}),t._keyboardListener||(t._keyboardListener=new r,t._keyboardListener.startObservingKeyboard())},_viewChanged:function(){require("DS/PADServices/utils/GlobalModelEvents").getModelEvents().publish({event:"ENOBook/AttributesCustomization/columnSwitchDone",data:{}})},_retrieveinitializationOpts:function(){var e=this,n=require("DS/FolderEditor/FolderIdCardCont");return{renderTo:e.folderContent_div,events:{onActionBarReadyToBuild:function(){e.elements=this.elements,e.options=this.options,e.togglePanel=this.togglePanel,null===e.folderIdCard_Cont&&new n({lang:e.widget.lang?e.widget.lang:e.widget.getValue("lang"),css_view_class:e.css_view_class,events:{onReady:function(){e.folderIdCard_Cont=this,e.folderIdCard_Cont.render().inject(e.folderIdCard_div)}}})},onReady:function(){e.folderContent_Cont=this,e.addEvent=e.folderContent_Cont.addEvent.bind(e.folderContent_Cont);require("DS/PADUtils/PADSettingsMgt");if(null!==e.folderTree_Cont)e.folderTree_Cont.setOption("_folderContentView",e.folderContent_Cont);else{if(!0===e.folderTree_W_NotLinked)throw"FolderTree are not linked !!!";e.folderTree_W_NotLinked=!0}e.folderContent_Cont.options.renderTo&&e.folderContent_Cont.render().inject(e.folderContent_Cont.options.renderTo),e.promiseInit.then(function(){if(e.folderTree_Cont){e.folderContent_Cont._OnPADComponentReady();var t=e.folderContent_Cont.getPADTreeListView();if(t&&e.folderTree_Cont.modeChange({viewMode:t.options.viewMode}),e.widget.dispatchEvent("onFolderComponentReady"),1==e.widget.launchWithReadMode&&e.widget.folderToOpen){var n=e.widget.folderToOpen;e.folderTree_Cont.expandTreeAndSelectFolder({folderToFindAndSelect:{ids:[n]},partiallyExpandPath:!0,onComplete:o.bind(null," expandTreeAndSelectFolder:onComplete"),onGiveUp:o.bind(null," expandTreeAndSelectFolder:onGiveUp"),onFailure:function(e){var t=e;"object"!=typeof e&&(t={message:e}),t.className="error",IPClassifyAlert.displayNotification(t)}})}}}),require(["DS/IPClassifyUtil/IPClassifyCommunication"],function(t){if(!0===widget.getValue("noCompass")){var o;const n=function(n){clearTimeout(o),o=setTimeout(function(){var o=e.folderContent_Cont.getPADTreeDocument().getXSO().get(),n=[];o.forEach(function(e){n.push(e.getID())}),t.publish("onObjectSelected",n);require("DS/FolderEditor/views/FolderMode");var i=[];o.forEach(function(e){var t={id:e.getID(),label:e.getLabel(),type:e.options.type,cadMaster:e.options.grid["ds6w:cadMaster"],kind:e.options.grid["ds6w:kind"],contentStructure:e.options.grid["ds6w:contentStructure"]};i.push(t)}),t.publish("selectedObjectsInContent",i)},n)};e.folderContent_Cont.getPADTreeDocument().getXSO().onChange(function(){n(20)})}})},onCustoViewChange:function(o){t.then(function(t){t.setContentViewPreference(o,!1).then(e._viewChanged.bind(e))})},onSaveAsTemplate:function(o){t.then(function(t){t.setContentViewPreference(o,!0).then(e._viewChanged.bind(e))})},onToggleView:function(){require("DS/FolderEditor/ActionBar/FolderCommandManager").updateCommands()}}}}};return n.init(e),n}define("DS/FolderEditor/service/FolderEditorWebService",["UWA/Core","DS/WAFData/WAFData","i18n!DS/FolderEditor/assets/nls/FolderEditor","DS/PADUtils/PADSettingsMgt","DS/PADUtils/PADUtilsServices","DS/WidgetServices/WidgetServices","DS/FolderEditor/utils/FolderSearch","DS/FolderEditor/utils/FolderEditorcontrol","DS/PADServices/utils/GlobalUtils","UWA/Utils/Client"],function(e,t,o,n,i,r,a,s,l,d){"use strict";function c(e){return UWA.is(e,"array")?e.toString():e}var u=function(){var e=r.getWidgetValue("appId");return(e=e||r.getWidgetValue("x3dAppId"))+"-"+(window.top.dsUserLogin?window.top.dsUserLogin:"unknown")+"-"+(new Date).getTime()};return{searchInFolder:function(e){var t={};UWA.extend(t,e);var r=null;if(e.pid){if(Array.isArray(e.pid)&&e.pid.length>200)return void t.onFailure("warning",{error:{errorCode:"innerError",errorMessage:o.msg_warning_LimitInCtxSearchOnAllBookmarks}});if(e.searchQuery&&e.searchQuery.length<2)return void t.onFailure("warning",{error:{errorCode:"innerError",errorMessage:o.replace(o.SearchEnterMoreThan,{minNumber:2})}});var s="FolderSection_AllFolders"===e.type?e.searchQuery:e.searchQuery+" AND NOT(physicalid:"+e.pid+")",l=i.get3DSearchUrl()+"/search",d=widget.lang?widget.lang:widget.getValue("lang");if(t.payload=Object.assign({},a.getSearchInfo()),t.payload.query=s,t.payload.tenant=i.getPlatformId(),t.payload.locale=d,t.payload.label=u(),!0!==t.synthesis){t.payload.select_predicate=a.getIndexPredicates(),t.payload.with_synthesis="false";let o=a.getResultsCount();o&&(t.payload.nresults=o),t.payload.next_start=void 0,t.payload.start=void 0,t.payload.source=["3dspace"],t.payload.select_predicate=a.getIndexPredicates(),e.order_field&&(t.payload.order_field=e.order_field,t.payload.order_by=e.order_by);var c=a.getInfoIndex();null!=c?t.payload.next_start=c.next_start:t.payload.start=0}var p=n.getSetting("pad_security_ctx");p&&(t.payload.login={"3dspace":{SecurityContext:p}}),"FolderSection_AllFolders"===e.type?t.payload.specific_source_parameter={"3dspace":{search_in_context:{expand:{root_path_physicalid:e.pid,type_filter_rel:["Data Vaults","Sub Vaults","Vaulted Objects"]}}}}:t.payload.specific_source_parameter={"3dspace":{search_in_context:{expand:{root_physicalid:e.pid,type_filter_rel:["Data Vaults","Sub Vaults","Vaulted Objects"]}}}},t.filters&&Object.keys(t.filters).length>0&&(t.payload.refine=t.filters),t.method="POST",t.headers={Accept:"application/json","content-type":"application/json","Accept-Language":d},t.type="json",t.data=UWA.Json.encode(t.payload),t.withoutSC=!0,t.timeout=12e4,r=this._executeRequest(l,t,"searchInFolder")}return r},loadThumbnails:function(e){return e.fetchThumbnails=!0,this.fetch(e)},fetch:function(e){var t={};UWA.extend(t,e);var o=e.ids,a=null;if(o.length){var s=i.get3DSpaceUrl()+"/cvservlet/fetch/v2",d=r.getLanguage(),c={physicalid:o,label:u()};t.fetchThumbnails&&(c.select_file=["thumbnail_2d"]),t.select_predicate&&(c.select_predicate=t.select_predicate),t.query={tenant:e.tenant},t.method="POST",t.headers={Accept:"application/json","content-type":"application/json",SecurityToken:l.getUserLogin()+"|"+n.getSetting("pad_security_ctx")+"|"+r.getLanguage(),"Accept-Language":d},t.type="json",t.data=UWA.Json.encode(c),t.withoutSC=!0,a=this._executeRequest(s,t,"loadThumbnails")}return a},content:function(e){var t={};UWA.extend(t,e);var o=null;if(e.searchQuery)o=this.searchInFolder(e);else{var n=i.get3DSpaceUrl()+"/resources/v1/FolderManagement/Folder/"+t.pid+"/getContent";t.payload={},t.payload.Content="All"===t.content?"All":void 0,t.payload.FilterChildren="Yes"===t.filterChildren?"Yes":void 0,t.payload.select_predicate=a.getAuthAttributes(),t.headers={"content-type":"application/json"},t.data=UWA.Json.encode(t.payload),t.method="POST",t.timeout=12e4,o=this._executeRequest(n,t,"content")}return o},roots:function(e){var t=e,o=i.get3DSpaceUrl()+"/resources/v1/FolderManagement/Folder/roots";return t.method="POST",t.payload={},t.payload.Type=t.type,t.payload.CollabSpace=t.collabSpace,t.payload.select_predicate=a.getAuthAttributes(),t.headers={"content-type":"application/json"},t.data=UWA.Json.encode(t.payload),t.timeout=12e4,this._executeRequest(o,t,"roots")},allBookmarks:function(e){return e.start||(e.start=0),e.fetchAll=!0,e.noIcon=!0,this._performSearchQuery(e,"(type:Workspace)","allBookmarks")},getRootsFromChildren:function(e){(!e.ids||e.ids.length<=0)&&e.onFailure(),this._performNavigateQueryToRoot(e,"getRootsFromChildren")},_performSearchQuery:function(e,t){var o={};UWA.extend(o,e);var r=i.get3DSearchUrl()+"/search";o.payload=Object.assign({},a.getSearchInfo()),o.select_predicate?o.payload.select_predicate=o.select_predicate:o.payload.select_predicate=o.payload.select_predicate;var s=new Date,l=Math.random().toString(36).substr(2,9);o.payload.label=("FolderWidgetSearch_"+l+"_"+s.getTime()).replace(new RegExp(" ","g"),"_").replace(new RegExp(",","g"),"").replace(new RegExp("/","g"),"-");var d=widget.lang?widget.lang:widget.getValue("lang");o.payload.locale=d,o.payload.query=t,o.payload.tenant=i.getPlatformId(),o.payload.next_start=e.next_start,o.payload.start=e.start,e.noIcon&&(o.payload.select_file=void 0),o.payload.source=["3dspace"];var c=n.getSetting("pad_security_ctx");return c&&(o.payload.login={"3dspace":{SecurityContext:c}}),o.method="POST",o.headers={"content-type":"application/json"},o.withoutSC=!0,o.type="json",e.order_field&&(o.payload.order_field=e.order_field,o.payload.order_by=e.order_by),e.searchPageCount&&(o.payload.nresults=e.searchPageCount),!0===e.fetchAll&&(o.payload.nresults=1e3),o.filters&&Object.keys(o.filters).length>0&&(o.payload.refine=o.filters),o.data=UWA.Json.encode(o.payload),this._executeRequest(r,o,"searchInLibrary")},_performNavigateQueryToRoot:function(e){var t={};UWA.extend(t,e);var o=n.getSetting("pad_security_ctx"),r=i.get3DSpaceUrl()+"/cvservlet/navigate";r+="?SecurityContext="+o;t.payload={},t.payload.input_physical_ids=e.ids,t.payload.primitives=[{navigate_from_rel:{id:1,filter:{rel_type:["Data Vaults","Sub Vaults"]}}}],t.payload.patterns={WORKSPACE:[{id:1,iter:-1}]},t.payload.patternTypeFilters={typesToReturn:["Workspace Vault"]},t.payload.attributes=e.select_predicate,t.payload.version=3;var a=new Date;return t.payload.label=("FolderWidgetNavigate_"+a.getTime()).replace(new RegExp(" ","g"),"_").replace(new RegExp(",","g"),"").replace(new RegExp("/","g"),"-"),t.method="POST",t.headers={"content-type":"application/json"},t.type="json",t.withoutSC=!0,t.withoutTenant=!0,t.headers.SecurityContext=n.getSetting("pad_security_ctx"),t.data=UWA.Json.encode(t.payload),this._executeRequest(r,t,"searchInLibrary")},DownloadFolderStructure:function(e){var t=e,o=i.get3DSpaceUrl()+"/resources/v1/FolderManagement/Folder/FolderDownloadPost";t.headers={"content-type":"application/json"},t.method="POST",t.data={physicalId:t.pid,FCSurl:i.get3DSpaceUrl()},t.data=UWA.Json.encode(t.data),t.timeout=12e4,this._executeRequest(o,t,"FolderDownloadPost")},getFolderPathsforItem:function(e){var t={};UWA.extend(t,e);var o=i.get3DSpaceUrl()+"/cvservlet/navigate",r=widget.lang?widget.lang:widget.getValue("lang");t.payload={},t.payload.locale=r,t.payload.order_by="asc",t.payload.order_field="ds6w:label",t.payload.tenant=i.getPlatformId(),t.query={SecurityContext:n.getSetting("pad_security_ctx"),tenant:i.getPlatformId()},t.payload.input_physical_ids=e.id,t.payload.attributes=["ds6w:label","ds6w:type"],t.payload.version=3,t.payload.primitives=[{navigate_from_rel:{id:1,filter:{bo_type:["Workspace","Workspace Vault","Personal Workspace"]}}}],t.payload.patterns={GET_PARENT:[{id:1,iter:-1}]},t.payload.patternFlags={GET_PARENT:{flags:["returnPaths"]}},t.payload.attributes=["ds6w:label","ds6w:type"],t.payload.source=["3dspace"];var a=new Date;return t.payload.label=("bookmarkWidgetNavigate_"+a.getTime()).replace(new RegExp(" ","g"),"_").replace(new RegExp(",","g"),"").replace(new RegExp("/","g"),"-"),t.timeout=12e4,t.payload.start=0,t.method="POST",t.headers={Accept:"application/json","content-type":"application/json","Accept-Language":r},t.type="json",t.data=UWA.Json.encode(t.payload),this._executeRequest(o,t,"getFolderPathsforItem")},_findBookmarksInBookmark:function(e){var t={};UWA.extend(t,e);var o=i.get3DSearchUrl()+"/search",r=widget.lang?widget.lang:widget.getValue("lang");t.payload={},t.payload.locale=r,e.searchFTSquery&&(t.payload.query=e.searchFTSquery),e.rscIdToSearch&&(t.payload.query="physicalid:"+e.rscIdToSearch),t.payload.select_bo=["physicalid","ds6w:type","ds6w:globalType","ds6w:label"],"FolderSection_AllFolders"===e.type?t.payload.specific_source_parameter={"3dspace":{search_in_context:{expand:{root_path_physicalid:e.pid,type_filter_rel:["Data Vaults","Sub Vaults"]}}}}:t.payload.specific_source_parameter={"3dspace":{search_in_context:{expand:{root_physicalid:e.pid,type_filter_rel:["Data Vaults","Sub Vaults"]}}}},t.payload.nresults=100,t.payload.source=["3dspace"];var a=new Date;return t.payload.label=("_findBookmarksInBookmark"+a.getTime()).replace(new RegExp(" ","g"),"_").replace(new RegExp(",","g"),"").replace(new RegExp("/","g"),"-"),t.timeout=12e4,t.method="POST",t.payload.tenant=i.getPlatformId(),t.headers={Accept:"application/json","content-type":"application/json","Accept-Language":r,SecurityContext:n.getSetting("pad_security_ctx")},t.type="json",t.data=UWA.Json.encode(t.payload),this._executeRequest(o,t,"_findBookmarksInBookmark")},getToolbar:function(e){var t=this;return r.get3DSpaceUrlAsync({onComplete:function(o){var n=e,i=o+"/resources/v1/FolderManagement/Folder/toolsCommands";n.query={touch:d.Features.touchEvents&&!d.Features.pointerEvents,activeFolder:s.isActiveBookmarkActivated(),importCSV:s.isImportCSVActivated(),customizedEnv:s.isCustomizedEnv(),readOnly:1==widget.launchWithReadMode},n.method="GET",n.headers={Accept:"text/xml,application/json"},n.withoutSC=!0,t._executeRequest(i,n,"commands")}})},getActionBar:function(e){var t=this;return r.get3DSpaceUrlAsync({onComplete:function(o){var n=e,i=o+"/resources/v1/FolderManagement/Folder/commands";n.query={touch:d.Features.touchEvents&&!d.Features.pointerEvents,activeFolder:s.isActiveBookmarkActivated(),importCSV:s.isImportCSVActivated(),customizedEnv:s.isCustomizedEnv()},n.method="GET",n.headers={Accept:"text/xml,application/json"},n.withoutSC=!0,t._executeRequest(i,n,"commands")}})},setPreferredSecurityContext:function(e,t){var o=null,n=new Promise((n,i)=>{o=r.get3DSpaceUrlAsync({onComplete:r=>{var a=t||{},s=r+"/resources/pno/person/setsecuritycontext";a.query={SecurityContext:e},a.method="POST",a.withoutSC=!0,(o=this._executeQuery(s,a,"commands")).then(n).catch(i)}})});return n.cancel=(()=>{o&&o.cancel()}),n},folders:function(e){var t=e,o=i.get3DSpaceUrl()+"/resources/v1/FolderManagement/Folder/"+t.pid+"/folders";t.query={Level:t.level},t.method="GET",this._executeRequest(o,t,"folders")},folderTree:function(e){var t=e,o=i.get3DSpaceUrl()+"/resources/v1/FolderManagement/Folder/"+(t.pid||"root")+"/folderTree";if(t.headers={"content-type":"application/json"},t.expandList||t.level||t.isRoot){if(t.data={expandList:c(t.expandList),level:t.level&&t.level+"",isRoot:t.isRoot?"true":""},t.explicitRoots&&t.explicitRoots.length>0&&(t.data.explicitRoots=t.explicitRoots),t.partialExpandList&&t.partialExpandList.length>0&&(t.data.partialExpandList=t.partialExpandList),1==e.Read){t.data.Read=!0,t.data.nresults=function(e){var t="TREE"==e?s.getTreeCont():s.getContent();if(t){var o=t.getGridViewRowHeight(),n=t.getContentHeight();if(o&&n)return Math.ceil(n/o)+10}return 25}("TREE");var n=s.getTreeCont()._folders_SortElmt;t.data.sortOrder=n.sortOrder,t.data.sortMode="alpha"==n.sortMode?"ds6w:label":"ds6w:modified",t.data.nextStart=t.nextStart,t.data.refine=t.refine}else t.data.Read=!1;t.data=UWA.Json.encode(t.data)}t.method="POST",t.timeout=12e4,this._executeRequest(o,t,"folderTree")},removecontent:function(e){var t=e,o=i.get3DSpaceUrl()+"/resources/v1/FolderManagement/Folder/"+t.pid+"/removecontent";t.headers={"content-type":"application/json"},t.IDs&&(t.data={IDs:c(t.IDs)},t.data=UWA.Json.encode(t.data)),t.method="POST",t.timeout=12e4,this._executeRequest(o,t,"removeContent")},removecontentsearchwithin:function(e){var t=e,o=i.get3DSpaceUrl()+"/resources/v1/FolderManagement/Folder/removecontent";t.headers={"content-type":"application/json"},t.objectID&&t.folderIDs&&(t.data={ObjectID:c(t.objectID),FolderIDs:c(t.folderIDs)},t.data=UWA.Json.encode(t.data)),t.method="POST",t.timeout=12e4,this._executeRequest(o,t,"removecontentsearchwithin")},replaceContent:function(e){var t=e,o=i.get3DSpaceUrl()+"/resources/v1/FolderManagement/Folder/"+t.pid+"/replacebycontent";t.headers={"content-type":"application/json"},t.IDsRemoved&&t.IDsAdded&&(t.data={IDsRemoved:c(t.IDsRemoved),IDsAdded:c(t.IDsAdded)},t.data=UWA.Json.encode(t.data)),t.method="PUT",t.timeout=12e4,this._executeRequest(o,t,"replaceContent")},getlastversion:function(e){var t=e,o=i.get3DSpaceUrl()+"/resources/v1/dslc/getlastversions?validIntents=E&";t.headers={"content-type":"application/json"};var n=t.objectsToTreat;n&&(t.data=n),t.data=UWA.Json.encode(t.data),t.method="POST",t.timeout=12e4,this._executeRequest(o,t,"getlastversion")},addcontent:function(e){var t=e,o=i.get3DSpaceUrl()+"/resources/v1/FolderManagement/Folder/"+t.pid+"/content";if(t.headers={"content-type":"application/json"},t.IDs){var n=this._deduplicateContentId(t.IDs);t.data={IDs:c(n)},t.data=UWA.Json.encode(t.data)}t.method="POST",t.timeout=12e4,this._executeRequest(o,t,"addContent")},movecontent:function(e){var t=e,o=i.get3DSpaceUrl()+"/resources/v1/FolderManagement/Folder/"+t.pid+"/content";t.headers={"content-type":"application/json"},t.IDs&&t.SourceFolderId&&(t.data={IDs:c(t.IDs),SourceFolderId:t.SourceFolderId},t.data=UWA.Json.encode(t.data)),t.method="PUT",t.timeout=12e4,this._executeRequest(o,t,"moveContent")},checkCopyfolder:function(e){var t=e,o=i.get3DSpaceUrl()+"/resources/v1/FolderManagement/Folder";t.headers={"content-type":"application/json"},t.PhysicalId&&(o+="/checkCount",t.data={physicalIds:c(t.PhysicalId)},t.data=UWA.Json.encode(t.data)),t.method="POST",t.timeout=12e4,this._executeRequest(o,t,"copyFolder")},copyfolder:function(e){var t=e,o=i.get3DSpaceUrl()+"/resources/v1/FolderManagement/Folder";t.headers={"content-type":"application/json"},t.TargetPhysicalId&&t.PhysicalId&&(o+="/"+t.TargetPhysicalId,t.data={physicalIds:c(t.PhysicalId)},e.hasOwnProperty("withContent")&&(t.data.withContent=e.withContent),t.data=UWA.Json.encode(t.data)),t.method="POST",t.timeout=12e4,this._executeRequest(o,t,"copyFolder")},getFolderProperties:function(e){var t=e,o=i.get3DSpaceUrl()+"/resources/v1/FolderManagement/Folder/"+t.pid+"/properties";t.method="GET",this._executeRequest(o,t,"getFolderProperties")},getContentProperties:function(e){var t=e,o=i.get3DSpaceUrl()+"/resources/v1/FolderManagement/Folder/"+t.pid+"/ContentProperties";t.method="POST",t.payload={},t.payload.select_predicate=a.getAuthAttributes(),t.headers={"content-type":"application/json"},t.data=UWA.Json.encode(t.payload),this._executeRequest(o,t,"getContentProperties")},setFolderProperties:function(e){var t=e,o=i.get3DSpaceUrl()+"/resources/v1/FolderManagement/Folder/"+t.pid+"/update";t.method="POST",t.headers={"content-type":"application/json"},t.type="json",t.data=UWA.Json.encode(t.properties),this._executeRequest(o,t,"setFolderProperties")},movefolder:function(e){var t=e,o=i.get3DSpaceUrl()+"/resources/v1/FolderManagement/Folder";t.headers={"content-type":"application/json"},t.TargetPhysicalId&&t.PhysicalId&&(o+="/"+t.TargetPhysicalId,t.data={physicalIds:c(t.PhysicalId)},t.data=UWA.Json.encode(t.data)),t.method="PUT",t.timeout=12e4,this._executeRequest(o,t,"moveFolder")},getFolderPath:function(e){var t=e,o=i.get3DSpaceUrl()+"/resources/v1/FolderManagement/Folder/path";t.headers={"content-type":"application/json"},t.pids&&(t.data={folderIds:c(t.pids)},t.data=UWA.Json.encode(t.data)),t.method="POST",t.timeout=12e4,this._executeRequest(o,t,"getFolderPath")},newFolder:function(e){var t=e,o=i.get3DSpaceUrl()+"/resources/v1/collabServices/authoring/op/createContent";t.query={select:"type&select=physicalid&select=cestamp",folderID:e.parentBookmarkId&&""!==e.parentBookmarkId?e.parentBookmarkId:void 0},t.method="POST",t.headers={"content-type":"application/json"};t.data=JSON.stringify({type:"folder"}),t.forcedSecurityContext&&(0!=t.forcedSecurityContext.indexOf("ctx::")&&(t.forcedSecurityContext="ctx::"+t.forcedSecurityContext),t.headers.SecurityContext=encodeURIComponent(t.forcedSecurityContext)),this._executeRequest(o,t,"newFolder")},deleteFolder:function(e){var t=e,o=i.get3DSpaceUrl()+"/resources/lifecycle/Delete/structure";t.method="POST",t.headers={"content-type":"application/json"};var n={data:[{physicalid:t.pid}]};t.data=JSON.stringify(n),t.forcedSecurityContext&&(0!=t.forcedSecurityContext.indexOf("ctx::")&&(t.forcedSecurityContext="ctx::"+t.forcedSecurityContext),t.headers.SecurityContext=encodeURIComponent(t.forcedSecurityContext)),this._executeRequest(o,t,"deleteFolder")},personSearch:function(e){var t=e,o=i.get3DSpaceUrl()+"/resources/v2/e6w/service/PersonSearch";t.query={searchStr:t.name},t.method="GET",this._executeRequest(o,t,"personSearch")},getUserPreferences:function(e){var t=e,o=this,n=null;return n=r.getCompassUrlAsync({onComplete:function(e){var i=e+"/resources/AppsMngt/user/getPreferences";t.query={name:t.name},t.method="GET",t.headers={Accept:"application/json",SecurityContext:void 0},t.withoutTenant=!0;var r=o._executeRequest(i,t,"getUserPreferences");n?n.cancel=r.cancel:n=r}})},setUserPreferences:function(e){this.saveUserPreferences(e)},saveUserPreferences:function(e){var t=this,o=e;this._lastPrefToSave||(this._lastPrefToSave={}),this._lastPrefToSave[e.name]=e,this._lastRequests||(this._lastRequests={}),this._lastRequests[e.name]&&this._lastRequests[e.name].cancel(),this._lastRequests[e.name]=null,r.getCompassUrlAsync({onComplete:function(n){var i=t._lastPrefToSave[e.name];if(i){var r=n+"/resources/AppsMngt/user/preference";o.method="PUT",o.headers={Accept:"application/json",SecurityContext:void 0,"Content-Type":"application/x-www-form-urlencoded"},o.data={name:i.name,value:i.value},o.withoutTenant=!0,t._lastRequests[e.name]&&t._lastRequests[e.name].cancel(),t._lastRequests[e.name]=t._executeRequest(r,o,"saveUserPreferences"),delete t._lastPrefToSave[e.name]}}})},_deduplicateContentId:function(e){var t=[],o=[];return null!=e&&Array.isArray(e)&&e.forEach(function(e){o.indexOf(e)<0&&(o.push(e),t.push(e))}),t},_executeQuery:function(e,t,o){var n=null,i=new Promise((i,r)=>{t.onTimeout=r,t.onFailure=r,t.onComplete=i,n=this._executeRequest(e,t,o)});return i.cancel=n?n.cancel:()=>{},i},_executeRequest:function(e,r,a){var s=Math.round(1e3*Math.random()).toString(),l=widget.id+"_"+widget.getTitle()+"_";window.top.performance.mark("folderRequest_begin"+s);var d={};UWA.extend(d,r),UWA.is(d.onTimeout,"function")||(d.onTimeout=function(){var e={type:"timeout",toString:function(){return o.msg_InfoAction_Timeout}};d.onFailure(e)},d.onComplete=function(e){window.top.performance.mark("folderRequest_end"+s);var t=window.top.performance.getEntriesByName("folderRequest_begin"+s);t&&1===t.length&&(window.top.performance.measure(l+"_Request"+a,"folderRequest_begin"+s,"folderRequest_end"+s),window.top.performance.clearMarks("folderRequest_end"+s),window.top.performance.clearMarks("folderRequest_begin"+s)),r.onComplete&&r.onComplete(e)});var c={Accept:"application/json","Accept-Language":widget.lang?widget.lang:widget.getValue("lang")};r.withoutSC||(c.SecurityContext=encodeURIComponent(n.getSetting("pad_security_ctx"))),r.headers?d.headers=UWA.extend(c,r.headers):d.headers=c,UWA.is(d.query)||(d.query={}),d.query.tenant||!0===r.withoutTenant||(d.query.tenant=i.getPlatformId());var u=e;return 0!==Object.keys(d.query).length&&(u+=(e.indexOf("?")<0?"?":"&")+UWA.Utils.toQueryString(d.query)),t.authenticatedRequest(u,d)}}}),define("DS/FolderEditor/views/xBookInitError",["css!DS/PADUtils/PADUtils","i18n!DS/PADUtils/assets/nls/PADUtils.json","UWA/Core","UWA/Controls/Abstract","UWA/Class/Options"],function(e,t,o,n,i){"use strict";return n.extend(i,{init:function(e){this._parent(e),this.elements.container=UWA.createElement("div",{class:"pad_error_all"}),this.elements.errormsg=UWA.createElement("span",{class:"pad_error_msg"}),this.elements.errormsg.innerHTML=e.msg,this.elements.errormsg.inject(this.elements.container)},render:function(){return this}})}),define("DS/FolderEditor/commands/ActionBar_ExpandNCmd",["UWA/Core","DS/ApplicationFrame/Command"],function(e,t){"use strict";return t.extend({labelTopBar:e.i18n("Expand N levels"),isInsert:!0,datas:{},init:function(e){this._parent(e,{mode:"exclusive",isAsynchronous:!1}),require(["DS/IPClassifyUtil/IPClassifyAlert","DS/PADUtils/views/PADLevelSel","DS/FolderEditor/Folder_CSO","i18n!DS/FolderEditor/assets/nls/FolderEditor","DS/FolderEditor/utils/FolderEditorcontrol"],function(e,t,o,n,i){})},beginExecute:function(){},execute:function(){var e=require("DS/IPClassifyUtil/IPClassifyAlert"),t=require("DS/PADUtils/views/PADLevelSel"),o=require("DS/FolderEditor/Folder_CSO"),n=require("i18n!DS/FolderEditor/assets/nls/FolderEditor"),i=require("DS/FolderEditor/utils/FolderEditorcontrol").getContent().getSelectedNodes(),r=null;r=o.getCurrentFolder(),i.length?new t({events:{onApply:function(e){i.forEach(function(t){null===t.options.children||t.expandNLevels({numberOfLevelsToExpand:parseInt(e),initialLevel:t.getNodeDepth()})})}}}):null===r?e.displayNotification({message:n.msg_warning_noselection,className:"warning"}):new t({events:{onApply:function(e){r.expand({expandLevel:parseInt(e),clearLast:!0,initialLevel:r.getNodeDepth()})}}})},endExecute:function(){}})}),define("DS/FolderEditor/commands/tools/ImportCSVFilesUtils",["UWA/Core"],function(e){"use strict";return{formatBytes:function(e,t){if(0===e)return"0 Byte";var o=t+1||3,n=Math.floor(Math.log(e)/Math.log(1e3));return(e/Math.pow(1e3,n)).toPrecision(o)+" "+["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"][n]},getStringByte4UTF8:function(e){for(var t=[0,1,1,1,2,3,2,3,4,3],o=0,n=0;n<e.length;n++)o+=t[encodeURIComponent(e.charAt(n)).length];return o},Sanitize:{encode:function(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}},removeControllCode:function(e){return e.replace(/[\t\r\n]/g,"")},escapeControllCode:function(e){return e.replace(/\t/g,"\\t").replace(/\r/g,"\\r").replace(/\n/g,"\\n")}}}),define("DS/FolderEditor/utils/FolderLoaderGlobal",["UWA/Class","DS/Controls/Loader","i18n!DS/FolderEditor/assets/nls/FolderEditor"],function(e,t,o){function n(e){console.log("%c"+e,"color: orange")}return e.singleton({init:function(){this.container={global:null,contentView:null},this.loader={global:new t({height:35}),contentView:new t({height:35})},this.counter={global:0,contentView:0},this.displayedMessages={global:0,contentView:0}},setContainer:function(e,t){this.container.hasOwnProperty(e)?(this.container[e]=t,this.loader[e].inject(t)):n('The type of loader "'+e+'" is not defined.')},addComponentsToLoad:function(e,t){var i,r,a=UWA.clone(this.counter);if(this.loader.hasOwnProperty(e)){for(var s in t)this.displayedMessages.hasOwnProperty(s)&&this.removeComponentToLoad(e,s),i=s[0].toUpperCase()+s.substring(1)+"_Loading",r=null!=o[i]?o[i]:t[s],this.loader[e].on(r),this.displayedMessages[s]=r,this.counter[e]++,this.displayedMessages[e]++;a[e]>=0&&this._show(this.container[e])}else n('The type of loader "'+e+'" is not defined.')},removeComponentToLoad:function(e,t){this.loader.hasOwnProperty(e)?this.displayedMessages.hasOwnProperty(e)?(this.loader[e].off(this.displayedMessages[t]),delete this.displayedMessages[t],this.counter[e]--,this.displayedMessages[e]--,this.displayedMessages[e]=this.displayedMessages[e]>0?this.displayedMessages[e]:0,this.counter[t]--,this.counter[t]=this.counter[t]>0?this.counter[t]:0,this.counter[e]=this.counter[e]>0?this.counter[e]:0,0==this.counter[e]&&this._hide(this.container[e])):(console.log("loaderType :  "+this.counter[e]+"  key:  "+this.counter[t]),n('The "'+t+'" message is not displayed on the loader.')):n("The type of loader "+e+" is not defined.")},_show:function(e){e.style.display="flex"},_hide:function(e){e.style.display="none"}})}),define("DS/FolderEditor/models/xBookNodeModel",["DS/Tree/TreeNodeModel","DS/WebappsUtils/WebappsUtils","i18n!DS/ENXNav/assets/nls/ENXNav.json","DS/PADServices/utils/AttributesMgtV2"],function(e,t,o,n){"use strict";function i(e){e._getFilterInfo||(e._getFilterInfo=s.prototype._getFilterInfo.bind(e),e._getChildrenFilterInfo=s.prototype._getChildrenFilterInfo.bind(e),e._removeChildrenFilterInfo=s.prototype._removeChildrenFilterInfo.bind(e),e.filterInChild=s.prototype.filterInChild.bind(e),e.filterOutChild=s.prototype.filterOutChild.bind(e))}var r={label:"",icons:[],grid:{},padgrid:{},resourceid:"",type:"",relationid:"",relationtype:"",relationOrder:-1,did:"",relcount:null,isPADHidden:!1,padstate:"collapsed",children:[],thumbnail:null,useAsyncPreExpand:!0,emptyStatusbarVisibleFlag:!0,contextualMenu:[{type:"SeparatorItem"}]},a=function(e){var t=e.grid["ds6w:reserved"]?e.grid["ds6w:reserved"]:e.padgrid&&e.padgrid["ds6w:reserved"]?e.padgrid["ds6w:reserved"]:null;null!==t&&(("boolean"==typeof(t=Array.isArray(t)?t.indexOf("TRUE")>=0:t)?t:"TRUE"===t.toUpperCase()||"RESERVED"===t.toUpperCase())?(e.grid["ds6w:reserved"]="TRUE",e.padgrid&&e.padgrid["ds6w:reserved"]&&(e.padgrid["ds6w:reserved"]="TRUE"),this._isLockedByMe(e)?(this.options.statusbarIcons=["key"],this.options.statusbarIconsTooltips=[o.tooltip_reserved]):(this.options.statusbarIcons=["lock"],this.options.statusbarIconsTooltips=[o.tooltip_reserved])):(e.grid["ds6w:reserved"]="FALSE",e.padgrid&&e.padgrid["ds6w:reserved"]&&(e.padgrid["ds6w:reserved"]="FALSE"),this.options.statusbarIcons=["lock-open"],this.options.statusbarIconsTooltips=[o.tooltip_unreserved]))};function s(o){this.options=UWA.clone(r),this.options.grid.bi_color="rgba(0, 0, 0, 0)",o&&o.grid&&(this.options.subLabel=o.grid["ds6w:responsible"],this.options.description=o.grid["ds6w:identifier"],this.options.thumbnail=o.thumbnail?o.thumbnail:t.getWebappsAssetUrl("PADUtils","icons/32/I_DefaultThumbnail.png"),a.call(this,o)),o&&UWA.is(o.relcount)&&0===o.relcount&&(o.children=null),this.options=UWA.extend(this.options,o),e.call(this,this.options)}s.prototype=Object.create(e.prototype);var l={getType:function(){return this.plmType},getOccurencePath:function(e){if(UWA.is(e,"function")&&e(this),!this.isRoot()&&this.getParent()){var t=this.getParent().getOccurencePath(e);return t.push(this.options.relationid),t.push(this.options.resourceid),t}return[this.options.resourceid]},getOccurencePathWithType:function(){if(!this.isRoot()&&this.getParent()){var e=this.getParent().getOccurencePathWithType();return e.push({resourceid:this.options.relationid,type:this.options.relationtype}),e.push({resourceid:this.options.resourceid,type:this.options.type}),e}return[{resourceid:this.options.resourceid,type:this.options.type}]},getNodeByPath:function(e,t,o,n){if(("number"!=typeof t||t<0)&&(t=0),("number"!=typeof o||o<0||o>=e.length)&&(o=e.length-1),this.options.resourceid instanceof Array&&this.options.resourceid.indexOf(e[t])>=0||this.options.resourceid===e[t]){if(t!==o&&(this.isExpanded()||this.childComputed||void 0!==n&&!1!==n)){var i=e[t+1],r=this.getChildren();if(r&&0!==r.length){for(var a=null,s=0;s<r.length&&null===a;s++){var l=r[s];i===l.options.relationid&&(a=l)}return null===a?this:a.getNodeByPath(e,t+2,o,n)}return this}return this}},getID:function(){return this.options.resourceid},getRelationID:function(){return!0===this.isRelationsObjectNode?null:this.options.relationid},getNodesById:function(e){var t={listOfFoundNodes:[]};return this._getNodesById(e,t),t.listOfFoundNodes},getChildByIds:function(e,t){var o,n=this.getChildren();if(n)for(var i=0;i<n.length;i++)if(void 0===e){if(n[i].getID()===t){o=n[i];break}}else if(n[i].getRelationID()===e){o=n[i];break}function r(o){var n;return void 0===e?o.getID()===t&&(n=o):o.getRelationID()===e&&(n=o),n}if(void 0===o&&void 0!==this.options._childrenFilterInfo&&this.options._childrenFilterInfo.filteredOutChildren&&this.options._childrenFilterInfo.filteredOutChildren.length>0)for(var a=this.options._childrenFilterInfo.filteredOutChildren,s=0;s<a.length;s++){var l=a[s];if(o=r(l))break;var d=l.getChildren();if(d)for(var c=0;c<d.length&&!(o=r(d[c]));c++);}return o},_removeFilterInfo:function(){delete this.options._filterInfo},_removeChildrenFilterInfo:function(){delete this.options._childrenFilterInfo},_getFilterInfo:function(e){return!this.options._filterInfo&&Boolean(e)&&(this.options._filterInfo={}),this.options._filterInfo},_getChildrenFilterInfo:function(e){return!this.options._childrenFilterInfo&&Boolean(e)&&(this.options._childrenFilterInfo={}),this.options._childrenFilterInfo},filterOut:function(){var e=this.isRoot()?this.getTreeDocument():this.getParent();null!==e&&(i(e),e.filterOutChild(this))},filterIn:function(e){var t=this._getFilterInfo();if(t&&t.parentBeforeFiltering){var o=t.parentBeforeFiltering;i(o),o.filterInChild(this)}if(Boolean(e)){var n,r=this._getChildrenFilterInfo();(n=r&&r.childrenBeforeFiltering?r.childrenBeforeFiltering:this.getChildren())&&n.forEach(function(t){t.filterIn(e)})}},filterOutChild:function(e){var t=this.getChildren();if(t.indexOf(e)<0)throw"Not a child";var o=this._getChildrenFilterInfo(!0);if(!o.childrenBeforeFiltering){o.childrenBeforeFiltering=t&&t.length>0?t.slice(0):[];UWA.is(this._expandState)&&(o.expandStateBeforeFiltering={noExpandState:"noChildren",expandingState:"expanding",partiallyExpandedState:"partiallyExpanded",collapseState:"expanded",expandState:"collapsed"}[this._expandState])}e._getFilterInfo(!0).parentBeforeFiltering=this,UWA.is(this.removeChild,"function")?this.removeChild(e):this.removeRoot(e,!0,!0),UWA.is(this.setState,"function")&&this.setState({state:o.expandStateBeforeFiltering}),o.filteredOutChildren||(o.filteredOutChildren=[]),o.filteredOutChildren.push(e)},filterInChild:function(e){var t=this._getChildrenFilterInfo();if(t){var o=t.childrenBeforeFiltering;if(o){var n=o.indexOf(e);if(n>=0){var i=e._getFilterInfo();if(i&&i.parentBeforeFiltering===this){var r,a=this.getChildren();if(a)for(var s=0;s<a.length;s++){var l=a[s];if(o.indexOf(l)>n){r=l;break}}delete i.parentBeforeFiltering,this.insertBefore(e,r),UWA.is(this.setState,"function")&&this.setState({state:t.expandStateBeforeFiltering}),e._removeFilterInfo();var d=t.filteredOutChildren.indexOf(e);t.filteredOutChildren.splice(d,1),0===t.filteredOutChildren.length&&this._removeChildrenFilterInfo()}}}}},_getNodesById:function(e,t){var o=!1;if(this.getID()===e)t.listOfFoundNodes.push(this),o=!0;else{var n=this.getChildren();if(n)for(var i=0;n&&i<n.length;i++)o=n[i]._getNodesById(e,t)||o}return o},updateAttributes:function(e,t){if(!UWA.is(e,"array")||!UWA.is(t,"array"))throw new Error("Invalid argument(s)");var o=t,i=t.tree?t.tree:n.getTreeColumn(),r={};e.forEach(function(e){UWA.is(e.value)&&UWA.is(e.value.replace,"function")&&(e.value=e.value.replace(/\\n/g," ")),"ds6w:type"===e.name&&(r.type=e.value),e.name===i?r.label=e.value:"type_icon_url"===e.name?(r.icons=[],r.icons.push(e.value)):"preview_url"===e.name||"thumbnail_2d"===e.name?(r.thumbnail=e.value,r.grid=r.grid?r.grid:{},r.grid.thumbnail="url("+e.value+")"):-1!==o.indexOf(e.name)&&(r.grid||(r.grid={}),r.grid[e.name]=e.value)}),this.updateOptions(r)},isDescendantOf:function(e){var t;if(t=e instanceof s?e.getID():e,this.getID()===t)return!0;if(!this.isRoot()){var o=this.getParent();if(o)return o.isDescendantOf(t)}return!1},getDepth:function(){for(var e=this,t=0;!e.isRoot();)e=e.getParent(),t++;return t},getLeaves:function(){var e=[];return this.processDescendants({processNode:function(){!1===this.hasChildren()&&e.push(this)}}),e},getAttribute:function(e){var t;return this.options.grid[e]&&(t=this.options.grid[e]),t},updateOptions:function(o){o.grid&&(this.options.thumbnail||o.thumbnail||(o.thumbnail=t.getWebappsAssetUrl("PADUtils","icons/32/I_DefaultThumbnail.png")),o.subLabel=o.grid["ds6w:responsible"]?o.grid["ds6w:responsible"]:this.options.grid&&this.options.grid["ds6w:responsible"]?this.options.grid["ds6w:responsible"]:"",o.description=o.grid["ds6w:identifier"]?o.grid["ds6w:identifier"]:this.options.grid&&this.options.grid["ds6w:identifier"]?this.options.grid["ds6w:identifier"]:"",a.call(this,o)),e.prototype.updateOptions.call(this,o)},childValidationChecker:function(){if(void 0===this.childValidationCheckerToken){this.childValidationCheckerToken=null;var e=this;this.childValidationCheckerToken=this.addEventListener("expandStateChange",function(t){"expanded"===t.data.state&&(e.removeEventListener(e.childValidationCheckerToken),e.withTransactionUpdate(function(){var t=e.getChildren().filter(function(e){return!0===e.options.waiting4validation});if(t.length>0)for(var o=0;o<t.length;o++)console.warn("NavNodeModel# Remove node to the unvalidated child "+JSON.stringify(t[o].getOccurencePath())),e.removeChild(t[o])}))})}},_isLockedByMe:function(e){var t=!0,o=e.grid["ds6w:reservedBy"]?e.grid["ds6w:reservedBy"]:e.padgrid&&e.padgrid["ds6w:reservedBy"]?e.padgrid["ds6w:reservedBy"]:"",n=e.grid["ds6w:displayName"]?e.grid["ds6w:displayName"]:e.padgrid&&e.padgrid["ds6w:displayName"]?e.padgrid["ds6w:displayName"]:"",i=require("DS/PADUtils/PADUtilsServices"),r=i.getUserLogin()?i.getUserLogin():"",a=i.getUserName()?i.getUserName():"";t=!0;return o.trim().length>0?(t=o.toUpperCase().trim()===r.toUpperCase().trim()||!1)||(t=o.toUpperCase().trim()===a.toUpperCase().trim()||!1):n.trim().length>0&&(t=a.toUpperCase().trim()===n.toUpperCase().trim()||!1),t}};for(var d in l)s.prototype[d]=l[d];return s}),define("DS/FolderEditor/commands/tools/_xBookExport",[],function(){"use strict";return{execute:function(e){require(["DS/FolderEditor/commands/tools/xBookExporter","DS/PADServices/utils/DictionaryAccess","DS/WidgetServices/WidgetServices","i18n!DS/ENXNav/assets/nls/ENXNav.json","i18n!DS/FolderEditor/assets/nls/FolderEditor"],function(t,o,n,i,r){switch(e.command_id){case"Print":var a=e.xnav_app.getPADTreeListView().getManager(),s=n.isWebInWinEnvironment()||!0===widget.getValue("noCompass");a.openPrintableViewWindow(s);break;case"ExportCSV":e.xnav_app.beginBlockingTransaction(i.exportMask),o.updateNLSforexport(e.xnav_app.getPADTreeDocument()).then(function(){var o=e.xnav_app.getPADTreeListView().getManager().getAsCSV({addLevelInformation:!0});t.generateCsv({output:o,context:e.xnav_app,csv_base_file_name:r.csv_base_file_name}),e.xnav_app.endBlockingTransaction()}).catch(function(t){console.error(t),e.xnav_app.endBlockingTransaction()})}setTimeout(function(){e.cmd&&e.cmd.enable()},500)})}}}),define("DS/FolderEditor/utils/FolderEditorManageSecurityContextCustomization",["UWA/Core","UWA/Class","DS/FolderEditorOpenness/FolderEditorOpenness","DS/PADUtils/PADSettingsMgt","DS/Logger/Logger"],function(e,t,o,n,i){"use strict";var r=i.getLogger("DS/FolderEditor/utils/FolderEditorManageSecurityContextCustomization");return t.singleton({name:"FolderEditorManageSecurityContextCustomization",init:function(e){this._parent(e),this._isSecurityContextComputedByOpening=o.useComputedSecurityContext()},adaptSecurityContextToCurrentFolder:function(e){if(e&&this._isSecurityContextComputedByOpening){var t,i=[],a=widget.getPreference("pad_security_ctx");if(a){var s=a.options;Array.isArray(s)?s.forEach(function(e){e.value&&i.push(e.value)}):r.warn("The widget has no options for pad_security_ctx preference")}else r.warn("The widget has no pad_security_ctx preference");if(i.length>0)try{t=o.computeSecurityContext(e,i)}catch(e){r.warn("FolderEditorOpenness throws exception",e)}t&&-1!==i.indexOf(t)?(widget.setValue("pad_security_ctx",t),n.setSetting("pad_security_ctx",t)):r.warn('SecurityContext "'+t+'" returned by FolderEditorOpenness is not valid')}}})}),define("DS/FolderEditor/utils/ColorUtil",["UWA/Class"],function(e){return e.singleton({colorMap:{},active:!1,setMapColor:function(e){this.colorMap=e},setActive:function(e){this.active=e},isActive:function(){return this.active},updateColorNodes:function(e){this.isActive()&&FolderEditorWebService.fetch({ids:e,select_predicate:data.tagColors[0].predicate,onComplete:e=>{let t=[];e=e.results;for(let o=0;o<e.length;++o){let n=e[o].attributes,i={};for(let e=0;e<n.length;++e)"resourceid"===n[e].name?i.id=n[e].value:-1!==data.tagColors[0].predicate.indexOf(n[e].name)&&(i.color=colorMap[n[e].value]);t.push(i)}that.onFilterBIColorize(t)},onFailure:function(){console.log("Failure during fetch of ID's for colorize")}})},getCellKPIColor:function(e){var t=null;if(this.isActive()){var o=e.nodeModel.getID(),n=this.colorMap[o];t=n||"transparent"}return t}})}),define("DS/FolderEditor/commands/ActionBar_AddFileCmd",["UWA/Core","UWA/Controls/Input","DS/ApplicationFrame/Command"],function(e,t,o){"use strict";return o.extend({labelTopBar:e.i18n("Add New Document"),isInsert:!0,input_file:null,datas:{},init:function(e){this._parent(e,{isAsynchronous:!1,isEnabled:!0})},beginExecute:function(){},execute:function(){require("DS/FolderEditor/commands/FolderCommands").uploadFileCmd()},endExecute:function(){},clearInput:function(){this.input_file&&(this.input_file.destroy(),this.input_file=null)}})}),define("DS/FolderEditor/commands/FolderActionBarCmds",["DS/ApplicationFrame/Command","DS/PADUtils/PADContext","DS/PADUtils/PADUtilsServices"],function(e,t,o){"use strict";return e.extend({init:function(e){this._parent(e)},execute:function(){var e=this,n=t.get(),i=n.options.model?n.options.model:n.getPADTreeDocument();switch(this.options.ID){case"Print":case"PrintOptions":case"ExportCSV":case"ExportCSVOptions":if("Print"===e.options.ID&&o.printWindowOpen())return;e.disable(),require(["DS/FolderEditor/commands/tools/_xBookExport"],function(t){t.execute({command_id:e.options.ID,cmd:e,xnav_app:n,model:i})});break;case"ColumnVisibility":require(["DS/FolderEditor/commands/tools/ColumnCustomization"],function(t){var o=n.options.views?n.options.views.datagridview:void 0;t.execute({command_id:e.options.ID,cmd:e,xnav_app:n,dgv:o})})}}})}),define("DS/FolderEditor/Folder_Clipboard",["UWA/Class"],function(e){"use strict";return e.singleton({name:"folder_clipboard",_currentFolder:null,_currentSelectedNodes:null,_Mode:null,_IsEmpty:!0,_IsExternalDrop:!0,init:function(e){this._parent(e)},addInFolderClipboard:function(e,t,o){if(!UWA.is(t))throw new Error("No folderNode specified");if(!UWA.is(e))throw new Error("No selected nodes specified");o=o.toUpperCase(),this._Mode=o,this._IsEmpty=!1,this._currentFolder=t,this._currentSelectedNodes=UWA.extend([],e)},removeDeletedNodeFromClipboard:function(e){if(!this._IsEmpty)return this._currentSelectedNodes=this._currentSelectedNodes.filter(function(t){return!e.includes(t.getID())})},IsEmpty:function(){return this._IsEmpty},ClearClipboard:function(){this._IsEmpty=!0},getTreeNode:function(){return this._currentFolder},getSelectedNodes:function(){return this._currentSelectedNodes},getMode:function(){return this._Mode},SetAsExternalDrop:function(e){this._IsExternalDrop=e},IsExternalDrop:function(){return this._IsExternalDrop}})}),define("DS/FolderEditor/views/additionalColumns/ThumbnailColumn",["UWA/Class","DS/FolderEditor/service/FolderEditorWebService"],function(e,t){"use strict";var o=function(){return"thumbnail"};return e.singleton({init:function(e){this.allViewsSupported=!0,this._parent(e)},isAdditionalColumnsAvailable:function(e){e(!0)},getName:o,getManagedColumnNames:()=>["thumbnail","isThumbnailSet"],toBeUpdated:function(e,t){return!e.isThumbnailSet},updateAttributes:function(e,o){t.loadThumbnails({ids:e.pids,onComplete:e=>{if(e){var t=e.results,n={};t&&(t.forEach(function(e){var t=e.attributes,o=null,i=null;t.every(function(e){if("preview_url"===e.name){if(i=(i=e.value).indexOf("snresources")<0?i:null,o||!i)return!1}else if("resourceid"===e.name&&(o=e.value,i))return!1;return!0}),n[o]={isThumbnailSet:!0},o&&i&&(n[o]={thumbnail:"url("+i+")",isThumbnailSet:!0,_root:{thumbnail:i}})}),o({pids:n}))}},onFailure:function(){o({}),console.log("Failure during thumbnail retrieval")}})}})}),define("DS/FolderEditor/utils/FolderAlert",["UWA/Class","DS/PADUtils/views/PADAlert"],function(e,t){return e.singleton({name:"Folder Alert",_alert:null,_debounceTimeout:{},init:function(){},setContainer:function(e){},displayNotification:function(e){var o=this;if(e.id&&this._debounceTimeout[e.id]?clearTimeout(this._debounceTimeout[e.id]):t.displayNotification({msg:e.message,eventID:e.className}),e.id){var n=setTimeout(function(){delete o._debounceTimeout[e.id]},100);this._debounceTimeout[e.id]=n}}})}),define("DS/FolderEditor/utils/FolderCommunication",["DS/PlatformAPI/PlatformAPI"],function(e){"use strict";return{publish:function(t,o,n){e.publish(t,o),!1!==n&&e.publish("webinwin:web:notification",JSON.stringify({event:t,content:o}))},subscribe:function(t,o,n){var i=window,r=function(){if(i===top||i.parent)return o.apply(this,arguments);throw new Exception("widget has been destroyed")};e.subscribe(t,r),!1!==n&&e.subscribe("webinwin:win:notification",function(e){"string"==typeof e&&(e=JSON.parse(e)),e&&e.event===t&&r(e.content)})}}}),define("DS/FolderEditor/utils/UserPreference",["UWA/Core","UWA/Class","i18n!DS/FolderEditor/assets/nls/FolderEditor","DS/WidgetServices/WidgetServices","DS/FolderEditor/service/FolderEditorWebService"],function(e,t,o,n,i){var r=t.extend({init:function(e){if(this._callbacks=[],e.value)this._state="hasValue",this.setValue(e.value);else if(e.name){this._state="pending";var t=this;this._pendingRequest=i.getUserPreferences({name:e.name,onComplete:function(o){var n;try{n=UWA.Json.decode(o)}catch(t){console.warn("Failed to decode",e.name,o,t)}t._state="hasValue",t.setValue(n)},onFailure:function(e){console.error(new Error(o.msg_error_nopreferences)),t._state="hasValue",t.setValue("")}})}},addCallback:function(e){if("hasValue"===this._state&&0===this._callbacks.length){var t=UWA.clone(this._value);e.call(window,t)}else this._callbacks.push(e),this._purgeCallbacks()},setValue:function(e){"pending"===this._state&&(this._pendingRequest.cancel(),this._state="hasValue"),this._value=UWA.clone(e),this._purgeCallbacks()},hasValue:function(e){return"pending"!==this._state&&UWA.equals(this._value,e)},_purgeCallbacks:function(){if("hasValue"===this._state)for(var e;e=this._callbacks.pop();){var t=UWA.clone(this._value);e.call(window,t)}}}),a=function(){var e=null;return n.isSolidworksEnvironment()?e="solidworks":n.isCatiaV5Environment()?e="catiav5":n.isNatifEnvironnement()&&(e="catia"),e=null!==e?widget.getValue("appId")+"_"+e:widget.id},s={_preferences:{},_pendingRequestsAndCallbacks:{},get:function(e,t,o){!0===o&&(e=a()+"_"+e),this._preferences[e]||(this._preferences[e]=new r({name:e})),this._preferences[e].addCallback(t)},set:function(e,t,o){!0===o&&(e=a()+"_"+e);var n=!0;if(this._preferences[e]?this._preferences[e].hasValue(t)?n=!1:this._preferences[e].setValue(t):this._preferences[e]=new r({value:t}),n&&"enopad_odt_wgd"!=widget.id&&-1===widget.id.indexOf("preview")){var s=UWA.Json.encode(t);i.saveUserPreferences({name:e,value:s,onComplete:function(){},onFailure:function(t){throw new Error("Error while saving userpreferences for ",e,t)}})}}};return n.isReplayedODT()&&(s.getPrefixName=a),t.singleton(s)}),define("DS/FolderEditor/commands/ActionBar_RemoveContentCmd",["UWA/Core","DS/ApplicationFrame/Command"],function(e,t){"use strict";return t.extend({labelTopBar:e.i18n("Remove Content"),isInsert:!0,datas:{},init:function(e){this._parent(e,{mode:"exclusive",isAsynchronous:!1}),require(["DS/FolderEditor/commands/FolderCommands"],function(e){})},beginExecute:function(){},execute:function(){require("DS/FolderEditor/commands/FolderCommands").RemoveContentCmd()},endExecute:function(){}})}),define("DS/FolderEditor/commands/tools/xBookExporter",["i18n!DS/PADUtils/assets/nls/PADUtils.json","i18n!DS/ENXNav/assets/nls/ENXNav.json","UWA/Class","UWA/Class/Options","DS/PADServices/utils/AttributesMgtV2","DS/PADUtils/PADUtilsServices","DS/WidgetServices/WidgetServices","DS/PADUtils/Utility"],function(e,t,o,n,i,r,a,s){"use strict";var l='<table style="border:1px solid black; border-collapse:collapse;">',d="</table><br/>",c='<th style="border:1px solid black; background-color:#A7C942; text-align:left; color:#FFFFFF; font-size:.8em; padding-top:5px; paddingbottom:4px;word-break:break-word;display:table-cell;">',u="</th>",p="<tr>",g="</tr>",f="<td>",h="</td>";function m(e,t,o){for(var n=e.length,i=0;i<n;i++){o(t,e[i],i)}}function v(e,t){var o=e.options.grid[t];return s.convertDateTime(o)}function _(e){return""+e}function C(e,t){if("tree"===e)return t.options.label;var o=null;if("function"==typeof b.customizedColumnRenderers[e])o=b.customizedColumnRenderers[e](t);else switch(typeof t.options.grid[e]){case"string":o=t.options.grid[e];break;case"number":o=_(t.options.grid[e]);break;case"boolean":o=(!0===t.options.grid[e])+"";break;default:o=""}return o}function S(e,t,o){var n=[];n.push(_(o.getDepth())),n.push(C("tree",o)),t.forEach(function(e){var t=(e.customisation?e.customisation:e.xnav_options).kind;if(t)switch(t){case"date":n.push(v(o,e.dataIndex));break;default:n.push(C(e.dataIndex,o))}else n.push(C(e.dataIndex,o))}),e.rows.push(n)}function F(t,o){o||(o=i.getAvailableColumns());var n={};o.forEach(function(e){n[e]=!0});var r={kept:[],labels:[],keys:["tree"]},a=null;return r.labels.push(e.export_level),r.labels.push(null),t.forEach(function(t){var o=t.customisation?t.customisation:t.xnav_options,i=!(!o||!o.exportable)&&o.exportable.value,s=void 0!==i&&!i;"tree"===t.dataIndex?a=t.text:!n[t.dataIndex]||s||b.options.columns_to_remove[t.dataIndex]||t.customisation.exportable&&!0!==t.customisation.exportable.value||(r.labels.push(function(t){var o=t.text;if(""===o||null==o){var n="treelistview_customization_"+t.dataIndex;o=UWA.is(e[n])?e[n]:t.dataIndex}return o}(t)),r.keys.push(t.dataIndex),r.kept.push(t))}),r.labels[1]=a||"unknown",r}function y(){this._str=""}function D(e){var t=e||{};this._debug=!0===t.debug,this._builder=new y}y.prototype={CRLF:"\r\n",append:function(e){this._str+=e+""},toString:function(){return this._str}},D.prototype={render:function(e){var t=this;return m(e.tables,e.columns,function(e,o){t._builder.append(l),t._builder.append("<thead><tr>"),m(e,null,function(e,o){t._builder.append(c),t._builder.append(o),t._builder.append(u)}),t._builder.append("</tr></thead>"),t._builder.append("<tbody>"),m(o.rows,null,function(e,o){t._builder.append(p),m(o,null,function(e,o){t._builder.append(f),t._builder.append(o),t._builder.append(h)}),t._builder.append(g)}),t._builder.append("</tbody>"),t._builder.append(d)}),this._builder.toString()}};var b={customizedColumnRenderers:{"ds6w:created":function(e){return v(e,"ds6w:created")},"ds6w:modified":function(e){return v(e,"ds6w:modified")},"ds6w:reserved":function(e){var o=e.options.grid["ds6w:reserved"];return o&&"true"===o.toLowerCase()?t.tooltip_reserved:t.tooltip_unreserved}},options:{columns_to_remove:{tree:!0},csv_base_file_name:e.csv_base_file_name}},E={printHtml:function(e){var t,o,n,i,a=(t=e.context,o=e.columns,n={columns:null,tables:[]},i=F(t.getPADTreeListView().getManager().layout.columns,o),n.columns=i.labels,t.options.model.getRoots().forEach(function(e){var t=null;e.isVisible()&&(t={rows:[]},n.tables.push(t),S(t,i.kept,e),e.processDescendants({processNode:function(){this.isVisible()&&S(t,i.kept,this)}}))}),n),s=(new D).render(a);r.printhtml(s)},generateCsv:function(e){e.csv_base_file_name&&(b.options.csv_base_file_name=e.csv_base_file_name);var t=e.context.getPADTreeListView().getManager(),o={addLevelInformation:!0,forceQuotes:!0},n=e.context.getPADTreeListView().getManager().layout.columns,i=e.columns;e.columns||(i=F(n).keys);o.columnKeys=i;var a=t.getAsCSV(o);r.downloadfile(a,b.options.csv_base_file_name+(new Date).toString().split(" ").splice(1,4).join(" ")+".csv","text/csv")}};return a.isReplayedODT()&&(E.getExportableColumns=F),o.singleton(E)}),define("DS/FolderEditor/commands/ActionBar_AddExistingContentCmd",["UWA/Core","DS/ApplicationFrame/Command","DS/IPClassifyUtil/IPClassifyCommunication","DS/IPClassifyUXUtil/ProgressPaneExecution"],function(e,t,o,n){"use strict";return t.extend({labelTopBar:e.i18n("Add Content"),isInsert:!0,datas:{},_modalChooser:null,init:function(e){this._parent(e,{mode:"exclusive",isAsynchronous:!1}),require(["DS/FolderEditor/Folder_CSO","DS/PADUtils/views/PADModalChooser","DS/IPClassifyUtil/IPClassifyAlert","i18n!DS/FolderEditor/assets/nls/FolderEditor","DS/FolderEditor/utils/FolderEditorcontrol","DS/FolderEditor/commands/FolderCommands","DS/FolderEditor/service/FolderServices","DS/PADUtils/PADUtilsServices","DS/UIKIT/Mask"],function(e,t,o,n,i,r,a){});var t=this;widget.addEvent("onRefresh",function(){UWA.is(t._modalChooser)&&(t._modalChooser.close(),t._modalChooser=null)})},beginExecute:function(){this._buildCellSkeleton()},execute:function(){var e=require("DS/FolderEditor/Folder_CSO"),t=require("DS/PADUtils/views/PADModalChooser"),n=require("DS/IPClassifyUtil/IPClassifyAlert"),i=require("i18n!DS/FolderEditor/assets/nls/FolderEditor"),r=require("DS/FolderEditor/utils/FolderEditorcontrol"),a="";if(e.getCurrentFolder()&&(a=e.getCurrentFolder().getID()),a.length){var s=!0===widget.getValue("noCompass");if(s)s&&o.publish("SelectFromSearch",{});else{UWA.is(this._modalChooser)&&this._modalChooser.close();var l=r.getIdCardCont();Math.max(l.getContent().clientWidth/2-135,0);this._modalChooser=new t({renderTo:document.body,in_apps_search:{source:["3dspace"],precond:'NOT(type:Workspace) AND NOT(type:"Workspace Vault")',in_apps_callback:this._objects_selected.bind(this)}})}}else n.displayNotification({message:i.msg_warning_nocurrentfolder,className:"warning"})},_objects_selected:function(e){var t=require("DS/FolderEditor/Folder_CSO"),o=require("DS/IPClassifyUtil/IPClassifyAlert"),n=require("i18n!DS/FolderEditor/assets/nls/FolderEditor"),i=(require("DS/FolderEditor/utils/FolderEditorcontrol"),require("DS/FolderEditor/commands/FolderCommands"),require("DS/FolderEditor/service/FolderServices"),require("DS/UIKIT/Mask"),require("DS/PADUtils/PADUtilsServices")),r=[],a=(t.getCurrentFolder(),i.getPlatformId()),s=!1;e.forEach(function(e){var t=e.resourceid,o=e.sourceid,n=null;if(o){var i=o.split(":");i.length>0&&(n=i[1])}n&&n!==a?s=!0:r.push(t)}),!0===s&&o.displayNotification({message:n.msg_warning_addnotsupported_from_different_tenant,className:"warning"}),this.preProcessInsertOperation(r)},preProcessInsertOperation:function(e){if(e.length>0){for(var t=require("i18n!DS/FolderEditor/assets/nls/FolderEditor"),o=require("DS/FolderEditor/Folder_CSO"),i=require("DS/FolderEditor/utils/FolderEditorcontrol"),r=e.length,a=[];e.length>0;){let t=e.splice(0,100);a.push(t)}n.execute({title:t.replace(t.progressPanel_add,{objectsAdded:r,targetfolder:o.getCurrentFolder().options.label}),datas:a,query:e=>this._processInsertOperation(e)}).then(()=>{i.getContent().RefreshProductStructure=!0,i.getContent().loadContentAndSelect(o.getCurrentFolder())})}},_processInsertOperation:function(t){return new Promise(o=>{if(t.length>0){var n=require("DS/FolderEditor/Folder_CSO"),i=require("DS/IPClassifyUtil/IPClassifyAlert"),r=require("i18n!DS/FolderEditor/assets/nls/FolderEditor"),a=require("DS/FolderEditor/utils/FolderEditorcontrol"),s=require("DS/FolderEditor/service/FolderServices"),l=require("DS/UIKIT/Mask"),d=(require("DS/PADUtils/PADUtilsServices"),n.getCurrentFolder());e.is(a.getContent()._contentDiv)&&l.mask(a.getContent()._contentDiv),s.AddContent({IDs:t,callbacks:{onComplete:function(n){o(),e.is(a.getContent())&&(1===t.length?a.getContent().loadContentAndSelect(d,t[0]):a.getContent().loadContentAndSelect(d),e.is(a.getContent()._contentDiv)&&l.unmask(a.getContent()._contentDiv));var s,c,u="";if(n){var p=JSON.parse(n);s=p.objectsAlreadyPresent,c=p.objectsAdded,u=p.information?" ("+p.information+")":u}0!==s?i.displayNotification({message:r.replace(r.msg_info_Addinfolder,{objectsAlreadyPresent:s,objectsAdded:c,targetfolder:d.getLabel()})+u,className:"success"}):i.displayNotification({message:r.replace(r.msg_info_Addinfolder_1,{objectsAdded:c,targetfolder:d.getLabel()})+u,className:"success"})},onFailure:function(t){if(o(),e.is(a.getContent()._contentDiv)&&l.unmask(a.getContent()._contentDiv),t&&t.advice)i.displayNotification({title:r.msg_error_Addinfolder,subtitle:t.advice,message:t.error,className:"error"});else if(t&&t.message&&t.message.contains("NetworkError")&&t.message.contains("500"))i.displayNotification({message:r.msg_error_objectNoLongerAccessible,className:"error"});else{let e={className:"error"};e.message=r.msg_error_Addinfolder,t&&(e.message=t,e.title=r.msg_error_Addinfolder),i.displayNotification(e)}}}})}}).catch(()=>{})},_buildCellSkeleton:function(){var t=require("DS/FolderEditor/utils/FolderEditorcontrol");e.is(t.getContent().elements.container)||(t.getContent().elements.container=e.createElement("span",{class:"fonticon fonticon-1x fonticon-search",title:"Find in Context"}))},endExecute:function(){}})}),define("DS/FolderEditor/service/FolderTypeService",["UWA/Controls/Abstract"],function(e){return e.singleton({TYPE_ROOT_FOLDER_1:"Workspace",TYPE_ROOT_FOLDER_2:"RootFolder",TYPE_FOLDER_1:"Workspace Vault",TYPE_FOLDER_2:"Folder",TYPE_FOLDER_3:"Workspace Folder",TYPE_PERSONAL_FOLDER_1:"Personal Workspace",TYPE_FOLDERS_SECTION:"FolderSection_AllFolders",TYPE_FAVORITES_SECTION:"FolderSection_favorite",init:function(){},isRootFolder:function(e){return e===this.TYPE_ROOT_FOLDER_1||e===this.TYPE_ROOT_FOLDER_2},isFolder:function(e){return e===this.TYPE_FOLDER_1||e===this.TYPE_FOLDER_2||e===this.TYPE_FOLDER_3},isPersonalFolder:function(e){return e===this.TYPE_PERSONAL_FOLDER_1},isBookmark:function(e){var t=e.options?e.options.type:"";return this.inFamilyFolder(t)},inFamilyFolder:function(e){return this.isRootFolder(e)||this.isFolder(e)||this.isPersonalFolder(e)},isSection:function(e){return e===this.TYPE_FOLDERS_SECTION||e===this.TYPE_FAVORITES_SECTION},isAllBookmarksSection:function(e){return e===this.TYPE_FOLDERS_SECTION}})}),define("DS/FolderEditor/views/FolderRevisionReportPanel",["UWA/Core","UWA/Class","UWA/Class/Options","DS/Controls/Tab","i18n!DS/FolderEditor/assets/nls/FolderEditor"],function(e,t,o,n,i){"use strict";var r=t.extend(o,{name:"GenericReportPanel",_logger:null,_panel:null,options:{},init:function(e){this._parent(e);var t=this;require(["DS/Logger/Logger"],function(o){t._logger=o.getLogger(r),t.setOptions(e),t._createPanel(e)})},_fillTab:function(t,o){for(var n="<ul>",i=0,r=t.entries.length;i<r;i++)n+="<li>"+t.entries[i]+"</li>";n+="</ul>";var a=new e.Element("div",{html:n,class:"tab-content"}),s=new e.Element("div");return s.style.padding="2px",s.appendChild(a),{label:t.label+" ("+t.entries.length+")",isSelected:0===o,content:s,index:o,icon:t.icon}},_createTab:function(e,t){var o,n=0;e.information.length>0&&(o=this._fillTab({label:i.information,entries:e.information,icon:{iconName:"info",fontIconFamily:WUXManagedFontIcons.Font3DS}},n),e.tab.add(o),n++),e.success.length>0&&(o=this._fillTab({label:i.success,entries:e.success,icon:{iconName:"check",fontIconFamily:WUXManagedFontIcons.Font3DS}},n),e.tab.add(o),n++),e.warning.length>0&&(o=this._fillTab({label:i.warning,entries:e.warning,icon:{iconName:"alert",fontIconFamily:WUXManagedFontIcons.Font3DS}},n),e.tab.add(o)),e.tab.inject(t)},_createPanel:function(t){var o=this;require(["DS/Windows/Panel"],function(i){var r=new e.Element("div",{styles:{"vertical-align":"top","min-height":"286px",position:"relative"}}),a=new e.Element("div",{class:"wux-control-inline-container"});r.inject(a);var s=new e.Element("div",{class:"wux-control-container"}),l=new n({displayStyle:"strip"});l.reorderFlag=!1,l.pinFlag=!0,l.showComboBoxFlag=!1,l.editableFlag=!1,l.multiSelFlag=!0,l.centeredFlag=!1,l.touchMode=!0;var d={tab:l};void 0!==t.success&&null!==t.success&&Array.isArray(t.success)&&(d.success=t.success),void 0!==t.warning&&null!==t.warning&&Array.isArray(t.warning)&&(d.warning=t.warning),void 0!==t.information&&null!==t.information&&Array.isArray(t.information)&&(d.information=t.information),o._createTab(d,s),o._panel=new i({title:t.title,content:s,position:{my:"center",at:"center"},width:600,allowedDockAreas:0,immersiveFrame:widget.immersiveFrame,resizableFlag:!0,collapsibleFlag:!1,minWidth:600,minHeight:85}),(d.success.length>15||d.warning.length>15)&&(o._panel.height=400),o._panel.elements.container.classList.add("BookmarkReportPanel")})}});return r}),define("DS/FolderEditor/commands/ActionBar_RelationIPExplorer",["DS/ApplicationFrame/Command"],function(e){"use strict";return e.extend({labelTopBar:UWA.i18n("Where used"),isInsert:!0,datas:{},init:function(e){e.isEnabled=!1,this._parent(e,{mode:"exclusive",isAsynchronous:!1}),require(["DS/IPClassifyUtil/IPClassifyAlert","i18n!DS/FolderEditor/assets/nls/FolderEditor"],function(e,t){})},beginExecute:function(){},execute:function(){require(["DS/PADUtils/PADUtilsServices"],function(e){e.open_app({appId:"ENORIPE_AP"},function(e){if("no_app"===e.response){var t=require("DS/IPClassifyUtil/IPClassifyAlert"),o=require("i18n!DS/FolderEditor/assets/nls/FolderEditor");t.displayNotification({...o.msg_error_appWhereUsedNotFound,className:"error"})}})})},endExecute:function(){}})}),define("DS/FolderEditor/popup/AddCommentPopup",["UWA/Controls/Abstract","DS/UIKIT/Input/Button","DS/UIKIT/Form","DS/UIKIT/Input/File","DS/ENOFloatingPanel/ENOFloatingPanel","i18n!DS/FolderEditor/assets/nls/AddCommentPopup"],function(e,t,o,n,i,r){return e.extend({file:null,comment:"",modal:null,onResize:function(){null!=this.ARWidget&&this.ARWidget.onResize()},init:function(e,a,s,l,d){var c=this,u=r.PanelTitle+"- ";this.modal=new i({className:"site-reset",title:u.concat(s),footer:UWA.createElement("div",{class:"AddCommentPopup_footer"}),animate:!1,overlay:!0,resizable:!0,closable:!0}).inject(e);var p=new t({value:r.OK,className:"primary checkinButton",disabled:!0});p.addEvent("onClick",function(){l(c.file,c.comment),c.modal.destroy()}),p.inject(this.modal.elements.footer);var g=new t({value:r.Cancel});g.addEvent("onClick",function(){c.modal.destroy()}),g.inject(this.modal.elements.footer);var f=new n({buttonPosition:"right",placeholder:r.SelectFile_PlaceHolder,buttonText:r.SelectFile_Button}),h=function(){null!==c.file?p.enable():p.disable()};f.elements.container.addEvent("change",function(e){var t=e.srcElement?e.srcElement.files:e.target.files;if(0==t.length&&(t=e.detail.files),t.length>1)throw"Cannot select more than one file";1==t.length?c.file=t[0]:c.file=null,h()});var m=new o({fields:[{type:"text",label:r.Comment_Title,pattern:"[a-zA-Z]+",placeholder:r.Comment_PlaceHolder,multiline:!0,rows:4,required:!1}]}),v=function(e){var t=e.srcElement.value;t.length>0?c.comment=t:c.comment=null,h()};m.elements.container.addEvent("change",v),m.elements.container[0].addEvent("keyup",v),f.inject(this.modal.elements.body),m.inject(this.modal.elements.body),this.modal.show()},show:function(){},close:function(){this.container.hide(),!0===this.options.removeAtClose&&this.container.destroy(),this.dispatchEvent("onClose")}})}),define("DS/FolderEditor/views/ViewLoader",["UWA/Class","UWA/Promise"],function(e,t){"use strict";var o={graphview:"graphview",tileview:"tileview",thumbnailview:"thumbnailview",datagridview:"datagridview"};Object.freeze(o);var n=["onDragOverGraph","onDropBlankGraph","onDragLeaveGraph"],i=["onDragEnterBlank","onDragOverBlank","onDragEndBlank","onDragLeaveBlank","onDropBlank","onDragStartCell","onDragEnterCell","onDragOverCell","onDragEndCell","onDragLeaveCell","onDropCell","onDragEnterColumnHeader","onDragOverColumnHeader","onDragEndColumnHeader","onDragLeaveColumnHeader","onDropColumnHeader","onDragStartColumnHeader"],r=["onDragEnterBlank","onDragOverBlank","onDragEndBlank","onDragLeaveBlank","onDropBlank","onDragStartCell","onDragEnterCell","onDragOverCell","onDragEndCell","onDragLeaveCell","onDropCell","onDragEnterColumnHeader","onDragOverColumnHeader","onDragEndColumnHeader","onDragLeaveColumnHeader","onDropColumnHeader","onDragStartColumnHeader"],a=["onDragEnterBlank","onDragOverBlank","onDragEndBlank","onDragLeaveBlank","onDropBlank","onDragStartCell","onDragEnterCell","onDragOverCell","onDragEndCell","onDragLeaveCell","onDropCell","onDragEnterColumnHeader","onDragOverColumnHeader","onDragEndColumnHeader","onDragLeaveColumnHeader","onDropColumnHeader","onDragStartColumnHeader"];return e.extend({init:function(e){this.options=e},loadView:function(e,t){var o=this;this.options.component.options.views[e]?t():this.buildOptions(e,t).then(function(n){o.requireView(e,n,t)})},requireView:function(e,t,n){var i=this,r=this.options.amd[e],a=function(){i.postLoad(e),n&&n()};require([r],function(n){var r=i.options.component;r.options.views[e]=new n(t),e===o.datagridview?r.options.views[e].initialize().then(function(){a()}):a()})},postLoad:function(e){var t=this.options.component;switch(t.options.views[e].isActiveView=t.options.active_view===e,e){case o.graphview:var n=!1;t.options.views.graphview.isActiveView&&(n=!0,t.options.views.graphview.setModel(t.options.model)),t.setDnD_onGraph(),t.options.isReady.graphview=!0,n&&t.options.views.graphview.reframeAll();break;case o.thumbnailview:t.options.views.thumbnailview.isActiveView&&t.options.views.thumbnailview.setModel(t.options.model),t.options.isReady.thumbnailview=!0;break;case o.datagridview:t.options.views.datagridview.isActiveView&&t.options.views.datagridview.setModel(t.options.model),t.options.isReady.datagridview=!0;break;case o.tileview:t.options.views.tileview.isActiveView&&t.options.views.tileview.setModel(t.options.model),t.options.isReady.tileview=!0}t.options.model.applyActiveView(e)},buildOptions:function(e,t){switch(e){case o.graphview:return this._buildGraphViewOptions();case o.tileview:return this._buildTileViewOptions();case o.thumbnailview:return this._buildThumbnailViewOptions();case o.datagridview:return this._builddatagridViewOptions();default:throw new Error("Invalid View Trying to load")}},mapCallbacks:function(e,t){var o=t,n={};return e.forEach(function(e){UWA.is(o.options.views_cb[e],"function")?n[e]=o.options.views_cb[e]:UWA.is(o[e],"function")&&(n[e]=o[e].bind(o))}),n},_buildGraphViewOptions:function(){var e=this;return new t(function(t,o){var i=e.options.component,r={x3dAppId:e.options.x3dAppId,renderTo:e.options.renderTo,multiselection:e.options.multiselection,context:i};r.active_view=UWA.clone(i.options.active_view),r.isActiveView="graphview"===r.active_view;var a=e.mapCallbacks(n,i);r=UWA.extend(r,a,!0),UWA.is(i.getOnContextualEvent)&&(r.onContextualEvent=i.getOnContextualEvent()),t(r)})},_buildTileViewOptions:function(){var e=this;return new t(function(t,o){var n=e.options.component,r={x3dAppId:e.options.x3dAppId,renderTo:e.options.renderTo,multiselection:e.options.multiselection,context:n};r.active_view=UWA.clone(n.options.active_view),r.isActiveView="tileview"===r.active_view;var a=e.mapCallbacks(i,n);r=UWA.extend(r,a,!0),UWA.is(n.getOnContextualEvent)&&(r.onContextualEvent=n.getOnContextualEvent()),t(r)})},_buildThumbnailViewOptions:function(){var e=this;return new t(function(t,o){var n=e.options.component,i={x3dAppId:e.options.x3dAppId,renderTo:e.options.renderTo,multiselection:e.options.multiselection,context:n};i.active_view=UWA.clone(n.options.active_view),i.isActiveView="thumbnailview"===i.active_view;var a=e.mapCallbacks(r,n);i=UWA.extend(i,a,!0),UWA.is(n.getOnContextualEvent)&&(i.onContextualEvent=n.getOnContextualEvent()),t(i)})},_builddatagridViewOptions:function(){var e=this;return new t(function(t,o){var n=e.options.component,i={x3dAppId:e.options.x3dAppId,renderTo:e.options.renderTo,multiselection:e.options.multiselection,context:n};i.active_view=UWA.clone(n.options.active_view),i.isActiveView="datagridview"===i.active_view,i.view_customization=n.options.layout.view_customization,i.callbacks=e.mapCallbacks(a,n),n.options.additionalColumnsModules&&(i.additionalColumnsModules=n.options.additionalColumnsModules),t(i)})}})}),define("DS/FolderEditor/utils/FolderEditorDataConversion",[],function(){return{getObjectIdsFromSearchRes:function(e){var t=[];return e&&e.forEach(function(e){if(!e||!e.attributes||e.attributes.length<=0);else for(var o=0;o<e.attributes.length;++o)"physicalid"==e.attributes[o].name&&t.push(e.attributes[o].value)}),t},getParChildrenMapFromNavRes:function(e){var t={};return!e||!e.result||e.result.length<=0?t:(e.result.forEach(function(e){if(e&&e.input_object){var o=e.input_object.physicalid,n=o;e.outputs&&e.outputs.WORKSPACE&&e.outputs.WORKSPACE.length>0&&(n=e.outputs.WORKSPACE[0].physicalid),t[n]?t[n].push(o):t[n]=[o]}}),t)}}}),define("DS/FolderEditor/utils/FolderEditorcontrol",["DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/FolderEditorOpenness/FolderEditorOpenness","DS/PADUtils/PADUtilsServices","DS/PADUtils/PADSettingsMgt","UWA/Controls/Abstract","DS/IPClassifyUXUtil/PlatformCredSelector","DS/FolderEditor/utils/FolderLoaderGlobal","i18n!DS/FolderEditor/assets/nls/FolderEditor"],function(e,t,o,n,i,r,a,s){return i.singleton({_Content:null,_TreeCont:null,_IdCardCont:null,_isDebugMode:!1,_actionBar:null,_findInCtx:null,_onWidgetRefresh:null,init:function(){this.checkRolesAvailability()},getContent:function(){return this._Content},getTreeCont:function(){return this._TreeCont},getIdCardCont:function(){return this._IdCardCont},getTrashCont:function(){return this._TrashCont},getActionBar:function(){return this._actionBar},getFindInCtx:function(){return this._findInCtx},getWidgetRefresh:function(){return this._onWidgetRefresh},setContent:function(e){this._Content=e},setTreeCont:function(e){this._TreeCont=e},setIdCardCont:function(e){this._IdCardCont=e},setTrashCont:function(e){this._TrashCont=e},setActionBar:function(e){this._actionBar=e},setFindInCtx:function(e){this._findInCtx=e},setWidgetRefresh:function(e){this._onWidgetRefresh=e},getActiveFolder:function(){return{origin:widget.id,id:void 0!==this._activeFolderId?this._activeFolderId:null,label:this._activeFolderLabel,sc:this._activeFolderSc,disabledId:this._activeFolderDisabledId}},setActiveFolder:function(e,t,o,n){this._activeFolderId=e,this._activeFolderLabel=t,this._activeFolderSc=o,this._activeFolderDisabledId=n},isDebugMode:function(){return this._isDebugMode},setDebugMode:function(e){this._isDebugMode=e},isCustomizedEnv:function(){return void 0===this._isCustomizedEnv&&(this._isCustomizedEnv=t.useComputedSecurityContext(),this._isCustomizedEnv=!1),this._isCustomizedEnv},isActiveBookmarkActivated:function(){return void 0===this._isActiveBookmarkActivated&&(this._isActiveBookmarkActivated=t.isActiveBookmarkActivated()),this._isActiveBookmarkActivated},isImportCSVActivated:function(){return void 0===this._isImportCSVActivated&&(this._isImportCSVActivated=t.isImportCSVActivated()),this._isImportCSVActivated},checkRolesAvailability:function(t){var o=this;void 0===o._isPAUroleAvailable||void 0===o._isPARroleAvailable||void 0===o._isCSVroleAvailable?e.getGrantedRoles(function(e){o._isPAUroleAvailable=!1,o._isPARroleAvailable=!1,o._isCSVroleAvailable=!1;for(var n=0;n<e.length;n++){var i=e[n]?e[n].id:"";"CSV"===i?o._isCSVroleAvailable=!0:"PAU"===i||"CDR"===i||"EXL"===i||"InternalDS"===i?(o._isPAUroleAvailable=!0,o._isCSVroleAvailable=!0):"PAR"===i&&(o._isPARroleAvailable=!0,o._isCSVroleAvailable=!0)}t&&t(o._isPAUroleAvailable,o._isPARroleAvailable,o._isCSVroleAvailable)}):t&&t(o._isPAUroleAvailable,o._isPARroleAvailable,o._isCSVroleAvailable)},checkSecurityCTXandTenantInitialization:function(e,t){var i=this;require(["DS/IPClassifyUXUtil/CredentialsView"],function(a){if("function"==typeof e){function s(){i._isSecurityCTXInitialized&&(!0===t||i._isTenantInitialized)&&e.call()}if(void 0===i._isSecurityCTXInitialized){var l=a.getCredential();i._isSecurityCTXInitialized=!!l||void 0,i._isSecurityCTXInitialized||n.addEventOnce("onPad_security_ctx",function(e){i._isSecurityCTXInitialized=!!e,s()})}if(!0!==t&&void 0===i._isTenantInitialized){var d=o.getPlatformId();let e=!1,t=o.getTenantsPreference();if(e=!t||0==t.length||t.filter(e=>e.value===d).length<=0,e="OnPremise"!==d&&e){i.onTenantSecurityCTXPopup();let t={};t.onRefresh=i.getWidgetRefresh(),r.render(e,t)}i._isTenantInitialized=!!d,i._isTenantInitialized||n.addEventOnce("onPad_tenant",function(e){i._isTenantInitialized=!!e||void 0,s()})}s()}})},onTenantSecurityCTXPopup:function(){a.removeComponentToLoad("global","widget")},getPlaceholder:function(){return new Promise(function(e){require(["DS/FolderEditor/views/FolderPlaceHolder"],function(t){e(new t)})})},getMapforPreferenceRefresh:function(){return new Map([["allow-products-expand",1],["filtered-content",1],["show-sub-folders",1],["activateBIFilter",1],["useIndexAccleration",1],["activateTXO",1],["activateDGV",1],["drag-and-drop",0]])}})}),define("DS/FolderEditor/commands/tools/ColumnCustomization",["UWA/Core","DS/FolderEditor/utils/FolderEditorcontrol","DS/IPClassifyUtil/IPClassifyAlert","i18n!DS/FolderEditor/assets/nls/FolderEditor","text!DS/FolderEditor/assets/FolderEditorColumns.json"],function(e,t,o,n,i){"use strict";var r=JSON.parse(i).allowedIndexAttributes,a=null;return{execute:function(){require(["DS/IPClassifyColumnCusto/IPClassifyColumnCusto","DS/PADServices/utils/GlobalModelEvents","DS/PADServices/utils/AttributesMgtV2","DS/FolderEditor/utils/FolderEditorcontrol","DS/PADServices/utils/DictionaryMgt","DS/FolderEditor/utils/FolderEditorUtil"],function(i,s,l,d,c,u){for(var p=s.getModelEvents(),g=[],f=d.getContent().getPADTreeListView(),h=f.options.dgvLayout.getOrderedColumnsIndexes(),m=0;m<h.length;m++){var v=f.options.dgv.getColumnOrGroup(h[m]);"defaultSort"!==v.dataIndex&&(v.attrDBName||v.customisation&&v.customisation.layout&&(v.customisation.layout.removable=!1),g.push(v))}var _=f?f.options.viewMode:parameters.tree.options.viewMode,C=!!f,S=f?f.options.dgvLayout.rowsHeader:void 0;f&&(f.columnOrdering=!0),a=new i({modelEvents:p,viewMode:_,appColumns:g,manageAttrFromInstance:!1,baseInstanceTypes:[],selectedTypes:l.getSelectedTypes(),selectedExtensions:l.getSelectedExtensions(),withDgv:C,dgvInfo:f,rowHeaderActivated:S,dbOnlyAttributes:!0,classificationAttributes:!0,allowedIndexAttributes:r,defaultAttributes:r,supportedIndexAttrs:["ds6w:docExtension"]});var F=[];F.push(p.subscribe({event:"ENOBook/AttributesCustomization/columnSwitchDone"},function(){a.options.dgvInfo.columnOrdering=!0})),F.push(p.subscribe({event:"IPClassifyColumnCusto/AttributesCustomization/columnModification"},function(i){switch(i.what){case"addRemoveColumns":if(i.removedColumns&&f&&f.removeColumnCB(i.removedColumns),i.addedColumns){var r=e.clone(u.filterDBOnlyAttrs(i.addedColumns)),a=r.filter(function(e){return f.options.dgv.getColumnOrGroup(e.dataIndex)});f&&a.length>0&&f.changeDBAttributeCB(a),r=r.filter(function(e){return!f.options.dgv.getColumnOrGroup(e.dataIndex)}),f&&r.length>0&&f.addColumnCB(r)}break;case"visibilityColumn":f&&f.changeVisibilityCB(i.modifiedColumn,i.visibilityFlag);break;case"moveColumn":f&&f.moveColumnCB(i);break;case"changeTitle":if(f){for(var s=[],d=0;d<i.newTitle.length;d++)i.newTitle.charCodeAt(d)>255&&s.indexOf(i.newTitle[d])<0&&s.push(i.newTitle[d]);0===s.length?f.changeTitleCB(i.modifiedColumn,i.newTitle):o.displayNotification({message:n.replace(n.msg_error_forbiddenChar.message,{badChars:s.join(", ")}),className:"error"})}break;case"pinChange":f.changePinCB(i.modifiedColumn,i.pin);break;case"rowsHeaderModification":f.changeDgvLayout({rowsHeader:i.rowsHeader});break;case"exportColumn":f.changeExportCB(i.modifiedColumn,i.exportFlag);break;case"changeViewMode":f&&f.compactMode(i);var c=t.getTreeCont();c&&c.modeChange(i);break;case"close":i.selectedExtensions&&i.selectedTypes&&l.updateSelectedParams({selectedExtensions:i.selectedExtensions,selectedTypes:i.selectedTypes}),f&&f.saveCustoView(i.applyOnlyToThisApp),F.forEach(function(e){p.unsubscribe(e)});break;case"reset":l.resetSelectedParams(),f.reset(i.parameters),F.forEach(function(e){p.unsubscribe(e)});break;default:console.warn("Unknown column modification kind:"+i.what)}}))})},endExecute:function(){},_getColumnCusto:function(){return a}}}),define("DS/FolderEditor/dataProvider/ManipulationUnitColumnsDataProvider",["UWA/Class","DS/FolderEditor/utils/FolderEditorcontrol"],function(e,t){"use strict";return e.singleton({getManipulationUnitColumns:function(){let e=[],o=t.getContent();if(!o)return e;let n=o.getPADTreeListView();return n?n.getManipulationUnitColumns():e},getColumnUnitNls:function(e){let o=t.getContent();if(!o)return null;let n=o.getPADTreeListView();return n?n.getColumnUnitNls(e):null},getManipulationUnitVisibleValues:function(e,o){let n=[],i=t.getContent();if(!i)return n;let r=i.getPADTreeListView();return r?r.getManipulationUnitVisibleValues(e,o):n}})}),define("DS/FolderEditor/utils/FolderSearch",["UWA/Class","DS/FolderEditor/utils/FolderEditorcontrol","DS/PADServices/utils/GlobalModelEvents","i18n!DS/FolderEditor/assets/nls/FolderEditor","DS/IPClassifyUtil/IPClassifyUtility"],function(e,t,o,n,i){"use strict";var r={tree:"ds6w:label"};return e.singleton({init:function(e){this._parent(e),this._currentSearch=null,this._searchInfo=null,this._indexInfo=null,this._lListener=[],this._lListenerResult=[],this._originFolder=null,this._previousViewCommand=null,this._defaultPredicates=["ds6w:label","physicalid","mxid","ds6w:type","ds6w:identifier","ds6w:classification","icon_2ddefaultthb.subtype","ds6w:reservedBy","relcount","taxonomies","ds6w:kind","ds6w:contentStructure","ds6w:cadMaster","owner"],this._attrPredicateMap=new Map,this._predAttrMapDefault=[["ds6w:label",null],["physicalid",null],["mxid",null],["ds6w:type",null],["ds6w:identifier",null],["ds6w:classification",null],["icon_2ddefaultthb.subtype",null],["ds6w:reservedBy",null],["relcount",null],["taxonomies",null],["owner",null]],this._predAttrMap=new Map(this._predAttrMapDefault);this._searchInfo={with_indexing_date:!0,select_predicate:UWA.clone(this._defaultPredicates),select_file:["icon","thumbnail_2d"],order_field:"ds6w:modified",order_by:"desc",nresults:25},this._facets=null,o.getModelEvents().subscribe({event:"search_cleared"},this.clearSearch.bind(this))},setNumberResults:function(e){this._searchInfo.nresults=e},setPreviousView:function(e){this._previousViewCommand=e},getPreviousView:function(){return this._previousViewCommand},setPredicates:function(e){var t=this;t._attrPredicateMap.clear(),this._predAttrMap=new Map(this._predAttrMapDefault),Array.isArray(e)&&e.forEach(function(e){var o=e.ds6w;o||(o=e.dataIndex);var n=null;if(e.attrDBName)for(var i in n=e.attrDBName)t._attrPredicateMap.set(n[i],o);t._predAttrMap.set(o,n)}),this._searchInfo.select_predicate=Array.from(t._predAttrMap.keys())},addPredicates:function(e){var t=this;Array.isArray(e)&&e.forEach(function(e){var o=null;if(e.attrDBName)for(var n in o=e.attrDBName)t._attrPredicateMap.set(o[n],e.dataIndex);t._predAttrMap.set(e.dataIndex,o)}),this._searchInfo.select_predicate=Array.from(t._predAttrMap.keys())},removePredicates:function(e){for(var t=0;t<e.length;++t)if(this._predAttrMap.delete(e[t].dataIndex),e[t].attrDBName){var o=e[t].attrDBName;for(var n in o)this._attrPredicateMap.delete(o[n])}this._searchInfo.select_predicate=Array.from(this._predAttrMap.keys())},getAuthAttributes:function(){var e=Array.from(this._predAttrMap.values());return e=e.filter(function(e){return null!=e}),[].concat.apply([],e)},getIndexPredicates:function(){return Array.from(this._searchInfo.select_predicate)},getAttrPredicateMap:function(){return this._attrPredicateMap},onSearchChange:function(e){"function"==typeof e&&this._lListener.push(e)},onSearchResult:function(e){"function"==typeof e&&this._lListenerResult.push(e)},_notifyChange:function(e){if(this.isSearchActive()||e){var t=this;e||(e=t._currentSearch),this._lListener.forEach(function(e){e.call(null,t._currentSearch)})}},changeSortField:function(e,t){var o=this._getDS6WFromColumnIndex(e),i=this._getColumnPredicate(o);if(!i||!i.startsWith("ds6w"))return{message:n.get("msg_info_SortNonAvailable"),className:"primary"};this._searchInfo.order_field!==i&&(this._searchInfo.order_field=i,this.setInfoIndex(null,!1)),t&&this._notifyChange()},changeOrderSort:function(e,t){null!=e&&this._searchInfo.order_by!=e&&(this._searchInfo.order_by=e,this.setInfoIndex(null,!1)),t&&this._notifyChange()},changeSearch:function(e){if(""===e&&(e=null),this._currentSearch!==e||!e){this.setInfoIndex(null,!e);var t=this._currentSearch;this._currentSearch=e,this._notifyChange(t),e&&i.sendTrackerPageEvent("FolderWidget_iconBar","Search")}},columnIsAvailable:function(e){return null!=this._getColumnPredicate(e)},_getColumnPredicate:function(e){var t=this._getDS6WFromColumnIndex(e),o=this.getSearchInfo().select_predicate.indexOf(t)>=0?t:null;return o=!o&&this.getSearchInfo().select_predicate.indexOf(t)>=0?t.toLowerCase():o},_getDS6WFromColumnIndex:function(e){var t=r[e];return t||(t=e),t},getSearchInfo:function(){return this._searchInfo},setInfoIndex:function(e,t){var n=this;if(this._indexInfo=e,!1!==t){if(this._lListenerResult.forEach(function(t){t.call(n,e)}),e){var i=require("DS/FolderEditor/Folder_CSO").getCurrentFolder().getLabel();e.objectName=i;var r=this.getDateLastIndexation();e.lastIndexation=r}o.getModelEvents().publish({event:"searchUpdated",data:e})}},resetInfoIndex:function(){this._indexInfo=null},getOrderFieldForTree:function(){var e=this.getOrderField();for(var t in r)r[t]===e&&(e=t);return e},getOrderField:function(){return this.getSearchInfo()?this.getSearchInfo().order_field:null},getOrderBy:function(){return this.getSearchInfo()?this.getSearchInfo().order_by:null},getInfoIndex:function(){return this._indexInfo},getNumberLastResult:function(){return this._indexInfo?this._indexInfo.nresults:0},getNumberHits:function(){return this._indexInfo?this._indexInfo.nhits:0},getDateLastIndexation:function(){var e=null,t=this.getInfoIndex();if(t&&t.sources){var o=null;t.sources.forEach(function(e){if(e.indexingDate)var t=e.indexingDate;for(var n in t)t[n]&&-1!==t[n]&&(o?t[n]<o&&(o=t[n]):o=t[n])}),o&&(e=new Date(1e3*o))}return e},isSearchActive:function(){return!!this.getSearchValue()},isSearchInProgress:function(){return!!this._indexInfo&&!!this._currentSearch},getSearchValue:function(){return this._currentSearch},getOriginFolder:function(){return this._originFolder},setOriginFolder:function(e){this._originFolder=e},clearSearch:function(){this.changeSearch("",!0)},getResultsCount:function(){let e=t.getContent();if(e){let t=e.getGridViewRowHeight(),o=e.getContentHeight();if(t&&o)return Math.ceil(o/t)+10}return 0}})}),define("DS/FolderEditor/utils/FolderEditorEvents",["UWA/Class","DS/PADServices/utils/GlobalModelEvents","DS/FolderEditor/utils/FolderCommunication","DS/FolderEditor/service/FolderTypeService"],function(e,t,o,n){return e.singleton({EVT_CURRENT_FOLDER_CHANGE:"/FOLDER_EDITOR/CURRENTFOLDER_CHANGE",EVT_NODEMODEL_MODIFY:"/FOLDER_EDITOR/NODEMODEL_MODIFY",EVT_TREEFILTER_CHANGE:"/FOLDER_EDITOR/EVT_TREEFILTER_CHANGE",EVT_TAGGER_STATUS_CHANGE:"/FOLDER_EDITOR/EVT_TAGGER_STATUS_CHANGE",EVT_CURRENT_FOLDER_COLUMN_CHANGE:"/LIBRARY_EDITOR/CURRENT_LIBRARY_COLUMN_CHANGE",EVT_FOLDER_EDIOTR_READY:"onFolderEditorReady",_modelEvents:null,init:function(e){this._parent(e),this._modelEvents=t.getModelEvents()},createBookmarkForPublication:function(e,t){var o=e,i={From:"FolderEditor",FolderID:null,FolderLabel:null,FolderType:null,IsInDeletedItems:!1,IsFavorite:!!o&&!0===o.isFavorite,Timestamp:Date.now()};return o&&(n.inFamilyFolder(o.plmType)||t)&&(i.FolderID=o.getID(),i.FolderLabel=o.getLabel(),i.FolderType=o.getType()),o&&"FolderSection_Trash"===o.plmType&&(i.IsInDeletedItems=!0),i},notifyFolderRename:function(e){if(!UWA.is(e,"array"))throw new Error("input parameter should be array");var t=this;e.forEach(function(e){var n=t.createBookmarkForPublication(e);o.publish("FolderEditor.FolderUpdated",JSON.stringify(n),!0),t._modelEvents.publish({event:t.EVT_NODEMODEL_MODIFY,context:e,data:e})})},notifyFolderLoadingEnd:function(e){if(!UWA.is(e))throw new Error("input parameter should be a TreeNodeModel");this._modelEvents.publish({event:this.EVT_FOLDER_LOADINGEND,context:e,data:e})},onFolderLoadingEnd:function(e){if(!UWA.is(e,"function"))throw new Error("input parameter should be function");this._modelEvents.subscribe({event:this.EVT_FOLDER_LOADINGEND},e)},onFolderRename:function(e){if(!UWA.is(e,"function"))throw new Error("input parameter should be function");this._modelEvents.subscribe({event:this.EVT_NODEMODEL_MODIFY},e)},notifyCurrentFolderChange:function(e){if(!UWA.is(e,"object"))throw new Error("input parameter should be object");if(!e.currentNode)throw new Error("input object should have currentNode");this._modelEvents.publish({event:this.EVT_CURRENT_FOLDER_CHANGE,context:e.currentNode,data:e})},onCurrentFolderChange:function(e){if(!UWA.is(e,"function"))throw new Error("input parameter should be function");this._modelEvents.subscribe({event:this.EVT_CURRENT_FOLDER_CHANGE},e)},notifyCurrentFolderColumnChange:function(){this._modelEvents.publish({event:this.EVT_CURRENT_FOLDER_COLUMN_CHANGE})},onCurrentFolderColumnChange:function(e){if(!UWA.is(e,"function"))throw new Error("input parameter should be function");this._modelEvents.subscribe({event:this.EVT_CURRENT_FOLDER_COLUMN_CHANGE},e)},notifyFolderEditorReady:function(){this._modelEvents.publish({event:this.EVT_FOLDER_EDIOTR_READY})},onFolderEditorReadyforWenInWin:function(e){if(!UWA.is(e,"function"))throw new Error("input parameter should be function");this._modelEvents.subscribe({event:this.EVT_FOLDER_EDIOTR_READY},e)},notifyTaggerStatusChange:function(){this._modelEvents.publish({event:this.EVT_TAGGER_STATUS_CHANGE})},onTaggerStatusChange:function(e){this._modelEvents.subscribe({event:this.EVT_TAGGER_STATUS_CHANGE},e)},subscribeEvents:function(){var e=this;return this._modelEvents.subscribe({event:"welcome-panel-collapse"},function(){e._modelEvents.publish({event:"triptych-hide-panel",data:"left"})}),this._modelEvents.subscribe({event:"welcome-panel-expand"},function(){e._modelEvents.publish({event:"triptych-show-panel",data:"left"})}),this._modelEvents.subscribe({event:"information-panel-close"},function(){e._modelEvents.publish({event:"triptych-hide-panel",data:"right"})}),this._modelEvents.subscribe({event:"information-panel-open"},function(){e._modelEvents.publish({event:"triptych-show-panel",data:"right"})}),this._modelEvents},subEvent:function(e,t){if(!UWA.is(t,"function"))throw new Error("input parameter should be function");this._modelEvents.subscribe({event:e},t)},leftPanelOpen:function(e){this.subEvent("triptych-show-panel",e)},leftPanelClose:function(e){this.subEvent("triptych-hide-panel",e)},rightPanelOpen:function(e){this.subEvent("triptych-show-panel",e)},rightPanelClose:function(e){this.subEvent("triptych-hide-panel",e)},unsubscribeAll:function(){this._modelEvents.unsubscribeAll()}})}),define("DS/FolderEditor/Folder_CSO",["UWA/Core","DS/Selection/XSO","DS/Logger/Logger","DS/FolderEditor/service/FolderTypeService","DS/FolderEditor/service/FolderEditorWebService","DS/FolderEditor/utils/FolderEditorEvents","DS/FolderEditor/utils/FolderEditorcontrol","DS/FolderEditor/utils/FolderEditorManageSecurityContextCustomization","DS/PADUtils/PADProbes"],function(e,t,o,n,i,r,a,s,l){"use strict";var d=function(e){var t="";if(e){var o=e.plmType;t="Folder"==o?"Workspace Vault":"RootFolder"==o?e.isPersonal?"Personal Workspace":"Workspace":o}return t},c=t.singleton({name:"folder_cso",_logger:null,_currentFolder:null,init:function(e){var t={areEquals:function(e,t){return e===t}};UWA.extend(t,e),this._parent(t),this._logger=o.getLogger(c);var n=this;this.onPostAdd(function(e){var t="CONTENT";UWA.is(e,"array")&&(e=e[0]),e&&UWA.is(e.getID,"function")&&e.getID()==n.getCurrentFolderID()&&(t="TREE"),UWA.is(e)&&n._modelEvents.publish({event:"FOLDER_CSO/SELECT",data:{context:t,selectedNode:e}})}),r.onFolderRename(function(e){if(n._currentFolderPath){var t=e.getID(),o=e.getLabel(),i=n.getCurrentFolderID();n._currentFolderPath.forEach(function(e){e.id===t&&(e.label=o)}),t===i&&a.getIdCardCont().setCurrentLocation()}})},addInFolderCSO:function(e,t){if(!UWA.is(e))throw new Error("No folderNode specified");if(!UWA.is(t))throw new Error("No context specified");var o=l.createProbe("folder_addInFolderCSO");if("TREE"==(t=t.toUpperCase())){var c=this;this.empty(!1);var u=this._currentFolder;this._currentFolder=e;var p=function(e,t){n.inFamilyFolder(t.plmType)&&t.id&&a.isCustomizedEnv()&&s.adaptSecurityContextToCurrentFolder(t.id),r.notifyCurrentFolderChange({previousNode:e,currentNode:t}),c.add(t),o.end()};this._currentFolderPath=[{id:e.id,type:d(e),label:e.getLabel(),mxid:e.options.mxid}];var g=!1;if(n.inFamilyFolder(e.plmType)){if(e.isVisible&&e.isVisible()&&e.getPath){var f=e.getPath();if(Array.isArray(f)&&f.length>=2&&f[0]&&"FolderSection_AllFolders"===f[0].plmType){this._currentFolderPath=[];for(var h=1;h<f.length;h++){var m=f[h];this._currentFolderPath.push({id:m.id,type:d(m),label:m.getLabel(),mxid:m.options.mxid})}g=!0}}}else g=!0;g?p(u,e):i.getFolderPath({pids:[e.id],onComplete:function(t){var o=(t=JSON.parse(t))[e.id],n=o?o.length:0;!o&&t.error&&(c._logger.warn("Unable to retrieve FolderPath using WebService"),p(u,c._currentFolder)),n>=1&&o[n-1]?c._currentFolder&&o[n-1].id==c._currentFolder.id?(c._currentFolderPath=[],o.forEach(function(e){c._currentFolderPath.push({id:e.id,type:e.type,label:e.label,mxid:e.mxid})}),p(u,c._currentFolder)):c._logger.log("FolderPath returned by WebService do not corresponds to the current Folder"):c._logger.warn("Empty FolderPath returned by WebService")},onFailure:function(e){c._logger.warn("Unable to retrieve FolderPath using WebService"),p(u,c._currentFolder)}})}else{this.empty(!1);var v=null;0===(v="array"==UWA.typeOf(e)?e:[e]).length?(this.add(this._currentFolder),o.end()):(this.add(v),o.end())}},removeFromFolderCSO:function(e){if(!UWA.is(e))throw new Error("No folderNode specified");this.remove(e),0===this.getSelectedNodes().length&&e!=this._currentFolder&&this.add(this._currentFolder)},removeAllFromFolderCSO:function(){this.empty(!0)},getCurrentFolder:function(){return this._currentFolder},updateLabelCurrentFolderPath:function(){if(this._currentFolderPath){var e=this._currentFolderPath.length,t=this._currentFolder.getLabel();this._currentFolderPath[e-1].label!==t&&(this._currentFolderPath[e-1].label=t)}},getCurrentFolderID:function(){var e=null;return this._currentFolder&&this._currentFolder.getID&&(e=this._currentFolder.getID()),e},getCurrentFolderPath:function(){var e=[];return this._currentFolderPath&&this._currentFolderPath.forEach(function(t){e.push({id:t.id,type:t.type,label:t.label,mxid:t.mxid})}),e},getSelectedNodes:function(){var e=[];return this.get()&&this.get().forEach(function(t){e.push(t)}),e},getCurrentSelection:function(){var e=null;a.getContent()&&(e=a.getContent().getSelectedNodes());var t=c.getCurrentFolder();return e=null!=e&&e.length>0?e:t?[t]:[]},getSelectedNodesID:function(){var e=[];return this.get()&&this.get().forEach(function(t){e.push(t.getID())}),e},onFolderSelected:function(e){return this._modelEvents.subscribe({event:"FOLDER_CSO/SELECT"},e)},isRelationsGroupNodeSelected:function(){let e=!1;var t=this.getCurrentSelection();if(t&&t.length>0)for(let o=0;o<t.length;++o)if(!0===t[o].isRelationsObjectGroupingNode){e=!0;break}return e}});return c}),define("DS/FolderEditor/commands/tools/ImportCSVBookmarkPanel",["UWA/Core","UWA/Controls/Abstract","UWA/Class/Events","UWA/Class/Options","DS/Logger/Logger","UWA/Class/Promise","DS/FolderEditor/Folder_CSO","DS/IPClassifyUtil/IPClassifyAlert","DS/UIKIT/Modal","DS/UIKIT/SuperModal","DS/UIKIT/Scroller","DS/UIKIT/Mask","DS/UIKIT/Input/Button","DS/UIKIT/Tooltip","DS/UIKIT/Popover","DS/Tree/Tree","DS/Tree/TreeNodeModel","DS/WebappsUtils/WebappsUtils","DS/Foundation/CsvParser","i18n!DS/FolderEditor/assets/nls/ImportCSVBookmarkPanel","DS/FolderEditor/utils/FolderEditorcontrol","DS/Controls/ProgressBar","DS/UIKIT/Input/Text","DS/ENOFloatingPanel/ENOFloatingPanel","DS/PADUtils/PADProbes","DS/PlatformAPI/PlatformAPI","css!DS/FolderEditor/FolderEditor.css","DS/FolderEditor/service/FolderEditorWebService","DS/FolderEditor/commands/tools/ImportCSVFilesUtils","DS/WidgetServices/WidgetServices","DS/PADUtils/PADWSAccess"],function(e,t,o,n,i,r,a,s,l,d,c,u,p,g,f,h,m,v,_,C,S,F,y,D,b,E,w,A,T,x,P){"use strict";var I=1e3,N=['"',"#","$","@","%","*",",","?","\\\\","<",">","\\[","\\]","|",":"],U=['"',"#","$","%","*",",","?","\\\\","<",">","\\[","\\]","|",":"],O=function(e,t){!0===t?e.addClassName("withBorder"):e.removeClassName("withBorder")},M=t.extend(n,o,{name:"ImportCSVBookmark",_logger:null,defaultOptions:{parent:null,renderTo:null,data:{level:0,name:1,description:2,aclOwner:3,aclSecurityContext:4,toModel:function(e){return{level:e[0].trim(),label:e[1].trim(),description:e[2].trim(),acl:{owner:""===e[3].trim()?"@BLANK@":e[3].trim(),securityContext:""===e[4].trim()?"@BLANK@":e[4].trim()}}}}},_droppableType:{"application/vnd.ms-excel":"csv","text/csv":"csv"},_isClosing:!0,_checkErrorRef:[],_currentFolderType:"",_currentFolder:null,_cancel:!1,_lv1SecCtxEmpty:!1,_browserLanguage:"",_mapSecurityContext:null,_errorTips:[],_errorReasons:null,init:function(t){var o=this;e.merge(t||{},o.defaultOptions);return o._browserLanguage=o.utils.getBrowserLanguage(),o._logger=i.getLogger(M),o._logger.log("init"),o._parent(t),o._currentFolder=a.getCurrentFolder(),o._currentFolderType=o._currentFolder?o._currentFolder.getType():void 0,o._mapSecurityContext={},new r(function(t,n){P.getscandcollab({tenant:x.getTenantID(),onComplete:function(n){(e.is(n,"string")?JSON.parse(n):n).collabspaces.forEach(function(e){e.couples.forEach(function(t){o._mapSecurityContext[t.role.nls.trim()+"."+t.organization.name.trim()+"."+e.title.trim()]=t.role.name.trim()+"."+t.organization.name.trim()+"."+e.name.trim()})}),o.inject(widget.body),t(o)},onFailure:n})})},closeDialog:function(){this.dialog&&this.dialog.destroy()},_destroyErrorTips:function(){this._errorTips.forEach(function(e){e.destroy()}),this._errorTips=[]},clickCancelButton:function(){this._isClosing&&(this._cancel=!0,this._destroyErrorTips(),this.closeDialog())},inject:function(t){var o=this;o._logger.log("inject");var n=b.createProbe("ImportCSV_inject"),i=new D({closable:!0,resizable:!0,autocenter:!0,overlay:!0,header:null,className:"importCSVDialog",limitParent:!0,body:'<div class="drop-csv"><input class="drop-csv-input" type="file" /><span class="drop-csv-label"><span class="fonticon fonticon-publish fonticon fonticon-2x"></span><p class="drop-csv-label-p"><span class="icon-label">'+C.Drop_Csv_File+'</span></p></span></div><div class="preview-csv"><div class="prev-csv-read"></div><div class="preview-csv-tree"><div class="preview-csv-tree-msg"></div></div></div>',footer:'<div class="csvstatus"></div>',events:{onHide:function(){o._isClosing&&m.destroy(),o.clickCancelButton.call(o)}}}).inject(t),r=e.Element.getElement.call(i.getHeader(),".floatingPanel_title span");window.top.dbg=i.getHeader();var s=o._currentFolder?o._currentFolder.getLabel():"";r.setHTML("<span class='csv-title'>"+C.Dialog_Title+s+"</span><span class='csv-title-icon'></span>");var l=e.Element.getElements.call(r,"span")[0],d=(e.Element.getElements.call(r,"span")[1],a.getCurrentFolderPath()),c=" ";if(d&&d.length>0)for(var u="",f=d.length,h=0;h<f;h++)c+=u+d[h].label,u="\\";var m=new g({position:"bottom",target:l,body:c});i.getContent().setStyle("min-width","450px"),i.getContent().setStyle("width","450px"),i.getContent().setStyle("min-height","215px"),i.getContent().setStyle("height","215px"),o.csvStatusArea=e.Element.getElement.call(i.getFooter(),".csvstatus"),o.notifyArea=new y({className:"detailmsg",value:"",disabled:!0}).inject(i.getFooter());var v=new p({value:C.Label_Import,className:"primary",disabled:!0}).inject(i.getFooter());v.addEvent("onClick",function(){this.disable(),o.execImportCSV()});var _=new p({value:C.Cancel,className:"default",title:C.Cancel_Tooltip}).inject(i.getFooter());return _.addEvent("onClick",function(){o.clickCancelButton.call(o)}),i.show(),o.dialog=i,o.importButton=v,o.cancelButton=_,o.dropZone=e.Element.getElement.call(o.dialog.getBody(),".drop-csv"),o.dropInput=e.Element.getElement.call(o.dialog.getBody(),".drop-csv-input"),o.dropLabel=e.Element.getElement.call(o.dialog.getBody(),".drop-csv-label"),o.dropLabelPara=e.Element.getElement.call(o.dialog.getBody(),".drop-csv-label-p"),o.dialog.getBody().addClassName("dialog-csv"),o.dialog.getBody().setStyle("height","100px"),o.droppable(o.dropZone),n.end(),o},reset:function(){this._logger.log("reset"),this.filePreview&&this.filePreview.destroy(),this.tree=void 0,this.filePreview=void 0},_initProgress:function(e){this.progress&&this.progress.destroy(),this.csvStatusArea.empty(),this.progress=new F({shape:"circular",statusFlag:!1,emphasize:e,dislpayFlag:!1,displayStyle:"lite"}),this.progress.inject(this.csvStatusArea),this.progress.value=0},droppable:function(e){var t=this,o=0;function n(t){u.unmask(e),s.displayNotification({message:t,className:"error"}),e.addClassName("error"),setTimeout(function(){e.removeClassName("error")},I)}function i(o){var i=o.dataTransfer?o.dataTransfer.files:o.target.files;if(0===i.length)return!0;if(i.length>1)n(C.ErrorMsg_Drop_Multiple_File);else{var r=i[0].name.split(".");if(r.length<=1||"csv"!==r[r.length-1].toLowerCase())return console.warn("drop file:"+r[r.length-1].toLowerCase()),void n(C.ErrorMsg_Drop_File_Not_CSV);if(0===i[0].size)return n(C.ErrorMsg_Drop_File_Empty),!0;if(i[0].size>25600){var a=C.ConfirmMsg_Drop_File_Size_Large+" ("+T.formatBytes(i[0].size,2)+")";new d({renderTo:t.options.renderTo,events:{onShow:function(){t._isClosing=!1,t.dialog.hide()},onHide:function(){t._isClosing=!0,t.dialog.show()}}}).confirm(a,C.Label_Confirm_Title,function(o){o&&t._loadCsv(e,i[0])})}else t._loadCsv(e,i[0])}}t.dropInput.addEventListener("click",function(e){this.value=null,x.isReplayedODT()&&e.preventDefault()},!1),t.dropInput.addEventListener("change",i,!1),t.listeners={},t.listeners.clickable=t.dropInput.click.bind(t.dropInput),e.addEventListener("click",t.listeners.clickable),t.listeners.dragenter=function(e){O(this,!0),o++},e.addEventListener("dragenter",t.listeners.dragenter),t.listeners.dragleave=function(e){0===--o&&O(this,!1)},e.addEventListener("dragleave",t.listeners.dragleave),t.listeners.dragover=function(e){e.preventDefault()},document.addEventListener("dragover",t.listeners.dragover),t.listeners.drop=function(e){e.preventDefault();var t=e.dataTransfer.types;t&&((t.indexOf?-1!=t.indexOf("Files"):t.contains("Files"))&&i(e))},e.addEventListener("drop",t.listeners.drop)},_getOrCreateTreeContent:function(){var t=e.Element.getElement.call(this.dialog.getBody(),".preview-csv-tree");t.getElement(".tree-content")||e.createElement("div",{class:"tree-content"}).inject(t)},_loadCsv:function(t,o){if(!o.dontRead){var n=this;u.mask(t);var i=function(e){u.unmask(t),n.updateDroppedFile({name:o.name,size:o.size})};n._destroyErrorTips(),n._errorReasons=[],n.importButton.setValue(C.Label_Import),n.importButton.disable(),n.reset(),O(t,!1);var a=e.Element.getElement.call(n.dialog.getBody(),".preview-csv-tree");a.setStyle("height","0px").setStyle("border","solid 0px"),a.empty(),this._getOrCreateTreeContent(),r.all([n._readFile(o)]).then(function(e){try{n._initProgress("info"),n.csvStatusArea.addClassName("active");var t=_.parse(e[0]+"\r\n");if(t.length>0){var o=t[0];o.length>0&&isNaN(o[0])&&t.splice(0,1)}r.all([n.checkLines(t),n.checkRemoteStatus(t)]).then(function(e){var o=e[0].concat(e[1]).sort(function(e,t){return Math.abs(e.linePos)!==Math.abs(t.linePos)?Math.abs(e.linePos)<Math.abs(t.linePos)?-1:1:Math.abs(e.pos)<Math.abs(t.pos)?-1:1}).filter(function(e){return""!==e.reason});n._errorReasons=o,n._prepareImportData(t,o,i)})}catch(e){handleError(e.message)}})}},_prepareImportData:function(t,o,n){var i,a=this,l=0===o.length;i=l?t:[],a.tree&&a.tree.destroy();var d=a._createTreeView(),u=a._createTreeModel(i);d.getDocument().addRoot(u),a.tree=d,a.root=u,r.all([a.resolveSecurityContextOfSelectedFolder(a.root),a._showPreview(d),a._getStructure(u.options.id,u.options.label,0,u)]).then(function(e){var o=e[0];e[1],e[2];u.options.appData.acl.securityContext=o;var n=a.root.getAllDescendants().filter(function(e){return e.options.appData.hasId});if(l){var i=t.length-n.length;if(0===i)return a.notifyMessage("info",C.InfoMsg_Create_Target_Size_Zero),a.cancelButton.setValue(C.Close),a.importButton.setValue(C.Label_Import+"(0)"),void a.importButton.disable();if(null===o&&a._lv1SecCtxEmpty)return s.displayNotification({message:C.WarnMsg_SecurityContext_MissMatch,className:"warning"}),a.cancelButton.setValue(C.Close),a.importButton.setValue(C.Label_Import+"(0)"),void a.importButton.disable();a.importButton.enable(),a.importButton.setValue(C.Label_Import+"("+i+")")}}).catch(function(e){s.displayNotification({message:C.ErrorMsg_Rest_Error+(e&&e.message?" "+e.message:""),className:"error"})}),n(d);var p=o.map(function(e){return Math.abs(e.linePos)}).filter(function(e,t,o){return o.indexOf(e)===t}).length,f=t.length-p,h=e.Element.getElement.call(a.dialog.getBody(),".tree-content");if(l)a.notifyMessage("info","["+f+"/"+t.length+"] "+C.InfoMsg_Load_Csv_Success),a.csvStatusArea.removeClassName("active");else{a.notifyMessage("error","["+f+"/"+t.length+"]"+C.InfoMsg_Load_Csv_Error),a.progress.emphasize="high-attention",h.addClassName("csverror");var m=[C.Label_Column_Level,C.Label_Column_Name,C.Label_Column_Description,C.Label_Column_Owner,C.Label_Column_SecurityContext];o.forEach(function(o){var n=Math.abs(o.linePos),i=(a.options.data,e.createElement("div",{text:" ("+C.Label_LineNumber+":"+(n+1)+") "+o.reason,class:"errorline icon"+o.pos}));if(h.appendChild(i),o.pos){var r;r=m[o.pos]+" : "+t[n][o.pos];var s=new g({position:"bottom",target:i,body:T.Sanitize.encode(r)});a._errorTips.push(s)}})}new c({element:h}),h.addClassName("csvshow")},undroppable:function(e){this.listeners&&(e.removeEventListener("click",this.listeners.clickable),e.removeEventListener("dragenter",this.listeners.dragenter),e.removeEventListener("dragleave",this.listeners.dragleave),e.removeEventListener("dragover",this.listeners.dragover),e.removeEventListener("drop",this.listeners.drop),this.listeners=null),e.setStyle("cursor","default"),this.dropLabel.setStyle("cursor","default"),e.addClassName("drop-disabled")},updateDroppedFile:function(t){var o=this;o.dialog.getContent().setStyle("min-width","570px"),o.dialog.getContent().setStyle("min-height","435px"),o.dialog.getContent().setStyle("width","570px"),o.dialog.getContent().setStyle("height","435px");var n=e.createElement("span",{class:"csv-file",html:'<span class="csv-file-image"></span><span class="csv-file-name">'+t.name+" ("+T.formatBytes(t.size,2)+")</span>"});o.filePreview=n,o.dropLabel.setStyle("font-size","10px").setStyle("top","-5px").setStyle("float","right").setStyle("text-align","center"),o.dropZone.setStyle("height","40px").setStyle("border","initial").setStyle("cursor","pointer");var i=e.Element.getElement.call(o.dropLabelPara,".icon-label");i.textContent=C.Change_Csv_File;var r=e.Element.getElement.call(o.dialog.getBody(),".preview-csv-tree");r.setStyle("height","calc(100% - (56px + 66px + 66px) )"),r.setStyle("border","1px solid #e2e4e3").setStyle("top","100px"),this._getOrCreateTreeContent(),setTimeout(function(){if(n.inject(o.dropLabel,"before"),o.undroppable(o.dropZone),!o.iconZone&&(o.iconZone=e.Element.getElement.call(o.dropZone,".fonticon"),o.iconZone)){o.iconZone.setStyle("cursor","pointer");var t=o.dropInput.click.bind(o.dropInput);o.iconZone.addEventListener("click",t,!1);var r=i;r.setStyle("cursor","pointer"),r.addEventListener("click",t,!1)}},I/3)},_readFile:function(e){var t=this,o=new FileReader;return new r(function(n,i){o.onload=function(e){n(e.target.result)},o.readAsText(e,"ja"===t._browserLanguage?"Shift-JIS":"WINDOWS-1252")})},checkLines:function(e){var t=this;return new r(function(o,n){var i=b.createProbe("ImportCSV_checklines"),r=t.options.data,a=0,s="",l=[{}],d={},c=[],u=!0,p=new RegExp("^-*[0-9]+$");t._checkErrorRef=c;for(var g=x.isReplayedODT()?1:-1,f=0;f<e.length;f++){var h={reason:"",data:[],linePos:-1,pos:-1},m=e[f];if(m.length<5)h.reason=C.ErrorMsg_Column_Count,h.linePos=f,h.pos=null,c.push(h);else{if(u&&a>=0){h.pos=r.level;var v=m[r.level];if(!p.test(v)){h.reason=C.ErrorMsg_Level_Is_Not_Number,h.linePos=f*g,c.push(h),a=h.linePos,u=-1!==g;continue}if((v=parseInt(v))<=0){h.reason=C.ErrorMsg_Level_Origin,h.linePos=f*g,c.push(h),a=h.linePos,u=-1!==g;continue}if(!(a>=v||a+1===v)){h.pos=r.level,h.reason=C.ErrorMsg_Level_Is_Not_Sequencial,h.linePos=f*g,c.push(h),a=h.linePos,u=-1!==g;continue}if(a>=v)for(var _=a-v,S=0;S<_;S++)l.pop();if(s=m[r.name],l.length+1===v&&l.push({}),d=l[v-1]){if(d[s]){h.pos=r.name,h.reason=C.ErrorMsg_Name_Duplicate,h.linePos=f,a=v,c.push(h);continue}d[s]=!0}a=v}if(h.pos=r.name,""!==(s=m[r.name]).trim())if(T.getStringByte4UTF8(s)>=127)h.reason=C.ErrorMsg_Name_Max_Over,h.linePos=f,c.push(h);else{var F=N.join(""),y=new RegExp("["+F+"]");s=T.removeControllCode(s),m[r.name]=s,h.pos=r.description;var D=m[r.description];if(D.length>1024)h.reason=C.ErrorMsg_Desc_Max_Over,h.linePos=f,c.push(h);else{var E=y.exec(D);E?(h.reason=C.ErrorMsg_Avoid_Char+"("+E.map(function(e){return e}).join("&nbsp;")+")",h.linePos=f,c.push(h)):(D=T.escapeControllCode(D),m[r.description]=D)}}else h.reason=C.ErrorMsg_Name_Required,h.linePos=f,c.push(h)}}i.end(),o(c)})},checkRemoteStatus:function(e){var t=this;return new r(function(o,n){var i=b.createProbe("ImportCSV_checkRemoteStatus"),a=t.options.data,s={listeners:{}},l=[];t.csvStatusArea.addClassName("active"),t._lv1SecCtxEmpty=!1;var d=N.join(""),c=U.join(""),u=new RegExp("["+d+"]"),p=new RegExp("["+c+"]"),g=0,f=0,h=t.listSecurityContext(),m=-1;e.forEach(function(n,d){if(n.length<5)for(var c=n.length;c<5;c++)n.push("");var v={reason:"",data:[],linePos:-1,pos:-1};f++;var _=n[a.aclOwner];_=_.trim();var S=[],F=null;if(F=r.resolve(!0),0!==_.length){var y=p.exec(_);switch(!0){case T.getStringByte4UTF8(_)!==_.length:v.pos=a.aclOwner,v.reason=C.ErrorMsg_Owner_Is_Not_Ascii,v.linePos=d,l.push(v),F=r.resolve("NOCHECK");break;case null!==y:v.pos=a.aclOwner,v.reason=C.ErrorMsg_Avoid_Char+"("+y.map(function(e){return e}).join("&nbsp;")+")",v.linePos=d,l.push(v),F=r.resolve("NOCHECK");break;default:v.pos=a.aclOwner,F=t._checkOwner(d,_,s)}}S.push(F),v={reason:"",data:[],linePos:-1,pos:-1};var D=n[a.aclSecurityContext].trim();if(F=r.resolve(!0),0!==D.length)switch(y=u.exec(D),!0){case 3!==D.split(".").length:v.pos=a.aclSecurityContext,v.reason=C.ErrorMsg_SecCtx_Is_Invalid,v.linePos=d,l.push(v),F=r.resolve("NOCHECK");break;case null!==y:v.pos=a.aclSecurityContext,v.reason=C.ErrorMsg_Avoid_Char+"("+y.map(function(e){return e}).join("&nbsp;")+")",v.linePos=d,l.push(v),F=r.resolve("NOCHECK");break;default:v.pos=a.aclSecurityContext,F=t._checkSecurityContext(d,D,h)}else"1"===n[a.level].trim()&&(t._lv1SecCtxEmpty=!0);S.push(F);var b=d+"";r.all(S).then(function(o){if(!0===o[0]&&!0===o[1]&&0===t._checkErrorRef.filter(function(e){return Math.abs(e.linePos)===parseInt(b)}).length){var n=++g/e.length*100;m!==n&&(t.progress.value=n,m=n)}return o}).then(function(e){var t=null,r=null;e[0]||(t=C.ErrorMsg_Rest_Error,!1===e[0]&&(t=C.ErrorMsg_Owner_Does_Not_Exist)),t&&(r={reason:t,data:n,linePos:d,pos:a.aclOwner},l.push(r)),t=null,!1===e[1]&&(t=C.ErrorMsg_SecCtx_Does_Not_Exist),t&&(r={reason:t,data:n,linePos:d,pos:a.aclSecurityContext},l.push(r)),0===--f&&(i.end(),o(l))})})})},_createTreeModel:function(e){var t=this.options.data,o=[],n=b.createProbe("ImportCSV_createTreeModel"),i=new m({id:this._currentFolder.id,label:this._currentFolder.getLabel(),level:0,appData:{acl:{}},icons:[v.getWebappsAssetUrl("FolderEditor","icons/foldersectionall.png")]});return o.push(i),e.forEach(function(e){var n=t.toModel(e);n.hasId=!1;var i=new m({level:n.level,label:n.label,appData:n,icons:[v.getWebappsAssetUrl("FolderEditor","icons/folder.png")]}),r=n.level;o[r]=i,o[r-1].addChild(i)}),n.end(),i},_createTreeView:function(){var t={apiVersion:2,height:"auto",position:"relative",width:"auto",isEditable:!1,isSortable:!1,manageHeight:!1,selection:{toggle:!1,canMultiSelect:!1,unselectAllOnEmptyArea:!1,nodes:!1,rowHeaders:!1}};return this.dialog.getBody().setStyle("height","323px"),new h(t).inject(e.Element.getElement.call(this.dialog.getContent(),".preview-csv-tree"))},notifyMessage:function(e,t){this.notifyArea.setValue(t),this.notifyArea.setClassName("detailmsg show "+e)},_showPreview:function(t){var o=this;return new r(function(n,i){!function i(){null!==e.Element.getElement.call(o.dialog.getBody(),".wux-scroller")?(setTimeout(function(){t.getDocument().expandAll(),u.unmask(e.Element.getElement.call(o.dialog.getContent(),".preview-csv-tree"))},I/10),n(t)):setTimeout(function(){i()},I/10)}()})},_getStructure:function(e,t,o,n){var i=this;return new r(function(t,a){var s=b.createProbe("ImportCSV_getStructure"),l={onComplete:function(e){for(var a={},l=[],d=(e=JSON.parse(e)).folders,c=n.getChildren()||[],u=c.map(function(e){return e.getLabel()}),p=0;p<d.length;p++){var g=d[p],f=o+1,h={id:g.id,label:g.name,level:o+1};a[g.name]=h;var m=u.indexOf(g.name);if(-1!=m){var _=c[m];_.options.id=g.id,_.options.icons=[v.getWebappsAssetUrl("FolderEditor","icons/foldersectionall.png")],_.options.appData.hasId=!0,_.options.appData.modified=new Date(Date.parse(g.modified)),_.options.appData.acl.securityContext=i.resolveCurrentSecurityContextBy(g.organizationResponsible,g.project),_.updateOptions("icons"),l.push(i._getStructure(g.id,g.name,f,_))}}r.all(l).then(function(e){t(a),s.end()})},onFailure:function(e){var t;(t=n).options.icons=[v.getWebappsAssetUrl("FolderEditor","icons/folder_ng.png")],t.updateOptions("icons"),a(n.options.label),s.end()}};0===o&&"FolderSection_AllFolders"===i._currentFolderType?(l.isRoot=!0,A.folderTree(l)):(l.pid=e,A.folderTree(l))})},resolveSecurityContextOfSelectedFolder:function(t){var o=this;return new r(function(n,i){var r=b.createProbe("ImportCSV_resolveSecurityContextOfSelectedFolder");""!==t.options.id?A.getFolderProperties({pid:t.options.id,onComplete:function(i){e.is(i,"string")&&(i=JSON.parse(i)),t.options.appData.acl.securityContext=o.resolveCurrentSecurityContextBy(i.organizationResponsible,i.project),n(t.options.appData.acl.securityContext),r.end()},onFailure:function(e){t.options.icons=[v.getWebappsAssetUrl("FolderEditor","icons/folder_ng.png")],t.updateOptions("icons"),i({type:"check",message:"("+t.options.label+")",raw:e}),r.end()}}):(t.options.appData.acl.securityContext=o.utils.getCurrentSecurityContext(),n(t.options.appData.acl.securityContext),r.end())})},resolveCurrentSecurityContextBy:function(e,t){var o=this.utils.getCurrentSecurityContext(),n=o.split("."),i=n[1],r=n[2];return i===e&&r===t?o:(this._logger.warn("can't resolve securityContext : "+e+"."+t),null)},execImportCSV:function(){var e=this,t=b.createProbe("ImportCSV_execImportCSV");e._cancel=!1,e._initProgress("success"),e.csvStatusArea.addClassName("active");for(var o=e.root.getAllDescendants(),n=[],i=0,a=0;a<o.length;a++){var l,d=o[a];d.options.appData.hasId?(l=e.getFolder(d),i++):l=e.createFolder(d),n.push(l)}var c=0,u=null,p=n.length-i;n.reduce(function(t,o){return t.then(function(t){e.progress.value=c/p*100,e.notifyMessage("info","["+c+"/"+p+"] "+C.InfoMsg_Folder_Creating),"create"===t.type&&c++}).then(o)},r.resolve({type:"dummy"})).catch(function(e){u=e.message||e}).then(function(o){e.cancelButton.setValue(C.Close),S.getContent().loadContentAndSelect(e._currentFolder),S.getTreeCont().updateTreeWithNewFolder(e._currentFolder),null===u?(e.progress.value=100,e.notifyMessage("info","["+p+"/"+p+"] "+C.InfoMsg_Folder_Create_Success),e.csvStatusArea.removeClassName("active"),s.displayNotification({message:C.InfoMsg_Folder_Create_Success,className:"success"})):(e.notifyMessage("error","["+c+"/"+p+"] "+C.ErrorMsg_Folder_Create_Stoped),e.progress.emphasize="high-attention",s.displayNotification({message:u,className:"error"})),t.end()})},createFolder:function(e){var t=this;return function(){return new r(function(o,n){return t._cancel?(t._logger.log("Import operation canceled"),void n({type:"create",message:C.ErrorMsg_Folder_Create_Stoped,raw:""})):(null!==(i="@BLANK@"!==e.options.appData.acl.securityContext?e.options.appData.acl.securityContext:e.getParent().options.appData.acl.securityContext)&&(t._mapSecurityContext[i]&&(i=t._mapSecurityContext[i]),e.options.appData.acl.securityContext=i),widget.odtWrongCtx||null===i?(e.options.icons=[v.getWebappsAssetUrl("FolderEditor","icons/folder_ng.png")],e.updateOptions("icons"),void n({type:"create",message:C.WarnMsg_SecurityContext_MissMatch,raw:""})):void A.newFolder({parentBookmarkId:e.getParent().options.id,forcedSecurityContext:i,onComplete:function(t){var i=[v.getWebappsAssetUrl("FolderEditor","icons/folder_ok.png")];if(t&&(t=JSON.parse(t)),null!==t&&"SUCCESS"===t.result){var r={Title:e.options.appData.label,description:e.options.appData.description};"@BLANK@"!==e.options.appData.acl.owner&&(r.owner=e.options.appData.acl.owner);var a=t.id;A.setFolderProperties({pid:a,properties:r,onComplete:function(t){e.options.id=a,e.options.icons=i,e.updateOptions("icons"),o({type:"create",message:null,raw:t})},onFailure:function(t){var o=function(){e.options.icons=[v.getWebappsAssetUrl("FolderEditor","icons/folder_ng.png")],e.updateOptions("icons"),n({type:"create",message:C.ErrorMsg_Bookmark_Create_Stoped_SetProperties,raw:t})};A.deleteFolder({pid:a,forcedSecurityContext:widget.getPreference("pad_security_ctx").value,onComplete:o,onFailure:o})}})}else{e.options.icons=[v.getWebappsAssetUrl("FolderEditor","icons/folder_ng.png")],e.updateOptions("icons");var s=t&&t.message?t.message:C.ErrorMsg_Folder_Create_Stoped;n({type:"create",message:s,raw:t})}},onFailure:function(t){e.options.icons=[v.getWebappsAssetUrl("FolderEditor","icons/folder_ng.png")],e.updateOptions("icons"),n({type:"create",message:C.ErrorMsg_Rest_Error+"("+e.options.label+")",raw:t})}}));var i})}},getFolder:function(t){return function(){return new r(function(o,n){A.getFolderProperties({pid:t.options.id,onComplete:function(i){e.is(i,"string")&&(i=JSON.parse(i)),new Date(Date.parse(i.modified)).getTime()!==t.options.appData.modified.getTime()?(t.options.icons=[v.getWebappsAssetUrl("FolderEditor","icons/folder_ng.png")],t.updateOptions("icons"),n({type:"check",message:C.ErrorMsg_Exist_Folder_Modified+"("+t.options.label+")",raw:i})):o({type:"check",message:null,raw:i})},onFailure:function(e){t.options.icons=[v.getWebappsAssetUrl("FolderEditor","icons/folder_ng.png")],t.updateOptions("icons"),n({type:"check",message:C.ErrorMsg_Rest_Error+"("+t.options.label+")",raw:e})}})})}},_checkOwner:function(t,o,n){var i=this;return new r(function(t,r){var a=""===o||n[o];if(a)t(a);else{var s=void 0!==n.listeners[o],l=n.listeners[o]||[];l.push(t),n.listeners[o]=l,s||A.personSearch({name:o,onComplete:function(t){if(1===(t=e.is(t,"string")?JSON.parse(t):t).data.length){var i=t.data[0].dataelements.name,r=o===i;l.forEach(function(e){e(r)}),n[o]=r}else l.forEach(function(e){e(!1)}),n[o]=!1},onFailure:function(e){!0,i._logger.log("response error personSearch "),l.forEach(function(e){e(null)})}})}})},listSecurityContext:function(){var e=[],t=widget.getPreference("pad_security_ctx");if(t){var o=t.options;Array.isArray(o)&&o.forEach(function(t){t.value&&e.push(t.value.split("::")[1])})}return e},_checkSecurityContext:function(e,t,o){var n=this;return new r(function(e,i){return""===t||n._mapSecurityContext[t]?void e(!0):void e(-1!==o.indexOf(t))})},utils:{getCurrentSecurityContext:function(){var e=widget.getPreference("pad_security_ctx").value;return e.contains("ctx::")&&(e=e.split("::")[1]),e},getBrowserLanguage:function(){return x.getLanguage()}}});return M}),define("DS/FolderEditor/views/additionalFacets/AttachmentsFacet",["UWA/Core","UWA/Class","UWA/Controls/Abstract","DS/EditPropWidget/facets/Common/FacetsBase","DS/WidgetServices/WidgetServices","DS/ENOXAttachmentsAndSpecificationsUX/AttachmentsAndSpecifications","DS/FolderEditor/Folder_CSO"],function(e,t,o,n,i,r,a){return t.extend(o,n,{init:function(e){this._parent(e),this.buildView(e)},buildView:function(t){this.elements.container=e.createElement("div",{class:"doc_fitting"});var o={parentObject:{parentId:null},connectorOptions:{fetchSecurityContext:function(){return t.appContext.getSecurityContext().replace("ctx::","")},platformUrls:t.appContext.getPlatformUrls()},hideAttachments:t.hideAttachments,hideSpecifications:t.hideSpecifications,supportedTypes:t.supportedTypes,readonly:t.readonly,webinwin:i.isWebInWinEnvironment()};this.pane=new r(o),this.pane.inject(this.elements.container)},isTypeSupported:function(e){let t=this.pane.options.hideAttachments?["VPMReference"]:["VPMReference","Document"];for(let o=0;o<t.length;++o)if(e.indexOf(t[o])>-1)return!0;return!1},updateFacet:function(){var e=this,t=this.getModel();this._currentId=t.get("objectId"),1==a.getCurrentSelection().length&&(t.addEventOnce("onChangeAttributes",function(t){t.get("_DS_ATTR_types")&&t.get("_DS_ATTR_types").valueDB&&e.isTypeSupported(t.get("_DS_ATTR_types").valueDB)&&e.selectionModified()}),(null==this._previousId||t.get("_DS_ATTR_types")&&t.get("_DS_ATTR_types").valueDB&&e.isTypeSupported(t.get("_DS_ATTR_types").valueDB))&&this.selectionModified(),this._previousId=this._currentId)},selectionModified:function(){var e={parentId:this._currentId};this.pane.setParentObject(e)}})}),define("DS/FolderEditor/commands/ActionBar_AddToFavoritesCmd",["UWA/Core","DS/ApplicationFrame/CommandCheckHeader","DS/FolderEditor/Folder_CSO","i18n!DS/FolderEditor/assets/nls/FolderEditor","DS/FolderEditor/utils/FolderEditorcontrol","DS/FolderEditor/service/FolderTypeService"],function(e,t,o,n,i,r){"use strict";return t.extend({labelTopBar:n.label_ActionBar_AddToFavorites,isInsert:!0,datas:{},init:function(t){this._parent(t,{});var a=this;o.onChange(function(){a._adaptStateToCurrentFolder()}),this.onStateChange(function(){if(a.getState()){if((l=o.getCurrentSelection())&&l[0]){c=(d=l[0]).getID(),u=d.getType(),p=d.options.label;var t=d.options.mxid;g=d.isPersonal;if(c&&r.inFamilyFolder(u)&&e.is(i.getTreeCont())){var s={id:c,name:p,type:u,isPersonal:g,mxid:t,inherit:"SHARED"===d.options.folderClassification};0==i.getTreeCont().isFolderAmongFavoriteFolders(s)&&i.getTreeCont().addFavorite(s)}}a.labelTopBar=n.label_ActionBar_RemoveFromFavorites}else{var l;if((l=o.getCurrentSelection())&&l[0]){var d,c=(d=l[0]).getID(),u=d.getType(),p=d.options.label,g=d.isPersonal;if(c&&r.inFamilyFolder(u)&&e.is(i.getTreeCont())){var f={id:c,name:p,type:u,isPersonal:g};if(1==i.getTreeCont().isFolderAmongFavoriteFolders(f))!1===i.getTreeCont().removeFavorite(f)&&a.setState(!0,!1)}}a.labelTopBar=n.label_ActionBar_AddToFavorites}}),this._adaptStateToCurrentFolder()},_adaptStateToCurrentFolder:function(){var t=o.getCurrentSelection();if(t&&t[0]&&t[0].getID){var n=t[0],r=n.getID(),a=n.options.label;if(e.is(i.getTreeCont())){var s={id:r,name:a},l=!1;i.getTreeCont().isFolderAmongFavoriteFolders(s)&&(l=!0),this.setState(l,!1)}}}})}),define("DS/FolderEditor/views/FolderMode",["UWA/Controls/Abstract","DS/Controls/TooltipModel","DS/FolderEditor/Folder_CSO","DS/Utilities/Dom","i18n!DS/FolderEditor/assets/nls/FolderEditor","DS/FolderEditor/utils/FolderEditorcontrol","DS/FolderEditor/utils/FolderEditorEvents","DS/FolderEditor/utils/FolderSearch","DS/IPClassifyUtil/IPClassifyAlert","DS/Core/ModelEvents","DS/PADUtils/PADSession","DS/PADServices/utils/GlobalModelEvents","DS/FolderEditor/utils/FolderLoaderGlobal","DS/WebUAUtils/WebUAUtils","DS/IPClassifyUtil/IPClassifyUtility"],function(e,t,o,n,i,r,a,s,l,d,c,u,p,g,f){"use strict";var h=null,m=null;function v(){return{icon:{iconName:widget.getValue("useIndexAccleration")?isNaN(widget.getValue("autoSwitch"))?"database hoverGlass":"database-hourglass":"database hoverGlass",fontIconFamily:1,className:"check-active"},disabled:!widget.getValue("useIndexAccleration")}}var _=e.singleton({_currentModeType:"read",_instantTime:null,_lastRefreshMode:null,_modelEvents:null,init:function(e){this._parent(e),this._tooltip=new t,u.getModelEvents().subscribe({event:"switch_to_author"},this.switchtoAuthoringMode.bind(this)),setInterval(()=>{this.updateToolTip()},1e4),this._modelEvents=new d},getToolbarEntry:function(){var e="read"==_.getCurrentModeType()?{icon:{iconName:"database-refresh",fontIconFamily:1,className:""},disabled:!1}:v(),t={id:"indexMode",dataElements:{typeRepresentation:"functionIcon",tooltip:this._tooltip,label:i.indexMode.Label,action:{module:"DS/FolderEditor/views/FolderMode",func:"switchModeButtonUI"},visibleFlag:1!=widget.launchWithReadMode}};for(var o in e)t[o]=e[o];return t},switchModeButtonUI:function(){f.sendTrackerPageEvent("FolderWidget_iconBar","Active Mode");var e;e=300,clearTimeout(m),m=setTimeout(function(){s.isSearchActive()&&(s.clearSearch(),r.getIdCardCont().switchSearch(!1)),p.addComponentsToLoad("global",{tree:""}),"read"==_.getCurrentModeType()?(_.setCurrentMode("authoring"),_.updateIconAndSettings()):(_.setCurrentMode("read"),_.updateIconAndSettings());try{r.getTreeCont().refreshFolderTreeAndContent()}catch(e){console.log("Error in tree mode"),p.removeComponentToLoad("global","tree")}},e)},updateIconAndSettings:function(e){var t=e||!0;if(widget.refreshDuetoChangeInPreference){var o=widget.changeInPreference;o.hasOwnProperty("useIndexAccleration")&&(o.useIndexAccleration?this.setCurrentMode("read"):this.setCurrentMode("authoring"),this._modelEvents.publish({event:"changeInContentFilterType"})),(o.hasOwnProperty("filtered-content")||o.hasOwnProperty("allow-products-expand"))&&this._modelEvents.publish({event:"onSpecificPreferenceChange"})}(t&&this._registerTimeandModeOfRefresh(this.getCurrentModeType()),"read"==this.getCurrentModeType())&&(this._enableIndexModeSwitch(),r.getContent().RefreshProductStructure=!0,_.stopRefresh(),(!widget.refreshDuetoChangeInPreference||Object.keys(o).length>0)&&r.getContent().getSpecficMode("read").resetInfoIndex());if("authoring"==this.getCurrentModeType())if(widget.getValue("useIndexAccleration")){var n=widget.getValue("autoSwitch");this._enableAuthoringMode(),_.setIndexModeAfterTimeInterval(n)}else this._enableAuthoringMode();this.updateToolTip()},_enableAuthoringMode:function(){if(r.getIdCardCont()){var e=v();r.getIdCardCont().updateCommand("indexMode",e)}},_enableIndexModeSwitch:function(){if(r.getIdCardCont()){var e={icon:{iconName:"database-refresh",fontIconFamily:1,className:""},disabled:!1};r.getIdCardCont().updateCommand("indexMode",e)}},getCurrentModeType:function(){return this._currentModeType},setCurrentModeType:function(e){this._currentModeType=e,"read"==e?(c.setAuthoringState(!1),c.setUseIndexPreference(!0)):(c.setAuthoringState(!0),c.setUseIndexPreference(!1))},onGlobalModeChange:function(e){this._modelEvents.subscribe({event:"changeInFolderGlobalMode"},e)},onSpecificPreferenceChange:function(e){this._modelEvents.subscribe({event:"onSpecificPreferenceChange"},e)},_registerTimeandModeOfRefresh:function(e){this._instantTime=(new Date).getTime(),this._lastRefreshMode=e},updateToolTip:function(){var e=this._instantTime,t=Math.floor(((new Date).getTime()-e)/1e3);t=t<60?t+" "+i.indexMode.seconds:t/60<60?Math.floor(t/60)+" "+i.indexMode.minutes:Math.floor(t/3600)+" "+i.indexMode.hours;var o="read"==this._currentModeType?i.indexMode.Index:i.indexMode.Authoring,n=i.replace(i.indexMode.activeMode,{mode:o})+"\n"+i.replace(i.indexMode.lastRefresh,{timeElapsed:t}),a=widget.getValue("useIndexAccleration")&&"authoring"==this._currentModeType&&!isNaN(widget.getValue("autoSwitch"))?n+"\n"+i.replace(i.indexMode.reactIndexMode,{autoSwitch:widget.getValue("autoSwitch")}):n;if(this._tooltip.shortHelp=a,!this._tooltip.moreHelpCB){var s={helpid:"indexMode",content:{"indexMode.PanelHelp":"ENOFol3UAPanelMap/foldereditor-c-IndexMode.htm"}},l=g.getMoreHelpCallback(s);this._tooltip.moreHelpCB=l}r.getIdCardCont()&&r.getIdCardCont().updateCommand("indexMode",{tooltip:this._tooltip})},setIndexModeAfterTimeInterval:function(e){var t=this;if(this.stopRefresh(),!isNaN(e)){var o=parseInt(e);h=setTimeout(function(){widget.getPreference("useIndexAccleration").value&&(t.setCurrentMode("read"),t.updateIconAndSettings(),l.displayNotification({message:i.indexMode.info_msg_DataNotUptoDate,className:"info"}))},60*o*1e3)}},stopRefresh:function(){h&&clearTimeout(h)},setCurrentMode:function(e){var t=this._currentModeType!==e;this.setCurrentModeType(e),!s.isSearchActive()&&r.getContent()&&r.getContent().setCurrentMode(e),t&&this._modelEvents.publish({event:"changeInFolderGlobalMode"})},switchtoAuthoringMode:function(e){e="boolean"==typeof e&&e,"read"==_.getCurrentModeType()&&(s.isSearchActive()&&0==e&&(s.clearSearch(),r.getIdCardCont().switchSearch(!1)),_.setCurrentMode("authoring"),l.displayNotification({message:i.indexMode.msg_Authoring,className:"info"})),_.updateIconAndSettings()},isFolderProxyToBeUsed:function(){var e=r.getContent(),t=e?e.getCurrentModeType():widget.getValue("useIndexAccleration")?"read":"authoring",n=o.getCurrentFolder(),i=!!n&&"FolderSection_AllFolders"==n.getID();return"read"==t&&!(widget.getValue("filtered-content")&&!i)}});return _}),define("DS/FolderEditor/views/FolderPlaceHolder",["UWA/Controls/Abstract","DS/Controls/Button","DS/FolderEditor/utils/FolderEditorEvents","DS/ApplicationFrame/CommandsManager","DS/FolderEditor/Folder_CSO","DS/FolderEditor/utils/FolderEditorcontrol","i18n!DS/FolderEditor/assets/nls/FolderEditor","DS/FolderEditor/utils/FolderSearch","DS/FolderEditor/views/FolderMode"],function(e,t,o,n,i,r,a,s,l){"use strict";return e.extend({init:function(e){this._parent(e),this._buttonComponents=null,this.text={},this.buildSkeleton()},buildSkeleton:function(){var e=this,t="FolderSection_AllFolders";function n(t){e._getComponentToReplace(t).inject(e.elements.container)}i.getCurrentFolder()&&(t=i.getCurrentFolder().plmType),this.elements.container=UWA.createElement("div",{class:"content-placeholder"}),this.elements.icon=UWA.createElement("div",{class:"content-placeholder-icon"}).inject(this.elements.container),this.elements.description=UWA.createElement("div",{class:"content-placeholder-description"}).inject(this.elements.container),o.onCurrentFolderChange(function(t){e._removeButtonComponent(),n(t.currentNode.plmType)}),s.onSearchChange(function(){s.isSearchActive()?(e._removeButtonComponent(),n()):(t=i.getCurrentFolder().plmType,e._removeButtonComponent(),n(t))}),n(t)},_buildButtonComponents:function(e){var o=[];function n(e,o){var n=e.commands[o].callback,i={label:e.commands[o].name,emphasize:e.commands[o].emphasize,icon:e.commands[o].icon},r=new t(i);return r.getContent().addEventListener("buttonclick",function(){n()}),r}function i(e,t){if(e.commands)for(var o=0;o<e.commands.length;o++){n(e,o).inject(t)}}for(var r in e){var a=this.commonCommand=UWA.createElement("div",{class:"content-placeholder-common-command"});i(e[r],a),o[r]=a,this.text[r]=e[r].text}return o},_getComponentToReplace:function(e){var t=this._getButtonComponents();if(null===t){var o=this._getOptions();t=this._buttonComponents=this._buildButtonComponents(o)}return s.isSearchActive()?(this._getText(this.text.search),t.search):"FolderSection_favorite"===e?(this._getText(this.text.favoriteSection),t.favoriteSection):"FolderSection_AllFolders"===e?widget.launchWithReadMode?(this._getText(this.text.bookmarkSection_Read),t.bookmarkSection_Read):(UWA.createElement("i",{class:"wux-ui-3ds  wux-ui-3ds-search content-placeholder-icon",styles:{color:"#b4b6ba","font-size":"72px"}}).inject(this.elements.icon),this._getText(this.text.bookmarkSection),t.bookmarkSection):widget.launchWithReadMode?(this._getText(this.text.bookmark_Read),t.bookmark_Read):(this._getText(this.text.bookmark),t.bookmark)},_getOptions:function(){return{favoriteSection:{text:a.get("placeholder_msg_favorite")},bookmarkSection:{text:a.get("placeholder_msg_section"),commands:[{name:" "+a.get("placeholder_CreateFolder"),icon:{iconName:"plus",fontIconFamily:WUXManagedFontIcons.Font3DS,fontIconSize:"0.5x"},emphasize:"primary",callback:function(){var e=n.getCommand("ActionBar_NewFolderCmd",r.getContent());l.switchtoAuthoringMode(),e&&e.begin()}}]},bookmarkSection_Read:{text:a.get("placeholder_msg_folder")},bookmark:{text:a.get("placeholder_msg_folder"),commands:[{name:a.get("placeholder_CMD_AddExisting"),emphasize:"primary",callback:function(){var e=n.getCommand("AddExistingContent",r.getContent());e&&e.begin()}},{name:a.get("placeholder_CMD_UploadFile"),emphasize:"secondary",callback:function(){var e=n.getCommand("AddFile",r.getContent());e&&e.begin()}}]},bookmark_Read:{text:a.get("placeholder_msg_folder")},search:{text:a.get("placeholder_msg_search")}}},_removeButtonComponent:function(){this.getContent().getElementsByClassName("content-placeholder-common-command")[0].remove(),this.elements.icon.getChildren().forEach(function(e){e.remove()})},_getText:function(e){this.getContent().getElementsByClassName("content-placeholder-description")[0].innerText=e},_getButtonComponents:function(){return this._buttonComponents}})}),define("DS/FolderEditor/service/FolderServices",["UWA/Core","DS/FolderEditor/Folder_CSO","DS/FolderEditor/service/FolderEditorWebService","DS/PADUtils/PADUtilsServices","DS/PADUtils/PADSettingsMgt","DS/DocumentManagement/DocumentManagement","DS/FolderEditor/service/FolderTypeService","DS/IPClassifyUtil/IPClassifyAlert","DS/FolderEditor/utils/FolderEditorcontrol","DS/DocumentCommands/ENOXDocumentCommands","DS/WidgetServices/WidgetServices","DS/ApplicationFrame/CommandsManager","DS/FolderUpload/FolderUpload","DS/FolderEditor/views/FolderMode","i18n!DS/FolderEditor/assets/nls/FolderEditor"],function(e,t,o,n,i,r,a,s,l,d,c,u,p,g,f){"use strict";var h=e.createElement("iframe",{name:"bookmarkdownloaderFrame",styles:{display:"none"}}),m=e.createElement("form",{method:"POST",enctype:"application/x-www-form-urlencoded",target:"bookmarkdownloaderFrame",html:[{tag:"input",value:"true",name:"attachment"}],styles:{display:"none"}});return{AddContent:function(e){if(e.IDs.length>0){var n,i=e.folder,r=(n=i||t.getCurrentFolder())?n.id||n.getID():"";r&&r.length?o.addcontent({pid:r,IDs:e.IDs,onComplete:function(t){var o=t?JSON.parse(t):void 0;if(o&&o.error){var n=o.error;console.log("AddContent WebService Err : "+n),n.length>200&&(n=null),o.information&&s.displayNotification({message:o.information,className:"primary"}),e.callbacks.onFailure(o.advice?o:n)}else g.switchtoAuthoringMode(),e.callbacks.onComplete(t)},onFailure:e.callbacks.onFailure}):e.callbacks.onFailure(e)}else e.callbacks.onFailure(e)},RemoveContent:function(e){if(g.switchtoAuthoringMode(),e.IDs.length>0){var n,i=e.folder,r=(n=i||t.getCurrentFolder())?n.id||n.getID():"";r&&r.length?o.removecontent({pid:r,IDs:e.IDs,onComplete:function(t){var o=t?JSON.parse(t):void 0;if(o&&o.error){var n=o.error;console.log("Remove WebService Err : "+n),n.length>200&&(n=null),e.callbacks.onFailure(n)}else e.callbacks.onComplete(t)},onFailure:e.callbacks.onFailure}):e.callbacks.onFailure(e)}else e.callbacks.onFailure(e)},RemoveContentSearchWithin:function(e){null!=e.objectID&&null!=e.objectID&&e.folderIDs.length>0?o.removecontentsearchwithin({objectID:e.objectID,folderIDs:e.folderIDs,onComplete:function(t){var o=t?JSON.parse(t):void 0;if(o&&o.error){var n=o.error;console.log("Remove WebService Err : "+n),n.length>200&&(n=null),e.callbacks.onFailure(n)}else e.callbacks.onComplete(t)},onFailure:e.callbacks.onFailure}):e.callbacks.onFailure(e)},MoveContent:function(e){if(g.switchtoAuthoringMode(),e.IDs.length>0){var n,i=e.targetfolder,r=e.sourcefolder;n=r||t.getCurrentFolder();var a=i?i.id||i.getID():"",s=n?n.id||i.getID():"";a&&a.length&&s&&s.length?o.movecontent({pid:a,IDs:e.IDs,SourceFolderId:s,onComplete:function(t){var o=t?JSON.parse(t):void 0;if(o&&o.error){var n=o.error;console.log("MoveContent WebService Err : "+n),n.length>200&&(n=null),e.callbacks.onFailure(n)}else e.callbacks.onComplete(t)},onFailure:e.callbacks.onFailure}):e.callbacks.onFailure(e)}else e.callbacks.onFailure(e)},MoveFolder:function(e){g.switchtoAuthoringMode();var t=e.targetfolder,n=e.sourcefolder,i=t?t.id:"";n&&n.id;i.length&&e.IDs.length?o.movefolder({PhysicalId:e.IDs,TargetPhysicalId:i,onComplete:function(t){var o=t?JSON.parse(t):void 0;if(o&&o.error){var n=o.error;console.log("MoveFolder WebService Err : "+n),n.length>200&&(n=null),e.callbacks.onFailure(o.advice?o:n)}else e.callbacks.onComplete(t)},onFailure:e.callbacks.onFailure}):e.callbacks.onFailure(e)},CheckCopyFolder:function(e){var t=e.sourcefolder,n=(t&&t.id,i.getSetting("pad_security_ctx"));e.IDs.length?o.checkCopyfolder({PhysicalId:e.IDs,SecurityContext:n,onComplete:function(t){parseInt(t)>200?e.callbacks.onFailure(t):e.callbacks.onComplete(t)},onFailure:e.callbacks.onFailure}):e.callbacks.onFailure(e)},isSourceAndTargetTypeSame:function(t,o){let n=!0;if(!t||!o)return n;if(e.is(t,"array")){if(!(t.length>0))return n;t=t[0]}return"Folder"===t.getType()&&"FolderSection_AllFolders"===o.getType()?n=!1:"RootFolder"===t.getType()&&"FolderSection_AllFolders"!==o.getType()&&(n=!1),n},CopyFolder:function(e){g.switchtoAuthoringMode();var t=e.targetfolder,n=e.sourcefolder,r=t?t.id:"";r||"FolderSection_AllFolders"!==t.plmType||(r="null");n&&n.id;var a=i.getSetting("pad_security_ctx");r.length&&e.IDs.length?o.copyfolder({PhysicalId:e.IDs,TargetPhysicalId:r,SecurityContext:a,withContent:e.withContent,onComplete:function(t){var o=t?JSON.parse(t):void 0;if(o&&o.error){var n=o.error;console.log("CopyFolder WebService Err : "+n),n.length>200&&(n=null),e.callbacks.onFailure(o.advice?o:n)}else e.callbacks.onComplete(t)},onFailure:e.callbacks.onFailure}):e.callbacks.onFailure(e)},downloadFiles:function(e){var t=n.get3DSpaceUrl(),o=i.getSetting("pad_security_ctx"),a=l.getContent().getSelectedNodes();require(["DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/Core/ModelEvents","DS/DocumentCommands/V2/Actions/Download"],function(e,n,l){e.getPlatformServices({platformId:c.getTenantID(),onComplete:function(e){r.getDocuments(a.map(e=>e.getID()),{tenant:c.getTenantID(),securityContext:o,tenantUrl:t,onComplete:function(t){if(t.success){if(!Array.isArray(t.data))return;var o={fetchSecurityContext:function(){return i.getSetting("pad_security_ctx")},getWorkUnderHeaders:function(){},getSelectedNodes:function(){return t.data},getDocumentFromNodeModel:function(e){return e},platformUrls:e,events:new n,isFromContextMenu:!0};o.events.subscribe({event:"docv2-show-notification"},function(e){var t={title:e.title,subtitle:e.subtitle,message:e.message,className:e.lable};s.displayNotification(t)});new l(o);l.execute({options:o})}}})},onFailure:function(e){console.log(e)}})})},previewFile:function(e){},EditFile:function(e){var t=n.get3DSpaceUrl(),o=widget.widgetDomain,a=i.getSetting("pad_security_ctx"),s=l.getContent().getSelectedNodes();g.switchtoAuthoringMode(),r.getDocuments([s[0].getID()],{tenant:c.getTenantID(),securityContext:a,tenantUrl:t,onComplete:function(n){if(n.success){if(!Array.isArray(n.data))return;var i={files:n.data[0].relateddata.files,title:n.data[0].dataelements.title},r={document:{id:s[0].getID(),contextId:a,serviceId:"3DSpace",envId:c.getTenantID(),index:1,data:i,type:n.data[0].type},platformUrls:{"3DSpace":t,"3DDashboard":o},onComplete:function(t){console.log("success"),e.onSuccess(t)}};0!=r.document.data.files.length&&""!=r.document.data.files[0].dataelements.locker,r.document.data.files.length>1&&!0;var l=new d,u=l.init(r);(u=u||Promise.resolve()).then(()=>{l.render().Edit.handler()})}}})},UpdateFile:function(e){g.switchtoAuthoringMode();var t=l.getContent().getSelectedNodes()[0],o=n.get3DSpaceUrl(),r=widget.widgetDomain,a=i.getSetting("pad_security_ctx"),s={files:[{dataelements:{locker:t.getAttribute("ds6w:reservedBy")}}]},u={document:{id:t.getID(),contextId:a,serviceId:"3DSpace",envId:c.getTenantID(),index:1,data:s,type:t.getAttribute("type")},platformUrls:{"3DSpace":o,"3DDashboard":r},onComplete:function(t){e.onSuccess(t)}},p=new d,f=p.init(u);(f=f||Promise.resolve()).then(()=>{p.render().Update.handler()})},UndoEditFile:function(e){var t=n.get3DSpaceUrl(),o=widget.widgetDomain,a=i.getSetting("pad_security_ctx"),s=l.getContent().getSelectedNodes();g.switchtoAuthoringMode(),r.getDocuments([s[0].getID()],{tenant:c.getTenantID(),securityContext:a,tenantUrl:t,onComplete:function(n){if(n.success){if(!Array.isArray(n.data))return;var i={files:n.data[0].relateddata.files,title:n.data[0].dataelements.title},r={document:{id:s[0].getID(),contextId:a,serviceId:"3DSpace",envId:c.getTenantID(),index:1,data:i,type:n.data[0].type},platformUrls:{"3DSpace":t,"3DDashboard":o},onComplete:function(t){console.log("success"),e.onSuccess(t)}};0!=r.document.data.files.length&&""!=r.document.data.files[0].dataelements.locker,r.document.data.files.length>1&&!0;var l=new d,u=l.init(r);(u=u||Promise.resolve()).then(()=>{l.render().UndoEdit.handler()})}}})},FolderUpload:function(e){var o=n.get3DSpaceUrl(),r=widget.widgetDomain,a=widget.getPreference("pad_security_ctx").value.split("."),s=a[a.length-1],d=e.id,g=e.lable,f=(e={fetchSecurityContext:function(){return i.getSetting("pad_security_ctx")},fetchCollabSpaceDisplayName:function(){return s},platformUrls:{"3DSpace":o,"3DDashboard":r,platformId:c.getTenantID()}},new p(e)),h=u.getCommand("FolderUpload");f.events.subscribe({event:"operation-complete"},function(e){require("DS/FolderEditor/views/FolderMode").switchtoAuthoringMode();var o=t.getCurrentFolder();e.parentId==o.id&&(l.getTreeCont().refreshFolderTreeAndContent(),console.log("After Completion of the Command..."))}),f.events.subscribe({event:"enable-folder-upload-command-in-ui"},function(e){h.enable()}),f.events.subscribe({event:"disable-folder-upload-command-in-ui"},function(e){h.disable()}),f.openFolderPicker(d,g)},FolderDownload:function(t){o.DownloadFolderStructure({pid:t.id,onComplete:function(t){var o=t?JSON.parse(t):void 0;if(o){if(o&&"success"==o.status){s.displayNotification({message:f.BookmarkDownload.BookmarkDownloadStarted,className:"success"});var n=(h.isInjected()||h.inject(document.body),m.isInjected()||m.inject(document.body),m.empty(),e.createElement("input",{name:"attachment",value:"true"}).inject(m),m);e.createElement("input",{name:o.ticketParamName,value:o.ticketExportStr}).inject(n),n.action=o.actionURL,n.submit()}if(o&&"failure"==o.status)if("LimitDocuments"==o.error)s.displayNotification({message:f.BookmarkDownload.BookmarkDownloadLimit,className:"warning"});else if("No_Documents"==o.error)s.displayNotification({message:f.BookmarkDownload.BookmarkNo_Documents,className:"warning"});else if("DocWithNOFileMultiFileFailure"==o.error){var i="";null!=o.msgMultiFile&&(i=f.BookmarkDownload.BookmarkDownloadMultiFileError+o.msgMultiFile),null!=o.msgNOFile&&(i+=f.BookmarkDownload.BookmarkDownloadNoFileError+o.msgNOFile),s.displayNotification({message:f.BookmarkDownload.DownloadStructureFailure+i,className:"error"})}else"DownloadStructureFailure"==o.error&&s.displayNotification({message:f.BookmarkDownload.DownloadStructureFailure,className:"error"})}}})},replaceContent:function(e){var n=e.IDsRemoved.length;if(n===e.IDsAdded.length&&n>0){var i,r=e.folder,a=(i=r||t.getCurrentFolder())?i.id||i.getID():"";a&&a.length?o.replaceContent({pid:a,IDsRemoved:e.IDsRemoved,IDsAdded:e.IDsAdded,onComplete:function(t){var o=t?JSON.parse(t):void 0;if(o&&o.error){var n=o.error;console.log("ReplaceContent WebService Err : "+n),n.length>200&&(n=null),o.information&&s.displayNotification({message:o.information,className:"primary"}),e.callbacks.onFailure(n)}else e.callbacks.onComplete(t)},onFailure:e.callbacks.onFailure}):e.callbacks.onFailure(e)}else e.callbacks.onFailure(e)},getlastversion:function(e){var t=e.objectsToTreat;o.getlastversion({objectsToTreat:t,onComplete:function(t){var o=t?JSON.parse(t):void 0;if(o&&o.error){var n=o.error;console.log("getlastversion WebService Err : "+n),n.length>200&&(n=null),o.information&&s.displayNotification({message:o.information,className:"primary"}),e.callbacks.onFailure(n)}else e.callbacks.onComplete(t)},onFailure:e.callbacks.onFailure})},activateFolderEditorItem:function(e,t,o){if(a.isFolder(t)?t="Folder":(a.isRootFolder(t)||a.isPersonalFolder(t))&&(t="RootFolder"),e&&a.inFamilyFolder(t)){var n=l.getTreeCont();n&&("read"==g.getCurrentModeType()&&(n.forceLoad=!0),n.expandTreeAndSelectFolder({folderToFindAndSelect:{ids:[e],type:t,name:o},partiallyExpandPath:!0,onComplete:function(e){console.log(" expandTreeAndSelectFolder:onComplete")},onGiveUp:function(e){console.log(" expandTreeAndSelectFolder:onGiveUp")},onFailure:function(e){s.displayNotification({title:f.replace(f.msg_error_FolderActivate.Title,{name1:o}),subtitle:f.msg_error_FolderActivate.Advice,className:"error"})}}))}else console.log("Selected (Double Clicked) object is not folder")}}}),define("DS/FolderEditor/views/additionalColumns/FolderIsLastRevisionColumn",["UWA/Core","UWA/Class","DS/FolderEditor/service/FolderServices","i18n!DS/FolderEditor/assets/nls/FolderEditor","DS/PADServices/utils/GlobalUtils","DS/FolderEditor/utils/FolderSearch","DS/ApplicationFrame/CommandsManager","DS/FolderEditor/utils/FolderEditorcontrol","DS/FolderEditor/Folder_CSO"],function(e,t,o,n,i,r,a,s,l){"use strict";var d=t.singleton({init:function(e){this._parent(e)},isAdditionalColumnsAvailable:function(t){if(!1===e.is(t,"function"))throw new Error("A callback function should be defined");!function(e){var t={dataIndex:"isLastRevision",text:n.column_isLastRevision,width:100,minWidth:80,maxWidth:200,isHidden:!1,sortableFlag:!1,alignment:"center",typeRepresentation:"functionIcon",getCellSemantics:function(e){var t=r.isSearchActive(),o=e.nodeModel,n="Folder"==o.plmType||"RootFolder"==o.plmType,i=t||o.getDepth()>0||n;return void 0!==typeof o.options.grid.isLastRevision&&o.options.grid.isLastRevision.toString().length>0&&!n?"true"==o.options.grid.isLastRevision.toString().toLowerCase()?{icon:{iconClasses:"check wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-check  dgv-lastversion-check"},disabled:i}:{icon:{iconClasses:"wrong wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-wrong dgv-lastversion-wrong"},disabled:i}:{disabled:!0}},customisation:{dataIndex:"isLastRevision",exportable:{lock:!1,value:!0},layout:{removable:!1}}};d._columnDataIndex=["isLastRevision"],d._columnDef={isLastRevision:t},e()}(function(){t(!0)})},getName:function(){return"isLastRevision"},getManagedColumnNames:function(){return this._columnDataIndex},toBeUpdated:function(e,t){var o=!1;if("Folder"!==t.plmType&&"RootFolder"!==t.plmType)return void 0!==e.isLastRevision&&""!==e.isLastRevision||(o=!0),o},getOnCellClickCB:function(e,t){return!(e!==this.getName()||!t.target.className.contains("wux-button-icon-placeholder")&&!t.target.className.contains("wux-tweaker-function"))&&function(e){if(!r.isSearchActive()){var t=e.nodeModel;if(t.getDepth()<1&&"Folder"!==t.plmType&&"RootFolder"!==t.plmType){var o=a.getCommand("UPSAuthReplaceByRevision",s.getContent());o.setNode(t),o&&o.begin()}}}},updateAttributes:function(t,n){if(!1===e.is(t,"object"))throw new Error("The object ids to modify must be specify");if(!1===e.is(n,"function"))throw new Error("A callback function should be defined");var i=[];t.pids.forEach(function(e){var t={id:e};i.push(t)});var r={},a={lastVersionRequests:i};o.getlastversion({objectsToTreat:a,callbacks:{onComplete:function(e){JSON.parse(e).lastVersionRequests.forEach(function(e){var t=e.islast;r[e.id]={isLastRevision:t}});var t={pids:r};t=JSON.stringify(t),n(t)},onFailure:function(e){n({})}}})},getAdditionalColumnsUXDGV:function(t){for(var o=[],n=0;n<t.length;n++)o.push(t[n].dataIndex);for(var i=0;i<this._columnDataIndex.length;i++){var r=this._columnDataIndex[i],a=e.clone(this._columnDef[r]),s=o.indexOf(r);-1===s?t.push(a):t[s]=e.extend(t[s],a,!0)}}});return d}),define("DS/FolderEditor/views/FolderThumbnailView",["UWA/Controls/Abstract","UWA/Core","UWA/Class/Options","UWA/Class/Events","DS/CollectionView/ResponsiveThumbnailsCollectionView","DS/ApplicationFrame/CommandsManager","DS/FolderEditor/service/FolderServices","DS/FolderEditor/utils/FolderEditorcontrol","i18n!DS/FolderEditor/assets/nls/FolderEditor"],function(e,t,o,n,i,r,a,s,l){"use strict";return e.extend(o,n,{name:"xBookResponsiveThumbnailView",defaultOptions:{grid:null,model:null},init:function(e){this._parent(e),this.options=UWA.extend(this.options,e,!0),this.elements.container=UWA.createElement("div",{class:this.getClassNames()});var t=UWA.extend(e,{height:"inherit",displayedOptionalCellProperties:["contextualMenu","statusbarIcons","activeFlag"],useDragAndDrop:!0,allowUnsafeHTMLContent:!1,selectionBehavior:{canMultiSelect:this.options.multiselection}},!0);t.onDelayedModelDataRequest=this.options.context.updateAttributesDelayed.bind(this.options.context);var o=this.options.grid=new i(t);e.onContextualEvent&&(o.onContextualEvent=e.onContextualEvent),this._originalApplyAttributes=o._applyAttributesOnCell.bind(o),o._applyAttributesOnCell=this._applyAttributesOnCell.bind(this),o.getContent().inject(this.elements.container),this.getOption("renderTo")&&!0===e.isActiveView&&this.elements.container.inject(this.getOption("renderTo")),o.onCellsCopy(function(e){r.getCommand("Copy").begin()}),o.onCellsPaste(function(e){r.getCommand("Paste").begin()}),o.onCellsCut(function(e){r.getCommand("Cut").begin()}),o.selectionBehavior=UWA.extend({enableFeedbackForActiveCell:!0},o.selectionBehavior),o.onPostCellRequest(function(e){e.nodeModel&&e.nodeModel.options.isBeingCut?e.cellView.getContent().addClassName("pad-state-is-being-cut"):e.cellView.getContent().removeClassName("pad-state-is-being-cut")}),o.onInfiniteScroll(function(e){s.getContent().processForInfiniteScroll(e,o)}),o.getCustomTooltip=function(e){return l.ViewTooltip["ds6w:label"]+": "+e.options.grid.label+"\n"+l.ViewTooltip["ds6w:type"]+": "+e.options.grid["ds6w:type"]+"\n"+l.ViewTooltip["ds6wg:revision"]+": "+e.options.grid["ds6wg:revision"]+"\n"+l.ViewTooltip["ds6w:status"]+": "+e.options.grid["ds6w:status"]+"\n"+l.ViewTooltip["ds6w:responsible"]+": "+e.options.grid["ds6w:responsible"]+"\n"+l.ViewTooltip["ds6w:modified"]+": "+e.options.grid["ds6w:modified"]+"\n"+l.ViewTooltip["ds6w:project"]+": "+e.options.grid["ds6w:project"]+"\n"+l.ViewTooltip["ds6w:identifier"]+": "+e.options.grid["ds6w:identifier"]},UWA.is(this.options.grid.onCellDoubleClick,"function")&&this.options.grid.onCellDoubleClick(function(e){var t=e.nodeModel;a.activateFolderEditorItem(t.options.resourceid,t.options.type,t.options.label)})},setModel:function(e){this.options.model=e,this.options.grid.loadGridViewModel(e),this.elements.container.inject(this.getOption("renderTo")),this.options.isActiveView=!0,this.options.grid.layout.invalidate(),null!==e.options.viewport.thumbnails&&void 0!==e.options.viewport.thumbnails&&this.options.grid.setScrollerPosition(e.options.viewport.thumbnails)},unsetModel:function(){this.getScrollerPosition&&(this.options.model.options.viewport.thumbnails=this.getScrollerPosition()),this.getOption("renderTo").removeChild(this.elements.container),this.options.isActiveView=!1,this.options.grid.unloadGridViewModel()},updateView:function(){this.options.grid.layout.invalidate({updateCellContent:!0})},_applyAttributesOnCell:function(e){var t=e;void 0===e.nodeModel&&(t.nodeModel=this.options.grid._getModelAt(e.cellID),t.cellView=this.options.grid._getViewAt(e.cellID)),t.nodeModel.options.isBeingCut?t.cellView.getContent().addClassName("pad-state-is-being-cut"):t.cellView.getContent().removeClassName("pad-state-is-being-cut"),this._originalApplyAttributes(e)}})}),define("DS/FolderEditor/views/FolderTileView",["UWA/Controls/Abstract","UWA/Core","UWA/Class/Options","UWA/Class/Events","DS/FolderEditor/service/FolderServices","DS/ApplicationFrame/CommandsManager","DS/CollectionView/ResponsiveTilesCollectionView","DS/FolderEditor/utils/FolderEditorcontrol","i18n!DS/FolderEditor/assets/nls/FolderEditor"],function(e,t,o,n,i,r,a,s,l){"use strict";return e.extend(o,n,{name:"xBookResponsiveTileView",defaultOptions:{grid:null,model:null},init:function(e){this._parent(e),this.options=UWA.extend(this.options,e,!0),this.elements.container=UWA.createElement("div",{class:this.getClassNames()});var t=UWA.extend(e,{height:"inherit",displayedOptionalCellProperties:["contextualMenu","statusbarIcons","activeFlag"],useDragAndDrop:!0,allowUnsafeHTMLContent:!1,selectionBehavior:{canMultiSelect:this.options.multiselection}},!0);t.onDelayedModelDataRequest=this.options.context.updateAttributesDelayed.bind(this.options.context);var o=this.options.grid=new a(t);e.onContextualEvent&&(o.onContextualEvent=e.onContextualEvent),o.getContent().inject(this.elements.container),this.getOption("renderTo")&&!0===e.isActiveView&&this.elements.container.inject(this.getOption("renderTo")),o.onCellsCopy(function(e){r.getCommand("Copy").begin()}),o.onCellsPaste(function(e){r.getCommand("Paste").begin()}),o.onCellsCut(function(e){r.getCommand("Cut").begin()}),o.selectionBehavior=UWA.extend({enableFeedbackForActiveCell:!0},o.selectionBehavior),o.onPostCellRequest(function(e){e.nodeModel&&e.nodeModel.options.isBeingCut?e.cellView.getContent().addClassName("pad-state-is-being-cut"):e.cellView.getContent().removeClassName("pad-state-is-being-cut")}),o.onInfiniteScroll(function(e){s.getContent().processForInfiniteScroll(e,o)}),o.getCustomTooltip=function(e){return l.ViewTooltip["ds6w:label"]+": "+e.options.grid.label+"\n"+l.ViewTooltip["ds6w:type"]+": "+e.options.grid["ds6w:type"]+"\n"+l.ViewTooltip["ds6wg:revision"]+": "+e.options.grid["ds6wg:revision"]+"\n"+l.ViewTooltip["ds6w:status"]+": "+e.options.grid["ds6w:status"]+"\n"+l.ViewTooltip["ds6w:responsible"]+": "+e.options.grid["ds6w:responsible"]+"\n"+l.ViewTooltip["ds6w:modified"]+": "+e.options.grid["ds6w:modified"]+"\n"+l.ViewTooltip["ds6w:project"]+": "+e.options.grid["ds6w:project"]+"\n"+l.ViewTooltip["ds6w:identifier"]+": "+e.options.grid["ds6w:identifier"]},UWA.is(this.options.grid.onCellDoubleClick,"function")&&this.options.grid.onCellDoubleClick(function(e){var t=e.nodeModel;i.activateFolderEditorItem(t.options.resourceid,t.options.type,t.options.label)})},setModel:function(e){this.options.model=e,this.options.grid.loadGridViewModel(e),this.elements.container.inject(this.getOption("renderTo")),this.options.isActiveView=!0,this.options.grid.layout.invalidate(),null!==e.options.viewport.thumbnails&&void 0!==e.options.viewport.thumbnails&&this.options.grid.setScrollerPosition(e.options.viewport.thumbnails)},unsetModel:function(){this.getScrollerPosition&&(this.options.model.options.viewport.thumbnails=this.getScrollerPosition()),this.getOption("renderTo").removeChild(this.elements.container),this.options.isActiveView=!1,this.options.grid.unloadGridViewModel()},updateView:function(){this.options.grid.layout.invalidate({updateCellContent:!0})}})}),define("DS/FolderEditor/service/FolderEditorWebServiceReadMode",["UWA/Core","DS/WAFData/WAFData","i18n!DS/FolderEditor/assets/nls/FolderEditor","DS/PADUtils/PADSettingsMgt","DS/PADUtils/PADUtilsServices","DS/WidgetServices/WidgetServices","DS/FolderEditor/utils/FolderSearch","DS/FolderEditor/utils/FolderEditorcontrol","DS/PADServices/utils/GlobalUtils","DS/FolderEditor/service/FolderEditorWebService","DS/IPClassifyUtil/IPClassifyUtility","UWA/Utils/Client","UWA/Core"],function(e,t,o,n,i,r,a,s,l,d,c,u,p){"use strict";var g=function(e){var t="TREE"==e?s.getTreeCont():s.getContent();if(t){var o=t.getGridViewRowHeight(),n=t.getContentHeight();if(o&&n)return Math.ceil(n/o)+10}return 25},f=function(){var e=null;if(s.getContent()&&s.getContent().getPADTreeListView()){var t=s.getContent().getPADTreeListView().options.dgv.sortModel;t&&t.length>0&&(e={sort:t[0].sort,dataIndex:"tree"===t[0].dataIndex||"defaultSort"===t[0].dataIndex?"ds6w:label":t[0].dataIndex})}return e};return p.extend(d,{getContentReadMode:function(e){var t={};p.extend(t,e);var o=i.get3DSearchUrl()+"/search";t.payload={},t.payload.query="All"==e.content?"NOT(physicalid:"+e.pid+")":"NOT(physicalid:"+e.pid+') AND NOT(type == "Workspace Vault")',e.exceptIds&&e.exceptIds.length>0&&(t.payload.query+=" AND NOT(physicalid:"+e.exceptIds.join(") AND NOT(physicalid:")+")");var r=new Date,s=Math.random().toString(36).substring(2,9);if(t.payload.label=("Folder_getContentReadMode"+s+"_"+r.getTime()).replace(new RegExp(" ","g"),"_").replace(new RegExp(",","g"),"").replace(new RegExp("/","g"),"-"),!0!==t.synthesis){t.payload.select_predicate=a.getIndexPredicates(),t.payload.with_synthesis="false",null!==e.next_start?t.payload.next_start=e.next_start:t.payload.start=0,t.payload.nresults=g(),t.payload.select_file=["icon","thumbnail_2d"];var l=f();l&&(t.payload.order_by=l.sort,t.payload.order_field=l.dataIndex)}else t.payload.label="tags_"+t.payload.label;var d=widget.lang?widget.lang:widget.getValue("lang");return t.filters&&Object.keys(t.filters).length>0&&(t.payload.refine=t.filters),t.payload.specific_source_parameter={"3dspace":{option:{with_Idx_Search:!0},search_in_context:{expand:{root_physicalid:e.pid,expand_iter:"1"}}}},t.payload.locale=d,t.payload.tenant=i.getPlatformId(),t.payload.source=["3dspace"],t.payload.with_Idx_Search="true",t.payload.with_indexing_date="false",t.payload.login={"3dspace":{SecurityContext:n.getSetting("pad_security_ctx")}},t.headers={"content-type":"application/json"},t.data=p.Json.encode(t.payload),t.method="POST",t.timeout=12e4,this._executeRequest(o,t,"getContentReadMode")},getRoots:function(e){var t={};p.extend(t,e);var o=i.get3DSearchUrl()+"/search";t.payload={},t.payload.select_predicate=["ds6w:label","physicalid","mxid","ds6w:type","ds6w:classification","icon_2ddefaultthb.subtype","ds6w:status","ds6w:description","ds6w:responsible","ds6w:modified","ds6w:created","ds6w:identifier","ds6w:reservedBy","flattenedtaxonomies"];var r=new Date,l=Math.random().toString(36).substring(2,9);if(t.payload.label=("Folder_read_getRoots"+l+"_"+r.getTime()).replace(new RegExp(" ","g"),"_").replace(new RegExp(",","g"),"").replace(new RegExp("/","g"),"-"),!0!==t.synthesis){if(e.contentView){var d=f();!0!==t.synthesis&&(t.payload.with_synthesis="false"),d&&(t.payload.order_by=d.sort,t.payload.order_field=d.dataIndex),t.payload.select_predicate=a.getIndexPredicates(),e.next_start?t.payload.next_start=e.next_start:t.payload.start=0,t.payload.nresults=g()}else{var c=s.getTreeCont()._folders_SortElmt;t.payload.order_by=c.sortOrder,t.payload.order_field="alpha"==c.sortMode?"ds6w:label":"ds6w:modified";var u=s.getTreeCont()._indexModeforReadData.getNextStart();t.payload.start=u,t.payload.nresults=g("TREE")}t.payload.select_file=["icon","thumbnail_2d"]}else t.payload.label="tags_"+t.payload.label;t.filters&&Object.keys(t.filters).length>0&&(t.payload.refine=t.filters),t.payload.query='flattenedtaxonomies:"types/Workspace"',e.exceptIds&&e.exceptIds.length>0&&(t.payload.query+=" AND NOT(physicalid:"+e.exceptIds.join(") AND NOT(physicalid:")+")");var h=widget.lang?widget.lang:widget.getValue("lang");return t.payload.locale=h,t.payload.tenant=i.getPlatformId(),t.payload.source=["3dspace"],t.payload.indexmode="true",t.payload.login={"3dspace":{SecurityContext:n.getSetting("pad_security_ctx")}},t.headers={"content-type":"application/json"},t.data=p.Json.encode(t.payload),t.method="POST",t.timeout=12e4,this._executeRequest(o,t,"Folder_read_getRoots")},expandFolder:function(e){var t={},o=i.get3DSpaceUrl()+"/cvservlet/expand?SecurityContext="+n.getSetting("pad_security_ctx");t={};p.extend(t,e);var r=new Date,l=Math.random().toString(36).substr(2,9);t.payload={},t.payload.label=("FolderWidgetSearch_"+l+"_"+r.getTime()).replace(new RegExp(" ","g"),"_").replace(new RegExp(",","g"),"").replace(new RegExp("/","g"),"-"),t.payload.select_bo=a.getIndexPredicates(),t.payload.expand_iter=t.level.toString(),t.payload["3dspace"]=["3dspace"];var d=s.getTreeCont()._folders_SortElmt;t.payload.order_by=d.sortOrder,t.payload.order_field="alpha"==d.sortMode?"ds6w:label":"ds6w:modified",t.payload.multi_root_physicalid=t.multi_root_physicalid,t.payload["q.iterative_filter_query_bo"]='flattenedtaxonomies:"types/Workspace Vault"';var c=widget.lang?widget.lang:widget.getValue("lang");return t.payload.locale=c,t.payload.tenant=i.getPlatformId(),t.headers={"content-type":"application/json"},t.headers={SecurityContext:n.getSetting("pad_security_ctx"),"content-type":"application/json"},t.data=p.Json.encode(t.payload),t.method="POST",t.timeout=12e4,this._executeRequest(o,t,"getRoots")},getFolderPathsforItems:function(e){var t={};if(p.extend(t,e),!p.is(t,"object"))throw new Error("Invalid inputs for FolderEditorWebService.getFolderPathsforItems");var o=i.get3DSpaceUrl()+"/cvservlet/navigate",r=widget.lang?widget.lang:widget.getValue("lang");t.payload={},t.payload.locale=r,t.payload.tenant=i.getPlatformId(),t.query={SecurityContext:n.getSetting("pad_security_ctx"),tenant:i.getPlatformId()},t.payload.input_physical_ids=e.ids,t.payload.attributes=a.getIndexPredicates(),t.payload.version=3,t.payload.primitives=[{navigate_from_rel:{id:1,filter:{bo_type:["Workspace","Workspace Vault","Personal Workspace"]}}}],t.payload.patterns={GET_PARENT:[{id:1,iter:-1}]},t.payload.patternFlags={GET_PARENT:{flags:["returnPaths"]}},t.payload.source=["3dspace"];var s=new Date;return t.payload.label=("bookmarkWidgetNavigate_"+s.getTime()).replace(new RegExp(" ","g"),"_").replace(new RegExp(",","g"),"").replace(new RegExp("/","g"),"-"),t.timeout=12e4,t.payload.start=0,t.method="POST",t.headers={Accept:"application/json","content-type":"application/json","Accept-Language":r},t.type="json",t.data=p.Json.encode(t.payload),this._executeRequest(o,t,"getFolderPathsforItems")},listContent_ExpandLevel_1:function(e){var t={},o=i.get3DSpaceUrl()+"/cvservlet/expand?SecurityContext="+n.getSetting("pad_security_ctx");t={};p.extend(t,e);var r=new Date,s=Math.random().toString(36).substr(2,9);t.payload={},t.payload.label=("listContent_ExpandLevel_1"+s+"_"+r.getTime()).replace(new RegExp(" ","g"),"_").replace(new RegExp(",","g"),"").replace(new RegExp("/","g"),"-"),t.payload.select_bo=a.getIndexPredicates(),t.payload.compute_select_bo=["icon","thumbnail_2d"],e.content||(t.payload.no_type_filter_bo=["Workspace","Workspace Vault"]),t.payload.expand_iter="1",t.payload["3dspace"]=["3dspace"];var l=require("DS/FolderEditor/utils/FolderEditorUtil").getContentSortmodel();if(l&&l.length>0){var d=l[0].dataIndex;"defaultSort"==d&&(d="ds6w:modified"),t.payload.order_by=l[0].sort,t.payload.order_field="tree"==d?"ds6w:label":d}t.payload.root_physicalid=t.pid;var c=widget.lang?widget.lang:widget.getValue("lang");return t.payload.locale=c,t.payload.tenant=i.getPlatformId(),t.headers={SecurityContext:n.getSetting("pad_security_ctx"),"content-type":"application/json"},t.data=p.Json.encode(t.payload),t.method="POST",t.timeout=12e4,this._executeRequest(o,t,"getRoots")},filterFolder:function(e){if(!p.is(e,"object"))throw new Error("Invalid inputs for FolderEditorWebService.content");var t={};p.extend(t,e);var o,n=i.get3DSpaceUrl()+"/resources/v1/FolderManagement/Folder/"+t.pid+"/filterFolder";return t.data={IDs:(o=t.prd,p.is(o,"array")?o.toString():o)},t.headers={"content-type":"application/json"},t.data=p.Json.encode(t.data),t.method="POST",t.timeout=12e4,this._executeRequest(n,t,"filterFolder")}})}),define("DS/FolderEditor/popup/BookmarkLocationPopup",["UWA/Controls/Abstract","DS/Controls/Toggle","DS/Controls/ButtonGroup","DS/Controls/Button","DS/Windows/Dialog","DS/FolderEditor/utils/FolderEditorcontrol","DS/FolderEditor/Folder_CSO","DS/WidgetServices/WidgetServices","DS/IPClassifyUtil/IPClassifyAlert","i18n!DS/FolderEditor/assets/nls/BookmarkLocationPopup","DS/Controls/TooltipModel","DS/FolderEditor/views/FolderMode","DS/Tree/TreeListView","DS/Tree/TreeDocument","DS/Tree/TreeNodeModel"],function(e,t,o,n,i,r,a,s,l,d,c,u,p,g,f){return e.extend({modal:null,onResize:function(){null!=this.ARWidget&&this.ARWidget.onResize()},init:function(e,s,l){this.elementsList=[],l=null!=l?l:{};var u=a.getCurrentSelection()[0].getLabel(),p=a.getCurrentFolder().getID(),g=null,f=UWA.createElement("div",{class:"bookmark_Open_Location-common-command"}),h=UWA.createElement("div",{class:"bookmark_Open_Location-common-command-div"});if(h.innerText=l.message,h.inject(f),l.radio)var m=new o({type:"radio"}),v=!0;else var _=UWA.createElement("ul",{class:"list-location-popup"});for(var C=null,S=null,F=0;F<e.length;F++)if(S=s(C=e[F].fullPath.join(" > ")),l.radio){v=!1,0===F&&(v=!0,g=e[0].idToNavigate);var y=new t({type:"radio",value:e[F].idToNavigate,checkFlag:v});S.inject(y.getContent()),y.tooltipInfos=new c({longHelp:C}),m.addChild(y),m.addEventListener("change",function(e){var t=e.dsModel.value;g=t[0]}),m.inject(f)}else{var D=UWA.createElement("div",{class:""}),b=UWA.createElement("li",{class:"list-element-location-popup"});b.tooltipInfos=new c({longHelp:C}),S.inject(D),D.inject(b),this.elementsList.push(D),b.inject(_),_.inject(f)}var E=l.title?l.title:d.OpenLocation+" : "+u;this.dialog=new i({title:E,content:f,immersiveFrame:widget.immersiveFrame,minHeight:150,minWidth:400,modalFlag:!0,width:r.getContent().getComponentWidth()-130,resizableFlag:!0,buttons:{Ok:new n({label:l.okButtonLabel?l.okButtonLabel:"",disabled:!1,emphasize:"primary",onClick:function(t){t.dsModel.dialog.buttons.Ok.disabled=!0,l.onOkClick&&l.onOkClick({selectPathIDToNav:g,currNodeID:p,data:e})}}),Cancel:new n({emphasize:"secondary",onClick:function(e){e.dsModel.dialog.destroy()}})}}),this.dialog.getContent().addClassName("bookmark_Open_Location"),this.dialog.addEventListener("close",function(e){console.log("Close on dialog : "+e.dsModel.title),e.dsModel=null})},_selectBookmarkInTree:function(e,t){u.switchtoAuthoringMode();var o=r.getTreeCont();r.getContent().nodeToSelectID=a.getCurrentSelection()[0].getID(),o.expandTreeAndSelectFolder({doNotSelectInTree:t,folderToFindAndSelect:{ids:[e.id],type:e.type,name:e.name},onComplete:function(e){console.log(" expandTreeAndSelectFolder:onComplete")},onFailure:function(t){l.displayNotification({message:d.replace(d.get("msg_error_BookmarkLocation"),{name1:e.name}),className:"error"})}})},pushNotif:function(e){e.length!=this.elementsList.length&&console.log("/!\\ nb of notifs and nb of elements not equal.");for(var t=null,o=null,n=null,i=0;i<this.elementsList.length;i++)null!=e[i]&&(n=UWA.createElement("div"),"success"==e[i]&&(t=UWA.createElement("span",{class:"notif-element-location-popup green-notif",text:d.removeFromSearchNotif.success}),o=UWA.createElement("i",{class:"wux-ui-3ds-check wux-ui-3ds icon-notif-element-location-popup green-notif"})),"noChangeAllowed"==e[i]&&(t=UWA.createElement("span",{class:"notif-element-location-popup red-notif",text:d.removeFromSearchNotif.failNotAllowed}),o=UWA.createElement("i",{class:"wux-ui-3ds-alert wux-ui-3ds icon-notif-element-location-popup red-notif"})),"noRelationFound"==e[i]&&(t=UWA.createElement("span",{class:"notif-element-location-popup red-notif",text:d.removeFromSearchNotif.failNoRelationFound}),o=UWA.createElement("i",{class:"wux-ui-3ds-alert wux-ui-3ds icon-notif-element-location-popup red-notif"})),o.inject(t,"top"),t.inject(n),n.inject(this.elementsList[i]))}})}),define("DS/FolderEditor/utils/BookmarkLocationUtil",["UWA/Core","UWA/Utils","UWA/Class","DS/FolderEditor/service/FolderEditorWebService","DS/FolderEditor/Folder_CSO","DS/FolderEditor/popup/BookmarkLocationPopup","DS/FolderEditor/utils/FolderEditorcontrol","DS/IPClassifyUtil/IPClassifyAlert","i18n!DS/FolderEditor/assets/nls/BookmarkLocationPopup","DS/Utilities/Dom","DS/FolderEditor/utils/FolderSearch","DS/FolderEditor/utils/FolderLoaderGlobal","DS/FolderEditor/views/FolderMode"],function(e,t,o,n,i,r,a,s,l,d,c,u,p){"use strict";return o.singleton({getFolderPathsforItem:function(e){var t=this;return new Promise(function(o,a){n.getFolderPathsforItem({id:[e.id],onComplete:function(e){if(e.result.length>0){var n=i.getCurrentFolder().getID();if(e.result[0].outputs.GET_PARENT){var a=e.result[0].outputs.GET_PARENT,d=e.result[0].outputs.GET_PARENT[0].paths[0][1];if(1===a.length)if(1===a[0].paths.length){var u=t._CalculatePath(e,n),p=u[0].ids.length;if(1==u.length)if(p>2){var g={id:d.physicalid,type:d["ds6w:type"],name:d["ds6w:label"]},f=!1;n===u[0].idToNavigate&&(f=!0),t._selectBookmarkInTree(g,f)}else{g={id:a[0].physicalid,type:a[0]["ds6w:type"],name:a[0]["ds6w:label"]},f=!1;n===u[0].idToNavigate&&(f=!0),t._selectBookmarkInTree(g,f);var h=c.isSearchActive();console.log("statue of search: "+h)}}else{var m=t._CalculatePath(e,n);if(1==m.length){g={id:m[0].idToNavigate,type:m[0].type,name:m[0].name},f=!1;n===m[0].idToNavigate&&(f=!0),t._selectBookmarkInTree(g,f)}else{var v={message:l.OpenLocationPopupLable,radio:!0,okButtonLabel:l.Open,onOkClick:function(e){t.locationPopop.dialog.close();for(var o={id:null,type:null,name:null},n=0;n<e.data.length;n++)if(e.selectPathIDToNav===e.data[n].idToNavigate){o.id=e.data[n].idToNavigate,o.name=e.data[n].name,o.type=e.data[n].type;break}var i=!1;e.selectPathIDToNav===e.currNodeID&&(i=!0),t._selectBookmarkInTree(o,i)}},_=new r(m,t.getHtmlElemFromPath.bind(t),v);t.locationPopop=_}}else{var C=t._CalculatePath(e,n);if(1===C.length){g={id:C[0].idToNavigate,type:C[0].type,name:C[0].name},f=!1;n===C[0].idToNavigate&&(f=!0),t._selectBookmarkInTree(g,f)}else{v={message:l.OpenLocationPopupLable,radio:!0,okButtonLabel:l.Open,onOkClick:function(e){t.locationPopop.dialog.close();for(var o={id:null,type:null,name:null},n=0;n<e.data.length;n++)if(e.selectPathIDToNav===e.data[n].idToNavigate){o.id=e.data[n].idToNavigate,o.name=e.data[n].name,o.type=e.data[n].type;break}var i=!1;e.selectPathIDToNav===e.currNodeID&&(i=!0),t._selectBookmarkInTree(o,i)}},_=new r(C,t.getHtmlElemFromPath.bind(t),v);t.locationPopop=_}}}else if("Workspace"===e.result[0].input_object["ds6w:type"]){var S=e.result[0].input_object;if("FolderSection_AllFolders"===n||S.physicalid===n){var F={id:S.physicalid,type:S["ds6w:type"],name:S["ds6w:label"]};f=n===S.physicalid;t._selectRootBookmarkInTree(F,f)}}else s.displayNotification({message:l.msg_error_BM_LOC_InValid_Object,className:"error"})}else s.displayNotification({message:l.msg_error_BM_LOC_InValid_Object,className:"error"});o()},onFailure:function(e,t,o){a(e,t,o)}})})},getResizedText:function(e,t,o,n){function i(e,t){if(e>=t.length)return t;e-="...".length;let o=t.split(">"),n=-1,i=(o=o.filter(e=>"..."!==e)).length-1,r=0;for(;n<i;){if(!(r+o[i].length+">".length<e)){++i;break}if(r+=o[i].length+">".length,--i,!(r+o[n+1].length+">".length<e)){++i;break}r+=o[++n].length+">".length}let a="";for(let e=0;e<=n;++e)a+=o[e]+">";if(a+="...",o.length-i<=1&&n<0)(a+=">"+o[o.length-1]).length>e&&(a=a.substring(0,e-"...".length)+"...");else for(let e=i;e<o.length;++e)a+=">"+o[e];return a}let r=e/t,a=Math.floor(n.length*r);if(o.indexOf(":")>=0){if(a>o.length)return o;let e="...";return e+o.substring(o.length+e.length-a,o.length)}if(-1===o.indexOf(">")){if(a>o.length)return o;let e="...";return o.substring(0,a-e.length)+e}return i(a,e>=t?o:n)},getHtmlElemFromPath:function(e,t){var o=this,n=UWA.createElement("span",{class:"bk-ellipsys-root",titlex:e}),i=UWA.createElement("span",{class:"bk-ellipsys-child"});return i.innerText=e,i.inject(n),!0!==t?(n._prevWidth=0,n.addEvent("resize",function(e){let t=this.getDimensions().width;this._prevWidth!=t&&(this._prevWidth=t,this.childNodes&&this.childNodes.length>0&&this.childNodes[0].getDimensions&&(this.childNodes[0].innerText=o.getResizedText(e.target.clientWidth,this.childNodes[0].getDimensions().width,this.getAttribute("titlex"),this.childNodes[0].innerText)))})):n.computeContentSize=function(){let e=0,t=a.getContent();if(t&&t.getPADTreeListView()){var o=t.getPADTreeListView().getFontDetails();if(o){var n=o.fontSize,i=o.fontSytle;e=Math.ceil(d.computeStringWidth(this.title,n,i,!1,!1))}}return e},n.setData=function(e){this.setAttribute("titlex",e),this.childNodes&&this.childNodes.length>0&&(this.childNodes[0].innerText=e)},n},_CalculatePath:function(e,t){for(var o=e.result[0].outputs.GET_PARENT,n=[],i={lable:null,physicalid:null,type:null},r=0;r<o.length;r++){var a=o[r].paths;i.lable=o[r]["ds6w:label"],i.physicalid=o[r].physicalid,i.type=o[r]["ds6w:type"];for(var s=0;s<a.length;s++){var l=a[s],d={type:null,name:null,idToNavigate:null,fullPath:[],ids:[]};d.fullPath.push(i.lable),d.ids.push(i.physicalid);for(var c=l.length-1;c>=0;c--){var u=l[c];"Workspace"!==u["ds6w:type"]&&"Workspace Vault"!==u["ds6w:type"]||(d.idToNavigate=u.physicalid,d.type=u["ds6w:type"],d.name=u["ds6w:label"],d.fullPath.push(u["ds6w:label"])),d.ids.push(u.physicalid)}null===d.idToNavigate&&(d.idToNavigate=i.physicalid,d.type=i.type,d.name=i.label),("FolderSection_AllFolders"===t||d.ids.includes(t))&&n.push(d)}}return n},getImmediateParents:function(e){for(var t,o,n=[],i={},r=0;r<e.length;r++)t=e[r].idToNavigate,o=e[r].name,n.push(t),i[t]=o;return[n,i]},_selectBookmarkInTree:function(e,t){var o=a.getTreeCont();o._rootNodeFolders;a.getContent().nodeToSelectID=i.getCurrentSelection()[0].getID(),i.getCurrentFolder().getID()!==e.id?(p.switchtoAuthoringMode(),u.addComponentsToLoad("global",{content:""}),o.expandTreeAndSelectFolder({doNotSelectInTree:t,folderToFindAndSelect:{ids:[e.id],type:e.type,name:e.name},onComplete:function(e){u.removeComponentToLoad("global","content"),console.log(" expandTreeAndSelectFolder:onComplete"),u.removeComponentToLoad("contentView","content")},onFailure:function(t){s.displayNotification({title:l.replace(l.msg_error_FolderActivate.Title,{name1:e.name}),subtitle:l.msg_error_FolderActivate.Advice,className:"error"})}})):c.isSearchActive()&&c.clearSearch()},_selectRootBookmarkInTree:function(e,t){p.switchtoAuthoringMode();a.getTreeCont();a.getContent().nodeToSelectID=i.getCurrentSelection()[0].getID(),c.isSearchActive()&&c.clearSearch(),u.removeComponentToLoad("contentView","content"),a.getContent().loadContentAndSelect(void 0,[e.id])}})}),define("DS/FolderEditor/PersonalFolderManager",["DS/FolderEditor/service/FolderEditorWebService","DS/WebappsUtils/WebappsUtils","DS/FolderEditor/service/FolderTypeService"],function(e,t,o){"use strict";var n=void 0,i=!1;function r(e){void 0!==e&&(n=e)}return{getPersonalFolder:function(){return n},isInitialized:function(){return!0===i},resetToPreInitializedState:function(){n=void 0,i=!1},getPersonalRootFolderInFavoriteFormat:function(){return(e=n)?{id:e.id,name:e.name,type:e.type,isPersonal:e.isPersonal}:void 0;var e},isPersonalFolderToBeKept:function(e){var t=!1;return e&&(o.isPersonalFolder(e.type)||o.isRootFolder(e.type)&&e.isPersonal)&&(t=!0),t},setupPersonalFolder:function(){return new UWA.Class.Promise(function(n,a){!0===i?a():e.roots({type:"Personal",collabSpace:"All",onComplete:function(e){var a=(e=JSON.parse(e)).folders;r(null);for(var s=a?a.length:0,l=0;l<s;l++){var d=a[l];if(o.isPersonalFolder(d.type)){var c={useAsyncPreExpand:!0},u=t.getWebappsAssetUrl("FolderEditor","icons/folder_perso.png");c.label=d.label,c.icons=[u],c.children=[],c.id=d.id,c.plmType="RootFolder",c.type=d.type,c.name=c.label,c.isPersonal=!0,r(c),i=!0;break}}n()},onFailure:function(e){r(null),i=!0,a(e)}})})}}}),define("DS/FolderEditor/views/customize_views/_FolderDGVUtils",["i18n!DS/FolderEditor/assets/nls/FolderEditor.json","DS/PADServices/utils/AttributesMgtV2","DS/PADServices/utils/GlobalUtils","DS/PADServices/utils/DictionaryAccess","DS/FolderEditor/service/FolderTypeService","DS/WebappsUtils/WebappsUtils","DS/PADServices/utils/MaturityUtils","DS/FolderEditor/views/FolderMode","DS/WidgetServices/WidgetServices"],function(e,t,o,n,i,r,a,s,l){"use strict";function d(e){}d.prototype.buildColumns=function(e){return new Promise(function(e,o){var i=[],r=0,a=t.getColumnsOrder(void 0);t.updateAttributesWithKind(void 0).then(function(){for(r=0;r<a.length;r++){var o=t.getColumn(a[r],void 0);o&&i.push(this.buildColumnFromSetting(o))}var s=UWA.clone(i);n.updateColumnsWithNLS(s,function(t){var o={};o.columns=s,"success"===t.status&&(o.columns=t.columns),e(o)})}.bind(this)).catch(o)}.bind(this))},d.prototype.buildColumnFromSetting=function(t){var n=Object.assign({editableFlag:!1,customisation:{exportable:{lock:!1,value:!0}}},t);if(!UWA.is(n.dataIndex)){if(!UWA.is(n.ds6w))throw new Error("Wrong column definition for ["+JSON.stringify(t)+"]");n.dataIndex=n.ds6w}switch(n.kind){case"string":n.typeRepresentation="string";break;case"timestamp":case"dateTime":n.typeRepresentation="datetime",n.semantics={allowMultipleValuesFlag:!0},n.getCellValueForExport=function(e){var t=new Date(e.cellModel),o=e.cellModel;return"Invalid Date"!=t&&(o=t.toLocaleString()),o};break;case"boolean":n.typeRepresentation="boolean";break;case"image":n.typeRepresentation="image";break;case"icon":n.typeRepresentation="icon";break;case"functionIcon":n.typeRepresentation="functionIcon";break;default:n.typeRepresentation||(n.typeRepresentation="string")}switch(n.dataIndex){case"ds6w:cadMaster":n.typeRepresentation="image",n.alignment="center",n.getCellValue=function(e){var t;if(!0!==e.isHeader&&e&&e.nodeModel&&e.nodeModel.options.grid)return e.nodeModel.options.grid["ds6w:cadMaster"]?t=c.get(e.nodeModel.options.grid["ds6w:cadMaster"]):"VPMReference"===e.nodeModel.options.grid.type&&(t=c.get("3DEXPERIENCE")),{iconPath:t,iconSize:{height:"22px"}}};break;case"thumbnail":n.ds6w=void 0,n.typeRepresentation="image",n.text=e.column_Thumbnail,n.sortableFlag=!1;break;case"ds6w:status":n.typeRepresentation="tag",n.getCellClassName=function(e){if(e.nodeModel){var t,o;if(t="read"!==s.getCurrentModeType()?e.nodeModel.options.grid.current_nonNls:e.nodeModel.getReferenceValue("ds6w:status-original")?e.nodeModel.getReferenceValue("ds6w:status-original"):e.nodeModel.getReferenceValue("ds6w:status")){if(!1===t.contains(".")){let o=e.nodeModel.getReferenceValue("ds6w:policy-original")?e.nodeModel.getReferenceValue("ds6w:policy-original"):e.nodeModel.getReferenceValue("ds6w:policy");o&&(t=o+"."+t)}o=a.getAndCreateMaturityClass(t,"wux-controls-label")}return o}};break;case"ds6w:responsible":n.typeRepresentation="user",n.getCellValue=function(e){var t,o=function(e,t){var o,n;l.get3DSwymUrlAsync({onComplete:function(e){null!=e&&(n=e)}}),null==n||n.contains("odtUrl")||(o=n+"/api/user/getpicture/login/"+e);return o}(e.nodeModel.options.grid.owner),n=e.nodeModel?e.nodeModel.options.grid["ds6w:responsible"]:void 0;return null!=o?t={icon:{iconPath:"url("+o+")",className:"dgv-user-thumbnail"},label:n}:n&&(t={icon:void 0,label:n}),t};break;case"ds6w:reserved":n.typeRepresentation="functionIcon",n.getCellSemantics=function(e){return e.isHeader||-1!==["Workspace","Workspace Vault"].indexOf(e.nodeModel.options.type)?e.cellView&&e.cellView.getContent()?e.cellView.getContent().empty():null:function(e){var t=!1,n=e.nodeModel.options.grid["ds6w:reserved"]?e.nodeModel.options.grid["ds6w:reserved"]:e.nodeModel.options.padgrid["ds6w:reserved"]?e.nodeModel.options.padgrid["ds6w:reserved"]:"",i=e.nodeModel.options.grid["ds6w:reservedBy"]?e.nodeModel.options.grid["ds6w:reservedBy"]:e.nodeModel.options.padgrid["ds6w:reservedBy"]?e.nodeModel.options.padgrid["ds6w:reservedBy"]:"",r=e.nodeModel.options.grid["ds6w:displayName"]?e.nodeModel.options.grid["ds6w:displayName"]:e.nodeModel.options.padgrid["ds6w:displayName"]?e.nodeModel.options.padgrid["ds6w:displayName"]:"";t="boolean"==typeof n?n:"TRUE"===n.toUpperCase();var a="wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-key dgvpad_lock";if(a)if(t){var s=o.getUserLogin();s=s||"";var l=o.getUserName();l=l||"";var d=!0;i.trim().length>0?(d=i.toUpperCase().trim()===s.toUpperCase().trim()||!1)||(d=i.toUpperCase().trim()===l.toUpperCase().trim()||!1):r.trim().length>0&&(d=l.toUpperCase().trim()===r.toUpperCase().trim()||!1),a=d?"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-key dgvpad_lock":"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-lock dgvpad_lock_other"}else a="wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-lock-open dgvpad_unlock";return{icon:{iconClasses:a},label:r,disabled:void 0!==e.nodeModel.options.checkout}}(e)},n.alignment="center",n.getCellValueForExport=function(t){var o=t.cellModel,n=o;-1!==t.rowID&&(n=e.tooltip_unreserved,o&&"true"===o.toLowerCase()&&(n=e.tooltip_reserved));return n};break;case"tree":n.getCellEditableState=function(e){return 1!=widget.launchWithReadMode&&(e&&e.nodeModel&&i.inFamilyFolder(e.nodeModel.plmType))},n.editionPolicy="DelayedEditionOnClick",n.setCellValue=function(e,t){e.nodeModel&&(require("DS/FolderEditor/commands/FolderCommands")._cellToRename={cellInfos:e,context:"CONTENT"},function(e,t,o){e.getTreeDocument().withTransactionUpdate(function(){if("tree"===t){var n={};n.label=o,n.display=o,n.oldLabel=e.options.label,e.updateOptions(n)}})}(e.nodeModel,"tree",t))}}return n},d.prototype.buildColumnsFromStorage=function(e){var o=this;return new Promise(function(n,i){var r=[],a=0;t.updateAttributesWithKind(void 0,e).then(function(e){t.updateAttributesWithKind().then(function(){var i=[];if(e)for(a=0;a<e.length;a++)i.push(new Promise(function(n){var i=e[a].dataIndex;t.addAvailableColumn(i,e[a]).then(function(e){var t=o.buildColumnFromSetting(e);t&&r.push(t),n()})}));Promise.all(i).then(function(){var e=UWA.clone(r);n(e)})})})})};const c=new Map,u=["CATIAV5","SOLIDWORKS","NX","CREO","SOLIDEDGE","ALTIUM","INVENTOR","AUTOCAD","CAAUPSAPP","CadenceAllegro","3DEXPERIENCE"];for(var p=0;p<u.length;p++)c.set(u[p],r.getWebappsAssetUrl("PADServices","icons/cadmasters/I_CADMaster"+u[p]+".png"));return d}),define("DS/FolderEditor/popup/AddMovePopup",["UWA/Controls/Abstract","DS/Controls/Toggle","DS/Controls/ButtonGroup","DS/Controls/Button","DS/Windows/Dialog","DS/FolderEditor/utils/FolderEditorcontrol","DS/FolderEditor/Folder_CSO","DS/WidgetServices/WidgetServices","DS/IPClassifyUtil/IPClassifyAlert","i18n!DS/FolderEditor/assets/nls/AddMovePopup"],function(e,t,o,n,i,r,a,s,l,d){return e.extend({init:function(e){this._parent(e),this.buildSkeleton(e),this.buttonGroup=null},buildSkeleton:function(e){var r=UWA.createElement("div",{class:"addMove-commonContent"}),a=UWA.createElement("div",{class:"addMove-Label"});a.innerText=d.operationToPerform,a.inject(r);var s=this.buttonGroup=new o({type:"radio"});s.addChild(new t({type:"radio",label:d.Add,value:"copy",checkFlag:!0})),s.addChild(new t({type:"radio",label:d.Move,value:"move"})),s.inject(r);var l=d.replace(d.get("msg_Title"),{number:e.objectValues.noOfObjects,folderName:e.objectValues.targetBookmark}),c=new i({immersiveFrame:widget.immersiveFrame,title:l,content:r,activeFlag:!1,modalFlag:!0,resizableFlag:!0,height:150,width:400,buttons:{Ok:new n({onClick:function(t){t.preventDefault(),t.stopPropagation();var o=s.getContent().dsModel.value[0];e.callback(o),c.destroy()}}),Cancel:new n({onClick:function(){e.callback("none"),c.destroy()}})}});c.getContent().addClassName("bookmark_AddMovePopUp"),c.addEventListener("close",function(t){e.callback("none"),c.destroy()})}})}),define("DS/FolderEditor/utils/FolderEditorUtil",["UWA/Utils","UWA/Core","DS/WebappsUtils/WebappsUtils","DS/FolderEditor/service/FolderEditorWebService","DS/FolderEditor/service/FolderTypeService","DS/IPClassifyUtil/IPClassifyAlert","i18n!DS/FolderEditor/assets/nls/FolderEditor","DS/FolderEditor/utils/FolderEditorcontrol","DS/FolderEditor/utils/FolderEditorEvents","DS/FolderEditor/utils/FolderCommunication","DS/FolderEditor/Folder_CSO","DS/IPClassifyActive/utils/EventsManager","DS/IPClassifyActive/utils/WidgetDataProvider","DS/LifecycleServices/LifecycleServicesSettings","DS/PADUtils/PADSettingsMgt","DS/PADUtils/PADUtilsServices","DS/WidgetServices/WidgetServices","DS/PlatformAPI/PlatformAPI","DS/PADServices/utils/AttributesMgtV2","UWA/Utils/Client","DS/FolderEditor/utils/FolderSearch","DS/FolderEditor/popup/AddMovePopup","DS/FolderEditor/views/FolderMode","DS/ZipJS/deflate","DS/ZipJS/inflate"],function(e,t,o,n,i,r,a,s,l,d,c,u,p,g,f,h,m,v,_,C,S,F,y){var D=null,b=null;function E(e){return function(){if(null===b){b={};var e=widget.getValue("X3DContentId");if(e){var o=t.is(e,"string")?JSON.parse(e):e;if(o.data&&o.data.items&&o.data.items.length>0){var n=o.data.items[0];if(n){var i=n.objectType;"Workspace"!=i&&"Workspace Vault"!=i&&null!=i||(b=n)}}widget.setValue("X3DContentId","")}}return b}()[e]}function w(e){var t=T.jsonUnzip(e),o=null;try{o=JSON.parse(t)}catch(e){o=null}return o}function A(e){return T.jsonZip(JSON.stringify(e))}getStatusPref=function(){if(!D){var e=widget.getValue("view_status");D={},e&&(D=w(e))}return D||{}},saveStatus=function(e,t){var o=getStatusPref();o[e]=t,widget.setValue("view_status",A(o))},getStatus=function(e){return getStatusPref()[e]},getTreeListSort=function(e){var t=getStatus("treeSort");return t||e};var T={nameRules:{maxLength:127},jsonZip:function(t){if(t.length>0&&"{"!==t[0]&&"["!==t[0])return t;for(var o=new ArrayBuffer(t.length),n=new Uint8Array(o),i=0;i<t.length;i++)n[i]=t.charCodeAt(i);var r=new Deflater;r.append(n);var a=r.flush(),s=String.fromCharCode.apply(null,a);return e.base64Encode(s)},jsonUnzip:function(t){if(t.length>0&&("{"===t[0]||"["===t[0]))return t;if(t.length>0&&0===t.indexOf("root,"))return"{}";var o=t;try{o=e.base64Decode(t)}catch(e){}for(var n=new ArrayBuffer(o.length),i=new Uint8Array(n),r=0;r<o.length;r++)i[r]=o.charCodeAt(r);var a=new Inflater,s=a.append(i);return a.flush(),String.fromCharCode.apply(null,s)},_getManipulationColumns:function(){let e=s.getContent().getPADTreeListView(),t=[];if(e){let n=e.getManipulationUnitColumns();for(var o=0;o<n.length;++o)t.push(n[o].dataIndex)}return t},convertToExaleadDataFormatFederated:function(e){var t={children:null},n=e.attributes,i={"ds6w:type":"type","ds6w:label":"label"},r={};let a=s.getContent().getPADTreeListView(),l=this._getManipulationColumns();if(n.forEach(function(e){if("resourceid"==e.name||"physicalid"==e.name)t.resourceid=e.value;else if("type_icon_url"===e.name||"icon"==e.name)t.icons=[e.value];else if("preview_url"===e.name||"thumbnail_2d"==e.name)t.thumbnail=e.value;else if("taxonomies"===e.name)e.value.contains("types/DOCUMENTS/Document")&&(t.checkout=!0,t.isDownloadable=!0);else if(e.name.startsWith("ds6w")){var o=e.name.split("/"),n=o[o.length-1];n="ds6wg:plmreference.v_islastversion"===n?"ds6wg:PLMReference.V_isLastVersion":n;var s=e.object?e.object:e.value;s=s||e.dispValue;var d=e.dispValue&&"ds6w:reserved"!==n?e.dispValue:e.value;d||(d=s);let p=null,g=null;if(a){-1!==l.indexOf(n)&&(p=n+"_SortKey",g=d);let e=a.getColumnUnitNls(n,!0);e&&(d=d+" "+e)}var c=r[n];if(c&&!Array.isArray(c)&&(c=[c]),Array.isArray(c)&&c.push(d),Array.isArray(c)?r[n]=c:r[n]=d,p){let e=r[p];e&&!Array.isArray(e)&&(e=[e]),Array.isArray(e)&&e.push(g),Array.isArray(e)?r[p]=e:r[p]=g}"ds6wg:revision"!==n||"Workspace Vault"!==t.type&&"Workspace"!==t.type?n!=e.name&&(r[e.name]=s):r[e.name]="";var u=i[n];u&&(t[u]=s,r[u]=s)}else"relcount"===e.name?"0"!==e.value&&(t.children=[]):r[(p=e.name,g=p.toLowerCase(),f=_.getAvailableColumns(),h=null,Array.isArray(f)&&f.every(function(e){return g==e.toLowerCase()&&(h=e),null===h}),h=h||p)]=e.value;var p,g,f,h}),e.id||(e.id=t.resourceid),t.isSearchWithinData=!0,t.grid=r,t.padgrid={"ds6w:leaf":"False","ds6w:root":"True"},"read"==s.getContent().getCurrentModeType()){if(["VPMReference","CATIA Embedded Component","CATPart","CATProduct","CATProcess","CATDrawing","CATAnalysis","CATShape"].indexOf(t.type)>-1&&(t.grid.expandable="TRUE",t.children=[]),["Workspace Vault","Workspace"].includes(t.type))if(t.grid.hasOwnProperty("icon_2ddefaultthb.subtype")&&"shared"==t.grid["icon_2ddefaultthb.subtype"].toLowerCase()){var d=o.getWebappsAssetUrl("FolderEditor","icons/I_BookmarkInherit_v2.png");t.icons=[d],t.grid["ds6w:classification"]="Shared"}else{var c=o.getWebappsAssetUrl("FolderEditor","icons/I_Bookmark_v2.png");t.icons=[c],t.grid["ds6w:classification"]="Bookmark"}else 1==t.checkout&&(t.Documentlocked=t.grid["ds6w:reserved"].toString().toUpperCase(),t.isDownloadable=!0)}return t},convertToExaleadDataFormat:function(e){if(Array.isArray(e.attributes))return this.convertToExaleadDataFormatFederated(e);var n={};n.resourceid=e.id,n.label=e.label,n.type=e.type,n.isDownloadable=e.isDownloadable||s.isCustomizedEnv()&&i.inFamilyFolder(e.type),n.checkout=e.checkout,t.is(e.mxid)&&(n.mxid=e.mxid),t.is(e.publishOnConnect)&&(n.publishOnConnect=e.publishOnConnect);var r=e.icon,a=e.largeicon,l=e.thumbnail?e.thumbnail:null;for(var d in s.isCustomizedEnv()&&i.isRootFolder(e.type)?(r=o.getWebappsAssetUrl("FolderEditor","icons/folder_shared.png"),a=o.getWebappsAssetUrl("FolderEditor","icons/largefolder_shared.png")):s.isCustomizedEnv()&&i.isPersonalFolder(e.type)&&(r=o.getWebappsAssetUrl("FolderEditor","icons/folder_perso.png"),a=o.getWebappsAssetUrl("FolderEditor","icons/largefolder_perso.png")),n.icons=r?[r]:[],n.thumbnail=null!==l?l:null!==a?a:r,e.revision=i.inFamilyFolder(e.type)?"":e.revision,t.is(e.description)&&t.is(e.description.replace,"function")&&(e.description=e.description.replace(/\\n/g," ")),n.grid={},n.padgrid={},n.grid["ds6wg:revision"]=e.revision,n.grid["ds6w:identifier"]=e.name,n.grid["ds6w:description"]=e.description?e.description:"",n.grid["ds6w:modified"]=e.modified,n.grid["ds6w:created"]=e.created,n.grid["ds6w:type"]=e.displayType?e.displayType:e.type,n.grid["ds6w:policy"]=e.policy?e.policy:"",n.grid["ds6w:organizationResponsible"]=e.organizationResponsible?e.organizationResponsible:"",n.grid["ds6w:project"]=e.project?e.project:"",n.grid["ds6w:status"]=e.status?e.status:"",e)"string"==typeof e[d]?e[d].length>0&&(n.grid[d]=e[d]):n.grid[d]=e[d];if(t.is(e.locker)&&(n.grid["ds6w:reservedBy"]=e.locker),t.is(e.locked)?n.grid["ds6w:reserved"]=e.locked:n.grid["ds6w:reserved"]="",t.is(e.isDuplicated)&&(n.grid.isDuplicated=e.isDuplicated),t.is(e.isLastMinorRevision)&&(n.grid.isLastMinorRevision=e.isLastMinorRevision),t.is(e.isLastVersion)&&(n.grid["ds6wg:PLMReference.V_isLastVersion"]=e.isLastVersion),t.is(e.svg)){var c=[{id:e.svg,format:"svg"}];n.grid.derivedOutputs=c}n.padgrid["ds6w:leaf"]="False",n.padgrid["ds6w:root"]="True",n.grid.current_nonNls=e.current_nonNls,n.grid["ds6w:responsible"]=e.responsible;let u=s.getContent().getPADTreeListView(),p=this._getManipulationColumns();var g=S.getAttrPredicateMap();return Object.keys(e).forEach(function(o){var i=g.get(o);if(i&&e[o].length>0){n.grid[i]=e[o];let r=null;if(-1!==p.indexOf(i)&&(r=i+"_SortKey",n.grid[r]=e[o]),u){let r=u.getColumnUnitNls(i,!0);if(r)if(t.is(e[o],"array")){let t=[];for(let n=0;n<e[o].length;++n){let i=e[o][n]+" "+r;t.push(i)}n.grid[i]=t}else n.grid[i]=e[o]+" "+r}}}),t.is(e.logicalDeleteBy)&&(n.grid.logicalDeleteBy=e.logicalDeleteBy),t.is(e.logicalDeleteStamp)&&(n.grid.logicalDeleteStamp=e.logicalDeleteStamp),t.is(n.thumbnail)&&(n.grid.thumbnail=n.thumbnail),t.is(e.expandable)&&"TRUE"===e.expandable?n.children=[]:(n.children=null,n.isNotManagedByPS=!0),n},convertToArray:function(e){return[{name:"ds6wg:revision",value:e.grid["ds6wg:revision"]},{name:"ds6w:description",value:e.grid["ds6w:description"]},{name:"ds6w:modified",value:e.grid["ds6w:modified"]},{name:"ds6w:created",value:e.grid["ds6w:created"]},{name:"ds6w:type",value:e.grid["ds6w:type"]},{name:"ds6w:policy",value:e.grid["ds6w:policy"]},{name:"ds6w:organizationResponsible",value:e.grid["ds6w:organizationResponsible"]},{name:"ds6w:project",value:e.grid["ds6w:project"]},{name:"ds6w:reservedby",value:e.grid["ds6w:reservedby"]},{name:"ds6w:reserved",value:e.grid["ds6w:reserved"]},{name:"isDuplicated",value:e.grid.isDuplicated},{name:"isLastMinorRevision",value:e.grid.isLastMinorRevision},{name:"derivedOutputs",value:e.grid.derivedOutputs},{name:"ds6w:leaf",value:e.padgrid["ds6w:leaf"]},{name:"ds6w:root",value:e.padgrid["ds6w:root"]},{name:"ds6w:responsible",value:e.grid["ds6w:responsible"]},{name:"ds6w:status",value:e.grid["ds6w:status"]}]},generateJSON:function(e){var t,o,n,i=e.length,r={};for(t=0;t<i;++t)o={label:(n=e[t]).label,created:n.created,icon:n.icon,mxid:n.mxid,folderClassification:n.folderClassification},r[n.id]=o;return r},shouldBeEditable:function(e){return i.inFamilyFolder(this.plmType)},onNodeModelUpdate:function(e){var o=e.data.nodeModel;if(i.inFamilyFolder(o.plmType)){var d=o._lastUpdateTime?o._lastUpdateTime:0,c=Date.now()-d;if(o._lastUpdateTime=Date.now(),!(0!==d&&c<300))if(o._resetting)o._resetting=!1;else{var u=o.getID(),p=o.options.label,g=o.options.oldLabel;if(void 0===g&&(g=""),p!==g){p&&p.trim&&(p=p.trim());var f=!0;if(p.length>T.nameRules.maxLength){var h=p.substring(0,T.nameRules.maxLength);p.length>T.nameRules.maxLength&&(h+="..."),r.displayNotification({message:a.replace(a.get("msg_error_name_maxlength"),{name:h,maxLength:T.nameRules.maxLength}),className:"error"}),f=!1}if(0==p.trim().length&&(r.displayNotification({message:a.get("msg_error_name_empty"),className:"error"}),f=!1),f)if(o.isFavorite){if(t.is(s.getTreeCont())){var m={id:u,name:g};s.getTreeCont().renameFavorite(m,p,o)}}else y.switchtoAuthoringMode(),n.setFolderProperties({pid:u,properties:{Title:p},onComplete:function(){o.options.oldLabel=p,l.notifyFolderRename([o]),r.displayNotification({message:a.replace(a.get("msg_info_rename"),{name1:g,name2:p}),className:"success"}),s.getContent().getPADTreeListView().escape(),s.getTreeCont().escape()},onFailure:function(e){let t=a.get("msg_error_rename");r.displayNotification({title:a.replace(t.Title,{name:g}),subtitle:t.Advice,message:t.Details,className:"error"}),o._resetting=!0,setTimeout(function(){o.withTransactionUpdate(function(){this.setLabel(g)}),o._resetting=!1}),s.getContent().getPADTreeListView().escape(),s.getTreeCont().escape()}});else setTimeout(function(){o.withTransactionUpdate(function(){this.setLabel(g)});var e=require("DS/FolderEditor/commands/FolderCommands");o.hasOwnProperty("pathId")?e._cellToRename&&e.RenameCmd(e._cellToRename.cellInfos,"TREE"):e._cellToRename&&e.RenameCmd(e._cellToRename.cellInfos,"CONTENT")})}}}},checkMoveOrCopyAcrossSharedAndPersonal:function(e,t,o){if(!e||!t)return!0;var n=0,i="shared";if(e.isPersonal&&(n++,i="personal"),t.isPersonal&&n++,1==n){var s=a.get("Move_label");o&&(s=a.get("Copy_label"));var l="",d="";return"personal"==i?(l=a.get("Personal_label"),d=a.get("Shared_label")):(l=a.get("Shared_label"),d=a.get("Personal_label")),r.displayNotification({message:a.replace(a.get("msg_error_MoveOrCopyAcrossSharedAndPersonal"),{move_copy:s,personal_shared:l,shared_personal:d}),className:"error"}),!1}return!0},getTenant:function(){var e=h.getPlatformId(),t=null;if(e){try{h.getTenantsPreference().every(function(o){return o.value===e&&(t=o),null===t})}catch(e){t=null}null===t&&(t={label:e,value:e})}return t},getCurrentSecurityContextAndFolderData:function(e){var t=c.getCurrentFolder(),o=f.getSetting("pad_security_ctx"),n=this.getTenant(),i=l.createBookmarkForPublication(t,e);return i.Tenant=n,i.SecurityContext=o,i},objectSelectionProvider:{widgetEventsProvider:{selection:"FolderEditor.Public.Bookmark"},widgetDataProvider:{getObjectForPublication:function(e){return e&&i.inFamilyFolder(e.getType())?{FolderID:e.getID(),FolderLabel:e.getLabel()}:null}}},dipatchSecurityContextAndFolder:function(){var e={current:null,active:null,origin:widget.id},t=this.getCurrentSecurityContextAndFolderData();e.current=t;var o=JSON.stringify(t);d.publish("FolderEditor.CurrentFolder",o);var n=!1;if(g.getEnforceFolderLinkSettingAsync(function(e,t){e||(n=t)}),n||s.isCustomizedEnv()||s.isActiveBookmarkActivated()){var i=s.getActiveFolder();e.active={origin:widget.id,id:"!"!==i.id?i.id:null,label:i.label,sc:i.sc},d.publish("FolderEditor.ActiveFolder",e.active)}d.publish("FolderEditor.Bookmark",e);var r=c.getCurrentFolder();p.setDataProvider(this.objectSelectionProvider),u.notifyObjectSelection(r)},_sortTreeColumn:function(e,t){var o=i.inFamilyFolder(e.plmType),n=i.inFamilyFolder(t.plmType);return o&&!n?"asc"===this.sortOrder?-1:1:!o&&n?"asc"===this.sortOrder?1:-1:T.compareLabels(e.options.label,t.options.label)},sortingNodes:function(e){var t=this;return e.columns&&e.columns.forEach(function(e){var o=e.dataIndex;"tree"===o?e.sortFunction=t._sortTreeColumn:"ds6w:created"===o||"ds6w:modified"===o||"logicalDeleteStamp"===o||e.xnav_options&&"date"===e.xnav_options.kind?e.sortFunction=function(e,t){var n,r=i.inFamilyFolder(e.plmType),a=i.inFamilyFolder(t.plmType);if(r&&!a)return"asc"===this.sortOrder?-1:1;if(!r&&a)return"asc"===this.sortOrder?1:-1;try{n=new Date(e.options.grid[o])>new Date(t.options.grid[o])?1:new Date(e.options.grid[o])<new Date(t.options.grid[o])?-1:0}catch(i){n=e.options.grid[o]<t.options.grid[o]?-1:1}finally{return n}}:e.sortFunction=function(e,t){var n=i.inFamilyFolder(e.plmType),r=i.inFamilyFolder(t.plmType);if(n&&!r)return"asc"===this.sortOrder?-1:1;if(!n&&r)return"asc"===this.sortOrder?1:-1;var a=e.options.grid[o]?e.options.grid[o]:"",s=t.options.grid[o]?t.options.grid[o]:"";return T.compareLabels(a,s)}}),e},downloadFcs:function(o){if(t.is(o,"string")){var n=e.parseUrl(o),i=e.parseQuery(n.query);i.__fcs__attachment=!0,delete n.query;var r=e.composeUrl(n),a=document.createElement("form");a.style.display="none",a.method="POST",a.action=r,Object.keys(i).map(function(e){var t=document.createElement("input");t.setAttribute("name",e),t.setAttribute("value",i[e]),a.appendChild(t)}),document.body.appendChild(a),a.submit(),document.body.removeChild(a)}},downloadForTouchDevices:function(e){if(t.is(e,"string")){e+="&__fcs__attachment=true";var o=s.getContent();t.createElement("a",{href:e,styles:{display:"hidden"}}).inject(o.elements.container).click()}},isTouchDevice:function(){return"ontouchstart"in document.documentElement},compareLabels:function(e,o){return e||(e=""),o||(o=""),t.is(e,"array")&&(e=e.length>0?e[0]:""),t.is(o,"array")&&(o=o.length>0?o[0]:""),m.compareValue(o,e)},setBadge:function(e,t,o){var n={};n[t]=o,this.setBadges(e,n)},setBadges:function(e,t){var o=e.getBadges();for(var n in o=o||{},t){var i=t[n];o[n]=i?"string"==typeof i?{iconPath:i,iconSize:{width:"16px",height:"16px"}}:i:"none"}e.setBadges(o)},copyTexttoCLipboard:function(e){return navigator.clipboard.writeText(e)},getDefaultView:function(){var e=getStatus("default_view");return e&&"treelistview"!==e?e:"datagridview"},getContentSortmodel:function(){var e=getTreeListSort(),t=[{sort:"asc",dataIndex:"tree"}];return e&&(e.id?t=[{sort:e.param?e.param.sortOrder:"asc",dataIndex:e.id}]:Array.isArray(e)&&(t=e)),t},getRightPanelStatus:function(){var e=getStatus("rightPanel");return e||{rightPanelState:!1,size:300}},getLeftPanelStatus:function(){var e=getStatus("leftPanel");return e||{leftPanelState:!0,isWelcomePanelCollapsed:!1}},getTreeViewScrollerPosition:function(){var e=getStatus("TreeViewScrollerPosition");return e||{x:0,y:0}},setDefaultView:function(e){saveStatus("default_view",e)},setContentSortmodel:function(e){saveStatus("treeSort",e)},setRightPanelStatus:function(e){saveStatus("rightPanel",e)},setLeftPanelStatus:function(e){saveStatus("leftPanel",e)},setTreeViewScrollerPosition:function(e){saveStatus("TreeViewScrollerPosition",e)},getX3DBookmarkId:E.bind(null,"objectId"),getX3DContentId:E.bind(null,"contentId"),getX3DTenant:E.bind(null,"envId"),clearX3DContentItem:function(){b&&delete b.contentId},clearX3DItem:function(){b=null},getContentViewPreference:function(){return new Promise(function(e,t){var o=null,n=widget.getValue("FolderCusto_treelistview");if(n)o=w(n),e({preference:o});else{var i=new Promise(function(e){require(["DS/PADUtils/PADWSAccess"],function(t){e(t)})}),r=new Promise(function(e){h.app_initialization(e)});Promise.all([i,r]).then(function(t){t[0].getMyAppsTemplate({preference_name:widget.getValue("x3dAppId")+"_template",onComplete:function(t){o=w(t),e({preference:o,template:!0})},onFailure:e})}).catch(t)}})},setContentViewPreference:function(e,t,o){return new Promise(function(n){try{e.selectedTypes=_.getSelectedTypes(),e.selectedExtensions=_.getSelectedExtensions()}catch(e){}e.version=o||widget.getValue("vMigration"),e.hasOwnProperty("columnsOptimized")&&e.columnsOptimized.forEach(function(e){e.hasOwnProperty("label")&&delete e.label}),"only"!==t&&widget.setValue("FolderCusto_treelistview",A(e)),t?require(["DS/PADUtils/PADWSAccess"],function(t){t.saveMyAppsTemplate({preference_name:widget.getValue("x3dAppId")+"_template",value:A(e),onComplete:function(e){console.log("Saved as template"),n()},onFailure:function(e){console.warn("Cannot save customization template"),n()}})}):n()})},getAddMovePopupResults:function(e,t){new(require("DS/FolderEditor/popup/AddMovePopup"))({callback:e,objectValues:t})},setTreeTaggerPreference:function(e,t){t=JSON.stringify(t),t=T.jsonZip(t),widget.setValue(e,t)},getTreeTaggerPreference:function(e){return function(e){if(e)try{e=T.jsonUnzip(e),e=JSON.parse(e)}catch(t){e={}}else e={};return e}(widget.getValue(e))},isTreeTaggerActive:function(){return!0===f.getSetting("activateTreeFilter")},filterDBOnlyAttrs:function(e){for(var t=[],o=0;o<e.length;++o)(!e[o].attrDBName||e[o].attrDBName.length>0)&&t.push(e[o]);return t},isRelationsColumnsActive:function(){let e=!0===f.getSetting("activateRelationsColumns"),t=!0===f.getSetting("Activate_relationsColumns"),o=!(!window||!0!==window.isReplayRelatedObjectsODT);return t&&e||o}};return T}),define("DS/FolderEditor/views/FolderLeftSidePanelView",["UWA/Core","UWA/Controls/Abstract","DS/FolderEditor/utils/FolderEditorUtil","DS/PADUtils/PADContext","DS/Core/ModelEvents","DS/FolderEditor/utils/FolderEditorEvents","DS/FolderEditor/utils/FolderEditorcontrol"],function(e,t,o,n,i,r,a){"use strict";return t.extend({_context:null,_callbackAdd:!1,init:function(e){this._parent(e,{}),this._context=n.get(),this.addCallback()},updatePanelVisibility:function(e,t){"left"===t&&(this.setPreferences(),a.getIdCardCont().updateLeftPanelIcon(e))},addCallback:function(){var e=this,t=a.getTreeCont()?a.getTreeCont()._folders_TreeView:null;t._getScroller()&&t._getScroller().onScrollEnd(function(){o.setTreeViewScrollerPosition(t.getScrollerPosition())}),!1===this._callbackAdd&&this._context.elements.padshell&&this._context.elements.padshell._modelEvents&&(this._context.elements.padshell._modelEvents.subscribe({event:"triptych-panel-hidden"},e.updatePanelVisibility.bind(this,!1)),this._context.elements.padshell._modelEvents.subscribe({event:"triptych-panel-visible"},e.updatePanelVisibility.bind(this,!0)),r.leftPanelOpen(function(t){"left"===t&&(!e._context.elements.padshell.getLeftOpen()&&widget.body.getSize().width,e._context.togglePanel("left"),e.setPreferences())}),r.leftPanelClose(function(t){"left"===t&&(e._context.elements.padshell.getLeftOpen()&&(e._context.togglePanel("left"),e.setPreferences()))}),this._callbackAdd=!0)},setPreferences:function(){var e=this._context.elements.padshell.getLeftOpen(),t={leftPanelState:e,isWelcomePanelCollapsed:!e};o.setLeftPanelStatus(t),e?r._modelEvents.publish({event:"welcome-panel-expanded"}):r._modelEvents.publish({event:"welcome-panel-collapsed"})},isLeftPanelOpen:function(){return this._context.elements.padshell.getLeftOpen()}})}),define("DS/FolderEditor/views/FolderRightSidePanelView",["UWA/Core","UWA/Controls/Abstract","UWA/Promise","DS/PADUtils/PADContext","DS/Utilities/Utils","DS/WidgetServices/commandProxy/CommandProxy","DS/FolderEditor/Folder_CSO","UWA/Class/Model","i18n!DS/FolderEditor/assets/nls/FolderEditor","i18n!DS/ENXNav/assets/nls/ENXNav.json","DS/FolderEditor/utils/FolderEditorUtil","DS/PADUtils/PADSettingsMgt","DS/FolderEditor/utils/FolderEditorcontrol","DS/FolderEditor/utils/FolderEditorEvents","DS/IPClassifyUtil/IPClassifyUtility"],function(e,t,o,n,i,r,a,s,l,d,c,u,p,g,f){"use strict";var h=[];return t.extend({_context:null,_propertiesWdg:null,_callbackAdd:!1,init:function(e){this._parent(e,{}),this._context=n.get();var t=this;if(this._propertiesWdg=null,this._context.elements.padshell){var i=new o(function(o){null==t._propertiesWdg?require(["DS/EditPropWidget/EditPropWidget","DS/EditPropWidget/constants/EditPropConstants","DS/EditPropWidget/utils/EditPropUtils"],function(n,i,r){if(t.EditPropUtils=r,null==t._propertiesWdg){t._propertiesWdg=new n({className:"enxpropertiestab",setEditButton:!0,readOnly:1==widget.launchWithReadMode,typeOfDisplay:i.ALL,selectionType:i.NO_SELECTION,multiselection:!1,collapseTabs:!1,context:t._context,actions:[{name:"action_close_panel",text:d.PADFind_close,icon:"close",handler:function(){t._context.elements.padshell.getRightOpen()&&(t._context.togglePanel("right"),t._selectionChange(),t.setPreferences())}}]}),t._propertiesWdg.addFacets([{require:"DS/FolderEditor/views/additionalFacets/AttachmentsFacet",alwaysVisible:!1,supportMerge:!1,services:["3DSpace"],inheritance:!0,content:null,facet:{name:"doc_specifications",text:l.get("Specification"),icon:"docs"},options:{appContext:t._getAppContext(e),hideAttachments:!0,readonly:!1}},{require:"DS/FolderEditor/views/additionalFacets/AttachmentsFacet",alwaysVisible:!1,supportMerge:!1,services:["3DSpace"],inheritance:!0,content:null,facet:{name:"doc_attachments",text:l.get("Attachments"),icon:"attach"},options:{appContext:t._getAppContext(e),hideSpecifications:!0,readonly:!1,supportedTypes:{includedTypes:["Document","DOCUMENTS","Drawing"],excludedTypes:[]}}}]),t._propertiesWdg.removeFacets([i.FACET_VIEWS]);var a=t._context.elements.padshell.getRightPanelContent();t._propertiesWdg.inject(a),t._propertiesWdg.elements.container.getContent().addEvent("resize",function(){t.size=t._context.elements.padshell._currentRight;var e={rightPanelState:t._context.elements.padshell.getRightOpen(),size:t.size};c.setRightPanelStatus(e)});var s=c.getRightPanelStatus();s.rightPanelState?(t.size=t._context.elements.padshell._currentRight=s.size,t._context.togglePanel("right"),t.setPreferences(),t._selectionChange(),g._modelEvents.publish({event:"information-panel-visible"})):(t.size=t._context.elements.padshell._currentRight=s.size,t.setPreferences())}o()}):o()});i.then(function(e){t.addCallback()}),h.push(i)}},updatePanelVisibility:function(e,t){"right"===t&&(this.setPreferences(),p.getIdCardCont().updateRightPanelIcon(e),!0===e&&f.sendTrackerPageEvent("FolderWidget_iconBar","Information"))},addCallback:function(){var e=this;!1===e._callbackAdd&&(r.create({events:{onSelect:e._selectionChange.bind(e)}}),e._context.elements.padshell&&e._context.elements.padshell._modelEvents&&(e._context.elements.padshell._modelEvents.subscribe({event:"triptych-panel-hidden"},e.updatePanelVisibility.bind(this,!1)),e._context.elements.padshell._modelEvents.subscribe({event:"triptych-panel-visible"},e.updatePanelVisibility.bind(this,!0)),g.rightPanelOpen(function(t){"right"===t&&(e._context.elements.padshell.getRightOpen()||(e._context.togglePanel("right"),e._selectionChange(),e.setPreferences()))}),g.rightPanelClose(function(t){"right"===t&&(e._context.elements.padshell.getRightOpen()&&(e._context.togglePanel("right"),e._selectionChange(),e.setPreferences()))}),e._callbackAdd=!0))},_selectionChange:function(e,t){if(this._context.elements.padshell.getRightOpen()&&this.EditPropUtils&&(!t||t.metadata&&t.metadata.originWidgetId===widget.id&&"ENORIPE_Relations"!==t.metadata.origin)){var n=this,i=a.getCurrentSelection(),r=[];i.length&&i.forEach(function(e){var t=n.EditPropUtils.getModelFromSelectedNode(e);t&&r.push(t)});n=this;var s=new o(function(e){o.all(h).then(function(){n._propertiesWdg.initDatas(r),e()})});h.push(s)}},setPreferences:function(){var e=this._context.elements.padshell.getRightOpen(),t={rightPanelState:e,size:this.size};c.setRightPanelStatus(t),e?g._modelEvents.publish({event:"information-panel-visible"}):g._modelEvents.publish({event:"information-panel-hidden"})},_getAppContext:function(e){return{getPlatformUrls:function(){return e.platformUrls},getSecurityContext:function(){return widget.getValue("pad_security_ctx")}}}})}),define("DS/FolderEditor/ActionBar/FolderCommandManager",["UWA/Class","DS/WidgetServices/WidgetServices","DS/ApplicationFrame/CommandsManager","DS/IPClassifyUtil/IPClassifyAlert","DS/IPClassifyUtil/IPClassifyUtility","DS/FolderEditor/utils/FolderEditorcontrol","DS/LifecycleServices/LifecycleServicesSettings","DS/FolderEditor/Folder_Clipboard","DS/FolderEditor/service/FolderTypeService","DS/FolderEditor/Folder_CSO","DS/FolderEditor/utils/FolderSearch","DS/FolderUpload/FolderUpload","DS/FolderEditor/utils/FolderEditorUtil","DS/IPClassifyUXUtil/ActionBar/IPCommandManager","DS/FolderEditor/service/FolderEditorWebService","DS/PADServices/utils/GlobalModelEvents","DS/PADUtils/PADSettingsMgt","i18n!DS/FolderEditor/assets/nls/FolderEditor","text!DS/FolderEditor/assets/FolderProbesCommandMapping.json"],function(e,t,o,n,i,r,a,s,l,d,c,u,p,g,f,h,m,v,_){"use strict";var C=JSON.parse(_);function S(){return new Promise(e=>{var t={onComplete:e,onFailure:function(t,o,i){if("string"==typeof o){var r=function(e){var t="";try{t=JSON.parse(e)}catch(e){}return t}(o);r.error&&n.displayNotification({message:r.error,className:"error"})}e()}};f.getToolbar(t)})}var F=[];t.isCatiaV5Environment()?F=["VPMReference","Drawing","XCADNonPSBaseRepReference","3DShape"]:t.isSolidworksEnvironment()&&(F=["XCADModelRepReference","VPMReference","Drawing"]);var y={SubscribeHdr:{TREE:!1},UnSubscribeHdr:{TREE:!1},EditSubscribeHdr:{TREE:!1},MySubscriptionsHdr:!0,BookmarkLocation:{search:!0,multisel:!1,CONTENT:!0},OpenInCADHdr:{dashboard:!1,CONTENT:{types:F}},openInV5:{webInWin:!1,setting:"activateOpenWith18xFD01",CONTENT:{Bookmarks:!1}},openWith:{CATIAV6:!1,multisel:!1,CONTENT:!0},RenameCmd:{multisel:!1,ctxFavorite:!0,TREE:{Sections:!1},CONTENT:{Bookmarks:!0}},ActionBar_FindInCtxCmd:{views:["datagridview"],search:!1,TREE:{ctxMenu:!1,Sections:!1},CONTENT:{check:e=>"VPMReference"==e.options.type&&!!e.getChildren()}},ActionBar_ActiveBookmarkCmd:{TREE:!0},AddExistingContent:{white_click:!0,search:!1,TREE:{ctxMenu:!1,Sections:!1}},AddFile:{white_click:!0,search:!1,TREE:{ctxMenu:!1,Sections:!1}},AddToFavorites:{ctxFavorite:!0,TREE:{ctxMenu:!1,Sections:!1},CONTENT:{FavContent:!0}},RemoveContent:{multiselSearch:!1,CONTENT:{Bookmarks:!1,childProduct:!1}},PreviewFile:{multisel:!1,CONTENT:{check:function(e){return void 0!==e.options.checkout}}},EditFile:{search:!1,multisel:!1,CONTENT:{check:function(e){return void 0!==e.options.checkout&&"TRUE"!==e._ischeckout}}},UpdateFile:{search:!1,multisel:!1,CONTENT:{check:function(e){return void 0!==e.options.checkout}}},UndoEditFile:{search:!1,multisel:!1,CONTENT:{check:function(e){return void 0!==e.options.checkout&&"TRUE"===e._ischeckout}}},FolderUpload:{search:!1,multisel:!1,check:function(){return!u.IsAnOperationOngoing()},TREE:{FavSection:!1}},FolderDownload:{multisel:!1,TREE:{FavSection:!1,Sections:!1},CONTENT:{check:function(e){return void 0!==e.type&&("Workspace Vault"===e.type||"Workspace"===e.type)}}},SelectChildren:{TREE:!1,CONTENT:{check:function(e){return null!==e.getChildren()}}},SelectParent:{TREE:!1,CONTENT:{check:function(e){return e.getDepth()>0}}},SelectAll:!0,SelectInversion:{TREE:!1,CONTENT:!0},SelectSiblings:{TREE:!1,CONTENT:!0},SelectLeaves:{TREE:!1,CONTENT:{check:function(e){return null!==e.getChildren()}}},DownloadFile:{TREE:{Sections:!1,custo:!0},CONTENT:{check:function(e){return e.options.isDownloadable}}},Copy:{TREE:{FavSection:!1,Sections:!1},CONTENT:!0},Cut:{search:!1,TREE:{Bookmark:!0},CONTENT:{Root:!1,childProduct:!1}},Paste:{search:!1,white_click:!0,clipboard:!0,TREE:{FavSection:!1},CONTENT:{Bookmarks:!0,rootInClipboard:!1}},ActionBar_Attributes:{TREE:{Sections:!1},CONTENT:!0},ActionBar_AccessRightCmd:{TREE:{Sections:!1},CONTENT:!0},CompareHdr:{CATIAV6:!1,CONTENT:!0},ActionBar_TransferOwnership:{TREE:{Sections:!1},CONTENT:!0},MaturityHdr:{TREE:{Sections:!1},CONTENT:!0},ActionBar_ChangeOwner:{TREE:{Sections:!1},CONTENT:!0},ActionBar_ReserveCmd:{TREE:!1,CONTENT:{Bookmarks:!1,check:function(e){return"boolean"!=typeof e.options.isDownloadable||!e.options.isDownloadable}}},ActionBar_UnreserveCmd:{TREE:!1,CONTENT:{Bookmarks:!1,check:function(e){return"boolean"!=typeof e.options.isDownloadable||!e.options.isDownloadable}}},ActionBar_NewFolderCmd:{author:!0,white_click:!0,search:!1,TREE:{FavSection:!1}},DeleteHdr:{TREE:{Sections:!1},CONTENT:{check:e=>!e.isPersonal}},treeview:!0,tileview:{search:!1},thumbnailview:{search:!1},ExpandAll:{TREE:{Favorites:!1},CONTENT:{check:function(e){return null!==e.getChildren()}}},ExpandN:{TREE:{FavSection:!1,Favorites:!1},CONTENT:{check:function(e){return null!==e.getChildren()}}},CollapseAll:{TREE:{Favorites:!1},CONTENT:{check:function(e){return null!==e.getChildren()}}},Print:{search:!1,ios:!1,views:["datagridview"]},PrintOptions:{search:!1,ios:!1},ExportCSV:{search:!1,ios:!1},ExportCSVOptions:{search:!1,ios:!1},ImportCSVBookmark:{search:!1,TREE:{FavSection:!1}},ImportCSV:{search:!1,TREE:{FavSection:!1}},ActiveFolder:{search:!1,check:function(){var e=!1;return a.getEnforceFolderLinkSettingAsync(function(t,o){t||(e=o)}),e||r.isCustomizedEnv()||r.isActiveBookmarkActivated()},TREE:{Sections:!1}},WhereUsed:!0,DuplicateHdr:{TREE:!1,CONTENT:{Bookmarks:!1}},RevisionHdr:{TREE:!1,CONTENT:{Bookmarks:!1}},NewBranchHdr:{TREE:!1,CONTENT:{Bookmarks:!1}},ReviseFromHdr:{TREE:!1,multisel:!1,CONTENT:{Bookmarks:!1}},HistoryHdr:{TREE:!1,multisel:!1,CONTENT:{Bookmarks:!1}},UPSAuthReplaceByRevision:{search:!1,multisel:!1,CONTENT:{Bookmarks:!1,check:function(e){return e.getDepth()<1}}},UPSReplaceByLatestRevision:{search:!1,CONTENT:{Bookmarks:!1,check:function(e){return e.getDepth()<1}}},ActionBar_ShareBookmarkLink:{multisel:!1,TREE:{Sections:!1},CONTENT:{search:!1,childProduct:!1}},RelationIPExplorer:{TREE:{Sections:!1},CONTENT:!0,CATIAV6:!1},ColumnVisibility:{views:["datagridview"]}};return e.singleton(g,{noSizeToFit:["bookmarkLocation"],initialize:function(){d.onFolderSelected(()=>{this.updateCommands()}),d.onEmpty(()=>{this.enableAllCommands(!1)}),o.onCommandStart(e=>{var t=y[e.getId()];t&&!0===t.author&&this.getModelEvents().publish({event:"switch_to_author"})});var e=new Promise(e=>{S().then(e)});return new Promise(t=>{e.then(e=>{var o={};if(e)for(var n in(o=JSON.parse(e)).headers){var i=o.headers[n],r=y[n];i.ID=n,r&&"CATAfrHeaderCheck"===i.Behavior&&(r.type="check")}if(!1===widget.multiselection){["SelectAll","SelectChildren","SelectInversion","SelectParent","SelectSiblings","SelectLeaves"].forEach(e=>{delete o.headers[e]})}t(o)})})},launchCommand:function(e,t,o,n){let r=e;C&&C[e]&&(r=C[e]),"ContextualMenu"===n?i.sendTrackerPageEvent("FolderWidget_contextual",r):i.sendTrackerPageEvent("FolderWidget_iconBar",r),this._parent.apply(this,arguments)},getHeaderCtxMenu:function(e){var t=this._parent.apply(this,arguments),o=e.cellInfos;return t.push({ID:"clearSort",title:v.CMDClearSort,type:"PushItem",icon:"clear",state:o.manager&&o.manager.sortModel&&o.manager.sortModel.length>0&&(o.manager.sortModel.length>1||"defaultSort"!==o.manager.sortModel[0].dataIndex)?"enabled":"disabled",action:{callback:function(){var e;(e=o).manager.prepareUpdateView(),e.manager.sortModel=[{dataIndex:"defaultSort",sort:"asc"}],e.manager.layout.saveColumnSortModelInPreferences(),e.manager.pushUpdateView({updateCellContent:!1,updateCellLayout:!0,updateCellAttributes:!1},!0)}}}),t},_manageSwitchOfCommands:function(e,o,n,i){var a=!1,d=n&&!!o&&0===o.length;e&&!d?a=e.isFavorite:o&&o.length>0&&(a=o[0].isFavorite);var u=!1,g=!1,f=!1,h=!1,v=!1,_=s.IsEmpty(),C=!1;_||s.getSelectedNodes().every(e=>!(C=C||l.isRootFolder(e.plmType)));var S=!1,F=!1,D=!1,b=!1;e&&(D="FolderSection_favorite"==e.plmType,b="FolderSection_AllFolders"==e.plmType,S=!a&&(l.isRootFolder(e.plmType)||l.isPersonalFolder(e.plmType)),F=!a&&l.isFolder(e.plmType));var E=D||b,w=!1,A=p.isRelationsColumnsActive();o&&o.every(function(e){return u=u||l.isRootFolder(e.plmType)||l.isPersonalFolder(e.plmType),g=g||l.isFolder(e.plmType),w=w||"Busy"===e.plmType,f=0!==e.getParents().length,h=h||A&&!0===e.isRelationsObjectNode,v=v||A&&!0===e.isRelationsObjectGroupingNode,!u||!g||!w||A&&(!h||!v)});var T=!0;if((D||w||(b||!e)&&o&&0===o.length)&&(T=!1),n||this.enableAllCommands(T),!w){var x={},P=Object.keys(y);return i&&(P=i),P.forEach(i=>{var s=y[i];if(s){var l=!!o&&o.length>0,p=!!e&&!l,b=!0,w=!o||o.length<=1;if("object"==typeof s){if(b&&A&&v&&(b=!1),(b&&!1===s.TREE&&p||!1===s.CONTENT&&l)&&(b=!1),b&&d&&!0!==s.white_click&&(b=!1),b&&void 0!==s.clipboard&&(b=!_),b&&void 0!==s.multisel&&(b=w),b&&void 0!==s.search&&(b=s.search===c.isSearchActive()),b&&0==s.multiselSearch&&(b=!(!w&&c.isSearchActive())),b&&void 0!==s.custo&&(b=r.isCustomizedEnv()),b&&void 0!==s.setting&&(b=!0===m.getSetting(s.setting)),b&&s.check&&(b=s.check({oneIsRoot:u,oneIsBookmark:g,treeIsRoot:S,treeIsBookmark:F})),b&&s.views&&(b=s.views.indexOf(r.getContent().getActiveView())>=0),b&&n&&a&&!0!==s.ctxFavorite&&(b=!1),b&&!1===s.dashboard&&(b=t.isWebInWinEnvironment()),b&&!1===s.webInWin&&(b=!t.isWebInWinEnvironment()),b&&!1===s.ios&&(b=!UWA.Utils.Client.Platform.ios),b&&!1===s.CATIAV6&&(b=!0!==widget.getValue("noCompass")),p=null,b&&s.TREE&&(p=!(!e||l&&void 0!==s.CONTENT))&&(!0===s.TREE?p=!0:(p&&s.TREE.custo&&(p=r.isCustomizedEnv()),d||p&&!a&&n&&!1===s.TREE.ctxMenu&&(p=!1),!1!==p&&(!0===s.TREE.Root?p=S:!1===s.TREE.Root&&(p=!S)),!1!==p&&(!0===s.TREE.Bookmark?p=F:!1===s.TREE.Bookmark&&(p=!F)),!1!==p&&(!0===s.TREE.Bookmarks?p=F||S:!1===s.TREE.Bookmarks&&(p=!F&&!S)),!1!==p&&(!0===s.TREE.Sections?p=E:!1===s.TREE.Sections&&(p=!E)),!1!==p&&(!0===s.TREE.FavSection?p=D:!1===s.TREE.FavSection&&(p=!D)),!1!==p&&(!0===s.TREE.Favorites?p=a:!1===s.TREE.Favorites&&(p=!a)),!1!==p&&s.TREE.check&&(p=s.TREE.check(e)))),l=null,b&&s.CONTENT&&(l=!!o&&o.length>0))if(!0!==s.CONTENT||A&&h){if(l&&s.CONTENT.custo&&(l=r.isCustomizedEnv()),!1!==l&&(!0===s.CONTENT.Root?l=u:!1===s.CONTENT.Root&&(l=!u)),!1!==l&&(!0===s.CONTENT.Bookmark?l=g:!1===s.CONTENT.Bookmark&&(l=!g)),!1!==l&&(!0===s.CONTENT.Bookmarks?l=g||u:!1===s.CONTENT.Bookmarks&&(l=!g&&!u)),!1!==l&&(!0===s.CONTENT.FavContent?l=o[0].isFavorite:!1===s.CONTENT.FavContent&&(l=!o[0].isFavorite)),!1!==l&&!1===s.CONTENT.rootInClipboard&&(l=!C),!1!==l&&void 0!==s.CONTENT.search&&(l=s.CONTENT.search===c.isSearchActive()),!1!==l&&!1===s.CONTENT.childProduct&&(b=l=!f),!1!==l&&(s.CONTENT.check||s.CONTENT.types)){var T=s.CONTENT.types,P=s.CONTENT.check,I=!1;o.every(function(e){return I=(I=T&&e.options&&e.options.type?T.indexOf(e.options.type)>=0:!T)&&(!P||P(e))}),l=I}}else l=!0;b=b&&(!0===l||!0===p||null===l&&null===p)}x[i]=b,n||this._switchCommand(i,b,s.type)}}),x}},isCommandAvailable:function(e,t,o,n){var i=!0,a=y[e];i&&void 0!==a.search&&c.isSearchActive()&&(i=a.search),i&&void 0!==a.custo&&(i=r.isCustomizedEnv()),i&&a.views&&(i=a.views.indexOf(r.getContent().getActiveView())>=0),i=i||this._parent.apply(this,arguments)},enableAllCommands:function(e){var t=o.getCommands();for(var n in t){var i=o.getCommand(n);UWA.is(i)&&i.enable&&(e?this._switchCommand(n,!0):"ListSnapshotsHdr"!==n&&this._switchCommand(n,!1))}},getModelEvents:function(){return h.getModelEvents()},updateCommands:function(e,t){if(t||(t=d.getCurrentFolder()),r.getContent()){var o=r.getContent().getSelectedNodes();o=o||(e?[e]:[]),this._parent(t,o)}}})}),define("DS/FolderEditor/commands/FolderCommands",["UWA/Core","UWA/Utils","DS/IPClassifyUtil/IPClassifyAlert","DS/IPClassifyUXUtil/IPClassifyConfirmation","DS/IPClassifyUXUtil/IPClassifyConfirmationWthCheckBx","DS/FolderEditor/Folder_CSO","i18n!DS/FolderEditor/assets/nls/FolderEditor","DS/FolderEditor/service/FolderServices","DS/FolderEditor/service/FolderTypeService","DS/UIKIT/Mask","DS/FolderEditor/utils/FolderEditorcontrol","DS/WebappsUtils/WebappsUtils","DS/ApplicationFrame/CommandsManager","DS/FolderEditor/Folder_Clipboard","DS/FolderEditor/popup/AddCommentPopup","DS/FolderEditor/utils/FolderEditorEvents","DS/FolderEditor/utils/FolderEditorUtil","DS/PADUtils/views/PADProgressBar","DS/FolderEditor/service/FolderEditorWebService","DS/FolderEditor/models/xBookNodeModel","DS/PADServices/utils/AttributesMgtV2","DS/WidgetServices/WidgetServices","DS/UIKIT/Native/Dropdown","DS/IPClassifyUtil/IPClassifyCommunication","DS/FolderEditor/ActionBar/FolderCommandManager","DS/FolderEditor/utils/BookmarkLocationUtil","DS/FolderEditor/utils/FolderSearch","DS/FolderEditor/popup/BookmarkLocationPopup","DS/FolderEditor/views/FolderRevisionReportPanel","DS/FolderEditor/views/FolderMode","DS/IPClassifyUXUtil/ProgressPaneExecution"],function(e,t,o,n,i,r,a,s,l,d,c,u,p,g,f,h,m,v,_,C,S,F,y,D,b,E,w,A,T,x,P){"use strict";function I(e){var t=!1;if(c.getContent()){var o=c.getContent().getSelectedNodes();o&&(t=o.findIndex(t=>t.id===e)>=0)}return t}function N(e,t,n){var i=t;if(n&&n.advice)console.error(e,n.error),o.displayNotification({title:i,subtitle:n.advice,message:n.error,className:"error"});else{console.error(e,n);let t={className:"error"};t.message=i,!UWA.is(n)||n instanceof Error||(t.title=i,t.message=n),o.displayNotification(t)}}var U=null;return{_endProgressBarListener:function(){var e=this;c.getContent().addEvent("onCompleteRefreshNodes",function(t){this.removeEvent("onCompleteRefreshNodes"),e._offProgressBar()})},_offProgressBar:function(){if(0===v._counter)return null;v.off()},_startProgressBar:function(e){1===v._counter&&v.off(),v.on(e)},_nbItemsNotNull:function(e){var t,o=e.length,n=0;for(t=0;t<o;++t)e&&n++;return n},_activeCuttingNodes:!1,_setStateCuttingNodes:function(e){var t=0,o=e.length;if(this._activeCuttingNodes&&this._setStaUncuttingNodes(),0===o)return null;for(t=0;t<o;++t)e[t].updateOptions({isBeingCut:!0});this._activeCuttingNodes=!0},_setStaUncuttingNodes:function(){var e,t,o,n=0;if(this._activeCuttingNodes){if(0===(t=(e=g.getSelectedNodes()).length))return null;for(n=0;n<t;++n)(o=e[n]).options.isBeingCut&&o.updateOptions({isBeingCut:!1});this._activeCuttingNodes=!1}},escapCmd:function(){this._activeCuttingNodes&&(this._setStaUncuttingNodes(),g.ClearClipboard()),c.getContent().getPADTreeListView().escape(),c.getTreeCont().escape()},RenameCmd:function(e,t){if(t)var o=c.getTreeCont()._folders_TreeView;else o=c.getContent().getPADTreeListView().getManager();var n=o.layout.getColumnIndex("tree"),i=o.layout.getCellIDFromCoordinates({rowID:e.rowID,columnID:n});o.setCellInEdition(i)},CopyCmd:function(){var e=[];e=c.getContent().getSelectedNodes();var t=r.getCurrentFolder();e=e.length>0?e:[t],this._setStaUncuttingNodes(),g.addInFolderClipboard(e,t,"COPY")},CutCmd:function(){var e=[];e=c.getContent().getSelectedNodes();var t=r.getCurrentFolder();1===(e=e.length>0?e:[t]).length&&e[0].getID()===t.getID()?c.getTreeCont()._folders_TreeView:e.length>0&&c.getContent().getPADTreeListView(),this._setStateCuttingNodes(e),g.addInFolderClipboard(e,t,"CUT")},launchCutPasteQuery:function(e,t,n){return new Promise((i,r)=>{s.MoveContent({IDs:e,targetfolder:t,sourcefolder:n,callbacks:{onComplete:function(e){i(e);var n=JSON.parse(e),r=n.objectsAlreadyPresent,s=n.objectsMoved;0!==r?o.displayNotification({message:a.replace(a.msg_info_objetmoved,{objectsAlreadyPresent:r,objectsMoved:s,targetfolder:t.options.label}),className:"success"}):o.displayNotification({message:a.replace(a.msg_info_objetmoved_1,{objectsMoved:s,targetfolder:t.options.label}),className:"success"})},onFailure:function(e){i(e),e&&e.message&&e.message.contains("NetworkError")&&e.message.contains("500")?o.displayNotification({message:a.msg_error_objectNoLongerAccessible,className:"error"}):N("PasteCmd",a.msg_error_MoveInfolder,e)}}})})},launchCopyPasteQuery:function(e,t){return new Promise((n,i)=>{s.AddContent({IDs:e,folder:t,callbacks:{onComplete:function(e){n(e);var i,r,s="";if(e){var l=JSON.parse(e);i=l.objectsAlreadyPresent,r=l.objectsAdded,s=l.information?" ("+l.information+")":s}0!==i?o.displayNotification({message:a.replace(a.msg_info_Addinfolder,{objectsAlreadyPresent:i,objectsAdded:r,targetfolder:t.options.label})+s,className:"success"}):o.displayNotification({message:a.replace(a.msg_info_Addinfolder_1,{objectsAdded:r,targetfolder:t.options.label})+s,className:"success"})},onFailure:function(e){if(e&&e.message&&e.message.contains("NetworkError")&&e.message.contains("500"))o.displayNotification({message:a.msg_error_objectNoLongerAccessible,className:"error"});else{if(typeof e!=String)e=e.toString();e.includes("Error: NetworkError")?N("PasteCmd",a.msg_error_OnRefreshCmdfailure):N("PasteCmd",a.msg_error_Addinfolder,e)}n(e)}}})})},launchRemoveQuery:function(e){return new Promise(t=>{s.RemoveContent({IDs:e,callbacks:{onComplete:function(n){if(e.length<10)for(var i=0;i<e.length;i++){var s=e[i];c.getContent().removeNodeInContent(s)}var l=c.getContent().getObjectsInTree();c.getContent().getObjectsInTree(),0===l&&c.getContent()._addPlaceHolder(),o.displayNotification({message:a.replace(a.msg_info_objetremoved,{number:e.length,foldername:r.getCurrentFolder().options.label}),className:"success"}),t(n)},onFailure:function(e){if(t(e),typeof e!=String)e=e.toString();e.includes("Error: NetworkError")?N("RemoveContentCmd",a.msg_error_OnRefreshCmdfailure):N("RemoveContentCmd",a.msg_error_Removefromfolder,e)}}})})},PasteCmd:function(e){var t=this,n=r.getCurrentFolder(),d=g.getTreeNode(),u=g.getSelectedNodes(),p=g.getMode(),f=e&&l.inFamilyFolder(e.plmType)?e:null;function h(e,t,o,n){if(o.id===t.id){if(UWA.is(n,"array"))for(var i=0;i<n.length;i++)if("CUT"!==e){var r=c.getContent().getPADTreeDocument().searchRootById(n[i].getID());if(UWA.is(r))return!1}else if(n[i].plmType)return!1}else if("CUT"===e&&!l.isRootFolder(t.getType())){if(UWA.is(n,"array")&&1===n.length&&n[0]===t){var a=t.getParent();if(a&&a.id===o.id)return!1}}return!0}if(f||(f=r.getCurrentFolder()),u){if(this._setStaUncuttingNodes(),l.inFamilyFolder(f.plmType))for(var v=0;v<u.length;v++)if(l.inFamilyFolder(u[v].plmType)&&!1===m.checkMoveOrCopyAcrossSharedAndPersonal(u[v],f,"COPY"==p))return void this._offProgressBar();var _=[],C=[],S=[],F=[];u.length>0?u.forEach(function(e){_.push(UWA.is(e.id)?e.id:e.options.resourceid),l.isFolder(e.plmType)?(C.push(UWA.is(e.id)?e.id:e.options.resourceid),S.push(e)):l.isRootFolder(e.plmType)?"RootFolder"===e.plmType&&(C.push(UWA.is(e.id)?e.id:e.options.resourceid),S.push(e)):F.push(UWA.is(e.id)?e.id:e.options.resourceid)}):(_.push(u),"Folder"==node.plmType?(C.push(u.id),S.push(u)):l.isRootFolder(node.plmType)||F.push(u.id));var y=C.length;if(f){if("CUT"==p){if(C.length>0&&(h(p,d,f,u)?s.MoveFolder({IDs:C,targetfolder:f,callbacks:{onComplete:function(e){t._endProgressBarListener(),c.getContent().loadContentAndSelect(n),o.displayNotification({message:a.replace(a.msg_info_foldermoved,{number:y,foldername:f.options.label}),className:"success"});for(var i=0;i<S.length;i++){var r=null,s=S[i],l=s.getParent();if(null===l)null===(r=c.getTreeCont()._getVisibleNodeById(s.id,null))?(r=s,l=d):l=r.getParent();else r=s;c.getTreeCont().removeFromTree(r)}null!==f&&UWA.is(c.getTreeCont())&&c.getTreeCont().updateTreeWithNewFolder(f),g.ClearClipboard(),b.updateCommands()},onFailure:function(e){var t=e;e&&e.message&&e.message.contains("NetworkError")&&e.message.contains("500")?o.displayNotification({message:a.msg_error_objectNoLongerAccessible,className:"error"}):(e&&e.targetfolder&&"FolderSection_AllFolders"===e.targetfolder.plmType&&(t=a.msg_error_CutPasteToRoot),N("PasteCmd",a.msg_error_MoveFolder,t)),g.ClearClipboard(),b.updateCommands()}}}):(this._offProgressBar(),o.displayNotification({title:a.msg_error_MoveInSamefolder.Title,subtitle:a.msg_error_MoveInSamefolder.Advice,className:"error"}))),F.length>0)if(h(p,d,f,u)){for(var D=F.length,E=[];F.length>0;){let e=F.splice(0,100);E.push(e)}P.execute({title:a.replace(a.progressPanel_move,{objectsAdded:D,targetfolder:f.options.label}),datas:E,query:e=>t.launchCutPasteQuery(e,f,d)}).then(()=>{g.ClearClipboard(),c.getContent().RefreshProductStructure=!0,c.getContent().loadContentAndSelect(r.getCurrentFolder())})}else o.displayNotification({title:a.msg_error_MoveInSamefolder.Title,subtitle:a.msg_error_MoveInSamefolder.Advice,className:"error"})}else if("COPY"==p){if(C.length>0){var w=function(e){s.CopyFolder({IDs:C,targetfolder:f,withContent:e,callbacks:{onComplete:function(e){t._endProgressBarListener(),c.getContent().loadContentAndSelect(n),o.displayNotification({message:a.replace(a.msg_info_foldercopied,{number:y,foldername:f.options.label}),className:"success"}),null!==n&&n.isExpanded()&&UWA.is(c.getTreeCont())&&c.getTreeCont().updateTreeWithNewFolder(n)},onFailure:function(e){t._offProgressBar(),e&&e.message&&e.message.contains("NetworkError")&&e.message.contains("500")?o.displayNotification({message:a.msg_error_objectNoLongerAccessible,className:"error"}):N("PasteCmd",a.msg_error_CopyFolder,e)}}})},A=function(e){let o=a.replace(a.confirmation_info,{From:"FolderSection_AllFolders"===f.getType()?a.name_Folder_type:a.name_RootFolder_type,To:"FolderSection_AllFolders"===f.getType()?a.name_RootFolder_type:a.name_Folder_type});i.launch({title:a.replace(a.confirmation_copyMassive_title,{source:1===C.length?S[0].getLabel():a.name_Section_AllFolders,target:f.getLabel()}),confirmLabel:a.confirmation_copy,infoTitle:s.isSourceAndTargetTypeSame(S,f)?null:o,mainDivContent:{divHeaderShow:e,checkBoxParams:{label:a.confirmation_copyMassive_checkBox}}},function(){i.getChkBoxCheckedFlag()?w(!0):w(!1)},function(){t._offProgressBar()})};s.CheckCopyFolder({IDs:C,callbacks:{onComplete:function(e){A()},onFailure:function(e){A(a.confirmation_copyMassive_message)}}})}if(F.length>0)if(h(p,d,f,u)){for(D=F.length,E=[];F.length>0;){let e=F.splice(0,100);E.push(e)}P.execute({title:a.replace(a.progressPanel_copy,{objectsAdded:D,targetfolder:f.options.label}),datas:E,query:e=>t.launchCopyPasteQuery(e,f)}).then(()=>{c.getContent().RefreshProductStructure=!0,c.getContent().loadContentAndSelect(r.getCurrentFolder())})}else o.displayNotification({title:a.msg_error_MoveInSamefolder.Title,subtitle:a.msg_error_MoveInSamefolder.Advice,className:"error"})}}else this._offProgressBar(),o.displayNotification({message:a.msg_warning_nocurrentfolder,className:"warning"})}},RemoveContentCmd:function(e,t){if(w.isSearchActive())this.RemoveContentSearchWithinCmd();else{var i=this,s=r.getCurrentFolder();s?n.launch({title:a.confirmation_remove_title,content:a.confirmation_remove_message},function(){s.getType();var e=r.getSelectedNodes();if(e.length>0){p.getCommand("RemoveContent").disable();var t=[],n=null;e.forEach(function(e){null===n&&"noExpandState"!==e._expandState&&!0===widget.getBool("filtered-content")&&(n=!0),UWA.is(e.id)?-1===t.indexOf(e.id)&&t.push(e.id):-1===t.indexOf(e.options.resourceid)&&t.push(e.options.resourceid)});for(var l=[],d=t.length;t.length>0;){let e=t.splice(0,100);l.push(e)}P.execute({title:a.replace(a.progressPanel_remove,{objectsAdded:d,targetfolder:r.getCurrentFolder().options.label}),datas:l,query:e=>i.launchRemoveQuery(e)}).then(()=>{d>10&&(c.getContent().RefreshProductStructure=!0,c.getContent().loadContentAndSelect(r.getCurrentFolder()))})}else o.displayNotification({message:a.msg_warning_nocontent,className:"warning"})}):o.displayNotification({message:a.msg_warning_nocurrentfolder,className:"warning"})}},RemoveContentSearchWithinCmd:function(){var e=this,t=c.getContent().getSelectedNodes()[0];if(null!=t){var n,i,l=UWA.is(t.id)?t.id:t.options.resourceid,d=[];_.getFolderPathsforItem({id:[l],onComplete:function(l){if(null!=l.result[0].outputs.GET_PARENT){var c=r.getCurrentFolder().getID();if(n=E._CalculatePath(l,c),i=E.getImmediateParents(n),d=i[0],i[1],n.length<=20){n.length!=d.length&&console.log("/! RemoveContentSearchWithinCmd: not all parents retrieved."),e.getResizedText=E.getResizedText;var u=l.result[0].input_object["ds6w:label"],g={title:a.replace(a.OpenLocationRemoveTitle,{label:u}),message:a.OpenLocationRemoveMessage,radio:!1,okButtonLabel:a.button_remove,onOkClick:function(){e._startProgressBar(a.Remove_content_loading);var i=p.getCommand("RemoveContent");i.disable();var r=null;null===r&&"noExpandState"!==t._expandState&&!0===widget.getBool("filtered-content")&&(r=!0);var l=UWA.is(t.id)?t.id:t.options.resourceid;s.RemoveContentSearchWithin({objectID:l,folderIDs:d,callbacks:{onComplete:function(i){e._offProgressBar();var r=JSON.parse(i),s="[]"==r.successFoldersIds?[]:r.successFoldersIds.replace("[","").replace("]","").replace(/\s/g,"").split(","),l="[]"==r.noRelationFoundFoldersIds?[]:r.noRelationFoundFoldersIds.replace("[","").replace("]","").replace(/\s/g,"").split(","),d="[]"==r.changeNotAllowedFoldersIds?[]:r.changeNotAllowedFoldersIds.replace("[","").replace("]","").replace(/\s/g,"").split(","),c=l.concat(d),u=t.options.label;if(0==c.length)o.displayNotification({message:a.replace(a.msg_info_objectremovedfromfolders,{objectname:u,number:s.length}),className:"success"}),e.locationPopop.dialog.close();else{e.locationPopop.dialog.buttons.Ok.visibleFlag=!1,e.locationPopop.dialog.buttons.Cancel.label=a.button_close;for(var p,g=[],f=0;f<n.length;f++){p=n[f].idToNavigate;for(var h=0;h<s.length;h++)if(p==s[h]){g.push("success");break}for(h=0;h<d.length;h++)if(p==d[h]){g.push("noChangeAllowed");break}for(h=0;h<l.length;h++)if(p==l[h]){g.push("noRelationFound");break}}e.locationPopop.pushNotif(g)}},onFailure:function(t){e._offProgressBar(),i.enable(),N("RemoveContentCmd",a.msg_error_Removefromfolder,t)}}})}},f=new A(n,E.getHtmlElemFromPath.bind(e),g);e.locationPopop=f}else o.displayNotification({title:a.msg_warning_removeContentFromSearch.title,subtitle:a.msg_warning_removeContentFromSearch.advice,message:a.msg_warning_removeContentFromSearch.details,className:"error"})}else this.onFailure("No path found because of deleted object.")},onFailure:function(e){console.log("RemoveContentSearchWithinCmd error: "+e),o.displayNotification({message:a.msg_warning_contentnotavailable,className:"warning"})}})}else o.displayNotification({message:a.msg_warning_nocontent,className:"warning"})},ExpandAllCmd:function(e,t){e.plmType;var n=[];"TREE"===t&&e?n.push(e):n=r.getCurrentSelection();var i=null;i=r.getCurrentFolder(),n.length?n.forEach(function(e){null===e.options.children||("TREE"===t||"Folder"===e.plmType||"FolderSection_AllFolders"===e.plmType?e.expand({expandLevel:"All"}):e.expandAll())}):null===i?o.displayNotification({message:a.msg_warning_nocurrentfolder,className:"warning"}):i.expandAll()},CollapseAllCmd:function(e,t){e.plmType;var n=[],i=r.getCurrentFolder();"TREE"===t&&e?n.push(e):n=r.getCurrentSelection(),n.length?n.forEach(function(e){e.collapseAll()}):null===i?o.displayNotification({message:a.msg_warning_noselection,className:"warning"}):i.collapseAll()},AccessRightCmd:function(e){b.launchCommand("ActionBar_AccessRightCmd",e)},uploadFileCmd:function(e,t){require(["DS/DocumentCreateNew/CreateNew","DS/PADUtils/PADSettingsMgt","DS/PADUtils/PADUtilsServices"],function(n,i,s){let l=t||r.getCurrentFolder();var d=l.getID(),u=l.getLabel(),p=new n({tenantUrl:s.get3DSpaceUrl(),securityContext:i.getSetting("pad_security_ctx"),tenant:s.getPlatformId(),immersiveFrame:widget.immersiveFrame,parentId:d,parentRelName:"Vaulted Objects",containerToOverlay:widget.body,getWorkUnderHeaders:function(){return{}},onUploadStart:function(){x.switchtoAuthoringMode()},onCancel:function(){},onError:function(e){o.displayNotification({title:e.title,message:e.message,className:"error"})},onDocumentUpload:function(e){c.getContent()._placeHolder.getContent().remove(),o.displayNotification({message:a.replace(a.get("msg_info_objetadded"),{filename:e.documents[0].dataelements.title,foldername:u}),className:"success"}),e.documents.forEach(function(e){var t=e.dataelements.parentId;t===r.getCurrentFolder().getID()&&_.getContentProperties({pid:e.id,onComplete:function(e){if(t==r.getCurrentFolder().getID()){UWA.is(e,"string")&&(e=JSON.parse(e));var o=m.convertToExaleadDataFormat(e);o.grid.isLastRevision=!0;var n=new C(o);n.plmType="Content";var i=c.getContent().getPADTreeDocument();i.wrapInTransaction(function(){i.addRoot(n)})}},onFailure:function(){console.error("Unable to update Document node, Error in getting content Properties")}})})}});window.isReplayODT&&(window.createNew=p),e?p.create(e):p.selectFilesAndCreate()})},DownloadFileCmd:function(){var e=r.getSelectedNodes(),t=m.isTouchDevice();if(0===e.length)o.displayNotification({message:a.msg_warning_nocontent,className:"warning"});else{e[0].getType();var n=e[0].options.type;if(!t&&c.isCustomizedEnv())1===e.length?"Document"!==n&&"CATAnalysisResults"!==n&&"CATIA Design Table"!==n&&"CATIA CGR"!==n&&"CATAnalysisComputations"!==n&&require(["DS/ApplicationFrame/CommandsManager","DS/FolderEditor/utils/FolderEditorcontrol"],function(e,t){e.getCommand("BulkDownload").begin()}):require(["DS/ApplicationFrame/CommandsManager","DS/FolderEditor/utils/FolderEditorcontrol"],function(e,t){e.getCommand("BulkDownload").begin()});else s.downloadFiles(void 0)}},EditFileCmd:function(){var e={},t=m.isTouchDevice();e.onSuccess=function(e){var o=c.getContent().getSelectedNodes()[0].getID();t?m.downloadForTouchDevices(1):m.downloadFcs(1);var n=c.getContent().getPADTreeDocument(),i=n.getNodesById(o);i[0].updateAttributes([{name:"isLastMinorRevision",value:"TRUE"}],S.getAvailableColumns()),i[0]._ischeckout="TRUE";var r=u.getWebappsAssetUrl("FolderEditor","icons/22/I_CheckOutDocument.png");m.setBadge(i[0],"bottomRight",r);var a={modified:[o]};n.refreshNodeById(a),I(o)&&b.updateCommands()},s.EditFile(e)},UpdateFileCmd:function(){var e={onSuccess:function(e){var t=c.getContent().getSelectedNodes()[0].getID(),o=c.getContent().getPADTreeDocument(),n=o.getNodesById(t);n[0]._ischeckout="FALSE",m.setBadges(n[0],{topRight:null,bottomRight:null}),c.getContent().updateRootNode(n[0]);var i={modified:[t]};o.refreshNodeById(i),I(t)&&b.updateCommands()}};s.UpdateFile(e)},UndoEditFileCmd:function(){var e={onSuccess:function(e){var t=c.getContent().getSelectedNodes()[0].getID(),o=c.getContent().getPADTreeDocument(),n=o.getNodesById(t);n[0]._ischeckout="FALSE",m.setBadges(n[0],{topRight:null,bottomRight:null}),c.getContent().updateRootNode(n[0]);var i={modified:[t]};o.refreshNodeById(i),I(t)&&b.updateCommands()}};s.UndoEditFile(e)},FolderUploadCmd:function(){var e={},t=r.getCurrentFolder();if(t){e.id=t.id,e.lable=t.getLabel();c.getContent().getPADTreeDocument().getNodesById(e.id);s.FolderUpload(e)}},FolderDownloadCmd:function(){var e={},t=r.getCurrentSelection(),o="function"==typeof t[0].getType?t[0].getType():t[0].plmType;"Folder"!=o&&"RootFolder"!=o||(e.id=t[0].getID(),s.FolderDownload(e))},GetContextualMenu:function(e,t,o){var n,i=!!e.white_Click&&e.white_Click,a=o?c.getContent().getSelectedNodes():[];return void 0===(n=!0===i?n=r.getCurrentFolder():a&&a.length>0?a:e.nodeModel)&&(n=e),Array.isArray(n)||(n=[n]),o||(o={cellInfos:e,data:{event:{pageX:0,pageY:0}}}),b.getContextualMenu(n,"TREE"===t,o)},showWebInWinCtxMenu:function(e,t){var o=t;if(o&&o.actions){var n=[];o.actions.forEach(function(e,t){e.actions&&e.actions.forEach(function(e){if(e.items){var t=[];e.items.forEach(function(e){"DS/ResultWebInWin/ResultWebInWinAction"==e.sourcejs&&t.push({text:e.title,icon:e.image,items:e.items,handler:function(t){var o=[r.getCurrentSelection()[0].getID()];D.publish("onActionContextualMenu",{header:e.id,ids:o})}})}),"DS/ResultWebInWin/ResultWebInWinAction"==e.sourcejs&&n.push({text:e.title,icon:e.image,items:t,handler:function(t){var o=[r.getCurrentSelection()[0].getID()];D.publish("onActionContextualMenu",{header:e.id,ids:o})}})}else"DS/ResultWebInWin/ResultWebInWinAction"==e.sourcejs&&n.push({text:e.title,icon:e.image,handler:function(t){var o=[r.getCurrentSelection()[0].getID()];D.publish("onActionContextualMenu",{header:e.id,ids:o})}})})}),this._initDropDown(n)}},_initDropDown:function(e){if(U){this.dropDown&&(this.dropDown.destroy(),this.dropDown=null);var t={items:e,target:U,contextual:!1,bound:!1};this.dropDown=new y(t),this.dropDown&&this.dropDown.show()}},getCtxMenu:function(e){var t=this;return new Promise(function(o,n){var i=null,a=null;U=e.infos?e.infos.target:void 0,i=e.graphview?(a=e.graphview).node:e.treeview?(a=e.treeview).nodeModel?a.nodeModel:a.cellModel:(a=e.cellInfos)?a.nodeModel?a.nodeModel:a.cellModel:null;var s=!0===widget.getValue("noCompass"),l=!0===widget.getValue("standalone"),d=F.isSolidworksEnvironment();if(s&&null!==i&&"object"==typeof i&&(!d&&!l))return D.publish("Create_ContextMenu",{ids:i?[i.id]:[]}),i&&!1===i.isSelected()&&i.select(!0),void o(void 0);null==a&&(a=r.getCurrentFolder());var c=a.rowID<0;if(a.cellView||({},e.graphview&&i||(a.white_Click=!0)),i&&"Busy"===i.plmType)o(void 0);else{var u=null;a.white_Click||1==c?u=a:i&&(!1===i.isSelected()&&i.select(!0),!0===i.isSelected()&&(u=e.graphview?i:a)),t.GetContextualMenu(u,"CONTENT",e).then(o).catch(n)}})},_createLink:function(e,t){var n=null,i=null,s=null,d=null,c="";if(e)if(l.isBookmark(e))i=e.getID(),s=e.getLabel();else{c=e.getID();var u=r.getCurrentFolder();i=u.getID(),s=u.getLabel(),d=p[0].getLabel()}else{var p=r.getCurrentSelection();if(1==p.length){var g="function"==typeof p[0].getType?p[0].getType():p[0].plmType;if(l.isBookmark(p[0]))i=p[0].getID(),s=p[0].getLabel();else{c=p[0].getID();u=r.getCurrentFolder();i=u.getID(),s=u.getLabel(),d=p[0].getLabel()}}}null!=i&&F.getSourceUrlAsync({platformId:F.getTenantID(),source:"3DDashboard",onComplete:function(e){var t={data:{items:[{objectId:i,contentId:c,envId:widget.getValue("x3dPlatformId")}]}};n=e+"#app:ENOFOL3_AP/content:X3DContentId="+encodeURIComponent(JSON.stringify(t)),m.copyTexttoCLipboard(n).then(()=>{"Content"==g&&o.displayNotification({message:a.replace(a.msg_success_copyLink_content,{filename:d,foldername:s}),className:"success"}),"Folder"!=g&&"RootFolder"!=g||o.displayNotification({message:a.replace(a.msg_success_copyLink_folder,{foldername:s}),className:"success"})}).catch(e=>{console.log("%c"+e,"color: orange"),o.displayNotification({message:a.msg_error_copylink,className:"error"})})}})}}}),define("DS/FolderEditor/commands/ActionBar_CutCmd",["UWA/Core","DS/ApplicationFrame/Command","DS/FolderEditor/commands/FolderCommands"],function(e,t,o){"use strict";return t.extend({labelTopBar:e.i18n("Copy"),isInsert:!0,datas:{},init:function(e){this._parent(e,{mode:"exclusive",isAsynchronous:!1})},beginExecute:function(){},execute:function(){o.CutCmd()},endExecute:function(){}})}),define("DS/FolderEditor/commands/CtxCommands",["DS/ApplicationFrame/Command","DS/PADUtils/PADSettingsMgt","DS/FolderEditor/commands/FolderCommands","DS/FolderEditor/utils/FolderEditorcontrol","DS/FolderEditor/utils/BookmarkLocationUtil","DS/PADUtils/PADContext"],function(e,t,o,n,i,r){"use strict";return e.extend({execute:function(){var e=r.get().ctxInfo;switch(this.options.ID){case"RenameCmd":!function(e){var t=e.options.cellInfos,n=e.options.isTree;o.RenameCmd(t,n)}(e);break;case"BookmarkLocation":!function(e){var t=e.nodes;t.length>0&&i.getFolderPathsforItem(t[0])}(e);break;case"openInV5":!function(e){var o=e.nodes;require(["DS/PADUtils/PADDataTransform","DS/PADUtils/PADUtilsServices","DS/i3DXCompassServices/i3DXCompassPubSub"],function(e,i,r){if(1!==o.length||!o[0].isRoot()||UWA.is(o[0].options.config_filter)||UWA.is(o[0].options.sequence_filter)){var a=n.getContent().getPADTreeDocument();e.buildDataForSetTypes(o,a,function(e,t){var o=JSON.stringify(t),n={appId:"MAP-CATCDVEAP",widgetId:i.getWidgetId(),fileName:"-file",fileContent:o};r.publish("launchApp",n)},!0)}else{var s={objectId:o[0].getID(),envId:i.getPlatformId(),serviceId:"3DSpace",contextId:t.getSetting("pad_security_ctx")};r.publish("setObject",s);var l={appId:"MAP-CATCDVEAP",widgetId:i.getWidgetId()};r.publish("launchApp",l)}})}(e);break;case"PreviewFile":!function(e){var o=e.nodes;require(["DS/PADUtils/PADUtilsServices","DS/DocumentCommands/ENOXDocumentCommands","DS/WidgetServices/WidgetServices"],function(e,n,i){var r=e.get3DSpaceUrl(),a=widget.widgetDomain,s=t.getSetting("pad_security_ctx"),l={document:{id:o[0].getID(),contextId:s,serviceId:"3DSpace",envId:i.getTenantID(),index:1,data:null,type:"Document"},platformUrls:{"3DSpace":r,"3DDashboard":a},onComplete:function(e){console.log("success")}},d=new n,c=d.init(l);(c=c||Promise.resolve()).then(()=>{d.render().Preview.handler()})})}(e)}}})}),define("DS/FolderEditor/commands/ActionBar_UndoEditCmd",["UWA/Core","DS/ApplicationFrame/Command","DS/FolderEditor/commands/FolderCommands"],function(e,t,o){"use strict";return t.extend({labelTopBar:e.i18n("Undo Edit"),isInsert:!0,datas:{},init:function(e){this._parent(e,{mode:"exclusive",isAsynchronous:!1})},beginExecute:function(){},execute:function(){o.UndoEditFileCmd(),this.end()},endExecute:function(){}})}),define("DS/FolderEditor/commands/ActionBar_UPSAuthReplaceByRevision",["UWA/Core","DS/ApplicationFrame/Command","DS/FolderEditor/commands/FolderCommands","DS/ENOXVersionExplorerController/VersionExplorerController","DS/ENOXVersionExplorerUtils/VersionExplorerSettings","DS/ENOXVersionExplorerUtils/VersionExplorerEnums","DS/ENOXVersionExplorerViews/VersionExplorerModal","DS/FolderEditor/utils/FolderEditorUtil","DS/PADUtils/PADSettingsMgt","DS/FolderEditor/Folder_CSO","DS/FolderEditor/service/FolderServices","DS/IPClassifyUtil/IPClassifyAlert","i18n!DS/FolderEditor/assets/nls/FolderEditor","DS/FolderEditor/utils/FolderEditorcontrol","DS/FolderEditor/views/FolderMode"],function(e,t,o,n,i,r,a,s,l,d,c,u,p,g,f){"use strict";return t.extend({labelTopBar:e.i18n("Replace By Revision"),isInsert:!0,_selectedNodes:null,init:function(e){this._parent(e,{mode:"exclusive",isAsynchronous:!1})},execute:function(){var e=null;if(1==(e=null===this._selectedNodes?d.getSelectedNodes():this._selectedNodes).length){var t=this.validPhysicalIDtobeReplaced=e[0].getID();this._launchVersionExplorer(t),this.end()}},endExecute:function(){this._selectedNodes=null},_launchVersionExplorer:function(t){var o=this,d=e.createElement("div",{class:"revisionUpdate-dialog-versionexplorer"}).inject(document.body);this._myVersionExplorer=new n({versionGraphContainer:null,selectionMode:r.SELECTION_MODES.SINGLE_SELECT_ONLY,widget:widget}),this._myVersionExplorer.disableDrag(),this._myVersionExplorer.showDialog({x:100,y:100},d,!0),i.loadUserSettingsPromise({displayMode:r.DISPLAY_MODES.SUBWAY_VIEW,displayLegend:!0},!0),this._myVersionExplorer.publishEvent("ENOXVersionExplorerLoadVersionModel",{id:o.validPhysicalIDtobeReplaced,tenantId:s.getTenant()?s.getTenant().value:"",securityContext:l.getSetting("pad_security_ctx"),onComplete:function(){},dataModelType:r.DATA_MODEL_TYPES.MODEL_HISTORY}),this._myVersionExplorer.subscribeEvent("ENOXVersionExplorerModalOK",this._onVersionExplorerModalOK.bind(this,t),!1),this._myVersionExplorer.subscribeEvent("ENOXVersionExplorerModalCancel",this._onVersionExplorerModalCancel.bind(this,t),!1),this._dlgVersionExplorer=a._dlg,a._dlg&&a._dlg.rightButtons&&a._dlg.rightButtons.addEventListener("click",this._onVersionExplorerModalCancel.bind(this,t)),this._dlgVersionExplorer.getFooter().getChildren()[0].disabled=!0,this._dlgVersionExplorer.setTitle(p.dialog_replaceByLatestRevision),this._myVersionExplorer.subscribeEvent("select",function(e){o._dlgVersionExplorer.getFooter().getChildren()[0].disabled=!1}),this._myVersionExplorer.subscribeEvent("unselect",function(e){o._dlgVersionExplorer.getFooter().getChildren()[0].disabled=!0})},_onVersionExplorerModalCancel:function(e){this._myVersionExplorer.unsubscribeAll()},_onVersionExplorerModalOK:function(t){var o=this;this._myVersionExplorer.unsubscribeAll();var n=this._myVersionExplorer.getSelectedNodes().shift().getAttribute("id");if(n!==o.validPhysicalIDtobeReplaced){var i=[],r=[];i.push(o.validPhysicalIDtobeReplaced),r.push(n),c.replaceContent({IDsRemoved:i,IDsAdded:r,callbacks:{onComplete:function(e){var t=JSON.parse(e);if("success"===t.status){o._updateTheNodes(t);var n=t.noObjectsExplicitlyRemoved;n>0?u.displayNotification({message:p.replace(p.msg_info_replaceByLatestRevision_removed,{number:n}),className:"primary"}):u.displayNotification({message:p.msg_info_replaceByRevision,className:"success"})}},onFailure:function(t){!function(t,o,n){var i=o;!e.is(n)||n instanceof Error||(i+="<br>"+n),u.displayNotification({message:i,className:"error"})}(0,p.msg_error_ReplaceBylatestRevision,t)}}})}else u.displayNotification({...p.msg_warning_replaceByRevision_sameObject,className:"warning"})},_updateTheNodes:function(t){var o=require("DS/PADServices/utils/AttributesMgtV2"),n=require("DS/FolderEditor/utils/FolderEditorUtil"),i=require("UWA/Promise");f.switchtoAuthoringMode();var r=g.getContent().getPADTreeDocument();"replacablecontent"in t&&r.wrapInTransaction(function(){r.withTransactionUpdate(function(){Object.keys(t.replacablecontent).forEach(function(r){g.getContent().getPADTreeDocument().getNodesById(r).forEach(function(a){if(a.getDepth()<1){a.collapse(),a.childComputed=!1,a.removeChildren();var s=t.replacablecontent[r],l=n.convertToExaleadDataFormat(s),d=n.convertToArray(l);a.updateAttributes(d,o.getAvailableColumns()),a.setAttribute("id",s.id),a.id=s.id,a.options.label=s.label,a.plmType="Content",a.options.resourceid=s.id,a.options.type=s.type,new i(function(t){require(["DS/FolderEditor/service/FolderServices"],function(o){var n={lastVersionRequests:[{id:s.id}]};o.getlastversion({objectsToTreat:n,callbacks:{onComplete:function(e){var o=JSON.parse(e).lastVersionRequests[0].islast;void 0!==o&&t(o)},onFailure:function(t){e.log("Replace content Service has failed")}}})})}).then(function(e){var t={grid:{isLastRevision:e}};a.updateOptions(t),a.select()})}})})})}),"nodesToBeRemoved"in t&&t.nodesToBeRemoved.length>0&&r.wrapInTransaction(function(){r.withTransactionUpdate(function(){t.nodesToBeRemoved.forEach(function(e){g.getContent().getPADTreeDocument().getNodesById(e).forEach(function(e){e.getDepth()<1&&(e.collapse(),r.removeRoot(e,!0,!1))})})})})},_getVersionExploreforODT:function(){return this._myVersionExplorer?this._myVersionExplorer:null},setNode:function(e){this._selectedNodes=[e]}})}),define("DS/FolderEditor/commands/ActionBar_FolderDownloadCmd",["UWA/Core","DS/ApplicationFrame/Command","DS/FolderEditor/commands/FolderCommands"],function(e,t,o){"use strict";return t.extend({labelTopBar:e.i18n("Folder Download"),isInsert:!0,datas:{},init:function(e){this._parent(e,{mode:"exclusive",isAsynchronous:!1})},beginExecute:function(){},execute:function(){o.FolderDownloadCmd(),this.end()},endExecute:function(){}})}),define("DS/FolderEditor/commands/ActionBar_CollapseAllCmd",["UWA/Core","DS/ApplicationFrame/Command","DS/FolderEditor/commands/FolderCommands","DS/FolderEditor/Folder_CSO"],function(e,t,o,n){"use strict";return t.extend({labelTopBar:e.i18n("Collase All"),isInsert:!0,datas:{},init:function(e){this._parent(e,{mode:"exclusive",isAsynchronous:!1})},beginExecute:function(){},execute:function(){var e=n.getCurrentSelection();if(!e.length||!e[0]||e[0].plmType&&"Content"!==e[0].plmType){var t=n.getCurrentFolder();o.CollapseAllCmd(t,"TREE")}else{var i=e[0];o.CollapseAllCmd(i,"CONTENT")}},endExecute:function(){}})}),define("DS/FolderEditor/commands/ActionBar_ExpandAllCmd",["UWA/Core","DS/ApplicationFrame/Command","DS/FolderEditor/commands/FolderCommands","DS/FolderEditor/Folder_CSO","DS/FolderEditor/utils/FolderEditorcontrol"],function(e,t,o,n,i){"use strict";return t.extend({labelTopBar:e.i18n("Expand All"),isInsert:!0,datas:{},init:function(e){this._parent(e,{mode:"exclusive",isAsynchronous:!1})},beginExecute:function(){},execute:function(){var e=n.getCurrentSelection();if(!e.length||!e[0]||e[0].plmType&&"Content"!==e[0].plmType){var t=n.getCurrentFolder();o.ExpandAllCmd(t,"TREE")}else{var i=e[0];o.ExpandAllCmd(i,"CONTENT")}},endExecute:function(){}})}),define("DS/FolderEditor/commands/ActionBar_FolderUploadCmd",["UWA/Core","DS/ApplicationFrame/Command","DS/FolderEditor/commands/FolderCommands"],function(e,t,o){"use strict";return t.extend({labelTopBar:e.i18n("Folder Upload"),isInsert:!0,datas:{},init:function(e){this._parent(e,{mode:"exclusive",isAsynchronous:!1})},beginExecute:function(){},execute:function(){o.FolderUploadCmd(),this.end()},endExecute:function(){}})}),define("DS/FolderEditor/commands/ActionBar_CopyCmd",["UWA/Core","DS/ApplicationFrame/Command","i18n!DS/FolderEditor/assets/nls/FolderEditor","DS/FolderEditor/commands/FolderCommands"],function(e,t,o,n){"use strict";return t.extend({labelTopBar:e.i18n("Copy"),isInsert:!0,datas:{},init:function(e){this._parent(e,{mode:"exclusive",isAsynchronous:!1})},beginExecute:function(){},execute:function(){n.CopyCmd()},endExecute:function(){}})}),define("DS/FolderEditor/commands/ActionBar_UPSReplaceByLatestRevision",["UWA/Core","DS/ApplicationFrame/Command","DS/FolderEditor/commands/FolderCommands","DS/FolderEditor/service/FolderServices","DS/WidgetServices/WidgetServices","DS/PADUtils/PADSettingsMgt","DS/FolderEditor/Folder_CSO","DS/IPClassifyUtil/IPClassifyAlert","i18n!DS/FolderEditor/assets/nls/FolderEditor","DS/FolderEditor/utils/FolderEditorcontrol","DS/PADUtils/views/PADProgressBar","DS/FolderEditor/views/FolderRevisionReportPanel","DS/FolderEditor/views/FolderMode"],function(e,t,o,n,i,r,a,s,l,d,c,u,p){"use strict";var g=[];function f(t,o,n){var i=o;!e.is(n)||n instanceof Error||(i+="<br>"+n),s.displayNotification({message:i,className:"error"})}function h(){if(0===c._counter)return null;c.off()}return t.extend({labelTopBar:e.i18n("Replace By Latest Revision"),isInsert:!0,datas:{},init:function(e){this._parent(e,{mode:"exclusive",isAsynchronous:!1})},execute:function(){var e={},t=[],o=a.getSelectedNodes(),i=o.length;o&&o.length<101?(o.forEach(function(e){var o={id:e.id};t.push(o)}),e={lastVersionRequests:t},n.getlastversion({objectsToTreat:e,callbacks:this._treatLatestRevision(i,o)})):s.displayNotification({message:l.msg_warning_replaceByLatestRevision_NotMorethan100Objects,className:"warning"}),this.end()},endExecute:function(){g=[]},_treatLatestRevision:function(e,t){var o=this;return{onComplete:function(i){var r=[],a=[],d=JSON.parse(i);d.lastVersionRequests.length>0&&d.lastVersionRequests.forEach(function(e){if(e.islast){var o=t.find(function(t){return t.id===e.id});if(o){var n={};n[o.options.label+" "+o.options.grid["ds6wg:revision"]]="isLatestRevision",g.push(n)}}else r.push(e.id),a.push(e.candidates[0])});var u,p=r.length;if(p>0){var f=r.length,h={numberOfSelectedObjects:e,objectsWithValidRevisions:f,idsToTreat:p};u=l.Replace_revision_loading,1===c._counter&&c.off(),c.on(u),n.replaceContent({IDsRemoved:r,IDsAdded:a,callbacks:o._treatReplacedContent(h)})}else s.displayNotification({message:l.msg_warning_replaceByLatestRevision_sameObject,className:"warning"})},onFailure:function(e){f(0,l.msg_error_ReplaceBylatestRevision,e)}}},_treatReplacedContent:function(e){var t=this;a.getCurrentFolder().getLabel();return{onComplete:function(o){var n=JSON.parse(o);if("success"===n.status){var i={numberOfSelectedObjects:e.numberOfSelectedObjects,noObjectsReplaced:n.noObjectsReplaced,noObjectsExplicitlyRemoved:n.noObjectsExplicitlyRemoved,noObjLatestRevisionAlreadyPresent:e.numberOfSelectedObjects-e.objectsWithValidRevisions};s.displayNotification({message:l.msg_info_replaceByLatestRevision,className:"success"}),h(),t._updateTheNodes(n,i)}},onFailure:function(e){h(),f(0,l.msg_error_ReplaceBylatestRevision,e)}}},_updateTheNodes:function(e,t){var o=require("DS/PADServices/utils/AttributesMgtV2"),n=require("DS/FolderEditor/utils/FolderEditorUtil");p.switchtoAuthoringMode();var i=d.getContent().getPADTreeDocument(),r=[],s=[],c=[],f=[];var h=new Promise(function(t){"replacablecontent"in e?i.wrapInTransaction(function(){i.withTransactionUpdate(function(){Object.keys(e.replacablecontent).forEach(function(t){d.getContent().getPADTreeDocument().getNodesById(t).forEach(function(i){if(0===i.getDepth()){i.collapse(),i.childComputed=!1,i.removeChildren();var a=e.replacablecontent[t];if(i.options){var s={};s[i.options.label+" "+i.options.grid["ds6wg:revision"]]=a.label+" "+a.revision,r.push(s)}var l=n.convertToExaleadDataFormat(a),d=n.convertToArray(l);i.updateAttributes(d,o.getAvailableColumns()),i.setAttribute("id",a.id),i.id=a.id,i.options.label=a.label,i.plmType="Content",i.options.resourceid=a.id,i.options.type=a.type;i.updateOptions({grid:{isLastRevision:!0}}),i.select()}})}),t()})}):t()}),m=new Promise(function(t){"nodesToBeRemoved"in e?e.nodesToBeRemoved.length>0&&i.wrapInTransaction(function(){i.withTransactionUpdate(function(){e.nodesToBeRemoved.forEach(function(e){d.getContent().getPADTreeDocument().getNodesById(e).forEach(function(e){if(0===e.getDepth()&&(e.collapse(),i.removeRoot(e,!0,!1),e.options)){var t={};t[e.options.label+" "+e.options.grid["ds6wg:revision"]]="ToBeRemoved",r.push(t)}})}),t()})}):t()});Promise.all([h,m]).then(function(){(function(e){e.forEach(function(e){Object.keys(e).forEach(function(t){"ToBeRemoved"===e[t]?s.push(l.replace(l.revisionReport.explicitlyRemoved,{prd1:t})):"isLatestRevision"===e[t]?c.push(l.replace(l.revisionReport.isLatestRevison,{prd1:t})):s.push(l.replace(l.revisionReport.successfullyReplaced,{prd1:t,prd2:e[t]}))})}),f.push(l.replace(l.revisionReport.msgObjectSelected,{object:t.numberOfSelectedObjects})),t.noObjLatestRevisionAlreadyPresent>0&&f.push(l.replace(l.revisionReport.msgObjectAlreadyLatestRevision,{object:t.noObjLatestRevisionAlreadyPresent})),t.noObjectsReplaced>0&&f.push(l.replace(l.revisionReport.msgSuccessfullyReplaced,{object:t.noObjectsReplaced})),t.noObjectsExplicitlyRemoved>0&&f.push(l.replace(l.revisionReport.msgObjectExplicitlyRemoved,{object:t.noObjectsExplicitlyRemoved}))})(r=r.concat(g)),new u({title:l.revisionReport.reportTitle+" - "+a.getCurrentFolder().getLabel(),success:s,warning:c,information:f})})}})}),define("DS/FolderEditor/commands/ActionBar_DownloadFileCmd",["UWA/Core","DS/ApplicationFrame/Command","DS/FolderEditor/commands/FolderCommands"],function(e,t,o){"use strict";return t.extend({labelTopBar:e.i18n("Download "),isInsert:!0,datas:{},init:function(e){this._parent(e,{mode:"exclusive",isAsynchronous:!1})},beginExecute:function(){},execute:function(){o.DownloadFileCmd()},endExecute:function(){}})}),define("DS/FolderEditor/commands/ActionBar_ImportCSVBookmarkCmd",["UWA/Core","DS/ApplicationFrame/Command","DS/FolderEditor/commands/FolderCommands","DS/FolderEditor/views/FolderMode"],function(e,t,o,n){"use strict";return t.extend({labelTopBar:e.i18n("Import CVS Bookmark Structure"),isInsert:!0,datas:{},init:function(e){this._parent(e,{mode:"exclusive",isAsynchronous:!1}),require(["DS/FolderEditor/commands/tools/ImportCSVBookmarkPanel"],function(e){})},beginExecute:function(){},execute:function(){require(["DS/FolderEditor/commands/tools/ImportCSVBookmarkPanel","DS/FolderEditor/views/FolderMode"],function(e,t){t.switchtoAuthoringMode(),new e})},endExecute:function(){}})}),define("DS/FolderEditor/commands/ActionBar_PasteCmd",["UWA/Core","DS/ApplicationFrame/Command","DS/PADUtils/PADContext","DS/FolderEditor/utils/FolderEditorcontrol","DS/FolderEditor/service/FolderTypeService","i18n!DS/FolderEditor/assets/nls/FolderEditor","DS/FolderEditor/commands/FolderCommands"],function(e,t,o,n,i,r,a){"use strict";return t.extend({labelTopBar:e.i18n("Copy"),isInsert:!0,datas:{},init:function(e){this._parent(e,{mode:"exclusive",isAsynchronous:!1})},beginExecute:function(){},execute:function(){var e=void 0,t=o.get().getSelectedNodes();1===t.length&&i.inFamilyFolder(t[0].plmType)&&(e=t[0]),a.PasteCmd(e)},endExecute:function(){}})}),define("DS/FolderEditor/commands/ActionBar_CheckInCmd",["UWA/Core","DS/ApplicationFrame/Command","DS/FolderEditor/commands/FolderCommands"],function(e,t,o){"use strict";return t.extend({labelTopBar:e.i18n("Update"),isInsert:!0,datas:{},init:function(e){this._parent(e,{mode:"exclusive",isAsynchronous:!1})},beginExecute:function(){},execute:function(){o.UpdateFileCmd(this),this.end()},endExecute:function(){}})}),define("DS/FolderEditor/commands/ActionBar_ShareBookmarkLink",["UWA/Core","DS/ApplicationFrame/Command","i18n!DS/FolderEditor/assets/nls/FolderEditor","DS/FolderEditor/commands/FolderCommands"],function(e,t,o,n){"use strict";return t.extend({labelTopBar:e.i18n("Share Bookmark Link"),isInsert:!0,datas:{},init:function(e){this._parent(e,{mode:"exclusive",isAsynchronous:!1})},beginExecute:function(){},execute:function(){n._createLink()},endExecute:function(){}})}),define("DS/FolderEditor/commands/ActionBar_CheckOutCmd",["UWA/Core","DS/ApplicationFrame/Command","DS/FolderEditor/commands/FolderCommands"],function(e,t,o){"use strict";return t.extend({labelTopBar:e.i18n("Edit"),isInsert:!0,datas:{},init:function(e){e.isEnabled=!1,this._parent(e,{mode:"exclusive",isAsynchronous:!1})},beginExecute:function(){},execute:function(){o.EditFileCmd(this),this.end()},endExecute:function(){}})}),define("DS/FolderEditor/tagger/TaggerContentProxy",["DS/PADServices/utils/GlobalModelEvents","DS/FolderEditor/utils/FolderEditorUtil","DS/FolderEditor/service/FolderEditorWebService","DS/FolderEditor/utils/FolderEditorEvents","DS/PADUtils/PADSettingsMgt","DS/IPClassifyUXUtil/tagger/TaggerIPProxy"],function(e,t,o,n,i,r){return new class extends r{constructor(){super(e.getModelEvents(),{name:"Content",colorize:!0,events:{addColorizeListener:e=>{this.filterBIColorize.call(this,e)},addUnColorizeListener:e=>{this.onFilterBIUnColorize.call(this,e)}}}),this._colorActives=null,this.activate(!0),n.onTaggerStatusChange(()=>{this.activate(!t.isTreeTaggerActive())})}addObjectsTags(e,t){var o=super.addObjectsTags(e,t);return this.updateColorNodes(e),o}updateColorNodes(e){if(this.isActive()&&e.length>0&&this._colorActives&&this.facetsComputationActives()){let n={};var t=this._colorActives;for(let e=0;e<t.length;++e){let o=t[e].object,i=t[e].color;n[o]=i}o.fetch({ids:e,select_predicate:t[0].predicate,onComplete:e=>{if((e=e.results)&&this._colorByNodes)for(let o=0;o<e.length;++o){let i=e[o].attributes,r=null,a=null;for(let e=0;e<i.length;++e)"resourceid"===i[e].name?r=i[e].value:-1!==t[0].predicate.indexOf(i[e].name)&&(a=n[i[e].value]);this._colorByNodes[r]=a,this._model.publish({event:"nodeColorUpdated",data:{}})}},onFailure:function(){console.log("Failure during fetch of ID's for colorize")}})}}facetsComputationActives(){return super.facetsComputationActives()||i.getSetting("activateBIFilter")}getCellKPIColor(e){var t=null;if(this.isActive()&&this._colorByNodes){var o=e.nodeModel.getID(),n=this._colorByNodes[o];t=n||"transparent"}return t}filterBIColorize(e){if(e&&e.tagColors&&!(e.tagColors.length<=0)&&e.tagColors[0].predicate&&this._isActive){this._colorByNodes={},this._colorActives=e.tagColors;var t=Object.keys(this._alreadyManagedIds);this.updateColorNodes(t)}}onFilterBIUnColorize(){this._colorByNodes=null,this._model.publish({event:"nodeColorUpdated",data:{}})}}}),define("DS/FolderEditor/tagger/TaggerTreeProxy",["DS/PADServices/utils/GlobalModelEvents","DS/FolderEditor/service/FolderEditorWebService","DS/IPClassifyUXUtil/tagger/TaggerIPProxy","DS/IPClassifyUtil/IPClassifyAlert","DS/FolderEditor/utils/FolderEditorUtil","DS/FolderEditor/utils/FolderEditorEvents","i18n!DS/FolderEditor/assets/nls/FolderEditor"],function(e,t,o,n,i,r,a){var s="tree_filter_v1";return new class extends o{constructor(){var t=e.getModelEvents();super(t,{name:"Tree",onlyLocal:!0,events:{addOpenTaggerListener:()=>{this._onOpenTagger()}}}),this.activate(!1);let o=i.getTreeTaggerPreference(s);this.setLocalFilter(o),t.subscribe({event:"filterUpdatedTree"},e=>{!function(e){i.setTreeTaggerPreference(s,e)}(this.getFilterTags())}),this._refreshNeeded=!0,r.onTaggerStatusChange(()=>{this.activate(i.isTreeTaggerActive())})}activate(e){super.activate(e),this.refresh(!0)}refresh(e){!this.isActive()||!this._refreshNeeded&&e?this._refreshNeeded=this._refreshNeeded||!e:(this.populateData(),this._refreshNeeded=!1)}_onOpenTagger(){this.refresh(!0)}removeFilters(){var e=this.getProxy().getCurrentFilter();e&&e.localfilters&&Object.keys(e.localfilters).length>0&&(this.getProxy().clearLocalFilter(),this.getProxy().dispatchEvent("onFilterChange",{localfilters:{}}),n.displayNotification({message:a.msg_info_treeFilterRemove,className:"primary"}))}populateData(){var e=this.getFilterTags();t.allBookmarks({filters:e||{},select_predicate:["physicalid"],onComplete:e=>{this.addTags(e)},onFailure:function(){console.error("Unable to update Content root node, Error in getting content Properties")}})}}}),define("DS/FolderEditor/controllers/CommonMode",["DS/FolderEditor/tagger/TaggerContentProxy","UWA/Controls/Abstract"],function(e,t){var o=[];return t.extend({init:function(e){this._parent(e),this._contentHandleRequest=null},cancelQuery:function(){this._contentHandleRequest&&this._contentHandleRequest.cancel(),this._contentHandleRequest=null},cancelFacetsLoading:function(){this._taggerHandleRequest&&this._taggerHandleRequest.cancel(),this._taggerHandleRequest=null},loadContents:function(){o.forEach(e=>{e.cancelQuery()}),o=[]},loadFacet:function(){var t=e.facetsComputationActives();(this.cancelFacetsLoading(),t)&&this.loadFacets.apply(this,arguments).then(t=>{var o="string"==typeof t?JSON.parse(t):t;e.addTags(o)}).catch(e=>console.log("Cannot load the facets"))},areFacetsCalled:function(){return!!this._taggerHandleRequest},loadContent:function(){var e=this.loadContents.apply(this,arguments);return e&&e.catch(function(e){console.log("Error: "+e)}).finally(()=>{this._contentHandleRequest=null}),o.push(this),e},disable:function(){this.cancelQuery(),this.cancelFacetsLoading()}})}),define("DS/FolderEditor/service/FolderDnDServices",["DS/IPClassifyUtil/IPClassifyAlert","DS/IPClassifyUXUtil/IPClassifyConfirmation","DS/FolderEditor/Folder_CSO","i18n!DS/FolderEditor/assets/nls/FolderEditor","DS/FolderEditor/service/FolderServices","DS/FolderEditor/service/FolderTypeService","DS/UIKIT/Mask","DS/FolderEditor/utils/FolderEditorcontrol","DS/WebappsUtils/WebappsUtils","DS/PADUtils/PADUtilsServices","DS/PADUtils/PADSettingsMgt","DS/FolderEditor/commands/FolderCommands","DS/FolderEditor/service/FolderEditorWebService","DS/Tree/TreeNodeModel","DS/FolderEditor/Folder_Clipboard","DS/FolderEditor/utils/FolderEditorUtil","DS/FolderEditor/utils/FolderSearch","DS/WidgetServices/WidgetServices","DS/FolderUpload/FolderUpload","DS/ApplicationFrame/CommandsManager","DS/PlatformAPI/PlatformAPI","DS/IPClassifyUtil/IPClassifyUtility","DS/FolderEditor/views/FolderMode","DS/IPClassifyUXUtil/ProgressPaneExecution"],function(e,t,o,n,i,r,a,s,l,d,c,u,p,g,f,h,m,v,_,C,S,F,y,D){"use strict";var b=!1,E="";return{setStartDrag:function(e){b=!0===e},isDragging:function(){return b},setDragFrom:function(e){E=e},getDragFrom:function(e){return E},shouldAcceptDrag:function(){return!h.isRelationsColumnsActive()||!o.isRelationsGroupNodeSelected()},retrieveDroppedDataFromDropEvent:function(e){for(var t,o=UWA.is(e.dataTransfer.types.indexOf,"function")?"indexOf":"contains",n="",i=["text/searchitems","text/plain","Text"],r=0;r<i.length&&""===n;r++){var a=e.dataTransfer.types[o](i[r]);(UWA.is(a,"number")&&a>=0||UWA.is(a,"boolean")&&!0===a)&&(n=i[r])}if(""===n)throw new Error("Unknown type in DnD");return t=e.dataTransfer.getData(n),JSON.parse(t)},hasFilesInEvent:function(e){var t=e.dataTransfer?e.dataTransfer:e.detail?e.detail:null;if(t){if(t.items||!t.types||!t.types[0]||"application/x-moz-file"!==t.types[0]&&"Files"!==t.types[0]){var o=e.dataTransfer.types[UWA.is(e.dataTransfer.types.indexOf,"function")?"indexOf":"contains"]("Files");return!!(UWA.is(o,"number")&&o>=0||UWA.is(o,"boolean")&&!0===o)}return!0}return!1},isExternalDroppedDataOnFolderEditor:function(e){var t=!0;return e&&e.widget_id&&e.widget_id==this.getWidgetId()&&(t=!1),t},isExternalDroppedDataFromSameSource:function(e){var t=!1;return e&&e.source&&"ENOFOL3_AP"==e.source&&(t=!0),t},getSortedDroppedDataByType:function(e,t){var o=[],n=[],i=[];if(e&&e.data&&e.data.items&&Array.isArray(e.data.items)){for(var a=0;a<e.data.items.length;a++){var s=e.data.items[a],l=s.objectId,d=s.objectType_Internal;if(d||(d=s.objectType),Array.isArray(d)){for(var c=d.length,u=c>0?d[c-1]:void 0,p=0;p<c;++p)if(r.inFamilyFolder(d[p])){u=d[p];break}d=u}var g=s.displayName;g||(g=d),g||(g=l);var f=s.folderId,h=r.isPersonalFolder(d)||s.isPersonalFolder,m=s.envId,v={droppedItem_id:l,droppedItem_type:d,droppedItem_name:g,droppedSourceFolder_id:f,droppedItem_isPersonal:h,droppedItem_serviceId:s.serviceId,droppedItem_tenantId:m,droppedItem_folderClassification:s.folderClassification};r.isRootFolder(d)||r.isPersonalFolder(d)?o.push(v):r.isFolder(d)?n.push(v):i.push(v)}t.RootFolder_itemList=o,t.Folder_itemList=n,t.Content_itemList=i}},getWidgetId:function(){return self.widget.id},isMoveDnDSetting:function(){return"Move"===self.widget.getValue("drag-and-drop")&&!m.isSearchActive()},getDragDataForSelectedNodesInCurrentFolderContent:function(e){var t=null,n=o.getCurrentFolder();n&&!n.isRoot()&&r.inFamilyFolder(n.plmType)&&(t=n.getID());for(var i=o.getCurrentFolderPath(),a=[],l=Array.isArray(i)?i.length:0,u=0;u<l;u++){var p=i[u];if(!r.inFamilyFolder(p.type))break;a.push({resourceid:p.id,type:p.type})}var g=[];return(e&&e.draggedNodes?e.draggedNodes:s.getContent().getSelectedNodes()).forEach(function(e){if(e){var o=e.options.type,n={envId:d.getPlatformId(),serviceId:"3DSpace",contextId:c.getSetting("pad_security_ctx")?c.getSetting("pad_security_ctx"):void 0,objectId:e.getID(),objectType:o,displayName:e.getLabel(),displayType:e.options.grid["ds6w:type"],folderClassification:e.options.grid.folderClassification,folderId:t,isPersonalFolder:e.isPersonal};if(!r.inFamilyFolder(o)){var i=e.getOccurencePathWithType?e.getOccurencePathWithType():void 0;e.isRelationsObjectNode?n.path=[i[i.length-1]]:n.path=i}r.inFamilyFolder(o)&&e.isFavorite||(n.folderPath=a),g.push(n)}}),{protocol:"3DXContent",version:"1.1",source:"ENOFOL3_AP",widget_id:this.getWidgetId(),data:{items:g}}},uploadFilesInFolder:function(e,t){if(e&&e.plmType&&r.inFamilyFolder(e.plmType)){var n=o.getCurrentFolder();n&&n.id===e.id?u.uploadFileCmd(t):u.uploadFileCmd(t,e)}else console.log("  Error in FolderDnDServices.uploadFilesInFolder, dropTarget_FolderNodeModel is not a Folder")},uploadFoldersInFolder:function(e,t){if(e&&e.plmType){F.sendTrackerPageEvent("FolderWidget_DnD","Folder Upload");var n=d.get3DSpaceUrl(),i=widget.widgetDomain,r=e.id,a=e.options.label,l=widget.title.split("-"),u={fetchSecurityContext:function(){return c.getSetting("pad_security_ctx")},fetchCollabSpaceDisplayName:function(){return l[0]},platformUrls:{"3DSpace":n,"3DDashboard":i,platformId:v.getTenantID()}},p=new _(u),g=C.getCommand("FolderUpload");p.events.subscribe({event:"operation-complete"},function(e){require("DS/FolderEditor/views/FolderMode").switchtoAuthoringMode();var t=o.getCurrentFolder();e.parentId==t.id&&(s.getTreeCont().refreshFolderTreeAndContent(),console.log("After Completion of the Command..."))}),p.events.subscribe({event:"enable-folder-upload-command-in-ui"},function(e){g.enable()}),p.events.subscribe({event:"disable-folder-upload-command-in-ui"},function(e){g.disable()}),p.handleDnD(r,t.dataTransfer,a)}else console.log("  Error in FolderDnDServices.uploadFilesInFolder, dropTarget_FolderNodeModel is not a Folder")},preAddContentInFolder:function(t,i,r,l,d){let c=this.addContentInFolder.bind(this);return new Promise(function(p,g){var f=r,h=f.length,m=r.length,v=[];if(t.id===i)return u._offProgressBar(),void e.displayNotification({title:n.msg_error_MoveInSamefolder.Title,subtitle:n.msg_error_MoveInSamefolder.Advice,className:"error"});if((h=f.length)<1)console.log("  Error in FolderDnDServices.addContentInFolder, lContentId list is empty");else{for(;r.length>0;){let e=r.splice(0,100);v.push(e)}D.execute({title:n.replace(n.progressPanel_dragDrop,{objectsAdded:m,targetfolder:t.options.label}),datas:v,query:e=>c(e,t,i,l,d)}).then(e=>{var n=s.getContent(),i=o.getCurrentFolder();if(n&&i&&i.id===t.id){var r=n.getPADTreeDocument();r&&r.keepExpandedState(),n.loadContentAndSelect(i,f[h-1]),a.unmask(n._contentDiv)}p()})}})},addContentInFolder:function(t,l,d,c,u){var p=this;return new Promise(function(g,f){if(l&&l.plmType&&r.inFamilyFolder(l.plmType)&&t){var h=t,m=!1,v=null;if((!0===p.isMoveDnDSetting()&&!0!==c||u)&&d)if(u)v={id:d},m=!0;else{var _=o.getCurrentFolder();_&&_.id===d&&(v=_,m=!0)}m&&v?i.MoveContent({IDs:h,targetfolder:l,sourcefolder:v,callbacks:{onComplete:function(t){g();var i=s.getContent(),r=o.getCurrentFolder();if(i&&r&&r.id===d){var a=i.getPADTreeDocument();a&&a.keepExpandedState(),i.loadContentAndSelect(r)}var c=JSON.parse(t),u=c.objectsAlreadyPresent,p=c.objectsMoved;0!==u?e.displayNotification({message:n.replace(n.msg_info_objetmoved,{objectsAlreadyPresent:u,objectsMoved:p,targetfolder:l.options.label}),className:"success"}):e.displayNotification({message:n.replace(n.msg_info_objetmoved_1,{objectsMoved:p,targetfolder:l.options.label}),className:"success"})},onFailure:function(t){g();var i=s.getContent(),r=o.getCurrentFolder();if(i&&r&&r.id===l.id&&a.unmask(i._contentDiv),t&&t.message&&t.message.contains("NetworkError")&&t.message.contains("500"))e.displayNotification({message:n.msg_error_objectNoLongerAccessible,className:"error"});else{let o={className:"error"};o.message=n.msg_error_MoveInfolder,t&&(o.message=t,o.title=n.msg_error_MoveInfolder),e.displayNotification(o)}}}}):i.AddContent({IDs:h,folder:l,callbacks:{onComplete:function(t){g();s.getContent(),o.getCurrentFolder();var i,r,a="";if(t){var d=JSON.parse(t);i=d.objectsAlreadyPresent,r=d.objectsAdded,a=d.information?" ("+d.information+")":a}0!==i?e.displayNotification({message:n.replace(n.msg_info_Addinfolder,{objectsAlreadyPresent:i,objectsAdded:r,targetfolder:l.options.label})+a,className:"success"}):e.displayNotification({message:n.replace(n.msg_info_Addinfolder_1,{objectsAdded:r,targetfolder:l.options.label})+a,className:"success"})},onFailure:function(t){g();var i=s.getContent(),r=o.getCurrentFolder();if(i&&r&&r.id===l.id&&a.unmask(i._contentDiv),t&&t.advice)e.displayNotification({title:n.msg_error_Addinfolder,subtitle:t.advice,message:t.error,className:"error"});else if(t&&t.message&&t.message.contains("NetworkError")&&t.message.contains("500"))e.displayNotification({message:n.msg_error_objectNoLongerAccessible,className:"error"});else{let o={className:"error"};o.message=n.msg_error_Addinfolder,t&&(o.message=t,o.title=n.msg_error_Addinfolder),e.displayNotification(o)}}}})}else console.log("  Error in FolderDnDServices.addContentInFolder, dropTarget_FolderNodeModel is not a Folder")})},addFoldersInFolder:function(t,l,d,c,p){var g=this;return new Promise(function(f,h){if(t&&t.plmType&&r.inFamilyFolder(t.plmType)&&d){u._startProgressBar(n.Paste_content_loading);var m=d,v=m.length;if(v<1)return console.warn("  Error in FolderDnDServices.addFoldersInFolder, lContentId list is empty"),void h();var _=!1;if((!0===g.isMoveDnDSetting()&&!0!==c||p)&&(_=!0),_){if(t.id===l)return u._offProgressBar(),e.displayNotification({title:n.msg_error_MoveInSamefolder.Title,subtitle:n.msg_error_MoveInSamefolder.Advice,className:"error"}),void h();for(var C=0;C<m.length;C++){var S,F=m[C];if(t.id===F)return u._offProgressBar(),e.displayNotification({title:n.msg_error_MoveInSamefolder.Title,subtitle:n.msg_error_MoveInSamefolder.Advice,className:"error"}),void h();var y=s.getTreeCont();if(y&&(S=y._getVisibleNodeById(F,null)),S&&S.isAscendantOf(t))return u._offProgressBar(),e.displayNotification({title:n.msg_error_MoveFolder,message:n.msg_error_MoveFolder_parent,className:"error"}),void h()}i.MoveFolder({IDs:m,targetfolder:t,selectedIds:m,callbacks:{onComplete:function(i){f();var r=o.getCurrentFolder(),d=!1,c=!1;r&&(-1!=m.indexOf(r.id)&&(d=!0,c=!0));var p=s.getTreeCont();if(p){var g=p._getVisibleNodeById(l,null);m.forEach(function(e){var t=p._getVisibleNodeById(e,g);t&&s.getTreeCont().removeFromTree(t)});var h=p._getVisibleNodeById(t.id,null);if(h&&h.isExpanded())d&&c&&r.id,h.collapse(),h.expand(),null&&(c=!1)}var _=s.getContent();if(_&&r)if(r.id===l)u._endProgressBarListener(),(C=_.getPADTreeDocument())&&C.keepExpandedState(),_.loadContentAndSelect(r);else if(r.id===t.id){var C;u._endProgressBarListener(),(C=_.getPADTreeDocument())&&C.keepExpandedState(),_.loadContentAndSelect(r,m[v-1]),a.unmask(_._contentDiv)}else u._offProgressBar(),d&&c&&(r.unselect(),t.select(),r=null,c=!1);else u._offProgressBar();e.displayNotification({message:n.replace(n.msg_info_foldermoved,{number:m.length,foldername:t.options.label}),className:"success"})},onFailure:function(i){h();var r=s.getContent(),l=o.getCurrentFolder();if(r&&l&&l.id===t.id&&a.unmask(r._contentDiv),u._offProgressBar(),i&&i.advice)e.displayNotification({title:n.msg_error_MoveFolder,subtitle:i.advice,message:i.error,className:"error"});else if(i&&i.message&&i.message.contains("NetworkError")&&i.message.contains("500"))e.displayNotification({message:n.msg_error_objectNoLongerAccessible,className:"error"});else{let t={className:"error"};t.message=n.msg_error_MoveFolder,i&&(t.message=i,t.title=n.msg_error_MoveFolder),e.displayNotification(t)}}}})}else i.CopyFolder({IDs:m,targetfolder:t,selectedIds:m,callbacks:{onComplete:function(i){h();var r=s.getTreeCont();if(r){var l=r._getVisibleNodeById(t.id,null);l&&l.isExpanded()&&r.updateTreeWithNewFolder(l)}var d=s.getContent(),c=o.getCurrentFolder();if(d&&c)if(c.id===t.id){u._endProgressBarListener();var p=d.getPADTreeDocument();p&&p.keepExpandedState(),d.loadContentAndSelect(c,m[v-1]),a.unmask(d._contentDiv)}else u._offProgressBar();else u._offProgressBar();e.displayNotification({message:n.replace(n.msg_info_foldercopied,{number:m.length,foldername:t.options.label}),className:"success"})},onFailure:function(i){h();var r=s.getContent(),l=o.getCurrentFolder();if(u._offProgressBar(),r&&l&&l.id===t.id&&a.unmask(r._contentDiv),i&&i.advice)e.displayNotification({title:n.msg_error_CopyFolder,subtitle:i.advice,message:i.error,className:"error"});else if(i&&i.message&&i.message.contains("NetworkError")&&i.message.contains("500"))e.displayNotification({message:n.msg_error_objectNoLongerAccessible,className:"error"});else{let t={className:"error"};t.message=n.msg_error_CopyFolder,i&&(t.message=i,t.title=n.msg_error_CopyFolder),e.displayNotification(t)}}}})}else console.warn("  Error in FolderDnDServices.addFoldersInFolder, dropTarget_FolderNodeModel is not a Folder or RootFolder"),h()})},processDroppedDataOnFolderEditorNode:function(t,o){var i=this;function a(e){if(Array.isArray(e)&&e.length>0)for(var t=d.getPlatformId(),o=e.length-1;o>=0;o--){var n=e[o];if(n&&n.droppedItem_tenantId!==t)return!1}return!0}if(o&&t){var l=i.isExternalDroppedDataOnFolderEditor(o),c=!1;l&&(c=this.isExternalDroppedDataFromSameSource(o));var u={};i.getSortedDroppedDataByType(o,u);var p=u.RootFolder_itemList,g=u.Folder_itemList,f=u.Content_itemList;if(!a(p)||!a(g)||!a(f))return void e.displayNotification({message:n.msg_warning_dndnotsupported_from_different_tenant,className:"warning"});if(!function(e){if(Array.isArray(e)&&e.length>0)for(var t=e.length-1;t>=0;t--){var o=e[t];if(o&&"3DSpace"!==o.droppedItem_serviceId)return!1}return!0}(f))return void e.displayNotification({message:n.msg_warning_dndnotsupported_from_different_source,className:"warning"});if(r.inFamilyFolder(t.plmType))Array.isArray(p)&&p.length>0&&e.displayNotification({message:n.msg_warning_dndnotsupported,className:"warning"}),new Promise(function(e,o){var n=g.length+f.length;if(c&&n>0){var i={targetBookmark:t.options.label,noOfObjects:n};h.getAddMovePopupResults(function(t){var n=t;"move"==n?e({isMoveExpectedfromExternalDrop:!0}):"copy"==n?e({isMoveExpectedfromExternalDrop:!1}):o()},i)}else e({isMoveExpectedfromExternalDrop:!1})}).then(function(e){var n=e.isMoveExpectedfromExternalDrop,r=[];if(Array.isArray(g)&&g.length>0)for(;g.length>0&&g[0];){for(var a=(c=g[0]).droppedSourceFolder_id,s=[],d=g.length-1;d>=0;d--){(u=g[d])?u.droppedSourceFolder_id===a&&(s.push(u.droppedItem_id),g.splice(d,1)):g.splice(d,1)}if(!l&&!h.checkMoveOrCopyAcrossSharedAndPersonal({isPersonal:c.droppedItem_isPersonal},t,!i.isMoveDnDSetting()))return;r.push(i.addFoldersInFolder(t,a,s,l,n))}if(Array.isArray(f)&&f.length>0)for(;f.length>0&&f[0];){var c;for(a=(c=f[0]).droppedSourceFolder_id,s=[],d=f.length-1;d>=0;d--){var u;(u=f[d])?u.droppedSourceFolder_id===a&&(s.push(u.droppedItem_id),f.splice(d,1)):f.splice(d,1)}r.push(i.preAddContentInFolder(t,a,s,l,n))}Promise.allSettled(r).then(function(e){if(n){for(var t=!1,i=0;i<e.length;i++)if("fulfilled"==e[i].status){t=!0;break}if(t){var r=o.widget_id+v.getTenantID()+"ENOFOL3_AP";S.publish(r)}}}).catch(function(e){})});else if("FolderSection_favorite"==t.plmType){if(Array.isArray(p)&&p.length>0){var m=[];(_=s.getTreeCont())?(p.forEach(function(t){var o=!1;"SHARED"===t.droppedItem_folderClassification&&(o=!1);var i={id:t.droppedItem_id,name:t.droppedItem_name,type:"RootFolder",isPersonal:t.droppedItem_isPersonal,inherit:o};_.isFolderAmongFavoriteFolders(i)?e.displayNotification({message:n.replace(n.get("msg_warning_FolderAlreadyAmongFavorites"),{foldername:t.droppedItem_name}),className:"warning"}):m.push(i)}),m&&m.length>0&&_.addFavorite(m)):console.warn("  FolderDnDServices performDropOnFolderEditorNode FolderTreeCont is undefined")}if(Array.isArray(g)&&g.length>0)if(l)e.displayNotification({message:n.msg_warning_dndnotsupported_external_on_Section_FavoriteFolders,className:"warning"});else{var _;m=[];(_=s.getTreeCont())?(g.forEach(function(t){var o=!1;"SHARED"===t.droppedItem_folderClassification&&(o=!0);var i={id:t.droppedItem_id,name:t.droppedItem_name,type:"Folder",isPersonal:t.droppedItem_isPersonal,inherit:o};_.isFolderAmongFavoriteFolders(i)?e.displayNotification({message:n.replace(n.get("msg_warning_FolderAlreadyAmongFavorites"),{foldername:t.droppedItem_name}),className:"warning"}):m.push(i)}),m&&m.length>0&&_.addFavorite(m)):console.warn("  FolderDnDServices performDropOnFolderEditorNode FolderTreeCont is undefined")}Array.isArray(f)&&f.length>0&&e.displayNotification({message:n.msg_warning_dndnotsupported,className:"warning"})}else console.warn("  FolderDnDServices processDroppedDataOnFolderEditorNode dropTarget_NodeModel type is not in Folder family")}else console.warn("  FolderDnDServices processDroppedDataOnFolderEditorNode invalid argument(s)")},performDropOnFolderEditorNode:function(i,a){var s=this,l=!0;i||console.log("  Error in FolderDnDServices.performDropOnFolderEditorNode, dropTarget_NodeModel is undefined");var c="FolderSection_favorite"==i.plmType,u=d.getPlatformId(),p=s.hasFilesInEvent(a),g=g||(i?null:n.msg_warning_dndnotsupported);if(g)e.displayNotification({message:g,className:"warning"}),l=!1;else if(r.inFamilyFolder(i.plmType)){if(p){var f=function(e){for(var t=!1,o=e.dataTransfer.items,n=0;n<o.length;n++){let e=o[n].webkitGetAsEntry();if(e&&e.isDirectory){t=!0;break}}return t};if(0!=u.localeCompare("OnPremise"))if(f(a))s.uploadFoldersInFolder(i,a);else{var h=a.dataTransfer?a.dataTransfer.files:a.detail.files;s.uploadFilesInFolder(i,h)}else if(f(a))e.displayNotification({message:n.msg_warning_dndWindowsFoldernotsupported,className:"warning"});else{h=a.dataTransfer?a.dataTransfer.files:a.detail.files;s.uploadFilesInFolder(i,h)}l=!1}}else if(c)p&&(e.displayNotification({message:n.msg_warning_dndnotsupported,className:"warning"}),l=!1);else if(p&&0!=u.localeCompare("OnPremise")){if(p){for(var m=a.dataTransfer.items,v=0;v<m.length;v++){let e=m[v].webkitGetAsEntry();e&&e.isDirectory&&!0}"FolderSection_AllFolders"==i.plmType&&(s.uploadFoldersInFolder(i,a),l=!1)}}else e.displayNotification({message:n.msg_warning_dndnotsupported,className:"warning"}),l=!1;var _=null;if(l)try{_=s.retrieveDroppedDataFromDropEvent(a)}catch(t){_=null,l=!1,e.displayNotification({message:n.msg_warning_dndnotsupported,className:"warning"})}if(self.widget&&this.isMoveDnDSetting()&&l&&_&&i&&"bookmark"===this.getDragFrom()&&o.getCurrentFolder()!==i){var C=o.getCurrentFolder().getLabel(),S=n.replace(n.confirmation_move_message,{source:C,target:i._options.label});_.hasOwnProperty("data")&&_.data.hasOwnProperty("items")&&(_.data.items.length>1?S=n.replace(n.confirmation_move_message_multisel,{nth:_.data.items.length,source:C,target:i._options.label}):_.data.items[0].hasOwnProperty("displayName")&&(S=_.data.items[0].objectId!==o.getCurrentFolder().id?n.replace(n.confirmation_move_message_monosel,{selection:_.data.items[0].displayName,source:C,target:i._options.label}):n.replace(n.confirmation_move_message_mono_from_tree,{source:C,target:i._options.label}))),t.launch({title:n.confirmation_move_title,confirmLabel:n.confirmation_move_button,content:S},function(){s.processDroppedDataOnFolderEditorNode(i,_)}),s.setDragFrom("")}else l&&_&&i&&s.processDroppedDataOnFolderEditorNode(i,_)}}}),define("DS/FolderEditor/views/FolderGlobalActiveBookmark",["UWA/Core","UWA/Class","DS/FolderEditor/utils/FolderEditorcontrol","i18n!DS/FolderEditor/assets/nls/FolderEditor","DS/Controls/TooltipModel","DS/FolderEditor/models/xBookNodeModel","DS/Menu/ContextualMenu","DS/FolderEditor/commands/FolderCommands","DS/WebappsUtils/WebappsUtils","DS/IPClassifyUtil/IPClassifyAlert","DS/Logger/Logger","DS/FolderEditor/utils/FolderCommunication","DS/PlatformAPI/PlatformAPI","DS/FolderEditorOpenness/FolderEditorOpenness","DS/FolderEditor/utils/FolderLoaderGlobal","DS/WAFData/WAFData","DS/PADUtils/PADUtilsServices","DS/FolderEditor/service/FolderEditorWebService","DS/WidgetServices/WidgetServices","DS/FolderEditor/Folder_CSO","DS/FolderEditor/ActionBar/FolderCommandManager"],function(e,t,o,n,i,r,a,s,l,d,c,u,p,g,f,h,m,v,_,C,S){"use strict";var F={iconName:"pin",fontIconSize:"1x"},y={iconName:"pin-off",fontIconSize:"1x"},D=t.singleton({name:"ActiveFolder",ICON_ACTIVE:F,ICON_ACTIVE_DISABLED:y,ACTIVE_FOLDER_PREFERENCE:"ActiveFolder_FolderID",DEFAULT_VALUE:"!",_logger:null,_isInitialized:!1,_container:null,_cellElement:null,_nameElement:null,_activeFolder:{id:null,label:"",node:null,sc:""},_disabledActiveFolder:{id:null,label:"",node:null,sc:""},_tooltipDisplayButton:null,_tooltipTextSwitch:"",_labelSwitch:null,init:function(e){var t=this;return t._logger=c.getLogger(D),t._logger.log("init"),t._parent(e),t.activeFolderCallBack(),this.retrieveActiveFolderFromPreference().then(function(e){t._buildSkeleton(),t._isInitialized=!0}).catch(function(e){console.log("Error: "+e)}),t},_buildSkeleton:function(){var t=this,r=o.getTreeCont().getCommonToolSection().getElement(".findinTree_findcontainer");new e.createElement("div",{class:"div_for_margin"}).inject(r,"before"),this._container=new e.createElement("div",{id:"active_folder_container"}).inject(r,"before"),this._cellElement=e.createElement("div",{id:"active_folder_cell",class:"wux-tweakers"}).inject(this._container,"top"),this._activeBookmarkIcon=e.createElement("div",{id:"active_folder_icon",class:"wux-ui-3ds wux-ui-3ds-bookmark-pin"}).inject(t._cellElement,"bottom"),this._nameElement=e.createElement("div",{id:"active_folder_label",class:"wux-tweakers wux-tweakers-string wux-tweakers-string-label",events:{click:function(){t.centerTreeToActiveFolder(null!==t._disabledActiveFolder.id?t._disabledActiveFolder.id:t._activeFolder.id)}}}).inject(t._cellElement,"bottom"),this._nameElement.tooltipInfos=this._tooltipDisplayButton=new i({shortHelp:n.tooltip_noDefaultLocation,initialDelay:0,mouseRelativePosition:!1}),this._dropDownMenu=e.createElement("div",{id:"active_folder_down_button",class:"fonticon fonticon-down-open",events:{click:function(){var e=new Event("contextmenu");e.pageX=(this.getBoundingClientRect().left+this.getBoundingClientRect().right)/2,e.pageY=(this.getBoundingClientRect().top+this.getBoundingClientRect().bottom)/2,this.dispatchEvent(e)}}}).inject(t._cellElement,"bottom");var a=null!==this._disabledActiveFolder.id?this._disabledActiveFolder.label:this._activeFolder.label;this._updateUI(a),this._buildContextualMenu()},_getNodeModel:function(){var e=null!==this._disabledActiveFolder.id?this._disabledActiveFolder:this._activeFolder,t=new r({resourceid:e.id,label:e.label});return t.getType=(()=>"Folder"),t},_buildContextualMenu:function(){var e=this;C.getCurrentFolder();a.addEventListener(this._dropDownMenu,{callback:function(){var t=[],o=C.getCurrentFolder(),i={type:"PushItem",title:n.CMDUnsetGlobalActiveFolder,icon:"bookmark-pin",action:{callback:function(){f.addComponentsToLoad("global",{unsetActiveFolder:n.UnsetActiveBookmark_Loading}),S.launchCommand("ActiveFolder",o,null,"ContextualMenu").then(function(){d.displayNotification({message:n.replace(n.msg_info_inactive_successfully,{folderLabel:e._activeFolder.label}),className:"success"}),f.removeComponentToLoad("global","unsetActiveFolder")},function(e){f.removeComponentToLoad("global","unsetActiveFolder")})}}},r={type:"PushItem",title:n.CMDShowInBookmarks,icon:"bookmark",action:{callback:function(){var t=null!==e._disabledActiveFolder.id?e._disabledActiveFolder.id:e._activeFolder.id;e.centerTreeToActiveFolder(t)}}},a={type:"PushItem",title:n.CMDAccessRightCmd,icon:"forward",action:{callback:function(){var t=e._getNodeModel();s.AccessRightCmd(t)}}},l={type:"PushItem",title:n.CMDShareBookmarkLink,icon:"link",action:{callback:function(){var t=e._getNodeModel();s._createLink(t)}}},c=null!==e._disabledActiveFolder.id?"play":"pause",u={type:"PushItem",title:e._labelSwitch,fonticon:{family:"DSFontIcon",content:"wux-ui-3ds wux-ui-3ds-"+c},tooltip:e._tooltipTextSwitch,action:{callback:function(){e.switchActiveFolderState()}}};return t.push(i),t.push(r),t.push(a),t.push(l),_.isReplayedODT()&&t.push(u),t}})},_updateUI:function(e){null!=this._container&&(this._nameElement.setHTML("<p id='active_folder_label_text'>"+e+"</p>"),this._tooltipDisplayButton.shortHelp=n.replace(n.tooltip_defaultLocation,{folderLabel:e}),null==this._disabledActiveFolder.id?(this._tooltipTextSwitch=n.replace(n.tooltip_disableDefaultLocation,{folderLabel:e}),this._labelSwitch=n.CMDDisableGlobalActiveBookmark,this._nameElement.setStyle("color","#368ec4"),this._activeBookmarkIcon.setStyle("color","#368ec4"),this._updateTreeIcons(this._activeFolder.id,F)):(this._tooltipTextSwitch=n.replace(n.tooltip_enableDefaultLocation,{folderLabel:e}),this._labelSwitch=n.CMDEnableGlobalActiveBookmark,this._nameElement.setStyle("color","#b4b6ba"),this._activeBookmarkIcon.setStyle("color","#b4b6ba"),this._updateTreeIcons(this._activeFolder.id,null),this._updateTreeIcons(this._disabledActiveFolder.id,y)))},_updateTreeIcons:function(e,t){var n=o.getTreeCont(),i=n._getVisibleNodeById(e,n._rootNodeFolders);null!==i&&i.setBadges({topRight:t});var r=o.getContent();r&&r.updateActiveBookmarkNode(null,null===t)},centerTreeToActiveFolder:function(e){var t=this;if(!t._isExpanding)return t._isExpanding=!0,new Promise(function(n,i){o.getTreeCont().expandTreeAndSelectFolder({folderToFindAndSelect:{ids:[e]},onComplete:function(r){!function r(){o.getTreeCont()._getVisibleNodeById(e,null)?(o.getTreeCont().expandTreeAndSelectFolder({folderToFindAndSelect:{ids:[e]}}),t._isExpanding=!1,n()):(setTimeout(function(){r()},200),i())}()},onGiveUp:function(e){t._isExpanding=!1,t._unsetAfterError(),i()},onFailure:function(e){t._isExpanding=!1,t._unsetAfterError(),i()}})})},switchActiveFolderState:function(){var e=this;null!==this._disabledActiveFolder.id?(f.addComponentsToLoad("global",{enableActiveFolder:n.EnableActiveBookmark_Loading}),this._checkFolderStatus(this._disabledActiveFolder.id).then(function(){return e.setActiveFolder(e._disabledActiveFolder)}).then(function(){f.removeComponentToLoad("global","enableActiveFolder"),d.displayNotification({message:n.replace(n.msg_info_enable_successfully,{folderLabel:e._activeFolder.label}),className:"success"})}).catch(function(t){e._unsetAfterError(),f.removeComponentToLoad("global","enableActiveFolder")})):(f.addComponentsToLoad("global",{disableActiveFolder:n.DisableActiveBookmark_Loading}),this._disabledActiveFolder=this._activeFolder,this._checkFolderStatus(this._activeFolder.id).then(function(){return e.unsetActiveFolder()}).then(function(){return e.services.setUserPreferences(e.ACTIVE_FOLDER_PREFERENCE,e.DEFAULT_VALUE+e._disabledActiveFolder.id)}).then(function(){f.removeComponentToLoad("global","disableActiveFolder"),d.displayNotification({message:n.replace(n.msg_info_disable_successfully,{folderLabel:e._disabledActiveFolder.label}),className:"success"})},function(t){e._unsetAfterError(),f.removeComponentToLoad("global","disableActiveFolder")}))},activeFolderCommand:function(e){var t=this,o=t._activeFolder,i=t._disabledActiveFolder,r={id:e.getID(),label:e.getLabel(),node:e},a=o.id!==r.id,s=!(i.id===r.id)&&a;s?f.addComponentsToLoad("global",{setActiveFolder:n.SetActiveBookmark_Loading}):f.addComponentsToLoad("global",{unsetActiveFolder:n.UnsetActiveBookmark_Loading}),this.unsetActiveFolder().then(function(){if(!s)return f.removeComponentToLoad("global","unsetActiveFolder"),d.displayNotification({message:n.replace(n.msg_info_inactive_successfully,{folderLabel:r.label}),className:"success"}),!1;t.setActiveFolder(r).then(function(e){f.removeComponentToLoad("global","setActiveFolder"),d.displayNotification({message:n.replace(n.msg_info_active_successfully,{folderLabel:t._activeFolder.label}),className:"success"})}).catch(function(e){console.log("Error: "+e)})}).catch(function(e){console.log("Error: "+e)})},setActiveFolder:function(e){var t=this;return t.services.setUserPreferences(t.ACTIVE_FOLDER_PREFERENCE,e.id).then(function(n){return t._activeFolder=e,null!=t._disabledActiveFolder.id&&(t._updateTreeIcons(t._disabledActiveFolder.id,null),t._disabledActiveFolder={id:null,label:"",node:null,sc:""}),o.setActiveFolder(t._activeFolder.id,t._activeFolder.label,t._activeFolder.sc,null),t._updateUI(t._activeFolder.label),null!=t._container&&t._container.show(),t._setCustomSecurityContext(),p.publish("FolderEditor.ActiveFolder",{id:t._activeFolder.id!==t.DEFAULT_VALUE?t._activeFolder.id:null,label:t._activeFolder.label,sc:t._activeFolder.sc}),n}).catch(function(e){console.log("Error: "+e)})},unsetActiveFolder:function(e){var t=this;return t.services.setUserPreferences(t.ACTIVE_FOLDER_PREFERENCE,t.DEFAULT_VALUE).then(function(e){var n=t._activeFolder.id!=t.DEFAULT_VALUE&&null!=t._activeFolder.id,i=null!=t._disabledActiveFolder.id,r=n?t._activeFolder:i?t._disabledActiveFolder:null;return null!=r&&t._updateTreeIcons(r.id,null),t._activeFolder={id:t.DEFAULT_VALUE,label:"",node:null,sc:""},n||(t._disabledActiveFolder={id:null,label:"",node:null,sc:""}),o.setActiveFolder(t.DEFAULT_VALUE,"","",t._disabledActiveFolder.id),n&&t._updateUI(t._disabledActiveFolder.label),null==t._disabledActiveFolder.id&&null!=t._container&&t._container.hide(),p.publish("FolderEditor.ActiveFolder",{id:null,label:"",sc:""}),e}).catch(function(e){console.log("Error: "+e)})},_unsetAfterError:function(e){this._disabledActiveFolder={id:null,label:"",node:null,sc:""},this.unsetActiveFolder().then(function(){0!=e&&d.displayNotification({...n.msg_error_rest_GetActiveFolder,className:"warning"})}).catch(function(e){console.log("Error: "+e)})},retrieveActiveFolderFromPreference:function(){var e=this;return e._getUserPreference().then(function(t){return t===e.DEFAULT_VALUE&&t.length===e.DEFAULT_VALUE.length?Promise.reject():(t.indexOf(e.DEFAULT_VALUE)>=0&&(t=t.slice(1,t.length),e._disabledActiveFolder={id:t,label:"",node:null,sc:""}),e._checkFolderStatus(t))}).then(function(t){return null!==e._disabledActiveFolder.id?(e._disabledActiveFolder.label=t.label,o.setActiveFolder(e.DEFAULT_VALUE,e._disabledActiveFolder.label,"",e._disabledActiveFolder.id),Promise.resolve(t)):(e._activeFolder=t,e._setCustomSecurityContext(),o.setActiveFolder(e._activeFolder.id,e._activeFolder.label,e._activeFolder.sc,e._disabledActiveFolder.id),u.publish("FolderEditor.ActiveFolder",Object.assign({},t,{node:""})),Promise.resolve(t))}).catch(function(t){e._unsetAfterError(!1)})},_getUserPreference:function(){return this.services.getUserPreferences(this.ACTIVE_FOLDER_PREFERENCE).then(function(e){return e.value}).catch(e=>(d.displayNotification({...e,className:"error"}),this.DEFAULT_VALUE))},_checkFolderStatus:function(e){var t=this;return new Promise(function(o,n){null!==e&&""!==e&&e!==t.DEFAULT_VALUE?t.services.getProperties({folderid:e,onComplete:function(e){void 0===e.id?n():o({id:e.id,label:e.label})},onFailure:function(e){n()}}):n()})},_setCustomSecurityContext:function(){if(g.useComputedSecurityContext()){var e=[],t=widget.getPreference("pad_security_ctx");if(t){var o=t.options;Array.isArray(o)?o.forEach(function(t){t.value&&e.push(t.value)}):this._logger.warn("The widget has no options for pad_security_ctx preference")}else this._logger.warn("The widget has no pad_security_ctx preference");var n="";if(e.length>0)try{n=g.computeSecurityContext(this._activeFolder.id,e)}catch(e){this._logger.warn("FolderEditorOpenness throws exception",e)}this._activeFolder.sc=n}else this._activeFolder.sc=""},activeFolderCallBack:function(e){var t=this;p.subscribe("FolderEditor.ActiveFolderCallBack",function(e){null!==e?d.displayNotification({message:n.replace(n.msg_info_defaultLocation,{folderLabel:e.label}),className:"info"}):p.publish("FolderEditor.ActiveFolder",{id:t._activeFolder.id!==t.DEFAULT_VALUE?t._activeFolder.id:null,label:t._activeFolder.label,sc:t._activeFolder.sc})}),p.subscribe("FolderEditor.ActiveFolderCheck",function(e){var o=t._activeFolder.id===t.DEFAULT_VALUE;t._checkFolderStatus(t._activeFolder.id).then(function(){},function(){null!==t._disabledActiveFolder.id?t._checkFolderStatus(t._disabledActiveFolder.id).then(function(){},function(){t._unsetAfterError()}):o||t._unsetAfterError()})})},services:{getUserPreferences:function(e){return new Promise(function(t,o){v.getUserPreferences({name:e,onComplete:function(o){t({keyname:e,value:o,message:null})},onFailure:function(t){o({keyname:e,value:null,...n.msg_error_rest})}})})},setUserPreferences:function(e,t){return new Promise(function(o,n){v.setUserPreferences({name:e,value:t,onComplete:function(n){o({keyname:e,value:t,message:null})},onFailure:function(e){n()}})})},getProperties:function(e){var t=m.get3DSpaceUrl()+"/resources/v1/FolderManagement/Folder/"+e.folderid+"/properties",o={method:"GET",type:"json",headers:{"Content-Type":"application/json",SecurityContext:widget.getPreference("pad_security_ctx").value},proxy:"passport",timeout:12e4};o.onComplete=e.onComplete,o.onFailure=e.onFailure,h.authenticatedRequest(t,o)}}});return D}),define("DS/FolderEditor/commands/ActionBar_ActiveFolderCmd",["UWA/Core","DS/ApplicationFrame/CommandCheckHeader","DS/FolderEditor/Folder_CSO","DS/FolderEditor/utils/FolderEditorcontrol","i18n!DS/FolderEditor/assets/nls/FolderEditor","DS/FolderEditor/views/FolderGlobalActiveBookmark"],function(e,t,o,n,i,r){"use strict";return t.extend({labelTopBar:"test",isInsert:!0,datas:{},_hasCommandBeenClicked:!0,init:function(e){var t=this;this._parent(e,{mode:"exclusive",isAsynchronous:!1}),r.init(),o.onChange(function(){t._onChangeCurrentFolder()}),this.onStateChange(function(){if(this._hasCommandBeenClicked){var e=o.getCurrentFolder();r.activeFolderCommand(e)}this._hasCommandBeenClicked=!0})},_onChangeCurrentFolder:function(){this._hasCommandBeenClicked=!1;var t=o.getCurrentFolder();if(t&&t.getID){var i=t.getID();if(e.is(n.getTreeCont())){var r=n.getTreeCont().isFolderActiveDefined(i);this.setState(r,!1)}}}})}),define("DS/FolderEditor/dataProvider/FolderFindInDataProvider",["UWA/Class","DS/FolderEditor/Folder_CSO","DS/FolderEditor/utils/FolderEditorcontrol","DS/FolderEditor/utils/FolderEditorEvents","DS/PADServices/utils/GlobalModelEvents","DS/FolderEditor/utils/FolderSearch","DS/ApplicationFrame/CommandsManager","DS/FolderEditor/service/FolderEditorWebService","DS/FolderEditor/service/FolderTypeService","DS/FolderEditor/tagger/TaggerContentProxy","i18n!DS/FolderEditor/assets/nls/FolderFindInTree","i18n!DS/FolderEditor/assets/nls/FolderFindInCtx"],function(e,t,o,n,i,r,a,s,l,d,c,u){"use strict";var p=i.getModelEvents();return e.singleton({NlsTree:c,autoCompleteKey:"BM_FindInTree_savedQueries",supportedSection:l.TYPE_FOLDERS_SECTION,unSupportedSection:l.TYPE_FAVORITES_SECTION,getSupportedTypesForDrop:function(){return["Workspace","Workspace Vault"]},getTreeGridView:function(){return o.getTreeCont()._folders_TreeView},getTreeVisibleNodesyId:function(e){return o.getTreeCont()._getVisibleNodeById(e)},getTreeSectionNodeForFind:function(){return o.getTreeCont()._folders_TreeDocument.getRoots()[1]},getTreeElementToAddCommand:function(){var e=o.getTreeCont().getContent(),t=null;return e&&(t=e.getElement(".FolderTree_Cont-root_treeview_container")),t},getTreeSelectedNode:function(){return t.getCurrentFolder()},expandTreeAndSelectNode:function(e){o.getTreeCont().expandTreeAndSelectFolder(e)},findTreeNodes:function(e){s._findBookmarksInBookmark(e)},onTreeFilterChange:function(e){p.subscribe({event:"filterUpdatedTree"},t=>{e(t.hasFilter)})},onCurrentSelectionChange:function(e){return n.onCurrentFolderChange(e)},NlsContent:u,getContentFilter:function(){return d.getProxy()},getContentGridView:function(){return o.getContent().getPADTreeListView().options.dgv},getTreeWidth:function(){var e=null;return o.getContent().folderLeftPanel.isLeftPanelOpen()&&(e=o.getTreeCont().getContent().offsetWidth),e},getContentTreeDocument:function(){return o.getContent().getPADTreeDocument()},findContentNodes:function(e){o.getContent().getPADTreeDocument()._findInCtx(e)},onContentFindClose:function(){a.getCommandCheckHeader("ActionBar_FindInCtxCmd").setState(!1,!1)},onContentSearchChange:function(e){return r.onSearchChange(e)},getContentColumnsToIgnore:function(){return["ContextualMenuColumn","isLastRevision","bookmarkLocation"]}})}),define("DS/FolderEditor/commands/ActionBar_FindinCtxCmd",["UWA/Core","DS/ApplicationFrame/CommandCheckHeader","DS/FolderEditor/commands/FolderCommands","DS/IPClassifyFindInContext/FindInContent","DS/FolderEditor/utils/FolderEditorcontrol","DS/FolderEditor/Folder_CSO","i18n!DS/FolderEditor/assets/nls/FolderFindInCtx","DS/IPClassifyUtil/IPClassifyAlert","DS/FolderEditor/utils/FolderSearch","DS/FolderEditor/dataProvider/FolderFindInDataProvider","DS/ApplicationFrame/CommandsManager"],function(e,t,o,n,i,r,a,s,l,d,c){"use strict";return c.getCommands("ColumnVisibility").onBegin(function(){c.getCommandCheckHeader("ActionBar_FindInCtxCmd").setState(!1,!1)}),t.extend({labelTopBar:e.i18n("FindinCtx"),isInsert:!0,datas:{},launchType:"ActionBar",findInCtx:null,init:function(t){var o=this;this._parent(t,{mode:"exclusive",isAsynchronous:!1}),i.getContent()&&this.onStateChange(function(){var n=!!i.getFindInCtx()&&i.getFindInCtx().visibleFlag;if(n&&!this.getState()&&i.getFindInCtx().close(),!n&&this.getState()){var r=o._getInformationforNodes(),s=r.nodes,l=r.isContentPresentInBookmark,c=r.findInBookmark,u=null;if(s.length>0||l){var p=o.getTitle(s,c);if(u={target:i.getContent().getPADTreeListView().getManager().getContent(),placeholder:a.placeholder_findInCtx,nodesForFindInCtx:s,title:p,findInBookmark:c,dataProvider:d,multiselection:i.getContent().options.multiselection},"ActionBar"!==o.launchType&&(t.position=o.position),null==o.findInCtx){var g=require("DS/IPClassifyFindInContext/FindInContent");o.findInCtx=new g,i.setFindInCtx(o.findInCtx)}o.findInCtx.buidUI(u)}o.launchType="ActionBar"}n&&this.getState()&&e.log("Panel is already launched")})},_getInformationforNodes:function(){var e=i.getContent().getSelectedNodes();if(0==e.length){var t=i.getContent().getPADTreeDocument().getRoots();return{nodes:this._getNodes(t,20),findInBookmark:!0,isContentPresentInBookmark:t.length>0}}return{nodes:this._getNodes(e,20),findInBookmark:!1,isContentPresentInBookmark:!0}},_getNodes:function(e,t){var o=[];if(e.length>0){if(widget.getPreference("allow-products-expand").value){for(var n=0;n<e.length;n++){if(!(o.length<t)){s.displayNotification({title:a.title_warning_FindInCtx_objectsLimit,message:a.replace(a.get("msg_warning_FindInCtx_objectsLimit"),{limit:t}),className:"info"});break}"VPMReference"==e[n].options.type&&o.push(e[n])}return o.length>0?o:[]}return[]}return s.displayNotification({title:a.title_warning_FindInCtx_novalidobject,message:a.msg_warning_FindInCtx_novalidobject,className:"warning"}),this.setState(!1,!1),[]},setLaunchType:function(e){this.launchType=e.type,this.position=e.position},getTitle:function(e,t){return t?r.getCurrentFolder().getLabel():1==e.length?e[0].options.label:e.length+" "+a.findInCtxSearchView.objects}})}),define("DS/FolderEditor/utils/FolderEditorKeyboardListener",["UWA/Core","UWA/Class","UWA/Event","DS/FolderEditor/utils/FolderEditorcontrol","DS/FolderEditor/commands/FolderCommands","DS/FolderEditor/ActionBar/FolderCommandManager","DS/FolderEditor/Folder_CSO","DS/FolderEditor/service/FolderTypeService","DS/Logger/Logger"],function(e,t,o,n,i,r,a,s,l){var d=function(){var e=document.activeElement;return!(!e||"INPUT"!==e.tagName&&"TEXTAREA"!==e.tagName)};launchCommandForKey=function(e,t){var o=r.getCommand(t),n=null;return o&&o.isEnabled()?d()?n="Info : '"+e+"' key pressed in INPUT field, no command launched":o.begin():n="Info : '"+e+"' key pressed, but command '"+t+"' is disabled",n};var c=t.extend({name:"FolderEditorKeyboardListener",init:function(e){this._parent(e),this._logger=l.getLogger(c)},startObservingKeyboard:function(){e.Element.addEvent.call(document,"keydown",this._onKeyDown.bind(this))},_onKeyDown:function(e){var t=o.whichKey(e),n=this.launchKeyAction(t);n&&!0===n.stopPropagation&&o.stop(e)},launchKeyAction:function(e){var t=this,o={stopPropagation:!1};switch(_launchCommandForKey=function(e,n,i){var r=launchCommandForKey(e,n);o.stopPropagation=!1!==i,r&&(t._logger.log(r),o.stopPropagation=!1)},e){case"ctrl+a":_launchCommandForKey(e,"SelectAll");break;case"del":_launchCommandForKey(e,"DeleteHdr");break;case"ctrl+c":_launchCommandForKey(e,"Copy",!1);break;case"ctrl+x":_launchCommandForKey(e,"Cut");break;case"ctrl+v":_launchCommandForKey(e,"Paste");break;case"ctrl+f":var r=n.getIdCardCont();r.isSearchAvailable()&&(r.switchSearch(!0),o.stopPropagation=!0);break;case"alt+return":_launchCommandForKey(e,"ActionBar_Attributes");break;case"f2":if(d())this._logger.log("Info : '"+e+"' key pressed in INPUT field, no command launched");else{var l=a.getSelectedNodes(),c=a.getCurrentFolder();if((Array.isArray(l)?l.length:0)>=1){var u=l[0];if(u&&s.inFamilyFolder(u.plmType))if(c.getID()==u.getID()){var p=n.getTreeCont();p&&p.switchFolderTreeNodeLabelToWriteView&&p.switchFolderTreeNodeLabelToWriteView(c)}else{var g=n.getContent();g&&g.switchFolderTreeNodeLabelToWriteView&&g.switchFolderTreeNodeLabelToWriteView(u)}else this._logger.log("Info : '"+e+"' key pressed but selected element is not a Folder, no command launched")}else this._logger.log("Info : '"+e+"' key pressed when no element selected, no command launched")}break;case"esc":i.escapCmd()}return o}});return c}),define("DS/FolderEditor/models/_xBookCVParser",["i18n!DS/PADUtils/assets/nls/PADUtils.json","DS/FolderEditor/models/xBookNodeModel","DS/PADServices/utils/AttributesMgtV2","DS/PADUtils/PADProbes","DS/PADUtils/PADCommandProxy","DS/WebappsUtils/WebappsUtils","DS/PADUtils/PADUtilsServices","DS/PADUtils/PADPredicatesNls","i18n!DS/ENXNav/assets/nls/ENXNav.json","DS/FolderEditor/utils/FolderSearch","DS/FolderEditor/utils/FolderEditorcontrol","DS/FolderEditor/utils/FolderEditorUtil","DS/PADServices/utils/GlobalModelEvents"],function(e,t,o,n,i,r,a,s,l,d,c,u,p){"use strict";var g={COLLAPSED:{state:"collapsed"},NO_CHILDREN:{state:"noChildren"},PARTIALLY_EXPANDED:{state:"partiallyExpanded"},EXPANDED:{state:"expanded"}};Object.freeze(g);var f="ds6w:Document",h={},m={};function v(e,t){var o=!1;if(UWA.is(e,"object")&&UWA.is(t,"array")){var n=0,i=t.length,r=e.getID();do{r===t[n].getID()&&(o=!0),n++}while(!1===o&&n<i)}return o}function _(e,t){for(var o={},n=e||{},i=Object.getOwnPropertyNames(n),r=0;r<i.length;r++)t[i[r]]?t[i[r]]!==e[i[r]]&&(o[i[r]]=e[i[r]]):o[i[r]]=e[i[r]];return o}function C(e,t,o){var n=!1,i=null,r={};t.label!==e.options.label&&(r.label=t.label,!0===require("DS/PADUtils/PADSettingsMgt").getSetting("tree_order_in_label")&&(r.label+="(treeorder="+t.relationOrder+")"),n=!0);(function(e,t){var o=!1;if(e instanceof Array&&t instanceof Array){var n=e.length;if(n===t.length){for(var i=0;i<n;i++)if(e[i]!==t[i])return!1;o=!0}}return o})(t.icons,e.options.icons)||(r.icons=t.icons,n=!0),t.thumbnail!==e.options.thumbnail&&(r.thumbnail=t.thumbnail,n=!0),t.display!==e.options.display&&(r.display=t.display,n=!0),t.type!==e.options.type&&(r.type=t.type,n=!0),null!==i||"expanding"!==e.getState()||o&&!1===o.changeState||(i=g.EXPANDED),e.isRoot()&&(t.grid=t.grid?t.grid:{},t.grid.instanceName||(t.grid.instanceName=""));var a=_(t.grid,e.options.grid);if(UWA.equals(a,{})||(r.grid=a,n=!0),t.padgrid){var l=_(t.padgrid,e.options.padgrid);UWA.equals(l,{})||(r.padgrid=l,n=!0)}n&&(o&&!0===o.deleteTempOptions&&(delete e.options.waiting4validation,delete e.options.alternText),e.updateOptions(r),e._manageNLS=!0,o&&o.needRequestNls&&e.isVisible()&&s.updateNLS(e)),i&&e.setState(i)}function S(e){for(var t=0,o=0;o<e.length;o++){t=e[o].options.grid.globaltype!==f?t+1:t}return t}function F(e,t){t._collapseRepDuringExpandAll=!0;for(var o=0;o<e.length;o++){var n=e[o];if(1===n.getNumberOfChildren())0===S(n.getChildren())&&n.collapse()}delete t._collapseRepDuringExpandAll}return h.buildStructure=function(e){var t={nodes:{},did_to_resourceid:{},structure:{}},o=[],n=[],i=[];e.results.forEach(function(e){if(e.attributes){var r={};e.attributes.forEach(function(e){"resourceid"===e.name||"physicalid"===e.name?r.resourceid=e.value:"did"===e.name&&(r.did=e.value)}),t.nodes[r.resourceid]=r,r.did&&(t.did_to_resourceid[r.did]=r.resourceid)}if(e.path){var a=e.path,s=a.length,l=a[0];if(3===s){a[1];var d=a[2];-1===n.indexOf(d)&&n.push(d)}-1===i.indexOf(l)&&i.push(l),o.push(a)}});var r=[],a=[],s={};try{i.forEach(function(e){0===n.length||-1===n.indexOf(e)?r.push(e):a.push(e),s[e]={children:[]},o.forEach(function(t){3===t.length&&e===t[0]&&s[e].children.push(t)})})}catch(e){console.error(e)}var l={};try{var d=function(e,o){var n=o[1],i=o[2],r=t.did_to_resourceid[n],a=t.did_to_resourceid[i];if(e&&void 0===e[r]&&(e[r]={},e[r][a]={},s[i])){var l=s[i].children;l&&l.forEach(function(t){d(e[r][a],t)})}};r.forEach(function(e){var o=t.did_to_resourceid[e],n={};s[e].children.forEach(function(e){d(n,e)}),l[o]=n})}catch(e){console.error(e)}return l},h.parse_expand=function(e,t,o,i,r){var a=n.createProbe("parse_expand"),s={nodes:{},did_to_resourceid:{},structure:{}};return e.forEach(function(e){if(e.attributes){var n=m.parse_attributes(e.attributes,t,o);s.nodes[n.resourceid]=n,UWA.is(n.did)&&(s.did_to_resourceid[n.did]=n.resourceid)}else if(e.path){var a;if(!1===i){a=e.path.length;var l=function(e){if(e){for(var t=Object.getOwnPropertyNames(e),o=0;o<t.length;o++)s.nodes[t[o]]&&(e[s.nodes[t[o]].did]=e[t[o]],delete e[t[o]],UWA.is(e[s.nodes[t[o]].did],"object")&&l(e[s.nodes[t[o]].did]),void 0===e.order&&(e.order=[]),e.order.push(s.nodes[t[o]].did));void 0===e.order&&(e.order=[])}};l(r),s.structure=r}else{var d=s.structure;a=e.path.length,1===Math.abs(a%2)?e.path.forEach(function(e,t){d.hasOwnProperty(e)||(d[e]={},a===t+1&&(d[e].pathLeaf=!0),0===Math.abs(t%2)&&(d[e].order=[])),d.order&&-1===d.order.indexOf(e)&&d.order.push(e),d=d[e]}):!0}}else e.icon__default_thumbnail_2d?e.icon__default_thumbnail_2d.forEach(function(e){e.did.forEach(function(t){var o=s.did_to_resourceid[t],n=s.nodes[o];n.icons&&0!==n.icons.length||(n.icons||(n.icons=[]),n.icons.push(e.icon)),n.thumbnail&&0!==n.thumbnail.length||(n.thumbnail=e.thumbnail_2d,n.grid||(n.grid={}),n.grid.thumbnail=e.thumbnail_2d)})}):e.status&&"EXPAND_WAS_CUT_MAX_OUTPUT_PATHS"===e.status&&(s.status={expandTooLarge:!0})}),a.end(),s},m.parse_attributes=function(e,t,o){var n=require("DS/PADUtils/PADSettingsMgt"),i={};let r=c.getContent().getPADTreeListView(),a=u._getManipulationColumns();return e.forEach(function(e){if("type"===e.name)e.name="ds6w:type";else if("owner"===e.name)e.name="ds6w:responsible";else{var s=e.name.split("/");e.name=s[s.length-1]}if(UWA.is(e.value)&&UWA.is(e.value.replace,"function")&&(e.value=e.value.replace(/\n/g," ")),"ds6w:type"===e.name&&(i.type=e.value),"resourceid"===e.name||"physicalid"===e.name)i.resourceid=e.value;else if("did"===e.name)i.did=e.value;else if("TreeOrder"===e.name||"ro.plminstance.V_treeorder"===e.name)i.relationOrder=parseFloat(e.value),i.relationOrder=isNaN(i.relationOrder)?-1:i.relationOrder;else if("type_icon_url"===e.name)i.icons||(i.icons=[]),i.icons.push(e.value);else if("preview_url"===e.name||"thumbnail_2d"===e.name)i.thumbnail=e.value,i.grid||(i.grid={}),i.grid.thumbnail=e.value;else if("relcount"===e.name)i.relcount=parseInt(e.value),0===i.relcount&&(i.children=null);else if(o&&e.name===o)i.label=e.value,i.display=i.label;else{var l=e.value;"string"==typeof l&&-1!==l.indexOf("[")&&-1!==l.indexOf("]")&&-1!==(l=(l=l.replace("[","")).replace("]","")).indexOf('"')&&(l=l.replaceAll('"',"")),i.grid||(i.grid={});let o=null,n=null;if(r){-1!==a.indexOf(e.name)&&(o=e.name+"_SortKey",n=l);let t=r.getColumnUnitNls(e.name,!0);t&&(l=l+" "+t)}var d=i.grid[e.name];if(d&&!Array.isArray(d)&&(d=[d]),Array.isArray(d)&&d.push(l),Array.isArray(d)?i.grid[e.name]=d:i.grid[e.name]=l,o){let e=i.grid[o];e&&!Array.isArray(e)&&(e=[e]),Array.isArray(e)&&e.push(n),Array.isArray(e)?i.grid[o]=e:i.grid[o]=n}t&&-1!==t.indexOf(e.name)||(i.padgrid||(i.padgrid={}),l=e.dispValue?e.dispValue:e.value,i.padgrid[e.name]=l)}n.getSetting("activateFUN085903")&&"ds6w:globalType"===e.name&&(i.grid=i.grid?i.grid:{},i.grid.globaltype=e.value)}),i.relationOrder||(i.relationOrder=-1),i.grid||(i.grid={}),i},m.process={expand:function(e){if(!UWA.is(e.treedocument,"object")||!UWA.is(e.root_nodes,"array")&&!0!==e.root2Create||!UWA.is(e.response,"object"))throw new Error("Invalid input parameters");if(!UWA.is(e.response.results,"array"))throw new Error("Invalid response format - results should be an array");e.starting_from_root=void 0===e.starting_from_root||e.starting_from_root;var i=[],r=[],a=require("DS/PADUtils/PADSettingsMgt"),l=a.getSetting("activateFUN085903")&&(-1===e.expand_level||e.expand_level>1),c=!0===a.getSetting("alwaysExpandPath"),u=e.selectPathLeaf;e.treedocument.prepareBroadcastSelect();var g=n.createProbe("transactionWithUpdate_expand");e.treedocument.withTransactionUpdate(function(){var a=null;if("refresh"===e.mode&&!1===e.response.full_path)if(e.needNewStructure)a=h.buildStructure(e.response);else{a={};for(var g=function(e,t){if(void 0===e[t.getRelationID()]){e[t.getRelationID()]={},e[t.getRelationID()][t.getID()]={};for(var o=t.getChildren(),n=0;o&&n<o.length;n++)g(e[t.getRelationID()][t.getID()],o[n])}},m=e.treedocument.getRoots(),_=0;_<m.length;_++){a[m[_].getID()]={};for(var S=m[_].getChildren(),y=0;S&&y<S.length;y++)g(a[m[_].getID()],S[y])}}var D,b=h.parse_expand(e.response.results,o.getAvailableColumns(),o.getTreeColumn(),e.response.full_path,a),E="expanded",w=!1,A=!1,T=e.expand_level;"find_in_ctx"===e.mode?(E="partiallyExpanded",w=!0,T=-1,D=[],l=!1):"refresh"===e.mode&&(T=-1,A=!0,l=!1);b.status&&(p.publish({event:"FolderEditor/expandStatus",data:{mode:e.mode,status:b.status}}),!0===b.status.expandTooLarge&&(!0,E="partiallyExpanded","function"==typeof e.setExpandStatus&&e.setExpandStatus({expandTooLarge:!0})));var x=function(t){for(var o=[],n=0;e.root_nodes&&n<e.root_nodes.length;n++)if(e.root_nodes[n].getID()===t){o=[e.root_nodes[n]];break}return o},P=function(e,t){var o=!1;t&&t.length>0&&(t=(t=t.trim().split("*").join("")).toLowerCase());try{var n=[];n.push(e.options.label),n.push(e.options.subLabel),n.push(e.options.description),n.push(e.options.type),n.push(e.options.grid["ds6w:cadMaster"]),n.push(e.options.grid["ds6wg:revision"]),e.options.grid["ds6w:status"]&&(-1!==e.options.grid["ds6w:status"].toLowerCase().indexOf("work")?(n.push("In Work"),n.push("IN_WORK")):n.push(e.options.grid["ds6w:status"])),n.push(e.options.grid.globaltype),e.options.grid["ds6w:description"]&&n.push(e.options.grid["ds6w:description"]),e.options.relationtype&&n.push(e.options.relationtype);var i=d.getAttrPredicateMap();i.size>0&&i.forEach(function(t){t&&e.options.grid[t]&&n.push(e.options.grid[t])});for(var r=0;r<n.length;r++)if(n[r]&&n[r].length>0&&-1!==n[r].trim().toLowerCase().indexOf(t)){o=!0;break}}catch(e){console.error(e)}return o},I=e.findInCtx_query,N=function(o,n,i,a){var s=n.getChildren(),d=A&&null!==s?[].concat(s):void 0,p=[],g=!1;!0===o.pathLeaf&&(I&&0!==I.length?(P(n,I)&&n.select(),UWA.is(e.addedPaths,"function")&&D.push(n.getOccurencePath())):(u&&n.select(),UWA.is(e.addedPaths,"function")&&D.push(n.getOccurencePath())));var h,m,_,S=o.order;if(S.length>0){var F,y=-1,T=[];if(s&&s.length>0)for(F=0;F<s.length;F++)T.push(s[F].options.relationOrder),s[F].options.relationOrder>y&&(y=s[F].options.relationOrder);-1===y&&(g=!0);var x=n.hasChildren()||n.options._childrenFilterInfo&&n.options._childrenFilterInfo.filteredOutChildren.length;for(F=0;F<S.length;F++){var U=S[F];if(void 0!==b.did_to_resourceid[U]){var O=b.did_to_resourceid[U],M=b.nodes[O].type,R=b.nodes[O].relationOrder,k=b.nodes[O],L=Object.getOwnPropertyNames(o[U])[0],W=b.did_to_resourceid[L],V=x?n.getChildByIds(O,W):null,B=!1;if(UWA.is(V,"object")){if(!0===A||!0===V.options.waiting4validation){var j=UWA.clone(b.nodes[W]);j.relationOrder=R,j.grid.instanceName=k.label,j.grid.instanceMatrix=void 0,k.instanceMatrix&&(j.grid.instanceMatrix=k.instanceMatrix),delete V.options.waiting4validation,delete V.options.alternText;var q={};!0===A&&(q.needRequestNls=!0),!0===c&&v(V,e.realExpandedNodes)&&(q.changeState=!1),C(V,j,q),p.push(V),("noChildren"===V.getState()||"expanded"===V.getState()&&(V.options.children&&0===V.options.children.length||null===V.options.children))&&(V.setState({state:"collapsed"}),V.options.children=[])}d&&(m=V,_=void 0,-1!==(_=(h=d).indexOf(m))&&h.splice(_,1))}else{B=!0;var H=UWA.clone(b.nodes[W]);if(H.relationid=O,H.relationtype=M,H.relationOrder=R,H.grid.instanceName=k.label,k.instanceMatrix&&(H.grid.instanceMatrix=k.instanceMatrix),!0===require("DS/PADUtils/PADSettingsMgt").getSetting("tree_order_in_label")&&(H.label+="(treeorder="+R+")"),V=new t(H),R>=y)n.addChild(V),y=R,T.push(R);else{var z=null,G=n.getChildren();if(G)for(var X=0,J=G.length;X<J;X++)if(T[X]>R){z=G[X],T.splice(X,0,R);break}n.insertBefore(V,z)}!0===g&&p.push(V),V._manageNLS=!0}l&&V.options.grid.globaltype===f&&r.push(n);var K=-1===a?a:a-1;(K>0||-1===K)&&(B||V.getTreeDocument())&&N(o[U][L],V,i,K)}}var Y=v(n,e.realExpandedNodes),Q=function(e,t,o){var n=!1;if(UWA.is(e,"object")&&UWA.is(t,"array")){var i=0,r=t.length,a=!1;do{if(e.isDescendantOf(t[i])){if(n=!0,-1!==o){n=!1;var s=e.getOccurencePath(),l=s.indexOf(t[i].getID());(s.length-l)%2<=o&&(n=!0)}a=!0}i++}while(!1===a&&i<r)}return n}(n,e.realExpandedNodes,i);n.childComputed=!0,!0!==A&&!0===c&&(Y||Q||w)&&(n.setState({state:E}),n.options.padstate=E)}else if(!0!==A){var Z=n.getDepth();i&&(-1===i||i>Z)?w?(n.childComputed=!1,I&&0!==I.length?n.isSelected()||P(n,I)&&n.select():n.select()):!0===c?-1===i?(n.childComputed=!0,n.options.children=null,n.setState({state:"noChildren"}),n.options.padstate="noChildren",n._expandState="noExpandState"):S.length&&(n.setState({state:E}),n.options.padstate=E):(n.childComputed=!0,n.options.children=null,n.setState({state:"noChildren"}),n.options.padstate="noChildren",0!==Z&&-1!==i||(n._expandState="noExpandState")):null!==n.options.relcount&&0===n.options.relcount&&(n.setState({state:"noChildren"}),n.options.padstate="noChildren",n.childComputed=!0,n.options.children=null,w&&(I&&0!==I.length?n.isSelected()||P(n,I)&&n.select():n.select()))}null!=d&&d.length>0&&d.forEach(function(e){null!==e&&n.removeChild(e)})},U=Object.getOwnPropertyNames(b.structure),O=UWA.clone(e.root_nodes?e.root_nodes:[],!1),M=n.createProbe("treat_expand");if(U.length>0)for(var R=0;R<U.length;R++){var k=U[R];if(b.did_to_resourceid.hasOwnProperty(k)){var L=x(b.did_to_resourceid[k]);0!==L.length?(L.forEach(function(t){if(void 0!==t){var o=O.indexOf(t);o>-1&&O.splice(o,1);var n,i=b.nodes[b.did_to_resourceid[k]],r=b.structure[k];N(r,t,T,T),!0===c&&v(t,e.realExpandedNodes)&&(n={changeState:!1}),C(t,i,n),delete t._manageNLS,s.updateNLS(t)}}),l&&F(r,e.treedocument),UWA.is(e.addedPaths,"function")&&e.addedPaths(D),UWA.is(e.hideToggleNodes,"function")&&e.hideToggleNodes(i)):console.error("Invalid root id: "+k)}}e.treedocument.pushBroadcastSelect(),M.end()}),g.end()},insert_temporary_branches:function(e){if(!UWA.is(e.treedocument,"object")||!UWA.is(e.branches,"array"))throw new Error("Invalid input parameters");var o=[],n=[],i=[],a=[],s=[],d=e.treedocument,c=e.node_state?e.node_state:"partiallyExpanded",u=e.branches;return d.withTransactionUpdate(function(){u.forEach(function(d){var u,p=null,g=e.treedocument.getRoots(),f=0;for(u=0;u<g.length&&null===p;u++)if(d[0]===g[u].getID()){a.push(d[0]);var h=(p=g[u]).getNodeByPath(d,void 0,void 0,!0);h&&(p=h,f=d.indexOf(p.getID()))}if(p&&p.getID()!==d[d.length-1])for(var m=f+1;m<d.length;m+=2){var v=d[m],_=d[m+1],C={resourceid:_,relationid:v,label:l.loadingText,icons:[r.getWebappsAssetUrl("ENXNav","icons/32/loading22x22.gif")],thumbnail:r.getWebappsAssetUrl("ENXNav","icons/32/loading.gif"),alternText:l.loadingText,waiting4validation:!0},S=new t(C),F=p.getState();p.addChild(S),"collapsed"===F?(c!==F&&(p.setState({state:c}),p.options.padstate=c),p.childValidationChecker()):"partiallyExpanded"===F&&(p.setState({state:F}),p.options.padstate=F,-1===n.indexOf(_)&&n.push(_),-1===i.indexOf(v)&&i.push(v)),p=S,-1===o.indexOf(_)&&o.push(_),-1===s.indexOf(v)&&s.push(v)}})}),{ids_to_fetch:o,relationids:s,rootsAlreadyLoaded:a,visibleNodesIds:n,visibleNodesRelIds:i}},refresh_nodes:function(e){if(!UWA.is(e.treedocument,"object")||!UWA.is(e.response,"object")||!UWA.is(e.refresh_parameters,"object"))throw new Error("Invalid input parameters");var t=[],n=function(e,t){var n=m.parse_attributes(t.attributes,o.getAvailableColumns(),o.getTreeColumn());return n&&0===n.relcount&&(n.children=null),n};require("DS/PADUtils/PADSettingsMgt");return e.treedocument.withTransactionUpdate(function(){e.response.results.forEach(function(o){for(var i="",r=0;r<o.attributes.length;r++){var a=o.attributes[r];if("resourceid"===a.name){i=a.value;break}}if(""===i)throw new Error("Resourceid not found in fetch result for "+JSON.stringify(o));if(e.refresh_parameters.modified&&(-1!==e.refresh_parameters.modified.indexOf(i)||-1!==e.ids_modified.indexOf(i))){e.treedocument.getRoots().forEach(function(e){e.getNodesById(i).forEach(function(e){e.updateOptions(n(0,o)),s.updateNLS(e),null===e.options.children&&e.setState({state:"noChildren"}),t.push(e)})});var l=e.treedocument.searchRootById(i);l&&(l.updateOptions(n(0,o)),s.updateNLS(l),e.treedocument.getModelEvents().publish({event:"onRootAdded",data:{nb_root:e.treedocument.getRoots().length,added_node:l}}),t.push(l))}})}),[]},validateAndUpdateBranches:function(e){if(!UWA.is(e.treedocument,"object")||!UWA.is(e.response,"object"))throw new Error("Invalid input parameters");if(!UWA.is(e.response.results,"array"))throw new Error("Invalid response format - results should be an array");var t=n.createProbe("transactionWithUpdate_validateBranch"),i=e.forcePartiallyExpanded;e.treedocument.withTransactionUpdate(function(){var t=h.parse_expand(e.response.results,o.getAvailableColumns(),o.getTreeColumn(),e.response.full_path),r=function(t){for(var o=null,n=e.treedocument.getRoots(),i=0;i<n.length;i++)if(n[i].getID()===t){o=[n[i]];break}return o},a=function(e,o){var n=o.getChildren(),r=e.order;if(r.length>0){for(var l=-1,d=[],c=0;null!==n&&c<n.length;c++)d.push(n[c].options.relationOrder),n[c].options.relationOrder>l&&(l=n[c].options.relationOrder);for(var u=0;u<r.length;u++){var p=r[u];if(t.did_to_resourceid.hasOwnProperty(p)){var g=t.did_to_resourceid[p],f=t.nodes[g].relationOrder,h=t.nodes[g],m=Object.getOwnPropertyNames(e[p])[0],v=t.did_to_resourceid[m],_=o.getChildByIds(g,v);if(!UWA.is(_,"object")){console.error("All nodes should have been created");break}var S=UWA.clone(t.nodes[v]);S.grid.instanceName=h.label,h.instanceMatrix&&(S.grid.instanceMatrix=h.instanceMatrix),C(_,S,{deleteTempOptions:!0}),_.isVisible()&&s.updateNLS(_),!0===i&&"expanded"===_.getState()&&_.setState({state:"partiallyExpanded"});var F=_.getLabel();!0===require("DS/PADUtils/PADSettingsMgt").getSetting("tree_order_in_label")&&(F+="(treeorder="+opts_2_modified.relationOrder+")"),_.updateOptions({label:F,relationOrder:f});var y=_.getParent(),D=_.getBrothers(),b=y.getChildren();if(b.length>1)for(var E=0;E<D.length;E++)if(D[E].options.relationOrder>_.options.relationOrder){var w=b.indexOf(_);if(b.indexOf(D[E])<w){var A=y.removeChild(_);y.insertBefore(A,D[E]);break}}a(e[p][m],_,-1)}else console.error("Invalid CV id ["+p+"]")}}},l=Object.getOwnPropertyNames(t.structure),d=n.createProbe("treat_expand");if(l.length>0)for(var c=0;c<l.length;c++){var u=l[c];if(t.did_to_resourceid.hasOwnProperty(u)){var p=r(t.did_to_resourceid[u]);void 0!==p?p.forEach(function(o){if(void 0!==o){C(o,t.nodes[t.did_to_resourceid[u]],{deleteTempOptions:!0}),s.updateNLS(o),!0===i&&"expanded"===o.getState()&&o.setState({state:"partiallyExpanded"});var n=e.treedocument.getRoots().length;UWA.is(e.treedocument.detachedRoots,"array")&&(n+=e.treedocument.detachedRoots.length),e.treedocument.getModelEvents().publish({event:"onRootAdded",data:{nb_root:n,added_node:o}});var r=t.structure[u];a(r,o,-1)}}):console.error("Invalid root id: "+u)}}d.end()}),t.end()}},m}),define("DS/FolderEditor/utils/FolderListContent_Read",["UWA/Utils","DS/FolderEditor/tagger/TaggerContentProxy","DS/FolderEditor/tagger/TaggerTreeProxy","DS/FolderEditor/service/FolderEditorWebServiceReadMode"],function(e,t,o,n){return{listContent:function(e){var i=null;let r=t.getFilterTags();if(e.filters=r,"FolderSection_AllFolders"==e.pid){e.contentView=!0;let a=o.getFilterTags(),s=t.hasANDConditionInRefine(a,r);e.filters={...a,...r},s?e.onComplete(JSON.stringify({infos:{},results:[]})):i=n.getRoots(e)}else"Yes"!==e.filterChildren?i=n.getContentReadMode({exceptIds:e.exceptIds,content:e.content,synthesis:e.synthesis,filterChildren:e.filterChildren,next_start:e.next_start,pid:e.pid,filters:e.filters,onComplete:e.onComplete,onFailure:e.onFailure}):e.synthesis||(i=this.getContentFilterOn(e));return i},getContentFilterOn:function(e){var t=this,o=n.listContent_ExpandLevel_1({pid:e.pid,content:e.content,onComplete:function(n){var i=JSON.parse(n);o=t._getFilteredData(e.pid,i).then(function(o){var n=t._getResultantData(i,o);e.onComplete(JSON.stringify(n))})},onFailure:function(){}});return o},_generateIconMap:function(e){var t=new Map;e.results;if(e.results[e.results.length-1].hasOwnProperty("icon__default_thumbnail_2d"))for(var o=e.results[e.results.length-1].icon__default_thumbnail_2d,n=0;n<o.length;n++){var i=o[n],r=new Map;i.hasOwnProperty("icon")&&r.set("icon",i.icon),i.hasOwnProperty("thumbnail_2d")&&r.set("thumbnail_2d",i.thumbnail_2d),i.did.forEach(function(e){t.set(e,r)})}return t},_getResultantData:function(e,t){for(var o={},n=[],i=e.results,r=0;r<i.length;r++){var a=i[r].attributes;if(a)for(var s=0;s<a.length;s++){var l=a[s];if("physicalid"==l.name&&t.indexOf(l.value)>-1){n.push({attributes:a});break}}}return o.results=n,o},_getFilteredData:function(e,t){var o=[],i=[],r=[],a=this._generateIconMap(t);return new Promise(function(s,l){for(var d=t.results,c=0;c<d.length;c++){var u=d[c].attributes,p=!1;if(u){for(var g=0;g<u.length;g++){if("did"==(C=u[g]).name){var f=C.value,h=a.get(f),m={};h&&h.has("icon")&&(m.name="icon",m.value=h.get("icon"),u.push(m));var v={};h&&h.has("thumbnail_2d")&&(v.name="thumbnail_2d",v.value=h.get("thumbnail_2d"),u.push(v))}"ds6w:type"==C.name&&("Workspace"!=C.value&&"Workspace Vault"!=C.value||(p=!0))}for(var _=0;_<u.length;_++){var C;if("physicalid"==(C=u[_]).name&&C.value&&C.value!==e){if(p){r.push(C.value);break}i.push(C.value);break}}}}i.length>0?n.filterFolder({pid:e,prd:i,onComplete:function(e){var t=JSON.parse(e),o=(t.physicalId?t.physicalId:[]).concat(r);s(o)},onFailure:function(e){console.log(e)}}):(o=i.concat(r),s(o))})}}}),define("DS/FolderEditor/models/FolderInfo",["UWA/Controls/Abstract","UWA/Class/Options","DS/FolderEditor/utils/FolderEditorcontrol","DS/FolderEditor/service/FolderEditorWebService"],function(e,t,o,n){"use strict";var i=e.extend(t,{_id:null,_type:null,_label:null,init:function(e){this._parent(e),this._id=e.id,this._type=e.type,this._label=e.label},getID:function(){return this._id},getType:function(){return this._type},getLabel:function(){return this._label},getChildrenInfos:function(e){var t,r=[];(t=o.getTreeCont()._getVisibleNodeById(this._id))?(t.getChildren().forEach(function(e){r.push(new i({id:e.getID(),type:e.plmType||"Folder",label:e.getLabel()}))}),e.onComplete(r)):n.folders({pid:this._id,onComplete:function(t){(t=JSON.parse(t)).folders.forEach(function(e){r.push(new i({id:e.id,type:e.type||"Folder",label:e.label}))}),e.onComplete(r)},onFailure:function(t){console.warn("WebService folders Err : "+t),e.onFailure(t)}})}});return i}),define("DS/FolderEditor/FolderIdCardCont",["UWA/Core","DS/IPClassifyUXUtil/ActionBar/IPToolbar","UWA/Class/Options","DS/FolderEditor/views/FolderMode","DS/FolderEditor/service/FolderTypeService","DS/FolderEditor/utils/FolderEditorEvents","DS/FolderEditor/utils/FolderEditorcontrol","DS/FolderEditor/ActionBar/FolderCommandManager","DS/FolderEditor/commands/FolderCommands","i18n!DS/FolderEditor/assets/nls/FolderEditor","DS/IPClassifyUtil/IPClassifyAlert","DS/FolderEditor/Folder_CSO","DS/FolderEditor/models/FolderInfo","DS/FolderEditor/utils/FolderSearch","DS/PADUtils/PADProbes","DS/FolderEditor/utils/FolderEditorUtil","DS/Tweakers/GeneratedToolbar","DS/PADServices/utils/GlobalModelEvents"],function(e,t,o,n,i,r,a,s,l,d,c,u,p,g,f,h,m,v){"use strict";function _(e){console.log(e)}return t.extend(o,{name:"enoFolderIdCard_Container",_currentPathNodes:null,_dropFolder:null,_dropPartIDs:null,_counter:0,_probeLoadElmt:null,getCommandManager:function(){return s},createPathInfo:e=>new p({id:e.id,mxid:e.mxid,type:e.type,label:e.label}),getEntryForCommand:e=>{var t=null;return"IndexMode"===e&&(t=n.getToolbarEntry()),t},init:function(e){a.setIdCardCont(this),this._probeLoadElmt=f.createProbe("loadIdCard");var t=this,o=h.getLeftPanelStatus(),n=h.getRightPanelStatus();widget.addEvent("ontoolbarReady",()=>{var t=h.getDefaultView(),o=s.getCommand(t);o&&o.options.icon&&e.modelEvents.publish({event:"toolbar_update_command",data:{commandID:"display",data:{grid:{data:t}}}})}),e.leftOpened=o&&o.leftPanelState,e.rightOpened=n&&n.rightPanelState,e.modelEvents=v.getModelEvents(),e.searchInCurrentTab=!0,this._parent(e),this._buildSkeleton(),e.modelEvents.subscribe({event:"searchValueSet"},g.changeSearch.bind(g)),r.onCurrentFolderChange(function(e){var o=f.createProbe("idcard_updateUI");t.setCurrentLocation(),o.end()}),this.dispatchEvent.call(this,"onReady"),this._probeLoadElmt.end()},inject:function(){this._parent.apply(this,arguments),this.setCurrentLocation()},setCurrentLocation:function(){var e=u.getCurrentFolderPath();this._parent({objectPath:e})},isSearchAvailable:function(e){if(e||(e=u.getCurrentFolder()),!e)return!1;var t=i.isSection(e.getType());return!!i.isAllBookmarksSection(e.getType())||!t&&e.options.mxid},render:function(){return this},_buildSkeleton:function(){this.topRightSideDiv=document.getElementsByClassName("FolderEditor_top_right_side_div"),r.subscribeEvents(),this.topRightSideDiv[0].addEventListener("dragover",this._onDragOver,!0),this.topRightSideDiv[0].addEventListener("drop",this._onDrop,!0),this.topRightSideDiv[0].addEventListener("dragenter",this._onDragEnter,!0),this.topRightSideDiv[0].addEventListener("dragleave",this._onDragLeave,!0),this.topRightSideDiv[0].addEventListener("contextmenu",this._rightClick)},_rightClick:function(e){var t=e?e.target:null;return(!t||"INPUT"!==t.tagName&&"TEXTAREA"!==t.tagName)&&(e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault()),!1},_onDragOver:function(e,t,o,n){return e.preventDefault&&e.preventDefault(),!1},_onDragEnter:function(e,t,o,n){a.getIdCardCont();e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault();var i=e.target?e.target:e.detail.target;return a.getIdCardCont()._updateBorderDnD(i,!0),!0},_onDragLeave:function(e,t,o,n){return e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault(),a.getIdCardCont()._updateBorderDnD(e.target,!1),!0},_onDrop:function(e,t,o,n){var i,r=!1,s=a.getIdCardCont();return e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault(),a.getIdCardCont()._updateBorderDnD(e.target,!1),u.getCurrentFolder()&&"FolderSection_Trash"===u.getCurrentFolder().plmType?(c.displayNotification({message:d.msg_warning_dndnotsupported,className:"error"}),!1):(g.isSearchActive()||(i=s._getSerializedData(e))&&(r=s._performDropAction(i)),r)},_updateBorderDnD:function(e,t){var o=this.elements.titleIdCard_container;e&&(t?(this._counter=this._counter+1,o.addClassName("dropallowed_elem")):(this._counter=this._counter-1,0===this._counter&&o.removeClassName("dropallowed_elem")))},_performDropAction:function(e){var t,o,n=null;return(n=1===(t=e.data.items.length)?(o=e.data.items[t-1]).path?this._expandDroppedPath(o):this._expandDroppedItem(o):{isDropped:!1,msg:t>1?d.msg_warning_MultipleSelection:d.msg_warning_dndnotsupported}).isDropped||c.displayNotification({message:n.msg,className:"error"}),n.isDropped},_expandDroppedItem:function(e){var t,o,n,i,r=!1,s=null;(t=e.objectId,n=e.displayName||"",o=this._getObjectDroppedType(e),t&&o)?(i=a.getTreeCont(),r=!0,t!==u.getCurrentFolderID()&&i.expandTreeAndSelectFolder({folderToFindAndSelect:{ids:[t],type:o,name:n},onComplete:_.bind(null," expandTreeAndSelectFolder:onComplete"),onGiveUp:_.bind(null," expandTreeAndSelectFolder:onGiveUp"),onFailure:function(e){c.displayNotification({title:d.replace(d.msg_error_FolderActivate.Title,{name1:n}),subtitle:d.msg_error_FolderActivate.Advice,className:"error"})}})):(r=!1,s=d.msg_warning_notProductRoot);return{isDropped:r,msg:s}},_getObjectDroppedType:function(e){var t,o,n,r=null;if(t=e.objectType_Internal||e.objectType,Array.isArray(t)&&t.length>0){for(o=t.length,n=0;n<o;++n)if(i.inFamilyFolder(t[n])){r=t[n];break}}else i.inFamilyFolder(t)&&(r=t);return r},_expandDroppedPath:function(e){var t,o,n,i,r,s,l=!1,c=null,p=0,g=!1;if(this._dropFolder=null,this._dropPartIDs=[],(t=e.path)&&t.length>0){if(n=t.length,s=this._getLastIndexOfFolder(t),i=u.getCurrentFolder(),r=u.getCurrentFolderID(),o=this._getObjectDroppedType(e),-1===s&&!i&&!o)return{isDropped:!1,msg:d.msg_warning_nocurrentfolder};if(s>=0?(this._dropFolder={id:t[s].resourceid,type:t[s].type,displayName:t[s].displayName||""},s+1<n&&(p="Vaulted Objects"===t[s+1].type?s+2:s+1,this._setProductsIDsPath(p,t)),g=r!==this._dropFolder.id):(this._dropFolder=o?{id:e.objectId,type:o,displayName:e.displayName||""}:{id:r,type:i.getType(),displayName:i.getLabel()||""},g=r!==this._dropFolder.id,this._setProductsIDsPath(p,t)),l=!0,g)this._expandNodeOfPath(this._dropFolder);else if(this._dropPartIDs.length>0){a.getContent().expandBranches(this._dropPartIDs)}}else l=!1,c=d.msg_warning_dndnotsupported;return{isDropped:l,msg:c}},_getLastIndexOfFolder:function(e){var t,o=-1,n=e.length;for(t=0;t<n;++t)i.inFamilyFolder(e[t].type)&&(o=t);return o},_setProductsIDsPath:function(e,t){var o,n=t.length;for(o=e=e>-1?e:0;o<n;++o)this._dropPartIDs.push(t[o].resourceid)},_getSerializedData:function(e){var t,o,n,i,r,a="";for(o=e.dataTransfer?e.dataTransfer:e.detail?e.detail:null,n=UWA.is(o.types.indexOf,"function")?"indexOf":"contains",i=["text/searchitems","text/plain","Text"],t=0;t<i.length&&""===a;t++){var s=o.types[n](i[t]);(UWA.is(s,"number")&&s>=0||UWA.is(s,"boolean")&&!0===s)&&(a=i[t])}return""!==a&&(r=o.getData(a)),r&&r.length?JSON.parse(r):null},_expandNodeOfPath:function(e){var t,o=this;return!(!(t=a.getTreeCont())||!e)&&(t.expandTreeAndSelectFolder({folderToFindAndSelect:{ids:[e.id],type:e.type,name:e.displayName},onComplete:function(e){var t=a.getContent();o._dropPartIDs.length>0&&t.addEvent("onCompleteRefreshNodes",function(e){this.removeEvent("onCompleteRefreshNodes"),o._dropFolder.id===e&&this.expandBranches(o._dropPartIDs)})},onGiveUp:function(e){console.log("expandTreeAndSelectFolder: onGiveUp")},onFailure:function(t){c.displayNotification({title:d.replace(d.msg_error_FolderActivate.Title,{name1:e.displayName}),subtitle:d.msg_error_FolderActivate.Advice,className:"error"})}}),!0)}})}),define("DS/FolderEditor/xBookDocument",["UWA/Core","DS/Logger/Logger","DS/i3DXCompassServices/i3DXCompassPubSub","DS/IPClassifyUXUtil/CredentialsView","DS/PADUtils/PADSettingsMgt","DS/PADUtils/PADUtilsServices","DS/WidgetServices/WidgetServices","DS/Tree/TreeDocument","DS/FolderEditor/models/xBookNodeModel","DS/FolderEditor/models/_xBookCVParser","DS/PADUtils/PADWSAccess","DS/PADUtils/PADPredicatesNls","DS/IPClassifyUtil/IPClassifyAlert","DS/Utilities/Array","DS/PADUtils/PADCommandProxy","DS/PADUtils/PADTransactionManager","DS/PADUtils/PADSession","DS/PADUtils/PADProbes","DS/PADUtils/views/PADPager","DS/PADUtils/Utility","DS/ApplicationFrame/CommandsManager","i18n!DS/PADUtils/assets/nls/PADUtils.json","i18n!DS/ENXNav/assets/nls/ENXNav.json","DS/FolderEditor/utils/FolderSearch","DS/FolderEditor/utils/FolderEditorcontrol","DS/FolderEditor/utils/FolderLoaderGlobal","DS/FolderEditor/tagger/TaggerContentProxy"],function(e,t,o,n,i,r,a,s,l,d,c,u,p,g,f,h,m,v,_,C,S,F,y,D,b,E,w){"use strict";function A(e){e.preExpandDone({preventExpandAll:!1,state:"collapsed"})}function T(e){var t=S.getCommand("ExpandAll");t&&(e?t.enable():t.disable())}return s.extend(h,{_broadcastSelect:!0,_selected_paths:[],id:"mainNodeModel",_insertFlag:!1,_selection:[],_selectedIdx:null,_focusOn:!1,_reframeFocus:!1,_currentApp:null,_emptyFromProxy:!1,_isVolumeFilter:!1,init:function(o){var n=o||{},i=this;if(this._logger=t.getLogger("DS/FolderEditor/xBookDocument"),i.renderTo=o.renderTo?o.renderTo:document.body,n.nodeModelClass=l,this._parent(n),this.options.viewport={graph:null,tree:null},this.onPreExpand(this.xnav_expand.bind(this)),this.forceSyncModel4TreeListView=function(){},this.addEvent("onTransactionEnd",function(e,t){t||("expand"!==e&&"refresh"!==e||i.addTagsForChildren(),i.fromTransactionEnd=!0)}),!e.is(n.remove_broadcast)||!0===n.remove_broadcast){i._commandProxy=f.create({events:{onSelect:function(t,o){if(!i._insertFlag&&(a.isReplayedODT()||o.originWidgetId!==widget.id)&&!0!==t.searchDone){if(1==t.focusOn&&t.sharedID&&t.sharedID!==r.getSharedId())return;var n=t.paths;i._selected_paths=e.clone(n);!function(){try{i._doNotBroadcastSelect=!0,i._selected_paths.length?i._selectOccurence("",!0,!0):o.appid===f.appId()&&(i._emptyFromProxy=!0,i.unselectAll(),i._directSelection=!1);for(var e=[],t=0;t<i._selected_paths.length;t++)i.getNodeByOccurencePath(i._selected_paths[t])&&e.push(i._selected_paths[t]);e.length===n.length&&e.length>0&&e.forEach(function(e){var t=e.length;if(t>2){var o=i.getNodesById(e[t-3]);o&&o.length>0&&!0}}),i._selected_paths=e}finally{setTimeout(function(){i._doNotBroadcastSelect=!1},500)}}()}}}});var s=function(){i._doNotBroadcastSelect||(i._directSelection=!0,i._selected_paths=[],!0!==i.searchProgress&&i._commandProxy.select(i._buildSelectData()),i.broadcastSelect(i.getXSO().get())),0===i.getSelectedNodes().length&&!0!==i._focusOn&&!0!==i._reframeFocus&&(i._reframeFocus=!1,i._commandProxy.closePager({sharedID:r.getSharedId()}))};this.getXSO().onPostAdd(function(){s(),i._focusOn=!1}),this.getXSO().onPostRemove?this.getXSO().onPostRemove(s):this.getXSO().onRemove(s),this.getXSO().onEmpty(function(){!1===i._emptyFromProxy?i._doNotBroadcastSelect=!1:i._emptyFromProxy=!1,s()}),this.getXSO().onPreEmpty(function(){!1===i._emptyFromProxy&&(i._doNotBroadcastSelect=!0)}),document.addEventListener("keyup",function(e){27===e.keyCode&&i.getXSO().empty()})}},addTagsForChildren:function(){var e=[],t=[];this.getRoots(!0).forEach(o=>{o.getAllDescendants().forEach(t=>{t.isRelationsObjectNode||e.push(t.getID())}),o.isVisible()&&t.push(o.getID())}),e.length>0&&w.addObjectsTags(e).then(e=>{this.filterFromIds([...e,...t],!1)})},filterFromIds:function(e,t){this.wrapInTransaction(()=>{this.withTransactionUpdate(()=>{var o=new Set(e),n=this.getRoots(!0).slice(0);n.forEach(function(e){e.filterIn(!0)});var i=function(e){(o&&o.has(e.getID())||e.isRoot()&&t||e.isRelationsObjectNode)&&(e._filterStatus="IN",!0!==e.isRelationsObjectNode&&e.getParents().forEach(function(e){e._filterStatus="IN"}));var n=e.getChildren();n&&n.length>0&&n.slice(0).forEach(function(e){i(e)})},r=function(e){if("IN"===e._filterStatus){var t=e.getChildren();t&&t.length>0&&t.slice(0).forEach(function(e){r(e)})}else e.filterOut();delete e._filterStatus};n.forEach(function(e){i(e)}),n.forEach(function(e){r(e);var t=!1;if(e.options._childrenFilterInfo){var o=e.options._childrenFilterInfo.filteredOutChildren;o&&o.length>0&&(t=!0)}t&&(e.setState({state:"partiallyExpanded"}),e.options.padstate="partiallyExpanded")})})})},getSelectedNodesForOFW:function(){var e=[],t=this._selected_paths;t&&t.length&&this.getXSO().get().length?this.getRoots().forEach(function(o){for(var n=0;n<t.length;n++){var i=o.getNodeByPath(t[n],void 0,void 0,!0);i&&e.push(i)}}):e=this.getXSO().get();return e},_getLastViewpoint:function(e){e(null)},broadcastSelect:function(e){if(e=e||this.getSelectedNodes(),!0===this._broadcastSelect&&!0===this.options.authorize_setStructure)if(r.setObject_on_compass({nodes_2_open:e}),!1===i.getSetting("settypes"))r.setStructure_4_open_in_cv5({nodes_2_open:e,selected_paths:this._selected_paths});else if(function(e){for(var t=0;t<e.length;t++){if("VPMReference"!=e[t].options.type)return!1;if(t==e.length-1)return!0}}(e))r.setTypesForOFW(this);else if(e&&e.length>0){var t={objectId:e[0].getID(),envId:r.getPlatformId(),contextId:n.getCredential(),serviceId:"3DSpace"};o.publish("setObject",t)}},prepareBroadcastSelect:function(){this._doNotBroadcastSelect=!0},pushBroadcastSelect:function(){!0!==this.searchProgress&&this._commandProxy.select(this._buildSelectData()),this.broadcastSelect(),this._doNotBroadcastSelect=!1},_findInCtx:function(t){var o=this;require(["DS/PADServices/ws/WSAccess","DS/PADServices/utils/PlatformURL"],function(n,r){o.searchProgress=!0,o.prepareUpdate(),o.prepareBroadcastSelect(),o._selection=[],o.getXSO().empty();var a,s=i.getWebAPI_Options("navigate");o._flatNodes=[],a=n.findInCtx?Promise.resolve():r.retrievePlatformUrl({addDefaults:!0,initWSAcess:!0});var l=t.highLightNodes,c=function(e){return new Promise(function(o,n){e<t.nodes.length?u(e).then(function(){c(e+1).then(o).catch(n)}):o()})},u=function(r){return new Promise(function(a,c){var u=t.nodes[r];u.setState({state:"expanding"});var g={filterBI:t.biFilter,data:{select_bo:["physicalid","ds6w:globalType","ds6w:label","ds6wg:revision","ds6w:type","ds6w:description","ds6w:responsible","ds6w:cadMaster","ds6w:identifier","ds6wg:PLMReference.V_isLastVersion","ds6w:reserved","ds6w:status","ds6wg:EnterpriseExtension.V_PartNumber","ds6w:modified","ds6w:created","ds6w:organizationResponsible","ds6w:project","ds6w:policy","ds6w:reservedBy"],select_rel:["physicalid","ds6w:globalType","ds6w:label","matrixtxt"],compute_select_bo:["thumbnail_2d","icon"]},pathIds:[u.getOccurencePath()],iterativeFilter:s["q.iterative_filter_query_bo"],filterRel:s.no_type_filter_rel,ftsString:t.query,rscIdToSearch:t.rscIdToSearch,max_output_paths:i.getSetting("maxPathsForSearch")},f=D.getAttrPredicateMap();f.size>0&&f.forEach(function(e){e&&g.data.select_bo.push(e)}),g.filterBI.getFilterSpec=function(e,t){return{CVQuery:{union:{expand:[{root_path_physicalid:t.V1.root_path_physicalid,expand_iter:"-1","q.iterative_filter_query_bo":g.iterativeFilter,no_type_filter_rel:g.filterRel,no_type_filter_bo:["3DShape"],find_in_context:t.V1.find_in_context}],specVersion:"420.6.1"}},CVQuery3D:{union:{expand3d:[{root_path_physicalid:t.V1.root_path_physicalid,expand_iter:"-1","q.iterative_filter_query_bo":g.iterativeFilter,no_type_filter_rel:g.filterRel,no_type_filter_bo:["3DShape"],find_in_context:t.V1.find_in_context}]},specVersion:"420.6.1"}}};n.findInCtx(g).then(function(t){try{var n=e.is(t,"string")?JSON.parse(t):t;if(!0===n.timeoutOccurs)A(u),delete u._expandAllPending,T(!0),u.setState({state:"collapsed"}),p.displayNotification({message:F.find_in_context_timeout,className:"error"});else{var r=u;r.isRoot()||(r=r.getRoot());var s=i.getSetting("parse_timeout"),l=s?parseInt(s):void 0;d.process.expand({treedocument:o,root_nodes:[r],response:n,mode:"find_in_ctx",expand_level:-1,selectPathLeaf:!0,noCheckOrder:!0,parseTimeout:l,realExpandedNodes:[u],setExpandStatus:function(e){e.expandTooLarge}});var c=b.getContent().getPADTreeListView();if(c)c.getManager().reapplySortModel()}}catch(e){e.type&&"TimeoutError"===e.type?(p.displayNotification({message:F.find_in_context_timeout,className:"error"}),function(e){for(var t=0;t<e.length;t++){var o=e[t];setPartialIfHasChildren(o),o.childComputed=!1,o.processDescendants({processNode:function(e){setPartialIfHasChildren(this),this.childComputed=!1}})}}([u])):p.displayNotification({message:F.generic_service_failure,className:"error"})}finally{if(!0!==n.timeoutOccurs){var g=o.getXSO().get();g.forEach(function(e){o._selection.push(e.getOccurencePath())});for(var f,h={paths:[],reframe:!0,expand_level:-1},m=0;m<g.length;m++)h.paths.push(g[m].getOccurencePath());o._commandProxy.padExpand(h),0===u.options.relcount?(u.options.children=null,f="noChildren"):f="partiallyExpanded",delete u._expandAllPending,u.setState({state:f}),T(!0),o.getXSO().empty()}a()}}).catch(function(e){A(u),u._expandAllPending&&delete u._expandAllPending,T(!0),u.setState({state:"collapsed"}),l(o.getRoots(),[],[]),E.removeComponentToLoad("contentView","content"),c()})})};a.then(function(){var n=[];if(null==E.container.contentView){var i=b.getContent().getContent(),r=null;i&&(r=i.getElement(".xbook_viewmain")),widget.body.contentViewLoaderContainer=e.createElement("div",{class:"FolderEditor_contentView_loader"}).inject(r),E.setContainer("contentView",widget.body.contentViewLoaderContainer)}E.addComponentsToLoad("contentView",{content:""}),t.nodes&&!t.findFlatInBookmark&&widget.getValue("allow-products-expand")&&n.push(c(0)),t.findFlatInBookmark&&n.push(new Promise(function(e,n){if(t.query)o._flatNodes=o.getRoots();else for(var i=o.getRoots(),r=0;r<i.length;r++){var a=i[r];if(a.id===t.rscIdToSearch){o._flatNodes.push(a);break}}e()})),Promise.all(n).then(function(){o.pushUpdate(),o.pushBroadcastSelect(),o.searchProgress=!1,o._doNotBroadcastSelect=!0,l(o.getRoots(),o._selection,o._flatNodes),E.removeComponentToLoad("contentView","content")}).catch(function(){l(o.getRoots(),[],[]),E.removeComponentToLoad("contentView","content"),console.log("Find in Context finished with error"),o.searchProgress=!1})})})},withBroadcastSelect:function(e){this.prepareBroadcastSelect(),e(),this.pushBroadcastSelect()},xnav_expand:function(t){var o=t.data,n=o.nodeModel,r=!!o.expandAll&&o.expandAll,a=o.numberOfLevelsToExpand?o.numberOfLevelsToExpand.toString():i.getSetting("expand_iter");if(void 0===n.options.fakeNodesTable){r&&(n._expandAllPending=!0,T(!1)),this.invalidateViewPort(),r&&(a="-1");var s=parseInt(a),l=i.getSetting("activateFUN085903")&&(-1===s||s>1),u=this;if("partiallyExpanded"===t.target.options.padstate&&(n.childComputed=!1),n.childComputed){var g=n.getDepth();if(function(e,t,o){function n(e){if(e.childComputed&&e.hasChildren()){var t=e.getChildren();if(1===t.length)return"ds6w:Document"===t[0].options.grid.globaltype}}var i=function(e,t,o){var r=!0;if((-1===t||o<t)&&(r=!(-1===t||t>o),e.childComputed))if(e.hasChildren()){for(var a=e.getChildren(),s=!0,d=0;d<a.length&&!0===s;d++){var c=a[d];if(!(c.childComputed&&l&&n(c))&&(c.childComputed&&"noExpandState"!==c._expandState&&(c.getDepth()<t||-1===t)&&c.setState({state:"expanded"}),void 0===(s=i(c,t,o+1))))throw new Error("Undefined no_expand_needed flag")}r=s}else r=!0;return r};return i(e,t,o)}(n,r?parseInt(a):g+parseInt(a),g))return t.target.preExpandDone({preventExpandAll:!0}),u._selectOccurence(),delete n._expandAllPending,void T(!0)}var f,h=e.extend({root_physicalid:n.getID(),expand_iter:a,intent:"explore_2D",timeout:3e5},i.getWebAPI_Options("navigate"),!0),m=n,v=0;n.isRoot()||(m=n.getRoot());var _=!0===i.getSetting("alwaysExpandPath")||i.getSetting("pgpFromServer");if(_){var C=n.getOccurencePath();v=C.length-1,h.paths=[C],delete h.root_physicalid}h.select_rel.push("ro.plminstance.V_treeorder"),f=i.getSetting("enopad_webapis"),u.prepareUpdate(),c.navigate({find_in_ctx:!1,enopad_webapis:f,data:h,onComplete:function(o){var i,r=!1;try{i=u.startTransaction("expand");var s=e.is(o,"string")?JSON.parse(o):o;if(0===s.results.length)p.displayNotification({message:F.generic_service_failure,className:"error"});else{"partiallyExpanded"===n.options.padstate&&u._commandProxy.padExpand({paths:[n.getOccurencePath()],expand_level:a});var l=n,c=parseInt(a);_&&(l=m,-1!==c&&(c+=v)),d.process.expand({treedocument:u,root_nodes:[l],response:s,mode:"default",expand_level:c,selectPathLeaf:!1,noCheckOrder:!0,realExpandedNodes:[n]});var g=b.getContent().getPADTreeListView();if(g)g.getManager().reapplySortModel();r=!0}}catch(e){p.displayNotification({message:F.generic_service_failure,className:"error"})}finally{r&&(n.childComputed=!0,u._selectOccurence()),i&&i.end(),delete n._expandAllPending,T(!0),t.target.preExpandDone({preventExpandAll:!0,state:void 0}),u.pushUpdate()}},onFailure:function(){A(t.target),delete n._expandAllPending,T(!0),p.displayNotification({message:F.generic_service_failure,className:"error"}),u.pushUpdate()}})}},invalidateViewPort:function(){this.options.viewport={graph:null,tree:null,tiles:null,thumbnails:null,datagrid:null}},getNodesById:function(e){var t=[];return this.getRoots().forEach(function(o){var n=o.getNodesById(e);t=t.concat(n)}),t},getNodeByOccurencePath:function(e){for(var t=this.getRoots(),o=0;o<t.length;o++){var n=t[o].getNodeByPath(e,void 0,void 0,!0);if(n)return n}},getRoots:function(t){var o=this._parent();if(Boolean(t)&&e.is(this._getChildrenFilterInfo,"function")){var n=this._getChildrenFilterInfo();n&&e.is(n.childrenBeforeFiltering,"array")&&(o=n.childrenBeforeFiltering.slice(0))}return o},removeRoot:function(t,o,n){var i=this;if(this.wrapInTransaction(function(){i._doNotBroadcastSelect=!0,i.invalidateViewPort(),i.getRoots().indexOf(t)>=0&&i._parent(t),i._doNotBroadcastSelect=!1}),!e.is(o,"boolean")||!o){var r=this.getRoots().length;this.getModelEvents().publish({event:"onRemoveRoot",data:{pid:t.getID(),remainingRoots:r}});var a=null;this.getRoots().length>0&&(a=this.getRoots()[0]),this.getModelEvents().publish({event:"onRootAdded",data:{isremove:!0,added_node:a,nb_root:r}})}},searchRootById:function(e){for(var t,o=this.getRoots(!0),n=0;n<o.length;n++)if(o[n].options.resourceid===e){t=o[n];break}return t},insertBranches:function(e,t){var o;(o=d.process.insert_temporary_branches({treedocument:this,branches:e,node_state:t.node_state,forceCollapsed:t.forceCollapsed,novalidation:t.novalidation})).ids_to_fetch.length>0||o.relationids.length>0?this.validateBranches_with_Expand(e,t):t.onComplete&&t.onComplete.call(null)},refreshNodeById:function(t){var o=[],n=this,r=[],a=[],s=function(){o.forEach(function(t){var o=n.getNodesById(t);e.is(o,"array")&&o.forEach(function(e){var t=e.getParent();e.remove(),!1===t.hasChildren()&&(t.setState({state:"collapsed"}),t.options.children=[])})});var t=F.cannot_insert_branch;0!==a.length&&(t=F.cannot_access_after_changeowner),p.displayNotification({message:t,className:"error"})};if(o=e.is(t.created)?o.concat(t.created):o,e.is(t.modified)&&e.is(t.modified,"array")&&this.withTransactionUpdate(function(){t.modified.forEach(function(t){if(e.is(t,"object")){var i=t.physicalid;if(e.is(t.attributes,"array")){var s=require("DS/PADServices/utils/AttributesMgtV2");n.getNodesById(i).forEach(function(e){e.updateAttributes(t.attributes,s.getAvailableColumns()),u.updateNLS(e)})}else{if(-1===o.indexOf(i))(l=n.getNodesById(i))&&l.length>0&&(o.push(i),r.push(i));"ownerChanged"===t.key&&a.push(i)}}else{var l;if(-1===o.indexOf(t))(l=n.getNodesById(t))&&l.length>0&&(o.push(t),r.push(t))}})}),o.length>0){var l=i.getWebAPI_Options("fetch");l.include_param_Attributes=!1,c.fetch({enopad_webapis:i.getSetting("enopad_webapis"),data:l,pids:o,onComplete:function(i){n.invalidateViewPort();var a=e.is(i,"string"),l=a?i.replace(/\\u0007/g,";"):i,c=a?JSON.parse(l):l;c.results.length!==o.length&&(console.error("Inconsistent number of results"),s()),n.wrapInTransaction(function(){d.process.refresh_nodes({treedocument:n,response:c,refresh_parameters:t,ids_modified:r})}),void 0!==t.onComplete&&t.onComplete()},onFailure:function(){s()}})}},getNodesByIDPath:function(e){var t=[];return this.getRoots().forEach(function(o){!function e(t,o,n,i){if(t.getID()===o[n])if(n===o.length-1)i.push(t);else{var r=t.getChildren();r&&r.length>0&&(n+=1,r.forEach(function(t){e(t,o,n,i)}))}}(o,e,0,t)}),t},deleteNodes:function(e){var t=this;this.wrapInTransaction(function(){t.withTransactionUpdate(function(){e.forEach(function(e){e.isRoot()&&t.removeRoot(e)})})})},_selectOccurence:function(e,t,o){var n=this.getRoots(),i=this._selected_paths;if(i.length>0){var r=!1;"FocusOn"!==e&&(this._doNotBroadcastSelect=!0),this.prepareUpdate();var a=[];n.forEach(function(e){for(var t=0;t<i.length;t++){var o=e.getNodeByPath(i[t]);if(o&&(r=!0,a.push(o),!o.isVisible())){for(var n=o.getParent();!n.isVisible();)n=n.getParent();n&&-1===a.indexOf(n)&&a.push(n)}}});var s=!1;if(!0!==t||!0===r)for(var l=this.getSelectedNodes(),d=0;d<l.length;d++){var c=l[d];a.indexOf(c)<0&&(c.unselect(),s=!0)}a.forEach(function(e){e.isSelected()||(e.select(),s=!0)}),!0===o&&s&&(this._directSelection=!1),this.pushUpdate(),this._doNotBroadcastSelect=!1}},_buildSelectData:function(){var e=[];this._selected_paths;e=this.getXSO().get();var t,o={paths:[],tenant:r.getPlatformId()};o.attributes={},o.version="1.1";return t=function(e){var t=e.getID();this.attributes.hasOwnProperty(t)||(this.attributes[t]={type:e.options.type,label:e.options.label})}.bind(o),o.paths=e.map(function(e){return e.getOccurencePath(t)}),this._currentApp=r.getSharedId(),o.sharedID=this._currentApp,o.focusOn=!1,o},applyActiveView:function(e){this.options.active_view=e},validateBranches_with_Expand:function(t,o){var n=e.extend({root_path_physicalid:e.clone(t),expand_iter:"0",intent:"explore_2D",timeout:3e5},i.getWebAPI_Options("navigate"),!0),r=this;function a(){for(var n=0;n<t.length;n++)for(var i=0;i<t[n].length;i+=2){var a=t[n][i],s=r.getNodesById(a);e.is(s,"array")&&s.forEach(function(e){if(!0===e.options.waiting4validation)if(!0===e.isRoot())r.removeRoot(e);else{var t=e.getParent();e.remove(),!1===t.hasChildren()&&(t.setState({state:"collapsed"}),t.options.children=[])}})}p.displayNotification({message:F.cannot_insert_branch,className:"error"}),o.onFailure&&o.onFailure()}c.navigate({enopad_webapis:i.getSetting("enopad_webapis"),data:n,onComplete:function(t){var n;try{n=r.startTransaction("expand");var i=e.is(t,"string")?JSON.parse(t):t;d.process.validateAndUpdateBranches({treedocument:r,response:i}),o.onComplete&&o.onComplete()}catch(e){a()}finally{n&&n.end()}},onFailure:function(e){a()}})},multiselect:function(e){var t=this.getXSO();this.prepareUpdate(),t.add(e),this.pushUpdate()},multiunselect:function(e){var t=this.getXSO();this.prepareUpdate(),t.remove(e),this.pushUpdate()},fillAttributesAsync4VisibleNodes:function(t,o){this.options.additionalColumnsModules=o;var n=this;function i(e,t){for(var o=0;o<n.options.additionalColumnsModules.length;o++){for(var i=n.options.additionalColumnsModules[o],r=i.getManagedColumnNames(),a={},s=0;s<r.length;s++)a[r[s]]=e.options.grid[r[s]];if(!0===i.toBeUpdated(a,e)){var l=i.getName(),d=t[l];d||(d={pids:[]},t[l]=d);var c=e.getID();d.pids.push(c)}}}if(this.options.additionalColumnsModules&&this.options.additionalColumnsModules.length){var r=this.getVisibleAdditionalColumns();r.length&&require(["UWA/Promise"],function(o){for(var a={},s=0;s<t.length;s++)i(t[s],a);for(var l=[],d=0;d<r.length;d++){var c=r[d],u=c.module.getName();if(a[u]){var p=new o(function(t){c.module.updateAttributes(a[u],function(o){var n=e.is(o,"string")?JSON.parse(o):o;t(n)})});l.push(p)}}l.length&&o.all(l).then(function(o){n.withTransactionUpdate(function(){t.forEach(t=>{var i=t.getID(),r={grid:{}},a=!1;o.forEach(e=>{if(e&&e.pids){var t=e.pids[i];if(t){a=!0;var o=t._root;if(o){for(var n in o)r[n]=o[n];delete t._root}for(var n in t)r.grid[n]=t[n]}}}),a&&t.updateOptions(function(t,o){var i=o;return e.is(n.filterAttributesForUpdate,"function")&&(i=n.filterAttributesForUpdate({node:t,node_opts:i})),i}(t,r))})})})})}}})}),define("DS/FolderEditor/utils/xBookCustoStorageOptim",["UWA/Core","DS/FolderEditor/utils/FolderEditorUtil","DS/PADUtils/PADSettingsMgt"],function(e,t,o){"use strict";var n={dataIndex:void 0,text:void 0,isDraggable:!0,visibleFlag:!0,isHidden:!1,isSortable:void 0,type:void 0,isAdditionalColumn:void 0,xnav_options:{name:void 0,dataIndex:void 0,tree:void 0,hardcoded:void 0,exportable:{lock:!1,value:!0},layout:{removable:void 0,hidden:void 0,width:150,minWidth:void 0,maxWidth:void 0},kind:void 0}},i={dataIndex:void 0,text:void 0,isDraggable:!0,visibleFlag:void 0,sortableFlag:void 0,pinned:void 0,kind:void 0,isAdditionalColumn:void 0,customisation:{layout:{width:200,minWidth:50,maxWidth:300,removable:!0,pinEditable:!0},exportable:{lock:!1,value:!0},titleModified:void 0}};function r(e,t){var o={};if(void 0===t)o=e;else for(var n=Object.getOwnPropertyNames(e),i=0;i<n.length;i++)if(UWA.is(e[n[i]],"object")){var a=r(e[n[i]],t[n[i]]);Object.getOwnPropertyNames(a).length>0&&(o[n[i]]=a)}else e[n[i]]!==t[n[i]]&&"text"!==n[i]&&(o[n[i]]=e[n[i]]);return o}function a(e,t,o){var n={};if(void 0===e)n=t;else{for(var i=Object.getOwnPropertyNames(t),r=Object.getOwnPropertyNames(e),s=0;s<i.length;s++)if(UWA.is(t[i[s]],"object")){if("bi_color"!==o){var l=a(e[i[s]],t[i[s]],o);Object.getOwnPropertyNames(l).length>0&&(n[i[s]]=l)}}else void 0===e[i[s]]?n[i[s]]=t[i[s]]:n[i[s]]=e[i[s]];for(var d=0;d<r.length;d++)void 0===n[r[d]]&&(n[r[d]]=e[r[d]])}return n}return{convertCusto4Preference:function(e,a,s){var l={custoOptimized:!0,viewMode:e.viewMode,defaultCellHeight:e.defaultCellHeight,defaultcolumnHeaderHeight:e.defaultcolumnHeaderHeight,rowsHeader:e.rowsHeader,selectedTypes:e.selectedTypes,selectedExtensions:e.selectedExtensions,columnsOptimized:[],lang:o.getSetting("lang")};t.setContentSortmodel(e.sortModel),e.custoFromTree&&(l.custoFromTree=e.custoFromTree);for(var d=0;d<e.columns.length;d++){var c=e.columns[d],u=n;"datagridview"===s&&(u=i);var p=r(c,u);a[c.dataIndex]&&(p.text=c.text),l.columnsOptimized.push(p)}return l},convertPreference2Custo:function(r,s){var l={viewMode:r.viewMode,defaultCellHeight:r.defaultCellHeight,defaultcolumnHeaderHeight:r.defaultcolumnHeaderHeight,rowsHeader:r.rowsHeader,selectedTypes:r.selectedTypes,selectedExtensions:r.selectedExtensions,columns:[]},d=t.getContentSortmodel();l.sortModel=d,r.custoFromTree&&(l.custoFromTree=r.custoFromTree),r.lang&&r.lang!==o.getSetting("lang")&&function(e){for(var t=0;t<e.columnsOptimized.length;t++){var o=e.columnsOptimized[t];o.xnav_options&&o.xnav_options.titleModified&&(delete o.text,delete o.xnav_options.titleModified)}}(r);for(var c=0;c<r.columnsOptimized.length;c++){var u=r.columnsOptimized[c],p=n;"datagridview"===s&&(p=i);var g=a(u,e.clone(p),u.dataIndex);l.columns.push(g)}return l}}}),define("DS/FolderEditor/controllers/ReadMode",["DS/FolderEditor/controllers/CommonMode","DS/PADUtils/PADSettingsMgt","DS/FolderEditor/utils/FolderEditorUtil","DS/FolderEditor/ActionBar/FolderCommandManager","DS/FolderEditor/Folder_CSO","DS/FolderEditor/utils/FolderEditorcontrol","DS/FolderEditor/utils/FolderSearch","DS/FolderEditor/utils/FolderListContent_Read","DS/FolderEditor/utils/FolderEditorEvents","DS/FolderEditor/views/FolderMode","UWA/Class/Events","DS/FolderEditor/tagger/TaggerContentProxy"],function(e,t,o,n,i,r,a,s,l,d,c,u){return e.extend({supportClientSort:!1,init:function(e){this._parent(e);var t=this;this._indexInfo=null,this._currentFldId=null,this._isPageRefreshed=!1,this._methodsTobeExecutedAfterFirstScroll=[],a.onSearchChange(function(){t.resetInfoIndex()})},convertData:function(e){return o.convertToExaleadDataFormat(e)},manageError:function(e){return(e=JSON.parse(e)).error.errorMessage},loadContents:function(e){return this.isTagSet=!1,this.cancelQuery(),new Promise((t,o)=>{e.next_start=null;var n=this.getInfoIndex();null!==n?e.next_start=n.next_start:this.isInfiniteScrollingTobeDone()&&this.loadFacet(e),e.onComplete=(e=>{null==this._indexInfo&&(this._isPageRefreshed=!0),e=JSON.parse(e),this.setInfoIndex(e.infos);var o=e.results,n={contents:o=o||[],sorted:!0,inProgress:this.isInfiniteScrollingTobeDone()};t(n)}),e.onFailure=function(e,t){o({err:e,serverErr:t})},this._contentHandleRequest=s.listContent(e)})},loadFacets:function(e){return new Promise((t,o)=>{let n=UWA.clone(e);n.exceptIds=u.getAlreadyManagedIds(),n.synthesis=!0,n.onComplete=t,n.onFailure=o,this._taggerHandleRequest=s.listContent(n)})},onSetPathTags:function(e){this.unColorizeChildren(e)},getObjectsInTree:function(){return r.getContent().getPADTreeDocument().getAllDescendants().length},onFilterFilteringEvent:function(){},unColorizeChildren:function(e){e.options.model.withTransactionUpdate(function(){e.options.model.getRoots().forEach(function(e){var t={grid:{bi_color:"rgba(0, 0, 0, 0)"}};e.getAllDescendants().forEach(function(e){delete e.options.color,e.updateOptions(t)})})})},getNumberLastResult:function(){return this._indexInfo?this._indexInfo.nresults:0},setInfoIndex:function(e){var t=this._infoIndex;this._indexInfo=e||null,this.isInfiniteScrollingTobeDone()&&null==t&&this._indexInfo&&this._methodsTobeExecutedAfterFirstScroll.forEach(function(e){e()})},onreadResult:function(e){this._methodsTobeExecutedAfterFirstScroll.push(e)},getInfoIndex:function(){return this._indexInfo},resetInfoIndex:function(){this._isPageRefreshed=!0,this._indexInfo=null},getModeType:function(){return"read"},isInfiniteScrollingTobeDone:function(){var e=this.isItFolderSection();return"read"==d.getCurrentModeType()&&!(widget.getValue("filtered-content")&&!e)},isItFolderSection:function(){return"FolderSection_AllFolders"==i.getCurrentFolder().getID()}})}),define("DS/FolderEditor/controllers/SearchMode",["DS/FolderEditor/controllers/CommonMode","DS/PADUtils/PADSettingsMgt","DS/PADServices/utils/GlobalModelEvents","DS/FolderEditor/utils/FolderEditorUtil","DS/FolderEditor/ActionBar/FolderCommandManager","DS/FolderEditor/Folder_CSO","DS/FolderEditor/utils/FolderEditorcontrol","DS/FolderEditor/service/FolderEditorWebService","DS/FolderEditor/utils/FolderSearch","DS/FolderEditor/tagger/TaggerContentProxy","DS/FolderEditor/tagger/TaggerTreeProxy","DS/FolderEditor/utils/FolderEditorDataConversion"],function(e,t,o,n,i,r,a,s,l,d,c,u){return e.extend({supportClientSort:!1,init:function(e){this._parent(e),l.onSearchChange(function(){var e=r.getCurrentFolder();e&&i.updateCommands(e,e),a.getContent()&&a.getContent().switchMode(l.isSearchActive()?"search":null,!0)})},enable:function(){d.setUpdateMode(!1),a.getIdCardCont().switchSearch(!0);var e=a.getContent().getActiveView();e="datagridview"===e?"treeview":e,l.setPreviousView(e),o.publish({event:"toolbar_update_command",data:{commandID:"display",data:{disabled:!0,grid:{data:"treeview"}}}})},disable:function(){d.setUpdateMode(!0),this._parent();a.getIdCardCont();var e=o.getModelEvents();e.publish({event:"search_cleared"});var t=l.getPreviousView();t&&(e.publish({event:"toolbar_update_command",data:{commandID:"display",data:{disabled:!1,grid:{data:t}}}}),l.setPreviousView(null))},convertData:function(e){return n.convertToExaleadDataFormat(e)},manageError:function(e){if(l.isSearchActive()&&e&&"object"==typeof e&&e.error&&e.error.errorCode)return e.error.errorMessage},loadContents:function(e){this._parent();var t=this,o=l.getSearchValue();e.searchQuery=o;let n=!1,i=a.getContent();if(i){let r=i.getPADTreeListView();if(r)return n=!0,new Promise(function(n,i){r.enrichSearchValue(o).then(function(o){e.searchQuery=o,t._loadContents(e).then(function(e){n(e)},function(e){i(e)}).catch(i)}).catch(i)})}if(!n)return t._loadContents(e)},_loadContents:function(e){e.filters=d.getFilterTags(),this.cancelQuery();var t=Promise.resolve();r.getCurrentFolder()&&(currentFolderId=r.getCurrentFolder().getID());let o=null,n=null,i=a.getContent().getPADTreeListView(),p=i?i.getManager().sortModel:null;return p&&p.length>0&&("tree"===(o=p[0].dataIndex)?o="ds6w:label":"defaultSort"===o&&(o="ds6w:modified"),n=p[0].sort,e.order_field=o,e.order_by=n),"FolderSection_AllFolders"===e.pid&&(t=new Promise((e,t)=>{this._contentHandleRequest=s.allBookmarks({select_predicate:["physicalid"],filters:c.getFilterTags(),onComplete:function(t){e(u.getObjectIdsFromSearchRes(t.results))},onFailure:t})})),new Promise((o,n)=>{t.then(t=>{t&&(e.pid=t),e.onComplete=(t=>{this.loadFacet(e);var n=t.infos,i=l.isSearchInProgress();e.searchQuery&&l.setInfoIndex(n);var a=null;if(r.getCurrentFolder()&&(a=r.getCurrentFolder().getID()),a===e.pid||"FolderSection_AllFolders"===a){var s=t.results;o({contents:s=s||[],inProgress:i,sorted:!0})}}),e.onFailure=function(e,t){n({err:e,serverErr:t})},this._contentHandleRequest=s.content(e)}).catch(n)})},loadFacets:function(e){return new Promise((t,o)=>{this._taggerHandleRequest=s.content({pid:e.pid,searchQuery:e.searchQuery,synthesis:!0,filters:e.filters,onFailure:o,onComplete:t})})},onSetPathTags:function(e){this.unColorizeChildren(e)},getObjectsInTree:function(){return l.getNumberHits()},onFilterFilteringEvent:function(){},onInfiniteScrollAsync:function(){var e=l.getNumberLastResult();l.getSearchValue()&&e>0&&a.getContent().loadContentAndSelect()},unColorizeChildren:function(e){e.options.model.withTransactionUpdate(function(){e.options.model.getRoots().forEach(function(e){var t={grid:{bi_color:"rgba(0, 0, 0, 0)"}};e.getAllDescendants().forEach(function(e){delete e.options.color,e.updateOptions(t)})})})},getNumberLastResult:function(){return l.getNumberLastResult()},getModeType:function(){return"search"}})}),define("DS/FolderEditor/views/customize_views/FolderDGVParametrization",["UWA/Class","UWA/Promise","DS/Utilities/Utils","DS/Core/PointerEvents","DS/FolderEditor/utils/xBookCustoStorageOptim","DS/PADUtils/Configuration","DS/PADServices/utils/AttributesMgtV2","DS/PADServices/utils/DictionaryAccess","DS/FolderEditor/service/FolderServices","DS/FolderEditor/commands/FolderCommands","DS/FolderEditor/service/FolderTypeService","DS/FolderEditor/utils/ColorUtil","DS/FolderEditor/utils/FolderEditorUtil","DS/WidgetServices/WidgetServices","DS/FolderEditor/utils/FolderSearch","DS/FolderEditor/tagger/TaggerContentProxy","DS/FolderEditor/utils/FolderEditorcontrol"],function(e,t,o,n,i,r,a,s,l,d,c,u,p,g,f,h,m){"use strict";function v(e,t,o,n,i){var r=c.inFamilyFolder(o.plmType),a=c.inFamilyFolder(n.plmType);if(r&&!a)return-1*this.reverseFactor;if(!r&&a)return 1*this.reverseFactor;var s=0;return"defaultSort"===i&&(s=(o.options.relationOrder?o.options.relationOrder:0)-(n.options.relationOrder?n.options.relationOrder:0),e=o.getAttribute("label"),t=n.getAttribute("label")),o&&o.options&&o.options.grid&&o.options.grid[i+"_SortKey"]&&(e=o.options.grid[i+"_SortKey"]),n&&n.options&&n.options.grid&&n.options.grid[i+"_SortKey"]&&(t=n.options.grid[i+"_SortKey"]),0==s?p.compareLabels(e,t):s}return e.extend({buildDGVOpts:function(e){var o=this;return e=e||{},new t(function(t){var n,l=function(e){var n=UWA.clone(r.getConfig("dgvOptions")),i=n&&n.dgv?n.dgv:{};if(e=UWA.extend(i,e),o.options.additionalColumnsModules){for(var l=[],d=0;d<o.options.additionalColumnsModules.length;d++)UWA.is(o.options.additionalColumnsModules[d].getAdditionalColumnsUXDGV,"function")&&(o.options.additionalColumnsModules[d].getAdditionalColumnsUXDGV(e.columns),l=l.concat(o.options.additionalColumnsModules[d].getManagedColumnNames()));var c=function(e){for(var t={},o=0;o<e.length;o++){var n=e[o];t[n.dataIndex]=void 0!==n.visibleFlag&&!n.visibleFlag}return t}(e.columns);l.length&&(function(e,t,o){for(var n=0;n<e.length;n++){var i=e[n];-1!==t.indexOf(i.dataIndex)&&(i.isAdditionalColumn=!0),void 0!==o[i.dataIndex]&&(i.visibleFlag=!o[i.dataIndex])}}(e.columns,l,c),function(e){for(var t=0;t<e.length;t++){var o=e[t],n=o.customisation;n&&n.layout&&o.visibleFlag!==!n.layout.hidden&&(n.layout.hidden=!o.visibleFlag)}}(e.columns))}if(e.selectionBehavior.toggle=!1,e.infiniteScrolling=!0,e.onContextualEvent=o._onContextualEvent.bind(o),e.onDelayedModelDataRequest=o.options.context.updateAttributesDelayed.bind(o.options.context),o.options.callbacks){var u=Object.keys(o.options.callbacks);for(d=0;d<u.length;d++)e[u[d]]=o.options.callbacks[u[d]]}e.columns.push({dataIndex:"defaultSort",visibleFlag:!1,customisation:{exportable:{lock:!0,value:!1},layout:{removable:!1}}}),e.columns.forEach(function(e){"tree"===e.dataIndex&&(e.getCellKPIColor=h.getCellKPIColor.bind(h)),"bookmarkLocation"===e.dataIndex&&(f.isSearchActive()?(e.customisation.layout.removableFromView=!0,e.visibleFlag=!0):(e.customisation.layout.removableFromView=!1,e.visibleFlag=!1)),e.compareFunction=v,e.onCellRequest=function(e){if(!e.isHeader){e.nodeModel&&e.nodeModel.options.isBeingCut?e.cellView.getContent().addClassName("pad-state-is-being-cut"):e.cellView.getContent().removeClassName("pad-state-is-being-cut");var t=this.getColumnOrGroup(e.columnID);let n=o.options.dgv.layout.getDisplayedColumnsIndexes();if(n&&n.indexOf(e.columnID)>=0)for(let n=0;n<o.options.additionalColumnsModules.length;++n)if(o.options.additionalColumnsModules[n]._columnDataIndex&&o.options.additionalColumnsModules[n]._columnDataIndex[0]===t.dataIndex&&o.options.additionalColumnsModules[n].onCellRequest&&o.options.additionalColumnsModules[n].onCellRequest(e))return;t&&"boolean"===t.typeRepresentation&&(e.cellModel="string"==typeof e.cellModel?"TRUE"===e.cellModel:e.cellModel)}if(e.nodeModel){var n=e.nodeModel.options.icons;n&&n.length>0&&"string"==typeof n[0]&&(e.nodeModel.options.icons=[{iconPath:"url("+n[0]+")"}])}this.defaultOnCellRequest(e)}}),s.updateColumnsWithNLS(e.columns,function(n){"success"===n.status&&(e.columns=n.columns),a.updateAttributesList(e.columns),o.completeDGVOptions(e).then(t)})};o.options.view_customization&&!0!==e.reset&&!0!==o.options.view_customization.custoFromTree?(!0===o.options.view_customization.custoOptimized&&(o.options.view_customization=i.convertPreference2Custo(o.options.view_customization,"datagridview")),(n=o.options.view_customization).columns=o.buildColumnsFromStorage(n.columns).then(function(e){n.columns=e,l(n)})):(n={},o.buildColumns("datagridview").then(function(e){n.columns=e.columns,l(n)}))})},completeDGVOptions:function(e){return t.resolve(e)},completeCB:function(){return t.resolve()},addColumnCB:function(e){var o=this;this.options.dgv.prepareUpdateView();var n=[];e.forEach(function(e){e&&e.convertInfos&&e.convertInfos.dimension&&(e.kind="string"),n.push(new t(function(t){a.addAvailableColumn(e.dataIndex,e).then(function(e){var n=o.buildColumnFromSetting(e);n&&(n.compareFunction=v,o.options.dgv.addColumnOrGroup(n),"thumbnail"===n.dataIndex&&(o.options.dgvLayout.cellHeight=80)),t()})}))}),t.all(n).then(function(){this.options.dgv.pushUpdateView({updateCellContent:!0,updateCellLayout:!0,updateCellAttributes:!0},!0)}.bind(this))},removeColumnCB:function(e){var t=this;this.options.dgv.prepareUpdateView(),e.forEach(function(e){var o=UWA.is(e,"string")?JSON.parse(e):e,n=t.options.dgv.getColumnOrGroup(o.dataIndex);n&&void 0!==n.dataIndex&&(t.options.dgv.removeColumnOrGroup(o.dataIndex),"thumbnail"===o.dataIndex&&(t.options.dgvLayout.cellHeight=38,t.options.dgvLayout.columnHeaderHeight=38,"compact"===t.options.viewMode&&(t.options.dgvLayout.cellHeight=26,t.options.dgvLayout.columnHeaderHeight=26)),a.removeAvailableColumn(o.dataIndex))}),this.options.dgv.pushUpdateView({updateCellContent:!0,updateCellLayout:!0,updateCellAttributes:!0},!0)},changeTitleCB:function(e,t){var o=this.options.dgv.getColumnOrGroup(e);o&&(this.options.dgv.prepareUpdateView(),o.text=t,o.customisation.titleModified=!0,this.options.dgv.pushUpdateView({updateCellContent:!0,updateCellLayout:!1,updateCellAttributes:!0},!0))},changeDBAttributeCB:function(e){if(e&&0!=e.length){var t=this;this.options.dgv.prepareUpdateView(),e.forEach(function(e){var o=t.options.dgv.getColumnOrGroup(e.dataIndex);o&&void 0!==o.dataIndex&&(o.attrDBName=e.attrDBName)}),this.options.dgv.pushUpdateView({updateCellContent:!0,updateCellLayout:!0,updateCellAttributes:!0},!0)}},changeVisibilityCB:function(e,t){this.options.dgvLayout.setColumnVisibleFlag(e,t,{isUserInteraction:!0})},changePinCB:function(e,t){this.options.dgvLayout.setColumnPinned(e,t,{isUserInteraction:!0})},moveColumnCB:function(e){if(e.move2perform){let t=e.move2perform.fromIndex?e.move2perform.fromIndex:e.move2perform.fromID,o=e.move2perform.toIndex?e.move2perform.toIndex:e.move2perform.toID;this.options.dgvLayout.moveColumn(t,o,{isUserInteraction:!0})}},changeDgvLayout:function(e){void 0!==typeof e.rowsHeader&&(this.options.dgvLayout.rowsHeader=e.rowsHeader)},changeExportCB:function(e,t){var o=this.options.dgv.getColumnOrGroup(e);o&&(o.customisation.exportable={lock:!1,value:t})},compactMode:function(e){"comfortable"===e.viewMode?(this.options.dgvLayout.cellHeight=38,this.options.dgvLayout.columnHeaderHeight=38,this.options.viewMode="comfortable"):"compact"===e.viewMode&&(this.options.dgvLayout.cellHeight=26,this.options.dgvLayout.columnHeaderHeight=26,this.options.viewMode="compact")},saveCustoView:function(e){var t=this;this._prepareOptsToStore({onComplete:function(o){var n=e?"onCustoViewChange":"onSaveAsTemplate";t.options.context.dispatchEvent(n,o)}})},reset:function(e){return new t(function(t){var o=this;delete o.options.view_customization,this.buildDGVOpts({reset:!0}).then(function(n){var i=r.getConfig("dgvOptions")?r.getConfig("dgvOptions"):{};o.options.dgv.prepareUpdateView(),i.dgvLayout&&(o.options.dgvLayout.cellHeight=i.dgvLayout.cellHeight,o.options.dgvLayout.columnHeaderHeight=i.dgvLayout.cellHeight,o.options.dgvLayout.rowsHeader=i.dgvLayout.rowsHeader),o.changePinCB(o.ctxColOpts.dataIndex,"right"),n.columns.push(o.ctxColOpts),o.ctxColOpts.visibleFlag=!0,o.options.dgvLayout.columns=n.columns,o.options.dgv.columns=n.columns,o.options.dgvLayout.deleteDataGridViewPreferences(),o.options.viewMode=i.viewMode;var a=m.getTreeCont();a&&a.modeChange({viewMode:o.options.viewMode}),o.options.dgv.pushUpdateView({updateCellContent:!0,updateCellLayout:!0,updateCellAttributes:!1},!0),o.options.dgvLayout.applyColumns(),o.saveCustoView(e),t()})}.bind(this))},_onContextualEvent:function(e){return new t(function(t){d.getCtxMenu(e).then(function(e){t(e)})})},eventHandlerOnGridView:function(e){var o=this;return new t(function(t){e.addEventListener("click",function(e,t){if(void 0!==t&&-1!==t.rowID){var n=e.dsModel.layout.getDataIndexFromColumnIndex(t.columnID);if(o.options.clickEvent[n])o.options.clickEvent[n](t);else if(o.options.additionalColumnsModules&&!0===e.dsModel.layout.getColumnOptionValue(t.columnID,"isAdditionalColumn"))for(var i=0;i<o.options.additionalColumnsModules.length;i++){if(o.options.additionalColumnsModules[i].getOnCellClickCB){var r=o.options.additionalColumnsModules[i].getOnCellClickCB(n,e);if(r){r(t);break}}}}}),e.addEventListener("userPreferencesChange",function(e){o.saveCustoView(!0)}),e.addEventListener("columnWidthChange",function(e){if(e&&e.dsModel&&e.dsModel.layout&&o.options&&o.options.dgv&&o.options.dgv.layout&&o.options.dgv.model){let t=e.dsModel.layout.getDataIndexFromColumnIndex(e.options.columnID),n=o.options.dgv.layout.getDisplayedColumnsIndexes();if(n&&n.indexOf(e.options.columnID)>=0)for(let n=0;n<o.options.additionalColumnsModules.length;++n)if(o.options.additionalColumnsModules[n]._columnDataIndex&&o.options.additionalColumnsModules[n]._columnDataIndex[0]===t&&o.options.additionalColumnsModules[n].updateAttributesOnResize){let t=o.options.dgv.layout.getMinMaxVisibleRowIDs(),i=t.minRowID,r=t.maxRowID,a=[];(a=r>=0?o.options.dgv.model.slice(i,r+1):o.options.dgv.model.slice(i,r)).length>0&&o.options.additionalColumnsModules[n].updateAttributesOnResize(a,e.options.columnID);break}}}),e.addEventListener(n.POINTERHIT,function(e,t){if(2===e.multipleHitCount&&t&&-1!==t.rowID){var o=t.nodeModel;o&&l.activateFolderEditorItem(o.id,o.getType(),o.getLabel()),require(["DS/IPClassifyUtil/IPClassifyCommunication"],function(e){if(!0===widget.getValue("noCompass")){var t={id:o.getID(),label:o.getLabel(),type:o.options.type,cadMaster:o.options.grid["ds6w:cadMaster"],kind:o.options.grid["ds6w:kind"],contentStructure:o.options.grid["ds6w:contentStructure"]};e.publish("doubleClickonContentInBookmark",t)}})}}),o.completeCB(e).then(t)})},_prepareOptsToStore:function(e){var t=this;o.debounce(function(e){for(var o=t.options.dgvLayout.getOrderedColumnsIndexes(),n=[],r=[],a={},s=0;s<o.length;s++){var l=t.options.dgv.getColumnOrGroup(o[s]);"defaultSort"===l.dataIndex?r.push(l):"ContextualMenuColumn"!==l.dataIndex?(n.push(l),!0===l.customisation.titleModified&&(a[l.dataIndex]=!0)):t.ctxColOpts&&n.push(t.ctxColOpts)}var d={viewMode:t.options.viewMode,defaultCellHeight:t.options.dgvLayout.cellHeight,defaultcolumnHeaderHeight:t.options.dgvLayout.columnHeaderHeight,rowsHeader:t.options.dgvLayout.rowsHeader,columns:n,sortModel:t.options.dgv.sortModel},c=i.convertCusto4Preference(d,a,"datagridview");r.forEach(e=>n.push(e)),t.options.dgv.columns=n,e.onComplete(c)},500)(e)}})}),define("DS/FolderEditor/controllers/FavoritesMode",["DS/FolderEditor/controllers/CommonMode","DS/WebappsUtils/WebappsUtils","DS/FolderEditor/utils/FolderEditorcontrol","DS/FolderEditor/utils/FolderEditorUtil","i18n!DS/FolderEditor/assets/nls/FolderEditor"],function(e,t,o,n,i){var r=t.getWebappsAssetUrl("FolderEditor","icons/I_Bookmark_v2.png"),a=t.getWebappsAssetUrl("FolderEditor","icons/I_BookmarkInherit_v2.png"),s=t.getWebappsAssetUrl("FolderEditor","icons/I_Bookmark108x144.png"),l=t.getWebappsAssetUrl("FolderEditor","icons/I_BookmarkInherit108x144.png");return e.extend({init:function(e){this._parent(e)},convertData:function(e){var t=e.type&&"RootFolder"==e.type?"Workspace":"Workspace Vault",o=e.type?e.type:"Folder",d="RootFolder"==o?i.name_RootFolder_type:i.name_Folder_type,c={id:e.id,type:t,displayType:d,label:e.name,name:e.name,description:"",created:"",modified:"",owner:"",responsible:"",organizationResponsible:"",project:"",revision:"",status:"",policy:"",icon:e.inherit?a:r,largeicon:e.inherit?l:s},u=n.convertToExaleadDataFormat(c);return u.resourceid=e.id,u.nodeAttrs={},u.nodeAttrs.plmType=o,u.nodeAttrs.isFavorite=!0,u.nodeAttrs.isPersonal=e.isPersonal,u},loadContents:function(e){this._parent();var t=this;return new Promise(function(e,n){t._contentHandleRequest=o.getTreeCont().getFavorites({onComplete:function(t){e({contents:t})},onFailure:n})})},getModeType:function(){return"favorites"}})}),define("DS/FolderEditor/models/xBookDocumentRefresh",["UWA/Class","UWA/Class/Promise","DS/FolderEditor/models/_xBookCVParser","DS/PADUtils/PADSettingsMgt","DS/PADUtils/PADSession","DS/PADUtils/PADWSAccess","DS/PADUtils/views/PADProgressBar","DS/FolderEditor/utils/FolderEditorcontrol","i18n!DS/FolderEditor/assets/nls/FolderEditor.json","i18n!DS/PADUtils/assets/nls/PADUtils.json"],function(e,t,o,n,i,r,a,s,l,d){"use strict";function c(e){e.options.isNotManagedByPS||e.hasChildren()||(e.setState({state:"collapsed"}),e.childComputed=!1)}var u=e.extend({});return!0!==n.getSetting("refresh_v2")&&(u.prototype.refresh=function(e){var u=this,p=[],g=function(t){a.off(),t&&0!==t.length||(t=[{msg:l.refresh_ok}]);for(var o=0;o<t.length;o++){var n=t[o];e.cb&&e.cb(n)}},f=l.refresh_ongoing,h=(e=e||{}).roots||this.getRoots();if(h.length>0){a.on(f);var m=[],v=[];if(null!=h&&h.forEach(function(e){for(var t=[],o=[e];o.length;){var n=o.pop();if(null!=n)t.push(n.getOccurencePath()),n.getOccurencePath().forEach(function(e){v.indexOf(e)<0&&v.push(e)}),o=o.concat(n.getChildren())}m.push(t)}),0===m.length&&0===[].length)g();else{var _=[];if(m.length>0){var C=new t(function(e,t){var a,l={session:m,intent:"explore_2D",debug:n.getSetting("enopad_webapis_debug"),type_filter_bo:n.getSetting("type_filter_bo")};r.refresh({data:l,onComplete:function(t){var n=UWA.is(t,"string")?JSON.parse(t):t;if(void 0!==n){a=u.startTransaction("refresh");var r=i.determineAuthoredFlag(),l=!1;r&&(l=!0),o.process.expand({treedocument:u,root_nodes:h,starting_from_root:n.full_path,response:n,mode:"refresh",needNewStructure:l,expand_level:r?1:-1,security_counts_HTML:null}),r&&function(e){for(var t=e.getRoots(),o=0;o<t.length;o++){var n=t[o];c(n),n.processDescendants({processNode:function(e){c(this)}})}}(u);var d=s.getContent().getPADTreeListView();if(d)d.getManager().reapplySortModel();u.invalidateViewPort(),a&&a.end()}e()},onFailure:t.bind(this,d.generic_service_failure)})});_.push(C)}t.all(_).catch(function(e,t,o){t=t||"Exception thrown during the process of the refresh answer "+(o?o.toString():""),e.push({msg:t,eventID:"error"})}.bind(this,p)).finally(function(){g(p)})}this.withTransactionUpdate(function(){for(var e=UWA.clone(h,!1);e.length;){var t=e.pop();null!=t&&(t.isSelected()&&t.unselect(),e=e.concat(t.getChildren()))}})}}),u}),define("DS/FolderEditor/FolderTreeDocument",["DS/Logger/Logger","DS/FolderEditor/xBookDocument","DS/FolderEditor/Folder_CSO","DS/FolderEditor/service/FolderDnDServices","DS/FolderEditor/service/FolderTypeService","DS/FolderEditor/service/FolderEditorWebService","DS/FolderEditor/utils/FolderEditorUtil","DS/FolderEditor/ActionBar/FolderCommandManager","DS/FolderEditor/models/xBookDocumentRefresh","DS/LifecycleServices/LifecycleServicesSettings","DS/PADUtils/PADProbes","DS/PADUtils/PADUtilsServices","DS/WebappsUtils/WebappsUtils","DS/Utilities/Utils","DS/FolderEditor/utils/FolderEditorcontrol","DS/FolderEditor/Folder_Clipboard"],function(e,t,o,n,i,r,a,s,l,d,c,u,p,g,f,h){"use strict";var m=t.extend(l,{name:"FolderTreeDocument",_doNotAddFolder:!1,init:function(t){t.shouldAcceptDrag=this.shouldAcceptDrag.bind(this),t.shouldAcceptDrop=this.shouldAcceptDrop.bind(this),t.allowUnsafeHTMLContent=!1,t.insert=this.insert.bind(this),t.authorize_setStructure=!0,t.shouldBeEditable=a.shouldBeEditable,this._parent(t),this.onNodeModelUpdate(a.onNodeModelUpdate);var n=this;this._commandProxy&&this._commandProxy.addProxyEvents({events:{onRefresh:function(e){if((UWA.is(e.authored.created,"array")||UWA.is(e.authored.modified,"array"))&&n.refreshNodeById({created:e.authored.created,modified:e.authored.modified}),UWA.is(e.authored.deleted,"array")){var t=[];e.authored.deleted.forEach(function(e){t=t.concat(n.getNodesById(e))}),n.deleteNodes(t,!0),0==h.removeDeletedNodeFromClipboard(e.authored.deleted)&&h.ClearClipboard()}}}}),this._logger=e.getLogger(m),this._logger.log("init");n=this;this.selection_broadcast_fn=g.debounce(function(){var e=f.getIdCardCont();if(e&&e.updateSelectionCount(n.getSelectedNodes().length),!n._doNotAddFolder){var t=n.getXSO().get();if(t&&t.length>0){var i=t[0];i.getID||(i.getID=function(){return this.id}),i.getType||(i.getType=function(){return this.plmType})}o.addInFolderCSO(t,"CONTENT")}},100),this.getXSO().onChange(n.selection_broadcast_fn),this.getXSO().onEmpty(function(){n._doNotAddFolder=!1,n.selection_broadcast_fn()}),this.getXSO().onPreEmpty(function(){n._doNotAddFolder=!0})},_buildSelectData:function(){var e=this._parent();if(e){var t=o.getCurrentFolder();if(Array.isArray(e.paths)&&e.paths.length>=1){if(t&&i.inFamilyFolder(t.plmType)){for(var n=o.getCurrentFolderPath(),r=[],a=Array.isArray(n)?n.length:0,s=0;s<a;s++)r.push({resourceid:n[s].id,type:n[s].type});e.folderPath=r}}else if(t&&i.inFamilyFolder(t.plmType)){n=o.getCurrentFolderPath();var l=[];for(a=Array.isArray(n)?n.length:0,s=0;s<a-1;s++)l.push({resourceid:n[s].id,type:n[s].type});var d={};if(a>=1){var c=a-1;n[c].id&&(d[n[c].id]={type:n[c].type,label:n[c].label})}e.paths=[[t.id]],e.attributes=d,e.folderPath=l}}return e},prepareBroadcastSelect:function(){this._doNotAddFolder=!0,this._parent()},pushBroadcastSelect:function(){this._doNotAddFolder=!1,this.selection_broadcast_fn(),this._parent()},shouldAcceptDrag:function(e){var t=[];if((t=o.getSelectedNodes()).length>0){var n=t[0].getType();if(i.isPersonalFolder(n)||"Busy"==n)return!1}return!0},shouldAcceptDrop:function(e){return!(e&&e.parentTreeNodeModel&&e.draggedTreeNodeModel)||i.isFolder(e.parentTreeNodeModel.plmType)},insert:function(e,t,o){if(e&&t){var i=n.getDragDataForSelectedNodesInCurrentFolderContent();n.processDroppedDataOnFolderEditorNode(t,i)}return!1},keepExpandedState:function(){var e=f.getContent().getPADTreeDocument();if(e){var t=e.getRoots(),o=0,n=t.length;for(o=0;o<n;o++){t[o].options.type;if(t[o].isExpanded()){f.getContent().RefreshProductStructure=!0;break}}}},deleteNodes:function(e){var t,n=e.length,i=!1;for(t=0;t<n;++t){if("noExpandState"!==e[t]._expandState&&!0===widget.getBool("filtered-content")){i=!0;break}}if(i){var r=o.getSelectedNodesID(),a=o.getCurrentFolder();f.getContent().RefreshProductStructure=!0,f.getContent().loadContentAndSelect(a,r)}else{this._parent(e),0===f.getContent().getObjectsInTree()&&f.getContent()._addPlaceHolder()}},refreshNodeById:function(e){var t,n,s,l=this,c=e.modified,u=[],g=[],h=!1,m=this.getRoots(),v=m.length;for(t=0;t<v;++t){var _=m[t],C=_.getID();if(i.inFamilyFolder(_.plmType))if(-1!==(S=c.indexOf(C)))c.splice(S,1),u.push(C);else e.modified.forEach(function(e){console.log("  modified :",e);var t=e.physicalid;e.operation;if(t===C){var o=e.key;o&&"ownerChanged"===o&&(h=!0),u.push(C);var n=c.indexOf(e);-1!==n&&c.splice(n,1)}});else if(s=void 0,s=!1,1==(n=_).options.isSearchWithinData&&(h=!0),n.options.isNotManagedByPS&&(s=n.options.isNotManagedByPS),s){var S;if(-1!==(S=c.indexOf(C)))c.splice(S,1),g.push(C);else e.modified.forEach(function(e){var t=e.physicalid;e.operation;if(t===C){var o=e.key;o&&"ownerChanged"===o&&(h=!0),g.push(C);var n=c.indexOf(e);-1!==n&&c.splice(n,1)}})}}if(e.modified=c,h){var F=o.getCurrentFolder();this.keepExpandedState();var y=o.getSelectedNodes(),D=[];y.forEach(function(e){D.push(e.getID())}),f.getContent().loadContentAndSelect(F,D)}else u.length>0&&u.forEach(function(e){r.getFolderProperties({pid:e,onComplete:function(t){UWA.is(t,"string")&&(t=JSON.parse(t));var o=a.convertToExaleadDataFormat(t),n=l.searchRootById(e);if(n){if(n._resetting=!0,n.options.oldLabel=o.label,n.options.publishOnConnect!==t.publishOnConnect){var i="TRUE"===t.publishOnConnect?p.getWebappsAssetUrl("FolderEditor","icons/folderPublishBadge.png"):"";n.setBadges({bottomRight:i})}d.getEnforceFolderLinkSettingAsync(function(e,t){e||t}),l.wrapInTransaction(function(){n.updateOptions(o)})}},onFailure:function(){console.error("Unable to update Tree Label, Error in getting folder Properties")}})}),g.length>0&&g.forEach(function(e){r.getContentProperties({pid:e,onComplete:function(t){if(UWA.is(t,"string")){t=JSON.parse(t);var o=a.convertToExaleadDataFormat(t),n=l.searchRootById(e);if(n){var i=null;n._ischeckout="TRUE"===t.Documentlocked||"[TRUE]"===t.Documentlocked?"TRUE":"FALSE",l.wrapInTransaction(function(){let e=n.getChildren();e&&e.length>0&&delete o.children,n.updateOptions(o),"TRUE"===n._ischeckout&&(i=p.getWebappsAssetUrl("FolderEditor","icons/22/I_CheckOutDocument.png"),a.setBadge(n,"bottomRight",i))})}}},onFailure:function(){console.error("Unable to update Content root node, Error in getting content Properties")}})}),this._parent(e)}});return m}),define("DS/FolderEditor/utils/FolderExpandUtil_Read",["UWA/Utils","DS/FolderEditor/service/FolderEditorWebServiceReadMode","DS/FolderEditor/utils/FolderEditorUtil","DS/FolderEditor/utils/FolderEditorcontrol","DS/WebappsUtils/WebappsUtils","i18n!DS/FolderEditor/assets/nls/FolderEditor","DS/IPClassifyUtil/IPClassifyAlert","DS/FolderEditor/tagger/TaggerTreeProxy"],function(e,t,o,n,i,r,a,s){var l=i.getWebappsAssetUrl("FolderEditor","icons/I_BookmarkInherit_v2.png"),d=i.getWebappsAssetUrl("FolderEditor","icons/I_Bookmark_v2.png");return{listFolder:function(e){var o=this,i=e.pid,r=null==e.level?"UI":"All"==e.level?-1:e.level,c=(e.expandList,e.partialExpandedChildren,e.isRoot),u=e.onComplete,p=[],g=n.getTreeCont(),f=s.getFilterTags(),h=e.recordScrollForIndex;"UI"==r?(e.Read=!0,e.nextStart=h?g._indexModeforReadData.getNextStart():0,f&&(e.refine="",Object.keys(f).length>0&&(e.refine=f)),e.onComplete=function(t){var o=JSON.parse(t);if(c&&o.infos&&h){var n=o.infos;g._indexModeforReadData.setInfoIndex(n),g._indexModeforReadData.setNextStart(n.nresults+e.nextStart)}if(o.folders&&(o.folders.forEach(function(e){"shared"==e.folderClassification.toLowerCase()?e.icon=l:e.icon=d}),u(JSON.stringify(o))),o.error){var i=o.error.message;e.onFailure(i),a.displayNotification({message:i,className:"error"})}},t.folderTree(e)):(c?p.push(new Promise(function(e,t){var n=s.getFilterTags(),i=n?{filters:n}:{};o._getRootBookmarks(i).then(function(t){e(t)}).catch(function(e){t(e)})})):p.push(Promise.resolve()),Promise.all(p).then(function(e){if(c){var t={};0;var n=e[0];if(1!==r)t.level=r,o._expandRoot(t,n,u);else{var a=o.dataConversionToJson(n);a={folders:a},u(JSON.stringify(a))}}else{0,(t={}).level=r,o._expandSubFolder(t,i,u)}}).catch(function(e){e&&a.displayNotification({message:"object"==typeof e?e.message:e,className:"error"}),u(JSON.stringify({folders:[]}))}))},_expandSubFolder:function(e,t,o){var n=this,i=[];i.push(t),e.multi_root_physicalid=i,n._getExpandedBookmarks(e).then(function(e){var t=n.dataConversionToJson(e);t.shift(),t.forEach(function(e){e.level=e.level-1}),t={folders:t},o(JSON.stringify(t))})},_expandRoot:function(e,t,o){var n=this;if(e.level=-1==e.level?e.level:e.level-1,0===t.size)return{folders:[]};var i=n._expandAllonRoot(e,t);Promise.all(i).then(function(){var e=n.dataConversionToJson(t);e={folders:e},o(JSON.stringify(e))})},_expandAllonRoot:function(e,t){var o=this,n=[];for(var i of t.keys()){var r=[];r.push(i),(e={level:e.level,isExpandDoneOnRoot:!0}).multi_root_physicalid=r,n.push(new Promise(function(n,i){o._getExpandedBookmarks(e).then(function(e){if(e.size>0){var o=e.keys().next().value;t.set(o,e.get(o))}n()})}))}return n},_getRootBookmarks:function(e){var o=this;return new Promise(function(i,a){var s=e;s||(s={}),Object.assign(s,{onComplete:function(e){var t=JSON.parse(e),r=n.getTreeCont(),s=t.infos;r._indexModeforReadData.setInfoIndex(s);var l=r._indexModeforReadData.getNextStart()+s.nresults;r._indexModeforReadData.setNextStart(l);var d=t.results;if(d&&d.length>0){var c=o._createMapWithSearchResult(d);i(c)}else a()},onFailure:function(){a(r.errorMessageBookmarkRoot)}}),t.getRoots(s)})},_getExpandedBookmarks:function(e){var o=this;return new Promise(function(n,i){t.expandFolder({level:e.level,multi_root_physicalid:e.multi_root_physicalid,"q.query":e["q.query"],onComplete:function(t){var i=JSON.parse(t),r=o._createMapWithExpandResult(i);if(e.isExpandDoneOnRoot){var a=new Map;if(r.length>0){var s=r[0].id;a.set(s,r)}r=a}n(r)},onFailure:function(){i(r.errorMessageBookmarkExpand)}})})},_createMapWithSearchResult:function(e){var t=this.getMappingforProperties_Search(),o=new Map;return e.forEach(function(e){var n=e.attributes,i={},r=null;n.forEach(function(e){if(t.has(e.name)){var o=t.get(e.name);i[o]=e.value,"id"==o&&(r=e.value),"folderClassification"==o&&("shared"==e.value.toLowerCase()?(i.icon=l,i[o]="Shared"):(i.icon=d,i[o]="Bookmark"))}}),i.hasOwnProperty("folderClassification")||(i.icon=d,i.folderClassification="Bookmark"),i.level=1,o.set(r,i)}),o},_createMapWithExpandResult:function(e){var t=e.results,o=this.getMappingforProperties_Expand(),n=[],i=[];t.forEach(function(e){if(e.hasOwnProperty("path")&&3==e.path.length&&n.push(e.path),e.hasOwnProperty("path")&&e.path.length>3)for(var t=[],o=0;o+3<=e.path.length;){for(g=o;g<o+3;g++)t.push(e.path[g]);o=g-1,n.push(t),t=[]}});var r=[];n.forEach(function(e){var t=e.length;if(t>1){for(var o=[],n=0;n<t;n+=2)o.push(e[n]);-1==r.indexOf(o[1])&&(r.push(o[1]),i.push(o))}});var a=new Map;path_treat_DUP=JSON.parse(JSON.stringify(i));for(var s=[];i.length>0;){for(var c=[],u=[],p=null,g=0;g<i.length;g++)if(0==g){for(var f=i[g],h=0;h<f.length;h++)c.push(f[h]),h==f.length-1&&(p=f[h]);u.push(f)}else{if(-1!==(f=i[g]).indexOf(p)){for(h=(v=f.indexOf(p))+1;h<f.length;h++)c.push(f[h]),h==f.length-1&&(p=f[h]);u.push(f)}}u.forEach(function(e){var t=i.indexOf(e);i.splice(t,1)});for(var m=null,v=0;v<c.length;v++){var _=c[v];-1!==s.indexOf(_)&&(m=s.indexOf(_),c.shift())}null!==m&&c.length>0?s.splice(m+1,0,...c):s=s.concat(c)}var C=s[0];a.set(C,1),function e(t,o){newarrs=[],pathToBeDeleted=[],t.forEach(function(e){for(var t=o.get(e),n=0;n<path_treat_DUP.length;n++){var i=path_treat_DUP[n];e==i[0]&&(o.set(i[1],t+1),newarrs.push(i[1]),pathToBeDeleted.push(n))}}),newarrs.length>0&&path_treat_DUP.length>0&&e(newarrs,o)}([C],a);var S=new Map;t.forEach(function(e){if(e.hasOwnProperty("attributes")&&e.attributes.length>1){var t={},n=null;e.attributes.forEach(function(e){if("did"==e.name){var i=a.get(parseInt(e.value));t.level=i;var r=o.get(e.name);n=t[r]=e.value}else if(o.has(e.name)){r=o.get(e.name);t[r]=e.value,"folderClassification"==r&&("shared"==e.value.toLowerCase()?(t.icon=l,t[r]="Shared"):(t.icon=d,t[r]="Bookmark"))}}),t.hasOwnProperty("folderClassification")||(t.icon=d,t.folderClassification="Bookmark"),S.set(n,t)}});var F=[];return s.forEach(function(e){F.push(S.get(e.toString()))}),F},getMappingforProperties_Search:function(){return new Map([["physicalid","id"],["ds6w:when/ds6w:created","created"],["ds6w:when/ds6w:modified","modified"],["ds6w:label","label"],["ds6w:identifier","name"],["ds6w:what/ds6w:type","type"],["ds6w:what/ds6w:policy","policy"],["ds6w:who/ds6w:responsible/ds6w:organizationResponsible","organizationResponsible"],["ds6w:who/ds6w:responsible","responsible"],["ds6w:who/ds6w:responsible/ds6w:originator","owner"],["ds6w:what/ds6w:status","status"],["ds6w:where/ds6w:context/ds6w:project","project"],["icon_2ddefaultthb.subtype","folderClassification"],["mxid","mxid"],["ds6wg:revision","revision"]])},getMappingforProperties_Expand:function(){return new Map([["physicalid","id"],["did","did"],["ds6w:created","created"],["ds6w:modified","modified"],["ds6w:label","label"],["ds6w:identifier","name"],["ds6w:type","type"],["ds6w:policy","policy"],["ds6w:organizationResponsible","organizationResponsible"],["ds6w:responsible","responsible"],["ds6w:originator","owner"],["ds6w:status","status"],["ds6w:project","project"],["icon_2ddefaultthb.subtype","folderClassification"],["mxid","mxid"],["ds6wg:revision","revision"]])},dataConversionToJson:function(e){var t=[];for(let o of e.values()){Array.isArray(o)?o.forEach(function(e){t.push(e)}):t.push(o)}return t}}}),define("DS/FolderEditor/infra/xBookComponent",["i18n!DS/PADUtils/assets/nls/PADUtils.json","i18n!DS/ENXNav/assets/nls/ENXNav.json","UWA/Core","UWA/Controls/Abstract","UWA/Class/Options","UWA/Class/Events","UWA/Promise","DS/UIKIT/Mask","DS/Utilities/Utils","DS/WebappsUtils/WebappsUtils","DS/PADUtils/views/PADAlert","DS/PADUtils/PADPromise","DS/PADUtils/PADSession","DS/PADUtils/PADTypesMgt","DS/WidgetServices/WidgetServices","DS/PADServices/utils/GlobalModelEvents","DS/PADUtils/PADSettingsMgt","DS/FolderEditor/utils/FolderEditorUtil","DS/FolderEditor/tagger/TaggerContentProxy","DS/FolderEditor/utils/FolderEditorcontrol"],function(e,t,o,n,i,r,a,s,l,d,c,u,p,g,f,h,m,v,_,C){"use strict";function S(){var e=this,t={},n=new a(function(n){require([e.options.amd_custo.TreeDocument],function(i){(t=function(e){var t=this,n={};return["doDnDDragStart","shouldAcceptDnDDrop","doDnDDrop"].forEach(function(e){o.is(t[e],"function")&&(n[e]=t[e].bind(t))}),n}.call(e)).authorize_setStructure=e.options.authorize_setStructure,t.insert_replace=e.options.insert_replace,t.renderTo=e.options.renderTo,e.options.model=new i(t),e.options.model.getModelEvents().subscribe({event:"onRootAdded"},function(t){if(t.data.added_node&&!1===e.options.layout.withWelcomePanel){var o=t.data.added_node.getID();e.dispatchEvent("onAddPaths",{addedPaths:[[o]]})}});var r=l.debounce(()=>{let t=e.options.model.getSelectedNodes(),o=[];t.forEach(e=>{o.push(e.getID())}),_.focusOnObjects(o)},200);e.options.model.getXSO().onChange(r),e.options.model.getModelEvents().subscribe({event:"onCenterGraph"},function(t){e.options.views.treelistview?e.options.views.treelistview.getManager().scrollToNode(t.data,void 0,!1):e.options.views.datagridview.options.dgv.ensureNodeModelVisible(t.data),e.options.views.graphview&&e.options.views.graphview.reframeOn()}),e.options.model.addEventListener("beginBlockingTransaction",function(t){e.beginBlockingTransaction(t.data)}),e.options.model.addEventListener("endBlockingTransaction",function(){e.endBlockingTransaction()}),e.options.isReady.model=!0,e._probes.probe_model.end(),n()})});return n.name="build",n}function F(e){var t=this;t.elements.container.empty(),o.createElement("div",{class:"xnav_hdr"}).inject(t.elements.container),o.createElement("div",{class:"xnav_body"}).inject(t.elements.container),o.createElement("div",{class:"xnav_footer"}).inject(t.elements.container);var n=new a(function(n,i){var r=[],s=t.elements.container.querySelector(".xnav_body"),l=new a(function(n,i){require(["DS/ENOXTriptych/js/ENOXTriptych","DS/PADUtils/PADSettingsMgt","DS/PADServices/utils/GlobalModelEvents"],function(i,r,a){var s,l=o.createElement("div",{class:"xbook_viewmain"}),d=o.clone(t.options.layout.triptychOpts);d.container=t.elements.container.querySelector(".xnav_body"),s=o.createElement("div",{class:"xbook_viewright rightSidePanel"}),t.elements.padshell=new i,t.elements.padshell.init(d,t.createRootListSlidder2(),l,s),t.elements.padshell.togglePanel=function(e){"left"===e?t.elements.padshell._modelEvents.publish({event:"triptych-toggle-panel",data:"left"}):(t.elements.padshell._modelEvents.publish({event:"triptych-toggle-panel",data:"right"}),t.elements.padshell._modelEvents.subscribe({event:"triptych-clicked-overlay"},function(e){e&&"right"===e&&a.publish({event:"onOverlayClick"})}))},a.publish({event:"on2DTriptychReady"}),require(["DS/ApplicationFrame/CommandsManager"],function(e){var t=e.getCommandCheckHeader("RootPanel");t&&t.addCallback()}),e.then(()=>{(function(e,t){var o=this;require(["DS/FolderEditor/views/ViewLoader"],function(n){var i={component:o,x3dAppId:o.options.x3dAppId,renderTo:e.renderTo,multiselection:o.options.multiselection,amd:{treelistview:o.options.amd_custo.TreeListView,tileview:o.options.amd_custo.TileGridView,thumbnailview:o.options.amd_custo.ThumbnailGridView,datagridview:o.options.amd_custo.DataGridView}};o.loader=new n(i),o.loader.loadView(o.options.active_view,function(){t()})})}).call(t,{renderTo:l},n)})})});l.name="slidder",r.push(l),a.all(r).then(function(e){!0===t.options.isReady[t.options.active_view]&&t._probes.probe_view.end(),t.elements.padstatus&&(!0===t.options.layout.padshell?t.elements.padstatus.inject(t.elements.padshell.getMainPanelContainer()):t.elements.padstatus.inject(s)),n()})});return n.name="buildSkeleton",n}return n.extend(i,r,{_dispatchReady_NotDone:!0,defaultOptions:{widget:null,elements:null,active_view:"treelistview",toolbar_opts:null,multiselection:!0,layout:{padshell:!1,title_update:!0,view_customization:null,store_roots_in_pref:!0,drop_invite:"dynamic",keyboard_inputs:!0,withWelcomePanel:!1,triptychOpts:{left:{resizable:!0,originalState:"close",overMobile:!0,minWidth:300,withClose:!0},withtransition:!0,withoverflowhidden:!0,right:{resizable:!0,originalState:"close",overMobile:!0,minWidth:250,withClose:!1}},amdTreeView:"treelistview"},amd_custo:{TreeDocument:"DS/FolderEditor/xBookDocument",TreeListView:null,TileGridView:null,ThumbnailGridView:null,DataGridView:null},views:{treelistview:null,graphview:null,tileview:null,thumbnailview:null,datagridview:null},views_cb:{},isReady:{model:!1,actionbar:!1,treelistview:!1,graphview:!1,tileview:!1,thumbnailview:!1}},_probes:{},setDnD_onGraph:function(){},init:function(e){this._parent(e),this.options=o.extend(this.options,e,!0),this.elements.container=o.createElement("div",{class:"xbook_component"}),this.options.flags={};var n=this;require(["DS/PADUtils/PADSettingsMgt","DS/PADUtils/PADUtilsServices","DS/PADUtils/PADProbes"],function(e,i,r){n._probes.probe_init=r.createProbe("init_xnavcomponent"),e.setSetting("lang",f.getLanguage()),i.app_initialization(function(i){if(i&&!0===i.success){n._probes.probe_model=r.createProbe("init_xnav_model");var s=S.call(n);n._probes.probe_view=r.createProbe("init_xnav_views");var l=F.call(n,s);a.all([s,l]).then(function(){n.options.model.getVisibleAdditionalColumns=function(){var e=[];if(n.options.views.treelistview)var t=n.getPADTreeListView().getManager();else t=n.options.views.datagridview;if(n.options.additionalColumnsModules&&n.options.additionalColumnsModules.length)for(var i=0;i<n.options.additionalColumnsModules.length;i++){for(var r=[],a=n.options.additionalColumnsModules[i],s=a.getManagedColumnNames(),l=0;l<s.length;l++)(a.allViewsSupported||t&&o.is(t.isColumnHidden,"function")&&!t.isColumnHidden(s[l]))&&r.push(s[l]);r.length&&e.push({module:a,columns:r})}return e},n._dispatchReady(!1),h.subscribe({event:"FolderEditor/expandStatus"},function(o){o.status&&!0===o.status.expandTooLarge&&("find_in_ctx"===o.mode?c.displayNotification({msg:t.replace(t.tooManyResultFound,{maxResult:e.getSetting("maxPathsForSearch")}),eventID:"warning"}):c.displayNotification({msg:t.expandTooLarge,eventID:"warning"}))})})}else n._initialize_failure(function(){n.dispatchEvent("onReady",{error:!0})})})})},render:function(){return this.elements.container},toggleView:function(e){if(e!==this.options.active_view){var t=this;"treeview"===e&&(e=this.options.layout.amdTreeView),this.loader.loadView(e,function(){t.options.views[t.options.active_view].unsetModel(),t.options.active_view=e,t.options.model.applyActiveView(t.options.active_view),t.options.views[t.options.active_view].setModel(t.options.model),"graphview"===t.options.active_view&&t.options.views.graphview.reframeOn(),t.dispatchEvent("onToggleView",t.options.active_view)})}},beginBlockingTransaction:function(e){s.mask(this.elements.container,e)},endBlockingTransaction:function(){s.unmask(this.elements.container)},onResize:function(){this.options.model.invalidateViewPort(),"graphview"===this.options.active_view&&this.options.views.graphview.setSize(),this.dispatchEvent("onParentResize")},getPADTreeDocument:function(){return this.options.model},getRoots:function(){return this.options.model.getRoots()},getPADTreeListView:function(){return this.options.views.datagridview},togglePanel:function(e,t){(this.elements.padshell?this.elements.padshell:this.elements.padinfo).togglePanel(e,t)},displayNotification:function(e){require(["DS/IPClassifyUtil/IPClassifyAlert"],function(t){t.displayNotification(e)})},_initialize_failure:function(e){var o=this;require(["DS/FolderEditor/views/xBookInitError"],function(n){var i=t.initialization_error;o.elements.bigerror=new n({msg:i}),o._just_error_content(),o.displayNotification({message:i,className:"error"}),e()})},_just_error_content:function(){this.elements.bigerror&&this.elements.container.setContent(this.elements.bigerror)},compactMode:function(e){this.getPADTreeListView().compactMode(e),this.dispatchEvent("onCompactMode",e)},updateAttributesDelayed:function(e){var t=this;this._debounceMethod=this._debounceMethod?this._debounceMethod:l.debounce(function(e){var o=e.displayNodesArray;if(void 0===o&&e&&e.collectionView&&e.collectionView.model){var n=e.collectionView;o=e.endNodeIndex>=0?n.model.slice(e.startNodeIndex,e.endNodeIndex+1):n.model.slice(e.startNodeIndex,e.endNodeIndex)}if(o.length){for(var i=[],r=0;r<o.length;r++)o[r]._canBeGrouped()&&!0!==o[r].isRelationsObjectGroupingNode&&i.push(o[r]);t.options.additionalColumnsModules&&t.options.additionalColumnsModules.length&&t.options.model.fillAttributesAsync4VisibleNodes(i,t.options.additionalColumnsModules);for(var a=require("DS/PADUtils/PADPredicatesNls"),s=0,l=o.length;s<l;s++)!0===o[s]._manageNLS&&(delete o[s]._manageNLS,a.updateNLS(o[s]));"datagridview"===t.getActiveView()&&v.isRelationsColumnsActive()&&require(["DS/ENORIPE_Columns/RelationsColumns","DS/PADServices/utils/PlatformURL","DS/FolderEditor/utils/FolderSearch"],(e,n,i)=>{i.isSearchActive()||n.retrievePlatformUrl().then(()=>{e.setHardcodedConfiguration("BME");var n=new Set;if(o.forEach(function(e){e.isRelationsObjectNode||e._isProcessedForRelationsColumns||(n.add(e.getID()),e._isProcessedForRelationsColumns=!0)}),n.size>0){var i=C.getContent().getSelectedNodes();e.updateAttributes({pids:[...n]},()=>{i.forEach(function(e){e.select()})},t.options.model)}})})}},200);let o=!0;e&&e.collectionView&&e.collectionView.getRowModelLength&&0===e.collectionView.getRowModelLength()&&(o=!1),o&&this._debounceMethod(e)}})}),define("DS/FolderEditor/utils/FolderNavigateUtil_Read",["UWA/Utils","DS/FolderEditor/service/FolderEditorWebServiceReadMode","i18n!DS/FolderEditor/assets/nls/FolderEditor"],function(e,t,o){return{getNavigateDataforFolder:function(e){var o=this;t.getFolderPathsforItems({ids:e.pids,onComplete:function(t){var n=o.createFolderPathData(t);e.onComplete(JSON.stringify(n))},onFailure:function(t){e.onFailure(t)}})},createFolderPathData:function(e){var t=this;if(!(e.result&&e.result.length>0))return{error:o.NoPathFound};var n=e.result,i={};return n.forEach(function(e){var o=e.input_object.physicalid,n="Workspace"==e.input_object["ds6w:type"],r=!!(e.outputs.GET_PARENT&&e.outputs.GET_PARENT.length>0);if(n||r){var a=n?e.input_object:e.outputs.GET_PARENT[0],s={},l=[],d=[];for(var c in a){var u=t.getMappingforProperties_Navigate().get(c);if(u&&(s[u]=a[c]),"paths"==c&&a.paths.length>0){var p=a.paths[0];d=t._getArrayofSubPaths(p)}}l.push(s);for(var g=d.length-1;g>=0;g--){var f=d[g];l.push(f)}i[o]=l}}),Object.keys(i).length>0?i:void 0},_getArrayofSubPaths:function(e){var t=this,o=[];return e.forEach(function(e){var n={};for(var i in e){var r=t.getMappingforProperties_Navigate().get(i);r&&(n[r]=e[i])}o.push(n)}),o},getMappingforProperties_Navigate:function(){return new Map([["physicalid","id"],["did","did"],["ds6w:created","created"],["ds6w:modified","modified"],["ds6w:label","label"],["ds6w:identifier","name"],["ds6w:type","type"],["ds6w:policy","policy"],["ds6w:organizationResponsible","organizationResponsible"],["ds6w:responsible","responsible"],["ds6w:originator","owner"],["ds6w:status","status"],["ds6w:project","project"],["mxid","mxid"],["ds6wg:revision","revision"]])}}}),define("DS/FolderEditor/controllers/AuthoringMode",["DS/FolderEditor/controllers/CommonMode","DS/FolderEditor/service/FolderEditorWebService","DS/FolderEditor/Folder_CSO","DS/FolderEditor/utils/FolderEditorUtil","DS/FolderEditor/utils/FolderListContent_Read","i18n!DS/FolderEditor/assets/nls/FolderEditor"],function(e,t,o,n,i,r){return e.extend({init:function(e){this._parent(e)},convertData:function(e){return n.convertToExaleadDataFormat(e)},loadContents:function(e){this._parent();var n=this;return new Promise((i,a)=>{e.onComplete=(t=>{this.loadFacet(e);var n=null;if(o.getCurrentFolder()&&(n=o.getCurrentFolder().getID()),n===e.pid){var s=(t="string"==typeof t?JSON.parse(t):t).content;void 0!==(s=s||t.folders)?(t.contents=s,i(t)):a({message:r.msg_error_contentnotavailable,className:"error"})}}),e.onFailure=function(e,t){a({err:e,serverErr:t})},n._contentHandleRequest="FolderSection_AllFolders"===e.type?t.roots(e):t.content(e)})},loadFacets:function(e){return new Promise((t,o)=>{let n=UWA.clone(e);n.synthesis=!0,n.onComplete=t,n.onFailure=o,this._taggerHandleRequest=i.listContent(n)})},getModeType:function(){return"authoring"}})}),define("DS/FolderEditor/views/FolderOrderCmd",["UWA/Controls/Abstract","UWA/Class/Options","UWA/Class/Events","DS/FolderEditor/utils/FolderEditorUtil","i18n!DS/FolderEditor/assets/nls/FolderEditor","DS/FolderEditor/utils/FolderEditorcontrol","DS/Controls/TooltipModel","DS/FolderEditor/views/FolderMode"],function(e,t,o,n,i,r,a,s){"use strict";return e.extend(t,o,{_name:"folder_orderTools",_defaultOptions:{sortMode:"alpha",sortOrder:"asc"},init:function(e){this._parent(e),this.sortMode=widget.getValue("sortMode")||this._defaultOptions.sortMode,this.sortOrder=widget.getValue("order")||this._defaultOptions.sortOrder,this._buildSkeleton()},_buildSkeleton:function(){this.elements.container=UWA.createElement("div",{id:"folder_orderTools"}),"alpha"===this.sortMode&&this.sortOrder,"alpha"!==this.sortMode&&this.sortOrder},toggleButton:function(){this.sortMode="alpha",this.sortOrder&&("asc"===this.sortOrder?this.sortOrder="desc":this.sortOrder="asc"),this.sortingNodesUnsensitiveCase(),widget.setValue("sortMode",this.sortMode),widget.setValue("order",this.sortOrder)},toggleButtonDate:function(){this.sortMode="date",this.sortOrder&&("asc"===this.sortOrder?this.sortOrder="desc":this.sortOrder="asc"),this.sortingNodesUnsensitiveCase(),widget.setValue("sortMode",this.sortMode),widget.setValue("order",this.sortOrder)},getSortMode:function(){return this.sortMode},sortingNodesUnsensitiveCase:function(){var e=r.getTreeCont();e&&e._folders_TreeView&&(e._folders_TreeView.sortModel=[{dataIndex:"tree",sort:this.sortOrder}],e._folders_TreeView.reapplySortModel())},sortingChildrenNodes:function(e){var t=this,o=r.getTreeCont()._folders_TreeView;o.prepareUpdateView(),e.sortChildren({isRecursive:!0,sortFunction:function(e,o){return("asc"===t.sortOrder?1:-1)*t.mySortFunction(e,o)}}),o.pushUpdateView()},mySortFunction:function(e,t){this.sortOrder;var o,i="FolderSection_favorite"===e.getParent().plmType;if(i)return null;if(e.isRoot()&&t.isRoot()||i)return null;if("date"!==this.sortMode)return n.compareLabels(e.options.label,t.options.label);try{o=new Date(e.options.created)>new Date(t.options.created)?1:new Date(e.options.created)<new Date(t.options.created)?-1:0}catch(n){o=e.options.created<t.options.created?-1:1}finally{return o}},setOrderToolAreaSelectable:function(e){e?this.elements.container.style.setProperty("cursor","pointer"):this.elements.container.style.setProperty("cursor","default")}})}),define("DS/FolderEditor/FolderXNavComponent",["DS/FolderEditor/infra/xBookComponent","DS/PADUtils/PADSession","i18n!DS/PADUtils/assets/nls/PADUtils.json"],function(e,t,o){"use strict";return t.softInit(),e.extend({name:"pad_component",init:function(e){var t,o,n=(t=e,(o={x3dAppId:"ENOPAD",widget:widget,amd_custo:{TreeDocument:"DS/FolderEditor/FolderTreeDocument",TreeListView:"DS/FolderEditor/views/FolderTreeListView",TileGridView:"DS/FolderEditor/views/FolderTileView",ThumbnailGridView:"DS/FolderEditor/views/FolderThumbnailView"},layout:{}}).layout=UWA.clone(t.layout_opts),delete(o=UWA.extend(o,t,!0)).layout_opts,o),i=this._parent.bind(this);this.setFolderCommunicationChannel(),require(["UWA/Utils/Client"],function(e){i(n)})},render:function(){return this},getPADTileGridView:function(){return this.options.views.tileview},getPADThumbnailGridView:function(){return this.options.views.thumbnailview},getEditMode:function(){return require("DS/PADUtils/PADSettingsMgt").getSetting("EditModeActivated")},addRootNodes:function(e){if(!UWA.is(e,"array"))throw new Error("nodes parameter must be an array");var t=[],o=this.options.model;o&&o.wrapInTransaction(function(){o.withTransactionUpdate(function(){o.addRoot(e);for(var n=0;n<e.length;n++){let o=e[n];t.push(o.getID()),!1===o.bkTempVisible&&(delete o.bkTempVisible,o.filterOut())}o.getRoots().length;UWA.is(o.detachedRoots,"array")&&o.detachedRoots.length,o.getModelEvents().publish({event:"onRootAdded",data:{nb_root:o.getRoots().length,added_node:e[o.getRoots().length-1]}})})})},getSelectedNodes:function(){return this.options.model.getSelectedNodes()},getActiveView:function(){return this.options?this.options.active_view:"datagridview"},_dispatchReady:function(){!0===this.options.isReady.model&&!0!==this.options.isReady.PADmodel&&(this.options.isReady.PADmodel=!0),!0===this.options.isReady.model&&this._probes.probe_model.end(),!0===this.options.isReady[this.options.active_view]&&this._probes.probe_view.end(),!0===this._dispatchReady_NotDone&&!0===this.options.isReady.model&&!0===this.options.isReady[this.options.active_view]&&(this.dispatchEvent.call(this,"onReady"),this.dispatchEvent("onActionBarReadyToBuild"),this._probes.probe_init.end(),this._dispatchReady_NotDone=!1)}})}),define("DS/FolderEditor/views/additionalColumns/BookmarkLocationColumn",["UWA/Core","UWA/Class","DS/FolderEditor/service/FolderServices","DS/FolderEditor/service/FolderEditorWebService","i18n!DS/FolderEditor/assets/nls/FolderEditor","DS/PADServices/utils/GlobalUtils","DS/FolderEditor/utils/FolderSearch","DS/ApplicationFrame/CommandsManager","DS/FolderEditor/utils/FolderEditorcontrol","DS/FolderEditor/Folder_CSO","DS/FolderEditor/utils/BookmarkLocationUtil","DS/Utilities/Dom","DS/Controls/TooltipModel"],function(e,t,o,n,i,r,a,s,l,d,c,u,p){"use strict";var g=t.singleton({init:function(e){this._parent(e)},isAdditionalColumnsAvailable:function(t){if(!1===e.is(t,"function"))throw new Error("A callback function should be defined");!function(e){var t={dataIndex:"bookmarkLocation",text:i.column_BookmarkLocation,width:100,minWidth:80,maxWidth:200,isHidden:!1,sortableFlag:!1,alignment:"left",typeRepresentation:"string",getCellClassName:function(e){return r.createCSSClass("bk-ellipsys-span-column",".bk-ellipsys-span-column:hover{text-decoration: underline;}\n.bk-ellipsys-span-column{cursor:pointer;color: #23527c;width: 100%;display: inline-block;vertical-align: middle;padding-left: 7px}"),"bk-ellipsys-span-column"},customisation:{dataIndex:"bookmarkLocation",exportable:{lock:!0,value:!1},layout:{removable:!1}}};g._columnDataIndex=["bookmarkLocation"],g._columnDef={bookmarkLocation:t},e()}(function(){t(!0)})},getName:function(){return"bookmarkLocation"},getManagedColumnNames:function(){return this._columnDataIndex},toBeUpdated:function(e,t){var o=!1;return void 0!==e.bookmarkLocation&&""!==e.bookmarkLocation||(o=!0),o},getOnCellClickCB:function(e,t){return e===this.getName()&&function(e){c.getFolderPathsforItem(e.nodeModel)}},getCellReusableContent:function(){return{id:this.getName(),buildContent:function(){return c.getHtmlElemFromPath("",!0)}}},_getWidthToDisplayLocation:function(e){let t=0,o=l.getContent();if(!o)return t;let n=o.getPADTreeListView();if(!n||!n.getManager())return t;var i=n.getFontDetails(),r=i.fontSize,a=i.fontMargin,s=i.fontSytle;return a+(t=Math.ceil(u.computeStringWidth(e,r,s,!1,!1)))+a},updateAttributesOnResize:function(e,t){let o=l.getContent();if(!o)return;let n=o.getPADTreeListView();if(n&&n.getManager()){var i=n.getColumnWidth(this.getName());for(let o=0;o<e.length;++o){var r=n.getManager().layout.getCellIDFromCoordinates({rowID:e[o]._getRowID(),columnID:t});let a=n.getManager()._getViewAt(r)._getReusableContent();if(a&&a.childNodes&&a.childNodes.length>0){let e=this._getWidthToDisplayLocation(a.childNodes[0].innerText);a.childNodes[0].innerText=c.getResizedText(i,e,a.getAttribute("titlex"),a.childNodes[0].innerText),a.tooltipInfos=new p({longHelp:a.getAttribute("titlex")})}}}},onCellRequest:function(e){let t=l.getContent();if(!t)return;let o=t.getPADTreeListView();if(o&&o.getManager()){if(e&&e.cellModel){var n=o.getManager().reuseCellContent("bookmarkLocation");if(n.setData(e.cellModel),n.childNodes&&n.childNodes.length>0){var i=o.getColumnWidth(this.getName());let t=this._getWidthToDisplayLocation(n.childNodes[0].innerText);return n.childNodes[0].innerText=c.getResizedText(i,t,n.getAttribute("titlex"),n.childNodes[0].innerText),n.tooltipInfos=new p({longHelp:n.getAttribute("titlex")}),e.cellView._setReusableContent(n),!0}}}},updateAttributes:function(t,o){var r=this;if(!1===e.is(t,"object"))throw new Error("The object ids to modify must be specify");if(!1===e.is(o,"function"))throw new Error("A callback function should be defined");var a=[];t.pids.forEach(function(e){a.push(e)});var s=d.getCurrentFolder().getID();n.getFolderPathsforItem({id:a,onComplete:function(e){var t=r._calculatePath(e,s),n=[],a=[];t.length>0&&t.forEach(function(e){for(var t=e.length,o=0;o<t;o++){var r=e[o].fullPath.join(" > ");1===e.length?n.push(r):n.push(i.replace(i.name_Section_ParentFolders,{number:e.length}));var s=e[o].ids.length,l=e[o].ids[s-1];a.push(l)}});var l={};if(n.length===a.length)for(var d=0;d<n.length;d++)l[a[d]]={bookmarkLocation:n[d]};var c={pids:l};c=JSON.stringify(c),o(c)}})},getAdditionalColumnsUXDGV:function(t){for(var o=[],n=0;n<t.length;n++)o.push(t[n].dataIndex);for(var i=0;i<this._columnDataIndex.length;i++){var r=this._columnDataIndex[i],a=e.clone(this._columnDef[r]),s=o.indexOf(r);-1===s?t.push(a):t[s]=e.extend(t[s],a,!0)}},getCellClassName:function(e,t){if(t==this._columnDataIndex[0]){let e="bk-ellipsys-span-column",t=".bk-ellipsys-span-column:hover{text-decoration: underline;}\n.bk-ellipsys-span-column{cursor:pointer;color: #23527c;width: 100%;display: inline-block;vertical-align: middle;padding-left: 7px}";return r.createCSSClass(e,t),e}},_calculatePath:function(e,t){var o=[];return e.result.forEach(function(e){var n=e.outputs.GET_PARENT,i=[],r={lable:null,physicalid:null,type:null};if(void 0!==n){for(var a=0;a<n.length;a++){var s=n[a].paths;r.lable=n[a]["ds6w:label"],r.physicalid=n[a].physicalid,r.type=n[a]["ds6w:type"];for(var l=0;l<s.length;l++){var d=s[l],c={type:null,name:null,idToNavigate:null,fullPath:[],ids:[]};c.fullPath.push(r.lable),c.ids.push(r.physicalid);for(var u=d.length-1;u>=0;u--){("Workspace"===(e=d[u])["ds6w:type"]||"Workspace Vault"===e["ds6w:type"]&&e.physicalid!=d[0].physicalid)&&(c.idToNavigate=e.physicalid,c.type=e["ds6w:type"],c.name=e["ds6w:label"],c.fullPath.push(e["ds6w:label"])),c.ids.push(e.physicalid)}null===c.idToNavigate&&(c.idToNavigate=r.physicalid,c.type=r.type,c.name=r.label),("FolderSection_AllFolders"===t||c.ids.includes(t))&&i.push(c)}}o.push(i)}}),o}});return g}),define("DS/FolderEditor/views/FolderDataGridView",["UWA/Core","UWA/Promise","UWA/Class","UWA/Class/Options","DS/DataGridView/DataGridView","DS/DataGridView/DataGridViewLayout","DS/PADUtils/PADCommandProxy","DS/FolderEditor/views/customize_views/FolderDGVParametrization","DS/FolderEditor/views/customize_views/_FolderDGVUtils","DS/PADUtils/Configuration","DS/FolderEditor/utils/FolderSearch","DS/FolderEditor/utils/FolderEditorcontrol","DS/FolderEditor/commands/FolderCommands","DS/FolderEditor/utils/FolderEditorKeyboardListener","DS/FolderEditor/ActionBar/FolderCommandManager","DS/FolderEditor/utils/FolderEditorUtil","DS/CollectionView/commands/CollectionViewCommands","DS/PADServices/utils/GlobalUtils","DS/Controls/Button","DS/PADServices/utils/GlobalModelEvents","DS/PADServices/utils/AttributesMgtV2","DS/FolderEditor/utils/FolderEditorEvents","DS/FolderEditor/views/additionalColumns/BookmarkLocationColumn","DS/FolderEditor/views/FolderMode","DS/FolderEditor/Folder_CSO","DS/IPClassifyUtil/DimensionUtils","DS/ApplicationFrame/CommandsManager"],function(e,t,o,n,i,r,a,s,l,d,c,u,p,g,f,h,m,v,_,C,S,F,y,D,b,E,w){"use strict";var A=new g;return o.extend(n,s,l,{name:"FolderTreeListView",defaultOptions:{renderTo:null,context:null,modelEvents:null,subscribeTokens:[],dgv:null,dgvLayout:null,viewMode:"",clickEvent:{"ds6w:reserved":function(e){this.returnCommand(e,"ds6w:reserved")},"ds6w:status":function(e){this.returnCommand(e,"ds6w:status")},"ds6w:responsible":function(e){this.returnCommand(e,"ds6w:responsible")},returnCommand:function(e,t){if(e.nodeModel){let o=0;!1===e.nodeModel.isSelected()&&(e.nodeModel.select(),o=250),setTimeout(()=>{var o;if("ds6w:reserved"==t){let t=e.nodeModel.getReferenceValue("ds6w:reserved");o="ActionBar_ReserveCmd",!0===("boolean"==typeof t?t:"TRUE"===t.toUpperCase())&&(o="ActionBar_UnreserveCmd")}else"ds6w:status"==t?o="MaturityHdr":"ds6w:responsible"==t&&(o="ActionBar_TransferOwnership");var n=w.getCommand(o);n&&n.isEnabled()&&n.begin()},o)}}},doubleClickEvent:{}},init:function(e){this._parent(e),this.setOptions(e)},initialize:function(){var o=this;return new t(function(n){var s=e.clone(d.getConfig("dgvOptions"));o.options.viewMode=s.viewMode;var l=u.getPlaceholder(),p=o.buildDGVOpts();t.all([l,p]).then(function(t){var l=t[1],d=t[0],p=!1!==o.options.context.options.settings.view_settings.sortPersistence;p||(l.sortModel=[{dataIndex:"defaultSort",sort:"asc"}]);var g=e.extend({identifier:"DataGridView-"+o.name+"-"+widget.id},l);if("undefined"!==s.dgvLayout){var f=e.clone(s.dgvLayout);void 0!==l.defaultCellHeight&&(f.cellHeight=l.defaultCellHeight,l.defaultCellHeight<80&&(f.columnHeaderHeight=l.defaultCellHeight),delete l.defaultCellHeight),!window.__karma__&&navigator.webdriver&&(l.rowsHeader=!0),void 0!==l.rowsHeader&&(f.rowsHeader=l.rowsHeader,delete l.rowsHeader),l.columns.forEach(function(e){e.minWidth=50}),g.layout=o.options.dgvLayout=new r(f),g.layout.useLastColumnWidthAutoFlag=!0}g.placeholder=d.getContent();var m=null,v=!0;g.columns.forEach(function(e,t){"ContextualMenuColumn"===e.dataIndex&&(m=t,v=e.visibleFlag)}),null!==m&&g.columns.splice(m,1),g.showContextualMenuColumnFlag=!0,g.useAsyncPreExpand=!0,g.rowSelection=o.options.multiselection?"multiple":"single",o.options.dataGridPlaceHolder=g.placeholder,o.options.viewMode=l.viewMode?l.viewMode:"comfortable";var _=u.getTreeCont();_&&_.modeChange({viewMode:o.options.viewMode});var S=o.options.dgv=new i(g);S.selectNextCellOnEnterFlag=!1,S.setUseClipboardFlag(!1),o.ctxColOpts=S.getColumnOrGroup("ContextualMenuColumn"),o.ctxColOpts&&(o.options.dgv.prepareUpdateView(),o.ctxColOpts.visibleFlag=v,o.ctxColOpts.customisation={exportable:{lock:!0,value:!1},layout:{pinEditable:!0,removable:!0}},o.options.dgv.pushUpdateView({updateCellContent:!0,updateCellLayout:!1,updateCellAttributes:!0},!0));var F=h.getContentSortmodel();l.sortModel=!p||l.sortModel?l.sortModel:F,l.sortModel&&(o.options.dgv.prepareUpdateView(),o.options.dgv.sortModel=l.sortModel,o.options.dgv.layout.saveColumnSortModelInPreferences(),o.options.dgv.pushUpdateView({updateCellContent:!1,updateCellLayout:!0,updateCellAttributes:!1},!0)),S.onCopy=A.launchKeyAction.bind(A,"ctrl+c"),S.onCut=A.launchKeyAction.bind(A,"ctrl+x"),S.onPaste=A.launchKeyAction.bind(A,"ctrl+v");["esc","del","ctrl+f","alt+return","f2"].forEach(function(e){S._keymapManager.registerKeymap(e,void 0)}),c.onSearchChange(function(){var e=S.getColumnOrGroup("bookmarkLocation");e&&(c.isSearchActive()?(e.customisation.layout.removableFromView=!0,e.visibleFlag=!0,e.customisation.exportable={lock:!1,value:!0}):(e.customisation.layout.removableFromView=!1,e.visibleFlag=!1,e.customisation.exportable={lock:!0,value:!1}))}),S.addEventListener("sortModelChange",function(){(c.isSearchActive()||"read"==D.getCurrentModeType()&&!1===widget.getBool("filtered-content"))&&u.getContent().loadContentAndSelect()}),S.onInfiniteScroll(function(e){u.getContent().processForInfiniteScroll(e,S)}),o._commandProxy=a.create(),o.eventHandlerOnGridView(S).then(function(){S.getContent().addClassName(o.name),o.options.renderTo&&!0===o.options.isActiveView&&S.inject(o.options.renderTo),n()}),C.getModelEvents().subscribe({event:"IPClassifyColumnCusto/AttributesCustomization/columnModification"},function(t){switch(t.what){case"addRemoveColumns":t.removedColumns&&t.removedColumns.length>0&&o.removeColumn(t.removedColumns),t.addedColumns&&t.addedColumns.length>0&&o.addColumn(e.clone(h.filterDBOnlyAttrs(t.addedColumns)));break;case"reset":o.resetColumn()}}),C.getModelEvents().subscribe({event:"nodeColorUpdated"},function(){S.invalidateLayout({updateCellContent:!0,updateCellLayout:!0})}),S.registerReusableCellContent(y.getCellReusableContent())})})},escape:function(){this.options.dgv.commands.escape.bind(this.options.dgv)()},getManager:function(){return this.options.dgv},addColumn:function(e){e.length>0&&(c.addPredicates(e),F.notifyCurrentFolderColumnChange())},removeColumn:function(e){c.removePredicates(e)},resetColumn:function(){c.setPredicates(S.getAvailableColumnsOpts()),F.notifyCurrentFolderColumnChange()},setModel:function(e){this.options.dgv.getContent().inject(this.options.renderTo),this.options.isActiveView=!0,this.options.dgv.treeDocument=e},unsetModel:function(){this.options.isActiveView&&(this.options.renderTo.removeChild(this.options.dgv.getContent()),this.options.isActiveView=!1,this.options.dgv.treeDocument=null)},isColumnHidden:function(e){return!this.options.dgv.layout.getColumnVisibleState(e)},showColumn:function(e){this.changeVisibilityCB(e,!0)},hideColumn:function(e){this.changeVisibilityCB(e,!1)},changeColumnTitle:function(e,t){this.changeTitleCB(e,t)},getDatagridPlaceHolder:function(){return this.options.dataGridPlaceHolder},getFontDetails:function(){var e=this.options.dgv,t=12,o=10;e&&e.layout&&e.layout.collectionView&&e.layout.collectionView._getCurrentTouchMode()&&(t=14,o=20);var n="Ariel";if(e&&e.layout&&e.layout.collectionView){let o=e.layout.collectionView.elements.leftPoolContainer;if(o){let e=o.getElementsByClassName("wux-tweakers-string-label");if(e&&e.length>0){let o=e[0];t=(t=o.getStyle("font-size"))?parseInt(t.replace("px","")):12,n=o.getStyle("font-family")}}}return{fontSize:t,fontMargin:o,fontSytle:n}},getColumnWidth:function(e){var t=0,o=this.options.dgv;return o&&o.layout&&o.layout.getColumnWidth&&(t=o.layout.getColumnWidth(e)),t},getRowHeight:function(){var e=0,t=this.options.dgv;return t&&t.layout&&t.layout.getRowHeight&&(e=t.layout.getRowHeight()),e},scrollToVisibleNode:function(e){var t=this.options.dgv,o=t.layout.getColumnIndex("tree"),n=t.layout.getCellsFromNodeModel(e)[o];t.scrollToCellAt({cellID:n})},getColumnUnitNls:function(e,t){let o=null;var n=this.options.dgv;if(n&&n.layout&&n.layout.getLeafColumns){let r=n.layout.getLeafColumns();for(var i=0;i<r.length;++i)if(r[i].dataIndex===e){r[i].convertInfos&&(o=r[i].convertInfos.nls),r[i].convertInfos&&r[i].convertInfos.manipulationUnit&&r[i].convertInfos.manipulationUnit!==r[i].convertInfos.unit&&(o=!0===t?null:r[i].convertInfos.manipulationNls);break}}return o},getManipulationUnitColumns:function(){let e=[];var t=this.options.dgv;if(t&&t.layout&&t.layout.getLeafColumns){let n=t.layout.getLeafColumns();for(var o=0;o<n.length;++o)n[o].convertInfos&&n[o].convertInfos.manipulationUnit&&n[o].convertInfos.manipulationUnit!==n[o].convertInfos.unit&&e.push(n[o])}return e},getManipulationUnitVisibleValues:function(t,o){let n=[];var i=this.options.dgv;if(i&&i.model&&i.layout){var r=i.layout.getMinMaxVisibleRowIDs();if(r&&r.hasOwnProperty("minRowID")&&r.hasOwnProperty("maxRowID"))for(var a=r.minRowID;a<=r.maxRowID;++a){let r=i.model[a];if(o&&r.getID()!==o)continue;let s=(r.grid||r.options.grid)[t];if(e.is(s,"array")?n=n.concat(s):s&&n.push(s),o&&r.getID()===o)break}}return n},enrichSearchValue:function(e){let o=this;return new t(function(t){var n=o.options.dgv;e&&n&&n.layout&&n.layout.getLeafColumns||t(e);let i=e;if(-1!==e.indexOf(":")){let o=e.substr(0,e.indexOf(":")),a=o,s=e.substr(e.indexOf(":")+1,e.length),l=n.layout.getLeafColumns(),d=null;for(var r=0;r<l.length;++r)if(l[r].text===o){if(a="["+l[r].dataIndex+"]",l[r].convertInfos&&l[r].convertInfos.manipulationUnit&&l[r].convertInfos.manipulationUnit!==l[r].convertInfos.unit){(d={}).Data=[];let e={};e.Dimension=l[r].convertInfos.dimension,e.UnitFrom=l[r].convertInfos.manipulationUnit,e.UnitTo=l[r].convertInfos.unit,e.Values=s,d.Data.push(e)}break}i=i.replace(o,a),d?E.convertToPreferdUnits(d).then(function(e){e&&0!==e.length||t(i),t(a+":"+e[0].ConvertedValues)}):t(i)}else t(i)})}})}),define("DS/FolderEditor/FolderTrashDocument",["DS/Logger/Logger","DS/Tree/TreeDocument","DS/PADUtils/PADCommandProxy","DS/PADUtils/PADUtilsServices","DS/Tree/TreeNodeModel","DS/IPClassifyUtil/IPClassifyAlert","DS/FolderEditor/utils/FolderEditorUtil","DS/FolderEditor/utils/FolderEditorcontrol","DS/LifecycleServices/LifecycleServices"],function(e,t,o,n,i,r,a,s,l){"use strict";var d=t.extend({name:"FolderTrashDocument",_logger:null,_isActive:!1,_commandProxy:null,init:function(t){var o=t||{};UWA.is(o.shouldAcceptDrag)||(o.shouldAcceptDrag=this._shouldAcceptDrag.bind(this)),this._parent(o),this._logger=e.getLogger(d),this._isActive=!0,this._buildCommandProxy()},_buildCommandProxy:function(){this._commandProxy=o.create({events:{onRefresh:this._onRefreshTrash.bind(this)}})},_shouldAcceptDrag:function(){return!1},activateEventProxy:function(e){this._isActive=e},_onRefreshTrash:function(e){var t=this;if(this._isActive){if(UWA.is(e.authored.physicaldeleteafterlogical,"array")){var o=[];e.authored.physicaldeleteafterlogical.forEach(function(e){o=o.concat(t._getNodesById(e))}),this._deleteNodes(o)}if(UWA.is(e.authored.restored,"array")){o=[];e.authored.restored.forEach(function(e){o=o.concat(t._getNodesById(e))}),this._deleteNodes(o)}UWA.is(e.authored.deleted,"array")&&this.refreshContent()}},_getNodesById:function(e){var t=[];return this.getChildren().forEach(function(o){var n=o.getID()===e?o:null;n&&(t=t.concat(n))}),t},_deleteNodes:function(e){var t=this;this.prepareUpdate(),e.forEach(function(e){e.isRoot()?t.removeRoot(e):e.remove()}),this.pushUpdate()},refreshContent:function(){var e=s.getTrashCont();e&&e.setMask();var t=this;try{l.getDeletedItems(function(o){var n;o&&(n=o.content),t.empty(),t.prepareUpdate(),Array.isArray(n)&&n.forEach(function(e){var o=a.convertToExaleadDataFormat(e);o.children=null,o.useAsyncPreExpand=!1;var n=new i(o);n.id=e.id,n.getID=function(){return this.id},t.addRoot(n)}),e&&e.endloadingNodeEvent(),t.pushUpdate()},function(o){r.displayNotification({message:o,className:"error"}),t._logger.warn("LifecycleServices.getDeletedItems returns errorMsg : "+o),t.empty(),e&&e.unsetMask()})}catch(o){t._logger.error("Error when calling LifecycleServices.getDeletedItems",o),t.empty(),e&&e.unsetMask()}}});return d}),define("DS/FolderEditor/FolderTreeMechanism",["UWA/Controls/Abstract","UWA/Class/Options","UWA/Class/Events","DS/FolderEditor/utils/FolderEditorUtil","DS/FolderEditor/utils/FolderEditorcontrol","DS/FolderEditor/views/FolderMode","DS/IPClassifyUtil/IPClassifyAlert"],function(e,t,o,n,i,r,a){return e.extend(o,{_folderTree:null,_isAsynchronousExpansion:!1,_currentRootNodes:[],limit:5,_expandedFolder:"",_processes:[],_partiallyExpandedFolder:[],init:function(e){this._parent(e);var t=this.treeNodeModel=e.treeNodeModel,o=this._folderTree=e.folderTree;"read"===r.getCurrentModeType()?this.executeExpansionForScroll_Index(e):this._initializeMechanism(o,t)},executeExpansionForScroll_Index:function(e){this._isAsynchronousExpansion=!0,this._neutralizePath(),0==this._folderTree._indexModeforReadData.getNextStart()?this._initializeMechanism(this.folderTree,this.treeNodeModel):(this._processes=["loadRoots","ExpandRootsandChildrenAsynchronously"],this.processExpansion(this.treeNodeModel,!0,e.explicitMethodToBeExecuted))},_initializeMechanism:function(e,t){var o=this;this._isAsynchronousExpansion=!0,this.preProcessInitialization(this).then(function(){o.processExpansion(t,!1)})},preProcessInitialization:function(e){var t=this;return this._processes=["loadSelectedBookmark","loadRoots","ExpandRootsandChildrenAsynchronously"],new Promise(function(e,o){t._folderTree._folderStructurePreference._getStoredFolderTreeStructure();var n=t._folderTree._folderStructurePreference.getSelection();t.selectedpath=n.split(",").length>2?[n.replace("root,FolderSection_AllFolders,","").split(",")]:[],e()})},getRoots:function(e){return 0==Object.entries(e).length?null:e.root?e.root.FolderSection_AllFolders||e.root._X_FolderSection_AllFolders||e.root._P_FolderSection_AllFolders:e._P_root?e._P_root.FolderSection_AllFolders||e._P_root._X_FolderSection_AllFolders||e._P_root._P_FolderSection_AllFolders:void 0},constructPaths:function(e){var t=this,o=this._folderTree._folderStructurePreference._getStoredFolderTreeStructure();this.pathsTobeLoadedAsynchronouly=[],this.roots=[];var n=this.getRoots(o);if(n){for(const t of Object.entries(n)){var i=(i=t[0]).replace("_P_","")||i.replace("_X_","");e.indexOf(i)>-1&&this.roots.push(i)}this.roots.forEach(function(e){var o=[],n="root,FolderSection_AllFolders,"+e;t._folderTree._folderStructurePreference.getExpandedChildren(n,function(e){o=e}),o.unshift(e);var i=[];t._folderTree._folderStructurePreference.getExpandedChildren(n,function(e){i=e},!0,!0),t.pathsTobeLoadedAsynchronouly.push([o,i,e])})}},processExpansion:function(e,t,o){var n=this;this._neutralizePath();var i=this.currentProcess=this._processes.length>1?this._processes.shift():this._processes[0];if(this._showLoadingSymbolForNode(e,"expanding"),"loadSelectedBookmark"==i)if(this.selectedpath.length>0){var r=[this.selectedpath[0][0]];n._partiallyExpandedFolder=this.selectedpath,e.expand({updateView:!0,expandEvent:this._expansionEvent.bind(this),currentRootNodes:r,expandedFolder:[],partiallyExpandedFolder:n._partiallyExpandedFolder,isAsynchronousExpansion:!0,doNotRemoveNodes:t})}else this.processExpansion(e,t);else"loadRoots"==i?e.expand({updateView:!0,expandEvent:this._expansionEvent.bind(this),currentRootNodes:[],expandedFolder:[],partiallyExpandedFolder:[],isAsynchronousExpansion:!0,recordScrollForIndex:!0,doNotRemoveNodes:t,explicitMethodToBeExecuted:o}):"ExpandRootsandChildrenAsynchronously"==i&&(this.createBatch(),this._currentRootNodes.length>0&&(this._currentRootNodes.forEach(function(e){(e=n._folderTree._getNodesById(e))&&n._showLoadingSymbolForNode(e[0],"expanding")}),e.expand({updateView:!0,expandEvent:this._expansionEvent.bind(this),currentRootNodes:n._currentRootNodes,expandedFolder:n._expandedFolder,partiallyExpandedFolder:n._partiallyExpandedFolder,isAsynchronousExpansion:!0,doNotRemoveNodes:t})))},_neutralizePath:function(){this._currentRootNodes=[],this._expandedFolder=[],this._partiallyExpandedFolder=[]},getLimit:function(){return this.limit},createBatch:function(){for(var e=this,t=0,o=this.getLimit();t<o;){if(0==this.pathsTobeLoadedAsynchronouly.length){this._isAsynchronousExpansion=!1;break}var n=this.pathsTobeLoadedAsynchronouly.shift(),i=n[2];this._folderTree._getNodesById(i)&&this._folderTree._getNodesById(i).length>0&&(t+=1,this._currentRootNodes.push(i),n[0].length>0&&(0==this._expandedFolder.length?this._expandedFolder=n[0].toString():this._expandedFolder=e._expandedFolder+","+n[0].toString()),n[1].length>0&&n[1].forEach(t=>{e._partiallyExpandedFolder.push(t)}))}},_showLoadingSymbolForNode:function(e,t){var o=this._folderTree._folders_TreeView.layout,n=o.getCellsFromNodeModel(e);if(n){var i=o.collectionView._getViewAt(n[0]);i&&i.elements.expanderContainer.setAttribute("data-wux-state",t)}},_expansionEvent:function(e,t){var o=this,n=this.treeNodeModel;n.expand({onlyUI:!0}),e&&e.forEach(function(e){(e=o._folderTree._getNodesById(e))&&o._showLoadingSymbolForNode(e[0],"expanded")}),"loadRoots"==this.currentProcess&&this.constructPaths(t),o._isAsynchronousExpansion&&this.processExpansion(n,!0)}})}),define("DS/FolderEditor/FolderTrashCont",["UWA/Core","UWA/Utils","UWA/Controls/Abstract","UWA/Class/Options","UWA/Class/Events","DS/Logger/Logger","DS/PADUtils/PADProbes","DS/PADUtils/PADPredicatesNls","DS/PADUtils/PADSettingsMgt","DS/Tree/TreeListView","i18n!DS/FolderEditor/assets/nls/FolderEditor","DS/WebappsUtils/WebappsUtils","DS/Utilities/Utils","DS/FolderEditor/service/FolderTypeService","DS/Utilities/Dom","DS/PADUtils/views/PADStatusInfos","DS/FolderEditor/ActionBar/FolderCommandManager","DS/FolderEditor/FolderTrashDocument","DS/FolderEditor/utils/FolderEditorcontrol","DS/FolderEditor/utils/FolderEditorUtil","DS/UIKIT/Mask","DS/PADUtils/PADUtilsServices"],function(e,t,o,n,i,r,a,s,l,d,c,u,p,g,f,h,m,v,_,C,S,F){"use strict";var y=o.extend(n,i,{name:"FolderTrash_Cont",_logger:null,init:function(e){this._parent(e),this._logger=r.getLogger(y);this._buildSkeleton(),this.dispatchEvent.call(this,"onReady")},render:function(){return this},onViewChange:function(e){this.elements.container.removeClassName(e.previous.type),this.elements.container.addClassName(e.type)},destroy:function(){this._logger.log("destroy"),this._parent()},_buildSkeleton:function(){var t=this;if(!e.is(this.elements.container)){this.elements.container=UWA.createElement("div",{class:this.getClassNames()+"_container"}),this.getOption("css_view_class")&&this.elements.container.addClassName(this.getOption("css_view_class")),this.elements.listOfDeleteItems_container=UWA.createElement("div",{class:this.getClassNames()+"_listOfDeleteItems_container"}).inject(this.elements.container);var o={apiVersion:2,height:"auto",defaultCellHeight:80,iconsSize:20,headersDimensions:{height:38},resize:{rows:!1,columns:!0},selection:{canMultiSelect:!1},columns:[{text:FolderEditor["ds6w:label"]?FolderEditor["ds6w:label"]:"ds6w:label",width:"auto",dataIndex:"tree",isDraggable:!1,isEditable:!1,xnav_options:{name:"ds6w:label"}},{text:FolderEditor["ds6wg:revision"]?FolderEditor["ds6wg:revision"]:"ds6wg:revision",dataIndex:"ds6wg:revision",isDraggable:!1,isEditable:!1,xnav_options:{name:"ds6wg:revision"}},{text:FolderEditor["ds6w:responsible"]?FolderEditor["ds6w:responsible"]:"ds6w:responsible",dataIndex:"ds6w:responsible",isDraggable:!1,isEditable:!1,xnav_options:{name:"ds6w:responsible"}},{text:FolderEditor["ds6w:type"]?FolderEditor["ds6w:type"]:"ds6w:type",dataIndex:"ds6w:type",isDraggable:!1,isEditable:!1,xnav_options:{name:"ds6w:type"}},{text:c.HeaderDeletionDate,dataIndex:"logicalDeleteStamp",isDraggable:!1,isEditable:!1},{text:c.HeaderDeleteBy,dataIndex:"logicalDeleteBy",isDraggable:!1,isEditable:!1},{text:FolderEditor["ds6w:organizationResponsible"]?FolderEditor["ds6w:organizationResponsible"]:"ds6w:organizationResponsible",dataIndex:"ds6w:organizationResponsible",isDraggable:!1,isEditable:!1,xnav_options:{name:"ds6w:organizationResponsible"}},{text:FolderEditor["ds6w:project"]?FolderEditor["ds6w:project"]:"ds6w:project",dataIndex:"ds6w:project",width:"auto",isDraggable:!1,isEditable:!1,xnav_options:{name:"ds6w:project"}},{text:"",dataIndex:"thumbnail",isHidden:!1,width:80,isDraggable:!1,isEditable:!1}],roots:[],onContextualMenuReady:function(e){function t(e){try{m.getCommand(e).begin()}catch(t){_logger.error("Error trying to execute command",e,t,t.stack)}}var o=[];if(-1===e.virtualRowID)return[{label:c.CMDSizeColumnToFit,icon:"url("+u.getWebappsAssetUrl("FolderEditor","icons/22/I_FitToColumn.png")+")",callback:function(){e.manager.sizeColumnToFit(e.dataIndex)}}];if(e.nodeModel){var n=e.nodeModel,i={label:c.CMDRestore,icon:"url("+u.getWebappsAssetUrl("LifecycleCmd","icons/22/I_Restore.png")+")",callback:function(){t("RestoreDeletedItemsHdr")}},r={label:c.CMDDeleteDefinitively,icon:"url("+u.getWebappsAssetUrl("LifecycleCmd","icons/22/I_Delete.png")+")",callback:function(){t("DeleteDeletedItemsHdr")}};o.push(i,r),!1===n.isSelected()&&n.select(!0)}return o},shouldDisplayTooltip:function(e){var t="";if(e.isHeader)switch(e.dataIndex){case"thumbnail":t=c.HeaderThumbnail;break;default:"string"==typeof e.cellModel.options.value&&(t=e.cellModel.options.value)}else switch(e.dataIndex){case"tree":t=e.nodeModel.options.label;break;case"thumbnail":case"logicalDeleteStamp":t="";break;default:"string"==typeof e.cellModel.options.value&&(t=e.cellModel.options.value)}return{longHelp:t}},onDragOverCell:function(e,t){return e&&e.dataTransfer&&(e.dataTransfer.dropEffect="none"),t&&(t.dropPosition="middle"),!0},onDragOverBlank:function(e,t){e&&e.dataTransfer&&(e.dataTransfer.dropEffect="none")},onDragOverColumnHeader:function(e,t){e&&e.dataTransfer&&(e.dataTransfer.dropEffect="none")}};t=this;s.updateColumnsWithNLS(o.columns,function(e){"success"===e.state&&t._trashCont_TreeListView.loadColumns(e.columns)}),(o=t._enrichViews(o)).treeDocument=new v;var n=new d(o).inject(t.elements.listOfDeleteItems_container);t._trashCont_TreeListView=n,t._registerReusableCellContent(),t._trashCont_TreeListView.getManager().onCellClick(t._onCellClick.bind(t)),t.elements.padstatus=new h({renderTo:t.elements.container,events:{onShow:function(){var e=t._getFolderTrashDocument();t.elements.padstatus.setStatus(h.buildStatus({tree_content:{nbObjectsInTree:e.getAllDescendants().length,nbObjectsSelected:e.getSelectedNodes().length}}))}}})}},endloadingNodeEvent:function(){var e=this;this._trashCont_TreeListView.getManager().onPostUpdateViewOnce(function(){var t=this.getOrderedColumnState();t&&this.sortColumnContent(t.columnID,{sortOrder:t.sortOrder}),e.unsetMask()})},setMask:function(){S.mask(this.elements.container)},unsetMask:function(){S.unmask(this.elements.container)},_getFolderTrashDocument:function(){return this._trashCont_TreeListView&&this._trashCont_TreeListView.getManager()?this._trashCont_TreeListView.getManager().getDocument():null},hideFolderTrash:function(){_.getTrashCont().hide();var e=this._getFolderTrashDocument();e.empty(),e.activateEventProxy(!1)},showFolderTrash:function(){_.getTrashCont().show();var e=this._getFolderTrashDocument();e.refreshContent(),e.activateEventProxy(!0)},getSelectedNodes:function(){var e=[],t=this._getFolderTrashDocument();return t&&(e=t.getSelectedNodes()),e},_onCellClick:function(e){if(!(e.cellModel&&e.cellModel.options&&e.cellModel.options.isHeader)){this.dispatchEvent("onNodeCellClick",e);var t=this._padCustoColumn.getOnCellClickCB(e.dataIndex);UWA.is(t,"function")&&t.call(this,e)}},_registerReusableCellContent:function(){this._trashCont_TreeListView.getManager().registerReusableCellContent({id:"padresuable_thumbnail",buildContent:function(){return f.createElement("div",{class:"padthumbnail_cell",styles:{height:"80px","background-repeat":"no-repeat","background-size":"contain","background-position":"center center"}})}})},_enrichViews:function(e){var t=this;return e.columns&&(e=C.sortingNodes(e)).columns.forEach(function(e){var o=e.dataIndex,n=t._getColumnViewCusto(o);UWA.is(n,"function")&&(e.onCellRequest=n)}),e},_getColumnViewCusto:function(e){return this._logger.log("getColumnViewCusto "+e),this._column_views[e]},_column_views:{thumbnail:function(e){if(!1!==e.manager.getColumnOptions("thumbnail").isHidden)return"";if(!e.isHeader&&e.nodeModel.options.thumbnail){var t=e.cellView.reuseCellContent("padresuable_thumbnail");t&&(t.style.backgroundImage="url("+e.nodeModel.options.thumbnail+")")}},logicalDeleteStamp:function(e){if(!e.isHeader){var t=e.cellModel.options.value,o=Date.parse(t);isNaN(o)||(t=new Date(o).toLocaleString(l.getSetting("lang"))),e.cellView.getContent().setHTML(t)}}}});return y}),define("DS/FolderEditor/service/FolderLogicalDeleteServices",["DS/FolderEditor/FolderTrashCont","DS/FolderEditor/utils/FolderEditorcontrol","DS/LifecycleServices/LifecycleServicesSettings"],function(e,t,o){"use strict";return{IsLogicalDeleteActivated:function(e){try{o.isLogicalDeleteActive(function(t){if(e&&e.onComplete){var o=!0===t;e.onComplete(o)}})}catch(e){console.error("Error when calling LifecycleServicesSettings.isLogicalDeleteActive",e,e.stack)}},DisplayFolderTrashCont:function(){var o=t.getContent(),n=t.getTrashCont();o&&o.hide(),n?n.showFolderTrash():n=new e({css_view_class:"windowed",events:{onReady:function(){if(t.setTrashCont(this),o&&o.options){var e=o.options.renderTo;e&&e.addContent(this.render())}this.showFolderTrash()}}})},HideFolderTrashCont:function(){var e=t.getContent(),o=t.getTrashCont();o&&o.hideFolderTrash(),e&&e.show()}}}),define("DS/FolderEditor/FolderTreeCont",["UWA/Core","UWA/Utils","UWA/Controls/Abstract","UWA/Class/Options","UWA/Class/Events","UWA/Promise","DS/Logger/Logger","DS/Tree/Tree","DS/Tree/TreeDocument","DS/Tree/TreeNodeModel","DS/Tree/TreeNodeView","DS/WebappsUtils/WebappsUtils","DS/FolderEditor/service/FolderEditorWebService","DS/FolderEditor/views/FolderGlobalActiveBookmark","DS/FolderEditor/Folder_CSO","DS/PADUtils/PADCommandProxy","DS/IPClassifyUtil/IPClassifyAlert","DS/FolderEditor/utils/FolderEditorUtil","DS/FolderEditor/utils/FolderEditorEvents","i18n!DS/FolderEditor/assets/nls/FolderEditor","DS/FolderEditor/service/FolderDnDServices","DS/FolderEditor/service/FolderTypeService","DS/FolderEditor/commands/FolderCommands","DS/PlatformAPI/PlatformAPI","DS/FolderEditor/utils/UserPreference","DS/FolderEditor/Folder_Clipboard","DS/PADUtils/PADSettingsMgt","DS/PADUtils/PADUtilsServices","DS/PADServices/utils/GlobalModelEvents","DS/FolderEditor/PersonalFolderManager","DS/FolderEditor/utils/FolderEditorcontrol","DS/FolderEditor/utils/FolderCommunication","DS/FolderEditor/utils/FolderEditorKeyboardListener","DS/FolderEditor/views/FolderOrderCmd","DS/FolderEditor/service/FolderLogicalDeleteServices","DS/LifecycleServices/LifecycleServicesSettings","DS/PADUtils/PADProbes","DS/FolderEditor/tagger/TaggerTreeProxy","DS/DataGridView/DataGridView","DS/Core/PointerEvents","DS/PADUtils/Configuration","DS/DataGridView/DataGridViewLayout","DS/WidgetServices/WidgetServices","DS/FolderEditor/utils/FolderLoaderGlobal","DS/Menu/Menu","DS/IPClassifyFindInContext/FindInTree","i18n!DS/FolderEditor/assets/nls/FolderFindInTree","DS/FolderEditor/utils/FolderExpandUtil_Read","DS/FolderEditor/utils/FolderNavigateUtil_Read","DS/FolderEditor/views/FolderMode","text!DS/FolderEditor/assets/FolderEditorConf.json","DS/FolderEditor/dataProvider/FolderFindInDataProvider","DS/IPClassifyUtil/IPClassifyCommunication","DS/FolderEditor/FolderTreeMechanism","DS/Tweakers/GeneratedToolbar"],function(e,t,o,n,i,r,a,s,l,d,c,u,p,g,f,h,m,v,_,C,S,F,y,D,b,E,w,A,T,x,P,I,N,U,O,M,R,k,L,W,V,B,j,q,H,z,G,X,J,K,Y,Q,Z,$,ee){"use strict";var te=new N,oe=u.getWebappsAssetUrl("FolderEditor","icons/I_Bookmark_v2.png"),ne=u.getWebappsAssetUrl("FolderEditor","icons/I_BookmarkInherit_v2.png"),ie=u.getWebappsAssetUrl("FolderEditor","icons/folder_shared.png"),re=u.getWebappsAssetUrl("FolderEditor","icons/folder_perso.png");function ae(e){return e._modelEvents}var se=o.extend(n,i,{name:"FolderTree_Cont",time_to_expand_node:1500,_folders_TreeDocument:null,_folders_TreeView:null,_logger:null,_folderContentView:null,_commandProxy:null,_rootNodeFavorite:null,_rootNodeFolders:null,_rootNodeTrash:null,_folders_SortElmt:null,_probeLoadElmt:null,_currentDragEnterFolder:null,_timerDragEnter:null,propIDCard:"not initialized!",defaultOptions:{limitExpand:2e3},init:function(e){var t=this;this._probeLoadElmt=R.createProbe("loadTreeCont"),this._parent(e),this._folderStructurePreference.options=this.options,this.elements.container=UWA.createElement("div",{class:this.getClassNames()+"_container"});var o=widget.getValue("useIndexAccleration")?K.getCurrentModeType():"authoring";K.setCurrentModeType(o),this.refreshMap=P.getMapforPreferenceRefresh(),this._donNotApplyFilterForRead=!1,A.app_initialization(function(){t._buildUI()});var n=T.getModelEvents();n.subscribe({event:"select_breadcrumb_object"},({id:e,type:t,name:o})=>{this.expandTreeAndSelectFolder({folderToFindAndSelect:{ids:[e],type:t,name:o},onComplete:function(e){console.log(" expandTreeAndSelectFolder:onComplete")},onGiveUp:function(e){console.log(" expandTreeAndSelectFolder:onGiveUp")},onFailure:function(e){m.displayNotification({title:C.replace(C.msg_error_FolderActivate.Title,{name1:o}),subtitle:C.msg_error_FolderActivate.Advice,className:"error"})}})}),n.subscribe({event:"filterUpdatedTree"},e=>{let t="read"===K.getCurrentModeType();this._indexModeforReadData.resetInfoIndex(),this._applyFilter(t||e.hasFilter?e.matchingIds:null),this._updateFilterIconOnToolbox(),t?this.refreshFolderTreeAndContent():k.reloadObjects()})},_buildUI:function(){this._rootServiceHandler=null,this._logger=a.getLogger(se);var e=this;this._commandProxy=h.create({events:{onRefresh:e._onRefresh.bind(e)}}),_.onFolderRename(function(t){var o=t.getID(),n=t.getLabel();e.updateNodeLabel(o,n)}),I.subscribe("FolderEditor.RequestCurrentFolder",function(){v.dipatchSecurityContextAndFolder()}),_.onCurrentFolderChange(function(t){var o=R.createProbe("treeCont_updateUI");if(e._folderStructurePreference.select(this.pathId),this.id&&""!==this.id&&F.inFamilyFolder(this.plmType)){for(var n=f.getCurrentFolderPath(),i=[],r=Array.isArray(n)?n.length:0,a=0;a<r-1;a++)i.push({resourceid:n[a].id,type:n[a].type});var s={};if(r>=1){var l=r-1;n[l].id&&(s[n[l].id]={type:n[l].type,label:n[l].label})}var d=[];t.currentNode&&!F.isSection(t.currentNode.getType())&&(d=[t.currentNode]),A.setObject_on_compass({nodes_2_open:d}),e._commandProxy.select({paths:[[this.id]],attributes:s,folderPath:i,doNotSetOnCompass:!0}),require(["DS/IPClassifyUtil/IPClassifyCommunication"],function(e){if(!0===widget.getValue("noCompass")){var o={id:t.currentNode.getID(),label:t.currentNode.getLabel(),type:t.currentNode.options.type};e.publish("selectedBookmarkInTree",o)}})}else"FolderSection_Trash"!==this.plmType&&"FolderSection_AllFolders"!==this.plmType&&"FolderSection_favorite"!==this.plmType||(e._commandProxy.select({paths:[],attributes:{},folderPath:[],doNotSetOnCompass:!0}),A.setObject_on_compass({nodes_2_open:[]}));e._scrollOnPostUpdateView(t.currentNode),v.dipatchSecurityContextAndFolder(),o.end()}),e._buildSkeleton(),e._folders_SortElmt=new U,e._folders_FindInTree=new z({dataProvider:Q,isBookMarkWidget:!0}),e._commonToolSection=UWA.createElement("div",{class:"folder-common-tool-Section",id:"folder-common-tool-Section"}),j.isTouchDevice()&&e._commonToolSection.setAttributeNode(document.createAttribute("touch-mode"));var t=this._getalphaIcon(),o=this._getdateSortingIcon(),n={entries:[{id:"findInTree",dataElements:{typeRepresentation:"functionIcon",label:G.find_in_Tree_Tooltip,icon:{iconName:"find",fontIconFamily:1},value:function(){e._folders_FindInTree.clickEvent()},position:"far",category:"1"}},{id:"Filter",dataElements:{typeRepresentation:"icon",value:"filter",position:"far",category:"1",priority:2,label:"Filter",visibleFlag:!1}},{id:"alphaSortingContainer",dataElements:{typeRepresentation:"functionIcon",label:C.alpha_sorting,icon:t,value:function(){e._folders_SortElmt.toggleButton(),t=e._getalphaIcon(),e.leftToolbar.updateNodeModel("alphaSortingContainer",{icon:t})},position:"far",category:"1"}},{id:"dateSortingContainer",dataElements:{typeRepresentation:"functionIcon",label:C.date_sorting,icon:o,value:function(){e._folders_SortElmt.toggleButtonDate(),o=e._getdateSortingIcon(),e.leftToolbar.updateNodeModel("dateSortingContainer",{icon:o})},position:"far",category:"1"}},{id:"wrong",dataElements:{typeRepresentation:"functionIcon",label:C.button_close,icon:{iconName:"wrong",fontIconFamily:1},value:function(){T.publish({event:"triptych-hide-panel",data:"left"})},position:"far",category:"1"}}]},i=ee.prototype.createTreeDocument(n);e.leftToolbar=new ee({overflowManagement:"dropdown",direction:"horizontal",items:i}),e.leftToolbar.inject(this._folders_FindInTree.elements.container),this._folders_FindInTree.elements.container.inject(e._commonToolSection),e._folders_FindInTree.getUI().inject(e._commonToolSection),this._folders_FindInTree.dataProvider.onCurrentSelectionChange(function(){e._folders_FindInTree.isCurrentFolderValidForFindIn()?e.leftToolbar.updateNodeModel("findInTree",{visibleFlag:!0}):e.leftToolbar.updateNodeModel("findInTree",{visibleFlag:!1})});var r=this._folders_TreeView?this._folders_TreeView.getTreeDocument():void 0;this._folders_TreeDocument=r,r&&(r.options.shouldBeEditable=v.shouldBeEditable,r.onNodeModelUpdate(v.onNodeModelUpdate),r.options.shouldAcceptDrag=this._shouldAcceptDrag.bind(this),r.options.shouldAcceptDrop=this._shouldAcceptDrop.bind(this),r._getTrueRoot().onPreExpand(this._onPreExpandTreeNode.bind(this)),r.getXSO().onChange(function(t){var o=e._folders_TreeDocument.getXSO().get();if(o&&o.length>0){var n=o[o.length-1];n.getID=n.getID?n.getID:function(){return this.id},n.getType||(n.getType=function(){return this.plmType});var i=f.getCurrentFolder();if(i!==n){f.addInFolderCSO(n,"TREE")}}})),P.checkSecurityCTXandTenantInitialization(function(){M.app_initialization(function(){M.getEnforceFolderLinkSettingAsync(function(t,o){if(q.addComponentsToLoad("global",{tree:""}),q.removeComponentToLoad("global","widget"),!e._rootNodeFavorite){var n=u.getWebappsAssetUrl("FolderEditor","icons/starBlue_v2.png"),i={useAsyncPreExpand:!0};i.label=C.name_Section_FavoriteFolders,i.icons=[n],i.children=[],i.id="",i.plmType="FolderSection_favorite",e._rootNodeFavorite=e._createTreeNodeModel(i,e._folders_TreeDocument);var r=u.getWebappsAssetUrl("FolderEditor","icons/foldersectionall.png"),a={useAsyncPreExpand:!0};a.label=C.name_Section_AllFolders,a.icons=[r],a.children=[],a.id="",a.plmType="FolderSection_AllFolders",e._rootNodeFolders=e._createTreeNodeModel(a,e._folders_TreeDocument),!0===widget.getValue("noCompass")||O.IsLogicalDeleteActivated({onComplete:function(t){if(t){var o=u.getWebappsAssetUrl("FolderEditor","icons/trash.png"),n={useAsyncPreExpand:!0};n.label=C.name_Section_Trash,n.icons=[o],n.children=null,n.id="",n.plmType="FolderSection_Trash",e._rootNodeTrash=e._createTreeNodeModel(n,e._folders_TreeDocument)}}}),e.dispatchEvent.call(e,"onReady"),e._probeLoadElmt.end(),e._folderStructurePreference.isExpanded(e._rootNodeFolders.pathId,e=>{e||q.removeComponentToLoad("global","tree")})}})})}),this._updateFilterIconOnToolbox()},_applyFilter:function(e){this._folders_TreeDocument.withTransactionUpdate(()=>{this._folders_TreeDocument.getRoots().forEach(t=>{"FolderSection_AllFolders"===t.getID()&&t.getChildren().forEach(t=>{!e||e.indexOf(t.getID())>=0?t.show():t.hide()})})})},_getalphaIcon:function(){return{iconName:"desc"==this._folders_SortElmt.sortOrder?"alpha-sorting-z-a":"alpha-sorting-a-z",fontIconFamily:1}},_getdateSortingIcon:function(){return{iconName:"desc"==this._folders_SortElmt.sortOrder?"num-sorting-2-1":"num-sorting-1-2",fontIconFamily:1}},_getIcon:function(e,t){var o="subFolders"!==t&&P.isCustomizedEnv(),n=e.icon;return e.type&&F.isPersonalFolder(e.type)?o||!n?re:n:"favorites"===t?e.inherit?ne:oe:o||!n?ie:n},_refreshNodes:function(e){for(var t=0;t<e.length;t++)this.updateNodeLabel(e[t])},_getAllRoots:function(){var e=this._folders_TreeDocument.getRoots(),t=[];return e.forEach(function(e){"FolderSection_AllFolders"===e.plmType&&(t=e.getChildren())}),t},_onRefresh:function(e){if(e&&e.authored&&(e.authored.modified&&UWA.is(e.authored.modified,"array")&&this._refreshNodes(e.authored.modified),e.authored.deleted&&UWA.is(e.authored.deleted,"array")&&e.authored.deleted.length>0)){var t=this._getAllRoots(),o=!1;t.every(function(t){return!(o=!!t&&e.authored.deleted.indexOf(t.id)>=0)}),o?this.refreshFolderTreeAndContent(e.authored.deleted):this._refreshNodes(e.authored.deleted)}},render:function(){return this},destroy:function(){this._logger.log("destroy"),this._parent()},_onContextualEvent:function(e){var t=this;return e&&e.cellInfos&&e.cellInfos.nodeModel.select(),new r(function(o){t.__onContextualMenuReady(e).then(function(e){o(e)})})},_buildSkeleton:function(){var e=this;this.elements.container=UWA.createElement("div",{class:this.getClassNames()+"_container"}),this.getOption("css_view_class")&&this.elements.container.addClassName(this.getOption("css_view_class")),this.elements.folderTreeView_container=UWA.createElement("div",{class:this.getClassNames()+"_treeview_container"}).inject(this.elements.container);var t=UWA.clone(V.getConfig("dgvOptions")),o=t&&t.dgv?t.dgv:{};o.selectionBehavior.toggle=j.isTouchDevice(),o.selectionBehavior.unselectAllOnEmptyArea=!1,o.infiniteScrolling=!0,o.onContextualEvent=e._onContextualEvent.bind(e),o.rowSelection="single",o.showRowBorderFlag=!1,o.columns=[{dataIndex:"tree",sortableFlag:!1,typeRepresentation:"string",getCellEditableState:function(e){return 1!=widget.launchWithReadMode&&(e&&e.nodeModel&&F.inFamilyFolder(e.nodeModel.plmType))},editionPolicy:"DelayedEditionOnClick",setCellValue:function(e,t){if(e.nodeModel){var o=e.nodeModel;require("DS/FolderEditor/commands/FolderCommands")._cellToRename={cellInfos:e,context:"TREE"},o.getTreeDocument().withTransactionUpdate(function(){var e={};e.label=t,e.display=t,e.oldLabel=o.options.label,o.updateOptions(e)})}},compareFunction:function(t,o,n,i,r){return e._folders_SortElmt.mySortFunction(n,i)},onCellRequest:function(e){e.isHeader||(e.nodeModel&&e.nodeModel.options.isBeingCut?e.cellView.getContent().addClassName("folder-state-is-being-cut"):e.cellView.getContent().removeClassName("folder-state-is-being-cut")),this.defaultOnCellRequest(e)}}];var n=UWA.extend({identifier:"DataGridView-"+e.name+"-"+widget.id},o),i=UWA.clone(t.dgvLayout);n.layout=new B(i),n.layout.useLastColumnWidthAutoFlag=!0,n.layout.columnsHeader=!1;var r=new l;n.treeDocument=r,n.rowReorderEnabledFlag=!0,n.useAsyncPreExpand=!0;var a=new L(n).inject(this.elements.folderTreeView_container);this._folders_TreeView=a;["esc","del","ctrl+f","alt+return","f2","ctrl+x","ctrl+v"].forEach(function(e){a._keymapManager.registerKeymap(e,void 0)}),a.setUseClipboardFlag(!1),a.onCopy=te.launchKeyAction.bind(te,"ctrl+c"),a.onCut=te.launchKeyAction.bind(te,"ctrl+x"),a.onPaste=te.launchKeyAction.bind(te,"ctrl+v"),a.showAlternateBackgroundFlag=!1,a.treeNodeCellOptions.depthIncrement=14,a.treeNodeCellOptions.buildLinks=!0,a.treeNodeCellOptions.expanderStyle="triangle",a.selectNextCellOnEnterFlag=!1,a.onDragStartCell=this._onDragStartCell.bind(this),a.onDragEndCell=this._onDragEndCell.bind(this),a.onDragLeaveCell=this._onDragLeaveCell.bind(this),a.onDragOverCell=this._onDragOverCell.bind(this),a.onDropCell=this._onDropCell.bind(this),a.onDragEnterBlank=this._onDragEnterBlank.bind(this),a.onDragOverBlank=this._onDragOverBlank.bind(this),a.onDropBlank=this._onDropBlank.bind(this),a.onDragLeaveBlank=this._onDragLeaveBlank.bind(this),a.addEventListener(W.POINTERDOWN,function(t,o){2===t.multipleHitCount&&o&&-1!==o.rowID&&e._switchExpandStatus(o)}),a.onInfiniteScroll(function(t){e._processForInfiniteScroll(t,a)})},_processForInfiniteScroll:function(e,t){var o=this;if(e.reachBottom){var n=!1;if("read"==K.getCurrentModeType()){var i=this._indexModeforReadData.getInfoIndex(),r=this._indexModeforReadData.getNextStart(),a=i?i.nhits:null;isNaN(a)||(n=r<a)}n&&!this._indexModeforReadData.isInfiniteScrollingInProcess()&&(this._indexModeforReadData.setInfiniteScrollingStatus(!0),this._populateRootBookmark(function(){o._indexModeforReadData.setInfiniteScrollingStatus(!1)},!0))}t.infiniteScrollProcessDone()},_populateRootBookmark:function(e,t){t="boolean"==typeof t&&t,q.addComponentsToLoad("global",{tree:""}),this.folderTreeMechanism=new $({treeNodeModel:this._folders_TreeDocument.getRoots()[1],folderTree:this,explicitMethodToBeExecuted:e})},escape:function(){this._folders_TreeView.commands.escape.bind(this._folders_TreeView)()},_switchExpandStatus:function(e){!0===e.nodeModel._isExpanded?e.nodeModel.collapse():e.nodeModel.expand()},_populateFavoriteSection:function(e){var t=this;t._rootNodeFavorite?t._rootNodeFavorite._isPopulated?e&&e.onComplete&&e.onComplete():t.getFavorites({onComplete:function(o){var n={useAsyncPreExpand:!1};o.forEach(function(e){n.label=e.name,n.isPersonal=e.isPersonal;var o=t._getIcon(e,"favorites");F.isPersonalFolder(e.type)&&(n.isPersonal=!0),n.icons=[o],n.children=null,n.id=e.id,n.mxid=e.mxid,e.type?(n.plmType=e.type,n.type="Workspace"):(n.plmType="Folder",n.type="Workspace Vault"),n.isFavorite=!0,t._createTreeNodeModel(n,t._rootNodeFavorite).setState({state:"noChildren"})}),t._rootNodeFavorite._isPopulated=!0,e&&e.onComplete&&e.onComplete()},onFailure:function(e){t._logger.warn("FolderTreeCont : unable to initialize list of Favorite Folders",e)}}):e&&e.onFailure&&e.onFailure(new Error("FolderSection_favorite node does not yet exist"))},_refreshFavoriteSection:function(e){this._rootNodeFavorite?(this._rootNodeFavorite.removeChildren(),this._rootNodeFavorite._isPopulated=!1,x.resetToPreInitializedState(),this._populateFavoriteSection(e)):(this._logger.log("FolderTreeCont : FolderSection_favorite node does not yet exist"),e&&e.onFailure&&e.onFailure(new Error("FolderSection_favorite node does not yet exist")))},_cancelRootServiceHandler:function(){this._rootServiceHandler&&this._rootServiceHandler.cancel(),this._rootServiceHandler=null},_preExpandDone:function(e){let t="partiallyExpanded"===e.getState();e.preExpandDone(),t?e.setState({state:"partiallyExpanded"}):"expanded"===e.getState()&&e.setState({state:"expanded"})},_onPreExpandTreeNode:function(e){setTimeout(this.__onPreExpandTreeNode.bind(this,e))},__onPreExpandTreeNode:function(e,t,o){var n=e.data.nodeModel;if(e.data.onlyUI)this._preExpandDone(n);else{var i=n.plmType,r=e.data.isAsynchronousExpansion,a=e.data.expandLevel;if(1==window.isReplayODT,"FolderSection_AllFolders"==n.plmType&&!0!==e.data.doNotRemoveNodes&&(this._folders_TreeDocument.getRoots()[1].removeChildren(),this._indexModeforReadData.resetInfoIndex(),k.clearTags()),"FolderSection_AllFolders"==i&&!0!==r&&null==a)return n.setState({state:"expanding"}),void(this.folderTreeMechanism=new $({treeNodeModel:n,folderTree:this}));var s=this;P.isCustomizedEnv();var l,d,c=!!this._folderStructurePreference._getStoredFolderTreeStructure()._P_root;if(e.data.isAsynchronousExpansion&&0==c?l=e.data.expandedFolder:s._folderStructurePreference.getExpandedChildren(e.parent.pathId,function(e){l=e}),e.data.isAsynchronousExpansion&&0==c?d=e.data.partiallyExpandedFolder:s._folderStructurePreference.getExpandedChildren(e.parent.pathId,function(e){d=e},!0,e.data&&!0===e.data.updateView),"FolderSection_favorite"!==n.plmType){var u=n.getNodeDepth(),g={pid:n.id,level:e.data.expandLevel,expandList:l,partialExpandList:d,isRoot:"FolderSection_AllFolders"===n.plmType,explicitRoots:e.data.isAsynchronousExpansion?e.data.currentRootNodes:[],recordScrollForIndex:!!e.data.hasOwnProperty("recordScrollForIndex")&&e.data.recordScrollForIndex,onComplete:function(t){if((t=JSON.parse(t)).error)return m.displayNotification({message:t.error.message,className:"error"}),n.loadHasFailed=!0,s._preExpandDone(n),void n.collapse();!0!==e.data.doNotRemoveNodes&&n.removeChildren();var o=t.folders,i={0:n},r=[],a=[].concat.apply([],d);var c="FolderSection_AllFolders"===n.getID()?"root":n.getID();a.indexOf(c)>=0&&r.push(n);let p=[];for(var g=0;g<o.length;g++){var f=o[g],h={useAsyncPreExpand:!0};h.label=f.label,h.icons=[s._getIcon(f,"subFolders")],h.children=[],h.id=f.id,h.mxid=f.mxid,h.plmType="Folder",h.type="Workspace Vault",h.created=f.created,UWA.is(f.publishOnConnect)&&(h.publishOnConnect=f.publishOnConnect),h.folderClassification=f.folderClassification;var v=f&&f.level?parseInt(f.level):1;if(1===v&&"FolderSection_AllFolders"==n.plmType){p.push(h.id),h.isPersonal=!!F.isPersonalFolder(f.type)||void 0;var _=s._getIcon(f);h.icons=[_],h.plmType="RootFolder",h.type="Workspace",UWA.is(f.publishOnConnect)&&(h.publishOnConnect=f.publishOnConnect)}if(s._getNodesById(h.id).length>0?i[v]=s._getNodesById(h.id)[0]:i[v]=s._createTreeNodeModel(h,i[v-1]),!e.data.expandLevel)if(-1!==l.indexOf(h.id))i[v].expand({onlyUI:!0});else if(-1!==a.indexOf(h.id))for(var C in d)if(-1!==d[C].indexOf(h.id)){d[C].indexOf(h.id)!==d[C].length-1&&(i[v].expand({onlyUI:!0}),r.push(i[v]));break}}if(p.length>0&&"read"!==K.getCurrentModeType()&&(k.addObjectsTags(p,!0),k.applyFilterIfAny()),n.loadHasFailed=!1,s._preExpandDone(n),e.data.expandLevel&&o.length>0){var S={onlyUI:!0,initialLevel:u,expandLevel:e.data.expandLevel,clearLast:e.data.clearLast};"All"===e.data.expandLevel?(S.expandAll=!0,n.expandNLevels(S)):(S.numberOfLevelsToExpand=e.data.expandLevel,n.expandNLevels(S))}r.forEach(function(e){e.setState({state:"partiallyExpanded"})}),s._folders_SortElmt.sortingNodesUnsensitiveCase(),n.options.children=null===n.options.children?[]:n.options.children,e.data.explicitMethodToBeExecuted&&e.data.explicitMethodToBeExecuted(),e.data.expandEvent&&e.data.expandEvent(e.data.explicitRoots,p),q.removeComponentToLoad("global","tree")},onFailure:function(t){e.data.explicitMethodToBeExecuted&&e.data.explicitMethodToBeExecuted(),n.loadHasFailed=!0,s._preExpandDone(n),s._logger.log("WebService folders Err : "+t),q.removeComponentToLoad("global","tree")}};"read"==K.getCurrentModeType()?X.listFolder(g):(p.folderTree(g),s._indexModeforReadData.resetInfoIndex())}else s._refreshFavoriteSection({onComplete:function(){s._preExpandDone(n),q.removeComponentToLoad("global","tree")}})}},_onDragStartCell:function(e,t){E.SetAsExternalDrop(!1);var o=t.nodeModel,n=o.getID(),i=o.plmType,r="";r="Folder"==i?"Workspace Vault":"RootFolder"==i?o.isPersonal?"Personal Workspace":"Workspace":i;var a=null,s=o.getParent();s&&!s.isRoot()&&F.inFamilyFolder(s.plmType)&&(a=s.getID());var l=void 0;if(!o.isFavorite){for(l=[];s&&!s.isRoot();){var d=s.plmType;"Folder"==d?d="Workspace Vault":"RootFolder"==d&&(d=s.isPersonal?"Personal Workspace":"Workspace"),F.inFamilyFolder(d)?(l.push({resourceid:s.getID(),type:d}),s=s.getParent()):s=null}l.reverse()}var c={envId:A.getPlatformId(),serviceId:"3DSpace",contextId:w.getSetting("pad_security_ctx")?w.getSetting("pad_security_ctx"):void 0,objectId:n,objectType:r,folderClassification:o.options?o.options.folderClassification:void 0,displayName:o.getLabel(),folderId:a,isPersonalFolder:o.isPersonal};l&&(c.folderPath=l);var u={protocol:"3DXContent",version:"1.1",source:"ENOFOL3_AP",widget_id:S.getWidgetId(),data:{items:[c]}};try{e.dataTransfer.setData("text/searchitems",JSON.stringify(u))}catch(e){}return e.dataTransfer.setData("Text",JSON.stringify(u)),e.dataTransfer.effectAllowed="copyMove",S.setStartDrag(!0),S.setDragFrom("bookmark"),e.stopPropagation(),!!t.nodeModel.isFavorite},_onDragEndCell:function(e,t){var o=this;if(S.setStartDrag(!1),S.setDragFrom(""),"middle"!==this._dndDropPosition&&t&&t.nodeModel.isFavorite){var n=[];this._folders_TreeDocument.getRoots()[0].getAllDescendants().forEach(function(e){n.push(e.id)}),this.getFavorites({onComplete:function(e){var t=e.slice(),i=[];function r(e){for(var o=0;o<t.length;o++)t[o].id===e&&t.splice(o,1)}for(var a=0;a<n.length;a++)e.forEach(function(e,t){e.id===n[a]&&(i.push(e),r(e.id))});i=i.concat(t),o._setFavorites({favoriteFolders:i,onComplete:function(){console.log("Re-arrange of favorite node is successful")}}),m.displayNotification({message:C.get("msg_success_favoriteReordered"),className:"success"})},onFailure:function(e){console.log(e)}})}},_onDragLeaveCell:function(e,t){return this._timerDragEnter&&(clearTimeout(this._timerDragEnter),this._timerDragEnter=null),this._currentDragEnterFolder=null,!0},_onDragOverCell:function(e,t){if(e.preventDefault(),1!=widget.launchWithReadMode){var o=t.nodeModel;return e&&e.dataTransfer&&("FolderSection_Trash"===o.plmType?e.dataTransfer.dropEffect="none":e.dataTransfer.dropEffect=S.isDragging()&&S.isMoveDnDSetting()&&!S.hasFilesInEvent(e)?"move":"copy"),t&&!t.nodeModel.isFavorite&&(t.dropPosition="middle"),this._dndDropPosition=t.dropPosition,this._currentDragEnterFolder&&this._timerDragEnter&&this._currentDragEnterFolder!==t.nodeModel.getID()&&(clearTimeout(this._timerDragEnter),this._timerDragEnter=null),this._currentDragEnterFolder===t.nodeModel.getID()||t.nodeModel.isExpanded()||"expanding"===t.nodeModel.getState()||(this._timerDragEnter=setTimeout(function(){t.nodeModel.expand()},this.time_to_expand_node)),this._currentDragEnterFolder=t.nodeModel.getID(),!0}},_onDropCell:function(e,t){if(e.preventDefault(),1!=widget.launchWithReadMode){if("middle"!==t.dropPosition)return!0;E.SetAsExternalDrop(!0),this._timerDragEnter&&(clearTimeout(this._timerDragEnter),this._timerDragEnter=null),this._currentDragEnterFolder=null;var o=t.nodeModel;S.performDropOnFolderEditorNode(o,e),S.setDragFrom("")}else m.displayNotification({message:C.msg_warning_DndNotSupported,className:"warning"})},_onDragEnterBlank:function(e,t){e&&e.dataTransfer&&(e.dataTransfer.dropEffect="none")},_onDragLeaveBlank:function(e,t){var o=P.getTreeCont();o._timerDragEnter&&(clearTimeout(o._timerDragEnter),o._timerDragEnter=null),o._currentDragEnterFolder=null},_onDragOverBlank:function(e,t){},_onDropBlank:function(e,t){S.setDragFrom("")},_shouldAcceptDrag:function(e){var t=f.getCurrentFolder();return!(!t||!(F.isFolder(t.getType())||t.isFavorite||F.isRootFolder(t.getType())))},_shouldAcceptDrop:function(e){return!e||"middle"!==e.dropPosition||"RootFolder"!==e.draggedNodes[0].plmType||!e.draggedNodes[0].isFavorite},isFolderAmongFavoriteFolders:function(e){var t=!1;if(e&&e.id){var o=this._rootNodeFavorite.getChildren();if(o)for(var n=0;n<o.length;n++){var i=o[n];if(e.id==i.id){t=!0;break}}}return t},isFolderActiveDefined:function(e){var t=P.getActiveFolder();return t.id===e||t.disabledId===e},addFavorite:function(e){if(e){var t=this,o=Array.isArray(e)?e:[e];this.getFavorites({onComplete:function(e){var n,i,r,a=e;for(n=0;n<o.length;++n){r=!1;var s=o[n];for(i=0;i<a.length&&!r;++i){var l=a[i];s.id===l.id&&(t._logger.log("newFavoriteFolder "+s.id+"  is already in Favorite Folders list"),delete o[n],r=!0)}}for(n=0;n<o.length;++n)o[n]&&a.push(o[n]);t._setFavorites({favoriteFolders:a,onComplete:function(e){e.forEach(function(e){if(!1===t.isFolderAmongFavoriteFolders(e)){var o={useAsyncPreExpand:!1};o.label=e.name,o.isPersonal=e.isPersonal,o.children=null,o.id=e.id,o.mxid=e.mxid,e.inherit&&(o.inherit=1),o.isPersonal=!(!e.type||!F.isPersonalFolder(e.type))||o.isPersonal;var n=t._getIcon(e,"favorites");o.icons=[n],e.type?(o.type="Workspace",o.plmType=e.type):(o.type="Workspace Vault",o.plmType="Folder"),o.isFavorite=!0,t._createTreeNodeModel(o,t._rootNodeFavorite).setState({state:"noChildren"}),m.displayNotification({message:C.replace(C.get("msg_info_favoriteadded"),{name1:e.name}),className:"success"})}})},onFailure:function(e){t._logger.warn("WebService _setFavorites Err : "+e)}})},onFailure:function(e){t._logger.warn("WebService getFavorites Err : "+e)}})}else this._logger.log("FolderTreeCont unable to addFavorite, newFavoriteFolder(s) is not define")},removeFavorite:function(e){for(var t=this,o=!1,n=t._rootNodeFavorite.getChildren(),i=Array.isArray(n)?n.length:0,r=0;r<i;r++){var a=n[r];if(e.id==a.id){o=a.isSelected(),t._rootNodeFavorite.removeChild(a),!1===t._rootNodeFavorite.hasChildren()&&t._rootNodeFavorite.withTransactionUpdate(function(){t._rootNodeFavorite.removeChildren(),t._rootNodeFavorite.setState({state:"collapsed"})});break}}var s="";f.getCurrentFolder()&&(s=f.getCurrentFolder().getType()),"FolderSection_favorite"==s&&t.getOption("_folderContentView").removeNodeInContent(e.id),t.getFavorites({onComplete:function(n){for(var i=n,r=0,a=0;a<i.length;a++){var s=i[a];if(e.id==s.id){i.splice(a,1),r=1;break}}r?t._setFavorites({favoriteFolders:i,onComplete:function(n){var i=e.name?e.name:"";m.displayNotification({message:C.replace(C.get("msg_info_favoriteremoved"),{name1:i}),className:"success"}),o&&t._rootNodeFavorite.select()},onFailure:function(e){t._logger.warn("WebService _setFavorites Err : "+e)}}):t._logger.log("FolderTreeCont favorite folder to remove, not found in list")},onFailure:function(e){t._logger.warn("WebService getFavorites Err : "+e)}})},renameFavorite:function(e,t,o){var n=this;function i(e,t){e.prepareUpdate(),e.setLabel(t),e.pushUpdate()}function r(){o&&i(o,e.name);let t=C.get("msg_error_rename");m.displayNotification({title:C.replace(t.Title,{name:e.name}),subtitle:t.Advice,message:t.Details,className:"error"}),n.escape()}this.getFavorites({onComplete:function(a){for(var s=a,l=0,d=0;d<s.length;d++){var c=s[d];if(e.id==c.id){c.name=t,l=1;break}}l?n._setFavorites({favoriteFolders:s,onComplete:function(r){o&&o._instanceType&&"FolderEditor/TreeNodeModel"==o._instanceType||n._rootNodeFavorite.getChildren().forEach(function(o){o&&e.id==o.id&&e.name==o.getLabel()&&i(o,t)});m.displayNotification({message:C.replace(C.get("msg_info_favoriterenamed"),{name1:e.name,name2:t}),className:"success"}),n.escape()},onFailure:function(e){n._logger.warn("WebService _setFavorites Err : "+e),r()}}):(n._logger.warn("FolderTreeCont favorite folder to rename, not found in list"),r())},onFailure:function(e){n._logger.warn("WebService getFavorites Err : "+e),r()}})},getFavorites:function(e){var o=this;return p.getUserPreferences({name:"FolderEditorFavoriteFolderList"+A.getPlatformId(),onComplete:function(n){var i=[];if(n.length>0){var r=t.base64Decode(n);(r=JSON.parse(r)).data&&r.data.data&&r.data.data.favorite_folders&&(i=r.data.data.favorite_folders)}for(var a=-1,s=0;s<i.length;s++)"Personal Workspace"==i[s].type&&(a=s);if(-1!=a){var l=UWA.clone(i);l.splice(a),o._setFavorites({favoriteFolders:l,onComplete:function(t){e.onComplete&&e.onComplete(l)},onFailure:function(t){m.displayNotification({message:C.msg_error_nopreferences,className:"error"}),e.onComplete&&e.onComplete(i),o._logger.warn("WebService _setFavorites Err : "+t)}})}else e.onComplete&&e.onComplete(i)},onFailure:function(t){m.displayNotification({message:C.msg_error_nopreferences,className:"error"}),e.onFailure&&e.onFailure(t),o._logger.warn("WebService setPreference Err : "+t)}})},_setFavorites:function(e){var o=this,n=e.favoriteFolders;if(Array.isArray(n)){for(var i={data:{protocol:"3DXContent",version:"1.0",source:"ENOFOL3_AP",data:{favorite_folders:[]}}},r=0;r<n.length;r++){var a=n[r];if(a.id&&a.name){var s={id:a.id,name:a.name};a.type&&!F.isFolder(a.type)&&(s.type=a.type),s.mxid=a.mxid?a.mxid:void 0,a.isPersonal&&(s.isPersonal=!0),a.inherit&&(s.inherit=!0),i.data.data.favorite_folders.push(s)}}p.setUserPreferences({name:"FolderEditorFavoriteFolderList"+A.getPlatformId(),value:t.base64Encode(JSON.stringify(i)),onComplete:function(t){e.onComplete&&e.onComplete(i.data.data.favorite_folders)},onFailure:function(t){m.displayNotification({message:C.msg_error_preferencessnotsaved,className:"error"}),o._logger.warn("WebService setPreference Err : "+t),e.onFailure&&e.onFailure(t)}})}else o._logger.warn("Error : FolderTreeCont _setFavorites, options.favoriteFolders is not an array"),e.onFailure&&e.onFailure(new Error("options.favoriteFolders is not an array"))},updateTreeWithNewFolder:function(e){var t,o=this,n=this._rootNodeFolders;n&&n.isAscendantOf(e)?e.isVisible()&&(t=e):t=n===e?e:o._getVisibleNodeById(e.id,null),t&&p.folderTree({isRoot:"FolderSection_AllFolders"==t.plmType,pid:t.id,onComplete:function(e){e=JSON.parse(e),"FolderSection_AllFolders"==t.plmType?(o.refreshTreeWithServerData(e.folders,"RootFolder",t),k.removeFilters()):o.refreshTreeWithServerData(e.folders,"Folder",t)},onFailure:function(e){o._logger.log("WebService folders Err : "+e)}})},refreshTreeWithServerData:function(e,t,o){var n,i,r=v.generateJSON(e),a=o.getChildren().slice(0),s=0;for(UWA.is(a)&&(s=a.length),n=0;n<s;++n)r[(i=a[n]).id]||this.removeFromTree(i),delete r[i.id];var l=F.isRootFolder(t)?void 0:"subFolders";for(var d in r){i=r[d];var c={useAsyncPreExpand:!0},u=this._getIcon(i,l);c.label=i.label,c.icons=[u],c.children=[],c.id=d,c.mxid=i.mxid,c.plmType=t,c.type=null==t?"Workspace":"Workspace Vault",c.created=i.created,c.folderClassification=i.folderClassification,this._createTreeNodeModel(c,o)}this._folders_SortElmt.sortingNodesUnsensitiveCase()},removeFromTree:function(e){if(e){var t,o,n=this._rootNodeFolders;n&&n.isAscendantOf(e)?e.isVisible()&&(t=e,o=e.getParent()):(t=this._getVisibleNodeById(e.id,null),o=t?t.getParent():null),o&&t&&(!0===o.hasChildren()&&o.removeChild(t),!1===o.hasChildren()&&(o.withTransactionUpdate(function(){o.setState({state:"collapsed"})}),o.options.children=[]))}},updateNodeLabel:function(e,t){var o=this,n=[],i=UWA.is(e,"string")?e:e.physicalid?e.physicalid:null;n=i?this._getNodesById(i):[e];var r=function(e){var t=f.getCurrentFolderID();n.forEach(function(o){if(o.getLabel()!==e){o._lastUpdateTime=Date.now();var i=UWA.extend(o.options,{label:e,oldLabel:e},!0);o.withTransactionUpdate(function(){o.updateOptions(i)})}1===n.length&&t===n[0].getID()&&(f.updateLabelCurrentFolderPath(),P.getIdCardCont().setCurrentLocation(),UWA.is(widget)&&widget.setTitle(o.getLabel()))})};if(n.length>0)if(t)r(t),this._folders_SortElmt.sortingChildrenNodes(n[0].getParent());else if(UWA.is(n[0].getID,"function")){var a=n[0].getID();p.getFolderProperties({pid:a,onComplete:function(e){UWA.is(e,"string")&&(e=JSON.parse(e));var t=e.label;r(t),function(e){if(1===n.length){var t=n[0],o="TRUE"===e?u.getWebappsAssetUrl("FolderEditor","icons/folderPublishBadge.png"):"";t.setBadges({bottomRight:o})}}(e.publishOnConnect),function(e){if(widget.getValue("CandABookmark")&&1===n.length){var t=n[0],o=e&&"SHARED"===e.toUpperCase()?u.getWebappsAssetUrl("FolderEditor","icons/approvals.png"):"";t.setBadges({topRight:o})}}(e.folderClassification);var i,s,l,d,c=!1;M.getEnforceFolderLinkSettingAsync(function(e,t){e||(c=t)}),(c||P.isCustomizedEnv()||P.isActiveBookmarkActivated())&&(i=a,s=P.getActiveFolder(),l=s.id,d=s.disabledId,l===i?n[0].setBadges({topRight:g.ICON_ACTIVE}):d===i&&n[0].setBadges({topRight:g.ICON_ACTIVE_DISABLED})),o._folders_SortElmt&&o._folders_SortElmt.sortingChildrenNodes(n[0].getParent())},onFailure:function(){console.error("Unable to update Tree Label, Error in getting folder Properties")}})}},_updateFilterIconOnToolbox:function(){this.leftToolbar.updateNodeModel("Filter",{visibleFlag:k.isFilterActives()})},expandTreeAndSelectFolder:function(e){var t=this,o=e&&e.folderToFindAndSelect?e.folderToFindAndSelect.ids:void 0,n=[],i=!0;if(e.findInTree&&i&&(this.findInTree=!0,e.findInTreeLoader.setMessage(G.loader.formulatingPaths),e.findInTreeLoader.loader.addEventListener(W.POINTERHIT,function(t){if(i=!1,e.onComplete){var o={folderToFindAndSelect:e.folderToFindAndSelect};e.onComplete(o)}})),o&&i){n=JSON.parse(JSON.stringify(o));for(var a=0;a<o.length;a++){var s=t._getVisibleNodeById(o[a],null);if(s){const r=n.indexOf(o[a]);if(r>-1&&n.splice(r,1),e.doNotSelectInTree?this.findInTree||f.addInFolderCSO(s,"TREE"):(t._scrollToVisibleNode(s),s.select(!0)),!i)break}}if(n.length>0&&i){var l=[],d=f.getCurrentFolder(),c={pids:o,onComplete:function(o){if(!(o=JSON.parse(o)).error&&i){var n=Object.keys(o),a=function(s){r.allSettled(l).then(function(){var c=o[n[s]];if(e.findInTree){var u=s/n.length*100;e.findInTreeLoader.updateLoader(u.toString())}if(!c&&o.error&&(t._logger.warn("Unable to retrieve FolderPath using WebService"),e.onFailure))return e.onFailure(o.error);if(!function(e){var t=!1;if(f.getCurrentFolder()!==d&&(t=!0,e.onGiveUp)){var o={folderToFindAndSelect:e.folderToFindAndSelect};e.onGiveUp(o)}return t}(e))if(t._rootNodeFolders){for(var p=null,g=null,h=t._rootNodeFolders,m=h.pathId,v=0;v<c.length;v++){var _=c[v],S=_.id;if(F.isFolder(_.type)?"Folder":(F.isRootFolder(_.type)||F.isPersonalFolder(_.type))&&("RootFolder",g=S),S){if(!p){var y=t._getVisibleNodeById(S,h);y&&y.isVisible()?(h=y,m=y.pathId):p=h}if(p){var D=m;t._folderStructurePreference.add(D,null,null,e.partiallyExpandPath),h=null,m=m+","+S}}else t._logger.log("unexpected undefined parentObjectId")}if(g)if(p){var b=D+","+n[s];e.doNotSelectInTree?(t._folderStructurePreference.select(""),t._folderStructurePreference.scrollAfterSelect(""),t._TreeNodeToBeAddedtoFolderCSOWithoutSelection_pathId=b):(t._folderStructurePreference.select(b),t._folderStructurePreference.scrollAfterSelect(n[s])),e.partiallyExpandPath?(t._folderStructurePreference.add(b),t._folderStructurePreference.remove(b)):t._folderStructurePreference.remove(b),"expanding"!==p.getState()&&i&&l.push(new r(function(e,t){try{p.expand({updateView:!0,postExpandResolvePromise:function(){e()}})}catch(e){console.log(e),t()}}))}else console.log("   Damnation, no firstUnexpandedTreeNodeModelParentFound");else e.onFailure&&e.onFailure(C.msg_error_NoVisibleRootFolder)}else t._logger.log("  No FolderSection_AllFolders to start expandTreeAndSelectFolder"),e.onFailure&&e.onFailure(C.msg_error_TreeExpandCancelledNotReady);s!==Object.keys(o).length-1&&i?a(s+=1):r.allSettled(l).then(function(){if(e.onComplete&&i){var t={folderToFindAndSelect:e.folderToFindAndSelect};e.onComplete(t)}})})};i&&a(0)}else if(t._logger.warn("Unable to retrieve FolderPath using WebService"),e.onFailure&&o.error)return e.onFailure(o.error)},onFailure:function(e){P.checkRolesAvailability(function(e,t,o){1==e||1==t||1==o?m.displayNotification({message:C.msg_error_folderPath,className:"error"}):m.displayNotification({message:C.msg_error_folderPath_roles,className:"error"})})}};"read"==K.getCurrentModeType()?J.getNavigateDataforFolder(c):p.getFolderPath(c)}else if(e.onComplete){var u={folderToFindAndSelect:e.folderToFindAndSelect};e.onComplete(u)}}else t._logger.log("expandTreeAndSelectFolder error : folderToFindAndSelect is undefined"),e.onFailure&&e.onFailure("Tree exploration stopped, folderToFindAndSelect is undefined")},_getNodesById:function(e,t){var o=[],n=[],i=this;t?o=[t]:i._folders_TreeDocument.getRoots().forEach(function(e){e&&"FolderSection_favorite"!=e.plmType&&o.push(e)});return o.forEach(function(t){t.getID()==e&&n.push(t);var o=t.getChildren();UWA.is(o,"array")&&o.forEach(function(t){i._getNodesById(e,t).forEach(function(e){n.push(e)})})}),n},_getVisibleNodeById:function(e,t){var o=t||this._rootNodeFolders,n=null;if(o&&o.isVisible())if(o.getID()===e)n=o;else if(o.isExpanded()){var i=o.getChildren();if(Array.isArray(i)&&i.length>=1)for(var r=0;r<i.length;r++){var a=i[r];if(a){if(a.id==e){n=a;break}var s=this._getVisibleNodeById(e,a);if(s&&s.isVisible()){n=s;break}}}}return n},_folderStructurePreference:{_prefixes:["_X_","_P_"],_partialExpandPrefix:"_P_",_getID:function(e,t){if(e[t])return e[t];for(var o=0;o<this._prefixes.length;++o){var n=e[this._prefixes[o]+t];if(n)return n}return null},_getPreferenceID:function(e,t){if(e[t])return t;for(var o=0;o<this._prefixes.length;++o)if(e[this._prefixes[o]+t])return this._prefixes[o]+t;return t},_scrollToNode:function(){return"scrollToNode - "+A.getPlatformId()},_getPreferenceTree:function(e){return e||(e={}),e},_getStoredFolderTreeStructure:function(){var e=widget.getValue("folderTreeStructure");try{e=e?JSON.parse(v.jsonUnzip(e)):{}}catch(t){e={}}return this._getPreferenceTree(e)},add:function(e,t,o,n){var i=this;function r(e,t){for(var o=0;o<i._prefixes.length;++o)if(e[i._prefixes[o]+t])return e[t]=e[i._prefixes[o]+t],void delete e[i._prefixes[o]+t]}if(!o||!0!==o.isFailure){var a=this._getStoredFolderTreeStructure(),s=e.split(","),l=a;s.forEach(function(e,o){l[e]||l[i._partialExpandPrefix+e]?!1===t&&(r(l,e),o==s.length-1&&(l[e]={})):n?l["_X_"+e]?(l[i._partialExpandPrefix+e]=l["_X_"+e],delete l["_X_"+e]):l[i._partialExpandPrefix+e]={}:!function(e,t){for(var o=0;o<i._prefixes.length;++o)if(e[i._prefixes[o]+t])return!0;return!1}(l,e)?l[e]={}:r(l,e),o!=s.length-1||n||r(l,e),l=l[e]?l[e]:l[i._partialExpandPrefix+e]}),i.saveFolderStruture(a)}},remove:function(e,t){var o=this,n=this._getStoredFolderTreeStructure(),i=e.split(","),r=n,a=!1;i.forEach(function(e,n){r&&(n<i.length-1?(n==i.length-2&&r[o._partialExpandPrefix+e]&&(a=!0),r=o._getID(r,e)):(!t&&(r[e]&&Object.keys(r[e]).length>0||r[o._partialExpandPrefix+e]&&Object.keys(r[o._partialExpandPrefix+e]).length>0||a)&&(r["_X_"+e]=r[e]?r[e]:r[o._partialExpandPrefix+e]),t&&r["_X_"+e]?delete r["_X_"+e]:r[e]?delete r[e]:delete r[o._partialExpandPrefix+e]))}),o.saveFolderStruture(n)},isExpanded:function(e,t){var o=this,n=this._getStoredFolderTreeStructure(),i=e.split(","),r=!1,a=n;i.forEach(function(e,t){a&&t<i.length-1?a=o._getID(a,e):a&&(r=void 0!==a[e]||void 0!==a["_P_"+e])}),t.call(window,r)},recursive:function(e,t,o,n){var i=this;function r(e){return e.replace(i._partialExpandPrefix,"")}var a=null,s=e?Object.keys(e).length:0,l=0===o.length?[]:o[o.length-1];function d(e,t){var n=!!a?a:l;s>1&&!t&&(a=n.slice()),n=t?[]:n,o.indexOf(n)<0&&o.push(n),n.push(e)}for(var c in e){var u=-1!==c.indexOf(i._partialExpandPrefix),p=-1!==c.indexOf("_X_");if(e[c])if(n){var g=-1!==t.indexOf(i._partialExpandPrefix);p?g&&d(c.replace("_X_","")):(u?d(r(c),!g):g&&d(c),this.recursive(e[c],c,o,n))}else p||(u||o.push(r(c)),this.recursive(e[c],c,o,n))}},getExpandedChildren:function(e,t,o,n){var i=this,r=this._getStoredFolderTreeStructure(),a=e.split(","),s=[],l=r;a.forEach(function(e,t){if(l&&t<a.length-1)l=i._getID(l,e);else if(l){var r=i._getID(l,e),d=i._getPreferenceID(l,e),c=-1!==d.indexOf(i._partialExpandPrefix);if(o&&c&&n){var u=d.replace(i._partialExpandPrefix,"");u="FolderSection_AllFolders"===u?"root":u,s.push([u])}i.recursive(r,d,s,o)}}),t.call(window,s)},saveFolderStruture:function(e){if(e&&e.root&&e.root.e&&(e={}),e=JSON.stringify(e),e=v.jsonZip(e),!1!==widget.getValue("expandSaveLimitation")&&e.length>this.options.limitExpand){let e=C.get("msg_warning_expandSaveLimitation");m.displayNotification({title:e.Title,subtitle:e.Advice,message:e.Details,className:"warning",id:"expandLimitation",debounce:!0})}else widget.setValue("folderTreeStructure",e)},select:function(e){var t=v.jsonUnzip(widget.getValue("folderTreeSelectedNode")||"{}");(t=JSON.parse(t))[A.getPlatformId()]=e,t=JSON.stringify(t),widget.setValue("folderTreeSelectedNode",v.jsonZip(t))},isSelected:function(e){return this.getSelection()==e},isSelectValuated:function(){return!!this.getSelection()},getSelection:function(){var e=v.jsonUnzip(widget.getValue("folderTreeSelectedNode")||"{}");return(e=JSON.parse(e))[A.getPlatformId()]},scrollAfterSelect:function(e){widget.setValue(this._scrollToNode(),e)},doScrollAfterSelect:function(e){return widget.getValue(this._scrollToNode())===e}},_indexModeforReadData:{_indexInfo:null,_nextStart:0,_infinteScrollinginProcess:!1,isInfiniteScrollingInProcess:function(){return this._infinteScrollinginProcess},setInfiniteScrollingStatus:function(e){this._infinteScrollinginProcess=e},getInfoIndex:function(){return this._indexInfo},getNextStart:function(){return this._nextStart},setNextStart:function(e){this._nextStart=e},resetInfoIndex:function(){this._indexInfo=null,this._nextStart=0,this._infinteScrollinginProcess=!1},setInfoIndex:function(e){this._indexInfo=e||null}},_scrollOnPostUpdateView:function(e){var t=this,o=this._folders_TreeView?this._folders_TreeView:null;o&&o.onPostUpdateViewOnce(function(){t._folderStructurePreference.doScrollAfterSelect(e.getID())&&(t._scrollToVisibleNode(e),t._folderStructurePreference.scrollAfterSelect(""))})},_doScrolltotheSavedPosition:function(){var e=this._folders_TreeView;if(e._getScroller()){var t=v.getTreeViewScrollerPosition();void 0!==t.x&&null!==t.x&&void 0!==t.y&&null!==t.y&&e.setScrollerPosition(t)}},_createTreeNodeModel:function(e,t,o){var n=this,i=t instanceof l,r=e.publishOnConnect,a=e.folderClassification;delete e.publishOnConnect;var s=new d(e);if(s.id=e.id,s.plmType=e.plmType,s.type=e.type,e.isFavorite&&(s.isFavorite=!0),(e.isPersonal||!i&&t.isPersonal)&&(s.isPersonal=!0),e.created&&(s.created=e.created),s._instanceType="FolderEditor/TreeNodeModel",s._loadingcounter=0,s.getID=function(){var e=this.id;return e&&""!==e||(e=this.plmType),e},s.getType=function(){return this.plmType},s.options.oldLabel=e.label,s.pathId=(i?"root":t.pathId)+","+s.getID(),"TRUE"===r){var c=u.getWebappsAssetUrl("FolderEditor","icons/folderPublishBadge.png");s.setBadges({bottomRight:c})}if(widget.getValue("CandABookmark")&&"SHARED"===a){c=u.getWebappsAssetUrl("FolderEditor","icons/approvals.png");s.setBadges({topRight:c})}var p=!1;if(M.getEnforceFolderLinkSettingAsync(function(e,t){e||(p=t)}),p||P.isCustomizedEnv()||P.isActiveBookmarkActivated()){var h=P.getActiveFolder(),m=h.id,v=h.disabledId;m===s.id&&!0!==e.isFavorite?s.setBadges({topRight:g.ICON_ACTIVE}):v===s.id&&!0!==e.isFavorite&&s.setBadges({topRight:g.ICON_ACTIVE_DISABLED})}s.onPostExpand(function(e){if(!e||!e.data||!0!==e.data.updateView&&!e.data.onlyUI||e.data.expandLevel){var t=!1;!1!==e.data.clearLast&&e.data.nodeModel.getNodeDepth()-e.data.initialLevel==e.data.expandLevel-1||(t=!0),n._folderStructurePreference.add(this.pathId,t,{isFailure:!0===this.loadHasFailed})}else e.data.postExpandResolvePromise&&e.data.postExpandResolvePromise()}),s.addEventListener("preCollapseAll",function(){n.deactivatePostCollapse=!0}),s.addEventListener("postCollapseAll",function(){n.deactivatePostCollapse=!1,n._folderStructurePreference.remove(this.pathId,!0)}),s.onPostCollapse(function(e){!0===n.deactivatePostCollapse||e.data.updateView||n._folderStructurePreference.remove(this.pathId)}),ae(s).subscribe({event:"removeChild"},function(e){if(s.isExpanded()&&s.isVisible()){var t=e.nodeModel;!t&&e.data&&(t=e.data.nodeModel),t&&n._folderStructurePreference.remove(t.pathId)}}),ae(s).subscribe({event:"addChild"},function(e){if(s.isExpanded()&&s.isVisible()){var t=e.nodeModel;!t&&e.data&&(t=e.data.nodeModel),t&&t._isExpanded&&n._folderStructurePreference.add(t.pathId)}}),i?t.addRoot(s):("partiallyExpanded"===t.getState()&&(n._folderStructurePreference.add(s.pathId),n._folderStructurePreference.remove(s.pathId),n._folderStructurePreference.add(t.pathId)),t.addChild(s,o));if(n._folderStructurePreference.isExpanded(s.pathId,function(e){var o;e&&("FolderSection_favorite"!==s.plmType||n._rootNodeFavorite||(n._rootNodeFavorite=s),o="expand",i?s[o]({updateView:!0}):t.isExpanded()?("expand"!==o||!s.isExpanded()&&"expanding"!==s.getState())&&s[o]({onlyUI:!0}):ae(t).subscribeOnce({event:"postExpand"},function(e){"expanding"!==s.getState()&&("partiallyExpanded"===s.getState()&&"expand"===o||s[o]({onlyUI:!0}))}))}),"FolderSection_AllFolders"==e.plmType&&(n._folderStructurePreference.isSelectValuated()||n._folderStructurePreference.select(s.pathId)),n._folderStructurePreference.isSelected(s.pathId)){for(var _=s;null!=_&&!_.isVisible();)_=_.getParent();_===s?s.select():ae(_).subscribeOnce({event:"postExpand"},function(e){n._folders_TreeDocument.getXSO().empty(),s.select()})}else s.pathId===n._TreeNodeToBeAddedtoFolderCSOWithoutSelection_pathId&&(this.findInTree||(f.addInFolderCSO(s,"TREE"),n._TreeNodeToBeAddedtoFolderCSOWithoutSelection_pathId=void 0));return s},__onContextualMenuReady:function(e){return new r(function(t){var o=e.cellInfos;o.cellView;if(o.cellModel){var n=f.getSelectedNodes(),i=[];n.length&&n.forEach(function(e){i.push(e)}),i.length&&i.forEach(function(e){e.unselect()});var r=!1;if(o.nodeModel)if(!1===o.nodeModel._isSelected&&(o.nodeModel._isSelected=!0,o.nodeModel.select(!0)),!0===o.nodeModel._isSelected)(o.nodeModel?o.nodeModel:o.cellModel)&&(r=!0);r?y.GetContextualMenu(o,"TREE",e).then(function(e){e&&t(e)}):t([])}else t([])})},refreshFolderTreeAndContent:function(e){var t=this.changeInPreference(),o=null;if(t.isPreferenceChangeCauseOfRefresh&&Object.keys(t.change).length>0)for(var n in t.change){if(!this.refreshMap.has(n)){o="allRefresh";break}1!==this.refreshMap.get(n)||(o="contentRefresh")}if(!t.isPreferenceChangeCauseOfRefresh||o){k.refresh();var i=P.getContent().getPADTreeListView(),r=i?i.getManager():null;r&&(P.getContent()._componentScrollerPosition=r.getScrollerPosition());var a=P.getContent().getPADTreeDocument();a&&a.keepExpandedState();var s=f.getCurrentFolder();if(!this._folderStructurePreference.isSelectValuated()||s&&e&&e.indexOf(s.id)>=0){s&&s.unselect(),this._folderStructurePreference.select("root,FolderSection_AllFolders"),this._rootNodeFolders.select()}if(this._rootNodeFavorite.isExpanded())if(t.isPreferenceChangeCauseOfRefresh&&"contentRefresh"==o){if(s.pathId.contains("FolderSection_favorite"))return void P.getContent().loadContentAndSelect(s)}else this._rootNodeFavorite.expand();else("FolderSection_favorite"==s.plmType||!s.isVisible()&&s.pathId.contains("FolderSection_favorite"))&&P.getContent().loadContentAndSelect(s);return this._rootNodeFolders.isExpanded()?t.isPreferenceChangeCauseOfRefresh&&"contentRefresh"===o?void(s.pathId.contains("FolderSection_AllFolders")&&P.getContent().loadContentAndSelect(s)):(("FolderSection_AllFolders"==s.plmType||!s.isVisible()&&s.pathId.contains("FolderSection_AllFolders"))&&P.getContent().loadContentAndSelect(s),this._rootNodeFolders.collapse({updateView:!0}),void this._rootNodeFolders.expand({updateView:!0})):void(("FolderSection_AllFolders"==s.plmType||!s.isVisible()&&s.pathId.contains("FolderSection_AllFolders"))&&P.getContent().loadContentAndSelect(s))}},switchFolderTreeNodeLabelToWriteView:function(e){try{var t=!1;if(e instanceof d&&F.inFamilyFolder(e.plmType)&&e.getTreeDocument()===this._folders_TreeDocument&&this._folders_TreeView){var o=this._folders_TreeView;if(o){var n=o.layout.getColumnIndex("tree"),i=o.layout.getCellsFromNodeModel(e)[n];o.setCellInEdition(i),t=!0}}return t}catch(e){}},getSortingContainer:function(){return this._folders_SortElmt.elements.container},getFindInTreeIcon:function(){return this._folders_FindInTree.elements.container},_scrollToVisibleNode:function(e){var t=this._folders_TreeView,o=t.layout.getColumnIndex("tree"),n=t.layout.getCellsFromNodeModel(e)[o];t.scrollToCellAt({cellID:n})},modeChange:function(e){if(!1!==widget.getValue("compactModeForLeftSidebar")){var t=this._folders_TreeView.layout.cellHeight,o=t;if("comfortable"===e.viewMode)o=38,this._folders_SortElmt.elements.container.setStyle("height",38),this._folders_FindInTree.elements.container.setStyle("height",38),this.elements.container.setAttribute("Compact",!1),this.elements.container.getChildren()[1].setAttribute("Compact",!1);else{if("compact"!==e.viewMode)return;o=26,this._folders_SortElmt.elements.container.setStyle("height",23),this._folders_FindInTree.elements.container.setStyle("height",23),this.elements.container.setAttribute("Compact",!0),this.elements.container.getChildren()[1].setAttribute("Compact",!0)}var n=o!==t;this._folders_TreeView.layout.cellHeight=o,n&&this._folders_TreeView.updateView(!0)}},changeInPreference:function(){return{change:widget.changeInPreference,isPreferenceChangeCauseOfRefresh:widget.refreshDuetoChangeInPreference}},activateTreeFilter:function(e){if(e!=w.getSetting("activateTreeFilter")){w.setSetting("activateTreeFilter",e);var t=P.getContent();e?(UWA.extendElement(t.elements.padshell._leftPanel).addClassName("FolderEditor_LeftView_Select"),UWA.extendElement(this._commonToolSection).addClassName("folder-common-tool-Section_Select")):(UWA.extendElement(t.elements.padshell._leftPanel).removeClassName("FolderEditor_LeftView_Select"),UWA.extendElement(this._commonToolSection).removeClassName("folder-common-tool-Section_Select")),_.notifyTaggerStatusChange()}},setOrderToolAreaSelectable:function(e){this._folders_SortElmt.setOrderToolAreaSelectable(e)},getCommonToolSection(){return this._commonToolSection},getGridViewRowHeight:function(){let e=JSON.parse(Y).settings.dgvOptions.value.dgvLayout.cellHeight,t=this._folders_TreeView.layout;return t&&(e=t.getRowHeight()),e},getContentHeight:function(){let e=0;if(document){let t=document.getElementsByClassName("FolderTree_Cont-root_treeview_container");if(t&&t.length>0){e=t[0].clientHeight}}return e}});return se}),define("DS/FolderEditor/FolderComponent",["UWA/Core","DS/Logger/Logger","DS/WebappsUtils/WebappsUtils","DS/FolderEditor/FolderXNavComponent","DS/FolderEditor/models/xBookNodeModel","DS/Tree/TreeNodeModel","DS/FolderEditor/views/FolderGlobalActiveBookmark","DS/FolderEditor/service/FolderEditorWebService","DS/FolderEditor/utils/FolderEditorUtil","DS/FolderEditor/service/FolderDnDServices","DS/FolderEditor/service/FolderTypeService","DS/FolderEditor/commands/FolderCommands","DS/PADUtils/PADSettingsMgt","DS/PADUtils/PADUtilsServices","DS/FolderEditor/Folder_CSO","DS/IPClassifyUtil/IPClassifyAlert","i18n!DS/FolderEditor/assets/nls/FolderEditor","i18n!DS/SNResultUX/assets/nls/SNResultUX","DS/FolderEditor/utils/FolderEditorcontrol","DS/FolderEditor/Folder_Clipboard","DS/FolderEditor/service/FolderLogicalDeleteServices","DS/FolderEditor/utils/FolderEditorEvents","DS/FolderEditor/utils/FolderSearch","DS/LifecycleServices/LifecycleServicesSettings","DS/WidgetServices/UIInfra/UIInfra","DS/WidgetServices/WidgetServices","DS/PADServices/utils/GlobalModelEvents","DS/PADUtils/PADProbes","DS/PADServices/utils/AttributesMgtV2","DS/FolderEditor/controllers/AuthoringMode","DS/FolderEditor/controllers/SearchMode","DS/FolderEditor/controllers/FavoritesMode","DS/FolderEditor/controllers/ReadMode","DS/IPClassifyUX/service/PlatformServices","DS/IPClassifyUtil/IPClassifyUtility","DS/IPClassifyUtil/IPClassifyCommunication","DS/FolderEditor/utils/FolderLoaderGlobal","text!DS/FolderEditor/assets/FolderEditorConf.json","i18n!DS/FolderEditor/assets/nls/BookmarkLocationPopup","DS/FolderEditor/views/FolderMode","DS/FolderEditor/tagger/TaggerContentProxy","DS/FolderEditor/tagger/TaggerTreeProxy","DS/Utilities/Utils","DS/PADUtils/PADPredicatesNls"],function(e,t,o,n,i,r,a,s,l,d,c,u,p,g,f,h,m,v,_,C,S,F,y,D,b,E,w,A,T,x,P,I,N,U,O,M,R,k,L,W,V,B,j,q){var H=function(){var e=f.getCurrentFolder(),t=void 0,o=void 0;if(e){var n=l.getX3DContentId();if(n)e.getID()===l.getX3DBookmarkId()&&(t=[n],o={copylink:!0},l.clearX3DContentItem())}return{selection:t,options:o}},z=function(t,o){var n=t.dataelements[o];return e.is(n,"array")&&(n=n[0]),n};function G(e,t,o){l.setBadge(e,t,o)}var X={authoring:new x,search:new P,favorites:new I,read:new N},J=n.extend({name:"FolderComponent",defaultOptions:{x3dAppId:"FolderEditor",amd_custo:{TreeDocument:"DS/FolderEditor/FolderTreeDocument",DataGridView:"DS/FolderEditor/views/FolderDataGridView",TileGridView:"DS/FolderEditor/views/FolderTileView",ThumbnailGridView:"DS/FolderEditor/views/FolderThumbnailView"},active_view:l.getDefaultView(),layout:{keyboard_inputs:!1,root_panel:!1,action_bar:!1,statusInfo:!1,slidder:!1,title_update:!1,drop_invite:"none",triptychOpts:{borderLeft:!0,withtransition:!E.isReplayedODT(),left:{resizable:!0}},amdTreeView:"datagridview"},insert_replace:!0},_contentDiv:null,init:function(e,o){this._probeLoadElmt=A.createProbe("loadComponent");var n=this;this._contentDiv=e.renderTo;var i=W.getCurrentModeType();this.setCurrentMode(i),this._handlerThumbnails=null,this._treeCont=o,this.setOptions(e),this._parent(this.options),this.elements||(this.elements={}),this.elements.tempLeftContent=null,this._logger=t.getLogger(J),require(["DS/PADUtils/views/PADStatusInfos"],function(e){n.elements.padstatus=new e({renderTo:n._contentDiv,events:{onShow:function(){n.elements.padstatus.setStatus(e.buildStatus({tree_content:{nbObjectsInTree:n.getObjectsInTree(),nbObjectsSelected:n.options.model.getSelectedNodes().length}}))}}})}),_.getPlaceholder().then(function(e){n._placeHolder=e}),F.onFolderRename(function(e){n._sortingNodesContent(e)});var r=UWA.createElement("div",{class:"containerTools"}),a=w.getModelEvents();a.subscribe({event:"IPClassifyColumnCusto/Views/showInWidgetBody"},function(e){e.html?(r.empty(),e.html.inject(r),r.inject(widget.body)):!0===e.restore&&r.remove()}),a.subscribe({event:"filterUpdatedTree"},()=>{if(_.getContent()&&("FolderSection_AllFolders"==f.getCurrentFolderID()&&f.getCurrentFolder())){this.getSpecficMode("read").resetInfoIndex(),this.switchMode(null,!0)}}),a.subscribe({event:"filterUpdatedContent"},e=>{var t=e.matchingIds,o=t;o&&this.getPADTreeDocument().filterFromIds(t);var n=y,i="search";y.isSearchActive()||(i="read",n=null,W.isFolderProxyToBeUsed()&&(this._keepPreviousNodes=o&&!!e.hasFilter,n=this.getSpecficMode("read"))),n?(n.resetInfoIndex(),this.RefreshProductStructure=!0,this.switchMode(i,!1)):V.reloadObjects()}),e.layout&&e.layout.view_customization&&Array.isArray(e.layout.view_customization.selectedExtensions)&&Array.isArray(e.layout.view_customization.selectedTypes)&&T.updateSelectedParams({selectedExtensions:e.layout.view_customization.selectedExtensions,selectedTypes:e.layout.view_customization.selectedTypes})},createRootListSlidder2:function(){return this._treeCont.elements.container},switchMode:function(e,t){e=e&&X[e]?e:"FolderSection_favorite"==f.getCurrentFolderID()?"favorites":widget.getValue("useIndexAccleration")?W.getCurrentModeType():"authoring",X[e]!==this._currentMode&&(this.setCurrentMode(e),t=!0),"read"!=e&&"authoring"!=e||W.getCurrentModeType()!==e&&(W.setCurrentModeType(e),W.updateIconAndSettings()),t&&V.clearTags();var o=H(),n=o.selection;null==n||0===n.length?this.loadContentAndSelect():(l.clearX3DContentItem(),this.loadContentAndSelect(void 0,n,o.options))},getObjectsInTree:function(){return this._currentMode.getObjectsInTree?this._currentMode.getObjectsInTree(this):this.options.model.getAllDescendants().length},_addStyleOnTreeCont:function(e){var t=this.elements.padshell._getLeftWidth();t=e&&e>t?e:t,E.addNewStyles("treeContResize",{".FolderTree_Cont-root_container":{overflow:"hidden"},".FolderTree_Cont-root_treeview_container":{width:t+"px !important"}},!0)},_OnPADComponentReady:function(){var e=this;this.addEvent("onToggleView",l.setDefaultView),require(["DS/FolderEditor/views/FolderLeftSidePanelView","DS/FolderEditor/views/FolderRightSidePanelView"],function(t,o){e.folderLeftPanel=new t,(new U).initializePlatform({onComplete:function(t){e.folderRightPanel=new o({platformUrls:t.platformurls})}})}),l.getLeftPanelStatus().leftPanelState&&this.elements.padshell.togglePanel("left"),this.addEvent("onToggleView",function(){0===_.getContent().getObjectsInTree()&&e._addPlaceHolder(),e._filterRelatedNodes()});var t=widget.getValue("customLeftWidth");this._addStyleOnTreeCont(t),this.elements.padshell._modelEvents.subscribe({event:"triptych-panel-show-started"},function(t){"left"===t&&e._addStyleOnTreeCont()}),this.elements.padshell._modelEvents.subscribe({event:"triptych-panel-visible"},function(e){"left"===e&&E.clearJSStylesheet("treeContResize")}),null!=t&&this.elements.padshell._modelEvents.publish({event:"triptych-set-size",data:{side:"left",size:t}}),this.elements.padshell._modelEvents.subscribe({event:"triptych-resized"},function(e){"left"===e.side&&widget.setValue("customLeftWidth",e.width)}),this.elements.padshell._leftPanelContent.addEventListener("click",function(e){if(e&&e.target&&e.target.id&&"folder-common-tool-Section"===e.target.id&&O.isWidgetMaximized()){var t=p.getSetting("activateTreeFilter");_.getTreeCont().activateTreeFilter(!t)}}),_.setContent(this),y.setPredicates(T.getAvailableColumnsOpts()),F.onCurrentFolderChange(function(t){V.clearTags(),e.getSpecficMode("read").resetInfoIndex(),e.switchMode(null,!0)}),F.onCurrentFolderColumnChange(function(){y.isSearchInProgress()&&y.resetInfoIndex(),e.getSpecficMode("read").resetInfoIndex(),e.loadContentAndSelect(null,null)});var o=f.getCurrentFolder();if(o){var n=H(),i=n.selection;this.loadContentAndSelect(o,i,n.options)}require("DS/FolderEditor/views/FolderMode").updateIconAndSettings(),this._probeLoadElmt.end()},_filterRelatedNodes:function(){var e=this.getPADTreeDocument();let t="datagridview"===this.getActiveView()?"IN":"OUT";if(e){var o=e.getRoots(!0).slice(0);e.wrapInTransaction(function(){e.withTransactionUpdate(function(){var e,n=o.length;for(e=0;e<n;++e)o[e].filterIn(!0);var i=function(e){e.isRelationsObjectNode?e._filterStatus=t:e._filterStatus="IN";var o=e.getChildren();o&&o.length>0&&o.slice(0).forEach(function(e){i(e)})},r=function(e){if("IN"===e._filterStatus){var t=e.getChildren();t&&t.length>0&&t.slice(0).forEach(function(e){r(e)})}else e.filterOut(),e.__treeGraphRoot__&&delete e.__treeGraphRoot__;delete e._filterStatus};o.forEach(function(e){i(e)}),o.forEach(function(e){r(e)})})})}},setFolderCommunicationChannel:function(){},onDragStartCell:function(e,t){if(!d.shouldAcceptDrag())return e.preventDefault(),void e.stopPropagation();C.SetAsExternalDrop(!1);var o=d.getDragDataForSelectedNodesInCurrentFolderContent(t),n=JSON.stringify(o);try{e.dataTransfer.setData("text/searchitems",n)}catch(e){}if(e.dataTransfer.setData("Text",n),"graphview"!==this.getActiveView()&&b.createGhostDnD(e,{number:o.data.items.length}),e.dataTransfer.effectAllowed="copyMove",d.setStartDrag(!0),d.setDragFrom("bookmark"),!0===widget.getValue("noCompass")){var i=o.data.items,r=[];i.forEach(function(e){r.push(e.objectId)}),M.publish("setDragData",{ids:r})}e.stopPropagation()},onDragEndCell:function(){d.setStartDrag(!1)},onDragEnterCell:function(e,t){e&&e.dataTransfer&&(e.dataTransfer.dropEffect=d.isDragging()&&d.isMoveDnDSetting()&&!d.hasFilesInEvent(e)?"move":"copy");var o=t.nodeModel,n=o&&o.options?o.options.type:void 0;return!!c.inFamilyFolder(n)||(this.onDragEnterBlank(e,t),!1)},onDragLeaveCell:function(e,t){e&&e.dataTransfer&&(e.dataTransfer.dropEffect="none");var o=t.nodeModel,n=o&&o.options?o.options.type:void 0;return c.inFamilyFolder(n)?"tileview"!=this.getActiveView()&&"thumbnailview"!=this.getActiveView()||void t.manager._hideDndFeedbacks():(this.onDragLeaveBlank(e,t),!1)},onDragOverCell:function(e,t){e&&e.dataTransfer&&(e.dataTransfer.dropEffect=d.isDragging()&&d.isMoveDnDSetting()&&!d.hasFilesInEvent(e)?"move":"copy"),e.preventDefault();var o=t.nodeModel,n=o&&o.options?o.options.type:void 0;return c.inFamilyFolder(n)?(t&&(t.dropPosition="middle"),"tileview"!=this.getActiveView()&&"thumbnailview"!=this.getActiveView()||void t.manager.onDragOverCellDefault(e,t)):(this.onDragOverBlank(e,t),!1)},onDropCell:function(e,t){if(1!=widget.launchWithReadMode){C.SetAsExternalDrop(!1);var o=t.nodeModel,n=o&&o.options?o.options.type:void 0;c.inFamilyFolder(n)?(d.performDropOnFolderEditorNode(o,e),e.preventDefault()):this.onDropBlank(e,t),d.setDragFrom(""),"tileview"!=this.getActiveView()&&"thumbnailview"!=this.getActiveView()||t.manager.onDropCellDefault(e,t)}else h.displayNotification({message:m.msg_warning_DndNotSupported,className:"warning"})},onDragEnterBlank:function(e,t){e&&e.dataTransfer&&(e.dataTransfer.dropEffect=d.isDragging()&&d.isMoveDnDSetting()&&!d.hasFilesInEvent(e)?"move":"copy");var o=this.getActiveView(),n=this.getOption("views")[o];return n&&n.options&&n.options.onDragEnterBlankDefault&&n.options.onDragEnterBlankDefault(e,t),!0},onDragLeaveBlank:function(e,t){e&&e.dataTransfer&&(e.dataTransfer.dropEffect="none");var o=this.getActiveView(),n=this.getOption("views")[o];return n&&n.options&&n.options.onDragLeaveBlankDefault&&n.options.onDragLeaveBlankDefault(e,t),!0},onDragOverBlank:function(e,t){e.preventDefault(),e&&e.dataTransfer&&(e.dataTransfer.dropEffect=d.isDragging()&&d.isMoveDnDSetting()&&!d.hasFilesInEvent(e)?"move":"copy");var o=this.getActiveView(),n=this.getOption("views")[o];return n&&n.options&&n.options.onDragOverBlankDefault&&n.options.onDragOverBlankDefault(e,t),!0},onDropBlank:function(e){if(1!=widget.launchWithReadMode){C.SetAsExternalDrop(!1);var t=f.getCurrentFolder();d.performDropOnFolderEditorNode(t,e),e.preventDefault(),d.setDragFrom("")}else h.displayNotification({message:m.msg_warning_DndNotSupported,className:"warning"})},onDropColumnHeader:function(){return d.setDragFrom(""),!0},getOnContextualEvent:function(){return{this:this,callback:function(e){return new Promise(function(t){u.getCtxMenu(e).then(function(e){t(e)}).catch(e=>console.log(e))})}}},doDnDDragStart:function(e,t,o){return this.onDragStartCell(this._createSimulatedEvent(e)),!0},doDnDDrop:function(e,t,o,n){var i={nodeModel:t};this.onDropCell(this._createSimulatedEvent(e),i)},shouldAcceptDnDDrop:function(e,t,o,n){return null==t.plmType||c.inFamilyFolder(t.plmType)},_createSimulatedEvent:function(e){function t(){}return{dataTransfer:e,preventDefault:t,stopPropagation:t}},getActiveView:function(){return this._parent()},removeNodesInContent:function(){var e=this.getPADTreeDocument();if(e){var t=e.getRoots(!0).slice(0);e.wrapInTransaction(function(){e.withTransactionUpdate(function(){var o,n=t.length;for(o=0;o<n;++o)t[o].filterIn(!0);for(e.unselectAll(),o=0;o<n;++o)e.removeRoot(t[o],!0,!1)})})}},_loadContent:function(e,t,n){var r=this,a="";!0===widget.getBool("show-sub-folders")&&(a="All");var s="";!0===widget.getBool("filtered-content")&&(s="Yes");var l=!1;!0===widget.getBool("allow-products-expand")&&(l="Yes");var d=A.createProbe("loadContent_serverCall");if(null==R.container.contentView){var u=this._contentDiv,g=null;u&&(g=u.getElement(".xbook_viewmain"))&&(widget.body.contentViewLoaderContainer=UWA.createElement("div",{class:"FolderEditor_contentView_loader"}).inject(g),R.setContainer("contentView",widget.body.contentViewLoaderContainer))}R.removeComponentToLoad("global","tree"),R.addComponentsToLoad("contentView",{content:""});var f=null;f=!0===widget.getValue("standalone")?Promise.resolve({isCSVroleAvailable:!0}):new Promise(function(e){_.checkRolesAvailability(function(t,o,n){e({isPAUroleAvailable:t,isPARroleAvailable:o,isCSVroleAvailable:n})})});var v=e.getID?e.getID():"",C=e.getType?e.getType():"",S=this._currentMode.loadContent({pid:v,type:C,content:a,filterChildren:s});Promise.all([f,S]).then(function(a){var s=a[0].isPAUroleAvailable,u=a[0].isPARroleAvailable,g=a[0].isCSVroleAvailable,f=a[1];r.getPADTreeDocument().wrapInTransaction(function(){e.options.contentAvailable=!0,d.end(),r.probeListContent=A.createProbe("listContent");var a=f.contents;if(r._placeHolder&&r._placeHolder.getContent().remove(),0===f.contents.length&&r._addPlaceHolder(),void 0!==a){var v=[];if(r.RefreshProductStructure&&l){var _=r.getPADTreeDocument().getRoots(),S=0,F=_.length;for(S=0;S<F;S++){var D=_[S];_[S].isExpanded()&&(!0===D._isProcessedForRelationsColumns&&delete D._isProcessedForRelationsColumns,v.push(D))}}var b=[],E="read"==W.getCurrentModeType()&&1==r.getCurrentMode()._isPageRefreshed,w={},T=[];if(!0!==f.inProgress||E){var x=A.createProbe("loadContent_cleanNodes");if(r._keepPreviousNodes||r.RefreshProductStructure&&V.isFilterActives()&&X.search!==r.getCurrentMode()){r.getPADTreeDocument().getRoots(!0).forEach(e=>{e.bkTempVisible=e.isVisible(),T.push(e),w[e.getID()]=!0}),r._keepPreviousNodes=!1}r.removeNodesInContent(),E&&(r.getCurrentMode()._isPageRefreshed=!1),x.end()}var P=[];a.forEach(function(n){var a=r._currentMode.convertData(n);if(!w[a.resourceid]){(!l||!0!==u&&!0!==s&&!0!==g)&&(a.children=null);var d=null;if(v.forEach(function(e){(e.id||e.getID())===a.resourceid&&(d=e)}),null==d){a.grid&&(a.grid.bi_color="rgba(0, 0, 0, 0)");var p=a.icons&&a.icons.length>0?a.icons[0]:"";a.icons=[{iconPath:"url("+p+")"}];var f=new i(a);if(a.nodeAttrs)for(var h in a.nodeAttrs)f[h]=a.nodeAttrs[h];if(f.options.grid.thumbnail=a.thumbnail?a.thumbnail:"",f.plmType)"Folder"===f.plmType&&(f.type="Workspace Vault"),"RootFolder"===f.plmType&&(f.type="Workspace");else{var m=a.grid.type?a.grid.type:a.grid["ds6w:type"];c.isFolder(m)?(f.plmType="Folder",f.type="Workspace Vault"):c.isRootFolder(m)||c.isPersonalFolder(m)?(f.plmType="RootFolder",f.type="Workspace"):f.plmType="Content"}if(f.id=a.resourceid,f._ischeckout="read"==r.getCurrentModeType()?a.Documentlocked:n.Documentlocked,"TRUE"===f._ischeckout)G(f,"bottomRight",o.getWebappsAssetUrl("FolderEditor","icons/22/I_CheckOutDocument.png"));if("TRUE"===a.publishOnConnect)G(f,"bottomRight",o.getWebappsAssetUrl("FolderEditor","icons/folderPublishBadge.png"));f.options.oldLabel=a.label,e.isPersonal&&(f.isPersonal=!0),r.updateActiveBookmarkNode(f),f._manageNLS=!0,(UWA.is(t,"array")?t.indexOf(a.resourceid)>=0:a.resourceid===t)&&P.push(f),T.push(f)}else{T.push(d);var _=!1;if(Array.isArray(d.getChildren())&&d.getChildren().length>0){var C=d.getChildren()[0];C.hasOwnProperty("isRelationsObjectGroupingNode")&&(_=C.isRelationsObjectGroupingNode)}_||b.push(d);var S=d.id||d.getID();(UWA.is(t,"array")?t.indexOf(S)>=0:S===t)&&P.push(d)}}}),T&&!0!==f.sorted&&T.sort(r._ascendingSortingRootNodeByTitle);var I=p.getSetting("settypes");!f.modelerName&&I||p.setSetting("settypes",!f.modelerName||"UPS"===f.modelerName),r.probeAddNode=A.createProbe("loadContent_addNodes");var N="datagridview"===r.getActiveView()&&null!==r.getPADTreeListView();N&&r._listenEndUIRefreshEvent(T),r.addRootNodes(T),N||r._endRefreshView();var U=r.getPADTreeListView();if(U&&!y.isSearchActive())if("read"!==r.getCurrentModeType()||"read"==r.getCurrentModeType()&&1==widget.getBool("filtered-content"))U.getManager().reapplySortModel();if(r.RefreshProductStructure&&v.length>0){var O=r.getPADTreeListView();r.getPADTreeDocument().refresh({treelist:O,roots:b,cb:function(e){"error"===e.eventID&&h.displayNotification({message:m.refreshError,className:"error"}),r._logger.log("Refresh PS : "+e.msg)}})}P.length>0&&(P.forEach(function(e){e.select()}),n&&"add"===n.insertMode&&r._defaultEnableNameEdit(P[P.length-1]),1===P.length&&"datagridview"===r.getActiveView()&&r.getPADTreeListView().scrollToVisibleNode(P[0])),null!=n&&n.copylink&&0==P.length&&h.displayNotification({message:m.msg_warning_contentnotavailable,className:"warning"}),r.RefreshProductStructure=!1;var M=[];T.forEach(e=>{M.push(e.id||e.getID())}),V.addObjectsTags(M,r._currentMode.areFacetsCalled()),Object.keys(w).length>0&&r.getPADTreeDocument().addTagsForChildren(),"FolderSection_AllFolders"===C&&r.getCurrentMode()===X.authoring&&V.applyFilterIfAny(!1)}R.removeComponentToLoad("global","tree"),r._endLoadAndSelect(),r._endContentSelect()})}).catch(this._manageException.bind(this,e))},updateActiveBookmarkNode:function(e,t){if(_.isCustomizedEnv()||_.isActiveBookmarkActivated()){var o=_.getActiveFolder(),n=o.id,i=o.disabledId;if(!e){var r=this.getPADTreeDocument().getNodesById(i||n);r.length>0&&(e=r[0])}e&&(n===e.id?G(e,"topRight",t?null:a.ICON_ACTIVE):i===e.id&&G(e,"topRight",t?null:a.ICON_ACTIVE_DISABLED))}},_manageException:function(e,t){if(this._logger.log("WebService content, Err : "+(t&&t.stack?t.stack:"unknown")),this._endContentSelect(),this.removeNodesInContent(),t){if(!t.message){var o,n,i,r=t.err,a=t.serverErr,s="error";"timeout"===r.type?(n=m.msg_error_timeout.title,i=m.msg_error_timeout.subtitle,message=m.msg_error_timeout.message):(this._currentMode.manageError&&(o=this._currentMode.manageError(a),s="warning"),o||e&&(e.options.contentAvailable=!1,e.isFavorite?(n=m.msg_error_contentnotavailableInFavorite.Title,i=m.msg_error_contentnotavailableInFavorite.Advice):(n=m.msg_error_contentnotavailable.Title,i=m.msg_error_contentnotavailable.Advice))),t={title:n,subtitle:i,className:s},o&&(t.message=o)}h.displayNotification(t)}this._endLoadAndSelect()},_switchNameToEdit:function(e){try{if("datagridview"===this.getActiveView()){var t=this.getPADTreeListView().getManager(),o=t.layout.getColumnIndex("tree"),n=t.layout.getCellsFromNodeModel(e)[o],i=A.createProbe("scrollTo_folder");t.scrollToCellAt({cellID:n}),i.end();var r=t.getCellInfosAt(n);u._cellToRename={cellInfos:r,context:"CONTENT"},t.setCellInEdition(n)}}catch(e){}},_defaultEnableNameEdit:function(e){setTimeout(function(){this._switchNameToEdit(e)}.bind(this),1e3)},_manageSortForMultiColumns:function(){let e=this.getPADTreeListView();if(e){let o=e.getManager().sortModel;if(y.isSearchActive()&&o&&o.length>1){let t=[];return t.push(o[0]),e.getManager().sortModel=t,!0}var t=l.getContentSortmodel();y.isSearchActive()||o.length===t.length||(e.getManager().sortModel=t)}return!1},loadContentAndSelect:function(e,t,o){if(this.probeUpdateUI=A.createProbe("component_updateUI"),O.setPCSEntry(widget.id+"_FolderContentLoad",!0),!this._manageSortForMultiColumns()){void 0===t&&(t=void 0!==this.nodeToSelectID?this.nodeToSelectID:t),this._handlerThumbnails&&this._handlerThumbnails.cancel(),this._handlerThumbnails=null;var n,i;e||(e=f.getCurrentFolder()),e&&(e.getType&&(n=e.getType()),e.getID&&(i=e.getID()));var r=!1;if("FolderSection_favorite"===n?this._currentMode!==X.favorites&&(this.switchMode("favorites"),r=!0):this._currentMode===X.favorites&&(this.switchMode(),r=!0),!r){"FolderSection_Trash"===n?S.DisplayFolderTrashCont():S.HideFolderTrashCont(),"FolderSection_AllFolders"===n?V.addTagsFromProxy(B):V.deleteTagsFromProxy(B);var a=y.isSearchActive();c.inFamilyFolder(n)&&i||"FolderSection_AllFolders"==n&&!a||"FolderSection_favorite"==n&&!a||"FolderSection_AllFolders"==n&&"FolderSection_AllFolders"==i?this._loadContent(e,t,o):(a&&y.clearSearch(),this.removeNodesInContent(),this.probeUpdateUI.end(),this._endLoadAndSelect())}}},_endLoadAndSelect:function(){R.removeComponentToLoad("contentView","content"),widget.dispatchEvent("onLoadReady");f.getCurrentFolder();var e=this.getPADTreeListView(),t=e?e.getManager():null;if(t&&(y.isSearchActive()||"read"===this.getCurrentModeType()||(this._componentScrollerPosition?t.setScrollerPosition(this._componentScrollerPosition):t.setScrollerPosition({x:0,y:0},!1)),this._componentScrollerPosition=null),void 0!==this.nodeToSelectID){var o=_.getContent().getPADTreeDocument().getNodesById(this.nodeToSelectID)[0];if(null==o)h.displayNotification({message:L.msg_error_BM_LOC_InValid_Object,className:"error"});else{var n=t.layout.getCellsFromNodeModel(o)[0];t.scrollToCellAt({cellID:n}),delete this.nodeToSelectID}}},_endContentSelect:function(){var e=this.getPADTreeListView(),t=e?e.getManager():null;t&&t.infiniteScrollProcessDone(),O.setPCSEntry(widget.id+"_FolderContentLoad",!1),O.sendPCSTracketPageEvent("FolderWidget_Performance","FolderContentLoad",widget.id+"_FolderContentLoad")},_listenEndUIRefreshEvent:function(e){var t=this,o=this.getPADTreeListView();new Promise(function(n,i){if("datagridview"!==t.getActiveView()||0===e.length)n();else{var r=function(){t.removeEvent("onToggleView",r),n()};t.addEvent("onToggleView",r),o&&o.getManager().onPostUpdateViewOnce(function(){if(t._currentMode.supportClientSort&&this.sortModel&&this.sortModel.length>0){var e=this.sortModel[0];e&&(this.sortModel=[{sort:e.sort,dataIndex:e.dataIndex}])}r()})}}).then(function(){t._endRefreshView()})},_endRefreshView:function(){this.dispatchEvent("onCompleteRefreshNodes",f.getCurrentFolder().getID()),this.probeAddNode&&this.probeAddNode.end(),this.probeUpdateUI&&this.probeUpdateUI.end(),this.probeListContent&&this.probeListContent.end()},removeNodeInContent:function(e){var t=this.getPADTreeDocument();t.getRoots().forEach(function(o){(o.id||o.getID())===e&&t.removeRoot(o)}),0===t.getRoots().length&&this._addPlaceHolder()},addDummyRootNodes:function(e){for(var t=[],n=0;n<e.length;n++){var r,a=e[n];if(a instanceof i){a.options.display=a.options.label,G(r=a,"topRight",o.getWebappsAssetUrl("FolderEditor","icons/spinnerBadge.gif"))}else{(r=new i({})).setState({state:"noChildren"}),r.childComputed=!0,r.options.children=null,r.options.label=a.label,r.options.oldLabel=a.label,r.options.display=a.label,r.options.resourceid=a.tempId,r.options.id=a.tempId,r.options.isNotManagedByPS=!0,r.id=a.tempId,r.options.tempId=a.tempId;var s=o.getWebappsAssetUrl("FolderEditor","icons/spinnerBadge.gif");r.options.icons=[{iconPath:"url("+s+")"}]}if(r.plmType="Busy",a instanceof i){r.updateAttributes([],T.getAvailableColumns())}else t.push(r)}this.addRootNodes(t)},updateRootNode:function(e,t){var o=this.getPADTreeDocument();if(e instanceof i){e.plmType="Content",G(e,"topRight",""),e.options.label=e.options.display;e.updateAttributes([],T.getAvailableColumns()),!0===e._isSelected&&f.addInFolderCSO(e,"CONTENT")}else{var n,r=[];o.getRoots().forEach(function(o){o.options.label.indexOf(z(e,"title"))>-1&&o.id===e.tempId&&"Busy"===o.plmType?n=r.concat(o):o.id===e.id&&"Busy"===o.plmType?n=r.concat(o):o.tempId===t&&"Busy"===o.plmType&&(n=r.concat(o))}),n&&n.forEach(function(t){var o={id:e.id,label:z(e,"title"),type:"Document",revision:z(e,"revision"),description:z(e,"description"),modified:z(e,"modified"),created:z(e,"originated"),policy:"",organizationResponsible:"",project:"",responsible:"",locked:"FALSE",locker:"",isLastMinorRevision:"TRUE"};t.id=e.id;var n=l.convertToExaleadDataFormat(o),i=l.convertToArray(n);e.isDownloadable&&(t.options.isDownloadable=!0),e.checkout&&(t.options.checkout=!0),t.options.label=z(e,"title"),t.options.icons=[{iconPath:"url("+g.get3DSpaceUrl()+"/snresources/images/icons/small/I_CDM_Document.png)"}],t.options.thumbnail=g.get3DSpaceUrl()+"/snresources/images/icons/large/I_CDM_Document108x144.png",t.plmType="Content",t.options.resourceid=e.id,t._ischeckout="FALSE",function(e){e.options.icons="string"==typeof e.options.icons[0]?[{iconPath:e.options.icons[0]}]:e.options.icons,e.options.icons[0].badges={},e.updateOptions({icons:e.options.icons})}(t),t.updateAttributes(i,T.getAvailableColumns()),!0===t._isSelected&&f.addInFolderCSO(t,"CONTENT")})}},expandBranches:function(e){if(e<=0)return null;var t=this.getPADTreeDocument(),o={onComplete:function(){if(e.length){var o=e[e.length-1],n=t.getNodesById(o);n&&1===n.length&&n[0].select(!0)}}};if(t.searchRootById(e[0]))t.insertBranches([e],o);else{var n=widget.getBool("filtered-content")?m.msg_warning_notProductRootInFilteredContext:{message:m.msg_warning_notProductRoot};h.displayNotification({...n,className:"warning"})}},switchFolderTreeNodeLabelToWriteView:function(e){var t=!1;return e instanceof r&&c.inFamilyFolder(e.plmType)&&this.getPADTreeDocument()&&e.getTreeDocument()===this.getPADTreeDocument()&&(this._switchNameToEdit(e),t=!0),t},_sortingNodesContent:function(e){var t=this.getPADTreeListView();if(t&&e){var o=t.getManager(),n=o.sortModel;n&&n.length>0?o.reapplySortModel():o.sortModel=[{sort:"asc",dataIndex:"tree"}];var i=o.layout.getCellsFromNodeModel(e)[0];o.scrollToCellAt({cellID:i})}},_ascendingSortingRootNodeByTitle:function(e,t){var o=c.inFamilyFolder(e.plmType),n=c.inFamilyFolder(t.plmType);return o&&!n?-1:!o&&n?1:l.compareLabels(e.options.label,t.options.label)},_addPlaceHolder:function(){var e=this.getActiveView();if("datagridview"!==e){if("tileview"===e){var t=(o=this.getPADTileGridView().options.grid.elements.scroller)?o.getContent():null;t&&this._placeHolder.elements.container.inject(t)}if("thumbnailview"===e){var o,n=(o=this.getPADThumbnailGridView().options.grid.elements.scroller)?o.getContent():null;n&&this._placeHolder.elements.container.inject(n)}}},getGridViewRowHeight:function(){let e=JSON.parse(k).settings.dgvOptions.value.dgvLayout.cellHeight,t=this.getPADTreeListView();return t&&(e=t.getRowHeight()),e},getContentHeight:function(){let e=0;if(document){let t=document.getElementsByClassName("xbook_viewmain");if(t&&t.length>0){let o=t[0].getElementsByClassName("wux-layouts-left-scroller-container");if(o&&o.length>0&&(e=o[0].clientHeight),!e){let o=t[0].getElementsByClassName("wux-layouts-body");o&&o.length>0&&(e=o[0].clientHeight)}}}return e},getComponentWidth:function(){let e=0;if(document){let t=document.getElementsByClassName("xbook_component");t&&t.length>0&&(e=t[0].clientWidth)}return e},getCurrentMode:function(){return this._currentMode},setCurrentMode:function(e){X[e]!==this._currentMode&&V.clearTags(),this._currentMode&&this._currentMode.disable&&this._currentMode.disable(),this._currentMode=X[e],this._currentMode&&this._currentMode.enable&&this._currentMode.enable()},getCurrentModeType:function(){return this._currentMode.getModeType()},getSpecficMode:function(e){return X[e]},processForInfiniteScroll:function(e,t){if(e.reachBottom){var o=this.getCurrentModeType(),n=0;f.getCurrentFolder().getID();if("read"==o&&this._currentMode.isInfiniteScrollingTobeDone()){var i,r=(i=this.getCurrentMode()).getInfoIndex().next_start.split(" ")[0];n=i.getInfoIndex().nhits==r?0:i.getNumberLastResult()}if("search"==o)n=(i=this.getCurrentMode()).getNumberLastResult();n>0&&this.loadContentAndSelect()}t.infiniteScrollProcessDone()}});return J});