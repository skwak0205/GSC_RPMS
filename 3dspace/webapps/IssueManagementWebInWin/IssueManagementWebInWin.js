define("DS/IssueManagementWebInWin/MfgIssueManagement",["DS/IssueManagement/IssueManagement","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/PlatformAPI/PlatformAPI","DS/IssueServices/Contexts"],function(e,t,s,n){"use strict";var a=null,i={SELECT_IN_3D:"SELECT_IN_3D",ADD_OBJECTS:"ADD_OBJECTS",TAKE_SCREENSHOT:"TAKE_SCREENSHOT"},o="ENXISSU_RC",r=/[/\\?%*:|"<>]/g,d=function(){dscef.sendString("Refresh=")},c={_tasks:{subscriberTokens:[],current:null},InitWebInWin:function(t){a=t;var s={};c._getWebInWinParameters(function(t){s=t||null,c._populate3DSpaceURL(s).then(function(t){var s=e.prototype.onResize;e.prototype.onResize=function(){var e=this;setTimeout(function(){s.call(e)},0)};new e({standalone:!0})},function(e){return console.log("Populate 3DSpace URL failed"),Promise.reject(e)})})},_getWebInWinParameters:function(e){window.COMPASS_CONFIG&&window.COMPASS_CONFIG.myAppsBaseUrl?e(window.COMPASS_CONFIG):c._getAppsUrl(function(t){window.COMPASS_CONFIG||(window.COMPASS_CONFIG={}),t&&(window.COMPASS_CONFIG.myAppsBaseUrl=t,window.COMPASS_CONFIG.userId||(window.COMPASS_CONFIG.userId=a),window.COMPASS_CONFIG.lang||(window.COMPASS_CONFIG.lang=widget.lang)),e(window.COMPASS_CONFIG)})},_getAppsUrl:function(e){"function"==typeof dscef.getMyAppsURL?dscef.getMyAppsURL().then(function(t){console.log("MyApps URL",t),e.call(null,t)}).catch(function(t){console.error("Failed to fetch MyApps URL: "+t),e.call(null,null)}):e.call(null,null)},_populate3DSpaceURL:function(e){return new Promise(function(s,n){var a=null;e&&((a={}).myAppsBaseUrl=e.myAppsBaseUrl,a.userId=e.userId,a.lang=e.lang),t.getPlatformServices({config:a,onComplete:function(e){for(var t=0;t<e.length;t++)console.log("platformId",e[t].platformId),console.log("3DSpace",e[t]["3DSpace"]),console.log("3DSearch",e[t]["3DSearch"]);s()},onFailure:n})})},subscribeToTasks:function(){var e=this;e._tasks.subscriberTokens.push(s.subscribe("DS/IssueManagementTask/add",function(e){var t=e.data.paths[0][0],n=e.data.attributes[t];if(-1!==Object.keys(i).indexOf(n.taskType)){var a=[],o={};a.push([t]),o[t]={taskType:n.taskType,widgetIdIM:n.widgetIdIM,widgetId3D:widget.id},s.publish("DS/IssueManagementTask/ready",{metadata:{appId:widget.id,appName:widget.name,timestamp:Math.floor(Date.now()),options:{}},data:{paths:a,attributes:o},version:"1.0"})}})),e._tasks.subscriberTokens.push(s.subscribe("DS/IssueManagementTask/exec",function(t){var s=t.data.paths[0][0],n=t.data.attributes[s];if(-1!==Object.keys(i).indexOf(n.taskType))switch(e._tasks.current={taskId:s,taskType:n.taskType,widgetIdIM:n.widgetIdIM,widgetId3D:widget.id},n.taskType){case i.SELECT_IN_3D:console.log("Executing Select in 3D, We have to call C++ from here"),dscef.sendString("SelectFrom3D=1");break;case i.ADD_OBJECTS:console.log("Executing Select From Search, We have to call C++ from here"),dscef.sendString("SelectFromSearch=1");break;case i.TAKE_SCREENSHOT:console.log("Executing Take Snapshot, We have to call C++ from here"),dscef.sendString("TakeScreenShot=1")}})),e._tasks.subscriberTokens.push(s.subscribe("DS/IssueManagementTask/cancel",function(t){console.log("Cancel Task triggered"),dscef.sendString("TaskCancelled=1");var s=n.get("component");null!==s&&s.unmaskForTask(e._tasks.current),e._tasks.current=null})),e._tasks.subscriberTokens.push(s.subscribe("DS/Object/select",function(t){if(t.metadata&&t.metadata.appName!==o&&t.data&&t.data.paths){var s="";t.data.paths.forEach(function(e){1==e.length&&(s+=e[0]+";")}),dscef.sendString("ObjectSelect="+s);var a=n.get("component");null!==a&&a.unmaskForTask(e._tasks.current),e._tasks.current=null}})),e._tasks.subscriberTokens.push(s.subscribe("DS/Object/delete",function(t){if(t.metadata&&t.metadata.appName!==o&&t.data&&t.data.paths){var s="";t.data.paths.forEach(function(e){1==e.length&&(s+=e[0]+";")}),dscef.sendString("ObjectDelete="+s);var a=n.get("component");null!==a&&a.unmaskForTask(e._tasks.current),e._tasks.current=null}})),e._tasks.subscriberTokens.push(s.subscribe("DS/Object/create",d)),e._tasks.subscriberTokens.push(s.subscribe("DS/Object/update",d))},SetSecurityContextAndTenant:function(e){e.tenantID&&widget.setValue("x3dPlatformId",e.tenantID),e.securityContext&&widget.setValue("securityContext","ctx::"+e.securityContext)},SelectFrom3DDone:function(e){var t=[],n={},a={nodes:[]};a.nodes.push("node"),a.paths=e;var i={};i[e]={x:0,y:0,z:0,balloons:[]},t.push([this._tasks.current.taskId]),n[this._tasks.current.taskId]={taskType:this._tasks.current.taskType,widgetIdIM:this._tasks.current.widgetIdIM,widgetId3D:this._tasks.current.widgetId3D,response:{target:e,positions:i,nodes:a}},s.publish("DS/IssueManagementTask/done",{metadata:{appId:widget.id,appName:widget.name,timestamp:Math.floor(Date.now()),options:{}},data:{paths:t,attributes:n},version:"1.0"})},SelectFromSearchDone:function(e){for(var t=e.split(","),n=[],a=0;a<t.length;a++)n.push(t[a]);var i=[],o={};i.push([this._tasks.current.taskId]),o[this._tasks.current.taskId]={taskType:this._tasks.current.taskType,widgetIdIM:this._tasks.current.widgetIdIM,widgetId3D:this._tasks.current.widgetId3D,response:{physicalIds:n}},s.publish("DS/IssueManagementTask/done",{metadata:{appId:widget.id,appName:widget.name,timestamp:Math.floor(Date.now()),options:{}},data:{paths:i,attributes:o},version:"1.0"})},ScreenShotCaptured:function(e){var t=e,n=(new Date).toLocaleString(),a="screenshot_"+(n=n.replace(r,"-"))+".png",i=Date.now(),o=[],d={};o.push([this._tasks.current.taskId]),d[this._tasks.current.taskId]={taskType:this._tasks.current.taskType,widgetIdIM:this._tasks.current.widgetIdIM,widgetId3D:this._tasks.current.widgetId3D,response:{data:t,fileName:a,fileType:"image/png",lastModified:i}},s.publish("DS/IssueManagementTask/done",{metadata:{appId:widget.id,appName:widget.name,timestamp:Math.floor(Date.now()),options:{}},data:{paths:o,attributes:d},version:"1.0"})},SelectIssues:function(e){var t={},n=[];e.forEach(function(e){n.push([e]),t[e]={id:e,type:"Issue"}});var a={metadata:{appName:o},data:{paths:n,attributes:t},version:"1.0"};s.publish("DS/Object/select",a)}};return c}),define("DS/IssueManagementWebInWin/ENOIssueGenerationPanel",["UWA/Core","UWA/Class","DS/IssueServices/services/PlatformServices","DS/IssueServices/Contexts","DS/IssueComponents/create/Create","DS/PlatformAPI/PlatformAPI"],function(e,t,s,n,a,i){"use strict";return t.extend({init:function(o){s.initPlatformServices().then(function(){var r,d,c,l;(r=o.contexts?o.contexts.map(function(e){return{physicalId:e}}):[],d=o.reportedAgainst?o.reportedAgainst.map(function(e){return{physicalId:e,automation:{assignee:!o.assignees}}}):[],c=o.attachments?o.attachments:[],l={id:"Ext_GenereateIssue",info:{description:null,name:null},ui:{assignees:[],responsibleOrganization:s.getCurrentCredentials().organization},data:{title:o.title,description:o.description,priority:void 0===o.priority?"Low":o.priority,resolutionDate:Date.now(),reportedAgainst:d,contexts:r,assignees:[],attachments:c,automationTasks:[],responsibleOrganization:s.getCurrentCredentials().organization,reportingOrganization:s.getCurrentCredentials().organization}},new Promise(function(t){if(o.assignees&&o.assignees.length>=1){var n=[],a=o.assignees.length;o.assignees.forEach(function(i){s.getUserInfo(i,{onComplete:function(s){var i=JSON.parse(s);l.data.assignees.push(i.name),n.push({user:i.name,fullName:i.firstname+" "+i.lastname,organization:i.company.name}),0==--a&&(l.ui.assignees=e.merge({},n),t())},onFailure:function(){0==--a&&t()}})})}else t()}).then(function(){return l})).then(function(e){n.add("widget",window.widget),n.get("widget").name="ENOIssueGenerationPanel";var s=new a(window.widget.body,{escapeToClose:!1,resizable:!1});s.render(),s.isLoaded.finally(function(){var n;s.applyTemplate(e),(n=s).getDialog().addEvent("onResizeFloating",function(){var e=n.getDialog().elements.container.getSize();e.width===window.widget.body.getSize().width&&e.height===window.widget.body.getSize().height||(n.getDialog().setNewBodySize(window.widget.body.getSize()),n.getDialog().centerIt())}),(new t.Listener).listenToOnce(n,"onCreateDialogClose",function(){window.dscef.sendString(JSON.stringify({action:"closePanel"}))}),i.subscribe("DS/Object/create",function(){window.dscef.sendString(JSON.stringify({action:"displayNotif",notifMsg:"IssueSuccess"}))}),function(e){"attachments"in e.views&&(e.views.attachments.view.fields.attachments.iconBar.disableItem("attachFrom3DX"),e.views.attachments.view.fields.attachments.iconBar.disableItem("screenshot")),"related"in e.views&&(e.views.related.view.fields.reportedAgainst.iconBar.getItem("location").elements.container.addClassName("disabled"),e.views.related.view.fields.contexts.iconBar.getItem("location").elements.container.addClassName("disabled"),e.views.related.view.fields.reportedAgainst.iconBar.getItem("addReported").elements.container.addClassName("disabled"),e.views.related.view.fields.contexts.iconBar.getItem("addContext").elements.container.addClassName("disabled")),e.getDialog().options.limitParent=!0,e.getDialog().setNewBodySize(window.widget.body.getSize()),document.getElementsByClassName("floatingPanel_RightButtons")[0]&&document.getElementsByClassName("floatingPanel_RightButtons")[0].setStyle("display","none"),document.getElementsByClassName("isu-am-catalog-placeholder-button btn-primary btn btn-root")[0]&&document.getElementsByClassName("isu-am-catalog-placeholder-button btn-primary btn btn-root")[0].setStyle("display","none")}(s)})})})}})}),define("DS/IssueManagementWebInWin/ENOIssueGenerationWebPanel",["UWA/Core","UWA/Class","DS/IssueServices/services/PlatformServices","DS/IssueComponents/create/Create"],function(e,t,s,n){"use strict";return t.extend({init:function(a,i){var o,r,d,c,l=a,u=null,g=i||a.data,p=a.onClose,m=l.htmlContainer||window.widget.body;this.hide=this.hideIssuePanel=function(){u&&u.getDialog().hide()},this.show=this.showIssuePanel=function(){u&&u.getDialog().show()},this.destroy=this.destroyIssuePanel=function(){u&&u.getDialog().destroy()},(o=g.contexts?g.contexts.map(function(e){return{physicalId:e}}):[],r=g.reportedAgainst?g.reportedAgainst.map(function(e){return{physicalId:e,automation:{assignee:!g.assignees}}}):[],d=g.attachments?g.attachments:[],c={id:"Ext_GenereateIssue",data:{title:g.title,description:g.description,priority:g.priority,reportedAgainst:r,contexts:o,assignees:g.assignees,attachments:d}},new Promise(function(t){if(g.assignees&&g.assignees.length>0){var n=[],a=g.assignees.length;c.ui={assignees:[]},g.assignees.forEach(function(i){s.getUserInfo(i,{onComplete:function(s){var i=JSON.parse(s);c.data.assignees.push(i.name),n.push({user:i.name,fullName:i.firstname+" "+i.lastname,organization:i.company.name}),0==--a&&(c.ui.assignees=e.merge({},n),t())},onFailure:function(){0==--a&&t()}})})}else t()}).then(function(){return c})).then(function(e){(u=new n(m,{escapeToClose:!1,resizable:!0})).render(),u.isLoaded.finally(function(){var s;u.applyTemplate(e),s=u,(new t.Listener).listenToOnce(s,"onCreateDialogClose",function(){p?p():l.end()}),function(e){"attachments"in e.views&&e.views.attachments.view.fields.attachments.iconBar.disableItem("screenshot"),"related"in e.views&&(e.views.related.view.fields.reportedAgainst.iconBar.getItem("location").elements.container.addClassName("disabled"),e.views.related.view.fields.contexts.iconBar.getItem("location").elements.container.addClassName("disabled")),e.getDialog().options.limitParent=!0}(u)})})}})});