define("DS/RTwebrtcAPI/js/RTEmbeddedStartCallUserView",["UWA/Class","UWA/Class/View","DS/RTPresenceAPI/RTPresenceAPI","DS/UIKIT/Tooltip","css!RTwebrtcAPI/RTwebrtcAPI.css"],function(e,t,n,i){"use strict";return t.extend({tagName:"div",className:"RTEmbeddedStartCallUserView",setup:function(e){this.listenTo(this.model,"onChange:username",this.changeUsername)},render:function(){this.container.setContent([{class:"RTEmbeddedStartCallUserView_presence",tag:"div",id:"RTEmbeddedStartCallUserView_presence_"+this.model.cid},{class:"RTEmbeddedStartCallUserView_username",tag:"div",id:"RTEmbeddedStartCallUserView_username_"+this.model.cid,text:this.model.get("username")}]),this.statusIcon=new n({username:this.model.get("username"),userId:this.model.get("login"),tenant:this.model.get("tenant"),clickable:!1,button:!1,content:this.container.children["RTEmbeddedStartCallUserView_presence_"+this.model.cid],callbacks:{onPresenceChanged:this.presenceListenerFactory(this)}}),this.statusIcon.getStatus()},changeUsername:function(e,t){this.container.children["RTEmbeddedStartCallUserView_username_"+e.cid].innerText=e.get("username")},presenceListenerFactory:function(e){return function(t,n){e.model.set({presence:t})}}})}),define("DS/RTwebrtcAPI/js/RTEmbeddedStartCallComponentModel",["UWA/Class","UWA/Class/Model","i18n!DS/RTwebrtcAPI/assets/nls/feed"],function(e,t,n){"use strict";return t.extend({urlRoot:"/startCall",defaults:{state:"disconnected",orderId:"Print Order",login:"unknown",presence:"Online"},setConnected:function(){this.set({state:"connected"})},setDisconnected:function(){this.set({state:"disconnected"})},setOncall:function(){this.set({state:"oncall"})}})}),define("DS/RTwebrtcAPI/js/RTEmbeddedStartCallUserModel",["UWA/Class","UWA/Class/Model","i18n!DS/RTwebrtcAPI/assets/nls/feed"],function(e,t,n){"use strict";return t.extend({defaults:{username:"Louis Aragon",presence:"Offline",login:"pne1",tenant:"dsdev"},setup:function(e){e&&!e.username&&(e.displayname?this.set({username:e.displayname}):this.set({username:e.login+" "+e.login}))}})}),define("DS/RTwebrtcAPI/js/RTEmbeddedStartCallComponentView",["UWA/Class","UWA/Class/View","DS/UIKIT/Input/Button","DS/UIKIT/DropdownMenu","i18n!DS/RTwebrtcAPI/assets/nls/feed","DS/RTwebrtcAPI/js/RTEmbeddedStartCallUserView","DS/RTwebrtcAPI/js/RTEmbeddedStartCallUserModel","css!RTwebrtcAPI/RTwebrtcAPI.css"],function(e,t,n,i,o,s,r){"use strict";return t.extend({findDropdownItemByLogin:function(e){if(!this.contactList)return!1;if(this.contactList.items.find)return this.contactList.items.find(function(t){return t.name===e});for(var t=0;t<this.contactList.items.length;t++)if(this.contactList.items[t].name===e)return this.contactList.items[t]},addMessageToList:function(e){this.contactList.addItem({className:"notOnline",text:e})},addContactToList:function(e){if(!e instanceof r)return UWA.log("RTWebRTCAPI RTEmbeddedStartCallComponentView addContact bad format","error");var t=new s({model:e});if(t.render(),!this.contactList)return!0;this.contactList.addItem({className:"Online"==e.get("presence")?"":"notOnline",name:t.model.get("login"),text:t.model.get("username")}),this.contactList.items[this.contactList.items.length-1].elements.content.setContent(t.getContent()),this.updateSelectability(e,e.get("presence"))},removeContactFromList:function(e){if(!e instanceof r||!e.login)return UWA.log("RTWebRTCAPI RTEmbeddedStartCallComponentView removeContact bad format","error");if(!this.contactList)return!0;var t=this.findDropdownItemByLogin(e.login);return t?this.contactList.removeItem(t.id):UWA.log("removeContact contact "+e.login+" not found","error")},updateSelectability:function(e,t){var n=this.findDropdownItemByLogin(e.get("login"));if(!n)return!1;n.presence=t,"Online"==t?n.elements.container.removeClassName("notOnline"):n.elements.container.addClassName("notOnline"),this.contactList.getBody().getElementsByClassName("notOnline").length==this.contactList.items.length?this.setActive(!0):this.setActive()},setActive:function(e){e?this.container.children["RTEmbeddedStartCallComponentView_"+this.model.cid].children["RTEmbeddedStartCallComponentViewPhone_"+this.model.cid].classList.remove("RTEmbeddedwebrtc_icon_active"):this.container.children["RTEmbeddedStartCallComponentView_"+this.model.cid].children["RTEmbeddedStartCallComponentViewPhone_"+this.model.cid].classList.add("RTEmbeddedwebrtc_icon_active")},phoneIconListener:function(e){var t;return t=this,function(n){return function(t,n){if(e&&n.contactList.isVisible)return n.container.children["RTEmbeddedStartCallComponentView_"+n.model.cid].click();n.contactList.isVisible||n.container.children["RTEmbeddedStartCallComponentView_"+n.model.cid].click(),n.container.children["RTEmbeddedStartCallComponentView_"+n.model.cid].getDimensions();var i=n.container.children["RTEmbeddedStartCallComponentView_"+n.model.cid].getClientRects()[0].top-2,o=n.container.children["RTEmbeddedStartCallComponentView_"+n.model.cid].getClientRects()[0].left+50;document.body.clientWidth<o+n.contactList.getContent().getDimensions().width&&(o=document.body.clientWidth-n.contactList.getContent().getDimensions().width,i+=40),n.contactList.getContent().setPosition({x:o,y:i})}(0,t)}},render:function(e){var t;this.container.setContent([{tagname:"div",id:"RTEmbeddedStartCallComponentView_"+this.model.cid,class:"RTEmbeddedStartCallComponentView",html:[{id:"RTEmbeddedStartCallComponentViewPhone_"+this.model.cid,tag:"span",class:"RTEmbeddedwebrtc_icon fonticon handler",html:'<svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"  x="0px" y="0px" viewBox="0 0 20 20" enable-background="new 0 0 20 20" xml:space="preserve"><path xmlns="http://www.w3.org/2000/svg" d="m 8.768474,11.230366 c -1.582,-1.5830005 -3.096,-3.4170005 -2.371,-4.1420005 1.037,-1.037 1.941,-1.677 0.102,-3.965 -1.838,-2.28699995 -3.064,-0.53 -4.068,0.475 -1.16,1.16 -0.062,5.484 4.211,9.7580005 4.274001,4.273 8.598001,5.368 9.758001,4.207 1.006,-1.005 2.762,-2.225 0.475,-4.063 -2.287,-1.839 -2.927,-0.936 -3.965,0.103 -0.725,0.722 -2.559,-0.791 -4.142001,-2.373 z" id="path4571"/><path xmlns="http://www.w3.org/2000/svg" d="m 8.768474,11.230366 c -1.582,-1.5830005 -3.096,-3.4170005 -2.371,-4.1420005 1.037,-1.037 1.941,-1.677 0.102,-3.965 -1.838,-2.28699995 -3.064,-0.53 -4.068,0.475 -1.16,1.16 -0.062,5.484 4.211,9.7580005 4.274001,4.273 8.598001,5.368 9.758001,4.207 1.006,-1.005 2.762,-2.225 0.475,-4.063 -2.287,-1.839 -2.927,-0.936 -3.965,0.103 -0.725,0.722 -2.559,-0.791 -4.142001,-2.373 z" id="path4571"/></svg>',events:{click:this.phoneIconListener(),mouseenter:this.phoneIconListener()}}]}]),this.contactList=new i({target:this.container.children["RTEmbeddedStartCallComponentView_"+this.model.cid],className:"RTEmbeddedStartCallComponentViewDropDown",multiSelect:!1,position:"bottom right",closeOnClick:!0,handler:function(){console.log("lol")},items:[],events:{onClick:(t=this,function(e,n){t.dispatchEvent("contactClicked",{login:n.name,presence:n.presence,username:n.text})})}}),e&&this.addMessageToList(o.notCompatible)},onSelfPresence:function(e,t){},setup:function(){this.listenTo(this.model,"onChange:presence",this.onSelfPresence)}})}),define("DS/RTwebrtcAPI/js/RTEmbeddedStartCallComponentController",["UWA/Class","UWA/Class/Collection","UWA/Class/Events","DS/RTwebrtcAPI/js/RTEmbeddedStartCallUserModel","DS/RTwebrtcAPI/js/RTEmbeddedStartCallComponentView","DS/RTwebrtcAPI/js/RTEmbeddedStartCallComponentModel"],function(e,t,n,i,o,s){"use strict";return n.extend({init:function(e){if(this.startCall=e.startCall||UWA.log,this.model=new s(e),this.view=new o({model:this.model}),this.notCompatible=!1,this.contacts=new t([],{url:"/RTEmbeddedStartCallContacts",model:i}),-1!==navigator.userAgent.indexOf("MSIE")||navigator.appVersion.indexOf("Trident/")>0||-1!=navigator.platform.indexOf("iPhone")||-1!=navigator.platform.indexOf("iPod")||-1!=navigator.platform.indexOf("iPad"))return this.notCompatible=!0,!0;this.contacts.addEvents({onAdd:this.view.addContactToList,onRemove:this.view.removeContactFromList,"onChange:presence":this.view.updateSelectability},this.view),this.view.addEvent("contactClicked",function(e){e.orderId=this.model.get("orderId"),UWA.log("RTwebrtcAPI launch call to "+e.login+" (presence = "+e.presence+") for order "+e.orderId),"Online"!=e.presence?UWA.log("RTwebrtcAPI won't launch a call to a user who is not Online"):"Online"!=this.model.get("presence")?UWA.log("RTwebrtcAPI won't launch a call from a user who is not Online"):this.startCall(e)},this)},updateSelf:function(e){e.presence&&this.model.set({presence:e.presence}),e.login&&this.model.set({login:e.login})},findContactByLogin:function(e){return this.contacts.findWhere({login:e})},addContact:function(e){return e.login?this.findContactByLogin(e.login)?UWA.log("RTWebRTCAPI tried to add a contact who already exists."):void this.contacts.add(new i(e)):UWA.log("RTWebRTCAPI addContact login is missing.","error")},removeContact:function(e){if(!e)return UWA.log("RTWebRTCAPI removeContact login is missing.","error");var t=this.findContactByLogin(e);if(!t)return UWA.log("RTWebRTCAPI tried to remove a contact who already unexists.");t.login=e,this.contacts.remove(t)},renderTo:function(e){this.view.render(this.notCompatible),this.view.inject(e||document.body),this.notCompatible||this.contacts.forEach(function(e){this.view.addContactToList(e)},this)}})}),define("DS/RTwebrtcAPI/RTwebrtcAPI",["UWA/Class","UWA/Class/Events","DS/PlatformAPI/PlatformAPI","DS/RTwebrtcAPI/js/RTEmbeddedStartCallComponentController"],function(e,t,n,i){"use strict";return e.extend(t,{init:function(e){if(!e)e={};var t;if(e.startCall=function(e){e.action="startCall",e.type=e.type||"audio",n.publish("im.ds.com",e)},this.component=new i(e),this.platformListenner=(t=this,function(e){switch(e.action){case"setStatus":if(!(e&&e.login&&e.presence&&e.login==t.login))return null;t.component.updateSelf({presence:e.presence});break;case"youare":if(!e.login||!e.userId)return UWA.log("RTwebrtcAPI received event 'youare' without login|userId","error");t.login=e.login,t.userId=e.userId,t.component.updateSelf({login:e.login}),n.publish("im.ds.com",{action:"getStatus",login:e.login}),n.subscribe(e.userId,function(e){switch(e.action){case"setStatus":e&&e.login&&e.presence&&e.login==t.login&&t.component.updateSelf({presence:e.presence})}})}}),n.publish("im.ds.com",{action:"whoami"}),n.subscribe("im.ds.com",this.platformListenner),e&&e.users)for(var o in e.users)this.component.addContact(e.users[o])},renderTo:function(e){this.component.renderTo(e)},addContact:function(e){this.component.addContact(e)},removeContact:function(e){this.component.removeContact(e.login||e)}})});