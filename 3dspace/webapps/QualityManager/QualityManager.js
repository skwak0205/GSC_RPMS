!function(){var e=["UWA/Core","UWA/Class"];"file:"!==window.location.protocol&&e.push("text!DS/QualityManager/assets/mdl_GIVisualQualityPresets.json"),define("DS/QualityManager/QMGIPresetStreamer",e,function(e,t,r){"use strict";return t.singleton({init:function(){this.GIQualityPresets=this.getQualityPresets(),e.is(this.GIQualityPresets)},setItem:function(t,r){if(e.is(localStorage)&&e.is(this.GIQualityPresets))for(var i=this.GIQualityPresets,s=t.split("/"),a=s.length,o=0;o<a;o++)o==a-1?e.is(i)&&(i[s[o]]=r):e.is(i)&&(i=i[s[o]])},getItem:function(t){if(!e.is(localStorage)||!e.is(this.GIQualityPresets))return null;for(var r=this.GIQualityPresets,i=t.split("/"),s=i.length,a=0;a<s;a++)e.is(r)&&(r=r[i[a]]);return r},getQualityPresets:function(){var t=null;if(!e.is(localStorage))return t;var r=localStorage.getItem("GIQualityPresets");if(e.is(r))try{t=JSON.parse(r)}catch(e){console.error("Error parsing GIQualityPresets:",e)}else t=this.buidQualityPresets();return t},commit:function(){e.is(localStorage)&&e.is(this.GIQualityPresets)&&localStorage.setItem("GIQualityPresets",JSON.stringify(this.GIQualityPresets))},retoreDB:function(){this.GIQualityPresets=this.getQualityPresets()},buidQualityPresets:function(){return this.GIQualityPresets=r?JSON.parse(r):null,e.is(this.GIQualityPresets)&&this.commit(),this.GIQualityPresets}})})}(),function(){var e=["UWA/Core","UWA/Class"];"file:"!==window.location.protocol&&e.push("text!DS/QualityManager/assets/mdl_QualityManagerPreset.json"),define("DS/QualityManager/QMPresetStreamer",e,function(e,t,r){"use strict";return t.singleton({init:function(){this.databaseKey=null,this.qualityPresets=null},initDataBase:function(t){this.databaseKey=t,null==this.databaseKey&&(this.databaseKey="default_qualityPresets"),this.qualityPresets=this.getQualityPresets(),e.is(this.qualityPresets)},setItem:function(t,r){if(e.is(localStorage)&&e.is(this.qualityPresets))for(var i=this.qualityPresets,s=t.split("/"),a=s.length,o=0;o<a;o++)o==a-1?e.is(i)&&(i[s[o]]=r):e.is(i)&&(i=i[s[o]])},_addItem:function(t,r){if(e.is(localStorage)&&e.is(this.qualityPresets))for(var i=this.qualityPresets,s=t.split("/"),a=s.length,o=0;o<a;o++)o==a-1?(e.is(i[s[o]])||(i[s[o]]={}),i[s[o]]=r):(e.is(i[s[o]])||(i[s[o]]={}),i=i[s[o]])},_removeItem:function(t){if(e.is(localStorage)&&e.is(this.qualityPresets))for(var r=this.qualityPresets,i=t.split("/"),s=i.length,a=0;a<s;a++)if(a==s-1){if(!e.is(r[i[a]]))break;delete r[i[a]]}else{if(!e.is(r[i[a]]))break;r=r[i[a]]}},getItem:function(t){if(!e.is(localStorage)||!e.is(this.qualityPresets))return null;for(var r=this.qualityPresets,i=t.split("/"),s=i.length,a=0;a<s;a++)e.is(r)&&(r=r[i[a]]);return r},getQualityPresets:function(){var t=null;if(!e.is(localStorage))return t;var r=localStorage.getItem(this.databaseKey);if(e.is(r))try{t=JSON.parse(r)}catch(e){console.error("Error parsing qualityPresets:",e)}else t=this.buidQualityPresets();return t},commit:function(){e.is(localStorage)&&e.is(this.qualityPresets)&&localStorage.setItem(this.databaseKey,JSON.stringify(this.qualityPresets))},retoreDB:function(){this.qualityPresets=this.getQualityPresets()},buidQualityPresets:function(){return this.qualityPresets=r?JSON.parse(r):null,e.is(this.qualityPresets)&&this.commit(),this.qualityPresets}})})}(),define("DS/QualityManager/GPULists",["DS/Mesh/ThreeJS_Base"],function(e){"use strict";var t=["Google SwiftShader","Microsoft Basic Render","WebVisu Profile No GPU"],r=["Quadro 400","Quadro 410","Quadro 500M","Quadro 600","Quadro 1000M","Quadro 2000","Quadro 2000M","Quadro M600M","Quadro M620","Quadro M500M","Quadro M520","Quadro K600","Quadro K420","Quadro K600","Quadro K610M","Quadro K1000M","Quadro P400","Quadro P500","GeForce GTX 750","GeForce GTX 750 Ti","GeForce GTX 760","GeForce GTX 775M","GeForce GTX 780M","GeForce GTX 950","GeForce GTX 950M","GeForce GTX 960M","GeForce GTX 965M","GeForce GTX 970M","GeForce GTX 1050","GeForce GTX 1050 Ti","GeForce GTX 1650","GeForce GTX 1650 SUPER","GeForce GTX 1650 Super","GeForce GTX 1650 Ti","Graphics 530","Graphics P530","Graphics 630","Graphics P630","Graphics 730","WebVisu Profile Very Low","WebVisu Profile Unknown"],i=["Quadro 3000M","Quadro 4000","Quadro 4000M","Quadro 5000","Quadro 5000M","Quadro 5010M","Quadro 6000","Quadro K620","Quadro K620M","Quadro K1200","Quadro K2000","Quadro K2000M","Quadro K2200","Quadro K2100M","Quadro K2200M","Quadro K3000M","Quadro K1100M","Quadro M1000","Quadro M1000M","Quadro M1200","Quadro M1200M","Quadro M2000","Quadro M2000M","Quadro M2200","Quadro P520","Quadro P600","Quadro P620","Quadro P1000","Quadro P1200","Quadro P2000","Quadro P2200","Quadro T400","Quadro T600","Quadro T1000","GeForce GTX 770","GeForce GTX 880","GeForce GTX 780","GeForce GTX 960","GeForce GTX 970","GeForce GTX 980M","GeForce GTX 1060","GeForce GTX 1060 SUPER","GeForce GTX 1060 Super","GeForce GTX 1070","GeForce GTX 1650","GeForce GTX 1650 SUPER","GeForce GTX 1650 Super","GeForce GTX 1650 Ti","GeForce GTX 1660","GeForce GTX 1660 SUPER","GeForce GTX 1660 Super","GeForce GTX 2050","GeForce GTX 2050 Ti","GeForce RTX 2060","GeForce RTX 3050","FirePro M5950","FirePro V4900","FirePro V3900","FirePro V4800","FirePro W4170M","FirePro M4100","FirePro W2100","Pro WX 3100","Pro WX 2100","Pro WX 4150","Pro 5300M","Pro 5500M","Pro 555X","Pro 560","Pro 560X","Mobility Radeon WX 4130","Mobility Radeon WX 4150","RX 470","RX 480","RX 480X","RX 570","RX 570X","RX 5300","RX 5300 XT","RX 5500","RX 5500 XT","RX 5600","Graphics 540","Graphics 550","Graphics 580","Graphics P555","Graphics P580","Graphics 640","Graphics 645","Graphics 650","Graphics 655","Graphics 750","UHD Graphics Direct3D11","Iris(R) Plus Graphics","Iris(TM) Plus Graphics","Xe Graphics","Adreno (TM) 540","Adreno (TM) 630","Mali-G57","Mali-G68","Mali-G72","Adreno (TM) 640","Adreno (TM) 642","Adreno (TM) 650","Adreno (TM) 660","Adreno (TM) 675","Adreno (TM) 680","Adreno (TM) 685","Mali-G76","Mali-G77","Mali-G78","WebVisu Profile Low"],s=["Quadro K3100M","Quadro K4000","Quadro K4000M","Quadro K4100M","Quadro K4200","Quadro K5000M","Quadro K5100M","Quadro K5200","Quadro K6000","Quadro M3000M","Quadro P3000","Quadro T2000","Quadro RTX 3000","Quadro RTX A2000","Quadro RTX A3000","FirePro V8800","FirePro V7800","FirePro V7900","FirePro W7000","FirePro M8900","FirePro V5800","FirePro M7820","FirePro W5100","FirePro M6100","FirePro W4300","FirePro W4000","FirePro W5170M","FirePro M6000","FirePro M5100","FirePro W4100","FirePro W5130M","FirePro M4000","FirePro V5900","Pro WX 5100","Pro WX 4100","Quadro M4000M","Quadro M5000M","Quadro P3200","Quadro T2000","Quadro RTX 3000","GeForce GTX 780 Ti","GeForce GTX 880 Ti","GeForce RTX 980","GeForce RTX 980 Ti","GeForce GTX 1070 Ti","GeForce RTX 1080","GeForce GTX 1660 Ti","GeForce RTX 2060 SUPER","GeForce RTX 2060 Super","GeForce RTX 2070","GeForce RTX 2070 SUPER","GeForce RTX 2070 Super","GeForce RTX 3050 Ti","GeForce RTX 3060","GeForce RTX 3060 Ti","RX 490","RX 490X","RX 580","RX 580X","RX 590","RX Vega 56","RX Vega 64","RX 5600 XT","RX 5700","RX 5700 XT","RX 5800","RX 5800 XT","RX 5900","RX 6600","RX 6600 XT","RX 6700","RX 6700 XT","RX 6800","WebVisu Profile Medium"],a=["Quadro K5000","Quadro M4000","Quadro M5000","Quadro M6000","Quadro P4000","Quadro P4200","Quadro P5000","Quadro P5200","Quadro P6000","GRID K2","Quadro GP100","Quadro GV100","Quadro RTX 4000","Quadro RTX 5000","Quadro RTX 6000","Quadro RTX 8000","Quadro RTX A4000","Quadro RTX A4500","Quadro RTX A5000","Quadro RTX A5500","Quadro RTX A6000","GeForce RTX 1080 Ti","GeForce GTX TITAN","GeForce RTX 2080","GeForce RTX 2080 Ti","GeForce RTX 2080 SUPER","GeForce RTX 2080 Super","GeForce RTX 3070","GeForce RTX 3070 Ti","GeForce RTX 3080","GeForce RTX 3080 Ti","GeForce RTX 3090","GeForce RTX 4080","GeForce RTX 4080 Ti","GeForce RTX 4090","FirePro W9100","FirePro W8100","FirePro W9000","FirePro W7170M","FirePro W8000","FirePro W7100","Mobility Radeon WX 7100","Pro WX 7100","VII","RX 5900 XT","RX 5950","RX 5950 XT","RX 6800 XT","RX 6900","RX 6900 XT","WebVisu Profile High"],o=["WebVisu Profile Ultra"],n=[{value:o,preset:"Ultra",unknownOrVeryLow:!1},{value:a,preset:"High",unknownOrVeryLow:!1},{value:s,preset:"Medium",unknownOrVeryLow:!1},{value:i,preset:"Low",unknownOrVeryLow:!1},{value:r,preset:"Low",unknownOrVeryLow:!0},{value:t,preset:"Low",unknownOrVeryLow:!0,warning:"Software rendering mode. Please enable hardware acceleration."}];return e.VisualizationTraces.info("Known GPUs :"+(r.length+i.length+s.length+a.length+o.length+t.length)),n}),define("DS/QualityManager/QMGIController",["UWA/Core","UWA/Class","DS/QualityManager/QMGIPresetStreamer"],function(e,t,r){"use strict";return t.singleton({init:function(){this.isInitialized=!0,this.initPresetDB(),this.properties={},this._QMSettings={MaxSamples:{value:{Static:!0,Batch:!1}},MinSamples:{value:{Static:!0,Batch:!1}},Clamping:{value:{Static:!0,Batch:!0}},GaussFilter:{value:{Static:!0,Batch:!0}},Size:{value:{Static:!0,Batch:!0}},CenterWeight:{value:{Static:!0,Batch:!0}},MAxTraceDepth:{value:{Static:!0,Batch:!0}},GlossyThreshold:{value:{Static:!0,Batch:!0}},RenderRefractiveShadow:{value:{Static:!0,Batch:!0}},LocationBasedSampling:{value:{Static:!0,Batch:!0}},Distribution:{value:{Static:!0,Batch:!0}},Factor:{value:{Static:!0,Batch:!0}},PathTerminationDepth:{value:{Static:!0,Batch:!0}},VisualizationMode:{value:{Static:!0,Batch:!1}},EnableFinalGathering:{value:{Static:!0,Batch:!0}},NoOfPhotons:{value:{Static:!0,Batch:!0}},PathDepth:{value:{Static:!0,Batch:!0}},PhotonRadius:{value:{Static:!0,Batch:!0}},RefineMap:{value:{Static:!0,Batch:!0}},PrecalculateIrradiance:{value:{Static:!0,Batch:!0}},Caustics:{value:{Static:!0,Batch:!0}},CausticsPhotonNumber:{value:{Static:!0,Batch:!0}},CausticsPathDepth:{value:{Static:!0,Batch:!0}},CausticRadius:{value:{Static:!0,Batch:!0}},CausticRefinePhotonMap:{value:{Static:!0,Batch:!0}},RayOffset:{value:{Static:!0,Batch:!0}},AllowGroundShadows:{value:{Static:!0,Batch:!0}},AllowReflectionsOnGround:{value:{Static:!0,Batch:!0}},AllowBloom:{value:{Static:!0,Batch:!0}},AllowDepthOfField:{value:{Static:!0,Batch:!0}},DownsamplingFctor:{value:{Static:!0,Batch:!1}}}},initPresetDB:function(){r.init(),this.currentUser=r.getItem("currentUser");var e="Users/"+this.currentUser+"/currentPreset";this.currentPreset=r.getItem(e),this.prestToModify="Custom"},setCurrentUser:function(t){var i="Users/"+t,s=r.getItem(i);e.is(s)&&(r.setItem("currentUser",t),this.currentUser=t)},setCurrentPreset:function(t){var i="Users/"+this.currentUser+"/currentPreset",s=r.getItem(i);e.is(s)&&(r.setItem(i,t),this.currentPreset=t)},getCurrentUserPresetQuery:function(){return"Users/"+this.currentUser+"/Preset/"},getCurrentPreset:function(){var e="Users/"+this.currentUser+"/currentPreset";return r.getItem(e)},validateAttribute:function(e,t){var r=!0;return"ReflectionsOnGround"!=e&&"Preset"!=e||(r=!1),r},setAttribute:function(e,t,r,i,s){this.setAttributeOnDB(e,t,r,i,s)},setAttributeOnDB:function(e,t,i,s,a){var o=this.getCurrentUserPresetQuery()+e+"/"+this.prestToModify+"/"+i+"/",n=o+s;r.setItem(n,a);var u=o+"Preset";r.setItem(u,t)},setProperty:function(e,t,r){this.setPropertyOnDB(e,t,r)},setPropertyOnDB:function(t,i,s){var a=this.getCurrentUserPresetQuery()+t+"/"+i,o=r.getItem(a);if(!e.is(o))return!1;var n=o[s];if(!e.is(n))return!1;for(var u in n)if(n.hasOwnProperty(u)){var c=n[u];this.setAttributeOnDB(t,i,s,u,c)}},setGlobalPreset:function(e,t,r){this.setGlobalPresetOnDB(e,t,r)},setGlobalPresetOnDB:function(t,i,s){var a=this.getCurrentUserPresetQuery()+t+"/currentGlobalPreset";if(r.setItem(a,i),s){a=this.getCurrentUserPresetQuery()+t+"/"+i;var o=r.getItem(a);if(!e.is(o))return!1;for(var n in o)o.hasOwnProperty(n)&&this.setPropertyOnDB(t,i,n)}},getCurrentGlobalPreset:function(e){var t=this.getCurrentUserPresetQuery()+e+"/currentGlobalPreset";return r.getItem(t)},getPresetValue:function(e,t){var i=this.getCurrentUserPresetQuery()+e+"/"+t;return r.getItem(i)},commitToDB:function(){r.commit()},restoreFromDB:function(){r.retoreDB();var e=this.getCurrentPreset(),t=this.getCurrentGlobalPreset(e);this.setGlobalPreset(e,t,!1)},setQMsetting:function(e,t,r){var i=this._QMSettings[e];i.value[t]="true"==r},getQMsetting:function(e,t){return this._QMSettings[e].value[t]}})}),define("DS/QualityManager/QMController",["UWA/Core","UWA/Class","DS/QualityManager/QMPresetStreamer","DS/QualityManager/GPULists","DS/Mesh/ThreeJS_Base"],function(e,t,r,i,s){"use strict";var a=1,o=2,n=3,u=4,c=5,l=5;var h=i;return t.singleton({init:function(){this.isInitialized=!0,r.init(),this.version=-1,this.currentUser=null,this.currentPreset=null,this.defaultPreset=null,this.unknownOrVeryLowGPU=!0,this.isLinked=null,this.prestToModify=null,this._webGLV6Viewers=[],this.activateLocalCache=!0,this.forceLocalCache=void 0},_checkPreset:function(e,t,r,i){for(var s=0;s<t.length;s++){var a=t[s];if(a&&0!==a.length&&(a="\\b"+(a=(a=a.replace("(","\\(")).replace(")","\\)"))+"\\b",null!==e.match(a)))return this.defaultPreset=r,this.unknownOrVeryLowGPU=i,this._updateDefaultPresets(),!0}return!1},computeDefaultPreset:function(){if(null==this.defaultPreset&&0!==this._webGLV6Viewers.length){if(window.__karma__&&!localStorage.getItem("WebVisu_GPU_Profile"))return this.defaultPreset="Medium",void(this.unknownOrVeryLowGPU=!0);var e=localStorage.getItem("WebVisu_GPU_Profile")||(this._webGLV6Viewers[0]._viewerEffectSettings._lqFallback?"WebVisu Profile Very Low":this._webGLV6Viewers[0].renderer.renderer.getRendererInfo().gpu);if(localStorage.getItem("WebVisu_Show_GPU_Profile")&&alert(e),this.defaultPreset="Low",this.unknownOrVeryLowGPU=!0,e&&0!=e.length){null!==(e.match("\\bIntel\\b")||e.match("\\bIntel(R)\\b")||e.match("\\bIntel(TM)\\b"))&&console.warn("Integrated GPU detected, please enable your dedicated GPU if possible.");for(var t=0;t<h.length;t++){var r=h[t];if(this._checkPreset(e,r.value,r.preset,r.unknownOrVeryLow))return r.warning&&console.warn("Warning: "+r.warning),void(localStorage.getItem("WebVisu_Show_GPU_Profile")&&alert(this.defaultPreset))}localStorage.getItem("WebVisu_Show_GPU_Profile")&&alert(this.defaultPreset)}else this._updateDefaultPresets()}},_updateDefaultPresets:function(){this.isInitialized&&(this._modifyAttributeOnDB("Static","Low","Material","DefaultMaterialQuality",this.unknownOrVeryLowGPU?"Low":"High"),this._modifyAttributeOnDB("Static","Medium","Material","DefaultMaterialQuality",this.unknownOrVeryLowGPU?"Low":"High"))},getDBVersion:function(){return r.getItem("DBVersion")},setDBVersion:function(e){this.version=e,r.setItem("DBVersion",e),this.commitToDB()},linkToViewer:function(e){this._webGLV6Viewers.push(e)},initPresetDB:function(e){r.initDataBase(e),this.currentUser=r.getItem("currentUser");var t="Users/"+this.currentUser+"/currentPreset";this.currentPreset=r.getItem(t);t="Users/"+this.currentUser+"/isLinked";this.isLinked=r.getItem(t),this.prestToModify="Custom",this.version=this.getDBVersion(),this.version>l?console.error("Detected unknown QM database version"):(this.version<a&&this.setDBVersion(a),this.version<o&&(this._modifyAttributeOnDB("Static","Low","AmbientOcclusion","NoOfSamples",0),this._modifyAttributeOnDB("Dynamic","Low","AmbientOcclusion","NoOfSamples",0),this.setDBVersion(o)),this.version<n&&(this._addAttributeOnDB("Static","Low","Refractions","AllowInterObjectRefractions",!1),this._addAttributeOnDB("Static","Medium","Refractions","AllowInterObjectRefractions",!1),this._addAttributeOnDB("Static","High","Refractions","AllowInterObjectRefractions",!1),this._addAttributeOnDB("Static","Ultra","Refractions","AllowInterObjectRefractions",!1),this._addAttributeOnDB("Dynamic","Low","Refractions","AllowInterObjectRefractions",!1),this._addAttributeOnDB("Dynamic","Medium","Refractions","AllowInterObjectRefractions",!1),this._addAttributeOnDB("Dynamic","High","Refractions","AllowInterObjectRefractions",!1),this._addAttributeOnDB("Dynamic","Ultra","Refractions","AllowInterObjectRefractions",!1),this._addAttributeOnDB("Static","Custom","Refractions","AllowInterObjectRefractions",!1),this._addAttributeOnDB("Static","Custom","Refractions","Preset","Medium"),this._addAttributeOnDB("Dynamic","Custom","Refractions","AllowInterObjectRefractions",!1),this._addAttributeOnDB("Dynamic","Custom","Refractions","Preset","Medium"),this.setDBVersion(n)),this.version<u&&(this._modifyAttributeOnDB("Static","High","Reflections","AllowInterObjectReflections",!0),this._modifyAttributeOnDB("Static","Ultra","Reflections","AllowInterObjectReflections",!0),this._modifyAttributeOnDB("Dynamic","High","Reflections","AllowInterObjectReflections",!0),this._modifyAttributeOnDB("Dynamic","Ultra","Reflections","AllowInterObjectReflections",!0),this._modifyAttributeOnDB("Static","High","Refractions","AllowInterObjectRefractions",!0),this._modifyAttributeOnDB("Static","Ultra","Refractions","AllowInterObjectRefractions",!0),this._modifyAttributeOnDB("Dynamic","High","Refractions","AllowInterObjectRefractions",!0),this._modifyAttributeOnDB("Dynamic","Ultra","Refractions","AllowInterObjectRefractions",!0),this.setDBVersion(u)),this.version<c&&(this._modifyAttributeOnDB("Static","Medium","Shadows","AllowTransparentObjectShadows",!0),this._modifyAttributeOnDB("Static","High","Shadows","AllowTransparentObjectShadows",!0),this._modifyAttributeOnDB("Static","Ultra","Shadows","AllowTransparentObjectShadows",!0),this._modifyAttributeOnDB("Dynamic","Medium","Shadows","AllowTransparentObjectShadows",!0),this._modifyAttributeOnDB("Dynamic","High","Shadows","AllowTransparentObjectShadows",!0),this._modifyAttributeOnDB("Dynamic","Ultra","Shadows","AllowTransparentObjectShadows",!0),this.setDBVersion(c)))},setCurrentUser:function(t){var i="Users/"+t,s=r.getItem(i);e.is(s)&&(r.setItem("currentUser",t),this.currentUser=t)},setCurrentRenderMode:function(t){var i="Users/"+this.currentUser+"/currentPreset",s=r.getItem(i);e.is(s)&&(r.setItem(i,t),this.currentPreset=t)},getCurrentRenderMode:function(){var e="Users/"+this.currentUser+"/currentPreset";return r.getItem(e)},setLinkedPresetStatus:function(t){var i="Users/"+this.currentUser+"/isLinked",s=r.getItem(i);e.is(s)&&(r.setItem(i,t),this.isLinked=t)},getLinkedPresetStatus:function(){var e="Users/"+this.currentUser+"/isLinked";return r.getItem(e)},getCurrentUserPresetQuery:function(){return"Users/"+this.currentUser+"/Preset/"},validateAttribute:function(e,t){var r=!0;return"ReflectionsOnGround"!=e&&"Preset"!=e||(r=!1),r},setAttribute:function(e,t,r,i,s){this.setAttributeOnViewer(e,i,s),this.setAttributeOnDB(e,t,r,i,s)},setAttributeOnViewer:function(e,t,r){if(!this.validateAttribute(t,r))return!1;var i,s=!1,a="Dynamic"===e?"dynamicValue":"staticValue";i="string"==typeof r?JSON.parse('{"'+t+'":"'+r+'"}'):JSON.parse('{"'+t+'":'+r+"}");for(var o=0;o<this._webGLV6Viewers.length;o++){var n=this._webGLV6Viewers[o],u=n.getQMSetting(t);if(u[a]!==r)n._setQMSettings(i,e),n.getQMSetting(t)[a]!==u[a]&&(s=!0)}return s},_modifyAttributeOnDB:function(e,t,i,s,a){var o=this.getCurrentUserPresetQuery()+e+"/"+t+"/"+i+"/"+s;r.setItem(o,a),r.commit()},_addAttributeOnDB:function(e,t,i,s,a){var o=this.getCurrentUserPresetQuery()+e+"/"+t+"/"+i+"/"+s;r._addItem(o,a),r.commit()},_removeAttributeOnDB:function(e,t,i,s){var a=this.getCurrentUserPresetQuery()+e+"/"+t+"/"+i+"/"+s;r._removeItem(a),r.commit()},setAttributeOnDB:function(e,t,i,s,a){var o=this.getCurrentUserPresetQuery()+e+"/"+this.prestToModify+"/"+i+"/",n=o+s;r.setItem(n,a);var u=o+"Preset";r.setItem(u,t)},setAttributeOnDynamicMode:function(e,t,i,s,a){var o=this.getCurrentUserPresetQuery()+e+"/"+t+"/"+i+"/"+s;r.setItem(o,a),this.setGlobalPresetOnViewer(e,t),this.setPropertyOnViewer(e,t,i),this.setAttributeOnViewer(e,s,a)},setProperty:function(e,t,r){this.setPropertyOnViewer(e,t,r),this.setPropertyOnDB(e,t,r)},setPropertyOnViewer:function(t,i,s){"Default"===i&&(i=this.defaultPreset);var a=this.getCurrentUserPresetQuery()+t+"/"+i,o=r.getItem(a);if(!e.is(o))return!1;var n=o[s];if(!e.is(n))return!1;for(var u in n)if(n.hasOwnProperty(u)){var c=n[u];this.setAttributeOnViewer(t,u,c)}},setPropertyOnDB:function(t,i,s){var a=i;"Default"===i&&(a=this.defaultPreset);var o=this.getCurrentUserPresetQuery()+t+"/"+a,n=r.getItem(o);if(!e.is(n))return!1;var u=n[s];if(!e.is(u))return!1;for(var c in u)if(u.hasOwnProperty(c)){var l=u[c];this.setAttributeOnDB(t,i,s,c,l)}},_addPropertyOnDB:function(e,t,i){var s=this.getCurrentUserPresetQuery()+e+"/"+t+"/"+i;r._addItem(s,{}),r.commit()},_removePropertyOnDB:function(e,t,i){var s=this.getCurrentUserPresetQuery()+e+"/"+t+"/"+i;r._removeItem(s),r.commit()},setGlobalPreset:function(e,t,r){this.setGlobalPresetOnViewer(e,t),this.setGlobalPresetOnDB(e,t,r)},setBatching:function(e){this.setBatchingOnDB(e,!0)},setLocalCache:function(e){this.setLocalCacheOnDB(e,!0)},setGlobalPresetOnViewer:function(t,i){"Default"===i&&(i=this.defaultPreset);var s=this.getCurrentUserPresetQuery()+t+"/"+i,a=r.getItem(s);if(!e.is(a))return!1;for(var o in a)a.hasOwnProperty(o)&&this.setPropertyOnViewer(t,i,o)},setGlobalPresetOnDB:function(t,i,s){var a=i;"Default"===i&&(a=this.defaultPreset);var o=this.getCurrentUserPresetQuery()+t+"/currentGlobalPreset";if(r.setItem(o,i),s){o=this.getCurrentUserPresetQuery()+t+"/"+a;var n=r.getItem(o);if(!e.is(n))return!1;for(var u in n)n.hasOwnProperty(u)&&this.setPropertyOnDB(t,i,u)}},getBatchingQuery:function(){return"Users/"+this.currentUser+"/Batching"},setBatchingOnDB:function(e,t){var i=this.getBatchingQuery();r.setItem(i,!!e)},getBatching:function(){var e=this.getBatchingQuery();return!!r.getItem(e)},getLocalCacheQuery:function(){return"Users/"+this.currentUser+"/LocalCache"},setLocalCacheOnDB:function(e,t){var i=this.getLocalCacheQuery();r.setItem(i,!!e)},getLocalCache:function(){if(void 0!==this.forceLocalCache)return this.forceLocalCache;if(!this.activateLocalCache||window.__karma__||"undefined"!=typeof dscef)return!1;var e=this.getLocalCacheQuery(),t=r.getItem(e);return!(void 0!==t&&!t)},getLocalCacheSizeQuery:function(){return"Users/"+this.currentUser+"/LocalCacheSize"},setLocalCacheSizeOnDB:function(e,t){var i=this.getLocalCacheSizeQuery();r.setItem(i,e)},getLocalCacheSize:function(){var e=this.getLocalCacheSizeQuery(),t=r.getItem(e),i=parseInt(t);return isFinite(i)&&i>=0&&i<=2048?i:2048},getCurrentGlobalPreset:function(e){var t=this.getCurrentUserPresetQuery()+e+"/currentGlobalPreset";return r.getItem(t)},getPresetValue:function(e,t){"Default"===t&&(t=this.defaultPreset);var i=this.getCurrentUserPresetQuery()+e+"/"+t;return r.getItem(i)},commitToDB:function(){r.commit()},restoreFromDB:function(){r.retoreDB();var e=this.getCurrentGlobalPreset("Static");this.setGlobalPreset("Static",e,!1),e=this.getCurrentGlobalPreset("Dynamic"),this.setGlobalPreset("Dynamic",e,!1)},dispose:function(){this._webGLV6Viewers=[]}})});