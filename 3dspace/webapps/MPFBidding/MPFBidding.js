define("DS/MPFBidding/TimelineUser",["UWA/Core","UWA/Class/View","DS/MPFView/InitialsDot","DS/MPFError/BadArgumentError"],function(e,t,i,n){"use strict";return t.extend({className:"mpf-timeline-user",setup:function(t){if(!e.is(t.name,"string"))throw new n("options.name must be a string");if(!e.is(t.date))throw new n("options.date must be defined");this.name=t.name,this.date=t.date,this.logo=t.logo,this.logoContainer=this._createLogo(),this.captionContainer=this._createCaptionContainer()},render:function(){return this.container.setContent([this.logoContainer,this.captionContainer]),this},_createLogo:function(){return new i({image:this.logo,title:this.name})},_createCaptionContainer:function(){var t=e.createElement("div",{class:"mpf-name-container",text:this.name,title:this.name}),i=e.createElement("div",{class:"mpf-date-container",text:this.date.toLocaleDateString()}),n=e.createElement("div",{class:"mpf-time-container",text:this.date.toLocaleTimeString()});return e.createElement("div",{class:"mpf-caption-container",html:[t,i,n]})},destroy:function(){this._parent(),this.captionContainer=null,this.logoContainer=null,this.container=null}})}),define("DS/MPFBidding/TimelineDocumentLink",["UWA/Core","UWA/Class/View","DS/UIKIT/Mask","DS/MPFCartItemDocModel/CartItemDocModel","DS/MPFServices/ObjectService","DS/MPFError/BadArgumentError"],function(e,t,i,n,s,r){"use strict";return t.extend({className:"mpf-timeline-document-link",domEvents:{click:"_openDocument"},setup:function(t){if(s.requiredOfPrototype(t.doc,n,"options.doc must be a CartItemDocModel"),this.doc=t.doc,!e.is(this.doc.get("id")))throw new r("CartItemDocModel must have an id. New models are not accepted.")},render:function(){var e=this.doc.getDocName();return this.container.setContent([{tag:"span",class:"fonticon fonticon-doc"},{tag:"span",class:"mpf-document-name",text:e,title:e}]),this},destroy:function(){this.doc=null,this._parent(),this.container=null},_openDocument:function(){var t=this,n=this.doc.getDocUrl();e.is(n,"string")&&n.length>0?window.open(n,"_blank"):(i.mask(this.container.getElement(".mpf-document-name")),this.doc.fetchPromise().then(function(e){i.unmask(t.container.getElement(".mpf-document-name")),(n=e.getDocUrl())?window.open(n,"_blank"):t._dispatchOpeningDocFailure("Document URL not found")}).catch(function(e){i.unmask(t.container.getElement(".mpf-document-name")),t._dispatchOpeningDocFailure(e)}))},_dispatchOpeningDocFailure:function(e){console.error("Opening document failed"),console.error(e),this.dispatchEvent("openingDocFailed",{error:e,document:this.doc})}})}),define("DS/MPFBidding/TimelineTitleHelper",["UWA/Core","UWA/Class","DS/MPFCartModel/TimelineItemModel","i18n!DS/MPFBidding/assets/nls/Bidding"],function(e,t,i,n){"use strict";var s=t.extend();return s.createTitle=function(t,s){var r,o,a={};if(t)switch(r=s?n.get("phaseX"+t,{number:s}):n.get(t),t){case i.Titles.SUBMITTED:o="fonticon-right order-status-pending",a.paddingRight="2px";break;case i.Titles.ACCEPTED:o="fonticon-thumbs-up order-status-confirmed";break;case i.Titles.CONFIRMED:o="fonticon-check order-status-confirmed";break;case i.Titles.PROCESSING:o="fonticon-clock order-status-updated";break;case i.Titles.READY:o="fonticon-forward order-status-confirmed",a.paddingBottom="1px";break;case i.Titles.SHIPPED:o="fonticon-trolley order-status-confirmed";break;case i.Titles.REJECTED:o="fonticon-ignore order-status-cancelled";break;case i.Titles.DELIVERED:o="fonticon-home order-status-confirmed",a.paddingLeft="1px";break;case i.Titles.CANCELLED:o="fonticon-wrong order-status-cancelled";break;case i.Titles.INVOICE_UPLOADED:case i.Titles.PO_UPLOADED:case i.Titles.DELIVERABLE_UPLOADED:o="fonticon-upload order-status-confirmed";break;case i.Titles.PAYMENT_RECEIVED:r=s?n.get("phaseXPaymentReceived",{number:s}):n.get("PaymentReceived"),o="fonticon-thumbs-up order-status-confirmed";break;case i.Titles.PENDING_PO:o="fonticon-clock order-status-pending";break;case i.Titles.PHASES_MODIFIED:case i.Titles.MODIFIED:o="fonticon-refresh order-status-pending",a.fontSize="16px",a.paddingTop="1px";break;case i.Titles.ADDED:o="fonticon-doc-add order-status-confirmed",a.fontSize="18px";break;case i.Titles.DELETED:o="fonticon-doc-delete order-status-cancelled",a.fontSize="18px"}if(e.is(r,"string")&&r.length>0){var c=[];return c.push(e.createElement("div",{text:r,title:r})),e.is(o)&&c.push(e.createElement("span",{class:"fonticon "+o+" order-status-icon",styles:a})),c}return null},s}),define("DS/MPFBidding/TimelineMessage",["UWA/Core","UWA/Class/View","DS/UIKIT/Alert","DS/MPFBidding/TimelineDocumentLink","DS/MPFCartModel/TimelineItemModel","DS/MPFCartItemDocModel/CartItemDocModel","DS/MPFServices/ObjectService","i18n!DS/MPFBidding/assets/nls/Bidding"],function(e,t,i,n,s,r,o,a){"use strict";return t.extend({className:"mpf-timeline-message",setup:function(e){o.requiredOfPrototype(e.timelineItem,s,"options.timelineItem must be a TimelinItemModel"),o.requiredOfPrototype(e.serviceView,t,"options.serviceView must be a UWA/Class/View"),this.timelineItem=e.timelineItem,this.cartItemDocFactory=e.cartItemDocFactory,this.serviceView=e.serviceView,this.annotations3dView=e.annotations3dView,this.title=e.title,this.message=this.timelineItem.getMessage(),this.alert=this._createAlert(),this.docEntries=[]},render:function(){return this.container.setContent([this._createTitleContainer(),this.alert,{tag:"div",class:"mpf-message-and-infos",html:[this._createMessageContainer(),this._createDocsAndServiceView()]}]),this},destroy:function(){for(var e=0;e<this.docEntries.length;e++)this.docEntries[e].destroy();this.serviceView.destroy(),this.stopListening(),this.timelineItem=null,this._parent(),this.container=null},_createAlert:function(){return new i({autoHide:!0,hideDelay:3e3})},_createTitleContainer:function(){var t=e.is(this.title)?"mpf-title-container":"mpf-title-container hidden";return e.createElement("div",{class:t,html:this.title})},_createMessageContainer:function(){return e.createElement("div",{class:"mpf-message-container",text:this._getMessage()})},_getMessage:function(){var t,i,n=this.timelineItem.getMessage().message;return t=n.match(/&lt;/gim),e.is(t)&&t.forEach(function(e){n=n.replace(e,"<")}),i=n.match(/&gt;/gim),e.is(i)&&i.forEach(function(e){n=n.replace(e,">")}),n},_createDocsAndServiceView:function(){var t=[this.annotations3dView.render(),this.serviceView.render()];if(this.cartItemDocFactory){var i=this.cartItemDocFactory.createCollection(null,this._filterMarketplaceDocuments());t.push(this._createDocumentContainer(i))}return e.createElement("div",{class:"mpf-docs-and-service-view",html:t})},_filterMarketplaceDocuments:function(){var e,t,i,n=[];for(t in e=this.timelineItem.getMessage().documentIDs||{})if(Object.prototype.hasOwnProperty.call(e,t)&&0!==(i=e[t]).indexOf("3dannotation_")){var s={};s.id=t,s[r.Fields.DOC_NAME]=i,n.push(s)}return n},_createDocumentContainer:function(t){return this.docEntries=t.map(function(e){var t;return t=new n({doc:e}).render(),this.listenTo(t,"openingDocFailed",this._onOpeningDocFailed.bind(this)),t},this),e.createElement("div",{class:"mpf-document-container",html:this.docEntries})},_onOpeningDocFailed:function(){this.alert.add({className:"error",message:a.get("openingDocumentFailed")}).show()}})}),define("DS/MPFBidding/TimelineEntry",["UWA/Core","UWA/Class/View","DS/MPFCartModel/TimelineItemModel","DS/MPFServices/ObjectService","DS/MPFBidding/TimelineUser","DS/MPFBidding/TimelineMessage","css!DS/MPFBidding/MPFBidding"],function(e,t,i,n,s,r){"use strict";return t.extend({className:"mpf-timeline-entry",setup:function(s){n.requiredOfPrototype(s.timelineItem,i,"options.timelineItem should be a TimelineItemModel"),n.requiredOfPrototype(s.serviceView,t,"options.serviceView must be an instance of UWA/Class/View"),this.timelineItem=s.timelineItem,this.cartItemDocFactory=s.cartItemDocFactory,this.serviceView=s.serviceView,this.annotations3dView=s.annotations3dView,e.is(s.title)&&(this.title=s.title),e.is(s.additionalClassName,"string")&&this.container.addClassName(s.additionalClassName),this.timelineMessage=this._createTimelineMessage(),this.timelineUser=this._createTimelineUser()},render:function(){return this.container.setContent([this.timelineUser.render(),this.timelineMessage.render()]),this},destroy:function(){this.timelineMessage.destroy(),this.timelineUser.destroy(),this.timelineMessage=null,this.timelineUser=null,this.timelineItem=null,this._parent(),this.container=null},_createTimelineMessage:function(){return new r({title:this.title,timelineItem:this.timelineItem,cartItemDocFactory:this.cartItemDocFactory,serviceView:this.serviceView,annotations3dView:this.annotations3dView})},_createTimelineUser:function(){var t=this.timelineItem.get("message"),i=e.is(t.author.shopName,"string")?t.author.shopName:t.author.firstName+" "+t.author.lastName;return new s({name:i,date:t.creation,logo:t.author.logo})}})}),define("DS/MPFBidding/TimelineContainer",["UWA/Core","UWA/Class/View","DS/MPFView/EmptyView","DS/MPFServices/ObjectService","DS/MPFBidding/TimelineTitleHelper","DS/MPFCartModel/TimelineItemCollection","DS/MPFBidding/TimelineEntry","DS/PlatformAPI/PlatformAPI"],function(e,t,i,n,s,r,o,a){"use strict";return t.extend({className:"mpf-bidding-timeline-container",setup:function(e){n.requiredOfPrototype(e.timelineItems,r,"options.timelineItems must be a TimelineItemCollection"),n.requiredOfType(e.currentUserId,"string","options.currentUserId must be a string"),this.timelineItems=e.timelineItems,this.currentUserId=e.currentUserId,this.cartItemDocFactory=e.cartItemDocFactory,this.serviceViewFactory=e.serviceViewFactory,this.annotations3dViewFactory=e.annotations3dViewFactory,this.rendered=!1,this.uiItems=this._createUIItems(),this.listenTo(this.timelineItems,"onAnyEvent",this._onModelChange),a.subscribe("MPCartTimeline",this._refreshTimelineOnEvent.bind(this))},render:function(){for(var e=[],t=0;t<this.uiItems.length;t++)e.push(this.uiItems[t].render());return this.container.setContent(e),this.rendered=!0,this},refreshTimeline:function(){this.timelineItems.fetchPromise()},destroy:function(){a.unsubscribe("MPCartTimeline"),this.stopListening();for(var e=0;e<this.uiItems.length;e++)this.uiItems[e].destroy();this.timelineItems=null,this._parent(),this.uiItems=null,this.container=null},_onModelChange:function(){this.uiItems=this._createUIItems(),this.rendered&&this.render()},_createUIItems:function(){for(var e=[],t=0;t<this.timelineItems.length;t++){var i=this.timelineItems.at(t),n="",r=i.getMessage();r.author&&r.author.id&&r.author.id===this.currentUserId&&(n+="right");var a=s.createTitle(i.getTitle(),i.getPhaseNumber()),c=this._createServiceView(i),l=this._createAnnotations3dView(i);e.push(new o({timelineItem:i,additionalClassName:n,title:a,cartItemDocFactory:this.cartItemDocFactory,serviceView:c,annotations3dView:l}))}return e},_createServiceView:function(t){return e.is(this.serviceViewFactory,"function")?this.serviceViewFactory({timelineItem:t}):i.getInstance()},_createAnnotations3dView:function(t){return e.is(this.annotations3dViewFactory,"function")?this.annotations3dViewFactory({timelineItem:t}):i.getInstance()},_refreshTimelineOnEvent:function(e){e&&"refresh"===e.event&&this.refreshTimeline()}})});