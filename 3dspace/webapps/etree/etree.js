define("DS/etree/tree",["DS/egraph/utils","DS/egraph/core"],function(e,t){"use strict";var n={},i=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame,r=(window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame,t.PathCmd.M),o=t.PathCmd.L,a=t.PathCmd.C;function s(e){e=e||{},this.offset=void 0!==e.offset?e.offset:0,this.anormx=void 0!==e.anormx?e.anormx:0,this.anormy=void 0!==e.anormy?e.anormy:-1}function d(e){e=e||{},this.offset=void 0!==e.offset?e.offset:0,this.anormx=void 0!==e.anormx?e.anormx:0,this.anormy=void 0!==e.anormy?e.anormy:1}function l(e){e=e||{},this.offset=void 0!==e.offset?e.offset:0,this.anormx=void 0!==e.anormx?e.anormx:-1,this.anormy=void 0!==e.anormy?e.anormy:0}function h(e){e=e||{},this.offset=void 0!==e.offset?e.offset:0,this.anormx=void 0!==e.anormx?e.anormx:1,this.anormy=void 0!==e.anormy?e.anormy:0}s.prototype.onupdate=function(e){var t,n;t=Math.round(e.node.actualLeft+.5*e.node.actualWidth),n=e.node.actualTop+this.offset,e.multiset("left",t,"top",n,"aleft",t,"atop",n,"anormx",this.anormx,"anormy",this.anormy)},d.prototype.onupdate=function(e){var t,n;t=Math.round(e.node.actualLeft+.5*e.node.actualWidth),n=e.node.actualTop+e.node.actualHeight+this.offset,e.multiset("left",t,"top",n,"aleft",t,"atop",n,"anormx",this.anormx,"anormy",this.anormy)},l.prototype.onupdate=function(e){var t,n;t=e.node.actualLeft+this.offset,n=Math.round(e.node.actualTop+.5*e.node.actualHeight),e.multiset("left",t,"top",n,"aleft",t,"atop",n,"anormx",this.anormx,"anormy",this.anormy)},h.prototype.onupdate=function(e){var t,n;t=e.node.actualLeft+e.node.actualWidth+this.offset,n=Math.round(e.node.actualTop+.5*e.node.actualHeight),e.multiset("left",t,"top",n,"aleft",t,"atop",n,"anormx",this.anormx,"anormy",this.anormy)};var c=[r,0,0];function u(e,t,n){if(void 0!==t){if("number"!=typeof t||!isFinite(t)||t<0)throw new Error(e+" must be either undefined or a finite positive number");this[e]=t}else this[e]=n}function p(e,t,n){if(void 0!==t){if("number"!=typeof t||!isFinite(t))throw new Error(e+" must be either undefined or a finite number");this[e]=t}else this[e]=n}function g(e,t){function i(e,t){var n=e&&e.parent?e.parent.parent:null;return!!n&&(n===t||!!n.parent&&i(n,t))}if(!i(e,t)&&!i(t,e))return!1;var r=n.DrawingModifiers.HORIZONTAL;if(e.document.drawingModifiers&r){if(e.top===t.top)return!0}else if(e.left===t.left)return!0;return!1}n.AutoBezierGeometry=function(e,t){this.offset1=0|e,this.offset2=0|t},n.AutoBezierGeometry.prototype.onupdate=function(e){var t,n,i,s,d,l,h,u,p,g,f,m,w,y,v,_,N,C,x,E,b,T,S;t=e.cl1.c,n=e.cl2.c,i=t.anormx,s=t.anormy,d=n.anormx,l=n.anormy,h=t.aleft,u=t.atop,p=n.aleft,g=n.atop,(f=this.offset1)<0&&(f+=(p-h)*i+(g-u)*s),(m=this.offset2)<0&&(m+=(h-p)*d+(u-g)*l),f<0||m<0?e.set("path",c):(w=h+f*i,y=u+f*s,v=p+m*d,_=g+m*l,i&&i*v<=i*w||s&&s*_<=s*y||d&&d*w<=d*v||l&&l*y<=l*_?e.set("path",c):(N=w+(b=Math.max(1,Math.abs(v-w)))*i*.5,C=y+(T=Math.max(1,Math.abs(_-y)))*s*.5,x=v+b*d*.5,E=_+T*l*.5,S=f&&m?[r,h,u,o,w,y,a,v,_,N,C,x,E,o,p,g]:f?[r,h,u,o,w,y,a,v,_,N,C,x,E]:m?[r,w,y,a,v,_,N,C,x,E,o,p,g]:[r,w,y,a,v,_,N,C,x,E],e.set("path",S)))},n.RoundedSquareGeometry=function(e,t,n,i){if(u.call(this,"radius",e,4),u.call(this,"minRadius",i,1.5),p.call(this,"offset",t,this.radius),p.call(this,"auxOffset",n,this.offset),Math.abs(this.offset)<this.radius)throw new Error("offset must be >= radius");if(Math.abs(this.auxOffset)<this.radius)throw new Error("auxOffset must be >= radius")};var f=4*(Math.SQRT2-1)/3;function m(e,t,n){e.updateLock();try{return n.apply(t,Array.prototype.slice.call(arguments,3))}finally{e.updateUnlock()}}n.RoundedSquareGeometry.prototype.onupdate=function(e){function t(e,t){return!(e!==e.node.data.grMergeParentC&&e!==e.node.data.grMergeChildrenC||t!==t.node.data.grMergeParentC&&t!==t.node.data.grMergeChildrenC)}function n(e,t,n,i,r,o,a,s,d,l,h){var c=o*f;"firstPoint"===r?(h.x=n+e*o,h.y=i+t*o,s.x=n,s.y=i,"y"===a?(d.x=s.x,d.y=s.y+t*c,l.x=h.x-e*c,l.y=h.y):(d.x=h.x-e*c,d.y=s.y,l.x=h.x,l.y=h.y-t*c)):"y"===a?(h.x=n+e*o,h.y=i,s.x=n,s.y=i-t*o,d.x=n,d.y=s.y+t*c,l.x=h.x-e*c,l.y=i):(h.x=n,h.y=i+t*o,s.x=n-e*o,s.y=i,d.x=s.x+e*c,d.y=i,l.x=n,l.y=h.y-t*c)}var i,s,d,l,h,u,p,m,w,y,v,_;if(i=e.cl1.c,s=e.cl2.c,d=i.anormx,l=i.anormy,h=s.anormx,u=s.anormy,p=i.aleft,m=i.atop,w=s.aleft,y=s.atop,v=i.node.data,_=s.node.data,g(i.node.data,s.node.data)&&!i.node.data.document.preventAntiEdgeOverlayAlgos)(function(){var i,s={},c={},g={},f={},v={},_={},N={},C={},x={},E={},b={},T={},S={},D={},M={},P={};i=this.radius;var L=e.cl1.c,O=e.cl2.c;if(l*u==-1){var R=L.node.actualWidth,A=m>y?-1:1;n(G=1,l,p,m,"firstPoint",i,"y",s,c,g,f),n(G,A,p+G*(R/2),f.y,"firstPoint",i,"x",v,_,N,C),n(G,u,w,y,"firstPoint",i,"y",P,M,D,S),n(-G,A,C.x,S.y,"corner",i,"y",x,E,b,T)}else if(d*h==-1){var G,k=L.node.actualHeight,V=p>w?-1:1;n(d,G=1,p,m,"firstPoint",i,"x",s,c,g,f),n(V,G,f.x,m+G*(k/2),"firstPoint",i,"y",v,_,N,C),n(h,G,w,y,"firstPoint",i,"x",P,M,D,S),n(V,-G,S.x,C.y,"corner",i,"x",x,E,b,T)}var F=[];if(t(L,O)){var I=L.node.data.grMergeChildrenC===L?L.node.data.grChildrenC:L.node.data.grParentC;F=F.concat([r,I.aleft,I.atop])}else F=F.concat([r,p,m]);if(F=F.concat([o,s.x,s.y,a,f.x,f.y,c.x,c.y,g.x,g.y,o,v.x,v.y,a,C.x,C.y,_.x,_.y,N.x,N.y,o,x.x,x.y,a,T.x,T.y,E.x,E.y,b.x,b.y,o,S.x,S.y,a,P.x,P.y,D.x,D.y,M.x,M.y,o,w,y]),t(L,O)){var H=O.node.data.grMergeChildrenC===O?O.node.data.grChildrenC:O.node.data.grParentC;F=F.concat([o,H.aleft,H.atop])}e.set("path",F)}).call(this);else{if(d&&d*w<d*p||l&&l*y<l*m||h&&h*p<h*w||u&&u*m<u*y)return void e.set("path",c);if(d*h+l*u){if(!i.node.data.document.preventAntiEdgeOverlayAlgos){var N=0!==l;if(N&&i.node.actualTop!==s.node.actualTop||!N&&i.node.actualLeft!==s.node.actualLeft)if(N&&Math.abs(i.node.actualTop-s.node.actualTop)>i.node.data.document.rowPadding+i.node.actualHeight||!N&&Math.abs(i.aleft-s.aleft)>i.node.data.document.rowPadding+i.node.actualWidth)if(i===i.node.data.grMergeChildrenC&&s===s.node.data.grMergeParentC||i===i.node.data.grMergeChildrenC&&s===s.node.data.grMergeParentC)if(function(e){if(e.data.first)for(var t=e.data.first.grNode.next;t&&e!==t;t=t.next)if(g(e.data,t.data))return!0;return!1}((s===s.node.data.grMergeParentC?i:s).node))return void function(){var c={},g={},f={},v={},_={},N={},C={},x={},E={},b={},T={},S={},D={},M={},P={},L={},O=this.radius;if(0===d&&0===h){var R=i.node.actualWidth,A=w>=p?1:-1;(G=Math.abs(w-p)/4)<O&&(O=G),n(A,l,p,m,"firstPoint",O,"y",c,g,f,v),n(A,l,p+A*R/2,v.y,"firstPoint",O,"x",_,N,C,x),n(-A,u,w,y,"firstPoint",O,"y",L,P,M,D),n(A,l,x.x,D.y,"corner",O,"y",E,b,T,S)}else{var G,k=i.node.actualWidth;A=y>=m?1:-1,(G=Math.abs(y-m)/4)<O&&(O=G),n(d,A,p,m,"firstPoint",O,"x",c,g,f,v),n(d,A,v.x,m+A*k/2,"firstPoint",O,"y",_,N,C,x),n(h,-A,w,y,"firstPoint",O,"x",L,P,M,D),n(d,A,D.x,x.y,"corner",O,"x",E,b,T,S)}var V=[];if(t(i,s)){var F=i.node.data.grMergeChildrenC===i?i.node.data.grChildrenC:i.node.data.grParentC;V=V.concat([r,F.aleft,F.atop])}else V=V.concat([r,p,m]);if(V=V.concat([o,c.x,c.y,a,v.x,v.y,g.x,g.y,f.x,f.y,o,_.x,_.y,a,x.x,x.y,N.x,N.y,C.x,C.y,o,E.x,E.y,a,S.x,S.y,b.x,b.y,T.x,T.y,o,D.x,D.y,a,L.x,L.y,M.x,M.y,P.x,P.y,o,w,y]),t(i,s)){var I=s.node.data.grMergeChildrenC===s?s.node.data.grChildrenC:s.node.data.grParentC;V=V.concat([o,I.aleft,I.atop])}e.set("path",V)}.call(this)}(function(){var g,f,N,C,x,E,b,T,S,D,M={},P={},L={},O={},R={},A={},G={},k={};if(g=this.radius,f=this.minRadius,C=i.node.data.grAuxChildrenC===i?this.auxOffset:this.offset,x=_===v.first,!(E=_===v.last)||e.cl1.next||e.cl1.prev||(x=!0),0===d){if(C<0&&(C+=l*(y-m)),Math.abs(y-m)<2*g)return void e.set("path",c);if(Math.abs(p-w)<=f){if(x||e.data.temporary)e.set("path",[r,p,m,o,p,y]);else if(t(i,s)){var V=i.node.data.grMergeChildrenC===i?i.node.data.grChildrenC.aleft:i.node.data.grParentC.aleft,F=i.node.data.grMergeChildrenC===i?i.node.data.grChildrenC.atop:i.node.data.grParentC.atop,I=s.node.data.grMergeChildrenC===s?s.node.data.grChildrenC.atop:s.node.data.grParentC.atop;e.set("path",[r,V,F,o,V,I])}else e.set("path",[r,p,m+l*(C-g),o,p,y]);return}T=w>=p?1:-1,(N=.5*Math.abs(w-p))<g?(b=!0,S=p,D=m+l*(C-(g=N))):b=!1,n(-T,u,w,y,"firstPoint",g,"y",k,G,A,R),n(T,l,p,R.y,"corner",g,"y",M,P,L,O)}else{if(C<0&&(C+=d*(w-p)),Math.abs(w-p)<2*g)return void e.set("path",c);if(Math.abs(m-y)<=f){if(x||e.data.temporary)e.set("path",[r,p,m,o,w,m]);else if(t(i,s)){F=i.node.data.grMergeChildrenC===i?i.node.data.grChildrenC.atop:i.node.data.grParentC.atop,V=i.node.data.grMergeChildrenC===i?i.node.data.grChildrenC.aleft:i.node.data.grParentC.aleft;var H=s.node.data.grMergeChildrenC===s?s.node.data.grChildrenC.aleft:s.node.data.grParentC.aleft;e.set("path",[r,V,F,o,H,F])}else e.set("path",[r,p+d*(C-g),m,o,w,m]);return}T=y>=m?1:-1,(N=.5*Math.abs(y-m))<g?(g=N,b=!0,S=p+d*(C-this.radius),D=m):b=!1,n(h,-T,w,y,"firstPoint",g,"x",k,G,A,R),n(d,T,R.x,m,"corner",g,"x",M,P,L,O)}if(x||e.data.temporary||i===i.node.data.grMergeChildrenC&&t(i,s)){var B=[];if(t(i,s)){var U=i.node.data.grMergeChildrenC===i?i.node.data.grChildrenC:i.node.data.grParentC;B=B.concat([r,U.aleft,U.atop])}else B=B.concat([r,p,m]);if(B=B.concat([o,M.x,M.y,a,O.x,O.y,P.x,P.y,L.x,L.y,o,R.x,R.y,a,k.x,k.y,A.x,A.y,G.x,G.y,o,w,y]),t(i,s)){var z=s.node.data.grMergeChildrenC===s?s.node.data.grChildrenC:s.node.data.grParentC;B=B.concat([o,z.aleft,z.atop])}e.set("path",B)}else b?e.set("path",[r,S,D,o,M.x,M.y,a,O.x,O.y,P.x,P.y,L.x,L.y,o,R.x,R.y,a,k.x,k.y,A.x,A.y,G.x,G.y,o,w,y]):E?e.set("path",[r,M.x,M.y,a,O.x,O.y,P.x,P.y,L.x,L.y,o,R.x,R.y,a,k.x,k.y,A.x,A.y,G.x,G.y,o,w,y]):e.set("path",[r,R.x,R.y,a,k.x,k.y,A.x,A.y,G.x,G.y,o,w,y])}).call(this)}else(function(){var t,i={},s={},c={},g={};t=Math.min(this.radius,Math.abs(w-p),Math.abs(y-m)),0!==d?n(d,-u,w,m,"corner",t,"x",i,s,c,g):n(-h,l,p,y,"corner",t,"y",i,s,c,g),e.set("path",[r,p,m,o,i.x,i.y,a,g.x,g.y,s.x,s.y,c.x,c.y,o,w,y])}).call(this)}},n.DisplayFlags={DRAGGED:1,DRAG_NODE:2},n.Node=function(e){this.data=e,this.first=null,this.last=null,this.prev=null,this.next=null,this.parent=null,this.grNode=null,this.grParentC=null,this.grMergeParentC=null,this.grMergeChildrenC=null,this.grChildrenC=null,this.grAuxChildrenC=null,this.expanded=!1,this.document=null,this.left=0,this.top=0,this._actualPositionsSet=!1,this.height=NaN,this.startLeft=0,this.startTop=0,this.widthAnimation=null,this.heightAnimation=null,this.id=-1,this.__updateFlags__=0,this.__lastParent__=null,this.displayFlags=0,this.__configFlags__=0},n.Node.Type=0,n.Node.TypeString="node",n.Node.prototype.type=n.Node.Type,n.Node.prototype.typeString=n.Node.TypeString,n.Node.prototype.toString=function(){return this.data&&this.data.toString!==Object.prototype.toString?this.typeString+"("+this.data+")":this.typeString},n.Node.prototype.setExpanded=function e(t,i){var r,o;if((o=this.document)&&!o.updateLockCount)return m(o,this,e,t,i);for(t=Boolean(t),r=this;r;r=i?r.dftNext(this):null)r.expanded!==t&&(r.expanded=t,t&&r.heightAnimation&&x.call(o,r.heightAnimation),o?(n.traceUpdates&&console.log("expanded flag changed for "+r),F.call(o,r),r.__updateFlags__|=8):n.traceUpdates&&console.log("no document when expanded flag changed for "+r))},n.Node.prototype.setDragged=function e(t){var i,r,o=n.DisplayFlags.DRAGGED;if((r=this.document)&&!r.updateLockCount)return m(r,this,e,t);for(t=Boolean(t),i=this;i;i=i.dftNext(this))Boolean(i.displayFlags&o)!==t&&(n.traceUpdates&&console.log("dragged flag changed for "+i),t?i.displayFlags|=n.DisplayFlags.DRAGGED:i.displayFlags&=~n.DisplayFlags.DRAGGED,r&&(F.call(r,i),i.__updateFlags__|=128))},n.Node.prototype.setHeight=function t(i,r){var o;if(e.pos_number_or_nan_arg("height",i),void 0===r&&(r=0),e.pos_number_arg("animationDuration",r),(o=this.document)&&!o.updateLockCount)return m(o,this,t,i,r);this.height=i,o?(n.traceUpdates&&console.log("change height of "+this+" to "+i),F.call(o,this),this.__updateFlags__|=4096,!this.grNode||this.type===n.Group.Type&&this.expanded||C.call(o,v,this,r,this.grNode.height,re(this))):n.traceUpdates&&console.log("no document when changing height of "+this+" to "+i)},n.Node.prototype.notifyUpdate=function e(i,r){var o;if((o=this.document)&&!o.updateLockCount)return m(o,this,e,i,r);this.grNode?(n.traceUpdates&&console.log("notify update of property "+i+" of "+this),this.grNode.notify(new t.UpdatedNotif(["data","data",i],r))):n.traceUpdates&&console.log("don't notify update of property "+i+" of "+this+" because of no view")},n.Node.prototype.appendChild=function(e){return this.insertBefore(e,null)},n.Node.prototype.removeMergeWith=function e(t){var i;if((i=this.document)&&!i.updateLockCount)return m(i,this,e,t);if(i.drawing!==n.Drawing.TWO_BRANCHES_LEAVES_ON_EXTREMITY)throw new Error("Merge is not accepted in this drawing mode : "+i.drawing);if(t.mergeParent&&-1===t.mergeParent.indexOf(this)&&t.mergeChild&&-1===t.mergeChild.indexOf(this))throw new Error("This merge link does not exist");var r,o,a=-1,s=-1;t.mergeParent&&this.mergeChild&&(a=t.mergeParent.indexOf(this),s=this.mergeChild.indexOf(t)),-1!==a&&-1!==s?(r=this,o=t,this.mergeChild.splice(s,1),0===this.mergeChild.length&&(this.mergeChild=null),t.mergeParent.splice(a,1),0===t.mergeParent.length&&(t.mergeParent=null),o.document&&this.document?(n.traceUpdates&&console.log("remove merge between "+r+" and "+o),F.call(o.document,o),o.__updateFlags__|=16384,F.call(this.document,this),this.__updateFlags__|=16384):n.traceUpdates&&console.log("ignore merge between "+r+" and "+o+" since no document")):n.traceUpdates&&console.log("No proper merge exist between "+r+" and "+o)},n.Node.prototype.removeChild=function e(t){var i;if((i=this.document)&&!i.updateLockCount)return m(i,this,e,t);if(t.parent!==this)throw new Error("not the expected parent!");t.prev?t.prev.next=t.next:this.first=t.next,t.next?t.next.prev=t.prev:this.last=t.prev,t.prev=t.next=null,t.parent=null,t.document?(n.traceUpdates&&console.log("remove "+t+" from "+this),F.call(t.document,t),2&t.__updateFlags__?t.__updateFlags__&=-3:(t.__updateFlags__|=4,t.__lastParent__=this)):n.traceUpdates&&console.log("ignore remove "+t+" from "+this+" since no document")},n.Node.prototype.insertBefore=function e(t,i){var r;if((r=this.document)&&!r.updateLockCount)return m(r,this,e,t,i);switch(this.type){case n.Group.Type:if(t.type!==n.Node.Type||t.first)throw new Error("only leaf nodes can be inserted in a group");break;case n.Node.Type:if(this.parent&&this.parent.type===n.Group.Type)throw new Error("can't insert anything in a node that is in a group");default:switch(t.type){case n.Node.Type:case n.Group.Type:break;default:throw new Error("only nodes or groups can be appended, not "+t.typeString)}}if(i===t)throw new Error("can't insert an element before itself");if(i&&i.parent!==this)throw new Error("next is not a child of this");return null!==t.parent&&(t.__lastParent__=t.parent,t.parent.removeChild(t)),t.next=i||null,t.prev=i?i.prev:this.last,t.next?t.next.prev=t:this.last=t,t.prev?t.prev.next=t:this.first=t,t.parent=this,function(e){var t,i,r;if(i=this.document)for(t=e;t;t=t.dftNext(e,r))if(t.document){if(t.document!==i)throw new Error("mixing documents is not allowed (yet?)");n.traceUpdates&&console.log("bypass updating document of "+t+" and its children because it is already in a document"),r=!0}else n.traceUpdates&&console.log("update document of "+t),t.document=i,r=!1;else n.traceUpdates&&console.log("don't update document of "+e+" because "+this+" has no document yet")}.call(this,t),t.document?(n.traceUpdates&&console.log("insert "+t+" in "+this+" before "+i),F.call(t.document,t),t.__updateFlags__|=2):n.traceUpdates&&console.log("ignore insert "+t+" in "+this+" because no doc"),t},n.Node.prototype.mergeWith=function e(t,i){var r;if((r=this.document)&&!r.updateLockCount)return m(r,this,e,t);if(r.drawing!==n.Drawing.TWO_BRANCHES_LEAVES_ON_EXTREMITY)throw new Error("Merge is not accepted in this drawing mode : "+r.drawing);switch(this.type){case n.Group.Type:throw new Error("Groups can't be considered in a merge");default:switch(t.type){case n.Node.Type:case n.Group.Type:break;default:throw new Error("only nodes or groups can be merged, not "+t.typeString)}}if(t.mergeParent||(t.mergeParent=[]),this.mergeChild||(this.mergeChild=[]),-1===t.mergeParent.indexOf(this)||-1===this.mergeChild.indexOf(t)){t.mergeParent.push(this),this.mergeChild.push(t),t.document&&this.document?(n.traceUpdates&&console.log("merge of "+this+" (parent) with "+t+" (child)"),F.call(t.document,t),F.call(this.document,this),t.__updateFlags__|=16384,this.__updateFlags__|=16384):n.traceUpdates&&console.log("ignore merge of "+this+" with "+t+" because no doc");var o=r.getGeometryFromOptions(i);r.mergeEdgeGeomCol=r.mergeEdgeGeomCol||[],r.mergeEdgeGeomCol.push({mergeParent:this,mergeChild:t,mergeEdgeGeom:o})}else n.traceUpdates&&console.log("merge between "+this+" (parent) and "+t+" (child) already exists")},n.Node.prototype.dftNext=function(e,t){var n;if(!t&&this.first)return this.first;for(n=this;n!==e&&!n.next;n=n.parent);return n!==e?n.next:null},n.NodeIterator=function(e,t){var i;if(!(e instanceof n.Node))throw new Error("root must be a Node");if(t&&!(t instanceof n.Node))throw new Error("start must be null/undefined or a Node");for(this.root=e,this.n=t||e,this.depth=0,i=this.n;i&&i!==e;i=i.parent)this.depth+=1;if(i!==e)throw new Error("start is not a child of root")},n.NodeIterator.prototype.dftNext=function(e){var t,n;if(!this.n)return null;if(!e&&this.n.first)this.depth+=1,this.n=this.n.first;else{for(n=this.root,t=this.n;t!==n&&!t.next;t=t.parent)this.depth-=1;this.n=t!==n?t.next:null}return this.n},n.NodeIterator.prototype.nextNeighbor=function(e){var t,n;for(n=this.depth,this.dftNext(!0);(t=this.n)&&this.depth!==n;)this.dftNext(e&&!t.expanded);return t},n.NodeIterator.prototype.nextNeighbor2=function(e){var t,n;for(n=this.depth,this.dftNext(!0);(t=this.n)&&this.depth!==n;)this.dftNext(e(t));return t},n.Node.prototype.clear=function e(){var t;if((t=this.document)&&!t.updateLockCount)return m(t,this,e);for(;this.first;)this.removeChild(this.first)},n.Node.prototype.getActualWidth=function(){var e;return(e=this.document)?e.nodeWidth:NaN},n.Node.prototype.getActualHeight=function(){var e,t;return(e=this.height)!=e?(t=this.document)?t.nodeHeight:NaN:e},n.Node.prototype.isLeaf=function(){var e=!1,t=this.type!==n.Group.Type?this.first:null,i=t?t.next:null;return this.first&&this.expanded&&(t&&t.first&&t.expanded||i&&i.first&&i.expanded)||(e=!0),e},n.Group=function(e){n.Node.call(this,e),this.expandedWidth=NaN,this.expandedHeight=NaN},e.inherit(n.Group,n.Node),n.Group.Type=2,n.Group.TypeString="group",n.Group.prototype.type=n.Group.Type,n.Group.prototype.typeString=n.Group.TypeString,n.Group.prototype.getCollapsedWidth=function(){var e;return(e=this.document)?e.groupWidth:NaN},n.Group.prototype.getActualWidth=function(){return this.expanded?this.expandedWidth:this.getCollapsedWidth()},n.Group.prototype.getCollapsedHeight=function(){var e,t;return(e=this.height)!=e?(t=this.document)?t.groupHeight:NaN:e},n.Group.prototype.getActualHeight=function(){return this.expanded?this.expandedHeight:this.getCollapsedHeight()},n.mergeSiblingGroups=function(e,t){var i,r,o,a,s;if(e.type!==n.Group.Type)throw new Error("grp must be a group");if(!e.next||e.next.type!==n.Group.Type)throw new Error("grp next sibling must be a group");if(i=e,r=e.next,t){for(o=r.first;o;o=a)a=o.next,i.insertBefore(o,null);r.parent.removeChild(r)}else{for(o=i.last;o;o=s)s=o.prev,r.insertBefore(o,r.first);i.parent.removeChild(i)}},n.Drawing={LAYERED:0,LAYERED_TIDY_1:1,BRANCHED:2,TWO_BRANCHES:3,TWO_BRANCHES_LEAVES_ON_EXTREMITY:4},n.DrawingModifiers={HORIZONTAL:1,MIRROR_DEPTH:2,MIRROR_SIBLINGS:4};var w=[];w[n.Drawing.LAYERED]=function(e){function t(n,i){var r,h;if($(e,n,0),(h=l(n))<a[i]||(a[i]=h),!n.first||A(n))o+=s,n.left=o,o+=d(n);else{for(r=n.first;r;r=r.next)t(r,i+1);n.left=Math.round(.5*(n.first.left+n.last.left+.5*(d(n.first)+d(n.last))-d(n)))}}var i,r,o,a,s,d,l,h;s=e.siblingPadding,(i=e.drawingModifiers&n.DrawingModifiers.HORIZONTAL)?(d=re,l=ie):(d=ie,l=re);for(o=0,a=[0],e.left=0,e.top=0,h=oe(e),r=e.first;r;r=r.next)t(r,1);ne(a,e.rowPadding),function(){var t;for(t=new n.NodeIterator(e,e.first);t.n;t.dftNext(A(t.n)))t.n.top=a[t.depth-1]}(),ae(e),i&&ee(e);return{depthOffset:a,groups:h}},w[n.Drawing.LAYERED_TIDY_1]=function(e){function t(e,n,i){var r,o;if(n>=i)return e;for(o=A(e)?null:e.first,r=null;!r&&o;o=o.next)r=t(o,n+1,i);return r}var i,r,o,a,s,d,l,h,c,u,p,g,f;i=e.siblingPadding,r=void 0!==e.subtreePadding?e.subtreePadding:i,l=e.rowPadding,(c=e.drawingModifiers&n.DrawingModifiers.HORIZONTAL)?(p=re,g=ie):(p=ie,g=re);u=[0],h=[],s=0,a=[],d=[],o=[],e.left=0,e.top=0,f=oe(e),function n(l,c){var f,m,w,y,v,_,N,C;if(f=l.id=s++,$(e,l,0),o[f]=h[c],h[c]=l,N=l!==e?g(l):0,C=u[c],N<C||(u[c]=N),a[f]=0,!l.first||A(l))l.prev?d[f]=d[l.prev.id]+i+.5*(p(l.prev)+p(l)):d[f]=0;else{for(w=l.first,y=l.last,m=w;m;m=m.next)n(m,c+1);v=.5*(d[w.id]+d[y.id]),l.prev?(_=d[f]=d[l.prev.id]+.5*(p(l.prev)+p(l))+i,a[f]=_-v,function(e){var n,i,s,l,h,c,u,g,f,m,w,y;for(e.id,s=1,n=e.first;n&&(i=o[n.id]);){for(h=0,c=0,u=n,g=i,l=0;l<s;++l)u=u.parent,g=g.parent,c+=a[u.id],h+=a[g.id];if((f=d[i.id]+h+r+.5*(p(n)+p(i))-(d[n.id]+c))>0){for(w=0,m=e;m&&m!==g;m=m.prev)++w;if(!m)return;for(y=f/w,m=e;m!==g;m=m.prev)d[m.id]+=f,a[m.id]+=f,f-=y}++s,n=n.first&&!A(n)?n.first:t(e,0,s)}}(l)):d[f]=v}}(e,0),ne(u,l),function e(t,n,i){var r,o,s,l;if(r=t.id,o=Math.round(d[r]+i-.5*p(t)),s=u[n-1],t.left=o,t.top=s,t.first&&!A(t))for(l=t.first;l;l=l.next)e(l,n+1,i+a[r])}(e,0,0),ae(e),c&&ee(e);return{depthOffset:u,groups:f}},w[n.Drawing.BRANCHED]=function(e){function t(n,r,d){var c;if(n.depth=r,i(h,n.depth+1,s(n)),!n.first||A(n))return n.transversalDepth=Math.max(o[r]||0,d),o[r]=n.transversalDepth+1,void i(l,n.transversalDepth+1,a(n));if(c=n.first,$(e,c,0),t(c,r+1,Math.max(o[r]||0,d)),n.transversalDepth=c.transversalDepth,d=o[r]=n.transversalDepth+1,i(l,n.transversalDepth+1,a(n)),c=c.next)if(c===n.last)$(e,c,3),t(c,r,d);else{for(;c;c=c.next)$(e,c,2),t(c,r+1,d);o[r]=n.last.transversalDepth+1}}function i(e,t,n){n<e[t]||(e[t]=n)}var r,o,a,s,d,l,h;r=e.drawingModifiers&n.DrawingModifiers.HORIZONTAL,o=[],l=[0],h=[0],r?(a=re,s=ie):(a=ie,s=re);for(e.left=0,e.top=0,oe(e),d=e.first;d;d=d.next)t(d,0,0);ne(l,e.siblingPadding),ne(h,e.rowPadding),function(){var t;for(t=e.first;t;t=t.dftNext(e,A(t)))t.left=l[t.transversalDepth],t.top=h[t.depth]}(),ae(e),r&&ee(e)},w[n.Drawing.TWO_BRANCHES]=te,w[n.Drawing.TWO_BRANCHES_LEAVES_ON_EXTREMITY]=function(e){return te.call(this,e,{leavesOnExtremity:!0})};var y=0,v=1,_=["width","height"];function N(){this.property=-1,this.next=null,this.prev=null,this.node=null,this.duration=0,this.startTime=NaN,this.startValue=0,this.endValue=0}function C(e,t,n,i,r){var o;switch(e){case y:o=t.widthAnimation;break;case v:o=t.heightAnimation;break;default:throw new Error("internal error")}switch(o&&x.call(this,o),(o=this.animationCache.length?this.animationCache.pop():new N).reset(e,t,n,i,r),e){case y:t.widthAnimation=o;break;case v:t.heightAnimation=o;break;default:throw new Error("internal error")}this.animationList.addLast(o)}function x(e){var t;switch(t=e.node,e.property){case y:if(t.widthAnimation!==e)throw new Error("internal error");t.widthAnimation=null;break;case v:if(t.heightAnimation!==e)throw new Error("internal error");t.heightAnimation=null;break;default:throw new Error("internal error")}this.lastAnimation===e&&(this.lastAnimation=e.prev),this.animationList.remove(e),this.animationCache.push(e)}function E(e,t){this.id=e,this.factory=t}function b(e){return"number"==typeof e&&e>0&&isFinite(e)}function T(e){return"number"==typeof e&&e>=0&&isFinite(e)}function S(e){return void 0===e}function D(e){return"number"==typeof e&&(0|e)===e}function M(e){return"number"==typeof e&&(0|e)===e}N.prototype.reset=function(e,t,n,i,r){this.property=e,this.next=null,this.prev=null,this.node=t,this.duration=n,this.startTime=NaN,this.startValue=i,this.endValue=r},n.Document=function(e){n.Node.call(this,e),t.Observable.call(this),this.document=this,this.gr=new t.EGraph;this.gr.setZoomOpts({customMgt:!0}),this.gr.data=this,this.nodeViewFactories=[],this.groupViewFactories=[],this.edgeViewFactories=[],this.tempNodeViewFactories=[],this.tempGroupViewFactories=[],this.tempEdgeViewFactories=[],this.expanded=!0,this.requestAnimationFramePending=!1,this.positionsAnimationStart=1/0,this.animationList=new t.List,this.animateUpdate=!0,this.lastAnimation=null,this.fixNode=null,this.fixNodeLeft=NaN,this.fixNodeTop=NaN,this.fixNodeWidth=NaN,this.fixNodeHeight=NaN,this.fixNodeAlignmentH=0,this.fixNodeAlignmentV=0,this.__updatedNodes__=[],this.nodeWidth=50,this.nodeHeight=50,this.groupWidth=100,this.groupHeight=80,this.groupEmptyWidth=50,this.groupEmptyHeight=50,this.groupPaddingTop=20,this.groupPaddingRight=20,this.groupPaddingBottom=20,this.groupPaddingLeft=20,this.groupColPadding=10,this.groupRowPadding=10,this.groupAspectRatio=1.5,this.siblingPadding=10,this.subtreePadding=void 0,this.rowPadding=10,this.mergeConnectorPadding=2,this.drawing=n.Drawing.LAYERED_TIDY_1,this.drawingModifiers=0,this.drawingData=void 0,this.updateLockCount=0,this.parentTopCstr=null,this.parentBottomCstr=null,this.parentLeftCstr=null,this.parentRightCstr=null,this.childrenTopCstr=null,this.childrenBottomCstr=null,this.childrenLeftCstr=null,this.childrenRightCstr=null,this.sideParentTopCstr=null,this.sideParentBottomCstr=null,this.sideParentLeftCstr=null,this.sideParentRightCstr=null,this.mergeParentTopCstr=null,this.mergeParentBottomCstr=null,this.mergeParentLeftCstr=null,this.mergeParentRightCstr=null,this.mergeChildrenTopCstr=null,this.mergeChildrenBottomCstr=null,this.mergeChildrenLeftCstr=null,this.mergeChildrenRightCstr=null,this.auxChildrenTopCstr=null,this.auxChildrenBottomCstr=null,this.auxChildrenLeftCstr=null,this.auxChildrenRightCstr=null,this.parentConnectorCstr=null,this.childrenConnectorCstr=null,this.sideParentConnectorCstr=null,this.mergeParentConnectorCstr=null,this.mergeChildrenConnectorCstr=null,this.auxChildrenConnectorCstr=null,this.alignmentH=0,this.alignmentV=0,this.geometry=null,this.onnodedetached=null,this.__docUpdateFlags__=4,this.__debug_flags__=0,this.animationCache=[]},e.inherit(n.Document,n.Node),e.applyMixin(n.Document,t.Observable),n.Document.Type=1,n.Document.TypeString="document",n.Document.prototype.type=n.Document.Type,n.Document.prototype.typeString=n.Document.TypeString,n.Document.prototype.animationDuration=150,E.prototype.toString=function(){return this.id+":"+this.factory.name},n.Document.prototype.vetoUpdateAnimation=function(){if(!this.updateLockCount)throw new Error("can apply veto when update is not locked");this.animateUpdate=!1},b.desc="a strictly positive finite number",T.desc="a positive or zero finite number",S.desc="undefined",D.desc="an integer in etree/tree.Drawing",M.desc="a combination of values in etree/tree.DrawingModifiers";var P,L,O,R=function(e){var t;return t=Object.create(null),e.forEach(function(e){t[e.key]=e}),t}([{key:"nodeHeight",predicate:b,docUpdateFlags:16},{key:"groupWidth",predicate:b,docUpdateFlags:16},{key:"nodeWidth",predicate:b,docUpdateFlags:16},{key:"groupHeight",predicate:b,docUpdateFlags:16},{key:"groupEmptyWidth",predicate:b,docUpdateFlags:16},{key:"groupEmptyHeight",predicate:b,docUpdateFlags:16},{key:"groupPaddingTop",predicate:T,docUpdateFlags:8},{key:"groupPaddingRight",predicate:T,docUpdateFlags:8},{key:"groupPaddingBottom",predicate:T,docUpdateFlags:8},{key:"groupPaddingLeft",predicate:T,docUpdateFlags:8},{key:"groupColPadding",predicate:T,docUpdateFlags:8},{key:"groupRowPadding",predicate:T,docUpdateFlags:8},{key:"groupAspectRatio",predicate:b,docUpdateFlags:8},{key:"siblingPadding",predicate:T,docUpdateFlags:8},{key:"subtreePadding",predicate:(P=S,L=T,(O=function(e){return P(e)||L(e)}).desc=P.desc+" or "+L.desc,O),docUpdateFlags:8},{key:"rowPadding",predicate:T,docUpdateFlags:8},{key:"mergeConnectorPadding",predicate:T,docUpdateFlags:8},{key:"drawing",predicate:D,docUpdateFlags:1},{key:"drawingModifiers",predicate:M,docUpdateFlags:2}]);function A(e){return!e.expanded||e.type===n.Group.Type}function G(){var e=this;this.requestAnimationFramePending||(this.requestAnimationFramePending=!0,i(function(t){pe(e,k,[t])}))}function k(e){var t;this.requestAnimationFramePending=!1,this.gr.withLockedUpdate(function(){t=0,t|=function(){var t,n,i,r,o,a;for(t=this.animationList.first;t;t=n)n=t.next,(r=t.startTime)==r?(i=t.node,o=(e-r)/t.duration,a=(1-(o=Math.max(0,Math.min(1,o))))*t.startValue+o*t.endValue,i.grNode.set(_[t.property],a),1===o&&x.call(this,t)):t.startTime=e;return this.animationList.first?1:0}.call(this),t|=function(){var t,n,i,r,o,a;if(this.positionsAnimationStart===1/0)return 0;if(isNaN(this.positionsAnimationStart))return this.positionsAnimationStart=e,1;for(t=!0,i=(e-this.positionsAnimationStart)/this.animationDuration,r=1-(i=Math.max(0,Math.min(1,i))),n=this.first;n;n=n.dftNext(this,!n.grNode))!n.grNode||n.grNode.left===n.left&&n.grNode.top===n.top||(o=i*n.left+r*n.startLeft,a=i*n.top+r*n.startTop,t=!1,n.grNode.multiset("left",o,"top",a));return t?(this.positionsAnimationStart=1/0,pe(this,V,[]),0):1}.call(this)},this),t&&G.call(this)}function V(){var e,t,i;this.gr.withLockedUpdate(function(){for(e=this.first;e;e=e.dftNext(this,!e.expanded))if(e.type!==n.Group.Type||e.expanded||e.grNode.collapsed||e.grNode.set("collapsed",!0),!e.expanded)for(t=e.first;t;t=t.dftNext(e,i))t.grNode?(i=!1,this.gr.removeNode(t.grNode),t.grNode=t.grParentC=t.grMergeParentC=t.grMergeChildrenC=t.grChildrenC=t.grAuxChildrenC=null,t.widthAnimation&&x.call(this,t.widthAnimation),t.heightAnimation&&x.call(this,t.heightAnimation)):i=!0},this)}function F(e){0==(1&e.__updateFlags__)&&(e.__updateFlags__|=1,this.__updatedNodes__.push(e))}n.Document.prototype.set=function e(t,n){var i;if(!(i=R[t]))throw new Error("property "+t+" can't be set");if(!i.predicate(n))throw new Error(t+" must be "+i.predicate.desc);if(!this.updateLockCount)return m(this,this,e,t,n);n!==this[t]&&(this[t]=n,this.__docUpdateFlags__|=i.docUpdateFlags)},n.Document.prototype.setFixNode2=function(t,i){var r,o,a,s,d,l,h,c,u;if(!t)return this.fixNode=null,this.fixNodeLeft=NaN,this.fixNodeTop=NaN,this.fixNodeWidth=NaN,this.fixNodeHeight=NaN,this.fixNodeAlignmentH=0,void(this.fixNodeAlignmentV=0);if(!(t instanceof n.Node)||t.type!==n.Node.Type&&t.type!==n.Group.Type)throw new Error("node must be a Node");if(t.document!==this)throw new Error("node must be in this document");switch(c=e.finite_number_or_nan_opt(i,"alignmentH",NaN),u=e.finite_number_or_nan_opt(i,"alignmentV",NaN),l=typeof(d=i&&i.position||"current")){case"string":for(h=t;h&&!h.grNode;h=h.parent);if(!h)throw new Error("no position can be computed for since none of this parent have ever been visualized");switch(d){case"current":r=h.grNode.left,o=h.grNode.top,a=h.grNode.width,s=h.grNode.height;break;case"final":r=h.left,o=h.top,a=ie(h),s=re(h);break;default:throw new Error('opts.position string must be either "current" or "final", not '+d)}break;case"object":if(r=d.left,o=d.top,!isFinite(r)||!isFinite(o))throw new Error("opts.position.left and opts.position.top must be finite numbers");a=ie(t),s=re(t);break;default:throw new Error("opts.position must be either a string or an object, not "+l)}this.fixNode=t,this.fixNodeLeft=r,this.fixNodeTop=o,this.fixNodeWidth=a,this.fixNodeHeight=s,this.fixNodeAlignmentH=c,this.fixNodeAlignmentV=u},n.Document.prototype.setFixNode=function(e,t){var n;(n=Object.create(t||Object.prototype)).alignmentH=0,n.alignmentV=0,this.setFixNode2(e,n)},n.Document.prototype.setDrawing=function e(t,n){if(!this.updateLockCount)return m(this,this,e,t,n);void 0!==t&&this.set("drawing",t),void 0!==n&&this.set("drawingModifiers",n)},n.Document.prototype.getBounds=function(){var t,n;for(t=new e.BoundingRect,n=this.first;n;n=n.dftNext(this,A(n)))t.update(n,n.left,n.left+ie(n),n.top,n.top+re(n));return t},n.Document.prototype.addView2=function(e,t,i){function r(t,n){var r;switch(typeof(r=i[n])){case"undefined":return;case"function":break;default:throw new Error("opts."+n+" should be undefined or a function")}return t.push(new E(e,r)),r}var o,a,s;if(void 0===i)i={};else if("object"!=typeof i||!i)throw new Error("opts must be an object or undefined");if(this.gr.views.hasOwnProperty(e))throw new Error('graph already has a "'+e+'" view');o=r(this.nodeViewFactories,"newNodeView"),r(this.tempNodeViewFactories,"newTempNodeView"),a=r(this.groupViewFactories,"newGroupView"),r(this.tempGroupViewFactories,"newTempGroupView"),s=r(this.edgeViewFactories,"newEdgeView"),r(this.tempEdgeViewFactories,"newTempEdgeView"),(o||s)&&pe(this,function(){var t,i,r,d,l;for(i=this.first;i;i=i.dftNext(this,!i.grNode)){switch(i.type){case n.Node.Type:t=o;break;case n.Group.Type:t=a;break;default:throw new Error("internal error")}t&&i.grNode&&(r=t(i))&&(i.grNode.views[e]=r),s&&i.grParentC&&(d=i.grParentC.children.first)&&(l=d.ref,(r=s(l))&&(l.views[e]=r))}},[]),pe(this.gr,this.gr.addView,[e,t],"gr.addView")},n.Document.prototype.addView=function(e,t,n,i,r,o){function a(e,t){switch(typeof t){case"function":return function(e){return new t(e)};case"undefined":return;default:throw new Error(e+" should be a function or undefined")}}this.addView2(e,t,{newNodeView:a("nodeViewCtor",n),newEdgeView:a("edgeViewCtor",i),newTempNodeView:a("tempNodeViewCtor",r),newTempEdgeView:a("tempEdgeViewCtor",o)})},n.Document.prototype.setExpanded=function(){throw new Error("can't collapse/expand the document")},n.Document.prototype.getActualWidth=function(){return 0},n.Document.prototype.getActualHeight=function(){return 0},n.Document.prototype.getGeometryFromOptions=function(e){var t,i,r,o,a,s,d;if(e&&e.edges){if("object"!=typeof e.edges||"string"!=typeof e.edges.type)throw new Error("opts.edges must be an object with a 'type' string property");r=e.edges}else r={type:"rounded-square"};if(o=e&&e.childrenAttachmentOffset?0|e.childrenAttachmentOffset:0,Math.abs(o)>this.rowPadding)throw new Error("absolute value of childrenAttachmentOffset must be less or equal to rowPadding");switch(void 0===(s=this.subtreePadding)&&(s=this.siblingPadding),r.type){case"auto-bezier":d=new n.AutoBezierGeometry(o,0);break;case"rounded-square":switch(typeof r.offset){case"undefined":i=o>=0?this.rowPadding-o>>>1:o>>1;break;case"number":if(!isFinite(r.offset)||Math.abs(r.offset)>(o>=0?this.rowPadding-o:-o))throw new Error("opts.edges.offset must be finite number whose absolute value is smaller or equal to the row padding minus opts.edges.childrenAttachmentOffset");i=r.offset;break;default:throw new Error("opts.edges.offset must be a number or undefined")}switch(typeof r.radius){case"undefined":t=Math.min(o>=0?this.rowPadding-o:-o,this.siblingPadding,s)>>>2;break;case"number":if(!isFinite(r.radius)||r.radius<0||r.radius>Math.abs(i))throw new Error("opts.edges.radius must be finite positive number smaller or equal to half the available space after padding and attachment offset");t=r.radius;break;default:throw new Error("opts.edges.radius must be a number or undefined")}a=Math.min(s,this.siblingPadding)>>>1,d=new n.RoundedSquareGeometry(t,i<0?i:i+o,a);break;default:throw new Error("opts.edges.type must be either 'auto-bezier' or 'rounded-square'")}return d},n.Document.prototype.updateLock=function(){n.traceUpdates&&console.log("locking document "+this),this.updateLockCount+=1,1===this.updateLockCount&&(this.gr.updateLock(),this.animateUpdate=!0)},n.Document.prototype.updateUnlock=function(){if(!this.updateLockCount)throw new Error("can't unlock a not locked document!");if(this.updateLockCount-=1,n.traceUpdates&&console.log("unlocking document "+this+" "+(this.updateLockCount?"still ":"un")+"locked"),!this.updateLockCount)try{n.traceUpdates&&console.log("update of tree "+this+" with"+(this.animateUpdate?"":"out")+" animation"),pe(this,j,[]),n.traceUpdates&&console.log("update of tree "+this+" done, updating egraph now")}finally{pe(this.gr,this.gr.updateUnlock,[],"EGraph#updateUnlock")}},n.Document.prototype.withLockedUpdate=function(e,t){this.updateLock();try{return e.call(t)}finally{this.updateUnlock()}},n.Document.prototype.isUpdated=function(){return!this.updateLockCount},n.Document.prototype.update=function(){if(arguments.length)throw new Error("use Document#setFixNode2 now");this.updateLock(),this.updateUnlock()},n.Document.prototype.newTempGrNode=function(e){var t;switch(e.type){case n.Node.Type:return J(this,e,this.tempNodeViewFactories,this.tempNodeViewFactories.length);case n.Group.Type:return(t=J(this,e,this.tempGroupViewFactories,this.tempGroupViewFactories.length)).multiset("width",e.getCollapsedWidth(),"height",e.getCollapsedHeight()),t;default:throw new Error("node must be either a node or a group")}},n.Document.prototype.newTempGrNode2=function(e){var n,i,r,o,a,s;for(n=new t.Node,r=(i=this.tempNodeViewFactories).length,a=0;a<r;++a)(s=(o=i[a]).factory.call(void 0,e))&&(n.views[o.id]=s);return n};var I={temporary:!0};function H(e,t){this.mask=e,this.path=t}n.Document.prototype.newTempGrEdge=function(){return Q([],this.tempEdgeViewFactories,this.tempEdgeViewFactories.length,this.geometry,I)},n.Document.prototype.newDragNode=function(e){var t;switch(e.type){case n.Node.Type:t=new n.Node(e.data);break;case n.Group.Type:(t=new n.Group(e.data)).expandedWidth=e.expandedWidth,t.expandedHeight=e.expandedHeight;break;default:throw new Error("node must be a node or a group")}switch(t.document=this,t.height=e.height,t.displayFlags|=n.DisplayFlags.DRAG_NODE,t.expanded=!1,e.type){case n.Node.Type:t.grNode=J(this,t,this.nodeViewFactories,this.nodeViewFactories.length);break;case n.Group.Type:t.grNode=K(this,t,this.groupViewFactories,this.groupViewFactories.length);break;default:throw new Error("node must be a node or a group")}return t.grNode.data=t,t},H.prototype.toString=function(){return this.path.join(".")};var B,U,z=new H(64,["data","*children*"]),W=new H(16,["data","expanded"]),q=new H(256,["data","displayFlags"]),Z=new H(8192,["data","height"]),Y={temporary:!1};function X(){(function(){var e,t,i;this.geometry||(e=Math.min(this.rowPadding,this.siblingPadding,void 0!==this.subtreePadding?this.subtreePadding:this.siblingPadding)>>>2,t=this.rowPadding>>>1,i=(void 0!==this.subtreePadding?Math.min(this.subtreePadding,this.siblingPadding):this.siblingPadding)>>>1,this.geometry=new n.RoundedSquareGeometry(e,t,i))}).call(this),function(){var e=this;function t(){return new s}function n(){return new d}function i(){return new l}function r(){return new h}function o(){return new s({offset:-e.mergeConnectorPadding})}function a(){return new d({offset:e.mergeConnectorPadding})}function c(){return new l({offset:-e.mergeConnectorPadding})}function u(){return new h({offset:e.mergeConnectorPadding})}this.parentTopCstr||(this.parentTopCstr=t()),this.parentBottomCstr||(this.parentBottomCstr=n()),this.parentLeftCstr||(this.parentLeftCstr=i()),this.parentRightCstr||(this.parentRightCstr=r()),this.childrenTopCstr||(this.childrenTopCstr=t()),this.childrenBottomCstr||(this.childrenBottomCstr=n()),this.childrenLeftCstr||(this.childrenLeftCstr=i()),this.childrenRightCstr||(this.childrenRightCstr=r()),this.sideParentTopCstr||(this.sideParentTopCstr=t()),this.sideParentBottomCstr||(this.sideParentBottomCstr=n()),this.sideParentLeftCstr||(this.sideParentLeftCstr=i()),this.sideParentRightCstr||(this.sideParentRightCstr=r()),this.mergeParentTopCstr||(this.mergeParentTopCstr=o()),this.mergeParentBottomCstr||(this.mergeParentBottomCstr=a()),this.mergeParentLeftCstr||(this.mergeParentLeftCstr=c()),this.mergeParentRightCstr||(this.mergeParentRightCstr=u()),this.mergeChildrenTopCstr||(this.mergeChildrenTopCstr=o()),this.mergeChildrenBottomCstr||(this.mergeChildrenBottomCstr=a()),this.mergeChildrenLeftCstr||(this.mergeChildrenLeftCstr=c()),this.mergeChildrenRightCstr||(this.mergeChildrenRightCstr=u()),this.auxChildrenTopCstr||(this.auxChildrenTopCstr=t()),this.auxChildrenBottomCstr||(this.auxChildrenBottomCstr=n()),this.auxChildrenLeftCstr||(this.auxChildrenLeftCstr=i()),this.auxChildrenRightCstr||(this.auxChildrenRightCstr=r())}.call(this)}function j(){function e(e){var t;if(e.grNode){if(a||(a=[]),e.grParentC.children.first&&a.push(e.grParentC.children.first.ref),e.grMergeParentC&&e.grMergeParentC.children.first&&a.push(e.grMergeParentC.children.first.ref),e.grMergeChildrenC&&e.grMergeChildrenC.children.first&&a.push(e.grMergeChildrenC.children.first.ref),e.grChildrenC)for(t=e.grChildrenC.children.first;t;t=t.next)a.push(t.ref);if(e.grAuxChildrenC)for(t=e.grAuxChildrenC.children.first;t;t=t.next)a.push(t.ref);o.removeNode(e.grNode),e.grNode=e.grParentC=e.grMergeParentC=e.grMergeChildrenC=e.grChildrenC=e.grAuxChildrenC=null,e.widthAnimation&&x.call(this,e.widthAnimation),e.heightAnimation&&x.call(this,e.heightAnimation)}}function i(e,n){0==(e.__updateFlags__&n.mask)&&(0==(1&e.__updateFlags__)&&(e.__updateFlags__|=1,this.__updatedNodes__.push(e)),e.__updateFlags__|=n.mask,e.grNode&&e.grNode.notify(new t.UpdatedNotif(n.path,void 0)))}function r(e,t){return Q(a,s,d,t||h,Y,e)}var o,a,s,d,l,h,c,u,p;(function(){var e;(e=7&this.__debug_flags__)<7&&(e+=1),this.__debug_flags__=e}).call(this),p=this.drawingData,this.drawingData=void 0,u=!1,31&this.__docUpdateFlags__&&(n.traceUpdates&&console.log("modifications of document triggered the redraw (computation of positions) of the tree"),u=!0),4&this.__docUpdateFlags__&&X.call(this),o=this.gr,s=this.edgeViewFactories,d=s.length,h=this.geometry,o.updateLock();try{pe(this,function(){var e,t;if(t=null,e=this.fixNode){do{t=e,e=e.parent}while(e&&e.expanded);(e||t!==this)&&this.setFixNode2(null)}if(!this.fixNode)for(e=this.first;e;e=e.dftNext(this,!e.expanded))if(e.grNode){this.setFixNode2(e);break}},[]),pe(this,function(){var e;6&this.__docUpdateFlags__&&(n.traceUpdates&&console.log("updating alignments after change of drawing modifiers"),this.alignmentH=.5,this.alignmentV=this.drawingModifiers&n.DrawingModifiers.MIRROR_DEPTH?1:0,this.drawingModifiers&n.DrawingModifiers.HORIZONTAL&&(e=this.alignmentH,this.alignmentH=this.alignmentV,this.alignmentV=e))},[]),pe(this,function(){var e,n,r,o;for(e=0,n=this.__updatedNodes__.length;e<n;++e)2&(r=this.__updatedNodes__[e]).__updateFlags__&&i.call(this,r.parent,z),4&r.__updateFlags__&&i.call(this,r.__lastParent__,z),8&r.__updateFlags__&&i.call(this,r,W),128&r.__updateFlags__&&i.call(this,r,q),4096&r.__updateFlags__&&i.call(this,r,Z);if(2&this.__docUpdateFlags__)for(o=["data","*drawingModifiers*"],r=this.first;r;r=r.dftNext(this,!r.grNode))r.grNode&&r.grNode.notify(new t.UpdatedNotif(o,void 0))},[]),pe(this,function(){var e,t,i;if(!u)for(e=0,t=this.__updatedNodes__.length;e<t;++e)if(22030&(i=this.__updatedNodes__[e]).__updateFlags__)return n.traceUpdates&&console.log("modifications of "+i+" triggered the redraw (computation of positions) of the tree"),void(u=!0)},[]),pe(this,function(){var t,n,i,r;for(t=0,n=this.__updatedNodes__.length;t<n;++t)if(4==(38&(i=this.__updatedNodes__[t]).__updateFlags__))for(r=i;r;r=r.dftNext(i))i.__updateFlags__|=32,this.onnodedetached&&this.onnodedetached(r),r.document=null,e.call(this,r)},[]),pe(this,function(){var e;if(16&this.__docUpdateFlags__)for(e=this.first;e;e=e.dftNext(this))e.grNode&&e.type===n.Node.Type&&(e.grNode.multiset("width",ie(e),"height",re(e)),e.widthAnimation&&x.call(this,e.widthAnimation),e.heightAnimation&&x.call(this,e.heightAnimation))},[]),u?(c=pe(void 0,se,[this]),pe(this,function(){var e,t,i,r,o,a,s,d,l,h;for((i=this.drawingModifiers)&(r=n.DrawingModifiers).HORIZONTAL?(o=i&r.MIRROR_DEPTH,a=i&r.MIRROR_SIBLINGS):(o=i&r.MIRROR_SIBLINGS,a=i&r.MIRROR_DEPTH),e=this.first;e;e=e.dftNext(this,!e.expanded))if(o&&(e.left=-e.left-ie(e)),a&&(e.top=-e.top-re(e)),e.first&&!e.expanded)for(s=e.left,d=e.top,l=ie(e),h=re(e),t=e.first;t;t=t.dftNext(e,!t.grNode))t.grNode&&(t.left=s+this.alignmentH*(l-ie(t)),t.top=d+this.alignmentV*(h-re(t)))},[])):c=p,pe(this,function(){var e,t,i,r,o,a,s,d,h,c;if(6&this.__docUpdateFlags__){switch(n.traceUpdates&&console.log("updating constraints after change of drawing modifiers"),e=this.drawingModifiers,t=n.DrawingModifiers.HORIZONTAL,i=n.DrawingModifiers.MIRROR_DEPTH,r=n.DrawingModifiers.MIRROR_SIBLINGS,e&(t|i)){case 0:this.parentConnectorCstr=this.parentTopCstr,this.mergeParentConnectorCstr=this.mergeParentTopCstr,this.mergeChildrenConnectorCstr=this.mergeChildrenBottomCstr,this.childrenConnectorCstr=this.childrenBottomCstr;break;case t:this.parentConnectorCstr=this.parentLeftCstr,this.mergeParentConnectorCstr=this.mergeParentLeftCstr,this.mergeChildrenConnectorCstr=this.mergeChildrenRightCstr,this.childrenConnectorCstr=this.childrenRightCstr;break;case i:this.parentConnectorCstr=this.parentBottomCstr,this.mergeParentConnectorCstr=this.mergeParentBottomCstr,this.mergeChildrenConnectorCstr=this.mergeChildrenTopCstr,this.childrenConnectorCstr=this.childrenTopCstr;break;default:this.parentConnectorCstr=this.parentRightCstr,this.mergeParentConnectorCstr=this.mergeParentRightCstr,this.mergeChildrenConnectorCstr=this.mergeChildrenLeftCstr,this.childrenConnectorCstr=this.childrenLeftCstr}switch(e&(t|r)){case 0:this.auxChildrenConnectorCstr=this.auxChildrenRightCstr,this.sideParentConnectorCstr=this.sideParentLeftCstr;break;case t:this.auxChildrenConnectorCstr=this.auxChildrenBottomCstr,this.sideParentConnectorCstr=this.sideParentTopCstr;break;case r:this.auxChildrenConnectorCstr=this.auxChildrenLeftCstr,this.sideParentConnectorCstr=this.sideParentRightCstr;break;default:this.auxChildrenConnectorCstr=this.auxChildrenTopCstr,this.sideParentConnectorCstr=this.sideParentBottomCstr}for(s=this.parentConnectorCstr,o=this.sideParentConnectorCstr,a=this.mergeParentConnectorCstr,c=this.mergeChildrenConnectorCstr,d=this.childrenConnectorCstr,h=this.auxChildrenConnectorCstr,l=this.first;l;l=l.dftNext(this,!l.grNode))l.grNode&&(l.grParentC.set("cstr",1&l.__configFlags__?o:s),l.__updateFlags__&=-513,l.grChildrenC&&l.grChildrenC.set("cstr",d),l.grAuxChildrenC&&l.grAuxChildrenC.set("cstr",h),l.grMergeParentC&&(l.grMergeParentC.set("cstr",a),a.onupdate(l.grMergeParentC)),l.grMergeChildrenC&&(l.grMergeChildrenC.set("cstr",c),a.onupdate(l.grMergeChildrenC)))}},[]),pe(this,function(){var e,i,a,s,d,l,h,c,u,p,g,f,m;for((m=this).mergeEdgeGeomCol=m.mergeEdgeGeomCol||[],h=(l=m.nodeViewFactories).length,u=(c=m.groupViewFactories).length,f=[],e=m.first;e;e=e.dftNext(m,!e.expanded)){if(!e.grNode){switch(e.type){case n.Node.Type:a=J(m,e,l,h);break;case n.Group.Type:a=K(m,e,c,u);break;default:throw new Error("internal error")}if(a.data=e,e.grNode=a,e.grParentC=new t.Connector(void 0,void 0,1&e.__configFlags__?m.sideParentConnectorCstr:m.parentConnectorCstr),e.__updateFlags__&=-513,e.grNode.appendConnector(e.grParentC),e.type===n.Node.Type&&(e.grChildrenC=new t.Connector(void 0,void 0,m.childrenConnectorCstr),e.grNode.appendConnector(e.grChildrenC),e.grAuxChildrenC=new t.Connector(void 0,void 0,m.auxChildrenConnectorCstr),e.grNode.appendConnector(e.grAuxChildrenC),e.grMergeParentC=new t.Connector(void 0,void 0,m.mergeParentConnectorCstr),e.grNode.appendConnector(e.grMergeParentC),e.grMergeChildrenC=new t.Connector(void 0,void 0,m.mergeChildrenConnectorCstr),e.grNode.appendConnector(e.grMergeChildrenC)),o.addNode(a),s=e.parent.grNode){if(p=s.left+m.alignmentH*(s.width-a.width),g=s.top+m.alignmentV*(s.height-a.height),a.multiset("left",p,"top",g),e.parent.type===n.Node.Type){var w=2&e.__configFlags__?e.parent.grAuxChildrenC:e.parent.grChildrenC,y=e.grParentC;d=r({startNode:e.parent,endNode:e}),o.addEdge(w,y,d)}e.__updateFlags__&=-1025}else a.multiset("top",e.top,"left",e.left);if(e.type===n.Node.Type)for(i=e.first;i;i=i.next)i.grNode&&(d=r(),o.addEdge(2&i.__configFlags__?e.grAuxChildrenC:e.grChildrenC,i.grParentC,d),i.__updateFlags__&=-1025)}if(e.mergeParent)for(var v=0;v<e.mergeParent.length;v++)e.mergeParent[v]&&f.push({mergeParent:e.mergeParent[v],mergeChild:e})}for(f.forEach(function(e){var t,i=e.mergeParent.grMergeChildrenC,a=e.mergeChild.grMergeParentC;i&&a&&m.drawing===n.Drawing.TWO_BRANCHES_LEAVES_ON_EXTREMITY&&!function(e,t){if(e.children.first)for(var n=e.children.first;n;n=n.next)if(n.ref.cl1.c===e&&n.ref.cl2.c===t||n.ref.cl1.c===t&&n.ref.cl2.c===e)return!0;return!1}(i,a)&&(m.mergeEdgeGeomCol.forEach(function(n){n.mergeParent==e.mergeParent&&n.mergeChild==e.mergeChild&&(t=n.mergeEdgeGeom)}),d=r({startNode:e.mergeParent,endNode:e.mergeChild},t),function(e,t,i){var r=n.DrawingModifiers.HORIZONTAL,o=n.DrawingModifiers.MIRROR_DEPTH;switch(i&(r|o)){case 0:e.anormx=0,e.anormy=1,t.anormx=0,t.anormy=-1;break;case o:e.anormx=0,e.anormy=-1,t.anormx=0,t.anormy=1;break;case r:e.anormx=1,e.anormy=0,t.anormx=-1,t.anormy=0;break;default:e.anormx=-1,e.anormy=0,t.anormx=1,t.anormy=0}}(i,a,m.drawingModifiers),o.addEdge(i,a,d),e.mergeParent.__updateFlags__&=-65)});m.mergeEdgeGeomCol.length;)m.mergeEdgeGeomCol.pop()},[]),pe(this,function(){var t,i,s,d,l;for(t=0,i=this.__updatedNodes__.length;t<i;++t){if(!(s=this.__updatedNodes__[t]).mergeParent&&s.grMergeParentC&&s.grMergeParentC.children.first){var h=s.grMergeParentC.children.first.ref;o.removeEdge(h),a||(a=[]),a.push(h)}else if(s.mergeParent&&s.grMergeParentC&&s.grMergeParentC.children.first)for(var c=s.grMergeParentC.children.first;c;c=c.next){var u=c.ref.cl1.c.node.data,p=c.ref.cl2.c.node.data,g=!1;s!==u&&s===p?-1===s.mergeParent.indexOf(u)&&(g=!0):s===u&&s!==p&&-1===s.mergeParent.indexOf(p)&&(g=!0),g&&(h=c.ref,o.removeEdge(h),a||(a=[]),a.push(h),g=!1)}if((6==(6&s.__updateFlags__)&&s.__lastParent__!==s.parent||1024&s.__updateFlags__)&&(s.grParentC&&s.grParentC.children.first&&(h=s.grParentC.children.first.ref,o.removeEdge(h),a||(a=[]),a.push(h)),s.grParentC&&s.parent.grChildrenC&&(n.traceUpdates&&console.log("updating edge of "+s+" that has changed parent"),o.insertEdgeBefore(2&s.__configFlags__?s.parent.grAuxChildrenC:s.parent.grChildrenC,s.grParentC,r())),s.parent.type!==n.Document.Type&&!s.parent.grNode))for(n.traceUpdates&&console.log("remove edge and graph node of "+s+" since new parent is collapsed"),d=s;d;d=d.dftNext(s,l))d.grNode?(l=!1,n.traceUpdates&&console.log("  remove child "+s+" graph node since new parent is collapsed"),e.call(this,d)):l=!0;512&s.__updateFlags__&&s.grParentC.set("cstr",1&s.__configFlags__?this.sideParentConnectorCstr:this.parentConnectorCstr)}},[]),pe(this,function(){var e,t,n,i,r,o,a;if(this.fixNode&&this.fixNode.grNode&&this.fixNode.grNode.bringToFront(),this.fixNode)for(i=this.fixNodeAlignmentH,isNaN(i)&&(i=this.alignmentH),r=this.fixNodeAlignmentV,isNaN(r)&&(r=this.alignmentV),o=ie(this.fixNode),a=re(this.fixNode),this.fixNodeLeft+=i*(this.fixNodeWidth-o),this.fixNodeTop+=r*(this.fixNodeHeight-a),this.fixNodeWidth=o,this.fixNodeHeight=a,e=this.fixNodeLeft-this.fixNode.left,t=this.fixNodeTop-this.fixNode.top,this.left+=e,this.top+=t,n=this.first;n;n=n.dftNext(this,!n.grNode))n.left+=e,n.top+=t},[]),pe(this,function(){var e,t,i,r,o,a;if(t=!0,e=this.animateUpdate)for(l=this.first;l;l=l.dftNext(this,!l.grNode))!l.grNode||l.grNode.left===l.left&&l.grNode.top===l.top||(t=!1,l.startLeft=l.grNode.left,l.startTop=l.grNode.top);else for(l=this.first;l;l=l.dftNext(this,!l.grNode))!l.grNode||l.grNode.left===l.left&&l.grNode.top===l.top||l.grNode.multiset("left",l.left,"top",l.top);for(l=this.first;l;l=l.dftNext(this,!l.grNode))l.grNode&&l.type===n.Group.Type&&(l.expanded&&l.grNode.collapsed&&l.grNode.set("collapsed",!1),o=ie(l),l.grNode.width!==o&&((i=l.widthAnimation)&&i.endValue===o||C.call(this,y,l,this.animationDuration,l.grNode.width,o)),a=re(l),l.grNode.height!==a&&((i=l.heightAnimation)&&i.endValue===a||C.call(this,v,l,this.animationDuration,l.grNode.height,a)));for(i=this.lastAnimation?this.lastAnimation.next:this.animationList.first;i;i=r)r=i.next,e&&0!==i.duration&&i.startValue!==i.endValue||(i.node.grNode.set(_[i.property],i.endValue),x.call(this,i));this.lastAnimation=this.animationList.last,t?(this.positionsAnimationStart=1/0,pe(this,V,[])):this.positionsAnimationStart=NaN,t&&!this.animationList.first||G.call(this)},[])}finally{pe(o,o.updateUnlock,[],"gr.updateUnlock")}pe(this,function(){var e,t;for(e=0,t=this.__updatedNodes__.length;e<t;++e)this.__updatedNodes__[e].__updateFlags__=0;this.__updatedNodes__.length=0,this.__docUpdateFlags__=0},[]),pe(this,function(){this.animationCache.length=0},[]),this.drawingData=c}function J(e,n,i,r){var o,a,s,d;for((o=new t.Node).customPropertyFlags=t.PropertyFlag.VIEW,o.multiset("width",ie(n),"height",re(n)),a=0;a<r;++a)(d=(s=i[a]).factory.call(void 0,n))&&(o.views[s.id]=d);return o}function K(e,n,i,r){var o,a,s,d;for((o=new t.Group).customPropertyFlags=t.PropertyFlag.VIEW,o.multiset("width",ie(n),"height",re(n),"collapsed",!n.expanded),a=0;a<r;++a)(d=(s=i[a]).factory.call(void 0,n))&&(o.views[s.id]=d);return o}function Q(e,n,i,r,o,a){var s,d,l,h;if(e&&e.length)return e.pop();for((s=new t.Edge).data=o,s.set("geometry",r),d=0;d<i;++d)(h=(l=n[d]).factory.call(void 0,s,a))&&(s.views[l.id]=h);return s}function $(e,t,n){var i;if(t.__configFlags__!==n){if(-4&n)throw new Error("flags contains invalid bits");i=t.__configFlags__^n,t.__updateFlags__|=i<<9,t.__configFlags__=n,F.call(e,t)}}function ee(e){var t,n;for(t=e.first;t;t=t.dftNext(e,!t.expanded))n=t.top,t.top=t.left,t.left=n}function te(e,t){t=t||{};let i=Object.assign({},e.drawingOpts);function r(t,o,s){var c,g,m,w,y,v;if(t.type===n.Group.Type?g=m=null:(g=t.first)&&(m=g.next),i.leavesOnExtremity&&t.isLeaf()&&(w=!0),y=i.leavesOnExtremity?f:o,v=i.leavesOnExtremity&&w?f:o,m&&m.next)throw new Error("there can be only two intermediate children");if(t.depth=v,t._actualPositionsSet=!1,a(p,t.depth+1,h(t)),g&&g.first&&t.expanded&&g.expanded?(c=g.first,$(e,c,0),r(c,o+1,Math.max(d[o]||0,s)),t.transversalDepth=c.transversalDepth,a(u,t.transversalDepth+1,l(t)),d[o]=t.transversalDepth+1):(t.transversalDepth=Math.max(d[y]||0,s),d[v]=t.transversalDepth+1,a(u,t.transversalDepth+1,l(t))),s=d[o],c=m&&t.expanded&&m.expanded?m.first:null)if(c===m.last){let t=3;(i.leavesOnExtremity||i.adjustedSingleChildLayout)&&(t=2),$(e,c,t);let n=o;i.adjustedSingleChildLayout&&(n=o+1),r(c,i.leavesOnExtremity?o+1:n,s),i.adjustedSingleChildLayout&&(d[o]=m.last.transversalDepth+1)}else{for(;c;c=c.next)$(e,c,2),r(c,o+1,s);d[o]=m.last.transversalDepth+1}}function o(e,t){function r(t){g(t,e)||(m&&!e._actualPositionsSet&&!w._actualPositionsSet&&e.depth>w.depth+1?(w===e.document?(e.depth=w.depth,e._actualPositionsSet=!1):w._actualPositionsSet||(e.depth=w.depth+1,e._actualPositionsSet=!1),r(t)):e._actualPositionsSet||(t.depth=e.depth+1,t._actualPositionsSet=!1,function e(t){var n;if(t){if((n=t.parent?t.parent.parent:null)&&!n._actualPositionsSet&&t.depth<=n.depth&&(t.depth=n.depth+1,t._actualPositionsSet=!1),a(p,t.depth+1,h(t)),t.depth>f&&(f=t.depth),t.first&&t.first.next)for(var i=t.first.next.last;i;i=i.prev)e(i);e(t.first?t.first.first:null)}}(t)))}var s,d,l,c,u,m,w;if(e){if(d=i.leavesOnExtremity?e.mergeParent:null,s=i.leavesOnExtremity?e.mergeChild:null,u=e.parent?e.parent.parent?e.parent.parent:e.parent:null,d)for(var y=0;y<d.length;y++)w=g(e,d[y])?u:d[y]&&d[y].depth>u.depth?w&&w.depth>d[y].depth?w:d[y]:u;else w=u;if(c=(l=e.type!==n.Group.Type?e.first:null)?l.next:null,i.leavesOnExtremity&&e.isLeaf()&&(m=!0),t&&m&&!s&&t.push(e),s)for(y=0;y<s.length;y++)s[y]&&r(s[y]);for(var v=c?c.last:null;v;v=v.prev)o(v,t);o(l?l.first:null,t)}}function a(e,t,n){n<e[t]||(e[t]=n)}var s,d,l,h,c,u,p,f,m;i=Object.assign(i,t),s=e.drawingModifiers&n.DrawingModifiers.HORIZONTAL,d=[],u=[0],p=[0],s?(l=re,h=ie):(l=ie,h=re),e.left=0,e.top=0,f=function e(t,n){var i=n;if(-1===n){for(var r=t.first;r;r=r.next)i=Math.max(i,e(r,n+1));return i}if(!t)return i-1;if(!t.first||!(t.first.expanded||t.first.next&&t.first.next.expanded))return i;if(t.first.expanded&&(i=Math.max(n,e(t.first.first,n+1))),t.first.next&&t.first.next.expanded)for(var o=t.first.next.first;o;o=o.next)i=Math.max(i,e(o,n+1));return i}(e,-1),oe(e),m=[];let w=0;for(c=e.first;c;c=c.next)!0===i.stackedRootsLayout&&(w=d.length),r(c,w,0),o(c,m);for(i.leavesOnExtremity&&m.forEach(function(e){e.depth=f}),c=e.first;c;c=c.dftNext(e))void 0!==c.verticalId?c.depth=c.verticalId:void 0!==c.parent.verticalId&&(c.depth=c.parent.verticalId),a(p,c.depth+1,h(c));return ne(u,e.siblingPadding),ne(p,e.rowPadding),function(){function t(e){var i,r,o,a,s;if(i=u[e.transversalDepth],r=p[e.depth],e.left=i,e.top=r,e._actualPositionsSet=!0,e.type!==n.Group.Type&&((o=e.first)&&(o.left=i,o.top=r,(a=o.next)&&(a.left=i,a.top=r)),e.expanded&&(o&&o.expanded&&(s=o.first)&&t(s),a&&a.expanded)))for(s=a.first;s;s=s.next)t(s)}var i;for(i=e.first;i;i=i.next)t(i)}(),ae(e),s&&ee(e),{depthOffset:p,maxDepth:f,leaves:m}}function ne(e,t){var n,i;for(n=1,i=e.length;n<i;++n)e[n]+=e[n-1]+t}function ie(e){return e.getActualWidth()}function re(e){return e.getActualHeight()}function oe(e){var t,i,r,o,a,s,d,l,h,c,u,p,g,f,m,w;for((t=e.drawingModifiers&n.DrawingModifiers.HORIZONTAL)?(c=re,u=ie):(c=ie,u=re),w=[],r=e.first;r;r=r.dftNext(e,A(r)))if(r.type===n.Group.Type&&r.expanded){for(i=0,o=r.first;o;o=o.next)i+=1;if(i){for(a=Math.max(1,Math.ceil(Math.sqrt(e.groupAspectRatio*i))),l=[e.groupPaddingLeft],h=[e.groupPaddingTop],s=0,d=0,o=r.first;o;o=o.next)p=c(o),g=u(o),l[s+1]>=p||(l[s+1]=p),h[d+1]>=g||(h[d+1]=g),(s+=1)===a&&(s=0,d+=1);for(ne(l,e.groupColPadding),ne(h,e.groupRowPadding),s=0,d=0,o=r.first;o;o=o.next)o.left=l[s],o.top=h[d],(s+=1)===a&&(s=0,d+=1);f=l[l.length-1]-e.groupColPadding+e.groupPaddingRight,m=h[h.length-1]-e.groupRowPadding+e.groupPaddingBottom,t?(r.expandedWidth=m,r.expandedHeight=f):(r.expandedWidth=f,r.expandedHeight=m),w.push({group:r,cols:l,rows:h})}else r.expandedWidth=e.groupEmptyWidth,r.expandedHeight=e.groupEmptyHeight}return w}function ae(e){var t,i;for(t=e.first;t;t=t.dftNext(e,A(t)))if(t.type===n.Group.Type)for(i=t.first;i;i=i.next)i.left+=t.left,i.top+=t.top}function se(e){var t;if(!(t=w[e.drawing]))throw new Error("invalid drawing algorithm: "+e.drawing);return function(e){this.__debug_flags__|=1<<e}.call(e,3),t.call(this,e)}function de(e,t){var n,i;return(n=e.id)<(i=t.id)?-1:n>i?1:0}function le(e){var t;for(t="";e-- >0;)t+=" ";return t}function he(e){this.id=e,this.count_ms=NaN,this.parent=null,this.nextSibling=null,this.firstChild=null,this.lastChild=null}n.sortNodes=function(e,t){var n,i,r,o,a,s;if(r=e.length){for(n=e[0].document,i=1;i<r;++i)if(e[i].document!==n)throw new Error("nodes must be in same document");for(n.id=0,a=1,o=n.first;o;o=o.dftNext(n))o.id=a++;if(e.sort(de),t&&t.unique){for(s=1,i=1;i<r;++i)e[i]!==e[i-1]&&(e[s++]=e[i]);e.length=s}}},n.filterVisibleNodes=function(e){var t,n,i,r,o;if(i=e.length){for(t=e[0].document,n=1;n<i;++n)if(e[n].document!==t)throw new Error("nodes must be in same document");for(t.id=1,r=t.first;r;r=r.dftNext(t))r.parent.expanded?r.id=r.parent.id:r.id=0;for(o=0,n=0;n<i;++n)e[n].id&&(e[o++]=e[n]);e.length=o}},"undefined"!=typeof performance?(B=performance.now,U=performance):(B=Date.now,U=Date),he.prototype.appendChild=function(e){if(e.parent)throw new Error("child already has a parent");e.parent=this,this.lastChild?(this.lastChild.nextSibling=e,this.lastChild=e):this.lastChild=this.firstChild=e};var ce=null;var ue=/^\s*?function\s*?(\S*?)\s*?\(/;function pe(e,t,n,i){if(!pe.active)return t.apply(e,n);var r,o,a,s;s=new he(i||t.name||function(e){var t;if(!(t=ue.exec(e.toString())))throw new Error("can't get function name");return t[1]}(t)),ce&&ce.appendChild(s),ce=s,r=B.call(U);try{a=t.apply(e,n),o=B.call(U),s.count_ms=o-r}finally{ce=ce.parent,s.parent||pe.onroot(s)}return a}return pe.onroot=function(e){var t,n;for(t=e,n=0;t;)if(console.log(le(2*n)+t.count_ms.toFixed(3)+"ms : "+t.id),t.firstChild)t=t.firstChild,n+=1;else{for(;t&&!t.nextSibling;)t=t.parent,n-=1;t&&(t=t.nextSibling)}},pe.active=!1,n.timeit=pe,n.overrideAnimationFrame=function(e,t){if("function"!=typeof e)throw new Error("newRAF must be a function");if("function"!=typeof t)throw new Error("newCAF must be a function");i=e,t},n.traceUpdates=!1,n}),define("etree/tree",["DS/etree/tree"],function(e){return e}),define("DS/etree/syncviewsFactory",["DS/egraph/utils","DS/egraph/views","DS/egraph/core","DS/etree/tree","UWA/Core","DS/Utilities/Dom"],function(e,t,n,i,r,o){"use strict";return{generateNodeView:function(a){return function(a){a=r.extend({template:['<div class="etree-sync-node" draggable="true">','  <div class="etree-sync-node-widget">','    <div class="etree-sync-node-color"></div>','    <div class="etree-sync-node-thumbnail"></div>','    <div class="etree-sync-node-caption">','      <div class="etree-sync-node-icon"></div>','      <div class="etree-sync-node-badgeTopRight"></div>','      <div class="etree-sync-node-badgeBottomRight"></div>','      <div class="etree-sync-node-label">noname</div>','      <div class="etree-sync-node-moreinfo" data-egraph-subelt="moreinfo"></div>',"    </div>","  </div>",'  <div class="etree-sync-node-collapse-expand" data-egraph-subelt="collapse-expand">','    <div class="etree-sync-node-collapse-expand-spinner"></div>',"  </div>","</div>",'<div class="etree-sync-temp-node">',"</div>",'<div class="etree-sync-group">',"</div>"].join("\n"),onmodifyDisplay:function(e){var t,n=e.nodeView,i=e.nodeModel;i.options.isBeingCut?n.classList.add("is-being-cut"):n.classList.remove("is-being-cut"),(t=n.querySelector(".etree-sync-node-icon")).classList.remove("hidden"),i.options.icons&&i.options.icons.length>0?(t.className="",t.classList.add("etree-sync-node-icon"),o.generateIcon(i.options.icons[0],{target:t})):t.classList.add("hidden");var r=i.getBadges();(t=n.querySelector(".etree-sync-node-badgeTopRight"))&&(t.className="",t.classList.add("etree-sync-node-badgeTopRight"),r&&r.topRight?o.generateIcon(r.topRight,{target:t}):t.classList.add("hidden")),(t=n.querySelector(".etree-sync-node-badgeBottomRight"))&&(t.className="",t.classList.add("etree-sync-node-badgeBottomRight"),r&&r.bottomRight?o.generateIcon(r.bottomRight,{target:t}):t.classList.add("hidden")),t=n.querySelector(".etree-sync-node-color"),i.options.color?(n.classList.add("colorized"),t.style.backgroundColor=i.options.color):n.classList.remove("colorized"),n.querySelector(".etree-sync-node-label").textContent=i.options.label,(t=n.querySelector(".etree-sync-node-moreinfo")).classList.remove("hidden"),!1===i.options.showMoreInfo&&t.classList.add("hidden"),t=n.querySelector(".etree-sync-node-thumbnail");var a=i.options.thumbnail;a||(a="../etree/assets/ghost.png"),t.style.backgroundImage='url("'+a+'")'}},a);var s={},d=document.createElement("div");d.innerHTML=a.template;var l=d.querySelector(".etree-sync-node"),h=d.querySelector(".etree-sync-temp-node"),c=d.querySelector(".etree-sync-group"),u=function(){t.HTMLNodeView.call(this)};e.inherit(u,t.HTMLNodeView),u.prototype.buildNodeElement=function(){return c.cloneNode(!0)};var p=function(){t.HTMLNodeView.call(this)};e.inherit(p,t.HTMLNodeView),p.prototype.buildNodeElement=function(){return l.cloneNode(!0)},p.prototype.onmodifyDisplay=function(e,r){var o,s;if(t.HTMLNodeView.prototype.onmodifyDisplay.apply(this,arguments),o=this.display.elt,a.onmodifyDisplay({nodeModel:e.data.data,nodeView:o}),n.inPathSet(r,"data","displayFlags")&&(e.data.displayFlags&i.DisplayFlags.DRAGGED?o.classList.add("dragged"):o.classList.remove("dragged"),e.data.displayFlags&i.DisplayFlags.DRAG_NODE?o.classList.add("drag-node"):o.classList.remove("drag-node")),(n.inPathSet(r,"data","data","_isHighlighted")||n.inPathSet(r,"data","data","_isSelected"))&&(e.data.data._isHighlighted||e.data.data._isSelected?o.classList.add("highlighted"):o.classList.remove("highlighted")),n.inPathSet(r,"data","data","_isMatchingSearch")&&(e.data.data._isMatchingSearch?o.classList.add("matching-search"):o.classList.remove("matching-search")),n.inPathSet(r,"data","data","_expandState"))switch((s=o.querySelector(".etree-sync-node-collapse-expand").classList).remove("expanded"),s.remove("collapsed"),s.remove("expanding"),s.remove("partiallyExpanded"),s.remove("hidden"),e.data.data._expandState){case"collapseState":s.add("expanded");break;case"expandingState":s.add("expanding");break;case"expandState":s.add("collapsed");break;case"partiallyExpandedState":s.add("partiallyExpanded");break;default:s.add("hidden")}n.inPathSet(r,"data","*drawingModifiers*")&&e.data.document&&(o.classList.remove("root-on-left"),o.classList.remove("root-on-right"),o.classList.remove("root-on-bottom"),e.data.document.drawingModifiers&i.DrawingModifiers.HORIZONTAL?e.data.document.drawingModifiers&i.DrawingModifiers.MIRROR_DEPTH?o.classList.add("root-on-right"):o.classList.add("root-on-left"):e.data.document.drawingModifiers&i.DrawingModifiers.MIRROR_DEPTH&&o.classList.add("root-on-bottom")),n.inPathSet(r,"data","height")&&(isNaN(e.data.height)?o.classList.remove("v-collapsed"):o.classList.add("v-collapsed"))};var g=function(){return new t.SVGEdgeView("etree-sync-edge")},f=function(){t.HTMLNodeView.call(this)};e.inherit(f,t.HTMLNodeView),f.prototype.buildNodeElement=function(){return h.cloneNode(!0)};var m=function(){return new t.SVGEdgeView("etree-sync-temp-edge")};return s.newNodeView=function(){return new p},s.newEdgeView=function(){return new g},s.newGroupView=function(){return new u},s.newTempNodeView=function(){return new f},s.newTempEdgeView=function(){return new m},s.newTempGroupView=function(){return new f},s}(a)}}}),define("DS/etree/iact",["DS/egraph/utils","DS/egraph/iact","DS/egraph/core","DS/etree/tree","DS/Core/PointerEvents"],function(e,t,n,i,r){"use strict";var o={};const a=function(e,n,i){function r(){var e;e=l,l=null,e&&e()}var a,s,d,l,h,c,u;if(d=this,h=this.dnd_enabled&&q(n.dom),c=n.modifiers===t.Modifiers.CTRL&&this.dragMultipleNodes,n.modifiers===t.Modifiers.SHIFT)B(this,e,i,o.SelectMode.RANGE);else if(n.modifiers===t.Modifiers.CTRL){if(l=B.bind(void 0,this,e,i,o.SelectMode.ADD),c)return this.selectionModel.isSelected(i)||(B(this,e,i,o.SelectMode.ADD),u=!0),(s=W(this,i)).length?h?{state:{onmouseup:function(e,n){return n.button===t.Buttons.LEFT?(u||r(),{consume:!0,state:null}):{}},ondragstart:function(e,t){return Z(d,e,t,s,i)}}}:{consume:!0,state:{onmouseup:function(e,n){return n.button===t.Buttons.LEFT?(u||r(),{consume:!0,state:null}):{}},onmousemove:function(e,n){return n.clientDelta[0]||n.clientDelta[1]?(e.startdrag(new b(this,e,s,i)),{consume:!0,state:t.EndDragOnLeftState}):{consume:!0}}.bind(this)}}:(r(),{consume:!0});r()}else n.modifiers===(t.Modifiers.CTRL|t.Modifiers.SHIFT)&&B(this,e,i,o.SelectMode.ADD_RANGE);return 0===n.modifiers?(a=this.buttons[n.subElt])?(e.startdrag(new t.SubEltClickDrag(n.grElt,n.subElt,a.bind(void 0,i,n.detail,this.actions))),{consume:!0,state:t.EndDragOnLeftState}):(l=B.bind(void 0,this,e,i,o.SelectMode.REPLACE),this.dragMultipleNodes&&this.selectionModel.isSelected(i)||r(),(s=W(this,i)).length?h?{state:{onmouseup:function(e,n){return n.button===t.Buttons.LEFT?(r(),{consume:!0,state:null}):{}},ondragstart:function(e,t){return Z(d,e,t,s,i)}}}:{consume:!0,state:{onmouseup:function(e,n){return n.button===t.Buttons.LEFT?(r(),{consume:!0,state:null}):{}},onmousemove:function(e,n){return n.clientDelta[0]||n.clientDelta[1]?(e.startdrag(new b(this,e,s,i)),{consume:!0,state:t.EndDragOnLeftState}):{consume:!0}}.bind(this)}}:(r(),{consume:!0})):{consume:!0}},s=function(e,t){const n=I(t.grElt,this.ignoreGroups);return this.oncontext({device:"mouse",node:n,subElt:t.subElt,dom:t.target,clientPos:t.clientPos,graphPos:t.graphPos,modifiers:t.modifiers}),{consume:!0,state:null}},d=function(e,n){const i=this;return this.oncontext?{consume:!0,state:{onmouseup:function(e,r){return n.button===t.Buttons.RIGHT?s.call(i,e,r):{}}}}:{}};function l(e,t){return function(n,i){return o.ETreeMouseProfiles[n.graph.mouseProfile]&&o.ETreeMouseProfiles[n.graph.mouseProfile][e]&&o.ETreeMouseProfiles[n.graph.mouseProfile][e][t]?o.ETreeMouseProfiles[n.graph.mouseProfile][e][t].call(this,n,i):{}}}function h(){return!1}function c(e,t,n){var r;r=!(1&t),i.timeit(this,function(){r?n.expandAll&&n.expandAll(e,e.expanded):n.toggleExpanded&&n.toggleExpanded(e)})}function u(e){var t;(t=e.document).withLockedUpdate(function(){e.setExpanded(!e.expanded),t.setFixNode2(e)})}function p(e,t,n){if(e.hideOverviewOnDrag){var i=t.views.ovr;i&&i.setPierceable(n)}}function g(e,t){var n;(n=e.document).withLockedUpdate(function(){e.setExpanded(e.expanded,!0),n.setFixNode2(e)})}function f(e,t){var n,i,r;for(n=0,i=e.length;n!==i;)e[r=n+i>>>1]>=t?i=r:n=r+1;return n}function m(e){return!e.expanded||e.type===i.Group.Type}function w(e){return e.getActualWidth()}function y(e){return e.getActualHeight()}function v(e,t,n){return e>t&&(e=t=.5*(e+t)),n<e?-1:n>=t?1:0}function _(e,t,n,r,o,a,s){switch(e.drawing){case i.Drawing.LAYERED:case i.Drawing.LAYERED_TIDY_1:return function(e,t,n,r,o,a,s){function d(e,t,n,i){var a;return b&&(n=-n-r),S&&(i=-i-o),E&&(a=n,n=i,i=a),{parent:e,next:t,insertLeft:n,insertTop:i}}function l(n,i,o,a,s){var l,p,g,f,m;return n.first&&n.expanded?(p=-1/0,g=Number(1/0),s&&(g=c(s)),a&&(p=u(a)),l=o?o.prev:n.last,o&&(g=Math.min(g,c(o))),l&&(p=Math.max(p,u(l))),p+=e.siblingPadding+.5*r,g-=e.siblingPadding+.5*r,f=Math.round(T(t,p,g)-.5*r),m=h(n.first)):(f=c(n)+Math.round(.5*(M(n)-r)),m=h(e.first)+_[i]),d(n,o,f,m)}function h(e){var t;return t=E?e.left:e.top,S?-t-D(e):t}function c(e){var t;return t=E?e.top:e.left,b?-t-M(e):t}function u(e){var t;return t=E?e.top:e.left,b?-t:t+M(e)}var p,g,_,N,C,x,E,b,S,D,M,P;if(_=e.drawingData.depthOffset,x=e.drawingModifiers,E=Boolean(x&i.DrawingModifiers.HORIZONTAL),b=Boolean(x&i.DrawingModifiers.MIRROR_SIBLINGS),S=Boolean(x&i.DrawingModifiers.MIRROR_DEPTH),M=E?y:w,D=E?w:y,E&&(P=r,r=o,o=P),E&&(P=t,t=n,n=P),b&&(t=-t),S&&(n=-n),!e.first)return d(e,null,Math.round(t-.5*r),Math.round(n-.5*o));if((g=f(_,n-h(e.first)+e.rowPadding))>=_.length){if(!s||!s.extendLastRow)return null;g=_.length-1}for(0===g&&(g=1),p=new i.NodeIterator(e,e.first);p.n&&p.depth!==g;p.dftNext(m(p.n)));if(!p.n)throw new Error("internal error");N=null,C=null;do{if(c(p.n)>t){C=p.n;break}N=p.n}while(p.nextNeighbor2(m));return N&&u(N)>=t?N.type===i.Group.Type?function(i){var o,l,p,g,m,w,y,_,N,C,x,E,b,S,D,P;if(!i.expanded||!i.first)return d(i,null,c(i)+.5*(M(i)-r),h(i)+e.groupPaddingTop);for(l=null,p=0,g=(o=e.drawingData.groups).length;p<g&&(l=o[p]).group!==i;++p);if(!l)throw new Error("internal error");for(m=l.cols.slice(0,l.cols.length),y=c(i),p=0,g=m.length-1;p<g;++p)m[p]=y+.5*(m[p]+m[p+1]-e.groupColPadding);for(m.length=m.length-1,w=l.rows.slice(1,l.rows.length-1),_=h(i),p=0,g=w.length;p<g;++p)w[p]+=_-.5*e.groupRowPadding;for(N=f(m,t),x=(C=f(w,n))*m.length+N,E=i.first;E&&x;--x)E=E.next;return N-=x,s&&s.pickGroupChildren&&(b=E?E.prev:i.last,D=null,P=s&&isFinite(s.groupMinGap)?Math.max(0,s.groupMinGap):50,P*=a.invVptScale>1?a.invVptScale:1,E&&N!==m.length&&t>=c(E)&&t<u(E)?D=0===N?v(c(i)+P,.5*(u(E)+c(E)-P),t)>=0?E:null:v(.5*(u(b)+c(E)+P),.5*(u(E)+c(E)-P),t)>=0?E:null:N>0&&t>c(b)&&t<u(b)&&(D=N!==m.length&&E?v(.5*(u(b)+c(b)+P),.5*(u(b)+c(E)-P),t)<=0?b:null:v(.5*(u(b)+c(b)+P),u(i)-P,t)<=0?b:null),D)?d(D,null,c(D)+Math.round(.5*(M(D)-r)),l.rows[C+1]+_-Math.round(.5*e.groupRowPadding)):(S=l.rows[C]+_,d(i,E,E?l.cols[N]+y-.5*(e.groupColPadding+r):T(t-.5*r,l.cols[N]+y-.5*(e.groupColPadding+r),l.cols[l.cols.length-1]+y-.5*(e.groupColPadding+r)),S))}(N):l(N,g,void 0,N.last,new i.NodeIterator(e,N.last).nextNeighbor2(m)):null!==C!=(null!==N)?C?l(C.parent,g-1,C,N,C):l(N.parent,g-1,null,N,C):C.parent===N.parent?l(C.parent,g-1,C,N,C):t-u(N)<c(C)-t?l(N.parent,g-1,null,N,C):l(C.parent,g-1,C,N,C)}(e,t,n,r,o,a,s);case i.Drawing.TWO_BRANCHES:case i.Drawing.TWO_BRANCHES_LEAVES_ON_EXTREMITY:return function(e,t,n,r,o,a,s){function d(e,t,n,i,a){var s;return S&&(n=-n-r),D&&(i=-i-o),b&&(s=n,n=i,i=s),{parent:e,next:t,insertLeft:n,insertTop:i,mergeMode:!!a}}function l(n,i,o,a,s){var l,h,g,f,m;return n.first&&n.expanded?(h=-1/0,g=1/0,s&&(g=u(s)),a&&(h=p(a)),l=o?o.prev:n.last,o&&(g=Math.min(g,u(o))),l&&(h=Math.max(h,p(l))),h+=e.siblingPadding+.5*r,g-=e.siblingPadding+.5*r,f=Math.round(T(t,h,g)-.5*r),m=c(n.first)):(f=u(n)+Math.round(.5*(P(n)-r)),m=c(e.first)+_[i]),d(n,o,f,m,!1)}function h(){return d(e,null,Math.round(t-.5*r),Math.round(n-.5*o),!1)}function c(e){var t;return t=b?e.left:e.top,D?-t-M(e):t}function u(e){var t;return t=b?e.top:e.left,S?-t-P(e):t}function p(e){var t;return t=b?e.top:e.left,S?-t:t+P(e)}var g,v,_,N,C,x,E,b,S,D,M,P,L;if(!e.drawingData)return h();if(_=e.drawingData.depthOffset,N=e.drawingData.maxDepth+1,E=e.drawingModifiers,b=Boolean(E&i.DrawingModifiers.HORIZONTAL),S=Boolean(E&i.DrawingModifiers.MIRROR_SIBLINGS),D=Boolean(E&i.DrawingModifiers.MIRROR_DEPTH),P=b?y:w,M=b?w:y,b&&(L=r,r=o,o=L),b&&(L=t,t=n,n=L),S&&(t=-t),D&&(n=-n),!e.first)return h();if((v=f(_,n-c(e.first)+e.rowPadding))>=_.length){if(!s||!s.extendLastRow)return null;v=_.length-1}if(0===v&&(v=1),e.drawing!==i.Drawing.TWO_BRANCHES&&e.drawing!==i.Drawing.TWO_BRANCHES_LEAVES_ON_EXTREMITY||(v=2*v-1,N=2*N-1),C=null,x=null,e.drawing===i.Drawing.TWO_BRANCHES_LEAVES_ON_EXTREMITY&&v===N){var O,R=e.drawingData.leaves;if(!R)throw new Error("leaves are undefined");for(O=R.length-1;O>=0;O--){var A=R[O];if(u(A)>t){x=A;break}C=A}}else{var G=null;for(g=new i.NodeIterator(e,e.first);g.n;g.dftNext(m(g.n)))if(!g.n.data||!g.n.data.isIntermediateNode){var k=c(g.n);if(g.depth<=v&&k<=n&&k+M(g.n)>=n){G=g.n;break}if(g.depth>v)break}if(!G)return null;do{if(!g.n.data||!g.n.data.isIntermediateNode){if(u(g.n)>t){x=g.n;break}C=g.n}}while(g.nextNeighbor2(m))}return C||x?C&&p(C)>=t?C.type===i.Group.Type?buildGroupResult(C):e.drawing===i.Drawing.TWO_BRANCHES||e.drawing===i.Drawing.TWO_BRANCHES_LEAVES_ON_EXTREMITY?d(C,null,u(C),c(C),!0):l(C,v,void 0,C.last,new i.NodeIterator(e,C.last).nextNeighbor2(m)):null!==x!=(null!==C)?x?l(x.parent,v-1,x,C,x):l(C.parent,v-1,null,C,x):x.parent===C.parent?l(x.parent,v-1,x,C,x):t-p(C)<u(x)-t?l(C.parent,v-1,null,C,x):l(x.parent,v-1,x,C,x):null}(e,t,n,r,o,0,s);case i.Drawing.BRANCHED:throw new Error("not yet implemented");default:throw new Error("unsupported drawing method: "+e.drawing)}}function N(t,i,r,o){this.doc=t,this.grview=i,this.predicate=r,this.tempWidth=e.pos_number_opt(o,"tempWidth",t.nodeWidth),this.tempHeight=e.pos_number_opt(o,"tempHeight",t.nodeHeight),this.tempGrNode=t.newTempGrNode2(o&&o.node||null),this.tempGrNode.multiset("width",this.tempWidth,"height",this.tempHeight),this.tempGrConnector=new n.Connector,this.tempGrConnector.cstr=t.parentConnectorCstr,this.tempGrNode.appendConnector(this.tempGrConnector),this.tempGrEdge=t.newTempGrEdge(),this.targetParent=null,this.targetNext=null,this.targetLeft=NaN,this.targetTop=NaN,this.mergeMode=!1,this.iipv_memoization={parent:null,next:null,mergeMode:!1,predicate_arg:null,result:!1},this.pick_opts=void 0,o&&(this.pick_opts={pickGroupChildren:o.pickGroupChildren,groupMinGap:o.groupMinGap,extendLastRow:o.extendLastRow})}function C(e,t){return e===t}function x(e){switch(e.type){case i.Node.Type:return e.getActualWidth();case i.Group.Type:return e.getCollapsedWidth();default:throw new Error("unsupported kind of node")}}function E(e){switch(e.type){case i.Node.Type:return e.getActualHeight();case i.Group.Type:return e.getCollapsedHeight();default:throw new Error("unsupported kind of node")}}function b(e,n,i,r){var o;t.SinglePtDrag.call(this),this.rootstate=e,this.grview=n.graphView,this.nodes=i,this.node=r,o=r.document,this.tempDraggedGrNodes=function(e,t){var n,i;return n=t.document,i=n.newDragNode(t).grNode,{move:function(e,t){n.gr.addNode(i),i.multiset("left",e-Math.round(.5*i.width),"top",t-Math.round(.5*i.height))},remove:function(){i.remove()}}}(0,r),this.picker=new N(o,this.grview,function(e,t,n,i){if(!L(e,t))return!1;return U(this.rootstate,this.nodes,this.node,e,t,n)}.bind(this),{tempWidth:x(r),tempHeight:E(r),pickGroupChildren:e.pickGroupChildren,groupMinGap:e.groupMinGap,extendLastRow:e.extendLastRow}),this.draggedChanged=!1}function T(e,t,n){return t>n?.5*(t+n):e<t?t:e>n?n:e}function S(e,t){return e.modifiers===t.modifiers}function D(e){var t;t=e.nodes[0].document,e.draggedChanged||(e.draggedChanged=!0,t.withLockedUpdate(function(){e.nodes.forEach(function(e){e.setDragged(!0)})}))}function M(e,t,n,i,r,o){return function(a){var s,d,l;(s=a.document).withLockedUpdate(function(){void 0!==t&&e.expanded?(d=n+s.alignmentH*(r-a.getActualWidth()),l=i+s.alignmentV*(o-a.getActualHeight()),s.setFixNode2(a,{position:{left:d,top:l},alignmentH:0,alignmentV:0})):s.setFixNode2(e)})}}function P(e,t){return{modifiers:t.modifiers,internal:Boolean(e.nodes),nodes:e.nodes,node:e.node,move:e.move}}function L(e,t){var n,r;return!(e.displayFlags&i.DisplayFlags.DRAGGED)&&(n=t?t.prev:e.last,r=Boolean(t&&t.displayFlags&i.DisplayFlags.DRAGGED),Boolean(n&&n.displayFlags&i.DisplayFlags.DRAGGED)!==r||!r)}function O(e){for(;e&&e.displayFlags&i.DisplayFlags.DRAGGED;)e=e.next;return e}function R(e,t,n,r){var o,a,s,d,l,h;return this.nodes&&(d=this.rootstate,l=r.dataTransfer,h=P(this,r),o=!d.dnd_isMove||d.dnd_isMove(l,h),a=this.nodes,s=o,a.some(function(e){return Boolean(e.displayFlags&i.DisplayFlags.DRAGGED)!==s})&&a[0].document.withLockedUpdate(function(){a.forEach(function(e){e.setDragged(s)})}),this.move=Boolean(o)),!!L(e,t)&&function(e,t,n,i,r){return e.dnd_dropPredicate?e.dnd_dropPredicate(t,n,i,r):!!r.internal&&U(e,r.nodes,r.node,n,i,!1)}(this.rootstate,r.dataTransfer,e,t,P(this,r))}function A(e,t,n,i){this.rootstate=e,this.doc=t.graph.data,this.grview=t.graphView,this.nodes=n,this.node=i,this.move=!1,this.picker=new N(this.doc,this.grview,R.bind(this),{tempWidth:i?x(i):this.doc.nodeWidth,tempHeight:i?E(i):this.doc.nodeHeight,pickGroupChildren:e.pickGroupChildren,groupMinGap:e.groupMinGap,extendLastRow:e.extendLastRow})}function G(e,t){var n;return e.doc.gr.withLockedUpdate(function(){n=e.picker.move(t.graphPos[0],t.graphPos[1],t,h)}),n}function k(e){return G(this,e)||(e.dataTransfer.dropEffect="none"),{consume:!0}}function V(e){e.nodes&&e.nodes[0].document.withLockedUpdate(function(){e.nodes.forEach(function(e){e.setDragged(!1)})})}function F(e,t,n){var i,r;Array.isArray(e)||(e=[e]),t.document.withLockedUpdate(function(){for(i=0,r=e.length;i<r;++i)t.insertBefore(e[i],n)})}function I(e,t){if(!e)return null;switch(e.type){case n.Type.GROUP:if(t)break;case n.Type.NODE:return e.data}return null}function H(e,t,n,i,r,o,a){function s(){return t.enddrag(!0),{state:r,reinterpret:!0}}var d;return d=new A(e,t,o,a),t.startdrag(d),{reinterpret:!0,state:{last_entered:null,before_last_entered:null,last_grElt_entered:null,before_last_grElt_entered:null,ondragenter:function(e,t){return this.before_last_entered=this.last_entered,this.before_last_grElt_entered=this.last_grElt_entered,this.last_grElt_entered=t.grElt,this.last_entered=t.dom,t.grElt&&t.grElt.data&&t.grElt.data&&t.grElt.data.document&&t.grElt.data.document.addAttrOnDraggedOverElements&&t.grElt&&t.grElt.views&&t.grElt.views.main&&t.grElt.views.main.display&&t.grElt.views.main.display.elt&&t.grElt.views.main.display.elt.setAttribute("draggedOver",""),{}},ondragover:function(t,n){var i;return p(e,t.graph,!0),(i=n.dom)!==this.last_entered&&this.last_entered&&this.last_entered.nodeType===Node.TEXT_NODE&&this.last_entered.parentNode===i&&(i=this.last_entered),i!==this.last_entered&&(this.before_last_entered=this.last_entered,this.last_entered=n.dom),{}},ondragleave:function(t,n){return this.before_last_grElt_entered!==n.grElt&&this.before_last_grElt_entered&&this.before_last_grElt_entered.views&&this.before_last_grElt_entered.views.main&&this.before_last_grElt_entered.views.main.display&&this.before_last_grElt_entered.views.main.display.elt&&this.before_last_grElt_entered.views.main.display.elt.removeAttribute("draggedOver",""),n.dom===this.before_last_entered?{}:(p(e,t.graph,!1),this.before_last_entered=this.last_entered=null,t.enddrag(!0),{state:i})},ondrop:function(t,n){var r;return Y(n),p(e,t.graph,!1),r=d.doDrop(n),t.enddrag(!1),r||(n.dataTransfer.dropEffect="none"),n.grElt&&n.grElt.views&&n.grElt.views.main&&n.grElt.views.main.display&&n.grElt.views.main.display.elt&&n.grElt.views.main.display.elt.removeAttribute("draggedOver",""),{consume:!0,state:i}},ondragend:s,onmousedown:s,onmousemove:s,onmouseup:s}}}function B(e,t,n,i){e.actions.select&&e.actions.select(n,i)}function U(e,t,n,r,o,a){return e.insertPredicate?e.insertPredicate(r,e.dragMultipleNodes?t:t[0],o||null,{node:n,mergeMode:a}):r.type!==i.Group.Type||t.every(function(e){return!e.first})}function z(e,t,n,i,r,o,a){var s;e.actions.insert&&(s=e.actions.insert(e.dragMultipleNodes?t:t[0],i,r,{node:n,mergeMode:o,recenter:a}),!a||s&&s.no_recenter||a(n))}function W(e,t){var n;if(e.dragMultipleNodes){if(n=e.selectionModel.getSelection().slice(),i.filterVisibleNodes(n),i.sortNodes(n,{unique:!0}),-1===n.indexOf(t))throw new Error("visible selection does not contain node!")}else n=[t];return!e.movePredicate||e.movePredicate(e.dragMultipleNodes?n:t)?n:[]}function q(e){for(;e;){if(e.draggable)return!0;e=e.parentNode}}function Z(e,t,n,i,o){function a(t,n){return H(e,t,0,this,e,i,o)}if(!function(e,t,n,i){if(e.dnd_dragStart)return e.dnd_dragStart(t,n,i);var r="";return i&&i.data&&i.data.dump&&(r=JSON.stringify(i.data.dump())),t.setData("text",r),t.effectAllowed="move",!0}(e,n.dataTransfer,i,o))return{consume:!0,state:e};var s=n.dom.getBoundingClientRect(),d=t.graph.views.main.domRoot.getBoundingClientRect(),l=n.dragStart.clientPos[0]-s.left,h=n.dragStart.clientPos[1]-s.top;return"function"==typeof n.dataTransfer.setDragImage&&r.isLastEventTouch()?(Y(t.graph),t.graph.__draggedNode=n.dom.cloneNode(!0),t.graph.__draggedNode.style.transform="",t.graph.__draggedNode.style.position="absolute",t.graph.views.main.domRoot.appendChild(t.graph.__draggedNode),t.graph.__draggedNode.style.zIndex="-1",t.graph.__draggedNode.style.left=s.left-d.left+"px",t.graph.__draggedNode.style.top=s.top-d.top+"px",n.dataTransfer.setDragImage(t.graph.__draggedNode,l,h)):"function"==typeof n.dataTransfer.setDragImage&&n.dataTransfer.setDragImage(n.dom,l,h),{state:{ondragend:function(t,n){return Y(t.graph),{consume:!0,state:e}},ondragentger:a,ondragover:a}}}function Y(e){e&&e.__draggedNode&&(e.__draggedNode.remove(),e.__draggedNode=void 0)}function X(e,t){return this.dnd_enabled?H(this,e,0,this,this):{}}return o.ETreeMouseProfiles={[n.EGraphMouseProfileNames.LEGACY]:(()=>({RootState:{onmousedown:function(e,n){if(!n.inside)return{};if(n.button===t.Buttons.LEFT){if(n.modifiers&t.Modifiers.ALT)return n.modifiers&t.Modifiers.CTRL?e.startdrag(new t.ViewpointScaleDrag(e.graphView,n.graphPos)):e.startdrag(new t.ViewpointMoveDrag(e.graphView)),{consume:!0,state:t.EndDragOnLeftState};const i=I(n.grElt,this.ignoreGroups);return i?a.call(this,e,n,i):(0===n.modifiers&&B(this,e,e.graph.data,o.SelectMode.EMPTY),n.modifiers&t.Modifiers.CTRL?e.startdrag(new t.ViewpointScaleDrag(e.graphView,n.graphPos)):e.startdrag(new t.ViewpointMoveDrag(e.graphView)),{consume:!1,state:t.EndDragOnLeftState})}return n.button===t.Buttons.RIGHT?d.call(this,e,n):{}},onwheel:function(t,n){if(!n.inside)return{};const i=t.graphView;let r=void 0,o=void 0;i.gr.zoomOpts&&(i.gr.zoomOpts.min&&!isNaN(i.gr.zoomOpts.min)&&(r=i.gr.zoomOpts.min),i.gr.zoomOpts.max&&!isNaN(i.gr.zoomOpts.max)&&(o=i.gr.zoomOpts.max));const a=e.incViewpointScale(i.vpt,.5*n.wheelDelta,n.graphPos,!0,[r,o,.5]);return i.setViewpoint(a,!0),{consume:!0}}}}))(),[n.EGraphMouseProfileNames.CATIA]:(()=>({RootState:{onmousedown:function(e,n){if(!n.inside)return{};if(n.button===t.Buttons.LEFT){const t=I(n.grElt,this.ignoreGroups);if(t)return a.call(this,e,n,t);0===n.modifiers&&B(this,e,e.graph.data,o.SelectMode.EMPTY)}else if(n.button===t.Buttons.MIDDLE){if(!I(n.grElt,this.ignoreGroups))return{consume:!0,state:new t.WaitingAfterMiddlePressedState}}else if(n.button===t.Buttons.RIGHT)return d.call(this,e,n);return{}},onwheel:function(t,n){if(!n.inside)return{};const i=t.graphView;let r=void 0,o=void 0;i.gr.zoomOpts&&(i.gr.zoomOpts.min&&!isNaN(i.gr.zoomOpts.min)&&(r=i.gr.zoomOpts.min),i.gr.zoomOpts.max&&!isNaN(i.gr.zoomOpts.max)&&(o=i.gr.zoomOpts.max));const a=e.incViewpointScale(i.vpt,.5*n.wheelDelta,n.graphPos,!0,[r,o,.5]);return i.setViewpoint(a,!0),{consume:!0}}}}))(),[n.EGraphMouseProfileNames["3DEXPERIENCE"]]:(()=>({RootState:{onmousedown:function(e,n){if(!n.inside)return{};if(n.button===t.Buttons.LEFT){const t=I(n.grElt,this.ignoreGroups);if(t)return a.call(this,e,n,t);0===n.modifiers&&B(this,e,e.graph.data,o.SelectMode.EMPTY)}else if(n.button===t.Buttons.MIDDLE){if(!I(n.grElt,this.ignoreGroups))return e.startdrag(new t.ViewpointMoveDrag(e.graphView)),{consume:!0,state:new t.EndDragOnMouseRelease(t.Buttons.MIDDLE)}}else if(n.button===t.Buttons.RIGHT)return{consume:!0,state:new o.CtxActionState(this.oncontext)};return{}},onwheel:function(t,n){if(!n.inside)return{};const i=t.graphView;let r=void 0,o=void 0;i.gr.zoomOpts&&(i.gr.zoomOpts.min&&!isNaN(i.gr.zoomOpts.min)&&(r=i.gr.zoomOpts.min),i.gr.zoomOpts.max&&!isNaN(i.gr.zoomOpts.max)&&(o=i.gr.zoomOpts.max));const a=e.incViewpointScale(i.vpt,.5*n.wheelDelta,n.graphPos,!0,[r,o,.5]);return i.setViewpoint(a,!0),{consume:!0}}},CtxActionState:{onmouseup:function(e,n){if(n.button===t.Buttons.RIGHT){let i;return(i=this.oncontext)&&n.button===t.Buttons.RIGHT?s.call(this,e,n):{consume:!0,state:null}}return{}},onmousemove:function(e,n){return e.startdrag(new t.ViewpointScaleDrag(e.graphView,n.graphPos)),{consume:!0,state:new t.EndDragOnMouseRelease(t.Buttons.RIGHT)}}}}))(),[n.EGraphMouseProfileNames.SOLIDWORKS]:(()=>({RootState:{onmousedown:function(e,n){if(!n.inside)return{};if(n.button===t.Buttons.LEFT){const t=I(n.grElt,this.ignoreGroups);if(t)return a.call(this,e,n,t);0===n.modifiers&&B(this,e,e.graph.data,o.SelectMode.EMPTY)}else if(n.button===t.Buttons.MIDDLE){if(!I(n.grElt,this.ignoreGroups))return n.modifiers===t.Modifiers.SHIFT?(e.startdrag(new t.ViewpointScaleDrag(e.graphView,n.graphPos)),{consume:!0,state:new t.EndDragOnMouseRelease(t.Buttons.MIDDLE,!0)}):(e.startdrag(new t.ViewpointMoveDrag(e.graphView)),{consume:!0,state:new t.EndDragOnMouseRelease(t.Buttons.MIDDLE)})}else if(n.button===t.Buttons.RIGHT)return d.call(this,e,n);return{}},onwheel:function(t,n){if(!n.inside)return{};const i=t.graphView;let r=void 0,o=void 0;i.gr.zoomOpts&&(i.gr.zoomOpts.min&&!isNaN(i.gr.zoomOpts.min)&&(r=i.gr.zoomOpts.min),i.gr.zoomOpts.max&&!isNaN(i.gr.zoomOpts.max)&&(o=i.gr.zoomOpts.max));const a=e.incViewpointScale(i.vpt,.5*n.wheelDelta,n.graphPos,!0,[r,o,.5]);return i.setViewpoint(a,!0),{consume:!0}}}}))()},o.CtxActionState=function(e){this.oncontext=e},o.CtxActionState.prototype.onmouseup=l("CtxActionState","onmouseup"),o.CtxActionState.prototype.onmousemove=l("CtxActionState","onmousemove"),N.prototype.move=function(e,t,n,i){function r(){var r;return this.targetParent=this.targetNext=null,this.targetLeft=this.targetTop=NaN,this.mergeMode=!1,!(!(r=_(o,e,t,this.tempWidth,this.tempHeight,this.grview,this.pick_opts))||!r.parent)&&(!!function(e,t,n,i,r,o){return o=o||C,t===e.iipv_memoization.parent&&n===e.iipv_memoization.next&&i===e.iipv_memoization.mergeMode&&o(e.iipv_memoization.predicate_arg,r)?e.iipv_memoization.result:(e.iipv_memoization.parent=t,e.iipv_memoization.next=n,e.iipv_memoization.mergeMode=i,e.iipv_memoization.predicate_arg=r,e.iipv_memoization.result=e.predicate.call(void 0,t,n,i,r),e.iipv_memoization.result)}(this,r.parent,r.next,r.mergeMode,n,i)&&(this.targetParent=r.parent,this.targetNext=r.next,this.targetLeft=r.insertLeft,this.targetTop=r.insertTop,this.mergeMode=!!r.mergeMode,o.hideTempNodeInsertionOnDrag||o.gr.withLockedUpdate(function(){this.tempGrNode.multiset("left",r.insertLeft,"top",r.insertTop),o.gr.addNode(this.tempGrNode),this.tempGrEdge.remove(),r.parent.grChildrenC&&o.gr.addEdge(r.parent.grChildrenC,this.tempGrConnector,this.tempGrEdge)},this),!0))}var o,a;return(o=this.doc).gr.withLockedUpdate(function(){(a=r.call(this))||this.tempGrNode.remove()},this),a},N.prototype.remove=function(){this.targetParent=this.targetNext=null,this.targetLeft=this.targetTop=NaN,this.mergeMode=!1,this.doc.gr.withLockedUpdate(function(){this.tempGrNode.remove()},this)},e.inherit(b,t.SinglePtDrag),b.prototype.onmove=function(e){var t;t=this.nodes[0].document,D(this),t.gr.withLockedUpdate(function(){this.picker.move(e.graphPos[0],e.graphPos[1],e,S),this.tempDraggedGrNodes.move(e.graphPos[0],e.graphPos[1])},this)},b.prototype.onstart=function(){if(this.node){var e=this.node.document;e&&e.withLockedUpdate(function(){!function(e,t,n){if(e.actions.dragStart)e.actions.dragStart(t,n)}(this.rootstate,this.nodes,this.node)},this)}},b.prototype.onend=function(e){var t,n,i,r,o,a,s;t=this.node.document,n=this.picker.targetParent,i=this.picker.targetNext,o=this.picker.targetLeft,a=this.picker.targetTop,s=this.picker.mergeMode,r=O(i),t.withLockedUpdate(function(){this.picker.remove(),this.tempDraggedGrNodes.remove();try{e||n&&(D(this),z(this.rootstate,this.nodes,this.node,n,r,s,M(n,i,o,a,this.picker.tempWidth,this.picker.tempHeight)))}finally{this.draggedChanged&&this.nodes.forEach(function(e){e.setDragged(!1)}),function(e,t,n){if(e.actions.dragEnd)e.actions.dragEnd(t,n)}(this.rootstate,this.nodes,this.node)}},this)},A.prototype.ondragenter=k,A.prototype.ondragover=k,A.prototype.doDrop=function(e){var t,n,i;return(t=G(this,e))&&((n=P(this,e)).recenter=M(this.picker.targetParent,this.picker.targetNext,this.picker.targetLeft,this.picker.targetTop,this.picker.tempWidth,this.picker.tempHeight),i=O(this.picker.targetNext),t=function(e,t,n,i,r){return e.dnd_drop?e.dnd_drop(t,n,i,r):!!r.internal&&(n.document.withLockedUpdate(function(){z(e,r.nodes,r.node,n,i,!1,r.recenter)}),!0)}(this.rootstate,e.dataTransfer,this.picker.targetParent,i,n)),t},A.prototype.onend=function(t){this.picker.remove(),e.isIE()&&requestAnimationFrame?requestAnimationFrame(V.bind(void 0,this)):V(this)},o.SelectMode={REPLACE:0,RANGE:1,ADD:2,ADD_RANGE:3,TOUCH:4,EMPTY:8},o.SelectAction={REPLACE:0,ADD:1,SUBTRACT:2,INTERSECT:3},o.RootState=function(){var e,t;this.buttons={collapser:c},this.oncontext=null,this.longTouchDelay=1e3,this.actions={toggleExpanded:u,expandAll:g,select:(e=this,t=null,function(n,r){var a,s,d,l,h,c,u,p;if(c=e.selectionModel){if(s=n.document,r===o.SelectMode.EMPTY)t=null,u=[],p=o.SelectAction.REPLACE;else if(r===o.SelectMode.TOUCH||r===o.SelectMode.ADD)t=n,u=[n],p=c.isSelected(n)?o.SelectAction.SUBTRACT:o.SelectAction.ADD;else if(r===o.SelectMode.REPLACE)t=n,u=[n],p=o.SelectAction.REPLACE;else if(r===o.SelectMode.RANGE||r===o.SelectMode.ADD_RANGE){for(a=t&&t.parent;a;a=a.parent)if(!a.expanded){t=null;break}for(a=t;a&&a!==n;a=a.dftNext(s,!a.expanded));if(a)d=t,l=n;else{for(a=n;a&&a!==t;a=a.dftNext(s,!a.expanded));a?(d=n,l=t):(t=n,d=l=n)}for(u=[],h=l.dftNext(s,!l.expanded),a=d;a!==h;a=a.dftNext(s,!a.expanded))u.push(a);r===o.SelectMode.RANGE?p=o.SelectAction.REPLACE:(p=c.isSelected(t)?o.SelectAction.ADD:o.SelectAction.SUBTRACT,t=n)}e.ignoreGroups&&(u=u.filter(function(e){return e.type!==i.Group.Type})),c.updateSelection(u,p)}}),insert:F},this.selectionModel=null,this.dragMultipleNodes=!1,this.movePredicate=void 0,this.insertPredicate=void 0,this.dnd_enabled=!1,this.hideOverviewOnDrag=!0,this.dnd_dragStart=void 0,this.dnd_isMove=void 0,this.dnd_dropPredicate=void 0,this.dnd_drop=void 0,this.ignoreGroups=!1,this.pickGroupChildren=!1,this.groupMinGap=50,this.extendLastRow=!1},o.RootState.prototype.ontouchstart=function(e,n){function i(){s&&(s.cancel(),s=null)}var r,a,s,d;if(e&&e.graph&&Y(e.graph),a=this,2===n.changedTouches.length)return{consume:!0,state:t.TwoPointsViewpointWait};if(n.changedTouches.length>2)return{consume:!0,state:t.WaitLastTouch};d=I(n.graphTouches[0].grElt,this.ignoreGroups),s=this.oncontext?{cb:this.oncontext,timer:setTimeout(function(){e.setState(t.WaitLastTouch),s.cb.call(a,s.data)},this.longTouchDelay),cancel:function(){clearTimeout(this.timer)},data:{device:"touch",node:d,subElt:n.graphTouches[0].subElt,dom:n.graphTouches[0].target,clientPos:n.graphTouches[0].clientPos,graphPos:n.graphTouches[0].graphPos,modifiers:n.modifiers}}:null,r={ontouchstart:function(e,n){return Y(e.graph),i(),1===n.changedTouches.length?{consume:!0,state:t.TwoPointsViewpointWait}:{consume:!0,state:t.WaitLastTouch}},ontouchend:function(e){var t,r;return i(),(r=I(n.graphTouches[0].grElt,a.ignoreGroups))?(t=a.buttons[n.graphTouches[0].subElt])?t(r,1,a.actions):B(a,0,r,o.SelectMode.TOUCH):B(a,0,e.graph.data,o.SelectMode.EMPTY),{consume:!0,state:null}},ontouchcancel:function(){return i(),{consume:!0,state:null}},ontouchmove:function(r,s){var d,l;return t.isTouchDragSignificant(s)?(i(),(d=I(n.graphTouches[0].grElt,a.ignoreGroups))?(a.dragMultipleNodes&&a.selectionModel.isSelected(d)||B(a,0,d,o.SelectMode.REPLACE),(l=W(a,d)).length&&e.startdrag(new b(a,r,l,d))):e.startdrag(new t.ViewpointMoveDrag(e.graphView)),{consume:!0,state:t.EndDragOnTouchChange}):{consume:!0}}};var l=this.dnd_enabled&&q(n.graphTouches[0].dom);if(l){var h=n.graphTouches[0];r.ondragstart=function(e,t){if(d){var n=W(a,d);return t.dragStart=h,Z(a,e,t,n,d)}}}return{consume:!l,state:r}},o.RootState.prototype.ontouchmove=function(e,t){return{consume:!0}},o.RootState.prototype.ontouchend=function(e,t){return{consume:!0}},o.RootState.prototype.ontouchcancel=function(e,t){return{consume:!0}},o.RootState.prototype.ondoubleclick=function(e,n){var i,r;if(n.button===t.Buttons.LEFT){if(!(r=I(n.grElt,this.ignoreGroups)))return{};if(i=this.doubleClickOnNode)return i(r),{consume:!0}}return{}},o.RootState.prototype.onmousedown=l("RootState","onmousedown"),o.RootState.prototype.ondragenter=X,o.RootState.prototype.ondragover=X,o.RootState.prototype.ondrop=X,o.RootState.prototype.oncontextmenu=function(){return this.oncontext?{consume:!0}:{}},o.RootState.prototype.onwheel=l("RootState","onwheel"),o}),define("etree/iact",["DS/etree/iact"],function(e){return e}),define("DS/etree/syncviews",["DS/egraph/utils","DS/egraph/views","DS/egraph/core","DS/etree/tree","DS/Utilities/Dom"],function(e,t,n,i,r){"use strict";var o={},a=document.createElement("div");a.innerHTML=['<div class="etree-sync-node" draggable="true">','  <div class="etree-sync-node-widget">','    <div class="etree-sync-node-color"></div>','    <div class="etree-sync-node-thumbnail"></div>','    <div class="etree-sync-node-caption">','      <div class="etree-sync-node-icon"></div>','      <div class="etree-sync-node-badgeTopRight"></div>','      <div class="etree-sync-node-badgeBottomRight"></div>','      <div class="etree-sync-node-label">noname</div>','      <div class="etree-sync-node-moreinfo" data-egraph-subelt="moreinfo"></div>',"    </div>","  </div>",'  <div class="etree-sync-node-collapse-expand" data-egraph-subelt="collapse-expand">','    <div class="etree-sync-node-collapse-expand-spinner"></div>',"  </div>","</div>",'<div class="etree-sync-temp-node">',"</div>",'<div class="etree-sync-group">',"</div>"].join("\n");var s=a.querySelector(".etree-sync-node"),d=a.querySelector(".etree-sync-temp-node"),l=a.querySelector(".etree-sync-group"),h=function(){t.HTMLNodeView.call(this)};e.inherit(h,t.HTMLNodeView),h.prototype.buildNodeElement=function(){return l.cloneNode(!0)};var c=function(){t.HTMLNodeView.call(this)};e.inherit(c,t.HTMLNodeView),c.prototype.buildNodeElement=function(){return s.cloneNode(!0)},c.prototype.onmodifyDisplay=function(e,o){var a,s,d,l;t.HTMLNodeView.prototype.onmodifyDisplay.apply(this,arguments),a=this.display.elt,n.inPathSet(o,"data","data","options","isBeingCut")&&(e.data.data.options.isBeingCut?a.classList.add("is-being-cut"):a.classList.remove("is-being-cut")),n.inPathSet(o,"data","data","options","icons")&&((s=a.querySelector(".etree-sync-node-icon")).className="",s.classList.add("etree-sync-node-icon"),e.data.data.options.icons&&e.data.data.options.icons.length>0?r.generateIcon(e.data.data.options.icons[0],{target:s}):s.classList.add("hidden"));var h=e.data.data.getBadges();if((s=a.querySelector(".etree-sync-node-badgeTopRight"))&&(s.className="",s.classList.add("etree-sync-node-badgeTopRight"),h&&h.topRight?r.generateIcon(h.topRight,{target:s}):s.classList.add("hidden")),(s=a.querySelector(".etree-sync-node-badgeBottomRight"))&&(s.className="",s.classList.add("etree-sync-node-badgeBottomRight"),h&&h.bottomRight?r.generateIcon(h.bottomRight,{target:s}):s.classList.add("hidden")),n.inPathSet(o,"data","data","options","color")&&(s=a.querySelector(".etree-sync-node-color"),e.data.data.options.color?(a.classList.add("colorized"),s.style.backgroundColor=e.data.data.options.color):a.classList.remove("colorized")),n.inPathSet(o,"data","data","options","label")){var c=e.data.data.options.label,u=e.data.data.options.alternText;s=a.querySelector(".etree-sync-node-label"),c&&"object"!=typeof c?s.textContent=c:u&&(s.textContent=u),a.querySelector(".etree-sync-node-widget").setAttribute("title",c)}if(n.inPathSet(o,"data","data","options","showMoreInfo")&&((s=a.querySelector(".etree-sync-node-moreinfo")).classList.remove("hidden"),!1===e.data.data.options.showMoreInfo&&s.classList.add("hidden")),n.inPathSet(o,"data","data","options","thumbnail")&&(s=a.querySelector(".etree-sync-node-thumbnail"),(l=e.data.data.options.thumbnail)||(l="../etree/assets/ghost.png"),s.style.backgroundImage='url("'+l+'")'),n.inPathSet(o,"data","displayFlags")&&(e.data.displayFlags&i.DisplayFlags.DRAGGED?a.classList.add("dragged"):a.classList.remove("dragged"),e.data.displayFlags&i.DisplayFlags.DRAG_NODE?a.classList.add("drag-node"):a.classList.remove("drag-node")),(n.inPathSet(o,"data","data","_isHighlighted")||n.inPathSet(o,"data","data","_isSelected"))&&(e.data.data._isHighlighted||e.data.data._isSelected?a.classList.add("highlighted"):a.classList.remove("highlighted")),n.inPathSet(o,"data","data","_isMatchingSearch")&&(e.data.data._isMatchingSearch?a.classList.add("matching-search"):a.classList.remove("matching-search")),n.inPathSet(o,"data","data","_expandState"))switch((d=a.querySelector(".etree-sync-node-collapse-expand").classList).remove("expanded"),d.remove("collapsed"),d.remove("expanding"),d.remove("partiallyExpanded"),d.remove("hidden"),e.data.data._expandState){case"collapseState":d.add("expanded");break;case"expandingState":d.add("expanding");break;case"expandState":d.add("collapsed");break;case"partiallyExpandedState":d.add("partiallyExpanded");break;default:d.add("hidden")}n.inPathSet(o,"data","*drawingModifiers*")&&e.data.document&&(a.classList.remove("root-on-left"),a.classList.remove("root-on-right"),a.classList.remove("root-on-bottom"),e.data.document.drawingModifiers&i.DrawingModifiers.HORIZONTAL?e.data.document.drawingModifiers&i.DrawingModifiers.MIRROR_DEPTH?a.classList.add("root-on-right"):a.classList.add("root-on-left"):e.data.document.drawingModifiers&i.DrawingModifiers.MIRROR_DEPTH&&a.classList.add("root-on-bottom")),n.inPathSet(o,"data","height")&&(isNaN(e.data.height)?a.classList.remove("v-collapsed"):a.classList.add("v-collapsed"))};var u=function(){return new t.SVGEdgeView("etree-sync-edge")},p=function(){t.HTMLNodeView.call(this)};e.inherit(p,t.HTMLNodeView),p.prototype.buildNodeElement=function(){return d.cloneNode(!0)};var g=function(){return new t.SVGEdgeView("etree-sync-temp-edge")};return o.newNodeView=function(){return new c},o.newEdgeView=function(){return new u},o.newGroupView=function(){return new h},o.newTempNodeView=function(){return new p},o.newTempEdgeView=function(){return new g},o.newTempGroupView=function(){return new p},o}),define("etree/syncviews",["DS/etree/syncviews"],function(e){return e}),define("DS/etree/basicviews",["DS/etree/tree","DS/egraph/utils","DS/egraph/views","DS/egraph/core"],function(e,t,n,i){"use strict";var r={},o=document.createElement("div");o.innerHTML=['<div class="etree-basic-node">','  <div class="etree-basic-node-name">noname</div>','  <div class="etree-basic-node-collapser" data-egraph-subelt="collapser"></div>',"</div>",'<div class="etree-basic-temp-node">',"</div>"].join("\n");var a=o.querySelector(".etree-basic-node"),s=o.querySelector(".etree-basic-temp-node");return r.newNodeView=function(){return new r.NodeView},r.NodeView=function(){n.HTMLNodeView.call(this)},t.inherit(r.NodeView,n.HTMLNodeView),r.NodeView.prototype.buildNodeElement=function(e){return a.cloneNode(!0)},r.NodeView.prototype.onmodifyDisplay=function(t,r){var o,a,s;n.HTMLNodeView.prototype.onmodifyDisplay.apply(this,arguments),o=this.display.elt,i.inPathSet(r,"data","data","name")&&(o.querySelector(".etree-basic-node-name").textContent=t.data.data.name),t.type===i.Type.GROUP&&i.inPathSet(r,"collapsed")&&(t.collapsed?o.classList.remove("group-expanded"):o.classList.add("group-expanded")),i.inPathSet(r,"data","displayFlags")&&(t.data.displayFlags&e.DisplayFlags.DRAGGED?o.classList.add("dragged"):o.classList.remove("dragged")),(i.inPathSet(r,"data","data","highlighted")||i.inPathSet(r,"data","displayFlags"))&&(!t.data.data.highlighted||t.data.displayFlags&e.DisplayFlags.DRAG_NODE?o.classList.remove("highlighted"):o.classList.add("highlighted")),(i.inPathSet(r,"data","*children*")||i.inPathSet(r,"data","expanded"))&&((a=o.querySelector(".etree-basic-node-collapser").classList).remove("expanded"),a.remove("collapsed"),t.data.first&&(t.data.expanded?a.add("expanded"):a.add("collapsed"))),i.inPathSet(r,"data","*drawingModifiers*")&&t.data.document&&(a=o.querySelector(".etree-basic-node-collapser").classList,(s=t.data.document.drawingModifiers)&e.DrawingModifiers.MIRROR_SIBLINGS?a.add("mirrored-x"):a.remove("mirrored-x"),s&e.DrawingModifiers.MIRROR_DEPTH?a.add("mirrored-y"):a.remove("mirrored-y"))},r.newGroupView=function(){return new r.GroupView},r.GroupView=r.NodeView,r.GraphView=n.HTMLGraphView,r.newEdgeView=function(){return new r.EdgeView},r.EdgeView=n.SVGEdgeView,r.newTempNodeView=function(){return new r.TempNodeView},r.TempNodeView=function(){n.HTMLNodeView.call(this)},t.inherit(r.TempNodeView,n.HTMLNodeView),r.TempNodeView.prototype.buildNodeElement=function(e){return s.cloneNode(!0)},r.newTempGroupView=function(){return new r.TempGroupView},r.TempGroupView=r.TempNodeView,r.newTempEdgeView=function(){return new r.TempEdgeView},r.TempEdgeView=function(){n.SVGEdgeView.call(this,"etree-basic-temp-edge")},t.inherit(r.TempEdgeView,n.SVGEdgeView),r}),define("etree/basicviews",["DS/etree/basicviews"],function(e){return e}),define("DS/etree/widget",["DS/etree/tree","DS/etree/basicviews","DS/egraph/iact","DS/etree/iact","DS/egraph/utils"],function(e,t,n,i,r){"use strict";var o={EGraphTree:function(a,s){function d(e,t){function n(e){switch(typeof s[e]){case"undefined":return;case"function":return s[e];default:throw new Error("opts."+e+" must be a function or undefined")}}var i,r,o,a;if(i="new"+e.substr(0,1).toUpperCase()+e.substr(1),r=e+"Ctor",o=n(i),a=n(r),o&&a)throw new Error("both opts."+i+" and opts."+r+" can't be set at the same time");return o||(a?function(e){return new a(e)}:t)}var l,h;if(s=s||{},!a||a.nodeType!==Node.ELEMENT_NODE)throw new Error("container must be a DOM element");if(s&&s.rootState)l=s.rootState,["actions","buttons","movePredicate","insertPredicate","oncontext","longTouchDelay","ignoreGroups","pickGroupChildren","groupMinGap","extendLastRow","selectionModel","dragMultipleNodes","dnd_enabled","dnd_dragStart","dnd_isMove","dnd_dropPredicate","dnd_drop"].forEach(function(e){if(s&&void 0!==s[e])throw new Error("can't set opts."+e+" with custom opts.rootState")});else{if(l=new i.RootState,["movePredicate","insertPredicate","oncontext","dnd_dragStart","dnd_isMove","dnd_dropPredicate","dnd_drop","doubleClickOnNode"].forEach(function(e){l[e]=r.function_opt(s,e,l[e])}),["ignoreGroups","pickGroupChildren","extendLastRow","dragMultipleNodes","dnd_enabled"].forEach(function(e){s&&void 0!==s[e]&&(l[e]=Boolean(s[e]))}),s&&s.selectionModel)l.selectionModel=s.selectionModel;else if(s.dragMultipleNodes)throw new Error("can't use opts.dragMultipleNodes without an opts.selectionModel");if(s&&void 0!==s.groupMinGap&&(l.groupMinGap=s.groupMinGap),l.longTouchDelay=r.pos_nonzero_number_opt(s,"longTouchDelay",l.longTouchDelay),s&&s.actions){if("object"!=typeof s.actions)throw new Error("opts.actions must be an object");h=l.actions,s.overrideAllActions&&(l.actions={}),Object.keys(s.actions).forEach(function(e){var t;if("function"!=typeof(t=s.actions[e]))throw new Error("opts.actions["+JSON.stringify(e)+"] is not a function");if(t===o.defaultAction&&"function"!=typeof(t=h[e]))throw new Error("opts.actions["+JSON.stringify(e)+"] can not use defaultAction since it does not exist");l.actions[e]=t})}if(s&&s.buttons){if("object"!=typeof s.buttons)throw new Error("opts.buttons must be an object");s.overrideAllButtons&&(l.buttons={}),Object.keys(s.buttons).forEach(function(e){var t;if("function"!=typeof(t=s.buttons[e]))throw new Error("opts.buttons["+JSON.stringify(e)+" is not a function");l.buttons[e]=t})}}if(this.document=s&&s.document||new e.Document,!(this.document instanceof e.Document))throw new Error("opts.document must be a etree/tree.Document");if(s&&s.nodeWidth&&(this.document.nodeWidth=0|s.nodeWidth),s&&s.nodeHeight&&(this.document.nodeHeight=0|s.nodeHeight),s&&s.rowPadding&&(this.document.rowPadding=0|s.rowPadding),s&&s.siblingPadding&&(this.document.siblingPadding=0|s.siblingPadding),s&&s.mergeConnectorPadding&&(this.document.mergeConnectorPadding=0|s.mergeConnectorPadding),s&&s.subtreePadding&&(this.document.subtreePadding=0|s.subtreePadding),s&&void 0!==s.drawing&&this.document.set("drawing",0|s.drawing),s&&void 0!==s.drawingOpts&&(this.document.drawingOpts=s.drawingOpts),s&&void 0!==s.drawingModifiers&&this.document.set("drawingModifiers",0|s.drawingModifiers),this.document.geometry=this.document.getGeometryFromOptions(s),this.document.preventAntiEdgeOverlayAlgos=!0===s.preventAntiEdgeOverlayAlgos,s&&s.edgePickingArea&&this.document.gr.setEdgePickingAreaOpts(s.edgePickingArea),s&&s.zoom&&(s.zoom.customMgt=s.zoom.customMgt||!0,this.document.gr.setZoomOpts(s.zoom)),s&&s.hideTempNodeInsertionOnDrag&&(this.document.hideTempNodeInsertionOnDrag=!0),s&&s.showBorderOnDraggedOverNodes&&(this.document.addAttrOnDraggedOverElements=!0),s&&s.graphViewCtor&&"function"!=typeof s.graphViewCtor)throw new Error("opts.graphViewCtor must be a function");this.document.addView2("main",new(s&&s.graphViewCtor||t.GraphView)(a),{newNodeView:d("nodeView",t.newNodeView),newGroupView:d("groupView",t.newGroupView),newEdgeView:d("edgeView",t.newEdgeView),newTempNodeView:d("tempNodeView",t.newTempNodeView),newTempGroupView:d("tempGroupView",t.newTempGroupView),newTempEdgeView:d("tempEdgeView",t.newTempEdgeView)}),this.sm=new n.StateMachine(this.document.gr,void 0,l,this.document.gr.views.main)},defaultAction:function(){}};return o}),define("etree/widget",["DS/etree/widget"],function(e){return e}),define("DS/etree/autogroups",["DS/etree/tree"],function(e){"use strict";var t={};function n(t){var n,i,r;for(n=t.first;n;n=r)if(i=n.type===e.Group.Type,r=n.dftNext(t,i),i){for(;n.first;)n.parent.insertBefore(n.first,n);n.parent.removeChild(n)}}t.AutomaticGroups=function(e){if("function"!=typeof e)throw new Error("isLeaf must be a function");this.isLeaf=e,this.enabled=!0,this.firstMarkedGroup=null},t.AutomaticGroups.prototype.setEnabled=function(t,i){t=Boolean(t),this.enabled!==t&&(this.enabled=t,i.forEach(t?function(t,n,i){var r,a,s;for(r=i.first;r;r=a)a=r.dftNext(i,r.type===e.Group.Type),n(r)&&r.prev&&r.parent.type!==e.Document.Type&&(r.prev.type===e.Group.Type?r.prev.insertBefore(r,null):n(r.prev)&&(s=o(t),r.parent.insertBefore(s,r.prev),s.insertBefore(r.prev,null),s.insertBefore(r,null)))}.bind(void 0,this,this.isLeaf):n))},t.AutomaticGroups.prototype.insertBefore=function(t,n,i){var r,a,s,d,l,h;if(t.type!==e.Node.Type&&t.type!==e.Document.Type)throw new Error("parent must be an etree Node or Document");if(n.type!==e.Node.Type)throw new Error("child must be an etree Node");if(i&&i.type!==e.Node.Type)throw new Error("next must be an etree Node");if(this.enabled&&t.type!==e.Document.Type){if(r=i?i.prev:t.last,this.isLeaf(t))throw new Error("can't add children to a leaf");if(this.isLeaf(n))i&&i.parent!==t?i.parent.insertBefore(n,i):r&&r.type===e.Group.Type?r.insertBefore(n,null):i&&this.isLeaf(i)?(s=o(this),t.insertBefore(s,i),s.insertBefore(n,null),s.insertBefore(i,null)):r&&this.isLeaf(r)?(s=o(this),t.insertBefore(s,r),s.insertBefore(r,null),s.insertBefore(n,null)):t.insertBefore(n,i);else if(i&&i.parent!==t&&r){if((a=i.parent).prev&&a.prev.type===e.Group.Type&&(s=a.prev),a.next&&a.next.type===e.Group.Type&&(d=a.next),s||d||(d=o(this),t.insertBefore(d,a.next)),s){for(l=a.first;l!==i;l=h)h=l.next,s.insertBefore(l,null);t.insertBefore(n,a)}else{for(l=a.last;l!==r;l=h)h=l.prev,d.insertBefore(l,d.first);t.insertBefore(n,a.next)}a.first===a.last&&a.data.mark(this,2)}else i&&i.parent!==t?t.insertBefore(n,i.parent):t.insertBefore(n,i)}else t.insertBefore(n,i)},t.AutomaticGroups.prototype.removeChild=function(t){var n,i,r,a,s,d;if(t.type!==e.Node.Type)throw new Error("child must be an etree Node");n=t.parent,this.enabled&&n.type!==e.Document.Type?(s=t.next,d=t.prev,n.type!==e.Group.Type&&(i=s&&s.type===e.Group.Type,r=d&&d.type===e.Group.Type,i&&r?(d.data.mark(this,2),s.data.mark(this,2)):i?d&&this.isLeaf(d)&&s.insertBefore(d,s.first):r?s&&this.isLeaf(s)&&d.insertBefore(s,null):s&&this.isLeaf(s)&&d&&this.isLeaf(d)&&((a=o(this)).insertBefore(d,null),a.insertBefore(s,null),n.insertBefore(a,t))),n.removeChild(t),n.type===e.Group.Type&&n.first===n.last&&n.data.mark(this,2)):n.removeChild(t)},t.AutomaticGroups.prototype.changeLeaf=function(t){var n,i;if(t.type!==e.Node.Type)throw new Error("child must be an etree Node");if(n=t.parent){n.type===e.Group.Type&&(n=n.parent),i=t;do{i=i.dftNext(n,i.type!==e.Group.Type||i.parent!==n)}while(i&&i.type===e.Group.Type);this.removeChild(t),this.insertBefore(n,t,i)}},t.AutomaticGroups.prototype.update=function(){var t,n,i;for(t=this.firstMarkedGroup;t;t=t.next)(n=t.group).prev&&n.prev.type===e.Group.Type&&e.mergeSiblingGroups(n.prev,!(1&n.prev.data.flags));for(t=this.firstMarkedGroup;t;t=t.next)(n=t.group).parent&&n.first===n.last&&(n.first&&n.parent.insertBefore(n.first,n),n.parent.removeChild(n));for(t=this.firstMarkedGroup,this.firstMarkedGroup=null;t;t=i)i=t.next,t.next=null,t.flags=0},t.convertParent=function(t){return t.type===e.Group.Type?t.parent:t},t.convertNext=function(t,n){if(t.type===e.Group.Type&&(n||(n=t.next)),n&&n.type===e.Group.Type&&!(n=n.first))throw new Error("internal error");return n},t.nextNotDragged=function(t,n){for(;n||t.type!==e.Group.Type||(n=t.next,t=t.parent),n;)if(n.type!==e.Group.Type){if(!(n.displayFlags&e.DisplayFlags.DRAGGED))break;n=n.next}else t=n,n=n.first;return n},t.convertPrev=function(t,n){if(t.type===e.Group.Type&&(n||(n=t.prev)),n&&n.type===e.Group.Type&&!(n=n.last))throw new Error("internal error");return n},t.insertPredicate=function(n,i,r){var o;if(i.type!==e.Node.Type)throw new Error("this predicate must not be called with a group");return o=t.convertPrev(n,r?r.prev:n.last),r=t.convertNext(n,r),n=t.convertParent(n),i!==r&&i!==o},t.insertPredicate2=function(n,i){var r,o,a,s;return r=t.convertPrev(n,i?i.prev:n.last),i=t.convertNext(n,i),n=t.convertParent(n),o=Boolean(n.displayFlags&e.DisplayFlags.DRAGGED),a=Boolean(i&&i.displayFlags&e.DisplayFlags.DRAGGED),s=Boolean(r&&r.displayFlags&e.DisplayFlags.DRAGGED),!(o||s===a&&a)};var i=0;function r(e){this.id=i++,this.group=e,this.flags=0,this.next=null}function o(t){var n;return(n=new e.Group).data=new r(n),n.data.mark(t,1),n.setExpanded(!0),n}return r.prototype.mark=function(e,t){if(!t)throw new Error("internal error");this.flags||(this.next=e.firstMarkedGroup,e.firstMarkedGroup=this),this.flags|=t},r.prototype.toString=function(){var e;return e=[],1&this.flags&&e.push("new"),2&this.flags&&e.push("merge/prune"),"autogroup."+this.id+"["+e.join(", ")+"]"},t.traceUpdates=!1,t}),define("DS/etree/synctree",["DS/etree/tree","DS/Tree/TreeDocument","DS/egraph/utils","DS/etree/autogroups"],function(e,t,n,i){"use strict";var r={};function o(e){var t;return"collapseState"===(t=e._expandState)||"partiallyExpandedState"===t}function a(t,n){var i,r;return(i=new e.Node(n)).setExpanded(o(n)),(r=t.onnewnode)&&r(i,n),i}function s(e){return e?e.data&&e.data.options?"Node("+e.data.options.label+")":"Node":String(e)}function d(e){r.traceUpdates&&(e.lock?console.log("sync recursive lock, "+e.lock+" already"):console.log("sync locks the update")),e.lock||e.document.updateLock(),++e.lock}function l(e){if(--e.lock,r.traceUpdates&&(e.lock?console.log("sync recursive unlock, "+e.lock+" left"):console.log("sync unlocks the update")),!e.lock)try{e.autogrouping.update()}finally{e.document.updateUnlock()}}function h(e,t){d(e);try{return t.apply(e,Array.prototype.slice.call(arguments,2))}finally{l(e)}}function c(e){return e.data.__last_is_leaf_result__="noExpandState"===e.data._expandState}function u(t,n){n.type!==e.Document.Type&&(n.data.__last_is_leaf_result__,void 0!==c(n)&&t.autogrouping.changeLeaf(n))}function p(e,t){var n,i,r,o;if((i=t.data).__treeGraphRoot__)throw new Error("duplicated root?");r=i.__treeGraphRoot__=[],n=i._modelEvents,-1===e.firstFreeRoot?(o=e.roots.length,e.roots.push(t)):(o=e.firstFreeRoot,e.firstFreeRoot=e.roots[o],e.roots[o]=t),r.push(o),r.push(n.addEventListener("expand",f.bind(e))),r.push(n.addEventListener("collapse",f.bind(e))),r.push(n.addEventListener("expandStateChange",f.bind(e))),r.push(n.addEventListener("addChild",y.bind(e))),r.push(n.addEventListener("removeChild",v.bind(e))),r.push(n.addEventListener("highlight",N.bind(e))),r.push(n.addEventListener("unhighlight",N.bind(e))),r.push(n.addEventListener("select",C.bind(e))),r.push(n.addEventListener("unselect",C.bind(e))),r.push(n.addEventListener("matchSearch",x.bind(e))),r.push(n.addEventListener("unmatchSearch",x.bind(e))),r.push(n.addEventListener("nodeModelUpdate",E.bind(e))),r.push(n.addEventListener("postCollapse",m.bind(e))),r.push(n.addEventListener("postExpand",m.bind(e))),r.push(n.addEventListener("preCollapse",m.bind(e))),r.push(n.addEventListener("preExpand",m.bind(e)))}function g(e,t){var n,i,r,o,a;if(r=(i=t.data).__treeGraphRoot__,i.__treeGraphRoot__=null,!r)throw new Error("duplicated root?");if(o=r[0],e.roots[o]!==t)throw new Error("internal error");for(e.roots[o]=e.firstFreeRoot,e.firstFreeRoot=o,n=i._modelEvents,o=1,a=r.length;o<a;++o)n.unsubscribe(r[o])}function f(e){var t,n;if(!this.lock)return h(this,f,e);t=e.target,r.traceUpdates&&console.log(s(t.__treeGraphNode__)+" expand changed to "+t._expandState),(n=t.__treeGraphNode__).setExpanded(o(t)),n.notifyUpdate("_expandState",null),u(this,n)}function m(e){var t,n,i,o;n=(t=e.target).__treeGraphNode__,"expandingState"===t._expandState&&(r.traceUpdates&&console.log(s(t.__treeGraphNode__)+" expand changed to "+t._expandState),i=n.grNode,o=t._expandState,i&&o&&i.views.main.onmodifyDisplay(i,{data:{data:{_expandState:o}}}),n.notifyUpdate("_expandState",null))}function w(t){var n=t.__treeGraphNode__;n.type===e.Node.Type&&o(t)!==n.expanded&&(r.traceUpdates&&console.log(s(t.__treeGraphNode__)+" expand changed to "+t._expandState+" (change from bypass)"),n.setExpanded(o(t))),r.traceUpdates&&console.log(s(t.__treeGraphNode__)+" expand may have changed to "+t._expandState),n.notifyUpdate("_expandState",null)}function y(e){var t,n,i,o,d,l,c,p;if(!this.lock)return h(this,y,e);if(n=(t=e.target).__treeGraphNode__,i=t.options.children,o=e.data.nodeModel,i[l=e.data.nodeIndex]!==o)throw new Error('internal error, "addChild" event gave bad index');if(c=l+1<i.length?i[l+1]:null){if(!(p=c.__treeGraphNode__))throw new Error("internal error, next sibling has no node")}else p=null;n.document,u(this,n),(d=o.__treeGraphNode__)?(r.traceUpdates&&console.log("replugging root "+s(d)),g(this,d)):(d=o.__treeGraphNode__=a(this,o),r.traceUpdates&&console.log("creating "+s(d)),b(this,d,o)),r.traceUpdates&&console.log("++ "+s(d)+" -> "+s(n)+" before "+s(p)),this.autogrouping.insertBefore(n,d,p),w(t)}function v(e){var t,n,i;if(!this.lock)return h(this,v,e);(n=(t=e.target).__treeGraphNode__).document,(i=e.data.nodeModel.__treeGraphNode__).prev,r.traceUpdates&&console.log("-- "+s(i)+" -> "+s(n)),i&&i.parent&&(this.autogrouping.removeChild(i),u(this,n),w(t),r.traceUpdates&&console.log("new root "+s(i)),p(this,i))}function _(e){return function(t){var n;(n=t.target.__treeGraphNode__)&&(n.notifyUpdate(e,void 0),r.traceUpdates&&console.log("onprop "+e+" for node "+s(n)))}}r.Sync=function(t,o){if(!(t instanceof e.Document))throw new Error("document must be an instance of etree/tree.Document");if(t.onnodedetached)throw new Error("can't register on Document#onnodedetached, already a callback");this.document=t,this.model=null,this.autogrouping=new i.AutomaticGroups(c),this.autogrouping.setEnabled(!1,[]),this.onnewnode=n.function_opt(o,"onnewnode",null),this.document.onnodedetached=function(e){e.data.__treeGraphRoot__&&(r.traceUpdates&&console.log("destroyed root "+s(e)),g(this,e));e.data.__treeGraphNode__===e&&(e.data.__treeGraphNode__=null);e.data=null}.bind(this),this.lock=0,this.roots=[],this.firstFreeRoot=-1};var N=_("_isHighlighted"),C=_("_isSelected"),x=_("_isMatchingSearch"),E=_("options");function b(e,t,n){var i,o,d,l,h;if(d=n.options.children)for(i=0,o=d.length;i<o;++i)(h=(l=d[i]).__treeGraphNode__)||(l.__treeGraphNode__=h=a(e,l),r.traceUpdates&&console.log("creating "+s(h)),b(e,h,l)),e.autogrouping.insertBefore(t,h,null)}return r.Sync.prototype.setAutogroups=function e(t){var n;if(!this.lock)return h(this,e,t);n=this.roots.filter(function(e){return"object"==typeof e}),this.autogrouping.setEnabled(t,n)},r.Sync.prototype.setModel=function(e){var n,i;if(e!==this.model){if(null!==e&&!(e instanceof t))throw new Error("model must be a TreeDocument instance");if(!this.document.isUpdated())throw new Error("can't change model while update is locked!");this.model&&(g(this,this.document),this.document.withLockedUpdate(function(){this.document.clear(),this.autogrouping.update()},this),this.model.__treeDocument__=null,this.model._trueRoot.__treeGraphNode__=null,this.document.data=null),this.model=e,this.model&&this.document.withLockedUpdate(function(){this.document.vetoUpdateAnimation(),this.document.setFixNode(null),this.model.__treeDocument__=this.document,this.model._trueRoot.__treeGraphNode__=this.document,this.document.data=this.model._trueRoot,b(this,this.document,this.model._trueRoot),n=this.model._trueRoot._modelEvents,p(this,this.document),(i=this.model._trueRoot.__treeGraphRoot__).push(n.addEventListener("prepareUpdate",function(){r.traceUpdates&&console.log("preupdate"),d(this)}.bind(this))),i.push(n.addEventListener("pushUpdate",function(){r.traceUpdates&&console.log("postupdate"),l(this)}.bind(this))),this.autogrouping.update()},this)}},r.traceUpdates=!1,r}),define("etree/synctree",["DS/etree/synctree"],function(e){return e}),define("DS/etree/overviewui",["DS/egraph/utils","DS/etree/widget","DS/etree/tree","DS/etree/synctree","DS/etree/syncviews","DS/etree/iact","DS/egraph/iact","DS/egraph/views","DS/egraph/overview"],function(e,t,n,i,r,o,a,s,d){"use strict";var l={EGraphOverviewUI:function(e,t,n){t.document.addView2("ovr",new d.GraphView(e,t.document.gr.views.main,{hole:{className:"etree-sync-overview-hole"}}),{newNodeView:function(e){return!0},newGroupView:function(e){return!0}}),new a.StateMachine(t.document.gr,null,new d.RootState,t.document.gr.views.ovr)}};return l}),define("DS/etree/syncwidget",["DS/egraph/utils","DS/etree/widget","DS/etree/tree","DS/etree/synctree","DS/etree/syncviews","DS/etree/iact","DS/egraph/iact","DS/egraph/views","DS/egraph/core","DS/etree/overviewui","DS/etree/autogroups","DS/UIBehaviors/ContextualMenuManager","DS/Menu/Menu","UWA/Class/Promise","i18n!DS/etree/assets/nls/overviewui.json"],function(e,t,n,i,r,o,a,s,d,l,h,c,u,p,g){"use strict";var f={LayoutMode:{LAYERED:0,LAYERED_TIDY_1:1},ReframeMode:{START:1,ALL:2,LIST:4,MAXSCALE:8},OrientationMode:{ROOT_ON_TOP:0,ROOT_ON_LEFT:1,ROOT_ON_BOTTOM:2,ROOT_ON_RIGHT:3},ThumbnailState:{COLLAPSED:1,EXPANDED:2}},m={ZOOM_IN:1,ZOOM_OUT:2,ZOOM_ONE:3,ZOOM_SLIDER:4,ZOOM_FIT:5,ZOOM_MANUAL:6},w=!1;function y(e){this.sw=e}function v(e){if(e)return Array.isArray(e)?e.map(v):e.__treeGraphNode__}function _(e){if(e)return Array.isArray(e)?e.map(_):e.data}function N(e,t){if(e){var n={};return e.hasOwnProperty("modifiers")&&(n.modifiers=e.modifiers),e.hasOwnProperty("internal")&&(n.internal=e.internal),e.hasOwnProperty("nodes")&&(n.nodes=_(e.nodes)),e.hasOwnProperty("node")&&(n.node=_(e.node)),e.hasOwnProperty("move")&&(n.move=e.move),e.hasOwnProperty("recenter")&&(n.recenter=function(t){e.recenter(v(t))}),"boolean"==typeof t&&(n.isRoot=Boolean(t)),n}}function C(e,t,i){n.timeit(this,function(){i.toggleExpanded&&i.toggleExpanded(e)})}function x(e,t,i){n.timeit(this,function(){i.moreInfo&&i.moreInfo(e)})}function E(e,t,n){var i,r,o,a,s,d,l,h,c,u,p,g,m,w,y,v,_,N,C,x,E,b;if(this.sync.model&&this.widget.document.first&&(!(e&f.ReframeMode.LIST)||n&&0!==n.length)&&!((i=this.widget.document.gr.views.main).container.clientWidth<=0||i.container.clientHeight<=0)){if(o=this.widget.document.nodeWidth,a=this.widget.document.nodeHeight,s=this.widget.document.siblingPadding,d=this.fittingArea.paddingLeft,l=this.fittingArea.paddingRight,h=this.fittingArea.paddingTop,c=this.fittingArea.paddingBottom,b=!0,(u=i.container.clientWidth-2*s-d-l)<=0&&(u=i.container.clientWidth),(p=i.container.clientHeight-2*s-h-c)<=0&&(p=i.container.clientHeight),g=1/0,m=-1/0,w=1/0,y=-1/0,e&f.ReframeMode.LIST)for(E=0;E<n.length;E++)(r=n[E]).left<g&&(g=r.left),r.left+o>m&&(m=r.left+o),r.top<w&&(w=r.top),r.top+a>y&&(y=r.top+a);else if(e&f.ReframeMode.START)for(r=this.widget.document.first;r;r=r.next)r.left<g&&(g=r.left),r.left+o>m&&(m=r.left+o),r.top<w&&(w=r.top),r.top+a>y&&(y=r.top+a);else for(r=this.widget.document.first;r;r=r.dftNext(this.widget.document,!r.expanded))r.left<g&&(g=r.left),r.left+o>m&&(m=r.left+o),r.top<w&&(w=r.top),r.top+a>y&&(y=r.top+a);if(v=m-g,_=y-w,e&f.ReframeMode.START)x=1;else{var T=u/v,S=p/_;x=T<S?T:S}f.ReframeMode.MAXSCALE&&x>1&&(x=1),this.setFixNode(null),e&f.ReframeMode.START&&(this.orientation===f.OrientationMode.ROOT_ON_LEFT||this.orientation===f.OrientationMode.ROOT_ON_RIGHT?_>p&&(b=!1):v>u&&(b=!1)),b?e&f.ReframeMode.ALL||e&f.ReframeMode.LIST?(N=Math.round(.5*(u-x*(m+g))+s+d),C=Math.round(.5*(p-x*(y+w))+s+h)):this.orientation===f.OrientationMode.ROOT_ON_LEFT?(N=s+d-g*x,C=Math.round(.5*(p-x*(y+w))+s+h)):this.orientation===f.OrientationMode.ROOT_ON_RIGHT?(N=s+d-m*x+u,C=Math.round(.5*(p-x*(y+w))+s+h)):this.orientation===f.OrientationMode.ROOT_ON_TOP?(N=Math.round(.5*(u-x*(m+g))+s+d),C=s+h-w*x):this.orientation===f.OrientationMode.ROOT_ON_BOTTOM&&(N=Math.round(.5*(u-x*(m+g))+s+d),C=s+h-y*x+p):(N=s+d-g,C=s+h-w),i.setViewpoint([N,C,x],t)}}function b(){var e,t,n,i,r,o,a,s,l,h,c,u,p,g,f,m;if(this.sync.model)for(o=1/0,g=(e=this.widget.document.gr.views.main).vpt[0],f=e.vpt[1],m=e.vpt[2],n=this.widget.document.nodeWidth,i=this.widget.document.nodeHeight,s=e.container.clientWidth/2,l=e.container.clientHeight/2,t=this.widget.document.first;t&&t.type===d.Type.NODE;t=t.dftNext(this.widget.document,!t.expanded))c=(h=t.left*m+g)+n*m,p=(u=t.top*m+f)+i*m,(a=Math.pow(s-(c+h)/2,2)+Math.pow(l-(p+u)/2,2))<o&&(o=a,r=t);return r}function T(t){var n,i,r,o,a,s,d,l=void 0,h=void 0;switch(i=(n=this.widget.document.gr.views.main).container.clientWidth,r=n.container.clientHeight,a=this.overviewPanel.querySelector(".zoomslider input"),(d=this.widget.document.gr).zoomOpts&&(d.zoomOpts.min&&!isNaN(d.zoomOpts.min)&&(l=d.zoomOpts.min),d.zoomOpts.max&&!isNaN(d.zoomOpts.max)&&(h=d.zoomOpts.max)),s=[l,h,Number(a.step)],t){case m.ZOOM_OUT:w=!0,n.zoominc(-1*Number(a.step)/.5,n.domRoot.clientWidth/2,n.domRoot.clientHeight/2,s),a.value=Math.log(n.vpt[2])/Math.log(2);break;case m.ZOOM_IN:w=!0,n.zoominc(1*Number(a.step)/.5,n.domRoot.clientWidth/2,n.domRoot.clientHeight/2,s),a.value=Math.log(n.vpt[2])/Math.log(2);break;case m.ZOOM_ONE:w=!0,n.zoomone(),a.value=0;break;case m.ZOOM_FIT:w=!0,this.reframeAll(),a.value=Math.log(n.vpt[2])/Math.log(2);break;case m.ZOOM_SLIDER:w=!0;var c=e.calculateNewScale(1,Number(a.value),s);o=e.changeViewpointScale(n.vpt,c,[i/2,r/2],!1),n.setViewpoint(o,!0);break;case m.ZOOM_MANUAL:w||(a.value=Math.log(n.vpt[2])/Math.log(2)),w=!1}}return y.prototype.isSelected=function(e){return e&&this.sw&&this.sw.sync.model&&this.sw.sync.model.getXSO().isIn(e.data)},y.prototype.getSelection=function(){var e=[];this.sw&&this.sw.sync.model&&this.sw.sync.model.getXSO().get().forEach(function(t){e.push(t.__treeGraphNode__)});return e},y.prototype.updateSelection=function(t,n){throw e.newNotImplError()},f.SyncEGraphTree=function(s,d){var l,w=0;if(d&&"number"==typeof d.orientation)switch(this.orientation=d.orientation,d.orientation){case f.OrientationMode.ROOT_ON_TOP:w=0;break;case f.OrientationMode.ROOT_ON_LEFT:w=n.DrawingModifiers.HORIZONTAL;break;case f.OrientationMode.ROOT_ON_BOTTOM:w=n.DrawingModifiers.MIRROR_DEPTH|n.DrawingModifiers.MIRROR_SIBLINGS;break;case f.OrientationMode.ROOT_ON_RIGHT:w=n.DrawingModifiers.HORIZONTAL|n.DrawingModifiers.MIRROR_DEPTH|n.DrawingModifiers.MIRROR_SIBLINGS;break;default:throw new Error("Orientation must be a valid OrientationMode value.")}else this.orientation=f.OrientationMode.ROOT_ON_TOP;this.setFittingArea(d?d.fittingArea:void 0),this.container=document.createElement("div"),this.container.className="etree-sync-container",d&&d.moreInfoCallback&&(this.container.classList.add("etree-sync-container-enable-moreinfo"),this.moreInfoCallback=d.moreInfoCallback),d&&d.onContextualEvent&&(this.container.classList.add("etree-sync-container-enable-moreinfo"),this.onContextualEvent=d.onContextualEvent),d&&d.doubleClickCallback&&(this.doubleClickCallback=d.doubleClickCallback),this.container.innerHTML=['<div class="etree-sync-tree-container"></div>','<div class="etree-sync-overview-panel">','  <div class="etree-sync-overview-container"></div>','  <div class="etree-sync-overview-toolbar">','    <div class="etree-sync-overview-icon zoomout"></div>','    <div class="etree-sync-overview-icon zoomfit"></div>','    <div class="etree-sync-overview-icon zoomone"></div>','    <div class="etree-sync-overview-icon zoomin"></div>','    <div class="etree-sync-overview-slider zoomslider">','      <input type="range" min="-3" max="3" step="0.1" value="0">',"    </div>","  </div>",'  <div class="etree-sync-overview-expander"></div>',"</div>"].join("\n"),s.appendChild(this.container),this.treeContainer=this.container.querySelector(".etree-sync-tree-container"),this.overviewPanel=this.container.querySelector(".etree-sync-overview-panel"),this.overviewContainer=this.container.querySelector(".etree-sync-overview-container"),d&&d.contextCallback&&(this.contextCallback=d.contextCallback),l=d&&d.nodeView?d.nodeView:r,this.widget=new t.EGraphTree(this.treeContainer,{nodeWidth:150,nodeHeight:114,rowPadding:40,siblingPadding:30,newNodeView:l.newNodeView,newEdgeView:l.newEdgeView,newGroupView:l.newGroupView,newTempNodeView:l.newTempNodeView,newTempEdgeView:l.newTempEdgeView,newTempGroupView:l.newTempGroupView,overrideAllActions:!0,selectionModel:new y(this),buttons:{"collapse-expand":C,moreinfo:x},actions:{toggleExpanded:function(e){this.withLockedUpdate(function(){switch(this.setFixNode(e.data),e.data._expandState){case"collapseState":case"expandingState":e.data.collapse();break;case"expandState":case"partiallyExpandedState":e.data.expand()}},this)}.bind(this),select:function(e,t){this.sync.model&&this.withLockedUpdate(function(){t===o.SelectMode.EMPTY?this.sync.model.getXSO().empty():t===o.SelectMode.ADD||this.allowMultiSelectionInTouch&&t===o.SelectMode.TOUCH?this.sync.model.getXSO().isIn(e.data)?this.sync.model.getXSO().remove(e.data):this.sync.model.getXSO().add(e.data):(this.setFixNode(e.data),e.data.select(!0))},this)}.bind(this),insert:function(e,t,i,r){var o=void 0,a=_(e);return Array.isArray(a)||(a=[a]),i=h.nextNotDragged(t,i),t=h.convertParent(t),"function"==typeof this.sync.model.options.doInsert?o=this.sync.model.options.doInsert.call(this.sync.model,a,_(t),_(i),N(r,t instanceof n.Document)):this.widget.sm.rootState.dragMultipleNodes||1!==a.length||(o=this.sync.model.options.insert.call(this.sync.model,a[0],_(t),_(i))),o}.bind(this),moreInfo:function(e){if(this.onContextualEvent){var t=((r=e.grNode.views.main.display.elt.querySelector(".etree-sync-node-moreinfo").getBoundingClientRect()).left+r.right)/2,n=(r.top+r.bottom)/2,i=this.onContextualEvent.callback.call(this.onContextualEvent.this,{context:this.onContextualEvent.context,info:{position:{x:t,y:n},target:void 0},graphview:{view:this,node:e.data,moreinfo:!0}});i&&(i instanceof Promise?i:p.resolve(i)).then(function(e){e&&e.length>0&&u.show(e,{position:{x:t,y:n}})})}else if(this.moreInfoCallback){var r=e.grNode.views.main.display.elt.querySelector(".etree-sync-node-moreinfo").getBoundingClientRect();this.moreInfoCallback(e.data,[(r.left+r.right)/2,(r.top+r.bottom)/2])}}.bind(this)},movePredicate:function(e){var t=!0,n=_(e);return Array.isArray(n)||(n=[n]),"function"==typeof this.sync.model.options.shouldAcceptMove?t=this.sync.model.options.shouldAcceptMove.call(this.sync.model,n):this.widget.sm.rootState.dragMultipleNodes||1!==n.length||(t=this.sync.model.options.shouldAcceptDrag.call(this.sync.model,n[0])),t}.bind(this),insertPredicate:function(e,t,i,r){var o=!0,a=_(t);return Array.isArray(a)||(a=[a]),h.insertPredicate2(e,i)&&(i=h.nextNotDragged(e,i),e=h.convertParent(e),"function"==typeof this.sync.model.options.shouldAcceptInsert?o=this.sync.model.options.shouldAcceptInsert.call(this.sync.model,a,_(e),_(i),N(r,e instanceof n.Document)):this.widget.sm.rootState.dragMultipleNodes||1!==a.length||(o=this.sync.model.options.shouldAcceptDrop.call(this.sync.model,{parentTreeNodeModel:_(e),draggedTreeNodeModel:a[0]}))),o}.bind(this),dnd_dragStart:function(e,t,n){var i=!1;if("function"==typeof this.sync.model.options.doDnDDragStart&&(i=this.sync.model.options.doDnDDragStart.call(this.sync.model,e,_(t),_(n)))&&0===e.types.length){var r="";e.getData(r),r||(n&&n.data&&n.data.dump&&(r=JSON.stringify(n.data.dump())),e.setData("text",r),e.effectAllowed="move")}return i}.bind(this),dnd_isMove:function(e,t){var n=!(t.modifiers&a.Modifiers.CTRL||t.modifiers&a.Modifiers.ALT);return"function"==typeof this.sync.model.options.isDnDMove&&(n=this.sync.model.options.isDnDMove.call(this.sync.model,e,N(t,void 0))),n}.bind(this),dnd_dropPredicate:function(e,t,i,r){var o=!1;return _(r.nodes),h.insertPredicate2(t,i)&&(i=h.nextNotDragged(t,i),t=h.convertParent(t),o="function"!=typeof this.sync.model.options.shouldAcceptDnDDrop||this.sync.model.options.shouldAcceptDnDDrop.call(this.sync.model,e,_(t),_(i),N(r,t instanceof n.Document))),o}.bind(this),dnd_drop:function(e,t,i,r){var o=!1;return _(r.nodes),i=h.nextNotDragged(t,i),t=h.convertParent(t),"function"==typeof this.sync.model.options.doDnDDrop&&(o=this.sync.model.options.doDnDDrop.call(this.sync.model,e,_(t),_(i),N(r,t instanceof n.Document))),o}.bind(this),doubleClickOnNode:this.doubleClickCallback?function(e){this.doubleClickCallback&&this.doubleClickCallback(e)}.bind(this):void 0,extendLastRow:!0,drawingModifiers:w,oncontext:this.contextCallback||this.onContextualEvent?function(e){if(this.onContextualEvent)(t=this.onContextualEvent.callback.call(this.onContextualEvent.this,{context:this.onContextualEvent.context,info:{position:{x:e.clientPos[0],y:e.clientPos[1]},target:void 0},graphview:{view:this,node:e.node?e.node.data:null,moreinfo:!1}}))&&(t instanceof Promise?t:p.resolve(t)).then(function(t){if(t&&t.length>0){u.show(t,{position:{x:e.clientPos[0],y:e.clientPos[1]}});var n=e.clientPos,i=function(e){Math.abs(e.clientX-n[0])>5&&(u.hide(),document.removeEventListener("dragover",i))};document.addEventListener("dragover",i)}});else if(this.contextCallback){var t=this.contextCallback(e.node?e.node.data:null);c.show(t,e.clientPos,"touch"===e.device);var n=function(){c.hide(),document.removeEventListener("dragover",n)};document.addEventListener("dragover",n)}}.bind(this):void 0,edges:{type:"rounded-square",offset:-8},ignoreGroups:!0,pickGroupChildren:!0,edgePickingArea:d?d.edgePickingArea:void 0,zoom:d?d.zoom:void 0,hideTempNodeInsertionOnDrag:d?d.hideTempNodeInsertionOnDrag:void 0,showBorderOnDraggedOverNodes:d?d.showBorderOnDraggedOverNodes:void 0}),this.sync=new i.Sync(this.widget.document),this.sync.onnewnode=function(e,t){"number"==typeof t._thumbnailState?t._thumbnailState===f.ThumbnailState.EXPANDED?e.setHeight(NaN,0):t._thumbnailState===f.ThumbnailState.COLLAPSED&&e.setHeight(32):"number"==typeof this._defaultThumbnailState&&(this._defaultThumbnailState===f.ThumbnailState.EXPANDED?e.setHeight(NaN,0):this._defaultThumbnailState===f.ThumbnailState.COLLAPSED&&e.setHeight(32))}.bind(this),this.overviewPanel.querySelector(".zoomout").addEventListener("click",T.bind(this,m.ZOOM_OUT)),this.overviewPanel.querySelector(".zoomout").setAttribute("title",g.zoom_out),this.overviewPanel.querySelector(".zoomin").addEventListener("click",T.bind(this,m.ZOOM_IN)),this.overviewPanel.querySelector(".zoomin").setAttribute("title",g.zoom_in),this.overviewPanel.querySelector(".zoomone").addEventListener("click",T.bind(this,m.ZOOM_ONE)),this.overviewPanel.querySelector(".zoomone").setAttribute("title",g.zoom_default),this.overviewPanel.querySelector(".zoomfit").addEventListener("click",T.bind(this,m.ZOOM_FIT)),this.overviewPanel.querySelector(".zoomfit").setAttribute("title",g.zoom_fit),this.overviewPanel.querySelector(".zoomslider input").addEventListener("input",T.bind(this,m.ZOOM_SLIDER)),this.overviewPanel.querySelector(".zoomslider input").addEventListener("change",T.bind(this,m.ZOOM_SLIDER)),this.widget.document.gr.views.main.addListener("viewpoint",T.bind(this,m.ZOOM_MANUAL)),d&&"number"==typeof d.layout&&this.setLayout(d.layout);var v=this.treeContainer.firstChild;function E(){v.classList.add("wux-ui-state-focused")}v.setAttribute("tabindex","0"),document.body.addEventListener("blur",function(t){setTimeout(function(){var t=document.activeElement;if(t){var n=e.hasClass(t,"wux-afr-actionbar")?t:e.firstParentWithClass(t,"wux-afr-actionbar"),i=e.hasClass(t,"egraph_views_domroot")?t:e.firstParentWithClass(t,"egraph_views_domroot");i&&!n?E():i||n||v.classList.remove("wux-ui-state-focused")}},1)},!0),v.addEventListener("focus",function(e){E()})},f.SyncEGraphTree.prototype.setModel=function(e){this.sync.setModel(e),this.sync.model&&E.call(this,f.ReframeMode.START|f.ReframeMode.MAXSCALE,!1)},f.SyncEGraphTree.prototype.getModel=function(){return this.sync.model},f.SyncEGraphTree.prototype.reframeAll=function(){E.call(this,f.ReframeMode.ALL|f.ReframeMode.MAXSCALE,!0)},f.SyncEGraphTree.prototype.reframeOn=function(){if(this.sync.model){var e=[];this.sync.model.getXSO().get().forEach(function(t){t.__treeGraphNode__&&e.push(t.__treeGraphNode__)}),E.call(this,f.ReframeMode.LIST|f.ReframeMode.MAXSCALE,!0,e)}},f.SyncEGraphTree.prototype.swapLayoutOrientation=function(){var e=b.call(this);e&&this.setFixNode(e.data);var t=this.widget.document.drawingModifiers;t&n.DrawingModifiers.HORIZONTAL?t&=~n.DrawingModifiers.HORIZONTAL:t|=n.DrawingModifiers.HORIZONTAL,this.widget.document.setDrawing(void 0,t)},f.SyncEGraphTree.prototype.setRootPosition=function(e){var t=b.call(this);t&&this.setFixNode(t.data);var i=void 0;switch(e){case f.OrientationMode.ROOT_ON_TOP:i=0;break;case f.OrientationMode.ROOT_ON_LEFT:i=n.DrawingModifiers.HORIZONTAL;break;case f.OrientationMode.ROOT_ON_BOTTOM:i=n.DrawingModifiers.MIRROR_DEPTH|n.DrawingModifiers.MIRROR_SIBLINGS;break;case f.OrientationMode.ROOT_ON_RIGHT:i=n.DrawingModifiers.HORIZONTAL|n.DrawingModifiers.MIRROR_DEPTH|n.DrawingModifiers.MIRROR_SIBLINGS}this.widget.document.setDrawing(void 0,i),this.orientation=e},f.SyncEGraphTree.prototype.createOverview=function(e){this.overviewPanel.style.display="block",this.overview=new l.EGraphOverviewUI(this.overviewContainer,this.widget,{})},f.SyncEGraphTree.prototype.swapOverviewVisibility=function(){"block"===this.overviewPanel.style.display?this.overviewPanel.style.display="none":this.overviewPanel.style.display="block"},f.SyncEGraphTree.prototype.selectArea=function(){var e=this;this.widget.sm.setState(new a.RectSelectionWaitPt1({overlay:new s.RectangleOverlay(this.widget.sm.graphView,{background:{className:"etree-area-selection-cursor"},rectangle:{className:"etree-area-selection-rectangle"}}),applycb:function(){(function(e){var t,n;t=e.grView.rectanglePick(e.x1,e.y1,e.x2,e.y2,e.pickOpts),this.withLockedUpdate(function(){if(this.sync.model)for(this.sync.model.getXSO().empty(),n=0;n<t.length;n++)this.sync.model.getXSO().add(t[n].data.data)},this)}).call(e,this)}}))},f.SyncEGraphTree.prototype.setFixNode=function(e,t){if(e)if(e.__treeGraphNode__)this.widget.document.setFixNode(e.__treeGraphNode__,t);else{if(!e.group)throw new Error("node must be a Node");this.widget.document.setFixNode(e.group.first.data.__treeGraphNode__,t)}else this.widget.document.setFixNode(null,t)},f.SyncEGraphTree.prototype.setSize=function(e,t){this.widget.document.gr.views.main.setSize(e,t)},f.SyncEGraphTree.prototype.getViewport=function(){var e=this.widget.document.getBounds();if(!e.isValid())return null;var t=this.widget.document.gr.views.main,n=t.vpt[0],i=t.vpt[1],r=t.vpt[2],o=(0-i)/r,a=(t.getSize()[0]-n)/r,s=(t.getSize()[1]-i)/r;return[(0-n)/r-e.xmin,o-e.ymin,a-e.xmax,s-e.ymax]},f.SyncEGraphTree.prototype.setViewport=function(e){var t=this.widget.document.getBounds();if(!t.isValid())return null;var n=this.widget.document.gr.views.main,i=n.getSize()[0],r=n.getSize()[1],o=(0+i)/2,a=(0+r)/2,s=t.xmin+e[0],d=t.ymin+e[1],l=t.xmax+e[2],h=t.ymax+e[3],c=(0-i)/(s-l),u=(0-r)/(d-h);c<=0&&(c=u);var p=c<u?c:u;p<=0&&(p=1);var g=o-(s+l)/2*p,f=a-(d+h)/2*p;n.setViewpoint([g,f,p],!1)},f.SyncEGraphTree.prototype.setFittingArea=function(e){this.fittingArea&&e||(this.fittingArea={paddingLeft:0,paddingRight:0,paddingTop:0,paddingBottom:0}),e&&("number"==typeof e.paddingLeft&&(this.fittingArea.paddingLeft=e.paddingLeft),"number"==typeof e.paddingRight&&(this.fittingArea.paddingRight=e.paddingRight),"number"==typeof e.paddingTop&&(this.fittingArea.paddingTop=e.paddingTop),"number"==typeof e.paddingBottom&&(this.fittingArea.paddingBottom=e.paddingBottom))},f.SyncEGraphTree.prototype.setLayout=function(e){if(e!==f.LayoutMode.LAYERED&&e!==f.LayoutMode.LAYERED_TIDY_1)throw new Error("unexpected layout value");var t=b.call(this);t&&this.setFixNode(t.data),e===f.LayoutMode.LAYERED?this.widget.document.setDrawing(n.Drawing.LAYERED):e===f.LayoutMode.LAYERED_TIDY_1&&this.widget.document.setDrawing(n.Drawing.LAYERED_TIDY_1)},f.SyncEGraphTree.prototype.getThumbnailState=function(e){if(!e||!e.__treeGraphNode__)throw new Error("can't get thumbnail state when node is invalid");return isNaN(e.__treeGraphNode__.height)?f.ThumbnailState.EXPANDED:f.ThumbnailState.COLLAPSED},f.SyncEGraphTree.prototype.setAllThumbnailsState=function(e){if(e!==f.ThumbnailState.EXPANDED&&e!==f.ThumbnailState.COLLAPSED)throw new Error("Invalid thumbnail state, must be either ThumbnailState.EXPANDED or ThumbnailState.COLLAPSED.");this.widget.document.withLockedUpdate(function(){var t;for(this._defaultThumbnailState=e,t=this.widget.document.first;t;t=t.dftNext(this.widget.document))t.type!==n.Group.Type&&this.setThumbnailState(t.data,e)},this)},f.SyncEGraphTree.prototype.setThumbnailState=function(e,t){if(!e||!e.__treeGraphNode__)throw new Error("Invalid node");if(t!==f.ThumbnailState.EXPANDED&&t!==f.ThumbnailState.COLLAPSED)throw new Error("Invalid thumbnail state, must be either ThumbnailState.EXPANDED or ThumbnailState.COLLAPSED.");this.widget.document.withLockedUpdate(function(){var n;e._thumbnailState=t,n=t===f.ThumbnailState.EXPANDED?NaN:32,e.__treeGraphNode__.setHeight(n,this.widget.document.animationDuration)},this)},f.SyncEGraphTree.prototype.swapThumbnailState=function(e){this.getThumbnailState(e)===f.ThumbnailState.EXPANDED?this.setThumbnailState(e,f.ThumbnailState.COLLAPSED):this.setThumbnailState(e,f.ThumbnailState.EXPANDED)},f.SyncEGraphTree.prototype.setAutogroups=function(e){var t=b.call(this);t&&this.setFixNode(t.data),this.sync.setAutogroups(e)},f.SyncEGraphTree.prototype.expandAll=function(e){var t;if(e)this.withLockedUpdate(function(){this.setFixNode(e),e.prepareUpdate(),e.expandAll(),e.pushUpdate()},this);else for(t=this.widget.document.first;t;t=t.next)this.expandAll(t.data)},f.SyncEGraphTree.prototype.setMultiSelectionInTouch=function(e){this.allowMultiSelectionInTouch=Boolean(e)},f.SyncEGraphTree.prototype.setMultiSelectionDrag=function(e){this.widget&&(this.widget.sm.rootState.dragMultipleNodes=Boolean(e))},f.SyncEGraphTree.prototype.setHTML5DnD=function(e){this.widget&&(this.widget.sm.rootState.dnd_enabled=Boolean(e))},f.SyncEGraphTree.prototype.updateLock=function(){if(!this.sync.model)throw new Error("can't lock when no model is set");this.sync.model.prepareUpdate()},f.SyncEGraphTree.prototype.updateUnlock=function(){if(!this.sync.model)throw new Error("can't unlock when no model is set");this.sync.model.pushUpdate()},f.SyncEGraphTree.prototype.withLockedUpdate=function(e,t){this.updateLock();try{return e.call(t)}finally{this.updateUnlock()}},f.insertPredicate=function(e,t){return console.log("ouing"),h.insertPredicate2(v(e),v(t))},f});