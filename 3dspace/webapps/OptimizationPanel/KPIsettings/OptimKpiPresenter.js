define("DS/OptimizationPanel/KPIsettings/OptimKpiPresenter",["DS/Controls/Tab","DS/OptimizationPanel/KPIsettings/KPIconfigContainer","DS/CoreEvents/ModelEvents","DS/Core/Core","css!DS/OptimizationPanel/KPIsettings/PanelKPI.css"],function(t,e,i,n){"use strict";var o=function(t){this._init(t)};return o.prototype._init=function(t){this._listKPI=t&&t.listKPI?t.listKPI:["KPI1","KPI2"],this._modelEventExt=t&&t.modelEvents?t.modelEvents:new i,this._modelEvents=new i,this._tabId=t&&t.modelC0.tabId?t.modelC0.tabId:{},this._content=[],this._configList=[],this._kpiList=[],t.modelC0.tabId=this._tabId,this._initDom(t)},o.prototype._initDom=function(i){if(this._container=document.createElement("div"),this._container.classList.add("panel-container"),this._tabWindow=new t({touchMode:!0,editableFlag:!0,autoCloseFlag:!0,displayStyle:"strip",allowUnsafeHTMLOnTabButton:!1}),this._tabWindow.tabBar.newTabButtonFlag=!0,this._tabWindow.tabBar.closeButtonFlag=!0,this._tabWindow.tabBar.centeredFlag=!1,this._options={tab:this._tabWindow,label:"Optim ",selectedIndex:1},this.id=0,0===Object.keys(this._tabId).length&&this._tabId.constructor===Object)this._initiate_createTab(this._options,i.modelC0);else for(var n in i.modelC0.tabId){var o=document.createElement("div");o.classList.add("tab-content"),o.setAttribute("myid",n),this._content[i.modelC0.tabId[n].index]=new e({listKPI:this._listKPI,modelEvents:this._modelEvents,id:n,meExt:this._modelEventExt,modelC0:i.modelC0}),this._content[i.modelC0.tabId[n].index].inject(o),this._tabWindow.setPageContentFromIndex(i.modelC0.tabId[n].index,o),this._options.tab.add({label:i.modelC0.tabId[n].label,content:o,isSelected:!0,index:i.modelC0.tabId[n].index}),this._options.tab.inject(this._container),this.id=parseInt(n)}var s=this;this._tabWindow.tabBar.onNewTab(function(){s._tabWindow.tabBar.editableFlag=!0;var t=s._tabWindow.tabBar.getTabCount();1===t?s.id:s.id=s.id+1;var n=document.createElement("div");n.classList.add("tab-content"),n.setAttribute("myid",s.id);var o=s._container.querySelectorAll(".wux-controls-tabbar-closebutton");i.modelC0.tabId[s.id]={},i.modelC0.tabId[s.id].index=t-1,i.modelC0.tabId[s.id].label=o[t-1].childNodes[1].innerHTML,s._content[t-1]=new e({listKPI:s._listKPI,modelEvents:s._modelEvents,id:s.id,meExt:s._modelEventExt,modelC0:i.modelC0}),s._content[t-1].inject(n),s._tabWindow.setPageContentFromIndex(t-1,n),s._container.querySelector(".wux-controls-buttongroup").setStyle("margin-left","0px"),s._container.querySelector(".wux-controls-tabbar-button-nopadding").setAttribute("touch-mode","true")}),this._tabWindow.tabBar.onRemoveTabEvent(function(){var t=s._container.querySelector('.tab-content:not([style*="display: none"])').attributes.myid.value,e=0,n=0,o=0,d=[];for(n in i.modelC0.tabId[t].configList)i.modelC0.current===n&&(i.modelC0.current=null),d.push(i.modelC0.defConfig[i.modelC0.tabId[t].configList[n]]),delete i.modelC0.defConfig[i.modelC0.tabId[t].configList[n]];for(e in delete i.modelC0.tabId[t],s._modelEventExt.publish({event:"pc-optim-delete-tab",data:d}),console.log(d),i.modelC0.tabId)i.modelC0.tabId[e]&&(i.modelC0.tabId[e].index=o,o+=1)}),this._subscribeEvents()},o.prototype._initiate_createTab=function(t,i){for(var n=0;n<1;n++){this._div=document.createElement("div"),this._div.classList.add("tab-content"),this._div.setAttribute("myId",n),i.tabId[n]={},i.tabId[n].index=n,this._content[n]=new e({listKPI:this._listKPI,modelEvents:this._modelEvents,id:""+n,meExt:this._modelEventExt,modelC0:i}),this._content[n].inject(this._div);var o=n+1;t.tab.add({label:t.label+o,content:this._div,isSelected:1==t.selectedIndex,index:n})}t.tab.inject(this._container)},o.prototype.inject=function(t){t.appendChild(this._container)},o.prototype._subscribeEvents=function(){this._listSubscription=[],this._listSubscription2=[];var t=this;t._listSubscription.push(t._modelEvents.subscribe({event:"kpilist-generate-configuration-pressed"},function(e){for(var i=0;i<t._content.length;i++)t._content[i]._id===e&&t._modelEventExt.publish({event:"pc-optim-create-config",data:e})})),t._listSubscription.push(t._modelEvents.subscribe({event:"config-created"},function(e){t._modelEventExt.publish({event:"pc-optim-config-created",data:e})})),t._listSubscription.push(t._modelEvents.subscribe({event:"config-name-change"},function(e){t._modelEventExt.publish({event:"pc-optim-change-name",data:e})})),t._listSubscription.push(t._modelEvents.subscribe({event:"config-current-change"},function(e){t._modelEventExt.publish({event:"pc-optim-change-current",data:e})})),t._listSubscription.push(t._modelEvents.subscribe({event:"delete-config"},function(e){t._modelEventExt.publish({event:"pc-optim-delete-config",data:e})})),t._listSubscription2.push(t._modelEventExt.subscribe({event:"pc-optim-conf-to-create"},function(e){t._modelEvents.publish({event:"optimkpipresenter-create-config",data:e})})),t._listSubscription2.push(t._modelEventExt.subscribe({event:"pc-optim-config-color"},function(e){var i=e.id,n=t._container.querySelector("#"+i);n&&(n.firstChild.firstChild.style.background=e.color,n.firstChild.firstChild.style.display="inline-block")})),t._listSubscription2.push(t._modelEventExt.subscribe({event:"pc-optim-change-current-from-graph"},function(t){for(var e=document.querySelectorAll(".wux-ui-3ds-check"),i=0;i<e.length;i++)t==e[i].parentElement.parentElement.id?e[i].setAttribute("checked",!0):e[i].removeAttribute("checked")})),t._listSubscription.push(t._modelEvents.subscribe({event:"config-component-next"},function(e){t._modelEventExt.publish({event:"get-next-configuration",data:e})})),t._listSubscription.push(t._modelEvents.subscribe({event:"config-component-refresh"},function(e){t._modelEventExt.publish({event:"get-same-config-new-userchoices",data:e})}))},o.prototype.destroy=function(){this._container=null;for(var t=this._listSubscription.length,e=0;e<t;e++)this._modelEvents.unsubscribe(this._listSubscription[e]);var i=this._listSubscription2.length;for(e=0;e<i;e++)this._modelEventExt.unsubscribe(this._listSubscription2[e])},o});