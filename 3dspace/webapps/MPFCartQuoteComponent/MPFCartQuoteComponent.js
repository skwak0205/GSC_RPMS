define("DS/MPFCartQuoteComponent/CartQuoteDownloadLink",["UWA/Core","UWA/Class/View","DS/UIKIT/Spinner","DS/MPFServices/ObjectService","DS/MPFCartQuoteModel/CartQuoteModel","DS/MPFFiniteStateMachine/FiniteStateMachine","i18n!DS/MPFCartQuoteComponent/assets/nls/CartQuoteComponent","css!DS/MPFCartQuoteComponent/MPFCartQuoteComponent"],function(t,e,o,n,s,a,i){"use strict";const r="ACTIVE",h="LOADING",c=[{from:r,to:h},{from:h,to:r}],u=Object.freeze({CLICKED:"downloadQuoteClicked",QUOTE_DOWNLOADED:"quoteDownloaded",ERROR:"error"}),d=e.extend({tagName:"div",className:"mpf-cart-quote",setup:function(t){n.requiredOfPrototype(t.quote,s,"options.quote must be a CartQuoteModel"),this.quote=t.quote,this.label=t.label||i.get("downloadQuote"),this.paymentUpdateCb=t.paymentUpdateCb||(()=>Promise.resolve()),this.stateMachine=new a({state:r,states:[r,h],transitions:c}),this.loader=new o},render:function(){return this.stateMachine.getState()===h?(this.container.setContent(this.loader),this.loader.show()):this.container.setContent({tag:"a",class:"mpf-link",target:"_blank",text:this.label,events:{click:this.downloadQuote.bind(this)}}),this},downloadQuote:function(e){return t.Event.stop(e),this.stateMachine.changeState(h),this.render(),this.dispatchEvent(u.CLICKED),this.paymentUpdateCb().then(()=>this.quote.fetchPromise()).then(()=>{this.container.setAttributes({href:this.quote.getUrl()}),window.open(this.quote.getUrl()),this.dispatchEvent(u.QUOTE_DOWNLOADED)}).catch(t=>{console.log(t),this.dispatchEvent(u.ERROR,{error:t})}).finally(()=>{this.stateMachine.changeState(r),this.render()})}});return d.Events=u,d});