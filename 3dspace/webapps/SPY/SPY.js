/*!  Copyright 2014 Dassault Systemes. All rights reserved. */
define("DS/SPY/CATSimNavDataDisplayAbstract",["UWA/Core","UWA/Class","DS/CoreEvents/Events"],function(t,e,i){"use strict";var a=function(t){return t.filter(function(t){return t})},s=function(t,e){var i=t[e],n=i.getChildren?i.getChildren():void 0;if(Array.isArray(n))if(n.length>0){var r=n[0].isExtractable,o=void 0===n[0].getChildren;if(1===n.length&&o&&r){var u=n[0],h=i.getName(),l=u.getTitle?u.getTitle():u.getName();t[e]=u,t[e].children=[],l&&0!==l.length||(t[e].name=h)}else n.forEach(function(t,e){s(n,e)}),n=a(n),i.children=n;if(n.length>1){var d=1;n.forEach(function(t){t.isExtractable&&t.getName()&&t.getName()===i.getName()&&(t.name+=" - "+t.getSuffix()+" #"+String(d),d++)})}}else t[e]=void 0},n=e.extend({_getSortedDuplicates:function(t){for(var e=[],i=t.sort(),a=0;a<i.length-1;a++)i[a+1]===i[a]&&i[a]&&e.push(i[a]);return e},_computeScopeMinMax:function(t){var e=this.getLegend();e&&e.localMin&&e.localMax&&(t.min=Math.min.apply(null,e.localMin.slice(t.globalStart,t.globalEnd+1)),t.max=Math.max.apply(null,e.localMax.slice(t.globalStart,t.globalEnd+1)))},init:function(t,e,i){this.spm=e,this.seq=i,this.id="",this.name="Data Display",this.category="Model",this.thumbnail="",this.defaultMode="ENG",this.activated=!1,this.list2DViews=[],this.list3DViews=[],this.listFrameViews=[],this._listInfoImages=[],this.analytics={},this._analyticsTimeStarts={},this.impl={CATISimNavDataDisplayUI:{module:"SPYUI",ext:"CATSimNavDataDisplayUI",type:"data",obj:null},CATISimNavDataAnimation:{module:"SPYUI",ext:"CATSimNavDataDisplayAnimation",type:"data",obj:null},CATISimNavDataColorShadingManager:{module:"SPYUI",ext:"CATSimNavDataDisplayColorShadingManager",type:"data",obj:null}}},clean:function(){delete this.spm,delete this.seq,delete this.list2DViews,delete this.list3DViews,delete this.listFrameViews,delete this.impl},QI:function(t,e){this.impl&&(this.impl[t]?this.impl[t].obj?e(this.impl[t].obj):require(["DS/"+(this.impl[t].module?this.impl[t].module:"SPY")+"/"+this.impl[t].ext],function(i){if(this.impl){for(var a in this.impl[t].obj=new i,this.impl[t].obj.implementation=this,this.impl)this.impl[a].ext===this.impl[t].ext&&(this.impl[a].obj=this.impl[t].obj);e(this.impl[t].obj)}else e()}.bind(this)):e())},getSPM:function(){return this.spm},getSequence:function(){return this.seq},getNavData2DViewList:function(t){var e=[];if(this.spm&&this.list2DViews){var i=[];if(!this.isShared&&void 0===t){var a=this.spm.getSharedDataDisplayList(this.seq);if(a)for(var s=0;s<a.length;s++)i=i.concat(a[s].getNavData2DViewList())}e=this.list2DViews.concat(i)}return e},getNavData3DViewList:function(t){var e=[];if(this.spm&&this.list3DViews){var i=[];if(!this.isShared&&void 0===t){var a=this.spm.getSharedDataDisplayList(this.seq);if(a)for(var s=0;s<a.length;s++)i=i.concat(a[s].getNavData3DViewList())}e=this.list3DViews.concat(i)}return e},getNavDataFrameViewList:function(t){var e=void 0===t||!0===t?this.category:void 0,i=[];if(this.spm&&this.listFrameViews){var a=[];if(!this.isShared){var s=this.spm.getSharedDataDisplayList(this.seq,e);if(s)for(var n=0;n<s.length;n++)a=a.concat(s[n].getNavDataFrameViewList())}i=this.listFrameViews.concat(a)}return i},simplifyFrameViewList:function(){this.spm&&this.listFrameViews&&(this.listFrameViews.forEach(function(t,e){s(this.listFrameViews,e)}.bind(this)),this.listFrameViews=a(this.listFrameViews))},isEmpty:function(){var t=this.getNavData3DViewList(),e=this.getNavData2DViewList(),i=this.getLegend();return 0===t.length&&e.length===(i?1:0)&&0===this.listFrameViews.length},getStreamlines:function(){return this.getNavData3DViewList().filter(function(t){return"streamLines"===t.subType&&(t.isAStreamLine=!0,!0)})},hasExtremaAvailable:function(t){for(var e,i=!1,a=this.getNavData3DViewList(),s=0;s<a.length&&!e;s++)"CATSimNavData3DExtremasRoot"===a[s].getType()&&(e=a[s]);if(e)for(var n=e.getListExtremasSet(),r=0;r<n.length&&!i;r++){var o=n[r];if(o){var u=o.getExtremas(t);i=u&&u.getListExtrema().length>0}}return i},getLegend:function(){for(var t,e=this.getNavData2DViewList(),i=0;i<e.length;i++)if("CATSimNavData2DLegend"===e[i].type){t=e[i];break}return t},hasMinMax:function(){var t=this.getLegend();return t&&t.hasMinMax()&&!t.NoResults},getGroupInfo:function(t){var e={},i=this.getLegend();if(i){var a=this.getGroupForFrame(t);if(a){if(a.group){var s=function(t){var e={},a=t.globalStart,s=t.globalEnd;e.min=i.localMin[a],e.max=i.localMax[s];for(var n=a+1;n<=s;n++)i.localMin[n]<e.min&&(e.min=i.localMin[n]),i.localMax[n]>e.max&&(e.max=i.localMax[n]);return e}(a.group);e.groupMin=s.min,e.groupMax=s.max}}e.localMin=i.localMin[t],e.localMax=i.localMax[t],e.frameIndex=t,e.userMin=i.userMin,e.userMax=i.userMax}return e},updateLegend:function(t){var e=this.getLegend();if(e&&t&&t.globalStart>=0&&t.globalStart<e.localMin.length&&t.globalEnd<e.localMin.length){e.min=e.localMin[t.globalStart],e.max=e.localMax[t.globalStart];for(var i=t.globalStart+1;i<=t.globalEnd;i++)e.localMin[i]<e.min&&(e.min=e.localMin[i]),e.localMax[i]>e.max&&(e.max=e.localMax[i])}},hasNoGlobalData:function(){if(void 0===this._noGlobalData){var t=this.getLegend();t&&(this._noGlobalData=t.hasNoGlobalFlag())}return this._noGlobalData},isAnimated:function(){var t=!1,e=this.getAnimationStructure();return e&&(t=e.totalFrameNumber>1),t},isAnimationInitialized:function(){return this.animationInitialized},setAnimationAsInitialized:function(){this.animationInitialized=!0},getTotalNumberOfFrames:function(){var t,e=this.getAnimationStructure();return e&&(t=e.totalFrameNumber),t},getAnimationStructure:function(){if(!this.animationStructure){var t=this.getLegend();t&&(this.animationStructure=t.animationStructure)}return this.animationStructure},getIsolatedFrames:function(){var t=[],e=this.getAnimationStructure();if(e&&e.groupList)for(var i=0;i<e.groupList.length;i++){var a=e.groupList[i];a&&a.frameList&&1===a.frameList.length&&void 0!==a.frameList[0].globalIndex&&t.push(a.frameList[0].globalIndex)}return t},getGroupForFrame:function(t){var e={},i=this.getAnimationStructure();if(!isNaN(t)&&i&&i.groupList)for(var a=0;a<i.groupList.length;a++){var s=i.groupList[a];if(s&&s.frameList)for(var n=0;n<s.frameList.length;n++){var r=s.frameList[n];if(r&&r.globalIndex===t+1)return e.group=s,e.frame=r,e}}return e},setPartialAnimationMode:function(t){"boolean"==typeof t&&(this._partialAnimMode=t,i.publish({event:this.spm.ctx+"/SPY/ANIMSCOPECHANGE"}))},isPartialAnimationMode:function(){return this._partialAnimMode},getDefaultAnimationScope:function(t){var e={groupIDs:[],groupIDsNoMode:[],frames:[],hasModes:!1},i=this.getAnimationStructure(),a=this.getGroupForFrame(t);if(i){var s;for(e.globalStart=0,e.globalEnd=i.totalFrameNumber-1,e.localPosition=a.frame?a.frame.globalIndex:void 0,s=0;s<i.groupList.length;s++)e.groupIDs.push(i.groupList[s].id),e.groupIDsNoMode.push(i.groupList[s].idNoMode),e.frames=e.frames.concat(i.groupList[s].frameList),e.hasModes=e.hasModes?e.hasModes:i.groupList[s].isMode;if(e.length=e.frames.length,i.computedFramesOnlyForDefault){for(e.frames=[],s=0;s<i.groupList.length;s++)e.frames=e.frames.concat(i.groupList[s].computedFrameList);e.globalStart=e.frames[0].globalIndex-1,e.globalEnd=e.frames[e.frames.length-1].globalIndex-1,e.length=e.frames.length,e.localPosition=e.frames.length;for(var n=0;n<e.frames.length;n++){var r=e.frames[n];r&&r.globalIndex===t&&(e.localPosition=n)}}this._computeScopeMinMax(e)}return e},getAnimationScope:function(t){var e={groupIDs:[],groupIDsNoMode:[],frames:[],hasModes:!1},i=this.getAnimationStructure(),a=this.getGroupForFrame(t);if(i&&a&&a.group){if(i.groupList.length>1)e.canBePartial=!0,e.globalStart=a.group.globalStart,e.globalEnd=a.group.globalEnd,e.localPosition=a.frame.localIndex,e.groupIDs.push(a.group.id),e.groupIDsNoMode.push(a.group.idNoMode),e.frames=e.frames.concat(a.group.frameList),e.hasModes=a.group.isMode;else{e.globalStart=0,e.globalEnd=i.totalFrameNumber-1,e.localPosition=a.frame.globalIndex;for(var s=0;s<i.groupList.length;s++)e.groupIDs.push(i.groupList[s].id),e.groupIDsNoMode.push(i.groupList[s].idNoMode),e.frames=e.frames.concat(i.groupList[s].frameList),e.hasModes=e.hasModes?e.hasModes:i.groupList[s].isMode}e.length=e.frames.length,this._computeScopeMinMax(e)}return e.length<=1&&(e.canBePartial=!1),e},getClosestComputedFrameInGroup:function(t){var e,i=this.getGroupForFrame(t);if(i&&i.group&&i.frame){for(var a=i.group,s=i.frame,n=!1;!n&&s.localIndex>=1&&s.localIndex<=a.frameList.length;)if(!(n=!s.isScaledPosition)){var r=s.localIndex;s=r>=0?a.frameList[r]:a.frameList[a.frameList.length-1]}n&&(e=s.globalIndex)}return e},getComputedFramesByGroup:function(){var t,e=this.getAnimationStructure();if(e&&e.groupList.length>0){t=new Map;var i=e.groupList[0],a=i.idNoMode,s=i.computedFrameList;t.set(i.idNoMode,s);for(var n=1;n<e.groupList.length;n++)s=(i=e.groupList[n]).idNoMode===a?s.concat(i.computedFrameList):i.computedFrameList,t.set(i.idNoMode,s),a=i.idNoMode}return t},getFrameGlobalIdxFromPosition:function(t,e){var i,a=this.getLegend();return a&&(i=a.getFrameGlobalIdxFromPosition(t,e)),i},getRetexturingMode:function(t,e){var i="NEUTRAL",a=this.getIsolatedFrames();if((a=void 0===a?[]:a).indexOf(t+1)>-1||this.hasNoGlobalData()&&!this.animationStructure.computedFramesOnlyForDefault)i=e?"REDUCE":"NEUTRAL";else if(this.noFramePosition)i=e?"NEUTRAL":"EXTEND";else{var s=this.getGroupForFrame(t);s&&s.group&&(i=s.group.scaledAnimation&&s.frame.isScaledPosition?e?"NEUTRAL":2===s.group.scalingType?"NEUTRAL":"EXTEND":e?"REDUCE":"NEUTRAL")}return i},isLarge:function(){return this.list3DViews.length>100},resetLoadingStatus:function(){for(var t=this.list2DViews.concat(this.list3DViews),e=0;e<t.length;e++){var i=t[e];i&&i.resetLoadingStatus&&i.resetLoadingStatus()}},getCameraRoot:function(){},getMultiInstanciatedFiles:function(){},getRenderingMaterials:function(){var t=[];this.getNavData3DViewList(!0).forEach(function(e){e&&e.getRenderingMaterial&&t.push(e.getRenderingMaterial())});var e=this._getSortedDuplicates(t);return new Set(e)},removeCharts:function(){Array.isArray(this.listFrameViews)&&this.listFrameViews.forEach(function(t){t.removeCharts()}),this._nbCharts=0},registerImage:function(t){t&&this._listInfoImages.push(t)},getNumberOfCharts:function(){if(isNaN(this._nbCharts)){this._nbCharts=0;var t=this.getNavDataFrameViewList();Array.isArray(t)&&t.forEach(function(t){this._nbCharts+=t.getNbCharts()}.bind(this))}return this._nbCharts},getNumberOfImages:function(){return this._listInfoImages.length},containsImages:function(){return this._listInfoImages.length>0},getInfoImages:function(){return this._listInfoImages},startAnalyticsTimeUpdate:function(t){var e=Date.now();isNaN(this.analytics[t])&&(this.analytics[t]=0),this._analyticsTimeStarts[t]=e},stopAnalyticsTimeUpdate:function(t,e){if(this._analyticsTimeStarts[t]){var i=Date.now()-this._analyticsTimeStarts[t];e?this.analytics[t]+=i:this.analytics[t]=i}},integrateCGRExtractionTime:function(t){this.analytics&&!isNaN(t)&&(isNaN(this.analytics.visuCreationTime)||(this.analytics.visuCreationTime-=t),isNaN(this.analytics.extractionTime)||(this.analytics.extractionTime+=t))}});return t.namespace("DS/SPY/CATSimNavDataDisplayAbstract",n)}),define("DS/SPY/CATSimNavDataHelper",["i18n!DS/SPY/assets/nls/CATSimNavDataHelper","UWA/Core","UWA/Class"],function(t,e,i){"use strict";var a=t.get("mode");a=a||"Mode[NONLS]";var s=i.singleton({init:function(){},parseGroupIds:function(t){var e=[];return t&&(e=t.split("?|?")),e},isModeSeparator:function(t){return"_Mode"===t},buildGroupIdNoMode:function(t,e){return e&&!this.isModeSeparator(e)?t+"?|?"+e:t},buildGroupName:function(t){var e="";if(t&&t.length>0){e=t[0];for(var i=1;i<t.length;i++)if(t[i]){var s=t[i];this.isModeSeparator(s)&&(s=a),e+=" - "+s}}return e},buildGroupNameFromIds:function(t){return this.buildGroupName(this.parseGroupIds(t))}});return e.namespace("DS/SPY/CATSimNavDataHelper",s)}),define("DS/SPY/CATSimNavDataChartAxis",["UWA/Core","UWA/Class"],function(t,e){"use strict";var i=e.extend({init:function(t,e){this._dimension=1,this._position="bottom",this._scale="linear",this._fixedBounds=!1,this.readFromXML(t,e)},setId:function(t){isNaN(t)||(this._identifier="_axis_"+t.toString())},getId:function(){return this._identifier},getIdNoPrefix:function(){return parseInt(this._identifier.slice("_axis_".length))},setName:function(t){this._name=t},getName:function(){return this._name},setDimension:function(t){this._dimension=t,2===this._dimension&&"bottom"===this._position&&(this._position="left")},getDimension:function(){return this._dimension},getPosition:function(){return this._position},getScale:function(){return this._scale},setUnit:function(t){this._unit=t},getUnit:function(){return this._unit},hasFixedBounds:function(){return this._fixedBounds},getFixedBounds:function(){return{min:this._fixedMin,max:this._fixedMax}},getColor:function(){return this._color},getTickNb:function(){return this._tickNb},getValueOfInterest:function(){return this._voi},getPrecision:function(){return this._precision},getExponent:function(){return this._exp},readFromXML:function(t,e){if(t){this._name=t.getAttribute("name");var i=parseInt(t.getAttribute("id"));isNaN(i)||(this._identifier="_axis_"+i.toString()),"2"===t.getAttribute("dimension")&&(this._dimension=2,this._position="left");var a=t.getAttribute("position");a&&(1===this._dimension?this._position="top"===a?a:this._position:this._position="right"===a?a:this._position);var s=t.getAttribute("scale");"log"!==s&&"percentage"!==s||(this._scale=s);var n=t.getAttribute("unit");this._unit=n||"";var r=parseFloat(t.getAttribute("fixedMin")),o=parseFloat(t.getAttribute("fixedMax"));isNaN(r)||(this._fixedBounds=!0,this._fixedMin="log"===s?Math.pow(10,r):r),isNaN(o)||(this._fixedBounds=!0,this._fixedMax="log"===s?Math.pow(10,o):o);var u=t.getAttribute("color");u&&(this._color=u);var h=parseInt(t.getAttribute("tickNb"));isNaN(h)||(this._tickNb=h);var l=parseInt(t.getAttribute("precision"));isNaN(l)||(this._precision=l);var d=parseInt(t.getAttribute("exp"));isNaN(d)||(this._exp=d);var c=parseFloat(t.getAttribute("interest"));isNaN(c)||(this._voi=c)}e&&e()}});return t.namespace("DS/SPY/CATSimNavDataChartAxis",i)}),define("DS/SPY/CATSimNavDataSpec",["UWA/Core","UWA/Class","i18n!DS/SPY/assets/nls/CATSimNavTypes"],function(t,e,i){"use strict";var a={},s=e.extend({init:function(t,e){this.dd=e,this.name=t?t.getAttribute("name"):void 0,this.id=t?t.getAttribute("id"):void 0,this.type=this.type?this.type:t?t.getAttribute("type"):void 0,this.subType=t?t.getAttribute("subType"):void 0,this.supportedModes=t?t.getAttribute("supportedModes"):void 0,this.unit=t?t.getAttribute("unit"):void 0,this.defaultMode="ENG",this.visibility=!t||"0"!==t.getAttribute("DefVis"),this.isExtractable=!1,this.suffix=i.get(this.type),this.active=!this.supportedModes||-1!==this.supportedModes.indexOf(this.defaultMode),this.sibling=void 0,this.siblingSearched=!1,this.listLinks=[]},_createExtension:function(t,e,i){if(this.impl){if(!this.impl[t].obj)for(var a in this.impl[t].obj=new e(this),this.impl[t].obj.implementation=this,this.impl)this.impl[a]&&this.impl[a].ext===this.impl[t].ext&&(this.impl[a].obj=this.impl[t].obj);i&&i(this.impl[t].obj)}else i()},QI:function(t,e){if(this.impl[t])if(this.impl[t].obj)this.impl[t].obj.implementation=this,e(this.impl[t].obj);else{var i="DS/"+(this.impl[t].module?this.impl[t].module:"SPY")+"/"+this.impl[t].ext,s=a[i];s?"loaded"===s.status?this._createExtension(t,s.typeClass,e):"requested"===s.status&&s.queue.push(function(i){this._createExtension(t,i,e)}.bind(this)):(a[i]={status:"requested",queue:[]},require([i],function(s){a[i].status="loaded",a[i].typeClass=s,this._createExtension(t,s,e);for(var n=a[i];n.queue&&n.queue.length>0;)n.queue[0]&&(n.queue[0](s),n.queue.shift())}.bind(this)))}else e()},getDataDisplay:function(){return this.dd},getName:function(){return this.name},getId:function(){return this.id?this.id:this.name},getSuffix:function(){return this.suffix},getType:function(){return this.type},getSupportedMode:function(){return this.mode},getSibling:function(){var t=this.supportedModes;if(("ENG"===t||"REA"===t)&&void 0===this.sibling&&!this.siblingSearched&&this.dd&&this.name.length>0){this.siblingSearched=!0;var e,i,a=!1;if("CATSimNavData2DView"===this.type||"CATSimNav2DAnimationView"===this.type)for(i=0;this.dd.list2DViews&&i<this.dd.list2DViews.length&&!a;i++)(e=this.dd.list2DViews[i])&&e.name===this.name&&e!==this&&e.supportedModes!==t&&(this.sibling=e,a=!0);else if("CATSimNavData3DView"===this.type||"CATSimNavData3DAnimationView"===this.type)for(i=0;this.dd.list3DViews&&i<this.dd.list3DViews.length&&!a;i++)(e=this.dd.list3DViews[i])&&e.name===this.name&&e!==this&&e.supportedModes!==t&&(this.sibling=e,a=!0)}return this.sibling},isActive:function(){return this.active},setActive:function(t){this.active=t},getVisibility:function(){return this.visibility},getUnit:function(){return this.unit},getLinks:function(t){return this.listLinks[t]},addLink:function(t,e){var i=this.listLinks[t];void 0===i?this.listLinks[t]=e:i.appendSpec(e)},readFromXML:function(){}});return t.namespace("DS/SPY/CATSimNavDataSpec",s)}),define("DS/SPY/CATSimNavDataLink",[],function(){"use strict";return function(t,e,i){this.dd=e,this._resourcePath="",this.nextSpec=null,this.getNextSpec=function(){return this.nextSpec},this.appendSpec=function(t){null===this.nextSpec?this.nextSpec=t:this.nextSpec.appendSpec(t)},this.getPointedResource=function(){return this._resourcePath},this.setPointedResource=function(t){this._resourcePath=t},this.getPointedData=function(){if(this._pointedDataId&&!this._pointedData)for(var t=0;this.dd.list3DViews&&t<this.dd.list3DViews.length;t++)this.dd.list3DViews[t].getId()===this._pointedDataId&&(this._pointedData=this.dd.list3DViews[t]);return this._pointedData},this.setPointedData=function(t){this._pointedDataId=t,this._pointedData=null},this.getMatrix=function(){return this._matrix},this.readFromXML=function(t,e){if(t){var i,a=t.getAttribute("id"),s=t.getAttribute("name");this.setPointedData(a||s);var n=parseInt(t.getAttribute("srcId"));if(isNaN(n))i=t.getAttribute("src");else i=this.dd.spm.getDataList("src",this.dd.seq).getEntry(n-1).val;this.setPointedResource(i),e&&e(this)}},this.readFromXML(t,i)}}),define("DS/SPY/CATSimNavDataAbstractFactory",["UWA/Core","UWA/Class"],function(t,e){"use strict";var i=e.extend({init:function(){},createSequence:function(){console.error("CATSimNavDataAbstractFactory - abstract createSequence should not be called")},isExtendedMode:function(){return void 0!==this._extensionFilter}});return t.namespace("DS/SPY/CATSimNavDataAbstractFactory",i)}),define("DS/SPY/CATSimNavDataXYValue",function(){"use strict";var t=function(t,e,i){this.index=-1,t&&this.readFromXML(t,e,i)};return t.prototype.getX=function(){return this.X},t.prototype.setX=function(t){this.X=t},t.prototype.getY=function(){return this.Y},t.prototype.setY=function(t){this.Y=t},t.prototype.setIndex=function(t){this.index=t},t.prototype.getIndex=function(){return this.index},t.prototype.getGroupId=function(){return this.groupId},t.prototype.setGroupId=function(t){this.groupId=t},t.prototype.getGroupIdNLS=function(){return this.groupIdNLS},t.prototype.setGroupIdNLS=function(t){this.groupIdNLS=t},t.prototype.getPosition=function(){return this.position},t.prototype.setPosition=function(t){this.position=t},t.prototype.readFromXML=function(t,e,i){var a,s=t.getAttribute("X");s&&s.length>0&&(a=Number(s)),this.setX(a),this.setY(Number(t.getAttribute("Y")));var n=i&&i.group?i.group:t.getAttribute("group");this.setGroupId(n);var r,o=i&&i.groupNLS?i.groupNLS:n;if(this.setGroupIdNLS(o),i&&!isNaN(i.position))r=i.position;else{var u=t.getAttribute("position");u&&u.length>0&&(r=Number(u))}this.setPosition(r),e(this)},t}),define("DS/SPY/CATSimNavData3DAnimationExtremaProvider",["UWA/Core"],function(t){"use strict";var e=t.Class.extend({init:function(){this._parent()},getImpl:function(){return this.implementation},getExtrema:function(t){var e={listMin:[],listMax:[]};if(this.implementation){for(var i,a=this.implementation.dd.getNavData3DViewList("plotContentOnly"),s=0;s<a.length&&!i;s++)"CATSimNavData3DExtremasRoot"===a[s].getType()&&(i=a[s]);if(i){for(var n,r=i.getListExtremasSet(),o=0;o<r.length&&!n;o++){var u=r[o];if(u){var h=u.getLinks("ExtremasToPart");if(h){var l=h.getPointedData();l&&l.getId()===this.implementation.getId()&&(n=u)}}}if(n){var d=n.getExtremas(t);if(d){var c=d.getListExtrema();if(c)for(var m=0;m<c.length;m++){var p=c[m];p&&(p.setComponent(this.implementation),"Min"===p.getExtremaType()?e.listMin.push(p):e.listMax.push(p))}}}}}return e}});return t.namespace("DS/SPY/CATSimNavData3DAnimationExtremaProvider",e)}),define("DS/SPY/SpaceURL",["UWA/Core","UWA/Class"],function(t,e){"use strict";var i=e.extend({init:function(t){this._platformServices=t},getUrl:function(t){t&&t.asset&&t.onComplete&&this._platformServices&&this._platformServices.getPlatformServices({onComplete:function(e){var i,a=e.find(function(e){return e.platformId===t.asset.tenant});a&&(i=a["3DDashboard"]+"/#app:X3DPLAW_AP/content:X3DContentId=",i+=encodeURIComponent(JSON.stringify(t.asset.Play3DXContent)),t.onComplete(i))}})}});return t.namespace("DS/SPY/SpaceURL",i)}),define("DS/SPY/CATSimNavDataList",["UWA/Core","UWA/Class"],function(t,e){"use strict";var i=e.extend({init:function(t){if(t&&"List"===t.nodeName){this._name=t.getAttribute("name"),this._entries=[];for(var e=t.children,i=0;i<e.length;i++){for(var a={},s=e[i].getAttributeNames(),n=0;n<s.length;n++)a[s[n]]=e[i].getAttribute(s[n]);this._entries.push(a)}}},getName:function(){return this._name},getEntry:function(t){return this._entries[t]}});return t.namespace("DS/SPY/CATSimNavDataList",i)}),define("DS/SPY/CATSimNavData2DLegend",["UWA/Core","DS/SPY/CATSimNavDataSpec","DS/CoreEvents/Events","DS/SPY/CATSimNavDataHelper"],function(t,e,i,a){"use strict";var s=e.extend({_parseDataFrame:function(t){this.title=t.getAttribute("title"),this.scaleFactor=parseFloat(t.getAttribute("scaleFactor")),this.inverseState=t.getAttribute("inverseState"),this.min=parseFloat(t.getAttribute("max")),this.max=parseFloat(t.getAttribute("min")),0===this.min&&0===this.max&&(this.noGlobalFlag=!0);var e=parseFloat(t.getAttribute("userMin"));isNaN(e)||(this.userMin=e);var i=parseFloat(t.getAttribute("userMax"));isNaN(i)||(this.userMax=i),this.rangeReadOnly=t.getAttribute("rangeReadOnly"),this.unit=t.getAttribute("unit")},_parseFrameSet:function(t){for(var e=0,i=t.firstChild;null!=i;){if(1===i.nodeType){var a=parseFloat(i.getAttribute("localMin"));isNaN(a)||(this.localMin.push(a),a<=this.min&&(this.min=a));var s=parseFloat(i.getAttribute("localMax"));isNaN(s)||(this.localMax.push(s),s>=this.max&&(this.max=s));var n=-1,r=parseFloat(i.getAttribute("scaleFactor"));isNaN(r)?isNaN(this.scaleFactor)||(n=this.scaleFactor):n=r,this.deformationScales.push(n);var o,u,h,l,d=void 0;if("Frame"===i.nodeName){var c=i.getAttribute("frmId");if(null!==c){var m=this.dd.spm.getFrameDetails(this.dd.seq,c,e);d=m.position,u=m.scaled,h=m.group,l=m.unit}}else h=i.getAttribute("group"),(o=i.getAttribute("position"))&&o.length>0&&(d=Number(o)),u=i.getAttribute("scaled"),l=i.getAttribute("unit"),this.dd.spm.setFrameDetails(this.dd.seq,e,null!==u||void 0!==u,h,d,l);!isNaN(d)&&this.animationStructure.noFramePosition&&(this.animationStructure.noFramePosition=!1);var p,f=null!=u&&""!==u&&"0"!==u;f&&2===(p=parseInt(u))&&(this.hasScanAnimation=!0),this.animRawData.push({id:h,position:d,positionUnit:l,isScaledPosition:f,scalingType:p}),e++}i=i.nextSibling}},init:function(t,e,i,a){this._parent(t,e),this.localMin=[],this.localMax=[],this.deformationScales=[],this.animRawData=[],this.NoResults=e&&"NoResults"===e.plotType,this.impl={CATISimNavDataSpecUI:{module:"SPYUI",ext:"CATSimNavData2DLegendUI",type:"data",obj:null},CATISimNavDataAnimation:{module:"SPYUI",ext:"CATSimNavData2DLegendUI",type:"data",obj:null}},this._posDetailsMaps=[],this.readFromXML(t,a)},hasMinMax:function(){var t=Array.isArray(this.localMax)&&this.localMax.length>0;return Array.isArray(this.localMin)&&this.localMin.length>0&&t&&!this.NoResults},getPNGList:function(){return this.palette?[this.palette]:[]},readFromXML:function(t,e){this.animationStructure={noFramePosition:!0};for(var i=0;i<t.children.length;i++){var s=t.children[i];switch(s.nodeName){case"DataFrame":this._parseDataFrame(s);break;case"PaletteFrame":this.palette=s.getAttribute("src");break;case"DiscreteValues":this.labels=a.parseGroupIds(s.getAttribute("labels")),this.colors=a.parseGroupIds(s.getAttribute("colors"));break;case"FrameSet":this._parseFrameSet(s)}}!function(t){if(t)for(var e=0;e<t.length;e++){var i=t[e],s=e+1<t.length?t[e+1]:void 0;i.displayName="";var n=a.parseGroupIds(i.id);n.length>0&&(i.rootName=n[0],i.displayName+=i.rootName,n.length>1&&(i.isComplex=!0));for(var r=1;r<n.length;r++){if(a.isModeSeparator(n[r])){var o=r+1<n.length?parseInt(n[r+1]):void 0;i.modeIndex=o,i.isMode=!isNaN(o)&&o>=0;for(var u="Mode "+(void 0!==o?o.toString():"index missing"),h=i.isScaledPosition?s:i,l=1;h&&h.isScaledPosition;)h=e+l<t.length?t[e+l]:void 0,l++;h&&(u=h.position+(h.positionUnit?" "+h.positionUnit:"")),i.displayName+=" - "+u;break}isNaN(parseInt(n[r]))&&(i.loadName=n[r],i.displayName+=" - "+n[r])}}}(this.animRawData),this.animationStructure.groupList=[];for(var n,r,o,u,h,l,d,c=0,m=0,p=0,f=!1,g=!1,v=0,S=0,D=0,N=0,C=0,A=0;A<this.animRawData.length;A++){var x=this.animRawData[A];if(x.id!==n&&(c=0,n=x.id,r=x.displayName,o=x.rootName,u=x.positionUnit,f=x.isComplex,h=x.loadName,l=(g=x.isMode)?x.modeIndex:void 0,v=0,S=0,D=0,d={index:p,id:n,idNoMode:a.buildGroupIdNoMode(o,h),name:r,rootName:o,frameList:[],computedFrameList:[],scaledAnimation:!1,scalingFactor:v,globalStart:m,globalEnd:m,unit:u,isComplex:f,loadCaseName:h,isMode:g,modeIndex:l},this.animationStructure.groupList.push(d),p++),d){c++,m++;var b="",L=x.position,y=x.positionUnit;isNaN(L)?x.isScaledPosition&&(b="scaled",d.scaledAnimation=!0,d.scalingType=x.scalingType,D++):(b=L.toString()+(y?" "+y:""),S++,C++),this.animationStructure.noFramePosition&&(b="frame "+c);var T={name:b,globalIndex:m,localIndex:c,isScaledPosition:x.isScaledPosition,position:L};if(d.frameList.push(T),x.isScaledPosition||d.computedFrameList.push(T),d.globalEnd=m-1,d.scalingFactor=S>0?(S+D)/S:0,d.numberComputedFrames=S,d.scaledAnimation&&d.isMode&&N++,!isNaN(L)){var _=this._posDetailsMaps[d.idNoMode];_||(this._posDetailsMaps[d.idNoMode]=new Map,_=this._posDetailsMaps[d.idNoMode]),_.set(L,A)}}}this.animationStructure.totalFrameNumber=m,N>1&&(this.animationStructure.computedFramesOnlyForDefault=!0,this.animationStructure.totalComputedFramesNumber=C),e()},hasNoGlobalFlag:function(){return this.noGlobalFlag},rangeIsReadOnly:function(){return null!==this.rangeReadOnly&&void 0!==this.rangeReadOnly},setUserMin:function(t,e,a){if(a=void 0===a||a,void 0!==t&&isNaN(t))return"E_INVALIDARG";if(t!==this.userMin&&!this._inEdition){var s=!isNaN(e)&&e>=0&&e<this.localMax.length;this._inEdition=!0,void 0===t?this.userMin=void 0:isNaN(this.userMax)?this.userMin=s?t<=this.localMax[e]?t:this.localMax[e]:t<=this.max?t:this.max:t>this.userMax?this.userMin=this.userMax:this.userMin=t,i.publish({event:this.getDataDisplay().getSPM().getContext()+"/SPY/LEGEND/EDIT/USERMIN",data:{value:this.userMin,computed:s?this.localMin[e]:void 0,unit:this.unit,syncFlag:a}}),this._inEdition=!1}return this.userMin},getUserMin:function(){return this.userMin},setUserMax:function(t,e,a){if(a=void 0===a||a,void 0!==t&&isNaN(t))return"E_INVALIDARG";if(t!==this.userMax&&!this._inEdition){var s=!isNaN(e)&&e>=0&&e<this.localMin.length;this._inEdition=!0,void 0===t?this.userMax=void 0:isNaN(this.userMin)?this.userMax=s?t>=this.localMin[e]?t:this.localMin[e]:t>=this.min?t:this.min:t<this.userMin?this.userMax=this.userMin:this.userMax=t,i.publish({event:this.getDataDisplay().getSPM().getContext()+"/SPY/LEGEND/EDIT/USERMAX",data:{value:this.userMax,computed:s?this.localMax[e]:void 0,unit:this.unit,syncFlag:a}}),this._inEdition=!1}return this.userMax},getUserMax:function(){return this.userMax},getComputedMin:function(t){var e=this.min;return isNaN(t)||(e=t>=0&&t<this.localMin.length?this.localMin[t]:void 0),e},getComputedMax:function(t){var e=this.max;return isNaN(t)||(e=t>=0&&t<this.localMax.length?this.localMax[t]:void 0),e},getMinMaxData:function(t){return{unit:this.unit,userMin:this.getUserMin(),userMax:this.getUserMax(),computedMin:this.getComputedMin(t),computedMax:this.getComputedMax(t)}},integrateMinMaxData:function(t,e){var a,s,n=!isNaN(e)&&e>=0&&e<this.localMin.length?this.localMin[e]:this.min,r=!isNaN(e)&&e>=0&&e<this.localMax.length?this.localMax[e]:this.max,o=isNaN(this.userMin)?n:this.userMin,u=isNaN(this.userMax)?r:this.userMax;t&&t.length>0&&t.forEach(function(t){if(t.unit===this.unit){var e=null===t.userMin||isNaN(t.userMin)?t.computedMin:t.userMin,i=null===t.usermax||isNaN(t.userMax)?t.computedMax:t.userMax;e<o&&(o=a=e),i>u&&(u=s=i)}}.bind(this)),(a=isNaN(a)?o:a)===this.userMin?i.publish({event:this.getDataDisplay().getSPM().getContext()+"/SPY/LEGEND/EDIT/USERMIN",data:{value:a,unit:this.unit,syncFlag:!0}}):this.setUserMin(a,e,!0),(s=isNaN(s)?u:s)===this.userMax?i.publish({event:this.getDataDisplay().getSPM().getContext()+"/SPY/LEGEND/EDIT/USERMAX",data:{value:s,unit:this.unit,syncFlag:!0}}):this.setUserMax(s,e,!0)},getFrameGlobalIdxFromPosition:function(t,e){if(null!=t){var i,a=t,s=t.indexOf("?|?_Mode?|?");-1!==s&&(a=t.slice(0,s));var n=this._posDetailsMaps[a];return n&&(i=n.get(e)),i}}});return t.namespace("DS/SPY/CATSimNavData2DLegend",s)}),define("DS/SPY/CATSimNavData2DRepStaticView",["DS/SPY/CATSimNavDataSpec","DS/SPY/CATSimNavDataLink"],function(t,e){"use strict";var i=t.extend({init:function(t,e,i,a){this._parent(t,e),this.impl={CATISimNavDataSpecUI:{module:"SPYUI",ext:"CATSimNavData2DRepStaticViewUI",type:"data",obj:null}},this.readFromXML(t,a)},getPNGList:function(){return this.getLinks("SP_StaticList")},readFromXML:function(t,i){for(var a=0,s=!1,n=function(t){t&&(this.addLink("SP_StaticList",t),0===--a&&s&&i&&i())}.bind(this),r=0;r<t.children.length;r++){var o=t.children[r];if("1"===o.getAttribute("level"))for(var u=0;u<o.children.length;u++){var h=o.children[u];if(h)for(var l=0;l<h.children.length;l++){var d=h.children[l];a++;new e(d,this.dd,n)}}}s=!0,0===a&&i()}});return UWA.namespace("DS/SPY/CATSimNavData2DRepStaticView",i)}),define("DS/SPY/CATSimNavData2DAnimationView",["DS/SPY/CATSimNavDataSpec","DS/SPY/CATSimNavDataLink"],function(t,e){"use strict";var i=t.extend({init:function(t,e,i,a){this._parent(t,e),this.impl={CATISimNavDataSpecUI:{module:"SPYUI",ext:"CATSimNavData2DAnimationViewUI",type:"data",obj:null},CATISimNavDataAnimation:{module:"SPYUI",ext:"CATSimNavData2DAnimationViewUI",type:"data",obj:null}},this.readFromXML(t,a)},getPNGList:function(){return this.getLinks("SP_StaticList")},readFromXML:function(t,i){for(var a=0,s=!1,n=function(t){t&&(this.addLink("SP_StaticList",t),0===--a&&s&&i&&i())}.bind(this),r=0;r<t.children.length;r++){var o=t.children[r];if("1"===o.getAttribute("level"))for(var u=0;u<o.children.length;u++){var h=o.children[u];if(h)for(var l=0;l<h.children.length;l++){var d=h.children[l];a++;new e(d,this.dd,n)}}}s=!0,0===a&&i()}});return UWA.namespace("DS/SPY/CATSimNavData2DAnimationView",i)}),define("DS/SPY/CATSimNavDataFrameViewComp",["DS/SPY/CATSimNavDataSpec"],function(t){"use strict";var e=t.extend({init:function(t,e){this._parent(t,e),this._layoutPrefs={}},getValues:function(){alert("error: call to getValues on CATSimNavDataFrameViewComp")},readFromXML:function(t,e){alert("error: call to readFromXML on CATSimNavDataFrameViewComp")},isComplex:function(){return!1},getLayoutPreferences:function(){return this._layoutPrefs},setExpandPreference:function(t){this._layoutPrefs.expanded=t},setExtractPreference:function(t){this._layoutPrefs.extracted=t},getNbCharts:function(){return isNaN(this._nbCharts)&&this.computeNbCharts(),this._nbCharts},computeNbCharts:function(){this._nbCharts=0}});return UWA.namespace("DS/SPY/CATSimNavDataFrameViewComp",e)}),define("DS/SPY/CATSimNavDataFrameView",["DS/SPY/CATSimNavDataFrameViewComp","DS/SPY/CATSimNavDataLink"],function(t,e){"use strict";var i=Node.ELEMENT_NODE,a=t.extend({init:function(t,e,i,a){this._parent(t,e),this.tempChildren=[],this.children=[],this.impl={CATISimNavDataSpecUI:{module:"SPYUI",ext:"CATSimNavDataFrameViewUI",type:"data",obj:null},CATISimNavDataAnimation:{module:"SPYUI",ext:"CATSimNavDataFrameViewUI",type:"data",obj:null},CATISimNavDataColorShading:{module:"SPYUI",ext:"CATSimNavDataFrameViewColorShading",type:"data",obj:null}},this.readFromXML(t,i,function(){this.computeNbCharts(),a&&a(this)}.bind(this))},getChildren:function(){return this.children},computeNbCharts:function(){for(var t in this._nbCharts=0,this.children)this._nbCharts+=this.children[t].getNbCharts()},readFromXML:function(t,a,s){if(t){for(var n=null,r=function(){for(var e=0,i=!1,n=function(t){return function(n){new n(t,this.dd,a,function(a){this.tempChildren[t._spyRank]=a,0===--e&&i&&s&&(this.tempChildren.forEach(function(t){t&&this.children.push(t)}.bind(this)),this.tempChildren=[],s(this))}.bind(this))}.bind(this)}.bind(this),r=!0,o=0,u=0;o<t.children.length;o++){var h=t.children[o],l=null,d=null;switch(h.nodeName){case"DDXYPlot":case"DDXYChart":d="CATSimNavDataFrameViewXYChart",r=!1;break;case"DDScalar":d="CATSimNavDataFrameViewCompValue";break;case"DDText":d="CATSimNavDataFrameViewText";break;case"DDImage":d="CATSimNavDataFrameViewImage";break;case"DDElementFrame":d="CATSimNavDataFrameView",r=!1}d&&(void 0===a||void 0===a.excludedTypes||a.excludedTypes.indexOf(d)<0)&&(l="DS/SPY/"+d,h._spyRank=u++,this._isComplex=!r,e++,require([l],n(h)))}i=!0,0===e&&s(this)}.bind(this),o=0;o<t.childNodes.length;o++){var u=t.childNodes[o];if(u.nodeType===i&&"LinkSet"===u.nodeName&&"Frameto3D"===u.getAttribute("role"))for(var h=0;h<u.childNodes.length&&null===n;h++){var l=u.childNodes[h];l&&l.nodeType===i&&"InternalRef"===l.nodeName&&(n=l)}}if(n)new e(n,this.dd,function(t){this.addLink("Frameto3D",t),r()}.bind(this));else r()}},isComplex:function(){return this._isComplex},removeCharts:function(){Array.isArray(this.children)&&(this.children=this.children.filter(function(t){return"CATSimNavDataFrameViewXYChart"!==t.type}),this.children.forEach(function(t){t.removeCharts&&t.removeCharts()})),this._nbCharts=0}});return UWA.namespace("DS/SPY/CATSimNavDataFrameView",a)}),define("DS/SPY/CATSimNavDataFrameViewImage",["DS/SPY/CATSimNavDataFrameViewComp"],function(t){"use strict";var e=t.extend({init:function(t,e,i,a){e&&e.registerImage(t.getAttribute("src")),this.type="CATSimNavDataFrameViewImage",this._parent(t,e),this.impl={CATISimNavDataSpecUI:{module:"SPYUI",ext:"CATSimNavDataFrameViewImageUI",type:"data",obj:null}},this.isExtractable=!0,this.readFromXML(t,a)},getTitle:function(){return this.name},getTooltip:function(){return this._tooltip},getPNGList:function(){return[this._src]},readFromXML:function(t,e){t&&(this._tooltip=t.getAttribute("tooltip"),this._src=t.getAttribute("src"),e&&e(this))}});return UWA.namespace("DS/SPY/CATSimNavDataFrameViewImage",e)}),define("DS/SPY/CATSimNavData3DView",["UWA/Core","DS/SPY/CATSimNavDataSpec","DS/CoreEvents/Events"],function(t,e,i){"use strict";var a=e.extend({init:function(t,e){this._parent(t,e),this.transparency=t?t.getAttribute("transparency"):void 0,this.transparent=0<this.transparency,this.matRendering=t?t.getAttribute("matRendering"):void 0},getCGRList:function(){},getCGRs:function(){},getRenderingMaterial:function(){return this.matRendering},switchVisibility:function(t,e){this.visibility=!this.visibility;var a=this.impl.CATISimNavDataSpecUI.obj.node;a&&a.setVisibility(!a.isVisible()),t&&e&&i.publish({event:e+"/SPY/VISIBILITY/CHANGE",data:this});var s=this.getSibling();s&&(s.visibility=this.visibility)}});return t.namespace("DS/SPY/CATSimNavData3DView",a)}),define("DS/SPY/CATSimNavData3DRepStaticView",["UWA/Core","DS/SPY/CATSimNavData3DView","DS/SPY/CATSimNavDataLink"],function(t,e,i){"use strict";var a=e.extend({init:function(t,e,i,a){this._parent(t,e),this.impl={CATISimNavDataSpecUI:{module:"SPYUI",ext:"CATSimNavData3DRepStaticViewUI",type:"data",obj:null},CATISimNavDataColorShading:{module:"SPYUI",ext:"CATSimNavData3DStaticColorShading",type:"data",obj:null},CATISimNavDataExtremaProvider:{module:"SPY",ext:"CATSimNavData3DAnimationExtremaProvider",type:"data",obj:null}},this.readFromXML(t,a)},getCGRList:function(){return this.getLinks("SP_StaticList")},getCGRs:function(){for(var t=this.getCGRList(),e=[];t;)e.push(t.getPointedResource()),t=t.getNextSpec();return e},readFromXML:function(t,e){for(var a=0,s=!1,n=function(t){t&&(this.addLink("SP_StaticList",t),0===--a&&s&&e&&e())}.bind(this),r=0;r<t.children.length;r++){var o=t.children[r];if("1"===o.getAttribute("level"))for(var u=0;u<o.children.length;u++){var h=o.children[u];if(h)for(var l=0;l<h.children.length;l++){var d=h.children[l];a++;new i(d,this.dd,n)}}}s=!0,0===a&&e()}});return t.namespace("DS/SPY/CATSimNavData3DRepStaticView",a)}),define("SPY/SimulationPlayerModel",["DS/SPY/SimulationPlayerModel"],function(t){"use strict";return console.warn("This module is deprecated. use DS/SPY/SimulationPlayer instead of SPY/SimulationPlayer"),t}),define("DS/SPY/SimulationPlayerModel",["UWA/Core","DS/CoreEvents/Events","DS/WebSystem/Environment","DS/WebUtils/ProbesManager","DS/Visualization/Node3D","DS/Visualization/ModelLoader","DS/SPY/CATSimNavDataHelper"],function(t,e,i,a,s,n,r){"use strict";var o=!i.isSet("3DPlay.DisableProbes"),u=function(t){return isNaN(t)?"":"_frame"+String(t)},h=t.Class.extend({init:function(t){if(this.msrID=t&&t.msrID?t.msrID:void 0,this.simulationName=t&&t.simulationName?t.simulationName:"Simulation",this.scenarioName="Simulation case",this.window=t?t.window?t.window:t:void 0,this.ctx=t&&t.context?t.context:"ctxUndefined",this.sequences=[],this.level=2,this._dataLists=[],this._frmDetailsMaps=[],this._URLsToRevoke=[],this.filesToLoad=[],this.framesIndices=[],this.fatherNodes=[],this.loadingMap=new Map,this.transactionMap=new Map,this.fatherTransactionMap=new Map,this.noNodeTransactionCounter=0,this.progress={loaded:0,total:0},this.previousProgressPosition=0,this.window&&this.window.getViewer){var e=this.window.getViewer();e&&(this._modelLoader=new n({node:e.getRootNode(),viewer:e}),this._modelLoader.setOnLoadedCallback(this.onLoaderDoneCallback.bind(this)),this._modelLoader.setOnLoadedProductStructureCallback(this.onModelLoadedCallback.bind(this)))}this._analytics={}},clean:function(){this.clearLoadingQueue();for(var t=0;t<this.sequences.length;t++){var e=this.sequences[t];if(e){e.zip&&delete e.zip;var i=e.listDD;if(i)for(var a=0;a<i.length;a++)i[a].clean();delete e.listDD}}delete this.sequences,this._URLsToRevoke.forEach(function(t){URL.revokeObjectURL(t)}),this.logoUrl=void 0},getContext:function(){return this.ctx},addDataList:function(t,e){void 0===this._dataLists[e]&&(this._dataLists[e]={}),this._dataLists[e][t.getName()]=t},getDataList:function(t,e){var i;return e<this._dataLists.length&&e>=0&&this._dataLists[e]&&(i=this._dataLists[e][t]),i},getFrameDetails:function(t,e,i){var a,s=this._frmDetailsMaps[t];if(s?a=s.get(e):(this._frmDetailsMaps[t]=new Map,s=this._frmDetailsMaps[t]),!a){a={};var n=this.getDataList("frm",t),o=parseInt(e)-1,u=n.getEntry(o);u.pos&&u.pos.length>0&&(a.position=Number(u.pos)),a.scaled=u.scaled;var h=this.getDataList("grp",t).getEntry(parseInt(u.grpId)-1);a.group=h.val,a.groupNLS=r.buildGroupNameFromIds(h.val),a.unit=h.unit,s.set(e,a)}return a},setFrameDetails:function(t,e,i,a,s,n){var o=this._frmDetailsMaps[t];o||(this._frmDetailsMaps[t]=new Map,o=this._frmDetailsMaps[t]),o.set(e,{position:s,scaled:i,group:a,groupNLS:r.buildGroupNameFromIds(a),unit:n})},addSequence:function(t,e,i,a){require(["DS/SPY/CATSimNavDataLWFactory"],function(s){var n=new s,r={idx:0,name:"sequence",listDD:[],listDDShared:[],zip:e};r.idx=this.sequences.push(r)-1,n.parseXML(t,r,this,i,function(){this.sequences.pop(),a()}.bind(this))}.bind(this))},getNbSequences:function(){return this.sequences.length},getFirstValidSequenceIdx:function(){return this.sequences.findIndex(function(t){return t})},getMSRID:function(){return this.msrID},getSimulationAlias:function(){return this.simulationName},getSimulationTitle:function(){return this.window.experience._myAsset.displayname?this.window.experience._myAsset.displayname:this.getSimulationAlias()},getCurrentContentDescription:function(t){if(t&&t.onComplete){var e="",i=this.window.experience.mySPMUI;if(i){var a=i.getActiveSequence(),s=i.getActiveDD();if(s){var n=this.getSimulationAlias(),r=this.getSimulationTitle(),o=this.getSequenceName(a),u=s.name,h=this.getDisclaimer();require(["DS/WebSystem/Nls"],function(i){i.nls("SPY/Description",["CurrentTitle","AliasAtGeneration","CaseName","ContentName"],function(i){e+=i[0]+n+"\n",e+=i[1]+r+"\n",e+=i[2]+o+"\n",e+=i[3]+u+"\n",h&&(e+=h),t.onComplete(e)})})}}}},getDisclaimer:function(){return this.disclaimer},_getLogoZipEntry:function(){var t;this.logo&&this.logo.length>0&&(this.logoUrl||this.sequences.length>0&&!isNaN(this.sequences[0].idx)&&(t=this.getZipEntries(this.sequences[0].idx).find(this.logo)));return t},getLogoUrl:function(t){var e=this._getLogoZipEntry();return e&&e.getBlob("image/png").then(function(e){this.logoUrl=URL.createObjectURL(e),this._URLsToRevoke.push(this.logoUrl),t&&t(this.logoUrl)}.bind(this)),this.logoUrl},loadImage:function(t,e,i){if(!isNaN(t)&&e&&i){var a,s,n=this.getZipEntries(t);n&&e&&(s="image/png",a=n.find(e)),a&&a.getBlob(s).then(function(t){var e=URL.createObjectURL(t);this._URLsToRevoke.push(e),i(e)}.bind(this))}},isYaxisUp:function(){return this._isYaxisUp},_findDataDisplay:function(t,e){var i=-1;t>=0&&t<this.sequences.length&&(e.id&&(i=this.sequences[t].listDD.findIndex(function(t){return t.id===e.id})),i<0&&e.name&&this.sequences[t]&&(i=this.sequences[t].listDD.findIndex(function(t){return t.name===e.name})));return i},findSequenceByPersistentId:function(t){return this.sequences.findIndex(function(e){return e&&t&&e.persistentId===t})},findSequenceByName:function(t){return this.sequences.findIndex(function(e){return e&&t&&e.name===t})},findSimilarContent:function(t){var e={found:!1},i=t.sequenceName,a=t.persistentId,s=t.dataDisplayId,n=t.dataDisplayName,r=-1,o=-1;if(a&&(o=this.findSequenceByPersistentId(a)),o<0&&(o=this.findSequenceByName(i)),o<0&&1===this.sequences.length&&(o=0),o>=0)r=this._findDataDisplay(o,{id:s,name:n});else for(;r<0&&o<this.sequences.length;)o++,r=this._findDataDisplay(o,{id:s,name:n});return e.sequenceIndex=o,e.dataDisplayIndex=r,e.found=o>=0&&r>=0,e},getSequencePersistentId:function(t){return this.sequences.length>t?this.sequences[t].persistentId:"undefined"},getSequenceName:function(t){return this.sequences.length>t?this.sequences[t].name:"undefined"},updateSequenceAnalyticsFromContent:function(t){if(this.sequences.length>t){var e=this.sequences[t].analytics;if(e){isNaN(e.extractionTime)&&(e.extractionTime=0);var i=function(t){t.forEach(function(t){t&&t.analytics&&t.analytics.extractionTime>e.extractionTime&&(e.extractionTime=t.analytics.extractionTime)})};i(this.getDataDisplayList(t)),i(this.getSharedDataDisplayList(t))}}},getStreamAnalytics:function(t){var e={};if(Array.isArray(this.sequences)&&this.sequences.length>t){var i=this.sequences[t].analytics;i&&(e.dataSize=i.dataSize,e.streamingTime=i.streamingTime)}return e},addAnalytics:function(t){this._analytics&&t&&(this._analytics=Object.assign(this._analytics,t))},getAnalytics:function(){return this._analytics},setTypingInfo:function(t){this._typingInfo=Object.assign({},t)},getTypingInfo:function(){return this._typingInfo},extractTypingInfoForSequence:function(t,e){var i=this._typingInfo,a={assetType:this._analytics.assetType,providerType:this._analytics.providerType};if(i){var s=function(t){a.origin=t.origin,a.sequenceType=t.sequenceType,a.sequenceSubTypes=t.sequenceSubTypes},n=!1;if(t){var r=t.replace("SimNavData_","").replace("_","").replace("0","");for(var o in i){if("object"==typeof(u=i[o])&&u.resultSequenceId&&u.resultSequenceId.replace("0","")===r){s(u),n=!0;break}}}if(!n&&e)for(var o in i){var u;if("object"==typeof(u=i[o])&&u.name&&u.name===e){s(u),n=!0;break}}n||(a.origin=i.simulationOrigin)}return a},extractTypingInfoForDataDisplay:function(t){var e={},i=this.sequences[t.seq];return i&&((e=this.extractTypingInfoForSequence(i.persistentId,i.name)).contentType=this.getDataDisplayType(t)),e},getDataDisplayType:function(t){var e;return t&&(e=t.plotType&&t.plotType.length>0?t.plotType:t.type),e},getDataDisplayList:function(t){return this.sequences.length>t&&this.sequences[t]?this.sequences[t].listDD:void 0},getSharedDataDisplayList:function(t,e){if(this.sequences.length>t&&this.sequences[t]){var i=this.sequences[t].listDDShared;return e&&(i=this.sequences[t].listDDShared.filter(function(t){return t.category===e})),i}},getZipEntries:function(t){return this.sequences[t].zip},loadFiles:function(t){if(t&&t.filesList&&(t.fatherNode||t.fatherNodes&&!isNaN(t.frameIndex))&&!isNaN(t.sequence)&&t.callback){if(0===t.filesList.length)return void t.callback();var i,s=this.filesToLoad.length>0;if(this.filesToLoad=this.filesToLoad.concat(t.filesList),this.bufferingSize=Math.round(this.filesToLoad.length/10),!this._notYetLoadingProbe&&this.filesToLoad.length>=4&&(this._notYetLoadingProbe=a.createProbe("SPY.notYetLoading"),this._notYetLoadingProbe.begin(),this._notYetLoadingProbe.started=!0),!t.framesIndices)for(t.framesIndices=[],i=0;i<t.filesList.length;i++)t.framesIndices.push(t.frameIndex);if(t.framesIndices&&t.framesIndices.length!==t.filesList.length&&console.error("SimulationPlayerModel - inconsistencies between files and frames indices to load"),this.framesIndices=this.framesIndices.concat(t.framesIndices),!t.fatherNodes)for(t.fatherNodes=[],i=0;i<t.filesList.length;i++)t.fatherNodes.push(t.fatherNode);this.fatherNodes=this.fatherNodes.concat(t.fatherNodes),t.fatherNodes&&t.fatherNodes.length!==t.filesList.length&&console.error("SimulationPlayerModel - inconsistencies between files and father node list");var n=t.fatherNodes[0].id,r=u(t.framesIndices[0]),h=String(n)+r;if(!this.transactionMap.get(h)){var l={count:0,loadStatus:"loading",callbacks:[],analytics:{maxCgrExtractionTime:0}};if(o){var d=t.filesList.length>1?t.filesList.length.toString()+"_cgrs":t.filesList[0];l.probe=a.createProbe("SPY.SPM.LOADFILES."+h+"_"+d)}l.startTime=Date.now(),l.sequence=t.sequence,l.count+=t.filesList.length,l.callbacks.push(t.callback),this.transactionMap.set(h,l),t.fatherNodes&&(i=0,t.fatherNodes.forEach(function(t){this.fatherTransactionMap.set(String(t.id)+r,h)}.bind(this))),s?this.progress.total+=t.filesList.length:(this.progress.loaded=0,this.progress.total=t.filesList.length,this.window.experience&&(e.publish({event:this.getContext()+"/SPY/PROGRESS/INIT",data:{fromPreviousValue:!t.resetProgress}}),this.window.experience.modelLoadComplete=!1,this.window.experience.modelLoadCount=0,this.window.experience.modelPrevLoadCount=0))}}},_closeTransaction:function(t){var e=this.transactionMap.get(t);if(e){e.loadStatus="done",e.probe&&e.probe.started&&(e.probe.end(),e.probe.started=!1);var i=Object.assign({},e.analytics),a=e.callbacks;this.transactionMap.delete(t),this.fatherTransactionMap.forEach(function(e,i,a){e===t&&a.delete(i)}),a.forEach(function(t){t&&t(i)})}},_updateTransactionForFatherNode:function(t,e){if(t){var i=this.fatherTransactionMap.get(String(t.id)+u(e)),a=this.transactionMap.get(i);if(a)"loading"===a.loadStatus&&(a.count--,0===a.count&&this._closeTransaction(i));else t.parents[0]&&t.parents[0].traverse(function(t){t.children.forEach(function(i){i._SPYFrameIndex===e&&t.remove(i)})})}},_getNodeToReuse:function(t){var e;return t&&"loaded"===t.status&&t.usages&&t.usages.length>0&&(e=t.usages[0].children[0]),e},_reuseNode:function(t,e,i){var a=new s;isNaN(e)||(a._SPYFrameIndex=e),a.addChild(i),a.setVisibility(!1),t.addChild(a),this._updateTransactionForFatherNode(t,e),this.processLoadFiles(),0===this.filesToLoad.length&&this.onLoaderDoneCallback()},_loadRequest:function(t,e,i){var a,n;if(i&&(n=this.loadingMap.get(i)),a=this._getNodeToReuse(n))this._reuseNode(t,e,a);else{var r=this.fatherTransactionMap.get(String(t.id)+u(e));if(r){var o=this.transactionMap.get(r),h=o.sequence;if(i){if(!isNaN(h)){var l=new s;if(isNaN(e)||(l._SPYFrameIndex=e),t.addChild(l),l.setVisibility(!1),n&&"loading"===n.status)n.usages.push(l);else{n&&(t._SPYMultipleUsages=!0,n.status="loading",n.usages.push(l)),o.probe&&(o.probe.begin(),o.probe.started=!0);var d=this.sequences[h].zip.find(i);if(d){var c=Date.now(),m=this._modelLoader;m.setKeepLoaderMode(!0),m.fileType="cgr",this._notYetLoadingProbe&&this._notYetLoadingProbe.started&&(this._notYetLoadingProbe.end(),this._notYetLoadingProbe.started=!1),d.getUint8Array().then(function(t){var e=Date.now()-c;e>o.analytics.maxCgrExtractionTime&&(o.analytics.maxCgrExtractionTime=e),m.loadModelFromBuffer(t,l)})}}}}else{var p=new s;isNaN(e)||(p._SPYFrameIndex=e),t.addChild(p),p.setVisibility(!1),"loading"===o.loadStatus&&(o.count--,0===o.count&&this._closeTransaction(r)),this.processLoadFiles(),0===this.filesToLoad.length&&this.onLoaderDoneCallback()}}}},processLoadFiles:function(){if(this.filesToLoad.length>0){var t=[],e=function(){t.push({fatherNode:this.fatherNodes.shift(),frameIndex:this.framesIndices.shift(),cgrFileToLoad:this.filesToLoad.shift()})}.bind(this),i=this._modelLoader.cgrLoader;if(i)for(;i.currentDownload+t.length<i.maxParrallelDownload&&this.fatherNodes.length>0;)e();else e();for(;t.length>0;){var a=t.shift();this._loadRequest(a.fatherNode,a.frameIndex,a.cgrFileToLoad)}}},_addToLoadingMap:function(t){var e=this.loadingMap;e&&t&&t.forEach(function(t){e.set(t,{status:"notLoaded",usages:[]})})},initLoadingMap:function(t){this.clearLoadingMap(),this._addToLoadingMap(t)},addToLoadingMap:function(t){this._addToLoadingMap(t)},clearLoadingMap:function(){this.loadingMap.clear()},clearLoadingQueue:function(t){this._notYetLoadingProbe=null,this.filesToLoad=[],this.framesIndices=[],this.fatherNodes=[];var e=[];this.transactionMap.forEach(function(t,i){"loading"===t.loadStatus&&e.push(i)});var i=[];if(e.forEach(function(t){var e,a=(e=t.split("_frame")).length>1?parseInt(e[1]):void 0;isNaN(a)||i.push(a)}),this.window&&this.window.getViewer){var a=this.window.getViewer();if(a){var s=a.getRootNode();i.forEach(function(t){s.traverse(function(e){e.children.forEach(function(i){i._SPYFrameIndex===t&&e.remove(i)})})})}}if(this.fatherTransactionMap.clear(),this.transactionMap.clear(),this.noNodeTransactionCounter=0,this.progress.loaded=0,this.progress.total=0,this.window&&this.window.experience){this.window.experience.modelLoadComplete=!0,this.window.experience.modelLoadCount=0,this.window.experience.modelPrevLoadCount=0;var n=this._modelLoader;if(n){n.abort();var r=n.cgrLoader;r&&r.cleanLoader(),n.setOnLoadedCallback(this.onLoaderDoneCallback.bind(this)),n.setOnLoadedProductStructureCallback(this.onModelLoadedCallback.bind(this))}t||this.window.experience.progress.updateProgression(0)}},onModelLoadedCallback:function(t){var i,a;if(t.nodes&&t.nodes.length>0){var s=t.nodes[0].parents[0];if(i=s.parents[0],a=s._SPYFrameIndex,i&&i._SPYMultipleUsages){var n=[];this.loadingMap.forEach(function(t){if(0===n.length){var e=t;if("loading"===e.status)e.usages.indexOf(s)>=0&&(n=e.usages,e.status="loaded")}}),n.forEach(function(t){if(t!==s&&t.id!==s.id){t.addChild(s.children[0]);var e=t.parents[0];this._updateTransactionForFatherNode(e,a)}}.bind(this))}}else this.noNodeTransactionCounter++;this._updateTransactionForFatherNode(i,a);var r=this.window.experience&&this.window.experience.mySPM?this.window.experience.mySPM:this;r&&(this.window.experience&&(r.progress.loaded++,e.publish({event:this.getContext()+"/SPY/PROGRESS/UPDATE",data:{value:r.progress.loaded,total:r.progress.total}}),this.window.experience.modelLoadCount=r.progress.loaded),r.processLoadFiles())},onLoaderDoneCallback:function(){var t=0;this.transactionMap.forEach(function(e){t+=e.count});var i=this;t-this.noNodeTransactionCounter<=0&&(this.transactionMap.forEach(function(t,e){i._closeTransaction(e)}),this.transactionMap.clear(),this.fatherTransactionMap.clear(),this.noNodeTransactionCounter=0,this.window.experience&&(setTimeout(function(){i.filesToLoad.length<=0&&e.publish({event:i.getContext()+"/SPY/PROGRESS/END"})},500),this.window.experience.modelLoadComplete=!0,this.window.experience.modelLoadCount=0,this.window.experience.modelPrevLoadCount=0),e.publish({event:this.getContext()+"/SPY/VISULOADING/FINISHED"}))},copyZipEntriesForTarget:function(t,e,i){if(e&&!isNaN(t)&&this.sequences&&this.sequences.length>t){var a=this.getZipEntries(t),s=e.getZipEntries(0);if(a&&s){var n=e.getDataDisplayList(0);n=n.concat(e.getSharedDataDisplayList(0));var r=[],o=this.logo?[this.logo]:[];n.forEach(function(t){r=r.concat(t.getNavData3DViewList(!0));var e=t.getLegend();e&&(o=o.concat(e.getPNGList())),t.containsImages()&&(o=o.concat(t.getInfoImages()))});var u=[];r.forEach(function(t){t&&(t.getCGRs&&(u=u.concat(t.getCGRs())),t.matRendering&&u.push(t.matRendering))});
//!! we need to remove duplicates!
var h={count:0,noMoreRequest:!1},l=function(t){var e,n=a.find(t);n&&(h.count++,n.getUint8Array().then((e=t,function(t){s.root.addUint8Array(e,t),h.count--,0===h.count&&h.noMoreRequest&&i()})))};u.forEach(l),o.forEach(l),h.noMoreRequest=!0,0===h.count&&i()}}}});return t.namespace("DS/SPY/SimulationPlayerModel",h)}),define("DS/SPY/CATSimNavData3DAnimationView",["UWA/Core","DS/SPY/CATSimNavData3DView","DS/Visualization/ThreeJS_DS"],function(t,e,i){"use strict";var a=/[^;\[\]]+;[^;\[\]]+;[^;\[\]]+/g,s=function(t){var e,a=t.split(";");if(3===a.length){var s=parseFloat(a[0]),n=parseFloat(a[1]),r=parseFloat(a[2]);isNaN(s)||isNaN(n)||isNaN(r)||(e=new i.Vector3(s,n,r))}return e},n=function(t){for(var e,n=void 0,r=[];null!==(e=a.exec(t));)r.push(e[0]);if(4===r.length){var o=s(r[0]),u=s(r[1]),h=s(r[2]),l=s(r[3]);(n=new i.Matrix4).set(o.x,u.x,h.x,l.x,o.y,u.y,h.y,l.y,o.z,u.z,h.z,l.z,0,0,0,1)}return n},r=e.extend({init:function(t,e,i,a){this._parent(t,e),this.impl={CATISimNavDataSpecUI:{module:"SPYUI",ext:"CATSimNavData3DAnimationViewUI",type:"data",obj:null},CATISimNavDataAnimation:{module:"SPYUI",ext:"CATSimNavData3DAnimationViewUI",type:"data",obj:null},CATISimNavDataExtremaProvider:{module:"SPY",ext:"CATSimNavData3DAnimationExtremaProvider",type:"data",obj:null}},this._cgrsLinkedList={cgrs:[],status:[],matrices:[],getPointedResource:function(){var t;return this.index>=0&&this.index<this.cgrs.length&&(t=this.cgrs[this.index]),t},getMatrix:function(){var t=null;return this.index>=0&&this.index<this.matrices.length&&(t=this.matrices[this.index]),t},getNextSpec:function(){return this.index++,this.index<this.cgrs.length?this:null},index:0},this.readFromXML(t,function(){a&&a(this)}.bind(this))},getCGRList:function(){var t;return this._cgrsLinkedList&&this._cgrsLinkedList.cgrs.length>0&&(this._cgrsLinkedList.index=0,t=this._cgrsLinkedList),t},getCGRs:function(){var t=this.getCGRList();return t?t.cgrs:[]},readFromXML:function(t,e){for(var i=this.dd.spm.getDataList("src",this.dd.seq),a=0;a<t.children.length;a++){var s=t.children[a];if("1"===s.getAttribute("level"))for(var r=0;r<s.children.length;r++)for(var o=s.children[r],u=0;u<o.children.length;u++){var h,l=o.children[u],d=parseInt(l.getAttribute("srcId"));if(!isNaN(d)&&i)h=i.getEntry(d-1).val;else h=l.getAttribute("src");this._cgrsLinkedList.cgrs.push(h),this._cgrsLinkedList.status.push("notLoaded");var c=l.getAttribute("matrix");if(c){if(c===this._lastMxStr&&this._lastMx)this._cgrsLinkedList.matrices.push(this._lastMx);else{var m=n(c);this._cgrsLinkedList.matrices.push(m),this._lastMx=m}this._lastMxStr=c}}}e(this)},getLoadingDescription:function(t){var e;return this._cgrsLinkedList&&(e={status:this._cgrsLinkedList.status[t],file:this._cgrsLinkedList.cgrs[t],matrix:this._cgrsLinkedList.matrices[t]}),e},getAllLoadingDescription:function(){return this._cgrsLinkedList},setLoadingStatus:function(t,e){this._cgrsLinkedList&&this._cgrsLinkedList.status&&t>=0&&t<this._cgrsLinkedList.status.length&&(this._cgrsLinkedList.status[t]=e)},resetLoadingStatus:function(){if(this._cgrsLinkedList&&this._cgrsLinkedList.status)for(var t=0;t<this._cgrsLinkedList.status.length;t++)this._cgrsLinkedList.status[t]="notLoaded"}});return t.namespace("DS/SPY/CATSimNavData3DAnimationView",r)}),define("DS/SPY/CATSimNavData3DVirtualComponent",["DS/SPY/CATSimNavData3DAnimationView"],function(t){"use strict";var e=t.extend({init:function(t,e,i,a){this._isVirtual=!0,this._parent(t,e,i,function(t){t.impl={CATISimNavDataSpecUI:{module:"SPYUI",ext:"CATSimNavData3DVirtualComponentUI",type:"data",obj:null},CATISimNavDataAnimation:{module:"SPYUI",ext:"CATSimNavData3DVirtualComponentUI",type:"data",obj:null}},a&&a(t)})}});return UWA.namespace("DS/SPY/CATSimNavData3DVirtualComponent",e)}),define("DS/SPY/CATSimNavData3DCamera",["UWA/Core","DS/SPY/CATSimNavDataSpec","DS/SPY/CATSimNavDataLink","DS/Visualization/ThreeJS_DS"],function(t,e,i,a){"use strict";var s=e.extend({init:function(t,e,i,a){this._parent(t,e),this.impl={CATISimNavDataAnimation:{module:"SPYUI",ext:"CATSimNavData3DAnimationCameraUI",type:"data",obj:null}},this._isTracking=!1,this._lockedDOF={},this.readFromXML(t,i,a)},setFromViewpoint:function(t){t&&(this._sightDirection=t.getSightDirection(),this._upDirection=t.getUpDirection(),this._eyePosition=t.getEyePosition(),this._focus=t.getTargetDistance(),this._angle=t.getAngle())},getThumbnail:function(){return this._thumbnail},getEyePosition:function(){return this._eyePosition},getSightDirection:function(){return this._sightDirection},getUpDirection:function(){return this._upDirection},getTargetDistance:function(){return this._focus},getAngle:function(){return this._angle},getLockedDOF:function(){return this._lockedDOF},getDescription:function(){return this._description?this._description:""},isTracking:function(){return this._isTracking},readFromXML:function(t,e,s){if(t){this._thumbnail=t.getAttribute("thumbnail");for(var n=t.getAttribute("camera").split("]"),r=0;r<n.length;++r)n[r]=n[r].replace("[","");var o=n[0].split(";");this._eyePosition=new a.Vector3(Number(o[0]),Number(o[1]),Number(o[2]));var u=n[1].split(";");this._sightDirection=new a.Vector3(Number(u[0]),Number(u[1]),Number(u[2]));var h=n[2].split(";");this._upDirection=new a.Vector3(Number(h[0]),Number(h[1]),Number(h[2])),this._focus=Number(t.getAttribute("focus"));var l=t.getAttribute("angle");this._angle=l?Number(l):45;var d=!1,c=t.getAttribute("lock");if(c){var m=c.split(";");if(m.length>0){d=!0;for(var p=0;p<m.length;++p)Object.defineProperty(this._lockedDOF,m[p],{value:!0,writable:!1})}}d||(this._lockedDOF=void 0),this._description=t.getAttribute("description");for(var f=null,g=0;g<t.childNodes.length;g++){var v=t.childNodes[g];if("LinkSet"===v.nodeName&&"CamerasToPart"===v.getAttribute("role")){for(var S=0;S<v.childNodes.length;S++){var D=v.childNodes[S];if("InternalRef"===D.nodeName){f=D;break}}break}}if(f)new i(f,this.dd,function(t){this.addLink("CamerasToPart",t),this._isTracking=!0!==e}.bind(this));s(this)}},writeToXML:function(t){if(t){var e=t.ownerDocument.createElement("Camera");e.setAttribute("type","CATSimNavData3DCamera"),this.name&&e.setAttribute("name",this.name),this.id&&e.setAttribute("id",this.id);var i=[];i.push("[",this._eyePosition.x.toString(),";",this._eyePosition.y.toString(),";",this._eyePosition.z.toString(),"]"),i.push("[",this._sightDirection.x.toString(),";",this._sightDirection.y.toString(),";",this._sightDirection.z.toString(),"]"),i.push("[",this._upDirection.x.toString(),";",this._upDirection.y.toString(),";",this._upDirection.z.toString(),"]"),e.setAttribute("camera",i.join("")),e.setAttribute("focus",this._focus),e.setAttribute("angle",this._angle),t.appendChild(e)}}});return t.namespace("DS/SPY/CATSimNavData3DCamera",s)}),define("DS/SPY/CATSimNavData3DCamerasRoot",["UWA/Core","DS/SPY/CATSimNavDataSpec","DS/SPY/CATSimNavData3DCamera"],function(t,e,i){"use strict";var a=e.extend({init:function(t,e,i,a){this._parent(t,e),this.impl={CATISimNavDataAnimation:{module:"SPYUI",ext:"CATSimNavData3DCamerasRootAnimationUI",type:"data",obj:null}},this._cameraList=[],this._currentCameraIdx=0,this.readFromXML(t,i,a)},addCamera:function(t){t&&this._cameraList.push(t)},getCamera:function(t){return this._cameraList[t]},getListCamera:function(){return this._cameraList},getCurrentCamera:function(){return this._cameraList[this._currentCameraIdx]},getCurrentCameraIdx:function(){return this._currentCameraIdx},setCurrentCamera:function(t){return t!==this._currentCameraIdx&&t>=0&&t<this._cameraList.length&&(this._currentCameraIdx=t),this._currentCameraIdx},setCurrentCameraFromId:function(t){var e=this._cameraList.findIndex(function(e){return e.getId()===t});return this.setCurrentCamera(e)},readFromXML:function(t,e,a){if(t){var s={counter:0,loopCompleted:!1},n=parseInt(t.getAttribute("currentCamera"));n=isNaN(n)?1:n,this._currentCameraIdx=n-1;for(var r=function(t){t&&(this.addCamera(t),s.counter--,0===s.counter&&s.loopCompleted&&a&&a())}.bind(this),o=e&&e.types?e.types[this.type]:void 0,u=o&&o.disableTracking,h=o&&!isNaN(o.maxChildrenNb)?o.maxChildrenNb:t.children.length,l=0;l<h;l++){var d=t.children[l];if(!(d.nodeName.indexOf("Camera")<0)){s.counter++;new i(d,this.dd,u,r)}}s.loopCompleted=!0,0===s.counter&&a()}},getLoadingDescription:function(){return{status:"loaded"}},writeToXML:function(t){if(t){var e=t.ownerDocument.createElement("DDElement3D");e.setAttribute("type","CATSimNavData3DCamerasRoot"),this.name&&e.setAttribute("name",this.name),this.id&&e.setAttribute("id",this._id),isNaN(this._currentCameraIdx)||e.setAttribute("currentCamera",this._currentCameraIdx+1),t.appendChild(e);var i=this.getListCamera();i&&i.forEach(function(t){t.writeToXML(e)})}}});return t.namespace("DS/SPY/CATSimNavData3DCamerasRoot",a)}),define("DS/SPY/CATSimNavDataDisplay",["UWA/Core","DS/SPY/CATSimNavDataDisplayAbstract","DS/SPY/CATSimNavDataHelper"],function(t,e,i){"use strict";var a={},s=e.extend({init:function(t,e,i,a,s){this._parent(t,e,i),this._constructionMap={DDElement2D:{itemList:this.list2DViews},DDElement3D:{itemList:this.list3DViews},DDElementFrame:{itemList:this.listFrameViews}},this.readFromXML(t,a,s)},_internalRead:function(t,e,i){for(var s=function(t){i&&i.noFrameViewSimplification||t.simplifyFrameViewList(),e&&e(t)},n=function(t){var e=!1;return i&&i.excludedTypes&&(e=i.excludedTypes.indexOf(t)>=0),e},r=function(t,e){var a=!1;if(i&&i.types){var s=i.types[t];a=s&&!isNaN(s.maxNb)&&e.nbInst>s.maxNb}return a},o={counter:0,loopCompleted:!1},u=this,h=function(){o.counter--,0===o.counter&&o.loopCompleted&&s(u)},l=function(t,e,a){return function(s){var n=new s(t,e,i,h);a.push(n)}},d=this._constructionMap,c=function(){for(var e=0;e<t.children.length;e++){var n=t.children[e],c=d[n.nodeName];if(c){var m="DDElementFrame"===n.nodeName?"CATSimNavDataFrameView":n.getAttribute("type"),p=a[m];p&&(r(m,p)||(o.counter++,p.nbInst++,"loaded"===p.status?(f=n,g=p.typeClass,v=u,S=c.itemList,D=void 0,D=new g(f,v,i,h),S.push(D)):"requested"===p.status&&p.queue&&p.queue.push(l(n,u,c.itemList))))}}var f,g,v,S,D;o.loopCompleted=!0,0===o.counter&&s(u)},m={counter:0,loopCompleted:!1},p=function(t){return function(e){var i=a[t];if(i)for(i.status="loaded",i.typeClass=e;i.queue.length>0;)i.queue[0]&&(i.queue[0](e),i.queue.shift());m.counter--,0===m.counter&&m.loopCompleted&&c()}},f=0;f<t.children.length;f++){var g=t.children[f];if(d[g.nodeName]){var v="DDElementFrame"===g.nodeName?"CATSimNavDataFrameView":g.getAttribute("type");a[v]||n(v)||(m.counter++,a[v]={status:"requested",queue:[],nbInst:0},require(["DS/SPY/"+v],p(v)))}}m.loopCompleted=!0,0===m.counter&&c()},readFromXML:function(t,e,a){if("DataDisplay"===t.nodeName){this.id=t.getAttribute("id"),this.name=t.getAttribute("name");var s=i.parseGroupIds(this.name);s.length>1&&(this.name=s[0],this.subName=s[1]),this.type=t.getAttribute("type"),this.plotType=t.getAttribute("plotType"),this.category=t.getAttribute("category"),this.thumbnail=t.getAttribute("thumbnail"),this.isShared="Shared"===this.type,this._internalRead(t,e,a)}},extendFromXML:function(t,e,i){"DataDisplay"===t.nodeName&&this.id===t.getAttribute("id")&&this.name===t.getAttribute("name")&&(this.listFrameViews=[],this._constructionMap={DDElementFrame:{itemList:this.listFrameViews}},this._internalRead(t,e,i))},getMultiInstanciatedFiles:function(){var t=[];this.getNavData3DViewList(!0).forEach(function(e){e&&e.getCGRs&&(t=t.concat(e.getCGRs()))});var e=this._getSortedDuplicates(t);return new Set(e)},getCameraRoot:function(){var t,e=this.getNavData3DViewList();if(e&&e.length)for(var i=0;i<e.length&&!t;i++){var a=e[i];"CATSimNavData3DCamerasRoot"===a.type&&(t=a)}return t}});return t.namespace("DS/SPY/CATSimNavDataDisplay",s)}),define("DS/SPY/CATSimNavDataLWFactory",["UWA/Core","DS/SPY/CATSimNavDataAbstractFactory","DS/WebUtils/ProbesManager","DS/CoreEvents/Events","DS/ZipJS2/ZipJS2","DS/SPY/CATSimNavDataList","DS/SPY/CATSimNavDataDisplay"],function(t,e,i,a,s,n,r){"use strict";s.configure({maxWorkers:4,terminateWorkerTimeout:NaN});var o=function(t,e){var i;if(t&&e){var a=e.getAttribute("id"),s=function(t){return a&&a===t.id};Array.isArray(t.listDD)&&(i=t.listDD.find(s)),!i&&Array.isArray(t.listDDShared)&&(i=t.listDDShared.find(s))}return i},u=e.extend({init:function(){this._parent()},createSequence:function(t,e){var n,r=Date.now(),o=i.createProbe("SPY.LWFactory.OPENZIP");o.begin(),t.shareZipEntries=void 0!==t.shareZipEntries&&t.shareZipEntries;var u=function(){if(o.end(),n){var u=i.createProbe("SPY.LWFactory.EXTRACTXML");u.begin();var h=n.find("SimNavData.xml");h&&h.getText().then(function(i){if(u.end(),"string"==typeof i&&i.length>0&&i.search("<")>=0){var o,h=(new DOMParser).parseFromString(i,"text/xml").firstChild;if(this.isExtendedMode()&&(c=t.spm,m=function(t){var e;if("SimDDTree"===t.nodeName)for(var i=0;i<t.childNodes.length;i++){var a=t.childNodes[i];"Scenario"===a.nodeName&&(e=a.getAttribute("name"))}return e}(h),c&&Array.isArray(c.sequences)&&m&&(p=c.sequences.find(function(t){return t.name&&t.name.length>0&&t.name===m})),o=p),!o){var l=t.spm.sequences.length;o={persistentId:t.src&&t.src.persistentId?t.src.persistentId:"",idx:t.src?isNaN(t.src.index)?l:t.src.index:l,name:"sequence",listDD:[],listDDShared:[],zip:t.zipEntries?t.shareZipEntries?n:new s.fs.FS:n},t.src&&t.src.analytics&&(o.analytics={dataSize:t.src.analytics.dataSize,streamingTime:t.src.analytics.streamingTime,extractionTime:Date.now()-r}),t.spm.sequences[o.idx]=o}var d=Date.now();this.parseXML(h,o,t.spm,function(i,s){var n={spm:t.spm,seqIdx:o.idx,seqName:o.name,filteredDDNb:s,annotations:t.annotations,state:t.state};o.analytics&&(o.analytics.dataModelCreationTime=Date.now()-d),e&&e.onComplete?e.onComplete(n):a.publish({event:t.spm.getContext()+"/SPY/SEQUENCE/CREATED",data:n})},function(i){t.spm._dataLists.pop(),t.spm.sequences.pop();var s={spm:t.spm,seqIdx:o.idx,errorCode:i,analytics:t.src?t.src.analytics:void 0};e&&e.onError?e.onError(s):a.publish({event:t.spm.getContext()+"/SPY/SEQUENCE/ERROR",data:s})})}else{i={spm:t.spm};e&&e.onError?e.onError(i):a.publish({event:t.spm.getContext()+"/SPY/SEQUENCE/ERROR",data:i})}var c,m,p}.bind(this))}}.bind(this),h=function(){o.end(),alert("failed to open zip")};if(t)if(t.zipEntries&&t.spm)n=t.zipEntries,u();else if(t.src&&t.spm)switch(n=new s.fs.FS,t.src.provider){case"BLOB":n.importBlob(t.src.blob,{directAccess:!0}).then(u,h);break;case"BUFFER":var l=new Blob([new DataView(t.src.buffer)],{type:"application/zip"});n.importBlob(l).then(u,h);break;default:n.importHttpContent(t.src,{useXHR:!1,preventHeadRequest:!0}).then(u,h)}},parseXML:function(t,e,a,s,u,h,l){if("SimDDTree"===t.nodeName){var d=i.createProbe("SPY.LWFactory.PARSEXML");d.begin();var c=function(t,e,i){var a;return l&&l.targetDocument&&(a=l.targetDocument.importNode(t,e))&&(e&&Array.isArray(l.excludedTagNames)&&l.excludedTagNames.forEach(function(t){for(var e=a.getElementsByTagName(t);e.length>0;)e[0].remove()}),i?i.appendChild(a):l.targetDocument.getRootNode().appendChild(a)),a},m=c(t,!1),p=0,f=!1,g=!1,v=t.getAttribute("name");a.simulationName=v&&v.length>0?v:a.simulationName,a.disclaimer=t.getAttribute("disclaimer"),a.logo=t.getAttribute("logo"),a._isYaxisUp="true"===t.getAttribute("yAxisUp");for(var S,D=[],N=0,C=function(){for(var t=e.listDD.length-1;t>=0;)e.listDD[t].isEmpty()&&(e.listDD.splice(t,1),N++),t--},A=function(t){if(t&&t.analytics){var i=t.analytics;i.dataModelCreationTime=Date.now()-S,i.numberOfFrames=t.getTotalNumberOfFrames(),i.extractionTime=0}0===--p&&f&&(e.listDD=D.concat(e.listDD),C(),d.end(),e.listDD.length>0?s(a,N):u("FILTEREDCONTENT"))},x=0;x<t.childNodes.length;x++){var b=t.childNodes[x];if("Scenario"===b.nodeName&&(a.dataLevel=parseInt(b.getAttribute("level")),!(a.level<a.dataLevel))){var L=c(b,!1,m);e.name=b.getAttribute("name");for(var y=0;y<b.children.length;y++){var T=b.children[y];if("List"===T.nodeName){if(!a.getDataList(T.getAttribute("name"),e.idx)){var _=new n(T);a.addDataList(_,e.idx)}c(T,!0,L)}else if("DataDisplay"===T.nodeName){var M=!1,P="Shared"===T.getAttribute("type");if(h&&(h.specificContent?M=h.specificContent!==T.getAttribute("id"):Array.isArray(h.categories)&&(M=h.categories.indexOf(T.getAttribute("category"))<0)),P||!M){p++,g=!0;var I=o(e,T);I?I.extendFromXML(T,A,h):(S=Date.now(),I=new r(T,a,e.idx,A,h),P?e.listDDShared.push(I):D.push(I));var F=c(T,!0,L);F&&h.specificContent&&!M&&(a.importedSpecificContent=F)}}}}}f=!0,g?0===p&&(e.listDD=D.concat(e.listDD),C(),d.end(),e.listDD.length>0?s(a,N):u("FILTEREDCONTENT")):(d.end(),u("INVALIDDATA"))}else u()}});return t.namespace("DS/SPY/CATSimNavDataLWFactory",u)}),define("DS/SPY/CATSimNavDataMediaFactory",["UWA/Core","DS/SPY/CATSimNavDataLWFactory"],function(t,e){"use strict";var i=e.extend({init:function(t){this._selectedDDId=t?t.ddId:void 0,this._parent()},parseXML:function(t,e,i,a,s){var n={specificContent:this._selectedDDId,excludedTypes:["CATSimNavDataFrameViewXYChart"],types:{CATSimNavData3DCamerasRoot:{maxChildrenNb:1,disableTracking:!0}}};i.importedDom=document.implementation.createDocument("","",null);var r={targetDocument:i.importedDom,excludedTagNames:["DDXYPlot"]};this._parent(t,e,i,a,s,n,r)}});return t.namespace("DS/SPY/CATSimNavDataMediaFactory",i)}),define("DS/SPY/CATSimNavDataLWPreviewFactory",["UWA/Core","DS/SPY/CATSimNavDataLWFactory"],function(t,e){"use strict";var i=e.extend({init:function(){this._parent()},parseXML:function(t,e,i,a,s){this._parent(t,e,i,a,s,{categories:["Result"],excludedTypes:["CATSimNavDataFrameView"],types:{CATSimNavData3DCamerasRoot:{maxChildrenNb:1,disableTracking:!0}}})}});return t.namespace("DS/SPY/CATSimNavDataLWPreviewFactory",i)}),define("DS/SPY/CATSimNavDataLWBasicFactory",["UWA/Core","DS/SPY/CATSimNavDataLWFactory"],function(t,e){"use strict";var i=e.extend({init:function(){this._parent()},parseXML:function(t,e,i,a,s){var n;n=this._extensionFilter?this._extensionFilter:{categories:["Result"],excludedTypes:["CATSimNavDataFrameViewXYChart"],types:{CATSimNavData3DCamerasRoot:{maxChildrenNb:1,disableTracking:!0}}},this._parent(t,e,i,a,s,n)},setExtendedMode:function(t){this._extensionFilter=t?{types:{CATSimNavData3DCamerasRoot:{maxChildrenNb:1,disableTracking:!0}}}:void 0}});return t.namespace("DS/SPY/CATSimNavDataLWBasicFactory",i)}),define("DS/SPY/CATSimNavDataLWSensorsFactory",["UWA/Core","DS/SPY/CATSimNavDataLWFactory"],function(t,e){"use strict";var i=e.extend({init:function(){this._parent()},parseXML:function(t,e,i,a,s){this._parent(t,e,i,a,s,{categories:["Result"],info:!0,noFrameViewSimplification:!0,types:["CATSimNavData3DAnimationView","CATSimNavData3DCamerasRoot","CATSimNavData2DLegend"]})}});return t.namespace("DS/SPY/CATSimNavDataLWSensorsFactory",i)}),define("DS/SPY/CATSimNavData3DSimFactory",["UWA/Core","DS/SPY/CATSimNavDataLWFactory","DS/ZipJS2/ZipJS2"],function(t,e,i){"use strict";var a=e.extend({init:function(){this._parent()},createSequence:function(t){var e,a=this._parent.bind(this),s=function(){if(e){var i=e.find("SimulationExperienceContent.simxml");if(i){i.getBlob("application/zip").then(function(i){t.src.provider="BLOB",t.src.blob=i,t.src.filename=void 0;var s=function(){var i=e.find("SimulationExperienceState.json");i?i.getText().then(function(e){"string"==typeof e&&e.length>0&&(t.state=e),a(t)}):a(t)},n=e.find("annotations.json");n?n.getText().then(function(e){"string"==typeof e&&e.length>0&&(t.annotations=e),s()}):s()})}}},n=function(){alert("failed to open 3dsim zip")};t&&t.src&&t.spm&&(e=new i.fs.FS,"BLOB"===t.src.provider?e.importBlob(t.src.blob,{directAccess:!0}).then(s,n):e.importHttpContent(t.src,{useXHR:!1,preventHeadRequest:!0}).then(s,n))},parseXML:function(t,e,i,a,s,n){"SimDDTree"===t.nodeName&&(i.originURL=t.getAttribute("originURL")),this._parent(t,e,i,a,s,n)}});return t.namespace("DS/SPY/CATSimNavData3DSimFactory",a)}),define("DS/SPY/CATSimNavData3DExtrema",["DS/SPY/CATSimNavDataSpec","DS/Visualization/ThreeJS_DS"],function(t,e){"use strict";var i=t.extend({init:function(t,e,i){this._parent(t,e),this.impl={},this.readFromXML(t,i)},getExtremaType:function(){return this._extremaType},getExtremaValue:function(){return this._extremaValue},getPosition:function(){return this._position},getNormalVector:function(){return this._normalVector},getComponent:function(){return this._component},setComponent:function(t){this._component=t},readFromXML:function(t,i){this._extremaType=t.getAttribute("label"),this._position=new e.Vector3(parseFloat(t.getAttribute("PosX")),parseFloat(t.getAttribute("PosY")),parseFloat(t.getAttribute("PosZ"))),this._normalVector=new e.Vector3(0,0,0),this._extremaValue=t.getAttribute("value"),i(this)}});return UWA.namespace("DS/SPY/CATSimNavData3DExtrema",i)}),define("DS/SPY/CATSimNavDataFrameViewCompValue",["DS/SPY/CATSimNavDataFrameViewComp","DS/SPY/CATSimNavDataLink"],function(t,e){"use strict";var i=t.extend({init:function(t,e,i,a){this._parent(t,e),this.impl={CATISimNavDataSpecUI:{module:"SPYUI",ext:"CATSimNavDataFrameViewCompValueUI",type:"data",obj:null}},this.readFromXML(t,a)},getValues:function(){return{name:this.name,type:this.type,value:this.value,unit:this.unit}},readFromXML:function(t,i){if(t)if(this.value=t.getAttribute("value"),this.unit=t.getAttribute("unit"),t.children.length>0){for(var a=this,s=null,n=0;n<t.children.length&&null===s;n++){var r=t.children[n];if("LinkSet"===r.nodeName&&"Frameto3D"===r.getAttribute("role"))for(var o=0;o<r.children.length&&null===s;o++){var u=r.children[o];"InternalRef"===u.nodeName&&(s=u)}}if(s)new e(s,this.dd,function(t){a.addLink("Frameto3D",t),i(a)})}else i(this)}});return UWA.namespace("DS/SPY/CATSimNavDataFrameViewCompValue",i)}),define("DS/SPY/CATSimNavDataFrameViewText",["DS/SPY/CATSimNavDataFrameViewCompValue"],function(t){"use strict";var e=t.extend({init:function(t,e,i,a){this._parent(t,e,i,a),this.impl.CATISimNavDataSpecUI={module:"SPYUI",ext:"CATSimNavDataFrameViewTextUI",type:"data",obj:null}},getValues:function(){return{name:this.name,value:this.value}}});return UWA.namespace("DS/SPY/CATSimNavDataFrameViewText",e)}),define("DS/SPY/CATSimNavData3DExtremas",["DS/SPY/CATSimNavDataSpec","DS/SPY/CATSimNavData3DExtrema"],function(t,e){"use strict";var i=t.extend({init:function(t,e,i){this._parent(t,e),this.impl={},this._extremaList=[],this._extremaFrameIndex=t._extremaFrameIndex,this.readFromXML(t,i)},getFrameIndex:function(){return this._extremaFrameIndex},addExtrema:function(t){t&&this._extremaList.push(t)},getListExtrema:function(){return this._extremaList},readFromXML:function(t,i){for(var a=0,s=!1,n=function(t){t&&(this.addExtrema(t),0===--a&&s&&i&&i(this))}.bind(this),r=0;r<t.children.length;r++){var o=t.children[r];if("Extrema"===o.nodeName){a++;new e(o,this.dd,n)}}s=!0,0===a&&i(this)}});return UWA.namespace("DS/SPY/CATSimNavData3DExtremas",i)}),define("DS/SPY/CATSimNavDataXYCurve",["DS/SPY/CATSimNavDataXYValue","DS/SPY/CATSimNavDataHelper"],function(t,e){"use strict";var i=function(t,e,i,a){this.listValues=[],this.listGroups=[],this.isCrossGroup=!1,this.isCrossGroupNoMode=!1,this.hasPositions=!0,this.curveStyle={},this.readFromXML(t,e,i,a)};return i.prototype.getMetadata=function(){return{name:this.name,rootName:this.rootName,loadCaseName:this.loadCaseName,nameX:this.nameX,nameY:this.nameY,isBarChart:this.isBarChart,isCrossGroup:this.isCrossGroup,isCrossGroupNoMode:this.isCrossGroupNoMode,hasPositions:this.hasPositions,isBijective:this.isBijective,isFilled:this.isFilled,isStacked:this.isStacked}},i.prototype.getCurveStyle=function(){return this.curveStyle},i.prototype.getAssignedAxisX=function(){return this.assignedAxisX},i.prototype.setAssignedAxisX=function(t){this.assignedAxisX=t},i.prototype.getAssignedAxisY=function(){return this.assignedAxisY},i.prototype.setAssignedAxisY=function(t){this.assignedAxisY=t},i.prototype.getGroups=function(){return this.listGroups},i.prototype.getValues=function(){return this.listValues},i.prototype.addValue=function(t){t&&this.listValues&&(this.listValues.push(t),this.hasPositions=this.hasPositions&&!isNaN(t.getPosition()))},i.prototype.stack=function(t){if(this.isStacked&&t.isStacked)for(var e=0;e<this.listValues.length;e++)this.listValues[e].setY(this.listValues[e].getY()+t.listValues[e].getY())},i.prototype.ratio=function(t){if(this.isStacked&&t.isStacked)for(var e=0;e<this.listValues.length;e++){var i=t.listValues[e].getY();0!==i?this.listValues[e].setY(100*this.listValues[e].getY()/i):this.listValues[e].setY(0)}},i.prototype.setTo100=function(){if(this.isStacked)for(var t=0;t<this.listValues.length;t++){0!==this.listValues[t].getY()&&this.listValues[t].setY(100)}},i.prototype.readFromXML=function(i,a,s,n){if(n&&(this.rootName=n.rootName,this.loadCaseName=n.loadName),i&&("Curve"===i.nodeName||"DDXYPlot"===i.nodeName)){this.name=i.getAttribute("name"),this.nameX=i.getAttribute("nameX"),this.nameY=i.getAttribute("nameY"),this.assignedAxisX=parseInt(i.getAttribute("axisX")),this.assignedAxisY=parseInt(i.getAttribute("axisY")),this.curveStyle.color=i.getAttribute("color"),this.curveStyle.lineStyle=i.getAttribute("lineStyle"),this.curveStyle.lineWidth=i.getAttribute("lineWidth"),this.curveStyle.markerSize=parseInt(i.getAttribute("markerSize")),this.curveStyle.markerSize=!isNaN(this.curveStyle.markerSize)&&this.curveStyle.markerSize>3?3:this.curveStyle.markerSize,this.curveStyle.markerColor=i.getAttribute("markerColor"),this.curveStyle.markerPeriod=parseInt(i.getAttribute("markerPeriod")),this.curveStyle.markerPeriod=!isNaN(this.curveStyle.markerPeriod)&&this.curveStyle.markerPeriod>=1?this.curveStyle.markerPeriod:1,this.curveStyle.lineWidth,this.isFilled="true"===i.getAttribute("filled"),this.isStacked="true"===i.getAttribute("stacked"),this.isBarChart=!1;var r=i.getAttribute("valuesX"),o=i.getAttribute("valuesY");if(r&&o){var u=r.split(" "),h=o.split(" ");if(u&&""===u[u.length-1]&&u.pop(),h&&""===h[h.length-1]&&h.pop(),u.length===h.length)for(var l={x:0,y:0},d=function(t){t.setX(l.x),t.setY(l.y),this.addValue(t)}.bind(this),c=0;c<u.length;c++){l.x=Number(u[c]),l.y=Number(h[c]),new t(i,d).setIndex(c)}}if(!r&&!o&&i.hasChildNodes()){this.isBarChart=!0;var m,p,f,g,v,S=function(t){this.addValue(t)}.bind(this),D=0;this.isBijective=!0;for(var N=a&&a.modelMgr.getDataList?a.modelMgr.getDataList("grp",a.sequence):void 0,C=i.firstChild,A=0;null!=C;){if(1===C.nodeType){var x=C,b=!0;D++;var L,y,T=void 0,_=x.getAttribute("frmId");if(_&&a&&a.modelMgr.getFrameDetails)L=(T=a.modelMgr.getFrameDetails(a.sequence,_)).group;else{var M=x.getAttribute("grpId");M&&N?T={group:L=N.getEntry(parseInt(M)-1).val}:L=x.getAttribute("group")}var P=L?e.parseGroupIds(L):[];if(y=e.buildGroupIdNoMode(P[0],P[1]),f=P[0],n&&(b=f===n.rootName&&P[1]===n.loadName),b){L?(m&&m===L?this.isBarChart&&(this.isBarChart=!1):(this.listGroups.push(L),this.isCrossGroupNoMode||(this.isCrossGroupNoMode=p&&p!==y),this.isCrossGroup=this.listGroups.length>1),m=L,p=y):this.isBarChart=!1,_&&(this.isBarChart=!1);var I=new t(x,S,T);if(isNaN(I.getX())&&I.setX(D),I.setIndex(A),this.isBijective){var F=I.getX();if(!isNaN(g)){var w=F-g;isNaN(v)||(this.isBijective=w*v>0),v=w}g=F}}A++}C=C.nextSibling}}}1===this.listGroups.length&&void 0===this.rootName&&(this.rootName=e.parseGroupIds(this.listGroups[0])[0]),s&&s(this)},i}),define("DS/SPY/CATSimNavDataFrameViewXYChart",["UWA/Core","DS/WebUtils/ProbesManager","DS/SPY/CATSimNavDataFrameViewComp","DS/SPY/CATSimNavDataXYCurve","DS/SPY/CATSimNavDataChartAxis","DS/SPY/CATSimNavDataHelper"],function(t,e,i,a,s,n){"use strict";var r=i.extend({init:function(t,e,i,a){this.type="CATSimNavDataFrameViewXYChart",this._parent(t,e),this.impl={CATISimNavDataSpecUI:{module:"SPYExtUI",ext:"CATSimNavDataFrameViewXYChartUI",type:"data",obj:null},CATISimNavDataAnimation:{module:"SPYExtUI",ext:"CATSimNavDataFrameViewXYChartUI",type:"data",obj:null}},this.isExtractable=!0,this.listCurves=[],this.axis={x:[],y:[]},this._idForAxis=1,this.listCurvesGroupNames=[],this.analytics={},this.readFromXML(t,a,e)},computeNbCharts:function(){this._nbCharts=1},getMetadata:function(){return{name:this.name,distribution:this.distribution,animation:this.animation,isBarChart:this.isBarChart,isCrossGroup:this.isCrossGroup,isCrossGroupNoMode:this.isCrossGroupNoMode,oneCurvePerGroup:this.oneCurvePerGroup,hasPositions:this.hasPositions,linkAllCurvesAsOneSerie:this.linkAllCurvesAsOneSerie,alignTicks:this.alignTicks,secondaryGridLines:this.secondaryGridLines}},getCurves:function(){return this.computePositions(),this.listCurves},addCurve:function(t){if(t&&this.listCurves&&t.getValues().length>0){this.listCurves.push(t);var e=t.getMetadata();this.isCrossGroup=e.isCrossGroup,this.isCrossGroupNoMode=e.isCrossGroupNoMode;if(e.rootName){this.listCurvesGroupNames.push(e.rootName+" "+e.loadCaseName);var i=this.listCurvesGroupNames.reduce(function(t,e){return t.indexOf(e)<0&&t.push(e),t},[]);this.oneCurvePerGroup=i.length===this.listCurves.length}if(this.listCurves.length>1){var a=e.name===this.previousCurveName,s=t.curveStyle.color===this.previousCurveColor,n=t.curveStyle.lineStyle===this.previousCurveLineStyle,r=2===this.listCurves.length||this.linkAllCurvesAsOneSerie;this.linkAllCurvesAsOneSerie=r&&a&&s&&n&&!this.oneCurvePerGroup}this.previousCurveName=e.name,this.previousCurveColor=t.curveStyle.color,this.previousCurveLineStyle=t.curveStyle.lineStyle;var o=t.getAssignedAxisX(),u=t.getAssignedAxisY();isNaN(o)&&(this._defaultXaxisNeeded=!0,t.setAssignedAxisX(-1)),isNaN(u)&&(this._defaultYaxisNeeded=!0,t.setAssignedAxisY(-2))}},getAxisList:function(t){return this.axis[t]},getAxis:function(t){var e=function(e){return e.getIdNoPrefix()===t},i=this.axis.x.find(e);return i||(i=this.axis.y.find(e)),i},addAxis:function(t){t&&(2===t.getDimension()?this.axis.y.push(t):this.axis.x.push(t),void 0===t.getId()&&(t.setId(this._idForAxis),this._idForAxis++))},readFromXML:function(t,i,r){if(t){var o=Date.now();this.name=t.getAttribute("name");var u=e.createProbe("SPY.XYChart.PARSEXML."+this.name);u.begin(),this.distribution=t.getAttribute("Distribution");var h=t.getAttribute("Animation");this.animation="true"===h||"TRUE"===h,this.nameX=t.getAttribute("nameX"),this.nameY=t.getAttribute("nameY"),this.unitX=t.getAttribute("unitX"),this.unitY=t.getAttribute("unitY");var l=t.getAttribute("alignTicks");this.alignTicks="true"===l||"TRUE"===l;var d=t.getAttribute("secondaryAxisGridLines");this.secondaryGridLines="true"===d||"TRUE"===d,this.isBarChart=!0;var c=function(){this.hasPositions=!0;for(var t=0;t<this.listCurves.length&&this.hasPositions;t++){var e=this.listCurves[t];if(e){var a=e.getMetadata();this.hasPositions=a&&a.hasPositions}}if(r&&(r.hasLockableCurves=this.isCrossGroup),this._defaultXaxisNeeded){var n=new s;n.setId(-1),this.addAxis(n);var h=this.listCurves.filter(function(t){return-1===t.getAssignedAxisX()&&t.nameX}),l=h.length>0?h[0].nameX:void 0,d=h.filter(function(t){return t.nameX===l}).length===h.length&&l?l:this.nameX;n.setName(d),n.setUnit(this.unitX?this.unitX:"")}if(this._defaultYaxisNeeded){var c=new s;c.setId(-2),c.setDimension(2),this.addAxis(c);var m=this.listCurves.filter(function(t){return-2===t.getAssignedAxisY()&&t.nameY}),p=m.length>0?m[0].nameY:void 0,f=m.filter(function(t){return t.nameY===p}).length===m.length&&p?p:this.nameY;c.setName(f),c.setUnit(this.unitY?this.unitY:"")}for(var g=this.listCurves.filter(function(t){return t.isStacked}),v=g[g.length-1],S=g.length-2;S>=0;S--)g[S].stack(v),v=g[S];var D=this.getAxisList("y").filter(function(t){return"percentage"===t.getScale()});if(D&&D.length>0){for(var N=D[0].getIdNoPrefix(),C=g.filter(function(t){return t.getAssignedAxisY()===N}),A=C[0],x=1;x<C.length;x++)C[x].ratio(A);A.setTo100()}if(u.end(),this.analytics.dataModelCreationTime=Date.now()-o,this.listCurves.length>0){this.analytics.numberOfCurves=this.listCurves.length;var b=this.listCurves.reduce(function(t,e){return t+e.getValues().length},0);this.analytics.numberOfPointsPerCurve=b/this.analytics.numberOfCurves}if(i){var L=this.listCurves&&this.listCurves.length>0?this:void 0;i(L)}}.bind(this),m=!0,p={counter:0,loopCompleted:!1},f=function(){p.counter--,0===p.counter&&p.loopCompleted&&c()},g=t.children.length;if(1===g&&"ChartAxis"===t.children[0].nodeName)c();else{for(var v=0;v<g;v++){var S=t.children[v];if("Curve"===S.nodeName){m=!1,p.counter++;new a(S,{modelMgr:r.spm,sequence:r.seq},function(t){t.isBarChart||(this.isBarChart=!1),this.addCurve(t),f()}.bind(this))}else if("ChartAxis"===S.nodeName){p.counter++;var D=new s(S,f);this.addAxis(D)}}if(p.loopCompleted=!0,m){this._defaultXaxisNeeded=!0,this._defaultYaxisNeeded=!0,this.isBarChart=!1;for(var N=[],C="",A="",x=r.spm.getDataList("grp",r.seq),b=0;b<g;b++){var L=t.children[b];if("Value"===L.nodeName){var y,T=L.getAttribute("frmId");if(T){y=r.spm.getFrameDetails(r.seq,T).group}else{var _=L.getAttribute("grpId");y=_&&x?x.getEntry(parseInt(_)-1).val:L.getAttribute("group")}if(!y){N=[];break}var M=n.parseGroupIds(y),P=M[0],I=M[1];P===C&&I===A||(N.push({rootName:P,loadName:I}),C=P,A=I)}}if(0===N.length)new a(t,{modelMgr:r.spm,sequence:r.seq},function(t){this.addCurve(t),c()}.bind(this));else{p.counter=0,p.loopCompleted=!1;for(var F=0;F<N.length;F++){var w=N[F];p.counter++;new a(t,{modelMgr:r.spm,sequence:r.seq},function(t){this.addCurve(t),f()}.bind(this),w)}p.loopCompleted=!0,0===p.counter&&c()}}else this._positionsComputed=!0,0===p.counter&&c()}}},computePositions:function(){if(!this._positionsComputed&&this.dd&&this.dd.animationStructure&&this.dd.animationStructure.groupList.length>0){for(var t=0;t<this.listCurves.length;t++){var e=this.listCurves[t];if(e){for(var i=[],a=0;a<this.dd.animationStructure.groupList.length;a++){var s=this.dd.animationStructure.groupList[a];if(s&&s.rootName===e.rootName&&s.loadCaseName===e.loadCaseName){var n=s.frameList;if(n)for(var r=0;r<n.length;r++){var o=n[r];!o||o.isScaledPosition||isNaN(o.position)||i.push(o.position)}}}if(i.length>0){var u=e.getValues();if(i.length===u.length)for(var h=0;h<u.length;h++){var l=u[h];l&&(l.position=i[h])}}}}this._positionsComputed=!0}}});return t.namespace("DS/SPY/CATSimNavDataFrameViewXYChart",r)}),define("DS/SPY/CATSimNavData3DExtremasSet",["DS/SPY/CATSimNavDataSpec","DS/SPY/CATSimNavData3DExtremas","DS/SPY/CATSimNavDataLink"],function(t,e,i){"use strict";var a=t.extend({init:function(t,e,i){this._parent(t,e),this.impl={},this._extremasList=[],this.readFromXML(t,i)},addExtremas:function(t){t&&this._extremasList.push(t)},getExtremas:function(t){for(var e,i=0;i<this._extremasList.length&&!e;i++)this._extremasList[i].getFrameIndex()===t&&(e=this._extremasList[i]);return e},readFromXML:function(t,a){for(var s=function(){for(var i=0,s=0,n=!1,r=function(t){this.addExtremas(t),0===--i&&n&&a(this)}.bind(this),o=0;o<t.children.length;o++){var u=t.children[o];if("Extremas"===u.nodeName){u._extremaFrameIndex=s,s++,i++;new e(u,this.dd,r)}}n=!0,0===i&&a(this)}.bind(this),n=null,r=0;r<t.children.length;r++){var o=t.children[r];if("LinkSet"===o.nodeName&&"ExtremasToPart"===o.getAttribute("role"))for(var u=0;u<o.children.length&&null===n;u++){var h=o.children[u];"InternalRef"===h.nodeName&&(n=h)}}if(n)new i(n,this.dd,function(t){this.addLink("ExtremasToPart",t),s()}.bind(this));else s()}});return UWA.namespace("DS/SPY/CATSimNavData3DExtremasSet",a)}),define("DS/SPY/CATSimNavData3DExtremasRoot",["DS/SPY/CATSimNavDataSpec","DS/SPY/CATSimNavData3DExtremasSet"],function(t,e){"use strict";var i=t.extend({init:function(t,e,i,a){this._parent(t,e),this.impl={},this._extremasSetList=[],this.readFromXML(t,a)},addExtremasSet:function(t){t&&this._extremasSetList.push(t)},getListExtremasSet:function(){return this._extremasSetList},readFromXML:function(t,i){for(var a=0,s=!1,n=function(t){t&&(this.addExtremasSet(t),0===--a&&s&&i&&i())}.bind(this),r=0;r<t.children.length;r++){var o=t.children[r];if("ExtremasSet"===o.nodeName){a++;new e(o,this.dd,n)}}s=!0,0===a&&i()}});return UWA.namespace("DS/SPY/CATSimNavData3DExtremasRoot",i)});