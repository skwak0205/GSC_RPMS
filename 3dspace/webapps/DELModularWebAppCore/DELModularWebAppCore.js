define("DS/DELModularWebAppCore/FacadeBase",["UWA/Core"],function(e){"use strict";return function(t,n,r){if(!r.id)throw new Error("Element id property is not defined module for "+n);return{name:"FacadeBase",_element:r,_moduleName:n,_moduleId:r.id,getElement:function(){return this._element},setProperties:function(n){var r=t.getService("LayoutService");e.is(r)?r.setProperties(this._moduleId,n):t.getLogger().debug("Recipe","LayoutService Not available")},getName:function(){return this._moduleName},getId:function(){return this._moduleId},getPreferenceValue:function(e){var t=widget.getValue(e),n=widget.getPreference(e);if(n)switch(n.type){case"boolean":t=widget.getBool(e);break;case"hidden":"true"===t?t=!0:"false"===t&&(t=!1)}return t},getAppContext:function(){return t.getConfig().appContext},getBehavior:function(e){return t.getBehavior(this.getId(),e)},notify:function(e,n){t.getMediator().notify(e,n,{sourceModuleId:this.getId()})},stop:function(){t.stop(this.getId())},log:function(n,r,o){if(!e.is(r))return t.getLogger().log(this.getId(),n);t.getLogger().log(this.getId(),n,r,o)},debug:function(){Array.prototype.unshift.apply(arguments,[this.getId()]),t.getLogger().debug.apply(null,arguments)},warn:function(){Array.prototype.unshift.apply(arguments,[this.getId()]),t.getLogger().warn.apply(null,arguments)},info:function(){Array.prototype.unshift.apply(arguments,[this.getId()]),t.getLogger().info.apply(null,arguments)},printDuration:function(e,n){return t.getLogger().printDuration(e,n)},printCurrentDateTime:function(e){return t.getLogger().printCurrentDateTime(e)}}}}),define("DS/DELModularWebAppCore/Mediator",["UWA/Core"],function(e){"use strict";return function(t){var n,r=!0,o="",i=[],a=function(n,a,s){return e.is(n)&&o===n?(r=!0,i.unshift({eventName:n,eventData:a,eventInfo:s}),function(){for(var e;i.length>0;)e=i.shift(),t.getLogger().debug("Mediator","App started. Processing event: %s\n",e.eventName),t.getMediator().notify(e.eventName,e.eventData,e.eventInfo)}()):(i.push({eventName:n,eventData:a,eventInfo:s}),t.getLogger().debug("Mediator","App not started. Adding events to Queue: %s\n",n)),!0},s=function(e,n,r){var o,i;if(e.listenTo instanceof Function)for(o in i=e.listenTo())Object.prototype.hasOwnProperty.call(i,n)&&o===n&&(!r||r instanceof Array)&&function(o){try{o.apply(e,r)}catch(e){t.getLogger().debug(t.name,"Exception on event: %s\nMessage: %s\nStack: %s",n,e.message,e.stack)}}(i[n])};return t.getConfig().Mediator&&(n=t.getConfig().Mediator,r=!e.is(n)||!e.is(n.WaitForWidgetLoading)||!n.WaitForWidgetLoading,o=e.is(n.LoadingCompleteEvent)?n.LoadingCompleteEvent:"endLoadingWidget"),{callHandlers:function(e,t,n){return s(e,t,n)},preNotifyValidation:function(e,t,n){var o=!0;return r||(a(e,t,n),o=!1),o},notifyExternalListners:function(e,n){var r=t.getExternalListenerData(e),o=n instanceof Array?n:[n];r instanceof Array&&r.forEach(function(n){try{n&&n.func&&n.func.apply(t,o)}catch(n){t.getLogger().debug(t.name,"Exception on event: %s\nMessage: %s\nStack: %s",e,n.message,n.stack)}})},notifyPlugins:function(e,t){},notifyModuleAndBehaviors:function(e,n){var r=t.getInstance(),o=Object.keys(r),i=n instanceof Array?n:[n];o.forEach(function(t){var n=r[t];n.isStarted&&(n.behaviors instanceof Array&&n.behaviors.forEach(function(t){s(t.instance,e,i)}),s(n.instance,e,i))})},notify:function(e,t,n){this.preNotifyValidation(e,t,n)&&(this.notifyPlugins(e,t),this.notifyModuleAndBehaviors(e,t,n),this.notifyExternalListners(e,t))}}}}),define("DS/DELModularWebAppCore/Logger",["DS/Logger/Logger","UWA/Core","UWA/Date"],function(e,t,n){"use strict";return function(){return{log:function(t){e.getLogger(t).log(Array.prototype.slice.call(arguments,1))},debug:function(t){var n=e.getLogger(t);n.debug.apply(n,Array.prototype.slice.call(arguments,1))},warn:function(t){e.getLogger(t).warn(Array.prototype.slice.call(arguments,1))},info:function(t){e.getLogger(t).info(Array.prototype.slice.call(arguments,1))},error:function(t){var n=e.getLogger(t);n.error.apply(n,Array.prototype.slice.call(arguments,1))},printDuration:function(r,o){var i=n.now()-r.getTime(),a="Duration: ";return t.is(o)&&(a="Duration (for "+o+"): "),e.getLogger().log(a+i+" ms"),i},printCurrentDateTime:function(t){var r=new n;return e.getLogger().log(t+r.toISOString()),r}}}}),define("DS/DELModularWebAppCore/Core",["UWA/Core","UWA/Promise","DS/DELModularWebAppCore/Mediator","DS/DELModularWebAppCore/Logger","DS/DELModularWebAppCore/FacadeBase"],function(e,t,n,r,o){"use strict";return function(i){var a,s={},u={},c={},f={},d=new r,l=-1,g={},p=function(e,n,r){var o,i,a=e[n];return r=r||{},i=isNaN(r.asyncLength)?-1:r.asyncLength,o=r.arguments instanceof Array?r.arguments:[],new t(function(t,r){var s=!1;if("function"==typeof a)try{i===a.length?(o.push(function(){t(),s=!0}),a.apply(e,o),setTimeout(function(){var t=e.name?e.name:"";try{if(!s)throw new Error("Timeout: No response within specified time period")}catch(e){d.error("Core","Exception calling method: %s, Instance: %s\nMessage: %s\nStack: %s",n,t,e.message,e.stack)}},2e4)):(a.apply(e,o),t())}catch(e){d.error("Core","Exception calling method: %s\nMessage: %s\nStack: %s",n,e.message,e.stack),r()}else t()})},h=function(e,t){var n=i.require[e],r={},o=[];if(!n)throw new Error(e+" map is not defined in app config");return t.forEach(function(t){var i=n[t];if(!i)throw new Error("Path to "+e+" "+t+" is not defined");o.push(i),r[i]=t}),{paths:o,nameMap:r}},v=function(e){return e?u[e]:u},y=function(e){return e?s[e]:s},m=function(e){var t=[];return e?e instanceof Array?(e.forEach(function(e){var n=c[e];if(!n)throw new Error("Plugin "+e+" was not found");t.push(n)}),t):c[e]:c},S=function(e){return e?f[e]:f},b=function(e,t){Object.prototype.hasOwnProperty.call(f,e)?d.debug("Core","Service: %s is already registered",e):f[e]={instance:t,isStarted:!1}},E=function(e,t){Object.prototype.hasOwnProperty.call(c,e)?d.debug("Core","Plugin: %s is already registered",e):c[e]={instance:t,isStarted:!1}},L=function(e,t,n){var r,o=h("plugin",t);(r=o.paths.filter(function(e){return!m(o.nameMap[e])})).length>0?require(r,function(){var t,i,a,s,u;for(t=0;t<arguments.length;t++){if(u=arguments[t],s=r[t],i=o.nameMap[s],!u)throw new Error("Plugin "+i+" was not loaded");m(i)||(a=new u(e),E(i,a))}n()}):n()};return i||(i={require:{}}),{getConfig:function(){return i},getLogger:function(){return d},getMediator:function(){return a||(a=new n(this)),a},getInstance:function(e){return v(e)},getBehavior:function(e,t){var n,r=v(e);return r&&r.behaviors.some(function(e){return e.id===t&&(n=e.instance,!0)}),n},getPlugins:function(e){return m(e)},getService:function(t){var n,r=S(t);return e.is(r)&&r.instance&&(n=r.instance),n},getAllServiceNames:function(){var e=S();return Object.keys(e)},getExternalListenerData:function(t){return t?e.clone(g[t]):e.clone(g)},addExternalListener:function(e,t){var n;if(e&&t)return g[e]instanceof Array||(g[e]=[]),n=(++l).toString(),g[e].push({token:n,func:t}),n},addExternalListenerOnce:function(e,t){var n,r=this;n=this.addExternalListener(e,function(e){r.removeExternalListener(n),t.call(this,e)})},removeExternalListener:function(e){var t,n,r,o=!1;if(!e)return o;for(t in g)if(g[t])for(n=0,r=g[t].length;n<r;n++)g[t][n]&&g[t][n].token===e&&(g[t].splice(n,1),o=!0,r--);return o},createModule:function(t,n,r,i){var a,c,f=this,l=y(t),g=function(a,c){var l;!function(e,t,n){y(e)?d.debug("Core","Module: %s is already registered",e):s[e]={creator:t,behaviorNames:n,counter:0}}(t,a,c),l=y(t),function(t){return!!e.is(t)&&-1===Object.keys(u).indexOf(t)}(n)?r.id=n:r.id="mod-"+t+"-"+l.counter,l.counter++,function(e,t,n,r,i){var a=h("behavior",r),s=new o(e,t,n),u=[];require(a.paths,function(){var t,n,o,c,f,l;if(arguments.length>0)for(t=0;t<arguments.length;t++){if(n=arguments[t],f=a.paths[t],l=a.nameMap[f],!n)throw new Error("Behavior "+l+" was not loaded");o=n.creator,(c=n.plugins)instanceof Array||(d.error("Core","%s (behavior) plugins property is not an array",l),c=[]),function(t,n,o){L(e,t,function(){var a=m(t).map(function(e){return e.instance}),c=[null,e,s].concat(a),f=new(Function.prototype.bind.apply(n,c));if(u.push({name:o,pluginNames:t,instance:f,isStarted:!1}),u.length!==r.length)return!1;i(s,u)})}(c,o,l)}else i(s)})}(f,t,r,c,function(n,o){var s,f,l=[],g=[],p={};c.forEach(function(e,t){var n=!1;if(o.some(function(r,o){if(isNaN(p[r.name])&&(p[r.name]=1),r.name===e){if(-1===g.indexOf(o))return g.push(o),r.id=p[e]>1?r.name+"-"+p[e]:r.name,n=!0,r.index=t,!0;p[r.name]+=1}return!1}),!n)throw new Error("Behavior: "+e+" was not instantiated")}),o instanceof Array&&(o.sort(function(e,t){return e.index-t.index}),l=o.map(function(e){return e.instance})),s=[null,n].concat(l),f=new(Function.prototype.bind.apply(a,s)),function(t,n,r,o){if(!e.is(n.id))throw new Error("Element Id is not defined for module: "+t);u[n.id]?d.debug("Core","Module instance of %s is already registered",t):u[n.id]={instance:r,behaviors:o,moduleName:t,element:n,isStarted:!1}}(t,r,f,o),i&&i(r.id)})};l?(r.id&&(a=v(r.id)),a?i&&i(r.id):g(l.creator,l.behaviorNames)):(c=h("module",[t]),require(c.paths,function(e){e.behaviors instanceof Array||(d.error("Core","%s behaviors property is not an array",t),e.behaviors=[]),g(e.creator,e.behaviors)}))},isStarted:function(e){var t=v(e),n=!1;return t&&(n=t.isStarted),n},isServiceStarted:function(e){var t=S(e),n=!1;return t&&(n=t.isStarted),n},start:function(e,n,r){var o,i,a=function(e){var t,n=u[e];return n&&(t=n.moduleName),t}(e),s="function"==typeof r?r:null,c=n||{},f=[],l=function(){d.printDuration(o,"Module Name: "+a+", Module Id: "+e),d.debug("Core","Module %s (module Id: %s) started successfully.",a,e),"function"==typeof s&&s.call(null,[{status:"OK",name:a,id:e}])},g=function(){var t=Array.prototype.slice.call(arguments);t.unshift("Core"),d.error.apply(d,t),"function"==typeof s&&s.call(null,[{status:"KO",name:a,id:e}])};a&&y(a)?this.isStarted(e)||(o=d.printCurrentDateTime("Module Name:"+a+", Module Id:"+e+" START - "),(i=v(e)).behaviors instanceof Array&&(i.behaviors.forEach(function(e){m(e.pluginNames).forEach(function(e){var t;e.isStarted||(e.onStartPromise?t=e.onStartPromise:(t=p(e.instance,"onStart",{asyncLength:1}).then(function(){e.isStarted=!0,e.onStartPromise&&delete e.onStartPromise}),e.onStartPromise=t),f.push(t))})}),t.all(f).then(function(){var n=[];i.behaviors.forEach(function(e){var t;e.isStarted||(t=p(e.instance,"onStart",{arguments:[c],asyncLength:2}),n.push(t),e.isStarted=!0)}),t.all(n).then(function(){i.isStarted=!0,p(i.instance,"onStart",{arguments:[c],asyncLength:2}).then(l,function(){g("Failed to start module.\nModule Name: %s \nModule Id: ",a,e)})},function(){g("Failed to start module (as behavior failed to start). \nModule Name: %s \nModule Id: %s",a,e)})},function(){g("Failed to start module (as plugin failed to start). \nModule Name: %s \nModule Id: %s",a,e)}))):g("Cannot start module: %s, it needs to be created before",e)},startService:function(e){var t,n=S(e);if(n&&n.instance)return n.isStarted?void 0:(t=d.printCurrentDateTime("Service Name:"+e+" START - "),p(n.instance,"onStart",{asyncLength:1}).then(function(){n.isStarted=!0,d.printDuration(t,"Service Name: "+e),d.debug("Core","Service %s started successfully.",e)},function(){d.debug("Core","Service %s failed to start.",e)}));d.error(this.name,"Cannot start service: %s, it needs to be created before",e)},startAll:function(){var e=this,t=Object.keys(u),n=arguments;t.forEach(function(t){e.start(t,n)})},startAllServices:function(e){var n=this,r=0,o=t.resolve(),i=Object.keys(f);i.forEach(function(t){o=o.then(function(){return n.startService(t)}).then(function(){++r===i.length&&"function"==typeof e&&e.apply(null,null)}).catch(function(e){throw new Error("Failed to load the service "+i[r]+" Error description: "+e)})})},stop:function(e){var t=v(e);if(!t)return d.error(this.name,"Error stopping module instance: %s",e),!1;this.isStarted(e)&&(t.behaviors.forEach(function(e){e.isStarted&&(p(e.instance,"onStop"),e.isStarted=!1)}),p(t.instance,"onStop"),t.isStarted=!1)},stopAll:function(){var e,t=this,n=Object.keys(f),r=Object.keys(c),o=Object.keys(u);n.forEach(function(t){(e=S(t))&&(p(e.instance,"onStop"),e.isStarted=!1)}),o.forEach(function(e){t.stop(e)}),r.forEach(function(t){(e=m(t))&&e.isStarted&&(p(e.instance,"onStop"),e.isStarted=!1)})},end:function(e){this.stop(e),v(e)&&delete u[e]},endAll:function(){var e=this;Object.keys(u).forEach(function(t){e.end(t)})},useServices:function(e,t,n){var r,o=this,i=n,a=h("service",e);(r=a.paths.filter(function(e){return!S(a.nameMap[e])})).length>0?require(r,function(){var e,n,s,u,c;for(e=0;e<arguments.length;e++){if(c=arguments[e],u=r[e],n=a.nameMap[u],!c)throw new Error("Service "+n+" was not loaded");S(n)||(s=new c(o,i),b(n,s))}o.startAllServices(t)}):o.startAllServices(t)},updateAppContext:function(t){var n=t||{};e.is(i)&&e.is(i.appContext)&&(i.appContext=e.extend(i.appContext,n,!0))}}}});