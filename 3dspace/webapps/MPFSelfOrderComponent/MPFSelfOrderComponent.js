define("DS/MPFSelfOrderComponent/SubscriptionTypeTile",["UWA/Core","UWA/Class/View","DS/MPFServices/ObjectService","DS/MPFUtils/FormatUtils","DS/MPFPortfolioModel/PortfolioModel","i18n!DS/MPFSelfOrderComponent/assets/nls/SelfOrderSubscriptionComponent","css!DS/MPFSelfOrderComponent/MPFSelfOrderComponent"],function(e,t,i,r,n,o){"use strict";var s,a={};return a.SELECT="selected",(s=t.extend({className:"mpf-subscription-type-tile",domEvents:{click:"_onClick"},setup:function(e){i.requiredOfPrototype(e.portfolio,n,"options.portfolio must be a PortfolioModel"),this.portfolio=e.portfolio,this.selected=!0===e.selected,this.disabled=!0===e.disabled,this.locale=e.locale||"en-US"},render:function(){var e=this.portfolio.getPriceList()[0].monthlyDisplay,t=[{tag:"div",class:"mpf-type-name",text:"YSC"===this.portfolio.get("licensingScheme")?o.get("yearly"):o.get("quarterly")},{tag:"div",class:"mpf-price",text:e.toLocaleString(this.locale,{style:"currency",currency:this.portfolio.getPricelistCurrency()})},{tag:"div",class:"mpf-info-label",text:o.get("perMonth")},{tag:"div",class:"mpf-info-label",text:o.get("excludingTaxes")}];return this.container.setContent(t),this.selected?this.container.addClassName("selected"):this.container.removeClassName("selected"),this.disabled?this.container.addClassName("disabled"):this.container.removeClassName("disabled"),this},_onClick:function(){this.disabled||this.selected||this.dispatchEvent(a.SELECT,this)},enable:function(){this.disabled=!1,this.render()},disable:function(){this.disabled=!0,this.render()},select:function(){this.selected=!0,this.render()},deselect:function(){this.selected=!1,this.render()},destroy:function(){this.cart=null,this._parent(),this.container=null}})).Events=Object.freeze(a),s}),define("DS/MPFSelfOrderComponent/TokenComponent",["UWA/Class/View","UWA/Core","UWA/Promise","DS/UIKIT/Mask","DS/UIKIT/Alert","DS/UIKIT/Input/Button","DS/MPFServices/ObjectService","DS/MPFTokenModel/TokenModel","DS/Usage/TrackerAPI","i18n!DS/MPFSelfOrderComponent/assets/nls/SelfOrderSubscriptionComponent","css!DS/MPFSelfOrderComponent/MPFSelfOrderComponent"],function(e,t,i,r,n,o,s,a,c,l){"use strict";var d,h={},u={};return h.TOKEN_OK="tokenOk",h.DEPLOY_IN_PROGRESS="deployInProgress",u.TOKEN_TENTATIVE="TokenTentative",u.TOKEN_SUCCESS="TokenSuccess",u.TOKEN_FAILURE="TokenFailure",(d=e.extend({className:"mpf-self-order-token",setup:function(e){e||(e={}),this._parent(e),this._checkPrototypes(e),this.token=e.token,this.eligibilityMessage=this._createEligibilityMessage(),this.validateButton=this._createValidateButton(),this.alert=this._createAlert()},render:function(){return this.container.setContent([this._createTokenContainer(),this.helpMessage]),this._validateToken(),this},_displayErrorMessage:function(e){var t=e.error,i=e.classNameMsg;this.container.setContent(this.alert),this.alert.show(),this.alert.add({className:i||"warning",message:t&&t.message||l.get("errorTokenOops")})},_validateToken:function(){var e;return e=this.container.getElement(".mpf-self-order-token-message-error"),t.is(e)&&e.remove(),this.tokenValidationRetries=0,this.tokenFirstTry=Date.now(),this._sendTrackingEvent(u.TOKEN_TENTATIVE,{tentativeNumber:this.tokenValidationRetries}),r.mask(this.validateButton.elements.container),this._saveTokenPulling()},_saveTokenPulling:function(e){var t=this;this.token.savePromise().then(this._handleValidationErrorCode.bind(this)).catch(function(e){t._displayErrorMessage(e)}).finally(function(){r.unmask(t.validateButton.elements.container)})},_handleValidationErrorCode:function(){var e;switch(this.token.getProcessingCode()){case 0:this._sendTrackingEvent(u.TOKEN_SUCCESS),this.dispatchEvent(h.TOKEN_OK),e=i.resolve();break;case 11:this.tokenValidationRetries+=1,this.tokenValidationRetries>10?(this._sendTrackingEvent(u.TOKEN_FAILURE,{error:"errorTokenMaxRetries"}),e=i.reject({error:new Error(l.get("errorTokenOops"))})):e=new i(function(e){window.setTimeout(e,2e3)}).then(this._sendTrackingEvent.bind(this,u.TOKEN_TENTATIVE,{tentativeNumber:this.tokenValidationRetries})).then(this.token.savePromise.bind(this.token)).then(this._handleValidationErrorCode.bind(this));break;case 4:case 5:case 6:case 7:case 8:case 14:this._sendTrackingEvent(u.TOKEN_FAILURE,{error:"errorTokenPlatformExists"}),e=i.reject({error:new Error(l.get("errorTokenPlatformExists"))});break;case 1:case 2:case 3:case 9:case 10:case 12:case 13:this._sendTrackingEvent(u.TOKEN_FAILURE,{error:"errorTokenOops"}),e=i.reject({error:new Error(l.get("errorTokenOops"))});break;case 15:this._sendTrackingEvent(u.TOKEN_FAILURE,{error:"userNotAdmin"}),e=i.reject({error:new Error(l.get("userNotAdmin"))});break;case 16:this._sendTrackingEvent(u.TOKEN_FAILURE,{error:"deployInProgress"}),e=i.resolve(),this.dispatchEvent(h.DEPLOY_IN_PROGRESS),this.validateButton.hide();break;default:this._sendTrackingEvent(u.TOKEN_FAILURE,{error:"errorCodeNotSupported"}),e=i.reject({error:new Error(l.get("errorTokenOops"))})}return e},_createAlert:function(){return new n({messageClassName:"warning",visible:!0,maximumVisibleMessages:1,closeOnClick:!1})},_createTokenContainer:function(){var e,i;return-1===window.location.href.indexOf("thank-for-purchasing")?(e="mpf-self-order-token-value",i=[this.eligibilityMessage,this.validateButton]):(e="mpf-self-order-token-value center",i=this.validateButton),t.createElement("div",{class:e,html:i})},_createValidateButton:function(){return new o({className:"primary",value:l.get("validate"),events:{onClick:this._validateToken.bind(this)}})},_createEligibilityMessage:function(){return t.createElement("div",{class:"mpf-self-order-token-message",text:l.get("eligibilityCodeMsg")})},_checkPrototypes:function(e){s.requiredOfPrototype(e.token,a,"options.token must be a TokenModel")},destroy:function(){this.stopListening(),this.token=null,this._parent(),this.container=null},_sendTrackingEvent:function(e,t){var i={},r={};t||(t={}),this.token&&(i.pd1=this.token.getToken()),t.error&&(i.pd6=t.error),this.tokenValidationRetries>=0&&(r.pv1=this.tokenValidationRetries),this.tokenFirstTry>0&&(r.pv2=Date.now()-this.tokenFirstTry),c.trackPageEvent({eventCategory:"Ifweloop",eventAction:e,persDim:i,persVal:r})}})).Events=Object.freeze(h),d}),define("DS/MPFSelfOrderComponent/SelfOrderComponent",["UWA/Class/View","UWA/Core","DS/MPFServices/ObjectService","DS/MPFUtils/MPFUtils","DS/MPFPortfolioModel/PortfolioFactory","DS/MPFPortfolioModel/PortfolioCollection","DS/MPFPortfolioCardComponent/PortfolioCardComponent","DS/MPFFiniteStateMachine/FiniteStateMachine","DS/MPFView/EmptyView","DS/Usage/TrackerAPI","i18n!DS/MPFSelfOrderComponent/assets/nls/SelfOrderSubscriptionComponent","css!DS/MPFSelfOrderComponent/MPFSelfOrderComponent"],function(e,t,i,r,n,o,s,a,c,l,d){"use strict";const h=Object.freeze({BUY:"buy"}),u=Object.freeze({LIST_VIEW:"listView",MORE_INFORMATION_PAGE:"pageDetails"}),p=Object.freeze({PATH:"/portfolio/more-info",PAGE_TITLE:"ProductInfo"}),f=e.extend({className:"mpf-self-order",setup:function(e){e||(e={}),this._parent(e),this._checkPrototypes(e),this.portfolios=e.portfolios,this.portfolioRoleFactory=e.portfolioRoleFactory,this.displayFooter=!1!==e.displayFooter,this.serviceViewFactory="function"==typeof e.serviceViewFactory?e.serviceViewFactory:r.doNothing,this.cards=this._createCards(),this.stateMachine=this._createStateMachine(),this.moreInformationPage=c.getInstance(),this.backArrow=this._createBackArrow(),this.thankForPurchase=this._createThankForPurchase()},render:function(){let e,i;switch(this.stateMachine.getState()){case u.MORE_INFORMATION_PAGE:this.container.addClassName("moreInfo"),this.container.setContent([this.backArrow,this.moreInformationPage.render()]);break;default:this.container.removeClassName("moreInfo"),i=[e=t.createElement("div",{class:"mpf-self-order-cards",html:this.cards.map(function(e){return e.render()})})],window.location.search.indexOf("thank-for-purchasing")>-1&&i.splice(0,0,this.thankForPurchase),this.displayFooter&&i.push(this._getInfoOnPrices()),this.container.setContent(i)}return this},displayThankYouMsg:function(){this.thankForPurchase.inject(this.container,"top")},onMoreInformation:function(e){this.stateMachine.changeState(u.MORE_INFORMATION_PAGE)&&(this.moreInformationPage=this.serviceViewFactory({portfolioRoleFactory:this.portfolioRoleFactory,portfolio:e.portfolio,detailedView:!0})||c.getInstance(),this.render(),this._sendTrackingPage(p.PATH,p.PAGE_TITLE,e))},onListView:function(){this.stateMachine.changeState(u.LIST_VIEW)&&this.render()},_getInfoOnPrices:function(){return t.createElement("div",{class:"mpf-self-order-prices-info",html:[{tag:"p",html:d.get("pricesInfo1")},{tag:"p",text:d.get("pricesInfo2")}]})},_dispatchEvent:function(e,t){this.dispatchEvent(e,t)},_createCards:function(){const e=this;return this.portfolios.map(function(t){const i=e.serviceViewFactory({portfolioRoleFactory:e.portfolioRoleFactory,portfolio:t,detailedView:!1}),r=new s({serviceView:i,portfolio:t,displayFooter:e.displayFooter});return e.listenTo(r,s.Events.BUY,e._dispatchEvent.bind(e,h.BUY)),e.listenTo(r,s.Events.MORE_INFORMATION,e.onMoreInformation.bind(e)),r})},_checkPrototypes:function(e){i.requiredOfPrototype(e.portfolioRoleFactory,n,"options.portfolioRoleFactory must be a PortfolioFactory"),i.requiredOfPrototype(e.portfolios,o,"options.portfolios must be a PortfolioCollection")},destroy:function(){this.stopListening(),this.portfolios=null,this.portfolioRoleFactory=null,this._parent(),this.container=null},_createBackArrow:function(){return t.createElement("div",{class:"mpf-back-arrow fonticon fonticon-chevron-left",events:{click:this.onListView.bind(this)}})},_createStateMachine:function(){return new a({state:u.LIST_VIEW,states:[u.LIST_VIEW,u.MORE_INFORMATION_PAGE],transitions:[{from:u.LIST_VIEW,to:u.MORE_INFORMATION_PAGE},{from:u.MORE_INFORMATION_PAGE,to:u.LIST_VIEW}]})},_createThankForPurchase:function(){const e=t.createElement("span",{text:d.get("solutionBeingDeployed")});return t.createElement("div",{class:"mpf-thank-for-your-purchase",html:e})},_sendTrackingPage:function(e,t,i){const r={},n=i.portfolio;n&&(r.pd2=n.getPortfolioName(),r.pd3=n.getProductName(),r.pd4=n.getProductTrigram(),r.pd5=n.getSkuId(),r.pd6=n.getLicensingScheme(),r.pd7=n.getListedPrice(),r.pd8=n.getCurrencies().currency),l.trackPageView({pageURL:e+window.location.search,pageTitle:t,persDim:r})}});return f.Events=Object.freeze(h),f}),define("DS/MPFSelfOrderComponent/SubscriptionCartHelper",["DS/MPFCartModel/CartPatchArray","DS/MPFCartModel/CartPatchOperation","DS/MPFCartModel/CartModel","DS/MPFCartModel/CartItemModel","DS/MPFUtils/MPFUtils"],function(e,t,i,r,n){"use strict";var o={saveSubscription:function(o,s,a){var c,l,d={};return d[r.Fields.SKU_ID]=s.get("skuid"),d[r.Fields.LICENSING]=s.get("licensing"),d[r.Fields.LICENSING_SCHEME]=s.get("licensingScheme"),d[r.Fields.PRODUCT_DISPLAY_NAME]=s.get("productDisplayName"),d[r.Fields.PRODUCT_TRIGRAM]=s.get("productTrigram"),d[r.Fields.PRODUCT_NUMBER]=s.get("productNumber"),d[r.Fields.ACTION]=o.getActionType()||i.ActionTypes.START,d[r.Fields.UNIT_NET_AMOUNT]=s.getPricelistPrice().toString(),d[r.Fields.TYPE]=o.get(i.Fields.TYPE)||i.Types.SOFTWARE_REQUEST,d[r.Fields.QUANTITY]=a,d[r.Fields.TEMP_UUID]=n.generateUUID(),c=new e,l=new t(t.Operations.add,"/cart-items",d),c.add(l),o.megaPatch(c)},getModifyQuantityItems:function(i,r){var n;return n=new e,i.getItems().forEach(function(e){var i;i=new t(t.Operations.MODIFY,"/cart-items/"+e.id,{Quantity:parseInt(r)}),n.add(i)}),i.megaPatch(n)}};return o}),define("DS/MPFSelfOrderComponent/SelfOrderSubscriptionComponent",["UWA/Core","UWA/Class/View","DS/UIKIT/Alert","DS/UIKIT/Mask","DS/UIKIT/Input/Number","DS/UIKIT/Input/Button","DS/Usage/TrackerAPI","DS/MPFServices/MarketplaceServices","DS/MPFServices/ObjectService","DS/MPFPortfolioModel/PortfolioModel","DS/MPFPortfolioModel/PortfolioCollection","DS/MPFCartModel/CartModel","DS/MPFCartModel/CartItemModel","DS/MPFCartModel/CartItemFactory","DS/MPFUtils/FormatUtils","DS/MPFSelfOrderComponent/SubscriptionCartHelper","DS/MPFClickAndBuyComponent/ClickAndBuyCartHelper","DS/MPFSelfOrderComponent/SubscriptionTypeTile","i18n!DS/MPFSelfOrderComponent/assets/nls/SelfOrderSubscriptionComponent","css!DS/MPFSelfOrderComponent/MPFSelfOrderComponent"],function(e,t,i,r,n,o,s,a,c,l,d,h,u,p,f,m,T,g,_){"use strict";var P={YEARLY:"yearly",QUARTERLY:"quarterly"},C={};C[l.RevTypes.YSC]=P.YEARLY,C[l.RevTypes.QSC]=P.QUARTERLY,C[l.RevTypes.QRC]=P.QUARTERLY;var E,v={SUBSCRIPTION_CHANGED:"subscriptionChanged",QUANTITY_CHANGED:"quantityChanged",PROCEED_TO_PAYMENT:"proceedToPayment",SAVING_ERROR:"savingError",BACK:"back",ADDED_TO_CART:"addedToCart"},S={};return S.QUANTITY_CHANGED="QuantityChanged",S.PERIODICITY_CHANGED="PeriodicityChanged",(E=t.extend({className:"mpf-self-order-subscription-component",setup:function(e){c.requiredOfPrototype(e.portfolios,d,"options.portfolios must be a PortfolioCollection"),c.requiredOfPrototype(e.cart,h,"options.cart must be a CartModel"),this.portfolios=e.portfolios,this.cart=e.cart,this.selectedPortfolio=e.selectedPortfolio||this.portfolios.at(0),this.quantity=e.quantity||1,this.locale=e.locale||"en-US",this.service=e.service||a.IFWELOOP,this.alert=this._createAlert(),this.productNameContainer=this._createProductNameContainer(),this.typeTiles=this._createTypeTiles(),this.numberInput=this._createNumberInput(),this.backButton=this._createBackButton(),this.paymentButton=this._createPaymentButton(),this.addToCartButton=this._createAddToCartButton()},render:function(){var e;return e=this.service===a.CLICK_AND_BUY?[this._renderTopContainer(),this._renderBottomContainer()]:[this.productNameContainer,this._renderTopContainer(),this._getInfoOnPrices(),this._renderBottomContainer()],this.container.setContent(e),this._sendTrackingPage(),this},_renderTopContainer:function(){return e.createElement("div",{class:"mpf-top",html:[this.alert,this._renderSubscriptionTypeSection(),this._renderQuantitySection(),this._renderPriceSection()]})},_renderBottomContainer:function(){var t;return t=e.createElement("div",{class:"mpf-button-container",html:this.service===a.CLICK_AND_BUY?this.addToCartButton:[this.backButton,this.paymentButton]}),e.createElement("div",{class:"mpf-bottom",html:[this._renderTotalOrderSection(),t]})},_getInfoOnPrices:function(){return e.createElement("div",{class:"mpf-self-order-prices-info",html:[{tag:"p",html:_.get("pricesInfo1")},{tag:"p",text:_.get("pricesInfo2")}]})},destroy:function(){this.stopListening();for(var e=0;e<this.typeTiles.length;e++)this.typeTiles[e].destroy();this.portfolios=null,this.cart=null,this.selectedPortfolio=null,this._parent(),this.container=null},activatePaymentButton:function(){this.paymentButton.enable()},_onTileSelection:function(e){for(var t=0;t<this.typeTiles.length;t++)this.typeTiles[t]===e?(this.typeTiles[t].select(),this.selectedPortfolio=this.typeTiles[t].portfolio):this.typeTiles[t].deselect();this._updateDisplayedPrices(),this.dispatchEvent(v.SUBSCRIPTION_CHANGED,this.selectedPortfolio),this._sendTrackingEvent(S.PERIODICITY_CHANGED,this.selectedPortfolio.get("licensingScheme"))},_changeQuantity:function(e){var t;t=parseInt(e.target.value)-this.quantity>0?"added":"removed",this.quantity=parseInt(e.target.value),this._updateDisplayedPrices(),this.dispatchEvent(v.QUANTITY_CHANGED,this.quantity),this._sendTrackingEvent(S.QUANTITY_CHANGED,t,this.quantity)},_updateDisplayedPrices:function(){var e=this.container.getElement(".mpf-price-section-content"),t=this.container.getElement(".mpf-total-order-section .mpf-price");e&&e.setHTML(this._renderTotalPriceContent()),t&&t.setText(this._renderTotalOrderContent())},_proceedToPayment:function(){var e=this;return r.mask(this.container),this._saveItemsOnTheCart().then(this._patchCartInSubmittedState.bind(this)).then(r.unmask.bind(this,this.container)).then(this.paymentButton.disable.bind(this.paymentButton)).then(this.dispatchEvent.bind(this,v.PROCEED_TO_PAYMENT,this.cart)).catch(function(t){console.log(t),r.unmask(e.container),e.alert.add({className:"error",message:_.get("savingError")}).show(),e.dispatchEvent(v.SAVING_ERROR,t)})},_addToCart:function(){this.dispatchEvent(v.ADDED_TO_CART,{selectedPortfolio:this.selectedPortfolio,quantityAddedToCart:this.quantity})},_patchCartInSubmittedState:function(){var e={};return e[h.Fields.STATE]=h.States.SUBMITTED,this.cart.savePromise(e,{patch:!0})},_saveItemsOnTheCart:function(){return this.cart.getItems().length>0?m.getModifyQuantityItems(this.cart,this.quantity):m.saveSubscription(this.cart,this.selectedPortfolio,this.quantity)},_renderSubscriptionTypeSection:function(){return[{tag:"div",class:"mpf-type-section-label",text:_.get("subscriptionType")},{tag:"div",class:"mpf-type-tile-container",html:this._renderTypeTiles()}]},_renderTypeTiles:function(){for(var e=[],t=0;t<this.typeTiles.length;t++)e.push(this.typeTiles[t].render());return e},_renderQuantitySection:function(){return[{tag:"div",class:"mpf-section-label mpf-quantity-section-label",text:_.get("quantity")},{tag:"div",class:"mpf-section-content mpf-quantity-section-content",html:[this.numberInput]}]},_renderPriceSection:function(){return[{tag:"div",class:"mpf-section-label mpf-price-section-label",text:_.get("totalPrice")},{tag:"div",class:"mpf-section-content mpf-price-section-content",html:this._renderTotalPriceContent()}]},_renderTotalPriceContent:function(){var t=this.selectedPortfolio.getPriceList()[0].monthlyDisplay;return e.createElement("span",{text:f.formatPrice(this.quantity*t,{locale:this.locale,currency:this.selectedPortfolio.getPricelistCurrency()}),styles:{"font-weight":"bold"}}).outerHTML+" "+_.get("perMonthExcludingTaxes")},_renderTotalOrderSection:function(){return e.createElement("div",{class:"mpf-total-order-section",html:[{tag:"span",class:"mpf-label",text:_.get("totalOrderExclTax")},{tag:"span",class:"mpf-price",text:this._renderTotalOrderContent()}]})},_renderTotalOrderContent:function(e){var t=this.selectedPortfolio.getPricelistPrice();return f.formatPrice(this.quantity*t,{locale:this.locale,currency:this.selectedPortfolio.getPricelistCurrency()})},_createProductNameContainer:function(){return e.createElement("div",{class:"mpf-portfolio-display-name",text:this.portfolios.first().get("productDisplayName")})},_createAlert:function(){return new i({visible:!1,autoHide:!0,closeOnClick:!0})},_createTypeTiles:function(){var e=this,t=[];return this.portfolios.forEach(function(i){var r=new g({portfolio:i,selected:i===e.selectedPortfolio,disabled:e._isTileDisabled(i)});e.listenTo(r,g.Events.SELECT,e._onTileSelection.bind(e,r)),t.push(r)}),t},_isTileDisabled:function(e){var t;return t=this.cart.getItems(),this.service===a.CLICK_AND_BUY&&t.length>0&&t[0].getLicensingScheme()!==e.get("licensingScheme")},_createNumberInput:function(){return new n({min:1,step:1,max:this.service===a.CLICK_AND_BUY?99999:100,decimalPrecision:1,value:this.quantity,events:{onChange:this._changeQuantity.bind(this)}})},_createBackButton:function(){return new o({value:_.get("back"),events:{onClick:this.dispatchEvent.bind(this,v.BACK)}})},_createPaymentButton:function(){return new o({className:"primary",value:_.get("proceedToPayment"),events:{onClick:this._proceedToPayment.bind(this)}})},_createAddToCartButton:function(){return new o({className:"primary",value:_.get("addToCart"),events:{onClick:this._addToCart.bind(this)}})},_sendTrackingPage:function(){s.trackPageView({pageURL:"/configurator",pageTitle:"Configurator",persDim:this._createTrackingDimensions(),persVal:this._createTrackingValues()})},_sendTrackingEvent:function(e,t,i){s.trackPageEvent({eventCategory:"Cart",eventAction:e,eventLabel:t,eventValue:i,persDim:this._createTrackingDimensions(),persVal:this._createTrackingValues()})},_createTrackingDimensions:function(){var e={};return this.service&&(e.pd1=this.service),this.cart&&(e.pd2=this.cart.getName()),this.cart&&(e.pd3=this.cart.getOwnerId()),e.pd4="company",this.cart&&(e.pd5=this.cart.get("shopID")),this.cart&&this.cart.getCurrency()&&(e.pd7=this.cart.getCurrency()),this.cart&&(e.pd9=this._getProductList()),e},_createTrackingValues:function(){var e={};return this.cart&&(e.pv1=this.cart.getNetAmountTotal()),this.cart&&(e.pv2=this.cart.getTaxesAmountTotal()),e},_getProductList:function(){var e="";return this.cart.getItems().forEach(function(t){e+=t.get("ProductTrigram")+","}),e}})).Subscriptions=Object.freeze(P),E.Events=Object.freeze(v),E});