define("DS/UrbanAPI/xCityUndergroundMode",["DS/UrbanTool/Utils"],function(e){function t(e){this.state=Object.create(null),this.properties={enabled:{type:"boolean",default:!0}}}return t.prototype=Object.create(null),Object.defineProperties(t.prototype,{_checkUndergroundVisu:{enumerable:!1,value:function(){this._sceneRenderer.ugVisu||this._sceneRenderer.createUgVisu()}},__sceneRenderer:{enumerable:!1,writable:!0,value:void 0},_sceneRenderer:{enumerable:!1,set:function(e){void 0===e||!1===this.enabled?(this._disable(),this.__sceneRenderer=e):"object"==typeof e&&!0===this.enabled&&(this.__sceneRenderer=e,this._enable())},get:function(){return this.__sceneRenderer}},_isCurrentMode:{enumerable:!1,get:function(){return void 0!==this._sceneRenderer}},enabled:{set:function(e){if(e!==this.state.enabled){if(!0!==e&&!1!==e)throw new Error("xCityUndergroundAPI : enabled only accepts boolean values");this.state.enabled=e,this._isCurrentMode&&(!0===e?this._enable():this._disable())}},get:function(){return this.state.enabled}},state:{enumerable:!1,value:{},writable:!0},_initParams:{enumerable:!1,value:function(e){Object.keys(this.properties).forEach(t=>{this[t]=void 0!==e[t]?e[t]:this.properties[t].default})}},_isParameterValueOK:{enumerable:!1,value:function(e,t){let i=this.properties[e];switch(i.type){case"boolean":if(!0===t||!1===t)return!0;throw new Error("xCityUndergroundAPI : "+e+" only accepts boolean values. Specified : "+t);case"number":let n=void 0!==i.max,r=void 0!==i.min;if("number"!=typeof t)throw new Error("xCityUndergroundAPI : "+e+" only accepts number values Specified : "+t);if(n&&t>i.max)throw new Error("xCityUndergroundAPI : "+e+" parameter has max value "+i.max+" Specified : "+t);if(r&&t<i.min)throw new Error("xCityUndergroundAPI : "+e+" parameter has min value "+i.min+" Specified : "+t);return!0;default:throw new Error("xCityUndergroundAPI internal parameter check error.")}}}}),t}),define("DS/UrbanAPI/xCityError",["DS/XCityTools/Debug"],function(e){"use strict";var t=null;function i(){}return i.prototype.readOnlyError=function(t){e.error('"'+t+'" is a readOnly property')},i.prototype.emptyContentError=function(t){e.error(t+" doens't have a 3D content")},i.prototype.poiError=function(t){e.error(t+" is not a POI")},i.prototype.rdblinkError=function(t){e.error(t+" is not a RdbLink")},i.prototype.deprecated=function(t){e.warn("Deprecated object "+t+": You are using an Impl object. You should use a xCity object.")},i.prototype.alreadyCreated=function(){e.warn("World already created.")},i.prototype.wrongRenderingProfile=function(){e.warn("Type is not correct. Use plaster or t3d")},i.prototype.layerNotExist=function(t){e.error("Layer "+t+" doesn't exist")},i.prototype.noColorError=function(t){e.error(t+" doesn't have color")},i.prototype.noPositionError=function(t){e.error(t+" doesn't have position")},i.prototype.doesntExist=function(t,i){e.error(t+" doesn't have "+i+" attribute")},i.getInstance=function(){return null===t&&(t=new i),t},i.getInstance()}),define("DS/UrbanAPI/xCityExpression",["DS/XCityTools/Expression","DS/Visualization/ThreeJS_DS"],function(e,t){"use strict";function i(t){this.impl=new e(t)}function n(e){var t=e;return e instanceof i&&(t=e.impl),t}i.prototype.getOperator=function(){return this.impl.getOperator()},i.prototype.getOperands=function(){return this.impl.getOperands()},i.prototype.propertyName=function(e){return"string"!=typeof e?console.error("a propertyName must be a string "):this.impl.propertyName(e),this},i.prototype.literal=function(e){return this.impl.literal(e),this},i.prototype.add=function(e){var t=n(e);return this.impl.add(t),this},i.prototype.mul=function(e){var t=n(e);return this.impl.mul(t),this},i.prototype.sub=function(e){var t=n(e);return this.impl.sub(t),this},i.prototype.div=function(e){var t=n(e);return this.impl.div(t),this},i.prototype.colorGradient=function(e,t){var i=r(e);return this.impl.colorGradient(i,t),this},i.prototype.floatGradient=function(e,t){var i=o(e);return this.impl.floatGradient(i,t),this};var r=function(e){var i=null;if(e&&e.keyframes){var n,r=Object.keys(e.keyframes),o=r.length;for(n=0;n<o;n++){var a=e.keyframes[r[n]];if(a&&a.color){i||(i={keyframes:[]});var s={color:new t.Color(a.color),value:a.value};i.keyframes[r[n]]=s}}}return i},o=function(e){var t=null;if(e&&e.keyframes){var i,n=Object.keys(e.keyframes),r=n.length;for(i=0;i<r;i++){var o=e.keyframes[n[i]];if(o&&o.float){t||(t={keyframes:[]});var a={float:Number(o.float),value:o.value};t.keyframes[n[i]]=a}}}return t};return i.prototype.toJSON=function(){return this.impl.toJSON()},i.prototype.clone=function(){return new i(this.impl.clone())},i}),define("DS/UrbanAPI/xCityFilter",["DS/UrbanAPI/xCityExpression","DS/XCityTools/OGCFilter"],function(e,t){"use strict";function i(e){this.impl=new t(e)}function n(t){var i=t;return t instanceof e&&(i=t.impl),i}return i.prototype=Object.create(e.prototype),i.prototype.constructor=i,i.prototype.isEqualTo=function(e){var t=n(e);return this.impl.isEqualTo(t),this},i.prototype.isNotEqualTo=function(e){var t=n(e);return this.impl.isNotEqualTo(t),this},i.prototype.isLessThan=function(e){var t=n(e);return this.impl.isLessThan(t),this},i.prototype.isLessThanOrEqualTo=function(e){var t=n(e);return this.impl.isLessThanOrEqualTo(t),this},i.prototype.isGreaterThan=function(e){var t=n(e);return this.impl.isGreaterThan(t),this},i.prototype.isGreaterThanOrEqualTo=function(e){var t=n(e);return this.impl.isGreaterThanOrEqualTo(t),this},i.prototype.isBetween=function(e,t){var i=n(e),r=n(t);return this.impl.isBetween(i,r),this},i.prototype.clone=function(){return new i(this.impl.clone())},i.prototype.and=function(e){var t=n(e);return this.impl.and(t),this},i.prototype.or=function(e){var t=n(e);return this.impl.or(t),this},i}),define("DS/UrbanAPI/xCityUndergroundSelection",["DS/UrbanAPI/xCityUndergroundMode"],function(e){function t(t){e.call(this,t),this._isSelectionDone=!1,this._isPostSelectionDone=!1,Object.assign(this.properties,{maxDepth:{type:"number",default:50,isPostSelection:!0,min:0,max:1e3},tickDistance:{type:"number",default:5,isPostSelection:!0,min:5,max:1e3},showTicks:{type:"boolean",default:!1,isPostSelection:!0}})}return t.prototype=Object.create(e.prototype),Object.defineProperties(t.prototype,{maxDepth:{set:function(e){if(!Number.isInteger(e))throw new Error("xCityUndergroundAPI : maxDepth only accepts integer values");this.state.maxDepth=e,!0===this._isCurrentMode&&!0===this._isSelectionDone&&(this._checkUndergroundVisu(),this._sceneRenderer.ugVisu.maxDepth=e,this._sceneRenderer.ugVisu.updateAreaInfo(),this._sceneRenderer.ugVisu.updateUndergroundSettingsView())},get:function(){return this.state.maxDepth}},tickDistance:{set:function(e){if(!(Number.isInteger(e)&&e>0))throw new Error("xCityUndergroundAPI : ticksDistance only accepts positive integer values");this.state.tickDistance=e,!0===this._isCurrentMode&&!0===this._isSelectionDone&&(this._sceneRenderer.ugVisu.tickDistance=e,this._sceneRenderer.ugVisu.updateAreaInfo(),this._sceneRenderer.ugVisu.updateUndergroundSettingsView())},get:function(){return this.state.tickDistance}},showTicks:{set:function(e){if(!0!==e&&!1!==e)throw new Error("xCityUndergroundAPI : showTicks only accepts boolean values");this.state.showTicks=e,!0===this._isCurrentMode&&!0===this._isSelectionDone&&(this._sceneRenderer.ugVisu.showTicks=e,void 0!==xCity&&void 0!==xCity.widgetData&&void 0!==xCity.widgetData.underground_showTicks_CF&&(xCity.widgetData.underground_showTicks_CF=e),this._sceneRenderer.ugVisu.updateUndergroundSettingsView())},get:function(){return this.state.showTicks}},_onPostSelection:{enumerable:!1,value:function(){void 0===this.maxDepth&&this.resetMaxDepth(),Object.keys(this.properties).forEach(e=>{!0===this.properties[e].isPostSelection&&(this[e]=void 0!==this.state[e]?this.state[e]:this.properties[e].default)}),this._isPostSelectionDone=!0}},_isPostSelectionDone:{enumerable:!1,writable:!0},_isSelectionDone:{enumerable:!1,writable:!0}}),Object.assign(t.prototype,{resetMaxDepth:function(){this._isCurrentMode?(this._checkUndergroundVisu(),this.maxDepth=this._sceneRenderer.ugVisu.initialDepth):console.warn("xCityUndergroundAPI : maxDepth cannot be autoset if the profile is not active")}}),t._enable=function(){document.addEventListener("xCityUndergroundSelectionDone",e=>{void 0===this.maxDepth&&this._isCurrentMode&&(this.maxDepth=this._sceneRenderer.ugVisu.initialDepth),this._isSelectionDone=!0,this._onPostSelection()})},t._disable=function(){this._isPostSelectionDone=!1,this._isSelectionDone=!1},t}),define("DS/UrbanAPI/xCityHeatMapTool",["DS/UrbanAPI/xCityError","DS/Visualization/ThreeJS_DS","DS/UrbanTool/Utils","DS/XCityTools/EventDispatcher","DS/XCityRendering/HeatMapTool"],function(e,t,i,n,r){"use strict";function o(e){i.is(e)?this.impl=new r(e):console.error("Instanciation of the heatmap tools is not possible. use xCityAPI.getHeatMapTool() instead. ")}return o.prototype.addSource=function(e){var t=!1;return e&&e.impl&&(t=this.impl.addSource(e.impl)),t},o.prototype.removeSource=function(e){var t=!1;return e&&e.impl&&(t=this.impl.removeSource(e.impl)),t},o.prototype.get=function(e){return this.impl.get(e)},o.prototype.set=function(e,t){return this.impl.set(e,t)},o.prototype.getListAttributes=function(){return[]},o.prototype.getListRenderingAttributes=function(e){var t,n=this.impl;if(t=void 0!==e?e:[],i.is(n)&&i.is(n.getRendering)){var r=n.getRendering();i.is(r)&&(t=t.concat(r.getListRenderingAttributes()))}return t},o.prototype.resetRenderingAttribute=function(e){this.impl.resetRenderingAttribute(e)},o}),define("DS/UrbanAPI/xCityUndergroundViewer",["DS/UrbanAPI/xCityUndergroundMode"],function(e){function t(t){e.call(this,t),this.type="viewer",this._initParams(t)}return t.prototype=Object.create(e.prototype),Object.defineProperties(t.prototype,{_enable:{enumerable:!1,value:function(){this._checkUndergroundVisu(),this._sceneRenderer.ugVisu._ViewerMode()}},_disable:{enumerable:!1,value:function(){this._sceneRenderer.ugVisu._DeactivateViewer()}}}),t}),define("DS/UrbanAPI/xCityUndergroundWindow",["DS/UrbanAPI/xCityUndergroundSelection"],function(e){function t(t){e.call(this,t),this.type="window",Object.assign(this.properties,{radius:{type:"number",default:50,min:5,isPostSelection:!1},showGround:{type:"boolean",default:!1,isPostSelection:!0},groundOpacity:{type:"number",default:.2,isPostSelection:!0,min:.1,max:.9},showInformation:{type:"boolean",default:!1,isPostSelection:!0}}),this._initParams(t)}return t.prototype=Object.create(e.prototype),Object.defineProperties(t.prototype,{_enable:{enumerable:!1,writable:!1,value:function(){e._enable.call(this),this._checkUndergroundVisu(),this._sceneRenderer.activateWindowMode(),xCity._urbanImpl.getView3D()._profileRendering.applyOIT()}},_disable:{enumerable:!1,writable:!1,value:function(){e._disable.call(this),this._sceneRenderer.ugVisu._setOpacity(1),this._sceneRenderer.ugVisu.showTicks=!1,this._sceneRenderer.ugVisu.updateUndergroundSettingsView(),this._sceneRenderer.deactivateWindowMode(),xCity._urbanImpl.getView3D()._profileRendering.applyOIT()}},radius:{set:function(e){this._isParameterValueOK("radius",e)&&(this.state.radius=e),this._isCurrentMode&&this._isPostSelectionDone&&(this._sceneRenderer.ugVisu._scaleWindow(e),this._sceneRenderer.ugVisu.updateUndergroundSettingsView())},get:function(){return this.state.radius}},showGround:{set:function(e){this._isParameterValueOK("showGround",e)&&(this.state.showGround=e),this._isCurrentMode&&!0===this._isSelectionDone&&(e?(this._sceneRenderer.ugVisu.matW.transparent=!0,this._sceneRenderer.ugVisu.matW.opacity=1-this.groundOpacity):(this._sceneRenderer.ugVisu.matW.transparent=!1,this._sceneRenderer.ugVisu.matW.opacity=1))},get:function(){return this.state.showGround}},groundOpacity:{set:function(e){this._isParameterValueOK("groundOpacity",e)&&(this.state.groundOpacity=e),this._isCurrentMode&&this.showGround&&!0===this._isSelectionDone&&this._sceneRenderer.ugVisu._setOpacity(1-e)},get:function(){return this.state.groundOpacity}},showInformation:{set:function(e){this._isParameterValueOK("showInformation",e)&&(this.state.showInformation=e),this._isCurrentMode&&!0===this._isSelectionDone&&xCity._urbanImpl.USR.ugVisu._showInformation(e)},get:function(){return this.state.showInformation}}}),t}),define("DS/UrbanAPI/xCityTerrain",["DS/UrbanAPI/xCityError","DS/UrbanFeature/PointOfView","DS/UrbanFeature/Coordinate","DS/Visualization/ThreeJS_DS","DS/UrbanTool/Utils","DS/XCityCore/Terrain","DS/XCityTools/EventDispatcher"],function(e,t,i,n,r,o,a){"use strict";var s=null;function u(){this.impl=o}return u.prototype.get=function(e){return this.impl.get(e)},u.prototype.set=function(e,t){return this.impl.set(e,t)},u.prototype.getListAttributes=function(e){return[]},u.prototype.getListRenderingAttributes=function(e){var t,i=this.impl;if(t=void 0!==e?e:[],r.is(i)&&r.is(i.getRendering)){var n=i.getRendering();r.is(n)}return t.push("terrainAnalyzer"),t},u.prototype.onChange=function(e,t){if(r.is(a.eventsList["terrain."+e]))return a.subscribeTo(a.eventsList["terrain."+e],t)},u.prototype.removeOnChange=function(e){a.unsubscribe(e)},u.prototype.resetRenderingAttribute=function(e){this.impl.resetRenderingAttribute(e)},u.getInstance=function(){return null===s&&(s=new u),s},u.getInstance()}),define("DS/UrbanAPI/xCityCoordinate",["DS/UrbanAPI/xCityError","DS/UrbanTool/Utils","DS/Visualization/ThreeJS_DS","DS/XCityTools/EventDispatcher"],function(e,t,i,n){function r(e){this.impl=e}r.prototype.constructor=r,r.prototype.equals=function(e){return!!e&&this.impl===e.impl},r.prototype.toJSON=function(){return this.impl.toJSON()},r.prototype.get=function(e){var n=this.impl.get(e);return t.is(n)&&n instanceof i.Vector3&&(n=n.clone()),n},r.prototype.set=function(e,t){return this.impl.set(e,t)},r.prototype.reset=function(){return this.impl.reset()},r.prototype.getCentralTranslation=function(){return this.impl.getCentralTranslation()},r.prototype.setCentralTranslation=function(e){return e?this.impl.setCentralTranslation(new i.Vector3(e.x,e.y,e.z)):null},r.prototype.getCentralRotation=function(){return this.impl.getCentralRotation()},r.prototype.setCentralRotation=function(e){return this.impl.setCentralRotation(e)},r.prototype.onChange=function(e,i){var r=function(e,t){n.subscribeTo("/3DEXPERIENCity/onPostRender",i.bind(this,t),!0)}.bind(this);t.is(o[i])||(o[i]=[]),o[i].push(r),this.impl.addEvent("onChange:"+e,r)};var o={};return r.prototype.removeOnChange=function(e,i){var n,r,a;if(t.is(i)){if(o[i]){for(r=o[i],a=0;a<r.length;a++)this.impl.removeEvent("onChange:"+e,r[a]);delete o[i]}}else{var s,u=Object.keys(o),l=u.length;for(s=0;s<l;s++){for(n=u[s],r=o[n],a=0;a<r.length;a++)this.impl.removeEvent("onChange:"+e,r[a]);delete o[n]}}},r}),define("DS/UrbanAPI/xCityItem",["DS/UrbanAPI/xCityError","DS/UrbanFeature/PointOfView","DS/UrbanFeature/Coordinate","DS/Visualization/ThreeJS_DS","DS/UrbanTool/Utils","DS/XCityTools/Debug","DS/UrbanAPI/xCityCoordinate"],function(e,t,i,n,r,o,a){"use strict";function s(e){this.impl=e}function u(e){var t,i,r=!1,o=Object.keys(e),a=o.length;for(i=0;i<a;i++){var s=o[i];(t=xCity.convertToVec3(e[s]))instanceof n.Vector3&&(e[s]=t,r=!0)}return r||(t=xCity.convertToVec3(e))instanceof n.Vector3&&(e=t),e}s.prototype.get=function(e){var t=this.impl.get(e),i=this.impl.getContent();if("underground"===e)return 1===this.impl.findTags("underground");if("Content"===e)return o.warn('get("Content") is deprecated: use directly obj.get("attribute")'),t;if("userData"===e)return this.getUserData("content");if(r.is(t))return t;if(r.is(i)){if("boundingSphere"===e)return this.impl.getContent().getBoundingSphere();if("Rendering"===e)return i._polygonSet?i._rendering.getRenderingValues():i.getMaterial();var n=i.get(e);if(void 0!==n){if(r.is(n))if("Coordinate"===e)this.impl._xcitycoordinate&&n.get("id")!==this.impl._xcitycoordinate.get("id")&&(this.impl._xcitycoordinate=null),this.impl._xcitycoordinate||(this.impl._xcitycoordinate=new a(n)),n=this.impl._xcitycoordinate;else if(r.is(n.getHexString))return"#"+n.getHexString();return n}if(n=i[e],r.is(n))return n;if(n=i.metaData[e],r.is(n))return n}return r.is(this.impl.metaData[e])?this.impl.metaData[e]:void 0},s.prototype.getUserData=function(e){var t=this.impl.getContent(),i=this.impl.userData||this.impl.get("userData"),n=t?t.userData||t.get("userData"):void 0;return{feature:i,content:n,object:{feature:i,content:n}}[e||"content"]},s.prototype.set=function(n,o){var s=this.impl.getContent();if("object"==typeof o&&null!==o&&"Rendering"!==n&&"dashPattern"!==n&&"stroke"!==n&&(o=u(o)),"Content"!==n&&"Geometry"!==n)if("temporary"!==n){if(void 0!==this.impl.get(n))switch(n){case"id":e.readOnlyError("id");break;case"PointOfView":if(r.is(o)){var l=new t(o);this.impl.set("PointOfView",l)}else this.impl.set("PointOfView",null);break;default:this.impl.set(n,o)}else if(r.is(s))switch(n){case"Coordinate":var c;c=o instanceof a?o.impl:new i(o),s.set("Coordinate",c);break;case"Rendering":s.setMaterial(o);break;case"Clustering":s.setClustering(o);break;case"underground":o?this.impl.addTag("underground"):this.impl.removeTag("underground");break;default:s.set(n,o)}}else this.impl.temporary=o},s.prototype.setRenderable=function(e,t){var i=this.impl.getContent();"object"==typeof t&&null!==t&&"Rendering"!==e&&"dashPattern"!==e&&"stroke"!==e&&(t=u(t));var n,r=null,o=i.get("renderID");switch(o&&this.getRenderIDList&&(n=this.getRenderIDList())&&n.indexOf(o)>=0&&(r=o),e){case"Rendering":i.setMaterial(t,r);break;default:i.setRenderable(e,t,r)}},s.prototype.hasActiveStyling=function(){var e=null,t=this.impl.getContent();if(t){var i,n=t.get("renderID");n&&this.getRenderIDList&&(i=this.getRenderIDList())&&i.indexOf(n)>=0&&(e=n)}return e},s.prototype.reload=function(e){this.impl.reload(e)},s.prototype.getListAttributes=function(e){var t,i,n=this.impl.getContent();if((t=void 0!==e?e:[]).push("className"),r.is(n))for(i in t.push("boundingSphere"),n._attributes)"id"!==i&&t.push(i);for(i in this.impl._attributes)"Content"!==i&&"Geometry"!==i&&"node"!==i&&t.push(i);return t},s.prototype.getListRenderingAttributes=function(e){var t,i=this.impl.getContent();if(t=void 0!==e?e:[],r.is(i)&&r.is(i.getRendering)){var n=i.getRendering();r.is(n)&&(t=t.concat(n.getListRenderingAttributes())).length>0&&t.push("Rendering")}return t},s.prototype.addTags=function(e){this.impl.addTags(e)},s.prototype.addTag=function(e){this.impl.addTag(e)},s.prototype.removeTag=function(e){this.impl.removeTag(e)},s.prototype.onChange=function(e,t){var i=function(e,i){t(this,i)}.bind(this);l[t]=i,this.impl.addEvent("onChange:"+e,i),this.impl.getContent()&&"loadInfo"!==e&&this.impl.getContent().addEvent("onChange:"+e,i)};var l={};return s.prototype.removeOnChange=function(e,t){var i;if(r.is(t))l[t]&&(this.impl.removeEvent("onChange:"+e,l[t]),delete l[t]);else{var n,o=Object.keys(l),a=o.length;for(n=0;n<a;n++)i=o[n],l[i]&&(this.impl.removeEvent("onChange:"+e,l[i]),this.impl.getContent()&&"loadInfo"!==e&&this.impl.getContent().removeEvent("onChange:"+e,l[i])),delete l[i]}},s.prototype.getParentFolder=function(){return this.parentFolder()},s.prototype.parentFolder=function(){var e={impl:this.impl.getItemParent()};return xCity.findItem(e)},s.prototype.setHierachy=function(e,t){var i,n=this.impl.getItemParent();i=r.is(t)?t.impl:n,this.impl.get("children")&&void 0!==this.impl.findChildById(i.get("id"),!0)||n.moveChild(this.impl,e,i)},s.prototype.isChild=function(e){return!!e.impl.findChildById(this.get("id"),!0)},s.prototype.isEqual=function(e){return!!r.is(e)&&this.impl===e.impl},s.prototype.resetRenderingAttribute=function(e){var t=this.impl.getContent();if(r.is(t)&&r.is(t.getRendering)&&r.is(t.resetRenderingAttribute)){var i=t.getRendering();if(r.is(i))[].concat(i.getListRenderingAttributes()).indexOf(e)>-1&&t.resetRenderingAttribute(e)}},s.prototype.removeRenderingAttributes=function(){for(var e=this.getListRenderingAttributes(),t=e.length,i=0;i<t;i++){var n=e[i];this.resetRenderingAttribute(n)}},s.prototype.getCurrentStyleByProfile=function(e){var t=this.impl.getContent();if(t){var i=t.renderingProfileManager;if(i){for(var n=i.getActiveRenderingsForGeomByProfile(t),r=Object.keys(n),o=0;o<r.length;o++){var a=r[o],s=n[a];if(e&&1==e.full)n[a]=s.toJSON();else{var u=s.getImpactedAttributes();n[a]=Object.keys(u)}}return n}}},s}),define("DS/UrbanAPI/xCityFolder",["DS/UrbanAPI/xCityItem"],function(e){"use strict";function t(e){this.impl=e}function i(e,i){var n=e.getChild(i);return"Folder"===n.metaData.className?new t(n):xCity.findItem({impl:n})}return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.prototype.addChild=function(e,t){e.impl.getItemParent()?e.setHierachy(t||this.get("children").length,this):this.impl.addChild(e.impl,t)},t.prototype.get=function(t){var n=0,r=[],o=this.impl.get("children").length;if("children"===t){for(;n<o;n++)r[n]=i(this.impl,n);return r}return e.prototype.get.call(this,t)},t.prototype.set=function(t,i){switch(t){case"visible":this.impl.setVisible(i,!0);break;default:e.prototype.set.call(this,t,i)}},t.prototype.onChange=function(i,n){(function(e){var t=xCity.findItem({id:e.get("id")},this);!Utils.is(t)&&Utils.is(e.toJSON)&&(t=e.toJSON()),n(t)}).bind(this);var r=function(e){var i=xCity.findItem({id:e.get("id")},this);!Utils.is(i)&&Utils.is(e.toJSON)?i=e.toJSON():"Folder"===e.metaData.className&&(i=new t(e)),n(i)}.bind(this);"childAdded"===i?this.impl.get("children").addEvent("onAdd",r):"childRemoved"===i?this.impl.get("children").addEvent("onRemove",r):e.prototype.onChange.call(this,i,n)},t}),define("DS/UrbanAPI/xCityProfile",["DS/UrbanAPI/xCityItem","DS/UrbanAPI/xCityError"],function(e,t){"use strict";function i(e){this.impl=e}return i.prototype.toJSON=function(){return this.impl._getInputProfile()},Object.defineProperty(i.prototype,"name",{get:function(){return this.impl.getName()},set:function(e){var t=this.impl.getManager();if(t){var i=t.sessionProfileName;void 0!==i&&this.impl.getName()!==i&&t.renameProfile(this.impl.getName(),e)}}}),i}),define("DS/UrbanAPI/xCityPrimitive",["DS/UrbanAPI/xCityItem","DS/UrbanAPI/xCityError","DS/xCityBasicUtils/Utils"],function(e,t,i){"use strict";function n(t){e.call(this,t)}return n.prototype=Object.create(e.prototype),n.prototype.constructor=n,n.prototype.get=function(t){var i;switch(t){case"position":i=this.impl.getContent().getLocalPosition();break;case"factory":i=this.impl.getContent()._layer._node.name;break;case"layer":i=xCity.findItem({id:this.impl.getContent()._layer._itemParent.id});break;default:i=e.prototype.get.call(this,t)}return i},n.prototype.getListAttributes=function(){var t=[];return t.push("position"),t.push("factory"),t.push("layer"),e.prototype.getListAttributes.call(this,t)},n.prototype.getListRenderingAttributes=function(){var e=null,t=[],n=this.impl.getContent();return i.is(n)&&i.is(n._layer)&&(e=n._layer.getRendering()),i.is(e)&&(t=t.concat(e.getListPrimitiveRenderingAttributes())),t},n.prototype.getCurrentStyleByProfile=function(){var e=this.impl.getContent(),t=e.renderingProfileManager;if(t){for(var i=this.impl.get("STRID"),n=t.getCurrentRenderingForPrimitiveByProfile(e,i),r=Object.keys(n),o=0;o<r.length;o++){var a=r[o],s=n[a].getImpactedAttributes();n[a]=Object.keys(s)}return n}},n}),define("DS/UrbanAPI/xCityLight",["DS/UrbanAPI/xCityItem","DS/UrbanAPI/xCityError"],function(e,t){function i(t){e.call(this,t)}return i.prototype=Object.create(e.prototype),i.prototype.constructor=i,i.prototype.get=function(t){var i=void 0;switch(t){case"position":i=this.impl.getContent().getLocalPosition();break;default:i=e.prototype.get.call(this,t)}return i},i.prototype.addUserDataProperty=function(e,t){this.impl.getContent().addUserDataProperty(e,t)},i.prototype.removeUserDataProperty=function(e){this.impl.getContent().removeUserDataProperty(e)},i.prototype.getTransformedGeoJSON=function(){return this.impl.getContent().getTransformedGeoJSON()},i}),define("DS/UrbanAPI/xCityRenderingProfile",["DS/UrbanAPI/xCityProfile","DS/UrbanAPI/xCityError","DS/UrbanAPI/xCityExpression","DS/UrbanAPI/xCityFilter","DS/XCityRendering/FeatureRendering","DS/XCityTools/Expression"],function(e,t,i,n,r,o){"use strict";function a(e){this.impl=e}function s(e){if(e){var t,n,r,a=Object.keys(e),u=a.length;for(t=0;t<u;t++)(n=e[r=a[t]])&&(e[r]=n instanceof o?new i(n):s(n))}return e}function u(e,t){var i="renderId";t&&(i=t);var n,r=1,o=i+"_"+r,a=e.getManager();for(a&&(n=Object.keys(a.getAllNamesandIds()));n.includes(o);)o=i+"_"+ ++r;return o}a.prototype=Object.create(e.prototype),a.prototype.constructor=a,a.prototype.duplicate=function(e){return new a(this.impl.duplicate(e))},a.prototype.get=function(e,t){var i=null,n=this.impl._getMaterialForFeatureFromLayer(t);return n&&(i=n[e])&&i.getHexString&&(i="#"+i.getHexString()),i},a.prototype.set=function(e,t,i){var n={};n[e]=t,this.impl.addRendering(i,n)},a.prototype.getRendering=function(e){return this.impl._getMaterialForFeatureFromLayer(e)},a.prototype.getRenderingForLayer=function(e){if(e){var t=e.get("Content"),i=this.impl.getRenderingForLayer(t);if(i&&i instanceof r)return function(e){if(e&&e.DatavizRendering){var t,i,r,o=Object.keys(e.DatavizRendering),a=o.length;for(t=0;t<a;t++)r=o[t],(i=e.DatavizRendering[r]).Filter&&(i.Filter=new n(i.Filter)),i.DatavizMaterial&&(i.DatavizMaterial=s(i.DatavizMaterial))}return e}(i.toJSON(!1))}},a.prototype.setRendering=function(e,t){return this.impl._getMaterialForFeatureFromLayer(e),e||(e=u(this.impl)),t||(t={}),this.impl.addRendering(e,t),e},a.prototype.setPrimitiveRendering=function(e,t,i){if(this.impl._getMaterialForFeatureFromLayer(e),!e)return null;i||(i={}),this.impl.addRendering(e,i,t)},a.prototype.isDefault=function(){var e=!1;return this.name===this.impl.getManager().sessionProfileName&&(e=!0),e},a.prototype.resetRenderingAttribute=function(e,t){this.impl.removeRendering(e,t)},Object.defineProperty(e.prototype,"effect",{get:function(){return this.impl.getGlobalEffects()},set:function(e){this.impl.setEffect(e)}}),Object.defineProperty(e.prototype,"realisticWater",{get:function(){return this.impl.isOceanEnabled()},set:function(e){this.impl.enableOcean(e)}}),a.prototype.getAllIds=function(){var e=this.impl._ids;return e&&(e=Object.keys(e)),e},a.prototype.addFilterRendering=function(e,t,i){return i||(i=u(this.impl)),t||(t={}),e?e instanceof n&&(e=e.impl):e=null,this.impl.addFilterRendering(i,e,t)},a.prototype.addDatavizRendering=function(e,t){return e||(e=u(this.impl)),t=t?l(t):{},this.impl.addDatavizRendering(e,t)};var l=function(e){var t,n,r,o,a=Object.keys(e),s=a.length;for(n=Array.isArray(e)?[]:{},t=0;t<s;t++)o=e[r=a[t]],n[r]=o instanceof i?o.impl:l(o);return n};return a.prototype.getFilters=function(e,t){var i=this.impl.getFilters(e,t);if(i){var r,o,a,s=Object.keys(i),u=s.length;for(r=0;r<u;r++)(o=i[s[r]])&&(a=o.filter)&&(o.filter=new n(a))}return i},a.prototype.getMappings=function(e,t){var n=this.impl.getMappings(e,t);if(n){var r,o,a=Object.keys(n),s=a.length;for(r=0;r<s;r++)if(o=n[a[r]]){o;var u,l,c=Object.keys(o),p=c.length;for(u=0;u<p;u++)(l=c[u])===t&&(o[l]=new i(o[l]))}}return n},a.prototype.updateDatavizRendering=function(e,t,i,r){t?t instanceof n&&(t=t.impl):t=null,r=r?l(r):null,this.impl.updateDatavizRendering(e,t,i,r)},a.prototype.deleteDatavizRendering=function(e){this.impl.deleteDatavizRendering(e)},a}),define("DS/UrbanAPI/xCityPerformanceProfile",["DS/UrbanAPI/xCityProfile","DS/UrbanAPI/xCityError"],function(e,t){"use strict";function i(e){this.impl=e}return i.prototype=Object.create(e.prototype),i.prototype.constructor=i,i.prototype.duplicate=function(e){return new i(this.impl.duplicate(e))},Object.defineProperty(i.prototype,"disabledEffects",{get:function(){return this.impl.getDisabledEffects()},set:function(e){this.impl.setDisabledEffects(e)}}),Object.defineProperty(i.prototype,"quadsPerLevel",{get:function(){return this.impl.getValue("quadsPerLevel")},set:function(e){this.impl.setValue("quadsPerLevel",e)}}),Object.defineProperty(i.prototype,"maxtextureLOD",{get:function(){return this.impl.getValue("maxtextureLOD")},set:function(e){this.impl.setValue("maxtextureLOD",e)}}),Object.defineProperty(i.prototype,"textureLODOffset",{get:function(){return this.impl.getValue("textureLODOffset")},set:function(e){this.impl.setValue("textureLODOffset",e)}}),Object.defineProperty(i.prototype,"textureLODDistanceFactor",{get:function(){return this.impl.getValue("textureLODDistanceFactor")},set:function(e){this.impl.setValue("textureLODDistanceFactor",e)}}),i}),define("DS/UrbanAPI/xCityLayer",["DS/UrbanAPI/xCityItem","DS/UrbanAPI/xCityFolder","DS/UrbanAPI/xCityPrimitive","DS/UrbanAPI/xCityError","DS/XCityModel/Feature","DS/XCityModel/Folder","DS/XCityModel/LayerVectorPrimitive","DS/XCityLayer/Vector","DS/XCityCore/Store","DS/Visualization/ThreeJS_DS","DS/UrbanTool/Utils","DS/XCityTools/Debug","DS/UrbanAPI/xCityExpression","DS/UrbanAPI/xCityFilter","DS/xCityBasicUtils/Utils"],function(e,t,i,n,r,o,a,s,u,l,c,p,d,g,f){"use strict";function h(e){this.impl=e}function y(e,t){var i=new r({name:t,id:e.id+"_"+t}),n=e.getContent().createPrimitive(t);if(i.set("Content",n),i.getContent()._subMeshes.length>0)return i}h.prototype=Object.create(e.prototype),h.prototype.constructor=h,h.prototype.createPrimitive=function(e,n){var r=y(this.impl,e);if(c.is(r)){var o=new i(r);return n instanceof t?n.addChild(o):r.isIndexablePrimitive()?r.getContent()._layer.getItemParent().addChild(r):this.impl._root.getRoot().addChild(o.impl),o.impl.temporary=!1,o}},h.prototype.each=function(e){console.warn("deprecated: You should use colorize function");var t=this;this.impl.getContent().each(function(n){for(var o=new r({name:n.getAttribute("strid"),id:n.getAttribute("strid")}),a=0;a<n.getAttributeKeys().length;a++){var s=n.getAttributeKeys()[a];o.set(s,n.attributes[s])}var u=t.impl.getContent().createPrimitive(n.getAttribute("strid"));o.set("Content",u);var l=new i(o);return console.log(n.getCenter()),console.log(l.get("position")),e(l),n})},h.prototype.resetRules=function(){this.impl.getContent()._patch.reset()},h.prototype.resetToInitial=function(){var e,t,i=this.impl.getContent()._patch.factory._rendering;c.is(i)?(e=i.getCompleteMaterialInfo().color,t=i.getCompleteMaterialInfo().opacity):(e=[1,1,1],t=1),this.colorize(function(){return{color:e,opacity:t}}),this.resetRules()},h.prototype.findPrimitiveById=function(e){var t,n=this.impl.id+"_"+e;if(t=this.impl.getContent()._urban.getLayerRoot().getRoot().findChildById(n,!0),c.is(t)||(t=this.impl.getContent()._urban._dataModelPrivate.findChildById(n,!0)),!c.is(t)){if(t=y(this.impl,e),!c.is(t))return;t.isIndexablePrimitive()?t.getContent()._layer.getItemParent().addChild(t):this.impl.getContent()._urban._dataModelPrivate.addChild(t)}return new i(t)},h.prototype.colorize=function(e,t){var i=function(t){return e(t)};if(void 0!==t&&t){t.targets&&"string"!=typeof t.targets[0]&&(t.targets=v(t.targets));switch(t.type){case"shape":i=function(i){if(m(t.targets,i.center))return e(i)};break;case"circle":i=function(i){var n,r,o,a=0,s=0,u=void 0===t.radius.value?t.radius:t.radius.value,l=void 0===t.radius.start?0:t.radius.start,c=void 0===t.radius.end?u:t.radius.end;for(n=0;n<t.targets.length;n++)r=0,o=t.targets[n],(r+=i.center.distanceTo(o)/u)<=c/u&&r>=l/u&&(s++,a+=r);if((a/=s)<=c/u&&a>=l/u)return e(i,a*u)};break;case"square":i=function(i){var n,r,o,a,s,u,l=0,c=0;for(n=0;n<t.targets.length;n++)r=0,o=t.targets[n],a=void 0===t.radius.value?t.radius:t.radius.value,s=void 0===t.radius.start?0:t.radius.start,u=void 0===t.radius.end?a:t.radius.end,(r+=(Math.abs(o.x-i.center.x)/a+Math.abs(o.y-i.center.y)/a)/2)<=u/a&&r>=s/a&&(c++,l+=r);if((l/=c)<=u/a&&l>=s/a)return e(i,l*a)}}}this.impl.getContent().colorize(i)};var m=function(e,t){for(var i=!1,n=0,r=e.length-1;n<e.length;r=n++){var o=e[n].x,a=e[n].y,s=e[r].x,u=e[r].y;a>t.y!=u>t.y&&t.x<(s-o)*(t.y-a)/(u-a)+o&&(i=!i)}return i};h.prototype.updatePosition=function(e){!function(e,t){u.traverse(e.impl.getContent().get("id"),function(i){var n=i.userData.source;n.index=0;for(var r=new s.Feature;r=n.getNextFeature(r);){var o=r.get("strid"),a=e.impl.getContent()._patch._uidListeners[o];if(a&&a.geom&&a.geom[0].mesh&&a.geom[0].mesh.isInstanceNode3D){var u=t(o);if(void 0!==u.orientation){var l=u.orientation;a.geom[0].mesh.setOrientation(l,o)}if(void 0!==u.position){var c=u.position;r.geometry.x=c[0],r.geometry.y=c[1],r.geometry.z=c[2],a.posSize.center.x=c[0],a.posSize.center.y=c[1],a.posSize.center.z=c[2],a.geom[0].mesh.setPosition(c,o)}}}})}(this,function(t){return e(t)})};var v=function(e){for(var t=[],i=0;i<e.length;i++)e[i]instanceof l.Vector3?t.push(e[i]):t.push(xCity.convertToVec3(e[i]));return t};h.prototype.get=function(t){var i,n=0,r=0;switch(t){case"children":if(this.impl.get("children"))for(i=[],r=this.impl.get("children").length;n<r;n++)i[n]=this.impl.getChild(n);break;case"factory":i=this.impl.getContent()._node.name;break;default:i=e.prototype.get.call(this,t)}return i},h.prototype.getListAttributes=function(){var t=[];return t.push("factory"),e.prototype.getListAttributes.call(this,t)},h.prototype.addSLDResource=function(e,t){e&&this.impl.getContent().addSLDResource(e,t)},h.prototype.resetAllPrimitivesRendering=function(e){var t,i=[],n=this.impl.getContent(),r=n.renderingProfileManager;if(r&&(c.is(n._itemParent)&&(t=n._itemParent.get("id"),c.is(t)&&i.push(t)),t=n.get("id"),c.is(t)&&i.push(t),c.is(i))){var o=r.getSessionProfile();c.is(o)&&o.resetAllPrimitivesRendering(i,e),r.setRender(i)}},h.prototype.uploadCurrentStyleToServer=function(e){this.impl.getContent().uploadStyleToServer(e)},h.prototype.updateCurrentStyleFromServer=function(e){this.impl.getContent().getStyleFromServer(e)},h.prototype.deleteCurrentStyleFromServer=function(e){this.impl.getContent().deleteStyleOnserver(e)},h.prototype.getRenderingForDataset=function(){return this.impl.getContent().getRenderingToUpload()},h.prototype.findPrimitivesByCriteria=function(e){if(!e)return null;var t=this;return function(e){if(!e)return null;for(var i=Object.keys(e),n={},r=0;r<i.length;r++){var o=i[r];n[o]=t.findPrimitiveById(o)}return n}(this.impl.getContent().findPrimitivesByCriteria(e.impl))},h.prototype.getLayerPrimitives=function(e,t,i,n,r){return new Promise((a,s)=>{null==i&&(i=xCity.widgetData.currentReferential.get("uuid"));var u=this;this.impl.getContent().search(e,t,i,n,r).then(function(e){if(e.primitiveList){var t,i=!1;if(r.folderName&&(t=(u.get("children")||[]).find(e=>e.get("name")==r.folderName),i=null!=t),!t){t=new o;var n={name:r.folderName||"Search results",visible:u.get("visible"),tags:r.folderTags||[]};t.loadJSON(u.impl.getContent()._urban,n)}var s=u.impl.removeChild.bind(u.impl);u.impl.removeChild=function(e){console.log("REMOVE SEARCH NODE"),s(e),this.getContent()._node.removeChild(this.getContent().searchNode)};!function(n){if(!n)return null;for(var r={},o=0;o<n.length;o++){var s=n[o];r[s]=u.findPrimitiveById(s),u.impl.moveChild(r[s].impl,t.get("children").length,t)}i||u.impl.addChild(t,0),a({primitives:r,info:e.info})}(e.primitiveList)}},s)})};var b=function(e,t){return t.get("id")+"_RenderID_"+e};function C(e,t){var i=null;if(e){if(t[0].hasDatavizOnAttribute(e)){var n=t[0].getDatavizImpactingAttribute(e);c.is(n)&&(i=n)}}else i=t[0].getDatavizRenderings();return i}h.prototype.addNewStyling=function(e){var t=xCity.getStylingRenderingProfile();e||(e="defaultRenderName");var i=b(e,this);return i=function(e,t,i){var n=t.getRenderIDList(),r=e;if(n)for(;n.indexOf(r)>=0;)r+=".1";return r}(i,this),t.setRendering(i,{renderingDescription:e}),i},h.prototype.removeStyling=function(e){var t=xCity.getStylingRenderingProfile().impl.clearRendering(e);return this.impl.get("renderID")===e&&this.impl.set("renderID",""),t},h.prototype.getRenderIDList=function(e){var t=xCity.getStylingRenderingProfile(),i=t.getAllIds();if(c.is(i)){var n=b("",this),r=i.filter(function(e){return 0===e.indexOf(n)});if(e){for(var o=null,a=0;a<r.length;a++){var s=r[a],u=t.impl._getRendering(s);if(u){var l=u.renderingDescription;o||(o={}),"name"===e?(o[l]||(o[l]=[]),o[l].push(s)):"renderID"===e&&(o[s]=l)}}return o}return r}return null},h.prototype.setRenderIDFromName=function(e){var t=this.getRenderIDList("name");if(t){var i=t[e];if(i&&i.length>0){var n=i[0];i.length>1&&console.log("several renderID with this name. using the first one:",n),this.set("renderID",n)}else console.log("no renderID by that name: ",e)}},h.prototype.getFeatures=function(e,t){var i=this.impl.getContent();if(!i||!0!==i._factory)return null;e||(e=100),t||(t=0);var n=0,r=[];if(i._poiSet&&i._poiSet.primInfos)for(var o in i._poiSet.primInfos)n>=t&&n<e+t&&r.push(i._poiSet.primInfos[o].userData),++n;if(i._lineSet&&i._lineSet.primInfos)for(var o in i._lineSet.primInfos)n>=t&&n<e+t&&r.push(i._lineSet.primInfos[o].userData),++n;if(i._polygonSet&&i._polygonSet.primInfos)for(var o in i._polygonSet.primInfos)n>=t&&n<e+t&&r.push(i._polygonSet.primInfos[o].userData),++n;return r},h.prototype.getLayerInformation=function(){var e=this.impl.getContent();if(!e||!0!==e._factory&&!e.isWFS)return null;var t={nbFeature:{input:0,inside:0,outside:0},nbGeometry:{point:0,multiPoint:0,line:0,multiLine:0,polygon:0,multiPolygon:0},inputProj:null,serviceId:null,objectId:e.get("objectId"),oversized:!1,isBuilt:!1,error:null};if(e.isWFS){var i=e.get("userData");if(i.proxyInformation){var n=i.proxyInformation.serverInformation;n&&(t.serviceId=n.url);var r=i.proxyInformation.layerInformation;if(r){t.nbFeature.input=r.featureCount;var o=r.inReferentialContext;o&&(t.nbFeature.inside=o.featureCount,o.geometryTypeMap&&(o.geometryTypeMap.Point&&(t.nbGeometry.point=o.geometryTypeMap.Point),o.geometryTypeMap.MultiPoint&&(t.nbGeometry.multiPoint=o.geometryTypeMap.MultiPoint),o.geometryTypeMap.LineString&&(t.nbGeometry.line=o.geometryTypeMap.LineString),o.geometryTypeMap.MultiLineString&&(t.nbGeometry.multiLine=o.geometryTypeMap.MultiLineString),o.geometryTypeMap.Polygon&&(t.nbGeometry.polygon=o.geometryTypeMap.Polygon),o.geometryTypeMap.MultiPolygon&&(t.nbGeometry.multiPolygon=o.geometryTypeMap.MultiPolygon))),t.isBuilt=!0}}}else{if(t.serviceId=e.get("serviceId"),void 0!==e.serviceError)return t.error=e.serviceError,t;e._poiSet&&e._poiSet&&(e._poiSet._inputCRS&&(t.inputProj=e._poiSet._inputCRS),t.nbGeometry.point=e._poiSet.nbPoint,t.nbGeometry.multiPoint=e._poiSet.nbMultiPoint,t.nbFeature.input+=e._poiSet.nbInputFeature,t.nbFeature.inside+=e._poiSet.nbInside,t.nbFeature.outside+=e._poiSet.nbOutside,t.oversized=t.oversized||e._poiSet.oversized,t.isBuilt=e._poiSet.isBuilt),e._lineSet&&(e._lineSet._inputCRS&&!t.inputProj&&(t.inputProj=e._lineSet._inputCRS),t.nbGeometry.line=e._lineSet.nbGeometry,t.nbGeometry.multiLine=e._lineSet.nbMultiGeometry,t.nbFeature.inside+=e._lineSet.nbInside,t.nbFeature.outside+=e._lineSet.nbOutside,t.oversized=t.oversized||e._lineSet.oversized,t.isBuilt=t.isBuilt&&e._lineSet.isBuilt),e._polygonSet&&(e._polygonSet._inputCRS&&!t.inputProj&&(t.inputProj=e._polygonSet._inputCRS),t.nbGeometry.polygon=e._polygonSet.nbGeometry,t.nbGeometry.multiPolygon=e._polygonSet.nbMultiGeometry,t.nbFeature.inside+=e._polygonSet.nbInside,t.nbFeature.outside+=e._polygonSet.nbOutside,t.oversized=t.oversized||e._polygonSet.oversized,t.isBuilt=t.isBuilt&&e._polygonSet.isBuilt)}return t};var P=function(e,t){return e.hasActiveStyling()?t.getStylingProfile():t.getSessionProfile()};h.prototype.hasActiveStyling=function(){let e=!1,t=this.get("renderID");if(""===t)e=!1;else{var i=this.getRenderIDList();e=!!(i&&i.length>0&&i.indexOf(t)>=0)}return e},h.prototype.getFilters=function(e,t){var i,n=this.impl.getContent(),r=n.renderingProfileManager;if(r){let g=[];if(t){let e=P(this,r);g.push(e)}var o=C(e,r.getActiveRenderingsForGeoms([n],g));if(c.is(o)){var a,s=(l=Object.keys(o)).length;for(p=0;p<s;p++)if("length"!==(d=l[p])){var u=(a=o[d])._id;c.is(a)&&(h=a.getFilterRendering(),c.is(h)&&c.is(h.rendering)&&(c.is(i)||(i={}),i[u]=h))}}}if(i){var l,p,d,f,h;s=(l=Object.keys(i)).length;for(p=0;p<s;p++)(f=i[d=l[p]])&&(h=f.filter)&&(f.filter=new g(h))}return i},h.prototype.getMappings=function(e,t){var i,n=this.impl.getContent(),r=n.renderingProfileManager;if(r){let d=[];if(t){let e=P(this,r);d.push(e)}var o=C(e,r.getActiveRenderingsForGeoms([n],d));if(c.is(o)){var a,s,u=(p=Object.keys(o)).length;for(g=0;g<u;g++)if("length"!==(h=p[g])){var l=(a=o[h])._id;c.is(a)&&(s=a.getMappingRendering(),c.is(s)&&(c.is(i)||(i={}),i[l]=s))}}}if(i){u=(p=Object.keys(i)).length;var p,g,h,y,m=f.getArrayFromComposedPropertyName(e);for(g=0;g<u;g++)if(y=i[h=p[g]]){y;var v,b=Object.keys(y),S=b.length;for(v=0;v<S;v++)if(b[v]===m[0]){var D=f.getComposedProperty(y,e);if(f.is(y)){let t=new d(D);f.setComposedProperty(y,e,t)}}}}return i};var S=function(e){if(c.is(e)){var t,i,n,r,o=Object.keys(e),a=o.length;for(i=Array.isArray(e)?[]:{},t=0;t<a;t++)r=e[n=o[t]],i[n]=r instanceof d?r.impl:S(r);return i}};return h.prototype.updateMapping=function(e){this.impl.getContent().setMaterial(value,renderId)},h.prototype.addFilterRendering=function(e,t){let i=this.impl.getContent();return e instanceof g&&(e=e.impl),i.addFilterRendering(e,t)},h.prototype.addDatavizRendering=function(e){let t=this.impl.getContent();return e=S(e),t.addDatavizRendering(e)},h.prototype.updateDatavizRendering=function(e,t,i,n){let r=this.impl.getContent();return i=S(i),n=S(n),t instanceof g&&(t=t.impl),r.updateDatavizRendering(e,t,i,n)},h.prototype.deleteDatavizRendering=function(e){return this.impl.getContent().deleteDatavizRendering(e)},h.prototype.getCurrentStyle=function(e=[]){var t=this.impl.getContent(),i=t.renderingProfileManager;if(i)return i.getActiveRenderingsForGeoms([t],e)[0].toJSON()},h}),define("DS/UrbanAPI/xCityUndergroundArea",["DS/UrbanAPI/xCityUndergroundSelection"],function(e){function t(t){e.call(this,t),this.type="area",Object.assign(this.properties,{showDepthPlanes:{type:"boolean",default:!1,isPostSelection:!0},showClippingPlanes:{type:"boolean",default:!0,isPostSelection:!0}}),this._initParams(t),void 0!==t.areaBBox&&(this.areaBBox=t.areaBBox)}return t.prototype=Object.create(e.prototype),Object.defineProperties(t.prototype,{_enable:{enumerable:!1,writable:!1,value:function(){e._enable.call(this),this._checkUndergroundVisu(),this._sceneRenderer.ugVisu._changeRenderingMode(),void 0!==xCity.widgetData&&!0===xCity.widgetData.underground_automaticArea_CF?this._sceneRenderer.ugVisu.activateAreaMode():void 0!==this.areaBBox?this._sceneRenderer.ugVisu.activateAreaMode(this.areaBBox):this._sceneRenderer.activateAreaMode()}},_disable:{enumerable:!1,writable:!1,value:function(){e._disable.call(this),this._sceneRenderer.deactivateAreaMode()}},showDepthPlanes:{set:function(e){if(!0!==e&&!1!==e)throw new Error("xCityUndergroundAPI : showDepthPlanes only accepts boolean values");this.state.showDepthPlanes=e,!0===this._isCurrentMode&&!0===this._isSelectionDone&&(this._sceneRenderer.ugVisu.showPlanes=e,this._sceneRenderer.ugVisu.updateUndergroundSettingsView())},get:function(){return this.state.showDepthPlanes}},showClippingPlanes:{set:function(e){if(!0!==e&&!1!==e)throw new Error("xCityUndergroundAPI : showClippingPlanes only accepts boolean values");this.state.showClippingPlanes=e,!0===this._isCurrentMode&&!0===this._isSelectionDone&&(this._sceneRenderer.ugVisu.showClippingPlanes=e,this._sceneRenderer.ugVisu.updateUndergroundSettingsView())},get:function(){return this.state.showClippingPlanes}}}),t}),define("DS/UrbanAPI/xCityUndergroundServices",["DS/UrbanTool/Utils","DS/UrbanAPI/xCityUndergroundViewer","DS/UrbanAPI/xCityUndergroundArea","DS/UrbanAPI/xCityUndergroundWindow"],function(e,t,i,n){"use strict";let r=void 0,o=void 0,a=null;function s(){this.createXCityUndergroundMode=function(e){let r;switch(void 0===e&&(e={}),e.type){case"viewer":r=new t(e);break;case"area":r=new i(e);break;case"window":r=new n(e);break;default:throw new Error("xCityUndergroundAPI : "+type+" unknown underground visualisation type.")}return r},this.getXCityUndergroundMode=function(){return o},this.setXCityUndergroundMode=function(e){void 0===r&&void 0!==xCity._urbanImpl&&(r=xCity._urbanImpl.getView3D()),void 0!==o&&(o._sceneRenderer=void 0),void 0!==(o=e)&&(void 0===r&&console.warn("xCityUndergroundServices : No scene renderer found in xCityContext when setting underground mode. The mode will not impact visualization."),o._sceneRenderer=r)}}return s.getInstance=function(){return null===a&&(a=new s),a},s.getInstance()}),define("DS/UrbanAPI/xCityPointOfInterest",["DS/UrbanAPI/xCityItem","DS/UrbanAPI/xCityError"],function(e,t){function i(t){e.call(this,t)}return i.prototype=Object.create(e.prototype),i.prototype.constructor=i,i.prototype.get=function(t){var i=void 0;switch(t){case"POIDiv":i=this.impl.get("Content")._poi.textDiv;break;case"position":i=this.impl.getContent().getLocalPosition();break;default:i=e.prototype.get.call(this,t)}return i},i.prototype.getListAttributes=function(){var t=[];return t.push("POIDiv"),e.prototype.getListAttributes.call(this,t)},i.prototype.getListRenderingAttributes=function(){return[]},i.prototype.addUserDataProperty=function(e,t){var i=this.impl.getContent();i.addUserDataProperty&&i.addUserDataProperty(e,t)},i.prototype.removeUserDataProperty=function(e){var t=this.impl.getContent();t.removeUserDataProperty&&t.removeUserDataProperty(e)},i}),define("DS/UrbanAPI/xCityViewshedCamera",["DS/UrbanAPI/xCityItem"],function(e){"use strict";function t(t){e.call(this,t)}return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t}),define("DS/UrbanAPI/xCityPoint",["DS/UrbanAPI/xCityItem","DS/UrbanAPI/xCityError"],function(e,t){function i(t){e.call(this,t)}return i.prototype=Object.create(e.prototype),i.prototype.constructor=i,i.prototype.get=function(t){var i=void 0;switch(t){case"position":i=this.impl.getContent().getLocalPosition();break;default:i=e.prototype.get.call(this,t)}return i},i.prototype.addUserDataProperty=function(e,t){this.impl.getContent().addUserDataProperty(e,t)},i.prototype.removeUserDataProperty=function(e){this.impl.getContent().removeUserDataProperty(e)},i.prototype.getTransformedGeoJSON=function(){return this.impl.getContent().getTransformedGeoJSON()},i}),define("DS/UrbanAPI/xCityLine",["DS/UrbanAPI/xCityItem","DS/UrbanAPI/xCityError"],function(e,t){function i(t){e.call(this,t)}return i.prototype=Object.create(e.prototype),i.prototype.constructor=i,i.prototype.get=function(t){var i=void 0;switch(t){case"position":i=this.impl.getContent().getLocalPosition();break;default:i=e.prototype.get.call(this,t)}return i},i.prototype.addUserDataProperty=function(e,t){this.impl.getContent().addUserDataProperty(e,t)},i.prototype.removeUserDataProperty=function(e){this.impl.getContent().removeUserDataProperty(e)},i.prototype.getTransformedGeoJSON=function(){return this.impl.getContent().getTransformedGeoJSON()},i}),define("DS/UrbanAPI/xCityViewshed",["DS/UrbanAPI/xCityItem","DS/UrbanAPI/xCityFolder","DS/UrbanAPI/xCityError"],function(e,t,i){function n(e){t.call(this,e)}return n.prototype=Object.create(t.prototype),n.prototype.constructor=n,n.prototype.getNbCameras=function(){for(var e=0,t=this.impl.get("children").length,i=0;i<t;i++){var n=this.impl.getChild(i);if(n&&n.getContent())"ViewshedCamera"===n.getContent().metaData.className&&e++}return e},n}),define("DS/UrbanAPI/xCityCluster",["DS/UrbanAPI/xCityItem","DS/UrbanAPI/xCityError","DS/xCityBasicUtils/Utils"],function(e,t,i){"use strict";function n(t){e.call(this,t)}return n.prototype=Object.create(e.prototype),n.prototype.constructor=n,n.prototype.get=function(t){var i;switch(t){case"nbFeatures":i=this.impl.getContent()._leaves.length;break;case"listFeatures":i=this.impl.getContent()._leaves;break;case"position":i=this.impl.getContent().getLocalPosition();break;case"factory":i=this.impl.getContent()._layer._node.name;break;case"layer":i=xCity.findItem({id:this.impl.getContent()._layer._itemParent.id});break;default:i=e.prototype.get.call(this,t)}return i},n.prototype.moveToChildren=function(e){this.get("Content").moveToChildren(e)},n.prototype.moveToInitial=function(e){this.get("Content").moveToInitial(e)},n.prototype.moveToParent=function(e){this.get("Content").moveToParent(e)},n.prototype.getListAttributes=function(){var t=[];return t.push("position"),t.push("factory"),t.push("layer"),t.push("nbFeatures"),t.push("listFeatures"),e.prototype.getListAttributes.call(this,t)},n.prototype.getListRenderingAttributes=function(){var e=null,t=[],n=this.impl.getContent();return i.is(n)&&i.is(n._layer)&&(e=n._layer.getRendering()),i.is(e)&&(t=t.concat(e.getListPrimitiveRenderingAttributes())),t},n}),define("DS/UrbanAPI/xCityBuilding",["DS/UrbanAPI/xCityItem","DS/UrbanAPI/xCityError"],function(e,t){function i(t){e.call(this,t)}return i.prototype=Object.create(e.prototype),i.prototype.constructor=i,i.prototype.get=function(t){var i=void 0;switch(t){case"position":i=this.impl.getContent().getLocalPosition();break;default:i=e.prototype.get.call(this,t)}return i},i.prototype.getListAttributes=function(t){var i=e.prototype.getListAttributes.call(this,t);if(!this.isHouse()){var n=["length","width","Dimensions"];i=i.filter(function(e){return n.indexOf(e)<0})}return i},i.prototype.addUserDataProperty=function(e,t){this.impl.getContent().addUserDataProperty(e,t)},i.prototype.removeUserDataProperty=function(e){this.impl.getContent().removeUserDataProperty(e)},i.prototype.setWidth=function(e){this.impl.getContent().setWidth(e)},i.prototype.setLength=function(e){this.impl.getContent().setLength(e)},i.prototype.getWidth=function(){return this.impl.getContent().getWidth()},i.prototype.getLength=function(){return this.impl.getContent().getLength()},i.prototype.isHouse=function(){return this.impl.getContent().isHouse()},i.prototype.getTransformedGeoJSON=function(){return this.impl.getContent().getTransformedGeoJSON()},i.prototype.getConstructionAttributes=function(){return this.impl.getContent().getConstructionAttributes()},i.prototype.getAttributeListImpactingGeoJSON=function(){return this.impl.getContent().getAttributeListImpactingGeoJSON()},i}),define("DS/UrbanAPI/xCityPolygon",["DS/UrbanAPI/xCityItem","DS/UrbanAPI/xCityError"],function(e,t){function i(t){e.call(this,t)}return i.prototype=Object.create(e.prototype),i.prototype.constructor=i,i.prototype.get=function(t){var i=void 0;switch(t){case"position":i=this.impl.getContent().getLocalPosition();break;default:i=e.prototype.get.call(this,t)}return i},i.prototype.addUserDataProperty=function(e,t){this.impl.getContent().addUserDataProperty(e,t)},i.prototype.removeUserDataProperty=function(e){this.impl.getContent().removeUserDataProperty(e)},i.prototype.getTransformedGeoJSON=function(){return this.impl.getContent().getTransformedGeoJSON()},i}),define("DS/UrbanAPI/xCityMarker",["DS/UrbanAPI/xCityItem"],function(e){"use strict";function t(t){e.call(this,t)}return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t}),define("DS/UrbanAPI/xCityAPI",["DS/UrbanCore/Urban","DS/XCityTools/Geocoder","DS/XCityModel/PointOfInterest","DS/XCityModel/Folder","DS/UrbanFeature/Viewshed","DS/XCityModel/Feature","DS/UrbanAPI/xCityItem","DS/UrbanAPI/xCityViewshed","DS/UrbanAPI/xCityViewshedCamera","DS/UrbanAPI/xCityPointOfInterest","DS/UrbanAPI/xCityMarker","DS/UrbanAPI/xCityFolder","DS/UrbanAPI/xCityPrimitive","DS/UrbanAPI/xCityCluster","DS/UrbanAPI/xCityLine","DS/UrbanAPI/xCityPolygon","DS/UrbanAPI/xCityBuilding","DS/UrbanAPI/xCityPoint","DS/UrbanAPI/xCityLight","DS/UrbanAPI/xCityLayer","DS/UrbanAPI/xCityRenderingProfile","DS/UrbanAPI/xCityPerformanceProfile","DS/UrbanTool/Utils","DS/UrbanTool/FocusManager","DS/UrbanAPI/xCityError","DS/Visualization/ThreeJS_DS","DS/XCityTools/Debug","DS/XCityCore/Terrain","DS/XCityTools/EventDispatcher","DS/XCityTools/Downloader","DS/UrbanTool/TemporaryFolder","DS/xCityBasicUtils/DataFormatTools","DS/CSICommandBinder/CSICommandBinder","DS/AfrCS/AfrCore","DS/UrbanAPI/xCityExpression","DS/UrbanAPI/xCityFilter","DS/UrbanAPI/xCityTerrain","DS/XCityGeometry/MarkerManager","DS/UrbanAPI/xCityHeatMapTool"],function(e,t,i,n,r,o,a,s,u,l,c,p,d,g,f,h,y,m,v,b,C,P,S,D,I,w,x,_,O,R,A,U,V,T,L,M,E,j,k){"use strict";var N=null;function F(){var i,x,N,G=!1,J={Default:a,PointOfInterest:l,Annotation:c,Line:f,LineSet:b,Polygon:h,PolygonSet:b,BuildingSet:y,PointOfInterest3DSet:b,PointOfInterest3D:m,SimplePointOfInterest3D:m,RdbLink:b,GeometrySet:b,LayerVectorPrimitive:d,LayerVectorCluster:g,Marker:c,Viewshed:s,ViewshedCamera:u,Light:v},z=[],B={},H={};this.createApp=function(t,n,r){if(G)I.alreadyCreated();else{x=this,S.is(i)||(i=new e(t)).init(t);var o,a=["debug","configPath","displayContextualMenu","displayCompass","FocusManager"],s=!1;for(o in t)t.hasOwnProperty(o)&&a.indexOf(o)>-1&&(s=!0);s?this.setupApp(t,n,r):n&&n(),G=!0}},this.setupApp=function(e,t,n){var r;(t||n)&&(r=function(e,i){S.is(t)&&!S.is(i)&&t(e),S.is(n)&&S.is(i)&&n(i,e)}),e.onComplete=function(e,t){r&&r(e,ie(t))},i.setup(e.configPath||e.configObject,e)},this.resetApp=function(){i.reset()},Object.defineProperty(F.prototype,"_urbanImpl",{get:function(){return I.deprecated("_urbanImpl"),i}}),Object.defineProperty(window,"xCity",{get:function(){return x}}),N={cameraPosition:{get:function(){return i.getViewpoint().getPosition().clone()},set:function(){I.readOnlyError("cameraPosition")}},date:{get:function(){return new Date(i.getDateTime().getDate())},set:function(e){if(e instanceof Date)i.getDateTime().setDate(e);else{var t=i.getDateTime().getDate();void 0!==e.milliseconds&&t.setMilliseconds(e.milliseconds),void 0!==e.seconds&&t.setSeconds(e.seconds),void 0!==e.minutes&&t.setMinutes(e.minutes),void 0!==e.hours&&t.setHours(e.hours),void 0!==e.day&&t.setDate(e.day-1),void 0!==e.month&&t.setMonth(e.month-1),void 0!==e.year&&t.setFullYear(e.year),O.publish(O.eventsList.date,i.getDateTime())}}},compassAlignment:{get:function(){if(S.is(i.compass))return i.compass.getAlignment()},set:function(e){S.is(i.compass)&&i.compass.setAlignment(e)}},compassVisibility:{get:function(){if(S.is(i.compass))return i.compass.getVisibility()},set:function(e){S.is(i.compass)||i._initCompass(),e?i.compass.show():i.compass.hide()}},debug:{get:function(){return i._debugMode},set:function(e){i._setDebugMode(e)}},focusManager:{get:function(){return D.enabled()},set:function(e){!0===e?D.activate():D.deactivate()}},fieldOfView:{get:function(){return i.getViewpoint().camera.fov},set:function(e){i.getViewpoint().camera.fov=e}},areaInView:{get:function(){return i.getViewpoint().getAreaInView()},set:function(e){I.readOnlyError("areaInView")}},groundAltitude:{get:function(){return i.getViewpoint().getGroundHeight()},set:function(){I.readOnlyError("groundAltitude")}},manipulatorParams:{get:function(){return i.getView3D().getControl().getParams()},set:function(e){for(var t in e)i.getView3D().getControl().getParams()[t]=e[t]}},manipulatorProfile:{get:function(){return i.getView3D().getControl().type},set:function(e){var t;"object"==typeof e&&(t=e,e=e.type),"measureAltitude"===e&&console.warn("deprecated: measureAltitude is deprecated, you should use 'altitude' instead."),i.getView3D().setControl(i.getView3D().manipulators[e],t)}},performanceProfile:{get:function(){return i.getPerformanceProfileManager().getCurrentProfileName()},set:function(e){i.getPerformanceProfileManager().setProfile(e)}},projection:{get:function(){return t.getDefaultProjection()}},rejectedDatasetList:{get:function(){return R.getRejectedDatasetList()}},realisticWater:{get:function(){return _._isOceanEnabled()},set:function(e){ne("rendering",i.getRenderingProfileManager().getTopProfile()).realisticWater=e}},renderingProfile:{get:function(){return i.getRenderingProfileManager().getCurrentProfileName()},set:function(e){this.getRenderingProfile(e);i.getRenderingProfileManager().setProfile(e)}},version:{get:function(){return i.getPluginVersion()},set:function(e){I.readOnlyError("version")}},pointOfView:{get:function(){var e=i.getViewpoint().get(),t={className:"PointOfView"};return t.position=t.target=e.target,t.rotation=e.angle,t.rotationRad=e.angle.clone().multiplyScalar(Math.PI/180),t.length=e.length,t},set:function(e){I.readOnlyError("pointOfView")}},selectedItems:{get:function(){var e=[],t=0;return i.modelSelection.getSelection().forEach(function(i){e[t]=ie(i),t+=1}),e},set:function(e){I.readOnlyError("selectedItems")}},targetPosition:{get:function(){return console.warn("deprecated: you can find this information in xCity.pointOfView.target"),i.getViewpoint().getTarget()},set:function(){I.readOnlyError("targetPosition")}},distanceToTarget:{get:function(){return console.warn("deprecated: you can find this information in xCity.pointOfView.length"),i.getViewpoint().getLength()},set:function(){I.readOnlyError("distanceToTarget")}},effect:{get:function(){return i.getEnvironment().getParams()},set:function(e){ne("rendering",i.getRenderingProfileManager().getTopProfile()).effect=e}},loadInfo:{get:function(){return i.getLayerRoot().getRoot().get("loadInfo")},set:function(e){I.readOnlyError("loadInfo")}}},(z=Object.keys(N)).forEach(function(e){Object.defineProperty(F.prototype,e,N[e])}),Object.defineProperty(F.prototype,"properties",{get:function(){return z}}),this.add3DContent=function(e,t,s){var u,l,c,p=s,d=function(e){var t;S.is(e)&&(S.is(e.get)&&S.is(e.get("id"))?t=e.get("id"):S.is(e.feature)&&S.is(e.feature.id)?t=e.feature.id:S.is(e.id)&&(t=e.id));return t}(e),g=!1;if(function(e){var t=!1;S.is(x.findItem({id:e}))&&(t=!0);return t}(d))console.warn("You are trying to add a new 3D content with an already used ID."),u=this.findItem({id:d});else{if(e instanceof a)(u=new o(e.impl)).setContent(e.impl.getContent());else if(S.is(e.feature)){u="Folder"===e.feature.className?new n:"Viewshed"===e.feature.className?new r:new o;var f=function(t){void 0!==e.readyCB&&e.readyCB(ie(u),t)};p=e.parentFolder,l=e.index,p?(g=!0,u.loadJSON(i,e.feature,p.impl,!0,e.pno,f,l)):u.loadJSON(i,e.feature,null,!1,e.pno,f,void 0)}else"Viewshed"===e.className?(u=new r).loadJSON(i,e):((u=new o).loadJSON(i,e),S.is(t)&&(console.warn('Deprecated: use add3DContent({"feature":myJSONFeature, "parentFolder": parentFolder, "index":index}) '),c={Geometry:t},u.loadJSON(i,c)));g||re(u,p,l)}var h=ie(u);return h&&e.progressCB&&h.onChange("loadInfo",e.progressCB),h},this.getUrlArgument=function(e){if(S.is(i))return i.url.getArgument(e)},this.lockLightUpdate=function(e){!0===e?i.getEnvironment().sun.lockUpdateLight():i.getEnvironment().sun.unlockUpdateLight()},this.addCredentials=function(e,t){R.setCredentials(e,t)},this.resetCredentials=function(){R.resetCredentials()},this.getLayerPrimitives=function(e,t,i,n,r){e&&e.getLayerPrimitives&&e.getLayerPrimitives(t,i,n,r)},this.toJSON=function(e,t){var i,n,r=W(e);return t||(i=X(r)),n=q(r),K(i),n};var W=function(e){var t;return t=e instanceof a?e:x.findItem(e),t=S.is(t)?t.impl:i.getLayerRoot().getRoot()},X=function(e){var t,i,n;return S.is(e.findChildById)&&(n=e.findChildById("TemporaryItems",!0),S.is(n)&&(t=n.getItemParent(),i=n._order,t.get("children")._models.splice(i,1))),{parent:t,index:i,temporaryItems:n}},q=function(e){return JSON.stringify(e,function(e,t){return"node"===e?void 0:t})},K=function(e){S.is(e)&&S.is(e.parent)&&e.parent.get("children")._models.splice(e.index,0,e.temporaryItems)};function Y(e){var t,n,r,o,s;return e instanceof w.Vector3?t=e:S.is(e.x)&&S.is(e.y)&&S.is(e.z)?t=x.objectToVector3(e):S.is(e.x)&&S.is(e.y)&&!S.is(e.z)?t=x.objectToVector3({x:e.x,y:e.y,z:0}):3===e.length?t=x.arrayToVector3(e):2===e.length?(e[2]=0,t=x.arrayToVector3(e)):e instanceof a?(o=(n=e).get("PointOfView"),s=n.get("Content"),o?r=o.getLocalPosition(i):s&&(r=s.getLocalPosition(i)||s.getBoundingSphere().center),t=r.clone()):(S.is(e.id)||S.is(e.name))&&(t=this.findItem(e).get("position")),t}this.convertGeojsonToWKT=function(e){for(var t,i=0;i<e.features.length;i++){if(S.is(t)&&t!==e.features[i].geometry.type)return;t=e.features[i].geometry.type}return U.fromArrayToWKT(U.fromJSONToArray(e),t)},this.removeChild=function(e,t){var n=this.findItem(e),r=n.impl._itemParent||i.getLayerRoot().getRoot();S.is(t)&&(r=this.findItem(t).impl),n&&(n instanceof d&&(n.removeRenderingAttributes(),n.set("visible",!0)),r.removeChild(n.impl))},this.addFolder=function(e,t,r){var o=new n;return o.loadJSON(i,e),re(o,t,r),ie(o)},this.appendJSONConfig=function(e,t){i.getLayerRoot().loadJSONUrl(e,t)},this.doProjection=function(e,i,n,r){var o,a,s=new w.Vector3,u=t.getDefaultProjection(),l="WGS84";if(Array.isArray(e)&&(a=this.arrayToVector3(e)),e instanceof w.Vector3&&(a=e),e instanceof w.Vector3||e.x&&e.y&&e.z&&(a=this.objectToVector3(e)),S.is(a))return"WGS84"===u&&(l="EPSG:900913"),i&&(o=u,u=l,l=o),S.is(n)?S.is(n.input)&&S.is(n.output)?s=t.proj(a,n.input,n.output,r):(S.is(n.input)&&(s=t.proj2world(a,n.input,r)),S.is(n.output)&&(s=t.world2proj(a,n.output,r))):s=t.proj(a,u,l,r),s},this.loadProjection=function(e,i){t.loadProjection(e,i)},this.findItem=function(e){var t,n=["_root","_Root","root","Root"];if(S.is(e)){if(e instanceof a)return e;S.is(e.name)&&(t=i.getLayerRoot().getRoot().findChildByName(e.name,!0)),S.is(e.id)&&(t=i.getLayerRoot().getRoot().findChildById(e.id,!0)),!S.is(t)&&(n.indexOf(e.name)>-1||n.indexOf(e.id)>-1)&&(t=i.getLayerRoot().getRoot()),void 0===t&&(t=e.impl)}return t?ie(t):void 0},this.loadPerformanceProfiles=function(e,t){var n=i.getPerformanceProfileManager();t&&n.addEventOnce("onProfilesLoaded",t),n.loadProfiles(e)},this.getJSONPerformanceProfile=function(){var e=i.getPerformanceProfileManager(),t=e.getProfile(e.getCurrentProfileName());return S.is(t)||(t=e.createProfile(e.getCurrentProfileName()),e.dispatchAddedEvent(e.getCurrentProfileName())),t._getInputProfile()},this.getPerformanceProfile=function(e){var t=i.getPerformanceProfileManager().getProfile(e);return S.is(t)?ne("performance",t):null},this.deletePerformanceProfile=function(e){return i.getPerformanceProfileManager().removeProfile(e)},this.loadRenderingProfiles=function(e,t){var n=i.getRenderingProfileManager();t&&n.addEventOnce("onProfilesLoaded",t),n.loadProfiles(e)},this.getRenderingProfile=function(e){var t=i.getRenderingProfileManager().getProfile(e);return S.is(t)?ne("rendering",t):null},this.getFrmWindow=function(){return i.frmWindow},this.get3DRootNode=function(){return i.getView3D()._rootProjShifted},this.getDefaultRenderingProfile=function(){return ne("rendering",i.getRenderingProfileManager().getDefaultProfile())},this.getSessionRenderingProfile=function(){return ne("rendering",i.getRenderingProfileManager().getSessionProfile())},this.deleteRenderingProfile=function(e){i.getRenderingProfileManager().removeProfile(e)},this.getJSONRenderingProfile=function(){var e=i.getRenderingProfileManager(),t=e.getProfile(e.getCurrentProfileName());return S.is(t)||(t=e.createProfile(e.getCurrentProfileName()),e.dispatchAddedEvent(e.getCurrentProfileName())),t._getInputProfile()},this.moveToTarget=function(e,t,n,r,o){var a,s,u;if(o)var l=O.subscribeTo(O.eventsList.onStopAnimation,function(){O.unsubscribe(l),o()});if(S.is(n)&&S.is(r))a=Y(n),s=Y(e),u=i.getView3D().getControl().moveTo(s,a,r,t),o&&null===u&&o();else{var c=this.findItem(e);c&&(0===t?(u=i.getView3D().getControl().teleportToFeature(c.impl),o&&null===u&&o()):(u=i.getView3D().getControl().moveToFeature(c.impl,t),o&&null===u&&o()))}},this.snapLayerToGround=function(e){var t=this.findItem(e);t&&t.getListRenderingAttributes().includes("elevationMode")&&("ground"===t.get("elevationMode")&&t.set("elevationMode","advanced"),t.set("elevationMode","ground"))},this.moveToViewFromPoint=function(e,t,n){var r=Y(e),o=Y(t);if(!S.areSamePosition(r,o)){x.manipulatorProfile="default";var a,s=r.distanceTo(o),u=o.clone().sub(r);u.normalize();a=O.subscribeTo(O.eventsList.onStopAnimation,function(){"fixed"!==x.manipulatorProfile&&(x.manipulatorProfile="fixed",O.unsubscribe(a))});var l=S.getQuaternionFromEye(u);i.getView3D().getControl().moveToWithOrientation(o,s,u,n,l)}},this.onAppLoaded=function(e){R._datasetToCheckList<1&&i.urbanLoaded?e():O.subscribeTo(O.eventsList.onLoaded,e)},this.onWorldClick=function(e,t){i.getView3D().getControl().addEvent("onUrbanClick",function(){var n=i.getView3D().getControl();e(t?n.getLastLatLon():n.getLastPick())})},this.removeOnWorldClick=function(){i.getView3D().getControl().removeEvent("onUrbanClick")},this.getGroundHeight=function(e){if(S.is(e)){var t=Y(e);return i.getView3D().getGroundHeight(t.x,t.y)}},this.get3DPosition=function(e){var t=this.convertToVec3(e);return i.getView3D().getControl().exactPick(t)},this.onItemDeselect=function(e){var t=function(t,i){te(t,e)}.bind(this);H[e]=t,i.getLayerSelection().addEvent("onDeselect",t)},this.removeOnItemDeselect=function(e){var t;if(S.is(e))i.getLayerSelection().removeEvent("onDeselect",H[e]),delete H[e];else for(t in H)i.getLayerSelection().removeEvent("onDeselect",H[t]),delete H[t]},this.onItemSelect=function(e){var t=function(t,i){te(t,e,i)}.bind(this);B[e]=t,i.getLayerSelection().addEvent("onSelect",t)},this.onExternalItemSelect=function(e){i.getView3D().getPicker().getObjectSelection().addEvent("onObjectSelect",e)},this.onExternalItemDeselect=function(e){i.getView3D().getPicker().getObjectSelection().addEvent("onObjectDeselect",e)},this.onEmptySelect=function(e){i.getView3D().getPicker().getObjectSelection().addEvent("onEmptySelect",e)},this.onClearExternalSelection=function(e){i.getView3D().getPicker().getObjectSelection().addEvent("onClearSelection",e)},this.removeOnExternalItemSelect=function(e){e&&i.getView3D().getPicker().getObjectSelection().removeEvent("onObjectSelect",e)},this.removeOnExternalItemDeselect=function(e){e&&i.getView3D().getPicker().getObjectSelection().removeEvent("onObjectDeselect",e)},this.removeOnEmptySelect=function(e){e&&i.getView3D().getPicker().getObjectSelection().removeEvent("onEmptySelect",e)},this.removeOnClearExternalSelection=function(e){e&&i.getView3D().getPicker().getObjectSelection().removeEvent("onClearSelection",e)},this.removeOnItemSelect=function(e){var t;if(S.is(e))i.getLayerSelection().removeEvent("onSelect",B[e]),delete B[e];else for(t in B)i.getLayerSelection().removeEvent("onSelect",B[t]),delete B[t]},this.getPerformanceProfiles=function(){return i.getPerformanceProfileManager().getProfileNames()},this.getRenderingProfiles=function(){return i.getRenderingProfileManager().getProfileNames()},this.getActiveRenderingProfiles=function(){return i.getRenderingProfileManager().getActiveRenderingProfilesNames()},this.getColorGradient=function(e,t){var i;if(S.is(t)||(t={}),i=S.getColorGradient(e,t),S.is(i)&&i.getHexString)return"#"+i.getHexString()},this.traverseDataModel=function(e){i.getLayerRoot().getRoot().traverse(function(t){e(ie(t))},!0)},this.getDataModelVisibility=function(){var e=[];return i.getLayerRoot().getRoot().traverse(function(t){var i=ie(t);i.impl._attributes.Content&&"Bookmark"===i.impl._attributes.Content.metaData.className||e.push({name:i.get("name"),id:i.get("id"),visible:i.get("visible")})},!0),e};var Q,Z={};function $(e){var t=e||x.manipulatorProfile;return S.is(i.getView3D().manipulators[t].tool)||(t=x.addManipulator()),t}function ee(e,t){for(var i=e.slice(),n=t.length;n--;)i.indexOf(t[n])<=0&&i.push(t[n]);return i}function te(e,t,i){t&&t(ie(e),i)}function ie(e){var t,i;return S.is(e)&&(e instanceof a?t=e:e.getContent()?(i=e.getContent().metaData.className,J.hasOwnProperty(i)&&(t=new J[i](e))):"Viewshed"===e.metaData.className?t=new s(e):e instanceof n&&(t=new p(e)),void 0===t&&(t=new J.Default(e))),t}function ne(e,t){var i;return t&&("rendering"===e?i=new C(t):"performance"===e&&(i=new P(t))),i}function re(e,t,n){var r;t?(r=ie(e),t.addChild(r,n)):i.getLayerRoot().getRoot().addChild(e,n)}this.onChange=function(e,t){if("loadInfo"===e){i.getLayerRoot().getRoot().addEvent("onChange:"+e,t);var n=UWA.Utils.getUUID();return Z[n]=[e,t],n}if(S.is(O.eventsList[e]))return O.subscribeTo(O.eventsList[e],t)},this.removeOnChange=function(e){if(S.is(Z[e])){var t=Z[e];i.getLayerRoot().getRoot().removeEvent("onChange:"+t[0],t[1])}else O.unsubscribe(e)},this.addManipulator=function(e){return i.getView3D().addDrawingManipulator(e)},this.assignManipulatorToShape=function(e,t){var n=function(e){return e instanceof a&&("Line"===e.get("className")||"Polygon"===e.get("className")||"BuildingSet"===e.get("className")||"SimplePointOfInterest3D"===e.get("className")||"FactoryLine"===e.get("factory")||"FactoryPolygon"===e.get("factory"))?e.get("geojson"):"object"==typeof e?e:void 0}(e);return x.manipulatorProfile=$(t),i.getView3D().manipulators[x.manipulatorProfile].drawShape(n)},this.setManipulatorContext=function(e,t){var n,r=e;if(e instanceof a){r={Line:{id:e.get("id"),name:e.get("name")},Folder:{id:e.getParentFolder().get("id"),name:e.getParentFolder().get("name")}},n=function(e){var t;if(e instanceof a){var i=e.get("className"),n=e.get("factory");switch(i){case"PointOfInterest3DSet":case"PointOfInterest3D":case"SimplePointOfInterest3D":case"Line":case"LineSet":case"Polygon":case"PolygonSet":case"BuildingSet":t=e.get("geojson");break;case"Marker":t=U.fromArrayToJSON([e.get("position").toArray()],"point");break;default:switch(n){case"FactoryLine":case"FactoryPolygon":t=e.get("geojson");break;default:"object"==typeof e&&(t=e)}}}else"object"==typeof e&&(t=e);return t}(e)}var o="nothing";n&&n.features&&n.features[0]&&n.features[0].geometry&&(o=n.features[0].geometry.type);var s=o.toUpperCase();if("MULTILINESTRING"===s||"MULTIPOLYGON"===s)return!1;x.manipulatorProfile=$(t);var u=i.getView3D().manipulators[x.manipulatorProfile];return u.setCurrentContext(r),n?u.drawShape(n):void 0},this.getManipulatorContext=function(){var e,t=i.getView3D().manipulators[x.manipulatorProfile];return t&&t.tool&&(e=t.tool.getCurrentContext()),e},this.snap=function(e){return i.getView3D().getRecorder().takeSingleSnap(e)},this.getTemporaryFolder=function(e,t){return A.start(i),ie(A.getFolder(e,t))},this.getAllRenderingIds=function(){for(var e=x.getRenderingProfiles(),t=e.length,i=[];t--;)i=ee(i,x.getRenderingProfile(e[t]).getAllIds()||[]);var n=i.indexOf("Ground");return n>=0&&i.splice(n,1),(n=i.indexOf("Sky"))>=0&&i.splice(n,1),i},this.renderScene=function(){S.is(i)&&S.is(i.USR)&&i.USR.render()},this.getNbViewsheds=function(e){var t=0;return i.getLayerRoot().getRoot().traverse(function(e){"Viewshed"===e.metaData.className&&t++},!0),t},this.addViewshedCamera=function(e){console.warn("deprecated! Viewhed is now part of experience datamodel")},this.removeViewshedCamera=function(e){console.warn("deprecated! Viewhed is now part of experience datamodel")},this.disableViewshed=function(){console.warn("deprecated! Viewhed is now part of experience datamodel")},this.enableViewshed=function(){console.warn("deprecated! Viewhed is now part of experience datamodel")},this.modifyViewshedCamera=function(e){console.warn("deprecated! Viewhed is now part of experience datamodel")},this.resizeViewshedMaps=function(e,t){console.warn("deprecated! Viewhed is now part of experience datamodel")},this.changeViewshedColors=function(e){console.warn("deprecated! Viewhed is now part of experience datamodel")},this.enableRobot=function(e,t){S.is(i)&&S.is(i.USR)&&S.is(t)&&S.is(t.impl)&&i.USR.setRobotTarget(t.impl,e)},this.connectToEKServer=function(e){var t=V.getDefaultResponse(),i=e.nodeIfos,n=e.poolInfos,r=n.id;if(S.is(n)){var o=n.serverId,a=V.getPool(r).createNode(i),s=a.select(o);a.subscribe(s,"viewUpdate",t),T.setClientNode(a),T.setServerNodeId(s);var u=document.createElement("div");u.id="IPMachine",u.innerHTML=document.location.hostname,u.style="display: none;",document.body.appendChild(u)}},this.createExpression=function(e){return new L(e)},this.createFilter=function(){return new M},this.convertToVec3=function(e){var t;return S.is(e)&&(e instanceof w.Vector3?t=e:S.is(e.x)&&S.is(e.y)?t=x.objectToVector3(e):!Array.isArray(e)||2!==e.length&&3!==e.length||"number"!=typeof e[0]||(t=x.arrayToVector3(e))),t},this.objectToVector3=function(e){return new w.Vector3(e.x,e.y,e.z)},this.arrayToVector3=function(e){return new w.Vector3(e[0],e[1],e[2])},this.objectToArray=function(e){return[e.x,e.y,e.z]},this.getTerrain=function(){return E},this.getMarkerManager=function(){return j},this.getHeatMapTool=function(){return Q||(Q=new k(i)),Q};var oe=function(e,t,i){for(var n in e)e.hasOwnProperty(n)&&(e[n]&&"object"==typeof e[n]?"geojson"!==n&&oe(e[n],t,i):"id"===n&&t(e,e[n],i))},ae=function(e,t,i){for(var n in e)if(e.hasOwnProperty(n)){if("Effects"===n){delete e[n];continue}if("Ids"===n){t(e,e[n],i);continue}e[n]&&"object"==typeof e[n]&&ae(e[n],t,i)}},se=function(e,t,i){var n=UWA.Utils.getUUID();i[t]=n,e.id=i[t]},ue=function(e,t,i){if(Array.isArray(e.Ids))for(var n=0;n<e.Ids.length;n++)void 0!==i[e.Ids[n]]?e.Ids[n]=i[e.Ids[n]]:console.warn("Export Group : unable to migrate "+e.Ids[n]+" in array from session profile.");else void 0!==i[t]?e.Ids=i[t]:console.warn("Export Group : unable to migrate "+t+" from session profile.")};this.exportGroup=function(e,t){var i={};if(null==e)return null;var n=JSON.parse(this.toJSON(e));oe(n,se,i);var r={datamodel:JSON.stringify(n)};if(void 0===t||!0===t){var o=this.getSessionRenderingProfile(),a=JSON.stringify(o),s=JSON.parse(a);ae(s,ue,i),r.rendering=JSON.stringify(s)}return r},this.importGroup=function(e,t){var i=this._urbanImpl.getLayerRoot(),n={};if(!e||!e.datamodel)return e&&e.Root&&(oe(e,se,n),i.loadJSONFile(JSON.stringify(e))),!1;var r=JSON.parse('{"Root": ['+e.datamodel+"]}");if(oe(r,se,n),i.loadJSONFile(JSON.stringify(r)),(void 0===t||!0===t)&&e.rendering){var o=JSON.parse(e.rendering);ae(o,ue,n),this.loadRenderingProfiles([o])}return!0},this.getHighlightSet=function(e){return i.getView3D().getHighlightSet(e)},this.addHighlightSet=function(e,t){i.getView3D().addHighlightSet(e,t)},this.activateHighlightSet=function(e){i.getView3D().activateHighlightSet(e)},this.changeCurrentHighlight=function(e){var t=i.getView3D(),n=t._modelHightlighter.emptyHSO();this.activateHighlightSet(e),t._modelHightlighter.addToHSO(n)},this.setTimeRange=function(e,t,n){var r=n.impl.getContent();if(r){var o={storeId:r.get("id")};t&&(o.up=t),e&&(o.down=e),i._timefilter&&i._timefilter._deprecateStores(o)}},this.initiateTimeFiltering=function(){i.initTimeFiltering()},this.selectItem=function(e){e&&i.getView3D().getPicker().select(e.impl)},this.emptySelection=function(e){i.getView3D().getPicker().clearAllSelection(e)},this.getStylingRenderingProfile=function(){return ne("rendering",i.getRenderingProfileManager().getStylingProfile())}}return F.getInstance=function(){return null===N&&(N=new F),N},F.getInstance()});