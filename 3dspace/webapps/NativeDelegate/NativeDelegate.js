define("DS/NativeDelegate/NativeDelegate",["UWA/Class"],function(e){"use strict";var t=e.extend({init:function(e,t){this._parent(),this._name=e,this._isCpp=t||!1,this._delegateCtrl=null,this._watchTextCb=null,this._watchJSONCb=null,this._watchBinaryCb=null},getName:function(){return this._name},isCpp:function(){return this._isCpp},remove:function(){return HybridApp.removeDelegate(this._name)},execute:function(e,t){return this._delegateCtrl._executeOn(this._name,this._isCpp,e,t)},sendText:function(e){return this._delegateCtrl._sendTextOn(this._isCpp,e)},sendJson:function(e){return null!==e&&"object"==typeof e||(e={}),e.target=this._name,this._delegateCtrl._sendTextOn(this._isCpp,JSON.stringify(e))},sendBinary:function(e){return this._delegateCtrl._sendBinaryOn(this._isCpp,e)},addTextWatch:function(e){e&&(this._watchTextCb=e)},removeTextWatch:function(){this._watchTextCb=null},addJsonWatch:function(e){e&&(this._watchJSONCb=e)},removeJsonWatch:function(){this._watchJSONCb=null},addBinaryWatch:function(e){e&&(this._watchBinaryCb=e)},removeBinaryWatch:function(){this._watchBinaryCb=null},removeAllWatch:function(){this._watchTextCb=null,this._watchJSONCb=null,this._watchBinaryCb=null}});return UWA.namespace("DS/NativeDelegate/NativeDelegate",t)}),define("DS/NativeDelegate/NativeDelegateController",["UWA/Class","DS/ExperienceKernel/ExperienceKernel"],function(e,t){"use strict";var i=0,n=new Array,a=Object.freeze({DEFAULT_IP:"127.0.0.1",POOL_WEB_APP:"POOL_WEB_APP",POOL_3DX_NATIVE:"POOL_3DX_NATIVE",POOL_OS_NATIVE:"POOL_OS_NATIVE",EMIT_EVENT_KEY:"event"}),s=window.HybridAppArgs?window.HybridAppArgs.IS_EK_PROTOCOL:void 0,o=e.extend({DELEGATE_TYPE:Object.freeze({NATIVE_CPP:0,OS_SPECIFIC:1}),init:function(){this._parent(),this._webAppNode=null,this._cppNativeDelegateNodeID=null,this._nativeDelegateNodeID=null,this._isNativeDelegationAvailable=!1,this._delegateDico={},void 0!==window.HybridAppArgs&&void 0===window.jasmine?this.connectToNative():(console.warn("[ODT Mode] : HybridApp isn't connected to the native"),this._webAppNode=!0)},connectToNative:function(e){null===this._webAppNode&&(this._webAppNode=new t.Node({onText:this.onText.bind(this),onBinary:this.onBinary.bind(this),onHypervisorConnect:this.onConnection.bind(this),onHypervisorDisconnect:this.onDisconnection.bind(this),onDisconnect:this.onDisconnection.bind(this),pool:a.POOL_WEB_APP,hypervisorIp:a.DEFAULT_IP,webSocketPort:window.HybridAppArgs.webSocketPort})),null!==this._webAppNode&&(this._cppNativeDelegateNodeID=this._webAppNode.connect(a.POOL_3DX_NATIVE).select(),null!=this._cppNativeDelegateNodeID&&this._webAppNode.subscribe(this._cppNativeDelegateNodeID,a.EMIT_EVENT_KEY),s&&(this._nativeDelegateNodeID=this._webAppNode.connect(a.POOL_OS_NATIVE).select(),null!=this._nativeDelegateNodeID&&this._webAppNode.subscribe(this._nativeDelegateNodeID,a.EMIT_EVENT_KEY)))},isAvailable:function(){return this._isNativeDelegationAvailable},linkDelegate:function(e){e._delegateCtrl=this,this._delegateDico[e.getName()]=e},onText:function(e,t){var i=null;if("object"==typeof e)i=e;else try{i=JSON.parse(e)}catch(t){this._executeTextWatchCallback(e)}return null!==i&&(i.requestID?function(e,t,i){if(e){var a=n[e];a&&(a(t,i),delete n[e])}}(i.requestID,i.isSuccess,i.data):"system"==i.target?this._executeSystemCall(i.data):this._executeJsonWatchCallback(i.target,i.data)),!0},onBinary:function(e,t){this._executeBinaryWatchCallback(e)},onConnection:function(){this._isNativeDelegationAvailable=!0;document.dispatchEvent(new CustomEvent("DELEGATE_CONTROLLER",{detail:"ON_NATIVE_DELEGATION_CONNECTION"}))},onDisconnection:function(){this._webAppNode=null,this._cppNativeDelegateNodeID=null,this._nativeDelegateNodeID=null,this._isNativeDelegationAvailable=!1;var e="ON_NATIVE_DELEGATION_DISCONNECTION";console.error(e),document.dispatchEvent(new CustomEvent("DELEGATE_CONTROLLER",{detail:e}))},_executeOn:function(e,t,a,s){var o=++i,c={target:e,action:a,data:s,requestID:o},l=new Promise(function(e,t){var i;i=function(i,n){i?e(n):t(n)},n[o]=i});return this._sendTextOn(t,JSON.stringify(c)),l},_sendTextOn:function(e,t){if(!this._webAppNode||void 0===e||void 0===t)throw new Error("Missing args");return e?this._webAppNode.sendText(this._cppNativeDelegateNodeID,t):s?this._webAppNode.sendText(this._nativeDelegateNodeID,t):void HybridApp.__postTextMsgToNative(t)},_sendBinaryOn:function(e,t){if(!this._webAppNode||void 0===e||void 0===t)throw new Error("Missing args");return e?this._webAppNode.sendBinary(this._cppNativeDelegateNodeID,t):s?this._webAppNode.sendBinary(this._nativeDelegateNodeID,t):void HybridApp.__postBinaryMsgToNative(t)},_executeSystemCall:function(e){var t={detail:{id:e.id,args:e.args||void 0}};document.dispatchEvent(new CustomEvent(e.type,t))},_executeTextWatchCallback:function(e){for(var t in this._delegateDico){var i=this._delegateDico[t];i&&i._watchTextCb&&i._watchTextCb(e)}},_executeBinaryWatchCallback:function(e){for(var t in this._delegateDico){var i=this._delegateDico[t];i&&i._watchBinaryCb&&i._watchBinaryCb(e)}},_executeJsonWatchCallback:function(e,t){var i=this._delegateDico[e];i&&i._watchJSONCb&&i._watchJSONCb(t)}});return UWA.namespace("DS/NativeDelegate/NativeDelegateController",o)});