define("DS/3DPlayWidgetViews/W3DPlayerView",["DS/CoreEvents/Events","UWA/Class","DS/3DPlayHelper/3DPlayHelper","DS/3DPlaySupport/AssetSupport","i18n!DS/3DPlayHelper/assets/nls/SplashScreen","css!DS/3DPlayWidgetViews/W3DPlayerView","DS/WebSystem/Environment","DS/WebappsUtils/WebappsUtils","DS/WebUtils/Tracker"],function(e,t,a,i,n,s,o,r,l){"use strict";var d,c,g,p,m=[];return t.extend({init:function(t,a){d=t,c=a,this._parent(t,a),p=this,m.push(e.subscribeOnce({event:"PrefsCtrl.PreferencesReady"},function(e){p.instantiate3DPlayWebPlayer()})),m.push(e.subscribe({event:"Player.load"},function(e){g&&(g.load(e),e&&e.input&&e.input.asset&&e.input.asset.localFile&&d.setTitle(e.input.asset.localFile.name))})),m.push(e.subscribe({event:"Model.changeCurrent"},function(e){p.instantiate3DPlayWebPlayer()})),m.push(e.subscribe({event:"Model.changeCSO"},function(e){var t;g.instance&&g.instance.pad3DViewer&&(t=g.instance.pad3DViewer._lockCSONotification,g.instance.pad3DViewer._lockCSONotification=!0),g.emptySelection(),g.selectNode(e);setTimeout(function(){g.instance&&g.instance.pad3DViewer&&(g.instance.pad3DViewer._lockCSONotification=t)},50)}))},instantiate3DPlayWebPlayer:function(){var e=c.getCurrentData();o.isSet("3DPlay.Debug")&&console.log("3DPlay.Debug:instantiate3DPlayWebPlayer",e),e.displayName?c.setCurrentTitle(e.displayName):d.setTitle(""),c.get3DPlayWebInputObject(e,function(t){t.container=c.getCanvasDiv(),t.input&&t.input.asset&&(t.input.asset.displayname=e.displayName),p.startPlayer(t)})},dispose:function(t){g&&(g.dispose(t),g=null),d=null,c=null,p=null;for(var a=0;a<m.length;a++)e.unsubscribe(m[a]);m=[]},startPlayer:function(e){this.applicationFrameOptions&&e.options&&(e.options.callbacks&&(e.options.callbacks=UWA.extend(e.options.callbacks,this.applicationFrameOptions.options.callbacks,!0)),e.options=UWA.extend(e.options,this.applicationFrameOptions.options,!0),e.input&&this.applicationFrameOptions.experience&&(e.input.experience=this.applicationFrameOptions.experience,delete this.applicationFrameOptions.experience)),this.applicationFrameOptions&&this.applicationFrameOptions.options&&this.applicationFrameOptions.options.pad3DViewer&&delete this.applicationFrameOptions.options.pad3DViewer,g?g.isReady()?g.load(e):c.isPendingLoadingCozNotReady=!0:(e.options.callbacks.EXPERIENCE=e.options.callbacks.EXPERIENCE||{},e.options.callbacks.EXPERIENCE.EXPERIENCESPLASHSCREEN=function(e){if(!o.isSet("3DPlay.LandingPage.disable")){var t=e.elements.container;t.addClassName("Landing-Page_container");var a=new UWA.Element("div",{id:"Landing-Page",class:"Landing-Page"}).inject(t);a.addContent({tag:"div",class:"lp-txt-container",html:[{tag:"h4",id:"lp-msg",class:"lp-txt font-3dsregular",html:n.DROP_MSG_LP},{tag:"img",class:"lp-drop-img",src:r.getWebappsBaseUrl()+"3DPlayWidgetViews/assets/images/Drag_and_drop_lightgrey-04.png"}]});var i=function(){var e=this.container;if(0!==e.offsetWidth&&0!==e.offsetHeight){var t=this.view;e.offsetWidth>780&&e.offsetHeight>200?(t.style.backgroundImage="url('"+r.getWebappsBaseUrl()+"3DPlayHelper/assets/images/3DPlayLandingPage.svg')",t.getElementsByTagName("h4")[0].show(),t.getElementsByTagName("img")[0].show(),t.getElementsByTagName("img")[0].removeClassName("lp-drop-img-small"),t.getElementsByTagName("img")[0].addClassName("lp-drop-img")):e.offsetWidth<779&&e.offsetWidth>581&&e.offsetHeight>200?(t.style.backgroundImage="url('"+r.getWebappsBaseUrl()+"3DPlayHelper/assets/images/3DPlayLandingPage.svg')",t.getElementsByTagName("h4")[0].show(),t.getElementsByTagName("img")[0].show(),t.getElementsByTagName("img")[0].removeClassName("lp-drop-img-small"),t.getElementsByTagName("img")[0].addClassName("lp-drop-img")):e.offsetWidth<580&&e.offsetWidth>280&&e.offsetHeight>200?(t.style.backgroundImage="url('"+r.getWebappsBaseUrl()+"3DPlayHelper/assets/images/Small-02.svg')",t.getElementsByTagName("h4")[0].hide(),t.getElementsByTagName("img")[0].show(),t.getElementsByTagName("img")[0].removeClassName("lp-drop-img"),t.getElementsByTagName("img")[0].addClassName("lp-drop-img-small")):e.offsetWidth<280||e.offsetHeight<200?(t.style.backgroundImage="url('"+r.getWebappsBaseUrl()+"3DPlayHelper/assets/images/Xsmall-03.svg')",t.getElementsByTagName("h4")[0].hide(),t.getElementsByTagName("img")[0].hide(),t.getElementsByTagName("img")[0].removeClassName("lp-drop-img"),t.getElementsByTagName("img")[0].removeClassName("lp-drop-img-small")):(t.style.backgroundImage="url('"+r.getWebappsBaseUrl()+"3DPlayHelper/assets/images/3DPlayLandingPage.svg')",t.getElementsByTagName("h4")[0].show(),t.getElementsByTagName("img")[0].show(),t.getElementsByTagName("img")[0].removeClassName("lp-drop-img-small"),t.getElementsByTagName("img")[0].addClassName("lp-drop-img"))}}.bind({container:t,view:a});t.addEvent("resize",i),i()}},g=new a(e)),c.setPlayerRef(g)},widgetRefreshHandler:function(){var e;if(g){g.instance&&g.instance.refresh&&(e=g.instance.refresh());try{var t=g.instance.args.input.experience.filename||g.instance.args.input.experience;l.trackPageEvent("infos","refresh",t,e?1:0,{count:l.incCommandCounter()})}catch(e){}if(e)return!0;g.dispose(),g=null}return c.getCanvasDiv().empty(),!1},search:function(e){g&&g.instance&&g.instance.search&&g.instance.search(e)},resetsearch:function(e){g&&g.instance&&g.instance.resetsearch&&g.instance.resetsearch(e)}})}),define("DS/3DPlayWidgetViews/W3DPlayMainView",["DS/CoreEvents/Events","DS/WebSystem/Environment","UWA/Class","css!DS/3DPlayWidget/assets/3DPlayWidget","DS/WebUtils/StringUtils","DS/WebSystem/Nls","i18n!DS/3DPlay/assets/nls/3DPlay"],function(e,t,a,i,n,s,o){"use strict";var r,l,d,c,g,p=[],m=!1;return a.extend({init:function(e,t){r=e,l=t,d=this,this.buildView(),this.createBlueBackground(),this.declareAllSubscribers()},buildView:function(){r.body.setStyle("height","100%"),this.buildCanvas()},buildCanvas:function(){if(l.applicationFrameOptions&&l.applicationFrameOptions.options&&(m=void 0!==l.applicationFrameOptions.options.pad3DViewer),this.canvasDiv=m&&l.applicationFrameOptions.options.appMainDiv?l.applicationFrameOptions.options.appMainDiv:document.getElementById("canvas-div"),!this.canvasDiv)if(this.canvasDiv=UWA.createElement("div",{class:"appMain",id:"canvas-div",html:"",styles:{overflow:"hidden"}}),m){var t=l.applicationFrameOptions.options.pad3DViewer.elements.container;this.canvasDiv.inject(t.parentNode),t.inject(this.canvasDiv)}else this.canvasDiv.inject(r.body);this.canvasDiv.id="canvas-div",this.canvasDiv.setAttribute("data-rec-id","canvasDivID"),this.canvasDiv.style.overflow="hidden",l.setCanvasDiv(this.canvasDiv),e.subscribeOnce({event:"Model.PreferencesReady"},function(e){if(!l.isPreferencesEmpty()){var t=l.getCurrentData();t.displayName&&d.updateWidgetTitle(t.displayName)}}),this.createDragAndDropZone(this.canvasDiv)},createBlueBackground:function(){if(this.backgroundContainer=document.getElementById("background_container"),!this.backgroundContainer){this.backgroundContainer=UWA.createElement("div",{id:"background_container",class:"blue_background_container",styles:{display:"none"}}),this.backgroundContainer.inject(this.canvasDiv),this.backgroundContainer.setContent({tag:"div",class:"background_container_display drop"});var e=l.getBoxMessageText("DROPIT");this.backgroundContainer.addContent({tag:"div",class:"drop_container_display"}),this.backgroundContainer.addContent({tag:"div",class:"drop_container_txt",html:[{tag:"h3",id:"drop_msg",class:"drop_invite_txt font-3dsregular drop",html:e}]})}this.drop_msgDom=this.backgroundContainer.getElement("h3.drop_invite_txt")},hideBlueBackground:function(e){this.backgroundContainer.setStyle("display",e)},displayBlueBackground:function(){this.hideBlueBackground("block")},updateBlueBackgroundMessage:function(e){var t=l.getBoxMessageText(e);this.drop_msgDom.setHTML(t)},create3DPlayInviteContainer:function(){if(this.inviteContainer=document.getElementById("pad_invite"),!this.inviteContainer){this.inviteContainer=UWA.createElement("div",{id:"pad_invite",class:"pad_invite_container",html:"Invite Container",styles:{display:"none"}}),this.inviteContainer.inject(this.canvasDiv,"before");var e=l.getBoxMessageText("DROPIT");this.inviteContainer.setContent([{tag:"div",class:"pad_invite_display drop",html:[{tag:"span",id:"invite_img",class:"pad_invite_img fonticon fonticon-3x fonticon-down-circled"},{tag:"h5",id:"invite_msg",class:"pad_invite_txt font-3dsregular drop",html:e}]}])}this.invite_imgDom=this.inviteContainer.getElement("span.pad_invite_img"),this.invite_msgDom=this.inviteContainer.getElement("h5.pad_invite_txt")},addWidgetNotification:function(e){c?g.addNotif({level:e.level,message:e.message,title:e.title,sticky:e.sticky}):require(["DS/Notifications/NotificationsManagerUXMessages","DS/Notifications/NotificationsManagerViewOnScreen"],function(t,a){g=t,(c=a).setNotificationManager(t),d.addWidgetNotification(e)})},hideLastWidgetNotification:function(){c&&c.removeLastNotificationDisplayed()},refresh:function(){var e=l.getCurrentData();e.displayName&&this.updateWidgetTitle(e.displayName)},updateWidgetHeight:function(){r.body.setStyle("height","100%")},declareAllSubscribers:function(){p.push(e.subscribe({event:"Model.changeTitle"},function(e){null!=e&&l.setCurrentTitle(e),d.refresh()}))},dispose:function(){d=null,this.removeDragAndDropZone&&this.removeDragAndDropZone(this.canvasDiv);for(var t=0;t<p.length;t++)e.unsubscribe(p[t]);p=[]},createDragAndDropZone:function(a){var i=function(e){this.removeClassName("drag_over_class"),d.hideBlueBackground("none")},s=function(a){a.preventDefault(),this.removeClassName("drag_over_class"),d.hideBlueBackground("none");var i,s=!1;l.drag=!0;try{i=JSON.parse(a.dataTransfer.getData("text"))}catch(e){}if(i)t.isSet("3DPlay.Debug")&&console.log("3DPlay.Debug:W3DPlayMainView.dropFunction",i),i&&i.data&&i.data.items&&i.data.items.length>1&&(s=!0),l.setCurrentContent(i);else if(a.dataTransfer.files&&a.dataTransfer.files.length>0&&void 0!==a.dataTransfer.files[0]){t.isSet("3DPlay.Debug")&&console.log("3DPlay.Debug:W3DPlayMainView.dropFunction",a.dataTransfer.files),s=a.dataTransfer.files.length>1;var r=a.dataTransfer.files[0],c=n.getExtension(r.name),g=["3DXML","PDF","STP","STEP"];t.isSet("3DPlay.STPA")&&g.push("STPA"),t.isSet("3DPlay.AllowDND")||g.indexOf(c.toUpperCase())>-1?e.publish({event:"Player.load",data:{input:{asset:{useConvertors:!1,localFile:r,format:c,filename:window.URL.createObjectURL(r),provider:"FILE",proxyurl:"none",requiredAuth:null,serverurl:""}}}}):(d.hideLastWidgetNotification(),d.addWidgetNotification({level:"error",title:"",message:o.DNDUnSupportedFileType+c,sticky:!1}))}if(s){d.hideLastWidgetNotification();var p={level:"info",title:o.FirstSelectedObjectLoaded_Title,message:o.FirstSelectedObjectLoaded,sticky:!1};if(l&&l.getPlayerRef()&&l.getPlayerRef().getExperience()&&d)l.getPlayerRef().getExperience().subscribeOnce("ASSET/LOADINGSTARTED",function(){d.addWidgetNotification(p)})}},r=function(e){e.preventDefault(),this.addClassName("drag_over_class"),d.displayBlueBackground(),d.updateBlueBackgroundMessage("DROPIT"),e.dataTransfer&&(e.dataTransfer.dropEffect="copy")};a.addEventListener("dragenter",r),a.addEventListener("dragover",r),a.addEventListener("dragleave",i),a.addEventListener("dragend",i),a.addEventListener("drop",s),this.removeDragAndDropZone=function(e){e.removeEventListener("dragenter",r),e.removeEventListener("dragover",r),e.removeEventListener("dragleave",i),e.removeEventListener("dragend",i),e.removeEventListener("drop",s)}},hideShowBoxMessage:function(e){this.inviteContainer.setStyle("display",e)},updateBoxMessage:function(e){var t=l.getBoxClassIcon(e),a=l.getBoxMessageText(e);"DEFAULT"==e?(this.invite_imgDom.removeClassName(t),this.invite_imgDom.addClassName("fonticon-down-circled")):(this.hideShowBoxMessage("block"),this.invite_msgDom.setHTML(a),this.invite_imgDom.removeClassName("fonticon-down-circled"),this.invite_imgDom.addClassName(t))},updateWidgetTitle:function(e){var t="3DPlay";r.setTitle(""),""!=e&&null!=e&&(t=e),r.setTitle(t)}})});