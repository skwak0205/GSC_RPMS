define("DS/CfgAnalysisCommands/commands/CfgAnalysisCmd",["UWA/Core","DS/ApplicationFrame/Command","DS/PADUtils/PADContext","DS/Utilities/Utils","DS/CfgBaseUX/scripts/CfgUtility","i18n!DS/CfgAnalysisCommands/assets/nls/CfgSelectByConfigurationCriteriaCmd","text!DS/CfgBaseUX/assets/CfgUXEnvVariables.json"],function(e,t,i,n,a,o,s){"use strict";return t.extend({init:function(e){var t=this;this._parent(e,{mode:"exclusive",isAsynchronous:!1}),this._isConfigAvailable=0,this.enable();t=this;a.rolesAvailable(function(e){e.isCFGRoleAvail&&(t._isConfigAvailable=1,t._setStateCmd())}),void 0!==i.get&&null!==i.get()?this._SelectorManager=i.get().getPADTreeDocument().getXSO():this._SelectorManager=null,null!==this._SelectorManager&&(void 0!==this._SelectorManager.onPostAdd&&this._SelectorManager.onPostAdd(this._checkSelection.bind(this)),void 0!==this._SelectorManager.onPostRemove&&this._SelectorManager.onPostRemove(this._checkSelection.bind(this)),void 0!==this._SelectorManager.onEmpty&&this._SelectorManager.onEmpty(this._checkSelection.bind(this)));t=this;void 0!==i.get&&null!==i.get()&&i.get().addEvent("editModeModified",function(e){!0===e&&t._checkSelection()})},_checkSelection:n.debounce(function(){this._SelectedID="";var e=this.getData().selectedNodes;1==e.length&&(this._SelectedID=e[0].id||"",this._SelectedAlias=e[0].alias||"?"),this._setStateCmd()},200),getDescendantsData:function(){var e={descendantNodes:[],occurrences:[]};if(void 0!==i.get&&null!==i.get()){var t=i.get().getPADTreeDocument().getSelectedNodes();t.length;if(1==t.length){var n=0;t[0].isExpanded()&&(n=t[0].getAllDescendants());for(var a=0;a<n.length;a++){var o={physicalID:n[a].getRelationID()};e.descendantNodes.push(o)}if(t[0].isExpanded()){var s=t[0].getLeaves();for(a=0;a<s.length;a++){for(var r=s[a].getOccurencePath(),l=[],c=0;c<r.length;c++){var g={instancePID:r[c]};l.push(g)}var d={path:l};e.occurrences.push(d)}}}}return e},getData:function(){var e={selectedNodes:[]};if(void 0!==i.get&&null!==i.get()){var t=i.get().getPADTreeDocument().getSelectedNodes();t.length;if(1==t.length)if(t[0].isRoot()){var n={rootID:t[0].getID(),rootAlias:t[0].getLabel(),id:t[0].getID(),alias:t[0].getLabel()};e.selectedNodes.push(n)}else{n={id:t[0].getID(),alias:t[0].getLabel(),parentID:t[0].getParent().getID(),parentalias:t[0].getParent().getLabel(),rootID:t[0].getRoot().getID(),rootAlias:t[0].getRoot().getLabel()};e.selectedNodes.push(n)}}return e},selectInstances:function(e){if(void 0!==i.get&&null!==i.get()&&(i.get().getPADTreeDocument().unselectAll(),null!=e&&null!=e.instances)){for(var t=e.instances,n=0,s=0;s<t.length;s++){if("used"==t[s].status)i.get().getPADTreeDocument().getNodesByRelId(e.instances[s].physicalID).forEach(function(e){e.select(),n++})}n>1?a.showwarning(n+" "+o.instances_Selected,"info"):a.showwarning(n+" "+o.instance_Selected,"info")}},selectLeaves:function(e){var t=this;if(void 0!==i.get&&null!==i.get()&&(i.get().getPADTreeDocument().unselectAll(),null!=e&&null!=e.occurrences)){var n=e.occurrences;let i=0;for(var s=0;s<n.length;s++)"ErrorTooComplexExpression"==n[s].status&&i++;if(i>0){var r={primaryButton:o.CfgUserChoiceDialog_Yes,secondaryButton:o.CfgUserChoiceDialog_No,messageToDisplayOnDialog:o.StatusNotComputed+i+o.WantToHighlight,dontShowAgain:!1,targetBody:widget.body,primaryCallback:function(){t.highlightLeavesWithStatus(n,"ErrorTooComplexExpression")},secondaryCallback:function(){t.highlightLeavesWithStatus(n,"Valid")}};a.showUserChoiceDialog(r)}else this.highlightLeavesWithStatus(n,"Valid")}},highlightLeavesWithStatus:function(e,t){for(var n=0,s=0;s<e.length;s++)if(e[s].status==t){var r=e[s].pids.replaceAll("[","");r=(r=(r=r.replaceAll("]","")).replaceAll(" ","")).split(","),i.get().getPADTreeDocument().getNodeByOccurencePath(r).select(),n++}n>1?a.showwarning(n+" "+o.instances_Selected,"info"):a.showwarning(n+" "+o.instance_Selected,"info")},_setStateCmd:function(){var e=0;void 0!==this._SelectedID&&""!==this._SelectedID&&(e=1,0==this._isConfigAvailable&&(e=0)),1===e?this.enable():this.disable()},execute:function(){console.log("to be overridden by repsective analysis commands.")}})}),define("DS/CfgAnalysisCommands/commands/CfgSelectByConfigurationCriteriaCmd",["UWA/Core","DS/CfgBaseUX/scripts/CfgData","DS/CoreEvents/ModelEvents","DS/CfgBaseUX/scripts/CfgUtility","DS/CfgBaseUX/scripts/CfgDialog","DS/Utilities/TouchUtils","DS/CfgAnalysisCommands/commands/CfgAnalysisCmd","DS/CfgAnalysisEffectivity/scripts/CfgAnalysisUtility","DS/CfgAnalysisEffectivity/scripts/CfgSelectByConfigurationCriteriaDialog","i18n!DS/CfgAnalysisCommands/assets/nls/CfgSelectByConfigurationCriteriaCmd","text!DS/CfgBaseUX/assets/CfgUXEnvVariables.json"],function(e,t,i,n,a,o,s,r,l,c,g){"use strict";var d=s.extend({destroy:function(){this.cfgDialogForSelectByConfigCriteria&&this.cfgDialogForSelectByConfigCriteria.closeDialog()},getModelMarketingName:function(e){for(var t=0;t<e.length;t++)if("Marketing Name"==e[t].name)return e[t].value},getModelName:function(e){for(var t=0;t<e.length;t++)if("name"==e[t].name)return e[t].value},processOptionsWhereUsed:function(e){var t=this;if("whereUsed"!=e.operation){e.selectedOptionsPIDs=[];for(var i=0;i<e.selection.length;i++)e.selectedOptionsPIDs.push(e.selection[i].optionID)}"whereUsed"==e.operation?r.onApplyWhereUsed(e).then(function(e){null!=e&&("FAILED"==e.status?n.showwarning(c.OWU_Webservice_response_fail,"error"):t.selectInstances(e))}):"common"==e.operation?r.onApplyCommon(e).then(function(e){null!=e&&("FAILED"==e.status?n.showwarning(c.OWU_Webservice_response_fail,"error"):t.selectLeaves(e))}):"specific"==e.operation&&r.onApplySpecific(e).then(function(e){null!=e&&("FAILED"==e.status?n.showwarning(c.OWU_Webservice_response_fail,"error"):t.selectLeaves(e))})},execute:function(){var e=this;e.disable(),this.CfgUXEnvVariables=JSON.parse(g);var s=e.getData();if(s.selectedNodes&&s.selectedNodes.length>0){widget?enoviaServerFilterWidget.tenant=widget.getValue("x3dPlatformId"):enoviaServerFilterWidget.tenant="OnPremise",n.populate3DSpaceURL().then(function(){n.populateSecurityContext().then(function(){new Promise(function(t,i){var a="/resources/modeler/configuration/navigationServices/getConfiguredObjectInfo/pid:"+s.selectedNodes[0].id+"?cfgCtxt=1&enabledCriteria=1&version=1.2";d.modelData=null,d.enabledCritData=null,n.makeWSCall(a,"GET","enovia","application/ds-json","",function(i){if(null==i||"undefined"==i?d.modelData=null:"1.2"==i.version&&(d.modelData=i.contexts.content.results,d.enabledCritData=i.enabledCriterias),null==d.modelData||0==d.modelData.length)return e.enable(),void n.showwarning(c.No_Model_Title+" "+c.No_Model_Msg,"error");d.Models=[];for(var a=0;a<d.modelData.length;a++){var o=e.getModelMarketingName(d.modelData[a].data),s=e.getModelName(d.modelData[a].basicData),r={valueItem:d.modelData[a].physicalID,labelItem:o,name:s};d.Models.push(r)}var l=i.enabledCriterias;for(var g in l)l.hasOwnProperty(g)&&l[g];t("Configured Objects/models loaded : "+d.modelData)},function(t){e.enable(),i(t)},!0)}).then(function(r){if(console.log(r),d.instances=e.getDescendantsData().descendantNodes,d.occurrences=e.getDescendantsData().occurrences,0==d.instances.length)return n.showwarning(c.SelectByConfigurationCriteria_No_Descendents_nodes,"error"),void e.enable();var g=null!=o.getTouchMode()&&0!=o.getTouchMode(),f={cmd:e,className:"SelectByConfigCriteriaDlg",parent:widget.body,touchMode:g,overlay:!0,mode:"SelectByConfigCriteria",closable:!0,animate:!0,resizable:!0,persistId:"SelectByConfigCriteriaDlg",appNamePosition:0,modalFlag:!0,width:450,height:490,minHeight:210,minWidth:310,style:{"min-height":"350px"},dialogue:{header:c.SelectByConfigurationCriteria_Dialog_Title+" - "+s.selectedNodes[0].alias,target:widget.body}};e.cfgDialogForSelectByConfigCriteria=new a(f),f.parent=e.cfgDialogForSelectByConfigCriteria.container,f.parentElement=e.cfgDialogForSelectByConfigCriteria.container,f.dialogue.object=e.cfgDialogForSelectByConfigCriteria,e.cfgDialogForSelectByConfigCriteria.render(),t.clear(),t.ModelEvents=new i;var u={tenant:enoviaServerFilterWidget.tenant,environment:"Dashboard",modelList:d.Models,childInstances:d.instances,displayCompactMode:!g,parent:e.cfgDialogForSelectByConfigCriteria.container,parentElement:e.cfgDialogForSelectByConfigCriteria.container};e.SelectByConfigurationCriteriaDialog=l.create(u),t.ModelEvents.subscribe({event:"SelectByConfigCriteriaDlgClosed"},function(t){e.cfgDialogForSelectByConfigCriteria.closeDialog()}),t.ModelEvents.subscribe({event:"SelectByConfigCriteriaApply"},function(t){t.instances=d.instances,t.occurrences=d.occurrences,e.processOptionsWhereUsed(t)}),e.enable()},function(t){e.enable(),n.showwarning(c.SelectByConfigurationCriteria_Generic_Error,"error")})})})}}});return d});