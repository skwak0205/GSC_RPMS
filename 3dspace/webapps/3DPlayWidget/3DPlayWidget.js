define("DS/3DPlayWidget/3DPlayWidgetProxyEnopad",["DS/3DPlayWidgetControllers/3DPlayWidgetProxyBase","DS/WebUtils/Tracker"],function(e,t){"use strict";return e.extend({init:function(e,n){this._parent({prefix:"DS/PADUtils/PADCommandProxy"}),this.subscribe("select",function(e){if("undefined"!=typeof widget&&e&&e.metadata&&widget.id!==e.metadata.originWidgetId){for(var n=e.data.paths,i=n.length,r=[],a=0;a<i;a++)n[a].length>0&&r.push(n[a].join("/"));if(r.length){t.trackPageEvent("interactions","select",e.data.sharedID),t.pause(!0);try{this.setCurrentCSO(r)}catch(e){}t.pause(!1)}}}.bind(e))}})}),define("DS/3DPlayWidget/W3DPlayPrefsCtrl",["UWA/Class","DS/CoreEvents/Events"],function(e,t){"use strict";var n,i,r,a={protocol:"3DXContent",version:"1.0",source:"X3DCSMA_AP",data:{items:[{envId:"defaultString",serviceId:"defaultString",contextId:"defaultString",objectId:"defaultString",objectType:"defaultString",displayName:"",displayType:"defaultString",displayIcon:"defaultStringUri",displayPreview:"defaultStringUri",selectedExperience:"defaultString"}]}};return e.extend({init:function(e,t,a){i=e,r=this,(n=t).plateformPromise.then(function(e){r.readAllPreferences(),r=null},function(e){console.error("getAllPlatformServices Error!"),console.dir(e)})},dispose:function(){n=i=r=null},readAllPreferences:function(){var e,i=n.getSwymModelIdPref(),r=n.getSwymTenantIdPref(),a=n.getCollabSpacePref(),s=n.getX3dContentPref(),o=n.getW3DPlayContentPref();this.isSwymIdValid(i)&&this.isW3DPlayContentEmpty()?(e=this.newSwymDataPreparation(i,r),n.setW3DPlayContent(e)):this.isCollabSpaceValid(a)&&this.isW3DPlayContentEmpty()?(e=this.newSpaceDataPreparation(a),n.setW3DPlayContent(e)):this.isX3DContentIdValid(s)&&(e=JSON.parse(s),n.setW3DPlayContent(e)),this.isW3DPlayContentEmpty()||(o=n.getW3DPlayContentPref(),n.setInitialContent(JSON.parse(o))),t.publish({event:"PrefsCtrl.PreferencesReady"})},isPreferencesEmpty:function(){var e=!0,t=n.getW3DPlayContentPref();return t&&null!=t&&(e=!1),e},isW3DPlayContentEmpty:function(){var e=!0,t=n.getW3DPlayContentPref();return t&&null!=t&&(e=!1),e},isSwymIdValid:function(e){return!(!UWA.is(e)||""==e||"false"==e||void 0===e)&&e},newSwymDataPreparation:function(e,t,n){var i=a.data.items[0];return i.envId=t,i.objectId=e,i.serviceId="3DSWYM",i.objectType="3DShape",n&&console.warn("wow very old ( <R416 ?) 3DPlay Widget Preferences!"),a},newSpaceDataPreparation:function(e){return JSON.parse(e)},isCollabSpaceValid:function(e){var t=!1;if(e&&"undefined"!==e){var n=JSON.parse(e);UWA.is(n,"object")&&n.hasOwnProperty("data")&&(t=!0)}return t},isX3DContentIdValid:function(e){var t=!1;if(e&&"undefined"!==e){var i=JSON.parse(e);UWA.is(i,"object")&&i.hasOwnProperty("data")&&(t=!0)}var r=n.getW3DPlayContentPref();return r&&null!=r&&(t=!1),t},deleteLegacyModelIdPref:function(){i.deleteValue("MODELID"),i.deleteValue("swymTenantId")},deleteLegacyPlatformdPref:function(){i.deleteValue("PLATFORM")},deleteAllLegacyPrefs:function(){this.deleteLegacyModelIdPref(),this.deleteLegacyPlatformdPref()},cleanCollabSpacePref:function(e){i.deleteValue("CollabSpacePref")}})}),define("DS/3DPlayWidget/W3DPlayModel",["UWA/Class","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/CoreEvents/Events","DS/WebSystem/Environment","i18n!DS/3DPlayWidget/assets/nls/3DPlayWidget","DS/3DPlayConnectors/3DPlayInputPreProcessor","DS/WebUtils/WebServices"],function(e,t,n,i,r,a,s){"use strict";var o,l,d={protocol:"3DXContent",version:"1.0",source:"defaultString",data:{items:[{envId:"defaultString",serviceId:"defaultString",contextId:"defaultString",objectId:"defaultString",objectType:"defaultString",displayName:""}]}};return e.extend({init:function(e){o=this,l=e,this.boxMessage=this.constructBoxMessageData(),this.setBoxMessageText(),this.objIdx=0,this.availableExperiences=[],this.availableServices=[],this.currentContent=void 0,this.canvasDivRef=void 0,this.x3d=void 0,this.currentCSO=void 0,this.plateformPromise=this.getAllPlatformServices(),this.plateformPromise.then(function(e){var n=function(e){o.availableServices=e,i.set("3DPlay.Plateform.3DSpaceUrl",e);var r=i.get("x3dPlatformId");if(r){var a=!1;e.some(function(e){if(r==e.platformId&&e.url&&""!==e.url)return a=!0,!0}),a||setTimeout(function(){t.getServiceUrl({serviceName:"3DSpace",onComplete:n})},5e3)}};n(e)},function(e){console.error("getAllPlatformServices Error!"),console.dir(e)})},dispose:function(){l=null},getCollabSpacePref:function(){return l.getValue("CollabSpacePref")},getX3dContentPref:function(){return l.getValue("X3DContentId")},getSwymModelIdPref:function(){return l.getValue("MODELID")},getSwymTenantIdPref:function(){return l.getValue("swymTenantId")},getW3DPlayContentPref:function(){return l.getValue("W3DPlayContent")},getCurrentContent:function(){return this.currentContent},getCurrentData:function(e){return void 0!==this.currentContent&&(UWA.is(e)||(e=0),this.currentContent.data.items[e])},getCurrentProvider:function(){var e=this.getCurrentData();return e?e.serviceId:""},getWidgetMessage:function(e){if(UWA.is(e,"string")){if(r[e])return r[e];console.error("Unable to find Nls key for :",e)}else console.error("Invalid nls key > ",e)},getAllPlatformServices:function(){return new Promise(function(e,n){t.getServiceUrl({serviceName:"3DSpace",onComplete:e,onFailure:function(e){n(e),console.error("Error in i3DXCompassServices.getPlatformServices :",e)}})})},get3DSpaceServiceUrl:function(e){var t=!1;return e&&UWA.is(e,"string")&&this.availableServices.forEach(function(n){n.platformId===e&&(t=n.url)}),t},constructBoxMessageData:function(){return{invite_msgDom:"",invite_imgDom:"",DEFAULT:{classIcon:"fonticon-block",msg:""},REPLACE:{classIcon:"fonticon-down-circled",msg:""},DROPIT:{classIcon:"fonticon-down-circled",msg:""},ERROR:{classIcon:"fonticon-block",msg:""}}},getBoxMessageData:function(){return this.boxMessage},getBoxClassIcon:function(e){return this.boxMessage[e].classIcon},getBoxMessageText:function(e){return this.boxMessage[e].msg},getCanvasDiv:function(){return this.canvasDivRef},getCurrentCSO:function(){return this.currentCSO},setInitialContent:function(e){this.currentContent=e},setCurrentContentFromPublishedFile:function(e){UWA.clone(d).data.items[0];var t=UWA.clone(d);t.data.items[0]=e,e.displayName&&this.setCurrentTitle(e.displayName),this.setCurrentContent(t,!0),this.getAssetFromProvider(e,function(e){(new a).run(e,function(e){o.getPlayerRef().getExperience().args.input.asset=e.asset})})},setCurrentContentFromSwitch:function(e){if(e[0]){var t=require("DS/ENOPAD3DViewer/utils/PAD3DViewerModelServices").getNodeID(e[0]);if(t){var n=UWA.clone(d);n.data.items[0].objectId=t,n.data.items[0].serviceId="3DSPACE",n.data.items[0].envId=l.getValue("x3dPlatformId"),n.data.items[0].objectType="VPMReference",this.setCurrentContent(n,!0)}}},setCurrentContent:function(e,t){this.currentContent=e,t||this.update("Model.changeCurrent"),this.setW3DPlayContent(this.currentContent);var n=this.getCurrentData();n.displayName&&l.setValue("afrProductTitle",n.displayName)},setCurrentTitle:function(e){""!==e&&void 0!==e&&this.currentContent&&(this.currentContent.data.items[0].displayName=e,this.update("Model.changeTitle"))},setCanvasDiv:function(e){this.canvasDivRef=e},setW3DPlayContent:function(e){l.setValue("W3DPlayContent",JSON.stringify(e))},saveSwitchAppPreferences:function(e){var t=l.getValue("xsceneStoredObjects");t=UWA.is(t,"string")?JSON.parse(t):{products:{},filters:{}},"ENOStrRefinementSpecification"===e.objectType?e.rootBag&&(t.filters[e.objectId]={associatedProduct:require("DS/ENOPAD3DViewer/utils/PAD3DViewerModelServices").getNodeID(e.rootBag)}):t.products[e.objectId]={},l.setValue("xsceneStoredObjects",JSON.stringify(t))},setCurrentCSO:function(e){this.currentCSO=e,this.update("Model.changeCSO",this.currentCSO)},setPlayerRef:function(e){this.playerRef=e},getPlayerRef:function(){return this.playerRef},setBoxMessageText:function(){this.boxMessage.REPLACE.msg=this.getWidgetMessage("REPLACE_IT_MSG"),this.boxMessage.DROPIT.msg=this.getWidgetMessage("DROP_IT_MSG"),this.boxMessage.ERROR.msg=this.getWidgetMessage("DROP_ERROR_MSG")},isSwymIdValid:function(e){return!(!UWA.is(e)||""==e||"false"==e||void 0===e)&&e},isX3DContentIdValid:function(e){if(!e||"undefined"===e)return!1;var t=JSON.parse(e);return UWA.is(t,"object")?!!t.hasOwnProperty("data"):void 0},get3DPlayWebInputObject:function(e,t){var n={input:{},options:{loading:"autoplay",callbacks:{experience:{ExperienceReady:function(){if(o.isPendingLoadingCozNotReady)return o.isPendingLoadingCozNotReady=!1,void o.update("Model.changeCurrent")},dispose:function(){}},asset:{LoadingFinished:function(){o&&o.LoadingFinishedCB.apply(o,arguments)}}}}};e?o.getAssetFromProvider(e,function(e){var i=o.getCurrentContent();o.drag&&i.source&&(e.asset.source=i.source),o.drag=!1,void 0!==e&&(n.input=e),t(n)}):t(n)},getAssetFromProvider:function(e,t){var n,i=e.serviceId.toUpperCase();switch(i){case"3DSWYM":n=this.get3DSwymInput(e);break;case"3DSPACE":return void(n=this.get3DSpaceInput(e,t));case"3DDRIVE":case"GOOGLE":case"DROPBOX":case"ONEDRIVE":n=this.getDriveInput(e);break;case"2DLAYOUT":n=this.get2DLayoutInput(e);break;case"FILE":n={asset:e};break;case"R2VSURVEY":n={asset:e},e.provider=e.serviceId,e.type=e.objectType,e.dtype=e.objectType;break;default:console.warn("Missing provider, this must be set! ",i)}t(n)},isLoadingFinished:function(){var e=this.getPlayerRef();return!(!e||!e.instance)&&e.instance.isLoadingFinished()},LoadingFinishedCB:function(e){if(e&&e.loadAssetInfo&&e.loadAssetInfo.localFile&&-1===["STPA"].indexOf(e.loadAssetInfo.format.toUpperCase())){require(["DS/3DPlaySave/SaveServices","i18n!DS/3DPlaySave/assets/nls/SaveServices"],function(t,n){l.setTitle(e.loadAssetInfo.localFile.name+" ("+n.FileDnDFromDesktopNotif_PreviewTitle+")"),t(e,function(t){o.setCurrentContentFromPublishedFile(t),l.setTitle(e.loadAssetInfo.localFile.name)},o.getPlayerRef().getExperience())})}else{if(this.isPendingLoadingCozNotReady)return this.isPendingLoadingCozNotReady=!1,void this.update("Model.changeCurrent");var t=this.getCurrentContent();this.setW3DPlayContent(t);var n=this.getCurrentData();n.displayName?l.setValue("afrProductTitle",n.displayName):this.playerRef.instance&&this.playerRef.instance.pad3DViewer&&this.playerRef.instance.pad3DViewer.getContentName({callbacks:{onComplete:function(e){o&&o.setCurrentTitle(e.contentName),l.setValue("afrProductTitle",e.contentName)},onFailure:function(){}}}),"3DSWYM"===this.getCurrentProvider().toUpperCase()&&this.get3DSwymTitle(t)}},get3DSwymTitle:function(e){var t=this;if(this.x3d)this.x3d.get3DSwymMetaData(e,function(e){t.setCurrentTitle(e.title),t=null},console.error);else{require(["DS/3DPlayConnectors/3DSwymConnector"],function(n){t.x3d=new n,t.get3DSwymTitle(e)})}},get2DLayoutInput:function(e){var t={asset:e.asset};return t.asset.originalAsset={provider:"3DSPACE",type:"2DLayout"},t},get3DSwymInput:function(e){return{asset:{objectId:e.objectId,provider:"3DSwym",envId:e.envId,tenant:e.envId,type:"media"}}},getDriveInput:function(e){return{asset:{objectId:e.objectId,provider:e.serviceId.toUpperCase(),physicalid:e.objectId,requiredAuth:"passport",type:e.objectType,dtype:e.objectType,tenant:e.envId}}},get3DSpaceInput:function(e,t){var n=this.get3DSpaceServiceUrl(e.envId);n?s.getSecurityContext(e.envId).then(function(i){t({asset:{provider:"EV6",physicalid:e.objectId,serverurl:n,serviceId:e.serviceId,type:e.objectType,dtype:e.objectType,requiredAuth:"passport",tenant:e.envId,contextid:i||e.contextId,Play3DXContent:o.currentContent}})}):(console.warn("3DPlay WIDGET : Unable to find 3DSpace Service for Tenant > ",e.envId),t())},update:function(e,t){n.publish({event:e,data:t})}})}),
/*!  Copyright 2015 Dassault Systemes. All rights reserved. */
define("DS/3DPlayWidget/Widget3DPlay",["DS/3DPlayWidget/W3DPlayModel","DS/3DPlayWidgetViews/W3DPlayMainView","DS/3DPlayWidgetViews/W3DPlayerView","DS/3DPlayWidget/W3DPlayPrefsCtrl","css!DS/3DPlayWidget/assets/3DPlayWidget","DS/CoreEvents/Events","DS/WebSystem/BrowserInfos","DS/WebSystem/Environment","DS/3DPlayWidget/3DPlayWidgetProxyEnopad","DS/WebUtils/Tracker"],function(e,t,n,i,r,a,s,o,l,d){"use strict";var c,u,f,g,p={},D=function(){p.wModel=new e(c),p.wModel.applicationFrameOptions=u,p.wView=new t(c,p.wModel),p.wPlayer=new n(c,p.wModel),p.wPlayer.applicationFrameOptions=u,p.wPCtrl=new i(c,p.wModel,p.wView),p._3DPlayWidgetProxyEnopad=new l(p.wModel),u&&u.widgetCB&&u.widgetCB(p),p.dispose=function(e){c.removeEvent("onRefresh",v),c.removeEvent("onLoad",D),c.removeEvent("onHide",y),c.removeEvent("onShow",S),c.removeEvent("onViewChange",h),c.removeEvent("onFocus",C),f&&(c.removeEvent("onSearch",f),f=null),g&&(c.removeEvent("onResetSearch",g),g=null),c=null,u=null,P(e)}},P=function(e){a.publish({event:"3DPLAY/PLAYFROMCOMPASS/DISABLE",data:{}}),p.wModel.dispose&&p.wModel.dispose(e),p.wModel=null,p.wView.dispose&&p.wView.dispose(e),p.wView=null,p.wPlayer.dispose&&p.wPlayer.dispose(e),p.wPlayer=null,p.wPCtrl.dispose&&p.wPCtrl.dispose(e),p.wPCtrl=null,p._3DPlayWidgetProxyEnopad.dispose(),p._3DPlayWidgetProxyEnopad=null},v=function(){p.wPlayer.widgetRefreshHandler()||(p.wView.buildCanvas(),p.wView.removeDragAndDropZone(p.wView.canvasDiv),p.wView.createBlueBackground(),p.wPlayer.instantiate3DPlayWebPlayer())},y=function(){this.fullscreen&&a.publish({event:"3DPLAY/PLAYFROMCOMPASS/DISABLE",data:{}}),s.isMobile()&&p.wModel.isLoadingFinished()&&P()},S=function(){s.isMobile()&&(p.wModel||D()),this.fullscreen&&setTimeout(function(){a.publish({event:"3DPLAY/PLAYFROMCOMPASS/ENABLE",data:{}})},500)},h=function(e){"maximized"===e.type||"fullscreen"===e.type?(console.log("fullscreen"),a.publish({event:"3DPLAY/FULLSCREEN/ENABLE",data:{}})):"windowed"!==e.type&&"minimized"!==e.type||(this.fullscreen=!1,a.publish({event:"3DPLAY/FULLSCREEN/DISABLE",data:{}}))},C=function(e){1==e?a.publish({event:"3DPLAY/WIDGETFOCUS/ENABLE",data:{}}):a.publish({event:"3DPLAY/WIDGETFOCUS/DISABLE",data:{}})};return f=function(e){p.wPlayer.search(e)},g=function(e){p.wPlayer.resetsearch(e)},function(e){c=e.widget,u=e.applicationFrameOptions,c.setMetas({helpPath:"3DPlayWidget/assets/help"}),c.addEvent("onLoad",D),c.addEvent("onRefresh",v),c.addEvent("onHide",y),c.addEvent("onShow",S),c.addEvent("onViewChange",h),c.addEvent("onFocus",C),c.fullscreen=!1,f&&c.addEvent("onSearch",f),g&&c.addEvent("onResetSearch",g)}});