define("DS/MPFMiniCartComponent/MiniCartComponent",["UWA/Core","UWA/Class/View","DS/UIKIT/Input/Button","DS/PlatformAPI/PlatformAPI","DS/MPFClickAndBuyComponent/ClickAndBuyCartHelper","i18n!DS/MPFMiniCartComponent/assets/nls/MiniCartComponent","css!DS/MPFMiniCartComponent/MPFMiniCartComponent.css"],(t,e,r,s,a,n)=>{"use strict";const i=Object.freeze({BUTTON_CLICKED:"buttonClicked"}),o=e.extend({className:"mpf-mini-cart-component",setup(t={}){this.cart=t.cart,this.hideInterval=null,this._hideOnOrder(),s.subscribe(a.Events.MpfCartUpdated,t=>{this.render(t.nbItems)})},render(t){return this.container.setContent(this._createCartDiv(t)),this},destroy(){this._parent(),this.hideInterval&&window.clearInterval(this.hideInterval),this.container=null,this.cart=null},refresh(){this.cart.fetchPromise().then(this.render.bind(this))},_hideOnOrder(){this.hideInterval&&window.clearInterval(this.hideInterval),this.hideInterval=setInterval(()=>{const t=window.location.pathname;t.contains("/buy/order")||t.contains("/checkout")||t.contains("/cart")?(document.querySelector(".mpf-mini-cart-component").classList.add("mpf-hide"),this._adaptCompassCss(!0)):(document.querySelector(".mpf-mini-cart-component").classList.remove("mpf-hide"),this._adaptCompassCss(!1))},600)},_adaptCompassCss(t){const e=document.getElementsByClassName("content-overlay");Array.prototype.forEach.call(e,e=>{t?e.addClassName("mpf-expand"):e.removeClassName("mpf-expand")})},_createCartDiv(e){const r=this._createViewCartButton(),s=t.is(e)?e:this._getNbItemsInCart();return t.createElement("div",{class:"mpf-div-mini-cart",html:[{tag:"span",class:"fonticon fonticon-shopping-cart mpf-grey"},{tag:"p",text:n.get("items",{itemCount:s}),class:"mpf-items"},r]})},_createViewCartButton(){return new r({value:n.get("viewCart"),className:"primary",events:{onClick:()=>{this.dispatchEvent(i.BUTTON_CLICKED)}}})},_getNbItemsInCart(){const t=[];return this.cart.getItems().filter(e=>{let r=!0;const s=e.getOfferId();return s&&(t.includes(s)?r=!1:t.push(s)),r}).reduce((t,e)=>t+=parseInt(e.getQuantity()),0)}});return o.Events=i,o}),define("DS/MPFMiniCartComponent/MiniCartComponentFactory",["UWA/Class","UWA/Promise","DS/MPFServices/MarketplaceServices","DS/MPFConnector/MarketplaceConnector","DS/MPFModelFactory/MPFFactoriesV2","DS/MPFCartModel/CartFactory","DS/MPFCartModel/CartModel","DS/MPFCartModel/CartFilters","DS/MPFMiniCartComponent/MiniCartComponent","DS/MPFUtils/MPFUtils"],(t,e,r,s,a,n,i,o,c,C)=>{"use strict";const h=t.extend({init(){this.lastCartV2sync=0},_adaptCompassCss(){document.getElementsByClassName("content-overlay").forEach(t=>{t.addClassName("mpf-expand")})},createComponent(t={}){return t.service||(t.service=r.CLICK_AND_BUY),this._getData(t).then(this._createMiniCartComponent.bind(this))},hasItems(t){return this._adaptCompassCss(),this._getData(t).then(()=>this.cart.getItems().length>0)},_getData(t={}){return t.service||(t.service=r.CLICK_AND_BUY),s.fetchPromise(t).then(this._getFactories.bind(this)).then(this._getCart.bind(this))},_getFactories(t){const r=a.getInstance(t);return e.all([r.getFactory(a.Types.CART)]).then(t=>{this.cartFactory=t[0]})},_getCart(){const t=this._getCartFormLocalStorage();return t?(this.cart=t,this.cart):this._getMeCartsV2().then(()=>this.carts.isEmpty()?this._createCart():(this.cart=this.carts.first(),this.cart.dataProxy=this.cartFactory.getDataProxy(n.Types.CART),this.cart.fetchPromise({expand:[i.Expands.CART_ITEMS]})))},_getCartFormLocalStorage(){let t;const e=window.localStorage.getItem(i.LOCAL_STORAGE_KEY);if(e){const r=(t=this.cartFactory.createModel(n.Types.ME)).parse(JSON.parse(e));t.set(r)}return t},_getMeCartsV2(){const t={};t[o.FILTER_BY_STATE]=o.STATE_DRAFT,this.carts||(this.carts=this.cartFactory.createCollection(n.Types.ME_V2));const r=Date.now();return r-this.lastCartV2sync>5e3?(this.lastCartV2sync=r,this.carts.fetchPromise(t)):e.cast(this.carts)},_createCart(){return this.cart=this.cartFactory.createModel(n.Types.ME),this.cart},_createMiniCartComponent(){const t={};return t.cart=this.cart,new c(t)}});let l;return h.getMiniCartComponent=function(t){return l||(l=new h(t)),l.createComponent()},h.hasItems=function(t){return l||(l=new h(t)),l.hasItems()},h});