define("DS/PCOverview/js/PCOverviewPresenter",["UWA/Core","UWA/Class","DS/CoreEvents/ModelEvents","DS/WAFData/WAFData","DS/PCsBulkViewPresenter/js/PCsBulkViewPresenter","DS/WidgetServices/WidgetServices","DS/WidgetServices/securityContextServices/SecurityContextServices","DS/ENOXEmptyContent/js/ENOXEmptyContent","i18n!DS/PCOverview/assets/nls/PCOverviewPresenter","css!DS/PCOverview/css/PCOverviewPresenter.css"],function(e,t,n,i,s,r,o,a,c){"use strict";return t.extend({init:function(e){this._pcList=[],this._pcInfo=[],this._variabilityLoaded=!1,this._initTableView(),this._initContainer(),this._parent(e)},_initTableView:function(){this._modelEvents=new n;this._tablePresenter=new s({withSolver:!1,showEditAction:!1,showCompareAction:!1})},_initContainer:function(){this._container=e.createElement("div",{class:"pc-overview-presenter",styles:{height:"100%"}}),this._infoContainer=e.createElement("div",{class:"pc-overview-info",styles:{height:"100%"}})},inject:function(e){this._container.inject(e)},updateOptions:function(e){this._pcList=e.pcList,this._tenant=e.tenant,this._securityContext=e.securityContext,this._tablePresenter.setSecurityContext(this._securityContext),this._tablePresenter.setTenant(this._tenant),this.loadData()},_fetchPCData:function(){var t=this;return t._mvID=void 0,t._pcInfo=[],this._getSearchServiceURL().then(function(){return new e.Promise(function(n,s){var r={label:"x_mdl_app_pc_overview"+Date.now(),with_synthesis:!1,select_predicate:["ds6w:label","ds6w:description","ds6w:identifier","based_on_model_version_pid","ds6w:type"],refine:{},order_by:"desc",order_field:"relevance",source:["3dspace"],login:{"3dspace":{SecurityContext:t._securityContext}},tenant:t._tenant,query:'(flattenedtaxonomies:"types/Product Configuration")',resourceid_in:t._pcList},o={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},tenantId:t._tenant,apiVersion:"R2018x",data:JSON.stringify(r),onComplete:function(i){var s=(i=JSON.parse(i)).results;if(s){var r,o=s.map(function(t){var n={},i=e.Json.path(t,'$..attributes[?(@.name=="resourceid" || @.name=="ds6w:label" || @.name=="type_icon_url" || @.name=="preview_url" || @.name=="based_on_model_version_pid" || @.name=="ds6w:what/ds6w:type")]');return i&&(n=i.reduce((e,t)=>(e[t.name]=t.value,e),{})),n}),a=!1,c=o.map(e=>{var t=e.based_on_model_version_pid;return t&&(r?r!==t&&(a=!1):(r=t,a=!0)),{id:e.resourceid,title:e["ds6w:label"],image:e.preview_url||e.type_icon_url,modelID:t,type:e["ds6w:what/ds6w:type"]}});a?(t._mvID=r,t._pcInfo=c):t._pcInfo=c}n(t._pcInfo)},onFailure:function(){s([]),t.displayNotification(c.ERROR_DATA_LOAD)}};i.authenticatedRequest(t._searchServiceURL,o)})}).catch(function(){})},_fetchDictionary:function(){var t=this;return this._get3DSpaceURL().then(function(){return t._mvID&&t._3DSpaceURL?new e.Promise(function(e,n){var s={componentId:t._mvID,content:{rules:!1,attributes:3,parameters:!1,attributeList:["_image"]}},r={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json",SecurityContext:t._securityContext},tenantId:t._tenant,apiVersion:"R2018x",data:JSON.stringify(s),onComplete:function(n){n=JSON.parse(n),t._dicationary=n,e()},onFailure:function(){n(),t.displayNotification(c.ERROR_VARIABILIY_LOAD)}};i.authenticatedRequest(t._3DSpaceURL+"/resources/v1/modeler/dspfl/invoke/dspfl:getVariabilityDefinition",r)}):e.Promise.resolve()}).catch(function(){})},_getSearchServiceURL:function(){if(this._searchServiceURL)return e.Promise.resolve();var t=this;return new e.Promise(function(e,n){r.get3DSearchUrlAsync({platformId:t._tenant,onComplete:function(n){console.log(n),t._searchServiceURL=n+"/search",e()},onFailure:function(){n()}})})},_get3DSpaceURL:function(){if(this._3DSpaceURL)return e.Promise.resolve();var t=this;return new e.Promise(function(e,n){r.get3DSpaceUrlAsync({platformId:t._tenant,onComplete:function(n){console.log(n),t._3DSpaceURL=n,e()},onFailure:function(){n()}})})},loadData:async function(){var e=this;await this._fetchPCData().then(function(){return e._fetchDictionary()}),this.updateUI()},updateUI:function(){this._mvID?this._variabilityLoaded?(this._tablePresenter.removeAllLoadedPCs(),this._tablePresenter.fetchData(this._pcInfo),this._container.setContent(this._tablePresenter.getContent())):(this._tablePresenter.setModelVersion(this._mvID),this._tablePresenter.loadVariabilityInfo(this._dicationary),this._variabilityLoaded=!0,this._tablePresenter.inject(this._container),this._tablePresenter.fetchData(this._pcInfo)):this._pcInfo.length<this._pcList.length?this.showMessage(c.ERROR_NOT_INDEXED):this._pcList.length>1?this.showMessage(c.ERROR_DIFFERENT_MV):this._container.empty()},showMessage:function(e){this._emptyContent=new a({sentences:[{type:"icon",fonticon:"properties",sizeicon:"40px",text:e}]}),this._container.empty(),this._emptyContent.inject(this._container)},displayNotification:function(e){console.log(e)},destroy:function(){this._container.empty()}})}),define("DS/PCOverview/js/PCOverviewFacet",["UWA/Core","UWA/Class","UWA/Controls/Abstract","DS/EditPropWidget/facets/Common/FacetsBase","DS/PCOverview/js/PCOverviewPresenter","DS/WidgetServices/securityContextServices/SecurityContextServices","css!DS/PCOverview/css/PCOverviewFacet.css"],function(e,t,n,i,s,r){"use strict";return t.extend(n,i,{name:"pc-overview-container",init:function(e){this._parent(e),this._initTableView(),this._initContainer()},_initTableView:function(){this._overviewPresenter=new s},_initContainer:function(){this.elements.container=e.createElement("div",{class:this.getClassNames()}),this._overviewPresenter.inject(this.elements.container)},updateFacet:function(){this.modelIds=[];var e=this.getModel();if(e){this.tenant=e.getTenant();e.isMergedModel()?this.modelIds=e.getMergedModelIds():this.modelIds.push(e.get("objectId"))}var t=this;r.getInstance({tenant:this.tanent}).getSecurityContext({context:this.getContext(),onSuccess:function(e){t.securityContext=e.SecurityContext,t.loadData()}})},loadData:function(){this._overviewPresenter.updateOptions({tenant:this.tenant,pcList:this.modelIds,securityContext:this.securityContext})},destroyComponent:function(){this._overviewPresenter.destroy()},onRefresh:function(){this.updateFacet()}})});