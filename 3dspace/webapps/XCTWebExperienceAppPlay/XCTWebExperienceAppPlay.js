define("DS/XCTWebExperienceAppPlay/managers/CXPWebEventListenerManager",["UWA/Core","UWA/Class","DS/EP/EP","DS/MathematicsES/MathVector2DJSImpl","DS/VisuEvents/EventsManager","DS/EPInputsServicesWeb/EPInputsServices"],function(e,t,r,n,i,o){"use strict";return t.extend({elementKeyBoard:document.body,elementMouse:null,elementTouch:null,Build:function(){var e=this._experienceBase.webApplication.frmWindow.getViewer().canvas;this.elementMouse=e,this.elementTouch=e},_getInputServices:function(){return this._inputServices||(this._inputServices=new o),this._inputServices},start:function(){var t=this;if(this._eventsArray)e.log("CXPWebEventListenerManager already started");else{var o=this._getInputServices();o.enableKeyboard(this.elementKeyBoard),o.enableTouch(this.elementTouch),o.enableGesture(this.elementTouch),navigator.getGamepads&&o.enableGamepad();var a=new r.MouseEnableEvent;r.EventServices.dispatchEvent(a),this._eventsArray=[],this._eventsArray.push(i.addEvent(document,"onMouseMove",function(e){if(e.from[0].view===t.elementMouse){var i=new n;i.x=e.from[0].currentPosition.x,i.y=e.from[0].currentPosition.y;var o=new r.MouseMoveEvent;o.position=i;var a=new n;a.x=e.from[0].deltaPosition.x,a.y=e.from[0].deltaPosition.y,o.deltaPosition=a,r.EventServices.dispatchEvent(o)}})),this._eventsArray.push(i.addEvent(document,"onLeftMouseDown",function(e){if(e.from[0].view===t.elementMouse){var n=new r.MousePressEvent;n.position.x=e.from[0].currentPosition.x,n.position.y=e.from[0].currentPosition.y,n.button=r.Mouse.EButton.eLeft,r.EventServices.dispatchEvent(n)}})),this._eventsArray.push(i.addEvent(document,"onLeftMouseUp",function(e){if(e.from[0].view===t.elementMouse){var n=new r.MouseReleaseEvent;n.position.x=e.from[0].currentPosition.x,n.position.y=e.from[0].currentPosition.y,n.button=r.Mouse.EButton.eLeft,r.EventServices.dispatchEvent(n)}})),this._eventsArray.push(i.addEvent(document,"onLeftClick",function(e){if(e.from[0].view===t.elementMouse){var n=new r.MouseClickEvent;n.position.x=e.from[0].currentPosition.x,n.position.y=e.from[0].currentPosition.y,n.button=r.Mouse.EButton.eLeft,r.EventServices.dispatchEvent(n)}})),this._eventsArray.push(i.addEvent(document,"onLeftDoubleClick",function(e){if(e.from[0].view===t.elementMouse){var n=new r.MouseDoubleClickEvent;n.position.x=e.from[0].currentPosition.x,n.position.y=e.from[0].currentPosition.y,n.button=r.Mouse.EButton.eLeft,r.EventServices.dispatchEvent(n)}})),this._eventsArray.push(i.addEvent(document,"onMiddleMouseDown",function(e){if(e.from[0].view===t.elementMouse){var n=new r.MousePressEvent;n.position.x=e.from[0].currentPosition.x,n.position.y=e.from[0].currentPosition.y,n.button=r.Mouse.EButton.eMiddle,r.EventServices.dispatchEvent(n)}})),this._eventsArray.push(i.addEvent(document,"onMiddleMouseUp",function(e){if(e.from[0].view===t.elementMouse){var n=new r.MouseReleaseEvent;n.position.x=e.from[0].currentPosition.x,n.position.y=e.from[0].currentPosition.y,n.button=r.Mouse.EButton.eMiddle,r.EventServices.dispatchEvent(n)}})),this._eventsArray.push(i.addEvent(document,"onMiddleClick",function(e){if(e.from[0].view===t.elementMouse){var n=new r.MouseClickEvent;n.position.x=e.from[0].currentPosition.x,n.position.y=e.from[0].currentPosition.y,n.button=r.Mouse.EButton.eMiddle,r.EventServices.dispatchEvent(n)}})),this._eventsArray.push(i.addEvent(document,"onMiddleDoubleClick",function(e){if(e.from[0].view===t.elementMouse){var n=new r.MouseDoubleClickEvent;n.position.x=e.from[0].currentPosition.x,n.position.y=e.from[0].currentPosition.y,n.button=r.Mouse.EButton.eMiddle,r.EventServices.dispatchEvent(n)}})),this._eventsArray.push(i.addEvent(document,"onRightMouseDown",function(e){if(e.from[0].view===t.elementMouse){var n=new r.MousePressEvent;n.position.x=e.from[0].currentPosition.x,n.position.y=e.from[0].currentPosition.y,n.button=r.Mouse.EButton.eRight,r.EventServices.dispatchEvent(n)}})),this._eventsArray.push(i.addEvent(document,"onRightMouseUp",function(e){if(e.from[0].view===t.elementMouse){var n=new r.MouseReleaseEvent;n.position.x=e.from[0].currentPosition.x,n.position.y=e.from[0].currentPosition.y,n.button=r.Mouse.EButton.eRight,r.EventServices.dispatchEvent(n)}})),this._eventsArray.push(i.addEvent(document,"onRightClick",function(e){if(e.from[0].view===t.elementMouse){var n=new r.MouseClickEvent;n.position.x=e.from[0].currentPosition.x,n.position.y=e.from[0].currentPosition.y,n.button=r.Mouse.EButton.eRight,r.EventServices.dispatchEvent(n)}})),this._eventsArray.push(i.addEvent(document,"onRightDoubleClick",function(e){if(e.from[0].view===t.elementMouse){var n=new r.MouseDoubleClickEvent;n.position.x=e.from[0].currentPosition.x,n.position.y=e.from[0].currentPosition.y,n.button=r.Mouse.EButton.eRight,r.EventServices.dispatchEvent(n)}})),this._eventsArray.push(i.addEvent(document,"onMouseWheel",function(e){if(e.from[0].view===t.elementMouse){var n=new r.MouseWheelEvent;n.position=r.Devices.getMouse().getPosition(),n.wheelDeltaValue=e.gesture.delta,r.EventServices.dispatchEvent(n)}}))}},stop:function(){var e=this._getInputServices();if(e.disableKeyboard(),e.disableTouch(),e.disableGesture(),e.disableGamepad(),this._eventsArray){for(var t=this._eventsArray.length;t--;)i.removeEventFromToken(this._eventsArray[t]),this._eventsArray[t]=null;this._eventsArray=null}},GetType:function(){return"CXPWebEventListenerManager"}})}),define("DS/XCTWebExperienceAppPlay/commands/XCTWebStopCmd",["UWA/Core","UWA/Class/Listener","DS/ApplicationFrame/Command"],function(e,t,r){"use strict";return e.Class.extend(r,t,{init:function(e){this._parent(e,{isAsynchronous:!0});var t=this.getFrameWindow()._experienceBase;this.listenTo(t.getManager("CXPWebPlayManager"),"PlayStateChanged",this._switchEnableFromPlayState.bind(this))},execute:function(){var e=this.getFrameWindow()._experienceBase,t=this;e.getManager("CXPWebPlayManager").stop().done(function(){t.end()})},_switchEnableFromPlayState:function(e){var t=this.getFrameWindow()._experienceBase;if(t){var r=t.getManager("CXPWebPlayManager");r.ePlayState.ePlaying===e||r.ePlayState.ePause===e?this.enable():this.disable()}}})}),define("DS/XCTWebExperienceAppPlay/interfaces/StuIPrototypeBuild",["UWA/Class","DS/WebComponentModeler/CATWebInterface"],function(e,t){"use strict";return t.singleton({interfaceName:"StuIPrototypeBuild",required:{getESPrototype:function(){},build:function(){},disposeESObject:function(){}},optional:{}})}),define("DS/XCTWebExperienceAppPlay/managers/CAT3DExperienceESExportManager",["UWA/Core","UWA/Class","DS/CAT3DExpModel/interfaces/CATI3DExperienceObject","DS/StuRenderEngine/StuColor"],function(e,t,r,n){"use strict";return t.extend({Build:function(){this._esObjectMap={},this._esObjectMapPromises={},this._weakReferenceMap=[]},Dispose:function(){delete this._exportPromise,delete this._esObjectMap,delete this._esObjectMapPromises,delete this._weakReferenceMap},export:function(t){var r=this._exportPromise?this._exportPromise:e.Promise.resolve(),n=this,i=r.then(function(){return n._createESObjectFrom3DExpObject(t,null)}).then(function(e){return n._solveWeakReferences(),n._finalizeExperienceObject(t),n._exportPromise===i&&delete n._exportPromise,e});return this._exportPromise=i,i},exportSubExperienceObject:function(t){var r=this._exportPromise?this._exportPromise:e.Promise.resolve();const n=t.QueryInterface("CATI3DExperienceObject").GetParent(),i=t.QueryInterface("CATI3DExperienceObject").GetParentVariable();var o=this.getProjectedESObject(n),a=this,s=r.then(function(){return a._createESObjectFrom3DExpObject(t,o)}).then(function(e){if(1!==t.QueryInterface("CATI3DExperienceObject").GetVariableMaxNumberOfValues){const t=o[i]?o[i]:[];t.push(e),o[i]=t}else o[i]=e;return a._solveWeakReferences(),a._finalizeExperienceObject(t),a._exportPromise===s&&delete a._exportPromise,e});return this._exportPromise=s,s},cleanProjectedESObjectMap:function(){for(var e in this._esObjectMap)if(this._esObjectMap.hasOwnProperty(e)){var t=this._esObjectMap[e].modelObject,r=this._esObjectMap[e].ESObject;t.QueryInterface("StuIPrototypeBuild").disposeESObject(r),delete this._esObjectMap[e]}},getProjectedESObject:function(e){if(this._esObjectMap[e.GetID()])return this._esObjectMap[e.GetID()].ESObject},removeProjectedESObject:function(e){if(this._esObjectMap[e.GetID()]){var t=this._esObjectMap[e.GetID()].ESObject;e.QueryInterface("StuIPrototypeBuild").disposeESObject(t),delete this._esObjectMap[e.GetID()];for(var r=this._listChildren(e),n=0;n<r.length;n++)this.removeProjectedESObject(r[n])}},_createESObjectFrom3DExpObject:function(t,r){if(this._esObjectMapPromises[t.GetID()])return this._esObjectMapPromises[t.GetID()];var n,i=this.getProjectedESObject(t);i?(i.constructor(),n=e.Promise.resolve(i)):n=t.QueryInterface("StuIPrototypeBuild").getESPrototype().then(function(e){i=new e});var o=this,a=t.QueryInterface("CATI3DExperienceObject");return this._esObjectMapPromises[t.GetID()]=n.then(function(){return i.name=a.GetValueByName("_varName"),r&&i.setParent&&i.setParent(r),t.QueryInterface("StuIPrototypeBuild").build(i)}).then(function(t){for(var r=[],n=a.ListVariables(),s=0;s<n.length;s++){var c=n[s];t.indexOf(c)>=0||r.push(o._projectVariable(a,c,i))}return e.Promise.allSettled(r)}).then(function(){return o._esObjectMap[t.GetID()]={ESObject:i,modelObject:t},delete o._esObjectMapPromises[t.GetID()],e.Promise.resolve(i)}),this._esObjectMapPromises[t.GetID()]},_createESObjectFrom3DExpObjectInArray:function(e,t,r){return this._createESObjectFrom3DExpObject(e,t).then(function(e){return{esObject:e,index:r}})},_projectVariable:function(e,t,n){var i=e.GetVariableType(t);return r.VarType.Color===i?this._projectColorVariable(e,t,n):r.VarType.Object===i?this._projectObjectVariable(e,t,n):this._projectDefaultVariable(e,t,n)},_projectDefaultVariable:function(t,r,n){var i=t.GetValueByName(r);return e.is(i)&&(n[r]=i),e.Promise.resolve()},_projectColorVariable:function(t,r,i){var o=t.GetValueByName(r);if(o){var a=o.GetThreeColor(),s=new n(255*a.r,255*a.g,255*a.b);i[r]=s}return e.Promise.resolve()},_projectObjectVariable:function(t,n,i){var o=t.GetVariableValuationMode(n),a=t.GetValueByName(n);if(!a)return e.Promise.resolve();if(r.ValuationMode.AggregatingValue!==o)return this._storeWeakReference(a,n,i),e.Promise.resolve();if(!Array.isArray(a))return this._createESObjectFrom3DExpObject(a,i).then(function(e){i[n]=e});for(var s=[],c=[],u=0;u<a.length;u++)s.push(this._createESObjectFrom3DExpObjectInArray(a[u],i,u).then(function(e){c[e.index]=e.esObject}));return e.Promise.allSettled(s).then(function(){i[n]=c})},_solveWeakReferences:function(){for(var e=this,t=0;t<this._weakReferenceMap.length;t++){var r=this._weakReferenceMap[t].ESObject,n=this._weakReferenceMap[t].variableName,i=this._weakReferenceMap[t].referenceValue;i=Array.isArray(i)?i.map(function(t){return e.getProjectedESObject(t)}):this.getProjectedESObject(i),r[n]=i}this._clearWeakReferenceMap()},_storeWeakReference:function(e,t,r){this._weakReferenceMap.push({referenceValue:e,variableName:t,ESObject:r})},_clearWeakReferenceMap:function(){this._weakReferenceMap=[]},_finalizeExperienceObject:function(e){var t=this.getProjectedESObject(e);t.finalize&&t.finalize()},_listChildren:function(e){var t=e.QueryInterface("CATI3DExperienceObject"),n=[],i=[];t.ListVariables(i,r.VarType.Object);for(var o=0;o<i.length;o++)if(t.GetVariableValuationMode(i[o])===r.ValuationMode.AggregatingValue){var a=t.GetValueByName(i[o]);if(!a)continue;Array.isArray(a)?n=n.concat(a):n.push(a)}return n},GetType:function(){return"CAT3DExperienceESExportManager"}})}),define("DS/XCTWebExperienceAppPlay/CXPWebRaytraceWrapper",[],function(){"use strict";var e=function(){};return e.prototype.setAperture=function(){},e.prototype.setExposure=function(){},e.prototype.setFocusDistance=function(){},e.prototype.setSpeed=function(){},e.prototype.setAutoFocusMode=function(){},e.prototype.setProduceVideo=function(){},e.prototype.shotSingleFrame=function(){},e.prototype.begin=function(){},e.prototype.end=function(){},e}),define("DS/XCTWebExperienceAppPlay/CXPWebViewer",["UWA/Core","DS/Visualization/ThreeJS_DS","DS/StuCore/StuContext","DS/StuMath/StuSphere","DS/StuMath/StuRay","DS/Visualization/PathElement","DS/MathematicsES/MathsDef","DS/CATCXPModel/CATCXPRenderUtils","DS/Selection/HSOManager","DS/Selection/PSOManager","DS/EP/EP","DS/StuRenderEngine/StuIntersection"],function(e,t,r,n,i,o,a,s,c,u,p){"use strict";return e.Class.extend({_viewer:null,init:function(e){this._viewer=e},onStart:function(){c.empty(),u.empty()},onStop:function(){c.empty(),u.empty(),this._viewer.canvas.style.cursor="inherit"},GetSize:function(t){if(t instanceof a.Vector2D){var r=this._viewer.canvas.getSize();t.x=r.width,t.y=r.height}else e.log("StuViewer.GetSize ERROR : parameter is not a Vector2D !"),t=null},GetGlobalBoundingSphere:function(t){if(t instanceof r.Sphere){var n=this._viewer.getSceneBoundingSphere("show",!0);t.center=n.center,t.radius=n.radius}else e.log("StuViewer.GetGlobalBoundingSphere ERROR : parameter is not a STU.Sphere !"),t=null},GetRayFromPosition:function(t,n){if(!(n instanceof r.Ray))return e.log("StuViewer.GetRayFromPosition ERROR : ray parameter is not a STU.Ray !"),void(n=null);var i=this._viewer.currentViewpoint.camera,o=this._viewer.currentViewpoint.create3DRayFrom2DPoint(t,i);n.origin.x=o.origin.x,n.origin.y=o.origin.y,n.origin.z=o.origin.z,n.direction.x=o.direction.x,n.direction.y=o.direction.y,n.direction.z=o.direction.z},GetLineFromPosition:function(t,r){if(!(r instanceof a.Line))return e.log("StuViewer.GetLineFromPosition ERROR : ray parameter is not a DSMath.Line !"),void(r=null);var n=this._viewer.currentViewpoint.camera,i=this._viewer.currentViewpoint.create3DRayFrom2DPoint(t,n);r.origin.x=i.origin.x,r.origin.y=i.origin.y,r.origin.z=i.origin.z,r.direction.x=i.direction.x,r.direction.y=i.direction.y,r.direction.z=i.direction.z},PickFromPosition:function(n,i,o,c,u=!0){if(!(i instanceof Array))return e.log("StuViewer.PickFromPosition ERROR : oIntersections parameter is not an Array !"),void(i=null);if(o){var p=new t.Vector2(n.x,n.y),l=this._viewer.getMousePosition(p),f=this._viewer.pick(l,"mesh",u);if(f.path.length>=1){var h=s.getComponentsFromPathElement(f.path[0],!0);if(1===h.length){var d=new r.Intersection,y=h[0]._experienceBase.getManager("CAT3DExperienceESExportManager").getProjectedESObject(h[0]);if(d.setActor(y),u){var g=new a.Point(f.position.x,f.position.y,f.position.z);d.setPoint(g);var S=new a.Vector3D(f.normal.x,f.normal.y,f.normal.z);d.setNormal(S)}i.push(d)}}return i}var m=new r.Ray;return this.GetRayFromPosition(n,m),this.PickFromRay(m,i,o,c)},PickFromRay:function(n,i,o){if(!(i instanceof Array))return e.log("StuViewer.PickFromRay ERROR : oIntersections parameter is not an Array !"),void(i=null);var c=new t.Ray;c.origin.set(n.getOrigin().x,n.getOrigin().y,n.getOrigin().z);var u=n.getDirection();u.isNormalized()||(u=u.normalize()),c.direction.set(u.x,u.y,u.z);for(var p=n.getLength(),l=this._viewer.castRay(c,null,"prim"),f=0;f<l.length;f++)if(l[f].distance<=p||0===p){var h=s.getComponentsFromPathElement(l[f].pathElement,!0);if(1===h.length){var d=h[0]._experienceBase.getManager("CAT3DExperienceESExportManager").getProjectedESObject(h[0]);if(this._isClickable(d)){var y=new r.Intersection;y.setActor(d);var g=new a.Point(l[f].point.x,l[f].point.y,l[f].point.z);y.setPoint(g);var S=new a.Vector3D(l[f].normal.x,l[f].normal.y,l[f].normal.z);if(y.setNormal(S),i.push(y),!0===o)return i}}}return i},_isClickable:function(e){return!!e.clickable&&(!(e.parent instanceof r.Actor3D)||this._isClickable(e.parent))},PickFromLine:function(t,n,i){if(!(n instanceof Array))return e.log("StuViewer.PickFromLine ERROR : oIntersections parameter is not an Array !"),void(n=null);var o=new r.Ray;return o.origin=t.origin,o.direction=t.direction,this.PickFromRay(o,n,i),n},GetMousePosition:function(e){var t=p.Devices.getMouse().position;e.x=t.x,e.y=t.y},SetMousePosition:function(){e.log("StuViewer.SetMousePosition WARNING : No Implementation !")},HideMouseCursor:function(){this._viewer.canvas.style.cursor="none"},ShowMouseCursor:function(){this._viewer.canvas.style.cursor="inherit"},HighlightDisplay:function(e,t){var r=e.getModelObject().QueryInterface("CATI3DGeoVisu").GetPathElement();r&&(t?c.add({pathElement:r}):c.remove({pathElement:r}))},PreHighlightDisplay:function(e,t){var r=e.getModelObject().QueryInterface("CATI3DGeoVisu").GetPathElement();r&&(t?u.add({pathElement:r}):u.remove({pathElement:r}))},GetViewpointCoordinatesFromPixel:function(e,t){return this._viewer.currentViewpoint.create3DRayFrom2DPoint(e,t).origin},Unproject:function(e,r){var n=new t.Matrix4,i=new t.Matrix4;this._validateMatrix(r.matrixWorld,i);var o=new t.Matrix4;return this._validateMatrix(r.projectionMatrix,o),n.multiplyMatrices(i,n.getInverse(o)),e.applyProjection(n)},_validateMatrix:function(e,t){for(var r=e.elements.length-1;r>=0;r--){var n=e.elements[r];isFinite(n)&&!isNaN(n)&&(t.elements[r]=n)}},ActivateDefaultNavigation:function(){this._viewer.autoUpdateFrustum=!0,this._viewer.currentViewpoint.control.setActive(!0),this._viewer.currentViewpoint.control.setMouseActive(!0),this._viewer.currentViewpoint.control.setReframeOnDoubleTap(!0),this._saveAuthCamOptions&&(this._viewer.currentViewpoint.moveTo(this._saveAuthCamOptions),this._saveAuthCamOptions=void 0)},DeactivateDefaultNavigation:function(){this._viewer.autoUpdateFrustum=!1,this._viewer.setAutomaticPlaneUpdate(!1),this._viewer.currentViewpoint.control.setActive(!1),this._viewer.currentViewpoint.control.setMouseActive(!1),this._viewer.currentViewpoint.control.setReframeOnDoubleTap(!1),this._saveAuthCamOptions={eyePosition:this._viewer.currentViewpoint.getCameraPosition().clone(),upDirection:this._viewer.currentViewpoint.getUpDirection().clone(),sightDirection:this._viewer.currentViewpoint.getSightDirection().clone(),distanceToTarget:this._viewer.currentViewpoint.getTargetDistance(),duration:500}}})}),define("DS/XCTWebExperienceAppPlay/managers/APIPlayerManager",["UWA/Core","UWA/Class","DS/CAT3DExpModel/CAT3DXModel"],function(e,t,r){"use strict";return t.extend({GetType:function(){return"APIPlayerManager"},play:function(){return this._experienceBase.getManager("CXPWebPlayManager").play()},pause:function(){return this._experienceBase.getManager("CXPWebPlayManager").pause()},stop:function(){return this._experienceBase.getManager("CXPWebPlayManager").stop()},isPlaying:function(){return this._experienceBase.getManager("CXPWebPlayManager").isPlaying()},getActs:function(){return console.log("DEPRECATED"),this.getPermanentActs()},playAct:function(e){return console.log("DEPRECATED"),this.playPermanentAct(e)},getCurrentAct:function(){return console.log("DEPRECATED"),this.getCurrentPermanentAct()},getScenes:function(){return this._getScenes().map(function(e){return e.QueryInterface("CATI3DExperienceObject").GetValueByName("_varName")})},getCurrentScene:function(){var e=this._getCurrentScene();if(e)return e.QueryInterface("CATI3DExperienceObject").GetValueByName("_varName")},playScene:function(e){if(this.isPlaying()){var t=this._getSceneByName(e);if(t)this._experienceBase.getManager("CAT3DExperienceESExportManager").getProjectedESObject(t).activate();else console.warn(e+" doesnt exist")}else console.warn("The experience must be playing to play a scene")},getPermanentActs:function(){return this._getPermanentActs().map(function(e){return e.QueryInterface("CATI3DExperienceObject").GetValueByName("_varName")})},playPermanentAct:function(e){if(this.isPlaying()){var t=this._getPermanentActByName(e);if(t)this._experienceBase.getManager("CAT3DExperienceESExportManager").getProjectedESObject(t).starts();else console.warn(e+" doesnt exist")}else console.warn("The experience must be playing to play an act")},getCurrentPermanentAct:function(){if(this.isPlaying()){var e=this._getPermanentScenario();if(e)return this._experienceBase.getManager("CAT3DExperienceESExportManager").getProjectedESObject(e).GetCurrentAct().name}},getActsFromScene:function(e){return this._getActsFromScene(e).map(function(e){return e.QueryInterface("CATI3DExperienceObject").GetValueByName("_varName")})},playActFromCurrentScene:function(e){if(this.isPlaying()){var t=this.getCurrentScene(),r=this._getActFromSceneByName(t,e);if(r)this._experienceBase.getManager("CAT3DExperienceESExportManager").getProjectedESObject(r).starts();else console.warn(e+" doesnt exist")}else console.warn("The experience must be playing to play an act")},getCurrentActFromCurrentScene:function(){if(this.isPlaying()){var e=this.getCurrentScene(),t=this._getScenarioFromScene(e);if(t)return this._experienceBase.getManager("CAT3DExperienceESExportManager").getProjectedESObject(t).GetCurrentAct().name}},_getScenes:function(){var e=r.GetExperience();return e?e.QueryInterface("CATI3DExperienceObject").GetValueByName("scenes"):[]},_getSceneByName:function(e){for(var t=this._getScenes(),r=0;r<t.length;r++)if(e===t[r].QueryInterface("CATI3DExperienceObject").GetValueByName("_varName"))return t[r]},_getCurrentScene:function(){var e=r.GetExperience();if(e){var t=e.QueryInterface("CATI3DExperienceObject").GetValueByName("currentScene");if(t)return t}},_getPermanentActs:function(){var e=this._getPermanentScenario();return e?e.QueryInterface("CATI3DExperienceObject").GetValueByName("acts"):[]},_getPermanentActByName:function(e){for(var t=this._getPermanentActs(),r=0;r<t.length;r++)if(e===t[r].QueryInterface("CATI3DExperienceObject").GetValueByName("_varName"))return t[r]},_getPermanentScenario:function(){var e=r.GetExperience();if(!e)return[];var t=e.QueryInterface("CATI3DExperienceObject").GetValueByName("scenarios");return t&&1===t.length?t[0]:void 0},_getActsFromScene:function(e){var t=this._getScenarioFromScene(e);return t?t.QueryInterface("CATI3DExperienceObject").GetValueByName("acts"):[]},_getActFromSceneByName:function(e,t){for(var r=this._getActsFromScene(e),n=0;n<r.length;n++)if(t===r[n].QueryInterface("CATI3DExperienceObject").GetValueByName("_varName"))return r[n]},_getScenarioFromScene:function(e){return this._getSceneByName(e).QueryInterface("CATI3DExperienceObject").GetValueByName("scenario")},_listActorsAssets:function(){var e=r.GetExperience(),t=e.QueryInterface("CATI3DExperienceObject").GetValueByName("actors"),n=[],i=e.QueryInterface("CATI3DExperienceObject").GetValueByName("scenes");for(let e=0;e<i.length;e++)t=t.concat(i[e].QueryInterface("CATI3DExperienceObject").GetValueByName("actors"));for(let e=0;e<t.length;e++)this._listActorsAssetsRecursively(t[e],n);return n},_listActorsAssetsRecursively:function(e,t){var r={experienceObject:e,name:e.QueryInterface("CATI3DExperienceObject").GetValueByName("_varName")},n=e.QueryInterface("CATI3DXAssetHolder")._getLinkDescription();if(r.assetLink=n||"",t.push(r),e.QueryInterface("CATI3DExperienceObject").HasVariable("actors")){var i=e.QueryInterface("CATI3DExperienceObject").GetValueByName("actors");for(let e=0;e<i.length;e++)this._listActorsAssetsRecursively(i[e],t)}if(e.QueryInterface("CATI3DExperienceObject").HasVariable("overrides")){var o=e.QueryInterface("CATI3DExperienceObject").GetValueByName("overrides");for(let e=0;e<o.length;e++)this._listActorsAssetsRecursively(o[e],t)}},_listMaterialsAssets:function(){var e=r.GetExperience(),t=[];if(e.QueryInterface("CATI3DExperienceObject").HasVariable("materials"))for(var n=e.QueryInterface("CATI3DExperienceObject").GetValueByName("materials"),i=0;i<n.length;i++)t.push({experienceObject:n[i],name:n[i].QueryInterface("CATI3DExperienceObject").GetValueByName("_varName"),assetLink:n[i].QueryInterface("CATI3DXAssetHolder")._getLinkDescription()});return t},_listEnvironmentsAssets:function(){var e=r.GetExperience(),t=[];if(e.QueryInterface("CATI3DExperienceObject").HasVariable("environments"))for(var n=e.QueryInterface("CATI3DExperienceObject").GetValueByName("environments"),i=0;i<n.length;i++)t.push({experienceObject:n[i],name:n[i].QueryInterface("CATI3DExperienceObject").GetValueByName("_varName"),assetLink:n[i].QueryInterface("CATI3DXAssetHolder")._getLinkDescription()});return t},_listResourcesAssets:function(){var e=r.GetExperience(),t=[];if(e.QueryInterface("CATI3DExperienceObject").HasVariable("resources"))for(var n=e.QueryInterface("CATI3DExperienceObject").GetValueByName("resources"),i=0;i<n.length;i++)t.push({experienceObject:n[i],name:n[i].QueryInterface("CATI3DExperienceObject").GetValueByName("_varName"),assetLink:n[i].QueryInterface("CATI3DXAssetHolder")._getLinkDescription()});return t}})}),define("DS/XCTWebExperienceAppPlay/StuTriggerZoneManagerWeb",["UWA/Core","UWA/Class","DS/StuTriggerZones/StuTriggerZoneManager","DS/StuTriggerZones/StuTriggerZoneActor","DS/StuCore/StuContext","DS/StuMath/StuBox","DS/MathematicsES/MathsDef"],function(e,t,r,n,i,o,a){"use strict";r.prototype.getTriggerZoneManager=function(){return new s},r.prototype.deleteTriggerZoneManager=function(){};var s=t.extend({__stu__Init:function(){this._uObjectID=1,this._triggerZones=[],this._triggeringObjects=[],this._interactionsMap={}},__stu__Dispose:function(){},__stu__RegisterTriggerZone:function(e){this._triggerZones.push({id:this._uObjectID,stuObject:e.getStuObject()});var t=this._uObjectID;return this._uObjectID++,t},__stu__RegisterTriggeringObject:function(e){this._triggeringObjects.push({id:this._uObjectID,stuObject:e.getStuObject()});var t=this._uObjectID;return this._uObjectID++,t},__stu__GetNbTriggerZones:function(){return this._triggerZones.length},__stu__GetNbTriggeringObjects:function(){return this._triggeringObjects.length},__stu__UnRegisterTriggerZone:function(e){var t=this._triggerZones.map(function(e){return e.id}).indexOf(e);t>=0&&this._triggerZones.splice(t,1)},__stu__UnRegisterTriggeringObject:function(e){var t=this._triggeringObjects.map(function(e){return e.id}).indexOf(e);t>=0&&this._triggeringObjects.splice(t,1)},__stu__Run:function(){this.refreshTransform(this._triggerZones),this.refreshTransform(this._triggeringObjects),this._computeInteractions()},refreshTransform:function(e){for(var t=0;t<e.length;t++){var r=e[t].stuObject.getTransform();e[t].transform?e[t].transfoChanged=this.areTransfoEqual(e[t].transform,r):e[t].transfoChanged=!0,e[t].transform=r,e[t].transfoChanged&&(this.refreshBB(e[t]),this.refreshOBBCornerPoints(e[t]))}},refreshBB:function(e){var t=new o;e.stuObject.StuIRepresentation.GetBoundingBox(t,e.transform,0),e.bb=t},refreshOBBCornerPoints:function(e){var t=new o;e.stuObject.StuIRepresentation.GetOrientedBoundingBox(t,{orientation:e.transform,excludeChildren:!1},e.transform);var r,n=t.high.x-t.low.x,i=t.high.y-t.low.y,a=t.high.z-t.low.z,s=[];for(r=0;r<4;r++)s[r]=t.low.clone();for(r=0;r<4;r++)s[r+4]=t.high.clone();for(s[1].x+=n,s[2].y+=i,s[3].z+=a,s[4].x-=n,s[5].y-=i,s[6].z-=a,r=0;r<8;r++)s[r].applyTransformation(e.transform);e.obbCornerPoints=s},_computeInteractions:function(){for(var e=0;e<this._triggerZones.length;e++)for(var t=0;t<this._triggeringObjects.length;t++)(this._triggerZones[e].transfoChanged||this._triggeringObjects[t].transfoChanged)&&this._computeInteraction(this._triggerZones[e],this._triggeringObjects[t])},_computeInteraction:function(t,r){var n,o=this.isIntersectByBoundingBox(t.bb,r.bb);-1!==o&&(o=this.isIntersectByOrientedBoundingBox(t.obbCornerPoints,r.obbCornerPoints)),(n=e.is(this._interactionsMap[t.id])&&e.is(this._interactionsMap[t.id][r.id])?this._interactionsMap[t.id][r.id]:-1)!==o&&(n<0&&o>=0&&i.TriggerZoneManager.getInstance().onTriggerZoneEntry(t.id,r.id),n>=0&&o<0&&i.TriggerZoneManager.getInstance().onTriggerZoneExit(t.id,r.id),o>0&&n<=0&&i.TriggerZoneManager.getInstance().onTriggerZoneInclusion(t.id,r.id,o),o<=0&&n>0&&i.TriggerZoneManager.getInstance().onTriggerZoneEndInclusion(t.id,r.id,o)),e.is(this._interactionsMap[t.id])||(this._interactionsMap[t.id]={}),this._interactionsMap[t.id][r.id]=o},isIntersectByBoundingBox:function(e,t){return e.high.x<t.low.x||e.high.y<t.low.y||e.high.z<t.low.z||t.high.x<e.low.x||t.high.y<e.low.y||t.high.z<e.low.z?-1:0},isIntersectByOrientedBoundingBox:function(e,t){var r,n=[],i=[];for(r=0;r<8;r++)n.push(new a.Vector3D(e[r].x,e[r].y,e[r].z)),i.push(new a.Vector3D(t[r].x,t[r].y,t[r].z));var o=[],s=[];for(r=1;r<=3;r++)o.push(a.Vector3D.sub(n[r],n[0])),s.push(a.Vector3D.sub(i[r],i[0]));var c=-1;for(r=0;r<3&&!((c=this.projectionsAreIntersected(n,i,o[r],c))<0);r++);if(c>=0)for(r=0;r<3&&!((c=this.projectionsAreIntersected(n,i,s[r],c))<0);r++);if(c>=0)for(r=0;r<3;r++)for(var u=0;u<3;u++){var p=o[r].clone().cross(s[u]);if((c=this.projectionsAreIntersected(n,i,p,c))>=0)break}return c},projectionsAreIntersected:function(e,t,r,n){if(r.isEqual(new a.Vector3D(0,0,0),1e-6))return n;for(var i,o=a.normalize(r),s=Number.MAX_VALUE,c=-Number.MAX_VALUE,u=Number.MAX_VALUE,p=-Number.MAX_VALUE,l=0;l<8;l++){var f=e[l].dot(o),h=t[l].dot(o);s=f<s?f:s,c=f>c?f:c,u=h<u?h:u,p=h>p?h:p}return i=0!==n?u<s&&p>c&&(-1===n||1===n)?1:s<u&&c>p&&(-1===n||2===n)?2:0:n,c<u||s>p?-1:i},areTransfoEqual:function(e,t){for(var r=e.getCoefficients(),n=t.getCoefficients(),i=0;i<12;++i)if(Math.abs(r[i]-n[i])>1e-6)return!0;return!1}});return s}),define("DS/XCTWebExperienceAppPlay/commands/XCTWebPlayCmd",["UWA/Core","UWA/Class/Listener","DS/ApplicationFrame/Command"],function(e,t,r){"use strict";return e.Class.extend(r,t,{init:function(e){this._parent(e,{isAsynchronous:!0});var t=this.getFrameWindow()._experienceBase;this.listenTo(t.getManager("CXPWebPlayManager"),"PlayStateChanged",this._switchEnableFromPlayState.bind(this))},execute:function(){var e=this.getFrameWindow()._experienceBase,t=this;e.getManager("CXPWebPlayManager").play().done(function(){t.end()})},_switchEnableFromPlayState:function(e){var t=this.getFrameWindow()._experienceBase;if(t){var r=t.getManager("CXPWebPlayManager");r.ePlayState.eStop===e||r.ePlayState.ePause===e?this.enable():this.disable()}}})}),define("DS/XCTWebExperienceAppPlay/StuUIBinder",["UWA/Core","UWA/Class"],function(e){"use strict";return e.Class.extend({fillProperties:function(){}})}),define("DS/XCTWebExperienceAppPlay/CXPWebViewpoint",["UWA/Core","DS/Visualization/ThreeJS_DS","DS/CATCXPModel/CATCXPRenderUtils"],function(e,t,r){"use strict";return e.Class.extend({_viewer:null,init:function(e){this._viewpoint=e},__stu__IsLocked:function(){return 0},__stu__SetAngle:function(e){this._viewpoint.setAngle(2*e)},__stu__SetViewpoint:function(e,r,n){var i=new t.Vector3(n.x,n.y,n.z),o=new t.Vector3(r.x,r.y,r.z);this._viewpoint.moveTo({eyePosition:e,sightDirection:o,upDirection:i})},__stu__SetClippingValue:function(e,t){this._viewpoint.camera.near=e,this._viewpoint.camera.far=t},__stu__SetProjectionType:function(e){this._viewpoint.setProjectionType(e)},__stu__SetZoom:function(e){var t=this._viewpoint.camera,r=(t.right-t.left)/(2*e),n=(t.top-t.bottom)/(2*e),i=(t.right+t.left)/2,o=(t.top+t.bottom)/2;t.projectionMatrix.makeOrthographic(i-r,i+r,o+n,o-n,t.near,t.far)},__stu__SetFocusDistance:function(e){this._viewpoint.setTargetDistance(e)},__setViewpointFromCamera:function(e){r.setViewpointFromCamera(this._viewpoint,e.CATI3DExperienceObject.getModelObject())}})}),define("DS/XCTWebExperienceAppPlay/StuHMDWrapper",["DS/StudioIV/StuHMDWrapper"],function(e){"use strict";e.prototype.setInteractionCtxTransform=function(){},e.prototype.getInteractionCtxTransform=function(){},e.prototype.deactivateMainViewerRefresh=function(){},e.prototype.activateMainViewerRefresh=function(){},e.prototype.setRepresentationVisibility=function(){},e.prototype.start=function(){}}),define("DS/XCTWebExperienceAppPlay/CAT3DXModelFactoryPlay",["UWA/Core","DS/CAT3DExpModel/CAT3DXModelFactory","DS/CAT3DExpModel/CAT3DXJSONReader"],function(e,t,r){"use strict";return t.extend({LoadExperience:function(t){var n=this;return this._expCoreLinkManager.resolveLink(t).then(function(t){var r=e.Promise.deferred(),n=new FileReader;return n.onloadend=function(t){var n=JSON.parse(t.target.result);e.is(n)||r.reject("invalid string"),r.resolve(n)},n.readAsText(t),r.promise}).then(function(e){return r.read(e,n._objectBuilder,n._expDataObjectMap,n._expCoreLinkManager)}).then(function(r){return e.is(r)?e.Promise.resolve(r):e.Promise.reject("Cant load experience from link : "+t)})},CloseExperience:function(){var e=this.GetExperience();return this._objectBuilder._removeObject(e)}})}),define("DS/XCTWebExperienceAppPlay/commands/XCTWebPauseCmd",["UWA/Core","UWA/Class/Listener","DS/ApplicationFrame/Command"],function(e,t,r){"use strict";return e.Class.extend(r,t,{init:function(e){this._parent(e,{isAsynchronous:!1});var t=this.getFrameWindow()._experienceBase;this.listenTo(t.getManager("CXPWebPlayManager"),"PlayStateChanged",this._switchEnableFromPlayState.bind(this))},execute:function(){this.getFrameWindow()._experienceBase.getManager("CXPWebPlayManager").pause()},_switchEnableFromPlayState:function(e){var t=this.getFrameWindow()._experienceBase;t&&(t.getManager("CXPWebPlayManager").ePlayState.ePlaying===e?this.enable():this.disable())}})}),define("DS/XCTWebExperienceAppPlay/CXPWebiVWrapper",[],function(){"use strict";var e=function(){};return e.prototype.createIVScenario=function(){},e.prototype.setBackgroundStreamState=function(){},e.prototype.setMarkerType=function(){},e.prototype.setMarkerSize=function(){},e.prototype.startTracking=function(){},e.prototype.isNoTrackingEnabled=function(){},e.prototype.setMirrorState=function(){},e.prototype.dispose=function(){},e.prototype.getBackgroundStreamState=function(){},e.prototype.getMirrorState=function(){},e}),define("DS/XCTWebExperienceAppPlay/CXPWebSoundListenerWrapper",[],function(){"use strict";var e=function(){};return e.prototype.setVolume=function(){},e.prototype.getVolume=function(){},e.prototype.setPosition=function(){},e.prototype.setOrientation=function(){},e}),define("DS/XCTWebExperienceAppPlay/StuRaytraceWrapper",["DS/StuRaytrace/StuRaytraceWrapper"],function(e){"use strict";e.prototype.setAperture=function(){},e.prototype.setExposure=function(){},e.prototype.setFocusDistance=function(){},e.prototype.setSpeed=function(){},e.prototype.setAutoFocusMode=function(){},e.prototype.setProduceVideo=function(){},e.prototype.shotSingleFrame=function(){},e.prototype.begin=function(){},e.prototype.end=function(){}}),define("DS/XCTWebExperienceAppPlay/StuCDSDynFactory",["DS/StuPhysic/StuCDSDynFactory"],function(e){"use strict";e.buildCDSDynFactory=function(){return{CreateBox:function(){},CreateForce:function(){return{SetApplicationPoint:function(){},SetForceComponent:function(){},SetTorqueComponent:function(){}}},CreateMaterial:function(){},CreateRigidBody:function(){return{SetOrigin:function(){},SetOrientation:function(){},EnableAutomaticDeactivation:function(){},SetMaterial:function(){},SetAngularDamping:function(){},SetLinearVelocity:function(){},SetAngularVelocity:function(){}}},ReleaseObject:function(){},CreateInertia:function(){return{SetMass:function(){},SetInertia:function(){},SetCenterOfGravity:function(){}}},CreateSolverConfig:function(){},CreateSolver:function(){return{SetWorld:function(){},AddRigidBody:function(){},AddImpulse:function(){},AddForce:function(){},RemoveForce:function(){}}},CreateWorld:function(){return{SetSize:function(){},SetGravity:function(){}}}}},e.buildCDSDynInertiaComputer=function(e,t){return{Run:function(){this.usedVar=t},GetMass:function(){},GetPrincipalInertia:function(){return{oInertia:null,oInertiaOrientation:null}},GetCoG:function(){return{oCoG:[null,null,null]}}}},e.removeCDSDynInertiaComputer=function(e){this.usedVar=e}}),define("DS/XCTWebExperienceAppPlay/managers/W3AACXPWebPlayManager",["UWA/Core","DS/WebApplicationBase/W3AAManager","DS/EPTaskPlayer/EPTaskPlayerDefine"],function(e,t,r){"use strict";return e.Class.extend(t,{update:function(e){r.execute({deltaTime:e.deltaTime,elapsedTime:Date.now()-this._startDate})},getUpdatePriority:function(){return 0}})}),define("DS/XCTWebExperienceAppPlay/StuVisuServices",["DS/StuMiscContent/StuVisuServices","UWA/Core","DS/Visualization/ThreeJS_DS","DS/Visualization/Node3D","DS/SceneGraphNodes/CSS2DNode","DS/StuRenderEngine/StuRenderManager"],function(e,t,r,n,i,o){"use strict";var a=t.Class.extend({GetPLMProperties:function(){return["toto"]},GetPLMPropValue:function(){},AnnotationDisplay:function(e,t){o.getInstance().main3DViewer._viewer.getRootNode().addChild(t)}});return e.prototype.build=function(){return new a},e}),define("DS/XCTWebExperienceAppPlay/CXPWebSoundSourceWrapper",[],function(){"use strict";var e=function(){};return e.prototype.getEngineStatus=function(){},e.prototype.getVolume=function(){},e.prototype.getDuration=function(){},e.prototype.getPlayPostion=function(){},e.prototype.getConeInnerAngle=function(){},e.prototype.getConeOuterAngle=function(){},e.prototype.getRollOffFactor=function(){},e.prototype.getPitch=function(){},e.prototype.getTempo=function(){},e.prototype.play=function(){},e.prototype.pause=function(){},e.prototype.stop=function(){},e.prototype.isPlaying=function(){},e.prototype.isPaused=function(){},e.prototype.isStopped=function(){},e}),define("DS/XCTWebExperienceAppPlay/StuEnvServices",["DS/StuCore/StuEnvServices"],function(e){"use strict";e.CATGetEnv=function(e){return localStorage.getItem(e)},e.EKIntegrationOFF=function(){return!0}}),define("DS/XCTWebExperienceAppPlay/CXPWebHMDWrapper",[],function(){"use strict";var e=function(){};return e.prototype.setInteractionCtxTransform=function(){},e.prototype.getInteractionCtxTransform=function(){},e.prototype.deactivateMainViewerRefresh=function(){},e.prototype.activateMainViewerRefresh=function(){},e.prototype.setRepresentationVisibility=function(){},e.prototype.start=function(){},e}),define("DS/XCTWebExperienceAppPlay/CATCXPHumanManager",["DS/StuHuman/CATCXPHumanManager"],function(e){"use strict";e.CATGetHumanManager=function(){return{RegisterHumanMotionBe:function(){}}}}),define("DS/XCTWebExperienceAppPlay/CXPConfServices",["DS/StuRenderEngine/CXPConfServices"],function(e){"use strict";return e.prototype.build=function(){return this},e.prototype.getConfiguration=function(){},e.prototype.setConfiguration=function(){},e.prototype.checkActivations=function(){},e.prototype.removeConfiguration=function(){},e.prototype.getCurrentConfigurationName=function(){},e}),define("DS/XCTWebExperienceAppPlay/managers/XCTEWSECXPWebPlayerOptionsMgr",["UWA/Core","UWA/Class"],function(e,t){"use strict";return t.extend({Dispose:function(){delete this._playerOptions},setPlayerOptions:function(t){var r=t&&t.input&&t.input.playOptions?t.input.playOptions:{},n=!!e.is(r.progressiveLoading)&&r.progressiveLoading,i=!e.is(r.play)||r.play,o=!!e.is(r.transparentBackground)&&r.transparentBackground,a=r.workbenchModule?r.workbenchModule:"XCTWebExperienceAppPlay",s=r.workbench?r.workbench:"XCTWebExperienceAppPlay.xml",c=t&&t.playExperience?t.playExperience:{};const u=!e.is(t.OptimizeRaycasting)||t.OptimizeRaycasting;this._playerOptions={autoPlay:i,progressiveLoading:n,transparentBackground:o,workbench:s,workbenchModule:a,playExperience:c,optimizeRaycasting:u};let p=this.GetObject()._experienceBase;var l=p.webApplication.frmWindow;l.loadActionBar({workbenchModule:a,workbench:s}),l.onActionBarReady(function(){var e=l.getActionBar();e&&e.close()}),o&&p.getManager("CAT3DXEnvironmentManager").setTransparentBackground(!0),p.getManager("CAT3DXVisuManager").activateAccelerationStructure()},getPlayerOptions:function(){return this._playerOptions?this._playerOptions:{}}})}),define("DS/XCTWebExperienceAppPlay/CXPWebCapacityLauncher",["DS/StuMiscContent/StuCapacityLauncher","DS/Controls/Button","UWA/Core","DS/Visualization/ThreeJS_DS","DS/Visualization/Node3D","DS/SceneGraphNodes/CSS2DNode"],function(e,t,r,n,i,o){"use strict";return e.prototype.createCapacityPanel=function(e,t){for(var i=r.createElement("div",{id:"layouttest",styles:{display:"flex","flex-direction":"column","align-items":"stretch",width:"auto",padding:"4px",border:"1px solid #E2E4E3","background-color":"#F4F5F6"}}),a=0;a<e.length;a++)e[a].inject(i);return new o({html:i,offset:new n.Vector2(t.x,t.y)})},e.prototype.createElement=function(e,r){if("CATVidCtlButton"===e){var n=new t;return n.label=r.Label,n.Name=r.Name,n.displayStyle="flyout",n.elements.button.style.cssText="justify-content : left",n}},e.prototype.setClickEventName=function(){return"click"},e.prototype.getCapacities=function(){if(this.capacities&&this.capacities!==[])return this.capacities;var e=[],t=this.actor,r=t.behaviors,n=function(e){var t=e.name;return!["hide","show","activate","deactivate"].includes(t)&&""===e._naturalLanguageInfo._exposedVariableName&&"SensorState"!==e._naturalLanguageInfo._capacityType},i=[],o=[];t._services&&(i=i.concat(t._services.filter(n))),t._functions&&(o=o.concat(t._functions.filter(n)));for(var a=0;a<r.length;a++)r[a]._services&&(i=r[a]._services.concat(i)),r[a]._functions&&(o=r[a]._functions.concat(o));return(e=(e=e.concat(i,o,[])).filter(n)).map(function(e){return e.name})},e.prototype.visibleFlagSpelling=function(){return"visibleFlag"},e.prototype.setVisibility=function(e,t){e.setVisibility(t),this.CATI3DExperienceObject.getModelObject()._experienceBase.getManager("CAT3DXVisuManager").forceViewerRefresh()},e.prototype.toggleVisibility=function(e){var t=e.visible;e.setVisibility(!t),this.CATI3DExperienceObject.getModelObject()._experienceBase.getManager("CAT3DXVisuManager").forceViewerRefresh()},e}),define("DS/XCTWebExperienceAppPlay/extensions/CATECXPExperienceScenesMgrPlay",["UWA/Core","DS/CAT3DExpModel/CAT3DXModel","DS/CATCXPModel/extensions/CATECXPExperienceScenesMgr"],function(e,t,r){"use strict";return e.Class.extend(r,{Build:function(){this._parent(),this._switchedscenes=[],this._lastSceneChanged=void 0,this.listenTo(this.GetObject()._experienceBase.getManager("CXPWebPlayManager"),"PlayStateChanged",function(){this._OnPlayStateChanged()})},Dispose:function(){delete this._switchedscenes,delete this._lastSceneChanged,this._parent()},_OnPlayStateChanged:function(){var e=this.GetObject()._experienceBase.getManager("CXPWebPlayManager");if(e&&e.ePlayState.eStart===e.getPlayState()){var t=this.GetCurrentScene();t&&(this._switchedscenes.push(t),this._lastSceneChanged=t)}else e&&e.ePlayState.eStop===e.getPlayState()&&(this._switchedscenes.splice(0,this._switchedscenes.length),this._lastSceneChanged=void 0)},_OnSceneChanged:async function(e){var t=this.GetObject()._experienceBase.getManager("CXPWebPlayManager");if(t&&t.ePlayState.ePlaying!==t.getPlayState())return this._parent(e);if(e!==this._lastSceneChanged){var r=this._parent;await this._manageLastSceneAtPlay(this._lastSceneChanged),this._lastSceneChanged=e,r.call(this,e),await this._manageNewSceneAtPlay(e)}},_manageLastSceneAtPlay:async function(e){var r=this.GetObject()._experienceBase.getManager("CXPWebPlayManager");if(!r||r.ePlayState.ePlaying===r.getPlayState()){var n=t.GetExperience(),i=this.GetObject()._experienceBase.getManager("CAT3DExperienceESExportManager").getProjectedESObject(n);if(i&&e){var o=this.GetObject()._experienceBase.getManager("CAT3DExperienceESExportManager").getProjectedESObject(e);o&&i.handlePreviousSceneSwitch(o)}}},_manageNewSceneAtPlay:async function(r){var n=this.GetObject()._experienceBase.getManager("CXPWebPlayManager");if(!n||n.ePlayState.ePlaying===n.getPlayState()){var i=t.GetExperience(),o=this.GetObject()._experienceBase.getManager("CAT3DExperienceESExportManager").getProjectedESObject(i);if(o&&r){var a=this.GetObject()._experienceBase.getManager("CAT3DExperienceESExportManager").getProjectedESObject(r);if(a){-1!==this._switchedscenes.indexOf(r)?await this._ResetValues(r):this._switchedscenes.push(r);var s=this.GetObject()._experienceBase.getManager("CAT3DXUIManager").waitUIActorsReady(),c=this.GetObject()._experienceBase.getManager("CAT3DXVisuManager").waitContentReady();return e.Promise.all([s,c]).then(function(){o.handleNewSceneSwitch(a)})}}}},_ResetValues:async function(e){e.QueryInterface("CATI3DExperienceObject").GetValueByName("_rebuildPlay")&&(e.QueryInterface("CATI3DXVolatileEO").restorePersistent(),e.QueryInterface("CATI3DXVolatileEO").setVolatile(),await this.GetObject()._experienceBase.getManager("CAT3DExperienceESExportManager").export(e))}})}),define("DS/XCTWebExperienceAppPlay/StuMaterialsManager",["DS/StuRenderEngine/StuMaterialsManager","DS/StuModel/StuExperience"],function(e,t){"use strict";return e.prototype.build=function(){return this},e.prototype.getMaterialName=function(e){var t=this.getMaterial(e);return t?t.name:null},e.prototype.setMaterialByName=function(e,r){for(var n=t.getCurrent().CATI3DExperienceObject.GetValueByName("materials"),i=0;i<n.length;i++)n[i].name===r&&this.setMaterial(e,n[i].CATI3DExperienceObject)},e.prototype.removeMaterials=function(e){e.SetValueByName("materials",[])},e.prototype.setMaterial=function(e,t){var r=e.getModelObject(),n=r._experienceBase.getManager("CXPWebPlayManager");t?n.createVolatileObjectFromPrototype("CXPMaterialApplication_Spec","materialApplication",r,"materials",!0).done(function(e){e.CATI3DExperienceObject.SetValueByName("linktomaterial",t.getStuObject())}):e.SetValueByName("materials",[])},e.prototype.getMaterial=function(e){var t=e.GetValueByName("materials");return!t||!t.length>0?null:t[0].CATI3DExperienceObject.GetValueByName("linktomaterial")},e}),define("DS/XCTWebExperienceAppPlay/CXPWebEnvironmentsManager",["UWA/Core","DS/CAT3DExpModel/CAT3DXModel"],function(e,t){"use strict";return e.Class.extend({getActiveEnvironmentName:function(){var e=t.GetExperience();if(e)return e.QueryInterface("CATICXPEnvironmentsMgr").GetActiveEnvironment().QueryInterface("CATIAlias").GetAlias()},setActiveEnvironmentByNumber:function(e){var r=t.GetExperience();if(r){var n=r.QueryInterface("CATICXPEnvironmentsMgr"),i=[];return n.ListEnvironments(i),0===e?n.SetActiveEnvironment():n.SetActiveEnvironment(i[e-1]),e}},getActiveEnvironmentNumber:function(){var e=t.GetExperience();if(!e)return 0;var r=e.QueryInterface("CATICXPEnvironmentsMgr"),n=[];r.ListEnvironments(n);var i=r.GetActiveEnvironment();return n.indexOf(i)+1},deActivateEnvironment:function(){var e=t.GetExperience();if(e)return e.QueryInterface("CATICXPEnvironmentsMgr").SetActiveEnvironment(),this.getActiveEnvironmentNumber()},setActiveEnvironmentByName:function(e){var r=t.GetExperience();if(r){var n=r.QueryInterface("CATICXPEnvironmentsMgr"),i=[];n.ListEnvironments(i);for(var o=0;o<i.length;o++)if(i[o].QueryInterface("CATIAlias").GetAlias()===e)return n.SetActiveEnvironment(i[o]),this.getActiveEnvironmentNumber()}},initStartupEnvironment:function(){var e=t.GetExperience();if(e){var r=e.QueryInterface("CATICXPEnvironmentsMgr"),n=r.GetStartupEnvironment();return n&&r.SetActiveEnvironment(n),this.getActiveEnvironmentNumber()}},getExperienceScaleFactor:function(){return 1},getActiveLocation:function(){var e=t.GetExperience();if(e)return e.QueryInterface("CATICXPEnvironmentsMgr").GetActiveLocation()}})}),define("DS/XCTWebExperienceAppPlay/CXPWebGeomPrimitiveISOManager",["UWA/Core","DS/StuCore/StuContext","DS/Visualization/SceneGraphFactory","DS/Visualization/ThreeJS_DS","DS/Visualization/Node3D","DS/Mesh/Mesh","DS/SceneGraphNodes/ArrowNode","DS/SceneGraphNodes/FixedSizeArrowNode","DS/SceneGraphOverrides/SceneGraphOverrideSet","DS/Visualization/PathElement","DS/SceneGraphNodes/FixedSizeNode3D","DS/MathematicsES/MathsDef"],function(e,t,r,n,i,o,a,s,c,u,p,l){"use strict";var f=e.Class.singleton({init:function(){this._GeomPrimitiveRootNode=new i,this._GeomPrimitiveRootNode.pickable=!1,this._sceneGraphOS=new c(this._GeomPrimitiveRootNode),this._primitiveNodes={},this._uIDNode=0},deleteAll:function(){for(var e in this._sceneGraphOS.deleteOverrides(this._sceneGraphOS.getOverrides()),this._GeomPrimitiveRootNode.removeChildren(),this._primitiveNodes)this._primitiveNodes.hasOwnProperty(e)&&delete this._primitiveNodes[e];this._viewer&&this._viewer.render()},setViewer:function(e){this._viewer&&(this._viewer.removeNode(this._GeomPrimitiveRootNode),this._viewer.getSceneGraphOverrideSetManager()&&this._viewer.getSceneGraphOverrideSetManager().removeSceneGraphOverrideSet(this._sceneGraphOS)),this._viewer=e,e.addNode(this._GeomPrimitiveRootNode),this._viewer.getSceneGraphOverrideSetManager().pushSceneGraphOverrideSet(this._sceneGraphOS)},_createNewRep:function(r,o,a){var s;if(s=a.screenSize?new p({ratio:t.RenderManager.getInstance().getPixelDensity()}):new i,this._GeomPrimitiveRootNode.addChild(s),o instanceof l.Transformation){var c=o.getArray(),f=new n.Matrix4(c[0],c[3],c[6],c[9],c[1],c[4],c[7],c[10],c[2],c[5],c[8],c[11],0,0,0,1);s.setMatrix(f)}else s.setMatrix(o);s.addChild(r);var h=this._uIDNode;this._primitiveNodes[h]=s,this._uIDNode++;var d=e.is(a.alpha)?a.alpha/255:1,y=a.color?"rgb("+a.color.r+","+a.color.g+","+a.color.b+")":"rgb(150,150,150)",g=new u([this._GeomPrimitiveRootNode,s]),S=this._sceneGraphOS.createOverride(g);return S.setOpacity(d,!1),S.setColor(y,!1),this._viewer&&this._viewer.render(),h},createBox:function(t){var i,o,a,s,c,u,p,l=!!e.is(t.closed)&&t.closed,f=Boolean(t.centered);t.box?(i=new n.Vector3(t.box.low.x,t.box.low.y,t.box.low.z),o=new n.Vector3(t.box.high.x-t.box.low.x,0,0),a=new n.Vector3(0,t.box.high.y-t.box.low.y,0),s=new n.Vector3(0,0,t.box.high.z-t.box.low.z)):("number"==typeof t.size?(c=t.size,u=t.size,p=t.size):(c=t.size.x,u=t.size.y,p=t.size.z),f?(i=new n.Vector3(t.position.vector.x-c/2,t.position.vector.y-u/2,t.position.vector.z-p/2),o=new n.Vector3(c/2,0,0),a=new n.Vector3(0,u/2,0),s=new n.Vector3(0,0,p/2)):(i=new n.Vector3(t.position.vector.x,t.position.vector.y,t.position.vector.z),o=new n.Vector3(c,0,0),a=new n.Vector3(0,u,0),s=new n.Vector3(0,0,p)));var h=r.createCuboidNode({cornerPoint:i,firstAxis:o,secondAxis:a,thirdAxis:s,fill:l,material:new n.PhysicalMaterial({force:!0})});return this._createNewRep(h,t.position,t)},createSphere:function(e){var t=e.radius,i=r.createSphereNode({radius:t,material:new n.PhysicalMaterial({force:!0})});return this._createNewRep(i,e.position,e)},createPoint:function(e){return e.screenSize=!0,e.radius=e.size,this._createSphere(e)},createVector:function(e){var t=this._CreateLineOrVector(e,!0);return this._createNewRep(t.rep,t.transform,e)},createLine:function(e){var t=this._CreateLineOrVector(e,!1);return this._createNewRep(t.rep,t.transform,e)},_CreateLineOrVector:function(e,t){var i,o=new n.Vector3;if(e.startPoint&&e.endPoint){var a=e.endPoint.clone().addScaledVector(e.startPoint,-1);o.set(a.x,a.y,a.z),i=o.distanceTo(new n.Vector3)}else i=e.length,o.set(e.direction.x,e.direction.y,e.direction.z);var s=new n.Vector3;s.set(e.startPoint.x,e.startPoint.y,e.startPoint.z);var c,u=e.width?e.width:.01*i;if(t){var p=e.headLength?e.headLength:.1*i,l=e.headWidth?e.headWidth:3*u;i-=p,c=r.createConeNode({bottomCenterPoint:new n.Vector3(0,0,i),topCenterPoint:new n.Vector3(0,0,i+p),topRadius:0,bottomRadius:l,material:new n.PhysicalMaterial({force:!0})})}var f=r.createCylinderNode({bottomCenterPoint:new n.Vector3(0,0,0),topCenterPoint:new n.Vector3(0,0,i),radius:u,material:new n.PhysicalMaterial({force:!0})});c&&f.addChild(c);var h=new n.Vector3(0,0,1);h.cross(o.clone()),0===h.length()&&(h.set(0,1,0),h.cross(o.clone()));var d=new n.Matrix4;return d.lookAt(o,new n.Vector3,h),d.setPosition(s),{rep:f,transform:d}},createAxis:function(e){var t=e.size,r={startPoint:new l.Vector3D(0,0,0),length:t};r.direction=new l.Vector3D(1,0,0);var n=this._CreateLineOrVector(r,!0);r.direction=new l.Vector3D(0,1,0);var o=this._CreateLineOrVector(r,!0);r.direction=new l.Vector3D(0,0,1);var a=this._CreateLineOrVector(r,!0),s=new i;return s.addChild(n.rep),s.addChild(o.rep),s.addChild(a.rep),n.rep.setMatrix(n.transform),o.rep.setMatrix(o.transform),a.rep.setMatrix(a.transform),this._createNewRep(s,e.position,e)},setColor:function(t,r,n,i,o){var a=this._primitiveNodes[t];if(a){var s=e.is(o)?o/255:1,c="rgb("+(e.is(r)?r:150)+","+(e.is(n)?n:150)+","+(e.is(i)?i:150)+")",p=new u([this._GeomPrimitiveRootNode,a]),l=this._sceneGraphOS.getUniqueOverrideFromPathElement(p);l.setOpacity(s,!1),l.setColor(c,!1),this._viewer&&this._viewer.render()}},setPosition:function(e,t){var r=this._primitiveNodes[e];if(r&&t instanceof l.Transformation){var i=t.getArray(),o=new n.Matrix4(i[0],i[3],i[6],i[9],i[1],i[4],i[7],i[10],i[2],i[5],i[8],i[11],0,0,0,1);r.setMatrix(o)}},ExternalizeSharedTransfo:function(e){this._sharedTransfo=e},CleanSharedTransfo:function(e){return e},SetPosFromSharedTransfo:function(e){if(this._primitiveNodes.hasOwnProperty(e)){var t=this._primitiveNodes[e];if(t){var r=this._sharedTransfo;if(r&&r[12]>0){var i=new n.Matrix4(r[0],r[3],r[6],r[9],r[1],r[4],r[7],r[10],r[2],r[5],r[8],r[11],0,0,0,1);t.setMatrix(i)}}}}});return f.__proto__.delete=function(e){var t=this._primitiveNodes[e];if(t){var r=new u([this._GeomPrimitiveRootNode,t]),n=this._sceneGraphOS.getUniqueOverrideFromPathElement(r);this._sceneGraphOS.deleteOverride(n),this._GeomPrimitiveRootNode.removeChild(t),delete this._primitiveNodes[e],this._viewer&&this._viewer.render()}},f.init(),f.deleteAll(),f}),define("DS/XCTWebExperienceAppPlay/StuProfilingServices",["DS/StuCore/StuProfilingServices"],function(e){"use strict";e.prototype.IsAnalyzerActive=function(){return!1}}),define("DS/XCTWebExperienceAppPlay/StuProxy/StuProxy",["UWA/Core","UWA/Class"],function(e){"use strict";return e.Class.extend({init:function(e,t){this._modelObject=e,this._stuObject=t},dispose:function(){delete this._modelObject,delete this._stuObject},getModelObject:function(){return this._modelObject},getStuObject:function(){return this._stuObject}})}),define("DS/XCTWebExperienceAppPlay/managers/XCTEWSECXPWebExperienceMgr",["UWA/Core","UWA/Class","UWA/Class/Listener","DS/CATCXPModel/CATCXPRenderUtils","DS/CAT3DExpModel/interfaces/CATI3DExperienceObject"],function(e,t,r,n,i){"use strict";return t.extend(r,{onExperienceReady:function(t){let r=this.GetObject()._experienceBase,o=this.QueryInterface("XCTEWSIPlayerOptionsMgr").getPlayerOptions(),a=o.autoPlay,s=o.progressiveLoading,c=o.playExperience,u=c&&c.onModelLoadingProgression?c.onModelLoadingProgression:function(){},p=c&&c.onModelLoadingCompleted?c.onModelLoadingCompleted:function(){};u({loaded:75,total:100});var l=this,f=!0,h=t.QueryInterface("CATI3DExperienceObject")._GetExpDataObject(),d=h.GetValueByName("scenes");d.length>0&&h._AddVariableSession("currentScene",i.VarType.Object,1,i.ValuationMode.ReferencingValue,"CXPScene_Spec","currentScene",d[0]),t.QueryInterface("CATICXPScenesMgr");var y=t.QueryInterface("CATI3DGeoVisu");r.getManager("CAT3DXVisuManager").setRoot(y),r.getManager("CAT3DXVisuManager").setContent(y),r.getManager("CAT3DXEnvironmentManager").setExperience(t),s&&(c.modelLoadComplete=void 0);var g,S=t.QueryInterface("CATI3DExperienceObject"),m=S.GetValueByName("currentCamera");if(!m&&S.HasVariable("startupCamera")&&(m=S.GetValueByName("startupCamera")),m){if(s){let e=r.getManager("CAT3DXVisuManager").getViewer();n.setViewpointFromCamera(e.currentViewpoint,m,0)}f=!1}if(y.isReady())g=e.Promise.resolve();else{let t=e.Promise.deferred();this.listenTo(y,"readyChanged",function(e){e&&(l.stopListening(y,"readyChanged"),t.resolve())}),g=t.promise}return g.then(function(){return r.getManager("CAT3DXUIManager").setExperience(t),r.getManager("CAT3DXUIManager").waitUIActorsReady()}).then(function(){if(u({loaded:90,total:100}),!f)return e.Promise.resolve();c.modelLoadComplete=void 0;let t=new e.Promise.deferred,n=r.getManager("CAT3DXVisuManager").getViewer();return n.setRenderFrameCB(function(){n.setRenderFrameCB(null),n.currentViewpoint.reframe(null,0),t.resolve()}),t.promise}).then(function(){return e.is(a)&&!0!==a?e.Promise.resolve():r.getManager("CXPWebPlayManager").play()}).then(function(){return p(),e.Promise.resolve()})},onPreDisposeExperience:function(){let t=this.GetObject()._experienceBase;return t.getManager("CXPWebPlayManager").stop(),t.getManager("CAT3DXVisuManager").removeContent(),t.getManager("CAT3DXUIManager").removeExperience(),t.getManager("CAT3DXEnvironmentManager").removeExperience(),e.Promise.resolve()}})}),define("DS/XCTWebExperienceAppPlay/CXPWebSoundListener",["DS/StuSound/StuSoundListener","DS/XCTWebExperienceAppPlay/CXPWebSoundListenerWrapper"],function(e,t){"use strict";return e.prototype.buildWrapper=function(){return new t},e}),define("DS/XCTWebExperienceAppPlay/CXPWebiVScenario",["DS/StudioIV/StuiVScenario","DS/XCTWebExperienceAppPlay/CXPWebiVWrapper"],function(e,t){"use strict";return e.prototype.buildWrapper=function(){return new t},e}),define("DS/XCTWebExperienceAppPlay/CXPWebViveManager",["DS/StudioIV/StuViveManager","DS/XCTWebExperienceAppPlay/CXPWebHMDWrapper"],function(e,t){"use strict";return e.prototype.buildHMDWrapper=function(){return new t},e}),define("DS/XCTWebExperienceAppPlay/CXPWebRaytrace",["DS/StuRaytrace/StuRaytrace","DS/XCTWebExperienceAppPlay/CXPWebRaytraceWrapper"],function(e,t){"use strict";e.prototype.buildWrapper=function(){return new t}}),define("DS/XCTWebExperienceAppPlay/CXPWebSoundPlayer",["DS/StuSound/StuSoundPlayer","DS/XCTWebExperienceAppPlay/CXPWebSoundSourceWrapper"],function(e,t){"use strict";return e.prototype.buildWrapper=function(){return new t},e}),define("DS/XCTWebExperienceAppPlay/StuProxy/StuCATIMovable",["UWA/Core","DS/XCTWebExperienceAppPlay/StuProxy/StuProxy","DS/MathematicsES/MathsDef"],function(e,t,r){"use strict";var n=null;return t.extend({init:function(e,t){this._parent(e,t),this._modelCATIMovable=e.QueryInterface("CATIMovable"),Object.defineProperty(this,"_ArrayBuffer",{enumerable:!0,configurable:!0,get:function(){return n},set:function(e){n=e}})},dispose:function(){delete this._modelCATIMovable,this._parent()},GetLocalPosition:function(){var e=new r.Transformation;this._modelCATIMovable.GetLocalPosition(e),this._transformToArrayBuffer(e)},SetLocalPosition:function(){var e=this._arrayBufferToTransform();this._modelCATIMovable.SetLocalPosition(null,e)},GetAbsPosition:function(){var e=new r.Transformation;this._modelCATIMovable.GetAbsPosition(e),this._transformToArrayBuffer(e)},SetAbsPosition:function(){var e=this._arrayBufferToTransform();this._modelCATIMovable.SetAbsPosition(e)},ExternalizeArray:function(e){this._ArrayBuffer=e},CleanArray:function(){this._ArrayBuffer=null},_transformToArrayBuffer:function(e){var t=e.getArray();this._ArrayBuffer[0]=t[0],this._ArrayBuffer[1]=t[1],this._ArrayBuffer[2]=t[2],this._ArrayBuffer[3]=t[3],this._ArrayBuffer[4]=t[4],this._ArrayBuffer[5]=t[5],this._ArrayBuffer[6]=t[6],this._ArrayBuffer[7]=t[7],this._ArrayBuffer[8]=t[8],this._ArrayBuffer[9]=t[9],this._ArrayBuffer[10]=t[10],this._ArrayBuffer[11]=t[11]},_arrayBufferToTransform:function(){var e=new r.Transformation;return e.setFromArray(Array.prototype.slice.call(this._ArrayBuffer)),e}})}),define("DS/XCTWebExperienceAppPlay/StuProxy/StuCATI3DXGraphicalProperties",["UWA/Core","DS/XCTWebExperienceAppPlay/StuProxy/StuProxy"],function(e,t){"use strict";return t.extend({init:function(e,t){this._parent(e,t),this._modelCATI3DXGraphicalProperties=e.QueryInterface("CATI3DXGraphicalProperties")},dispose:function(){delete this._modelCATI3DXGraphicalProperties,this._parent()},GetPickMode:function(){return this._modelCATI3DXGraphicalProperties.GetPickMode()},SetPickMode:function(e){this._modelCATI3DXGraphicalProperties.SetPickMode(e)},GetShowMode:function(){return this._modelCATI3DXGraphicalProperties.GetShowMode()},SetShowMode:function(e){this._modelCATI3DXGraphicalProperties.SetShowMode(e)},GetOpacity:function(){return this._modelCATI3DXGraphicalProperties.GetOpacity()},SetOpacity:function(e){this._modelCATI3DXGraphicalProperties.SetOpacity(e)},GetRed:function(){return this._modelCATI3DXGraphicalProperties.GetRed()},GetGreen:function(){return this._modelCATI3DXGraphicalProperties.GetGreen()},GetBlue:function(){return this._modelCATI3DXGraphicalProperties.GetBlue()},SetColor:function(e,t,r){this._modelCATI3DXGraphicalProperties.SetColor(e,t,r)}})}),define("DS/XCTWebExperienceAppPlay/StuProxy/StuCATI3DExperienceObject",["UWA/Core","DS/XCTWebExperienceAppPlay/StuProxy/StuProxy","DS/CAT3DExpModel/interfaces/CATI3DExperienceObject","DS/StuRenderEngine/StuColor","DS/StuModel/StuExperience","DS/StuModel/StuActorTemplate","DS/StuRenderEngine/StuActor3D","UWA/Class/Listener","DS/VCXWebProperties/VCXColor"],function(e,t,r,n,i,o,a,s,c){"use strict";return t.extend({init:function(e,t){this._parent(e,t),this._modelCATI3DExperienceObject=e.QueryInterface("CATI3DExperienceObject"),this._ESExportManager=e._experienceBase.getManager("CAT3DExperienceESExportManager")},dispose:function(){delete this._modelCATI3DExperienceObject,delete this._ESExportManager,this._parent()},GetValueByName:function(e){var t=this._modelCATI3DExperienceObject.GetVariableType(e);return t===r.VarType.Object?this._GetValueByNameObject(e):t===r.VarType.Color?this._GetValueByNameColor(e):this._modelCATI3DExperienceObject.GetValueByName(e)},_GetValueByNameObject:function(e){var t,r=this._modelCATI3DExperienceObject.GetValueByName(e);if(r)if(Array.isArray(r)){t=[];for(var n=0;n<r.length;n++)if(r[n].QueryInterface("StuIPrototypeBuild")){var i=this._ESExportManager.getProjectedESObject(r[n]);i&&t.push(i)}}else r.QueryInterface("StuIPrototypeBuild")&&(t=this._ESExportManager.getProjectedESObject(r));return t},_GetValueByNameColor:function(e){var t,r=this._modelCATI3DExperienceObject.GetValueByName(e);if(r){var i=r.GetThreeColor();t=new n(255*i.r,255*i.g,255*i.b)}return t},SetValueByName:function(e,t){var n=this._modelCATI3DExperienceObject.GetVariableType(e);n===r.VarType.Object?this._SetValueByNameObject(e,t):n===r.VarType.Color?this._SetValueByNameColor(e,t):this._modelCATI3DExperienceObject.SetValueByName(e,t)},_SetValueByNameObject:function(e,t){if(t)if(Array.isArray(t)){for(var r=[],n=0;n<t.length;n++)r.push(t[n].CATI3DExperienceObject.getModelObject());this._modelCATI3DExperienceObject.SetValueByName(e,r)}else this._modelCATI3DExperienceObject.SetValueByName(e,t.CATI3DExperienceObject.getModelObject());else this._modelCATI3DExperienceObject.SetValueByName(e,t)},_SetValueByNameColor:function(e,t){this._modelCATI3DExperienceObject.SetValueByName(e,(new c).FromRGBA(t.r/255,t.g/255,t.b/255,1))},createDynamicInstance:function(t={},r,n){if(this.getStuObject()instanceof o){var a=r.CATI3DExperienceObject.getModelObject(),s=(t.parent?t.parent:i.getCurrent()).CATI3DExperienceObject.getModelObject(),c=t.name?t.name:r.name;if(!e.is(t.incrementName)||!0===t.incrementName){const e=s.QueryInterface("CATI3DExperienceObject").GetValueByName("actors").map(e=>e.QueryInterface("CATI3DExperienceObject").GetValueByName("_varName"));if(-1!==e.indexOf(c)){let t=2;const r=c;for(;-1!==e.indexOf(c);)c=r+" "+t,t++}}var u,p=this;this.getModelObject()._experienceBase.getManager("CXPWebPlayManager").createVolatileeObjectFromTemplate(a,c,s,"actors").then(function(e){return(u=e)._isVolatile=!0,p._getVisuReady(u)}).then(function(){t.onInstantiationSuccess&&t.onInstantiationSuccess.call(t.callbackCaller?t.callbackCaller:this,u),n.call(r,u),u.initialize(),u.activate(!0),u.isActive()?t.onActivationSuccess&&t.onActivationSuccess.call(t.callbackCaller?t.callbackCaller:this,u):p._throwFailure("Dynamic instance activation failed",t.onFailure)}).catch(function(){p._throwFailure("Create Dynamic instance failed",t.onFailure)})}else this._throwFailure("this method should be called on ActorTemplates only",t.onFailure)},_getVisuReady:function(t){var r=t.CATI3DExperienceObject.getModelObject().QueryInterface("CATI3DGeoVisu");if(!r)return e.Promise.resolve();if(r.isReady())return e.Promise.resolve();let n=e.Promise.deferred();var i=new s;return i.listenTo(r,"readyChanged",function(e){e&&(i.stopListening(r,"readyChanged"),setTimeout(function(){n.resolve()}))}),n.promise},_throwFailure:function(e,t){console.warn(e),t&&t(e)},IsDynamicInstance:function(){return!0===this.getStuObject()._isVolatile},delete:function(){this.getStuObject().dispose();var e=this.getModelObject();e._experienceBase.getManager("CXPWebPlayManager").removeVolatileObject(e)},getAssetLinkStatus:function(){return a.EAssetLinkStatus.eOK}})}),define("DS/XCTWebExperienceAppPlay/extensions/StuEExperienceBasePrototypeBuild",["UWA/Core","text!DS/XCTWebExperienceAppPlay/assets/XCTWebExperienceAppPlayPrototypeBuild.json","DS/XCTWebExperienceAppPlay/StuProxy/StuCATI3DExperienceObject"],function(e,t,r){"use strict";var n=JSON.parse(t);for(let e in n)n.hasOwnProperty(e)&&(n[e]={path:n[e]});return e.Class.extend({getESPrototype:function(){var t=this._getESPrototype();if(!t)return e.Promise.reject(new Error("Cant retrieve ES Prototype for expObject "+this.GetObject().GetType()));if(n[t].prototype)return e.Promise.resolve(n[t].prototype);if(n[t].prototypePromise)return n[t].prototypePromise;var r=e.Promise.deferred();return n[t].prototypePromise=r.promise,require([n[t].path],e=>{n[t].prototype=e,r.resolve(e),delete n[t].prototypePromise}),r.promise},_getESPrototype:function(){for(var e=this.GetObject().GetTypes(),t=e.length-1;t>=0;t--){var r=e[t];if(n.hasOwnProperty(r))return r}},build:function(t){t.CATI3DExperienceObject||(t.CATI3DExperienceObject=new r(this.GetObject(),t));return e.Promise.resolve([])},disposeESObject:function(e){e.CATI3DExperienceObject.dispose(),delete e.CATI3DExperienceObject}})}),define("DS/XCTWebExperienceAppPlay/extensions/StuEBeScriptPrototypeBuild",["UWA/Core","DS/XCTWebExperienceAppPlay/extensions/StuEExperienceBasePrototypeBuild"],function(e,t){"use strict";return t.extend({build:function(e){return e.__proto__.name=this.QueryInterface("CATI3DExperienceObject").GetValueByName("_varName"),this._parent(e)}})}),define("DS/XCTWebExperienceAppPlay/extensions/StuEVector3DPrototypeBuild",["UWA/Core","DS/XCTWebExperienceAppPlay/extensions/StuEExperienceBasePrototypeBuild","DS/MathematicsES/MathsDef"],function(e,t,r){"use strict";return t.extend({getESPrototype:function(){return e.Promise.resolve(r.Vector3D)}})}),define("DS/XCTWebExperienceAppPlay/extensions/StuEVector2DPrototypeBuild",["UWA/Core","DS/XCTWebExperienceAppPlay/extensions/StuEExperienceBasePrototypeBuild","DS/MathematicsES/MathsDef"],function(e,t,r){"use strict";return t.extend({getESPrototype:function(){return e.Promise.resolve(r.Vector2D)}})}),define("DS/XCTWebExperienceAppPlay/StuProxy/StuIRepresentation",["UWA/Core","DS/XCTWebExperienceAppPlay/StuProxy/StuProxy","DS/Visualization/ThreeJS_DS","DS/MathematicsES/MathsDef"],function(e,t,r,n){"use strict";return t.extend({GetBoundingSphere:function(e){var t,i=this._modelObject.QueryInterface("CATI3DGeoVisu"),o=i.GetPathElement(),a=this._modelObject._experienceBase.getManager("CAT3DXVisuManager").getViewer();t=i.GetOverride().getVisibility()?o.getBoundingSphere(a,"visibleSpace"):o.getBoundingSphere(a,"invisibleSpace");var s=this.getModelObject().QueryInterface("CATI3DExperienceObject").GetParent();if(s){var c=s.QueryInterface("CATIMovable");if(c){var u=new n.Transformation;c.GetAbsPosition(u);var p=u.getArray(),l=new r.Matrix4(p[0],p[3],p[6],p[9],p[1],p[4],p[7],p[10],p[2],p[5],p[8],p[11],0,0,0,1),f=(new r.Matrix4).getInverse(l);t.applyMatrix4(f)}}e.center.x=t.center.x,e.center.y=t.center.y,e.center.z=t.center.z,e.radius=t.radius},GetBoundingBox:function(e,t,n){let i=this._getBoundingBox();if(0===n){var o=t.getArray(),a=new r.Matrix4(o[0],o[3],o[6],o[9],o[1],o[4],o[7],o[10],o[2],o[5],o[8],o[11],0,0,0,1);i.applyMatrix4(a)}!0===i.isNaN()&&(i=new r.Box3(new r.Vector3,new r.Vector3)),e.high.x=i.max.x,e.high.y=i.max.y,e.high.z=i.max.z,e.low.x=i.min.x,e.low.y=i.min.y,e.low.z=i.min.z},GetOrientedBoundingBox:function(e,t,n){t=t||{};let i=this._getBoundingBox(t.excludeChildren);var o=t.orientation?t.orientation.getArray():[1,0,0,0,1,0,0,0,1,0,0,0],a=n.getArray(),s=new r.Matrix4(a[0],a[3],a[6],a[9],a[1],a[4],a[7],a[10],a[2],a[5],a[8],a[11],0,0,0,1),c=new r.Matrix4(o[0],o[3],o[6],o[9],o[1],o[4],o[7],o[10],o[2],o[5],o[8],o[11],0,0,0,1),u=new r.Matrix4;u=u.getInverse(c);var p=new r.Matrix4;p.multiplyMatrices(s,u),i.applyMatrix4(p),!0===i.isNaN()&&(i=new r.Box3(new r.Vector3,new r.Vector3)),e.high.x=i.max.x,e.high.y=i.max.y,e.high.z=i.max.z,e.low.x=i.min.x,e.low.y=i.min.y,e.low.z=i.min.z},_getBoundingBox:function(e=!1){const t=this._modelObject.QueryInterface("CATI3DGeoVisu");let n=t.GetPathElement();if(e){const e=t.GetLocalNodes();if(!e)return new r.Box3(new r.Vector3,new r.Vector3);(n=n.clone()).externalPath.push(e)}var i=this._modelObject._experienceBase.getManager("CAT3DXVisuManager").getViewer();return t.GetOverride().getVisibility()?n.getBoundingBox(null,i,"visibleSpace"):n.getBoundingBox(null,i,"invisibleSpace")}})}),define("DS/XCTWebExperienceAppPlay/StuProxy/StuCATI3DGeoVisu",["UWA/Core","DS/XCTWebExperienceAppPlay/StuProxy/StuProxy"],function(e,t){"use strict";return t.extend({})}),define("DS/XCTWebExperienceAppPlay/extensions/StuE3DActorPrototypeBuild",["UWA/Core","DS/XCTWebExperienceAppPlay/extensions/StuEExperienceBasePrototypeBuild","DS/XCTWebExperienceAppPlay/StuProxy/StuCATIMovable","DS/XCTWebExperienceAppPlay/StuProxy/StuIRepresentation","DS/XCTWebExperienceAppPlay/StuProxy/StuCATI3DGeoVisu","DS/XCTWebExperienceAppPlay/StuProxy/StuCATI3DXGraphicalProperties"],function(e,t,r,n,i,o){"use strict";return t.extend({build:function(e){e.CATIMovable||(e.CATIMovable=new r(this.GetObject(),e)),e.StuIRepresentation||(e.StuIRepresentation=new n(this.GetObject(),e)),e.CATI3DGeoVisu||(e.CATI3DGeoVisu=new i(this.GetObject(),e)),e.CATI3DXGraphicalProperties||(e.CATI3DXGraphicalProperties=new o(this.GetObject(),e));var t=this,a=this._parent;return this._buildActorsList(e).then(function(){return a.call(t,e)}).then(function(e){return e.push("actors"),e.push("overrides"),e})},_buildActorsList:function(t){for(var r=this.QueryInterface("CATI3DExperienceObject").GetValueByName("actors"),n=[],i=[],o=0;o<r.length;o++)n.push(this.GetObject()._experienceBase.getManager("CAT3DExperienceESExportManager")._createESObjectFrom3DExpObject(r[o],null).then(function(e){e.setParent(t),i.push(e)}));return e.Promise.allSettled(n).then(function(){t.subActors=i})},disposeESObject:function(e){e.CATIMovable.dispose(),delete e.CATIMovable,e.StuIRepresentation.dispose(),delete e.StuIRepresentation,e.CATI3DGeoVisu.dispose(),delete e.CATI3DGeoVisu,e.CATI3DXGraphicalProperties.dispose(),delete e.CATI3DXGraphicalProperties,this._parent(e)}})}),define("DS/XCTWebExperienceAppPlay/extensions/StuEProductActorPrototypeBuild",["UWA/Core","DS/XCTWebExperienceAppPlay/extensions/StuE3DActorPrototypeBuild"],function(e,t){"use strict";return t.extend({_buildActorsList:function(t){for(var r=this.QueryInterface("CATI3DX3DActorAsset").getVisuOverrideChildren(),n=this.QueryInterface("CATI3DExperienceObject").GetValueByName("actors").concat(r),i=[],o=[],a=0;a<n.length;a++)i.push(this.GetObject()._experienceBase.getManager("CAT3DExperienceESExportManager")._createESObjectFrom3DExpObject(n[a],null).then(function(e){e.setParent(t),o.push(e)}));return e.Promise.allSettled(i).then(function(){t.subActors=o})}})}),define("DS/XCTWebExperienceAppPlay/extensions/StuESubProductActorPrototypeBuild",["UWA/Core","DS/XCTWebExperienceAppPlay/extensions/StuE3DActorPrototypeBuild"],function(e,t){"use strict";return t.extend({_buildActorsList:function(t){for(var r=this.QueryInterface("CATI3DX3DActorAsset").getVisuOverrideChildren(),n=[],i=[],o=0;o<r.length;o++)n.push(this.GetObject()._experienceBase.getManager("CAT3DExperienceESExportManager")._createESObjectFrom3DExpObject(r[o],null).then(function(e){e.setParent(t),i.push(e)}));return e.Promise.allSettled(n).then(function(){t.subActors=i})}})}),define("DS/XCTWebExperienceAppPlay/StuProxy/StuCATICXPGroupCall",["UWA/Core","DS/XCTWebExperienceAppPlay/StuProxy/StuProxy"],function(e,t){"use strict";return t.extend({init:function(e,t){this._parent(e,t),this._modelCATICXPGroupCall=e.QueryInterface("CATICXPGroupCall")},dispose:function(){delete this._modelCATICXPGroupCall,this._parent()},getRelatedCapacities:function(e){var t=this._modelCATICXPGroupCall.GetRelatedCapacities(e),r=this.getModelObject()._experienceBase.getManager("CAT3DExperienceESExportManager");return t.map(function(e){return r.getProjectedESObject(e)})}})}),define("DS/XCTWebExperienceAppPlay/extensions/StuECollectionCallPrototypeBuild",["UWA/Core","DS/XCTWebExperienceAppPlay/extensions/StuEExperienceBasePrototypeBuild","DS/XCTWebExperienceAppPlay/StuProxy/StuCATICXPGroupCall"],function(e,t,r){"use strict";return t.extend({build:function(e){return e.CATICXPGroupCall||(e.CATICXPGroupCall=new r(this.GetObject(),e)),this._parent(e)},disposeESObject:function(e){e.CATICXPGroupCall.dispose(),delete e.CATICXPGroupCall,this._parent(e)}})}),define("DS/XCTWebExperienceAppPlay/CXPWebRenderManager",["DS/StuRenderEngine/StuRenderManager","DS/XCTWebExperienceAppPlay/CXPWebViewer","DS/XCTWebExperienceAppPlay/CXPWebViewpoint","DS/XCTWebExperienceAppPlay/CXPWebGeomPrimitiveISOManager","DS/XCTWebExperienceAppPlay/CXPWebEnvironmentsManager"],function(e,t,r,n,i){"use strict";var o=e.prototype.onStart;e.prototype.onStart=function(){o.call(this),this.main3DViewer&&this.main3DViewer.onStart()};var a=e.prototype.onStop;e.prototype.onStop=function(){a.call(this),this.main3DViewer&&this.main3DViewer.onStop()},e.prototype.buildViewer=function(){return new t(this._WebViewer)},e.prototype.setViewer=function(e){this._WebViewer=e,n.setViewer(e)},e.prototype.setViewpoint=function(e){this._WebViewpoint=e},e.prototype.buildViewpoint=function(){return new r(this._WebViewpoint)},e.prototype.buildGeomPrimitive_ISOManager=function(){return n},e.prototype.buildGlobeServices=function(){return null},e.prototype.buildEnvironmentsManager=function(){return new i},e.prototype.getPixelDensity=function(){return 96/25.4};var s=e.prototype.onPostExecute;return e.prototype.onPostExecute=function(){s.call(this);var e=this.getCurrentCamera();e&&this.main3DViewpoint.__setViewpointFromCamera(e)},e}),define("DS/XCTWebExperienceAppPlay/managers/CXPWebPlayManager",["UWA/Core","UWA/Class/Events","DS/StuCore/StuContext","DS/EPTaskPlayer/EPTaskPlayerDefine","DS/StuRenderEngine/StuRenderManager","DS/EPEventServices/EPEventServices","DS/CAT3DExpModel/CAT3DXModel","text!DS/XCTWebExperienceAppPlay/assets/XCTWebExperienceAppPlayPrototypeBuild.json","DS/XCTWebExperienceAppPlay/CXPWebRenderManager","DS/XCTWebExperienceAppPlay/StuEnvServices","DS/XCTWebExperienceAppPlay/StuProfilingServices","DS/XCTWebExperienceAppPlay/StuVisuServices","DS/XCTWebExperienceAppPlay/CXPWebCapacityLauncher","DS/XCTWebExperienceAppPlay/StuMaterialsManager","DS/XCTWebExperienceAppPlay/CXPConfServices","DS/XCTWebExperienceAppPlay/StuTriggerZoneManagerWeb"],function(e,t,r,n,i,o,a,s){"use strict";return e.Class.extend(t,{Build:function(){this._playState=this.ePlayState.eStop,this._prototypeBuildTables=JSON.parse(s),this._stuClass={},this._stuClassDeferred={}},Dispose:function(){delete this._prototypeBuildTables,this._stuClass={},this._stuClassDeferred={},this.stop(),this._dynamicObjectsFactory=null},ePlayState:{eStop:0,ePause:1,eStart:2,ePlaying:3,eStopping:4},getPlayState:function(){return this._playState},_setPlayState:function(e){this._playState=e,this.dispatchEvent("PlayStateChanged",e)},GetProtobuildFromComponent:function(e){return this._getPrototypeBuildClassFromComponent(e).then(function(e){return new e})},_getPrototypeBuildClassFromComponent:function(t){var r=t.GetType();if(this._stuClass[r])return e.Promise.resolve(this._stuClass[r]);if(this._stuClassDeferred[r])return this._stuClassDeferred[r].promise;var n=this._getPrototypeBuildFileFromComponent(t);if(n){this._stuClassDeferred[r]=new e.Promise.deferred;var i=this;return require([n],function(){i._stuClass[r]=arguments[0],i._stuClassDeferred[r].resolve(arguments[0]),delete i._stuClassDeferred[r]}),this._stuClassDeferred[r].promise}return e.Promise.reject("Warning : "+r+" not (longer) supported")},_getPrototypeBuildFileFromComponent:function(e){for(var t=e.GetTypes(),r=t.length-1;r>=0;r--){var n=t[r];if(this._prototypeBuildTables.hasOwnProperty(n))return this._prototypeBuildTables[n]}},play:function(){switch(this.getPlayState()){case this.ePlayState.eStop:return this._play();case this.ePlayState.ePause:return this._resume();default:return e.Promise.resolve()}},_play:function(){this._setPlayState(this.ePlayState.eStart);var t=a.GetExperience();t.QueryInterface("CATI3DXVolatileEO").setVolatile();var o=this._experienceBase.getManager("CAT3DXVisuManager").getViewer();i.getInstance().setViewer(o),i.getInstance().setViewpoint(o.currentViewpoint),r.initContext();var s=this;return this._experienceBase.getManager("CAT3DExperienceESExportManager").export(t).then(function(e){s._experienceBase.getManager("CXPWebEventListenerManager").start(),r.initExperience(e),n.start(),r.activateExperience(),s._setPlayCursor(),s._startDate=Date.now(),s._setPlayState(s.ePlayState.ePlaying)}).catch(function(t){return s._setPlayState(s.ePlayState.eStop),console.error(t),e.Promise.reject(t)})},_resume:function(){return this._experienceBase.getManager("CXPWebEventListenerManager").start(),n.resume(),this._setPlayState(this.ePlayState.ePlaying),e.Promise.resolve()},pause:function(){return this.getPlayState()===this.ePlayState.ePlaying&&(this._experienceBase.getManager("CXPWebEventListenerManager").stop(),n.pause(),this._setPlayState(this.ePlayState.ePause)),e.Promise.resolve()},stop:function(){this.getPlayState()!==this.ePlayState.ePlaying&&this.getPlayState()!==this.ePlayState.ePause||(this._setPlayState(this.ePlayState.eStopping),this._restoreAuthoringCursor(),r.deactivateExperience(),n.stop(),r.disposeExperience(),this._experienceBase.getManager("CXPWebEventListenerManager").stop(),r.disposeContext(),this._experienceBase.getManager("CAT3DExperienceESExportManager").cleanProjectedESObjectMap(),a.GetExperience().QueryInterface("CATI3DXVolatileEO").restorePersistent(),this._removeVolatilesObjects(),this._setPlayState(this.ePlayState.eStop));return e.Promise.resolve()},isPlaying:function(){return this.getPlayState()===this.ePlayState.ePlaying},_setPlayCursor:function(){var e=0;this.onClickableEnterEvent=function(){e++,document.body.style.cursor="pointer"},this.onClickableExitEvent=function(){0===--e&&(document.body.style.cursor="default")};var t=o.getEventByType("ClickableEnterEvent");o.addObjectListener(t,this,"onClickableEnterEvent");var r=o.getEventByType("ClickableExitEvent");o.addObjectListener(r,this,"onClickableExitEvent"),document.body.style.cursor="default"},_restoreAuthoringCursor:function(){var e=o.getEventByType("ClickableEnterEvent");o.removeObjectListener(e,this,"onClickableEnterEvent");var t=o.getEventByType("ClickableExitEvent");o.removeObjectListener(t,this,"onClickableExitEvent"),document.body.style.cursor="auto"},createVolatileeObjectFromTemplate:function(e,t,r,n,i){var o=a.getObjectBuilder()._createVolatileComponentFromTemplate(e,t,r,n,i);return this._experienceBase.getManager("CAT3DExperienceESExportManager").exportSubExperienceObject(o)},createVolatileObjectFromPrototype:function(e,t,r,n,i){var o=a.getObjectBuilder(),s=this;return o._createVolatileComponentFromPrototype(e,t,r,n,i).then(function(e){return s._experienceBase.getManager("CAT3DExperienceESExportManager").exportSubExperienceObject(e)})},removeVolatileObject:function(e){this._experienceBase.getManager("CAT3DExperienceESExportManager").removeProjectedESObject(e),a.getObjectBuilder()._removeVolatileComponent(e)},_removeVolatilesObjects:function(){a.getObjectBuilder()._removeVolatilesObjects()},GetType:function(){return"CXPWebPlayManager"}})});