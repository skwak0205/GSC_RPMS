define("DS/VCXWebVisualizationCmd/VCXToggleVisuPropertyCmd",["DS/ApplicationFrame/CommandCheckHeader","DS/CoreEvents/Events","DS/VCXWebKernelCommands/VCXCmdChangePropertiesAutokey"],function(e,t,r){"use strict";return e.extend({init:function(e,r){this._parent(e,r),this._VisuProperty="",e&&e.arguments&&e.arguments[0]&&e.arguments[0].VisuProperty&&(this._VisuProperty=e.arguments[0].VisuProperty),this.checkAvailability();var a=this;this.VCX_ENVIRONNEMENT_PROPERTY_CHANGED=t.subscribe({event:"VCX_ENVIRONNEMENT_PROPERTY_CHANGED"},function(){a.checkAvailability()}),this.VCX_DRESSUPS_REMOVED=t.subscribe({event:"VCX_DRESSUPS_REMOVED"},function(){a.checkAvailability()}),this.VCX_DRESSUPS_ADDED=t.subscribe({event:"VCX_DRESSUPS_ADDED"},function(){a.checkAvailability()}),this.onStateChange(a.changeState)},changeState:function(e){var t=this.getFrameWindow()._experienceBase;if(t){var a=new r(t.getManager("VCXScenarioManager"),t.getManager("VCXCommandManager"),!1);switch(this._VisuProperty){case"Shadow":var i=t.getManager("VCXContextManager").getActiveViewport();if(!i)return;if((u=i.QueryInterface("VCXIModifiable"))._lockChangeState)return;(C=u.GetProperty("Environment.Shadow").Clone()).GetPropertyValue().Value!==e&&(C.GetPropertyValue().Value=e,a.ChangeProperty(u,C),!0);break;case"Mirror":if(o=t.getManager("VCXContextManager").getActiveGround()){if((u=o.QueryInterface("VCXIModifiable"))._lockChangeState)return;(C=u.GetProperty("Environment.Ground.Mirror.Show").Clone()).GetPropertyValue().Value!==e&&(C.GetPropertyValue().Value=e,a.ChangeProperty(u,C),!0)}if(l=t.getManager("VCXContextManager").getActiveViewport().getActiveAmbienceID())if(c=t.ComponentsMap.GetComponentFromID(l)){if((u=c.QueryInterface("VCXIModifiable"))._lockChangeState)return;var n=e?75:0;(C=u.GetProperty("Ambience.Ground.Reflectivity").Clone()).GetPropertyValue().Value!==n&&(C.GetPropertyValue().Value=n,a.ChangeProperty(u,C),!0)}break;case"Grid":var o,l,c;if(o=t.getManager("VCXContextManager").getActiveGround()){if((u=o.QueryInterface("VCXIModifiable"))._lockChangeState)return;(C=u.GetProperty("Environment.Ground.Grid.Show").Clone()).GetPropertyValue().Value!==e&&(C.GetPropertyValue().Value=e,a.ChangeProperty(u,C),!0)}if(l=t.getManager("VCXContextManager").getActiveViewport().getActiveAmbienceID())if(c=t.ComponentsMap.GetComponentFromID(l)){var u,C;if((u=c.QueryInterface("VCXIModifiable"))._lockChangeState)return;(C=u.GetProperty("Environment.Ground.Disc.Grid.Show").Clone()).GetPropertyValue().Value!==e&&(C.GetPropertyValue().Value=e,a.ChangeProperty(u,C),!0)}}u&&(u._lockCheckAvailability=!0,t.getManager("VCXCommandManager").Push(a),delete u._lockCheckAvailability)}},checkAvailability:function(){var e=this.getFrameWindow()._experienceBase;if(e){var t=e.getManager("VCXContextManager").getActiveViewport();if(t)switch(this._VisuProperty){case"Shadow":var r=t.QueryInterface("VCXIModifiable");if(r._lockCheckAvailability)return;r._lockChangeState=!0,this.enable(),this.getState()!==r.GetPropertyValue("Environment.Shadow")&&this.setState(r.GetPropertyValue("Environment.Shadow")),delete r._lockChangeState;break;case"Mirror":if(i=e.getManager("VCXContextManager").getActiveGround()){if(!i.QueryInterface("VCXIVisibility").GetVisibility())return void this.disable();if((l=i.QueryInterface("VCXIModifiable"))._lockCheckAvailability)return;return l._lockChangeState=!0,this.enable(),this.getState()!==l.GetPropertyValue("Environment.Ground.Mirror.Show")&&this.setState(l.GetPropertyValue("Environment.Ground.Mirror.Show")),void delete l._lockChangeState}if(n=e.getManager("VCXContextManager").getActiveViewport().getActiveAmbienceID())if(o=e.ComponentsMap.GetComponentFromID(n)){if((c=o.QueryInterface("VCXIModifiable"))._lockCheckAvailability)return;c._lockChangeState=!0,this.enable();var a=c.GetPropertyValue("Ambience.Ground.Reflectivity")>0;return this.getState()!==a&&this.setState(a),void delete c._lockChangeState}this.disable();break;case"Grid":var i,n,o;if(i=e.getManager("VCXContextManager").getActiveGround()){if(!i.QueryInterface("VCXIVisibility").GetVisibility())return void this.disable();var l;if((l=i.QueryInterface("VCXIModifiable"))._lockCheckAvailability)return;return l._lockChangeState=!0,this.enable(),this.getState()!==l.GetPropertyValue("Environment.Ground.Grid.Show")&&this.setState(l.GetPropertyValue("Environment.Ground.Grid.Show")),void delete l._lockChangeState}if(n=e.getManager("VCXContextManager").getActiveViewport().getActiveAmbienceID())if(o=e.ComponentsMap.GetComponentFromID(n)){var c;if((c=o.QueryInterface("VCXIModifiable"))._lockCheckAvailability)return;return c._lockChangeState=!0,this.enable(),this.getState()!==c.GetPropertyValue("Environment.Ground.Disc.Grid.Show")&&this.setState(c.GetPropertyValue("Environment.Ground.Disc.Grid.Show")),void delete c._lockChangeState}this.disable()}else this.disable()}else this.disable()}})});