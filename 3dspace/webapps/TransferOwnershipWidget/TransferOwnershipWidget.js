define("DS/TransferOwnershipWidget/TOSModel/TOSPublicTransfer",["UWA/Controls/Abstract"],function(e){"use strict";return e.extend({init:function(e){for(var t in this.contextId="",this.physicalId="",this.type="",this.title="",this.context="",this.targetSpace="",this.category="",this.isTOSPublicTransfer=!0,e)this[t]=e[t]},getPhysicalId:function(){return this.physicalId},getType:function(){return this.type},getTitle:function(){return this.title},getContext:function(){return this.context},getTargetSpace:function(){return this.targetSpace},getCategory:function(){return this.category},setPhysicalId:function(e){this.physicalId=e},setType:function(e){this.type=e},setTitle:function(e){this.title=e},setContext:function(e){this.context=e},setTargetSpace:function(e){this.targetSpace=e},setCategory:function(e){this.category=e}})}),define("DS/TransferOwnershipWidget/TransferOwnershipConstant",[],function(){"use strict";return{TransferCollabSpace:"CollabSpace",TransferCollabSpaceSoft:"CollabSpaceSoft",TransferFull:"full",TransferPerson:"Person",CSEOrgAndProjectURLService:"/resources/pno/ownership/ctxorgcollabspace/user",CSEUserURLService:"/resources/pno/ownership/owner"}}),define("DS/TransferOwnershipWidget/TOSModel/TOSSelectedItem",["UWA/Controls/Abstract"],function(e){"use strict";return e.extend({init:function(e){for(var t in this.physicalId="",this.urlIcon="",this.name="",this.type="",this.category="",this.isTOSSelectedItem=!0,e)this[t]=e[t]},getPhysicalId:function(){return this.physicalId},getUrlIcon:function(){return this.owner},getName:function(){return this.name},getType:function(){return this.type},getCategory:function(){return this.category}})}),define("DS/TransferOwnershipWidget/TOSModel/TOSSummaryModel",["UWA/Controls/Abstract"],function(e){"use strict";return e.extend({init:function(e){this.PREFIX_TYPE_BUS="Class",this.PREFIX_TYPE_REL="RelationClass";for(var t in this.isTOSSummaryModel=!0,e)this[t]=e[t]},getPhysicalId:function(){return this.physicalId},getTitle:function(){return this.title},getType:function(){return this.type},getProject:function(){return this.project},getOrganization:function(){return this.organization},getOwner:function(){return this.owner},getPrefixType:function(){return this.prefixType},getOldOwner:function(){return this.old_owner},getError:function(){return this.error},getOldContext:function(){return this.oldContext},getCurrentContext:function(){return this.currentContext}})}),define("DS/TransferOwnershipWidget/component/TransferOwnershipWidget",["UWA/Core","UWA/Controls/Input","UWA/Controls/Abstract","UWA/Json","DS/DataDragAndDrop/DataDragAndDrop","DS/PlatformAPI/PlatformAPI","DS/WAFData/WAFData","DS/TransferOwnershipWidget/TransferOwnershipConstant","DS/SearchWidget/SearchWidget","DS/SearchWidget/SearchWidgetConstant","DS/ErrorWidget/ErrorWidget","DS/DataGridWidget/DataGridWidget","DS/WidgetServices/WidgetServices","DS/WidgetServices/securityContextServices/SecurityContextServices","DS/WarningWidget/WarningWidget","DS/MVAInput/searchPeopleInput/MVASearchPeopleInput","DS/TransferOwnershipWidget/TOSModel/TOSSelectedItem","DS/UIKIT/Input/Button","DS/UIKIT/Input/Select","DS/UIKIT/Spinner","DS/UIKIT/Input/ButtonGroup","DS/UIKIT/Modal","DS/UIKIT/Input/Toggle","DS/UIKIT/Input/Text","DS/UIKIT/Scroller","DS/ENOFloatingPanel/ENOFloatingPanel","DS/Controls/Toggle","UWA/Widget","text!DS/TransferOwnershipWidget/assets/TOSettings.json","css!DS/TransferOwnershipWidget/TransferOwnershipWidget.css","i18n!DS/TransferOwnershipWidget/assets/nls/TOSNls","DS/ReportingPanel/ReportingPanel"],function(e,t,i,r,s,n,a,o,c,h,l,d,u,g,p,O,f,S,T,y,W,m,v,C,I,w,b,P,D,_,E,A){"use strict";var j=u.getProdLevel();UWA.i18n("TOS_SelectedItems");return i.extend({itemListHasPriority:!1,defaultOptions:{className:"",context:null,ForbiddenChar:'"#$@%*,?\\<>[]|:',showTopBar:!0,setCloseButton:!1,topClassHeight:"TOS_MasterContain",transferType:o.TransferFull,launchTransfer:!0,genericTransfer:!1,serverName:"",serverUri:"",activeExpandWholeStructure:!1,activeDnD:!1,activeOptions:!1,activeAdminCheckBox:!1,activeSummaryButton:!1,activeHistoryButton:!1,activeFirstLineTable:!1,displaySoftDialog:!0,model:!0,wintop:!1,odtMode:!1},init:function(e,t,i){this.defaultOptions.activeAdminCheckBox=widget.getBool("admin"),j=u.getProdLevel(),this.widget=e,this.parentWidget=t,this.SelectedItems=[],this.listID=[],this.currentTransfer=null,this.listOfIds=[],this.listOfCSFlag=[],this.listOfOrgFlag=[],this.listOfRespFlag=[],this.listOfError=[],this.listOfFailedIds=[],this.listOfIdsWithResult=[],this.listOfIdsWithData=JSON.parse("[]"),this.isHiddenResponsibleSearch=!0,this.isHiddenCollaborativeSpaceSearch=!0,this.isHiddenOrganizationSearch=!0,this.objectIds={},this.ctxObjectIds=[],this._parent(i),this.setSecurityContext(i.securityContext),this.caHeader={},this.SelectedInstance=[],this.isCSE=!1,this.searchSection=null,this.searchSectionOrg=null,this.searchSectionProject=null,this.searchOwnerTitle=null,this.searchSectionProject=null,this.searchProjectTitle=null,this.searchSectionOrganization=null,this.searchOrgTitle=null,this.searchWidgetOrg=null,this.searchWidgetProject=null,this.searchWidget=null,this.currentSearchedUser="",this.currentLoginUser="",this.hideProject=!1,this.hideOrg=!1,this.changeOwnerToggle=null,this.addMsgToggle=null,this.commentBox=null,this.textArea=null,this.listOfInvalidIds=null;E.get("TOS_Panel_Status");var r=E.get("TOS_Panel_Title"),s=E.get("TOS_Panel_Type"),n=E.get("TOS_Panel_Revision"),a=E.get("TOS_Panel_Organization"),c=E.get("TOS_Panel_CollabSpace"),h=E.get("TOS_Panel_Responsible"),l=E.get("TOS_Panel_CompletionStatus");this.cols=[{text:"ID",dataIndex:"ID",isHidden:!0},{text:"StatusToolTipColumn",dataIndex:"statusTooltip",isHidden:!0,tooltipColumn:"Status"},{text:E.TOS_STATUS,dataIndex:"Status",typeRepresentation:"icon"},{text:r,dataIndex:r},{text:s,dataIndex:s},{text:n,dataIndex:n},{text:a,dataIndex:a},{text:c,dataIndex:c},{text:h,dataIndex:h},{text:l,dataIndex:l}],this.ListOfEC=JSON.parse("[]"),this.ListOfAggrObj=JSON.parse("[]"),this.selectedItemsCS={},this.selectedItemsORG={},this.targetOrgTitle=null,this.targetCollabSpaceTitle=null,this.options.transferType!=o.TransferCollabSpaceSoft&&this._initUI()},setSecurityContext:function(e){this.securityContext=e},onRefresh:function(){},_IsDisableApply:function(){if(null!=this.searchWidgetProject&&null!=this.searchWidgetOrg){if(null==this.searchWidget.getNewOwner().person&&null==this.searchWidgetProject.getNewOwner().collabSpace&&null==this.searchWidgetOrg.getNewOwner().organization)return!0;var e=!0,t=!0,i=!0;return i=!!(this.searchWidget.getNewOwner()&&this.searchWidget.getNewOwner().hasOwnProperty("person")&&this.searchWidget.getNewOwner().person&&""!=this.searchWidget.container.searchInput.elements.content.value),t=!!(this.searchWidgetProject.getNewOwner()&&this.searchWidgetProject.getNewOwner().hasOwnProperty("collabSpace")&&this.searchWidgetProject.getNewOwner().collabSpace&&""!=this.searchWidgetProject.container.searchInput.elements.content.value),e=!!(this.searchWidgetOrg.getNewOwner()&&this.searchWidgetOrg.getNewOwner().hasOwnProperty("organization")&&this.searchWidgetOrg.getNewOwner().organization&&""!=this.searchWidgetOrg.container.searchInput.elements.content.value),!(i||t||e)}return""===this.searchWidget.container.searchInput.elements.content.value||!(this.searchWidget.getNewOwner()&&this.searchWidget.getNewOwner().hasOwnProperty("person")&&this.searchWidget.getNewOwner().person)},_initUI:function(){var e=this,t=this.container=UWA.createElement("div",{name:"TOS_MasterContain",class:"TOS_MasterContain "+e.options.className,id:"TOS_MasterContain"});this.globalDiv=UWA.createElement("div",{class:"TOS_GlobalContain",id:"TOS_GlobalContain"}).inject(t);var i="TOS_ManageButtonDiv";1==e.options.wintop&&(i="TOS_ManageButtonDiv_WebInWin"),this.ManageButtonDiv=UWA.createElement("table",{class:i,html:{}});var r="TOS_ManageButtonRight";1==e.options.wintop&&(r="TOS_ManageButtonRight_WebInWin"),e.ManageButtonRight=UWA.createElement("td",{class:r});var s="TOS_ManageButtonLeft";1==e.options.wintop&&(s="TOS_ManageButtonLeft_WebInWin"),e.ManageButtonLeft=UWA.createElement("td",{class:s});var a=null;a=this.options.transferType==o.TransferPerson?E.get("TOS_ChangeOwner"):E.get("TOS_moveTitle");var d=null;e.boutonValid=new S({attributes:{title:UWA.i18n("")},name:"TopButtonValid",value:UWA.i18n(a),className:"default medium TOS_buttonTop primary",disabled:!0}),d=new S({attributes:{title:UWA.i18n("")},name:"TopButtonCancel",value:UWA.i18n("TOS_Cancel"),className:"default medium TOS_buttonTop"}),e.boutonValid.addEvents({onClick:function(){g.getInstance().getSecurityContext({onSuccess:function(t){d.setValue(UWA.i18n("Close")),e._prepareTransferOwnership(t)},onFailure:function(t){e.setError(t)}}),this.setDisabled(!0)}}),d.addEvents({onClick:function(){n.publish("TOS_SummaryResult",{listId:[]}),e.dispatchEvent("onCancel")}}),e.boutonValid.inject(e.ManageButtonRight),0!=this.options.setCloseButton&&d.inject(e.ManageButtonRight),e.ManageButtonLeft.inject(this.ManageButtonDiv),e.ManageButtonRight.inject(this.ManageButtonDiv),!0===e.options.showTopBar&&0==e.options.wintop&&this.ManageButtonDiv.inject(e.globalDiv),this.mainDiv=UWA.createElement("div",{class:"TOS_MainContain"}).inject(e.globalDiv),e.mainInterface=UWA.createElement("div",{class:"TOS_MainInterface"}).inject(this.mainDiv).hide(),e.mainLoading=UWA.createElement("div",{class:"TOS_MainLoading"}).inject(this.mainDiv),e.mainError=UWA.createElement("div",{class:"TOS_MainError"}).inject(this.mainDiv).hide(),e.loadingArea32=new y({visible:!0,className:"large"}),e.loadingArea32.inject(e.mainLoading),2==j&&!0!==this.options.activeExpandWholeStructure||(this.expandWholeStruct=new v({type:"checkbox",value:UWA.i18n("TOS_Expand"),className:"primary TOS_ExpandAllCB"}),this.expandWholeStruct.inject(UWA.createElement("td").inject(e.mainInterface))),e.itemsArea=new UWA.createElement("span",{class:"TOS_itemsList"}),e.itemsArea.inject(e.mainInterface),this.itemListHasPriority=!0,e.table=null,e.errorOverlay=new l(widget,e.container,{className:"errorComponent_TransferOwnership"});var u=UWA.i18n("TOS_ownerTitle");e.titleTargetOwnership=UWA.createElement("h5",{class:"TOS_SelectedItemTitle",html:u}),e.titleTargetOwnership.hide(),e.searchWidgetContainer=UWA.createElement("div",{class:"TOS_searchWidgetContainer"}).inject(this.mainInterface);var p=e.options.ForbiddenChar;h.TYPE_PERSON;1==this.options.activeFirstLineTable&&h.TYPE_FULL;var O={user:"",org:"",collabSpace:""};c.FULL;switch(1==e.isCSE&&c.RESTRICTED,this.options.transferType){case o.TransferPerson:e.hideOrg=!0,e.hideProject=!0,h.TYPE_PERSON;break;case o.TransferCollabSpaceSoft:case o.TransferCollabSpace:h.TYPE_PROJECT;break;case o.TransferFull:h.TYPE_FULL}if(0==e.hideProject&&0==e.hideOrg){e.searchWidgetProject=c.getSearchWidget(c.FULL,{className:"searchProject_TransferOwnership",ForbiddenChar:p,MaxNumber:"5",MaxSize:"300",position:"auto",serverName:this.options.serverName,serverUri:this.options.serverUri,showEmptyCategory:!1,hint:UWA.i18n("Search Collaborative Space"),methodType:"PUT",urlService:"/resources/v1/collabServices/base/transferOwnership/canUserChangePOV_ChecksWithUserQuery/"+h.TYPE_PROJECT,type:h.TYPE_PROJECT,CSE:e.isCSE,IsMoveSearch:!0,currentUser:e.currentSearchedUser,webParams:{getQueryParams:function(){return O}},events:{onValid:function(){var t=e.searchWidgetProject.getNewOwner();if(1==e.isCSE&&e.searchWidgetOrg){var i=e.searchWidgetOrg.container.currentChoice,r=t.collabSpace.collabSpaceID;if(i){var s=e.searchWidgetProject.CSEListOfOrg[r];Array.isArray(s)&&-1!=s.indexOf(i)||(e.searchWidgetOrg.listOwner=[],e.searchWidgetOrg.CSEListOfCs={},e.searchWidgetOrg.container.searchInput.value="",e.searchWidgetOrg.setValue(""),e.searchWidgetOrg.container.currentChoice="",e.searchWidgetOrg.container.currentOwner=null)}}g.getInstance().getSecurityContext({onSuccess:function(t){var i=e._getTransferDataForSearch();e.transferPreCheck(t,i)},onFailure:function(t){e.setError(t)}}),e._ManageValidButton(!0)},onUnvalid:function(){if(null!=e.searchWidgetProject){var t=e.searchWidgetProject.container.searchInput.elements.content.value;O.collabSpace=t,null===e.searchWidgetOrg.container.currentChoice?O.org="":O.org=e.searchWidgetOrg.container.currentChoice,e.searchWidget.container.currentChoice?O.user=e.searchWidget.container.currentChoice:O.user="",e._IsDisableApply()?e._ManageValidButton(!1):e._ManageValidButton(!0)}},onError:function(t){e.setError(t)}}});var f=UWA.createElement("div",{class:"TOS_SearchSectionProject"});e.searchSectionProject=f;var T=UWA.i18n(E.get("ChangeCollab_mainTile"));e.searchCollabTitle=UWA.createElement("h5",{class:"TOS_SelectedItemTitle",html:T}).inject(e.searchWidgetContainer),e.searchWidgetProject.inject(f),f.inject(e.searchWidgetContainer),e.marginAfterSearchProj=UWA.createElement("div",{class:"TOS_marginCorrector"}).inject(this.searchWidgetContainer);var W=UWA.i18n(E.get("ChangeOrg_mainTitle"));e.searchOrgTitle=UWA.createElement("h5",{class:"TOS_SelectedItemTitle",html:W}).inject(e.searchWidgetContainer),e.searchWidgetOrg=c.getSearchWidget(c.FULL,{className:"searchOrg_TransferOwnership",ForbiddenChar:p,MaxNumber:"5",MaxSize:"300",position:"auto",serverName:this.options.serverName,serverUri:this.options.serverUri,showEmptyCategory:!1,hint:UWA.i18n("Search Organization"),methodType:"PUT",urlService:"/resources/v1/collabServices/base/transferOwnership/canUserChangePOV_ChecksWithUserQuery/"+h.TYPE_ORGANIZATION,type:h.TYPE_ORGANIZATION,CSE:e.isCSE,IsMoveSearch:!0,currentUser:e.currentSearchedUser,webParams:{getQueryParams:function(){return O}},events:{onValid:function(){if(null!=e.searchWidgetOrg){var t=e.searchWidgetOrg.getNewOwner();if(1==e.isCSE){var i=e.searchWidgetProject.container.currentChoice,r=t.organization.orgID;if(i&&r){var s=e.searchWidgetOrg.CSEListOfCs[r];(!Array.isArray(s)||-1==s.indexOf(i)&&e.searchWidgetProject)&&(e.searchWidgetProject.CSEListOfOrg={},e.searchWidgetProject.listOwner=[],e.searchWidgetProject.container.searchInput.value="",e.searchWidgetProject.setValue(""),e.searchWidgetProject.container.currentChoice="",e.searchWidgetProject.container.currentOwner=null)}}g.getInstance().getSecurityContext({onSuccess:function(t){var i=e._getTransferDataForSearch();e.transferPreCheck(t,i)},onFailure:function(t){e.setError(t)}}),e._ManageValidButton(!0)}},onUnvalid:function(){if(null!=e.searchWidgetOrg){var t=e.searchWidgetOrg.container.searchInput.elements.content.value;O.org=t,e.searchWidget.container.currentChoice?O.user=e.searchWidget.container.currentChoice:O.user="",null===e.searchWidgetProject.container.currentChoice?O.collabSpace="":O.collabSpace=e.searchWidgetProject.container.currentChoice}e._IsDisableApply()?e._ManageValidButton(!1):e._ManageValidButton(!0)},onError:function(t){e.setError(t)}}});var m=UWA.createElement("div",{class:"TOS_SearchSectionOrg"});W=UWA.i18n(E.get("ChangeOrg_mainTitle"));e.searchSectionOrganization=m,e.searchWidgetOrg.inject(m),m.inject(e.searchWidgetContainer)}var w=UWA.createElement("div",{class:"TOS_SearchSectionOwner"});e.searchSection=w;var P=E.get("TOS_ownerTitle"),D=c.FULL;switch(e.options.transferType!=o.TransferPerson?(e.changeOwnerToggle=new b({type:"checkbox",label:P,checkFlag:!1,"font-weight":"bold"}),e.changeOwnerToggle.addEventListener("buttonclick",function(t){1==t.dsModel.checkFlag?e.searchWidget.show():(e.searchWidget.hide(),!0===e.isCSE&&e.searchWidget&&e.searchWidget.container.searchInput.elements.content.value&&(e.searchWidget.container.searchInput.elements.content.value="",e.searchWidget.container.currentChoice=null,e.searchWidget.clearInput(),e.searchWidgetProject&&e.searchWidgetOrg&&(e.searchWidgetProject.getNewOwner().collabSpace&&(e.searchWidgetProject.container.currentChoice=null,e.searchWidgetProject.container.searchInput.elements.content.value="",e.searchWidgetProject.clearInput()),e.searchWidgetOrg.getNewOwner().organization&&(e.searchWidgetOrg.container.currentChoice=null,e.searchWidgetOrg.container.searchInput.elements.content.value="",e.searchWidgetOrg.clearInput())),e._ManageValidButton(!1)),e.searchWidget&&e.searchWidget.container.searchInput.elements.content.value&&(e.searchWidget.container.searchInput.elements.content.value="",e.searchWidget.container.currentChoice=null,e.searchWidget.clearInput(),e._IsDisableApply()&&e._ManageValidButton(!1)))}),e.changeOwnerToggle.inject(e.searchSection)):(D=c.RESTRICTED,e.titleTargetOwnership.inject(e.searchSection),e.titleTargetOwnership.show()),e.searchWidget=c.getSearchWidget(D,{className:"searchPeople_TransferOwnership",ForbiddenChar:p,MaxNumber:"5",MaxSize:"300",position:"auto",serverName:this.options.serverName,serverUri:this.options.serverUri,showEmptyCategory:!1,hint:UWA.i18n("Search Responsible"),methodType:"PUT",urlService:"/resources/v1/collabServices/base/transferOwnership/canUserChangePOV_ChecksWithUserQuery/"+h.TYPE_PERSON,type:h.TYPE_PERSON,webParams:{getQueryParams:function(){return O}},CSE:e.isCSE,IsMoveSearch:!0,currentUser:e.currentSearchedUser,events:{onValid:function(){var t;e.searchWidget.getNewOwner();t=this.currentChoice,g.getInstance().getSecurityContext({onSuccess:function(i){if(1==e.isCSE){e.currentSearchedUser=null==t||""==t?e.currentLoginUser:t;var r={};r.currentUser=e.currentSearchedUser,e.searchWidgetProject&&(e.searchWidgetProject.addOptions(r),e.searchWidgetProject.CSEListOfOrg={},e.searchWidgetProject.listOwner=[],e.searchWidgetProject.container.searchInput.value="",e.searchWidgetProject.setValue(""),e.searchWidgetProject.container.currentChoice="",e.searchWidgetProject.container.currentOwner=null),e.searchWidgetOrg&&(e.searchWidgetOrg.addOptions(r),e.searchWidgetOrg.listOwner=[],e.searchWidgetOrg.CSEListOfCs={},e.searchWidgetOrg.container.searchInput.value="",e.searchWidgetOrg.setValue(""),e.searchWidgetOrg.container.currentChoice="",e.searchWidgetOrg.container.currentOwner=null)}var s=e._getTransferDataForSearch();e.transferPreCheck(i,s)},onFailure:function(t){e.setError(t)}}),e._ManageValidButton(!0),1==e.isCSE&&e.searchWidgetProject&&e.searchWidgetOrg&&(e.searchWidgetProject.clearInput(),e.searchWidgetOrg.clearInput())},onUnvalid:function(){if(null!=e.searchWidgetOrg){var t=e.searchWidget.container.searchInput.elements.content.value;O.user=t,null===e.searchWidgetOrg.container.currentChoice?O.org="":O.org=e.searchWidgetOrg.container.currentChoice,null===e.searchWidgetProject.container.currentChoice?O.collabSpace="":O.collabSpace=e.searchWidgetProject.container.currentChoice,e._IsDisableApply()?e._ManageValidButton(!1):e._ManageValidButton(!0)}else{t=e.searchWidget.container.getCurrentValue(),Object.keys(e.selectedItemsCS),Object.keys(e.selectedItemsORG);O.user=t,e._IsDisableApply()?e._ManageValidButton(!1):e._ManageValidButton(!0)}},onError:function(t){e.setError(t)}}}),e.searchWidget.inject(w),w.inject(e.searchWidgetContainer),e.marginAfterSearchUser=UWA.createElement("div",{class:"TOS_ownerMarginCorrector"}).inject(this.searchWidgetContainer),null!==e.changeOwnerToggle&&(e.searchSection.hide(),e.searchWidget.hide()),this.options.transferType){case o.TransferPerson:e.hideProject=!0,e.hideOrg=!0}e.marginAfterOwnerCheckBox=UWA.createElement("div",{class:"TOS_ownerMarginCorrector"}).inject(this.searchWidgetContainer);var _=UWA.i18n(E.get("TOS_TitleComment"));if(e.options.transferType!=o.TransferPerson?(e.addMsgToggle=new b({type:"checkbox",label:_,checkFlag:!1,class:"TOS_SelectedItemTitle"}),e.addMsgToggle.addEventListener("buttonclick",function(t){1==t.dsModel.checkFlag?e.commentBox.show():e.commentBox.hide()}),e.addMsgToggle.inject(e.searchWidgetContainer)):e.commentTitle=UWA.createElement("h5",{class:"TOS_SelectedItemTitle",html:_}).inject(e.searchWidgetContainer),e.commentBox=UWA.createElement("div",{class:"TOS_CommentBox"}).inject(this.searchWidgetContainer),e.textArea=new C({className:"TOS_commentText",multiline:!0,placeholder:UWA.i18n(E.get("TOS_Comment")),rows:2,ForbiddenChar:p}),e.textArea.inject(e.commentBox),e.options.transferType!=o.TransferPerson&&e.commentBox.hide(),e.marginAfterAddMsg=UWA.createElement("div",{class:"TOS_marginCorrector"}).inject(this.searchWidgetContainer),this.options.transferType==o.TransferFull)UWA.createElement("Div",{class:"TOS_AdvAdminOption"}).inject(e.mainInterface);1==e.options.wintop&&e.ManageButtonDiv.inject(e.mainInterface);new I({element:e.mainInterface}).inject(e.globalDiv)},transferPreCheck:function(e,t){this.dispatchEvent("onTransferStart");var i=this,s="",n=(this.options.serverName,this.options.serverUri,this.options.launchTransfer);this.caHeader;u.get3DSpaceUrlAsync({onComplete:function(e){var a={Accept:"application/json","content-type":"application/json"};a.SecurityContext=encodeURIComponent(i.securityContext),i.caHeader&&(i.caHeader["DS-Change-Authoring-Context"]&&(a["DS-Change-Authoring-Context"]=i.caHeader["DS-Change-Authoring-Context"]),i.caHeader["DS-Configuration-Authoring-Context"]&&(a["DS-Configuration-Authoring-Context"]=i.caHeader["DS-Configuration-Authoring-Context"]));var o=i.parseDataForPreCheck(t);s=u.getRealPath("assets/transferOwnership.json",widget);var c="",h="GET",l="";2==j&&(s=e+"/resources/v1/collabServices/base/transferOwnership/transferOwnershipPreCheck?admin=true",l="passport",h="PUT",c=r.encode({requests:o}));var d={requests:o};if(i.dispatchEvent("onValidation",d),!0===n){i.displayLoadingArea(),a["Accept-Language"]=widget.lang;var g=u.getTenantID();g&&(s+="&tenant="+g),u.partitionedAuthenticatedRequest(s,{type:"json",method:h,proxy:l,headers:a,maxChunkSize:19,cancelCallback:function(){return!1},partisionedProgressLabel:E.get("TOS_Prechecking"),progressBarContext:i.ManageButtonLeft,progressBarWaitContext:i.container,chunkify:function(e,t,i){var r=[];0==e&&(e=3),r.push(i[0]),r.push(i[1]),r.push(i[2]);for(var s=e;s<e+t&&s<i.length;s++)r.push(i[s]);return r},data:c,timeout:36e5,onComplete:function(e){i._preCheckResult(e)},onFailure:function(e,t,r){i._onFailure(e,t,r)},onTimeout:function(e){i._onTimeout()}})}}})},_preCheckResult:function(e){var t=[],i=[];if(e.results.length>0)for(var r=0;r<e.results.length;r++)if(null!=e.results[r].TransferFlag&&t.push(e.results[r].TransferFlag),null!=e.results[r].ErrorList&&"success"!==e.results[r].ErrorList){var s={Error:e.results[r].ErrorList,physicalId:e.results[r].physicalId};i.push(s)}this.hideLoadingArea()},parseDataForPreCheck:function(e){var t=[];return null!=e&&e.hasOwnProperty("owner")&&null!=e.owner&&e.owner.hasOwnProperty("person")&&""!=e.owner.person?t.push(e.owner.person.personID):t.push(""),null!=e&&e.hasOwnProperty("owner")&&null!=e.owner&&e.owner.hasOwnProperty("collabSpace")&&""!=e.owner.collabSpace?t.push(e.owner.collabSpace.collabSpaceID):t.push(""),null!=e&&e.hasOwnProperty("owner")&&null!=e.owner&&e.owner.hasOwnProperty("organization")&&""!=e.owner.organization?t.push(e.owner.organization.orgID):t.push(""),e.tosBusinessObject.forEach(function(e){t.push(e.id)}),e.hasOwnProperty("tosRelationObject")&&e.tosRelationObject.forEach(function(e){t.push(e.id)}),t},destroy:function(){this.searchWidget&&this.searchWidget.destroy(),this.searchWidgetProject&&this.searchWidgetProject.destroy(),this.searchWidgetOrg&&this.searchWidgetOrg.destroy(),this._parent()},actionOnMove:function(){this.searchWidget&&this.searchWidget.actionOnMove(),this.searchWidgetProject&&this.searchWidgetProject.actionOnMove(),this.searchWidgetOrg&&this.searchWidgetOrg.actionOnMove()},getcanUserChangePOV:function(e){var t=this;this.options.serverName,this.options.serverUri;u.get3DSpaceUrlAsync({onComplete:function(i){var s={"content-type":"application/json",Accept:"application/json"},n=u.getRealPath("assets/summary.json",widget),a="GET",o="",c=t.parseDataForCanUserChangePOV(e);if(2==j){n=i+"/resources/v1/collabServices/base/transferOwnership/canUserChangePOV",o="passport",a="PUT";var h=r.encode({requests:c})}t.displayLoadingArea();var l=u.getTenantID();l&&(n+="?tenant="+l),s["Accept-Language"]=widget.lang,s.SecurityContext=encodeURIComponent(t.securityContext),u.partitionedAuthenticatedRequest(n,{type:"json",method:a,proxy:o,headers:s,maxChunkSize:19,cancelCallback:function(){return!1},partisionedProgressLabel:E.get("TOS_CanChangeOwnership"),progressBarContext:t.ManageButtonLeft,progressBarWaitContext:t.container,symultaneousRequest:!0,data:h,timeout:36e5,onComplete:function(e){t._listcanUserChangePOV(e)},onFailure:function(e,i,r){t._onFailure(e,i,r)},onTimeout:function(e){t._onTimeout()}})}})},parseDataForCanUserChangePOV:function(e){for(var t=[],i=0;i<e.length;i++)t.push(e[i].physicalId);return t},_listcanUserChangePOV:function(e){var t=[],i=[],r=[],s=this,a=!0,c=!0,h=!0,l=0,d=0,u=0,p=0,O=0,f=0,T={};if(e.results.length>0){for(var y=0;y<e.results.length;y++){if(this.options.transferType!=o.TypePerson&&null!=e.results[y].CSTransferFlag){var W={physicalId:e.results[y].physicalId,CSTransferFlag:e.results[y].CSTransferFlag};this.listOfCSFlag.push(W),"OK"==e.results[y].CSTransferFlag&&0;var m={objectID:e.results[y].physicalId};r.push(m),"OK"==e.results[y].CSTransferFlag&&0==l?(0==this.hideProject&&null!=this.searchWidgetProject&&this.searchWidgetProject.show(),this.titleTargetOwnership.show(),a=!1,this.isHiddenCollaborativeSpaceSearch=!1,l=1):u++}if(this.options.transferType!=o.TypePerson&&null!=e.results[y].OrgTransferFlag){W={physicalId:e.results[y].physicalId,OrgTransferFlag:e.results[y].OrgTransferFlag};this.listOfOrgFlag.push(W);m={objectID:e.results[y].physicalId};i.push(m),"OK"==e.results[y].OrgTransferFlag&&0,"OK"==e.results[y].OrgTransferFlag&&0==d?(0==this.hideOrg&&null!=this.searchWidgetOrg&&this.searchWidgetOrg.show(),this.titleTargetOwnership.show(),c=!1,this.isHiddenOrganizationSearch=!1,d=1):p++}if(null!=e.results[y].RespTransferFlag){W={physicalId:e.results[y].physicalId,RespTransferFlag:e.results[y].RespTransferFlag};this.listOfRespFlag.push(W);m={objectID:e.results[y].physicalId};t.push(m),"OK"==e.results[y].RespTransferFlag&&f++,"OK"==e.results[y].RespTransferFlag?(null!==this.changeOwnerToggle&&1==this.changeOwnerToggle.checkFlag?(this.searchWidget.show(),this.titleTargetOwnership.show()):null!==this.changeOwnerToggle&&0==this.changeOwnerToggle.checkFlag&&(this.titleTargetOwnership.hide(),this.searchWidget.hide()),h=!1,this.isHiddenResponsibleSearch=!1,1):"KO"==e.results[y].RespTransferFlag&&(this.titleTargetOwnership.hide(),h=!0,this.isHiddenResponsibleSearch=!0,O++)}if(null!=e.results[y].ErrorList){if("success"!=e.results[y].ErrorList){W={physicalId:e.results[y].physicalId,Error:e.results[y].ErrorList};this.listOfError.push(W)}T[e.results[y].physicalId]=e.results[y].ErrorList}e.results[y].hasOwnProperty("CSE")&&(this.isCSE=e.results[y].CSE),e.results[y].hasOwnProperty("LifecycleCheckCommand")&&(this.LifecycleCheckCommand=e.results[y].LifecycleCheckCommand)}if(this.searchWidget&&this.searchWidget.setSelectedItemList(t),0==s.hideProject&&0==s.hideOrg&&null!=this.searchWidgetOrg&&null!=this.searchWidgetProject&&(this.searchWidgetProject.setSelectedItemList(r),this.searchWidgetOrg.setSelectedItemList(i)),h&&c&&a&&this.textArea.disable(),0==h&&0==c&&1==a&&0==s.hideProject&&0==s.hideOrg&&(this.searchWidgetProject.hiddenCS="true",this.searchWidgetOrg.hiddenOrg="false",this.searchWidget.hiddenUser="false"),0==a&&0==c&&1==h&&0==s.hideProject&&0==s.hideOrg&&(this.searchWidget.hiddenUser="true",this.searchWidgetOrg.hiddenOrg="false",this.searchWidgetProject.hiddenCS="false"),0==h&&0==a&&1==c&&0==s.hideProject&&0==s.hideOrg&&(this.searchWidgetOrg.hiddenOrg="true",this.searchWidgetProject.hiddenCS="false",this.searchWidget.hiddenUser="false"),0==h&&c&&a&&0==s.hideProject&&0==s.hideOrg&&(this.searchWidgetProject.hiddenCS="true",this.searchWidgetOrg.hiddenOrg="true",this.searchWidget.hiddenUser="false"),0==c&&h&&a&&0==s.hideProject&&0==s.hideOrg&&(this.searchWidgetProject.hiddenCS="true",this.searchWidget.hiddenUser="true",this.searchWidgetOrg.hiddenOrg="false"),0==a&&c&&h&&0==s.hideProject&&0==s.hideOrg&&(this.searchWidget.hiddenUser="true",this.searchWidgetOrg.hiddenOrg="true",this.searchWidgetProject.hiddenCS="false"),1==this.isCSE){this.currentLoginUser=n.getUser().login+"_PRJ",this.currentSearchedUser=this.currentLoginUser;var v={},C={CSE:!0,autocomplete:"off",methodType:"GET",urlService:o.CSEOrgAndProjectURLService,currentUser:this.currentSearchedUser,webParams:{method:"GET",getQueryParams:function(){return v}}};if(this.searchWidgetProject&&(this.searchWidgetProject.addOptions(C),this.searchWidgetProject.show(),this.searchWidgetProject.options.CSE=this.isCSE),this.searchWidgetOrg&&(this.searchWidgetOrg.addOptions(C),this.searchWidgetOrg.show(),this.searchWidgetOrg.options.CSE=this.isCSE),this.searchWidget){var I={CSE:!0,autocomplete:"off",methodType:"POST",urlService:o.CSEUserURLService,currentUser:this.currentSearchedUser,webParams:{method:"POST",getQueryParams:function(){return v}}};this.searchWidget.addOptions(I),this.searchWidget.show(),this.searchWidget.options.CSE=this.isCSE}this.titleTargetOwnership.show(),this.isHiddenOrganizationSearch=!1,this.isHiddenCollaborativeSpaceSearch=!1,this.isHiddenResponsibleSearch=!1,this.hideLoadingArea(),this.searchWidgetProject&&(this.searchWidgetProject.options.CSE=this.isCSE),this.searchWidgetOrg&&(this.searchWidgetOrg.options.CSE=this.isCSE),this.searchWidget.options.CSE=this.isCSE}1==s.LifecycleCheckCommand&&(s.boutonLifecycleCheck=new S({attributes:{title:UWA.i18n("")},name:"TopButtonLCCheck",value:UWA.i18n("Check"),className:"default medium TOS_buttonTop ",disabled:!1}),s.boutonLifecycleCheck.addEvents({onClick:function(){g.getInstance().getSecurityContext({onSuccess:function(e){s.listDataForDebug(e)},onFailure:function(e){s.setError(e)}}),this.setDisabled(!0)}}),s.boutonLifecycleCheck.inject(s.ManageButtonRight))}var w=this.SelectedItems.length;if(!this.isCSE&&u==w&&p==w){if(f!=w){var b,P=E.get("securityDenied"),D=[],_=[];_=Object.keys(this.listOfIdsWithData);for(var j=0;j<_.length;j++){var U=[],x=_[j],R="";T[N=this.listOfIdsWithData[x].TOS_Id]&&(P="success"!=(R=T[N])?R:E.get("TOS_Panel_Denied_Policy_Message"));var F=P;U.push(N),U.push(E.TOS_FailStatus),U.push("Failed"),U.push(this.listOfIdsWithData[x].Title),U.push(this.listOfIdsWithData[x].typeDisplayName),U.push(this.listOfIdsWithData[x].Revision),U.push(s.listOfIdsWithData[N].OrganizationTitle),U.push(s.listOfIdsWithData[N].CollaborativeSpaceTitle),U.push(this.listOfIdsWithData[x].Responsible),U.push(F);var L=E.get("TOS_FailStatus");U.push(L),D.push(U)}if(A.launchReportingPanel(D,this.cols,null),0==s.options.wintop)s.dispatchEvent("onCancel");else{var M={error:!0,OKdata:"",KOdata:D,reportingPanelColumns:this.cols,listOfPids:Object.keys(this.listOfIdsWithData)};s.dispatchEvent("onLaunchReportingPanel",M)}return(b={}).message=E.get("TOS_Panel_Denied_Policy_Message"),void this.setError(b)}this.searchWidgetProject&&this.searchWidgetProject.container.searchInput.disable(),this.searchWidgetOrg&&this.searchWidgetOrg.container.searchInput.disable(),this.changeOwnerToggle&&(this.changeOwnerToggle.checkFlag=!0,this.changeOwnerToggle.disabled=!0),this.searchWidget.show(),this.titleTargetOwnership.show()}if(this.isCSE||u!=w||null!=this.searchWidgetProject&&null!=this.searchWidgetProject.container.searchInput&&this.searchWidgetProject.container.searchInput.disable(),this.isCSE||p!=w||null!=this.searchWidgetOrg&&null!=this.searchOrgTitle&&this.searchWidgetOrg.container.searchInput.disable(),!this.isCSE&&O==w){if(this.options.transferType==o.TransferPerson){P=E.get("securityDenied"),D=[],_=[];_=Object.keys(this.listOfIdsWithData);for(j=0;j<_.length;j++){U=[],x=_[j],R="";T[N=this.listOfIdsWithData[x].TOS_Id]&&(P="success"!=(R=T[N])?R:E.get("TOS_Panel_Denied_Policy_Message"));F=P;U.push(N),U.push(E.TOS_FailStatus),U.push("Failed"),U.push(this.listOfIdsWithData[x].Title),U.push(this.listOfIdsWithData[x].typeDisplayName),U.push(this.listOfIdsWithData[x].Revision),U.push(s.listOfIdsWithData[N].OrganizationTitle),U.push(s.listOfIdsWithData[N].CollaborativeSpaceTitle),U.push(this.listOfIdsWithData[x].Responsible),U.push(F);L=E.get("TOS_FailStatus");U.push(L),D.push(U)}if(A.launchReportingPanel(D,this.cols,null),0==s.options.wintop)s.dispatchEvent("onCancel");else{M={error:!0,OKdata:"",KOdata:D,reportingPanelColumns:this.cols,listOfPids:_};s.dispatchEvent("onLaunchReportingPanel",M)}return}this.changeOwnerToggle&&(this.changeOwnerToggle.checkFlag=!0,this.changeOwnerToggle.disabled=!0),this.searchWidget&&(this.searchWidget.show(),this.searchWidget.container.searchInput.disable())}this.isCSE||u!=w&&p!=w&&O!=w||this.options.transferType!=o.TransferPerson&&((b={}).message=E.get("TOS_Panel_Denied_Policy_Message"),this.setError(b));if(0!==this.listOfError.length&&1!=this.isCSE){if(this.listOfError.length==this.listOfIds.length){for(D=[],j=0;j<this.listOfError.length;j++){U=[];var N=this.listOfError[j].physicalId;P=this.listOfError[j].Error,R="";T[N]&&(P="success"!=(R=T[N])?R:E.get("TOS_Panel_Denied_Policy_Message")),U.push(this.listOfError[j].physicalId),U.push(E.TOS_FailStatus),U.push("Failed"),U.push(this.listOfIdsWithData[N].Title),U.push(this.listOfIdsWithData[N].typeDisplayName),U.push(this.listOfIdsWithData[N].Revision),U.push(this.listOfIdsWithData[N].Organization),U.push(this.listOfIdsWithData[N].CollaborativeSpace),U.push(this.listOfIdsWithData[N].Responsible),U.push(P);L=E.get("TOS_FailStatus");U.push(L),D.push(U)}if(A.launchReportingPanel(D,this.cols,null),0==s.options.wintop)s.dispatchEvent("onCancel");else{M={error:!0,OKdata:"",KOdata:D,reportingPanelColumns:this.cols,listOfPids:Object.keys(this.listOfIdsWithData)};s.dispatchEvent("onLaunchReportingPanel",M)}}s.onResize(),s.hideLoadingArea()}},_setListOfIds:function(e,t){for(var i=0;i<e.length;i++)this.listOfIds.push(e[i])},_getListOfIds:function(){return this.listOfIds},_parseForGenericService:function(e){var t=[];e.length>0&&null!=e[0].owner&&(e[0].owner.hasOwnProperty("person")&&""!=e[0].owner.person&&t.push({op:"replace",path:"owner",value:e[0].owner.person.personID}),e[0].owner.hasOwnProperty("organization")&&""!=e[0].owner.organization&&t.push({op:"replace",path:"organization",value:e[0].owner.organization.orgID}),e[0].owner.hasOwnProperty("collabSpace")&&""!=e[0].owner.collabSpace&&t.push({op:"replace",path:"project",value:e[0].owner.collabSpace.collabSpaceID})),t.push({op:"replace",path:"TOSComment",value:this.textArea.elements.container.value});for(var i=[],r=0;r<e.length;r++)e[r].tosBusinessObject.forEach(function(s){var n="bus";s.hasOwnProperty("category")&&(n=s.category),"Class"===n&&(n="bus");var a="",o="",c="",h="";s.hasOwnProperty("organization")&&(a=s.organization),s.hasOwnProperty("owner")&&(o=s.owner),s.hasOwnProperty("project")&&(c=s.project),s.hasOwnProperty("type")&&(h=s.type);var l={method:"PATCH",path:"model/"+n+"/"+s.id,body:t,category:n,organization:a,owner:o,project:c,type:h};e[r].options&&(l.transferParams=e[r].options),i.push(l)});return i},_getTransferData:function(){var e=null,t=null;if(null!=this.searchWidget&&(t=r.decode(r.encode(this.searchWidget.getNewOwner()))),null!=this.searchWidgetOrg&&null!=this.searchWidgetProject){var i=r.decode(r.encode(this.searchWidgetProject.getNewOwner())),s=r.decode(r.encode(this.searchWidgetOrg.getNewOwner()));s.hasOwnProperty("organization")&&(t.organization={orgID:s.organization.orgID},s.organization.hasOwnProperty("orgTitle")&&s.organization.orgTitle&&(this.targetOrgTitle=s.organization.orgTitle)),i.hasOwnProperty("collabSpace")&&(t.collabSpace={collabSpaceID:i.collabSpace.collabSpaceID},i.collabSpace.hasOwnProperty("collabSpaceTitle")&&i.collabSpace.collabSpaceTitle&&(this.targetCollabSpaceTitle=i.collabSpace.collabSpaceTitle))}t.hasOwnProperty("person")&&(t.person.personID=t.person.personID.replace(/_PRJ$/,""));var n,a=[];n=this._getListOfIds();for(var o=0;o<n.length;o++)a.push({id:n[o].id,category:n[o].category,type:n[o].Type,organization:n[o].Organization,project:n[o].project,owner:n[o].owner});return a=this._removeDuplicateItemsToMove(a),e={tosBusinessObject:a=this._removeFailedIds(a),owner:t,options:{expandAll:!1,expandFolder:!1,expandSubFolder:!1,selectReference:!0,selectInstance:!1}},0==a.length&&(this.boutonValid.setDisabled(!0),e=""),e},_getTransferDataForSearch:function(){var e=null,t=null;if(null!=this.searchWidget&&(t=r.decode(r.encode(this.searchWidget.getNewOwner()))),null!=this.searchWidgetOrg&&null!=this.searchWidgetProject){var i=r.decode(r.encode(this.searchWidgetProject.getNewOwner())),s=r.decode(r.encode(this.searchWidgetOrg.getNewOwner()));s.hasOwnProperty("organization")&&(t.organization={orgID:s.organization.orgID}),i.hasOwnProperty("collabSpace")&&(t.collabSpace={collabSpaceID:i.collabSpace.collabSpaceID})}t.hasOwnProperty("person")&&(t.person.personID=t.person.personID.replace(/_PRJ$/,""));var n,a=[];n=this._getListOfIds();for(var o=0;o<n.length;o++)a.push({id:n[o].id,category:n[o].category});return a=this._removeDuplicateItemsToMove(a),e={tosBusinessObject:a=this._removeFailedIds(a),owner:t,options:{expandAll:!1,expandFolder:!1,expandSubFolder:!1,selectReference:!0,selectInstance:!1}},0==a.length&&(this.boutonValid.setDisabled(!0),e=""),e},_isItemInItemsToMoveList:function(e,t){for(var i=t.length,r=0;r<i;r++){var s=t[r];if(s.id==e.id&&s.category==e.category)return!0}return!1},_removeDuplicateItemsToMove:function(e){for(var t=[],i=e.length,r=0;r<i;r++){var s=e[r];this._isItemInItemsToMoveList(s,t)||t.push(s)}return t},_removeFailedIds:function(e){var t=[],i=!1,r=e.length;if(0==this.listOfFailedIds.length)return e;for(var s=0;s<r;s++){i=!1;for(var n=0;n<this.listOfFailedIds.length;n++)e[s].id==this.listOfFailedIds[n]&&(i=!0);i||t.push(e[s])}return t},_prepareTransferOwnership:function(e){var t="";null!=e&&""!=e&&e.hasOwnProperty("SecurityContext")&&(t=e.SecurityContext);var i=this._getTransferData();""!=i&&this._transferOwnership(t,i)},_commitTransferOwnership:function(e,t){this.dispatchEvent("onTransferStart");var i=this,s="",n=(this.options.serverName,this.options.serverUri,this.options.launchTransfer),a=(this.caHeader,""),c="",h="",l="";t[0].hasOwnProperty("owner")&&(t[0].owner.hasOwnProperty("person")&&(a=t[0].owner.person.personFullName,l=t[0].owner.person.personID),t[0].owner.hasOwnProperty("organization")&&(c=t[0].owner.organization.orgID),t[0].owner.hasOwnProperty("collabSpace")&&(h=t[0].owner.collabSpace.collabSpaceID)),u.get3DSpaceUrlAsync({onComplete:function(e){var d={Accept:"application/json","content-type":"application/json"};d.SecurityContext=encodeURIComponent(i.securityContext),i.caHeader&&(i.caHeader["DS-Change-Authoring-Context"]&&(d["DS-Change-Authoring-Context"]=i.caHeader["DS-Change-Authoring-Context"]),i.caHeader["DS-Configuration-Authoring-Context"]&&(d["DS-Configuration-Authoring-Context"]=i.caHeader["DS-Configuration-Authoring-Context"]));var g=i._parseForGenericService(t);s=u.getRealPath("assets/transferOwnership.json",widget);var p="",O="GET",f="",S="admin=true";if(null!=i.adminCheckBox&&i.adminCheckBox.isChecked()||(S=""),2==j){for(var T in s=e+"/resources/v1/collabServices/attributes/op/update?"+S,f="passport",O="PUT",g)g[T].queryParams={select:["physicalid","type","current"]};p=r.encode({withUpdatedValues:!1,requests:g})}var y="";t.length>0&&(y=t[0].owner);var W={requests:g,owner:y};if(i.dispatchEvent("onValidation",W),!0===n){i.displayLoadingArea(),d["Accept-Language"]=widget.lang;var m=u.getTenantID();m&&(s+="&tenant="+m),u.partitionedAuthenticatedRequest(s,{type:"json",method:O,proxy:f,headers:d,maxChunkSize:19,cancelCallback:function(){return!1},partisionedProgressLabel:i.options.transferType==o.TransferPerson?E.get("TOS_ChangingResponsible"):E.get("TOS_UpdatingOwnership"),progressBarContext:i.ManageButtonLeft,progressBarWaitContext:i.container,data:p,timeout:36e5,onComplete:function(e){i._onSucceedGenericTransfer(e,a,c,h,l)},onFailure:function(e,t,r){i._onFailure(e,t,r)},onTimeout:function(e){i._onTimeout()}})}}})},_transferOwnership:function(e,t){this._goTransferOwnership(e,t)},_goTransferOwnership:function(e,t){if(!0!==this.options.genericTransfer);else{for(var i=[],r=0;r<t.tosBusinessObject.length;r++){var s=[];s.push(t.tosBusinessObject[r]),i.push({tosBusinessObject:s,owner:t.owner,options:{expandAll:t.options.expandAll,expandFolder:t.options.expandFolder,expandSubFolder:t.options.expandSubFolder,selectReference:t.options.selectReference,selectInstance:t.options.selectInstance}})}this._commitTransferOwnership(e,i)}},_onSucceedGenericTransfer:function(e,t,i,r,s){var n=this,a={},o=[],c={};e.results&&e.results.forEach(function(e){if(e.status>=200&&e.status<306);if(e.status>=200&&e.status<306){if(null==e.body.sameOwner){var t=!1;if(e.body&&e.body.errors)(i=e.body.errors.length)>0&&(t=e.body.errors[i-1]);c[e.body.physicalid]||(o.push({id:e.body.physicalid,type:e.body.type,current:e.body.current,error:t}),c[e.body.physicalid]="processed")}else if(1==e.body.sameOwner)return!1}else{var i;t={message:UWA.i18n("cannot move selection"),code:"ERROR"};if(e.body&&e.body.errors)(i=e.body.errors.length)>0&&(t=e.body.errors[i-1]);if(500==e.status&&e.body&&e.body.errors&&e.body.physicalid){var r=e.body.physicalid;if(null!=n.ListOfEC[r])return c[e.body.physicalid]||(o.push({id:e.body.physicalid,type:e.body.type,current:e.body.current,error:t}),c[e.body.physicalid]="processed"),!0;if(null!=n.ListOfAggrObj[r])return c[e.body.physicalid]||(o.push({id:e.body.physicalid,type:e.body.type,current:e.body.current,error:t}),c[e.body.physicalid]="processed"),!0}null!=e.body.physicalid&&(c[e.body.physicalid]||(o.push({id:e.body.physicalid,type:e.body.type,current:e.body.current,error:t}),c[e.body.physicalid]="processed"))}return!0});Object.keys(n.ListOfEC).forEach(function(e){if(void 0===c[e]){var t={message:UWA.i18n(E.get("TOS_selectOwningProduct")),code:"ERROR"};o.push({id:e,type:"ERROR",current:e,error:t})}});Object.keys(n.ListOfAggrObj).forEach(function(e){if(void 0===c[e]){var t={message:UWA.i18n(E.get("TOS_selectOwningProduct")),code:"ERROR"};o.push({id:e,type:"ERROR",current:e,error:t})}}),o.length>0&&(a.listId=o),this._transferSucceedForUpdate(a,t,i,r,s)},_transferSucceedForUpdate:function(e,t,i,r,s){var a=this;a.hideLoadingArea();var o=JSON.parse("[]"),c=[];for(C=0;C<e.listId&&e.listId.length;C++){o[u=e.listId[C].id]=C,-1==c.indexOf(u)&&c.push(u)}var h=[],l=[],d=[];if(e.listId&&e.listId.length>0)for(var u,g=0;g<e.listId.length;g++){var p=[],O=e.listId[g].id;if(void 0!==a.listOfIdsWithData[O]){if(-1!=p.indexOf(e.listId[g].id))continue;if(p.push(e.listId[g].id),e.listId[g].error){p.push(E.TOS_FailStatus),p.push("Failed"),p.push(a.listOfIdsWithData[O].Title),p.push(a.listOfIdsWithData[O].typeDisplayName),p.push(a.listOfIdsWithData[O].Revision),p.push(a.listOfIdsWithData[O].OrganizationTitle),p.push(a.listOfIdsWithData[O].CollaborativeSpaceTitle),p.push(a.listOfIdsWithData[O].Responsible),e.listId[g].error.originalMessage&&""!=e.listId[g].error.originalMessage?p.push(e.listId[g].error.originalMessage):p.push(e.listId[g].error.message);var f=E.get("TOS_FailStatus");p.push(f),d.push(p)}else{p.push(E.TOS_SuccessStatus),p.push("Success"),p.push(a.listOfIdsWithData[O].Title),p.push(a.listOfIdsWithData[O].typeDisplayName),p.push(a.listOfIdsWithData[O].Revision),null!=a.targetOrgTitle?p.push(a.targetOrgTitle):p.push(a.listOfIdsWithData[O].OrganizationTitle),null!=a.targetCollabSpaceTitle?p.push(a.targetCollabSpaceTitle):p.push(a.listOfIdsWithData[O].CollaborativeSpaceTitle),""!=t?p.push(t):p.push(a.listOfIdsWithData[O].Responsible);f=E.get("TOS_SuccessStatus");p.push(f),l.push(p)}h.push(p)}}var S=[],T=[],y={};require(["DS/PADUtils/PADCommandProxy","DS/PADUtils/PADContext"],function(t,i){var r=i.get();null==r&&(r=a.options.context);var s=[],n=[],o=[];(null!=e&&void 0!==e&&Array.isArray(e.listId)&&e.listId.forEach(function(e){if(void 0!==e.error&&e.hasOwnProperty("error")){var t=null!=e.id.value?e.id.value:e.id;T.push(t),"Workspace"==e.type?s.push(t):"PRIVATE"==e.current||"#DENIED!"==e.current?o.push(t):n.push(t)}}),s.length>0)&&((c={}).deleted=s,(h={}).authored=c,r.author(!0),r.onRefresh(h),(l=t.create()).destroy());if(n.length>0||o.length>0){var c,h;(c={}).modified=n,c.deleted=o,(h={}).authored=c;var l;(l=t.create()).authored({authored:!0}),l.refresh(h),l.destroy()}});var W=Object.keys(a.listOfIdsWithData);null!=e&&void 0!==e&&Array.isArray(e.listId)&&e.listId.forEach(function(e){S.push(e.id);var n=e.id;if("PRIVATE"==e.current||"#DENIED!"==e.current)y[e.id]={id:e.id,newOwnerFullName:t,newOrganization:i,newCollabSpace:r,newOwnerId:s,error:!1,removeFromUI:!0};else if(e.hasOwnProperty("error")&&null!=e.error)if(0==e.error)y[e.id]={id:e.id,newOwnerFullName:t,newOrganization:i,newCollabSpace:r,newOwnerId:s,error:!1,removeFromUI:!1};else if(void 0!==a.listOfIdsWithData[n]&&null!==a.listOfIdsWithData[n]){var o=e.id;y[e.id]={id:o,newOwnerFullName:a.listOfIdsWithData[o].Responsible,newOrganization:a.listOfIdsWithData[o].Organization,newCollabSpace:a.listOfIdsWithData[o].CollaborativeSpace,newOwnerId:s,error:!0,removeFromUI:!1}}});var m=Math.floor(Date.now());n.publish("DS/Object/update",{metadata:{appId:widget.id,appName:widget.name,timestamp:m,options:{force:!0}},data:{paths:S,attributes:y},version:"1.0"}),n.publish("ENOLC_MOVE_CMD_UPDATE",{metadata:{appId:widget.id,appName:widget.name,timestamp:m,options:{force:!0}},data:{paths:S,attributes:y},version:"1.0"}),a.container.setStyle("opacity","1"),this.dispatchEvent("onTransferSucceed"),a.container.setStyle("opacity","1"),this.dispatchEvent("onTransferFail");if(e.hasOwnProperty("error")){h=[];if(e.hasOwnProperty("listId"))for(var v=e.listId,C=0;C<v.length;C++){p=[];var I=v[C].id,w=a.listOfIdsWithData[I];if(null!=w){p.push(I),p.push(E.TOS_FailStatus),p.push("Failed"),p.push(a.listOfIdsWithData[I].Title),p.push(a.listOfIdsWithData[I].typeDisplayName),p.push(a.listOfIdsWithData[I].Revision),p.push(a.listOfIdsWithData[I].OrganizationTitle),p.push(a.listOfIdsWithData[I].CollaborativeSpaceTitle),p.push(a.listOfIdsWithData[I].Responsible),e.error.originalMessage&&""!=e.error.originalMessage?p.push(e.error.originalMessage):p.push(e.error.message);f=E.get("TOS_FailStatus");p.push(f),h.push(p)}}if(0==h.length){W=Object.keys(a.listOfIdsWithData);for(var b=0;b<W.length;b++){(p=[]).push(W[b]),p.push(E.TOS_FailStatus),p.push("Failed"),p.push(a.listOfIdsWithData[W[b]].Title),p.push(a.listOfIdsWithData[W[b]].typeDisplayName),p.push(a.listOfIdsWithData[W[b]].Revision),p.push(a.listOfIdsWithData[W[b]].OrganizationTitle),p.push(a.listOfIdsWithData[W[b]].CollaborativeSpaceTitle),p.push(a.listOfIdsWithData[W[b]].Responsible),e.error.originalMessage&&""!=e.error.originalMessage?p.push(e.error.originalMessage):p.push(e.error.message);f=E.get("TOS_FailStatus");p.push(f),h.push(p)}}if(A.launchReportingPanel(h,this.cols,null),1==a.options.wintop){var P={error:!0,OKdata:l,KOdata:d,reportingPanelColumns:this.cols,listOfPids:Object.keys(this.listOfIdsWithData)};a.dispatchEvent("onLaunchReportingPanel",P)}return null!=a.table&&a.table.clearAllLine(),n.publish("TOS_SummaryResult",{listId:[]}),void(0==a.options.wintop?a.dispatchEvent("onCancel"):a.dispatchEvent("onLaunchReportingPanel",S))}if(A.launchReportingPanel(h,this.cols,null),null!=a.table&&a.table.clearAllLine(),n.publish("TOS_SummaryResult",{listId:[]}),0==a.options.wintop)a.dispatchEvent("onCancel");else if(e.listId&&Array.isArray(e.listId)){var D=[];for(C=0;C<e.listId.length;C++)D.push(e.listId[C].id);P={error:!0,OKdata:l,KOdata:d,reportingPanelColumns:this.cols,listOfPids:D};a.dispatchEvent("onLaunchReportingPanel",P)}else{P={error:!0,OKdata:"",KOdata:h,reportingPanelColumns:this.cols,listOfPids:Object.keys(this.listOfIdsWithData)};a.dispatchEvent("onLaunchReportingPanel",P)}},getTopBar:function(){return this.ManageButtonDiv},onResize:function(){this.container.getSize(),this.mainInterface.getSize();null!==this.searchSection&&(this.searchWidget&&this.searchWidget.hasOwnProperty("hiddenUser")||(this.searchSection.setStyle("width","100%"),this.searchSection.setStyle("display","block"))),null!==this.searchSectionProject&&(this.searchWidgetProject&&this.searchWidgetProject.hasOwnProperty("hiddenCS")||(this.searchSectionProject.setStyle("width","100%"),this.searchSectionProject.setStyle("display","block"))),null!==this.searchSectionOrganization&&(this.searchWidgetOrg&&this.searchWidgetOrg.hasOwnProperty("hiddenOrg")||(this.searchSectionOrganization.setStyle("width","100%"),this.searchSectionOrganization.setStyle("display","block")))},_ManageValidButton:function(e){var t=e;null==e&&(t=!1),t?this.boutonValid.setDisabled(!1):this.boutonValid.setDisabled(!0)},initData:function(e,t){g.getInstance().getSecurityContext(),this.SelectedItems=[],this._addData(e),this.caHeader=t;D.contains("1");for(var i=[],r=[],s=0;s<e.length;s++){e[s].hasOwnProperty("organizationTitle")&&null!=e[s].organizationTitle&&null!=e[s].organizationTitle||(e[s].organizationTitle,e[s].organization),e[s].hasOwnProperty("projectTitle")&&null!=e[s].projectTitle&&null!=e[s].projectTitle||(e[s].projectTitle,e[s].project),null!=e[s].projectTitle&&null!=e[s].projectTitle||(e[s].projectTitle,e[s].project);var n={TOS_Id:e[s].physicalId,Title:e[s].name,Type:e[s].type,Revision:e[s].Revision,Organization:e[s].organization,OrganizationTitle:e[s].organizationTitle,CollaborativeSpace:e[s].project,CollaborativeSpaceTitle:e[s].projectTitle,project:e[s].project,Responsible:e[s].responsibleName,typeDisplayName:e[s].typeDisplayName,Responsible:e[s].responsibleName,owner:e[s].owner,Status:"",physicalId:e[s].physicalId};this.listOfIdsWithData[e[s].physicalId]=n;var a={id:e[s].physicalId,category:e[s].category,mainRevisionId:e[s].physicalId,TOS_Id:e[s].physicalId,Title:e[s].name,Type:e[s].type,Revision:e[s].Revision,Organization:e[s].organization,OrganizationTitle:e[s].organizationTitle,CollaborativeSpace:e[s].project,CollaborativeSpaceTitle:e[s].projectTitle,project:e[s].project,Responsible:e[s].responsibleName,typeDisplayName:e[s].typeDisplayName,Responsible:e[s].responsibleName,owner:e[s].owner,Status:""};if(1==e[s].v_IsEmbeddedComponent){var o=e[s].physicalId;this.ListOfEC[o]=!0}else if(1==e[s].aggrObj){o=e[s].physicalId;this.ListOfAggrObj[o]=!0}else 0==e[s].v_IsEmbeddedComponent?i.push(a):0==e[s].aggrObj&&i.push(a);if(0==e[s].v_IsEmbeddedComponent&&0==e[s].aggrObj){o=e[s].physicalId;r.push({physicalId:o})}}if(this._setListOfIds(i),"editProperties_TransferOwnershipPopup"!=this.options.oldClassName&&this.listOfIdsWithData&&Array.isArray(this.listOfIdsWithData)){var c=Object.values(this.listOfIdsWithData);this.getcanUserChangePOV(c)}},_addData:function(e){this.hideMainErrorArea();var t=[],i=this;null!=e&&(t=e.slice()),u.removeDuplicate(t,function(e){return e.physicalId}),t.forEach(function(e){var t=new f(e);u.arrayContains(i.SelectedItems,t,function(e){return e.physicalId})<0&&i.SelectedItems.push(t)}),this.displayMainLoadingArea(),this._AddSelectedItem(i.SelectedItems),this.displayMainInterfaceArea();var r=[];i.SelectedItems.forEach(function(e){r.push({objectID:e.getPhysicalId()})}),null!=this.searchWidget&&this.searchWidget.setSelectedItemList(r),this.onResize()},_AddSelectedItem:function(e){this._manageAccessList()},_manageAccessList:function(){var e=1,t="";this.SelectedItems&&this.SelectedItems.length>1?e=this.SelectedItems.length:this.SelectedItems&&1==this.SelectedItems.length&&(t=" - "+this.SelectedItems[0].name);var i="";this.options.transferType==o.TransferFull?i+=UWA.i18n("TOS_mainTile"):this.options.transferType==o.TransferPerson?i+=UWA.i18n("ChangeResp_mainTile"):this.options.transferType==o.TransferCollabSpace&&(i+=UWA.i18n("ChangeCollab_mainTile")),0==e?this.itemsArea.hide():1==e?(this.itemsArea.hide(),i+=t):(this.itemsArea.hide(),i+=" - "+e+" "+UWA.i18n("TOS_Objects")),this.dispatchEvent("onTitleChange",i)},showNotification:function(e,t){null==t&&(t=""),null!=this.errorOverlay&&this.errorOverlay.addSuccess(e,t)},showInfoNotification:function(e,t){null==t&&(t=""),null!=this.errorOverlay&&this.errorOverlay.addInfo(e,t)},setError:function(e){this.addError(e)},addError:function(e){if(null!=this.errorOverlay&&e&&e.hasOwnProperty("message")){UWA.i18n(e.message);this.errorOverlay.displayJSONError(r.encode(e))}},displayLoadingArea:function(){null!=this.loadingArea&&this.loadingArea.show()},hideLoadingArea:function(){null!=this.loadingArea&&this.loadingArea.hide()},displayMainInterfaceArea:function(){this.hideAllAreas(),null!=this.mainInterface&&this.mainInterface.show(),null!=this.boutonValid&&this.boutonValid.show()},displayMainLoadingArea:function(){this.hideAllAreas(),null!=this.mainLoading&&this.mainLoading.show()},hideMainComponent:function(){this.hideLoadingArea(),null!=this.mainInterface&&this.mainInterface.hide(),null!=this.boutonValid&&this.boutonValid.hide()},hideMainLoadingArea:function(){null!=this.mainLoading&&this.mainLoading.hide()},hideMainErrorArea:function(){null!=this.mainError&&this.mainError.hide()},hideAllAreas:function(){this.hideMainLoadingArea(),this.hideMainComponent()},addMainError:function(e){null!=this.mainError&&new UWA.createElement("div",{text:e}).inject(this.mainError)},clearAllMainError:function(){null!=this.mainError&&this.mainError.setContent("")},_createSelectedTable:function(){},_createNewLine:function(e){},_onFailure:function(e,t,i){this.dispatchEvent("onTransferFail"),this.hideLoadingArea();var s={};r.isJson(t)&&(t=r.decode(t)),s=null!=t&&t.hasOwnProperty("error")?t.error:{message:UWA.i18n("UnknownError"),code:"ERROR"},this.setError(s)},_onTimeout:function(){this.dispatchEvent("onTransferFail"),this.hideLoadingArea();var e={message:UWA.i18n("ErrorTimeOut"),code:"TO"};this.setError(e)},listDataForDebug:function(e){var t=this;u.get3DSpaceUrlAsync({onComplete:function(e){var i={Accept:"application/json"},s=u.getRealPath("assets/transferOwnership.json",widget),n="",a="GET",o="",c=Object.values(t.listOfIdsWithData),h=t.parseDataForCanUserChangePOV(c);2==j&&(s=e+"/resources/v1/collabServices/base/transferOwnership/checkData",o="passport",a="PUT",n=r.encode({requests:h})),t.displayLoadingArea(),i["Accept-Language"]=widget.lang;var l=u.getTenantID();l&&(s+="?tenant="+l),i["Accept-Language"]=widget.lang,i.SecurityContext=encodeURIComponent(t.securityContext),u.partitionedAuthenticatedRequest(s,{type:"json",method:a,proxy:o,headers:i,maxChunkSize:19,cancelCallback:function(){return!1},partisionedProgressLabel:"Getting data for check..",progressBarContext:t.ManageButtonLeft,progressBarWaitContext:t.container,symultaneousRequest:!0,data:n,timeout:36e5,onComplete:function(e){t._onLifecycleDataCheckSucceed(e)},onFailure:function(e,i,r){t._onFailure(e,i,r)},onTimeout:function(e){t._onTimeout()}})}})},_onLifecycleDataCheckSucceed:function(e){var t=null;if(e.hasOwnProperty("success")&&!0===e.success&&e.hasOwnProperty("data")&&(t=e.data),null!=t){var i=function(e){return(e=e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")).replace(/("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)/g,function(e){var t="number";return/^"/.test(e)?t=/:$/.test(e)?"key":"string":/true|false/.test(e)?t="boolean":/null/.test(e)&&(t="null"),'<span class="'+t+'">'+e+"</span>"})}(JSON.stringify(t,void 0,4)),r=new P;r.body=UWA.extend(document.body);var s="<head><style>pre {outline: 1px solid #ccc; padding: 5px; margin: 5px; overflow-y:scroll; height: 100%; width: 100% } .string { color: green; } ";s+=" .number { color: darkorange; } .boolean { color: blue; } .null { color: magenta; } .key { color: red; }</style></head><body>",new w({className:"LifecycleCommandCheck_Dlg ",title:"Report",body:s+="<pre>"+i+"</pre>",overlay:!0,escapeToClose:!0,closable:!0,animate:!0,resizable:!0,maximizable:!0,autocenter:!0,visible:!0,limitParent:!0}).inject(r.body)}}})}),define("DS/TransferOwnershipWidget/TransferOwnershipWidget",["DS/TransferOwnershipWidget/component/TransferOwnershipWidget"],function(e){}),define("DS/TransferOwnershipWidget/popup/TransferOwnershipPopup",["UWA/Controls/Abstract","DS/TransferOwnershipWidget/component/TransferOwnershipWidget","DS/TransferOwnershipWidget/TransferOwnershipConstant","DS/ENOFloatingPanel/ENOFloatingPanel","css!DS/TransferOwnershipWidget/TransferOwnershipWidget.css"],function(e,t,i,r){"use strict";return e.extend({defaultOptions:{className:"",context:null,ForbiddenChar:'"#$@%,?\\<>[]|:',transferType:i.TransferFull,serverName:"",serverUri:"",launchTransfer:!0,genericTransfer:!1,activeDnD:!1,activeOptions:!1,activeSummaryButton:!1,activeHistoryButton:!1,activeAdminCheckBox:!1,removeAtClose:!0,odtMode:!1},init:function(e,t,i,r){this.defaultOptions.activeAdminCheckBox=widget.getBool("admin"),this._parent(t),this.initUI(e,widget,r)},onRefresh:function(){null!=this.TOSWidget&&this.TOSWidget.onRefresh()},onResize:function(){null!=this.TOSWidget&&this.TOSWidget.onResize()},actionOnMove:function(){this.TOSWidget&&this.TOSWidget.actionOnMove()},destroy:function(){this.TOSWidget&&this.TOSWidget.destroy(),this._parent()},setSecurityContext:function(e){this.TOSWidget.setSecurityContext(e)},initUI:function(e,i,s){var n=this;n.widgetPere=e,n.TOSWidget=new t(n.widgetPere,s,{className:"transferOwnership_innerComponent",context:n.options.context,ForbiddenChar:n.options.ForbiddenChar,setCloseButton:!0,showTopBar:!1,transferType:n.options.transferType,launchTransfer:n.options.launchTransfer,genericTransfer:n.options.genericTransfer,topClassHeight:"TOSP_PopupDial",serverName:this.options.serverName,serverUri:this.options.serverUri,activeDnD:this.options.activeDnD,activeOptions:this.options.activeOptions,activeSummaryButton:this.options.activeSummaryButton,activeHistoryButton:this.options.activeHistoryButton,activeAdminCheckBox:this.options.activeAdminCheckBox,oldClassName:this.options.className,securityContext:this.options.securityContext,odtMode:this.options.odtMode,events:{onNewSize:function(e){n.container.setNewBodySize({width:null,height:e.height});var t=n.container.getContainerHeight();t=t>460?460:t,n.container.setNewSize({height:t}),n.container.lockWidth()},onCancel:function(){n._close(),n.dispatchEvent("onCancel")},onValidation:function(e){n.dispatchEvent("onValidation",e)},onTitleChange:function(e){n.container.setTitle(e)}}}),n.container=new r({title:"ENOVIA",className:"TOSP_PopupDial "+this.options.className,footer:n.TOSWidget.getTopBar(),body:n.TOSWidget,overlay:!0,closable:!0,animate:!0,resizable:!0,events:{onResizeFloating:function(){n.onResize(),n.actionOnMove(),n.container._minHeight=350},onMove:function(){n.actionOnMove()},onClose:function(){n._close()},onHide:function(){n._close()}}}),n.container.inject(e);var a=e.offsetHeight>500?500:e.offsetHeight;n.container.setNewSize({height:a})},centerIt:function(){this.container.centerIt()},show:function(e,t){this.container.show(),this.TOSWidget.initData(e,t)},close:function(){this.container.hide(),!0===this.options.removeAtClose&&this.destroy()},_close:function(){this.dispatchEvent("onClose"),this.close()}})});